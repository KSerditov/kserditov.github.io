var lse=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var Gpt=lse((Ic,Mc)=>{function cse(e,t){for(var r=0;r<t.length;r++){const n=t[r];if(typeof n!="string"&&!Array.isArray(n)){for(const i in n)if(i!=="default"&&!(i in e)){const a=Object.getOwnPropertyDescriptor(n,i);a&&Object.defineProperty(e,i,a.get?a:{enumerable:!0,get:()=>n[i]})}}}return Object.freeze(Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}))}(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const a of i)if(a.type==="childList")for(const o of a.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function r(i){const a={};return i.integrity&&(a.integrity=i.integrity),i.referrerPolicy&&(a.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?a.credentials="include":i.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function n(i){if(i.ep)return;i.ep=!0;const a=r(i);fetch(i.href,a)}})();var fh=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function $G(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function dse(e){if(e.__esModule)return e;var t=e.default;if(typeof t=="function"){var r=function n(){if(this instanceof n){var i=[null];i.push.apply(i,arguments);var a=Function.bind.apply(t,i);return new a}return t.apply(this,arguments)};r.prototype=t.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(e).forEach(function(n){var i=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(r,n,i.get?i:{enumerable:!0,get:function(){return e[n]}})}),r}var WG={exports:{}},Gw={},XG={exports:{}},Zr={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Fb=Symbol.for("react.element"),fse=Symbol.for("react.portal"),pse=Symbol.for("react.fragment"),hse=Symbol.for("react.strict_mode"),vse=Symbol.for("react.profiler"),mse=Symbol.for("react.provider"),gse=Symbol.for("react.context"),yse=Symbol.for("react.forward_ref"),bse=Symbol.for("react.suspense"),xse=Symbol.for("react.memo"),Sse=Symbol.for("react.lazy"),eN=Symbol.iterator;function Cse(e){return e===null||typeof e!="object"?null:(e=eN&&e[eN]||e["@@iterator"],typeof e=="function"?e:null)}var YG={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},KG=Object.assign,QG={};function r0(e,t,r){this.props=e,this.context=t,this.refs=QG,this.updater=r||YG}r0.prototype.isReactComponent={};r0.prototype.setState=function(e,t){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")};r0.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function ZG(){}ZG.prototype=r0.prototype;function zR(e,t,r){this.props=e,this.context=t,this.refs=QG,this.updater=r||YG}var VR=zR.prototype=new ZG;VR.constructor=zR;KG(VR,r0.prototype);VR.isPureReactComponent=!0;var tN=Array.isArray,JG=Object.prototype.hasOwnProperty,HR={current:null},eq={key:!0,ref:!0,__self:!0,__source:!0};function tq(e,t,r){var n,i={},a=null,o=null;if(t!=null)for(n in t.ref!==void 0&&(o=t.ref),t.key!==void 0&&(a=""+t.key),t)JG.call(t,n)&&!eq.hasOwnProperty(n)&&(i[n]=t[n]);var s=arguments.length-2;if(s===1)i.children=r;else if(1<s){for(var u=Array(s),l=0;l<s;l++)u[l]=arguments[l+2];i.children=u}if(e&&e.defaultProps)for(n in s=e.defaultProps,s)i[n]===void 0&&(i[n]=s[n]);return{$$typeof:Fb,type:e,key:a,ref:o,props:i,_owner:HR.current}}function _se(e,t){return{$$typeof:Fb,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}function GR(e){return typeof e=="object"&&e!==null&&e.$$typeof===Fb}function wse(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(r){return t[r]})}var rN=/\/+/g;function OA(e,t){return typeof e=="object"&&e!==null&&e.key!=null?wse(""+e.key):t.toString(36)}function xS(e,t,r,n,i){var a=typeof e;(a==="undefined"||a==="boolean")&&(e=null);var o=!1;if(e===null)o=!0;else switch(a){case"string":case"number":o=!0;break;case"object":switch(e.$$typeof){case Fb:case fse:o=!0}}if(o)return o=e,i=i(o),e=n===""?"."+OA(o,0):n,tN(i)?(r="",e!=null&&(r=e.replace(rN,"$&/")+"/"),xS(i,t,r,"",function(l){return l})):i!=null&&(GR(i)&&(i=_se(i,r+(!i.key||o&&o.key===i.key?"":(""+i.key).replace(rN,"$&/")+"/")+e)),t.push(i)),1;if(o=0,n=n===""?".":n+":",tN(e))for(var s=0;s<e.length;s++){a=e[s];var u=n+OA(a,s);o+=xS(a,t,r,u,i)}else if(u=Cse(e),typeof u=="function")for(e=u.call(e),s=0;!(a=e.next()).done;)a=a.value,u=n+OA(a,s++),o+=xS(a,t,r,u,i);else if(a==="object")throw t=String(e),Error("Objects are not valid as a React child (found: "+(t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return o}function F2(e,t,r){if(e==null)return e;var n=[],i=0;return xS(e,n,"","",function(a){return t.call(r,a,i++)}),n}function Ese(e){if(e._status===-1){var t=e._result;t=t(),t.then(function(r){(e._status===0||e._status===-1)&&(e._status=1,e._result=r)},function(r){(e._status===0||e._status===-1)&&(e._status=2,e._result=r)}),e._status===-1&&(e._status=0,e._result=t)}if(e._status===1)return e._result.default;throw e._result}var oo={current:null},SS={transition:null},Ase={ReactCurrentDispatcher:oo,ReactCurrentBatchConfig:SS,ReactCurrentOwner:HR};Zr.Children={map:F2,forEach:function(e,t,r){F2(e,function(){t.apply(this,arguments)},r)},count:function(e){var t=0;return F2(e,function(){t++}),t},toArray:function(e){return F2(e,function(t){return t})||[]},only:function(e){if(!GR(e))throw Error("React.Children.only expected to receive a single React element child.");return e}};Zr.Component=r0;Zr.Fragment=pse;Zr.Profiler=vse;Zr.PureComponent=zR;Zr.StrictMode=hse;Zr.Suspense=bse;Zr.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Ase;Zr.cloneElement=function(e,t,r){if(e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var n=KG({},e.props),i=e.key,a=e.ref,o=e._owner;if(t!=null){if(t.ref!==void 0&&(a=t.ref,o=HR.current),t.key!==void 0&&(i=""+t.key),e.type&&e.type.defaultProps)var s=e.type.defaultProps;for(u in t)JG.call(t,u)&&!eq.hasOwnProperty(u)&&(n[u]=t[u]===void 0&&s!==void 0?s[u]:t[u])}var u=arguments.length-2;if(u===1)n.children=r;else if(1<u){s=Array(u);for(var l=0;l<u;l++)s[l]=arguments[l+2];n.children=s}return{$$typeof:Fb,type:e.type,key:i,ref:a,props:n,_owner:o}};Zr.createContext=function(e){return e={$$typeof:gse,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},e.Provider={$$typeof:mse,_context:e},e.Consumer=e};Zr.createElement=tq;Zr.createFactory=function(e){var t=tq.bind(null,e);return t.type=e,t};Zr.createRef=function(){return{current:null}};Zr.forwardRef=function(e){return{$$typeof:yse,render:e}};Zr.isValidElement=GR;Zr.lazy=function(e){return{$$typeof:Sse,_payload:{_status:-1,_result:e},_init:Ese}};Zr.memo=function(e,t){return{$$typeof:xse,type:e,compare:t===void 0?null:t}};Zr.startTransition=function(e){var t=SS.transition;SS.transition={};try{e()}finally{SS.transition=t}};Zr.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")};Zr.useCallback=function(e,t){return oo.current.useCallback(e,t)};Zr.useContext=function(e){return oo.current.useContext(e)};Zr.useDebugValue=function(){};Zr.useDeferredValue=function(e){return oo.current.useDeferredValue(e)};Zr.useEffect=function(e,t){return oo.current.useEffect(e,t)};Zr.useId=function(){return oo.current.useId()};Zr.useImperativeHandle=function(e,t,r){return oo.current.useImperativeHandle(e,t,r)};Zr.useInsertionEffect=function(e,t){return oo.current.useInsertionEffect(e,t)};Zr.useLayoutEffect=function(e,t){return oo.current.useLayoutEffect(e,t)};Zr.useMemo=function(e,t){return oo.current.useMemo(e,t)};Zr.useReducer=function(e,t,r){return oo.current.useReducer(e,t,r)};Zr.useRef=function(e){return oo.current.useRef(e)};Zr.useState=function(e){return oo.current.useState(e)};Zr.useSyncExternalStore=function(e,t,r){return oo.current.useSyncExternalStore(e,t,r)};Zr.useTransition=function(){return oo.current.useTransition()};Zr.version="18.2.0";XG.exports=Zr;var _e=XG.exports;const Fs=$G(_e),nN=cse({__proto__:null,default:Fs},[_e]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Pse=_e,Tse=Symbol.for("react.element"),Ise=Symbol.for("react.fragment"),Mse=Object.prototype.hasOwnProperty,Dse=Pse.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Rse={key:!0,ref:!0,__self:!0,__source:!0};function rq(e,t,r){var n,i={},a=null,o=null;r!==void 0&&(a=""+r),t.key!==void 0&&(a=""+t.key),t.ref!==void 0&&(o=t.ref);for(n in t)Mse.call(t,n)&&!Rse.hasOwnProperty(n)&&(i[n]=t[n]);if(e&&e.defaultProps)for(n in t=e.defaultProps,t)i[n]===void 0&&(i[n]=t[n]);return{$$typeof:Tse,type:e,key:a,ref:o,props:i,_owner:Dse.current}}Gw.Fragment=Ise;Gw.jsx=rq;Gw.jsxs=rq;WG.exports=Gw;var P=WG.exports,yI={},nq={exports:{}},cs={},iq={exports:{}},aq={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function t(G,$){var q=G.length;G.push($);e:for(;0<q;){var ee=q-1>>>1,fe=G[ee];if(0<i(fe,$))G[ee]=$,G[q]=fe,q=ee;else break e}}function r(G){return G.length===0?null:G[0]}function n(G){if(G.length===0)return null;var $=G[0],q=G.pop();if(q!==$){G[0]=q;e:for(var ee=0,fe=G.length,W=fe>>>1;ee<W;){var X=2*(ee+1)-1,U=G[X],z=X+1,J=G[z];if(0>i(U,q))z<fe&&0>i(J,U)?(G[ee]=J,G[z]=q,ee=z):(G[ee]=U,G[X]=q,ee=X);else if(z<fe&&0>i(J,q))G[ee]=J,G[z]=q,ee=z;else break e}}return $}function i(G,$){var q=G.sortIndex-$.sortIndex;return q!==0?q:G.id-$.id}if(typeof performance=="object"&&typeof performance.now=="function"){var a=performance;e.unstable_now=function(){return a.now()}}else{var o=Date,s=o.now();e.unstable_now=function(){return o.now()-s}}var u=[],l=[],c=1,d=null,f=3,p=!1,v=!1,h=!1,m=typeof setTimeout=="function"?setTimeout:null,g=typeof clearTimeout=="function"?clearTimeout:null,y=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function b(G){for(var $=r(l);$!==null;){if($.callback===null)n(l);else if($.startTime<=G)n(l),$.sortIndex=$.expirationTime,t(u,$);else break;$=r(l)}}function S(G){if(h=!1,b(G),!v)if(r(u)!==null)v=!0,j(x);else{var $=r(l);$!==null&&Y(S,$.startTime-G)}}function x(G,$){v=!1,h&&(h=!1,g(A),A=-1),p=!0;var q=f;try{for(b($),d=r(u);d!==null&&(!(d.expirationTime>$)||G&&!k());){var ee=d.callback;if(typeof ee=="function"){d.callback=null,f=d.priorityLevel;var fe=ee(d.expirationTime<=$);$=e.unstable_now(),typeof fe=="function"?d.callback=fe:d===r(u)&&n(u),b($)}else n(u);d=r(u)}if(d!==null)var W=!0;else{var X=r(l);X!==null&&Y(S,X.startTime-$),W=!1}return W}finally{d=null,f=q,p=!1}}var C=!1,w=null,A=-1,M=5,D=-1;function k(){return!(e.unstable_now()-D<M)}function R(){if(w!==null){var G=e.unstable_now();D=G;var $=!0;try{$=w(!0,G)}finally{$?O():(C=!1,w=null)}}else C=!1}var O;if(typeof y=="function")O=function(){y(R)};else if(typeof MessageChannel<"u"){var H=new MessageChannel,B=H.port2;H.port1.onmessage=R,O=function(){B.postMessage(null)}}else O=function(){m(R,0)};function j(G){w=G,C||(C=!0,O())}function Y(G,$){A=m(function(){G(e.unstable_now())},$)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(G){G.callback=null},e.unstable_continueExecution=function(){v||p||(v=!0,j(x))},e.unstable_forceFrameRate=function(G){0>G||125<G?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):M=0<G?Math.floor(1e3/G):5},e.unstable_getCurrentPriorityLevel=function(){return f},e.unstable_getFirstCallbackNode=function(){return r(u)},e.unstable_next=function(G){switch(f){case 1:case 2:case 3:var $=3;break;default:$=f}var q=f;f=$;try{return G()}finally{f=q}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(G,$){switch(G){case 1:case 2:case 3:case 4:case 5:break;default:G=3}var q=f;f=G;try{return $()}finally{f=q}},e.unstable_scheduleCallback=function(G,$,q){var ee=e.unstable_now();switch(typeof q=="object"&&q!==null?(q=q.delay,q=typeof q=="number"&&0<q?ee+q:ee):q=ee,G){case 1:var fe=-1;break;case 2:fe=250;break;case 5:fe=1073741823;break;case 4:fe=1e4;break;default:fe=5e3}return fe=q+fe,G={id:c++,callback:$,priorityLevel:G,startTime:q,expirationTime:fe,sortIndex:-1},q>ee?(G.sortIndex=q,t(l,G),r(u)===null&&G===r(l)&&(h?(g(A),A=-1):h=!0,Y(S,q-ee))):(G.sortIndex=fe,t(u,G),v||p||(v=!0,j(x))),G},e.unstable_shouldYield=k,e.unstable_wrapCallback=function(G){var $=f;return function(){var q=f;f=$;try{return G.apply(this,arguments)}finally{f=q}}}})(aq);iq.exports=aq;var kse=iq.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var oq=_e,es=kse;function Tt(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,r=1;r<arguments.length;r++)t+="&args[]="+encodeURIComponent(arguments[r]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var sq=new Set,M1={};function Ev(e,t){Ag(e,t),Ag(e+"Capture",t)}function Ag(e,t){for(M1[e]=t,e=0;e<t.length;e++)sq.add(t[e])}var jc=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),bI=Object.prototype.hasOwnProperty,Ose=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,iN={},aN={};function Lse(e){return bI.call(aN,e)?!0:bI.call(iN,e)?!1:Ose.test(e)?aN[e]=!0:(iN[e]=!0,!1)}function Fse(e,t,r,n){if(r!==null&&r.type===0)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return n?!1:r!==null?!r.acceptsBooleans:(e=e.toLowerCase().slice(0,5),e!=="data-"&&e!=="aria-");default:return!1}}function Nse(e,t,r,n){if(t===null||typeof t>"u"||Fse(e,t,r,n))return!0;if(n)return!1;if(r!==null)switch(r.type){case 3:return!t;case 4:return t===!1;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}function so(e,t,r,n,i,a,o){this.acceptsBooleans=t===2||t===3||t===4,this.attributeName=n,this.attributeNamespace=i,this.mustUseProperty=r,this.propertyName=e,this.type=t,this.sanitizeURL=a,this.removeEmptyString=o}var ya={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){ya[e]=new so(e,0,!1,e,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];ya[t]=new so(t,1,!1,e[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(e){ya[e]=new so(e,2,!1,e.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){ya[e]=new so(e,2,!1,e,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){ya[e]=new so(e,3,!1,e.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(e){ya[e]=new so(e,3,!0,e,null,!1,!1)});["capture","download"].forEach(function(e){ya[e]=new so(e,4,!1,e,null,!1,!1)});["cols","rows","size","span"].forEach(function(e){ya[e]=new so(e,6,!1,e,null,!1,!1)});["rowSpan","start"].forEach(function(e){ya[e]=new so(e,5,!1,e.toLowerCase(),null,!1,!1)});var qR=/[\-:]([a-z])/g;function $R(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(qR,$R);ya[t]=new so(t,1,!1,e,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(qR,$R);ya[t]=new so(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(qR,$R);ya[t]=new so(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(e){ya[e]=new so(e,1,!1,e.toLowerCase(),null,!1,!1)});ya.xlinkHref=new so("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(e){ya[e]=new so(e,1,!1,e.toLowerCase(),null,!0,!0)});function WR(e,t,r,n){var i=ya.hasOwnProperty(t)?ya[t]:null;(i!==null?i.type!==0:n||!(2<t.length)||t[0]!=="o"&&t[0]!=="O"||t[1]!=="n"&&t[1]!=="N")&&(Nse(t,r,i,n)&&(r=null),n||i===null?Lse(t)&&(r===null?e.removeAttribute(t):e.setAttribute(t,""+r)):i.mustUseProperty?e[i.propertyName]=r===null?i.type===3?!1:"":r:(t=i.attributeName,n=i.attributeNamespace,r===null?e.removeAttribute(t):(i=i.type,r=i===3||i===4&&r===!0?"":""+r,n?e.setAttributeNS(n,t,r):e.setAttribute(t,r))))}var pd=oq.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,N2=Symbol.for("react.element"),Dm=Symbol.for("react.portal"),Rm=Symbol.for("react.fragment"),XR=Symbol.for("react.strict_mode"),xI=Symbol.for("react.profiler"),uq=Symbol.for("react.provider"),lq=Symbol.for("react.context"),YR=Symbol.for("react.forward_ref"),SI=Symbol.for("react.suspense"),CI=Symbol.for("react.suspense_list"),KR=Symbol.for("react.memo"),sf=Symbol.for("react.lazy"),cq=Symbol.for("react.offscreen"),oN=Symbol.iterator;function j0(e){return e===null||typeof e!="object"?null:(e=oN&&e[oN]||e["@@iterator"],typeof e=="function"?e:null)}var pi=Object.assign,LA;function Iy(e){if(LA===void 0)try{throw Error()}catch(r){var t=r.stack.trim().match(/\n( *(at )?)/);LA=t&&t[1]||""}return`
`+LA+e}var FA=!1;function NA(e,t){if(!e||FA)return"";FA=!0;var r=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(t,[])}catch(l){var n=l}Reflect.construct(e,[],t)}else{try{t.call()}catch(l){n=l}e.call(t.prototype)}else{try{throw Error()}catch(l){n=l}e()}}catch(l){if(l&&n&&typeof l.stack=="string"){for(var i=l.stack.split(`
`),a=n.stack.split(`
`),o=i.length-1,s=a.length-1;1<=o&&0<=s&&i[o]!==a[s];)s--;for(;1<=o&&0<=s;o--,s--)if(i[o]!==a[s]){if(o!==1||s!==1)do if(o--,s--,0>s||i[o]!==a[s]){var u=`
`+i[o].replace(" at new "," at ");return e.displayName&&u.includes("<anonymous>")&&(u=u.replace("<anonymous>",e.displayName)),u}while(1<=o&&0<=s);break}}}finally{FA=!1,Error.prepareStackTrace=r}return(e=e?e.displayName||e.name:"")?Iy(e):""}function Bse(e){switch(e.tag){case 5:return Iy(e.type);case 16:return Iy("Lazy");case 13:return Iy("Suspense");case 19:return Iy("SuspenseList");case 0:case 2:case 15:return e=NA(e.type,!1),e;case 11:return e=NA(e.type.render,!1),e;case 1:return e=NA(e.type,!0),e;default:return""}}function _I(e){if(e==null)return null;if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case Rm:return"Fragment";case Dm:return"Portal";case xI:return"Profiler";case XR:return"StrictMode";case SI:return"Suspense";case CI:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case lq:return(e.displayName||"Context")+".Consumer";case uq:return(e._context.displayName||"Context")+".Provider";case YR:var t=e.render;return e=e.displayName,e||(e=t.displayName||t.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case KR:return t=e.displayName||null,t!==null?t:_I(e.type)||"Memo";case sf:t=e._payload,e=e._init;try{return _I(e(t))}catch{}}return null}function Use(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=t.render,e=e.displayName||e.name||"",t.displayName||(e!==""?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return _I(t);case 8:return t===XR?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t}return null}function np(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function dq(e){var t=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(t==="checkbox"||t==="radio")}function jse(e){var t=dq(e)?"checked":"value",r=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),n=""+e[t];if(!e.hasOwnProperty(t)&&typeof r<"u"&&typeof r.get=="function"&&typeof r.set=="function"){var i=r.get,a=r.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return i.call(this)},set:function(o){n=""+o,a.call(this,o)}}),Object.defineProperty(e,t,{enumerable:r.enumerable}),{getValue:function(){return n},setValue:function(o){n=""+o},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}function B2(e){e._valueTracker||(e._valueTracker=jse(e))}function fq(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var r=t.getValue(),n="";return e&&(n=dq(e)?e.checked?"true":"false":e.value),e=n,e!==r?(t.setValue(e),!0):!1}function cC(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}function wI(e,t){var r=t.checked;return pi({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:r??e._wrapperState.initialChecked})}function sN(e,t){var r=t.defaultValue==null?"":t.defaultValue,n=t.checked!=null?t.checked:t.defaultChecked;r=np(t.value!=null?t.value:r),e._wrapperState={initialChecked:n,initialValue:r,controlled:t.type==="checkbox"||t.type==="radio"?t.checked!=null:t.value!=null}}function pq(e,t){t=t.checked,t!=null&&WR(e,"checked",t,!1)}function EI(e,t){pq(e,t);var r=np(t.value),n=t.type;if(r!=null)n==="number"?(r===0&&e.value===""||e.value!=r)&&(e.value=""+r):e.value!==""+r&&(e.value=""+r);else if(n==="submit"||n==="reset"){e.removeAttribute("value");return}t.hasOwnProperty("value")?AI(e,t.type,r):t.hasOwnProperty("defaultValue")&&AI(e,t.type,np(t.defaultValue)),t.checked==null&&t.defaultChecked!=null&&(e.defaultChecked=!!t.defaultChecked)}function uN(e,t,r){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var n=t.type;if(!(n!=="submit"&&n!=="reset"||t.value!==void 0&&t.value!==null))return;t=""+e._wrapperState.initialValue,r||t===e.value||(e.value=t),e.defaultValue=t}r=e.name,r!==""&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,r!==""&&(e.name=r)}function AI(e,t,r){(t!=="number"||cC(e.ownerDocument)!==e)&&(r==null?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+r&&(e.defaultValue=""+r))}var My=Array.isArray;function eg(e,t,r,n){if(e=e.options,t){t={};for(var i=0;i<r.length;i++)t["$"+r[i]]=!0;for(r=0;r<e.length;r++)i=t.hasOwnProperty("$"+e[r].value),e[r].selected!==i&&(e[r].selected=i),i&&n&&(e[r].defaultSelected=!0)}else{for(r=""+np(r),t=null,i=0;i<e.length;i++){if(e[i].value===r){e[i].selected=!0,n&&(e[i].defaultSelected=!0);return}t!==null||e[i].disabled||(t=e[i])}t!==null&&(t.selected=!0)}}function PI(e,t){if(t.dangerouslySetInnerHTML!=null)throw Error(Tt(91));return pi({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function lN(e,t){var r=t.value;if(r==null){if(r=t.children,t=t.defaultValue,r!=null){if(t!=null)throw Error(Tt(92));if(My(r)){if(1<r.length)throw Error(Tt(93));r=r[0]}t=r}t==null&&(t=""),r=t}e._wrapperState={initialValue:np(r)}}function hq(e,t){var r=np(t.value),n=np(t.defaultValue);r!=null&&(r=""+r,r!==e.value&&(e.value=r),t.defaultValue==null&&e.defaultValue!==r&&(e.defaultValue=r)),n!=null&&(e.defaultValue=""+n)}function cN(e){var t=e.textContent;t===e._wrapperState.initialValue&&t!==""&&t!==null&&(e.value=t)}function vq(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function TI(e,t){return e==null||e==="http://www.w3.org/1999/xhtml"?vq(t):e==="http://www.w3.org/2000/svg"&&t==="foreignObject"?"http://www.w3.org/1999/xhtml":e}var U2,mq=function(e){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(t,r,n,i){MSApp.execUnsafeLocalFunction(function(){return e(t,r,n,i)})}:e}(function(e,t){if(e.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in e)e.innerHTML=t;else{for(U2=U2||document.createElement("div"),U2.innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=U2.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}});function D1(e,t){if(t){var r=e.firstChild;if(r&&r===e.lastChild&&r.nodeType===3){r.nodeValue=t;return}}e.textContent=t}var Jy={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},zse=["Webkit","ms","Moz","O"];Object.keys(Jy).forEach(function(e){zse.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),Jy[t]=Jy[e]})});function gq(e,t,r){return t==null||typeof t=="boolean"||t===""?"":r||typeof t!="number"||t===0||Jy.hasOwnProperty(e)&&Jy[e]?(""+t).trim():t+"px"}function yq(e,t){e=e.style;for(var r in t)if(t.hasOwnProperty(r)){var n=r.indexOf("--")===0,i=gq(r,t[r],n);r==="float"&&(r="cssFloat"),n?e.setProperty(r,i):e[r]=i}}var Vse=pi({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function II(e,t){if(t){if(Vse[e]&&(t.children!=null||t.dangerouslySetInnerHTML!=null))throw Error(Tt(137,e));if(t.dangerouslySetInnerHTML!=null){if(t.children!=null)throw Error(Tt(60));if(typeof t.dangerouslySetInnerHTML!="object"||!("__html"in t.dangerouslySetInnerHTML))throw Error(Tt(61))}if(t.style!=null&&typeof t.style!="object")throw Error(Tt(62))}}function MI(e,t){if(e.indexOf("-")===-1)return typeof t.is=="string";switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var DI=null;function QR(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var RI=null,tg=null,rg=null;function dN(e){if(e=Ub(e)){if(typeof RI!="function")throw Error(Tt(280));var t=e.stateNode;t&&(t=Yw(t),RI(e.stateNode,e.type,t))}}function bq(e){tg?rg?rg.push(e):rg=[e]:tg=e}function xq(){if(tg){var e=tg,t=rg;if(rg=tg=null,dN(e),t)for(e=0;e<t.length;e++)dN(t[e])}}function Sq(e,t){return e(t)}function Cq(){}var BA=!1;function _q(e,t,r){if(BA)return e(t,r);BA=!0;try{return Sq(e,t,r)}finally{BA=!1,(tg!==null||rg!==null)&&(Cq(),xq())}}function R1(e,t){var r=e.stateNode;if(r===null)return null;var n=Yw(r);if(n===null)return null;r=n[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(n=!n.disabled)||(e=e.type,n=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!n;break e;default:e=!1}if(e)return null;if(r&&typeof r!="function")throw Error(Tt(231,t,typeof r));return r}var kI=!1;if(jc)try{var z0={};Object.defineProperty(z0,"passive",{get:function(){kI=!0}}),window.addEventListener("test",z0,z0),window.removeEventListener("test",z0,z0)}catch{kI=!1}function Hse(e,t,r,n,i,a,o,s,u){var l=Array.prototype.slice.call(arguments,3);try{t.apply(r,l)}catch(c){this.onError(c)}}var e1=!1,dC=null,fC=!1,OI=null,Gse={onError:function(e){e1=!0,dC=e}};function qse(e,t,r,n,i,a,o,s,u){e1=!1,dC=null,Hse.apply(Gse,arguments)}function $se(e,t,r,n,i,a,o,s,u){if(qse.apply(this,arguments),e1){if(e1){var l=dC;e1=!1,dC=null}else throw Error(Tt(198));fC||(fC=!0,OI=l)}}function Av(e){var t=e,r=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do t=e,t.flags&4098&&(r=t.return),e=t.return;while(e)}return t.tag===3?r:null}function wq(e){if(e.tag===13){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function fN(e){if(Av(e)!==e)throw Error(Tt(188))}function Wse(e){var t=e.alternate;if(!t){if(t=Av(e),t===null)throw Error(Tt(188));return t!==e?null:e}for(var r=e,n=t;;){var i=r.return;if(i===null)break;var a=i.alternate;if(a===null){if(n=i.return,n!==null){r=n;continue}break}if(i.child===a.child){for(a=i.child;a;){if(a===r)return fN(i),e;if(a===n)return fN(i),t;a=a.sibling}throw Error(Tt(188))}if(r.return!==n.return)r=i,n=a;else{for(var o=!1,s=i.child;s;){if(s===r){o=!0,r=i,n=a;break}if(s===n){o=!0,n=i,r=a;break}s=s.sibling}if(!o){for(s=a.child;s;){if(s===r){o=!0,r=a,n=i;break}if(s===n){o=!0,n=a,r=i;break}s=s.sibling}if(!o)throw Error(Tt(189))}}if(r.alternate!==n)throw Error(Tt(190))}if(r.tag!==3)throw Error(Tt(188));return r.stateNode.current===r?e:t}function Eq(e){return e=Wse(e),e!==null?Aq(e):null}function Aq(e){if(e.tag===5||e.tag===6)return e;for(e=e.child;e!==null;){var t=Aq(e);if(t!==null)return t;e=e.sibling}return null}var Pq=es.unstable_scheduleCallback,pN=es.unstable_cancelCallback,Xse=es.unstable_shouldYield,Yse=es.unstable_requestPaint,wi=es.unstable_now,Kse=es.unstable_getCurrentPriorityLevel,ZR=es.unstable_ImmediatePriority,Tq=es.unstable_UserBlockingPriority,pC=es.unstable_NormalPriority,Qse=es.unstable_LowPriority,Iq=es.unstable_IdlePriority,qw=null,El=null;function Zse(e){if(El&&typeof El.onCommitFiberRoot=="function")try{El.onCommitFiberRoot(qw,e,void 0,(e.current.flags&128)===128)}catch{}}var wu=Math.clz32?Math.clz32:tue,Jse=Math.log,eue=Math.LN2;function tue(e){return e>>>=0,e===0?32:31-(Jse(e)/eue|0)|0}var j2=64,z2=4194304;function Dy(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return e&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function hC(e,t){var r=e.pendingLanes;if(r===0)return 0;var n=0,i=e.suspendedLanes,a=e.pingedLanes,o=r&268435455;if(o!==0){var s=o&~i;s!==0?n=Dy(s):(a&=o,a!==0&&(n=Dy(a)))}else o=r&~i,o!==0?n=Dy(o):a!==0&&(n=Dy(a));if(n===0)return 0;if(t!==0&&t!==n&&!(t&i)&&(i=n&-n,a=t&-t,i>=a||i===16&&(a&4194240)!==0))return t;if(n&4&&(n|=r&16),t=e.entangledLanes,t!==0)for(e=e.entanglements,t&=n;0<t;)r=31-wu(t),i=1<<r,n|=e[r],t&=~i;return n}function rue(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function nue(e,t){for(var r=e.suspendedLanes,n=e.pingedLanes,i=e.expirationTimes,a=e.pendingLanes;0<a;){var o=31-wu(a),s=1<<o,u=i[o];u===-1?(!(s&r)||s&n)&&(i[o]=rue(s,t)):u<=t&&(e.expiredLanes|=s),a&=~s}}function LI(e){return e=e.pendingLanes&-1073741825,e!==0?e:e&1073741824?1073741824:0}function Mq(){var e=j2;return j2<<=1,!(j2&4194240)&&(j2=64),e}function UA(e){for(var t=[],r=0;31>r;r++)t.push(e);return t}function Nb(e,t,r){e.pendingLanes|=t,t!==536870912&&(e.suspendedLanes=0,e.pingedLanes=0),e=e.eventTimes,t=31-wu(t),e[t]=r}function iue(e,t){var r=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var n=e.eventTimes;for(e=e.expirationTimes;0<r;){var i=31-wu(r),a=1<<i;t[i]=0,n[i]=-1,e[i]=-1,r&=~a}}function JR(e,t){var r=e.entangledLanes|=t;for(e=e.entanglements;r;){var n=31-wu(r),i=1<<n;i&t|e[n]&t&&(e[n]|=t),r&=~i}}var En=0;function Dq(e){return e&=-e,1<e?4<e?e&268435455?16:536870912:4:1}var Rq,ek,kq,Oq,Lq,FI=!1,V2=[],Bf=null,Uf=null,jf=null,k1=new Map,O1=new Map,df=[],aue="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function hN(e,t){switch(e){case"focusin":case"focusout":Bf=null;break;case"dragenter":case"dragleave":Uf=null;break;case"mouseover":case"mouseout":jf=null;break;case"pointerover":case"pointerout":k1.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":O1.delete(t.pointerId)}}function V0(e,t,r,n,i,a){return e===null||e.nativeEvent!==a?(e={blockedOn:t,domEventName:r,eventSystemFlags:n,nativeEvent:a,targetContainers:[i]},t!==null&&(t=Ub(t),t!==null&&ek(t)),e):(e.eventSystemFlags|=n,t=e.targetContainers,i!==null&&t.indexOf(i)===-1&&t.push(i),e)}function oue(e,t,r,n,i){switch(t){case"focusin":return Bf=V0(Bf,e,t,r,n,i),!0;case"dragenter":return Uf=V0(Uf,e,t,r,n,i),!0;case"mouseover":return jf=V0(jf,e,t,r,n,i),!0;case"pointerover":var a=i.pointerId;return k1.set(a,V0(k1.get(a)||null,e,t,r,n,i)),!0;case"gotpointercapture":return a=i.pointerId,O1.set(a,V0(O1.get(a)||null,e,t,r,n,i)),!0}return!1}function Fq(e){var t=yh(e.target);if(t!==null){var r=Av(t);if(r!==null){if(t=r.tag,t===13){if(t=wq(r),t!==null){e.blockedOn=t,Lq(e.priority,function(){kq(r)});return}}else if(t===3&&r.stateNode.current.memoizedState.isDehydrated){e.blockedOn=r.tag===3?r.stateNode.containerInfo:null;return}}}e.blockedOn=null}function CS(e){if(e.blockedOn!==null)return!1;for(var t=e.targetContainers;0<t.length;){var r=NI(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(r===null){r=e.nativeEvent;var n=new r.constructor(r.type,r);DI=n,r.target.dispatchEvent(n),DI=null}else return t=Ub(r),t!==null&&ek(t),e.blockedOn=r,!1;t.shift()}return!0}function vN(e,t,r){CS(e)&&r.delete(t)}function sue(){FI=!1,Bf!==null&&CS(Bf)&&(Bf=null),Uf!==null&&CS(Uf)&&(Uf=null),jf!==null&&CS(jf)&&(jf=null),k1.forEach(vN),O1.forEach(vN)}function H0(e,t){e.blockedOn===t&&(e.blockedOn=null,FI||(FI=!0,es.unstable_scheduleCallback(es.unstable_NormalPriority,sue)))}function L1(e){function t(i){return H0(i,e)}if(0<V2.length){H0(V2[0],e);for(var r=1;r<V2.length;r++){var n=V2[r];n.blockedOn===e&&(n.blockedOn=null)}}for(Bf!==null&&H0(Bf,e),Uf!==null&&H0(Uf,e),jf!==null&&H0(jf,e),k1.forEach(t),O1.forEach(t),r=0;r<df.length;r++)n=df[r],n.blockedOn===e&&(n.blockedOn=null);for(;0<df.length&&(r=df[0],r.blockedOn===null);)Fq(r),r.blockedOn===null&&df.shift()}var ng=pd.ReactCurrentBatchConfig,vC=!0;function uue(e,t,r,n){var i=En,a=ng.transition;ng.transition=null;try{En=1,tk(e,t,r,n)}finally{En=i,ng.transition=a}}function lue(e,t,r,n){var i=En,a=ng.transition;ng.transition=null;try{En=4,tk(e,t,r,n)}finally{En=i,ng.transition=a}}function tk(e,t,r,n){if(vC){var i=NI(e,t,r,n);if(i===null)YA(e,t,n,mC,r),hN(e,n);else if(oue(i,e,t,r,n))n.stopPropagation();else if(hN(e,n),t&4&&-1<aue.indexOf(e)){for(;i!==null;){var a=Ub(i);if(a!==null&&Rq(a),a=NI(e,t,r,n),a===null&&YA(e,t,n,mC,r),a===i)break;i=a}i!==null&&n.stopPropagation()}else YA(e,t,n,null,r)}}var mC=null;function NI(e,t,r,n){if(mC=null,e=QR(n),e=yh(e),e!==null)if(t=Av(e),t===null)e=null;else if(r=t.tag,r===13){if(e=wq(t),e!==null)return e;e=null}else if(r===3){if(t.stateNode.current.memoizedState.isDehydrated)return t.tag===3?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return mC=e,null}function Nq(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Kse()){case ZR:return 1;case Tq:return 4;case pC:case Qse:return 16;case Iq:return 536870912;default:return 16}default:return 16}}var Pf=null,rk=null,_S=null;function Bq(){if(_S)return _S;var e,t=rk,r=t.length,n,i="value"in Pf?Pf.value:Pf.textContent,a=i.length;for(e=0;e<r&&t[e]===i[e];e++);var o=r-e;for(n=1;n<=o&&t[r-n]===i[a-n];n++);return _S=i.slice(e,1<n?1-n:void 0)}function wS(e){var t=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&t===13&&(e=13)):e=t,e===10&&(e=13),32<=e||e===13?e:0}function H2(){return!0}function mN(){return!1}function ds(e){function t(r,n,i,a,o){this._reactName=r,this._targetInst=i,this.type=n,this.nativeEvent=a,this.target=o,this.currentTarget=null;for(var s in e)e.hasOwnProperty(s)&&(r=e[s],this[s]=r?r(a):a[s]);return this.isDefaultPrevented=(a.defaultPrevented!=null?a.defaultPrevented:a.returnValue===!1)?H2:mN,this.isPropagationStopped=mN,this}return pi(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var r=this.nativeEvent;r&&(r.preventDefault?r.preventDefault():typeof r.returnValue!="unknown"&&(r.returnValue=!1),this.isDefaultPrevented=H2)},stopPropagation:function(){var r=this.nativeEvent;r&&(r.stopPropagation?r.stopPropagation():typeof r.cancelBubble!="unknown"&&(r.cancelBubble=!0),this.isPropagationStopped=H2)},persist:function(){},isPersistent:H2}),t}var n0={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},nk=ds(n0),Bb=pi({},n0,{view:0,detail:0}),cue=ds(Bb),jA,zA,G0,$w=pi({},Bb,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:ik,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==G0&&(G0&&e.type==="mousemove"?(jA=e.screenX-G0.screenX,zA=e.screenY-G0.screenY):zA=jA=0,G0=e),jA)},movementY:function(e){return"movementY"in e?e.movementY:zA}}),gN=ds($w),due=pi({},$w,{dataTransfer:0}),fue=ds(due),pue=pi({},Bb,{relatedTarget:0}),VA=ds(pue),hue=pi({},n0,{animationName:0,elapsedTime:0,pseudoElement:0}),vue=ds(hue),mue=pi({},n0,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),gue=ds(mue),yue=pi({},n0,{data:0}),yN=ds(yue),bue={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},xue={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Sue={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Cue(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):(e=Sue[e])?!!t[e]:!1}function ik(){return Cue}var _ue=pi({},Bb,{key:function(e){if(e.key){var t=bue[e.key]||e.key;if(t!=="Unidentified")return t}return e.type==="keypress"?(e=wS(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?xue[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:ik,charCode:function(e){return e.type==="keypress"?wS(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?wS(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),wue=ds(_ue),Eue=pi({},$w,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),bN=ds(Eue),Aue=pi({},Bb,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:ik}),Pue=ds(Aue),Tue=pi({},n0,{propertyName:0,elapsedTime:0,pseudoElement:0}),Iue=ds(Tue),Mue=pi({},$w,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),Due=ds(Mue),Rue=[9,13,27,32],ak=jc&&"CompositionEvent"in window,t1=null;jc&&"documentMode"in document&&(t1=document.documentMode);var kue=jc&&"TextEvent"in window&&!t1,Uq=jc&&(!ak||t1&&8<t1&&11>=t1),xN=String.fromCharCode(32),SN=!1;function jq(e,t){switch(e){case"keyup":return Rue.indexOf(t.keyCode)!==-1;case"keydown":return t.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function zq(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var km=!1;function Oue(e,t){switch(e){case"compositionend":return zq(t);case"keypress":return t.which!==32?null:(SN=!0,xN);case"textInput":return e=t.data,e===xN&&SN?null:e;default:return null}}function Lue(e,t){if(km)return e==="compositionend"||!ak&&jq(e,t)?(e=Bq(),_S=rk=Pf=null,km=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Uq&&t.locale!=="ko"?null:t.data;default:return null}}var Fue={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function CN(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t==="input"?!!Fue[e.type]:t==="textarea"}function Vq(e,t,r,n){bq(n),t=gC(t,"onChange"),0<t.length&&(r=new nk("onChange","change",null,r,n),e.push({event:r,listeners:t}))}var r1=null,F1=null;function Nue(e){Jq(e,0)}function Ww(e){var t=Fm(e);if(fq(t))return e}function Bue(e,t){if(e==="change")return t}var Hq=!1;if(jc){var HA;if(jc){var GA="oninput"in document;if(!GA){var _N=document.createElement("div");_N.setAttribute("oninput","return;"),GA=typeof _N.oninput=="function"}HA=GA}else HA=!1;Hq=HA&&(!document.documentMode||9<document.documentMode)}function wN(){r1&&(r1.detachEvent("onpropertychange",Gq),F1=r1=null)}function Gq(e){if(e.propertyName==="value"&&Ww(F1)){var t=[];Vq(t,F1,e,QR(e)),_q(Nue,t)}}function Uue(e,t,r){e==="focusin"?(wN(),r1=t,F1=r,r1.attachEvent("onpropertychange",Gq)):e==="focusout"&&wN()}function jue(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return Ww(F1)}function zue(e,t){if(e==="click")return Ww(t)}function Vue(e,t){if(e==="input"||e==="change")return Ww(t)}function Hue(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var Fu=typeof Object.is=="function"?Object.is:Hue;function N1(e,t){if(Fu(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;var r=Object.keys(e),n=Object.keys(t);if(r.length!==n.length)return!1;for(n=0;n<r.length;n++){var i=r[n];if(!bI.call(t,i)||!Fu(e[i],t[i]))return!1}return!0}function EN(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function AN(e,t){var r=EN(e);e=0;for(var n;r;){if(r.nodeType===3){if(n=e+r.textContent.length,e<=t&&n>=t)return{node:r,offset:t-e};e=n}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=EN(r)}}function qq(e,t){return e&&t?e===t?!0:e&&e.nodeType===3?!1:t&&t.nodeType===3?qq(e,t.parentNode):"contains"in e?e.contains(t):e.compareDocumentPosition?!!(e.compareDocumentPosition(t)&16):!1:!1}function $q(){for(var e=window,t=cC();t instanceof e.HTMLIFrameElement;){try{var r=typeof t.contentWindow.location.href=="string"}catch{r=!1}if(r)e=t.contentWindow;else break;t=cC(e.document)}return t}function ok(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&(t==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||t==="textarea"||e.contentEditable==="true")}function Gue(e){var t=$q(),r=e.focusedElem,n=e.selectionRange;if(t!==r&&r&&r.ownerDocument&&qq(r.ownerDocument.documentElement,r)){if(n!==null&&ok(r)){if(t=n.start,e=n.end,e===void 0&&(e=t),"selectionStart"in r)r.selectionStart=t,r.selectionEnd=Math.min(e,r.value.length);else if(e=(t=r.ownerDocument||document)&&t.defaultView||window,e.getSelection){e=e.getSelection();var i=r.textContent.length,a=Math.min(n.start,i);n=n.end===void 0?a:Math.min(n.end,i),!e.extend&&a>n&&(i=n,n=a,a=i),i=AN(r,a);var o=AN(r,n);i&&o&&(e.rangeCount!==1||e.anchorNode!==i.node||e.anchorOffset!==i.offset||e.focusNode!==o.node||e.focusOffset!==o.offset)&&(t=t.createRange(),t.setStart(i.node,i.offset),e.removeAllRanges(),a>n?(e.addRange(t),e.extend(o.node,o.offset)):(t.setEnd(o.node,o.offset),e.addRange(t)))}}for(t=[],e=r;e=e.parentNode;)e.nodeType===1&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for(typeof r.focus=="function"&&r.focus(),r=0;r<t.length;r++)e=t[r],e.element.scrollLeft=e.left,e.element.scrollTop=e.top}}var que=jc&&"documentMode"in document&&11>=document.documentMode,Om=null,BI=null,n1=null,UI=!1;function PN(e,t,r){var n=r.window===r?r.document:r.nodeType===9?r:r.ownerDocument;UI||Om==null||Om!==cC(n)||(n=Om,"selectionStart"in n&&ok(n)?n={start:n.selectionStart,end:n.selectionEnd}:(n=(n.ownerDocument&&n.ownerDocument.defaultView||window).getSelection(),n={anchorNode:n.anchorNode,anchorOffset:n.anchorOffset,focusNode:n.focusNode,focusOffset:n.focusOffset}),n1&&N1(n1,n)||(n1=n,n=gC(BI,"onSelect"),0<n.length&&(t=new nk("onSelect","select",null,t,r),e.push({event:t,listeners:n}),t.target=Om)))}function G2(e,t){var r={};return r[e.toLowerCase()]=t.toLowerCase(),r["Webkit"+e]="webkit"+t,r["Moz"+e]="moz"+t,r}var Lm={animationend:G2("Animation","AnimationEnd"),animationiteration:G2("Animation","AnimationIteration"),animationstart:G2("Animation","AnimationStart"),transitionend:G2("Transition","TransitionEnd")},qA={},Wq={};jc&&(Wq=document.createElement("div").style,"AnimationEvent"in window||(delete Lm.animationend.animation,delete Lm.animationiteration.animation,delete Lm.animationstart.animation),"TransitionEvent"in window||delete Lm.transitionend.transition);function Xw(e){if(qA[e])return qA[e];if(!Lm[e])return e;var t=Lm[e],r;for(r in t)if(t.hasOwnProperty(r)&&r in Wq)return qA[e]=t[r];return e}var Xq=Xw("animationend"),Yq=Xw("animationiteration"),Kq=Xw("animationstart"),Qq=Xw("transitionend"),Zq=new Map,TN="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Cp(e,t){Zq.set(e,t),Ev(t,[e])}for(var $A=0;$A<TN.length;$A++){var WA=TN[$A],$ue=WA.toLowerCase(),Wue=WA[0].toUpperCase()+WA.slice(1);Cp($ue,"on"+Wue)}Cp(Xq,"onAnimationEnd");Cp(Yq,"onAnimationIteration");Cp(Kq,"onAnimationStart");Cp("dblclick","onDoubleClick");Cp("focusin","onFocus");Cp("focusout","onBlur");Cp(Qq,"onTransitionEnd");Ag("onMouseEnter",["mouseout","mouseover"]);Ag("onMouseLeave",["mouseout","mouseover"]);Ag("onPointerEnter",["pointerout","pointerover"]);Ag("onPointerLeave",["pointerout","pointerover"]);Ev("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Ev("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Ev("onBeforeInput",["compositionend","keypress","textInput","paste"]);Ev("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Ev("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Ev("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Ry="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Xue=new Set("cancel close invalid load scroll toggle".split(" ").concat(Ry));function IN(e,t,r){var n=e.type||"unknown-event";e.currentTarget=r,$se(n,t,void 0,e),e.currentTarget=null}function Jq(e,t){t=(t&4)!==0;for(var r=0;r<e.length;r++){var n=e[r],i=n.event;n=n.listeners;e:{var a=void 0;if(t)for(var o=n.length-1;0<=o;o--){var s=n[o],u=s.instance,l=s.currentTarget;if(s=s.listener,u!==a&&i.isPropagationStopped())break e;IN(i,s,l),a=u}else for(o=0;o<n.length;o++){if(s=n[o],u=s.instance,l=s.currentTarget,s=s.listener,u!==a&&i.isPropagationStopped())break e;IN(i,s,l),a=u}}}if(fC)throw e=OI,fC=!1,OI=null,e}function Vn(e,t){var r=t[GI];r===void 0&&(r=t[GI]=new Set);var n=e+"__bubble";r.has(n)||(e$(t,e,2,!1),r.add(n))}function XA(e,t,r){var n=0;t&&(n|=4),e$(r,e,n,t)}var q2="_reactListening"+Math.random().toString(36).slice(2);function B1(e){if(!e[q2]){e[q2]=!0,sq.forEach(function(r){r!=="selectionchange"&&(Xue.has(r)||XA(r,!1,e),XA(r,!0,e))});var t=e.nodeType===9?e:e.ownerDocument;t===null||t[q2]||(t[q2]=!0,XA("selectionchange",!1,t))}}function e$(e,t,r,n){switch(Nq(t)){case 1:var i=uue;break;case 4:i=lue;break;default:i=tk}r=i.bind(null,t,r,e),i=void 0,!kI||t!=="touchstart"&&t!=="touchmove"&&t!=="wheel"||(i=!0),n?i!==void 0?e.addEventListener(t,r,{capture:!0,passive:i}):e.addEventListener(t,r,!0):i!==void 0?e.addEventListener(t,r,{passive:i}):e.addEventListener(t,r,!1)}function YA(e,t,r,n,i){var a=n;if(!(t&1)&&!(t&2)&&n!==null)e:for(;;){if(n===null)return;var o=n.tag;if(o===3||o===4){var s=n.stateNode.containerInfo;if(s===i||s.nodeType===8&&s.parentNode===i)break;if(o===4)for(o=n.return;o!==null;){var u=o.tag;if((u===3||u===4)&&(u=o.stateNode.containerInfo,u===i||u.nodeType===8&&u.parentNode===i))return;o=o.return}for(;s!==null;){if(o=yh(s),o===null)return;if(u=o.tag,u===5||u===6){n=a=o;continue e}s=s.parentNode}}n=n.return}_q(function(){var l=a,c=QR(r),d=[];e:{var f=Zq.get(e);if(f!==void 0){var p=nk,v=e;switch(e){case"keypress":if(wS(r)===0)break e;case"keydown":case"keyup":p=wue;break;case"focusin":v="focus",p=VA;break;case"focusout":v="blur",p=VA;break;case"beforeblur":case"afterblur":p=VA;break;case"click":if(r.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":p=gN;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":p=fue;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":p=Pue;break;case Xq:case Yq:case Kq:p=vue;break;case Qq:p=Iue;break;case"scroll":p=cue;break;case"wheel":p=Due;break;case"copy":case"cut":case"paste":p=gue;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":p=bN}var h=(t&4)!==0,m=!h&&e==="scroll",g=h?f!==null?f+"Capture":null:f;h=[];for(var y=l,b;y!==null;){b=y;var S=b.stateNode;if(b.tag===5&&S!==null&&(b=S,g!==null&&(S=R1(y,g),S!=null&&h.push(U1(y,S,b)))),m)break;y=y.return}0<h.length&&(f=new p(f,v,null,r,c),d.push({event:f,listeners:h}))}}if(!(t&7)){e:{if(f=e==="mouseover"||e==="pointerover",p=e==="mouseout"||e==="pointerout",f&&r!==DI&&(v=r.relatedTarget||r.fromElement)&&(yh(v)||v[zc]))break e;if((p||f)&&(f=c.window===c?c:(f=c.ownerDocument)?f.defaultView||f.parentWindow:window,p?(v=r.relatedTarget||r.toElement,p=l,v=v?yh(v):null,v!==null&&(m=Av(v),v!==m||v.tag!==5&&v.tag!==6)&&(v=null)):(p=null,v=l),p!==v)){if(h=gN,S="onMouseLeave",g="onMouseEnter",y="mouse",(e==="pointerout"||e==="pointerover")&&(h=bN,S="onPointerLeave",g="onPointerEnter",y="pointer"),m=p==null?f:Fm(p),b=v==null?f:Fm(v),f=new h(S,y+"leave",p,r,c),f.target=m,f.relatedTarget=b,S=null,yh(c)===l&&(h=new h(g,y+"enter",v,r,c),h.target=b,h.relatedTarget=m,S=h),m=S,p&&v)t:{for(h=p,g=v,y=0,b=h;b;b=im(b))y++;for(b=0,S=g;S;S=im(S))b++;for(;0<y-b;)h=im(h),y--;for(;0<b-y;)g=im(g),b--;for(;y--;){if(h===g||g!==null&&h===g.alternate)break t;h=im(h),g=im(g)}h=null}else h=null;p!==null&&MN(d,f,p,h,!1),v!==null&&m!==null&&MN(d,m,v,h,!0)}}e:{if(f=l?Fm(l):window,p=f.nodeName&&f.nodeName.toLowerCase(),p==="select"||p==="input"&&f.type==="file")var x=Bue;else if(CN(f))if(Hq)x=Vue;else{x=jue;var C=Uue}else(p=f.nodeName)&&p.toLowerCase()==="input"&&(f.type==="checkbox"||f.type==="radio")&&(x=zue);if(x&&(x=x(e,l))){Vq(d,x,r,c);break e}C&&C(e,f,l),e==="focusout"&&(C=f._wrapperState)&&C.controlled&&f.type==="number"&&AI(f,"number",f.value)}switch(C=l?Fm(l):window,e){case"focusin":(CN(C)||C.contentEditable==="true")&&(Om=C,BI=l,n1=null);break;case"focusout":n1=BI=Om=null;break;case"mousedown":UI=!0;break;case"contextmenu":case"mouseup":case"dragend":UI=!1,PN(d,r,c);break;case"selectionchange":if(que)break;case"keydown":case"keyup":PN(d,r,c)}var w;if(ak)e:{switch(e){case"compositionstart":var A="onCompositionStart";break e;case"compositionend":A="onCompositionEnd";break e;case"compositionupdate":A="onCompositionUpdate";break e}A=void 0}else km?jq(e,r)&&(A="onCompositionEnd"):e==="keydown"&&r.keyCode===229&&(A="onCompositionStart");A&&(Uq&&r.locale!=="ko"&&(km||A!=="onCompositionStart"?A==="onCompositionEnd"&&km&&(w=Bq()):(Pf=c,rk="value"in Pf?Pf.value:Pf.textContent,km=!0)),C=gC(l,A),0<C.length&&(A=new yN(A,e,null,r,c),d.push({event:A,listeners:C}),w?A.data=w:(w=zq(r),w!==null&&(A.data=w)))),(w=kue?Oue(e,r):Lue(e,r))&&(l=gC(l,"onBeforeInput"),0<l.length&&(c=new yN("onBeforeInput","beforeinput",null,r,c),d.push({event:c,listeners:l}),c.data=w))}Jq(d,t)})}function U1(e,t,r){return{instance:e,listener:t,currentTarget:r}}function gC(e,t){for(var r=t+"Capture",n=[];e!==null;){var i=e,a=i.stateNode;i.tag===5&&a!==null&&(i=a,a=R1(e,r),a!=null&&n.unshift(U1(e,a,i)),a=R1(e,t),a!=null&&n.push(U1(e,a,i))),e=e.return}return n}function im(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5);return e||null}function MN(e,t,r,n,i){for(var a=t._reactName,o=[];r!==null&&r!==n;){var s=r,u=s.alternate,l=s.stateNode;if(u!==null&&u===n)break;s.tag===5&&l!==null&&(s=l,i?(u=R1(r,a),u!=null&&o.unshift(U1(r,u,s))):i||(u=R1(r,a),u!=null&&o.push(U1(r,u,s)))),r=r.return}o.length!==0&&e.push({event:t,listeners:o})}var Yue=/\r\n?/g,Kue=/\u0000|\uFFFD/g;function DN(e){return(typeof e=="string"?e:""+e).replace(Yue,`
`).replace(Kue,"")}function $2(e,t,r){if(t=DN(t),DN(e)!==t&&r)throw Error(Tt(425))}function yC(){}var jI=null,zI=null;function VI(e,t){return e==="textarea"||e==="noscript"||typeof t.children=="string"||typeof t.children=="number"||typeof t.dangerouslySetInnerHTML=="object"&&t.dangerouslySetInnerHTML!==null&&t.dangerouslySetInnerHTML.__html!=null}var HI=typeof setTimeout=="function"?setTimeout:void 0,Que=typeof clearTimeout=="function"?clearTimeout:void 0,RN=typeof Promise=="function"?Promise:void 0,Zue=typeof queueMicrotask=="function"?queueMicrotask:typeof RN<"u"?function(e){return RN.resolve(null).then(e).catch(Jue)}:HI;function Jue(e){setTimeout(function(){throw e})}function KA(e,t){var r=t,n=0;do{var i=r.nextSibling;if(e.removeChild(r),i&&i.nodeType===8)if(r=i.data,r==="/$"){if(n===0){e.removeChild(i),L1(t);return}n--}else r!=="$"&&r!=="$?"&&r!=="$!"||n++;r=i}while(r);L1(t)}function zf(e){for(;e!=null;e=e.nextSibling){var t=e.nodeType;if(t===1||t===3)break;if(t===8){if(t=e.data,t==="$"||t==="$!"||t==="$?")break;if(t==="/$")return null}}return e}function kN(e){e=e.previousSibling;for(var t=0;e;){if(e.nodeType===8){var r=e.data;if(r==="$"||r==="$!"||r==="$?"){if(t===0)return e;t--}else r==="/$"&&t++}e=e.previousSibling}return null}var i0=Math.random().toString(36).slice(2),yl="__reactFiber$"+i0,j1="__reactProps$"+i0,zc="__reactContainer$"+i0,GI="__reactEvents$"+i0,ele="__reactListeners$"+i0,tle="__reactHandles$"+i0;function yh(e){var t=e[yl];if(t)return t;for(var r=e.parentNode;r;){if(t=r[zc]||r[yl]){if(r=t.alternate,t.child!==null||r!==null&&r.child!==null)for(e=kN(e);e!==null;){if(r=e[yl])return r;e=kN(e)}return t}e=r,r=e.parentNode}return null}function Ub(e){return e=e[yl]||e[zc],!e||e.tag!==5&&e.tag!==6&&e.tag!==13&&e.tag!==3?null:e}function Fm(e){if(e.tag===5||e.tag===6)return e.stateNode;throw Error(Tt(33))}function Yw(e){return e[j1]||null}var qI=[],Nm=-1;function _p(e){return{current:e}}function Xn(e){0>Nm||(e.current=qI[Nm],qI[Nm]=null,Nm--)}function Bn(e,t){Nm++,qI[Nm]=e.current,e.current=t}var ip={},za=_p(ip),Co=_p(!1),qh=ip;function Pg(e,t){var r=e.type.contextTypes;if(!r)return ip;var n=e.stateNode;if(n&&n.__reactInternalMemoizedUnmaskedChildContext===t)return n.__reactInternalMemoizedMaskedChildContext;var i={},a;for(a in r)i[a]=t[a];return n&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=i),i}function _o(e){return e=e.childContextTypes,e!=null}function bC(){Xn(Co),Xn(za)}function ON(e,t,r){if(za.current!==ip)throw Error(Tt(168));Bn(za,t),Bn(Co,r)}function t$(e,t,r){var n=e.stateNode;if(t=t.childContextTypes,typeof n.getChildContext!="function")return r;n=n.getChildContext();for(var i in n)if(!(i in t))throw Error(Tt(108,Use(e)||"Unknown",i));return pi({},r,n)}function xC(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||ip,qh=za.current,Bn(za,e),Bn(Co,Co.current),!0}function LN(e,t,r){var n=e.stateNode;if(!n)throw Error(Tt(169));r?(e=t$(e,t,qh),n.__reactInternalMemoizedMergedChildContext=e,Xn(Co),Xn(za),Bn(za,e)):Xn(Co),Bn(Co,r)}var vc=null,Kw=!1,QA=!1;function r$(e){vc===null?vc=[e]:vc.push(e)}function rle(e){Kw=!0,r$(e)}function wp(){if(!QA&&vc!==null){QA=!0;var e=0,t=En;try{var r=vc;for(En=1;e<r.length;e++){var n=r[e];do n=n(!0);while(n!==null)}vc=null,Kw=!1}catch(i){throw vc!==null&&(vc=vc.slice(e+1)),Pq(ZR,wp),i}finally{En=t,QA=!1}}return null}var Bm=[],Um=0,SC=null,CC=0,Os=[],Ls=0,$h=null,Sc=1,Cc="";function nh(e,t){Bm[Um++]=CC,Bm[Um++]=SC,SC=e,CC=t}function n$(e,t,r){Os[Ls++]=Sc,Os[Ls++]=Cc,Os[Ls++]=$h,$h=e;var n=Sc;e=Cc;var i=32-wu(n)-1;n&=~(1<<i),r+=1;var a=32-wu(t)+i;if(30<a){var o=i-i%5;a=(n&(1<<o)-1).toString(32),n>>=o,i-=o,Sc=1<<32-wu(t)+i|r<<i|n,Cc=a+e}else Sc=1<<a|r<<i|n,Cc=e}function sk(e){e.return!==null&&(nh(e,1),n$(e,1,0))}function uk(e){for(;e===SC;)SC=Bm[--Um],Bm[Um]=null,CC=Bm[--Um],Bm[Um]=null;for(;e===$h;)$h=Os[--Ls],Os[Ls]=null,Cc=Os[--Ls],Os[Ls]=null,Sc=Os[--Ls],Os[Ls]=null}var Ko=null,$o=null,ni=!1,vu=null;function i$(e,t){var r=Ns(5,null,null,0);r.elementType="DELETED",r.stateNode=t,r.return=e,t=e.deletions,t===null?(e.deletions=[r],e.flags|=16):t.push(r)}function FN(e,t){switch(e.tag){case 5:var r=e.type;return t=t.nodeType!==1||r.toLowerCase()!==t.nodeName.toLowerCase()?null:t,t!==null?(e.stateNode=t,Ko=e,$o=zf(t.firstChild),!0):!1;case 6:return t=e.pendingProps===""||t.nodeType!==3?null:t,t!==null?(e.stateNode=t,Ko=e,$o=null,!0):!1;case 13:return t=t.nodeType!==8?null:t,t!==null?(r=$h!==null?{id:Sc,overflow:Cc}:null,e.memoizedState={dehydrated:t,treeContext:r,retryLane:1073741824},r=Ns(18,null,null,0),r.stateNode=t,r.return=e,e.child=r,Ko=e,$o=null,!0):!1;default:return!1}}function $I(e){return(e.mode&1)!==0&&(e.flags&128)===0}function WI(e){if(ni){var t=$o;if(t){var r=t;if(!FN(e,t)){if($I(e))throw Error(Tt(418));t=zf(r.nextSibling);var n=Ko;t&&FN(e,t)?i$(n,r):(e.flags=e.flags&-4097|2,ni=!1,Ko=e)}}else{if($I(e))throw Error(Tt(418));e.flags=e.flags&-4097|2,ni=!1,Ko=e}}}function NN(e){for(e=e.return;e!==null&&e.tag!==5&&e.tag!==3&&e.tag!==13;)e=e.return;Ko=e}function W2(e){if(e!==Ko)return!1;if(!ni)return NN(e),ni=!0,!1;var t;if((t=e.tag!==3)&&!(t=e.tag!==5)&&(t=e.type,t=t!=="head"&&t!=="body"&&!VI(e.type,e.memoizedProps)),t&&(t=$o)){if($I(e))throw a$(),Error(Tt(418));for(;t;)i$(e,t),t=zf(t.nextSibling)}if(NN(e),e.tag===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(Tt(317));e:{for(e=e.nextSibling,t=0;e;){if(e.nodeType===8){var r=e.data;if(r==="/$"){if(t===0){$o=zf(e.nextSibling);break e}t--}else r!=="$"&&r!=="$!"&&r!=="$?"||t++}e=e.nextSibling}$o=null}}else $o=Ko?zf(e.stateNode.nextSibling):null;return!0}function a$(){for(var e=$o;e;)e=zf(e.nextSibling)}function Tg(){$o=Ko=null,ni=!1}function lk(e){vu===null?vu=[e]:vu.push(e)}var nle=pd.ReactCurrentBatchConfig;function du(e,t){if(e&&e.defaultProps){t=pi({},t),e=e.defaultProps;for(var r in e)t[r]===void 0&&(t[r]=e[r]);return t}return t}var _C=_p(null),wC=null,jm=null,ck=null;function dk(){ck=jm=wC=null}function fk(e){var t=_C.current;Xn(_C),e._currentValue=t}function XI(e,t,r){for(;e!==null;){var n=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,n!==null&&(n.childLanes|=t)):n!==null&&(n.childLanes&t)!==t&&(n.childLanes|=t),e===r)break;e=e.return}}function ig(e,t){wC=e,ck=jm=null,e=e.dependencies,e!==null&&e.firstContext!==null&&(e.lanes&t&&(So=!0),e.firstContext=null)}function Gs(e){var t=e._currentValue;if(ck!==e)if(e={context:e,memoizedValue:t,next:null},jm===null){if(wC===null)throw Error(Tt(308));jm=e,wC.dependencies={lanes:0,firstContext:e}}else jm=jm.next=e;return t}var bh=null;function pk(e){bh===null?bh=[e]:bh.push(e)}function o$(e,t,r,n){var i=t.interleaved;return i===null?(r.next=r,pk(t)):(r.next=i.next,i.next=r),t.interleaved=r,Vc(e,n)}function Vc(e,t){e.lanes|=t;var r=e.alternate;for(r!==null&&(r.lanes|=t),r=e,e=e.return;e!==null;)e.childLanes|=t,r=e.alternate,r!==null&&(r.childLanes|=t),r=e,e=e.return;return r.tag===3?r.stateNode:null}var uf=!1;function hk(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function s$(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function Dc(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function Vf(e,t,r){var n=e.updateQueue;if(n===null)return null;if(n=n.shared,un&2){var i=n.pending;return i===null?t.next=t:(t.next=i.next,i.next=t),n.pending=t,Vc(e,r)}return i=n.interleaved,i===null?(t.next=t,pk(n)):(t.next=i.next,i.next=t),n.interleaved=t,Vc(e,r)}function ES(e,t,r){if(t=t.updateQueue,t!==null&&(t=t.shared,(r&4194240)!==0)){var n=t.lanes;n&=e.pendingLanes,r|=n,t.lanes=r,JR(e,r)}}function BN(e,t){var r=e.updateQueue,n=e.alternate;if(n!==null&&(n=n.updateQueue,r===n)){var i=null,a=null;if(r=r.firstBaseUpdate,r!==null){do{var o={eventTime:r.eventTime,lane:r.lane,tag:r.tag,payload:r.payload,callback:r.callback,next:null};a===null?i=a=o:a=a.next=o,r=r.next}while(r!==null);a===null?i=a=t:a=a.next=t}else i=a=t;r={baseState:n.baseState,firstBaseUpdate:i,lastBaseUpdate:a,shared:n.shared,effects:n.effects},e.updateQueue=r;return}e=r.lastBaseUpdate,e===null?r.firstBaseUpdate=t:e.next=t,r.lastBaseUpdate=t}function EC(e,t,r,n){var i=e.updateQueue;uf=!1;var a=i.firstBaseUpdate,o=i.lastBaseUpdate,s=i.shared.pending;if(s!==null){i.shared.pending=null;var u=s,l=u.next;u.next=null,o===null?a=l:o.next=l,o=u;var c=e.alternate;c!==null&&(c=c.updateQueue,s=c.lastBaseUpdate,s!==o&&(s===null?c.firstBaseUpdate=l:s.next=l,c.lastBaseUpdate=u))}if(a!==null){var d=i.baseState;o=0,c=l=u=null,s=a;do{var f=s.lane,p=s.eventTime;if((n&f)===f){c!==null&&(c=c.next={eventTime:p,lane:0,tag:s.tag,payload:s.payload,callback:s.callback,next:null});e:{var v=e,h=s;switch(f=t,p=r,h.tag){case 1:if(v=h.payload,typeof v=="function"){d=v.call(p,d,f);break e}d=v;break e;case 3:v.flags=v.flags&-65537|128;case 0:if(v=h.payload,f=typeof v=="function"?v.call(p,d,f):v,f==null)break e;d=pi({},d,f);break e;case 2:uf=!0}}s.callback!==null&&s.lane!==0&&(e.flags|=64,f=i.effects,f===null?i.effects=[s]:f.push(s))}else p={eventTime:p,lane:f,tag:s.tag,payload:s.payload,callback:s.callback,next:null},c===null?(l=c=p,u=d):c=c.next=p,o|=f;if(s=s.next,s===null){if(s=i.shared.pending,s===null)break;f=s,s=f.next,f.next=null,i.lastBaseUpdate=f,i.shared.pending=null}}while(1);if(c===null&&(u=d),i.baseState=u,i.firstBaseUpdate=l,i.lastBaseUpdate=c,t=i.shared.interleaved,t!==null){i=t;do o|=i.lane,i=i.next;while(i!==t)}else a===null&&(i.shared.lanes=0);Xh|=o,e.lanes=o,e.memoizedState=d}}function UN(e,t,r){if(e=t.effects,t.effects=null,e!==null)for(t=0;t<e.length;t++){var n=e[t],i=n.callback;if(i!==null){if(n.callback=null,n=r,typeof i!="function")throw Error(Tt(191,i));i.call(n)}}}var u$=new oq.Component().refs;function YI(e,t,r,n){t=e.memoizedState,r=r(n,t),r=r==null?t:pi({},t,r),e.memoizedState=r,e.lanes===0&&(e.updateQueue.baseState=r)}var Qw={isMounted:function(e){return(e=e._reactInternals)?Av(e)===e:!1},enqueueSetState:function(e,t,r){e=e._reactInternals;var n=eo(),i=Gf(e),a=Dc(n,i);a.payload=t,r!=null&&(a.callback=r),t=Vf(e,a,i),t!==null&&(Eu(t,e,i,n),ES(t,e,i))},enqueueReplaceState:function(e,t,r){e=e._reactInternals;var n=eo(),i=Gf(e),a=Dc(n,i);a.tag=1,a.payload=t,r!=null&&(a.callback=r),t=Vf(e,a,i),t!==null&&(Eu(t,e,i,n),ES(t,e,i))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var r=eo(),n=Gf(e),i=Dc(r,n);i.tag=2,t!=null&&(i.callback=t),t=Vf(e,i,n),t!==null&&(Eu(t,e,n,r),ES(t,e,n))}};function jN(e,t,r,n,i,a,o){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(n,a,o):t.prototype&&t.prototype.isPureReactComponent?!N1(r,n)||!N1(i,a):!0}function l$(e,t,r){var n=!1,i=ip,a=t.contextType;return typeof a=="object"&&a!==null?a=Gs(a):(i=_o(t)?qh:za.current,n=t.contextTypes,a=(n=n!=null)?Pg(e,i):ip),t=new t(r,a),e.memoizedState=t.state!==null&&t.state!==void 0?t.state:null,t.updater=Qw,e.stateNode=t,t._reactInternals=e,n&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=i,e.__reactInternalMemoizedMaskedChildContext=a),t}function zN(e,t,r,n){e=t.state,typeof t.componentWillReceiveProps=="function"&&t.componentWillReceiveProps(r,n),typeof t.UNSAFE_componentWillReceiveProps=="function"&&t.UNSAFE_componentWillReceiveProps(r,n),t.state!==e&&Qw.enqueueReplaceState(t,t.state,null)}function KI(e,t,r,n){var i=e.stateNode;i.props=r,i.state=e.memoizedState,i.refs=u$,hk(e);var a=t.contextType;typeof a=="object"&&a!==null?i.context=Gs(a):(a=_o(t)?qh:za.current,i.context=Pg(e,a)),i.state=e.memoizedState,a=t.getDerivedStateFromProps,typeof a=="function"&&(YI(e,t,a,r),i.state=e.memoizedState),typeof t.getDerivedStateFromProps=="function"||typeof i.getSnapshotBeforeUpdate=="function"||typeof i.UNSAFE_componentWillMount!="function"&&typeof i.componentWillMount!="function"||(t=i.state,typeof i.componentWillMount=="function"&&i.componentWillMount(),typeof i.UNSAFE_componentWillMount=="function"&&i.UNSAFE_componentWillMount(),t!==i.state&&Qw.enqueueReplaceState(i,i.state,null),EC(e,r,i,n),i.state=e.memoizedState),typeof i.componentDidMount=="function"&&(e.flags|=4194308)}function q0(e,t,r){if(e=r.ref,e!==null&&typeof e!="function"&&typeof e!="object"){if(r._owner){if(r=r._owner,r){if(r.tag!==1)throw Error(Tt(309));var n=r.stateNode}if(!n)throw Error(Tt(147,e));var i=n,a=""+e;return t!==null&&t.ref!==null&&typeof t.ref=="function"&&t.ref._stringRef===a?t.ref:(t=function(o){var s=i.refs;s===u$&&(s=i.refs={}),o===null?delete s[a]:s[a]=o},t._stringRef=a,t)}if(typeof e!="string")throw Error(Tt(284));if(!r._owner)throw Error(Tt(290,e))}return e}function X2(e,t){throw e=Object.prototype.toString.call(t),Error(Tt(31,e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function VN(e){var t=e._init;return t(e._payload)}function c$(e){function t(g,y){if(e){var b=g.deletions;b===null?(g.deletions=[y],g.flags|=16):b.push(y)}}function r(g,y){if(!e)return null;for(;y!==null;)t(g,y),y=y.sibling;return null}function n(g,y){for(g=new Map;y!==null;)y.key!==null?g.set(y.key,y):g.set(y.index,y),y=y.sibling;return g}function i(g,y){return g=qf(g,y),g.index=0,g.sibling=null,g}function a(g,y,b){return g.index=b,e?(b=g.alternate,b!==null?(b=b.index,b<y?(g.flags|=2,y):b):(g.flags|=2,y)):(g.flags|=1048576,y)}function o(g){return e&&g.alternate===null&&(g.flags|=2),g}function s(g,y,b,S){return y===null||y.tag!==6?(y=iP(b,g.mode,S),y.return=g,y):(y=i(y,b),y.return=g,y)}function u(g,y,b,S){var x=b.type;return x===Rm?c(g,y,b.props.children,S,b.key):y!==null&&(y.elementType===x||typeof x=="object"&&x!==null&&x.$$typeof===sf&&VN(x)===y.type)?(S=i(y,b.props),S.ref=q0(g,y,b),S.return=g,S):(S=DS(b.type,b.key,b.props,null,g.mode,S),S.ref=q0(g,y,b),S.return=g,S)}function l(g,y,b,S){return y===null||y.tag!==4||y.stateNode.containerInfo!==b.containerInfo||y.stateNode.implementation!==b.implementation?(y=aP(b,g.mode,S),y.return=g,y):(y=i(y,b.children||[]),y.return=g,y)}function c(g,y,b,S,x){return y===null||y.tag!==7?(y=Dh(b,g.mode,S,x),y.return=g,y):(y=i(y,b),y.return=g,y)}function d(g,y,b){if(typeof y=="string"&&y!==""||typeof y=="number")return y=iP(""+y,g.mode,b),y.return=g,y;if(typeof y=="object"&&y!==null){switch(y.$$typeof){case N2:return b=DS(y.type,y.key,y.props,null,g.mode,b),b.ref=q0(g,null,y),b.return=g,b;case Dm:return y=aP(y,g.mode,b),y.return=g,y;case sf:var S=y._init;return d(g,S(y._payload),b)}if(My(y)||j0(y))return y=Dh(y,g.mode,b,null),y.return=g,y;X2(g,y)}return null}function f(g,y,b,S){var x=y!==null?y.key:null;if(typeof b=="string"&&b!==""||typeof b=="number")return x!==null?null:s(g,y,""+b,S);if(typeof b=="object"&&b!==null){switch(b.$$typeof){case N2:return b.key===x?u(g,y,b,S):null;case Dm:return b.key===x?l(g,y,b,S):null;case sf:return x=b._init,f(g,y,x(b._payload),S)}if(My(b)||j0(b))return x!==null?null:c(g,y,b,S,null);X2(g,b)}return null}function p(g,y,b,S,x){if(typeof S=="string"&&S!==""||typeof S=="number")return g=g.get(b)||null,s(y,g,""+S,x);if(typeof S=="object"&&S!==null){switch(S.$$typeof){case N2:return g=g.get(S.key===null?b:S.key)||null,u(y,g,S,x);case Dm:return g=g.get(S.key===null?b:S.key)||null,l(y,g,S,x);case sf:var C=S._init;return p(g,y,b,C(S._payload),x)}if(My(S)||j0(S))return g=g.get(b)||null,c(y,g,S,x,null);X2(y,S)}return null}function v(g,y,b,S){for(var x=null,C=null,w=y,A=y=0,M=null;w!==null&&A<b.length;A++){w.index>A?(M=w,w=null):M=w.sibling;var D=f(g,w,b[A],S);if(D===null){w===null&&(w=M);break}e&&w&&D.alternate===null&&t(g,w),y=a(D,y,A),C===null?x=D:C.sibling=D,C=D,w=M}if(A===b.length)return r(g,w),ni&&nh(g,A),x;if(w===null){for(;A<b.length;A++)w=d(g,b[A],S),w!==null&&(y=a(w,y,A),C===null?x=w:C.sibling=w,C=w);return ni&&nh(g,A),x}for(w=n(g,w);A<b.length;A++)M=p(w,g,A,b[A],S),M!==null&&(e&&M.alternate!==null&&w.delete(M.key===null?A:M.key),y=a(M,y,A),C===null?x=M:C.sibling=M,C=M);return e&&w.forEach(function(k){return t(g,k)}),ni&&nh(g,A),x}function h(g,y,b,S){var x=j0(b);if(typeof x!="function")throw Error(Tt(150));if(b=x.call(b),b==null)throw Error(Tt(151));for(var C=x=null,w=y,A=y=0,M=null,D=b.next();w!==null&&!D.done;A++,D=b.next()){w.index>A?(M=w,w=null):M=w.sibling;var k=f(g,w,D.value,S);if(k===null){w===null&&(w=M);break}e&&w&&k.alternate===null&&t(g,w),y=a(k,y,A),C===null?x=k:C.sibling=k,C=k,w=M}if(D.done)return r(g,w),ni&&nh(g,A),x;if(w===null){for(;!D.done;A++,D=b.next())D=d(g,D.value,S),D!==null&&(y=a(D,y,A),C===null?x=D:C.sibling=D,C=D);return ni&&nh(g,A),x}for(w=n(g,w);!D.done;A++,D=b.next())D=p(w,g,A,D.value,S),D!==null&&(e&&D.alternate!==null&&w.delete(D.key===null?A:D.key),y=a(D,y,A),C===null?x=D:C.sibling=D,C=D);return e&&w.forEach(function(R){return t(g,R)}),ni&&nh(g,A),x}function m(g,y,b,S){if(typeof b=="object"&&b!==null&&b.type===Rm&&b.key===null&&(b=b.props.children),typeof b=="object"&&b!==null){switch(b.$$typeof){case N2:e:{for(var x=b.key,C=y;C!==null;){if(C.key===x){if(x=b.type,x===Rm){if(C.tag===7){r(g,C.sibling),y=i(C,b.props.children),y.return=g,g=y;break e}}else if(C.elementType===x||typeof x=="object"&&x!==null&&x.$$typeof===sf&&VN(x)===C.type){r(g,C.sibling),y=i(C,b.props),y.ref=q0(g,C,b),y.return=g,g=y;break e}r(g,C);break}else t(g,C);C=C.sibling}b.type===Rm?(y=Dh(b.props.children,g.mode,S,b.key),y.return=g,g=y):(S=DS(b.type,b.key,b.props,null,g.mode,S),S.ref=q0(g,y,b),S.return=g,g=S)}return o(g);case Dm:e:{for(C=b.key;y!==null;){if(y.key===C)if(y.tag===4&&y.stateNode.containerInfo===b.containerInfo&&y.stateNode.implementation===b.implementation){r(g,y.sibling),y=i(y,b.children||[]),y.return=g,g=y;break e}else{r(g,y);break}else t(g,y);y=y.sibling}y=aP(b,g.mode,S),y.return=g,g=y}return o(g);case sf:return C=b._init,m(g,y,C(b._payload),S)}if(My(b))return v(g,y,b,S);if(j0(b))return h(g,y,b,S);X2(g,b)}return typeof b=="string"&&b!==""||typeof b=="number"?(b=""+b,y!==null&&y.tag===6?(r(g,y.sibling),y=i(y,b),y.return=g,g=y):(r(g,y),y=iP(b,g.mode,S),y.return=g,g=y),o(g)):r(g,y)}return m}var Ig=c$(!0),d$=c$(!1),jb={},Al=_p(jb),z1=_p(jb),V1=_p(jb);function xh(e){if(e===jb)throw Error(Tt(174));return e}function vk(e,t){switch(Bn(V1,t),Bn(z1,e),Bn(Al,jb),e=t.nodeType,e){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:TI(null,"");break;default:e=e===8?t.parentNode:t,t=e.namespaceURI||null,e=e.tagName,t=TI(t,e)}Xn(Al),Bn(Al,t)}function Mg(){Xn(Al),Xn(z1),Xn(V1)}function f$(e){xh(V1.current);var t=xh(Al.current),r=TI(t,e.type);t!==r&&(Bn(z1,e),Bn(Al,r))}function mk(e){z1.current===e&&(Xn(Al),Xn(z1))}var ui=_p(0);function AC(e){for(var t=e;t!==null;){if(t.tag===13){var r=t.memoizedState;if(r!==null&&(r=r.dehydrated,r===null||r.data==="$?"||r.data==="$!"))return t}else if(t.tag===19&&t.memoizedProps.revealOrder!==void 0){if(t.flags&128)return t}else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var ZA=[];function gk(){for(var e=0;e<ZA.length;e++)ZA[e]._workInProgressVersionPrimary=null;ZA.length=0}var AS=pd.ReactCurrentDispatcher,JA=pd.ReactCurrentBatchConfig,Wh=0,di=null,zi=null,oa=null,PC=!1,i1=!1,H1=0,ile=0;function Aa(){throw Error(Tt(321))}function yk(e,t){if(t===null)return!1;for(var r=0;r<t.length&&r<e.length;r++)if(!Fu(e[r],t[r]))return!1;return!0}function bk(e,t,r,n,i,a){if(Wh=a,di=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,AS.current=e===null||e.memoizedState===null?ule:lle,e=r(n,i),i1){a=0;do{if(i1=!1,H1=0,25<=a)throw Error(Tt(301));a+=1,oa=zi=null,t.updateQueue=null,AS.current=cle,e=r(n,i)}while(i1)}if(AS.current=TC,t=zi!==null&&zi.next!==null,Wh=0,oa=zi=di=null,PC=!1,t)throw Error(Tt(300));return e}function xk(){var e=H1!==0;return H1=0,e}function ul(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return oa===null?di.memoizedState=oa=e:oa=oa.next=e,oa}function qs(){if(zi===null){var e=di.alternate;e=e!==null?e.memoizedState:null}else e=zi.next;var t=oa===null?di.memoizedState:oa.next;if(t!==null)oa=t,zi=e;else{if(e===null)throw Error(Tt(310));zi=e,e={memoizedState:zi.memoizedState,baseState:zi.baseState,baseQueue:zi.baseQueue,queue:zi.queue,next:null},oa===null?di.memoizedState=oa=e:oa=oa.next=e}return oa}function G1(e,t){return typeof t=="function"?t(e):t}function eP(e){var t=qs(),r=t.queue;if(r===null)throw Error(Tt(311));r.lastRenderedReducer=e;var n=zi,i=n.baseQueue,a=r.pending;if(a!==null){if(i!==null){var o=i.next;i.next=a.next,a.next=o}n.baseQueue=i=a,r.pending=null}if(i!==null){a=i.next,n=n.baseState;var s=o=null,u=null,l=a;do{var c=l.lane;if((Wh&c)===c)u!==null&&(u=u.next={lane:0,action:l.action,hasEagerState:l.hasEagerState,eagerState:l.eagerState,next:null}),n=l.hasEagerState?l.eagerState:e(n,l.action);else{var d={lane:c,action:l.action,hasEagerState:l.hasEagerState,eagerState:l.eagerState,next:null};u===null?(s=u=d,o=n):u=u.next=d,di.lanes|=c,Xh|=c}l=l.next}while(l!==null&&l!==a);u===null?o=n:u.next=s,Fu(n,t.memoizedState)||(So=!0),t.memoizedState=n,t.baseState=o,t.baseQueue=u,r.lastRenderedState=n}if(e=r.interleaved,e!==null){i=e;do a=i.lane,di.lanes|=a,Xh|=a,i=i.next;while(i!==e)}else i===null&&(r.lanes=0);return[t.memoizedState,r.dispatch]}function tP(e){var t=qs(),r=t.queue;if(r===null)throw Error(Tt(311));r.lastRenderedReducer=e;var n=r.dispatch,i=r.pending,a=t.memoizedState;if(i!==null){r.pending=null;var o=i=i.next;do a=e(a,o.action),o=o.next;while(o!==i);Fu(a,t.memoizedState)||(So=!0),t.memoizedState=a,t.baseQueue===null&&(t.baseState=a),r.lastRenderedState=a}return[a,n]}function p$(){}function h$(e,t){var r=di,n=qs(),i=t(),a=!Fu(n.memoizedState,i);if(a&&(n.memoizedState=i,So=!0),n=n.queue,Sk(g$.bind(null,r,n,e),[e]),n.getSnapshot!==t||a||oa!==null&&oa.memoizedState.tag&1){if(r.flags|=2048,q1(9,m$.bind(null,r,n,i,t),void 0,null),ua===null)throw Error(Tt(349));Wh&30||v$(r,t,i)}return i}function v$(e,t,r){e.flags|=16384,e={getSnapshot:t,value:r},t=di.updateQueue,t===null?(t={lastEffect:null,stores:null},di.updateQueue=t,t.stores=[e]):(r=t.stores,r===null?t.stores=[e]:r.push(e))}function m$(e,t,r,n){t.value=r,t.getSnapshot=n,y$(t)&&b$(e)}function g$(e,t,r){return r(function(){y$(t)&&b$(e)})}function y$(e){var t=e.getSnapshot;e=e.value;try{var r=t();return!Fu(e,r)}catch{return!0}}function b$(e){var t=Vc(e,1);t!==null&&Eu(t,e,1,-1)}function HN(e){var t=ul();return typeof e=="function"&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:G1,lastRenderedState:e},t.queue=e,e=e.dispatch=sle.bind(null,di,e),[t.memoizedState,e]}function q1(e,t,r,n){return e={tag:e,create:t,destroy:r,deps:n,next:null},t=di.updateQueue,t===null?(t={lastEffect:null,stores:null},di.updateQueue=t,t.lastEffect=e.next=e):(r=t.lastEffect,r===null?t.lastEffect=e.next=e:(n=r.next,r.next=e,e.next=n,t.lastEffect=e)),e}function x$(){return qs().memoizedState}function PS(e,t,r,n){var i=ul();di.flags|=e,i.memoizedState=q1(1|t,r,void 0,n===void 0?null:n)}function Zw(e,t,r,n){var i=qs();n=n===void 0?null:n;var a=void 0;if(zi!==null){var o=zi.memoizedState;if(a=o.destroy,n!==null&&yk(n,o.deps)){i.memoizedState=q1(t,r,a,n);return}}di.flags|=e,i.memoizedState=q1(1|t,r,a,n)}function GN(e,t){return PS(8390656,8,e,t)}function Sk(e,t){return Zw(2048,8,e,t)}function S$(e,t){return Zw(4,2,e,t)}function C$(e,t){return Zw(4,4,e,t)}function _$(e,t){if(typeof t=="function")return e=e(),t(e),function(){t(null)};if(t!=null)return e=e(),t.current=e,function(){t.current=null}}function w$(e,t,r){return r=r!=null?r.concat([e]):null,Zw(4,4,_$.bind(null,t,e),r)}function Ck(){}function E$(e,t){var r=qs();t=t===void 0?null:t;var n=r.memoizedState;return n!==null&&t!==null&&yk(t,n[1])?n[0]:(r.memoizedState=[e,t],e)}function A$(e,t){var r=qs();t=t===void 0?null:t;var n=r.memoizedState;return n!==null&&t!==null&&yk(t,n[1])?n[0]:(e=e(),r.memoizedState=[e,t],e)}function P$(e,t,r){return Wh&21?(Fu(r,t)||(r=Mq(),di.lanes|=r,Xh|=r,e.baseState=!0),t):(e.baseState&&(e.baseState=!1,So=!0),e.memoizedState=r)}function ale(e,t){var r=En;En=r!==0&&4>r?r:4,e(!0);var n=JA.transition;JA.transition={};try{e(!1),t()}finally{En=r,JA.transition=n}}function T$(){return qs().memoizedState}function ole(e,t,r){var n=Gf(e);if(r={lane:n,action:r,hasEagerState:!1,eagerState:null,next:null},I$(e))M$(t,r);else if(r=o$(e,t,r,n),r!==null){var i=eo();Eu(r,e,n,i),D$(r,t,n)}}function sle(e,t,r){var n=Gf(e),i={lane:n,action:r,hasEagerState:!1,eagerState:null,next:null};if(I$(e))M$(t,i);else{var a=e.alternate;if(e.lanes===0&&(a===null||a.lanes===0)&&(a=t.lastRenderedReducer,a!==null))try{var o=t.lastRenderedState,s=a(o,r);if(i.hasEagerState=!0,i.eagerState=s,Fu(s,o)){var u=t.interleaved;u===null?(i.next=i,pk(t)):(i.next=u.next,u.next=i),t.interleaved=i;return}}catch{}finally{}r=o$(e,t,i,n),r!==null&&(i=eo(),Eu(r,e,n,i),D$(r,t,n))}}function I$(e){var t=e.alternate;return e===di||t!==null&&t===di}function M$(e,t){i1=PC=!0;var r=e.pending;r===null?t.next=t:(t.next=r.next,r.next=t),e.pending=t}function D$(e,t,r){if(r&4194240){var n=t.lanes;n&=e.pendingLanes,r|=n,t.lanes=r,JR(e,r)}}var TC={readContext:Gs,useCallback:Aa,useContext:Aa,useEffect:Aa,useImperativeHandle:Aa,useInsertionEffect:Aa,useLayoutEffect:Aa,useMemo:Aa,useReducer:Aa,useRef:Aa,useState:Aa,useDebugValue:Aa,useDeferredValue:Aa,useTransition:Aa,useMutableSource:Aa,useSyncExternalStore:Aa,useId:Aa,unstable_isNewReconciler:!1},ule={readContext:Gs,useCallback:function(e,t){return ul().memoizedState=[e,t===void 0?null:t],e},useContext:Gs,useEffect:GN,useImperativeHandle:function(e,t,r){return r=r!=null?r.concat([e]):null,PS(4194308,4,_$.bind(null,t,e),r)},useLayoutEffect:function(e,t){return PS(4194308,4,e,t)},useInsertionEffect:function(e,t){return PS(4,2,e,t)},useMemo:function(e,t){var r=ul();return t=t===void 0?null:t,e=e(),r.memoizedState=[e,t],e},useReducer:function(e,t,r){var n=ul();return t=r!==void 0?r(t):t,n.memoizedState=n.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},n.queue=e,e=e.dispatch=ole.bind(null,di,e),[n.memoizedState,e]},useRef:function(e){var t=ul();return e={current:e},t.memoizedState=e},useState:HN,useDebugValue:Ck,useDeferredValue:function(e){return ul().memoizedState=e},useTransition:function(){var e=HN(!1),t=e[0];return e=ale.bind(null,e[1]),ul().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,r){var n=di,i=ul();if(ni){if(r===void 0)throw Error(Tt(407));r=r()}else{if(r=t(),ua===null)throw Error(Tt(349));Wh&30||v$(n,t,r)}i.memoizedState=r;var a={value:r,getSnapshot:t};return i.queue=a,GN(g$.bind(null,n,a,e),[e]),n.flags|=2048,q1(9,m$.bind(null,n,a,r,t),void 0,null),r},useId:function(){var e=ul(),t=ua.identifierPrefix;if(ni){var r=Cc,n=Sc;r=(n&~(1<<32-wu(n)-1)).toString(32)+r,t=":"+t+"R"+r,r=H1++,0<r&&(t+="H"+r.toString(32)),t+=":"}else r=ile++,t=":"+t+"r"+r.toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},lle={readContext:Gs,useCallback:E$,useContext:Gs,useEffect:Sk,useImperativeHandle:w$,useInsertionEffect:S$,useLayoutEffect:C$,useMemo:A$,useReducer:eP,useRef:x$,useState:function(){return eP(G1)},useDebugValue:Ck,useDeferredValue:function(e){var t=qs();return P$(t,zi.memoizedState,e)},useTransition:function(){var e=eP(G1)[0],t=qs().memoizedState;return[e,t]},useMutableSource:p$,useSyncExternalStore:h$,useId:T$,unstable_isNewReconciler:!1},cle={readContext:Gs,useCallback:E$,useContext:Gs,useEffect:Sk,useImperativeHandle:w$,useInsertionEffect:S$,useLayoutEffect:C$,useMemo:A$,useReducer:tP,useRef:x$,useState:function(){return tP(G1)},useDebugValue:Ck,useDeferredValue:function(e){var t=qs();return zi===null?t.memoizedState=e:P$(t,zi.memoizedState,e)},useTransition:function(){var e=tP(G1)[0],t=qs().memoizedState;return[e,t]},useMutableSource:p$,useSyncExternalStore:h$,useId:T$,unstable_isNewReconciler:!1};function Dg(e,t){try{var r="",n=t;do r+=Bse(n),n=n.return;while(n);var i=r}catch(a){i=`
Error generating stack: `+a.message+`
`+a.stack}return{value:e,source:t,stack:i,digest:null}}function rP(e,t,r){return{value:e,source:null,stack:r??null,digest:t??null}}function QI(e,t){try{console.error(t.value)}catch(r){setTimeout(function(){throw r})}}var dle=typeof WeakMap=="function"?WeakMap:Map;function R$(e,t,r){r=Dc(-1,r),r.tag=3,r.payload={element:null};var n=t.value;return r.callback=function(){MC||(MC=!0,sM=n),QI(e,t)},r}function k$(e,t,r){r=Dc(-1,r),r.tag=3;var n=e.type.getDerivedStateFromError;if(typeof n=="function"){var i=t.value;r.payload=function(){return n(i)},r.callback=function(){QI(e,t)}}var a=e.stateNode;return a!==null&&typeof a.componentDidCatch=="function"&&(r.callback=function(){QI(e,t),typeof n!="function"&&(Hf===null?Hf=new Set([this]):Hf.add(this));var o=t.stack;this.componentDidCatch(t.value,{componentStack:o!==null?o:""})}),r}function qN(e,t,r){var n=e.pingCache;if(n===null){n=e.pingCache=new dle;var i=new Set;n.set(t,i)}else i=n.get(t),i===void 0&&(i=new Set,n.set(t,i));i.has(r)||(i.add(r),e=Ele.bind(null,e,t,r),t.then(e,e))}function $N(e){do{var t;if((t=e.tag===13)&&(t=e.memoizedState,t=t!==null?t.dehydrated!==null:!0),t)return e;e=e.return}while(e!==null);return null}function WN(e,t,r,n,i){return e.mode&1?(e.flags|=65536,e.lanes=i,e):(e===t?e.flags|=65536:(e.flags|=128,r.flags|=131072,r.flags&=-52805,r.tag===1&&(r.alternate===null?r.tag=17:(t=Dc(-1,1),t.tag=2,Vf(r,t,1))),r.lanes|=1),e)}var fle=pd.ReactCurrentOwner,So=!1;function Za(e,t,r,n){t.child=e===null?d$(t,null,r,n):Ig(t,e.child,r,n)}function XN(e,t,r,n,i){r=r.render;var a=t.ref;return ig(t,i),n=bk(e,t,r,n,a,i),r=xk(),e!==null&&!So?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~i,Hc(e,t,i)):(ni&&r&&sk(t),t.flags|=1,Za(e,t,n,i),t.child)}function YN(e,t,r,n,i){if(e===null){var a=r.type;return typeof a=="function"&&!Mk(a)&&a.defaultProps===void 0&&r.compare===null&&r.defaultProps===void 0?(t.tag=15,t.type=a,O$(e,t,a,n,i)):(e=DS(r.type,null,n,t,t.mode,i),e.ref=t.ref,e.return=t,t.child=e)}if(a=e.child,!(e.lanes&i)){var o=a.memoizedProps;if(r=r.compare,r=r!==null?r:N1,r(o,n)&&e.ref===t.ref)return Hc(e,t,i)}return t.flags|=1,e=qf(a,n),e.ref=t.ref,e.return=t,t.child=e}function O$(e,t,r,n,i){if(e!==null){var a=e.memoizedProps;if(N1(a,n)&&e.ref===t.ref)if(So=!1,t.pendingProps=n=a,(e.lanes&i)!==0)e.flags&131072&&(So=!0);else return t.lanes=e.lanes,Hc(e,t,i)}return ZI(e,t,r,n,i)}function L$(e,t,r){var n=t.pendingProps,i=n.children,a=e!==null?e.memoizedState:null;if(n.mode==="hidden")if(!(t.mode&1))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},Bn(Vm,zo),zo|=r;else{if(!(r&1073741824))return e=a!==null?a.baseLanes|r:r,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,Bn(Vm,zo),zo|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},n=a!==null?a.baseLanes:r,Bn(Vm,zo),zo|=n}else a!==null?(n=a.baseLanes|r,t.memoizedState=null):n=r,Bn(Vm,zo),zo|=n;return Za(e,t,i,r),t.child}function F$(e,t){var r=t.ref;(e===null&&r!==null||e!==null&&e.ref!==r)&&(t.flags|=512,t.flags|=2097152)}function ZI(e,t,r,n,i){var a=_o(r)?qh:za.current;return a=Pg(t,a),ig(t,i),r=bk(e,t,r,n,a,i),n=xk(),e!==null&&!So?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~i,Hc(e,t,i)):(ni&&n&&sk(t),t.flags|=1,Za(e,t,r,i),t.child)}function KN(e,t,r,n,i){if(_o(r)){var a=!0;xC(t)}else a=!1;if(ig(t,i),t.stateNode===null)TS(e,t),l$(t,r,n),KI(t,r,n,i),n=!0;else if(e===null){var o=t.stateNode,s=t.memoizedProps;o.props=s;var u=o.context,l=r.contextType;typeof l=="object"&&l!==null?l=Gs(l):(l=_o(r)?qh:za.current,l=Pg(t,l));var c=r.getDerivedStateFromProps,d=typeof c=="function"||typeof o.getSnapshotBeforeUpdate=="function";d||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(s!==n||u!==l)&&zN(t,o,n,l),uf=!1;var f=t.memoizedState;o.state=f,EC(t,n,o,i),u=t.memoizedState,s!==n||f!==u||Co.current||uf?(typeof c=="function"&&(YI(t,r,c,n),u=t.memoizedState),(s=uf||jN(t,r,s,n,f,u,l))?(d||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(t.flags|=4194308)):(typeof o.componentDidMount=="function"&&(t.flags|=4194308),t.memoizedProps=n,t.memoizedState=u),o.props=n,o.state=u,o.context=l,n=s):(typeof o.componentDidMount=="function"&&(t.flags|=4194308),n=!1)}else{o=t.stateNode,s$(e,t),s=t.memoizedProps,l=t.type===t.elementType?s:du(t.type,s),o.props=l,d=t.pendingProps,f=o.context,u=r.contextType,typeof u=="object"&&u!==null?u=Gs(u):(u=_o(r)?qh:za.current,u=Pg(t,u));var p=r.getDerivedStateFromProps;(c=typeof p=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(s!==d||f!==u)&&zN(t,o,n,u),uf=!1,f=t.memoizedState,o.state=f,EC(t,n,o,i);var v=t.memoizedState;s!==d||f!==v||Co.current||uf?(typeof p=="function"&&(YI(t,r,p,n),v=t.memoizedState),(l=uf||jN(t,r,l,n,f,v,u)||!1)?(c||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(n,v,u),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(n,v,u)),typeof o.componentDidUpdate=="function"&&(t.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(t.flags|=1024)):(typeof o.componentDidUpdate!="function"||s===e.memoizedProps&&f===e.memoizedState||(t.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||s===e.memoizedProps&&f===e.memoizedState||(t.flags|=1024),t.memoizedProps=n,t.memoizedState=v),o.props=n,o.state=v,o.context=u,n=l):(typeof o.componentDidUpdate!="function"||s===e.memoizedProps&&f===e.memoizedState||(t.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||s===e.memoizedProps&&f===e.memoizedState||(t.flags|=1024),n=!1)}return JI(e,t,r,n,a,i)}function JI(e,t,r,n,i,a){F$(e,t);var o=(t.flags&128)!==0;if(!n&&!o)return i&&LN(t,r,!1),Hc(e,t,a);n=t.stateNode,fle.current=t;var s=o&&typeof r.getDerivedStateFromError!="function"?null:n.render();return t.flags|=1,e!==null&&o?(t.child=Ig(t,e.child,null,a),t.child=Ig(t,null,s,a)):Za(e,t,s,a),t.memoizedState=n.state,i&&LN(t,r,!0),t.child}function N$(e){var t=e.stateNode;t.pendingContext?ON(e,t.pendingContext,t.pendingContext!==t.context):t.context&&ON(e,t.context,!1),vk(e,t.containerInfo)}function QN(e,t,r,n,i){return Tg(),lk(i),t.flags|=256,Za(e,t,r,n),t.child}var eM={dehydrated:null,treeContext:null,retryLane:0};function tM(e){return{baseLanes:e,cachePool:null,transitions:null}}function B$(e,t,r){var n=t.pendingProps,i=ui.current,a=!1,o=(t.flags&128)!==0,s;if((s=o)||(s=e!==null&&e.memoizedState===null?!1:(i&2)!==0),s?(a=!0,t.flags&=-129):(e===null||e.memoizedState!==null)&&(i|=1),Bn(ui,i&1),e===null)return WI(t),e=t.memoizedState,e!==null&&(e=e.dehydrated,e!==null)?(t.mode&1?e.data==="$!"?t.lanes=8:t.lanes=1073741824:t.lanes=1,null):(o=n.children,e=n.fallback,a?(n=t.mode,a=t.child,o={mode:"hidden",children:o},!(n&1)&&a!==null?(a.childLanes=0,a.pendingProps=o):a=t3(o,n,0,null),e=Dh(e,n,r,null),a.return=t,e.return=t,a.sibling=e,t.child=a,t.child.memoizedState=tM(r),t.memoizedState=eM,e):_k(t,o));if(i=e.memoizedState,i!==null&&(s=i.dehydrated,s!==null))return ple(e,t,o,n,s,i,r);if(a){a=n.fallback,o=t.mode,i=e.child,s=i.sibling;var u={mode:"hidden",children:n.children};return!(o&1)&&t.child!==i?(n=t.child,n.childLanes=0,n.pendingProps=u,t.deletions=null):(n=qf(i,u),n.subtreeFlags=i.subtreeFlags&14680064),s!==null?a=qf(s,a):(a=Dh(a,o,r,null),a.flags|=2),a.return=t,n.return=t,n.sibling=a,t.child=n,n=a,a=t.child,o=e.child.memoizedState,o=o===null?tM(r):{baseLanes:o.baseLanes|r,cachePool:null,transitions:o.transitions},a.memoizedState=o,a.childLanes=e.childLanes&~r,t.memoizedState=eM,n}return a=e.child,e=a.sibling,n=qf(a,{mode:"visible",children:n.children}),!(t.mode&1)&&(n.lanes=r),n.return=t,n.sibling=null,e!==null&&(r=t.deletions,r===null?(t.deletions=[e],t.flags|=16):r.push(e)),t.child=n,t.memoizedState=null,n}function _k(e,t){return t=t3({mode:"visible",children:t},e.mode,0,null),t.return=e,e.child=t}function Y2(e,t,r,n){return n!==null&&lk(n),Ig(t,e.child,null,r),e=_k(t,t.pendingProps.children),e.flags|=2,t.memoizedState=null,e}function ple(e,t,r,n,i,a,o){if(r)return t.flags&256?(t.flags&=-257,n=rP(Error(Tt(422))),Y2(e,t,o,n)):t.memoizedState!==null?(t.child=e.child,t.flags|=128,null):(a=n.fallback,i=t.mode,n=t3({mode:"visible",children:n.children},i,0,null),a=Dh(a,i,o,null),a.flags|=2,n.return=t,a.return=t,n.sibling=a,t.child=n,t.mode&1&&Ig(t,e.child,null,o),t.child.memoizedState=tM(o),t.memoizedState=eM,a);if(!(t.mode&1))return Y2(e,t,o,null);if(i.data==="$!"){if(n=i.nextSibling&&i.nextSibling.dataset,n)var s=n.dgst;return n=s,a=Error(Tt(419)),n=rP(a,n,void 0),Y2(e,t,o,n)}if(s=(o&e.childLanes)!==0,So||s){if(n=ua,n!==null){switch(o&-o){case 4:i=2;break;case 16:i=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:i=32;break;case 536870912:i=268435456;break;default:i=0}i=i&(n.suspendedLanes|o)?0:i,i!==0&&i!==a.retryLane&&(a.retryLane=i,Vc(e,i),Eu(n,e,i,-1))}return Ik(),n=rP(Error(Tt(421))),Y2(e,t,o,n)}return i.data==="$?"?(t.flags|=128,t.child=e.child,t=Ale.bind(null,e),i._reactRetry=t,null):(e=a.treeContext,$o=zf(i.nextSibling),Ko=t,ni=!0,vu=null,e!==null&&(Os[Ls++]=Sc,Os[Ls++]=Cc,Os[Ls++]=$h,Sc=e.id,Cc=e.overflow,$h=t),t=_k(t,n.children),t.flags|=4096,t)}function ZN(e,t,r){e.lanes|=t;var n=e.alternate;n!==null&&(n.lanes|=t),XI(e.return,t,r)}function nP(e,t,r,n,i){var a=e.memoizedState;a===null?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:n,tail:r,tailMode:i}:(a.isBackwards=t,a.rendering=null,a.renderingStartTime=0,a.last=n,a.tail=r,a.tailMode=i)}function U$(e,t,r){var n=t.pendingProps,i=n.revealOrder,a=n.tail;if(Za(e,t,n.children,r),n=ui.current,n&2)n=n&1|2,t.flags|=128;else{if(e!==null&&e.flags&128)e:for(e=t.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&ZN(e,r,t);else if(e.tag===19)ZN(e,r,t);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;e.sibling===null;){if(e.return===null||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}n&=1}if(Bn(ui,n),!(t.mode&1))t.memoizedState=null;else switch(i){case"forwards":for(r=t.child,i=null;r!==null;)e=r.alternate,e!==null&&AC(e)===null&&(i=r),r=r.sibling;r=i,r===null?(i=t.child,t.child=null):(i=r.sibling,r.sibling=null),nP(t,!1,i,r,a);break;case"backwards":for(r=null,i=t.child,t.child=null;i!==null;){if(e=i.alternate,e!==null&&AC(e)===null){t.child=i;break}e=i.sibling,i.sibling=r,r=i,i=e}nP(t,!0,r,null,a);break;case"together":nP(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function TS(e,t){!(t.mode&1)&&e!==null&&(e.alternate=null,t.alternate=null,t.flags|=2)}function Hc(e,t,r){if(e!==null&&(t.dependencies=e.dependencies),Xh|=t.lanes,!(r&t.childLanes))return null;if(e!==null&&t.child!==e.child)throw Error(Tt(153));if(t.child!==null){for(e=t.child,r=qf(e,e.pendingProps),t.child=r,r.return=t;e.sibling!==null;)e=e.sibling,r=r.sibling=qf(e,e.pendingProps),r.return=t;r.sibling=null}return t.child}function hle(e,t,r){switch(t.tag){case 3:N$(t),Tg();break;case 5:f$(t);break;case 1:_o(t.type)&&xC(t);break;case 4:vk(t,t.stateNode.containerInfo);break;case 10:var n=t.type._context,i=t.memoizedProps.value;Bn(_C,n._currentValue),n._currentValue=i;break;case 13:if(n=t.memoizedState,n!==null)return n.dehydrated!==null?(Bn(ui,ui.current&1),t.flags|=128,null):r&t.child.childLanes?B$(e,t,r):(Bn(ui,ui.current&1),e=Hc(e,t,r),e!==null?e.sibling:null);Bn(ui,ui.current&1);break;case 19:if(n=(r&t.childLanes)!==0,e.flags&128){if(n)return U$(e,t,r);t.flags|=128}if(i=t.memoizedState,i!==null&&(i.rendering=null,i.tail=null,i.lastEffect=null),Bn(ui,ui.current),n)break;return null;case 22:case 23:return t.lanes=0,L$(e,t,r)}return Hc(e,t,r)}var j$,rM,z$,V$;j$=function(e,t){for(var r=t.child;r!==null;){if(r.tag===5||r.tag===6)e.appendChild(r.stateNode);else if(r.tag!==4&&r.child!==null){r.child.return=r,r=r.child;continue}if(r===t)break;for(;r.sibling===null;){if(r.return===null||r.return===t)return;r=r.return}r.sibling.return=r.return,r=r.sibling}};rM=function(){};z$=function(e,t,r,n){var i=e.memoizedProps;if(i!==n){e=t.stateNode,xh(Al.current);var a=null;switch(r){case"input":i=wI(e,i),n=wI(e,n),a=[];break;case"select":i=pi({},i,{value:void 0}),n=pi({},n,{value:void 0}),a=[];break;case"textarea":i=PI(e,i),n=PI(e,n),a=[];break;default:typeof i.onClick!="function"&&typeof n.onClick=="function"&&(e.onclick=yC)}II(r,n);var o;r=null;for(l in i)if(!n.hasOwnProperty(l)&&i.hasOwnProperty(l)&&i[l]!=null)if(l==="style"){var s=i[l];for(o in s)s.hasOwnProperty(o)&&(r||(r={}),r[o]="")}else l!=="dangerouslySetInnerHTML"&&l!=="children"&&l!=="suppressContentEditableWarning"&&l!=="suppressHydrationWarning"&&l!=="autoFocus"&&(M1.hasOwnProperty(l)?a||(a=[]):(a=a||[]).push(l,null));for(l in n){var u=n[l];if(s=i!=null?i[l]:void 0,n.hasOwnProperty(l)&&u!==s&&(u!=null||s!=null))if(l==="style")if(s){for(o in s)!s.hasOwnProperty(o)||u&&u.hasOwnProperty(o)||(r||(r={}),r[o]="");for(o in u)u.hasOwnProperty(o)&&s[o]!==u[o]&&(r||(r={}),r[o]=u[o])}else r||(a||(a=[]),a.push(l,r)),r=u;else l==="dangerouslySetInnerHTML"?(u=u?u.__html:void 0,s=s?s.__html:void 0,u!=null&&s!==u&&(a=a||[]).push(l,u)):l==="children"?typeof u!="string"&&typeof u!="number"||(a=a||[]).push(l,""+u):l!=="suppressContentEditableWarning"&&l!=="suppressHydrationWarning"&&(M1.hasOwnProperty(l)?(u!=null&&l==="onScroll"&&Vn("scroll",e),a||s===u||(a=[])):(a=a||[]).push(l,u))}r&&(a=a||[]).push("style",r);var l=a;(t.updateQueue=l)&&(t.flags|=4)}};V$=function(e,t,r,n){r!==n&&(t.flags|=4)};function $0(e,t){if(!ni)switch(e.tailMode){case"hidden":t=e.tail;for(var r=null;t!==null;)t.alternate!==null&&(r=t),t=t.sibling;r===null?e.tail=null:r.sibling=null;break;case"collapsed":r=e.tail;for(var n=null;r!==null;)r.alternate!==null&&(n=r),r=r.sibling;n===null?t||e.tail===null?e.tail=null:e.tail.sibling=null:n.sibling=null}}function Pa(e){var t=e.alternate!==null&&e.alternate.child===e.child,r=0,n=0;if(t)for(var i=e.child;i!==null;)r|=i.lanes|i.childLanes,n|=i.subtreeFlags&14680064,n|=i.flags&14680064,i.return=e,i=i.sibling;else for(i=e.child;i!==null;)r|=i.lanes|i.childLanes,n|=i.subtreeFlags,n|=i.flags,i.return=e,i=i.sibling;return e.subtreeFlags|=n,e.childLanes=r,t}function vle(e,t,r){var n=t.pendingProps;switch(uk(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Pa(t),null;case 1:return _o(t.type)&&bC(),Pa(t),null;case 3:return n=t.stateNode,Mg(),Xn(Co),Xn(za),gk(),n.pendingContext&&(n.context=n.pendingContext,n.pendingContext=null),(e===null||e.child===null)&&(W2(t)?t.flags|=4:e===null||e.memoizedState.isDehydrated&&!(t.flags&256)||(t.flags|=1024,vu!==null&&(cM(vu),vu=null))),rM(e,t),Pa(t),null;case 5:mk(t);var i=xh(V1.current);if(r=t.type,e!==null&&t.stateNode!=null)z$(e,t,r,n,i),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!n){if(t.stateNode===null)throw Error(Tt(166));return Pa(t),null}if(e=xh(Al.current),W2(t)){n=t.stateNode,r=t.type;var a=t.memoizedProps;switch(n[yl]=t,n[j1]=a,e=(t.mode&1)!==0,r){case"dialog":Vn("cancel",n),Vn("close",n);break;case"iframe":case"object":case"embed":Vn("load",n);break;case"video":case"audio":for(i=0;i<Ry.length;i++)Vn(Ry[i],n);break;case"source":Vn("error",n);break;case"img":case"image":case"link":Vn("error",n),Vn("load",n);break;case"details":Vn("toggle",n);break;case"input":sN(n,a),Vn("invalid",n);break;case"select":n._wrapperState={wasMultiple:!!a.multiple},Vn("invalid",n);break;case"textarea":lN(n,a),Vn("invalid",n)}II(r,a),i=null;for(var o in a)if(a.hasOwnProperty(o)){var s=a[o];o==="children"?typeof s=="string"?n.textContent!==s&&(a.suppressHydrationWarning!==!0&&$2(n.textContent,s,e),i=["children",s]):typeof s=="number"&&n.textContent!==""+s&&(a.suppressHydrationWarning!==!0&&$2(n.textContent,s,e),i=["children",""+s]):M1.hasOwnProperty(o)&&s!=null&&o==="onScroll"&&Vn("scroll",n)}switch(r){case"input":B2(n),uN(n,a,!0);break;case"textarea":B2(n),cN(n);break;case"select":case"option":break;default:typeof a.onClick=="function"&&(n.onclick=yC)}n=i,t.updateQueue=n,n!==null&&(t.flags|=4)}else{o=i.nodeType===9?i:i.ownerDocument,e==="http://www.w3.org/1999/xhtml"&&(e=vq(r)),e==="http://www.w3.org/1999/xhtml"?r==="script"?(e=o.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):typeof n.is=="string"?e=o.createElement(r,{is:n.is}):(e=o.createElement(r),r==="select"&&(o=e,n.multiple?o.multiple=!0:n.size&&(o.size=n.size))):e=o.createElementNS(e,r),e[yl]=t,e[j1]=n,j$(e,t,!1,!1),t.stateNode=e;e:{switch(o=MI(r,n),r){case"dialog":Vn("cancel",e),Vn("close",e),i=n;break;case"iframe":case"object":case"embed":Vn("load",e),i=n;break;case"video":case"audio":for(i=0;i<Ry.length;i++)Vn(Ry[i],e);i=n;break;case"source":Vn("error",e),i=n;break;case"img":case"image":case"link":Vn("error",e),Vn("load",e),i=n;break;case"details":Vn("toggle",e),i=n;break;case"input":sN(e,n),i=wI(e,n),Vn("invalid",e);break;case"option":i=n;break;case"select":e._wrapperState={wasMultiple:!!n.multiple},i=pi({},n,{value:void 0}),Vn("invalid",e);break;case"textarea":lN(e,n),i=PI(e,n),Vn("invalid",e);break;default:i=n}II(r,i),s=i;for(a in s)if(s.hasOwnProperty(a)){var u=s[a];a==="style"?yq(e,u):a==="dangerouslySetInnerHTML"?(u=u?u.__html:void 0,u!=null&&mq(e,u)):a==="children"?typeof u=="string"?(r!=="textarea"||u!=="")&&D1(e,u):typeof u=="number"&&D1(e,""+u):a!=="suppressContentEditableWarning"&&a!=="suppressHydrationWarning"&&a!=="autoFocus"&&(M1.hasOwnProperty(a)?u!=null&&a==="onScroll"&&Vn("scroll",e):u!=null&&WR(e,a,u,o))}switch(r){case"input":B2(e),uN(e,n,!1);break;case"textarea":B2(e),cN(e);break;case"option":n.value!=null&&e.setAttribute("value",""+np(n.value));break;case"select":e.multiple=!!n.multiple,a=n.value,a!=null?eg(e,!!n.multiple,a,!1):n.defaultValue!=null&&eg(e,!!n.multiple,n.defaultValue,!0);break;default:typeof i.onClick=="function"&&(e.onclick=yC)}switch(r){case"button":case"input":case"select":case"textarea":n=!!n.autoFocus;break e;case"img":n=!0;break e;default:n=!1}}n&&(t.flags|=4)}t.ref!==null&&(t.flags|=512,t.flags|=2097152)}return Pa(t),null;case 6:if(e&&t.stateNode!=null)V$(e,t,e.memoizedProps,n);else{if(typeof n!="string"&&t.stateNode===null)throw Error(Tt(166));if(r=xh(V1.current),xh(Al.current),W2(t)){if(n=t.stateNode,r=t.memoizedProps,n[yl]=t,(a=n.nodeValue!==r)&&(e=Ko,e!==null))switch(e.tag){case 3:$2(n.nodeValue,r,(e.mode&1)!==0);break;case 5:e.memoizedProps.suppressHydrationWarning!==!0&&$2(n.nodeValue,r,(e.mode&1)!==0)}a&&(t.flags|=4)}else n=(r.nodeType===9?r:r.ownerDocument).createTextNode(n),n[yl]=t,t.stateNode=n}return Pa(t),null;case 13:if(Xn(ui),n=t.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(ni&&$o!==null&&t.mode&1&&!(t.flags&128))a$(),Tg(),t.flags|=98560,a=!1;else if(a=W2(t),n!==null&&n.dehydrated!==null){if(e===null){if(!a)throw Error(Tt(318));if(a=t.memoizedState,a=a!==null?a.dehydrated:null,!a)throw Error(Tt(317));a[yl]=t}else Tg(),!(t.flags&128)&&(t.memoizedState=null),t.flags|=4;Pa(t),a=!1}else vu!==null&&(cM(vu),vu=null),a=!0;if(!a)return t.flags&65536?t:null}return t.flags&128?(t.lanes=r,t):(n=n!==null,n!==(e!==null&&e.memoizedState!==null)&&n&&(t.child.flags|=8192,t.mode&1&&(e===null||ui.current&1?Hi===0&&(Hi=3):Ik())),t.updateQueue!==null&&(t.flags|=4),Pa(t),null);case 4:return Mg(),rM(e,t),e===null&&B1(t.stateNode.containerInfo),Pa(t),null;case 10:return fk(t.type._context),Pa(t),null;case 17:return _o(t.type)&&bC(),Pa(t),null;case 19:if(Xn(ui),a=t.memoizedState,a===null)return Pa(t),null;if(n=(t.flags&128)!==0,o=a.rendering,o===null)if(n)$0(a,!1);else{if(Hi!==0||e!==null&&e.flags&128)for(e=t.child;e!==null;){if(o=AC(e),o!==null){for(t.flags|=128,$0(a,!1),n=o.updateQueue,n!==null&&(t.updateQueue=n,t.flags|=4),t.subtreeFlags=0,n=r,r=t.child;r!==null;)a=r,e=n,a.flags&=14680066,o=a.alternate,o===null?(a.childLanes=0,a.lanes=e,a.child=null,a.subtreeFlags=0,a.memoizedProps=null,a.memoizedState=null,a.updateQueue=null,a.dependencies=null,a.stateNode=null):(a.childLanes=o.childLanes,a.lanes=o.lanes,a.child=o.child,a.subtreeFlags=0,a.deletions=null,a.memoizedProps=o.memoizedProps,a.memoizedState=o.memoizedState,a.updateQueue=o.updateQueue,a.type=o.type,e=o.dependencies,a.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext}),r=r.sibling;return Bn(ui,ui.current&1|2),t.child}e=e.sibling}a.tail!==null&&wi()>Rg&&(t.flags|=128,n=!0,$0(a,!1),t.lanes=4194304)}else{if(!n)if(e=AC(o),e!==null){if(t.flags|=128,n=!0,r=e.updateQueue,r!==null&&(t.updateQueue=r,t.flags|=4),$0(a,!0),a.tail===null&&a.tailMode==="hidden"&&!o.alternate&&!ni)return Pa(t),null}else 2*wi()-a.renderingStartTime>Rg&&r!==1073741824&&(t.flags|=128,n=!0,$0(a,!1),t.lanes=4194304);a.isBackwards?(o.sibling=t.child,t.child=o):(r=a.last,r!==null?r.sibling=o:t.child=o,a.last=o)}return a.tail!==null?(t=a.tail,a.rendering=t,a.tail=t.sibling,a.renderingStartTime=wi(),t.sibling=null,r=ui.current,Bn(ui,n?r&1|2:r&1),t):(Pa(t),null);case 22:case 23:return Tk(),n=t.memoizedState!==null,e!==null&&e.memoizedState!==null!==n&&(t.flags|=8192),n&&t.mode&1?zo&1073741824&&(Pa(t),t.subtreeFlags&6&&(t.flags|=8192)):Pa(t),null;case 24:return null;case 25:return null}throw Error(Tt(156,t.tag))}function mle(e,t){switch(uk(t),t.tag){case 1:return _o(t.type)&&bC(),e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 3:return Mg(),Xn(Co),Xn(za),gk(),e=t.flags,e&65536&&!(e&128)?(t.flags=e&-65537|128,t):null;case 5:return mk(t),null;case 13:if(Xn(ui),e=t.memoizedState,e!==null&&e.dehydrated!==null){if(t.alternate===null)throw Error(Tt(340));Tg()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 19:return Xn(ui),null;case 4:return Mg(),null;case 10:return fk(t.type._context),null;case 22:case 23:return Tk(),null;case 24:return null;default:return null}}var K2=!1,La=!1,gle=typeof WeakSet=="function"?WeakSet:Set,zt=null;function zm(e,t){var r=e.ref;if(r!==null)if(typeof r=="function")try{r(null)}catch(n){gi(e,t,n)}else r.current=null}function nM(e,t,r){try{r()}catch(n){gi(e,t,n)}}var JN=!1;function yle(e,t){if(jI=vC,e=$q(),ok(e)){if("selectionStart"in e)var r={start:e.selectionStart,end:e.selectionEnd};else e:{r=(r=e.ownerDocument)&&r.defaultView||window;var n=r.getSelection&&r.getSelection();if(n&&n.rangeCount!==0){r=n.anchorNode;var i=n.anchorOffset,a=n.focusNode;n=n.focusOffset;try{r.nodeType,a.nodeType}catch{r=null;break e}var o=0,s=-1,u=-1,l=0,c=0,d=e,f=null;t:for(;;){for(var p;d!==r||i!==0&&d.nodeType!==3||(s=o+i),d!==a||n!==0&&d.nodeType!==3||(u=o+n),d.nodeType===3&&(o+=d.nodeValue.length),(p=d.firstChild)!==null;)f=d,d=p;for(;;){if(d===e)break t;if(f===r&&++l===i&&(s=o),f===a&&++c===n&&(u=o),(p=d.nextSibling)!==null)break;d=f,f=d.parentNode}d=p}r=s===-1||u===-1?null:{start:s,end:u}}else r=null}r=r||{start:0,end:0}}else r=null;for(zI={focusedElem:e,selectionRange:r},vC=!1,zt=t;zt!==null;)if(t=zt,e=t.child,(t.subtreeFlags&1028)!==0&&e!==null)e.return=t,zt=e;else for(;zt!==null;){t=zt;try{var v=t.alternate;if(t.flags&1024)switch(t.tag){case 0:case 11:case 15:break;case 1:if(v!==null){var h=v.memoizedProps,m=v.memoizedState,g=t.stateNode,y=g.getSnapshotBeforeUpdate(t.elementType===t.type?h:du(t.type,h),m);g.__reactInternalSnapshotBeforeUpdate=y}break;case 3:var b=t.stateNode.containerInfo;b.nodeType===1?b.textContent="":b.nodeType===9&&b.documentElement&&b.removeChild(b.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(Tt(163))}}catch(S){gi(t,t.return,S)}if(e=t.sibling,e!==null){e.return=t.return,zt=e;break}zt=t.return}return v=JN,JN=!1,v}function a1(e,t,r){var n=t.updateQueue;if(n=n!==null?n.lastEffect:null,n!==null){var i=n=n.next;do{if((i.tag&e)===e){var a=i.destroy;i.destroy=void 0,a!==void 0&&nM(t,r,a)}i=i.next}while(i!==n)}}function Jw(e,t){if(t=t.updateQueue,t=t!==null?t.lastEffect:null,t!==null){var r=t=t.next;do{if((r.tag&e)===e){var n=r.create;r.destroy=n()}r=r.next}while(r!==t)}}function iM(e){var t=e.ref;if(t!==null){var r=e.stateNode;switch(e.tag){case 5:e=r;break;default:e=r}typeof t=="function"?t(e):t.current=e}}function H$(e){var t=e.alternate;t!==null&&(e.alternate=null,H$(t)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(t=e.stateNode,t!==null&&(delete t[yl],delete t[j1],delete t[GI],delete t[ele],delete t[tle])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function G$(e){return e.tag===5||e.tag===3||e.tag===4}function eB(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||G$(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function aM(e,t,r){var n=e.tag;if(n===5||n===6)e=e.stateNode,t?r.nodeType===8?r.parentNode.insertBefore(e,t):r.insertBefore(e,t):(r.nodeType===8?(t=r.parentNode,t.insertBefore(e,r)):(t=r,t.appendChild(e)),r=r._reactRootContainer,r!=null||t.onclick!==null||(t.onclick=yC));else if(n!==4&&(e=e.child,e!==null))for(aM(e,t,r),e=e.sibling;e!==null;)aM(e,t,r),e=e.sibling}function oM(e,t,r){var n=e.tag;if(n===5||n===6)e=e.stateNode,t?r.insertBefore(e,t):r.appendChild(e);else if(n!==4&&(e=e.child,e!==null))for(oM(e,t,r),e=e.sibling;e!==null;)oM(e,t,r),e=e.sibling}var pa=null,pu=!1;function Ud(e,t,r){for(r=r.child;r!==null;)q$(e,t,r),r=r.sibling}function q$(e,t,r){if(El&&typeof El.onCommitFiberUnmount=="function")try{El.onCommitFiberUnmount(qw,r)}catch{}switch(r.tag){case 5:La||zm(r,t);case 6:var n=pa,i=pu;pa=null,Ud(e,t,r),pa=n,pu=i,pa!==null&&(pu?(e=pa,r=r.stateNode,e.nodeType===8?e.parentNode.removeChild(r):e.removeChild(r)):pa.removeChild(r.stateNode));break;case 18:pa!==null&&(pu?(e=pa,r=r.stateNode,e.nodeType===8?KA(e.parentNode,r):e.nodeType===1&&KA(e,r),L1(e)):KA(pa,r.stateNode));break;case 4:n=pa,i=pu,pa=r.stateNode.containerInfo,pu=!0,Ud(e,t,r),pa=n,pu=i;break;case 0:case 11:case 14:case 15:if(!La&&(n=r.updateQueue,n!==null&&(n=n.lastEffect,n!==null))){i=n=n.next;do{var a=i,o=a.destroy;a=a.tag,o!==void 0&&(a&2||a&4)&&nM(r,t,o),i=i.next}while(i!==n)}Ud(e,t,r);break;case 1:if(!La&&(zm(r,t),n=r.stateNode,typeof n.componentWillUnmount=="function"))try{n.props=r.memoizedProps,n.state=r.memoizedState,n.componentWillUnmount()}catch(s){gi(r,t,s)}Ud(e,t,r);break;case 21:Ud(e,t,r);break;case 22:r.mode&1?(La=(n=La)||r.memoizedState!==null,Ud(e,t,r),La=n):Ud(e,t,r);break;default:Ud(e,t,r)}}function tB(e){var t=e.updateQueue;if(t!==null){e.updateQueue=null;var r=e.stateNode;r===null&&(r=e.stateNode=new gle),t.forEach(function(n){var i=Ple.bind(null,e,n);r.has(n)||(r.add(n),n.then(i,i))})}}function ou(e,t){var r=t.deletions;if(r!==null)for(var n=0;n<r.length;n++){var i=r[n];try{var a=e,o=t,s=o;e:for(;s!==null;){switch(s.tag){case 5:pa=s.stateNode,pu=!1;break e;case 3:pa=s.stateNode.containerInfo,pu=!0;break e;case 4:pa=s.stateNode.containerInfo,pu=!0;break e}s=s.return}if(pa===null)throw Error(Tt(160));q$(a,o,i),pa=null,pu=!1;var u=i.alternate;u!==null&&(u.return=null),i.return=null}catch(l){gi(i,t,l)}}if(t.subtreeFlags&12854)for(t=t.child;t!==null;)$$(t,e),t=t.sibling}function $$(e,t){var r=e.alternate,n=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(ou(t,e),Zu(e),n&4){try{a1(3,e,e.return),Jw(3,e)}catch(h){gi(e,e.return,h)}try{a1(5,e,e.return)}catch(h){gi(e,e.return,h)}}break;case 1:ou(t,e),Zu(e),n&512&&r!==null&&zm(r,r.return);break;case 5:if(ou(t,e),Zu(e),n&512&&r!==null&&zm(r,r.return),e.flags&32){var i=e.stateNode;try{D1(i,"")}catch(h){gi(e,e.return,h)}}if(n&4&&(i=e.stateNode,i!=null)){var a=e.memoizedProps,o=r!==null?r.memoizedProps:a,s=e.type,u=e.updateQueue;if(e.updateQueue=null,u!==null)try{s==="input"&&a.type==="radio"&&a.name!=null&&pq(i,a),MI(s,o);var l=MI(s,a);for(o=0;o<u.length;o+=2){var c=u[o],d=u[o+1];c==="style"?yq(i,d):c==="dangerouslySetInnerHTML"?mq(i,d):c==="children"?D1(i,d):WR(i,c,d,l)}switch(s){case"input":EI(i,a);break;case"textarea":hq(i,a);break;case"select":var f=i._wrapperState.wasMultiple;i._wrapperState.wasMultiple=!!a.multiple;var p=a.value;p!=null?eg(i,!!a.multiple,p,!1):f!==!!a.multiple&&(a.defaultValue!=null?eg(i,!!a.multiple,a.defaultValue,!0):eg(i,!!a.multiple,a.multiple?[]:"",!1))}i[j1]=a}catch(h){gi(e,e.return,h)}}break;case 6:if(ou(t,e),Zu(e),n&4){if(e.stateNode===null)throw Error(Tt(162));i=e.stateNode,a=e.memoizedProps;try{i.nodeValue=a}catch(h){gi(e,e.return,h)}}break;case 3:if(ou(t,e),Zu(e),n&4&&r!==null&&r.memoizedState.isDehydrated)try{L1(t.containerInfo)}catch(h){gi(e,e.return,h)}break;case 4:ou(t,e),Zu(e);break;case 13:ou(t,e),Zu(e),i=e.child,i.flags&8192&&(a=i.memoizedState!==null,i.stateNode.isHidden=a,!a||i.alternate!==null&&i.alternate.memoizedState!==null||(Ak=wi())),n&4&&tB(e);break;case 22:if(c=r!==null&&r.memoizedState!==null,e.mode&1?(La=(l=La)||c,ou(t,e),La=l):ou(t,e),Zu(e),n&8192){if(l=e.memoizedState!==null,(e.stateNode.isHidden=l)&&!c&&e.mode&1)for(zt=e,c=e.child;c!==null;){for(d=zt=c;zt!==null;){switch(f=zt,p=f.child,f.tag){case 0:case 11:case 14:case 15:a1(4,f,f.return);break;case 1:zm(f,f.return);var v=f.stateNode;if(typeof v.componentWillUnmount=="function"){n=f,r=f.return;try{t=n,v.props=t.memoizedProps,v.state=t.memoizedState,v.componentWillUnmount()}catch(h){gi(n,r,h)}}break;case 5:zm(f,f.return);break;case 22:if(f.memoizedState!==null){nB(d);continue}}p!==null?(p.return=f,zt=p):nB(d)}c=c.sibling}e:for(c=null,d=e;;){if(d.tag===5){if(c===null){c=d;try{i=d.stateNode,l?(a=i.style,typeof a.setProperty=="function"?a.setProperty("display","none","important"):a.display="none"):(s=d.stateNode,u=d.memoizedProps.style,o=u!=null&&u.hasOwnProperty("display")?u.display:null,s.style.display=gq("display",o))}catch(h){gi(e,e.return,h)}}}else if(d.tag===6){if(c===null)try{d.stateNode.nodeValue=l?"":d.memoizedProps}catch(h){gi(e,e.return,h)}}else if((d.tag!==22&&d.tag!==23||d.memoizedState===null||d===e)&&d.child!==null){d.child.return=d,d=d.child;continue}if(d===e)break e;for(;d.sibling===null;){if(d.return===null||d.return===e)break e;c===d&&(c=null),d=d.return}c===d&&(c=null),d.sibling.return=d.return,d=d.sibling}}break;case 19:ou(t,e),Zu(e),n&4&&tB(e);break;case 21:break;default:ou(t,e),Zu(e)}}function Zu(e){var t=e.flags;if(t&2){try{e:{for(var r=e.return;r!==null;){if(G$(r)){var n=r;break e}r=r.return}throw Error(Tt(160))}switch(n.tag){case 5:var i=n.stateNode;n.flags&32&&(D1(i,""),n.flags&=-33);var a=eB(e);oM(e,a,i);break;case 3:case 4:var o=n.stateNode.containerInfo,s=eB(e);aM(e,s,o);break;default:throw Error(Tt(161))}}catch(u){gi(e,e.return,u)}e.flags&=-3}t&4096&&(e.flags&=-4097)}function ble(e,t,r){zt=e,W$(e)}function W$(e,t,r){for(var n=(e.mode&1)!==0;zt!==null;){var i=zt,a=i.child;if(i.tag===22&&n){var o=i.memoizedState!==null||K2;if(!o){var s=i.alternate,u=s!==null&&s.memoizedState!==null||La;s=K2;var l=La;if(K2=o,(La=u)&&!l)for(zt=i;zt!==null;)o=zt,u=o.child,o.tag===22&&o.memoizedState!==null?iB(i):u!==null?(u.return=o,zt=u):iB(i);for(;a!==null;)zt=a,W$(a),a=a.sibling;zt=i,K2=s,La=l}rB(e)}else i.subtreeFlags&8772&&a!==null?(a.return=i,zt=a):rB(e)}}function rB(e){for(;zt!==null;){var t=zt;if(t.flags&8772){var r=t.alternate;try{if(t.flags&8772)switch(t.tag){case 0:case 11:case 15:La||Jw(5,t);break;case 1:var n=t.stateNode;if(t.flags&4&&!La)if(r===null)n.componentDidMount();else{var i=t.elementType===t.type?r.memoizedProps:du(t.type,r.memoizedProps);n.componentDidUpdate(i,r.memoizedState,n.__reactInternalSnapshotBeforeUpdate)}var a=t.updateQueue;a!==null&&UN(t,a,n);break;case 3:var o=t.updateQueue;if(o!==null){if(r=null,t.child!==null)switch(t.child.tag){case 5:r=t.child.stateNode;break;case 1:r=t.child.stateNode}UN(t,o,r)}break;case 5:var s=t.stateNode;if(r===null&&t.flags&4){r=s;var u=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":u.autoFocus&&r.focus();break;case"img":u.src&&(r.src=u.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(t.memoizedState===null){var l=t.alternate;if(l!==null){var c=l.memoizedState;if(c!==null){var d=c.dehydrated;d!==null&&L1(d)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(Tt(163))}La||t.flags&512&&iM(t)}catch(f){gi(t,t.return,f)}}if(t===e){zt=null;break}if(r=t.sibling,r!==null){r.return=t.return,zt=r;break}zt=t.return}}function nB(e){for(;zt!==null;){var t=zt;if(t===e){zt=null;break}var r=t.sibling;if(r!==null){r.return=t.return,zt=r;break}zt=t.return}}function iB(e){for(;zt!==null;){var t=zt;try{switch(t.tag){case 0:case 11:case 15:var r=t.return;try{Jw(4,t)}catch(u){gi(t,r,u)}break;case 1:var n=t.stateNode;if(typeof n.componentDidMount=="function"){var i=t.return;try{n.componentDidMount()}catch(u){gi(t,i,u)}}var a=t.return;try{iM(t)}catch(u){gi(t,a,u)}break;case 5:var o=t.return;try{iM(t)}catch(u){gi(t,o,u)}}}catch(u){gi(t,t.return,u)}if(t===e){zt=null;break}var s=t.sibling;if(s!==null){s.return=t.return,zt=s;break}zt=t.return}}var xle=Math.ceil,IC=pd.ReactCurrentDispatcher,wk=pd.ReactCurrentOwner,zs=pd.ReactCurrentBatchConfig,un=0,ua=null,Li=null,ga=0,zo=0,Vm=_p(0),Hi=0,$1=null,Xh=0,e3=0,Ek=0,o1=null,bo=null,Ak=0,Rg=1/0,dc=null,MC=!1,sM=null,Hf=null,Q2=!1,Tf=null,DC=0,s1=0,uM=null,IS=-1,MS=0;function eo(){return un&6?wi():IS!==-1?IS:IS=wi()}function Gf(e){return e.mode&1?un&2&&ga!==0?ga&-ga:nle.transition!==null?(MS===0&&(MS=Mq()),MS):(e=En,e!==0||(e=window.event,e=e===void 0?16:Nq(e.type)),e):1}function Eu(e,t,r,n){if(50<s1)throw s1=0,uM=null,Error(Tt(185));Nb(e,r,n),(!(un&2)||e!==ua)&&(e===ua&&(!(un&2)&&(e3|=r),Hi===4&&ff(e,ga)),wo(e,n),r===1&&un===0&&!(t.mode&1)&&(Rg=wi()+500,Kw&&wp()))}function wo(e,t){var r=e.callbackNode;nue(e,t);var n=hC(e,e===ua?ga:0);if(n===0)r!==null&&pN(r),e.callbackNode=null,e.callbackPriority=0;else if(t=n&-n,e.callbackPriority!==t){if(r!=null&&pN(r),t===1)e.tag===0?rle(aB.bind(null,e)):r$(aB.bind(null,e)),Zue(function(){!(un&6)&&wp()}),r=null;else{switch(Dq(n)){case 1:r=ZR;break;case 4:r=Tq;break;case 16:r=pC;break;case 536870912:r=Iq;break;default:r=pC}r=tW(r,X$.bind(null,e))}e.callbackPriority=t,e.callbackNode=r}}function X$(e,t){if(IS=-1,MS=0,un&6)throw Error(Tt(327));var r=e.callbackNode;if(ag()&&e.callbackNode!==r)return null;var n=hC(e,e===ua?ga:0);if(n===0)return null;if(n&30||n&e.expiredLanes||t)t=RC(e,n);else{t=n;var i=un;un|=2;var a=K$();(ua!==e||ga!==t)&&(dc=null,Rg=wi()+500,Mh(e,t));do try{_le();break}catch(s){Y$(e,s)}while(1);dk(),IC.current=a,un=i,Li!==null?t=0:(ua=null,ga=0,t=Hi)}if(t!==0){if(t===2&&(i=LI(e),i!==0&&(n=i,t=lM(e,i))),t===1)throw r=$1,Mh(e,0),ff(e,n),wo(e,wi()),r;if(t===6)ff(e,n);else{if(i=e.current.alternate,!(n&30)&&!Sle(i)&&(t=RC(e,n),t===2&&(a=LI(e),a!==0&&(n=a,t=lM(e,a))),t===1))throw r=$1,Mh(e,0),ff(e,n),wo(e,wi()),r;switch(e.finishedWork=i,e.finishedLanes=n,t){case 0:case 1:throw Error(Tt(345));case 2:ih(e,bo,dc);break;case 3:if(ff(e,n),(n&130023424)===n&&(t=Ak+500-wi(),10<t)){if(hC(e,0)!==0)break;if(i=e.suspendedLanes,(i&n)!==n){eo(),e.pingedLanes|=e.suspendedLanes&i;break}e.timeoutHandle=HI(ih.bind(null,e,bo,dc),t);break}ih(e,bo,dc);break;case 4:if(ff(e,n),(n&4194240)===n)break;for(t=e.eventTimes,i=-1;0<n;){var o=31-wu(n);a=1<<o,o=t[o],o>i&&(i=o),n&=~a}if(n=i,n=wi()-n,n=(120>n?120:480>n?480:1080>n?1080:1920>n?1920:3e3>n?3e3:4320>n?4320:1960*xle(n/1960))-n,10<n){e.timeoutHandle=HI(ih.bind(null,e,bo,dc),n);break}ih(e,bo,dc);break;case 5:ih(e,bo,dc);break;default:throw Error(Tt(329))}}}return wo(e,wi()),e.callbackNode===r?X$.bind(null,e):null}function lM(e,t){var r=o1;return e.current.memoizedState.isDehydrated&&(Mh(e,t).flags|=256),e=RC(e,t),e!==2&&(t=bo,bo=r,t!==null&&cM(t)),e}function cM(e){bo===null?bo=e:bo.push.apply(bo,e)}function Sle(e){for(var t=e;;){if(t.flags&16384){var r=t.updateQueue;if(r!==null&&(r=r.stores,r!==null))for(var n=0;n<r.length;n++){var i=r[n],a=i.getSnapshot;i=i.value;try{if(!Fu(a(),i))return!1}catch{return!1}}}if(r=t.child,t.subtreeFlags&16384&&r!==null)r.return=t,t=r;else{if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function ff(e,t){for(t&=~Ek,t&=~e3,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var r=31-wu(t),n=1<<r;e[r]=-1,t&=~n}}function aB(e){if(un&6)throw Error(Tt(327));ag();var t=hC(e,0);if(!(t&1))return wo(e,wi()),null;var r=RC(e,t);if(e.tag!==0&&r===2){var n=LI(e);n!==0&&(t=n,r=lM(e,n))}if(r===1)throw r=$1,Mh(e,0),ff(e,t),wo(e,wi()),r;if(r===6)throw Error(Tt(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,ih(e,bo,dc),wo(e,wi()),null}function Pk(e,t){var r=un;un|=1;try{return e(t)}finally{un=r,un===0&&(Rg=wi()+500,Kw&&wp())}}function Yh(e){Tf!==null&&Tf.tag===0&&!(un&6)&&ag();var t=un;un|=1;var r=zs.transition,n=En;try{if(zs.transition=null,En=1,e)return e()}finally{En=n,zs.transition=r,un=t,!(un&6)&&wp()}}function Tk(){zo=Vm.current,Xn(Vm)}function Mh(e,t){e.finishedWork=null,e.finishedLanes=0;var r=e.timeoutHandle;if(r!==-1&&(e.timeoutHandle=-1,Que(r)),Li!==null)for(r=Li.return;r!==null;){var n=r;switch(uk(n),n.tag){case 1:n=n.type.childContextTypes,n!=null&&bC();break;case 3:Mg(),Xn(Co),Xn(za),gk();break;case 5:mk(n);break;case 4:Mg();break;case 13:Xn(ui);break;case 19:Xn(ui);break;case 10:fk(n.type._context);break;case 22:case 23:Tk()}r=r.return}if(ua=e,Li=e=qf(e.current,null),ga=zo=t,Hi=0,$1=null,Ek=e3=Xh=0,bo=o1=null,bh!==null){for(t=0;t<bh.length;t++)if(r=bh[t],n=r.interleaved,n!==null){r.interleaved=null;var i=n.next,a=r.pending;if(a!==null){var o=a.next;a.next=i,n.next=o}r.pending=n}bh=null}return e}function Y$(e,t){do{var r=Li;try{if(dk(),AS.current=TC,PC){for(var n=di.memoizedState;n!==null;){var i=n.queue;i!==null&&(i.pending=null),n=n.next}PC=!1}if(Wh=0,oa=zi=di=null,i1=!1,H1=0,wk.current=null,r===null||r.return===null){Hi=1,$1=t,Li=null;break}e:{var a=e,o=r.return,s=r,u=t;if(t=ga,s.flags|=32768,u!==null&&typeof u=="object"&&typeof u.then=="function"){var l=u,c=s,d=c.tag;if(!(c.mode&1)&&(d===0||d===11||d===15)){var f=c.alternate;f?(c.updateQueue=f.updateQueue,c.memoizedState=f.memoizedState,c.lanes=f.lanes):(c.updateQueue=null,c.memoizedState=null)}var p=$N(o);if(p!==null){p.flags&=-257,WN(p,o,s,a,t),p.mode&1&&qN(a,l,t),t=p,u=l;var v=t.updateQueue;if(v===null){var h=new Set;h.add(u),t.updateQueue=h}else v.add(u);break e}else{if(!(t&1)){qN(a,l,t),Ik();break e}u=Error(Tt(426))}}else if(ni&&s.mode&1){var m=$N(o);if(m!==null){!(m.flags&65536)&&(m.flags|=256),WN(m,o,s,a,t),lk(Dg(u,s));break e}}a=u=Dg(u,s),Hi!==4&&(Hi=2),o1===null?o1=[a]:o1.push(a),a=o;do{switch(a.tag){case 3:a.flags|=65536,t&=-t,a.lanes|=t;var g=R$(a,u,t);BN(a,g);break e;case 1:s=u;var y=a.type,b=a.stateNode;if(!(a.flags&128)&&(typeof y.getDerivedStateFromError=="function"||b!==null&&typeof b.componentDidCatch=="function"&&(Hf===null||!Hf.has(b)))){a.flags|=65536,t&=-t,a.lanes|=t;var S=k$(a,s,t);BN(a,S);break e}}a=a.return}while(a!==null)}Z$(r)}catch(x){t=x,Li===r&&r!==null&&(Li=r=r.return);continue}break}while(1)}function K$(){var e=IC.current;return IC.current=TC,e===null?TC:e}function Ik(){(Hi===0||Hi===3||Hi===2)&&(Hi=4),ua===null||!(Xh&268435455)&&!(e3&268435455)||ff(ua,ga)}function RC(e,t){var r=un;un|=2;var n=K$();(ua!==e||ga!==t)&&(dc=null,Mh(e,t));do try{Cle();break}catch(i){Y$(e,i)}while(1);if(dk(),un=r,IC.current=n,Li!==null)throw Error(Tt(261));return ua=null,ga=0,Hi}function Cle(){for(;Li!==null;)Q$(Li)}function _le(){for(;Li!==null&&!Xse();)Q$(Li)}function Q$(e){var t=eW(e.alternate,e,zo);e.memoizedProps=e.pendingProps,t===null?Z$(e):Li=t,wk.current=null}function Z$(e){var t=e;do{var r=t.alternate;if(e=t.return,t.flags&32768){if(r=mle(r,t),r!==null){r.flags&=32767,Li=r;return}if(e!==null)e.flags|=32768,e.subtreeFlags=0,e.deletions=null;else{Hi=6,Li=null;return}}else if(r=vle(r,t,zo),r!==null){Li=r;return}if(t=t.sibling,t!==null){Li=t;return}Li=t=e}while(t!==null);Hi===0&&(Hi=5)}function ih(e,t,r){var n=En,i=zs.transition;try{zs.transition=null,En=1,wle(e,t,r,n)}finally{zs.transition=i,En=n}return null}function wle(e,t,r,n){do ag();while(Tf!==null);if(un&6)throw Error(Tt(327));r=e.finishedWork;var i=e.finishedLanes;if(r===null)return null;if(e.finishedWork=null,e.finishedLanes=0,r===e.current)throw Error(Tt(177));e.callbackNode=null,e.callbackPriority=0;var a=r.lanes|r.childLanes;if(iue(e,a),e===ua&&(Li=ua=null,ga=0),!(r.subtreeFlags&2064)&&!(r.flags&2064)||Q2||(Q2=!0,tW(pC,function(){return ag(),null})),a=(r.flags&15990)!==0,r.subtreeFlags&15990||a){a=zs.transition,zs.transition=null;var o=En;En=1;var s=un;un|=4,wk.current=null,yle(e,r),$$(r,e),Gue(zI),vC=!!jI,zI=jI=null,e.current=r,ble(r),Yse(),un=s,En=o,zs.transition=a}else e.current=r;if(Q2&&(Q2=!1,Tf=e,DC=i),a=e.pendingLanes,a===0&&(Hf=null),Zse(r.stateNode),wo(e,wi()),t!==null)for(n=e.onRecoverableError,r=0;r<t.length;r++)i=t[r],n(i.value,{componentStack:i.stack,digest:i.digest});if(MC)throw MC=!1,e=sM,sM=null,e;return DC&1&&e.tag!==0&&ag(),a=e.pendingLanes,a&1?e===uM?s1++:(s1=0,uM=e):s1=0,wp(),null}function ag(){if(Tf!==null){var e=Dq(DC),t=zs.transition,r=En;try{if(zs.transition=null,En=16>e?16:e,Tf===null)var n=!1;else{if(e=Tf,Tf=null,DC=0,un&6)throw Error(Tt(331));var i=un;for(un|=4,zt=e.current;zt!==null;){var a=zt,o=a.child;if(zt.flags&16){var s=a.deletions;if(s!==null){for(var u=0;u<s.length;u++){var l=s[u];for(zt=l;zt!==null;){var c=zt;switch(c.tag){case 0:case 11:case 15:a1(8,c,a)}var d=c.child;if(d!==null)d.return=c,zt=d;else for(;zt!==null;){c=zt;var f=c.sibling,p=c.return;if(H$(c),c===l){zt=null;break}if(f!==null){f.return=p,zt=f;break}zt=p}}}var v=a.alternate;if(v!==null){var h=v.child;if(h!==null){v.child=null;do{var m=h.sibling;h.sibling=null,h=m}while(h!==null)}}zt=a}}if(a.subtreeFlags&2064&&o!==null)o.return=a,zt=o;else e:for(;zt!==null;){if(a=zt,a.flags&2048)switch(a.tag){case 0:case 11:case 15:a1(9,a,a.return)}var g=a.sibling;if(g!==null){g.return=a.return,zt=g;break e}zt=a.return}}var y=e.current;for(zt=y;zt!==null;){o=zt;var b=o.child;if(o.subtreeFlags&2064&&b!==null)b.return=o,zt=b;else e:for(o=y;zt!==null;){if(s=zt,s.flags&2048)try{switch(s.tag){case 0:case 11:case 15:Jw(9,s)}}catch(x){gi(s,s.return,x)}if(s===o){zt=null;break e}var S=s.sibling;if(S!==null){S.return=s.return,zt=S;break e}zt=s.return}}if(un=i,wp(),El&&typeof El.onPostCommitFiberRoot=="function")try{El.onPostCommitFiberRoot(qw,e)}catch{}n=!0}return n}finally{En=r,zs.transition=t}}return!1}function oB(e,t,r){t=Dg(r,t),t=R$(e,t,1),e=Vf(e,t,1),t=eo(),e!==null&&(Nb(e,1,t),wo(e,t))}function gi(e,t,r){if(e.tag===3)oB(e,e,r);else for(;t!==null;){if(t.tag===3){oB(t,e,r);break}else if(t.tag===1){var n=t.stateNode;if(typeof t.type.getDerivedStateFromError=="function"||typeof n.componentDidCatch=="function"&&(Hf===null||!Hf.has(n))){e=Dg(r,e),e=k$(t,e,1),t=Vf(t,e,1),e=eo(),t!==null&&(Nb(t,1,e),wo(t,e));break}}t=t.return}}function Ele(e,t,r){var n=e.pingCache;n!==null&&n.delete(t),t=eo(),e.pingedLanes|=e.suspendedLanes&r,ua===e&&(ga&r)===r&&(Hi===4||Hi===3&&(ga&130023424)===ga&&500>wi()-Ak?Mh(e,0):Ek|=r),wo(e,t)}function J$(e,t){t===0&&(e.mode&1?(t=z2,z2<<=1,!(z2&130023424)&&(z2=4194304)):t=1);var r=eo();e=Vc(e,t),e!==null&&(Nb(e,t,r),wo(e,r))}function Ale(e){var t=e.memoizedState,r=0;t!==null&&(r=t.retryLane),J$(e,r)}function Ple(e,t){var r=0;switch(e.tag){case 13:var n=e.stateNode,i=e.memoizedState;i!==null&&(r=i.retryLane);break;case 19:n=e.stateNode;break;default:throw Error(Tt(314))}n!==null&&n.delete(t),J$(e,r)}var eW;eW=function(e,t,r){if(e!==null)if(e.memoizedProps!==t.pendingProps||Co.current)So=!0;else{if(!(e.lanes&r)&&!(t.flags&128))return So=!1,hle(e,t,r);So=!!(e.flags&131072)}else So=!1,ni&&t.flags&1048576&&n$(t,CC,t.index);switch(t.lanes=0,t.tag){case 2:var n=t.type;TS(e,t),e=t.pendingProps;var i=Pg(t,za.current);ig(t,r),i=bk(null,t,n,e,i,r);var a=xk();return t.flags|=1,typeof i=="object"&&i!==null&&typeof i.render=="function"&&i.$$typeof===void 0?(t.tag=1,t.memoizedState=null,t.updateQueue=null,_o(n)?(a=!0,xC(t)):a=!1,t.memoizedState=i.state!==null&&i.state!==void 0?i.state:null,hk(t),i.updater=Qw,t.stateNode=i,i._reactInternals=t,KI(t,n,e,r),t=JI(null,t,n,!0,a,r)):(t.tag=0,ni&&a&&sk(t),Za(null,t,i,r),t=t.child),t;case 16:n=t.elementType;e:{switch(TS(e,t),e=t.pendingProps,i=n._init,n=i(n._payload),t.type=n,i=t.tag=Ile(n),e=du(n,e),i){case 0:t=ZI(null,t,n,e,r);break e;case 1:t=KN(null,t,n,e,r);break e;case 11:t=XN(null,t,n,e,r);break e;case 14:t=YN(null,t,n,du(n.type,e),r);break e}throw Error(Tt(306,n,""))}return t;case 0:return n=t.type,i=t.pendingProps,i=t.elementType===n?i:du(n,i),ZI(e,t,n,i,r);case 1:return n=t.type,i=t.pendingProps,i=t.elementType===n?i:du(n,i),KN(e,t,n,i,r);case 3:e:{if(N$(t),e===null)throw Error(Tt(387));n=t.pendingProps,a=t.memoizedState,i=a.element,s$(e,t),EC(t,n,null,r);var o=t.memoizedState;if(n=o.element,a.isDehydrated)if(a={element:n,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},t.updateQueue.baseState=a,t.memoizedState=a,t.flags&256){i=Dg(Error(Tt(423)),t),t=QN(e,t,n,r,i);break e}else if(n!==i){i=Dg(Error(Tt(424)),t),t=QN(e,t,n,r,i);break e}else for($o=zf(t.stateNode.containerInfo.firstChild),Ko=t,ni=!0,vu=null,r=d$(t,null,n,r),t.child=r;r;)r.flags=r.flags&-3|4096,r=r.sibling;else{if(Tg(),n===i){t=Hc(e,t,r);break e}Za(e,t,n,r)}t=t.child}return t;case 5:return f$(t),e===null&&WI(t),n=t.type,i=t.pendingProps,a=e!==null?e.memoizedProps:null,o=i.children,VI(n,i)?o=null:a!==null&&VI(n,a)&&(t.flags|=32),F$(e,t),Za(e,t,o,r),t.child;case 6:return e===null&&WI(t),null;case 13:return B$(e,t,r);case 4:return vk(t,t.stateNode.containerInfo),n=t.pendingProps,e===null?t.child=Ig(t,null,n,r):Za(e,t,n,r),t.child;case 11:return n=t.type,i=t.pendingProps,i=t.elementType===n?i:du(n,i),XN(e,t,n,i,r);case 7:return Za(e,t,t.pendingProps,r),t.child;case 8:return Za(e,t,t.pendingProps.children,r),t.child;case 12:return Za(e,t,t.pendingProps.children,r),t.child;case 10:e:{if(n=t.type._context,i=t.pendingProps,a=t.memoizedProps,o=i.value,Bn(_C,n._currentValue),n._currentValue=o,a!==null)if(Fu(a.value,o)){if(a.children===i.children&&!Co.current){t=Hc(e,t,r);break e}}else for(a=t.child,a!==null&&(a.return=t);a!==null;){var s=a.dependencies;if(s!==null){o=a.child;for(var u=s.firstContext;u!==null;){if(u.context===n){if(a.tag===1){u=Dc(-1,r&-r),u.tag=2;var l=a.updateQueue;if(l!==null){l=l.shared;var c=l.pending;c===null?u.next=u:(u.next=c.next,c.next=u),l.pending=u}}a.lanes|=r,u=a.alternate,u!==null&&(u.lanes|=r),XI(a.return,r,t),s.lanes|=r;break}u=u.next}}else if(a.tag===10)o=a.type===t.type?null:a.child;else if(a.tag===18){if(o=a.return,o===null)throw Error(Tt(341));o.lanes|=r,s=o.alternate,s!==null&&(s.lanes|=r),XI(o,r,t),o=a.sibling}else o=a.child;if(o!==null)o.return=a;else for(o=a;o!==null;){if(o===t){o=null;break}if(a=o.sibling,a!==null){a.return=o.return,o=a;break}o=o.return}a=o}Za(e,t,i.children,r),t=t.child}return t;case 9:return i=t.type,n=t.pendingProps.children,ig(t,r),i=Gs(i),n=n(i),t.flags|=1,Za(e,t,n,r),t.child;case 14:return n=t.type,i=du(n,t.pendingProps),i=du(n.type,i),YN(e,t,n,i,r);case 15:return O$(e,t,t.type,t.pendingProps,r);case 17:return n=t.type,i=t.pendingProps,i=t.elementType===n?i:du(n,i),TS(e,t),t.tag=1,_o(n)?(e=!0,xC(t)):e=!1,ig(t,r),l$(t,n,i),KI(t,n,i,r),JI(null,t,n,!0,e,r);case 19:return U$(e,t,r);case 22:return L$(e,t,r)}throw Error(Tt(156,t.tag))};function tW(e,t){return Pq(e,t)}function Tle(e,t,r,n){this.tag=e,this.key=r,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=n,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Ns(e,t,r,n){return new Tle(e,t,r,n)}function Mk(e){return e=e.prototype,!(!e||!e.isReactComponent)}function Ile(e){if(typeof e=="function")return Mk(e)?1:0;if(e!=null){if(e=e.$$typeof,e===YR)return 11;if(e===KR)return 14}return 2}function qf(e,t){var r=e.alternate;return r===null?(r=Ns(e.tag,t,e.key,e.mode),r.elementType=e.elementType,r.type=e.type,r.stateNode=e.stateNode,r.alternate=e,e.alternate=r):(r.pendingProps=t,r.type=e.type,r.flags=0,r.subtreeFlags=0,r.deletions=null),r.flags=e.flags&14680064,r.childLanes=e.childLanes,r.lanes=e.lanes,r.child=e.child,r.memoizedProps=e.memoizedProps,r.memoizedState=e.memoizedState,r.updateQueue=e.updateQueue,t=e.dependencies,r.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext},r.sibling=e.sibling,r.index=e.index,r.ref=e.ref,r}function DS(e,t,r,n,i,a){var o=2;if(n=e,typeof e=="function")Mk(e)&&(o=1);else if(typeof e=="string")o=5;else e:switch(e){case Rm:return Dh(r.children,i,a,t);case XR:o=8,i|=8;break;case xI:return e=Ns(12,r,t,i|2),e.elementType=xI,e.lanes=a,e;case SI:return e=Ns(13,r,t,i),e.elementType=SI,e.lanes=a,e;case CI:return e=Ns(19,r,t,i),e.elementType=CI,e.lanes=a,e;case cq:return t3(r,i,a,t);default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case uq:o=10;break e;case lq:o=9;break e;case YR:o=11;break e;case KR:o=14;break e;case sf:o=16,n=null;break e}throw Error(Tt(130,e==null?e:typeof e,""))}return t=Ns(o,r,t,i),t.elementType=e,t.type=n,t.lanes=a,t}function Dh(e,t,r,n){return e=Ns(7,e,n,t),e.lanes=r,e}function t3(e,t,r,n){return e=Ns(22,e,n,t),e.elementType=cq,e.lanes=r,e.stateNode={isHidden:!1},e}function iP(e,t,r){return e=Ns(6,e,null,t),e.lanes=r,e}function aP(e,t,r){return t=Ns(4,e.children!==null?e.children:[],e.key,t),t.lanes=r,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function Mle(e,t,r,n,i){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=UA(0),this.expirationTimes=UA(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=UA(0),this.identifierPrefix=n,this.onRecoverableError=i,this.mutableSourceEagerHydrationData=null}function Dk(e,t,r,n,i,a,o,s,u){return e=new Mle(e,t,r,s,u),t===1?(t=1,a===!0&&(t|=8)):t=0,a=Ns(3,null,null,t),e.current=a,a.stateNode=e,a.memoizedState={element:n,isDehydrated:r,cache:null,transitions:null,pendingSuspenseBoundaries:null},hk(a),e}function Dle(e,t,r){var n=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Dm,key:n==null?null:""+n,children:e,containerInfo:t,implementation:r}}function rW(e){if(!e)return ip;e=e._reactInternals;e:{if(Av(e)!==e||e.tag!==1)throw Error(Tt(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(_o(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(t!==null);throw Error(Tt(171))}if(e.tag===1){var r=e.type;if(_o(r))return t$(e,r,t)}return t}function nW(e,t,r,n,i,a,o,s,u){return e=Dk(r,n,!0,e,i,a,o,s,u),e.context=rW(null),r=e.current,n=eo(),i=Gf(r),a=Dc(n,i),a.callback=t??null,Vf(r,a,i),e.current.lanes=i,Nb(e,i,n),wo(e,n),e}function r3(e,t,r,n){var i=t.current,a=eo(),o=Gf(i);return r=rW(r),t.context===null?t.context=r:t.pendingContext=r,t=Dc(a,o),t.payload={element:e},n=n===void 0?null:n,n!==null&&(t.callback=n),e=Vf(i,t,o),e!==null&&(Eu(e,i,o,a),ES(e,i,o)),o}function kC(e){if(e=e.current,!e.child)return null;switch(e.child.tag){case 5:return e.child.stateNode;default:return e.child.stateNode}}function sB(e,t){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var r=e.retryLane;e.retryLane=r!==0&&r<t?r:t}}function Rk(e,t){sB(e,t),(e=e.alternate)&&sB(e,t)}function Rle(){return null}var iW=typeof reportError=="function"?reportError:function(e){console.error(e)};function kk(e){this._internalRoot=e}n3.prototype.render=kk.prototype.render=function(e){var t=this._internalRoot;if(t===null)throw Error(Tt(409));r3(e,t,null,null)};n3.prototype.unmount=kk.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var t=e.containerInfo;Yh(function(){r3(null,e,null,null)}),t[zc]=null}};function n3(e){this._internalRoot=e}n3.prototype.unstable_scheduleHydration=function(e){if(e){var t=Oq();e={blockedOn:null,target:e,priority:t};for(var r=0;r<df.length&&t!==0&&t<df[r].priority;r++);df.splice(r,0,e),r===0&&Fq(e)}};function Ok(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function i3(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11&&(e.nodeType!==8||e.nodeValue!==" react-mount-point-unstable "))}function uB(){}function kle(e,t,r,n,i){if(i){if(typeof n=="function"){var a=n;n=function(){var l=kC(o);a.call(l)}}var o=nW(t,n,e,0,null,!1,!1,"",uB);return e._reactRootContainer=o,e[zc]=o.current,B1(e.nodeType===8?e.parentNode:e),Yh(),o}for(;i=e.lastChild;)e.removeChild(i);if(typeof n=="function"){var s=n;n=function(){var l=kC(u);s.call(l)}}var u=Dk(e,0,!1,null,null,!1,!1,"",uB);return e._reactRootContainer=u,e[zc]=u.current,B1(e.nodeType===8?e.parentNode:e),Yh(function(){r3(t,u,r,n)}),u}function a3(e,t,r,n,i){var a=r._reactRootContainer;if(a){var o=a;if(typeof i=="function"){var s=i;i=function(){var u=kC(o);s.call(u)}}r3(t,o,e,i)}else o=kle(r,t,e,i,n);return kC(o)}Rq=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var r=Dy(t.pendingLanes);r!==0&&(JR(t,r|1),wo(t,wi()),!(un&6)&&(Rg=wi()+500,wp()))}break;case 13:Yh(function(){var n=Vc(e,1);if(n!==null){var i=eo();Eu(n,e,1,i)}}),Rk(e,1)}};ek=function(e){if(e.tag===13){var t=Vc(e,134217728);if(t!==null){var r=eo();Eu(t,e,134217728,r)}Rk(e,134217728)}};kq=function(e){if(e.tag===13){var t=Gf(e),r=Vc(e,t);if(r!==null){var n=eo();Eu(r,e,t,n)}Rk(e,t)}};Oq=function(){return En};Lq=function(e,t){var r=En;try{return En=e,t()}finally{En=r}};RI=function(e,t,r){switch(t){case"input":if(EI(e,r),t=r.name,r.type==="radio"&&t!=null){for(r=e;r.parentNode;)r=r.parentNode;for(r=r.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<r.length;t++){var n=r[t];if(n!==e&&n.form===e.form){var i=Yw(n);if(!i)throw Error(Tt(90));fq(n),EI(n,i)}}}break;case"textarea":hq(e,r);break;case"select":t=r.value,t!=null&&eg(e,!!r.multiple,t,!1)}};Sq=Pk;Cq=Yh;var Ole={usingClientEntryPoint:!1,Events:[Ub,Fm,Yw,bq,xq,Pk]},W0={findFiberByHostInstance:yh,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},Lle={bundleType:W0.bundleType,version:W0.version,rendererPackageName:W0.rendererPackageName,rendererConfig:W0.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:pd.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return e=Eq(e),e===null?null:e.stateNode},findFiberByHostInstance:W0.findFiberByHostInstance||Rle,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Z2=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Z2.isDisabled&&Z2.supportsFiber)try{qw=Z2.inject(Lle),El=Z2}catch{}}cs.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Ole;cs.createPortal=function(e,t){var r=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Ok(t))throw Error(Tt(200));return Dle(e,t,null,r)};cs.createRoot=function(e,t){if(!Ok(e))throw Error(Tt(299));var r=!1,n="",i=iW;return t!=null&&(t.unstable_strictMode===!0&&(r=!0),t.identifierPrefix!==void 0&&(n=t.identifierPrefix),t.onRecoverableError!==void 0&&(i=t.onRecoverableError)),t=Dk(e,1,!1,null,null,r,!1,n,i),e[zc]=t.current,B1(e.nodeType===8?e.parentNode:e),new kk(t)};cs.findDOMNode=function(e){if(e==null)return null;if(e.nodeType===1)return e;var t=e._reactInternals;if(t===void 0)throw typeof e.render=="function"?Error(Tt(188)):(e=Object.keys(e).join(","),Error(Tt(268,e)));return e=Eq(t),e=e===null?null:e.stateNode,e};cs.flushSync=function(e){return Yh(e)};cs.hydrate=function(e,t,r){if(!i3(t))throw Error(Tt(200));return a3(null,e,t,!0,r)};cs.hydrateRoot=function(e,t,r){if(!Ok(e))throw Error(Tt(405));var n=r!=null&&r.hydratedSources||null,i=!1,a="",o=iW;if(r!=null&&(r.unstable_strictMode===!0&&(i=!0),r.identifierPrefix!==void 0&&(a=r.identifierPrefix),r.onRecoverableError!==void 0&&(o=r.onRecoverableError)),t=nW(t,null,e,1,r??null,i,!1,a,o),e[zc]=t.current,B1(e),n)for(e=0;e<n.length;e++)r=n[e],i=r._getVersion,i=i(r._source),t.mutableSourceEagerHydrationData==null?t.mutableSourceEagerHydrationData=[r,i]:t.mutableSourceEagerHydrationData.push(r,i);return new n3(t)};cs.render=function(e,t,r){if(!i3(t))throw Error(Tt(200));return a3(null,e,t,!1,r)};cs.unmountComponentAtNode=function(e){if(!i3(e))throw Error(Tt(40));return e._reactRootContainer?(Yh(function(){a3(null,null,e,!1,function(){e._reactRootContainer=null,e[zc]=null})}),!0):!1};cs.unstable_batchedUpdates=Pk;cs.unstable_renderSubtreeIntoContainer=function(e,t,r,n){if(!i3(r))throw Error(Tt(200));if(e==null||e._reactInternals===void 0)throw Error(Tt(38));return a3(e,t,r,!1,n)};cs.version="18.2.0-next-9e3b772b8-20220608";function aW(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(aW)}catch(e){console.error(e)}}aW(),nq.exports=cs;var o3=nq.exports,lB=o3;yI.createRoot=lB.createRoot,yI.hydrateRoot=lB.hydrateRoot;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const oW=function(e){const t=[];let r=0;for(let n=0;n<e.length;n++){let i=e.charCodeAt(n);i<128?t[r++]=i:i<2048?(t[r++]=i>>6|192,t[r++]=i&63|128):(i&64512)===55296&&n+1<e.length&&(e.charCodeAt(n+1)&64512)===56320?(i=65536+((i&1023)<<10)+(e.charCodeAt(++n)&1023),t[r++]=i>>18|240,t[r++]=i>>12&63|128,t[r++]=i>>6&63|128,t[r++]=i&63|128):(t[r++]=i>>12|224,t[r++]=i>>6&63|128,t[r++]=i&63|128)}return t},Fle=function(e){const t=[];let r=0,n=0;for(;r<e.length;){const i=e[r++];if(i<128)t[n++]=String.fromCharCode(i);else if(i>191&&i<224){const a=e[r++];t[n++]=String.fromCharCode((i&31)<<6|a&63)}else if(i>239&&i<365){const a=e[r++],o=e[r++],s=e[r++],u=((i&7)<<18|(a&63)<<12|(o&63)<<6|s&63)-65536;t[n++]=String.fromCharCode(55296+(u>>10)),t[n++]=String.fromCharCode(56320+(u&1023))}else{const a=e[r++],o=e[r++];t[n++]=String.fromCharCode((i&15)<<12|(a&63)<<6|o&63)}}return t.join("")},sW={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();const r=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,n=[];for(let i=0;i<e.length;i+=3){const a=e[i],o=i+1<e.length,s=o?e[i+1]:0,u=i+2<e.length,l=u?e[i+2]:0,c=a>>2,d=(a&3)<<4|s>>4;let f=(s&15)<<2|l>>6,p=l&63;u||(p=64,o||(f=64)),n.push(r[c],r[d],r[f],r[p])}return n.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(oW(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):Fle(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();const r=t?this.charToByteMapWebSafe_:this.charToByteMap_,n=[];for(let i=0;i<e.length;){const a=r[e.charAt(i++)],s=i<e.length?r[e.charAt(i)]:0;++i;const l=i<e.length?r[e.charAt(i)]:64;++i;const d=i<e.length?r[e.charAt(i)]:64;if(++i,a==null||s==null||l==null||d==null)throw new Nle;const f=a<<2|s>>4;if(n.push(f),l!==64){const p=s<<4&240|l>>2;if(n.push(p),d!==64){const v=l<<6&192|d;n.push(v)}}}return n},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class Nle extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const Ble=function(e){const t=oW(e);return sW.encodeByteArray(t,!0)},uW=function(e){return Ble(e).replace(/\./g,"")},lW=function(e){try{return sW.decodeString(e,!0)}catch(t){console.error("base64Decode failed: ",t)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ule(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jle=()=>Ule().__FIREBASE_DEFAULTS__,zle=()=>{if(typeof process>"u"||typeof process.env>"u")return;const e={}.__FIREBASE_DEFAULTS__;if(e)return JSON.parse(e)},Vle=()=>{if(typeof document>"u")return;let e;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const t=e&&lW(e[1]);return t&&JSON.parse(t)},Lk=()=>{try{return jle()||zle()||Vle()}catch(e){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`);return}},Hle=e=>{var t,r;return(r=(t=Lk())===null||t===void 0?void 0:t.emulatorHosts)===null||r===void 0?void 0:r[e]},cW=()=>{var e;return(e=Lk())===null||e===void 0?void 0:e.config},dW=e=>{var t;return(t=Lk())===null||t===void 0?void 0:t[`_${e}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gle{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((t,r)=>{this.resolve=t,this.reject=r})}wrapCallback(t){return(r,n)=>{r?this.reject(r):this.resolve(n),typeof t=="function"&&(this.promise.catch(()=>{}),t.length===1?t(r):t(r,n))}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Va(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function qle(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Va())}function $le(){const e=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof e=="object"&&e.id!==void 0}function Wle(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function Xle(){const e=Va();return e.indexOf("MSIE ")>=0||e.indexOf("Trident/")>=0}function Yle(){try{return typeof indexedDB=="object"}catch{return!1}}function Kle(){return new Promise((e,t)=>{try{let r=!0;const n="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(n);i.onsuccess=()=>{i.result.close(),r||self.indexedDB.deleteDatabase(n),e(!0)},i.onupgradeneeded=()=>{r=!1},i.onerror=()=>{var a;t(((a=i.error)===null||a===void 0?void 0:a.message)||"")}}catch(r){t(r)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Qle="FirebaseError";class Ep extends Error{constructor(t,r,n){super(r),this.code=t,this.customData=n,this.name=Qle,Object.setPrototypeOf(this,Ep.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,zb.prototype.create)}}class zb{constructor(t,r,n){this.service=t,this.serviceName=r,this.errors=n}create(t,...r){const n=r[0]||{},i=`${this.service}/${t}`,a=this.errors[t],o=a?Zle(a,n):"Error",s=`${this.serviceName}: ${o} (${i}).`;return new Ep(i,s,n)}}function Zle(e,t){return e.replace(Jle,(r,n)=>{const i=t[n];return i!=null?String(i):`<${n}?>`})}const Jle=/\{\$([^}]+)}/g;function ece(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}function OC(e,t){if(e===t)return!0;const r=Object.keys(e),n=Object.keys(t);for(const i of r){if(!n.includes(i))return!1;const a=e[i],o=t[i];if(cB(a)&&cB(o)){if(!OC(a,o))return!1}else if(a!==o)return!1}for(const i of n)if(!r.includes(i))return!1;return!0}function cB(e){return e!==null&&typeof e=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Vb(e){const t=[];for(const[r,n]of Object.entries(e))Array.isArray(n)?n.forEach(i=>{t.push(encodeURIComponent(r)+"="+encodeURIComponent(i))}):t.push(encodeURIComponent(r)+"="+encodeURIComponent(n));return t.length?"&"+t.join("&"):""}function ky(e){const t={};return e.replace(/^\?/,"").split("&").forEach(n=>{if(n){const[i,a]=n.split("=");t[decodeURIComponent(i)]=decodeURIComponent(a)}}),t}function Oy(e){const t=e.indexOf("?");if(!t)return"";const r=e.indexOf("#",t);return e.substring(t,r>0?r:void 0)}function tce(e,t){const r=new rce(e,t);return r.subscribe.bind(r)}class rce{constructor(t,r){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=r,this.task.then(()=>{t(this)}).catch(n=>{this.error(n)})}next(t){this.forEachObserver(r=>{r.next(t)})}error(t){this.forEachObserver(r=>{r.error(t)}),this.close(t)}complete(){this.forEachObserver(t=>{t.complete()}),this.close()}subscribe(t,r,n){let i;if(t===void 0&&r===void 0&&n===void 0)throw new Error("Missing Observer.");nce(t,["next","error","complete"])?i=t:i={next:t,error:r,complete:n},i.next===void 0&&(i.next=oP),i.error===void 0&&(i.error=oP),i.complete===void 0&&(i.complete=oP);const a=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?i.error(this.finalError):i.complete()}catch{}}),this.observers.push(i),a}unsubscribeOne(t){this.observers===void 0||this.observers[t]===void 0||(delete this.observers[t],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(t){if(!this.finalized)for(let r=0;r<this.observers.length;r++)this.sendOne(r,t)}sendOne(t,r){this.task.then(()=>{if(this.observers!==void 0&&this.observers[t]!==void 0)try{r(this.observers[t])}catch(n){typeof console<"u"&&console.error&&console.error(n)}})}close(t){this.finalized||(this.finalized=!0,t!==void 0&&(this.finalError=t),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function nce(e,t){if(typeof e!="object"||e===null)return!1;for(const r of t)if(r in e&&typeof e[r]=="function")return!0;return!1}function oP(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hd(e){return e&&e._delegate?e._delegate:e}class kg{constructor(t,r,n){this.name=t,this.instanceFactory=r,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(t){return this.instantiationMode=t,this}setMultipleInstances(t){return this.multipleInstances=t,this}setServiceProps(t){return this.serviceProps=t,this}setInstanceCreatedCallback(t){return this.onInstanceCreated=t,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ah="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let ice=class{constructor(t,r){this.name=t,this.container=r,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(t){const r=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(r)){const n=new Gle;if(this.instancesDeferred.set(r,n),this.isInitialized(r)||this.shouldAutoInitialize())try{const i=this.getOrInitializeService({instanceIdentifier:r});i&&n.resolve(i)}catch{}}return this.instancesDeferred.get(r).promise}getImmediate(t){var r;const n=this.normalizeInstanceIdentifier(t==null?void 0:t.identifier),i=(r=t==null?void 0:t.optional)!==null&&r!==void 0?r:!1;if(this.isInitialized(n)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:n})}catch(a){if(i)return null;throw a}else{if(i)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(t){if(t.name!==this.name)throw Error(`Mismatching Component ${t.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=t,!!this.shouldAutoInitialize()){if(oce(t))try{this.getOrInitializeService({instanceIdentifier:ah})}catch{}for(const[r,n]of this.instancesDeferred.entries()){const i=this.normalizeInstanceIdentifier(r);try{const a=this.getOrInitializeService({instanceIdentifier:i});n.resolve(a)}catch{}}}}clearInstance(t=ah){this.instancesDeferred.delete(t),this.instancesOptions.delete(t),this.instances.delete(t)}async delete(){const t=Array.from(this.instances.values());await Promise.all([...t.filter(r=>"INTERNAL"in r).map(r=>r.INTERNAL.delete()),...t.filter(r=>"_delete"in r).map(r=>r._delete())])}isComponentSet(){return this.component!=null}isInitialized(t=ah){return this.instances.has(t)}getOptions(t=ah){return this.instancesOptions.get(t)||{}}initialize(t={}){const{options:r={}}=t,n=this.normalizeInstanceIdentifier(t.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const i=this.getOrInitializeService({instanceIdentifier:n,options:r});for(const[a,o]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(a);n===s&&o.resolve(i)}return i}onInit(t,r){var n;const i=this.normalizeInstanceIdentifier(r),a=(n=this.onInitCallbacks.get(i))!==null&&n!==void 0?n:new Set;a.add(t),this.onInitCallbacks.set(i,a);const o=this.instances.get(i);return o&&t(o,i),()=>{a.delete(t)}}invokeOnInitCallbacks(t,r){const n=this.onInitCallbacks.get(r);if(n)for(const i of n)try{i(t,r)}catch{}}getOrInitializeService({instanceIdentifier:t,options:r={}}){let n=this.instances.get(t);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:ace(t),options:r}),this.instances.set(t,n),this.instancesOptions.set(t,r),this.invokeOnInitCallbacks(n,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,n)}catch{}return n||null}normalizeInstanceIdentifier(t=ah){return this.component?this.component.multipleInstances?t:ah:t}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}};function ace(e){return e===ah?void 0:e}function oce(e){return e.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sce{constructor(t){this.name=t,this.providers=new Map}addComponent(t){const r=this.getProvider(t.name);if(r.isComponentSet())throw new Error(`Component ${t.name} has already been registered with ${this.name}`);r.setComponent(t)}addOrOverwriteComponent(t){this.getProvider(t.name).isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)}getProvider(t){if(this.providers.has(t))return this.providers.get(t);const r=new ice(t,this);return this.providers.set(t,r),r}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Rn;(function(e){e[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"})(Rn||(Rn={}));const uce={debug:Rn.DEBUG,verbose:Rn.VERBOSE,info:Rn.INFO,warn:Rn.WARN,error:Rn.ERROR,silent:Rn.SILENT},lce=Rn.INFO,cce={[Rn.DEBUG]:"log",[Rn.VERBOSE]:"log",[Rn.INFO]:"info",[Rn.WARN]:"warn",[Rn.ERROR]:"error"},dce=(e,t,...r)=>{if(t<e.logLevel)return;const n=new Date().toISOString(),i=cce[t];if(i)console[i](`[${n}]  ${e.name}:`,...r);else throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`)};class fW{constructor(t){this.name=t,this._logLevel=lce,this._logHandler=dce,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(t){if(!(t in Rn))throw new TypeError(`Invalid value "${t}" assigned to \`logLevel\``);this._logLevel=t}setLogLevel(t){this._logLevel=typeof t=="string"?uce[t]:t}get logHandler(){return this._logHandler}set logHandler(t){if(typeof t!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t}get userLogHandler(){return this._userLogHandler}set userLogHandler(t){this._userLogHandler=t}debug(...t){this._userLogHandler&&this._userLogHandler(this,Rn.DEBUG,...t),this._logHandler(this,Rn.DEBUG,...t)}log(...t){this._userLogHandler&&this._userLogHandler(this,Rn.VERBOSE,...t),this._logHandler(this,Rn.VERBOSE,...t)}info(...t){this._userLogHandler&&this._userLogHandler(this,Rn.INFO,...t),this._logHandler(this,Rn.INFO,...t)}warn(...t){this._userLogHandler&&this._userLogHandler(this,Rn.WARN,...t),this._logHandler(this,Rn.WARN,...t)}error(...t){this._userLogHandler&&this._userLogHandler(this,Rn.ERROR,...t),this._logHandler(this,Rn.ERROR,...t)}}const fce=(e,t)=>t.some(r=>e instanceof r);let dB,fB;function pce(){return dB||(dB=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function hce(){return fB||(fB=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const pW=new WeakMap,dM=new WeakMap,hW=new WeakMap,sP=new WeakMap,Fk=new WeakMap;function vce(e){const t=new Promise((r,n)=>{const i=()=>{e.removeEventListener("success",a),e.removeEventListener("error",o)},a=()=>{r($f(e.result)),i()},o=()=>{n(e.error),i()};e.addEventListener("success",a),e.addEventListener("error",o)});return t.then(r=>{r instanceof IDBCursor&&pW.set(r,e)}).catch(()=>{}),Fk.set(t,e),t}function mce(e){if(dM.has(e))return;const t=new Promise((r,n)=>{const i=()=>{e.removeEventListener("complete",a),e.removeEventListener("error",o),e.removeEventListener("abort",o)},a=()=>{r(),i()},o=()=>{n(e.error||new DOMException("AbortError","AbortError")),i()};e.addEventListener("complete",a),e.addEventListener("error",o),e.addEventListener("abort",o)});dM.set(e,t)}let fM={get(e,t,r){if(e instanceof IDBTransaction){if(t==="done")return dM.get(e);if(t==="objectStoreNames")return e.objectStoreNames||hW.get(e);if(t==="store")return r.objectStoreNames[1]?void 0:r.objectStore(r.objectStoreNames[0])}return $f(e[t])},set(e,t,r){return e[t]=r,!0},has(e,t){return e instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in e}};function gce(e){fM=e(fM)}function yce(e){return e===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(t,...r){const n=e.call(uP(this),t,...r);return hW.set(n,t.sort?t.sort():[t]),$f(n)}:hce().includes(e)?function(...t){return e.apply(uP(this),t),$f(pW.get(this))}:function(...t){return $f(e.apply(uP(this),t))}}function bce(e){return typeof e=="function"?yce(e):(e instanceof IDBTransaction&&mce(e),fce(e,pce())?new Proxy(e,fM):e)}function $f(e){if(e instanceof IDBRequest)return vce(e);if(sP.has(e))return sP.get(e);const t=bce(e);return t!==e&&(sP.set(e,t),Fk.set(t,e)),t}const uP=e=>Fk.get(e);function xce(e,t,{blocked:r,upgrade:n,blocking:i,terminated:a}={}){const o=indexedDB.open(e,t),s=$f(o);return n&&o.addEventListener("upgradeneeded",u=>{n($f(o.result),u.oldVersion,u.newVersion,$f(o.transaction),u)}),r&&o.addEventListener("blocked",u=>r(u.oldVersion,u.newVersion,u)),s.then(u=>{a&&u.addEventListener("close",()=>a()),i&&u.addEventListener("versionchange",l=>i(l.oldVersion,l.newVersion,l))}).catch(()=>{}),s}const Sce=["get","getKey","getAll","getAllKeys","count"],Cce=["put","add","delete","clear"],lP=new Map;function pB(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&typeof t=="string"))return;if(lP.get(t))return lP.get(t);const r=t.replace(/FromIndex$/,""),n=t!==r,i=Cce.includes(r);if(!(r in(n?IDBIndex:IDBObjectStore).prototype)||!(i||Sce.includes(r)))return;const a=async function(o,...s){const u=this.transaction(o,i?"readwrite":"readonly");let l=u.store;return n&&(l=l.index(s.shift())),(await Promise.all([l[r](...s),i&&u.done]))[0]};return lP.set(t,a),a}gce(e=>({...e,get:(t,r,n)=>pB(t,r)||e.get(t,r,n),has:(t,r)=>!!pB(t,r)||e.has(t,r)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _ce{constructor(t){this.container=t}getPlatformInfoString(){return this.container.getProviders().map(r=>{if(wce(r)){const n=r.getImmediate();return`${n.library}/${n.version}`}else return null}).filter(r=>r).join(" ")}}function wce(e){const t=e.getComponent();return(t==null?void 0:t.type)==="VERSION"}const pM="@firebase/app",hB="0.9.10";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Kh=new fW("@firebase/app"),Ece="@firebase/app-compat",Ace="@firebase/analytics-compat",Pce="@firebase/analytics",Tce="@firebase/app-check-compat",Ice="@firebase/app-check",Mce="@firebase/auth",Dce="@firebase/auth-compat",Rce="@firebase/database",kce="@firebase/database-compat",Oce="@firebase/functions",Lce="@firebase/functions-compat",Fce="@firebase/installations",Nce="@firebase/installations-compat",Bce="@firebase/messaging",Uce="@firebase/messaging-compat",jce="@firebase/performance",zce="@firebase/performance-compat",Vce="@firebase/remote-config",Hce="@firebase/remote-config-compat",Gce="@firebase/storage",qce="@firebase/storage-compat",$ce="@firebase/firestore",Wce="@firebase/firestore-compat",Xce="firebase",Yce="9.22.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hM="[DEFAULT]",Kce={[pM]:"fire-core",[Ece]:"fire-core-compat",[Pce]:"fire-analytics",[Ace]:"fire-analytics-compat",[Ice]:"fire-app-check",[Tce]:"fire-app-check-compat",[Mce]:"fire-auth",[Dce]:"fire-auth-compat",[Rce]:"fire-rtdb",[kce]:"fire-rtdb-compat",[Oce]:"fire-fn",[Lce]:"fire-fn-compat",[Fce]:"fire-iid",[Nce]:"fire-iid-compat",[Bce]:"fire-fcm",[Uce]:"fire-fcm-compat",[jce]:"fire-perf",[zce]:"fire-perf-compat",[Vce]:"fire-rc",[Hce]:"fire-rc-compat",[Gce]:"fire-gcs",[qce]:"fire-gcs-compat",[$ce]:"fire-fst",[Wce]:"fire-fst-compat","fire-js":"fire-js",[Xce]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const LC=new Map,vM=new Map;function Qce(e,t){try{e.container.addComponent(t)}catch(r){Kh.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,r)}}function W1(e){const t=e.name;if(vM.has(t))return Kh.debug(`There were multiple attempts to register component ${t}.`),!1;vM.set(t,e);for(const r of LC.values())Qce(r,e);return!0}function vW(e,t){const r=e.container.getProvider("heartbeat").getImmediate({optional:!0});return r&&r.triggerHeartbeat(),e.container.getProvider(t)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Zce={["no-app"]:"No Firebase App '{$appName}' has been created - call initializeApp() first",["bad-app-name"]:"Illegal App name: '{$appName}",["duplicate-app"]:"Firebase App named '{$appName}' already exists with different options or config",["app-deleted"]:"Firebase App named '{$appName}' already deleted",["no-options"]:"Need to provide options, when not being deployed to hosting via source.",["invalid-app-argument"]:"firebase.{$appName}() takes either no argument or a Firebase App instance.",["invalid-log-argument"]:"First argument to `onLog` must be null or a function.",["idb-open"]:"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.",["idb-get"]:"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.",["idb-set"]:"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.",["idb-delete"]:"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}."},Wf=new zb("app","Firebase",Zce);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jce{constructor(t,r,n){this._isDeleted=!1,this._options=Object.assign({},t),this._config=Object.assign({},r),this._name=r.name,this._automaticDataCollectionEnabled=r.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new kg("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(t){this.checkDestroyed(),this._automaticDataCollectionEnabled=t}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(t){this._isDeleted=t}checkDestroyed(){if(this.isDeleted)throw Wf.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Hb=Yce;function mW(e,t={}){let r=e;typeof t!="object"&&(t={name:t});const n=Object.assign({name:hM,automaticDataCollectionEnabled:!1},t),i=n.name;if(typeof i!="string"||!i)throw Wf.create("bad-app-name",{appName:String(i)});if(r||(r=cW()),!r)throw Wf.create("no-options");const a=LC.get(i);if(a){if(OC(r,a.options)&&OC(n,a.config))return a;throw Wf.create("duplicate-app",{appName:i})}const o=new sce(i);for(const u of vM.values())o.addComponent(u);const s=new Jce(r,n,o);return LC.set(i,s),s}function ede(e=hM){const t=LC.get(e);if(!t&&e===hM&&cW())return mW();if(!t)throw Wf.create("no-app",{appName:e});return t}function og(e,t,r){var n;let i=(n=Kce[e])!==null&&n!==void 0?n:e;r&&(i+=`-${r}`);const a=i.match(/\s|\//),o=t.match(/\s|\//);if(a||o){const s=[`Unable to register library "${i}" with version "${t}":`];a&&s.push(`library name "${i}" contains illegal characters (whitespace or "/")`),a&&o&&s.push("and"),o&&s.push(`version name "${t}" contains illegal characters (whitespace or "/")`),Kh.warn(s.join(" "));return}W1(new kg(`${i}-version`,()=>({library:i,version:t}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tde="firebase-heartbeat-database",rde=1,X1="firebase-heartbeat-store";let cP=null;function gW(){return cP||(cP=xce(tde,rde,{upgrade:(e,t)=>{switch(t){case 0:e.createObjectStore(X1)}}}).catch(e=>{throw Wf.create("idb-open",{originalErrorMessage:e.message})})),cP}async function nde(e){try{return await(await gW()).transaction(X1).objectStore(X1).get(yW(e))}catch(t){if(t instanceof Ep)Kh.warn(t.message);else{const r=Wf.create("idb-get",{originalErrorMessage:t==null?void 0:t.message});Kh.warn(r.message)}}}async function vB(e,t){try{const n=(await gW()).transaction(X1,"readwrite");await n.objectStore(X1).put(t,yW(e)),await n.done}catch(r){if(r instanceof Ep)Kh.warn(r.message);else{const n=Wf.create("idb-set",{originalErrorMessage:r==null?void 0:r.message});Kh.warn(n.message)}}}function yW(e){return`${e.name}!${e.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ide=1024,ade=30*24*60*60*1e3;class ode{constructor(t){this.container=t,this._heartbeatsCache=null;const r=this.container.getProvider("app").getImmediate();this._storage=new ude(r),this._heartbeatsCachePromise=this._storage.read().then(n=>(this._heartbeatsCache=n,n))}async triggerHeartbeat(){const r=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),n=mB();if(this._heartbeatsCache===null&&(this._heartbeatsCache=await this._heartbeatsCachePromise),!(this._heartbeatsCache.lastSentHeartbeatDate===n||this._heartbeatsCache.heartbeats.some(i=>i.date===n)))return this._heartbeatsCache.heartbeats.push({date:n,agent:r}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(i=>{const a=new Date(i.date).valueOf();return Date.now()-a<=ade}),this._storage.overwrite(this._heartbeatsCache)}async getHeartbeatsHeader(){if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,this._heartbeatsCache===null||this._heartbeatsCache.heartbeats.length===0)return"";const t=mB(),{heartbeatsToSend:r,unsentEntries:n}=sde(this._heartbeatsCache.heartbeats),i=uW(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=t,n.length>0?(this._heartbeatsCache.heartbeats=n,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}}function mB(){return new Date().toISOString().substring(0,10)}function sde(e,t=ide){const r=[];let n=e.slice();for(const i of e){const a=r.find(o=>o.agent===i.agent);if(a){if(a.dates.push(i.date),gB(r)>t){a.dates.pop();break}}else if(r.push({agent:i.agent,dates:[i.date]}),gB(r)>t){r.pop();break}n=n.slice(1)}return{heartbeatsToSend:r,unsentEntries:n}}class ude{constructor(t){this.app=t,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return Yle()?Kle().then(()=>!0).catch(()=>!1):!1}async read(){return await this._canUseIndexedDBPromise?await nde(this.app)||{heartbeats:[]}:{heartbeats:[]}}async overwrite(t){var r;if(await this._canUseIndexedDBPromise){const i=await this.read();return vB(this.app,{lastSentHeartbeatDate:(r=t.lastSentHeartbeatDate)!==null&&r!==void 0?r:i.lastSentHeartbeatDate,heartbeats:t.heartbeats})}else return}async add(t){var r;if(await this._canUseIndexedDBPromise){const i=await this.read();return vB(this.app,{lastSentHeartbeatDate:(r=t.lastSentHeartbeatDate)!==null&&r!==void 0?r:i.lastSentHeartbeatDate,heartbeats:[...i.heartbeats,...t.heartbeats]})}else return}}function gB(e){return uW(JSON.stringify({version:2,heartbeats:e})).length}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lde(e){W1(new kg("platform-logger",t=>new _ce(t),"PRIVATE")),W1(new kg("heartbeat",t=>new ode(t),"PRIVATE")),og(pM,hB,e),og(pM,hB,"esm2017"),og("fire-js","")}lde("");var cde="firebase",dde="9.22.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */og(cde,dde,"app");function Nk(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]]);return r}function bW(){return{["dependent-sdk-initialized-before-auth"]:"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const fde=bW,xW=new zb("auth","Firebase",bW());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const FC=new fW("@firebase/auth");function pde(e,...t){FC.logLevel<=Rn.WARN&&FC.warn(`Auth (${Hb}): ${e}`,...t)}function RS(e,...t){FC.logLevel<=Rn.ERROR&&FC.error(`Auth (${Hb}): ${e}`,...t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Nu(e,...t){throw Bk(e,...t)}function Pl(e,...t){return Bk(e,...t)}function hde(e,t,r){const n=Object.assign(Object.assign({},fde()),{[t]:r});return new zb("auth","Firebase",n).create(t,{appName:e.name})}function Bk(e,...t){if(typeof e!="string"){const r=t[0],n=[...t.slice(1)];return n[0]&&(n[0].appName=e.name),e._errorFactory.create(r,...n)}return xW.create(e,...t)}function xr(e,t,...r){if(!e)throw Bk(t,...r)}function _c(e){const t="INTERNAL ASSERTION FAILED: "+e;throw RS(t),new Error(t)}function Gc(e,t){e||_c(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mM(){var e;return typeof self<"u"&&((e=self.location)===null||e===void 0?void 0:e.href)||""}function vde(){return yB()==="http:"||yB()==="https:"}function yB(){var e;return typeof self<"u"&&((e=self.location)===null||e===void 0?void 0:e.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mde(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(vde()||$le()||"connection"in navigator)?navigator.onLine:!0}function gde(){if(typeof navigator>"u")return null;const e=navigator;return e.languages&&e.languages[0]||e.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gb{constructor(t,r){this.shortDelay=t,this.longDelay=r,Gc(r>t,"Short delay should be less than long delay!"),this.isMobile=qle()||Wle()}get(){return mde()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Uk(e,t){Gc(e.emulator,"Emulator should always be set here");const{url:r}=e.emulator;return t?`${r}${t.startsWith("/")?t.slice(1):t}`:r}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SW{static initialize(t,r,n){this.fetchImpl=t,r&&(this.headersImpl=r),n&&(this.responseImpl=n)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;_c("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;_c("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;_c("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yde={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bde=new Gb(3e4,6e4);function a0(e,t){return e.tenantId&&!t.tenantId?Object.assign(Object.assign({},t),{tenantId:e.tenantId}):t}async function o0(e,t,r,n,i={}){return CW(e,i,async()=>{let a={},o={};n&&(t==="GET"?o=n:a={body:JSON.stringify(n)});const s=Vb(Object.assign({key:e.config.apiKey},o)).slice(1),u=await e._getAdditionalHeaders();return u["Content-Type"]="application/json",e.languageCode&&(u["X-Firebase-Locale"]=e.languageCode),SW.fetch()(_W(e,e.config.apiHost,r,s),Object.assign({method:t,headers:u,referrerPolicy:"no-referrer"},a))})}async function CW(e,t,r){e._canInitEmulator=!1;const n=Object.assign(Object.assign({},yde),t);try{const i=new xde(e),a=await Promise.race([r(),i.promise]);i.clearNetworkTimeout();const o=await a.json();if("needConfirmation"in o)throw J2(e,"account-exists-with-different-credential",o);if(a.ok&&!("errorMessage"in o))return o;{const s=a.ok?o.errorMessage:o.error.message,[u,l]=s.split(" : ");if(u==="FEDERATED_USER_ID_ALREADY_LINKED")throw J2(e,"credential-already-in-use",o);if(u==="EMAIL_EXISTS")throw J2(e,"email-already-in-use",o);if(u==="USER_DISABLED")throw J2(e,"user-disabled",o);const c=n[u]||u.toLowerCase().replace(/[_\s]+/g,"-");if(l)throw hde(e,c,l);Nu(e,c)}}catch(i){if(i instanceof Ep)throw i;Nu(e,"network-request-failed",{message:String(i)})}}async function qb(e,t,r,n,i={}){const a=await o0(e,t,r,n,i);return"mfaPendingCredential"in a&&Nu(e,"multi-factor-auth-required",{_serverResponse:a}),a}function _W(e,t,r,n){const i=`${t}${r}?${n}`;return e.config.emulator?Uk(e.config,i):`${e.config.apiScheme}://${i}`}class xde{constructor(t){this.auth=t,this.timer=null,this.promise=new Promise((r,n)=>{this.timer=setTimeout(()=>n(Pl(this.auth,"network-request-failed")),bde.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function J2(e,t,r){const n={appName:e.name};r.email&&(n.email=r.email),r.phoneNumber&&(n.phoneNumber=r.phoneNumber);const i=Pl(e,t,n);return i.customData._tokenResponse=r,i}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Sde(e,t){return o0(e,"POST","/v1/accounts:delete",t)}async function Cde(e,t){return o0(e,"POST","/v1/accounts:lookup",t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function u1(e){if(e)try{const t=new Date(Number(e));if(!isNaN(t.getTime()))return t.toUTCString()}catch{}}async function _de(e,t=!1){const r=hd(e),n=await r.getIdToken(t),i=jk(n);xr(i&&i.exp&&i.auth_time&&i.iat,r.auth,"internal-error");const a=typeof i.firebase=="object"?i.firebase:void 0,o=a==null?void 0:a.sign_in_provider;return{claims:i,token:n,authTime:u1(dP(i.auth_time)),issuedAtTime:u1(dP(i.iat)),expirationTime:u1(dP(i.exp)),signInProvider:o||null,signInSecondFactor:(a==null?void 0:a.sign_in_second_factor)||null}}function dP(e){return Number(e)*1e3}function jk(e){const[t,r,n]=e.split(".");if(t===void 0||r===void 0||n===void 0)return RS("JWT malformed, contained fewer than 3 sections"),null;try{const i=lW(r);return i?JSON.parse(i):(RS("Failed to decode base64 JWT payload"),null)}catch(i){return RS("Caught error parsing JWT payload as JSON",i==null?void 0:i.toString()),null}}function wde(e){const t=jk(e);return xr(t,"internal-error"),xr(typeof t.exp<"u","internal-error"),xr(typeof t.iat<"u","internal-error"),Number(t.exp)-Number(t.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Y1(e,t,r=!1){if(r)return t;try{return await t}catch(n){throw n instanceof Ep&&Ede(n)&&e.auth.currentUser===e&&await e.auth.signOut(),n}}function Ede({code:e}){return e==="auth/user-disabled"||e==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ade{constructor(t){this.user=t,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(t){var r;if(t){const n=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),n}else{this.errorBackoff=3e4;const i=((r=this.user.stsTokenManager.expirationTime)!==null&&r!==void 0?r:0)-Date.now()-3e5;return Math.max(0,i)}}schedule(t=!1){if(!this.isRunning)return;const r=this.getInterval(t);this.timerId=setTimeout(async()=>{await this.iteration()},r)}async iteration(){try{await this.user.getIdToken(!0)}catch(t){(t==null?void 0:t.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wW{constructor(t,r){this.createdAt=t,this.lastLoginAt=r,this._initializeTime()}_initializeTime(){this.lastSignInTime=u1(this.lastLoginAt),this.creationTime=u1(this.createdAt)}_copy(t){this.createdAt=t.createdAt,this.lastLoginAt=t.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function NC(e){var t;const r=e.auth,n=await e.getIdToken(),i=await Y1(e,Cde(r,{idToken:n}));xr(i==null?void 0:i.users.length,r,"internal-error");const a=i.users[0];e._notifyReloadListener(a);const o=!((t=a.providerUserInfo)===null||t===void 0)&&t.length?Ide(a.providerUserInfo):[],s=Tde(e.providerData,o),u=e.isAnonymous,l=!(e.email&&a.passwordHash)&&!(s!=null&&s.length),c=u?l:!1,d={uid:a.localId,displayName:a.displayName||null,photoURL:a.photoUrl||null,email:a.email||null,emailVerified:a.emailVerified||!1,phoneNumber:a.phoneNumber||null,tenantId:a.tenantId||null,providerData:s,metadata:new wW(a.createdAt,a.lastLoginAt),isAnonymous:c};Object.assign(e,d)}async function Pde(e){const t=hd(e);await NC(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}function Tde(e,t){return[...e.filter(n=>!t.some(i=>i.providerId===n.providerId)),...t]}function Ide(e){return e.map(t=>{var{providerId:r}=t,n=Nk(t,["providerId"]);return{providerId:r,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Mde(e,t){const r=await CW(e,{},async()=>{const n=Vb({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:i,apiKey:a}=e.config,o=_W(e,i,"/v1/token",`key=${a}`),s=await e._getAdditionalHeaders();return s["Content-Type"]="application/x-www-form-urlencoded",SW.fetch()(o,{method:"POST",headers:s,body:n})});return{accessToken:r.access_token,expiresIn:r.expires_in,refreshToken:r.refresh_token}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class K1{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(t){xr(t.idToken,"internal-error"),xr(typeof t.idToken<"u","internal-error"),xr(typeof t.refreshToken<"u","internal-error");const r="expiresIn"in t&&typeof t.expiresIn<"u"?Number(t.expiresIn):wde(t.idToken);this.updateTokensAndExpiration(t.idToken,t.refreshToken,r)}async getToken(t,r=!1){return xr(!this.accessToken||this.refreshToken,t,"user-token-expired"),!r&&this.accessToken&&!this.isExpired?this.accessToken:this.refreshToken?(await this.refresh(t,this.refreshToken),this.accessToken):null}clearRefreshToken(){this.refreshToken=null}async refresh(t,r){const{accessToken:n,refreshToken:i,expiresIn:a}=await Mde(t,r);this.updateTokensAndExpiration(n,i,Number(a))}updateTokensAndExpiration(t,r,n){this.refreshToken=r||null,this.accessToken=t||null,this.expirationTime=Date.now()+n*1e3}static fromJSON(t,r){const{refreshToken:n,accessToken:i,expirationTime:a}=r,o=new K1;return n&&(xr(typeof n=="string","internal-error",{appName:t}),o.refreshToken=n),i&&(xr(typeof i=="string","internal-error",{appName:t}),o.accessToken=i),a&&(xr(typeof a=="number","internal-error",{appName:t}),o.expirationTime=a),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(t){this.accessToken=t.accessToken,this.refreshToken=t.refreshToken,this.expirationTime=t.expirationTime}_clone(){return Object.assign(new K1,this.toJSON())}_performRefresh(){return _c("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jd(e,t){xr(typeof e=="string"||typeof e>"u","internal-error",{appName:t})}class Rh{constructor(t){var{uid:r,auth:n,stsTokenManager:i}=t,a=Nk(t,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new Ade(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=r,this.auth=n,this.stsTokenManager=i,this.accessToken=i.accessToken,this.displayName=a.displayName||null,this.email=a.email||null,this.emailVerified=a.emailVerified||!1,this.phoneNumber=a.phoneNumber||null,this.photoURL=a.photoURL||null,this.isAnonymous=a.isAnonymous||!1,this.tenantId=a.tenantId||null,this.providerData=a.providerData?[...a.providerData]:[],this.metadata=new wW(a.createdAt||void 0,a.lastLoginAt||void 0)}async getIdToken(t){const r=await Y1(this,this.stsTokenManager.getToken(this.auth,t));return xr(r,this.auth,"internal-error"),this.accessToken!==r&&(this.accessToken=r,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),r}getIdTokenResult(t){return _de(this,t)}reload(){return Pde(this)}_assign(t){this!==t&&(xr(this.uid===t.uid,this.auth,"internal-error"),this.displayName=t.displayName,this.photoURL=t.photoURL,this.email=t.email,this.emailVerified=t.emailVerified,this.phoneNumber=t.phoneNumber,this.isAnonymous=t.isAnonymous,this.tenantId=t.tenantId,this.providerData=t.providerData.map(r=>Object.assign({},r)),this.metadata._copy(t.metadata),this.stsTokenManager._assign(t.stsTokenManager))}_clone(t){const r=new Rh(Object.assign(Object.assign({},this),{auth:t,stsTokenManager:this.stsTokenManager._clone()}));return r.metadata._copy(this.metadata),r}_onReload(t){xr(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=t,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(t){this.reloadListener?this.reloadListener(t):this.reloadUserInfo=t}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(t,r=!1){let n=!1;t.idToken&&t.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(t),n=!0),r&&await NC(this),await this.auth._persistUserIfCurrent(this),n&&this.auth._notifyListenersIfCurrent(this)}async delete(){const t=await this.getIdToken();return await Y1(this,Sde(this.auth,{idToken:t})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(t=>Object.assign({},t)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(t,r){var n,i,a,o,s,u,l,c;const d=(n=r.displayName)!==null&&n!==void 0?n:void 0,f=(i=r.email)!==null&&i!==void 0?i:void 0,p=(a=r.phoneNumber)!==null&&a!==void 0?a:void 0,v=(o=r.photoURL)!==null&&o!==void 0?o:void 0,h=(s=r.tenantId)!==null&&s!==void 0?s:void 0,m=(u=r._redirectEventId)!==null&&u!==void 0?u:void 0,g=(l=r.createdAt)!==null&&l!==void 0?l:void 0,y=(c=r.lastLoginAt)!==null&&c!==void 0?c:void 0,{uid:b,emailVerified:S,isAnonymous:x,providerData:C,stsTokenManager:w}=r;xr(b&&w,t,"internal-error");const A=K1.fromJSON(this.name,w);xr(typeof b=="string",t,"internal-error"),jd(d,t.name),jd(f,t.name),xr(typeof S=="boolean",t,"internal-error"),xr(typeof x=="boolean",t,"internal-error"),jd(p,t.name),jd(v,t.name),jd(h,t.name),jd(m,t.name),jd(g,t.name),jd(y,t.name);const M=new Rh({uid:b,auth:t,email:f,emailVerified:S,displayName:d,isAnonymous:x,photoURL:v,phoneNumber:p,tenantId:h,stsTokenManager:A,createdAt:g,lastLoginAt:y});return C&&Array.isArray(C)&&(M.providerData=C.map(D=>Object.assign({},D))),m&&(M._redirectEventId=m),M}static async _fromIdTokenResponse(t,r,n=!1){const i=new K1;i.updateFromServerResponse(r);const a=new Rh({uid:r.localId,auth:t,stsTokenManager:i,isAnonymous:n});return await NC(a),a}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bB=new Map;function wc(e){Gc(e instanceof Function,"Expected a class definition");let t=bB.get(e);return t?(Gc(t instanceof e,"Instance stored in cache mismatched with class"),t):(t=new e,bB.set(e,t),t)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class EW{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(t,r){this.storage[t]=r}async _get(t){const r=this.storage[t];return r===void 0?null:r}async _remove(t){delete this.storage[t]}_addListener(t,r){}_removeListener(t,r){}}EW.type="NONE";const xB=EW;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function kS(e,t,r){return`firebase:${e}:${t}:${r}`}class sg{constructor(t,r,n){this.persistence=t,this.auth=r,this.userKey=n;const{config:i,name:a}=this.auth;this.fullUserKey=kS(this.userKey,i.apiKey,a),this.fullPersistenceKey=kS("persistence",i.apiKey,a),this.boundEventHandler=r._onStorageEvent.bind(r),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(t){return this.persistence._set(this.fullUserKey,t.toJSON())}async getCurrentUser(){const t=await this.persistence._get(this.fullUserKey);return t?Rh._fromJSON(this.auth,t):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(t){if(this.persistence===t)return;const r=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=t,r)return this.setCurrentUser(r)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(t,r,n="authUser"){if(!r.length)return new sg(wc(xB),t,n);const i=(await Promise.all(r.map(async l=>{if(await l._isAvailable())return l}))).filter(l=>l);let a=i[0]||wc(xB);const o=kS(n,t.config.apiKey,t.name);let s=null;for(const l of r)try{const c=await l._get(o);if(c){const d=Rh._fromJSON(t,c);l!==a&&(s=d),a=l;break}}catch{}const u=i.filter(l=>l._shouldAllowMigration);return!a._shouldAllowMigration||!u.length?new sg(a,t,n):(a=u[0],s&&await a._set(o,s.toJSON()),await Promise.all(r.map(async l=>{if(l!==a)try{await l._remove(o)}catch{}})),new sg(a,t,n))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function SB(e){const t=e.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";if(TW(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(AW(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(MW(t))return"Blackberry";if(DW(t))return"Webos";if(zk(t))return"Safari";if((t.includes("chrome/")||PW(t))&&!t.includes("edge/"))return"Chrome";if(IW(t))return"Android";{const r=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,n=e.match(r);if((n==null?void 0:n.length)===2)return n[1]}return"Other"}function AW(e=Va()){return/firefox\//i.test(e)}function zk(e=Va()){const t=e.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function PW(e=Va()){return/crios\//i.test(e)}function TW(e=Va()){return/iemobile/i.test(e)}function IW(e=Va()){return/android/i.test(e)}function MW(e=Va()){return/blackberry/i.test(e)}function DW(e=Va()){return/webos/i.test(e)}function s3(e=Va()){return/iphone|ipad|ipod/i.test(e)||/macintosh/i.test(e)&&/mobile/i.test(e)}function Dde(e=Va()){var t;return s3(e)&&!!(!((t=window.navigator)===null||t===void 0)&&t.standalone)}function Rde(){return Xle()&&document.documentMode===10}function RW(e=Va()){return s3(e)||IW(e)||DW(e)||MW(e)||/windows phone/i.test(e)||TW(e)}function kde(){try{return!!(window&&window!==window.top)}catch{return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function kW(e,t=[]){let r;switch(e){case"Browser":r=SB(Va());break;case"Worker":r=`${SB(Va())}-${e}`;break;default:r=e}const n=t.length?t.join(","):"FirebaseCore-web";return`${r}/JsCore/${Hb}/${n}`}async function OW(e,t){return o0(e,"GET","/v2/recaptchaConfig",a0(e,t))}function CB(e){return e!==void 0&&e.enterprise!==void 0}class LW{constructor(t){if(this.siteKey="",this.emailPasswordEnabled=!1,t.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=t.recaptchaKey.split("/")[3],this.emailPasswordEnabled=t.recaptchaEnforcementState.some(r=>r.provider==="EMAIL_PASSWORD_PROVIDER"&&r.enforcementState!=="OFF")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ode(){var e,t;return(t=(e=document.getElementsByTagName("head"))===null||e===void 0?void 0:e[0])!==null&&t!==void 0?t:document}function FW(e){return new Promise((t,r)=>{const n=document.createElement("script");n.setAttribute("src",e),n.onload=t,n.onerror=i=>{const a=Pl("internal-error");a.customData=i,r(a)},n.type="text/javascript",n.charset="UTF-8",Ode().appendChild(n)})}function Lde(e){return`__${e}${Math.floor(Math.random()*1e6)}`}const Fde="https://www.google.com/recaptcha/enterprise.js?render=",Nde="recaptcha-enterprise",Bde="NO_RECAPTCHA";class NW{constructor(t){this.type=Nde,this.auth=s0(t)}async verify(t="verify",r=!1){async function n(a){if(!r){if(a.tenantId==null&&a._agentRecaptchaConfig!=null)return a._agentRecaptchaConfig.siteKey;if(a.tenantId!=null&&a._tenantRecaptchaConfigs[a.tenantId]!==void 0)return a._tenantRecaptchaConfigs[a.tenantId].siteKey}return new Promise(async(o,s)=>{OW(a,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(u=>{if(u.recaptchaKey===void 0)s(new Error("recaptcha Enterprise site key undefined"));else{const l=new LW(u);return a.tenantId==null?a._agentRecaptchaConfig=l:a._tenantRecaptchaConfigs[a.tenantId]=l,o(l.siteKey)}}).catch(u=>{s(u)})})}function i(a,o,s){const u=window.grecaptcha;CB(u)?u.enterprise.ready(()=>{u.enterprise.execute(a,{action:t}).then(l=>{o(l)}).catch(()=>{o(Bde)})}):s(Error("No reCAPTCHA enterprise script loaded."))}return new Promise((a,o)=>{n(this.auth).then(s=>{if(!r&&CB(window.grecaptcha))i(s,a,o);else{if(typeof window>"u"){o(new Error("RecaptchaVerifier is only supported in browser"));return}FW(Fde+s).then(()=>{i(s,a,o)}).catch(u=>{o(u)})}}).catch(s=>{o(s)})})}}async function BC(e,t,r,n=!1){const i=new NW(e);let a;try{a=await i.verify(r)}catch{a=await i.verify(r,!0)}const o=Object.assign({},t);return n?Object.assign(o,{captchaResp:a}):Object.assign(o,{captchaResponse:a}),Object.assign(o,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(o,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),o}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ude{constructor(t){this.auth=t,this.queue=[]}pushCallback(t,r){const n=a=>new Promise((o,s)=>{try{const u=t(a);o(u)}catch(u){s(u)}});n.onAbort=r,this.queue.push(n);const i=this.queue.length-1;return()=>{this.queue[i]=()=>Promise.resolve()}}async runMiddleware(t){if(this.auth.currentUser===t)return;const r=[];try{for(const n of this.queue)await n(t),n.onAbort&&r.push(n.onAbort)}catch(n){r.reverse();for(const i of r)try{i()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:n==null?void 0:n.message})}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jde{constructor(t,r,n,i){this.app=t,this.heartbeatServiceProvider=r,this.appCheckServiceProvider=n,this.config=i,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new _B(this),this.idTokenSubscription=new _B(this),this.beforeStateQueue=new Ude(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=xW,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=t.name,this.clientVersion=i.sdkClientVersion}_initializeWithPersistence(t,r){return r&&(this._popupRedirectResolver=wc(r)),this._initializationPromise=this.queue(async()=>{var n,i;if(!this._deleted&&(this.persistenceManager=await sg.create(this,t),!this._deleted)){if(!((n=this._popupRedirectResolver)===null||n===void 0)&&n._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(r),this.lastNotifiedUid=((i=this.currentUser)===null||i===void 0?void 0:i.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const t=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!t)){if(this.currentUser&&t&&this.currentUser.uid===t.uid){this._currentUser._assign(t),await this.currentUser.getIdToken();return}await this._updateCurrentUser(t,!0)}}async initializeCurrentUser(t){var r;const n=await this.assertedPersistence.getCurrentUser();let i=n,a=!1;if(t&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const o=(r=this.redirectUser)===null||r===void 0?void 0:r._redirectEventId,s=i==null?void 0:i._redirectEventId,u=await this.tryRedirectSignIn(t);(!o||o===s)&&(u!=null&&u.user)&&(i=u.user,a=!0)}if(!i)return this.directlySetCurrentUser(null);if(!i._redirectEventId){if(a)try{await this.beforeStateQueue.runMiddleware(i)}catch(o){i=n,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return i?this.reloadAndSetCurrentUserOrClear(i):this.directlySetCurrentUser(null)}return xr(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===i._redirectEventId?this.directlySetCurrentUser(i):this.reloadAndSetCurrentUserOrClear(i)}async tryRedirectSignIn(t){let r=null;try{r=await this._popupRedirectResolver._completeRedirectFn(this,t,!0)}catch{await this._setRedirectUser(null)}return r}async reloadAndSetCurrentUserOrClear(t){try{await NC(t)}catch(r){if((r==null?void 0:r.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(t)}useDeviceLanguage(){this.languageCode=gde()}async _delete(){this._deleted=!0}async updateCurrentUser(t){const r=t?hd(t):null;return r&&xr(r.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(r&&r._clone(this))}async _updateCurrentUser(t,r=!1){if(!this._deleted)return t&&xr(this.tenantId===t.tenantId,this,"tenant-id-mismatch"),r||await this.beforeStateQueue.runMiddleware(t),this.queue(async()=>{await this.directlySetCurrentUser(t),this.notifyAuthListeners()})}async signOut(){return await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0)}setPersistence(t){return this.queue(async()=>{await this.assertedPersistence.setPersistence(wc(t))})}async initializeRecaptchaConfig(){const t=await OW(this,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}),r=new LW(t);this.tenantId==null?this._agentRecaptchaConfig=r:this._tenantRecaptchaConfigs[this.tenantId]=r,r.emailPasswordEnabled&&new NW(this).verify()}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(t){this._errorFactory=new zb("auth","Firebase",t())}onAuthStateChanged(t,r,n){return this.registerStateListener(this.authStateSubscription,t,r,n)}beforeAuthStateChanged(t,r){return this.beforeStateQueue.pushCallback(t,r)}onIdTokenChanged(t,r,n){return this.registerStateListener(this.idTokenSubscription,t,r,n)}toJSON(){var t;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(t=this._currentUser)===null||t===void 0?void 0:t.toJSON()}}async _setRedirectUser(t,r){const n=await this.getOrInitRedirectPersistenceManager(r);return t===null?n.removeCurrentUser():n.setCurrentUser(t)}async getOrInitRedirectPersistenceManager(t){if(!this.redirectPersistenceManager){const r=t&&wc(t)||this._popupRedirectResolver;xr(r,this,"argument-error"),this.redirectPersistenceManager=await sg.create(this,[wc(r._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(t){var r,n;return this._isInitialized&&await this.queue(async()=>{}),((r=this._currentUser)===null||r===void 0?void 0:r._redirectEventId)===t?this._currentUser:((n=this.redirectUser)===null||n===void 0?void 0:n._redirectEventId)===t?this.redirectUser:null}async _persistUserIfCurrent(t){if(t===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(t))}_notifyListenersIfCurrent(t){t===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var t,r;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const n=(r=(t=this.currentUser)===null||t===void 0?void 0:t.uid)!==null&&r!==void 0?r:null;this.lastNotifiedUid!==n&&(this.lastNotifiedUid=n,this.authStateSubscription.next(this.currentUser))}registerStateListener(t,r,n,i){if(this._deleted)return()=>{};const a=typeof r=="function"?r:r.next.bind(r),o=this._isInitialized?Promise.resolve():this._initializationPromise;return xr(o,this,"internal-error"),o.then(()=>a(this.currentUser)),typeof r=="function"?t.addObserver(r,n,i):t.addObserver(r)}async directlySetCurrentUser(t){this.currentUser&&this.currentUser!==t&&this._currentUser._stopProactiveRefresh(),t&&this.isProactiveRefreshEnabled&&t._startProactiveRefresh(),this.currentUser=t,t?await this.assertedPersistence.setCurrentUser(t):await this.assertedPersistence.removeCurrentUser()}queue(t){return this.operations=this.operations.then(t,t),this.operations}get assertedPersistence(){return xr(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(t){!t||this.frameworks.includes(t)||(this.frameworks.push(t),this.frameworks.sort(),this.clientVersion=kW(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var t;const r={["X-Client-Version"]:this.clientVersion};this.app.options.appId&&(r["X-Firebase-gmpid"]=this.app.options.appId);const n=await((t=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||t===void 0?void 0:t.getHeartbeatsHeader());n&&(r["X-Firebase-Client"]=n);const i=await this._getAppCheckToken();return i&&(r["X-Firebase-AppCheck"]=i),r}async _getAppCheckToken(){var t;const r=await((t=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||t===void 0?void 0:t.getToken());return r!=null&&r.error&&pde(`Error while retrieving App Check token: ${r.error}`),r==null?void 0:r.token}}function s0(e){return hd(e)}let _B=class{constructor(t){this.auth=t,this.observer=null,this.addObserver=tce(r=>this.observer=r)}get next(){return xr(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zde(e,t){const r=vW(e,"auth");if(r.isInitialized()){const i=r.getImmediate(),a=r.getOptions();if(OC(a,t??{}))return i;Nu(i,"already-initialized")}return r.initialize({options:t})}function Vde(e,t){const r=(t==null?void 0:t.persistence)||[],n=(Array.isArray(r)?r:[r]).map(wc);t!=null&&t.errorMap&&e._updateErrorMap(t.errorMap),e._initializeWithPersistence(n,t==null?void 0:t.popupRedirectResolver)}function Hde(e,t,r){const n=s0(e);xr(n._canInitEmulator,n,"emulator-config-failed"),xr(/^https?:\/\//.test(t),n,"invalid-emulator-scheme");const i=!!(r!=null&&r.disableWarnings),a=BW(t),{host:o,port:s}=Gde(t),u=s===null?"":`:${s}`;n.config.emulator={url:`${a}//${o}${u}/`},n.settings.appVerificationDisabledForTesting=!0,n.emulatorConfig=Object.freeze({host:o,port:s,protocol:a.replace(":",""),options:Object.freeze({disableWarnings:i})}),i||qde()}function BW(e){const t=e.indexOf(":");return t<0?"":e.substr(0,t+1)}function Gde(e){const t=BW(e),r=/(\/\/)?([^?#/]+)/.exec(e.substr(t.length));if(!r)return{host:"",port:null};const n=r[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(n);if(i){const a=i[1];return{host:a,port:wB(n.substr(a.length+1))}}else{const[a,o]=n.split(":");return{host:a,port:wB(o)}}}function wB(e){if(!e)return null;const t=Number(e);return isNaN(t)?null:t}function qde(){function e(){const t=document.createElement("p"),r=t.style;t.innerText="Running in emulator mode. Do not use with production credentials.",r.position="fixed",r.width="100%",r.backgroundColor="#ffffff",r.border=".1em solid #000000",r.color="#b50000",r.bottom="0px",r.left="0px",r.margin="0px",r.zIndex="10000",r.textAlign="center",t.classList.add("firebase-emulator-warning"),document.body.appendChild(t)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",e):e())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vk{constructor(t,r){this.providerId=t,this.signInMethod=r}toJSON(){return _c("not implemented")}_getIdTokenResponse(t){return _c("not implemented")}_linkToIdToken(t,r){return _c("not implemented")}_getReauthenticationResolver(t){return _c("not implemented")}}async function $de(e,t){return o0(e,"POST","/v1/accounts:update",t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function fP(e,t){return qb(e,"POST","/v1/accounts:signInWithPassword",a0(e,t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Wde(e,t){return qb(e,"POST","/v1/accounts:signInWithEmailLink",a0(e,t))}async function Xde(e,t){return qb(e,"POST","/v1/accounts:signInWithEmailLink",a0(e,t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Q1 extends Vk{constructor(t,r,n,i=null){super("password",n),this._email=t,this._password=r,this._tenantId=i}static _fromEmailAndPassword(t,r){return new Q1(t,r,"password")}static _fromEmailAndCode(t,r,n=null){return new Q1(t,r,"emailLink",n)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(t){const r=typeof t=="string"?JSON.parse(t):t;if(r!=null&&r.email&&(r!=null&&r.password)){if(r.signInMethod==="password")return this._fromEmailAndPassword(r.email,r.password);if(r.signInMethod==="emailLink")return this._fromEmailAndCode(r.email,r.password,r.tenantId)}return null}async _getIdTokenResponse(t){var r;switch(this.signInMethod){case"password":const n={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};if(!((r=t._getRecaptchaConfig())===null||r===void 0)&&r.emailPasswordEnabled){const i=await BC(t,n,"signInWithPassword");return fP(t,i)}else return fP(t,n).catch(async i=>{if(i.code==="auth/missing-recaptcha-token"){console.log("Sign-in with email address and password is protected by reCAPTCHA for this project. Automatically triggering the reCAPTCHA flow and restarting the sign-in flow.");const a=await BC(t,n,"signInWithPassword");return fP(t,a)}else return Promise.reject(i)});case"emailLink":return Wde(t,{email:this._email,oobCode:this._password});default:Nu(t,"internal-error")}}async _linkToIdToken(t,r){switch(this.signInMethod){case"password":return $de(t,{idToken:r,returnSecureToken:!0,email:this._email,password:this._password});case"emailLink":return Xde(t,{idToken:r,email:this._email,oobCode:this._password});default:Nu(t,"internal-error")}}_getReauthenticationResolver(t){return this._getIdTokenResponse(t)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ug(e,t){return qb(e,"POST","/v1/accounts:signInWithIdp",a0(e,t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Yde="http://localhost";class Qh extends Vk{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(t){const r=new Qh(t.providerId,t.signInMethod);return t.idToken||t.accessToken?(t.idToken&&(r.idToken=t.idToken),t.accessToken&&(r.accessToken=t.accessToken),t.nonce&&!t.pendingToken&&(r.nonce=t.nonce),t.pendingToken&&(r.pendingToken=t.pendingToken)):t.oauthToken&&t.oauthTokenSecret?(r.accessToken=t.oauthToken,r.secret=t.oauthTokenSecret):Nu("argument-error"),r}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(t){const r=typeof t=="string"?JSON.parse(t):t,{providerId:n,signInMethod:i}=r,a=Nk(r,["providerId","signInMethod"]);if(!n||!i)return null;const o=new Qh(n,i);return o.idToken=a.idToken||void 0,o.accessToken=a.accessToken||void 0,o.secret=a.secret,o.nonce=a.nonce,o.pendingToken=a.pendingToken||null,o}_getIdTokenResponse(t){const r=this.buildRequest();return ug(t,r)}_linkToIdToken(t,r){const n=this.buildRequest();return n.idToken=r,ug(t,n)}_getReauthenticationResolver(t){const r=this.buildRequest();return r.autoCreate=!1,ug(t,r)}buildRequest(){const t={requestUri:Yde,returnSecureToken:!0};if(this.pendingToken)t.pendingToken=this.pendingToken;else{const r={};this.idToken&&(r.id_token=this.idToken),this.accessToken&&(r.access_token=this.accessToken),this.secret&&(r.oauth_token_secret=this.secret),r.providerId=this.providerId,this.nonce&&!this.pendingToken&&(r.nonce=this.nonce),t.postBody=Vb(r)}return t}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Kde(e){switch(e){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function Qde(e){const t=ky(Oy(e)).link,r=t?ky(Oy(t)).deep_link_id:null,n=ky(Oy(e)).deep_link_id;return(n?ky(Oy(n)).link:null)||n||r||t||e}class Hk{constructor(t){var r,n,i,a,o,s;const u=ky(Oy(t)),l=(r=u.apiKey)!==null&&r!==void 0?r:null,c=(n=u.oobCode)!==null&&n!==void 0?n:null,d=Kde((i=u.mode)!==null&&i!==void 0?i:null);xr(l&&c&&d,"argument-error"),this.apiKey=l,this.operation=d,this.code=c,this.continueUrl=(a=u.continueUrl)!==null&&a!==void 0?a:null,this.languageCode=(o=u.languageCode)!==null&&o!==void 0?o:null,this.tenantId=(s=u.tenantId)!==null&&s!==void 0?s:null}static parseLink(t){const r=Qde(t);try{return new Hk(r)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class u0{constructor(){this.providerId=u0.PROVIDER_ID}static credential(t,r){return Q1._fromEmailAndPassword(t,r)}static credentialWithLink(t,r){const n=Hk.parseLink(r);return xr(n,"argument-error"),Q1._fromEmailAndCode(t,n.code,n.tenantId)}}u0.PROVIDER_ID="password";u0.EMAIL_PASSWORD_SIGN_IN_METHOD="password";u0.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class UW{constructor(t){this.providerId=t,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(t){this.defaultLanguageCode=t}setCustomParameters(t){return this.customParameters=t,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $b extends UW{constructor(){super(...arguments),this.scopes=[]}addScope(t){return this.scopes.includes(t)||this.scopes.push(t),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pf extends $b{constructor(){super("facebook.com")}static credential(t){return Qh._fromParams({providerId:pf.PROVIDER_ID,signInMethod:pf.FACEBOOK_SIGN_IN_METHOD,accessToken:t})}static credentialFromResult(t){return pf.credentialFromTaggedObject(t)}static credentialFromError(t){return pf.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t||!("oauthAccessToken"in t)||!t.oauthAccessToken)return null;try{return pf.credential(t.oauthAccessToken)}catch{return null}}}pf.FACEBOOK_SIGN_IN_METHOD="facebook.com";pf.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hf extends $b{constructor(){super("google.com"),this.addScope("profile")}static credential(t,r){return Qh._fromParams({providerId:hf.PROVIDER_ID,signInMethod:hf.GOOGLE_SIGN_IN_METHOD,idToken:t,accessToken:r})}static credentialFromResult(t){return hf.credentialFromTaggedObject(t)}static credentialFromError(t){return hf.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t)return null;const{oauthIdToken:r,oauthAccessToken:n}=t;if(!r&&!n)return null;try{return hf.credential(r,n)}catch{return null}}}hf.GOOGLE_SIGN_IN_METHOD="google.com";hf.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vf extends $b{constructor(){super("github.com")}static credential(t){return Qh._fromParams({providerId:vf.PROVIDER_ID,signInMethod:vf.GITHUB_SIGN_IN_METHOD,accessToken:t})}static credentialFromResult(t){return vf.credentialFromTaggedObject(t)}static credentialFromError(t){return vf.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t||!("oauthAccessToken"in t)||!t.oauthAccessToken)return null;try{return vf.credential(t.oauthAccessToken)}catch{return null}}}vf.GITHUB_SIGN_IN_METHOD="github.com";vf.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mf extends $b{constructor(){super("twitter.com")}static credential(t,r){return Qh._fromParams({providerId:mf.PROVIDER_ID,signInMethod:mf.TWITTER_SIGN_IN_METHOD,oauthToken:t,oauthTokenSecret:r})}static credentialFromResult(t){return mf.credentialFromTaggedObject(t)}static credentialFromError(t){return mf.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t)return null;const{oauthAccessToken:r,oauthTokenSecret:n}=t;if(!r||!n)return null;try{return mf.credential(r,n)}catch{return null}}}mf.TWITTER_SIGN_IN_METHOD="twitter.com";mf.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function pP(e,t){return qb(e,"POST","/v1/accounts:signUp",a0(e,t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zh{constructor(t){this.user=t.user,this.providerId=t.providerId,this._tokenResponse=t._tokenResponse,this.operationType=t.operationType}static async _fromIdTokenResponse(t,r,n,i=!1){const a=await Rh._fromIdTokenResponse(t,n,i),o=EB(n);return new Zh({user:a,providerId:o,_tokenResponse:n,operationType:r})}static async _forOperation(t,r,n){await t._updateTokensIfNecessary(n,!0);const i=EB(n);return new Zh({user:t,providerId:i,_tokenResponse:n,operationType:r})}}function EB(e){return e.providerId?e.providerId:"phoneNumber"in e?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class UC extends Ep{constructor(t,r,n,i){var a;super(r.code,r.message),this.operationType=n,this.user=i,Object.setPrototypeOf(this,UC.prototype),this.customData={appName:t.name,tenantId:(a=t.tenantId)!==null&&a!==void 0?a:void 0,_serverResponse:r.customData._serverResponse,operationType:n}}static _fromErrorAndOperation(t,r,n,i){return new UC(t,r,n,i)}}function jW(e,t,r,n){return(t==="reauthenticate"?r._getReauthenticationResolver(e):r._getIdTokenResponse(e)).catch(a=>{throw a.code==="auth/multi-factor-auth-required"?UC._fromErrorAndOperation(e,a,t,n):a})}async function Zde(e,t,r=!1){const n=await Y1(e,t._linkToIdToken(e.auth,await e.getIdToken()),r);return Zh._forOperation(e,"link",n)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Jde(e,t,r=!1){const{auth:n}=e,i="reauthenticate";try{const a=await Y1(e,jW(n,i,t,e),r);xr(a.idToken,n,"internal-error");const o=jk(a.idToken);xr(o,n,"internal-error");const{sub:s}=o;return xr(e.uid===s,n,"user-mismatch"),Zh._forOperation(e,i,a)}catch(a){throw(a==null?void 0:a.code)==="auth/user-not-found"&&Nu(n,"user-mismatch"),a}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function zW(e,t,r=!1){const n="signIn",i=await jW(e,n,t),a=await Zh._fromIdTokenResponse(e,n,i);return r||await e._updateCurrentUser(a.user),a}async function efe(e,t){return zW(s0(e),t)}async function tfe(e,t,r){var n;const i=s0(e),a={returnSecureToken:!0,email:t,password:r,clientType:"CLIENT_TYPE_WEB"};let o;if(!((n=i._getRecaptchaConfig())===null||n===void 0)&&n.emailPasswordEnabled){const l=await BC(i,a,"signUpPassword");o=pP(i,l)}else o=pP(i,a).catch(async l=>{if(l.code==="auth/missing-recaptcha-token"){console.log("Sign-up is protected by reCAPTCHA for this project. Automatically triggering the reCAPTCHA flow and restarting the sign-up flow.");const c=await BC(i,a,"signUpPassword");return pP(i,c)}else return Promise.reject(l)});const s=await o.catch(l=>Promise.reject(l)),u=await Zh._fromIdTokenResponse(i,"signIn",s);return await i._updateCurrentUser(u.user),u}function rfe(e,t,r){return efe(hd(e),u0.credential(t,r))}function nfe(e,t,r,n){return hd(e).onIdTokenChanged(t,r,n)}function ife(e,t,r){return hd(e).beforeAuthStateChanged(t,r)}function Gk(e,t,r,n){return hd(e).onAuthStateChanged(t,r,n)}function afe(e){return hd(e).signOut()}const jC="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class VW{constructor(t,r){this.storageRetriever=t,this.type=r}_isAvailable(){try{return this.storage?(this.storage.setItem(jC,"1"),this.storage.removeItem(jC),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(t,r){return this.storage.setItem(t,JSON.stringify(r)),Promise.resolve()}_get(t){const r=this.storage.getItem(t);return Promise.resolve(r?JSON.parse(r):null)}_remove(t){return this.storage.removeItem(t),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ofe(){const e=Va();return zk(e)||s3(e)}const sfe=1e3,ufe=10;class HW extends VW{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(t,r)=>this.onStorageEvent(t,r),this.listeners={},this.localCache={},this.pollTimer=null,this.safariLocalStorageNotSynced=ofe()&&kde(),this.fallbackToPolling=RW(),this._shouldAllowMigration=!0}forAllChangedKeys(t){for(const r of Object.keys(this.listeners)){const n=this.storage.getItem(r),i=this.localCache[r];n!==i&&t(r,i,n)}}onStorageEvent(t,r=!1){if(!t.key){this.forAllChangedKeys((o,s,u)=>{this.notifyListeners(o,u)});return}const n=t.key;if(r?this.detachListener():this.stopPolling(),this.safariLocalStorageNotSynced){const o=this.storage.getItem(n);if(t.newValue!==o)t.newValue!==null?this.storage.setItem(n,t.newValue):this.storage.removeItem(n);else if(this.localCache[n]===t.newValue&&!r)return}const i=()=>{const o=this.storage.getItem(n);!r&&this.localCache[n]===o||this.notifyListeners(n,o)},a=this.storage.getItem(n);Rde()&&a!==t.newValue&&t.newValue!==t.oldValue?setTimeout(i,ufe):i()}notifyListeners(t,r){this.localCache[t]=r;const n=this.listeners[t];if(n)for(const i of Array.from(n))i(r&&JSON.parse(r))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((t,r,n)=>{this.onStorageEvent(new StorageEvent("storage",{key:t,oldValue:r,newValue:n}),!0)})},sfe)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(t,r){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[t]||(this.listeners[t]=new Set,this.localCache[t]=this.storage.getItem(t)),this.listeners[t].add(r)}_removeListener(t,r){this.listeners[t]&&(this.listeners[t].delete(r),this.listeners[t].size===0&&delete this.listeners[t]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(t,r){await super._set(t,r),this.localCache[t]=JSON.stringify(r)}async _get(t){const r=await super._get(t);return this.localCache[t]=JSON.stringify(r),r}async _remove(t){await super._remove(t),delete this.localCache[t]}}HW.type="LOCAL";const lfe=HW;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class GW extends VW{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(t,r){}_removeListener(t,r){}}GW.type="SESSION";const qW=GW;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cfe(e){return Promise.all(e.map(async t=>{try{return{fulfilled:!0,value:await t}}catch(r){return{fulfilled:!1,reason:r}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class u3{constructor(t){this.eventTarget=t,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(t){const r=this.receivers.find(i=>i.isListeningto(t));if(r)return r;const n=new u3(t);return this.receivers.push(n),n}isListeningto(t){return this.eventTarget===t}async handleEvent(t){const r=t,{eventId:n,eventType:i,data:a}=r.data,o=this.handlersMap[i];if(!(o!=null&&o.size))return;r.ports[0].postMessage({status:"ack",eventId:n,eventType:i});const s=Array.from(o).map(async l=>l(r.origin,a)),u=await cfe(s);r.ports[0].postMessage({status:"done",eventId:n,eventType:i,response:u})}_subscribe(t,r){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[t]||(this.handlersMap[t]=new Set),this.handlersMap[t].add(r)}_unsubscribe(t,r){this.handlersMap[t]&&r&&this.handlersMap[t].delete(r),(!r||this.handlersMap[t].size===0)&&delete this.handlersMap[t],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}u3.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qk(e="",t=10){let r="";for(let n=0;n<t;n++)r+=Math.floor(Math.random()*10);return e+r}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dfe{constructor(t){this.target=t,this.handlers=new Set}removeMessageHandler(t){t.messageChannel&&(t.messageChannel.port1.removeEventListener("message",t.onMessage),t.messageChannel.port1.close()),this.handlers.delete(t)}async _send(t,r,n=50){const i=typeof MessageChannel<"u"?new MessageChannel:null;if(!i)throw new Error("connection_unavailable");let a,o;return new Promise((s,u)=>{const l=qk("",20);i.port1.start();const c=setTimeout(()=>{u(new Error("unsupported_event"))},n);o={messageChannel:i,onMessage(d){const f=d;if(f.data.eventId===l)switch(f.data.status){case"ack":clearTimeout(c),a=setTimeout(()=>{u(new Error("timeout"))},3e3);break;case"done":clearTimeout(a),s(f.data.response);break;default:clearTimeout(c),clearTimeout(a),u(new Error("invalid_response"));break}}},this.handlers.add(o),i.port1.addEventListener("message",o.onMessage),this.target.postMessage({eventType:t,eventId:l,data:r},[i.port2])}).finally(()=>{o&&this.removeMessageHandler(o)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Tl(){return window}function ffe(e){Tl().location.href=e}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $W(){return typeof Tl().WorkerGlobalScope<"u"&&typeof Tl().importScripts=="function"}async function pfe(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function hfe(){var e;return((e=navigator==null?void 0:navigator.serviceWorker)===null||e===void 0?void 0:e.controller)||null}function vfe(){return $W()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const WW="firebaseLocalStorageDb",mfe=1,zC="firebaseLocalStorage",XW="fbase_key";class Wb{constructor(t){this.request=t}toPromise(){return new Promise((t,r)=>{this.request.addEventListener("success",()=>{t(this.request.result)}),this.request.addEventListener("error",()=>{r(this.request.error)})})}}function l3(e,t){return e.transaction([zC],t?"readwrite":"readonly").objectStore(zC)}function gfe(){const e=indexedDB.deleteDatabase(WW);return new Wb(e).toPromise()}function gM(){const e=indexedDB.open(WW,mfe);return new Promise((t,r)=>{e.addEventListener("error",()=>{r(e.error)}),e.addEventListener("upgradeneeded",()=>{const n=e.result;try{n.createObjectStore(zC,{keyPath:XW})}catch(i){r(i)}}),e.addEventListener("success",async()=>{const n=e.result;n.objectStoreNames.contains(zC)?t(n):(n.close(),await gfe(),t(await gM()))})})}async function AB(e,t,r){const n=l3(e,!0).put({[XW]:t,value:r});return new Wb(n).toPromise()}async function yfe(e,t){const r=l3(e,!1).get(t),n=await new Wb(r).toPromise();return n===void 0?null:n.value}function PB(e,t){const r=l3(e,!0).delete(t);return new Wb(r).toPromise()}const bfe=800,xfe=3;class YW{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await gM(),this.db)}async _withRetries(t){let r=0;for(;;)try{const n=await this._openDb();return await t(n)}catch(n){if(r++>xfe)throw n;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return $W()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=u3._getInstance(vfe()),this.receiver._subscribe("keyChanged",async(t,r)=>({keyProcessed:(await this._poll()).includes(r.key)})),this.receiver._subscribe("ping",async(t,r)=>["keyChanged"])}async initializeSender(){var t,r;if(this.activeServiceWorker=await pfe(),!this.activeServiceWorker)return;this.sender=new dfe(this.activeServiceWorker);const n=await this.sender._send("ping",{},800);n&&!((t=n[0])===null||t===void 0)&&t.fulfilled&&!((r=n[0])===null||r===void 0)&&r.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(t){if(!(!this.sender||!this.activeServiceWorker||hfe()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:t},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const t=await gM();return await AB(t,jC,"1"),await PB(t,jC),!0}catch{}return!1}async _withPendingWrite(t){this.pendingWrites++;try{await t()}finally{this.pendingWrites--}}async _set(t,r){return this._withPendingWrite(async()=>(await this._withRetries(n=>AB(n,t,r)),this.localCache[t]=r,this.notifyServiceWorker(t)))}async _get(t){const r=await this._withRetries(n=>yfe(n,t));return this.localCache[t]=r,r}async _remove(t){return this._withPendingWrite(async()=>(await this._withRetries(r=>PB(r,t)),delete this.localCache[t],this.notifyServiceWorker(t)))}async _poll(){const t=await this._withRetries(i=>{const a=l3(i,!1).getAll();return new Wb(a).toPromise()});if(!t)return[];if(this.pendingWrites!==0)return[];const r=[],n=new Set;for(const{fbase_key:i,value:a}of t)n.add(i),JSON.stringify(this.localCache[i])!==JSON.stringify(a)&&(this.notifyListeners(i,a),r.push(i));for(const i of Object.keys(this.localCache))this.localCache[i]&&!n.has(i)&&(this.notifyListeners(i,null),r.push(i));return r}notifyListeners(t,r){this.localCache[t]=r;const n=this.listeners[t];if(n)for(const i of Array.from(n))i(r)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),bfe)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(t,r){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[t]||(this.listeners[t]=new Set,this._get(t)),this.listeners[t].add(r)}_removeListener(t,r){this.listeners[t]&&(this.listeners[t].delete(r),this.listeners[t].size===0&&delete this.listeners[t]),Object.keys(this.listeners).length===0&&this.stopPolling()}}YW.type="LOCAL";const Sfe=YW;new Gb(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Cfe(e,t){return t?wc(t):(xr(e._popupRedirectResolver,e,"argument-error"),e._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $k extends Vk{constructor(t){super("custom","custom"),this.params=t}_getIdTokenResponse(t){return ug(t,this._buildIdpRequest())}_linkToIdToken(t,r){return ug(t,this._buildIdpRequest(r))}_getReauthenticationResolver(t){return ug(t,this._buildIdpRequest())}_buildIdpRequest(t){const r={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return t&&(r.idToken=t),r}}function _fe(e){return zW(e.auth,new $k(e),e.bypassAuthState)}function wfe(e){const{auth:t,user:r}=e;return xr(r,t,"internal-error"),Jde(r,new $k(e),e.bypassAuthState)}async function Efe(e){const{auth:t,user:r}=e;return xr(r,t,"internal-error"),Zde(r,new $k(e),e.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class KW{constructor(t,r,n,i,a=!1){this.auth=t,this.resolver=n,this.user=i,this.bypassAuthState=a,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(r)?r:[r]}execute(){return new Promise(async(t,r)=>{this.pendingPromise={resolve:t,reject:r};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(n){this.reject(n)}})}async onAuthEvent(t){const{urlResponse:r,sessionId:n,postBody:i,tenantId:a,error:o,type:s}=t;if(o){this.reject(o);return}const u={auth:this.auth,requestUri:r,sessionId:n,tenantId:a||void 0,postBody:i||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(s)(u))}catch(l){this.reject(l)}}onError(t){this.reject(t)}getIdpTask(t){switch(t){case"signInViaPopup":case"signInViaRedirect":return _fe;case"linkViaPopup":case"linkViaRedirect":return Efe;case"reauthViaPopup":case"reauthViaRedirect":return wfe;default:Nu(this.auth,"internal-error")}}resolve(t){Gc(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(t),this.unregisterAndCleanUp()}reject(t){Gc(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(t),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Afe=new Gb(2e3,1e4);class Hm extends KW{constructor(t,r,n,i,a){super(t,r,i,a),this.provider=n,this.authWindow=null,this.pollId=null,Hm.currentPopupAction&&Hm.currentPopupAction.cancel(),Hm.currentPopupAction=this}async executeNotNull(){const t=await this.execute();return xr(t,this.auth,"internal-error"),t}async onExecution(){Gc(this.filter.length===1,"Popup operations only handle one event");const t=qk();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],t),this.authWindow.associatedEvent=t,this.resolver._originValidation(this.auth).catch(r=>{this.reject(r)}),this.resolver._isIframeWebStorageSupported(this.auth,r=>{r||this.reject(Pl(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var t;return((t=this.authWindow)===null||t===void 0?void 0:t.associatedEvent)||null}cancel(){this.reject(Pl(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Hm.currentPopupAction=null}pollUserCancellation(){const t=()=>{var r,n;if(!((n=(r=this.authWindow)===null||r===void 0?void 0:r.window)===null||n===void 0)&&n.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(Pl(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(t,Afe.get())};t()}}Hm.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Pfe="pendingRedirect",OS=new Map;class Tfe extends KW{constructor(t,r,n=!1){super(t,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],r,void 0,n),this.eventId=null}async execute(){let t=OS.get(this.auth._key());if(!t){try{const n=await Ife(this.resolver,this.auth)?await super.execute():null;t=()=>Promise.resolve(n)}catch(r){t=()=>Promise.reject(r)}OS.set(this.auth._key(),t)}return this.bypassAuthState||OS.set(this.auth._key(),()=>Promise.resolve(null)),t()}async onAuthEvent(t){if(t.type==="signInViaRedirect")return super.onAuthEvent(t);if(t.type==="unknown"){this.resolve(null);return}if(t.eventId){const r=await this.auth._redirectUserForId(t.eventId);if(r)return this.user=r,super.onAuthEvent(t);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function Ife(e,t){const r=Rfe(t),n=Dfe(e);if(!await n._isAvailable())return!1;const i=await n._get(r)==="true";return await n._remove(r),i}function Mfe(e,t){OS.set(e._key(),t)}function Dfe(e){return wc(e._redirectPersistence)}function Rfe(e){return kS(Pfe,e.config.apiKey,e.name)}async function kfe(e,t,r=!1){const n=s0(e),i=Cfe(n,t),o=await new Tfe(n,i,r).execute();return o&&!r&&(delete o.user._redirectEventId,await n._persistUserIfCurrent(o.user),await n._setRedirectUser(null,t)),o}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ofe=10*60*1e3;class Lfe{constructor(t){this.auth=t,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(t){this.consumers.add(t),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,t)&&(this.sendToConsumer(this.queuedRedirectEvent,t),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(t){this.consumers.delete(t)}onEvent(t){if(this.hasEventBeenHandled(t))return!1;let r=!1;return this.consumers.forEach(n=>{this.isEventForConsumer(t,n)&&(r=!0,this.sendToConsumer(t,n),this.saveEventToCache(t))}),this.hasHandledPotentialRedirect||!Ffe(t)||(this.hasHandledPotentialRedirect=!0,r||(this.queuedRedirectEvent=t,r=!0)),r}sendToConsumer(t,r){var n;if(t.error&&!QW(t)){const i=((n=t.error.code)===null||n===void 0?void 0:n.split("auth/")[1])||"internal-error";r.onError(Pl(this.auth,i))}else r.onAuthEvent(t)}isEventForConsumer(t,r){const n=r.eventId===null||!!t.eventId&&t.eventId===r.eventId;return r.filter.includes(t.type)&&n}hasEventBeenHandled(t){return Date.now()-this.lastProcessedEventTime>=Ofe&&this.cachedEventUids.clear(),this.cachedEventUids.has(TB(t))}saveEventToCache(t){this.cachedEventUids.add(TB(t)),this.lastProcessedEventTime=Date.now()}}function TB(e){return[e.type,e.eventId,e.sessionId,e.tenantId].filter(t=>t).join("-")}function QW({type:e,error:t}){return e==="unknown"&&(t==null?void 0:t.code)==="auth/no-auth-event"}function Ffe(e){switch(e.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return QW(e);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Nfe(e,t={}){return o0(e,"GET","/v1/projects",t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Bfe=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,Ufe=/^https?/;async function jfe(e){if(e.config.emulator)return;const{authorizedDomains:t}=await Nfe(e);for(const r of t)try{if(zfe(r))return}catch{}Nu(e,"unauthorized-domain")}function zfe(e){const t=mM(),{protocol:r,hostname:n}=new URL(t);if(e.startsWith("chrome-extension://")){const o=new URL(e);return o.hostname===""&&n===""?r==="chrome-extension:"&&e.replace("chrome-extension://","")===t.replace("chrome-extension://",""):r==="chrome-extension:"&&o.hostname===n}if(!Ufe.test(r))return!1;if(Bfe.test(e))return n===e;const i=e.replace(/\./g,"\\.");return new RegExp("^(.+\\."+i+"|"+i+")$","i").test(n)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Vfe=new Gb(3e4,6e4);function IB(){const e=Tl().___jsl;if(e!=null&&e.H){for(const t of Object.keys(e.H))if(e.H[t].r=e.H[t].r||[],e.H[t].L=e.H[t].L||[],e.H[t].r=[...e.H[t].L],e.CP)for(let r=0;r<e.CP.length;r++)e.CP[r]=null}}function Hfe(e){return new Promise((t,r)=>{var n,i,a;function o(){IB(),gapi.load("gapi.iframes",{callback:()=>{t(gapi.iframes.getContext())},ontimeout:()=>{IB(),r(Pl(e,"network-request-failed"))},timeout:Vfe.get()})}if(!((i=(n=Tl().gapi)===null||n===void 0?void 0:n.iframes)===null||i===void 0)&&i.Iframe)t(gapi.iframes.getContext());else if(!((a=Tl().gapi)===null||a===void 0)&&a.load)o();else{const s=Lde("iframefcb");return Tl()[s]=()=>{gapi.load?o():r(Pl(e,"network-request-failed"))},FW(`https://apis.google.com/js/api.js?onload=${s}`).catch(u=>r(u))}}).catch(t=>{throw LS=null,t})}let LS=null;function Gfe(e){return LS=LS||Hfe(e),LS}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qfe=new Gb(5e3,15e3),$fe="__/auth/iframe",Wfe="emulator/auth/iframe",Xfe={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},Yfe=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function Kfe(e){const t=e.config;xr(t.authDomain,e,"auth-domain-config-required");const r=t.emulator?Uk(t,Wfe):`https://${e.config.authDomain}/${$fe}`,n={apiKey:t.apiKey,appName:e.name,v:Hb},i=Yfe.get(e.config.apiHost);i&&(n.eid=i);const a=e._getFrameworks();return a.length&&(n.fw=a.join(",")),`${r}?${Vb(n).slice(1)}`}async function Qfe(e){const t=await Gfe(e),r=Tl().gapi;return xr(r,e,"internal-error"),t.open({where:document.body,url:Kfe(e),messageHandlersFilter:r.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:Xfe,dontclear:!0},n=>new Promise(async(i,a)=>{await n.restyle({setHideOnLeave:!1});const o=Pl(e,"network-request-failed"),s=Tl().setTimeout(()=>{a(o)},qfe.get());function u(){Tl().clearTimeout(s),i(n)}n.ping(u).then(u,()=>{a(o)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Zfe={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},Jfe=500,epe=600,tpe="_blank",rpe="http://localhost";class MB{constructor(t){this.window=t,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function npe(e,t,r,n=Jfe,i=epe){const a=Math.max((window.screen.availHeight-i)/2,0).toString(),o=Math.max((window.screen.availWidth-n)/2,0).toString();let s="";const u=Object.assign(Object.assign({},Zfe),{width:n.toString(),height:i.toString(),top:a,left:o}),l=Va().toLowerCase();r&&(s=PW(l)?tpe:r),AW(l)&&(t=t||rpe,u.scrollbars="yes");const c=Object.entries(u).reduce((f,[p,v])=>`${f}${p}=${v},`,"");if(Dde(l)&&s!=="_self")return ipe(t||"",s),new MB(null);const d=window.open(t||"",s,c);xr(d,e,"popup-blocked");try{d.focus()}catch{}return new MB(d)}function ipe(e,t){const r=document.createElement("a");r.href=e,r.target=t;const n=document.createEvent("MouseEvent");n.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),r.dispatchEvent(n)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ape="__/auth/handler",ope="emulator/auth/handler",spe=encodeURIComponent("fac");async function DB(e,t,r,n,i,a){xr(e.config.authDomain,e,"auth-domain-config-required"),xr(e.config.apiKey,e,"invalid-api-key");const o={apiKey:e.config.apiKey,appName:e.name,authType:r,redirectUrl:n,v:Hb,eventId:i};if(t instanceof UW){t.setDefaultLanguage(e.languageCode),o.providerId=t.providerId||"",ece(t.getCustomParameters())||(o.customParameters=JSON.stringify(t.getCustomParameters()));for(const[c,d]of Object.entries(a||{}))o[c]=d}if(t instanceof $b){const c=t.getScopes().filter(d=>d!=="");c.length>0&&(o.scopes=c.join(","))}e.tenantId&&(o.tid=e.tenantId);const s=o;for(const c of Object.keys(s))s[c]===void 0&&delete s[c];const u=await e._getAppCheckToken(),l=u?`#${spe}=${encodeURIComponent(u)}`:"";return`${upe(e)}?${Vb(s).slice(1)}${l}`}function upe({config:e}){return e.emulator?Uk(e,ope):`https://${e.authDomain}/${ape}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hP="webStorageSupport";class lpe{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=qW,this._completeRedirectFn=kfe,this._overrideRedirectResult=Mfe}async _openPopup(t,r,n,i){var a;Gc((a=this.eventManagers[t._key()])===null||a===void 0?void 0:a.manager,"_initialize() not called before _openPopup()");const o=await DB(t,r,n,mM(),i);return npe(t,o,qk())}async _openRedirect(t,r,n,i){await this._originValidation(t);const a=await DB(t,r,n,mM(),i);return ffe(a),new Promise(()=>{})}_initialize(t){const r=t._key();if(this.eventManagers[r]){const{manager:i,promise:a}=this.eventManagers[r];return i?Promise.resolve(i):(Gc(a,"If manager is not set, promise should be"),a)}const n=this.initAndGetManager(t);return this.eventManagers[r]={promise:n},n.catch(()=>{delete this.eventManagers[r]}),n}async initAndGetManager(t){const r=await Qfe(t),n=new Lfe(t);return r.register("authEvent",i=>(xr(i==null?void 0:i.authEvent,t,"invalid-auth-event"),{status:n.onEvent(i.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[t._key()]={manager:n},this.iframes[t._key()]=r,n}_isIframeWebStorageSupported(t,r){this.iframes[t._key()].send(hP,{type:hP},i=>{var a;const o=(a=i==null?void 0:i[0])===null||a===void 0?void 0:a[hP];o!==void 0&&r(!!o),Nu(t,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(t){const r=t._key();return this.originValidationPromises[r]||(this.originValidationPromises[r]=jfe(t)),this.originValidationPromises[r]}get _shouldInitProactively(){return RW()||zk()||s3()}}const cpe=lpe;var RB="@firebase/auth",kB="0.23.2";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dpe{constructor(t){this.auth=t,this.internalListeners=new Map}getUid(){var t;return this.assertAuthConfigured(),((t=this.auth.currentUser)===null||t===void 0?void 0:t.uid)||null}async getToken(t){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(t)}:null}addAuthTokenListener(t){if(this.assertAuthConfigured(),this.internalListeners.has(t))return;const r=this.auth.onIdTokenChanged(n=>{t((n==null?void 0:n.stsTokenManager.accessToken)||null)});this.internalListeners.set(t,r),this.updateProactiveRefresh()}removeAuthTokenListener(t){this.assertAuthConfigured();const r=this.internalListeners.get(t);r&&(this.internalListeners.delete(t),r(),this.updateProactiveRefresh())}assertAuthConfigured(){xr(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fpe(e){switch(e){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";default:return}}function ppe(e){W1(new kg("auth",(t,{options:r})=>{const n=t.getProvider("app").getImmediate(),i=t.getProvider("heartbeat"),a=t.getProvider("app-check-internal"),{apiKey:o,authDomain:s}=n.options;xr(o&&!o.includes(":"),"invalid-api-key",{appName:n.name});const u={apiKey:o,authDomain:s,clientPlatform:e,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:kW(e)},l=new jde(n,i,a,u);return Vde(l,r),l},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((t,r,n)=>{t.getProvider("auth-internal").initialize()})),W1(new kg("auth-internal",t=>{const r=s0(t.getProvider("auth").getImmediate());return(n=>new dpe(n))(r)},"PRIVATE").setInstantiationMode("EXPLICIT")),og(RB,kB,fpe(e)),og(RB,kB,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hpe=5*60,vpe=dW("authIdTokenMaxAge")||hpe;let OB=null;const mpe=e=>async t=>{const r=t&&await t.getIdTokenResult(),n=r&&(new Date().getTime()-Date.parse(r.issuedAtTime))/1e3;if(n&&n>vpe)return;const i=r==null?void 0:r.token;OB!==i&&(OB=i,await fetch(e,{method:i?"POST":"DELETE",headers:i?{Authorization:`Bearer ${i}`}:{}}))};function gpe(e=ede()){const t=vW(e,"auth");if(t.isInitialized())return t.getImmediate();const r=zde(e,{popupRedirectResolver:cpe,persistence:[Sfe,lfe,qW]}),n=dW("authTokenSyncURL");if(n){const a=mpe(n);ife(r,a,()=>a(r.currentUser)),nfe(r,o=>a(o))}const i=Hle("auth");return i&&Hde(r,`http://${i}`),r}ppe("Browser");const ype={apiKey:"AIzaSyAgwFmiZzi7wejk8yhpOXQ9T9ST58NEba8",authDomain:"ksprotauth.firebaseapp.com",projectId:"ksprotauth",storageBucket:"ksprotauth.appspot.com",messagingSenderId:"430140733022",appId:"1:430140733022:web:c83ed9c239dc6bdacbe6cf",measurementId:"G-VFEEYCG3H1"},bpe=mW(ype),Jh=gpe(bpe),xpe=Fs.createContext({user:null}),Spe=({children:e})=>{const[t,r]=_e.useState(null);return _e.useEffect(()=>Jh.onAuthStateChanged(i=>{r(i)}),[]),P.jsx(xpe.Provider,{value:{user:t},children:e})};/**
 * @remix-run/router v1.6.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Z1(){return Z1=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Z1.apply(this,arguments)}var If;(function(e){e.Pop="POP",e.Push="PUSH",e.Replace="REPLACE"})(If||(If={}));const LB="popstate";function Cpe(e){e===void 0&&(e={});function t(n,i){let{pathname:a,search:o,hash:s}=n.location;return yM("",{pathname:a,search:o,hash:s},i.state&&i.state.usr||null,i.state&&i.state.key||"default")}function r(n,i){return typeof i=="string"?i:ZW(i)}return wpe(t,r,null,e)}function Wi(e,t){if(e===!1||e===null||typeof e>"u")throw new Error(t)}function Wk(e,t){if(!e){typeof console<"u"&&console.warn(t);try{throw new Error(t)}catch{}}}function _pe(){return Math.random().toString(36).substr(2,8)}function FB(e,t){return{usr:e.state,key:e.key,idx:t}}function yM(e,t,r,n){return r===void 0&&(r=null),Z1({pathname:typeof e=="string"?e:e.pathname,search:"",hash:""},typeof t=="string"?l0(t):t,{state:r,key:t&&t.key||n||_pe()})}function ZW(e){let{pathname:t="/",search:r="",hash:n=""}=e;return r&&r!=="?"&&(t+=r.charAt(0)==="?"?r:"?"+r),n&&n!=="#"&&(t+=n.charAt(0)==="#"?n:"#"+n),t}function l0(e){let t={};if(e){let r=e.indexOf("#");r>=0&&(t.hash=e.substr(r),e=e.substr(0,r));let n=e.indexOf("?");n>=0&&(t.search=e.substr(n),e=e.substr(0,n)),e&&(t.pathname=e)}return t}function wpe(e,t,r,n){n===void 0&&(n={});let{window:i=document.defaultView,v5Compat:a=!1}=n,o=i.history,s=If.Pop,u=null,l=c();l==null&&(l=0,o.replaceState(Z1({},o.state,{idx:l}),""));function c(){return(o.state||{idx:null}).idx}function d(){s=If.Pop;let m=c(),g=m==null?null:m-l;l=m,u&&u({action:s,location:h.location,delta:g})}function f(m,g){s=If.Push;let y=yM(h.location,m,g);r&&r(y,m),l=c()+1;let b=FB(y,l),S=h.createHref(y);try{o.pushState(b,"",S)}catch{i.location.assign(S)}a&&u&&u({action:s,location:h.location,delta:1})}function p(m,g){s=If.Replace;let y=yM(h.location,m,g);r&&r(y,m),l=c();let b=FB(y,l),S=h.createHref(y);o.replaceState(b,"",S),a&&u&&u({action:s,location:h.location,delta:0})}function v(m){let g=i.location.origin!=="null"?i.location.origin:i.location.href,y=typeof m=="string"?m:ZW(m);return Wi(g,"No window.location.(origin|href) available to create URL for href: "+y),new URL(y,g)}let h={get action(){return s},get location(){return e(i,o)},listen(m){if(u)throw new Error("A history only accepts one active listener");return i.addEventListener(LB,d),u=m,()=>{i.removeEventListener(LB,d),u=null}},createHref(m){return t(i,m)},createURL:v,encodeLocation(m){let g=v(m);return{pathname:g.pathname,search:g.search,hash:g.hash}},push:f,replace:p,go(m){return o.go(m)}};return h}var NB;(function(e){e.data="data",e.deferred="deferred",e.redirect="redirect",e.error="error"})(NB||(NB={}));function Epe(e,t,r){r===void 0&&(r="/");let n=typeof t=="string"?l0(t):t,i=tX(n.pathname||"/",r);if(i==null)return null;let a=JW(e);Ape(a);let o=null;for(let s=0;o==null&&s<a.length;++s)o=Lpe(a[s],Bpe(i));return o}function JW(e,t,r,n){t===void 0&&(t=[]),r===void 0&&(r=[]),n===void 0&&(n="");let i=(a,o,s)=>{let u={relativePath:s===void 0?a.path||"":s,caseSensitive:a.caseSensitive===!0,childrenIndex:o,route:a};u.relativePath.startsWith("/")&&(Wi(u.relativePath.startsWith(n),'Absolute route path "'+u.relativePath+'" nested under path '+('"'+n+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),u.relativePath=u.relativePath.slice(n.length));let l=kh([n,u.relativePath]),c=r.concat(u);a.children&&a.children.length>0&&(Wi(a.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+l+'".')),JW(a.children,t,c,l)),!(a.path==null&&!a.index)&&t.push({path:l,score:kpe(l,a.index),routesMeta:c})};return e.forEach((a,o)=>{var s;if(a.path===""||!((s=a.path)!=null&&s.includes("?")))i(a,o);else for(let u of eX(a.path))i(a,o,u)}),t}function eX(e){let t=e.split("/");if(t.length===0)return[];let[r,...n]=t,i=r.endsWith("?"),a=r.replace(/\?$/,"");if(n.length===0)return i?[a,""]:[a];let o=eX(n.join("/")),s=[];return s.push(...o.map(u=>u===""?a:[a,u].join("/"))),i&&s.push(...o),s.map(u=>e.startsWith("/")&&u===""?"/":u)}function Ape(e){e.sort((t,r)=>t.score!==r.score?r.score-t.score:Ope(t.routesMeta.map(n=>n.childrenIndex),r.routesMeta.map(n=>n.childrenIndex)))}const Ppe=/^:\w+$/,Tpe=3,Ipe=2,Mpe=1,Dpe=10,Rpe=-2,BB=e=>e==="*";function kpe(e,t){let r=e.split("/"),n=r.length;return r.some(BB)&&(n+=Rpe),t&&(n+=Ipe),r.filter(i=>!BB(i)).reduce((i,a)=>i+(Ppe.test(a)?Tpe:a===""?Mpe:Dpe),n)}function Ope(e,t){return e.length===t.length&&e.slice(0,-1).every((n,i)=>n===t[i])?e[e.length-1]-t[t.length-1]:0}function Lpe(e,t){let{routesMeta:r}=e,n={},i="/",a=[];for(let o=0;o<r.length;++o){let s=r[o],u=o===r.length-1,l=i==="/"?t:t.slice(i.length)||"/",c=Fpe({path:s.relativePath,caseSensitive:s.caseSensitive,end:u},l);if(!c)return null;Object.assign(n,c.params);let d=s.route;a.push({params:n,pathname:kh([i,c.pathname]),pathnameBase:Gpe(kh([i,c.pathnameBase])),route:d}),c.pathnameBase!=="/"&&(i=kh([i,c.pathnameBase]))}return a}function Fpe(e,t){typeof e=="string"&&(e={path:e,caseSensitive:!1,end:!0});let[r,n]=Npe(e.path,e.caseSensitive,e.end),i=t.match(r);if(!i)return null;let a=i[0],o=a.replace(/(.)\/+$/,"$1"),s=i.slice(1);return{params:n.reduce((l,c,d)=>{if(c==="*"){let f=s[d]||"";o=a.slice(0,a.length-f.length).replace(/(.)\/+$/,"$1")}return l[c]=Upe(s[d]||"",c),l},{}),pathname:a,pathnameBase:o,pattern:e}}function Npe(e,t,r){t===void 0&&(t=!1),r===void 0&&(r=!0),Wk(e==="*"||!e.endsWith("*")||e.endsWith("/*"),'Route path "'+e+'" will be treated as if it were '+('"'+e.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+e.replace(/\*$/,"/*")+'".'));let n=[],i="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^$?{}|()[\]]/g,"\\$&").replace(/\/:(\w+)/g,(o,s)=>(n.push(s),"/([^\\/]+)"));return e.endsWith("*")?(n.push("*"),i+=e==="*"||e==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):r?i+="\\/*$":e!==""&&e!=="/"&&(i+="(?:(?=\\/|$))"),[new RegExp(i,t?void 0:"i"),n]}function Bpe(e){try{return decodeURI(e)}catch(t){return Wk(!1,'The URL path "'+e+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+t+").")),e}}function Upe(e,t){try{return decodeURIComponent(e)}catch(r){return Wk(!1,'The value for the URL param "'+t+'" will not be decoded because'+(' the string "'+e+'" is a malformed URL segment. This is probably')+(" due to a bad percent encoding ("+r+").")),e}}function tX(e,t){if(t==="/")return e;if(!e.toLowerCase().startsWith(t.toLowerCase()))return null;let r=t.endsWith("/")?t.length-1:t.length,n=e.charAt(r);return n&&n!=="/"?null:e.slice(r)||"/"}function jpe(e,t){t===void 0&&(t="/");let{pathname:r,search:n="",hash:i=""}=typeof e=="string"?l0(e):e;return{pathname:r?r.startsWith("/")?r:zpe(r,t):t,search:qpe(n),hash:$pe(i)}}function zpe(e,t){let r=t.replace(/\/+$/,"").split("/");return e.split("/").forEach(i=>{i===".."?r.length>1&&r.pop():i!=="."&&r.push(i)}),r.length>1?r.join("/"):"/"}function vP(e,t,r,n){return"Cannot include a '"+e+"' character in a manually specified "+("`to."+t+"` field ["+JSON.stringify(n)+"].  Please separate it out to the ")+("`to."+r+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function Vpe(e){return e.filter((t,r)=>r===0||t.route.path&&t.route.path.length>0)}function Hpe(e,t,r,n){n===void 0&&(n=!1);let i;typeof e=="string"?i=l0(e):(i=Z1({},e),Wi(!i.pathname||!i.pathname.includes("?"),vP("?","pathname","search",i)),Wi(!i.pathname||!i.pathname.includes("#"),vP("#","pathname","hash",i)),Wi(!i.search||!i.search.includes("#"),vP("#","search","hash",i)));let a=e===""||i.pathname==="",o=a?"/":i.pathname,s;if(n||o==null)s=r;else{let d=t.length-1;if(o.startsWith("..")){let f=o.split("/");for(;f[0]==="..";)f.shift(),d-=1;i.pathname=f.join("/")}s=d>=0?t[d]:"/"}let u=jpe(i,s),l=o&&o!=="/"&&o.endsWith("/"),c=(a||o===".")&&r.endsWith("/");return!u.pathname.endsWith("/")&&(l||c)&&(u.pathname+="/"),u}const kh=e=>e.join("/").replace(/\/\/+/g,"/"),Gpe=e=>e.replace(/\/+$/,"").replace(/^\/*/,"/"),qpe=e=>!e||e==="?"?"":e.startsWith("?")?e:"?"+e,$pe=e=>!e||e==="#"?"":e.startsWith("#")?e:"#"+e;function Wpe(e){return e!=null&&typeof e.status=="number"&&typeof e.statusText=="string"&&typeof e.internal=="boolean"&&"data"in e}const rX=["post","put","patch","delete"];new Set(rX);const Xpe=["get",...rX];new Set(Xpe);/**
 * React Router v6.11.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function VC(){return VC=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},VC.apply(this,arguments)}const Xk=_e.createContext(null),Ype=_e.createContext(null),c3=_e.createContext(null),d3=_e.createContext(null),Pv=_e.createContext({outlet:null,matches:[],isDataRoute:!1}),nX=_e.createContext(null);function f3(){return _e.useContext(d3)!=null}function Yk(){return f3()||Wi(!1),_e.useContext(d3).location}function iX(e){_e.useContext(c3).static||_e.useLayoutEffect(e)}function vd(){let{isDataRoute:e}=_e.useContext(Pv);return e?lhe():Kpe()}function Kpe(){f3()||Wi(!1);let e=_e.useContext(Xk),{basename:t,navigator:r}=_e.useContext(c3),{matches:n}=_e.useContext(Pv),{pathname:i}=Yk(),a=JSON.stringify(Vpe(n).map(u=>u.pathnameBase)),o=_e.useRef(!1);return iX(()=>{o.current=!0}),_e.useCallback(function(u,l){if(l===void 0&&(l={}),!o.current)return;if(typeof u=="number"){r.go(u);return}let c=Hpe(u,JSON.parse(a),i,l.relative==="path");e==null&&t!=="/"&&(c.pathname=c.pathname==="/"?t:kh([t,c.pathname])),(l.replace?r.replace:r.push)(c,l.state,l)},[t,r,a,i,e])}function Qpe(){let{matches:e}=_e.useContext(Pv),t=e[e.length-1];return t?t.params:{}}function Zpe(e,t){return Jpe(e,t)}function Jpe(e,t,r){f3()||Wi(!1);let{navigator:n}=_e.useContext(c3),{matches:i}=_e.useContext(Pv),a=i[i.length-1],o=a?a.params:{};a&&a.pathname;let s=a?a.pathnameBase:"/";a&&a.route;let u=Yk(),l;if(t){var c;let h=typeof t=="string"?l0(t):t;s==="/"||(c=h.pathname)!=null&&c.startsWith(s)||Wi(!1),l=h}else l=u;let d=l.pathname||"/",f=s==="/"?d:d.slice(s.length)||"/",p=Epe(e,{pathname:f}),v=ihe(p&&p.map(h=>Object.assign({},h,{params:Object.assign({},o,h.params),pathname:kh([s,n.encodeLocation?n.encodeLocation(h.pathname).pathname:h.pathname]),pathnameBase:h.pathnameBase==="/"?s:kh([s,n.encodeLocation?n.encodeLocation(h.pathnameBase).pathname:h.pathnameBase])})),i,r);return t&&v?_e.createElement(d3.Provider,{value:{location:VC({pathname:"/",search:"",hash:"",state:null,key:"default"},l),navigationType:If.Pop}},v):v}function ehe(){let e=uhe(),t=Wpe(e)?e.status+" "+e.statusText:e instanceof Error?e.message:JSON.stringify(e),r=e instanceof Error?e.stack:null,i={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"},a=null;return _e.createElement(_e.Fragment,null,_e.createElement("h2",null,"Unexpected Application Error!"),_e.createElement("h3",{style:{fontStyle:"italic"}},t),r?_e.createElement("pre",{style:i},r):null,a)}const the=_e.createElement(ehe,null);class rhe extends _e.Component{constructor(t){super(t),this.state={location:t.location,revalidation:t.revalidation,error:t.error}}static getDerivedStateFromError(t){return{error:t}}static getDerivedStateFromProps(t,r){return r.location!==t.location||r.revalidation!=="idle"&&t.revalidation==="idle"?{error:t.error,location:t.location,revalidation:t.revalidation}:{error:t.error||r.error,location:r.location,revalidation:t.revalidation||r.revalidation}}componentDidCatch(t,r){console.error("React Router caught the following error during render",t,r)}render(){return this.state.error?_e.createElement(Pv.Provider,{value:this.props.routeContext},_e.createElement(nX.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function nhe(e){let{routeContext:t,match:r,children:n}=e,i=_e.useContext(Xk);return i&&i.static&&i.staticContext&&(r.route.errorElement||r.route.ErrorBoundary)&&(i.staticContext._deepestRenderedBoundaryId=r.route.id),_e.createElement(Pv.Provider,{value:t},n)}function ihe(e,t,r){var n;if(t===void 0&&(t=[]),r===void 0&&(r=null),e==null){var i;if((i=r)!=null&&i.errors)e=r.matches;else return null}let a=e,o=(n=r)==null?void 0:n.errors;if(o!=null){let s=a.findIndex(u=>u.route.id&&(o==null?void 0:o[u.route.id]));s>=0||Wi(!1),a=a.slice(0,Math.min(a.length,s+1))}return a.reduceRight((s,u,l)=>{let c=u.route.id?o==null?void 0:o[u.route.id]:null,d=null;r&&(d=u.route.errorElement||the);let f=t.concat(a.slice(0,l+1)),p=()=>{let v;return c?v=d:u.route.Component?v=_e.createElement(u.route.Component,null):u.route.element?v=u.route.element:v=s,_e.createElement(nhe,{match:u,routeContext:{outlet:s,matches:f,isDataRoute:r!=null},children:v})};return r&&(u.route.ErrorBoundary||u.route.errorElement||l===0)?_e.createElement(rhe,{location:r.location,revalidation:r.revalidation,component:d,error:c,children:p(),routeContext:{outlet:null,matches:f,isDataRoute:!0}}):p()},null)}var bM;(function(e){e.UseBlocker="useBlocker",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate"})(bM||(bM={}));var J1;(function(e){e.UseBlocker="useBlocker",e.UseLoaderData="useLoaderData",e.UseActionData="useActionData",e.UseRouteError="useRouteError",e.UseNavigation="useNavigation",e.UseRouteLoaderData="useRouteLoaderData",e.UseMatches="useMatches",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e.UseRouteId="useRouteId"})(J1||(J1={}));function ahe(e){let t=_e.useContext(Xk);return t||Wi(!1),t}function ohe(e){let t=_e.useContext(Ype);return t||Wi(!1),t}function she(e){let t=_e.useContext(Pv);return t||Wi(!1),t}function aX(e){let t=she(),r=t.matches[t.matches.length-1];return r.route.id||Wi(!1),r.route.id}function uhe(){var e;let t=_e.useContext(nX),r=ohe(J1.UseRouteError),n=aX(J1.UseRouteError);return t||((e=r.errors)==null?void 0:e[n])}function lhe(){let{router:e}=ahe(bM.UseNavigateStable),t=aX(J1.UseNavigateStable),r=_e.useRef(!1);return iX(()=>{r.current=!0}),_e.useCallback(function(i,a){a===void 0&&(a={}),r.current&&(typeof i=="number"?e.navigate(i):e.navigate(i,VC({fromRouteId:t},a)))},[e,t])}function oh(e){Wi(!1)}function che(e){let{basename:t="/",children:r=null,location:n,navigationType:i=If.Pop,navigator:a,static:o=!1}=e;f3()&&Wi(!1);let s=t.replace(/^\/*/,"/"),u=_e.useMemo(()=>({basename:s,navigator:a,static:o}),[s,a,o]);typeof n=="string"&&(n=l0(n));let{pathname:l="/",search:c="",hash:d="",state:f=null,key:p="default"}=n,v=_e.useMemo(()=>{let h=tX(l,s);return h==null?null:{location:{pathname:h,search:c,hash:d,state:f,key:p},navigationType:i}},[s,l,c,d,f,p,i]);return v==null?null:_e.createElement(c3.Provider,{value:u},_e.createElement(d3.Provider,{children:r,value:v}))}function dhe(e){let{children:t,location:r}=e;return Zpe(xM(t),r)}var UB;(function(e){e[e.pending=0]="pending",e[e.success=1]="success",e[e.error=2]="error"})(UB||(UB={}));new Promise(()=>{});function xM(e,t){t===void 0&&(t=[]);let r=[];return _e.Children.forEach(e,(n,i)=>{if(!_e.isValidElement(n))return;let a=[...t,i];if(n.type===_e.Fragment){r.push.apply(r,xM(n.props.children,a));return}n.type!==oh&&Wi(!1),!n.props.index||!n.props.children||Wi(!1);let o={id:n.props.id||a.join("-"),caseSensitive:n.props.caseSensitive,element:n.props.element,Component:n.props.Component,index:n.props.index,path:n.props.path,loader:n.props.loader,action:n.props.action,errorElement:n.props.errorElement,ErrorBoundary:n.props.ErrorBoundary,hasErrorBoundary:n.props.ErrorBoundary!=null||n.props.errorElement!=null,shouldRevalidate:n.props.shouldRevalidate,handle:n.props.handle,lazy:n.props.lazy};n.props.children&&(o.children=xM(n.props.children,a)),r.push(o)}),r}/**
 * React Router DOM v6.11.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function SM(e){return e===void 0&&(e=""),new URLSearchParams(typeof e=="string"||Array.isArray(e)||e instanceof URLSearchParams?e:Object.keys(e).reduce((t,r)=>{let n=e[r];return t.concat(Array.isArray(n)?n.map(i=>[r,i]):[[r,n]])},[]))}function fhe(e,t){let r=SM(e);if(t)for(let n of t.keys())r.has(n)||t.getAll(n).forEach(i=>{r.append(n,i)});return r}function phe(e){let{basename:t,children:r,window:n}=e,i=_e.useRef();i.current==null&&(i.current=Cpe({window:n,v5Compat:!0}));let a=i.current,[o,s]=_e.useState({action:a.action,location:a.location});return _e.useLayoutEffect(()=>a.listen(s),[a]),_e.createElement(che,{basename:t,children:r,location:o.location,navigationType:o.action,navigator:a})}var jB;(function(e){e.UseScrollRestoration="useScrollRestoration",e.UseSubmitImpl="useSubmitImpl",e.UseFetcher="useFetcher"})(jB||(jB={}));var zB;(function(e){e.UseFetchers="useFetchers",e.UseScrollRestoration="useScrollRestoration"})(zB||(zB={}));function hhe(e){let t=_e.useRef(SM(e)),r=_e.useRef(!1),n=Yk(),i=_e.useMemo(()=>fhe(n.search,r.current?null:t.current),[n.search]),a=vd(),o=_e.useCallback((s,u)=>{const l=SM(typeof s=="function"?s(i):s);r.current=!0,a("?"+l,u)},[a,i]);return[i,o]}const vhe=()=>{const e=vd(),t=()=>{e("/auth")};return _e.useEffect(()=>{const r=Gk(Jh,n=>{n&&e("/search")});return()=>r()},[]),P.jsx("div",{className:"app-main-wrapper",children:P.jsxs("div",{className:"app-main",children:[P.jsx("span",{className:"app-title",children:"Q-1 Search"}),P.jsx("span",{className:"app-description",children:"Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt u"}),P.jsx("button",{className:"app-login",onClick:t,children:"Login"})]})})},Kk=()=>{const e=vd(),[t,r]=Fs.useState("");_e.useEffect(()=>{const i=Gk(Jh,a=>{a?r(a.email?a.email:""):e("/")});return()=>i()},[]);const n=()=>{afe(Jh).then(()=>{e("/")}).catch(i=>{console.error("Sign out error: "+i)})};return P.jsxs("div",{className:"app-header",children:[P.jsx("div",{className:"app-header-login",children:t}),P.jsx("button",{className:"app-header-button",onClick:n,children:"Log Out"})]})};function xu(e){for(var t=arguments.length,r=Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];throw Error("[Immer] minified error nr: "+e+(r.length?" "+r.map(function(i){return"'"+i+"'"}).join(","):"")+". Find the full error at: https://bit.ly/3cXEKWf")}function ap(e){return!!e&&!!e[ti]}function qc(e){var t;return!!e&&(function(r){if(!r||typeof r!="object")return!1;var n=Object.getPrototypeOf(r);if(n===null)return!0;var i=Object.hasOwnProperty.call(n,"constructor")&&n.constructor;return i===Object||typeof i=="function"&&Function.toString.call(i)===whe}(e)||Array.isArray(e)||!!e[XB]||!!(!((t=e.constructor)===null||t===void 0)&&t[XB])||Qk(e)||Zk(e))}function ev(e,t,r){r===void 0&&(r=!1),c0(e)===0?(r?Object.keys:cg)(e).forEach(function(n){r&&typeof n=="symbol"||t(n,e[n],e)}):e.forEach(function(n,i){return t(i,n,e)})}function c0(e){var t=e[ti];return t?t.i>3?t.i-4:t.i:Array.isArray(e)?1:Qk(e)?2:Zk(e)?3:0}function lg(e,t){return c0(e)===2?e.has(t):Object.prototype.hasOwnProperty.call(e,t)}function mhe(e,t){return c0(e)===2?e.get(t):e[t]}function oX(e,t,r){var n=c0(e);n===2?e.set(t,r):n===3?e.add(r):e[t]=r}function sX(e,t){return e===t?e!==0||1/e==1/t:e!=e&&t!=t}function Qk(e){return Che&&e instanceof Map}function Zk(e){return _he&&e instanceof Set}function sh(e){return e.o||e.t}function Jk(e){if(Array.isArray(e))return Array.prototype.slice.call(e);var t=lX(e);delete t[ti];for(var r=cg(t),n=0;n<r.length;n++){var i=r[n],a=t[i];a.writable===!1&&(a.writable=!0,a.configurable=!0),(a.get||a.set)&&(t[i]={configurable:!0,writable:!0,enumerable:a.enumerable,value:e[i]})}return Object.create(Object.getPrototypeOf(e),t)}function eO(e,t){return t===void 0&&(t=!1),tO(e)||ap(e)||!qc(e)||(c0(e)>1&&(e.set=e.add=e.clear=e.delete=ghe),Object.freeze(e),t&&ev(e,function(r,n){return eO(n,!0)},!0)),e}function ghe(){xu(2)}function tO(e){return e==null||typeof e!="object"||Object.isFrozen(e)}function Il(e){var t=EM[e];return t||xu(18,e),t}function yhe(e,t){EM[e]||(EM[e]=t)}function CM(){return eb}function mP(e,t){t&&(Il("Patches"),e.u=[],e.s=[],e.v=t)}function HC(e){_M(e),e.p.forEach(bhe),e.p=null}function _M(e){e===eb&&(eb=e.l)}function VB(e){return eb={p:[],l:eb,h:e,m:!0,_:0}}function bhe(e){var t=e[ti];t.i===0||t.i===1?t.j():t.g=!0}function gP(e,t){t._=t.p.length;var r=t.p[0],n=e!==void 0&&e!==r;return t.h.O||Il("ES5").S(t,e,n),n?(r[ti].P&&(HC(t),xu(4)),qc(e)&&(e=GC(t,e),t.l||qC(t,e)),t.u&&Il("Patches").M(r[ti].t,e,t.u,t.s)):e=GC(t,r,[]),HC(t),t.u&&t.v(t.u,t.s),e!==uX?e:void 0}function GC(e,t,r){if(tO(t))return t;var n=t[ti];if(!n)return ev(t,function(s,u){return HB(e,n,t,s,u,r)},!0),t;if(n.A!==e)return t;if(!n.P)return qC(e,n.t,!0),n.t;if(!n.I){n.I=!0,n.A._--;var i=n.i===4||n.i===5?n.o=Jk(n.k):n.o,a=i,o=!1;n.i===3&&(a=new Set(i),i.clear(),o=!0),ev(a,function(s,u){return HB(e,n,i,s,u,r,o)}),qC(e,i,!1),r&&e.u&&Il("Patches").N(n,r,e.u,e.s)}return n.o}function HB(e,t,r,n,i,a,o){if(ap(i)){var s=GC(e,i,a&&t&&t.i!==3&&!lg(t.R,n)?a.concat(n):void 0);if(oX(r,n,s),!ap(s))return;e.m=!1}else o&&r.add(i);if(qc(i)&&!tO(i)){if(!e.h.D&&e._<1)return;GC(e,i),t&&t.A.l||qC(e,i)}}function qC(e,t,r){r===void 0&&(r=!1),!e.l&&e.h.D&&e.m&&eO(t,r)}function yP(e,t){var r=e[ti];return(r?sh(r):e)[t]}function GB(e,t){if(t in e)for(var r=Object.getPrototypeOf(e);r;){var n=Object.getOwnPropertyDescriptor(r,t);if(n)return n;r=Object.getPrototypeOf(r)}}function gf(e){e.P||(e.P=!0,e.l&&gf(e.l))}function bP(e){e.o||(e.o=Jk(e.t))}function wM(e,t,r){var n=Qk(t)?Il("MapSet").F(t,r):Zk(t)?Il("MapSet").T(t,r):e.O?function(i,a){var o=Array.isArray(i),s={i:o?1:0,A:a?a.A:CM(),P:!1,I:!1,R:{},l:a,t:i,k:null,o:null,j:null,C:!1},u=s,l=tb;o&&(u=[s],l=Ly);var c=Proxy.revocable(u,l),d=c.revoke,f=c.proxy;return s.k=f,s.j=d,f}(t,r):Il("ES5").J(t,r);return(r?r.A:CM()).p.push(n),n}function xhe(e){return ap(e)||xu(22,e),function t(r){if(!qc(r))return r;var n,i=r[ti],a=c0(r);if(i){if(!i.P&&(i.i<4||!Il("ES5").K(i)))return i.t;i.I=!0,n=qB(r,a),i.I=!1}else n=qB(r,a);return ev(n,function(o,s){i&&mhe(i.t,o)===s||oX(n,o,t(s))}),a===3?new Set(n):n}(e)}function qB(e,t){switch(t){case 2:return new Map(e);case 3:return Array.from(e)}return Jk(e)}function She(){function e(a,o){var s=i[a];return s?s.enumerable=o:i[a]=s={configurable:!0,enumerable:o,get:function(){var u=this[ti];return tb.get(u,a)},set:function(u){var l=this[ti];tb.set(l,a,u)}},s}function t(a){for(var o=a.length-1;o>=0;o--){var s=a[o][ti];if(!s.P)switch(s.i){case 5:n(s)&&gf(s);break;case 4:r(s)&&gf(s)}}}function r(a){for(var o=a.t,s=a.k,u=cg(s),l=u.length-1;l>=0;l--){var c=u[l];if(c!==ti){var d=o[c];if(d===void 0&&!lg(o,c))return!0;var f=s[c],p=f&&f[ti];if(p?p.t!==d:!sX(f,d))return!0}}var v=!!o[ti];return u.length!==cg(o).length+(v?0:1)}function n(a){var o=a.k;if(o.length!==a.t.length)return!0;var s=Object.getOwnPropertyDescriptor(o,o.length-1);if(s&&!s.get)return!0;for(var u=0;u<o.length;u++)if(!o.hasOwnProperty(u))return!0;return!1}var i={};yhe("ES5",{J:function(a,o){var s=Array.isArray(a),u=function(c,d){if(c){for(var f=Array(d.length),p=0;p<d.length;p++)Object.defineProperty(f,""+p,e(p,!0));return f}var v=lX(d);delete v[ti];for(var h=cg(v),m=0;m<h.length;m++){var g=h[m];v[g]=e(g,c||!!v[g].enumerable)}return Object.create(Object.getPrototypeOf(d),v)}(s,a),l={i:s?5:4,A:o?o.A:CM(),P:!1,I:!1,R:{},l:o,t:a,k:u,o:null,g:!1,C:!1};return Object.defineProperty(u,ti,{value:l,writable:!0}),u},S:function(a,o,s){s?ap(o)&&o[ti].A===a&&t(a.p):(a.u&&function u(l){if(l&&typeof l=="object"){var c=l[ti];if(c){var d=c.t,f=c.k,p=c.R,v=c.i;if(v===4)ev(f,function(b){b!==ti&&(d[b]!==void 0||lg(d,b)?p[b]||u(f[b]):(p[b]=!0,gf(c)))}),ev(d,function(b){f[b]!==void 0||lg(f,b)||(p[b]=!1,gf(c))});else if(v===5){if(n(c)&&(gf(c),p.length=!0),f.length<d.length)for(var h=f.length;h<d.length;h++)p[h]=!1;else for(var m=d.length;m<f.length;m++)p[m]=!0;for(var g=Math.min(f.length,d.length),y=0;y<g;y++)f.hasOwnProperty(y)||(p[y]=!0),p[y]===void 0&&u(f[y])}}}}(a.p[0]),t(a.p))},K:function(a){return a.i===4?r(a):n(a)}})}var $B,eb,rO=typeof Symbol<"u"&&typeof Symbol("x")=="symbol",Che=typeof Map<"u",_he=typeof Set<"u",WB=typeof Proxy<"u"&&Proxy.revocable!==void 0&&typeof Reflect<"u",uX=rO?Symbol.for("immer-nothing"):(($B={})["immer-nothing"]=!0,$B),XB=rO?Symbol.for("immer-draftable"):"__$immer_draftable",ti=rO?Symbol.for("immer-state"):"__$immer_state",whe=""+Object.prototype.constructor,cg=typeof Reflect<"u"&&Reflect.ownKeys?Reflect.ownKeys:Object.getOwnPropertySymbols!==void 0?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:Object.getOwnPropertyNames,lX=Object.getOwnPropertyDescriptors||function(e){var t={};return cg(e).forEach(function(r){t[r]=Object.getOwnPropertyDescriptor(e,r)}),t},EM={},tb={get:function(e,t){if(t===ti)return e;var r=sh(e);if(!lg(r,t))return function(i,a,o){var s,u=GB(a,o);return u?"value"in u?u.value:(s=u.get)===null||s===void 0?void 0:s.call(i.k):void 0}(e,r,t);var n=r[t];return e.I||!qc(n)?n:n===yP(e.t,t)?(bP(e),e.o[t]=wM(e.A.h,n,e)):n},has:function(e,t){return t in sh(e)},ownKeys:function(e){return Reflect.ownKeys(sh(e))},set:function(e,t,r){var n=GB(sh(e),t);if(n!=null&&n.set)return n.set.call(e.k,r),!0;if(!e.P){var i=yP(sh(e),t),a=i==null?void 0:i[ti];if(a&&a.t===r)return e.o[t]=r,e.R[t]=!1,!0;if(sX(r,i)&&(r!==void 0||lg(e.t,t)))return!0;bP(e),gf(e)}return e.o[t]===r&&(r!==void 0||t in e.o)||Number.isNaN(r)&&Number.isNaN(e.o[t])||(e.o[t]=r,e.R[t]=!0),!0},deleteProperty:function(e,t){return yP(e.t,t)!==void 0||t in e.t?(e.R[t]=!1,bP(e),gf(e)):delete e.R[t],e.o&&delete e.o[t],!0},getOwnPropertyDescriptor:function(e,t){var r=sh(e),n=Reflect.getOwnPropertyDescriptor(r,t);return n&&{writable:!0,configurable:e.i!==1||t!=="length",enumerable:n.enumerable,value:r[t]}},defineProperty:function(){xu(11)},getPrototypeOf:function(e){return Object.getPrototypeOf(e.t)},setPrototypeOf:function(){xu(12)}},Ly={};ev(tb,function(e,t){Ly[e]=function(){return arguments[0]=arguments[0][0],t.apply(this,arguments)}}),Ly.deleteProperty=function(e,t){return Ly.set.call(this,e,t,void 0)},Ly.set=function(e,t,r){return tb.set.call(this,e[0],t,r,e[0])};var Ehe=function(){function e(r){var n=this;this.O=WB,this.D=!0,this.produce=function(i,a,o){if(typeof i=="function"&&typeof a!="function"){var s=a;a=i;var u=n;return function(h){var m=this;h===void 0&&(h=s);for(var g=arguments.length,y=Array(g>1?g-1:0),b=1;b<g;b++)y[b-1]=arguments[b];return u.produce(h,function(S){var x;return(x=a).call.apply(x,[m,S].concat(y))})}}var l;if(typeof a!="function"&&xu(6),o!==void 0&&typeof o!="function"&&xu(7),qc(i)){var c=VB(n),d=wM(n,i,void 0),f=!0;try{l=a(d),f=!1}finally{f?HC(c):_M(c)}return typeof Promise<"u"&&l instanceof Promise?l.then(function(h){return mP(c,o),gP(h,c)},function(h){throw HC(c),h}):(mP(c,o),gP(l,c))}if(!i||typeof i!="object"){if((l=a(i))===void 0&&(l=i),l===uX&&(l=void 0),n.D&&eO(l,!0),o){var p=[],v=[];Il("Patches").M(i,l,p,v),o(p,v)}return l}xu(21,i)},this.produceWithPatches=function(i,a){if(typeof i=="function")return function(l){for(var c=arguments.length,d=Array(c>1?c-1:0),f=1;f<c;f++)d[f-1]=arguments[f];return n.produceWithPatches(l,function(p){return i.apply(void 0,[p].concat(d))})};var o,s,u=n.produce(i,a,function(l,c){o=l,s=c});return typeof Promise<"u"&&u instanceof Promise?u.then(function(l){return[l,o,s]}):[u,o,s]},typeof(r==null?void 0:r.useProxies)=="boolean"&&this.setUseProxies(r.useProxies),typeof(r==null?void 0:r.autoFreeze)=="boolean"&&this.setAutoFreeze(r.autoFreeze)}var t=e.prototype;return t.createDraft=function(r){qc(r)||xu(8),ap(r)&&(r=xhe(r));var n=VB(this),i=wM(this,r,void 0);return i[ti].C=!0,_M(n),i},t.finishDraft=function(r,n){var i=r&&r[ti],a=i.A;return mP(a,n),gP(void 0,a)},t.setAutoFreeze=function(r){this.D=r},t.setUseProxies=function(r){r&&!WB&&xu(20),this.O=r},t.applyPatches=function(r,n){var i;for(i=n.length-1;i>=0;i--){var a=n[i];if(a.path.length===0&&a.op==="replace"){r=a.value;break}}i>-1&&(n=n.slice(i+1));var o=Il("Patches").$;return ap(r)?o(r,n):this.produce(r,function(s){return o(s,n)})},e}(),ts=new Ehe,cX=ts.produce;ts.produceWithPatches.bind(ts);ts.setAutoFreeze.bind(ts);ts.setUseProxies.bind(ts);ts.applyPatches.bind(ts);ts.createDraft.bind(ts);ts.finishDraft.bind(ts);function tv(e){return tv=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},tv(e)}function Ahe(e,t){if(tv(e)!=="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(tv(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function dX(e){var t=Ahe(e,"string");return tv(t)==="symbol"?t:String(t)}function Fy(e,t,r){return t=dX(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function YB(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function vr(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?YB(Object(r),!0).forEach(function(n){Fy(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):YB(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Ia(e){return"Minified Redux error #"+e+"; visit https://redux.js.org/Errors?code="+e+" for the full message or use the non-minified dev environment for full errors. "}var KB=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}(),xP=function(){return Math.random().toString(36).substring(7).split("").join(".")},$C={INIT:"@@redux/INIT"+xP(),REPLACE:"@@redux/REPLACE"+xP(),PROBE_UNKNOWN_ACTION:function(){return"@@redux/PROBE_UNKNOWN_ACTION"+xP()}};function Phe(e){if(typeof e!="object"||e===null)return!1;for(var t=e;Object.getPrototypeOf(t)!==null;)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}function fX(e,t,r){var n;if(typeof t=="function"&&typeof r=="function"||typeof r=="function"&&typeof arguments[3]=="function")throw new Error(Ia(0));if(typeof t=="function"&&typeof r>"u"&&(r=t,t=void 0),typeof r<"u"){if(typeof r!="function")throw new Error(Ia(1));return r(fX)(e,t)}if(typeof e!="function")throw new Error(Ia(2));var i=e,a=t,o=[],s=o,u=!1;function l(){s===o&&(s=o.slice())}function c(){if(u)throw new Error(Ia(3));return a}function d(h){if(typeof h!="function")throw new Error(Ia(4));if(u)throw new Error(Ia(5));var m=!0;return l(),s.push(h),function(){if(m){if(u)throw new Error(Ia(6));m=!1,l();var y=s.indexOf(h);s.splice(y,1),o=null}}}function f(h){if(!Phe(h))throw new Error(Ia(7));if(typeof h.type>"u")throw new Error(Ia(8));if(u)throw new Error(Ia(9));try{u=!0,a=i(a,h)}finally{u=!1}for(var m=o=s,g=0;g<m.length;g++){var y=m[g];y()}return h}function p(h){if(typeof h!="function")throw new Error(Ia(10));i=h,f({type:$C.REPLACE})}function v(){var h,m=d;return h={subscribe:function(y){if(typeof y!="object"||y===null)throw new Error(Ia(11));function b(){y.next&&y.next(c())}b();var S=m(b);return{unsubscribe:S}}},h[KB]=function(){return this},h}return f({type:$C.INIT}),n={dispatch:f,subscribe:d,getState:c,replaceReducer:p},n[KB]=v,n}function The(e){Object.keys(e).forEach(function(t){var r=e[t],n=r(void 0,{type:$C.INIT});if(typeof n>"u")throw new Error(Ia(12));if(typeof r(void 0,{type:$C.PROBE_UNKNOWN_ACTION()})>"u")throw new Error(Ia(13))})}function Ihe(e){for(var t=Object.keys(e),r={},n=0;n<t.length;n++){var i=t[n];typeof e[i]=="function"&&(r[i]=e[i])}var a=Object.keys(r),o;try{The(r)}catch(s){o=s}return function(u,l){if(u===void 0&&(u={}),o)throw o;for(var c=!1,d={},f=0;f<a.length;f++){var p=a[f],v=r[p],h=u[p],m=v(h,l);if(typeof m>"u")throw l&&l.type,new Error(Ia(14));d[p]=m,c=c||m!==h}return c=c||a.length!==Object.keys(u).length,c?d:u}}function WC(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return t.length===0?function(n){return n}:t.length===1?t[0]:t.reduce(function(n,i){return function(){return n(i.apply(void 0,arguments))}})}function Mhe(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return function(n){return function(){var i=n.apply(void 0,arguments),a=function(){throw new Error(Ia(15))},o={getState:i.getState,dispatch:function(){return a.apply(void 0,arguments)}},s=t.map(function(u){return u(o)});return a=WC.apply(void 0,s)(i.dispatch),vr(vr({},i),{},{dispatch:a})}}}function pX(e){var t=function(n){var i=n.dispatch,a=n.getState;return function(o){return function(s){return typeof s=="function"?s(i,a,e):o(s)}}};return t}var hX=pX();hX.withExtraArgument=pX;const AM=hX;var vX=globalThis&&globalThis.__extends||function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(n[a]=i[a])},e(t,r)};return function(t,r){if(typeof r!="function"&&r!==null)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");e(t,r);function n(){this.constructor=t}t.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}}(),Dhe=globalThis&&globalThis.__generator||function(e,t){var r={label:0,sent:function(){if(a[0]&1)throw a[1];return a[1]},trys:[],ops:[]},n,i,a,o;return o={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function s(l){return function(c){return u([l,c])}}function u(l){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,i&&(a=l[0]&2?i.return:l[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,l[1])).done)return a;switch(i=0,a&&(l=[l[0]&2,a.value]),l[0]){case 0:case 1:a=l;break;case 4:return r.label++,{value:l[1],done:!1};case 5:r.label++,i=l[1],l=[0];continue;case 7:l=r.ops.pop(),r.trys.pop();continue;default:if(a=r.trys,!(a=a.length>0&&a[a.length-1])&&(l[0]===6||l[0]===2)){r=0;continue}if(l[0]===3&&(!a||l[1]>a[0]&&l[1]<a[3])){r.label=l[1];break}if(l[0]===6&&r.label<a[1]){r.label=a[1],a=l;break}if(a&&r.label<a[2]){r.label=a[2],r.ops.push(l);break}a[2]&&r.ops.pop(),r.trys.pop();continue}l=t.call(e,r)}catch(c){l=[6,c],i=0}finally{n=a=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}},Og=globalThis&&globalThis.__spreadArray||function(e,t){for(var r=0,n=t.length,i=e.length;r<n;r++,i++)e[i]=t[r];return e},Rhe=Object.defineProperty,khe=Object.defineProperties,Ohe=Object.getOwnPropertyDescriptors,QB=Object.getOwnPropertySymbols,Lhe=Object.prototype.hasOwnProperty,Fhe=Object.prototype.propertyIsEnumerable,ZB=function(e,t,r){return t in e?Rhe(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r},Xf=function(e,t){for(var r in t||(t={}))Lhe.call(t,r)&&ZB(e,r,t[r]);if(QB)for(var n=0,i=QB(t);n<i.length;n++){var r=i[n];Fhe.call(t,r)&&ZB(e,r,t[r])}return e},SP=function(e,t){return khe(e,Ohe(t))},Nhe=function(e,t,r){return new Promise(function(n,i){var a=function(u){try{s(r.next(u))}catch(l){i(l)}},o=function(u){try{s(r.throw(u))}catch(l){i(l)}},s=function(u){return u.done?n(u.value):Promise.resolve(u.value).then(a,o)};s((r=r.apply(e,t)).next())})},Bhe=typeof window<"u"&&window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__?window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__:function(){if(arguments.length!==0)return typeof arguments[0]=="object"?WC:WC.apply(null,arguments)};function Uhe(e){if(typeof e!="object"||e===null)return!1;var t=Object.getPrototypeOf(e);if(t===null)return!0;for(var r=t;Object.getPrototypeOf(r)!==null;)r=Object.getPrototypeOf(r);return t===r}var jhe=function(e){vX(t,e);function t(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];var i=e.apply(this,r)||this;return Object.setPrototypeOf(i,t.prototype),i}return Object.defineProperty(t,Symbol.species,{get:function(){return t},enumerable:!1,configurable:!0}),t.prototype.concat=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];return e.prototype.concat.apply(this,r)},t.prototype.prepend=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];return r.length===1&&Array.isArray(r[0])?new(t.bind.apply(t,Og([void 0],r[0].concat(this)))):new(t.bind.apply(t,Og([void 0],r.concat(this))))},t}(Array),zhe=function(e){vX(t,e);function t(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];var i=e.apply(this,r)||this;return Object.setPrototypeOf(i,t.prototype),i}return Object.defineProperty(t,Symbol.species,{get:function(){return t},enumerable:!1,configurable:!0}),t.prototype.concat=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];return e.prototype.concat.apply(this,r)},t.prototype.prepend=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];return r.length===1&&Array.isArray(r[0])?new(t.bind.apply(t,Og([void 0],r[0].concat(this)))):new(t.bind.apply(t,Og([void 0],r.concat(this))))},t}(Array);function PM(e){return qc(e)?cX(e,function(){}):e}function Vhe(e){return typeof e=="boolean"}function Hhe(){return function(t){return Ghe(t)}}function Ghe(e){e===void 0&&(e={});var t=e.thunk,r=t===void 0?!0:t;e.immutableCheck,e.serializableCheck;var n=new jhe;return r&&(Vhe(r)?n.push(AM):n.push(AM.withExtraArgument(r.extraArgument))),n}var qhe=!0;function $he(e){var t=Hhe(),r=e||{},n=r.reducer,i=n===void 0?void 0:n,a=r.middleware,o=a===void 0?t():a,s=r.devTools,u=s===void 0?!0:s,l=r.preloadedState,c=l===void 0?void 0:l,d=r.enhancers,f=d===void 0?void 0:d,p;if(typeof i=="function")p=i;else if(Uhe(i))p=Ihe(i);else throw new Error('"reducer" is a required argument, and must be a function or an object of functions that can be passed to combineReducers');var v=o;typeof v=="function"&&(v=v(t));var h=Mhe.apply(void 0,v),m=WC;u&&(m=Bhe(Xf({trace:!qhe},typeof u=="object"&&u)));var g=new zhe(h),y=g;Array.isArray(f)?y=Og([h],f):typeof f=="function"&&(y=f(g));var b=m.apply(void 0,y);return fX(p,c,b)}function Yf(e,t){function r(){for(var n=[],i=0;i<arguments.length;i++)n[i]=arguments[i];if(t){var a=t.apply(void 0,n);if(!a)throw new Error("prepareAction did not return an object");return Xf(Xf({type:e,payload:a.payload},"meta"in a&&{meta:a.meta}),"error"in a&&{error:a.error})}return{type:e,payload:n[0]}}return r.toString=function(){return""+e},r.type=e,r.match=function(n){return n.type===e},r}function mX(e){var t={},r=[],n,i={addCase:function(a,o){var s=typeof a=="string"?a:a.type;if(s in t)throw new Error("addCase cannot be called with two reducers for the same action type");return t[s]=o,i},addMatcher:function(a,o){return r.push({matcher:a,reducer:o}),i},addDefaultCase:function(a){return n=a,i}};return e(i),[t,r,n]}function Whe(e){return typeof e=="function"}function Xhe(e,t,r,n){r===void 0&&(r=[]);var i=typeof t=="function"?mX(t):[t,r,n],a=i[0],o=i[1],s=i[2],u;if(Whe(e))u=function(){return PM(e())};else{var l=PM(e);u=function(){return l}}function c(d,f){d===void 0&&(d=u());var p=Og([a[f.type]],o.filter(function(v){var h=v.matcher;return h(f)}).map(function(v){var h=v.reducer;return h}));return p.filter(function(v){return!!v}).length===0&&(p=[s]),p.reduce(function(v,h){if(h)if(ap(v)){var m=v,g=h(m,f);return g===void 0?v:g}else{if(qc(v))return cX(v,function(y){return h(y,f)});var g=h(v,f);if(g===void 0){if(v===null)return v;throw Error("A case reducer on a non-draftable value must not return undefined")}return g}return v},d)}return c.getInitialState=u,c}function Yhe(e,t){return e+"/"+t}function Khe(e){var t=e.name;if(!t)throw new Error("`name` is a required option for createSlice");typeof process<"u";var r=typeof e.initialState=="function"?e.initialState:PM(e.initialState),n=e.reducers||{},i=Object.keys(n),a={},o={},s={};i.forEach(function(c){var d=n[c],f=Yhe(t,c),p,v;"reducer"in d?(p=d.reducer,v=d.prepare):p=d,a[c]=p,o[f]=p,s[c]=v?Yf(f,v):Yf(f)});function u(){var c=typeof e.extraReducers=="function"?mX(e.extraReducers):[e.extraReducers],d=c[0],f=d===void 0?{}:d,p=c[1],v=p===void 0?[]:p,h=c[2],m=h===void 0?void 0:h,g=Xf(Xf({},f),o);return Xhe(r,function(y){for(var b in g)y.addCase(b,g[b]);for(var S=0,x=v;S<x.length;S++){var C=x[S];y.addMatcher(C.matcher,C.reducer)}m&&y.addDefaultCase(m)})}var l;return{name:t,reducer:function(c,d){return l||(l=u()),l(c,d)},actions:s,caseReducers:a,getInitialState:function(){return l||(l=u()),l.getInitialState()}}}var Qhe="ModuleSymbhasOwnPr-0123456789ABCDEFGHNRVfgctiUvz_KqYTJkLxpZXIjQW",Zhe=function(e){e===void 0&&(e=21);for(var t="",r=e;r--;)t+=Qhe[Math.random()*64|0];return t},Jhe=["name","message","stack","code"],CP=function(){function e(t,r){this.payload=t,this.meta=r}return e}(),JB=function(){function e(t,r){this.payload=t,this.meta=r}return e}(),eve=function(e){if(typeof e=="object"&&e!==null){for(var t={},r=0,n=Jhe;r<n.length;r++){var i=n[r];typeof e[i]=="string"&&(t[i]=e[i])}return t}return{message:String(e)}};(function(){function e(t,r,n){var i=Yf(t+"/fulfilled",function(l,c,d,f){return{payload:l,meta:SP(Xf({},f||{}),{arg:d,requestId:c,requestStatus:"fulfilled"})}}),a=Yf(t+"/pending",function(l,c,d){return{payload:void 0,meta:SP(Xf({},d||{}),{arg:c,requestId:l,requestStatus:"pending"})}}),o=Yf(t+"/rejected",function(l,c,d,f,p){return{payload:f,error:(n&&n.serializeError||eve)(l||"Rejected"),meta:SP(Xf({},p||{}),{arg:d,requestId:c,rejectedWithValue:!!f,requestStatus:"rejected",aborted:(l==null?void 0:l.name)==="AbortError",condition:(l==null?void 0:l.name)==="ConditionError"})}}),s=typeof AbortController<"u"?AbortController:function(){function l(){this.signal={aborted:!1,addEventListener:function(){},dispatchEvent:function(){return!1},onabort:function(){},removeEventListener:function(){},reason:void 0,throwIfAborted:function(){}}}return l.prototype.abort=function(){},l}();function u(l){return function(c,d,f){var p=n!=null&&n.idGenerator?n.idGenerator(l):Zhe(),v=new s,h;function m(y){h=y,v.abort()}var g=function(){return Nhe(this,null,function(){var y,b,S,x,C,w,A;return Dhe(this,function(M){switch(M.label){case 0:return M.trys.push([0,4,,5]),x=(y=n==null?void 0:n.condition)==null?void 0:y.call(n,l,{getState:d,extra:f}),rve(x)?[4,x]:[3,2];case 1:x=M.sent(),M.label=2;case 2:if(x===!1||v.signal.aborted)throw{name:"ConditionError",message:"Aborted due to condition callback returning false."};return C=new Promise(function(D,k){return v.signal.addEventListener("abort",function(){return k({name:"AbortError",message:h||"Aborted"})})}),c(a(p,l,(b=n==null?void 0:n.getPendingMeta)==null?void 0:b.call(n,{requestId:p,arg:l},{getState:d,extra:f}))),[4,Promise.race([C,Promise.resolve(r(l,{dispatch:c,getState:d,extra:f,requestId:p,signal:v.signal,abort:m,rejectWithValue:function(D,k){return new CP(D,k)},fulfillWithValue:function(D,k){return new JB(D,k)}})).then(function(D){if(D instanceof CP)throw D;return D instanceof JB?i(D.payload,p,l,D.meta):i(D,p,l)})])];case 3:return S=M.sent(),[3,5];case 4:return w=M.sent(),S=w instanceof CP?o(null,p,l,w.payload,w.meta):o(w,p,l),[3,5];case 5:return A=n&&!n.dispatchConditionRejection&&o.match(S)&&S.meta.condition,A||c(S),[2,S]}})})}();return Object.assign(g,{abort:m,requestId:p,arg:l,unwrap:function(){return g.then(tve)}})}}return Object.assign(u,{pending:a,rejected:o,fulfilled:i,typePrefix:t})}return e.withTypes=function(){return e},e})();function tve(e){if(e.meta&&e.meta.rejectedWithValue)throw e.payload;if(e.error)throw e.error;return e.payload}function rve(e){return e!==null&&typeof e=="object"&&typeof e.then=="function"}var nO="listenerMiddleware";Yf(nO+"/add");Yf(nO+"/removeAll");Yf(nO+"/remove");var e8;typeof queueMicrotask=="function"&&queueMicrotask.bind(typeof window<"u"?window:typeof global<"u"?global:globalThis);She();const nve={searchString:"",searchFilters:{geneName:"",organism:[],sequenceLengthMin:"",sequenceLengthMax:"",annotationScore:"",proteinWith:[]},searchResults:{searchString:"",nextLink:"",totalResults:-1,items:[]},searchFacets:{organisms:[],proteinsWith:[]},proteinCache:{}},gX=Khe({name:"items",initialState:nve,reducers:{fetchItems:(e,t)=>(e.searchResults=t.payload,e),fetchFacets:(e,t)=>(e.searchFacets=t.payload,e),appendItems:(e,t)=>(e.searchResults.nextLink=t.payload.nextLink,e.searchResults.items.push(...t.payload.items),e),setSearchFilters:(e,t)=>(e.searchFilters=t.payload,e),fetchProtein:(e,t)=>(e.proteinCache={...e.proteinCache,[t.payload.id]:t.payload},e),fetchProteinPublications:(e,t)=>(t.payload.proteinId in e.proteinCache?e.proteinCache[t.payload.proteinId].publications=t.payload.publications:console.error("proteinId does not exist in cache - this is not expected to happen: "+t.payload.proteinId),e)}}),{fetchItems:ive,fetchFacets:ave,appendItems:ove,setSearchFilters:sve,fetchProtein:uve,fetchProteinPublications:lve}=gX.actions,cve=gX.reducer;var yX={exports:{}},bX={};/**
 * @license React
 * use-sync-external-store-shim.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Lg=_e;function dve(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var fve=typeof Object.is=="function"?Object.is:dve,pve=Lg.useState,hve=Lg.useEffect,vve=Lg.useLayoutEffect,mve=Lg.useDebugValue;function gve(e,t){var r=t(),n=pve({inst:{value:r,getSnapshot:t}}),i=n[0].inst,a=n[1];return vve(function(){i.value=r,i.getSnapshot=t,_P(i)&&a({inst:i})},[e,r,t]),hve(function(){return _P(i)&&a({inst:i}),e(function(){_P(i)&&a({inst:i})})},[e]),mve(r),r}function _P(e){var t=e.getSnapshot;e=e.value;try{var r=t();return!fve(e,r)}catch{return!0}}function yve(e,t){return t()}var bve=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?yve:gve;bX.useSyncExternalStore=Lg.useSyncExternalStore!==void 0?Lg.useSyncExternalStore:bve;yX.exports=bX;var xve=yX.exports,xX={exports:{}},SX={};/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var p3=_e,Sve=xve;function Cve(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var _ve=typeof Object.is=="function"?Object.is:Cve,wve=Sve.useSyncExternalStore,Eve=p3.useRef,Ave=p3.useEffect,Pve=p3.useMemo,Tve=p3.useDebugValue;SX.useSyncExternalStoreWithSelector=function(e,t,r,n,i){var a=Eve(null);if(a.current===null){var o={hasValue:!1,value:null};a.current=o}else o=a.current;a=Pve(function(){function u(p){if(!l){if(l=!0,c=p,p=n(p),i!==void 0&&o.hasValue){var v=o.value;if(i(v,p))return d=v}return d=p}if(v=d,_ve(c,p))return v;var h=n(p);return i!==void 0&&i(v,h)?v:(c=p,d=h)}var l=!1,c,d,f=r===void 0?null:r;return[function(){return u(t())},f===null?void 0:function(){return u(f())}]},[t,r,n,i]);var s=wve(e,a[0],a[1]);return Ave(function(){o.hasValue=!0,o.value=s},[s]),Tve(s),s};xX.exports=SX;var Ive=xX.exports;function Mve(e){e()}let CX=Mve;const Dve=e=>CX=e,Rve=()=>CX,op=_e.createContext(null);function _X(){return _e.useContext(op)}const kve=()=>{throw new Error("uSES not initialized!")};let wX=kve;const Ove=e=>{wX=e},Lve=(e,t)=>e===t;function Fve(e=op){const t=e===op?_X:()=>_e.useContext(e);return function(n,i=Lve){const{store:a,subscription:o,getServerState:s}=t(),u=wX(o.addNestedSub,a.getState,s||a.getState,n,i);return _e.useDebugValue(u),u}}const rv=Fve();function pr(){return pr=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},pr.apply(this,arguments)}function Nve(e,t){if(e==null)return{};var r={},n=Object.keys(e),i,a;for(a=0;a<n.length;a++)i=n[a],!(t.indexOf(i)>=0)&&(r[i]=e[i]);return r}var EX={exports:{}},An={};/** @license React v16.13.1
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ca=typeof Symbol=="function"&&Symbol.for,iO=ca?Symbol.for("react.element"):60103,aO=ca?Symbol.for("react.portal"):60106,h3=ca?Symbol.for("react.fragment"):60107,v3=ca?Symbol.for("react.strict_mode"):60108,m3=ca?Symbol.for("react.profiler"):60114,g3=ca?Symbol.for("react.provider"):60109,y3=ca?Symbol.for("react.context"):60110,oO=ca?Symbol.for("react.async_mode"):60111,b3=ca?Symbol.for("react.concurrent_mode"):60111,x3=ca?Symbol.for("react.forward_ref"):60112,S3=ca?Symbol.for("react.suspense"):60113,Bve=ca?Symbol.for("react.suspense_list"):60120,C3=ca?Symbol.for("react.memo"):60115,_3=ca?Symbol.for("react.lazy"):60116,Uve=ca?Symbol.for("react.block"):60121,jve=ca?Symbol.for("react.fundamental"):60117,zve=ca?Symbol.for("react.responder"):60118,Vve=ca?Symbol.for("react.scope"):60119;function fs(e){if(typeof e=="object"&&e!==null){var t=e.$$typeof;switch(t){case iO:switch(e=e.type,e){case oO:case b3:case h3:case m3:case v3:case S3:return e;default:switch(e=e&&e.$$typeof,e){case y3:case x3:case _3:case C3:case g3:return e;default:return t}}case aO:return t}}}function AX(e){return fs(e)===b3}An.AsyncMode=oO;An.ConcurrentMode=b3;An.ContextConsumer=y3;An.ContextProvider=g3;An.Element=iO;An.ForwardRef=x3;An.Fragment=h3;An.Lazy=_3;An.Memo=C3;An.Portal=aO;An.Profiler=m3;An.StrictMode=v3;An.Suspense=S3;An.isAsyncMode=function(e){return AX(e)||fs(e)===oO};An.isConcurrentMode=AX;An.isContextConsumer=function(e){return fs(e)===y3};An.isContextProvider=function(e){return fs(e)===g3};An.isElement=function(e){return typeof e=="object"&&e!==null&&e.$$typeof===iO};An.isForwardRef=function(e){return fs(e)===x3};An.isFragment=function(e){return fs(e)===h3};An.isLazy=function(e){return fs(e)===_3};An.isMemo=function(e){return fs(e)===C3};An.isPortal=function(e){return fs(e)===aO};An.isProfiler=function(e){return fs(e)===m3};An.isStrictMode=function(e){return fs(e)===v3};An.isSuspense=function(e){return fs(e)===S3};An.isValidElementType=function(e){return typeof e=="string"||typeof e=="function"||e===h3||e===b3||e===m3||e===v3||e===S3||e===Bve||typeof e=="object"&&e!==null&&(e.$$typeof===_3||e.$$typeof===C3||e.$$typeof===g3||e.$$typeof===y3||e.$$typeof===x3||e.$$typeof===jve||e.$$typeof===zve||e.$$typeof===Vve||e.$$typeof===Uve)};An.typeOf=fs;EX.exports=An;var Hve=EX.exports,PX=Hve,Gve={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},qve={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},TX={};TX[PX.ForwardRef]=Gve;TX[PX.Memo]=qve;var Mn={};/**
 * @license React
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var sO=Symbol.for("react.element"),uO=Symbol.for("react.portal"),w3=Symbol.for("react.fragment"),E3=Symbol.for("react.strict_mode"),A3=Symbol.for("react.profiler"),P3=Symbol.for("react.provider"),T3=Symbol.for("react.context"),$ve=Symbol.for("react.server_context"),I3=Symbol.for("react.forward_ref"),M3=Symbol.for("react.suspense"),D3=Symbol.for("react.suspense_list"),R3=Symbol.for("react.memo"),k3=Symbol.for("react.lazy"),Wve=Symbol.for("react.offscreen"),IX;IX=Symbol.for("react.module.reference");function Zs(e){if(typeof e=="object"&&e!==null){var t=e.$$typeof;switch(t){case sO:switch(e=e.type,e){case w3:case A3:case E3:case M3:case D3:return e;default:switch(e=e&&e.$$typeof,e){case $ve:case T3:case I3:case k3:case R3:case P3:return e;default:return t}}case uO:return t}}}Mn.ContextConsumer=T3;Mn.ContextProvider=P3;Mn.Element=sO;Mn.ForwardRef=I3;Mn.Fragment=w3;Mn.Lazy=k3;Mn.Memo=R3;Mn.Portal=uO;Mn.Profiler=A3;Mn.StrictMode=E3;Mn.Suspense=M3;Mn.SuspenseList=D3;Mn.isAsyncMode=function(){return!1};Mn.isConcurrentMode=function(){return!1};Mn.isContextConsumer=function(e){return Zs(e)===T3};Mn.isContextProvider=function(e){return Zs(e)===P3};Mn.isElement=function(e){return typeof e=="object"&&e!==null&&e.$$typeof===sO};Mn.isForwardRef=function(e){return Zs(e)===I3};Mn.isFragment=function(e){return Zs(e)===w3};Mn.isLazy=function(e){return Zs(e)===k3};Mn.isMemo=function(e){return Zs(e)===R3};Mn.isPortal=function(e){return Zs(e)===uO};Mn.isProfiler=function(e){return Zs(e)===A3};Mn.isStrictMode=function(e){return Zs(e)===E3};Mn.isSuspense=function(e){return Zs(e)===M3};Mn.isSuspenseList=function(e){return Zs(e)===D3};Mn.isValidElementType=function(e){return typeof e=="string"||typeof e=="function"||e===w3||e===A3||e===E3||e===M3||e===D3||e===Wve||typeof e=="object"&&e!==null&&(e.$$typeof===k3||e.$$typeof===R3||e.$$typeof===P3||e.$$typeof===T3||e.$$typeof===I3||e.$$typeof===IX||e.getModuleId!==void 0)};Mn.typeOf=Zs;function Xve(){const e=Rve();let t=null,r=null;return{clear(){t=null,r=null},notify(){e(()=>{let n=t;for(;n;)n.callback(),n=n.next})},get(){let n=[],i=t;for(;i;)n.push(i),i=i.next;return n},subscribe(n){let i=!0,a=r={callback:n,next:null,prev:r};return a.prev?a.prev.next=a:t=a,function(){!i||t===null||(i=!1,a.next?a.next.prev=a.prev:r=a.prev,a.prev?a.prev.next=a.next:t=a.next)}}}}const t8={notify(){},get:()=>[]};function Yve(e,t){let r,n=t8;function i(d){return u(),n.subscribe(d)}function a(){n.notify()}function o(){c.onStateChange&&c.onStateChange()}function s(){return!!r}function u(){r||(r=t?t.addNestedSub(o):e.subscribe(o),n=Xve())}function l(){r&&(r(),r=void 0,n.clear(),n=t8)}const c={addNestedSub:i,notifyNestedSubs:a,handleChangeWrapper:o,isSubscribed:s,trySubscribe:u,tryUnsubscribe:l,getListeners:()=>n};return c}const Kve=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",Qve=Kve?_e.useLayoutEffect:_e.useEffect;function Zve({store:e,context:t,children:r,serverState:n}){const i=_e.useMemo(()=>{const s=Yve(e);return{store:e,subscription:s,getServerState:n?()=>n:void 0}},[e,n]),a=_e.useMemo(()=>e.getState(),[e]);Qve(()=>{const{subscription:s}=i;return s.onStateChange=s.notifyNestedSubs,s.trySubscribe(),a!==e.getState()&&s.notifyNestedSubs(),()=>{s.tryUnsubscribe(),s.onStateChange=void 0}},[i,a]);const o=t||op;return Fs.createElement(o.Provider,{value:i},r)}function MX(e=op){const t=e===op?_X:()=>_e.useContext(e);return function(){const{store:n}=t();return n}}const Jve=MX();function eme(e=op){const t=e===op?Jve:MX(e);return function(){return t().dispatch}}const tme=eme();Ove(Ive.useSyncExternalStoreWithSelector);Dve(o3.unstable_batchedUpdates);var Gn={};function rme(e){return!!(e&&typeof e.then=="function")}function XC(e){return e||(e=0),new Promise(function(t){return setTimeout(t,e)})}function nme(e,t){return Math.floor(Math.random()*(t-e+1)+e)}function O3(){return Math.random().toString(36).substring(2)}var r8=0,wP=0;function L3(){var e=new Date().getTime();return e===r8?(wP++,e*1e3+wP):(r8=e,wP=0,e*1e3)}var Xb=Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]",ime=L3,ame="native";function ome(e){var t={messagesCallback:null,bc:new BroadcastChannel(e),subFns:[]};return t.bc.onmessage=function(r){t.messagesCallback&&t.messagesCallback(r.data)},t}function sme(e){e.bc.close(),e.subFns=[]}function ume(e,t){try{return e.bc.postMessage(t,!1),Promise.resolve()}catch(r){return Promise.reject(r)}}function lme(e,t){e.messagesCallback=t}function cme(){if(Xb&&typeof window>"u")return!1;if(typeof BroadcastChannel=="function"){if(BroadcastChannel._pubkey)throw new Error("BroadcastChannel: Do not overwrite window.BroadcastChannel with this module, this is not a polyfill");return!0}else return!1}function dme(){return 150}const fme={create:ome,close:sme,onMessage:lme,postMessage:ume,canBeUsed:cme,type:ame,averageResponseTime:dme,microSeconds:ime};var DX=function(){function e(t){this.ttl=t,this.set=new Set,this.timeMap=new Map}return e.prototype.has=function(t){return this.set.has(t)},e.prototype.add=function(t){var r=this;this.timeMap.set(t,RX()),this.set.add(t),setTimeout(function(){pme(r)},0)},e.prototype.clear=function(){this.set.clear(),this.timeMap.clear()},e}();function pme(e){for(var t=RX()-e.ttl,r=e.set[Symbol.iterator]();;){var n=r.next().value;if(!n)return;var i=e.timeMap.get(n);if(i<t)e.timeMap.delete(n),e.set.delete(n);else return}}function RX(){return new Date().getTime()}function F3(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=JSON.parse(JSON.stringify(e));return typeof t.webWorkerSupport>"u"&&(t.webWorkerSupport=!0),t.idb||(t.idb={}),t.idb.ttl||(t.idb.ttl=1e3*45),t.idb.fallbackInterval||(t.idb.fallbackInterval=150),e.idb&&typeof e.idb.onclose=="function"&&(t.idb.onclose=e.idb.onclose),t.localstorage||(t.localstorage={}),t.localstorage.removeTimeout||(t.localstorage.removeTimeout=1e3*60),e.methods&&(t.methods=e.methods),t.node||(t.node={}),t.node.ttl||(t.node.ttl=1e3*60*2),typeof t.node.useFastPath>"u"&&(t.node.useFastPath=!0),t}var hme=L3,vme="pubkey.broadcast-channel-0-",$c="messages",mme="idb";function kX(){if(typeof indexedDB<"u")return indexedDB;if(typeof window<"u"){if(typeof window.mozIndexedDB<"u")return window.mozIndexedDB;if(typeof window.webkitIndexedDB<"u")return window.webkitIndexedDB;if(typeof window.msIndexedDB<"u")return window.msIndexedDB}return!1}function gme(e){var t=kX(),r=vme+e,n=t.open(r,1);n.onupgradeneeded=function(a){var o=a.target.result;o.createObjectStore($c,{keyPath:"id",autoIncrement:!0})};var i=new Promise(function(a,o){n.onerror=function(s){return o(s)},n.onsuccess=function(){a(n.result)}});return i}function yme(e,t,r){var n=new Date().getTime(),i={uuid:t,time:n,data:r},a=e.transaction([$c],"readwrite");return new Promise(function(o,s){a.oncomplete=function(){return o()},a.onerror=function(l){return s(l)};var u=a.objectStore($c);u.add(i)})}function bme(e,t){var r=e.transaction($c).objectStore($c),n=[];function i(){try{var a=IDBKeyRange.bound(t+1,1/0);return r.openCursor(a)}catch{return r.openCursor()}}return new Promise(function(a){i().onsuccess=function(o){var s=o.target.result;s?s.value.id<t+1?s.continue(t+1):(n.push(s.value),s.continue()):a(n)}})}function xme(e,t){var r=e.transaction([$c],"readwrite").objectStore($c).delete(t);return new Promise(function(n){r.onsuccess=function(){return n()}})}function Sme(e,t){var r=new Date().getTime()-t,n=e.transaction($c).objectStore($c),i=[];return new Promise(function(a){n.openCursor().onsuccess=function(o){var s=o.target.result;if(s){var u=s.value;if(u.time<r)i.push(u),s.continue();else{a(i);return}}else a(i)}})}function Cme(e,t){return Sme(e,t).then(function(r){return Promise.all(r.map(function(n){return xme(e,n.id)}))})}function _me(e,t){return t=F3(t),gme(e).then(function(r){var n={closed:!1,lastCursorId:0,channelName:e,options:t,uuid:O3(),eMIs:new DX(t.idb.ttl*2),writeBlockPromise:Promise.resolve(),messagesCallback:null,readQueuePromises:[],db:r};return r.onclose=function(){n.closed=!0,t.idb.onclose&&t.idb.onclose()},OX(n),n})}function OX(e){e.closed||LX(e).then(function(){return XC(e.options.idb.fallbackInterval)}).then(function(){return OX(e)})}function wme(e,t){return!(e.uuid===t.uuid||t.eMIs.has(e.id)||e.data.time<t.messagesCallbackTime)}function LX(e){return e.closed||!e.messagesCallback?Promise.resolve():bme(e.db,e.lastCursorId).then(function(t){var r=t.filter(function(n){return!!n}).map(function(n){return n.id>e.lastCursorId&&(e.lastCursorId=n.id),n}).filter(function(n){return wme(n,e)}).sort(function(n,i){return n.time-i.time});return r.forEach(function(n){e.messagesCallback&&(e.eMIs.add(n.id),e.messagesCallback(n.data))}),Promise.resolve()})}function Eme(e){e.closed=!0,e.db.close()}function Ame(e,t){return e.writeBlockPromise=e.writeBlockPromise.then(function(){return yme(e.db,e.uuid,t)}).then(function(){nme(0,10)===0&&Cme(e.db,e.options.idb.ttl)}),e.writeBlockPromise}function Pme(e,t,r){e.messagesCallbackTime=r,e.messagesCallback=t,LX(e)}function Tme(){if(Xb)return!1;var e=kX();return!!e}function Ime(e){return e.idb.fallbackInterval*2}const Mme={create:_me,close:Eme,onMessage:Pme,postMessage:Ame,canBeUsed:Tme,type:mme,averageResponseTime:Ime,microSeconds:hme};var Dme=L3,Rme="pubkey.broadcastChannel-",kme="localstorage";function FX(){var e;if(typeof window>"u")return null;try{e=window.localStorage,e=window["ie8-eventlistener/storage"]||window.localStorage}catch{}return e}function NX(e){return Rme+e}function Ome(e,t){return new Promise(function(r){XC().then(function(){var n=NX(e.channelName),i={token:O3(),time:new Date().getTime(),data:t,uuid:e.uuid},a=JSON.stringify(i);FX().setItem(n,a);var o=document.createEvent("Event");o.initEvent("storage",!0,!0),o.key=n,o.newValue=a,window.dispatchEvent(o),r()})})}function Lme(e,t){var r=NX(e),n=function(a){a.key===r&&t(JSON.parse(a.newValue))};return window.addEventListener("storage",n),n}function Fme(e){window.removeEventListener("storage",e)}function Nme(e,t){if(t=F3(t),!BX())throw new Error("BroadcastChannel: localstorage cannot be used");var r=O3(),n=new DX(t.localstorage.removeTimeout),i={channelName:e,uuid:r,eMIs:n};return i.listener=Lme(e,function(a){i.messagesCallback&&a.uuid!==r&&(!a.token||n.has(a.token)||a.data.time&&a.data.time<i.messagesCallbackTime||(n.add(a.token),i.messagesCallback(a.data)))}),i}function Bme(e){Fme(e.listener)}function Ume(e,t,r){e.messagesCallbackTime=r,e.messagesCallback=t}function BX(){if(Xb)return!1;var e=FX();if(!e)return!1;try{var t="__broadcastchannel_check";e.setItem(t,"works"),e.removeItem(t)}catch{return!1}return!0}function jme(){var e=120,t=navigator.userAgent.toLowerCase();return t.includes("safari")&&!t.includes("chrome")?e*2:e}const zme={create:Nme,close:Bme,onMessage:Ume,postMessage:Ome,canBeUsed:BX,type:kme,averageResponseTime:jme,microSeconds:Dme};var Vme=L3,Hme="simulate",lO=new Set;function Gme(e){var t={name:e,messagesCallback:null};return lO.add(t),t}function qme(e){lO.delete(e)}function $me(e,t){return new Promise(function(r){return setTimeout(function(){var n=Array.from(lO);n.filter(function(i){return i.name===e.name}).filter(function(i){return i!==e}).filter(function(i){return!!i.messagesCallback}).forEach(function(i){return i.messagesCallback(t)}),r()},5)})}function Wme(e,t){e.messagesCallback=t}function Xme(){return!0}function Yme(){return 5}const Kme={create:Gme,close:qme,onMessage:Wme,postMessage:$me,canBeUsed:Xme,type:Hme,averageResponseTime:Yme,microSeconds:Vme};var TM=[fme,Mme,zme];if(Xb){var n8=require("../../src/methods/node.js");typeof n8.canBeUsed=="function"&&TM.push(n8)}function UX(e){var t=[].concat(e.methods,TM).filter(Boolean);if(e.type){if(e.type==="simulate")return Kme;var r=t.find(function(i){return i.type===e.type});if(r)return r;throw new Error("method-type "+e.type+" not found")}!e.webWorkerSupport&&!Xb&&(t=t.filter(function(i){return i.type!=="idb"}));var n=t.find(function(i){return i.canBeUsed()});if(n)return n;throw new Error("No useable methode found:"+JSON.stringify(TM.map(function(i){return i.type})))}var cO=function(t,r){this.name=t,IM&&(r=IM),this.options=F3(r),this.method=UX(this.options),this._iL=!1,this._onML=null,this._addEL={message:[],internal:[]},this._uMP=new Set,this._befC=[],this._prepP=null,Jme(this)};cO._pubkey=!0;function Qme(e){e=F3(e);var t=UX(e);return t.type==="node"?t.clearNodeFolder().then(function(){return!0}):Promise.resolve(!1)}var IM;function Zme(e){IM=e}cO.prototype={postMessage:function(t){if(this.closed)throw new Error("BroadcastChannel.postMessage(): Cannot post message after channel has closed");return i8(this,"message",t)},postInternal:function(t){return i8(this,"internal",t)},set onmessage(e){var t=this.method.microSeconds(),r={time:t,fn:e};o8(this,"message",this._onML),e&&typeof e=="function"?(this._onML=r,a8(this,"message",r)):this._onML=null},addEventListener:function(t,r){var n=this.method.microSeconds(),i={time:n,fn:r};a8(this,t,i)},removeEventListener:function(t,r){var n=this._addEL[t].find(function(i){return i.fn===r});o8(this,t,n)},close:function(){var t=this;if(!this.closed){this.closed=!0;var r=this._prepP?this._prepP:Promise.resolve();return this._onML=null,this._addEL.message=[],r.then(function(){return Promise.all(Array.from(t._uMP))}).then(function(){return Promise.all(t._befC.map(function(n){return n()}))}).then(function(){return t.method.close(t._state)})}},get type(){return this.method.type},get isClosed(){return this.closed}};function i8(e,t,r){var n=e.method.microSeconds(),i={time:n,type:t,data:r},a=e._prepP?e._prepP:Promise.resolve();return a.then(function(){var o=e.method.postMessage(e._state,i);return e._uMP.add(o),o.catch().then(function(){return e._uMP.delete(o)}),o})}function Jme(e){var t=e.method.create(e.name,e.options);rme(t)?(e._prepP=t,t.then(function(r){e._state=r})):e._state=t}function jX(e){return e._addEL.message.length>0||e._addEL.internal.length>0}function a8(e,t,r){e._addEL[t].push(r),ege(e)}function o8(e,t,r){e._addEL[t]=e._addEL[t].filter(function(n){return n!==r}),tge(e)}function ege(e){if(!e._iL&&jX(e)){var t=function(i){e._addEL[i.type].forEach(function(a){i.time>=a.time&&a.fn(i.data)})},r=e.method.microSeconds();e._prepP?e._prepP.then(function(){e._iL=!0,e.method.onMessage(e._state,t,r)}):(e._iL=!0,e.method.onMessage(e._state,t,r))}}function tge(e){if(e._iL&&!jX(e)){e._iL=!1;var t=e.method.microSeconds();e.method.onMessage(e._state,null,t)}}const rge=Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]";function nge(e){if(!(typeof WorkerGlobalScope=="function"&&self instanceof WorkerGlobalScope)){if(typeof window.addEventListener!="function")return;window.addEventListener("beforeunload",function(){e()},!0),window.addEventListener("unload",function(){e()},!0)}}const ige={add:nge},age={};var oge=rge?age:ige,Oh=new Set,s8=!1;function sge(){s8||(s8=!0,oge.add(zX))}function uge(e){if(sge(),typeof e!="function")throw new Error("Listener is no function");Oh.add(e);var t={remove:function(){return Oh.delete(e)},run:function(){return Oh.delete(e),e()}};return t}function zX(){var e=[];return Oh.forEach(function(t){e.push(t()),Oh.delete(t)}),Promise.all(e)}function lge(){Oh.clear()}function cge(){return Oh.size}const dge={add:uge,runAll:zX,removeAll:lge,getSize:cge};var VX=function(t,r){this._channel=t,this._options=r,this.isLeader=!1,this.isDead=!1,this.token=O3(),this._isApl=!1,this._reApply=!1,this._unl=[],this._lstns=[],this._invs=[],this._dpL=function(){},this._dpLC=!1};VX.prototype={applyOnce:function(){var t=this;if(this.isLeader||this.isDead)return Promise.resolve(!1);if(this._isApl)return this._reApply=!0,Promise.resolve(!1);this._isApl=!0;var r=!1,n=function(o){o.context==="leader"&&o.token!=t.token&&(o.action==="apply"&&o.token>t.token&&(r=!0),o.action==="tell"&&(r=!0))};this._channel.addEventListener("internal",n);var i=Sh(this,"apply").then(function(){return XC(t._options.responseTime)}).then(function(){return r?Promise.reject(new Error):Sh(t,"apply")}).then(function(){return XC(t._options.responseTime)}).then(function(){return r?Promise.reject(new Error):Sh(t)}).then(function(){return HX(t)}).then(function(){return!0}).catch(function(){return!1}).then(function(a){return t._channel.removeEventListener("internal",n),t._isApl=!1,!a&&t._reApply?(t._reApply=!1,t.applyOnce()):a});return i},awaitLeadership:function(){return this._aLP||(this._aLP=fge(this)),this._aLP},set onduplicate(e){this._dpL=e},die:function(){var t=this;if(!this.isDead)return this.isDead=!0,this._lstns.forEach(function(r){return t._channel.removeEventListener("internal",r)}),this._invs.forEach(function(r){return clearInterval(r)}),this._unl.forEach(function(r){r.remove()}),Sh(this,"death")}};function fge(e){return e.isLeader?Promise.resolve():new Promise(function(t){var r=!1;function n(){r||(r=!0,clearInterval(i),e._channel.removeEventListener("internal",a),t(!0))}e.applyOnce().then(function(){e.isLeader&&n()});var i=setInterval(function(){e.applyOnce().then(function(){e.isLeader&&n()})},e._options.fallbackInterval);e._invs.push(i);var a=function(s){s.context==="leader"&&s.action==="death"&&e.applyOnce().then(function(){e.isLeader&&n()})};e._channel.addEventListener("internal",a),e._lstns.push(a)})}function Sh(e,t){var r={context:"leader",action:t,token:e.token};return e._channel.postInternal(r)}function HX(e){e.isLeader=!0;var t=dge.add(function(){return e.die()});e._unl.push(t);var r=function(i){i.context==="leader"&&i.action==="apply"&&Sh(e,"tell"),i.context==="leader"&&i.action==="tell"&&!e._dpLC&&(e._dpLC=!0,e._dpL(),Sh(e,"tell"))};return e._channel.addEventListener("internal",r),e._lstns.push(r),Sh(e,"tell")}function pge(e,t){return e||(e={}),e=JSON.parse(JSON.stringify(e)),e.fallbackInterval||(e.fallbackInterval=3e3),e.responseTime||(e.responseTime=t.method.averageResponseTime(t.options)),e}function hge(e,t){if(e._leaderElector)throw new Error("BroadcastChannel already has a leader-elector");t=pge(t,e);var r=new VX(e,t);return e._befC.push(function(){return r.die()}),e._leaderElector=r,r}const vge=Object.freeze(Object.defineProperty({__proto__:null,BroadcastChannel:cO,beLeader:HX,clearNodeFolder:Qme,createLeaderElection:hge,enforceOptions:Zme},Symbol.toStringTag,{value:"Module"})),mge=dse(vge);var dO;Object.defineProperty(Gn,"__esModule",{value:!0});var GX=Gn.initMessageListener=Gn.initStateWithPrevTab=Gn.withReduxStateSync=Gn.createReduxStateSync=dO=Gn.createStateSyncMiddleware=Gn.WINDOW_STATE_SYNC_ID=Gn.INIT_MESSAGE_LISTENER=Gn.RECEIVE_INIT_STATE=Gn.SEND_INIT_STATE=Gn.GET_INIT_STATE=void 0;Gn.generateUuidForAction=WX;Gn.isActionAllowed=XX;Gn.isActionSynced=_ge;Gn.MessageListener=YX;var gge=mge,MM=0,fO=Gn.GET_INIT_STATE="&_GET_INIT_STATE",pO=Gn.SEND_INIT_STATE="&_SEND_INIT_STATE",hO=Gn.RECEIVE_INIT_STATE="&_RECEIVE_INIT_STATE",yge=Gn.INIT_MESSAGE_LISTENER="&_INIT_MESSAGE_LISTENER",DM={channel:"redux_state_sync",predicate:null,blacklist:[],whitelist:[],broadcastChannelOption:void 0,prepareState:function(t){return t},receiveState:function(t,r){return r}},bge=function(){return{type:fO}},xge=function(){return{type:pO}},Sge=function(t){return{type:hO,payload:t}},Cge=function(){return{type:yge}};function zd(){return Math.floor((1+Math.random())*65536).toString(16).substring(1)}function qX(){return""+zd()+zd()+"-"+zd()+"-"+zd()+"-"+zd()+"-"+zd()+zd()+zd()}var $X=Gn.WINDOW_STATE_SYNC_ID=qX();function WX(e){var t=e;return t.$uuid=qX(),t.$wuid=$X,t}function XX(e){var t=e.predicate,r=e.blacklist,n=e.whitelist,i=function(){return!0};return t&&typeof t=="function"?i=t:Array.isArray(r)?i=function(o){return r.indexOf(o.type)<0}:Array.isArray(n)&&(i=function(o){return n.indexOf(o.type)>=0}),i}function _ge(e){return!!e.$isSync}function YX(e){var t=e.channel,r=e.dispatch,n=e.allowed,i=!1,a={};this.handleOnMessage=function(o){o.$wuid!==$X&&o.type!==hO&&o.$uuid&&o.$uuid!==MM&&(o.type===fO&&!a[o.$wuid]?(a[o.$wuid]=!0,r(xge())):o.type===pO&&!a[o.$wuid]?i||(i=!0,r(Sge(o.payload))):n(o)&&(MM=o.$uuid,r(Object.assign(o,{$isSync:!0}))))},this.messageChannel=t,this.messageChannel.onmessage=this.handleOnMessage}dO=Gn.createStateSyncMiddleware=function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:DM,r=XX(t),n=new gge.BroadcastChannel(t.channel,t.broadcastChannelOption),i=t.prepareState||DM.prepareState,a=null;return function(o){var s=o.getState,u=o.dispatch;return function(l){return function(c){if(a||(a=new YX({channel:n,dispatch:u,allowed:r})),c&&!c.$uuid){var d=WX(c);MM=d.$uuid;try{if(c.type===pO)return s()&&(d.payload=i(s()),n.postMessage(d)),l(c);(r(d)||c.type===fO)&&n.postMessage(d)}catch{console.error("Your browser doesn't support cross tab communication")}}return l(Object.assign(c,{$isSync:typeof c.$isSync>"u"?!1:c.$isSync}))}}}};var wge=Gn.createReduxStateSync=function(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:DM.receiveState;return function(n,i){var a=n;return i.type===hO&&(a=r(n,i.payload)),t(a,i)}};Gn.withReduxStateSync=wge;Gn.initStateWithPrevTab=function(t){var r=t.dispatch;r(bge())};GX=Gn.initMessageListener=function(t){var r=t.dispatch;r(Cge())};const Ege={},KX=$he({reducer:{appState:cve},middleware:e=>e().concat(AM).concat(dO(Ege))});GX(KX);const N3=tme;function Age(e){var s,u,l,c,d;let t="",r;e.comments&&Array.isArray(e.comments)&&(r=e.comments.find(f=>f.commentType==="SUBCELLULAR LOCATION")),r&&r.subcellularLocations&&Array.isArray(r.subcellularLocations)&&((s=r.subcellularLocations)==null?void 0:s.length)>0&&(t=((l=(u=r.subcellularLocations[0])==null?void 0:u.location)==null?void 0:l.value)??"");let n=[],i=[],a={name:"",synonyms:[]};return e.genes&&Array.isArray(e.genes)&&(n=e.genes[0].synonyms||[],i=n?n.map(f=>f.value):[],a={name:((d=(c=e==null?void 0:e.genes[0])==null?void 0:c.geneName)==null?void 0:d.value)??"",synonyms:i}),{primaryAccession:e.primaryAccession,id:e.uniProtkbId,organism_name:e.organism.scientificName,gene_names:a,cc_subcellular_location:t,length:e.sequence.length}}function Pge(e){var r,n,i,a,o,s,u,l,c,d;return{id:(e==null?void 0:e.primaryAccession)??"",uniProtkbId:(e==null?void 0:e.uniProtkbId)??"",organism:((r=e==null?void 0:e.organism)==null?void 0:r.scientificName)??"",description:((a=(i=(n=e==null?void 0:e.proteinDescription)==null?void 0:n.recommendedName)==null?void 0:i.fullName)==null?void 0:a.value)??"",gene:((o=e==null?void 0:e.genes[0])==null?void 0:o.geneName.value)??"",length:((s=e==null?void 0:e.sequence)==null?void 0:s.length)??"",sequence:((u=e==null?void 0:e.sequence)==null?void 0:u.value)??"",lastUpdated:((l=e==null?void 0:e.entryAudit)==null?void 0:l.lastSequenceUpdateDate)??"",molWeight:((c=e==null?void 0:e.sequence)==null?void 0:c.molWeight)??"",checksum:((d=e==null?void 0:e.sequence)==null?void 0:d.crc64)??"",publications:[]}}const Kf={API_HOST:"https://rest.uniprot.org/uniprotkb/",API_ITEMS_PER_PAGE:25,PUBMED_HOST:"https://pubmed.ncbi.nlm.nih.gov/",PMC_HOST:"https://europepmc.org/article/MED/",DOI_HOST:"https://dx.doi.org/"};function Tge(e){var a,o,s,u,l,c,d,f,p,v;let t;try{e.citation&&e.citation.citationCrossReferences&&(t=((a=e.citation.citationCrossReferences.find(h=>h.database==="PubMed"))==null?void 0:a.id)??"")}catch(h){console.error(h)}let r;try{e.citation&&e.citation.citationCrossReferences&&(r=((o=e.citation.citationCrossReferences.find(h=>h.database==="DOI"))==null?void 0:o.id)??"")}catch(h){console.error(h)}let n;n=e.references.map(h=>{var m;return{id:h.citationId??"",source:((m=h.source)==null?void 0:m.name)??"",categories:h.sourceCategories??"",positions:h.referencePositions??""}});let i;return i={id:((s=e.citation)==null?void 0:s.id)??"",authors:((u=e.citation)==null?void 0:u.authors)??"",title:((l=e.citation)==null?void 0:l.title)??"",journal:((c=e.citation)==null?void 0:c.journal)??"",volume:((d=e.citation)==null?void 0:d.volume)??"",firstPage:((f=e.citation)==null?void 0:f.firstPage)??"",lastPage:((p=e.citation)==null?void 0:p.lastPage)??"",publicationDate:((v=e.citation)==null?void 0:v.publicationDate)??"",references:n,pubMedId:t,doiId:r},i}const Ige=async e=>{var r,n;const t=new URL(`${Kf.API_HOST}search?facets=model_organism,proteins_with,annotation_score&query=(${e})`);try{const i=await fetch(t,{method:"GET"});if(!i.ok)throw new Error(`Error retrieving data from fetchFacetsAPI: ${i.statusText}
Status: ${i.status}
Target URL: ${t}`);const a=await i.json();let o=[];a.facets&&Array.isArray(a.facets)&&(o=(r=a.facets.find(l=>(l==null?void 0:l.name)==="model_organism"))==null?void 0:r.values);let s=[];return a.facets&&Array.isArray(a.facets)&&(s=(n=a.facets.find(l=>(l==null?void 0:l.name)==="proteins_with"))==null?void 0:n.values),{organisms:o,proteinsWith:s}}catch(i){throw i}},Mge=async e=>{const t=new URL(`${Kf.API_HOST}/${e}`);try{const r=await fetch(t,{method:"GET"});if(!r.ok)throw new Error(`Error retrieving data from fetchProteinAPI: ${r.statusText}
Status: ${r.status}
Target URL: ${t}`);const n=await r.json();return Pge(n)}catch(r){throw r}},Dge=async e=>{const t=new URL(`${Kf.API_HOST}/${e}/publications`);try{const r=await fetch(t,{method:"GET"});if(!r.ok)throw new Error(`Error retrieving data from fetchProteinPublicationsAPI: ${r.statusText}
Status: ${r.status}
Target URL: ${t}`);return(await r.json()).results.map(Tge)}catch(r){throw r}},QX=async(e,t)=>{var r,n;try{const i=await fetch(e,{method:"GET"});if(!i.ok)throw new Error(`Error retrieving data from fetchProteinItemsCommonAPI: ${i.statusText}
Status: ${i.status}
Target URL: ${e}`);let a=((r=i==null?void 0:i.headers)==null?void 0:r.get("Link"))??"";a=a.split("; ")[0].replace(/^<|>$/g,"");let o=parseInt(((n=i==null?void 0:i.headers)==null?void 0:n.get("X-Total-Results"))??"");Number.isNaN(o)&&(o=-1);const u=(await i.json()).results.map(Age);return{searchString:t,totalResults:o,nextLink:a,items:u}}catch(i){throw i}},Rge=async(e,t)=>{let r="";if(t.geneName&&(r+=` AND (gene:${t.geneName})`),t.sequenceLengthMin&&t.sequenceLengthMax&&(r+=" AND "+encodeURIComponent(`length:[${t.sequenceLengthMin} TO ${t.sequenceLengthMax}]`).replace(/%20/g,"+")),t.annotationScore&&(r+=` AND annotation_score:${t.annotationScore}`),t.organism&&Array.isArray(t.organism)&&t.organism.length>0){const i=t.organism.map((a,o)=>o>0?` OR organism_id:${a}`:`organism_id:${a}`).join("");r+=` AND (${encodeURIComponent(i)})`}if(t.proteinWith&&Array.isArray(t.proteinWith)&&t.proteinWith.length>0){const i=t.proteinWith.map((a,o)=>o>0?` OR proteins_with:${a}`:`proteins_with:${a}`).join("");r+=` AND (${encodeURIComponent(i)})`}const n=new URL(`${Kf.API_HOST}search?fields=accession,id,gene_names,organism_name,length,cc_subcellular_location&query=(${e}${r})&size=${Kf.API_ITEMS_PER_PAGE}`);return QX(n,e)},kge=async(e,t)=>QX(e,t),Oge=(e,t)=>async r=>{try{const n=await Rge(e,t),i=await Ige(e);r(sve(t)),r(ive(n)),r(ave(i))}catch(n){n instanceof Error?console.error(`Error retrieving data: ${n.message}`):console.error("Unexpected error occurred:",n)}},Lge=(e,t)=>async r=>{try{const n=await kge(e,t);r(ove(n))}catch(n){n instanceof Error?console.error(`Error retrieving data: ${n.message}`):console.error("Unexpected error occurred:",n)}},Fge=e=>async t=>{try{const r=await Mge(e);t(uve(r))}catch(r){r instanceof Error?console.error(`Error retrieving protein data: ${r.message}`):console.error("Unexpected error occurred while obtaining protein data:",r)}},Nge=e=>async t=>{try{const r=await Dge(e);t(lve({proteinId:e,publications:r}))}catch(r){r instanceof Error?console.error(`Error retrieving data: ${r.message}`):console.error("Unexpected error occurred:",r)}},B3=()=>P.jsx("div",{className:"loading-wrapper",children:P.jsx("div",{className:"loading"})}),Bge=()=>{const e=vd(),t=N3(),r=rv(s=>s.appState.searchResults),[n,i]=_e.useState(!1),a=s=>{if(!s)return;const u=`/protein/${s}`;e(u)},o=s=>{if(s.currentTarget.scrollHeight-s.currentTarget.scrollTop<s.currentTarget.clientHeight+100&&!n&&r.items.length<r.totalResults){i(!0);const l=new URL(r.nextLink);t(Lge(l,r.searchString)).finally(()=>{i(!1)})}};return P.jsx("div",{className:"protein-table-wrapper",onScroll:o,children:P.jsxs("table",{className:"protein-table",children:[P.jsx("thead",{className:"protein-table-header",children:P.jsxs("tr",{className:"protein-table-header-row",children:[P.jsx("th",{className:"protein-table-header-column",children:"#"}),P.jsx("th",{className:"protein-table-header-column",children:"Primary Accession"}),P.jsx("th",{className:"protein-table-header-column",children:"ID"}),P.jsx("th",{className:"protein-table-header-column",children:"Organism Name"}),P.jsx("th",{className:"protein-table-header-column",children:"Gene Names"}),P.jsx("th",{className:"protein-table-header-column",children:"Subcellular Location"}),P.jsx("th",{className:"protein-table-header-column",children:"Length"})]})}),P.jsxs("tbody",{children:[r.items.map((s,u)=>P.jsxs("tr",{children:[P.jsx("td",{className:"protein-table-content protein-table-column-generic",children:u+1}),P.jsx("td",{className:"protein-table-content protein-table-column-entry",children:P.jsx("span",{className:"protein-table-entry",onClick:()=>{a(s.primaryAccession)},children:s.primaryAccession})}),P.jsx("td",{className:"protein-table-content protein-table-column-generic",children:s.id}),P.jsx("td",{className:"protein-table-content",children:P.jsx("div",{"data-organism":s.organism_name,children:s.organism_name})}),P.jsxs("td",{className:"protein-table-content protein-table-column-generic",children:[P.jsx("span",{className:"protein-table-gene-main",children:s.gene_names.name}),s.gene_names.synonyms.length>0?", ":"",s.gene_names.synonyms.join(", ")]}),P.jsx("td",{className:"protein-table-content protein-table-column-generic",children:s.cc_subcellular_location}),P.jsx("td",{className:"protein-table-content protein-table-column-generic",children:s.length})]},s.primaryAccession)),n&&P.jsx("tr",{className:"protein-table-content-loading",children:P.jsx("td",{colSpan:7,children:P.jsx(B3,{})})})]})]})})};function Uge(e){if(Array.isArray(e))return e}function jge(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,i,a,o,s=[],u=!0,l=!1;try{if(a=(r=r.call(e)).next,t===0){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=a.call(r)).done)&&(s.push(n.value),s.length!==t);u=!0);}catch(c){l=!0,i=c}finally{try{if(!u&&r.return!=null&&(o=r.return(),Object(o)!==o))return}finally{if(l)throw i}}return s}}function RM(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function ZX(e,t){if(e){if(typeof e=="string")return RM(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return RM(e,t)}}function zge(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Rc(e,t){return Uge(e)||jge(e,t)||ZX(e,t)||zge()}function d0(e,t){if(e==null)return{};var r=Nve(e,t),n,i;if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(i=0;i<a.length;i++)n=a[i],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var Vge=["defaultInputValue","defaultMenuIsOpen","defaultValue","inputValue","menuIsOpen","onChange","onInputChange","onMenuClose","onMenuOpen","value"];function Hge(e){var t=e.defaultInputValue,r=t===void 0?"":t,n=e.defaultMenuIsOpen,i=n===void 0?!1:n,a=e.defaultValue,o=a===void 0?null:a,s=e.inputValue,u=e.menuIsOpen,l=e.onChange,c=e.onInputChange,d=e.onMenuClose,f=e.onMenuOpen,p=e.value,v=d0(e,Vge),h=_e.useState(s!==void 0?s:r),m=Rc(h,2),g=m[0],y=m[1],b=_e.useState(u!==void 0?u:i),S=Rc(b,2),x=S[0],C=S[1],w=_e.useState(p!==void 0?p:o),A=Rc(w,2),M=A[0],D=A[1],k=_e.useCallback(function(G,$){typeof l=="function"&&l(G,$),D(G)},[l]),R=_e.useCallback(function(G,$){var q;typeof c=="function"&&(q=c(G,$)),y(q!==void 0?q:G)},[c]),O=_e.useCallback(function(){typeof f=="function"&&f(),C(!0)},[f]),H=_e.useCallback(function(){typeof d=="function"&&d(),C(!1)},[d]),B=s!==void 0?s:g,j=u!==void 0?u:x,Y=p!==void 0?p:M;return vr(vr({},v),{},{inputValue:B,menuIsOpen:j,onChange:k,onInputChange:R,onMenuClose:H,onMenuOpen:O,value:Y})}function Gge(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function u8(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,dX(n.key),n)}}function qge(e,t,r){return t&&u8(e.prototype,t),r&&u8(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function kM(e,t){return kM=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,i){return n.__proto__=i,n},kM(e,t)}function $ge(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&kM(e,t)}function YC(e){return YC=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},YC(e)}function Wge(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function Xge(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Yge(e,t){if(t&&(tv(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Xge(e)}function Kge(e){var t=Wge();return function(){var n=YC(e),i;if(t){var a=YC(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Yge(this,i)}}function Qge(e){if(Array.isArray(e))return RM(e)}function Zge(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function Jge(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function JX(e){return Qge(e)||Zge(e)||ZX(e)||Jge()}function e0e(e){if(e.sheet)return e.sheet;for(var t=0;t<document.styleSheets.length;t++)if(document.styleSheets[t].ownerNode===e)return document.styleSheets[t]}function t0e(e){var t=document.createElement("style");return t.setAttribute("data-emotion",e.key),e.nonce!==void 0&&t.setAttribute("nonce",e.nonce),t.appendChild(document.createTextNode("")),t.setAttribute("data-s",""),t}var r0e=function(){function e(r){var n=this;this._insertTag=function(i){var a;n.tags.length===0?n.insertionPoint?a=n.insertionPoint.nextSibling:n.prepend?a=n.container.firstChild:a=n.before:a=n.tags[n.tags.length-1].nextSibling,n.container.insertBefore(i,a),n.tags.push(i)},this.isSpeedy=r.speedy===void 0?!0:r.speedy,this.tags=[],this.ctr=0,this.nonce=r.nonce,this.key=r.key,this.container=r.container,this.prepend=r.prepend,this.insertionPoint=r.insertionPoint,this.before=null}var t=e.prototype;return t.hydrate=function(n){n.forEach(this._insertTag)},t.insert=function(n){this.ctr%(this.isSpeedy?65e3:1)===0&&this._insertTag(t0e(this));var i=this.tags[this.tags.length-1];if(this.isSpeedy){var a=e0e(i);try{a.insertRule(n,a.cssRules.length)}catch{}}else i.appendChild(document.createTextNode(n));this.ctr++},t.flush=function(){this.tags.forEach(function(n){return n.parentNode&&n.parentNode.removeChild(n)}),this.tags=[],this.ctr=0},e}(),Ta="-ms-",KC="-moz-",pn="-webkit-",eY="comm",vO="rule",mO="decl",n0e="@import",tY="@keyframes",i0e="@layer",a0e=Math.abs,U3=String.fromCharCode,o0e=Object.assign;function s0e(e,t){return ha(e,0)^45?(((t<<2^ha(e,0))<<2^ha(e,1))<<2^ha(e,2))<<2^ha(e,3):0}function rY(e){return e.trim()}function u0e(e,t){return(e=t.exec(e))?e[0]:e}function hn(e,t,r){return e.replace(t,r)}function OM(e,t){return e.indexOf(t)}function ha(e,t){return e.charCodeAt(t)|0}function rb(e,t,r){return e.slice(t,r)}function pl(e){return e.length}function gO(e){return e.length}function ex(e,t){return t.push(e),e}function l0e(e,t){return e.map(t).join("")}var j3=1,Fg=1,nY=0,Ao=0,Oi=0,f0="";function z3(e,t,r,n,i,a,o){return{value:e,root:t,parent:r,type:n,props:i,children:a,line:j3,column:Fg,length:o,return:""}}function X0(e,t){return o0e(z3("",null,null,"",null,null,0),e,{length:-e.length},t)}function c0e(){return Oi}function d0e(){return Oi=Ao>0?ha(f0,--Ao):0,Fg--,Oi===10&&(Fg=1,j3--),Oi}function Qo(){return Oi=Ao<nY?ha(f0,Ao++):0,Fg++,Oi===10&&(Fg=1,j3++),Oi}function Ml(){return ha(f0,Ao)}function FS(){return Ao}function Yb(e,t){return rb(f0,e,t)}function nb(e){switch(e){case 0:case 9:case 10:case 13:case 32:return 5;case 33:case 43:case 44:case 47:case 62:case 64:case 126:case 59:case 123:case 125:return 4;case 58:return 3;case 34:case 39:case 40:case 91:return 2;case 41:case 93:return 1}return 0}function iY(e){return j3=Fg=1,nY=pl(f0=e),Ao=0,[]}function aY(e){return f0="",e}function NS(e){return rY(Yb(Ao-1,LM(e===91?e+2:e===40?e+1:e)))}function f0e(e){for(;(Oi=Ml())&&Oi<33;)Qo();return nb(e)>2||nb(Oi)>3?"":" "}function p0e(e,t){for(;--t&&Qo()&&!(Oi<48||Oi>102||Oi>57&&Oi<65||Oi>70&&Oi<97););return Yb(e,FS()+(t<6&&Ml()==32&&Qo()==32))}function LM(e){for(;Qo();)switch(Oi){case e:return Ao;case 34:case 39:e!==34&&e!==39&&LM(Oi);break;case 40:e===41&&LM(e);break;case 92:Qo();break}return Ao}function h0e(e,t){for(;Qo()&&e+Oi!==47+10;)if(e+Oi===42+42&&Ml()===47)break;return"/*"+Yb(t,Ao-1)+"*"+U3(e===47?e:Qo())}function v0e(e){for(;!nb(Ml());)Qo();return Yb(e,Ao)}function m0e(e){return aY(BS("",null,null,null,[""],e=iY(e),0,[0],e))}function BS(e,t,r,n,i,a,o,s,u){for(var l=0,c=0,d=o,f=0,p=0,v=0,h=1,m=1,g=1,y=0,b="",S=i,x=a,C=n,w=b;m;)switch(v=y,y=Qo()){case 40:if(v!=108&&ha(w,d-1)==58){OM(w+=hn(NS(y),"&","&\f"),"&\f")!=-1&&(g=-1);break}case 34:case 39:case 91:w+=NS(y);break;case 9:case 10:case 13:case 32:w+=f0e(v);break;case 92:w+=p0e(FS()-1,7);continue;case 47:switch(Ml()){case 42:case 47:ex(g0e(h0e(Qo(),FS()),t,r),u);break;default:w+="/"}break;case 123*h:s[l++]=pl(w)*g;case 125*h:case 59:case 0:switch(y){case 0:case 125:m=0;case 59+c:g==-1&&(w=hn(w,/\f/g,"")),p>0&&pl(w)-d&&ex(p>32?c8(w+";",n,r,d-1):c8(hn(w," ","")+";",n,r,d-2),u);break;case 59:w+=";";default:if(ex(C=l8(w,t,r,l,c,i,s,b,S=[],x=[],d),a),y===123)if(c===0)BS(w,t,C,C,S,a,d,s,x);else switch(f===99&&ha(w,3)===110?100:f){case 100:case 108:case 109:case 115:BS(e,C,C,n&&ex(l8(e,C,C,0,0,i,s,b,i,S=[],d),x),i,x,d,s,n?S:x);break;default:BS(w,C,C,C,[""],x,0,s,x)}}l=c=p=0,h=g=1,b=w="",d=o;break;case 58:d=1+pl(w),p=v;default:if(h<1){if(y==123)--h;else if(y==125&&h++==0&&d0e()==125)continue}switch(w+=U3(y),y*h){case 38:g=c>0?1:(w+="\f",-1);break;case 44:s[l++]=(pl(w)-1)*g,g=1;break;case 64:Ml()===45&&(w+=NS(Qo())),f=Ml(),c=d=pl(b=w+=v0e(FS())),y++;break;case 45:v===45&&pl(w)==2&&(h=0)}}return a}function l8(e,t,r,n,i,a,o,s,u,l,c){for(var d=i-1,f=i===0?a:[""],p=gO(f),v=0,h=0,m=0;v<n;++v)for(var g=0,y=rb(e,d+1,d=a0e(h=o[v])),b=e;g<p;++g)(b=rY(h>0?f[g]+" "+y:hn(y,/&\f/g,f[g])))&&(u[m++]=b);return z3(e,t,r,i===0?vO:s,u,l,c)}function g0e(e,t,r){return z3(e,t,r,eY,U3(c0e()),rb(e,2,-2),0)}function c8(e,t,r,n){return z3(e,t,r,mO,rb(e,0,n),rb(e,n+1,-1),n)}function dg(e,t){for(var r="",n=gO(e),i=0;i<n;i++)r+=t(e[i],i,e,t)||"";return r}function y0e(e,t,r,n){switch(e.type){case i0e:if(e.children.length)break;case n0e:case mO:return e.return=e.return||e.value;case eY:return"";case tY:return e.return=e.value+"{"+dg(e.children,n)+"}";case vO:e.value=e.props.join(",")}return pl(r=dg(e.children,n))?e.return=e.value+"{"+r+"}":""}function b0e(e){var t=gO(e);return function(r,n,i,a){for(var o="",s=0;s<t;s++)o+=e[s](r,n,i,a)||"";return o}}function x0e(e){return function(t){t.root||(t=t.return)&&e(t)}}function S0e(e){var t=Object.create(null);return function(r){return t[r]===void 0&&(t[r]=e(r)),t[r]}}var C0e=function(t,r,n){for(var i=0,a=0;i=a,a=Ml(),i===38&&a===12&&(r[n]=1),!nb(a);)Qo();return Yb(t,Ao)},_0e=function(t,r){var n=-1,i=44;do switch(nb(i)){case 0:i===38&&Ml()===12&&(r[n]=1),t[n]+=C0e(Ao-1,r,n);break;case 2:t[n]+=NS(i);break;case 4:if(i===44){t[++n]=Ml()===58?"&\f":"",r[n]=t[n].length;break}default:t[n]+=U3(i)}while(i=Qo());return t},w0e=function(t,r){return aY(_0e(iY(t),r))},d8=new WeakMap,E0e=function(t){if(!(t.type!=="rule"||!t.parent||t.length<1)){for(var r=t.value,n=t.parent,i=t.column===n.column&&t.line===n.line;n.type!=="rule";)if(n=n.parent,!n)return;if(!(t.props.length===1&&r.charCodeAt(0)!==58&&!d8.get(n))&&!i){d8.set(t,!0);for(var a=[],o=w0e(r,a),s=n.props,u=0,l=0;u<o.length;u++)for(var c=0;c<s.length;c++,l++)t.props[l]=a[u]?o[u].replace(/&\f/g,s[c]):s[c]+" "+o[u]}}},A0e=function(t){if(t.type==="decl"){var r=t.value;r.charCodeAt(0)===108&&r.charCodeAt(2)===98&&(t.return="",t.value="")}};function oY(e,t){switch(s0e(e,t)){case 5103:return pn+"print-"+e+e;case 5737:case 4201:case 3177:case 3433:case 1641:case 4457:case 2921:case 5572:case 6356:case 5844:case 3191:case 6645:case 3005:case 6391:case 5879:case 5623:case 6135:case 4599:case 4855:case 4215:case 6389:case 5109:case 5365:case 5621:case 3829:return pn+e+e;case 5349:case 4246:case 4810:case 6968:case 2756:return pn+e+KC+e+Ta+e+e;case 6828:case 4268:return pn+e+Ta+e+e;case 6165:return pn+e+Ta+"flex-"+e+e;case 5187:return pn+e+hn(e,/(\w+).+(:[^]+)/,pn+"box-$1$2"+Ta+"flex-$1$2")+e;case 5443:return pn+e+Ta+"flex-item-"+hn(e,/flex-|-self/,"")+e;case 4675:return pn+e+Ta+"flex-line-pack"+hn(e,/align-content|flex-|-self/,"")+e;case 5548:return pn+e+Ta+hn(e,"shrink","negative")+e;case 5292:return pn+e+Ta+hn(e,"basis","preferred-size")+e;case 6060:return pn+"box-"+hn(e,"-grow","")+pn+e+Ta+hn(e,"grow","positive")+e;case 4554:return pn+hn(e,/([^-])(transform)/g,"$1"+pn+"$2")+e;case 6187:return hn(hn(hn(e,/(zoom-|grab)/,pn+"$1"),/(image-set)/,pn+"$1"),e,"")+e;case 5495:case 3959:return hn(e,/(image-set\([^]*)/,pn+"$1$`$1");case 4968:return hn(hn(e,/(.+:)(flex-)?(.*)/,pn+"box-pack:$3"+Ta+"flex-pack:$3"),/s.+-b[^;]+/,"justify")+pn+e+e;case 4095:case 3583:case 4068:case 2532:return hn(e,/(.+)-inline(.+)/,pn+"$1$2")+e;case 8116:case 7059:case 5753:case 5535:case 5445:case 5701:case 4933:case 4677:case 5533:case 5789:case 5021:case 4765:if(pl(e)-1-t>6)switch(ha(e,t+1)){case 109:if(ha(e,t+4)!==45)break;case 102:return hn(e,/(.+:)(.+)-([^]+)/,"$1"+pn+"$2-$3$1"+KC+(ha(e,t+3)==108?"$3":"$2-$3"))+e;case 115:return~OM(e,"stretch")?oY(hn(e,"stretch","fill-available"),t)+e:e}break;case 4949:if(ha(e,t+1)!==115)break;case 6444:switch(ha(e,pl(e)-3-(~OM(e,"!important")&&10))){case 107:return hn(e,":",":"+pn)+e;case 101:return hn(e,/(.+:)([^;!]+)(;|!.+)?/,"$1"+pn+(ha(e,14)===45?"inline-":"")+"box$3$1"+pn+"$2$3$1"+Ta+"$2box$3")+e}break;case 5936:switch(ha(e,t+11)){case 114:return pn+e+Ta+hn(e,/[svh]\w+-[tblr]{2}/,"tb")+e;case 108:return pn+e+Ta+hn(e,/[svh]\w+-[tblr]{2}/,"tb-rl")+e;case 45:return pn+e+Ta+hn(e,/[svh]\w+-[tblr]{2}/,"lr")+e}return pn+e+Ta+e+e}return e}var P0e=function(t,r,n,i){if(t.length>-1&&!t.return)switch(t.type){case mO:t.return=oY(t.value,t.length);break;case tY:return dg([X0(t,{value:hn(t.value,"@","@"+pn)})],i);case vO:if(t.length)return l0e(t.props,function(a){switch(u0e(a,/(::plac\w+|:read-\w+)/)){case":read-only":case":read-write":return dg([X0(t,{props:[hn(a,/:(read-\w+)/,":"+KC+"$1")]})],i);case"::placeholder":return dg([X0(t,{props:[hn(a,/:(plac\w+)/,":"+pn+"input-$1")]}),X0(t,{props:[hn(a,/:(plac\w+)/,":"+KC+"$1")]}),X0(t,{props:[hn(a,/:(plac\w+)/,Ta+"input-$1")]})],i)}return""})}},T0e=[P0e],I0e=function(t){var r=t.key;if(r==="css"){var n=document.querySelectorAll("style[data-emotion]:not([data-s])");Array.prototype.forEach.call(n,function(h){var m=h.getAttribute("data-emotion");m.indexOf(" ")!==-1&&(document.head.appendChild(h),h.setAttribute("data-s",""))})}var i=t.stylisPlugins||T0e,a={},o,s=[];o=t.container||document.head,Array.prototype.forEach.call(document.querySelectorAll('style[data-emotion^="'+r+' "]'),function(h){for(var m=h.getAttribute("data-emotion").split(" "),g=1;g<m.length;g++)a[m[g]]=!0;s.push(h)});var u,l=[E0e,A0e];{var c,d=[y0e,x0e(function(h){c.insert(h)})],f=b0e(l.concat(i,d)),p=function(m){return dg(m0e(m),f)};u=function(m,g,y,b){c=y,p(m?m+"{"+g.styles+"}":g.styles),b&&(v.inserted[g.name]=!0)}}var v={key:r,sheet:new r0e({key:r,container:o,nonce:t.nonce,speedy:t.speedy,prepend:t.prepend,insertionPoint:t.insertionPoint}),nonce:t.nonce,inserted:a,registered:{},insert:u};return v.sheet.hydrate(s),v},M0e=!0;function D0e(e,t,r){var n="";return r.split(" ").forEach(function(i){e[i]!==void 0?t.push(e[i]+";"):n+=i+" "}),n}var sY=function(t,r,n){var i=t.key+"-"+r.name;(n===!1||M0e===!1)&&t.registered[i]===void 0&&(t.registered[i]=r.styles)},R0e=function(t,r,n){sY(t,r,n);var i=t.key+"-"+r.name;if(t.inserted[r.name]===void 0){var a=r;do t.insert(r===a?"."+i:"",a,t.sheet,!0),a=a.next;while(a!==void 0)}};function k0e(e){for(var t=0,r,n=0,i=e.length;i>=4;++n,i-=4)r=e.charCodeAt(n)&255|(e.charCodeAt(++n)&255)<<8|(e.charCodeAt(++n)&255)<<16|(e.charCodeAt(++n)&255)<<24,r=(r&65535)*1540483477+((r>>>16)*59797<<16),r^=r>>>24,t=(r&65535)*1540483477+((r>>>16)*59797<<16)^(t&65535)*1540483477+((t>>>16)*59797<<16);switch(i){case 3:t^=(e.charCodeAt(n+2)&255)<<16;case 2:t^=(e.charCodeAt(n+1)&255)<<8;case 1:t^=e.charCodeAt(n)&255,t=(t&65535)*1540483477+((t>>>16)*59797<<16)}return t^=t>>>13,t=(t&65535)*1540483477+((t>>>16)*59797<<16),((t^t>>>15)>>>0).toString(36)}var O0e={animationIterationCount:1,aspectRatio:1,borderImageOutset:1,borderImageSlice:1,borderImageWidth:1,boxFlex:1,boxFlexGroup:1,boxOrdinalGroup:1,columnCount:1,columns:1,flex:1,flexGrow:1,flexPositive:1,flexShrink:1,flexNegative:1,flexOrder:1,gridRow:1,gridRowEnd:1,gridRowSpan:1,gridRowStart:1,gridColumn:1,gridColumnEnd:1,gridColumnSpan:1,gridColumnStart:1,msGridRow:1,msGridRowSpan:1,msGridColumn:1,msGridColumnSpan:1,fontWeight:1,lineHeight:1,opacity:1,order:1,orphans:1,tabSize:1,widows:1,zIndex:1,zoom:1,WebkitLineClamp:1,fillOpacity:1,floodOpacity:1,stopOpacity:1,strokeDasharray:1,strokeDashoffset:1,strokeMiterlimit:1,strokeOpacity:1,strokeWidth:1},L0e=/[A-Z]|^ms/g,F0e=/_EMO_([^_]+?)_([^]*?)_EMO_/g,uY=function(t){return t.charCodeAt(1)===45},f8=function(t){return t!=null&&typeof t!="boolean"},EP=S0e(function(e){return uY(e)?e:e.replace(L0e,"-$&").toLowerCase()}),p8=function(t,r){switch(t){case"animation":case"animationName":if(typeof r=="string")return r.replace(F0e,function(n,i,a){return hl={name:i,styles:a,next:hl},i})}return O0e[t]!==1&&!uY(t)&&typeof r=="number"&&r!==0?r+"px":r};function ib(e,t,r){if(r==null)return"";if(r.__emotion_styles!==void 0)return r;switch(typeof r){case"boolean":return"";case"object":{if(r.anim===1)return hl={name:r.name,styles:r.styles,next:hl},r.name;if(r.styles!==void 0){var n=r.next;if(n!==void 0)for(;n!==void 0;)hl={name:n.name,styles:n.styles,next:hl},n=n.next;var i=r.styles+";";return i}return N0e(e,t,r)}case"function":{if(e!==void 0){var a=hl,o=r(e);return hl=a,ib(e,t,o)}break}}if(t==null)return r;var s=t[r];return s!==void 0?s:r}function N0e(e,t,r){var n="";if(Array.isArray(r))for(var i=0;i<r.length;i++)n+=ib(e,t,r[i])+";";else for(var a in r){var o=r[a];if(typeof o!="object")t!=null&&t[o]!==void 0?n+=a+"{"+t[o]+"}":f8(o)&&(n+=EP(a)+":"+p8(a,o)+";");else if(Array.isArray(o)&&typeof o[0]=="string"&&(t==null||t[o[0]]===void 0))for(var s=0;s<o.length;s++)f8(o[s])&&(n+=EP(a)+":"+p8(a,o[s])+";");else{var u=ib(e,t,o);switch(a){case"animation":case"animationName":{n+=EP(a)+":"+u+";";break}default:n+=a+"{"+u+"}"}}}return n}var h8=/label:\s*([^\s;\n{]+)\s*(;|$)/g,hl,lY=function(t,r,n){if(t.length===1&&typeof t[0]=="object"&&t[0]!==null&&t[0].styles!==void 0)return t[0];var i=!0,a="";hl=void 0;var o=t[0];o==null||o.raw===void 0?(i=!1,a+=ib(n,r,o)):a+=o[0];for(var s=1;s<t.length;s++)a+=ib(n,r,t[s]),i&&(a+=o[s]);h8.lastIndex=0;for(var u="",l;(l=h8.exec(a))!==null;)u+="-"+l[1];var c=k0e(a)+u;return{name:c,styles:a,next:hl}},B0e=function(t){return t()},U0e=nN["useInsertionEffect"]?nN["useInsertionEffect"]:!1,j0e=U0e||B0e,yO={}.hasOwnProperty,cY=_e.createContext(typeof HTMLElement<"u"?I0e({key:"css"}):null);cY.Provider;var z0e=function(t){return _e.forwardRef(function(r,n){var i=_e.useContext(cY);return t(r,i,n)})},V0e=_e.createContext({}),FM="__EMOTION_TYPE_PLEASE_DO_NOT_USE__",H0e=function(t,r){var n={};for(var i in r)yO.call(r,i)&&(n[i]=r[i]);return n[FM]=t,n},G0e=function(t){var r=t.cache,n=t.serialized,i=t.isStringTag;return sY(r,n,i),j0e(function(){return R0e(r,n,i)}),null},q0e=z0e(function(e,t,r){var n=e.css;typeof n=="string"&&t.registered[n]!==void 0&&(n=t.registered[n]);var i=e[FM],a=[n],o="";typeof e.className=="string"?o=D0e(t.registered,a,e.className):e.className!=null&&(o=e.className+" ");var s=lY(a,void 0,_e.useContext(V0e));o+=t.key+"-"+s.name;var u={};for(var l in e)yO.call(e,l)&&l!=="css"&&l!==FM&&(u[l]=e[l]);return u.ref=r,u.className=o,_e.createElement(_e.Fragment,null,_e.createElement(G0e,{cache:t,serialized:s,isStringTag:typeof i=="string"}),_e.createElement(i,u))}),$0e=q0e,dr=function(t,r){var n=arguments;if(r==null||!yO.call(r,"css"))return _e.createElement.apply(void 0,n);var i=n.length,a=new Array(i);a[0]=$0e,a[1]=H0e(t,r);for(var o=2;o<i;o++)a[o]=n[o];return _e.createElement.apply(null,a)};function bO(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return lY(t)}var W0e=function(){var t=bO.apply(void 0,arguments),r="animation-"+t.name;return{name:r,styles:"@keyframes "+r+"{"+t.styles+"}",anim:1,toString:function(){return"_EMO_"+this.name+"_"+this.styles+"_EMO_"}}};function X0e(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}function Y0e(e){return{...e,top:e.y,left:e.x,right:e.x+e.width,bottom:e.y+e.height}}const K0e=["top","right","bottom","left"];K0e.reduce((e,t)=>e.concat(t,t+"-start",t+"-end"),[]);function Dl(e){var t;return((t=e.ownerDocument)==null?void 0:t.defaultView)||window}function dY(e){return Dl(e).getComputedStyle(e)}function fY(e){return e instanceof Dl(e).Node}function pY(e){return fY(e)?(e.nodeName||"").toLowerCase():""}function xO(e){return e instanceof Dl(e).HTMLElement}function Ch(e){return e instanceof Dl(e).Element}function v8(e){return typeof ShadowRoot>"u"?!1:e instanceof Dl(e).ShadowRoot||e instanceof ShadowRoot}function hY(e){const{overflow:t,overflowX:r,overflowY:n,display:i}=dY(e);return/auto|scroll|overlay|hidden|clip/.test(t+n+r)&&!["inline","contents"].includes(i)}function Q0e(){return!(typeof CSS>"u"||!CSS.supports)&&CSS.supports("-webkit-backdrop-filter","none")}function Z0e(e){return["html","body","#document"].includes(pY(e))}const QC=Math.round;function J0e(e){const t=dY(e);let r=parseFloat(t.width)||0,n=parseFloat(t.height)||0;const i=xO(e),a=i?e.offsetWidth:r,o=i?e.offsetHeight:n,s=QC(r)!==a||QC(n)!==o;return s&&(r=a,n=o),{width:r,height:n,fallback:s}}function vY(e){return Ch(e)?e:e.contextElement}const mY={x:1,y:1};function AP(e){const t=vY(e);if(!xO(t))return mY;const r=t.getBoundingClientRect(),{width:n,height:i,fallback:a}=J0e(t);let o=(a?QC(r.width):r.width)/n,s=(a?QC(r.height):r.height)/i;return o&&Number.isFinite(o)||(o=1),s&&Number.isFinite(s)||(s=1),{x:o,y:s}}const m8={x:0,y:0};function eye(e,t,r){var n,i;if(t===void 0&&(t=!0),!Q0e())return m8;const a=e?Dl(e):window;return!r||t&&r!==a?m8:{x:((n=a.visualViewport)==null?void 0:n.offsetLeft)||0,y:((i=a.visualViewport)==null?void 0:i.offsetTop)||0}}function g8(e,t,r,n){t===void 0&&(t=!1),r===void 0&&(r=!1);const i=e.getBoundingClientRect(),a=vY(e);let o=mY;t&&(n?Ch(n)&&(o=AP(n)):o=AP(e));const s=eye(a,r,n);let u=(i.left+s.x)/o.x,l=(i.top+s.y)/o.y,c=i.width/o.x,d=i.height/o.y;if(a){const f=Dl(a),p=n&&Ch(n)?Dl(n):n;let v=f.frameElement;for(;v&&n&&p!==f;){const h=AP(v),m=v.getBoundingClientRect(),g=getComputedStyle(v);m.x+=(v.clientLeft+parseFloat(g.paddingLeft))*h.x,m.y+=(v.clientTop+parseFloat(g.paddingTop))*h.y,u*=h.x,l*=h.y,c*=h.x,d*=h.y,u+=m.x,l+=m.y,v=Dl(v).frameElement}}return Y0e({width:c,height:d,x:u,y:l})}function tye(e){return((fY(e)?e.ownerDocument:e.document)||window.document).documentElement}function rye(e){if(pY(e)==="html")return e;const t=e.assignedSlot||e.parentNode||v8(e)&&e.host||tye(e);return v8(t)?t.host:t}function gY(e){const t=rye(e);return Z0e(t)?t.ownerDocument.body:xO(t)&&hY(t)?t:gY(t)}function US(e,t){var r;t===void 0&&(t=[]);const n=gY(e),i=n===((r=e.ownerDocument)==null?void 0:r.body),a=Dl(n);return i?t.concat(a,a.visualViewport||[],hY(n)?n:[]):t.concat(n,US(n))}function nye(e,t,r,n){n===void 0&&(n={});const{ancestorScroll:i=!0,ancestorResize:a=!0,elementResize:o=!0,animationFrame:s=!1}=n,u=i||a?[...Ch(e)?US(e):e.contextElement?US(e.contextElement):[],...US(t)]:[];u.forEach(f=>{const p=!Ch(f)&&f.toString().includes("V");!i||s&&!p||f.addEventListener("scroll",r,{passive:!0}),a&&f.addEventListener("resize",r)});let l,c=null;o&&(c=new ResizeObserver(()=>{r()}),Ch(e)&&!s&&c.observe(e),Ch(e)||!e.contextElement||s||c.observe(e.contextElement),c.observe(t));let d=s?g8(e):null;return s&&function f(){const p=g8(e);!d||p.x===d.x&&p.y===d.y&&p.width===d.width&&p.height===d.height||r(),d=p,l=requestAnimationFrame(f)}(),r(),()=>{var f;u.forEach(p=>{i&&p.removeEventListener("scroll",r),a&&p.removeEventListener("resize",r)}),(f=c)==null||f.disconnect(),c=null,s&&cancelAnimationFrame(l)}}var NM=_e.useLayoutEffect,iye=["className","clearValue","cx","getStyles","getClassNames","getValue","hasValue","isMulti","isRtl","options","selectOption","selectProps","setValue","theme"],ZC=function(){};function aye(e,t){return t?t[0]==="-"?e+t:e+"__"+t:e}function oye(e,t){for(var r=arguments.length,n=new Array(r>2?r-2:0),i=2;i<r;i++)n[i-2]=arguments[i];var a=[].concat(n);if(t&&e)for(var o in t)t.hasOwnProperty(o)&&t[o]&&a.push("".concat(aye(e,o)));return a.filter(function(s){return s}).map(function(s){return String(s).trim()}).join(" ")}var y8=function(t){return vye(t)?t.filter(Boolean):tv(t)==="object"&&t!==null?[t]:[]},yY=function(t){t.className,t.clearValue,t.cx,t.getStyles,t.getClassNames,t.getValue,t.hasValue,t.isMulti,t.isRtl,t.options,t.selectOption,t.selectProps,t.setValue,t.theme;var r=d0(t,iye);return vr({},r)},xi=function(t,r,n){var i=t.cx,a=t.getStyles,o=t.getClassNames,s=t.className;return{css:a(r,t),className:i(n??{},o(r,t),s)}};function V3(e){return[document.documentElement,document.body,window].indexOf(e)>-1}function sye(e){return V3(e)?window.innerHeight:e.clientHeight}function bY(e){return V3(e)?window.pageYOffset:e.scrollTop}function JC(e,t){if(V3(e)){window.scrollTo(0,t);return}e.scrollTop=t}function uye(e){var t=getComputedStyle(e),r=t.position==="absolute",n=/(auto|scroll)/;if(t.position==="fixed")return document.documentElement;for(var i=e;i=i.parentElement;)if(t=getComputedStyle(i),!(r&&t.position==="static")&&n.test(t.overflow+t.overflowY+t.overflowX))return i;return document.documentElement}function lye(e,t,r,n){return r*((e=e/n-1)*e*e+1)+t}function tx(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:200,n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:ZC,i=bY(e),a=t-i,o=10,s=0;function u(){s+=o;var l=lye(s,i,a,r);JC(e,l),s<r?window.requestAnimationFrame(u):n(e)}u()}function b8(e,t){var r=e.getBoundingClientRect(),n=t.getBoundingClientRect(),i=t.offsetHeight/3;n.bottom+i>r.bottom?JC(e,Math.min(t.offsetTop+t.clientHeight-e.offsetHeight+i,e.scrollHeight)):n.top-i<r.top&&JC(e,Math.max(t.offsetTop-i,0))}function cye(e){var t=e.getBoundingClientRect();return{bottom:t.bottom,height:t.height,left:t.left,right:t.right,top:t.top,width:t.width}}function x8(){try{return document.createEvent("TouchEvent"),!0}catch{return!1}}function dye(){try{return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)}catch{return!1}}var xY=!1,fye={get passive(){return xY=!0}},rx=typeof window<"u"?window:{};rx.addEventListener&&rx.removeEventListener&&(rx.addEventListener("p",ZC,fye),rx.removeEventListener("p",ZC,!1));var pye=xY;function hye(e){return e!=null}function vye(e){return Array.isArray(e)}function nx(e,t,r){return e?t:r}var mye=function(t){for(var r=arguments.length,n=new Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];var a=Object.entries(t).filter(function(o){var s=Rc(o,1),u=s[0];return!n.includes(u)});return a.reduce(function(o,s){var u=Rc(s,2),l=u[0],c=u[1];return o[l]=c,o},{})};function gye(e){var t=e.maxHeight,r=e.menuEl,n=e.minHeight,i=e.placement,a=e.shouldScroll,o=e.isFixedPosition,s=e.controlHeight,u=uye(r),l={placement:"bottom",maxHeight:t};if(!r||!r.offsetParent)return l;var c=u.getBoundingClientRect(),d=c.height,f=r.getBoundingClientRect(),p=f.bottom,v=f.height,h=f.top,m=r.offsetParent.getBoundingClientRect(),g=m.top,y=o?window.innerHeight:sye(u),b=bY(u),S=parseInt(getComputedStyle(r).marginBottom,10),x=parseInt(getComputedStyle(r).marginTop,10),C=g-x,w=y-h,A=C+b,M=d-b-h,D=p-y+b+S,k=b+h-x,R=160;switch(i){case"auto":case"bottom":if(w>=v)return{placement:"bottom",maxHeight:t};if(M>=v&&!o)return a&&tx(u,D,R),{placement:"bottom",maxHeight:t};if(!o&&M>=n||o&&w>=n){a&&tx(u,D,R);var O=o?w-S:M-S;return{placement:"bottom",maxHeight:O}}if(i==="auto"||o){var H=t,B=o?C:A;return B>=n&&(H=Math.min(B-S-s,t)),{placement:"top",maxHeight:H}}if(i==="bottom")return a&&JC(u,D),{placement:"bottom",maxHeight:t};break;case"top":if(C>=v)return{placement:"top",maxHeight:t};if(A>=v&&!o)return a&&tx(u,k,R),{placement:"top",maxHeight:t};if(!o&&A>=n||o&&C>=n){var j=t;return(!o&&A>=n||o&&C>=n)&&(j=o?C-x:A-x),a&&tx(u,k,R),{placement:"top",maxHeight:j}}return{placement:"bottom",maxHeight:t};default:throw new Error('Invalid placement provided "'.concat(i,'".'))}return l}function yye(e){var t={bottom:"top",top:"bottom"};return e?t[e]:"bottom"}var SY=function(t){return t==="auto"?"bottom":t},bye=function(t,r){var n,i=t.placement,a=t.theme,o=a.borderRadius,s=a.spacing,u=a.colors;return vr((n={label:"menu"},Fy(n,yye(i),"100%"),Fy(n,"position","absolute"),Fy(n,"width","100%"),Fy(n,"zIndex",1),n),r?{}:{backgroundColor:u.neutral0,borderRadius:o,boxShadow:"0 0 0 1px hsla(0, 0%, 0%, 0.1), 0 4px 11px hsla(0, 0%, 0%, 0.1)",marginBottom:s.menuGutter,marginTop:s.menuGutter})},CY=_e.createContext(null),xye=function(t){var r=t.children,n=t.minMenuHeight,i=t.maxMenuHeight,a=t.menuPlacement,o=t.menuPosition,s=t.menuShouldScrollIntoView,u=t.theme,l=_e.useContext(CY)||{},c=l.setPortalPlacement,d=_e.useRef(null),f=_e.useState(i),p=Rc(f,2),v=p[0],h=p[1],m=_e.useState(null),g=Rc(m,2),y=g[0],b=g[1],S=u.spacing.controlHeight;return NM(function(){var x=d.current;if(x){var C=o==="fixed",w=s&&!C,A=gye({maxHeight:i,menuEl:x,minHeight:n,placement:a,shouldScroll:w,isFixedPosition:C,controlHeight:S});h(A.maxHeight),b(A.placement),c==null||c(A.placement)}},[i,a,o,s,n,c,S]),r({ref:d,placerProps:vr(vr({},t),{},{placement:y||SY(a),maxHeight:v})})},Sye=function(t){var r=t.children,n=t.innerRef,i=t.innerProps;return dr("div",pr({},xi(t,"menu",{menu:!0}),{ref:n},i),r)},Cye=Sye,_ye=function(t,r){var n=t.maxHeight,i=t.theme.spacing.baseUnit;return vr({maxHeight:n,overflowY:"auto",position:"relative",WebkitOverflowScrolling:"touch"},r?{}:{paddingBottom:i,paddingTop:i})},wye=function(t){var r=t.children,n=t.innerProps,i=t.innerRef,a=t.isMulti;return dr("div",pr({},xi(t,"menuList",{"menu-list":!0,"menu-list--is-multi":a}),{ref:i},n),r)},_Y=function(t,r){var n=t.theme,i=n.spacing.baseUnit,a=n.colors;return vr({textAlign:"center"},r?{}:{color:a.neutral40,padding:"".concat(i*2,"px ").concat(i*3,"px")})},Eye=_Y,Aye=_Y,wY=function(t){var r=t.children,n=t.innerProps;return dr("div",pr({},xi(t,"noOptionsMessage",{"menu-notice":!0,"menu-notice--no-options":!0}),n),r)};wY.defaultProps={children:"No options"};var EY=function(t){var r=t.children,n=t.innerProps;return dr("div",pr({},xi(t,"loadingMessage",{"menu-notice":!0,"menu-notice--loading":!0}),n),r)};EY.defaultProps={children:"Loading..."};var Pye=function(t){var r=t.rect,n=t.offset,i=t.position;return{left:r.left,position:i,top:n,width:r.width,zIndex:1}},Tye=function(t){var r=t.appendTo,n=t.children,i=t.controlElement,a=t.innerProps,o=t.menuPlacement,s=t.menuPosition,u=_e.useRef(null),l=_e.useRef(null),c=_e.useState(SY(o)),d=Rc(c,2),f=d[0],p=d[1],v=_e.useMemo(function(){return{setPortalPlacement:p}},[]),h=_e.useState(null),m=Rc(h,2),g=m[0],y=m[1],b=_e.useCallback(function(){if(i){var w=cye(i),A=s==="fixed"?0:window.pageYOffset,M=w[f]+A;(M!==(g==null?void 0:g.offset)||w.left!==(g==null?void 0:g.rect.left)||w.width!==(g==null?void 0:g.rect.width))&&y({offset:M,rect:w})}},[i,s,f,g==null?void 0:g.offset,g==null?void 0:g.rect.left,g==null?void 0:g.rect.width]);NM(function(){b()},[b]);var S=_e.useCallback(function(){typeof l.current=="function"&&(l.current(),l.current=null),i&&u.current&&(l.current=nye(i,u.current,b,{elementResize:"ResizeObserver"in window}))},[i,b]);NM(function(){S()},[S]);var x=_e.useCallback(function(w){u.current=w,S()},[S]);if(!r&&s!=="fixed"||!g)return null;var C=dr("div",pr({ref:x},xi(vr(vr({},t),{},{offset:g.offset,position:s,rect:g.rect}),"menuPortal",{"menu-portal":!0}),a),n);return dr(CY.Provider,{value:v},r?o3.createPortal(C,r):C)},Iye=function(t){var r=t.isDisabled,n=t.isRtl;return{label:"container",direction:n?"rtl":void 0,pointerEvents:r?"none":void 0,position:"relative"}},Mye=function(t){var r=t.children,n=t.innerProps,i=t.isDisabled,a=t.isRtl;return dr("div",pr({},xi(t,"container",{"--is-disabled":i,"--is-rtl":a}),n),r)},Dye=function(t,r){var n=t.theme.spacing,i=t.isMulti,a=t.hasValue,o=t.selectProps.controlShouldRenderValue;return vr({alignItems:"center",display:i&&a&&o?"flex":"grid",flex:1,flexWrap:"wrap",WebkitOverflowScrolling:"touch",position:"relative",overflow:"hidden"},r?{}:{padding:"".concat(n.baseUnit/2,"px ").concat(n.baseUnit*2,"px")})},Rye=function(t){var r=t.children,n=t.innerProps,i=t.isMulti,a=t.hasValue;return dr("div",pr({},xi(t,"valueContainer",{"value-container":!0,"value-container--is-multi":i,"value-container--has-value":a}),n),r)},kye=function(){return{alignItems:"center",alignSelf:"stretch",display:"flex",flexShrink:0}},Oye=function(t){var r=t.children,n=t.innerProps;return dr("div",pr({},xi(t,"indicatorsContainer",{indicators:!0}),n),r)},S8,Lye=["size"],Fye={name:"8mmkcg",styles:"display:inline-block;fill:currentColor;line-height:1;stroke:currentColor;stroke-width:0"},AY=function(t){var r=t.size,n=d0(t,Lye);return dr("svg",pr({height:r,width:r,viewBox:"0 0 20 20","aria-hidden":"true",focusable:"false",css:Fye},n))},SO=function(t){return dr(AY,pr({size:20},t),dr("path",{d:"M14.348 14.849c-0.469 0.469-1.229 0.469-1.697 0l-2.651-3.030-2.651 3.029c-0.469 0.469-1.229 0.469-1.697 0-0.469-0.469-0.469-1.229 0-1.697l2.758-3.15-2.759-3.152c-0.469-0.469-0.469-1.228 0-1.697s1.228-0.469 1.697 0l2.652 3.031 2.651-3.031c0.469-0.469 1.228-0.469 1.697 0s0.469 1.229 0 1.697l-2.758 3.152 2.758 3.15c0.469 0.469 0.469 1.229 0 1.698z"}))},PY=function(t){return dr(AY,pr({size:20},t),dr("path",{d:"M4.516 7.548c0.436-0.446 1.043-0.481 1.576 0l3.908 3.747 3.908-3.747c0.533-0.481 1.141-0.446 1.574 0 0.436 0.445 0.408 1.197 0 1.615-0.406 0.418-4.695 4.502-4.695 4.502-0.217 0.223-0.502 0.335-0.787 0.335s-0.57-0.112-0.789-0.335c0 0-4.287-4.084-4.695-4.502s-0.436-1.17 0-1.615z"}))},TY=function(t,r){var n=t.isFocused,i=t.theme,a=i.spacing.baseUnit,o=i.colors;return vr({label:"indicatorContainer",display:"flex",transition:"color 150ms"},r?{}:{color:n?o.neutral60:o.neutral20,padding:a*2,":hover":{color:n?o.neutral80:o.neutral40}})},Nye=TY,Bye=function(t){var r=t.children,n=t.innerProps;return dr("div",pr({},xi(t,"dropdownIndicator",{indicator:!0,"dropdown-indicator":!0}),n),r||dr(PY,null))},Uye=TY,jye=function(t){var r=t.children,n=t.innerProps;return dr("div",pr({},xi(t,"clearIndicator",{indicator:!0,"clear-indicator":!0}),n),r||dr(SO,null))},zye=function(t,r){var n=t.isDisabled,i=t.theme,a=i.spacing.baseUnit,o=i.colors;return vr({label:"indicatorSeparator",alignSelf:"stretch",width:1},r?{}:{backgroundColor:n?o.neutral10:o.neutral20,marginBottom:a*2,marginTop:a*2})},Vye=function(t){var r=t.innerProps;return dr("span",pr({},r,xi(t,"indicatorSeparator",{"indicator-separator":!0})))},Hye=W0e(S8||(S8=X0e([`
  0%, 80%, 100% { opacity: 0; }
  40% { opacity: 1; }
`]))),Gye=function(t,r){var n=t.isFocused,i=t.size,a=t.theme,o=a.colors,s=a.spacing.baseUnit;return vr({label:"loadingIndicator",display:"flex",transition:"color 150ms",alignSelf:"center",fontSize:i,lineHeight:1,marginRight:i,textAlign:"center",verticalAlign:"middle"},r?{}:{color:n?o.neutral60:o.neutral20,padding:s*2})},PP=function(t){var r=t.delay,n=t.offset;return dr("span",{css:bO({animation:"".concat(Hye," 1s ease-in-out ").concat(r,"ms infinite;"),backgroundColor:"currentColor",borderRadius:"1em",display:"inline-block",marginLeft:n?"1em":void 0,height:"1em",verticalAlign:"top",width:"1em"},"","")})},IY=function(t){var r=t.innerProps,n=t.isRtl;return dr("div",pr({},xi(t,"loadingIndicator",{indicator:!0,"loading-indicator":!0}),r),dr(PP,{delay:0,offset:n}),dr(PP,{delay:160,offset:!0}),dr(PP,{delay:320,offset:!n}))};IY.defaultProps={size:4};var qye=function(t,r){var n=t.isDisabled,i=t.isFocused,a=t.theme,o=a.colors,s=a.borderRadius,u=a.spacing;return vr({label:"control",alignItems:"center",cursor:"default",display:"flex",flexWrap:"wrap",justifyContent:"space-between",minHeight:u.controlHeight,outline:"0 !important",position:"relative",transition:"all 100ms"},r?{}:{backgroundColor:n?o.neutral5:o.neutral0,borderColor:n?o.neutral10:i?o.primary:o.neutral20,borderRadius:s,borderStyle:"solid",borderWidth:1,boxShadow:i?"0 0 0 1px ".concat(o.primary):void 0,"&:hover":{borderColor:i?o.primary:o.neutral30}})},$ye=function(t){var r=t.children,n=t.isDisabled,i=t.isFocused,a=t.innerRef,o=t.innerProps,s=t.menuIsOpen;return dr("div",pr({ref:a},xi(t,"control",{control:!0,"control--is-disabled":n,"control--is-focused":i,"control--menu-is-open":s}),o),r)},Wye=$ye,Xye=["data"],Yye=function(t,r){var n=t.theme.spacing;return r?{}:{paddingBottom:n.baseUnit*2,paddingTop:n.baseUnit*2}},Kye=function(t){var r=t.children,n=t.cx,i=t.getStyles,a=t.getClassNames,o=t.Heading,s=t.headingProps,u=t.innerProps,l=t.label,c=t.theme,d=t.selectProps;return dr("div",pr({},xi(t,"group",{group:!0}),u),dr(o,pr({},s,{selectProps:d,theme:c,getStyles:i,getClassNames:a,cx:n}),l),dr("div",null,r))},Qye=function(t,r){var n=t.theme,i=n.colors,a=n.spacing;return vr({label:"group",cursor:"default",display:"block"},r?{}:{color:i.neutral40,fontSize:"75%",fontWeight:500,marginBottom:"0.25em",paddingLeft:a.baseUnit*3,paddingRight:a.baseUnit*3,textTransform:"uppercase"})},Zye=function(t){var r=yY(t);r.data;var n=d0(r,Xye);return dr("div",pr({},xi(t,"groupHeading",{"group-heading":!0}),n))},Jye=Kye,e1e=["innerRef","isDisabled","isHidden","inputClassName"],t1e=function(t,r){var n=t.isDisabled,i=t.value,a=t.theme,o=a.spacing,s=a.colors;return vr(vr({visibility:n?"hidden":"visible",transform:i?"translateZ(0)":""},r1e),r?{}:{margin:o.baseUnit/2,paddingBottom:o.baseUnit/2,paddingTop:o.baseUnit/2,color:s.neutral80})},MY={gridArea:"1 / 2",font:"inherit",minWidth:"2px",border:0,margin:0,outline:0,padding:0},r1e={flex:"1 1 auto",display:"inline-grid",gridArea:"1 / 1 / 2 / 3",gridTemplateColumns:"0 min-content","&:after":vr({content:'attr(data-value) " "',visibility:"hidden",whiteSpace:"pre"},MY)},n1e=function(t){return vr({label:"input",color:"inherit",background:0,opacity:t?0:1,width:"100%"},MY)},i1e=function(t){var r=t.cx,n=t.value,i=yY(t),a=i.innerRef,o=i.isDisabled,s=i.isHidden,u=i.inputClassName,l=d0(i,e1e);return dr("div",pr({},xi(t,"input",{"input-container":!0}),{"data-value":n||""}),dr("input",pr({className:r({input:!0},u),ref:a,style:n1e(s),disabled:o},l)))},a1e=i1e,o1e=function(t,r){var n=t.theme,i=n.spacing,a=n.borderRadius,o=n.colors;return vr({label:"multiValue",display:"flex",minWidth:0},r?{}:{backgroundColor:o.neutral10,borderRadius:a/2,margin:i.baseUnit/2})},s1e=function(t,r){var n=t.theme,i=n.borderRadius,a=n.colors,o=t.cropWithEllipsis;return vr({overflow:"hidden",textOverflow:o||o===void 0?"ellipsis":void 0,whiteSpace:"nowrap"},r?{}:{borderRadius:i/2,color:a.neutral80,fontSize:"85%",padding:3,paddingLeft:6})},u1e=function(t,r){var n=t.theme,i=n.spacing,a=n.borderRadius,o=n.colors,s=t.isFocused;return vr({alignItems:"center",display:"flex"},r?{}:{borderRadius:a/2,backgroundColor:s?o.dangerLight:void 0,paddingLeft:i.baseUnit,paddingRight:i.baseUnit,":hover":{backgroundColor:o.dangerLight,color:o.danger}})},DY=function(t){var r=t.children,n=t.innerProps;return dr("div",n,r)},l1e=DY,c1e=DY;function d1e(e){var t=e.children,r=e.innerProps;return dr("div",pr({role:"button"},r),t||dr(SO,{size:14}))}var f1e=function(t){var r=t.children,n=t.components,i=t.data,a=t.innerProps,o=t.isDisabled,s=t.removeProps,u=t.selectProps,l=n.Container,c=n.Label,d=n.Remove;return dr(l,{data:i,innerProps:vr(vr({},xi(t,"multiValue",{"multi-value":!0,"multi-value--is-disabled":o})),a),selectProps:u},dr(c,{data:i,innerProps:vr({},xi(t,"multiValueLabel",{"multi-value__label":!0})),selectProps:u},r),dr(d,{data:i,innerProps:vr(vr({},xi(t,"multiValueRemove",{"multi-value__remove":!0})),{},{"aria-label":"Remove ".concat(r||"option")},s),selectProps:u}))},p1e=f1e,h1e=function(t,r){var n=t.isDisabled,i=t.isFocused,a=t.isSelected,o=t.theme,s=o.spacing,u=o.colors;return vr({label:"option",cursor:"default",display:"block",fontSize:"inherit",width:"100%",userSelect:"none",WebkitTapHighlightColor:"rgba(0, 0, 0, 0)"},r?{}:{backgroundColor:a?u.primary:i?u.primary25:"transparent",color:n?u.neutral20:a?u.neutral0:"inherit",padding:"".concat(s.baseUnit*2,"px ").concat(s.baseUnit*3,"px"),":active":{backgroundColor:n?void 0:a?u.primary:u.primary50}})},v1e=function(t){var r=t.children,n=t.isDisabled,i=t.isFocused,a=t.isSelected,o=t.innerRef,s=t.innerProps;return dr("div",pr({},xi(t,"option",{option:!0,"option--is-disabled":n,"option--is-focused":i,"option--is-selected":a}),{ref:o,"aria-disabled":n},s),r)},m1e=v1e,g1e=function(t,r){var n=t.theme,i=n.spacing,a=n.colors;return vr({label:"placeholder",gridArea:"1 / 1 / 2 / 3"},r?{}:{color:a.neutral50,marginLeft:i.baseUnit/2,marginRight:i.baseUnit/2})},y1e=function(t){var r=t.children,n=t.innerProps;return dr("div",pr({},xi(t,"placeholder",{placeholder:!0}),n),r)},b1e=y1e,x1e=function(t,r){var n=t.isDisabled,i=t.theme,a=i.spacing,o=i.colors;return vr({label:"singleValue",gridArea:"1 / 1 / 2 / 3",maxWidth:"100%",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},r?{}:{color:n?o.neutral40:o.neutral80,marginLeft:a.baseUnit/2,marginRight:a.baseUnit/2})},S1e=function(t){var r=t.children,n=t.isDisabled,i=t.innerProps;return dr("div",pr({},xi(t,"singleValue",{"single-value":!0,"single-value--is-disabled":n}),i),r)},C1e=S1e,_1e={ClearIndicator:jye,Control:Wye,DropdownIndicator:Bye,DownChevron:PY,CrossIcon:SO,Group:Jye,GroupHeading:Zye,IndicatorsContainer:Oye,IndicatorSeparator:Vye,Input:a1e,LoadingIndicator:IY,Menu:Cye,MenuList:wye,MenuPortal:Tye,LoadingMessage:EY,NoOptionsMessage:wY,MultiValue:p1e,MultiValueContainer:l1e,MultiValueLabel:c1e,MultiValueRemove:d1e,Option:m1e,Placeholder:b1e,SelectContainer:Mye,SingleValue:C1e,ValueContainer:Rye},w1e=function(t){return vr(vr({},_1e),t.components)},C8=Number.isNaN||function(t){return typeof t=="number"&&t!==t};function E1e(e,t){return!!(e===t||C8(e)&&C8(t))}function A1e(e,t){if(e.length!==t.length)return!1;for(var r=0;r<e.length;r++)if(!E1e(e[r],t[r]))return!1;return!0}function P1e(e,t){t===void 0&&(t=A1e);var r=null;function n(){for(var i=[],a=0;a<arguments.length;a++)i[a]=arguments[a];if(r&&r.lastThis===this&&t(i,r.lastArgs))return r.lastResult;var o=e.apply(this,i);return r={lastResult:o,lastArgs:i,lastThis:this},o}return n.clear=function(){r=null},n}var T1e={name:"7pg0cj-a11yText",styles:"label:a11yText;z-index:9999;border:0;clip:rect(1px, 1px, 1px, 1px);height:1px;width:1px;position:absolute;overflow:hidden;padding:0;white-space:nowrap"},I1e=function(t){return dr("span",pr({css:T1e},t))},_8=I1e,M1e={guidance:function(t){var r=t.isSearchable,n=t.isMulti,i=t.isDisabled,a=t.tabSelectsValue,o=t.context;switch(o){case"menu":return"Use Up and Down to choose options".concat(i?"":", press Enter to select the currently focused option",", press Escape to exit the menu").concat(a?", press Tab to select the option and exit the menu":"",".");case"input":return"".concat(t["aria-label"]||"Select"," is focused ").concat(r?",type to refine list":"",", press Down to open the menu, ").concat(n?" press left to focus selected values":"");case"value":return"Use left and right to toggle between focused values, press Backspace to remove the currently focused value";default:return""}},onChange:function(t){var r=t.action,n=t.label,i=n===void 0?"":n,a=t.labels,o=t.isDisabled;switch(r){case"deselect-option":case"pop-value":case"remove-value":return"option ".concat(i,", deselected.");case"clear":return"All selected options have been cleared.";case"initial-input-focus":return"option".concat(a.length>1?"s":""," ").concat(a.join(","),", selected.");case"select-option":return o?"option ".concat(i," is disabled. Select another option."):"option ".concat(i,", selected.");default:return""}},onFocus:function(t){var r=t.context,n=t.focused,i=t.options,a=t.label,o=a===void 0?"":a,s=t.selectValue,u=t.isDisabled,l=t.isSelected,c=function(v,h){return v&&v.length?"".concat(v.indexOf(h)+1," of ").concat(v.length):""};if(r==="value"&&s)return"value ".concat(o," focused, ").concat(c(s,n),".");if(r==="menu"){var d=u?" disabled":"",f="".concat(l?"selected":"focused").concat(d);return"option ".concat(o," ").concat(f,", ").concat(c(i,n),".")}return""},onFilter:function(t){var r=t.inputValue,n=t.resultsMessage;return"".concat(n).concat(r?" for search term "+r:"",".")}},D1e=function(t){var r=t.ariaSelection,n=t.focusedOption,i=t.focusedValue,a=t.focusableOptions,o=t.isFocused,s=t.selectValue,u=t.selectProps,l=t.id,c=u.ariaLiveMessages,d=u.getOptionLabel,f=u.inputValue,p=u.isMulti,v=u.isOptionDisabled,h=u.isSearchable,m=u.menuIsOpen,g=u.options,y=u.screenReaderStatus,b=u.tabSelectsValue,S=u["aria-label"],x=u["aria-live"],C=_e.useMemo(function(){return vr(vr({},M1e),c||{})},[c]),w=_e.useMemo(function(){var H="";if(r&&C.onChange){var B=r.option,j=r.options,Y=r.removedValue,G=r.removedValues,$=r.value,q=function(J){return Array.isArray(J)?null:J},ee=Y||B||q($),fe=ee?d(ee):"",W=j||G||void 0,X=W?W.map(d):[],U=vr({isDisabled:ee&&v(ee,s),label:fe,labels:X},r);H=C.onChange(U)}return H},[r,C,v,s,d]),A=_e.useMemo(function(){var H="",B=n||i,j=!!(n&&s&&s.includes(n));if(B&&C.onFocus){var Y={focused:B,label:d(B),isDisabled:v(B,s),isSelected:j,options:a,context:B===n?"menu":"value",selectValue:s};H=C.onFocus(Y)}return H},[n,i,d,v,C,a,s]),M=_e.useMemo(function(){var H="";if(m&&g.length&&C.onFilter){var B=y({count:a.length});H=C.onFilter({inputValue:f,resultsMessage:B})}return H},[a,f,m,C,g,y]),D=_e.useMemo(function(){var H="";if(C.guidance){var B=i?"value":m?"menu":"input";H=C.guidance({"aria-label":S,context:B,isDisabled:n&&v(n,s),isMulti:p,isSearchable:h,tabSelectsValue:b})}return H},[S,n,i,p,v,h,m,C,s,b]),k="".concat(A," ").concat(M," ").concat(D),R=dr(_e.Fragment,null,dr("span",{id:"aria-selection"},w),dr("span",{id:"aria-context"},k)),O=(r==null?void 0:r.action)==="initial-input-focus";return dr(_e.Fragment,null,dr(_8,{id:l},O&&R),dr(_8,{"aria-live":x,"aria-atomic":"false","aria-relevant":"additions text"},o&&!O&&R))},R1e=D1e,BM=[{base:"A",letters:"A"},{base:"AA",letters:""},{base:"AE",letters:""},{base:"AO",letters:""},{base:"AU",letters:""},{base:"AV",letters:""},{base:"AY",letters:""},{base:"B",letters:"B"},{base:"C",letters:"C"},{base:"D",letters:"D"},{base:"DZ",letters:""},{base:"Dz",letters:""},{base:"E",letters:"E"},{base:"F",letters:"F"},{base:"G",letters:"G"},{base:"H",letters:"H"},{base:"I",letters:"I"},{base:"J",letters:"J"},{base:"K",letters:"K"},{base:"L",letters:"L"},{base:"LJ",letters:""},{base:"Lj",letters:""},{base:"M",letters:"M"},{base:"N",letters:"N"},{base:"NJ",letters:""},{base:"Nj",letters:""},{base:"O",letters:"O"},{base:"OI",letters:""},{base:"OO",letters:""},{base:"OU",letters:""},{base:"P",letters:"P"},{base:"Q",letters:"Q"},{base:"R",letters:"R"},{base:"S",letters:"S"},{base:"T",letters:"T"},{base:"TZ",letters:""},{base:"U",letters:"U"},{base:"V",letters:"V"},{base:"VY",letters:""},{base:"W",letters:"W"},{base:"X",letters:"X"},{base:"Y",letters:"Y"},{base:"Z",letters:"Z"},{base:"a",letters:"a"},{base:"aa",letters:""},{base:"ae",letters:""},{base:"ao",letters:""},{base:"au",letters:""},{base:"av",letters:""},{base:"ay",letters:""},{base:"b",letters:"b"},{base:"c",letters:"c"},{base:"d",letters:"d"},{base:"dz",letters:""},{base:"e",letters:"e"},{base:"f",letters:"f"},{base:"g",letters:"g"},{base:"h",letters:"h"},{base:"hv",letters:""},{base:"i",letters:"i"},{base:"j",letters:"j"},{base:"k",letters:"k"},{base:"l",letters:"l"},{base:"lj",letters:""},{base:"m",letters:"m"},{base:"n",letters:"n"},{base:"nj",letters:""},{base:"o",letters:"o"},{base:"oi",letters:""},{base:"ou",letters:""},{base:"oo",letters:""},{base:"p",letters:"p"},{base:"q",letters:"q"},{base:"r",letters:"r"},{base:"s",letters:"s"},{base:"t",letters:"t"},{base:"tz",letters:""},{base:"u",letters:"u"},{base:"v",letters:"v"},{base:"vy",letters:""},{base:"w",letters:"w"},{base:"x",letters:"x"},{base:"y",letters:"y"},{base:"z",letters:"z"}],k1e=new RegExp("["+BM.map(function(e){return e.letters}).join("")+"]","g"),RY={};for(var TP=0;TP<BM.length;TP++)for(var IP=BM[TP],MP=0;MP<IP.letters.length;MP++)RY[IP.letters[MP]]=IP.base;var kY=function(t){return t.replace(k1e,function(r){return RY[r]})},O1e=P1e(kY),w8=function(t){return t.replace(/^\s+|\s+$/g,"")},L1e=function(t){return"".concat(t.label," ").concat(t.value)},F1e=function(t){return function(r,n){if(r.data.__isNew__)return!0;var i=vr({ignoreCase:!0,ignoreAccents:!0,stringify:L1e,trim:!0,matchFrom:"any"},t),a=i.ignoreCase,o=i.ignoreAccents,s=i.stringify,u=i.trim,l=i.matchFrom,c=u?w8(n):n,d=u?w8(s(r)):s(r);return a&&(c=c.toLowerCase(),d=d.toLowerCase()),o&&(c=O1e(c),d=kY(d)),l==="start"?d.substr(0,c.length)===c:d.indexOf(c)>-1}},N1e=["innerRef"];function B1e(e){var t=e.innerRef,r=d0(e,N1e),n=mye(r,"onExited","in","enter","exit","appear");return dr("input",pr({ref:t},n,{css:bO({label:"dummyInput",background:0,border:0,caretColor:"transparent",fontSize:"inherit",gridArea:"1 / 1 / 2 / 3",outline:0,padding:0,width:1,color:"transparent",left:-100,opacity:0,position:"relative",transform:"scale(.01)"},"","")}))}var U1e=function(t){t.preventDefault(),t.stopPropagation()};function j1e(e){var t=e.isEnabled,r=e.onBottomArrive,n=e.onBottomLeave,i=e.onTopArrive,a=e.onTopLeave,o=_e.useRef(!1),s=_e.useRef(!1),u=_e.useRef(0),l=_e.useRef(null),c=_e.useCallback(function(m,g){if(l.current!==null){var y=l.current,b=y.scrollTop,S=y.scrollHeight,x=y.clientHeight,C=l.current,w=g>0,A=S-x-b,M=!1;A>g&&o.current&&(n&&n(m),o.current=!1),w&&s.current&&(a&&a(m),s.current=!1),w&&g>A?(r&&!o.current&&r(m),C.scrollTop=S,M=!0,o.current=!0):!w&&-g>b&&(i&&!s.current&&i(m),C.scrollTop=0,M=!0,s.current=!0),M&&U1e(m)}},[r,n,i,a]),d=_e.useCallback(function(m){c(m,m.deltaY)},[c]),f=_e.useCallback(function(m){u.current=m.changedTouches[0].clientY},[]),p=_e.useCallback(function(m){var g=u.current-m.changedTouches[0].clientY;c(m,g)},[c]),v=_e.useCallback(function(m){if(m){var g=pye?{passive:!1}:!1;m.addEventListener("wheel",d,g),m.addEventListener("touchstart",f,g),m.addEventListener("touchmove",p,g)}},[p,f,d]),h=_e.useCallback(function(m){m&&(m.removeEventListener("wheel",d,!1),m.removeEventListener("touchstart",f,!1),m.removeEventListener("touchmove",p,!1))},[p,f,d]);return _e.useEffect(function(){if(t){var m=l.current;return v(m),function(){h(m)}}},[t,v,h]),function(m){l.current=m}}var E8=["boxSizing","height","overflow","paddingRight","position"],A8={boxSizing:"border-box",overflow:"hidden",position:"relative",height:"100%"};function P8(e){e.preventDefault()}function T8(e){e.stopPropagation()}function I8(){var e=this.scrollTop,t=this.scrollHeight,r=e+this.offsetHeight;e===0?this.scrollTop=1:r===t&&(this.scrollTop=e-1)}function M8(){return"ontouchstart"in window||navigator.maxTouchPoints}var D8=!!(typeof window<"u"&&window.document&&window.document.createElement),Y0=0,am={capture:!1,passive:!1};function z1e(e){var t=e.isEnabled,r=e.accountForScrollbars,n=r===void 0?!0:r,i=_e.useRef({}),a=_e.useRef(null),o=_e.useCallback(function(u){if(D8){var l=document.body,c=l&&l.style;if(n&&E8.forEach(function(v){var h=c&&c[v];i.current[v]=h}),n&&Y0<1){var d=parseInt(i.current.paddingRight,10)||0,f=document.body?document.body.clientWidth:0,p=window.innerWidth-f+d||0;Object.keys(A8).forEach(function(v){var h=A8[v];c&&(c[v]=h)}),c&&(c.paddingRight="".concat(p,"px"))}l&&M8()&&(l.addEventListener("touchmove",P8,am),u&&(u.addEventListener("touchstart",I8,am),u.addEventListener("touchmove",T8,am))),Y0+=1}},[n]),s=_e.useCallback(function(u){if(D8){var l=document.body,c=l&&l.style;Y0=Math.max(Y0-1,0),n&&Y0<1&&E8.forEach(function(d){var f=i.current[d];c&&(c[d]=f)}),l&&M8()&&(l.removeEventListener("touchmove",P8,am),u&&(u.removeEventListener("touchstart",I8,am),u.removeEventListener("touchmove",T8,am)))}},[n]);return _e.useEffect(function(){if(t){var u=a.current;return o(u),function(){s(u)}}},[t,o,s]),function(u){a.current=u}}var V1e=function(){return document.activeElement&&document.activeElement.blur()},H1e={name:"1kfdb0e",styles:"position:fixed;left:0;bottom:0;right:0;top:0"};function G1e(e){var t=e.children,r=e.lockEnabled,n=e.captureEnabled,i=n===void 0?!0:n,a=e.onBottomArrive,o=e.onBottomLeave,s=e.onTopArrive,u=e.onTopLeave,l=j1e({isEnabled:i,onBottomArrive:a,onBottomLeave:o,onTopArrive:s,onTopLeave:u}),c=z1e({isEnabled:r}),d=function(p){l(p),c(p)};return dr(_e.Fragment,null,r&&dr("div",{onClick:V1e,css:H1e}),t(d))}var q1e={name:"1a0ro4n-requiredInput",styles:"label:requiredInput;opacity:0;pointer-events:none;position:absolute;bottom:0;left:0;right:0;width:100%"},$1e=function(t){var r=t.name,n=t.onFocus;return dr("input",{required:!0,name:r,tabIndex:-1,"aria-hidden":"true",onFocus:n,css:q1e,value:"",onChange:function(){}})},W1e=$1e,X1e=function(t){return t.label},Y1e=function(t){return t.label},K1e=function(t){return t.value},Q1e=function(t){return!!t.isDisabled},Z1e={clearIndicator:Uye,container:Iye,control:qye,dropdownIndicator:Nye,group:Yye,groupHeading:Qye,indicatorsContainer:kye,indicatorSeparator:zye,input:t1e,loadingIndicator:Gye,loadingMessage:Aye,menu:bye,menuList:_ye,menuPortal:Pye,multiValue:o1e,multiValueLabel:s1e,multiValueRemove:u1e,noOptionsMessage:Eye,option:h1e,placeholder:g1e,singleValue:x1e,valueContainer:Dye},J1e={primary:"#2684FF",primary75:"#4C9AFF",primary50:"#B2D4FF",primary25:"#DEEBFF",danger:"#DE350B",dangerLight:"#FFBDAD",neutral0:"hsl(0, 0%, 100%)",neutral5:"hsl(0, 0%, 95%)",neutral10:"hsl(0, 0%, 90%)",neutral20:"hsl(0, 0%, 80%)",neutral30:"hsl(0, 0%, 70%)",neutral40:"hsl(0, 0%, 60%)",neutral50:"hsl(0, 0%, 50%)",neutral60:"hsl(0, 0%, 40%)",neutral70:"hsl(0, 0%, 30%)",neutral80:"hsl(0, 0%, 20%)",neutral90:"hsl(0, 0%, 10%)"},ebe=4,OY=4,tbe=38,rbe=OY*2,nbe={baseUnit:OY,controlHeight:tbe,menuGutter:rbe},DP={borderRadius:ebe,colors:J1e,spacing:nbe},ibe={"aria-live":"polite",backspaceRemovesValue:!0,blurInputOnSelect:x8(),captureMenuScroll:!x8(),classNames:{},closeMenuOnSelect:!0,closeMenuOnScroll:!1,components:{},controlShouldRenderValue:!0,escapeClearsValue:!1,filterOption:F1e(),formatGroupLabel:X1e,getOptionLabel:Y1e,getOptionValue:K1e,isDisabled:!1,isLoading:!1,isMulti:!1,isRtl:!1,isSearchable:!0,isOptionDisabled:Q1e,loadingMessage:function(){return"Loading..."},maxMenuHeight:300,minMenuHeight:140,menuIsOpen:!1,menuPlacement:"bottom",menuPosition:"absolute",menuShouldBlockScroll:!1,menuShouldScrollIntoView:!dye(),noOptionsMessage:function(){return"No options"},openMenuOnFocus:!1,openMenuOnClick:!0,options:[],pageSize:5,placeholder:"Select...",screenReaderStatus:function(t){var r=t.count;return"".concat(r," result").concat(r!==1?"s":""," available")},styles:{},tabIndex:0,tabSelectsValue:!0,unstyled:!1};function R8(e,t,r,n){var i=BY(e,t,r),a=UY(e,t,r),o=NY(e,t),s=e_(e,t);return{type:"option",data:t,isDisabled:i,isSelected:a,label:o,value:s,index:n}}function LY(e,t){return e.options.map(function(r,n){if("options"in r){var i=r.options.map(function(o,s){return R8(e,o,t,s)}).filter(function(o){return k8(e,o)});return i.length>0?{type:"group",data:r,options:i,index:n}:void 0}var a=R8(e,r,t,n);return k8(e,a)?a:void 0}).filter(hye)}function FY(e){return e.reduce(function(t,r){return r.type==="group"?t.push.apply(t,JX(r.options.map(function(n){return n.data}))):t.push(r.data),t},[])}function abe(e,t){return FY(LY(e,t))}function k8(e,t){var r=e.inputValue,n=r===void 0?"":r,i=t.data,a=t.isSelected,o=t.label,s=t.value;return(!zY(e)||!a)&&jY(e,{label:o,value:s,data:i},n)}function obe(e,t){var r=e.focusedValue,n=e.selectValue,i=n.indexOf(r);if(i>-1){var a=t.indexOf(r);if(a>-1)return r;if(i<t.length)return t[i]}return null}function sbe(e,t){var r=e.focusedOption;return r&&t.indexOf(r)>-1?r:t[0]}var NY=function(t,r){return t.getOptionLabel(r)},e_=function(t,r){return t.getOptionValue(r)};function BY(e,t,r){return typeof e.isOptionDisabled=="function"?e.isOptionDisabled(t,r):!1}function UY(e,t,r){if(r.indexOf(t)>-1)return!0;if(typeof e.isOptionSelected=="function")return e.isOptionSelected(t,r);var n=e_(e,t);return r.some(function(i){return e_(e,i)===n})}function jY(e,t,r){return e.filterOption?e.filterOption(t,r):!0}var zY=function(t){var r=t.hideSelectedOptions,n=t.isMulti;return r===void 0?n:r},ube=1,VY=function(e){$ge(r,e);var t=Kge(r);function r(n){var i;if(Gge(this,r),i=t.call(this,n),i.state={ariaSelection:null,focusedOption:null,focusedValue:null,inputIsHidden:!1,isFocused:!1,selectValue:[],clearFocusValueOnUpdate:!1,prevWasFocused:!1,inputIsHiddenAfterUpdate:void 0,prevProps:void 0},i.blockOptionHover=!1,i.isComposing=!1,i.commonProps=void 0,i.initialTouchX=0,i.initialTouchY=0,i.instancePrefix="",i.openAfterFocus=!1,i.scrollToFocusedOptionOnUpdate=!1,i.userIsDragging=void 0,i.controlRef=null,i.getControlRef=function(s){i.controlRef=s},i.focusedOptionRef=null,i.getFocusedOptionRef=function(s){i.focusedOptionRef=s},i.menuListRef=null,i.getMenuListRef=function(s){i.menuListRef=s},i.inputRef=null,i.getInputRef=function(s){i.inputRef=s},i.focus=i.focusInput,i.blur=i.blurInput,i.onChange=function(s,u){var l=i.props,c=l.onChange,d=l.name;u.name=d,i.ariaOnChange(s,u),c(s,u)},i.setValue=function(s,u,l){var c=i.props,d=c.closeMenuOnSelect,f=c.isMulti,p=c.inputValue;i.onInputChange("",{action:"set-value",prevInputValue:p}),d&&(i.setState({inputIsHiddenAfterUpdate:!f}),i.onMenuClose()),i.setState({clearFocusValueOnUpdate:!0}),i.onChange(s,{action:u,option:l})},i.selectOption=function(s){var u=i.props,l=u.blurInputOnSelect,c=u.isMulti,d=u.name,f=i.state.selectValue,p=c&&i.isOptionSelected(s,f),v=i.isOptionDisabled(s,f);if(p){var h=i.getOptionValue(s);i.setValue(f.filter(function(m){return i.getOptionValue(m)!==h}),"deselect-option",s)}else if(!v)c?i.setValue([].concat(JX(f),[s]),"select-option",s):i.setValue(s,"select-option");else{i.ariaOnChange(s,{action:"select-option",option:s,name:d});return}l&&i.blurInput()},i.removeValue=function(s){var u=i.props.isMulti,l=i.state.selectValue,c=i.getOptionValue(s),d=l.filter(function(p){return i.getOptionValue(p)!==c}),f=nx(u,d,d[0]||null);i.onChange(f,{action:"remove-value",removedValue:s}),i.focusInput()},i.clearValue=function(){var s=i.state.selectValue;i.onChange(nx(i.props.isMulti,[],null),{action:"clear",removedValues:s})},i.popValue=function(){var s=i.props.isMulti,u=i.state.selectValue,l=u[u.length-1],c=u.slice(0,u.length-1),d=nx(s,c,c[0]||null);i.onChange(d,{action:"pop-value",removedValue:l})},i.getValue=function(){return i.state.selectValue},i.cx=function(){for(var s=arguments.length,u=new Array(s),l=0;l<s;l++)u[l]=arguments[l];return oye.apply(void 0,[i.props.classNamePrefix].concat(u))},i.getOptionLabel=function(s){return NY(i.props,s)},i.getOptionValue=function(s){return e_(i.props,s)},i.getStyles=function(s,u){var l=i.props.unstyled,c=Z1e[s](u,l);c.boxSizing="border-box";var d=i.props.styles[s];return d?d(c,u):c},i.getClassNames=function(s,u){var l,c;return(l=(c=i.props.classNames)[s])===null||l===void 0?void 0:l.call(c,u)},i.getElementId=function(s){return"".concat(i.instancePrefix,"-").concat(s)},i.getComponents=function(){return w1e(i.props)},i.buildCategorizedOptions=function(){return LY(i.props,i.state.selectValue)},i.getCategorizedOptions=function(){return i.props.menuIsOpen?i.buildCategorizedOptions():[]},i.buildFocusableOptions=function(){return FY(i.buildCategorizedOptions())},i.getFocusableOptions=function(){return i.props.menuIsOpen?i.buildFocusableOptions():[]},i.ariaOnChange=function(s,u){i.setState({ariaSelection:vr({value:s},u)})},i.onMenuMouseDown=function(s){s.button===0&&(s.stopPropagation(),s.preventDefault(),i.focusInput())},i.onMenuMouseMove=function(s){i.blockOptionHover=!1},i.onControlMouseDown=function(s){if(!s.defaultPrevented){var u=i.props.openMenuOnClick;i.state.isFocused?i.props.menuIsOpen?s.target.tagName!=="INPUT"&&s.target.tagName!=="TEXTAREA"&&i.onMenuClose():u&&i.openMenu("first"):(u&&(i.openAfterFocus=!0),i.focusInput()),s.target.tagName!=="INPUT"&&s.target.tagName!=="TEXTAREA"&&s.preventDefault()}},i.onDropdownIndicatorMouseDown=function(s){if(!(s&&s.type==="mousedown"&&s.button!==0)&&!i.props.isDisabled){var u=i.props,l=u.isMulti,c=u.menuIsOpen;i.focusInput(),c?(i.setState({inputIsHiddenAfterUpdate:!l}),i.onMenuClose()):i.openMenu("first"),s.preventDefault()}},i.onClearIndicatorMouseDown=function(s){s&&s.type==="mousedown"&&s.button!==0||(i.clearValue(),s.preventDefault(),i.openAfterFocus=!1,s.type==="touchend"?i.focusInput():setTimeout(function(){return i.focusInput()}))},i.onScroll=function(s){typeof i.props.closeMenuOnScroll=="boolean"?s.target instanceof HTMLElement&&V3(s.target)&&i.props.onMenuClose():typeof i.props.closeMenuOnScroll=="function"&&i.props.closeMenuOnScroll(s)&&i.props.onMenuClose()},i.onCompositionStart=function(){i.isComposing=!0},i.onCompositionEnd=function(){i.isComposing=!1},i.onTouchStart=function(s){var u=s.touches,l=u&&u.item(0);l&&(i.initialTouchX=l.clientX,i.initialTouchY=l.clientY,i.userIsDragging=!1)},i.onTouchMove=function(s){var u=s.touches,l=u&&u.item(0);if(l){var c=Math.abs(l.clientX-i.initialTouchX),d=Math.abs(l.clientY-i.initialTouchY),f=5;i.userIsDragging=c>f||d>f}},i.onTouchEnd=function(s){i.userIsDragging||(i.controlRef&&!i.controlRef.contains(s.target)&&i.menuListRef&&!i.menuListRef.contains(s.target)&&i.blurInput(),i.initialTouchX=0,i.initialTouchY=0)},i.onControlTouchEnd=function(s){i.userIsDragging||i.onControlMouseDown(s)},i.onClearIndicatorTouchEnd=function(s){i.userIsDragging||i.onClearIndicatorMouseDown(s)},i.onDropdownIndicatorTouchEnd=function(s){i.userIsDragging||i.onDropdownIndicatorMouseDown(s)},i.handleInputChange=function(s){var u=i.props.inputValue,l=s.currentTarget.value;i.setState({inputIsHiddenAfterUpdate:!1}),i.onInputChange(l,{action:"input-change",prevInputValue:u}),i.props.menuIsOpen||i.onMenuOpen()},i.onInputFocus=function(s){i.props.onFocus&&i.props.onFocus(s),i.setState({inputIsHiddenAfterUpdate:!1,isFocused:!0}),(i.openAfterFocus||i.props.openMenuOnFocus)&&i.openMenu("first"),i.openAfterFocus=!1},i.onInputBlur=function(s){var u=i.props.inputValue;if(i.menuListRef&&i.menuListRef.contains(document.activeElement)){i.inputRef.focus();return}i.props.onBlur&&i.props.onBlur(s),i.onInputChange("",{action:"input-blur",prevInputValue:u}),i.onMenuClose(),i.setState({focusedValue:null,isFocused:!1})},i.onOptionHover=function(s){i.blockOptionHover||i.state.focusedOption===s||i.setState({focusedOption:s})},i.shouldHideSelectedOptions=function(){return zY(i.props)},i.onValueInputFocus=function(s){s.preventDefault(),s.stopPropagation(),i.focus()},i.onKeyDown=function(s){var u=i.props,l=u.isMulti,c=u.backspaceRemovesValue,d=u.escapeClearsValue,f=u.inputValue,p=u.isClearable,v=u.isDisabled,h=u.menuIsOpen,m=u.onKeyDown,g=u.tabSelectsValue,y=u.openMenuOnFocus,b=i.state,S=b.focusedOption,x=b.focusedValue,C=b.selectValue;if(!v&&!(typeof m=="function"&&(m(s),s.defaultPrevented))){switch(i.blockOptionHover=!0,s.key){case"ArrowLeft":if(!l||f)return;i.focusValue("previous");break;case"ArrowRight":if(!l||f)return;i.focusValue("next");break;case"Delete":case"Backspace":if(f)return;if(x)i.removeValue(x);else{if(!c)return;l?i.popValue():p&&i.clearValue()}break;case"Tab":if(i.isComposing||s.shiftKey||!h||!g||!S||y&&i.isOptionSelected(S,C))return;i.selectOption(S);break;case"Enter":if(s.keyCode===229)break;if(h){if(!S||i.isComposing)return;i.selectOption(S);break}return;case"Escape":h?(i.setState({inputIsHiddenAfterUpdate:!1}),i.onInputChange("",{action:"menu-close",prevInputValue:f}),i.onMenuClose()):p&&d&&i.clearValue();break;case" ":if(f)return;if(!h){i.openMenu("first");break}if(!S)return;i.selectOption(S);break;case"ArrowUp":h?i.focusOption("up"):i.openMenu("last");break;case"ArrowDown":h?i.focusOption("down"):i.openMenu("first");break;case"PageUp":if(!h)return;i.focusOption("pageup");break;case"PageDown":if(!h)return;i.focusOption("pagedown");break;case"Home":if(!h)return;i.focusOption("first");break;case"End":if(!h)return;i.focusOption("last");break;default:return}s.preventDefault()}},i.instancePrefix="react-select-"+(i.props.instanceId||++ube),i.state.selectValue=y8(n.value),n.menuIsOpen&&i.state.selectValue.length){var a=i.buildFocusableOptions(),o=a.indexOf(i.state.selectValue[0]);i.state.focusedOption=a[o]}return i}return qge(r,[{key:"componentDidMount",value:function(){this.startListeningComposition(),this.startListeningToTouch(),this.props.closeMenuOnScroll&&document&&document.addEventListener&&document.addEventListener("scroll",this.onScroll,!0),this.props.autoFocus&&this.focusInput(),this.props.menuIsOpen&&this.state.focusedOption&&this.menuListRef&&this.focusedOptionRef&&b8(this.menuListRef,this.focusedOptionRef)}},{key:"componentDidUpdate",value:function(i){var a=this.props,o=a.isDisabled,s=a.menuIsOpen,u=this.state.isFocused;(u&&!o&&i.isDisabled||u&&s&&!i.menuIsOpen)&&this.focusInput(),u&&o&&!i.isDisabled?this.setState({isFocused:!1},this.onMenuClose):!u&&!o&&i.isDisabled&&this.inputRef===document.activeElement&&this.setState({isFocused:!0}),this.menuListRef&&this.focusedOptionRef&&this.scrollToFocusedOptionOnUpdate&&(b8(this.menuListRef,this.focusedOptionRef),this.scrollToFocusedOptionOnUpdate=!1)}},{key:"componentWillUnmount",value:function(){this.stopListeningComposition(),this.stopListeningToTouch(),document.removeEventListener("scroll",this.onScroll,!0)}},{key:"onMenuOpen",value:function(){this.props.onMenuOpen()}},{key:"onMenuClose",value:function(){this.onInputChange("",{action:"menu-close",prevInputValue:this.props.inputValue}),this.props.onMenuClose()}},{key:"onInputChange",value:function(i,a){this.props.onInputChange(i,a)}},{key:"focusInput",value:function(){this.inputRef&&this.inputRef.focus()}},{key:"blurInput",value:function(){this.inputRef&&this.inputRef.blur()}},{key:"openMenu",value:function(i){var a=this,o=this.state,s=o.selectValue,u=o.isFocused,l=this.buildFocusableOptions(),c=i==="first"?0:l.length-1;if(!this.props.isMulti){var d=l.indexOf(s[0]);d>-1&&(c=d)}this.scrollToFocusedOptionOnUpdate=!(u&&this.menuListRef),this.setState({inputIsHiddenAfterUpdate:!1,focusedValue:null,focusedOption:l[c]},function(){return a.onMenuOpen()})}},{key:"focusValue",value:function(i){var a=this.state,o=a.selectValue,s=a.focusedValue;if(this.props.isMulti){this.setState({focusedOption:null});var u=o.indexOf(s);s||(u=-1);var l=o.length-1,c=-1;if(o.length){switch(i){case"previous":u===0?c=0:u===-1?c=l:c=u-1;break;case"next":u>-1&&u<l&&(c=u+1);break}this.setState({inputIsHidden:c!==-1,focusedValue:o[c]})}}}},{key:"focusOption",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"first",a=this.props.pageSize,o=this.state.focusedOption,s=this.getFocusableOptions();if(s.length){var u=0,l=s.indexOf(o);o||(l=-1),i==="up"?u=l>0?l-1:s.length-1:i==="down"?u=(l+1)%s.length:i==="pageup"?(u=l-a,u<0&&(u=0)):i==="pagedown"?(u=l+a,u>s.length-1&&(u=s.length-1)):i==="last"&&(u=s.length-1),this.scrollToFocusedOptionOnUpdate=!0,this.setState({focusedOption:s[u],focusedValue:null})}}},{key:"getTheme",value:function(){return this.props.theme?typeof this.props.theme=="function"?this.props.theme(DP):vr(vr({},DP),this.props.theme):DP}},{key:"getCommonProps",value:function(){var i=this.clearValue,a=this.cx,o=this.getStyles,s=this.getClassNames,u=this.getValue,l=this.selectOption,c=this.setValue,d=this.props,f=d.isMulti,p=d.isRtl,v=d.options,h=this.hasValue();return{clearValue:i,cx:a,getStyles:o,getClassNames:s,getValue:u,hasValue:h,isMulti:f,isRtl:p,options:v,selectOption:l,selectProps:d,setValue:c,theme:this.getTheme()}}},{key:"hasValue",value:function(){var i=this.state.selectValue;return i.length>0}},{key:"hasOptions",value:function(){return!!this.getFocusableOptions().length}},{key:"isClearable",value:function(){var i=this.props,a=i.isClearable,o=i.isMulti;return a===void 0?o:a}},{key:"isOptionDisabled",value:function(i,a){return BY(this.props,i,a)}},{key:"isOptionSelected",value:function(i,a){return UY(this.props,i,a)}},{key:"filterOption",value:function(i,a){return jY(this.props,i,a)}},{key:"formatOptionLabel",value:function(i,a){if(typeof this.props.formatOptionLabel=="function"){var o=this.props.inputValue,s=this.state.selectValue;return this.props.formatOptionLabel(i,{context:a,inputValue:o,selectValue:s})}else return this.getOptionLabel(i)}},{key:"formatGroupLabel",value:function(i){return this.props.formatGroupLabel(i)}},{key:"startListeningComposition",value:function(){document&&document.addEventListener&&(document.addEventListener("compositionstart",this.onCompositionStart,!1),document.addEventListener("compositionend",this.onCompositionEnd,!1))}},{key:"stopListeningComposition",value:function(){document&&document.removeEventListener&&(document.removeEventListener("compositionstart",this.onCompositionStart),document.removeEventListener("compositionend",this.onCompositionEnd))}},{key:"startListeningToTouch",value:function(){document&&document.addEventListener&&(document.addEventListener("touchstart",this.onTouchStart,!1),document.addEventListener("touchmove",this.onTouchMove,!1),document.addEventListener("touchend",this.onTouchEnd,!1))}},{key:"stopListeningToTouch",value:function(){document&&document.removeEventListener&&(document.removeEventListener("touchstart",this.onTouchStart),document.removeEventListener("touchmove",this.onTouchMove),document.removeEventListener("touchend",this.onTouchEnd))}},{key:"renderInput",value:function(){var i=this.props,a=i.isDisabled,o=i.isSearchable,s=i.inputId,u=i.inputValue,l=i.tabIndex,c=i.form,d=i.menuIsOpen,f=i.required,p=this.getComponents(),v=p.Input,h=this.state,m=h.inputIsHidden,g=h.ariaSelection,y=this.commonProps,b=s||this.getElementId("input"),S=vr(vr(vr({"aria-autocomplete":"list","aria-expanded":d,"aria-haspopup":!0,"aria-errormessage":this.props["aria-errormessage"],"aria-invalid":this.props["aria-invalid"],"aria-label":this.props["aria-label"],"aria-labelledby":this.props["aria-labelledby"],"aria-required":f,role:"combobox"},d&&{"aria-controls":this.getElementId("listbox"),"aria-owns":this.getElementId("listbox")}),!o&&{"aria-readonly":!0}),this.hasValue()?(g==null?void 0:g.action)==="initial-input-focus"&&{"aria-describedby":this.getElementId("live-region")}:{"aria-describedby":this.getElementId("placeholder")});return o?_e.createElement(v,pr({},y,{autoCapitalize:"none",autoComplete:"off",autoCorrect:"off",id:b,innerRef:this.getInputRef,isDisabled:a,isHidden:m,onBlur:this.onInputBlur,onChange:this.handleInputChange,onFocus:this.onInputFocus,spellCheck:"false",tabIndex:l,form:c,type:"text",value:u},S)):_e.createElement(B1e,pr({id:b,innerRef:this.getInputRef,onBlur:this.onInputBlur,onChange:ZC,onFocus:this.onInputFocus,disabled:a,tabIndex:l,inputMode:"none",form:c,value:""},S))}},{key:"renderPlaceholderOrValue",value:function(){var i=this,a=this.getComponents(),o=a.MultiValue,s=a.MultiValueContainer,u=a.MultiValueLabel,l=a.MultiValueRemove,c=a.SingleValue,d=a.Placeholder,f=this.commonProps,p=this.props,v=p.controlShouldRenderValue,h=p.isDisabled,m=p.isMulti,g=p.inputValue,y=p.placeholder,b=this.state,S=b.selectValue,x=b.focusedValue,C=b.isFocused;if(!this.hasValue()||!v)return g?null:_e.createElement(d,pr({},f,{key:"placeholder",isDisabled:h,isFocused:C,innerProps:{id:this.getElementId("placeholder")}}),y);if(m)return S.map(function(A,M){var D=A===x,k="".concat(i.getOptionLabel(A),"-").concat(i.getOptionValue(A));return _e.createElement(o,pr({},f,{components:{Container:s,Label:u,Remove:l},isFocused:D,isDisabled:h,key:k,index:M,removeProps:{onClick:function(){return i.removeValue(A)},onTouchEnd:function(){return i.removeValue(A)},onMouseDown:function(O){O.preventDefault()}},data:A}),i.formatOptionLabel(A,"value"))});if(g)return null;var w=S[0];return _e.createElement(c,pr({},f,{data:w,isDisabled:h}),this.formatOptionLabel(w,"value"))}},{key:"renderClearIndicator",value:function(){var i=this.getComponents(),a=i.ClearIndicator,o=this.commonProps,s=this.props,u=s.isDisabled,l=s.isLoading,c=this.state.isFocused;if(!this.isClearable()||!a||u||!this.hasValue()||l)return null;var d={onMouseDown:this.onClearIndicatorMouseDown,onTouchEnd:this.onClearIndicatorTouchEnd,"aria-hidden":"true"};return _e.createElement(a,pr({},o,{innerProps:d,isFocused:c}))}},{key:"renderLoadingIndicator",value:function(){var i=this.getComponents(),a=i.LoadingIndicator,o=this.commonProps,s=this.props,u=s.isDisabled,l=s.isLoading,c=this.state.isFocused;if(!a||!l)return null;var d={"aria-hidden":"true"};return _e.createElement(a,pr({},o,{innerProps:d,isDisabled:u,isFocused:c}))}},{key:"renderIndicatorSeparator",value:function(){var i=this.getComponents(),a=i.DropdownIndicator,o=i.IndicatorSeparator;if(!a||!o)return null;var s=this.commonProps,u=this.props.isDisabled,l=this.state.isFocused;return _e.createElement(o,pr({},s,{isDisabled:u,isFocused:l}))}},{key:"renderDropdownIndicator",value:function(){var i=this.getComponents(),a=i.DropdownIndicator;if(!a)return null;var o=this.commonProps,s=this.props.isDisabled,u=this.state.isFocused,l={onMouseDown:this.onDropdownIndicatorMouseDown,onTouchEnd:this.onDropdownIndicatorTouchEnd,"aria-hidden":"true"};return _e.createElement(a,pr({},o,{innerProps:l,isDisabled:s,isFocused:u}))}},{key:"renderMenu",value:function(){var i=this,a=this.getComponents(),o=a.Group,s=a.GroupHeading,u=a.Menu,l=a.MenuList,c=a.MenuPortal,d=a.LoadingMessage,f=a.NoOptionsMessage,p=a.Option,v=this.commonProps,h=this.state.focusedOption,m=this.props,g=m.captureMenuScroll,y=m.inputValue,b=m.isLoading,S=m.loadingMessage,x=m.minMenuHeight,C=m.maxMenuHeight,w=m.menuIsOpen,A=m.menuPlacement,M=m.menuPosition,D=m.menuPortalTarget,k=m.menuShouldBlockScroll,R=m.menuShouldScrollIntoView,O=m.noOptionsMessage,H=m.onMenuScrollToTop,B=m.onMenuScrollToBottom;if(!w)return null;var j=function(W,X){var U=W.type,z=W.data,J=W.isDisabled,K=W.isSelected,Z=W.label,te=W.value,le=h===z,ye=J?void 0:function(){return i.onOptionHover(z)},be=J?void 0:function(){return i.selectOption(z)},Ae="".concat(i.getElementId("option"),"-").concat(X),Se={id:Ae,onClick:be,onMouseMove:ye,onMouseOver:ye,tabIndex:-1};return _e.createElement(p,pr({},v,{innerProps:Se,data:z,isDisabled:J,isSelected:K,key:Ae,label:Z,type:U,value:te,isFocused:le,innerRef:le?i.getFocusedOptionRef:void 0}),i.formatOptionLabel(W.data,"menu"))},Y;if(this.hasOptions())Y=this.getCategorizedOptions().map(function(fe){if(fe.type==="group"){var W=fe.data,X=fe.options,U=fe.index,z="".concat(i.getElementId("group"),"-").concat(U),J="".concat(z,"-heading");return _e.createElement(o,pr({},v,{key:z,data:W,options:X,Heading:s,headingProps:{id:J,data:fe.data},label:i.formatGroupLabel(fe.data)}),fe.options.map(function(K){return j(K,"".concat(U,"-").concat(K.index))}))}else if(fe.type==="option")return j(fe,"".concat(fe.index))});else if(b){var G=S({inputValue:y});if(G===null)return null;Y=_e.createElement(d,v,G)}else{var $=O({inputValue:y});if($===null)return null;Y=_e.createElement(f,v,$)}var q={minMenuHeight:x,maxMenuHeight:C,menuPlacement:A,menuPosition:M,menuShouldScrollIntoView:R},ee=_e.createElement(xye,pr({},v,q),function(fe){var W=fe.ref,X=fe.placerProps,U=X.placement,z=X.maxHeight;return _e.createElement(u,pr({},v,q,{innerRef:W,innerProps:{onMouseDown:i.onMenuMouseDown,onMouseMove:i.onMenuMouseMove,id:i.getElementId("listbox")},isLoading:b,placement:U}),_e.createElement(G1e,{captureEnabled:g,onTopArrive:H,onBottomArrive:B,lockEnabled:k},function(J){return _e.createElement(l,pr({},v,{innerRef:function(Z){i.getMenuListRef(Z),J(Z)},isLoading:b,maxHeight:z,focusedOption:h}),Y)}))});return D||M==="fixed"?_e.createElement(c,pr({},v,{appendTo:D,controlElement:this.controlRef,menuPlacement:A,menuPosition:M}),ee):ee}},{key:"renderFormField",value:function(){var i=this,a=this.props,o=a.delimiter,s=a.isDisabled,u=a.isMulti,l=a.name,c=a.required,d=this.state.selectValue;if(c&&!this.hasValue()&&!s)return _e.createElement(W1e,{name:l,onFocus:this.onValueInputFocus});if(!(!l||s))if(u)if(o){var f=d.map(function(h){return i.getOptionValue(h)}).join(o);return _e.createElement("input",{name:l,type:"hidden",value:f})}else{var p=d.length>0?d.map(function(h,m){return _e.createElement("input",{key:"i-".concat(m),name:l,type:"hidden",value:i.getOptionValue(h)})}):_e.createElement("input",{name:l,type:"hidden",value:""});return _e.createElement("div",null,p)}else{var v=d[0]?this.getOptionValue(d[0]):"";return _e.createElement("input",{name:l,type:"hidden",value:v})}}},{key:"renderLiveRegion",value:function(){var i=this.commonProps,a=this.state,o=a.ariaSelection,s=a.focusedOption,u=a.focusedValue,l=a.isFocused,c=a.selectValue,d=this.getFocusableOptions();return _e.createElement(R1e,pr({},i,{id:this.getElementId("live-region"),ariaSelection:o,focusedOption:s,focusedValue:u,isFocused:l,selectValue:c,focusableOptions:d}))}},{key:"render",value:function(){var i=this.getComponents(),a=i.Control,o=i.IndicatorsContainer,s=i.SelectContainer,u=i.ValueContainer,l=this.props,c=l.className,d=l.id,f=l.isDisabled,p=l.menuIsOpen,v=this.state.isFocused,h=this.commonProps=this.getCommonProps();return _e.createElement(s,pr({},h,{className:c,innerProps:{id:d,onKeyDown:this.onKeyDown},isDisabled:f,isFocused:v}),this.renderLiveRegion(),_e.createElement(a,pr({},h,{innerRef:this.getControlRef,innerProps:{onMouseDown:this.onControlMouseDown,onTouchEnd:this.onControlTouchEnd},isDisabled:f,isFocused:v,menuIsOpen:p}),_e.createElement(u,pr({},h,{isDisabled:f}),this.renderPlaceholderOrValue(),this.renderInput()),_e.createElement(o,pr({},h,{isDisabled:f}),this.renderClearIndicator(),this.renderLoadingIndicator(),this.renderIndicatorSeparator(),this.renderDropdownIndicator())),this.renderMenu(),this.renderFormField())}}],[{key:"getDerivedStateFromProps",value:function(i,a){var o=a.prevProps,s=a.clearFocusValueOnUpdate,u=a.inputIsHiddenAfterUpdate,l=a.ariaSelection,c=a.isFocused,d=a.prevWasFocused,f=i.options,p=i.value,v=i.menuIsOpen,h=i.inputValue,m=i.isMulti,g=y8(p),y={};if(o&&(p!==o.value||f!==o.options||v!==o.menuIsOpen||h!==o.inputValue)){var b=v?abe(i,g):[],S=s?obe(a,g):null,x=sbe(a,b);y={selectValue:g,focusedOption:x,focusedValue:S,clearFocusValueOnUpdate:!1}}var C=u!=null&&i!==o?{inputIsHidden:u,inputIsHiddenAfterUpdate:void 0}:{},w=l,A=c&&d;return c&&!A&&(w={value:nx(m,g,g[0]||null),options:g,action:"initial-input-focus"},A=!d),(l==null?void 0:l.action)==="initial-input-focus"&&(w=null),vr(vr(vr({},y),C),{},{prevProps:i,ariaSelection:w,prevWasFocused:A})}}]),r}(_e.Component);VY.defaultProps=ibe;var lbe=_e.forwardRef(function(e,t){var r=Hge(e);return _e.createElement(VY,pr({ref:t},r))}),O8=lbe;const cbe=({onApply:e,onClose:t})=>{const r=rv(h=>h.appState.searchFilters),n=rv(h=>h.appState.searchFacets),[i,a]=_e.useState(r),[o,s]=_e.useState(""),u=()=>{if(i.sequenceLengthMin){const h=Number(i.sequenceLengthMin);if(!Number.isInteger(h)||h<0)return s("Sequence length must be positive integer value"),!0}if(i.sequenceLengthMax){const h=Number(i.sequenceLengthMax);if(!Number.isInteger(h)||h<0)return s("Sequence length must be positive integer value"),!0}if(i.sequenceLengthMin&&i.sequenceLengthMax){const h=Number(i.sequenceLengthMin);if(Number(i.sequenceLengthMax)<h)return s("Sequence length maximum value must be larger than minimum value"),!0}return i.sequenceLengthMin&&!i.sequenceLengthMax||!i.sequenceLengthMin&&i.sequenceLengthMax?(s("Both or none of min and max sequence length values must be populated"),!0):(s(""),!1)},l=_e.useMemo(()=>u(),[i]),c={geneName:"",organism:[],sequenceLengthMin:"",sequenceLengthMax:"",annotationScore:"",proteinWith:[]},d=()=>{a(c),e(c),t()},f=()=>{e(i),t()},p=(h,m)=>{const g=h.map(y=>y.value);a({...i,organism:g})},v=(h,m)=>{const g=h.map(y=>y.value);a({...i,proteinWith:g})};return P.jsxs("div",{className:"search-filters-wrapper",children:[P.jsx("div",{className:"search-filters-title",children:"Filters"}),P.jsxs("div",{className:"search-filter-input-wrapper",children:[P.jsx("label",{htmlFor:"gene-name",className:"search-filters-label",children:"Gene Name"}),P.jsx("input",{type:"text",className:"search-filter-input",name:"gene-name",id:"gene-name",placeholder:"Enter Gene Name",value:i.geneName,onChange:h=>{a({...i,geneName:h.target.value})}})]}),P.jsxs("div",{className:"search-filter-input-wrapper",children:[P.jsx("label",{htmlFor:"organism",className:"search-filters-label",children:"Organisms"}),P.jsx(O8,{name:"organism",className:"search-filter-input-wrapper",isMulti:!0,options:n.organisms,defaultValue:n.organisms.filter(h=>i.organism.some(m=>m===h.value)),classNamePrefix:"search-filter-react-select",onChange:p,styles:{control:h=>({...h,backgroundColor:"#f5f5f5",textAlign:"left",fontWeight:400,fontSize:"14px",color:"#6c6c6c"})}})]}),P.jsxs("div",{className:"search-filter-input-wrapper",children:[P.jsx("label",{htmlFor:"sequence-min",className:"search-filters-label",children:"Sequence Length"}),P.jsxs("div",{className:"search-filter-input-row-wrapper",children:[P.jsx("input",{type:"text",className:"search-filter-input",name:"sequence-min",id:"sequence-min",placeholder:"From",value:i.sequenceLengthMin,onChange:h=>{a({...i,sequenceLengthMin:h.target.value})}}),P.jsx("span",{className:"search-filter-dash",children:""}),P.jsx("input",{type:"text",className:"search-filter-input",name:"sequence-max",id:"sequence-max",placeholder:"To",value:i.sequenceLengthMax,onChange:h=>{a({...i,sequenceLengthMax:h.target.value})}})]})]}),P.jsxs("div",{className:"search-filter-input-wrapper",children:[P.jsx("label",{htmlFor:"annotation-score",className:"search-filters-label",children:"Annotation Score"}),P.jsxs("select",{className:"search-filter-input",name:"annotation-score",id:"annotation-score",placeholder:"Select an option",value:i.annotationScore,onChange:h=>{a({...i,annotationScore:h.target.value})},children:[P.jsx("option",{value:""}),P.jsx("option",{value:"5",children:"5"}),P.jsx("option",{value:"4",children:"4"}),P.jsx("option",{value:"3",children:"3"}),P.jsx("option",{value:"2",children:"2"}),P.jsx("option",{value:"1",children:"1"})]})]}),P.jsxs("div",{className:"search-filter-input-wrapper",children:[P.jsx("label",{htmlFor:"protein-with",className:"search-filters-label",children:"Proteins With"}),P.jsx(O8,{name:"protein-with",className:"search-filter-input-wrapper",isMulti:!0,options:n.proteinsWith,defaultValue:n.proteinsWith.filter(h=>i.proteinWith.some(m=>m===h.value)),classNamePrefix:"search-filter-react-select",onChange:v,styles:{control:h=>({...h,backgroundColor:"#f5f5f5",textAlign:"left",fontWeight:400,fontSize:"14px",color:"#6c6c6c"})}})]}),P.jsx("div",{className:"search-filter-error-message",children:o}),P.jsxs("div",{className:"search-filter-input-row-wrapper",children:[P.jsx("button",{className:"form-button",onClick:d,children:"Clear"}),P.jsx("button",{className:"form-button",disabled:l,onClick:f,children:"Apply Filters"})]})]})},dbe=()=>P.jsx("div",{className:"search-results-wrapper",children:P.jsxs("div",{className:"search-results-nodata-wrapper",children:[P.jsx("span",{className:"search-results-text",children:"No data to display"}),P.jsx("span",{className:"search-results-text",children:"Please start search to display results"})]})}),fbe=()=>{const e=vd(),t=N3(),r=rv(y=>y.appState.searchResults),n=rv(y=>y.appState.searchFilters),[i,a]=_e.useState(""),[o,s]=_e.useState(!1),[u]=hhe(),[l,c]=_e.useState(!1);_e.useEffect(()=>{var S,x;const y=u.get("query"),b={geneName:u.get("geneName")||"",organism:((S=u.get("organism"))==null?void 0:S.split(","))||[],sequenceLengthMin:u.get("sequenceLengthMin")||"",sequenceLengthMax:u.get("sequenceLengthMax")||"",annotationScore:u.get("annotationScore")||"",proteinWith:((x=u.get("proteinWith"))==null?void 0:x.split(","))||[]};y&&(s(!0),a(decodeURIComponent(y)),t(Oge(y,b)).finally(()=>{s(!1)}))},[u,t]);const d=y=>{const b=new URLSearchParams;let S="/search";i?b.append("query",encodeURIComponent(i)):b.append("query",encodeURIComponent("*"));let x=`${S}?${b.toString()}`;y&&(x=`${x}&${y}`),e(x)},f=()=>{m(n)},p=y=>{y.key==="Enter"&&m(n)},v=()=>o?P.jsx(B3,{}):r.items.length===0?P.jsx(dbe,{}):P.jsxs(P.Fragment,{children:[P.jsxs("div",{className:"search-results-count",children:[r.totalResults,` Search Results for "${decodeURIComponent(r.searchString)}"`]}),P.jsx(Bge,{})]}),h=()=>{c(!l)},m=y=>{const b=Object.entries(y).filter(([S,x])=>Array.isArray(x)?x.length>0:S&&x).map(([S,x])=>Array.isArray(x)?`${encodeURIComponent(S)}=${encodeURIComponent(x.join(","))}`:`${encodeURIComponent(S)}=${encodeURIComponent(x)}`).join("&");d(b)},g=y=>Object.values(y).some(b=>Array.isArray(b)?b.length>0:b!=="");return P.jsxs(P.Fragment,{children:[P.jsx(Kk,{}),P.jsxs("div",{className:"search-wrapper",children:[P.jsx("input",{type:"text",className:"search-input form-text-input",placeholder:"Enter search value",value:i,onChange:y=>a(y.target.value),onKeyDown:p}),P.jsx("button",{className:"search-button-search search-button",onClick:f,children:"Search"}),P.jsxs("button",{className:"search-button-filters search-button"+(l?" search-filters-popup-opened":""),onClick:h,children:[P.jsx("svg",{width:"22px",height:"18px",viewBox:"0 0 22 18",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:P.jsx("path",{d:"M7.2 10.8C8.87744 10.8 10.2869 11.9473 10.6866 13.5H20.7C21.197 13.5 21.6 13.903 21.6 14.4C21.6 14.8419 21.2816 15.2093 20.8618 15.2854L20.7 15.3L10.6861 15.3018C10.2858 16.8536 8.87679 18 7.2 18C5.52321 18 4.11417 16.8536 3.71389 15.3018L0.9 15.3C0.402948 15.3 0 14.897 0 14.4C0 13.9581 0.318384 13.5907 0.738216 13.5146L0.9 13.5H3.71342C4.11307 11.9473 5.52256 10.8 7.2 10.8ZM7.2 12.6C6.2059 12.6 5.4 13.4059 5.4 14.4C5.4 15.3941 6.2059 16.2 7.2 16.2C8.1941 16.2 9 15.3941 9 14.4C9 13.4059 8.1941 12.6 7.2 12.6ZM14.4 0C16.0774 0 17.487 1.14728 17.8866 2.69996L20.7 2.7C21.197 2.7 21.6 3.10295 21.6 3.6C21.6 4.04183 21.2816 4.4093 20.8618 4.48549L20.7 4.5L17.8861 4.50184C17.4859 6.05362 16.0769 7.2 14.4 7.2C12.7232 7.2 11.3142 6.05362 10.9139 4.50184L0.9 4.5C0.402948 4.5 0 4.09705 0 3.6C0 3.15817 0.318384 2.7907 0.738216 2.71451L0.9 2.7L10.9134 2.69996C11.3131 1.14728 12.7226 0 14.4 0ZM14.4 1.8C13.4059 1.8 12.6 2.6059 12.6 3.6C12.6 4.5941 13.4059 5.4 14.4 5.4C15.3941 5.4 16.2 4.5941 16.2 3.6C16.2 2.6059 15.3941 1.8 14.4 1.8Z"})}),g(n)&&P.jsx("div",{className:"search-filter-alert"})]})]}),l&&P.jsx("div",{className:"search-filters-popup",children:P.jsx(cbe,{onClose:h,onApply:m})}),v()]})},pbe=({proteinData:e})=>P.jsxs("div",{className:"protein-common-wrapper",children:[P.jsxs("div",{className:"protein-header-wrapper",children:[P.jsxs("div",{className:"protein-header",children:[e.id," / ",e.uniProtkbId]}),P.jsx("div",{className:"protein-organism","data-organism":e.organism,children:e.organism})]}),P.jsxs("div",{className:"protein-property",children:[P.jsx("div",{className:"protein-title",children:"Protein"}),P.jsx("div",{className:"protein-text",children:e.description})]}),P.jsxs("div",{className:"protein-property",children:[P.jsx("div",{className:"protein-title",children:"Gene"}),P.jsx("div",{className:"protein-text",children:e.gene})]})]});/*! clipboard-copy. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */var hbe=gbe;function CO(){return new DOMException("The request is not allowed","NotAllowedError")}async function vbe(e){if(!navigator.clipboard)throw CO();return navigator.clipboard.writeText(e)}async function mbe(e){const t=document.createElement("span");t.textContent=e,t.style.whiteSpace="pre",t.style.webkitUserSelect="auto",t.style.userSelect="all",document.body.appendChild(t);const r=window.getSelection(),n=window.document.createRange();r.removeAllRanges(),n.selectNode(t),r.addRange(n);let i=!1;try{i=window.document.execCommand("copy")}finally{r.removeAllRanges(),window.document.body.removeChild(t)}if(!i)throw CO()}async function gbe(e){try{await vbe(e)}catch(t){try{await mbe(e)}catch(r){throw r||t||CO()}}}const ybe=$G(hbe),L8=({proteinData:e})=>{const[t,r]=_e.useState(" Copy"),n=()=>{ybe(e.sequence),r(" Copied!"),setTimeout(()=>r(" Copy"),2e3)};return P.jsxs("div",{className:"protein-details-wrapper",children:[P.jsx("div",{className:"protein-details-title",children:"Sequence"}),P.jsx("table",{className:"protein-property-table",children:P.jsxs("tbody",{children:[P.jsxs("tr",{children:[P.jsx("td",{children:P.jsxs("div",{className:"protein-property",children:[P.jsx("div",{className:"protein-title",children:"Length"}),P.jsx("div",{className:"protein-text",children:e.length})]})}),P.jsx("td",{children:P.jsxs("div",{className:"protein-property",children:[P.jsx("div",{className:"protein-title",children:"Last Updated"}),P.jsx("div",{className:"protein-text",children:e.lastUpdated})]})})]}),P.jsxs("tr",{children:[P.jsx("td",{children:P.jsxs("div",{className:"protein-property",children:[P.jsx("div",{className:"protein-title",children:"Mass (Da)"}),P.jsx("div",{className:"protein-text",children:e.molWeight})]})}),P.jsx("td",{children:P.jsxs("div",{className:"protein-property",children:[P.jsx("div",{className:"protein-title",children:"Checksum"}),P.jsx("div",{className:"protein-text",children:e.checksum})]})})]})]})}),P.jsx("div",{className:"protein-sequence-button-copy",children:P.jsxs("div",{className:"protein-sequence-button-copy-clickable",onClick:n,children:[P.jsx("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:P.jsx("path",{d:"M0 1.6C0 1.17565 0.168571 0.768687 0.468629 0.468629C0.768687 0.168571 1.17565 0 1.6 0H9.6C10.0243 0 10.4313 0.168571 10.7314 0.468629C11.0314 0.768687 11.2 1.17565 11.2 1.6V4.8H14.4C14.8243 4.8 15.2313 4.96857 15.5314 5.26863C15.8314 5.56869 16 5.97565 16 6.4V14.4C16 14.8243 15.8314 15.2313 15.5314 15.5314C15.2313 15.8314 14.8243 16 14.4 16H6.4C5.97565 16 5.56869 15.8314 5.26863 15.5314C4.96857 15.2313 4.8 14.8243 4.8 14.4V11.2H1.6C1.17565 11.2 0.768687 11.0314 0.468629 10.7314C0.168571 10.4313 0 10.0243 0 9.6V1.6ZM6.4 11.2V14.4H14.4V6.4H11.2V9.6C11.2 10.0243 11.0314 10.4313 10.7314 10.7314C10.4313 11.0314 10.0243 11.2 9.6 11.2H6.4ZM9.6 9.6V1.6H1.6V9.6H9.6Z",fill:"#0D0D0D"})}),t]})}),P.jsx("div",{className:"protein-sequence",children:e.sequence})]})};/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */const F8=typeof window<"u"&&window.customElements!=null&&window.customElements.polyfillWrapFlushCallback!==void 0,bbe=(e,t,r=null,n=null)=>{for(;t!==r;){const i=t.nextSibling;e.insertBefore(t,n),t=i}},_O=(e,t,r=null)=>{for(;t!==r;){const n=t.nextSibling;e.removeChild(t),t=n}};/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */const kc=`{{lit-${String(Math.random()).slice(2)}}}`,HY=`<!--${kc}-->`,N8=new RegExp(`${kc}|${HY}`),Ny="$lit$";class GY{constructor(t,r){this.parts=[],this.element=r;const n=[],i=[],a=document.createTreeWalker(r.content,133,null,!1);let o=0,s=-1,u=0;const{strings:l,values:{length:c}}=t;for(;u<c;){const d=a.nextNode();if(d===null){a.currentNode=i.pop();continue}if(s++,d.nodeType===1){if(d.hasAttributes()){const f=d.attributes,{length:p}=f;let v=0;for(let h=0;h<p;h++)B8(f[h].name,Ny)&&v++;for(;v-- >0;){const h=l[u],m=UM.exec(h)[2],g=m.toLowerCase()+Ny,y=d.getAttribute(g);d.removeAttribute(g);const b=y.split(N8);this.parts.push({type:"attribute",index:s,name:m,strings:b}),u+=b.length-1}}d.tagName==="TEMPLATE"&&(i.push(d),a.currentNode=d.content)}else if(d.nodeType===3){const f=d.data;if(f.indexOf(kc)>=0){const p=d.parentNode,v=f.split(N8),h=v.length-1;for(let m=0;m<h;m++){let g,y=v[m];if(y==="")g=yf();else{const b=UM.exec(y);b!==null&&B8(b[2],Ny)&&(y=y.slice(0,b.index)+b[1]+b[2].slice(0,-Ny.length)+b[3]),g=document.createTextNode(y)}p.insertBefore(g,d),this.parts.push({type:"node",index:++s})}v[h]===""?(p.insertBefore(yf(),d),n.push(d)):d.data=v[h],u+=h}}else if(d.nodeType===8)if(d.data===kc){const f=d.parentNode;(d.previousSibling===null||s===o)&&(s++,f.insertBefore(yf(),d)),o=s,this.parts.push({type:"node",index:s}),d.nextSibling===null?d.data="":(n.push(d),s--),u++}else{let f=-1;for(;(f=d.data.indexOf(kc,f+1))!==-1;)this.parts.push({type:"node",index:-1}),u++}}for(const d of n)d.parentNode.removeChild(d)}}const B8=(e,t)=>{const r=e.length-t.length;return r>=0&&e.slice(r)===t},qY=e=>e.index!==-1,yf=()=>document.createComment(""),UM=/([ \x09\x0a\x0c\x0d])([^\0-\x1F\x7F-\x9F "'>=/]+)([ \x09\x0a\x0c\x0d]*=[ \x09\x0a\x0c\x0d]*(?:[^ \x09\x0a\x0c\x0d"'`<>=]*|"[^"]*|'[^']*))$/;/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */const wO=133;function $Y(e,t){const{element:{content:r},parts:n}=e,i=document.createTreeWalker(r,wO,null,!1);let a=l1(n),o=n[a],s=-1,u=0;const l=[];let c=null;for(;i.nextNode();){s++;const d=i.currentNode;for(d.previousSibling===c&&(c=null),t.has(d)&&(l.push(d),c===null&&(c=d)),c!==null&&u++;o!==void 0&&o.index===s;)o.index=c!==null?-1:o.index-u,a=l1(n,a),o=n[a]}l.forEach(d=>d.parentNode.removeChild(d))}const xbe=e=>{let t=e.nodeType===11?0:1;const r=document.createTreeWalker(e,wO,null,!1);for(;r.nextNode();)t++;return t},l1=(e,t=-1)=>{for(let r=t+1;r<e.length;r++){const n=e[r];if(qY(n))return r}return-1};function Sbe(e,t,r=null){const{element:{content:n},parts:i}=e;if(r==null){n.appendChild(t);return}const a=document.createTreeWalker(n,wO,null,!1);let o=l1(i),s=0,u=-1;for(;a.nextNode();)for(u++,a.currentNode===r&&(s=xbe(t),r.parentNode.insertBefore(t,r));o!==-1&&i[o].index===u;){if(s>0){for(;o!==-1;)i[o].index+=s,o=l1(i,o);return}o=l1(i,o)}}/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */const WY=new WeakMap,Cbe=e=>(...t)=>{const r=e(...t);return WY.set(r,!0),r},ab=e=>typeof e=="function"&&WY.has(e);/**
 * @license
 * Copyright (c) 2018 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */const Au={},U8={};/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class jM{constructor(t,r,n){this.__parts=[],this.template=t,this.processor=r,this.options=n}update(t){let r=0;for(const n of this.__parts)n!==void 0&&n.setValue(t[r]),r++;for(const n of this.__parts)n!==void 0&&n.commit()}_clone(){const t=F8?this.template.element.content.cloneNode(!0):document.importNode(this.template.element.content,!0),r=[],n=this.template.parts,i=document.createTreeWalker(t,133,null,!1);let a=0,o=0,s,u=i.nextNode();for(;a<n.length;){if(s=n[a],!qY(s)){this.__parts.push(void 0),a++;continue}for(;o<s.index;)o++,u.nodeName==="TEMPLATE"&&(r.push(u),i.currentNode=u.content),(u=i.nextNode())===null&&(i.currentNode=r.pop(),u=i.nextNode());if(s.type==="node"){const l=this.processor.handleTextExpression(this.options);l.insertAfterNode(u.previousSibling),this.__parts.push(l)}else this.__parts.push(...this.processor.handleAttributeExpressions(u,s.name,s.strings,this.options));a++}return F8&&(document.adoptNode(t),customElements.upgrade(t)),t}}/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */const j8=window.trustedTypes&&trustedTypes.createPolicy("lit-html",{createHTML:e=>e}),_be=` ${kc} `;class EO{constructor(t,r,n,i){this.strings=t,this.values=r,this.type=n,this.processor=i}getHTML(){const t=this.strings.length-1;let r="",n=!1;for(let i=0;i<t;i++){const a=this.strings[i],o=a.lastIndexOf("<!--");n=(o>-1||n)&&a.indexOf("-->",o+1)===-1;const s=UM.exec(a);s===null?r+=a+(n?_be:HY):r+=a.substr(0,s.index)+s[1]+s[2]+Ny+s[3]+kc}return r+=this.strings[t],r}getTemplateElement(){const t=document.createElement("template");let r=this.getHTML();return j8!==void 0&&(r=j8.createHTML(r)),t.innerHTML=r,t}}class wbe extends EO{getHTML(){return`<svg>${super.getHTML()}</svg>`}getTemplateElement(){const t=super.getTemplateElement(),r=t.content,n=r.firstChild;return r.removeChild(n),bbe(r,n.firstChild),t}}/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */const H3=e=>e===null||!(typeof e=="object"||typeof e=="function"),zM=e=>Array.isArray(e)||!!(e&&e[Symbol.iterator]);class XY{constructor(t,r,n){this.dirty=!0,this.element=t,this.name=r,this.strings=n,this.parts=[];for(let i=0;i<n.length-1;i++)this.parts[i]=this._createPart()}_createPart(){return new YY(this)}_getValue(){const t=this.strings,r=t.length-1,n=this.parts;if(r===1&&t[0]===""&&t[1]===""){const a=n[0].value;if(typeof a=="symbol")return String(a);if(typeof a=="string"||!zM(a))return a}let i="";for(let a=0;a<r;a++){i+=t[a];const o=n[a];if(o!==void 0){const s=o.value;if(H3(s)||!zM(s))i+=typeof s=="string"?s:String(s);else for(const u of s)i+=typeof u=="string"?u:String(u)}}return i+=t[r],i}commit(){this.dirty&&(this.dirty=!1,this.element.setAttribute(this.name,this._getValue()))}}class YY{constructor(t){this.value=void 0,this.committer=t}setValue(t){t!==Au&&(!H3(t)||t!==this.value)&&(this.value=t,ab(t)||(this.committer.dirty=!0))}commit(){for(;ab(this.value);){const t=this.value;this.value=Au,t(this)}this.value!==Au&&this.committer.commit()}}class Kb{constructor(t){this.value=void 0,this.__pendingValue=void 0,this.options=t}appendInto(t){this.startNode=t.appendChild(yf()),this.endNode=t.appendChild(yf())}insertAfterNode(t){this.startNode=t,this.endNode=t.nextSibling}appendIntoPart(t){t.__insert(this.startNode=yf()),t.__insert(this.endNode=yf())}insertAfterPart(t){t.__insert(this.startNode=yf()),this.endNode=t.endNode,t.endNode=this.startNode}setValue(t){this.__pendingValue=t}commit(){if(this.startNode.parentNode===null)return;for(;ab(this.__pendingValue);){const r=this.__pendingValue;this.__pendingValue=Au,r(this)}const t=this.__pendingValue;t!==Au&&(H3(t)?t!==this.value&&this.__commitText(t):t instanceof EO?this.__commitTemplateResult(t):t instanceof Node?this.__commitNode(t):zM(t)?this.__commitIterable(t):t===U8?(this.value=U8,this.clear()):this.__commitText(t))}__insert(t){this.endNode.parentNode.insertBefore(t,this.endNode)}__commitNode(t){this.value!==t&&(this.clear(),this.__insert(t),this.value=t)}__commitText(t){const r=this.startNode.nextSibling;t=t??"";const n=typeof t=="string"?t:String(t);r===this.endNode.previousSibling&&r.nodeType===3?r.data=n:this.__commitNode(document.createTextNode(n)),this.value=t}__commitTemplateResult(t){const r=this.options.templateFactory(t);if(this.value instanceof jM&&this.value.template===r)this.value.update(t.values);else{const n=new jM(r,t.processor,this.options),i=n._clone();n.update(t.values),this.__commitNode(i),this.value=n}}__commitIterable(t){Array.isArray(this.value)||(this.value=[],this.clear());const r=this.value;let n=0,i;for(const a of t)i=r[n],i===void 0&&(i=new Kb(this.options),r.push(i),n===0?i.appendIntoPart(this):i.insertAfterPart(r[n-1])),i.setValue(a),i.commit(),n++;n<r.length&&(r.length=n,this.clear(i&&i.endNode))}clear(t=this.startNode){_O(this.startNode.parentNode,t.nextSibling,this.endNode)}}class Ebe{constructor(t,r,n){if(this.value=void 0,this.__pendingValue=void 0,n.length!==2||n[0]!==""||n[1]!=="")throw new Error("Boolean attributes can only contain a single expression");this.element=t,this.name=r,this.strings=n}setValue(t){this.__pendingValue=t}commit(){for(;ab(this.__pendingValue);){const r=this.__pendingValue;this.__pendingValue=Au,r(this)}if(this.__pendingValue===Au)return;const t=!!this.__pendingValue;this.value!==t&&(t?this.element.setAttribute(this.name,""):this.element.removeAttribute(this.name),this.value=t),this.__pendingValue=Au}}class Abe extends XY{constructor(t,r,n){super(t,r,n),this.single=n.length===2&&n[0]===""&&n[1]===""}_createPart(){return new Pbe(this)}_getValue(){return this.single?this.parts[0].value:super._getValue()}commit(){this.dirty&&(this.dirty=!1,this.element[this.name]=this._getValue())}}class Pbe extends YY{}let KY=!1;(()=>{try{const e={get capture(){return KY=!0,!1}};window.addEventListener("test",e,e),window.removeEventListener("test",e,e)}catch{}})();class Tbe{constructor(t,r,n){this.value=void 0,this.__pendingValue=void 0,this.element=t,this.eventName=r,this.eventContext=n,this.__boundHandleEvent=i=>this.handleEvent(i)}setValue(t){this.__pendingValue=t}commit(){for(;ab(this.__pendingValue);){const a=this.__pendingValue;this.__pendingValue=Au,a(this)}if(this.__pendingValue===Au)return;const t=this.__pendingValue,r=this.value,n=t==null||r!=null&&(t.capture!==r.capture||t.once!==r.once||t.passive!==r.passive),i=t!=null&&(r==null||n);n&&this.element.removeEventListener(this.eventName,this.__boundHandleEvent,this.__options),i&&(this.__options=Ibe(t),this.element.addEventListener(this.eventName,this.__boundHandleEvent,this.__options)),this.value=t,this.__pendingValue=Au}handleEvent(t){typeof this.value=="function"?this.value.call(this.eventContext||this.element,t):this.value.handleEvent(t)}}const Ibe=e=>e&&(KY?{capture:e.capture,passive:e.passive,once:e.once}:e.capture);/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */function Mbe(e){let t=ob.get(e.type);t===void 0&&(t={stringsArray:new WeakMap,keyString:new Map},ob.set(e.type,t));let r=t.stringsArray.get(e.strings);if(r!==void 0)return r;const n=e.strings.join(kc);return r=t.keyString.get(n),r===void 0&&(r=new GY(e,e.getTemplateElement()),t.keyString.set(n,r)),t.stringsArray.set(e.strings,r),r}const ob=new Map;/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */const Gm=new WeakMap,Dbe=(e,t,r)=>{let n=Gm.get(t);n===void 0&&(_O(t,t.firstChild),Gm.set(t,n=new Kb(Object.assign({templateFactory:Mbe},r))),n.appendInto(t)),n.setValue(e),n.commit()};/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class Rbe{handleAttributeExpressions(t,r,n,i){const a=r[0];return a==="."?new Abe(t,r.slice(1),n).parts:a==="@"?[new Tbe(t,r.slice(1),i.eventContext)]:a==="?"?[new Ebe(t,r.slice(1),n)]:new XY(t,r,n).parts}handleTextExpression(t){return new Kb(t)}}const QY=new Rbe;/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */typeof window<"u"&&(window.litHtmlVersions||(window.litHtmlVersions=[])).push("1.4.1");const Gr=(e,...t)=>new EO(e,t,"html",QY),VM=(e,...t)=>new wbe(e,t,"svg",QY);/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */const ZY=(e,t)=>`${e}--${t}`;let t_=!0;typeof window.ShadyCSS>"u"?t_=!1:typeof window.ShadyCSS.prepareTemplateDom>"u"&&(console.warn("Incompatible ShadyCSS version detected. Please update to at least @webcomponents/webcomponentsjs@2.0.2 and @webcomponents/shadycss@1.3.1."),t_=!1);const kbe=e=>t=>{const r=ZY(t.type,e);let n=ob.get(r);n===void 0&&(n={stringsArray:new WeakMap,keyString:new Map},ob.set(r,n));let i=n.stringsArray.get(t.strings);if(i!==void 0)return i;const a=t.strings.join(kc);if(i=n.keyString.get(a),i===void 0){const o=t.getTemplateElement();t_&&window.ShadyCSS.prepareTemplateDom(o,e),i=new GY(t,o),n.keyString.set(a,i)}return n.stringsArray.set(t.strings,i),i},Obe=["html","svg"],Lbe=e=>{Obe.forEach(t=>{const r=ob.get(ZY(t,e));r!==void 0&&r.keyString.forEach(n=>{const{element:{content:i}}=n,a=new Set;Array.from(i.querySelectorAll("style")).forEach(o=>{a.add(o)}),$Y(n,a)})})},JY=new Set,Fbe=(e,t,r)=>{JY.add(e);const n=r?r.element:document.createElement("template"),i=t.querySelectorAll("style"),{length:a}=i;if(a===0){window.ShadyCSS.prepareTemplateStyles(n,e);return}const o=document.createElement("style");for(let l=0;l<a;l++){const c=i[l];c.parentNode.removeChild(c),o.textContent+=c.textContent}Lbe(e);const s=n.content;r?Sbe(r,o,s.firstChild):s.insertBefore(o,s.firstChild),window.ShadyCSS.prepareTemplateStyles(n,e);const u=s.querySelector("style");if(window.ShadyCSS.nativeShadow&&u!==null)t.insertBefore(u.cloneNode(!0),t.firstChild);else if(r){s.insertBefore(o,s.firstChild);const l=new Set;l.add(o),$Y(r,l)}},Nbe=(e,t,r)=>{if(!r||typeof r!="object"||!r.scopeName)throw new Error("The `scopeName` option is required.");const n=r.scopeName,i=Gm.has(t),a=t_&&t.nodeType===11&&!!t.host,o=a&&!JY.has(n),s=o?document.createDocumentFragment():t;if(Dbe(e,s,Object.assign({templateFactory:kbe(n)},r)),o){const u=Gm.get(s);Gm.delete(s);const l=u.value instanceof jM?u.value.template:void 0;Fbe(n,s,l),_O(t,t.firstChild),t.appendChild(s),Gm.set(t,u)}!i&&a&&window.ShadyCSS.styleElement(t.host)};/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */var eK;window.JSCompiler_renameProperty=(e,t)=>e;const HM={toAttribute(e,t){switch(t){case Boolean:return e?"":null;case Object:case Array:return e==null?e:JSON.stringify(e)}return e},fromAttribute(e,t){switch(t){case Boolean:return e!==null;case Number:return e===null?null:Number(e);case Object:case Array:return JSON.parse(e)}return e}},tK=(e,t)=>t!==e&&(t===t||e===e),RP={attribute:!0,type:String,converter:HM,reflect:!1,hasChanged:tK},kP=1,OP=1<<2,LP=1<<3,FP=1<<4,GM="finalized";class rK extends HTMLElement{constructor(){super(),this.initialize()}static get observedAttributes(){this.finalize();const t=[];return this._classProperties.forEach((r,n)=>{const i=this._attributeNameForProperty(n,r);i!==void 0&&(this._attributeToPropertyMap.set(i,n),t.push(i))}),t}static _ensureClassProperties(){if(!this.hasOwnProperty(JSCompiler_renameProperty("_classProperties",this))){this._classProperties=new Map;const t=Object.getPrototypeOf(this)._classProperties;t!==void 0&&t.forEach((r,n)=>this._classProperties.set(n,r))}}static createProperty(t,r=RP){if(this._ensureClassProperties(),this._classProperties.set(t,r),r.noAccessor||this.prototype.hasOwnProperty(t))return;const n=typeof t=="symbol"?Symbol():`__${t}`,i=this.getPropertyDescriptor(t,n,r);i!==void 0&&Object.defineProperty(this.prototype,t,i)}static getPropertyDescriptor(t,r,n){return{get(){return this[r]},set(i){const a=this[t];this[r]=i,this.requestUpdateInternal(t,a,n)},configurable:!0,enumerable:!0}}static getPropertyOptions(t){return this._classProperties&&this._classProperties.get(t)||RP}static finalize(){const t=Object.getPrototypeOf(this);if(t.hasOwnProperty(GM)||t.finalize(),this[GM]=!0,this._ensureClassProperties(),this._attributeToPropertyMap=new Map,this.hasOwnProperty(JSCompiler_renameProperty("properties",this))){const r=this.properties,n=[...Object.getOwnPropertyNames(r),...typeof Object.getOwnPropertySymbols=="function"?Object.getOwnPropertySymbols(r):[]];for(const i of n)this.createProperty(i,r[i])}}static _attributeNameForProperty(t,r){const n=r.attribute;return n===!1?void 0:typeof n=="string"?n:typeof t=="string"?t.toLowerCase():void 0}static _valueHasChanged(t,r,n=tK){return n(t,r)}static _propertyValueFromAttribute(t,r){const n=r.type,i=r.converter||HM,a=typeof i=="function"?i:i.fromAttribute;return a?a(t,n):t}static _propertyValueToAttribute(t,r){if(r.reflect===void 0)return;const n=r.type,i=r.converter;return(i&&i.toAttribute||HM.toAttribute)(t,n)}initialize(){this._updateState=0,this._updatePromise=new Promise(t=>this._enableUpdatingResolver=t),this._changedProperties=new Map,this._saveInstanceProperties(),this.requestUpdateInternal()}_saveInstanceProperties(){this.constructor._classProperties.forEach((t,r)=>{if(this.hasOwnProperty(r)){const n=this[r];delete this[r],this._instanceProperties||(this._instanceProperties=new Map),this._instanceProperties.set(r,n)}})}_applyInstanceProperties(){this._instanceProperties.forEach((t,r)=>this[r]=t),this._instanceProperties=void 0}connectedCallback(){this.enableUpdating()}enableUpdating(){this._enableUpdatingResolver!==void 0&&(this._enableUpdatingResolver(),this._enableUpdatingResolver=void 0)}disconnectedCallback(){}attributeChangedCallback(t,r,n){r!==n&&this._attributeToProperty(t,n)}_propertyToAttribute(t,r,n=RP){const i=this.constructor,a=i._attributeNameForProperty(t,n);if(a!==void 0){const o=i._propertyValueToAttribute(r,n);if(o===void 0)return;this._updateState=this._updateState|LP,o==null?this.removeAttribute(a):this.setAttribute(a,o),this._updateState=this._updateState&~LP}}_attributeToProperty(t,r){if(this._updateState&LP)return;const n=this.constructor,i=n._attributeToPropertyMap.get(t);if(i!==void 0){const a=n.getPropertyOptions(i);this._updateState=this._updateState|FP,this[i]=n._propertyValueFromAttribute(r,a),this._updateState=this._updateState&~FP}}requestUpdateInternal(t,r,n){let i=!0;if(t!==void 0){const a=this.constructor;n=n||a.getPropertyOptions(t),a._valueHasChanged(this[t],r,n.hasChanged)?(this._changedProperties.has(t)||this._changedProperties.set(t,r),n.reflect===!0&&!(this._updateState&FP)&&(this._reflectingProperties===void 0&&(this._reflectingProperties=new Map),this._reflectingProperties.set(t,n))):i=!1}!this._hasRequestedUpdate&&i&&(this._updatePromise=this._enqueueUpdate())}requestUpdate(t,r){return this.requestUpdateInternal(t,r),this.updateComplete}async _enqueueUpdate(){this._updateState=this._updateState|OP;try{await this._updatePromise}catch{}const t=this.performUpdate();return t!=null&&await t,!this._hasRequestedUpdate}get _hasRequestedUpdate(){return this._updateState&OP}get hasUpdated(){return this._updateState&kP}performUpdate(){if(!this._hasRequestedUpdate)return;this._instanceProperties&&this._applyInstanceProperties();let t=!1;const r=this._changedProperties;try{t=this.shouldUpdate(r),t?this.update(r):this._markUpdated()}catch(n){throw t=!1,this._markUpdated(),n}t&&(this._updateState&kP||(this._updateState=this._updateState|kP,this.firstUpdated(r)),this.updated(r))}_markUpdated(){this._changedProperties=new Map,this._updateState=this._updateState&~OP}get updateComplete(){return this._getUpdateComplete()}_getUpdateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._updatePromise}shouldUpdate(t){return!0}update(t){this._reflectingProperties!==void 0&&this._reflectingProperties.size>0&&(this._reflectingProperties.forEach((r,n)=>this._propertyToAttribute(n,this[n],r)),this._reflectingProperties=void 0),this._markUpdated()}updated(t){}firstUpdated(t){}}eK=GM;rK[eK]=!0;/**
@license
Copyright (c) 2019 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at
http://polymer.github.io/LICENSE.txt The complete set of authors may be found at
http://polymer.github.io/AUTHORS.txt The complete set of contributors may be
found at http://polymer.github.io/CONTRIBUTORS.txt Code distributed by Google as
part of the polymer project is also subject to an additional IP rights grant
found at http://polymer.github.io/PATENTS.txt
*/const qM=window.ShadowRoot&&(window.ShadyCSS===void 0||window.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,AO=Symbol();class PO{constructor(t,r){if(r!==AO)throw new Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=t}get styleSheet(){return this._styleSheet===void 0&&(qM?(this._styleSheet=new CSSStyleSheet,this._styleSheet.replaceSync(this.cssText)):this._styleSheet=null),this._styleSheet}toString(){return this.cssText}}const Bbe=e=>new PO(String(e),AO),Ube=e=>{if(e instanceof PO)return e.cssText;if(typeof e=="number")return e;throw new Error(`Value passed to 'css' function must be a 'css' function result: ${e}. Use 'unsafeCSS' to pass non-literal values, but
            take care to ensure page security.`)},Js=(e,...t)=>{const r=t.reduce((n,i,a)=>n+Ube(i)+e[a+1],e[0]);return new PO(r,AO)};/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */(window.litElementVersions||(window.litElementVersions=[])).push("2.5.1");const z8={};class Ap extends rK{static getStyles(){return this.styles}static _getUniqueStyles(){if(this.hasOwnProperty(JSCompiler_renameProperty("_styles",this)))return;const t=this.getStyles();if(Array.isArray(t)){const r=(a,o)=>a.reduceRight((s,u)=>Array.isArray(u)?r(u,s):(s.add(u),s),o),n=r(t,new Set),i=[];n.forEach(a=>i.unshift(a)),this._styles=i}else this._styles=t===void 0?[]:[t];this._styles=this._styles.map(r=>{if(r instanceof CSSStyleSheet&&!qM){const n=Array.prototype.slice.call(r.cssRules).reduce((i,a)=>i+a.cssText,"");return Bbe(n)}return r})}initialize(){super.initialize(),this.constructor._getUniqueStyles(),this.renderRoot=this.createRenderRoot(),window.ShadowRoot&&this.renderRoot instanceof window.ShadowRoot&&this.adoptStyles()}createRenderRoot(){return this.attachShadow(this.constructor.shadowRootOptions)}adoptStyles(){const t=this.constructor._styles;t.length!==0&&(window.ShadyCSS!==void 0&&!window.ShadyCSS.nativeShadow?window.ShadyCSS.ScopingShim.prepareAdoptedCssText(t.map(r=>r.cssText),this.localName):qM?this.renderRoot.adoptedStyleSheets=t.map(r=>r instanceof CSSStyleSheet?r:r.styleSheet):this._needsShimAdoptedStyleSheets=!0)}connectedCallback(){super.connectedCallback(),this.hasUpdated&&window.ShadyCSS!==void 0&&window.ShadyCSS.styleElement(this)}update(t){const r=this.render();super.update(t),r!==z8&&this.constructor.render(r,this.renderRoot,{scopeName:this.localName,eventContext:this}),this._needsShimAdoptedStyleSheets&&(this._needsShimAdoptedStyleSheets=!1,this.constructor._styles.forEach(n=>{const i=document.createElement("style");i.textContent=n.cssText,this.renderRoot.appendChild(i)}))}render(){return z8}}Ap.finalized=!0;Ap.render=Nbe;Ap.shadowRootOptions={mode:"open"};/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */const V8=new WeakMap,$M=Cbe(e=>t=>{if(!(t instanceof Kb))throw new Error("unsafeHTML can only be used in text bindings");const r=V8.get(t);if(r!==void 0&&H3(e)&&e===r.value&&t.value===r.fragment)return;const n=document.createElement("template");n.innerHTML=e;const i=document.importNode(n.content,!0);t.setValue(i),V8.set(t,{value:e,fragment:i})});var jbe=function(e){return new Promise(function(t){return setTimeout(function(){return t()},e)})},WM="node";typeof importScripts<"u"?WM="worker":typeof window<"u"&&(WM="browser");var zbe=WM,nK=function(){return jbe(0)};zbe==="browser"&&"requestAnimationFrame"in window&&(nK=function(){return new Promise(function(e){return window.requestAnimationFrame(function(){return e()})})});var Vbe=nK,Hbe=Vbe;function iK(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function Gbe(e){return e.length===1&&(e=qbe(e)),{left:function(t,r,n,i){for(n==null&&(n=0),i==null&&(i=t.length);n<i;){var a=n+i>>>1;e(t[a],r)<0?n=a+1:i=a}return n},right:function(t,r,n,i){for(n==null&&(n=0),i==null&&(i=t.length);n<i;){var a=n+i>>>1;e(t[a],r)>0?i=a:n=a+1}return n}}}function qbe(e){return function(t,r){return iK(e(t),r)}}var $be=Gbe(iK),Wbe=$be.right;function Xbe(e,t,r){e=+e,t=+t,r=(i=arguments.length)<2?(t=e,e=0,1):i<3?1:+r;for(var n=-1,i=Math.max(0,Math.ceil((t-e)/r))|0,a=new Array(i);++n<i;)a[n]=e+n*r;return a}var XM=Math.sqrt(50),YM=Math.sqrt(10),KM=Math.sqrt(2);function Ybe(e,t,r){var n,i=-1,a,o,s;if(t=+t,e=+e,r=+r,e===t&&r>0)return[e];if((n=t<e)&&(a=e,e=t,t=a),(s=jS(e,t,r))===0||!isFinite(s))return[];if(s>0)for(e=Math.ceil(e/s),t=Math.floor(t/s),o=new Array(a=Math.ceil(t-e+1));++i<a;)o[i]=(e+i)*s;else for(e=Math.floor(e*s),t=Math.ceil(t*s),o=new Array(a=Math.ceil(e-t+1));++i<a;)o[i]=(e-i)/s;return n&&o.reverse(),o}function jS(e,t,r){var n=(t-e)/Math.max(0,r),i=Math.floor(Math.log(n)/Math.LN10),a=n/Math.pow(10,i);return i>=0?(a>=XM?10:a>=YM?5:a>=KM?2:1)*Math.pow(10,i):-Math.pow(10,-i)/(a>=XM?10:a>=YM?5:a>=KM?2:1)}function Kbe(e,t,r){var n=Math.abs(t-e)/Math.max(0,r),i=Math.pow(10,Math.floor(Math.log(n)/Math.LN10)),a=n/i;return a>=XM?i*=10:a>=YM?i*=5:a>=KM&&(i*=2),t<e?-i:i}function H8(e,t){var r=e.length,n=-1,i,a;if(t==null){for(;++n<r;)if((i=e[n])!=null&&i>=i)for(a=i;++n<r;)(i=e[n])!=null&&i>a&&(a=i)}else for(;++n<r;)if((i=t(e[n],n,e))!=null&&i>=i)for(a=i;++n<r;)(i=t(e[n],n,e))!=null&&i>a&&(a=i);return a}var NP=Array.prototype.slice;function Qbe(e){return e}var BP=1,zS=2,QM=3,By=4,G8=1e-6;function Zbe(e){return"translate("+(e+.5)+",0)"}function Jbe(e){return"translate(0,"+(e+.5)+")"}function e2e(e){return function(t){return+e(t)}}function t2e(e){var t=Math.max(0,e.bandwidth()-1)/2;return e.round()&&(t=Math.round(t)),function(r){return+e(r)+t}}function r2e(){return!this.__axis}function TO(e,t){var r=[],n=null,i=null,a=6,o=6,s=3,u=e===BP||e===By?-1:1,l=e===By||e===zS?"x":"y",c=e===BP||e===QM?Zbe:Jbe;function d(f){var p=n??(t.ticks?t.ticks.apply(t,r):t.domain()),v=i??(t.tickFormat?t.tickFormat.apply(t,r):Qbe),h=Math.max(a,0)+s,m=t.range(),g=+m[0]+.5,y=+m[m.length-1]+.5,b=(t.bandwidth?t2e:e2e)(t.copy()),S=f.selection?f.selection():f,x=S.selectAll(".domain").data([null]),C=S.selectAll(".tick").data(p,t).order(),w=C.exit(),A=C.enter().append("g").attr("class","tick"),M=C.select("line"),D=C.select("text");x=x.merge(x.enter().insert("path",".tick").attr("class","domain").attr("stroke","currentColor")),C=C.merge(A),M=M.merge(A.append("line").attr("stroke","currentColor").attr(l+"2",u*a)),D=D.merge(A.append("text").attr("fill","currentColor").attr(l,u*h).attr("dy",e===BP?"0em":e===QM?"0.71em":"0.32em")),f!==S&&(x=x.transition(f),C=C.transition(f),M=M.transition(f),D=D.transition(f),w=w.transition(f).attr("opacity",G8).attr("transform",function(k){return isFinite(k=b(k))?c(k):this.getAttribute("transform")}),A.attr("opacity",G8).attr("transform",function(k){var R=this.parentNode.__axis;return c(R&&isFinite(R=R(k))?R:b(k))})),w.remove(),x.attr("d",e===By||e==zS?o?"M"+u*o+","+g+"H0.5V"+y+"H"+u*o:"M0.5,"+g+"V"+y:o?"M"+g+","+u*o+"V0.5H"+y+"V"+u*o:"M"+g+",0.5H"+y),C.attr("opacity",1).attr("transform",function(k){return c(b(k))}),M.attr(l+"2",u*a),D.attr(l,u*h).text(v),S.filter(r2e).attr("fill","none").attr("font-size",10).attr("font-family","sans-serif").attr("text-anchor",e===zS?"start":e===By?"end":"middle"),S.each(function(){this.__axis=b})}return d.scale=function(f){return arguments.length?(t=f,d):t},d.ticks=function(){return r=NP.call(arguments),d},d.tickArguments=function(f){return arguments.length?(r=f==null?[]:NP.call(f),d):r.slice()},d.tickValues=function(f){return arguments.length?(n=f==null?null:NP.call(f),d):n&&n.slice()},d.tickFormat=function(f){return arguments.length?(i=f,d):i},d.tickSize=function(f){return arguments.length?(a=o=+f,d):a},d.tickSizeInner=function(f){return arguments.length?(a=+f,d):a},d.tickSizeOuter=function(f){return arguments.length?(o=+f,d):o},d.tickPadding=function(f){return arguments.length?(s=+f,d):s},d}function n2e(e){return TO(zS,e)}function aK(e){return TO(QM,e)}function i2e(e){return TO(By,e)}var a2e={value:function(){}};function G3(){for(var e=0,t=arguments.length,r={},n;e<t;++e){if(!(n=arguments[e]+"")||n in r||/[\s.]/.test(n))throw new Error("illegal type: "+n);r[n]=[]}return new VS(r)}function VS(e){this._=e}function o2e(e,t){return e.trim().split(/^|\s+/).map(function(r){var n="",i=r.indexOf(".");if(i>=0&&(n=r.slice(i+1),r=r.slice(0,i)),r&&!t.hasOwnProperty(r))throw new Error("unknown type: "+r);return{type:r,name:n}})}VS.prototype=G3.prototype={constructor:VS,on:function(e,t){var r=this._,n=o2e(e+"",r),i,a=-1,o=n.length;if(arguments.length<2){for(;++a<o;)if((i=(e=n[a]).type)&&(i=s2e(r[i],e.name)))return i;return}if(t!=null&&typeof t!="function")throw new Error("invalid callback: "+t);for(;++a<o;)if(i=(e=n[a]).type)r[i]=q8(r[i],e.name,t);else if(t==null)for(i in r)r[i]=q8(r[i],e.name,null);return this},copy:function(){var e={},t=this._;for(var r in t)e[r]=t[r].slice();return new VS(e)},call:function(e,t){if((i=arguments.length-2)>0)for(var r=new Array(i),n=0,i,a;n<i;++n)r[n]=arguments[n+2];if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(a=this._[e],n=0,i=a.length;n<i;++n)a[n].value.apply(t,r)},apply:function(e,t,r){if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(var n=this._[e],i=0,a=n.length;i<a;++i)n[i].value.apply(t,r)}};function s2e(e,t){for(var r=0,n=e.length,i;r<n;++r)if((i=e[r]).name===t)return i.value}function q8(e,t,r){for(var n=0,i=e.length;n<i;++n)if(e[n].name===t){e[n]=a2e,e=e.slice(0,n).concat(e.slice(n+1));break}return r!=null&&e.push({name:t,value:r}),e}var ZM="http://www.w3.org/1999/xhtml";const $8={svg:"http://www.w3.org/2000/svg",xhtml:ZM,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function q3(e){var t=e+="",r=t.indexOf(":");return r>=0&&(t=e.slice(0,r))!=="xmlns"&&(e=e.slice(r+1)),$8.hasOwnProperty(t)?{space:$8[t],local:e}:e}function u2e(e){return function(){var t=this.ownerDocument,r=this.namespaceURI;return r===ZM&&t.documentElement.namespaceURI===ZM?t.createElement(e):t.createElementNS(r,e)}}function l2e(e){return function(){return this.ownerDocument.createElementNS(e.space,e.local)}}function oK(e){var t=q3(e);return(t.local?l2e:u2e)(t)}function c2e(){}function IO(e){return e==null?c2e:function(){return this.querySelector(e)}}function d2e(e){typeof e!="function"&&(e=IO(e));for(var t=this._groups,r=t.length,n=new Array(r),i=0;i<r;++i)for(var a=t[i],o=a.length,s=n[i]=new Array(o),u,l,c=0;c<o;++c)(u=a[c])&&(l=e.call(u,u.__data__,c,a))&&("__data__"in u&&(l.__data__=u.__data__),s[c]=l);return new rs(n,this._parents)}function f2e(){return[]}function sK(e){return e==null?f2e:function(){return this.querySelectorAll(e)}}function p2e(e){typeof e!="function"&&(e=sK(e));for(var t=this._groups,r=t.length,n=[],i=[],a=0;a<r;++a)for(var o=t[a],s=o.length,u,l=0;l<s;++l)(u=o[l])&&(n.push(e.call(u,u.__data__,l,o)),i.push(u));return new rs(n,i)}function uK(e){return function(){return this.matches(e)}}function h2e(e){typeof e!="function"&&(e=uK(e));for(var t=this._groups,r=t.length,n=new Array(r),i=0;i<r;++i)for(var a=t[i],o=a.length,s=n[i]=[],u,l=0;l<o;++l)(u=a[l])&&e.call(u,u.__data__,l,a)&&s.push(u);return new rs(n,this._parents)}function lK(e){return new Array(e.length)}function v2e(){return new rs(this._enter||this._groups.map(lK),this._parents)}function r_(e,t){this.ownerDocument=e.ownerDocument,this.namespaceURI=e.namespaceURI,this._next=null,this._parent=e,this.__data__=t}r_.prototype={constructor:r_,appendChild:function(e){return this._parent.insertBefore(e,this._next)},insertBefore:function(e,t){return this._parent.insertBefore(e,t)},querySelector:function(e){return this._parent.querySelector(e)},querySelectorAll:function(e){return this._parent.querySelectorAll(e)}};function m2e(e){return function(){return e}}var W8="$";function g2e(e,t,r,n,i,a){for(var o=0,s,u=t.length,l=a.length;o<l;++o)(s=t[o])?(s.__data__=a[o],n[o]=s):r[o]=new r_(e,a[o]);for(;o<u;++o)(s=t[o])&&(i[o]=s)}function y2e(e,t,r,n,i,a,o){var s,u,l={},c=t.length,d=a.length,f=new Array(c),p;for(s=0;s<c;++s)(u=t[s])&&(f[s]=p=W8+o.call(u,u.__data__,s,t),p in l?i[s]=u:l[p]=u);for(s=0;s<d;++s)p=W8+o.call(e,a[s],s,a),(u=l[p])?(n[s]=u,u.__data__=a[s],l[p]=null):r[s]=new r_(e,a[s]);for(s=0;s<c;++s)(u=t[s])&&l[f[s]]===u&&(i[s]=u)}function b2e(e,t){if(!e)return p=new Array(this.size()),l=-1,this.each(function(C){p[++l]=C}),p;var r=t?y2e:g2e,n=this._parents,i=this._groups;typeof e!="function"&&(e=m2e(e));for(var a=i.length,o=new Array(a),s=new Array(a),u=new Array(a),l=0;l<a;++l){var c=n[l],d=i[l],f=d.length,p=e.call(c,c&&c.__data__,l,n),v=p.length,h=s[l]=new Array(v),m=o[l]=new Array(v),g=u[l]=new Array(f);r(c,d,h,m,g,p,t);for(var y=0,b=0,S,x;y<v;++y)if(S=h[y]){for(y>=b&&(b=y+1);!(x=m[b])&&++b<v;);S._next=x||null}}return o=new rs(o,n),o._enter=s,o._exit=u,o}function x2e(){return new rs(this._exit||this._groups.map(lK),this._parents)}function S2e(e,t,r){var n=this.enter(),i=this,a=this.exit();return n=typeof e=="function"?e(n):n.append(e+""),t!=null&&(i=t(i)),r==null?a.remove():r(a),n&&i?n.merge(i).order():i}function C2e(e){for(var t=this._groups,r=e._groups,n=t.length,i=r.length,a=Math.min(n,i),o=new Array(n),s=0;s<a;++s)for(var u=t[s],l=r[s],c=u.length,d=o[s]=new Array(c),f,p=0;p<c;++p)(f=u[p]||l[p])&&(d[p]=f);for(;s<n;++s)o[s]=t[s];return new rs(o,this._parents)}function _2e(){for(var e=this._groups,t=-1,r=e.length;++t<r;)for(var n=e[t],i=n.length-1,a=n[i],o;--i>=0;)(o=n[i])&&(a&&o.compareDocumentPosition(a)^4&&a.parentNode.insertBefore(o,a),a=o);return this}function w2e(e){e||(e=E2e);function t(d,f){return d&&f?e(d.__data__,f.__data__):!d-!f}for(var r=this._groups,n=r.length,i=new Array(n),a=0;a<n;++a){for(var o=r[a],s=o.length,u=i[a]=new Array(s),l,c=0;c<s;++c)(l=o[c])&&(u[c]=l);u.sort(t)}return new rs(i,this._parents).order()}function E2e(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function A2e(){var e=arguments[0];return arguments[0]=this,e.apply(null,arguments),this}function P2e(){var e=new Array(this.size()),t=-1;return this.each(function(){e[++t]=this}),e}function T2e(){for(var e=this._groups,t=0,r=e.length;t<r;++t)for(var n=e[t],i=0,a=n.length;i<a;++i){var o=n[i];if(o)return o}return null}function I2e(){var e=0;return this.each(function(){++e}),e}function M2e(){return!this.node()}function D2e(e){for(var t=this._groups,r=0,n=t.length;r<n;++r)for(var i=t[r],a=0,o=i.length,s;a<o;++a)(s=i[a])&&e.call(s,s.__data__,a,i);return this}function R2e(e){return function(){this.removeAttribute(e)}}function k2e(e){return function(){this.removeAttributeNS(e.space,e.local)}}function O2e(e,t){return function(){this.setAttribute(e,t)}}function L2e(e,t){return function(){this.setAttributeNS(e.space,e.local,t)}}function F2e(e,t){return function(){var r=t.apply(this,arguments);r==null?this.removeAttribute(e):this.setAttribute(e,r)}}function N2e(e,t){return function(){var r=t.apply(this,arguments);r==null?this.removeAttributeNS(e.space,e.local):this.setAttributeNS(e.space,e.local,r)}}function B2e(e,t){var r=q3(e);if(arguments.length<2){var n=this.node();return r.local?n.getAttributeNS(r.space,r.local):n.getAttribute(r)}return this.each((t==null?r.local?k2e:R2e:typeof t=="function"?r.local?N2e:F2e:r.local?L2e:O2e)(r,t))}function cK(e){return e.ownerDocument&&e.ownerDocument.defaultView||e.document&&e||e.defaultView}function U2e(e){return function(){this.style.removeProperty(e)}}function j2e(e,t,r){return function(){this.style.setProperty(e,t,r)}}function z2e(e,t,r){return function(){var n=t.apply(this,arguments);n==null?this.style.removeProperty(e):this.style.setProperty(e,n,r)}}function V2e(e,t,r){return arguments.length>1?this.each((t==null?U2e:typeof t=="function"?z2e:j2e)(e,t,r??"")):Ng(this.node(),e)}function Ng(e,t){return e.style.getPropertyValue(t)||cK(e).getComputedStyle(e,null).getPropertyValue(t)}function H2e(e){return function(){delete this[e]}}function G2e(e,t){return function(){this[e]=t}}function q2e(e,t){return function(){var r=t.apply(this,arguments);r==null?delete this[e]:this[e]=r}}function $2e(e,t){return arguments.length>1?this.each((t==null?H2e:typeof t=="function"?q2e:G2e)(e,t)):this.node()[e]}function dK(e){return e.trim().split(/^|\s+/)}function MO(e){return e.classList||new fK(e)}function fK(e){this._node=e,this._names=dK(e.getAttribute("class")||"")}fK.prototype={add:function(e){var t=this._names.indexOf(e);t<0&&(this._names.push(e),this._node.setAttribute("class",this._names.join(" ")))},remove:function(e){var t=this._names.indexOf(e);t>=0&&(this._names.splice(t,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(e){return this._names.indexOf(e)>=0}};function pK(e,t){for(var r=MO(e),n=-1,i=t.length;++n<i;)r.add(t[n])}function hK(e,t){for(var r=MO(e),n=-1,i=t.length;++n<i;)r.remove(t[n])}function W2e(e){return function(){pK(this,e)}}function X2e(e){return function(){hK(this,e)}}function Y2e(e,t){return function(){(t.apply(this,arguments)?pK:hK)(this,e)}}function K2e(e,t){var r=dK(e+"");if(arguments.length<2){for(var n=MO(this.node()),i=-1,a=r.length;++i<a;)if(!n.contains(r[i]))return!1;return!0}return this.each((typeof t=="function"?Y2e:t?W2e:X2e)(r,t))}function Q2e(){this.textContent=""}function Z2e(e){return function(){this.textContent=e}}function J2e(e){return function(){var t=e.apply(this,arguments);this.textContent=t??""}}function exe(e){return arguments.length?this.each(e==null?Q2e:(typeof e=="function"?J2e:Z2e)(e)):this.node().textContent}function txe(){this.innerHTML=""}function rxe(e){return function(){this.innerHTML=e}}function nxe(e){return function(){var t=e.apply(this,arguments);this.innerHTML=t??""}}function ixe(e){return arguments.length?this.each(e==null?txe:(typeof e=="function"?nxe:rxe)(e)):this.node().innerHTML}function axe(){this.nextSibling&&this.parentNode.appendChild(this)}function oxe(){return this.each(axe)}function sxe(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function uxe(){return this.each(sxe)}function lxe(e){var t=typeof e=="function"?e:oK(e);return this.select(function(){return this.appendChild(t.apply(this,arguments))})}function cxe(){return null}function dxe(e,t){var r=typeof e=="function"?e:oK(e),n=t==null?cxe:typeof t=="function"?t:IO(t);return this.select(function(){return this.insertBefore(r.apply(this,arguments),n.apply(this,arguments)||null)})}function fxe(){var e=this.parentNode;e&&e.removeChild(this)}function pxe(){return this.each(fxe)}function hxe(){var e=this.cloneNode(!1),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function vxe(){var e=this.cloneNode(!0),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function mxe(e){return this.select(e?vxe:hxe)}function gxe(e){return arguments.length?this.property("__data__",e):this.node().__data__}var vK={},qt=null;if(typeof document<"u"){var yxe=document.documentElement;"onmouseenter"in yxe||(vK={mouseenter:"mouseover",mouseleave:"mouseout"})}function bxe(e,t,r){return e=mK(e,t,r),function(n){var i=n.relatedTarget;(!i||i!==this&&!(i.compareDocumentPosition(this)&8))&&e.call(this,n)}}function mK(e,t,r){return function(n){var i=qt;qt=n;try{e.call(this,this.__data__,t,r)}finally{qt=i}}}function xxe(e){return e.trim().split(/^|\s+/).map(function(t){var r="",n=t.indexOf(".");return n>=0&&(r=t.slice(n+1),t=t.slice(0,n)),{type:t,name:r}})}function Sxe(e){return function(){var t=this.__on;if(t){for(var r=0,n=-1,i=t.length,a;r<i;++r)a=t[r],(!e.type||a.type===e.type)&&a.name===e.name?this.removeEventListener(a.type,a.listener,a.capture):t[++n]=a;++n?t.length=n:delete this.__on}}}function Cxe(e,t,r){var n=vK.hasOwnProperty(e.type)?bxe:mK;return function(i,a,o){var s=this.__on,u,l=n(t,a,o);if(s){for(var c=0,d=s.length;c<d;++c)if((u=s[c]).type===e.type&&u.name===e.name){this.removeEventListener(u.type,u.listener,u.capture),this.addEventListener(u.type,u.listener=l,u.capture=r),u.value=t;return}}this.addEventListener(e.type,l,r),u={type:e.type,name:e.name,value:t,listener:l,capture:r},s?s.push(u):this.__on=[u]}}function _xe(e,t,r){var n=xxe(e+""),i,a=n.length,o;if(arguments.length<2){var s=this.node().__on;if(s){for(var u=0,l=s.length,c;u<l;++u)for(i=0,c=s[u];i<a;++i)if((o=n[i]).type===c.type&&o.name===c.name)return c.value}return}for(s=t?Cxe:Sxe,r==null&&(r=!1),i=0;i<a;++i)this.each(s(n[i],t,r));return this}function gK(e,t,r,n){var i=qt;e.sourceEvent=qt,qt=e;try{return t.apply(r,n)}finally{qt=i}}function yK(e,t,r){var n=cK(e),i=n.CustomEvent;typeof i=="function"?i=new i(t,r):(i=n.document.createEvent("Event"),r?(i.initEvent(t,r.bubbles,r.cancelable),i.detail=r.detail):i.initEvent(t,!1,!1)),e.dispatchEvent(i)}function wxe(e,t){return function(){return yK(this,e,t)}}function Exe(e,t){return function(){return yK(this,e,t.apply(this,arguments))}}function Axe(e,t){return this.each((typeof t=="function"?Exe:wxe)(e,t))}var bK=[null];function rs(e,t){this._groups=e,this._parents=t}function Qb(){return new rs([[document.documentElement]],bK)}rs.prototype=Qb.prototype={constructor:rs,select:d2e,selectAll:p2e,filter:h2e,data:b2e,enter:v2e,exit:x2e,join:S2e,merge:C2e,order:_2e,sort:w2e,call:A2e,nodes:P2e,node:T2e,size:I2e,empty:M2e,each:D2e,attr:B2e,style:V2e,property:$2e,classed:K2e,text:exe,html:ixe,raise:oxe,lower:uxe,append:lxe,insert:dxe,remove:pxe,clone:mxe,datum:gxe,on:_xe,dispatch:Axe};function Gi(e){return typeof e=="string"?new rs([[document.querySelector(e)]],[document.documentElement]):new rs([[e]],bK)}function xK(){for(var e=qt,t;t=e.sourceEvent;)e=t;return e}function SK(e,t){var r=e.ownerSVGElement||e;if(r.createSVGPoint){var n=r.createSVGPoint();return n.x=t.clientX,n.y=t.clientY,n=n.matrixTransform(e.getScreenCTM().inverse()),[n.x,n.y]}var i=e.getBoundingClientRect();return[t.clientX-i.left-e.clientLeft,t.clientY-i.top-e.clientTop]}function Uy(e){var t=xK();return t.changedTouches&&(t=t.changedTouches[0]),SK(e,t)}function JM(e,t,r){arguments.length<3&&(r=t,t=xK().changedTouches);for(var n=0,i=t?t.length:0,a;n<i;++n)if((a=t[n]).identifier===r)return SK(e,a);return null}function e5(){qt.preventDefault(),qt.stopImmediatePropagation()}function CK(e){var t=e.document.documentElement,r=Gi(e).on("dragstart.drag",e5,!0);"onselectstart"in t?r.on("selectstart.drag",e5,!0):(t.__noselect=t.style.MozUserSelect,t.style.MozUserSelect="none")}function _K(e,t){var r=e.document.documentElement,n=Gi(e).on("dragstart.drag",null);t&&(n.on("click.drag",e5,!0),setTimeout(function(){n.on("click.drag",null)},0)),"onselectstart"in r?n.on("selectstart.drag",null):(r.style.MozUserSelect=r.__noselect,delete r.__noselect)}function DO(e,t,r){e.prototype=t.prototype=r,r.constructor=e}function wK(e,t){var r=Object.create(e.prototype);for(var n in t)r[n]=t[n];return r}function Zb(){}var sb=.7,n_=1/sb,fg="\\s*([+-]?\\d+)\\s*",ub="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",Rl="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Pxe=/^#([0-9a-f]{3,8})$/,Txe=new RegExp("^rgb\\("+[fg,fg,fg]+"\\)$"),Ixe=new RegExp("^rgb\\("+[Rl,Rl,Rl]+"\\)$"),Mxe=new RegExp("^rgba\\("+[fg,fg,fg,ub]+"\\)$"),Dxe=new RegExp("^rgba\\("+[Rl,Rl,Rl,ub]+"\\)$"),Rxe=new RegExp("^hsl\\("+[ub,Rl,Rl]+"\\)$"),kxe=new RegExp("^hsla\\("+[ub,Rl,Rl,ub]+"\\)$"),X8={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};DO(Zb,nv,{copy:function(e){return Object.assign(new this.constructor,this,e)},displayable:function(){return this.rgb().displayable()},hex:Y8,formatHex:Y8,formatHsl:Oxe,formatRgb:K8,toString:K8});function Y8(){return this.rgb().formatHex()}function Oxe(){return EK(this).formatHsl()}function K8(){return this.rgb().formatRgb()}function nv(e){var t,r;return e=(e+"").trim().toLowerCase(),(t=Pxe.exec(e))?(r=t[1].length,t=parseInt(t[1],16),r===6?Q8(t):r===3?new Wo(t>>8&15|t>>4&240,t>>4&15|t&240,(t&15)<<4|t&15,1):r===8?ix(t>>24&255,t>>16&255,t>>8&255,(t&255)/255):r===4?ix(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|t&240,((t&15)<<4|t&15)/255):null):(t=Txe.exec(e))?new Wo(t[1],t[2],t[3],1):(t=Ixe.exec(e))?new Wo(t[1]*255/100,t[2]*255/100,t[3]*255/100,1):(t=Mxe.exec(e))?ix(t[1],t[2],t[3],t[4]):(t=Dxe.exec(e))?ix(t[1]*255/100,t[2]*255/100,t[3]*255/100,t[4]):(t=Rxe.exec(e))?e7(t[1],t[2]/100,t[3]/100,1):(t=kxe.exec(e))?e7(t[1],t[2]/100,t[3]/100,t[4]):X8.hasOwnProperty(e)?Q8(X8[e]):e==="transparent"?new Wo(NaN,NaN,NaN,0):null}function Q8(e){return new Wo(e>>16&255,e>>8&255,e&255,1)}function ix(e,t,r,n){return n<=0&&(e=t=r=NaN),new Wo(e,t,r,n)}function Lxe(e){return e instanceof Zb||(e=nv(e)),e?(e=e.rgb(),new Wo(e.r,e.g,e.b,e.opacity)):new Wo}function t5(e,t,r,n){return arguments.length===1?Lxe(e):new Wo(e,t,r,n??1)}function Wo(e,t,r,n){this.r=+e,this.g=+t,this.b=+r,this.opacity=+n}DO(Wo,t5,wK(Zb,{brighter:function(e){return e=e==null?n_:Math.pow(n_,e),new Wo(this.r*e,this.g*e,this.b*e,this.opacity)},darker:function(e){return e=e==null?sb:Math.pow(sb,e),new Wo(this.r*e,this.g*e,this.b*e,this.opacity)},rgb:function(){return this},displayable:function(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:Z8,formatHex:Z8,formatRgb:J8,toString:J8}));function Z8(){return"#"+UP(this.r)+UP(this.g)+UP(this.b)}function J8(){var e=this.opacity;return e=isNaN(e)?1:Math.max(0,Math.min(1,e)),(e===1?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(e===1?")":", "+e+")")}function UP(e){return e=Math.max(0,Math.min(255,Math.round(e)||0)),(e<16?"0":"")+e.toString(16)}function e7(e,t,r,n){return n<=0?e=t=r=NaN:r<=0||r>=1?e=t=NaN:t<=0&&(e=NaN),new bl(e,t,r,n)}function EK(e){if(e instanceof bl)return new bl(e.h,e.s,e.l,e.opacity);if(e instanceof Zb||(e=nv(e)),!e)return new bl;if(e instanceof bl)return e;e=e.rgb();var t=e.r/255,r=e.g/255,n=e.b/255,i=Math.min(t,r,n),a=Math.max(t,r,n),o=NaN,s=a-i,u=(a+i)/2;return s?(t===a?o=(r-n)/s+(r<n)*6:r===a?o=(n-t)/s+2:o=(t-r)/s+4,s/=u<.5?a+i:2-a-i,o*=60):s=u>0&&u<1?0:o,new bl(o,s,u,e.opacity)}function Fxe(e,t,r,n){return arguments.length===1?EK(e):new bl(e,t,r,n??1)}function bl(e,t,r,n){this.h=+e,this.s=+t,this.l=+r,this.opacity=+n}DO(bl,Fxe,wK(Zb,{brighter:function(e){return e=e==null?n_:Math.pow(n_,e),new bl(this.h,this.s,this.l*e,this.opacity)},darker:function(e){return e=e==null?sb:Math.pow(sb,e),new bl(this.h,this.s,this.l*e,this.opacity)},rgb:function(){var e=this.h%360+(this.h<0)*360,t=isNaN(e)||isNaN(this.s)?0:this.s,r=this.l,n=r+(r<.5?r:1-r)*t,i=2*r-n;return new Wo(jP(e>=240?e-240:e+120,i,n),jP(e,i,n),jP(e<120?e+240:e-120,i,n),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl:function(){var e=this.opacity;return e=isNaN(e)?1:Math.max(0,Math.min(1,e)),(e===1?"hsl(":"hsla(")+(this.h||0)+", "+(this.s||0)*100+"%, "+(this.l||0)*100+"%"+(e===1?")":", "+e+")")}}));function jP(e,t,r){return(e<60?t+(r-t)*e/60:e<180?r:e<240?t+(r-t)*(240-e)/60:t)*255}function RO(e){return function(){return e}}function Nxe(e,t){return function(r){return e+r*t}}function Bxe(e,t,r){return e=Math.pow(e,r),t=Math.pow(t,r)-e,r=1/r,function(n){return Math.pow(e+n*t,r)}}function Uxe(e){return(e=+e)==1?AK:function(t,r){return r-t?Bxe(t,r,e):RO(isNaN(t)?r:t)}}function AK(e,t){var r=t-e;return r?Nxe(e,r):RO(isNaN(e)?t:e)}const i_=function e(t){var r=Uxe(t);function n(i,a){var o=r((i=t5(i)).r,(a=t5(a)).r),s=r(i.g,a.g),u=r(i.b,a.b),l=AK(i.opacity,a.opacity);return function(c){return i.r=o(c),i.g=s(c),i.b=u(c),i.opacity=l(c),i+""}}return n.gamma=e,n}(1);function jxe(e,t){t||(t=[]);var r=e?Math.min(t.length,e.length):0,n=t.slice(),i;return function(a){for(i=0;i<r;++i)n[i]=e[i]*(1-a)+t[i]*a;return n}}function zxe(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function Vxe(e,t){var r=t?t.length:0,n=e?Math.min(r,e.length):0,i=new Array(n),a=new Array(r),o;for(o=0;o<n;++o)i[o]=$3(e[o],t[o]);for(;o<r;++o)a[o]=t[o];return function(s){for(o=0;o<n;++o)a[o]=i[o](s);return a}}function Hxe(e,t){var r=new Date;return e=+e,t=+t,function(n){return r.setTime(e*(1-n)+t*n),r}}function mu(e,t){return e=+e,t=+t,function(r){return e*(1-r)+t*r}}function Gxe(e,t){var r={},n={},i;(e===null||typeof e!="object")&&(e={}),(t===null||typeof t!="object")&&(t={});for(i in t)i in e?r[i]=$3(e[i],t[i]):n[i]=t[i];return function(a){for(i in r)n[i]=r[i](a);return n}}var r5=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,zP=new RegExp(r5.source,"g");function qxe(e){return function(){return e}}function $xe(e){return function(t){return e(t)+""}}function PK(e,t){var r=r5.lastIndex=zP.lastIndex=0,n,i,a,o=-1,s=[],u=[];for(e=e+"",t=t+"";(n=r5.exec(e))&&(i=zP.exec(t));)(a=i.index)>r&&(a=t.slice(r,a),s[o]?s[o]+=a:s[++o]=a),(n=n[0])===(i=i[0])?s[o]?s[o]+=i:s[++o]=i:(s[++o]=null,u.push({i:o,x:mu(n,i)})),r=zP.lastIndex;return r<t.length&&(a=t.slice(r),s[o]?s[o]+=a:s[++o]=a),s.length<2?u[0]?$xe(u[0].x):qxe(t):(t=u.length,function(l){for(var c=0,d;c<t;++c)s[(d=u[c]).i]=d.x(l);return s.join("")})}function $3(e,t){var r=typeof t,n;return t==null||r==="boolean"?RO(t):(r==="number"?mu:r==="string"?(n=nv(t))?(t=n,i_):PK:t instanceof nv?i_:t instanceof Date?Hxe:zxe(t)?jxe:Array.isArray(t)?Vxe:typeof t.valueOf!="function"&&typeof t.toString!="function"||isNaN(t)?Gxe:mu)(e,t)}function Wxe(e,t){return e=+e,t=+t,function(r){return Math.round(e*(1-r)+t*r)}}var t7=180/Math.PI,n5={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function TK(e,t,r,n,i,a){var o,s,u;return(o=Math.sqrt(e*e+t*t))&&(e/=o,t/=o),(u=e*r+t*n)&&(r-=e*u,n-=t*u),(s=Math.sqrt(r*r+n*n))&&(r/=s,n/=s,u/=s),e*n<t*r&&(e=-e,t=-t,u=-u,o=-o),{translateX:i,translateY:a,rotate:Math.atan2(t,e)*t7,skewX:Math.atan(u)*t7,scaleX:o,scaleY:s}}var K0,VP,r7,ax;function Xxe(e){return e==="none"?n5:(K0||(K0=document.createElement("DIV"),VP=document.documentElement,r7=document.defaultView),K0.style.transform=e,e=r7.getComputedStyle(VP.appendChild(K0),null).getPropertyValue("transform"),VP.removeChild(K0),e=e.slice(7,-1).split(","),TK(+e[0],+e[1],+e[2],+e[3],+e[4],+e[5]))}function Yxe(e){return e==null||(ax||(ax=document.createElementNS("http://www.w3.org/2000/svg","g")),ax.setAttribute("transform",e),!(e=ax.transform.baseVal.consolidate()))?n5:(e=e.matrix,TK(e.a,e.b,e.c,e.d,e.e,e.f))}function IK(e,t,r,n){function i(l){return l.length?l.pop()+" ":""}function a(l,c,d,f,p,v){if(l!==d||c!==f){var h=p.push("translate(",null,t,null,r);v.push({i:h-4,x:mu(l,d)},{i:h-2,x:mu(c,f)})}else(d||f)&&p.push("translate("+d+t+f+r)}function o(l,c,d,f){l!==c?(l-c>180?c+=360:c-l>180&&(l+=360),f.push({i:d.push(i(d)+"rotate(",null,n)-2,x:mu(l,c)})):c&&d.push(i(d)+"rotate("+c+n)}function s(l,c,d,f){l!==c?f.push({i:d.push(i(d)+"skewX(",null,n)-2,x:mu(l,c)}):c&&d.push(i(d)+"skewX("+c+n)}function u(l,c,d,f,p,v){if(l!==d||c!==f){var h=p.push(i(p)+"scale(",null,",",null,")");v.push({i:h-4,x:mu(l,d)},{i:h-2,x:mu(c,f)})}else(d!==1||f!==1)&&p.push(i(p)+"scale("+d+","+f+")")}return function(l,c){var d=[],f=[];return l=e(l),c=e(c),a(l.translateX,l.translateY,c.translateX,c.translateY,d,f),o(l.rotate,c.rotate,d,f),s(l.skewX,c.skewX,d,f),u(l.scaleX,l.scaleY,c.scaleX,c.scaleY,d,f),l=c=null,function(p){for(var v=-1,h=f.length,m;++v<h;)d[(m=f[v]).i]=m.x(p);return d.join("")}}}var Kxe=IK(Xxe,"px, ","px)","deg)"),Qxe=IK(Yxe,", ",")",")"),Q0=Math.SQRT2,HP=2,n7=4,Zxe=1e-12;function i7(e){return((e=Math.exp(e))+1/e)/2}function Jxe(e){return((e=Math.exp(e))-1/e)/2}function eSe(e){return((e=Math.exp(2*e))-1)/(e+1)}function tSe(e,t){var r=e[0],n=e[1],i=e[2],a=t[0],o=t[1],s=t[2],u=a-r,l=o-n,c=u*u+l*l,d,f;if(c<Zxe)f=Math.log(s/i)/Q0,d=function(y){return[r+y*u,n+y*l,i*Math.exp(Q0*y*f)]};else{var p=Math.sqrt(c),v=(s*s-i*i+n7*c)/(2*i*HP*p),h=(s*s-i*i-n7*c)/(2*s*HP*p),m=Math.log(Math.sqrt(v*v+1)-v),g=Math.log(Math.sqrt(h*h+1)-h);f=(g-m)/Q0,d=function(y){var b=y*f,S=i7(m),x=i/(HP*p)*(S*eSe(Q0*b+m)-Jxe(m));return[r+x*u,n+x*l,i*S/i7(Q0*b+m)]}}return d.duration=f*1e3,d}var Bg=0,jy=0,Z0=0,MK=1e3,a_,zy,o_=0,iv=0,W3=0,lb=typeof performance=="object"&&performance.now?performance:Date,DK=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(e){setTimeout(e,17)};function X3(){return iv||(DK(rSe),iv=lb.now()+W3)}function rSe(){iv=0}function s_(){this._call=this._time=this._next=null}s_.prototype=RK.prototype={constructor:s_,restart:function(e,t,r){if(typeof e!="function")throw new TypeError("callback is not a function");r=(r==null?X3():+r)+(t==null?0:+t),!this._next&&zy!==this&&(zy?zy._next=this:a_=this,zy=this),this._call=e,this._time=r,i5()},stop:function(){this._call&&(this._call=null,this._time=1/0,i5())}};function RK(e,t,r){var n=new s_;return n.restart(e,t,r),n}function nSe(){X3(),++Bg;for(var e=a_,t;e;)(t=iv-e._time)>=0&&e._call.call(null,t),e=e._next;--Bg}function a7(){iv=(o_=lb.now())+W3,Bg=jy=0;try{nSe()}finally{Bg=0,aSe(),iv=0}}function iSe(){var e=lb.now(),t=e-o_;t>MK&&(W3-=t,o_=e)}function aSe(){for(var e,t=a_,r,n=1/0;t;)t._call?(n>t._time&&(n=t._time),e=t,t=t._next):(r=t._next,t._next=null,t=e?e._next=r:a_=r);zy=e,i5(n)}function i5(e){if(!Bg){jy&&(jy=clearTimeout(jy));var t=e-iv;t>24?(e<1/0&&(jy=setTimeout(a7,e-lb.now()-W3)),Z0&&(Z0=clearInterval(Z0))):(Z0||(o_=lb.now(),Z0=setInterval(iSe,MK)),Bg=1,DK(a7))}}function o7(e,t,r){var n=new s_;return t=t==null?0:+t,n.restart(function(i){n.stop(),e(i+t)},t,r),n}var oSe=G3("start","end","cancel","interrupt"),sSe=[],kK=0,s7=1,a5=2,HS=3,u7=4,o5=5,GS=6;function Y3(e,t,r,n,i,a){var o=e.__transition;if(!o)e.__transition={};else if(r in o)return;uSe(e,r,{name:t,index:n,group:i,on:oSe,tween:sSe,time:a.time,delay:a.delay,duration:a.duration,ease:a.ease,timer:null,state:kK})}function kO(e,t){var r=qu(e,t);if(r.state>kK)throw new Error("too late; already scheduled");return r}function md(e,t){var r=qu(e,t);if(r.state>HS)throw new Error("too late; already running");return r}function qu(e,t){var r=e.__transition;if(!r||!(r=r[t]))throw new Error("transition not found");return r}function uSe(e,t,r){var n=e.__transition,i;n[t]=r,r.timer=RK(a,0,r.time);function a(l){r.state=s7,r.timer.restart(o,r.delay,r.time),r.delay<=l&&o(l-r.delay)}function o(l){var c,d,f,p;if(r.state!==s7)return u();for(c in n)if(p=n[c],p.name===r.name){if(p.state===HS)return o7(o);p.state===u7?(p.state=GS,p.timer.stop(),p.on.call("interrupt",e,e.__data__,p.index,p.group),delete n[c]):+c<t&&(p.state=GS,p.timer.stop(),p.on.call("cancel",e,e.__data__,p.index,p.group),delete n[c])}if(o7(function(){r.state===HS&&(r.state=u7,r.timer.restart(s,r.delay,r.time),s(l))}),r.state=a5,r.on.call("start",e,e.__data__,r.index,r.group),r.state===a5){for(r.state=HS,i=new Array(f=r.tween.length),c=0,d=-1;c<f;++c)(p=r.tween[c].value.call(e,e.__data__,r.index,r.group))&&(i[++d]=p);i.length=d+1}}function s(l){for(var c=l<r.duration?r.ease.call(null,l/r.duration):(r.timer.restart(u),r.state=o5,1),d=-1,f=i.length;++d<f;)i[d].call(e,c);r.state===o5&&(r.on.call("end",e,e.__data__,r.index,r.group),u())}function u(){r.state=GS,r.timer.stop(),delete n[t];for(var l in n)return;delete e.__transition}}function pg(e,t){var r=e.__transition,n,i,a=!0,o;if(r){t=t==null?null:t+"";for(o in r){if((n=r[o]).name!==t){a=!1;continue}i=n.state>a5&&n.state<o5,n.state=GS,n.timer.stop(),n.on.call(i?"interrupt":"cancel",e,e.__data__,n.index,n.group),delete r[o]}a&&delete e.__transition}}function lSe(e){return this.each(function(){pg(this,e)})}function cSe(e,t){var r,n;return function(){var i=md(this,e),a=i.tween;if(a!==r){n=r=a;for(var o=0,s=n.length;o<s;++o)if(n[o].name===t){n=n.slice(),n.splice(o,1);break}}i.tween=n}}function dSe(e,t,r){var n,i;if(typeof r!="function")throw new Error;return function(){var a=md(this,e),o=a.tween;if(o!==n){i=(n=o).slice();for(var s={name:t,value:r},u=0,l=i.length;u<l;++u)if(i[u].name===t){i[u]=s;break}u===l&&i.push(s)}a.tween=i}}function fSe(e,t){var r=this._id;if(e+="",arguments.length<2){for(var n=qu(this.node(),r).tween,i=0,a=n.length,o;i<a;++i)if((o=n[i]).name===e)return o.value;return null}return this.each((t==null?cSe:dSe)(r,e,t))}function OO(e,t,r){var n=e._id;return e.each(function(){var i=md(this,n);(i.value||(i.value={}))[t]=r.apply(this,arguments)}),function(i){return qu(i,n).value[t]}}function OK(e,t){var r;return(typeof t=="number"?mu:t instanceof nv?i_:(r=nv(t))?(t=r,i_):PK)(e,t)}function pSe(e){return function(){this.removeAttribute(e)}}function hSe(e){return function(){this.removeAttributeNS(e.space,e.local)}}function vSe(e,t,r){var n,i=r+"",a;return function(){var o=this.getAttribute(e);return o===i?null:o===n?a:a=t(n=o,r)}}function mSe(e,t,r){var n,i=r+"",a;return function(){var o=this.getAttributeNS(e.space,e.local);return o===i?null:o===n?a:a=t(n=o,r)}}function gSe(e,t,r){var n,i,a;return function(){var o,s=r(this),u;return s==null?void this.removeAttribute(e):(o=this.getAttribute(e),u=s+"",o===u?null:o===n&&u===i?a:(i=u,a=t(n=o,s)))}}function ySe(e,t,r){var n,i,a;return function(){var o,s=r(this),u;return s==null?void this.removeAttributeNS(e.space,e.local):(o=this.getAttributeNS(e.space,e.local),u=s+"",o===u?null:o===n&&u===i?a:(i=u,a=t(n=o,s)))}}function bSe(e,t){var r=q3(e),n=r==="transform"?Qxe:OK;return this.attrTween(e,typeof t=="function"?(r.local?ySe:gSe)(r,n,OO(this,"attr."+e,t)):t==null?(r.local?hSe:pSe)(r):(r.local?mSe:vSe)(r,n,t))}function xSe(e,t){return function(r){this.setAttribute(e,t.call(this,r))}}function SSe(e,t){return function(r){this.setAttributeNS(e.space,e.local,t.call(this,r))}}function CSe(e,t){var r,n;function i(){var a=t.apply(this,arguments);return a!==n&&(r=(n=a)&&SSe(e,a)),r}return i._value=t,i}function _Se(e,t){var r,n;function i(){var a=t.apply(this,arguments);return a!==n&&(r=(n=a)&&xSe(e,a)),r}return i._value=t,i}function wSe(e,t){var r="attr."+e;if(arguments.length<2)return(r=this.tween(r))&&r._value;if(t==null)return this.tween(r,null);if(typeof t!="function")throw new Error;var n=q3(e);return this.tween(r,(n.local?CSe:_Se)(n,t))}function ESe(e,t){return function(){kO(this,e).delay=+t.apply(this,arguments)}}function ASe(e,t){return t=+t,function(){kO(this,e).delay=t}}function PSe(e){var t=this._id;return arguments.length?this.each((typeof e=="function"?ESe:ASe)(t,e)):qu(this.node(),t).delay}function TSe(e,t){return function(){md(this,e).duration=+t.apply(this,arguments)}}function ISe(e,t){return t=+t,function(){md(this,e).duration=t}}function MSe(e){var t=this._id;return arguments.length?this.each((typeof e=="function"?TSe:ISe)(t,e)):qu(this.node(),t).duration}function DSe(e,t){if(typeof t!="function")throw new Error;return function(){md(this,e).ease=t}}function RSe(e){var t=this._id;return arguments.length?this.each(DSe(t,e)):qu(this.node(),t).ease}function kSe(e){typeof e!="function"&&(e=uK(e));for(var t=this._groups,r=t.length,n=new Array(r),i=0;i<r;++i)for(var a=t[i],o=a.length,s=n[i]=[],u,l=0;l<o;++l)(u=a[l])&&e.call(u,u.__data__,l,a)&&s.push(u);return new Wc(n,this._parents,this._name,this._id)}function OSe(e){if(e._id!==this._id)throw new Error;for(var t=this._groups,r=e._groups,n=t.length,i=r.length,a=Math.min(n,i),o=new Array(n),s=0;s<a;++s)for(var u=t[s],l=r[s],c=u.length,d=o[s]=new Array(c),f,p=0;p<c;++p)(f=u[p]||l[p])&&(d[p]=f);for(;s<n;++s)o[s]=t[s];return new Wc(o,this._parents,this._name,this._id)}function LSe(e){return(e+"").trim().split(/^|\s+/).every(function(t){var r=t.indexOf(".");return r>=0&&(t=t.slice(0,r)),!t||t==="start"})}function FSe(e,t,r){var n,i,a=LSe(t)?kO:md;return function(){var o=a(this,e),s=o.on;s!==n&&(i=(n=s).copy()).on(t,r),o.on=i}}function NSe(e,t){var r=this._id;return arguments.length<2?qu(this.node(),r).on.on(e):this.each(FSe(r,e,t))}function BSe(e){return function(){var t=this.parentNode;for(var r in this.__transition)if(+r!==e)return;t&&t.removeChild(this)}}function USe(){return this.on("end.remove",BSe(this._id))}function jSe(e){var t=this._name,r=this._id;typeof e!="function"&&(e=IO(e));for(var n=this._groups,i=n.length,a=new Array(i),o=0;o<i;++o)for(var s=n[o],u=s.length,l=a[o]=new Array(u),c,d,f=0;f<u;++f)(c=s[f])&&(d=e.call(c,c.__data__,f,s))&&("__data__"in c&&(d.__data__=c.__data__),l[f]=d,Y3(l[f],t,r,f,l,qu(c,r)));return new Wc(a,this._parents,t,r)}function zSe(e){var t=this._name,r=this._id;typeof e!="function"&&(e=sK(e));for(var n=this._groups,i=n.length,a=[],o=[],s=0;s<i;++s)for(var u=n[s],l=u.length,c,d=0;d<l;++d)if(c=u[d]){for(var f=e.call(c,c.__data__,d,u),p,v=qu(c,r),h=0,m=f.length;h<m;++h)(p=f[h])&&Y3(p,t,r,h,f,v);a.push(f),o.push(c)}return new Wc(a,o,t,r)}var VSe=Qb.prototype.constructor;function HSe(){return new VSe(this._groups,this._parents)}function GSe(e,t){var r,n,i;return function(){var a=Ng(this,e),o=(this.style.removeProperty(e),Ng(this,e));return a===o?null:a===r&&o===n?i:i=t(r=a,n=o)}}function LK(e){return function(){this.style.removeProperty(e)}}function qSe(e,t,r){var n,i=r+"",a;return function(){var o=Ng(this,e);return o===i?null:o===n?a:a=t(n=o,r)}}function $Se(e,t,r){var n,i,a;return function(){var o=Ng(this,e),s=r(this),u=s+"";return s==null&&(u=s=(this.style.removeProperty(e),Ng(this,e))),o===u?null:o===n&&u===i?a:(i=u,a=t(n=o,s))}}function WSe(e,t){var r,n,i,a="style."+t,o="end."+a,s;return function(){var u=md(this,e),l=u.on,c=u.value[a]==null?s||(s=LK(t)):void 0;(l!==r||i!==c)&&(n=(r=l).copy()).on(o,i=c),u.on=n}}function XSe(e,t,r){var n=(e+="")=="transform"?Kxe:OK;return t==null?this.styleTween(e,GSe(e,n)).on("end.style."+e,LK(e)):typeof t=="function"?this.styleTween(e,$Se(e,n,OO(this,"style."+e,t))).each(WSe(this._id,e)):this.styleTween(e,qSe(e,n,t),r).on("end.style."+e,null)}function YSe(e,t,r){return function(n){this.style.setProperty(e,t.call(this,n),r)}}function KSe(e,t,r){var n,i;function a(){var o=t.apply(this,arguments);return o!==i&&(n=(i=o)&&YSe(e,o,r)),n}return a._value=t,a}function QSe(e,t,r){var n="style."+(e+="");if(arguments.length<2)return(n=this.tween(n))&&n._value;if(t==null)return this.tween(n,null);if(typeof t!="function")throw new Error;return this.tween(n,KSe(e,t,r??""))}function ZSe(e){return function(){this.textContent=e}}function JSe(e){return function(){var t=e(this);this.textContent=t??""}}function eCe(e){return this.tween("text",typeof e=="function"?JSe(OO(this,"text",e)):ZSe(e==null?"":e+""))}function tCe(e){return function(t){this.textContent=e.call(this,t)}}function rCe(e){var t,r;function n(){var i=e.apply(this,arguments);return i!==r&&(t=(r=i)&&tCe(i)),t}return n._value=e,n}function nCe(e){var t="text";if(arguments.length<1)return(t=this.tween(t))&&t._value;if(e==null)return this.tween(t,null);if(typeof e!="function")throw new Error;return this.tween(t,rCe(e))}function iCe(){for(var e=this._name,t=this._id,r=FK(),n=this._groups,i=n.length,a=0;a<i;++a)for(var o=n[a],s=o.length,u,l=0;l<s;++l)if(u=o[l]){var c=qu(u,t);Y3(u,e,r,l,o,{time:c.time+c.delay+c.duration,delay:0,duration:c.duration,ease:c.ease})}return new Wc(n,this._parents,e,r)}function aCe(){var e,t,r=this,n=r._id,i=r.size();return new Promise(function(a,o){var s={value:o},u={value:function(){--i===0&&a()}};r.each(function(){var l=md(this,n),c=l.on;c!==e&&(t=(e=c).copy(),t._.cancel.push(s),t._.interrupt.push(s),t._.end.push(u)),l.on=t})})}var oCe=0;function Wc(e,t,r,n){this._groups=e,this._parents=t,this._name=r,this._id=n}function FK(){return++oCe}var om=Qb.prototype;Wc.prototype={constructor:Wc,select:jSe,selectAll:zSe,filter:kSe,merge:OSe,selection:HSe,transition:iCe,call:om.call,nodes:om.nodes,node:om.node,size:om.size,empty:om.empty,each:om.each,on:NSe,attr:bSe,attrTween:wSe,style:XSe,styleTween:QSe,text:eCe,textTween:nCe,remove:USe,tween:fSe,delay:PSe,duration:MSe,ease:RSe,end:aCe};function sCe(e){return((e*=2)<=1?e*e*e:(e-=2)*e*e+2)/2}var s5={time:null,delay:0,duration:250,ease:sCe};function uCe(e,t){for(var r;!(r=e.__transition)||!(r=r[t]);)if(!(e=e.parentNode))return s5.time=X3(),s5;return r}function lCe(e){var t,r;e instanceof Wc?(t=e._id,e=e._name):(t=FK(),(r=s5).time=X3(),e=e==null?null:e+"");for(var n=this._groups,i=n.length,a=0;a<i;++a)for(var o=n[a],s=o.length,u,l=0;l<s;++l)(u=o[l])&&Y3(u,e,t,l,o,r||uCe(u,t));return new Wc(n,this._parents,e,t)}Qb.prototype.interrupt=lSe;Qb.prototype.transition=lCe;function GP(e){return function(){return e}}function cCe(e,t,r){this.target=e,this.type=t,this.selection=r}function l7(){qt.stopImmediatePropagation()}function qP(){qt.preventDefault(),qt.stopImmediatePropagation()}var c7={name:"drag"},$P={name:"space"},sm={name:"handle"},um={name:"center"};function d7(e){return[+e[0],+e[1]]}function f7(e){return[d7(e[0]),d7(e[1])]}function dCe(e){return function(t){return JM(t,qt.touches,e)}}var qS={name:"x",handles:["w","e"].map(u_),input:function(e,t){return e==null?null:[[+e[0],t[0][1]],[+e[1],t[1][1]]]},output:function(e){return e&&[e[0][0],e[1][0]]}},WP={name:"y",handles:["n","s"].map(u_),input:function(e,t){return e==null?null:[[t[0][0],+e[0]],[t[1][0],+e[1]]]},output:function(e){return e&&[e[0][1],e[1][1]]}},Kl={overlay:"crosshair",selection:"move",n:"ns-resize",e:"ew-resize",s:"ns-resize",w:"ew-resize",nw:"nwse-resize",ne:"nesw-resize",se:"nwse-resize",sw:"nesw-resize"},p7={e:"w",w:"e",nw:"ne",ne:"nw",se:"sw",sw:"se"},h7={n:"s",s:"n",nw:"sw",ne:"se",se:"ne",sw:"nw"},fCe={overlay:1,selection:1,n:null,e:1,s:null,w:-1,nw:-1,ne:1,se:1,sw:-1},pCe={overlay:1,selection:1,n:-1,e:null,s:1,w:null,nw:-1,ne:-1,se:1,sw:1};function u_(e){return{type:e}}function hCe(){return!qt.ctrlKey&&!qt.button}function vCe(){var e=this.ownerSVGElement||this;return e.hasAttribute("viewBox")?(e=e.viewBox.baseVal,[[e.x,e.y],[e.x+e.width,e.y+e.height]]):[[0,0],[e.width.baseVal.value,e.height.baseVal.value]]}function mCe(){return navigator.maxTouchPoints||"ontouchstart"in this}function XP(e){for(;!e.__brush;)if(!(e=e.parentNode))return;return e.__brush}function gCe(e){return e[0][0]===e[1][0]||e[0][1]===e[1][1]}function yCe(){return bCe(qS)}function bCe(e){var t=vCe,r=hCe,n=mCe,i=!0,a=G3("start","brush","end"),o=6,s;function u(m){var g=m.property("__brush",h).selectAll(".overlay").data([u_("overlay")]);g.enter().append("rect").attr("class","overlay").attr("pointer-events","all").attr("cursor",Kl.overlay).merge(g).each(function(){var b=XP(this).extent;Gi(this).attr("x",b[0][0]).attr("y",b[0][1]).attr("width",b[1][0]-b[0][0]).attr("height",b[1][1]-b[0][1])}),m.selectAll(".selection").data([u_("selection")]).enter().append("rect").attr("class","selection").attr("cursor",Kl.selection).attr("fill","#777").attr("fill-opacity",.3).attr("stroke","#fff").attr("shape-rendering","crispEdges");var y=m.selectAll(".handle").data(e.handles,function(b){return b.type});y.exit().remove(),y.enter().append("rect").attr("class",function(b){return"handle handle--"+b.type}).attr("cursor",function(b){return Kl[b.type]}),m.each(l).attr("fill","none").attr("pointer-events","all").on("mousedown.brush",f).filter(n).on("touchstart.brush",f).on("touchmove.brush",p).on("touchend.brush touchcancel.brush",v).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}u.move=function(m,g){m.selection?m.on("start.brush",function(){c(this,arguments).beforestart().start()}).on("interrupt.brush end.brush",function(){c(this,arguments).end()}).tween("brush",function(){var y=this,b=y.__brush,S=c(y,arguments),x=b.selection,C=e.input(typeof g=="function"?g.apply(this,arguments):g,b.extent),w=$3(x,C);function A(M){b.selection=M===1&&C===null?null:w(M),l.call(y),S.brush()}return x!==null&&C!==null?A:A(1)}):m.each(function(){var y=this,b=arguments,S=y.__brush,x=e.input(typeof g=="function"?g.apply(y,b):g,S.extent),C=c(y,b).beforestart();pg(y),S.selection=x===null?null:x,l.call(y),C.start().brush().end()})},u.clear=function(m){u.move(m,null)};function l(){var m=Gi(this),g=XP(this).selection;g?(m.selectAll(".selection").style("display",null).attr("x",g[0][0]).attr("y",g[0][1]).attr("width",g[1][0]-g[0][0]).attr("height",g[1][1]-g[0][1]),m.selectAll(".handle").style("display",null).attr("x",function(y){return y.type[y.type.length-1]==="e"?g[1][0]-o/2:g[0][0]-o/2}).attr("y",function(y){return y.type[0]==="s"?g[1][1]-o/2:g[0][1]-o/2}).attr("width",function(y){return y.type==="n"||y.type==="s"?g[1][0]-g[0][0]+o:o}).attr("height",function(y){return y.type==="e"||y.type==="w"?g[1][1]-g[0][1]+o:o})):m.selectAll(".selection,.handle").style("display","none").attr("x",null).attr("y",null).attr("width",null).attr("height",null)}function c(m,g,y){var b=m.__brush.emitter;return b&&(!y||!b.clean)?b:new d(m,g,y)}function d(m,g,y){this.that=m,this.args=g,this.state=m.__brush,this.active=0,this.clean=y}d.prototype={beforestart:function(){return++this.active===1&&(this.state.emitter=this,this.starting=!0),this},start:function(){return this.starting?(this.starting=!1,this.emit("start")):this.emit("brush"),this},brush:function(){return this.emit("brush"),this},end:function(){return--this.active===0&&(delete this.state.emitter,this.emit("end")),this},emit:function(m){gK(new cCe(u,m,e.output(this.state.selection)),a.apply,a,[m,this.that,this.args])}};function f(){if(s&&!qt.touches||!r.apply(this,arguments))return;var m=this,g=qt.target.__data__.type,y=(i&&qt.metaKey?g="overlay":g)==="selection"?c7:i&&qt.altKey?um:sm,b=e===WP?null:fCe[g],S=e===qS?null:pCe[g],x=XP(m),C=x.extent,w=x.selection,A=C[0][0],M,D,k=C[0][1],R,O,H=C[1][0],B,j,Y=C[1][1],G,$,q=0,ee=0,fe,W=b&&S&&i&&qt.shiftKey,X,U,z=qt.touches?dCe(qt.changedTouches[0].identifier):Uy,J=z(m),K=J,Z=c(m,arguments,!0).beforestart();g==="overlay"?(w&&(fe=!0),x.selection=w=[[M=e===WP?A:J[0],R=e===qS?k:J[1]],[B=e===WP?H:M,G=e===qS?Y:R]]):(M=w[0][0],R=w[0][1],B=w[1][0],G=w[1][1]),D=M,O=R,j=B,$=G;var te=Gi(m).attr("pointer-events","none"),le=te.selectAll(".overlay").attr("cursor",Kl[g]);if(qt.touches)Z.moved=be,Z.ended=Se;else{var ye=Gi(qt.view).on("mousemove.brush",be,!0).on("mouseup.brush",Se,!0);i&&ye.on("keydown.brush",ie,!0).on("keyup.brush",oe,!0),CK(qt.view)}l7(),pg(m),l.call(m),Z.start();function be(){var L=z(m);W&&!X&&!U&&(Math.abs(L[0]-K[0])>Math.abs(L[1]-K[1])?U=!0:X=!0),K=L,fe=!0,qP(),Ae()}function Ae(){var L;switch(q=K[0]-J[0],ee=K[1]-J[1],y){case $P:case c7:{b&&(q=Math.max(A-M,Math.min(H-B,q)),D=M+q,j=B+q),S&&(ee=Math.max(k-R,Math.min(Y-G,ee)),O=R+ee,$=G+ee);break}case sm:{b<0?(q=Math.max(A-M,Math.min(H-M,q)),D=M+q,j=B):b>0&&(q=Math.max(A-B,Math.min(H-B,q)),D=M,j=B+q),S<0?(ee=Math.max(k-R,Math.min(Y-R,ee)),O=R+ee,$=G):S>0&&(ee=Math.max(k-G,Math.min(Y-G,ee)),O=R,$=G+ee);break}case um:{b&&(D=Math.max(A,Math.min(H,M-q*b)),j=Math.max(A,Math.min(H,B+q*b))),S&&(O=Math.max(k,Math.min(Y,R-ee*S)),$=Math.max(k,Math.min(Y,G+ee*S)));break}}j<D&&(b*=-1,L=M,M=B,B=L,L=D,D=j,j=L,g in p7&&le.attr("cursor",Kl[g=p7[g]])),$<O&&(S*=-1,L=R,R=G,G=L,L=O,O=$,$=L,g in h7&&le.attr("cursor",Kl[g=h7[g]])),x.selection&&(w=x.selection),X&&(D=w[0][0],j=w[1][0]),U&&(O=w[0][1],$=w[1][1]),(w[0][0]!==D||w[0][1]!==O||w[1][0]!==j||w[1][1]!==$)&&(x.selection=[[D,O],[j,$]],l.call(m),Z.brush())}function Se(){if(l7(),qt.touches){if(qt.touches.length)return;s&&clearTimeout(s),s=setTimeout(function(){s=null},500)}else _K(qt.view,fe),ye.on("keydown.brush keyup.brush mousemove.brush mouseup.brush",null);te.attr("pointer-events","all"),le.attr("cursor",Kl.overlay),x.selection&&(w=x.selection),gCe(w)&&(x.selection=null,l.call(m)),Z.end()}function ie(){switch(qt.keyCode){case 16:{W=b&&S;break}case 18:{y===sm&&(b&&(B=j-q*b,M=D+q*b),S&&(G=$-ee*S,R=O+ee*S),y=um,Ae());break}case 32:{(y===sm||y===um)&&(b<0?B=j-q:b>0&&(M=D-q),S<0?G=$-ee:S>0&&(R=O-ee),y=$P,le.attr("cursor",Kl.selection),Ae());break}default:return}qP()}function oe(){switch(qt.keyCode){case 16:{W&&(X=U=W=!1,Ae());break}case 18:{y===um&&(b<0?B=j:b>0&&(M=D),S<0?G=$:S>0&&(R=O),y=sm,Ae());break}case 32:{y===$P&&(qt.altKey?(b&&(B=j-q*b,M=D+q*b),S&&(G=$-ee*S,R=O+ee*S),y=um):(b<0?B=j:b>0&&(M=D),S<0?G=$:S>0&&(R=O),y=sm),le.attr("cursor",Kl[g]),Ae());break}default:return}qP()}}function p(){c(this,arguments).moved()}function v(){c(this,arguments).ended()}function h(){var m=this.__brush||{selection:null};return m.extent=f7(t.apply(this,arguments)),m.dim=e,m}return u.extent=function(m){return arguments.length?(t=typeof m=="function"?m:GP(f7(m)),u):t},u.filter=function(m){return arguments.length?(r=typeof m=="function"?m:GP(!!m),u):r},u.touchable=function(m){return arguments.length?(n=typeof m=="function"?m:GP(!!m),u):n},u.handleSize=function(m){return arguments.length?(o=+m,u):o},u.keyModifiers=function(m){return arguments.length?(i=!!m,u):i},u.on=function(){var m=a.on.apply(a,arguments);return m===a?u:m},u}var u5=Math.PI,l5=2*u5,uh=1e-6,xCe=l5-uh;function c5(){this._x0=this._y0=this._x1=this._y1=null,this._=""}function NK(){return new c5}c5.prototype=NK.prototype={constructor:c5,moveTo:function(e,t){this._+="M"+(this._x0=this._x1=+e)+","+(this._y0=this._y1=+t)},closePath:function(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")},lineTo:function(e,t){this._+="L"+(this._x1=+e)+","+(this._y1=+t)},quadraticCurveTo:function(e,t,r,n){this._+="Q"+ +e+","+ +t+","+(this._x1=+r)+","+(this._y1=+n)},bezierCurveTo:function(e,t,r,n,i,a){this._+="C"+ +e+","+ +t+","+ +r+","+ +n+","+(this._x1=+i)+","+(this._y1=+a)},arcTo:function(e,t,r,n,i){e=+e,t=+t,r=+r,n=+n,i=+i;var a=this._x1,o=this._y1,s=r-e,u=n-t,l=a-e,c=o-t,d=l*l+c*c;if(i<0)throw new Error("negative radius: "+i);if(this._x1===null)this._+="M"+(this._x1=e)+","+(this._y1=t);else if(d>uh)if(!(Math.abs(c*s-u*l)>uh)||!i)this._+="L"+(this._x1=e)+","+(this._y1=t);else{var f=r-a,p=n-o,v=s*s+u*u,h=f*f+p*p,m=Math.sqrt(v),g=Math.sqrt(d),y=i*Math.tan((u5-Math.acos((v+d-h)/(2*m*g)))/2),b=y/g,S=y/m;Math.abs(b-1)>uh&&(this._+="L"+(e+b*l)+","+(t+b*c)),this._+="A"+i+","+i+",0,0,"+ +(c*f>l*p)+","+(this._x1=e+S*s)+","+(this._y1=t+S*u)}},arc:function(e,t,r,n,i,a){e=+e,t=+t,r=+r,a=!!a;var o=r*Math.cos(n),s=r*Math.sin(n),u=e+o,l=t+s,c=1^a,d=a?n-i:i-n;if(r<0)throw new Error("negative radius: "+r);this._x1===null?this._+="M"+u+","+l:(Math.abs(this._x1-u)>uh||Math.abs(this._y1-l)>uh)&&(this._+="L"+u+","+l),r&&(d<0&&(d=d%l5+l5),d>xCe?this._+="A"+r+","+r+",0,1,"+c+","+(e-o)+","+(t-s)+"A"+r+","+r+",0,1,"+c+","+(this._x1=u)+","+(this._y1=l):d>uh&&(this._+="A"+r+","+r+",0,"+ +(d>=u5)+","+c+","+(this._x1=e+r*Math.cos(i))+","+(this._y1=t+r*Math.sin(i))))},rect:function(e,t,r,n){this._+="M"+(this._x0=this._x1=+e)+","+(this._y0=this._y1=+t)+"h"+ +r+"v"+ +n+"h"+-r+"Z"},toString:function(){return this._}};var As="$";function l_(){}l_.prototype=c_.prototype={constructor:l_,has:function(e){return As+e in this},get:function(e){return this[As+e]},set:function(e,t){return this[As+e]=t,this},remove:function(e){var t=As+e;return t in this&&delete this[t]},clear:function(){for(var e in this)e[0]===As&&delete this[e]},keys:function(){var e=[];for(var t in this)t[0]===As&&e.push(t.slice(1));return e},values:function(){var e=[];for(var t in this)t[0]===As&&e.push(this[t]);return e},entries:function(){var e=[];for(var t in this)t[0]===As&&e.push({key:t.slice(1),value:this[t]});return e},size:function(){var e=0;for(var t in this)t[0]===As&&++e;return e},empty:function(){for(var e in this)if(e[0]===As)return!1;return!0},each:function(e){for(var t in this)t[0]===As&&e(this[t],t.slice(1),this)}};function c_(e,t){var r=new l_;if(e instanceof l_)e.each(function(s,u){r.set(u,s)});else if(Array.isArray(e)){var n=-1,i=e.length,a;if(t==null)for(;++n<i;)r.set(n,e[n]);else for(;++n<i;)r.set(t(a=e[n],n,e),a)}else if(e)for(var o in e)r.set(o,e[o]);return r}function v7(){}var Lp=c_.prototype;v7.prototype={constructor:v7,has:Lp.has,add:function(e){return e+="",this[As+e]=e,this},remove:Lp.remove,clear:Lp.clear,values:Lp.keys,size:Lp.size,empty:Lp.empty,each:Lp.each};function SCe(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)}function d_(e,t){if((r=(e=t?e.toExponential(t-1):e.toExponential()).indexOf("e"))<0)return null;var r,n=e.slice(0,r);return[n.length>1?n[0]+n.slice(2):n,+e.slice(r+1)]}function Ug(e){return e=d_(Math.abs(e)),e?e[1]:NaN}function CCe(e,t){return function(r,n){for(var i=r.length,a=[],o=0,s=e[0],u=0;i>0&&s>0&&(u+s+1>n&&(s=Math.max(1,n-u)),a.push(r.substring(i-=s,i+s)),!((u+=s+1)>n));)s=e[o=(o+1)%e.length];return a.reverse().join(t)}}function _Ce(e){return function(t){return t.replace(/[0-9]/g,function(r){return e[+r]})}}var wCe=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function f_(e){if(!(t=wCe.exec(e)))throw new Error("invalid format: "+e);var t;return new LO({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}f_.prototype=LO.prototype;function LO(e){this.fill=e.fill===void 0?" ":e.fill+"",this.align=e.align===void 0?">":e.align+"",this.sign=e.sign===void 0?"-":e.sign+"",this.symbol=e.symbol===void 0?"":e.symbol+"",this.zero=!!e.zero,this.width=e.width===void 0?void 0:+e.width,this.comma=!!e.comma,this.precision=e.precision===void 0?void 0:+e.precision,this.trim=!!e.trim,this.type=e.type===void 0?"":e.type+""}LO.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function ECe(e){e:for(var t=e.length,r=1,n=-1,i;r<t;++r)switch(e[r]){case".":n=i=r;break;case"0":n===0&&(n=r),i=r;break;default:if(!+e[r])break e;n>0&&(n=0);break}return n>0?e.slice(0,n)+e.slice(i+1):e}var BK;function ACe(e,t){var r=d_(e,t);if(!r)return e+"";var n=r[0],i=r[1],a=i-(BK=Math.max(-8,Math.min(8,Math.floor(i/3)))*3)+1,o=n.length;return a===o?n:a>o?n+new Array(a-o+1).join("0"):a>0?n.slice(0,a)+"."+n.slice(a):"0."+new Array(1-a).join("0")+d_(e,Math.max(0,t+a-1))[0]}function m7(e,t){var r=d_(e,t);if(!r)return e+"";var n=r[0],i=r[1];return i<0?"0."+new Array(-i).join("0")+n:n.length>i+1?n.slice(0,i+1)+"."+n.slice(i+1):n+new Array(i-n.length+2).join("0")}const g7={"%":function(e,t){return(e*100).toFixed(t)},b:function(e){return Math.round(e).toString(2)},c:function(e){return e+""},d:SCe,e:function(e,t){return e.toExponential(t)},f:function(e,t){return e.toFixed(t)},g:function(e,t){return e.toPrecision(t)},o:function(e){return Math.round(e).toString(8)},p:function(e,t){return m7(e*100,t)},r:m7,s:ACe,X:function(e){return Math.round(e).toString(16).toUpperCase()},x:function(e){return Math.round(e).toString(16)}};function y7(e){return e}var b7=Array.prototype.map,x7=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"];function PCe(e){var t=e.grouping===void 0||e.thousands===void 0?y7:CCe(b7.call(e.grouping,Number),e.thousands+""),r=e.currency===void 0?"":e.currency[0]+"",n=e.currency===void 0?"":e.currency[1]+"",i=e.decimal===void 0?".":e.decimal+"",a=e.numerals===void 0?y7:_Ce(b7.call(e.numerals,String)),o=e.percent===void 0?"%":e.percent+"",s=e.minus===void 0?"-":e.minus+"",u=e.nan===void 0?"NaN":e.nan+"";function l(d){d=f_(d);var f=d.fill,p=d.align,v=d.sign,h=d.symbol,m=d.zero,g=d.width,y=d.comma,b=d.precision,S=d.trim,x=d.type;x==="n"?(y=!0,x="g"):g7[x]||(b===void 0&&(b=12),S=!0,x="g"),(m||f==="0"&&p==="=")&&(m=!0,f="0",p="=");var C=h==="$"?r:h==="#"&&/[boxX]/.test(x)?"0"+x.toLowerCase():"",w=h==="$"?n:/[%p]/.test(x)?o:"",A=g7[x],M=/[defgprs%]/.test(x);b=b===void 0?6:/[gprs]/.test(x)?Math.max(1,Math.min(21,b)):Math.max(0,Math.min(20,b));function D(k){var R=C,O=w,H,B,j;if(x==="c")O=A(k)+O,k="";else{k=+k;var Y=k<0||1/k<0;if(k=isNaN(k)?u:A(Math.abs(k),b),S&&(k=ECe(k)),Y&&+k==0&&v!=="+"&&(Y=!1),R=(Y?v==="("?v:s:v==="-"||v==="("?"":v)+R,O=(x==="s"?x7[8+BK/3]:"")+O+(Y&&v==="("?")":""),M){for(H=-1,B=k.length;++H<B;)if(j=k.charCodeAt(H),48>j||j>57){O=(j===46?i+k.slice(H+1):k.slice(H))+O,k=k.slice(0,H);break}}}y&&!m&&(k=t(k,1/0));var G=R.length+k.length+O.length,$=G<g?new Array(g-G+1).join(f):"";switch(y&&m&&(k=t($+k,$.length?g-O.length:1/0),$=""),p){case"<":k=R+k+O+$;break;case"=":k=R+$+k+O;break;case"^":k=$.slice(0,G=$.length>>1)+R+k+O+$.slice(G);break;default:k=$+R+k+O;break}return a(k)}return D.toString=function(){return d+""},D}function c(d,f){var p=l((d=f_(d),d.type="f",d)),v=Math.max(-8,Math.min(8,Math.floor(Ug(f)/3)))*3,h=Math.pow(10,-v),m=x7[8+v/3];return function(g){return p(h*g)+m}}return{format:l,formatPrefix:c}}var ox,p_,UK;TCe({decimal:".",thousands:",",grouping:[3],currency:["$",""],minus:"-"});function TCe(e){return ox=PCe(e),p_=ox.format,UK=ox.formatPrefix,ox}function ICe(e){return Math.max(0,-Ug(Math.abs(e)))}function MCe(e,t){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(Ug(t)/3)))*3-Ug(Math.abs(e)))}function DCe(e,t){return e=Math.abs(e),t=Math.abs(t)-e,Math.max(0,Ug(t)-Ug(e))+1}function p0(){return Math.random()}(function e(t){function r(n,i){return n=n==null?0:+n,i=i==null?1:+i,arguments.length===1?(i=n,n=0):i-=n,function(){return t()*i+n}}return r.source=e,r})(p0);const RCe=function e(t){function r(n,i){var a,o;return n=n==null?0:+n,i=i==null?1:+i,function(){var s;if(a!=null)s=a,a=null;else do a=t()*2-1,s=t()*2-1,o=a*a+s*s;while(!o||o>1);return n+i*s*Math.sqrt(-2*Math.log(o)/o)}}return r.source=e,r}(p0);(function e(t){function r(){var n=RCe.source(t).apply(this,arguments);return function(){return Math.exp(n())}}return r.source=e,r})(p0);const kCe=function e(t){function r(n){return function(){for(var i=0,a=0;a<n;++a)i+=t();return i}}return r.source=e,r}(p0);(function e(t){function r(n){var i=kCe.source(t)(n);return function(){return i()/n}}return r.source=e,r})(p0);(function e(t){function r(n){return function(){return-Math.log(1-t())/n}}return r.source=e,r})(p0);function K3(e,t){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(t).domain(e);break}return this}var jK=Array.prototype,OCe=jK.map,d5=jK.slice,S7={name:"implicit"};function zK(){var e=c_(),t=[],r=[],n=S7;function i(a){var o=a+"",s=e.get(o);if(!s){if(n!==S7)return n;e.set(o,s=t.push(a))}return r[(s-1)%r.length]}return i.domain=function(a){if(!arguments.length)return t.slice();t=[],e=c_();for(var o=-1,s=a.length,u,l;++o<s;)e.has(l=(u=a[o])+"")||e.set(l,t.push(u));return i},i.range=function(a){return arguments.length?(r=d5.call(a),i):r.slice()},i.unknown=function(a){return arguments.length?(n=a,i):n},i.copy=function(){return zK(t,r).unknown(n)},K3.apply(i,arguments),i}function VK(){var e=zK().unknown(void 0),t=e.domain,r=e.range,n=[0,1],i,a,o=!1,s=0,u=0,l=.5;delete e.unknown;function c(){var d=t().length,f=n[1]<n[0],p=n[f-0],v=n[1-f];i=(v-p)/Math.max(1,d-s+u*2),o&&(i=Math.floor(i)),p+=(v-p-i*(d-s))*l,a=i*(1-s),o&&(p=Math.round(p),a=Math.round(a));var h=Xbe(d).map(function(m){return p+i*m});return r(f?h.reverse():h)}return e.domain=function(d){return arguments.length?(t(d),c()):t()},e.range=function(d){return arguments.length?(n=[+d[0],+d[1]],c()):n.slice()},e.rangeRound=function(d){return n=[+d[0],+d[1]],o=!0,c()},e.bandwidth=function(){return a},e.step=function(){return i},e.round=function(d){return arguments.length?(o=!!d,c()):o},e.padding=function(d){return arguments.length?(s=Math.min(1,u=+d),c()):s},e.paddingInner=function(d){return arguments.length?(s=Math.min(1,d),c()):s},e.paddingOuter=function(d){return arguments.length?(u=+d,c()):u},e.align=function(d){return arguments.length?(l=Math.max(0,Math.min(1,d)),c()):l},e.copy=function(){return VK(t(),n).round(o).paddingInner(s).paddingOuter(u).align(l)},K3.apply(c(),arguments)}function HK(e){var t=e.copy;return e.padding=e.paddingOuter,delete e.paddingInner,delete e.paddingOuter,e.copy=function(){return HK(t())},e}function LCe(){return HK(VK.apply(null,arguments).paddingInner(1))}function FCe(e){return function(){return e}}function NCe(e){return+e}var C7=[0,1];function Cl(e){return e}function f5(e,t){return(t-=e=+e)?function(r){return(r-e)/t}:FCe(isNaN(t)?NaN:.5)}function _7(e){var t=e[0],r=e[e.length-1],n;return t>r&&(n=t,t=r,r=n),function(i){return Math.max(t,Math.min(r,i))}}function BCe(e,t,r){var n=e[0],i=e[1],a=t[0],o=t[1];return i<n?(n=f5(i,n),a=r(o,a)):(n=f5(n,i),a=r(a,o)),function(s){return a(n(s))}}function UCe(e,t,r){var n=Math.min(e.length,t.length)-1,i=new Array(n),a=new Array(n),o=-1;for(e[n]<e[0]&&(e=e.slice().reverse(),t=t.slice().reverse());++o<n;)i[o]=f5(e[o],e[o+1]),a[o]=r(t[o],t[o+1]);return function(s){var u=Wbe(e,s,1,n)-1;return a[u](i[u](s))}}function GK(e,t){return t.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function qK(){var e=C7,t=C7,r=$3,n,i,a,o=Cl,s,u,l;function c(){return s=Math.min(e.length,t.length)>2?UCe:BCe,u=l=null,d}function d(f){return isNaN(f=+f)?a:(u||(u=s(e.map(n),t,r)))(n(o(f)))}return d.invert=function(f){return o(i((l||(l=s(t,e.map(n),mu)))(f)))},d.domain=function(f){return arguments.length?(e=OCe.call(f,NCe),o===Cl||(o=_7(e)),c()):e.slice()},d.range=function(f){return arguments.length?(t=d5.call(f),c()):t.slice()},d.rangeRound=function(f){return t=d5.call(f),r=Wxe,c()},d.clamp=function(f){return arguments.length?(o=f?_7(e):Cl,d):o!==Cl},d.interpolate=function(f){return arguments.length?(r=f,c()):r},d.unknown=function(f){return arguments.length?(a=f,d):a},function(f,p){return n=f,i=p,c()}}function jCe(e,t){return qK()(e,t)}function zCe(e,t,r,n){var i=Kbe(e,t,r),a;switch(n=f_(n??",f"),n.type){case"s":{var o=Math.max(Math.abs(e),Math.abs(t));return n.precision==null&&!isNaN(a=MCe(i,o))&&(n.precision=a),UK(n,o)}case"":case"e":case"g":case"p":case"r":{n.precision==null&&!isNaN(a=DCe(i,Math.max(Math.abs(e),Math.abs(t))))&&(n.precision=a-(n.type==="e"));break}case"f":case"%":{n.precision==null&&!isNaN(a=ICe(i))&&(n.precision=a-(n.type==="%")*2);break}}return p_(n)}function $K(e){var t=e.domain;return e.ticks=function(r){var n=t();return Ybe(n[0],n[n.length-1],r??10)},e.tickFormat=function(r,n){var i=t();return zCe(i[0],i[i.length-1],r??10,n)},e.nice=function(r){r==null&&(r=10);var n=t(),i=0,a=n.length-1,o=n[i],s=n[a],u;return s<o&&(u=o,o=s,s=u,u=i,i=a,a=u),u=jS(o,s,r),u>0?(o=Math.floor(o/u)*u,s=Math.ceil(s/u)*u,u=jS(o,s,r)):u<0&&(o=Math.ceil(o*u)/u,s=Math.floor(s*u)/u,u=jS(o,s,r)),u>0?(n[i]=Math.floor(o/u)*u,n[a]=Math.ceil(s/u)*u,t(n)):u<0&&(n[i]=Math.ceil(o*u)/u,n[a]=Math.floor(s*u)/u,t(n)),e},e}function Jb(){var e=jCe(Cl,Cl);return e.copy=function(){return GK(e,Jb())},K3.apply(e,arguments),$K(e)}function w7(e){return function(t){return t<0?-Math.pow(-t,e):Math.pow(t,e)}}function VCe(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function HCe(e){return e<0?-e*e:e*e}function GCe(e){var t=e(Cl,Cl),r=1;function n(){return r===1?e(Cl,Cl):r===.5?e(VCe,HCe):e(w7(r),w7(1/r))}return t.exponent=function(i){return arguments.length?(r=+i,n()):r},$K(t)}function WK(){var e=GCe(qK());return e.copy=function(){return GK(e,WK()).exponent(e.exponent())},K3.apply(e,arguments),e}function sx(e){return function(){return e}}function XK(e){this._context=e}XK.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:this._context.lineTo(e,t);break}}};function qCe(e){return new XK(e)}function $Ce(e){return e[0]}function WCe(e){return e[1]}function XCe(){var e=$Ce,t=WCe,r=sx(!0),n=null,i=qCe,a=null;function o(s){var u,l=s.length,c,d=!1,f;for(n==null&&(a=i(f=NK())),u=0;u<=l;++u)!(u<l&&r(c=s[u],u,s))===d&&((d=!d)?a.lineStart():a.lineEnd()),d&&a.point(+e(c,u,s),+t(c,u,s));if(f)return a=null,f+""||null}return o.x=function(s){return arguments.length?(e=typeof s=="function"?s:sx(+s),o):e},o.y=function(s){return arguments.length?(t=typeof s=="function"?s:sx(+s),o):t},o.defined=function(s){return arguments.length?(r=typeof s=="function"?s:sx(!!s),o):r},o.curve=function(s){return arguments.length?(i=s,n!=null&&(a=i(n)),o):i},o.context=function(s){return arguments.length?(s==null?n=a=null:a=i(n=s),o):n},o}function h_(){this._=null}function Q3(e){e.U=e.C=e.L=e.R=e.P=e.N=null}h_.prototype={constructor:h_,insert:function(e,t){var r,n,i;if(e){if(t.P=e,t.N=e.N,e.N&&(e.N.P=t),e.N=t,e.R){for(e=e.R;e.L;)e=e.L;e.L=t}else e.R=t;r=e}else this._?(e=E7(this._),t.P=null,t.N=e,e.P=e.L=t,r=e):(t.P=t.N=null,this._=t,r=null);for(t.L=t.R=null,t.U=r,t.C=!0,e=t;r&&r.C;)n=r.U,r===n.L?(i=n.R,i&&i.C?(r.C=i.C=!1,n.C=!0,e=n):(e===r.R&&(J0(this,r),e=r,r=e.U),r.C=!1,n.C=!0,ey(this,n))):(i=n.L,i&&i.C?(r.C=i.C=!1,n.C=!0,e=n):(e===r.L&&(ey(this,r),e=r,r=e.U),r.C=!1,n.C=!0,J0(this,n))),r=e.U;this._.C=!1},remove:function(e){e.N&&(e.N.P=e.P),e.P&&(e.P.N=e.N),e.N=e.P=null;var t=e.U,r,n=e.L,i=e.R,a,o;if(n?i?a=E7(i):a=n:a=i,t?t.L===e?t.L=a:t.R=a:this._=a,n&&i?(o=a.C,a.C=e.C,a.L=n,n.U=a,a!==i?(t=a.U,a.U=e.U,e=a.R,t.L=e,a.R=i,i.U=a):(a.U=t,t=a,e=a.R)):(o=e.C,e=a),e&&(e.U=t),!o){if(e&&e.C){e.C=!1;return}do{if(e===this._)break;if(e===t.L){if(r=t.R,r.C&&(r.C=!1,t.C=!0,J0(this,t),r=t.R),r.L&&r.L.C||r.R&&r.R.C){(!r.R||!r.R.C)&&(r.L.C=!1,r.C=!0,ey(this,r),r=t.R),r.C=t.C,t.C=r.R.C=!1,J0(this,t),e=this._;break}}else if(r=t.L,r.C&&(r.C=!1,t.C=!0,ey(this,t),r=t.L),r.L&&r.L.C||r.R&&r.R.C){(!r.L||!r.L.C)&&(r.R.C=!1,r.C=!0,J0(this,r),r=t.L),r.C=t.C,t.C=r.L.C=!1,ey(this,t),e=this._;break}r.C=!0,e=t,t=t.U}while(!e.C);e&&(e.C=!1)}}};function J0(e,t){var r=t,n=t.R,i=r.U;i?i.L===r?i.L=n:i.R=n:e._=n,n.U=i,r.U=n,r.R=n.L,r.R&&(r.R.U=r),n.L=r}function ey(e,t){var r=t,n=t.L,i=r.U;i?i.L===r?i.L=n:i.R=n:e._=n,n.U=i,r.U=n,r.L=n.R,r.L&&(r.L.U=r),n.R=r}function E7(e){for(;e.L;)e=e.L;return e}function Vy(e,t,r,n){var i=[null,null],a=Da.push(i)-1;return i.left=e,i.right=t,r&&v_(i,e,t,r),n&&v_(i,t,e,n),Go[e.index].halfedges.push(a),Go[t.index].halfedges.push(a),i}function ty(e,t,r){var n=[t,r];return n.left=e,n}function v_(e,t,r,n){!e[0]&&!e[1]?(e[0]=n,e.left=t,e.right=r):e.left===r?e[1]=n:e[0]=n}function YCe(e,t,r,n,i){var a=e[0],o=e[1],s=a[0],u=a[1],l=o[0],c=o[1],d=0,f=1,p=l-s,v=c-u,h;if(h=t-s,!(!p&&h>0)){if(h/=p,p<0){if(h<d)return;h<f&&(f=h)}else if(p>0){if(h>f)return;h>d&&(d=h)}if(h=n-s,!(!p&&h<0)){if(h/=p,p<0){if(h>f)return;h>d&&(d=h)}else if(p>0){if(h<d)return;h<f&&(f=h)}if(h=r-u,!(!v&&h>0)){if(h/=v,v<0){if(h<d)return;h<f&&(f=h)}else if(v>0){if(h>f)return;h>d&&(d=h)}if(h=i-u,!(!v&&h<0)){if(h/=v,v<0){if(h>f)return;h>d&&(d=h)}else if(v>0){if(h<d)return;h<f&&(f=h)}return!(d>0)&&!(f<1)||(d>0&&(e[0]=[s+d*p,u+d*v]),f<1&&(e[1]=[s+f*p,u+f*v])),!0}}}}}function KCe(e,t,r,n,i){var a=e[1];if(a)return!0;var o=e[0],s=e.left,u=e.right,l=s[0],c=s[1],d=u[0],f=u[1],p=(l+d)/2,v=(c+f)/2,h,m;if(f===c){if(p<t||p>=n)return;if(l>d){if(!o)o=[p,r];else if(o[1]>=i)return;a=[p,i]}else{if(!o)o=[p,i];else if(o[1]<r)return;a=[p,r]}}else if(h=(l-d)/(f-c),m=v-h*p,h<-1||h>1)if(l>d){if(!o)o=[(r-m)/h,r];else if(o[1]>=i)return;a=[(i-m)/h,i]}else{if(!o)o=[(i-m)/h,i];else if(o[1]<r)return;a=[(r-m)/h,r]}else if(c<f){if(!o)o=[t,h*t+m];else if(o[0]>=n)return;a=[n,h*n+m]}else{if(!o)o=[n,h*n+m];else if(o[0]<t)return;a=[t,h*t+m]}return e[0]=o,e[1]=a,!0}function QCe(e,t,r,n){for(var i=Da.length,a;i--;)(!KCe(a=Da[i],e,t,r,n)||!YCe(a,e,t,r,n)||!(Math.abs(a[0][0]-a[1][0])>ei||Math.abs(a[0][1]-a[1][1])>ei))&&delete Da[i]}function ZCe(e){return Go[e.index]={site:e,halfedges:[]}}function JCe(e,t){var r=e.site,n=t.left,i=t.right;return r===i&&(i=n,n=r),i?Math.atan2(i[1]-n[1],i[0]-n[0]):(r===n?(n=t[1],i=t[0]):(n=t[0],i=t[1]),Math.atan2(n[0]-i[0],i[1]-n[1]))}function YK(e,t){return t[+(t.left!==e.site)]}function e_e(e,t){return t[+(t.left===e.site)]}function t_e(){for(var e=0,t=Go.length,r,n,i,a;e<t;++e)if((r=Go[e])&&(a=(n=r.halfedges).length)){var o=new Array(a),s=new Array(a);for(i=0;i<a;++i)o[i]=i,s[i]=JCe(r,Da[n[i]]);for(o.sort(function(u,l){return s[l]-s[u]}),i=0;i<a;++i)s[i]=n[o[i]];for(i=0;i<a;++i)n[i]=s[i]}}function r_e(e,t,r,n){var i=Go.length,a,o,s,u,l,c,d,f,p,v,h,m,g=!0;for(a=0;a<i;++a)if(o=Go[a]){for(s=o.site,l=o.halfedges,u=l.length;u--;)Da[l[u]]||l.splice(u,1);for(u=0,c=l.length;u<c;)v=e_e(o,Da[l[u]]),h=v[0],m=v[1],d=YK(o,Da[l[++u%c]]),f=d[0],p=d[1],(Math.abs(h-f)>ei||Math.abs(m-p)>ei)&&(l.splice(u,0,Da.push(ty(s,v,Math.abs(h-e)<ei&&n-m>ei?[e,Math.abs(f-e)<ei?p:n]:Math.abs(m-n)<ei&&r-h>ei?[Math.abs(p-n)<ei?f:r,n]:Math.abs(h-r)<ei&&m-t>ei?[r,Math.abs(f-r)<ei?p:t]:Math.abs(m-t)<ei&&h-e>ei?[Math.abs(p-t)<ei?f:e,t]:null))-1),++c);c&&(g=!1)}if(g){var y,b,S,x=1/0;for(a=0,g=null;a<i;++a)(o=Go[a])&&(s=o.site,y=s[0]-e,b=s[1]-t,S=y*y+b*b,S<x&&(x=S,g=o));if(g){var C=[e,t],w=[e,n],A=[r,n],M=[r,t];g.halfedges.push(Da.push(ty(s=g.site,C,w))-1,Da.push(ty(s,w,A))-1,Da.push(ty(s,A,M))-1,Da.push(ty(s,M,C))-1)}}for(a=0;a<i;++a)(o=Go[a])&&(o.halfedges.length||delete Go[a])}var KK=[],FO;function n_e(){Q3(this),this.x=this.y=this.arc=this.site=this.cy=null}function qm(e){var t=e.P,r=e.N;if(!(!t||!r)){var n=t.site,i=e.site,a=r.site;if(n!==a){var o=i[0],s=i[1],u=n[0]-o,l=n[1]-s,c=a[0]-o,d=a[1]-s,f=2*(u*d-l*c);if(!(f>=-u_e)){var p=u*u+l*l,v=c*c+d*d,h=(d*p-l*v)/f,m=(u*v-c*p)/f,g=KK.pop()||new n_e;g.arc=e,g.site=i,g.x=h+o,g.y=(g.cy=m+s)+Math.sqrt(h*h+m*m),e.circle=g;for(var y=null,b=cb._;b;)if(g.y<b.y||g.y===b.y&&g.x<=b.x)if(b.L)b=b.L;else{y=b.P;break}else if(b.R)b=b.R;else{y=b;break}cb.insert(y,g),y||(FO=g)}}}}function hg(e){var t=e.circle;t&&(t.P||(FO=t.N),cb.remove(t),KK.push(t),Q3(t),e.circle=null)}var QK=[];function i_e(){Q3(this),this.edge=this.site=this.circle=null}function A7(e){var t=QK.pop()||new i_e;return t.site=e,t}function YP(e){hg(e),vg.remove(e),QK.push(e),Q3(e)}function a_e(e){var t=e.circle,r=t.x,n=t.cy,i=[r,n],a=e.P,o=e.N,s=[e];YP(e);for(var u=a;u.circle&&Math.abs(r-u.circle.x)<ei&&Math.abs(n-u.circle.cy)<ei;)a=u.P,s.unshift(u),YP(u),u=a;s.unshift(u),hg(u);for(var l=o;l.circle&&Math.abs(r-l.circle.x)<ei&&Math.abs(n-l.circle.cy)<ei;)o=l.N,s.push(l),YP(l),l=o;s.push(l),hg(l);var c=s.length,d;for(d=1;d<c;++d)l=s[d],u=s[d-1],v_(l.edge,u.site,l.site,i);u=s[0],l=s[c-1],l.edge=Vy(u.site,l.site,null,i),qm(u),qm(l)}function o_e(e){for(var t=e[0],r=e[1],n,i,a,o,s=vg._;s;)if(a=ZK(s,r)-t,a>ei)s=s.L;else if(o=t-s_e(s,r),o>ei){if(!s.R){n=s;break}s=s.R}else{a>-ei?(n=s.P,i=s):o>-ei?(n=s,i=s.N):n=i=s;break}ZCe(e);var u=A7(e);if(vg.insert(n,u),!(!n&&!i)){if(n===i){hg(n),i=A7(n.site),vg.insert(u,i),u.edge=i.edge=Vy(n.site,u.site),qm(n),qm(i);return}if(!i){u.edge=Vy(n.site,u.site);return}hg(n),hg(i);var l=n.site,c=l[0],d=l[1],f=e[0]-c,p=e[1]-d,v=i.site,h=v[0]-c,m=v[1]-d,g=2*(f*m-p*h),y=f*f+p*p,b=h*h+m*m,S=[(m*y-p*b)/g+c,(f*b-h*y)/g+d];v_(i.edge,l,v,S),u.edge=Vy(l,e,null,S),i.edge=Vy(e,v,null,S),qm(n),qm(i)}}function ZK(e,t){var r=e.site,n=r[0],i=r[1],a=i-t;if(!a)return n;var o=e.P;if(!o)return-1/0;r=o.site;var s=r[0],u=r[1],l=u-t;if(!l)return s;var c=s-n,d=1/a-1/l,f=c/l;return d?(-f+Math.sqrt(f*f-2*d*(c*c/(-2*l)-u+l/2+i-a/2)))/d+n:(n+s)/2}function s_e(e,t){var r=e.N;if(r)return ZK(r,t);var n=e.site;return n[1]===t?n[0]:1/0}var ei=1e-6,u_e=1e-12,vg,Go,cb,Da;function l_e(e,t,r){return(e[0]-r[0])*(t[1]-e[1])-(e[0]-t[0])*(r[1]-e[1])}function c_e(e,t){return t[1]-e[1]||t[0]-e[0]}function P7(e,t){var r=e.sort(c_e).pop(),n,i,a;for(Da=[],Go=new Array(e.length),vg=new h_,cb=new h_;;)if(a=FO,r&&(!a||r[1]<a.y||r[1]===a.y&&r[0]<a.x))(r[0]!==n||r[1]!==i)&&(o_e(r),n=r[0],i=r[1]),r=e.pop();else if(a)a_e(a.arc);else break;if(t_e(),t){var o=+t[0][0],s=+t[0][1],u=+t[1][0],l=+t[1][1];QCe(o,s,u,l),r_e(o,s,u,l)}this.edges=Da,this.cells=Go,vg=cb=Da=Go=null}P7.prototype={constructor:P7,polygons:function(){var e=this.edges;return this.cells.map(function(t){var r=t.halfedges.map(function(n){return YK(t,e[n])});return r.data=t.site.data,r})},triangles:function(){var e=[],t=this.edges;return this.cells.forEach(function(r,n){if(s=(a=r.halfedges).length)for(var i=r.site,a,o=-1,s,u,l=t[a[s-1]],c=l.left===i?l.right:l.left;++o<s;)u=c,l=t[a[o]],c=l.left===i?l.right:l.left,u&&c&&n<u.index&&n<c.index&&l_e(i,u,c)<0&&e.push([i.data,u.data,c.data])}),e},links:function(){return this.edges.filter(function(e){return e.right}).map(function(e){return{source:e.left.data,target:e.right.data}})},find:function(e,t,r){for(var n=this,i,a=n._found||0,o=n.cells.length,s;!(s=n.cells[a]);)if(++a>=o)return null;var u=e-s.site[0],l=t-s.site[1],c=u*u+l*l;do s=n.cells[i=a],a=null,s.halfedges.forEach(function(d){var f=n.edges[d],p=f.left;if(!((p===s.site||!p)&&!(p=f.right))){var v=e-p[0],h=t-p[1],m=v*v+h*h;m<c&&(c=m,a=p.index)}});while(a!==null);return n._found=i,r==null||c<=r*r?s.site:null}};function ux(e){return function(){return e}}function d_e(e,t,r){this.target=e,this.type=t,this.transform=r}function Ec(e,t,r){this.k=e,this.x=t,this.y=r}Ec.prototype={constructor:Ec,scale:function(e){return e===1?this:new Ec(this.k*e,this.x,this.y)},translate:function(e,t){return e===0&t===0?this:new Ec(this.k,this.x+this.k*e,this.y+this.k*t)},apply:function(e){return[e[0]*this.k+this.x,e[1]*this.k+this.y]},applyX:function(e){return e*this.k+this.x},applyY:function(e){return e*this.k+this.y},invert:function(e){return[(e[0]-this.x)/this.k,(e[1]-this.y)/this.k]},invertX:function(e){return(e-this.x)/this.k},invertY:function(e){return(e-this.y)/this.k},rescaleX:function(e){return e.copy().domain(e.range().map(this.invertX,this).map(e.invert,e))},rescaleY:function(e){return e.copy().domain(e.range().map(this.invertY,this).map(e.invert,e))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var NO=new Ec(1,0,0);Ec.prototype;function KP(){qt.stopImmediatePropagation()}function ry(){qt.preventDefault(),qt.stopImmediatePropagation()}function f_e(){return!qt.ctrlKey&&!qt.button}function p_e(){var e=this;return e instanceof SVGElement?(e=e.ownerSVGElement||e,e.hasAttribute("viewBox")?(e=e.viewBox.baseVal,[[e.x,e.y],[e.x+e.width,e.y+e.height]]):[[0,0],[e.width.baseVal.value,e.height.baseVal.value]]):[[0,0],[e.clientWidth,e.clientHeight]]}function T7(){return this.__zoom||NO}function h_e(){return-qt.deltaY*(qt.deltaMode===1?.05:qt.deltaMode?1:.002)}function v_e(){return navigator.maxTouchPoints||"ontouchstart"in this}function m_e(e,t,r){var n=e.invertX(t[0][0])-r[0][0],i=e.invertX(t[1][0])-r[1][0],a=e.invertY(t[0][1])-r[0][1],o=e.invertY(t[1][1])-r[1][1];return e.translate(i>n?(n+i)/2:Math.min(0,n)||Math.max(0,i),o>a?(a+o)/2:Math.min(0,a)||Math.max(0,o))}function g_e(){var e=f_e,t=p_e,r=m_e,n=h_e,i=v_e,a=[0,1/0],o=[[-1/0,-1/0],[1/0,1/0]],s=250,u=tSe,l=G3("start","zoom","end"),c,d,f=500,p=150,v=0;function h(R){R.property("__zoom",T7).on("wheel.zoom",C).on("mousedown.zoom",w).on("dblclick.zoom",A).filter(i).on("touchstart.zoom",M).on("touchmove.zoom",D).on("touchend.zoom touchcancel.zoom",k).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}h.transform=function(R,O,H){var B=R.selection?R.selection():R;B.property("__zoom",T7),R!==B?b(R,O,H):B.interrupt().each(function(){S(this,arguments).start().zoom(null,typeof O=="function"?O.apply(this,arguments):O).end()})},h.scaleBy=function(R,O,H){h.scaleTo(R,function(){var B=this.__zoom.k,j=typeof O=="function"?O.apply(this,arguments):O;return B*j},H)},h.scaleTo=function(R,O,H){h.transform(R,function(){var B=t.apply(this,arguments),j=this.__zoom,Y=H==null?y(B):typeof H=="function"?H.apply(this,arguments):H,G=j.invert(Y),$=typeof O=="function"?O.apply(this,arguments):O;return r(g(m(j,$),Y,G),B,o)},H)},h.translateBy=function(R,O,H){h.transform(R,function(){return r(this.__zoom.translate(typeof O=="function"?O.apply(this,arguments):O,typeof H=="function"?H.apply(this,arguments):H),t.apply(this,arguments),o)})},h.translateTo=function(R,O,H,B){h.transform(R,function(){var j=t.apply(this,arguments),Y=this.__zoom,G=B==null?y(j):typeof B=="function"?B.apply(this,arguments):B;return r(NO.translate(G[0],G[1]).scale(Y.k).translate(typeof O=="function"?-O.apply(this,arguments):-O,typeof H=="function"?-H.apply(this,arguments):-H),j,o)},B)};function m(R,O){return O=Math.max(a[0],Math.min(a[1],O)),O===R.k?R:new Ec(O,R.x,R.y)}function g(R,O,H){var B=O[0]-H[0]*R.k,j=O[1]-H[1]*R.k;return B===R.x&&j===R.y?R:new Ec(R.k,B,j)}function y(R){return[(+R[0][0]+ +R[1][0])/2,(+R[0][1]+ +R[1][1])/2]}function b(R,O,H){R.on("start.zoom",function(){S(this,arguments).start()}).on("interrupt.zoom end.zoom",function(){S(this,arguments).end()}).tween("zoom",function(){var B=this,j=arguments,Y=S(B,j),G=t.apply(B,j),$=H==null?y(G):typeof H=="function"?H.apply(B,j):H,q=Math.max(G[1][0]-G[0][0],G[1][1]-G[0][1]),ee=B.__zoom,fe=typeof O=="function"?O.apply(B,j):O,W=u(ee.invert($).concat(q/ee.k),fe.invert($).concat(q/fe.k));return function(X){if(X===1)X=fe;else{var U=W(X),z=q/U[2];X=new Ec(z,$[0]-U[0]*z,$[1]-U[1]*z)}Y.zoom(null,X)}})}function S(R,O,H){return!H&&R.__zooming||new x(R,O)}function x(R,O){this.that=R,this.args=O,this.active=0,this.extent=t.apply(R,O),this.taps=0}x.prototype={start:function(){return++this.active===1&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(R,O){return this.mouse&&R!=="mouse"&&(this.mouse[1]=O.invert(this.mouse[0])),this.touch0&&R!=="touch"&&(this.touch0[1]=O.invert(this.touch0[0])),this.touch1&&R!=="touch"&&(this.touch1[1]=O.invert(this.touch1[0])),this.that.__zoom=O,this.emit("zoom"),this},end:function(){return--this.active===0&&(delete this.that.__zooming,this.emit("end")),this},emit:function(R){gK(new d_e(h,R,this.that.__zoom),l.apply,l,[R,this.that,this.args])}};function C(){if(!e.apply(this,arguments))return;var R=S(this,arguments),O=this.__zoom,H=Math.max(a[0],Math.min(a[1],O.k*Math.pow(2,n.apply(this,arguments)))),B=Uy(this);if(R.wheel)(R.mouse[0][0]!==B[0]||R.mouse[0][1]!==B[1])&&(R.mouse[1]=O.invert(R.mouse[0]=B)),clearTimeout(R.wheel);else{if(O.k===H)return;R.mouse=[B,O.invert(B)],pg(this),R.start()}ry(),R.wheel=setTimeout(j,p),R.zoom("mouse",r(g(m(O,H),R.mouse[0],R.mouse[1]),R.extent,o));function j(){R.wheel=null,R.end()}}function w(){if(d||!e.apply(this,arguments))return;var R=S(this,arguments,!0),O=Gi(qt.view).on("mousemove.zoom",Y,!0).on("mouseup.zoom",G,!0),H=Uy(this),B=qt.clientX,j=qt.clientY;CK(qt.view),KP(),R.mouse=[H,this.__zoom.invert(H)],pg(this),R.start();function Y(){if(ry(),!R.moved){var $=qt.clientX-B,q=qt.clientY-j;R.moved=$*$+q*q>v}R.zoom("mouse",r(g(R.that.__zoom,R.mouse[0]=Uy(R.that),R.mouse[1]),R.extent,o))}function G(){O.on("mousemove.zoom mouseup.zoom",null),_K(qt.view,R.moved),ry(),R.end()}}function A(){if(e.apply(this,arguments)){var R=this.__zoom,O=Uy(this),H=R.invert(O),B=R.k*(qt.shiftKey?.5:2),j=r(g(m(R,B),O,H),t.apply(this,arguments),o);ry(),s>0?Gi(this).transition().duration(s).call(b,j,O):Gi(this).call(h.transform,j)}}function M(){if(e.apply(this,arguments)){var R=qt.touches,O=R.length,H=S(this,arguments,qt.changedTouches.length===O),B,j,Y,G;for(KP(),j=0;j<O;++j)Y=R[j],G=JM(this,R,Y.identifier),G=[G,this.__zoom.invert(G),Y.identifier],H.touch0?!H.touch1&&H.touch0[2]!==G[2]&&(H.touch1=G,H.taps=0):(H.touch0=G,B=!0,H.taps=1+!!c);c&&(c=clearTimeout(c)),B&&(H.taps<2&&(c=setTimeout(function(){c=null},f)),pg(this),H.start())}}function D(){if(this.__zooming){var R=S(this,arguments),O=qt.changedTouches,H=O.length,B,j,Y,G;for(ry(),c&&(c=clearTimeout(c)),R.taps=0,B=0;B<H;++B)j=O[B],Y=JM(this,O,j.identifier),R.touch0&&R.touch0[2]===j.identifier?R.touch0[0]=Y:R.touch1&&R.touch1[2]===j.identifier&&(R.touch1[0]=Y);if(j=R.that.__zoom,R.touch1){var $=R.touch0[0],q=R.touch0[1],ee=R.touch1[0],fe=R.touch1[1],W=(W=ee[0]-$[0])*W+(W=ee[1]-$[1])*W,X=(X=fe[0]-q[0])*X+(X=fe[1]-q[1])*X;j=m(j,Math.sqrt(W/X)),Y=[($[0]+ee[0])/2,($[1]+ee[1])/2],G=[(q[0]+fe[0])/2,(q[1]+fe[1])/2]}else if(R.touch0)Y=R.touch0[0],G=R.touch0[1];else return;R.zoom("touch",r(g(j,Y,G),R.extent,o))}}function k(){if(this.__zooming){var R=S(this,arguments),O=qt.changedTouches,H=O.length,B,j;for(KP(),d&&clearTimeout(d),d=setTimeout(function(){d=null},f),B=0;B<H;++B)j=O[B],R.touch0&&R.touch0[2]===j.identifier?delete R.touch0:R.touch1&&R.touch1[2]===j.identifier&&delete R.touch1;if(R.touch1&&!R.touch0&&(R.touch0=R.touch1,delete R.touch1),R.touch0)R.touch0[1]=this.__zoom.invert(R.touch0[0]);else if(R.end(),R.taps===2){var Y=Gi(this).on("dblclick.zoom");Y&&Y.apply(this,arguments)}}}return h.wheelDelta=function(R){return arguments.length?(n=typeof R=="function"?R:ux(+R),h):n},h.filter=function(R){return arguments.length?(e=typeof R=="function"?R:ux(!!R),h):e},h.touchable=function(R){return arguments.length?(i=typeof R=="function"?R:ux(!!R),h):i},h.extent=function(R){return arguments.length?(t=typeof R=="function"?R:ux([[+R[0][0],+R[0][1]],[+R[1][0],+R[1][1]]]),h):t},h.scaleExtent=function(R){return arguments.length?(a[0]=+R[0],a[1]=+R[1],h):[a[0],a[1]]},h.translateExtent=function(R){return arguments.length?(o[0][0]=+R[0][0],o[1][0]=+R[1][0],o[0][1]=+R[0][1],o[1][1]=+R[1][1],h):[[o[0][0],o[0][1]],[o[1][0],o[1][1]]]},h.constrain=function(R){return arguments.length?(r=R,h):r},h.duration=function(R){return arguments.length?(s=+R,h):s},h.interpolate=function(R){return arguments.length?(u=R,h):u},h.on=function(){var R=l.on.apply(l,arguments);return R===l?h:R},h.clickDistance=function(R){return arguments.length?(v=(R=+R)*R,h):Math.sqrt(v)},h}class y_e{constructor({min:t=-1/0,max:r=1/0}={}){this.segments=[],this.max=r,this.min=t,this.regionString=null}encode(t=!1){return this.segments.map(({start:r,end:n,color:i})=>{if(t)return`${r}:${n}${i?`:${i}`:""}`;const a=r===this.min?"":r,o=n===this.max?"":n;return`${a}:${o}${i?`:${i}`:""}`}).join(",")}decode(t){if(typeof t<"u"&&(this.regionString=t),!this.regionString){this.segments=[];return}this.segments=this.regionString.split(",").map(r=>{const[n,i,a,o]=r.split(":");if(typeof o<"u")throw new Error(`there should be at most 2 ':' per region. Region: ${r}`);let s=n?Number(n):this.min,u=i?Number(i):this.max;const l=a!==""?a:void 0;if(s>u&&([s,u]=[u,s]),s<this.min&&(s=this.min),u>this.max&&(u=this.max),Number.isNaN(s))throw new Error(`The parsed value of ${n} is NaN. Region: ${r}`);if(Number.isNaN(u))throw new Error(`The parsed value of ${i} is NaN. Region: ${r}`);if(l&&!l.match(/^#[0-9a-f]{6,8}$/i))throw new Error(`The parsed value of ${a} is not a color in hex format. Region: ${r}`);return{start:s,end:u,color:l}})}}const I7="#FFEB3B66",QP=(e,t)=>e?t?`${e},${t}`:e:t;let b_e=class{constructor({element:t,min:r,max:n}){this.element=t,this.element._highlightcolor=I7,this.region=new y_e({min:r,max:n}),this.fixedHighlight=null}set max(t){this.region.max=t}setAttributesInElement(){this.region.decode(this.element.getAttribute("highlight")),this.region.segments.length===0&&(this.element._highlightstart=Number(this.element.getAttribute("highlightstart")),this.element._highlightend=Number(this.element.getAttribute("highlightend")),this.element._highlightcolor=this.element.getAttribute("highlightcolor")||I7,this.element._highlightstart!==null&&this.element._highlightend!==null&&typeof this.element._highlightstart=="number"&&typeof this.element._highlightend=="number"&&(this.element._highlight=`${this.element._highlightstart}:${this.element._highlightend}`,this.region.decode(QP(this.fixedHighlight,this.element._highlight))))}setFloatAttribute(t,r){const n=parseFloat(r);this.element[`_${t}`]=Number.isNaN(n)?r:n}changedCallBack(t,r){switch(t){case"highlightstart":case"highlightend":this.setFloatAttribute(t,r),this.element._highlight=Number.isNaN(this.element._highlightstart)||Number.isNaN(this.element._highlightend)||this.element._highlightstart===void 0||this.element._highlightend===void 0||this.element._highlightstart===null||this.element._highlightend===null?"":`${Math.max(this.region.min,this.element._highlightstart)}:${Math.min(this.region.max,this.element._highlightend)}`;break;default:this.element._highlight=r}this.region.decode(QP(this.fixedHighlight,this.element._highlight)),this.element.refresh()}setFixedHighlight(t){this.fixedHighlight=t,this.region.decode(QP(t,this.element._highlight)),this.element.refresh()}appendHighlightTo(t){this.highlighted=t.append("g").attr("class","highlighted")}updateHighlight(){const t=this.highlighted.selectAll("rect").data(this.region.segments);t.enter().append("rect").style("pointer-events","none").merge(t).attr("fill",r=>r.color?r.color:this.element._highlightcolor).attr("height",this.element._height).attr("x",r=>this.element.getXFromSeqPosition(r.start)).attr("width",r=>this.element.getSingleBaseWidth()*(r.end-r.start+1)),t.exit().remove()}},x_e=class{constructor(t,r=400){this.element=t,this.timeStampWheelOutside=0,this.resetScrollableTimeout=null,this.scrollDelay=r}setElementScrollable(t){this.element.setAttribute("scrollable",t)}startResetScrollableTimer(){this.resetScrollableTimeout&&clearTimeout(this.resetScrollableTimeout),this.resetScrollableTimeout=setTimeout(()=>{this.setElementScrollable(!0),this.resetScrollableTimeout=null},this.scrollDelay)}blockScroll(t){this.timeStampWheelOutside=t,this.setElementScrollable(!1),this.startResetScrollableTimer()}wheel({target:t,timeStamp:r}){this.element.contains(t)?r<this.timeStampWheelOutside+this.scrollDelay?this.blockScroll(r):this.setElementScrollable(!0):this.blockScroll(r)}};const JK=["left","right","top","bottom"],M7=JK.map(e=>`margin${e}`),S_e=(e,t={initialValue:{top:0,bottom:0,left:0,right:0}})=>{class r extends e{constructor(){super(),this.margin=t.initialValue}static get observedAttributes(){return[...super.observedAttributes,...M7]}attributeChangedCallback(i,a,o){a!==o&&M7.includes(i)&&(this[i]=o),super.attributeChangedCallback(i,a,o)}}for(const n of JK)Object.defineProperty(r.prototype,`margin${n}`,{get(){return this.margin[n]||0},set(i){this.margin[n]=+i}});return r},C_e=b_e,eQ=x_e,tQ=S_e;class __e extends HTMLElement{constructor(){super(),this._x=null,this._padding=0,this.height=40,this.dontDispatch=!1}_refreshWidth(){this.style.display="block",this.style.width="100%",this.width=this.offsetWidth-this.margin.left-this.margin.right,this.width>0&&(this._padding=10)}connectedCallback(){this._refreshWidth(),this.closest("protvista-manager")&&(this.manager=this.closest("protvista-manager"),this.manager.register(this)),this._length=parseFloat(this.getAttribute("length")),this._displaystart=parseFloat(this.getAttribute("displaystart"))||1,this._displayend=parseFloat(this.getAttribute("displayend"))||this._length,this._highlightStart=parseFloat(this.getAttribute("highlightStart")),this._highlightEnd=parseFloat(this.getAttribute("highlightEnd")),this._rulerstart=parseFloat(this.getAttribute("rulerStart"))||1,this._onResize=this._onResize.bind(this),this._createNavRuler()}disconnectedCallback(){this.manager&&this.manager.unregister(this),this._ro&&this._ro.unobserve(this),window.removeEventListener("resize",this._onResize)}static get observedAttributes(){return["length","displaystart","displayend","highlightStart","highlightEnd","width","rulerstart"]}attributeChangedCallback(t,r,n){r!==n&&(this[`_${t}`]=parseFloat(n),this._updateNavRuler())}get width(){return this._width}set width(t){this._width=t}_createNavRuler(){this._x=Jb().range([this._padding,this.width-this._padding]),this._x.domain([this._rulerstart,this._rulerstart+this._length-1]),Gi(this).selectAll("div").remove(),this._container=Gi(this).append("div").attr("class","container"),this._svg=this._container.append("svg").attr("id","").attr("width",this.width).attr("height",this.height),this._xAxis=aK(this._x),this._displaystartLabel=this._svg.append("text").attr("class","start-label").attr("x",0).attr("y",this.height-this._padding),this._displayendLabel=this._svg.append("text").attr("class","end-label").attr("x",this.width).attr("y",this.height-this._padding).attr("text-anchor","end"),this._axis=this._svg.append("g").attr("class","x axis").call(this._xAxis),this._viewport=yCe().extent([[this._padding,0],[this.width-this._padding,this.height*.51]]).on("brush",()=>{qt.selection&&(this._displaystart=p_("d")(this._x.invert(qt.selection[0])),this._displayend=p_("d")(this._x.invert(qt.selection[1])),this.dontDispatch||this.dispatchEvent(new CustomEvent("change",{detail:{displayend:this._displayend,displaystart:this._displaystart,extra:{transform:qt.transform}},bubbles:!0,cancelable:!0})),this._updateLabels(),this._updatePolygon())}),this._brushG=this._svg.append("g").attr("class","brush").call(this._viewport),this._brushG.call(this._viewport.move,[this._x(this._displaystart),this._x(this._displayend)]),this.polygon=this._svg.append("polygon").attr("class","zoom-polygon").attr("fill","#777").attr("fill-opacity","0.3"),this._updateNavRuler(),"ResizeObserver"in window&&(this._ro=new ResizeObserver(this._onResize),this._ro.observe(this)),window.addEventListener("resize",this._onResize)}_onResize(){this._refreshWidth(),this._x=this._x.range([this._padding,this.width-this._padding]),this._svg.attr("width",this.width),this._viewport.extent([[this._padding,0],[this.width-this._padding,this.height*.51]]),this._brushG.call(this._viewport),this._updateNavRuler()}_updateNavRuler(){this._x&&(this._container.style("padding-left",`${this.margin.left}px`).style("padding-right",`${this.margin.right}px`).style("padding-top",`${this.margin.top}px`).style("padding-bottom",`${this.margin.bottom}px`),this._x.domain([this._rulerstart,this._rulerstart+this._length-1]),this._axis.call(this._xAxis),this._updatePolygon(),this._updateLabels(),this._brushG&&(this.dontDispatch=!0,this._brushG.call(this._viewport.move,[this._x(this._displaystart),this._x(this._displayend)]),this.dontDispatch=!1))}_updateLabels(){this._displaystartLabel&&this._displaystartLabel.text(this._displaystart),this._displayendLabel&&this._displayendLabel.attr("x",this.width).text(this._displayend)}_updatePolygon(){this.polygon&&this.polygon.attr("points",`${this._x(this._displaystart)},${this.height/2}
        ${this._x(this._displayend)},${this.height/2}
        ${this.width},${this.height}
        0,${this.height}`)}}const w_e=tQ(__e),D7=16,R7=10,k7=10,O7=5,lx=(e,t=0)=>{const r=(e||"").match(/(\d+\.?\d*)px/);return r?+r[1]:t};class E_e extends Ap{static get properties(){return{title:{type:String,reflect:!0},x:{type:Number,reflect:!0},y:{type:Number,reflect:!0},visible:{type:Boolean,reflect:!0},container:{type:String,reflect:!0}}}constructor(){super(),this.title="",this.x=0,this.y=0,this.visible=!1,this.container="html",this._changeHandler=()=>this.requestUpdate(),this._observer=new MutationObserver(this._changeHandler)}connectedCallback(){super.connectedCallback(),this._observer.observe(this,{subtree:!0,characterData:!0,childList:!0}),window.addEventListener("resize",this._changeHandler)}disconnectedCallback(){super.disconnectedCallback(),this._observer.disconnect(),window.removeEventListener("resize",this._changeHandler)}static get styles(){return Js`
      :host {
        --z-index: 50000;
        --title-color: black;
        --text-color: white;
        --body-color: #616161;
        --triangle-width: ${D7}px;
        --triangle-height: ${R7}px;
        --triangle-margin: ${k7}px;
        --vertical-distance: ${O7}px;
      }

      h1,
      h2,
      h3,
      h4,
      h5,
      h6 {
        margin: 0;
      }

      h1 {
        background-color: var(--title-color);
        line-height: 2em;
        padding: 0 1ch;
      }

      .tooltip {
        font-family: Roboto, Arial, sans-serif;
        font-size: 0.9rem;
        top: 0;
        left: 0;
        display: block;
        position: absolute;
        min-width: 220px;
        max-width: 50vw;

        /* user overridable through custom properties */
        z-index: var(--z-index);
        color: var(--text-color);

        /* will change those */
        opacity: 0;
        pointer-events: none;
        transform: translate(0, 0);
      }

      .tooltip.visible {
        opacity: 0.9;
        pointer-events: auto;
      }

      .tooltip::before {
        content: "";
        position: absolute;
        pointer-events: none;
        border-style: solid;
        border-color: transparent;
        border-width: 0 calc(var(--triangle-width) / 2);
      }

      .tooltip.arrow-left::before {
        left: var(--triangle-margin);
      }

      .tooltip.arrow-right::before {
        right: var(--triangle-margin);
      }

      .tooltip.arrow-up::before {
        top: calc(-1 * var(--triangle-height));
        border-bottom-color: var(--title-color);
        border-bottom-width: var(--triangle-height);
      }

      .tooltip.arrow-down::before {
        bottom: calc(-1 * var(--triangle-height));
        border-top-color: var(--body-color);
        border-top-width: var(--triangle-height);
      }

      :host a,
      :host a:link,
      :host a:active,
      :host a:hover,
      ::slotted(a),
      ::slotted(a:link),
      ::slotted(a:active),
      ::slotted(a:hover) {
        color: #fff;
      }

      .tooltip-body {
        padding: 1em;
        background: var(--body-color);
        font-weight: normal;
        overflow-y: auto;
        max-height: 40vh;
      }

      ::slotted(h4) {
        font-size: 1.2rem !important;
        margin: 0 0 0.5rem 0 !important;
        font-weight: 600 !important;
        color: #fff !important;
      }

      ::slotted(h5) {
        font-size: 1rem !important;
        margin: 0 !important;
        font-weight: 500 !important;
        color: #fff !important;
      }

      ::slotted(h6) {
        font-size: 1rem !important;
        margin: 0 !important;
        font-weight: 300 !important;
        color: #fff !important;
      }

      ::slotted(p) {
        margin: 0.25rem 0 1rem 0 !important;
      }

      ::slotted(ul) {
        list-style: none !important;
        margin: 0.25rem 0 1rem 0 !important;
        padding: 0 !important;
      }
    `}_getPosition(){if(!this.shadowRoot.firstElementChild)return{};const r=document.querySelector(this.container||"html").getBoundingClientRect(),n=this.shadowRoot.firstElementChild.getBoundingClientRect(),i=getComputedStyle(this),a=lx(i.getPropertyValue("--triangle-width"),D7),o=lx(i.getPropertyValue("--triangle-height"),R7),s=lx(i.getPropertyValue("--triangle-margin"),k7),u=lx(i.getPropertyValue("--vertical-distance"),O7);let l=this.x-a/2-s,c="left";l+n.width<=r.right||(c="right",l=this.x-n.width+a/2+s);let f=this.y+o+u,p="up";return f+n.height<=r.height||(p="down",f=this.y-n.height-o-u),{x:l,y:f,horizontal:c,vertical:p}}firstUpdated(){this.requestUpdate()}render(){let t=this.title&&this.visible;const r=t?this._getPosition():{};t=r.x&&t;const n=t&&`transform: translate(${r.x}px, ${r.y}px);`;return Gr`
      <section
        class="tooltip arrow-${r.horizontal||"left"} arrow-${r.vertical||"up"} ${t?"visible":""}"
        style="${n}"
      >
        <h1>${this.title}</h1>
        <div class="tooltip-body"><slot></slot></div>
      </section>
    `}}function A_e(e,t,r,n){for(var i=e.length,a=r+(n?1:-1);n?a--:++a<i;)if(t(e[a],a,e))return a;return-1}function P_e(e){return e!==e}function T_e(e,t,r){for(var n=r-1,i=e.length;++n<i;)if(e[n]===t)return n;return-1}function rQ(e,t,r){return t===t?T_e(e,t,r):A_e(e,P_e,r)}var I_e=typeof global=="object"&&global&&global.Object===Object&&global;const nQ=I_e;var M_e=typeof self=="object"&&self&&self.Object===Object&&self,D_e=nQ||M_e||Function("return this")();const gd=D_e;var R_e=gd.Symbol;const Ol=R_e;var iQ=Object.prototype,k_e=iQ.hasOwnProperty,O_e=iQ.toString,ny=Ol?Ol.toStringTag:void 0;function L_e(e){var t=k_e.call(e,ny),r=e[ny];try{e[ny]=void 0;var n=!0}catch{}var i=O_e.call(e);return n&&(t?e[ny]=r:delete e[ny]),i}var F_e=Object.prototype,N_e=F_e.toString;function B_e(e){return N_e.call(e)}var U_e="[object Null]",j_e="[object Undefined]",L7=Ol?Ol.toStringTag:void 0;function Tv(e){return e==null?e===void 0?j_e:U_e:L7&&L7 in Object(e)?L_e(e):B_e(e)}function db(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}var z_e="[object AsyncFunction]",V_e="[object Function]",H_e="[object GeneratorFunction]",G_e="[object Proxy]";function aQ(e){if(!db(e))return!1;var t=Tv(e);return t==V_e||t==H_e||t==z_e||t==G_e}var q_e=9007199254740991;function BO(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=q_e}function e2(e){return e!=null&&BO(e.length)&&!aQ(e)}var $_e=Array.isArray;const ns=$_e;function sp(e){return e!=null&&typeof e=="object"}var W_e="[object String]";function X_e(e){return typeof e=="string"||!ns(e)&&sp(e)&&Tv(e)==W_e}var Y_e=/\s/;function K_e(e){for(var t=e.length;t--&&Y_e.test(e.charAt(t)););return t}var Q_e=/^\s+/;function Z_e(e){return e&&e.slice(0,K_e(e)+1).replace(Q_e,"")}var J_e="[object Symbol]";function Z3(e){return typeof e=="symbol"||sp(e)&&Tv(e)==J_e}var F7=0/0,ewe=/^[-+]0x[0-9a-f]+$/i,twe=/^0b[01]+$/i,rwe=/^0o[0-7]+$/i,nwe=parseInt;function iwe(e){if(typeof e=="number")return e;if(Z3(e))return F7;if(db(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=db(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=Z_e(e);var r=twe.test(e);return r||rwe.test(e)?nwe(e.slice(2),r?2:8):ewe.test(e)?F7:+e}var N7=1/0,awe=17976931348623157e292;function owe(e){if(!e)return e===0?e:0;if(e=iwe(e),e===N7||e===-N7){var t=e<0?-1:1;return t*awe}return e===e?e:0}function swe(e){var t=owe(e),r=t%1;return t===t?r?t-r:t:0}function t2(e,t){for(var r=-1,n=e==null?0:e.length,i=Array(n);++r<n;)i[r]=t(e[r],r,e);return i}function uwe(e,t){return t2(t,function(r){return e[r]})}function lwe(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n}var cwe="[object Arguments]";function B7(e){return sp(e)&&Tv(e)==cwe}var oQ=Object.prototype,dwe=oQ.hasOwnProperty,fwe=oQ.propertyIsEnumerable,pwe=B7(function(){return arguments}())?B7:function(e){return sp(e)&&dwe.call(e,"callee")&&!fwe.call(e,"callee")};const UO=pwe;function hwe(){return!1}var sQ=typeof Ic=="object"&&Ic&&!Ic.nodeType&&Ic,U7=sQ&&typeof Mc=="object"&&Mc&&!Mc.nodeType&&Mc,vwe=U7&&U7.exports===sQ,j7=vwe?gd.Buffer:void 0,mwe=j7?j7.isBuffer:void 0,gwe=mwe||hwe;const p5=gwe;var ywe=9007199254740991,bwe=/^(?:0|[1-9]\d*)$/;function uQ(e,t){var r=typeof e;return t=t??ywe,!!t&&(r=="number"||r!="symbol"&&bwe.test(e))&&e>-1&&e%1==0&&e<t}var xwe="[object Arguments]",Swe="[object Array]",Cwe="[object Boolean]",_we="[object Date]",wwe="[object Error]",Ewe="[object Function]",Awe="[object Map]",Pwe="[object Number]",Twe="[object Object]",Iwe="[object RegExp]",Mwe="[object Set]",Dwe="[object String]",Rwe="[object WeakMap]",kwe="[object ArrayBuffer]",Owe="[object DataView]",Lwe="[object Float32Array]",Fwe="[object Float64Array]",Nwe="[object Int8Array]",Bwe="[object Int16Array]",Uwe="[object Int32Array]",jwe="[object Uint8Array]",zwe="[object Uint8ClampedArray]",Vwe="[object Uint16Array]",Hwe="[object Uint32Array]",Hn={};Hn[Lwe]=Hn[Fwe]=Hn[Nwe]=Hn[Bwe]=Hn[Uwe]=Hn[jwe]=Hn[zwe]=Hn[Vwe]=Hn[Hwe]=!0;Hn[xwe]=Hn[Swe]=Hn[kwe]=Hn[Cwe]=Hn[Owe]=Hn[_we]=Hn[wwe]=Hn[Ewe]=Hn[Awe]=Hn[Pwe]=Hn[Twe]=Hn[Iwe]=Hn[Mwe]=Hn[Dwe]=Hn[Rwe]=!1;function Gwe(e){return sp(e)&&BO(e.length)&&!!Hn[Tv(e)]}function lQ(e){return function(t){return e(t)}}var cQ=typeof Ic=="object"&&Ic&&!Ic.nodeType&&Ic,c1=cQ&&typeof Mc=="object"&&Mc&&!Mc.nodeType&&Mc,qwe=c1&&c1.exports===cQ,ZP=qwe&&nQ.process,$we=function(){try{var e=c1&&c1.require&&c1.require("util").types;return e||ZP&&ZP.binding&&ZP.binding("util")}catch{}}();const z7=$we;var V7=z7&&z7.isTypedArray,Wwe=V7?lQ(V7):Gwe;const dQ=Wwe;var Xwe=Object.prototype,Ywe=Xwe.hasOwnProperty;function Kwe(e,t){var r=ns(e),n=!r&&UO(e),i=!r&&!n&&p5(e),a=!r&&!n&&!i&&dQ(e),o=r||n||i||a,s=o?lwe(e.length,String):[],u=s.length;for(var l in e)(t||Ywe.call(e,l))&&!(o&&(l=="length"||i&&(l=="offset"||l=="parent")||a&&(l=="buffer"||l=="byteLength"||l=="byteOffset")||uQ(l,u)))&&s.push(l);return s}var Qwe=Object.prototype;function Zwe(e){var t=e&&e.constructor,r=typeof t=="function"&&t.prototype||Qwe;return e===r}function Jwe(e,t){return function(r){return e(t(r))}}var e3e=Jwe(Object.keys,Object);const t3e=e3e;var r3e=Object.prototype,n3e=r3e.hasOwnProperty;function i3e(e){if(!Zwe(e))return t3e(e);var t=[];for(var r in Object(e))n3e.call(e,r)&&r!="constructor"&&t.push(r);return t}function J3(e){return e2(e)?Kwe(e):i3e(e)}function a3e(e){return e==null?[]:uwe(e,J3(e))}var o3e=Math.max;function s3e(e,t,r,n){e=e2(e)?e:a3e(e),r=r&&!n?swe(r):0;var i=e.length;return r<0&&(r=o3e(i+r,0)),X_e(e)?r<=i&&e.indexOf(t,r)>-1:!!i&&rQ(e,t,r)>-1}var u3e=gd["__core-js_shared__"];const JP=u3e;var H7=function(){var e=/[^.]+$/.exec(JP&&JP.keys&&JP.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}();function l3e(e){return!!H7&&H7 in e}var c3e=Function.prototype,d3e=c3e.toString;function Iv(e){if(e!=null){try{return d3e.call(e)}catch{}try{return e+""}catch{}}return""}var f3e=/[\\^$.*+?()[\]{}|]/g,p3e=/^\[object .+?Constructor\]$/,h3e=Function.prototype,v3e=Object.prototype,m3e=h3e.toString,g3e=v3e.hasOwnProperty,y3e=RegExp("^"+m3e.call(g3e).replace(f3e,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function b3e(e){if(!db(e)||l3e(e))return!1;var t=aQ(e)?y3e:p3e;return t.test(Iv(e))}function x3e(e,t){return e==null?void 0:e[t]}function Mv(e,t){var r=x3e(e,t);return b3e(r)?r:void 0}var S3e=function(){try{var e=Mv(Object,"defineProperty");return e({},"",{}),e}catch{}}();const m_=S3e;function C3e(e,t,r){t=="__proto__"&&m_?m_(e,t,{configurable:!0,enumerable:!0,value:r,writable:!0}):e[t]=r}function _3e(e,t,r,n){for(var i=-1,a=e==null?0:e.length;++i<a;){var o=e[i];t(n,o,r(o),e)}return n}function w3e(e){return function(t,r,n){for(var i=-1,a=Object(t),o=n(t),s=o.length;s--;){var u=o[e?s:++i];if(r(a[u],u,a)===!1)break}return t}}var E3e=w3e();const A3e=E3e;function P3e(e,t){return e&&A3e(e,t,J3)}function T3e(e,t){return function(r,n){if(r==null)return r;if(!e2(r))return e(r,n);for(var i=r.length,a=t?i:-1,o=Object(r);(t?a--:++a<i)&&n(o[a],a,o)!==!1;);return r}}var I3e=T3e(P3e);const fQ=I3e;function M3e(e,t,r,n){return fQ(e,function(i,a,o){t(n,i,r(i),o)}),n}function D3e(){this.__data__=[],this.size=0}function pQ(e,t){return e===t||e!==e&&t!==t}function eE(e,t){for(var r=e.length;r--;)if(pQ(e[r][0],t))return r;return-1}var R3e=Array.prototype,k3e=R3e.splice;function O3e(e){var t=this.__data__,r=eE(t,e);if(r<0)return!1;var n=t.length-1;return r==n?t.pop():k3e.call(t,r,1),--this.size,!0}function L3e(e){var t=this.__data__,r=eE(t,e);return r<0?void 0:t[r][1]}function F3e(e){return eE(this.__data__,e)>-1}function N3e(e,t){var r=this.__data__,n=eE(r,e);return n<0?(++this.size,r.push([e,t])):r[n][1]=t,this}function yd(e){var t=-1,r=e==null?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}yd.prototype.clear=D3e;yd.prototype.delete=O3e;yd.prototype.get=L3e;yd.prototype.has=F3e;yd.prototype.set=N3e;function B3e(){this.__data__=new yd,this.size=0}function U3e(e){var t=this.__data__,r=t.delete(e);return this.size=t.size,r}function j3e(e){return this.__data__.get(e)}function z3e(e){return this.__data__.has(e)}var V3e=Mv(gd,"Map");const fb=V3e;var H3e=Mv(Object,"create");const pb=H3e;function G3e(){this.__data__=pb?pb(null):{},this.size=0}function q3e(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}var $3e="__lodash_hash_undefined__",W3e=Object.prototype,X3e=W3e.hasOwnProperty;function Y3e(e){var t=this.__data__;if(pb){var r=t[e];return r===$3e?void 0:r}return X3e.call(t,e)?t[e]:void 0}var K3e=Object.prototype,Q3e=K3e.hasOwnProperty;function Z3e(e){var t=this.__data__;return pb?t[e]!==void 0:Q3e.call(t,e)}var J3e="__lodash_hash_undefined__";function eEe(e,t){var r=this.__data__;return this.size+=this.has(e)?0:1,r[e]=pb&&t===void 0?J3e:t,this}function av(e){var t=-1,r=e==null?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}av.prototype.clear=G3e;av.prototype.delete=q3e;av.prototype.get=Y3e;av.prototype.has=Z3e;av.prototype.set=eEe;function tEe(){this.size=0,this.__data__={hash:new av,map:new(fb||yd),string:new av}}function rEe(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null}function tE(e,t){var r=e.__data__;return rEe(t)?r[typeof t=="string"?"string":"hash"]:r.map}function nEe(e){var t=tE(this,e).delete(e);return this.size-=t?1:0,t}function iEe(e){return tE(this,e).get(e)}function aEe(e){return tE(this,e).has(e)}function oEe(e,t){var r=tE(this,e),n=r.size;return r.set(e,t),this.size+=r.size==n?0:1,this}function bd(e){var t=-1,r=e==null?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}bd.prototype.clear=tEe;bd.prototype.delete=nEe;bd.prototype.get=iEe;bd.prototype.has=aEe;bd.prototype.set=oEe;var sEe=200;function uEe(e,t){var r=this.__data__;if(r instanceof yd){var n=r.__data__;if(!fb||n.length<sEe-1)return n.push([e,t]),this.size=++r.size,this;r=this.__data__=new bd(n)}return r.set(e,t),this.size=r.size,this}function Oc(e){var t=this.__data__=new yd(e);this.size=t.size}Oc.prototype.clear=B3e;Oc.prototype.delete=U3e;Oc.prototype.get=j3e;Oc.prototype.has=z3e;Oc.prototype.set=uEe;var lEe="__lodash_hash_undefined__";function cEe(e){return this.__data__.set(e,lEe),this}function dEe(e){return this.__data__.has(e)}function jg(e){var t=-1,r=e==null?0:e.length;for(this.__data__=new bd;++t<r;)this.add(e[t])}jg.prototype.add=jg.prototype.push=cEe;jg.prototype.has=dEe;function fEe(e,t){for(var r=-1,n=e==null?0:e.length;++r<n;)if(t(e[r],r,e))return!0;return!1}function g_(e,t){return e.has(t)}var pEe=1,hEe=2;function hQ(e,t,r,n,i,a){var o=r&pEe,s=e.length,u=t.length;if(s!=u&&!(o&&u>s))return!1;var l=a.get(e),c=a.get(t);if(l&&c)return l==t&&c==e;var d=-1,f=!0,p=r&hEe?new jg:void 0;for(a.set(e,t),a.set(t,e);++d<s;){var v=e[d],h=t[d];if(n)var m=o?n(h,v,d,t,e,a):n(v,h,d,e,t,a);if(m!==void 0){if(m)continue;f=!1;break}if(p){if(!fEe(t,function(g,y){if(!g_(p,y)&&(v===g||i(v,g,r,n,a)))return p.push(y)})){f=!1;break}}else if(!(v===h||i(v,h,r,n,a))){f=!1;break}}return a.delete(e),a.delete(t),f}var vEe=gd.Uint8Array;const G7=vEe;function mEe(e){var t=-1,r=Array(e.size);return e.forEach(function(n,i){r[++t]=[i,n]}),r}function jO(e){var t=-1,r=Array(e.size);return e.forEach(function(n){r[++t]=n}),r}var gEe=1,yEe=2,bEe="[object Boolean]",xEe="[object Date]",SEe="[object Error]",CEe="[object Map]",_Ee="[object Number]",wEe="[object RegExp]",EEe="[object Set]",AEe="[object String]",PEe="[object Symbol]",TEe="[object ArrayBuffer]",IEe="[object DataView]",q7=Ol?Ol.prototype:void 0,e4=q7?q7.valueOf:void 0;function MEe(e,t,r,n,i,a,o){switch(r){case IEe:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case TEe:return!(e.byteLength!=t.byteLength||!a(new G7(e),new G7(t)));case bEe:case xEe:case _Ee:return pQ(+e,+t);case SEe:return e.name==t.name&&e.message==t.message;case wEe:case AEe:return e==t+"";case CEe:var s=mEe;case EEe:var u=n&gEe;if(s||(s=jO),e.size!=t.size&&!u)return!1;var l=o.get(e);if(l)return l==t;n|=yEe,o.set(e,t);var c=hQ(s(e),s(t),n,i,a,o);return o.delete(e),c;case PEe:if(e4)return e4.call(e)==e4.call(t)}return!1}function vQ(e,t){for(var r=-1,n=t.length,i=e.length;++r<n;)e[i+r]=t[r];return e}function DEe(e,t,r){var n=t(e);return ns(e)?n:vQ(n,r(e))}function REe(e,t){for(var r=-1,n=e==null?0:e.length,i=0,a=[];++r<n;){var o=e[r];t(o,r,e)&&(a[i++]=o)}return a}function kEe(){return[]}var OEe=Object.prototype,LEe=OEe.propertyIsEnumerable,$7=Object.getOwnPropertySymbols,FEe=$7?function(e){return e==null?[]:(e=Object(e),REe($7(e),function(t){return LEe.call(e,t)}))}:kEe;const NEe=FEe;function W7(e){return DEe(e,J3,NEe)}var BEe=1,UEe=Object.prototype,jEe=UEe.hasOwnProperty;function zEe(e,t,r,n,i,a){var o=r&BEe,s=W7(e),u=s.length,l=W7(t),c=l.length;if(u!=c&&!o)return!1;for(var d=u;d--;){var f=s[d];if(!(o?f in t:jEe.call(t,f)))return!1}var p=a.get(e),v=a.get(t);if(p&&v)return p==t&&v==e;var h=!0;a.set(e,t),a.set(t,e);for(var m=o;++d<u;){f=s[d];var g=e[f],y=t[f];if(n)var b=o?n(y,g,f,t,e,a):n(g,y,f,e,t,a);if(!(b===void 0?g===y||i(g,y,r,n,a):b)){h=!1;break}m||(m=f=="constructor")}if(h&&!m){var S=e.constructor,x=t.constructor;S!=x&&"constructor"in e&&"constructor"in t&&!(typeof S=="function"&&S instanceof S&&typeof x=="function"&&x instanceof x)&&(h=!1)}return a.delete(e),a.delete(t),h}var VEe=Mv(gd,"DataView");const h5=VEe;var HEe=Mv(gd,"Promise");const v5=HEe;var GEe=Mv(gd,"Set");const mg=GEe;var qEe=Mv(gd,"WeakMap");const m5=qEe;var X7="[object Map]",$Ee="[object Object]",Y7="[object Promise]",K7="[object Set]",Q7="[object WeakMap]",Z7="[object DataView]",WEe=Iv(h5),XEe=Iv(fb),YEe=Iv(v5),KEe=Iv(mg),QEe=Iv(m5),lh=Tv;(h5&&lh(new h5(new ArrayBuffer(1)))!=Z7||fb&&lh(new fb)!=X7||v5&&lh(v5.resolve())!=Y7||mg&&lh(new mg)!=K7||m5&&lh(new m5)!=Q7)&&(lh=function(e){var t=Tv(e),r=t==$Ee?e.constructor:void 0,n=r?Iv(r):"";if(n)switch(n){case WEe:return Z7;case XEe:return X7;case YEe:return Y7;case KEe:return K7;case QEe:return Q7}return t});const J7=lh;var ZEe=1,e9="[object Arguments]",t9="[object Array]",cx="[object Object]",JEe=Object.prototype,r9=JEe.hasOwnProperty;function eAe(e,t,r,n,i,a){var o=ns(e),s=ns(t),u=o?t9:J7(e),l=s?t9:J7(t);u=u==e9?cx:u,l=l==e9?cx:l;var c=u==cx,d=l==cx,f=u==l;if(f&&p5(e)){if(!p5(t))return!1;o=!0,c=!1}if(f&&!c)return a||(a=new Oc),o||dQ(e)?hQ(e,t,r,n,i,a):MEe(e,t,u,r,n,i,a);if(!(r&ZEe)){var p=c&&r9.call(e,"__wrapped__"),v=d&&r9.call(t,"__wrapped__");if(p||v){var h=p?e.value():e,m=v?t.value():t;return a||(a=new Oc),i(h,m,r,n,a)}}return f?(a||(a=new Oc),zEe(e,t,r,n,i,a)):!1}function zO(e,t,r,n,i){return e===t?!0:e==null||t==null||!sp(e)&&!sp(t)?e!==e&&t!==t:eAe(e,t,r,n,zO,i)}var tAe=1,rAe=2;function nAe(e,t,r,n){var i=r.length,a=i,o=!n;if(e==null)return!a;for(e=Object(e);i--;){var s=r[i];if(o&&s[2]?s[1]!==e[s[0]]:!(s[0]in e))return!1}for(;++i<a;){s=r[i];var u=s[0],l=e[u],c=s[1];if(o&&s[2]){if(l===void 0&&!(u in e))return!1}else{var d=new Oc;if(n)var f=n(l,c,u,e,t,d);if(!(f===void 0?zO(c,l,tAe|rAe,n,d):f))return!1}}return!0}function mQ(e){return e===e&&!db(e)}function iAe(e){for(var t=J3(e),r=t.length;r--;){var n=t[r],i=e[n];t[r]=[n,i,mQ(i)]}return t}function gQ(e,t){return function(r){return r==null?!1:r[e]===t&&(t!==void 0||e in Object(r))}}function aAe(e){var t=iAe(e);return t.length==1&&t[0][2]?gQ(t[0][0],t[0][1]):function(r){return r===e||nAe(r,e,t)}}var oAe=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,sAe=/^\w*$/;function VO(e,t){if(ns(e))return!1;var r=typeof e;return r=="number"||r=="symbol"||r=="boolean"||e==null||Z3(e)?!0:sAe.test(e)||!oAe.test(e)||t!=null&&e in Object(t)}var uAe="Expected a function";function HO(e,t){if(typeof e!="function"||t!=null&&typeof t!="function")throw new TypeError(uAe);var r=function(){var n=arguments,i=t?t.apply(this,n):n[0],a=r.cache;if(a.has(i))return a.get(i);var o=e.apply(this,n);return r.cache=a.set(i,o)||a,o};return r.cache=new(HO.Cache||bd),r}HO.Cache=bd;var lAe=500;function cAe(e){var t=HO(e,function(n){return r.size===lAe&&r.clear(),n}),r=t.cache;return t}var dAe=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,fAe=/\\(\\)?/g,pAe=cAe(function(e){var t=[];return e.charCodeAt(0)===46&&t.push(""),e.replace(dAe,function(r,n,i,a){t.push(i?a.replace(fAe,"$1"):n||r)}),t});const hAe=pAe;var vAe=1/0,n9=Ol?Ol.prototype:void 0,i9=n9?n9.toString:void 0;function yQ(e){if(typeof e=="string")return e;if(ns(e))return t2(e,yQ)+"";if(Z3(e))return i9?i9.call(e):"";var t=e+"";return t=="0"&&1/e==-vAe?"-0":t}function mAe(e){return e==null?"":yQ(e)}function bQ(e,t){return ns(e)?e:VO(e,t)?[e]:hAe(mAe(e))}var gAe=1/0;function rE(e){if(typeof e=="string"||Z3(e))return e;var t=e+"";return t=="0"&&1/e==-gAe?"-0":t}function xQ(e,t){t=bQ(t,e);for(var r=0,n=t.length;e!=null&&r<n;)e=e[rE(t[r++])];return r&&r==n?e:void 0}function yAe(e,t,r){var n=e==null?void 0:xQ(e,t);return n===void 0?r:n}function bAe(e,t){return e!=null&&t in Object(e)}function xAe(e,t,r){t=bQ(t,e);for(var n=-1,i=t.length,a=!1;++n<i;){var o=rE(t[n]);if(!(a=e!=null&&r(e,o)))break;e=e[o]}return a||++n!=i?a:(i=e==null?0:e.length,!!i&&BO(i)&&uQ(o,i)&&(ns(e)||UO(e)))}function SAe(e,t){return e!=null&&xAe(e,t,bAe)}var CAe=1,_Ae=2;function wAe(e,t){return VO(e)&&mQ(t)?gQ(rE(e),t):function(r){var n=yAe(r,e);return n===void 0&&n===t?SAe(r,e):zO(t,n,CAe|_Ae)}}function GO(e){return e}function EAe(e){return function(t){return t==null?void 0:t[e]}}function AAe(e){return function(t){return xQ(t,e)}}function PAe(e){return VO(e)?EAe(rE(e)):AAe(e)}function SQ(e){return typeof e=="function"?e:e==null?GO:typeof e=="object"?ns(e)?wAe(e[0],e[1]):aAe(e):PAe(e)}function TAe(e,t){return function(r,n){var i=ns(r)?_3e:M3e,a=t?t():{};return i(r,e,SQ(n),a)}}var IAe=Object.prototype,MAe=IAe.hasOwnProperty,DAe=TAe(function(e,t,r){MAe.call(e,r)?e[r].push(t):C3e(e,r,[t])});const zg=DAe;var a9=Ol?Ol.isConcatSpreadable:void 0;function RAe(e){return ns(e)||UO(e)||!!(a9&&e&&e[a9])}function qO(e,t,r,n,i){var a=-1,o=e.length;for(r||(r=RAe),i||(i=[]);++a<o;){var s=e[a];t>0&&r(s)?t>1?qO(s,t-1,r,n,i):vQ(i,s):n||(i[i.length]=s)}return i}function kAe(e,t,r){switch(r.length){case 0:return e.call(t);case 1:return e.call(t,r[0]);case 2:return e.call(t,r[0],r[1]);case 3:return e.call(t,r[0],r[1],r[2])}return e.apply(t,r)}var o9=Math.max;function OAe(e,t,r){return t=o9(t===void 0?e.length-1:t,0),function(){for(var n=arguments,i=-1,a=o9(n.length-t,0),o=Array(a);++i<a;)o[i]=n[t+i];i=-1;for(var s=Array(t+1);++i<t;)s[i]=n[i];return s[t]=r(o),kAe(e,this,s)}}function LAe(e){return function(){return e}}var FAe=m_?function(e,t){return m_(e,"toString",{configurable:!0,enumerable:!1,value:LAe(t),writable:!0})}:GO;const NAe=FAe;var BAe=800,UAe=16,jAe=Date.now;function zAe(e){var t=0,r=0;return function(){var n=jAe(),i=UAe-(n-r);if(r=n,i>0){if(++t>=BAe)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}var VAe=zAe(NAe);const HAe=VAe;function CQ(e,t){return HAe(OAe(e,t,GO),e+"")}function _Q(e,t){var r=e==null?0:e.length;return!!r&&rQ(e,t,0)>-1}function wQ(e,t,r){for(var n=-1,i=e==null?0:e.length;++n<i;)if(r(t,e[n]))return!0;return!1}function GAe(){}var qAe=1/0,$Ae=mg&&1/jO(new mg([,-0]))[1]==qAe?function(e){return new mg(e)}:GAe;const WAe=$Ae;var XAe=200;function YAe(e,t,r){var n=-1,i=_Q,a=e.length,o=!0,s=[],u=s;if(r)o=!1,i=wQ;else if(a>=XAe){var l=t?null:WAe(e);if(l)return jO(l);o=!1,i=g_,u=new jg}else u=t?[]:s;e:for(;++n<a;){var c=e[n],d=t?t(c):c;if(c=r||c!==0?c:0,o&&d===d){for(var f=u.length;f--;)if(u[f]===d)continue e;t&&u.push(d),s.push(c)}else i(u,d,r)||(u!==s&&u.push(d),s.push(c))}return s}function EQ(e){return sp(e)&&e2(e)}var KAe=CQ(function(e){return YAe(qO(e,1,EQ,!0))});const AQ=KAe;var QAe=Math.min;function ZAe(e,t,r){for(var n=r?wQ:_Q,i=e[0].length,a=e.length,o=a,s=Array(a),u=1/0,l=[];o--;){var c=e[o];o&&t&&(c=t2(c,lQ(t))),u=QAe(c.length,u),s[o]=!r&&(t||i>=120&&c.length>=120)?new jg(o&&c):void 0}c=e[0];var d=-1,f=s[0];e:for(;++d<i&&l.length<u;){var p=c[d],v=t?t(p):p;if(p=r||p!==0?p:0,!(f?g_(f,v):n(l,v,r))){for(o=a;--o;){var h=s[o];if(!(h?g_(h,v):n(e[o],v,r)))continue e}f&&f.push(v),l.push(p)}}return l}function JAe(e){return EQ(e)?e:[]}var ePe=CQ(function(e){var t=t2(e,JAe);return t.length&&t[0]===e[0]?ZAe(t):[]});const PQ=ePe;var TQ=function(){if(typeof Map<"u")return Map;function e(t,r){var n=-1;return t.some(function(i,a){return i[0]===r?(n=a,!0):!1}),n}return function(){function t(){this.__entries__=[]}return Object.defineProperty(t.prototype,"size",{get:function(){return this.__entries__.length},enumerable:!0,configurable:!0}),t.prototype.get=function(r){var n=e(this.__entries__,r),i=this.__entries__[n];return i&&i[1]},t.prototype.set=function(r,n){var i=e(this.__entries__,r);~i?this.__entries__[i][1]=n:this.__entries__.push([r,n])},t.prototype.delete=function(r){var n=this.__entries__,i=e(n,r);~i&&n.splice(i,1)},t.prototype.has=function(r){return!!~e(this.__entries__,r)},t.prototype.clear=function(){this.__entries__.splice(0)},t.prototype.forEach=function(r,n){n===void 0&&(n=null);for(var i=0,a=this.__entries__;i<a.length;i++){var o=a[i];r.call(n,o[1],o[0])}},t}()}(),g5=typeof window<"u"&&typeof document<"u"&&window.document===document,y_=function(){return typeof global<"u"&&global.Math===Math?global:typeof self<"u"&&self.Math===Math?self:typeof window<"u"&&window.Math===Math?window:Function("return this")()}(),tPe=function(){return typeof requestAnimationFrame=="function"?requestAnimationFrame.bind(y_):function(e){return setTimeout(function(){return e(Date.now())},1e3/60)}}(),rPe=2;function nPe(e,t){var r=!1,n=!1,i=0;function a(){r&&(r=!1,e()),n&&s()}function o(){tPe(a)}function s(){var u=Date.now();if(r){if(u-i<rPe)return;n=!0}else r=!0,n=!1,setTimeout(o,t);i=u}return s}var iPe=20,aPe=["top","right","bottom","left","width","height","size","weight"],oPe=typeof MutationObserver<"u",sPe=function(){function e(){this.connected_=!1,this.mutationEventsAdded_=!1,this.mutationsObserver_=null,this.observers_=[],this.onTransitionEnd_=this.onTransitionEnd_.bind(this),this.refresh=nPe(this.refresh.bind(this),iPe)}return e.prototype.addObserver=function(t){~this.observers_.indexOf(t)||this.observers_.push(t),this.connected_||this.connect_()},e.prototype.removeObserver=function(t){var r=this.observers_,n=r.indexOf(t);~n&&r.splice(n,1),!r.length&&this.connected_&&this.disconnect_()},e.prototype.refresh=function(){var t=this.updateObservers_();t&&this.refresh()},e.prototype.updateObservers_=function(){var t=this.observers_.filter(function(r){return r.gatherActive(),r.hasActive()});return t.forEach(function(r){return r.broadcastActive()}),t.length>0},e.prototype.connect_=function(){!g5||this.connected_||(document.addEventListener("transitionend",this.onTransitionEnd_),window.addEventListener("resize",this.refresh),oPe?(this.mutationsObserver_=new MutationObserver(this.refresh),this.mutationsObserver_.observe(document,{attributes:!0,childList:!0,characterData:!0,subtree:!0})):(document.addEventListener("DOMSubtreeModified",this.refresh),this.mutationEventsAdded_=!0),this.connected_=!0)},e.prototype.disconnect_=function(){!g5||!this.connected_||(document.removeEventListener("transitionend",this.onTransitionEnd_),window.removeEventListener("resize",this.refresh),this.mutationsObserver_&&this.mutationsObserver_.disconnect(),this.mutationEventsAdded_&&document.removeEventListener("DOMSubtreeModified",this.refresh),this.mutationsObserver_=null,this.mutationEventsAdded_=!1,this.connected_=!1)},e.prototype.onTransitionEnd_=function(t){var r=t.propertyName,n=r===void 0?"":r,i=aPe.some(function(a){return!!~n.indexOf(a)});i&&this.refresh()},e.getInstance=function(){return this.instance_||(this.instance_=new e),this.instance_},e.instance_=null,e}(),IQ=function(e,t){for(var r=0,n=Object.keys(t);r<n.length;r++){var i=n[r];Object.defineProperty(e,i,{value:t[i],enumerable:!1,writable:!1,configurable:!0})}return e},Vg=function(e){var t=e&&e.ownerDocument&&e.ownerDocument.defaultView;return t||y_},MQ=nE(0,0,0,0);function b_(e){return parseFloat(e)||0}function s9(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];return t.reduce(function(n,i){var a=e["border-"+i+"-width"];return n+b_(a)},0)}function uPe(e){for(var t=["top","right","bottom","left"],r={},n=0,i=t;n<i.length;n++){var a=i[n],o=e["padding-"+a];r[a]=b_(o)}return r}function lPe(e){var t=e.getBBox();return nE(0,0,t.width,t.height)}function cPe(e){var t=e.clientWidth,r=e.clientHeight;if(!t&&!r)return MQ;var n=Vg(e).getComputedStyle(e),i=uPe(n),a=i.left+i.right,o=i.top+i.bottom,s=b_(n.width),u=b_(n.height);if(n.boxSizing==="border-box"&&(Math.round(s+a)!==t&&(s-=s9(n,"left","right")+a),Math.round(u+o)!==r&&(u-=s9(n,"top","bottom")+o)),!fPe(e)){var l=Math.round(s+a)-t,c=Math.round(u+o)-r;Math.abs(l)!==1&&(s-=l),Math.abs(c)!==1&&(u-=c)}return nE(i.left,i.top,s,u)}var dPe=function(){return typeof SVGGraphicsElement<"u"?function(e){return e instanceof Vg(e).SVGGraphicsElement}:function(e){return e instanceof Vg(e).SVGElement&&typeof e.getBBox=="function"}}();function fPe(e){return e===Vg(e).document.documentElement}function pPe(e){return g5?dPe(e)?lPe(e):cPe(e):MQ}function hPe(e){var t=e.x,r=e.y,n=e.width,i=e.height,a=typeof DOMRectReadOnly<"u"?DOMRectReadOnly:Object,o=Object.create(a.prototype);return IQ(o,{x:t,y:r,width:n,height:i,top:r,right:t+n,bottom:i+r,left:t}),o}function nE(e,t,r,n){return{x:e,y:t,width:r,height:n}}var vPe=function(){function e(t){this.broadcastWidth=0,this.broadcastHeight=0,this.contentRect_=nE(0,0,0,0),this.target=t}return e.prototype.isActive=function(){var t=pPe(this.target);return this.contentRect_=t,t.width!==this.broadcastWidth||t.height!==this.broadcastHeight},e.prototype.broadcastRect=function(){var t=this.contentRect_;return this.broadcastWidth=t.width,this.broadcastHeight=t.height,t},e}(),mPe=function(){function e(t,r){var n=hPe(r);IQ(this,{target:t,contentRect:n})}return e}(),gPe=function(){function e(t,r,n){if(this.activeObservations_=[],this.observations_=new TQ,typeof t!="function")throw new TypeError("The callback provided as parameter 1 is not a function.");this.callback_=t,this.controller_=r,this.callbackCtx_=n}return e.prototype.observe=function(t){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if(!(typeof Element>"u"||!(Element instanceof Object))){if(!(t instanceof Vg(t).Element))throw new TypeError('parameter 1 is not of type "Element".');var r=this.observations_;r.has(t)||(r.set(t,new vPe(t)),this.controller_.addObserver(this),this.controller_.refresh())}},e.prototype.unobserve=function(t){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if(!(typeof Element>"u"||!(Element instanceof Object))){if(!(t instanceof Vg(t).Element))throw new TypeError('parameter 1 is not of type "Element".');var r=this.observations_;r.has(t)&&(r.delete(t),r.size||this.controller_.removeObserver(this))}},e.prototype.disconnect=function(){this.clearActive(),this.observations_.clear(),this.controller_.removeObserver(this)},e.prototype.gatherActive=function(){var t=this;this.clearActive(),this.observations_.forEach(function(r){r.isActive()&&t.activeObservations_.push(r)})},e.prototype.broadcastActive=function(){if(this.hasActive()){var t=this.callbackCtx_,r=this.activeObservations_.map(function(n){return new mPe(n.target,n.broadcastRect())});this.callback_.call(t,r,t),this.clearActive()}},e.prototype.clearActive=function(){this.activeObservations_.splice(0)},e.prototype.hasActive=function(){return this.activeObservations_.length>0},e}(),DQ=typeof WeakMap<"u"?new WeakMap:new TQ,RQ=function(){function e(t){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function.");if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");var r=sPe.getInstance(),n=new gPe(t,r,this);DQ.set(this,n)}return e}();["observe","unobserve","disconnect"].forEach(function(e){RQ.prototype[e]=function(){var t;return(t=DQ.get(this))[e].apply(t,arguments)}});var yPe=function(){return typeof y_.ResizeObserver<"u"?y_.ResizeObserver:RQ}();class x_ extends HTMLElement{constructor(){super(),x_._polyfillElementClosest(),this._updateScaleDomain=this._updateScaleDomain.bind(this),this._initZoom=this._initZoom.bind(this),this.zoomed=this.zoomed.bind(this),this._applyZoomTranslation=this.applyZoomTranslation.bind(this),this._resetEventHandler=this._resetEventHandler.bind(this);let t=!1;this.applyZoomTranslation=()=>{t||(t=!0,requestAnimationFrame(()=>{t=!1,this._applyZoomTranslation()}))},this._onResize=this._onResize.bind(this),this._listenForResize=this._listenForResize.bind(this),this.trackHighlighter=new C_e({element:this,min:1}),this.scrollFilter=new eQ(this),this.wheelListener=r=>this.scrollFilter.wheel(r)}connectedCallback(){this.style.display="block",this.style.width="100%",this.width=this.offsetWidth,this.closest("protvista-manager")&&(this.manager=this.closest("protvista-manager"),this.manager.register(this)),this._length=this.getAttribute("length")?parseFloat(this.getAttribute("length")):0,this._displaystart=this.getAttribute("displaystart")?parseFloat(this.getAttribute("displaystart")):1,this._displayend=this.getAttribute("displayend")?parseFloat(this.getAttribute("displayend")):this.length,this._height=this.getAttribute("height")?Number(this.getAttribute("height")):44,this._highlightEvent=this.getAttribute("highlight-event")?this.getAttribute("highlight-event"):"onclick",this.trackHighlighter.setAttributesInElement(this),this._updateScaleDomain(),this._originXScale=this.xScale.copy(),this._initZoom(),this._listenForResize(),this.addEventListener("error",t=>{console.error(t)}),this._highlightEvent!=="none"&&this.addEventListener("click",this._resetEventHandler),this.hasAttribute("filter-scroll")&&document.addEventListener("wheel",this.wheelListener,{capture:!0})}disconnectedCallback(){this.manager&&this.manager.unregister(this),this._ro?this._ro.unobserve(this):window.removeEventListener("resize",this._onResize),this._highlightEvent!=="none"&&this.removeEventListener("click",this._resetEventHandler),document.removeEventListener("wheel",this.wheelListener)}get width(){return this._width}set width(t){this._width=t}set height(t){this._height=t}get height(){return this._height}set length(t){this._length=t,this.trackHighlighter.max=t}get length(){return this._length}get xScale(){return this._xScale}set xScale(t){this._xScale=t}get zoom(){return this._zoom}set svg(t){this._svg=t,t.call(this._zoom),this.applyZoomTranslation()}get svg(){return this._svg}set fixedHighlight(t){this.trackHighlighter.setFixedHighlight(t)}getWidthWithMargins(){return this.width?this.width-this.margin.left-this.margin.right:0}_updateScaleDomain(){this.xScale=Jb().domain([1,this._length+1]).range([0,this.getWidthWithMargins()])}_initZoom(){this._zoom=g_e().scaleExtent([1,1/0]).translateExtent([[0,0],[this.getWidthWithMargins(),0]]).extent([[0,0],[this.getWidthWithMargins(),0]]).filter(()=>{if(!(qt instanceof WheelEvent))return!0;if(this.hasAttribute("scroll-filter")){const t=this.getAttribute("scrollable");if(t)return t==="true"}return!this.hasAttribute("use-ctrl-to-zoom")||qt.ctrlKey}).on("zoom",this.zoomed)}static get observedAttributes(){return["displaystart","displayend","length","highlight"]}setFloatAttribute(t,r){const n=parseFloat(r);this[`_${t}`]=Number.isNaN(n)?r:n}attributeChangedCallback(t,r,n){if(n==="null"&&(n=null),r!==n){if(t.startsWith("highlight")){this.trackHighlighter.changedCallBack(t,n);return}this.setFloatAttribute(t,n),t==="length"&&(this._updateScaleDomain(),this._originXScale=this.xScale.copy()),this.applyZoomTranslation()}}zoomed(){if(this.xScale=qt.transform.rescaleX(this._originXScale),this.dontDispatch)return;const[t,r]=this.xScale.domain();this.dispatchEvent(new CustomEvent("change",{detail:{displaystart:Math.max(1,t),displayend:Math.min(this.length,Math.max(r-1,t+1))},bubbles:!0,cancelable:!0}))}applyZoomTranslation(){if(!this.svg||!this._originXScale)return;const t=Math.max(1,this.length/(1+this._displayend-this._displaystart)),r=-this._originXScale(this._displaystart);this.dontDispatch=!0,this.svg.call(this.zoom.transform,NO.scale(t).translate(r,0)),this.dontDispatch=!1,this.refresh()}_onResize(){this.width=this.offsetWidth,this._updateScaleDomain(),this._originXScale=this.xScale.copy(),this.svg&&this.svg.attr("width",this.width),this._zoom.scaleExtent([1,1/0]).translateExtent([[0,0],[this.getWidthWithMargins(),0]]),this.applyZoomTranslation()}_listenForResize(){this._ro=new yPe(this._onResize),this._ro.observe(this)}_resetEventHandler(t){t.target.closest(".feature")||this.dispatchEvent(this.createEvent("reset",null,!0))}getXFromSeqPosition(t){return this.margin.left+this.xScale(t)}getSingleBaseWidth(){return this.xScale(2)-this.xScale(1)}static _getClickCoords(){return qt?[qt.pageX,qt.pageY]:null}static _polyfillElementClosest(){Element.prototype.matches||(Element.prototype.matches=Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector),Element.prototype.closest||(Element.prototype.closest=t=>{let r=this;do{if(r.matches(t))return r;r=r.parentElement||r.parentNode}while(r!==null&&r.nodeType===1);return null})}createEvent(t,r=null,n=!1,i=!1,a,o,s){r&&(r=r.feature?r.feature:r);const u={eventtype:t,coords:x_._getClickCoords(),feature:r,target:s};return n&&(r&&r.fragments?u.highlight=r.fragments.map(l=>`${l.start}:${l.end}`).join(","):qt&&qt.shiftKey&&this._highlight?u.highlight=`${this._highlight},${a}:${o}`:u.highlight=a&&o?`${a}:${o}`:null),i&&(u.selectedid=r&&r.protvistaFeatureId),new CustomEvent("change",{detail:u,bubbles:!0,cancelable:!0})}bindEvents(t,r){t.on("mouseover",(n,i,a)=>{r.dispatchEvent(r.createEvent("mouseover",n,r._highlightEvent==="onmouseover",!1,n.start,n.end,a[i]))}).on("mouseout",()=>{r.dispatchEvent(r.createEvent("mouseout",null,r._highlightEvent==="onmouseover"))}).on("click",(n,i,a)=>{r.dispatchEvent(r.createEvent("click",n,r._highlightEvent==="onclick",!0,n.start,n.end,a[i]))})}}const S_=tQ(x_,{initialValue:{top:10,right:10,bottom:10,left:10}}),Cn=10;class bPe{getFeatureShape(t,r,n,i){return i=i||"rectangle",this._ftLength=n,this._ftHeight=r,this._ftWidth=t*n,typeof this["_"+i]!="function"&&(i="rectangle"),this["_"+i]()}static isContinuous(t){return t=t.toLowerCase(),t!=="bridge"}_rectangle(){return"M0,0L"+this._ftWidth+",0L"+this._ftWidth+","+this._ftHeight+"L0,"+this._ftHeight+"Z"}_roundRectangle(){return"M6,0h"+(this._ftWidth-2*6)+",0a6,6 0 0 1 6,6v"+(this._ftHeight-2*6)+"a6,6 0 0 1 -6,6h"+(2*6-this._ftWidth)+"a6,6 0 0 1 -6,-6v"+(2*6-this._ftHeight)+"a6,6 0 0 1 6,-6Z"}_line(){return`M0,${this._ftHeight/2} L${this._ftWidth},${this._ftHeight/2}`}_bridge(){return this._ftLength!==1?"M0,"+this._ftHeight+"L0,0L"+this._ftWidth+",0L"+this._ftWidth+","+this._ftHeight+"L"+this._ftWidth+",2L0,2Z":"M0,"+this._ftHeight+"L0,"+this._ftHeight/2+"L"+this._ftWidth/2+","+this._ftHeight/2+"L"+this._ftWidth/2+",0L"+this._ftWidth/2+","+this._ftHeight/2+"L"+this._ftWidth+","+this._ftHeight/2+"L"+this._ftWidth+","+this._ftHeight+"Z"}_getMiddleLine(t){return"M0,"+t+"L"+this._ftWidth+","+t+"Z"}_diamond(){const t=Cn/2,r=this._ftWidth/2,n="M"+r+",0L"+(r+t)+","+t+"L"+r+","+Cn+"L"+(r-t)+","+t;return this._ftLength!==1?n+this._getMiddleLine(t,this._ftWidth):n+"Z"}_chevron(){const t=this._ftWidth/2,r=Cn/2,n="M"+t+","+r+"L"+(r+t)+",0L"+(r+t)+","+r+"L"+t+","+Cn+"L"+(-r+t)+","+r+"L"+(-r+t)+",0";return this._ftLength!==1?n+"L"+t+","+r+this._getMiddleLine(r,this._ftWidth)+"Z":n+"Z"}_catFace(){const t=Cn/2,r=Cn/10,n=this._ftWidth/2,i="M"+(-t+n)+",0L"+(-t+n)+","+6*r+"L"+(-2*r+n)+","+Cn+"L"+(2*r+n)+","+Cn+"L"+(t+n)+","+6*r+"L"+(t+n)+",0L"+(2*r+n)+","+4*r+"L"+(-2*r+n)+","+4*r;return this._ftLength!==1?i+"M"+n+",0"+this._getMiddleLine(t,this._ftWidth)+"Z":i+"Z"}_triangle(){const t=Cn/2,r=this._ftWidth/2,n="M"+r+",0L"+(t+r)+","+Cn+"L"+(-t+r)+","+Cn;return this._ftLength!==1?n+"L"+r+",0"+this._getMiddleLine(t,this._ftWidth)+"Z":n+"Z"}_wave(){const t=Cn/4,r=Cn/2,n=this._ftWidth/2,i="M"+(-Cn/2+n)+","+r+"A"+t+","+r+" 0 1,1 "+n+","+r+"A"+t+","+r+" 0 1,0 "+(Cn/2+n)+","+r;return this._ftLength!==1?i+this._getMiddleLine(r,this._ftWidth)+"Z":i+"Z"}_getPolygon(t){const r=Cn/2;let n="M ";const i=this._ftWidth/2;for(let a=0;a<t;a++)n+=r*Math.cos(2*Math.PI*a/t)+i+","+(r*Math.sin(2*Math.PI*a/t)+r)+" ";return this._ftLength!==1?n+" "+(r*Math.cos(0)+i)+","+(r*Math.sin(0)+r)+" "+this._getMiddleLine(r,this._ftWidth)+"Z":n+"Z"}_hexagon(){return this._getPolygon(6)}_pentagon(){return this._getPolygon(5)}_circle(){const t=this._ftWidth/2,r=Math.sqrt(Cn/Math.PI),n="M"+t+",0A"+r+","+r+" 0 1,1 "+t+","+Cn+"A"+r+","+r+" 0 1,1 "+t+",0";return this._ftLength!==1?n+this._getMiddleLine(Cn/2,this._ftWidth)+"Z":n+"Z"}_arrow(){const t=Cn/10,r=this._ftWidth/2,n="M"+r+",0L"+(-t+r)+",0L"+(-5*t+r)+","+4*t+"L"+(-t+r)+","+this._ftHeight+"L"+r+","+this._ftHeight+"L"+(4*t+r)+","+4*t;return this._ftLength!==1?n+"L"+r+",0"+this._getMiddleLine(Cn/2,this._ftWidth)+"Z":n+"Z"}_doubleBar(){const t=this._ftWidth/2,r=Cn/2,n="M"+t+",0L"+(-r+t)+","+Cn+"L"+t+","+Cn+"L"+(r+t)+",0";return this._ftLength!==1?n+"L"+t+",0"+this._getMiddleLine(Cn/2,this._ftWidth)+"Z":n+"Z"}_getBrokenEnd(){const t=this._ftHeight/4;return"L"+(this._ftWidth-t)+","+t+"L"+this._ftWidth+","+2*t+"L"+(this._ftWidth-t)+","+3*t+"L"+this._ftWidth+","+this._ftHeight}_getBrokenStart(){const t=this._ftHeight/4;return"L"+t+","+3*t+"L0,"+2*t+"L"+t+","+t}_discontinuosStart(){return"M0,0L"+this._ftWidth+",0L"+this._ftWidth+","+this._ftHeight+"L0,"+this._ftHeight+this._getBrokenStart()+"Z"}_discontinuos(){return"M0,0L"+this._ftWidth+",0"+this._getBrokenEnd()+"L0,"+this._ftHeight+this._getBrokenStart()+"Z"}_discontinuosEnd(){return"M0,0L"+this._ftWidth+",0"+this._getBrokenEnd()+"L0,"+this._ftHeight+"Z"}_helix(){const t=Cn/2,r=Cn/4;let n=t/2;const i=Math.round(this._ftWidth/t);let a="";for(let o=0;o<i;o++){const s="M"+(-(t/2)+n)+","+this._ftHeight+" C"+(n+r)+","+3*r+" "+(t/2+n)+","+r+" "+n+", 0 C"+(n-r)+","+r+" "+n+","+3*r+" "+(t/2+n)+","+this._ftHeight;a+=s,n+=t}return a}_strand(){let t=0;this._ftWidth>Cn/2&&(t=this._ftWidth-Cn/2);const r=this._ftHeight/4,n="M0,"+r+"L"+t+","+r+"L"+t+","+3*r+"L0,"+3*r+"L0,"+r,i="M"+t+",0L"+this._ftWidth+","+2*r+"L"+t+","+this._ftHeight+"Z";return n+i}}class $O{constructor({layoutHeight:t,padding:r=1,minHeight:n=17}){this._padding=r,this._minHeight=n,this._layoutHeight=t}init(t){this._features=t}getFeatureYPos(){const t=this.getFeatureHeight();return this._layoutHeight/2-t/2}getFeatureHeight(){return Math.min(this._layoutHeight,this._minHeight)-this._padding}}const xPe=(e,t)=>!(Number(t.start)>Number(e.end)||Number(t.end)<Number(e.start)),SPe=(e,t)=>t.some(r=>xPe(e,r));class CPe extends $O{constructor(t){super(t),this.featuresMap=new Map,this._rowHeight=0,this._rows=[],this._minHeight=15}init(t){t.forEach(r=>{const n=this._rows.findIndex(i=>!SPe(r,i));n>=0?(this._rows[n].push(r),this.featuresMap.set(r,n)):(this._rows.push([r]),this.featuresMap.set(r,this._rows.length-1))}),this._rowHeight=Math.min(this._layoutHeight/this._rows.length,this._minHeight)}getOffset(){return this._rows.length*this._rowHeight<this._layoutHeight?this._layoutHeight/2-this._rows.length*this._rowHeight/2:0}getFeatureYPos(t){const r=this.featuresMap.get(t);return this.getOffset()+this._rowHeight*r+2*this._padding}getFeatureHeight(){return this._rowHeight-2*this._padding}}const gg={CHAIN:{name:"chain",label:"Chain",tooltip:"(aka mature region). This describes the extent of a polypeptide chain in the mature protein following processing",shape:"rectangle",color:"#CC9933"},TRANSIT:{name:"transit peptide",label:"Transit peptide",tooltip:"This describes the extent of a transit peptide",shape:"rectangle",color:"#009966"},INIT_MET:{name:"initiator methionine",label:"Initiator methionine",tooltip:"This indicates that the initiator methionine is cleaved from the mature protein",shape:"arrow",color:"#996633"},PROPEP:{name:"propeptide",label:"Propeptide",tooltip:"Part of a protein that is cleaved during maturation or activation",shape:"rectangle",color:"#99CCCC"},PEPTIDE:{name:"peptide",label:"Peptide",tooltip:"The position and length of an active peptide in the mature protein",shape:"rectangle",color:"#006699"},SIGNAL:{name:"signal peptide",label:"Signal peptide",tooltip:"N-terminal signal peptide",shape:"rectangle",color:"#CC0033"},HELIX:{name:"helix",label:"Helix",tooltip:"The positions of experimentally determined helical regions",shape:"rectangle",color:"#FF0066"},STRAND:{name:"strand",label:"Beta strand",tooltip:"The positions of experimentally determined beta strands",shape:"rectangle",color:"#FFCC00"},TURN:{name:"turn",label:"Turn",tooltip:"The positions of experimentally determined hydrogen-bonded turns",shape:"rectangle",color:"#0571AF"},DISULFID:{name:"disulfide bond",label:"Disulfide bond",tooltip:"The positions of cysteine residues participating in disulphide bonds",shape:"bridge",color:"#23B14D"},CROSSLNK:{name:"cross-link",label:"Cross-link",tooltip:"Covalent linkages of various types formed between two proteins or between two parts of the same protein",shape:"bridge",color:"#FF6600"},REGION:{name:"region of interest",label:"Region of interest",tooltip:"Regions in multifunctional enzymes or fusion proteins, or characteristics of a region, e.g., protein-protein interactions mediation",shape:"rectangle",color:"#B33E00"},COILED:{name:"coiled-coil region",label:"Coiled-coil region",tooltip:"Coiled coils are built by two or more alpha-helices that wind around each other to form a supercoil",shape:"rectangle",color:"#006699"},MOTIF:{name:"short sequence motif",label:"Short sequence motif",tooltip:"Short conserved sequence motif of biological significance",shape:"rectangle",color:"#402060"},REPEAT:{name:"repeat",label:"Repeat",tooltip:"Repeated sequence motifs or repeated domains within the protein",shape:"rectangle",color:"#9900FF"},CA_BIND:{name:"calcium-binding region",label:"Calcium-binding region",tooltip:"Calcium-binding regions, such as the EF-hand motif",shape:"rectangle",color:"#FF3399"},DNA_BIND:{name:"DNA-binding region",label:"DNA binding",tooltip:"DNA-binding domains such as AP2/ERF domain, the ETS domain, the Fork-Head domain, the HMG box and the Myb domain",shape:"rectangle",color:"#009933"},DOMAIN:{name:"other domain of interest",label:"Other domain of interest",tooltip:"Specific combination of secondary structures organized into a characteristic three-dimensional structure or fold",shape:"rectangle",color:"#9999FF"},ZN_FING:{name:"zinc finger region",label:"Zinc finger",tooltip:"Small, functional, independently folded domain that coordinates one or more zinc ions",shape:"rectangle",color:"#990066"},NP_BIND:{name:"nucleotide-binding region",label:"Nucleotide-binding region",tooltip:"(aka flavin-binding). Region in the protein which binds nucleotide phosphates",shape:"rectangle",color:"#FF9900"},METAL:{name:"metal ion-binding site",label:"Metal ion-binding site",tooltip:"Binding site for a metal ion",shape:"diamond",color:"#009900"},SITE:{name:"other site of interest",label:"Other site of interest",tooltip:"Any interesting single amino acid site on the sequence",shape:"chevron",color:"#660033"},BINDING:{name:"other binding site",label:"Other binding site",tooltip:"Binding site for any chemical group (co-enzyme, prosthetic group, etc.)",shape:"rectangle",color:"#catFace"},ACT_SITE:{name:"active site",label:"Active site",tooltip:"Amino acid(s) directly involved in the activity of an enzyme",shape:"circle",color:"#FF6666"},MOD_RES:{name:"Post-translationally modified residue",label:"Modified residue",tooltip:"Modified residues such as phosphorylation, acetylation, acylation, methylation",shape:"triangle",color:"#000066"},LIPID:{name:"lipid moiety-binding region",label:"Lipidation",tooltip:"Covalently attached lipid group(s)",shape:"wave",color:"#99CC33"},CARBOHYD:{name:"glycosylation site",label:"Glycosylation",tooltip:"Covalently attached glycan group(s)",shape:"hexagon",color:"#CC3366"},COMPBIAS:{name:"compositionally biased region",label:"Compositionally biased region",tooltip:"Position of regions of compositional bias within the protein and the particular amino acids that are over-represented within those regions",shape:"rectangle",color:"#FF3366"},CONFLICT:{name:"sequence conflict",label:"Sequence conflict",tooltip:"Sequence discrepancies of unknown origin",shape:"rectangle",color:"#6633CC"},NON_CONS:{name:"non-consecutive residues",label:"Non-adjacent residues",tooltip:"Indicates that two residues in a sequence are not consecutive and that there is an undetermined number of unsequenced residues between them",shape:"doubleBar",color:"#FF0033"},NON_TER:{name:"non-terminal residue",label:"Non-terminal residue",tooltip:"The sequence is incomplete. The residue is not the terminal residue of the complete protein",shape:"doubleBar",color:"#339933"},UNSURE:{name:"unsure residue",label:"Sequence uncertainty",tooltip:"Regions of a sequence for which the authors are unsure about the sequence assignment",shape:"rectangle",color:"#33FF00"},NON_STD:{name:"non-standard amino acid",label:"Non-standard residue",tooltip:"Non-standard amino acids (selenocysteine and pyrrolysine)",shape:"pentagon",color:"#330066"},MUTAGEN:{name:"mutagenesis site",label:"Mutagenesis",tooltip:"Site which has been experimentally altered by mutagenesis",shape:"rectangle",color:"#FF9900"},TOPO_DOM:{name:"topological domain",label:"Topological domain",tooltip:"Location of non-membrane regions of membrane-spanning proteins",shape:"rectangle",color:"#CC0000"},TRANSMEM:{name:"transmembrane region",label:"Transmembrane",tooltip:"Extent of a membrane-spanning region",shape:"rectangle",color:"#CC00CC"},INTRAMEM:{name:"intramembrane region",label:"Intramembrane",tooltip:"Extent of a region located in a membrane without crossing it",shape:"rectangle",color:"#0000CC"},VAR_SEQ:{name:"splice variant",label:"Splice variant",tooltip:"",shape:"rectangle",color:"#CC11CC"},VARIANT:{name:"sequence variant",label:"Natural variant",tooltip:"Natural variant of the protein, including polymorphisms, variations between strains, isolates or cultivars, disease-associated mutations and RNA editing events",shape:"circle",color:"black"},UNIQUE:{name:"unique",label:"Unique peptide",tooltip:"",shape:"rectangle",color:"#fc3133"},NON_UNIQUE:{name:"non-unique",label:"Non-unique peptide",tooltip:"",shape:"rectangle",color:"#8585fc"},ANTIGEN:{name:"antigen",label:"Antibody binding sequences",tooltip:"",shape:"rectangle",color:"#996699"},PDBE_COVER:{name:"pdbe coverage",label:"PDBe 3D structure coverage",tooltip:"",shape:"rectangle",color:"#669966"}},u9=e=>{if(gg[e.toUpperCase()])return gg[e.toUpperCase()].shape;const t=Object.values(gg).find(r=>r.name.toUpperCase()===e.toUpperCase());return t?t.shape:"rectangle"},l9=e=>{if(gg[e.toUpperCase()])return gg[e.toUpperCase()].color;const t=Object.values(gg).find(r=>r.name.toUpperCase()===e.toUpperCase());return t||console.log(e),t?t.color:"black"};class ov extends S_{getLayout(){return String(this.getAttribute("layout")).toLowerCase()==="non-overlapping"?new CPe({layoutHeight:this._height}):new $O({layoutHeight:this._height})}connectedCallback(){super.connectedCallback(),this._color=this.getAttribute("color"),this._shape=this.getAttribute("shape"),this._featureShape=new bPe,this._layoutObj=this.getLayout(),this._data&&this._createTrack(),this.addEventListener("load",t=>{s3e(this.children,t.target)&&(this.data=t.detail.payload)})}static normalizeLocations(t){return t.map(r=>{const{locations:n,start:i,end:a}=r;return n?r:Object.assign(r,{locations:[{fragments:[{start:i,end:a}]}]})})}processData(t){this._originalData=ov.normalizeLocations(t)}set data(t){this.processData(t),this._applyFilters(),this._layoutObj=this.getLayout(),this._createTrack()}set filters(t){this._filters=t,this._applyFilters(),this._createTrack()}static get observedAttributes(){return S_.observedAttributes.concat(["highlight","color","shape","filters"])}_getFeatureColor(t){return t.color?t.color:t.feature&&t.feature.color?t.feature.color:this._color?this._color:t.type?l9(t.type):t.feature&&t.feature.type?l9(t.feature.type):"black"}_getFeatureFillColor(t){return t.fill?t.fill:t.feature&&t.feature.fill?t.feature.fill:this._getFeatureColor(t)}_getShape(t){return t.shape?t.shape:t.feature&&t.feature.shape?t.feature.shape:this._shape?this._shape:t.type?u9(t.type):t.feature&&t.feature.type?u9(t.feature.type):"rectangle"}_createTrack(){this._layoutObj.init(this._data),Gi(this).selectAll("div").remove(),this.svg=Gi(this).append("div").style("line-height",0).append("svg").attr("width",this.width).attr("height",this._height),this.trackHighlighter.appendHighlightTo(this.svg),this.seq_g=this.svg.append("g").attr("class","sequence-features"),this._createFeatures()}_createFeatures(){this.featuresG=this.seq_g.selectAll("g.feature-group").data(this._data),this.locations=this.featuresG.enter().append("g").attr("class","feature-group").attr("id",n=>`g_${n.accession}`).selectAll("g.location-group").data(n=>n.locations.map(i=>Object.assign({},i,{feature:n}))).enter().append("g").attr("class","location-group");const t=this.locations.selectAll("g.fragment-group").data(n=>n.fragments.map(i=>Object.assign({},i,{feature:n.feature}))).enter().append("g").attr("class","fragment-group");t.append("path").attr("class",n=>`${this._getShape(n)} feature`).attr("d",n=>this._featureShape.getFeatureShape(this.getSingleBaseWidth(),this._layoutObj.getFeatureHeight(n),n.end?n.end-n.start+1:1,this._getShape(n))).attr("transform",n=>`translate(${this.getXFromSeqPosition(n.start)},${this._layoutObj.getFeatureYPos(n.feature)})`).attr("fill",n=>this._getFeatureFillColor(n)).attr("stroke",n=>this._getFeatureColor(n)).style("fill-opacity",({feature:n})=>n.opacity?n.opacity:.9).style("stroke-opacity",({feature:n})=>n.opacity?n.opacity:.9);const r=t.selectAll("g.residue-group").data(n=>{var i;return n.feature.ptms?[(i=n.feature.ptms)==null?void 0:i.map(a=>Object.assign({},a,{feature:n.feature,position:a.position}))]:[]}).enter().append("g").attr("class","residue-group");t.append("rect").attr("class","outer-rectangle feature").attr("width",n=>this.getSingleBaseWidth()*(n.end?n.end-n.start+1:1)).attr("height",n=>this._layoutObj.getFeatureHeight(n)).attr("transform",n=>`translate(${this.getXFromSeqPosition(n.start)},${this._layoutObj.getFeatureYPos(n.feature)})`).attr("fill","transparent").attr("stroke","transparent").call(this.bindEvents,this),r.selectAll("g.residue").data(n=>n).enter().append("path").attr("class",n=>`${this._getShape(n)} residue`).attr("d",n=>{let i=1;return this.length>500&&(i=this.getSingleBaseWidth()<4?4:1),this._featureShape.getFeatureShape(this.getSingleBaseWidth()/2,this._layoutObj.getFeatureHeight(),i,this._getShape(n))}).attr("transform",n=>`translate(${this.getXFromSeqPosition(Number(n.feature.start)+Number(n.position)-1)+this.getSingleBaseWidth()/4},
          ${this._layoutObj.getFeatureYPos(n.feature)})`).attr("fill","#06038D").style("fill-opacity",({feature:n})=>n.opacity?n.opacity:.9).style("stroke-opacity",({feature:n})=>n.opacity?n.opacity:.9).call(this.bindEvents,this)}_applyFilters(){if(!this._filters||this._filters.length<=0){this._data=this._originalData;return}const t=zg(this._filters,"category"),r=Object.values(t).map(i=>{const a=i.map(o=>o.filterFn(this._originalData));return AQ(...a)}),n=PQ(...r);this._data=n}refresh(){if(this.xScale&&this.seq_g){const t=this.seq_g.selectAll("g.fragment-group").data(this._data.reduce((n,i)=>n.concat(i.locations.reduce((a,o)=>a.concat(o.fragments.map(s=>Object.assign({},s,{feature:i}))),[])),[])),r=this.seq_g.selectAll("g.residue-group").data(this._data.reduce((n,i)=>{var a;return n.concat([(a=i.ptms)==null?void 0:a.reduce(o=>o.concat(s=>Object.assign({},s,{feature:i,position:s.position})),[])])},[]));t.selectAll("path.feature").attr("d",n=>this._featureShape.getFeatureShape(this.getSingleBaseWidth(),this._layoutObj.getFeatureHeight(n),n.end?n.end-n.start+1:1,this._getShape(n))).attr("transform",n=>`translate(${this.getXFromSeqPosition(n.start)},${this._layoutObj.getFeatureYPos(n.feature)})`),r.selectAll("path.residue").attr("d",n=>{let i=1;return this.length>500&&(i=this.getSingleBaseWidth()<4?4:1),this._featureShape.getFeatureShape(this.getSingleBaseWidth()/2,this._layoutObj.getFeatureHeight(n),i,this._getShape(n))}).attr("transform",n=>`translate(${this.getXFromSeqPosition(Number(n.feature.start)+Number(n.position)-1)+this.getSingleBaseWidth()/4},${this._layoutObj.getFeatureYPos(n.feature)})`),t.selectAll("rect.outer-rectangle").attr("width",n=>this.getSingleBaseWidth()*(n.end?n.end-n.start+1:1)).attr("height",n=>this._layoutObj.getFeatureHeight(n)).attr("transform",n=>`translate(${this.getXFromSeqPosition(n.start)},${this._layoutObj.getFeatureYPos(n.feature)})`),this._updateHighlight()}}_updateHighlight(){this.trackHighlighter.updateHighlight()}}const c9=16,_Pe=14,dx=10;class d1 extends $O{init(t,r){let n=0;if(this.height={},this.yPos={},this.maxYPos=0,!t)return;this.innerPadding=(c9-dx)/2;const i={};for(let a=0;a<t.length;a++){const o=t[a];this.height[o.accession]=this.expanded?_Pe:c9,this.yPos[o.accession]=this._padding,n=this.height[o.accession]+2*this._padding,this.maxYPos=Math.max(this.maxYPos,n),o.accession in i||(i[o.accession]={}),o.residues&&(n=this._initResidues(o.residues,o.accession,o.locations,this.expanded?n:this.yPos[o.accession],a,i,this.expanded))}if(r)for(let a=0;a<r.length;a++){const o=r[a];o.accession in this.height||(this.height[o.accession]=dx,this.yPos[o.accession]=(this.expanded?this.maxYPos:this.innerPadding)+this._padding,n+=2*this._padding+(this.expanded?this.height[o.accession]:0),this.maxYPos=Math.max(this.maxYPos,n)),o.accession in i||(i[o.accession]={}),o.residues&&(n=this._initResidues(o.residues,o.accession,o.locations,o.expanded?n:this.yPos[o.accession],a,i,o.expanded))}this.maxYPos+=this._padding}_initResidues(t,r,n,i,a,o={},s=!0){for(let u=0;u<t.length;u++){const l=t[u];d1._filterOutResidueFragmentsOutOfLocation(l,n),l.accession in o[r]||(o[r][l.accession]={});for(let c=0;c<l.locations.length;c++){const d=l.locations[c].description;d in o[r][l.accession]||(o[r][l.accession][d]={height:s?dx:this.height[r]-2*this.innerPadding,yPos:s?this.maxYPos+this._padding:i+this.innerPadding},i=s?this.maxYPos+2*this._padding+dx:i),this.height[`${l.accession}_${a}_${u}_${c}`]=o[r][l.accession][d].height,this.yPos[`${l.accession}_${a}_${u}_${c}`]=o[r][l.accession][d].yPos,this.maxYPos=Math.max(this.maxYPos,i)}}return s?i:this.maxYPos+2*this._padding}static _filterOutResidueFragmentsOutOfLocation(t,r){t.locations.forEach(n=>n.fragments=n.fragments.filter(i=>r.some(a=>a.fragments.some(o=>i.start>=o.start&&i.end<=o.end)))),t.locations=t.locations.filter(n=>n.fragments.length)}static _getAccFromFeature(t){let r="";return typeof t=="string"?r=t:t.accession&&(r=t.accession),r}getFeatureYPos(t){const r=d1._getAccFromFeature(t);return r in this.yPos?this.yPos[r]:0}getFeatureHeight(t){const r=d1._getAccFromFeature(t);return r in this.height?this.height[r]:0}}const d9=(e,t)=>{let r={value:1,...e};const n=[];for(const i of t)r?r.end<i.start?(n.push(r),r=null,n.push(i)):r.start<i.start&&r.end>=i.end?(n.push({start:r.start,end:i.start-1,value:r.value}),n.push({start:i.start,end:i.end,value:i.value+r.value}),r=i.end===r.end?null:{start:i.end+1,end:r.end,value:r.value}):i.start<r.start&&i.end>r.end?(n.push({start:i.start,end:r.start-1,value:i.value}),n.push({start:r.start,end:r.end,value:i.value+r.value}),n.push({start:r.end+1,end:i.end,value:i.value}),r=null):i.end>=r.start&&i.end<=r.end?(i.start<r.start&&n.push({start:i.start,end:r.start-1,value:i.value}),n.push({start:r.start,end:i.end,value:i.value+r.value}),r=i.end<r.end?{start:i.end+1,end:r.end,value:r.value}:null):r.end>=i.start&&r.end<i.end?(n.push({start:r.start,end:i.start-1,value:r.value}),n.push({start:i.start,end:r.end,value:i.value+r.value}),n.push({start:r.end+1,end:i.end,value:i.value}),r=null):n.push(i):n.push(i);return r&&n.push(r),n},wPe=(e,t=100,r=!0)=>{let n=[];return r&&(n=d9({start:1,end:t,value:0},n)),e.forEach(i=>i.locations.forEach(a=>a.fragments.forEach(o=>{n=d9(o,n)}))),n},iy={top:2,right:10,bottom:2,left:10},f9=.8,p9=.3,EPe=e=>(e+p9)/(1+p9);class f1 extends ov{_createTrack(){this._layoutObj.expanded=this._expanded,super._createTrack(),this.children_g=null}connectedCallback(){super.connectedCallback(),this._expanded=this.hasAttribute("expanded"),this._haveCreatedFeatures=!1}attributeChangedCallback(t,r,n){if(t==="expanded"&&r!==n&&this._contributors)for(const i of this._contributors)i.expanded=!r;super.attributeChangedCallback(t,r,n)}set contributors(t){this._contributors=f1.normalizeLocations(t),this._coverage=wPe(this._contributors,this._length),this._data&&this._createTrack()}getLayout(){return new d1({layoutHeight:this._height,expanded:this._expanded,padding:2})}static get observedAttributes(){return ov.observedAttributes.concat(["expanded","color"])}set color(t){this._color!==t&&(this._color=t,this.refresh())}static _createResidueGroup(t){return t.selectAll("g.residues-group").data(r=>r.residues?r.residues.map((n,i)=>({...n,feature:r,i})):[]).enter().append("g").attr("class","residues-group").selectAll("g.residues-locations").data(r=>r.locations.map((n,i)=>({...n,accession:r.accession,feature:r.feature,location:n,i:r.i,j:i}))).enter().append("g").attr("class","residues-locations")}_createResiduePaths(t){return t.selectAll("g.residue").data(r=>r.fragments.map(n=>({...n,accession:r.accession,feature:{...r.feature,currentResidue:{...n,description:r.location.description}},location:r.location,k:r.feature.k,i:r.i,j:r.j}))).enter().append("path").attr("class","feature rectangle residue").attr("d",r=>this._featureShape.getFeatureShape(this.getSingleBaseWidth(),this._layoutObj.getFeatureHeight(`${r.accession}_${r.k}_${r.i}_${r.j}`),r.end?r.end-r.start+1:1,"rectangle")).attr("transform",r=>`translate(${this.getXFromSeqPosition(r.start)},${iy.top+this._layoutObj.getFeatureYPos(`${r.accession}_${r.k}_${r.i}_${r.j}`)})`).attr("fill",r=>this._getFeatureColor(r)).attr("stroke","transparent").call(this.bindEvents,this)}_refreshResiduePaths(t,r){const n=new Set(t.data().map(i=>`${i.feature.accession}-${i.location.description}`)).size;t.attr("d",i=>this._featureShape.getFeatureShape(this.getSingleBaseWidth(),this._layoutObj.getFeatureHeight(`${i.accession}_${i.k}_${i.i}_${i.j}`),i.end?i.end-i.start+1:1,"rectangle")).attr("transform",i=>`translate(${this.getXFromSeqPosition(i.start)},${iy.top+this._layoutObj.getFeatureYPos(`${i.accession}_${i.k}_${i.i}_${i.j}`)})`).style("pointer-events",i=>r||i.feature&&i.feature.expanded?"auto":"none").style("stroke",()=>r?null:"none").style("opacity",()=>r?null:f9/n).attr("fill",i=>r||i.feature&&i.feature.expanded?this._getFeatureColor(i):"white")}_createFeatures(){if(this._layoutObj.init(this._data,this._contributors),this._data.forEach((t,r)=>t.k=r),this.featuresG=this.seq_g.selectAll("g.feature-group").data(this._data).enter().append("g").attr("class","feature-group").attr("id",t=>`g_${t.accession}`),this.locations=this.featuresG.selectAll("g.location-group").data(t=>t.locations.map(r=>({...r,feature:t}))).enter().append("g").attr("class","location-group"),this.coverLines=this.locations.selectAll("line.cover").data(t=>[t.fragments.reduce((r,n)=>({start:Math.min(r.start,n.start),end:Math.max(r.end,n.end),feature:t.feature}),{start:1/0,end:-1/0})]).enter().append("line").attr("class","cover"),this.features=this.locations.selectAll("path.feature").data(t=>t.fragments.map(r=>({...r,feature:t.feature,fragments:t.fragments}))).enter().append("path").attr("class",t=>`${this._getShape(t)} feature`).on("click.expanded",()=>{this._expanded?this.removeAttribute("expanded"):this.setAttribute("expanded","expanded")}).call(this.bindEvents,this),this.residues_g=f1._createResidueGroup(this.featuresG),this.residues_loc=this._createResiduePaths(this.residues_g),this._contributors){this._contributors.forEach((r,n)=>r.k=n),this.children_g||(this.children_g=this.svg.append("g").attr("class","children-features")),this.childrenGroup=this.children_g.append("g").attr("class","children-group"),this.childGroup=this.childrenGroup.selectAll("g.child-group").data(this._contributors).enter().append("g").attr("class","child-group");const t=this.childGroup.selectAll("g.child-location-group").data(r=>(r.expanded=this._expanded,r.locations.map(n=>({...n,feature:r})))).enter().append("g").attr("class",(r,n)=>`child-location-group clg-${n}`);this.coverLinesChildren=t.selectAll("line.cover").data(r=>[r.fragments.reduce((n,i)=>({start:Math.min(n.start,i.start),end:Math.max(n.end,i.end),feature:r.feature}),{start:1/0,end:-1/0})]).enter().append("line").attr("class","cover"),this.featureChildren=t.selectAll("path.child-fragment").data(r=>r.fragments.map(n=>({...n,feature:r.feature,fragments:r.fragments}))).enter().append("path").attr("class",r=>`${this._getShape(r)} child-fragment feature`).call(this.bindEvents,this).on("click.expanded",r=>{r.feature.expanded=!r.feature.expanded,this.refresh()}),this.child_residues_g=f1._createResidueGroup(this.childGroup),this.child_residues_loc=this._createResiduePaths(this.child_residues_g),this._coverage&&this._coverage.length&&this._createCoverage()}this.svg.attr("height",this._layoutObj.maxYPos),this._haveCreatedFeatures=!0}_createCoverage(){this._accession=this._data&&this._data[0]&&this._data[0].accession||"_",this.coverage_mask=this.svg.append("defs").append("mask").attr("id",`mask-${this._accession}`),this.coverageMaskFragment=this.coverage_mask.selectAll("rect").data(this._coverage).enter().append("rect").attr("y",0).attr("height",this._height)}_refreshCoverage(){this.featuresG.attr("mask",this._expanded?null:`url(#mask-${this._accession})`),this.coverageMaskFragment.attr("x",t=>this.getXFromSeqPosition(t.start)).attr("width",t=>this.getSingleBaseWidth()*(t.end-t.start+1)).attr("fill","white").attr("opacity",t=>EPe(t.value/this._contributors.length))}_refreshFeatures(t,r=!0){const n=new Set(t.data().map(i=>i.feature.accession)).size;t.attr("d",i=>this._featureShape.getFeatureShape(this.getSingleBaseWidth(),this._layoutObj.getFeatureHeight(i.feature),i.end?i.end-i.start+1:1,r?this._getShape(i.shape?i:i.feature):"rectangle")).attr("fill",i=>r?this._getFeatureColor(i.feature):"white").attr("opacity",r?1:f9/n).style("stroke",i=>r?this._getFeatureColor(i.feature):"none").attr("transform",i=>`translate(${this.getXFromSeqPosition(i.start)},${iy.top+this._layoutObj.getFeatureYPos(i.feature)})`).style("pointer-events",r?"auto":"none")}_refreshCoverLine(t,r=!0){t.attr("x1",n=>this.getXFromSeqPosition(n.start)).attr("x2",n=>this.getXFromSeqPosition(n.end+1)).attr("y1",n=>iy.top+this._layoutObj.getFeatureYPos(n.feature)+this._layoutObj.getFeatureHeight(n.feature)/2).attr("y2",n=>iy.top+this._layoutObj.getFeatureYPos(n.feature)+this._layoutObj.getFeatureHeight(n.feature)/2).attr("stroke",n=>this._getFeatureColor(n.feature)).attr("visibility",r?"visible":"hidden")}refresh(){this._haveCreatedFeatures&&(this._layoutObj.expanded=this._expanded,this._layoutObj.init(this._data,this._contributors),this.height=this._layoutObj.maxYPos,this._refreshCoverLine(this.coverLines),this._refreshFeatures(this.features),this._refreshResiduePaths(this.residues_loc,this._expanded),this._contributors&&(this.childrenGroup.attr("visibility",this._expanded?"visible":"hidden"),this._refreshCoverLine(this.coverLinesChildren,this._expanded),this._refreshFeatures(this.featureChildren,this._expanded),this.child_residues_g.attr("visibility",()=>this._expanded?"visible":"hidden"),this._refreshResiduePaths(this.child_residues_loc),this._coverage&&this._coverage.length&&this._refreshCoverage()),this._updateHighlight(),this.svg.attr("height",this._layoutObj.maxYPos))}}const APe=3;class PPe extends S_{connectedCallback(){super.connectedCallback(),this.sequence=this.getAttribute("sequence");const t=this.getAttribute("numberofticks");this.numberOfTicks=Number.isInteger(parseInt(t,10))?t:APe,this.sequence&&this._createSequence(),this.addEventListener("load",r=>{this.data=r.detail.payload})}static get observedAttributes(){return S_.observedAttributes.concat("highlightstart","highlightend")}get data(){return this.sequence}set data(t){typeof t=="string"?this.sequence=t:"sequence"in t&&(this.sequence=t.sequence),this.sequence&&!super.svg?this._createSequence():this.refresh()}_getCharSize(){if(!this.seq_g)return;const t=.8,r=1.6,n=this.seq_g.select("text.base").node();if(n)this.chWidth=n.getBBox().width*t,this.chHeight=n.getBBox().height*r;else{const i=this.seq_g.append("text").attr("class","base").text("T");this.chWidth=i.node().getBBox().width*t,this.chHeight=i.node().getBBox().height*r,i.remove()}}_createSequence(){Gi(this).selectAll("div").remove(),super.svg=Gi(this).append("div").attr("class","").append("svg").attr("id","").attr("width",this.width).attr("height",this._height),this.seq_bg=super.svg.append("g").attr("class","background"),this.axis=super.svg.append("g").attr("class","x axis"),this.seq_g=super.svg.append("g").attr("class","sequence").attr("transform",`translate(0,${.75*this._height})`),this.trackHighlighter.appendHighlightTo(this.svg),this.refresh()}refresh(){if(this._getCharSize(),this.axis){const t=this.getSingleBaseWidth(),r=t-this.chWidth,n=t/2,i=Math.round(Math.max(0,this._displaystart-2)),a=Math.round(Math.min(this.sequence.length,this._displayend+1)),o=r<0?[]:this.sequence.slice(i,a).split("").map((s,u)=>({start:1+i+u,end:1+i+u,aa:s}));this.height>this.chHeight&&(this.xAxis=aK(this.xScale).tickFormat(s=>Number.isInteger(s)?s:"").ticks(this.numberOfTicks,"s"),this.axis.call(this.xAxis)),this.axis.attr("transform",`translate(${this.margin.left+n},0)`),this.axis.select(".domain").remove(),this.axis.selectAll(".tick line").remove(),this.bases=this.seq_g.selectAll("text.base").data(o,s=>s.start),this.bases.enter().append("text").attr("class","base").attr("text-anchor","middle").attr("x",s=>this.getXFromSeqPosition(s.start)+n).text(s=>s.aa).style("pointer-events","none").style("font-family","monospace"),this.bases.exit().remove(),this.bases.attr("x",s=>this.getXFromSeqPosition(s.start)+n),this.background=this.seq_bg.selectAll("rect.base_bg").data(o,s=>s.start),this.background.enter().append("rect").attr("class","base_bg feature").attr("height",this._height).merge(this.background).attr("width",t).attr("fill",s=>Math.round(s.start)%2?"#ccc":"#eee").attr("x",s=>this.getXFromSeqPosition(s.start)).call(this.bindEvents,this),this.background.exit().remove(),this.seq_g.style("opacity",Math.min(1,r)),this.background.style("opacity",Math.min(1,r)),this._updateHighlight()}}_updateHighlight(){this.trackHighlighter.updateHighlight()}}function TPe(e){const{variants:t,sequence:r}=e;if(!r||!t)return null;const i=r.split("").map((a,o)=>({type:"VARIANT",normal:a,pos:o+1,variants:[]}));return t.forEach(a=>{i[a.start-1]&&i[a.start-1].variants.push(a)}),i}class IPe{constructor(){this._frequency=WK().exponent(.001).domain([0,1]).range([5,10]),this.drawVariationPlot=this.drawVariationPlot.bind(this)}drawVariationPlot(t,r){const i=r.getSingleBaseWidth()/2;t.each((a,o,s)=>{const u=Gi(s[o]),l=a.filter(f=>f.variants.length!==0),c=u.selectAll("g").data(l,f=>f.pos);c.exit().remove();const d=c.enter().append("g").merge(c).selectAll("circle").data(f=>f.variants);d.exit().remove(),d.enter().append("circle").merge(d).attr("class","feature").attr("title",f=>f.start).attr("r",f=>f.size?f.size:5).attr("cx",f=>r.getXFromSeqPosition(f.start)+i).attr("cy",f=>r._yScale(f.variant.charAt(0))).attr("name",f=>{const p=f.alternativeSequence==="*"?"STOP":f.alternativeSequence;return f.internalId=`var_${f.wildType}${f.start}${p}`,f.internalId}).attr("fill",f=>f.color?f.color:r._colorConfig(f)).call(r.bindEvents,r)})}}const MPe=["G","A","V","L","I","S","T","C","M","D","N","E","Q","R","K","H","F","Y","W","P","d","*"],h9=(e,t)=>{if(!e||e.length<=0)return null;const r=e[0];return r.forEach((n,i)=>{const a=e.map(o=>o[i].variants);n.variants=t(...a)}),r};class WO extends ov{connectedCallback(){super.connectedCallback();const t=document.createElement("style");t.innerHTML=WO.css,this.appendChild(t),this._height=Number(this.getAttribute("height"))?Number(this.getAttribute("height")):430,this._width=this._width?this._width:0,this._yScale=Jb(),this._yScale=LCe().domain(MPe).range([0,this._height-this.margin.top-this.margin.bottom])}processData(t){this._originalData=TPe(t)}static get css(){return`
    <style>
    protvista-variation {
      display: flex;
      width: 100%;
    }
    
    protvista-variation svg {
      background-color: #fff;
    }
    
    protvista-variation circle {
      opacity: 0.6;
    }
    protvista-variation circle:hover {
      opacity: 0.9;
    }
    protvista-variation .tick line,
    protvista-variation .axis path {
      opacity: 0.1;
    }
    
    .protvista-highlight {
      fill: #ffe999;
    }
    
    protvista-variation .variation-y-right line,
    protvista-variation .axis path {
      fill: none;
      stroke: none;
    }
    
    </style>
    `}_createFeatures(){this._variationPlot=new IPe;const t=super.svg.select("g.sequence-features"),r=t.attr("transform",`translate(0, ${this.margin.top})`).append("g");this._series=r.datum(this._data),this._axisLeft=t.append("g"),this._axisRight=t.append("g"),this.updateScale()}set filters(t){super.filters=t,this.updateData(this._data),this.refresh()}_applyFilters(){if(!this._filters||this._filters.length<=0){this._data=this._originalData;return}const t=zg(this._filters,"category"),r=Object.values(t).map(n=>{const i=n.map(a=>a.filterFn(this._originalData));return h9(i,AQ)});this._data=h9(r,PQ)}set colorConfig(t){this._colorConfig=t}get colorConfig(){return this._colorConfig}refresh(){this._series&&(this.updateScale(),this._series.call(this._variationPlot.drawVariationPlot,this),this._updateHighlight())}updateScale(){this._yAxisLScale=i2e().scale(this._yScale).tickSize(-this.getWidthWithMargins()),this._yAxisRScale=n2e().scale(this._yScale),this._axisLeft.attr("class","variation-y-left axis").attr("transform",`translate(${this.margin.left},0)`).call(this._yAxisLScale),this._axisRight.attr("transform",`translate(${this.getWidthWithMargins()-this.margin.right+2}, 0)`).attr("class","variation-y-right axis").call(this._yAxisRScale)}updateData(t){this._series&&this._series.datum(t)}}class DPe extends ov{constructor(){super(),this._line=XCe().x((t,r)=>this.getXFromSeqPosition(r+1)-this.getSingleBaseWidth()/2).y(t=>this._yScale(t))}init(){this._totalsArray={total:null,diseaseTotal:null}}connectedCallback(){super.connectedCallback(),this._data=void 0,this._height=Number(this.getAttribute("height"))||40,this._yScale=Jb(),this.init()}set data(t){if(this.init(),!(!t.sequence||t.variants.length<=0)){this._totalsArray.total=new Uint8ClampedArray(t.sequence.length),this._totalsArray.diseaseTotal=new Uint8ClampedArray(t.sequence.length);for(const{start:r,association:n}of t.variants){const i=+r;if(i<1||i>t.sequence.length||(this._totalsArray.total[i]++,!n))continue;n.find(o=>o.disease===!0)&&this._totalsArray.diseaseTotal[i]++}this._createTrack()}}_createTrack(){Gi(this).selectAll("svg").remove(),this.svg=Gi(this).append("svg").attr("width",this.width).attr("height",this._height),this.trackHighlighter.appendHighlightTo(this.svg),this._initYScale(),this.refresh()}_initYScale(){this._yScale.domain([0,Math.max(H8(this._totalsArray.total),H8(this._totalsArray.diseaseTotal))]).range([this._height,0])}refresh(){this.svg&&(this.svg.selectAll("path").remove(),this.svg.append("path").attr("d",this._line(this._totalsArray.diseaseTotal)).attr("fill","none").attr("stroke","red").attr("transform","translate(0,0)"),this.svg.append("path").attr("d",this._line(this._totalsArray.total)).attr("fill","none").attr("stroke","darkgrey").attr("transform","translate(0,0)"),this._updateHighlight())}}class RPe extends Ap{static get properties(){return{filters:{type:Array},selectedFilters:{type:Set},for:{type:String}}}constructor(){super(),this.filters=[],this.selectedFilters=new Set}connectedCallback(){super.connectedCallback(),this.addEventListener("filterChange",this._onFilterChange),this.closest("protvista-manager")&&(this.manager=this.closest("protvista-manager"),this.manager.register(this))}disconnectedCallback(){super.disconnectedCallback(),this.manager&&this.manager.unregister(this),this.removeEventListener("filterChange",this._onFilterChange)}static get styles(){return Js`
      :host {
        font-size: 0.8rem;
      }

      :host[disabled] {
        opacity: 0.5;
      }

      .protvista_checkbox {
        position: relative;
        cursor: pointer;
        box-sizing: border-box;
        display: flex;
        align-items: center;
        margin-top: 10px;
        line-height: 24px;
        outline: none;
      }

      .protvista_checkbox_input {
        position: absolute;
        opacity: 0;
        cursor: pointer;
        height: 0;
        width: 0;
      }

      .checkmark {
        opacity: 0.4;
        height: 25px;
        width: 25px;
        background-color: #eee;
        border-radius: 4px;
        box-sizing: border-box;
        border: 1px solid #bdc3c7;
      }

      .protvista_checkbox_input:checked ~ .checkmark {
        opacity: 1;
      }

      .protvista_checkbox_label {
        margin-left: 0.2rem;
        line-height: 1rem;
      }
    `}render(){const t=zg(this.filters,r=>r.type.text);return Gr`
      ${Object.keys(t).map(r=>Gr`
            <h4>${r}</h4>
            <div>
              ${t[r].map(n=>Gr`
                    ${this.getCheckBox(n)}
                  `)}
            </div>
          `)}
    `}getCheckBox(t){const{name:r,options:n}=t,{labels:i}=n;n.colors.length==null&&(n.colors=[n.colors]);const a=n.colors.length>1;return Gr`
      <label
        class="protvista_checkbox ${a?"compound":""}"
        tabindex="0"
      >
        <input
          type="checkbox"
          class="protvista_checkbox_input"
          ?checked="true"
          .value="${r}"
          @change="${()=>this.toggleFilter(r)}"
        />
        <span
          class="checkmark"
          style=${`background: ${a?`
            linear-gradient(${n.colors[0]},
            ${n.colors[1]})
          `:n.colors[0]};`}
        ></span>
        <span class="protvista_checkbox_label">
          ${i.join("/")}
        </span>
      </label>
    `}toggleFilter(t){this.selectedFilters.has(t)?this.selectedFilters.delete(t):this.selectedFilters.add(t),this.dispatchEvent(new CustomEvent("change",{bubbles:!0,composed:!0,detail:{type:"filters",handler:"property",for:this.for,value:this.filters.filter(r=>this.selectedFilters.has(r.name)).map(r=>({category:r.type.name,filterFn:r.filterData}))}}))}}const fx="length",px="displaystart",hx="displayend",vx="highlight";class C_ extends HTMLElement{constructor(){super(),this.protvistaElements=new Set,this.attributeValues=new Map,this.propertyValues=new Map,this.mouseOver=!1}static get observedAttributes(){return["attributes",fx,px,hx,vx]}set length(t){this.attributeValues.set(fx,t)}get length(){return this.attributeValues.get(fx)}set displaystart(t){this.attributeValues.set(px,t)}get displaystart(){return this.attributeValues.get(px)}set displayend(t){this.attributeValues.set(hx,t)}get displayend(){return this.attributeValues.get(hx)}set highlight(t){this.attributeValues.set(vx,t)}get highlight(){return this.attributeValues.get(vx)}attributeChangedCallback(t,r,n){if(r!==n){if(t==="attributes"){if(this._attributes=n.split(" "),this._attributes.indexOf("type")!==-1)throw new Error("'type' can't be used as a protvista attribute");if(this._attributes.indexOf("value")!==-1)throw new Error("'value' can't be used as a protvista attribute");this.attributeValues=new Map(this._attributes.filter(i=>!C_.observedAttributes.includes(i)).map(i=>[i,null]))}else t===fx&&(this.length=n),t===px&&(this.displaystart=n),t===hx&&(this.displayend=n),t===vx&&(this.highlight=n);this.applyAttributes()}}register(t){this.protvistaElements.add(t),this.applyAttributes()}unregister(t){this.protvistaElements.delete(t)}_polyfillElementClosest(){Element.prototype.matches||(Element.prototype.matches=Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector),Element.prototype.closest||(Element.prototype.closest=t=>{let r=this;do{if(r.matches(t))return r;r=r.parentElement||r.parentNode}while(r!==null&&r.nodeType===1);return null})}applyAttributes(){this.protvistaElements.forEach(t=>{this.attributeValues.forEach((r,n)=>{r===!1||r===null||r===void 0?t.removeAttribute(n):t.setAttribute(n,typeof r=="boolean"?"":r)})})}applyProperties(t){if(t){const r=this.querySelector(`#${t}`);this.propertyValues.forEach((n,i)=>{r[i]=n})}else this.protvistaElements.forEach(r=>{this.propertyValues.forEach((n,i)=>{r[i]=n})})}isRegisteredAttribute(t){return[...this.attributeValues.keys()].includes(t)||C_.observedAttributes.includes(t)}_changeListener(t){if(t.detail)switch(t.detail.handler){case"property":this.propertyValues.set(t.detail.type,t.detail.value),this.applyProperties(t.detail.for);break;default:this.isRegisteredAttribute(t.detail.type)&&this.attributeValues.set(t.detail.type,t.detail.value),Object.keys(t.detail).forEach(r=>{this.isRegisteredAttribute(r)&&this.attributeValues.set(r,t.detail[r])}),this.applyAttributes()}}connectedCallback(){this.addEventListener("change",this._changeListener)}}var kPe=globalThis&&globalThis.__awaiter||function(e,t,r,n){function i(a){return a instanceof r?a:new r(function(o){o(a)})}return new(r||(r=Promise))(function(a,o){function s(c){try{l(n.next(c))}catch(d){o(d)}}function u(c){try{l(n.throw(c))}catch(d){o(d)}}function l(c){c.done?a(c.value):i(c.value).then(s,u)}l((n=n.apply(e,t||[])).next())})};const t4=new Map,kQ=(e,t=new Headers({accept:"application/json"}))=>{const r=t4.get(e);if(r)return r;const n=(()=>kPe(void 0,void 0,void 0,function*(){const i=yield window.fetch(e,{headers:t});if(!i.ok)throw new Error(`Request Failed: Status = ${i.status}; URI = ${e}; Time = ${new Date}`);return i.status===204?{payload:null,headers:i.headers}:{payload:yield i.json(),headers:i.headers}}))();return t4.set(e,n),n.catch(()=>t4.delete(e)),n};var mx,OPe=new Uint8Array(16);function LPe(){if(!mx&&(mx=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto<"u"&&typeof msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto),!mx))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return mx(OPe)}const FPe=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function NPe(e){return typeof e=="string"&&FPe.test(e)}var fa=[];for(var r4=0;r4<256;++r4)fa.push((r4+256).toString(16).substr(1));function BPe(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=(fa[e[t+0]]+fa[e[t+1]]+fa[e[t+2]]+fa[e[t+3]]+"-"+fa[e[t+4]]+fa[e[t+5]]+"-"+fa[e[t+6]]+fa[e[t+7]]+"-"+fa[e[t+8]]+fa[e[t+9]]+"-"+fa[e[t+10]]+fa[e[t+11]]+fa[e[t+12]]+fa[e[t+13]]+fa[e[t+14]]+fa[e[t+15]]).toLowerCase();if(!NPe(r))throw TypeError("Stringified UUID is invalid");return r}var v9,n4,i4=0,a4=0;function iE(e,t,r){var n=t&&r||0,i=t||new Array(16);e=e||{};var a=e.node||v9,o=e.clockseq!==void 0?e.clockseq:n4;if(a==null||o==null){var s=e.random||(e.rng||LPe)();a==null&&(a=v9=[s[0]|1,s[1],s[2],s[3],s[4],s[5]]),o==null&&(o=n4=(s[6]<<8|s[7])&16383)}var u=e.msecs!==void 0?e.msecs:Date.now(),l=e.nsecs!==void 0?e.nsecs:a4+1,c=u-i4+(l-a4)/1e4;if(c<0&&e.clockseq===void 0&&(o=o+1&16383),(c<0||u>i4)&&e.nsecs===void 0&&(l=0),l>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");i4=u,a4=l,n4=o,u+=122192928e5;var d=((u&268435455)*1e4+l)%4294967296;i[n++]=d>>>24&255,i[n++]=d>>>16&255,i[n++]=d>>>8&255,i[n++]=d&255;var f=u/4294967296*1e4&268435455;i[n++]=f>>>8&255,i[n++]=f&255,i[n++]=f>>>24&15|16,i[n++]=f>>>16&255,i[n++]=o>>>8|128,i[n++]=o&255;for(var p=0;p<6;++p)i[n+p]=a[p];return t||BPe(i)}const UPe=[{name:"ECO:0000269",description:"Manual assertion based on experiment",shortDescription:"Publication",acronym:"EXP",isManual:!0},{name:"ECO:0000303",description:"Manual assertion based on opinion",shortDescription:"Publication",acronym:"NAS",isManual:!0},{name:"ECO:0000305",description:"Manual assertion inferred by curator",shortDescription:"Curated",acronym:"IC",isManual:!0},{name:"ECO:0000250",description:"Manual assertion inferred from sequence similarity",shortDescription:"By similarity",acronym:"ISS",isManual:!0},{name:"ECO:0000255",description:"Manual assertion according to rules",shortDescription:"Sequence Analysis",acronym:"ISM",isManual:!0},{name:"ECO:0007744",description:"Manual assertion inferred from combination of experimental and computational evidence",shortDescription:"Combined sources",acronym:"MIXM",isManual:!0},{name:"ECO:0000312",description:"Manual assertion inferred from database entries",shortDescription:"Imported",acronym:"MI",isManual:!0},{name:"ECO:0000256",description:"Automatic assertion according to rules",shortDescription:"Automatic annotation",acronym:"AA"},{name:"ECO:0000259",description:"Automatic assertion inferred from signature match",shortDescription:"Automatic annotation",acronym:"AA"},{name:"ECO:0007829",description:"Automatic assertion inferred from combination of experimental and computational evidence",shortDescription:"Combined sources",acronym:"MIXA"},{name:"ECO:0000213",description:"Automatic assertion inferred from combination of experimental and computational evidence",shortDescription:"Combined sources",acronym:"MIXA"},{name:"ECO:0000244",description:"Manual assertion inferred from combination of experimental and computational evidence",shortDescription:"Combined sources",acronym:"MIXM",isManual:!0},{name:"ECO:0000313",description:"Automatic assertion inferred from database entries",shortDescription:"Imported",acronym:"AI"},{name:"ECO:0000260",description:"Manual assertion inferred from signature match",shortDescription:"InterPro annotation",acronym:"SGNM",isManual:!0}],OQ=e=>e.map(t=>{const r={};return t.begin&&(r.start=t.begin),{...t,...r}}),jPe=e=>{var t;return((t=e.name)==null?void 0:t.toLowerCase())==="PubMed".toLowerCase()?`${e.id}&nbsp;(<a href='${e.url}' style="color:#FFF" target='_blank'>${e.name}</a>&nbsp;<a href='${e.alternativeUrl}' style="color:#FFF" target='_blank'>EuropePMC</a>)`:`&nbsp;<a href='${e.url}' style="color:#FFF" target='_blank'>${e.id}</a>&nbsp;${e.name?`(${e.name})`:""}`},LQ=e=>e?`
      <ul>${e.map(t=>{const r=UPe.find(n=>n.name===t.code);return r?`<li title='${r.description}' style="padding: .25rem 0">${r.shortDescription}:&nbsp;${t.source?jPe(t.source):""}</li>`:""}).join("")}</ul>
    `:"",FQ=e=>`<ul>${e.map(t=>`<li style="padding: .25rem 0">${t.name} ${t.url?`<a href="${t.url}" style="color:#FFF" target="_blank">${t.id}</a>`:`${t.name} ${t.id}`}</li>`).join("")}</ul>`,zPe=e=>{if(!e)return"";const t=e.flatMap(({dbReferences:i})=>i.map(a=>a.id)),r=[...new Set(t.flat())],n="https://www.ebi.ac.uk/pride/archive/projects/";return`
  <ul>${r.map(i=>{const a=i==="Glue project"?"PXD012174":i;return`<li title='${a}' style="padding: .25rem 0">${a}&nbsp;(<a href="${n}${a}" style="color:#FFF" target="_blank">PRIDE</a>
      ${i==="Glue project"?')</li><li title="publication" style="padding: .25rem 0">Publication:&nbsp;31819260&nbsp;(<a href="https://pubmed.ncbi.nlm.nih.gov/31819260" style="color:#FFF" target="_blank">PubMed</a>)</li>':'&nbsp;<a href="http://www.peptideatlas.org/builds/rice/phospho/" style="color:#FFF" target="_blank">PeptideAtlas</a>)</li>'}`}).join("")}</ul>
`},VPe=(e,t)=>{if(!t)return"";const r=t.map(a=>({name:a.name,position:a.position}));let n="",i=0;return r.forEach(a=>{n=`${n}${e.slice(i,a.position)}[${a.name}]`,i=a.position}),n=`${n}${e.slice(i)}`,`<p>${n}</p>`},HPe={A:"alanine",S:"serine",T:"threonine",Y:"tyrosine"},m9=(e,t)=>{const{peptide:r,begin:n}=e,i=Number(n)+t.position-1,a=r.charAt(t.position-1);return`${i} phospho${HPe[a]}`},NQ=e=>{const t=e.type==="PROTEOMICS_PTM"?zPe(e.ptms):LQ(e.evidences),r=e.type==="PROTEOMICS_PTM"&&e.ptms.map(i=>m9(e,i)),n=e.type==="PROTEOMICS_PTM"&&e.ptms.flatMap(({dbReferences:i})=>i.map(a=>a.id));try{return`
      ${e.description?`<h5>Description</h5><p>${e.description}</p>`:""}
      ${e.matchScore?`<h5>Match score</h5><p>${e.matchScore}%</p>`:""}
      ${e.ftId?`<h5>Feature ID</h5><p>${e.ftId}</p>`:""}
      ${e.alternativeSequence?`<h5>Alternative sequence</h5><p>${e.alternativeSequence}</p>`:""}
      ${r?`<h5 data-article-id="ptm_processing_section">PTMs</h5><ul>${r.map(i=>`<li>${i}</li>`).join("")}</ul>
            `:""}
      ${e.peptide&&e.type==="PROTEOMICS_PTM"?`<h5 data-article-id="mod_res_large_scale#what-is-the-goldsilverbronze-criterion">Peptidoform</h5><p>${VPe(e.peptide,e.ptms)}</p>`:""}
      ${e.peptide&&e.type!=="PROTEOMICS_PTM"?`<h5>Peptide</h5><p>${e.peptide}</p>`:""} 
      ${e.xrefs?`<h5>Cross-references</h5>${FQ(e.xrefs)}`:""}
      ${t?`<h5>Evidence</h5>${t}`:""}
      ${e.ptms&&n&&!n.includes("Glue project")?`<hr /><h5 data-article-id="mod_res_large_scale#what-is-the-goldsilverbronze-criterion">PTM statistical attributes</h5><ul>${e.ptms.map(i=>i.dbReferences.map(a=>`<li><b>${a.id}</b></li>
                      <li style="text-indent: 1em"><b>${m9(e,i)}</b></li>
                      <li style="text-indent: 2em">PubMed ID: <a href="https://europepmc.org/article/MED/${a.properties["Pubmed ID"]}" style="color:#FFF" target="_blank">
                      ${a.properties["Pubmed ID"]}</a>
                      </li>
                      <li style="text-indent: 2em"><span data-article-id="mod_res_large_scale#confidence-score">Confidence score</span>: ${a.properties["Confidence score"]}</li>
                      <li style="text-indent: 2em">Universal Spectrum Id: 
                      <a href="http://proteomecentral.proteomexchange.org/usi/?usi=${a.properties["Universal Spectrum Id"]}" style="color:#FFF" target="_blank">View on ProteomeXchange</a>
                      </li>
                      <li style="text-indent: 2em">PSM Count: ${a.properties["PSM Count"]}</li>
                      <li style="text-indent: 2em">Site probability: ${a.properties["Site probability"]}</li>
                      `).join("")).join("")}</ul>`:""}
        `}catch(i){return console.error(i),""}},GPe=e=>{let t=[];const{features:r}=e;return r&&r.length>0&&(t=r.map(n=>({...n,tooltipContent:NQ(n),protvistaFeatureId:iE()})),t=OQ(t)),t},qPe=e=>{let t=[];return e&&e.length!==0&&(t=e.features.map(r=>Object.assign(r,{category:"PROTEOMICS",type:r.unique?"unique":"non_unique",tooltipContent:NQ(r),protvistaFeatureId:iE()})),t=OQ(t)),t},$Pe="PDBE_COVER",WPe="STRUCTURE_COVERAGE",XPe=e=>e.charAt(0).toUpperCase()+e.slice(1),YPe=e=>Object.keys(e).reduce((t,r)=>`${t}${XPe(r)}: ${e[r]}. `,""),KPe=e=>{const t=e.indexOf("="),r=e.indexOf("-");return t===-1||r===-1?{start:0,end:0}:{start:+e.slice(t+1,r),end:+e.slice(r+1)}},QPe=e=>e.dbReferences.filter(t=>t.type==="PDB").map(t=>{const r=t.properties.chains?KPe(t.properties.chains):{start:0,end:0};return{type:$Pe,category:WPe,structures:[{description:YPe(t.properties),start:r.start,end:r.end,source:{id:t.id,url:`http://www.ebi.ac.uk/pdbe-srv/view/entry/${t.id}`}}],start:r.start,end:r.end}}),ZPe=e=>{if(!e||e.length<=0)return[];const t=e.sort((n,i)=>n.start-i.start),r=[];return t.forEach(n=>{const i=r[r.length-1];!i||i.end<n.start?r.push(n):(i.end<n.end&&(i.end=n.end),i.structures.push(n.structures[0]))}),r},JPe=e=>`<ul>
            ${e.map(t=>`<li style="margin: 0.25rem 0"><a style="color:#FFF" href='${t.source.url}' target='_blank'>
            ${t.source.id}
        </a> (${t.start}-${t.end})</li>`).join("")}
        </ul>`,e4e=e=>{const t=JPe(e.structures);return`${t?`<h5>Structures</h5>${t}`:""}`},t4e=e=>{let t=[];if(e&&e.length!==0){const r=QPe(e);t=ZPe(r),t.forEach(n=>{n.tooltipContent=e4e(n),n.protvistaFeatureId=iE()})}return t},r4e=e=>e==null?void 0:e.map(t=>`
              <h4>Disease association</h4><p>${t.name}</p>
              ${t.description?`<>${t.description}</p>`:""}
              ${t.dbReferences?`<h5>Cross-references</h5>${FQ(t.dbReferences)}`:""}
              ${LQ(t.evidences)}
          `).join(""),n4e=e=>`<hr/><h5>Description</h5>${e.map(t=>`<p>${t.value}</p>`).join("")}
  `,i4e=e=>`<hr/><h5>Population frequencies</h5>${e.map(t=>`<p>${t.frequency} - ${t.populationName} (${t.source})</p>`).join("")}`,a4e=e=>{if(e.locations.some(r=>r.source==="EnsemblViruses")){const r=e.xrefs.find(n=>n.name==="ENA");return r.id?`<h5>Ensembl COVID-19</h5>
          <p>
          <a href="https://covid-19.ensembl.org/Sars_cov_2/Variation/Explore?v=${r.id}" target="_blank" rel="noopener noreferrer">${r.id}</a>
        </p>`:""}return""},o4e=e=>{const t=zg(e,"predAlgorithmNameType");return Object.keys(t).map(n=>{const i=zg(t[n],"predictionValType");return{algorithm:n,values:Object.keys(i).map(a=>({name:a,count:i[a].length}))}}).map(n=>`<h6>${n.algorithm}</h6><ul class="no-bullet">${n.values.map(i=>`<li>${i.name}</li>`).join("")}</ul>`).join("")},s4e=e=>`
                <h5>Variant</h5><p>${e.wildType} > ${e.alternativeSequence||""}</p>
                ${e.populationFrequencies?i4e(e.populationFrequencies):""}
                ${e.consequenceType?`<h5>Consequence</h5><p>${e.consequenceType}</p>`:""}
                ${e.somaticStatus?`<h5>Somatic</h5><p>${e.somaticStatus===0?"No":"Yes"}</p>`:""}
                ${e.genomicLocation?`<h5>Location</h5><p>${e.genomicLocation}</p>`:""}
                ${e.ftId?`<h5>Feature ID</h5><p>${e.ftId}</p>`:""}
                ${e.descriptions?n4e(e.descriptions):""}
                ${e.association?r4e(e.association):""}
                ${e.predictions?o4e(e.predictions):""}
                ${a4e(e)}
                
        `;var y5;(function(e){e.A="A",e.C="C",e.D="D",e.E="E",e.Empty="*",e.F="F",e.G="G",e.H="H",e.I="I",e.K="K",e.L="L",e.M="M",e.N="N",e.Nl="NL",e.P="P",e.Q="Q",e.R="R",e.S="S",e.T="T",e.V="V",e.W="W",e.Y="Y"})(y5||(y5={}));var g9;(function(e){e.CLINVAR="ClinVar",e.ESP="ESP",e.EXAC="ExAC",e.GENOMES1K="1000Genomes",e.BOVINE_SNP50="BovineSNP50",e.BOVINE_LD="BovineLD",e.BOVINE_HD="BovineHD",e.EQUINE_SNP50="EquineSNP50",e.CHICKEN_600K="Chicken600K",e.KG_HQ="1kg_hq",e.COSMIC="cosmic curated",e.REVIEWED="reviewed",e.UNIPROT="UniProt",e.DBSNP="dbSNP",e.ENSEMBL="Ensembl",e.ENSEMBL_PLANTS="EnsemblPlants",e.VECTORBASE="VectorBase",e.REFSEQ="RefSeq",e.DBGAP="dbGaP",e.DDD="DDD",e.PHARMCOGKB="PharmGKB",e.ENSEMBL_FUNGI="EnsemblFungi",e.ENSEMBL_METAZOA="EnsemblMetazoa",e.GNOMAD_V2="gnomAD_v2.0",e.GNOMAD_V3="gnomAD_v3.0",e.TCGA="NCI-TCGA",e.TCGA_COSMIC="NCI-TCGA Cosmic",e.DECIPHER="ddG2P",e.TOPMED="TOPMed",e.GNOMAD="gnomAD",e.PHARMGKB="pharmgkb",e.SGRP="SGRP",e.SGD="SGD",e.JEFFARES_SNPS="Jeffares_SNPs",e.JEFFARES_INDELS="Jeffares_Indels",e.ENSEMBL_VIRUSES="EnsemblViruses"})(g9||(g9={}));var y9;(function(e){e.Benign="Benign",e.Disease="Disease",e.LikelyBenign="Likely benign",e.LikelyPathogenic="Likely pathogenic",e.Pathogenic="Pathogenic",e.Protective="Protective",e.VariantOfUncertainSignificance="Variant of uncertain significance"})(y9||(y9={}));var b9;(function(e){e.Empty="-",e.Frameshift="frameshift",e.InframeDeletion="inframe deletion",e.Insertion="insertion",e.Missense="missense",e.StopGained="stop gained"})(b9||(b9={}));var x9;(function(e){e.PolyPhen="PolyPhen",e.Sift="SIFT"})(x9||(x9={}));var S9;(function(e){e.Benign="benign",e.Deleterious="deleterious",e.DeleteriousLowConfidence="deleterious - low confidence",e.PossiblyDamaging="possibly damaging",e.ProbablyDamaging="probably damaging",e.Tolerated="tolerated",e.ToleratedLowConfidence="tolerated - low confidence",e.Unknown="unknown"})(S9||(S9={}));var C9;(function(e){e.LargeScaleStudy="large_scale_study",e.Mixed="mixed",e.UniProt="uniprot"})(C9||(C9={}));const u4e=(e,t)=>{const r=e?e.map(n=>n.name):[];return(t==="uniprot"||t==="mixed")&&r.push("uniprot"),r},l4e=e=>{const{sequence:t,features:r}=e,n=r.map(i=>Object.assign(Object.assign({},i),{accession:i.genomicLocation,variant:i.alternativeSequence?i.alternativeSequence:y5.Empty,start:i.begin,xrefNames:u4e(i.xrefs,i.sourceType),hasPredictions:i.predictions&&i.predictions.length>0,tooltipContent:s4e(i),protvistaFeatureId:iE()}));return n?{sequence:t,variants:n}:null},c4e=e=>{try{return e.results.map(({metadata:t,proteins:r})=>({...t,locations:r[0].entry_protein_locations,start:Math.min(...r[0].entry_protein_locations.map(n=>Math.min(...n.fragments.map(i=>i.start)))),end:Math.max(...r[0].entry_protein_locations.map(n=>Math.max(...n.fragments.map(i=>i.end)))),tooltipContent:`
        <h5>Accession</h5>
        <a
          target="_blank"
          rel="noopener"
          href="https://www.ebi.ac.uk/interpro/entry/InterPro/${t.accession}/"
        >
        ${t.accession}
        </a>
        <h5>Name</h5>
        <p>${t.name}</p>
      `,length:r[0].protein_length}))}catch{throw new Error("Failed transforming the data")}};var b5;(function(e){e.Gold="#c39b00",e.Silver="#8194a1",e.Bronze="#a65708"})(b5||(b5={}));const _9={R:"Phosphoarginine",C:"Phosphocysteine",H:"Phosphohistidine",S:"Phosphoserine",T:"Phosphothreonine",Y:"Phosphotyrosine"},d4e=e=>{const t=e.toUpperCase();return t in _9?_9[t]:(console.error(`${t} not a valid amino acid for phosphorylation`),"")},f4e=(e,t,r)=>{const n=[...e.flatMap(({dbReferences:s})=>s==null?void 0:s.flatMap(({id:u})=>[u]))],i=new Set(e.flatMap(({dbReferences:s})=>s==null?void 0:s.map(({properties:u})=>u["Confidence score"])));let a;i.size?i.size>1?console.error(`PTM has a mixture of confidence scores: ${Array.from(i)}`):[a]=i:console.log("PTM has no confidence score");const o=`
  <h5>Description</h5><p>${d4e(t)}</p>
  ${a?`<h5 data-article-id="mod_res_large_scale#confidence-score">Confidence Score</h5><p>${a}</p>`:""}
  ${n?`<h5>Evidence</h5><ul>${n.map(s=>{const u=s==="Glue project"?"PXD012174":s;return`<li title='${u}' style="padding: .25rem 0">${u}&nbsp;
              (<a href="https://www.ebi.ac.uk/pride/archive/projects/${s}" style="color:#FFF" target="_blank">PRIDE</a>)
              </li>
              ${s==="Glue project"?'<li title="publication" style="padding: .25rem 0">Publication:&nbsp;31819260&nbsp;(<a href="https://pubmed.ncbi.nlm.nih.gov/31819260" style="color:#FFF" target="_blank">PubMed</a>)</li>':""}
              `}).join("")}</ul>`:""}
  `;return{source:"PTMeXchange",type:"MOD_RES_LS",start:r,end:r,shape:"triangle",tooltipContent:o,color:b5[a]||"black"}},p4e=e=>{if(e){const{features:t}=e,r={};if(t){for(const n of t)for(const i of n.ptms){const a=+n.begin+i.position-1;if(!Number.isFinite(a)){console.error(`Encountered infinite number: +feature.begin + ptm.position - 1 = ${+n.begin} + ${i.position} - 1`);continue}const o=n.peptide[i.position-1];a in r?r[a].aa!==o?console.error(`One PTM has different amino acid values: [${r[a].aa}, ${o}]`):r[a].ptms.push(i):r[a]={ptms:[i],aa:o}}return Object.entries(r).map(([n,{ptms:i,aa:a}])=>f4e(i,a,+n))}}return[]},h4e=[{name:"DOMAINS_AND_SITES",label:"Domains & sites",trackType:"protvista-track",tracks:[{name:"domain",label:"Domain",filter:"DOMAIN",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"Specific combination of secondary structures organized into a characteristic three-dimensional structure or fold"},{name:"region",label:"Region",filter:"REGION",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"Regions in multifunctional enzymes or fusion proteins, or characteristics of a region, e.g., protein-protein interactions mediation"},{name:"motif",label:"Motif",filter:"MOTIF",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"Short conserved sequence motif of biological significance"},{name:"metal",label:"Metal binding",filter:"METAL",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"Binding site for a metal ion"},{name:"site",label:"Site",filter:"SITE",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"Any interesting single amino acid site on the sequence"},{name:"repeat",label:"Repeat",filter:"REPEAT",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"Repeated sequence motifs or repeated domains within the protein"},{name:"ca_bind",label:"Calcium binding",filter:"CA_BIND",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"Calcium-binding regions, such as the EF-hand motif"},{name:"dna_bind",label:"DNA binding",filter:"DNA_BIND",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"DNA-binding domains such as AP2/ERF domain, the ETS domain, the Fork-Head domain, the HMG box and the Myb domain"},{name:"zn_fing",label:"Zinc finger",filter:"ZN_FING",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"Small, functional, independently folded domain that coordinates one or more zinc ions"},{name:"np_bind",label:"Nucleotide binding",filter:"NP_BIND",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"(aka flavin-binding). Region in the protein which binds nucleotide phosphates"},{name:"binding",label:"Binding site",filter:"BINDING",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"Binding site for any chemical group (co-enzyme, prosthetic group, etc.)"},{name:"act_site",label:"Active site",filter:"ACT_SITE",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"Amino acid(s) directly involved in the activity of an enzyme"}]},{name:"MOLECULE_PROCESSING",label:"Molecule processing",trackType:"protvista-track",tracks:[{name:"signal",label:"Signal peptide",filter:"SIGNAL",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"N-terminal signal peptide"},{name:"chain",label:"Chain",filter:"CHAIN",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"(aka mature region). This describes the extent of a polypeptide chain in the mature protein following processing"},{name:"transit",label:"Transit peptide",filter:"TRANSIT",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"This describes the extent of a transit peptide"},{name:"init_met",label:"Initiator methionine",filter:"INIT_MET",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"This indicates that the initiator methionine is cleaved from the mature protein"},{name:"propep",label:"Propeptide",filter:"PROPEP",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"Part of a protein that is cleaved during maturation or activation"},{name:"peptide",label:"Peptide",filter:"PEPTIDE",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"The position and length of an active peptide in the mature protein"}]},{name:"PTM",label:"PTM",trackType:"protvista-track",tracks:[{name:"mod_res",label:"Modified residue",filter:"MOD_RES",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"Modified residues such as phosphorylation, acetylation, acylation, methylation"},{name:"mod_res_ls",label:"Modified residue (large scale data)",filter:"MOD_RES_LS",trackType:"protvista-track",data:[{adapter:"protvista-proteomics-ptm-adapter",url:"https://www.ebi.ac.uk/proteins/api/proteomics-ptm/{accession}"}],tooltip:"Modified residues from Large scale studies"},{name:"carbohyd",label:"Glycosylation",filter:"CARBOHYD",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"Covalently attached glycan group(s)"},{name:"disulfid",label:"Disulfide bond",filter:"DISULFID",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"The positions of cysteine residues participating in disulphide bonds"},{name:"crosslnk",label:"Cross-link",filter:"CROSSLNK",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"Covalent linkages of various types formed between two proteins or between two parts of the same protein"},{name:"lipid",label:"Lipidation",filter:"LIPID",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"Covalently attached lipid group(s)"}]},{name:"SEQUENCE_INFORMATION",label:"Sequence information",trackType:"protvista-track",tracks:[{name:"compbias",label:"Compositional bias",filter:"COMPBIAS",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"Position of regions of compositional bias within the protein and the particular amino acids that are over-represented within those regions"},{name:"conflict",label:"Sequence conflict",filter:"CONFLICT",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"Sequence discrepancies of unknown origin"},{name:"non_cons",filter:"NON_CONS",trackType:"protvista-track",label:"Non-adjacent residues",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"Indicates that two residues in a sequence are not consecutive and that there is an undetermined number of unsequenced residues between them"},{name:"non_ter",filter:"NON_TER",trackType:"protvista-track",label:"Non-terminal residue",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"The sequence is incomplete. The residue is not the terminal residue of the complete protein"},{name:"unsure",filter:"UNSURE",trackType:"protvista-track",label:"Sequence uncertainty",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"Regions of a sequence for which the authors are unsure about the sequence assignment"},{name:"non_std",filter:"NON_STD",trackType:"protvista-track",label:"Non-standard residue",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"Non-standard amino acids (selenocysteine and pyrrolysine)"}]},{name:"STRUCTURAL",label:"Structural features",trackType:"protvista-track",tracks:[{name:"helix",label:"Helix",filter:"HELIX",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"The positions of experimentally determined helical regions"},{name:"strand",label:"Beta strand",filter:"STRAND",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"The positions of experimentally determined beta strands"},{name:"turn",label:"Turn",filter:"TURN",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"The positions of experimentally determined hydrogen-bonded turns"},{name:"coiled",label:"Coiled coil",filter:"COILED",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"Coiled coils are built by two or more alpha-helices that wind around each other to form a supercoil"}]},{name:"STRUCTURE_COVERAGE",label:"PDBe 3D structure coverage",trackType:"protvista-track",tracks:[{name:"pdbe_cover",label:"PDBe coverage",trackType:"protvista-track",tooltip:"PDBe 3D structure coverage",data:[{adapter:"protvista-structure-adapter",url:"https://www.ebi.ac.uk/proteins/api/proteins/{accession}"}]}]},{name:"TOPOLOGY",label:"Topology",trackType:"protvista-track",tracks:[{name:"topo_dom",label:"Topological domain",filter:"TOPO_DOM",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"Location of non-membrane regions of membrane-spanning proteins"},{name:"transmem",label:"Transmembrane",filter:"TRANSMEM",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"Extent of a membrane-spanning region"},{name:"intramem",label:"Intramembrane",filter:"INTRAMEM",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"Extent of a region located in a membrane without crossing it"}]},{name:"MUTAGENESIS",label:"Mutagenesis",trackType:"protvista-track",tracks:[{name:"mutagen",label:"Mutagenesis",filter:"MUTAGEN",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"Site which has been experimentally altered by mutagenesis"},{name:"othermutagen",label:"Other Mutagenesis",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/mutagenesis/{accession}"}],tooltip:"Site which has been experimentally altered by mutagenesis"}]},{name:"PROTEOMICS",label:"Proteomics",trackType:"protvista-track",adapter:"protvista-proteomics-adapter",urls:["https://www.ebi.ac.uk/proteins/api/proteomics/{accession}","https://www.ebi.ac.uk/proteins/api/proteomics-ptm/{accession}"],tracks:[{name:"unique",label:"Unique peptide",filter:"unique",trackType:"protvista-track",data:[{adapter:"protvista-proteomics-adapter",url:"https://www.ebi.ac.uk/proteins/api/proteomics/{accession}"}],tooltip:""},{name:"non_unique",label:"Non-unique peptide",filter:"non_unique",trackType:"protvista-track",data:[{adapter:"protvista-proteomics-adapter",url:"https://www.ebi.ac.uk/proteins/api/proteomics/{accession}"}],tooltip:""},{name:"proteomics-ptm",label:"PTM-containing peptide",trackType:"protvista-track",data:[{adapter:"protvista-proteomics-adapter",url:"https://www.ebi.ac.uk/proteins/api/proteomics-ptm/{accession}"}],tooltip:""}]},{name:"ANTIGEN",label:"Antigenic sequences",trackType:"protvista-track",tracks:[{name:"antigen",label:"Antibody binding sequences",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/antigen/{accession}"}],tooltip:""}]},{name:"VARIATION",label:"Variants",trackType:"protvista-variation-graph",tracks:[{name:"variation",filterComponent:"protvista-filter",trackType:"protvista-variation",data:[{adapter:"protvista-variation-adapter",url:"https://www.ebi.ac.uk/proteins/api/variation/{accession}"}],tooltip:"Natural variant of the protein, including polymorphisms, variations between strains, isolates or cultivars, disease-associated mutations and RNA editing events"}]}],v4e=[{type:"features",url:"https://www.ebi.ac.uk/proteins/api/features/"},{type:"variants",url:"https://www.ebi.ac.uk/proteins/api/variation/"},{type:"antigens",url:"https://www.ebi.ac.uk/proteins/api/antigen/"},{type:"proteomics",url:"https://www.ebi.ac.uk/proteins/api/proteomics/"}],m4e={categories:h4e,download:v4e};var g4e=globalThis&&globalThis.__awaiter||function(e,t,r,n){function i(a){return a instanceof r?a:new r(function(o){o(a)})}return new(r||(r=Promise))(function(a,o){function s(c){try{l(n.next(c))}catch(d){o(d)}}function u(c){try{l(n.throw(c))}catch(d){o(d)}}function l(c){c.done?a(c.value):i(c.value).then(s,u)}l((n=n.apply(e,t||[])).next())})};const o4=new Map,w9=(e,t=new Headers({accept:"application/json"}))=>{const r=o4.get(e);if(r)return r;const n=(()=>g4e(void 0,void 0,void 0,function*(){const i=yield window.fetch(e,{headers:t});if(!i.ok)throw new Error(`Request Failed: Status = ${i.status}; URI = ${e}; Time = ${new Date}`);return i.status===204?{payload:null,headers:i.headers}:{payload:yield i.json(),headers:i.headers}}))();return o4.set(e,n),n.catch(()=>o4.delete(e)),n};function y4e(e,t){var r=-1,n=e2(e)?Array(e.length):[];return fQ(e,function(i,a,o){n[++r]=t(i,a,o)}),n}function b4e(e,t){var r=ns(e)?t2:y4e;return r(e,SQ(t))}function E9(e,t){return qO(b4e(e,t),1)}typeof window<"u"&&function(){window.console=window.console||{};for(var e=window.console,t,r,n={},i=function(){},a="memory".split(","),o="assert,clear,count,debug,dir,dirxml,error,exception,group,groupCollapsed,groupEnd,info,log,markTimeline,profile,profiles,profileEnd,show,table,time,timeEnd,timeline,timelineEnd,timeStamp,trace,warn".split(",");t=a.pop();)e[t]||(e[t]=n);for(;r=o.pop();)e[r]||(e[r]=i)}();typeof window.HTMLCanvasElement<"u"&&!window.HTMLCanvasElement.prototype.toBlob&&Object.defineProperty(window.HTMLCanvasElement.prototype,"toBlob",{value:function(e,t,r){for(var n=window.atob(this.toDataURL(t,r).split(",")[1]),i=n.length,a=i>>2,o=new Uint8Array(i),s=new Uint32Array(o.buffer,0,a),u=0,l=0;l<a;l++)s[l]=n.charCodeAt(u++)|n.charCodeAt(u++)<<8|n.charCodeAt(u++)<<16|n.charCodeAt(u++)<<24;for(var c=i&3;c--;)o[u]=n.charCodeAt(u++);e(new window.Blob([o],{type:t||"image/png"}))}});Math.cbrt=Math.cbrt||function(e){var t=Math.pow(Math.abs(e),.3333333333333333);return e<0?-t:t};Math.sign||(Math.sign=function(e){return e=+e,e===0||isNaN(e)?Number(e):e>0?1:-1});Number.isInteger||(Number.isInteger=function(t){return typeof t=="number"&&isFinite(t)&&t>-9007199254740992&&t<9007199254740992&&Math.floor(t)===t});Number.isNaN||(Number.isNaN=function(t){return t!==t});Object.assign||Object.defineProperty(Object,"assign",{enumerable:!1,configurable:!0,writable:!0,value:function(e){if(e==null)throw new TypeError("Cannot convert first argument to object");for(var t=Object(e),r=!1,n,i=1;i<arguments.length;i++){var a=arguments[i];if(a!=null){for(var o=Object.keys(Object(a)),s=0,u=o.length;s<u;s++){var l=o[s];try{var c=Object.getOwnPropertyDescriptor(a,l);c!==void 0&&c.enumerable&&(t[l]=a[l])}catch(d){r||(r=!0,n=d)}}if(r)throw n}}return t}});String.prototype.startsWith||function(){var e=function(){var n;try{var i={},a=Object.defineProperty;n=a(i,i,i)&&a}catch{}return n}(),t={}.toString,r=function(n){if(this===null)throw TypeError();var i=String(this);if(n&&t.call(n)==="[object RegExp]")throw TypeError();var a=i.length,o=String(n),s=o.length,u=arguments.length>1?arguments[1]:void 0,l=u?Number(u):0;Number.isNaN(l)&&(l=0);var c=Math.min(Math.max(l,0),a);if(s+c>a)return!1;for(var d=-1;++d<s;)if(i.charCodeAt(c+d)!==o.charCodeAt(d))return!1;return!0};e?e(String.prototype,"startsWith",{value:r,configurable:!0,writable:!0}):String.prototype.startsWith=r}();String.prototype.endsWith||(String.prototype.endsWith=function(e,t){var r=this.toString();(typeof t!="number"||!isFinite(t)||Math.floor(t)!==t||t>r.length)&&(t=r.length),t-=e.length;var n=r.indexOf(e,t);return n!==-1&&n===t});String.prototype.repeat||(String.prototype.repeat=function(e){if(this===null)throw new TypeError("can't convert "+this+" to object");var t=""+this;if(e=+e,Number.isNaN(e)&&(e=0),e<0)throw new RangeError("repeat count must be non-negative");if(e===1/0)throw new RangeError("repeat count must be less than infinity");if(e=Math.floor(e),t.length===0||e===0)return"";if(t.length*e>=1<<28)throw new RangeError("repeat count must not overflow maximum string size");for(var r="";(e&1)===1&&(r+=t),e>>>=1,e!==0;)t+=t;return r});String.prototype.includes||(String.prototype.includes=function(e,t){return typeof t!="number"&&(t=0),t+e.length>this.length?!1:this.indexOf(e,t)!==-1});Array.prototype.includes||(Array.prototype.includes=function(e){if(this==null)throw new TypeError("Array.prototype.includes called on null or undefined");var t=Object(this),r=parseInt(t.length,10)||0;if(r===0)return!1;var n=parseInt(arguments[1],10)||0,i;n>=0?i=n:(i=r+n,i<0&&(i=0));for(var a;i<r;){if(a=t[i],e===a||Number.isNaN(e)&&Number.isNaN(a))return!0;i++}return!1});Array.from||(Array.from=function(){var e=Object.prototype.toString,t=function(a){return typeof a=="function"||e.call(a)==="[object Function]"},r=function(a){var o=Number(a);return isNaN(o)?0:o===0||!isFinite(o)?o:(o>0?1:-1)*Math.floor(Math.abs(o))},n=Math.pow(2,53)-1,i=function(a){var o=r(a);return Math.min(Math.max(o,0),n)};return function(o){var s=this,u=Object(o);if(o==null)throw new TypeError("Array.from requires an array-like object - not null or undefined");var l=arguments.length>1?arguments[1]:void 0,c;if(typeof l<"u"){if(!t(l))throw new TypeError("Array.from: when provided, the second argument must be a function");arguments.length>2&&(c=arguments[2])}for(var d=i(u.length),f=t(s)?Object(new s(d)):new Array(d),p=0,v;p<d;)v=u[p],l?f[p]=typeof c>"u"?l(v,p):l.call(c,v,p):f[p]=v,p+=1;return f.length=d,f}}());typeof window<"u"&&function(){for(var e=0,t=["ms","moz","webkit","o"],r=0;r<t.length&&!window.requestAnimationFrame;++r)window.requestAnimationFrame=window[t[r]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[t[r]+"CancelAnimationFrame"]||window[t[r]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(n){var i=new Date().getTime(),a=Math.max(0,16-(i-e)),o=window.setTimeout(function(){var s=i+a;n(s)},a);return e=i+a,o}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(n){clearTimeout(n)})}();Function.prototype.name===void 0&&Object.defineProperty!==void 0&&Object.defineProperty(Function.prototype,"name",{get:function(){return this.toString().match(/^\s*function\s*(\S*)\s*\(/)[1]}});typeof window<"u"&&(window.performance===void 0&&(window.performance={}),window.performance.now===void 0&&function(){var e=Date.now();window.performance.now=function(){return Date.now()-e}}());Object.defineProperty!==void 0&&(Number.MAX_SAFE_INTEGER===void 0&&Object.defineProperty(Number,"MAX_SAFE_INTEGER",{enumerable:!1,configurable:!1,writable:!1,value:Math.pow(2,53)-1}),Number.MIN_SAFE_INTEGER===void 0&&Object.defineProperty(Number,"MIN_SAFE_INTEGER",{enumerable:!1,configurable:!1,writable:!1,value:-(Math.pow(2,53)-1)}));Object.entries||(Object.entries=function(e){for(var t=Object.keys(e),r=t.length,n=new Array(r);r--;)n[r]=[t[r],e[t[r]]];return n});Array.prototype.find||Object.defineProperty(Array.prototype,"find",{value:function(e){if(this==null)throw TypeError('"this" is null or not defined');var t=Object(this),r=t.length>>>0;if(typeof e!="function")throw TypeError("predicate must be a function");for(var n=arguments[1],i=0;i<r;){var a=t[i];if(e.call(n,a,i,t))return a;i++}},configurable:!0,writable:!0});Array.prototype.fill||Object.defineProperty(Array.prototype,"fill",{value:function(e){if(this==null)throw new TypeError("this is null or not defined");for(var t=Object(this),r=t.length>>>0,n=arguments[1],i=n>>0,a=i<0?Math.max(r+i,0):Math.min(i,r),o=arguments[2],s=o===void 0?r:o>>0,u=s<0?Math.max(r+s,0):Math.min(s,r);a<u;)t[a]=e,a++;return t}});Array.prototype.copyWithin||Object.defineProperty(Array.prototype,"copyWithin",{value:function(e,t){if(this==null)throw new TypeError("this is null or not defined");var r=Object(this),n=r.length>>>0,i=e>>0,a=i<0?Math.max(n+i,0):Math.min(i,n),o=t>>0,s=o<0?Math.max(n+o,0):Math.min(o,n),u=arguments[2],l=u===void 0?n:u>>0,c=l<0?Math.max(n+l,0):Math.min(l,n),d=Math.min(c-s,n-a),f=1;for(s<a&&a<s+d&&(f=-1,s+=d-1,a+=d-1);d>0;)s in r?r[a]=r[s]:delete r[a],s+=f,a+=f,d--;return r},configurable:!0,writable:!0});Int8Array.prototype.copyWithin||Object.defineProperty(Int8Array.prototype,"copyWithin",{value:Array.prototype.copyWithin});Int16Array.prototype.copyWithin||Object.defineProperty(Int16Array.prototype,"copyWithin",{value:Array.prototype.copyWithin});Int32Array.prototype.copyWithin||Object.defineProperty(Int32Array.prototype,"copyWithin",{value:Array.prototype.copyWithin});Uint8Array.prototype.copyWithin||Object.defineProperty(Uint8Array.prototype,"copyWithin",{value:Array.prototype.copyWithin});Uint16Array.prototype.copyWithin||Object.defineProperty(Uint16Array.prototype,"copyWithin",{value:Array.prototype.copyWithin});Uint32Array.prototype.copyWithin||Object.defineProperty(Uint32Array.prototype,"copyWithin",{value:Array.prototype.copyWithin});Float32Array.prototype.copyWithin||Object.defineProperty(Float32Array.prototype,"copyWithin",{value:Array.prototype.copyWithin});Float64Array.prototype.copyWithin||Object.defineProperty(Float64Array.prototype,"copyWithin",{value:Array.prototype.copyWithin});var x5=function(e,t){return x5=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(r[i]=n[i])},x5(e,t)};function Fe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");x5(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}var E=function(){return E=Object.assign||function(t){for(var r,n=1,i=arguments.length;n<i;n++){r=arguments[n];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(t[a]=r[a])}return t},E.apply(this,arguments)};function ce(e,t,r,n){function i(a){return a instanceof r?a:new r(function(o){o(a)})}return new(r||(r=Promise))(function(a,o){function s(c){try{l(n.next(c))}catch(d){o(d)}}function u(c){try{l(n.throw(c))}catch(d){o(d)}}function l(c){c.done?a(c.value):i(c.value).then(s,u)}l((n=n.apply(e,t||[])).next())})}function de(e,t){var r={label:0,sent:function(){if(a[0]&1)throw a[1];return a[1]},trys:[],ops:[]},n,i,a,o;return o={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function s(l){return function(c){return u([l,c])}}function u(l){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,l[0]&&(r=0)),r;)try{if(n=1,i&&(a=l[0]&2?i.return:l[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,l[1])).done)return a;switch(i=0,a&&(l=[l[0]&2,a.value]),l[0]){case 0:case 1:a=l;break;case 4:return r.label++,{value:l[1],done:!1};case 5:r.label++,i=l[1],l=[0];continue;case 7:l=r.ops.pop(),r.trys.pop();continue;default:if(a=r.trys,!(a=a.length>0&&a[a.length-1])&&(l[0]===6||l[0]===2)){r=0;continue}if(l[0]===3&&(!a||l[1]>a[0]&&l[1]<a[3])){r.label=l[1];break}if(l[0]===6&&r.label<a[1]){r.label=a[1],a=l;break}if(a&&r.label<a[2]){r.label=a[2],r.ops.push(l);break}a[2]&&r.ops.pop(),r.trys.pop();continue}l=t.call(e,r)}catch(c){l=[6,c],i=0}finally{n=a=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}function Nt(e,t,r){if(r||arguments.length===2)for(var n=0,i=t.length,a;n<i;n++)(a||!(n in t))&&(a||(a=Array.prototype.slice.call(t,0,n)),a[n]=t[n]);return e.concat(a||Array.prototype.slice.call(t))}var ba;(function(e){function t(i){return i}e.create=t;function r(i,a){return(i&a)!==0}e.has=r;function n(i,a){return!!a&&(i&a)===a}e.hasAll=n})(ba||(ba={}));var Lr;(function(e){function t(S){return S===void 0&&(S=512),{current:[],offset:0,capacity:S,chunks:[]}}e.create=t;function r(S){return S.chunks.length?(S.offset>0&&(S.chunks[S.chunks.length]=S.current.length===S.offset?S.current.join(""):S.current.slice(0,S.offset).join("")),S.chunks.join("")):S.current.length===S.offset?S.current.join(""):S.current.splice(0,S.offset).join("")}e.getString=r;function n(S){for(var x=0,C=0,w=S.chunks;C<w.length;C++){var A=w[C];x+=A.length}for(var M=0;M<S.offset;M++)x+=S.current[M].length;return x}e.getSize=n;function i(S){return S.offset>0&&(S.current.length===S.offset?S.chunks[S.chunks.length]=S.current.join(""):S.chunks[S.chunks.length]=S.current.slice(0,S.offset).join(""),S.offset=0),S.chunks}e.getChunks=i;var a=[];(function(){for(var S="",x=0;x<512;x++)a[x]=S,S=S+" "})();function o(S){c(S,`
`)}e.newline=o;function s(S,x){x>0&&c(S,a[x])}e.whitespace=s;function u(S){c(S," ")}e.whitespace1=u;function l(S,x){x&&(S.offset===S.capacity&&(S.chunks[S.chunks.length]=S.current.join(""),S.offset=0),S.current[S.offset++]=x)}e.write=l;function c(S,x){S.offset===S.capacity&&(S.chunks[S.chunks.length]=S.current.join(""),S.offset=0),S.current[S.offset++]=x}e.writeSafe=c;function d(S,x,C){if(!x){s(S,C);return}var w=C-x.length;s(S,w),c(S,x)}e.writePadLeft=d;function f(S,x,C){if(!x){s(S,C);return}var w=C-x.length;c(S,x),s(S,w)}e.writePadRight=f;function p(S,x){c(S,""+x)}e.writeInteger=p;function v(S,x){c(S,""+x+" ")}e.writeIntegerAndSpace=v;function h(S,x,C){var w=""+x,A=C-w.length;s(S,A),c(S,w)}e.writeIntegerPadLeft=h;function m(S,x,C){var w=""+x,A=C-w.length;c(S,w),s(S,A)}e.writeIntegerPadRight=m;function g(S,x,C){c(S,""+Math.round(C*x)/C)}e.writeFloat=g;function y(S,x,C,w){var A=""+Math.round(C*x)/C,M=w-A.length;s(S,M),c(S,A)}e.writeFloatPadLeft=y;function b(S,x,C,w){var A=""+Math.round(C*x)/C,M=w-A.length;c(S,A),s(S,M)}e.writeFloatPadRight=b})(Lr||(Lr={}));var kn=function(){if(typeof window<"u"&&window.performance){var e=window.performance;return function(){return e.now()}}else return typeof process<"u"&&process.hrtime!=="undefined"&&typeof process.hrtime=="function"?function(){var t=process.hrtime();return t[0]*1e3+t[1]/1e6}:Date.now?function(){return Date.now()}:function(){return+new Date}}();function $S(e,t){if(t===void 0&&(t=!0),isNaN(e))return"n/a";for(var r=Math.floor(e/(60*60*1e3)),n=Math.floor(e/(60*1e3)%60),i=Math.floor(e/1e3%60),a=Math.floor(e%1e3).toString();a.length<3;)a="0"+a;for(;!t&&a.length>1&&a[a.length-1]==="0";)a=a.substr(0,a.length-1);return r>0?r+"h"+n+"m"+i+"."+a+"s":n>0?n+"m"+i+"."+a+"s":i>0?i+"."+a+"s":e.toFixed(0)+"ms"}var mn;(function(e){var t=typeof btoa<"u"?btoa:function(o){return Buffer.from(o).toString("base64")},r=[];function n(){for(var o=+new Date+kn(),s=0;s<16;s++)r[s]=String.fromCharCode((o+Math.random()*255)%255|0),o=Math.floor(o/255);return t(r.join("")).replace(/\+/g,"-").replace(/\//g,"_").substr(0,22)}e.create22=n;function i(){var o=+new Date+kn(),s="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(u){var l=(o+Math.random()*16)%16|0;return o=Math.floor(o/16),(u==="x"?l:l&3|8).toString(16)});return s}e.createv4=i;function a(o){return typeof o=="string"}e.is=a})(mn||(mn={}));function x4e(e,t){return e-t}function S4e(e){return Array.prototype.sort.call(e,x4e),e}var A9;(function(e){var t=function(){function p(){this.size=0}return p.prototype.has=function(v){return!1},p.prototype.forEach=function(v,h){return h},p}(),r=function(){function p(v){this.idx=v,this.size=1}return p.prototype.has=function(v){return v===this.idx},p.prototype.forEach=function(v,h){return v(this.idx,h),h},p}(),n=function(){function p(v,h){this.mask=v,this.size=h,this.length=v.length}return p.prototype.has=function(v){return v<this.length&&!!this.mask[v]},p.prototype._forEach=function(v,h){for(var m=0;m<this.length;m++)this.mask[m]&&v(m,h)},p.prototype.forEach=function(v,h){return this._forEach(v,h),h},p}(),i=function(){function p(v){this.size=v}return p.prototype.has=function(v){return!0},p.prototype._forEach=function(v,h){for(var m=0;m<this.size;m++)v(m,h)},p.prototype.forEach=function(v,h){return this._forEach(v,h),h},p}(),a=function(){function p(v){this.set=v,this._flat=void 0,this.size=v.size}return p.prototype.has=function(v){return this.set.has(v)},p.prototype._forEach=function(v,h){for(var m=0,g=this.flatten();m<g.length;m++){var y=g[m];v(y,h)}},p.prototype.flatten=function(){if(this._flat)return this._flat;var v=new Int32Array(this.size),h=0;return this.set.forEach(function(m){return v[h++]=m}),S4e(v),this._flat=v,this._flat},p.prototype.forEach=function(v,h){return this._forEach(v,h),h},p}();function o(p){return new i(p)}e.always=o,e.never=new t;function s(p){return new a(p)}e.ofSet=s;function u(p){return new r(p)}e.singleton=u;function l(p){var v=p.length;if(v===0)return new t;if(v===1)return new r(p[0]);for(var h=0,m=0,g=p;m<g.length;m++){var y=g[m];y>h&&(h=y)}if(v===h)return new i(v);var b=v/h;if(b<1/12){for(var S=new Set,x=0,C=p;x<C.length;x++){var y=C[x];S.add(y)}return new a(S)}for(var w=new Int8Array(h+1),A=0,M=p;A<M.length;A++){var y=M[A];w[y]=1}return new n(w,p.length)}e.ofUniqueIndices=l;function c(p,v){return new n(p,v)}e.ofMask=c;function d(p,v){for(var h=0,m=v;h<m.length;h++){var g=m[h];if(p.has(g))return!0}return!1}e.hasAny=d;function f(p,v){var h=0,m=0;if(v.forEach(function(b){p.has(b)||(h++,b>m&&(m=b))}),h/m<1/12){var g=new Set;return v.forEach(function(b){p.has(b)||g.add(b)}),s(g)}else{var y=new Uint8Array(m+1);return v.forEach(function(b){p.has(b)||(y[b]=1)}),c(y,h)}}e.complement=f})(A9||(A9={}));function $a(e,t){e===void 0&&(e=0),t===void 0&&(t=Number.MAX_SAFE_INTEGER);var r=e;return function(){var n=r;return r=(r+1)%t,n}}var p1;(function(e){function t(n){return{ref:n}}e.create=t;function r(n,i){return n.ref=i,n}e.set=r})(p1||(p1={}));var C4e=$a(0,2147483647),up;(function(e){function t(n,i){return{id:C4e(),version:0,value:n,metadata:i}}e.create=t;function r(n,i){return{id:n.id,version:n.version+1,value:i,metadata:n.metadata}}e.withValue=r})(up||(up={}));var F;(function(e){function t(a,o){return p1.create(up.create(a,o))}e.create=t;function r(a,o){return p1.set(a,up.withValue(a.ref,o))}e.update=r;function n(a,o){return p1.set(a,o)}e.set=n;function i(a,o){return a.ref.value!==o?r(a,o):a}e.updateIfChanged=i})(F||(F={}));var bf=function(){};function no(e,t){var r=e.length;if(r!==t.length)return!1;for(var n=0;n<r;n++)if(e[n]!==t[n])return!1;return!0}var BQ=Object.prototype.hasOwnProperty;function Xc(e,t){if(e===t)return!0;var r=Array.isArray(e),n=Array.isArray(t);if(r&&n){if(e.length!==t.length)return!1;for(var i=0;i<e.length;i++)if(!Xc(e[i],t[i]))return!1;return!0}if(r!==n)return!1;if(e&&t&&typeof e=="object"&&typeof t=="object"){var a=Object.keys(e);if(a.length!==Object.keys(t).length)return!1;var o=e instanceof Date,s=t instanceof Date;if(o&&s)return e.getTime()===t.getTime();if(o!==s)return!1;var u=e instanceof RegExp,l=t instanceof RegExp;if(u&&l)return e.toString()===t.toString();if(u!==l)return!1;for(var i=0;i<a.length;i++)if(!BQ.call(t,a[i]))return!1;for(var i=0;i<a.length;i++)if(!Xc(e[a[i]],t[a[i]]))return!1;return!0}return!1}function __(e,t){if(e===t)return!0;var r=Array.isArray(e),n=Array.isArray(t);return r&&n?_4e(e,t):r!==n?!1:e&&t&&typeof e=="object"&&typeof t=="object"?Hg(e,t):!1}function Hg(e,t){if(e===t)return!0;if(!e||!t)return!1;var r=Object.keys(e);if(Object.keys(t).length!==r.length)return!1;for(var n=0,i=r;n<i.length;n++){var a=i[n];if(!BQ.call(e,a)||e[a]!==t[a])return!1}return!0}function _4e(e,t){if(e===t)return!0;if(!e||!t||e.length!==t.length)return!1;for(var r=0,n=e.length;r<n;++r)if(e[r]!==t[r])return!1;return!0}function Di(e,t){return e!==void 0?e:t}function P9(e){return(e<10?"0":"")+e}function w4e(e){var t=e.getHours(),r=e.getMinutes(),n=e.getSeconds();return t+":"+P9(r)+":"+P9(n)}var h1=Math.PI/2,UQ=Math.PI/180;function Kr(e){return e*UQ}function Pu(e){return e/UQ}function E4e(e){return e!==0&&(e&e-1)===0}function A4e(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var r=0,n=0,i=0,a=e.length;i<a;++i){var o=e[i],s=Math.abs(o);s>n&&(r=o,n=s)}return r}function jQ(e,t){return e*t}function P4e(e,t,r){return(e-t)/(r-t)}function Ba(e,t,r){return Math.max(t,Math.min(r,e))}function T4e(e){return Ba(e,0,1)}function Xo(e,t,r){return e+(t-e)*r}function WS(e,t,r,n,i,a){var o=(r-e)*a,s=(n-t)*a,u=i*i,l=i*u;return(2*t-2*r+o+s)*l+(-3*t+3*r-2*o-s)*u+o*i+t}function s4(e,t,r,n){var i=1-n;return i*i*e+2*i*n*t+n*n*r}function zQ(e,t,r){return r=T4e(P4e(r,e,t)),r*r*(3-2*r)}function sa(){return sa.zero()}(function(e){function t(){var D=[.1,0,0];return D[0]=0,D}e.zero=t;function r(D,k,R){var O=t();return O[0]=D,O[1]=k,O[2]=R,O}e.create=r;function n(D,k){var R=at.toRgb(k),O=R[0],H=R[1],B=R[2],j=M(O,H,B),Y=j[0],G=j[1],$=j[2],q=116*G-16;return D[0]=q<0?0:q,D[1]=500*(Y-G),D[2]=200*(G-$),D}e.fromColor=n;function i(D,k){return kl.toLab(D,k)}e.fromHcl=i;function a(D){var k=(D[0]+16)/116,R=isNaN(D[1])?k:k+D[1]/500,O=isNaN(D[2])?k:k-D[2]/200;k=h*C(k),R=v*C(R),O=m*C(O);var H=x(3.2404542*R-1.5371385*k-.4985314*O),B=x(-.969266*R+1.8760108*k+.041556*O),j=x(.0556434*R-.2040259*k+1.0572252*O);return at.fromRgb(Math.round(Ba(H,0,255)),Math.round(Ba(B,0,255)),Math.round(Ba(j,0,255)))}e.toColor=a;function o(D,k){var R=k[0],O=k[1],H=k[2],B=Math.sqrt(O*O+H*H),j=(Pu(Math.atan2(H,O))+360)%360;return Math.round(B*1e4)===0&&(j=Number.NaN),D[0]=j,D[1]=B,D[2]=R,D}e.toHcl=o;function s(D,k){return D[0]=k[0],D[1]=k[1],D[2]=k[2],D}e.copy=s;function u(D,k,R){return D[0]=k[0]-p*R,D[1]=k[1],D[2]=k[2],D}e.darken=u;function l(D,k,R){return u(D,k,-R)}e.lighten=l;var c=[0,0,0];function d(D,k,R){return o(c,k),kl.toLab(D,kl.saturate(c,c,R))}e.saturate=d;function f(D,k,R){return d(D,k,-R)}e.desaturate=f;var p=18,v=.95047,h=1,m=1.08883,g=.137931034,y=.206896552,b=.12841855,S=.008856452;function x(D){return 255*(D<=.00304?12.92*D:1.055*Math.pow(D,1/2.4)-.055)}function C(D){return D>y?D*D*D:b*(D-g)}function w(D){return(D/=255)<=.04045?D/12.92:Math.pow((D+.055)/1.055,2.4)}function A(D){return D>S?Math.pow(D,1/3):D/b+g}function M(D,k,R){D=w(D),k=w(k),R=w(R);var O=A((.4124564*D+.3575761*k+.1804375*R)/v),H=A((.2126729*D+.7151522*k+.072175*R)/h),B=A((.0193339*D+.119192*k+.9503041*R)/m);return[O,H,B]}})(sa||(sa={}));function kl(){return kl.zero()}(function(e){function t(){var m=[.1,0,0];return m[0]=0,m}e.zero=t;function r(m,g,y){var b=t();return b[0]=m,b[1]=g,b[2]=y,b}e.create=r;var n=[0,0,0];function i(m,g){return sa.toHcl(m,sa.fromColor(n,g))}e.fromColor=i;function a(m,g){return sa.toHcl(m,g)}e.fromLab=a;var o=[0,0,0];function s(m){return sa.toColor(u(o,m))}e.toColor=s;function u(m,g){var y=g[0],b=g[1],S=g[2];return isNaN(y)&&(y=0),y=Kr(y),m[0]=S,m[1]=Math.cos(y)*b,m[2]=Math.sin(y)*b,m}e.toLab=u;function l(m,g){return m[0]=g[0],m[1]=g[1],m[2]=g[2],m}e.copy=l;function c(m,g,y){return m[0]=g[0],m[1]=Math.max(0,g[1]+h*y),m[2]=g[2],m}e.saturate=c;function d(m,g,y){return c(m,g,-y)}e.desaturate=d;var f=[0,0,0];function p(m,g,y){return u(f,g),sa.toHcl(m,sa.darken(f,f,y))}e.darken=p;function v(m,g,y){return p(m,g,-y)}e.lighten=v;var h=18})(kl||(kl={}));function at(e){return e}(function(e){function t(M){return"rgb("+(M>>16&255)+", "+(M>>8&255)+", "+(M&255)+")"}e.toStyle=t;function r(M){return"0x"+("000000"+M.toString(16)).slice(-6)}e.toHexString=r;function n(M){return"RGB: "+e.toRgb(M).join(", ")}e.toRgbString=n;function i(M){return[M>>16&255,M>>8&255,M&255]}e.toRgb=i;function a(M){return[(M>>16&255)/255,(M>>8&255)/255,(M&255)/255]}e.toRgbNormalized=a;function o(M,D,k){return M<<16|D<<8|k}e.fromRgb=o;function s(M,D,k){return M*255<<16|D*255<<8|k*255}e.fromNormalizedRgb=s;function u(M,D){return o(M[D],M[D+1],M[D+2])}e.fromArray=u;function l(M,D){return s(M[D],M[D+1],M[D+2])}e.fromNormalizedArray=l;function c(M,D,k){return D[k]=M>>16&255,D[k+1]=M>>8&255,D[k+2]=M&255,D}e.toArray=c;function d(M,D,k){return D[k]=(M>>16&255)/255,D[k+1]=(M>>8&255)/255,D[k+2]=(M&255)/255,D}e.toArrayNormalized=d;function f(M,D){return M[0]=D>>16&255,M[1]=D>>8&255,M[2]=D&255,M}e.toVec3=f;function p(M,D){return M[0]=(D>>16&255)/255,M[1]=(D>>8&255)/255,M[2]=(D&255)/255,M}e.toVec3Normalized=p;function v(M,D,k){var R=M>>16&255,O=M>>8&255,H=M&255,B=D>>16&255,j=D>>8&255,Y=D&255,G=R+(B-R)*k,$=O+(j-O)*k,q=H+(Y-H)*k;return G<<16|$<<8|q}e.interpolate=v;var h=[0,0,0];function m(M,D){return kl.fromColor(h,M),kl.toColor(kl.saturate(h,h,D))}e.saturate=m;function g(M,D){return m(M,-D)}e.desaturate=g;var y=[0,0,0];function b(M,D){return sa.fromColor(y,M),sa.toColor(sa.darken(y,y,D))}e.darken=b;function S(M,D){return b(M,-D)}e.lighten=S;function x(M){return M<.04045?M*.0773993808:Math.pow(M*.9478672986+.0521327014,2.4)}function C(M){return s(x((M>>16&255)/255),x((M>>8&255)/255),x((M&255)/255))}e.sRGBToLinear=C;function w(M){return M<.0031308?M*12.92:1.055*Math.pow(M,.41666)-.055}function A(M){return s(w((M>>16&255)/255),w((M>>8&255)/255),w((M&255)/255))}e.linearToSRGB=A})(at||(at={}));function Sr(e,t,r,n){return{label:e,description:r,list:n,type:t}}function aE(e,t,r){var n={};for(var i in e){var a=e[i];a=at.saturate(a,t),a=at.darken(a,-r),n[i]=a}return n}function VQ(e,t){return t===void 0&&(t=" "),e.replace(/([a-z\xE0-\xFF])([A-Z\xC0\xDF])/g,"$1"+t+"$2")}function Ha(e){return h0(VQ(e))}var I4e=function(e){return e.toUpperCase()};function M4e(e){return e?typeof e=="string"?e.toUpperCase():(""+e).toUpperCase():""}function h0(e){return e.toLowerCase().replace(/^\w|\s\w/g,I4e)}function D4e(e){return e.replace(/_/g," ")}function R4e(e){return e.replace(/-/g," ")}function Zo(e){return h0(VQ(D4e(R4e(e))))}function vi(e,t,r,n){var i=n.length;if(i>r-t)return!1;for(var a=0;a<i;a++)if(e.charCodeAt(t+a)!==n.charCodeAt(a))return!1;return!0}function k4e(e,t){var r=Object.keys(t),n=Object.values(t);return new(Function.bind.apply(Function,Nt(Nt([void 0],r),["return `"+e+"`;"])))().apply(void 0,n)}function Mf(e){return e.replace(/<\/?[^>]+>/g,"")}var Eo={"orange-red":Sr("Orange-Red","sequential","Orange-Red, sequential color scheme from ColorBrewer 2.0",[16775148,16705736,16635038,16628612,16551257,15689032,14102559,11730944,8323072]),"purple-blue":Sr("Purple-Blue","sequential","Purple-Blue, sequential color scheme from ColorBrewer 2.0",[16775163,15525874,13685222,10927579,7645647,3576e3,356528,285325,145496]),"blue-purple":Sr("Blue-Purple","sequential","Blue-Purple, sequential color scheme from ColorBrewer 2.0",[16252157,14740724,12571622,10403034,9213638,9202609,8929693,8458108,5046347]),oranges:Sr("Oranges","sequential","",[16774635,16705230,16634018,16625259,16616764,15821075,14239745,10892803,8333060]),"blue-green":Sr("Blue-Green","sequential","",[16252157,15070713,13429990,10082505,6734500,4304502,2329413,27948,17435]),"yellow-orange-brown":Sr("Yellow-Orange-Brown","sequential","",[16777189,16775100,16704401,16696399,16685353,15495188,13388802,10040324,6694150]),"yellow-green":Sr("Yellow-Green","sequential","",[16777189,16252089,14282915,11394446,7915129,4303709,2327619,26679,17705]),reds:Sr("Reds","sequential","",[16774640,16703698,16563105,16552562,16476746,15678252,13309981,10817301,6750221]),"red-purple":Sr("Red-Purple","sequential","",[16775155,16638173,16565696,16424885,16214177,14496919,11403646,7995767,4784234]),greens:Sr("Greens","sequential","",[16252149,15070688,13101504,10607003,7652470,4303709,2329413,27948,17435]),"yellow-green-blue":Sr("Yellow-Green-Blue","sequential","",[16777177,15595697,13101492,8375739,4306628,1937856,2252456,2438292,531800]),purples:Sr("Purples","sequential","",[16579581,15724021,14342891,12369372,10394312,8420794,6967715,5515151,4128893]),"green-blue":Sr("Green-Blue","sequential","",[16252144,14742491,13429701,11066805,8113348,5157843,2854078,551084,540801]),greys:Sr("Greys","sequential","",[16777215,15790320,14277081,12434877,9868950,7566195,5395026,2434341,0]),"yellow-orange-red":Sr("Yellow-Orange-Red","sequential","",[16777164,16772512,16701814,16691788,16616764,16535082,14883356,12386342,8388646]),"purple-red":Sr("Purple-Red","sequential","",[16250105,15196655,13941210,13210823,14640560,15149450,13505110,9961539,6750239]),blues:Sr("Blues","sequential","",[16251903,14609399,13032431,10406625,7057110,4362950,2191797,545180,536683]),"purple-blue-green":Sr("Purple-Blue-Green","sequential","",[16775163,15524592,13685222,10927579,6793679,3576e3,164234,93273,83510]),spectral:Sr("Spectral","diverging","",[10355010,13975119,16018755,16625249,16703627,16777151,15136152,11263396,6734501,3311805,6180770]),"red-yellow-green":Sr("Red-Yellow-Green","diverging","",[10813478,14102567,16018755,16625249,16703627,16777151,14282635,10934634,6733155,1742928,26679]),"red-blue":Sr("Red-Blue","diverging","",[6750239,11671595,14049357,16033154,16636871,16250871,13755888,9618910,4428739,2188972,340065]),"pink-yellow-green":Sr("Pink-Yellow-Green","diverging","",[9306450,12917629,14579630,15840986,16638191,16250871,15136208,12116358,8371265,5083681,2581529]),"purple-green":Sr("Purple-Green","diverging","",[4194379,7744131,10055851,12756431,15193320,16250871,14282963,10935200,5942881,1800247,17435]),"red-yellow-blue":Sr("Red-Yellow-Blue","diverging","Red-Yellow-Blue, diverging color scheme from ColorBrewer 2.0",[10813478,14102567,16018755,16625249,16703632,16777151,14742520,11262441,7646673,4552116,3225237]),"brown-white-green":Sr("Brown-White-Green","diverging","",[5517317,9195786,12550445,14664317,16181443,16119285,13101797,8441281,3512207,91742,15408]),"red-grey":Sr("Red-Grey","diverging","",[6750239,11671595,14049357,16033154,16636871,16777215,14737632,12237498,8882055,5066061,1710618]),"orange-purple":Sr("Orange-Purple","diverging","",[8338184,11753478,14713364,16627811,16703670,16250871,14211819,11709394,8418220,5515144,2949195]),"set-2":Sr("Set-2","qualitative","",[6734501,16551266,9281739,15174339,10934356,16767279,15058068,11776947]),accent:Sr("Accent","qualitative","",[8374655,12496596,16629894,16777113,3697840,15729279,12540695,6710886]),"set-1":Sr("Set-1","qualitative","",[14948892,3636920,5091146,9981603,16744192,16777011,10901032,16220607,10066329]),"set-3":Sr("Set-3","qualitative","",[9294791,16777139,12499674,16482418,8434131,16626786,11787881,16567781,14277081,12353725,13429701,16772463]),"dark-2":Sr("Dark-2","qualitative","",[1810039,14245634,7696563,15149450,6727198,15117058,10909213,6710886]),paired:Sr("Paired","qualitative","",[10931939,2062516,11722634,3383340,16489113,14883356,16629615,16744192,13284054,6962586,16777113,11622696]),"pastel-2":Sr("Pastel-2","qualitative","",[11789005,16633260,13358568,16042724,15136201,16773806,15852236,13421772]),"pastel-1":Sr("Pastel-1","qualitative","",[16495790,11783651,13429701,14601188,16701862,16777164,15063229,16636652,15921906]),"many-distinct":Sr("Many-Distinct","qualitative","",[1810039,14245634,7696563,15149450,6727198,15117058,10909213,6710886,14948892,3636920,5091146,9981603,16744192,16777011,10901032,16220607,10066329,6734501,16551266,9281739,15174339,10934356,16767279,15058068,11776947]),magma:Sr("Magma","sequential","Perceptually uniform shades of black-red-white",[4329332,4853881,5378684,5903742,6363263,6888576,7413633,7938689,8463745,8988801,9513600,10038655,10563454,11088508,11613562,12138360,12728949,13254258,13714030,14239338,14699366,15094114,15489119,15753309,16017499,16216411,16350045,16483424,16551523,16619368,16621934,16689780,16692091,16694402,16696969,16633746,16636058,16638371,16575148,16577461,16514239]),inferno:Sr("Inferno","sequential","Perceptually uniform shades of black-red-yellow",[4721514,5246316,5771373,6296430,6821486,7346542,7871597,8396651,8921450,9446504,9971557,10496610,10956127,11481435,12006486,12466258,12926285,13386056,13780802,14241085,14570295,14965297,15229227,15558693,15757342,15956248,16154897,16288267,16421638,16489734,16492043,16494612,16496926,16368426,16305463,16111429,15982678,15853928,15856253,16119953,16580260]),plasma:Sr("Plasma","sequential","Perceptually uniform shades of blue-red-yellow",[1771148,2426257,3081365,3671193,4195228,4784799,5308834,5833124,6357158,6815911,7340200,7864744,8324007,8783782,9309348,9769377,10164126,10624154,11018902,11413393,11808141,12137352,12466307,12795519,13124730,13453685,13717361,14046573,14309992,14573668,14837344,15035483,15299159,15497299,15695438,15893834,16091974,16224833,16357693,16425017,16557877,16625457,16627245,16629289,16631334,16567845,16438820,16310052,16115494,15921190,15726625]),viridis:Sr("Viridis","sequential","Perceptually uniform shades of blue-green-yellow",[4524123,4656994,4658793,4726127,4727668,4663929,4599933,4535937,4406404,4276870,4081800,3952010,3822475,3627148,3497356,3302029,3172237,3042446,2912654,2782862,2652814,2523022,2393229,2328973,2198924,2069132,2004874,2005897,2007175,2139525,2337154,2666111,3060348,3520376,4045684,4570991,5227369,5883748,6605661,7392854,8180303,8967495,9819967,10672695,11525166,12443174,13295646,14148121,15000344,15852828,16639780]),cividis:Sr("Cividis","sequential","Perceptually uniform shades of blue-green-yellow, should look effectively identical to colorblind and non-colorblind users",[11367,12400,537456,1455727,2046574,2571629,3031404,3425388,3754092,4148075,4476779,4805227,5133932,5396844,5725549,5988462,6317166,6580079,6843249,7171698,7434867,7697781,7960951,8289656,8618104,8881272,9209976,9538679,9867127,10195830,10524533,10853235,11181938,11510640,11839343,12168045,12497002,12891240,13219941,13548642,13943134,14271834,14666326,14995025,15389516,15718470,16112703,16507190,16639799]),twilight:Sr("Twilight","sequential","Perceptually uniform shades of white-blue-black-red-white, cyclic",[14670305,14211037,13554648,12766675,11847630,10993866,10139847,9351365,8628419,8036290,7509952,7048895,6718653,6519739,6386105,6252470,6184114,6181293,6112935,6044831,5976470,5777291,5447293,5052270,4592479,4067665,3674181,3281211,3150646,3543352,4067644,4657728,5379141,6166345,6953549,7741007,8463184,9120336,9777743,10304079,10830671,11291984,11687762,12083541,12348505,12613471,12878439,13077872,13211771,13411209,13545111,13809830,14074293,14338756,14537169,14735067,14801121]),turbo:Sr("Turbo","sequential","Improved (smooth) rainbow colormap for visualization",[4866485,4872413,4354034,3770361,3120629,2667241,2475736,2611140,3073454,3928216,5109892,6487408,8126047,9829201,11531332,13167162,14605618,15780908,16693543,16753699,16748063,16741916,16146200,15026195,13644558,12198408,10818563,9833728]),rainbow:Sr("Rainbow","sequential","",[3367393,3516485,16383744,15501073,12526114]),"red-white-blue":Sr("Red-White-Blue","diverging","",[12526114,16777215,3367393])},O4e=Object.keys(Eo),XO=O4e.map(function(e){return[e,Eo[e].label,h0(Eo[e].type)]}),L4e=XO.filter(function(e){return Eo[e[0]].type==="diverging"||Eo[e[0]].type==="sequential"}),F4e=XO.filter(function(e){return Eo[e[0]].type==="qualitative"});function $s(e){return e in Eo?Eo[e]:(console.warn("unknown color list named '"+e+"'"),Eo["red-yellow-blue"])}function Pp(e){return{kind:"table-legend",table:e}}function N4e(e,t,r){return{kind:"scale-legend",minLabel:e,maxLabel:t,colors:r}}var qe;(function(e){function t(f){return f.creator&&f.chunkSize}e.is=t;function r(f){var p=f.growBy*f.elementSize;f.currentSize=p,f.currentIndex=0,f.currentChunk=new f.ctor(p),f.allocatedSize+=p,f.chunks[f.chunks.length]=f.currentChunk}function n(f,p,v,h,m){f.currentIndex>=f.currentSize&&r(f);var g=f.currentChunk,y=f.currentIndex;return g[y]=p,g[y+1]=v,g[y+2]=h,g[y+3]=m,f.currentIndex+=4,f.elementCount++}e.add4=n;function i(f,p,v,h){f.currentIndex>=f.currentSize&&r(f);var m=f.currentChunk,g=f.currentIndex;return m[g]=p,m[g+1]=v,m[g+2]=h,f.currentIndex+=3,f.elementCount++}e.add3=i;function a(f,p,v){f.currentIndex>=f.currentSize&&r(f);var h=f.currentChunk,m=f.currentIndex;return h[m]=p,h[m+1]=v,f.currentIndex+=2,f.elementCount++}e.add2=a;function o(f,p){return f.currentIndex>=f.currentSize&&r(f),f.currentChunk[f.currentIndex]=p,f.currentIndex+=1,f.elementCount++}e.add=o;function s(f,p,v){for(var h=0;h<p;h++)f.currentIndex>=f.currentSize&&r(f),f.currentChunk[f.currentIndex++]=v,f.elementCount++;return f.elementCount}e.addRepeat=s;function u(f,p){for(var v=f.elementSize,h=0,m=p.length;h<m;h+=v){f.currentIndex>=f.currentSize&&r(f);for(var g=f.currentChunk,y=0;y<v;y++)g[f.currentIndex++]=p[h+y];f.elementCount++}return f.elementCount}e.addMany=u;function l(f,p){return p===void 0&&(p=!1),c(f,p)}e.compact=l;function c(f,p){var v=f.ctor,h=f.chunks,m=f.currentIndex;if(!h.length)return new v(0);if(h.length===1&&(p||m===f.allocatedSize))return h[0];for(var g=0,y=0,b=h.length-1;y<b;y++)g+=h[y].length;g+=f.currentIndex;var S=new v(g),x=0;if(S.buffer)for(var y=0,b=h.length-1;y<b;y++)S.set(h[y],x),x+=h[y].length;else for(var y=0,b=h.length-1;y<b;y++){for(var C=h[y],w=0,A=C.length;w<A;w++)S[x+w]=C[w];x+=C.length}var M=h[h.length-1];if(S.buffer&&m>=f.currentSize)S.set(M,x);else for(var w=0,A=M.length;w<A;w++)S[x+w]=M[w];return S}e._compact=c;function d(f,p,v,h){var m={ctor:f,elementSize:p,growBy:Math.max(1,Math.ceil(v)),allocatedSize:0,elementCount:0,currentSize:0,currentChunk:void 0,currentIndex:0,chunks:[]};if(typeof h>"u")return m;if(typeof h=="number")return m.currentChunk=new f(h*p),m.allocatedSize=h*p,m.currentSize=m.currentChunk.length,m.chunks[0]=m.currentChunk,m;var g=h;if(g.length%p!==0)throw new Error("initialChunk length must be a multiple of the element size.");return m.currentChunk=g,m.allocatedSize=g.length,m.currentSize=g.length,m.chunks[0]=g,m}e.create=d})(qe||(qe={}));function w_(e,t,r){return e[t]-e[r]}function _h(e,t,r){var n=e[t];e[t]=e[r],e[r]=n}function HQ(e,t,r,n){var i=r+n>>1;return t(e,r,n)>0?t(e,r,i)>0?t(e,i,n)>0?i:n:r:t(e,n,i)>0?t(e,i,r)>0?i:r:n}function B4e(e,t,r){var n=e.cmp,i=e.swap,a=e.data,o=e.parts,s=t+1,u=r;for(i(a,t,HQ(a,n,t,r));n(a,u,t)>0;)--u;for(var l=t+1;l<=u;l++){var c=n(a,l,t);if(c>0){for(i(a,l,u),--u;n(a,u,t)>0;)--u;l--}else c===0&&(i(a,l,s),s++)}for(var l=t;l<s;l++)i(a,l,t+u-l);o[0]=u-s+t+1,o[1]=u}function U4e(e,t,r){for(var n=e.data,i=e.cmp,a=e.swap,o=t+1;o<=r;o++)for(var s=o-1;s>=t&&i(n,s,s+1)>0;)a(n,s,s+1),s=s-1}function E_(e,t,r){for(var n=e.parts;t<r;){if(r-t<16){U4e(e,t,r);return}B4e(e,t,r);var i=n[0],a=n[1];i-t<r-a?(E_(e,t,i-1),t=a+1):(E_(e,a+1,r),r=i-1)}}function j4e(e,t,r,n){var i=r+1,a=n;_h(e,r,HQ(e,w_,r,n));for(var o=e[r];e[a]>o;)--a;for(var s=r+1;s<=a;s++){var u=e[s];if(u>o){for(_h(e,s,a),--a;e[a]>o;)--a;s--}else u===o&&(_h(e,s,i),++i)}for(var s=r;s<i;s++)_h(e,s,r+a-s);t[0]=a-i+r+1,t[1]=a}function z4e(e,t,r){for(var n=t+1;n<=r;n++){for(var i=e[n],a=n-1;a>=t&&e[a]>i;)e[a+1]=e[a],a=a-1;e[a+1]=i}}function S5(e,t,r,n){for(;r<n;){if(n-r<16){z4e(e,r,n);return}j4e(e,t,r,n);var i=t[0],a=t[1];i-r<n-a?(S5(e,t,r,i-1),r=a+1):(S5(e,t,a+1,n),n=i-1)}}function Tu(e,t){return t===void 0&&(t=w_),V4e(e,0,e.length,t)}function V4e(e,t,r,n){return n===void 0&&(n=w_),n===w_?S5(e,[0,0],t,r-1):E_({data:e,cmp:n,swap:_h,parts:[0,0]},t,r-1),e}function GQ(e,t,r,n,i){var a={data:e,cmp:n,swap:i,parts:[0,0]};return E_(a,t,r-1),e}function H4e(e,t,r){return e[t].key<e[r].key?-1:1}function G4e(e,t,r,n,i){for(var a=new Map,o=[],s=t(e[0]),u=!0,l=n;l<i;l++){var c=t(e[l]);if(a.has(c))a.get(c).count++,s!==c&&(u=!1);else{var d={key:c,count:1,offset:l};a.set(c,d),o[o.length]=d}s=c}var f=new Int32Array(o.length+1);f[o.length]=i;var p=!0;if(r){for(var l=1,v=o.length;l<v;l++)if(o[l-1].key>o[l].key){p=!1;break}}if(u&&p){for(var l=0;l<o.length;l++)f[l]=o[l].offset;return f}r&&!p&&GQ(o,0,o.length,H4e,_h);for(var h=0,l=0;l<o.length;l++){var m=o[l];m.offset=h,h+=m.count}for(var g=new Int32Array(i-n),l=n;l<i;l++){var c=t(e[l]),d=a.get(c);g[d.offset++]=e[l]}for(var l=0,v=g.length;l<v;l++)e[l+n]=g[l];f[0]=n;for(var l=1;l<o.length;l++)f[l]=o[l-1].offset+n;return f}function u4(e,t,r){var n=r&&r.start||0,i=r&&r.end||e.length;if(i-n<=0)throw new Error("Can only bucket non-empty collections.");return G4e(e,t,!!(r&&r.sort),n,i)}var q4e=function(){function e(t,r){this.getHash=t,this.areEqual=r,this.id=0,this.byHash=new Map,this.groups=[]}return e.prototype.createGroup=function(t,r){var n=this.id++,i=[t];return this.groups[n]=i,{id:n,keys:i,value:r}},e.prototype.add=function(t,r){var n=this.getHash(r);if(this.byHash.has(n)){for(var i=this.byHash.get(n),a=0,o=i.length;a<o;a++){var s=i[a];if(this.areEqual(r,s.value))return s.keys[s.keys.length]=t,s.value}var u=this.createGroup(t,r);return i[i.length]=u,u.value}else{var u=this.createGroup(t,r);return this.byHash.set(n,[u]),u.value}},e}();function $4e(e,t){return new q4e(e,t)}function qQ(e){var t=e^e>>4;return t=(t^3735928559)+(t<<5),t=t^t>>11,t}function Dv(e,t){var r=23;return r=31*r+e|0,r=31*r+t|0,r=r^r>>4,r=(r^3735928559)+(r<<5),r=r^r>>11,r}function W4e(e,t,r){var n=23;return n=31*n+e|0,n=31*n+t|0,n=31*n+r|0,n=n^n>>4,n=(n^3735928559)+(n<<5),n=n^n>>11,n}function X4e(e,t,r,n){var i=23;return i=31*i+e|0,i=31*i+t|0,i=31*i+r|0,i=31*i+n|0,i=i^i>>4,i=(i^3735928559)+(i<<5),i=i^i>>11,i}function YO(e){for(var t=0,r=0,n=e.length;r<n;r++)t=(t<<5)-t+e.charCodeAt(r++)|0;return t}function Qf(e,t){return(e+t)*(e+t+1)/2+t}function Ga(e){for(var t=2166136261,r=0,n=e.length;r<n;++r)t^=e[r],t+=(t<<1)+(t<<4)+(t<<7)+(t<<8)+(t<<24);return t>>>0}function A_(e,t){var r=t&&typeof t.start<"u"?Math.max(Math.min(t.start,e-1),0):0,n=t&&typeof t.end<"u"?Math.min(t.end,e):e;return{start:r,end:n}}function r2(e,t){var r=t&&typeof t.array<"u"?t.array:Array,n=A_(e,t),i=n.start,a=n.end;return{array:new r(a-i),start:i,end:a}}function Y4e(e,t,r){for(var n=0,i=t.length;n<i;n++)t[n]=e(r+n);return t}function ia(e,t,r){var n=r2(e,r),i=n.array,a=n.start;return Y4e(t,i,a)}function KO(e){return!!e.buffer&&typeof e.byteLength=="number"&&typeof e.BYTES_PER_ELEMENT=="number"}function P_(e,t){var r=e.constructor,n=e.buffer,i=e.length,a=e.byteOffset,o=e.BYTES_PER_ELEMENT,s=A_(i,t),u=s.start,l=s.end;return u===0&&l===i?e:new r(n,a+o*u,Math.min(i,l-u))}var xn=1e-6;function yn(e,t,r){return Math.abs(e-t)<=r}function ue(){return ue.zero()}(function(e){function t(){var L=[.1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];return L[0]=0,L}e.zero=t;function r(){var L=t();return L[0]=1,L[1]=0,L[2]=0,L[3]=0,L[4]=0,L[5]=1,L[6]=0,L[7]=0,L[8]=0,L[9]=0,L[10]=1,L[11]=0,L[12]=0,L[13]=0,L[14]=0,L[15]=1,L}e.identity=r;function n(L){return L[0]=1,L[1]=0,L[2]=0,L[3]=0,L[4]=0,L[5]=1,L[6]=0,L[7]=0,L[8]=0,L[9]=0,L[10]=1,L[11]=0,L[12]=0,L[13]=0,L[14]=0,L[15]=1,L}e.setIdentity=n;function i(L){for(var V=0;V<16;V++)L[V]=0;return L}e.setZero=i;function a(L){for(var V=t(),he=0;he<4;he++)for(var we=L[he],Te=0;Te<4;Te++)V[4*Te+he]=we[Te];return V}e.ofRows=a;var o=r();function s(L,V){return l(L,o,typeof V>"u"?xn:V)}e.isIdentity=s;function u(L){for(var V=0;V<16;V++)if(isNaN(L[V]))return!0;return!1}e.hasNaN=u;function l(L,V,he){for(var we=0;we<16;we++)if(Math.abs(L[we]-V[we])>he)return!1;return!0}e.areEqual=l;function c(L,V,he,we){L[4*he+V]=we}e.setValue=c;function d(L,V,he){return L[4*he+V]}e.getValue=d;function f(L,V,he){return V[he+0]=L[0],V[he+1]=L[1],V[he+2]=L[2],V[he+3]=L[3],V[he+4]=L[4],V[he+5]=L[5],V[he+6]=L[6],V[he+7]=L[7],V[he+8]=L[8],V[he+9]=L[9],V[he+10]=L[10],V[he+11]=L[11],V[he+12]=L[12],V[he+13]=L[13],V[he+14]=L[14],V[he+15]=L[15],V}e.toArray=f;function p(L,V,he){return L[0]=V[he+0],L[1]=V[he+1],L[2]=V[he+2],L[3]=V[he+3],L[4]=V[he+4],L[5]=V[he+5],L[6]=V[he+6],L[7]=V[he+7],L[8]=V[he+8],L[9]=V[he+9],L[10]=V[he+10],L[11]=V[he+11],L[12]=V[he+12],L[13]=V[he+13],L[14]=V[he+14],L[15]=V[he+15],L}e.fromArray=p;function v(L,V,he,we){return i(L),c(L,0,0,V[0]),c(L,1,0,V[1]),c(L,2,0,V[2]),c(L,0,1,he[0]),c(L,1,1,he[1]),c(L,2,1,he[2]),c(L,0,2,we[0]),c(L,1,2,we[1]),c(L,2,2,we[2]),c(L,3,3,1),L}e.fromBasis=v;function h(L,V){return L[0]=V[0],L[1]=V[1],L[2]=V[2],L[3]=V[3],L[4]=V[4],L[5]=V[5],L[6]=V[6],L[7]=V[7],L[8]=V[8],L[9]=V[9],L[10]=V[10],L[11]=V[11],L[12]=V[12],L[13]=V[13],L[14]=V[14],L[15]=V[15],L}e.copy=h;function m(L){return h(t(),L)}e.clone=m;function g(L,V){return L[0]=V[12],L[1]=V[13],L[2]=V[14],L}e.getTranslation=g;function y(L,V){var he=V[0],we=V[1],Te=V[2],ze=V[4],Ve=V[5],Xe=V[6],ct=V[8],Ne=V[9],Qe=V[10];return L[0]=Math.sqrt(he*he+we*we+Te*Te),L[1]=Math.sqrt(ze*ze+Ve*Ve+Xe*Xe),L[2]=Math.sqrt(ct*ct+Ne*Ne+Qe*Qe),L}e.getScaling=y;function b(L,V){var he=V[0]+V[5]+V[10],we=0;return he>0?(we=Math.sqrt(he+1)*2,L[3]=.25*we,L[0]=(V[6]-V[9])/we,L[1]=(V[8]-V[2])/we,L[2]=(V[1]-V[4])/we):V[0]>V[5]&&V[0]>V[10]?(we=Math.sqrt(1+V[0]-V[5]-V[10])*2,L[3]=(V[6]-V[9])/we,L[0]=.25*we,L[1]=(V[1]+V[4])/we,L[2]=(V[8]+V[2])/we):V[5]>V[10]?(we=Math.sqrt(1+V[5]-V[0]-V[10])*2,L[3]=(V[8]-V[2])/we,L[0]=(V[1]+V[4])/we,L[1]=.25*we,L[2]=(V[6]+V[9])/we):(we=Math.sqrt(1+V[10]-V[0]-V[5])*2,L[3]=(V[1]-V[4])/we,L[0]=(V[8]+V[2])/we,L[1]=(V[6]+V[9])/we,L[2]=.25*we),L}e.getRotation=b;function S(L,V){var he=1/Math.sqrt(V[0]*V[0]+V[1]*V[1]+V[2]*V[2]),we=1/Math.sqrt(V[4]*V[4]+V[5]*V[5]+V[6]*V[6]),Te=1/Math.sqrt(V[8]*V[8]+V[9]*V[9]+V[10]*V[10]);return L[0]=V[0]*he,L[1]=V[1]*he,L[2]=V[2]*he,L[3]=0,L[4]=V[4]*we,L[5]=V[5]*we,L[6]=V[6]*we,L[7]=0,L[8]=V[8]*Te,L[9]=V[9]*Te,L[10]=V[10]*Te,L[11]=0,L[12]=0,L[13]=0,L[14]=0,L[15]=1,L}e.extractRotation=S;function x(L,V){if(L===V){var he=V[1],we=V[2],Te=V[3],ze=V[6],Ve=V[7],Xe=V[11];L[1]=V[4],L[2]=V[8],L[3]=V[12],L[4]=he,L[6]=V[9],L[7]=V[13],L[8]=we,L[9]=ze,L[11]=V[14],L[12]=Te,L[13]=Ve,L[14]=Xe}else L[0]=V[0],L[1]=V[4],L[2]=V[8],L[3]=V[12],L[4]=V[1],L[5]=V[5],L[6]=V[9],L[7]=V[13],L[8]=V[2],L[9]=V[6],L[10]=V[10],L[11]=V[14],L[12]=V[3],L[13]=V[7],L[14]=V[11],L[15]=V[15];return L}e.transpose=x;function C(L,V){var he=V[0],we=V[1],Te=V[2],ze=V[3],Ve=V[4],Xe=V[5],ct=V[6],Ne=V[7],Qe=V[8],it=V[9],ot=V[10],dt=V[11],ke=V[12],Me=V[13],Ye=V[14],tt=V[15],xt=he*Xe-we*Ve,ht=he*ct-Te*Ve,ut=he*Ne-ze*Ve,pe=we*ct-Te*Xe,me=we*Ne-ze*Xe,Ee=Te*Ne-ze*ct,Ke=Qe*Me-it*ke,gt=Qe*Ye-ot*ke,Pt=Qe*tt-dt*ke,Wt=it*Ye-ot*Me,lr=it*tt-dt*Me,Tr=ot*tt-dt*Ye,Yt=xt*Tr-ht*lr+ut*Wt+pe*Pt-me*gt+Ee*Ke;return Yt?(Yt=1/Yt,L[0]=(Xe*Tr-ct*lr+Ne*Wt)*Yt,L[1]=(Te*lr-we*Tr-ze*Wt)*Yt,L[2]=(Me*Ee-Ye*me+tt*pe)*Yt,L[3]=(ot*me-it*Ee-dt*pe)*Yt,L[4]=(ct*Pt-Ve*Tr-Ne*gt)*Yt,L[5]=(he*Tr-Te*Pt+ze*gt)*Yt,L[6]=(Ye*ut-ke*Ee-tt*ht)*Yt,L[7]=(Qe*Ee-ot*ut+dt*ht)*Yt,L[8]=(Ve*lr-Xe*Pt+Ne*Ke)*Yt,L[9]=(we*Pt-he*lr-ze*Ke)*Yt,L[10]=(ke*me-Me*ut+tt*xt)*Yt,L[11]=(it*ut-Qe*me-dt*xt)*Yt,L[12]=(Xe*gt-Ve*Wt-ct*Ke)*Yt,L[13]=(he*Wt-we*gt+Te*Ke)*Yt,L[14]=(Me*ht-ke*pe-Ye*xt)*Yt,L[15]=(Qe*pe-it*ht+ot*xt)*Yt,!0):!1}e.tryInvert=C;function w(L,V){return C(L,V)||console.warn("non-invertible matrix.",V),L}e.invert=w;function A(L,V,he){var we=V[0],Te=V[1],ze=V[2],Ve=V[3],Xe=V[4],ct=V[5],Ne=V[6],Qe=V[7],it=V[8],ot=V[9],dt=V[10],ke=V[11],Me=V[12],Ye=V[13],tt=V[14],xt=V[15],ht=he[0],ut=he[1],pe=he[2],me=he[3];return L[0]=ht*we+ut*Xe+pe*it+me*Me,L[1]=ht*Te+ut*ct+pe*ot+me*Ye,L[2]=ht*ze+ut*Ne+pe*dt+me*tt,L[3]=ht*Ve+ut*Qe+pe*ke+me*xt,ht=he[4],ut=he[5],pe=he[6],me=he[7],L[4]=ht*we+ut*Xe+pe*it+me*Me,L[5]=ht*Te+ut*ct+pe*ot+me*Ye,L[6]=ht*ze+ut*Ne+pe*dt+me*tt,L[7]=ht*Ve+ut*Qe+pe*ke+me*xt,ht=he[8],ut=he[9],pe=he[10],me=he[11],L[8]=ht*we+ut*Xe+pe*it+me*Me,L[9]=ht*Te+ut*ct+pe*ot+me*Ye,L[10]=ht*ze+ut*Ne+pe*dt+me*tt,L[11]=ht*Ve+ut*Qe+pe*ke+me*xt,ht=he[12],ut=he[13],pe=he[14],me=he[15],L[12]=ht*we+ut*Xe+pe*it+me*Me,L[13]=ht*Te+ut*ct+pe*ot+me*Ye,L[14]=ht*ze+ut*Ne+pe*dt+me*tt,L[15]=ht*Ve+ut*Qe+pe*ke+me*xt,L}e.mul=A;function M(L,V,he,we,Te,ze){var Ve=V[0+Te],Xe=V[1+Te],ct=V[2+Te],Ne=V[3+Te],Qe=V[4+Te],it=V[5+Te],ot=V[6+Te],dt=V[7+Te],ke=V[8+Te],Me=V[9+Te],Ye=V[10+Te],tt=V[11+Te],xt=V[12+Te],ht=V[13+Te],ut=V[14+Te],pe=V[15+Te],me=he[0+ze],Ee=he[1+ze],Ke=he[2+ze],gt=he[3+ze];return L[0+we]=me*Ve+Ee*Qe+Ke*ke+gt*xt,L[1+we]=me*Xe+Ee*it+Ke*Me+gt*ht,L[2+we]=me*ct+Ee*ot+Ke*Ye+gt*ut,L[3+we]=me*Ne+Ee*dt+Ke*tt+gt*pe,me=he[4+ze],Ee=he[5+ze],Ke=he[6+ze],gt=he[7+ze],L[4+we]=me*Ve+Ee*Qe+Ke*ke+gt*xt,L[5+we]=me*Xe+Ee*it+Ke*Me+gt*ht,L[6+we]=me*ct+Ee*ot+Ke*Ye+gt*ut,L[7+we]=me*Ne+Ee*dt+Ke*tt+gt*pe,me=he[8+ze],Ee=he[9+ze],Ke=he[10+ze],gt=he[11+ze],L[8+we]=me*Ve+Ee*Qe+Ke*ke+gt*xt,L[9+we]=me*Xe+Ee*it+Ke*Me+gt*ht,L[10+we]=me*ct+Ee*ot+Ke*Ye+gt*ut,L[11+we]=me*Ne+Ee*dt+Ke*tt+gt*pe,me=he[12+ze],Ee=he[13+ze],Ke=he[14+ze],gt=he[15+ze],L[12+we]=me*Ve+Ee*Qe+Ke*ke+gt*xt,L[13+we]=me*Xe+Ee*it+Ke*Me+gt*ht,L[14+we]=me*ct+Ee*ot+Ke*Ye+gt*ut,L[15+we]=me*Ne+Ee*dt+Ke*tt+gt*pe,L}e.mulOffset=M;function D(L,V,he,we){return A(L,A(L,V,he),we)}e.mul3=D;function k(L,V,he){var we=he[0],Te=he[1],ze=he[2],Ve,Xe,ct,Ne,Qe,it,ot,dt,ke,Me,Ye,tt;return V===L?(L[12]=V[0]*we+V[4]*Te+V[8]*ze+V[12],L[13]=V[1]*we+V[5]*Te+V[9]*ze+V[13],L[14]=V[2]*we+V[6]*Te+V[10]*ze+V[14],L[15]=V[3]*we+V[7]*Te+V[11]*ze+V[15]):(Ve=V[0],Xe=V[1],ct=V[2],Ne=V[3],Qe=V[4],it=V[5],ot=V[6],dt=V[7],ke=V[8],Me=V[9],Ye=V[10],tt=V[11],L[0]=Ve,L[1]=Xe,L[2]=ct,L[3]=Ne,L[4]=Qe,L[5]=it,L[6]=ot,L[7]=dt,L[8]=ke,L[9]=Me,L[10]=Ye,L[11]=tt,L[12]=Ve*we+Qe*Te+ke*ze+V[12],L[13]=Xe*we+it*Te+Me*ze+V[13],L[14]=ct*we+ot*Te+Ye*ze+V[14],L[15]=Ne*we+dt*Te+tt*ze+V[15]),L}e.translate=k;function R(L,V){return L[0]=1,L[1]=0,L[2]=0,L[3]=0,L[4]=0,L[5]=1,L[6]=0,L[7]=0,L[8]=0,L[9]=0,L[10]=1,L[11]=0,L[12]=V[0],L[13]=V[1],L[14]=V[2],L[15]=1,L}e.fromTranslation=R;function O(L,V){return L[12]=V[0],L[13]=V[1],L[14]=V[2],L}e.setTranslation=O;function H(L,V,he,we){return L[0]=he[0],L[4]=he[1],L[8]=he[2],L[1]=we[0],L[5]=we[1],L[9]=we[2],L[2]=V[0],L[6]=V[1],L[10]=V[2],L}e.setAxes=H;function B(L,V,he,we){var Te=we[0],ze=we[1],Ve=we[2],Xe=Math.sqrt(Te*Te+ze*ze+Ve*Ve),ct,Ne,Qe,it,ot,dt,ke,Me,Ye,tt,xt,ht,ut,pe,me,Ee,Ke,gt,Pt,Wt,lr,Tr,Yt,ai;return Math.abs(Xe)<xn?r():(Xe=1/Xe,Te*=Xe,ze*=Xe,Ve*=Xe,ct=Math.sin(he),Ne=Math.cos(he),Qe=1-Ne,it=V[0],ot=V[1],dt=V[2],ke=V[3],Me=V[4],Ye=V[5],tt=V[6],xt=V[7],ht=V[8],ut=V[9],pe=V[10],me=V[11],Ee=Te*Te*Qe+Ne,Ke=ze*Te*Qe+Ve*ct,gt=Ve*Te*Qe-ze*ct,Pt=Te*ze*Qe-Ve*ct,Wt=ze*ze*Qe+Ne,lr=Ve*ze*Qe+Te*ct,Tr=Te*Ve*Qe+ze*ct,Yt=ze*Ve*Qe-Te*ct,ai=Ve*Ve*Qe+Ne,L[0]=it*Ee+Me*Ke+ht*gt,L[1]=ot*Ee+Ye*Ke+ut*gt,L[2]=dt*Ee+tt*Ke+pe*gt,L[3]=ke*Ee+xt*Ke+me*gt,L[4]=it*Pt+Me*Wt+ht*lr,L[5]=ot*Pt+Ye*Wt+ut*lr,L[6]=dt*Pt+tt*Wt+pe*lr,L[7]=ke*Pt+xt*Wt+me*lr,L[8]=it*Tr+Me*Yt+ht*ai,L[9]=ot*Tr+Ye*Yt+ut*ai,L[10]=dt*Tr+tt*Yt+pe*ai,L[11]=ke*Tr+xt*Yt+me*ai,V!==L&&(L[12]=V[12],L[13]=V[13],L[14]=V[14],L[15]=V[15]),L)}e.rotate=B;function j(L,V,he){var we=he[0],Te=he[1],ze=he[2],Ve=Math.sqrt(we*we+Te*Te+ze*ze),Xe,ct,Ne;return Math.abs(Ve)<xn?n(L):(Ve=1/Ve,we*=Ve,Te*=Ve,ze*=Ve,Xe=Math.sin(V),ct=Math.cos(V),Ne=1-ct,L[0]=we*we*Ne+ct,L[1]=Te*we*Ne+ze*Xe,L[2]=ze*we*Ne-Te*Xe,L[3]=0,L[4]=we*Te*Ne-ze*Xe,L[5]=Te*Te*Ne+ct,L[6]=ze*Te*Ne+we*Xe,L[7]=0,L[8]=we*ze*Ne+Te*Xe,L[9]=Te*ze*Ne-we*Xe,L[10]=ze*ze*Ne+ct,L[11]=0,L[12]=0,L[13]=0,L[14]=0,L[15]=1,L)}e.fromRotation=j;function Y(L,V,he){var we=he[0],Te=he[1],ze=he[2];return L[0]=V[0]*we,L[1]=V[1]*we,L[2]=V[2]*we,L[3]=V[3]*we,L[4]=V[4]*Te,L[5]=V[5]*Te,L[6]=V[6]*Te,L[7]=V[7]*Te,L[8]=V[8]*ze,L[9]=V[9]*ze,L[10]=V[10]*ze,L[11]=V[11]*ze,L[12]=V[12],L[13]=V[13],L[14]=V[14],L[15]=V[15],L}e.scale=Y;function G(L,V,he){return L[0]=V[0]*he,L[1]=V[1]*he,L[2]=V[2]*he,L[3]=V[3]*he,L[4]=V[4]*he,L[5]=V[5]*he,L[6]=V[6]*he,L[7]=V[7]*he,L[8]=V[8]*he,L[9]=V[9]*he,L[10]=V[10]*he,L[11]=V[11]*he,L[12]=V[12],L[13]=V[13],L[14]=V[14],L[15]=V[15],L}e.scaleUniformly=G;function $(L,V){return L[0]=V[0],L[1]=0,L[2]=0,L[3]=0,L[4]=0,L[5]=V[1],L[6]=0,L[7]=0,L[8]=0,L[9]=0,L[10]=V[2],L[11]=0,L[12]=0,L[13]=0,L[14]=0,L[15]=1,L}e.fromScaling=$;function q(L,V){return L[0]=V,L[1]=0,L[2]=0,L[3]=0,L[4]=0,L[5]=V,L[6]=0,L[7]=0,L[8]=0,L[9]=0,L[10]=V,L[11]=0,L[12]=0,L[13]=0,L[14]=0,L[15]=1,L}e.fromUniformScaling=q;function ee(L,V){return L[0]=V[0],L[1]=V[1],L[2]=V[2],L[4]=V[3],L[5]=V[4],L[6]=V[5],L[8]=V[6],L[9]=V[7],L[10]=V[8],L}e.fromMat3=ee;function fe(L){for(var V="",he=0;he<4;he++){for(var we=0;we<4;we++)V+=L[4*we+he].toString(),we<3&&(V+=" ");he<3&&(V+=`
`)}return V}e.makeTable=fe;function W(L){var V=L[0],he=L[1],we=L[2],Te=L[3],ze=L[4],Ve=L[5],Xe=L[6],ct=L[7],Ne=L[8],Qe=L[9],it=L[10],ot=L[11],dt=L[12],ke=L[13],Me=L[14],Ye=L[15],tt=V*Ve-he*ze,xt=V*Xe-we*ze,ht=V*ct-Te*ze,ut=he*Xe-we*Ve,pe=he*ct-Te*Ve,me=we*ct-Te*Xe,Ee=Ne*ke-Qe*dt,Ke=Ne*Me-it*dt,gt=Ne*Ye-ot*dt,Pt=Qe*Me-it*ke,Wt=Qe*Ye-ot*ke,lr=it*Ye-ot*Me;return tt*lr-xt*Wt+ht*Pt+ut*gt-pe*Ke+me*Ee}e.determinant=W;function X(L,V){return U(L,typeof V<"u"?V:xn)}e.isRotationAndTranslation=X;function U(L,V){var he=L[0],we=L[1],Te=L[2],ze=L[3],Ve=L[4],Xe=L[5],ct=L[6],Ne=L[7],Qe=L[8],it=L[9],ot=L[10],dt=L[11],ke=L[15];if(!yn(ke,1,V)||!yn(ze,0,V)||!yn(Ne,0,V)||!yn(dt,0,V))return!1;var Me=Math.abs(he*(Xe*ot-ct*it)-we*(Ve*ot-ct*Qe)+Te*(Ve*it-Xe*Qe));return!!yn(Me,1,V)}function z(L,V){return J(L,typeof V<"u"?V:xn)}e.isTranslationAndUniformScaling=z;function J(L,V){var he=L[0];return yn(L[1],0,V)&&yn(L[2],0,V)&&yn(L[3],0,V)&&yn(L[4],0,V)&&yn(L[5],he,V)&&yn(L[6],0,V)&&yn(L[7],0,V)&&yn(L[8],0,V)&&yn(L[9],0,V)&&yn(L[10],he,V)&&yn(L[11],0,V)&&yn(L[15],1,V)}function K(L,V){var he=V[0],we=V[1],Te=V[2],ze=V[3],Ve=he+he,Xe=we+we,ct=Te+Te,Ne=he*Ve,Qe=we*Ve,it=we*Xe,ot=Te*Ve,dt=Te*Xe,ke=Te*ct,Me=ze*Ve,Ye=ze*Xe,tt=ze*ct;return L[0]=1-it-ke,L[1]=Qe+tt,L[2]=ot-Ye,L[3]=0,L[4]=Qe-tt,L[5]=1-Ne-ke,L[6]=dt+Me,L[7]=0,L[8]=ot+Ye,L[9]=dt-Me,L[10]=1-Ne-it,L[11]=0,L[12]=0,L[13]=0,L[14]=0,L[15]=1,L}e.fromQuat=K;function Z(L,V,he,we,Te,ze,Ve){var Xe=2*ze/(he-V),ct=2*ze/(we-Te),Ne=(he+V)/(he-V),Qe=(we+Te)/(we-Te),it=-(Ve+ze)/(Ve-ze),ot=-2*Ve*ze/(Ve-ze);return L[0]=Xe,L[1]=0,L[2]=0,L[3]=0,L[4]=0,L[5]=ct,L[6]=0,L[7]=0,L[8]=Ne,L[9]=Qe,L[10]=it,L[11]=-1,L[12]=0,L[13]=0,L[14]=ot,L[15]=0,L}e.perspective=Z;function te(L,V,he,we,Te,ze,Ve){var Xe=1/(he-V),ct=1/(we-Te),Ne=1/(Ve-ze),Qe=(he+V)*Xe,it=(we+Te)*ct,ot=(Ve+ze)*Ne;return L[0]=2*Xe,L[1]=0,L[2]=0,L[3]=0,L[4]=0,L[5]=2*ct,L[6]=0,L[7]=0,L[8]=0,L[9]=0,L[10]=-2*Ne,L[11]=0,L[12]=-Qe,L[13]=-it,L[14]=-ot,L[15]=1,L}e.ortho=te;function le(L,V,he,we){var Te,ze,Ve,Xe,ct,Ne,Qe,it,ot,dt,ke=V[0],Me=V[1],Ye=V[2],tt=we[0],xt=we[1],ht=we[2],ut=he[0],pe=he[1],me=he[2];return Math.abs(ke-ut)<xn&&Math.abs(Me-pe)<xn&&Math.abs(Ye-me)<xn?n(L):(Qe=ke-ut,it=Me-pe,ot=Ye-me,dt=1/Math.sqrt(Qe*Qe+it*it+ot*ot),Qe*=dt,it*=dt,ot*=dt,Te=xt*ot-ht*it,ze=ht*Qe-tt*ot,Ve=tt*it-xt*Qe,dt=Math.sqrt(Te*Te+ze*ze+Ve*Ve),dt?(dt=1/dt,Te*=dt,ze*=dt,Ve*=dt):(Te=0,ze=0,Ve=0),Xe=it*Ve-ot*ze,ct=ot*Te-Qe*Ve,Ne=Qe*ze-it*Te,dt=Math.sqrt(Xe*Xe+ct*ct+Ne*Ne),dt?(dt=1/dt,Xe*=dt,ct*=dt,Ne*=dt):(Xe=0,ct=0,Ne=0),L[0]=Te,L[1]=Xe,L[2]=Qe,L[3]=0,L[4]=ze,L[5]=ct,L[6]=it,L[7]=0,L[8]=Ve,L[9]=Ne,L[10]=ot,L[11]=0,L[12]=-(Te*ke+ze*Me+Ve*Ye),L[13]=-(Xe*ke+ct*Me+Ne*Ye),L[14]=-(Qe*ke+it*Me+ot*Ye),L[15]=1,L)}e.lookAt=le;function ye(L,V,he,we){var Te=V[0],ze=V[1],Ve=V[2],Xe=we[0],ct=we[1],Ne=we[2],Qe=Te-he[0],it=ze-he[1],ot=Ve-he[2],dt=Qe*Qe+it*it+ot*ot;dt>0&&(dt=1/Math.sqrt(dt),Qe*=dt,it*=dt,ot*=dt);var ke=ct*ot-Ne*it,Me=Ne*Qe-Xe*ot,Ye=Xe*it-ct*Qe;return dt=ke*ke+Me*Me+Ye*Ye,dt>0&&(dt=1/Math.sqrt(dt),ke*=dt,Me*=dt,Ye*=dt),L[0]=ke,L[1]=Me,L[2]=Ye,L[3]=0,L[4]=it*Ye-ot*Me,L[5]=ot*ke-Qe*Ye,L[6]=Qe*Me-it*ke,L[7]=0,L[8]=Qe,L[9]=it,L[10]=ot,L[11]=0,L[12]=Te,L[13]=ze,L[14]=Ve,L[15]=1,L}e.targetTo=ye;function be(L,V){i(L);for(var he=0;he<4;he++){var we=V[he];c(L,he,we,1)}return L}e.fromPermutation=be;function Ae(L){var V=L[0]*L[0]+L[1]*L[1]+L[2]*L[2],he=L[4]*L[4]+L[5]*L[5]+L[6]*L[6],we=L[8]*L[8]+L[9]*L[9]+L[10]*L[10];return Math.sqrt(Math.max(V,he,we))}e.getMaxScaleOnAxis=Ae;var Se=[1,0,0],ie=[0,1,0],oe=[0,0,1];e.rotX90=j(t(),Kr(90),Se),e.rotX180=j(t(),Kr(180),Se),e.rotY90=j(t(),Kr(90),ie),e.rotY180=j(t(),Kr(180),ie),e.rotY270=j(t(),Kr(270),ie),e.rotZ90=j(t(),Kr(90),oe),e.rotZ180=j(t(),Kr(180),oe),e.rotXY90=A(t(),e.rotX90,e.rotY90),e.rotZY90=A(t(),e.rotZ90,e.rotY90),e.rotZYZ90=A(t(),e.rotZY90,e.rotZ90),e.rotZ90X180=A(t(),e.rotZ90,e.rotX180),e.rotY90Z180=A(t(),e.rotY90,e.rotZ180),e.id=r()})(ue||(ue={}));function _(){return _.zero()}(function(e){function t(){var pe=[.1,0,0];return pe[0]=0,pe}e.zero=t;function r(pe){var me=t();return me[0]=pe[0],me[1]=pe[1],me[2]=pe[2],me}e.clone=r;function n(pe){return isNaN(pe[0])||isNaN(pe[1])||isNaN(pe[2])}e.hasNaN=n;function i(pe){return pe[0]=NaN,pe[1]=NaN,pe[2]=NaN,pe}e.setNaN=i;function a(pe){return l(pe.x,pe.y,pe.z)}e.fromObj=a;function o(pe){return{x:pe[0],y:pe[1],z:pe[2]}}e.toObj=o;function s(pe,me,Ee){return pe[0]=me[Ee+0],pe[1]=me[Ee+1],pe[2]=me[Ee+2],pe}e.fromArray=s;function u(pe,me,Ee){return me[Ee+0]=pe[0],me[Ee+1]=pe[1],me[Ee+2]=pe[2],me}e.toArray=u;function l(pe,me,Ee){var Ke=t();return Ke[0]=pe,Ke[1]=me,Ke[2]=Ee,Ke}e.create=l;function c(pe){var me=t();return me[0]=pe[0],me[1]=pe[1],me[2]=pe[2],me}e.ofArray=c;function d(pe,me,Ee,Ke){return pe[0]=me,pe[1]=Ee,pe[2]=Ke,pe}e.set=d;function f(pe,me){return pe[0]=me[0],pe[1]=me[1],pe[2]=me[2],pe}e.copy=f;function p(pe,me,Ee){return pe[0]=me[0]+Ee[0],pe[1]=me[1]+Ee[1],pe[2]=me[2]+Ee[2],pe}e.add=p;function v(pe,me,Ee){return pe[0]=me[0]-Ee[0],pe[1]=me[1]-Ee[1],pe[2]=me[2]-Ee[2],pe}e.sub=v;function h(pe,me,Ee){return pe[0]=me[0]*Ee[0],pe[1]=me[1]*Ee[1],pe[2]=me[2]*Ee[2],pe}e.mul=h;function m(pe,me,Ee){return pe[0]=me[0]/Ee[0],pe[1]=me[1]/Ee[1],pe[2]=me[2]/Ee[2],pe}e.div=m;function g(pe,me,Ee){return pe[0]=me[0]*Ee,pe[1]=me[1]*Ee,pe[2]=me[2]*Ee,pe}e.scale=g;function y(pe,me,Ee,Ke){return pe[0]=me[0]+Ee[0]*Ke,pe[1]=me[1]+Ee[1]*Ke,pe[2]=me[2]+Ee[2]*Ke,pe}e.scaleAndAdd=y;function b(pe,me,Ee,Ke){return pe[0]=me[0]-Ee[0]*Ke,pe[1]=me[1]-Ee[1]*Ke,pe[2]=me[2]-Ee[2]*Ke,pe}e.scaleAndSub=b;function S(pe,me,Ee){return pe[0]=me[0]+Ee,pe[1]=me[1]+Ee,pe[2]=me[2]+Ee,pe}e.addScalar=S;function x(pe,me,Ee){return pe[0]=me[0]-Ee,pe[1]=me[1]-Ee,pe[2]=me[2]-Ee,pe}e.subScalar=x;function C(pe,me){return pe[0]=Math.round(me[0]),pe[1]=Math.round(me[1]),pe[2]=Math.round(me[2]),pe}e.round=C;function w(pe,me){return pe[0]=Math.ceil(me[0]),pe[1]=Math.ceil(me[1]),pe[2]=Math.ceil(me[2]),pe}e.ceil=w;function A(pe,me){return pe[0]=Math.floor(me[0]),pe[1]=Math.floor(me[1]),pe[2]=Math.floor(me[2]),pe}e.floor=A;function M(pe,me){return pe[0]=Math.trunc(me[0]),pe[1]=Math.trunc(me[1]),pe[2]=Math.trunc(me[2]),pe}e.trunc=M;function D(pe,me){return pe[0]=Math.abs(me[0]),pe[1]=Math.abs(me[1]),pe[2]=Math.abs(me[2]),pe}e.abs=D;function k(pe,me,Ee){return pe[0]=Math.min(me[0],Ee[0]),pe[1]=Math.min(me[1],Ee[1]),pe[2]=Math.min(me[2],Ee[2]),pe}e.min=k;function R(pe,me,Ee){return pe[0]=Math.max(me[0],Ee[0]),pe[1]=Math.max(me[1],Ee[1]),pe[2]=Math.max(me[2],Ee[2]),pe}e.max=R;function O(pe,me){var Ee=me[0]-pe[0],Ke=me[1]-pe[1],gt=me[2]-pe[2];return Math.sqrt(Ee*Ee+Ke*Ke+gt*gt)}e.distance=O;function H(pe,me){var Ee=me[0]-pe[0],Ke=me[1]-pe[1],gt=me[2]-pe[2];return Ee*Ee+Ke*Ke+gt*gt}e.squaredDistance=H;function B(pe){var me=pe[0],Ee=pe[1],Ke=pe[2];return Math.sqrt(me*me+Ee*Ee+Ke*Ke)}e.magnitude=B;function j(pe){var me=pe[0],Ee=pe[1],Ke=pe[2];return me*me+Ee*Ee+Ke*Ke}e.squaredMagnitude=j;function Y(pe,me,Ee){return g(pe,q(pe,me),Ee)}e.setMagnitude=Y;function G(pe,me){return pe[0]=-me[0],pe[1]=-me[1],pe[2]=-me[2],pe}e.negate=G;function $(pe,me){return pe[0]=1/me[0],pe[1]=1/me[1],pe[2]=1/me[2],pe}e.inverse=$;function q(pe,me){var Ee=me[0],Ke=me[1],gt=me[2],Pt=Ee*Ee+Ke*Ke+gt*gt;return Pt>0&&(Pt=1/Math.sqrt(Pt),pe[0]=me[0]*Pt,pe[1]=me[1]*Pt,pe[2]=me[2]*Pt),pe}e.normalize=q;function ee(pe,me){return pe[0]*me[0]+pe[1]*me[1]+pe[2]*me[2]}e.dot=ee;function fe(pe,me,Ee){var Ke=me[0],gt=me[1],Pt=me[2],Wt=Ee[0],lr=Ee[1],Tr=Ee[2];return pe[0]=gt*Tr-Pt*lr,pe[1]=Pt*Wt-Ke*Tr,pe[2]=Ke*lr-gt*Wt,pe}e.cross=fe;function W(pe,me,Ee,Ke){var gt=me[0],Pt=me[1],Wt=me[2];return pe[0]=gt+Ke*(Ee[0]-gt),pe[1]=Pt+Ke*(Ee[1]-Pt),pe[2]=Wt+Ke*(Ee[2]-Wt),pe}e.lerp=W;var X=t();function U(pe,me,Ee,Ke){var gt=Ba(ee(me,Ee),-1,1),Pt=Math.acos(gt)*Ke;return y(X,Ee,me,-gt),q(X,X),p(pe,g(pe,me,Math.cos(Pt)),g(X,X,Math.sin(Pt)))}e.slerp=U;function z(pe,me,Ee,Ke,gt,Pt){var Wt=Pt*Pt,lr=Wt*(2*Pt-3)+1,Tr=Wt*(Pt-2)+Pt,Yt=Wt*(Pt-1),ai=Wt*(3-2*Pt);return pe[0]=me[0]*lr+Ee[0]*Tr+Ke[0]*Yt+gt[0]*ai,pe[1]=me[1]*lr+Ee[1]*Tr+Ke[1]*Yt+gt[1]*ai,pe[2]=me[2]*lr+Ee[2]*Tr+Ke[2]*Yt+gt[2]*ai,pe}e.hermite=z;function J(pe,me,Ee,Ke,gt,Pt){var Wt=1-Pt,lr=Wt*Wt,Tr=Pt*Pt,Yt=lr*Wt,ai=3*Pt*lr,ea=3*Tr*Wt,ta=Tr*Pt;return pe[0]=me[0]*Yt+Ee[0]*ai+Ke[0]*ea+gt[0]*ta,pe[1]=me[1]*Yt+Ee[1]*ai+Ke[1]*ea+gt[1]*ta,pe[2]=me[2]*Yt+Ee[2]*ai+Ke[2]*ea+gt[2]*ta,pe}e.bezier=J;function K(pe,me,Ee,Ke,gt){return pe[0]=s4(me[0],Ee[0],Ke[0],gt),pe[1]=s4(me[1],Ee[1],Ke[1],gt),pe[2]=s4(me[2],Ee[2],Ke[2],gt),pe}e.quadraticBezier=K;function Z(pe,me,Ee,Ke,gt,Pt,Wt){return pe[0]=WS(me[0],Ee[0],Ke[0],gt[0],Pt,Wt),pe[1]=WS(me[1],Ee[1],Ke[1],gt[1],Pt,Wt),pe[2]=WS(me[2],Ee[2],Ke[2],gt[2],Pt,Wt),pe}e.spline=Z;function te(pe,me){var Ee=Math.random()*2*Math.PI,Ke=Math.random()*2-1,gt=Math.sqrt(1-Ke*Ke)*me;return pe[0]=Math.cos(Ee)*gt,pe[1]=Math.sin(Ee)*gt,pe[2]=Ke*me,pe}e.random=te;function le(pe,me,Ee){var Ke=me[0],gt=me[1],Pt=me[2],Wt=1/(Ee[3]*Ke+Ee[7]*gt+Ee[11]*Pt+Ee[15]||1);return pe[0]=(Ee[0]*Ke+Ee[4]*gt+Ee[8]*Pt+Ee[12])*Wt,pe[1]=(Ee[1]*Ke+Ee[5]*gt+Ee[9]*Pt+Ee[13])*Wt,pe[2]=(Ee[2]*Ke+Ee[6]*gt+Ee[10]*Pt+Ee[14])*Wt,pe}e.transformMat4=le;function ye(pe,me,Ee,Ke,gt,Pt){var Wt=me[0+gt],lr=me[1+gt],Tr=me[2+gt],Yt=1/(Ee[3+Pt]*Wt+Ee[7+Pt]*lr+Ee[11+Pt]*Tr+Ee[15+Pt]||1);return pe[0+Ke]=(Ee[0+Pt]*Wt+Ee[4+Pt]*lr+Ee[8+Pt]*Tr+Ee[12+Pt])*Yt,pe[1+Ke]=(Ee[1+Pt]*Wt+Ee[5+Pt]*lr+Ee[9+Pt]*Tr+Ee[13+Pt])*Yt,pe[2+Ke]=(Ee[2+Pt]*Wt+Ee[6+Pt]*lr+Ee[10+Pt]*Tr+Ee[14+Pt])*Yt,pe}e.transformMat4Offset=ye;function be(pe,me,Ee){var Ke=me[0],gt=me[1],Pt=me[2];return pe[0]=Ke*Ee[0]+gt*Ee[3]+Pt*Ee[6],pe[1]=Ke*Ee[1]+gt*Ee[4]+Pt*Ee[7],pe[2]=Ke*Ee[2]+gt*Ee[5]+Pt*Ee[8],pe}e.transformMat3=be;function Ae(pe,me,Ee){var Ke=me[0],gt=me[1],Pt=me[2],Wt=Ee[0],lr=Ee[1],Tr=Ee[2],Yt=Ee[3],ai=Yt*Ke+lr*Pt-Tr*gt,ea=Yt*gt+Tr*Ke-Wt*Pt,ta=Yt*Pt+Wt*gt-lr*Ke,Oo=-Wt*Ke-lr*gt-Tr*Pt;return pe[0]=ai*Yt+Oo*-Wt+ea*-Tr-ta*-lr,pe[1]=ea*Yt+Oo*-lr+ta*-Wt-ai*-Tr,pe[2]=ta*Yt+Oo*-Tr+ai*-lr-ea*-Wt,pe}e.transformQuat=Ae;function Se(pe,me){var Ee=Math.sqrt(j(pe)*j(me));if(Ee===0)return Math.PI/2;var Ke=ee(pe,me)/Ee;return Math.acos(Ba(Ke,-1,1))}e.angle=Se;var ie=t(),oe=t(),L=t(),V=t(),he=t(),we=t(),Te=t();function ze(pe,me,Ee,Ke){v(ie,pe,me),v(oe,Ee,me),v(L,me,Ee),v(V,Ke,Ee),fe(he,ie,oe),fe(we,L,V);var gt=Se(he,we);return fe(Te,he,we),ee(oe,Te)>0?gt:-gt}e.dihedralAngle=ze;function Ve(pe,me){return pe[0]===me[0]&&pe[1]===me[1]&&pe[2]===me[2]}e.exactEquals=Ve;function Xe(pe,me){var Ee=pe[0],Ke=pe[1],gt=pe[2],Pt=me[0],Wt=me[1],lr=me[2];return Math.abs(Ee-Pt)<=xn*Math.max(1,Math.abs(Ee),Math.abs(Pt))&&Math.abs(Ke-Wt)<=xn*Math.max(1,Math.abs(Ke),Math.abs(Wt))&&Math.abs(gt-lr)<=xn*Math.max(1,Math.abs(gt),Math.abs(lr))}e.equals=Xe;var ct=t();function Ne(pe,me,Ee){var Ke=Se(me,Ee);if(Math.abs(Ke)<1e-4)return ue.setIdentity(pe);if(Math.abs(Ke-Math.PI)<xn)return ue.fromScaling(pe,e.negUnit);var gt=fe(ct,me,Ee);return ue.fromRotation(pe,Ke,gt)}e.makeRotation=Ne;function Qe(pe){return pe[0]===0&&pe[1]===0&&pe[2]===0}e.isZero=Qe;function it(pe,me,Ee,Ke){v(pe,f(pe,me),Ke);var gt=ee(Ee,pe)/j(Ee);return p(pe,g(pe,f(pe,Ee),gt),Ke)}e.projectPointOnVector=it;function ot(pe,me,Ee){var Ke=ee(Ee,me)/j(Ee);return g(pe,Ee,Ke)}e.projectOnVector=ot;var dt=t();function ke(pe,me,Ee){return ot(dt,me,Ee),v(pe,me,dt)}e.projectOnPlane=ke;function Me(pe,me,Ee){return q(pe,fe(pe,fe(pe,me,Ee),me))}e.orthogonalize=Me;function Ye(pe,me,Ee){return ee(me,Ee)>0?f(pe,me):G(pe,f(pe,me)),pe}e.matchDirection=Ye;var tt=t(),xt=t();function ht(pe,me,Ee,Ke){return v(tt,Ee,me),v(xt,Ke,me),q(pe,fe(pe,tt,xt))}e.triangleNormal=ht;function ut(pe,me){return"["+pe[0].toPrecision(me)+" "+pe[1].toPrecision(me)+" "+pe[2].toPrecision(me)+"]"}e.toString=ut,e.origin=l(0,0,0),e.unit=l(1,1,1),e.negUnit=l(-1,-1,-1),e.unitX=l(1,0,0),e.unitY=l(0,1,0),e.unitZ=l(0,0,1),e.negUnitX=l(-1,0,0),e.negUnitY=l(0,-1,0),e.negUnitZ=l(0,0,-1)})(_||(_={}));function $n(){return $n.zero()}(function(e){function t(){var W=[.1,0,0,0,0,0,0,0,0];return W[0]=0,W}e.zero=t;function r(){var W=t();return W[0]=1,W[1]=0,W[2]=0,W[3]=0,W[4]=1,W[5]=0,W[6]=0,W[7]=0,W[8]=1,W}e.identity=r;function n(W){return W[0]=1,W[1]=0,W[2]=0,W[3]=0,W[4]=1,W[5]=0,W[6]=0,W[7]=0,W[8]=1,W}e.setIdentity=n;function i(W,X,U){return X[U+0]=W[0],X[U+1]=W[1],X[U+2]=W[2],X[U+3]=W[3],X[U+4]=W[4],X[U+5]=W[5],X[U+6]=W[6],X[U+7]=W[7],X[U+8]=W[8],X}e.toArray=i;function a(W,X,U){return W[0]=X[U+0],W[1]=X[U+1],W[2]=X[U+2],W[3]=X[U+3],W[4]=X[U+4],W[5]=X[U+5],W[6]=X[U+6],W[7]=X[U+7],W[8]=X[U+8],W}e.fromArray=a;function o(W,X){return W[0]=X[0],W[1]=X[1],W[2]=X[2],W[3]=X[4],W[4]=X[5],W[5]=X[6],W[6]=X[8],W[7]=X[9],W[8]=X[10],W}e.fromMat4=o;function s(W,X,U,z,J,K,Z,te,le){var ye=t();return ye[0]=W,ye[1]=X,ye[2]=U,ye[3]=z,ye[4]=J,ye[5]=K,ye[6]=Z,ye[7]=te,ye[8]=le,ye}e.create=s;var u=r();function l(W,X){return f(W,u,typeof X>"u"?xn:X)}e.isIdentity=l;function c(W){for(var X=0;X<9;X++)if(isNaN(W[X]))return!0;return!1}e.hasNaN=c;function d(W){return h(t(),W)}e.clone=d;function f(W,X,U){for(var z=0;z<9;z++)if(Math.abs(W[z]-X[z])>U)return!1;return!0}e.areEqual=f;function p(W,X,U,z){W[3*U+X]=z}e.setValue=p;function v(W,X,U){return W[3*U+X]}e.getValue=v;function h(W,X){return W[0]=X[0],W[1]=X[1],W[2]=X[2],W[3]=X[3],W[4]=X[4],W[5]=X[5],W[6]=X[6],W[7]=X[7],W[8]=X[8],W}e.copy=h;function m(W,X){if(W===X){var U=X[1],z=X[2],J=X[5];W[1]=X[3],W[2]=X[6],W[3]=U,W[5]=X[7],W[6]=z,W[7]=J}else W[0]=X[0],W[1]=X[3],W[2]=X[6],W[3]=X[1],W[4]=X[4],W[5]=X[7],W[6]=X[2],W[7]=X[5],W[8]=X[8];return W}e.transpose=m;function g(W,X){var U=X[0],z=X[1],J=X[2],K=X[3],Z=X[4],te=X[5],le=X[6],ye=X[7],be=X[8],Ae=be*Z-te*ye,Se=-be*K+te*le,ie=ye*K-Z*le,oe=U*Ae+z*Se+J*ie;return oe?(oe=1/oe,W[0]=Ae*oe,W[1]=(-be*z+J*ye)*oe,W[2]=(te*z-J*Z)*oe,W[3]=Se*oe,W[4]=(be*U-J*le)*oe,W[5]=(-te*U+J*K)*oe,W[6]=ie*oe,W[7]=(-ye*U+z*le)*oe,W[8]=(Z*U-z*K)*oe,W):(console.warn("non-invertible matrix.",X),W)}e.invert=g;function y(W,X){return W===X?(W[3]=X[1],W[6]=X[2],W[7]=X[5]):(W[0]=X[0],W[1]=X[1],W[2]=X[2],W[3]=X[1],W[4]=X[4],W[5]=X[5],W[6]=X[2],W[7]=X[5],W[8]=X[8]),W}e.symmtricFromUpper=y;function b(W,X){return W===X?(W[1]=X[3],W[2]=X[6],W[5]=X[7]):(W[0]=X[0],W[1]=X[3],W[2]=X[6],W[3]=X[3],W[4]=X[4],W[5]=X[7],W[6]=X[6],W[7]=X[7],W[8]=X[8]),W}e.symmtricFromLower=b;function S(W){var X=W[0],U=W[1],z=W[2],J=W[3],K=W[4],Z=W[5],te=W[6],le=W[7],ye=W[8],be=ye*K-Z*le,Ae=-ye*J+Z*te,Se=le*J-K*te;return X*be+U*Ae+z*Se}e.determinant=S;function x(W){return W[0]+W[4]+W[8]}e.trace=x;function C(W,X,U){return W[0]=X[0]-U[0],W[1]=X[1]-U[1],W[2]=X[2]-U[2],W[3]=X[3]-U[3],W[4]=X[4]-U[4],W[5]=X[5]-U[5],W[6]=X[6]-U[6],W[7]=X[7]-U[7],W[8]=X[8]-U[8],W}e.sub=C;function w(W,X,U){return W[0]=X[0]+U[0],W[1]=X[1]+U[1],W[2]=X[2]+U[2],W[3]=X[3]+U[3],W[4]=X[4]+U[4],W[5]=X[5]+U[5],W[6]=X[6]+U[6],W[7]=X[7]+U[7],W[8]=X[8]+U[8],W}e.add=w;function A(W,X,U){var z=X[0],J=X[1],K=X[2],Z=X[3],te=X[4],le=X[5],ye=X[6],be=X[7],Ae=X[8],Se=U[0],ie=U[1],oe=U[2],L=U[3],V=U[4],he=U[5],we=U[6],Te=U[7],ze=U[8];return W[0]=Se*z+ie*Z+oe*ye,W[1]=Se*J+ie*te+oe*be,W[2]=Se*K+ie*le+oe*Ae,W[3]=L*z+V*Z+he*ye,W[4]=L*J+V*te+he*be,W[5]=L*K+V*le+he*Ae,W[6]=we*z+Te*Z+ze*ye,W[7]=we*J+Te*te+ze*be,W[8]=we*K+Te*le+ze*Ae,W}e.mul=A;function M(W,X,U){return W[0]=X[0]-U,W[1]=X[1]-U,W[2]=X[2]-U,W[3]=X[3]-U,W[4]=X[4]-U,W[5]=X[5]-U,W[6]=X[6]-U,W[7]=X[7]-U,W[8]=X[8]-U,W}e.subScalar=M;function D(W,X,U){return W[0]=X[0]+U,W[1]=X[1]+U,W[2]=X[2]+U,W[3]=X[3]+U,W[4]=X[4]+U,W[5]=X[5]+U,W[6]=X[6]+U,W[7]=X[7]+U,W[8]=X[8]+U,W}e.addScalar=D;function k(W,X,U){return W[0]=X[0]*U,W[1]=X[1]*U,W[2]=X[2]*U,W[3]=X[3]*U,W[4]=X[4]*U,W[5]=X[5]*U,W[6]=X[6]*U,W[7]=X[7]*U,W[8]=X[8]*U,W}e.mulScalar=k;var R=Math.PI/3,O=t();function H(W,X){var U=X[1]*X[1]+X[2]*X[2]+X[5]*X[5];if(U===0)W[0]=X[0],W[1]=X[4],W[2]=X[8];else{var z=x(X)/3,J=X[0]-z,K=X[4]-z,Z=X[8]-z,te=J*J+K*K+Z*Z+2*U,le=Math.sqrt(te/6);k(O,e.Identity,z),C(O,X,O),k(O,O,1/le);var ye=S(O)/2,be=ye<=-1?R:ye>=1?0:Math.acos(ye)/3;W[0]=z+2*le*Math.cos(be),W[2]=z+2*le*Math.cos(be+2*R),W[1]=3*z-W[0]-W[2]}return W}e.symmetricEigenvalues=H;var B=[.1,0,0],j=[.1,0,0],Y=[.1,0,0],G=[.1,0,0],$=[.1,0,0],q=[.1,0,0];function ee(W,X,U){_.set(B,X[0]-U,X[1],X[2]),_.set(j,X[1],X[4]-U,X[5]),_.set(Y,X[2],X[5],X[8]-U),_.cross(G,B,j),_.cross($,B,Y),_.cross(q,j,Y);var z=_.dot(G,G),J=_.dot($,$),K=_.dot(q,q),Z=z,te=0;return J>Z&&(Z=J,te=1),K>Z&&(te=2),te===0?_.scale(W,G,1/Math.sqrt(z)):te===1?_.scale(W,$,1/Math.sqrt(J)):_.scale(W,q,1/Math.sqrt(K)),W}e.eigenvector=ee;function fe(W,X){return o(W,X),g(W,W),m(W,W),W}e.directionTransform=fe,e.Identity=r()})($n||($n={}));function He(){return He.zero()}(function(e){function t(){var A=[.1,0];return A[0]=0,A}e.zero=t;function r(A){var M=t();return M[0]=A[0],M[1]=A[1],M}e.clone=r;function n(A,M){var D=t();return D[0]=A,D[1]=M,D}e.create=n;function i(A){return isNaN(A[0])||isNaN(A[1])}e.hasNaN=i;function a(A,M,D){return M[D+0]=A[0],M[D+1]=A[1],M}e.toArray=a;function o(A,M,D){return A[0]=M[D+0],A[1]=M[D+1],A}e.fromArray=o;function s(A,M){return A[0]=M[0],A[1]=M[1],A}e.copy=s;function u(A,M,D){return A[0]=M,A[1]=D,A}e.set=u;function l(A,M,D){return A[0]=M[0]+D[0],A[1]=M[1]+D[1],A}e.add=l;function c(A,M,D){return A[0]=M[0]-D[0],A[1]=M[1]-D[1],A}e.sub=c;function d(A,M,D){return A[0]=M[0]*D[0],A[1]=M[1]*D[1],A}e.mul=d;function f(A,M,D){return A[0]=M[0]/D[0],A[1]=M[1]/D[1],A}e.div=f;function p(A,M,D){return A[0]=M[0]*D,A[1]=M[1]*D,A}e.scale=p;function v(A,M){return A[0]=Math.round(M[0]),A[1]=Math.round(M[1]),A}e.round=v;function h(A,M){return A[0]=Math.ceil(M[0]),A[1]=Math.ceil(M[1]),A}e.ceil=h;function m(A,M){return A[0]=Math.floor(M[0]),A[1]=Math.floor(M[1]),A}e.floor=m;function g(A,M){var D=M[0]-A[0],k=M[1]-A[1];return Math.sqrt(D*D+k*k)}e.distance=g;function y(A,M){var D=M[0]-A[0],k=M[1]-A[1];return D*D+k*k}e.squaredDistance=y;function b(A){var M=A[0],D=A[1];return Math.sqrt(M*M+D*D)}e.magnitude=b;function S(A){var M=A[0],D=A[1];return M*M+D*D}e.squaredMagnitude=S;function x(A,M){return A[0]=1/M[0],A[1]=1/M[1],A}e.inverse=x;function C(A,M){return A[0]===M[0]&&A[1]===M[1]}e.areEqual=C;function w(A,M){return"["+A[0].toPrecision(M)+" "+A[1].toPrecision(M)+"}]"}e.toString=w})(He||(He={}));function Ar(){return Ar.zero()}(function(e){function t(){var R=[.1,0,0,0];return R[0]=0,R}e.zero=t;function r(R){var O=t();return O[0]=R[0],O[1]=R[1],O[2]=R[2],O[3]=R[3],O}e.clone=r;function n(R,O,H,B){var j=t();return j[0]=R,j[1]=O,j[2]=H,j[3]=B,j}e.create=n;function i(R,O){return R[0]=O.center[0],R[1]=O.center[1],R[2]=O.center[2],R[3]=O.radius,R}e.fromSphere=i;function a(R){return i(t(),R)}e.ofSphere=a;function o(R){return isNaN(R[0])||isNaN(R[1])||isNaN(R[2])||isNaN(R[3])}e.hasNaN=o;function s(R,O,H){return O[H+0]=R[0],O[H+1]=R[1],O[H+2]=R[2],O[H+3]=R[3],O}e.toArray=s;function u(R,O,H){return R[0]=O[H+0],R[1]=O[H+1],R[2]=O[H+2],R[3]=O[H+3],R}e.fromArray=u;function l(R,O,H){O[H+0]=R[0],O[H+1]=R[1],O[H+2]=R[2]}e.toVec3Array=l;function c(R,O,H){return R[0]=O[H+0],R[1]=O[H+1],R[2]=O[H+2],R[3]=0,R}e.fromVec3Array=c;function d(R,O){return R[0]=O[0],R[1]=O[1],R[2]=O[2],R[3]=O[3],R}e.copy=d;function f(R,O,H,B,j){return R[0]=O,R[1]=H,R[2]=B,R[3]=j,R}e.set=f;function p(R,O,H){return R[0]=O[0]+H[0],R[1]=O[1]+H[1],R[2]=O[2]+H[2],R[3]=O[3]+H[3],R}e.add=p;function v(R,O){var H=O[0]-R[0],B=O[1]-R[1],j=O[2]-R[2],Y=O[3]-R[3];return Math.sqrt(H*H+B*B+j*j+Y*Y)}e.distance=v;function h(R,O,H){return R[0]=O[0]*H,R[1]=O[1]*H,R[2]=O[2]*H,R[4]=O[4]*H,R}e.scale=h;function m(R,O){return R[0]=Math.round(O[0]),R[1]=Math.round(O[1]),R[2]=Math.round(O[2]),R[3]=Math.round(O[3]),R}e.round=m;function g(R,O){return R[0]=Math.ceil(O[0]),R[1]=Math.ceil(O[1]),R[2]=Math.ceil(O[2]),R[3]=Math.ceil(O[3]),R}e.ceil=g;function y(R,O){return R[0]=Math.floor(O[0]),R[1]=Math.floor(O[1]),R[2]=Math.floor(O[2]),R[3]=Math.floor(O[3]),R}e.floor=y;function b(R,O){var H=O[0]-R[0],B=O[1]-R[1],j=O[2]-R[2],Y=O[3]-R[3];return H*H+B*B+j*j+Y*Y}e.squaredDistance=b;function S(R){var O=R[0],H=R[1],B=R[2],j=R[3];return Math.sqrt(O*O+H*H+B*B+j*j)}e.norm=S;function x(R){var O=R[0],H=R[1],B=R[2],j=R[3];return O*O+H*H+B*B+j*j}e.squaredNorm=x;function C(R,O,H){var B=O[0],j=O[1],Y=O[2],G=O[3];return R[0]=H[0]*B+H[4]*j+H[8]*Y+H[12]*G,R[1]=H[1]*B+H[5]*j+H[9]*Y+H[13]*G,R[2]=H[2]*B+H[6]*j+H[10]*Y+H[14]*G,R[3]=H[3]*B+H[7]*j+H[11]*Y+H[15]*G,R}e.transformMat4=C;function w(R,O){return R[0]*O[0]+R[1]*O[1]+R[2]*O[2]+R[3]*O[3]}e.dot=w;function A(R,O){return R[0]=1/O[0],R[1]=1/O[1],R[2]=1/O[2],R[3]=1/O[3],R}e.inverse=A;function M(R,O){return R[0]===O[0]&&R[1]===O[1]&&R[2]===O[2]&&R[3]===O[3]}e.exactEquals=M;function D(R,O){var H=R[0],B=R[1],j=R[2],Y=R[3],G=O[0],$=O[1],q=O[2],ee=O[3];return Math.abs(H-G)<=xn*Math.max(1,Math.abs(H),Math.abs(G))&&Math.abs(B-$)<=xn*Math.max(1,Math.abs(B),Math.abs($))&&Math.abs(j-q)<=xn*Math.max(1,Math.abs(j),Math.abs(q))&&Math.abs(Y-ee)<=xn*Math.max(1,Math.abs(Y),Math.abs(ee))}e.equals=D;function k(R,O){return"["+R[0].toPrecision(O)+" "+R[1].toPrecision(O)+" "+R[2].toPrecision(O)+"  "+R[3].toPrecision(O)+"]"}e.toString=k})(Ar||(Ar={}));function qn(){return qn.zero()}(function(e){function t(){var q=[.1,0,0,0];return q[0]=0,q}e.zero=t;function r(){var q=t();return q[3]=1,q}e.identity=r;function n(q){q[0]=0,q[1]=0,q[2]=0,q[3]=1}e.setIdentity=n;function i(q){return isNaN(q[0])||isNaN(q[1])||isNaN(q[2])||isNaN(q[3])}e.hasNaN=i;function a(q,ee,fe,W){var X=r();return X[0]=q,X[1]=ee,X[2]=fe,X[3]=W,X}e.create=a;function o(q,ee,fe){fe=fe*.5;var W=Math.sin(fe);return q[0]=W*ee[0],q[1]=W*ee[1],q[2]=W*ee[2],q[3]=Math.cos(fe),q}e.setAxisAngle=o;function s(q,ee){var fe=Math.acos(ee[3])*2,W=Math.sin(fe/2);return W!==0?(q[0]=ee[0]/W,q[1]=ee[1]/W,q[2]=ee[2]/W):(q[0]=1,q[1]=0,q[2]=0),fe}e.getAxisAngle=s;function u(q,ee,fe){var W=ee[0],X=ee[1],U=ee[2],z=ee[3],J=fe[0],K=fe[1],Z=fe[2],te=fe[3];return q[0]=W*te+z*J+X*Z-U*K,q[1]=X*te+z*K+U*J-W*Z,q[2]=U*te+z*Z+W*K-X*J,q[3]=z*te-W*J-X*K-U*Z,q}e.multiply=u;function l(q,ee,fe){fe*=.5;var W=ee[0],X=ee[1],U=ee[2],z=ee[3],J=Math.sin(fe),K=Math.cos(fe);return q[0]=W*K+z*J,q[1]=X*K+U*J,q[2]=U*K-X*J,q[3]=z*K-W*J,q}e.rotateX=l;function c(q,ee,fe){fe*=.5;var W=ee[0],X=ee[1],U=ee[2],z=ee[3],J=Math.sin(fe),K=Math.cos(fe);return q[0]=W*K-U*J,q[1]=X*K+z*J,q[2]=U*K+W*J,q[3]=z*K-X*J,q}e.rotateY=c;function d(q,ee,fe){fe*=.5;var W=ee[0],X=ee[1],U=ee[2],z=ee[3],J=Math.sin(fe),K=Math.cos(fe);return q[0]=W*K+X*J,q[1]=X*K-W*J,q[2]=U*K+z*J,q[3]=z*K-U*J,q}e.rotateZ=d;function f(q,ee){var fe=ee[0],W=ee[1],X=ee[2];return q[0]=fe,q[1]=W,q[2]=X,q[3]=Math.sqrt(Math.abs(1-fe*fe-W*W-X*X)),q}e.calculateW=f;function p(q,ee,fe,W){var X=ee[0],U=ee[1],z=ee[2],J=ee[3],K=fe[0],Z=fe[1],te=fe[2],le=fe[3],ye,be,Ae,Se,ie;return be=X*K+U*Z+z*te+J*le,be<0&&(be=-be,K=-K,Z=-Z,te=-te,le=-le),1-be>1e-6?(ye=Math.acos(be),Ae=Math.sin(ye),Se=Math.sin((1-W)*ye)/Ae,ie=Math.sin(W*ye)/Ae):(Se=1-W,ie=W),q[0]=Se*X+ie*K,q[1]=Se*U+ie*Z,q[2]=Se*z+ie*te,q[3]=Se*J+ie*le,q}e.slerp=p;function v(q,ee){var fe=ee[0],W=ee[1],X=ee[2],U=ee[3],z=fe*fe+W*W+X*X+U*U,J=z?1/z:0;return q[0]=-fe*J,q[1]=-W*J,q[2]=-X*J,q[3]=U*J,q}e.invert=v;function h(q,ee){return q[0]=-ee[0],q[1]=-ee[1],q[2]=-ee[2],q[3]=ee[3],q}e.conjugate=h;function m(q,ee){var fe=ee[0]+ee[4]+ee[8],W;if(fe>0)W=Math.sqrt(fe+1),q[3]=.5*W,W=.5/W,q[0]=(ee[5]-ee[7])*W,q[1]=(ee[6]-ee[2])*W,q[2]=(ee[1]-ee[3])*W;else{var X=0;ee[4]>ee[0]&&(X=1),ee[8]>ee[X*3+X]&&(X=2);var U=(X+1)%3,z=(X+2)%3;W=Math.sqrt(ee[X*3+X]-ee[U*3+U]-ee[z*3+z]+1),q[X]=.5*W,W=.5/W,q[3]=(ee[U*3+z]-ee[z*3+U])*W,q[U]=(ee[U*3+X]+ee[X*3+U])*W,q[z]=(ee[z*3+X]+ee[X*3+z])*W}return q}e.fromMat3=m;var g=[0,0,0];function y(q,ee,fe){var W=_.dot(ee,fe)+1;return W<xn?(W=0,Math.abs(ee[0])>Math.abs(ee[2])?_.set(g,-ee[1],ee[0],0):_.set(g,0,-ee[2],ee[1])):_.cross(g,ee,fe),q[0]=g[0],q[1]=g[1],q[2]=g[2],q[3]=W,M(q,q),q}e.fromUnitVec3=y;function b(q){var ee=t();return ee[0]=q[0],ee[1]=q[1],ee[2]=q[2],ee[3]=q[3],ee}e.clone=b;function S(q,ee,fe){return ee[fe+0]=q[0],ee[fe+1]=q[1],ee[fe+2]=q[2],ee[fe+3]=q[3],ee}e.toArray=S;function x(q,ee,fe){return q[0]=ee[fe+0],q[1]=ee[fe+1],q[2]=ee[fe+2],q[3]=ee[fe+3],q}e.fromArray=x;function C(q,ee){return q[0]=ee[0],q[1]=ee[1],q[2]=ee[2],q[3]=ee[3],q}e.copy=C;function w(q,ee,fe,W,X){return q[0]=ee,q[1]=fe,q[2]=W,q[3]=X,q}e.set=w;function A(q,ee,fe){return q[0]=ee[0]+fe[0],q[1]=ee[1]+fe[1],q[2]=ee[2]+fe[2],q[3]=ee[3]+fe[3],q}e.add=A;function M(q,ee){var fe=ee[0],W=ee[1],X=ee[2],U=ee[3],z=fe*fe+W*W+X*X+U*U;return z>0&&(z=1/Math.sqrt(z),q[0]=fe*z,q[1]=W*z,q[2]=X*z,q[3]=U*z),q}e.normalize=M;var D=[0,0,0],k=[1,0,0],R=[0,1,0];function O(q,ee,fe){var W=_.dot(ee,fe);return W<-.999999?(_.cross(D,k,ee),_.magnitude(D)<1e-6&&_.cross(D,R,ee),_.normalize(D,D),o(q,D,Math.PI),q):W>.999999?(q[0]=0,q[1]=0,q[2]=0,q[3]=1,q):(_.cross(D,ee,fe),q[0]=D[0],q[1]=D[1],q[2]=D[2],q[3]=1+W,M(q,q))}e.rotationTo=O;var H=t(),B=t();function j(q,ee,fe,W,X,U){return p(H,ee,X,U),p(B,fe,W,U),p(q,H,B,2*U*(1-U)),q}e.sqlerp=j;var Y=[0,0,0,0,0,0,0,0,0];function G(q,ee,fe,W){return Y[0]=fe[0],Y[3]=fe[1],Y[6]=fe[2],Y[1]=W[0],Y[4]=W[1],Y[7]=W[2],Y[2]=-ee[0],Y[5]=-ee[1],Y[8]=-ee[2],M(q,m(q,Y))}e.setAxes=G;function $(q,ee){return"["+q[0].toPrecision(ee)+" "+q[1].toPrecision(ee)+" "+q[2].toPrecision(ee)+"  "+q[3].toPrecision(ee)+"]"}e.toString=$,e.Identity=r()})(qn||(qn={}));var Mr;(function(e){function t(x,C,w){for(var A=[],M=0;M<C.length;M++)A[M]=C[C.length-M-1];for(var D=[1],M=1;M<x.length;M++)D[M]=x[A[M-1]];return{dimensions:x,axisOrderFastToSlow:A,axisOrderSlowToFast:C,accessDimensions:D,defaultCtor:w||Float64Array}}function r(x,C){return{space:x,data:C}}e.create=r;function n(x,C,w){var A=t(x,C,w),M=p(A),D=M.get,k=M.set,R=M.add,O=M.dataOffset,H=M.getCoords;return{rank:x.length,dimensions:x,axisOrderSlowToFast:C,create:v(A),get:D,set:k,add:R,dataOffset:O,getCoords:H}}e.Space=n;function i(x){return x}e.Data1=i;function a(x,C){return n([x],[0],C)}e.Vector=a;function o(x,C,w){return n([x,C],[1,0],w)}e.ColumnMajorMatrix=o;function s(x,C,w){return n([x,C],[0,1],w)}e.RowMajorMatrix=s;function u(x,C,w){if(C.rank!==2)throw new Error("Invalid tensor rank");for(var A=Math.min(4,C.dimensions[0]),M=Math.min(4,C.dimensions[1]),D=0;D<A;D++)for(var k=0;k<M;k++)ue.setValue(x,D,k,C.get(w,D,k));return x}e.toMat4=u;function l(x,C,w){if(C.rank!==2)throw new Error("Invalid tensor rank");for(var A=Math.min(3,C.dimensions[0]),M=Math.min(3,C.dimensions[1]),D=0;D<A;D++)for(var k=0;k<M;k++)$n.setValue(x,D,k,C.get(w,D,k));return x}e.toMat3=l;function c(x,C,w){if(C.rank!==1)throw new Error("Invalid tensor rank");for(var A=Math.min(3,C.dimensions[0]),M=0;M<A;M++)x[M]=w[M];return x}e.toVec3=c;function d(x,C,w){if(C.rank!==1)throw new Error("Invalid tensor rank");for(var A=Math.min(4,C.dimensions[0]),M=0;M<A;M++)x[M]=w[M];return x}e.toVec4=d;function f(x,C){var w=x.length;if(w!==C.length)return!1;for(var A=0;A<w;A++)if(x[A]!==C[A])return!1;return!0}e.areEqualExact=f;function p(x){var C=x.dimensions,w=x.axisOrderFastToSlow;switch(C.length){case 1:return{get:function(K,Z){return K[Z]},set:function(K,Z,te){return K[Z]=te},add:function(K,Z,te){return K[Z]+=te},dataOffset:function(K){return K},getCoords:function(K,Z){return Z[0]=K,Z}};case 2:{if(w[0]===0&&w[1]===1){var A=C[0];return{get:function(K,Z,te){return K[te*A+Z]},set:function(K,Z,te,le){return K[te*A+Z]=le},add:function(K,Z,te,le){return K[te*A+Z]+=le},dataOffset:function(K,Z){return Z*A+K},getCoords:function(K,Z){return Z[0]=K%A,Z[1]=Math.floor(K/A),Z}}}if(w[0]===1&&w[1]===0){var M=C[1];return{get:function(K,Z,te){return K[Z*M+te]},set:function(K,Z,te,le){return K[Z*M+te]=le},add:function(K,Z,te,le){return K[Z*M+te]+=le},dataOffset:function(K,Z){return K*M+Z},getCoords:function(K,Z){return Z[0]=Math.floor(K/M),Z[1]=K%M,Z}}}throw new Error("bad axis order")}case 3:{if(w[0]===0&&w[1]===1&&w[2]===2){var D=C[0],k=C[1],R=D*k;return{get:function(K,Z,te,le){return K[Z+te*D+le*R]},set:function(K,Z,te,le,ye){return K[Z+te*D+le*R]=ye},add:function(K,Z,te,le,ye){return K[Z+te*D+le*R]+=ye},dataOffset:function(K,Z,te){return K+Z*D+te*R},getCoords:function(K,Z){var te=Math.floor(K/D);return Z[0]=K%D,Z[1]=te%k,Z[2]=Math.floor(te/k),Z}}}if(w[0]===0&&w[1]===2&&w[2]===1){var O=C[0],H=C[2],B=O*H;return{get:function(K,Z,te,le){return K[Z+le*O+te*B]},set:function(K,Z,te,le,ye){return K[Z+le*O+te*B]=ye},add:function(K,Z,te,le,ye){return K[Z+le*O+te*B]+=ye},dataOffset:function(K,Z,te){return K+te*O+Z*B},getCoords:function(K,Z){var te=Math.floor(K/O);return Z[0]=K%O,Z[1]=Math.floor(te/H),Z[2]=te%H,Z}}}if(w[0]===1&&w[1]===0&&w[2]===2){var j=C[1],Y=C[0],G=j*Y;return{get:function(K,Z,te,le){return K[te+Z*j+le*G]},set:function(K,Z,te,le,ye){return K[te+Z*j+le*G]=ye},add:function(K,Z,te,le,ye){return K[te+Z*j+le*G]+=ye},dataOffset:function(K,Z,te){return Z+K*j+te*G},getCoords:function(K,Z){var te=Math.floor(K/j);return Z[0]=te%Y,Z[1]=K%j,Z[2]=Math.floor(te/Y),Z}}}if(w[0]===1&&w[1]===2&&w[2]===0){var $=C[1],q=C[2],ee=$*q;return{get:function(K,Z,te,le){return K[te+le*$+Z*ee]},set:function(K,Z,te,le,ye){return K[te+le*$+Z*ee]=ye},add:function(K,Z,te,le,ye){return K[te+le*$+Z*ee]+=ye},dataOffset:function(K,Z,te){return Z+te*$+K*ee},getCoords:function(K,Z){var te=Math.floor(K/$);return Z[0]=Math.floor(te/q),Z[1]=K%$,Z[2]=te%q,Z}}}if(w[0]===2&&w[1]===0&&w[2]===1){var fe=C[2],W=C[0],X=fe*W;return{get:function(K,Z,te,le){return K[le+Z*fe+te*X]},set:function(K,Z,te,le,ye){return K[le+Z*fe+te*X]=ye},add:function(K,Z,te,le,ye){return K[le+Z*fe+te*X]+=ye},dataOffset:function(K,Z,te){return te+K*fe+Z*X},getCoords:function(K,Z){var te=Math.floor(K/fe);return Z[0]=te%W,Z[1]=Math.floor(te/W),Z[2]=K%fe,Z}}}if(w[0]===2&&w[1]===1&&w[2]===0){var U=C[2],z=C[1],J=U*z;return{get:function(K,Z,te,le){return K[le+te*U+Z*J]},set:function(K,Z,te,le,ye){return K[le+te*U+Z*J]=ye},add:function(K,Z,te,le,ye){return K[le+te*U+Z*J]+=ye},dataOffset:function(K,Z,te){return te+Z*U+K*J},getCoords:function(K,Z){var te=Math.floor(K/U);return Z[0]=Math.floor(te/z),Z[1]=te%z,Z[2]=K%U,Z}}}throw new Error("bad axis order")}default:return{get:function(K){for(var Z=[],te=1;te<arguments.length;te++)Z[te-1]=arguments[te];return K[h(x,Z)]},set:function(K){for(var Z=[],te=1;te<arguments.length;te++)Z[te-1]=arguments[te];return K[h(x,Z)]=Z[Z.length-1]},add:function(K){for(var Z=[],te=1;te<arguments.length;te++)Z[te-1]=arguments[te];return K[h(x,Z)]+=Z[Z.length-1]},dataOffset:function(){for(var K=[],Z=0;Z<arguments.length;Z++)K[Z]=arguments[Z];return h(x,K)},getCoords:function(K,Z){return m(x,K,Z)}}}}function v(x){for(var C=x.dimensions,w=1,A=0,M=C.length;A<M;A++)w*=C[A];return function(D){return new(D||x.defaultCtor)(w)}}function h(x,C){for(var w=x.accessDimensions,A=x.axisOrderFastToSlow,M=w.length-1,D=w[M]*C[A[M]],k=M-1;k>=0;k--)D=(D+C[A[k]])*w[k];return D}function m(x,C,w){for(var A=x.dimensions,M=x.axisOrderFastToSlow,D=A.length,k=C,R=0;R<D;R++){var O=A[M[R]];w[M[R]]=k%O,k=Math.floor(k/O)}return w[M[D+1]]=k,w}function g(x){for(var C=[],w=0;w<x.length;w++)C[w]=x[x.length-w-1];return C}e.invertAxisOrder=g;function y(x,C){for(var w=[],A=0;A<x.length;A++)w[A]=x[C[A]];return w}function b(x){for(var C=new Int32Array(x.length),w=0;w<x.length;w++)C[x[w]]=w;return function(A){return y(A,C)}}e.convertToCanonicalAxisIndicesFastToSlow=b;function S(x){for(var C=new Int32Array(x.length),w=0;w<x.length;w++)C[x[x.length-w-1]]=w;return function(A){return y(A,C)}}e.convertToCanonicalAxisIndicesSlowToFast=S})(Mr||(Mr={}));function ch(e,t,r){for(;t<r&&e.charCodeAt(t)===32;)t++;return Zf(e,t,r)}function Zf(e,t,r){var n=t,i=0,a=1;for(e.charCodeAt(n)===45?(a=-1,++n):e.charCodeAt(n)===43&&++n;n<r;n++){var o=e.charCodeAt(n)-48;if(o>9||o<0)return a*i|0;i=10*i+o|0}return a*i}function T9(e,t,r,n){return t.charCodeAt(r)===43&&r++,e*Math.pow(10,Zf(t,r,n))}function K4e(e,t,r){for(;t<r&&e.charCodeAt(t)===32;)t++;return Lc(e,t,r)}function Lc(e,t,r){var n=t,i=1,a=0,o=0,s=1;for(e.charCodeAt(n)===45?(i=-1,++n):e.charCodeAt(n)===43&&++n;n<r;){var u=e.charCodeAt(n)-48;if(u>=0&&u<10)a=a*10+u,++n;else if(u===-2){for(++n;n<r;)if(u=e.charCodeAt(n)-48,u>=0&&u<10)o=10*o+u,s=10*s,++n;else return u===53||u===21?T9(i*(a+o/s),e,n+1,r):i*(a+o/s);return i*(a+o/s)}else{if(u===53||u===21)return T9(i*a,e,n+1,r);break}}return i*a}var ve;(function(e){var t;(function(D){D.str={"@type":"str",T:"",valueType:"str"},D.int={"@type":"int",T:0,valueType:"int"},D.coord={"@type":"coord",T:0,valueType:"float"},D.float={"@type":"float",T:0,valueType:"float"};function k($){return $===void 0&&($=""),{"@type":"str",T:$,valueType:"str"}}D.Str=k;function R($){return $===void 0&&($=0),{"@type":"int",T:$,valueType:"int"}}D.Int=R;function O($){return $===void 0&&($=0),{"@type":"float",T:$,valueType:"float"}}D.Float=O;function H($,q){return q===void 0&&(q=D.float),{"@type":"tensor",T:$.create(),space:$,valueType:"tensor",baseType:q}}D.Tensor=H;function B($,q){return q===void 0&&(q=D.float),H(Mr.Vector($,q["@type"]==="int"?Int32Array:Float64Array),q)}D.Vector=B;function j($,q,ee){return ee===void 0&&(ee=D.float),H(Mr.ColumnMajorMatrix($,q,ee["@type"]==="int"?Int32Array:Float64Array),ee)}D.Matrix=j;function Y($,q){return typeof q<"u"?E(E({},$),{T:q}):$}D.Aliased=Y;function G($,q,ee){return ee===void 0&&(ee=[]),{"@type":"list",T:ee,separator:$,itemParse:q,valueType:"list"}}D.List=G})(t=e.Schema||(e.Schema={}));function r(D){return!!D&&!!D.schema&&!!D.value}e.is=r;function n(D,k){return I9(k.T,D,k,1)}e.Undefined=n;function i(D,k,R){return I9(D,k,R,0)}e.ofConst=i;function a(D){return gx(D)}e.ofLambda=a;function o(D,k){return a({value:function(R){return R+D},rowCount:Math.max(k-D+1,0),schema:t.int})}e.range=o;function s(D){return fc(D)}e.ofArray=s;function u(D){return fc({array:D,schema:t.int})}e.ofIntArray=u;function l(D){return fc({array:D,schema:t.float})}e.ofFloatArray=l;function c(D){return fc({array:D,schema:t.str})}e.ofStringArray=c;function d(D){return fc({array:D,schema:t.Aliased(t.str)})}e.ofStringAliasArray=d;function f(D,k){return k===void 0&&(k=","),fc({array:D,schema:t.List(k,function(R){return R})})}e.ofStringListArray=f;function p(D){var k=D.count,R=D.data,O=D.indices;return gx({value:function(H){return Zf(R,O[2*H],O[2*H+1])||0},rowCount:k,schema:t.int})}e.ofIntTokens=p;function v(D){var k=D.count,R=D.data,O=D.indices;return gx({value:function(H){return Lc(R,O[2*H],O[2*H+1])||0},rowCount:k,schema:t.float})}e.ofFloatTokens=v;function h(D){var k=D.count,R=D.data,O=D.indices;return gx({value:function(H){var B=R.substring(O[2*H],O[2*H+1]);return B==="."||B==="?"?"":B},rowCount:k,schema:t.str})}e.ofStringTokens=h;function m(D,k,R){return J4e(D,k,R)}e.window=m;function g(D,k,R){return R===void 0&&(R=!0),nTe(D,k,R)}e.view=g;function y(D){return Q4e(D)}e.createFirstIndexMap=y;function b(D){return Z4e(D)}e.createIndexer=b;function S(D,k,R){return oTe(D,k,R||Array)}e.mapToArray=S;function x(D,k){return sTe(D,k)}e.areEqual=x;function C(D,k){return cTe(D,k)}e.indicesOf=C;function w(D,k){return D.__array?D:D.isDefined?fc({array:D.toArray({array:k}),schema:D.schema,valueKind:D.valueKind}):n(D.rowCount,D.schema)}e.asArrayColumn=w;function A(D,k,R){if(R===void 0&&(R=0),!!D.isDefined){var O=D.__array;if(O)for(var H=0,B=O.length;H<B;H++)k[R+H]=O[H];else for(var H=0,B=D.rowCount;H<B;H++)k[R+H]=D.value(H)}}e.copyToArray=A;function M(D){for(var k=0,R=D.rowCount;k<R;k++)if(k!==D.value(k))return!1;return!0}e.isIdentity=M})(ve||(ve={}));function Q4e(e){for(var t=new Map,r=0,n=e.rowCount;r<n;r++){var i=e.value(r);t.has(i)||t.set(e.value(r),r)}return t}function Z4e(e){for(var t=new Map,r=0,n=e.rowCount;r<n;r++){var i=e.value(r);t.has(i)||t.set(e.value(r),r)}return function(a){return t.has(a)?t.get(a):-1}}function I9(e,t,r,n){var i=function(a){return e};return{schema:r,__array:void 0,isDefined:n===0,rowCount:t,value:i,valueKind:function(a){return n},toArray:function(a){for(var o=r2(t,a).array,s=0,u=o.length;s<u;s++)o[s]=e;return o},areValuesEqual:function(a,o){return!0}}}function gx(e){var t=e.value,r=e.valueKind,n=e.areValuesEqual,i=e.rowCount,a=e.schema;return{schema:a,__array:void 0,isDefined:!0,rowCount:i,value:t,valueKind:r||function(o){return 0},toArray:function(o){for(var s=r2(i,o),u=s.array,l=s.start,c=0,d=u.length;c<d;c++)u[c]=t(c+l);return u},areValuesEqual:n||function(o,s){return t(o)===t(s)}}}function fc(e){var t=e.array,r=e.schema,n=e.valueKind,i=t.length,a=r.valueType==="str"?function(s){var u=t[s];return typeof u=="string"?u:""+u}:function(s){return t[s]},o=KO(t);return{schema:r,__array:t,isDefined:!0,rowCount:i,value:a,valueKind:n||function(s){return 0},toArray:r.valueType==="str"?function(s){for(var u=A_(i,s),l=u.start,c=u.end,d=new(s&&typeof s.array<"u"?s.array:t.constructor)(c-l),f=0,p=c-l;f<p;f++){var v=t[l+f];d[f]=typeof v=="string"?v:""+v}return d}:o?function(s){return P_(t,s)}:function(s){var u=A_(i,s),l=u.start,c=u.end;if(l===0&&c===t.length)return t;for(var d=new(s&&typeof s.array<"u"?s.array:t.constructor)(c-l),f=0,p=c-l;f<p;f++)d[f]=t[l+f];return d},areValuesEqual:function(s,u){return t[s]===t[u]}}}function J4e(e,t,r){return e.isDefined?t===0&&r===e.rowCount?e:e.__array&&KO(e.__array)?eTe(e,t,r):tTe(e,t,r):ve.Undefined(r-t,e.schema)}function eTe(e,t,r){var n=P_(e.__array,{start:t,end:r}),i=e.valueKind;return fc({array:n,schema:e.schema,valueKind:function(a){return i(t+a)}})}function tTe(e,t,r){var n=e.value,i=e.valueKind,a=e.areValuesEqual,o=t===0?n:function(u){return n(u+t)},s=r-t;return{schema:e.schema,__array:void 0,isDefined:e.isDefined,rowCount:s,value:o,valueKind:t===0?i:function(u){return i(u+t)},toArray:function(u){for(var l=r2(s,u).array,c=0,d=l.length;c<d;c++)l[c]=n(c+t);return l},areValuesEqual:t===0?a:function(u,l){return a(u+t,l+t)}}}function rTe(e,t){if(e.length!==t)return!1;for(var r=0,n=e.length;r<n;r++)if(e[r]!==r)return!1;return!0}function nTe(e,t,r){return e.rowCount===0||r&&rTe(t,e.rowCount)?e:e.__array&&typeof e.value(0)==typeof e.__array[0]?iTe(e,t):aTe(e,t)}function iTe(e,t){for(var r=e.__array,n=new r.constructor(t.length),i=0,a=t.length;i<a;i++)n[i]=r[t[i]];var o=e.valueKind;return fc({array:n,schema:e.schema,valueKind:function(s){return o(t[s])}})}function aTe(e,t){var r=e.value,n=e.valueKind,i=e.areValuesEqual,a=function(s){return r(t[s])},o=t.length;return{schema:e.schema,__array:void 0,isDefined:e.isDefined,rowCount:o,value:a,valueKind:function(s){return n(t[s])},toArray:function(s){for(var u=r2(o,s).array,l=0,c=u.length;l<c;l++)u[l]=r(t[l]);return u},areValuesEqual:function(s,u){return i(t[s],t[u])}}}function oTe(e,t,r){for(var n=new r(e.rowCount),i=0,a=e.rowCount;i<a;i++)n[i]=t(e.value(i));return n}function sTe(e,t){return e===t?!0:e.rowCount!==t.rowCount||e.isDefined!==t.isDefined||e.schema.valueType!==t.schema.valueType?!1:e.__array&&t.__array?uTe(e,t):lTe(e,t)}function uTe(e,t){for(var r=e.__array,n=t.__array,i=0,a=e.rowCount;i<a;i++)if(r[i]!==n[i])return!1;return!0}function lTe(e,t){for(var r=e.value,n=t.value,i=0,a=e.rowCount;i<a;i++)if(r(i)!==n(i))return!1;return!0}function cTe(e,t){for(var r=[],n=e.value,i=0,a=e.rowCount;i<a;i++)t(n(i))&&(r[r.length]=i);return r}var Qr;(function(e){function t(S){return S&&typeof S._rowCount=="number"&&!!S._columns&&!!S._schema}e.is=t;function r(S,x,C){C===void 0&&(C={});var w=Object.create(null),A=Object.keys(S);w._rowCount=x._rowCount,w._columns=A,w._schema=S;for(var M=0,D=A;M<D.length;M++){var k=D[M];if(x[k])w[k]=x[k];else if(C[k])w[k]=C[k];else throw Error("Cannot find column '"+k+"'.")}return w}e.pickColumns=r;function n(S,x){var C=Object.keys(x),w=x[C[0]].rowCount;return E({_rowCount:w,_columns:C,_schema:S},x)}e.ofColumns=n;function i(S,x,C){var w=Object.create(null),A=Object.keys(S);w._rowCount=C,w._columns=A,w._schema=S;for(var M=0,D=A;M<D.length;M++){var k=D[M];k in x?w[k]=x[k]:w[k]=ve.Undefined(C,S[k])}return w}e.ofPartialColumns=i;function a(S,x){var C=Object.create(null),w=Object.keys(S);C._rowCount=x,C._columns=w,C._schema=S;for(var A=0,M=w;A<M.length;A++){var D=M[A];C[D]=ve.Undefined(x,S[D])}return C}e.ofUndefinedColumns=a;function o(S,x){var C=Object.create(null),w=x.length,A=Object.keys(S);C._rowCount=w,C._columns=A,C._schema=S;for(var M=function(O){C[O]=ve.ofLambda({rowCount:w,schema:S[O],value:function(H){return x[H][O]},valueKind:function(H){return typeof x[H][O]>"u"?1:0}})},D=0,k=A;D<k.length;D++){var R=k[D];M(R)}return C}e.ofRows=o;function s(S,x){var C,w=Object.create(null),A=Object.keys(S);w._rowCount=0,w._columns=A,w._schema=S;for(var M=0,D=A;M<D.length;M++){var k=D[M];typeof x[k]<"u"?(w[k]=ve.ofArray({array:x[k],schema:S[k]}),w._rowCount=(C=x[k])===null||C===void 0?void 0:C.length):w[k]=ve.Undefined(w._rowCount,S[k])}return w}e.ofArrays=s;function u(S,x,C){var w=Object.create(null),A=Object.keys(x);w._rowCount=C.length,w._columns=A,w._schema=x;for(var M=0,D=A;M<D.length;M++){var k=D[M];w[k]=ve.view(S[k],C)}return w}e.view=u;function l(S,x,C){for(var w=[],A=0,M=S._rowCount;A<M;++A)C(A)&&w.push(A);return u(S,x,w)}e.pick=l;function c(S,x,C,w){if(C===0&&w===S._rowCount)return S;var A=Object.create(null),M=Object.keys(x);A._rowCount=w-C,A._columns=M,A._schema=x;for(var D=0,k=M;D<k.length;D++){var R=k[D];A[R]=ve.window(S[R],C,w)}return A}e.window=c;function d(S,x){var C=Object.create(null),w=Object.keys(x);C._rowCount=0;for(var A=0,M=S;A<M.length;A++){var D=M[A];C._rowCount+=D._rowCount}for(var k={},R=0,O=w;R<O.length;R++){var H=O[R];k[H]=new Array(C._rowCount)}C._columns=w,C._schema=x;for(var B=0,j=0,Y=S;j<Y.length;j++){for(var D=Y[j],G=0,$=w;G<$.length;G++){var q=$[G];ve.copyToArray(D[q],k[q],B)}B+=D._rowCount}for(var ee=0,fe=w;ee<fe.length;ee++){var q=fe[ee];C[q]=ve.ofArray({array:k[q],schema:x[q]})}return C}e.concat=d;function f(S,x,C){S[x]=ve.asArrayColumn(S[x],C)}e.columnToArray=f;function p(S,x){for(var C=new Int32Array(S._rowCount),w=0,A=C.length;w<A;w++)C[w]=w;Tu(C,function(H,B,j){return x(B,j)});for(var M=!0,w=0,A=C.length;w<A;w++)if(C[w]!==w){M=!1;break}if(M)return S;var D=Object.create(null);D._rowCount=S._rowCount,D._columns=S._columns,D._schema=S._schema;for(var k=0,R=S._columns;k<R.length;k++){var O=R[k];D[O]=ve.view(S[O],C,!1)}return D}e.sort=p;function v(S,x){if(S._rowCount!==x._rowCount||S._columns.length!==x._columns.length)return!1;for(var C=0,w=S._columns;C<w.length;C++){var A=w[C];if(!x[A])return!1}for(var M=0,D=S._columns;M<D.length;M++){var A=D[M];if(!ve.areEqual(S[A],x[A]))return!1}return!0}e.areEqual=v;function h(S,x){for(var C=Object.create(null),w=S._columns,A=0;A<w.length;A++){var M=w[A];C[M]=S[M].value(x)}return C}e.getRow=h;function m(S,x){for(var C=0,w=S._rowCount;C<w;++C)if(x(C))return h(S,C)}e.pickRow=m;function g(S){for(var x=[],C=S._rowCount,w=0;w<C;w++)x[w]=h(S,w);return x}e.getRows=g;function y(S){for(var x={},C=S._columns,w=0;w<C.length;w++){var A=C[w];x[A]=S[A].toArray()}return x}e.toArrays=y;function b(S){var x=Lr.create(),C=S._columns,w=S._rowCount,A=1;Lr.write(x,"|");for(var M=0;M<C.length;M++)Lr.write(x,C[M]),Lr.write(x,"|"),A+=C[M].length+1;Lr.newline(x),Lr.write(x,new Array(A+1).join("-")),Lr.newline(x);for(var D=0;D<w;D++){Lr.write(x,"|");for(var M=0;M<C.length;M++){var k=S[C[M]];k.valueKind(D)===0?(Lr.write(x,k.value(D)),Lr.write(x,"|")):Lr.write(x,".|")}Lr.newline(x)}return Lr.getString(x)}e.formatToString=b})(Qr||(Qr={}));var C5;(function(e){function t(n,i,a){var o=Object.keys(a),s=Object.create(null),u=[];s._name=n,s._tableNames=u,s._schema=i;for(var l=0,c=o;l<c.length;l++){var d=c[l];Qr.is(a[d])&&(s[d]=a[d],u[u.length]=d)}return s}e.ofTables=t;function r(n){for(var i={},a=0,o=n._tableNames;a<o.length;a++){var s=o[a];i[s]=Qr.getRows(n[s])}return i}e.getTablesAsRows=r})(C5||(C5={}));function QO(e,t){for(var r=0,n=e.length;r<n;r++)if(t(e[r]))return e[r]}function ZO(e){if(Array.from)return Array.from(e);for(var t=[];;){var r=e.next(),n=r.done,i=r.value;if(n)break;t[t.length]=i}return t}function _5(e,t,r){for(var n=t-e+1,i=r?new r(n):new Int32Array(n),a=0;a<n;a++)i[a]=a+e;return i}function dTe(e,t){for(var r=new(fTe(e))(t.length),n=0,i=t.length;n<i;n++)r[n]=e[t[n]];return r}function fTe(e){var t=e.constructor;if(!t)throw new Error("data does not define a constructor and it should");return t}var Si;(function(e){e.Zero=0;var t=function(){var h=new ArrayBuffer(8),m=new ArrayBuffer(8);return{_int32:new Int32Array(h),_float64:new Float64Array(h),_int32_1:new Int32Array(m),_float64_1:new Float64Array(m)}}(),r=t._int32,n=t._float64,i=t._int32_1,a=t._float64_1;function o(h){return typeof h=="number"}e.is=o;function s(h,m){return r[0]=h,r[1]=m,n[0]}e.create=s;function u(h){return n[0]=h,r[0]}e.fst=u;function l(h){return n[0]=h,r[1]}e.snd=l;function c(h,m){return n[0]=h,a[0]=m,r[0]===i[0]&&r[1]===i[1]}e.areEqual=c;function d(h,m){n[0]=h,a[0]=m;var g=r[0]-i[0];return g!==0?g:r[1]-i[1]}e.compare=d;function f(h,m,g){n[0]=h[m],a[0]=h[g];var y=r[0]-i[0];return y!==0?y:r[1]-i[1]}e.compareInArray=f;function p(h){return n[0]=h,Dv(r[0],r[1])}e.hashCode=p;function v(h){return n[0]=h,"("+r[0]+", "+r[1]+")"}e.toString=v})(Si||(Si={}));var $Q=Si.Zero;function M9(e,t){return t<e?Si.create(e,e):Si.create(e,t+1)}function JO(e,t){return t<=e?Si.create(e,e):Si.create(e,t)}function pTe(e){return e<0?Si.create(0,0):Si.create(0,e)}var hTe=Si.is,Yc=Si.fst,lp=Si.snd,T_=Si.fst;function I_(e){return Si.snd(e)-1}function Lh(e){return Si.snd(e)-Si.fst(e)}var vTe=Si.hashCode,mTe=Si.toString;function gTe(e,t){return Si.fst(e)<=t&&t<Si.snd(e)}function yTe(e,t){var r=Yc(e);return t>=r&&t<lp(e)?t-r:-1}function bTe(e,t){return Si.fst(e)+t}var xTe=Si.areEqual;function WQ(e,t){var r=Lh(e),n=Lh(t);return r===0&&n===0?!0:r>0&&n>0&&I_(e)>=T_(t)&&T_(e)<=I_(t)}function STe(e,t){return Lh(e)?Lh(t)?Yc(e)<=Yc(t)&&lp(e)>=lp(t):!0:Lh(t)===0}function w5(e,t){var r=Yc(e);if(t<=r)return 0;var n=lp(e);return t>=n?n-r:t-r}function CTe(e,t,r){var n=Yc(r),i=Yc(e);if(t<=n+i)return n;var a=lp(r);return t>=a+i?a:t-i}function XQ(e,t,r){return JO(w5(e,t),w5(e,r+1))}function _Te(e,t){return WQ(e,t)?JO(Math.max(Yc(e),Yc(t)),Math.min(lp(e),lp(t))):$Q}function wTe(e,t){return Lh(XQ(e,T_(t),I_(t)))}var Ie;(function(e){e.Empty=$Q,e.ofSingleton=function(t){return M9(t,t)},e.ofRange=M9,e.ofBounds=JO,e.ofLength=pTe,e.is=hTe,e.has=gTe,e.indexOf=yTe,e.getAt=bTe,e.start=Yc,e.end=lp,e.min=T_,e.max=I_,e.size=Lh,e.hashCode=vTe,e.toString=mTe,e.areEqual=xTe,e.areIntersecting=WQ,e.isSubInterval=STe,e.findPredecessorIndex=w5,e.findPredecessorIndexInInterval=CTe,e.findRange=XQ,e.intersectionSize=wTe,e.intersect=_Te})(Ie||(Ie={}));var hb=[];function ETe(e){return[e]}function ATe(e){return e}function PTe(e){return Tu(e),e}function D9(e,t){if(t<e)return[];for(var r=new Int32Array(t-e+1),n=e;n<=t;n++)r[n-e]=n;return r}function TTe(e){return e&&(Array.isArray(e)||!!e.buffer)}function E5(e){return e[0]}function A5(e){return e[e.length-1]+1}function ITe(e){return e[0]}function MTe(e){return e[e.length-1]}function YQ(e){return e.length}function DTe(e){var t=e.length;return t?t>2?X4e(t,e[0],e[t-1],e[t>>1]):W4e(t,e[0],e[t-1]):0}function RTe(e){var t=e.length;return t>5?"["+e[0]+", "+e[1]+", ..., "+e[t-1]+"], length "+t:"["+e.join(", ")+"]"}function KQ(e,t){var r=e.length;return r===0?-1:e[0]<=t&&t<=e[r-1]?ZQ(e,t,0,r):-1}function kTe(e,t,r){return QQ(e,t,Ie.start(r),Ie.end(r))}function QQ(e,t,r,n){var i=e.length;return i===0||n<=r?-1:e[r]<=t&&t<=e[n-1]?ZQ(e,t,r,n):-1}function OTe(e,t){return KQ(e,t)>=0}function LTe(e,t){if(e===t)return!0;var r=e.length;if(r!==t.length||e[0]!==t[0]||e[r-1]!==t[r-1])return!1;for(var n=0;n<r;n++)if(e[n]!==t[n])return!1;return!0}function wh(e,t){var r=e.length;return t<=e[0]?0:t>e[r-1]?r:JQ(e,t,0,r)}function FTe(e,t,r){var n=Ie.start(r),i=Ie.end(r),a=e[n];return t<=a?n:i>n&&t>e[i-1]?i:t-a<=11?BTe(e,t,n+1,i):JQ(e,t,n,i)}function NTe(e,t,r){return Ie.ofBounds(wh(e,t),wh(e,r+1))}function ZQ(e,t,r,n){for(var i=r,a=n-1;i<=a;){if(i+11>a){for(var o=i;o<=a;o++)if(t===e[o])return o;return-1}var s=i+a>>1,u=e[s];if(t<u)a=s-1;else if(t>u)i=s+1;else return s}return-1}function JQ(e,t,r,n){for(var i=r,a=n-1;i<a;){if(i+11>a){for(var o=i;o<=a;o++)if(t<=e[o])return o;return a+1}var s=i+a>>1,u=e[s];if(t<u)a=s-1;else if(t>u)i=s+1;else return s}return i>a?a+1:e[i]>=t?i:i+1}function BTe(e,t,r,n){for(var i=r;i<n;i++)if(t<=e[i])return i;return n}function UTe(e,t){if(e===t)return!0;for(var r=Rv(e,t),n=r.startI,i=r.startJ,a=r.endI,o=r.endJ;n<a&&i<o;){var s=e[n],u=t[i];if(s<u)n++;else if(s>u)i++;else return!0}return!1}function jTe(e,t){if(e===t)return!0;var r=t.length,n=Rv(e,t),i=n.startI,a=n.startJ,o=n.endI,s=n.endJ;if(s-a<r||o-i<r)return!1;for(var u=0;i<o&&a<s;){var l=e[i],c=t[a];l<c?i++:l>c?a++:(i++,a++,u++)}return u===r}function eZ(e,t){if(e===t)return e;var r=e.length,n=t.length;if(r===0)return t;if(n===0)return e;if(e[0]>t[0])return eZ(t,e);var i=Rv(e,t),a=i.startI,o=i.startJ,s=i.endI,u=i.endJ,l=eL(e,t,a,o,s,u);if(l===r&&l===n||l===n)return e;if(l===r)return t;var c=new Int32Array(r+n-l),d=0,f=0,p=0;for(d=0;d<a;d++)c[p++]=e[d];for(;f<u&&e[a]>t[f];)c[p++]=t[f++];for(;d<s&&f<u;){var v=e[d],h=t[f];v<h?(c[p++]=v,d++):v>h?(c[p++]=h,f++):(c[p++]=v,d++,f++)}for(;d<s;d++)c[p++]=e[d];for(;f<u;f++)c[p++]=t[f];for(;d<r;d++)c[p++]=e[d];for(;f<n;f++)c[p++]=t[f];return c}function zTe(e,t){if(e===t)return YQ(e);var r=Rv(e,t),n=r.startI,i=r.startJ,a=r.endI,o=r.endJ;return eL(e,t,n,i,a,o)}function eL(e,t,r,n,i,a){for(var o=r,s=n,u=0;o<i&&s<a;){var l=e[o],c=t[s];l<c?o++:l>c?s++:(o++,s++,u++)}return u}function VTe(e,t){if(e===t)return e;var r=Rv(e,t),n=r.startI,i=r.startJ,a=r.endI,o=r.endJ,s=eL(e,t,n,i,a,o),u=e.length,l=t.length;if(!s)return hb;if(s===u&&s===l||s===l)return t;if(s===u)return e;for(var c=new Int32Array(s),d=0,f=n,p=i;f<a&&p<o;){var v=e[f],h=t[p];v<h?f++:(v>h||(c[d++]=v,f++),p++)}return c}function HTe(e,t){if(e===t)return hb;for(var r=e.length,n=Rv(e,t),i=n.startI,a=n.startJ,o=n.endI,s=n.endJ,u=i,l=a,c=0;u<o&&l<s;){var d=e[u],f=t[l];d<f?u++:d>f?l++:(u++,l++,c++)}if(!c)return e;if(c>=r)return hb;for(var p=new Int32Array(r-c),v=0,h=0;h<i;h++)p[v++]=e[h];for(u=i,l=a;u<o&&l<s;){var d=e[u],f=t[l];d<f?(p[v++]=d,u++):(d>f||u++,l++)}for(;u<r;u++)p[v++]=e[u];return p}function GTe(e){if(e.length<2)return e;for(var t=1,r=0,n=e.length-1;r<n;r++)e[r]!==e[r+1]&&t++;if(t===e.length)return e;for(var i=new Int32Array(t),a=0,r=0,n=e.length-1;r<n;r++)e[r]!==e[r+1]&&(i[a++]=e[r]);return i[a]=e[e.length-1],i}function qTe(e,t){if(e===t)return _5(0,e.length-1);for(var r=Rv(e,t),n=r.startI,i=r.startJ,a=r.endI,o=r.endJ,s=n,u=i,l=0;s<a&&u<o;){var c=e[s],d=t[u];c<d?s++:c>d?u++:(s++,u++,l++)}var f=e.length;if(!l)return hb;if(l===f)return _5(0,e.length-1);var p=new Int32Array(l),v=0;for(s=n,u=i;s<a&&u<o;){var c=e[s],d=t[u];c<d?s++:(c>d||(p[v++]=s,s++),u++)}return p}var Ql={startI:0,startJ:0,endI:0,endJ:0};function Rv(e,t){var r=e.length,n=t.length,i=r/n;return r>=128||n>=128||i<=.34||i>=2.99?(Ql.startI=wh(e,E5(t)),Ql.startJ=wh(t,E5(e)),Ql.endI=wh(e,A5(t)),Ql.endJ=wh(t,A5(e))):(Ql.startI=0,Ql.startJ=0,Ql.endI=r,Ql.endJ=n),Ql}var Je;(function(e){e.Empty=hb,e.ofUnsortedArray=PTe,e.ofSingleton=ETe,e.ofSortedArray=ATe,e.ofRange=D9,e.ofBounds=function(t,r){return D9(t,r-1)},e.is=TTe,e.has=OTe,e.indexOf=KQ,e.indexOfInInterval=kTe,e.indexOfInRange=QQ,e.start=E5,e.end=A5,e.min=ITe,e.max=MTe,e.size=YQ,e.hashCode=DTe,e.toString=RTe,e.areEqual=LTe,e.areIntersecting=UTe,e.isSubset=jTe,e.union=eZ,e.intersect=VTe,e.subtract=HTe,e.findPredecessorIndex=wh,e.findPredecessorIndexInInterval=FTe,e.findRange=NTe,e.intersectionSize=zTe,e.deduplicate=GTe,e.indicesOf=qTe})(Je||(Je={}));var Ll=Ie.Empty,$Te=Ie.ofSingleton,WTe=Ie.ofRange,XTe=Ie.ofBounds;function $u(e){return e.length?e[e.length-1]-e[0]+1===e.length?Ie.ofRange(e[0],e[e.length-1]):e:Ll}function Fh(e){return Ie.is(e)?Ie.size(e):Je.size(e)}function YTe(e,t){return Ie.is(e)?Ie.has(e,t):Je.has(e,t)}function KTe(e,t){return Ie.is(e)?Ie.indexOf(e,t):Je.indexOf(e,t)}function P5(e,t){return Ie.is(e)?Ie.getAt(e,t):e[t]}function Gg(e){return Ie.is(e)?Ie.min(e):Je.min(e)}function qg(e){return Ie.is(e)?Ie.max(e):Je.max(e)}function QTe(e){return Ie.is(e)?Ie.start(e):Je.start(e)}function ZTe(e){return Ie.is(e)?Ie.end(e):Je.end(e)}function JTe(e){return Ie.is(e)?Ie.hashCode(e):Je.hashCode(e)}function eIe(e){return Ie.is(e)?Ie.toString(e):Je.toString(e)}function tIe(e,t){return Ie.is(e)?Ie.is(t)?Ie.areEqual(e,t):R9(e,t):Ie.is(t)?R9(t,e):Je.areEqual(e,t)}function rIe(e,t){return Ie.is(e)?Ie.is(t)?Ie.areIntersecting(e,t):k9(t,e):Ie.is(t)?k9(e,t):Je.areIntersecting(e,t)}function nIe(e,t){return Ie.is(e)?Ie.is(t)?Ie.isSubInterval(e,t):fIe(e,t):Ie.is(t)?dIe(e,t):Je.isSubset(e,t)}function iIe(e,t){return Ie.is(e)?Ie.findPredecessorIndex(e,t):Je.findPredecessorIndex(e,t)}function aIe(e,t,r){return Ie.is(e)?Ie.findPredecessorIndexInInterval(e,t,r):Je.findPredecessorIndexInInterval(e,t,r)}function oIe(e,t,r){return Ie.is(e)?Ie.findRange(e,t,r):Je.findRange(e,t,r)}function sIe(e,t){return Ie.is(e)?Ie.is(t)?Ie.intersectionSize(e,t):L9(t,e):Ie.is(t)?L9(e,t):Je.intersectionSize(e,t)}function uIe(e,t){return Ie.is(e)?Ie.is(t)?vIe(e,t):O9(t,e):Ie.is(t)?O9(e,t):$u(Je.union(e,t))}function lIe(e,t){return Ie.is(e)?Ie.is(t)?Ie.intersect(e,t):F9(t,e):Ie.is(t)?F9(e,t):$u(Je.intersect(e,t))}function cIe(e,t){return Ie.is(e)?Ie.is(t)?mIe(e,t):yIe(e,t):Ie.is(t)?gIe(e,t):$u(Je.subtract(e,t))}function R9(e,t){return Ie.size(e)===Je.size(t)&&Ie.start(e)===Je.start(t)&&Ie.end(e)===Je.end(t)}function k9(e,t){return e.length!==0&&Ie.size(Je.findRange(e,Ie.min(t),Ie.max(t)))!==0}function dIe(e,t){var r=Ie.min(t),n=Ie.max(t);if(n-r+1===0)return!0;var i=Je.min(e),a=Je.max(e);if(r<i||n>a)return!1;var o=Je.findRange(e,r,n);return Ie.size(o)===Ie.size(t)}function fIe(e,t){var r=Ie.min(e),n=Ie.max(e);if(n-r+1===0)return!1;var i=Je.min(t),a=Je.max(t);return i>=r&&a<=n}function pIe(e,t){var r=Fh(e),n=Fh(t);return r===0&&n===0?!0:r>0&&n>0&&qg(e)>=Gg(t)&&Gg(e)<=qg(t)}function hIe(e,t){return Fh(e)?Fh(t)?Gg(e)<=Gg(t)&&qg(e)>=qg(t):!0:Fh(t)===0}function vIe(e,t){if(Ie.areEqual(e,t))return e;var r=Ie.size(e),n=Ie.size(t);if(!n)return e;if(!r)return t;var i=Ie.min(e),a=Ie.min(t);if(pIe(e,t))return Ie.ofRange(Math.min(i,a),Math.max(Ie.max(e),Ie.max(t)));var o,s,u,l;i<a?(o=r,s=i,u=n,l=a):(o=n,s=a,u=r,l=i);for(var c=new Int32Array(r+n),d=0;d<o;d++)c[d]=d+s;for(var d=0;d<u;d++)c[d+o]=d+l;return $u(c)}function O9(e,t){var r=Ie.size(t);if(!r)return e;if(hIe(t,e))return t;for(var n=Ie.min(t),i=Ie.max(t),a=Je.findRange(e,n,i),o=Ie.start(a),s=Ie.end(a),u=new Int32Array(o+(e.length-s)+r),l=0,c=0;c<o;c++)u[l++]=e[c];for(var c=n;c<=i;c++)u[l++]=c;for(var c=s,d=e.length;c<d;c++)u[l++]=e[c];return $u(u)}function L9(e,t){if(!Ie.size(t))return 0;var r=Je.findRange(e,Ie.min(t),Ie.max(t));return Ie.end(r)-Ie.start(r)}function F9(e,t){if(!Ie.size(t))return Ll;var r=Je.findRange(e,Ie.min(t),Ie.max(t)),n=Ie.start(r),i=Ie.end(r),a=i-n;if(!a)return Ll;if(a===e.length)return e;for(var o=new Int32Array(a),s=0,u=n;u<i;u++)o[s++]=e[u];return $u(o)}function mIe(e,t){if(Ie.areEqual(e,t))return Ll;if(!Ie.areIntersecting(e,t))return e;var r=Ie.min(e),n=Ie.max(e),i=Ie.min(t),a=Ie.max(t);if(n<r||a<i)return e;if(Ie.isSubInterval(t,e))return Ll;if(Ie.isSubInterval(e,t)){var o=i-r,s=n-a;if(o<=0)return Ie.ofRange(a+1,a+s);if(s<=0)return Ie.ofRange(r,r+o-1);for(var u=new Int32Array(o+s),l=0,c=0;c<o;c++)u[l++]=r+c;for(var c=1;c<=s;c++)u[l++]=a+c;return $u(u)}return r<i?Ie.ofRange(r,i-1):Ie.ofRange(a+1,n)}function gIe(e,t){var r=Ie.min(t),n=Ie.max(t);if(n<r)return e;var i=Je.findRange(e,r,n),a=Ie.start(i),o=Ie.end(i),s=e.length-(o-a);if(s<=0)return Ll;if(s===e.length)return e;for(var u=new Int32Array(s),l=0,c=0;c<a;c++)u[l++]=e[c];for(var c=o,d=e.length;c<d;c++)u[l++]=e[c];return $u(u)}function yIe(e,t){var r=Ie.min(e),n=Ie.max(e);if(n<r)return e;var i=n-r+1,a=Je.findRange(t,r,n),o=Ie.start(a),s=Ie.end(a),u=s-o;if(u===0)return e;var l=i-u;if(l<=0)return Ll;for(var c=new Int32Array(l),d=t.length-1,f=t[Math.min(o,d)],p=t[Math.min(s,d)],v=0,h=r;h<f;h++)c[v++]=h;for(var h=f;h<=p;h++)Je.indexOfInInterval(t,h,a)<0&&(c[v++]=h);for(var h=p+1;h<=n;h++)c[v++]=h;return $u(c)}function bIe(e,t,r){if(Ie.is(e))for(var n=Ie.min(e),i=n,a=Ie.max(e);i<=a;i++)t(i,i-n,r);else for(var i=0,a=e.length;i<a;i++)t(e[i],i,r);return r}function xIe(e,t,r,n){if(Ie.is(e))for(var i=0,a=Ie.min(e),o=Ie.max(e);a<=o;a++){for(var s=t(a),u=a+1;u<o&&t(u)===s;)u++;a=u-1,r(s,i,n),i++}else for(var i=0,a=0,o=e.length;a<o;a++){for(var s=t(e[a]),u=a+1;u<o&&t(e[u])===s;)u++;a=u-1,r(s,i,n),i++}return n}function SIe(e,t,r){if(t===r)return e;var n=Fh(e),i=t.length,a=r.length;if(n===0||i===0||a===0)return Ll;for(var o=Je.findPredecessorIndex(r,t[Gg(e)]),s=Je.findPredecessorIndex(r,t[qg(e)]+1),u=0,l=0,c=0,d=o;c<n&&d<s;){var f=t[P5(e,c)],p=r[d];f<p?c++:(f>p||(u++,c++),d++)}if(u===0)return Ll;if(u===i&&u===a)return e;var v=new Int32Array(u);for(l=0,c=0,d=o;c<n&&d<s;){var f=t[P5(e,c)],p=r[d];f<p?c++:(f>p||(v[l++]=d,c++),d++)}return $u(v)}var Le;(function(e){e.Empty=Ll,e.ofSingleton=$Te,e.ofRange=WTe,e.ofBounds=XTe,e.ofSortedArray=$u,e.has=YTe,e.indexOf=KTe,e.getAt=P5,e.min=Gg,e.max=qg,e.start=QTe,e.end=ZTe,e.size=Fh,e.hashCode=JTe,e.areEqual=tIe,e.areIntersecting=rIe,e.isSubset=nIe,e.union=uIe,e.intersect=lIe,e.indexedIntersect=SIe,e.subtract=cIe,e.findPredecessorIndex=iIe,e.findPredecessorIndexInInterval=aIe,e.findRange=oIe,e.intersectionSize=sIe;function t(s,u,l){return bIe(s,u,l)}e.forEach=t;function r(s,u,l,c){return xIe(s,u,l,c)}e.forEachSegment=r;function n(s){return Ie.is(s)}e.isInterval=n;function i(s){return!Ie.is(s)}e.isSortedArray=i;function a(s){var u=[];return e.forEach(s,function(l){return u.push(l)}),u}e.toArray=a;function o(s){return eIe(s)}e.toString=o})(Le||(Le={}));function tZ(e){for(var t=Je.ofSortedArray(e),r=Je.max(t),n=new Int32Array(r),i=0,a=e.length-1;i<a;i++)for(var o=e[i],s=e[i+1];o<s;o++)n[o]=i;return{offsets:t,index:n,count:e.length-1}}function CIe(e,t){for(var r=Ie.start(t),n=new Int32Array(e.length+1),i=0,a=e.length;i<a;i++)n[i]=e[i]-r;return n[e.length]=Ie.end(t)-r,tZ(n)}function _Ie(e){var t=e.count;return t}function wIe(e,t){var r=e.index;return r[t]}function EIe(e,t,r){var n=e.offsets,i=Le.max(n),a=r>=i?-1:Le.findPredecessorIndex(n,r-1);return Le.findRange(t,Le.getAt(n,a),Le.getAt(n,a+1)-1)}var AIe=function(){function e(t,r,n,i){this.segments=t,this.segmentMap=r,this.set=n,this.segmentMin=0,this.segmentMax=0,this.setRange=Ie.Empty,this.value={index:0,start:0,end:0},this.hasNext=!1,this.setRange=i,this.updateSegmentRange()}return e.prototype.move=function(){for(;this.hasNext;)if(this.updateValue()){this.value.index=this.segmentMin++,this.hasNext=this.segmentMax>=this.segmentMin&&Ie.size(this.setRange)>0;break}else this.updateSegmentRange();return this.value},e.prototype.updateValue=function(){var t=this.segments[this.segmentMin+1],r=Le.findPredecessorIndexInInterval(this.set,t,this.setRange);return this.value.start=Ie.start(this.setRange),this.value.end=r,this.setRange=Ie.ofBounds(r,Ie.end(this.setRange)),r>this.value.start},e.prototype.updateSegmentRange=function(){var t=Ie.min(this.setRange),r=Ie.max(this.setRange);if(r<t){this.hasNext=!1;return}this.segmentMin=this.segmentMap[Le.getAt(this.set,t)],this.segmentMax=this.segmentMap[Le.getAt(this.set,r)],this.hasNext=this.segmentMax>=this.segmentMin},e.prototype.setSegment=function(t){this.setRange=Ie.ofBounds(t.start,t.end),this.updateSegmentRange()},e}();function PIe(e,t,r){var n=typeof r<"u"?Ie.ofBounds(r.start,r.end):Ie.ofBounds(0,Le.size(t));return new AIe(e.offsets,e.index,t,n)}var nr;(function(e){e.create=tZ,e.ofOffsets=CIe,e.count=_Ie,e.getSegment=wIe,e.projectValue=EIe,e.transientSegments=PIe})(nr||(nr={}));function TIe(e){return new IIe(e)}var IIe=function(){function e(t){this.head=t>0?0:-1,this.prev=new Int32Array(t),this.next=new Int32Array(t);for(var r=0;r<t;r++)this.next[r]=r+1,this.prev[r]=r-1;this.prev[0]=-1,this.next[t-1]=-1}return e.prototype.remove=function(t){var r=this,n=r.prev,i=r.next,a=n[t],o=i[t];a>=0&&(i[a]=o,n[t]=-1),o>=0&&(n[o]=a,i[t]=-1),t===this.head&&(a<0?this.head=o:this.head=a)},e.prototype.has=function(t){return this.prev[t]>=0||this.next[t]>=0||this.head===t},e}(),Ws;(function(e){e.Empty=new Map;function t(o){return ZO(o.keys())}e.keyArray=t;function r(){return new Map}e.Mutable=r;function n(o){return o}e.asImmutable=n;function i(o){for(var s=r(),u=o.keys();;){var l=u.next(),c=l.done,d=l.value;if(c)break;s.set(d,o.get(d))}return s}e.copy=i;function a(o,s){for(var u=s.keys();;){var l=u.next(),c=l.done,d=l.value;if(c)break;o.set(d,s.get(d))}return o}e.addFrom=a})(Ws||(Ws={}));var MIe=function(){function e(t){this.xs=[],this.index=-1,this.length=0,this.hasNext=!1,this.length=t.length,this.hasNext=t.length>0,this.xs=t,this.index=-1,this.lastValue=t.length>0?t[0]:void 0}return e.prototype.move=function(){return++this.index,this.lastValue=this.xs[this.index],this.hasNext=this.index<this.length-1,this.lastValue},e}(),N9=function(){function e(t,r){this.max=r,this.value=0,this.hasNext=!1,this.value=t-1,this.hasNext=r>=t}return e.prototype.move=function(){return++this.value,this.hasNext=this.value<this.max,this.value},e}(),DIe=function(){function e(t){this.value=t,this.hasNext=!0}return e.prototype.move=function(){return this.hasNext=!1,this.value},e}(),RIe=function(){function e(t,r){this.base=t,this.f=r,this.hasNext=!1,this.hasNext=t.hasNext}return e.prototype.move=function(){var t=this.f(this.base.move());return this.hasNext=this.base.hasNext,t},e}(),kIe=function(){function e(t,r){this.base=t,this.p=r,this.hasNext=this.findNext()}return e.prototype.move=function(){var t=this.next;return this.hasNext=this.findNext(),t},e.prototype.findNext=function(){for(;this.base.hasNext;)if(this.next=this.base.move(),this.p(this.next))return!0;return!1},e}(),M_;(function(e){e.Empty=new N9(0,-1);function t(s){return new MIe(s)}e.Array=t;function r(s){return new DIe(s)}e.Value=r;function n(s,u){return new N9(s,u)}e.Range=n;function i(s,u){return new RIe(s,u)}e.map=i;function a(s,u){return new kIe(s,u)}e.filter=a;function o(s,u,l){for(;s.hasNext;){var c=u(s.move(),l);if(c)return l}return l}e.forEach=o})(M_||(M_={}));var OIe={domain:[0,1],reverse:!1,listOrName:"red-yellow-blue",minLabel:"",maxLabel:""},Bu;(function(e){function t(r){var n=E(E({},OIe),r),i=n.domain,a=n.reverse,o=n.listOrName,s=typeof o=="string"?$s(o).list:o,u=a?s.slice().reverse():s,l=u.length-1,c=0,d=0,f=0;function p(C,w){d=C,f=w,c=f-d||1}p(i[0],i[1]);var v=Di(r.minLabel,d.toString()),h=Di(r.maxLabel,f.toString()),m,g=u.every(function(C){return Array.isArray(C)});if(g){var y=Nt([],u);y.sort(function(C,w){return C[1]-w[1]});var b=y.map(function(C){return C[0]}),S=Je.ofSortedArray(y.map(function(C){return C[1]})),x=b.length-1;m=function(C){var w=Ba((C-d)/c,0,1),A=Je.findPredecessorIndex(S,w);if(A===0)return b[d];if(A>x)return b[x];var M=S[A-1],D=S[A],k=Ba((w-M)/(D-M),0,1);return at.interpolate(b[A-1],b[A],k)}}else m=function(C){var w=Math.min(u.length-1,Math.max(0,(C-d)/c*l)),A=Math.floor(w),M=u[A],D=u[Math.ceil(w)];return at.interpolate(M,D,w-A)};return{color:m,colorToArray:function(C,w,A){at.toArray(m(C),w,A)},normalizedColorToArray:function(C,w,A){at.toArrayNormalized(m(C),w,A)},setDomain:p,get legend(){return N4e(v,h,u)}}}e.create=t})(Bu||(Bu={}));function sn(e){return e.svg?P.jsx("span",E({className:"msp-icon msp-material-icon"+(e.inline?" msp-icon-inline":""),title:e.title,style:e.style},{children:P.jsx(e.svg,{},void 0)}),void 0):null}var oE=P.jsx("circle",{r:"6px",id:"circle-left",cy:"12px",cx:"8px",strokeWidth:"1px"},void 0),sE=P.jsx("circle",{r:"6px",id:"circle-right",cy:"12px",cx:"16px",strokeWidth:"1px"},void 0),LIe=P.jsxs("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:[P.jsxs("defs",{children:[oE,sE]},void 0),P.jsxs("g",{children:[P.jsx("use",{href:"#circle-left",className:"msp-shape-filled"},void 0),P.jsx("use",{href:"#circle-right",className:"msp-shape-filled"},void 0),P.jsx("use",{href:"#circle-left",className:"msp-shape-empty"},void 0)]},void 0)]}),void 0);function T5(){return LIe}var FIe=P.jsxs("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:[P.jsxs("defs",{children:[oE,sE,P.jsxs("mask",E({id:"mask-left"},{children:[P.jsx("use",{href:"#circle-left",fill:"white",stroke:"white"},void 0),P.jsx("use",{href:"#circle-right",fill:"black",strokeWidth:"0px",stroke:"white"},void 0)]}),void 0)]},void 0),P.jsxs("g",{children:[P.jsx("use",{href:"#circle-left",className:"msp-shape-filled",mask:"url(#mask-left)"},void 0),P.jsx("use",{href:"#circle-right",className:"msp-shape-empty"},void 0)]},void 0)]}),void 0);function I5(){return FIe}var NIe=P.jsxs("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:[P.jsxs("defs",{children:[oE,sE,P.jsx("clipPath",E({id:"clip-left"},{children:P.jsx("use",{href:"#circle-right"},void 0)}),void 0)]},void 0),P.jsxs("g",{children:[P.jsx("use",{href:"#circle-left",className:"msp-shape-filled",clipPath:"url(#clip-left)"},void 0),P.jsx("use",{href:"#circle-left",className:"msp-shape-empty"},void 0),P.jsx("use",{href:"#circle-right",className:"msp-shape-empty"},void 0)]},void 0)]}),void 0);function M5(){return NIe}var BIe=P.jsxs("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:[P.jsxs("defs",{children:[oE,sE]},void 0),P.jsxs("g",{children:[P.jsx("use",{href:"#circle-left",className:"msp-shape-empty"},void 0),P.jsx("use",{href:"#circle-right",className:"msp-shape-filled"},void 0)]},void 0)]}),void 0);function D_(){return BIe}var UIe=P.jsx("svg",E({width:"17px",height:"17px",viewBox:"0 0 299.463 299.463",strokeWidth:"6px"},{children:P.jsx("g",{children:P.jsx("path",{d:"M256.851,173.832v-48.201c22.916-4.918,34.151-30.668,22.556-50.771c-11.547-20.004-39.486-23.251-55.242-5.844 l-41.746-24.106C189.618,22.603,172.861,0,149.734,0c-23.132,0-39.881,22.609-32.685,44.911L75.305,69.016 C59.522,51.586,31.597,54.88,20.061,74.863c-11.63,20.163-0.298,45.862,22.557,50.769v48.2 c-22.821,4.898-34.195,30.591-22.556,50.771c11.529,19.972,39.454,23.285,55.242,5.845l41.746,24.106 c-7.199,22.308,9.559,44.911,32.685,44.911c23.132,0,39.88-22.609,32.685-44.911l41.745-24.106 c15.817,17.469,43.73,14.099,55.242-5.844c0,0,0-0.001,0.001-0.002c4.587-7.953,5.805-17.213,3.431-26.076 C279.392,185.657,269.129,176.461,256.851,173.832z M249.62,72.088c20.568,0,27.428,27.191,10.008,37.239 c-0.003,0.002-0.006,0.003-0.009,0.005c-10.04,5.81-22.85,1.762-27.877-8.475C225.206,87.548,234.938,72.088,249.62,72.088z M149.734,14.4c11.005,0,19.958,8.954,19.958,19.959c0,11.127-9.077,19.958-19.958,19.958c-10.95,0-19.958-8.9-19.958-19.958 C129.776,23.354,138.729,14.4,149.734,14.4z M39.84,109.328c-17.451-10.067-10.534-37.24,10.01-37.24 c15.311,0,24.922,16.653,17.251,29.942C61.681,111.397,49.517,114.925,39.84,109.328z M59.802,224.702 c-9.535,5.503-21.768,2.229-27.268-7.298c-7.639-13.242,1.887-29.945,17.236-29.945c0.013,0,0.027,0,0.04,0 C70.07,187.48,77.49,214.469,59.802,224.702z M149.734,285.062c-11.005,0-19.958-8.954-19.958-19.958 c0-11.127,9.077-19.958,19.958-19.958c10.954,0,19.958,8.903,19.958,19.958C169.693,276.109,160.74,285.062,149.734,285.062z M216.953,217.982l-41.727,24.095c-13.778-15.22-37.459-14.94-50.983,0l-41.728-24.096c6.196-19.289-5.541-39.835-25.498-44.149 V125.63c19.752-4.268,31.762-24.65,25.498-44.149l41.727-24.095c13.629,15.055,37.32,15.093,50.983,0l41.728,24.096 c-6.196,19.29,5.534,39.835,25.498,44.149v48.202C222.61,178.123,210.721,198.581,216.953,217.982z M266.935,217.404 c-5.501,9.528-17.732,12.802-27.261,7.302c-17.682-10.23-10.301-37.247,10.032-37.247 C264.984,187.459,274.602,204.112,266.935,217.404z"},void 0)},void 0)}),void 0);function jIe(){return UIe}var zIe=P.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24",strokeWidth:"0.1px"},{children:P.jsx("path",{d:"M21,16.5C21,16.88 20.79,17.21 20.47,17.38L12.57,21.82C12.41,21.94 12.21,22 12,22C11.79,22 11.59,21.94 11.43,21.82L3.53,17.38C3.21,17.21 3,16.88 3,16.5V7.5C3,7.12 3.21,6.79 3.53,6.62L11.43,2.18C11.59,2.06 11.79,2 12,2C12.21,2 12.41,2.06 12.57,2.18L20.47,6.62C20.79,6.79 21,7.12 21,7.5V16.5M12,4.15L6.04,7.5L12,10.85L17.96,7.5L12,4.15M5,15.91L11,19.29V12.58L5,9.21V15.91M19,15.91V9.21L13,12.58V19.29L19,15.91Z"},void 0)}),void 0);function D5(){return zIe}P.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24",strokeWidth:"0.1px"},{children:P.jsx("path",{d:"M17,22V20H20V17H22V20.5C22,20.89 21.84,21.24 21.54,21.54C21.24,21.84 20.89,22 20.5,22H17M7,22H3.5C3.11,22 2.76,21.84 2.46,21.54C2.16,21.24 2,20.89 2,20.5V17H4V20H7V22M17,2H20.5C20.89,2 21.24,2.16 21.54,2.46C21.84,2.76 22,3.11 22,3.5V7H20V4H17V2M7,2V4H4V7H2V3.5C2,3.11 2.16,2.76 2.46,2.46C2.76,2.16 3.11,2 3.5,2H7M13,17.25L17,14.95V10.36L13,12.66V17.25M12,10.92L16,8.63L12,6.28L8,8.63L12,10.92M7,14.95L11,17.25V12.66L7,10.36V14.95M18.23,7.59C18.73,7.91 19,8.34 19,8.91V15.23C19,15.8 18.73,16.23 18.23,16.55L12.75,19.73C12.25,20.05 11.75,20.05 11.25,19.73L5.77,16.55C5.27,16.23 5,15.8 5,15.23V8.91C5,8.34 5.27,7.91 5.77,7.59L11.25,4.41C11.5,4.28 11.75,4.22 12,4.22C12.25,4.22 12.5,4.28 12.75,4.41L18.23,7.59Z"},void 0)}),void 0);P.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24",strokeWidth:"0.1px"},{children:P.jsx("path",{d:"M16,4L9,8.04V15.96L16,20L23,15.96V8.04M16,6.31L19.8,8.5L16,10.69L12.21,8.5M0,7V9H7V7M11,10.11L15,12.42V17.11L11,14.81M21,10.11V14.81L17,17.11V12.42M2,11V13H7V11M4,15V17H7V15"},void 0)}),void 0);var VIe=P.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:P.jsx("path",{d:"M10.07,14.27C10.57,14.03 11.16,14.25 11.4,14.75L13.7,19.74L15.5,18.89L13.19,13.91C12.95,13.41 13.17,12.81 13.67,12.58L13.95,12.5L16.25,12.05L8,5.12V15.9L9.82,14.43L10.07,14.27M13.64,21.97C13.14,22.21 12.54,22 12.31,21.5L10.13,16.76L7.62,18.78C7.45,18.92 7.24,19 7,19A1,1 0 0,1 6,18V3A1,1 0 0,1 7,2C7.24,2 7.47,2.09 7.64,2.23L7.65,2.22L19.14,11.86C19.57,12.22 19.62,12.85 19.27,13.27C19.12,13.45 18.91,13.57 18.7,13.61L15.54,14.23L17.74,18.96C18,19.46 17.76,20.05 17.26,20.28L13.64,21.97Z"},void 0)}),void 0);function HIe(){return VIe}P.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24",strokeWidth:"0.1px"},{children:P.jsx("path",{fill:"currentColor",d:"M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"},void 0)}),void 0);var GIe=P.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24",strokeWidth:"0.1px"},{children:P.jsx("path",{d:"M3 17.25V21H6.75L17.81 9.93L14.06 6.18L3 17.25M22.61 18.36L18.36 22.61L13.16 17.41L14.93 15.64L15.93 16.64L18.4 14.16L19.82 15.58L18.36 17L19.42 18L20.84 16.6L22.61 18.36M6.61 10.83L1.39 5.64L5.64 1.39L7.4 3.16L4.93 5.64L6 6.7L8.46 4.22L9.88 5.64L8.46 7.05L9.46 8.05L6.61 10.83M20.71 7C21.1 6.61 21.1 6 20.71 5.59L18.37 3.29C18 2.9 17.35 2.9 16.96 3.29L15.12 5.12L18.87 8.87L20.71 7Z"},void 0)}),void 0);function qIe(){return GIe}var $Ie=P.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:P.jsx("path",{d:"M22 11V3h-7v3H9V3H2v8h7V8h2v10h4v3h7v-8h-7v3h-2V8h2v3h7zM7 9H4V5h3v4zm10 6h3v4h-3v-4zm0-10h3v4h-3V5z"},void 0)}),void 0);function rZ(){return $Ie}var WIe=P.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:P.jsx("path",{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"},void 0)}),void 0);function v0(){return WIe}var XIe=P.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:P.jsx("path",{d:"M20 12l-1.41-1.41L13 16.17V4h-2v12.17l-5.58-5.59L4 12l8 8 8-8z"},void 0)}),void 0);function uE(){return XIe}var YIe=P.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:P.jsx("path",{d:"M7 10l5 5 5-5z"},void 0)}),void 0);function Kc(){return YIe}var KIe=P.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:P.jsx("path",{d:"M10 17l5-5-5-5v10z"},void 0)}),void 0);function Qc(){return KIe}var QIe=P.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:P.jsx("path",{d:"M4 12l1.41 1.41L11 7.83V20h2V7.83l5.58 5.59L20 12l-8-8-8 8z"},void 0)}),void 0);function lE(){return QIe}var ZIe=P.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:P.jsx("path",{d:"M12 6v3l4-4-4-4v3c-4.42 0-8 3.58-8 8 0 1.57.46 3.03 1.24 4.26L6.7 14.8c-.45-.83-.7-1.79-.7-2.8 0-3.31 2.69-6 6-6zm6.76 1.74L17.3 9.2c.44.84.7 1.79.7 2.8 0 3.31-2.69 6-6 6v-3l-4 4 4 4v-3c4.42 0 8-3.58 8-8 0-1.57-.46-3.03-1.24-4.26z"},void 0)}),void 0);function JIe(){return ZIe}var eMe=P.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:P.jsx("path",{d:"M6 13c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1zm0 4c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1zm0-8c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1zm-3 .5c-.28 0-.5.22-.5.5s.22.5.5.5.5-.22.5-.5-.22-.5-.5-.5zM6 5c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1zm15 5.5c.28 0 .5-.22.5-.5s-.22-.5-.5-.5-.5.22-.5.5.22.5.5.5zM14 7c.55 0 1-.45 1-1s-.45-1-1-1-1 .45-1 1 .45 1 1 1zm0-3.5c.28 0 .5-.22.5-.5s-.22-.5-.5-.5-.5.22-.5.5.22.5.5.5zm-11 10c-.28 0-.5.22-.5.5s.22.5.5.5.5-.22.5-.5-.22-.5-.5-.5zm7 7c-.28 0-.5.22-.5.5s.22.5.5.5.5-.22.5-.5-.22-.5-.5-.5zm0-17c.28 0 .5-.22.5-.5s-.22-.5-.5-.5-.5.22-.5.5.22.5.5.5zM10 7c.55 0 1-.45 1-1s-.45-1-1-1-1 .45-1 1 .45 1 1 1zm0 5.5c-.83 0-1.5.67-1.5 1.5s.67 1.5 1.5 1.5 1.5-.67 1.5-1.5-.67-1.5-1.5-1.5zm8 .5c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1zm0 4c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1zm0-8c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1zm0-4c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1zm3 8.5c-.28 0-.5.22-.5.5s.22.5.5.5.5-.22.5-.5-.22-.5-.5-.5zM14 17c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1zm0 3.5c-.28 0-.5.22-.5.5s.22.5.5.5.5-.22.5-.5-.22-.5-.5-.5zm-4-12c-.83 0-1.5.67-1.5 1.5s.67 1.5 1.5 1.5 1.5-.67 1.5-1.5-.67-1.5-1.5-1.5zm0 8.5c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1zm4-4.5c-.83 0-1.5.67-1.5 1.5s.67 1.5 1.5 1.5 1.5-.67 1.5-1.5-.67-1.5-1.5-1.5zm0-4c-.83 0-1.5.67-1.5 1.5s.67 1.5 1.5 1.5 1.5-.67 1.5-1.5-.67-1.5-1.5-1.5z"},void 0)}),void 0);function nZ(){return eMe}var tMe=P.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:P.jsx("path",{d:"M15 7v12.97l-4.21-1.81-.79-.34-.79.34L5 19.97V7h10m4-6H8.99C7.89 1 7 1.9 7 3h10c1.1 0 2 .9 2 2v13l2 1V3c0-1.1-.9-2-2-2zm-4 4H5c-1.1 0-2 .9-2 2v16l7-3 7 3V7c0-1.1-.9-2-2-2z"},void 0)}),void 0);function cE(){return tMe}var rMe=P.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:P.jsx("path",{d:"M7 14c-1.66 0-3 1.34-3 3 0 1.31-1.16 2-2 2 .92 1.22 2.49 2 4 2 2.21 0 4-1.79 4-4 0-1.66-1.34-3-3-3zm13.71-9.37l-1.34-1.34a.9959.9959 0 00-1.41 0L9 12.25 11.75 15l8.96-8.96c.39-.39.39-1.02 0-1.41z"},void 0)}),void 0);function R5(){return rMe}var nMe=P.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:P.jsx("path",{d:"M22.61 18.99l-9.08-9.08c.93-2.34.45-5.1-1.44-7C9.79.61 6.21.4 3.66 2.26L7.5 6.11 6.08 7.52 2.25 3.69C.39 6.23.6 9.82 2.9 12.11c1.86 1.86 4.57 2.35 6.89 1.48l9.11 9.11c.39.39 1.02.39 1.41 0l2.3-2.3c.4-.38.4-1.01 0-1.41zm-3 1.6l-9.46-9.46c-.61.45-1.29.72-2 .82-1.36.2-2.79-.21-3.83-1.25C3.37 9.76 2.93 8.5 3 7.26l3.09 3.09 4.24-4.24-3.09-3.09c1.24-.07 2.49.37 3.44 1.31 1.08 1.08 1.49 2.57 1.24 3.96-.12.71-.42 1.37-.88 1.96l9.45 9.45-.88.89z"},void 0)}),void 0);function iMe(){return nMe}var aMe=P.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:P.jsx("path",{d:"M22.7 19l-9.1-9.1c.9-2.3.4-5-1.5-6.9-2-2-5-2.4-7.4-1.3L9 6 6 9 1.6 4.7C.4 7.1.9 10.1 2.9 12.1c1.9 1.9 4.6 2.4 6.9 1.5l9.1 9.1c.4.4 1 .4 1.4 0l2.3-2.3c.5-.4.5-1.1.1-1.4z"},void 0)}),void 0);function oMe(){return aMe}var sMe=P.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:P.jsx("path",{d:"M14.25 2.26l-.08-.04-.01.02C13.46 2.09 12.74 2 12 2 6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10c0-4.75-3.31-8.72-7.75-9.74zM19.41 9h-7.99l2.71-4.7c2.4.66 4.35 2.42 5.28 4.7zM13.1 4.08L10.27 9l-1.15 2L6.4 6.3C7.84 4.88 9.82 4 12 4c.37 0 .74.03 1.1.08zM5.7 7.09L8.54 12l1.15 2H4.26C4.1 13.36 4 12.69 4 12c0-1.85.64-3.55 1.7-4.91zM4.59 15h7.98l-2.71 4.7c-2.4-.67-4.34-2.42-5.27-4.7zm6.31 4.91L14.89 13l2.72 4.7C16.16 19.12 14.18 20 12 20c-.38 0-.74-.04-1.1-.09zm7.4-3l-4-6.91h5.43c.17.64.27 1.31.27 2 0 1.85-.64 3.55-1.7 4.91z"},void 0)}),void 0);function uMe(){return sMe}var lMe=P.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:P.jsx("path",{d:"M9.4 10.5l4.77-8.26C13.47 2.09 12.75 2 12 2c-2.4 0-4.6.85-6.32 2.25l3.66 6.35.06-.1zM21.54 9c-.92-2.92-3.15-5.26-6-6.34L11.88 9h9.66zm.26 1h-7.49l.29.5 4.76 8.25C21 16.97 22 14.61 22 12c0-.69-.07-1.35-.2-2zM8.54 12l-3.9-6.75C3.01 7.03 2 9.39 2 12c0 .69.07 1.35.2 2h7.49l-1.15-2zm-6.08 3c.92 2.92 3.15 5.26 6 6.34L12.12 15H2.46zm11.27 0l-3.9 6.76c.7.15 1.42.24 2.17.24 2.4 0 4.6-.85 6.32-2.25l-3.66-6.35-.93 1.6z"},void 0)}),void 0);function cMe(){return lMe}var dMe=P.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:P.jsx("path",{d:"M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm3.59-13L12 10.59 8.41 7 7 8.41 10.59 12 7 15.59 8.41 17 12 13.41 15.59 17 17 15.59 13.41 12 17 8.41z"},void 0)}),void 0);function tL(){return dMe}var fMe=P.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:P.jsx("path",{d:"M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2zm5 13.59L15.59 17 12 13.41 8.41 17 7 15.59 10.59 12 7 8.41 8.41 7 12 10.59 15.59 7 17 8.41 13.41 12 17 15.59z"},void 0)}),void 0);function iZ(){return fMe}var pMe=P.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:P.jsx("path",{d:"M12 8c-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4zm-7 7H3v4c0 1.1.9 2 2 2h4v-2H5v-4zM5 5h4V3H5c-1.1 0-2 .9-2 2v4h2V5zm14-2h-4v2h4v4h2V5c0-1.1-.9-2-2-2zm0 16h-4v2h4c1.1 0 2-.9 2-2v-4h-2v4z"},void 0)}),void 0);function hMe(){return pMe}var vMe=P.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:P.jsx("path",{d:"M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"},void 0)}),void 0);function m0(){return vMe}var mMe=P.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:P.jsx("path",{d:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"},void 0)}),void 0);function aZ(){return mMe}var gMe=P.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:P.jsx("path",{d:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"},void 0)}),void 0);function Ac(){return gMe}var yMe=P.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:P.jsx("path",{d:"M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96zM14 13v4h-4v-4H7l5-5 5 5h-3z"},void 0)}),void 0);function bMe(){return yMe}var xMe=P.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:P.jsx("path",{d:"M9.4 16.6L4.8 12l4.6-4.6L8 6l-6 6 6 6 1.4-1.4zm5.2 0l4.6-4.6-4.6-4.6L16 6l6 6-6 6-1.4-1.4z"},void 0)}),void 0);function SMe(){return xMe}var CMe=P.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:P.jsx("path",{d:"M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm-1 4H8c-1.1 0-1.99.9-1.99 2L6 21c0 1.1.89 2 1.99 2H19c1.1 0 2-.9 2-2V11l-6-6zM8 21V7h6v5h5v9H8z"},void 0)}),void 0);function _Me(){return CMe}var wMe=P.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:P.jsx("path",{d:"M17 15h2V7c0-1.1-.9-2-2-2H9v2h8v8zM7 17V1H5v4H1v2h4v10c0 1.1.9 2 2 2h10v4h2v-4h4v-2H7z"},void 0)}),void 0);function EMe(){return wMe}var AMe=P.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:P.jsx("path",{d:"M3 5v4h2V5h4V3H5c-1.1 0-2 .9-2 2zm2 10H3v4c0 1.1.9 2 2 2h4v-2H5v-4zm14 4h-4v2h4c1.1 0 2-.9 2-2v-4h-2v4zm0-16h-4v2h4v4h2V5c0-1.1-.9-2-2-2z"},void 0)}),void 0);function PMe(){return AMe}var TMe=P.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:P.jsx("path",{d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V5h14v14zm-5.04-6.71l-2.75 3.54-1.96-2.36L6.5 17h11l-3.54-4.71z"},void 0)}),void 0);function IMe(){return TMe}var MMe=P.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:P.jsx("path",{d:"M16 9v10H8V9h8m-1.5-6h-5l-1 1H5v2h14V4h-3.5l-1-1zM18 7H6v12c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7z"},void 0)}),void 0);function eu(){return MMe}P.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:P.jsx("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"},void 0)}),void 0);var DMe=P.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:P.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"},void 0)}),void 0);function B9(){return DMe}P.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:P.jsx("path",{d:"M20.5 11H19V7c0-1.1-.9-2-2-2h-4V3.5C13 2.12 11.88 1 10.5 1S8 2.12 8 3.5V5H4c-1.1 0-1.99.9-1.99 2v3.8H3.5c1.49 0 2.7 1.21 2.7 2.7s-1.21 2.7-2.7 2.7H2V20c0 1.1.9 2 2 2h3.8v-1.5c0-1.49 1.21-2.7 2.7-2.7 1.49 0 2.7 1.21 2.7 2.7V22H17c1.1 0 2-.9 2-2v-4h1.5c1.38 0 2.5-1.12 2.5-2.5S21.88 11 20.5 11z"},void 0)}),void 0);var RMe=P.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24",strokeWidth:"0.1px"},{children:P.jsx("path",{d:"M3 13h2v-2H3v2zm0 4h2v-2H3v2zm2 4v-2H3c0 1.1.89 2 2 2zM3 9h2V7H3v2zm12 12h2v-2h-2v2zm4-18H9c-1.11 0-2 .9-2 2v10c0 1.1.89 2 2 2h10c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 12H9V5h10v10zm-8 6h2v-2h-2v2zm-4 0h2v-2H7v2z"},void 0)}),void 0);function kMe(){return RMe}var OMe=P.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:P.jsx("path",{d:"M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z"},void 0)}),void 0);function LMe(){return OMe}var FMe=P.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:P.jsx("path",{d:"M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"},void 0)}),void 0);function k5(){return FMe}var NMe=P.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:P.jsx("path",{d:"M11 18h2v-2h-2v2zm1-16C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm0-14c-2.21 0-4 1.79-4 4h2c0-1.1.9-2 2-2s2 .9 2 2c0 2-3 1.75-3 5h2c0-2.25 3-2.5 3-5 0-2.21-1.79-4-4-4z"},void 0)}),void 0);function Fl(){return NMe}var BMe=P.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:P.jsx("path",{d:"M12 5.69l5 4.5V18h-2v-6H9v6H7v-7.81l5-4.5M12 3L2 12h3v8h6v-6h2v6h6v-8h3L12 3z"},void 0)}),void 0);function O5(){return BMe}P.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:P.jsx("path",{d:"M19 19H5V5h7V3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2v-7h-2v7zM14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3h-7z"},void 0)}),void 0);var UMe=P.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:P.jsx("path",{d:"M19.5 9.5c-1.03 0-1.9.62-2.29 1.5h-2.92c-.39-.88-1.26-1.5-2.29-1.5s-1.9.62-2.29 1.5H6.79c-.39-.88-1.26-1.5-2.29-1.5C3.12 9.5 2 10.62 2 12s1.12 2.5 2.5 2.5c1.03 0 1.9-.62 2.29-1.5h2.92c.39.88 1.26 1.5 2.29 1.5s1.9-.62 2.29-1.5h2.92c.39.88 1.26 1.5 2.29 1.5 1.38 0 2.5-1.12 2.5-2.5s-1.12-2.5-2.5-2.5z"},void 0)}),void 0);function jMe(){return UMe}var zMe=P.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:P.jsx("path",{d:"M6 10c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm12 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm-6 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"},void 0)}),void 0);function sv(){return zMe}var VMe=P.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:P.jsx("path",{d:"M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"},void 0)}),void 0);function oZ(){return VMe}var HMe=P.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:P.jsx("path",{d:"M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"},void 0)}),void 0);function sZ(){return HMe}var GMe=P.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:P.jsx("path",{d:"M19 4H5c-1.11 0-2 .9-2 2v12c0 1.1.89 2 2 2h4v-2H5V8h14v10h-4v2h4c1.1 0 2-.9 2-2V6c0-1.1-.89-2-2-2zm-7 6l-4 4h3v6h2v-6h3l-4-4z"},void 0)}),void 0);function qMe(){return GMe}var $Me=P.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:P.jsx("path",{d:"M8 5v14l11-7z"},void 0)}),void 0);function uZ(){return $Me}var WMe=P.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:P.jsx("path",{d:"M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"},void 0)}),void 0);function L5(){return WMe}var XMe=P.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:P.jsx("path",{d:"M19 13H5v-2h14v2z"},void 0)}),void 0);function F5(){return XMe}var YMe=P.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:P.jsx("path",{d:"M13 3c-4.97 0-9 4.03-9 9H1l3.89 3.89.07.14L9 12H6c0-3.87 3.13-7 7-7s7 3.13 7 7-3.13 7-7 7c-1.93 0-3.68-.79-4.94-2.06l-1.42 1.42C8.27 19.99 10.51 21 13 21c4.97 0 9-4.03 9-9s-4.03-9-9-9zm-1 5v5l4.28 2.54.72-1.21-3.5-2.08V8H12z"},void 0)}),void 0);function N5(){return YMe}var KMe=P.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24",strokeWidth:"0.1px"},{children:P.jsx("path",{d:"M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7l-4-4zm2 16H5V5h11.17L19 7.83V19zm-7-7c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3zM6 6h9v4H6z"},void 0)}),void 0);function lZ(){return KMe}var QMe=P.jsxs("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:[P.jsx("circle",{cx:"7",cy:"14",r:"3"},void 0),P.jsx("circle",{cx:"11",cy:"6",r:"3"},void 0),P.jsx("circle",{cx:"16.6",cy:"17.6",r:"3"},void 0)]}),void 0);function ZMe(){return QMe}var JMe=P.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:P.jsx("path",{d:"M6 6h2v12H6zm3.5 6l8.5 6V6z"},void 0)}),void 0);function e5e(){return JMe}var t5e=P.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:P.jsx("path",{d:"M6 6h12v12H6z"},void 0)}),void 0);function cZ(){return t5e}var r5e=P.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:P.jsx("path",{d:"M4 6h16v2H4zm2-4h12v2H6zm14 8H4c-1.1 0-2 .9-2 2v8c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2v-8c0-1.1-.9-2-2-2zm0 10H4v-8h16v8zm-10-7.27v6.53L16 16z"},void 0)}),void 0);function n5e(){return r5e}var i5e=P.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:P.jsx("path",{d:"M6.99 11L3 15l3.99 4v-3H14v-2H6.99v-3zM21 9l-3.99-4v3H10v2h7.01v3L21 9z"},void 0)}),void 0);function a5e(){return i5e}var o5e=P.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:P.jsx("path",{d:"M3 17v2h6v-2H3zM3 5v2h10V5H3zm10 16v-2h8v-2h-8v-2h-2v6h2zM7 9v2H3v2h4v2h2V9H7zm14 4v-2H11v2h10zm-6-4h2V7h4V5h-4V3h-2v6z"},void 0)}),void 0);function uv(){return o5e}var s5e=P.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:P.jsx("path",{d:"M12 6c3.79 0 7.17 2.13 8.82 5.5-.59 1.22-1.42 2.27-2.41 3.12l1.41 1.41c1.39-1.23 2.49-2.77 3.18-4.53C21.27 7.11 17 4 12 4c-1.27 0-2.49.2-3.64.57l1.65 1.65C10.66 6.09 11.32 6 12 6zm-1.07 1.14L13 9.21c.57.25 1.03.71 1.28 1.28l2.07 2.07c.08-.34.14-.7.14-1.07C16.5 9.01 14.48 7 12 7c-.37 0-.72.05-1.07.14zM2.01 3.87l2.68 2.68C3.06 7.83 1.77 9.53 1 11.5 2.73 15.89 7 19 12 19c1.52 0 2.98-.29 4.32-.82l3.42 3.42 1.41-1.41L3.42 2.45 2.01 3.87zm7.5 7.5l2.61 2.61c-.04.01-.08.02-.12.02-1.38 0-2.5-1.12-2.5-2.5 0-.05.01-.08.01-.13zm-3.4-3.4l1.75 1.75c-.23.55-.36 1.15-.36 1.78 0 2.48 2.02 4.5 4.5 4.5.63 0 1.23-.13 1.77-.36l.98.98c-.88.24-1.8.38-2.75.38-3.79 0-7.17-2.13-8.82-5.5.7-1.43 1.72-2.61 2.93-3.53z"},void 0)}),void 0);function kv(){return s5e}var u5e=P.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:P.jsx("path",{d:"M12 6c3.79 0 7.17 2.13 8.82 5.5C19.17 14.87 15.79 17 12 17s-7.17-2.13-8.82-5.5C4.83 8.13 8.21 6 12 6m0-2C7 4 2.73 7.11 1 11.5 2.73 15.89 7 19 12 19s9.27-3.11 11-7.5C21.27 7.11 17 4 12 4zm0 5c1.38 0 2.5 1.12 2.5 2.5S13.38 14 12 14s-2.5-1.12-2.5-2.5S10.62 9 12 9m0-2c-2.48 0-4.5 2.02-4.5 4.5S9.52 16 12 16s4.5-2.02 4.5-4.5S14.48 7 12 7z"},void 0)}),void 0);function Ov(){return u5e}var l5e=P.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:P.jsx("path",{d:"M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z"},void 0)}),void 0);function c5e(){return l5e}var d5e=HIe,f5e=ZMe,U9=jMe,p5e=kMe,Pc=function(e){Fe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isExpanded:!!r.props.initialExpanded},r.headerClicked=function(){r.props.onHeaderClick?r.props.onHeaderClick():r.setState({isExpanded:!r.state.isExpanded})},r}return t.prototype.render=function(){var r=this.props.hideOffset?"msp-control-group-children":"msp-control-group-children msp-control-offset";return this.props.childrenClassName&&(r+=" "+this.props.childrenClassName),P.jsxs("div",E({className:"msp-control-group-wrapper",style:{position:"relative",marginTop:this.props.noTopMargin?0:void 0}},{children:[P.jsx("div",E({className:"msp-control-group-header",style:{marginLeft:this.props.headerLeftMargin},title:this.props.title},{children:P.jsxs(mr,E({onClick:this.headerClicked},{children:[!this.props.hideExpander&&P.jsx(sn,{svg:this.state.isExpanded?Qc:Kc},void 0),this.props.topRightIcon&&P.jsx(sn,{svg:this.props.topRightIcon,style:{position:"absolute",right:"2px",top:0}},void 0),P.jsx("b",{children:this.props.header},void 0)]}),void 0)}),void 0),this.state.isExpanded&&P.jsx("div",E({className:r,style:{display:this.state.isExpanded?"block":"none",maxHeight:this.props.maxHeight,overflow:"hidden",overflowY:"auto"}},{children:this.props.children}),void 0)]}),void 0)},t}(_e.Component);function j9(e){return e}var Fc=function(e){Fe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.input=_e.createRef(),r.delayHandle=void 0,r.pendingValue=void 0,r.state={originalValue:"",value:""},r.onBlur=function(){r.setState({value:""+r.state.originalValue}),r.props.onBlur&&r.props.onBlur()},r.raiseOnChange=function(){r.pendingValue!==void 0&&(r.props.onChange(r.pendingValue),r.pendingValue=void 0)},r.onChange=function(n){var i=n.target.value,a=r.props.isValid&&!r.props.isValid(i)||r.props.numeric&&Number.isNaN(+i);if(a){r.clearTimeout(),r.setState({value:i});return}if(r.props.numeric)r.setState({value:i},function(){return r.triggerChanged(i,+i)});else{var o=(r.props.toValue||j9)(i),s=(r.props.fromValue||j9)(o);r.setState({value:s},function(){return r.triggerChanged(s,o)})}},r.onKeyUp=function(n){(n.charCode===27||n.keyCode===27||n.key==="Escape")&&r.props.blurOnEscape&&r.input.current&&r.input.current.blur()},r.onKeyPress=function(n){(n.keyCode===13||n.charCode===13||n.key==="Enter")&&(r.isPending&&(r.clearTimeout(),r.raiseOnChange()),r.props.blurOnEnter&&r.input.current&&r.input.current.blur(),r.props.onEnter&&r.props.onEnter()),n.stopPropagation()},r}return Object.defineProperty(t.prototype,"isPending",{get:function(){return typeof this.delayHandle<"u"},enumerable:!1,configurable:!0}),t.prototype.clearTimeout=function(){this.isPending&&(clearTimeout(this.delayHandle),this.delayHandle=void 0)},t.prototype.triggerChanged=function(r,n){this.clearTimeout(),r!==this.state.originalValue&&(this.props.delayMs?(this.pendingValue=n,this.delayHandle=setTimeout(this.raiseOnChange,this.props.delayMs)):this.props.onChange(n))},t.getDerivedStateFromProps=function(r,n){var i=r.fromValue?r.fromValue(r.value):r.value;return i===n.originalValue?null:{originalValue:i,value:i}},t.prototype.render=function(){return P.jsx("input",{type:"text",className:this.props.className,style:this.props.style,ref:this.input,onBlur:this.onBlur,value:this.state.value,placeholder:this.props.placeholder,onChange:this.onChange,onKeyPress:this.props.onEnter||this.props.blurOnEnter||this.props.blurOnEscape?this.onKeyPress:void 0,onKeyDown:this.props.blurOnEscape?this.onKeyUp:void 0,disabled:!!this.props.isDisabled},void 0)},t}(_e.PureComponent),h5e=function(e){Fe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isExpanded:!1},r.toggleExpanded=function(){return r.setState({isExpanded:!r.state.isExpanded})},r}return t.prototype.render=function(){var r=this.props,n=r.label,i=r.pivot,a=r.controls;return P.jsxs(P.Fragment,{children:[P.jsx(Xs,E({label:P.jsxs(P.Fragment,{children:[n,P.jsx("button",E({className:"msp-btn-link msp-btn-icon msp-control-group-expander",onClick:this.toggleExpanded,title:(this.state.isExpanded?"Less":"More")+" options",style:{background:"transparent",textAlign:"left",padding:"0"}},{children:P.jsx(sn,{svg:this.state.isExpanded?F5:v0,style:{display:"inline-block"}},void 0)}),void 0)]},void 0),control:i},{children:this.props.colorStripe&&P.jsx("div",{className:"msp-expandable-group-color-stripe",style:{backgroundColor:at.toStyle(this.props.colorStripe)}},void 0)}),void 0),this.state.isExpanded&&P.jsx("div",E({className:"msp-control-offset"},{children:a}),void 0)]},void 0)},t}(_e.Component);function Tc(e){return P.jsxs("div",E({className:"msp-section-header"+(e.accent?" msp-transform-header-brand-"+e.accent:"")},{children:[e.icon&&P.jsx(sn,{svg:e.icon},void 0),e.title," ",P.jsx("small",{children:e.desc},void 0)]}),void 0)}function mr(e){var t="msp-btn";e.inline||(t+=" msp-btn-block"),e.noOverflow&&(t+=" msp-no-overflow"),e.flex&&(t+=" msp-flex-item"),(e.commit==="on"||e.commit)&&(t+=" msp-btn-commit msp-btn-commit-on"),e.commit==="off"&&(t+=" msp-btn-commit msp-btn-commit-off"),e.children||(t+=" msp-btn-childless"),e.className&&(t+=" "+e.className);var r=void 0;return e.flex&&(typeof e.flex=="number"?r={flex:"0 0 "+e.flex+"px",padding:0,maxWidth:e.flex+"px"}:typeof e.flex=="string"&&(r={flex:"0 0 "+e.flex,padding:0,maxWidth:e.flex})),e.style&&(r?Object.assign(r,e.style):r=e.style),P.jsxs("button",E({onClick:e.onClick,title:e.title,disabled:e.disabled,style:r,className:t,"data-id":e["data-id"],"data-color":e["data-color"],onContextMenu:e.onContextMenu,onMouseEnter:e.onMouseEnter,onMouseLeave:e.onMouseLeave},{children:[e.icon&&P.jsx(sn,{svg:e.icon},void 0),e.children]}),void 0)}function Ht(e){var t="msp-btn msp-btn-icon"+(e.small?"-small":"")+(e.className?" "+e.className:"");typeof e.toggleState<"u"&&(t+=" msp-btn-link-toggle-"+(e.toggleState?"on":"off")),e.transparent&&(t+=" msp-transparent-bg");var r=void 0;return e.flex&&(typeof e.flex=="boolean"?r={flex:"0 0 32px",padding:0}:typeof e.flex=="number"?r={flex:"0 0 "+e.flex+"px",padding:0,maxWidth:e.flex+"px"}:r={flex:"0 0 "+e.flex,padding:0,maxWidth:e.flex}),e.style&&(r?Object.assign(r,e.style):r=e.style),P.jsxs("button",E({className:t,onClick:e.onClick,title:e.title,disabled:e.disabled,"data-id":e["data-id"],style:r},{children:[e.svg&&P.jsx(sn,{svg:e.svg},void 0),e.extraContent]}),void 0)}var Ri=function(e){Fe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.onClick=function(n){n.currentTarget.blur(),r.props.toggle()},r}return t.prototype.render=function(){var r=this.props,n=r.label,i=r.isSelected?(r.className||"")+" msp-control-current":r.className;return P.jsx(mr,E({icon:this.props.icon,onClick:this.onClick,title:this.props.title,inline:this.props.inline,disabled:r.disabled,style:r.style,className:i},{children:n&&this.props.isSelected?P.jsx("b",{children:n},void 0):n}),void 0)},t}(_e.PureComponent),Uu=function(e){Fe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isExpanded:!!r.props.initiallyExpanded},r.toggleExpanded=function(){return r.setState({isExpanded:!r.state.isExpanded})},r}return t.prototype.render=function(){return P.jsxs(P.Fragment,{children:[P.jsx("div",E({className:"msp-control-group-header",style:{marginTop:this.props.marginTop!==void 0?this.props.marginTop:"1px",marginLeft:this.props.headerLeftMargin}},{children:P.jsxs("button",E({className:"msp-btn msp-form-control msp-btn-block",onClick:this.toggleExpanded,style:this.props.headerStyle},{children:[P.jsx(sn,{svg:this.state.isExpanded?Kc:Qc},void 0),this.props.header]}),void 0)}),void 0),this.state.isExpanded&&(this.props.noOffset?this.props.children:P.jsx("div",E({className:this.props.accent?"msp-accent-offset":"msp-control-offset"},{children:this.props.children}),void 0))]},void 0)},t}(_e.PureComponent);function Xs(e){var t="msp-control-row";return e.className&&(t+=" "+e.className),P.jsxs("div",E({className:t},{children:[P.jsx("span",E({className:"msp-control-row-label",title:e.title},{children:e.label}),void 0),P.jsx("div",E({className:"msp-control-row-ctrl"},{children:e.control}),void 0),e.children]}),void 0)}var dE=_e.createContext(void 0),gr=function(e){Fe(t,e);function t(r,n){var i=e.call(this,r)||this;return i.subs=void 0,i.plugin=n,i.init&&i.init(),i}return t.prototype.subscribe=function(r,n){typeof this.subs>"u"&&(this.subs=[]),this.subs.push(r.subscribe(n))},t.prototype.componentWillUnmount=function(){if(this.subs){for(var r=0,n=this.subs;r<n.length;r++){var i=n[r];i.unsubscribe()}this.subs=void 0}},t.contextType=dE,t}(_e.Component),Qi=function(e){Fe(t,e);function t(r,n){var i=e.call(this,r,n)||this;return i.subs=void 0,i.plugin=n,i.init&&i.init(),i}return t.prototype.subscribe=function(r,n){typeof this.subs>"u"&&(this.subs=[]),this.subs.push(r.subscribe(n))},t.prototype.componentWillUnmount=function(){if(this.subs){for(var r=0,n=this.subs;r<n.length;r++){var i=n[r];i.unsubscribe()}this.subs=void 0}},t.contextType=dE,t}(_e.PureComponent),g0=function(e){Fe(t,e);function t(r,n){var i=e.call(this,r,n)||this;i.toggleCollapsed=function(){i.setState({isCollapsed:!i.state.isCollapsed})};var a=i.defaultState();return r.initiallyCollapsed!==void 0&&(a.isCollapsed=r.initiallyCollapsed),r.header!==void 0&&(a.header=r.header),i.state=a,i}return t.prototype.componentDidUpdate=function(r){this.props.initiallyCollapsed!==void 0&&r.initiallyCollapsed!==this.props.initiallyCollapsed&&this.setState({isCollapsed:this.props.initiallyCollapsed})},t.prototype.render=function(){var r;if(this.state.isHidden)return null;var n=this.state.isCollapsed?"msp-transform-wrapper msp-transform-wrapper-collapsed":"msp-transform-wrapper";return P.jsxs("div",E({className:n},{children:[P.jsx("div",E({className:"msp-transform-header"},{children:P.jsxs(mr,E({icon:this.state.brand?void 0:this.state.isCollapsed?Qc:Kc,noOverflow:!0,onClick:this.toggleCollapsed,className:this.state.brand?"msp-transform-header-brand msp-transform-header-brand-"+this.state.brand.accent:void 0,title:"Click to "+(this.state.isCollapsed?"expand":"collapse")},{children:[P.jsx(sn,{svg:(r=this.state.brand)===null||r===void 0?void 0:r.svg,inline:!0},void 0),this.state.header,P.jsx("small",E({style:{margin:"0 6px"}},{children:this.state.isCollapsed?"":this.state.description}),void 0)]}),void 0)}),void 0),!this.state.isCollapsed&&this.renderControls()]}),void 0)},t}(gr),On;(function(e){function t(){return function(i){return r(i)}}e.factory=t;function r(i){var a;return a=function(){function o(s,u){this.data=s,this.id=mn.create22(),this.type=i,this.label=u&&u.label||i.name,this.description=u&&u.description}return o.is=function(s){return!!s&&i===s.type},o}(),a.type=i,a}e.create=r;function n(i,a){if(!i.tags)return!1;for(var o=0,s=i.tags;o<s.length;o++){var u=s[o];if(u===a)return!0}return!1}e.hasTag=n,e.Null={id:mn.create22(),type:{name:"Null",typeClass:"Null"},data:void 0,label:"Null"}})(On||(On={}));var vb;(function(e){function t(n){var i=n;return!!i&&!!i.transform&&!!i.parent&&!!i.status}e.is=t;function r(n,i){var a=typeof i=="string"?i:e.is(i)?i.transform.ref:i.ref;return n.cells.get(a)}e.resolve=r})(vb||(vb={}));var dZ=function(){function e(t,r){this.ref=t,this.state=r}return Object.defineProperty(e.prototype,"cell",{get:function(){var t;return(t=this.state)===null||t===void 0?void 0:t.cells.get(this.ref)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"obj",{get:function(){var t,r;return(r=(t=this.state)===null||t===void 0?void 0:t.cells.get(this.ref))===null||r===void 0?void 0:r.obj},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"data",{get:function(){var t;return(t=this.obj)===null||t===void 0?void 0:t.data},enumerable:!1,configurable:!0}),e.prototype.update=function(t,r){if(!this.state)throw new Error("To use update() from StateObjectSelector, 'state' must be defined.");return r||(r=this.state.build()),(r||this.state.build()).to(this).update(t),r},e.prototype.checkValid=function(){if(!this.state)throw new Error("Unassigned State.");var t=this.cell;if(!t)throw new Error("Not created at all. Did you await/then the corresponding state update?");if(t.status==="ok")return!0;throw t.status==="error"?new Error(t.errorText):t.obj===On.Null?new Error("The object is Null."):new Error("Unresolved. Did you await/then the corresponding state update?")},Object.defineProperty(e.prototype,"isOk",{get:function(){var t=this.cell;return t&&t.status==="ok"&&t.obj!==On.Null},enumerable:!1,configurable:!0}),e}(),Fi;(function(e){function t(i){var a;if(i)return typeof i=="string"?i:vb.is(i)?i.transform.ref:(a=i.cell)===null||a===void 0?void 0:a.transform.ref}e.resolveRef=t;function r(i,a){if(a)return vb.is(a)?a:typeof a=="string"?i.cells.get(a):a.cell}e.resolve=r;function n(i,a){var o=r(i,a);if(!(!o||!o.obj||o.status!=="ok"))return o}e.resolveAndCheck=n})(Fi||(Fi={}));var fZ={exports:{}};(function(e,t){(function(r,n){e.exports=n()})(fh,function(){var r=Array.prototype.slice;function n(T,N){N&&(T.prototype=Object.create(N.prototype)),T.prototype.constructor=T}function i(T){return u(T)?T:be(T)}n(a,i);function a(T){return l(T)?T:Ae(T)}n(o,i);function o(T){return c(T)?T:Se(T)}n(s,i);function s(T){return u(T)&&!d(T)?T:ie(T)}function u(T){return!!(T&&T[p])}function l(T){return!!(T&&T[v])}function c(T){return!!(T&&T[h])}function d(T){return l(T)||c(T)}function f(T){return!!(T&&T[m])}i.isIterable=u,i.isKeyed=l,i.isIndexed=c,i.isAssociative=d,i.isOrdered=f,i.Keyed=a,i.Indexed=o,i.Set=s;var p="@@__IMMUTABLE_ITERABLE__@@",v="@@__IMMUTABLE_KEYED__@@",h="@@__IMMUTABLE_INDEXED__@@",m="@@__IMMUTABLE_ORDERED__@@",g="delete",y=5,b=1<<y,S=b-1,x={},C={value:!1},w={value:!1};function A(T){return T.value=!1,T}function M(T){T&&(T.value=!0)}function D(){}function k(T,N){N=N||0;for(var Q=Math.max(0,T.length-N),re=new Array(Q),ae=0;ae<Q;ae++)re[ae]=T[ae+N];return re}function R(T){return T.size===void 0&&(T.size=T.__iterate(H)),T.size}function O(T,N){if(typeof N!="number"){var Q=N>>>0;if(""+Q!==N||Q===4294967295)return NaN;N=Q}return N<0?R(T)+N:N}function H(){return!0}function B(T,N,Q){return(T===0||Q!==void 0&&T<=-Q)&&(N===void 0||Q!==void 0&&N>=Q)}function j(T,N){return G(T,N,0)}function Y(T,N){return G(T,N,N)}function G(T,N,Q){return T===void 0?Q:T<0?Math.max(0,N+T):N===void 0?T:Math.min(N,T)}var $=0,q=1,ee=2,fe=typeof Symbol=="function"&&Symbol.iterator,W="@@iterator",X=fe||W;function U(T){this.next=T}U.prototype.toString=function(){return"[Iterator]"},U.KEYS=$,U.VALUES=q,U.ENTRIES=ee,U.prototype.inspect=U.prototype.toSource=function(){return this.toString()},U.prototype[X]=function(){return this};function z(T,N,Q,re){var ae=T===0?N:T===1?Q:[N,Q];return re?re.value=ae:re={value:ae,done:!1},re}function J(){return{value:void 0,done:!0}}function K(T){return!!le(T)}function Z(T){return T&&typeof T.next=="function"}function te(T){var N=le(T);return N&&N.call(T)}function le(T){var N=T&&(fe&&T[fe]||T[W]);if(typeof N=="function")return N}function ye(T){return T&&typeof T.length=="number"}n(be,i);function be(T){return T==null?Ve():u(T)?T.toSeq():Ne(T)}be.of=function(){return be(arguments)},be.prototype.toSeq=function(){return this},be.prototype.toString=function(){return this.__toString("Seq {","}")},be.prototype.cacheResult=function(){return!this._cache&&this.__iterateUncached&&(this._cache=this.entrySeq().toArray(),this.size=this._cache.length),this},be.prototype.__iterate=function(T,N){return it(this,T,N,!0)},be.prototype.__iterator=function(T,N){return ot(this,T,N,!0)},n(Ae,be);function Ae(T){return T==null?Ve().toKeyedSeq():u(T)?l(T)?T.toSeq():T.fromEntrySeq():Xe(T)}Ae.prototype.toKeyedSeq=function(){return this},n(Se,be);function Se(T){return T==null?Ve():u(T)?l(T)?T.entrySeq():T.toIndexedSeq():ct(T)}Se.of=function(){return Se(arguments)},Se.prototype.toIndexedSeq=function(){return this},Se.prototype.toString=function(){return this.__toString("Seq [","]")},Se.prototype.__iterate=function(T,N){return it(this,T,N,!1)},Se.prototype.__iterator=function(T,N){return ot(this,T,N,!1)},n(ie,be);function ie(T){return(T==null?Ve():u(T)?l(T)?T.entrySeq():T:ct(T)).toSetSeq()}ie.of=function(){return ie(arguments)},ie.prototype.toSetSeq=function(){return this},be.isSeq=Te,be.Keyed=Ae,be.Set=ie,be.Indexed=Se;var oe="@@__IMMUTABLE_SEQ__@@";be.prototype[oe]=!0,n(L,Se);function L(T){this._array=T,this.size=T.length}L.prototype.get=function(T,N){return this.has(T)?this._array[O(this,T)]:N},L.prototype.__iterate=function(T,N){for(var Q=this._array,re=Q.length-1,ae=0;ae<=re;ae++)if(T(Q[N?re-ae:ae],ae,this)===!1)return ae+1;return ae},L.prototype.__iterator=function(T,N){var Q=this._array,re=Q.length-1,ae=0;return new U(function(){return ae>re?J():z(T,ae,Q[N?re-ae++:ae++])})},n(V,Ae);function V(T){var N=Object.keys(T);this._object=T,this._keys=N,this.size=N.length}V.prototype.get=function(T,N){return N!==void 0&&!this.has(T)?N:this._object[T]},V.prototype.has=function(T){return this._object.hasOwnProperty(T)},V.prototype.__iterate=function(T,N){for(var Q=this._object,re=this._keys,ae=re.length-1,xe=0;xe<=ae;xe++){var Pe=re[N?ae-xe:xe];if(T(Q[Pe],Pe,this)===!1)return xe+1}return xe},V.prototype.__iterator=function(T,N){var Q=this._object,re=this._keys,ae=re.length-1,xe=0;return new U(function(){var Pe=re[N?ae-xe:xe];return xe++>ae?J():z(T,Pe,Q[Pe])})},V.prototype[m]=!0,n(he,Se);function he(T){this._iterable=T,this.size=T.length||T.size}he.prototype.__iterateUncached=function(T,N){if(N)return this.cacheResult().__iterate(T,N);var Q=this._iterable,re=te(Q),ae=0;if(Z(re))for(var xe;!(xe=re.next()).done&&T(xe.value,ae++,this)!==!1;);return ae},he.prototype.__iteratorUncached=function(T,N){if(N)return this.cacheResult().__iterator(T,N);var Q=this._iterable,re=te(Q);if(!Z(re))return new U(J);var ae=0;return new U(function(){var xe=re.next();return xe.done?xe:z(T,ae++,xe.value)})},n(we,Se);function we(T){this._iterator=T,this._iteratorCache=[]}we.prototype.__iterateUncached=function(T,N){if(N)return this.cacheResult().__iterate(T,N);for(var Q=this._iterator,re=this._iteratorCache,ae=0;ae<re.length;)if(T(re[ae],ae++,this)===!1)return ae;for(var xe;!(xe=Q.next()).done;){var Pe=xe.value;if(re[ae]=Pe,T(Pe,ae++,this)===!1)break}return ae},we.prototype.__iteratorUncached=function(T,N){if(N)return this.cacheResult().__iterator(T,N);var Q=this._iterator,re=this._iteratorCache,ae=0;return new U(function(){if(ae>=re.length){var xe=Q.next();if(xe.done)return xe;re[ae]=xe.value}return z(T,ae,re[ae++])})};function Te(T){return!!(T&&T[oe])}var ze;function Ve(){return ze||(ze=new L([]))}function Xe(T){var N=Array.isArray(T)?new L(T).fromEntrySeq():Z(T)?new we(T).fromEntrySeq():K(T)?new he(T).fromEntrySeq():typeof T=="object"?new V(T):void 0;if(!N)throw new TypeError("Expected Array or iterable object of [k, v] entries, or keyed object: "+T);return N}function ct(T){var N=Qe(T);if(!N)throw new TypeError("Expected Array or iterable object of values: "+T);return N}function Ne(T){var N=Qe(T)||typeof T=="object"&&new V(T);if(!N)throw new TypeError("Expected Array or iterable object of values, or keyed object: "+T);return N}function Qe(T){return ye(T)?new L(T):Z(T)?new we(T):K(T)?new he(T):void 0}function it(T,N,Q,re){var ae=T._cache;if(ae){for(var xe=ae.length-1,Pe=0;Pe<=xe;Pe++){var Ue=ae[Q?xe-Pe:Pe];if(N(Ue[1],re?Ue[0]:Pe,T)===!1)return Pe+1}return Pe}return T.__iterateUncached(N,Q)}function ot(T,N,Q,re){var ae=T._cache;if(ae){var xe=ae.length-1,Pe=0;return new U(function(){var Ue=ae[Q?xe-Pe:Pe];return Pe++>xe?J():z(N,re?Ue[0]:Pe-1,Ue[1])})}return T.__iteratorUncached(N,Q)}function dt(T,N){return N?ke(N,T,"",{"":T}):Me(T)}function ke(T,N,Q,re){return Array.isArray(N)?T.call(re,Q,Se(N).map(function(ae,xe){return ke(T,ae,xe,N)})):Ye(N)?T.call(re,Q,Ae(N).map(function(ae,xe){return ke(T,ae,xe,N)})):N}function Me(T){return Array.isArray(T)?Se(T).map(Me).toList():Ye(T)?Ae(T).map(Me).toMap():T}function Ye(T){return T&&(T.constructor===Object||T.constructor===void 0)}function tt(T,N){if(T===N||T!==T&&N!==N)return!0;if(!T||!N)return!1;if(typeof T.valueOf=="function"&&typeof N.valueOf=="function"){if(T=T.valueOf(),N=N.valueOf(),T===N||T!==T&&N!==N)return!0;if(!T||!N)return!1}return!!(typeof T.equals=="function"&&typeof N.equals=="function"&&T.equals(N))}function xt(T,N){if(T===N)return!0;if(!u(N)||T.size!==void 0&&N.size!==void 0&&T.size!==N.size||T.__hash!==void 0&&N.__hash!==void 0&&T.__hash!==N.__hash||l(T)!==l(N)||c(T)!==c(N)||f(T)!==f(N))return!1;if(T.size===0&&N.size===0)return!0;var Q=!d(T);if(f(T)){var re=T.entries();return N.every(function(et,st){var yt=re.next().value;return yt&&tt(yt[1],et)&&(Q||tt(yt[0],st))})&&re.next().done}var ae=!1;if(T.size===void 0)if(N.size===void 0)typeof T.cacheResult=="function"&&T.cacheResult();else{ae=!0;var xe=T;T=N,N=xe}var Pe=!0,Ue=N.__iterate(function(et,st){if(Q?!T.has(et):ae?!tt(et,T.get(st,x)):!tt(T.get(st,x),et))return Pe=!1,!1});return Pe&&T.size===Ue}n(ht,Se);function ht(T,N){if(!(this instanceof ht))return new ht(T,N);if(this._value=T,this.size=N===void 0?1/0:Math.max(0,N),this.size===0){if(ut)return ut;ut=this}}ht.prototype.toString=function(){return this.size===0?"Repeat []":"Repeat [ "+this._value+" "+this.size+" times ]"},ht.prototype.get=function(T,N){return this.has(T)?this._value:N},ht.prototype.includes=function(T){return tt(this._value,T)},ht.prototype.slice=function(T,N){var Q=this.size;return B(T,N,Q)?this:new ht(this._value,Y(N,Q)-j(T,Q))},ht.prototype.reverse=function(){return this},ht.prototype.indexOf=function(T){return tt(this._value,T)?0:-1},ht.prototype.lastIndexOf=function(T){return tt(this._value,T)?this.size:-1},ht.prototype.__iterate=function(T,N){for(var Q=0;Q<this.size;Q++)if(T(this._value,Q,this)===!1)return Q+1;return Q},ht.prototype.__iterator=function(T,N){var Q=this,re=0;return new U(function(){return re<Q.size?z(T,re++,Q._value):J()})},ht.prototype.equals=function(T){return T instanceof ht?tt(this._value,T._value):xt(T)};var ut;function pe(T,N){if(!T)throw new Error(N)}n(me,Se);function me(T,N,Q){if(!(this instanceof me))return new me(T,N,Q);if(pe(Q!==0,"Cannot step a Range by 0"),T=T||0,N===void 0&&(N=1/0),Q=Q===void 0?1:Math.abs(Q),N<T&&(Q=-Q),this._start=T,this._end=N,this._step=Q,this.size=Math.max(0,Math.ceil((N-T)/Q-1)+1),this.size===0){if(Ee)return Ee;Ee=this}}me.prototype.toString=function(){return this.size===0?"Range []":"Range [ "+this._start+"..."+this._end+(this._step!==1?" by "+this._step:"")+" ]"},me.prototype.get=function(T,N){return this.has(T)?this._start+O(this,T)*this._step:N},me.prototype.includes=function(T){var N=(T-this._start)/this._step;return N>=0&&N<this.size&&N===Math.floor(N)},me.prototype.slice=function(T,N){return B(T,N,this.size)?this:(T=j(T,this.size),N=Y(N,this.size),N<=T?new me(0,0):new me(this.get(T,this._end),this.get(N,this._end),this._step))},me.prototype.indexOf=function(T){var N=T-this._start;if(N%this._step===0){var Q=N/this._step;if(Q>=0&&Q<this.size)return Q}return-1},me.prototype.lastIndexOf=function(T){return this.indexOf(T)},me.prototype.__iterate=function(T,N){for(var Q=this.size-1,re=this._step,ae=N?this._start+Q*re:this._start,xe=0;xe<=Q;xe++){if(T(ae,xe,this)===!1)return xe+1;ae+=N?-re:re}return xe},me.prototype.__iterator=function(T,N){var Q=this.size-1,re=this._step,ae=N?this._start+Q*re:this._start,xe=0;return new U(function(){var Pe=ae;return ae+=N?-re:re,xe>Q?J():z(T,xe++,Pe)})},me.prototype.equals=function(T){return T instanceof me?this._start===T._start&&this._end===T._end&&this._step===T._step:xt(this,T)};var Ee;n(Ke,i);function Ke(){throw TypeError("Abstract")}n(gt,Ke);function gt(){}n(Pt,Ke);function Pt(){}n(Wt,Ke);function Wt(){}Ke.Keyed=gt,Ke.Indexed=Pt,Ke.Set=Wt;var lr=typeof Math.imul=="function"&&Math.imul(4294967295,2)===-2?Math.imul:function(N,Q){N=N|0,Q=Q|0;var re=N&65535,ae=Q&65535;return re*ae+((N>>>16)*ae+re*(Q>>>16)<<16>>>0)|0};function Tr(T){return T>>>1&1073741824|T&3221225471}function Yt(T){if(T===!1||T===null||T===void 0||typeof T.valueOf=="function"&&(T=T.valueOf(),T===!1||T===null||T===void 0))return 0;if(T===!0)return 1;var N=typeof T;if(N==="number"){if(T!==T||T===1/0)return 0;var Q=T|0;for(Q!==T&&(Q^=T*4294967295);T>4294967295;)T/=4294967295,Q^=T;return Tr(Q)}if(N==="string")return T.length>Fd?ai(T):ea(T);if(typeof T.hashCode=="function")return T.hashCode();if(N==="object")return ta(T);if(typeof T.toString=="function")return ea(T.toString());throw new Error("Value type "+N+" cannot be hashed.")}function ai(T){var N=Op[T];return N===void 0&&(N=ea(T),kp===A2&&(kp=0,Op={}),kp++,Op[T]=N),N}function ea(T){for(var N=0,Q=0;Q<T.length;Q++)N=31*N+T.charCodeAt(Q)|0;return Tr(N)}function ta(T){var N;if(nu&&(N=Dp.get(T),N!==void 0)||(N=T[lo],N!==void 0)||!Wu&&(N=T.propertyIsEnumerable&&T.propertyIsEnumerable[lo],N!==void 0||(N=Xl(T),N!==void 0)))return N;if(N=++Rp,Rp&1073741824&&(Rp=0),nu)Dp.set(T,N);else{if(Oo!==void 0&&Oo(T)===!1)throw new Error("Non-extensible objects are not allowed as keys.");if(Wu)Object.defineProperty(T,lo,{enumerable:!1,configurable:!1,writable:!1,value:N});else if(T.propertyIsEnumerable!==void 0&&T.propertyIsEnumerable===T.constructor.prototype.propertyIsEnumerable)T.propertyIsEnumerable=function(){return this.constructor.prototype.propertyIsEnumerable.apply(this,arguments)},T.propertyIsEnumerable[lo]=N;else if(T.nodeType!==void 0)T[lo]=N;else throw new Error("Unable to set a non-enumerable property on object.")}return N}var Oo=Object.isExtensible,Wu=function(){try{return Object.defineProperty({},"@",{}),!0}catch{return!1}}();function Xl(T){if(T&&T.nodeType>0)switch(T.nodeType){case 1:return T.uniqueID;case 9:return T.documentElement&&T.documentElement.uniqueID}}var nu=typeof WeakMap=="function",Dp;nu&&(Dp=new WeakMap);var Rp=0,lo="__immutablehash__";typeof Symbol=="function"&&(lo=Symbol(lo));var Fd=16,A2=255,kp=0,Op={};function Wa(T){pe(T!==1/0,"Cannot perform this action with an infinite size.")}n(Jr,gt);function Jr(T){return T==null?iu():mA(T)&&!f(T)?T:iu().withMutations(function(N){var Q=a(T);Wa(Q.size),Q.forEach(function(re,ae){return N.set(ae,re)})})}Jr.of=function(){var T=r.call(arguments,0);return iu().withMutations(function(N){for(var Q=0;Q<T.length;Q+=2){if(Q+1>=T.length)throw new Error("Missing value for key: "+T[Q]);N.set(T[Q],T[Q+1])}})},Jr.prototype.toString=function(){return this.__toString("Map {","}")},Jr.prototype.get=function(T,N){return this._root?this._root.get(0,void 0,T,N):N},Jr.prototype.set=function(T,N){return p6(this,T,N)},Jr.prototype.setIn=function(T,N){return this.updateIn(T,x,function(){return N})},Jr.prototype.remove=function(T){return p6(this,T,x)},Jr.prototype.deleteIn=function(T){return this.updateIn(T,function(){return x})},Jr.prototype.update=function(T,N,Q){return arguments.length===1?T(this):this.updateIn([T],N,Q)},Jr.prototype.updateIn=function(T,N,Q){Q||(Q=N,N=void 0);var re=y6(this,U6(T),N,Q);return re===x?void 0:re},Jr.prototype.clear=function(){return this.size===0?this:this.__ownerID?(this.size=0,this._root=null,this.__hash=void 0,this.__altered=!0,this):iu()},Jr.prototype.merge=function(){return P2(this,void 0,arguments)},Jr.prototype.mergeWith=function(T){var N=r.call(arguments,1);return P2(this,T,N)},Jr.prototype.mergeIn=function(T){var N=r.call(arguments,1);return this.updateIn(T,iu(),function(Q){return typeof Q.merge=="function"?Q.merge.apply(Q,N):N[N.length-1]})},Jr.prototype.mergeDeep=function(){return P2(this,v6,arguments)},Jr.prototype.mergeDeepWith=function(T){var N=r.call(arguments,1);return P2(this,m6(T),N)},Jr.prototype.mergeDeepIn=function(T){var N=r.call(arguments,1);return this.updateIn(T,iu(),function(Q){return typeof Q.mergeDeep=="function"?Q.mergeDeep.apply(Q,N):N[N.length-1]})},Jr.prototype.sort=function(T){return Ci(rm(this,T))},Jr.prototype.sortBy=function(T,N){return Ci(rm(this,N,T))},Jr.prototype.withMutations=function(T){var N=this.asMutable();return T(N),N.wasAltered()?N.__ensureOwner(this.__ownerID):this},Jr.prototype.asMutable=function(){return this.__ownerID?this:this.__ensureOwner(new D)},Jr.prototype.asImmutable=function(){return this.__ensureOwner()},Jr.prototype.wasAltered=function(){return this.__altered},Jr.prototype.__iterator=function(T,N){return new gA(this,T,N)},Jr.prototype.__iterate=function(T,N){var Q=this,re=0;return this._root&&this._root.iterate(function(ae){return re++,T(ae[1],ae[0],Q)},N),re},Jr.prototype.__ensureOwner=function(T){return T===this.__ownerID?this:T?bA(this.size,this._root,T,this.__hash):(this.__ownerID=T,this.__altered=!1,this)};function mA(T){return!!(T&&T[c6])}Jr.isMap=mA;var c6="@@__IMMUTABLE_MAP__@@",$r=Jr.prototype;$r[c6]=!0,$r[g]=$r.remove,$r.removeIn=$r.deleteIn;function O0(T,N){this.ownerID=T,this.entries=N}O0.prototype.get=function(T,N,Q,re){for(var ae=this.entries,xe=0,Pe=ae.length;xe<Pe;xe++)if(tt(Q,ae[xe][0]))return ae[xe][1];return re},O0.prototype.update=function(T,N,Q,re,ae,xe,Pe){for(var Ue=ae===x,et=this.entries,st=0,yt=et.length;st<yt&&!tt(re,et[st][0]);st++);var Lt=st<yt;if(Lt?et[st][1]===ae:Ue)return this;if(M(Pe),(Ue||!Lt)&&M(xe),!(Ue&&et.length===1)){if(!Lt&&!Ue&&et.length>=qoe)return joe(T,et,re,ae);var Gt=T&&T===this.ownerID,_r=Gt?et:k(et);return Lt?Ue?st===yt-1?_r.pop():_r[st]=_r.pop():_r[st]=[re,ae]:_r.push([re,ae]),Gt?(this.entries=_r,this):new O0(T,_r)}};function Kv(T,N,Q){this.ownerID=T,this.bitmap=N,this.nodes=Q}Kv.prototype.get=function(T,N,Q,re){N===void 0&&(N=Yt(Q));var ae=1<<((T===0?N:N>>>T)&S),xe=this.bitmap;return xe&ae?this.nodes[b6(xe&ae-1)].get(T+y,N,Q,re):re},Kv.prototype.update=function(T,N,Q,re,ae,xe,Pe){Q===void 0&&(Q=Yt(re));var Ue=(N===0?Q:Q>>>N)&S,et=1<<Ue,st=this.bitmap,yt=(st&et)!==0;if(!yt&&ae===x)return this;var Lt=b6(st&et-1),Gt=this.nodes,_r=yt?Gt[Lt]:void 0,Hr=xA(_r,T,N+y,Q,re,ae,xe,Pe);if(Hr===_r)return this;if(!yt&&Hr&&Gt.length>=$oe)return Voe(T,Gt,st,Ue,Hr);if(yt&&!Hr&&Gt.length===2&&h6(Gt[Lt^1]))return Gt[Lt^1];if(yt&&Hr&&Gt.length===1&&h6(Hr))return Hr;var Kn=T&&T===this.ownerID,au=yt?Hr?st:st^et:st|et,Qu=yt?Hr?x6(Gt,Lt,Hr,Kn):Goe(Gt,Lt,Kn):Hoe(Gt,Lt,Hr,Kn);return Kn?(this.bitmap=au,this.nodes=Qu,this):new Kv(T,au,Qu)};function L0(T,N,Q){this.ownerID=T,this.count=N,this.nodes=Q}L0.prototype.get=function(T,N,Q,re){N===void 0&&(N=Yt(Q));var ae=(T===0?N:N>>>T)&S,xe=this.nodes[ae];return xe?xe.get(T+y,N,Q,re):re},L0.prototype.update=function(T,N,Q,re,ae,xe,Pe){Q===void 0&&(Q=Yt(re));var Ue=(N===0?Q:Q>>>N)&S,et=ae===x,st=this.nodes,yt=st[Ue];if(et&&!yt)return this;var Lt=xA(yt,T,N+y,Q,re,ae,xe,Pe);if(Lt===yt)return this;var Gt=this.count;if(!yt)Gt++;else if(!Lt&&(Gt--,Gt<Woe))return zoe(T,st,Gt,Ue);var _r=T&&T===this.ownerID,Hr=x6(st,Ue,Lt,_r);return _r?(this.count=Gt,this.nodes=Hr,this):new L0(T,Gt,Hr)};function Qv(T,N,Q){this.ownerID=T,this.keyHash=N,this.entries=Q}Qv.prototype.get=function(T,N,Q,re){for(var ae=this.entries,xe=0,Pe=ae.length;xe<Pe;xe++)if(tt(Q,ae[xe][0]))return ae[xe][1];return re},Qv.prototype.update=function(T,N,Q,re,ae,xe,Pe){Q===void 0&&(Q=Yt(re));var Ue=ae===x;if(Q!==this.keyHash)return Ue?this:(M(Pe),M(xe),SA(this,T,N,Q,[re,ae]));for(var et=this.entries,st=0,yt=et.length;st<yt&&!tt(re,et[st][0]);st++);var Lt=st<yt;if(Lt?et[st][1]===ae:Ue)return this;if(M(Pe),(Ue||!Lt)&&M(xe),Ue&&yt===2)return new Yl(T,this.keyHash,et[st^1]);var Gt=T&&T===this.ownerID,_r=Gt?et:k(et);return Lt?Ue?st===yt-1?_r.pop():_r[st]=_r.pop():_r[st]=[re,ae]:_r.push([re,ae]),Gt?(this.entries=_r,this):new Qv(T,this.keyHash,_r)};function Yl(T,N,Q){this.ownerID=T,this.keyHash=N,this.entry=Q}Yl.prototype.get=function(T,N,Q,re){return tt(Q,this.entry[0])?this.entry[1]:re},Yl.prototype.update=function(T,N,Q,re,ae,xe,Pe){var Ue=ae===x,et=tt(re,this.entry[0]);if(et?ae===this.entry[1]:Ue)return this;if(M(Pe),Ue){M(xe);return}return et?T&&T===this.ownerID?(this.entry[1]=ae,this):new Yl(T,this.keyHash,[re,ae]):(M(xe),SA(this,T,N,Yt(re),[re,ae]))},O0.prototype.iterate=Qv.prototype.iterate=function(T,N){for(var Q=this.entries,re=0,ae=Q.length-1;re<=ae;re++)if(T(Q[N?ae-re:re])===!1)return!1},Kv.prototype.iterate=L0.prototype.iterate=function(T,N){for(var Q=this.nodes,re=0,ae=Q.length-1;re<=ae;re++){var xe=Q[N?ae-re:re];if(xe&&xe.iterate(T,N)===!1)return!1}},Yl.prototype.iterate=function(T,N){return T(this.entry)},n(gA,U);function gA(T,N,Q){this._type=N,this._reverse=Q,this._stack=T._root&&d6(T._root)}gA.prototype.next=function(){for(var T=this._type,N=this._stack;N;){var Q=N.node,re=N.index++,ae;if(Q.entry){if(re===0)return yA(T,Q.entry)}else if(Q.entries){if(ae=Q.entries.length-1,re<=ae)return yA(T,Q.entries[this._reverse?ae-re:re])}else if(ae=Q.nodes.length-1,re<=ae){var xe=Q.nodes[this._reverse?ae-re:re];if(xe){if(xe.entry)return yA(T,xe.entry);N=this._stack=d6(xe,N)}continue}N=this._stack=this._stack.__prev}return J()};function yA(T,N){return z(T,N[0],N[1])}function d6(T,N){return{node:T,index:0,__prev:N}}function bA(T,N,Q,re){var ae=Object.create($r);return ae.size=T,ae._root=N,ae.__ownerID=Q,ae.__hash=re,ae.__altered=!1,ae}var f6;function iu(){return f6||(f6=bA(0))}function p6(T,N,Q){var re,ae;if(T._root){var xe=A(C),Pe=A(w);if(re=xA(T._root,T.__ownerID,0,void 0,N,Q,xe,Pe),!Pe.value)return T;ae=T.size+(xe.value?Q===x?-1:1:0)}else{if(Q===x)return T;ae=1,re=new O0(T.__ownerID,[[N,Q]])}return T.__ownerID?(T.size=ae,T._root=re,T.__hash=void 0,T.__altered=!0,T):re?bA(ae,re):iu()}function xA(T,N,Q,re,ae,xe,Pe,Ue){return T?T.update(N,Q,re,ae,xe,Pe,Ue):xe===x?T:(M(Ue),M(Pe),new Yl(N,re,[ae,xe]))}function h6(T){return T.constructor===Yl||T.constructor===Qv}function SA(T,N,Q,re,ae){if(T.keyHash===re)return new Qv(N,re,[T.entry,ae]);var xe=(Q===0?T.keyHash:T.keyHash>>>Q)&S,Pe=(Q===0?re:re>>>Q)&S,Ue,et=xe===Pe?[SA(T,N,Q+y,re,ae)]:(Ue=new Yl(N,re,ae),xe<Pe?[T,Ue]:[Ue,T]);return new Kv(N,1<<xe|1<<Pe,et)}function joe(T,N,Q,re){T||(T=new D);for(var ae=new Yl(T,Yt(Q),[Q,re]),xe=0;xe<N.length;xe++){var Pe=N[xe];ae=ae.update(T,0,void 0,Pe[0],Pe[1])}return ae}function zoe(T,N,Q,re){for(var ae=0,xe=0,Pe=new Array(Q),Ue=0,et=1,st=N.length;Ue<st;Ue++,et<<=1){var yt=N[Ue];yt!==void 0&&Ue!==re&&(ae|=et,Pe[xe++]=yt)}return new Kv(T,ae,Pe)}function Voe(T,N,Q,re,ae){for(var xe=0,Pe=new Array(b),Ue=0;Q!==0;Ue++,Q>>>=1)Pe[Ue]=Q&1?N[xe++]:void 0;return Pe[re]=ae,new L0(T,xe+1,Pe)}function P2(T,N,Q){for(var re=[],ae=0;ae<Q.length;ae++){var xe=Q[ae],Pe=a(xe);u(xe)||(Pe=Pe.map(function(Ue){return dt(Ue)})),re.push(Pe)}return g6(T,N,re)}function v6(T,N,Q){return T&&T.mergeDeep&&u(N)?T.mergeDeep(N):tt(T,N)?T:N}function m6(T){return function(N,Q,re){if(N&&N.mergeDeepWith&&u(Q))return N.mergeDeepWith(T,Q);var ae=T(N,Q,re);return tt(N,ae)?N:ae}}function g6(T,N,Q){return Q=Q.filter(function(re){return re.size!==0}),Q.length===0?T:T.size===0&&!T.__ownerID&&Q.length===1?T.constructor(Q[0]):T.withMutations(function(re){for(var ae=N?function(Pe,Ue){re.update(Ue,x,function(et){return et===x?Pe:N(et,Pe,Ue)})}:function(Pe,Ue){re.set(Ue,Pe)},xe=0;xe<Q.length;xe++)Q[xe].forEach(ae)})}function y6(T,N,Q,re){var ae=T===x,xe=N.next();if(xe.done){var Pe=ae?Q:T,Ue=re(Pe);return Ue===Pe?T:Ue}pe(ae||T&&T.set,"invalid keyPath");var et=xe.value,st=ae?x:T.get(et,x),yt=y6(st,N,Q,re);return yt===st?T:yt===x?T.remove(et):(ae?iu():T).set(et,yt)}function b6(T){return T=T-(T>>1&1431655765),T=(T&858993459)+(T>>2&858993459),T=T+(T>>4)&252645135,T=T+(T>>8),T=T+(T>>16),T&127}function x6(T,N,Q,re){var ae=re?T:k(T);return ae[N]=Q,ae}function Hoe(T,N,Q,re){var ae=T.length+1;if(re&&N+1===ae)return T[N]=Q,T;for(var xe=new Array(ae),Pe=0,Ue=0;Ue<ae;Ue++)Ue===N?(xe[Ue]=Q,Pe=-1):xe[Ue]=T[Ue+Pe];return xe}function Goe(T,N,Q){var re=T.length-1;if(Q&&N===re)return T.pop(),T;for(var ae=new Array(re),xe=0,Pe=0;Pe<re;Pe++)Pe===N&&(xe=1),ae[Pe]=T[Pe+xe];return ae}var qoe=b/4,$oe=b/2,Woe=b/4;n(jn,Pt);function jn(T){var N=CA();if(T==null)return N;if(S6(T))return T;var Q=o(T),re=Q.size;return re===0?N:(Wa(re),re>0&&re<b?N0(0,re,y,null,new Nd(Q.toArray())):N.withMutations(function(ae){ae.setSize(re),Q.forEach(function(xe,Pe){return ae.set(Pe,xe)})}))}jn.of=function(){return this(arguments)},jn.prototype.toString=function(){return this.__toString("List [","]")},jn.prototype.get=function(T,N){if(T=O(this,T),T>=0&&T<this.size){T+=this._origin;var Q=E6(this,T);return Q&&Q.array[T&S]}return N},jn.prototype.set=function(T,N){return Xoe(this,T,N)},jn.prototype.remove=function(T){return this.has(T)?T===0?this.shift():T===this.size-1?this.pop():this.splice(T,1):this},jn.prototype.insert=function(T,N){return this.splice(T,0,N)},jn.prototype.clear=function(){return this.size===0?this:this.__ownerID?(this.size=this._origin=this._capacity=0,this._level=y,this._root=this._tail=null,this.__hash=void 0,this.__altered=!0,this):CA()},jn.prototype.push=function(){var T=arguments,N=this.size;return this.withMutations(function(Q){Bd(Q,0,N+T.length);for(var re=0;re<T.length;re++)Q.set(N+re,T[re])})},jn.prototype.pop=function(){return Bd(this,0,-1)},jn.prototype.unshift=function(){var T=arguments;return this.withMutations(function(N){Bd(N,-T.length);for(var Q=0;Q<T.length;Q++)N.set(Q,T[Q])})},jn.prototype.shift=function(){return Bd(this,1)},jn.prototype.merge=function(){return T2(this,void 0,arguments)},jn.prototype.mergeWith=function(T){var N=r.call(arguments,1);return T2(this,T,N)},jn.prototype.mergeDeep=function(){return T2(this,v6,arguments)},jn.prototype.mergeDeepWith=function(T){var N=r.call(arguments,1);return T2(this,m6(T),N)},jn.prototype.setSize=function(T){return Bd(this,0,T)},jn.prototype.slice=function(T,N){var Q=this.size;return B(T,N,Q)?this:Bd(this,j(T,Q),Y(N,Q))},jn.prototype.__iterator=function(T,N){var Q=0,re=_6(this,N);return new U(function(){var ae=re();return ae===F0?J():z(T,Q++,ae)})},jn.prototype.__iterate=function(T,N){for(var Q=0,re=_6(this,N),ae;(ae=re())!==F0&&T(ae,Q++,this)!==!1;);return Q},jn.prototype.__ensureOwner=function(T){return T===this.__ownerID?this:T?N0(this._origin,this._capacity,this._level,this._root,this._tail,T,this.__hash):(this.__ownerID=T,this)};function S6(T){return!!(T&&T[C6])}jn.isList=S6;var C6="@@__IMMUTABLE_LIST__@@",Xa=jn.prototype;Xa[C6]=!0,Xa[g]=Xa.remove,Xa.setIn=$r.setIn,Xa.deleteIn=Xa.removeIn=$r.removeIn,Xa.update=$r.update,Xa.updateIn=$r.updateIn,Xa.mergeIn=$r.mergeIn,Xa.mergeDeepIn=$r.mergeDeepIn,Xa.withMutations=$r.withMutations,Xa.asMutable=$r.asMutable,Xa.asImmutable=$r.asImmutable,Xa.wasAltered=$r.wasAltered;function Nd(T,N){this.array=T,this.ownerID=N}Nd.prototype.removeBefore=function(T,N,Q){if(Q===N?1<<N:this.array.length===0)return this;var re=Q>>>N&S;if(re>=this.array.length)return new Nd([],T);var ae=re===0,xe;if(N>0){var Pe=this.array[re];if(xe=Pe&&Pe.removeBefore(T,N-y,Q),xe===Pe&&ae)return this}if(ae&&!xe)return this;var Ue=Zv(this,T);if(!ae)for(var et=0;et<re;et++)Ue.array[et]=void 0;return xe&&(Ue.array[re]=xe),Ue},Nd.prototype.removeAfter=function(T,N,Q){if(Q===(N?1<<N:0)||this.array.length===0)return this;var re=Q-1>>>N&S;if(re>=this.array.length)return this;var ae;if(N>0){var xe=this.array[re];if(ae=xe&&xe.removeAfter(T,N-y,Q),ae===xe&&re===this.array.length-1)return this}var Pe=Zv(this,T);return Pe.array.splice(re+1),ae&&(Pe.array[re]=ae),Pe};var F0={};function _6(T,N){var Q=T._origin,re=T._capacity,ae=B0(re),xe=T._tail;return Pe(T._root,T._level,0);function Pe(st,yt,Lt){return yt===0?Ue(st,Lt):et(st,yt,Lt)}function Ue(st,yt){var Lt=yt===ae?xe&&xe.array:st&&st.array,Gt=yt>Q?0:Q-yt,_r=re-yt;return _r>b&&(_r=b),function(){if(Gt===_r)return F0;var Hr=N?--_r:Gt++;return Lt&&Lt[Hr]}}function et(st,yt,Lt){var Gt,_r=st&&st.array,Hr=Lt>Q?0:Q-Lt>>yt,Kn=(re-Lt>>yt)+1;return Kn>b&&(Kn=b),function(){do{if(Gt){var au=Gt();if(au!==F0)return au;Gt=null}if(Hr===Kn)return F0;var Qu=N?--Kn:Hr++;Gt=Pe(_r&&_r[Qu],yt-y,Lt+(Qu<<yt))}while(!0)}}}function N0(T,N,Q,re,ae,xe,Pe){var Ue=Object.create(Xa);return Ue.size=N-T,Ue._origin=T,Ue._capacity=N,Ue._level=Q,Ue._root=re,Ue._tail=ae,Ue.__ownerID=xe,Ue.__hash=Pe,Ue.__altered=!1,Ue}var w6;function CA(){return w6||(w6=N0(0,0,y))}function Xoe(T,N,Q){if(N=O(T,N),N!==N)return T;if(N>=T.size||N<0)return T.withMutations(function(Pe){N<0?Bd(Pe,N).set(0,Q):Bd(Pe,0,N+1).set(N,Q)});N+=T._origin;var re=T._tail,ae=T._root,xe=A(w);return N>=B0(T._capacity)?re=_A(re,T.__ownerID,0,N,Q,xe):ae=_A(ae,T.__ownerID,T._level,N,Q,xe),xe.value?T.__ownerID?(T._root=ae,T._tail=re,T.__hash=void 0,T.__altered=!0,T):N0(T._origin,T._capacity,T._level,ae,re):T}function _A(T,N,Q,re,ae,xe){var Pe=re>>>Q&S,Ue=T&&Pe<T.array.length;if(!Ue&&ae===void 0)return T;var et;if(Q>0){var st=T&&T.array[Pe],yt=_A(st,N,Q-y,re,ae,xe);return yt===st?T:(et=Zv(T,N),et.array[Pe]=yt,et)}return Ue&&T.array[Pe]===ae?T:(M(xe),et=Zv(T,N),ae===void 0&&Pe===et.array.length-1?et.array.pop():et.array[Pe]=ae,et)}function Zv(T,N){return N&&T&&N===T.ownerID?T:new Nd(T?T.array.slice():[],N)}function E6(T,N){if(N>=B0(T._capacity))return T._tail;if(N<1<<T._level+y){for(var Q=T._root,re=T._level;Q&&re>0;)Q=Q.array[N>>>re&S],re-=y;return Q}}function Bd(T,N,Q){N!==void 0&&(N=N|0),Q!==void 0&&(Q=Q|0);var re=T.__ownerID||new D,ae=T._origin,xe=T._capacity,Pe=ae+N,Ue=Q===void 0?xe:Q<0?xe+Q:ae+Q;if(Pe===ae&&Ue===xe)return T;if(Pe>=Ue)return T.clear();for(var et=T._level,st=T._root,yt=0;Pe+yt<0;)st=new Nd(st&&st.array.length?[void 0,st]:[],re),et+=y,yt+=1<<et;yt&&(Pe+=yt,ae+=yt,Ue+=yt,xe+=yt);for(var Lt=B0(xe),Gt=B0(Ue);Gt>=1<<et+y;)st=new Nd(st&&st.array.length?[st]:[],re),et+=y;var _r=T._tail,Hr=Gt<Lt?E6(T,Ue-1):Gt>Lt?new Nd([],re):_r;if(_r&&Gt>Lt&&Pe<xe&&_r.array.length){st=Zv(st,re);for(var Kn=st,au=et;au>y;au-=y){var Qu=Lt>>>au&S;Kn=Kn.array[Qu]=Zv(Kn.array[Qu],re)}Kn.array[Lt>>>y&S]=_r}if(Ue<xe&&(Hr=Hr&&Hr.removeAfter(re,0,Ue)),Pe>=Gt)Pe-=Gt,Ue-=Gt,et=y,st=null,Hr=Hr&&Hr.removeBefore(re,0,Pe);else if(Pe>ae||Gt<Lt){for(yt=0;st;){var L2=Pe>>>et&S;if(L2!==Gt>>>et&S)break;L2&&(yt+=(1<<et)*L2),et-=y,st=st.array[L2]}st&&Pe>ae&&(st=st.removeBefore(re,et,Pe-yt)),st&&Gt<Lt&&(st=st.removeAfter(re,et,Gt-yt)),yt&&(Pe-=yt,Ue-=yt)}return T.__ownerID?(T.size=Ue-Pe,T._origin=Pe,T._capacity=Ue,T._level=et,T._root=st,T._tail=Hr,T.__hash=void 0,T.__altered=!0,T):N0(Pe,Ue,et,st,Hr)}function T2(T,N,Q){for(var re=[],ae=0,xe=0;xe<Q.length;xe++){var Pe=Q[xe],Ue=o(Pe);Ue.size>ae&&(ae=Ue.size),u(Pe)||(Ue=Ue.map(function(et){return dt(et)})),re.push(Ue)}return ae>T.size&&(T=T.setSize(ae)),g6(T,N,re)}function B0(T){return T<b?0:T-1>>>y<<y}n(Ci,Jr);function Ci(T){return T==null?I2():A6(T)?T:I2().withMutations(function(N){var Q=a(T);Wa(Q.size),Q.forEach(function(re,ae){return N.set(ae,re)})})}Ci.of=function(){return this(arguments)},Ci.prototype.toString=function(){return this.__toString("OrderedMap {","}")},Ci.prototype.get=function(T,N){var Q=this._map.get(T);return Q!==void 0?this._list.get(Q)[1]:N},Ci.prototype.clear=function(){return this.size===0?this:this.__ownerID?(this.size=0,this._map.clear(),this._list.clear(),this):I2()},Ci.prototype.set=function(T,N){return T6(this,T,N)},Ci.prototype.remove=function(T){return T6(this,T,x)},Ci.prototype.wasAltered=function(){return this._map.wasAltered()||this._list.wasAltered()},Ci.prototype.__iterate=function(T,N){var Q=this;return this._list.__iterate(function(re){return re&&T(re[1],re[0],Q)},N)},Ci.prototype.__iterator=function(T,N){return this._list.fromEntrySeq().__iterator(T,N)},Ci.prototype.__ensureOwner=function(T){if(T===this.__ownerID)return this;var N=this._map.__ensureOwner(T),Q=this._list.__ensureOwner(T);return T?wA(N,Q,T,this.__hash):(this.__ownerID=T,this._map=N,this._list=Q,this)};function A6(T){return mA(T)&&f(T)}Ci.isOrderedMap=A6,Ci.prototype[m]=!0,Ci.prototype[g]=Ci.prototype.remove;function wA(T,N,Q,re){var ae=Object.create(Ci.prototype);return ae.size=T?T.size:0,ae._map=T,ae._list=N,ae.__ownerID=Q,ae.__hash=re,ae}var P6;function I2(){return P6||(P6=wA(iu(),CA()))}function T6(T,N,Q){var re=T._map,ae=T._list,xe=re.get(N),Pe=xe!==void 0,Ue,et;if(Q===x){if(!Pe)return T;ae.size>=b&&ae.size>=re.size*2?(et=ae.filter(function(st,yt){return st!==void 0&&xe!==yt}),Ue=et.toKeyedSeq().map(function(st){return st[0]}).flip().toMap(),T.__ownerID&&(Ue.__ownerID=et.__ownerID=T.__ownerID)):(Ue=re.remove(N),et=xe===ae.size-1?ae.pop():ae.set(xe,void 0))}else if(Pe){if(Q===ae.get(xe)[1])return T;Ue=re,et=ae.set(xe,[N,Q])}else Ue=re.set(N,ae.size),et=ae.set(ae.size,[N,Q]);return T.__ownerID?(T.size=Ue.size,T._map=Ue,T._list=et,T.__hash=void 0,T):wA(Ue,et)}n(ms,Ae);function ms(T,N){this._iter=T,this._useKeys=N,this.size=T.size}ms.prototype.get=function(T,N){return this._iter.get(T,N)},ms.prototype.has=function(T){return this._iter.has(T)},ms.prototype.valueSeq=function(){return this._iter.valueSeq()},ms.prototype.reverse=function(){var T=this,N=EA(this,!0);return this._useKeys||(N.valueSeq=function(){return T._iter.toSeq().reverse()}),N},ms.prototype.map=function(T,N){var Q=this,re=M6(this,T,N);return this._useKeys||(re.valueSeq=function(){return Q._iter.toSeq().map(T,N)}),re},ms.prototype.__iterate=function(T,N){var Q=this,re;return this._iter.__iterate(this._useKeys?function(ae,xe){return T(ae,xe,Q)}:(re=N?F6(this):0,function(ae){return T(ae,N?--re:re++,Q)}),N)},ms.prototype.__iterator=function(T,N){if(this._useKeys)return this._iter.__iterator(T,N);var Q=this._iter.__iterator(q,N),re=N?F6(this):0;return new U(function(){var ae=Q.next();return ae.done?ae:z(T,N?--re:re++,ae.value,ae)})},ms.prototype[m]=!0,n(Jv,Se);function Jv(T){this._iter=T,this.size=T.size}Jv.prototype.includes=function(T){return this._iter.includes(T)},Jv.prototype.__iterate=function(T,N){var Q=this,re=0;return this._iter.__iterate(function(ae){return T(ae,re++,Q)},N)},Jv.prototype.__iterator=function(T,N){var Q=this._iter.__iterator(q,N),re=0;return new U(function(){var ae=Q.next();return ae.done?ae:z(T,re++,ae.value,ae)})},n(em,ie);function em(T){this._iter=T,this.size=T.size}em.prototype.has=function(T){return this._iter.includes(T)},em.prototype.__iterate=function(T,N){var Q=this;return this._iter.__iterate(function(re){return T(re,re,Q)},N)},em.prototype.__iterator=function(T,N){var Q=this._iter.__iterator(q,N);return new U(function(){var re=Q.next();return re.done?re:z(T,re.value,re.value,re)})},n(tm,Ae);function tm(T){this._iter=T,this.size=T.size}tm.prototype.entrySeq=function(){return this._iter.toSeq()},tm.prototype.__iterate=function(T,N){var Q=this;return this._iter.__iterate(function(re){if(re){L6(re);var ae=u(re);return T(ae?re.get(1):re[1],ae?re.get(0):re[0],Q)}},N)},tm.prototype.__iterator=function(T,N){var Q=this._iter.__iterator(q,N);return new U(function(){for(;;){var re=Q.next();if(re.done)return re;var ae=re.value;if(ae){L6(ae);var xe=u(ae);return z(T,xe?ae.get(0):ae[0],xe?ae.get(1):ae[1],re)}}})},Jv.prototype.cacheResult=ms.prototype.cacheResult=em.prototype.cacheResult=tm.prototype.cacheResult=TA;function I6(T){var N=Xu(T);return N._iter=T,N.size=T.size,N.flip=function(){return T},N.reverse=function(){var Q=T.reverse.apply(this);return Q.flip=function(){return T.reverse()},Q},N.has=function(Q){return T.includes(Q)},N.includes=function(Q){return T.has(Q)},N.cacheResult=TA,N.__iterateUncached=function(Q,re){var ae=this;return T.__iterate(function(xe,Pe){return Q(Pe,xe,ae)!==!1},re)},N.__iteratorUncached=function(Q,re){if(Q===ee){var ae=T.__iterator(Q,re);return new U(function(){var xe=ae.next();if(!xe.done){var Pe=xe.value[0];xe.value[0]=xe.value[1],xe.value[1]=Pe}return xe})}return T.__iterator(Q===q?$:q,re)},N}function M6(T,N,Q){var re=Xu(T);return re.size=T.size,re.has=function(ae){return T.has(ae)},re.get=function(ae,xe){var Pe=T.get(ae,x);return Pe===x?xe:N.call(Q,Pe,ae,T)},re.__iterateUncached=function(ae,xe){var Pe=this;return T.__iterate(function(Ue,et,st){return ae(N.call(Q,Ue,et,st),et,Pe)!==!1},xe)},re.__iteratorUncached=function(ae,xe){var Pe=T.__iterator(ee,xe);return new U(function(){var Ue=Pe.next();if(Ue.done)return Ue;var et=Ue.value,st=et[0];return z(ae,st,N.call(Q,et[1],st,T),Ue)})},re}function EA(T,N){var Q=Xu(T);return Q._iter=T,Q.size=T.size,Q.reverse=function(){return T},T.flip&&(Q.flip=function(){var re=I6(T);return re.reverse=function(){return T.flip()},re}),Q.get=function(re,ae){return T.get(N?re:-1-re,ae)},Q.has=function(re){return T.has(N?re:-1-re)},Q.includes=function(re){return T.includes(re)},Q.cacheResult=TA,Q.__iterate=function(re,ae){var xe=this;return T.__iterate(function(Pe,Ue){return re(Pe,Ue,xe)},!ae)},Q.__iterator=function(re,ae){return T.__iterator(re,!ae)},Q}function D6(T,N,Q,re){var ae=Xu(T);return re&&(ae.has=function(xe){var Pe=T.get(xe,x);return Pe!==x&&!!N.call(Q,Pe,xe,T)},ae.get=function(xe,Pe){var Ue=T.get(xe,x);return Ue!==x&&N.call(Q,Ue,xe,T)?Ue:Pe}),ae.__iterateUncached=function(xe,Pe){var Ue=this,et=0;return T.__iterate(function(st,yt,Lt){if(N.call(Q,st,yt,Lt))return et++,xe(st,re?yt:et-1,Ue)},Pe),et},ae.__iteratorUncached=function(xe,Pe){var Ue=T.__iterator(ee,Pe),et=0;return new U(function(){for(;;){var st=Ue.next();if(st.done)return st;var yt=st.value,Lt=yt[0],Gt=yt[1];if(N.call(Q,Gt,Lt,T))return z(xe,re?Lt:et++,Gt,st)}})},ae}function Yoe(T,N,Q){var re=Jr().asMutable();return T.__iterate(function(ae,xe){re.update(N.call(Q,ae,xe,T),0,function(Pe){return Pe+1})}),re.asImmutable()}function Koe(T,N,Q){var re=l(T),ae=(f(T)?Ci():Jr()).asMutable();T.__iterate(function(Pe,Ue){ae.update(N.call(Q,Pe,Ue,T),function(et){return et=et||[],et.push(re?[Ue,Pe]:Pe),et})});var xe=N6(T);return ae.map(function(Pe){return Dn(T,xe(Pe))})}function AA(T,N,Q,re){var ae=T.size;if(N!==void 0&&(N=N|0),Q!==void 0&&(Q===1/0?Q=ae:Q=Q|0),B(N,Q,ae))return T;var xe=j(N,ae),Pe=Y(Q,ae);if(xe!==xe||Pe!==Pe)return AA(T.toSeq().cacheResult(),N,Q,re);var Ue=Pe-xe,et;Ue===Ue&&(et=Ue<0?0:Ue);var st=Xu(T);return st.size=et===0?et:T.size&&et||void 0,!re&&Te(T)&&et>=0&&(st.get=function(yt,Lt){return yt=O(this,yt),yt>=0&&yt<et?T.get(yt+xe,Lt):Lt}),st.__iterateUncached=function(yt,Lt){var Gt=this;if(et===0)return 0;if(Lt)return this.cacheResult().__iterate(yt,Lt);var _r=0,Hr=!0,Kn=0;return T.__iterate(function(au,Qu){if(!(Hr&&(Hr=_r++<xe)))return Kn++,yt(au,re?Qu:Kn-1,Gt)!==!1&&Kn!==et}),Kn},st.__iteratorUncached=function(yt,Lt){if(et!==0&&Lt)return this.cacheResult().__iterator(yt,Lt);var Gt=et!==0&&T.__iterator(yt,Lt),_r=0,Hr=0;return new U(function(){for(;_r++<xe;)Gt.next();if(++Hr>et)return J();var Kn=Gt.next();return re||yt===q?Kn:yt===$?z(yt,Hr-1,void 0,Kn):z(yt,Hr-1,Kn.value[1],Kn)})},st}function Qoe(T,N,Q){var re=Xu(T);return re.__iterateUncached=function(ae,xe){var Pe=this;if(xe)return this.cacheResult().__iterate(ae,xe);var Ue=0;return T.__iterate(function(et,st,yt){return N.call(Q,et,st,yt)&&++Ue&&ae(et,st,Pe)}),Ue},re.__iteratorUncached=function(ae,xe){var Pe=this;if(xe)return this.cacheResult().__iterator(ae,xe);var Ue=T.__iterator(ee,xe),et=!0;return new U(function(){if(!et)return J();var st=Ue.next();if(st.done)return st;var yt=st.value,Lt=yt[0],Gt=yt[1];return N.call(Q,Gt,Lt,Pe)?ae===ee?st:z(ae,Lt,Gt,st):(et=!1,J())})},re}function R6(T,N,Q,re){var ae=Xu(T);return ae.__iterateUncached=function(xe,Pe){var Ue=this;if(Pe)return this.cacheResult().__iterate(xe,Pe);var et=!0,st=0;return T.__iterate(function(yt,Lt,Gt){if(!(et&&(et=N.call(Q,yt,Lt,Gt))))return st++,xe(yt,re?Lt:st-1,Ue)}),st},ae.__iteratorUncached=function(xe,Pe){var Ue=this;if(Pe)return this.cacheResult().__iterator(xe,Pe);var et=T.__iterator(ee,Pe),st=!0,yt=0;return new U(function(){var Lt,Gt,_r;do{if(Lt=et.next(),Lt.done)return re||xe===q?Lt:xe===$?z(xe,yt++,void 0,Lt):z(xe,yt++,Lt.value[1],Lt);var Hr=Lt.value;Gt=Hr[0],_r=Hr[1],st&&(st=N.call(Q,_r,Gt,Ue))}while(st);return xe===ee?Lt:z(xe,Gt,_r,Lt)})},ae}function Zoe(T,N){var Q=l(T),re=[T].concat(N).map(function(Pe){return u(Pe)?Q&&(Pe=a(Pe)):Pe=Q?Xe(Pe):ct(Array.isArray(Pe)?Pe:[Pe]),Pe}).filter(function(Pe){return Pe.size!==0});if(re.length===0)return T;if(re.length===1){var ae=re[0];if(ae===T||Q&&l(ae)||c(T)&&c(ae))return ae}var xe=new L(re);return Q?xe=xe.toKeyedSeq():c(T)||(xe=xe.toSetSeq()),xe=xe.flatten(!0),xe.size=re.reduce(function(Pe,Ue){if(Pe!==void 0){var et=Ue.size;if(et!==void 0)return Pe+et}},0),xe}function k6(T,N,Q){var re=Xu(T);return re.__iterateUncached=function(ae,xe){var Pe=0,Ue=!1;function et(st,yt){var Lt=this;st.__iterate(function(Gt,_r){return(!N||yt<N)&&u(Gt)?et(Gt,yt+1):ae(Gt,Q?_r:Pe++,Lt)===!1&&(Ue=!0),!Ue},xe)}return et(T,0),Pe},re.__iteratorUncached=function(ae,xe){var Pe=T.__iterator(ae,xe),Ue=[],et=0;return new U(function(){for(;Pe;){var st=Pe.next();if(st.done!==!1){Pe=Ue.pop();continue}var yt=st.value;if(ae===ee&&(yt=yt[1]),(!N||Ue.length<N)&&u(yt))Ue.push(Pe),Pe=yt.__iterator(ae,xe);else return Q?st:z(ae,et++,yt,st)}return J()})},re}function Joe(T,N,Q){var re=N6(T);return T.toSeq().map(function(ae,xe){return re(N.call(Q,ae,xe,T))}).flatten(!0)}function ese(T,N){var Q=Xu(T);return Q.size=T.size&&T.size*2-1,Q.__iterateUncached=function(re,ae){var xe=this,Pe=0;return T.__iterate(function(Ue,et){return(!Pe||re(N,Pe++,xe)!==!1)&&re(Ue,Pe++,xe)!==!1},ae),Pe},Q.__iteratorUncached=function(re,ae){var xe=T.__iterator(q,ae),Pe=0,Ue;return new U(function(){return(!Ue||Pe%2)&&(Ue=xe.next(),Ue.done)?Ue:Pe%2?z(re,Pe++,N):z(re,Pe++,Ue.value,Ue)})},Q}function rm(T,N,Q){N||(N=B6);var re=l(T),ae=0,xe=T.toSeq().map(function(Pe,Ue){return[Ue,Pe,ae++,Q?Q(Pe,Ue,T):Pe]}).toArray();return xe.sort(function(Pe,Ue){return N(Pe[3],Ue[3])||Pe[2]-Ue[2]}).forEach(re?function(Pe,Ue){xe[Ue].length=2}:function(Pe,Ue){xe[Ue]=Pe[1]}),re?Ae(xe):c(T)?Se(xe):ie(xe)}function M2(T,N,Q){if(N||(N=B6),Q){var re=T.toSeq().map(function(ae,xe){return[ae,Q(ae,xe,T)]}).reduce(function(ae,xe){return O6(N,ae[1],xe[1])?xe:ae});return re&&re[0]}else return T.reduce(function(ae,xe){return O6(N,ae,xe)?xe:ae})}function O6(T,N,Q){var re=T(Q,N);return re===0&&Q!==N&&(Q==null||Q!==Q)||re>0}function PA(T,N,Q){var re=Xu(T);return re.size=new L(Q).map(function(ae){return ae.size}).min(),re.__iterate=function(ae,xe){for(var Pe=this.__iterator(q,xe),Ue,et=0;!(Ue=Pe.next()).done&&ae(Ue.value,et++,this)!==!1;);return et},re.__iteratorUncached=function(ae,xe){var Pe=Q.map(function(st){return st=i(st),te(xe?st.reverse():st)}),Ue=0,et=!1;return new U(function(){var st;return et||(st=Pe.map(function(yt){return yt.next()}),et=st.some(function(yt){return yt.done})),et?J():z(ae,Ue++,N.apply(null,st.map(function(yt){return yt.value})))})},re}function Dn(T,N){return Te(T)?N:T.constructor(N)}function L6(T){if(T!==Object(T))throw new TypeError("Expected [K, V] tuple: "+T)}function F6(T){return Wa(T.size),R(T)}function N6(T){return l(T)?a:c(T)?o:s}function Xu(T){return Object.create((l(T)?Ae:c(T)?Se:ie).prototype)}function TA(){return this._iter.cacheResult?(this._iter.cacheResult(),this.size=this._iter.size,this):be.prototype.cacheResult.call(this)}function B6(T,N){return T>N?1:T<N?-1:0}function U6(T){var N=te(T);if(!N){if(!ye(T))throw new TypeError("Expected iterable or array-like: "+T);N=te(i(T))}return N}n(Lo,gt);function Lo(T,N){var Q,re=function(Pe){if(Pe instanceof re)return Pe;if(!(this instanceof re))return new re(Pe);if(!Q){Q=!0;var Ue=Object.keys(T);tse(ae,Ue),ae.size=Ue.length,ae._name=N,ae._keys=Ue,ae._defaultValues=T}this._map=Jr(Pe)},ae=re.prototype=Object.create(da);return ae.constructor=re,re}Lo.prototype.toString=function(){return this.__toString(j6(this)+" {","}")},Lo.prototype.has=function(T){return this._defaultValues.hasOwnProperty(T)},Lo.prototype.get=function(T,N){if(!this.has(T))return N;var Q=this._defaultValues[T];return this._map?this._map.get(T,Q):Q},Lo.prototype.clear=function(){if(this.__ownerID)return this._map&&this._map.clear(),this;var T=this.constructor;return T._empty||(T._empty=D2(this,iu()))},Lo.prototype.set=function(T,N){if(!this.has(T))throw new Error('Cannot set unknown key "'+T+'" on '+j6(this));if(this._map&&!this._map.has(T)){var Q=this._defaultValues[T];if(N===Q)return this}var re=this._map&&this._map.set(T,N);return this.__ownerID||re===this._map?this:D2(this,re)},Lo.prototype.remove=function(T){if(!this.has(T))return this;var N=this._map&&this._map.remove(T);return this.__ownerID||N===this._map?this:D2(this,N)},Lo.prototype.wasAltered=function(){return this._map.wasAltered()},Lo.prototype.__iterator=function(T,N){var Q=this;return a(this._defaultValues).map(function(re,ae){return Q.get(ae)}).__iterator(T,N)},Lo.prototype.__iterate=function(T,N){var Q=this;return a(this._defaultValues).map(function(re,ae){return Q.get(ae)}).__iterate(T,N)},Lo.prototype.__ensureOwner=function(T){if(T===this.__ownerID)return this;var N=this._map&&this._map.__ensureOwner(T);return T?D2(this,N,T):(this.__ownerID=T,this._map=N,this)};var da=Lo.prototype;da[g]=da.remove,da.deleteIn=da.removeIn=$r.removeIn,da.merge=$r.merge,da.mergeWith=$r.mergeWith,da.mergeIn=$r.mergeIn,da.mergeDeep=$r.mergeDeep,da.mergeDeepWith=$r.mergeDeepWith,da.mergeDeepIn=$r.mergeDeepIn,da.setIn=$r.setIn,da.update=$r.update,da.updateIn=$r.updateIn,da.withMutations=$r.withMutations,da.asMutable=$r.asMutable,da.asImmutable=$r.asImmutable;function D2(T,N,Q){var re=Object.create(Object.getPrototypeOf(T));return re._map=N,re.__ownerID=Q,re}function j6(T){return T._name||T.constructor.name||"Record"}function tse(T,N){try{N.forEach(rse.bind(void 0,T))}catch{}}function rse(T,N){Object.defineProperty(T,N,{get:function(){return this.get(N)},set:function(Q){pe(this.__ownerID,"Cannot set on an immutable record."),this.set(N,Q)}})}n(Yn,Wt);function Yn(T){return T==null?DA():IA(T)&&!f(T)?T:DA().withMutations(function(N){var Q=s(T);Wa(Q.size),Q.forEach(function(re){return N.add(re)})})}Yn.of=function(){return this(arguments)},Yn.fromKeys=function(T){return this(a(T).keySeq())},Yn.prototype.toString=function(){return this.__toString("Set {","}")},Yn.prototype.has=function(T){return this._map.has(T)},Yn.prototype.add=function(T){return MA(this,this._map.set(T,!0))},Yn.prototype.remove=function(T){return MA(this,this._map.remove(T))},Yn.prototype.clear=function(){return MA(this,this._map.clear())},Yn.prototype.union=function(){var T=r.call(arguments,0);return T=T.filter(function(N){return N.size!==0}),T.length===0?this:this.size===0&&!this.__ownerID&&T.length===1?this.constructor(T[0]):this.withMutations(function(N){for(var Q=0;Q<T.length;Q++)s(T[Q]).forEach(function(re){return N.add(re)})})},Yn.prototype.intersect=function(){var T=r.call(arguments,0);if(T.length===0)return this;T=T.map(function(Q){return s(Q)});var N=this;return this.withMutations(function(Q){N.forEach(function(re){T.every(function(ae){return ae.includes(re)})||Q.remove(re)})})},Yn.prototype.subtract=function(){var T=r.call(arguments,0);if(T.length===0)return this;T=T.map(function(Q){return s(Q)});var N=this;return this.withMutations(function(Q){N.forEach(function(re){T.some(function(ae){return ae.includes(re)})&&Q.remove(re)})})},Yn.prototype.merge=function(){return this.union.apply(this,arguments)},Yn.prototype.mergeWith=function(T){var N=r.call(arguments,1);return this.union.apply(this,N)},Yn.prototype.sort=function(T){return Yu(rm(this,T))},Yn.prototype.sortBy=function(T,N){return Yu(rm(this,N,T))},Yn.prototype.wasAltered=function(){return this._map.wasAltered()},Yn.prototype.__iterate=function(T,N){var Q=this;return this._map.__iterate(function(re,ae){return T(ae,ae,Q)},N)},Yn.prototype.__iterator=function(T,N){return this._map.map(function(Q,re){return re}).__iterator(T,N)},Yn.prototype.__ensureOwner=function(T){if(T===this.__ownerID)return this;var N=this._map.__ensureOwner(T);return T?this.__make(N,T):(this.__ownerID=T,this._map=N,this)};function IA(T){return!!(T&&T[z6])}Yn.isSet=IA;var z6="@@__IMMUTABLE_SET__@@",Fo=Yn.prototype;Fo[z6]=!0,Fo[g]=Fo.remove,Fo.mergeDeep=Fo.merge,Fo.mergeDeepWith=Fo.mergeWith,Fo.withMutations=$r.withMutations,Fo.asMutable=$r.asMutable,Fo.asImmutable=$r.asImmutable,Fo.__empty=DA,Fo.__make=V6;function MA(T,N){return T.__ownerID?(T.size=N.size,T._map=N,T):N===T._map?T:N.size===0?T.__empty():T.__make(N)}function V6(T,N){var Q=Object.create(Fo);return Q.size=T?T.size:0,Q._map=T,Q.__ownerID=N,Q}var H6;function DA(){return H6||(H6=V6(iu()))}n(Yu,Yn);function Yu(T){return T==null?RA():G6(T)?T:RA().withMutations(function(N){var Q=s(T);Wa(Q.size),Q.forEach(function(re){return N.add(re)})})}Yu.of=function(){return this(arguments)},Yu.fromKeys=function(T){return this(a(T).keySeq())},Yu.prototype.toString=function(){return this.__toString("OrderedSet {","}")};function G6(T){return IA(T)&&f(T)}Yu.isOrderedSet=G6;var R2=Yu.prototype;R2[m]=!0,R2.__empty=RA,R2.__make=q6;function q6(T,N){var Q=Object.create(R2);return Q.size=T?T.size:0,Q._map=T,Q.__ownerID=N,Q}var $6;function RA(){return $6||($6=q6(I2()))}n(Ei,Pt);function Ei(T){return T==null?kA():W6(T)?T:kA().unshiftAll(T)}Ei.of=function(){return this(arguments)},Ei.prototype.toString=function(){return this.__toString("Stack [","]")},Ei.prototype.get=function(T,N){var Q=this._head;for(T=O(this,T);Q&&T--;)Q=Q.next;return Q?Q.value:N},Ei.prototype.peek=function(){return this._head&&this._head.value},Ei.prototype.push=function(){if(arguments.length===0)return this;for(var T=this.size+arguments.length,N=this._head,Q=arguments.length-1;Q>=0;Q--)N={value:arguments[Q],next:N};return this.__ownerID?(this.size=T,this._head=N,this.__hash=void 0,this.__altered=!0,this):U0(T,N)},Ei.prototype.pushAll=function(T){if(T=o(T),T.size===0)return this;Wa(T.size);var N=this.size,Q=this._head;return T.reverse().forEach(function(re){N++,Q={value:re,next:Q}}),this.__ownerID?(this.size=N,this._head=Q,this.__hash=void 0,this.__altered=!0,this):U0(N,Q)},Ei.prototype.pop=function(){return this.slice(1)},Ei.prototype.unshift=function(){return this.push.apply(this,arguments)},Ei.prototype.unshiftAll=function(T){return this.pushAll(T)},Ei.prototype.shift=function(){return this.pop.apply(this,arguments)},Ei.prototype.clear=function(){return this.size===0?this:this.__ownerID?(this.size=0,this._head=void 0,this.__hash=void 0,this.__altered=!0,this):kA()},Ei.prototype.slice=function(T,N){if(B(T,N,this.size))return this;var Q=j(T,this.size),re=Y(N,this.size);if(re!==this.size)return Pt.prototype.slice.call(this,T,N);for(var ae=this.size-Q,xe=this._head;Q--;)xe=xe.next;return this.__ownerID?(this.size=ae,this._head=xe,this.__hash=void 0,this.__altered=!0,this):U0(ae,xe)},Ei.prototype.__ensureOwner=function(T){return T===this.__ownerID?this:T?U0(this.size,this._head,T,this.__hash):(this.__ownerID=T,this.__altered=!1,this)},Ei.prototype.__iterate=function(T,N){if(N)return this.reverse().__iterate(T);for(var Q=0,re=this._head;re&&T(re.value,Q++,this)!==!1;)re=re.next;return Q},Ei.prototype.__iterator=function(T,N){if(N)return this.reverse().__iterator(T);var Q=0,re=this._head;return new U(function(){if(re){var ae=re.value;return re=re.next,z(T,Q++,ae)}return J()})};function W6(T){return!!(T&&T[X6])}Ei.isStack=W6;var X6="@@__IMMUTABLE_STACK__@@",nm=Ei.prototype;nm[X6]=!0,nm.withMutations=$r.withMutations,nm.asMutable=$r.asMutable,nm.asImmutable=$r.asImmutable,nm.wasAltered=$r.wasAltered;function U0(T,N,Q,re){var ae=Object.create(nm);return ae.size=T,ae._head=N,ae.__ownerID=Q,ae.__hash=re,ae.__altered=!1,ae}var Y6;function kA(){return Y6||(Y6=U0(0))}function Ku(T,N){var Q=function(re){T.prototype[re]=N[re]};return Object.keys(N).forEach(Q),Object.getOwnPropertySymbols&&Object.getOwnPropertySymbols(N).forEach(Q),T}i.Iterator=U,Ku(i,{toArray:function(){Wa(this.size);var T=new Array(this.size||0);return this.valueSeq().__iterate(function(N,Q){T[Q]=N}),T},toIndexedSeq:function(){return new Jv(this)},toJS:function(){return this.toSeq().map(function(T){return T&&typeof T.toJS=="function"?T.toJS():T}).__toJS()},toJSON:function(){return this.toSeq().map(function(T){return T&&typeof T.toJSON=="function"?T.toJSON():T}).__toJS()},toKeyedSeq:function(){return new ms(this,!0)},toMap:function(){return Jr(this.toKeyedSeq())},toObject:function(){Wa(this.size);var T={};return this.__iterate(function(N,Q){T[Q]=N}),T},toOrderedMap:function(){return Ci(this.toKeyedSeq())},toOrderedSet:function(){return Yu(l(this)?this.valueSeq():this)},toSet:function(){return Yn(l(this)?this.valueSeq():this)},toSetSeq:function(){return new em(this)},toSeq:function(){return c(this)?this.toIndexedSeq():l(this)?this.toKeyedSeq():this.toSetSeq()},toStack:function(){return Ei(l(this)?this.valueSeq():this)},toList:function(){return jn(l(this)?this.valueSeq():this)},toString:function(){return"[Iterable]"},__toString:function(T,N){return this.size===0?T+N:T+" "+this.toSeq().map(this.__toStringMapper).join(", ")+" "+N},concat:function(){var T=r.call(arguments,0);return Dn(this,Zoe(this,T))},includes:function(T){return this.some(function(N){return tt(N,T)})},entries:function(){return this.__iterator(ee)},every:function(T,N){Wa(this.size);var Q=!0;return this.__iterate(function(re,ae,xe){if(!T.call(N,re,ae,xe))return Q=!1,!1}),Q},filter:function(T,N){return Dn(this,D6(this,T,N,!0))},find:function(T,N,Q){var re=this.findEntry(T,N);return re?re[1]:Q},forEach:function(T,N){return Wa(this.size),this.__iterate(N?T.bind(N):T)},join:function(T){Wa(this.size),T=T!==void 0?""+T:",";var N="",Q=!0;return this.__iterate(function(re){Q?Q=!1:N+=T,N+=re!=null?re.toString():""}),N},keys:function(){return this.__iterator($)},map:function(T,N){return Dn(this,M6(this,T,N))},reduce:function(T,N,Q){Wa(this.size);var re,ae;return arguments.length<2?ae=!0:re=N,this.__iterate(function(xe,Pe,Ue){ae?(ae=!1,re=xe):re=T.call(Q,re,xe,Pe,Ue)}),re},reduceRight:function(T,N,Q){var re=this.toKeyedSeq().reverse();return re.reduce.apply(re,arguments)},reverse:function(){return Dn(this,EA(this,!0))},slice:function(T,N){return Dn(this,AA(this,T,N,!0))},some:function(T,N){return!this.every(O2(T),N)},sort:function(T){return Dn(this,rm(this,T))},values:function(){return this.__iterator(q)},butLast:function(){return this.slice(0,-1)},isEmpty:function(){return this.size!==void 0?this.size===0:!this.some(function(){return!0})},count:function(T,N){return R(T?this.toSeq().filter(T,N):this)},countBy:function(T,N){return Yoe(this,T,N)},equals:function(T){return xt(this,T)},entrySeq:function(){var T=this;if(T._cache)return new L(T._cache);var N=T.toSeq().map(ise).toIndexedSeq();return N.fromEntrySeq=function(){return T.toSeq()},N},filterNot:function(T,N){return this.filter(O2(T),N)},findEntry:function(T,N,Q){var re=Q;return this.__iterate(function(ae,xe,Pe){if(T.call(N,ae,xe,Pe))return re=[xe,ae],!1}),re},findKey:function(T,N){var Q=this.findEntry(T,N);return Q&&Q[0]},findLast:function(T,N,Q){return this.toKeyedSeq().reverse().find(T,N,Q)},findLastEntry:function(T,N,Q){return this.toKeyedSeq().reverse().findEntry(T,N,Q)},findLastKey:function(T,N){return this.toKeyedSeq().reverse().findKey(T,N)},first:function(){return this.find(H)},flatMap:function(T,N){return Dn(this,Joe(this,T,N))},flatten:function(T){return Dn(this,k6(this,T,!0))},fromEntrySeq:function(){return new tm(this)},get:function(T,N){return this.find(function(Q,re){return tt(re,T)},void 0,N)},getIn:function(T,N){for(var Q=this,re=U6(T),ae;!(ae=re.next()).done;){var xe=ae.value;if(Q=Q&&Q.get?Q.get(xe,x):x,Q===x)return N}return Q},groupBy:function(T,N){return Koe(this,T,N)},has:function(T){return this.get(T,x)!==x},hasIn:function(T){return this.getIn(T,x)!==x},isSubset:function(T){return T=typeof T.includes=="function"?T:i(T),this.every(function(N){return T.includes(N)})},isSuperset:function(T){return T=typeof T.isSubset=="function"?T:i(T),T.isSubset(this)},keyOf:function(T){return this.findKey(function(N){return tt(N,T)})},keySeq:function(){return this.toSeq().map(nse).toIndexedSeq()},last:function(){return this.toSeq().reverse().first()},lastKeyOf:function(T){return this.toKeyedSeq().reverse().keyOf(T)},max:function(T){return M2(this,T)},maxBy:function(T,N){return M2(this,N,T)},min:function(T){return M2(this,T?K6(T):Z6)},minBy:function(T,N){return M2(this,N?K6(N):Z6,T)},rest:function(){return this.slice(1)},skip:function(T){return this.slice(Math.max(0,T))},skipLast:function(T){return Dn(this,this.toSeq().reverse().skip(T).reverse())},skipWhile:function(T,N){return Dn(this,R6(this,T,N,!0))},skipUntil:function(T,N){return this.skipWhile(O2(T),N)},sortBy:function(T,N){return Dn(this,rm(this,N,T))},take:function(T){return this.slice(0,Math.max(0,T))},takeLast:function(T){return Dn(this,this.toSeq().reverse().take(T).reverse())},takeWhile:function(T,N){return Dn(this,Qoe(this,T,N))},takeUntil:function(T,N){return this.takeWhile(O2(T),N)},valueSeq:function(){return this.toIndexedSeq()},hashCode:function(){return this.__hash||(this.__hash=ose(this))}});var Ya=i.prototype;Ya[p]=!0,Ya[X]=Ya.values,Ya.__toJS=Ya.toArray,Ya.__toStringMapper=Q6,Ya.inspect=Ya.toSource=function(){return this.toString()},Ya.chain=Ya.flatMap,Ya.contains=Ya.includes,Ku(a,{flip:function(){return Dn(this,I6(this))},mapEntries:function(T,N){var Q=this,re=0;return Dn(this,this.toSeq().map(function(ae,xe){return T.call(N,[xe,ae],re++,Q)}).fromEntrySeq())},mapKeys:function(T,N){var Q=this;return Dn(this,this.toSeq().flip().map(function(re,ae){return T.call(N,re,ae,Q)}).flip())}});var k2=a.prototype;k2[v]=!0,k2[X]=Ya.entries,k2.__toJS=Ya.toObject,k2.__toStringMapper=function(T,N){return JSON.stringify(N)+": "+Q6(T)},Ku(o,{toKeyedSeq:function(){return new ms(this,!1)},filter:function(T,N){return Dn(this,D6(this,T,N,!1))},findIndex:function(T,N){var Q=this.findEntry(T,N);return Q?Q[0]:-1},indexOf:function(T){var N=this.keyOf(T);return N===void 0?-1:N},lastIndexOf:function(T){var N=this.lastKeyOf(T);return N===void 0?-1:N},reverse:function(){return Dn(this,EA(this,!1))},slice:function(T,N){return Dn(this,AA(this,T,N,!1))},splice:function(T,N){var Q=arguments.length;if(N=Math.max(N|0,0),Q===0||Q===2&&!N)return this;T=j(T,T<0?this.count():this.size);var re=this.slice(0,T);return Dn(this,Q===1?re:re.concat(k(arguments,2),this.slice(T+N)))},findLastIndex:function(T,N){var Q=this.findLastEntry(T,N);return Q?Q[0]:-1},first:function(){return this.get(0)},flatten:function(T){return Dn(this,k6(this,T,!1))},get:function(T,N){return T=O(this,T),T<0||this.size===1/0||this.size!==void 0&&T>this.size?N:this.find(function(Q,re){return re===T},void 0,N)},has:function(T){return T=O(this,T),T>=0&&(this.size!==void 0?this.size===1/0||T<this.size:this.indexOf(T)!==-1)},interpose:function(T){return Dn(this,ese(this,T))},interleave:function(){var T=[this].concat(k(arguments)),N=PA(this.toSeq(),Se.of,T),Q=N.flatten(!0);return N.size&&(Q.size=N.size*T.length),Dn(this,Q)},keySeq:function(){return me(0,this.size)},last:function(){return this.get(-1)},skipWhile:function(T,N){return Dn(this,R6(this,T,N,!1))},zip:function(){var T=[this].concat(k(arguments));return Dn(this,PA(this,ase,T))},zipWith:function(T){var N=k(arguments);return N[0]=this,Dn(this,PA(this,T,N))}}),o.prototype[h]=!0,o.prototype[m]=!0,Ku(s,{get:function(T,N){return this.has(T)?T:N},includes:function(T){return this.has(T)},keySeq:function(){return this.valueSeq()}}),s.prototype.has=Ya.includes,s.prototype.contains=s.prototype.includes,Ku(Ae,a.prototype),Ku(Se,o.prototype),Ku(ie,s.prototype),Ku(gt,a.prototype),Ku(Pt,o.prototype),Ku(Wt,s.prototype);function nse(T,N){return N}function ise(T,N){return[N,T]}function O2(T){return function(){return!T.apply(this,arguments)}}function K6(T){return function(){return-T.apply(this,arguments)}}function Q6(T){return typeof T=="string"?JSON.stringify(T):String(T)}function ase(){return k(arguments)}function Z6(T,N){return T<N?1:T>N?-1:0}function ose(T){if(T.size===1/0)return 0;var N=f(T),Q=l(T),re=N?1:0,ae=T.__iterate(Q?N?function(xe,Pe){re=31*re+J6(Yt(xe),Yt(Pe))|0}:function(xe,Pe){re=re+J6(Yt(xe),Yt(Pe))|0}:N?function(xe){re=31*re+Yt(xe)|0}:function(xe){re=re+Yt(xe)|0});return sse(ae,re)}function sse(T,N){return N=lr(N,3432918353),N=lr(N<<15|N>>>-15,461845907),N=lr(N<<13|N>>>-13,5),N=(N+3864292196|0)^T,N=lr(N^N>>>16,2246822507),N=lr(N^N>>>13,3266489909),N=Tr(N^N>>>16),N}function J6(T,N){return T^N+2654435769+(T<<6)+(T>>2)|0}var use={Iterable:i,Seq:be,Collection:Ke,Map:Jr,OrderedMap:Ci,List:jn,Stack:Ei,Set:Yn,OrderedSet:Yu,Record:Lo,Range:me,Repeat:ht,is:tt,fromJS:dt};return use})})(fZ);var si=fZ.exports,fE=Object.prototype.hasOwnProperty;function v5e(e,t){for(var r=0,n=Object.keys(t);r<n.length;r++){var i=n[r];fE.call(t,i)&&typeof e[i]>"u"&&(e[i]=t[i])}return e}function m5e(e,t){for(var r=!1,n=0,i=Object.keys(t);n<i.length;n++){var a=i[n];if(fE.call(t,a)&&t[a]!==e[a]){r=!0;break}}return r?Object.assign({},e,t):e}function rL(e,t){if(!e)return!t;if(!t)return!1;var r=Object.keys(e);if(Object.keys(t).length!==r.length)return!1;for(var n=0,i=r;n<i.length;n++){var a=i[n];if(!fE.call(e,a)||e[a]!==t[a])return!1}return!0}function g5e(e,t){for(var r=e,n=0;n<t.length;n++)if(t[n]&&(r=m5e(e,t[n]),r!==e)){for(var i=n+1;i<t.length;i++)r=Object.assign(r,t[i]);break}return r}function cp(e){if(e===null||typeof e!="object")return e;if(e instanceof Array){for(var t=[],r=0,n=e.length;r<n;r++)t[r]=cp(e[r]);return t}if(typeof e=="object"&&!("prototype"in e)){var t={};for(var i in e)fE.call(e,i)&&(t[i]=cp(e[i]));return t}throw new Error(`Can't clone, type "`+typeof e+'" unsupported')}function ju(e,t){if(e)for(var r=0,n=Object.keys(e);r<n.length;r++){var i=n[r];t(e[i],i)}}function y5e(){var e=function(){var h=typeof window<"u"&&window,m=typeof self<"u"&&typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&self,g=typeof e<"u"&&e;return h||g||m}(),t={},r=typeof document<"u"?document:void 0,n=1,i;function a(h){for(var m=[],g=1;g<arguments.length;g++)m[g-1]=arguments[g];typeof h!="function"&&(h=new Function(""+h));var y={callback:h,args:m};return t[n]=y,i(n),n++}function o(h){delete t[h]}function s(h){var m=h.callback,g=h.args;switch(g.length){case 0:m();break;case 1:m(g[0]);break;case 2:m(g[0],g[1]);break;case 3:m(g[0],g[1],g[2]);break;default:m.apply(void 0,g);break}}function u(h){var m=t[h];o(h),s(m)}function l(){i=function(h){process.nextTick(function(){u(h)})}}function c(){if(e&&e.postMessage&&!e.importScripts){var h=!0,m=e.onmessage;return e.onmessage=function(){h=!1},e.postMessage("","*"),e.onmessage=m,h}}function d(){var h="setImmediate$"+Math.random()+"$",m=function(g){g.source===e&&typeof g.data=="string"&&g.data.indexOf(h)===0&&u(+g.data.slice(h.length))};window.addEventListener?window.addEventListener("message",m,!1):window.attachEvent("onmessage",m),i=function(g){window.postMessage(h+g,"*")}}function f(){var h=new MessageChannel;h.port1.onmessage=function(m){var g=m.data;u(g)},i=function(m){h.port2.postMessage(m)}}function p(){var h=r.documentElement;i=function(m){var g=r.createElement("script");g.onreadystatechange=function(){u(m),g.onreadystatechange=null,h.removeChild(g),g=null},h.appendChild(g)}}function v(){i=function(h){setTimeout(u,0,h)}}return typeof process<"u"&&{}.toString.call(process)==="[object process]"?l():c()?d():typeof MessageChannel<"u"?f():r&&"onreadystatechange"in r.createElement("script")?p():v(),{setImmediate:a,clearImmediate:o}}var B5=function(){return typeof setImmediate<"u"?typeof window<"u"?{setImmediate:function(e){for(var t,r=[],n=1;n<arguments.length;n++)r[n-1]=arguments[n];return(t=window).setImmediate.apply(t,Nt([e],r))},clearImmediate:function(e){return window.clearImmediate(e)}}:{setImmediate,clearImmediate}:y5e()}();function b5e(e){B5.setImmediate(e)}var nL={setImmediate:B5.setImmediate,clearImmediate:B5.clearImmediate,immediatePromise:function(){return new Promise(b5e)},delay:function(e,t){return t===void 0&&(t=void 0),new Promise(function(r){return setTimeout(r,e,t)})}},y0=function(){try{return!0}catch{return!1}}(),kr=function(){try{var t={}.DEBUG;return t==="*"||t==="molstar"}catch{return!1}}(),x5e=typeof performance<"u"&&performance.mark&&performance.measure,l4=x5e&&!y0,v1;(function(e){function t(o){return"startTask"+o.id}function r(o){return"endTask"+o.id}function n(o){l4&&performance.mark(t(o))}e.markStart=n;function i(o){l4&&performance.mark(r(o))}e.markEnd=i;function a(o){l4&&performance.measure(" "+o.name,t(o),r(o))}e.measure=a})(v1||(v1={}));function S5e(e,t,r){r===void 0&&(r=250);var n=vZ(e,t,r),i=new SZ(n,n.root);return iL(e,i)}function C5e(e,t,r){r===void 0&&(r=250);var n=vZ(e,t,r);return new SZ(n,n.root)}function pZ(e,t){return iL(t,e)}function _5e(e,t,r){return e.runChild(t,r)}function hZ(e){return{taskId:e.id,taskName:e.name,message:"",startedTime:0,canAbort:!0,isIndeterminate:!0,current:0,max:0}}function vZ(e,t,r){var n={abortRequested:!1,treeAborted:!1,reason:""};return{updateRateMs:r,lastNotified:kn(),observer:t,abortToken:n,taskId:e.id,root:{progress:hZ(e),children:[]},tryAbort:w5e(n)}}function w5e(e){return function(t){e.abortRequested=!0,e.reason=t||e.reason}}function mZ(e){return{progress:E({},e.progress),children:e.children.map(mZ)}}function gZ(e){return e.progress.canAbort&&e.children.every(gZ)}function E5e(e){return{root:mZ(e.root),canAbort:gZ(e.root),requestAbort:e.tryAbort}}function iL(e,t){return ce(this,void 0,void 0,function(){var r,n;return de(this,function(i){switch(i.label){case 0:v1.markStart(e),t.node.progress.startedTime=kn(),i.label=1;case 1:return i.trys.push([1,3,,7]),[4,e.f(t)];case 2:return r=i.sent(),v1.markEnd(e),v1.measure(e),t.info.abortToken.abortRequested&&yZ(t.info),[2,r];case 3:return n=i.sent(),$e.isAbort(n)?(t.isAborted=!0,t.node.children.length>0?[4,new Promise(function(a){t.onChildrenFinished=a})]:[3,5]):[3,6];case 4:i.sent(),i.label=5;case 5:e.onAbort&&e.onAbort(),i.label=6;case 6:throw kr&&console.error(n),n;case 7:return[2]}})})}function yZ(e){throw e.abortToken.treeAborted||(e.abortToken.treeAborted=!0,bZ(e.root),xZ(e,kn())),$e.Aborted(e.abortToken.reason)}function bZ(e){var t=e.progress;t.isIndeterminate=!0,t.canAbort=!1,t.message="Aborting...";for(var r=0,n=e.children;r<n.length;r++){var i=n[r];bZ(i)}}function xZ(e,t){e.lastNotified=t;var r=E5e(e);e.observer(r)}var SZ=function(){function e(t,r){this.isSynchronous=!1,this.isExecuting=!0,this.lastUpdatedTime=0,this.onChildrenFinished=void 0,this.node=r,this.info=t}return e.prototype.checkAborted=function(){this.info.abortToken.abortRequested&&(this.isAborted=!0,yZ(this.info))},Object.defineProperty(e.prototype,"shouldUpdate",{get:function(){return this.checkAborted(),kn()-this.lastUpdatedTime>this.info.updateRateMs},enumerable:!1,configurable:!0}),e.prototype.updateProgress=function(t){if(this.checkAborted(),!!t){var r=this.node.progress;typeof t=="string"?(r.message=t,r.isIndeterminate=!0):(typeof t.canAbort<"u"&&(r.canAbort=t.canAbort),typeof t.message<"u"&&(r.message=t.message),typeof t.current<"u"&&(r.current=t.current),typeof t.max<"u"&&(r.max=t.max),r.isIndeterminate=typeof r.current>"u"||typeof r.max>"u",typeof t.isIndeterminate<"u"&&(r.isIndeterminate=t.isIndeterminate))}},e.prototype.update=function(t,r){if(this.lastUpdatedTime=kn(),this.updateProgress(t),!r)return xZ(this.info,this.lastUpdatedTime),this.checkAborted(),nL.immediatePromise()},e.prototype.runChild=function(t,r){return ce(this,void 0,void 0,function(){var n,i,a,o,s,u,l;return de(this,function(c){switch(c.label){case 0:this.updateProgress(r),n={progress:hZ(t),children:[]},i=this.node.children,i.push(n),a=new e(this.info,n),c.label=1;case 1:return c.trys.push([1,3,4,5]),[4,iL(t,a)];case 2:return[2,c.sent()];case 3:if(o=c.sent(),$e.isAbort(o)&&this.isAborted)return[2,void 0];throw o;case 4:if(s=i.indexOf(n),s>=0){for(u=s,l=i.length-1;u<l;u++)i[u]=i[u+1];i.pop()}return i.length===0&&this.onChildrenFinished&&this.onChildrenFinished(),[7];case 5:return[2]}})})},e}(),A5e=function(){function e(){this.shouldUpdate=!1,this.isSynchronous=!0}return e.prototype.update=function(t,r){},e}(),XS=new A5e,$e;(function(e){var t=function(){function d(f,p,v){this.name=f,this.f=p,this.onAbort=v,this.id=c()}return d.prototype.run=function(f,p){return p===void 0&&(p=250),f?S5e(this,f,p):this.f(XS)},d.prototype.runAsChild=function(f,p){return f.isSynchronous?this.f(XS):_5e(f,this,p)},d.prototype.runInContext=function(f){return f.isSynchronous?this.f(XS):pZ(f,this)},d}();function r(d){var f=d;return!!d&&typeof f.id=="number"&&typeof f.name=="string"&&!!f.run}e.is=r;function n(d){return!!d&&!!d.isAborted}e.isAbort=n;function i(d){return{isAborted:!0,reason:d,toString:function(){return"Aborted"+(d?": "+d:"")}}}e.Aborted=i;function a(d,f,p){return new t(d,f,p)}e.create=a;function o(d,f){var p=this;return a(d,function(v){return ce(p,void 0,void 0,function(){return de(this,function(h){return[2,f]})})})}e.constant=o;function s(){var d=this;return a("",function(f){return ce(d,void 0,void 0,function(){return de(this,function(p){return[2]})})})}e.empty=s;function u(d,f){var p=this;return a(d,function(v){return ce(p,void 0,void 0,function(){return de(this,function(h){throw new Error(f)})})})}e.fail=u;function l(d,f){return r(d)?f?d.runInContext(f):d.run():d}e.resolveInContext=l;var c=$a(0,1073741823)})($e||($e={}));var z9;(function(e){e.Synchronous=XS})(z9||(z9={}));var V9;(function(e){function t(n,i){i===void 0&&(i="");var a=n.progress;if(!n.children.length)return a.isIndeterminate?""+i+a.taskName+": "+a.message:""+i+a.taskName+": ["+a.current+"/"+a.max+"] "+a.message;var o=i+"  |_ ",s=n.children.map(function(u){return t(u,o)});return a.isIndeterminate?""+i+a.taskName+": "+a.message+`
`+s.join(`
`):""+i+a.taskName+": ["+a.current+"/"+a.max+"] "+a.message+`
`+s.join(`
`)}function r(n){return t(n.root)}e.format=r})(V9||(V9={}));function Zc(e,t,r,n,i){return ce(this,void 0,void 0,function(){var a,o,s,u,l,c,d;return de(this,function(f){switch(f.label){case 0:if(a=Math.max(t,0),o=0,s=0,e.isSynchronous)return n(Number.MAX_SAFE_INTEGER,r),[2,r];u=kn(),l=0,c=0,f.label=1;case 1:return(l=n(a,r))>0?(o+=l,d=kn()-u,c+=d,s+=d,e.shouldUpdate?[4,i(e,r,o)]:[3,3]):[3,4];case 2:f.sent(),a=Math.round(c*o/s)+1,u=kn(),c=0,f.label=3;case 3:return[3,1];case 4:return e.shouldUpdate?[4,i(e,r,o)]:[3,6];case 5:f.sent(),f.label=6;case 6:return[2,r]}})})}function P5e(e){return e>>0}function Df(e,t){return e[t]|e[t+1]<<8}function ph(e,t,r){e[t]=r&255,e[t+1]=r>>8&255}function hh(e,t){return e[t+3]*(256*256*256)+(e[t+2]<<16|e[t+1]<<8|e[t])}function mc(e,t,r){e[t]=r&255,e[t+1]=r>>8&255,e[t+2]=r>>16&255,e[t+3]=r>>24&255}function T5e(e,t,r){for(var n="",i=0;i<r;i++)n+=String.fromCharCode(e[t+i]);return n}function I5e(e){return e.length<2?"0"+e:e}function M5e(e,t,r){for(var n="",i,a=0;a<r;a++)n+="%"+I5e(e[t+a].toString(16));try{i=decodeURIComponent(n)}catch{return T5e(e,t,r)}return i}function D5e(e,t,r){for(var n=r.length,i=0,a=0;a<n;a++){var o=r.charCodeAt(a);if(!(o&4294967295-(1<<7)+1))e[t+i]=o,i++;else if(!(o&4294967295-(1<<11)+1))e[t+i]=192|o>>6,e[t+i+1]=128|o>>0&63,i+=2;else if(!(o&4294967295-(1<<16)+1))e[t+i]=224|o>>12,e[t+i+1]=128|o>>6&63,e[t+i+2]=128|o>>0&63,i+=3;else if(!(o&4294967295-(1<<21)+1))e[t+i]=240|o>>18,e[t+i+1]=128|o>>12&63,e[t+i+2]=128|o>>6&63,e[t+i+3]=128|o>>0&63,i+=4;else throw"e"}return i}function CZ(e){for(var t=e.length,r=0,n=0;n<t;n++){var i=e.charCodeAt(n);if(!(i&4294967295-(1<<7)+1))r++;else if(!(i&4294967295-(1<<11)+1))r+=2;else if(!(i&4294967295-(1<<16)+1))r+=3;else if(!(i&4294967295-(1<<21)+1))r+=4;else throw"e"}return r}var R5e=function(){for(var e=new Uint32Array(256),t=0;t<256;t++){for(var r=t,n=0;n<8;n++)r&1?r=3988292384^r>>>1:r=r>>>1;e[t]=r}return e}();function k5e(e,t,r,n){for(var i=0;i<n;i++)e=R5e[(e^t[r+i])&255]^e>>>8;return e}function _Z(e,t,r){return k5e(4294967295,e,t,r)^4294967295}var bt=function(){var e=Uint16Array,t=Uint32Array;return{next_code:new e(16),bl_count:new e(16),ordr:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],of0:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],exb:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],ldef:new e(32),df0:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],dxb:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],ddef:new t(32),flmap:new e(512),fltree:[],fdmap:new e(32),fdtree:[],lmap:new e(32768),ltree:[],ttree:[],dmap:new e(32768),dtree:[],imap:new e(512),itree:[],rev15:new e(1<<15),lhst:new t(286),dhst:new t(30),ihst:new t(19),lits:new t(15e3),strt:new e(1<<16),prev:new e(1<<15)}}();(function(){for(var e=32768,t=0;t<e;t++){var r=t;r=(r&2863311530)>>>1|(r&1431655765)<<1,r=(r&3435973836)>>>2|(r&858993459)<<2,r=(r&4042322160)>>>4|(r&252645135)<<4,r=(r&4278255360)>>>8|(r&16711935)<<8,bt.rev15[t]=(r>>>16|r<<16)>>>17}function n(i,a,o){for(;a--!==0;)i.push(0,o)}for(var t=0;t<32;t++)bt.ldef[t]=bt.of0[t]<<3|bt.exb[t],bt.ddef[t]=bt.df0[t]<<4|bt.dxb[t];n(bt.fltree,144,8),n(bt.fltree,255-143,9),n(bt.fltree,279-255,7),n(bt.fltree,287-279,8),Jf(bt.fltree,9),m1(bt.fltree,9,bt.flmap),g1(bt.fltree,9),n(bt.fdtree,32,5),Jf(bt.fdtree,5),m1(bt.fdtree,5,bt.fdmap),g1(bt.fdtree,5),n(bt.itree,19,0),n(bt.ltree,286,0),n(bt.dtree,30,0),n(bt.ttree,320,0)})();function m1(e,t,r){for(var n=e.length,i=bt.rev15,a=0;a<n;a+=2)if(e[a+1]!==0)for(var o=a>>1,s=e[a+1],u=o<<4|s,l=t-s,c=e[a]<<l,d=c+(1<<l);c!==d;){var f=i[c]>>>15-t;r[f]=u,c++}}function Jf(e,t){for(var r=e.length,n=bt.bl_count,i=0;i<=t;i++)n[i]=0;for(var i=1;i<r;i+=2)n[e[i]]++;var a=bt.next_code,o=0;n[0]=0;for(var s=1;s<=t;s++)o=o+n[s-1]<<1,a[s]=o;for(var u=0;u<r;u+=2){var l=e[u+1];l!==0&&(e[u]=a[l],a[l]++)}}function g1(e,t){for(var r=bt.rev15,n=15-t,i=0;i<e.length;i+=2){var a=e[i]<<t-e[i+1];e[i]=r[a]>>>n}}function O5e(e,t){var r=t===void 0;return t===void 0&&(t=new Uint8Array(e.length>>>2<<3)),{data:e,buf:t,noBuf:r,BFINAL:0,off:0,pos:0}}function L5e(e,t){for(var r=e.data,n=e.noBuf,i=e.buf,a=e.BFINAL,o=e.off,s=e.pos,u=0;a===0&&u<t;){var l=void 0,c=void 0,d=0,f=0;a=d4(r,s,1),u+=1;var p=d4(r,s+1,2);if(s+=3,p===0){s&7&&(s+=8-(s&7));var v=(s>>>3)+4,h=r[v-4]|r[v-3]<<8;n&&(i=c4(i,o+h)),i.set(new Uint8Array(r.buffer,r.byteOffset+v,h),o),s=v+h<<3,o+=h;continue}if(n&&(i=c4(i,o+(1<<17))),p===1)l=bt.flmap,c=bt.fdmap,d=(1<<9)-1,f=(1<<5)-1;else if(p===2){var m=xf(r,s,5)+257,g=xf(r,s+5,5)+1,y=xf(r,s+10,4)+4;s+=14;for(var b=0;b<38;b+=2)bt.itree[b]=0,bt.itree[b+1]=0;for(var S=1,b=0;b<y;b++){var x=xf(r,s+b*3,3);bt.itree[(bt.ordr[b]<<1)+1]=x,x>S&&(S=x)}s+=3*y,Jf(bt.itree,S),m1(bt.itree,S,bt.imap),l=bt.lmap,c=bt.dmap,s=N5e(bt.imap,(1<<S)-1,m+g,r,s,bt.ttree);var C=H9(bt.ttree,0,m,bt.ltree);d=(1<<C)-1;var w=H9(bt.ttree,m,g,bt.dtree);f=(1<<w)-1,Jf(bt.ltree,C),m1(bt.ltree,C,l),Jf(bt.dtree,w),m1(bt.dtree,w,c)}else throw new Error("unknown BTYPE "+p);for(;;){var A=l[U5(r,s)&d];s+=A&15;var M=A>>>4;if(!(M>>>8))i[o++]=M;else{if(M===256)break;var D=o+M-254;if(M>264){var k=bt.ldef[M-257];D=o+(k>>>3)+xf(r,s,k&7),s+=k&7}var R=c[U5(r,s)&f];s+=R&15;var O=R>>>4,H=bt.ddef[O],B=(H>>>4)+d4(r,s,H&15);for(s+=H&15,n&&(i=c4(i,o+(1<<17)));o<D;)i[o]=i[o++-B],i[o]=i[o++-B],i[o]=i[o++-B],i[o]=i[o++-B];o=D}}}e.buf=i,e.BFINAL=a,e.off=o,e.pos=s}function F5e(e,t,r){return ce(this,void 0,void 0,function(){var n;return de(this,function(i){switch(i.label){case 0:if(t[0]===3&&t[1]===0)return[2,r||new Uint8Array(0)];n=O5e(t,r),i.label=1;case 1:return n.BFINAL!==0?[3,4]:e.shouldUpdate?[4,e.update({message:"Inflating blocks...",current:n.pos,max:t.length})]:[3,3];case 2:i.sent(),i.label=3;case 3:return L5e(n,100),[3,1];case 4:return[2,n.buf.length===n.off?n.buf:n.buf.slice(0,n.off)]}})})}function c4(e,t){var r=e.length;if(t<=r)return e;var n=new Uint8Array(Math.max(r<<1,t));return n.set(e,0),n}function N5e(e,t,r,n,i,a){for(var o=0;o<r;){var s=e[U5(n,i)&t];i+=s&15;var u=s>>>4;if(u<=15)a[o]=u,o++;else{var l=0,c=0;u===16?(c=3+xf(n,i,2),i+=2,l=a[o-1]):u===17?(c=3+xf(n,i,3),i+=3):u===18&&(c=11+xf(n,i,7),i+=7);for(var d=o+c;o<d;)a[o]=l,o++}}return i}function H9(e,t,r,n){for(var i=0,a=0,o=n.length>>>1;a<r;){var s=e[a+t];n[a<<1]=0,n[(a<<1)+1]=s,s>i&&(i=s),a++}for(;a<o;)n[a<<1]=0,n[(a<<1)+1]=0,a++;return i}function xf(e,t,r){return(e[t>>>3]|e[(t>>>3)+1]<<8)>>>(t&7)&(1<<r)-1}function d4(e,t,r){return(e[t>>>3]|e[(t>>>3)+1]<<8|e[(t>>>3)+2]<<16)>>>(t&7)&(1<<r)-1}function U5(e,t){return(e[t>>>3]|e[(t>>>3)+1]<<8|e[(t>>>3)+2]<<16)>>>(t&7)}function f4(e,t,r){for(var n=[],i=e.length,a=t.length,o=0;o<a;o+=2)t[o]=0,t[o+1]=0;for(var o=0;o<i;o++)e[o]!==0&&n.push({lit:o,f:e[o],d:void 0});var s=n.length,u=n.slice(0);if(s===0)return 0;if(s===1){var l=n[0].lit,c=l===0?1:0;return t[(l<<1)+1]=1,t[(c<<1)+1]=1,1}n.sort(function(g,y){return g.f-y.f});var d=n[0],f=n[1],p=0,v=1,h=2;for(n[0]={lit:-1,f:d.f+f.f,l:d,r:f,d:0};v!==s-1;)p!==v&&(h===s||n[p].f<n[h].f)?d=n[p++]:d=n[h++],p!==v&&(h===s||n[p].f<n[h].f)?f=n[p++]:f=n[h++],n[v++]={lit:-1,f:d.f+f.f,l:d,r:f,d:void 0};var m=j5(n[v-1],0);m>r&&(B5e(u,r,m),m=r);for(var o=0;o<s;o++)t[(u[o].lit<<1)+1]=u[o].d;return m}function j5(e,t){return e.lit!==-1?(e.d=t,t):Math.max(j5(e.l,t+1),j5(e.r,t+1))}function B5e(e,t,r){var n=0,i=1<<r-t,a=0;for(e.sort(function(s,u){return u.d===s.d?s.f-u.f:u.d-s.d}),n=0;n<e.length&&e[n].d>t;n++){var o=e[n].d;e[n].d=t,a+=i-(1<<r-o)}for(a=a>>>r-t;a>0;){var o=e[n].d;o<t?(e[n].d++,a-=1<<t-o-1):n++}for(;n>=0;n--)e[n].d===t&&a<0&&(e[n].d--,a++);a!==0&&console.log("debt left")}function U5e(e,t,r,n){var i=bt.lits,a=bt.strt,o=bt.prev;return{data:e,out:t,opt:z5e[n],i:0,pos:r<<3,cvrd:0,dlen:e.length,li:0,lc:0,bs:0,ebits:0,c:0,nc:0,lits:i,strt:a,prev:o}}function j5e(e,t){for(var r=e.data,n=e.dlen,i=e.out,a=e.opt,o=e.i,s=e.pos,u=e.cvrd,l=e.li,c=e.lc,d=e.bs,f=e.ebits,p=e.c,v=e.nc,h=bt.lits,m=bt.strt,g=bt.prev,y=Math.min(o+t,n);o<y;o++){if(p=v,o+1<n-2){v=aL(r,o+1);var b=o+1&32767;g[b]=m[v],m[v]=b}if(u<=o){(l>14e3||c>26697)&&n-o>100&&(u<o&&(h[l]=o-u,l+=2,u=o),s=wZ(o===n-1||u===n?1:0,h,l,f,r,d,o-d,i,s),l=c=f=0,d=o);var S=0;if(o<n-2&&(S=H5e(r,o,g,p,Math.min(a[2],n-o),a[3])),S!==0){var x=S>>>16,C=S&65535,w=$9(x,bt.of0);bt.lhst[257+w]++;var A=$9(C,bt.df0);bt.dhst[A]++,f+=bt.exb[w]+bt.dxb[A],h[l]=x<<23|o-u,h[l+1]=C<<16|w<<8|A,l+=2,u=o+x}else bt.lhst[r[o]]++;c++}}e.i=o,e.pos=s,e.cvrd=u,e.li=l,e.lc=c,e.bs=d,e.ebits=f,e.c=p,e.nc=v}var z5e=[[0,0,0,0,0],[4,4,8,4,0],[4,5,16,8,0],[4,6,16,16,0],[4,10,16,32,0],[8,16,32,32,0],[8,16,128,128,0],[8,32,128,256,0],[32,128,258,1024,1],[32,258,258,4096,1]];function V5e(e,t,r,n,i){return ce(this,void 0,void 0,function(){var a,o,s,u,l,c,d,f,p,v,h,m;return de(this,function(g){switch(g.label){case 0:if(a=U5e(t,r,n,i),o=a.dlen,i===0){for(s=a.i,u=a.pos;s<o;)l=Math.min(65535,o-s),vh(r,u,s+l===o?1:0),u=EZ(t,s,l,r,u+8),s+=l;return[2,u>>>3]}o>2&&(a.nc=aL(t,0),a.strt[a.nc]=0),g.label=1;case 1:return a.i<o?e.shouldUpdate?[4,e.update({message:"Deflating...",current:a.i,max:o})]:[3,3]:[3,4];case 2:g.sent(),g.label=3;case 3:return j5e(a,1024*1024),[3,1];case 4:for(c=a.li,d=a.cvrd,f=a.pos,p=a.i,v=a.lits,h=a.bs,m=a.ebits,(h!==p||t.length===0)&&(d<p&&(v[c]=p-d,c+=2,d=p),f=wZ(1,v,c,m,t,h,p-h,r,f));f&7;)f++;return[2,f>>>3]}})})}function H5e(e,t,r,n,i,a){var o=t&32767,s=r[o],u=o-s+(1<<15)&32767;if(s===o||n!==aL(e,t-u))return 0;for(var l=0,c=0,d=Math.min(32767,t);u<=d&&--a!==0&&s!==o;){if(l===0||e[t+l]===e[t+l-u]){var f=G5e(e,t,u);if(f>l){if(l=f,c=u,l>=i)break;u+2<f&&(f=u+2);for(var p=0,v=0;v<f-2;v++){var h=t-u+v+32768&32767,m=r[h],g=h-m+(1<<15)&32767;g>p&&(p=g,s=h)}}}o=s,s=r[o],u+=o-s+(1<<15)&32767}return l<<16|c}function G5e(e,t,r){if(e[t]!==e[t-r]||e[t+1]!==e[t+1-r]||e[t+2]!==e[t+2-r])return 0;var n=t,i=Math.min(e.length,t+258);for(t+=3;t<i&&e[t]===e[t-r];)t++;return t-n}function aL(e,t){return(e[t]<<8|e[t+1])+(e[t+2]<<4)&65535}function wZ(e,t,r,n,i,a,o,s,u){bt.lhst[256]++;var l=q5e(),c=l[0],d=l[1],f=l[2],p=l[3],v=l[4],h=l[5],m=l[6],g=l[7],y=(u+3&7?8-(u+3&7):0)+32+(o<<3),b=n+ay(bt.fltree,bt.lhst)+ay(bt.fdtree,bt.dhst),S=n+ay(bt.ltree,bt.lhst)+ay(bt.dtree,bt.dhst);S+=14+3*h+ay(bt.itree,bt.ihst)+(bt.ihst[16]*2+bt.ihst[17]*3+bt.ihst[18]*7);for(var x=0;x<286;x++)bt.lhst[x]=0;for(var x=0;x<30;x++)bt.dhst[x]=0;for(var x=0;x<19;x++)bt.ihst[x]=0;var C=y<b&&y<S?0:b<S?1:2;if(YS(s,u,e),YS(s,u+1,C),u+=3,C===0){for(;u&7;)u++;u=EZ(i,a,o,s,u)}else{var w=void 0,A=void 0;if(C===1)w=bt.fltree,A=bt.fdtree;else if(C===2){Jf(bt.ltree,c),g1(bt.ltree,c),Jf(bt.dtree,d),g1(bt.dtree,d),Jf(bt.itree,f),g1(bt.itree,f),w=bt.ltree,A=bt.dtree,vh(s,u,p-257),u+=5,vh(s,u,v-1),u+=5,vh(s,u,h-4),u+=4;for(var M=0;M<h;M++)vh(s,u+M*3,bt.itree[(bt.ordr[M]<<1)+1]);u+=3*h,u=G9(m,bt.itree,s,u),u=G9(g,bt.itree,s,u)}else throw new Error("unknown BTYPE "+C);for(var D=a,k=0;k<r;k+=2){for(var R=t[k],O=R>>>23,H=D+(R&(1<<23)-1);D<H;)u=Hy(i[D++],w,s,u);if(O!==0){var B=t[k+1],j=B>>16,Y=B>>8&255,G=B&255;u=Hy(257+Y,w,s,u),vh(s,u,O-bt.of0[Y]),u+=bt.exb[Y],u=Hy(G,A,s,u),YS(s,u,j-bt.df0[G]),u+=bt.dxb[G],D+=O}}u=Hy(256,w,s,u)}return u}function EZ(e,t,r,n,i){var a=i>>>3;return n[a]=r,n[a+1]=r>>>8,n[a+2]=255-n[a],n[a+3]=255-n[a+1],a+=4,n.set(new Uint8Array(e.buffer,t,r),a),i+(r+4<<3)}function q5e(){for(var e=f4(bt.lhst,bt.ltree,15),t=f4(bt.dhst,bt.dtree,15),r=[],n=q9(bt.ltree,r),i=[],a=q9(bt.dtree,i),o=0;o<r.length;o+=2)bt.ihst[r[o]]++;for(var o=0;o<i.length;o+=2)bt.ihst[i[o]]++;for(var s=f4(bt.ihst,bt.itree,7),u=19;u>4&&bt.itree[(bt.ordr[u-1]<<1)+1]===0;)u--;return[e,t,s,n,a,u,r,i]}function ay(e,t){for(var r=0,n=0;n<t.length;n++)r+=t[n]*e[(n<<1)+1];return r}function G9(e,t,r,n){for(var i=0;i<e.length;i+=2){var a=e[i],o=e[i+1];n=Hy(a,t,r,n);var s=a===16?2:a===17?3:7;a>15&&(vh(r,n,o),n+=s)}return n}function q9(e,t){for(var r=e.length;r!==2&&e[r-1]===0;)r-=2;for(var n=0;n<r;n+=2){var i=e[n+1],a=n+3<r?e[n+3]:-1,o=n+5<r?e[n+5]:-1,s=n===0?-1:e[n-1];if(i===0&&a===i&&o===i){for(var u=n+5;u+2<r&&e[u+2]===i;)u+=2;var l=Math.min(u+1-n>>>1,138);l<11?t.push(17,l-3):t.push(18,l-11),n+=l*2-2}else if(i===s&&a===i&&o===i){for(var u=n+5;u+2<r&&e[u+2]===i;)u+=2;var l=Math.min(u+1-n>>>1,6);t.push(16,l-3),n+=l*2-2}else t.push(i,0)}return r>>>1}function $9(e,t){var r=0;return t[r|16]<=e&&(r|=16),t[r|8]<=e&&(r|=8),t[r|4]<=e&&(r|=4),t[r|2]<=e&&(r|=2),t[r|1]<=e&&(r|=1),r}function Hy(e,t,r,n){return YS(r,n,t[e<<1]),n+t[(e<<1)+1]}function vh(e,t,r){r=r<<(t&7);var n=t>>>3;e[n]|=r,e[n+1]|=r>>>8}function YS(e,t,r){r=r<<(t&7);var n=t>>>3;e[n]|=r,e[n+1]|=r>>>8,e[n+2]|=r>>>16}function AZ(e,t,r){return r===void 0&&(r=!1),ce(this,void 0,void 0,function(){var n,i,a,o,s,u,l,c,d,f,p,v,h;return de(this,function(m){switch(m.label){case 0:for(n=Object.create(null),i=new Uint8Array(t),a=i.length-4;hh(i,a)!==101010256;)a--;o=a,o+=4,o+=4,s=Df(i,o),o+=2,o+=2,o+=4,u=hh(i,o),o+=4,o=u,l=0,m.label=1;case 1:return l<s?(o+=4,o+=4,o+=4,o+=4,o+=4,c=hh(i,o),o+=4,d=hh(i,o),o+=4,f=Df(i,o),p=Df(i,o+2),v=Df(i,o+4),o+=6,o+=8,h=hh(i,o),o+=4,o+=f+p+v,[4,$5e(e,i,h,n,c,d,r)]):[3,4];case 2:m.sent(),m.label=3;case 3:return l++,[3,1];case 4:return[2,n]}})})}function $5e(e,t,r,n,i,a,o){return ce(this,void 0,void 0,function(){var s,u,l,c,d,f;return de(this,function(p){switch(p.label){case 0:return r+=4,r+=2,r+=2,s=Df(t,r),r+=2,r+=4,r+=4,r+=8,u=Df(t,r),r+=2,l=Df(t,r),r+=2,c=M5e(t,r,u),r+=u,r+=l,o?(n[c]={size:a,csize:i},[2]):(d=new Uint8Array(t.buffer,r),s!==0?[3,1]:(n[c]=new Uint8Array(d.buffer.slice(r,r+i)),[3,4]));case 1:return s!==8?[3,3]:(f=new Uint8Array(a),[4,PZ(e,d,f)]);case 2:return p.sent(),n[c]=f,[3,4];case 3:throw"unknown compression method: "+s;case 4:return[2]}})})}function PZ(e,t,r){return ce(this,void 0,void 0,function(){return de(this,function(n){return[2,F5e(e,t,r)]})})}function W5e(e,t,r){return ce(this,void 0,void 0,function(){var n,i,a,o,o,s,u,l,c,d;return de(this,function(f){switch(f.label){case 0:if(n=t[3],i=10,n&4&&(a=Df(t,i),i+=a),n&8){for(o=i;t[o]!==0;)++o;i=o+1}if(n&16){for(o=i;t[o]!==0;)++o;i=o+1}return n&1&&(i+=2),s=P5e(hh(t,t.length-8)),u=hh(t,t.length-4),r===void 0&&(r=new Uint8Array(u)),l=new Uint8Array(t.buffer,t.byteOffset+i,t.length-i-8),[4,PZ(e,l,r)];case 1:return c=f.sent(),d=_Z(c,0,c.length),s!==d&&console.error("ungzip: checksums don't match"),[2,c]}})})}function X5e(e,t,r){return ce(this,void 0,void 0,function(){var n,i;return de(this,function(a){switch(a.label){case 0:return r===void 0&&(r={level:6}),n=new Uint8Array(50+Math.floor(t.length*1.1)),[4,V5e(e,t,n,0,r.level)];case 1:return i=a.sent(),[2,new Uint8Array(n.buffer,0,i)]}})})}function Y5e(e,t){return t===void 0&&(t=!1),$e.create("Zip",function(r){return K5e(r,e,t)})}function K5e(e,t,r){return r===void 0&&(r=!1),ce(this,void 0,void 0,function(){var n,i,a,o,s,b,u,l,c,d,f,p,b,v,h,m,b,S,g,y,b,S,x,C;return de(this,function(w){switch(w.label){case 0:n=0,i={},a=[];for(o in t)a.push(o);s=0,w.label=1;case 1:return s<a.length?(b=a[s],u=!Q5e(b)&&!r,l=t[b],c=_Z(l,0,l.length),d=i,f=b,C={cpr:u,usize:l.length,crc:c},u?[4,X5e(e,l)]:[3,3]):[3,6];case 2:return p=w.sent(),[3,4];case 3:p=l,w.label=4;case 4:d[f]=(C.file=p,C),w.label=5;case 5:return s++,[3,1];case 6:for(b in i)n+=i[b].file.length+30+46+2*CZ(b);n+=22,v=new Uint8Array(n),h=0,m=[];for(b in i)S=i[b],m.push(h),h=W9(v,h,b,S,0);g=0,y=h;for(b in i)S=i[b],m.push(h),h=W9(v,h,b,S,1,m[g++]);return x=h-y,mc(v,h,101010256),h+=4,h+=4,ph(v,h,g),h+=2,ph(v,h,g),h+=2,mc(v,h,x),h+=4,mc(v,h,y),h+=4,h+=2,[2,v.buffer]}})})}function Q5e(e){var t=e.split(".").pop().toLowerCase();return"png,jpg,jpeg,zip".indexOf(t)!==-1}function W9(e,t,r,n,i,a){a===void 0&&(a=0);var o=n.file;mc(e,t,i===0?67324752:33639248),t+=4,i===1&&(t+=2),ph(e,t,20),t+=2,ph(e,t,0),t+=2,ph(e,t,n.cpr?8:0),t+=2,mc(e,t,0),t+=4,mc(e,t,n.crc),t+=4,mc(e,t,o.length),t+=4,mc(e,t,n.usize),t+=4,ph(e,t,CZ(r)),t+=2,ph(e,t,0),t+=2,i===1&&(t+=2,t+=2,t+=6,mc(e,t,a),t+=4);var s=D5e(e,t,r);return t+=s,i===0&&(e.set(o,t),t+=o.length),t}function $m(e,t,r){for(var n=0,i=r.length;n<i;n++){var a=r.charCodeAt(n);if(a<128){e[t++]=a>>>0&127|0;continue}if(a<2048){e[t++]=a>>>6&31|192,e[t++]=a>>>0&63|128;continue}if(a<65536){e[t++]=a>>>12&15|224,e[t++]=a>>>6&63|128,e[t++]=a>>>0&63|128;continue}if(a<1114112){e[t++]=a>>>18&7|240,e[t++]=a>>>12&63|128,e[t++]=a>>>6&63|128,e[t++]=a>>>0&63|128;continue}throw new Error("bad codepoint "+a)}}var Z5e=function(){for(var e=[],t=0;t<1024;t++)e[t]=String.fromCharCode(t);return e}();function TZ(e){throw new Error(e)}function J5e(e,t,r){for(var n=Z5e,i=void 0,a=[],o=512,s=0,u=t,l=t+r;u<l;u++){var c=e[u];c&128?(c&224)===192?a[s++]=n[(c&15)<<6|e[++u]&63]:(c&240)===224?a[s++]=String.fromCharCode((c&15)<<12|(e[++u]&63)<<6|(e[++u]&63)<<0):(c&248)===240?a[s++]=String.fromCharCode((c&7)<<18|(e[++u]&63)<<12|(e[++u]&63)<<6|(e[++u]&63)<<0):TZ("Invalid byte "+c.toString(16)):a[s++]=n[c],s===o&&(i=i||[],i[i.length]=a.join(""),s=0)}return i?(s>0&&(i[i.length]=a.slice(0,s).join("")),i.join("")):a.slice(0,s).join("")}var X9=typeof TextDecoder<"u"?new TextDecoder:void 0;function oL(e,t,r){if(X9){var n=t||r!==e.length?e.subarray(t,t+r):e;return X9.decode(n)}else return J5e(e,t,r)}function R_(e){for(var t=0,r=0,n=e.length;r<n;r++){var i=e.charCodeAt(r);if(i<128){t+=1;continue}if(i<2048){t+=2;continue}if(i<65536){t+=3;continue}if(i<1114112){t+=4;continue}TZ("bad codepoint "+i)}return t}var eDe=typeof document>"u"?require("xhr2"):XMLHttpRequest,Iu;(function(e){e[e.None=0]="None",e[e.Gzip=1]="Gzip",e[e.Zip=2]="Zip"})(Iu||(Iu={}));function Rf(e,t){return aDe(e,t)}function z5(e){return typeof e=="string"?K9(e,e,"string"):K9(e.title,e.url,e.type||"string",e.body,e.headers)}function tDe(e){if(e instanceof FileReader)return e.readyState===FileReader.DONE;if(e instanceof XMLHttpRequest)return e.readyState===XMLHttpRequest.DONE;throw new Error("unknown data type")}function Y9(e){return e?"Failed to download data. Possible reasons: Resource is not available, or CORS is not allowed on the server.":"Failed to open file."}function IZ(e,t,r){return new Promise(function(n,i){if(tDe(r)){var a=r.error;a!=null?i(a??Y9(r instanceof XMLHttpRequest)):n(r);return}var o=!1;r.onerror=function(s){if(!o){var u=s.target.error;i(u??Y9(r instanceof XMLHttpRequest))}},r.onprogress=function(s){if(!(!e.shouldUpdate||o))try{s.lengthComputable?e.update({message:t,isIndeterminate:!1,current:s.loaded,max:s.total}):e.update({message:t+" "+(s.loaded/1024/1024).toFixed(2)+" MB",isIndeterminate:!0})}catch(u){o=!0,i(u)}},r.onload=function(s){n(r)}})}function rDe(e){return/\.gz$/i.test(e)?Iu.Gzip:/\.zip$/i.test(e)?Iu.Zip:Iu.None}function nDe(e,t,r){return ce(this,void 0,void 0,function(){var n,i,a;return de(this,function(o){switch(o.label){case 0:switch(n=r,n){case Iu.None:return[3,1];case Iu.Gzip:return[3,2];case Iu.Zip:return[3,3]}return[3,5];case 1:return[2,t];case 2:return[2,W5e(e,t)];case 3:return[4,AZ(e,t.buffer)];case 4:if(i=o.sent(),a=Object.keys(i),a.length!==1)throw new Error("can only decompress zip files with a single entry");return[2,i[a[0]]];case 5:return[2]}})})}function iDe(e,t,r,n){return ce(this,void 0,void 0,function(){var i,a,o,s;return de(this,function(u){switch(u.label){case 0:if(i=t.result,a=i instanceof ArrayBuffer?new Uint8Array(i):i,a===null)throw new Error("no data given");if(n===Iu.None)return[3,4];if(!(a instanceof Uint8Array))throw new Error("need Uint8Array for decompression");return[4,nDe(e,a,n)];case 1:return o=u.sent(),r!=="string"?[3,3]:[4,e.update({message:"Decoding text..."})];case 2:return u.sent(),a=oL(o,0,o.length),[3,4];case 3:a=o,u.label=4;case 4:return r==="binary"&&a instanceof Uint8Array?[2,a]:[3,5];case 5:return r==="zip"&&a instanceof Uint8Array?[4,AZ(e,a.buffer)]:[3,7];case 6:return[2,u.sent()];case 7:if(r==="string"&&typeof a=="string")return[2,a];if(r==="xml"&&typeof a=="string")return s=new DOMParser,[2,s.parseFromString(a,"application/xml")];if(r==="json"&&typeof a=="string")return[2,JSON.parse(a)];u.label=8;case 8:throw new Error("could not get requested response data '"+r+"'")}})})}function aDe(e,t){var r=this,n=void 0;return $e.create("Read File",function(i){return ce(r,void 0,void 0,function(){var a,o;return de(this,function(s){switch(s.label){case 0:return s.trys.push([0,,5,6]),n=new FileReader,a=t==="zip"?Iu.None:rDe(e.name),t==="binary"||t==="zip"||a!==Iu.None?n.readAsArrayBuffer(e):n.readAsText(e),[4,i.update({message:"Opening file...",canAbort:!0})];case 1:return s.sent(),[4,IZ(i,"Reading...",n)];case 2:return o=s.sent(),[4,i.update({message:"Processing file...",canAbort:!1})];case 3:return s.sent(),[4,iDe(i,o,t,a)];case 4:return[2,s.sent()];case 5:return n=void 0,[7];case 6:return[2]}})})},function(){n&&n.abort()})}var V5=function(){function e(){}return e.get=function(){return this.pool.length?this.pool.pop():new eDe},e.emptyFunc=function(){},e.deposit=function(t){this.pool.length<this.poolSize&&(t.onabort=e.emptyFunc,t.onerror=e.emptyFunc,t.onload=e.emptyFunc,t.onprogress=e.emptyFunc,this.pool.push(t))},e.pool=[],e.poolSize=15,e}();function oDe(e,t){if(e.status>=200&&e.status<400){var r=e.response;if(V5.deposit(e),(t==="binary"||t==="zip")&&r instanceof ArrayBuffer)return new Uint8Array(r);if(t==="string"&&typeof r=="string")return r;if(t==="xml"&&r instanceof XMLDocument)return r;if(t==="json"&&typeof r=="object")return r;throw new Error("could not get requested response data '"+t+"'")}else throw V5.deposit(e),new Error("Download failed with status code "+e.status)}function sDe(e){switch(e){case"json":return"json";case"xml":return"document";case"string":return"text";case"binary":return"arraybuffer";case"zip":return"arraybuffer"}}function K9(e,t,r,n,i){var a=this,o=void 0;return $e.create(e||"Download",function(s){return ce(a,void 0,void 0,function(){var u,l,c,d,f,p,v;return de(this,function(h){switch(h.label){case 0:if(o=V5.get(),o.open(n?"post":"get",t,!0),i)for(u=0,l=i;u<l.length;u++)c=l[u],d=c[0],f=c[1],o.setRequestHeader(d,f);return o.responseType=sDe(r),o.send(n),[4,s.update({message:"Waiting for server...",canAbort:!0})];case 1:return h.sent(),[4,IZ(s,"Downloading...",o)];case 2:return p=h.sent(),o=void 0,[4,s.update({message:"Parsing response...",canAbort:!1})];case 3:return h.sent(),v=oDe(p,r),[2,v]}})})},function(){o&&(o.abort(),o=void 0)})}function uDe(e,t,r,n){return ce(this,void 0,void 0,function(){var i,a,o,s,u,l,v,c,d,f,p,v,h;return de(this,function(m){switch(m.label){case 0:return i=r.length,a=new Array(r.length),[4,e.update({message:"Downloading...",current:0,max:i})];case 1:for(m.sent(),o=[],s=[],u=0,l=Math.min(i,n);u<l;u++)v=r[u],o.push(Z9(u,v.id,t.resolve(Pn.getUrlAsset(t,v.url),v.isBinary?"binary":"string").runAsChild(e))),s.push(u);c=0,m.label=2;case 2:return o.length>0?[4,Promise.race(o)]:[3,6];case 3:if(d=m.sent(),f=r[d.index],p=s.indexOf(d.index),c++,d.kind==="error"&&!f.canFail)throw new Error(f.url+": "+d.error);return e.shouldUpdate?[4,e.update({message:"Downloading...",current:c,max:i})]:[3,5];case 4:m.sent(),m.label=5;case 5:return a[d.index]=d,o=o.filter(Q9,p),s=s.filter(Q9,p),u<i&&(v=r[u],h=t.resolve(Pn.getUrlAsset(t,v.url),v.isBinary?"binary":"string").runAsChild(e),o.push(Z9(u,v.id,h)),s.push(u),u++),[3,2];case 6:return[2,a]}})})}function Q9(e,t){return this!==t}function Z9(e,t,r){return ce(this,void 0,void 0,function(){var n,i;return de(this,function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),[4,r];case 1:return n=a.sent(),[2,{kind:"ok",result:n,index:e,id:t}];case 2:return i=a.sent(),[2,{kind:"error",error:i,index:e,id:t}];case 3:return[2]}})})}var Pn;(function(e){function t(u,l){return E({kind:"url",id:mn.create22(),url:u},l)}e.Url=t;function r(u){return{kind:"file",id:mn.create22(),name:u.name,file:u}}e.File=r;function n(u){return(u==null?void 0:u.kind)==="url"}e.isUrl=n;function i(u){return(u==null?void 0:u.kind)==="file"}e.isFile=i;function a(u,l,c){return{data:u,dispose:function(){c.release(l)}}}e.Wrapper=a;function o(u){return typeof u=="string"?u:u.url}e.getUrl=o;function s(u,l,c){if(typeof l=="string"){var d=u.tryFindUrl(l,c);return d||t(l,{body:c})}return l}e.getUrlAsset=s})(Pn||(Pn={}));var lDe=function(){function e(){this._assets=new Map}return Object.defineProperty(e.prototype,"assets",{get:function(){return ZO(this._assets.values())},enumerable:!1,configurable:!0}),e.prototype.tryFindUrl=function(t,r){for(var n=this.assets.values();;){var i=n.next();if(i.done)return;var a=i.value.asset;if(Pn.isUrl(a)&&a.url===t&&(a.body||"")===(r||""))return a}},e.prototype.set=function(t,r){this._assets.set(t.id,{asset:t,file:r,refCount:0})},e.prototype.resolve=function(t,r,n){var i=this;return n===void 0&&(n=!0),Pn.isUrl(t)?$e.create("Download "+(t.title||t.url),function(a){return ce(i,void 0,void 0,function(){var o,s,u,l,c,d,f,p,v;return de(this,function(h){switch(h.label){case 0:return this._assets.has(t.id)?(o=this._assets.get(t.id),o.refCount++,u=(s=Pn).Wrapper,[4,Rf(o.file,r).runInContext(a)]):[3,2];case 1:return[2,u.apply(s,[h.sent(),t,this])];case 2:return n?[3,4]:(c=(l=Pn).Wrapper,[4,z5(E(E({},t),{type:r})).runInContext(a)]);case 3:return[2,c.apply(l,[h.sent(),t,this])];case 4:return[4,z5(E(E({},t),{type:"binary"})).runInContext(a)];case 5:return d=h.sent(),f=new File([d],"raw-data"),this._assets.set(t.id,{asset:t,file:f,refCount:1}),v=(p=Pn).Wrapper,[4,Rf(f,r).runInContext(a)];case 6:return[2,v.apply(p,[h.sent(),t,this])]}})})}):$e.create("Read "+t.name,function(a){return ce(i,void 0,void 0,function(){var o,s,u,l,c;return de(this,function(d){switch(d.label){case 0:return this._assets.has(t.id)?(o=this._assets.get(t.id),o.refCount++,u=(s=Pn).Wrapper,[4,Rf(o.file,r).runInContext(a)]):[3,2];case 1:return[2,u.apply(s,[d.sent(),t,this])];case 2:if(!(t.file instanceof File))throw new Error("Cannot resolve file asset '"+t.name+"' ("+t.id+")");return n&&this._assets.set(t.id,{asset:t,file:t.file,refCount:1}),c=(l=Pn).Wrapper,[4,Rf(t.file,r).runInContext(a)];case 3:return[2,c.apply(l,[d.sent(),t,this])]}})})})},e.prototype.release=function(t){var r=this._assets.get(t.id);r&&(r.refCount--,r.refCount<=0&&this._assets.delete(t.id))},e}(),I;(function(e){e.Essential={isEssential:!0};function t(ie,oe){return oe&&(oe.label&&(ie.label=oe.label),oe.description&&(ie.description=oe.description),oe.legend&&(ie.legend=oe.legend),oe.fieldLabels&&(ie.fieldLabels=oe.fieldLabels),oe.isHidden&&(ie.isHidden=oe.isHidden),oe.shortLabel&&(ie.shortLabel=oe.shortLabel),oe.twoColumns&&(ie.twoColumns=oe.twoColumns),oe.isEssential&&(ie.isEssential=oe.isEssential),oe.category&&(ie.category=oe.category),oe.hideIf&&(ie.hideIf=oe.hideIf),oe.help&&(ie.help=oe.help)),ie}function r(ie){var oe=E({},ie);return oe.isOptional=!0,oe}e.Optional=r;function n(ie,oe){return t({type:"value",defaultValue:ie},oe)}e.Value=n;function i(ie,oe,L){return t({type:"select",defaultValue:Se(ie,oe),options:oe,cycle:L==null?void 0:L.cycle},L)}e.Select=i;function a(ie,oe,L){var V=t({type:"multi-select",defaultValue:ie,options:oe},L);return L!=null&&L.emptyValue&&(V.emptyValue=L.emptyValue),V}e.MultiSelect=a;function o(ie,oe){return t({type:"boolean",defaultValue:ie},oe)}e.Boolean=o;function s(ie,oe){return ie===void 0&&(ie=""),t({type:"text",defaultValue:ie},oe)}e.Text=s;function u(ie,oe){var L=t({type:"color",defaultValue:ie},oe);return oe!=null&&oe.isExpanded&&(L.isExpanded=oe.isExpanded),L}e.Color=u;function l(ie,oe){var L;if(typeof ie=="string"){var V=$s(ie);L={kind:V.type!=="qualitative"?"interpolate":"set",colors:V.list}}else L=ie;return t({type:"color-list",presetKind:(oe==null?void 0:oe.presetKind)||"all",defaultValue:L,offsets:!!(oe!=null&&oe.offsets)},oe)}e.ColorList=l;function c(ie,oe,L){return t(h({type:"vec3",defaultValue:ie},oe),L)}e.Vec3=c;function d(ie,oe){return t({type:"mat4",defaultValue:ie},oe)}e.Mat4=d;function f(ie,oe){var L=typeof ie=="string"?Pn.Url(ie):Pn.Url(ie.url,{body:ie.body}),V=t({type:"url",defaultValue:L},oe);return V}e.Url=f;function p(ie){var oe=t({type:"file",defaultValue:null},ie);return ie!=null&&ie.accept&&(oe.accept=ie.accept),oe}e.File=p;function v(ie){var oe=t({type:"file-list",defaultValue:null},ie);return ie!=null&&ie.accept&&(oe.accept=ie.accept),oe}e.FileList=v;function h(ie,oe){return oe&&(typeof oe.min<"u"&&(ie.min=oe.min),typeof oe.max<"u"&&(ie.max=oe.max),typeof oe.step<"u"&&(ie.step=oe.step)),ie}function m(ie,oe,L){var V=t(h({type:"number",defaultValue:ie},oe),L);return L!=null&&L.immediateUpdate&&(V.immediateUpdate=!0),V}e.Numeric=m;function g(ie,oe,L){return t(h({type:"interval",defaultValue:ie},oe),L)}e.Interval=g;function y(ie,oe){return t({type:"line-graph",defaultValue:ie},oe)}e.LineGraph=y;function b(ie,oe){var L=t({type:"group",defaultValue:(oe==null?void 0:oe.customDefault)||j(ie),params:ie},oe);return oe!=null&&oe.isExpanded&&(L.isExpanded=oe.isExpanded),oe!=null&&oe.isFlat&&(L.isFlat=oe.isFlat),oe!=null&&oe.pivot&&(L.pivot=oe.pivot),L}e.Group=b;function S(ie){return b({},ie)}e.EmptyGroup=S;function x(ie,oe,L,V){var he=Se(ie,oe);return t({type:"mapped",defaultValue:{name:he,params:L(he).defaultValue},select:i(he,oe,V),map:L},V)}e.Mapped=x;function C(ie,oe,L){var V=L!=null&&L.options?L.options:Object.keys(oe).map(function(we){return[we,oe[we].label||Zo(we)]}),he=Se(ie,V);return t({type:"mapped",defaultValue:{name:he,params:oe[he].defaultValue},select:i(he,V,L),map:function(we){return oe[we]}},L)}e.MappedStatic=C;function w(ie,oe,L){return t({type:"object-list",element:ie,getLabel:oe,ctor:A,defaultValue:(L==null?void 0:L.defaultValue)||[]},L)}e.ObjectList=w;function A(){return j(this.element)}function M(){throw new Error("getValue not set. Fix runtime.")}function D(ie,oe,L){var V;return t({type:"value-ref",defaultValue:{ref:(V=L==null?void 0:L.defaultRef)!==null&&V!==void 0?V:"",getValue:M},getOptions:ie,resolveRef:oe},L)}e.ValueRef=D;function k(ie){var oe;return t({type:"data-ref",defaultValue:{ref:(oe=ie==null?void 0:ie.defaultRef)!==null&&oe!==void 0?oe:"",getValue:M}},ie)}e.DataRef=k;function R(ie,oe,L){return{type:"converted",defaultValue:oe(L.defaultValue),converted:L,fromValue:ie,toValue:oe}}e.Converted=R;function O(ie,oe,L,V,he){var we=Object.keys(oe).map(function(Te){return[Te,Te]});return t({type:"conditioned",select:i(L(ie),we,he),defaultValue:ie,conditionParams:oe,conditionForValue:L,conditionedValue:V},he)}e.Conditioned=O;function H(ie,oe){return t({type:"script",defaultValue:ie},oe)}e.Script=H;function B(ie){return 0}e.For=B;function j(ie){for(var oe={},L=0,V=Object.keys(ie);L<V.length;L++){var he=V[L];ie[he].isOptional||(oe[he]=ie[he].defaultValue)}return oe}e.getDefaultValues=j;function Y(ie,oe){return function(){return ie(oe)}}function G(ie,oe,L){if(oe){if(ie.type==="value-ref"){var V=oe;V.ref?V.getValue=Y(ie.resolveRef,V.ref):V.getValue=function(){throw new Error("Unset ref in ValueRef value.")}}else if(ie.type==="data-ref"){var V=oe;V.ref?V.getValue=Y(L,V.ref):V.getValue=function(){throw new Error("Unset ref in ValueRef value.")}}else if(ie.type==="group")ee(ie.params,oe,L);else if(ie.type==="mapped"){var V=oe,he=ie.map(V.name);G(he,V.params,L)}else if(ie.type==="object-list"){if(!q(ie.element))return;for(var we=0,Te=oe;we<Te.length;we++){var ze=Te[we];ee(ie.element,ze,L)}}}}function $(ie){if(ie.type==="value-ref"||ie.type==="data-ref")return!0;if(ie.type==="group"){if(q(ie.params))return!0}else if(ie.type==="mapped")for(var oe=0,L=ie.select.options;oe<L.length;oe++){var V=L[oe][0];if($(ie.map(V)))return!0}else if(ie.type==="object-list")return q(ie.element);return!1}function q(ie){for(var oe=0,L=Object.keys(ie);oe<L.length;oe++){var V=L[oe];if($(ie[V]))return!0}return!1}function ee(ie,oe,L){for(var V=0,he=Object.keys(ie);V<he.length;V++){var we=he[V];G(ie[we],oe==null?void 0:oe[we],L)}}e.resolveRefs=ee;function fe(ie,oe){for(var L=0,V=Object.keys(ie);L<V.length;L++){var he=V[L];ie[he].isOptional||(ie[he].defaultValue=oe[he])}}e.setDefaultValues=fe;function W(ie){return cp(ie)}e.clone=W;function X(ie,oe){}e.validate=X;function U(ie,oe,L){if(oe===L)return!0;if(typeof oe!="object"||typeof L!="object")return!1;for(var V=0,he=Object.keys(ie);V<he.length;V++){var we=he[V];if(!z(ie[we],oe[we],L[we]))return!1}return!0}e.areEqual=U;function z(ie,oe,L){if(oe===L)return!0;if(ie.type==="group")return U(ie.params,oe,L);if(ie.type==="mapped"){var V=oe,he=L;if(V.name!==he.name)return!1;var we=ie.map(V.name);return z(we,V.params,he.params)}else if(ie.type==="multi-select"){var V=oe,he=L;if(V.length!==he.length)return!1;if(V.length<10){for(var Te=0,ze=V.length;Te<ze;Te++)if(V[Te]!==he[Te]&&he.indexOf(V[Te])<0)return!1}else for(var Ve=new Set(he),Te=0,ze=V.length;Te<ze;Te++)if(V[Te]!==he[Te]&&!Ve.has(V[Te]))return!1;return!0}else{if(ie.type==="interval")return oe[0]===L[0]&&oe[1]===L[1];if(ie.type==="line-graph"){var V=oe,he=L;if(V.length!==he.length)return!1;for(var Te=0,ze=V.length;Te<ze;Te++)if(!He.areEqual(V[Te],he[Te]))return!1;return!0}else{if(ie.type==="vec3")return _.equals(oe,L);if(ie.type==="mat4")return ue.areEqual(oe,L,xn);if(ie.type==="script"){var V=oe,he=L;return V.language===he.language&&V.expression===he.expression}else if(ie.type==="object-list"){var V=oe,he=L,Xe=V.length;if(Xe!==he.length)return!1;for(var Te=0;Te<Xe;Te++)if(!U(ie.element,V[Te],he[Te]))return!1;return!0}else if(typeof oe=="object"&&typeof L=="object")return Hg(oe,L)}}return!1}e.isParamEqual=z;function J(ie,oe,L){if(oe===void 0)return E({},L);if(L===void 0)return E({},oe);for(var V=Object.create(null),he=0,we=Object.keys(ie);he<we.length;he++){var Te=we[he];V[Te]=K(ie[Te],oe[Te],L[Te])}return V}e.merge=J;function K(ie,oe,L){if(oe===void 0)return typeof L=="object"&&!Array.isArray(L)?E({},L):L;if(L===void 0)return typeof oe=="object"&&!Array.isArray(oe)?E({},oe):oe;if(ie.type==="group")return J(ie.params,oe,L);if(ie.type==="mapped"){var V=oe,he=L;if(V.name!==he.name)return E({},he);var we=ie.map(he.name);return{name:he.name,params:K(we,V.params,he.params)}}else return ie.type==="value"?L:typeof oe=="object"&&typeof L=="object"?Array.isArray(L)?L:E(E({},oe),L):L}e.mergeParam=K;function Z(ie,oe){for(var L=0,V=ie.options;L<V.length;L++){var he=V[L];if(he[0]===oe)return!0}return!1}function te(ie,oe,L){if(oe==null)return L?ie.defaultValue:void 0;if(ie.type==="value")return oe;if(ie.type==="group"){for(var V=Object.create(null),he=0,we=Object.keys(ie.params);he<we.length;he++){var Te=we[he],ze=ie.params[Te];oe[Te]===void 0?L&&(V[Te]=ze.defaultValue):V[Te]=te(ze,oe[Te],L)}return V}else if(ie.type==="mapped"){var Ve=oe;if(typeof Ve.name!="string")return ie.defaultValue;if(typeof Ve.params>"u")return L?ie.defaultValue:void 0;if(!Z(ie.select,Ve.name))return ie.defaultValue;var ze=ie.map(Ve.name);return{name:Ve.name,params:te(ze,Ve.params,L)}}else{if(ie.type==="select")return Z(ie,oe)?oe:ie.defaultValue;if(ie.type==="multi-select"){if(!Array.isArray(oe))return ie.defaultValue;var V=oe.filter(function(ct){return Z(this,ct)},ie);return oe.length>0&&V.length===0?ie.defaultValue:V}else if(ie.type==="object-list")return Array.isArray(oe)?oe.map(function(Xe){return le(ie.element,Xe,L?"all":"skip")}):ie.defaultValue}return oe}function le(ie,oe,L){if(typeof oe!="object"||oe===null)return L?j(ie):oe;for(var V=Object.create(null),he=0,we=Object.keys(ie);he<we.length;he++){var Te=we[he],ze=ie[Te];oe[Te]===void 0?L==="all"&&(V[Te]=ze.defaultValue):V[Te]=te(ze,oe[Te],L!=="skip")}return V}e.normalizeParams=le;function ye(ie,oe){for(var L=[],V=0,he=Object.keys(ie);V<he.length;V++){var we=he[V];if(!oe)typeof ie[we]=="string"?L.push([we,ie[we]]):L.push([we,oe===null?we:Zo(we)]);else{var Te=oe(we,ie[we]);L.push(typeof Te=="string"?[we,Te]:[we,Te[0],Te[1]])}}return L}e.objectToOptions=ye;function be(ie,oe){for(var L=[],V=0,he=ie;V<he.length;V++){var we=he[V];oe?L.push([we,oe(we)]):L.push([we,oe===null?we:Zo(we)])}return L}e.arrayToOptions=be;function Ae(ie,oe){for(var L=0,V=ie.options;L<V.length;L++){var he=V[L];if(he[0]===oe)return he[1]}return""}e.optionLabel=Ae;function Se(ie,oe){for(var L=0,V=oe;L<V.length;L++){var he=V[L];if(he[0]===ie)return ie}return oe.length>0?oe[0][0]:void 0}})(I||(I={}));var Po;(function(e){function t(i){var a={create:function(o){return{action:a,params:o}},id:mn.create22(),definition:i,createDefaultParams:function(o,s){return i.params?I.getDefaultValues(i.params(o,s)):{}}};return a}e.create=t;function r(i){var a=i.definition;return t({from:a.from,display:a.display,params:a.params,isApplicable:i.definition.isApplicable?function(o,s,u){return i.definition.isApplicable(o,u)}:void 0,run:function(o){var s=o.cell,u=o.state,l=o.params,c=u.build().to(s.transform.ref).apply(i,l);return u.updateTree(c)}})}e.fromTransformer=r;var n;(function(i){function a(o){return function(s){return t(E({from:o.from instanceof Array?o.from:o.from?[o.from]:[],display:typeof o.display=="string"?{name:o.display}:o.display?o.display:{name:"Unnamed State Action"},params:typeof o.params=="object"?function(){return o.params}:o.params?o.params:void 0,isApplicable:o.isApplicable},typeof s=="function"?{run:s}:s))}}i.build=function(o){return a(o)}})(n=e.Builder||(e.Builder={})),e.build=n.build})(Po||(Po={}));var ft;(function(e){function t(h,m,g){return h.definition.params?h.definition.params(m,g):{}}e.getParamDefinition=t;function r(h){return!!h&&typeof h.toAction=="function"&&typeof h.apply=="function"}e.is=r;var n;(function(h){h[h.Unchanged=0]="Unchanged",h[h.Updated=1]="Updated",h[h.Recreate=2]="Recreate",h[h.Null=3]="Null"})(n=e.UpdateResult||(e.UpdateResult={}));var i=new Map,a=new Map;function o(h){for(var m=0,g=h.definition.from;m<g.length;m++){var y=g[m];a.has(y.type)?a.get(y.type).push(h):a.set(y.type,[h])}}function s(){return Array.from(i.values())}e.getAll=s;function u(h){var m=i.get(h);if(!m)throw new Error("A transformer with signature '"+h+"' is not registered.");return m}e.get=u;function l(h){return a.get(h)||[]}e.fromType=l;function c(h,m){var g=m.name,y=h+"."+g;if(i.has(y))throw new Error("A transform with id '"+g+"' is already registered. Please pick a unique identifier for your transforms and/or register them only once. This is to ensure that transforms can be serialized and replayed.");var b={apply:function(S,x,C){return cr.create(S,b,x,C)},toAction:function(){return Po.fromTransformer(b)},namespace:h,id:y,definition:m,createDefaultParams:function(S,x){return m.params?I.getDefaultValues(m.params(S,x)):{}}};return i.set(y,b),o(b),b}e.create=c;function d(h){return function(m){return c(h,m)}}e.factory=d;function f(h){return p.build(h)}e.builderFactory=f;var p;(function(h){function m(y,b){return function(S){return c(y,E({name:b.name,from:b.from instanceof Array?b.from:[b.from],to:b.to instanceof Array?b.to:[b.to],display:typeof b.display=="string"?{name:b.display}:b.display?b.display:{name:h0(b.name.replace(/[-]/g," "))},params:typeof b.params=="object"?function(){return b.params}:b.params?b.params:void 0,isDecorator:b.isDecorator},S))}}function g(y){return function(b){return m(y,b)}}h.build=g})(p=e.Builder||(e.Builder={}));function v(h){return p.build(h)}e.build=v,e.ROOT=c("build-in",{name:"root",from:[],to:[],display:{name:"Root",description:"For internal use."},apply:function(){throw new Error("should never be applied")},update:function(){return n.Unchanged}})})(ft||(ft={}));var cr;(function(e){e.RootRef="-=root=-";function t(m,g){return!!m.isHidden!=!!g.isHidden||!!m.isCollapsed!=!!g.isCollapsed||!!m.isGhost!=!!g.isGhost||!!m.isLocked!=!!g.isLocked}e.areStatesEqual=t;function r(m,g){return g?typeof g.isCollapsed<"u"&&m.isCollapsed!==g.isCollapsed||typeof g.isHidden<"u"&&m.isHidden!==g.isHidden||typeof g.isGhost<"u"&&m.isGhost!==g.isGhost||typeof g.isLocked<"u"&&m.isLocked!==g.isLocked:!1}e.isStateChange=r;function n(m,g){if(!g)return!1;for(var y=!1,b=0,S=Object.keys(g);b<S.length;b++){var x=S[b],C=g[x],w=m[x];!!C!=!!w&&(y=!0,m[x]=C)}return y}e.assignState=n;function i(m,g){if(!g)return!1;for(var y=!1,b=0,S=Object.keys(g);b<S.length;b++){var x=S[b],C=g[x],w=m[x];!!C!=!!w&&(y=!0,m[x]=C)}for(var A=0,M=Object.keys(m);A<M.length;A++){var x=M[A],C=g[x],w=m[x];!!C!=!!w&&(y=!0,m[x]=C)}return y}e.syncState=i;function a(m,g,y,b){var S=b&&b.ref?b.ref:mn.create22(),x=void 0;return b&&b.tags&&(x=typeof b.tags=="string"?[b.tags]:b.tags,x.length===0?x=void 0:x.sort()),{parent:m,transformer:g,state:(b==null?void 0:b.state)||{},tags:x,ref:S,dependsOn:b&&b.dependsOn,params:y,version:mn.create22()}}e.create=a;function o(m,g){return E(E({},m),{params:g,version:mn.create22()})}e.withParams=o;function s(m,g){return g?E(E({},m),{state:E(E({},m.state),g)}):m}e.withState=s;function u(m,g){var y=void 0;return g&&(y=typeof g=="string"?[g]:g,y.length===0?y=void 0:y.sort()),E(E({},m),{tags:y,version:mn.create22()})}e.withTags=u;function l(m,g){return E(E({},m),{parent:g,version:mn.create22()})}e.withParent=l;function c(m){return a(e.RootRef,ft.ROOT,{},{ref:e.RootRef,state:m})}e.createRoot=c;function d(m,g){return m.tags?m.tags.indexOf(g)>=0:!1}e.hasTag=d;function f(m,g){if(!m.tags)return typeof g!="string"&&g.length===0;if(typeof g=="string")return d(m,g);for(var y=0,b=g;y<b.length;y++){var S=b[y];if(m.tags.indexOf(S)<0)return!1}return!0}e.hasTags=f;function p(m){return m}function v(m){for(var g=m.transformer.definition.customSerialization?m.transformer.definition.customSerialization.toJSON:p,y=void 0,b=0,S=Object.keys(m.state);b<S.length;b++){var x=S[b],C=m.state[x];C&&(y||(y={}),y[x]=!0)}return{parent:m.parent,transformer:m.transformer.id,params:m.params?g(m.params):void 0,state:y,tags:m.tags,ref:m.ref,dependsOn:m.dependsOn,version:m.version}}e.toJSON=v;function h(m){var g=ft.get(m.transformer),y=g.definition.customSerialization?g.definition.customSerialization.fromJSON:p;return{parent:m.parent,transformer:g,params:m.params?y(m.params):void 0,state:m.state||{},tags:m.tags,ref:m.ref,dependsOn:m.dependsOn,version:m.version}}e.fromJSON=h})(cr||(cr={}));function Nl(e){for(var t=-1/0,r=0,n=e.length;r<n;++r)e[r]>t&&(t=e[r]);return t}function pE(e){for(var t=1/0,r=0,n=e.length;r<n;++r)e[r]<t&&(t=e[r]);return t}function jo(e){for(var t=1/0,r=-1/0,n=0,i=e.length;n<i;++n)e[n]<t&&(t=e[n]),e[n]>r&&(r=e[n]);return[t,r]}function y1(e,t,r){t===void 0&&(t=1),r===void 0&&(r=0);for(var n=e.length,i=0,a=r;a<n;a+=t)i+=e[a];return i}function hE(e,t,r){return t===void 0&&(t=1),r===void 0&&(r=0),y1(e,t,r)/(e.length/t)}function vE(e){for(var t=e.length,r=0,n=0;n<t;++n){var i=e[n];r+=i*i}return Math.sqrt(r/t)}function Ys(e,t){for(var r=0,n=t?Math.min(t,e.length):e.length;r<n;++r)e[r]=r;return e}function mb(e,t){for(var r=0,n=e.length,i=!1;r<n;r++)if(e[r]===t){i=!0;break}return i?(gb(e,r),!0):!1}function gb(e,t){for(var r=t,n=e.length-1;r<n;r++)e[r]=e[r+1];e.pop()}function Fa(e,t){return e.indexOf(t)>=0?!1:(e.push(t),!0)}function Nh(e,t){var r=e.indexOf(t);if(r<0)return!1;for(var n=r,i=e.length-1;n<i;n++)e[n]=e[n+1];return e.pop(),!0}function k_(e,t){for(var r=0,n=0,i=e.length;n<i;++n)t.includes(e[n])&&(r+=1);return r}function sL(e,t){if(!e||e.length===0)return!t||t.length===0;if(!t)return!1;var r=e.length;if(r!==t.length)return!1;for(var n=0;n<r;n++)if(e[n]!==t[n])return!1;return!0}function cDe(e){for(var t=0,r=e.length;t<r;t++)if(e[t]!==t)return!1;return!0}function dDe(e,t,r){for(var n=0,i=e.length;n<i;++n)if(e[n][0]===t){e[n][1]=r;return}e.push([t,r])}var fDe=function(){function e(t){this.tree=t,this.transforms=this.tree.transforms,this.children=this.tree.children,this.dependencies=this.tree.dependencies,this.changedNodes=!1,this.changedChildren=!1,this.changedDependencies=!1,this._childMutations=void 0,this._dependencyMutations=void 0,this._stateUpdates=void 0}return Object.defineProperty(e.prototype,"childMutations",{get:function(){return this._childMutations?this._childMutations:(this._childMutations=new Map,this._childMutations)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"dependencyMutations",{get:function(){return this._dependencyMutations?this._dependencyMutations:(this._dependencyMutations=new Map,this._dependencyMutations)},enumerable:!1,configurable:!0}),e.prototype.changeNodes=function(){this.changedNodes||(this.changedNodes=!0,this.transforms=this.transforms.asMutable())},e.prototype.changeChildren=function(){this.changedChildren||(this.changedChildren=!0,this.children=this.children.asMutable())},e.prototype.changeDependencies=function(){this.changedDependencies||(this.changedDependencies=!0,this.dependencies=this.dependencies.asMutable())},Object.defineProperty(e.prototype,"root",{get:function(){return this.transforms.get(cr.RootRef)},enumerable:!1,configurable:!0}),e.prototype.asTransient=function(){return this.asImmutable().asTransient()},e.prototype.addChild=function(t,r){if(this.changeChildren(),this.childMutations.has(t))this.childMutations.get(t).add(r);else{var n=this.children.get(t).asMutable();n.add(r),this.children.set(t,n),this.childMutations.set(t,n)}},e.prototype.removeChild=function(t,r){if(this.changeChildren(),this.childMutations.has(t))this.childMutations.get(t).remove(r);else{var n=this.children.get(t).asMutable();n.remove(r),this.children.set(t,n),this.childMutations.set(t,n)}},e.prototype.clearRoot=function(){var t=cr.RootRef;if(this.children.get(t).size!==0){this.changeChildren();var r=si.OrderedSet();this.children.set(t,r),this.childMutations.set(t,r)}},e.prototype.mutateDependency=function(t,r,n){var i=this.dependencyMutations.get(t);if(!i){var a=this.dependencies.get(t);if(!a&&n==="remove")return;this.changeDependencies(),i=a?a.asMutable():si.OrderedSet().asMutable(),this.dependencyMutations.set(t,i),this.dependencies.set(t,i)}n==="add"?i.add(r):i.remove(r)},e.prototype.changeParent=function(t,r){yx(this.transforms,t);var n=this.transforms.get(t);this.removeChild(n.parent,t),this.addChild(r,t),this.changeNodes(),this.transforms.set(t,cr.withParent(n,r))},e.prototype.add=function(t){var r=t.ref;if(this.transforms.has(t.ref)){var n=this.transforms.get(t.ref);n.parent!==t.parent&&vDe(t.ref)}var i=this.children.get(t.parent);if(i||mDe(t.parent),i.has(t.ref)||this.addChild(t.parent,t.ref),this.children.has(t.ref)||(this.changedChildren||(this.changedChildren=!0,this.children=this.children.asMutable()),this.children.set(t.ref,si.OrderedSet())),this.changeNodes(),this.transforms.set(r,t),t.dependsOn)for(var a=0,o=t.dependsOn;a<o.length;a++){var s=o[a];this.mutateDependency(s,r,"add")}return this},e.prototype.setParams=function(t,r){yx(this.transforms,t);var n=this.transforms.get(t);return rL(n.params,r)?!1:(this.changedNodes||(this.changedNodes=!0,this.transforms=this.transforms.asMutable()),this.transforms.set(n.ref,cr.withParams(n,r)),!0)},e.prototype.setTags=function(t,r){yx(this.transforms,t);var n=this.transforms.get(t),i=cr.withParams(n,r);return sL(n.tags,i.tags)?!1:(this.changedNodes||(this.changedNodes=!0,this.transforms=this.transforms.asMutable()),this.transforms.set(n.ref,i),!0)},e.prototype.assignState=function(t,r){yx(this.transforms,t);var n=this.transforms.get(t);if(this._stateUpdates&&this._stateUpdates.has(t))return cr.assignState(n.state,r),n;this._stateUpdates||(this._stateUpdates=new Set),this._stateUpdates.add(n.ref),this.changeNodes();var i=cr.withState(n,r);return this.transforms.set(t,i),i},e.prototype.remove=function(t){var r=this.transforms.get(t);if(!r)return[];var n=li.subtreePostOrder(this,r);if(t===cr.RootRef){if(n.pop(),n.length===0)return n;this.clearRoot()}else{if(n.length===0)return n;this.removeChild(r.parent,r.ref)}this.changeNodes(),this.changeChildren();for(var i=0,a=n;i<a.length;i++){var o=a[i];this.transforms.delete(o.ref),this.children.delete(o.ref),this._childMutations&&this._childMutations.delete(o.ref)}for(var s=[],u=0,l=n;u<l.length;u++){var o=l[u];if(o.dependsOn)for(var c=0,d=o.dependsOn;c<d.length;c++){var f=d[c];this.transforms.has(f)&&this.mutateDependency(f,o.ref,"remove")}if(this.dependencies.has(o.ref)){var p=this.dependencies.get(o.ref).toArray();this.changeDependencies(),this.dependencies.delete(o.ref),this._dependencyMutations&&this._dependencyMutations.delete(o.ref);for(var v=0,h=p;v<h.length;v++){var m=h[v];if(this.transforms.has(m))for(var g=0,y=this.remove(m);g<y.length;g++){var b=y[g];s[s.length]=b}}}}for(var S=0,x=s;S<x.length;S++){var m=x[S];n[n.length]=m}return n},e.prototype.asImmutable=function(){return!this.changedNodes&&!this.changedChildren&&!this._childMutations?this.tree:(this._childMutations&&this._childMutations.forEach(pDe,this.children),this._dependencyMutations&&this._dependencyMutations.forEach(hDe,this.dependencies),li.create(this.changedNodes?this.transforms.asImmutable():this.transforms,this.changedChildren?this.children.asImmutable():this.children,this.changedDependencies?this.dependencies.asImmutable():this.dependencies))},e}();function pDe(e,t){this.set(t,e.asImmutable())}function hDe(e,t){e.size===0?this.delete(t):this.set(t,e.asImmutable())}function vDe(e){throw new Error("Transform '"+e+"' is already present in the tree.")}function mDe(e){throw new Error("Parent '"+e+"' must be present in the tree.")}function yx(e,t){if(!e.has(t))throw new Error("Node '"+t+"' is not present in the tree.")}var li;(function(e){var t=function(){function b(S,x,C){this.transforms=S,this.children=x,this.dependencies=C}return Object.defineProperty(b.prototype,"root",{get:function(){return this.transforms.get(cr.RootRef)},enumerable:!1,configurable:!0}),b.prototype.asTransient=function(){return new fDe(this)},b}();function r(b){var S=b||cr.createRoot();return n(si.Map([[S.ref,S]]),si.Map([[S.ref,si.OrderedSet()]]),si.Map())}e.createEmpty=r;function n(b,S,x){return new t(b,S,x)}e.create=n;function i(b){a(this,this.tree.transforms.get(b))}function a(b,S){var x=b.tree.children.get(S.ref);x&&x.size&&x.forEach(i,b),b.f(S,b.tree,b.state)}function o(b,S,x,C){var w={tree:b,state:x,f:C};return a(w,S),w.state}e.doPostOrder=o;function s(b){u(this,this.tree.transforms.get(b))}function u(b,S){var x=b.f(S,b.tree,b.state);if(!(typeof x=="boolean"&&!x)){var C=b.tree.children.get(S.ref);C&&C.size&&C.forEach(s,b)}}function l(b,S,x,C){var w={tree:b,state:x,f:C};return u(w,S),w.state}e.doPreOrder=l;function c(b,S,x){x.push(b)}function d(b,S){return o(b,S,[],c)}e.subtreePostOrder=d;function f(b,S,x){x.push(cr.toJSON(b))}function p(b){var S=[];return l(b,b.root,S,f),{transforms:S}}e.toJSON=p;function v(b){for(var S=si.Map().asMutable(),x=si.Map().asMutable(),C=si.Map().asMutable(),w=0,A=b.transforms;w<A.length;w++){var M=A[w],D=cr.fromJSON(M);S.set(D.ref,D),x.has(D.ref)||x.set(D.ref,si.OrderedSet().asMutable()),D.ref!==D.parent&&x.get(D.parent).add(D.ref)}for(var k=new Set,R=0,O=b.transforms;R<O.length;R++){var M=O[R],H=M.ref;if(x.set(H,x.get(H).asImmutable()),!!M.dependsOn)for(var B=0,j=M.dependsOn;B<j.length;B++){var Y=j[B];k.add(Y),C.has(Y)?C.get(Y).add(H):C.set(Y,si.OrderedSet([H]).asMutable())}}return k.forEach(function(G){C.set(G,C.get(G).asImmutable())}),n(S.asImmutable(),x.asImmutable(),C.asImmutable())}e.fromJSON=v;function h(b){console.log({tr:b.transforms.keySeq().toArray(),tr1:b.transforms.valueSeq().toArray().map(function(S){return S.ref}),ch:b.children.keySeq().toArray()})}e.dump=h;function m(b,S,x){if(S===x)return!0;for(var C=b.children.get(S),w=C.values();;){var A=w.next();if(A.done)return!1;if(m(b,A.value,x))return!0}}function g(b,S,x){return!b.transforms.has(S)||!b.transforms.has(x)?!1:m(b,S,x)}e.subtreeHasRef=g;function y(b,S){var x=b.children.get(S);if(x.size!==1)return S;var C=b.transforms.get(x.first());return C.transformer.definition.isDecorator?y(b,C.ref):S}e.getDecoratorRoot=y})(li||(li={}));var ir;(function(e){function t(U,z){return r(U)(z)}e.select=t;function r(U){var z=U||l.root,J;return i(z)?J=z.compile():n(z)?J=l.byValue(z).compile():a(z)?J=z:J=l.byRef(z).compile(),J}e.compile=r;function n(U){return U.transform!==void 0&&U.status!==void 0}function i(U){return U.compile!==void 0}function a(U){return typeof U=="function"}var o={select:function(U){return t(this,U||this.state)}};function s(U,z){o[U]=function(){for(var J=[],K=0;K<arguments.length;K++)J[K]=arguments[K];return z.call.apply(z,Nt([void 0,this],J))}}function u(U){return Object.create(o,{compile:{writable:!1,configurable:!1,value:U}})}var l;(function(U){U.root=u(function(){return function(ie){return[ie.cells.get(ie.tree.root.ref)]}});function z(){for(var ie=[],oe=0;oe<arguments.length;oe++)ie[oe]=arguments[oe];return u(function(){return function(L){for(var V=[],he=0,we=ie;he<we.length;he++){var Te=we[he],ze=L.cells.get(Te);ze&&V.push(ze)}return V}})}U.byRef=z;function J(){for(var ie=[],oe=0;oe<arguments.length;oe++)ie[oe]=arguments[oe];return u(function(){return function(L){return ie}})}U.byValue=J;function K(ie,oe){return oe===void 0&&(oe=cr.RootRef),u(function(){return function(L){var V={roots:[],cells:L.cells,type:ie.type};return li.doPreOrder(L.tree,L.tree.transforms.get(oe),V,ye),V.roots}})}U.rootsOfType=K;function Z(ie,oe){return oe===void 0&&(oe=cr.RootRef),u(function(){return function(L){var V={ret:[],cells:L.cells,type:ie.type};return li.doPreOrder(L.tree,L.tree.transforms.get(oe),V,be),V.ret}})}U.ofType=Z;function te(ie,oe){return oe===void 0&&(oe=cr.RootRef),u(function(){return function(L){var V={ret:[],cells:L.cells,t:ie};return li.doPreOrder(L.tree,L.tree.transforms.get(oe),V,Ae),V.ret}})}U.ofTransformer=te;function le(ie,oe){return oe===void 0&&(oe=cr.RootRef),u(function(){return function(L){var V={ret:[],cells:L.cells,t:ie};return li.doPreOrder(L.tree,L.tree.transforms.get(oe),V,Se),V.ret}})}U.ofTransformerWithError=le;function ye(ie,oe,L){var V=L.cells.get(ie.ref);return V&&V.obj&&V.obj.type===L.type?(L.roots.push(V),!1):!0}function be(ie,oe,L){var V=L.cells.get(ie.ref);return V&&V.obj&&V.obj.type===L.type&&L.ret.push(V),!0}function Ae(ie,oe,L){var V=L.cells.get(ie.ref);return V&&V.obj&&V.transform.transformer===L.t&&L.ret.push(V),!0}function Se(ie,oe,L){var V=L.cells.get(ie.ref);return V&&V.status==="error"&&V.transform.transformer===L.t&&L.ret.push(V),!0}})(l=e.Generators||(e.Generators={})),s("flatMap",c);function c(U,z){var J=r(U);return u(function(){return function(K){for(var Z=[],te=0,le=J(K);te<le.length;te++)for(var ye=le[te],be=0,Ae=z(ye,K);be<Ae.length;be++){var Se=Ae[be];Z.push(Se)}return Z}})}e.flatMap=c,s("mapObject",d);function d(U,z){var J=r(U);return u(function(){return function(K){for(var Z=[],te=0,le=J(K);te<le.length;te++){var ye=le[te],be=z(ye,K);be&&Z.push(be)}return Z}})}e.mapObject=d,s("unique",f);function f(U){var z=r(U);return u(function(){return function(J){for(var K=new Set,Z=[],te=0,le=z(J);te<le.length;te++){var ye=le[te];ye&&(K.has(ye.transform.ref)||(K.add(ye.transform.ref),Z.push(ye)))}return Z}})}e.unique=f,s("first",p);function p(U){var z=r(U);return u(function(){return function(J){var K=z(J);return K.length?[K[0]]:[]}})}e.first=p,s("filter",v);function v(U,z){return c(U,function(J){return z(J)?[J]:[]})}e.filter=v,s("withStatus",h);function h(U,z){return v(U,function(J){return J.status===z})}e.withStatus=h,s("withTag",m);function m(U,z){return v(U,function(J){return!!J.transform.tags&&J.transform.tags.indexOf(z)>=0})}e.withTag=m,s("subtree",g);function g(U){return c(U,function(z,J){var K=[];return li.doPreOrder(J.tree,J.tree.transforms.get(z.transform.ref),K,function(Z,te,le){le.push(Z.ref)}),K.map(function(Z){return J.cells.get(Z)})})}e.subtree=g,s("children",y);function y(U){return c(U,function(z,J){var K=[];return J.tree.children.get(z.transform.ref).forEach(function(Z){return K.push(J.cells.get(Z))}),K})}e.children=y,s("ofType",b);function b(U,z){return v(U,function(J){return J.obj?J.obj.type===z.type:!1})}e.ofType=b,s("ancestor",S);function S(U,z){return f(d(U,function(J,K){return R(K.tree,K.cells,J.transform.ref,z)}))}e.ancestor=S,s("ancestorOfType",x);function x(U,z){return f(d(U,function(J,K){return B(K.tree,K.cells,J.transform.ref,z)}))}e.ancestorOfType=x,s("ancestorWithTransformer",C);function C(U,z){return f(d(U,function(J,K){return H(K.tree,K.cells,J.transform.ref,z)}))}e.ancestorWithTransformer=C,s("withTransformer",w);function w(U,z){return v(U,function(J){return J.transform.transformer===z})}e.withTransformer=w,s("root",A);function A(U,z){return f(d(U,function(J,K){return O(K.tree,K.cells,J.transform.ref,z)}))}e.root=A,s("rootOfType",M);function M(U,z){return f(d(U,function(J,K){return j(K.tree,K.cells,J.transform.ref,z)}))}e.rootOfType=M,s("parent",D);function D(U){return f(d(U,function(z,J){return J.cells.get(J.tree.transforms.get(z.transform.ref).parent)}))}e.parent=D;function k(U,z,J,K,Z){for(var te=U.transforms.get(J),le=void 0;;){te=U.transforms.get(te.parent);var ye=z.get(te.ref);if(ye.obj&&K(ye)&&(le=ye,Z)||te.ref===cr.RootRef)return le}}function R(U,z,J,K){return k(U,z,J,K,!0)}e.findAncestor=R;function O(U,z,J,K){return k(U,z,J,K,!1)}e.findRoot=O;function H(U,z,J,K){return R(U,z,J,Array.isArray(K)?function(Z){return K.indexOf(Z.transform.transformer)>=0}:function(Z){return Z.transform.transformer===K})}e.findAncestorWithTransformer=H;function B(U,z,J,K){return R(U,z,J,Y(K))}e.findAncestorOfType=B;function j(U,z,J,K){return O(U,z,J,Y(K))}e.findRootOfType=j;function Y(U){return Array.isArray(U)?function(z){for(var J=0,K=U;J<K.length;J++){var Z=K[J];if(Z.type===z.obj.type)return!0}}:function(z){return z.obj.type===U.type}}function G(U,z,J){return li.doPreOrder(U,U.transforms.get(z),{refs:{},tags:J},$).refs}e.findUniqueTagsInSubtree=G;function $(U,z,J){if(U.tags)for(var K=0,Z=U.tags;K<Z.length;K++){var te=Z[K];if(J.tags.has(te)){J.refs[te]=U.ref;break}}return!0}function q(U,z,J){return li.doPreOrder(U,U.transforms.get(z),{ref:void 0,tag:J},ee).ref}e.findTagInSubtree=q;function ee(U,z,J){return U.tags&&U.tags.indexOf(J.tag)>=0?(J.ref=U.ref,!1):!0}function fe(U,z,J){return li.doPreOrder(U,U.transforms.get(z),{refs:[],tags:J},W).refs}e.findWithAllTags=fe;function W(U,z,J){if(U.tags)for(var K=J.tags.size,Z=0,te=0,le=U.tags;te<le.length;te++){var ye=le[te];if(J.tags.has(ye)&&(Z++,Z===K)){J.refs.push(U);break}}else J.tags.size===0&&J.refs.push(U)}function X(U,z,J){var K=U.transforms.get(z);if(K.transformer===J)return U.cells.get(z);var Z=U.tree.children.get(z);if(Z.size===1){var te=Z.first();if(U.transforms.get(te).transformer.definition.isDecorator)return X(U,te,J)}}e.tryFindDecorator=X})(ir||(ir={}));/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var H5=function(e,t){return H5=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var i in n)n.hasOwnProperty(i)&&(r[i]=n[i])},H5(e,t)};function Sa(e,t){H5(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}function G5(e){return typeof e=="function"}var J9=!1,vl={Promise:void 0,set useDeprecatedSynchronousErrorHandling(e){if(e){var t=new Error;""+t.stack}J9=e},get useDeprecatedSynchronousErrorHandling(){return J9}};function Wm(e){setTimeout(function(){throw e},0)}var O_={closed:!0,next:function(e){},error:function(e){if(vl.useDeprecatedSynchronousErrorHandling)throw e;Wm(e)},complete:function(){}},gDe=function(){return Array.isArray||function(e){return e&&typeof e.length=="number"}}();function MZ(e){return e!==null&&typeof e=="object"}var yDe=function(){function e(t){return Error.call(this),this.message=t?t.length+` errors occurred during unsubscription:
`+t.map(function(r,n){return n+1+") "+r.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=t,this}return e.prototype=Object.create(Error.prototype),e}(),KS=yDe,Bl=function(){function e(t){this.closed=!1,this._parentOrParents=null,this._subscriptions=null,t&&(this._ctorUnsubscribe=!0,this._unsubscribe=t)}return e.prototype.unsubscribe=function(){var t;if(!this.closed){var r=this,n=r._parentOrParents,i=r._ctorUnsubscribe,a=r._unsubscribe,o=r._subscriptions;if(this.closed=!0,this._parentOrParents=null,this._subscriptions=null,n instanceof e)n.remove(this);else if(n!==null)for(var s=0;s<n.length;++s){var u=n[s];u.remove(this)}if(G5(a)){i&&(this._unsubscribe=void 0);try{a.call(this)}catch(d){t=d instanceof KS?eU(d.errors):[d]}}if(gDe(o))for(var s=-1,l=o.length;++s<l;){var c=o[s];if(MZ(c))try{c.unsubscribe()}catch(f){t=t||[],f instanceof KS?t=t.concat(eU(f.errors)):t.push(f)}}if(t)throw new KS(t)}},e.prototype.add=function(t){var r=t;if(!t)return e.EMPTY;switch(typeof t){case"function":r=new e(t);case"object":if(r===this||r.closed||typeof r.unsubscribe!="function")return r;if(this.closed)return r.unsubscribe(),r;if(!(r instanceof e)){var n=r;r=new e,r._subscriptions=[n]}break;default:throw new Error("unrecognized teardown "+t+" added to Subscription.")}var i=r._parentOrParents;if(i===null)r._parentOrParents=this;else if(i instanceof e){if(i===this)return r;r._parentOrParents=[i,this]}else if(i.indexOf(this)===-1)i.push(this);else return r;var a=this._subscriptions;return a===null?this._subscriptions=[r]:a.push(r),r},e.prototype.remove=function(t){var r=this._subscriptions;if(r){var n=r.indexOf(t);n!==-1&&r.splice(n,1)}},e.EMPTY=function(t){return t.closed=!0,t}(new e),e}();function eU(e){return e.reduce(function(t,r){return t.concat(r instanceof KS?r.errors:r)},[])}var L_=function(){return typeof Symbol=="function"?Symbol("rxSubscriber"):"@@rxSubscriber_"+Math.random()}(),Vs=function(e){Sa(t,e);function t(r,n,i){var a=e.call(this)||this;switch(a.syncErrorValue=null,a.syncErrorThrown=!1,a.syncErrorThrowable=!1,a.isStopped=!1,arguments.length){case 0:a.destination=O_;break;case 1:if(!r){a.destination=O_;break}if(typeof r=="object"){r instanceof t?(a.syncErrorThrowable=r.syncErrorThrowable,a.destination=r,r.add(a)):(a.syncErrorThrowable=!0,a.destination=new tU(a,r));break}default:a.syncErrorThrowable=!0,a.destination=new tU(a,r,n,i);break}return a}return t.prototype[L_]=function(){return this},t.create=function(r,n,i){var a=new t(r,n,i);return a.syncErrorThrowable=!1,a},t.prototype.next=function(r){this.isStopped||this._next(r)},t.prototype.error=function(r){this.isStopped||(this.isStopped=!0,this._error(r))},t.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this))},t.prototype._next=function(r){this.destination.next(r)},t.prototype._error=function(r){this.destination.error(r),this.unsubscribe()},t.prototype._complete=function(){this.destination.complete(),this.unsubscribe()},t.prototype._unsubscribeAndRecycle=function(){var r=this._parentOrParents;return this._parentOrParents=null,this.unsubscribe(),this.closed=!1,this.isStopped=!1,this._parentOrParents=r,this},t}(Bl),tU=function(e){Sa(t,e);function t(r,n,i,a){var o=e.call(this)||this;o._parentSubscriber=r;var s,u=o;return G5(n)?s=n:n&&(s=n.next,i=n.error,a=n.complete,n!==O_&&(u=Object.create(n),G5(u.unsubscribe)&&o.add(u.unsubscribe.bind(u)),u.unsubscribe=o.unsubscribe.bind(o))),o._context=u,o._next=s,o._error=i,o._complete=a,o}return t.prototype.next=function(r){if(!this.isStopped&&this._next){var n=this._parentSubscriber;!vl.useDeprecatedSynchronousErrorHandling||!n.syncErrorThrowable?this.__tryOrUnsub(this._next,r):this.__tryOrSetError(n,this._next,r)&&this.unsubscribe()}},t.prototype.error=function(r){if(!this.isStopped){var n=this._parentSubscriber,i=vl.useDeprecatedSynchronousErrorHandling;if(this._error)!i||!n.syncErrorThrowable?(this.__tryOrUnsub(this._error,r),this.unsubscribe()):(this.__tryOrSetError(n,this._error,r),this.unsubscribe());else if(n.syncErrorThrowable)i?(n.syncErrorValue=r,n.syncErrorThrown=!0):Wm(r),this.unsubscribe();else{if(this.unsubscribe(),i)throw r;Wm(r)}}},t.prototype.complete=function(){var r=this;if(!this.isStopped){var n=this._parentSubscriber;if(this._complete){var i=function(){return r._complete.call(r._context)};!vl.useDeprecatedSynchronousErrorHandling||!n.syncErrorThrowable?(this.__tryOrUnsub(i),this.unsubscribe()):(this.__tryOrSetError(n,i),this.unsubscribe())}else this.unsubscribe()}},t.prototype.__tryOrUnsub=function(r,n){try{r.call(this._context,n)}catch(i){if(this.unsubscribe(),vl.useDeprecatedSynchronousErrorHandling)throw i;Wm(i)}},t.prototype.__tryOrSetError=function(r,n,i){if(!vl.useDeprecatedSynchronousErrorHandling)throw new Error("bad call");try{n.call(this._context,i)}catch(a){return vl.useDeprecatedSynchronousErrorHandling?(r.syncErrorValue=a,r.syncErrorThrown=!0,!0):(Wm(a),!0)}return!1},t.prototype._unsubscribe=function(){var r=this._parentSubscriber;this._context=null,this._parentSubscriber=null,r.unsubscribe()},t}(Vs);function bDe(e){for(;e;){var t=e,r=t.closed,n=t.destination,i=t.isStopped;if(r||i)return!1;n&&n instanceof Vs?e=n:e=null}return!0}function xDe(e,t,r){if(e){if(e instanceof Vs)return e;if(e[L_])return e[L_]()}return!e&&!t&&!r?new Vs(O_):new Vs(e,t,r)}var n2=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}();function DZ(e){return e}function SDe(e){return e.length===0?DZ:e.length===1?e[0]:function(r){return e.reduce(function(n,i){return i(n)},r)}}var is=function(){function e(t){this._isScalar=!1,t&&(this._subscribe=t)}return e.prototype.lift=function(t){var r=new e;return r.source=this,r.operator=t,r},e.prototype.subscribe=function(t,r,n){var i=this.operator,a=xDe(t,r,n);if(i?a.add(i.call(a,this.source)):a.add(this.source||vl.useDeprecatedSynchronousErrorHandling&&!a.syncErrorThrowable?this._subscribe(a):this._trySubscribe(a)),vl.useDeprecatedSynchronousErrorHandling&&a.syncErrorThrowable&&(a.syncErrorThrowable=!1,a.syncErrorThrown))throw a.syncErrorValue;return a},e.prototype._trySubscribe=function(t){try{return this._subscribe(t)}catch(r){vl.useDeprecatedSynchronousErrorHandling&&(t.syncErrorThrown=!0,t.syncErrorValue=r),bDe(t)?t.error(r):console.warn(r)}},e.prototype.forEach=function(t,r){var n=this;return r=rU(r),new r(function(i,a){var o;o=n.subscribe(function(s){try{t(s)}catch(u){a(u),o&&o.unsubscribe()}},a,i)})},e.prototype._subscribe=function(t){var r=this.source;return r&&r.subscribe(t)},e.prototype[n2]=function(){return this},e.prototype.pipe=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return t.length===0?this:SDe(t)(this)},e.prototype.toPromise=function(t){var r=this;return t=rU(t),new t(function(n,i){var a;r.subscribe(function(o){return a=o},function(o){return i(o)},function(){return n(a)})})},e.create=function(t){return new e(t)},e}();function rU(e){if(e||(e=Promise),!e)throw new Error("no Promise impl found");return e}var CDe=function(){function e(){return Error.call(this),this.message="object unsubscribed",this.name="ObjectUnsubscribedError",this}return e.prototype=Object.create(Error.prototype),e}(),Tm=CDe,_De=function(e){Sa(t,e);function t(r,n){var i=e.call(this)||this;return i.subject=r,i.subscriber=n,i.closed=!1,i}return t.prototype.unsubscribe=function(){if(!this.closed){this.closed=!0;var r=this.subject,n=r.observers;if(this.subject=null,!(!n||n.length===0||r.isStopped||r.closed)){var i=n.indexOf(this.subscriber);i!==-1&&n.splice(i,1)}}},t}(Bl),wDe=function(e){Sa(t,e);function t(r){var n=e.call(this,r)||this;return n.destination=r,n}return t}(Vs),ri=function(e){Sa(t,e);function t(){var r=e.call(this)||this;return r.observers=[],r.closed=!1,r.isStopped=!1,r.hasError=!1,r.thrownError=null,r}return t.prototype[L_]=function(){return new wDe(this)},t.prototype.lift=function(r){var n=new nU(this,this);return n.operator=r,n},t.prototype.next=function(r){if(this.closed)throw new Tm;if(!this.isStopped)for(var n=this.observers,i=n.length,a=n.slice(),o=0;o<i;o++)a[o].next(r)},t.prototype.error=function(r){if(this.closed)throw new Tm;this.hasError=!0,this.thrownError=r,this.isStopped=!0;for(var n=this.observers,i=n.length,a=n.slice(),o=0;o<i;o++)a[o].error(r);this.observers.length=0},t.prototype.complete=function(){if(this.closed)throw new Tm;this.isStopped=!0;for(var r=this.observers,n=r.length,i=r.slice(),a=0;a<n;a++)i[a].complete();this.observers.length=0},t.prototype.unsubscribe=function(){this.isStopped=!0,this.closed=!0,this.observers=null},t.prototype._trySubscribe=function(r){if(this.closed)throw new Tm;return e.prototype._trySubscribe.call(this,r)},t.prototype._subscribe=function(r){if(this.closed)throw new Tm;return this.hasError?(r.error(this.thrownError),Bl.EMPTY):this.isStopped?(r.complete(),Bl.EMPTY):(this.observers.push(r),new _De(this,r))},t.prototype.asObservable=function(){var r=new is;return r.source=this,r},t.create=function(r,n){return new nU(r,n)},t}(is),nU=function(e){Sa(t,e);function t(r,n){var i=e.call(this)||this;return i.destination=r,i.source=n,i}return t.prototype.next=function(r){var n=this.destination;n&&n.next&&n.next(r)},t.prototype.error=function(r){var n=this.destination;n&&n.error&&this.destination.error(r)},t.prototype.complete=function(){var r=this.destination;r&&r.complete&&this.destination.complete()},t.prototype._subscribe=function(r){var n=this.source;return n?this.source.subscribe(r):Bl.EMPTY},t}(ri),kf=function(e){Sa(t,e);function t(r){var n=e.call(this)||this;return n._value=r,n}return Object.defineProperty(t.prototype,"value",{get:function(){return this.getValue()},enumerable:!0,configurable:!0}),t.prototype._subscribe=function(r){var n=e.prototype._subscribe.call(this,r);return n&&!n.closed&&r.next(this._value),n},t.prototype.getValue=function(){if(this.hasError)throw this.thrownError;if(this.closed)throw new Tm;return this._value},t.prototype.next=function(r){e.prototype.next.call(this,this._value=r)},t}(ri),EDe=function(e){Sa(t,e);function t(r,n){return e.call(this)||this}return t.prototype.schedule=function(r,n){return this},t}(Bl),ADe=function(e){Sa(t,e);function t(r,n){var i=e.call(this,r,n)||this;return i.scheduler=r,i.work=n,i.pending=!1,i}return t.prototype.schedule=function(r,n){if(n===void 0&&(n=0),this.closed)return this;this.state=r;var i=this.id,a=this.scheduler;return i!=null&&(this.id=this.recycleAsyncId(a,i,n)),this.pending=!0,this.delay=n,this.id=this.id||this.requestAsyncId(a,this.id,n),this},t.prototype.requestAsyncId=function(r,n,i){return i===void 0&&(i=0),setInterval(r.flush.bind(r,this),i)},t.prototype.recycleAsyncId=function(r,n,i){if(i===void 0&&(i=0),i!==null&&this.delay===i&&this.pending===!1)return n;clearInterval(n)},t.prototype.execute=function(r,n){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var i=this._execute(r,n);if(i)return i;this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},t.prototype._execute=function(r,n){var i=!1,a=void 0;try{this.work(r)}catch(o){i=!0,a=!!o&&o||new Error(o)}if(i)return this.unsubscribe(),a},t.prototype._unsubscribe=function(){var r=this.id,n=this.scheduler,i=n.actions,a=i.indexOf(this);this.work=null,this.state=null,this.pending=!1,this.scheduler=null,a!==-1&&i.splice(a,1),r!=null&&(this.id=this.recycleAsyncId(n,r,null)),this.delay=null},t}(EDe),iU=function(){function e(t,r){r===void 0&&(r=e.now),this.SchedulerAction=t,this.now=r}return e.prototype.schedule=function(t,r,n){return r===void 0&&(r=0),new this.SchedulerAction(this,t).schedule(n,r)},e.now=function(){return Date.now()},e}(),PDe=function(e){Sa(t,e);function t(r,n){n===void 0&&(n=iU.now);var i=e.call(this,r,function(){return t.delegate&&t.delegate!==i?t.delegate.now():n()})||this;return i.actions=[],i.active=!1,i.scheduled=void 0,i}return t.prototype.schedule=function(r,n,i){return n===void 0&&(n=0),t.delegate&&t.delegate!==this?t.delegate.schedule(r,n,i):e.prototype.schedule.call(this,r,n,i)},t.prototype.flush=function(r){var n=this.actions;if(this.active){n.push(r);return}var i;this.active=!0;do if(i=r.execute(r.state,r.delay))break;while(r=n.shift());if(this.active=!1,i){for(;r=n.shift();)r.unsubscribe();throw i}},t}(iU),TDe=new is(function(e){return e.complete()});function IDe(e){return e?MDe(e):TDe}function MDe(e){return new is(function(t){return e.schedule(function(){return t.complete()})})}function DDe(e){return e&&typeof e.schedule=="function"}var RZ=function(e){return function(t){for(var r=0,n=e.length;r<n&&!t.closed;r++)t.next(e[r]);t.complete()}};function kZ(e,t){return new is(function(r){var n=new Bl,i=0;return n.add(t.schedule(function(){if(i===e.length){r.complete();return}r.next(e[i++]),r.closed||n.add(this.schedule())})),n})}function RDe(e,t){return t?kZ(e,t):new is(RZ(e))}var kDe=new PDe(ADe),ODe=kDe,LDe=function(){function e(){return Error.call(this),this.message="argument out of range",this.name="ArgumentOutOfRangeError",this}return e.prototype=Object.create(Error.prototype),e}(),FDe=LDe;function NDe(e,t){return function(n){if(typeof e!="function")throw new TypeError("argument is not a function. Are you looking for `mapTo()`?");return n.lift(new BDe(e,t))}}var BDe=function(){function e(t,r){this.project=t,this.thisArg=r}return e.prototype.call=function(t,r){return r.subscribe(new UDe(t,this.project,this.thisArg))},e}(),UDe=function(e){Sa(t,e);function t(r,n,i){var a=e.call(this,r)||this;return a.project=n,a.count=0,a.thisArg=i||a,a}return t.prototype._next=function(r){var n;try{n=this.project.call(this.thisArg,r,this.count++)}catch(i){this.destination.error(i);return}this.destination.next(n)},t}(Vs),jDe=function(e){return function(t){return e.then(function(r){t.closed||(t.next(r),t.complete())},function(r){return t.error(r)}).then(null,Wm),t}};function zDe(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var mE=zDe(),VDe=function(e){return function(t){var r=e[mE]();do{var n=void 0;try{n=r.next()}catch(i){return t.error(i),t}if(n.done){t.complete();break}if(t.next(n.value),t.closed)break}while(!0);return typeof r.return=="function"&&t.add(function(){r.return&&r.return()}),t}},HDe=function(e){return function(t){var r=e[n2]();if(typeof r.subscribe!="function")throw new TypeError("Provided object does not correctly implement Symbol.observable");return r.subscribe(t)}},OZ=function(e){return e&&typeof e.length=="number"&&typeof e!="function"};function LZ(e){return!!e&&typeof e.subscribe!="function"&&typeof e.then=="function"}var FZ=function(e){if(e&&typeof e[n2]=="function")return HDe(e);if(OZ(e))return RZ(e);if(LZ(e))return jDe(e);if(e&&typeof e[mE]=="function")return VDe(e);var t=MZ(e)?"an invalid object":"'"+e+"'",r="You provided "+t+" where a stream was expected. You can provide an Observable, Promise, Array, or Iterable.";throw new TypeError(r)};function GDe(e,t){return new is(function(r){var n=new Bl;return n.add(t.schedule(function(){var i=e[n2]();n.add(i.subscribe({next:function(a){n.add(t.schedule(function(){return r.next(a)}))},error:function(a){n.add(t.schedule(function(){return r.error(a)}))},complete:function(){n.add(t.schedule(function(){return r.complete()}))}}))})),n})}function qDe(e,t){return new is(function(r){var n=new Bl;return n.add(t.schedule(function(){return e.then(function(i){n.add(t.schedule(function(){r.next(i),n.add(t.schedule(function(){return r.complete()}))}))},function(i){n.add(t.schedule(function(){return r.error(i)}))})})),n})}function $De(e,t){if(!e)throw new Error("Iterable cannot be null");return new is(function(r){var n=new Bl,i;return n.add(function(){i&&typeof i.return=="function"&&i.return()}),n.add(t.schedule(function(){i=e[mE](),n.add(t.schedule(function(){if(!r.closed){var a,o;try{var s=i.next();a=s.value,o=s.done}catch(u){r.error(u);return}o?r.complete():(r.next(a),this.schedule())}}))})),n})}function WDe(e){return e&&typeof e[n2]=="function"}function XDe(e){return e&&typeof e[mE]=="function"}function YDe(e,t){if(e!=null){if(WDe(e))return GDe(e,t);if(LZ(e))return qDe(e,t);if(OZ(e))return kZ(e,t);if(XDe(e)||typeof e=="string")return $De(e,t)}throw new TypeError((e!==null&&typeof e||e)+" is not observable")}function KDe(e,t){return t?YDe(e,t):e instanceof is?e:new is(FZ(e))}var QDe=function(e){Sa(t,e);function t(r){var n=e.call(this)||this;return n.parent=r,n}return t.prototype._next=function(r){this.parent.notifyNext(r)},t.prototype._error=function(r){this.parent.notifyError(r),this.unsubscribe()},t.prototype._complete=function(){this.parent.notifyComplete(),this.unsubscribe()},t}(Vs),ZDe=function(e){Sa(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.notifyNext=function(r){this.destination.next(r)},t.prototype.notifyError=function(r){this.destination.error(r)},t.prototype.notifyComplete=function(){this.destination.complete()},t}(Vs);function JDe(e,t){if(!t.closed){if(e instanceof is)return e.subscribe(t);var r;try{r=FZ(e)(t)}catch(n){t.error(n)}return r}}function NZ(e,t,r){return r===void 0&&(r=Number.POSITIVE_INFINITY),typeof t=="function"?function(n){return n.pipe(NZ(function(i,a){return KDe(e(i,a)).pipe(NDe(function(o,s){return t(i,o,a,s)}))},r))}:(typeof t=="number"&&(r=t),function(n){return n.lift(new eRe(e,r))})}var eRe=function(){function e(t,r){r===void 0&&(r=Number.POSITIVE_INFINITY),this.project=t,this.concurrent=r}return e.prototype.call=function(t,r){return r.subscribe(new tRe(t,this.project,this.concurrent))},e}(),tRe=function(e){Sa(t,e);function t(r,n,i){i===void 0&&(i=Number.POSITIVE_INFINITY);var a=e.call(this,r)||this;return a.project=n,a.concurrent=i,a.hasCompleted=!1,a.buffer=[],a.active=0,a.index=0,a}return t.prototype._next=function(r){this.active<this.concurrent?this._tryNext(r):this.buffer.push(r)},t.prototype._tryNext=function(r){var n,i=this.index++;try{n=this.project(r,i)}catch(a){this.destination.error(a);return}this.active++,this._innerSub(n)},t.prototype._innerSub=function(r){var n=new QDe(this),i=this.destination;i.add(n);var a=JDe(r,n);a!==n&&i.add(a)},t.prototype._complete=function(){this.hasCompleted=!0,this.active===0&&this.buffer.length===0&&this.destination.complete(),this.unsubscribe()},t.prototype.notifyNext=function(r){this.destination.next(r)},t.prototype.notifyComplete=function(){var r=this.buffer;this.active--,r.length>0?this._next(r.shift()):this.active===0&&this.hasCompleted&&this.destination.complete()},t}(ZDe);function rRe(e){return e===void 0&&(e=Number.POSITIVE_INFINITY),NZ(DZ,e)}function gc(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=Number.POSITIVE_INFINITY,n=null,i=e[e.length-1];return DDe(i)?(n=e.pop(),e.length>1&&typeof e[e.length-1]=="number"&&(r=e.pop())):typeof i=="number"&&(r=e.pop()),n===null&&e.length===1&&e[0]instanceof is?e[0]:rRe(r)(RDe(e,n))}function gE(e,t){return function(n){return n.lift(new nRe(e,t))}}var nRe=function(){function e(t,r){this.predicate=t,this.thisArg=r}return e.prototype.call=function(t,r){return r.subscribe(new iRe(t,this.predicate,this.thisArg))},e}(),iRe=function(e){Sa(t,e);function t(r,n,i){var a=e.call(this,r)||this;return a.predicate=n,a.thisArg=i,a.count=0,a}return t.prototype._next=function(r){var n;try{n=this.predicate.call(this.thisArg,r,this.count++)}catch(i){this.destination.error(i);return}n&&this.destination.next(r)},t}(Vs),Jc;(function(e){function t(){var r=new aRe,n=function(){return r.create()};return n.dispose=function(){return r.dispose()},n.behavior=function(i){return r.behavior(i)},n}e.create=t})(Jc||(Jc={}));var aRe=function(){function e(){this._eventList=[],this._disposed=!1}return e.prototype.create=function(){var t=new ri;return this._eventList.push(t),t},e.prototype.behavior=function(t){var r=new kf(t);return this._eventList.push(r),r},e.prototype.dispose=function(){if(!this._disposed){for(var t=0,r=this._eventList;t<r.length;t++){var n=r[t];n.complete()}this._disposed=!0}},e}();function Su(e){for(var t=arguments.length,r=Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];throw Error("[Immer] minified error nr: "+e+(r.length?" "+r.map(function(i){return"'"+i+"'"}).join(","):"")+". Find the full error at: https://bit.ly/3cXEKWf")}function $g(e){return!!e&&!!e[as]}function lv(e){return!!e&&(function(t){if(!t||typeof t!="object")return!1;var r=Object.getPrototypeOf(t);if(r===null)return!0;var n=Object.hasOwnProperty.call(r,"constructor")&&r.constructor;return typeof n=="function"&&Function.toString.call(n)===pRe}(e)||Array.isArray(e)||!!e[fU]||!!e.constructor[fU]||uL(e)||lL(e))}function yb(e,t,r){r===void 0&&(r=!1),b0(e)===0?(r?Object.keys:hL)(e).forEach(function(n){r&&typeof n=="symbol"||t(n,e[n],e)}):e.forEach(function(n,i){return t(i,n,e)})}function b0(e){var t=e[as];return t?t.i>3?t.i-4:t.i:Array.isArray(e)?1:uL(e)?2:lL(e)?3:0}function q5(e,t){return b0(e)===2?e.has(t):Object.prototype.hasOwnProperty.call(e,t)}function oRe(e,t){return b0(e)===2?e.get(t):e[t]}function BZ(e,t,r){var n=b0(e);n===2?e.set(t,r):n===3?(e.delete(t),e.add(r)):e[t]=r}function sRe(e,t){return e===t?e!==0||1/e==1/t:e!=e&&t!=t}function uL(e){return dRe&&e instanceof Map}function lL(e){return fRe&&e instanceof Set}function dh(e){return e.o||e.t}function cL(e){if(Array.isArray(e))return Array.prototype.slice.call(e);var t=hRe(e);delete t[as];for(var r=hL(t),n=0;n<r.length;n++){var i=r[n],a=t[i];a.writable===!1&&(a.writable=!0,a.configurable=!0),(a.get||a.set)&&(t[i]={configurable:!0,writable:!0,enumerable:a.enumerable,value:e[i]})}return Object.create(Object.getPrototypeOf(e),t)}function dL(e,t){return t===void 0&&(t=!1),fL(e)||$g(e)||!lv(e)||(b0(e)>1&&(e.set=e.add=e.clear=e.delete=uRe),Object.freeze(e),t&&yb(e,function(r,n){return dL(n,!0)},!0)),e}function uRe(){Su(2)}function fL(e){return e==null||typeof e!="object"||Object.isFrozen(e)}function Nc(e){var t=vRe[e];return t||Su(18,e),t}function aU(){return bb}function p4(e,t){t&&(Nc("Patches"),e.u=[],e.s=[],e.v=t)}function F_(e){$5(e),e.p.forEach(lRe),e.p=null}function $5(e){e===bb&&(bb=e.l)}function oU(e){return bb={p:[],l:bb,h:e,m:!0,_:0}}function lRe(e){var t=e[as];t.i===0||t.i===1?t.j():t.g=!0}function h4(e,t){t._=t.p.length;var r=t.p[0],n=e!==void 0&&e!==r;return t.h.O||Nc("ES5").S(t,e,n),n?(r[as].P&&(F_(t),Su(4)),lv(e)&&(e=N_(t,e),t.l||B_(t,e)),t.u&&Nc("Patches").M(r[as],e,t.u,t.s)):e=N_(t,r,[]),F_(t),t.u&&t.v(t.u,t.s),e!==UZ?e:void 0}function N_(e,t,r){if(fL(t))return t;var n=t[as];if(!n)return yb(t,function(a,o){return sU(e,n,t,a,o,r)},!0),t;if(n.A!==e)return t;if(!n.P)return B_(e,n.t,!0),n.t;if(!n.I){n.I=!0,n.A._--;var i=n.i===4||n.i===5?n.o=cL(n.k):n.o;yb(n.i===3?new Set(i):i,function(a,o){return sU(e,n,i,a,o,r)}),B_(e,i,!1),r&&e.u&&Nc("Patches").R(n,r,e.u,e.s)}return n.o}function sU(e,t,r,n,i,a){if($g(i)){var o=N_(e,i,a&&t&&t.i!==3&&!q5(t.D,n)?a.concat(n):void 0);if(BZ(r,n,o),!$g(o))return;e.m=!1}if(lv(i)&&!fL(i)){if(!e.h.F&&e._<1)return;N_(e,i),t&&t.A.l||B_(e,i)}}function B_(e,t,r){r===void 0&&(r=!1),e.h.F&&e.m&&dL(t,r)}function v4(e,t){var r=e[as];return(r?dh(r):e)[t]}function uU(e,t){if(t in e)for(var r=Object.getPrototypeOf(e);r;){var n=Object.getOwnPropertyDescriptor(r,t);if(n)return n;r=Object.getPrototypeOf(r)}}function W5(e){e.P||(e.P=!0,e.l&&W5(e.l))}function m4(e){e.o||(e.o=cL(e.t))}function X5(e,t,r){var n=uL(t)?Nc("MapSet").N(t,r):lL(t)?Nc("MapSet").T(t,r):e.O?function(i,a){var o=Array.isArray(i),s={i:o?1:0,A:a?a.A:aU(),P:!1,I:!1,D:{},l:a,t:i,k:null,o:null,j:null,C:!1},u=s,l=QS;o&&(u=[s],l=ZS);var c=Proxy.revocable(u,l),d=c.revoke,f=c.proxy;return s.k=f,s.j=d,f}(t,r):Nc("ES5").J(t,r);return(r?r.A:aU()).p.push(n),n}function cRe(e){return $g(e)||Su(22,e),function t(r){if(!lv(r))return r;var n,i=r[as],a=b0(r);if(i){if(!i.P&&(i.i<4||!Nc("ES5").K(i)))return i.t;i.I=!0,n=lU(r,a),i.I=!1}else n=lU(r,a);return yb(n,function(o,s){i&&oRe(i.t,o)===s||BZ(n,o,t(s))}),a===3?new Set(n):n}(e)}function lU(e,t){switch(t){case 2:return new Map(e);case 3:return Array.from(e)}return cL(e)}var cU,bb,pL=typeof Symbol<"u"&&typeof Symbol("x")=="symbol",dRe=typeof Map<"u",fRe=typeof Set<"u",dU=typeof Proxy<"u"&&Proxy.revocable!==void 0&&typeof Reflect<"u",UZ=pL?Symbol.for("immer-nothing"):((cU={})["immer-nothing"]=!0,cU),fU=pL?Symbol.for("immer-draftable"):"__$immer_draftable",as=pL?Symbol.for("immer-state"):"__$immer_state",pRe=""+Object.prototype.constructor,hL=typeof Reflect<"u"&&Reflect.ownKeys?Reflect.ownKeys:Object.getOwnPropertySymbols!==void 0?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:Object.getOwnPropertyNames,hRe=Object.getOwnPropertyDescriptors||function(e){var t={};return hL(e).forEach(function(r){t[r]=Object.getOwnPropertyDescriptor(e,r)}),t},vRe={},QS={get:function(e,t){if(t===as)return e;var r=dh(e);if(!q5(r,t))return function(i,a,o){var s,u=uU(a,o);return u?"value"in u?u.value:(s=u.get)===null||s===void 0?void 0:s.call(i.k):void 0}(e,r,t);var n=r[t];return e.I||!lv(n)?n:n===v4(e.t,t)?(m4(e),e.o[t]=X5(e.A.h,n,e)):n},has:function(e,t){return t in dh(e)},ownKeys:function(e){return Reflect.ownKeys(dh(e))},set:function(e,t,r){var n=uU(dh(e),t);if(n!=null&&n.set)return n.set.call(e.k,r),!0;if(!e.P){var i=v4(dh(e),t),a=i==null?void 0:i[as];if(a&&a.t===r)return e.o[t]=r,e.D[t]=!1,!0;if(sRe(r,i)&&(r!==void 0||q5(e.t,t)))return!0;m4(e),W5(e)}return e.o[t]===r&&typeof r!="number"||(e.o[t]=r,e.D[t]=!0,!0)},deleteProperty:function(e,t){return v4(e.t,t)!==void 0||t in e.t?(e.D[t]=!1,m4(e),W5(e)):delete e.D[t],e.o&&delete e.o[t],!0},getOwnPropertyDescriptor:function(e,t){var r=dh(e),n=Reflect.getOwnPropertyDescriptor(r,t);return n&&{writable:!0,configurable:e.i!==1||t!=="length",enumerable:n.enumerable,value:r[t]}},defineProperty:function(){Su(11)},getPrototypeOf:function(e){return Object.getPrototypeOf(e.t)},setPrototypeOf:function(){Su(12)}},ZS={};yb(QS,function(e,t){ZS[e]=function(){return arguments[0]=arguments[0][0],t.apply(this,arguments)}}),ZS.deleteProperty=function(e,t){return QS.deleteProperty.call(this,e[0],t)},ZS.set=function(e,t,r){return QS.set.call(this,e[0],t,r,e[0])};var mRe=function(){function e(r){var n=this;this.O=dU,this.F=!0,this.produce=function(i,a,o){if(typeof i=="function"&&typeof a!="function"){var s=a;a=i;var u=n;return function(p){var v=this;p===void 0&&(p=s);for(var h=arguments.length,m=Array(h>1?h-1:0),g=1;g<h;g++)m[g-1]=arguments[g];return u.produce(p,function(y){var b;return(b=a).call.apply(b,[v,y].concat(m))})}}var l;if(typeof a!="function"&&Su(6),o!==void 0&&typeof o!="function"&&Su(7),lv(i)){var c=oU(n),d=X5(n,i,void 0),f=!0;try{l=a(d),f=!1}finally{f?F_(c):$5(c)}return typeof Promise<"u"&&l instanceof Promise?l.then(function(p){return p4(c,o),h4(p,c)},function(p){throw F_(c),p}):(p4(c,o),h4(l,c))}if(!i||typeof i!="object")return(l=a(i))===UZ?void 0:(l===void 0&&(l=i),n.F&&dL(l,!0),l);Su(21,i)},this.produceWithPatches=function(i,a){return typeof i=="function"?function(u){for(var l=arguments.length,c=Array(l>1?l-1:0),d=1;d<l;d++)c[d-1]=arguments[d];return n.produceWithPatches(u,function(f){return i.apply(void 0,[f].concat(c))})}:[n.produce(i,a,function(u,l){o=u,s=l}),o,s];var o,s},typeof(r==null?void 0:r.useProxies)=="boolean"&&this.setUseProxies(r.useProxies),typeof(r==null?void 0:r.autoFreeze)=="boolean"&&this.setAutoFreeze(r.autoFreeze)}var t=e.prototype;return t.createDraft=function(r){lv(r)||Su(8),$g(r)&&(r=cRe(r));var n=oU(this),i=X5(this,r,void 0);return i[as].C=!0,$5(n),i},t.finishDraft=function(r,n){var i=r&&r[as],a=i.A;return p4(a,n),h4(void 0,a)},t.setAutoFreeze=function(r){this.F=r},t.setUseProxies=function(r){r&&!dU&&Su(20),this.O=r},t.applyPatches=function(r,n){var i;for(i=n.length-1;i>=0;i--){var a=n[i];if(a.path.length===0&&a.op==="replace"){r=a.value;break}}var o=Nc("Patches").$;return $g(r)?o(r,n):this.produce(r,function(s){return o(s,n.slice(i+1))})},e}(),os=new mRe,cv=os.produce;os.produceWithPatches.bind(os);var gRe=os.setAutoFreeze.bind(os);os.setUseProxies.bind(os);os.applyPatches.bind(os);os.createDraft.bind(os);os.finishDraft.bind(os);const vL=cv;var mh;(function(e){function t(o){if(!o.state||o.state.tree===o.editInfo.sourceTree)return o.tree.asImmutable();for(var s=o.state.tree.asTransient(),u=0,l=o.actions;u<l.length;u++){var c=l[u];switch(c.kind){case"add":s.add(c.transform);break;case"update":s.setParams(c.ref,c.params);break;case"delete":s.remove(c.ref);break;case"insert":{var d=s.children.get(c.ref).toArray();s.add(c.transform);for(var f=0,p=d;f<p.length;f++){var v=p[f];s.changeParent(v,c.transform.ref)}break}}}return o.editInfo.sourceTree=o.tree,s.asImmutable()}function r(o){return!!o&&typeof o.getTree=="function"}e.is=r;function n(o){return!!o&&typeof o.getTree=="function"&&typeof o.ref=="string"}e.isTo=n;var i=function(){function o(s,u){this.state={state:u,tree:s.asTransient(),actions:[],editInfo:{applied:!1,sourceTree:s,count:0,lastUpdate:void 0}}}return Object.defineProperty(o.prototype,"editInfo",{get:function(){return this.state.editInfo},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"currentTree",{get:function(){return this.state.tree},enumerable:!1,configurable:!0}),o.prototype.to=function(s){var u=typeof s=="string"?s:vb.is(s)?s.transform.ref:s.ref;return new a(this.state,u,this)},o.prototype.toRoot=function(){return new a(this.state,this.state.tree.root.ref,this)},o.prototype.delete=function(s){var u=Fi.resolveRef(s);return!u||!this.state.tree.transforms.has(u)?this:(this.editInfo.count++,this.state.tree.remove(u),this.state.actions.push({kind:"delete",ref:u}),this)},o.prototype.getTree=function(){return t(this.state)},o.prototype.commit=function(s){if(!this.state.state)throw new Error("Cannot commit template tree");return this.state.state.runTask(this.state.state.updateTree(this,s))},o}();e.Root=i;var a=function(){function o(s,u,l){if(this.state=s,this.root=l,this.ref=u,!this.state.tree.transforms.has(u))throw new Error("Could not find node '"+u+"'.")}return Object.defineProperty(o.prototype,"editInfo",{get:function(){return this.state.editInfo},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"selector",{get:function(){return new dZ(this.ref,this.state.state)},enumerable:!1,configurable:!0}),o.prototype.getApplyRoot=function(){return li.getDecoratorRoot(this.state.tree,this.ref)},o.prototype.apply=function(s,u,l){if(s.definition.isDecorator)return this.insert(s,u,l);var c=this.getApplyRoot(),d=s.apply(c,u,l);return this.state.tree.add(d),this.editInfo.count++,this.editInfo.lastUpdate=d.ref,this.state.actions.push({kind:"add",transform:d}),new o(this.state,d.ref,this.root)},o.prototype.applyOrUpdate=function(s,u,l,c){if(this.state.tree.transforms.has(s)){var d=this.to(s);return l&&d.update(l),d}else return this.apply(u,l,E(E({},c),{ref:s}))},o.prototype.applyOrUpdateTagged=function(s,u,l,c){if(u.definition.isDecorator)throw new Error("Can't use applyOrUpdateTagged on decorator transformers.");for(var d=this.getApplyRoot(),f=this.state.tree.children.get(d).values();;){var p=f.next();if(p.done)break;var v=this.state.tree.transforms.get(p.value);if(v&&cr.hasTags(v,s)){var h=this.to(p.value);return h.updateTagged(l,pU(v.tags,s,c&&c.tags)),h}}var m=u.apply(d,l,E(E({},c),{tags:pU(s,c&&c.tags)}));return this.state.tree.add(m),this.editInfo.count++,this.editInfo.lastUpdate=m.ref,this.state.actions.push({kind:"add",transform:m}),new o(this.state,m.ref,this.root)},o.prototype.group=function(s,u,l){return this.apply(s,u,l)},o.prototype.insert=function(s,u,l){var c=this.state.tree.children.get(this.ref).toArray(),d=s.apply(this.ref,u,l);this.state.tree.add(d);for(var f=0,p=c;f<p.length;f++){var v=p[f];this.state.tree.changeParent(v,d.ref)}return this.editInfo.count++,this.editInfo.lastUpdate=d.ref,this.state.actions.push({kind:"insert",ref:this.ref,transform:d}),new o(this.state,d.ref,this.root)},o.prototype.updateTagged=function(s,u){(this.state.tree.setParams(this.ref,s)||this.state.tree.setTags(this.ref,u))&&(this.editInfo.count++,this.editInfo.lastUpdate=this.ref,this.state.actions.push({kind:"update",ref:this.ref,params:s}))},o.prototype.update=function(s,u){var l;if(u){var c=this.state.tree.transforms.get(this.ref);l=cv(c.params,u)}else l=typeof s=="function"?cv(this.state.tree.transforms.get(this.ref).params,s):s;return this.state.tree.setParams(this.ref,l)&&(this.editInfo.count++,this.editInfo.lastUpdate=this.ref,this.state.actions.push({kind:"update",ref:this.ref,params:l})),this.root},o.prototype.to=function(s){return this.root.to(s)},o.prototype.toRoot=function(){return this.root.toRoot()},o.prototype.delete=function(s){return this.root.delete(s)},o.prototype.getTree=function(){return t(this.state)},o.prototype.commit=function(s){if(!this.state.state)throw new Error("Cannot commit template tree");return this.state.state.runTask(this.state.state.updateTree(this,s))},o}();e.To=a})(mh||(mh={}));function pU(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var r=void 0,n=[],i=0,a=e;i<a.length;i++){var o=a[i];if(o)if(r||(r=new Set),typeof o=="string"){if(r.has(o))continue;r.add(o),n.push(o)}else for(var s=0,u=o;s<u.length;s++){var l=u[s];r.has(l)||(r.add(l),n.push(l))}}return n}var yRe=function(){function e(){this.ev=Jc.create(),this.actions=new Map,this.fromTypeIndex=new Map,this.events={added:this.ev(),removed:this.ev()}}return e.prototype.add=function(t){var r=ft.is(t)?t.toAction():t;if(this.actions.has(r.id))return this;this.actions.set(r.id,r);for(var n=0,i=r.definition.from;n<i.length;n++){var a=i[n];this.fromTypeIndex.has(a.type)?this.fromTypeIndex.get(a.type).push(r):this.fromTypeIndex.set(a.type,[r])}return this.events.added.next(),this},e.prototype.remove=function(t){var r=ft.is(t)?t.toAction().id:mn.is(t)?t:t.id,n=this.actions.get(r);if(!n)return this;this.actions.delete(r);for(var i=0,a=n.definition.from;i<a.length;i++){var o=a[i],s=this.fromTypeIndex.get(o.type);s&&(Nh(s,n),s.length===0&&this.fromTypeIndex.delete(o.type))}return this.events.removed.next(),this},e.prototype.fromCell=function(t,r){var n=t.obj;if(!n)return[];var i=this.fromTypeIndex.get(n.type);if(!i)return[];for(var a=!1,o=0,s=i;o<s.length;o++){var u=s[o];if(u.definition.isApplicable){a=!0;break}}if(!a)return i;for(var l=[],c=0,d=i;c<d.length;c++){var u=d[c];u.definition.isApplicable?u.definition.isApplicable(n,t.transform,r)&&l.push(u):l.push(u)}return l},e.prototype.dispose=function(){this.ev.dispose()},e}(),_l;(function(e){function t(a){return{type:"message",timestamp:new Date,message:a}}e.message=t;function r(a){return{type:"error",timestamp:new Date,message:a}}e.error=r;function n(a){return{type:"warning",timestamp:new Date,message:a}}e.warning=n;function i(a){return{type:"info",timestamp:new Date,message:a}}e.info=i})(_l||(_l={}));var xb;(function(e){var t=function(){function i(a){this.cells=a,this._current=void 0}return Object.defineProperty(i.prototype,"current",{get:function(){return this._current},set:function(a){this._current=a},enumerable:!1,configurable:!0}),i.prototype.getAncestorOfType=function(a){if(this._current)for(var o=this._current;;){if(o=this.cells.get(o.transform.parent),!o.obj)return;if(o.obj.type===a.type)return o.obj;if(o.transform.ref===cr.RootRef)return}},i.prototype.getRootOfType=function(a){if(this._current)for(var o=this._current,s=void 0;;){if(!o.obj)return;if(o.obj.type===a.type&&(s=o),o.transform.ref===cr.RootRef)return s?s.obj:void 0;o=this.cells.get(o.transform.parent)}},i}();e.Impl=t;function r(i,a){for(var o=i.cells,s=o.get(a),u=[s];s!=null&&s.transform.transformer.definition.isDecorator;)s=o.get(s.transform.parent),u.push(s);return u}e.getDecoratorChain=r;function n(i,a,o){var s=void 0,u=i.cells.get(o);if(u)for(;;){if(!u.obj)return;if(u.obj.type===a.type&&(s=u),u.transform.ref===cr.RootRef)return s?s.obj:void 0;u=i.cells.get(u.transform.parent)}}e.getRootOfType=n})(xb||(xb={}));var bRe=function(){function e(){this.queue=[],this.signal=new ri}return Object.defineProperty(e.prototype,"length",{get:function(){return this.queue.length},enumerable:!1,configurable:!0}),e.prototype.enqueue=function(t){return this.queue.push(t),this.queue.length===1?!0:this.waitFor(t)},e.prototype.handled=function(t){mb(this.queue,t),this.queue.length>0&&this.signal.next({v:this.queue[0],stillPresent:!0})},e.prototype.remove=function(t){var r=mb(this.queue,t);return r&&this.signal.next({v:t,stillPresent:!1}),r},e.prototype.waitFor=function(t){var r=this;return new Promise(function(n){var i=r.signal.subscribe(function(a){var o=a.v,s=a.stillPresent;o===t&&(i.unsubscribe(),n(s))})})},e}(),xRe=function(){function e(t,r){this.getHash=t,this.areEqual=r,this.size=0,this.byHash=new Map}return e.prototype.add=function(t){var r=this.getHash(t);if(this.byHash.has(r)){for(var n=this.byHash.get(r),i=0,a=n.length;i<a;i++)if(this.areEqual(t,n[i]))return!1;return n[n.length]=t,this.size++,!0}else return this.byHash.set(r,[t]),this.size++,!0},e.prototype.has=function(t){var r=this.getHash(t);if(!this.byHash.has(r))return!1;for(var n=this.byHash.get(r),i=0,a=n.length;i<a;i++)if(this.areEqual(t,n[i]))return!0;return!1},e}();function mL(e,t){return new xRe(e,t)}function Y5(){return new SRe}function hU(e){return{previous:null,next:null,inList:!0,value:e}}var SRe=function(){function e(){this.count=0,this.first=null,this.last=null}return e.prototype.addFirst=function(t){var r=hU(t);return r.inList=!0,this.first&&(this.first.previous=r),r.next=this.first,this.first=r,this.count++,this.last||(this.last=r),r},e.prototype.addLast=function(t){var r=hU(t);return this.last!==null&&(this.last.next=r),r.previous=this.last,this.last=r,this.first===null&&(this.first=r),r.inList=!0,this.count++,r},e.prototype.removeFirst=function(){var t=this.first;if(t)return this.remove(t),t.value},e.prototype.removeLast=function(){var t=this.last;if(t)return this.remove(t),t.value},e.prototype.remove=function(t){t.inList&&(t.inList=!1,t.previous!==null?t.previous.next=t.next:t.previous===null&&(this.first=t.next),t.next!==null?t.next.previous=t.previous:t.next===null&&(this.last=t.previous),t.next=null,t.previous=null,this.count--)},e.prototype.find=function(t){for(var r=this.first;r!==null;){if(r.value===t)return r;r=r.next}},e}(),tn;(function(e){function t(){return{keys:new Set,array:[]}}e.create=t;function r(i,a,o){var s=i.keys,u=i.array;return s.has(a)?!1:(s.add(a),u[u.length]=o,!0)}e.add=r;function n(i,a){var o=i.keys;return o.has(a)}e.has=n})(tn||(tn={}));var dp=function(){function e(t,r){var n=this;this.errorFree=!0,this.ev=Jc.create(),this.globalContext=void 0,this.events={cell:{stateUpdated:this.ev(),created:this.ev(),removed:this.ev()},object:{updated:this.ev(),created:this.ev(),removed:this.ev()},log:this.ev(),changed:this.ev(),historyUpdated:this.ev()},this.behaviors={currentObject:this.ev.behavior({state:this,ref:cr.RootRef}),isUpdating:this.ev.behavior(!1)},this.actions=new yRe,this.cells=new Map,this.spine=new xb.Impl(this.cells),this.tryGetCellData=function(o){var s,u,l=(u=(s=n.cells.get(o))===null||s===void 0?void 0:s.obj)===null||u===void 0?void 0:u.data;if(!o)throw new Error("Cell '"+o+"' data undefined.");return l},this.historyCapacity=5,this.history=[],this.undoingHistory=!1,this.inTransaction=!1,this.inTransactionError=!1,this._inUpdate=!1,this.reverted=!1,this.updateQueue=new bRe,this._tree=li.createEmpty(cr.createRoot(r&&r.rootState)).asTransient();var i=this._tree,a=i.root;this.runTask=r.runTask,(r==null?void 0:r.historyCapacity)!==void 0&&(this.historyCapacity=r.historyCapacity),this.cells.set(a.ref,{parent:this,transform:a,sourceRef:void 0,obj:t,status:"ok",state:E({},a.state),errorText:void 0,params:{definition:{},values:{}},paramsNormalizedVersion:a.version,dependencies:{dependentBy:[],dependsOn:[]},cache:{}}),this.globalContext=r&&r.globalContext}return Object.defineProperty(e.prototype,"tree",{get:function(){return this._tree},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"transforms",{get:function(){return this._tree.transforms},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"current",{get:function(){return this.behaviors.currentObject.value.ref},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"root",{get:function(){return this.cells.get(this._tree.root.ref)},enumerable:!1,configurable:!0}),e.prototype.build=function(){return new mh.Root(this.tree,this)},e.prototype.addHistory=function(t,r){this.historyCapacity!==0&&(this.history.unshift([t,r||"Update"]),this.history.length>this.historyCapacity&&this.history.pop(),this.events.historyUpdated.next({state:this}))},e.prototype.clearHistory=function(){this.history.length!==0&&(this.history=[],this.events.historyUpdated.next({state:this}))},Object.defineProperty(e.prototype,"latestUndoLabel",{get:function(){return this.history.length>0?this.history[0][1]:void 0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"canUndo",{get:function(){return this.history.length>0},enumerable:!1,configurable:!0}),e.prototype.undo=function(){var t=this;return $e.create("Undo",function(r){return ce(t,void 0,void 0,function(){var n;return de(this,function(i){switch(i.label){case 0:if(n=this.history.shift(),!n)return[2];this.events.historyUpdated.next({state:this}),this.undoingHistory=!0,i.label=1;case 1:return i.trys.push([1,,3,4]),[4,this.updateTree(n[0],{canUndo:!1}).runInContext(r)];case 2:return i.sent(),[3,4];case 3:return this.undoingHistory=!1,[7];case 4:return[2]}})})})},e.prototype.getSnapshot=function(){return{tree:li.toJSON(this._tree)}},e.prototype.setSnapshot=function(t){var r=li.fromJSON(t.tree);return this.updateTree(r)},e.prototype.setCurrent=function(t){this.behaviors.currentObject.next({state:this,ref:t})},e.prototype.updateCellState=function(t,r){var n=this.cells.get(t);if(n){var i=typeof r=="function"?r(n.state):r;cr.assignState(n.state,i)&&(n.transform=this._tree.assignState(n.transform.ref,i),this.events.cell.stateUpdated.next({state:this,ref:t,cell:n}))}},e.prototype.dispose=function(){this.ev.dispose(),this.actions.dispose()},e.prototype.select=function(t){return ir.select(t,this)},e.prototype.selectQ=function(t){return typeof t=="string"?ir.select(t,this):ir.select(t(ir.Generators),this)},e.prototype.applyAction=function(t,r,n){var i=this;return n===void 0&&(n=cr.RootRef),$e.create("Apply Action",function(a){var o=i.cells.get(n);if(!o)throw new Error("'"+n+"' does not exist.");if(o.status!=="ok")throw new Error("Action cannot be applied to a cell with status '"+o.status+"'");return gL(t.definition.run({ref:n,cell:o,a:o.obj,params:r,state:i},i.globalContext),a)})},e.prototype.transaction=function(t,r){var n=this;return $e.create("State Transaction",function(i){return ce(n,void 0,void 0,function(){var a,o,s,u;return de(this,function(l){switch(l.label){case 0:a=this.inTransaction,o=this._tree.asImmutable(),s=!1,l.label=1;case 1:return l.trys.push([1,5,8,9]),a||this.behaviors.isUpdating.next(!0),this.inTransaction=!0,this.inTransactionError=!1,[4,t(i)];case 2:return l.sent(),this.inTransactionError?(s=!0,[4,this.updateTree(o).runInContext(i)]):[3,4];case 3:l.sent(),l.label=4;case 4:return[3,9];case 5:return u=l.sent(),s?[3,7]:(s=!0,[4,this.updateTree(o).runInContext(i)]);case 6:l.sent(),this.events.log.next(_l.error(""+u)),l.label=7;case 7:if(a)throw this.inTransactionError=!0,u;if(r!=null&&r.rethrowErrors)throw u;return[3,9];case 8:return a||(this.inTransaction=!1,this.events.changed.next({state:this,inTransaction:!1}),this.behaviors.isUpdating.next(!1),s||(r!=null&&r.canUndo?this.addHistory(o,typeof r.canUndo=="string"?r.canUndo:void 0):this.clearHistory())),[7];case 9:return[2]}})})})},Object.defineProperty(e.prototype,"inUpdate",{get:function(){return this._inUpdate},enumerable:!1,configurable:!0}),e.prototype.updateTree=function(t,r){var n=this,i={tree:t,options:r};return $e.create("Update Tree",function(a){return ce(n,void 0,void 0,function(){var o,s,u,l,c;return de(this,function(d){switch(d.label){case 0:return[4,this.updateQueue.enqueue(i)];case 1:if(o=d.sent(),!o)return[2];this._inUpdate=!0,s=r!=null&&r.canUndo?this._tree.asImmutable():void 0,u=!1,this.inTransaction||this.behaviors.isUpdating.next(!0),d.label=2;case 2:if(d.trys.push([2,,7,8]),mh.is(t)){if(t.editInfo.applied)throw new Error("This builder has already been applied. Create a new builder for further state updates");t.editInfo.applied=!0}return this.reverted=!1,r&&(r.revertIfAborted||r.revertOnError)?[4,this._revertibleTreeUpdate(a,i,r)]:[3,4];case 3:return c=d.sent(),[3,6];case 4:return[4,this._updateTree(a,i)];case 5:c=d.sent(),d.label=6;case 6:return l=c,u=this.reverted,l.ctx.hadError&&(this.inTransactionError=!0),l.cell?[2,new dZ(l.cell.transform.ref,this)]:[2];case 7:return this._inUpdate=!1,this.updateQueue.handled(i),this.inTransaction||(this.behaviors.isUpdating.next(!1),r!=null&&r.canUndo?u||this.addHistory(s,typeof r.canUndo=="string"?r.canUndo:void 0):this.undoingHistory||this.clearHistory()),[7];case 8:return[2]}})})},function(){n.updateQueue.remove(i)})},e.prototype._revertibleTreeUpdate=function(t,r,n){return ce(this,void 0,void 0,function(){var i,a,o;return de(this,function(s){switch(s.label){case 0:return i=this.tree,[4,this._updateTree(t,r)];case 1:return a=s.sent(),o=(a.ctx.hadError||a.ctx.wasAborted)&&n.revertOnError||a.ctx.wasAborted&&n.revertIfAborted,o?(this.reverted=!0,[4,this._updateTree(t,{tree:i,options:r.options})]):[3,3];case 2:return[2,s.sent()];case 3:return[2,a]}})})},e.prototype._updateTree=function(t,r){return ce(this,void 0,void 0,function(){var n,i,a;return de(this,function(o){switch(o.label){case 0:n=!1,i=this.updateTreeAndCreateCtx(r.tree,t,r.options),o.label=1;case 1:return o.trys.push([1,,3,4]),[4,_Re(i)];case 2:return n=o.sent(),mh.isTo(r.tree)?(a=this.select(r.tree.ref)[0],[2,{ctx:i,cell:a}]):[2,{ctx:i}];case 3:return this.spine.current=void 0,n&&this.events.changed.next({state:this,inTransaction:this.inTransaction}),[7];case 4:return[2]}})})},e.prototype.updateTreeAndCreateCtx=function(t,r,n){var i=(mh.is(t)?t.getTree():t).asTransient(),a=this._tree;this._tree=i;var o=this.cells,s={parent:this,editInfo:mh.is(t)?t.editInfo:void 0,errorFree:this.errorFree,taskCtx:r,oldTree:a,tree:i,cells:this.cells,spine:this.spine,results:[],options:E(E({},CRe),n),changed:!1,hadError:!1,wasAborted:!1,newCurrent:void 0,getCellData:function(u){var l;return(l=o.get(u).obj)===null||l===void 0?void 0:l.data}};return this.errorFree=!0,s},e}();(function(e){function t(r,n){return new e(r,n)}e.create=t,function(r){function n(i,a){return!!a&&i.ref===a.transform.ref&&i.state===a.parent}r.isCell=n}(e.ObjectEvent||(e.ObjectEvent={}))})(dp||(dp={}));var CRe={doNotLogTiming:!1,doNotUpdateCurrent:!0,revertIfAborted:!1,revertOnError:!1,canUndo:!1};function _Re(e){return ce(this,void 0,void 0,function(){var t,r,n,i,O,a,o,s,m,u,h,S,l,c,m,S,d,f,p,v,S,h,m,g,y,b,S,x,C,w,A,M,D,k,R,O,H;return de(this,function(B){switch(B.label){case 0:if(t=!!(e.editInfo&&e.editInfo.count===1&&e.editInfo.lastUpdate&&e.editInfo.sourceTree===e.oldTree),n=[],t)r=[],i=[e.editInfo.lastUpdate];else{for(r=PRe(e),O=e.parent.current,a=!1,o=0,s=r;o<s.length;o++)if(m=s[o],m===O){a=!0;break}for(a&&(u=vU(e.oldTree,O,r,e.cells),e.parent.setCurrent(u)),h=r.length-1;h>=0;h--)S=e.cells.get(r[h]),S&&Q5(S.transform,S.obj,S==null?void 0:S.transform.params,S.cache,e.parent.globalContext);for(l=0,c=r;l<c.length;l++)m=c[l],S=e.cells.get(m),S&&(S.parent=void 0,RRe(S)),d=S&&S.obj,e.cells.delete(m),n.push(d);i=wRe(e.cells,e.tree)}for(f=LRe(e,i),p=0,v=f.added;p<v.length;p++)S=v[p],e.parent.events.cell.created.next({state:e.parent,ref:S.transform.ref,cell:S});for(h=0;h<r.length;h++)m=r[h],g=e.oldTree.transforms.get(m).parent,e.parent.events.object.removed.next({state:e.parent,ref:m,obj:n[h]}),e.parent.events.cell.removed.next({state:e.parent,ref:m,parent:g});if(n.length&&(n=[]),f.dependent)for(y=0,b=f.dependent;y<b.length;y++)S=b[y],i.push(S.transform.ref);DRe(e,i),x=0,C=i,B.label=1;case 1:return x<C.length?(w=C[x],[4,zZ(e,w)]):[3,4];case 2:B.sent(),B.label=3;case 3:return x++,[3,1];case 4:for(e.editInfo||IRe(e),A=e.newCurrent,M=0,D=e.results;M<D.length;M++)k=D[M],k.action==="created"?(e.parent.events.object.created.next({state:e.parent,ref:k.ref,obj:k.obj}),e.newCurrent||(R=e.tree.transforms.get(k.ref),!R.state.isGhost&&k.obj!==On.Null&&(A=k.ref))):k.action==="updated"?e.parent.events.object.updated.next({state:e.parent,ref:k.ref,action:"in-place",obj:k.obj,oldData:k.oldData}):k.action==="replaced"&&e.parent.events.object.updated.next({state:e.parent,ref:k.ref,action:"recreate",obj:k.obj,oldObj:k.oldObj});return A?e.options.doNotUpdateCurrent||e.parent.setCurrent(A):(O=e.parent.current,H=e.cells.get(O),H&&(H.obj===On.Null||H.status==="error"&&H.errorText===FRe)&&(A=vU(e.oldTree,O,[],e.cells),e.parent.setCurrent(A))),[2,r.length>0||i.length>0||e.changed]}})})}function wRe(e,t){var r={roots:[],cells:e};return li.doPreOrder(t,t.root,r,ERe),r.roots}function ERe(e,t,r){var n=r.cells.get(e.ref);return!n||n.transform.version!==e.version?(r.roots.push(e.ref),!1):!(n.status==="error"||n&&n.obj===On.Null)}function ARe(e,t,r){!r.newTree.transforms.has(e.ref)&&r.cells.has(e.ref)&&r.deletes.push(e.ref)}function PRe(e){var t={newTree:e.tree,cells:e.cells,deletes:[]};return li.doPostOrder(e.oldTree,e.oldTree.root,t,ARe),t.deletes}function TRe(e,t,r){var n=r.cells.get(e.ref);!n||!cr.syncState(n.state,e.state)||r.parent.events.cell.stateUpdated.next({state:r.parent,ref:e.ref,cell:n})}function IRe(e){li.doPreOrder(e.tree,e.tree.root,e,TRe)}function U_(e,t,r,n){var i=e.cells.get(t),a=i.status!==r;i.status=r,i.errorText=n,a&&e.parent.events.cell.stateUpdated.next({state:e.parent,ref:t,cell:i})}function MRe(e,t,r){r.cells.get(e.ref).transform=e,U_(r,e.ref,"pending")}function DRe(e,t){for(var r=0,n=t;r<n.length;r++){var i=n[r];li.doPreOrder(e.tree,e.tree.transforms.get(i),e,MRe)}}function RRe(e){for(var t=0,r=e.dependencies.dependsOn;t<r.length;t++){var n=r[t];Nh(n.dependencies.dependentBy,e)}}function kRe(e,t,r){var n=r.ctx,i=r.added,a=r.visited;if(a.add(e.ref),!n.cells.has(e.ref)){var o={parent:n.parent,transform:e,sourceRef:void 0,status:"pending",state:E({},e.state),errorText:void 0,params:void 0,paramsNormalizedVersion:"",dependencies:{dependentBy:[],dependsOn:[]},cache:void 0};n.cells.set(e.ref,o),i.push(o)}}function ORe(e,t){if(e.transform.dependsOn)for(var r=0,n=e.transform.dependsOn;r<n.length;r++){var i=n[r],a=t.tree.transforms.get(i);if(!a)throw new Error("Cannot depend on a non-existent transform.");var o=t.cells.get(i);Fa(e.dependencies.dependsOn,o),Fa(o.dependencies.dependentBy,e)}}function LRe(e,t){for(var r={ctx:e,visited:new Set,added:[]},n=0,i=t;n<i.length;n++){var a=i[n];li.doPreOrder(e.tree,e.tree.transforms.get(a),r,kRe)}for(var o=0,s=r.added;o<s.length;o++){var u=s[o];ORe(u,e)}var l;return r.visited.forEach(function(c){for(var d=e.cells.get(c),f=0,p=d.dependencies.dependentBy;f<p.length;f++){var v=p[f];r.visited.has(v.transform.ref)||(l||(l=tn.create()),tn.add(l,v.transform.ref,v))}}),{added:r.added,dependent:l?l.array:void 0}}function vU(e,t,r,n){var i=new Set(r);return jZ(e,t,i,n)}function jZ(e,t,r,n){if(t===cr.RootRef)return t;for(var i=e.transforms.get(t),a=e.children.get(i.parent).values(),o=void 0,s=!1;;){var u=a.next();if(u.done)break;if(!r.has(u.value)){var l=n.get(u.value);if(!(!l||l.status==="error"||l.obj===On.Null)){var c=e.transforms.get(u.value);if(!c.state.isGhost){if(u.value===t){s=!0,r.has(t)||(o=t);continue}if(s)return c.ref;o=c.ref}}}}return o||jZ(e,i.parent,r,n)}function K5(e,t,r,n){n||(e.hadError=!0,e.parent.errorFree=!1);var i=e.cells.get(t);if(r){e.wasAborted=e.wasAborted||$e.isAbort(r);var a=""+r;U_(e,t,"error",a),n||e.parent.events.log.next({type:"error",timestamp:new Date,message:a})}else i.params=void 0;if(i.obj){var o=i.obj;i.obj=void 0,i.cache=void 0,e.parent.events.object.removed.next({state:e.parent,ref:t,obj:o})}for(var s=e.tree.children.get(t).values();;){var u=s.next();if(u.done)return;K5(e,u.value,void 0,n)}}var FRe="Parent is null";function zZ(e,t){return ce(this,void 0,void 0,function(){var r,n,i,a,o,s,u;return de(this,function(l){switch(l.label){case 0:U_(e,t,"processing"),r=!1,l.label=1;case 1:return l.trys.push([1,3,,4]),n=kn(),[4,BRe(e,t)];case 2:return i=l.sent(),a=kn()-n,i.action!=="none"&&(e.changed=!0),U_(e,t,"ok"),e.results.push(i),i.action==="created"?(r=i.obj===On.Null,!r&&!e.options.doNotLogTiming&&e.parent.events.log.next(_l.info("Created "+i.obj.label+" in "+$S(a)+"."))):(i.action==="updated"||i.action==="replaced")&&(r=i.obj===On.Null,!r&&!e.options.doNotLogTiming&&e.parent.events.log.next(_l.info("Updated "+i.obj.label+" in "+$S(a)+"."))),[3,4];case 3:return o=l.sent(),e.changed=!0,e.hadError||(e.newCurrent=t),K5(e,t,o,!1),y0||console.error(o),[2];case 4:s=e.tree.children.get(t).values(),l.label=5;case 5:return u=s.next(),u.done?[2]:r?(K5(e,u.value,void 0,!0),[3,8]):[3,6];case 6:return[4,zZ(e,u.value)];case 7:l.sent(),l.label=8;case 8:return[3,5];case 9:return[2]}})})}function NRe(e,t,r,n){var i=t.transformer.definition.params,a=i?i(r,e.parent.globalContext):{};if(n.paramsNormalizedVersion!==t.version)t.params=I.normalizeParams(a,t.params,"all"),n.paramsNormalizedVersion=t.version;else{var o=I.getDefaultValues(a);t.params=t.params?v5e(t.params,o):o}return I.resolveRefs(a,t.params,e.getCellData),{definition:a,values:t.params}}function BRe(e,t){var r;return ce(this,void 0,void 0,function(){var n,i,a,o,s,u,l,c,d,f,p,v,h,m,g,y,b;return de(this,function(S){switch(S.label){case 0:if(n=e.oldTree,i=e.tree,a=e.cells.get(t),o=a.transform,a.transform.ref===cr.RootRef)return[2,{action:"none"}];if(s=o.transformer.definition.from.length===0?e.cells.get(a.transform.parent):ir.findAncestorOfType(i,e.cells,t,o.transformer.definition.from),!s)throw new Error("No suitable parent found for '"+t+"'");return e.spine.current=a,u=s.obj,a.sourceRef=s.transform.ref,l=NRe(e,o,u,a),!n.transforms.has(t)||!a.params?(a.params=l,[4,mU(e,a,o.transformer,u,l.values)]):[3,2];case 1:return c=S.sent(),g4(c,o),a.obj=c,[2,{ref:t,action:"created",obj:c}];case 2:return d=a.params.values,f=a.cache,p=(r=a.obj)===null||r===void 0?void 0:r.data,v=l.values,a.params=l,a.obj&&a.obj!==On.Null?[4,URe(e,a,o.transformer,u,a.obj,d,v)]:[3,4];case 3:return m=S.sent(),[3,5];case 4:m=ft.UpdateResult.Recreate,S.label=5;case 5:switch(h=m,g=h,g){case ft.UpdateResult.Recreate:return[3,6];case ft.UpdateResult.Updated:return[3,8];case ft.UpdateResult.Null:return[3,9]}return[3,10];case 6:return y=a.obj,Q5(o,y,d,f,e.parent.globalContext),[4,mU(e,a,o.transformer,u,v)];case 7:return b=S.sent(),g4(b,o),a.obj=b,[2,{ref:t,action:"replaced",oldObj:y,obj:b}];case 8:return g4(a.obj,o),[2,{ref:t,action:"updated",oldData:p,obj:a.obj}];case 9:return Q5(o,a.obj,d,f,e.parent.globalContext),a.obj=On.Null,[2,{ref:t,action:"updated",obj:a.obj}];case 10:return[2,{action:"none"}]}})})}function Q5(e,t,r,n,i){var a,o;(o=(a=e.transformer.definition).dispose)===null||o===void 0||o.call(a,{b:t!==On.Null?t:void 0,params:r,cache:n},i)}function g4(e,t){!e||e===On.Null||(e.tags=t.tags)}function gL(e,t){return typeof e.runInContext=="function"?e.runInContext(t):e}function VZ(e){if(e.dependencies.dependsOn.length!==0){for(var t=Object.create(null),r=0,n=e.dependencies.dependsOn;r<n.length;r++){var i=n[r];if(!i.obj)throw new Error("Unresolved dependency.");t[i.transform.ref]=i.obj}return t}}function mU(e,t,r,n,i){return t.cache||(t.cache=Object.create(null)),gL(r.definition.apply({a:n,params:i,cache:t.cache,spine:e.spine,dependencies:VZ(t)},e.parent.globalContext),e.taskCtx)}function URe(e,t,r,n,i,a,o){return ce(this,void 0,void 0,function(){return de(this,function(s){return r.definition.update?(t.cache||(t.cache=Object.create(null)),[2,gL(r.definition.update({a:n,oldParams:a,b:i,newParams:o,cache:t.cache,spine:e.spine,dependencies:VZ(t)},e.parent.globalContext),e.taskCtx)]):[2,ft.UpdateResult.Recreate]})})}var ss={kind:"null-location"};function HZ(e,t,r){return{kind:"data-location",tag:e,data:t,element:r}}function Sn(e,t,r,n,i,a){if(i===void 0&&(i=!1),a===void 0&&(a=function(){return!1}),e%r!==0)throw new Error("incompatible groupCount and stride");var o={location:ss,index:0,groupIndex:0,instanceIndex:0,isSecondary:!1},s=o.groupIndex<e,u=!1,l=0,c=0,d=!1;return{get hasNext(){return s},get isNextNewInstance(){return u},groupCount:e,instanceCount:t,count:e*t,stride:r,nonInstanceable:i,move:function(){return s&&(o.groupIndex=l,o.instanceIndex=c,o.index=c*e+l,o.location=n(l,d?-1:c),o.isSecondary=a(l,d?-1:c),l+=r,l===e?(++c,u=!0,c<t&&(l=0)):u=!1,s=l<e),o},reset:function(){o.location=ss,o.index=0,o.groupIndex=0,o.instanceIndex=0,o.isSecondary=!1,s=o.groupIndex<e,u=!1,l=0,c=0,d=!1},skipInstance:function(){s&&o.instanceIndex===c&&(++c,l=0,s=c<t)},voidInstances:function(){d=!0}}}function Lv(e){return{kind:"position-location",position:e?_.clone(e):_()}}var gU=$n(),jRe=ue();function zRe(e,t){for(var r=0;r<t;r++)if($n.fromMat4(gU,ue.fromArray(jRe,e,r*16)),$n.determinant(gU)<0)return!0;return!1}function yL(e,t,r){var n=zRe(e,t);if(r){F.update(r.matrix,r.matrix.ref.value),F.update(r.transform,e),F.updateIfChanged(r.uInstanceCount,t),F.updateIfChanged(r.instanceCount,t);var i=r.aTransform.ref.value.length>=t*16?r.aTransform.ref.value:new Float32Array(t*16);i.set(e),F.update(r.aTransform,i);var a=r.extraTransform.ref.value.length>=t*16?r.extraTransform.ref.value:new Float32Array(t*16);F.update(r.extraTransform,j_(a,t));var o=r.aInstance.ref.value.length>=t?r.aInstance.ref.value:new Float32Array(t);return F.update(r.aInstance,Ys(o,t)),F.update(r.hasReflection,n),GZ(r),r}else return{aTransform:F.create(new Float32Array(e)),matrix:F.create(ue.identity()),transform:F.create(e),extraTransform:F.create(j_(new Float32Array(t*16),t)),uInstanceCount:F.create(t),instanceCount:F.create(t),aInstance:F.create(Ys(new Float32Array(t))),hasReflection:F.create(n)}}var bL=new Float32Array(16);ue.toArray(ue.identity(),bL,0);function xL(e){return yL(new Float32Array(bL),1,e)}function j_(e,t){for(var r=0;r<t;r++)e.set(bL,r*16);return e}function GZ(e){for(var t=e.aTransform.ref.value,r=e.instanceCount.ref.value,n=e.matrix.ref.value,i=e.transform.ref.value,a=e.extraTransform.ref.value,o=0;o<r;o++){var s=o*16;ue.mulOffset(t,a,i,s,s,s),ue.mulOffset(t,n,t,s,0,s)}F.update(e.aTransform,t)}var fr={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflower:6591981,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,laserlemon:16777044,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrod:16448210,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,maroon2:8323072,maroon3:11546720,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,purple2:8323199,purple3:10494192,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};(function(){var e=new Map;return Object.keys(fr).forEach(function(t){e.set(fr[t],t)}),e})();var qZ=at(13421772),VRe="Gives everything the same, uniform color.",$Z={value:I.Color(qZ)};function HRe(e){return $Z}function SL(e,t){var r=Di(t.value,qZ);return{factory:SL,granularity:"uniform",color:function(){return r},props:t,description:VRe,legend:Pp([["uniform",r]])}}var GRe={name:"uniform",label:"Uniform",category:"Miscellaneous",factory:SL,getParams:HRe,defaultValues:I.getDefaultValues($Z),isApplicable:function(e){return!0}},qRe="Gives everything the same, uniform size.",WZ={value:I.Numeric(1,{min:0,max:20,step:.1})};function $Re(e){return WZ}function CL(e,t){var r=t.value;return{factory:CL,granularity:"uniform",size:function(){return r},props:t,description:qRe}}var WRe={name:"uniform",label:"Uniform",category:"",factory:CL,getParams:$Re,defaultValues:I.getDefaultValues(WZ),isApplicable:function(e){return!0}},XRe={custom:{},auto:{},highest:{},higher:{},high:{},medium:{},low:{},lower:{},lowest:{}},YRe=Object.keys(XRe),_L=I.arrayToOptions(YRe),Et;(function(e){e.Params={alpha:I.Numeric(1,{min:0,max:1,step:.01},{label:"Opacity",isEssential:!0,description:"How opaque/transparent the representation is rendered."}),quality:I.Select("auto",_L,{isEssential:!0,description:"Visual/rendering quality of the representation."})},e.ShadingCategory={category:"Shading"},e.CustomQualityParamInfo={category:"Custom Quality",hideIf:function(o){return typeof o.quality<"u"&&o.quality!=="custom"}};function t(o,s,u){o===void 0&&(o=fr.grey),s===void 0&&(s=1),u||(u=xL());var l=Sn(1,u.instanceCount.ref.value,1,function(){return ss},!1,function(){return!1}),c={color:SL({},{value:o}),size:CL({},{value:s})};return{transform:u,locationIterator:l,theme:c}}e.createSimple=t;function r(o,s){return{alpha:F.create(o.alpha),uAlpha:F.create(o.alpha),uVertexCount:F.create(s.vertexCount),uGroupCount:F.create(s.groupCount),drawCount:F.create(s.drawCount)}}e.createValues=r;function n(o,s){F.updateIfChanged(o.alpha,s.alpha)}e.updateValues=n;function i(o){o===void 0&&(o={});var s=o.alpha===void 0?!0:o.alpha===1;return{disposed:!1,visible:!0,alphaFactor:1,pickable:!0,colorOnly:!1,opaque:s,writeDepth:s,noClip:!1}}e.createRenderableState=i;function a(o,s){o.opaque=s.alpha*o.alphaFactor>=1,o.writeDepth=o.opaque}e.updateRenderableState=a})(Et||(Et={}));function Sf(e,t){return{value:e,unit:t}}var Sb;(function(e){function t(u,l,c){var d=!!u[0].cell,f=!!u[0].velocities,p=!!u[0].forces;return{id:mn.create22(),frames:u,hasCell:d,hasVelocities:f,hasForces:p,deltaTime:l,timeOffset:c}}e.create=t;function r(u,l,c){var d=u.x,f=u.y,p=u.z;return u.xyzOrdering.frozen?c?u.xyzOrdering.isIdentity?(d=o(d,c),f=o(f,c),p=o(p,c)):no(u.xyzOrdering.index,c)||(d=a(d,u.xyzOrdering.index,c),f=a(f,u.xyzOrdering.index,c),p=a(p,u.xyzOrdering.index,c)):u.xyzOrdering.isIdentity||(d=s(d,u.xyzOrdering.index),f=s(f,u.xyzOrdering.index),p=s(p,u.xyzOrdering.index)):c&&(u.xyzOrdering.isIdentity?(u.xyzOrdering.isIdentity=!1,u.xyzOrdering.index=c,i(d,c),i(f,c),i(p,c)):no(u.xyzOrdering.index,c)||(d=a(d,u.xyzOrdering.index,c),f=a(f,u.xyzOrdering.index,c),p=a(p,u.xyzOrdering.index,c))),u.xyzOrdering.frozen=!0,{id:mn.create22(),atomId:l,occupancy:ve.ofConst(1,u.elementCount,ve.Schema.int),B_iso_or_equiv:ve.ofConst(0,u.elementCount,ve.Schema.float),xyzDefined:!0,x:d,y:f,z:p}}e.getAtomicConformation=r;var n=[.123];function i(u,l){for(var c=n,d=0,f=u.length;d<f;d++)c[d]=u[l[d]];for(var d=0,f=u.length;d<f;d++)u[d]=c[d]}function a(u,l,c){for(var d=new Float32Array(u.length),f=0,p=u.length;f<p;f++)d[f]=u[l[c[f]]];return d}function o(u,l){for(var c=new Float32Array(u.length),d=0,f=u.length;d<f;d++)c[d]=u[l[d]];return c}function s(u,l){for(var c=new Float32Array(u.length),d=0,f=u.length;d<f;d++)c[l[d]]=u[d];return c}})(Sb||(Sb={}));var Z5;(function(e){function t(r,n,i,a){return{id:mn.create22(),label:r,basic:n,sourceData:a,bonds:i}}e.create=t})(Z5||(Z5={}));function To(e){return e}(function(e){function t(r){return r.__key||(r.__key=mn.create22()),r.__key}e.getUUID=t})(To||(To={}));var Hl=function(){function e(){this._list=[],this._set=new Set,this._refs=new Map,this._assets=new Map}return Object.defineProperty(e.prototype,"all",{get:function(){return this._list},enumerable:!1,configurable:!0}),e.prototype.add=function(t){this._set.has(t)||(this._list.push(t),this._set.add(t))},e.prototype.reference=function(t,r){var n=this._refs.get(t)||0;n+=r?1:-1,this._refs.set(t,Math.max(n,0))},e.prototype.hasReference=function(t){return(this._refs.get(t)||0)>0},e.prototype.has=function(t){return this._set.has(t)},e.prototype.assets=function(t,r){var n=this._assets.get(t);if(n)for(var i=0,a=n;i<a.length;i++){var o=a[i];o.dispose()}r?this._assets.set(t,r):this._assets.delete(t)},e.prototype.dispose=function(){this._assets.forEach(function(t){for(var r=0,n=t;r<n.length;r++){var i=n[r];i.dispose()}})},e}();function KRe(e,t){var r=[],n=[],i=[];e.x.length&&(r.push.apply(r,jo(e.x)),n.push.apply(n,jo(e.y)),i.push.apply(i,jo(e.z))),t&&(t.spheres.x.length&&(r.push.apply(r,jo(t.spheres.x)),n.push.apply(n,jo(t.spheres.y)),i.push.apply(i,jo(t.spheres.z))),t.gaussians.x.length&&(r.push.apply(r,jo(t.gaussians.x)),n.push.apply(n,jo(t.gaussians.y)),i.push.apply(i,jo(t.gaussians.z))));var a=jo(r),o=a[0],s=a[1],u=jo(n),l=u[0],c=u[1],d=jo(i),f=d[0],p=d[1],v=o+(s-o)/2,h=l+(c-l)/2,m=f+(p-f)/2;return _.create(v,h,m)}function QRe(e){var t=new Set,r=new Set;return e.properties.structAsymMap.forEach(function(n,i){var a=n.auth_id;t.add(a),r.add(i)}),{auth:t.size,label:r.size}}var Io;(function(e){function t(d,f){if(d===f)return!0;if(d.vertexCount!==f.vertexCount||d.edgeCount!==f.edgeCount)return!1;for(var p=d.a,v=d.b,h=d.offset,m=f.a,g=f.b,y=f.offset,b=0,S=d.a.length;b<S;b++)if(p[b]!==m[b])return!1;for(var b=0,S=d.b.length;b<S;b++)if(v[b]!==g[b])return!1;for(var b=0,S=d.offset.length;b<S;b++)if(h[b]!==y[b])return!1;for(var x=0,C=Object.keys(d.edgeProps);x<C.length;x++){var w=C[x],A=d.edgeProps[w],M=f.edgeProps[w];if(!M)return!1;for(var b=0,S=A.length;b<S;b++)if(A[b]!==M[b])return!1}return!0}e.areEqual=t;var r=function(){function d(f,p,v,h,m,g){this.offset=f,this.a=p,this.b=v,this.edgeCount=h,this.props=g,this.vertexCount=f.length-1,this.edgeProps=m||{}}return d.prototype.getEdgeIndex=function(f,p){var v,h;f<p?(v=f,h=p):(v=p,h=f);for(var m=this.offset[v],g=this.offset[v+1];m<g;m++)if(this.b[m]===h)return m;return-1},d.prototype.getDirectedEdgeIndex=function(f,p){for(var v=this.offset[f],h=this.offset[f+1];v<h;v++)if(this.b[v]===p)return v;return-1},d.prototype.getVertexEdgeCount=function(f){return this.offset[f+1]-this.offset[f]},d}();function n(d,f,p,v,h,m){return new r(d,f,p,v,h,m)}e.create=n;var i=function(){function d(f,p,v){this.vertexCount=f,this.xs=p,this.ys=v,this.current=0,this.curA=0,this.curB=0,this.edgeCount=p.length,this.offsets=new Int32Array(this.vertexCount+1),this.bucketFill=new Int32Array(this.vertexCount);for(var h=new Int32Array(this.vertexCount),m=0,g=this.xs.length;m<g;m++)h[this.xs[m]]++;for(var m=0,g=this.ys.length;m<g;m++)h[this.ys[m]]++;for(var y=0,m=0;m<this.vertexCount;m++)this.offsets[m]=y,y+=h[m];this.offsets[this.vertexCount]=y,this.slotCount=y,this.a=new Int32Array(y),this.b=new Int32Array(y)}return d.prototype.createGraph=function(f,p){return n(this.offsets,this.a,this.b,this.edgeCount,f,p)},d.prototype.addNextEdge=function(){var f=this.xs[this.current],p=this.ys[this.current],v=this.offsets[f]+this.bucketFill[f],h=this.offsets[p]+this.bucketFill[p];this.a[v]=f,this.b[v]=p,this.bucketFill[f]++,this.a[h]=p,this.b[h]=f,this.bucketFill[p]++,this.current++,this.curA=v,this.curB=h},d.prototype.addAllEdges=function(){for(var f=0;f<this.edgeCount;f++)this.addNextEdge()},d.prototype.assignProperty=function(f,p){f[this.curA]=p,f[this.curB]=p},d}();e.EdgeBuilder=i;var a=function(){function d(f,p,v){this.vertexCount=f,this.xs=p,this.ys=v,this.current=0,this.curA=0,this.edgeCount=p.length,this.offsets=new Int32Array(this.vertexCount+1),this.bucketFill=new Int32Array(this.vertexCount);for(var h=new Int32Array(this.vertexCount),m=0,g=this.xs.length;m<g;m++)h[this.xs[m]]++;for(var y=0,m=0;m<this.vertexCount;m++)this.offsets[m]=y,y+=h[m];this.offsets[this.vertexCount]=y,this.slotCount=y,this.a=new Int32Array(y),this.b=new Int32Array(y)}return d.prototype.createGraph=function(f){return n(this.offsets,this.a,this.b,this.edgeCount,f)},d.prototype.addNextEdge=function(){var f=this.xs[this.current],p=this.ys[this.current],v=this.offsets[f]+this.bucketFill[f];this.a[v]=f,this.b[v]=p,this.bucketFill[f]++,this.current++,this.curA=v},d.prototype.addAllEdges=function(){for(var f=0;f<this.edgeCount;f++)this.addNextEdge()},d.prototype.assignProperty=function(f,p){f[this.curA]=p},d}();e.DirectedEdgeBuilder=a;var o=function(){function d(f){this.vertexCount=f,this.xs=[],this.ys=[],this.included=new Set}return d.prototype.addEdge=function(f,p){var v=f,h=p;f>p&&(v=p,h=f);var m=Qf(v,h);return this.included.has(m)?!1:(this.included.add(m),this.xs[this.xs.length]=v,this.ys[this.ys.length]=h,!0)},d.prototype.getGraph=function(){return s(this.vertexCount,this.xs,this.ys)},d.prototype.getEdgeBuiler=function(){return new i(this.vertexCount,this.xs,this.ys)},d}();e.UniqueEdgeBuilder=o;function s(d,f,p){var v=new e.EdgeBuilder(d,f,p);return v.addAllEdges(),v.createGraph({})}e.fromVertexPairs=s;function u(d,f){for(var p=d.b,v=d.offset,h=d.vertexCount,m=d.edgeProps,g=new Int32Array(h),y=0,b=f.length;y<b;y++)g[f[y]]=y+1;for(var S=0,y=0;y<h;y++)if(g[y]!==0)for(var x=v[y],C=v[y+1];x<C;x++)p[x]>y&&g[p[x]]!==0&&S++;for(var w=new Int32Array(f.length+1),A=new Int32Array(2*S),M=new Int32Array(2*S),D=new Int32Array(2*S),k=0,R=0,y=0;y<h;y++)if(g[y]!==0){for(var O=g[y]-1,x=v[y],C=v[y+1];x<C;x++){var H=g[p[x]];H!==0&&(M[k]=O,D[k]=H-1,A[k]=x,k++)}w[++R]=k}for(var B={},j=0,Y=Object.keys(m);j<Y.length;j++){var G=Y[j];B[G]=dTe(m[G],A)}return n(w,M,D,S,B)}e.induceByVertices=u;function l(d){var f=d.vertexCount;if(f===0)return{componentCount:0,componentIndex:new Int32Array(0)};if(d.edgeCount===0){for(var p=new Int32Array(f),v=0,h=f;v<h;v++)p[v]=v;return{componentCount:f,componentIndex:p}}for(var m=new Int32Array(f),v=0,h=f;v<h;v++)m[v]=-1;var g=0;m[0]=g;var y=d.offset,b=d.b,S=[0],x=TIe(f);for(x.remove(0);S.length>0;){for(var C=S.pop(),w=m[C],A=y[C],M=y[C+1];A<M;A++){var D=b[A];x.has(D)&&(x.remove(D),S.push(D),m[D]=w)}S.length===0&&x.head>=0&&(S.push(x.head),m[x.head]=++g,x.remove(x.head))}return{componentCount:f,componentIndex:m}}e.connectedComponents=l;function c(d,f,p,v){if(Je.areIntersecting(f,p))return!0;if(v<1)return!1;for(var h=new Set,m=0,g=f.length;m<g;++m)h.add(f[m]);return XZ(d,f,p,v,h)}e.areVertexSetsConnected=c})(Io||(Io={}));function XZ(e,t,r,n,i){for(var a=e.b,o=e.offset,s=[],u=0,l=t.length;u<l;++u)for(var c=t[u],d=o[c],f=o[c+1];d<f;++d){var p=a[d];if(!i.has(p)){if(Je.has(r,p))return!0;i.add(p),s[s.length]=p}}return n>1?XZ(e,s,r,n-1,i):!1}var ZRe=function(){function e(){this.map=new Map,this.applicable=new Map}return e.prototype.add=function(t,r,n){this.map.set(t,r),n&&this.applicable.set(t,n)},e.prototype.remove=function(t){this.map.delete(t),this.applicable.delete(t)},e.prototype.get=function(t){return this.map.get(t)},e.prototype.isApplicable=function(t){var r=this.applicable.get(t.sourceData.kind);return r?r(t):!0},e}(),zu;(function(e){function t(r){var n=r.name,i=new ZRe;return{descriptor:r,formatRegistry:i,isApplicable:function(a){return i.isApplicable(a)},get:function(a){if(a._staticPropertyData[n])return a._staticPropertyData[n];if(!a.customProperties.has(r)){var o=i.get(a.sourceData.kind);if(o)return a._staticPropertyData[n]=o(a),a.customProperties.add(r),a._staticPropertyData[n]}},set:function(a,o){a._staticPropertyData[n]=o},delete:function(a){delete a._staticPropertyData[n]}}}e.create=t})(zu||(zu={}));function JRe(e,t,r,n){for(var i=new Io.EdgeBuilder(n,e,t),a=new Int8Array(i.slotCount),o=new Array(i.slotCount),s=new Array(i.slotCount),u=0,l=i.edgeCount;u<l;u++)i.addNextEdge(),i.assignProperty(a,r.order?r.order[u]:1),i.assignProperty(o,r.distance?r.distance[u]:-1),i.assignProperty(s,r.flag?r.flag[u]:1);return i.createGraph({order:a,distance:o,flag:s})}var xa;(function(e){e.Descriptor={name:"index_pair_bonds"},e.Provider=zu.create(e.Descriptor);function t(r){var n=r.pairs,i=r.count,a=n.indexA.toArray(),o=n.indexB.toArray(),s=n.order&&n.order.toArray(),u=n.distance&&n.distance.toArray(),l=n.flag&&n.flag.toArray();return JRe(a,o,{order:s,distance:u,flag:l},i)}e.fromData=t})(xa||(xa={}));var Tp=ve.Schema,ne=Tp.str,Oe=Tp.int,sr=Tp.float,y4=Tp.coord,Mt=Tp.Aliased,Vd=Tp.Matrix,bx=Tp.Vector,Fp=Tp.List,yr={atom_site:{auth_asym_id:ne,auth_atom_id:ne,auth_comp_id:ne,auth_seq_id:Oe,B_iso_or_equiv:sr,Cartn_x:y4,Cartn_y:y4,Cartn_z:y4,group_PDB:Mt(ne),id:Oe,label_alt_id:ne,label_asym_id:ne,label_atom_id:ne,label_comp_id:ne,label_entity_id:ne,label_seq_id:Oe,occupancy:sr,type_symbol:ne,pdbx_PDB_ins_code:ne,pdbx_PDB_model_num:Oe,pdbx_formal_charge:Oe,ihm_model_id:Oe},atom_site_anisotrop:{id:Oe,type_symbol:ne,U:Vd(3,3),U_esd:Vd(3,3),pdbx_auth_seq_id:ne,pdbx_auth_asym_id:ne,pdbx_auth_atom_id:ne,pdbx_auth_comp_id:ne,pdbx_label_seq_id:Oe,pdbx_label_alt_id:ne,pdbx_label_asym_id:ne,pdbx_label_atom_id:ne,pdbx_label_comp_id:ne,pdbx_PDB_ins_code:ne},atom_sites:{entry_id:ne,fract_transf_matrix:Vd(3,3),fract_transf_vector:bx(3)},audit_author:{name:ne,pdbx_ordinal:Oe,identifier_ORCID:ne},audit_conform:{dict_location:ne,dict_name:ne,dict_version:ne},cell:{angle_alpha:sr,angle_beta:sr,angle_gamma:sr,entry_id:ne,length_a:sr,length_b:sr,length_c:sr,Z_PDB:Oe,pdbx_unique_axis:ne},chem_comp:{formula:ne,formula_weight:sr,id:ne,mon_nstd_flag:Mt(ne),name:ne,type:Mt(ne),pdbx_synonyms:Fp(";",function(e){return e})},chem_comp_bond:{atom_id_1:ne,atom_id_2:ne,comp_id:ne,value_order:Mt(ne),pdbx_ordinal:Oe,pdbx_stereo_config:Mt(ne),pdbx_aromatic_flag:Mt(ne)},citation:{book_publisher:ne,country:ne,id:ne,journal_abbrev:ne,journal_id_ASTM:ne,journal_id_CSD:ne,journal_id_ISSN:ne,journal_volume:ne,page_first:ne,page_last:ne,title:ne,year:Oe,pdbx_database_id_DOI:ne,pdbx_database_id_PubMed:Oe},citation_author:{citation_id:ne,name:ne,ordinal:Oe},database_2:{database_id:Mt(ne),database_code:ne},entity:{details:ne,formula_weight:sr,id:ne,src_method:Mt(ne),type:Mt(ne),pdbx_description:Fp(",",function(e){return e}),pdbx_number_of_molecules:Oe,pdbx_mutation:ne,pdbx_fragment:ne,pdbx_ec:Fp(",",function(e){return e})},entity_poly:{entity_id:ne,nstd_linkage:Mt(ne),nstd_monomer:Mt(ne),type:Mt(ne),pdbx_strand_id:Fp(",",function(e){return e}),pdbx_seq_one_letter_code:ne,pdbx_seq_one_letter_code_can:ne,pdbx_target_identifier:ne},entity_poly_seq:{entity_id:ne,hetero:Mt(ne),mon_id:ne,num:Oe},entry:{id:ne},exptl:{entry_id:ne,method:Mt(ne)},struct:{entry_id:ne,title:ne,pdbx_descriptor:ne},struct_asym:{details:ne,entity_id:ne,id:ne,pdbx_modified:ne,pdbx_blank_PDB_chainid_flag:Mt(ne)},struct_conf:{beg_label_asym_id:ne,beg_label_comp_id:ne,beg_label_seq_id:Oe,beg_auth_asym_id:ne,beg_auth_comp_id:ne,beg_auth_seq_id:Oe,conf_type_id:Mt(ne),details:ne,end_label_asym_id:ne,end_label_comp_id:ne,end_label_seq_id:Oe,end_auth_asym_id:ne,end_auth_comp_id:ne,end_auth_seq_id:Oe,id:ne,pdbx_beg_PDB_ins_code:ne,pdbx_end_PDB_ins_code:ne,pdbx_PDB_helix_class:ne,pdbx_PDB_helix_length:Oe,pdbx_PDB_helix_id:ne},struct_conn:{conn_type_id:Mt(ne),details:ne,id:ne,ptnr1_label_asym_id:ne,ptnr1_label_atom_id:ne,ptnr1_label_comp_id:ne,ptnr1_label_seq_id:Oe,ptnr1_auth_asym_id:ne,ptnr1_auth_comp_id:ne,ptnr1_auth_seq_id:Oe,ptnr1_symmetry:ne,ptnr2_label_asym_id:ne,ptnr2_label_atom_id:ne,ptnr2_label_comp_id:ne,ptnr2_label_seq_id:Oe,ptnr2_auth_asym_id:ne,ptnr2_auth_comp_id:ne,ptnr2_auth_seq_id:Oe,ptnr2_symmetry:ne,pdbx_ptnr1_PDB_ins_code:ne,pdbx_ptnr1_label_alt_id:ne,pdbx_ptnr1_standard_comp_id:ne,pdbx_ptnr2_PDB_ins_code:ne,pdbx_ptnr2_label_alt_id:ne,pdbx_ptnr3_PDB_ins_code:ne,pdbx_ptnr3_label_alt_id:ne,pdbx_ptnr3_label_asym_id:ne,pdbx_ptnr3_label_atom_id:ne,pdbx_ptnr3_label_comp_id:ne,pdbx_ptnr3_label_seq_id:Oe,pdbx_PDB_id:ne,pdbx_dist_value:sr,pdbx_value_order:Mt(ne)},struct_conn_type:{criteria:ne,id:Mt(ne),reference:ne},struct_keywords:{entry_id:ne,text:Fp(",",function(e){return e}),pdbx_keywords:ne},struct_ncs_oper:{code:Mt(ne),details:ne,id:Oe,matrix:Vd(3,3),vector:bx(3)},struct_sheet_range:{beg_label_asym_id:ne,beg_label_comp_id:ne,beg_label_seq_id:Oe,end_label_asym_id:ne,end_label_comp_id:ne,end_label_seq_id:Oe,beg_auth_asym_id:ne,beg_auth_comp_id:ne,beg_auth_seq_id:Oe,end_auth_asym_id:ne,end_auth_comp_id:ne,end_auth_seq_id:Oe,id:ne,sheet_id:ne,pdbx_beg_PDB_ins_code:ne,pdbx_end_PDB_ins_code:ne},struct_site:{details:ne,id:ne,pdbx_num_residues:Oe,pdbx_evidence_code:ne,pdbx_auth_asym_id:ne,pdbx_auth_comp_id:ne,pdbx_auth_seq_id:ne,pdbx_auth_ins_code:ne},struct_site_gen:{details:ne,id:ne,label_alt_id:ne,label_asym_id:ne,label_atom_id:ne,label_comp_id:ne,label_seq_id:Oe,auth_asym_id:ne,auth_comp_id:ne,auth_seq_id:ne,site_id:ne,symmetry:ne,pdbx_auth_ins_code:ne,pdbx_num_res:Oe},symmetry:{entry_id:ne,cell_setting:Mt(ne),Int_Tables_number:Oe,space_group_name_Hall:ne,"space_group_name_H-M":ne},pdbx_database_status:{status_code:Mt(ne),status_code_sf:Mt(ne),status_code_mr:Mt(ne),entry_id:ne,recvd_initial_deposition_date:ne,SG_entry:Mt(ne),deposit_site:Mt(ne),process_site:Mt(ne),status_code_cs:Mt(ne),methods_development_category:Mt(ne),pdb_format_compatible:Mt(ne)},pdbx_nonpoly_scheme:{asym_id:ne,entity_id:ne,mon_id:ne,pdb_strand_id:ne,ndb_seq_num:ne,pdb_seq_num:ne,auth_seq_num:ne,pdb_mon_id:ne,auth_mon_id:ne,pdb_ins_code:ne},pdbx_database_related:{db_name:ne,details:ne,db_id:ne,content_type:Mt(ne)},pdbx_entity_nonpoly:{entity_id:ne,comp_id:ne,name:ne},pdbx_chem_comp_synonyms:{name:ne,comp_id:ne,provenance:Mt(ne)},pdbx_chem_comp_identifier:{comp_id:ne,identifier:ne,type:Mt(ne),program:ne,program_version:ne},pdbx_unobs_or_zero_occ_residues:{id:Oe,polymer_flag:Mt(ne),occupancy_flag:Mt(Oe),PDB_model_num:Oe,auth_asym_id:ne,auth_comp_id:ne,auth_seq_id:ne,PDB_ins_code:ne,label_asym_id:ne,label_comp_id:ne,label_seq_id:Oe},pdbx_struct_mod_residue:{id:Oe,auth_asym_id:ne,auth_comp_id:ne,auth_seq_id:Oe,PDB_ins_code:ne,label_asym_id:ne,label_comp_id:ne,label_seq_id:Oe,parent_comp_id:ne,details:ne},pdbx_struct_oper_list:{id:ne,type:Mt(ne),name:ne,symmetry_operation:ne,matrix:Vd(3,3),vector:bx(3)},pdbx_struct_assembly:{method_details:ne,oligomeric_details:ne,oligomeric_count:Oe,details:ne,id:ne},pdbx_struct_assembly_gen:{asym_id_list:Fp(",",function(e){return e}),assembly_id:ne,oper_expression:ne},pdbx_reference_entity_list:{prd_id:ne,ref_entity_id:ne,type:Mt(ne),details:ne,component_id:Oe},pdbx_reference_entity_link:{link_id:Oe,prd_id:ne,details:ne,ref_entity_id_1:ne,ref_entity_id_2:ne,entity_seq_num_1:Oe,entity_seq_num_2:Oe,comp_id_1:ne,comp_id_2:ne,atom_id_1:ne,atom_id_2:ne,value_order:Mt(ne),component_1:Oe,component_2:Oe,link_class:Mt(ne)},pdbx_reference_entity_poly_link:{link_id:Oe,prd_id:ne,ref_entity_id:ne,component_id:Oe,entity_seq_num_1:Oe,entity_seq_num_2:Oe,comp_id_1:ne,comp_id_2:ne,atom_id_1:ne,atom_id_2:ne,value_order:Mt(ne)},pdbx_molecule:{prd_id:ne,instance_id:Oe,asym_id:ne},pdbx_molecule_features:{prd_id:ne,class:Mt(ne),type:Mt(ne),name:ne,details:ne},entity_src_nat:{entity_id:ne,pdbx_organism_scientific:ne,pdbx_plasmid_name:ne,pdbx_src_id:Oe,pdbx_beg_seq_num:Oe,pdbx_end_seq_num:Oe},entity_src_gen:{entity_id:ne,pdbx_gene_src_gene:Fp(",",function(e){return e}),pdbx_gene_src_scientific_name:ne,plasmid_name:ne,pdbx_src_id:Oe,pdbx_beg_seq_num:Oe,pdbx_end_seq_num:Oe},pdbx_entity_src_syn:{organism_scientific:ne,entity_id:ne,pdbx_src_id:Oe,pdbx_beg_seq_num:Oe,pdbx_end_seq_num:Oe},pdbx_entity_branch_descriptor:{entity_id:ne,descriptor:ne,type:Mt(ne),program:ne,program_version:ne,ordinal:Oe},pdbx_entity_instance_feature:{details:ne,feature_type:Mt(ne),auth_asym_id:ne,asym_id:ne,auth_seq_num:ne,seq_num:Oe,comp_id:ne,auth_comp_id:ne,ordinal:Oe},pdbx_entity_branch_list:{entity_id:ne,hetero:Mt(ne),comp_id:ne,num:Oe},pdbx_entity_branch_link:{link_id:Oe,details:ne,entity_id:ne,entity_branch_list_num_1:Oe,entity_branch_list_num_2:Oe,comp_id_1:ne,comp_id_2:ne,atom_id_1:ne,leaving_atom_id_1:ne,atom_stereo_config_1:Mt(ne),atom_id_2:ne,leaving_atom_id_2:ne,atom_stereo_config_2:Mt(ne),value_order:Mt(ne)},pdbx_entity_branch:{entity_id:ne,type:Mt(ne)},pdbx_branch_scheme:{entity_id:ne,hetero:Mt(ne),asym_id:ne,mon_id:ne,num:Oe,pdb_asym_id:ne,pdb_seq_num:ne,pdb_mon_id:ne,auth_asym_id:ne,auth_seq_num:ne,auth_mon_id:ne},pdbx_chem_comp_related:{comp_id:ne,related_comp_id:ne,relationship_type:Mt(ne),details:ne},ihm_starting_model_details:{starting_model_id:ne,entity_id:ne,entity_description:ne,asym_id:ne,entity_poly_segment_id:Oe,starting_model_source:Mt(ne),starting_model_auth_asym_id:ne,starting_model_sequence_offset:Oe,dataset_list_id:Oe},ihm_starting_comparative_models:{id:Oe,starting_model_id:ne,starting_model_auth_asym_id:ne,starting_model_seq_id_begin:Oe,starting_model_seq_id_end:Oe,template_auth_asym_id:ne,template_seq_id_begin:Oe,template_seq_id_end:Oe,template_sequence_identity:sr,template_sequence_identity_denominator:Mt(Oe),template_dataset_list_id:Oe,alignment_file_id:Oe},ihm_starting_model_seq_dif:{id:Oe,entity_id:ne,asym_id:ne,seq_id:Oe,comp_id:ne,starting_model_id:ne,db_asym_id:ne,db_seq_id:Oe,db_comp_id:ne,details:ne},ihm_model_representation:{id:Oe,name:ne,details:ne},ihm_model_representation_details:{id:Oe,representation_id:Oe,entity_poly_segment_id:Oe,entity_id:ne,entity_description:ne,entity_asym_id:ne,model_object_primitive:Mt(ne),starting_model_id:ne,model_mode:Mt(ne),model_granularity:Mt(ne),model_object_count:Oe},ihm_struct_assembly_details:{id:Oe,assembly_id:Oe,parent_assembly_id:Oe,entity_description:ne,entity_id:ne,asym_id:ne,entity_poly_segment_id:Oe},ihm_struct_assembly:{id:Oe,name:ne,description:ne},ihm_modeling_protocol:{id:Oe,num_steps:Oe,protocol_name:ne},ihm_modeling_protocol_details:{id:Oe,protocol_id:Oe,step_id:Oe,struct_assembly_id:Oe,dataset_group_id:Oe,struct_assembly_description:ne,step_name:ne,step_method:ne,num_models_begin:Oe,num_models_end:Oe,multi_scale_flag:Mt(ne),multi_state_flag:Mt(ne),ordered_flag:Mt(ne),script_file_id:Oe,software_id:Oe},ihm_multi_state_modeling:{state_id:Oe,state_group_id:Oe,population_fraction:sr,population_fraction_sd:sr,state_type:ne,state_name:ne,experiment_type:Mt(ne),details:ne},ihm_modeling_post_process:{id:Oe,protocol_id:Oe,analysis_id:Oe,step_id:Oe,type:Mt(ne),feature:Mt(ne),num_models_begin:Oe,num_models_end:Oe},ihm_ensemble_info:{ensemble_id:Oe,ensemble_name:ne,post_process_id:Oe,model_group_id:Oe,ensemble_clustering_method:Mt(ne),ensemble_clustering_feature:Mt(ne),num_ensemble_models:Oe,num_ensemble_models_deposited:Oe,ensemble_precision_value:sr,ensemble_file_id:Oe},ihm_model_list:{model_id:Oe,model_name:ne,assembly_id:Oe,protocol_id:Oe,representation_id:Oe},ihm_model_group:{id:Oe,name:ne,details:ne},ihm_model_group_link:{model_id:Oe,group_id:Oe},ihm_model_representative:{id:Oe,model_group_id:Oe,model_id:Oe,selection_criteria:Mt(ne)},ihm_dataset_list:{id:Oe,data_type:Mt(ne),database_hosted:Mt(ne)},ihm_dataset_group:{id:Oe,name:ne,application:Mt(ne),details:ne},ihm_dataset_group_link:{dataset_list_id:Oe,group_id:Oe},ihm_related_datasets:{dataset_list_id_derived:Oe,dataset_list_id_primary:Oe},ihm_dataset_related_db_reference:{id:Oe,dataset_list_id:Oe,db_name:Mt(ne),accession_code:ne,version:ne,details:ne},ihm_external_reference_info:{reference_id:Oe,reference_provider:ne,reference_type:Mt(ne),reference:ne,refers_to:Mt(ne),associated_url:ne},ihm_external_files:{id:Oe,reference_id:Oe,file_path:ne,content_type:Mt(ne),file_size_bytes:sr,details:ne},ihm_dataset_external_reference:{id:Oe,dataset_list_id:Oe,file_id:Oe},ihm_localization_density_files:{id:Oe,file_id:Oe,ensemble_id:Oe,entity_id:ne,entity_poly_segment_id:Oe,asym_id:ne},ihm_predicted_contact_restraint:{id:Oe,group_id:Oe,entity_id_1:ne,entity_id_2:ne,asym_id_1:ne,asym_id_2:ne,comp_id_1:ne,comp_id_2:ne,seq_id_1:Oe,seq_id_2:Oe,rep_atom_1:Mt(ne),rep_atom_2:Mt(ne),distance_lower_limit:sr,distance_upper_limit:sr,probability:sr,restraint_type:Mt(ne),model_granularity:Mt(ne),dataset_list_id:Oe,software_id:Oe},ihm_cross_link_list:{id:Oe,group_id:Oe,entity_description_1:ne,entity_description_2:ne,entity_id_1:ne,entity_id_2:ne,comp_id_1:ne,comp_id_2:ne,seq_id_1:Oe,seq_id_2:Oe,linker_type:Mt(ne),dataset_list_id:Oe},ihm_cross_link_restraint:{id:Oe,group_id:Oe,entity_id_1:ne,entity_id_2:ne,asym_id_1:ne,asym_id_2:ne,comp_id_1:ne,comp_id_2:ne,seq_id_1:Oe,seq_id_2:Oe,atom_id_1:ne,atom_id_2:ne,restraint_type:Mt(ne),conditional_crosslink_flag:Mt(ne),model_granularity:Mt(ne),distance_threshold:sr,psi:sr,sigma_1:sr,sigma_2:sr},ihm_cross_link_result_parameters:{id:Oe,restraint_id:Oe,model_id:Oe,psi:sr,sigma_1:sr,sigma_2:sr},ihm_2dem_class_average_restraint:{id:Oe,dataset_list_id:Oe,number_raw_micrographs:Oe,pixel_size_width:sr,pixel_size_height:sr,image_resolution:sr,image_segment_flag:Mt(ne),number_of_projections:Oe,struct_assembly_id:Oe,details:ne},ihm_2dem_class_average_fitting:{id:Oe,restraint_id:Oe,model_id:Oe,cross_correlation_coefficient:sr,rot_matrix:Vd(3,3),tr_vector:bx(3)},ihm_3dem_restraint:{id:Oe,dataset_list_id:Oe,model_id:Oe,struct_assembly_id:Oe,fitting_method:ne,number_of_gaussians:Oe,cross_correlation_coefficient:sr},ihm_sas_restraint:{id:Oe,dataset_list_id:Oe,model_id:Oe,struct_assembly_id:Oe,profile_segment_flag:Mt(ne),fitting_atom_type:ne,fitting_method:ne,fitting_state:Mt(ne),radius_of_gyration:sr,chi_value:sr,details:ne},ihm_starting_model_coord:{ordinal_id:Oe,starting_model_id:ne,group_PDB:Mt(ne),id:Oe,type_symbol:ne,entity_id:ne,atom_id:ne,comp_id:ne,seq_id:Oe,asym_id:ne,Cartn_x:sr,Cartn_y:sr,Cartn_z:sr,B_iso_or_equiv:sr},ihm_sphere_obj_site:{id:Oe,entity_id:ne,seq_id_begin:Oe,seq_id_end:Oe,asym_id:ne,Cartn_x:sr,Cartn_y:sr,Cartn_z:sr,object_radius:sr,rmsf:sr,model_id:Oe},ihm_gaussian_obj_site:{id:Oe,entity_id:ne,seq_id_begin:Oe,seq_id_end:Oe,asym_id:ne,mean_Cartn_x:sr,mean_Cartn_y:sr,mean_Cartn_z:sr,weight:sr,covariance_matrix:Vd(3,3),model_id:Oe},ihm_gaussian_obj_ensemble:{id:Oe,entity_id:ne,seq_id_begin:Oe,seq_id_end:Oe,asym_id:ne,mean_Cartn_x:sr,mean_Cartn_y:sr,mean_Cartn_z:sr,weight:sr,covariance_matrix:Vd(3,3),ensemble_id:Oe},ihm_feature_list:{feature_id:Oe,feature_type:Mt(ne),entity_type:Mt(ne)},ihm_poly_residue_feature:{ordinal_id:Oe,feature_id:Oe,entity_id:ne,asym_id:ne,comp_id_begin:ne,comp_id_end:ne,seq_id_begin:Oe,seq_id_end:Oe},ihm_derived_distance_restraint:{id:Oe,group_id:Oe,feature_id_1:Oe,feature_id_2:Oe,group_conditionality:Mt(ne),random_exclusion_fraction:sr,distance_upper_limit:sr,restraint_type:Mt(ne),dataset_list_id:Oe}},eke={type_symbol:ve.Schema.Aliased(yr.atom_site.type_symbol),label_atom_id:yr.atom_site.label_atom_id,auth_atom_id:yr.atom_site.auth_atom_id,label_alt_id:yr.atom_site.label_alt_id,label_comp_id:yr.atom_site.label_comp_id,auth_comp_id:yr.atom_site.auth_comp_id,pdbx_formal_charge:yr.atom_site.pdbx_formal_charge},tke={group_PDB:yr.atom_site.group_PDB,label_seq_id:yr.atom_site.label_seq_id,auth_seq_id:yr.atom_site.auth_seq_id,pdbx_PDB_ins_code:yr.atom_site.pdbx_PDB_ins_code},rke={label_asym_id:yr.atom_site.label_asym_id,auth_asym_id:yr.atom_site.auth_asym_id,label_entity_id:yr.atom_site.label_entity_id},J5;(function(e){function t(){return{label_entity_id:"",label_asym_id:"",auth_seq_id:0,pdbx_PDB_ins_code:void 0}}e.EmptyResidueKey=t})(J5||(J5={}));var dv;(function(e){function t(i,a){return i.residueAtomSegments.index[i.chainAtomSegments.offsets[a]]}e.chainStartResidueIndex=t;function r(i,a){return i.residueAtomSegments.index[i.chainAtomSegments.offsets[a+1]-1]+1}e.chainEndResidueIndexExcl=r;function n(i,a){return r(i,a)-t(i,a)}e.chainResidueCount=n})(dv||(dv={}));var yE={H:1,D:1,T:1,HE:2,LI:3,BE:4,B:5,C:6,N:7,O:8,F:9,NE:10,NA:11,MG:12,AL:13,SI:14,P:15,S:16,CL:17,AR:18,K:19,CA:20,SC:21,TI:22,V:23,CR:24,MN:25,FE:26,CO:27,NI:28,CU:29,ZN:30,GA:31,GE:32,AS:33,SE:34,BR:35,KR:36,RB:37,SR:38,Y:39,ZR:40,NB:41,MO:42,TC:43,RU:44,RH:45,PD:46,AG:47,CD:48,IN:49,SN:50,SB:51,TE:52,I:53,XE:54,CS:55,BA:56,LA:57,CE:58,PR:59,ND:60,PM:61,SM:62,EU:63,GD:64,TB:65,DY:66,HO:67,ER:68,TM:69,YB:70,LU:71,HF:72,TA:73,W:74,RE:75,OS:76,IR:77,PT:78,AU:79,HG:80,TL:81,PB:82,BI:83,PO:84,AT:85,RN:86,FR:87,RA:88,AC:89,TH:90,PA:91,U:92,NP:93,PU:94,AM:95,CM:96,BK:97,CF:98,ES:99,FM:100,MD:101,NO:102,LR:103,RF:104,DB:105,SG:106,BH:107,HS:108,MT:109},nke={1:1.1,2:1.4,3:1.81,4:1.53,5:1.92,6:1.7,7:1.55,8:1.52,9:1.47,10:1.54,11:2.27,12:1.73,13:1.84,14:2.1,15:1.8,16:1.8,17:1.75,18:1.88,19:2.75,20:2.31,21:2.3,22:2.15,23:2.05,24:2.05,25:2.05,26:2.05,27:2,28:2,29:2,30:2.1,31:1.87,32:2.11,33:1.85,34:1.9,35:1.83,36:2.02,37:3.03,38:2.49,39:2.4,40:2.3,41:2.15,42:2.1,43:2.05,44:2.05,45:2,46:2.05,47:2.1,48:2.2,49:2.2,50:1.93,51:2.17,52:2.06,53:1.98,54:2.16,55:3.43,56:2.68,57:2.5,58:2.48,59:2.47,60:2.45,61:2.43,62:2.42,63:2.4,64:2.38,65:2.37,66:2.35,67:2.33,68:2.32,69:2.3,70:2.28,71:2.27,72:2.25,73:2.2,74:2.1,75:2.05,76:2,77:2,78:2.05,79:2.1,80:2.05,81:1.96,82:2.02,83:2.07,84:1.97,85:2.02,86:2.2,87:3.48,88:2.83,89:2,90:2.4,91:2,92:2.3,93:2,94:2,95:2,96:2,97:2,98:2,99:2,100:2,101:2,102:2,103:2,104:2,105:2,106:2,107:2,108:2,109:2},ike={1:1.008,2:4.0026,3:6.94,4:9.0122,5:10.81,6:10.81,7:14.007,8:15.999,9:18.998,10:20.18,11:22.99,12:24.305,13:26.982,14:28.085,15:30.974,16:32.06,17:35.45,18:39.948,19:39.098,20:40.078,21:44.956,22:47.867,23:50.942,24:51.996,25:54.938,26:55.845,27:58.933,28:58.693,29:63.546,30:65.38,31:69.723,32:72.63,33:74.922,34:78.971,35:79.904,36:83.798,37:85.468,38:87.62,39:88.906,40:91.224,41:92.906,42:95.95,43:96.906,44:101.07,45:102.91,46:106.42,47:107.87,48:112.41,49:114.82,50:118.71,51:121.76,52:127.6,53:127.6,54:131.29,55:132.91,56:137.33,57:138.91,58:140.12,59:140.91,60:144.24,61:144.912,62:150.36,63:151.96,64:157.25,65:158.93,66:162.5,67:164.93,68:167.26,69:168.93,70:173.05,71:174.97,72:178.49,73:180.95,74:183.84,75:186.21,76:190.23,77:192.22,78:195.08,79:196.97,80:200.59,81:204.38,82:207.2,83:208.98,84:1.97,85:2.02,86:2.2,87:3.48,88:2.83,89:2,90:232.04,91:231.04,92:238.03,93:237.048,94:244.064,95:243.061,96:247.07,97:247.07,98:251.079,99:252.083,100:257.095,101:258.098,102:259.101,103:262.11,104:267.122,105:270.131,106:271.134,107:270.133,108:270.134,109:278.156},ake=1.7,oke=10.81,ske=0;function i2(e){var t=yE[e];return t===void 0?ake:nke[t]}function uke(e){var t=yE[e];return t===void 0?oke:ike[t]}function a2(e){var t=yE[e];return t===void 0?ske:t}function b1(e,t){return t?t.length===1?Qf(t.charCodeAt(0),e):t.length===2?Qf(t.charCodeAt(0),Qf(t.charCodeAt(1),e)):e+" "+t:e}function lke(e,t,r,n){if(e.has(t)){var i=e.get(t);i.has(r)||i.set(r,n)}else{var i=new Map;e.set(t,i),i.set(r,n)}}function cke(e){throw new Error("Missing entity entry for entity id '"+e+"'.")}function dke(e,t,r){return{entities:e,segments:r,label_seq_id:Je.ofSortedArray(t.residues.label_seq_id.toArray({array:Int32Array})),label_atom_id:t.atoms.label_atom_id,auth_atom_id:t.atoms.auth_atom_id,label_alt_id:t.atoms.label_alt_id,chain_index_entity_index:new Int32Array(t.chains._rowCount),entity_index_label_asym_id:new Map,chain_index_label_seq_id:new Map,auth_asym_id_auth_seq_id:new Map,chain_index_auth_seq_id:new Map,label_asym_id:new Map}}var oy=J5.EmptyResidueKey(),fke=function(){function e(t){this.map=t,this.entityIndex=t.entities.getEntityIndex,this.residueOffsets=this.map.segments.residueAtomSegments.offsets}return e.prototype.getEntityFromChain=function(t){return this.map.chain_index_entity_index[t]},e.prototype.findEntity=function(t){var r=this.map.label_asym_id.get(t);return r!==void 0?r:-1},e.prototype.findChainLabel=function(t){var r=this.entityIndex(t.label_entity_id);if(r<0||!this.map.entity_index_label_asym_id.has(r))return-1;var n=this.map.entity_index_label_asym_id.get(r);return n&&n.has(t.label_asym_id)?n.get(t.label_asym_id):-1},e.prototype.findChainAuth=function(t){if(!this.map.auth_asym_id_auth_seq_id.has(t.auth_asym_id))return-1;var r=this.map.auth_asym_id_auth_seq_id.get(t.auth_asym_id);return r.has(t.auth_seq_id)?r.get(t.auth_seq_id):-1},e.prototype.findResidue=function(t,r,n,i){var a;arguments.length===1?a=t:(oy.label_entity_id=t,oy.label_asym_id=r,oy.auth_seq_id=n,oy.pdbx_PDB_ins_code=i,a=oy);var o=this.findChainLabel(a);if(o<0)return-1;var s=this.map.chain_index_auth_seq_id.get(o),u=b1(a.auth_seq_id,a.pdbx_PDB_ins_code||"");return s.has(u)?s.get(u):-1},e.prototype.findResidueAuth=function(t){var r=this.findChainAuth(t);if(r<0)return-1;var n=this.map.chain_index_auth_seq_id.get(r),i=b1(t.auth_seq_id,t.pdbx_PDB_ins_code||"");return n.has(i)?n.get(i):-1},e.prototype.findResidueInsertion=function(t){var r=this.findChainLabel(t);if(r<0)return-1;var n=this.map.chain_index_label_seq_id.get(r),i=b1(t.label_seq_id,t.pdbx_PDB_ins_code||"");if(n.has(i))return n.get(i);var a=Je.findPredecessorIndex(this.map.label_seq_id,t.label_seq_id),o=dv.chainStartResidueIndex(this.map.segments,r);if(a<o)return o;var s=dv.chainEndResidueIndexExcl(this.map.segments,r)-1;return a>=s?s:a},e.prototype.findAtom=function(t){var r=this.findResidue(t);return r<0?-1:typeof t.label_alt_id>"u"?b4(this.residueOffsets[r],this.residueOffsets[r+1],this.map.label_atom_id,t.label_atom_id):x4(this.residueOffsets[r],this.residueOffsets[r+1],this.map.label_atom_id,this.map.label_alt_id,t.label_atom_id,t.label_alt_id)},e.prototype.findAtomAuth=function(t){var r=this.findResidueAuth(t);return r<0?-1:typeof t.label_alt_id>"u"?b4(this.residueOffsets[r],this.residueOffsets[r+1],this.map.auth_atom_id,t.auth_atom_id):x4(this.residueOffsets[r],this.residueOffsets[r+1],this.map.auth_atom_id,this.map.label_alt_id,t.auth_atom_id,t.label_alt_id)},e.prototype.findAtomOnResidue=function(t,r,n){return typeof n>"u"?b4(this.residueOffsets[t],this.residueOffsets[t+1],this.map.label_atom_id,r):x4(this.residueOffsets[t],this.residueOffsets[t+1],this.map.label_atom_id,this.map.label_alt_id,r,n)},e.prototype.findAtomsOnResidue=function(t,r){return pke(this.residueOffsets[t],this.residueOffsets[t+1],this.map.label_atom_id,r)},e}();function b4(e,t,r,n){for(var i=e;i<t;i++)if(r.value(i)===n)return i;return-1}function pke(e,t,r,n){for(var i=e;i<t;i++)if(n.has(r.value(i)))return i;return-1}function x4(e,t,r,n,i,a){for(var o=e;o<t;o++)if(r.value(o)===i&&n.value(o)===a)return o;return-1}function hke(e,t,r){for(var n=dke(t,e,r),i=e.residues,a=i.label_seq_id,o=i.auth_seq_id,s=i.pdbx_PDB_ins_code,u=e.chains,l=u.label_entity_id,c=u.label_asym_id,d=u.auth_asym_id,f=Ie.ofBounds(0,e.atoms._rowCount),p=nr.transientSegments(r.chainAtomSegments,f);p.hasNext;){var v=p.move(),h=v.index,m=t.getEntityIndex(l.value(h));m<0&&cke(l.value(h)),n.chain_index_entity_index[h]=m;var g=d.value(h),y=n.auth_asym_id_auth_seq_id.get(g);y||(y=new Map,n.auth_asym_id_auth_seq_id.set(g,y));var b=c.value(h);n.label_asym_id.has(b)||n.label_asym_id.set(b,m),lke(n.entity_index_label_asym_id,m,b,h);var S=new Map,x=new Map;n.chain_index_label_seq_id.set(h,S),n.chain_index_auth_seq_id.set(h,x);for(var C=nr.transientSegments(r.residueAtomSegments,f,v);C.hasNext;){var w=C.move(),A=w.index,M=o.value(A),D=s.value(A);S.set(b1(a.value(A),D),A),x.set(b1(M,D),A),y.set(M,h)}}return new fke(n)}var co,fo,Dt={Blue:37052,Green:42577,Yellow:16765952,Orange:16021792,Pink:16162465,Purple:10830745,LightBlue:9424105,Brown:10582605,Red:15539236,Secondary:15854817};co={},co[0]="Hexose",co[1]="HexNAc",co[2]="Hexosamine",co[3]="Hexuronate",co[4]="Deoxyhexose",co[5]="DeoxyhexNAc",co[6]="Di-deoxyhexose",co[7]="Pentose",co[8]="Deoxynonulosonate",co[9]="Di-deoxynonulosonate",co[10]="Unknown",co[11]="Assigned";var vke=(fo={},fo[0]=0,fo[1]=1,fo[2]=2,fo[3]=3,fo[4]=4,fo[5]=5,fo[6]=6,fo[7]=7,fo[8]=8,fo[9]=9,fo[10]=10,fo[11]=11,fo);function mke(e,t){return e===10?t===4?12:t===5?13:t===6?14:t===7?15:10:vke[e]}var YZ={abbr:"Unk",name:"Unknown",color:Dt.Secondary,type:10},z_=[{abbr:"Glc",name:"Glucose",color:Dt.Blue,type:0},{abbr:"Man",name:"Mannose",color:Dt.Green,type:0},{abbr:"Gal",name:"Galactose",color:Dt.Yellow,type:0},{abbr:"Gul",name:"Gulose",color:Dt.Orange,type:0},{abbr:"Alt",name:"Altrose",color:Dt.Pink,type:0},{abbr:"All",name:"Allose",color:Dt.Purple,type:0},{abbr:"Tal",name:"Talose",color:Dt.LightBlue,type:0},{abbr:"Ido",name:"Idose",color:Dt.Brown,type:0},{abbr:"GlcNAc",name:"N-Acetyl Glucosamine",color:Dt.Blue,type:1},{abbr:"ManNAc",name:"N-Acetyl Mannosamine",color:Dt.Green,type:1},{abbr:"GalNAc",name:"N-Acetyl Galactosamine",color:Dt.Yellow,type:1},{abbr:"GulNAc",name:"N-Acetyl Gulosamine",color:Dt.Orange,type:1},{abbr:"AltNAc",name:"N-Acetyl Altrosamine",color:Dt.Pink,type:1},{abbr:"AllNAc",name:"N-Acetyl Allosamine",color:Dt.Purple,type:1},{abbr:"TalNAc",name:"N-Acetyl Talosamine",color:Dt.LightBlue,type:1},{abbr:"IdoNAc",name:"N-Acetyl Idosamine",color:Dt.Brown,type:1},{abbr:"GlcN",name:"Glucosamine",color:Dt.Blue,type:2},{abbr:"ManN",name:"Mannosamine",color:Dt.Green,type:2},{abbr:"GalN",name:"Galactosamine",color:Dt.Yellow,type:2},{abbr:"GulN",name:"Gulosamine",color:Dt.Orange,type:2},{abbr:"AltN",name:"Altrosamine",color:Dt.Pink,type:2},{abbr:"AllN",name:"Allosamine",color:Dt.Purple,type:2},{abbr:"TalN",name:"Talosamine",color:Dt.LightBlue,type:2},{abbr:"IdoN",name:"Idosamine",color:Dt.Brown,type:2},{abbr:"GlcA",name:"Glucuronic Acid",color:Dt.Blue,type:3},{abbr:"ManA",name:"Mannuronic Acid",color:Dt.Green,type:3},{abbr:"GalA",name:"Galacturonic Acid",color:Dt.Yellow,type:3},{abbr:"GulA",name:"Guluronic Acid",color:Dt.Orange,type:3},{abbr:"AltA",name:"Altruronic Acid",color:Dt.Pink,type:3},{abbr:"AllA",name:"Alluronic Acid",color:Dt.Purple,type:3},{abbr:"TalA",name:"Taluronic Acid",color:Dt.LightBlue,type:3},{abbr:"IdoA",name:"Iduronic Acid",color:Dt.Brown,type:3},{abbr:"Qui",name:"Quinovose",color:Dt.Blue,type:4},{abbr:"Rha",name:"Rhamnose",color:Dt.Green,type:4},{abbr:"6dGul",name:"6-Deoxy Gulose",color:Dt.Orange,type:4},{abbr:"6dAlt",name:"6-Deoxy Altrose",color:Dt.Pink,type:4},{abbr:"6dTal",name:"6-Deoxy Talose",color:Dt.LightBlue,type:4},{abbr:"Fuc",name:"Fucose",color:Dt.Red,type:4},{abbr:"QuiNAc",name:"N-Acetyl Quinovosamine",color:Dt.Blue,type:5},{abbr:"RhaNAc",name:"N-Acetyl Rhamnosamine",color:Dt.Green,type:5},{abbr:"6dAltNAc",name:"N-Acetyl 6-Deoxy Altrosamine",color:Dt.Pink,type:5},{abbr:"6dTalNAc",name:"N-Acetyl 6-Deoxy Talosamine",color:Dt.LightBlue,type:5},{abbr:"FucNAc",name:"N-Acetyl Fucosamine",color:Dt.Red,type:5},{abbr:"Oli",name:"Olivose",color:Dt.Blue,type:6},{abbr:"Tyv",name:"Tyvelose",color:Dt.Green,type:6},{abbr:"Abe",name:"Abequose",color:Dt.Orange,type:6},{abbr:"Par",name:"Paratose",color:Dt.Pink,type:6},{abbr:"Dig",name:"Digitoxose",color:Dt.Purple,type:6},{abbr:"Col",name:"Colitose",color:Dt.LightBlue,type:6},{abbr:"Ara",name:"Arabinose",color:Dt.Green,type:7},{abbr:"Lyx",name:"Lyxose",color:Dt.Yellow,type:7},{abbr:"Xyl",name:"Xylose",color:Dt.Orange,type:7},{abbr:"Rib",name:"Ribose",color:Dt.Pink,type:7},{abbr:"Kdn",name:"Keto-Deoxy Nonulonic Acid",color:Dt.Green,type:8},{abbr:"Neu5Ac",name:"N-Acetyl Neuraminic Acid",color:Dt.Purple,type:8},{abbr:"Neu5Gc",name:"N-Glycolyl Neuraminic Acid",color:Dt.LightBlue,type:8},{abbr:"Neu",name:"Neuraminic Acid",color:Dt.Brown,type:8},{abbr:"Sia",name:"Sialic acid",color:Dt.Red,type:8},{abbr:"Pse",name:"Pseudaminic Acid",color:Dt.Green,type:9},{abbr:"Leg",name:"Legionaminic Acid",color:Dt.Yellow,type:9},{abbr:"Aci",name:"Acinetaminic Acid",color:Dt.Pink,type:9},{abbr:"4eLeg",name:"4-Epilegionaminic Acid",color:Dt.LightBlue,type:9},{abbr:"Bac",name:"Bacillosamine",color:Dt.Blue,type:10},{abbr:"LDmanHep",name:"L-Glycero-D-Manno Heptose",color:Dt.Green,type:10},{abbr:"Kdo",name:"Keto-Deoxy Octulonic Acid",color:Dt.Yellow,type:10},{abbr:"Dha",name:"3-Deoxy Lyxo-Heptulosaric Acid",color:Dt.Orange,type:10},{abbr:"DDmanHep",name:"D-Glycero-D-Manno-Heptose",color:Dt.Pink,type:10},{abbr:"MurNAc",name:"N-Acetyl Muramic Acid",color:Dt.Purple,type:10},{abbr:"MurNGc",name:"N-Glycolyl Muramic Acid",color:Dt.LightBlue,type:10},{abbr:"Mur",name:"Muramic Acid",color:Dt.Brown,type:10},{abbr:"Api",name:"Apicose",color:Dt.Green,type:11},{abbr:"Fru",name:"Fructose",color:Dt.Green,type:11},{abbr:"Tag",name:"Tagatose",color:Dt.Yellow,type:11},{abbr:"Sor",name:"Sorbose",color:Dt.Orange,type:11},{abbr:"Psi",name:"Psicose",color:Dt.Pink,type:11}],gke=function(){for(var e=new Map,t=0,r=z_.length;t<r;++t){var n=z_[t];e.set(n.abbr,n)}return e}(),yke=[["Glc-family",Dt.Blue],["Man-family",Dt.Green],["Gal-family",Dt.Yellow],["Gul-family",Dt.Orange],["Alt-family",Dt.Pink],["All-family",Dt.Purple],["Tal-family",Dt.LightBlue],["Ido-family",Dt.Brown],["Fuc-family",Dt.Red],["Generic/Unknown/Secondary",Dt.Secondary]],bke={Glc:["GLC","BGC","Z8T","TRE","MLR"],Man:["MAN","BMA"],Gal:["GLA","GAL","GZL","GXL","GIV"],Gul:["4GL","GL0","GUP","Z8H"],Alt:["Z6H","3MK","SHD"],All:["AFD","ALL","WOO","Z2D"],Tal:["ZEE","A5C","SDY"],Ido:["ZCD","Z0F","4N2"],GlcNAc:["NDG","NAG","NGZ"],ManNAc:["BM3","BM7"],GalNAc:["A2G","NGA","YYQ"],GulNAc:["LXB"],AltNAc:[],AllNAc:["NAA"],TalNAc:[],IdoNAc:["LXZ","HSQ"],GlcN:["PA1","GCS"],ManN:["95Z"],GalN:["X6X","1GN"],GulN:[],AltN:[],AllN:[],TalN:[],IdoN:[],GlcA:["GCU","BDP"],ManA:["MAV","BEM"],GalA:["ADA","GTR","GTK"],GulA:["LGU"],AltA:[],AllA:[],TalA:["X1X","X0X"],IdoA:["IDR"],Qui:["G6D","YYK"],Rha:["RAM","RM4","XXR"],"6dGul":["66O"],"6dAlt":[],"6dTal":[],Fuc:["FUC","FUL","FCA","FCB","GYE"],QuiNAc:["Z9W"],RhaNAc:[],"6dAltNAc":[],"6dTalNAc":[],FucNAc:["49T"],Oli:["DDA","RAE","Z5J"],Tyv:["TYV"],Abe:["ABE"],Par:["PZU"],Dig:["Z3U"],Col:[],Ara:["64K","ARA","ARB","AHR","FUB","BXY","BXX","SEJ"],Lyx:["LDY","Z4W"],Xyl:["XYS","XYP","XYZ","HSY","LXC"],Rib:["YYM","RIP","RIB","BDR","0MK","Z6J","32O"],Kdn:["KDM","KDN"],Neu5Ac:["SIA","SLB"],Neu5Gc:["NGC","NGE"],Neu:[],Sia:[],Pse:[],Leg:[],Aci:[],"4eLeg":[],Bac:[],LDmanHep:["GMH"],Kdo:["KDO"],Dha:[],DDmanHep:["289"],MurNAc:["MUB","AMU"],MurNGc:[],Mur:["1S4","MUR"],Api:["XXM"],Fru:["BDF","Z9N","FRU","LFR"],Tag:["T6T"],Sor:["SOE","UEA"],Psi:["PSV","SF6","SF9","TTV"]},yU=["NGZ","LAT","PUF","GDA","9WJ"],Bh=function(){for(var e=new Map,t=0,r=z_.length;t<r;++t){var n=z_[t],i=bke[n.abbr];if(i)for(var a=0,o=i.length;a<o;++a)e.set(i[a],n)}for(var t=0,r=yU.length;t<r;++t)e.set(yU[t],YZ);return e}(),hi;(function(e){function t(p){return ZO(p.values())}e.toArray=t;function r(p,v){var h=!0;return v.forEach(function(m){p.has(m)||(h=!1)}),h}e.isSuperset=r;function n(p){for(var v=[],h=1;h<arguments.length;h++)v[h-1]=arguments[h];for(var m=0;m<v.length;m++)v[m].forEach(function(g){return p.add(g)});return p}e.add=n;function i(p,v){var h=new Set(p);return v.forEach(function(m){return h.add(m)}),h}e.union=i;function a(){for(var p=[],v=0;v<arguments.length;v++)p[v]=arguments[v];if(p.length===0)return new Set;p.length===1&&new Set(p[0]);for(var h=new Set(p[0]),m=1,g=p.length;m<g;m++)p[m].forEach(function(y){return h.add(y)});return h}e.unionMany=a;function o(p){if(p.length===0)return new Set;for(var v=new Set(p[0]),h=1;h<p.length;h++)for(var m=0,g=p[h];m<g.length;m++){var y=g[m];v.add(y)}return v}e.unionManyArrays=o;function s(p,v){var h=new Set;return v.forEach(function(m){p.has(m)&&h.add(m)}),h}e.intersection=s;function u(p,v){var h=!1;return v.forEach(function(m){p.has(m)&&(h=!0)}),h}e.areIntersecting=u;function l(p,v){var h=0;return v.forEach(function(m){p.has(m)&&(h+=1)}),h}e.intersectionSize=l;function c(p,v){var h=new Set(p);return v.forEach(function(m){return h.delete(m)}),h}e.difference=c;function d(p,v){var h=p.size;return p.forEach(function(m){v.has(m)&&(h-=1)}),h}e.differenceSize=d;function f(p,v){if(p.size!==v.size)return!1;var h=!0;return v.forEach(function(m){p.has(m)||(h=!1)}),h}e.areEqual=f})(hi||(hi={}));var KZ=new Set(["DAPC","DBPC","DFPC","DGPC","DIPC","DLPC","DNPC","DOPC","DPPC","DRPC","DTPC","DVPC","DXPC","DYPC","LPPC","PAPC","PEPC","PGPC","PIPC","POPC","PRPC","PUPC","DAPE","DBPE","DFPE","DGPE","DIPE","DLPE","DNPE","DOPE","DPPE","DRPE","DTPE","DUPE","DVPE","DXPE","DYPE","LPPE","PAPE","PGPE","PIPE","POPE","PQPE","PRPE","PUPE","DAPS","DBPS","DFPS","DGPS","DIPS","DLPS","DNPS","DOPS","DPPS","DRPS","DTPS","DUPS","DVPS","DXPS","DYPS","LPPS","PAPS","PGPS","PIPS","POPS","PQPS","PRPS","PUPS","DAPG","DBPG","DFPG","DGPG","DIPG","DLPG","DNPG","DOPG","DPPG","DRPG","DTPG","DVPG","DXPG","DYPG","LPPG","PAPG","PGPG","PIPG","POPG","PRPG","DAPA","DBPA","DFPA","DGPA","DIPA","DLPA","DNPA","DOPA","DPPA","DRPA","DTPA","DVPA","DXPA","DYPA","LPPA","PAPA","PGPA","PIPA","POPA","PRPA","PUPA","DPP","DPPI","PAPI","PIPI","POP","POPI","PUPI","PVP","PVPI","PADG","PIDG","PODG","PUDG","PVDG","APC","CPC","IPC","LPC","OPC","PPC","TPC","UPC","VPC","BNSM","DBSM","DPSM","DXSM","PGSM","PNSM","POSM","PVSM","XNSM","DPCE","DXCE","PNCE","XNCE","DMPC"]),QZ=new Set(["118","119","543","1AL","1CU","2FK","2HP","2OF","3CO","3MT","3NI","3OF","3P8","4MO","4PU","4TI","6MO","ACT","AG","AL","ALF","AM","ATH","AU","AU3","AUC","AZI","BA","BCT","BEF","BF4","BO4","BR","BS3","BSY","CA","CAC","CD","CD1","CD3","CD5","CE","CF","CHT","CL","CO","CO3","CO5","CON","CR","CS","CSB","CU","CU1","CU3","CUA","CUZ","CYN","DME","DMI","DSC","DTI","DY","E4N","EDR","EMC","ER3","EU","EU3","F","FE","FE2","FPO","GA","GD3","GEP","HAI","HG","HGC","IN","IOD","IR","IR3","IRI","IUM","K","KO4","LA","LCO","LCP","LI","LU","MAC","MG","MH2","MH3","MLI","MMC","MN","MN3","MN5","MN6","MO1","MO2","MO3","MO4","MO5","MO6","MOO","MOS","MOW","MW1","MW2","MW3","NA","NA2","NA5","NA6","NAO","NAW","NET","NH4","NI","NI1","NI2","NI3","NO2","NO3","NRU","O4M","OAA","OC1","OC2","OC3","OC4","OC5","OC6","OC7","OC8","OCL","OCM","OCN","OCO","OF1","OF2","OF3","OH","OS","OS4","OXL","PB","PBM","PD","PDV","PER","PI","PO3","PO4","PR","PT","PT4","PTN","RB","RH3","RHD","RU","SB","SCN","SE4","SEK","SM","SMO","SO3","SO4","SR","T1A","TB","TBA","TCN","TEA","TH","THE","TL","TMA","TRA","UNX","V","VN3","VO4","W","WO5","Y1","YB","YB2","YH","YT3","ZCM","ZN","ZN2","ZN3","ZNO","ZO3","ZR","NCO","OHX"]),Zl,xke=function(){for(var e=Object.create(null),t=[],r="A".charCodeAt(0);r<="Z".charCodeAt(0);r++)t[t.length]=String.fromCharCode(r);for(var r="a".charCodeAt(0);r<="z".charCodeAt(0);r++)t[t.length]=String.fromCharCode(r);for(var r="0".charCodeAt(0);r<="9".charCodeAt(0);r++)t[t.length]=String.fromCharCode(r);for(var n=0,i=t;n<i.length;n++){var a=i[n];e[a]=a.toUpperCase();for(var o=0,s=t;o<s.length;o++){var u=s[o];e[a+u]=(a+u).toUpperCase();for(var l=0,c=t;l<c.length;l++){var d=c[l];e[a+u+d]=(a+u+d).toUpperCase()}}}return e}();function x0(e){return xke[e]||e.toUpperCase()}var bU=new Map([[1,"H"],[2,"He"],[3,"Li"],[4,"Be"],[5,"B"],[6,"C"],[7,"N"],[8,"O"],[9,"F"],[10,"Ne"],[11,"Na"],[12,"Mg"],[13,"Al"],[14,"Si"],[15,"P"],[16,"S"],[17,"Cl"],[18,"Ar"],[19,"K"],[20,"Ca"],[21,"Sc"],[22,"Ti"],[23,"V"],[24,"Cr"],[25,"Mn"],[26,"Fe"],[27,"Co"],[28,"Ni"],[29,"Cu"],[30,"Zn"],[31,"Ga"],[32,"Ge"],[33,"As"],[34,"Se"],[35,"Br"],[36,"Kr"],[37,"Rb"],[38,"Sr"],[39,"Y"],[40,"Zr"],[41,"Nb"],[42,"Mo"],[43,"Tc"],[44,"Ru"],[45,"Rh"],[46,"Pd"],[47,"Ag"],[48,"Cd"],[49,"In"],[50,"Sn"],[51,"Sb"],[52,"Te"],[53,"I"],[54,"Xe"],[55,"Cs"],[56,"Ba"],[57,"La"],[58,"Ce"],[59,"Pr"],[60,"Nd"],[61,"Pm"],[62,"Sm"],[63,"Eu"],[64,"Gd"],[65,"Tb"],[66,"Dy"],[67,"Ho"],[68,"Er"],[69,"Tm"],[70,"Yb"],[71,"Lu"],[72,"Hf"],[73,"Ta"],[74,"W"],[75,"Re"],[76,"Os"],[77,"Ir"],[78,"Pt"],[79,"Au"],[80,"Hg"],[81,"Tl"],[82,"Pb"],[83,"Bi"],[84,"Po"],[85,"At"],[86,"Rn"],[87,"Fr"],[88,"Ra"],[89,"Ac"],[90,"Th"],[91,"Pa"],[92,"U"],[93,"Np"],[94,"Pu"],[95,"Am"],[96,"Cm"],[97,"Bk"],[98,"Cf"],[99,"Es"],[100,"Fm"],[101,"Md"],[102,"No"],[103,"Lr"],[104,"Rf"],[105,"Db"],[106,"Sg"],[107,"Bh"],[108,"Hs"],[109,"Mt"],[110,"Ds"],[111,"Rg"],[112,"Cn"],[113,"Uut"],[114,"Fl"],[115,"Uup"],[116,"Lv"],[117,"Uus"],[118,"Uuo"]].map(function(e){return[e[0],x0(e[1])]}));function Ske(e){return bU.has(e)?bU.get(e):x0("H")}var Cke=(Zl={},Zl[0]={trace:new Set,directionFrom:new Set,directionTo:new Set,backboneStart:new Set,backboneEnd:new Set,coarseBackbone:new Set},Zl[1]={trace:new Set(["CA"]),directionFrom:new Set(["C"]),directionTo:new Set(["O","OC1","O1","OX1","OXT","OT1"]),backboneStart:new Set(["N"]),backboneEnd:new Set(["C"]),coarseBackbone:new Set(["CA","BB","CA1"])},Zl[2]={trace:new Set(["CA"]),directionFrom:new Set(["C"]),directionTo:new Set(["O"]),backboneStart:new Set(["N"]),backboneEnd:new Set(["CD"]),coarseBackbone:new Set(["CA"])},Zl[3]={trace:new Set(["CA"]),directionFrom:new Set(["C"]),directionTo:new Set(["O"]),backboneStart:new Set(["N"]),backboneEnd:new Set(["CG"]),coarseBackbone:new Set(["CA"])},Zl[4]={trace:new Set(["O3'","O3*"]),directionFrom:new Set(["C4'","C4*"]),directionTo:new Set(["C3'","C3*"]),backboneStart:new Set(["P"]),backboneEnd:new Set(["O3'","O3*"]),coarseBackbone:new Set(["P"])},Zl[5]={trace:new Set(["O3'","O3*"]),directionFrom:new Set(["C3'","C3*"]),directionTo:new Set(["C1'","C1*"]),backboneStart:new Set(["P"]),backboneEnd:new Set(["O3'","O3*"]),coarseBackbone:new Set(["P"])},Zl[6]={trace:new Set(["N4'","N4*"]),directionFrom:new Set(["N4'","N4*"]),directionTo:new Set(["C7'","C7*"]),backboneStart:new Set(["N1'","N1*"]),backboneEnd:new Set(["C'","C*"]),coarseBackbone:new Set(["P"])},Zl),ed=new Set(["CA","C","N","O","O1","O2","OC1","OC2","OT1","OT2","OX1","OXT","H","H1","H2","H3","HA","HN","HXT","BB"]),bE=new Set(["P","OP1","OP2","HOP2","HOP3","O2'","O3'","O4'","O5'","C1'","C2'","C3'","C4'","C5'","H1'","H2'","H2''","HO2'","H3'","H4'","H5'","H5''","HO3'","HO5'","O2*","O3*","O4*","O5*","C1*","C2*","C3*","C4*","C5*"]),ZZ=new Set(["D-PEPTIDE LINKING","D-PEPTIDE NH3 AMINO TERMINUS","D-PEPTIDE COOH CARBOXY TERMINUS","D-GAMMA-PEPTIDE, C-DELTA LINKING","D-BETA-PEPTIDE, C-GAMMA LINKING"]),JZ=new Set(["L-PEPTIDE LINKING","L-PEPTIDE NH3 AMINO TERMINUS","L-PEPTIDE COOH CARBOXY TERMINUS","L-GAMMA-PEPTIDE, C-DELTA LINKING","L-BETA-PEPTIDE, C-GAMMA LINKING"]),_ke=new Set(["D-GAMMA-PEPTIDE, C-DELTA LINKING","L-GAMMA-PEPTIDE, C-DELTA LINKING"]),wke=new Set(["D-BETA-PEPTIDE, C-GAMMA LINKING","L-BETA-PEPTIDE, C-GAMMA LINKING"]),Eke=new Set(["D-PEPTIDE NH3 AMINO TERMINUS","D-PEPTIDE COOH CARBOXY TERMINUS","L-PEPTIDE NH3 AMINO TERMINUS","L-PEPTIDE COOH CARBOXY TERMINUS"]),eJ=new Set(["PEPTIDE LINKING","PEPTIDE-LIKE"]),Ake=hi.unionMany(ZZ,JZ,eJ),tJ=new Set(["DNA LINKING","L-DNA LINKING","DNA OH 5 PRIME TERMINUS","DNA OH 3 PRIME TERMINUS"]),rJ=new Set(["RNA LINKING","L-RNA LINKING","RNA OH 5 PRIME TERMINUS","RNA OH 3 PRIME TERMINUS"]),nJ=new Set(["D-SACCHARIDE, BETA LINKING","L-SACCHARIDE, BETA LINKING","D-SACCHARIDE, ALPHA LINKING","L-SACCHARIDE, ALPHA LINKING","L-SACCHARIDE","D-SACCHARIDE","SACCHARIDE","D-SACCHARIDE 1,4 AND 1,4 LINKING","L-SACCHARIDE 1,4 AND 1,4 LINKING","D-SACCHARIDE 1,4 AND 1,6 LINKING","L-SACCHARIDE 1,4 AND 1,6 LINKING"]),Pke=new Set(["NON-POLYMER","OTHER"]),Tke=new Set(["ION"]),Ike=new Set(["LIPID"]),xE=new Set(["SOL","WAT","HOH","H2O","W","DOD","D3O","TIP","TIP3","TIP4","SPC"]),wL=new Set(["HIS","ARG","LYS","ILE","PHE","LEU","TRP","ALA","MET","PRO","CYS","ASN","VAL","GLY","SER","GLN","TYR","ASP","GLU","THR","SEC","PYL","UNK","MSE","SEP","TPO","PTR","PCA","HSD","HSE","HSP","LSN","ASPP","GLUP","HID","HIE","HIP","LYN","ASH","GLH"]),iJ=new Set(["DAL","DAR","DSG","DAS","DCY","DGL","DGN","DHI","DIL","DLE","DLY","MED","DPN","DPR","DSN","DTH","DTR","DTY","DVA","DNE"]),SE=hi.unionMany(wL,iJ),CE=new Set(["A","C","T","G","I","U","N"]),_E=new Set(["DA","DC","DT","DG","DI","DU","DN"]),EL=new Set(["APN","CPN","TPN","GPN"]),Mke=new Set(["A","G","I","DA","DG","DI","APN","GPN"]),Dke=new Set(["C","T","U","DC","DT","DU","CPN","TPN"]),wE=hi.unionMany(CE,_E,EL),aJ=function(e){return Mke.has(e.toUpperCase())},oJ=function(e){return Dke.has(e.toUpperCase())},o2=hi.unionMany(SE,wE);function S0(e,t){return e=e.toUpperCase(),t=t.toUpperCase(),EL.has(t)?8:Ake.has(e)?5:rJ.has(e)?6:tJ.has(e)?7:nJ.has(e)?9:xE.has(t)?2:QZ.has(t)?3:KZ.has(t)?4:Pke.has(e)?Bh.has(t)?9:1:0}function Rke(e,t){return e=e.toUpperCase(),t===5?_ke.has(e)?2:wke.has(e)?3:Eke.has(e)?0:1:t===6?4:t===7?5:t===8?6:0}function sJ(e){return e=e.toUpperCase(),SE.has(e)?"peptide linking":CE.has(e)?"RNA linking":_E.has(e)?"DNA linking":Bh.has(e)?"saccharide":"other"}function kke(e){return{formula:"",formula_weight:0,id:e,name:e,mon_nstd_flag:o2.has(e)?"y":"n",pdbx_synonyms:[],type:sJ(e)}}function Oke(e){return e=e.toUpperCase(),xE.has(e)?"water":o2.has(e)?"polymer":Bh.has(e)?"branched":"non-polymer"}function Lke(e,t){return e=e.toUpperCase(),t=t.toUpperCase(),JZ.has(t)?"polypeptide(L)":ZZ.has(t)?"polypeptide(D)":rJ.has(t)?"polyribonucleotide":tJ.has(t)?"polydeoxyribonucleotide":nJ.has(t)||Bh.has(e)?"oligosaccharide":EL.has(e)?"peptide nucleic acid":wL.has(e)?"polypeptide(L)":iJ.has(e)?"polypeptide(D)":CE.has(e)?"polyribonucleotide":_E.has(e)?"polydeoxyribonucleotide":Tke.has(t)||QZ.has(e)?"ion":Ike.has(t)||KZ.has(e)?"lipid":eJ.has(t)?"peptide-like":"other"}function AL(e){return Gl(e)||uJ(e)}function Gl(e){return e===7||e===6||e===8}function uJ(e){return e===5}var Br;(function(e){e.is=ba.has,e.create=ba.create,e.SecondaryStructureMmcif={HELX_LH_27_P:1058,HELX_LH_3T_P:2082,HELX_LH_AL_P:4130,HELX_LH_A_N:524321,HELX_LH_B_N:1048609,HELX_LH_GA_P:8226,HELX_LH_N:33,HELX_LH_OM_P:16418,HELX_LH_OT_N:131105,HELX_LH_OT_P:546,HELX_LH_P:34,HELX_LH_PI_P:32802,HELX_LH_PP_P:65570,HELX_LH_Z_N:262177,HELX_N:1,HELX_OT_N:1,HELX_OT_P:2,HELX_P:2,HELX_RH_27_P:1090,HELX_RH_3T_P:2114,HELX_RH_AL_P:4162,HELX_RH_A_N:524353,HELX_RH_B_N:1048641,HELX_RH_GA_P:8258,HELX_RH_N:65,HELX_RH_OM_P:16450,HELX_RH_OT_N:131137,HELX_RH_OT_P:578,HELX_RH_P:66,HELX_RH_PI_P:32834,HELX_RH_PP_P:65602,HELX_RH_Z_N:262209,STRN:4194308,TURN_OT_P:33554448,TURN_P:16,TURN_TY1P_P:67109136,TURN_TY1_P:67109008,TURN_TY2P_P:134218e3,TURN_TY2_P:134217872,TURN_TY3P_P:268435728,TURN_TY3_P:268435600},e.SecondaryStructurePdb={1:4162,2:16450,3:32834,4:8258,5:2114,6:4130,7:16418,8:8226,9:1026,10:65538},e.SecondaryStructureStride={H:4098,G:2050,I:32770,E:8388612,B:4194308,T:16,C:536870912},e.SecondaryStructureDssp={H:4098,B:4194308,E:8388612,G:2050,I:32770,T:16,S:8}})(Br||(Br={}));var Ur;(function(e){e.is=ba.has;function t(s){return ba.create(s)}e.create=t;function r(s){return(s&1)!==0}e.isCovalent=r;function n(s){return s===Math.pow(2,6)-1}e.isAll=n,e.Names={covalent:1,"metal-coordination":2,"hydrogen-bond":4,disulfide:8,aromatic:16,computed:32};function i(s){return s in e.Names}e.isName=i;function a(s){switch(s){case"covalent":return 1;case"metal-coordination":return 2;case"hydrogen-bond":return 4;case"disulfide":return 8;case"aromatic":return 16;case"computed":return 32}}e.fromName=a;function o(s){for(var u=0,l=0,c=s.length;l<c;++l)u|=a(s[l]);return u}e.fromNames=o})(Ur||(Ur={}));var eD={ALA:[.17,.5,.33],ARG:[.81,1.81,1],ASN:[.42,.85,.43],ASP:[1.23,3.64,2.41],ASH:[-.07,.43,.5],CYS:[-.24,-.02,.22],GLN:[.58,.77,.19],GLU:[2.02,3.63,1.61],GLH:[-.01,.11,.12],GLY:[.01,1.15,1.14],HIS:[.17,.11,-.06],ILE:[-.31,-1.12,-.81],LEU:[-.56,-1.25,-.69],LYS:[.99,2.8,1.81],MET:[-.23,-.67,-.44],PHE:[-1.13,-1.71,-.58],PRO:[.45,.14,-.31],SER:[.13,.46,.33],THR:[.14,.25,.11],TRP:[-1.85,-2.09,-.24],TYR:[-.94,-.71,.23],VAL:[.07,-.46,-.53],HSD:[.17,.11,-.06],HSE:[.17,.11,-.06],HSP:[.96,2.33,1.37],HID:[.17,.11,-.06],HIE:[.17,.11,-.06],HIP:[.96,2.33,1.37]};function Fke(e,t){var r=e.coarseElements.entityKey[t],n=e.model.sequence.byEntityKey[r].sequence,i=e.coarseElements.seq_id_begin.value(t);return n.compId.value(i-1)}function PL(e,t){switch(e.kind){case 0:return e.model.atomicHierarchy.derived.residue.moleculeType[e.residueIndex[t]];case 1:case 2:var r=Fke(e,t),n=e.model.properties.chemicalComponentMap.get(r);if(n)return S0(n.type,r)}return 0}var Nke=new Set;function Of(e,t){var r=Cke[e];if(r!==void 0){var n=r[t];if(n!==void 0)return n}return Nke}var xU=_.zero();function lJ(e,t){for(var r=e.conformation.position,n=new Float32Array(t.length*3),i=e.elements,a=0,o=t.length;a<o;++a)r(i[t[a]],xU),_.toArray(xU,n,a*3);return n}function Bke(e,t,r,n){for(var i=e.atoms,a=i.label_comp_id,o=i.type_symbol,s=i._rowCount,u=e.residues._rowCount,l=t.residueAtomSegments.offsets,c=new Uint8Array(s),d=0;d<s;++d)c[d]=a2(o.value(d));for(var f=new Int32Array(u),p=new Int32Array(u),v=new Int32Array(u),h=new Uint8Array(u),m=new Uint8Array(u),g=new Map,y=new Map,d=0;d<u;++d){var b=a.value(l[d]),S=n,x=void 0,C=void 0;if(g.has(b))x=g.get(b),C=y.get(b);else{var w=void 0;S.has(b)?w=S.get(b).type:(y0||console.info("chemComp not found",b),w=sJ(b)),x=S0(w,b),C=Rke(w,x),g.set(b,x),y.set(b,C)}h[d]=x,m[d]=C;var A=Of(C,"trace"),M=r.findAtomsOnResidue(d,A);if(M===-1){var D=Of(C,"coarseBackbone");M=r.findAtomsOnResidue(d,D)}f[d]=M;var k=Of(C,"directionFrom");p[d]=r.findAtomsOnResidue(d,k);var R=Of(C,"directionTo");v[d]=r.findAtomsOnResidue(d,R)}return{atom:{atomicNumber:c},residue:{traceElementIndex:f,directionFromElementIndex:p,directionToElementIndex:v,moleculeType:h,polymerType:m}}}function yg(e,t,r){for(var n=new Float32Array(e),i=0;i<n.length;i++)n[i]=t+r*i;return n}var bn;(function(e){e.DefaultName="1_555",e.Default=t(e.DefaultName,ue.identity()),e.RotationTranslationEpsilon=.005;function t(v,h,m){var g=m||{},y=g.assembly,b=g.ncsId,S=g.hkl,x=g.spgrOp,C=S?_.clone(S):_();x=Di(x,-1),b=b||-1;var w=r(m);if(ue.isIdentity(h))return{name:v,assembly:y,matrix:h,inverse:ue.identity(),isIdentity:!0,hkl:C,spgrOp:x,ncsId:b,suffix:w};if(!ue.isRotationAndTranslation(h,e.RotationTranslationEpsilon))throw new Error("Symmetry operator ("+v+") must be a composition of rotation and translation.");return{name:v,assembly:y,matrix:h,inverse:ue.invert(ue(),h),isIdentity:!1,hkl:C,spgrOp:x,ncsId:b,suffix:w}}e.create=t;function r(v){if(!v)return"";if(v.assembly)return"_"+v.assembly.operId;if(typeof v.spgrOp<"u"&&typeof v.hkl<"u"&&v.spgrOp!==-1){var h=v.hkl,m=h[0],g=h[1],y=h[2];return"-"+(v.spgrOp+1)+"_"+(5+m)+(5+g)+(5+y)}return v.ncsId!==-1?"_"+v.ncsId:""}function n(v,h){for(var m=ue.identity(),g=0;g<3;g++)for(var y=0;y<3;y++)ue.setValue(m,g,y,$n.getValue(v,g,y));return ue.setTranslation(m,h),ue.isRotationAndTranslation(m,e.RotationTranslationEpsilon)}e.checkIfRotationAndTranslation=n;function i(v,h,m,g){for(var y=ue.identity(),b=0;b<3;b++)for(var S=0;S<3;S++)ue.setValue(y,b,S,$n.getValue(h,b,S));return ue.setTranslation(y,m),t(v,y,{ncsId:g})}e.ofRotationAndOffset=i;var a=qn.identity(),o=qn(),s=qn(),u=_();function l(v,h,m){var g=h.inverse;if(h.isIdentity)return ue.copy(v,g);var y=1-m;ue.getRotation(o,g),qn.slerp(o,a,o,y);var b=qn.getAxisAngle(u,o);return ue.fromRotation(v,b,u),ue.setValue(v,0,3,y*ue.getValue(g,0,3)),ue.setValue(v,1,3,y*ue.getValue(g,1,3)),ue.setValue(v,2,3,y*ue.getValue(g,2,3)),v}e.lerpFromIdentity=l;function c(v,h,m,g){if(Math.abs(g)<=1e-5)return ue.copy(v,h);if(Math.abs(g-1)<=1e-5)return ue.copy(v,m);ue.getRotation(o,h),ue.getRotation(s,m),qn.slerp(s,o,s,g);var y=qn.getAxisAngle(u,s);return ue.fromRotation(v,y,u),ue.setValue(v,0,3,Xo(ue.getValue(h,0,3),ue.getValue(m,0,3),g)),ue.setValue(v,1,3,Xo(ue.getValue(h,1,3),ue.getValue(m,1,3),g)),ue.setValue(v,2,3,Xo(ue.getValue(h,2,3),ue.getValue(m,2,3),g)),v}e.slerp=c;function d(v,h){var m=ue.mul(ue(),h.matrix,v.matrix);return t(h.name,m,h)}e.compose=d;function f(v,h,m){var g=e.createCoordinateMapper(e.Default,h),y=v.isIdentity?g:e.createCoordinateMapper(v,h),b=jke(v,h),S=b.x,x=b.y,C=b.z;return{operator:v,coordinates:h,invariantPosition:g,position:y,x:S,y:x,z:C,r:m||Uke}}e.createMapping=f;function p(v,h){return v.isIdentity?Gke(h):qke(v,h)}e.createCoordinateMapper=p})(bn||(bn={}));function Uke(e){return 0}function jke(e,t){return e.isIdentity?{x:S4(t.x),y:S4(t.y),z:S4(t.z)}:{x:zke(e,t),y:Vke(e,t),z:Hke(e,t)}}function S4(e){return function(r){return e[r]}}function EE(e){return e[3]===0&&e[7]===0&&e[11]===0&&e[15]===1}function zke(e,t){var r=e.matrix,n=t.x,i=t.y,a=t.z,o=r[0],s=r[4],u=r[8],l=r[12];return EE(r)?function(d){return o*n[d]+s*i[d]+u*a[d]+l}:function(d){var f=n[d],p=i[d],v=a[d],h=r[3]*f+r[7]*p+r[11]*v+r[15]||1;return(o*f+s*p+u*v+l)/h}}function Vke(e,t){var r=e.matrix,n=t.x,i=t.y,a=t.z,o=r[1],s=r[5],u=r[9],l=r[13];return EE(r)?function(d){return o*n[d]+s*i[d]+u*a[d]+l}:function(d){var f=n[d],p=i[d],v=a[d],h=r[3]*f+r[7]*p+r[11]*v+r[15]||1;return(o*f+s*p+u*v+l)/h}}function Hke(e,t){var r=e.matrix,n=t.x,i=t.y,a=t.z,o=r[2],s=r[6],u=r[10],l=r[14];return EE(r)?function(d){return o*n[d]+s*i[d]+u*a[d]+l}:function(d){var f=n[d],p=i[d],v=a[d],h=r[3]*f+r[7]*p+r[11]*v+r[15]||1;return(o*f+s*p+u*v+l)/h}}function Gke(e){var t=e.x,r=e.y,n=e.z;return function(a,o){return o[0]=t[a],o[1]=r[a],o[2]=n[a],o}}function qke(e,t){var r=e.matrix,n=t.x,i=t.y,a=t.z;return EE(r)?function(s,u){var l=n[s],c=i[s],d=a[s];return u[0]=r[0]*l+r[4]*c+r[8]*d+r[12],u[1]=r[1]*l+r[5]*c+r[9]*d+r[13],u[2]=r[2]*l+r[6]*c+r[10]*d+r[14],u}:function(s,u){return u[0]=n[s],u[1]=i[s],u[2]=a[s],_.transformMat4(u,u,r),u}}var C4=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[-1,0,0,0],[0,-1,0,0],[0,0,-1,0],[0,1,0,.5],[1,0,0,.5],[-1,0,0,.5],[0,0,1,.5],[0,-1,0,.5],[0,0,-1,.5],[1,0,0,.25],[0,-1,0,.25],[0,0,1,.25],[-1,0,0,.25],[0,1,0,.25],[0,-1,0,.75],[0,0,1,.75],[0,1,0,.75],[1,0,0,.75],[-1,0,0,.75],[0,0,-1,.25],[0,0,-1,.75],[1,-1,0,0],[-1,1,0,0],[0,0,1,1/3],[0,0,1,2/3],[1,0,0,2/3],[0,1,0,1/3],[0,-1,0,2/3],[1,-1,0,1/3],[-1,1,0,2/3],[-1,0,0,1/3],[1,0,0,1/3],[0,1,0,2/3],[0,-1,0,1/3],[1,-1,0,2/3],[-1,1,0,1/3],[-1,0,0,2/3],[0,0,-1,1/3],[0,0,-1,2/3],[0,0,1,5/6],[0,0,1,1/6],[0,0,-1,5/6],[0,0,-1,1/6]],$ke=[[0,1,2],[3,4,5],[3,1,5],[3,6,5],[7,6,2],[8,6,5],[0,4,2],[0,4,9],[7,10,2],[7,10,9],[0,10,2],[8,10,5],[3,1,11],[3,6,11],[0,10,9],[8,6,11],[3,4,2],[0,4,5],[3,4,9],[7,10,5],[8,4,9],[8,10,9],[8,10,2],[0,6,9],[3,10,9],[0,10,11],[7,1,9],[8,1,11],[7,4,11],[7,6,9],[7,10,11],[3,10,2],[8,1,5],[0,4,11],[3,1,2],[3,1,9],[7,4,2],[8,1,2],[8,1,9],[3,6,9],[7,4,9],[8,6,2],[8,6,9],[3,6,2],[12,13,14],[15,16,14],[12,17,18],[15,19,18],[20,13,18],[21,16,18],[20,17,14],[21,19,14],[0,1,5],[8,10,11],[7,6,11],[7,6,5],[8,4,2],[7,4,5],[7,1,5],[7,1,11],[0,10,5],[0,1,11],[0,6,11],[0,6,5],[3,10,11],[8,4,11],[15,13,22],[12,16,22],[15,17,23],[12,19,23],[21,13,23],[20,16,23],[21,17,22],[20,19,22],[4,0,2],[1,3,2],[4,0,14],[1,3,18],[4,0,9],[1,3,9],[4,0,18],[1,3,14],[10,7,9],[6,8,9],[4,7,14],[6,3,18],[10,0,18],[1,8,14],[1,3,5],[4,0,5],[6,8,11],[10,7,11],[1,3,11],[4,0,11],[10,7,2],[6,8,2],[3,10,22],[7,1,23],[8,4,23],[0,6,22],[1,0,5],[4,3,5],[1,0,23],[4,3,22],[10,7,14],[6,8,18],[8,6,22],[7,10,23],[4,3,11],[1,0,11],[1,0,22],[4,3,23],[10,7,18],[6,8,14],[8,6,23],[7,10,22],[6,7,11],[10,8,11],[8,1,23],[0,10,22],[3,6,22],[7,4,23],[4,3,2],[1,0,2],[10,8,2],[6,7,2],[4,3,9],[1,0,9],[10,8,9],[6,7,9],[4,8,14],[6,0,18],[10,3,18],[1,7,14],[4,8,18],[6,0,14],[10,3,14],[1,7,18],[6,7,5],[10,8,5],[6,8,5],[10,7,5],[8,1,22],[0,10,23],[3,6,23],[7,4,22],[4,24,2],[25,3,2],[4,24,26],[25,3,27],[4,24,27],[25,3,26],[28,29,26],[30,31,26],[32,33,26],[34,35,27],[36,37,27],[38,39,27],[2,0,1],[1,2,0],[1,25,5],[24,0,5],[39,36,40],[35,38,40],[37,34,40],[33,30,41],[29,32,41],[31,28,41],[5,3,4],[4,5,3],[25,1,5],[0,24,5],[24,4,5],[3,25,5],[4,3,41],[25,1,40],[24,4,41],[3,25,40],[4,3,40],[25,1,41],[24,4,40],[3,25,41],[35,34,40],[37,36,40],[39,38,40],[29,28,41],[31,30,41],[33,32,41],[3,5,4],[5,4,3],[25,1,2],[0,24,2],[24,4,2],[3,25,2],[25,1,9],[0,24,9],[24,4,9],[3,25,9],[30,33,26],[32,29,26],[28,31,26],[36,39,27],[38,35,27],[34,37,27],[0,2,1],[2,1,0],[30,33,42],[32,29,42],[28,31,42],[36,39,43],[38,35,43],[34,37,43],[7,9,6],[9,6,7],[25,1,11],[0,24,11],[24,4,11],[3,25,11],[35,34,44],[37,36,44],[39,38,44],[29,28,45],[31,30,45],[33,32,45],[8,11,10],[11,10,8],[1,25,2],[24,0,2],[1,25,42],[24,0,43],[1,25,43],[24,0,42],[1,25,27],[24,0,26],[1,25,26],[24,0,27],[1,25,9],[24,0,9],[4,24,5],[25,3,5],[4,24,11],[25,3,11],[1,0,40],[4,3,44],[0,24,45],[1,0,41],[4,3,45],[0,24,44],[0,24,40],[0,24,41],[2,3,4],[5,3,1],[5,0,4],[4,2,3],[1,5,3],[4,5,0],[2,7,6],[2,8,10],[5,8,6],[5,7,10],[1,9,7],[4,9,8],[1,11,8],[4,11,7],[9,0,6],[9,3,10],[11,3,6],[11,0,10],[6,2,7],[10,2,8],[6,5,8],[10,5,7],[9,7,1],[9,8,4],[11,8,1],[11,7,4],[6,9,0],[10,9,3],[6,11,3],[10,11,0],[9,7,6],[9,8,10],[11,8,6],[11,7,10],[6,9,7],[10,9,8],[6,11,8],[10,11,7],[2,3,10],[5,8,1],[11,0,4],[10,2,3],[1,5,8],[4,11,0],[5,0,1],[2,0,4],[2,3,1],[1,5,0],[4,2,0],[1,2,3],[11,8,10],[11,7,6],[9,7,10],[9,8,6],[10,11,8],[6,11,7],[10,9,7],[6,9,8],[5,8,10],[5,7,6],[2,7,10],[2,8,6],[4,11,8],[1,11,7],[4,9,7],[1,9,8],[11,3,10],[11,0,6],[9,0,10],[9,3,6],[10,5,8],[6,5,7],[10,2,7],[6,2,8],[11,8,4],[11,7,1],[9,7,4],[9,8,1],[10,11,3],[6,11,0],[10,9,0],[6,9,3],[22,15,13],[22,12,16],[14,12,13],[14,15,16],[13,22,15],[16,22,12],[13,14,12],[16,14,15],[22,21,17],[22,20,19],[14,20,17],[14,21,19],[13,23,21],[16,23,20],[13,18,20],[16,18,21],[23,15,17],[23,12,19],[18,12,17],[18,15,19],[17,22,21],[19,22,20],[17,14,20],[19,14,21],[23,21,13],[23,20,16],[18,20,13],[18,21,16],[17,23,15],[19,23,12],[17,18,12],[19,18,15],[5,0,6],[2,7,4],[9,3,1],[6,5,0],[4,2,7],[1,9,3],[0,2,4],[3,2,1],[0,5,1],[2,1,3],[2,4,0],[5,1,0],[7,9,10],[8,9,6],[7,11,6],[9,6,8],[9,10,7],[11,6,7],[1,7,11],[4,8,11],[1,8,9],[4,7,9],[0,9,10],[3,9,6],[3,11,10],[0,11,6],[2,6,8],[2,10,7],[5,6,7],[5,10,8],[6,0,11],[10,3,11],[6,3,9],[10,0,9],[7,2,10],[8,2,6],[8,5,10],[7,5,6],[9,1,8],[9,4,7],[11,1,7],[11,4,8],[7,9,4],[8,9,1],[8,11,4],[7,11,1],[9,6,3],[9,10,0],[11,6,0],[11,10,3],[19,12,23],[13,15,22],[16,21,18],[17,20,14],[20,14,17],[21,18,16],[15,22,13],[12,23,19],[18,16,21],[14,17,20],[23,19,12],[22,13,15],[19,20,22],[13,21,23],[16,15,14],[17,12,18],[20,18,13],[21,14,19],[15,23,17],[12,22,16],[18,19,15],[14,13,12],[23,16,20],[22,17,21],[16,12,22],[17,15,23],[19,21,14],[13,20,18],[12,14,13],[15,18,19],[21,22,17],[20,23,16],[14,16,15],[18,17,12],[22,19,20],[23,13,21],[16,20,23],[17,21,22],[19,15,18],[13,12,14],[12,18,17],[15,14,16],[21,23,13],[20,22,19],[14,19,21],[18,13,20],[22,16,12],[23,17,15],[19,12,22],[17,21,23],[16,15,18],[13,20,14],[20,14,13],[15,18,16],[21,23,17],[12,22,19],[18,16,15],[14,13,20],[22,19,12],[23,17,21],[3,2,4],[3,5,1],[0,5,4],[2,4,3],[5,1,3],[5,4,0],[1,7,9],[4,8,9],[1,8,11],[4,7,11],[0,9,6],[3,9,10],[3,11,6],[0,11,10],[2,6,7],[2,10,8],[5,6,8],[5,10,7],[6,0,9],[10,3,9],[6,3,11],[10,0,11],[7,2,6],[8,2,10],[8,5,6],[7,5,10],[9,1,7],[9,4,8],[11,1,8],[11,4,7],[7,9,1],[8,9,4],[8,11,1],[7,11,4],[9,6,0],[9,10,3],[11,6,3],[11,10,0],[8,9,10],[8,11,6],[7,11,10],[9,10,8],[11,6,8],[11,10,7],[6,0,2],[10,3,2],[6,3,5],[10,0,5],[7,2,1],[8,2,4],[8,5,1],[7,5,4],[9,1,0],[9,4,3],[11,1,3],[11,4,0],[1,7,2],[4,8,2],[1,8,5],[4,7,5],[0,9,1],[3,9,4],[3,11,1],[0,11,4],[2,6,0],[2,10,3],[5,6,3],[5,10,0],[0,2,6],[3,2,10],[3,5,6],[0,5,10],[2,1,7],[2,4,8],[5,1,8],[5,4,7],[16,12,14],[13,21,18],[19,15,23],[17,20,22],[12,14,16],[21,18,13],[15,23,19],[20,22,17],[14,16,12],[18,13,21],[23,19,15],[22,17,20],[19,20,18],[17,15,14],[16,21,22],[13,12,23],[20,18,19],[15,14,17],[21,22,16],[12,23,13],[18,19,20],[14,17,15],[22,16,21],[23,13,12],[6,0,5],[10,3,5],[6,3,2],[10,0,2],[7,2,4],[8,2,1],[8,5,4],[7,5,1],[9,1,3],[9,4,0],[11,1,0],[11,4,3],[1,7,5],[4,8,5],[1,8,2],[4,7,2],[0,9,4],[3,9,1],[3,11,4],[0,11,1],[2,6,3],[2,10,0],[5,6,0],[5,10,3],[0,2,10],[3,2,6],[3,5,10],[0,5,6],[2,1,8],[2,4,7],[5,1,7],[5,4,8],[21,17,23],[20,16,22],[12,13,18],[15,19,14],[23,21,17],[22,20,16],[18,12,13],[14,15,19],[17,23,21],[16,22,20],[13,18,12],[19,14,15],[21,13,22],[20,19,23],[12,17,14],[15,16,18],[23,15,13],[22,12,19],[18,20,17],[14,21,16],[17,22,15],[16,23,12],[13,14,20],[19,18,21],[15,17,22],[12,16,23],[20,13,14],[21,19,18],[22,21,13],[23,20,19],[14,12,17],[18,15,16],[13,23,15],[19,22,12],[17,18,20],[16,14,21],[15,13,23],[12,19,22],[20,17,18],[21,16,14],[22,15,17],[23,12,16],[14,20,13],[18,21,19],[13,22,21],[19,23,20],[17,14,12],[16,18,15],[6,5,3],[4,9,3],[9,3,4],[5,7,4],[4,5,7],[5,3,6]],Wke=[[0],[0,1],[0,2],[0,3],[0,2,4,5],[0,6],[0,7],[0,6,4,8],[0,7,4,9],[0,6,2,1],[0,3,1,10],[0,6,2,1,4,8,5,11],[0,12,1,7],[0,1,13,14],[0,12,1,7,4,15,11,9],[0,16,2,17],[0,18,12,17],[0,16,5,19],[0,20,13,19],[0,18,12,17,4,21,15,19],[0,16,2,17,4,22,5,19],[0,16,2,17,23,24,13,25,26,20,27,28,4,22,5,19],[0,16,17,2,29,21,30,15],[0,20,13,19,29,31,32,33],[0,16,6,34],[0,18,7,34],[0,16,7,35],[0,16,36,37],[0,18,36,38],[0,16,14,39],[0,20,40,34],[0,16,8,41],[0,18,8,42],[0,16,9,42],[0,16,6,34,4,22,8,41],[0,18,7,34,4,21,9,41],[0,16,7,35,4,22,9,42],[0,16,6,34,23,24,14,39],[0,16,10,43,23,24,7,35],[0,16,36,37,23,24,9,42],[0,16,8,41,23,24,40,38],[0,16,6,34,23,24,14,39,26,20,40,38,4,22,8,41],[0,16,44,45,23,24,46,47,26,20,48,49,4,22,50,51],[0,16,6,34,29,21,9,42],[0,16,8,41,29,21,7,35],[0,16,36,37,29,21,14,39],[0,16,2,17,1,52,6,34],[0,16,2,17,53,54,9,42],[0,16,12,33,1,52,7,35],[0,16,2,17,11,55,8,41],[0,56,2,57,1,58,6,37],[0,56,15,25,1,58,9,39],[0,20,27,17,1,59,40,34],[0,56,12,28,1,58,7,38],[0,16,5,19,1,52,8,41],[0,22,13,28,1,55,14,38],[0,18,13,60,1,61,14,43],[0,16,15,30,1,52,9,42],[0,16,5,19,11,55,6,34],[0,21,12,19,1,54,7,41],[0,20,13,19,1,59,14,41],[0,20,3,30,1,59,10,42],[0,18,12,17,1,61,7,34,4,21,15,19,11,54,9,41],[0,24,13,17,1,62,14,34,4,20,27,19,11,59,40,41],[0,16,2,17,1,52,6,34,4,22,5,19,11,55,8,41],[0,16,12,33,1,52,7,35,4,22,15,30,11,55,9,42],[0,31,3,17,1,63,10,34,4,56,32,19,11,58,36,41],[0,22,2,19,64,59,14,38,4,16,5,17,65,62,40,39],[0,16,2,17,1,52,6,34,23,24,13,25,64,62,14,39,26,20,27,28,65,59,40,38,4,22,5,19,11,55,8,41],[0,16,2,17,66,67,44,45,23,24,13,25,68,69,46,47,26,20,27,28,70,71,48,49,4,22,5,19,72,73,50,51],[0,16,2,17,1,52,6,34,29,21,15,30,53,54,9,42],[0,16,5,19,1,52,8,41,29,21,12,33,53,54,7,35],[0,20,13,19,1,59,14,41,29,31,32,33,53,63,36,35],[0,31,3,17,1,63,10,34,29,20,27,30,53,59,40,42],[0,16,74,75],[0,18,76,77],[0,16,78,79],[0,18,80,81],[0,16,74,75,29,21,82,83],[0,21,84,85,29,16,86,87],[0,16,88,89],[0,16,88,89,29,21,90,91],[0,16,74,75,1,52,88,89],[0,16,78,79,1,52,92,93],[0,16,94,95,11,55,88,89],[0,16,82,83,53,54,88,89],[0,16,74,75,1,52,88,89,29,21,82,83,53,54,90,91],[0,21,84,85,96,97,88,91,29,16,86,87,98,99,90,89],[0,16,74,75,2,17,100,101],[0,16,94,95,5,19,100,101],[0,18,76,77,2,33,102,103],[0,18,104,105,106,107,100,108],[0,16,78,79,2,17,109,108],[0,16,82,83,15,30,100,101],[0,18,80,81,2,33,110,111],[0,18,112,113,114,115,100,108],[0,16,74,75,2,17,100,101,29,21,82,83,15,30,116,117],[0,21,84,85,118,119,116,101,29,16,86,87,120,121,100,117],[0,16,74,75,6,34,122,123],[0,16,74,75,8,41,124,125],[0,16,78,79,7,35,122,123],[0,16,82,83,9,42,122,123],[0,16,74,75,7,35,126,127],[0,16,74,75,9,42,128,129],[0,16,78,79,6,34,126,127],[0,16,78,79,8,41,128,129],[0,16,74,75,6,34,122,123,29,21,82,83,9,42,128,129],[0,16,74,75,7,35,126,127,29,21,82,83,8,41,124,125],[0,21,84,85,6,42,130,131,29,16,86,87,9,34,132,133],[0,21,84,85,7,41,134,135,29,16,86,87,8,35,136,137],[0,16,89,88,2,17,122,123],[0,16,89,88,12,33,126,127],[0,16,89,88,5,19,124,125],[0,16,89,88,15,30,128,129],[0,16,88,89,6,34,100,101],[0,16,89,88,7,35,109,108],[0,16,89,88,8,41,138,139],[0,16,89,88,9,42,116,117],[0,16,89,88,6,34,100,101,29,21,91,90,9,42,116,117],[0,16,89,88,7,35,109,108,29,21,91,90,8,41,138,139],[0,16,89,88,2,17,122,123,29,21,91,90,15,30,128,129],[0,16,89,88,118,121,132,131,29,21,91,90,120,119,130,133],[0,16,74,75,2,17,100,101,1,52,88,89,6,34,122,123],[0,16,74,75,12,33,109,108,1,52,88,89,7,35,126,127],[0,16,74,75,2,17,100,101,11,55,140,141,8,41,124,125],[0,16,74,75,2,17,100,101,53,54,90,91,9,42,128,129],[0,16,74,75,5,19,138,139,1,52,88,89,8,41,124,125],[0,16,74,75,15,30,116,117,1,52,88,89,9,42,128,129],[0,16,94,95,5,19,100,101,11,55,88,89,6,34,124,125],[0,16,94,95,15,30,109,108,11,55,88,89,7,35,128,129],[0,16,78,79,2,17,109,108,1,52,92,93,6,34,126,127],[0,16,78,79,12,33,100,101,1,52,92,93,7,35,122,123],[0,16,82,83,12,33,138,139,53,54,88,89,8,41,126,127],[0,16,82,83,2,17,116,117,53,54,88,89,9,42,122,123],[0,16,78,79,5,19,116,117,1,52,92,93,8,41,128,129],[0,16,82,83,15,30,100,101,1,52,90,91,9,42,122,123],[0,16,82,83,15,30,100,101,53,54,88,89,6,34,128,129],[0,16,82,83,5,19,109,108,53,54,88,89,7,35,124,125],[0,16,74,75,2,17,100,101,1,52,88,89,6,34,122,123,29,21,82,83,15,30,116,117,53,54,90,91,9,42,128,129],[0,16,74,75,12,33,109,108,1,52,88,89,7,35,126,127,29,21,82,83,5,19,138,139,53,54,90,91,8,41,124,125],[0,21,84,85,118,119,116,101,96,97,88,91,9,34,132,133,29,16,86,87,120,121,100,117,98,99,90,89,6,42,130,131],[0,21,84,85,142,143,138,108,96,97,88,91,8,35,136,137,29,16,86,87,144,145,109,139,98,99,90,89,7,41,134,135],[0,146,147],[0,148,149],[0,150,151],[0,146,147,152,153,154,155,156,157],[0,158,159],[0,146,147,1,160,161],[0,146,147,1,160,161,152,153,154,162,163,164,155,156,157,165,166,167],[0,158,159,1,168,169],[0,146,147,101,170,171],[0,146,147,100,172,173],[0,148,149,174,175,171],[0,148,149,100,176,177],[0,150,151,178,179,171],[0,150,151,100,180,181],[0,146,147,100,172,173,152,153,154,182,183,184,155,156,157,185,186,187],[0,158,159,101,188,189],[0,146,147,122,190,191],[0,146,147,123,192,193],[0,146,147,126,194,195],[0,146,147,127,196,197],[0,146,147,122,190,191,152,153,154,198,199,200,155,156,157,201,202,203],[0,158,159,123,204,205],[0,146,147,126,194,195,152,153,154,206,207,208,155,156,157,209,210,211],[0,158,159,129,212,213],[0,146,147,101,170,171,1,160,161,123,192,193],[0,146,147,108,214,215,1,160,161,127,196,197],[0,146,147,100,172,173,1,160,161,122,190,191],[0,146,147,109,216,217,1,160,161,126,194,195],[0,146,147,100,172,173,1,160,161,122,190,191,152,153,154,182,183,184,162,163,164,198,199,200,155,156,157,185,186,187,165,166,167,201,202,203],[0,158,159,101,188,189,1,168,169,123,204,205],[0,146,147,109,216,217,1,160,161,126,194,195,152,153,154,218,219,220,162,163,164,206,207,208,155,156,157,221,222,223,165,166,167,209,210,211],[0,158,159,117,224,225,1,168,169,129,212,213],[0,146,147,16,226,227],[0,148,149,18,228,229],[0,150,151,18,230,231],[0,150,151,16,232,233],[0,148,149,16,234,235],[0,146,147,18,236,237],[0,146,147,52,238,239],[0,146,147,16,226,227,1,160,161,52,238,239],[0,146,147,18,236,237,1,160,161,61,240,241],[0,146,147,16,226,227,100,172,173,101,170,171],[0,148,149,18,228,229,242,172,181,243,214,244],[0,150,151,18,230,231,245,172,177,246,214,247],[0,150,151,16,232,233,245,172,177,174,170,248],[0,148,149,16,234,235,242,172,181,178,170,249],[0,146,147,18,236,237,100,172,173,108,214,215],[0,146,147,16,226,227,122,190,191,123,192,193],[0,146,147,16,226,227,126,194,195,127,196,197],[0,146,147,18,236,237,126,194,195,123,192,193],[0,146,147,18,236,237,122,190,191,127,196,197],[0,146,147,52,238,239,122,190,191,101,170,171],[0,146,147,61,240,241,126,194,195,101,170,171],[0,146,147,52,238,239,100,172,173,123,192,193],[0,146,147,61,240,241,100,172,173,127,196,197],[0,146,147,16,226,227,100,172,173,101,170,171,1,160,161,52,239,238,122,190,191,123,192,193],[0,146,147,16,226,227,109,216,217,108,214,215,1,160,161,52,239,238,126,194,195,127,196,197],[0,146,147,18,236,237,109,216,217,101,170,171,1,160,161,61,241,240,126,194,195,123,192,193],[0,146,147,18,236,237,100,172,173,108,214,215,1,160,161,61,241,240,122,190,191,127,196,197],[0,16,2,17,158,250,251,252,159,253,254,255],[0,16,2,17,158,250,251,252,159,253,254,255,23,24,13,25,256,257,258,259,260,261,262,263,26,20,27,28,264,265,266,267,268,269,270,271,4,22,5,19,272,273,274,275,276,277,278,279],[0,16,2,17,158,250,251,252,159,253,254,255,29,21,15,30,280,281,282,283,284,285,286,287],[0,20,13,19,158,273,266,259,159,261,278,271],[0,20,13,19,158,273,266,259,159,261,278,271,29,31,32,33,280,288,289,290,284,291,292,293],[0,16,2,17,158,250,251,252,159,253,254,255,1,52,6,34,168,294,295,296,169,297,298,299],[0,16,2,17,158,250,251,252,159,253,254,255,53,54,9,42,300,301,302,303,304,305,306,307],[0,16,2,17,158,250,251,252,159,253,254,255,1,52,6,34,168,294,295,296,169,297,298,299,23,24,13,25,256,257,258,259,260,261,262,263,64,62,14,39,308,309,310,311,312,313,314,315,26,20,27,28,264,265,266,267,268,269,270,271,65,59,40,38,316,317,318,319,320,321,322,323,4,22,5,19,272,273,274,275,276,277,278,279,11,55,8,41,324,325,326,327,328,329,330,331],[0,16,2,17,158,250,251,252,159,253,254,255,66,67,44,45,332,333,334,335,336,337,338,339,23,24,13,25,256,257,258,259,260,261,262,263,68,69,46,47,340,341,342,343,344,345,346,347,26,20,27,28,264,265,266,267,268,269,270,271,70,71,48,49,348,349,350,351,352,353,354,355,4,22,5,19,272,273,274,275,276,277,278,279,72,73,50,51,356,357,358,359,360,361,362,363],[0,16,2,17,158,250,251,252,159,253,254,255,1,52,6,34,168,294,295,296,169,297,298,299,29,21,15,30,280,281,282,283,284,285,286,287,53,54,9,42,300,301,302,303,304,305,306,307],[0,20,13,19,158,273,266,259,159,261,278,271,1,59,14,41,168,325,318,311,169,313,330,323],[0,20,13,19,158,273,266,259,159,261,278,271,1,59,14,41,168,325,318,311,169,313,330,323,29,31,32,33,280,288,289,290,284,291,292,293,53,63,36,35,300,364,365,366,304,367,368,369],[0,16,2,17,158,250,251,252,159,253,254,255,100,101,75,74,370,371,188,372,373,374,375,189],[0,16,2,17,158,250,251,252,159,253,254,255,116,117,83,82,376,377,224,378,379,380,381,225],[0,16,2,17,158,250,251,252,159,253,254,255,100,101,75,74,370,371,188,372,373,374,375,189,23,24,13,25,256,257,258,259,260,261,262,263,382,383,384,385,386,387,388,389,390,391,392,393,26,20,27,28,264,265,266,267,268,269,270,271,394,395,396,397,398,399,400,401,402,403,404,405,4,22,5,19,272,273,274,275,276,277,278,279,138,139,95,94,406,407,408,409,410,411,412,413],[0,24,5,28,158,265,258,275,159,277,270,263,414,415,416,417,418,419,420,421,422,423,424,425,23,16,27,19,256,273,251,267,260,269,278,255,426,427,428,429,430,431,432,433,434,435,436,437,26,22,13,17,264,250,274,259,268,261,254,279,438,439,440,441,442,443,444,445,446,447,448,449,4,20,2,25,272,257,266,252,276,253,262,271,450,451,452,453,454,455,456,457,458,459,460,461],[0,16,2,17,158,250,251,252,159,253,254,255,100,101,75,74,370,371,188,372,373,374,375,189,29,21,15,30,280,281,282,283,284,285,286,287,116,117,83,82,376,377,224,378,379,380,381,225],[0,20,13,19,158,273,266,259,159,261,278,271,450,415,440,429,454,431,420,445,458,447,436,425],[0,20,13,19,158,273,266,259,159,261,278,271,462,463,464,465,466,467,468,469,470,471,472,473],[0,20,13,19,158,273,266,259,159,261,278,271,462,463,464,465,466,467,468,469,470,471,472,473,29,31,32,33,280,288,289,290,284,291,292,293,450,415,440,429,454,431,420,445,458,447,436,425],[0,16,2,17,158,250,251,252,159,253,254,255,123,122,88,89,204,474,475,476,205,477,478,479],[0,16,2,17,158,250,251,252,159,253,254,255,123,122,88,89,204,474,475,476,205,477,478,479,23,24,13,25,256,257,258,259,260,261,262,263,480,481,482,483,484,485,486,487,488,489,490,491,26,20,27,28,264,265,266,267,268,269,270,271,492,493,494,495,496,497,498,499,500,501,502,503,4,22,5,19,272,273,274,275,276,277,278,279,125,124,140,141,504,505,506,507,508,509,510,511],[0,16,2,17,158,250,251,252,159,253,254,255,123,122,88,89,204,474,475,476,205,477,478,479,29,21,15,30,280,281,282,283,284,285,286,287,129,128,90,91,212,512,513,514,213,515,516,517],[0,16,2,17,158,250,251,252,159,253,254,255,129,128,90,91,212,512,513,514,213,515,516,517],[0,16,2,17,158,250,251,252,159,253,254,255,129,128,90,91,212,512,513,514,213,515,516,517,23,24,13,25,256,257,258,259,260,261,262,263,518,519,520,521,522,523,524,525,526,527,528,529,26,20,27,28,264,265,266,267,268,269,270,271,530,531,532,533,534,535,536,537,538,539,540,541,4,22,5,19,272,273,274,275,276,277,278,279,127,126,92,93,542,543,544,545,546,547,548,549],[0,20,13,19,158,273,266,259,159,261,278,271,550,551,552,553,554,555,556,557,558,559,560,561,29,31,32,33,280,288,289,290,284,291,292,293,562,563,564,565,566,567,568,569,570,571,572,573],[0,16,2,17,158,250,251,252,159,253,254,255,100,101,75,74,370,371,188,372,373,374,375,189,1,52,6,34,168,294,295,296,169,297,298,299,122,123,89,88,475,476,204,474,479,478,477,205],[0,16,2,17,158,250,251,252,159,253,254,255,100,101,75,74,370,371,188,372,373,374,375,189,53,54,9,42,300,301,302,303,304,305,306,307,128,129,91,90,513,514,212,512,517,516,515,213],[0,16,2,17,158,250,251,252,159,253,254,255,116,117,83,82,376,377,224,378,379,380,381,225,1,52,6,34,168,294,295,296,169,297,298,299,128,129,91,90,513,514,212,512,517,516,515,213],[0,16,2,17,158,250,251,252,159,253,254,255,116,117,83,82,376,377,224,378,379,380,381,225,53,54,9,42,300,301,302,303,304,305,306,307,122,123,89,88,475,476,204,474,479,478,477,205],[0,16,2,17,158,250,251,252,159,253,254,255,100,101,75,74,370,371,188,372,373,374,375,189,1,52,6,34,168,294,295,296,169,297,298,299,122,123,89,88,475,476,204,474,479,478,477,205,23,24,13,25,256,257,258,259,260,261,262,263,382,383,384,385,386,387,388,389,390,391,392,393,64,62,14,39,308,309,310,311,312,313,314,315,481,480,483,482,486,487,484,485,491,490,489,488,26,20,27,28,264,265,266,267,268,269,270,271,394,395,396,397,398,399,400,401,402,403,404,405,65,59,40,38,316,317,318,319,320,321,322,323,493,492,495,494,498,499,496,497,503,502,501,500,4,22,5,19,272,273,274,275,276,277,278,279,138,139,95,94,406,407,408,409,410,411,412,413,11,55,8,41,324,325,326,327,328,329,330,331,124,125,141,140,506,507,504,505,511,510,509,508],[0,16,2,17,158,250,251,252,159,253,254,255,116,117,83,82,376,377,224,378,379,380,381,225,1,52,6,34,168,294,295,296,169,297,298,299,128,129,91,90,513,514,212,512,517,516,515,213,23,24,13,25,256,257,258,259,260,261,262,263,574,575,576,577,578,579,580,581,582,583,584,585,64,62,14,39,308,309,310,311,312,313,314,315,519,518,521,520,524,525,522,523,529,528,527,526,26,20,27,28,264,265,266,267,268,269,270,271,586,587,588,589,590,591,592,593,594,595,596,597,65,59,40,38,316,317,318,319,320,321,322,323,531,530,533,532,536,537,534,535,541,540,539,538,4,22,5,19,272,273,274,275,276,277,278,279,109,108,79,78,598,599,600,601,602,603,604,605,11,55,8,41,324,325,326,327,328,329,330,331,126,127,93,92,544,545,542,543,549,548,547,546],[0,24,5,28,158,265,258,275,159,277,270,263,414,415,416,417,418,419,420,421,422,423,424,425,66,69,50,49,332,349,342,359,336,361,354,347,493,123,483,140,498,507,204,485,503,490,509,205,23,16,27,19,256,273,251,267,260,269,278,255,426,427,428,429,430,431,432,433,434,435,436,437,68,67,48,51,340,357,334,351,344,353,362,339,124,480,89,494,506,499,484,474,511,478,501,488,26,22,13,17,264,250,274,259,268,261,254,279,438,439,440,441,442,443,444,445,446,447,448,449,70,73,46,45,348,333,358,343,352,345,338,363,122,492,141,482,475,487,496,505,479,510,489,500,4,20,2,25,272,257,266,252,276,253,262,271,450,451,452,453,454,455,456,457,458,459,460,461,72,71,44,47,356,341,350,335,360,337,346,355,481,125,495,88,486,476,504,497,491,502,477,508],[0,24,5,28,158,265,258,275,159,277,270,263,414,415,416,417,418,419,420,421,422,423,424,425,606,607,608,609,610,611,612,613,614,615,616,617,531,129,521,92,536,545,212,523,541,528,547,213,23,16,27,19,256,273,251,267,260,269,278,255,426,427,428,429,430,431,432,433,434,435,436,437,618,619,620,621,622,623,624,625,626,627,628,629,126,518,91,532,544,537,522,512,549,516,539,526,26,22,13,17,264,250,274,259,268,261,254,279,438,439,440,441,442,443,444,445,446,447,448,449,630,631,632,633,634,635,636,637,638,639,640,641,128,530,93,520,513,525,534,543,517,548,527,538,4,20,2,25,272,257,266,252,276,253,262,271,450,451,452,453,454,455,456,457,458,459,460,461,642,643,644,645,646,647,648,649,650,651,652,653,519,127,533,90,524,514,542,535,529,540,515,546],[0,16,2,17,158,250,251,252,159,253,254,255,100,101,75,74,370,371,188,372,373,374,375,189,1,52,6,34,168,294,295,296,169,297,298,299,122,123,89,88,475,476,204,474,479,478,477,205,29,21,15,30,280,281,282,283,284,285,286,287,116,117,83,82,376,377,224,378,379,380,381,225,53,54,9,42,300,301,302,303,304,305,306,307,128,129,91,90,513,514,212,512,517,516,515,213],[0,20,13,19,158,273,266,259,159,261,278,271,462,463,464,465,466,467,468,469,470,471,472,473,1,59,14,41,168,325,318,311,169,313,330,323,551,550,553,552,556,557,554,555,561,560,559,558,29,31,32,33,280,288,289,290,284,291,292,293,450,415,440,429,454,431,420,445,458,447,436,425,53,63,36,35,300,364,365,366,304,367,368,369,563,562,565,564,568,569,566,567,573,572,571,570],[0,16],[0,18],[0,16,26,20],[0,2,23,13],[0,3,4,32],[0,2,29,15],[0,3,29,27],[0,52],[0,63],[0,52,26,59],[0,63,26,54],[0,52,16,1],[0,18,1,61],[0,52,16,1,26,59,20,65],[0,31,1,63],[0,1,24,62],[0,15,1,9],[0,5,1,8],[0,31,1,63,26,21,65,54],[0,2,57,56],[0,60,3,16],[0,22,57,3],[0,2,28,20],[0,17,13,24],[0,20,19,13,4,24,17,27],[0,22,57,3,4,16,60,32],[0,22,57,3,23,20,30,12,26,24,33,15,4,16,60,32],[0,22,57,3,29,18,27,25],[0,22,3,57,1,55,10,37],[0,22,385,396,3,57,109,117],[0,22,57,3,159,279,654,655,158,274,656,657,29,18,25,27,284,658,262,269,280,659,257,267]],Cb={"P 1":0,"P -1":1,"P 1 2 1":2,"P 1 21 1":3,"C 1 2 1":4,"P 1 m 1":5,"P 1 c 1":6,"C 1 m 1":7,"C 1 c 1":8,"P 1 2/m 1":9,"P 1 21/m 1":10,"C 1 2/m 1":11,"P 1 2/c 1":12,"P 1 21/c 1":13,"C 1 2/c 1":14,"P 2 2 2":15,"P 2 2 21":16,"P 21 21 2":17,"P 21 21 21":18,"C 2 2 21":19,"C 2 2 2":20,"F 2 2 2":21,"I 2 2 2":22,"I 21 21 21":23,"P m m 2":24,"P m c 21":25,"P c c 2":26,"P m a 2":27,"P c a 21":28,"P n c 2":29,"P m n 21":30,"P b a 2":31,"P n a 21":32,"P n n 2":33,"C m m 2":34,"C m c 21":35,"C c c 2":36,"A m m 2":37,"A b m 2":38,"A m a 2":39,"A b a 2":40,"F m m 2":41,"F d d 2":42,"I m m 2":43,"I b a 2":44,"I m a 2":45,"P 2/m 2/m 2/m":46,"P m m m":46,"P 2/n 2/n 2/n":47,"P n n n":47,"P 2/c 2/c 2/m":48,"P c c m":48,"P 2/b 2/a 2/n":49,"P b a n":49,"P 21/m 2/m 2/a":50,"P m m a":50,"P 2/n 21/n 2/a":51,"P n n a":51,"P 2/m 2/n 21/a":52,"P m n a":52,"P 21/c 2/c 2/a":53,"P c c a":53,"P 21/b 21/a 2/m":54,"P b a m":54,"P 21/c 21/c 2/n":55,"P c c n":55,"P 2/b 21/c 21/m":56,"P b c m":56,"P 21/n 21/n 2/m":57,"P n n m":57,"P 21/m 21/m 2/n":58,"P m m n":58,"P 21/b 2/c 21/n":59,"P b c n":59,"P 21/b 21/c 21/a":60,"P b c a":60,"P 21/n 21/m 21/a":61,"P n m a":61,"C 2/m 2/c 21/m":62,"C m c m":62,"C 2/m 2/c 21/a":63,"C m c a":63,"C 2/m 2/m 2/m":64,"C m m m":64,"C 2/c 2/c 2/m":65,"C c c m":65,"C 2/m 2/m 2/a":66,"C m m a":66,"C 2/c 2/c 2/a":67,"C c c a":67,"F 2/m 2/m 2/m":68,"F m m m":68,"F 2/d 2/d 2/d":69,"F d d d":69,"I 2/m 2/m 2/m":70,"I m m m":70,"I 2/b 2/a 2/m":71,"I b a m":71,"I 21/b 21/c 21/a":72,"I b c a":72,"I 21/m 21/m 21/a":73,"I m m a":73,"P 4":74,"P 41":75,"P 42":76,"P 43":77,"I 4":78,"I 41":79,"P -4":80,"I -4":81,"P 4/m":82,"P 42/m":83,"P 4/n":84,"P 42/n":85,"I 4/m":86,"I 41/a":87,"P 4 2 2":88,"P 4 21 2":89,"P 41 2 2":90,"P 41 21 2":91,"P 42 2 2":92,"P 42 21 2":93,"P 43 2 2":94,"P 43 21 2":95,"I 4 2 2":96,"I 41 2 2":97,"P 4 m m":98,"P 4 b m":99,"P 42 c m":100,"P 42 n m":101,"P 4 c c":102,"P 4 n c":103,"P 42 m c":104,"P 42 b c":105,"I 4 m m":106,"I 4 c m":107,"I 41 m d":108,"I 41 c d":109,"P -4 2 m":110,"P -4 2 c":111,"P -4 21 m":112,"P -4 21 c":113,"P -4 m 2":114,"P -4 c 2":115,"P -4 b 2":116,"P -4 n 2":117,"I -4 m 2":118,"I -4 c 2":119,"I -4 2 m":120,"I -4 2 d":121,"P 4/m 2/m 2/m":122,"P4/m m m":122,"P 4/m 2/c 2/c":123,"P4/m c c":123,"P 4/n 2/b 2/m":124,"P4/n b m":124,"P 4/n 2/n 2/c":125,"P4/n n c":125,"P 4/m 21/b 2/m":126,"P4/m b m":126,"P 4/m 21/n 2/c":127,"P4/m n c":127,"P 4/n 21/m 2/m":128,"P4/n m m":128,"P 4/n 2/c 2/c":129,"P4/n c c":129,"P 42/m 2/m 2/c":130,"P42/m m c":130,"P 42/m 2/c 2/m":131,"P42/m c m":131,"P 42/n 2/b 2/c":132,"P42/n b c":132,"P 42/n 2/n 2/m":133,"P42/n n m":133,"P 42/m 21/b 2/c":134,"P42/m b c":134,"P 42/m 21/n 2/m":135,"P42/m n m":135,"P 42/n 21/m 2/c":136,"P42/n m c":136,"P 42/n 21/c 2/m":137,"P42/n c m":137,"I 4/m 2/m 2/m":138,"I4/m m m":138,"I 4/m 2/c 2/m":139,"I4/m c m":139,"I 41/a 2/m 2/d":140,"I41/a m d":140,"I 41/a 2/c 2/d":141,"I41/a c d":141,"P 3":142,"P 31":143,"P 32":144,"H 3":145,"R 3":146,"P -3":147,"H -3":148,"R -3":149,"P 3 1 2":150,"P 3 2 1":151,"P 31 1 2":152,"P 31 2 1":153,"P 32 1 2":154,"P 32 2 1":155,"H 3 2":156,"R 3 2":157,"P 3 m 1":158,"P 3 1 m":159,"P 3 c 1":160,"P 3 1 c":161,"H 3 m":162,"R 3 m":163,"H 3 c":164,"R 3 c":165,"P -3 1 2/m":166,"P -3 1 m":166,"P -3 1 2/c":167,"P -3 1 c":167,"P -3 2/m 1":168,"P -3 m 1":168,"P -3 2/c 1":169,"P -3 c 1":169,"H -3 2/m":170,"H -3 m":170,"R -3 2/m":171,"R -3 m":171,"H -3 2/c":172,"H -3 c":172,"R -3 2/c":173,"R -3 c":173,"P 6":174,"P 61":175,"P 65":176,"P 62":177,"P 64":178,"P 63":179,"P -6":180,"P 6/m":181,"P 63/m":182,"P 6 2 2":183,"P 61 2 2":184,"P 65 2 2":185,"P 62 2 2":186,"P 64 2 2":187,"P 63 2 2":188,"P 6 m m":189,"P 6 c c":190,"P 63 c m":191,"P 63 m c":192,"P -6 m 2":193,"P -6 c 2":194,"P -6 2 m":195,"P -6 2 c":196,"P 6/m 2/m 2/m":197,"P 6/m m m":197,"P 6/m 2/c 2/c":198,"P 6/m c c":198,"P 63/m 2/c 2/m":199,"P 63/m c m":199,"P 63/m 2/m 2/c":200,"P 63/m m c":200,"P 2 3":201,"F 2 3":202,"I 2 3":203,"P 21 3":204,"I 21 3":205,"P 2/m -3":206,"P m -3":206,"P 2/n -3":207,"P n -3":207,"F 2/m -3":208,"F m -3":208,"F 2/d -3":209,"F d -3":209,"I 2/m -3":210,"I m -3":210,"P 21/a -3":211,"P a -3":211,"I 21/a -3":212,"I a -3":212,"P 4 3 2":213,"P 42 3 2":214,"F 4 3 2":215,"F 41 3 2":216,"I 4 3 2":217,"P 43 3 2":218,"P 41 3 2":219,"I 41 3 2":220,"P -4 3 m":221,"F -4 3 m":222,"I -4 3 m":223,"P -4 3 n":224,"F -4 3 c":225,"I -4 3 d":226,"P 4/m -3 2/m":227,"P m -3 m":227,"P 4/n -3 2/n":228,"P n -3 n":228,"P 42/m -3 2/n":229,"P m -3 n":229,"P 42/n -3 2/m":230,"P n -3 m":230,"F 4/m -3 2/m":231,"F m -3 m":231,"F 4/m -3 2/c":232,"F m -3 c":232,"F 41/d -3 2/m":233,"F d -3 m":233,"F 41/d -3 2/c":234,"F d -3 c":234,"I 4/m -3 2/m":235,"I m -3 m":235,"I 41/a -3 2/d":236,"I a -3 d":236,"P 1 1 2":237,"P 1 1 21":238,"B 1 1 2":239,"B 2":239,"A 1 2 1":240,"C 1 21 1":241,"I 1 2 1":242,"I 2":242,"I 1 21 1":243,"P 1 1 m":244,"P 1 1 b":245,"B 1 1 m":246,"B 1 1 b":247,"P 1 1 2/m":248,"P 1 1 21/m":249,"B 1 1 2/m":250,"P 1 1 2/b":251,"P 1 1 21/b":252,"P 1 21/n 1":253,"P 1 21/a 1":254,"B 1 1 2/b":255,"P 21 2 2":256,"P 2 21 2":257,"P 21 21 2 (a)":258,"P 21 2 21":259,"P 2 21 21":260,"C 2 2 21a)":261,"C 2 2 2a":262,"F 2 2 2a":263,"I 2 2 2a":264,"P 21/m 21/m 2/n a":265,"P 42 21 2a":266,"I 2 3a":267};function Xke(e){switch(e){case 1146:return 146;case 1148:return 149;case 1155:return 157;case 1160:return 163;case 1161:return 165;case 1166:return 171;case 1167:return 173;case 1003:return 237;case 1004:return 238;case 1005:return 239;case 2005:return 240;case 3005:return 241;case 4005:return 242;case 5005:return 243;case 1006:return 244;case 1007:return 245;case 1008:return 246;case 1009:return 247;case 1010:return 248;case 1011:return 249;case 1012:return 250;case 1013:return 251;case 1014:return 252;case 2014:return 253;case 3014:return 254;case 1015:return 255;case 1017:return 256;case 2017:return 257;case 1018:return 258;case 2018:return 259;case 3018:return 260;case 1020:return 261;case 1021:return 262;case 1022:return 263;case 1023:return 264;case 1059:return 265;case 1094:return 266;case 1197:return 267}var t=0;return e>146&&++t,e>148&&++t,e>155&&++t,e>160&&++t,e>161&&++t,e>166&&++t,e>167&&++t,e-1+t}function Yke(e){if(e<146)return e+1;if(e===146)return 1146;if(e<149)return e+1-1;if(e===149)return 1148;if(e<157)return e+1-2;if(e===157)return 1155;if(e<163)return e+1-3;if(e===163)return 1160;if(e<165)return e+1-4;if(e===165)return 1161;if(e<171)return e+1-5;if(e===171)return 1166;if(e<173)return e+1-6;if(e===173)return 1167;if(e<237)return e+1-7;if(e===237)return 1003;if(e===238)return 1004;if(e===239)return 1005;if(e===240)return 2005;if(e===241)return 3005;if(e===242)return 4005;if(e===243)return 5005;if(e===244)return 1006;if(e===245)return 1007;if(e===246)return 1008;if(e===247)return 1009;if(e===248)return 1010;if(e===249)return 1011;if(e===250)return 1012;if(e===251)return 1013;if(e===252)return 1014;if(e===253)return 2014;if(e===254)return 3014;if(e===255)return 1015;if(e===256)return 1017;if(e===257)return 2017;if(e===258)return 1018;if(e===259)return 2018;if(e===260)return 3018;if(e===261)return 1020;if(e===262)return 1021;if(e===263)return 1022;if(e===264)return 1023;if(e===265)return 1059;if(e===266)return 1094;if(e===267)return 1197;throw new Error("unknown spacegroup index '"+e+"'")}var cJ=function(){for(var e=Object.create(null),t=0,r=Object.keys(Cb);t<r.length;t++){var n=r[t];e[Cb[n]]=n}return e}(),Kke=function(){for(var e=Object.create(null),t=0,r=Object.keys(Cb);t<r.length;t++){var n=r[t],i=Cb[n];e[i]=Yke(i)}return e}();function Qke(e){var t=typeof e=="number"?Xke(e):Cb[e];return typeof t>"u"||typeof cJ[t]>"u"?-1:t}var Mo;(function(e){e.Zero=r("P 1",_.create(1,1,1),_.create(Math.PI/2,Math.PI/2,Math.PI/2));function t(n){return n?n.index===0&&n.size[0]===1&&n.size[1]===1&&n.size[1]===1:!0}e.isZero=t;function r(n,i,a){var o=Qke(n);if(o<0)return console.warn("Unknown spacegroup '"+n+"', returning a 'P 1' with cellsize [1, 1, 1]"),e.Zero;var s=i[0]*i[1]*i[2],u=a[0],l=a[1],c=a[2],d=i[0],f=i[1],p=i[2],v=Math.cos(l),h=(Math.cos(u)-Math.cos(l)*Math.cos(c))/Math.sin(c),m=Math.sqrt(1-v*v-h*h),g=[d,0,0],y=[Math.cos(c)*f,Math.sin(c)*f,0],b=[v*p,h*p,m*p],S=ue.ofRows([[g[0],y[0],b[0],0],[0,y[1],b[1],0],[0,0,b[2],0],[0,0,0,1]]),x=ue.invert(ue.zero(),S);return{index:o,size:i,volume:s,anglesInRadians:a,toFractional:x,fromFractional:S}}e.create=r})(Mo||(Mo={}));var Vu;(function(e){e.ZeroP1=t(Mo.Zero);function t(m){var g=Wke[m.index].map(function(S){return d($ke[S])}),y=cJ[m.index],b=Kke[m.index];return{name:y,num:b,cell:m,operators:g}}e.create=t;var r=_(),n=ue();function i(m,g,y,b,S,x){return _.set(r,y,b,S),ue.fromTranslation(n,r),ue.mul(x,ue.mul(x,ue.mul(x,m.cell.fromFractional,n),m.operators[g]),m.cell.toFractional)}e.setOperatorMatrix=i;function a(m,g,y,b,S){var x=i(m,g,y,b,S,ue.zero());return bn.create(g+1+"_"+(5+y)+(5+b)+(5+S),x,{hkl:_.create(y,b,S),spgrOp:g})}e.getSymmetryOperator=a;var o=_(),s=_(),u=_(),l=_();function c(m,g,y,b,S,x){var C=ue.zero();_.set(r,y,b,S),_.floor(o,x),ue.copy(C,m.operators[g]),_.floor(s,_.transformMat4(s,x,C)),ue.getTranslation(l,C),_.sub(l,l,s),_.add(l,l,o),_.add(l,l,r),ue.setTranslation(C,l),ue.mul(C,m.cell.fromFractional,C),ue.mul(C,C,m.cell.toFractional),_.sub(u,s,o);var w=y-u[0],A=b-u[1],M=S-u[2];return bn.create(g+1+"_"+(5+w)+(5+A)+(5+M),C,{hkl:_.create(w,A,M),spgrOp:g})}e.getSymmetryOperatorRef=c;function d(m){var g=C4[m[0]],y=C4[m[1]],b=C4[m[2]];return ue.ofRows([g,y,b,[0,0,0,1]])}function f(m){return[h(p(m[0],m[4],m[8]),v(m[12])),h(p(m[1],m[5],m[9]),v(m[13])),h(p(m[2],m[6],m[10]),v(m[14]))].join(",")}e.getOperatorXyz=f;function p(m,g,y){var b=[];if(m>0?b.push("+X"):m<0&&b.push("-X"),g>0?b.push("+Y"):g<0&&b.push("-Y"),y>0?b.push("+Z"):y<0&&b.push("-Z"),b.length===1)return b[0].charAt(0)==="+"?b[0].substr(1):b[0];if(b.length===2){var S=b[0].charAt(0),x=b[1].charAt(0);if(S==="+")return""+b[0].substr(1)+b[1];if(x==="+")return""+b[1].substr(1)+b[0]}throw new Error("unknown rotation '"+b+"', "+m+" "+g+" "+y)}function v(m){switch(m){case 1/2:return"1/2";case 1/4:return"1/4";case 3/4:return"3/4";case 1/3:return"1/3";case 2/3:return"2/3";case 1/6:return"1/6";case 5/6:return"5/6"}return""}function h(m,g){return g===""?m:m.length>2?m+"+"+g:m.charAt(0)==="-"?""+g+m:g+"+"+m}})(Vu||(Vu={}));var fp;(function(e){function t(a,o,s){a.squaredDistances[a.count]=s,a.indices[a.count++]=o}e.add=t;function r(a){a.count=0}e.reset=r;function n(){return{count:0,indices:[],squaredDistances:[]}}e.create=n;function i(a,o){for(var s=0;s<o.count;++s)a.indices[s]=o.indices[s],a.squaredDistances[s]=o.squaredDistances[s];return a.count=o.count,a}e.copy=i})(fp||(fp={}));function Be(){return Be.zero()}(function(e){function t(k){return k.extrema!==void 0}e.hasExtrema=t;function r(k,R){return{center:k,radius:R}}e.create=r;function n(){return{center:_(),radius:0}}e.zero=n;function i(k){var R=r(_.clone(k.center),k.radius);return t(k)&&(R.extrema=k.extrema.map(function(O){return _.clone(O)})),R}e.clone=i;function a(k,R,O){return _.copy(k.center,R),k.radius=O,k}e.set=a;function o(k,R){return _.copy(k.center,R.center),k.radius=R.radius,t(R)&&s(k,R.extrema.map(function(O){return _.clone(O)})),k}e.copy=o;function s(k,R){var O;return k.extrema!==void 0?(k.extrema.length=0,(O=k.extrema).push.apply(O,R)):k.extrema=R,k}e.setExtrema=s;function u(k){for(var R=k.x,O=k.y,H=k.z,B=k.indices,j=0,Y=0,G=0,$=0,q=Le.size(B),ee=0;ee<q;ee++){var fe=Le.getAt(B,ee);j+=R[fe],Y+=O[fe],G+=H[fe]}q>0&&(j/=q,Y/=q,G/=q);for(var ee=0;ee<q;ee++){var fe=Le.getAt(B,ee),W=R[fe]-j,X=O[fe]-Y,U=H[fe]-G,z=W*W+X*X+U*U;z>$&&($=z)}return{center:_.create(j,Y,G),radius:Math.sqrt($)}}e.computeBounding=u;function l(k,R,O){return _.transformMat4(k.center,R.center,O),k.radius=R.radius*ue.getMaxScaleOnAxis(O),t(R)&&s(k,R.extrema.map(function(H){return _.transformMat4(_(),H,O)})),k}e.transform=l;function c(k,R,O){return _.add(k.center,R.center,O),t(R)&&s(k,R.extrema.map(function(H){return _.add(_(),H,O)})),k}e.translate=c;function d(k,R,O){_.toArray(k.center,R,O),R[O+3]=k.radius}e.toArray=d;function f(k,R,O){return _.fromArray(k.center,R,O),k.radius=R[O+3],k}e.fromArray=f;function p(k,R){return _.scale(k.center,_.add(k.center,R.max,R.min),.5),k.radius=_.distance(k.center,R.max),e.setExtrema(k,[_.create(R.min[0],R.min[1],R.min[2]),_.create(R.max[0],R.max[1],R.max[2]),_.create(R.max[0],R.min[1],R.min[2]),_.create(R.min[0],R.max[1],R.max[2]),_.create(R.min[0],R.min[1],R.max[2]),_.create(R.max[0],R.min[1],R.max[2]),_.create(R.max[0],R.max[1],R.min[2]),_.create(R.min[0],R.max[1],R.min[2])]),k}e.fromBox3D=p;function v(k,R){return _.copy(k.center,R.origin),k.radius=Math.max(_.magnitude(R.dirA),_.magnitude(R.dirB),_.magnitude(R.dirC)),k}e.fromAxes3D=v;var h=_();function m(k,R,O){var H=R[0],B=R[1],j=R[2],Y=_.create(0,0,0);_.transformMat4(Y,Y,O);var G=_.create(H,B,j);_.transformMat4(G,G,O);var $=_.create(H,0,0);_.transformMat4($,$,O);var q=_.create(0,B,j);_.transformMat4(q,q,O);var ee=_.create(0,0,j);_.transformMat4(ee,ee,O);var fe=_.create(H,0,j);_.transformMat4(fe,fe,O);var W=_.create(H,B,0);_.transformMat4(W,W,O);var X=_.create(0,B,0);_.transformMat4(X,X,O),_.add(h,Y,G),_.scale(h,h,.5);var U=Math.max(_.distance(Y,G),_.distance($,q));return e.set(k,h,U/2),e.setExtrema(k,[Y,G,$,q,ee,fe,W,X]),k}e.fromDimensionsAndTransform=m;var g=_();function y(k,R,O){var H=_.distance(R.center,O);return H<R.radius?e.copy(k,R):(_.sub(g,R.center,O),_.sub(g,R.center,g),_.setMagnitude(g,g,R.radius),_.scale(k.center,_.add(g,g,O),.5),k.radius=_.distance(k.center,O),k)}e.addVec3=y;function b(k,R,O){return _.copy(k.center,R.center),k.radius=Math.max(R.radius,_.distance(R.center,O.center)+O.radius),t(R)&&t(O)&&s(k,Nt(Nt([],R.extrema.map(function(H){return _.clone(H)})),O.extrema.map(function(H){return _.clone(H)}))),k}e.expandBySphere=b;var S=_();function x(k,R,O){var H,B;return _.copy(k.center,R.center),k.radius=R.radius+O,R.radius<1e-12||((B=(H=R.extrema)===null||H===void 0?void 0:H.length)!==null&&B!==void 0?B:0)<=1?(k.extrema=void 0,k):(t(R)&&s(k,R.extrema.map(function(j){_.sub(S,j,R.center);var Y=_.distance(R.center,j);return _.normalize(S,S),_.scaleAndAdd(_(),R.center,S,Y+O)})),k)}e.expand=x;function C(k,R){return k.radius===R.radius&&_.exactEquals(k.center,R.center)}e.exactEquals=C;function w(k,R){var O=k.radius,H=R.radius;return Math.abs(O-H)<=xn*Math.max(1,Math.abs(O),Math.abs(H))&&_.equals(k.center,R.center)}e.equals=w;function A(k,R){if(t(R)){for(var O=0,H=R.extrema;O<H.length;O++){var B=H[O];if(_.distance(k.center,B)>k.radius)return!1}return!0}else return _.distance(k.center,R.center)+R.radius<=k.radius}e.includes=A;function M(k,R){return _.distance(k.center,R.center)<=k.radius+R.radius}e.overlaps=M;function D(k,R){return _.distance(k.center,R.center)-k.radius+R.radius}e.distance=D})(Be||(Be={}));function Xt(){return Xt.zero()}(function(e){function t(y,b){return{min:y,max:b}}e.create=t;function r(){return{min:_(),max:_()}}e.zero=r;function n(y,b){return _.copy(y.min,b.min),_.copy(y.max,b.max),y}e.copy=n;function i(y){return n(r(),y)}e.clone=i;function a(y,b){if(Be.hasExtrema(b))return o(y,b.extrema);var S=_.create(b.radius,b.radius,b.radius);return _.sub(y.min,b.center,S),_.add(y.max,b.center,S),y}e.fromSphere3D=a;function o(y,b){e.setEmpty(y);for(var S=0,x=b.length;S<x;S++)e.add(y,b[S]);return y}e.fromVec3Array=o;function s(y){for(var b=_.create(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),S=_.create(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),x=y.x,C=y.y,w=y.z,A=y.indices,M=0,D=Le.size(A);M<D;M++){var k=Le.getAt(A,M);b[0]=Math.min(x[k],b[0]),b[1]=Math.min(C[k],b[1]),b[2]=Math.min(w[k],b[2]),S[0]=Math.max(x[k],S[0]),S[1]=Math.max(C[k],S[1]),S[2]=Math.max(w[k],S[2])}return{min:b,max:S}}e.computeBounding=s;function u(y,b){return _.sub(y,b.max,b.min)}e.size=u;var l=_();function c(y){return u(l,y),l[0]*l[1]*l[2]}e.volume=c;function d(y){return _.set(y.min,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),_.set(y.max,-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),y}e.setEmpty=d;function f(y,b){return _.min(y.min,y.min,b),_.max(y.max,y.max,b),y}e.add=f;function p(y,b,S){return _.sub(y.min,b.min,S),_.add(y.max,b.max,S),y}e.expand=p;function v(y,b,S){return _.scale(y.min,b.min,S),_.scale(y.max,b.max,S),y}e.scale=v;var h=_();function m(y,b,S){var x=b.min,C=x[0],w=x[1],A=x[2],M=b.max,D=M[0],k=M[1],R=M[2];return d(y),f(y,_.transformMat4(h,_.set(h,C,w,A),S)),f(y,_.transformMat4(h,_.set(h,C,w,R),S)),f(y,_.transformMat4(h,_.set(h,C,k,A),S)),f(y,_.transformMat4(h,_.set(h,C,k,R),S)),f(y,_.transformMat4(h,_.set(h,D,w,A),S)),f(y,_.transformMat4(h,_.set(h,D,w,R),S)),f(y,_.transformMat4(h,_.set(h,D,k,A),S)),f(y,_.transformMat4(h,_.set(h,D,k,R),S)),y}e.transform=m;function g(y,b){return!(b[0]<y.min[0]||b[0]>y.max[0]||b[1]<y.min[1]||b[1]>y.max[1]||b[2]<y.min[2]||b[2]>y.max[2])}e.containsVec3=g})(Xt||(Xt={}));function fv(e,t,r){return new Zke(e,t,r)}var Zke=function(){function e(t,r,n){var i=eOe(t,r,n);this.ctx=tOe(i),this.boundary={box:i.boundingBox,sphere:i.boundingSphere},this.buckets={offset:i.bucketOffset,count:i.bucketCounts,array:i.bucketArray},this.result=fp.create()}return e.prototype.find=function(t,r,n,i,a){this.ctx.x=t,this.ctx.y=r,this.ctx.z=n,this.ctx.radius=i,this.ctx.isCheck=!1;var o=a??this.result;return SU(this.ctx,o),o},e.prototype.check=function(t,r,n,i){return this.ctx.x=t,this.ctx.y=r,this.ctx.z=n,this.ctx.radius=i,this.ctx.isCheck=!0,SU(this.ctx,this.result)},e}();function Jke(e){for(var t=e.expandedBox,r=e.size,n=r[0],i=r[1],a=r[2],o=e.data,s=o.x,u=o.y,l=o.z,c=o.radius,d=o.indices,f=e.elementCount,p=e.delta,v=n*i*a,h=t.min,m=h[0],g=h[1],y=h[2],b=0,S=0,x=new Uint32Array(v),C=new Int32Array(f),w=0;w<f;w++){var A=Le.getAt(d,w),M=Math.floor((s[A]-m)/p[0]),D=Math.floor((u[A]-g)/p[1]),k=Math.floor((l[A]-y)/p[2]),R=(M*i+D)*a+k;(x[R]+=1)===1&&(S+=1),C[w]=R}if(c)for(var w=0;w<f;w++){var A=Le.getAt(d,w);c[A]>b&&(b=c[A])}for(var O=new Int32Array(S),A=0,H=0;A<v;A++){var B=x[A];B>0&&(x[A]=H+1,O[H]=B,H+=1)}for(var j=new Uint32Array(S),A=1;A<S;++A)j[A]+=j[A-1]+O[A-1];for(var Y=new Int32Array(S),G=new Int32Array(f),A=0;A<f;A++){var $=x[C[A]];if($>0){var q=$-1;G[j[q]+Y[q]]=A,Y[q]+=1}}return{size:e.size,bucketArray:G,bucketCounts:O,bucketOffset:j,grid:x,delta:p,min:e.expandedBox.min,data:e.data,maxRadius:b,expandedBox:e.expandedBox,boundingBox:e.boundingBox,boundingSphere:e.boundingSphere}}function eOe(e,t,r){var n=Xt.expand(Xt(),t.box,_.create(.5,.5,.5)),i=e.indices,a=Xt.size(_.zero(),n),o,s,u=Le.size(i),l=typeof r=="number"?r:32,c=Array.isArray(r)&&r;if(c)s=[Math.ceil(a[0]/c[0]),Math.ceil(a[1]/c[1]),Math.ceil(a[2]/c[2])],o=c;else if(u>0){var d=Math.ceil(u/l),f=Math.pow(d/(a[0]*a[1]*a[2]),1/3);s=[Math.ceil(a[0]*f),Math.ceil(a[1]*f),Math.ceil(a[2]*f)],o=[a[0]/s[0],a[1]/s[1],a[2]/s[2]]}else o=a,s=[1,1,1];var p={x:e.x,y:e.y,z:e.z,indices:i,radius:e.radius},v={size:s,data:p,expandedBox:n,boundingBox:t.box,boundingSphere:t.sphere,elementCount:u,delta:o};return Jke(v)}function tOe(e){return{grid:e,x:.1,y:.1,z:.1,radius:.1,isCheck:!1}}function SU(e,t){var r=e.grid,n=r.min,i=r.size,a=i[0],o=i[1],s=i[2],u=r.bucketOffset,l=r.bucketCounts,c=r.bucketArray,d=r.grid,f=r.data,p=f.x,v=f.y,h=f.z,m=f.indices,g=f.radius,y=r.delta,b=r.maxRadius,S=e.radius,x=e.isCheck,C=e.x,w=e.y,A=e.z,M=S+b,D=M*M;fp.reset(t);var k=Math.max(0,Math.floor((C-M-n[0])/y[0])),R=Math.max(0,Math.floor((w-M-n[1])/y[1])),O=Math.max(0,Math.floor((A-M-n[2])/y[2])),H=Math.min(a-1,Math.floor((C+M-n[0])/y[0])),B=Math.min(o-1,Math.floor((w+M-n[1])/y[1])),j=Math.min(s-1,Math.floor((A+M-n[2])/y[2]));if(k>H||R>B||O>j)return!1;for(var Y=k;Y<=H;Y++)for(var G=R;G<=B;G++)for(var $=O;$<=j;$++){var q=d[(Y*o+G)*s+$];if(q!==0)for(var ee=q-1,fe=u[ee],W=l[ee],X=fe+W,U=fe;U<X;U++){var z=Le.getAt(m,c[U]),J=p[z]-C,K=v[z]-w,Z=h[z]-A,te=J*J+K*K+Z*Z;if(te<=D){if(b>0&&Math.sqrt(te)-g[z]>S)continue;if(x)return!0;fp.add(t,c[U],te)}}}return t.count>0}function _u(){return _u.empty()}(function(e){function t(d,f,p,v){return{origin:d,dirA:f,dirB:p,dirC:v}}e.create=t;function r(){return{origin:_(),dirA:_(),dirB:_(),dirC:_()}}e.empty=r;function n(d,f){return _.copy(d.origin,f.origin),_.copy(d.dirA,f.dirA),_.copy(d.dirB,f.dirB),_.copy(d.dirC,f.dirC),d}e.copy=n;function i(d){return n(r(),d)}e.clone=i;function a(d,f){return _.set(d,_.magnitude(f.dirA)*2,_.magnitude(f.dirB)*2,_.magnitude(f.dirC)*2)}e.size=a;var o=_();function s(d){return a(o,d),o[0]*o[1]*o[2]}e.volume=s;function u(d,f){return _.copy(d.origin,f.origin),_.normalize(d.dirA,f.dirA),_.normalize(d.dirB,f.dirB),_.normalize(d.dirC,f.dirC),d}e.normalize=u;var l=$n.zero();function c(d,f,p){_.transformMat4(d.origin,f.origin,p);var v=$n.directionTransform(l,p);return _.transformMat3(d.dirA,f.dirA,v),_.transformMat3(d.dirB,f.dirB,v),_.transformMat3(d.dirC,f.dirC,v),d}e.transform=c})(_u||(_u={}));function Xr(e){return function(t){return TL(e,t)}}function TL(e,t){var r=e.data,n=e.indices,i=e.count,a=t.valueType,o=a==="str"?function(s){return r.substring(n[2*s],n[2*s+1])}:a==="int"?function(s){return Zf(r,n[2*s],n[2*s+1])||0}:function(s){return Lc(r,n[2*s],n[2*s+1])||0};return{schema:t,__array:void 0,isDefined:!0,rowCount:i,value:o,valueKind:function(s){return 0},toArray:function(s){return ia(i,o,s)},areValuesEqual:dJ(e)}}function dJ(e){var t=e.data,r=e.indices;return function(n,i){var a=r[2*n],o=r[2*i],s=r[2*n+1]-a;if(s!==r[2*i+1]-o)return!1;for(var u=0;u<s;u++)if(t.charCodeAt(u+a)!==t.charCodeAt(u+o))return!1;return!0}}function fJ(e,t){return{name:t,blocks:e}}function IL(e,t,r,n){return n===void 0&&(n=[]),{categoryNames:e,header:r,categories:t,saveFrames:n,getField:function(i){var a=i.split("."),o=a[0],s=a[1];return t[o].getField(s||"")}}}function rOe(e,t,r){return{categoryNames:e,header:r,categories:t}}function va(e,t,r,n){return{rowCount:t,name:e,fieldNames:Nt([],r),getField:function(i){return n[i]}}}(function(e){function t(i){return{rowCount:0,name:i,fieldNames:[],getField:function(a){}}}e.empty=t;function r(i,a){var o=Object.keys(a);return{rowCount:o.length>0?a[o[0]].rowCount:0,name:i,fieldNames:o,getField:function(s){return a[s]}}}e.ofFields=r;function n(i,a){for(var o={},s=0,u=a._columns;s<u.length;s++){var l=u[s];o[l]=St.ofColumn(a[l])}return r(i,o)}e.ofTable=n})(va||(va={}));var St;(function(e){function t(s){return r([s])}e.ofString=t;function r(s){var u=s.length,l=function(p){var v=s[p];return!v||v==="."||v==="?"?"":v},c=function(p){var v=s[p];return Zf(v,0,v.length)||0},d=function(p){var v=s[p];return Lc(v,0,v.length)||0},f=function(p){var v=s[p],h=v.length;if(h>1)return 0;if(h===0)return 1;var m=v.charCodeAt(0);return m===46?1:m===63?2:0};return{__array:void 0,binaryEncoding:void 0,isDefined:!0,rowCount:u,str:l,int:c,float:d,valueKind:f,areValuesEqual:function(p,v){return s[p]===s[v]},toStringArray:function(p){return p?ia(u,l,p):s},toIntArray:function(p){return ia(u,c,p)},toFloatArray:function(p){return ia(u,d,p)}}}e.ofStrings=r;function n(s){var u=s.length,l=function(p){return""+s[p]},c=function(p){return s[p]},d=function(p){return 0},f=function(p){return!p||p.array&&s instanceof p.array?s:ia(u,c,p)};return{__array:void 0,binaryEncoding:void 0,isDefined:!0,rowCount:u,str:l,int:c,float:c,valueKind:d,areValuesEqual:function(p,v){return s[p]===s[v]},toStringArray:function(p){return ia(u,l,p)},toIntArray:f,toFloatArray:f}}e.ofNumbers=n;function i(s){var u=s.data,l=s.indices,c=s.count,d=function(h){var m=u.substring(l[2*h],l[2*h+1]);return m==="."||m==="?"?"":m},f=function(h){return Zf(u,l[2*h],l[2*h+1])||0},p=function(h){return Lc(u,l[2*h],l[2*h+1])||0},v=function(h){var m=l[2*h],g=l[2*h+1]-m;if(g>1)return 0;if(g===0)return 1;var y=u.charCodeAt(m);return y===46?1:y===63?2:0};return{__array:void 0,binaryEncoding:void 0,isDefined:!0,rowCount:c,str:d,int:f,float:p,valueKind:v,areValuesEqual:dJ(s),toStringArray:function(h){return ia(c,d,h)},toIntArray:function(h){return ia(c,f,h)},toFloatArray:function(h){return ia(c,p,h)}}}e.ofTokens=i;function a(s){var u=s.rowCount,l=s.valueKind,c=s.areValuesEqual,d=s.isDefined,f,p,v;switch(s.schema.valueType){case"float":case"int":f=function(m){return""+s.value(m)},p=s.value,v=s.value;break;case"str":f=s.value,p=function(m){var g=s.value(m);return Zf(g,0,g.length)||0},v=function(m){var g=s.value(m);return Lc(g,0,g.length)||0};break;case"list":var h=s.schema.separator;f=function(m){return s.value(m).join(h)},p=function(m){return NaN},v=function(m){return NaN};break;default:throw new Error("unsupported valueType '"+s.schema.valueType+"'")}return{__array:void 0,binaryEncoding:void 0,isDefined:d,rowCount:u,str:f,int:p,float:v,valueKind:l,areValuesEqual:c,toStringArray:function(m){return ia(u,f,m)},toIntArray:function(m){return ia(u,p,m)},toFloatArray:function(m){return ia(u,v,m)}}}e.ofColumn=a;function o(s,u){return a(ve.Undefined(s,u))}e.ofUndefined=o})(St||(St={}));function nOe(e,t,r,n){var i=r?0:1;switch(t){case 1:return n==="brackets"?function(a){return e+"["+(a+i)+"]"}:function(a){return e+"_"+(a+i)};case 2:return n==="brackets"?function(a,o){return e+"["+(a+i)+"]["+(o+i)+"]"}:function(a,o){return e+"_"+(a+i)+(o+i)};case 3:return n==="brackets"?function(a,o,s){return e+"["+(a+i)+"]["+(o+i)+"]["+(s+i)+"]"}:function(a,o,s){return e+"_"+(a+i)+(o+i)+(s+i)};default:throw new Error("Tensors with rank > 3 or rank 0 are currently not supported.")}}function iOe(e,t,r,n){var i=t.create();if(t.rank===1)for(var a=t.dimensions[0],o=0;o<a;o++){var s=e.getField(n(o));t.set(i,o,s?s.float(r):0)}else if(t.rank===2)for(var a=t.dimensions[0],u=t.dimensions[1],o=0;o<a;o++)for(var l=0;l<u;l++){var s=e.getField(n(o,l));t.set(i,o,l,s?s.float(r):0)}else if(t.rank===3)for(var c=t.dimensions[0],d=t.dimensions[1],f=t.dimensions[2],o=0;o<c;o++)for(var l=0;l<d;l++)for(var p=0;p<f;p++){var s=e.getField(n(o,l,p));t.set(i,o,l,p,s?s.float(r):0)}else throw new Error("Tensors with rank > 3 or rank 0 are currently not supported.");return i}function It(e){return{data:e,position:0,length:e.length,lineNumber:1,tokenStart:0,tokenEnd:0}}(function(e){function t(y){return y.data.substring(y.tokenStart,y.tokenEnd)}e.getTokenString=t;function r(y){y.position=0,y.lineNumber=1,y.tokenStart=0,y.tokenEnd=0}e.reset=r;function n(y){for(var b=y.data;y.position<y.length;)switch(b.charCodeAt(y.position)){case 10:return y.tokenEnd=y.position,++y.position,++y.lineNumber,!0;case 13:return y.tokenEnd=y.position,++y.position,++y.lineNumber,b.charCodeAt(y.position)===10&&++y.position,!0;default:++y.position;break}return y.tokenEnd=y.position,y.tokenStart!==y.tokenEnd}e.eatLine=n;function i(y){y.tokenStart=y.position}e.markStart=i;function a(y){return y.tokenStart=y.position,n(y)}e.markLine=a;function o(y){return a(y),t(y)}e.readLine=o;function s(y){a(y);var b=y.position;return g(y,y.tokenStart,y.tokenEnd),y.position=b,t(y)}e.readLineTrim=s;function u(y,b,S){for(var x=0,C=0;C<b;C++){if(!a(y))return x;pt.addUnchecked(S,y.tokenStart,y.tokenEnd),x++}return x}function l(y,b){var S=pt.create(y.data,b*2);return u(y,b,S),S}e.markLines=l;function c(y,b){for(var S=[],x=0;x<b;x++)S.push(e.readLine(y));return S}e.readLines=c;function d(y,b,S,x){return x===void 0&&(x=1e5),ce(this,void 0,void 0,function(){var C,w,A;return de(this,function(M){switch(M.label){case 0:return C=y.length,w=pt.create(y.data,b*2),A=0,[4,Zc(S,x,y,function(D,k){var R=Math.min(b-A,D);return u(k,R,w),A+=R,R},function(D,k){return D.update({message:"Parsing...",current:k.position,max:C})})];case 1:return M.sent(),[2,w]}})})}e.readLinesAsync=d;function f(y){for(var b=e(y),S=pt.create(b.data,Math.max(y.length/80,2));a(b);)pt.add(S,b.tokenStart,b.tokenEnd);return S}e.readAllLines=f;function p(y,b,S){for(var x=0,C=0;C<b;C++){if(!a(y))return x;pt.add(S,y.tokenStart,y.tokenEnd),x++}return x}function v(y,b,S){return S===void 0&&(S=1e5),ce(this,void 0,void 0,function(){var x,C;return de(this,function(w){switch(w.label){case 0:return x=e(y),C=pt.create(x.data,Math.max(y.length/80,2)),[4,Zc(b,S,x,function(A,M){return p(M,A,C),M.position<M.length?A:0},function(A,M){return A.update({message:"Parsing...",current:M.position,max:length})})];case 1:return w.sent(),[2,C]}})})}e.readAllLinesAsync=v;function h(y){for(;y.position<y.length;)switch(y.data.charCodeAt(y.position)){case 9:case 10:case 13:case 32:y.tokenEnd=y.position;return;default:++y.position;break}y.tokenEnd=y.position}e.eatValue=h;function m(y){for(var b=-1;y.position<y.length;){var S=y.data.charCodeAt(y.position);switch(S){case 9:case 32:b=S,++y.position;break;case 10:b!==13&&++y.lineNumber,b=S,++y.position;break;case 13:b=S,++y.position,++y.lineNumber;break;default:return b}}return b}e.skipWhitespace=m;function g(y,b,S){for(var x=y.data,C=b,w=S-1,A=x.charCodeAt(C);(A===9||A===32)&&C<=w;)A=x.charCodeAt(++C);for(A=x.charCodeAt(w);(A===9||A===32)&&w>=C;)A=x.charCodeAt(--w);return y.tokenStart=C,y.tokenEnd=w+1,y.position=S,y}e.trim=g})(It||(It={}));function aOe(e,t,r){for(var n=t,i=r-1,a=e.charCodeAt(n);(a===9||a===32)&&n<=i;)a=e.charCodeAt(++n);for(a=e.charCodeAt(i);(a===9||a===32)&&i>=n;)a=e.charCodeAt(--i);return e.substring(n,i+1)}var pt;(function(e){function t(o){var s=new Uint32Array(1.61*o.indices.length|0);s.set(o.indices),o.indices=s,o.indicesLenMinus2=s.length-2|0}function r(o,s,u){var l=o;l.offset>l.indicesLenMinus2&&t(l),l.indices[l.offset++]=s,l.indices[l.offset++]=u,o.count++}e.add=r;function n(o,s){r(o,s.tokenStart,s.tokenEnd)}e.addToken=n;function i(o,s,u){o.indices[o.offset++]=s,o.indices[o.offset++]=u,o.count++}e.addUnchecked=i;function a(o,s){return s=Math.max(10,s),{data:o,indicesLenMinus2:s-2|0,count:0,offset:0,indices:new Uint32Array(s)}}e.create=a})(pt||(pt={}));var In;(function(e){function t(a,o){return o===void 0&&(o=-1),new n(a,o)}e.error=t;function r(a,o){return o===void 0&&(o=[]),new i(a,o)}e.success=r;var n=function(){function a(o,s){this.message=o,this.line=s,this.isError=!0}return a.prototype.toString=function(){return this.line>=0?"[Line "+this.line+"] "+this.message:this.message},a}();e.Error=n;var i=function(){function a(o,s){this.result=o,this.warnings=s,this.isError=!1}return a}();e.Success=i})(In||(In={}));function CU(e){for(;e.position<e.length;)switch(e.data.charCodeAt(e.position)){case 9:case 10:case 13:case 32:e.tokenEnd=e.position;return;default:++e.position;break}e.tokenEnd=e.position}function oOe(e,t){var r,n;for(++e.position;e.position<e.length;)if(n=e.data.charCodeAt(e.position),n===t)switch(r=e.data.charCodeAt(e.position+1),r){case 9:case 10:case 13:case 32:e.tokenStart++,e.tokenEnd=e.position,e.isEscaped=!0,++e.position;return;default:if(r===void 0){e.tokenStart++,e.tokenEnd=e.position,e.isEscaped=!0,++e.position;return}++e.position;break}else{if(n===10||n===13){e.tokenEnd=e.position;return}++e.position}e.tokenEnd=e.position}function sOe(e){for(e.position+=3;e.position<e.length;){if(e.data.charCodeAt(e.position)===39&&pJ(e)){e.tokenStart+=3,e.tokenEnd=e.position,e.isEscaped=!0,e.position+=3;return}++e.position}e.tokenEnd=e.position}function uOe(e){for(var t=59,r=e.position+1,n;r<e.length;)if(n=e.data.charCodeAt(r),n===59&&(t===10||t===13)){for(e.position=r+1,e.tokenStart++,r--,n=e.data.charCodeAt(r);n===10||n===13;)r--,n=e.data.charCodeAt(r);e.tokenEnd=r+1,e.isEscaped=!0;return}else(n===13||n===10&&t!==13)&&e.lineNumber++,t=n,++r;return e.position=r,t}function lOe(e){for(;e.position<e.length;)switch(e.data.charCodeAt(e.position)){case 93:++e.position,e.tokenEnd=e.position,e.isImportGet=!1;return;default:++e.position;break}}function cOe(e){for(;e.position<e.length;){var t=e.data.charCodeAt(e.position);if(t===10||t===13)return;++e.position}}function dOe(e){for(var t=10;e.position<e.length;){var r=e.data.charCodeAt(e.position);switch(r){case 9:case 32:t=r,++e.position;break;case 10:t!==13&&++e.lineNumber,t=r,++e.position;break;case 13:t=r,++e.position,++e.lineNumber;break;default:return t}}return t}function pJ(e){return!(e.length-e.position<2||e.data.charCodeAt(e.position+1)!==39||e.data.charCodeAt(e.position+2)!==39)}function fOe(e){var t=e.data.charCodeAt(e.tokenStart);return!(t!==68&&t!==100||(t=e.data.charCodeAt(e.tokenStart+1),t!==65&&t!==97)||(t=e.data.charCodeAt(e.tokenStart+2),t!==84&&t!==116)||(t=e.data.charCodeAt(e.tokenStart+3),t!==65&&t!==97))}function pOe(e){var t=e.data.charCodeAt(e.tokenStart);return!(t!==83&&t!==115||(t=e.data.charCodeAt(e.tokenStart+1),t!==65&&t!==97)||(t=e.data.charCodeAt(e.tokenStart+2),t!==86&&t!==118)||(t=e.data.charCodeAt(e.tokenStart+3),t!==69&&t!==101))}function hOe(e){if(e.tokenEnd-e.tokenStart!==5)return!1;var t=e.data.charCodeAt(e.tokenStart);return!(t!==76&&t!==108||(t=e.data.charCodeAt(e.tokenStart+1),t!==79&&t!==111)||(t=e.data.charCodeAt(e.tokenStart+2),t!==79&&t!==111)||(t=e.data.charCodeAt(e.tokenStart+3),t!==80&&t!==112))}function vOe(e){return!(e.tokenEnd-e.tokenStart!==11||e.data.charCodeAt(e.tokenStart+1)!==105||e.data.charCodeAt(e.tokenStart+2)!==109||e.data.charCodeAt(e.tokenStart+3)!==112||e.data.charCodeAt(e.tokenStart+4)!==111||e.data.charCodeAt(e.tokenStart+5)!==114||e.data.charCodeAt(e.tokenStart+6)!==116||e.data.charCodeAt(e.tokenStart+7)!==46||e.data.charCodeAt(e.tokenStart+8)!==103||e.data.charCodeAt(e.tokenStart+9)!==101||e.data.charCodeAt(e.tokenStart+10)!==116)}function mOe(e,t,r){var n,i=r-t,a=e.tokenStart-t,o=e.tokenEnd-e.tokenStart;if(o<i)return!1;for(n=t;n<r;++n)if(e.data.charCodeAt(n)!==e.data.charCodeAt(n+a))return!1;return i===o||e.data.charCodeAt(n+a)===46}function hJ(e){var t;for(t=e.tokenStart;t<e.tokenEnd;++t)if(e.data.charCodeAt(t)===46)return t;return t}function vJ(e,t){return e.data.substring(e.tokenStart,t)}function gOe(e){var t;for(t=e.tokenStart;t<e.tokenEnd;++t)if(e.data.charCodeAt(t)===46)return!1;return!0}function tD(e){return e.data.substring(e.tokenStart,e.tokenEnd)}function _U(e){var t=dOe(e);if(e.position>=e.length){e.tokenType=6;return}e.tokenStart=e.position,e.tokenEnd=e.position,e.isEscaped=!1;var r=e.data.charCodeAt(e.position);switch(r){case 35:cOe(e),e.tokenType=5;break;case 39:if(pJ(e)){sOe(e),e.tokenType=3;break}case 34:oOe(e,r),e.tokenType=3;break;case 59:t===10||t===13?uOe(e):CU(e),e.tokenType=3;break;default:e.isImportGet?lOe(e):CU(e),e.isEscaped?e.tokenType=3:e.data.charCodeAt(e.tokenStart)===95?(e.inSaveFrame&&vOe(e)&&(e.isImportGet=!0),e.tokenType=4):e.tokenEnd-e.tokenStart>=5&&e.data.charCodeAt(e.tokenStart+4)===95?fOe(e)?e.tokenType=0:pOe(e)?e.tokenType=1:hOe(e)?e.tokenType=2:e.tokenType=3:e.tokenType=3;break}}function ep(e){for(_U(e);e.tokenType===5;)_U(e)}function yOe(e,t){return{data:e,length:e.length,position:0,tokenStart:0,tokenEnd:0,tokenType:6,lineNumber:1,isEscaped:!1,isImportGet:!1,inSaveFrame:!1,runtimeCtx:t}}function xx(){return{categoryNames:[],categoryData:Object.create(null)}}function ML(e,t){for(var r=Object.create(null),n=0,i=e;n<i.length;n++){var a=i[n],o=t[a];r[a]=va(o.name,o.rowCount,o.fieldNames,o.fields)}return r}function wU(e,t,r){return IL(e.categoryNames,ML(e.categoryNames,e.categoryData),t,r)}function bOe(e,t){return IL(e.categoryNames,ML(e.categoryNames,e.categoryData),t)}function rD(e,t,r,n,i){var a;if(t in e.categoryData){var o=e.categoryData[t];(a=o.fieldNames).push.apply(a,n),Object.assign(o.fields,i)}else e.categoryData[t]={name:t,rowCount:r,fieldNames:n,fields:i},e.categoryNames.push(t)}function xOe(e,t){for(var r=e.tokenStart,n=hJ(e),i=vJ(e,n),a=Object.create(null),o=[],s=!0;s;){if(e.tokenType!==4||!mOe(e,r,n)){s=!1;break}var u=tD(e).substring(i.length+1);if(ep(e),e.tokenType!==3)return{hasError:!0,errorLine:e.lineNumber,errorMessage:"Expected value."};a[u]=St.ofTokens({data:e.data,indices:[e.tokenStart,e.tokenEnd],count:1}),o[o.length]=u,ep(e)}return rD(t,i.substr(1),1,o,a),{hasError:!1,errorLine:0,errorMessage:""}}function SOe(e,t){for(var r=t.tokenizer,n=t.tokens,i=t.fieldCount,a=t.tokenCount,o=0;r.tokenType===3&&o<e;)pt.add(n[a++%i],r.tokenStart,r.tokenEnd),ep(r),o++;return t.tokenCount=a,o}function COe(e,t){return e.update({message:"Parsing...",current:t.tokenizer.position,max:t.tokenizer.data.length})}function _Oe(e,t){return ce(this,void 0,void 0,function(){var r,n,i,a,o,s,u,f,l,c,f,d,d,f;return de(this,function(p){switch(p.label){case 0:for(r=e.lineNumber,ep(e),n=vJ(e,hJ(e)),i=gOe(e),a=[];e.tokenType===4;)a[a.length]=i?tD(e):tD(e).substring(n.length+1),ep(e);for(o=n==="_atom_site"?e.data.length/100|0:32,s=[],u=a.length,f=0;f<u;f++)s[f]=pt.create(e.data,o);return l={fieldCount:u,tokenCount:0,tokenizer:e,tokens:s},[4,Zc(e.runtimeCtx,1e6,l,SOe,COe)];case 1:if(p.sent(),l.tokenCount%u!==0)return[2,{hasError:!0,errorLine:e.lineNumber,errorMessage:"The number of values for loop starting at line "+r+" is not a multiple of the number of columns."}];if(c=l.tokenCount/u|0,i)for(f=0;f<u;f++)d={"":St.ofTokens(s[f])},rD(t,a[f].substr(1),c,[""],d);else{for(d=Object.create(null),f=0;f<u;f++)d[a[f]]=St.ofTokens(s[f]);rD(t,n.substr(1),c,a,d)}return[2,{hasError:!1,errorLine:0,errorMessage:""}]}})})}function lm(e,t){return In.error(t,e)}function wOe(e){return In.success(e)}function EOe(e,t){return ce(this,void 0,void 0,function(){var r,n,i,a,o,s,u,l,c,d,d;return de(this,function(f){switch(f.label){case 0:r=[],n=yOe(e,t),i="",a=xx(),o=[],s=xx(),u=rOe(s.categoryNames,ML(s.categoryNames,s.categoryData),""),l="",t.update({message:"Parsing...",current:0,max:e.length}),ep(n),f.label=1;case 1:return n.tokenType===6?[3,7]:(c=n.tokenType,c!==0?[3,2]:n.inSaveFrame?[2,lm(n.lineNumber,"Unexpected data block inside a save frame.")]:(a.categoryNames.length>0&&r.push(wU(a,i,o)),i=e.substring(n.tokenStart+5,n.tokenEnd),a=xx(),o=[],ep(n),[3,6]));case 2:if(c!==1)return[3,3];if(n.tokenEnd-n.tokenStart===5)s.categoryNames.length>0&&(o[o.length]=bOe(s,l)),n.inSaveFrame=!1;else{if(n.inSaveFrame)return[2,lm(n.lineNumber,"Save frames cannot be nested.")];n.inSaveFrame=!0,l=e.substring(n.tokenStart+5,n.tokenEnd),s=xx()}return ep(n),[3,6];case 3:return c!==2?[3,5]:[4,_Oe(n,n.inSaveFrame?s:a)];case 4:return d=f.sent(),d.hasError?[2,lm(d.errorLine,d.errorMessage)]:[3,6];case 5:if(c===4){if(d=xOe(n,n.inSaveFrame?s:a),d.hasError)return[2,lm(d.errorLine,d.errorMessage)]}else return console.log(n.tokenType,It.getTokenString(n)),[2,lm(n.lineNumber,"Unexpected token. Expected data_, loop_, or data name.")];f.label=6;case 6:return[3,1];case 7:return n.inSaveFrame?[2,lm(n.lineNumber,"Unfinished save frame ("+u.header+").")]:((a.categoryNames.length>0||o.length>0)&&r.push(wU(a,i,o)),[2,wOe(fJ(r))])}})})}function EU(e){var t=this;return $e.create("Parse CIF",function(r){return ce(t,void 0,void 0,function(){return de(this,function(n){switch(n.label){case 0:return[4,EOe(e,r)];case 1:return[2,n.sent()]}})})})}var AOe=new Uint16Array(new Uint8Array([18,52]).buffer)[0]===13330;function POe(e,t){for(var r=new ArrayBuffer(e.length),n=new Uint8Array(r),i=0,a=e.length;i<a;i+=t)for(var o=0;o<t;o++)n[i+t-o-1]=e[i+o];return r}var _4=28672;function TOe(e){if(e.length>_4){for(var t=[],r=0;r<e.length;r+=_4)t.push(String.fromCharCode.apply(null,e.subarray(r,r+_4)));return t.join("")}else return String.fromCharCode.apply(null,e)}function V_(e){for(var t=e.data,r=e.encoding.length-1;r>=0;r--)t=IOe(t,e.encoding[r]);return t}function IOe(e,t){switch(t.kind){case"ByteArray":switch(t.type){case 4:return e;case 1:return MOe(e);case 2:return DOe(e);case 5:return ROe(e);case 3:return kOe(e);case 6:return OOe(e);case 32:return LOe(e);case 33:return FOe(e);default:throw new Error("Unsupported ByteArray type.")}case"FixedPoint":return NOe(e,t);case"IntervalQuantization":return BOe(e,t);case"RunLength":return UOe(e,t);case"Delta":return jOe(e,t);case"IntegerPacking":return HOe(e,t);case"StringArray":return GOe(e,t)}}function mJ(e,t){switch(e){case 1:return new Int8Array(t);case 2:return new Int16Array(t);case 3:return new Int32Array(t);case 4:return new Uint8Array(t);case 5:return new Uint16Array(t);case 6:return new Uint32Array(t);default:throw new Error("Unsupported integer data type.")}}function gJ(e,t){switch(e){case 32:return new Float32Array(t);case 33:return new Float64Array(t);default:throw new Error("Unsupported floating data type.")}}function MOe(e){return new Int8Array(e.buffer,e.byteOffset)}function C0(e,t,r){return AOe?new r(e.buffer):new r(POe(e,t))}function DOe(e){return C0(e,2,Int16Array)}function ROe(e){return C0(e,2,Uint16Array)}function kOe(e){return C0(e,4,Int32Array)}function OOe(e){return C0(e,4,Uint32Array)}function LOe(e){return C0(e,4,Float32Array)}function FOe(e){return C0(e,8,Float64Array)}function NOe(e,t){for(var r=e.length,n=gJ(t.srcType,r),i=1/t.factor,a=0;a<r;a++)n[a]=i*e[a];return n}function BOe(e,t){for(var r=e.length,n=gJ(t.srcType,r),i=(t.max-t.min)/(t.numSteps-1),a=t.min,o=0;o<r;o++)n[o]=a+i*e[o];return n}function UOe(e,t){for(var r=mJ(t.srcType,t.srcSize),n=0,i=0,a=e.length;i<a;i+=2)for(var o=e[i],s=e[i+1],u=0;u<s;++u)r[n++]=o;return r}function jOe(e,t){var r=e.length,n=mJ(t.srcType,r);if(!r)return e;n[0]=e[0]+(t.origin|0);for(var i=1;i<r;++i)n[i]=e[i]+n[i-1];return n}function zOe(e,t){for(var r=t.byteCount===1?127:32767,n=-r-1,i=e.length,a=new Int32Array(t.srcSize),o=0,s=0;o<i;){for(var u=0,l=e[o];l===r||l===n;)u+=l,o++,l=e[o];u+=l,a[s]=u,o++,s++}return a}function VOe(e,t){for(var r=t.byteCount===1?255:65535,n=e.length,i=new Int32Array(t.srcSize),a=0,o=0;a<n;){for(var s=0,u=e[a];u===r;)s+=u,a++,u=e[a];s+=u,i[o]=s,a++,o++}return i}function HOe(e,t){return e.length===t.srcSize?e:t.isUnsigned?VOe(e,t):zOe(e,t)}function GOe(e,t){var r=V_({encoding:t.offsetEncoding,data:t.offsets}),n=V_({encoding:t.dataEncoding,data:e}),i=t.stringData,a=new Array(r.length);a[0]="";for(var o=1,s=r.length;o<s;o++)a[o]=i.substring(r[o-1],r[o]);for(var u=0,l=new Array(n.length),o=0,s=n.length;o<s;o++)l[u++]=a[n[o]+1];return l}var qOe="0.3.0",lf;(function(e){function t(n){var i;return n instanceof Int8Array?i=1:n instanceof Int16Array?i=2:n instanceof Int32Array?i=3:n instanceof Uint8Array?i=4:n instanceof Uint16Array?i=5:n instanceof Uint32Array?i=6:n instanceof Float32Array?i=32:n instanceof Float64Array?i=33:i=3,i}e.getDataType=t;function r(n){if(n instanceof Int8Array||n instanceof Int16Array||n instanceof Int32Array)return!0;for(var i=0,a=n.length;i<a;i++)if(i<0)return!1;return!0}e.isSignedIntegerDataType=r})(lf||(lf={}));function $Oe(e,t,r){var n=1,i;for(i=0;i<t;i++){var a=n*e;if(Math.abs(Math.round(a)-a)<=r)return i;n*=10}return-1}function WOe(e,t){var r=Math.abs(e);return r<t?0:Math.floor(Math.log10(Math.abs(e)))+1}function XOe(e,t,r){for(var n=1,i=0,a=0,o=e.length;a<o;a++){if(n>=0){var s=$Oe(e[a],t,r);s<0?n=-1:s>n&&(n=s)}var u=Math.abs(e[a]);if(u>r){var l=Math.floor(Math.log10(Math.abs(u)))+1;l>i&&(i=l)}}return{mantissaDigits:n,integerDigits:i}}function YOe(e){e=e.trim();var t=parseInt(e,10);return isNaN(t)?!1:t.toString()===e}function H_(e){if(!isFinite(e))return 0;for(var t=1,r=0;Math.round(e*t)/t!==e;)t*=10,++r;return r}function nD(e,t){return parseFloat(e.toPrecision(t))}function iD(e){return _b.classify(e)}function KOe(e){return aD.classify(e)}var _b;(function(e){function t(p,v){return p>=0?Math.ceil((p+1)/v):Math.ceil((p+1)/(-v-1))}function r(p){for(var v=!1,h=0,m=p.length;h<m;h++)if(p[h]<0){v=!0;break}return v?{signed:v,limit8:127,limit16:32767}:{signed:v,limit8:255,limit16:65535}}function n(){return{pack8:0,pack16:0,count:0}}function i(p,v,h){var m=p.limit8,g=p.limit16;v.pack8+=t(h,m),v.pack16+=t(h,g),v.count+=1}function a(p,v){p.pack8+=t(v,127),p.pack16+=t(v,32767),p.count+=1}function o(p){return p.count*4<p.pack16*2?{length:p.count*4,elem:4}:p.pack16*2<p.pack8?{length:p.pack16*2,elem:2}:{length:p.pack8,elem:1}}function s(p,v){for(var h=n(),m=0,g=p.length;m<g;m++)i(v,h,p[m]);return E(E({},o(h)),{kind:"pack"})}function u(p,v){for(var h=n(),m=p[0],g=1,y=p.length;g<y;g++)a(h,p[g]-m),m=p[g];return E(E({},o(h)),{kind:"delta"})}function l(p,v){for(var h=n(),m=1,g=1,y=p.length;g<y;g++)p[g-1]!==p[g]?(i(v,h,p[g-1]),i(v,h,m),m=1):m++;return i(v,h,p[p.length-1]),i(v,h,m),E(E({},o(h)),{kind:"rle"})}function c(p,v){for(var h=n(),m=1,g=0,y=0,b=1,S=p.length;b<S;b++){var x=p[b]-g;y!==x?(a(h,y),a(h,m),m=1):m++,y=x,g=p[b]}return a(h,y),a(h,m),E(E({},o(h)),{kind:"delta-rle"})}function d(p){var v=r(p),h=[s(p,v),l(p,v),u(p),c(p)];return h.sort(function(m,g){return m.length-g.length}),h}e.getSize=d;function f(p){if(p.length<2)return br.by(br.byteArray);var v=d(p),h=v[0];switch(h.kind){case"pack":return br.by(br.integerPacking);case"rle":return br.by(br.runLength).and(br.integerPacking);case"delta":return br.by(br.delta).and(br.integerPacking);case"delta-rle":return br.by(br.delta).and(br.runLength).and(br.integerPacking)}throw new Error("should not happen :)")}e.classify=f})(_b||(_b={}));var aD;(function(e){var t=1e-6;function r(i){var a=4,o=XOe(i,a,t),s=o.mantissaDigits,u=o.integerDigits;if(s<0||s+u>10)return br.by(br.byteArray);if(s===0)return _b.classify(i);for(var l=n(s),c=new Int32Array(i.length),d=0,f=i.length;d<f;d++)c[d]=Math.round(l*i[d]);var p=_b.getSize(c),v=p[0],h=br.by(br.fixedPoint(l));switch(v.kind){case"pack":return h.and(br.integerPacking);case"rle":return h.and(br.runLength).and(br.integerPacking);case"delta":return h.and(br.delta).and(br.integerPacking);case"delta-rle":return h.and(br.delta).and(br.runLength).and(br.integerPacking)}throw new Error("should not happen :)")}e.classify=r;function n(i){for(var a=1,o=0;o<i;o++)a*=10;return a}})(aD||(aD={}));var yJ=function(){function e(t){this.providers=t}return e.prototype.and=function(t){return new e(this.providers.concat([t]))},e.prototype.encode=function(t){for(var r=[],n=0,i=this.providers;n<i.length;n++){var a=i[n],o=a(t);if(!o.encodings.length)throw new Error("Encodings must be non-empty.");t=o.data;for(var s=0,u=o.encodings;s<u.length;s++){var l=u[s];r.push(l)}}if(!(t instanceof Uint8Array))throw new Error("The encoding must result in a Uint8Array. Fix your encoding chain.");return{encoding:r,data:t}},e}(),pp;(function(e){function t(i){return new yJ([i])}e.by=t;function r(i){for(var a=t(n(i[0])),o=1;o<i.length;o++)a=a.and(n(i[o]));return a}e.fromEncoding=r;function n(i){switch(i.kind){case"ByteArray":return br.byteArray;case"FixedPoint":return br.fixedPoint(i.factor);case"IntervalQuantization":return br.intervalQuantizaiton(i.min,i.max,i.numSteps);case"RunLength":return br.runLength;case"Delta":return br.delta;case"IntegerPacking":return br.integerPacking;case"StringArray":return br.stringArray}}})(pp||(pp={}));var br;(function(e){var t,r;function n(x){return new yJ([x])}e.by=n;function i(x){return{encodings:[{kind:"ByteArray",type:4}],data:x}}function a(x){return{encodings:[{kind:"ByteArray",type:1}],data:new Uint8Array(x.buffer,x.byteOffset)}}var o=(t={},t[2]=function(x,C,w){x.setInt16(2*C,w,!0)},t[5]=function(x,C,w){x.setUint16(2*C,w,!0)},t[3]=function(x,C,w){x.setInt32(4*C,w,!0)},t[6]=function(x,C,w){x.setUint32(4*C,w,!0)},t[32]=function(x,C,w){x.setFloat32(4*C,w,!0)},t[33]=function(x,C,w){x.setFloat64(8*C,w,!0)},t),s=(r={},r[2]=2,r[5]=2,r[3]=4,r[6]=4,r[32]=4,r[33]=8,r);function u(x){var C=lf.getDataType(x);if(C===1)return a(x);if(C===4)return i(x);for(var w=new Uint8Array(x.length*s[C]),A=o[C],M=new DataView(w.buffer),D=0,k=x.length;D<k;D++)A(M,D,x[D]);return{encodings:[{kind:"ByteArray",type:C}],data:w}}e.byteArray=u;function l(x,C){for(var w=lf.getDataType(x),A=new Int32Array(x.length),M=0,D=x.length;M<D;M++)A[M]=Math.round(x[M]*C);return{encodings:[{kind:"FixedPoint",factor:C,srcType:w}],data:A}}function c(x){return function(C){return l(C,x)}}e.fixedPoint=c;function d(x,C,w,A,M){var D=lf.getDataType(x);if(!x.length)return{encodings:[{kind:"IntervalQuantization",min:C,max:w,numSteps:A,srcType:D}],data:new Int32Array(0)};if(w<C){var k=C;C=w,w=k}for(var R=(w-C)/(A-1),O=new M(x.length),H=0,B=x.length;H<B;H++){var j=x[H];j<=C?O[H]=0:j>=w?O[H]=A-1:O[H]=Math.round((j-C)/R)|0}return{encodings:[{kind:"IntervalQuantization",min:C,max:w,numSteps:A,srcType:D}],data:O}}function f(x,C,w,A){return A===void 0&&(A=Int32Array),function(M){return d(M,x,C,w,A)}}e.intervalQuantizaiton=f;function p(x){var C=lf.getDataType(x);if(C===void 0&&(x=new Int32Array(x),C=3),!x.length)return{encodings:[{kind:"RunLength",srcType:C,srcSize:0}],data:new Int32Array(0)};for(var w=2,A=1,M=x.length;A<M;A++)x[A-1]!==x[A]&&(w+=2);for(var D=new Int32Array(w),k=0,R=1,A=1,M=x.length;A<M;A++)x[A-1]!==x[A]?(D[k]=x[A-1],D[k+1]=R,R=1,k+=2):++R;return D[k]=x[x.length-1],D[k+1]=R,{encodings:[{kind:"RunLength",srcType:C,srcSize:x.length}],data:D}}e.runLength=p;function v(x){if(!lf.isSignedIntegerDataType(x))throw new Error("Only signed integer types can be encoded using delta encoding.");var C=lf.getDataType(x);if(C===void 0&&(x=new Int32Array(x),C=3),!x.length)return{encodings:[{kind:"Delta",origin:0,srcType:C}],data:new x.constructor(0)};var w=new x.constructor(x.length),A=x[0];w[0]=x[0];for(var M=1,D=x.length;M<D;M++)w[M]=x[M]-x[M-1];return w[0]=0,{encodings:[{kind:"Delta",origin:A,srcType:C}],data:w}}e.delta=v;function h(x){for(var C=0,w=x.length;C<w;C++)if(x[C]<0)return!0;return!1}function m(x,C){for(var w=-C-1,A=0,M=0,D=x.length;M<D;M++){var k=x[M];k===0?A+=1:k>0?(A+=Math.ceil(k/C),k%C===0&&(A+=1)):(A+=Math.ceil(k/w),k%w===0&&(A+=1))}return A}function g(x){var C=h(x),w=C?m(x,127):m(x,255),A=C?m(x,32767):m(x,65535);return x.length*4<A*2?{isSigned:C,size:x.length,bytesPerElement:4}:A*2<w?{isSigned:C,size:A,bytesPerElement:2}:{isSigned:C,size:w,bytesPerElement:1}}function y(x,C){for(var w=C.isSigned?C.bytesPerElement===1?127:32767:C.bytesPerElement===1?255:65535,A=-w-1,M=x.length,D=C.isSigned?C.bytesPerElement===1?new Int8Array(C.size):new Int16Array(C.size):C.bytesPerElement===1?new Uint8Array(C.size):new Uint16Array(C.size),k=0,R=0;R<M;R++){var O=x[R];if(O>=0)for(;O>=w;)D[k]=w,++k,O-=w;else for(;O<=A;)D[k]=A,++k,O-=A;D[k]=O,++k}var H=u(D);return{encodings:[{kind:"IntegerPacking",byteCount:C.bytesPerElement,isUnsigned:!C.isSigned,srcSize:M},H.encodings[0]],data:H.data}}function b(x){var C=g(x);return C.bytesPerElement===4?u(x):y(x,C)}e.integerPacking=b;function S(x){var C=Object.create(null),w=[],A=new Int32Array(x.length),M=qe.create(Int32Array,1,Math.min(1024,x.length<32?x.length+1:Math.round(x.length/8)+1));qe.add(M,0);for(var D=0,k=0,R=0,O=x;R<O.length;R++){var H=O[R];if(H==null){A[k++]=-1;continue}var B=C[H];B===void 0&&(D+=H.length,B=w.length,w[B]=H,C[H]=B,qe.add(M,D)),A[k++]=B}var j=qe.compact(M),Y=iD(j),G=Y.encode(j),$=iD(A),q=$.encode(A);return{encodings:[{kind:"StringArray",dataEncoding:q.encoding,stringData:w.join(""),offsetEncoding:G.encoding,offsets:G.data}],data:q.data}}e.stringArray=S})(br||(br={}));function QOe(e){var t=e.mask?V_(e.mask):void 0,r=V_(e.data),n=KO(r),i=n?t?function(l){return t[l]===0?""+r[l]:""}:function(l){return""+r[l]}:t?function(l){return t[l]===0?r[l]:""}:function(l){return r[l]},a=n?function(l){return r[l]}:function(l){var c=r[l];return Zf(c,0,c.length)},o=n?function(l){return r[l]}:function(l){var c=r[l];return Lc(c,0,c.length)},s=t?function(l){return t[l]}:function(l){return 0},u=r.length;return{__array:r,binaryEncoding:e.data.encoding,isDefined:!0,rowCount:u,str:i,int:a,float:o,valueKind:s,areValuesEqual:function(l,c){return r[l]===r[c]},toStringArray:function(l){return ia(u,i,l)},toIntArray:n?function(l){return P_(r,l)}:function(l){return ia(u,a,l)},toFloatArray:n?function(l){return P_(r,l)}:function(l){return ia(u,o,l)}}}function bJ(e){return G_({buffer:e,offset:0,dataView:new DataView(e.buffer)})}function w4(e,t){for(var r={},n=0;n<t;n++){var i=G_(e);r[i]=G_(e)}return r}function E4(e,t){for(var r=new Uint8Array(t),n=e.offset,i=0;i<t;i++)r[i]=e.buffer[i+n];return e.offset+=t,r}function Sx(e,t){var r=oL(e.buffer,e.offset,t);return e.offset+=t,r}function A4(e,t){for(var r=new Array(t),n=0;n<t;n++)r[n]=G_(e);return r}function G_(e){var t=e.buffer[e.offset],r,n;if(!(t&128))return e.offset++,t;if((t&240)===128)return n=t&15,e.offset++,w4(e,n);if((t&240)===144)return n=t&15,e.offset++,A4(e,n);if((t&224)===160)return n=t&31,e.offset++,Sx(e,n);if((t&224)===224)return r=e.dataView.getInt8(e.offset),e.offset++,r;switch(t){case 192:return e.offset++,null;case 194:return e.offset++,!1;case 195:return e.offset++,!0;case 196:return n=e.dataView.getUint8(e.offset+1),e.offset+=2,E4(e,n);case 197:return n=e.dataView.getUint16(e.offset+1),e.offset+=3,E4(e,n);case 198:return n=e.dataView.getUint32(e.offset+1),e.offset+=5,E4(e,n);case 202:return r=e.dataView.getFloat32(e.offset+1),e.offset+=5,r;case 203:return r=e.dataView.getFloat64(e.offset+1),e.offset+=9,r;case 204:return r=e.buffer[e.offset+1],e.offset+=2,r;case 205:return r=e.dataView.getUint16(e.offset+1),e.offset+=3,r;case 206:return r=e.dataView.getUint32(e.offset+1),e.offset+=5,r;case 208:return r=e.dataView.getInt8(e.offset+1),e.offset+=2,r;case 209:return r=e.dataView.getInt16(e.offset+1),e.offset+=3,r;case 210:return r=e.dataView.getInt32(e.offset+1),e.offset+=5,r;case 217:return n=e.dataView.getUint8(e.offset+1),e.offset+=2,Sx(e,n);case 218:return n=e.dataView.getUint16(e.offset+1),e.offset+=3,Sx(e,n);case 219:return n=e.dataView.getUint32(e.offset+1),e.offset+=5,Sx(e,n);case 220:return n=e.dataView.getUint16(e.offset+1),e.offset+=3,A4(e,n);case 221:return n=e.dataView.getUint32(e.offset+1),e.offset+=5,A4(e,n);case 222:return n=e.dataView.getUint16(e.offset+1),e.offset+=3,w4(e,n);case 223:return n=e.dataView.getUint32(e.offset+1),e.offset+=5,w4(e,n)}throw new Error("Unknown type 0x"+t.toString(16))}function ZOe(e,t){for(var r=0;r<2;r++)if(e[r]>t[r])return!1;return!0}function JOe(e){for(var t=Object.create(null),r=Object.create(null),n=0,i=e.columns;n<i.length;n++){var a=i[n];t[a.name]=a}return{rowCount:e.rowCount,name:e.name.substr(1),fieldNames:e.columns.map(function(o){return o.name}),getField:function(o){var s=t[o];if(s)return r[o]||(r[o]=QOe(s)),r[o]}}}function AU(e){var t=this;return $e.create("Parse BinaryCIF",function(r){return ce(t,void 0,void 0,function(){var n,i,a;return de(this,function(o){n=[0,3];try{return i=bJ(e),ZOe(n,i.version.match(/(\d)\.(\d)\.\d/).slice(1).map(function(s){return+s}))?(a=fJ(i.dataBlocks.map(function(s){for(var u=Object.create(null),l=0,c=s.categories;l<c.length;l++){var d=c[l];u[d.name.substr(1)]=JOe(d)}return IL(s.categories.map(function(f){return f.name.substr(1)}),u,s.header)})),[2,In.success(a)]):[2,In.error("Unsupported format version. Current "+i.version+", required "+n.join(".")+".")]}catch(s){return[2,In.error(""+s)]}return[2]})})})}var bg;(function(e){function t(i){return i.replace(".","_").replace(/\[/,"_").replace(/(\[|\])/g,"")}e.canonical=t;function r(i,a){return t(i)===t(a)}e.equal=r;function n(i,a,o){o===void 0&&(o=!1);var s=""+i+(a?"."+a:"");return o?t(s):s}e.create=n})(bg||(bg={}));function eLe(e,t,r){for(var n={},i=0,a=t.blocks;i<a.length;i++){var o=a[i];n[o.header]=pc(e,o,r)}return n}function pc(e,t,r){return iLe(e,t,r)}function xJ(e,t){return new SJ(t,e,!0)}function tLe(e){switch(e.valueType){case"str":return function(t,r,n){return P4(e,t,t.str,t.toStringArray)};case"int":return function(t,r,n){return P4(e,t,t.int,t.toIntArray)};case"float":return function(t,r,n){return P4(e,t,t.float,t.toFloatArray)};case"list":throw new Error("Use createListColumn instead.");case"tensor":throw new Error("Use createTensorColumn instead.")}}function P4(e,t,r,n){return{schema:e,__array:t.__array,isDefined:t.isDefined,rowCount:t.rowCount,value:r,valueKind:t.valueKind,areValuesEqual:t.areValuesEqual,toArray:n}}function rLe(e,t,r){var n=e.separator,i=e.itemParse,a=t.getField(r),o=a?function(u){return a.str(u).split(n).map(function(l){return i(l.trim())}).filter(function(l){return!!l})}:function(u){return[]},s=function(u){return ia(t.rowCount,o,u)};return{schema:e,__array:void 0,isDefined:!!a,rowCount:t.rowCount,value:o,valueKind:a?a.valueKind:function(){return 1},areValuesEqual:function(u,l){return no(o(u),o(l))},toArray:s}}function nLe(e,t,r){var n=e.space,i=t.fieldNames.includes(r+"[0]")||t.fieldNames.includes(r+"[0][0]")||t.fieldNames.includes(r+"[0][0][0]"),a=i?0:1,o=t.fieldNames.includes(r+"_1")||t.fieldNames.includes(r+"_11")||t.fieldNames.includes(r+"_111")?"underscore":"brackets",s=nOe(r,n.rank,i,o),u=t.getField(s(a,a,a))||ve.Undefined(t.rowCount,e),l=function(d){return iOe(t,n,d,s)},c=function(d){return ia(t.rowCount,l,d)};return{schema:e,__array:void 0,isDefined:u.isDefined,rowCount:t.rowCount,value:l,valueKind:u.valueKind,areValuesEqual:function(d,f){return Mr.areEqualExact(l(d),l(f))},toArray:c}}var SJ=function(){function e(t,r,n){this._isDefined=n;var i=Object.keys(r);this._rowCount=t.rowCount,this._columns=i,this._schema=r;for(var a=Object.create(null),o=function(d){Object.defineProperty(s,d,{get:function(){if(a[d])return a[d];var f=r[d];if(f.valueType==="list")a[d]=rLe(f,t,d);else if(f.valueType==="tensor")a[d]=nLe(f,t,d);else{var p=tLe(f),v=t.getField(d);a[d]=v?p(v,t,d):ve.Undefined(t.rowCount,f)}return a[d]},enumerable:!0,configurable:!1})},s=this,u=0,l=i;u<l.length;u++){var c=l[u];o(c)}}return e}();function iLe(e,t,r){for(var n=Object.create(null),i=0,a=Object.keys(e);i<a.length;i++){var o=a[i];n[o]=sLe(o,e[o],t,r)}return C5.ofTables(t.header,e,n)}function aLe(e){for(var t=Object.create(null),r=0,n=Object.keys(e.categories);r<n.length;r++)for(var i=n[r],a=0,o=e.categories[i].fieldNames;a<o.length;a++){var s=o[a],u=bg.create(i,s,!0);t[u]=e.categories[i].getField(s)}return t}function oLe(e,t,r,n){var i=bg.create(t,e),a=bg.canonical(i);if(a in r)return r[a];if(n&&i in n)for(var o=0,s=n[i];o<s.length;o++){var u=s[o],l=bg.canonical(u);if(l in r)return r[l]}}function sLe(e,t,r,n){var i=r.categories[e];if(n){for(var a=aLe(r),o=Object.create(null),s=[],u=0,l=0,c=Object.keys(t);l<c.length;l++){var d=c[l],f=oLe(d,e,a,n);f&&(o[d]=f,s.push(d),u=f.rowCount)}i={rowCount:u,name:e,fieldNames:Nt([],s),getField:function(p){return o[p]}}}return new SJ(i||va.empty(e),t,!!i)}var _0=ve.Schema,Dr=_0.str,uLe=_0.float,PU=_0.List,No=_0.Aliased,sy=_0.int,cm=_0.coord,lLe={chem_comp:{formula:Dr,formula_weight:uLe,id:Dr,mon_nstd_parent_comp_id:PU(",",function(e){return e}),name:Dr,one_letter_code:Dr,three_letter_code:Dr,type:No(Dr),pdbx_synonyms:PU(";",function(e){return e}),pdbx_type:Dr,pdbx_ambiguous_flag:Dr,pdbx_replaced_by:Dr,pdbx_replaces:Dr,pdbx_formal_charge:sy,pdbx_model_coordinates_details:Dr,pdbx_model_coordinates_db_code:Dr,pdbx_ideal_coordinates_details:Dr,pdbx_ideal_coordinates_missing_flag:No(Dr),pdbx_model_coordinates_missing_flag:No(Dr),pdbx_initial_date:Dr,pdbx_modified_date:Dr,pdbx_release_status:No(Dr),pdbx_processing_site:No(Dr)},chem_comp_atom:{alt_atom_id:Dr,atom_id:Dr,charge:sy,model_Cartn_x:cm,model_Cartn_y:cm,model_Cartn_z:cm,comp_id:Dr,type_symbol:Dr,pdbx_align:sy,pdbx_ordinal:sy,pdbx_model_Cartn_x_ideal:cm,pdbx_model_Cartn_y_ideal:cm,pdbx_model_Cartn_z_ideal:cm,pdbx_stereo_config:No(Dr),pdbx_aromatic_flag:No(Dr),pdbx_leaving_atom_flag:No(Dr)},chem_comp_bond:{atom_id_1:Dr,atom_id_2:Dr,comp_id:Dr,value_order:No(Dr),pdbx_ordinal:sy,pdbx_stereo_config:No(Dr),pdbx_aromatic_flag:No(Dr)},pdbx_chem_comp_descriptor:{comp_id:Dr,descriptor:Dr,type:No(Dr),program:Dr,program_version:Dr},pdbx_chem_comp_identifier:{comp_id:Dr,identifier:Dr,type:No(Dr),program:Dr,program_version:Dr}},AE=ve.Schema,jt=AE.str,cLe=AE.float,Ka=AE.Aliased,gs=AE.int,dLe={pdbx_reference_molecule:{prd_id:jt,formula_weight:cLe,formula:jt,type:Ka(jt),type_evidence_code:jt,class:Ka(jt),class_evidence_code:jt,name:jt,represent_as:Ka(jt),chem_comp_id:jt,compound_details:jt,description:jt,representative_PDB_id_code:jt,release_status:Ka(jt),replaces:jt,replaced_by:jt},pdbx_reference_entity_list:{prd_id:jt,ref_entity_id:jt,type:Ka(jt),details:jt,component_id:gs},pdbx_reference_entity_nonpoly:{prd_id:jt,ref_entity_id:jt,name:jt,chem_comp_id:jt},pdbx_reference_entity_link:{link_id:gs,prd_id:jt,details:jt,ref_entity_id_1:jt,ref_entity_id_2:jt,entity_seq_num_1:gs,entity_seq_num_2:gs,comp_id_1:jt,comp_id_2:jt,atom_id_1:jt,atom_id_2:jt,value_order:Ka(jt),component_1:gs,component_2:gs,link_class:Ka(jt)},pdbx_reference_entity_poly_link:{link_id:gs,prd_id:jt,ref_entity_id:jt,component_id:gs,entity_seq_num_1:gs,entity_seq_num_2:gs,comp_id_1:jt,comp_id_2:jt,atom_id_1:jt,atom_id_2:jt,value_order:Ka(jt)},pdbx_reference_entity_poly:{prd_id:jt,ref_entity_id:jt,type:Ka(jt),db_code:jt,db_name:jt},pdbx_reference_entity_poly_seq:{prd_id:jt,ref_entity_id:jt,mon_id:jt,parent_mon_id:jt,num:gs,observed:Ka(jt),hetero:Ka(jt)},pdbx_reference_entity_sequence:{prd_id:jt,ref_entity_id:jt,type:Ka(jt),NRP_flag:Ka(jt),one_letter_codes:jt},pdbx_reference_entity_src_nat:{prd_id:jt,ref_entity_id:jt,ordinal:gs,organism_scientific:jt,taxid:jt,db_code:jt,db_name:jt},pdbx_prd_audit:{prd_id:jt,date:jt,processing_site:Ka(jt),action_type:Ka(jt)}},CJ=ve.Schema,bi=CJ.str,fLe=CJ.float,pLe={id:bi,description:bi},hLe={title:bi,datablock_id:bi,version:bi},vLe={version:bi,update:bi,revision:bi},mLe={id:bi,description:bi},gLe={id:bi,parent_id:bi,description:bi},yLe={code:bi,primitive_code:bi,construct:bi,detail:bi},bLe={code:bi,detail:bi},xLe={from_code:bi,to_code:bi,operator:bi,factor:fLe},SLe={datablock:pLe,dictionary:hLe,dictionary_history:vLe,sub_category:mLe,category_group_list:gLe,item_type_list:yLe,item_units_list:bLe,item_units_conversion:xLe},s2=ve.Schema,ol=s2.str,Cx=s2.int,Jl=s2.float,_x=s2.Aliased,cf=s2.Vector;_x(ol),_x(ol),_x(ol),_x(ol),cf(3),cf(3);var CLe={volume_data_3d_info:{name:ol,axis_order:cf(3,Cx),origin:cf(3),dimensions:cf(3),sample_rate:Cx,sample_count:cf(3,Cx),spacegroup_number:Cx,spacegroup_cell_size:cf(3),spacegroup_cell_angles:cf(3),mean_source:Jl,mean_sampled:Jl,sigma_source:Jl,sigma_sampled:Jl,min_source:Jl,min_sampled:Jl,max_source:Jl,max_sampled:Jl},volume_data_3d:{values:Jl}},PE=ve.Schema,T4=PE.int,gn=PE.float,fn=PE.str,TU=PE.Matrix,_Le={cell:{formula_units_Z:T4,volume:gn,angle_alpha:gn,angle_beta:gn,angle_gamma:gn,length_a:gn,length_b:gn,length_c:gn},chemical:{melting_point:gn,name_common:fn,name_systematic:fn},chemical_formula:{moiety:fn,sum:fn,weight:gn},space_group:{crystal_system:fn,IT_number:T4,"name_H-M_full":fn},space_group_symop:{operation_xyz:fn},geom_bond:{atom_site_label_1:fn,atom_site_label_2:fn,distance:gn,publ_flag:fn,site_symmetry_1:fn,site_symmetry_2:fn,valence:gn},audit:{block_doi:fn},database_code:{COD:fn,CSD:fn,depnum_ccdc_archive:fn,depnum_ccdc_fiz:fn,ICSD:fn,MDF:fn,NBS:fn},atom_site:{adp_type:fn,calc_flag:fn,disorder_assembly:fn,disorder_group:fn,fract_x:gn,fract_y:gn,fract_z:gn,label:fn,occupancy:gn,refinement_flags:fn,site_symmetry_multiplicity:T4,type_symbol:fn,U_iso_or_equiv:gn},atom_site_aniso:{label:fn,U_11:gn,U:TU(3,3),U_11_su:gn,U_su:TU(3,3),U_12:gn,U_12_su:gn,U_13:gn,U_13_su:gn,U_22:gn,U_22_su:gn,U_23:gn,U_23_su:gn,U_33:gn,U_33_su:gn},atom_type:{description:fn,symbol:fn},atom_type_scat:{dispersion_imag:gn,dispersion_real:gn,source:fn}},wLe={"atom_site_aniso.U":["atom_site_anisotrop_U"],"atom_site_aniso.U_su":["atom_site_aniso_U_esd","atom_site_anisotrop_U_esd"],"space_group.IT_number":["symmetry_Int_Tables_number"],"space_group.name_H-M_full":["symmetry_space_group_name_H-M"],"space_group_symop.operation_xyz":["symmetry_equiv_pos_as_xyz"],"geom_bond.atom_site_label_1":["geom_bond_atom_site_id_1"],"geom_bond.atom_site_label_2":["geom_bond_atom_site_id_2"],"geom_bond.distance":["geom_bond_dist"],"atom_site.adp_type":["atom_site_thermal_displace_type"],"atom_site.label":["atom_site_id"],"atom_site.site_symmetry_multiplicity":["atom_site_symmetry_multiplicity"],"atom_site_aniso.label":["atom_site_anisotrop_id"],"atom_site_aniso.U_11":["atom_site_anisotrop_U_11"],"atom_site_aniso.U_11_su":["atom_site_aniso_U_11_esd","atom_site_anisotrop_U_11_esd"],"atom_site_aniso.U_12":["atom_site_anisotrop_U_12"],"atom_site_aniso.U_12_su":["atom_site_aniso_U_12_esd","atom_site_anisotrop_U_12_esd"],"atom_site_aniso.U_13":["atom_site_anisotrop_U_13"],"atom_site_aniso.U_13_su":["atom_site_aniso_U_13_esd","atom_site_anisotrop_U_13_esd"],"atom_site_aniso.U_22":["atom_site_anisotrop_U_22"],"atom_site_aniso.U_22_su":["atom_site_aniso_U_22_esd","atom_site_anisotrop_U_22_esd"],"atom_site_aniso.U_23":["atom_site_anisotrop_U_23"],"atom_site_aniso.U_23_su":["atom_site_aniso_U_23_esd","atom_site_anisotrop_U_23_esd"],"atom_site_aniso.U_33":["atom_site_anisotrop_U_33"],"atom_site_aniso.U_33_su":["atom_site_aniso_U_33_esd","atom_site_anisotrop_U_33_esd"]},td={parse:function(e){return typeof e=="string"?EU(e):AU(e)},parseText:EU,parseBinary:AU,toDatabaseCollection:eLe,toDatabase:pc,schema:{mmCIF:function(e){return pc(yr,e)},CCD:function(e){return pc(lLe,e)},BIRD:function(e){return pc(dLe,e)},dic:function(e){return pc(SLe,e)},cifCore:function(e){return pc(_Le,e,wLe)},densityServer:function(e){return pc(CLe,e)}}},oD=function(){function e(t,r,n){this.operatorsProvider=n,this.id=t,this.details=r}return Object.defineProperty(e.prototype,"operatorGroups",{get:function(){return this._operators?this._operators:(this._operators=this.operatorsProvider(),this._operators)},enumerable:!1,configurable:!0}),e}();(function(e){function t(r,n,i){return new e(r,n,i)}e.create=t})(oD||(oD={}));var wb;(function(e){e.Default={assemblies:[],spacegroup:Vu.ZeroP1,isNonStandardCrystalFrame:!1};function t(n,i){var a=i.toLocaleLowerCase(),o=fi.Provider.get(n);return o?QO(o.assemblies,function(s){return s.id.toLowerCase()===a}):void 0}e.findAssembly=t;function r(n){var i=n.spacegroup,a=i.cell,o=i.name,s=i.num,u=a.size,l=a.anglesInRadians,c=u[0].toFixed(2),d=u[1].toFixed(2),f=u[2].toFixed(2),p=Pu(l[0]).toFixed(2),v=Pu(l[1]).toFixed(2),h=Pu(l[2]).toFixed(2),m=[];return m.push("Unit Cell <b>"+o+"</b> #"+s),m.push(c+""+d+""+f+" "),m.push("="+p+" ="+v+" ="+h+""),m.join(" | ")}e.getUnitcellLabel=r})(wb||(wb={}));function ELe(e,t,r){if(!e._rowCount)return[];for(var n=TLe(r),i=[],a=0;a<e._rowCount;a++)i[i.length]=ALe(e,t,a,n);return i}function ALe(e,t,r,n){for(var i=e.id.value(r),a=e.details.value(r),o=[],s=t.assembly_id,u=t.oper_expression,l=t.asym_id_list,c=0,d=t._rowCount;c<d;c++)s.value(c)===i&&(o[o.length]={assemblyId:i,expression:u.value(c),asymIds:l.value(c)});return oD.create(i,a,PLe(o,n))}function PLe(e,t){return function(){for(var r=[],n=0,i=0;i<e.length;i++){var a=e[i],o=DLe(a.expression),s=ILe(o),u=MLe(t,s,n,a.assemblyId),l=nn.generators.atoms({chainTest:nn.pred.and(nn.pred.eq(function(c){return lt.unit.operator_name(c.element)},bn.DefaultName),nn.pred.inSet(function(c){return lt.chain.label_asym_id(c.element)},a.asymIds))});r[r.length]={selector:l,operators:u},n+=u.length}return r}}function TLe(e){for(var t=e.id,r=e.matrix,n=e.vector,i=e._schema,a=new Map,o=0,s=e._rowCount;o<s;o++){var u=Mr.toMat4(ue(),i.matrix.space,r.value(o)),l=Mr.toVec3(_(),i.vector.space,n.value(o));ue.setTranslation(u,l),ue.setValue(u,3,3,1),a.set(t.value(o),u)}return a}function ILe(e){for(var t=[],r=[],n=0;n<e.length;n++)r[n]="";return _J(e,t,e.length-1,r),t}function _J(e,t,r,n){if(r<0){t[t.length]=n.slice(0);return}for(var i=e[r],a=i.length,o=0;o<a;o++)n[r]=i[o],_J(e,t,r-1,n)}function MLe(e,t,r,n){for(var i=[],a=r,o=0,s=t;o<s.length;o++){for(var u=s[o],l=ue.identity(),c=0;c<u.length;c++)ue.mul(l,l,e.get(u[c]));a++,i[i.length]=bn.create("ASM_"+a,l,{assembly:{id:n,operId:a,operList:u}})}return i}function DLe(e){for(var t=/\(?([^\(\)]+)\)?]*/g,r=[],n=[],i;i=t.exec(e);)r[r.length]=i[1];return r.forEach(function(a){var o=[];a.split(",").forEach(function(s){var u=s.indexOf("-");if(u>0)for(var l=parseInt(s.substring(0,u)),c=parseInt(s.substr(u+1)),d=l;d<=c;d++)o[o.length]=d.toString();else o[o.length]=s.trim()}),n[n.length]=o}),n}var fi;(function(e){e.Descriptor={name:"model_symmetry"},e.Provider=zu.create(e.Descriptor);function t(n){var i=ELe(n.pdbx_struct_assembly,n.pdbx_struct_assembly_gen,n.pdbx_struct_oper_list),a=OLe(n.symmetry,n.cell),o=RLe(n.atom_sites);return{assemblies:i,spacegroup:a,isNonStandardCrystalFrame:o,ncsOperators:LLe(n.struct_ncs_oper)}}e.fromData=t;function r(n,i){var a=Mo.create("P 1",n,i),o=Vu.create(a);return{assemblies:[],spacegroup:o,isNonStandardCrystalFrame:!1}}e.fromCell=r})(fi||(fi={}));function RLe(e,t){return e._rowCount===0,!1}function kLe(e){var t=e.Int_Tables_number.value(0),r=e["space_group_name_H-M"].value(0);return e.Int_Tables_number.isDefined?e["space_group_name_H-M"].isDefined?r:t:r}function OLe(e,t){if(e._rowCount===0||t._rowCount===0)return Vu.ZeroP1;var r=kLe(e),n=Mo.create(r,_.create(t.length_a.value(0),t.length_b.value(0),t.length_c.value(0)),_.scale(_.zero(),_.create(t.angle_alpha.value(0),t.angle_beta.value(0),t.angle_gamma.value(0)),Math.PI/180));return Vu.create(n)}function LLe(e){if(e._rowCount!==0){for(var t=e.id,r=e.matrix,n=e.vector,i=yr.struct_ncs_oper.matrix.space,a=yr.struct_ncs_oper.vector.space,o=[],s=0;s<e._rowCount;s++){var u=Mr.toMat3($n(),i,r.value(s)),l=Mr.toVec3(_(),a,n.value(s));if(bn.checkIfRotationAndTranslation(u,l)&&!(e.code.value(s)==="given"&&!$n.isIdentity(u)&&!_.isZero(l))){var c=t.value(s);o[o.length]=bn.ofRotationAndOffset("ncs_"+c,u,l,c)}}return o}}function wJ(e,t,r,n){return{type:e,key:t,elements:r,getIndex:n}}var Eb;(function(e){e.Descriptor={name:"model_secondary_structure"},e.Provider=zu.create(e.Descriptor);function t(r,n,i){var a=new Map,o=[{kind:"none"}],s=FLe(r,n);NLe(r,s,a,o),BLe(n,s,a,r._rowCount,o);var u=i.residues._rowCount,l=function(d){return d},c={type:new Int32Array(u),key:new Int32Array(u),elements:o};return a.size>0&&jLe(i,s,a,c),wJ(c.type,c.key,c.elements,l)}e.fromStruct=t})(Eb||(Eb={}));function FLe(e,t){if(e._rowCount>0){if(e.beg_label_seq_id.valueKind(0)!==0||e.end_label_seq_id.valueKind(0)!==0)return"auth"}else if(t&&(t.beg_label_seq_id.valueKind(0)!==0||t.end_label_seq_id.valueKind(0)!==0))return"auth";return"label"}function NLe(e,t,r,n){if(e._rowCount)for(var i=e.beg_label_asym_id,a=e.beg_label_seq_id,o=e.beg_auth_seq_id,s=e.pdbx_beg_PDB_ins_code,u=e.end_label_seq_id,l=e.end_auth_seq_id,c=e.pdbx_end_PDB_ins_code,d=e.pdbx_PDB_helix_class,f=e.conf_type_id,p=e.details,v=t==="label"?a:o,h=t==="label"?u:l,m=0,g=e._rowCount;m<g;m++){var y=Br.create(d.valueKind(m)===0?Br.SecondaryStructurePdb[d.value(m)]:f.valueKind(m)===0?Br.SecondaryStructureMmcif[f.value(m)]:536870912),b={kind:"helix",flags:y,type_id:f.valueKind(m)===0?f.value(m):"HELIX_P",helix_class:d.value(m),details:p.valueKind(m)===0?p.value(m):void 0},S={startSeqId:v.value(m),startInsCode:s.value(m),endSeqId:h.value(m),endInsCode:c.value(m),type:y,key:n.length};n[n.length]=b;var x=i.value(m);if(r.has(x)){var C=r.get(x);C.has(S.startSeqId)?C.get(S.startSeqId).push(S):C.set(S.startSeqId,[S])}else r.set(x,new Map([[S.startSeqId,[S]]]))}}function BLe(e,t,r,n,i){if(e._rowCount)for(var a=e.beg_label_asym_id,o=e.beg_label_seq_id,s=e.beg_auth_seq_id,u=e.pdbx_beg_PDB_ins_code,l=e.end_label_seq_id,c=e.end_auth_seq_id,d=e.pdbx_end_PDB_ins_code,f=e.sheet_id,p=t==="label"?o:s,v=t==="label"?l:c,h=new Map,m=n+1,g=0,y=e._rowCount;g<y;g++){var b=f.value(g),S=void 0;h.has(b)?S=h.get(b):(S=m++,h.set(b,S));var x=Br.create(8388612),C={kind:"sheet",flags:x,sheet_id:b,symmetry:void 0},w={startSeqId:p.value(g),startInsCode:u.value(g),endSeqId:v.value(g),endInsCode:d.value(g),type:x,key:i.length};i[i.length]=C;var A=a.value(g);if(r.has(A)){var M=r.get(A);M.has(w.startSeqId)?M.get(w.startSeqId).push(w):M.set(w.startSeqId,[w])}else r.set(A,new Map([[w.startSeqId,[w]]]))}}function ULe(e,t,r,n,i,a){for(var o=e.residues,s=o.auth_seq_id,u=o.label_seq_id,l=o.pdbx_PDB_ins_code,c=r.endSeqId,d=r.endInsCode,f=r.key,p=r.type,v=t==="label"?u:s,h=n;h<i;){var m=v.value(h);if(a.type[h]=p,a.key[h]=f,m>c||m===c&&l.value(h)===d)break;h++}}function jLe(e,t,r,n){for(var i=e.chainAtomSegments.count,a=e.chains.label_asym_id,o=e.residues,s=o.auth_seq_id,u=o.label_seq_id,l=o.pdbx_PDB_ins_code,c=t==="label"?u:s,d=0;d<i;d++){var f=dv.chainStartResidueIndex(e,d),p=dv.chainEndResidueIndexExcl(e,d),v=a.value(d);if(r.has(v))for(var h=r.get(v),m=f;m<p;m++){var g=c.value(m);if(h.has(g))for(var y=h.get(g),b=0,S=y;b<S.length;b++){var x=S[b],C=l.value(m);x.startInsCode===C&&ULe(e,t,x,m,p,n)}}}}var sD;(function(e){function t(s,u,l){return{name:s,type:0,value:u,valueKind:l&&l.valueKind,defaultFormat:l&&l.encoder?{encoder:l.encoder}:void 0,shouldInclude:l&&l.shouldInclude}}e.str=t;function r(s,u,l){return{name:s,type:1,value:u,valueKind:l&&l.valueKind,defaultFormat:l?{encoder:l.encoder,typedArray:l.typedArray}:void 0,shouldInclude:l&&l.shouldInclude}}e.int=r;function n(s,u,l){return{name:s,type:2,value:u,valueKind:l&&l.valueKind,defaultFormat:l?{encoder:l.encoder,typedArray:l.typedArray,digitCount:typeof l.digitCount<"u"?l.digitCount:void 0}:void 0,shouldInclude:l&&l.shouldInclude}}e.float=n;function i(s){return r(s,function(u,l,c){return c+1},{typedArray:Int32Array,encoder:br.by(br.delta).and(br.runLength).and(br.integerPacking)})}e.index=i;var a=function(){function s(){this.fields=[]}return s.prototype.index=function(u){return this.fields.push(e.index(u)),this},s.prototype.str=function(u,l,c){return this.fields.push(e.str(u,l,c)),this},s.prototype.int=function(u,l,c){return this.fields.push(e.int(u,l,c)),this},s.prototype.vec=function(u,l,c){for(var d=0;d<l.length;d++)this.fields.push(e.int(u+"["+(d+1)+"]",l[d],c));return this},s.prototype.float=function(u,l,c){return this.fields.push(e.float(u,l,c)),this},s.prototype.many=function(u){for(var l=0;l<u.length;l++)this.fields.push(u[l]);return this},s.prototype.add=function(u){return this.fields.push(u),this},s.prototype.getFields=function(){return this.fields},s}();e.Builder=a;function o(){return new a}e.build=o})(sD||(sD={}));var Yo;(function(e){e.Empty={fields:[],source:[]};function t(n){for(var i=[],a=[],o=[],s=[],u=0,l=n.split(/[\r\n]+/);u<l.length;u++){var c=l[u];if(c=c.trim(),c.length!==0){var d=/^!/.test(c);d&&(c=c.substr(1));var f=c.split(/\./),p=f[1],v=d?p?s:a:p?o:i;v[v.length]=c,p&&!i.includes(f[0])&&(i[i.length]=f[0])}}var h=o.map(function(m){return m.split(".")[0]});return{includeCategory:function(m){return a.includes(m)?!1:i.length<=0||i.indexOf(m)!==-1},includeField:function(m,g){var y=m+"."+g;return s.includes(y)?!1:!h.includes(m)||o.includes(y)}}}e.filterOf=t,e.DefaultFilter={includeCategory:function(n){return!0},includeField:function(n,i){return!0}},e.DefaultFormatter={getFormat:function(n,i){}};function r(n,i){return i?{fields:IU(n._schema),source:[{data:n,rowCount:i.length,keys:function(){return M_.Array(i)}}]}:{fields:IU(n._schema),source:[{data:n,rowCount:n._rowCount}]}}e.ofTable=r})(Yo||(Yo={}));var uD;(function(e){function t(n,i,a){n.startDataBlock(i);for(var o=function(c){n.writeCategory({name:c,instance:function(){return Yo.ofTable(a[c])}})},s=0,u=a._tableNames;s<u.length;s++){var l=u[s];o(l)}}e.writeDatabase=t;function r(n,i){for(var a=0,o=Object.keys(i);a<o.length;a++){var s=o[a];t(n,s,i[s])}}e.writeDatabaseCollection=r})(uD||(uD={}));function I4(e){return function(t,r){return r[e].value(t)}}function zLe(e){return function(t,r){return r[e].value(t).join(r[e].schema.separator)}}function M4(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];return function(n,i){var a;return(a=i[e].schema.space).get.apply(a,Nt([i[e].value(n)],t))}}function Gy(e){return function(t,r){return r[e].valueKind(t)}}function VLe(e,t){var r=[],n=2,i=Gy(e);if(t.rank===1)for(var a=t.dimensions[0],o=0;o<a;o++){var s=e+"["+(o+1)+"]";r.push({name:s,type:n,value:M4(e,o),valueKind:i})}else if(t.rank===2)for(var a=t.dimensions[0],u=t.dimensions[1],o=0;o<a;o++)for(var l=0;l<u;l++){var c=e+"["+(o+1)+"]["+(l+1)+"]";r.push({name:c,type:n,value:M4(e,o,l),valueKind:i})}else if(t.rank===3)for(var d=t.dimensions[0],f=t.dimensions[1],p=t.dimensions[2],o=0;o<d;o++)for(var l=0;l<f;l++)for(var v=0;v<p;v++){var h=e+"["+(o+1)+"]["+(l+1)+"]["+(v+1)+"]";r.push({name:h,type:n,value:M4(e,o,l,v),valueKind:i})}else throw new Error("Tensors with rank > 3 or rank 0 are currently not supported.");return r}function IU(e){for(var t=[],r=0,n=Object.keys(e);r<n.length;r++){var i=n[r],a=e[i];if(a.valueType==="int")t.push({name:i,type:1,value:I4(i),valueKind:Gy(i)});else if(a.valueType==="float")t.push({name:i,type:2,value:I4(i),valueKind:Gy(i)});else if(a.valueType==="str")t.push({name:i,type:0,value:I4(i),valueKind:Gy(i)});else if(a.valueType==="list")t.push({name:i,type:0,value:zLe(i),valueKind:Gy(i)});else if(a.valueType==="tensor")t.push.apply(t,VLe(i,a.space));else throw new Error("Unknown valueType "+a.valueType)}return t}function HLe(e){return e.defaultFormat&&typeof e.defaultFormat.digitCount<"u"?Math.max(0,Math.min(e.defaultFormat.digitCount,16)):6}function DL(e){return e.fields.some(function(t){return!!t.shouldInclude})?e.fields.filter(function(t){return!t.shouldInclude||e.source.some(function(r){return t.shouldInclude(r.data)})}):e.fields}function EJ(e,t){var r=e.instance(t),n=r.source.filter(function(o){return o.rowCount>0});if(!n.length)return{instance:r,rowCount:0,source:[]};var i=n.reduce(function(o,s){return o+s.rowCount},0),a=n.map(function(o){return{data:o.data,keys:function(){return o.keys?o.keys():M_.Range(0,o.rowCount-1)},rowCount:o.rowCount}});return{instance:r,rowCount:i,source:a}}var GLe=function(){function e(){this.builder=Lr.create(),this.encoded=!1,this.dataBlockCreated=!1,this.filter=Yo.DefaultFilter,this.formatter=Yo.DefaultFormatter,this.isBinary=!1,this.binaryEncodingProvider=void 0}return e.prototype.setFilter=function(t){this.filter=t||Yo.DefaultFilter},e.prototype.isCategoryIncluded=function(t){return this.filter.includeCategory(t)},e.prototype.setFormatter=function(t){this.formatter=t||Yo.DefaultFormatter},e.prototype.startDataBlock=function(t){this.dataBlockCreated=!0,Lr.write(this.builder,"data_"+(t||"").replace(/[ \n\t]/g,"").toUpperCase()+`
#
`)},e.prototype.writeCategory=function(t,r,n){if(this.encoded)throw new Error("The writer contents have already been encoded, no more writing.");if(!this.dataBlockCreated)throw new Error("No data block created.");if(!(!(n!=null&&n.ignoreFilter)&&!this.filter.includeCategory(t.name))){var i=EJ(t,r),a=i.instance,o=i.rowCount,s=i.source;o&&(o===1?qLe(t,a,s,this.builder,this.filter,this.formatter):$Le(t,a,s,this.builder,this.filter,this.formatter))}},e.prototype.encode=function(){this.encoded=!0},e.prototype.writeTo=function(t){for(var r=Lr.getChunks(this.builder),n=0,i=r.length;n<i;n++)t.writeString(r[n])},e.prototype.getSize=function(){return Lr.getSize(this.builder)},e.prototype.getData=function(){return Lr.getString(this.builder)},e}();function AJ(e,t,r,n,i,a){var o=n.valueKind,s=o?o(r,t):0;if(s!==0)s===1?KLe(e):QLe(e);else{var u=n.value(r,t,a),l=n.type;if(l===0)return WLe(u)?(JS(e,u),!0):ZLe(e,u);l===1?XLe(e,u):YLe(e,u,i)}return!1}function PJ(e,t,r){for(var n=[],i=0,a=t;i<a.length;i++){var o=a[i],s=r.getFormat(e,o.name);s&&typeof s.digitCount<"u"?n[n.length]=o.type===2?Math.pow(10,Math.max(0,Math.min(s.digitCount,15))):0:n[n.length]=o.type===2?Math.pow(10,HLe(o)):0}return n}function qLe(e,t,r,n,i,a){var o=DL(t),s=r[0],u=s.data,l=o.reduce(function(m,g){return i.includeField(e.name,g.name)?Math.max(m,g.name.length):0},0);if(l!==0){l+=e.name.length+6;for(var c=s.keys(),d=c.move(),f=PJ(e.name,t.fields,a),p=0;p<o.length;p++){var v=o[p];if(i.includeField(e.name,v.name)){Lr.writePadRight(n,"_"+e.name+"."+v.name,l);var h=AJ(n,u,d,v,f[p],0);h||Lr.newline(n)}}Lr.write(n,`#
`)}}function $Le(e,t,r,n,i,a){var o=DL(t),s=i===Yo.DefaultFilter?o:o.filter(function(b){return i.includeField(e.name,b.name)}),u=s.length;if(u!==0){var l=PJ(e.name,s,a);MU(n,"loop_");for(var c=0;c<u;c++)MU(n,"_"+e.name+"."+s[c].name);for(var d=0,f=0;f<r.length;f++){var p=r[f],v=p.data;if(p.rowCount!==0)for(var h=p.keys();h.hasNext;){for(var m=h.move(),g=!1,y=0;y<u;y++)g=AJ(n,v,m,s[y],l[y],d);g||Lr.newline(n),d++}}Lr.write(n,`#
`)}}function WLe(e){return typeof e=="string"&&e.indexOf(`
`)>=0}function MU(e,t){Lr.write(e,t),Lr.newline(e)}function XLe(e,t){Lr.writeInteger(e,t),Lr.whitespace1(e)}function YLe(e,t,r){Lr.writeFloat(e,t,r),Lr.whitespace1(e)}function KLe(e){Lr.writeSafe(e,". ")}function QLe(e){Lr.writeSafe(e,"? ")}function ZLe(e,t){if(!t)return Lr.writeSafe(e,". "),!1;for(var r=t.charCodeAt(0),n=!1,i=0,a=!1,o=!1,s=0,u=t.length-1;s<=u;s++){var l=t.charCodeAt(s);switch(l){case 9:n=!0;break;case 10:return JS(e,t),!0;case 32:n=!0;break;case 34:if(s&&s===u)break;if(a)return JS(e,t),!0;o=!0,n=!0,i=0;break;case 39:if(s&&s===u)break;if(o)return JS(e,t),!0;a=!0,n=!0,i=1;break}}return!n&&(r===35||r===36||r===59||r===91||r===93||r===95)&&(n=!0),n?(Lr.writeSafe(e,i?'"':"'"),Lr.writeSafe(e,t),Lr.writeSafe(e,i?'" ':"' ")):(Lr.writeSafe(e,t),Lr.writeSafe(e," ")),!1}function JS(e,t){Lr.writeSafe(e,`
;`+t),Lr.writeSafe(e,`
;
`)}function JLe(e){var t=new ArrayBuffer(eC(e)),r=new DataView(t),n=new Uint8Array(t);return tC(e,r,n,0),n}function eC(e){var t=typeof e;if(t==="string"){var r=R_(e);if(r<32)return 1+r;if(r<256)return 2+r;if(r<65536)return 3+r;if(r<4294967296)return 5+r}if(e instanceof Uint8Array){var n=e.byteLength;if(n<256)return 2+n;if(n<65536)return 3+n;if(n<4294967296)return 5+n}if(t==="number"){if(Math.floor(e)!==e)return 9;if(e>=0){if(e<128)return 1;if(e<256)return 2;if(e<65536)return 3;if(e<4294967296)return 5;throw new Error("Number too big 0x"+e.toString(16))}if(e>=-32)return 1;if(e>=-128)return 2;if(e>=-32768)return 3;if(e>=-2147483648)return 5;throw new Error("Number too small -0x"+e.toString(16).substr(1))}if(t==="boolean"||e===null||e===void 0)return 1;if(t==="object"){var i,a=0;if(Array.isArray(e)){i=e.length;for(var o=0;o<i;o++)a+=eC(e[o])}else{var s=Object.keys(e);i=s.length;for(var o=0;o<i;o++){var u=s[o];a+=eC(u)+eC(e[u])}}if(i<16)return 1+a;if(i<65536)return 3+a;if(i<4294967296)return 5+a;throw new Error("Array or object too long 0x"+i.toString(16))}throw new Error("Unknown type "+t)}function tC(e,t,r,n){var i=typeof e;if(i==="string"){var a=R_(e);if(a<32)return t.setUint8(n,a|160),$m(r,n+1,e),1+a;if(a<256)return t.setUint8(n,217),t.setUint8(n+1,a),$m(r,n+2,e),2+a;if(a<65536)return t.setUint8(n,218),t.setUint16(n+1,a),$m(r,n+3,e),3+a;if(a<4294967296)return t.setUint8(n,219),t.setUint32(n+1,a),$m(r,n+5,e),5+a}if(e instanceof Uint8Array){var o=e.byteLength,s=new Uint8Array(t.buffer);if(o<256)return t.setUint8(n,196),t.setUint8(n+1,o),s.set(e,n+2),2+o;if(o<65536)return t.setUint8(n,197),t.setUint16(n+1,o),s.set(e,n+3),3+o;if(o<4294967296)return t.setUint8(n,198),t.setUint32(n+1,o),s.set(e,n+5),5+o}if(i==="number"){if(!isFinite(e))throw new Error("Number not finite: "+e);if(Math.floor(e)!==e)return t.setUint8(n,203),t.setFloat64(n+1,e),9;if(e>=0){if(e<128)return t.setUint8(n,e),1;if(e<256)return t.setUint8(n,204),t.setUint8(n+1,e),2;if(e<65536)return t.setUint8(n,205),t.setUint16(n+1,e),3;if(e<4294967296)return t.setUint8(n,206),t.setUint32(n+1,e),5;throw new Error("Number too big 0x"+e.toString(16))}if(e>=-32)return t.setInt8(n,e),1;if(e>=-128)return t.setUint8(n,208),t.setInt8(n+1,e),2;if(e>=-32768)return t.setUint8(n,209),t.setInt16(n+1,e),3;if(e>=-2147483648)return t.setUint8(n,210),t.setInt32(n+1,e),5;throw new Error("Number too small -0x"+(-e).toString(16).substr(1))}if(e==null)return t.setUint8(n,192),1;if(i==="boolean")return t.setUint8(n,e?195:194),1;if(i==="object"){var u,l=0,c=Array.isArray(e),d=void 0;if(c?u=e.length:(d=Object.keys(e),u=d.length),u<16?(t.setUint8(n,u|(c?144:128)),l=1):u<65536?(t.setUint8(n,c?220:222),t.setUint16(n+1,u),l=3):u<4294967296&&(t.setUint8(n,c?221:223),t.setUint32(n+1,u),l=5),c)for(var f=0;f<u;f++)l+=tC(e[f],t,r,n+l);else for(var f=0,p=d.length;f<p;f++){var v=d[f];l+=tC(v,t,r,n+l),l+=tC(e[v],t,r,n+l)}return l}throw new Error("Unknown type "+i)}var eFe=function(){function e(t,r,n){this.autoClassify=n,this.dataBlocks=[],this.filter=Yo.DefaultFilter,this.formatter=Yo.DefaultFormatter,this.isBinary=!0,this.binaryEncodingProvider=void 0,this.binaryEncodingProvider=r,this.data={encoder:t,version:qOe,dataBlocks:this.dataBlocks}}return e.prototype.setFilter=function(t){this.filter=t||Yo.DefaultFilter},e.prototype.isCategoryIncluded=function(t){return this.filter.includeCategory(t)},e.prototype.setFormatter=function(t){this.formatter=t||Yo.DefaultFormatter},e.prototype.startDataBlock=function(t){this.dataBlocks.push({header:(t||"").replace(/[ \n\t]/g,"").toUpperCase(),categories:[]})},e.prototype.writeCategory=function(t,r,n){if(!this.data)throw new Error("The writer contents have already been encoded, no more writing.");if(!this.dataBlocks.length)throw new Error("No data block created.");if(!(!(n!=null&&n.ignoreFilter)&&!this.filter.includeCategory(t.name))){var i=EJ(t,r),a=i.instance,o=i.rowCount,s=i.source;if(o){for(var u={name:"_"+t.name,columns:[],rowCount:o},l=DL(a),c=0,d=l;c<d.length;c++){var f=d[c];if(this.filter.includeField(t.name,f.name)){var p=this.formatter.getFormat(t.name,f.name);u.columns.push(aFe(t.name,f,s,o,p,this.binaryEncodingProvider,this.autoClassify))}}u.columns.length&&this.dataBlocks[this.dataBlocks.length-1].categories.push(u)}}},e.prototype.encode=function(){this.encodedData||(this.encodedData=JLe(this.data),this.data=null,this.dataBlocks=null)},e.prototype.writeTo=function(t){t.writeBinary(this.encodedData)},e.prototype.getData=function(){return this.encode(),this.encodedData},e.prototype.getSize=function(){return this.encodedData.length},e}();function tFe(e,t){return t&&t.typedArray?t.typedArray:e.defaultFormat&&e.defaultFormat.typedArray?e.defaultFormat.typedArray:e.type===0?Array:e.type===1?Int32Array:Float64Array}function rFe(e){return e===0?pp.by(br.stringArray):pp.by(br.byteArray)}function nFe(e,t,r,n){return r&&r.encoder?r.encoder:t.defaultFormat&&t.defaultFormat.encoder?t.defaultFormat.encoder:n?n.get(e,t.name):void 0}function iFe(e,t){return e===0?pp.by(br.stringArray):e===1?iD(t):KOe(t)}function aFe(e,t,r,n,i,a,o){var s=oFe(t,tFe(t,i),n,r),u=s.array,l=s.allPresent,c=s.mask,d=nFe(e,t,i,a);d||(o?d=iFe(t.type,u):d=rFe(t.type));var f=d.encode(u),p=void 0;if(!l){var v=pp.by(br.runLength).and(br.byteArray).encode(c);v.data.length<c.length?p=v:p=pp.by(br.byteArray).encode(c)}return{name:t.name,data:f,mask:p}}function oFe(e,t,r,n){for(var i=e.type===0,a=new t(r),o=new Uint8Array(r),s=e.valueKind,u=e.value,l=!0,c=0,d=0;d<n.length;d++)for(var f=n[d].data,p=n[d].keys();p.hasNext;){var v=p.move(),h=s?s(v,f):0;h!==0?(o[c]=h,i&&(a[c]=""),l=!1):(o[c]=0,a[c]=u(v,f,c)),c++}return{array:a,allPresent:l,mask:o}}var Bi;(function(e){e.Encoder=uD,e.Category=Yo,e.Field=sD,e.Encoding=br;function t(u){var l=u||{},c=l.binary,d=c===void 0?!1:c,f=l.encoderName,p=f===void 0?"mol*":f;return d?new eFe(p,u?u.binaryEncodingPovider:void 0,u?!!u.binaryAutoClassifyEncoding:!1):new GLe}e.createEncoder=t;function r(){return e.Field.build()}e.fields=r;var n=e.Encoding;e.Encodings={deltaRLE:n.by(n.delta).and(n.runLength).and(n.integerPacking),fixedPoint2:n.by(n.fixedPoint(100)).and(n.delta).and(n.integerPacking),fixedPoint3:n.by(n.fixedPoint(1e3)).and(n.delta).and(n.integerPacking)};function i(u,l){return{fields:u,source:[l]}}e.categoryInstance=i;function a(u){return{get:function(l,c){var d=u.categories[l];if(d){var f=d.getField(c);return f&&f.binaryEncoding?pp.fromEncoding(f.binaryEncoding):void 0}}}}e.createEncodingProviderFromCifFrame=a;function o(u){return{get:function(l,c){for(var d=0;d<u.length;d++){var f=u[d];if(f.categoryName===l&&f.columnName===c)return s(f)}}}}e.createEncodingProviderFromJsonConfig=o;function s(u){var l=u.precision;if(l!==void 0){var c=Math.pow(10,l),d=n.by(n.fixedPoint(c));switch(u.encoding){case"pack":return d.and(n.integerPacking);case"rle":return d.and(n.runLength).and(n.integerPacking);case"delta":return d.and(n.delta).and(n.integerPacking);case"delta-rle":return d.and(n.delta).and(n.runLength).and(n.integerPacking)}}else switch(u.encoding){case"pack":return n.by(n.integerPacking);case"rle":return n.by(n.runLength).and(n.integerPacking);case"delta":return n.by(n.delta).and(n.integerPacking);case"delta-rle":return n.by(n.delta).and(n.runLength).and(n.integerPacking)}throw new Error("cannot be reached")}})(Bi||(Bi={}));var sFe={U:yr.atom_site_anisotrop.U,U_esd:yr.atom_site_anisotrop.U_esd},Ul;(function(e){e.Schema=sFe,e.Descriptor={name:"atom_site_anisotrop",cifExport:{prefix:"",categories:[{name:"atom_site_anisotrop",instance:function(n){var i=e.Provider.get(n.firstModel);return!i||!an.is(n.firstModel.sourceData)?Bi.Category.Empty:Bi.Category.ofTable(n.firstModel.sourceData.data.db.atom_site_anisotrop)}}]}},e.Provider=zu.create(e.Descriptor);function t(n,i){var a=new Int32Array(n.rowCount);a.fill(-1);for(var o=0,s=n.rowCount;o<s;o++)a[n.value(o)]=o;var u=new Int32Array(n.rowCount);u.fill(-1);for(var o=0,s=i.rowCount;o<s;++o){var l=a[i.value(o)];l!==-1&&(u[l]=o)}return u}e.getElementToAnsiotrop=t;function r(n,i){for(var a={},o=0,s=n.rowCount;o<s;o++)a[n.value(o)]=o;var u=new Int32Array(n.rowCount);u.fill(-1);for(var o=0,s=i.rowCount;o<s;++o){var l=a[i.value(o)];l!==void 0&&(u[l]=o)}return u}e.getElementToAnsiotropFromLabel=r})(Ul||(Ul={}));var Ab;(function(e){e.Descriptor={name:"chem_comp_bond",cifExport:{prefix:"",categories:[{name:"chem_comp_bond",instance:function(i){var a=e.Provider.get(i.firstModel);if(!a)return Bi.Category.Empty;var o=a.data;if(!o)return Bi.Category.Empty;for(var s=i.structures[0].uniqueResidueNames,u=o.comp_id,l=o._rowCount,c=[],d=0;d<l;d++)s.has(u.value(d))&&(c[c.length]=d);return Bi.Category.ofTable(o,c)}}]}},e.Provider=zu.create(e.Descriptor);function t(i,a){return Qr.pick(a,yr.chem_comp_bond,function(o){return i.properties.chemicalComponentMap.has(a.comp_id.value(o))})}e.chemCompBondFromTable=t;function r(i){var a=new Map;function o(C){if(a.has(C))return a.get(C);var w=new n(C);return a.set(C,w),w}for(var s=i.comp_id,u=i.atom_id_1,l=i.atom_id_2,c=i.value_order,d=i.pdbx_aromatic_flag,f=i._rowCount,p=o(s.value(0)),v=0;v<f;v++){var h=s.value(v),m=u.value(v),g=l.value(v),y=c.value(v),b=d.value(v)==="Y";p.id!==h&&(p=o(h));var S=1,x=1;switch(b&&(S|=16),y.toLowerCase()){case"doub":case"delo":x=2;break;case"trip":x=3;break;case"quad":x=4;break}p.add(m,g,x,S)}return a}e.getEntriesFromChemCompBond=r;var n=function(){function i(a){this.id=a,this.map=new Map}return i.prototype.add=function(a,o,s,u,l){l===void 0&&(l=!0);var c=this.map.get(a);if(c!==void 0){var d=c.get(o);d===void 0&&c.set(o,{order:s,flags:u})}else{var f=new Map;f.set(o,{order:s,flags:u}),this.map.set(a,f)}l&&this.add(o,a,s,u,!1)},i}();e.Entry=n})(Ab||(Ab={}));var uFe=new Map([["HIS|CD2|CG",2],["HIS|CE1|ND1",2],["ARG|CZ|NH2",2],["PHE|CE1|CZ",2],["PHE|CD2|CE2",2],["PHE|CD1|CG",2],["TRP|CD1|CG",2],["TRP|CD2|CE2",2],["TRP|CE3|CZ3",2],["TRP|CH2|CZ2",2],["ASN|CG|OD1",2],["GLN|CD|OE1",2],["TYR|CD1|CG",2],["TYR|CD2|CE2",2],["TYR|CE1|CZ",2],["ASP|CG|OD1",2],["GLU|CD|OE1",2],["G|C8|N7",2],["G|C4|C5",2],["G|C2|N3",2],["G|C6|O6",2],["C|C4|N3",2],["C|C5|C6",2],["C|C2|O2",2],["A|C2|N3",2],["A|C6|N1",2],["A|C4|C5",2],["A|C8|N7",2],["U|C5|C6",2],["U|C2|O2",2],["U|C4|O4",2],["DG|C8|N7",2],["DG|C4|C5",2],["DG|C2|N3",2],["DG|C6|O6",2],["DC|C4|N3",2],["DC|C5|C6",2],["DC|C2|O2",2],["DA|C2|N3",2],["DA|C6|N1",2],["DA|C4|C5",2],["DA|C8|N7",2],["DT|C5|C6",2],["DT|C2|O2",2],["DT|C4|O4",2]]);function lFe(e,t,r){var n;return n=t<r?[t,r]:[r,t],t=n[0],r=n[1],SE.has(e)&&t==="C"&&r==="O"||wE.has(e)&&t==="OP1"&&r==="P"?2:uFe.get(e+"|"+t+"|"+r)||1}var cFe=new Map([["LYS|NZ|RET|C15",2]]);function TJ(e,t,r,n){var i,a;return e>r&&(i=[r,e],e=i[0],r=i[1],a=[n,t],t=a[0],n=a[1]),cFe.get(e+"|"+t+"|"+r+"|"+n)||1}var jl;(function(e){e.Descriptor={name:"struct_conn",cifExport:{prefix:"",categories:[{name:"struct_conn",instance:function(a){var o=e.Provider.get(a.firstModel);if(!o||o.entries.length===0)return Bi.Category.Empty;for(var s=a.structures[0],u=[],l=0,c=o.entries;l<c.length;l++){var d=c[l];r(s,d.partnerA.atomIndex)&&r(s,d.partnerB.atomIndex)&&(u[u.length]=d.rowIndex)}return Bi.Category.ofTable(o.data,u)}}]}},e.Provider=zu.create(e.Descriptor);function t(a){var o=e.Provider.get(a);return!!o&&o.data.id.rowCount/a.atomicConformation.atomId.rowCount>.95}e.isExhaustive=t;function r(a,o){for(var s=a.units,u=0,l=s.length;u<l;u++)if(Je.indexOf(s[u].elements,o)>=0)return!0;return!1}function n(a){for(var o=new Map,s=0,u=a;s<u.length;s++){var l=u[s],c=l.partnerA.atomIndex,d=l.partnerB.atomIndex;o.has(c)?o.get(c).push(l):o.set(c,[l]),o.has(d)?o.get(d).push(l):o.set(d,[l])}return o}e.getAtomIndexFromEntries=n;function i(a,o){for(var s=a.conn_type_id,u=a.pdbx_dist_value,l=a.pdbx_value_order,c={label_asym_id:a.ptnr1_label_asym_id,label_seq_id:a.ptnr1_label_seq_id,auth_seq_id:a.ptnr1_auth_seq_id,label_atom_id:a.ptnr1_label_atom_id,label_alt_id:a.pdbx_ptnr1_label_alt_id,ins_code:a.pdbx_ptnr1_PDB_ins_code,symmetry:a.ptnr1_symmetry},d={label_asym_id:a.ptnr2_label_asym_id,label_seq_id:a.ptnr2_label_seq_id,auth_seq_id:a.ptnr2_auth_seq_id,label_atom_id:a.ptnr2_label_atom_id,label_alt_id:a.pdbx_ptnr2_label_alt_id,ins_code:a.pdbx_ptnr2_PDB_ins_code,symmetry:a.ptnr2_symmetry},f=function(x,C){if(C.label_asym_id.valueKind(x)===0){var w=C.label_asym_id.value(x),A=o.atomicHierarchy.index.findEntity(w);if(!(A<0)){var M=o.atomicHierarchy.index.findResidue(o.entities.data.id.value(A),w,C.auth_seq_id.value(x),C.ins_code.value(x));if(!(M<0)){var D=C.label_atom_id.value(x);if(D){var k=o.atomicHierarchy.index.findAtomOnResidue(M,D,C.label_alt_id.value(x));if(!(k<0))return{residueIndex:M,atomIndex:k,symmetry:C.symmetry.value(x)}}}}}},p=[],v=0;v<a._rowCount;v++){var h=f(v,c),m=f(v,d);if(!(h===void 0||m===void 0)){var g=s.value(v),y=(l.value(v)||"").toLowerCase(),b=0,S=1;switch(y){case"sing":S=1;break;case"doub":S=2;break;case"trip":S=3;break;case"quad":S=4;break;default:S=TJ(a.ptnr1_label_comp_id.value(v),a.ptnr1_label_atom_id.value(v),a.ptnr2_label_comp_id.value(v),a.ptnr2_label_atom_id.value(v))}switch(g){case"covale":b=1;break;case"disulf":b=9;break;case"hydrog":b=4;break;case"metalc":b=2;break}p.push({rowIndex:v,flags:b,order:S,distance:u.value(v),partnerA:h,partnerB:m})}}return p}e.getEntriesFromStructConn=i})(jl||(jl={}));var Uh;(function(e){var t,r="molstar_global_model_transform_info";e.Schema=(t={},t[r]={matrix:ve.Schema.Matrix(4,4,ve.Schema.float)},t),e.Descriptor=To({name:r,cifExport:{categories:[{name:r,instance:function(u){var l=i(u.firstModel);if(!l)return Bi.Category.Empty;var c=Qr.ofRows(e.Schema.molstar_global_model_transform_info,[{matrix:l}]);return Bi.Category.ofTable(c)}}],prefix:"molstar"}}),e.Provider=zu.create(e.Descriptor);function n(u,l){u.customProperties.has(e.Descriptor)||u.customProperties.add(e.Descriptor),e.Provider.set(u,l)}e.attach=n;function i(u){return e.Provider.get(u)}e.get=i;function a(u){if(an.is(u.sourceData)){var l=u.sourceData.data.frame.categories[r];if(l){var c=xJ(e.Schema[r],l);if(c._rowCount!==0)return c.matrix.value(0)}}}e.fromMmCif=a;function o(u){if(!an.is(u.sourceData))return!1;var l=u.sourceData.data.frame.categories[r];return!!l&&l.rowCount>0}e.hasData=o;function s(u,l){u.writeCategory({name:r,instance:function(){var c=Qr.ofRows(e.Schema.molstar_global_model_transform_info,[{matrix:l}]);return Bi.Category.ofTable(c)}})}e.writeMmCif=s})(Uh||(Uh={}));function dFe(e){if(an.is(e.sourceData))return fi.fromData(e.sourceData.data.db)}fi.Provider.formatRegistry.add("mmCIF",dFe);function fFe(e){if(an.is(e.sourceData)){var t=e.sourceData.data.db,r=t.struct_conf,n=t.struct_sheet_range;return Eb.fromStruct(r,n,e.atomicHierarchy)}}Eb.Provider.formatRegistry.add("mmCIF",fFe);function pFe(e){if(an.is(e.sourceData)){var t=e.sourceData.data.db.atom_site_anisotrop,r=Qr.ofColumns(Ul.Schema,t),n=Ul.getElementToAnsiotrop(e.atomicConformation.atomId,t.id);return{data:r,elementToAnsiotrop:n}}}function hFe(e){return an.is(e.sourceData)?e.sourceData.data.db.atom_site_anisotrop.U.isDefined:!1}Ul.Provider.formatRegistry.add("mmCIF",pFe,hFe);function vFe(e){if(an.is(e.sourceData)){var t=e.sourceData.data.db.chem_comp_bond;if(t._rowCount!==0)return{data:t,entries:Ab.getEntriesFromChemCompBond(t)}}}Ab.Provider.formatRegistry.add("mmCIF",vFe);function mFe(e){if(an.is(e.sourceData)){var t=e.sourceData.data.db.struct_conn;if(t._rowCount!==0){var r=jl.getEntriesFromStructConn(t,e);return{data:t,byAtomIndex:jl.getAtomIndexFromEntries(r),entries:r}}}}jl.Provider.formatRegistry.add("mmCIF",mFe);Uh.Provider.formatRegistry.add("mmCIF",Uh.fromMmCif,Uh.hasData);var an;(function(e){function t(n){return(n==null?void 0:n.kind)==="mmCIF"}e.is=t;function r(n,i,a){return i||(i=td.schema.mmCIF(n)),{kind:"mmCIF",name:i._name,data:{db:i,frame:n,source:a}}}e.fromFrame=r})(an||(an={}));function IJ(e){var t=an.fromFrame(e);return $e.create("Create mmCIF Model",function(r){return xd(t.data.db,t,r)})}var Ze;(function(e){function t(f,p,v){return{kind:"element-location",structure:f,unit:p,element:v||0}}e.create=t;function r(f){return t(f.structure,f.unit,f.element)}e.clone=r;function n(f,p,v,h){return p&&(f.structure=p),v&&(f.unit=v),h!==void 0&&(f.element=h),f}e.set=n;function i(f,p){return f.unit=p.unit,f.element=p.element,f}e.copy=i;function a(f){return!!f&&f.kind==="element-location"}e.is=a;function o(f,p){return f.unit===p.unit&&f.element===p.element}e.areEqual=o;var s=_.zero(),u=_.zero();function l(f,p){return f.unit.conformation.position(f.element,s),p.unit.conformation.position(p.element,u),_.distance(s,u)}e.distance=l;function c(f){return f.unit.model.atomicHierarchy.residueAtomSegments.index[f.element]}e.residueIndex=c;function d(f){return f.unit.model.atomicHierarchy.chainAtomSegments.index[f.element]}e.chainIndex=d})(Ze||(Ze={}));var De;(function(e){function t(s,u,l){return{kind:"variable",name:s,type:u,isConstraint:l}}e.Variable=t;function r(s,u,l){return{kind:"value",namespace:s,name:u,parent:l}}e.Value=r;function n(s,u,l,c){return{kind:"container",namespace:s,name:u,child:l,alias:c}}e.Container=n;function i(s){return{kind:"union",types:s}}e.Union=i;function a(s,u,l,c){for(var d=Object.create(null),f=0,p=c;f<p.length;f++){var v=p[f];d[v]=!0}return{kind:"oneof",namespace:s,name:u,type:l,values:d}}e.OneOf=a,e.Any={kind:"any"},e.AnyValue={kind:"any-value"},e.Num=r("","Number"),e.Str=r("","String"),e.Bool=a("","Bool",e.Str,["true","false"]);function o(s){var u=s.values;return Object.keys(u).sort()}e.oneOfValues=o})(De||(De={}));var Ii;(function(e){function t(u){return{name:u}}e.Symbol=t;function r(u,l){return l?{head:u,args:l}:{head:u}}e.Apply=r;function n(u){return!!u&&Array.isArray(u)}e.isArgumentsArray=n;function i(u){return!!u&&!Array.isArray(u)}e.isArgumentsMap=i;function a(u){return!o(u)&&!s(u)}e.isLiteral=a;function o(u){return!!u&&!!u.head&&typeof u=="object"}e.isApply=o;function s(u){return!!u&&typeof u.name=="string"}e.isSymbol=s})(Ii||(Ii={}));function vt(e,t){var r=t||{},n=r.description,i=n===void 0?void 0:n,a=r.isOptional,o=a===void 0?!1:a,s=r.isRest,u=s===void 0?!1:s,l=r.defaultValue,c=l===void 0?void 0:l;return{type:e,isOptional:o,isRest:u,defaultValue:c,description:i}}var Rt;(function(e){e.None=t({});function t(n){return{kind:"dictionary",map:n,"@type":0}}e.Dictionary=t;function r(n,i){var a=(i||{}).nonEmpty,o=a===void 0?!1:a;return{kind:"list",type:n,nonEmpty:o,"@type":0}}e.List=r})(Rt||(Rt={}));function qy(e,t,r,n){var i=function(a){return Ii.Apply(Ii.Symbol(i.id),a)};return i.info={namespace:"",name:e,description:n},i.id="",i.args=t,i.type=r,i}function DU(e,t,r,n){var i=function(a){return Ii.Apply(Ii.Symbol(i.id),a)};return i.info={namespace:e,name:t,description:n},i.id=e+"."+t,i.args=Rt.None,i.type=r,i}function q_(e){var t=e;return typeof t=="function"&&!!t.info&&!!t.args&&typeof t.info.namespace=="string"&&!!t.type}function Bt(e,t,r){return qy("",e,t,r)}function MJ(e){RJ("","",e)}function DJ(e){var t=[];return kJ(e,t),t}function RU(e){var t=/([a-z])([A-Z])([a-z]|$)/g;return e.replace(t,function(r,n,i,a){return n+"-"+i.toLocaleLowerCase()+a}).replace(t,function(r,n,i,a){return n+"-"+i.toLocaleLowerCase()+a})}function RJ(e,t,r){if(q_(r)){r.info.namespace=e,r.info.name=r.info.name||RU(t),r.id=r.info.namespace+"."+r.info.name;return}for(var n=""+(r["@namespace"]||RU(t)),i=e?e+"."+n:n,a=0,o=Object.keys(r);a<o.length;a++){var s=o[a];typeof r[s]!="object"&&!q_(r[s])||RJ(i,s,r[s])}}function kJ(e,t){if(q_(e)){t.push(e);return}for(var r=0,n=Object.keys(e);r<n.length;r++){var i=n[r];typeof e[i]!="object"&&!q_(e[i])||kJ(e[i],t)}}var Er;(function(e){e.AnyVar=De.Variable("a",De.Any),e.AnyValueVar=De.Variable("a",De.Any),e.ConstrainedVar=De.Variable("a",De.Any,!0),e.Regex=De.Value("Core","Regex"),e.Set=function(t){return De.Container("Core","Set",t||e.AnyValueVar)},e.List=function(t){return De.Container("Core","List",t||e.AnyVar)},e.Fn=function(t,r){return De.Container("Core","Fn",t||e.AnyVar,r)},e.Flags=function(t,r){return De.Container("Core","Flags",t,r)},e.BitFlags=e.Flags(De.Num,"BitFlags")})(Er||(Er={}));function ji(e,t){return Bt(Rt.Dictionary({0:vt(e)}),e,t)}function Cf(e,t){return Bt(Rt.List(e,{nonEmpty:!0}),e,t)}function ml(e,t,r){return Bt(Rt.Dictionary({0:vt(e),1:vt(e)}),t,r)}Rt.Dictionary({0:vt(De.Num),1:vt(De.Num)});vt(De.Str);var gFe={"@header":"Types",bool:Bt(Rt.Dictionary({0:vt(De.AnyValue)}),De.Bool,"Convert a value to boolean."),num:Bt(Rt.Dictionary({0:vt(De.AnyValue)}),De.Num,"Convert a value to number."),str:Bt(Rt.Dictionary({0:vt(De.AnyValue)}),De.Str,"Convert a value to string."),regex:Bt(Rt.Dictionary({0:vt(De.Str,{description:"Expression"}),1:vt(De.Str,{isOptional:!0,description:"Flags, e.g. 'i' for ignore case"})}),Er.Regex,"Creates a regular expression from a string using the ECMAscript syntax."),list:Bt(Rt.List(Er.AnyVar),Er.List()),set:Bt(Rt.List(Er.AnyValueVar),Er.Set()),bitflags:Bt(Rt.Dictionary({0:vt(De.Num)}),Er.BitFlags,"Interpret a number as bitflags."),compositeKey:Bt(Rt.List(De.AnyValue),De.AnyValue)},yFe={"@header":"Logic",not:ji(De.Bool),and:Cf(De.Bool),or:Cf(De.Bool)},bFe={"@header":"Control",eval:Bt(Rt.Dictionary({0:vt(Er.Fn(Er.AnyVar))}),Er.AnyVar,"Evaluate a function."),fn:Bt(Rt.Dictionary({0:vt(Er.AnyVar)}),Er.Fn(Er.AnyVar),'Wrap an expression to a "lazy" function.'),if:Bt(Rt.Dictionary({0:vt(De.Bool,{description:"Condition"}),1:vt(De.Variable("a",De.Any),{description:"If true"}),2:vt(De.Variable("b",De.Any),{description:"If false"})}),De.Union([De.Variable("a",De.Any),De.Variable("b",De.Any)])),assoc:Bt(Rt.Dictionary({0:vt(De.Str,{description:"Name"}),1:vt(De.Variable("a",De.Any),{description:"Value to assign"})}),De.Variable("a",De.Any))},xFe={"@header":"Relational",eq:ml(De.Variable("a",De.AnyValue,!0),De.Bool),neq:ml(De.Variable("a",De.AnyValue,!0),De.Bool),lt:ml(De.Num,De.Bool),lte:ml(De.Num,De.Bool),gr:ml(De.Num,De.Bool),gre:ml(De.Num,De.Bool),inRange:Bt(Rt.Dictionary({0:vt(De.Num,{description:"Value to test"}),1:vt(De.Num,{description:"Minimum value"}),2:vt(De.Num,{description:"Maximum value"})}),De.Bool,"Check if the value of the 1st argument is >= 2nd and <= 3rd.")},SFe={"@header":"Math",add:Cf(De.Num),sub:Cf(De.Num),mult:Cf(De.Num),div:ml(De.Num,De.Num),pow:ml(De.Num,De.Num),mod:ml(De.Num,De.Num),min:Cf(De.Num),max:Cf(De.Num),floor:ji(De.Num),ceil:ji(De.Num),roundInt:ji(De.Num),abs:ji(De.Num),sqrt:ji(De.Num),cbrt:ji(De.Num),sin:ji(De.Num),cos:ji(De.Num),tan:ji(De.Num),asin:ji(De.Num),acos:ji(De.Num),atan:ji(De.Num),sinh:ji(De.Num),cosh:ji(De.Num),tanh:ji(De.Num),exp:ji(De.Num),log:ji(De.Num),log10:ji(De.Num),atan2:ml(De.Num,De.Num)},CFe={"@header":"Strings",concat:Cf(De.Str),match:Bt(Rt.Dictionary({0:vt(Er.Regex),1:vt(De.Str)}),De.Bool)},_Fe={"@header":"Lists",getAt:Bt(Rt.Dictionary({0:vt(Er.List()),1:vt(De.Num)}),Er.AnyVar),equal:Bt(Rt.Dictionary({0:vt(Er.List()),1:vt(Er.List())}),De.Bool)},wFe={"@header":"Sets",has:Bt(Rt.Dictionary({0:vt(Er.Set(Er.ConstrainedVar)),1:vt(Er.ConstrainedVar)}),De.Bool,"Check if the the 1st argument includes the value of the 2nd."),isSubset:Bt(Rt.Dictionary({0:vt(Er.Set(Er.ConstrainedVar)),1:vt(Er.Set(Er.ConstrainedVar))}),De.Bool,"Check if the the 1st argument is a subset of the 2nd.")},EFe={"@header":"Flags",hasAny:Bt(Rt.Dictionary({0:vt(Er.Flags(Er.ConstrainedVar)),1:vt(Er.Flags(Er.ConstrainedVar))}),De.Bool,"Check if the the 1st argument has at least one of the 2nd one's flags."),hasAll:Bt(Rt.Dictionary({0:vt(Er.Flags(Er.ConstrainedVar)),1:vt(Er.Flags(Er.ConstrainedVar))}),De.Bool,"Check if the the 1st argument has all 2nd one's flags.")},RL={"@header":"Language Primitives",type:gFe,logic:yFe,ctrl:bFe,rel:xFe,math:SFe,str:CFe,list:_Fe,set:wFe,flags:EFe};MJ(RL);var AFe=DJ(RL);(function(){for(var e=Object.create(null),t=0,r=AFe;t<r.length;t++){var n=r[t];e[n.id]=n}return e})();var At;(function(e){e.ElementSymbol=De.Value("Structure","ElementSymbol"),e.AtomName=De.Value("Structure","AtomName"),e.BondFlag=De.OneOf("Structure","BondFlag",De.Str,["covalent","metallic","ion","hydrogen","sulfide","computed","aromatic"]),e.BondFlags=Er.Flags(e.BondFlag,"BondFlags"),e.SecondaryStructureFlag=De.OneOf("Structure","SecondaryStructureFlag",De.Str,["alpha","beta","3-10","pi","sheet","strand","helix","turn","none"]),e.SecondaryStructureFlags=Er.Flags(e.SecondaryStructureFlag,"SecondaryStructureFlag"),e.RingFingerprint=De.Value("Structure","RingFingerprint"),e.EntityType=De.OneOf("Structure","EntityType",De.Str,["polymer","non-polymer","water","branched"]),e.EntitySubtype=De.OneOf("Structure","EntitySubtype",De.Str,["other","polypeptide(D)","polypeptide(L)","polydeoxyribonucleotide","polyribonucleotide","polydeoxyribonucleotide/polyribonucleotide hybrid","cyclic-pseudo-peptide","peptide nucleic acid","oligosaccharide"]),e.ObjectPrimitive=De.OneOf("Structure","ObjectPrimitive",De.Str,["atomistic","sphere","gaussian","other"]),e.ResidueId=De.Value("Structure","ResidueId"),e.ElementSet=De.Value("Structure","ElementSet"),e.ElementSelection=De.Value("Structure","ElementSelection"),e.ElementReference=De.Value("Structure","ElementReference"),e.ElementSelectionQuery=Er.Fn(e.ElementSelection,"ElementSelectionQuery")})(At||(At={}));var PFe={"@header":"Types",elementSymbol:Bt(Rt.Dictionary({0:vt(De.Str)}),At.ElementSymbol,"Create element symbol representation from a string value."),atomName:Bt(Rt.Dictionary({0:vt(De.AnyValue)}),At.AtomName,"Convert a value to an atom name."),entityType:Bt(Rt.Dictionary({0:vt(At.EntityType)}),At.EntityType,"Create normalized representation of entity type: "+De.oneOfValues(At.EntityType).join(", ")+"."),bondFlags:Bt(Rt.List(At.BondFlag),At.BondFlags,"Create bond flags representation from a list of strings. Allowed flags: "+De.oneOfValues(At.BondFlag).join(", ")+"."),ringFingerprint:Bt(Rt.List(At.ElementSymbol,{nonEmpty:!0}),At.RingFingerprint,"Create ring fingerprint from the supplied atom element list."),secondaryStructureFlags:Bt(Rt.List(At.SecondaryStructureFlag),At.SecondaryStructureFlags,"Create secondary structure flags representation from a list of strings. Allowed flags: "+De.oneOfValues(At.SecondaryStructureFlag).join(", ")+"."),authResidueId:Bt(Rt.Dictionary({0:vt(De.Str,{description:"auth_asym_id"}),1:vt(De.Num,{description:"auth_seq_id"}),2:vt(De.Str,{description:"pdbx_PDB_ins_code",isOptional:!0})}),At.ResidueId,'Residue identifier based on "auth_" annotation.'),labelResidueId:Bt(Rt.Dictionary({0:vt(De.Str,{description:"label_entity_id"}),1:vt(De.Str,{description:"label_asym_id"}),2:vt(De.Num,{description:"label_seq_id"}),3:vt(De.Str,{description:"pdbx_PDB_ins_code",isOptional:!0})}),At.ResidueId,`Residue identifier based on mmCIF's "label_" annotation.`)},TFe={"@header":"Iteration Slots",element:Bt(Rt.None,At.ElementReference,"A reference to the current element."),elementSetReduce:Bt(Rt.None,De.Variable("a",De.AnyValue,!0),"Current value of the element set reducer.")},IFe={"@header":"Generators",all:Bt(Rt.None,At.ElementSelectionQuery,"The entire structure."),atomGroups:Bt(Rt.Dictionary({"entity-test":vt(De.Bool,{isOptional:!0,defaultValue:!0,description:"Test for the 1st atom of every entity"}),"chain-test":vt(De.Bool,{isOptional:!0,defaultValue:!0,description:"Test for the 1st atom of every chain"}),"residue-test":vt(De.Bool,{isOptional:!0,defaultValue:!0,description:"Test for the 1st atom every residue"}),"atom-test":vt(De.Bool,{isOptional:!0,defaultValue:!0}),"group-by":vt(De.Any,{isOptional:!0,defaultValue:"atom-key",description:"Group atoms to sets based on this property. Default: each atom has its own set"})}),At.ElementSelectionQuery,"Return all atoms for which the tests are satisfied, grouped into sets."),bondedAtomicPairs:Bt(Rt.Dictionary({0:vt(De.Bool,{isOptional:!0,defaultValue:"true for covalent bonds",description:"Test each bond with this predicate. Each bond is visited twice with swapped atom order."})}),At.ElementSelectionQuery,"Return all pairs of atoms for which the test is satisfied."),rings:Bt(Rt.Dictionary({fingerprint:vt(At.RingFingerprint,{isOptional:!0}),"only-aromatic":vt(De.Bool,{isOptional:!0,defaultValue:!1})}),At.ElementSelectionQuery,"Return all rings or those with the specified fingerprint and/or only aromatic rings."),queryInSelection:Bt(Rt.Dictionary({0:vt(At.ElementSelectionQuery),query:vt(At.ElementSelectionQuery),"in-complement":vt(De.Bool,{isOptional:!0,defaultValue:!1})}),At.ElementSelectionQuery,"Executes query only on atoms that are in the source selection."),empty:Bt(Rt.None,At.ElementSelectionQuery,"Nada.")},MFe={"@header":"Selection Modifications",queryEach:Bt(Rt.Dictionary({0:vt(At.ElementSelectionQuery),query:vt(At.ElementSelectionQuery)}),At.ElementSelectionQuery,"Query every atom set in the input selection separately."),intersectBy:Bt(Rt.Dictionary({0:vt(At.ElementSelectionQuery),by:vt(At.ElementSelectionQuery)}),At.ElementSelectionQuery,"Intersect each atom set from the first sequence from atoms in the second one."),exceptBy:Bt(Rt.Dictionary({0:vt(At.ElementSelectionQuery),by:vt(At.ElementSelectionQuery)}),At.ElementSelectionQuery,"Remove all atoms from 'selection' that occur in 'by'."),unionBy:Bt(Rt.Dictionary({0:vt(At.ElementSelectionQuery),by:vt(At.ElementSelectionQuery)}),At.ElementSelectionQuery,"For each atom set A in the orginal sequence, combine all atoms sets in the target selection that intersect with A."),union:Bt(Rt.Dictionary({0:vt(At.ElementSelectionQuery)}),At.ElementSelectionQuery,"Collects all atom sets in the sequence into a single atom set."),cluster:Bt(Rt.Dictionary({0:vt(At.ElementSelectionQuery),"min-distance":vt(De.Num,{isOptional:!0,defaultValue:0}),"max-distance":vt(De.Num),"min-size":vt(De.Num,{description:"Minimal number of sets to merge, must be at least 2",isOptional:!0,defaultValue:2}),"max-size":vt(De.Num,{description:"Maximal number of sets to merge, if not set, no limit",isOptional:!0})}),At.ElementSelectionQuery,"Combines atom sets that have mutual distance in the interval [min-radius, max-radius]. Minimum/maximum size determines how many atom sets can be combined."),includeSurroundings:Bt(Rt.Dictionary({0:vt(At.ElementSelectionQuery),radius:vt(De.Num),"atom-radius":vt(De.Num,{isOptional:!0,defaultValue:0,description:"Value added to each atom before the distance check, for example VDW radius. Using this argument is computationally demanding."}),"as-whole-residues":vt(De.Bool,{isOptional:!0})}),At.ElementSelectionQuery,"For each atom set in the selection, include all surrouding atoms/residues that are within the specified radius."),surroundingLigands:Bt(Rt.Dictionary({0:vt(At.ElementSelectionQuery),radius:vt(De.Num),"include-water":vt(De.Bool,{isOptional:!0,defaultValue:!0})}),At.ElementSelectionQuery,"Find all ligands components around the source query."),includeConnected:Bt(Rt.Dictionary({0:vt(At.ElementSelectionQuery),"bond-test":vt(De.Bool,{isOptional:!0,defaultValue:"true for covalent bonds"}),"layer-count":vt(De.Num,{isOptional:!0,defaultValue:1,description:"Number of bonded layers to include."}),"fixed-point":vt(De.Bool,{isOptional:!0,defaultValue:!1,description:"Continue adding layers as long as new connections exist."}),"as-whole-residues":vt(De.Bool,{isOptional:!0})}),At.ElementSelectionQuery,"Pick all atom sets that are connected to the target."),wholeResidues:Bt(Rt.Dictionary({0:vt(At.ElementSelectionQuery)}),At.ElementSelectionQuery,"Expand the selection to whole residues."),expandProperty:Bt(Rt.Dictionary({0:vt(At.ElementSelectionQuery),property:vt(De.AnyValue)}),At.ElementSelectionQuery,"To each atom set in the selection, add all atoms that have the same property value that was already present in the set.")},DFe={"@header":"Selection Filters",pick:Bt(Rt.Dictionary({0:vt(At.ElementSelectionQuery),test:vt(De.Bool)}),At.ElementSelectionQuery,"Pick all atom sets that satisfy the test."),first:Bt(Rt.Dictionary({0:vt(At.ElementSelectionQuery)}),At.ElementSelectionQuery,"Take the 1st atom set in the sequence."),withSameAtomProperties:Bt(Rt.Dictionary({0:vt(At.ElementSelectionQuery),source:vt(At.ElementSelectionQuery),property:vt(De.Any)}),At.ElementSelectionQuery,"Pick all atom sets for which the set of given atom properties is a subset of the source properties."),intersectedBy:Bt(Rt.Dictionary({0:vt(At.ElementSelectionQuery),by:vt(At.ElementSelectionQuery)}),At.ElementSelectionQuery,"Pick all atom sets that have non-zero intersection with the target."),within:Bt(Rt.Dictionary({0:vt(At.ElementSelectionQuery),target:vt(At.ElementSelectionQuery),"min-radius":vt(De.Num,{isOptional:!0,defaultValue:0}),"max-radius":vt(De.Num),"atom-radius":vt(De.Num,{isOptional:!0,defaultValue:0,description:"Value added to each atom before the distance check, for example VDW radius. Using this argument is computationally demanding."}),invert:vt(De.Bool,{isOptional:!0,defaultValue:!1,description:"If true, pick only atom sets that are further than the specified radius."})}),At.ElementSelectionQuery,"Pick all atom sets from selection that have any atom within the radius of any atom from target."),isConnectedTo:Bt(Rt.Dictionary({0:vt(At.ElementSelectionQuery),target:vt(At.ElementSelectionQuery),"bond-test":vt(De.Bool,{isOptional:!0,defaultValue:"true for covalent bonds"}),disjunct:vt(De.Bool,{isOptional:!0,defaultValue:!0,description:"If true, there must exist a bond to an atom that lies outside the given atom set to pass test."}),invert:vt(De.Bool,{isOptional:!0,defaultValue:!1,description:"If true, return atom sets that are not connected."})}),At.ElementSelectionQuery,"Pick all atom sets that are connected to the target.")},RFe={"@header":"Selection Combinators",intersect:Bt(Rt.List(At.ElementSelectionQuery),At.ElementSelectionQuery,"Return all unique atom sets that appear in all of the source selections."),merge:Bt(Rt.List(At.ElementSelectionQuery),At.ElementSelectionQuery,"Merges multiple selections into a single one. Only unique atom sets are kept."),distanceCluster:Bt(Rt.Dictionary({matrix:vt(Er.List(Er.List(De.Num)),{description:"Distance matrix, represented as list of rows (num[][])). Lower triangle is min distance, upper triangle is max distance."}),selections:vt(Er.List(At.ElementSelectionQuery),{description:"A list of held selections."})}),At.ElementSelectionQuery,"Pick combinations of atom sets from the source sequences that are mutually within distances specified by a matrix.")},kFe={"@header":"Atom Sets",atomCount:Bt(Rt.None,De.Num),countQuery:Bt(Rt.Dictionary({0:vt(At.ElementSelectionQuery)}),De.Num,"Counts the number of occurences of a specific query inside the current atom set."),reduce:Bt(Rt.Dictionary({initial:vt(De.Variable("a",De.AnyValue,!0),{description:"Initial value assigned to slot.atom-set-reduce. Current atom is set to the 1st atom of the current set for this."}),value:vt(De.Variable("a",De.AnyValue,!0),{description:"Expression executed for each atom in the set"})}),De.Variable("a",De.AnyValue,!0),"Execute the value expression for each atom in the current atom set and return the result. Works the same way as Array.reduce in JavaScript (``result = value(value(...value(initial)))``)"),propertySet:Bt(Rt.Dictionary({0:vt(Er.ConstrainedVar)}),Er.Set(Er.ConstrainedVar),"Returns a set with all values of the given property in the current atom set.")},OFe={"@header":"Atom Properties",core:{"@header":"Core Properties",elementSymbol:Cr(At.ElementSymbol),vdw:Cr(De.Num,"Van der Waals radius"),mass:Cr(De.Num,"Atomic weight"),atomicNumber:Cr(De.Num,"Atomic number"),x:Cr(De.Num,"Cartesian X coordinate"),y:Cr(De.Num,"Cartesian Y coordinate"),z:Cr(De.Num,"Cartesian Z coordinate"),atomKey:Cr(De.AnyValue,"Unique value for each atom. Main use case is grouping of atoms."),bondCount:Bt(Rt.Dictionary({0:vt(At.ElementReference,{isOptional:!0,defaultValue:"slot.current-atom"}),flags:vt(At.BondFlags,{isOptional:!0,defaultValue:"covalent"})}),De.Num,"Number of bonds (by default only covalent bonds are counted)."),sourceIndex:Cr(De.Num,"Index of the atom/element in the input file."),operatorName:Cr(De.Str,"Name of the symmetry operator applied to this element."),modelIndex:Cr(De.Num,"Index of the model in the input file."),modelLabel:Cr(De.Str,"Label/header of the model in the input file.")},topology:{connectedComponentKey:Cr(De.AnyValue,"Unique value for each connected component.")},macromolecular:{"@header":"Macromolecular Properties (derived from the mmCIF format)",authResidueId:Cr(At.ResidueId,"type.auth-residue-id symbol executed on current atom's residue"),labelResidueId:Cr(At.ResidueId,"type.label-residue-id symbol executed on current atom's residue"),residueKey:Cr(De.AnyValue,"Unique value for each tuple ``(label_entity_id,auth_asym_id, auth_seq_id, pdbx_PDB_ins_code)``, main use case is grouping of atoms"),chainKey:Cr(De.AnyValue,"Unique value for each tuple ``(label_entity_id, auth_asym_id)``, main use case is grouping of atoms"),entityKey:Cr(De.AnyValue,"Unique value for each tuple ``label_entity_id``, main use case is grouping of atoms"),isHet:Cr(De.Bool,"Equivalent to atom_site.group_PDB !== ATOM"),id:Cr(De.Num,"_atom_site.id"),label_atom_id:Cr(At.AtomName),label_alt_id:Cr(De.Str),label_comp_id:Cr(De.Str),label_asym_id:Cr(De.Str),label_entity_id:Cr(De.Str),label_seq_id:Cr(De.Num),auth_atom_id:Cr(At.AtomName),auth_comp_id:Cr(De.Str),auth_asym_id:Cr(De.Str),auth_seq_id:Cr(De.Num),pdbx_PDB_ins_code:Cr(De.Str),pdbx_formal_charge:Cr(De.Num),occupancy:Cr(De.Num),B_iso_or_equiv:Cr(De.Num),entityType:Cr(At.EntityType,"Type of the entity as defined in mmCIF (polymer, non-polymer, branched, water)"),entitySubtype:Cr(At.EntitySubtype,"Subtype of the entity as defined in mmCIF _entity_poly.type and _pdbx_entity_branch.type (other, polypeptide(D), polypeptide(L), polydeoxyribonucleotide, polyribonucleotide, polydeoxyribonucleotide/polyribonucleotide hybrid, cyclic-pseudo-peptide, peptide nucleic acid, oligosaccharide)"),entityPrdId:Cr(De.Str,"The PRD ID of the entity."),entityDescription:Cr(Er.List(De.Str)),objectPrimitive:Cr(At.ObjectPrimitive,"Type of the primitive object used to model this segment as defined in mmCIF/IHM (atomistic, sphere, gaussian, other)"),secondaryStructureKey:Cr(De.AnyValue,"Unique value for each secondary structure element."),secondaryStructureFlags:Cr(At.SecondaryStructureFlags),isModified:Cr(De.Bool,"True if the atom belongs to modification of a standard residue."),modifiedParentName:Cr(De.Str,"'3-letter' code of the modifed parent residue."),isNonStandard:Cr(De.Bool,"True if this is a non-standard residue."),chemCompType:Cr(De.Str,"Type of the chemical component as defined in mmCIF.")}},LFe={"@header":"Bond Properties",flags:uy(At.BondFlags),order:uy(De.Num),length:uy(De.Num),atomA:uy(At.ElementReference),atomB:uy(At.ElementReference)};function Cr(e,t){return Bt(Rt.Dictionary({0:vt(At.ElementReference,{isOptional:!0,defaultValue:"slot.current-atom"})}),e,t)}function uy(e,t){return Bt(Rt.None,e,t)}var FFe={"@header":"Structure Queries",type:PFe,slot:TFe,generator:IFe,modifier:MFe,filter:DFe,combinator:RFe,atomSet:kFe,atomProperty:OFe,bondProperty:LFe},NFe={"@header":"Generators",bundleElement:Bt(Rt.Dictionary({groupedUnits:vt(De.Any),set:vt(De.Any),ranges:vt(De.Any)}),De.Any),bundle:Bt(Rt.Dictionary({elements:vt(De.Any)}),At.ElementSelectionQuery,"A selection with single structure containing represented by the bundle."),current:Bt(Rt.None,At.ElementSelectionQuery,"Current selection provided by the query context. Avoid using this in State Transforms.")},BFe={"@header":"Internal Queries",generator:NFe},Ce={core:RL,structureQuery:FFe,internal:BFe};MJ(Ce);var UFe=DJ(Ce);(function(){for(var e=Object.create(null),t=0,r=UFe;t<r.length;t++){var n=r[t];e[n.id]=n}return e})();var se;(function(e){e.core=Ce.core,e.struct=Ce.structureQuery,e.internal=Ce.internal;function t(y){return e.struct.type.atomName([y])}e.atomName=t;function r(y){return e.struct.type.elementSymbol([y])}e.es=r;function n(){for(var y=[],b=0;b<arguments.length;b++)y[b]=arguments[b];return e.core.type.list(y)}e.list=n;function i(){for(var y=[],b=0;b<arguments.length;b++)y[b]=arguments[b];return e.core.type.set(y)}e.set=i;function a(y,b){return e.core.type.regex([y,b])}e.re=a;function o(y){return e.core.ctrl.fn([y])}e.fn=o;function s(y){return e.core.ctrl.eval([y])}e.evaluate=s;var u=e.struct.atomProperty.core,l=e.struct.atomProperty.macromolecular,c=e.struct.atomProperty.topology;function d(y){return u[y]()}e.acp=d;function f(y){return c[y]()}e.atp=f;function p(y){return l[y]()}e.ammp=p;var v=e.struct.atomSet.propertySet;function h(y){return v([d(y)])}e.acpSet=h;function m(y){return v([f(y)])}e.atpSet=m;function g(y){return v([p(y)])}e.ammpSet=g})(se||(se={}));var rd=function(){function e(){this.count=0,this.center=_(),this.radiusSq=0}return e.prototype.reset=function(){_.set(this.center,0,0,0),this.radiusSq=0,this.count=0},e.prototype.includeStep=function(t){_.add(this.center,this.center,t),this.count++},e.prototype.finishedIncludeStep=function(){this.count!==0&&_.scale(this.center,this.center,1/this.count)},e.prototype.radiusStep=function(t){var r=_.squaredDistance(t,this.center);r>this.radiusSq&&(this.radiusSq=r)},e.prototype.radiusSphereStep=function(t,r){var n=_.distance(t,this.center)+r,i=n*n;i>this.radiusSq&&(this.radiusSq=i)},e.prototype.getSphere=function(t){return t||(t=Be()),_.copy(t.center,this.center),t.radius=Math.sqrt(this.radiusSq),t},e.prototype.getCount=function(){return this.count},e}();(function(e){var t=new e,r=_(),n=_();function i(s,u){var l=s.x,c=s.y,d=s.z;t.reset();for(var f=l.length,p=0;p<f;p++)_.set(r,l[p],c[p],d[p]),t.includeStep(r);t.finishedIncludeStep();for(var p=0;p<f;p++)_.set(r,l[p],c[p],d[p]),t.radiusStep(r);return _.copy(u.center,t.center),u.radius=Math.sqrt(t.radiusSq),u}e.fromArrays=i;function a(s,u,l){t.reset();for(var c=0;c<s;c++)u(c,r),t.includeStep(r);t.finishedIncludeStep();for(var c=0;c<s;c++)u(c,r),t.radiusStep(r);return _.copy(l.center,t.center),l.radius=Math.sqrt(t.radiusSq),l}e.fromProvider=a;function o(s,u,l){t.reset();for(var c=0;c<s;c++)u(c,r,n),t.includeStep(r),t.includeStep(n);t.finishedIncludeStep();for(var c=0;c<s;c++)u(c,r,n),t.radiusStep(r),t.radiusStep(n);return _.copy(l.center,t.center),l.radius=Math.sqrt(t.radiusSq),l}e.fromPairProvider=o})(rd||(rd={}));var pv=function(){function e(t){this.map=t;var r=0,n=[],i=new Map,a=new Map;this.map.forEach(function(o){o.forEach(function(s){r+=s.edgeCount,s.connectedIndices.forEach(function(u){s.getEdges(u).forEach(function(l){var c=s.unitA,d=s.unitB,f=e.getEdgeKey(u,c,l.indexB,d);i.set(f,n.length);var p=e.getVertexKey(u,c),v=a.get(p);v===void 0?a.set(p,[n.length]):v.push(n.length),n.push(E(E({},l),{indexA:u,unitA:c,unitB:d}))})})})}),this.edgeCount=r,this.edges=n,this.edgeKeyIndex=i,this.vertexKeyIndex=a}return e.prototype.getConnectedUnits=function(t){return this.map.has(t)?this.map.get(t):OJ},e.prototype.getEdgeIndex=function(t,r,n,i){var a=e.getEdgeKey(t,r,n,i),o=this.edgeKeyIndex.get(a);return o!==void 0?o:-1},e.prototype.hasEdge=function(t,r,n,i){return this.getEdgeIndex(t,r,n,i)!==-1},e.prototype.getEdge=function(t,r,n,i){var a=this.getEdgeIndex(t,r,n,i);return a!==-1?this.edges[a]:void 0},e.prototype.getEdgeIndices=function(t,r){return this.vertexKeyIndex.get(e.getVertexKey(t,r))||[]},e}();(function(e){var t=function(){function o(s,u,l,c,d){this.unitA=s,this.unitB=u,this.edgeCount=l,this.connectedIndices=c,this.edgeMap=d}return o.prototype.hasEdges=function(s){return this.edgeMap.has(s)},o.prototype.getEdges=function(s){return this.edgeMap.has(s)?this.edgeMap.get(s):OJ},Object.defineProperty(o.prototype,"areUnitsOrdered",{get:function(){return this.unitA<this.unitB},enumerable:!1,configurable:!0}),o}();e.UnitPairEdges=t;function r(o,s,u,l){return o+"|"+s+"|"+u+"|"+l}e.getEdgeKey=r;function n(o,s){return o+"|"+s}e.getVertexKey=n;function i(o,s,u){o.has(s)?o.get(s).push(u):o.set(s,[u])}var a=function(){function o(){this.map=new Map}return o.prototype.startUnitPair=function(s,u){this.uA=s,this.uB=u,this.mapAB=new Map,this.mapBA=new Map,this.linkedA=tn.create(),this.linkedB=tn.create(),this.linkCount=0},o.prototype.finishUnitPair=function(){this.linkCount!==0&&(i(this.map,this.uA,new t(this.uA,this.uB,this.linkCount,this.linkedA.array,this.mapAB)),i(this.map,this.uB,new t(this.uB,this.uA,this.linkCount,this.linkedB.array,this.mapBA)))},o.prototype.add=function(s,u,l){i(this.mapAB,s,{indexB:u,props:l}),i(this.mapBA,u,{indexB:s,props:l}),tn.add(this.linkedA,s,s),tn.add(this.linkedB,u,u),this.linkCount+=1},o.prototype.getMap=function(){return this.map},o}();e.Builder=a})(pv||(pv={}));var OJ=[],lD;(function(e){e.Empty=Io.create([],[],[],0,{flags:[],order:[]})})(lD||(lD={}));var x1=function(e){Fe(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.getBondFromLocation=function(r){return je.isAtomic(r.aUnit)&&je.isAtomic(r.bUnit)?this.getEdge(r.aIndex,r.aUnit.id,r.bIndex,r.bUnit.id):void 0},t.prototype.getBondIndexFromLocation=function(r){return je.isAtomic(r.aUnit)&&je.isAtomic(r.bUnit)?this.getEdgeIndex(r.aIndex,r.aUnit.id,r.bIndex,r.bUnit.id):-1},t}(pv);(function(e){var t=function(r){Fe(n,r);function n(){return r!==null&&r.apply(this,arguments)||this}return n}(pv.UnitPairEdges);e.UnitPairBonds=t})(x1||(x1={}));var LJ={forceCompute:!1,noCompute:!1},kL={H:0,h:0,D:0,d:0,T:0,t:0,He:2,HE:2,he:2,Li:3,LI:3,li:3,Be:4,BE:4,be:4,B:5,b:5,C:6,c:6,N:7,n:7,O:8,o:8,F:9,f:9,Ne:10,NE:10,ne:10,Na:11,NA:11,na:11,Mg:12,MG:12,mg:12,Al:13,AL:13,al:13,Si:14,SI:14,si:14,P:15,p:15,S:16,s:16,Cl:17,CL:17,cl:17,Ar:18,AR:18,ar:18,K:19,k:19,Ca:20,CA:20,ca:20,Sc:21,SC:21,sc:21,Ti:22,TI:22,ti:22,V:23,v:23,Cr:24,CR:24,cr:24,Mn:25,MN:25,mn:25,Fe:26,FE:26,fe:26,Co:27,CO:27,co:27,Ni:28,NI:28,ni:28,Cu:29,CU:29,cu:29,Zn:30,ZN:30,zn:30,Ga:31,GA:31,ga:31,Ge:32,GE:32,ge:32,As:33,AS:33,as:33,Se:34,SE:34,se:34,Br:35,BR:35,br:35,Kr:36,KR:36,kr:36,Rb:37,RB:37,rb:37,Sr:38,SR:38,sr:38,Y:39,y:39,Zr:40,ZR:40,zr:40,Nb:41,NB:41,nb:41,Mo:42,MO:42,mo:42,Tc:43,TC:43,tc:43,Ru:44,RU:44,ru:44,Rh:45,RH:45,rh:45,Pd:46,PD:46,pd:46,Ag:47,AG:47,ag:47,Cd:48,CD:48,cd:48,In:49,IN:49,in:49,Sn:50,SN:50,sn:50,Sb:51,SB:51,sb:51,Te:52,TE:52,te:52,I:53,i:53,Xe:54,XE:54,xe:54,Cs:55,CS:55,cs:55,Ba:56,BA:56,ba:56,La:57,LA:57,la:57,Ce:58,CE:58,ce:58,Pr:59,PR:59,pr:59,Nd:60,ND:60,nd:60,Pm:61,PM:61,pm:61,Sm:62,SM:62,sm:62,Eu:63,EU:63,eu:63,Gd:64,GD:64,gd:64,Tb:65,TB:65,tb:65,Dy:66,DY:66,dy:66,Ho:67,HO:67,ho:67,Er:68,ER:68,er:68,Tm:69,TM:69,tm:69,Yb:70,YB:70,yb:70,Lu:71,LU:71,lu:71,Hf:72,HF:72,hf:72,Ta:73,TA:73,ta:73,W:74,w:74,Re:75,RE:75,re:75,Os:76,OS:76,os:76,Ir:77,IR:77,ir:77,Pt:78,PT:78,pt:78,Au:79,AU:79,au:79,Hg:80,HG:80,hg:80,Tl:81,TL:81,tl:81,Pb:82,PB:82,pb:82,Bi:83,BI:83,bi:83,Po:84,PO:84,po:84,At:85,AT:85,at:85,Rn:86,RN:86,rn:86,Fr:87,FR:87,fr:87,Ra:88,RA:88,ra:88,Ac:89,AC:89,ac:89,Th:90,TH:90,th:90,Pa:91,PA:91,pa:91,U:92,u:92,Np:93,NP:93,np:93,Pu:94,PU:94,pu:94,Am:95,AM:95,am:95,Cm:96,CM:96,cm:96,Bk:97,BK:97,bk:97,Cf:98,CF:98,cf:98,Es:99,ES:99,es:99,Fm:100,FM:100,fm:100,Md:101,MD:101,md:101,No:102,NO:102,no:102,Lr:103,LR:103,lr:103,Rf:104,RF:104,rf:104,Db:105,DB:105,db:105,Sg:106,SG:106,sg:106,Bh:107,BH:107,bh:107,Hs:108,HS:108,hs:108,Mt:109,MT:109,mt:109},jFe={0:1.42,1:1.42,3:2.7,4:2.7,6:1.75,7:1.6,8:1.52,11:2.7,12:2.7,13:2.7,14:1.9,15:2,16:1.9,17:1.8,19:2.7,20:2.7,21:2.7,22:2.7,23:2.7,24:2.7,25:2.7,26:2.7,27:2.7,28:2.7,29:2.7,30:2.7,31:2.7,33:2.68,37:2.7,38:2.7,39:2.7,40:2.7,41:2.7,42:2.7,43:2.7,44:2.7,45:2.7,46:2.7,47:2.7,48:2.7,49:2.7,50:2.7,55:2.7,56:2.7,57:2.7,58:2.7,59:2.7,60:2.7,61:2.7,62:2.7,63:2.7,64:2.7,65:2.7,66:2.7,67:2.7,68:2.7,69:2.7,70:2.7,71:2.7,72:2.7,73:2.7,74:2.7,75:2.7,76:2.7,77:2.7,78:2.7,79:2.7,80:2.7,81:2.7,82:2.7,83:2.7,87:2.7,88:2.7,89:2.7,90:2.7,91:2.7,92:2.7,93:2.7,94:2.7,95:2.7,96:2.7,97:2.7,98:2.7,99:2.7,100:2.7,101:2.7,102:2.7,103:2.7,104:2.7,105:2.7,106:2.7,107:2.7,108:2.7,109:2.88},zFe={0:.8,20:1.31,27:1.2,35:1.15,44:1.1,54:1,60:1.84,72:1.88,84:1.75,85:1.56,86:1.76,98:1.6,99:1.68,100:1.63,112:1.6,113:1.59,114:1.36,129:1.45,135:1.47,144:1.6,152:1.45,170:1.4,180:1.55,202:2.4,222:2.24,224:1.91,225:1.98,243:2.02,269:2,293:1.9,316:1.8,420:2.37,480:2.3,512:2.3,544:2.3,612:2.1,629:1.54,665:1,813:2.6,854:2.27,894:1.93,896:2.1,937:2.05,938:2.06,981:1.62,1258:2.68,1309:2.33,1484:1,1763:2.14,1823:2.48,1882:2.1,1944:1.72,2380:2.34,3367:2.44,3733:2.11,3819:2.6,3821:2.36,4736:2.75,5724:2.73,5959:2.63,6519:2.84,6750:2.87,8991:2.81},kU=2.001,Pb=function(){for(var e=["LI","NA","K","RB","CS","FR","BE","MG","CA","SR","BA","RA","AL","GA","IN","SN","TL","PB","BI","SC","TI","V","CR","MN","FE","CO","NI","CU","ZN","Y","ZR","NB","MO","TC","RU","RH","PD","AG","CD","LA","HF","TA","W","RE","OS","IR","PT","AU","HG","AC","RF","DB","SG","BH","HS","MT","CE","PR","ND","PM","SM","EU","GD","TB","DY","HO","ER","TM","YB","LU","TH","PA","U","NP","PU","AM","CM","BK","CF","ES","FM","MD","NO","LR"],t=new Set,r=0,n=e;r<n.length;r++){var i=n[r];t.add(kL[i])}return t}();function VFe(e,t){return e<t?(e+t)*(e+t+1)/2+t:(e+t)*(e+t+1)/2+e}function Wg(e){var t=kL[e];return t===void 0?-1:t}function FJ(e,t){if(e<0||t<0)return-1;var r=zFe[VFe(e,t)];return r===void 0?-1:r}function $_(e){if(e<0)return kU;var t=jFe[e];return t===void 0?kU:t}var HFe=kL.H;function Tb(e){return e===HFe}function NJ(e,t,r,n,i,a){for(var o=new Io.EdgeBuilder(i,e,t),s=new Uint16Array(o.slotCount),u=new Int8Array(o.slotCount),l=0,c=o.edgeCount;l<c;l++)o.addNextEdge(),o.assignProperty(s,n[l]),o.assignProperty(u,r[l]);return o.createGraph({flags:s,order:u},{canRemap:a})}var OU=_(),LU=_();function GFe(e,t,r){return e.conformation.position(t,OU),e.conformation.position(r,LU),_.distance(OU,LU)}var qFe=new Set;function $Fe(e){for(var t=xa.Provider.get(e.model),r=e.elements,n=e.model.atomicHierarchy.atoms.type_symbol,i=e.elements.length,a=t.edgeProps,o=e.model.atomicHierarchy.atomSourceIndex,s=$t.getInvertedAtomSourceIndex(e.model).invertedIndex,u=[],l=[],c=[],d=[],f=0;f<i;f++)for(var p=r[f],v=n.value(p)==="H",h=o.value(p),m=t.offset[h],g=t.offset[h+1];m<g;++m){var y=s[t.b[m]];if(!(p>=y)){var b=Je.indexOf(e.elements,y);if(!(b<0)&&!(v&&n.value(y)==="H")){var S=a.distance[m];(S===-1||S===void 0||yn(GFe(e,p,y),S,.5))&&(u[u.length]=f,l[l.length]=b,d[d.length]=a.order[m],c[c.length]=a.flag[m])}}}return NJ(u,l,d,c,i,!1)}function WFe(e,t){for(var r=4,n=e.model.atomicConformation,i=n.x,a=n.y,o=n.z,s=e.elements.length,u=e.elements,l=e.residueIndex,c=e.chainIndex,d=e.model.atomicHierarchy.atoms,f=d.type_symbol,p=d.label_atom_id,v=d.label_alt_id,h=d.label_comp_id,m=e.model.atomicHierarchy.residues.label_seq_id,g=e.model.atomicHierarchy.index,y=e.model.sequence.byEntityKey,b=e.lookup3d,S=jl.Provider.get(e.model),x=Ab.Provider.get(e.model),C=jl.isExhaustive(e.model),w=[],A=[],M=[],D=[],k=-1,R=void 0,O=!0,H=!0,B=!0,j=qFe,Y=0;Y<s;Y++){var G=u[Y],$=f.value(G);O&&($!=="H"||$!=="O")&&(O=!1);var q=t.forceCompute?void 0:S&&S.byAtomIndex.get(G),ee=!1;if(q)for(var fe=0,W=q;fe<W.length;fe++){var X=W[fe],U=X.partnerA,z=X.partnerB;if(U.symmetry===z.symmetry){var J=U.atomIndex===G?z:U,K=Je.indexOf(e.elements,J.atomIndex);K<0||(w[w.length]=Y,A[A.length]=K,M[M.length]=X.flags,D[D.length]=X.order,ee||j.clear(),ee=!0,j.add(K))}}if(!C){var Z=l[G],te=m.value(Z),le=h.value(G);if(!t.forceCompute&&Z!==k)if(x&&x.entries.has(le)){var ye=y[g.getEntityFromChain(c[G])];ye&&ye.sequence.microHet.has(te)?R=void 0:R=x.entries.get(le).map}else R=void 0;k=Z;for(var be=Wg($),Ae=p.value(G),Se=R?R.get(Ae):void 0,ie=b.find(i[G],a[G],o[G],r),oe=ie.indices,L=ie.count,V=ie.squaredDistances,he=Tb(be),we=$_(be),Te=v.value(G),ze=Pb.has(be),Ve=0;Ve<L;Ve++){var K=oe[Ve];if(!(ee&&j.has(K))){var Xe=u[K];if(!(Xe<=G)){var ct=v.value(Xe);if(!(Te&&ct&&Te!==ct)){var Ne=Wg(f.value(Xe)),Qe=Tb(Ne);if(!(he&&Qe)){var it=(ze||Pb.has(Ne))&&!(he||Qe),ot=l[Xe];if(Z===ot&&Se){var dt=Se.get(p.value(Xe));if(dt){w[w.length]=Y,A[A.length]=K,D[D.length]=dt.order;var ke=dt.flags;it&&(ke|1&&(ke^=1),ke|=2),M[M.length]=ke}continue}var Me=Math.sqrt(V[Ve]);if(Me!==0){var Ye=FJ(be,Ne),tt=Ye>0?Ye:Ne<0?we:(we+$_(Ne))/1.95;if(Me<=tt){w[w.length]=Y,A[A.length]=K,D[D.length]=lFe(le,Ae,p.value(Xe)),M[M.length]=(it?2:1)|32;var xt=m.value(ot);te===xt&&(H=!1),Math.abs(te-xt)>1&&(B=!1)}}}}}}}}}var ht=O||H&&B;return NJ(w,A,D,M,s,ht)}function XFe(e,t){var r=E(E({},LJ),t);return r.noCompute||$t.isCoarseGrained(e.model)?lD.Empty:!r.forceCompute&&xa.Provider.get(e.model)?$Fe(e):WFe(e,r)}var $y=4,FU=_(),NU=_();function BU(e,t,r,n){return e.conformation.position(t,FU),r.conformation.position(n,NU),_.distance(FU,NU)}var YFe=ue(),Np=_();function KFe(e,t,r,n){var i=e.elements,a=e.residueIndex,o=e.model.atomicConformation,s=o.x,u=o.y,l=o.z,c=t.elements,d=t.residueIndex,f=e.elements.length,p=e.model.atomicHierarchy.atoms,v=p.type_symbol,h=p.label_alt_id,m=p.label_atom_id,g=p.label_comp_id,y=t.model.atomicHierarchy.atoms,b=y.type_symbol,S=y.label_alt_id,x=y.label_atom_id,C=y.label_comp_id,w=e.model.atomicHierarchy.residues.auth_seq_id,A=t.model.atomicHierarchy.residues.auth_seq_id,M=e.model.atomicConformation.occupancy,D=t.model.atomicConformation.occupancy,k=M.isDefined&&D.isDefined,R=e.model===t.model&&jl.Provider.get(e.model),O=!r.forceCompute&&e.model===t.model&&xa.Provider.get(e.model),H=e.model.atomicHierarchy.atomSourceIndex,B=(O?$t.getInvertedAtomSourceIndex(t.model):{invertedIndex:void 0}).invertedIndex,j=e.model===t.model&&jl.isExhaustive(e.model),Y=ue.mul(YFe,t.conformation.operator.inverse,e.conformation.operator.matrix),G=!ue.isIdentity(Y),$=t.boundary.sphere,q=$.center,ee=$.radius,fe=(ee+$y)*(ee+$y);n.startUnitPair(e.id,t.id);for(var W=0;W<f;W++){var X=i[W];if(_.set(Np,s[X],u[X],l[X]),G&&_.transformMat4(Np,Np,Y),!(_.squaredDistance(Np,q)>fe)){if(!r.forceCompute&&O){for(var U=O.edgeProps,z=U.order,J=U.distance,K=U.flag,Z=H.value(X),te=O.offset[Z],le=O.offset[Z+1];te<le;++te){var ye=B[O.b[te]],be=Je.indexOf(t.elements,ye);if(!(be<0)&&!(v.value(X)==="H"&&b.value(ye)==="H")){var Ae=J[te];Ae!==-1&&yn(BU(e,X,t,ye),Ae,.5)&&n.add(W,be,{order:z[te],flag:K[te]})}}continue}var Se=r.forceCompute?void 0:R&&R.byAtomIndex.get(X);if(Se&&Se.length){for(var ie=!1,oe=0,L=Se;oe<L.length;oe++){var V=L[oe],he=V.partnerA,we=V.partnerB,Te=he.atomIndex===X?we:he,be=Je.indexOf(t.elements,Te.atomIndex);be<0||BU(e,X,t,Te.atomIndex)>$y||(n.add(W,be,{order:V.order,flag:V.flags}),ie=!0)}if(ie)continue}if(!j){var ze=M.value(X),Ve=t.lookup3d,Xe=Ve.find(Np[0],Np[1],Np[2],$y),ct=Xe.indices,Ne=Xe.count,Qe=Xe.squaredDistances;if(Ne!==0)for(var it=Wg(v.value(X)),ot=Tb(it),dt=$_(it),ke=h.value(X),Me=Pb.has(it),Ye=m.value(X),tt=g.value(a[X]),xt=0;xt<Ne;xt++){var be=ct[xt],ye=c[be],ht=S.value(ye);if(!(ke&&ht&&ke!==ht)&&!(k&&D.value(ye)<1&&ze<1&&w.value(X)===A.value(ye))){var ut=Wg(b.value(ye)),pe=Tb(ut);if(!(ot&&pe)){var me=(Me||Pb.has(ut))&&!(ot||pe),Ee=Math.sqrt(Qe[xt]);if(Ee!==0){var Ke=FJ(it,ut),gt=Ke>0?Ke:ut<0?dt:(dt+$_(ut))/1.95;if(Ee<=gt){var Pt=x.value(ye),Wt=C.value(d[ye]);n.add(W,be,{order:TJ(tt,Wt,Ye,Pt),flag:(me?2:1)|32})}}}}}}}}n.finishUnitPair()}function QFe(e,t){var r=new pv.Builder;if(t.noCompute||e.isCoarseGrained)return new x1(r.getMap());var n=e.models.length===1&&xa.Provider.get(e.model);if(n){for(var i=n.edgeProps.distance,a=!1,o=0,s=i.length;o<s;++o)if(i[o]!==-1){a=!0;break}if(!a)return new x1(r.getMap())}return We.eachUnitPair(e,function(u,l){KFe(u,l,t,r)},{maxRadius:$y,validUnit:function(u){return je.isAtomic(u)},validUnitPair:function(u,l){return t.validUnitPair(e,u,l)}}),new x1(r.getMap())}function ZFe(e,t){return QFe(e,E(E({},LJ),{validUnitPair:t&&t.validUnitPair||function(r,n,i){var a=n.model.atomicHierarchy.derived.residue.moleculeType,o=i.model.atomicHierarchy.derived.residue.moleculeType,s=(!je.isAtomic(n)||a[n.residueIndex[n.elements[0]]]!==2)&&(!je.isAtomic(i)||o[i.residueIndex[i.elements[0]]]!==2);return We.validUnitPair(r,n,i)&&s}}))}var Vt;(function(e){function t(h,m,g,y,b,S){return{kind:"bond-location",aStructure:h,aUnit:m,aIndex:g,bStructure:y,bUnit:b,bIndex:S}}e.Location=t;function r(h){return!!h&&h.kind==="bond-location"}e.isLocation=r;function n(h,m){return h.aStructure.label===m.aStructure.label&&h.bStructure.label===m.bStructure.label&&h.aIndex===m.aIndex&&h.bIndex===m.bIndex&&h.aUnit.id===m.aUnit.id&&h.bUnit.id===m.bUnit.id}e.areLocationsEqual=n;function i(h,m){return{kind:"bond-loci",structure:h,bonds:m}}e.Loci=i;function a(h){return!!h&&h.kind==="bond-loci"}e.isLoci=a;function o(h,m){if(h.structure!==m.structure||h.bonds.length!==m.bonds.length)return!1;for(var g=0,y=h.bonds.length;g<y;++g)if(!n(h.bonds[g],m.bonds[g]))return!1;return!0}e.areLociEqual=o;function s(h){return h.bonds.length===0}e.isLociEmpty=s;function u(h,m){if(m===h.structure)return h;var g=[];return h.bonds.forEach(function(y){var b=m.unitMap.get(y.aUnit.id);if(b){var S=m.unitMap.get(y.bUnit.id);if(S){var x=y.aUnit.elements[y.aIndex],C=Je.indexOf(b.elements,x);if(C!==-1){var w=y.bUnit.elements[y.bIndex],A=Je.indexOf(S.elements,w);A!==-1&&g.push(t(h.structure,b,C,h.structure,S,A))}}}}),i(m,g)}e.remapLoci=u;function l(h){for(var m=[],g=new Map,y=0,b=h.bonds;y<b.length;y++){var S=b[y],x=S.aIndex,C=S.aUnit,w=S.bIndex,A=S.bUnit;C===A?g.has(C.id)?g.get(C.id).push(x,w):g.set(C.id,[x,w]):(g.has(C.id)?g.get(C.id).push(x):g.set(C.id,[x]),g.has(A.id)?g.get(A.id).push(w):g.set(A.id,[w]))}return g.forEach(function(M,D){m.push({unit:h.structure.unitMap.get(D),indices:Je.deduplicate(Je.ofUnsortedArray(M))})}),Re(h.structure,m)}e.toStructureElementLoci=l;function c(h,m){if(m.aUnit===m.bUnit){var g=m.aUnit.bonds,y=g.getEdgeIndex(m.aIndex,m.bIndex);return y<0?Ur.create(0):Ur.create(g.edgeProps.flags[y])}else{var b=h.interUnitBonds.getBondFromLocation(m);return b?Ur.create(b.props.flag):Ur.create(0)}}e.getType=c;function d(h,m){if(m.aUnit===m.bUnit){var g=m.aUnit.bonds,y=g.getEdgeIndex(m.aIndex,m.bIndex);return y<0?0:g.edgeProps.order[y]}else{var b=h.interUnitBonds.getBondFromLocation(m);return b?b.props.order:0}}e.getOrder=d;function f(h){for(var m=0,g=0,y=h.units.length;g<y;++g){var b=h.units[g];je.isAtomic(b)&&(m+=b.bonds.edgeCount)}return m}e.getIntraUnitBondCount=f;var p=function(){function h(){this.current={},this.hasNext=!1}return h.prototype.move=function(){return this.advance(),this.current},h.prototype.setElement=function(m,g,y){this.structure=m,this.unit=g,this.index=y,this.interBondIndices=m.interUnitBonds.getEdgeIndices(y,g.id),this.interBondCount=this.interBondIndices.length,this.interBondIndex=0,this.intraBondEnd=g.bonds.offset[y+1],this.intraBondIndex=g.bonds.offset[y],this.hasNext=this.interBondIndex<this.interBondCount||this.intraBondIndex<this.intraBondEnd},h.prototype.advance=function(){if(this.intraBondIndex<this.intraBondEnd)this.current.otherUnit=this.unit,this.current.otherIndex=this.unit.bonds.b[this.intraBondIndex],this.current.type=this.unit.bonds.edgeProps.flags[this.intraBondIndex],this.current.order=this.unit.bonds.edgeProps.order[this.intraBondIndex],this.intraBondIndex+=1;else if(this.interBondIndex<this.interBondCount){var m=this.structure.interUnitBonds.edges[this.interBondIndex];this.current.otherUnit=this.structure.unitMap.get(m.unitA!==this.unit.id?m.unitA:m.unitB),this.current.otherIndex=m.indexA!==this.index?m.indexA:m.indexB,this.current.type=m.props.flag,this.current.order=m.props.order,this.interBondIndex+=1}else{this.hasNext=!1;return}this.hasNext=this.interBondIndex<this.interBondCount||this.intraBondIndex<this.intraBondEnd},h}();e.ElementBondIterator=p;function v(h,m){return rd.fromPairProvider(h.bonds.length,function(g,y,b){var S=h.bonds[g],x=S.aUnit,C=S.aIndex,w=S.bUnit,A=S.bIndex;x.conformation.position(x.elements[C],y),w.conformation.position(w.elements[A],b)},m)}e.getBoundingSphere=v})(Vt||(Vt={}));function JFe(e){for(var t=t6e(e),r=e6e(e,t),n=nr.transientSegments(e.model.atomicHierarchy.residueAtomSegments,e.elements);n.hasNext;){var i=n.move();r6e(r,i.start,i.end)}return r.rings}function e6e(e,t){return{startVertex:0,endVertex:0,count:0,visited:new Int32Array(t),queue:new Int32Array(t),pred:new Int32Array(t),left:new Int32Array(4),right:new Int32Array(4),color:new Int32Array(t),currentColor:0,currentAltLoc:"",hasAltLoc:!1,rings:[],currentRings:[],unit:e,bonds:e.bonds,altLoc:e.model.atomicHierarchy.atoms.label_alt_id}}function UU(e){e.count=e.endVertex-e.startVertex;for(var t=e.visited,r=e.pred,n=e.color,i=0;i<e.count;i++)t[i]=-1,r[i]=-1,n[i]=0;e.currentColor=0,e.currentAltLoc="",e.hasAltLoc=!1}function t6e(e){for(var t=nr.transientSegments(e.model.atomicHierarchy.residueAtomSegments,e.elements),r=0;t.hasNext;){var n=t.move();r=Math.max(r,n.end-n.start)}return r}function r6e(e,t,r){var n=e.visited;if(e.startVertex=t,e.endVertex=r,!(e.endVertex-e.startVertex<3)){e.currentRings=[];for(var i=e.unit.elements,a=[],o=e.startVertex;o<e.endVertex;o++){var s=e.altLoc.value(i[o]);Fa(a,s)}if(Nh(a,""),a.length===0){UU(e);for(var o=0;o<e.count;o++)n[o]>=0||jU(e,o)}else for(var u=0;u<a.length;u++){UU(e),e.hasAltLoc=!0,e.currentAltLoc=a[u];for(var o=0;o<e.count;o++)if(!(n[o]>=0)){var s=e.altLoc.value(i[e.startVertex+o]);s&&s!==e.currentAltLoc||jU(e,o)}}for(var o=0,l=e.currentRings.length;o<l;o++)e.rings.push(e.currentRings[o])}}function n6e(e,t,r){if(!(r<t)){for(var n=e.pred,i=e.color,a=e.left,o=e.right,s=++e.currentColor,u=t,l=0;l<4&&(i[u]=s,u=n[u],!(u<0));l++);var c=0,d=0,f=!1,p=0;u=r;for(var l=0;l<4;l++){if(i[u]===s){p=u,f=!0;break}if(o[d++]=u,u=n[u],u<0)break}if(f){u=t;for(var l=0;l<4&&(a[c++]=u,!(p===u||(u=n[u],u<0)));l++);var v=c+d;if(!(v<3)){for(var h=new Int32Array(v),m=0,l=0;l<c;l++)h[m++]=e.startVertex+a[l];for(var l=d-1;l>=0;l--)h[m++]=e.startVertex+o[l];if(Tu(h),e.hasAltLoc)for(var g=0,y=e.currentRings.length;g<y;g++){var b=e.currentRings[g];if(h[0]===b[0]&&h.length===b.length){for(var S=!0,x=0,C=h.length;x<C;x++)if(h[x]!==b[x]){S=!1;break}if(S)return}}e.currentRings.push(Je.ofSortedArray(h))}}}}function jU(e,t){var r=e.bonds,n=e.startVertex,i=e.endVertex,a=e.visited,o=e.queue,s=e.pred,u=e.unit.elements,l=r.b,c=r.edgeProps.flags,d=r.offset;a[t]=1,o[0]=t;for(var f=0,p=1;f<p;)for(var v=o[f++],h=n+v,m=d[h],g=d[h+1],y=m;y<g;y++){var b=l[y];if(!(b<n||b>=i||!Ur.isCovalent(c[y]))){if(e.hasAltLoc){var S=e.altLoc.value(u[b]);if(S&&e.currentAltLoc!==S)continue}var x=b-n;if(a[x]>0){s[x]!==v&&s[v]!==x&&n6e(e,v,x);continue}a[x]=1,o[p++]=x,s[x]=v}}}function i6e(e){for(var t=e.length,r=new Array(t),n=0;n<t;n++)r[n]=e[t-n-1];for(var i=zU(e),a=zU(r),o=!1,n=0;n<t;n++){var s=e[(n+i)%t],u=r[(n+a)%t];if(s!==u){o=s<u;break}}return o?VU(e,i):VU(r,a)}function zU(e){for(var t=e.length,r=new Int32Array(t*2),n=0;n<r.length;n++)r[n]=-1;for(var i="",a="",o=0,s=1;s<r.length;s++){for(var n=r[s-o-1];n!==-1&&(i=e[s%t],a=e[(o+n+1)%t],i!==a);)i<a&&(o=s-n-1),n=r[n];n===-1?(i=e[s%t],a=e[(o+n+1)%t],i!==a?(i<a&&(o=s),r[s-o]=-1):r[s-o]=n+1):r[s-o]=n+1}return o}function VU(e,t){var r=e.length,n=[],i;for(i=0;i<r-1;i++)n.push(e[(i+t)%r]),n.push("-");return n.push(e[(i+t)%r]),n.join("")}function a6e(e,t){for(var r=new Map,n=new Map,i=0,a=e.length;i<a;i++)for(var o=e[i],s=0,u=o.length;s<u;s++){var l=o[s];r.has(l)?r.get(l).push(i):r.set(l,[i])}for(var c=0,d=t.length;c<d;c++)for(var i=t[c],o=e[i],s=0,u=o.length;s<u;s++){var l=o[s];n.has(l)?n.get(l).push(i):n.set(l,[i])}for(var f=new Io.UniqueEdgeBuilder(e.length),i=0,a=e.length;i<a;i++)for(var o=e[i],s=0,u=o.length;s<u;s++){var l=o[s],p=r.get(l);if(p.length!==1)for(var v=0,h=p.length;v<h;v++){var m=p[v];i>=m||f.addEdge(i,m)}}for(var g=Io.connectedComponents(f.getGraph()),y=g.componentIndex,b=[],s=0;s<g.componentCount;s++)b[s]=[];for(var i=0,a=e.length;i<a;i++)b[y[i]].push(i);return{elementRingIndices:r,elementAromaticRingIndices:n,ringComponentIndex:y,ringComponents:b}}var Ir;(function(e){function t(f,p,v){v===void 0&&(v=Float32Array);var h=f*p;return{data:new v(h),size:h,cols:f,rows:p}}e.create=t;function r(f,p,v){return f.data[f.rows*v+p]}e.get=r;function n(f,p,v,h){return f.data[f.rows*v+p]=h,f}e.set=n;function i(f,p,v,h){return f.data[f.rows*v+p]+=h,f}e.add=i;function a(f){return f.data.fill(0),f}e.makeZero=a;function o(f){return{data:f.data.slice(),size:f.size,cols:f.cols,rows:f.rows}}e.clone=o;function s(f,p,v){return{data:f,size:p*v,cols:p,rows:v}}e.fromArray=s;function u(f,p){if(f.cols!==p.rows||f.rows!==p.cols)throw new Error("transpose: matrix dimensions incompatible");if(f.data===p.data)throw new Error("transpose: matrices share memory");for(var v=p.rows,h=p.cols,m=p.data,g=f.data,y=0,b=0,S=0;y<v;S+=1,b+=h,++y)for(var x=S,C=0;C<h;x+=v,C++)g[x]=m[b+C];return f}e.transpose=u;function l(f,p,v){for(var h=p.cols,m=p.rows,g=v.rows,y=p.data,b=v.data,S=f.data,x=0,C=0,w=0;x<m;C+=h,x++)for(var A=0,M=0;M<g;w++,M++){for(var D=0,k=C,R=0;R<h;k++,A++,R++)D+=y[k]*b[A];S[w]=D}return f}e.multiplyABt=l;function c(f){for(var p=f.rows,v=f.cols,h=f.data,m=new Array(v),g=0;g<v;++g)m[g]=0;for(var y=0,b=0;y<p;++y)for(var g=0;g<v;++g,++b)m[g]+=h[b];for(var g=0;g<v;++g)m[g]/=p;return m}e.meanRows=c;function d(f,p){for(var v=f.rows,h=f.cols,m=f.data,g=0,y=0;g<v;++g)for(var b=0;b<h;++b,++y)m[y]-=p[b];return f}e.subRows=d})(Ir||(Ir={}));function D4(e,t,r,n){n=e[t],e[t]=e[r],e[r]=n}function o6e(e,t){return e=Math.abs(e),t=Math.abs(t),e>t?(t/=e,e*Math.sqrt(1+t*t)):t>0?(e/=t,t*Math.sqrt(1+e*e)):0}var s6e=1192092896e-16,u6e=1e-37;function l6e(e,t,r,n,i,a,o,s){for(var u=s6e*2,l=u6e,c=0,d=0,f=0,p=0,v=Math.max(a,30),h=0,m=0,g=0,y=0,b=0,S=0,x=0,C=0,w=0,A=0,M=0,D=0,k=0,R=0,O=0,H=0,B=0,j=4660,Y=0,G=0,$=0,q=new Float64Array(o<<3);c<o;c++){for(f=0,M=0;f<a;f++)C=e[c*t+f],M+=C*C;if(q[c]=M,n){for(f=0;f<o;f++)n[c*i+f]=0;n[c*i+c]=1}}for(;p<v;p++){for(b=0,c=0;c<o-1;c++)for(d=c+1;d<o;d++){for(h=c*t|0,m=d*t|0,O=q[c],H=0,B=q[d],f=2,H+=e[h]*e[m],H+=e[h+1]*e[m+1];f<a;f++)H+=e[h+f]*e[m+f];if(!(Math.abs(H)<=u*Math.sqrt(O*B))){for(H*=2,D=O-B,k=o6e(H,D),D<0?(R=(k-D)*.5,x=Math.sqrt(R/k),S=H/(k*x*2)):(S=Math.sqrt((k+D)/(k*2)),x=H/(k*S*2)),O=0,B=0,f=2,w=S*e[h]+x*e[m],A=-x*e[h]+S*e[m],e[h]=w,e[m]=A,O+=w*w,B+=A*A,w=S*e[h+1]+x*e[m+1],A=-x*e[h+1]+S*e[m+1],e[h+1]=w,e[m+1]=A,O+=w*w,B+=A*A;f<a;f++)w=S*e[h+f]+x*e[m+f],A=-x*e[h+f]+S*e[m+f],e[h+f]=w,e[m+f]=A,O+=w*w,B+=A*A;if(q[c]=O,q[d]=B,b=1,n)for(g=c*i|0,y=d*i|0,f=2,w=S*n[g]+x*n[y],A=-x*n[g]+S*n[y],n[g]=w,n[y]=A,w=S*n[g+1]+x*n[y+1],A=-x*n[g+1]+S*n[y+1],n[g+1]=w,n[y+1]=A;f<o;f++)w=S*n[g+f]+x*n[y+f],A=-x*n[g+f]+S*n[y+f],n[g+f]=w,n[y+f]=A}}if(b===0)break}for(c=0;c<o;c++){for(f=0,M=0;f<a;f++)C=e[c*t+f],M+=C*C;q[c]=Math.sqrt(M)}for(c=0;c<o-1;c++){for(d=c,f=c+1;f<o;f++)q[d]<q[f]&&(d=f);if(c!==d&&(D4(q,c,d,M),n)){for(f=0;f<a;f++)D4(e,c*t+f,d*t+f,C);for(f=0;f<o;f++)D4(n,c*i+f,d*i+f,C)}}for(c=0;c<o;c++)r[c]=q[c];if(n)for(c=0;c<s;c++){for(M=c<o?q[c]:0;M<=l;){for(G=1/a,f=0;f<a;f++)j=j*214013+2531011,Y=j>>16&32767&256?G:-G,e[c*t+f]=Y;for(p=0;p<2;p++)for(d=0;d<c;d++){for(M=0,f=0;f<a;f++)M+=e[c*t+f]*e[d*t+f];for($=0,f=0;f<a;f++)C=e[c*t+f]-M*e[d*t+f],e[c*t+f]=C,$+=Math.abs(C);for($=$?1/$:0,f=0;f<a;f++)e[c*t+f]*=$}for(M=0,f=0;f<a;f++)C=e[c*t+f],M+=C*C;M=Math.sqrt(M)}for(x=1/M,f=0;f<a;f++)e[c*t+f]*=x}}function c6e(e,t,r,n){var i=0,a=0,o=e.rows,s=e.cols,u=o,l=s;u<l&&(i=1,a=u,u=l,l=a);var c=Ir.create(u,u),d=Ir.create(1,l),f=Ir.create(l,l);if(i===0)Ir.transpose(c,e);else{for(a=0;a<s*o;a++)c.data[a]=e.data[a];for(;a<l*u;a++)c.data[a]=0}if(l6e(c.data,u,d.data,f.data,l,u,l,u),t){for(a=0;a<l;a++)t.data[a]=d.data[a];for(;a<s;a++)t.data[a]=0}i===0?(r&&Ir.transpose(r,c),n&&Ir.transpose(n,f)):(r&&Ir.transpose(r,f),n&&Ir.transpose(n,c))}var hv;(function(e){function t(u){var l=r(u),c=s(u,l);return{momentsAxes:l,boxAxes:c}}e.ofPositions=t;function r(u){if(u.length===3)return _u.create(_.fromArray(_(),u,0),_.create(1,0,0),_.create(0,1,0),_.create(0,1,0));var l=Ir.fromArray(u,3,u.length/3),c=l.rows,d=c/3,f=Ir.create(3,3),p=Ir.create(1,3),v=Ir.create(3,3),h=Ir.create(3,3),m=Ir.meanRows(l),g=Ir.subRows(Ir.clone(l),m),y=Ir.transpose(Ir.create(c,3),g);Ir.multiplyABt(f,y,y),c6e(f,p,v,h);var b=_.create(m[0],m[1],m[2]),S=_.create(v.data[0],v.data[3],v.data[6]),x=_.create(v.data[1],v.data[4],v.data[7]),C=_.create(v.data[2],v.data[5],v.data[8]);return _.scale(S,S,Math.sqrt(p.data[0]/d)),_.scale(x,x,Math.sqrt(p.data[1]/d)),_.scale(C,C,Math.sqrt(p.data[2]/d)),_u.create(b,S,x,C)}e.calculateMomentsAxes=r;var n=_(),i=_(),a=_(),o=_();function s(u,l){if(u.length===3)return _u.clone(l);for(var c=-1/0,d=-1/0,f=-1/0,p=-1/0,v=-1/0,h=-1/0,m=_(),g=_(),y=l.origin,b=_.normalize(i,l.dirA),S=_.normalize(a,l.dirB),x=_.normalize(o,l.dirC),C=0,w=u.length;C<w;C+=3){_.projectPointOnVector(m,_.fromArray(m,u,C),b,y);var A=_.dot(b,_.normalize(g,_.sub(g,m,y))),M=_.distance(m,y);A>0?M>c&&(c=M):M>d&&(d=M),_.projectPointOnVector(m,_.fromArray(m,u,C),S,y);var D=_.dot(S,_.normalize(g,_.sub(g,m,y))),k=_.distance(m,y);D>0?k>f&&(f=k):k>p&&(p=k),_.projectPointOnVector(m,_.fromArray(m,u,C),x,y);var R=_.dot(x,_.normalize(g,_.sub(g,m,y))),O=_.distance(m,y);R>0?O>v&&(v=O):O>h&&(h=O)}var H=_.setMagnitude(_(),b,(c+d)/2),B=_.setMagnitude(_(),S,(f+p)/2),j=_.setMagnitude(_(),x,(v+h)/2),Y=_(),G=function($,q,ee){_.copy(n,y),_.scaleAndAdd(n,n,b,$),_.scaleAndAdd(n,n,S,q),_.scaleAndAdd(n,n,x,ee),_.add(Y,Y,n)};return G(c,f,v),G(c,f,-h),G(c,-p,-h),G(c,-p,v),G(-d,-p,-h),G(-d,-p,v),G(-d,f,v),G(-d,f,-h),_.scale(Y,Y,1/8),_u.create(Y,H,B,j)}e.calculateBoxAxes=s})(hv||(hv={}));var W_=function(){function e(t,r){this.unit=r,this.all=t}return Object.defineProperty(e.prototype,"index",{get:function(){return this._index?this._index:(this._index=a6e(this.all,this.aromaticRings),this._index)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"byFingerprint",{get:function(){return this._byFingerprint?this._byFingerprint:(this._byFingerprint=d6e(this.unit,this.all),this._byFingerprint)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"elementRingIndices",{get:function(){return this.index.elementRingIndices},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"elementAromaticRingIndices",{get:function(){return this.index.elementAromaticRingIndices},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"ringComponentIndex",{get:function(){return this.index.ringComponentIndex},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"ringComponents",{get:function(){return this.index.ringComponents},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"aromaticRings",{get:function(){return this._aromaticRings?this._aromaticRings:(this._aromaticRings=h6e(this.unit,this.all),this._aromaticRings)},enumerable:!1,configurable:!0}),e}(),Bs;(function(e){function t(s,u){for(var l=s.elements,c=s.model.atomicHierarchy.atoms.type_symbol,d=[],f=0,p=u.length;f<p;f++)d[d.length]=c.value(l[u[f]]);return r(d)}e.fingerprint=t;function r(s){return i6e(s)}e.elementFingerprint=r;var n=new Set(["B","C","N","O","SI","P","S","GE","AS","SN","SB","BI"]),i=.05;function a(s,u){var l=s.elements,c=s.bonds,d=c.b,f=c.offset,p=c.edgeProps.flags,v=s.model.atomicHierarchy.atoms,h=v.type_symbol,m=v.label_comp_id;if(m.value(s.elements[u[0]])==="PRO")return!1;for(var g=0,y=!1,b=0,S=u.length;b<S;++b){var x=u[b];!y&&n.has(h.value(l[x]))&&(y=!0);for(var C=f[x],w=f[x+1];C<w;++C)Ur.is(16,p[C])&&Je.has(u,d[C])&&(g+=1)}if(g===2*u.length)return!0;if(!y)return!1;var A=hv.calculateMomentsAxes(lJ(s,u));return _.magnitude(A.dirC)<i}e.isAromatic=a;function o(s,u){for(var l=s.model.atomicHierarchy.atoms.label_alt_id,c=s.elements,d=0,f=u.length;d<f;++d){var p=c[u[d]],v=l.value(p);if(v)return v}return""}e.getAltId=o})(Bs||(Bs={}));(function(e){function t(n){var i=JFe(n);return new e(i,n)}e.create=t;function r(n,i){for(var a=new Map,o=0,s=i.length;o<s;o++){var u=i[o];p6e(n,u,a)}return a}e.byFingerprintAndResidue=r})(W_||(W_={}));function d6e(e,t){for(var r=new Map,n=0,i=0,a=t.length;i<a;i++){var o=t[i],s=Bs.fingerprint(e,o);r.has(s)?r.get(s).push(n):r.set(s,[n]),n++}return r}function f6e(e,t){for(var r=e.elements,n=e.model.atomicHierarchy.residueAtomSegments.index,i=n[r[t[0]]],a=1,o=t.length;a<o;a++)if(i!==n[r[t[a]]])return-1;return i}function p6e(e,t,r){var n=e.byFingerprint.get(t);if(n)for(var i=0,a=n.length;i<a;i++){var o=n[i],s=f6e(e.unit,e.all[o]);s>=0&&(r.has(s)?r.get(s).push(o):r.set(s,[o]))}}function h6e(e,t){for(var r=[],n=0,i=t.length;n<i;++n)Bs.isAromatic(e,t[n])&&r.push(n);return r}var en;(function(e){function t(S){return Je.ofSortedArray(S)}e.ofSortedRanges=t;function r(S){return S[0]}e.start=r;function n(S){return S[S.length-1]+1}e.end=n;function i(S){return S[0]}e.min=i;function a(S){return S[S.length-1]}e.max=a;function o(S){for(var x=0,C=0,w=S.length;C<w;C+=2)x+=S[C+1]-S[C]+1;return x}e.size=o;function s(S){return S.length/2}e.count=s;function u(S,x){return S[x*2]}e.startAt=u;function l(S,x){return S[x*2+1]+1}e.endAt=l;function c(S,x){return S[x*2]}e.minAt=c;function d(S,x){return S[x*2+1]}e.maxAt=d;function f(S,x){if(S.length!==x.length)return!1;for(var C=0,w=S.length;C<w;++C)if(S[C]!==x[C])return!1;return!0}e.areEqual=f;function p(S,x){for(var C=0,w=0,A=S.length;w<A;w+=2)for(var M=S[w],D=S[w+1];M<=D;++M)x(M,C),++C}e.forEach=p;function v(S,x){return m(S,x)!==-1}e.has=v;function h(S,x,C){return g(S,x,C)!==-1}e.hasFrom=h;function m(S,x){return g(S,x,0)}e.firstIntersectionIndex=m;function g(S,x,C){if(c(S,C)>Le.max(x)||a(S)<Le.min(x))return-1;for(var w=C,A=s(S);w<A;++w){var M=Ie.ofRange(c(S,w),d(S,w));if(Le.areIntersecting(M,x))return w}return-1}e.firstIntersectionIndexFrom=g;function y(S,x){return new b(S,x)}e.transientSegments=y;var b=function(){function S(x,C){this.ranges=x,this.set=C,this.value={index:0,start:0,end:0},this.curIndex=0,this.hasNext=!1,this.curIndex=m(x,C),this.hasNext=this.curIndex!==-1}return S.prototype.updateValue=function(){this.value.index=this.curIndex,this.value.start=Le.findPredecessorIndex(this.set,u(this.ranges,this.curIndex)),this.value.end=Le.findPredecessorIndex(this.set,l(this.ranges,this.curIndex))},S.prototype.move=function(){return this.hasNext&&(this.updateValue(),this.curIndex=g(this.ranges,this.set,this.curIndex+1),this.hasNext=this.curIndex!==-1),this.value},S}();e.Iterator=b})(en||(en={}));function v6e(e){for(var t=[],r=e.elements,n=e.model,i=e.model.atomicHierarchy.residueAtomSegments,a=n.atomicHierarchy.derived.residue.traceElementIndex,o=en.transientSegments(e.model.atomicRanges.polymerRanges,r),s=nr.transientSegments(i,r);o.hasNext;){var u=o.move();for(s.setSegment(u);s.hasNext;){var l=s.move(),c=l.start,d=l.end,f=l.index;if(Le.areIntersecting(Ie.ofRange(r[c],r[d-1]),r)){var p=a[f];t.push(p===-1?i.offsets[f]:p)}}}return Je.ofSortedArray(t)}function m6e(e){for(var t=[],r=e.elements,n=e.model,i=n.coarseHierarchy,a=i.spheres,o=i.gaussians,s=je.isSpheres(e)?a.polymerRanges:o.polymerRanges,u=en.transientSegments(s,r);u.hasNext;)for(var l=u.move(),c=l.start,d=l.end,f=c;f<d;++f)t.push(r[f]);return Je.ofSortedArray(t)}function g6e(e){for(var t=[],r=e.elements,n=e.model,i=e.residueIndex,a=e.model.atomicHierarchy.residueAtomSegments,o=n.atomicHierarchy.derived.residue.traceElementIndex,s=en.transientSegments(e.model.atomicRanges.gapRanges,e.elements);s.hasNext;){var u=s.move(),l=i[r[u.start]],c=i[r[u.end-1]],d=o[l],f=o[c];t.push(d===-1?a.offsets[l]:d),t.push(f===-1?a.offsets[c]:f)}return Je.ofSortedArray(t)}function y6e(e){for(var t=[],r=e.elements,n=e.model,i=n.coarseHierarchy,a=i.spheres,o=i.gaussians,s=je.isSpheres(e)?a.gapRanges:o.gapRanges,u=en.transientSegments(s,r);u.hasNext;){var l=u.move(),c=l.start,d=l.end;t.push(r[c],r[d-1])}return Je.ofSortedArray(t)}function b6e(e){for(var t=[],r=e.elements,n=e.model,i=n.atomicHierarchy,a=i.chainAtomSegments,o=i.residueAtomSegments,s=n.atomicHierarchy.derived.residue,u=s.moleculeType,l=s.traceElementIndex,c=nr.transientSegments(a,r),d=nr.transientSegments(o,r);c.hasNext;)for(d.setSegment(c.move());d.hasNext;){var f=d.move().index;if(Gl(u[f])){var p=l[f];t.push(p===-1?o.offsets[f]:p)}}return Je.ofSortedArray(t)}function x6e(e){for(var t=[],r=e.elements,n=e.model,i=n.atomicHierarchy,a=i.chainAtomSegments,o=i.residueAtomSegments,s=n.atomicHierarchy.derived.residue,u=s.moleculeType,l=s.traceElementIndex,c=nr.transientSegments(a,r),d=nr.transientSegments(o,r);c.hasNext;)for(d.setSegment(c.move());d.hasNext;){var f=d.move().index;if(uJ(u[f])){var p=l[f];t.push(p===-1?o.offsets[f]:p)}}return Je.ofSortedArray(t)}var HU=_.zero();function S6e(e){for(var t=e.conformation.invariantPosition,r=e.elements,n=new Float32Array(r.length*3),i=0,a=r.length;i<a;i++)t(r[i],HU),_.toArray(HU,n,i*3);return n}function GU(e){var t=S6e(e);return hv.ofPositions(t)}var ps=function(){function e(t){this.minDist=[],this.maxDist=[],this.extrema=[],this.centroidHelper=new rd,this.dir=C6e(t),this.reset()}return e.prototype.computeExtrema=function(t,r){var n=_.dot(this.dir[t],r);n<this.minDist[t]&&(this.minDist[t]=n,_.copy(this.extrema[t*2],r)),n>this.maxDist[t]&&(this.maxDist[t]=n,_.copy(this.extrema[t*2+1],r))},e.prototype.computeSphereExtrema=function(t,r,n){var i=_.dot(this.dir[t],r);i-n<this.minDist[t]&&(this.minDist[t]=i-n,_.scaleAndSub(this.extrema[t*2],r,this.dir[t],n)),i+n>this.maxDist[t]&&(this.maxDist[t]=i+n,_.scaleAndAdd(this.extrema[t*2+1],r,this.dir[t],n))},e.prototype.includeSphere=function(t){if(Be.hasExtrema(t)&&t.extrema.length>1)for(var r=0,n=t.extrema;r<n.length;r++){var i=n[r];this.includePosition(i)}else this.includePositionRadius(t.center,t.radius)},e.prototype.includePosition=function(t){for(var r=0,n=this.dir.length;r<n;++r)this.computeExtrema(r,t)},e.prototype.includePositionRadius=function(t,r){for(var n=0,i=this.dir.length;n<i;++n)this.computeSphereExtrema(n,t,r)},e.prototype.finishedIncludeStep=function(){for(var t=0;t<this.extrema.length;t++)this.centroidHelper.includeStep(this.extrema[t]);this.centroidHelper.finishedIncludeStep()},e.prototype.radiusSphere=function(t){if(Be.hasExtrema(t)&&t.extrema.length>1)for(var r=0,n=t.extrema;r<n.length;r++){var i=n[r];this.radiusPosition(i)}else this.radiusPositionRadius(t.center,t.radius)},e.prototype.radiusPosition=function(t){this.centroidHelper.radiusStep(t)},e.prototype.radiusPositionRadius=function(t,r){this.centroidHelper.radiusSphereStep(t,r)},e.prototype.getSphere=function(t){return Be.setExtrema(this.centroidHelper.getSphere(t),Nt([],this.extrema))},e.prototype.getBox=function(t){return Xt.fromVec3Array(t||Xt(),this.extrema)},e.prototype.reset=function(){for(var t=0,r=this.dir.length;t<r;++t)this.minDist[t]=1/0,this.maxDist[t]=-1/0,this.extrema[t*2]=_(),this.extrema[t*2+1]=_();this.centroidHelper.reset()},e}();function C6e(e){var t;switch(e){case"6":t=Nt([],wx);break;case"14":t=Nt(Nt([],wx),R4);break;case"26":t=Nt(Nt(Nt([],wx),R4),qU);break;case"98":t=Nt(Nt(Nt(Nt(Nt(Nt([],wx),R4),qU),_6e),w6e),E6e);break}return t.map(function(r){var n=_.create(r[0],r[1],r[2]);return _.normalize(n,n)})}var wx=[[1,0,0],[0,1,0],[0,0,1]],R4=[[1,1,1],[-1,1,1],[-1,-1,1],[1,-1,1]],qU=[[1,1,0],[1,-1,0],[1,0,1],[1,0,-1],[0,1,1],[0,1,-1]],_6e=[[0,1,2],[0,2,1],[1,0,2],[2,0,1],[1,2,0],[2,1,0],[0,1,-2],[0,2,-1],[1,0,-2],[2,0,-1],[1,-2,0],[2,-1,0]],w6e=[[1,1,2],[2,1,1],[1,2,1],[1,-1,2],[1,1,-2],[1,-1,-2],[2,-1,1],[2,1,-1],[2,-1,-1],[1,-2,1],[1,2,-1],[1,-2,-1]],E6e=[[2,2,1],[1,2,2],[2,1,2],[2,-2,1],[2,2,-1],[2,-2,-1],[1,-2,2],[1,2,-2],[1,-2,-2],[2,-1,2],[2,1,-2],[2,-1,-2]],$U=_.set,A6e=new ps("14"),P6e=new ps("98");function T6e(e){return e>1e4?A6e:P6e}var Ex=_();function Xg(e){var t=e.x,r=e.y,n=e.z,i=e.radius,a=e.indices,o=Le.size(a);if(o>25e4){var s=Xt.computeBounding(e);return{box:s,sphere:Be.fromBox3D(Be(),s)}}var u=T6e(o);u.reset();for(var l=0;l<o;l++){var c=Le.getAt(a,l);$U(Ex,t[c],r[c],n[c]),u.includePositionRadius(Ex,i&&i[c]||0)}u.finishedIncludeStep();for(var l=0;l<o;l++){var c=Le.getAt(a,l);$U(Ex,t[c],r[c],n[c]),u.radiusPositionRadius(Ex,i&&i[c]||0)}var d=u.getSphere();if(!i&&Be.hasExtrema(d)&&o<=d.extrema.length){for(var f=[],l=0;l<o;l++){var c=Le.getAt(a,l);f.push(_.create(t[c],r[c],n[c]))}Be.setExtrema(d,f)}return{box:u.getBox(),sphere:d}}var I6e=function(){function e(){this.data=new Map}return e.prototype.get=function(t){var r=Je.hashCode(t);if(this.data.has(r))for(var n=0,i=this.data.get(r);n<i.length;n++){var a=i[n],o=a[0],s=a[1];if(Je.areEqual(t,o))return s}},e.prototype.set=function(t,r){var n=Je.hashCode(t);if(this.data.has(n)){for(var i=this.data.get(n),a=0,o=i;a<o.length;a++){var s=o[a];if(Je.areEqual(t,s[0])){s[1]=r;return}}i.push([t,r])}else this.data.set(n,[[t,r]])},e.get=function(t){return t._dynamicPropertyData.ElementSetIntraBondCache||(t._dynamicPropertyData.ElementSetIntraBondCache=new e),t._dynamicPropertyData.ElementSetIntraBondCache},e}(),je;(function(e){function t(B){return B.kind===0}e.isAtomic=t;function r(B){return B.kind===1||B.kind===2}e.isCoarse=r;function n(B){return B.kind===1}e.isSpheres=n;function i(B){return B.kind===2}e.isGaussians=i;function a(B,j,Y,G,$,q,ee,fe,W){switch($){case 0:return new v(B,j,Y,G,q,fe,bn.createMapping(ee,q.atomicConformation,void 0),W??h());case 1:return x(B,j,Y,G,q,1,fe,bn.createMapping(ee,q.coarseConformation.spheres,f(q)),W??y());case 2:return x(B,j,Y,G,q,2,fe,bn.createMapping(ee,q.coarseConformation.gaussians,p()),W??y())}}e.create=a;function o(B){for(var j=Ws.Mutable(),Y=0,G=B.length;Y<G;Y++)j.set(B[Y].id,Y);return j}function s(B){for(var j=[],Y=0,G=B.length;Y<G;Y++)j.push(B[Y].id);return Ga(j)}function u(B){var j={};return{elements:B[0].elements,units:B,get unitIndexMap(){return j.unitIndexMap||(j.unitIndexMap=o(B)),j.unitIndexMap},hashCode:c(B[0]),transformHash:s(B)}}e.SymmetryGroup=u,function(B){function j(G,$){return G.hashCode!==$.hashCode?!1:Je.areEqual(G.elements,$.elements)}B.areInvariantElementsEqual=j;function Y(G){for(var $=Ws.Mutable(),q=0,ee=G.length;q<ee;++q)for(var fe=G[q],W=0,X=fe.units.length;W<X;++W)$.set(fe.units[W].id,q);return $}B.getUnitSymmetryGroupsIndexMap=Y}(u=e.SymmetryGroup||(e.SymmetryGroup={}));function l(B){return e.isAtomic(B)?B.model.atomicConformation.id:B.model.coarseConformation.id}e.conformationId=l;function c(B){return Dv(B.invariantId,Je.hashCode(B.elements))}e.hashUnit=c,function(B){B.is=ba.has,B.create=ba.create}(e.Traits||(e.Traits={}));function d(){return{}}function f(B){var j=B.coarseConformation.spheres.radius;return function(Y){return j[Y]}}function p(B){return function(j){return 0}}var v=function(){function B(j,Y,G,$,q,ee,fe,W){this.kind=0,this.objectPrimitive="atomistic",this.id=j,this.invariantId=Y,this.chainGroupId=G,this.traits=$,this.model=q,this.elements=ee,this.conformation=fe,this.residueIndex=q.atomicHierarchy.residueAtomSegments.index,this.chainIndex=q.atomicHierarchy.chainAtomSegments.index,this.props=W}return B.prototype.getChild=function(j){return j.length===this.elements.length?this:new B(this.id,this.invariantId,this.chainGroupId,this.traits,this.model,j,this.conformation,h())},B.prototype.applyOperator=function(j,Y,G){G===void 0&&(G=!1);var $=G?Y:bn.compose(this.conformation.operator,Y);return new B(j,this.invariantId,this.chainGroupId,this.traits,this.model,this.elements,bn.createMapping($,this.model.atomicConformation,this.conformation.r),this.props)},B.prototype.remapModel=function(j,Y){Y||(Y=E(E({},this.props),{bonds:M(this,this.props.bonds,j)}),e.isSameConformation(this,j)||(Y.boundary=void 0,Y.lookup3d=void 0,Y.principalAxes=void 0));var G=this.conformation.operator,$=fi.Provider.get(j);if(G.spgrOp!==-1&&$&&$!==fi.Provider.get(this.model)){var q=G.hkl,ee=q[0],fe=q[1],W=q[2],X=$.spacegroup.cell.toFractional,U=_.transformMat4(_(),$t.getCenter(j),X);G=Vu.getSymmetryOperatorRef($.spacegroup,G.spgrOp,ee,fe,W,U)}var z=this.model.atomicConformation!==j.atomicConformation||G!==this.conformation.operator?bn.createMapping(G,j.atomicConformation):this.conformation;return new B(this.id,this.invariantId,this.chainGroupId,this.traits,j,this.elements,z,Y)},Object.defineProperty(B.prototype,"boundary",{get:function(){if(this.props.boundary)return this.props.boundary;var j=this.model.atomicConformation,Y=j.x,G=j.y,$=j.z;return this.props.boundary=Xg({x:Y,y:G,z:$,indices:this.elements}),this.props.boundary},enumerable:!1,configurable:!0}),Object.defineProperty(B.prototype,"lookup3d",{get:function(){if(this.props.lookup3d)return this.props.lookup3d;var j=this.model.atomicConformation,Y=j.x,G=j.y,$=j.z;return this.props.lookup3d=fv({x:Y,y:G,z:$,indices:this.elements},this.boundary),this.props.lookup3d},enumerable:!1,configurable:!0}),Object.defineProperty(B.prototype,"principalAxes",{get:function(){return this.props.principalAxes?this.props.principalAxes:(this.props.principalAxes=GU(this),this.props.principalAxes)},enumerable:!1,configurable:!0}),Object.defineProperty(B.prototype,"bonds",{get:function(){if(this.props.bonds)return this.props.bonds;var j=I6e.get(this.model),Y=j.get(this.elements);return Y||(Y=XFe(this),j.set(this.elements,Y)),this.props.bonds=Y,this.props.bonds},enumerable:!1,configurable:!0}),Object.defineProperty(B.prototype,"rings",{get:function(){return this.props.rings?this.props.rings:(this.props.rings=W_.create(this),this.props.rings)},enumerable:!1,configurable:!0}),Object.defineProperty(B.prototype,"polymerElements",{get:function(){return this.props.polymerElements?this.props.polymerElements:(this.props.polymerElements=v6e(this),this.props.polymerElements)},enumerable:!1,configurable:!0}),Object.defineProperty(B.prototype,"gapElements",{get:function(){return this.props.gapElements?this.props.gapElements:(this.props.gapElements=g6e(this),this.props.gapElements)},enumerable:!1,configurable:!0}),Object.defineProperty(B.prototype,"nucleotideElements",{get:function(){return this.props.nucleotideElements?this.props.nucleotideElements:(this.props.nucleotideElements=b6e(this),this.props.nucleotideElements)},enumerable:!1,configurable:!0}),Object.defineProperty(B.prototype,"proteinElements",{get:function(){return this.props.proteinElements?this.props.proteinElements:(this.props.proteinElements=x6e(this),this.props.proteinElements)},enumerable:!1,configurable:!0}),Object.defineProperty(B.prototype,"residueCount",{get:function(){if(this.props.residueCount!==void 0)return this.props.residueCount;for(var j=0,Y=nr.transientSegments(this.model.atomicHierarchy.residueAtomSegments,this.elements);Y.hasNext;)Y.move(),j+=1;return this.props.residueCount=j,this.props.residueCount},enumerable:!1,configurable:!0}),B.prototype.getResidueIndex=function(j){return this.residueIndex[this.elements[j]]},B}();e.Atomic=v;function h(){return d()}var m=function(){function B(j,Y,G,$,q,ee,fe,W,X){this.kind=ee,this.objectPrimitive=ee===1?"sphere":"gaussian",this.id=j,this.invariantId=Y,this.chainGroupId=G,this.traits=$,this.model=q,this.elements=fe,this.conformation=W,this.coarseElements=ee===1?q.coarseHierarchy.spheres:q.coarseHierarchy.gaussians,this.coarseConformation=ee===1?q.coarseConformation.spheres:q.coarseConformation.gaussians,this.props=X}return B.prototype.getChild=function(j){return j.length===this.elements.length?this:x(this.id,this.invariantId,this.chainGroupId,this.traits,this.model,this.kind,j,this.conformation,y())},B.prototype.applyOperator=function(j,Y,G){G===void 0&&(G=!1);var $=G?Y:bn.compose(this.conformation.operator,Y);return x(j,this.invariantId,this.chainGroupId,this.traits,this.model,this.kind,this.elements,bn.createMapping($,this.getCoarseConformation(),this.conformation.r),this.props)},B.prototype.remapModel=function(j,Y){var G=this.getCoarseConformation(),$=g(this.kind,j);Y||(Y=E({},this.props),e.isSameConformation(this,j)||(Y.boundary=void 0,Y.lookup3d=void 0,Y.principalAxes=void 0));var q=G!==$?bn.createMapping(this.conformation.operator,$):this.conformation;return new B(this.id,this.invariantId,this.chainGroupId,this.traits,j,this.kind,this.elements,q,Y)},Object.defineProperty(B.prototype,"boundary",{get:function(){if(this.props.boundary)return this.props.boundary;var j=this.getCoarseConformation(),Y=j.x,G=j.y,$=j.z;return this.props.boundary=Xg({x:Y,y:G,z:$,indices:this.elements}),this.props.boundary},enumerable:!1,configurable:!0}),Object.defineProperty(B.prototype,"lookup3d",{get:function(){if(this.props.lookup3d)return this.props.lookup3d;var j=this.getCoarseConformation(),Y=j.x,G=j.y,$=j.z;return this.props.lookup3d=fv({x:Y,y:G,z:$,indices:this.elements},this.boundary),this.props.lookup3d},enumerable:!1,configurable:!0}),Object.defineProperty(B.prototype,"principalAxes",{get:function(){return this.props.principalAxes?this.props.principalAxes:(this.props.principalAxes=GU(this),this.props.principalAxes)},enumerable:!1,configurable:!0}),Object.defineProperty(B.prototype,"polymerElements",{get:function(){return this.props.polymerElements?this.props.polymerElements:(this.props.polymerElements=m6e(this),this.props.polymerElements)},enumerable:!1,configurable:!0}),Object.defineProperty(B.prototype,"gapElements",{get:function(){return this.props.gapElements?this.props.gapElements:(this.props.gapElements=y6e(this),this.props.gapElements)},enumerable:!1,configurable:!0}),B.prototype.getCoarseConformation=function(){return g(this.kind,this.model)},B}();function g(B,j){return B===1?j.coarseConformation.spheres:j.coarseConformation.gaussians}function y(){return d()}var b=function(B){Fe(j,B);function j(){return B!==null&&B.apply(this,arguments)||this}return j}(m);e.Spheres=b;var S=function(B){Fe(j,B);function j(){return B!==null&&B.apply(this,arguments)||this}return j}(m);e.Gaussians=S;function x(B,j,Y,G,$,q,ee,fe,W){return new m(B,j,Y,G,$,q,ee,fe,W)}function C(B,j){return B.chainGroupId===j.chainGroupId&&B.conformation.operator.name===j.conformation.operator.name}e.areSameChainOperatorGroup=C;function w(B,j){return ue.areEqual(B.conformation.operator.matrix,j.conformation.operator.matrix,1e-6)}e.areOperatorsEqual=w;function A(B,j){return Je.areEqual(B.elements,j.elements)?D(B,j.model):!1}e.areConformationsEqual=A;function M(B,j,Y){var G;if(j){if(B.model.atomicConformation.id===Y.atomicConformation.id)return j;var $=xa.Provider.get(B.model);if($){var q=xa.Provider.get(Y);return!q||$===q?j:void 0}return!((G=j.props)===null||G===void 0)&&G.canRemap||D(B,Y)?j:void 0}}function D(B,j){var Y=$t.CoordinatesHistory.get($t.getRoot(j));if(Y)return Y.areEqual(B.elements,B.kind,j);for(var G=B.elements,$=B.conformation.coordinates,q=$.x,ee=$.y,fe=$.z,W=k(B.kind,j),X=W.x,U=W.y,z=W.z,J=0,K=G.length;J<K;J++){var Z=G[J];if(q[Z]!==X[Z]||ee[Z]!==U[Z]||fe[Z]!==z[Z])return!1}return!0}e.isSameConformation=D;function k(B,j){return B===0?j.atomicConformation:B===1?j.coarseConformation.spheres:j.coarseConformation.gaussians}e.getModelConformationOfKind=k;function R(B){return k(B.kind,B.model)}e.getConformation=R;function O(B,j){return B===0?j.atomicHierarchy:B===1?j.coarseHierarchy.spheres:j.coarseHierarchy.gaussians}e.getModelHierarchyOfKind=O;function H(B){return O(B.kind,B.model)}e.getHierarchy=H})(je||(je={}));var X_;(function(e){function t(i,a,o,s){i.indices[i.count]=o,i.units[i.count]=a,i.squaredDistances[i.count]=s,i.count++}e.add=t;function r(){return{count:0,indices:[],units:[],squaredDistances:[]}}e.create=r;function n(i,a){for(var o=0;o<a.count;++o)i.indices[o]=a.indices[o],i.units[o]=a.units[o],i.squaredDistances[o]=a.squaredDistances[o];return i.count=a.count,i}e.copy=n})(X_||(X_={}));function BJ(){return{result:X_.create(),closeUnitsResult:fp.create(),unitGroupResult:fp.create()}}var M6e=function(){function e(t){this.structure=t,this.pivot=_(),this.findContext=BJ();for(var r=t.units,n=t.boundary,i=r.length,a=new Float32Array(i),o=new Float32Array(i),s=new Float32Array(i),u=new Float32Array(i),l=_(),c=0;c<i;c++){var d=r[c],f=d.boundary.sphere;_.transformMat4(l,f.center,d.conformation.operator.matrix),a[c]=l[0],o[c]=l[1],s[c]=l[2],u[c]=f.radius}var p={x:a,y:o,z:s,radius:u,indices:Le.ofBounds(0,i)};this.unitLookup=fv(p,n)}return e.prototype.findUnitIndices=function(t,r,n,i){return this.unitLookup.find(t,r,n,i)},e.prototype.find=function(t,r,n,i,a){return this._find(t,r,n,i,a??this.findContext)},e.prototype._find=function(t,r,n,i,a){fp.reset(a.result);var o=this.structure.units,s=this.unitLookup.find(t,r,n,i,a.closeUnitsResult);if(s.count===0)return a.result;for(var u=0,l=s.count;u<l;u++){var c=o[s.indices[u]];_.set(this.pivot,t,r,n),c.conformation.operator.isIdentity||_.transformMat4(this.pivot,this.pivot,c.conformation.operator.inverse);for(var d=c.lookup3d,f=d.find(this.pivot[0],this.pivot[1],this.pivot[2],i,a.unitGroupResult),p=0,v=f.count;p<v;p++)X_.add(a.result,c,f.indices[p],f.squaredDistances[p])}return a.result},e.prototype.findIntoBuilder=function(t,r,n,i,a){var o=this.structure.units,s=this.unitLookup.find(t,r,n,i);if(s.count!==0)for(var u=0,l=s.count;u<l;u++){var c=o[s.indices[u]];_.set(this.pivot,t,r,n),c.conformation.operator.isIdentity||_.transformMat4(this.pivot,this.pivot,c.conformation.operator.inverse);var d=c.lookup3d,f=d.find(this.pivot[0],this.pivot[1],this.pivot[2],i);if(f.count!==0){var p=c.elements;a.beginUnit(c.id);for(var v=0,h=f.count;v<h;v++)a.addElement(p[f.indices[v]]);a.commitUnit()}}},e.prototype.findIntoBuilderIf=function(t,r,n,i,a,o){var s=this.structure.units,u=this.unitLookup.find(t,r,n,i);if(u.count!==0)for(var l=Ze.create(this.structure),c=0,d=u.count;c<d;c++){var f=s[u.indices[c]];_.set(this.pivot,t,r,n),f.conformation.operator.isIdentity||_.transformMat4(this.pivot,this.pivot,f.conformation.operator.inverse);var p=f.lookup3d,v=p.find(this.pivot[0],this.pivot[1],this.pivot[2],i);if(v.count!==0){var h=f.elements;l.unit=f,a.beginUnit(f.id);for(var m=0,g=v.count;m<g;m++)l.element=h[v.indices[m]],o(l)&&a.addElement(l.element);a.commitUnit()}}},e.prototype.findIntoBuilderWithRadius=function(t,r,n,i,a,o,s,u){var l=this.structure.units,c=this.unitLookup.find(t,r,n,o);if(c.count!==0)for(var d=Ze.create(this.structure),f=i+a+o,p=0,v=c.count;p<v;p++){var h=l[c.indices[p]];_.set(this.pivot,t,r,n),h.conformation.operator.isIdentity||_.transformMat4(this.pivot,this.pivot,h.conformation.operator.inverse);var m=h.lookup3d,g=m.find(this.pivot[0],this.pivot[1],this.pivot[2],f);if(g.count!==0){var y=h.elements;d.unit=h,u.beginUnit(h.id);for(var b=0,S=g.count;b<S;b++){d.element=y[g.indices[b]];var x=s(d);Math.sqrt(g.squaredDistances[b])-i-x>o||u.addElement(y[g.indices[b]])}u.commitUnit()}}},e.prototype.check=function(t,r,n,i){var a=this.structure.units,o=this.unitLookup.find(t,r,n,i);if(o.count===0)return!1;for(var s=0,u=o.count;s<u;s++){var l=a[o.indices[s]];_.set(this.pivot,t,r,n),l.conformation.operator.isIdentity||_.transformMat4(this.pivot,this.pivot,l.conformation.operator.inverse);var c=l.lookup3d;if(c.check(this.pivot[0],this.pivot[1],this.pivot[2],i))return!0}return!1},Object.defineProperty(e.prototype,"boundary",{get:function(){return this.structure.boundary},enumerable:!1,configurable:!0}),e}();function Ib(e,t){if(t.length===0)return We.Empty;if(t.length===1)return t[0];for(var r=new Map,n=new Set,i=0,a=t;i<a.length;i++)for(var o=a[i].units,s=0,u=o.length;s<u;s++){var l=o[s];if(r.has(l.id)){if(n.has(l.id))continue;var c=Je.union(r.get(l.id),l.elements);r.set(l.id,c),c.length===e.unitMap.get(l.id).elements.length&&n.add(l.id)}else r.set(l.id,l.elements),l.elements.length===e.unitMap.get(l.id).elements.length&&n.add(l.id)}var d=e.subsetBuilder(!0);return r.forEach(D6e,d),d.getStructure()}function D6e(e,t){this.setUnit(t,e)}function R6e(e,t){if(e===t)return!0;if(e.units.length!==t.units.length)return!1;for(var r=e.units,n=t.unitMap,i=0,a=r.length;i<a;i++){var o=r[i];if(!n.has(o.id))return!1;var s=n.get(o.id);if(!Je.areEqual(o.elements,s.elements))return!1}return!0}function TE(e,t){if(e===t)return!0;var r,n;e.units.length<t.units.length?(r=e,n=t):(r=t,n=e);for(var i=r.units,a=n.unitMap,o=0,s=i.length;o<s;o++){var u=i[o];if(a.has(u.id)){var l=a.get(u.id);if(Je.areIntersecting(u.elements,l.elements))return!0}}return!1}function UJ(e,t){if(e===t)return e;if(!TE(e,t))return We.Empty;var r,n;e.units.length<t.units.length?(r=e,n=t):(r=t,n=e);for(var i=r.units,a=n.unitMap,o=[],s=0,u=i.length;s<u;s++){var l=i[s];if(a.has(l.id)){var c=a.get(l.id);if(Je.areIntersecting(l.elements,c.elements)){var d=Je.intersect(l.elements,c.elements);o[o.length]=l.getChild(d)}}}return We.create(o,{parent:e.parent||t.parent})}function OL(e,t){if(e===t)return We.Empty;if(!TE(e,t))return e;for(var r=e.units,n=t.unitMap,i=[],a=0,o=r.length;a<o;a++){var s=r[a];if(!n.has(s.id)){i[i.length]=s;continue}var u=n.get(s.id),l=Je.subtract(s.elements,u.elements);l.length>0&&(i[i.length]=s.getChild(l))}return We.create(i,{parent:e.parent||t.parent})}var mt;(function(e){function t(g,y){return{kind:"singletons",source:g,structure:y}}e.Singletons=t;function r(g,y){return{kind:"sequence",source:g,structures:y}}e.Sequence=r;function n(g){return t(g,We.Empty)}e.Empty=n;function i(g){return g.kind==="singletons"}e.isSingleton=i;function a(g){return i(g)?g.structure.units.length===0:g.structures.length===0}e.isEmpty=a;function o(g){return i(g)?g.structure.elementCount:g.structures.length}e.structureCount=o;function s(g){return a(g)?We.Empty:i(g)?g.structure:Ib(g.source,g.structures)}e.unionStructure=s;function u(g){for(var y=[],b=g.source.unitMap,S=0,x=s(g).units;S<x.length;S++){var C=x[S];C===b.get(C.id)?y[y.length]={unit:C,indices:Le.ofBounds(0,C.elements.length)}:y[y.length]={unit:C,indices:Le.ofSortedArray(Je.indicesOf(b.get(C.id).elements,C.elements))}}return Re(g.source,y)}e.toLociWithCurrentUnits=u;function l(g){for(var y=[],b=g.source.unitMap,S=0,x=s(g).units;S<x.length;S++){var C=x[S],w=b.get(C.id);w===C?y[y.length]={unit:w,indices:Le.ofBounds(0,w.elements.length)}:y[y.length]={unit:w,indices:Le.ofSortedArray(Je.indicesOf(w.elements,C.elements))}}return Re(g.source,y)}e.toLociWithSourceUnits=l;function c(g,y,b){var S=y.length;return S===0?n(g):b?t(g,Ib(g,y)):r(g,y)}var d=function(){function g(y){this.source=y,this.structures=[],this.allSingletons=!0}return g.prototype.add=function(y){var b=y.elementCount;b!==0&&(this.structures[this.structures.length]=y,b!==1&&(this.allSingletons=!1))},g.prototype.getSelection=function(){return c(this.source,this.structures,this.allSingletons)},g}(),f=function(){function g(y){this.structure=y,this.structures=[],this.allSingletons=!0,this.uniqueSets=mL(We.hashCode,We.areUnitIdsAndIndicesEqual)}return g.prototype.add=function(y){var b=y.elementCount;b===0||!this.uniqueSets.add(y)||(this.structures[this.structures.length]=y,b!==1&&(this.allSingletons=!1))},g.prototype.getSelection=function(){return c(this.structure,this.structures,this.allSingletons)},g}();function p(g){return new d(g)}e.LinearBuilder=p;function v(g){return new f(g)}e.UniqueBuilder=v;function h(g,y){var b=0;if(e.isSingleton(g))for(var S=0,x=g.structure.units;S<x.length;S++)for(var C=x[S],w=C.elements,A=0,M=w.length;A<M;A++){var D=We.create([C.getChild(Je.ofSingleton(w[A]))],{parent:g.source});y(D,b++)}else for(var k=0,R=g.structures;k<R.length;k++){var D=R[k];y(D,b++)}}e.forEach=h;function m(g,y){return i(g)?t(y,g.structure):r(y,g.structures)}e.withInputStructure=m})(mt||(mt={}));var rn;(function(e){e.Empty={hash:-1,elements:[]};function t(c,d){return n(mt.toLociWithSourceUnits(mt.Singletons(c,d)))}e.fromSubStructure=t;function r(c){return n(mt.toLociWithSourceUnits(c))}e.fromSelection=r;function n(c){for(var d=[],f=0,p=c.elements;f<p.length;f++){var v=p[f],h=v.unit,m=v.indices;if(Le.size(m)!==0){var g=[],y=[];if(Le.isInterval(m))Le.size(m)===1?y.push(Ie.min(m)):g.push(Ie.min(m),Ie.max(m));else for(var b=0,S=m.length;b<S;){var x=b;for(b++;b<S&&m[b-1]+1===m[b];)b++;var C=b;if(C-x>2)g.push(m[x],m[C-1]);else for(var w=x;w<C;w++)y[y.length]=m[w]}d.push({unit:h,set:Je.ofSortedArray(y),ranges:en.ofSortedRanges(g)})}}for(var A=new Map,b=0,M=d.length;b<M;++b){var v=d[b],D=Dv(Ga(v.ranges),Ga(v.set));if(A.has(D)){var k=A.get(D).groupedUnits;k.has(v.unit.invariantId)?k.get(v.unit.invariantId).push(v.unit.id):k.set(v.unit.invariantId,[v.unit.id])}else{var k=new Map;k.set(v.unit.invariantId,[v.unit.id]),A.set(D,{groupedUnits:k,set:v.set,ranges:v.ranges})}}var R=[];return A.forEach(function(O){var H=[];O.groupedUnits.forEach(function(B){return H.push(Je.ofUnsortedArray(B))}),H.sort(function(B,j){return B[0]-j[0]}),R.push({groupedUnits:H,set:O.set,ranges:O.ranges})}),{hash:c.structure.hashCode,elements:R}}e.fromLoci=n;function i(c,d){for(var f=[],p=0,v=c.length;p<v;++p){var h=c[p];d.unitMap.has(h)&&f.push(d.unitMap.get(h))}return f}function a(c,d){c.hash!==-1&&(c.hash,d.hashCode);for(var f=[],p=0,v=c.elements;p<v.length;p++)for(var h=v[p],m=function(S){var x=i(S,d);if(x.length===0)return"continue";var C=void 0;if(h.ranges.length===0)C=h.set;else if(h.set.length===0)if(h.ranges.length===2)C=Ie.ofRange(h.ranges[0],h.ranges[1]);else{var w=new Int32Array(en.size(h.ranges));en.forEach(h.ranges,function(O,H){return w[H]=O}),C=Je.ofSortedArray(w)}else{var A=en.size(h.ranges),M=new Int32Array(h.set.length+A);en.forEach(h.ranges,function(O,H){return M[H]=O}),M.set(h.set,A),C=Je.ofUnsortedArray(M)}for(var D=0,k=x;D<k.length;D++){var R=k[D];f.push({unit:R,indices:C})}},g=0,y=h.groupedUnits;g<y.length;g++){var b=y[g];m(b)}return Re(d,f)}e.toLoci=a;function o(c,d){c.hash!==-1&&(c.hash,d.hashCode);for(var f=[],p=0,v=c.elements;p<v.length;p++)for(var h=v[p],m=function(S){var x=i(S,d);if(x.length===0)return"continue";var C=x[0].elements,w=en.size(h.ranges),A=h.set.length,M=new Int32Array(A+w),D=void 0;if(w===0){for(var k=0,R=A;k<R;++k)M[k]=C[h.set[k]];D=Je.ofSortedArray(M)}else if(A===0)en.forEach(h.ranges,function(j,Y){return M[Y]=C[j]}),D=Je.ofSortedArray(M);else if(Je.min(h.set)>en.max(h.ranges)){en.forEach(h.ranges,function(j,Y){return M[Y]=C[j]});for(var k=0,R=A;k<R;++k)M[k+w]=C[h.set[k]];D=Je.ofSortedArray(M)}else if(en.min(h.ranges)>Je.max(h.set)){for(var k=0,R=A;k<R;++k)M[k]=C[h.set[k]];en.forEach(h.ranges,function(j,Y){return M[Y+A]=C[j]}),D=Je.ofSortedArray(M)}else{en.forEach(h.ranges,function(j,Y){return M[Y]=C[j]});for(var k=0,R=A;k<R;++k)M[k+w]=C[h.set[k]];D=Je.ofUnsortedArray(M)}for(var O=0,H=x;O<H.length;O++){var B=H[O];f.push(B.getChild(D))}},g=0,y=h.groupedUnits;g<y.length;g++){var b=y[g];m(b)}return We.create(f,{parent:d})}e.toStructure=o;function s(c){return se.internal.generator.bundleElement({groupedUnits:se.core.type.list(c.groupedUnits.map(function(d){return se.core.type.list(d)})),ranges:se.core.type.list(c.ranges),set:se.core.type.list(c.set)})}function u(c){return se.internal.generator.bundle({elements:se.core.type.list(c.elements.map(s))})}e.toExpression=u;function l(c,d){if(c.elements.length!==d.elements.length)return!1;for(var f=0,p=c.elements.length;f<p;++f){var v=c.elements[f],h=d.elements[f];if(v.groupedUnits.length!==h.groupedUnits.length)return!1;for(var m=0,g=h.groupedUnits.length;m<g;++m)if(!Je.areEqual(v.groupedUnits[m],h.groupedUnits[m]))return!1;if(!Je.areEqual(v.set,h.set)||!en.areEqual(v.ranges,h.ranges))return!1}return!0}e.areEqual=l})(rn||(rn={}));function cD(e){return Ur.isCovalent(e.atomicBond.type)}function k6e(){return function(t){for(var r=t.inputStructure,n=Ze.create(r),i=[],a=0,o=r.units;a<o.length;a++){var s=o[a];if(s.kind===0){n.unit=s;var u=s.elements;if(n.element=u[0],lt.entity.type(n)==="polymer"){for(var l=nr.transientSegments(s.model.atomicHierarchy.residueAtomSegments,u),c=0;l.hasNext;)c++,l.move();c<8||i.push(s)}}}return mt.Singletons(r,We.create(i,{parent:r}))}}function O6e(){return function(t){for(var r=t.inputStructure,n=Ze.create(r),i=[],a=0,o=r.units;a<o.length;a++){var s=o[a];if(s.kind===0){n.unit=s;var u=s.elements;n.element=u[0],lt.entity.type(n)==="water"&&i.push(s)}}return mt.Singletons(r,We.create(i,{parent:r}))}}function L6e(){return function(t){for(var r=t.inputStructure,n=Ze.create(r),i=[],a=0,o=r.units;a<o.length;a++){var s=o[a];if(s.kind===0){n.unit=s;var u=s.elements;if(n.element=u[0],lt.entity.type(n)!=="water"){if(lt.entity.type(n)==="polymer"){for(var l=nr.transientSegments(s.model.atomicHierarchy.residueAtomSegments,u),c=0;l.hasNext;)c++,l.move();if(c>=8)continue}i.push(s)}}}return mt.Singletons(r,We.create(i,{parent:r}))}}function F6e(){return function(t){for(var r=t.inputStructure,n=[],i=0,a=r.units;i<a.length;i++){var o=a[i];o.kind===1&&n.push(o)}return mt.Singletons(r,We.create(n,{parent:r}))}}function jJ(e,t,r){return{groupedUnits:e,ranges:t,set:r}}function zJ(e){return function(r){var n={hash:r.inputStructure.hashCode,elements:e};return mt.Sequence(r.inputStructure,[rn.toStructure(n,r.inputStructure)])}}const N6e=Object.freeze(Object.defineProperty({__proto__:null,atomicHet:L6e,atomicSequence:k6e,bundleElementImpl:jJ,bundleGenerator:zJ,defaultBondTest:cD,spheres:F6e,water:O6e},Symbol.toStringTag,{value:"Module"}));var us=function(){function e(t,r){this.currentElementStack=[],this.currentAtomicBondStack=[],this.currentStructureStack=[],this.inputStructureStack=[],this.timeCreated=kn(),this.element=Ze.create(void 0),this.currentStructure=void 0,this.atomicBond=new WU,this.currentSelection=void 0,this.inputStructure=t,this.timeoutMs=r&&r.timeoutMs||0,this.currentSelection=r&&r.currentSelection}return e.prototype.pushCurrentElement=function(){return this.currentElementStack[this.currentElementStack.length]=this.element,this.element=Ze.create(void 0),this.element},e.prototype.popCurrentElement=function(){this.element=this.currentElementStack.pop()},e.prototype.pushCurrentBond=function(){return this.atomicBond&&this.currentAtomicBondStack.push(this.atomicBond),this.atomicBond=new WU,this.atomicBond},e.prototype.popCurrentBond=function(){this.currentAtomicBondStack.length>0?this.atomicBond=this.currentAtomicBondStack.pop():this.atomicBond=void 0},e.prototype.pushCurrentStructure=function(){this.currentStructure&&this.currentStructureStack.push(this.currentStructure)},e.prototype.popCurrentStructure=function(){this.currentStructureStack.length?this.currentStructure=this.currentStructureStack.pop():this.currentStructure=void 0},e.prototype.pushInputStructure=function(t){this.inputStructureStack.push(this.inputStructure),this.inputStructure=t},e.prototype.popInputStructure=function(){if(this.inputStructureStack.length===0)throw new Error("Must push before pop.");this.inputStructure=this.inputStructureStack.pop()},e.prototype.throwIfTimedOut=function(){if(this.timeoutMs!==0&&kn()-this.timeCreated>this.timeoutMs)throw new Error("The query took too long to execute (> "+this.timeoutMs/1e3+"s).")},e.prototype.tryGetCurrentSelection=function(){if(!this.currentSelection)throw new Error("The current selection is not assigned.");return this.currentSelection},e}(),WU=function(){function e(){this.a=Ze.create(void 0),this.aIndex=0,this.b=Ze.create(void 0),this.bIndex=0,this.type=0,this.order=0,this.testFn=cD}return e.prototype.setStructure=function(t){this.a.structure=t,this.b.structure=t},e.prototype.setTestFn=function(t){this.testFn=t||cD},e.prototype.test=function(t,r){return this.testFn(t)?!0:r?(this.swap(),this.testFn(t)):!1},e.prototype.swap=function(){var t=this.aIndex;this.aIndex=this.bIndex,this.bIndex=t;var r=this.a.unit;this.a.unit=this.b.unit,this.b.unit=r;var n=this.a.element;this.a.element=this.b.element,this.b.element=n},Object.defineProperty(e.prototype,"length",{get:function(){return Ze.distance(this.a,this.b)},enumerable:!1,configurable:!0}),e}(),dD;(function(e){function t(r,n,i){return r(new us(n,i))}e.run=t})(dD||(dD={}));var fD=function(){function e(t){this.source=t,this.set=mL(We.hashCode,We.areUnitIdsAndIndicesEqual),this.structures=[],this.allSingletons=!0}return e.prototype.add=function(t){t.elementCount&&(t.elementCount!==1&&(this.allSingletons=!1),this.set.add(t)&&(this.structures[this.structures.length]=t))},e.prototype.getSelection=function(){return this.allSingletons?mt.Singletons(this.source,Ib(this.source,this.structures)):mt.Sequence(this.source,this.structures)},e}(),B6e=function(){function e(t){this.source=t,this.builders=[],this.builderMap=new Map}return e.prototype.add=function(t,r,n){var i=this.builderMap.get(t);i||(i=this.source.subsetBuilder(!0),this.builders[this.builders.length]=i,this.builderMap.set(t,i)),i.addToUnit(r,n)},e.prototype.allSingletons=function(){for(var t=0,r=this.builders.length;t<r;t++)if(this.builders[t].elementCount>1)return!1;return!0},e.prototype.singletonSelection=function(){for(var t=this.source.subsetBuilder(!0),r=Ze.create(this.source),n=0,i=this.builders.length;n<i;n++)this.builders[n].setSingletonLocation(r),t.addToUnit(r.unit.id,r.element);return mt.Singletons(this.source,t.getStructure())},e.prototype.fullSelection=function(){for(var t=new Array(this.builders.length),r=0,n=this.builders.length;r<n;r++)t[r]=this.builders[r].getStructure();return mt.Sequence(this.source,t)},e.prototype.getSelection=function(){var t=this.builders.length;return t===0?mt.Empty(this.source):this.allSingletons()?this.singletonSelection():this.fullSelection()},e}(),LL=function(e){return mt.Sequence(e.inputStructure,[])},VJ=function(e){return mt.Singletons(e.inputStructure,e.inputStructure)};function U6e(e){return FL(E(E({},e),{groupBy:function(t){return lt.residue.key(t.element)}}))}function j6e(e){return FL(E(E({},e),{groupBy:function(t){return lt.chain.key(t.element)}}))}function _f(e){return!0}function z6e(e){return 0}function FL(e){if(!e||!e.atomTest&&!e.residueTest&&!e.chainTest&&!e.entityTest&&!e.unitTest&&!e.groupBy)return VJ;if(e.atomTest&&!e.residueTest&&!e.chainTest&&!e.entityTest&&!e.unitTest&&!e.groupBy)return V6e(e.atomTest);var t={unitTest:e.unitTest||_f,entityTest:e.entityTest||_f,chainTest:e.chainTest||_f,residueTest:e.residueTest||_f,atomTest:e.atomTest||_f,groupBy:e.groupBy||z6e};return e.groupBy?G6e(t):H6e(t)}function V6e(e){return function(r){var n=r.inputStructure,i=n.units,a=r.pushCurrentElement(),o=n.subsetBuilder(!0);a.structure=n;for(var s=0,u=i;s<u.length;s++){var l=u[s];a.unit=l;var c=l.elements;o.beginUnit(l.id);for(var d=0,f=c.length;d<f;d++)a.element=c[d],e(r)&&o.addElement(a.element);o.commitUnit(),r.throwIfTimedOut()}return r.popCurrentElement(),mt.Singletons(n,o.getStructure())}}function H6e(e){var t=e.unitTest,r=e.entityTest,n=e.chainTest,i=e.residueTest,a=e.atomTest;return function(s){var u=s.inputStructure,l=u.units,c=s.pushCurrentElement(),d=u.subsetBuilder(!0),f=i===_f&&a===_f,p=a===_f;c.structure=u;for(var v=0,h=l;v<h.length;v++){var m=h[v];if(c.unit=m,!!t(s)){var g=m.elements,y=m.model;if(d.beginUnit(m.id),m.kind===0)for(var b=nr.transientSegments(m.model.atomicHierarchy.chainAtomSegments,g),S=nr.transientSegments(m.model.atomicHierarchy.residueAtomSegments,g);b.hasNext;){var x=b.move();if(c.element=g[x.start],!(!r(s)||!n(s))){if(f){d.addElementRange(g,x.start,x.end);continue}for(S.setSegment(x);S.hasNext;){var C=S.move();if(c.element=g[C.start],!!i(s)){if(p){d.addElementRange(g,C.start,C.end);continue}for(var w=C.start,A=C.end;w<A;w++)c.element=g[w],a(s)&&d.addElement(c.element)}}}}else for(var M=y.coarseHierarchy.spheres.chainElementSegments,b=nr.transientSegments(M,g);b.hasNext;){var x=b.move();if(c.element=g[x.start],!(!r(s)||!n(s))){if(f){d.addElementRange(g,x.start,x.end);continue}for(var w=x.start,A=x.end;w<A;w++)c.element=g[w],i(s)&&d.addElement(c.element)}}d.commitUnit(),s.throwIfTimedOut()}}return s.popCurrentElement(),mt.Singletons(u,d.getStructure())}}function G6e(e){var t=e.unitTest,r=e.entityTest,n=e.chainTest,i=e.residueTest,a=e.atomTest,o=e.groupBy;return function(u){var l=u.inputStructure,c=l.units,d=u.pushCurrentElement(),f=new B6e(l);d.structure=l;for(var p=0,v=c;p<v.length;p++){var h=v[p];if(d.unit=h,!!t(u)){var m=h.elements,g=h.model;if(h.kind===0)for(var y=nr.transientSegments(g.atomicHierarchy.chainAtomSegments,m),b=nr.transientSegments(g.atomicHierarchy.residueAtomSegments,m);y.hasNext;){var S=y.move();if(d.element=m[S.start],!(!r(u)||!n(u)))for(b.setSegment(S);b.hasNext;){var x=b.move();if(d.element=m[x.start],!!i(u))for(var C=x.start,w=x.end;C<w;C++)d.element=m[C],a(u)&&f.add(o(u),h.id,d.element)}}else for(var A=g.coarseHierarchy.spheres.chainElementSegments,y=nr.transientSegments(A,m);y.hasNext;){var S=y.move();if(d.element=m[S.start],!(!r(u)||!n(u)))for(var C=S.start,w=S.end;C<w;C++)d.element=m[C],i(u)&&f.add(o(u),h.id,d.element)}u.throwIfTimedOut()}}return u.popCurrentElement(),f.getSelection()}}function k4(e,t,r){for(var n=new Int32Array(t.length),i=0,a=t.length;i<a;i++)n[i]=e.elements[t[i]];return We.create([e.getChild(Je.ofSortedArray(n))],{parent:r})}function q6e(e,t){return function(n){var i=n.inputStructure.units,a=mt.LinearBuilder(n.inputStructure);if(!e||e.length===0)for(var o=0,s=i;o<s.length;o++){var u=s[o];if(je.isAtomic(u))if(t)for(var l=0,c=u.rings.aromaticRings;l<c.length;l++){var d=c[l];a.add(k4(u,u.rings.all[d],n.inputStructure))}else for(var f=0,p=u.rings.all;f<p.length;f++){var d=p[f];a.add(k4(u,d,n.inputStructure))}}else{for(var v=tn.create(),h=0;h<e.length;h++)tn.add(v,e[h],e[h]);for(var m=0,g=i;m<g.length;m++){var u=g[m];if(je.isAtomic(u))for(var y=u.rings,b=0,S=v.array;b<S.length;b++){var x=S[b];if(y.byFingerprint.has(x))for(var C=0,w=y.byFingerprint.get(x);C<w.length;C++){var d=w[C];t&&!y.aromaticRings.includes(d)||a.add(k4(u,y.all[d],n.inputStructure))}}}}return a.getSelection()}}function $6e(e,t,r){return r===void 0&&(r=!1),function(i){var a=e(i);if(mt.structureCount(a)===0)return a;var o=r?OL(i.inputStructure,mt.unionStructure(a)):mt.unionStructure(a);if(o.elementCount===0)return mt.Empty(i.inputStructure);i.throwIfTimedOut(),i.pushInputStructure(o);var s=t(i);return i.popInputStructure(),mt.withInputStructure(s,i.inputStructure)}}function W6e(e){return function(r){var n=r.inputStructure,i=n.interUnitBonds,a=mt.UniqueBuilder(r.inputStructure);r.pushCurrentBond();var o=r.atomicBond;o.setTestFn(e),o.setStructure(n);for(var s=0,u=n.units;s<u.length;s++){var l=u[s];if(l.kind===0){var c=l.bonds,d=c.offset,f=c.b,p=c.edgeProps,v=p.flags,h=p.order;o.a.unit=l,o.b.unit=l;for(var m=0,g=l.elements.length;m<g;m++){o.aIndex=m,o.a.element=l.elements[m];for(var y=d[m],b=d[m+1];y<b;y++)if(o.bIndex=f[y],o.b.element=l.elements[f[y]],o.type=v[y],o.order=h[y],o.test(r,!1)){var S=n.subsetBuilder(!1);S.beginUnit(l.id),S.addElement(o.a.element),S.addElement(o.b.element),S.commitUnit(),a.add(S.getStructure())}}}}for(var x=0,C=i.edges;x<C.length;x++){var w=C[x];if(o.a.unit=n.unitMap.get(w.unitA),o.a.element=o.a.unit.elements[w.indexA],o.aIndex=w.indexA,o.b.unit=n.unitMap.get(w.unitA),o.b.element=o.b.unit.elements[w.indexB],o.bIndex=w.indexB,o.order=w.props.order,o.type=w.props.flag,o.test(r,!1)){var S=n.subsetBuilder(!1);S.addToUnit(o.a.unit.id,o.a.element),S.addToUnit(o.b.unit.id,o.b.element),a.add(S.getStructure())}}return r.popCurrentBond(),a.getSelection()}}const X6e=Object.freeze(Object.defineProperty({__proto__:null,all:VJ,atoms:FL,bondedAtomicPairs:W6e,chains:j6e,none:LL,querySelection:$6e,residues:U6e,rings:q6e},Symbol.toStringTag,{value:"Module"}));var IE=function(){function e(t){this.parent=t,this.ids=[],this.unitMap=Ws.Mutable(),this.parentId=-1,this.currentUnit=tn.create(),this.elementCount=0}return e.prototype.addToUnit=function(t,r){var n=this.unitMap.get(t);if(n)tn.add(n,r,r)&&this.elementCount++;else{var i=tn.create();tn.add(i,r,r),this.unitMap.set(t,i),this.ids[this.ids.length]=t,this.elementCount++}},e.prototype.has=function(t,r){var n=this.unitMap.get(t);return n?tn.has(n,r):!1},e.prototype.beginUnit=function(t){this.parentId=t,this.unitMap.has(t)?this.currentUnit=this.unitMap.get(t):this.currentUnit=this.currentUnit.array.length>0?tn.create():this.currentUnit},e.prototype.addElement=function(t){tn.add(this.currentUnit,t,t)&&this.elementCount++},e.prototype.commitUnit=function(){this.currentUnit.array.length===0||this.unitMap.has(this.parentId)||(this.ids[this.ids.length]=this.parentId,this.unitMap.set(this.parentId,this.currentUnit),this.parentId=-1)},e.prototype.getStructure=function(){if(this.isEmpty)return We.Empty;var t=[];Tu(this.ids);for(var r=wl.UnitEquivalenceBuilder(),n=0,i=this.ids.length;n<i;n++){var a=this.ids[n],o=this.parent.unitMap.get(a),s=this.unitMap.get(a).array,u=s.length;if(s.length===o.elements.length){t[t.length]=o,r.add(o.id,o);continue}u>1&&Tu(s);var l=o.getChild(Je.ofSortedArray(s)),c=r.add(l.id,l);l!==c&&(l=c.applyOperator(l.id,l.conformation.operator,!0)),t[t.length]=l}return We.create(t,{parent:this.parent})},Object.defineProperty(e.prototype,"isEmpty",{get:function(){return this.elementCount===0},enumerable:!1,configurable:!0}),e}();function Y6e(e){var t=e.unit,r=e.flags,n=e.proteinInfo,i=t.conformation.position,a=t.model.atomicHierarchy.derived.residue.traceElementIndex,o=n.residueIndices,s=n.nIndices,u=o.length,l=function(k,R){return k===-1?_.setNaN(R):i(k,R)},c=_(),d=_(),f=_(),p=_(),v=_(),h=_(),m=_();e:for(var g=2;g<u-2;g++){for(var y=0;y<4;y++){var b=g+y-2;if(l(a[b],p),l(s[b+1],v),_.squaredDistance(p,v)>6.25)continue e}var S=o[g-2],x=o[g],C=o[g+2],w=a[S],A=a[x],M=a[C];l(w,c),l(A,d),l(M,f),_.sub(h,c,d),_.sub(m,d,f);var D=Pu(_.angle(h,m));D&&D>70&&(r[g]|=32)}}var K6e=9,Ax=-27.888,Q6e=-.5,XU=-9.9;function Z6e(e,t,r,n){var i=_.distance(e,n),a=_.distance(t,n),o=_.distance(t,r),s=_.distance(e,r),u=Ax/i-Ax/a,l=Ax/o-Ax/s,c=u+l;return c<XU?XU:c}function J6e(e,t,r){for(var n=t.residueIndices,i=t.cIndices,a=t.hIndices,o=t.nIndices,s=t.oIndices,u=e.model.atomicHierarchy.index,l=e.conformation.invariantPosition,c=e.model.atomicHierarchy.derived.residue.traceElementIndex,d=n.length,f=[],p=[],v=[],h=_(),m=_(),g=_(),y=_(),b=_(),S=_(),x=_(),C=0,w=n.length;C<w;++C){var A=C,M=n[C],D=s[A],k=i[A],R=c[M];if(!(D===-1||k===-1)&&u.findAtomOnResidue(M,"OXT")===-1){l(D,h),l(k,m),l(R,g);for(var O=r.find(g[0],g[1],g[2],K6e),H=O.indices,B=O.count,j=0;j<B;++j){var Y=H[j];if(!(Y===A||Y-1===A||Y+1===A)){var G=o[Y];if(G!==-1){l(G,y);var $=a[Y];if($===-1){if(Y===0)continue;var q=Y-1,ee=s[q],fe=i[q];if(ee===-1||fe===-1)continue;l(ee,x),l(fe,S),_.sub(b,S,x);var W=_.distance(x,S);_.scaleAndAdd(b,y,b,1/W)}else l($,b);var X=Z6e(h,m,y,b);X>Q6e||(f[f.length]=A,p[p.length]=Y,v[v.length]=X)}}}}}return eNe(d,f,p,v)}function eNe(e,t,r,n){for(var i=new Io.DirectedEdgeBuilder(e,t,r),a=new Float32Array(i.slotCount),o=0,s=i.edgeCount;o<s;o++)i.addNextEdge(),i.assignProperty(a,n[o]);return i.createGraph({energies:n})}var rr;(function(e){e.is=ba.has,e.create=ba.create})(rr||(rr={}));var Px=function(){function e(t,r,n){this.partner1=Math.min(t,r),this.partner2=Math.max(t,r),this.type=n}return e}();function tNe(e){for(var t=e.proteinInfo,r=e.hbonds,n=e.flags,i=[1024,2048,4096,128,256,512],a=0;a<3;a++)for(var o=0,s=t.residueIndices.length-1;o<s;++o)if(r.getDirectedEdgeIndex(o,o+a+3)!==-1)if(n[o]|=i[a+3]|i[a],e.params.oldDefinition)for(var u=1;u<a+3;++u)n[o+u]|=i[a+3]|64;else for(var u=0;u<=a+3;++u)n[o+u]|=i[a+3]|64}function rNe(e){for(var t=e.proteinInfo,r=e.flags,n=t.residueIndices.length,i=[1024,2048,4096,128,256,512],a=[0,0,0,8,1,16],o=e.params.oldOrdering?[4,3,5]:[3,4,5],s=0;s<o.length;s++)for(var u=o[s],l=1,c=n-u;l<c;l++){var d=rr.create(r[l]),f=rr.create(r[l-1]),p=rr.create(r[l+1]);if(e.params.oldOrdering){if(u===3&&(rr.is(d,1)||rr.is(p,1))||u===5&&(rr.is(d,1)||rr.is(d,8)||rr.is(p,1)||rr.is(p,8)))continue}else if(u===4&&(rr.is(d,8)||rr.is(p,8))||u===5&&(rr.is(d,1)||rr.is(d,8)||rr.is(p,1)||rr.is(p,8)))continue;if(rr.is(d,i[u])&&rr.is(d,i[u-3])&&rr.is(f,i[u])&&rr.is(f,i[u-3]))if(e.params.oldDefinition)for(var v=0;v<u;v++)r[l+v]|=a[u];else for(var v=-1;v<=u;v++)r[l+v]|=a[u]}}function nNe(e,t){if(t.type!==e.type||t.partner1!==e.firstEnd+1)return!1;if(t.type===0){if(t.partner2===e.secondEnd+1)return!0}else if(t.partner2===e.secondStart-1)return!0;return!1}function iNe(e,t){return e.type===t.type&&t.firstStart-e.firstEnd<6&&e.firstStart<t.firstStart&&t.nextLadder===0?e.type===0?YU(e,t):YU(t,e):!1}function YU(e,t){return t.secondStart-e.secondEnd>0&&(t.secondStart-e.secondEnd<6&&t.firstStart-e.firstEnd<3||t.secondStart-e.secondEnd<3)}function aNe(e){for(var t=e.bridges,r=e.ladders,n=0;n<t.length;n++){for(var i=t[n],a=!1,o=0;o<r.length;o++){var s=r[o];nNe(s,i)&&(a=!0,s.firstEnd++,i.type===0?s.secondEnd++:s.secondStart--)}a||(r[r.length]={previousLadder:0,nextLadder:0,firstStart:i.partner1,firstEnd:i.partner1,secondStart:i.partner2,secondEnd:i.partner2,type:i.type})}for(var u=0;u<r.length;u++)for(var l=r[u],c=u;c<r.length;c++){var d=r[c];iNe(l,d)&&(l.nextLadder=c,d.previousLadder=u)}}function oNe(e){for(var t=e.proteinInfo,r=e.hbonds,n=e.flags,i=e.bridges,a=r.offset,o=r.b,s,u,l=0,c=t.residueIndices.length;l<c;++l)for(var d=a[l],f=a[l+1];d<f;d++){var p=o[d];l>p||(s=l+1,u=p,s!==u&&r.getDirectedEdgeIndex(u,s+1)!==-1&&(n[s]|=2,n[u]|=2,i[i.length]=new Px(s,u,0)),s=l,u=p-1,s!==u&&r.getDirectedEdgeIndex(u-1,s)!==-1&&(n[s]|=2,n[u]|=2,i[i.length]=new Px(u,s,0)),s=l,u=p,s!==u&&r.getDirectedEdgeIndex(u,s)!==-1&&(n[s]|=2,n[u]|=2,i[i.length]=new Px(u,s,1)),s=l+1,u=p-1,s!==u&&r.getDirectedEdgeIndex(u-1,s+1)!==-1&&(n[s]|=2,n[u]|=2,i[i.length]=new Px(u,s,1)))}i.sort(function(v,h){return v.partner1>h.partner1?1:v.partner1<h.partner1?-1:0})}function KU(e){return rr.is(e,8)||rr.is(e,1)||rr.is(e,16)}function sNe(e){for(var t=e.ladders,r=e.flags,n=0;n<t.length;n++){for(var i=t[n],a=i.firstStart;a<=i.firstEnd;a++){var o=i.firstStart-a,s=i.secondStart-o;i.firstStart!==i.firstEnd?(r[a]|=4,r[s]|=4):(!KU(r[a])&&rr.is(r[a],4)&&(r[a]|=2),!KU(r[s])&&rr.is(r[s],4)&&(r[s]|=2))}if(i.nextLadder!==0){for(var u=t[i.nextLadder],a=i.firstStart;a<=u.firstEnd;a++)r[a]|=4;if(i.type===0)for(var a=i.secondStart;a<=u.secondEnd;a++)r[a]|=4;else for(var a=u.secondEnd;a<=i.secondStart;a++)r[a]|=4}}}function uNe(e,t){var r=t.cIndices,n=t.nIndices,i=t.residueIndices,a=e.conformation.position,o=e.model.atomicHierarchy.index,s=e.model.atomicHierarchy.derived.residue.traceElementIndex,u=i.length,l=function(C,w){return C===-1?_.setNaN(w):a(C,w)},c=_(),d=_(),f=_(),p=_(),v=_(),h=_(),m=_(),g=_(),y=_();if(u===0)return{phi:new Float32Array(0),psi:new Float32Array(0)};var b=new Float32Array(u-1),S=new Float32Array(u-1);l(-1,c),l(-1,d),l(-1,f),l(r[0],p),l(s[i[0]],v),l(n[0],h),l(r[1],m),l(s[i[1]],g),l(n[1],y);for(var x=0;x<u-1;++x)o.findAtomOnResidue(i[x],"OXT")===-1&&(b[x]=Pu(_.dihedralAngle(c,h,v,p)),S[x]=Pu(_.dihedralAngle(h,v,p,y)),c=p,d=v,f=h,p=m,v=g,h=y,l(r[x+1],m),l(s[i[x+1]],g),l(n[x+1],y));return{phi:b,psi:S}}function lNe(e,t){for(var r=e.model.atomicConformation,n=r.x,i=r.y,a=r.z,o=e.model.atomicHierarchy.derived.residue.traceElementIndex,s=new Uint32Array(t.length),u=0,l=t.length;u<l;++u)s[u]=o[t[u]];var c={x:n,y:i,z:a,indices:Je.ofSortedArray(s)};return fv(c,Xg(c))}function cNe(e){for(var t=e.model.atomicHierarchy.index,r=e.proteinElements,n=e.residueIndex,i=r.length,a=new Uint32Array(i),o=new Int32Array(i),s=new Int32Array(i),u=new Int32Array(i),l=new Int32Array(i),c=0;c<i;++c){var d=n[r[c]];a[c]=d,o[c]=t.findAtomOnResidue(d,"C"),s[c]=t.findAtomOnResidue(d,"H"),u[c]=t.findAtomOnResidue(d,"O"),l[c]=t.findAtomOnResidue(d,"N")}return{residueIndices:Je.ofSortedArray(a),cIndices:o,hIndices:s,oIndices:u,nIndices:l}}var dNe={oldDefinition:I.Boolean(!0,{description:"Whether to use the old DSSP convention for the annotation of turns and helices, causes them to be two residues shorter"}),oldOrdering:I.Boolean(!0,{description:"Alpha-helices are preferred over 3-10 helices"})};function fNe(e,t){return ce(this,void 0,void 0,function(){var r,n,i,a,o,s,u,l,c,d,f,p,v,h,m,g,y,b,S,x,C;return de(this,function(w){for(r=cNe(e),n=r.residueIndices,i=lNe(e,n),a=J6e(e,r,i),o=n.length,s=new Uint32Array(o),u=uNe(e,r),l=[],c=[],d=t.oldDefinition?vNe:gNe,f=t.oldOrdering?mNe:yNe,p={params:t,getResidueFlag:d,getFlagName:f,unit:e,proteinInfo:r,flags:s,hbonds:a,torsionAngles:u,ladders:l,bridges:c},tNe(p),rNe(p),Y6e(p),oNe(p),aNe(p),sNe(p),v=bNe(s,d),h=new Uint32Array(o),m=[],g=[],y=function(A){return Je.indexOf(n,A)},b=0,S=n.length;b<S;++b)x=v[b],h[b]=x,C=d(s[b]),(g.length===0||C!==g[g.length-1].flags)&&(g[g.length]=pNe(hNe(x),s[b],d)),m[b]=g.length-1;return[2,wJ(h,m,g,y)]})})}function pNe(e,t,r){return e==="helix"?{kind:"helix",flags:r(t)}:e==="sheet"?{kind:"sheet",flags:r(t)}:e==="turn"||e==="bend"?{kind:"turn",flags:r(t)}:{kind:"none"}}function hNe(e){return e===Br.SecondaryStructureDssp.H||e===Br.SecondaryStructureDssp.G||e===Br.SecondaryStructureDssp.I?"helix":e===Br.SecondaryStructureDssp.B||e===Br.SecondaryStructureDssp.E?"sheet":e===Br.SecondaryStructureDssp.T?"turn":e===Br.SecondaryStructureDssp.S?"bend":"none"}function vNe(e){return rr.is(e,1)?Br.SecondaryStructureDssp.H:rr.is(e,4)?Br.SecondaryStructureDssp.E:rr.is(e,2)?Br.SecondaryStructureDssp.B:rr.is(e,8)?Br.SecondaryStructureDssp.G:rr.is(e,16)?Br.SecondaryStructureDssp.I:rr.is(e,64)?Br.SecondaryStructureDssp.T:rr.is(e,32)?Br.SecondaryStructureDssp.S:0}function mNe(e){return rr.is(e,1)?"H":rr.is(e,4)?"E":rr.is(e,2)?"B":rr.is(e,8)?"G":rr.is(e,16)?"I":rr.is(e,64)?"T":rr.is(e,32)?"S":"-"}function gNe(e){return rr.is(e,16)?Br.SecondaryStructureDssp.I:rr.is(e,1)?Br.SecondaryStructureDssp.H:rr.is(e,4)?Br.SecondaryStructureDssp.E:rr.is(e,2)?Br.SecondaryStructureDssp.B:rr.is(e,8)?Br.SecondaryStructureDssp.G:rr.is(e,64)?Br.SecondaryStructureDssp.T:rr.is(e,32)?Br.SecondaryStructureDssp.S:0}function yNe(e){return rr.is(e,16)?"I":rr.is(e,1)?"H":rr.is(e,4)?"E":rr.is(e,2)?"B":rr.is(e,8)?"G":rr.is(e,64)?"T":rr.is(e,32)?"S":"-"}function bNe(e,t){for(var r=new Uint32Array(e.length),n=0,i=e.length;n<i;++n){var a=rr.create(e[n]);r[n]=t(a)}return r}var hp;(function(e){function t(n){var i=this,a=n.descriptor.name,o=n.type==="root"?"inheritedPropertyData":"currentPropertyData",s=function(l){return a in l[o]||(l[o][a]={props:E({},I.getDefaultValues(n.getParams(l))),data:up.create(void 0)}),l[o][a]},u=function(l,c,d){var f=s(l);l[o][a]={props:c,data:up.withValue(f.data,d)}};return{label:n.label,descriptor:n.descriptor,isHidden:n.isHidden,getParams:function(l){var c=I.clone(n.getParams(l));return I.setDefaultValues(c,s(l).props),c},defaultParams:n.defaultParams,isApplicable:n.isApplicable,attach:function(l,c,d,f){return d===void 0&&(d={}),ce(i,void 0,void 0,function(){var p,v,h,m,g,y;return de(this,function(b){switch(b.label){case 0:return f&&c.customPropertyDescriptors.reference(n.descriptor,!0),n.type==="root"&&(c=c.root),p=s(c.root).props,v=s(c),h=I.merge(n.defaultParams,p,d),v.data.value&&I.areEqual(n.defaultParams,v.props,h)?[2]:[4,n.obtain(l,c,h)];case 1:return m=b.sent(),g=m.value,y=m.assets,c.customPropertyDescriptors.add(n.descriptor),c.customPropertyDescriptors.assets(n.descriptor,y),u(c,h,g),[2]}})})},ref:function(l,c){return l.customPropertyDescriptors.reference(n.descriptor,c)},get:function(l){return s(l).data},set:function(l,c,d){c===void 0&&(c={}),n.type==="root"&&(l=l.root);var f=s(l),p=I.merge(n.defaultParams,f.props,c);I.areEqual(n.defaultParams,f.props,p)||(u(l,p,d),l.customPropertyDescriptors.assets(n.descriptor))},props:function(l){return s(l).props}}}e.createProvider=t;function r(n,i,a){var o=this,s={value:I.Value(a,{isHidden:!0})};return t({label:Zo(n),descriptor:To({name:n}),isHidden:!0,type:i,defaultParams:s,getParams:function(){return{value:I.Value(a,{isHidden:!0})}},isApplicable:function(){return!0},obtain:function(u,l,c){return ce(o,void 0,void 0,function(){return de(this,function(d){return[2,E(E({},I.getDefaultValues(s)),c)]})})}})}e.createSimple=r})(hp||(hp={}));function HJ(e){var t="model";if(e){t="dssp";for(var r=0,n=e.models.length;r<n;++r){var i=e.models[r];if($t.isFromPdbArchive(i)||$t.hasSecondaryStructure(i)){t="model";break}}}return{type:I.MappedStatic(t,{model:I.EmptyGroup({label:"Model"}),dssp:I.Group(dNe,{label:"DSSP",isFlat:!0})},{options:[["model","Model"],["dssp","DSSP"]]})}}var QU=HJ(),zl=hp.createProvider({label:"Secondary Structure",descriptor:To({name:"molstar_computed_secondary_structure"}),type:"root",defaultParams:QU,getParams:HJ,isApplicable:function(e){return!0},obtain:function(e,t,r){return ce(void 0,void 0,void 0,function(){var n,i,a,o;return de(this,function(s){switch(s.label){case 0:switch(n=E(E({},I.getDefaultValues(QU)),r),i=n.type.name,i){case"dssp":return[3,1];case"model":return[3,3]}return[3,5];case 1:return a={},[4,xNe(t,n.type.params)];case 2:return[2,(a.value=s.sent(),a)];case 3:return o={},[4,SNe(t)];case 4:return[2,(o.value=s.sent(),o)];case 5:return[2]}})})}});function xNe(e,t){return ce(this,void 0,void 0,function(){var r,n,i,a,o;return de(this,function(s){switch(s.label){case 0:r=new Map,n=0,i=e.unitSymmetryGroups.length,s.label=1;case 1:return n<i?(a=e.unitSymmetryGroups[n].units[0],je.isAtomic(a)&&!$t.isCoarseGrained(a.model)?[4,fNe(a,t)]:[3,3]):[3,4];case 2:o=s.sent(),r.set(a.invariantId,o),s.label=3;case 3:return++n,[3,1];case 4:return[2,r]}})})}function SNe(e){return ce(this,void 0,void 0,function(){var t,r,n,i,a;return de(this,function(o){for(t=new Map,r=0,n=e.unitSymmetryGroups.length;r<n;++r)i=e.unitSymmetryGroups[r].units[0],je.isAtomic(i)&&(a=Eb.Provider.get(i.model),a&&t.set(i.invariantId,a));return[2,t]})})}var CNe={true:function(e){return!0},false:function(e){return!1},zero:function(e){return 0}};function Fn(){throw"Property only available for atomic models."}function Hd(e){throw e?"Property only available for coarse models ("+e+").":"Property only available for coarse models."}var Wy={key:function(e){return e.element},x:function(e){return e.unit.conformation.x(e.element)},y:function(e){return e.unit.conformation.y(e.element)},z:function(e){return e.unit.conformation.z(e.element)},id:function(e){return je.isAtomic(e.unit)?e.unit.model.atomicConformation.atomId.value(e.element):Fn()},occupancy:function(e){return je.isAtomic(e.unit)?e.unit.model.atomicConformation.occupancy.value(e.element):Fn()},B_iso_or_equiv:function(e){return je.isAtomic(e.unit)?e.unit.model.atomicConformation.B_iso_or_equiv.value(e.element):Fn()},sourceIndex:function(e){return je.isAtomic(e.unit)?e.unit.model.atomicHierarchy.atomSourceIndex.value(e.element):e.element},type_symbol:function(e){return je.isAtomic(e.unit)?e.unit.model.atomicHierarchy.atoms.type_symbol.value(e.element):Fn()},label_atom_id:function(e){return je.isAtomic(e.unit)?e.unit.model.atomicHierarchy.atoms.label_atom_id.value(e.element):Fn()},auth_atom_id:function(e){return je.isAtomic(e.unit)?e.unit.model.atomicHierarchy.atoms.auth_atom_id.value(e.element):Fn()},label_alt_id:function(e){return je.isAtomic(e.unit)?e.unit.model.atomicHierarchy.atoms.label_alt_id.value(e.element):Fn()},label_comp_id:Y_,auth_comp_id:function(e){return je.isAtomic(e.unit)?e.unit.model.atomicHierarchy.atoms.auth_comp_id.value(e.element):Fn()},pdbx_formal_charge:function(e){return je.isAtomic(e.unit)?e.unit.model.atomicHierarchy.atoms.pdbx_formal_charge.value(e.element):Fn()},vdw_radius:function(e){return je.isAtomic(e.unit)?i2(e.unit.model.atomicHierarchy.atoms.type_symbol.value(e.element)):Fn()}};function Y_(e){return je.isAtomic(e.unit)||Fn(),e.unit.model.atomicHierarchy.atoms.label_comp_id.value(e.element)}function NL(e){return je.isAtomic(e.unit)?e.unit.model.atomicHierarchy.residues.label_seq_id.value(e.unit.residueIndex[e.element]):Fn()}function _Ne(e){je.isAtomic(e.unit)||Fn();var t=e.unit.model.sequence.byEntityKey[Qa(e)];return t&&t.sequence.microHet.has(NL(e))}function ZU(e){je.isAtomic(e.unit)||Fn();var t=e.unit.model.sequence.byEntityKey[Qa(e)];return t?t.sequence.microHet.get(NL(e))||[Y_(e)]:[Y_(e)]}var wNe={key:function(e){return je.isAtomic(e.unit)?e.unit.residueIndex[e.element]:Fn()},group_PDB:function(e){return je.isAtomic(e.unit)?e.unit.model.atomicHierarchy.residues.group_PDB.value(e.unit.residueIndex[e.element]):Fn()},label_seq_id:NL,auth_seq_id:function(e){return je.isAtomic(e.unit)?e.unit.model.atomicHierarchy.residues.auth_seq_id.value(e.unit.residueIndex[e.element]):Fn()},pdbx_PDB_ins_code:function(e){return je.isAtomic(e.unit)?e.unit.model.atomicHierarchy.residues.pdbx_PDB_ins_code.value(e.unit.residueIndex[e.element]):Fn()},isNonStandard:function(e){return je.isAtomic(e.unit)?ZU(e).some(function(t){return e.unit.model.properties.chemicalComponentMap.get(t).mon_nstd_flag[0]==="n"}):Fn()},hasMicroheterogeneity:_Ne,microheterogeneityCompIds:ZU,secondary_structure_type:function(e){var t,r;je.isAtomic(e.unit)||Fn();var n=(t=zl.get(e.structure).value)===null||t===void 0?void 0:t.get(e.unit.invariantId);return(r=n==null?void 0:n.type[e.unit.residueIndex[e.element]])!==null&&r!==void 0?r:536870912},secondary_structure_key:function(e){var t,r;je.isAtomic(e.unit)||Fn();var n=(t=zl.get(e.structure).value)===null||t===void 0?void 0:t.get(e.unit.invariantId);return(r=n==null?void 0:n.key[e.unit.residueIndex[e.element]])!==null&&r!==void 0?r:-1},chem_comp_type:function(e){return je.isAtomic(e.unit)?e.unit.model.properties.chemicalComponentMap.get(Y_(e)).type:Fn()}},ENe={key:function(e){return je.isAtomic(e.unit)?e.unit.chainIndex[e.element]:Fn()},label_asym_id:function(e){return je.isAtomic(e.unit)?e.unit.model.atomicHierarchy.chains.label_asym_id.value(e.unit.chainIndex[e.element]):Fn()},auth_asym_id:function(e){return je.isAtomic(e.unit)?e.unit.model.atomicHierarchy.chains.auth_asym_id.value(e.unit.chainIndex[e.element]):Fn()},label_entity_id:function(e){return je.isAtomic(e.unit)?e.unit.model.atomicHierarchy.chains.label_entity_id.value(e.unit.chainIndex[e.element]):Fn()}},ANe={key:Wy.key,entityKey:function(e){return je.isCoarse(e.unit)?e.unit.coarseElements.entityKey[e.element]:Hd()},x:Wy.x,y:Wy.y,z:Wy.z,asym_id:function(e){return je.isCoarse(e.unit)?e.unit.coarseElements.asym_id.value(e.element):Hd()},seq_id_begin:function(e){return je.isCoarse(e.unit)?e.unit.coarseElements.seq_id_begin.value(e.element):Hd()},seq_id_end:function(e){return je.isCoarse(e.unit)?e.unit.coarseElements.seq_id_end.value(e.element):Hd()},sphere_radius:function(e){return je.isSpheres(e.unit)?e.unit.coarseConformation.radius[e.element]:Hd("spheres")},sphere_rmsf:function(e){return je.isSpheres(e.unit)?e.unit.coarseConformation.rmsf[e.element]:Hd("spheres")},gaussian_weight:function(e){return je.isGaussians(e.unit)?e.unit.coarseConformation.weight[e.element]:Hd("gaussians")},gaussian_covariance_matrix:function(e){return je.isGaussians(e.unit)?e.unit.coarseConformation.covariance_matrix[e.element]:Hd("gaussians")}};function Qa(e){switch(e.unit.kind){case 0:return e.unit.model.atomicHierarchy.index.getEntityFromChain(e.unit.chainIndex[e.element]);case 1:return e.unit.model.coarseHierarchy.spheres.entityKey[e.element];case 2:return e.unit.model.coarseHierarchy.gaussians.entityKey[e.element]}}var PNe={key:Qa,id:function(e){return e.unit.model.entities.data.id.value(Qa(e))},type:function(e){return e.unit.model.entities.data.type.value(Qa(e))},src_method:function(e){return e.unit.model.entities.data.src_method.value(Qa(e))},pdbx_description:function(e){return e.unit.model.entities.data.pdbx_description.value(Qa(e))},formula_weight:function(e){return e.unit.model.entities.data.formula_weight.value(Qa(e))},pdbx_number_of_molecules:function(e){return e.unit.model.entities.data.pdbx_number_of_molecules.value(Qa(e))},details:function(e){return e.unit.model.entities.data.details.value(Qa(e))},pdbx_mutation:function(e){return e.unit.model.entities.data.pdbx_mutation.value(Qa(e))},pdbx_fragment:function(e){return e.unit.model.entities.data.pdbx_fragment.value(Qa(e))},pdbx_ec:function(e){return e.unit.model.entities.data.pdbx_ec.value(Qa(e))},subtype:function(e){return e.unit.model.entities.subtype.value(Qa(e))},prd_id:function(e){return e.unit.model.entities.prd_id.value(Qa(e))}},TNe=[],INe={id:function(e){return e.unit.id},chainGroupId:function(e){return e.unit.chainGroupId},multiChain:function(e){return je.Traits.is(e.unit.traits,1)},object_primitive:function(e){return e.unit.objectPrimitive},operator_name:function(e){return e.unit.conformation.operator.name},model_index:function(e){return e.unit.model.modelNum},model_label:function(e){return e.unit.model.label},model_entry_id:function(e){return e.unit.model.entryId},hkl:function(e){return e.unit.conformation.operator.hkl},spgrOp:function(e){return e.unit.conformation.operator.spgrOp},model_num:function(e){return e.unit.model.modelNum},pdbx_struct_assembly_id:function(e){var t;return((t=e.unit.conformation.operator.assembly)===null||t===void 0?void 0:t.id)||bn.DefaultName},pdbx_struct_oper_list_ids:function(e){var t;return((t=e.unit.conformation.operator.assembly)===null||t===void 0?void 0:t.operList)||TNe},struct_ncs_oper_id:function(e){return e.unit.conformation.operator.ncsId}},lt={constant:CNe,atom:Wy,residue:wNe,chain:ENe,entity:PNe,unit:INe,coarse:ANe},S1=function(){function e(t){var r;this.index=new Map,this.checkOperator=!1,this.checkOperator=(r=t==null?void 0:t.checkOperator)!==null&&r!==void 0?r:!1}return e.prototype.add=function(t){var r=this.index.get(t.label_asym_id);r||(r=new Map,this.index.set(t.label_asym_id,r));var n=r.get(t.label_seq_id);n||(n=[],r.set(t.label_seq_id,n));var i=this._find(t,n);return i?!1:(n.push(t),!0)},e.prototype.hasLabelAsymId=function(t){return this.index.has(t)},e.prototype.has=function(t){var r,n,i=JU(t);if(this.index.has(i)){var a=this.index.get(i),o=ej(t);if(a.has(o))for(var s=a.get(o),u=tj(t),l=rj(t),c=nj(t),d=(r=ij(t))!==null&&r!==void 0?r:"1_555",f=0,p=s;f<p.length;f++){var v=p[f];if(!(v.label_comp_id!==u||v.label_alt_id!==l||v.ins_code!==c)&&!(this.checkOperator&&((n=v.operator_name)!==null&&n!==void 0?n:"1_555")!==d))return v}}},e.getLabel=function(t,r){var n;return r===void 0&&(r=!1),t.label_asym_id+" "+t.label_comp_id+" "+t.label_seq_id+":"+t.ins_code+":"+t.label_alt_id+(r?" "+((n=t.operator_name)!==null&&n!==void 0?n:"1_555"):"")},e.getEntryFromLocation=function(t){var r;return{label_asym_id:JU(t),label_comp_id:tj(t),label_seq_id:ej(t),label_alt_id:rj(t),ins_code:nj(t),operator_name:(r=ij(t))!==null&&r!==void 0?r:"1_555"}},e.prototype._find=function(t,r){for(var n,i,a=0,o=r;a<o.length;a++){var s=o[a];if(!(s.label_comp_id!==t.label_comp_id||s.label_alt_id!==t.label_alt_id||s.ins_code!==t.ins_code)&&!(this.checkOperator&&((n=s.operator_name)!==null&&n!==void 0?n:"1_555")!==((i=t.operator_name)!==null&&i!==void 0?i:"1_555")))return!0}return!1},e}(),JU=lt.chain.label_asym_id,ej=lt.residue.label_seq_id,tj=lt.atom.label_comp_id,rj=lt.atom.label_alt_id,nj=lt.residue.pdbx_PDB_ins_code,ij=lt.unit.operator_name;function Yg(e,t,r){for(var n=t.subsetBuilder(!0),i=0,a=r.units;i<a.length;i++){var o=a[i];if(o.kind!==0){n.setUnit(o.id,o.elements);continue}var s=o.model.atomicHierarchy.residueAtomSegments,u=t.unitMap.get(o.id).elements,l=o.elements;n.beginUnit(o.id);for(var c=nr.transientSegments(s,l);c.hasNext;)for(var d=c.move().index,f=s.offsets[d],p=s.offsets[d+1];f<p;f++)Je.has(u,f)&&n.addElement(f);n.commitUnit(),e.throwIfTimedOut()}return n.getStructure()}function MNe(e){return function(r){var n=e(r);if(mt.isSingleton(n))return mt.Singletons(r.inputStructure,Yg(r,r.inputStructure,n.structure));for(var i=new fD(r.inputStructure),a=0,o=n.structures;a<o.length;a++){var s=o[a];i.add(Yg(r,r.inputStructure,s))}return i.getSelection()}}function pD(e,t,r,n){for(var i=new IE(t),a=t.lookup3d,o=n.radius,s=0,u=r.units;s<u.length;s++){for(var l=u[s],c=l.conformation,d=c.x,f=c.y,p=c.z,v=l.elements,h=0,m=v.length;h<m;h++){var g=v[h];a.findIntoBuilder(d(g),f(g),p(g),o,i)}e.throwIfTimedOut()}return n.wholeResidues?Yg(e,t,i.getStructure()):i.getStructure()}function aj(e,t,r,n){var i=new IE(t),a=t.lookup3d,o=n.elementRadius,s=n.elementRadiusClosure,u=n.sourceMaxRadius,l=n.radius;e.pushCurrentElement(),e.element.structure=r;for(var c=0,d=r.units;c<d.length;c++){var f=d[c];e.element.unit=f;for(var p=f.conformation,v=p.x,h=p.y,m=p.z,g=f.elements,y=0,b=g.length;y<b;y++){var S=g[y];e.element.element=S;var x=o(e);a.findIntoBuilderWithRadius(v(S),h(S),m(S),x,u,l,s,i)}e.throwIfTimedOut()}return e.popCurrentElement(),n.wholeResidues?Yg(e,t,i.getStructure()):i.getStructure()}function DNe(e,t){return function(r){return e.element.structure=r.structure,e.element.unit=r.unit,e.element.element=r.element,t(e)}}function RNe(e,t){var r=0;e.element.structure=e.inputStructure;for(var n=0,i=e.inputStructure.units;n<i.length;n++){var a=i[n];e.element.unit=a;for(var o=a.elements,s=0,u=o.length;s<u;s++){var l=o[s];e.element.element=l;var c=t(e);c>r&&(r=c)}}return e.throwIfTimedOut(),r}function kNe(e,t){return function(n){var i=e(n);if(t.elementRadius){var a=E(E({},t),{elementRadius:t.elementRadius,elementRadiusClosure:DNe(n,t.elementRadius),sourceMaxRadius:RNe(n,t.elementRadius)});if(mt.isSingleton(i)){var o=aj(n,n.inputStructure,i.structure,a),s=mt.Singletons(n.inputStructure,o);return s}else{for(var u=new fD(n.inputStructure),l=0,c=i.structures;l<c.length;l++){var d=c[l];u.add(aj(n,n.inputStructure,d,a))}return u.getSelection()}}if(mt.isSingleton(i)){var o=pD(n,n.inputStructure,i.structure,t),s=mt.Singletons(n.inputStructure,o);return s}else{for(var u=new fD(n.inputStructure),f=0,p=i.structures;f<p.length;f++){var d=p[f];u.add(pD(n,n.inputStructure,d,t))}return u.getSelection()}}}function ONe(e,t){return function(n){var i=e(n);if(mt.structureCount(i)===0)return i;var a=mt.UniqueBuilder(n.inputStructure),o=function(s){return a.add(s)};return mt.forEach(i,function(s,u){n.pushInputStructure(s),mt.forEach(t(n),o),n.popInputStructure(),u%10===0&&n.throwIfTimedOut()}),a.getSelection()}}function LNe(e,t){return function(n){var i=e(n);if(mt.structureCount(i)===0)return i;var a=t(n);if(mt.structureCount(a)===0)return mt.Empty(n.inputStructure);var o=mt.unionStructure(a),s=mt.UniqueBuilder(n.inputStructure);return mt.forEach(i,function(u,l){var c=UJ(o,u);c.elementCount!==0&&s.add(c),l%50===0&&n.throwIfTimedOut()}),s.getSelection()}}function FNe(e,t){return function(n){var i=e(n);if(mt.structureCount(i)===0)return i;var a=t(n);if(mt.structureCount(a)===0)return i;var o=mt.unionStructure(a),s=mt.UniqueBuilder(n.inputStructure);return mt.forEach(i,function(u,l){var c=OL(u,o);c.elementCount!==0&&s.add(c),l%50===0&&n.throwIfTimedOut()}),s.getSelection()}}function NNe(e){return function(r){var n=mt.LinearBuilder(r.inputStructure);return n.add(mt.unionStructure(e(r))),n.getSelection()}}function BNe(e,t){return function(n){var i=e(n),a=new Map,o=[];n.pushCurrentElement(),mt.forEach(i,function(x,C){n.element.structure=x;for(var w=0,A=x.units;w<A.length;w++){var M=A[w];n.element.unit=M;for(var D=M.elements,k=0,R=D.length;k<R;k++){n.element.element=D[k];var O=t(n),H=void 0;a.has(O)?H=a.get(O):(H=tn.create(),a.set(O,H)),tn.add(H,C,C)}}o[C]=n.inputStructure.subsetBuilder(!0),C%10===0&&n.throwIfTimedOut()}),n.element.structure=n.inputStructure;for(var s=0,u=n.inputStructure.units;s<u.length;s++){var l=u[s];n.element.unit=l;for(var c=l.elements,d=0,f=c.length;d<f;d++){n.element.element=c[d];var p=t(n);if(a.has(p))for(var v=a.get(p).array,h=0,m=v.length;h<m;h++)o[v[h]].addToUnit(l.id,c[d])}}n.popCurrentElement();for(var g=mt.UniqueBuilder(n.inputStructure),y=0,b=o;y<b.length;y++){var S=b[y];g.add(S.getStructure())}return g.getSelection()}}function UNe(e){var t=e.query,r=e.layerCount,n=e.wholeResidues,i=e.bondTest,a=e.fixedPoint,o=Math.max(r,0);return function(u){var l=mt.UniqueBuilder(u.inputStructure),c=t(u);return u.pushCurrentBond(),u.atomicBond.setTestFn(i),mt.forEach(c,function(d,f){var p=d;if(a)for(;;){var v=p.elementCount;if(p=oj(u,n,p),p.elementCount===v)break}else for(var h=0;h<o;h++)p=oj(u,n,p);l.add(p),f%10===0&&u.throwIfTimedOut()}),u.popCurrentBond(),l.getSelection()}}function oj(e,t,r){var n=jNe(e,r);return t?Yg(e,e.inputStructure,n):n}function jNe(e,t){for(var r=e.inputStructure,n=r.interUnitBonds,i=new IE(r),a=e.atomicBond,o=0,s=t.units;o<s.length;o++){var u=s[o];if(u.kind!==0){i.beginUnit(u.id);for(var l=0,c=u.elements.length;l<c;l++)i.addElement(u.elements[l]);i.commitUnit();continue}var d=r.unitMap.get(u.id),f=d.bonds,p=f.offset,v=f.b,h=f.edgeProps,m=h.flags,g=h.order;a.setStructure(r),a.a.unit=d,a.b.unit=d;for(var l=0,c=u.elements.length;l<c;l++){i.addToUnit(u.id,u.elements[l]);for(var y=Je.indexOf(d.elements,u.elements[l]),b=p[y],S=p[y+1];b<S;b++){var x=v[b],C=d.elements[x];Je.has(u.elements,C)||i.has(u.id,C)||(a.aIndex=y,a.a.element=u.elements[l],a.bIndex=x,a.b.element=C,a.type=m[b],a.order=g[b],a.test(e,!0)&&i.addToUnit(u.id,C))}}for(var w=0,A=n.getConnectedUnits(d.id);w<A.length;w++)for(var M=A[w],D=t.unitMap.get(M.unitB),k=r.unitMap.get(M.unitB),R=0,O=M.connectedIndices;R<O.length;R++){var H=O[R];if(Je.has(u.elements,d.elements[H]))for(var B=0,j=M.getEdges(H);B<j.length;B++){var Y=j[B],C=k.elements[Y.indexB];D&&Je.has(D.elements,C)||i.has(M.unitB,C)||(a.a.unit=d,a.aIndex=H,a.a.element=d.elements[H],a.b.unit=k,a.bIndex=Y.indexB,a.b.element=C,a.type=Y.props.flag,a.order=Y.props.order,a.test(e,!0)&&i.addToUnit(M.unitB,C))}}}return i.getStructure()}function zNe(e){var t=e.query,r=e.radius,n=e.includeWater;return function(a){for(var o=mt.unionStructure(t(a)),s=Yg(a,a.inputStructure,pD(a,a.inputStructure,o,{radius:r})),u=GNe(a.inputStructure),l=qNe(a.inputStructure),c=Ze.create(s),d=new Map,f=new S1({checkOperator:!0}),p=0,v=s.units;p<v.length;p++){var h=v[p];if(h.kind===0){c.unit=h;for(var m=h.elements,g=nr.transientSegments(h.model.atomicHierarchy.chainAtomSegments,m),y=nr.transientSegments(h.model.atomicHierarchy.residueAtomSegments,m);g.hasNext;){var b=g.move();c.element=m[b.start];var S=lt.chain.label_asym_id(c),x=lt.unit.operator_name(c);if(u.has(S)){d.has(S)?Fa(d.get(S),x):d.set(S,[x]);continue}var C=lt.entity.type(c);if(!(C==="water"||C==="polymer"))for(y.setSegment(b);y.hasNext;){var w=y.move();c.element=m[w.start],l.addComponent(S1.getEntryFromLocation(c),f)}}a.throwIfTimedOut()}}for(var A=a.inputStructure.subsetBuilder(!0),M=0,D=a.inputStructure.units;M<D.length;M++){var h=D[M];if(h.kind===0){c.unit=h;var m=h.elements,g=nr.transientSegments(h.model.atomicHierarchy.chainAtomSegments,m),y=nr.transientSegments(h.model.atomicHierarchy.residueAtomSegments,m);for(A.beginUnit(h.id);g.hasNext;){var b=g.move();c.element=m[b.start];var S=lt.chain.label_asym_id(c),x=lt.unit.operator_name(c);if(d.has(S)&&d.get(S).indexOf(x)>=0){A.addElementRange(m,b.start,b.end);continue}if(f.hasLabelAsymId(S))for(y.setSegment(b);y.hasNext;){var w=y.move();c.element=m[w.start],f.has(c)&&A.addElementRange(m,w.start,w.end)}}A.commitUnit(),a.throwIfTimedOut()}}var k=Ib(a.inputStructure,[A.getStructure(),o]);if(n){for(var R=new IE(a.inputStructure),O=a.inputStructure.lookup3d,H=0,B=k.units;H<B.length;H++){for(var h=B[H],j=h.conformation,Y=j.x,G=j.y,$=j.z,m=h.elements,q=0,ee=m.length;q<ee;q++){var fe=m[q];O.findIntoBuilderIf(Y(fe),G(fe),$(fe),r,R,HNe),R.addToUnit(h.id,fe)}a.throwIfTimedOut()}return mt.Sequence(a.inputStructure,[R.getStructure()])}else return mt.Sequence(a.inputStructure,[k])}}var VNe=lt.entity.type;function HNe(e){return VNe(e)==="water"}function GNe(e){var t=e.models[0],r=new Set;if(!an.is(t.sourceData))return r;for(var n=t.sourceData.data.db.pdbx_molecule,i=n._rowCount,a=n.asym_id,o=0;o<i;o++)r.add(a.value(o));return r}function qNe(e){var t,r,n=e.models[0],i=new $Ne;if(!an.is(n.sourceData))return i;for(var a=n.sourceData.data.db.struct_conn,o=a.conn_type_id,s=a.ptnr1_label_asym_id,u=a.ptnr1_label_comp_id,l=a.ptnr1_label_seq_id,c=a.ptnr1_symmetry,d=a.pdbx_ptnr1_label_alt_id,f=a.pdbx_ptnr1_PDB_ins_code,p=a.ptnr2_label_asym_id,v=a.ptnr2_label_comp_id,h=a.ptnr2_label_seq_id,m=a.ptnr2_symmetry,g=a.pdbx_ptnr2_label_alt_id,y=a.pdbx_ptnr2_PDB_ins_code,b=0;b<a._rowCount;b++){var S=o.value(b);if(!(S!=="covale"&&S!=="metalc")){var x={label_asym_id:s.value(b),label_comp_id:u.value(b),label_seq_id:l.value(b),label_alt_id:d.value(b),ins_code:f.value(b),operator_name:(t=c.value(b))!==null&&t!==void 0?t:"1_555"},C={label_asym_id:p.value(b),label_comp_id:v.value(b),label_seq_id:h.value(b),label_alt_id:g.value(b),ins_code:y.value(b),operator_name:(r=m.value(b))!==null&&r!==void 0?r:"1_555"};i.addEdge(x,C)}}return i}var $Ne=function(){function e(){this.vertices=new Map,this.edges=new Map}return e.prototype.addVertex=function(t,r){this.vertices.has(r)||(this.vertices.set(r,t),this.edges.set(r,[]))},e.prototype.addEdge=function(t,r){var n=S1.getLabel(t),i=S1.getLabel(r);this.addVertex(t,n),this.addVertex(r,i),Fa(this.edges.get(n),i),Fa(this.edges.get(i),n)},e.prototype.addComponent=function(t,r){var n=S1.getLabel(t);if(!this.vertices.has(n)){r.add(t);return}var i=new Set,a=new Set,o=[n];for(a.add(n),r.add(t);o.length>0;){var s=o.pop();i.add(s);for(var u=this.vertices.get(s),l=0,c=this.edges.get(s);l<c.length;l++){var d=c[l];if(!i.has(d)&&(o.push(d),!a.has(d))){a.add(d);var f=this.vertices.get(d);u.operator_name===f.operator_name?r.add(E(E({},f),{operator_name:t.operator_name})):r.add(f)}}}},e}();const WNe=Object.freeze(Object.defineProperty({__proto__:null,exceptBy:FNe,expandProperty:BNe,includeConnected:UNe,includeSurroundings:kNe,intersectBy:LNe,querySelection:ONe,surroundingLigands:zNe,union:NNe,wholeResidues:MNe},Symbol.toStringTag,{value:"Module"}));function XNe(e,t,r,n,i,a){return t.elementCount===0||r.elementCount===0?!0:t.elementCount<=r.elementCount?K_.check(e,t,r,n,i,a):K_.check(e,r,t,n,i,a)}function YNe(e,t,r,n,i){return t.elementCount===0||r.elementCount===0?!0:t.elementCount<=r.elementCount?Q_.check(e,t,r,n,i):Q_.check(e,r,t,n,i)}var K_;(function(e){var t=_.zero();function r(o,s,u,l,c,d,f){var p=s.elements,v=s.conformation.position,h=t;o.element.unit=s;for(var m=!1,g=0,y=p.length;g<y;g++){var b=p[g];o.element.element=b;var S=Math.max(0,_.distance(u,v(b,h))-l-f(o));if(S<c)return 0;S<d&&(m=!0)}return m?1:2}function n(o,s,u,l,c,d,f){for(var p=s.units,v=!1,h=0,m=p.length;h<m;h++){var g=r(o,p[h],u,l,c,d,f);if(g===0)return 0;g===1&&(v=!0)}return v?1:2}e.toPoint=n;var i=_.zero();function a(o,s,u,l,c,d){if(s.elementCount===0||u.elementCount===0)return 0;var f=s.units,p=!1;o.element.structure=s;for(var v=0,h=f.length;v<h;v++){var m=f[v],g=m.elements,y=m.conformation.position;o.element.unit=m;for(var b=0,S=g.length;b<S;b++){var x=g[b];o.element.element=x;var C=n(o,u,y(x,i),d(o),l,c,d);if(C===0)return 0;C===1&&(p=!0)}}return p}e.check=a})(K_||(K_={}));var Q_;(function(e){var t=_.zero();function r(o,s,u,l,c,d){var f=s.elements,p=s.conformation.position,v=t;o.element.unit=s;for(var h=0,m=f.length;h<m;h++){var g=f[h];if(o.element.element=g,Math.max(0,_.distance(u,p(g,v))-l-d(o))<=c)return!0}return!1}function n(o,s,u,l,c,d){for(var f=s.units,p=0,v=f.length;p<v;p++)if(r(o,f[p],u,l,c,d))return!0;return!1}e.toPoint=n;var i=_.zero();function a(o,s,u,l,c){if(s.elementCount===0||u.elementCount===0)return 0;var d=s.units;o.element.structure=s;for(var f=0,p=d.length;f<p;f++){var v=d[f];o.element.unit=v;for(var h=v.elements,m=v.conformation.position,g=0,y=h.length;g<y;g++){var b=h[g];if(o.element.element=b,n(o,u,m(b,i),c(o),l,c))return!0}}return!1}e.check=a})(Q_||(Q_={}));function KNe(e,t){return function(r){var n=e(r),i=mt.LinearBuilder(r.inputStructure);return r.pushCurrentElement(),mt.forEach(n,function(a,o){r.currentStructure=a,t(r)&&i.add(a),o%100&&r.throwIfTimedOut()}),r.popCurrentStructure(),i.getSelection()}}function QNe(e){return function(t){var r=e(t),n=mt.LinearBuilder(t.inputStructure);if(r.kind==="singletons"){if(r.structure.elementCount>0){var i=r.structure.units[0],a=We.create([i.getChild(Je.ofSingleton(i.elements[0]))],{parent:t.inputStructure});n.add(a)}}else r.structures.length>0&&n.add(r.structures[0]);return n.getSelection()}}function BL(e,t,r){var n=e.currentStructure.units,i=e.pushCurrentElement();i.structure=e.currentStructure;for(var a=0,o=n;a<o.length;a++){var s=o[a];i.unit=s;var u=s.elements,l=void 0;if(je.isAtomic(s)?l=t.atomic:l=t.coarse,!!l){for(var c=0,d=u.length;c<d;c++)i.element=u[c],r.add(l(e));e.throwIfTimedOut()}}return e.popCurrentElement(),r}function ZNe(e,t,r){var n=new Set,i=t(e);return e.pushCurrentElement(),mt.forEach(i,function(a,o){e.currentStructure=a,BL(e,r,n),o%10&&e.throwIfTimedOut()}),e.popCurrentElement(),n}function JNe(e,t,r){return function(n){var i=e(n),a=ZNe(n,t,r),o=mt.LinearBuilder(n.inputStructure);return n.pushCurrentStructure(),mt.forEach(i,function(s,u){n.currentStructure=s;var l=BL(n,r,new Set);hi.isSuperset(l,a)&&o.add(s),u%10&&n.throwIfTimedOut()}),n.popCurrentStructure(),o.getSelection()}}function eBe(e,t){return function(r){var n=mt.unionStructure(t(r)),i=mt.LinearBuilder(r.inputStructure);return mt.forEach(e(r),function(a,o){TE(n,a)&&i.add(a),o%10&&r.throwIfTimedOut()}),i.getSelection()}}function tBe(e){return function(t){var r={queryCtx:t,selection:e.query(t),target:e.target(t),maxRadius:e.maxRadius,minRadius:e.minRadius?Math.max(0,e.minRadius):0,elementRadius:e.elementRadius,invert:!!e.invert};return r.minRadius===0&&typeof e.minRadius>"u"?rBe(r):r.minRadius===0?nBe(r):iBe(r)}}function rBe(e){var t=e.queryCtx,r=e.selection,n=e.target,i=e.maxRadius,a=e.invert,o=mt.unionStructure(n).lookup3d,s=mt.LinearBuilder(t.inputStructure),u=_.zero();return mt.forEach(r,function(l,c){for(var d=l.units,f=!1,p=0,v=d.length;p<v;p++){for(var h=d[p],m=h.elements,g=h.conformation,y=g.position,b=g.r,S=0,x=m.length;S<x;S++){var C=m[S];if(y(C,u),o.check(u[0],u[1],u[2],i+b(C))){f=!0;break}}if(f)break}a&&(f=!f),f&&s.add(l),c%10===0&&t.throwIfTimedOut()}),s.getSelection()}function nBe(e){var t=e.queryCtx,r=e.selection,n=e.target,i=e.maxRadius,a=e.invert,o=e.elementRadius,s=mt.unionStructure(n),u=mt.LinearBuilder(t.inputStructure);return t.pushCurrentElement(),mt.forEach(r,function(l,c){var d=YNe(t,s,l,i,o);a&&(d=!d),d&&u.add(l),c%10===0&&t.throwIfTimedOut()}),t.popCurrentElement(),u.getSelection()}function iBe(e){var t=e.queryCtx,r=e.selection,n=e.target,i=e.minRadius,a=e.maxRadius,o=e.invert,s=e.elementRadius,u=mt.unionStructure(n),l=mt.LinearBuilder(t.inputStructure);return t.pushCurrentElement(),mt.forEach(r,function(c,d){var f=XNe(t,u,c,i,a,s);o&&(f=!f),f&&l.add(c),d%10===0&&t.throwIfTimedOut()}),t.popCurrentElement(),l.getSelection()}function aBe(e,t){var r=e.queryCtx,n=e.input,i=e.target,a=e.disjunct,o=r.atomicBond,s=n.interUnitBonds;o.setStructure(n);for(var u=0,l=t.units;u<l.length;u++){var c=l[u];if(je.isAtomic(c))for(var d=n.unitMap.get(c.id),f=d.bonds,p=f.offset,v=f.b,h=f.edgeProps,m=h.flags,g=h.order,y=s.getConnectedUnits(c.id),b=y.length,S=c.elements,x=d.elements,C=0,w=S.length;C<w;C++){var A=Je.indexOf(x,S[C]);o.a.unit=d,o.b.unit=d;for(var M=p[A],D=p[A+1];M<D;M++)if(o.b.element=d.elements[v[M]],!(a&&Je.has(c.elements,o.b.element))&&i.hasElement(o.b)&&(o.aIndex=A,o.a.element=S[C],o.bIndex=v[M],o.type=m[M],o.order=g[M],o.test(r,!0)))return!0;for(var k=0;k<b;k++)for(var R=y[k],O=n.unitMap.get(R.unitB),H=O.elements,B=R.getEdges(A),j=0,Y=B.length;j<Y;j++){var G=B[j];if(o.b.unit=O,o.b.element=H[G.indexB],!!i.hasElement(o.b)&&!(a&&t.hasElement(o.b))&&(o.a.unit=d,o.aIndex=A,o.a.element=S[C],o.bIndex=G.indexB,o.type=G.props.flag,o.order=G.props.order,o.test(r,!0)))return!0}}}return!1}function oBe(e){var t=e.query,r=e.target,n=e.disjunct,i=e.invert,a=e.bondTest;return function(o){var s=r(o);if(mt.isEmpty(s))return s;var u=t(o);if(mt.isEmpty(u))return u;var l={queryCtx:o,input:o.inputStructure,disjunct:n,target:mt.unionStructure(s)},c=mt.LinearBuilder(o.inputStructure);return o.pushCurrentBond(),o.atomicBond.setTestFn(a),mt.forEach(u,function(d,f){(aBe(l,d)||i)&&c.add(d),f%5===0&&o.throwIfTimedOut()}),o.popCurrentBond(),c.getSelection()}}const sBe=Object.freeze(Object.defineProperty({__proto__:null,areIntersectedBy:eBe,first:QNe,getCurrentStructureProperties:BL,isConnectedTo:oBe,pick:KNe,withSameAtomProperties:JNe,within:tBe},Symbol.toStringTag,{value:"Module"}));function uBe(e){return e.length===0?LL:e.length===1?e[0]:function(t){for(var r=mt.UniqueBuilder(t.inputStructure),n=function(a){mt.forEach(e[a](t),function(o,s){r.add(o),a%100&&t.throwIfTimedOut()})},i=0;i<e.length;i++)n(i);return r.getSelection()}}function lBe(e){return e.length===0?LL:e.length===1?e[0]:function(t){for(var r=[],n=0;n<e.length;n++)r.push(e[n](t));for(var i=0,a=mt.structureCount(r[0]),n=1;n<r.length;n++){var o=mt.structureCount(r[n]);o<a&&(i=n,a=o)}t.throwIfTimedOut();var s=mL(function(c){return c.hashCode},We.areUnitIdsAndIndicesEqual);mt.forEach(r[i],function(c){return s.add(c)});for(var u=mt.UniqueBuilder(t.inputStructure),l=0;l<r.length;l++)l!==i&&(mt.forEach(r[l],function(c){s.has(c)&&u.add(c)}),t.throwIfTimedOut());return u.getSelection()}}const cBe=Object.freeze(Object.defineProperty({__proto__:null,intersect:lBe,merge:uBe},Symbol.toStringTag,{value:"Module"}));var hD;(function(e){function t(f){return!!f&&!!f.has}function r(f,p){return function(v){return f(v)===p}}e.eq=r;function n(f,p){return function(v){return f(v)<p}}e.lt=n;function i(f,p){return function(v){return f(v)<=p}}e.lte=i;function a(f,p){return function(v){return f(v)>p}}e.gt=a;function o(f,p){return function(v){return f(v)>=p}}e.gte=o;function s(f){return!0}function u(f){return!1}function l(f,p){if(t(p))return function(m){return p.has(f(m))};if(p.length===0)return u;for(var v=new Set,h=0;h<p.length;h++)v.add(p[h]);return function(m){return v.has(f(m))}}e.inSet=l;function c(){for(var f=[],p=0;p<arguments.length;p++)f[p]=arguments[p];switch(f.length){case 0:return s;case 1:return f[0];case 2:{var v=f[0],h=f[1];return function($){return v($)&&h($)}}case 3:{var m=f[0],g=f[1],y=f[2];return function($){return m($)&&g($)&&y($)}}case 4:{var b=f[0],S=f[1],x=f[2],C=f[3];return function($){return b($)&&S($)&&x($)&&C($)}}case 5:{var w=f[0],A=f[1],M=f[2],D=f[3],k=f[4];return function($){return w($)&&A($)&&M($)&&D($)&&k($)}}case 6:{var R=f[0],O=f[1],H=f[2],B=f[3],j=f[4],Y=f[5];return function($){return R($)&&O($)&&H($)&&B($)&&j($)&&Y($)}}default:{var G=f.length;return function($){for(var q=0;q<G;q++)if(!f[q])return!1;return!0}}}}e.and=c;function d(){for(var f=[],p=0;p<arguments.length;p++)f[p]=arguments[p];switch(f.length){case 0:return u;case 1:return f[0];case 2:{var v=f[0],h=f[1];return function($){return v($)||h($)}}case 3:{var m=f[0],g=f[1],y=f[2];return function($){return m($)||g($)||y($)}}case 4:{var b=f[0],S=f[1],x=f[2],C=f[3];return function($){return b($)||S($)||x($)||C($)}}case 5:{var w=f[0],A=f[1],M=f[2],D=f[3],k=f[4];return function($){return w($)||A($)||M($)||D($)||k($)}}case 6:{var R=f[0],O=f[1],H=f[2],B=f[3],j=f[4],Y=f[5];return function($){return R($)||O($)||H($)||B($)||j($)||Y($)}}default:{var G=f.length;return function($){for(var q=0;q<G;q++)if(f[q])return!0;return!1}}}}e.or=d})(hD||(hD={}));var nn={generators:X6e,filters:sBe,modifiers:WNe,combinators:cBe,pred:hD,internal:N6e},wl;(function(e){function t(c,d){var f=this;return $e.create("Build Assembly",function(p){return ce(f,void 0,void 0,function(){var v,h,m,g,y,b,S,x,C,w,A,M,D,k,R,O;return de(this,function(H){if(v=c.models,v.length!==1)throw new Error("Can only build assemblies from structures based on 1 model.");if(h=wb.findAssembly(v[0],d),!h)throw new Error("Assembly '"+d+"' is not defined.");for(m=bn.create(h.id,ue.identity(),{assembly:{id:h.id,operId:0,operList:[]}}),g=We.Builder({coordinateSystem:m,label:c.label}),y=new us(c),b=0,S=h.operatorGroups;b<S.length;b++)if(x=S[b],C=x.selector(y),mt.structureCount(C)!==0)for(w=mt.unionStructure(C).units,A=0,M=x.operators;A<M.length;A++)for(D=M[A],k=0,R=w;k<R.length;k++)O=R[k],g.addWithOperator(O,D);return[2,g.getStructure()]})})})}e.buildAssembly=t;function r(c,d,f){var p=this;return $e.create("Build Symmetry Assembly",function(v){return ce(p,void 0,void 0,function(){var h,m,g,y,b,S,x,C,w,A,M,D,k,R,O,H,B,j,Y,G,$,q,ee,fe,W;return de(this,function(X){if(h=c.models,h.length!==1)throw new Error("Can only build symmetry assemblies from structures based on 1 model.");for(m=_(),g=We.Builder({label:c.label,representativeModel:h[0]}),y=new us(c),b=0,S=d;b<S.length;b++)if(x=S[b],C=dBe(x.asymIds),w=C(y),mt.structureCount(w)!==0)for(A=mt.unionStructure(w).units,M=0,D=x.operators;M<D.length;M++)for(k=D[M],R=k.index,O=k.shift,H=O[0],B=O[1],j=O[2],Y=GJ(f,R,H,B,j,m),G=0,$=A;G<$.length;G++)for(q=$[G],ee=0,fe=Y;ee<fe.length;ee++)W=fe[ee],g.addWithOperator(q,W);return[2,g.getStructure()]})})})}e.buildSymmetryAssembly=r;function n(c,d){return $e.create("Find Symmetry Mates",function(f){return vBe(f,c,d)})}e.builderSymmetryMates=n;function i(c,d,f){return $e.create("Build Symmetry",function(p){return hBe(p,c,d,f)})}e.buildSymmetryRange=i;function a(c){return $e.create("Build NCS",function(d){return pBe(d,c)})}e.buildNcs=a;function o(c,d){return c.invariantId===d.invariantId&&c.model.id===d.model.id&&Je.areEqual(c.elements,d.elements)}e.areUnitsEquivalent=o;function s(){return $4e(je.hashUnit,o)}e.UnitEquivalenceBuilder=s;function u(c){for(var d=s(),f=0,p=c.units;f<p.length;f++){var v=p[f];d.add(v.id,v)}for(var h=[],m=0,g=d.groups;m<g.length;m++){var y=g[m];h.push(je.SymmetryGroup(y.map(function(b){return c.unitMap.get(b)})))}return h}e.computeTransformGroups=u;function l(c,d){if(c.length!==d.length)return!1;for(var f=0,p=c.length;f<p;++f){var v=c[f].units,h=d[f].units;if(v.length!==h.length||c[f].hashCode!==d[f].hashCode)return!1;for(var m=0,g=v.length;m<g;m++)if(v[m].conformation!==h[m].conformation)return!1}return!0}e.areTransformGroupsEquivalent=l})(wl||(wl={}));function dBe(e){return nn.generators.atoms({chainTest:nn.pred.and(nn.pred.eq(function(t){return lt.unit.operator_name(t.element)},bn.DefaultName),nn.pred.inSet(function(t){return lt.chain.label_asym_id(t.element)},e))})}function GJ(e,t,r,n,i,a){var o=e.spacegroup,s=e.ncsOperators,u=[],l=o.cell.toFractional,c=_.transformMat4(_(),a,l),d=Vu.getSymmetryOperatorRef(o,t,r,n,i,c);if(s&&s.length)for(var f=0,p=s.length;f<p;++f){var v=s[f],h=ue.mul(ue(),d.matrix,v.matrix),m=bn.create(d.name+" "+v.name,h,{assembly:d.assembly,ncsId:v.ncsId,hkl:d.hkl,spgrOp:d.spgrOp});u.push(m)}else u.push(d);return u}function qJ(e,t,r,n){var i=e.spacegroup,a=e.ncsOperators,o=a&&a.length||0,s=[];!o&&t[0]<=0&&r[0]>=0&&t[1]<=0&&r[1]>=0&&t[2]<=0&&r[2]>=0&&(s[0]=Vu.getSymmetryOperator(i,0,0,0,0));for(var u=i.cell.toFractional,l=_.transformMat4(_(),n,u),c=0;c<i.operators.length;c++)for(var d=t[0];d<=r[0];d++)for(var f=t[1];f<=r[1];f++)for(var p=t[2];p<=r[2];p++)!o&&c===0&&d===0&&f===0&&p===0||s.push.apply(s,GJ(e,c,d,f,p,l));return s}function fBe(e,t){return e._operators_333&&_.equals(t,e._operators_333.ref)||(e._operators_333={ref:_.clone(t),operators:qJ(e,_.create(-3,-3,-3),_.create(3,3,3),t)}),e._operators_333.operators}function $J(e,t){for(var r=We.Builder({label:e.label}),n=e.units,i=0,a=t;i<a.length;i++)for(var o=a[i],s=0,u=n;s<u.length;s++){var l=u[s];r.addWithOperator(l,o)}return r.getStructure()}function pBe(e,t){return ce(this,void 0,void 0,function(){var r,n,i;return de(this,function(a){if(r=t.models,r.length!==1)throw new Error("Can only build NCS from structures based on 1 model.");return n=fi.Provider.get(r[0]),n?(i=n.ncsOperators,!i||!i.length?[2,t]:[2,$J(t,i)]):[2,t]})})}function hBe(e,t,r,n){return ce(this,void 0,void 0,function(){var i,a,o,s,u;return de(this,function(l){if(i=t.models,i.length!==1)throw new Error("Can only build symmetries from structures based on 1 model.");return a=fi.Provider.get(i[0]),a?(o=a.spacegroup,Mo.isZero(o.cell)?[2,t]:(s=$t.getCenter(i[0]),u=qJ(a,r,n,s),[2,$J(t,u)])):[2,t]})})}function vBe(e,t,r){return ce(this,void 0,void 0,function(){function n(D,k){return D.invariantId+"|"+k.name}var i,a,o,s,u,l,c,d,f,p,v,h,m,g,y,b,S,x,C,w,A,M;return de(this,function(D){switch(D.label){case 0:if(i=t.models,i.length!==1)throw new Error("Can only build symmetries from structures based on 1 model.");return a=fi.Provider.get(i[0]),a?(o=a.spacegroup,Mo.isZero(o.cell)?[2,t]:e.shouldUpdate?[4,e.update("Initialing...")]:[3,2]):[2,t];case 1:D.sent(),D.label=2;case 2:s=$t.getCenter(i[0]),u=fBe(a,s),l=t.lookup3d,c=new Set,d=We.Builder({label:t.label}),f=t.units,p=_.zero(),v=0,h=u,D.label=3;case 3:if(!(v<h.length))return[3,6];for(m=h[v],g=0,y=f;g<y.length;g++)for(b=y[g],S=b.lookup3d.boundary.sphere,_.transformMat4(p,S.center,m.matrix),x=l.findUnitIndices(p[0],p[1],p[2],S.radius+r),C=0,w=x.count;C<w;C++)A=f[x.indices[C]],A.lookup3d.check(p[0],p[1],p[2],S.radius+r)&&(M=n(b,m),c.has(M)||(d.addWithOperator(b,m),c.add(M)));return e.shouldUpdate?[4,e.update("Building symmetry...")]:[3,5];case 4:D.sent(),D.label=5;case 5:return v++,[3,3];case 6:return[2,d.getStructure()]}})})}var mBe=function(){function e(t,r){this.parent=t,this.isSorted=r,this.ids=[],this.unitMap=Ws.Mutable(),this.parentId=-1,this.currentUnit=[],this.elementCount=0}return e.prototype.addToUnit=function(t,r){var n=this.unitMap.get(t);n?n[n.length]=r:(this.unitMap.set(t,[r]),this.ids[this.ids.length]=t),this.elementCount++},e.prototype.beginUnit=function(t){this.parentId=t,this.currentUnit=this.currentUnit.length>0?[]:this.currentUnit},e.prototype.addElement=function(t){this.currentUnit[this.currentUnit.length]=t,this.elementCount++},e.prototype.addElementRange=function(t,r,n){for(var i=r;i<n;i++)this.currentUnit[this.currentUnit.length]=t[i],this.elementCount++},e.prototype.commitUnit=function(){this.currentUnit.length!==0&&(this.ids[this.ids.length]=this.parentId,this.unitMap.set(this.parentId,this.currentUnit),this.parentId=-1)},e.prototype.setUnit=function(t,r){this.ids[this.ids.length]=t,this.unitMap.set(t,r),this.elementCount+=r.length},e.prototype._getStructure=function(t){if(this.isEmpty)return We.Empty;var r=[];Tu(this.ids);for(var n=wl.UnitEquivalenceBuilder(),i=0,a=this.ids.length;i<a;i++){var o=this.ids[i],s=this.parent.unitMap.get(o),u=this.unitMap.get(o),l=!1;t&&(this.isSorted||Tu(u),u=Je.deduplicate(Je.ofSortedArray(this.currentUnit)),l=!0);var c=u.length;if(u.length===s.elements.length){r[r.length]=s,n.add(s.id,s);continue}!this.isSorted&&!l&&c>1&&Tu(u);var d=s.getChild(Je.ofSortedArray(u)),f=n.add(d.id,d);d!==f&&(d=f.applyOperator(d.id,d.conformation.operator,!0)),r[r.length]=d}return We.create(r,{parent:this.parent})},e.prototype.getStructure=function(){return this._getStructure(!1)},e.prototype.getStructureDeduplicate=function(){return this._getStructure(!0)},e.prototype.setSingletonLocation=function(t){var r=this.ids[0];t.unit=this.parent.unitMap.get(r),t.element=this.unitMap.get(r)[0]},Object.defineProperty(e.prototype,"isEmpty",{get:function(){return this.elementCount===0},enumerable:!1,configurable:!0}),e}();function sj(e,t){for(var r=1;t--;)r*=e--;return r}function gBe(e,t){return t>e?0:sj(e,t)/sj(t,t)}function yBe(e){var t=e&-e,r=e+t,n=r&-r,i=(n/t>>1)-1;return r|i}var bBe=function(){function e(t,r){this.array=t,this.hasNext=!1,this.index=(1<<r)-1,this.size=gBe(t.length,r),this.maxIndex=1<<t.length,this.value=new Array(r),this.hasNext=r>0&&r<=t.length}return e.prototype.move=function(){if(this.hasNext){for(var t=0,r=0,n=this.index;n;n>>>=1,t++)n&1&&(this.value[r++]=this.array[t]);this.index=yBe(this.index),this.hasNext=this.index<this.maxIndex}return this.value},e}();function WJ(e,t){for(var r=[],n=new bBe(e,t);n.hasNext;)r.push(n.move().slice());return r}var Bp=[],xBe={links:Bp,terminalLinks:Bp,elements:Bp,partialElements:Bp,getElementIndices:function(){return Bp},getLinkIndices:function(){return Bp},getTerminalLinkIndices:function(){return Bp}},Ti=x0("C"),Xy=x0("O"),SBe=[Bs.elementFingerprint([Ti,Ti,Ti,Xy]),Bs.elementFingerprint([Ti,Ti,Ti,Ti,Xy]),Bs.elementFingerprint([Ti,Ti,Ti,Ti,Ti,Xy]),Bs.elementFingerprint([Ti,Ti,Ti,Ti,Ti,Ti,Xy])];function CBe(e,t){for(var r=-1,n=-1,i=-1,a=-1,o=e.elements,s=e.model.atomicHierarchy.atoms,u=s.type_symbol,l=s.label_atom_id,c=e.bonds,d=c.b,f=c.offset,p=0,v=t.length;p<v;++p){var h=o[t[p]];if(u.value(h)===Ti){for(var m=0,g=0,y=f[t[p]],b=f[t[p]+1];y<b;++y){var S=o[d[y]],x=u.value(S);x===Xy?++m:x===Ti&&++g}if(m===2){r=h;break}else m===1&&g===1?n=h:l.value(h).startsWith("C1")?i=h:a=h}}return r!==-1?r:n!==-1?n:i!==-1?i:a!==-1?a:o[t[0]]}function _Be(e,t){var r=e.elements,n=e.model.atomicHierarchy.atoms.label_alt_id;return n.value(r[t])}function wBe(e,t,r,n){var i=t.conformation.position;return _.normalize(e,_.sub(e,n,i(r,e))),e}function uj(e,t){var r=e.elements,n=e.model.atomicHierarchy.atoms.label_atom_id;return n.value(r[t])}function EBe(e,t){if(!(!t||!t.length)){for(var r=e.unit,n=e.all,i=new Set,a=WJ(Ys(new Array(t.length)),2),o=0,s=a.length;o<s;++o){var u=a[o],l=n[t[u[0]]],c=n[t[u[1]]];Je.areIntersecting(l,c)&&Bs.getAltId(r,l)===Bs.getAltId(r,c)&&(i.add(t[u[0]]),i.add(t[u[1]]))}if(i.size){for(var d=[],o=0,s=t.length;o<s;++o)i.has(t[o])||d.push(t[o]);return d}else return t}}function ABe(e,t){return t.properties.saccharideComponentMap.get(e)}function PBe(e){if(e.models.reduce(function(be,Ae){return be+Ae.properties.saccharideComponentMap.size},0)===0)return xBe;var t=[],r=[],n=[],i=[],a=new Map;function o(be,Ae,Se){return be+"|"+Ae+"|"+Se}function s(be,Ae){a.has(be)?a.get(be).push(Ae):a.set(be,[Ae])}function u(be,Ae){_.sub(n[be].geometry.direction,n[Ae].geometry.center,n[be].geometry.center),_.normalize(n[be].geometry.direction,n[be].geometry.direction)}var l=_.zero();function c(be,Ae,Se){var ie=Se.conformation.position,oe=n[be].geometry;_.sub(oe.direction,ie(Se.elements[Ae],l),oe.center),_.normalize(oe.direction,oe.direction)}for(var d=0,f=e.units.length;d<f;++d){var p=e.units[d];if(je.isAtomic(p))for(var v=p.model,h=p.rings,m=v.atomicHierarchy,g=m.chainAtomSegments,y=m.residueAtomSegments,b=m.atoms,S=b.label_comp_id,x=nr.transientSegments(g,p.elements),C=nr.transientSegments(y,p.elements),w=void 0;x.hasNext;)for(C.setSegment(x.move());C.hasNext;){var A=C.move().index,M=ABe(S.value(y.offsets[A]),v);if(M){w||(w=W_.byFingerprintAndResidue(h,SBe));var D=EBe(h,w.get(A));if(!D||!D.length){i.push({unit:p,residueIndex:A,component:M});continue}for(var k=[],R=0,O=D.length;R<O;++R){var H=h.all[D[R]],B=CBe(p,H),j=hv.calculateMomentsAxes(lJ(p,H)),Y=_.copy(_.zero(),j.origin),G=_.copy(_.zero(),j.dirC),$=wBe(_.zero(),p,B,Y);_.orthogonalize($,G,$);var q=Bs.getAltId(p,H),ee=n.length;k.push(ee),s(o(A,p.id,q),ee),q&&s(o(A,p.id,""),ee),n.push({geometry:{center:Y,normal:G,direction:$},component:M,ringIndex:D[R],altId:q,unit:p,residueIndex:A})}for(var fe=WJ(Ys(new Array(D.length)),2),R=0,O=fe.length;R<O;++R){var W=fe[R],X=h.all[D[W[0]]],U=h.all[D[W[1]]];if(Io.areVertexSetsConnected(p.bonds,X,U,3)){var z=k[W[0]],J=k[W[1]];n[z].altId===n[J].altId&&(u(z,J),u(J,z),t.push({carbohydrateIndexA:z,carbohydrateIndexB:J}),t.push({carbohydrateIndexA:J,carbohydrateIndexB:z}))}}}}}function K(be,Ae){return a.get(o(be.getResidueIndex(Ae),be.id,_Be(be,Ae)))||[]}for(var d=0,f=n.length;d<f;++d)for(var Z=n[d],p=Z.unit,R=d+1;R<f;++R){var te=n[R];if(!(p!==te.unit||Z.residueIndex===te.residueIndex)){var le=p.rings.all[Z.ringIndex],ye=p.rings.all[te.ringIndex];Io.areVertexSetsConnected(p.bonds,le,ye,3)&&(u(d,R),u(R,d),t.push({carbohydrateIndexA:d,carbohydrateIndexB:R}),t.push({carbohydrateIndexA:R,carbohydrateIndexB:d}))}}for(var d=0,f=e.units.length;d<f;++d){var p=e.units[d];je.isAtomic(p)&&e.interUnitBonds.getConnectedUnits(p.id).forEach(function(ie){ie.connectedIndices.forEach(function(oe){ie.getEdges(oe).forEach(function(L){var V=L.props,he=L.indexB;if(Ur.isCovalent(V.flag)){var we=e.unitMap.get(ie.unitA),Te=e.unitMap.get(ie.unitB),ze=K(we,oe),Ve=K(Te,he);if(ze.length>0&&Ve.length>0)for(var Xe=ze.length,ct=Ve.length,Ne=0,Qe=Math.max(Xe,ct);Ne<Qe;++Ne){var it=ze[Math.min(Ne,Xe-1)],ot=Ve[Math.min(Ne,ct-1)],dt=uj(we,oe);(dt.startsWith("O1")||dt.startsWith("C1"))&&u(it,ot),t.push({carbohydrateIndexA:it,carbohydrateIndexB:ot})}else if(Ve.length===0)for(var ke=0,Me=ze;ke<Me.length;ke++){var it=Me[ke],dt=uj(we,oe);(dt.startsWith("O1")||dt.startsWith("C1"))&&c(it,he,Te),r.push({carbohydrateIndex:it,elementIndex:he,elementUnit:Te,fromCarbohydrate:!0})}else if(ze.length===0)for(var Ye=0,tt=Ve;Ye<tt.length;Ye++){var ot=tt[Ye];r.push({carbohydrateIndex:ot,elementIndex:oe,elementUnit:we,fromCarbohydrate:!1})}}})})})}return E({links:t,terminalLinks:r,elements:n,partialElements:i},TBe(n,t,r))}function TBe(e,t,r){function n(O,H){return Qf(O.id,H)}function i(O,H,B){var j=[],Y=O.get(n(H,B));if(Y!==void 0)for(var G=0,$=Y;G<$.length;G++){var q=$[G];Fa(j,q)}return j}for(var a=new Map,o=0,s=e.length;o<s;++o)for(var u=e[o],l=u.unit,c=u.ringIndex,d=l.rings.all[c],f=0,p=d.length;f<p;++f){var v=n(l,l.elements[d[f]]),h=a.get(v);h===void 0?a.set(v,[o]):h.push(o)}function m(O,H){return i(a,O,H)}for(var g=new Map,o=0,s=t.length;o<s;++o)for(var y=t[o],b=e[y.carbohydrateIndexA],l=b.unit,c=b.ringIndex,d=l.rings.all[c],f=0,p=d.length;f<p;++f){var v=n(l,l.elements[d[f]]),h=g.get(v);h===void 0?g.set(v,[o]):h.push(o)}function S(O,H){return i(g,O,H)}for(var x=new Map,o=0,s=r.length;o<s;++o){var C=r[o],w=C.fromCarbohydrate,A=C.carbohydrateIndex,M=C.elementUnit,D=C.elementIndex;if(w)for(var k=e[A],l=k.unit,c=k.ringIndex,d=l.rings.all[c],f=0,p=d.length;f<p;++f){var v=n(l,l.elements[d[f]]),h=x.get(v);h===void 0?x.set(v,[o]):h.push(o)}else{var v=n(M,M.elements[D]),h=x.get(v);h===void 0?x.set(v,[o]):h.push(o)}}function R(O,H){return i(x,O,H)}return{getElementIndices:m,getLinkIndices:S,getTerminalLinkIndices:R}}var Tx=Be(),IBe=new ps("14"),MBe=new ps("98");function DBe(e){return e>500?IBe:MBe}function RBe(e){var t=e.units,r=DBe(t.length);r.reset();for(var n=0,i=t.length;n<i;n++){var a=t[n],o=a.boundary,s=a.conformation.operator;s.isIdentity?r.includeSphere(o.sphere):(Be.transform(Tx,o.sphere,s.matrix),r.includeSphere(Tx))}r.finishedIncludeStep();for(var n=0,i=t.length;n<i;n++){var a=t[n],o=a.boundary,s=a.conformation.operator;s.isIdentity?r.radiusSphere(o.sphere):(Be.transform(Tx,o.sphere,s.matrix),r.radiusSphere(Tx))}return{box:r.getBox(),sphere:r.getSphere()}}var We=function(){function e(t,r,n,i,a){this.units=t,this.unitMap=r,this.unitIndexMap=n,this.state=i,this._child=a==null?void 0:a.child,this._target=a==null?void 0:a.target}return e.prototype.subsetBuilder=function(t){return new mBe(this,t)},Object.defineProperty(e.prototype,"elementCount",{get:function(){return this.state.elementCount},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"bondCount",{get:function(){return this.state.bondCount===-1&&(this.state.bondCount=this.interUnitBonds.edgeCount+Vt.getIntraUnitBondCount(this)),this.state.bondCount},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasCustomProperties",{get:function(){return!!this.state.customProps&&this.state.customProps.all.length>0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"customPropertyDescriptors",{get:function(){return this.state.customProps||(this.state.customProps=new Hl),this.state.customProps},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"currentPropertyData",{get:function(){return this.state.propertyData||(this.state.propertyData=Object.create(null)),this.state.propertyData},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"inheritedPropertyData",{get:function(){return this.parent?this.parent.currentPropertyData:this.currentPropertyData},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"polymerResidueCount",{get:function(){return this.state.polymerResidueCount===-1&&(this.state.polymerResidueCount=jBe(this)),this.state.polymerResidueCount},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"polymerGapCount",{get:function(){return this.state.polymerGapCount===-1&&(this.state.polymerGapCount=zBe(this)),this.state.polymerGapCount},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"polymerUnitCount",{get:function(){return this.state.polymerUnitCount===-1&&(this.state.polymerUnitCount=VBe(this)),this.state.polymerUnitCount},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"uniqueElementCount",{get:function(){return this.state.uniqueElementCount===-1&&(this.state.uniqueElementCount=UBe(this)),this.state.uniqueElementCount},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"atomicResidueCount",{get:function(){return this.state.atomicResidueCount===-1&&(this.state.atomicResidueCount=HBe(this)),this.state.atomicResidueCount},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isCoarseGrained",{get:function(){return this.models.some(function(t){return $t.isCoarseGrained(t)})},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isEmpty",{get:function(){return this.units.length===0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hashCode",{get:function(){return this.state.hashCode!==-1?this.state.hashCode:this.computeHash()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"transformHash",{get:function(){return this.state.transformHash!==-1?this.state.transformHash:(this.state.transformHash=Ga(this.units.map(function(t){return t.id})),this.state.transformHash)},enumerable:!1,configurable:!0}),e.prototype.computeHash=function(){for(var t=23,r=0,n=this.units.length;r<n;r++){var i=this.units[r];t=31*t+i.id|0,t=31*t+Je.hashCode(i.elements)|0}return t=31*t+this.elementCount|0,t=qQ(t),t===-1&&(t=0),this.state.hashCode=t,t},e.prototype.elementLocations=function(){return new e.ElementLocationIterator(this)},Object.defineProperty(e.prototype,"root",{get:function(){return this.state.parent||this},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){return this.state.parent},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"coordinateSystem",{get:function(){return this.state.coordinateSystem},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"label",{get:function(){return this.state.label},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"boundary",{get:function(){return this.state.boundary?this.state.boundary:(this.state.boundary=RBe(this),this.state.boundary)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"lookup3d",{get:function(){return this.state.lookup3d?this.state.lookup3d:(this.state.lookup3d=new M6e(this),this.state.lookup3d)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"interUnitBonds",{get:function(){return this.state.interUnitBonds?this.state.interUnitBonds:(this.state.interUnitBonds=ZFe(this),this.state.interUnitBonds)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"unitSymmetryGroups",{get:function(){return this.state.unitSymmetryGroups?this.state.unitSymmetryGroups:(this.state.unitSymmetryGroups=wl.computeTransformGroups(this),this.state.unitSymmetryGroups)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"unitSymmetryGroupsIndexMap",{get:function(){return this.state.unitSymmetryGroupsIndexMap?this.state.unitSymmetryGroupsIndexMap:(this.state.unitSymmetryGroupsIndexMap=je.SymmetryGroup.getUnitSymmetryGroupsIndexMap(this.unitSymmetryGroups),this.state.unitSymmetryGroupsIndexMap)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"carbohydrates",{get:function(){return this.state.carbohydrates?this.state.carbohydrates:(this.state.carbohydrates=PBe(this),this.state.carbohydrates)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"models",{get:function(){return this.state.models?this.state.models:(this.state.models=OBe(this),this.state.models)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"uniqueResidueNames",{get:function(){return this.state.uniqueResidueNames||(this.state.uniqueResidueNames=LBe(this))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"uniqueElementSymbols",{get:function(){return this.state.uniqueElementSymbols||(this.state.uniqueElementSymbols=FBe(this))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"entityIndices",{get:function(){return this.state.entityIndices||(this.state.entityIndices=NBe(this))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"uniqueAtomicResidueIndices",{get:function(){return this.state.uniqueAtomicResidueIndices||(this.state.uniqueAtomicResidueIndices=BBe(this))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isAtomic",{get:function(){for(var t=0,r=this.units;t<r.length;t++){var n=r[t];if(!je.isAtomic(n))return!1}return!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasAtomic",{get:function(){for(var t=0,r=this.units;t<r.length;t++){var n=r[t];if(je.isAtomic(n))return!0}return!1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isCoarse",{get:function(){for(var t=0,r=this.units;t<r.length;t++){var n=r[t];if(!je.isCoarse(n))return!1}return!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasCoarse",{get:function(){for(var t=0,r=this.units;t<r.length;t++){var n=r[t];if(je.isCoarse(n))return!0}return!1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"serialMapping",{get:function(){return this.state.serialMapping||(this.state.serialMapping=GBe(this))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"model",{get:function(){if(this.state.model)return this.state.model;if(this.state.representativeModel)return this.state.representativeModel;if(this.state.masterModel)return this.state.masterModel;var t=this.models;if(t.length>1)throw new Error("The structure is based on multiple models and has neither a master- nor a representative-model.");return this.state.model=t[0],this.state.model},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"masterModel",{get:function(){return this.state.masterModel},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"representativeModel",{get:function(){return this.state.representativeModel},enumerable:!1,configurable:!0}),e.prototype.hasElement=function(t){return this.unitMap.has(t.unit.id)?Je.has(this.unitMap.get(t.unit.id).elements,t.element):!1},e.prototype.getModelIndex=function(t){return this.models.indexOf(t)},e.prototype.remapModel=function(t){for(var r=[],n=0,i=this.unitSymmetryGroups;n<i.length;n++){var a=i[n],o=a.units[0].remapModel(t);r.push(o);for(var s=1,u=a.units.length;s<u;++s){var l=a.units[s];r.push(l.remapModel(t,o.props))}}return e.create(r,{label:this.label,interUnitBonds:this.state.interUnitBonds})},e.prototype.asParent=function(){return this._proxy?this._proxy:(this._proxy=this.parent?new e(this.parent.units,this.parent.unitMap,this.parent.unitIndexMap,this.parent.state,{child:this,target:this.parent}):this,this._proxy)},Object.defineProperty(e.prototype,"child",{get:function(){return this._child},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"target",{get:function(){var t;return(t=this._target)!==null&&t!==void 0?t:this},enumerable:!1,configurable:!0}),e}();function kBe(e,t,r){return e[t].id-e[r].id}function OBe(e){for(var t=e.units,r=tn.create(),n=0,i=t;n<i.length;n++){var a=i[n];tn.add(r,a.model.id,a.model)}return r.array}function LBe(e){for(var t=lt.residue.microheterogeneityCompIds,r=new Set,n=Ze.create(e),i=0,a=e.unitSymmetryGroups;i<a.length;i++){var o=a[i],s=o.units[0];if(je.isAtomic(s)){var u=nr.transientSegments(s.model.atomicHierarchy.residueAtomSegments,s.elements);for(n.unit=s;u.hasNext;){var l=u.move();n.element=s.elements[l.start];for(var c=t(n),d=0,f=c;d<f.length;d++){var p=f[d];r.add(p)}}}}return r}function FBe(e){for(var t=lt.atom.type_symbol,r=new Set,n=Ze.create(e),i=0,a=e.unitSymmetryGroups;i<a.length;i++){var o=a[i],s=o.units[0];if(je.isAtomic(s)){n.unit=s;for(var u=0,l=s.elements.length;u<l;++u)n.element=s.elements[u],r.add(t(n))}}return r}function NBe(e){for(var t=e.units,r=Ze.create(e),n=tn.create(),i=0,a=t;i<a.length;i++){var o=a[i],s=o.kind===0?lt.entity.key:lt.coarse.entityKey;r.unit=o;for(var u=o.elements,l=nr.transientSegments(o.model.atomicHierarchy.chainAtomSegments,u);l.hasNext;){var c=l.move();r.element=u[c.start];var d=s(r);tn.add(n,d,d)}}return Tu(n.array),n.array}function BBe(e){for(var t=new Map,r=[],n=e.unitSymmetryGroups,i=0,a=n;i<a.length;i++){var o=a[i],s=o.units[0];if(je.isAtomic(s)){var u=void 0;t.has(s.model.id)?u=t.get(s.model.id):(u=tn.create(),r.push(s.model.id),t.set(s.model.id,u));for(var l=nr.transientSegments(s.model.atomicHierarchy.residueAtomSegments,s.elements);l.hasNext;){var c=l.move();tn.add(u,c.index,c.index)}}}for(var d=new Map,f=0,p=r;f<p.length;f++){var v=p[f],h=t.get(v).array;Tu(h),d.set(v,h)}return d}function UBe(e){for(var t=e.unitSymmetryGroups,r=0,n=0,i=t.length;n<i;n++)r+=t[n].elements.length;return r}function jBe(e){for(var t=e.units,r=0,n=0,i=t.length;n<i;n++)r+=t[n].polymerElements.length;return r}function zBe(e){for(var t=e.units,r=0,n=0,i=t.length;n<i;n++)r+=t[n].gapElements.length/2;return r}function VBe(e){for(var t=e.units,r=0,n=0,i=t.length;n<i;n++)t[n].polymerElements.length>0&&(r+=1);return r}function HBe(e){for(var t=e.units,r=0,n=0,i=t.length;n<i;n++){var a=t[n];if(je.isAtomic(a))for(var o=a.elements,s=a.residueIndex,u=-1,l=-1,c=0,d=o.length;c<d;++c)u=s[o[c]],u!==l&&(r+=1,l=u)}return r}function GBe(e){for(var t=e.units,r=e.elementCount,n=e.unitIndexMap,i=new Uint32Array(t.length),a=new Uint32Array(r),o=new Uint32Array(r),s=0,u=0,l=t.length;s<l;++s){i[s]=u;for(var c=t[s].elements,d=0,f=c.length;d<f;++d){var p=u+d;a[p]=s,o[p]=c[d]}u+=c.length}return{cumulativeUnitElementCount:i,unitIndices:a,elementIndices:o,getSerialIndex:function(v,h){return i[n.get(v.id)]+Le.indexOf(v.elements,h)}}}(function(e){e.Empty=u([]);function t(U){return{kind:"structure-loci",structure:U}}e.Loci=t;function r(U){for(var z=[],J=0,K=U.units;J<K.length;J++){var Z=K[J];z.push({unit:Z,indices:Ie.ofBounds(0,Z.elements.length)})}return Re(U,z)}e.toStructureElementLoci=r;function n(U,z){return mt.toLociWithSourceUnits(mt.Singletons(U,z))}e.toSubStructureElementLoci=n;function i(U){return!!U&&U.kind==="structure-loci"}e.isLoci=i;function a(U,z){return U.structure===z.structure}e.areLociEqual=a;function o(U){return U.structure.isEmpty}e.isLociEmpty=o;function s(U,z){return z===U.structure?U:t(z)}e.remapLoci=s;function u(U,z){z===void 0&&(z={});for(var J=Ws.Mutable(),K=Ws.Mutable(),Z=0,te=!0,le=U.length>0?U[0].id:0,ye=0,be=U.length;ye<be;ye++){var Ae=U[ye];J.set(Ae.id,Ae),Z+=Ae.elements.length,Ae.id<le&&(te=!1),le=Ae.id}te||GQ(U,0,U.length,kBe,_h);for(var ye=0,be=U.length;ye<be;ye++)K.set(U[ye].id,ye);var Se={hashCode:-1,transformHash:-1,elementCount:Z,bondCount:-1,uniqueElementCount:-1,atomicResidueCount:-1,polymerResidueCount:-1,polymerGapCount:-1,polymerUnitCount:-1,coordinateSystem:bn.Default,label:""};return z.parent&&(Se.parent=z.parent.parent||z.parent),z.interUnitBonds&&(Se.interUnitBonds=z.interUnitBonds),z.coordinateSystem?Se.coordinateSystem=z.coordinateSystem:z.parent&&(Se.coordinateSystem=z.parent.coordinateSystem),z.label?Se.label=z.label:z.parent&&(Se.label=z.parent.label),z.masterModel?Se.masterModel=z.masterModel:z.parent&&(Se.masterModel=z.parent.masterModel),z.representativeModel?Se.representativeModel=z.representativeModel:z.parent&&(Se.representativeModel=z.parent.representativeModel),new e(U,J,K,Se)}e.create=u;function l(U,z){return ce(this,void 0,void 0,function(){var J,K,Z,te,le,ye,be,Ae,Se,ie,oe,L,V;return de(this,function(he){switch(he.label){case 0:if(U.frameCount===0)return[2,e.Empty];J=[],K=void 0,Z=0,te=0,le=U.frameCount,he.label=1;case 1:return te<le?[4,$e.resolveInContext(U.getFrameAtIndex(te),z)]:[3,4];case 2:for(ye=he.sent(),K||(K=ye),be=c(ye),Ae=0,Se=be.units.length;Ae<Se;++Ae)ie=be.units[Ae],oe=ie.invariantId+Z,L=ie.chainGroupId+Z,V=je.create(J.length,oe,L,ie.traits,ie.kind,ie.model,ie.conformation.operator,ie.elements),J.push(V);Z=J.length,he.label=3;case 3:return++te,[3,1];case 4:return[2,u(J,{representativeModel:K,label:K.label})]}})})}e.ofTrajectory=l;function c(U){for(var z=U.atomicHierarchy.chainAtomSegments,J=U.atomicHierarchy.index,K=U.atomicHierarchy.chains.auth_asym_id,Z=U.atomicChainOperatorMappinng,te=new v({label:U.label}),le=0;le<z.count;le++){var ye=Z.get(le)||bn.Default,be=z.offsets[le];dv.chainResidueCount(U.atomicHierarchy,le),z.offsets[le+1]-z.offsets[le];var Ae=!1;if(d(U,le))for(;le+1<z.count&&d(U,le+1);){var Se=Z.get(le),ie=Z.get(le+1);if(Se!==ie)break;Ae=!0,le++}else for(;le+1<z.count&&z.offsets[le+1]-z.offsets[le]===1&&z.offsets[le+2]-z.offsets[le+1]===1;){var oe=J.getEntityFromChain(le),L=J.getEntityFromChain(le+1);if(oe!==L)break;var V=K.value(le),he=K.value(le+1);if(V!==he)break;var Se=Z.get(le),ie=Z.get(le+1);if(Se!==ie)break;Ae=!0,le++}var we=Je.ofBounds(be,z.offsets[le+1]);te.addUnit(0,U,ye,we,Ae?1:0)}var Te=U.coarseHierarchy;return Te.isDefined&&(Te.spheres.count>0&&f(te,U,U.coarseHierarchy.spheres,1),Te.gaussians.count>0&&f(te,U,U.coarseHierarchy.gaussians,2)),te.getStructure()}e.ofModel=c;function d(U,z){var J=U.atomicHierarchy.index.getEntityFromChain(z);return U.entities.data.type.value(J)==="water"}function f(U,z,J,K){for(var Z=J.chainElementSegments,te=0;te<Z.count;te++){var le=Je.ofBounds(Z.offsets[te],Z.offsets[te+1]);U.addUnit(K,z,bn.Default,le,0)}}function p(U,z){if(ue.isIdentity(z))return U;if(!ue.isRotationAndTranslation(z,bn.RotationTranslationEpsilon))throw new Error("Only rotation/translation combination can be applied.");for(var J=[],K=0,Z=U.units;K<Z.length;K++){var te=Z[K],le=te.conformation.operator,ye=bn.create(le.name,z,le);J.push(te.applyOperator(te.id,ye))}var be=U.coordinateSystem,Ae=bn.compose(bn.create(be.name,z,be),be);return u(J,{parent:U,coordinateSystem:Ae})}e.transform=p;var v=function(){function U(z){z===void 0&&(z={}),this.props=z,this.units=[],this.invariantId=$a(),this.chainGroupId=-1,this.inChainGroup=!1,this.p=_(),this.singleElementUnits=new Map}return U.prototype.beginChainGroup=function(){this.chainGroupId++,this.inChainGroup=!0},U.prototype.endChainGroup=function(){this.inChainGroup=!1},U.prototype.addUnit=function(z,J,K,Z,te,le){le===void 0&&(le=this.invariantId());var ye=this.inChainGroup?this.chainGroupId:++this.chainGroupId,be=je.create(this.units.length,le,ye,te,z,J,K,Z);return this.add(be)},U.prototype.add=function(z){if(z.elements.length===1){z.conformation.position(z.elements[0],this.p);var J=[z.invariantId,this.p[0],this.p[1],this.p[2]].join("|");if(this.singleElementUnits.has(J))return this.singleElementUnits.get(J);this.singleElementUnits.set(J,z)}return this.units.push(z),z},U.prototype.addWithOperator=function(z,J,K){return K===void 0&&(K=!1),this.add(z.applyOperator(this.units.length,J,K))},U.prototype.getStructure=function(){return u(this.units,this.props)},Object.defineProperty(U.prototype,"isEmpty",{get:function(){return this.units.length===0},enumerable:!1,configurable:!0}),U}();e.StructureBuilder=v;function h(U){return U===void 0&&(U={}),new v(U)}e.Builder=h;function m(U){return U.hashCode}e.hashCode=m;function g(U){return YO(U.units.map(function(z){return je.conformationId(z)}).join("|"))}e.conformationHash=g;function y(U,z){if(U===z)return!0;if(U.elementCount!==z.elementCount)return!1;var J=U.units.length;if(J!==z.units.length)return!1;for(var K=0;K<J;K++)if(U.units[K].id!==z.units[K].id)return!1;return!0}e.areUnitIdsEqual=y;function b(U,z){if(!y(U,z))return!1;for(var J=0,K=U.units.length;J<K;J++)if(!Je.areEqual(U.units[J].elements,z.units[J].elements))return!1;return!0}e.areUnitIdsAndIndicesEqual=b;function S(U,z){if(U.hashCode!==z.hashCode)return!1;var J=U.models.length;if(J!==z.models.length)return!1;for(var K=0;K<J;K++)if(!$t.areHierarchiesEqual(U.models[K],z.models[K]))return!1;return!0}e.areHierarchiesEqual=S;function x(U,z){return U===z||U.hashCode===z.hashCode&&wl.areTransformGroupsEquivalent(U.unitSymmetryGroups,z.unitSymmetryGroups)}e.areEquivalent=x;function C(U,z){return x(U.root,z.root)}e.areRootsEquivalent=C;function w(U,z){return U.root===z.root}e.areRootsEqual=w;var A=function(){function U(z){this.structure=z,this.unitIndex=0,this.maxIdx=0,this.idx=-1,this.current=Ze.create(z),this.hasNext=z.elementCount>0,this.hasNext&&(this.elements=z.units[0].elements,this.maxIdx=this.elements.length-1,this.current.unit=z.units[0])}return U.prototype.move=function(){return this.advance(),this.current.element=this.elements[this.idx],this.current},U.prototype.advance=function(){if(this.idx<this.maxIdx){this.idx++,this.idx===this.maxIdx&&(this.hasNext=this.unitIndex+1<this.structure.units.length);return}if(this.idx=0,this.unitIndex++,this.unitIndex>=this.structure.units.length){this.hasNext=!1;return}this.current.unit=this.structure.units[this.unitIndex],this.elements=this.current.unit.elements,this.maxIdx=this.elements.length-1,this.maxIdx===0&&(this.hasNext=this.unitIndex+1<this.structure.units.length)},U}();e.ElementLocationIterator=A;var M=_();function D(U,z,J){for(var K=U.elements,Z=U.conformation,te=Z.position,le=Z.r,ye=M,be=Number.MAX_VALUE,Ae=0,Se=K.length;Ae<Se;Ae++){var ie=K[Ae],oe=_.distance(z,te(ie,ye))-J-le(ie);oe<be&&(be=oe)}return be}function k(U,z,J){for(var K=U.units,Z=Number.MAX_VALUE,te=0,le=K.length;te<le;te++){var ye=K[te],be=D(ye,z,J);be<Z&&(Z=be)}return Z}e.minDistanceToPoint=k;var R=_();function O(U,z){if(U.elementCount===0||z.elementCount===0)return 0;for(var J=U.units,K=Number.MAX_VALUE,Z=0,te=J.length;Z<te;Z++)for(var le=J[Z],ye=le.elements,be=le.conformation,Ae=be.position,Se=be.r,ie=0,oe=ye.length;ie<oe;ie++){var L=ye[ie],V=k(z,Ae(L,R),Se(L));V<K&&(K=V)}return K}e.distance=O;function H(U){return U.elementCount===1?"1 element":U.elementCount+" elements"}e.elementDescription=H;function B(U,z,J){return U.masterModel?z.model===J.model||z.model===U.masterModel||J.model===U.masterModel:z.model===J.model}e.validUnitPair=B;function j(U,z,J){var K=J.maxRadius,Z=J.validUnit,te=J.validUnitPair;if(U.units.some(function(he){return Z(he)}))for(var le=U.lookup3d,ye=_(),be=0,Ae=U.units;be<Ae.length;be++){var Se=Ae[be];if(Z(Se)){var ie=Se.boundary.sphere;_.transformMat4(ye,ie.center,Se.conformation.operator.matrix);for(var oe=le.findUnitIndices(ye[0],ye[1],ye[2],ie.radius+K),L=0;L<oe.count;L++){var V=U.units[oe.indices[L]];!Z(V)||Se.id>=V.id||!te(Se,V)||(V.elements.length>=Se.elements.length?z(Se,V):z(V,Se))}}}}e.eachUnitPair=j;function Y(U,z){for(var J=z.chain,K=z.residue,Z=z.atom,te=Ze.create(U),le=0,ye=U.units;le<ye.length;le++){var be=ye[le];if(be.kind===0){te.unit=be;for(var Ae=be.elements,Se=nr.transientSegments(be.model.atomicHierarchy.chainAtomSegments,Ae),ie=nr.transientSegments(be.model.atomicHierarchy.residueAtomSegments,Ae);Se.hasNext;){var oe=Se.move();if(J&&(te.element=Ae[oe.start],J(te)),!(!K&&!Z))for(ie.setSegment(oe);ie.hasNext;){var L=ie.move();if(K&&(te.element=Ae[L.start],K(te)),!!Z)for(var V=L.start,he=L.end;V<he;V++)te.element=Ae[V],Z(te)}}}}}e.eachAtomicHierarchyElement=Y,e.DefaultSizeThresholds={smallResidueCount:10,mediumResidueCount:5e3,largeResidueCount:3e4,highSymmetryUnitCount:10,fiberResidueCount:15};function G(U){return U.unitSymmetryGroups.filter(function(z){return z.units[0].polymerElements.length>0})}function $(U,z){var J=G(U);return J.length===1&&J[0].units.length>2&&J[0].units[0].polymerElements.length<z.fiberResidueCount}function q(U,z){var J=G(U);return J.length>=1&&J[0].units.length>z.highSymmetryUnitCount}var ee;(function(U){U[U.Small=0]="Small",U[U.Medium=1]="Medium",U[U.Large=2]="Large",U[U.Huge=3]="Huge",U[U.Gigantic=4]="Gigantic"})(ee=e.Size||(e.Size={}));function fe(U,z,J){z===void 0&&(z={}),J===void 0&&(J=1);var K=E(E({},e.DefaultSizeThresholds),z);return U.polymerResidueCount>=K.largeResidueCount*J?q(U,K)?ee.Huge:ee.Gigantic:$(U,K)||U.polymerResidueCount<K.smallResidueCount*J?ee.Small:U.polymerResidueCount<K.mediumResidueCount*J?ee.Medium:ee.Large}e.getSize=fe,e.Index=hp.createSimple("index","root");var W="__PrincipalAxes__";function X(U){if(U.currentPropertyData[W])return U.currentPropertyData[W];var z=Re.getPrincipalAxes(e.toStructureElementLoci(U));return U.currentPropertyData[W]=z,z}e.getPrincipalAxes=X})(We||(We={}));var qBe=Le.size;function Re(e,t){return{kind:"element-loci",structure:e,elements:t}}(function(e){function t(z){return!!z&&z.kind==="element-loci"}e.is=t;function r(z,J){if(z.structure!==J.structure||z.elements.length!==J.elements.length)return!1;for(var K=0,Z=z.elements.length;K<Z;++K){var te=z.elements[K],le=J.elements[K];if(te.unit.id!==le.unit.id||!Le.areEqual(te.indices,le.indices))return!1}return!0}e.areEqual=r;function n(z){return a(z)===0}e.isEmpty=n;function i(z){return a(z)===z.structure.elementCount}e.isWholeStructure=i;function a(z){for(var J=0,K=0,Z=z.elements;K<Z.length;K++){var te=Z[K];J+=qBe(te.indices)}return J}e.size=a;function o(z){return e(z,z.units.map(function(J){return{unit:J,indices:Le.ofBounds(0,J.elements.length)}}))}e.all=o;function s(z){return e(z,[])}e.none=s;function u(z,J){if(!n(z)){var K=z.elements[0].unit,Z=K.elements[Le.getAt(z.elements[0].indices,0)];return J?(J.structure=z.structure,J.unit=z.elements[0].unit,J.element=Z,J):Ze.create(z.structure,K,Z)}}e.getFirstLocation=u;function l(z){return n(z)?z:e(z.structure,[{unit:z.elements[0].unit,indices:Le.ofSingleton(Le.start(z.elements[0].indices))}])}e.firstElement=l;function c(z){return n(z)?z:b(l(z))}e.firstResidue=c;function d(z){return n(z)?z:M(l(z))}e.firstChain=d;function f(z){for(var J=[],K=function(ye){var be=ye.unit,Ae=ye.indices,Se=new Int32Array(Le.size(Ae));Le.forEach(Ae,function(ie,oe){return Se[oe]=be.elements[ie]}),J.push(be.getChild(Je.ofSortedArray(Se)))},Z=0,te=z.elements;Z<te.length;Z++){var le=te[Z];K(le)}return We.create(J,{parent:z.structure.parent})}e.toStructure=f;function p(z,J){if(J===z.structure)return z;var K=[];return z.elements.forEach(function(Z){if(J.unitMap.has(Z.unit.id)){var te=J.unitMap.get(Z.unit.id),le=Le.indexedIntersect(Z.indices,Z.unit.elements,te.elements);Le.size(le)>0&&K.push({unit:te,indices:le})}}),e(J,K)}e.remap=p;function v(z,J){if(z.elements.length>J.elements.length)return v(J,z);if(e.isEmpty(z))return J;for(var K=new Map,Z=0,te=z.elements;Z<te.length;Z++){var le=te[Z];K.set(le.unit.id,le.indices)}for(var ye=[],be=0,Ae=J.elements;be<Ae.length;be++){var le=Ae[be];K.has(le.unit.id)?(ye[ye.length]={unit:le.unit,indices:Le.union(K.get(le.unit.id),le.indices)},K.delete(le.unit.id)):ye[ye.length]=le}return K.forEach(function(Se,ie){ye[ye.length]={unit:z.structure.unitMap.get(ie),indices:Se}}),e(z.structure,ye)}e.union=v;function h(z,J){for(var K=new Map,Z=0,te=J.elements;Z<te.length;Z++){var le=te[Z];K.set(le.unit.id,le.indices)}for(var ye=[],be=0,Ae=z.elements;be<Ae.length;be++){var le=Ae[be];if(K.has(le.unit.id)){var Se=Le.subtract(le.indices,K.get(le.unit.id));if(Le.size(Se)===0)continue;ye[ye.length]={unit:le.unit,indices:Se}}else ye[ye.length]=le}return e(z.structure,ye)}e.subtract=h;function m(z,J){for(var K=new Map,Z=0,te=z.elements;Z<te.length;Z++){var le=te[Z];K.set(le.unit.id,le.indices)}for(var ye=[],be=0,Ae=J.elements;be<Ae.length;be++){var le=Ae[be];if(K.has(le.unit.id)){var Se=Le.intersect(K.get(le.unit.id),le.indices);Le.size(Se)!==0&&(ye[ye.length]={unit:le.unit,indices:Se})}}return e(z.structure,ye)}e.intersect=m;function g(z,J){if(z.elements.length>J.elements.length)return g(J,z);if(e.isEmpty(z))return e.isEmpty(J);for(var K=new Map,Z=0,te=z.elements;Z<te.length;Z++){var le=te[Z];K.set(le.unit.id,le.indices)}for(var ye=0,be=J.elements;ye<be.length;ye++){var le=be[ye];if(K.has(le.unit.id)&&Le.areIntersecting(K.get(le.unit.id),le.indices))return!0}return!1}e.areIntersecting=g;function y(z,J){if(e.isEmpty(z))return e.isEmpty(J);for(var K=new Map,Z=0,te=z.elements;Z<te.length;Z++){var le=te[Z];K.set(le.unit.id,le.indices)}for(var ye=!1,be=0,Ae=J.elements;be<Ae.length;be++){var le=Ae[be];if(K.has(le.unit.id))if(Le.isSubset(K.get(le.unit.id),le.indices))ye=!0;else return!1}return ye}e.isSubset=y;function b(z,J){for(var K=[],Z=new Set,te=0,le=z.elements;te<le.length;te++){var ye=le[te];if(x(ye)){K[K.length]=ye;continue}if(ye.unit.kind===0){for(var be=ye.unit.elements,Ae=ye.unit.model.atomicHierarchy,Se=ye.unit.model.atomicHierarchy.atoms.label_alt_id,ie=Ae.residueAtomSegments,oe=ie.index,L=ie.offsets,V=[],he=ye.indices,we=Le.size(he),Te=0;Te<we;){Z.clear();var ze=be[Le.getAt(he,Te)],Ve=oe[ze];for(Z.add(Se.value(ze)),Te++;Te<we;){var Xe=be[Le.getAt(he,Te)];if(oe[Xe]!==Ve)break;Z.add(Se.value(Xe)),Te++}for(var ct=Z.has(""),Ne=L[Ve],Qe=L[Ve+1];Ne<Qe;Ne++){var it=Le.indexOf(be,Ne);if(it>=0){var ot=Se.value(Ne);(!J||ct||!ot||Z.has(ot))&&(V[V.length]=it)}}}K[K.length]={unit:ye.unit,indices:Je.ofSortedArray(V)}}else K[K.length]=ye}return e(z.structure,K)}e.extendToWholeResidues=b;function S(z){switch(z.kind){case 0:return z.model.atomicHierarchy.chainAtomSegments;case 1:return z.model.coarseHierarchy.spheres.chainElementSegments;case 2:return z.model.coarseHierarchy.gaussians.chainElementSegments}}function x(z){return z.unit.elements.length===Le.size(z.indices)}function C(z){return z.length>12&&z[z.length-1]-z[0]===z.length-1?Ie.ofRange(z[0],z[z.length-1]):Je.ofSortedArray(z)}function w(z,J,K){for(var Z=S(z).index,te=z.elements,le=0,ye=0,be=te.length;ye<be;ye++){var Ae=te[ye],Se=Z[Ae];J.has(Se)&&le++}if(le===z.elements.length){K[K.length]={unit:z,indices:Ie.ofBounds(0,le)};return}var ie=new Int32Array(le);le=0;for(var ye=0,be=te.length;ye<be;ye++){var Ae=te[ye],Se=Z[Ae];J.has(Se)&&(ie[le++]=ye)}ie.length>0&&(K[K.length]={unit:z,indices:C(ie)})}function A(z,J,K,Z,te){for(var le=S(z.elements[0].unit).index,ye=new Set,be=J;be<K;be++)for(var Ae=z.elements[be],Se=Ae.indices,ie=Ae.unit.elements,oe=0,L=Le.size(Se);oe<L;oe++)ye.add(le[ie[Le.getAt(Se,oe)]]);if(Z)for(var V=z.elements[0].unit,he=0,we=z.structure.units;he<we.length;he++){var Te=we[he];je.areSameChainOperatorGroup(Te,V)&&w(Te,ye,te)}else for(var be=J;be<K;be++)w(z.elements[be].unit,ye,te)}function M(z){for(var J=[],K=0,Z=z.elements.length;K<Z;K++){var te=z.elements[K];if(je.Traits.is(te.unit.traits,2)){for(var le=K;K<Z&&je.areSameChainOperatorGroup(z.elements[K].unit,te.unit);)K++;var ye=K;K--,A(z,le,ye,!0,J)}else x(te)?J[J.length]=te:A(z,K,K+1,!1,J)}return e(z.structure,J)}e.extendToWholeChains=M;function D(z){return z.unit.model.id+"|"+lt.entity.id(z)}function k(z){for(var J=[],K=Ze.create(z.structure),Z=new Set,te=z.structure.units,le=0,ye=z.elements.length;le<ye;le++){var be=z.elements[le];K.unit=be.unit,K.element=be.unit.elements[0],Z.add(D(K))}for(var le=0,Ae=te.length;le<Ae;++le){var Se=te[le];if(K.unit=Se,K.element=Se.elements[0],Z.has(D(K))){var ie=Le.ofBounds(0,Se.elements.length);J[J.length]={unit:Se,indices:ie}}}return e(z.structure,J)}e.extendToWholeEntities=k;function R(z){for(var J=[],K=new Set,Z=z.structure.units,te=0,le=z.elements.length;te<le;te++){var ye=z.elements[te];K.add(ye.unit.model.id)}for(var te=0,be=Z.length;te<be;++te){var Ae=Z[te];if(K.has(Ae.model.id)){var Se=Le.ofBounds(0,Ae.elements.length);J[J.length]={unit:Ae,indices:Se}}}return e(z.structure,J)}e.extendToWholeModels=R;function O(z,J){for(var K=[],Z=0,te=Le.size(J);Z<te;++Z)K.push(z[Le.getAt(J,Z)]);return Je.ofSortedArray(K)}function H(z,J){return Je.indicesOf(z,J)}function B(z){for(var J=[],K=new Map,Z=0,te=z.elements.length;Z<te;Z++){var le=z.elements[Z],ye=le.unit.model,be=O(le.unit.elements,le.indices);K.has(ye)?K.set(ye,Je.union(be,K.get(ye))):K.set(ye,be)}for(var Z=0,Ae=z.structure.units.length;Z<Ae;++Z){var Se=z.structure.units[Z],be=K.get(Se.model);if(be){var ie=H(Se.elements,be);J[J.length]={unit:Se,indices:ie}}}return e(z.structure,J)}e.extendToAllInstances=B;function j(z){for(var J=[],K=new Set,Z=z.structure.units,te=0,le=z.elements.length;te<le;te++){var ye=z.elements[te];K.add(ye.unit.conformation.operator.name)}for(var te=0,be=Z.length;te<be;++te){var Ae=Z[te];if(K.has(Ae.conformation.operator.name)){var Se=Le.ofBounds(0,Ae.elements.length);J[J.length]={unit:Ae,indices:Se}}}return e(z.structure,J)}e.extendToWholeOperators=j;var Y=new ps("98"),G=_();function $(z,J){Y.reset();for(var K=0,Z=z.elements;K<Z.length;K++)for(var te=Z[K],le=te.indices,ye=te.unit.conformation.position,be=te.unit.conformation.r,Ae=te.unit.elements,Se=0,ie=Le.size(le);Se<ie;Se++){var oe=Ae[Le.getAt(le,Se)];ye(oe,G),J&&_.transformMat4(G,G,J),Y.includePositionRadius(G,be(oe))}Y.finishedIncludeStep();for(var L=0,V=z.elements;L<V.length;L++)for(var te=V[L],le=te.indices,ye=te.unit.conformation.position,be=te.unit.conformation.r,Ae=te.unit.elements,Se=0,ie=Le.size(le);Se<ie;Se++){var oe=Ae[Le.getAt(le,Se)];ye(oe,G),J&&_.transformMat4(G,G,J),Y.radiusPositionRadius(G,be(oe))}return{box:Y.getBox(),sphere:Y.getSphere()}}e.getBoundary=$;var q=_();function ee(z,J,K){K===void 0&&(K=0);for(var Z=K,te=0,le=z.elements;te<le.length;te++){for(var ye=le[te],be=ye.indices,Ae=ye.unit.conformation.position,Se=ye.unit.elements,ie=Le.size(be),oe=0;oe<ie;oe++){var L=Se[Le.getAt(be,oe)];Ae(L,q),_.toArray(q,J,Z+oe*3)}Z+=ie*3}return J}e.toPositionsArray=ee;function fe(z){var J=a(z),K=ee(z,new Float32Array(3*J));return hv.ofPositions(K)}e.getPrincipalAxes=fe;function W(z,J){return je.isAtomic(z)?z.model.atomicHierarchy.atomSourceIndex.value(J):J}function X(z){var J;if(e.isEmpty(z))return se.struct.generator.empty();for(var K=z.structure.models,Z=new Map,te=0,le=z.elements;te<le.length;te++){var ye=le[te],be=ye.indices,Ae=ye.unit.elements,Se=ye.unit.conformation.operator.name,ie=void 0;Z.has(Se)?ie=Z.get(Se).xs:(ie=tn.create(),Z.set(Se,{modelLabel:ye.unit.model.label,modelIndex:ye.unit.model.modelNum,xs:ie}));for(var oe=0,L=Le.size(be);oe<L;oe++){var V=W(ye.unit,Ae[Le.getAt(be,oe)]);tn.add(ie,V,V)}}for(var he=[],we=Z.keys();;){var Te=we.next();if(Te.done)break;var ye=Z.get(Te.value);he.push(U(Te.value,ye.xs.array,K.length>1,ye.modelLabel,ye.modelIndex))}for(var ze=new Map,oe=0,Ve=he.length;oe<Ve;++oe){var Xe=he[oe],ct=Dv(Ga(Xe.atom.ranges),Ga(Xe.atom.set)),Se=ct+"|"+(Xe.entity?Xe.entity.modelLabel+Xe.entity.modelIndex:"");ze.has(Se)?(J=ze.get(Se).chain.opName).push.apply(J,Xe.chain.opName):ze.set(Se,Xe)}var Ne=[];return ze.forEach(function(Qe){var it=Qe.atom,ot=it.ranges,dt=it.set,ke=Qe.chain.opName,Me=se.struct.atomProperty.core.operatorName(),Ye=se.struct.atomProperty.core.sourceIndex(),tt=[];dt.length>0&&(tt[tt.length]=se.core.set.has([se.core.type.set(dt),Ye]));for(var xt=0,ht=ot.length/2;xt<ht;xt++)tt[tt.length]=se.core.rel.inRange([Ye,ot[2*xt],ot[2*xt+1]]);if(Qe.entity){var ut=Qe.entity,pe=ut.modelLabel,me=ut.modelIndex;Ne.push(se.struct.generator.atomGroups({"atom-test":tt.length>1?se.core.logic.or(tt):tt[0],"chain-test":ke.length>1?se.core.set.has([se.core.type.set(ke),Me]):se.core.rel.eq([Me,ke[0]]),"entity-test":se.core.logic.and([se.core.rel.eq([se.struct.atomProperty.core.modelLabel(),pe]),se.core.rel.eq([se.struct.atomProperty.core.modelIndex(),me])])}))}else Ne.push(se.struct.generator.atomGroups({"atom-test":tt.length>1?se.core.logic.or(tt):tt[0],"chain-test":ke.length>1?se.core.set.has([se.core.type.set(ke),Me]):se.core.rel.eq([Me,ke[0]])}))}),se.struct.modifier.union([Ne.length===1?Ne[0]:se.struct.combinator.merge(Ne.map(function(Qe){return se.struct.modifier.union([Qe])}))])}e.toExpression=X;function U(z,J,K,Z,te){Tu(J);for(var le=[],ye=[],be=0,Ae=J.length;be<Ae;){var Se=be;for(be++;be<Ae&&J[be-1]+1===J[be];)be++;var ie=be;if(ie-Se>12)le[le.length]=J[Se],le[le.length]=J[ie-1];else for(var oe=Se;oe<ie;oe++)ye[ye.length]=J[oe]}return K?{atom:{set:ye,ranges:le},chain:{opName:[z]},entity:{modelLabel:Z,modelIndex:te}}:{atom:{set:ye,ranges:le},chain:{opName:[z]}}}})(Re||(Re={}));var Lf;(function(e){function t(){return{elementCount:0,conformationCount:0,residueCount:0,chainCount:0,unitCount:0,structureCount:0,firstElementLoc:Ze.create(void 0),firstConformationLoc:Ze.create(void 0),firstResidueLoc:Ze.create(void 0),firstChainLoc:Ze.create(void 0),firstUnitLoc:Ze.create(void 0),firstStructureLoc:Ze.create(void 0)}}e.create=t;function r(u,l,c){var d=u.get(l)||0;u.set(l,d+c)}function n(u,l,c){var d=c.indices,f=c.unit,p=f.elements,v=Le.size(d),h=new Map,m=new Map;if(v>0&&Ze.set(u.firstElementLoc,l,f,p[Le.start(d)]),v===p.length)u.unitCount+=1,u.unitCount===1&&Ze.set(u.firstUnitLoc,l,f,p[Le.start(d)]);else if(v===1){if(je.Traits.is(f.traits,1))return;u.elementCount+=1,u.elementCount===1&&Ze.set(u.firstElementLoc,l,f,p[Le.start(d)])}else if(je.isAtomic(f))for(var g=f.model.atomicHierarchy.residueAtomSegments,y=g.index,b=g.offsets,S=f.model.atomicHierarchy.atoms.label_alt_id,x=0,C=function(){h.clear();var w=0,A=p[Le.getAt(d,x)],M=y[A];for(r(h,S.value(A),1),++x,++w;x<v;){var D=p[Le.getAt(d,x)];if(y[D]!==M)break;r(h,S.value(D),1),++x,++w}if(b[M+1]-b[M]===w)u.residueCount+=1,u.residueCount===1&&Ze.set(u.firstResidueLoc,l,f,b[M]);else{m.clear();for(var k=b[M],R=b[M+1];k<R;++k)r(m,S.value(k),1);m.get("")===h.get("")&&h.forEach(function(O,H){if(m.get(H)===O){if(H!==""&&(u.conformationCount+=1,u.conformationCount===1)){for(var B=b[M],j=b[M+1];B<j;++B)if(H===S.value(B)){Ze.set(u.firstConformationLoc,l,f,B);break}}w-=O}}),u.elementCount+=w}};x<v;)C();else u.elementCount+=v,u.elementCount===1&&Ze.set(u.firstElementLoc,l,f,p[Le.start(d)])}function i(u,l,c){var d=c.indices,f=c.unit,p=Le.size(d);if(p!==0){var v=f.elements;if(!je.Traits.is(f.traits,1)){p===v.length&&(u.chainCount+=1,u.chainCount===1&&Ze.set(u.firstChainLoc,l,f,v[Le.start(d)]));return}var h=je.isAtomic(f)?f.model.atomicHierarchy.chainAtomSegments:je.isSpheres(f)?f.model.coarseHierarchy.spheres.chainElementSegments:je.isGaussians(f)?f.model.coarseHierarchy.gaussians.chainElementSegments:void 0;if(!h){console.warn("StructureElement loci stats: unknown unit type");return}for(var m=h.index,g=h.offsets,y=0;y<p;){var b=0,S=v[Le.getAt(d,y)],x=m[S];for(++y,++b;y<p;){var C=v[Le.getAt(d,y)];if(m[C]!==x)break;++y,++b}g[x+1]-g[x]===b&&(u.chainCount+=1,u.chainCount===1&&Ze.set(u.firstChainLoc,l,f,g[x]))}}}function a(u,l,c,d,f){var p=c[d],v=je.isAtomic(p.unit)?p.unit.model.atomicHierarchy.chainAtomSegments:je.isSpheres(p.unit)?p.unit.model.coarseHierarchy.spheres.chainElementSegments:je.isGaussians(p.unit)?p.unit.model.coarseHierarchy.gaussians.chainElementSegments:void 0;if(!v){console.warn("StructureElement loci stats: unknown unit type");return}for(var h=v.index,m=v.offsets,g=new Map,y=d;y<f;y++){p=c[y];var b=p.indices,S=p.unit,x=Le.size(b);if(x!==0){var C=S.elements;if(!je.Traits.is(S.traits,1)){var w=C[Le.start(b)];r(g,h[w],C.length);continue}for(var A=0;A<x;){var M=0,w=C[Le.getAt(b,A)],D=h[w];for(++A,++M;A<x;){var k=C[Le.getAt(b,A)];if(h[k]!==D)break;++A,++M}r(g,D,M)}}}var R=-1;if(g.forEach(function(O,H){m[H+1]-m[H]===O&&(u.chainCount+=1,u.chainCount===1&&(R=H))}),!(R<0))for(var y=d;y<f;y++){p=c[y];var b=p.indices,S=p.unit,x=Le.size(b);if(x!==0)for(var C=S.elements,A=0;A<x;){var w=C[Le.getAt(b,A)],D=h[w];if(D===R){Ze.set(u.firstChainLoc,l,S,w);return}}}}function o(u){var l=t();if(Re.isEmpty(u))return l;var c=!1;if(Re.isWholeStructure(u)){if(l.structureCount+=1,l.structureCount===1){var d=u.elements[0],f=d.unit,p=d.indices;Ze.set(l.firstStructureLoc,u.structure,f,f.elements[Le.min(p)])}}else for(var v=0,h=u.elements;v<h.length;v++){var m=h[v];n(l,u.structure,m),je.Traits.is(m.unit.traits,2)?c=!0:i(l,u.structure,m)}if(c)for(var g=0,y=u.elements.length;g<y;g++){var m=u.elements[g];if(je.Traits.is(m.unit.traits,2)){for(var b=g;g<y&&je.areSameChainOperatorGroup(u.elements[g].unit,m.unit);)g++;var S=g;g--,S-b===1?i(l,u.structure,m):a(l,u.structure,u.elements,b,S)}}return l}e.ofLoci=o;function s(u,l,c){return l.elementCount===1&&c.elementCount===0?Ze.copy(u.firstElementLoc,l.firstElementLoc):l.elementCount===0&&c.elementCount===1&&Ze.copy(u.firstElementLoc,c.firstElementLoc),l.conformationCount===1&&c.conformationCount===0?Ze.copy(u.firstConformationLoc,l.firstConformationLoc):l.conformationCount===0&&c.conformationCount===1&&Ze.copy(u.firstConformationLoc,c.firstConformationLoc),l.residueCount===1&&c.residueCount===0?Ze.copy(u.firstResidueLoc,l.firstResidueLoc):l.residueCount===0&&c.residueCount===1&&Ze.copy(u.firstResidueLoc,c.firstResidueLoc),l.chainCount===1&&c.chainCount===0?Ze.copy(u.firstChainLoc,l.firstChainLoc):l.chainCount===0&&c.chainCount===1&&Ze.copy(u.firstChainLoc,c.firstChainLoc),l.unitCount===1&&c.unitCount===0?Ze.copy(u.firstUnitLoc,l.firstUnitLoc):l.unitCount===0&&c.unitCount===1&&Ze.copy(u.firstUnitLoc,c.firstUnitLoc),l.structureCount===1&&c.structureCount===0?Ze.copy(u.firstStructureLoc,l.firstStructureLoc):l.structureCount===0&&c.structureCount===1&&Ze.copy(u.firstStructureLoc,c.firstStructureLoc),u.elementCount=l.elementCount+c.elementCount,u.conformationCount=l.conformationCount+c.conformationCount,u.residueCount=l.residueCount+c.residueCount,u.chainCount=l.chainCount+c.chainCount,u.unitCount=l.unitCount+c.unitCount,u.structureCount=l.structureCount+c.structureCount,u}e.add=s})(Lf||(Lf={}));function $Be(e){return je.isAtomic(e.unit)?e.unit.residueIndex[e.element]:-1}function WBe(e){return je.isAtomic(e.unit)?e.unit.chainIndex[e.element]:-1}function XBe(e){return lt.entity.key(e)}Bi.Field;Bi.Encodings;Bi.Field;Bi.Category;Bi.Category;Bi.Category;var lj;(function(e){function t(r){var n=Array.isArray(r)?r:[r];return{structures:n,firstModel:n[0].model,cache:Object.create(null)}}e.create=t})(lj||(lj={}));var cj;(function(e){e.AtomSitePositionsFieldNames=new Set(["id","Cartn_x","Cartn_y","Cartn_z"])})(cj||(cj={}));var YBe={molstar_atom_site_operator_mapping:{label_asym_id:ve.Schema.Str(),auth_asym_id:ve.Schema.Str(),operator_name:ve.Schema.Str(),suffix:ve.Schema.Str(),assembly_id:ve.Schema.Str(),assembly_operator_id:ve.Schema.Int(),symmetry_operator_index:ve.Schema.Int(),symmetry_hkl:ve.Schema.Vector(3),ncs_id:ve.Schema.Int()}},dj=function(e,t){return typeof t[e].operator.assembly>"u"?1:0},O4=function(e,t){return t[e].operator.spgrOp===-1?1:0};Bi.fields().str("label_asym_id",function(e,t){return t[e].label_asym_id}).str("auth_asym_id",function(e,t){return t[e].auth_asym_id}).str("operator_name",function(e,t){return t[e].operator.name}).str("suffix",function(e,t){return t[e].operator.suffix}).str("assembly_id",function(e,t){var r;return((r=t[e].operator.assembly)===null||r===void 0?void 0:r.id)||""},{valueKind:dj}).int("assembly_operator_id",function(e,t){var r;return((r=t[e].operator.assembly)===null||r===void 0?void 0:r.operId)||0},{valueKind:dj}).int("symmetry_operator_index",function(e,t){return t[e].operator.spgrOp},{valueKind:O4}).vec("symmetry_hkl",[function(e,t){return t[e].operator.hkl[0]},function(e,t){return t[e].operator.hkl[1]},function(e,t){return t[e].operator.hkl[2]}],{valueKind:O4}).int("ncs_id",function(e,t){return t[e].operator.ncsId},{valueKind:O4}).getFields();function KBe(e){if(e._rowCount===0)return{residues:[],chains:[]};for(var t=0,r=e._rowCount,n=[t],i=[t],a=e.label_entity_id,o=e.label_asym_id,s=e.label_seq_id,u=e.auth_seq_id,l=e.pdbx_PDB_ins_code,c=t+1;c<r;c++){var d=!a.areValuesEqual(c-1,c)||!o.areValuesEqual(c-1,c),f=d||!s.areValuesEqual(c-1,c)||!u.areValuesEqual(c-1,c)||!l.areValuesEqual(c-1,c);f&&(n[n.length]=c),d&&(i[i.length]=c)}return{residues:n,chains:i}}function Ix(e,t,r){e[t].isDefined||(e[t]=e[r]),e[r].isDefined||(e[r]=e[t])}function QBe(e,t,r){var n=Qr.ofColumns(eke,{type_symbol:ve.ofArray({array:ve.mapToArray(e.type_symbol,x0),schema:ve.Schema.Aliased(ve.Schema.str)}),label_atom_id:e.label_atom_id,auth_atom_id:e.auth_atom_id,label_alt_id:e.label_alt_id,label_comp_id:e.label_comp_id,auth_comp_id:e.auth_comp_id,pdbx_formal_charge:e.pdbx_formal_charge}),i=Qr.view(e,tke,r.residues),a=Qr.view(e,rke,r.chains);if(!i.label_seq_id.isDefined){for(var o=new Int32Array(i.label_seq_id.rowCount),s=r.residues,u=r.chains,l=0,c=0,d=0,f=o.length;d<f;++d)s[d]>=u[l+1]&&(l+=1,c=0),o[d]=++c;i.label_seq_id=ve.ofIntArray(o)}return Qr.columnToArray(i,"label_seq_id",Int32Array),Qr.columnToArray(i,"auth_seq_id",Int32Array),Ix(n,"label_atom_id","auth_atom_id"),Ix(n,"label_comp_id","auth_comp_id"),Ix(i,"label_seq_id","auth_seq_id"),Ix(a,"label_asym_id","auth_asym_id"),{atoms:n,residues:i,chains:a,atomSourceIndex:t}}function ZBe(e){return{id:mn.create22(),atomId:e.id,occupancy:e.occupancy,B_iso_or_equiv:e.B_iso_or_equiv,xyzDefined:e.Cartn_x.isDefined&&e.Cartn_y.isDefined&&e.Cartn_z.isDefined,x:e.Cartn_x.toArray({array:Float32Array}),y:e.Cartn_y.toArray({array:Float32Array}),z:e.Cartn_z.toArray({array:Float32Array})}}function JBe(e,t){return Qr.areEqual(e.chains,t.chains)&&Qr.areEqual(e.residues,t.residues)&&Qr.areEqual(e.atoms,t.atoms)}function e8e(e,t){var r=new Map;if(!an.is(t))return r;var n=pc(YBe,t.data.frame).molstar_atom_site_operator_mapping;if(n._rowCount===0)return r;for(var i=new Map,a=new Map,o=0;o<n._rowCount;o++){var s=n.assembly_operator_id.valueKind(o)===0?{id:n.assembly_id.value(o),operList:[],operId:n.assembly_operator_id.value(o)}:void 0,u=bn.create(n.operator_name.value(o),ue.identity(),{assembly:s,spgrOp:n.symmetry_operator_index.valueKind(o)===0?n.symmetry_operator_index.value(o):void 0,hkl:_.ofArray(n.symmetry_hkl.value(o)),ncsId:n.ncs_id.value(o)}),l=n.suffix.value(o),c=n.label_asym_id.value(o);i.set(""+c+l,{name:c,operator:u});var d=n.auth_asym_id.value(o);a.set(""+d+l,d)}for(var f=e.chains,p=f.label_asym_id,v=f.auth_asym_id,h=new Array(p.rowCount),m=new Array(p.rowCount),o=0;o<p.rowCount;o++){var c=p.value(o),d=v.value(o);if(!i.has(c)){h[o]=c,m[o]=d;continue}var g=i.get(c),y=g.name,u=g.operator;r.set(o,u),h[o]=y,m[o]=a.get(d)||d}return e.chains.label_asym_id=ve.ofArray({array:h,valueKind:e.chains.label_asym_id.valueKind,schema:e.chains.label_asym_id.schema}),e.chains.auth_asym_id=ve.ofArray({array:m,valueKind:e.chains.auth_asym_id.valueKind,schema:e.chains.auth_asym_id.schema}),r}function t8e(e,t,r,n,i,a){var o=KBe(e),s=QBe(e,t,o),u=e8e(s,i);if(a&&JBe(a.atomicHierarchy,s))return{sameAsPrevious:!0,hierarchy:a.atomicHierarchy,chainOperatorMapping:u};var l={residueAtomSegments:nr.ofOffsets(o.residues,Ie.ofBounds(0,e._rowCount)),chainAtomSegments:nr.ofOffsets(o.chains,Ie.ofBounds(0,e._rowCount))},c=hke(s,r,l),d=Bke(s,l,c,n),f=E(E(E({},s),l),{index:c,derived:d});return{sameAsPrevious:!1,hierarchy:f,chainOperatorMapping:u}}function XJ(e,t,r,n,i,a){var o=t8e(e,t,r,n,i,a),s=o.sameAsPrevious,u=o.hierarchy,l=o.chainOperatorMapping,c=ZBe(e);return{sameAsPrevious:s,hierarchy:u,conformation:c,chainOperatorMapping:l}}var vD;(function(e){e.Empty={isDefined:!1}})(vD||(vD={}));function r8e(e,t,r){if(e.has(t))return e.get(t);var n=r.index++;return e.set(t,n),n}function n8e(e,t){if(e.has(t))return e.get(t);var r=new Map;return e.set(t,r),r}function i8e(e,t,r){var n=e.getEntityIndex,i=function(o,s){var u=n(o);if(u<0)return-1;var l=t.get(u);return l.has(s)?l.get(s):-1},a=function(o,s,u){var l=n(o);if(l<0)return-1;var c=t.get(l);if(c===void 0)return-1;var d=c.get(s);if(d===void 0)return-1;var f=r.get(d),p=f.elementIndices,v=f.seqRanges,h=en.firstIntersectionIndex(v,Le.ofSingleton(u));return h!==-1?p[h]:-1};return{findChainKey:i,findSequenceKey:a}}function a8e(e){throw new Error("Missing entity entry for entity id '"+e+"'.")}function fj(e,t){for(var r=e.entity_id,n=e.asym_id,i=e.seq_id_begin,a=e.seq_id_end,o=e.count,s=e.chainElementSegments,u=new Map,l=new Map,c={index:0},d=new Int32Array(o),f=new Int32Array(o),p=new Int32Array(s.count),v=0;v<o;v++)f[v]=t.getEntityIndex(r.value(v)),f[v]<0&&a8e(r.value(v));for(var h=0;h<s.count;h++){var m=s.offsets[h],g=s.offsets[h+1],y=f[m];p[h]=y;for(var b=n8e(l,y),S=r8e(b,n.value(m),c),v=m;v<g;v++)d[v]=S;for(var x=[],C=[],v=m;v<g;v++){var w=i.value(v),A=a.value(v);x.push(v),C.push(w,A)}var M={elementIndices:x,seqRanges:en.ofSortedRanges(C)};u.set(S,M)}var D=i8e(t,l,u),k=D.findChainKey,R=D.findSequenceKey,O=function(H){return p[H]};return{chainKey:d,entityKey:f,findSequenceKey:R,findChainKey:k,getEntityFromChain:O}}function pj(e,t){for(var r=[],n=[],i=nr.transientSegments(e.chainElementSegments,Ie.ofBounds(0,e.count)),a=e.seq_id_begin,o=e.seq_id_end;i.hasNext;)for(var s=i.move(),u=s.start,l=s.end,c=-1,d=-1,f=u;f<l;++f){var p=o.value(f);f===u?(c=f,d=o.value(f)):a.value(f)-d>1&&(r.push(c,f-1),n.push(f-1,f),c=f),f===l-1&&r.push(c,f),d=p}return{polymerRanges:en.ofSortedRanges(r),gapRanges:en.ofSortedRanges(n)}}yr.atom_site.label_comp_id,yr.atom_site.label_seq_id,yr.atom_site.pdbx_PDB_ins_code,yr.atom_site.label_asym_id,yr.atom_site.label_entity_id,yr.atom_site.auth_atom_id,yr.atom_site.auth_seq_id,yr.atom_site.auth_asym_id;E(E({},yr.chem_comp_bond),{molstar_protonation_variant:ve.Schema.Str()});var o8e=E(E({},yr.chem_comp),{type:ve.Schema.Aliased(ve.Schema.str)}),to={entry:yr.entry,struct:yr.struct,struct_asym:yr.struct_asym,ihm_model_list:yr.ihm_model_list,ihm_model_group:yr.ihm_model_group,ihm_model_group_link:yr.ihm_model_group_link,entity:yr.entity,entity_poly:yr.entity_poly,entity_poly_seq:yr.entity_poly_seq,pdbx_entity_branch:yr.pdbx_entity_branch,chem_comp:o8e,pdbx_chem_comp_identifier:yr.pdbx_chem_comp_identifier,atom_site:yr.atom_site,ihm_sphere_obj_site:yr.ihm_sphere_obj_site,ihm_gaussian_obj_site:yr.ihm_gaussian_obj_site,pdbx_unobs_or_zero_occ_residues:yr.pdbx_unobs_or_zero_occ_residues,pdbx_molecule:yr.pdbx_molecule};function Fv(e){for(var t=Object.create(null),r=0,n=Object.keys(to);r<n.length;r++){var i=n[r];i in e?t[i]=e[i]:t[i]=Qr.ofUndefinedColumns(to[i],0)}return t}var YJ={hierarchy:vD.Empty,conformation:void 0};function s8e(e,t){var r=e.ihm_sphere_obj_site,n=e.ihm_gaussian_obj_site;if(r._rowCount===0&&n._rowCount===0)return YJ;var i=hj(r),a=u8e(r),o=fj(i,e.entities),s=pj(i,t.chemicalComponentMap),u=hj(n),l=l8e(n),c=fj(u,e.entities),d=pj(u,t.chemicalComponentMap);return{hierarchy:{isDefined:!0,spheres:E(E(E({},i),o),s),gaussians:E(E(E({},u),c),d)},conformation:{id:mn.create22(),spheres:a,gaussians:l}}}function u8e(e){return{x:e.Cartn_x.toArray({array:Float32Array}),y:e.Cartn_y.toArray({array:Float32Array}),z:e.Cartn_z.toArray({array:Float32Array}),radius:e.object_radius.toArray({array:Float32Array}),rmsf:e.rmsf.toArray({array:Float32Array})}}function l8e(e){for(var t=to.ihm_gaussian_obj_site.covariance_matrix.space,r=[],n=e.covariance_matrix,i=0,a=n.rowCount;i<a;i++)r[i]=Mr.toMat3($n(),t,n.value(i));return{x:e.mean_Cartn_x.toArray({array:Float32Array}),y:e.mean_Cartn_y.toArray({array:Float32Array}),z:e.mean_Cartn_z.toArray({array:Float32Array}),weight:e.weight.toArray({array:Float32Array}),covariance_matrix:r}}function c8e(e,t,r){for(var n=[0],i=1,a=e.rowCount;i<a;i++){var o=!e.areValuesEqual(i-1,i);o&&(n[n.length]=i)}return{chainElementSegments:nr.ofOffsets(n,Ie.ofBounds(0,e.rowCount))}}function hj(e){var t=e.entity_id,r=e.seq_id_begin,n=e.seq_id_end,i=e.asym_id;return E({count:t.rowCount,entity_id:t,asym_id:i,seq_id_begin:r,seq_id_end:n},c8e(i))}var d8e={HIS:"H",ARG:"R",LYS:"K",ILE:"I",PHE:"F",LEU:"L",TRP:"W",ALA:"A",MET:"M",PRO:"P",CYS:"C",ASN:"N",VAL:"V",GLY:"G",SER:"S",GLN:"Q",TYR:"Y",ASP:"D",GLU:"E",THR:"T",SEC:"U",PYL:"O",HSD:"H",HSE:"H",HSP:"H",LSN:"K",ASPP:"D",GLUP:"E",HID:"H",HIE:"H",HIP:"H",LYN:"K",ASH:"D",GLH:"E"},f8e={DA:"A",DC:"C",DG:"G",DT:"T",DU:"U"},p8e={A:"A",C:"C",G:"G",T:"T",U:"U"};function vj(e){var t=d8e[e];return t||"X"}function mj(e){var t=p8e[e];return t||"X"}function gj(e){var t=f8e[e];return t||"X"}var Mb;(function(e){function t(u){var l=u.code.toArray();return(l instanceof Array?l:Array.from(l)).join("")}e.getSequenceString=t;function r(u){for(var l=0,c=Math.min(u.rowCount,10);l<c;l++){var d=u.value(l)||"";if(vj(d)!=="X")return"protein";if(mj(d)!=="X")return"RNA";if(gj(d)!=="X")return"DNA"}return"generic"}function n(u,l){var c;switch(u){case"protein":c=vj;break;case"DNA":c=gj;break;case"RNA":c=mj;break;case"generic":c=function(){return"X"};break;default:throw new Error("unknown kind '"+u+"'")}return l&&l.size>0?function(d){var f=c(d);return f!=="X"||!l.has(d)?f:c(l.get(d))}:c}function i(u,l){if(l.rowCount===0)throw new Error("cannot be empty");var c=r(u);return new a(c,u,l)}e.ofResidueNames=i;var a=function(){function u(l,c,d){this.kind=l,this.microHet=new Map;for(var f=n(l),p=[],v=[],h=[],m=new Map,g=0,y=new Map,b=0,S=d.rowCount;b<S;++b){var x=d.value(b);if(y.has(x))m.has(x)?m.get(x).push(c.value(b)):m.set(x,[v[y.get(x)],c.value(b)]);else{y.set(x,g);var C=c.value(b);v[g]=C,h[g]=x,p[g]=f(C),g+=1}}for(var w=[],b=0,S=g;b<S;++b){var A=m.get(h[b]);if(A){var M=A.map(function(R){var O=f(R);return O==="X"?R:O});w[b]="("+M.join("|")+")"}else w[b]=p[b]==="X"?v[b]:p[b]}this.length=g,this.code=ve.ofStringArray(p),this.compId=ve.ofStringArray(v),this.seqId=ve.ofIntArray(h),this.label=ve.ofStringArray(w),this.microHet=m,this.indexMap=y}return u.prototype.index=function(l){return this.indexMap.get(l)},u}();function o(u,l){var c="generic";return new s(c,u,l)}e.ofSequenceRanges=o;var s=function(){function u(l,c,d){this.kind=l,this.seqIdStart=c,this.seqIdEnd=d,this.microHet=new Map;for(var f=0,p=Number.MAX_SAFE_INTEGER,v=0,h=this.seqIdStart.rowCount;v<h;v++){var m=this.seqIdStart.value(v),g=this.seqIdEnd.value(v);m<p&&(p=m),f<g&&(f=g)}var y=f-p+1;this.code=ve.ofConst("X",y,ve.Schema.str),this.label=ve.ofConst("",y,ve.Schema.str),this.seqId=ve.ofLambda({value:function(b){return b+p+1},rowCount:y,schema:ve.Schema.int}),this.compId=ve.ofConst("",y,ve.Schema.str),this.length=y,this.minSeqId=p}return u.prototype.index=function(l){return l-this.minSeqId},u}()})(Mb||(Mb={}));var mD;(function(e){var t={byEntityKey:{},sequences:[]};function r(){for(var s=[],u=0;u<arguments.length;u++)s[u]=arguments[u];for(var l=[],c={},d=0,f=s.length;d<f;++d)l.push.apply(l,s[d].sequences),Object.assign(c,s[d].byEntityKey);return{sequences:l,byEntityKey:c}}function n(s,u,l){var c=i(s,u),d=l.isDefined?a(s,l):t;return r(c,d)}e.fromHierarchy=n;function i(s,u){var l=u.atoms.label_comp_id,c=u.residues.label_seq_id,d=u.chainAtomSegments,f=u.residueAtomSegments,p=d.count,v=d.offsets,h={},m=[];if(p===1&&v[0]===0&&v[1]===0)return{byEntityKey:h,sequences:m};for(var g=0,y=u.chains._rowCount;g<y;g++){var b=u.index.getEntityFromChain(g);if(!(h[b]!==void 0||s.data.type.value(b)!=="polymer")){var S=g;for(g++;g<y&&b===u.index.getEntityFromChain(g)&&s.data.type.value(b)!=="polymer";)g++;g--;for(var x=f.index[v[S]],C=f.index[v[g+1]-1]+1,w=ve.window(c,x,C),A=[],M=x;M<C;++M)A.push(l.value(f.offsets[M]));var D=ve.ofStringArray(A);h[b]={entityId:s.data.id.value(b),sequence:Mb.ofResidueNames(D,w)},m.push(h[b])}}return{byEntityKey:h,sequences:m}}e.fromAtomicHierarchy=i;function a(s,u){var l=o(s,u.spheres),c=o(s,u.gaussians);return r(l,c)}e.fromCoarseHierarchy=a;function o(s,u){var l=u.chainElementSegments,c=u.seq_id_begin,d=u.seq_id_end,f=l.count,p=l.offsets,v={},h=[];if(f===1&&p[0]===0&&p[1]===0)return{byEntityKey:v,sequences:h};for(var m=0,g=f;m<g;m++){var y=u.getEntityFromChain(m);if(v[y]===void 0){var b=m;for(m++;m<g&&y===u.getEntityFromChain(m);)m++;m--;var S=p[b],x=p[m+1]-1,C=ve.window(c,S,x),w=ve.window(d,S,x);v[y]={entityId:s.data.id.value(y),sequence:Mb.ofSequenceRanges(C,w)},h.push(v[y])}}return{byEntityKey:v,sequences:h}}e.fromCoarseElements=o})(mD||(mD={}));function KJ(e,t,r,n){if(!e.entity_poly_seq||!e.entity_poly_seq._rowCount)return mD.fromHierarchy(t,r,n);for(var i=e.entity_poly_seq,a=i.entity_id,o=i.num,s=i.mon_id,u={},l=[],c=a.rowCount,d=0;d<c;){for(var f=d;d<c-1&&a.areValuesEqual(d,d+1);)d++;d++;var p=a.value(f),v=ve.window(s,f,d),h=ve.window(o,f,d),m=t.getEntityIndex(p);u[m]={entityId:p,sequence:Mb.ofResidueNames(v,h)},l.push(u[m])}return{byEntityKey:u,sequences:l}}function QJ(e,t,r,n){return ce(this,void 0,void 0,function(){var i,a,o,s,u,l,c,d,f,p,v;return de(this,function(h){switch(h.label){case 0:return i=_5(r,n-1),a=t.label_entity_id,o=t.label_asym_id,s=t.label_seq_id,u=u4(i,a.value),e.shouldUpdate?[4,e.update()]:[3,2];case 1:h.sent(),h.label=2;case 2:l=0,c=u.length-1,h.label=3;case 3:if(!(l<c))return[3,10];d=u4(i,o.value,{start:u[l],end:u[l+1]}),f=0,p=d.length-1,h.label=4;case 4:return f<p?(v=d[f],s.valueKind(v)!==0?[3,6]:(u4(i,s.value,{sort:!0,start:v,end:d[f+1]}),e.shouldUpdate?[4,e.update()]:[3,6])):[3,7];case 5:h.sent(),h.label=6;case 6:return f++,[3,4];case 7:return e.shouldUpdate?[4,e.update()]:[3,9];case 8:h.sent(),h.label=9;case 9:return l++,[3,3];case 10:return cDe(i)&&i.length===t._rowCount?[2,{atom_site:t,sourceIndex:ve.ofIntArray(i)}]:[2,{atom_site:Qr.view(t,t._schema,i),sourceIndex:ve.ofIntArray(i)}]}})})}function yj(e,t,r,n,i){var a=i.residue,o=a.polymerType,s=a.traceElementIndex,u=a.directionFromElementIndex,l=a.directionToElementIndex,c=o[e],d=o[t];if(c===0||d===0||s[e]===-1||s[t]===-1)return!1;var f=n.findAtomsOnResidue(e,Of(c,"backboneStart")),p=n.findAtomsOnResidue(t,Of(d,"backboneEnd"));(f===-1||p===-1)&&(f=n.findAtomsOnResidue(e,Of(c,"coarseBackbone")),p=n.findAtomsOnResidue(t,Of(d,"coarseBackbone")));var v=r.x,h=r.y,m=r.z,g=_.create(v[f],h[f],m[f]),y=_.create(v[p],h[p],m[p]),b=u[e]===-1||l[e]===-1||u[t]===-1||l[t]===-1;return _.distance(g,y)<(b?10:3)}function ZJ(e,t,r,n){for(var i=[],a=[],o=new Map,s=nr.transientSegments(e.chainAtomSegments,Ie.ofBounds(0,e.atoms._rowCount)),u=nr.transientSegments(e.residueAtomSegments,Ie.ofBounds(0,e.atoms._rowCount)),l=e.index,c=e.derived,d=e.residues.label_seq_id,f=e.chains.label_entity_id,p=c.residue,v=p.moleculeType,h=p.traceElementIndex,m,g,y,b;s.hasNext;){var S=s.move();u.setSegment(S),m=-1,g=-1,y=-1,b=-1;var x=t.getEntityIndex(f.value(S.index)),C=n.byEntityKey[x],w=C?C.sequence.seqId.value(C.sequence.seqId.rowCount-1):-1,A=e.residueAtomSegments.index[S.start],M=e.residueAtomSegments.index[S.end-1],D=d.value(A),k=d.value(M);for(D===1&&k===w&&r.xyzDefined&&yj(A,M,r,l,c)&&(o.set(A,M),o.set(M,A));u.hasNext;){var R=u.move(),O=R.index,H=d.value(O);if(AL(v[O])&&h[O]!==-1)if(b!==-1)if(H!==m+1)i.push(b,y-1),a.push(g,R.end-1),b=R.start;else if(!u.hasNext)i.push(b,R.end-1);else{var B=e.residueAtomSegments.index[R.start],j=e.residueAtomSegments.index[y-1];r.xyzDefined&&!yj(B,j,r,e.index,c)&&(i.push(b,y-1),a.push(g,R.end-1),b=R.start)}else b=R.start;else b!==-1&&(i.push(b,y-1),b=-1);g=R.start,y=R.end,m=H}}return{polymerRanges:en.ofSortedRanges(i),gapRanges:en.ofSortedRanges(a),cyclicPolymerMap:o}}function vp(e){var t=void 0,r=void 0;return function(){for(var n=[],i=0;i<arguments.length;i++)n[i]=arguments[i];if(!t||t.length!==n.length)return t=n,r=e.apply(void 0,n),r;for(var a=0,o=n.length;a<o;a++)if(n[a]!==t[a])return t=n,r=e.apply(void 0,n),r;return r}}function ME(e){var t=new Map;return function(r){if(t.has(r))return t.get(r);var n=e(r);return t.set(r,n),n}}function h8e(e){for(var t=new Map,r=function(s,u,l){return s+"|"+u+"|"+l},n=e.pdbx_unobs_or_zero_occ_residues,i=0,a=n._rowCount;i<a;++i){var o=r(n.PDB_model_num.value(i),n.label_asym_id.value(i),n.label_seq_id.value(i));t.set(o,{polymer_flag:n.polymer_flag.value(i),occupancy_flag:n.occupancy_flag.value(i)})}return{has:function(s,u,l){return t.has(r(s,u,l))},get:function(s,u,l){return t.get(r(s,u,l))},size:t.size}}function v8e(e){var t=new Map;if(e.chem_comp._rowCount>0)for(var r=e.chem_comp.id,n=0,i=r.rowCount;n<i;++n)t.set(r.value(n),Qr.getRow(e.chem_comp,n));else{var a=JJ(e);a.forEach(function(o){t.set(o,kke(o))})}return t}function m8e(e){var t=new Map;if(e.pdbx_chem_comp_identifier._rowCount>0){for(var r=e.pdbx_chem_comp_identifier,n=r.comp_id,i=r.type,a=r.identifier,o=0,s=n.rowCount;o<s;++o)if(i.value(o)==="SNFG CARBOHYDRATE SYMBOL"||i.value(o)==="SNFG CARB SYMBOL"){var u=a.value(o),l=gke.get(u);l?t.set(n.value(o),l):console.warn("Unknown SNFG name '"+u+"'")}}if(e.chem_comp._rowCount>0)for(var c=e.chem_comp,d=c.id,i=c.type,o=0,s=d.rowCount;o<s;++o){var f=d.value(o);if(!t.has(f)){var p=i.value(o);Bh.has(f)?t.set(f,Bh.get(f)):S0(p,f)===9&&t.set(f,YZ)}}else{var v=JJ(e);Bh.forEach(function(h,m){!t.has(m)&&v.has(m)&&t.set(m,h)})}return t}var JJ=ME(function(e){for(var t=new Set,r=e.atom_site,n=r.label_comp_id,i=r.auth_comp_id,a=n.isDefined?n:i,o=0,s=a.rowCount;o<s;++o)t.add(a.value(o));return t});function g8e(e){for(var t=new Map,r=e.atom_site,n=r.label_asym_id,i=r.auth_asym_id,a=r.label_entity_id,o=0,s=n.rowCount;o<s;++o){var u=n.value(o);t.has(u)||t.set(u,{id:u,auth_id:i.value(o),entity_id:a.value(o)})}if(e.struct_asym._rowCount>0)for(var l=e.struct_asym,u=l.id,c=l.entity_id,o=0,s=u.rowCount;o<s;++o){var d=u.value(o);t.has(d)||t.set(d,{id:d,auth_id:"",entity_id:c.value(o)})}return t}function y8e(e){return{missingResidues:h8e(e),chemicalComponentMap:v8e(e),saccharideComponentMap:m8e(e),structAsymMap:g8e(e)}}var b8e=ve.Schema.Aliased(ve.Schema.Str(""));function eee(e,t){var r,n;if(e.entity.id.isDefined)n=e.entity;else{for(var i=new Set,a=[],o=[],s=e.atom_site,u=s.label_entity_id,l=s.label_comp_id,c=0,d=e.atom_site._rowCount;c<d;c++){var f=u.value(c);i.has(f)||(a.push(f),o.push(Oke(l.value(c))),i.add(f))}for(var p=e.ihm_sphere_obj_site.entity_id,c=0,d=e.ihm_sphere_obj_site._rowCount;c<d;c++){var f=p.value(c);i.has(f)||(a.push(f),o.push("polymer"),i.add(f))}for(var v=e.ihm_gaussian_obj_site.entity_id,c=0,d=e.ihm_gaussian_obj_site._rowCount;c<d;c++){var f=v.value(c);i.has(f)||(a.push(f),o.push("polymer"),i.add(f))}n=Qr.ofPartialColumns(to.entity,{id:ve.ofArray({array:a,schema:to.entity.id}),type:ve.ofArray({array:o,schema:to.entity.type})},a.length)}var h=ve.createIndexer(n.id),m=new Array(n._rowCount);m.fill("other");var g=new Set,y=!1;if(e.entity_poly&&e.entity_poly.type.isDefined)for(var b=e.entity_poly,S=b.entity_id,x=b.type,C=b._rowCount,c=0;c<C;++c){var f=S.value(c);m[h(f)]=x.value(c),g.add(f)}else y=!0;if(e.pdbx_entity_branch&&e.pdbx_entity_branch.entity_id.isDefined)for(var w=e.pdbx_entity_branch,S=w.entity_id,x=w.type,C=w._rowCount,c=0;c<C;++c){var f=S.value(c);m[h(f)]=x.value(c),g.add(f)}else y=!0;if(g.size<m.length&&(y=!0),y){var A=new Map;if(e.chem_comp)for(var M=e.chem_comp,D=M.id,x=M.type,c=0,d=e.chem_comp._rowCount;c<d;c++)A.set(D.value(c),x.value(c));if(e.atom_site)for(var k=e.atom_site,u=k.label_entity_id,l=k.label_comp_id,c=0,d=e.atom_site._rowCount;c<d;c++){var f=u.value(c);if(!g.has(f)){var R=l.value(c),O=A.get(R)||"";m[h(f)]=Lke(R,O),g.add(f)}}}var H=ve.ofArray({array:m,schema:b8e}),B=new Array(n._rowCount);if(B.fill(""),e.pdbx_molecule&&e.pdbx_molecule.prd_id.isDefined)for(var j=e.pdbx_molecule,Y=j.asym_id,G=j.prd_id,C=j._rowCount,c=0;c<C;++c){var $=Y.value(c),f=(r=t.structAsymMap.get($))===null||r===void 0?void 0:r.entity_id;f!==void 0&&(B[h(f)]=G.value(c))}var q=ve.ofArray({array:B,schema:ve.Schema.str});return{data:n,subtype:H,prd_id:q,getEntityIndex:h}}function x8e(e,t){var r=t.ihm_model_group,n=t.ihm_model_group_link,i=Qr.pickRow(n,function(o){return n.model_id.value(o)===e});if(i){var a=Qr.pickRow(r,function(o){return r.id.value(o)===i.group_id});if(a)return a.name}return""}var vv=function(){function e(t){this.frames=t,this.frameCount=t.length,this.representative=t[0],this.duration=t.length}return e.prototype.getFrameAtIndex=function(t){return this.frames[t]},e}();function xd(e,t,r){return ce(this,void 0,void 0,function(){var n,i,a,o;return de(this,function(s){switch(s.label){case 0:return n=y8e(e),e.ihm_model_list._rowCount>0?[4,w8e(r,e,n,t)]:[3,2];case 1:return a=s.sent(),[3,4];case 2:return[4,_8e(r,e,n,t)];case 3:a=s.sent(),s.label=4;case 4:for(i=a,o=0;o<i.length;o++)$t.TrajectoryInfo.set(i[o],{index:o,size:i.length});return[2,new vv(i)]}})})}function S8e(e,t,r,n,i,a,o){var s=XJ(t,r,n,i.chemicalComponentMap,a,o),u=t.pdbx_PDB_model_num.value(0);if(o&&s.sameAsPrevious)return E(E({},o),{id:mn.create22(),modelNum:u,atomicConformation:s.conformation,_dynamicPropertyData:Object.create(null)});var l=YJ,c=KJ(e,n,s.hierarchy,l.hierarchy),d=ZJ(s.hierarchy,n,s.conformation,c),f=e.entry.id.valueKind(0)===0?e.entry.id.value(0):a.name,p=[];return f&&p.push(f),e.struct.title.valueKind(0)===0&&p.push(e.struct.title.value(0)),{id:mn.create22(),entryId:f,label:p.join(" | "),entry:f,sourceData:a,modelNum:u,parent:void 0,entities:n,sequence:c,atomicHierarchy:s.hierarchy,atomicConformation:s.conformation,atomicRanges:d,atomicChainOperatorMappinng:s.chainOperatorMapping,coarseHierarchy:l.hierarchy,coarseConformation:l.conformation,properties:i,customProperties:new Hl,_staticPropertyData:Object.create(null),_dynamicPropertyData:Object.create(null)}}function C8e(e,t,r,n){var i=XJ(t.atom_site,t.atom_site_sourceIndex,t.entities,r.chemicalComponentMap,n),a=s8e(t,r),o=KJ(e,t.entities,i.hierarchy,a.hierarchy),s=ZJ(i.hierarchy,t.entities,i.conformation,o),u=e.entry.id.valueKind(0)===0?e.entry.id.value(0):n.name,l=[];return u&&l.push(u),e.struct.title.valueKind(0)===0&&l.push(e.struct.title.value(0)),t.model_name&&l.push(t.model_name),t.model_group_name&&l.push(t.model_group_name),{id:mn.create22(),entryId:u,label:l.join(" | "),entry:u,sourceData:n,modelNum:t.model_id,parent:void 0,entities:t.entities,sequence:o,atomicHierarchy:i.hierarchy,atomicConformation:i.conformation,atomicRanges:s,atomicChainOperatorMappinng:i.chainOperatorMapping,coarseHierarchy:a.hierarchy,coarseConformation:a.conformation,properties:r,customProperties:new Hl,_staticPropertyData:Object.create(null),_dynamicPropertyData:Object.create(null)}}function tee(e,t){var r=e.rowCount;if(!e.isDefined)return r;for(var n=t+1;n<r&&e.areValuesEqual(t,n);)n++;return n}function _8e(e,t,r,n){return ce(this,void 0,void 0,function(){var i,a,o,s,u,l,c,d,f;return de(this,function(p){switch(p.label){case 0:if(i=[],!t.atom_site)return[3,3];a=t.atom_site.id.rowCount,o=eee(t,r),s=0,p.label=1;case 1:return s<a?(u=tee(t.atom_site.pdbx_PDB_model_num,s),[4,QJ(e,t.atom_site,s,u)]):[3,3];case 2:return l=p.sent(),c=l.atom_site,d=l.sourceIndex,f=S8e(t,c,d,o,r,n,i.length>0?i[i.length-1]:void 0),i.push(f),s=u,[3,1];case 3:return[2,i]}})})}function L4(e,t){for(var r=new Map,n=e._rowCount,i=0;i<n;){var a=tee(t,i),o=t.value(i);r.set(o,{table:Qr.window(e,e._schema,i,a),start:i,end:a}),i=a}return r}function w8e(e,t,r,n){return ce(this,void 0,void 0,function(){var i,a,o,s,u,l,c,d,f,p,v,h,m,g,y,b,S,x,C;return de(this,function(w){switch(w.label){case 0:if(i=eee(t,r),a=t.atom_site.ihm_model_id.isDefined?t.atom_site.ihm_model_id:t.atom_site.pdbx_PDB_model_num,o=L4(t.atom_site,a),s=L4(t.ihm_sphere_obj_site,t.ihm_sphere_obj_site.model_id),u=L4(t.ihm_gaussian_obj_site,t.ihm_gaussian_obj_site.model_id),l=[],!t.ihm_model_list)return[3,6];c=t.ihm_model_list,d=c.model_id,f=c.model_name,p=0,w.label=1;case 1:return p<t.ihm_model_list._rowCount?(v=d.value(p),h=void 0,m=void 0,o.has(v)?(g=o.get(v),[4,QJ(e,t.atom_site,g.start,g.end)]):[3,3]):[3,6];case 2:return y=w.sent(),b=y.atom_site,S=y.sourceIndex,h=b,m=S,[3,4];case 3:h=Qr.window(t.atom_site,t.atom_site._schema,0,0),m=ve.ofIntArray([]),w.label=4;case 4:x={model_id:v,model_name:f.value(p),model_group_name:x8e(v,t),entities:i,atom_site:h,atom_site_sourceIndex:m,ihm_sphere_obj_site:s.has(v)?s.get(v).table:Qr.window(t.ihm_sphere_obj_site,t.ihm_sphere_obj_site._schema,0,0),ihm_gaussian_obj_site:u.has(v)?u.get(v).table:Qr.window(t.ihm_gaussian_obj_site,t.ihm_gaussian_obj_site._schema,0,0)},C=C8e(t,x,r,n),l.push(C),w.label=5;case 5:return p++,[3,1];case 6:return[2,l]}})})}var mv;(function(e){function t(n){var i=this,a=n.descriptor.name,o=n.type==="static"?"_staticPropertyData":"_dynamicPropertyData",s=function(l){return a in l[o]||(l[o][a]={props:E({},I.getDefaultValues(n.getParams(l))),data:up.create(void 0)}),l[o][a]},u=function(l,c,d){var f=s(l);l[o][a]={props:c,data:up.withValue(f.data,d)}};return{label:n.label,descriptor:n.descriptor,isHidden:n.isHidden,getParams:function(l){var c=I.clone(n.getParams(l));return I.setDefaultValues(c,s(l).props),c},defaultParams:n.defaultParams,isApplicable:n.isApplicable,attach:function(l,c,d,f){return d===void 0&&(d={}),ce(i,void 0,void 0,function(){var p,v,h,m,g;return de(this,function(y){switch(y.label){case 0:return f&&c.customProperties.reference(n.descriptor,!0),p=s(c),v=I.merge(n.defaultParams,p.props,d),p.data.value&&I.areEqual(n.defaultParams,p.props,v)?[2]:[4,n.obtain(l,c,v)];case 1:return h=y.sent(),m=h.value,g=h.assets,c.customProperties.add(n.descriptor),c.customProperties.assets(n.descriptor,g),u(c,v,m),[2]}})})},ref:function(l,c){return l.customProperties.reference(n.descriptor,c)},get:function(l){var c;return(c=s(l))===null||c===void 0?void 0:c.data},set:function(l,c){c===void 0&&(c={});var d=s(l),f=I.merge(n.defaultParams,d.props,c);I.areEqual(n.defaultParams,d.props,f)||(u(l,f,void 0),l.customProperties.assets(n.descriptor))},props:function(l){return s(l).props}}}e.createProvider=t;function r(n,i,a){var o=this,s={value:I.Value(a,{isHidden:!0})};return t({label:Zo(n),descriptor:To({name:n}),isHidden:!0,type:i,defaultParams:s,getParams:function(){return{value:I.Value(a,{isHidden:!0})}},isApplicable:function(){return!0},obtain:function(u,l,c){return ce(o,void 0,void 0,function(){var d;return de(this,function(f){return[2,{value:(d=c.value)!==null&&d!==void 0?d:a}]})})}})}e.createSimple=r})(mv||(mv={}));var $t;(function(e){function t(B,j){for(var Y=[],G=j.frames,$=B.atomicHierarchy.atomSourceIndex,q=ve.isIdentity($),ee=q?void 0:$.toArray({array:Int32Array}),fe=0,W=G.length;fe<W;++fe){var X=G[fe],U=E(E({},B),{id:mn.create22(),modelNum:fe,atomicConformation:Sb.getAtomicConformation(X,B.atomicConformation.atomId,ee),customProperties:new Hl,_staticPropertyData:Object.create(null),_dynamicPropertyData:Object.create(null)});if(X.cell){var z=fi.fromCell(X.cell.size,X.cell.anglesInRadians);fi.Provider.set(U,z)}e.TrajectoryInfo.set(U,{index:fe,size:G.length}),Y.push(U)}return{trajectory:Y,srcIndexArray:ee}}function r(B,j){return new vv(t(B,j).trajectory)}e.trajectoryFromModelAndCoordinates=r;function n(B,j){var Y=this;return $e.create("Create Trajectory",function(G){return ce(Y,void 0,void 0,function(){var $,q,ee,fe,W,X,U,z,J;return de(this,function(K){switch(K.label){case 0:return[4,xd(B.basic,B.sourceData,G)];case 1:if($=K.sent(),$.frameCount===0)throw new Error("found no model");for(q=$.representative,ee=t(q,j).trajectory,fe={pairs:B.bonds,count:q.atomicHierarchy.atoms._rowCount},W=xa.fromData(fe),X=0,U=0,z=ee;U<z.length;U++)J=z[U],xa.Provider.set(J,W),e.TrajectoryInfo.set(J,{index:X++,size:ee.length});return[2,new vv(ee)]}})})})}e.trajectoryFromTopologyAndCoordinates=n;var i="__Center__";function a(B){if(B._dynamicPropertyData[i])return B._dynamicPropertyData[i];var j=KRe(B.atomicConformation,B.coarseConformation);return B._dynamicPropertyData[i]=j,j}e.getCenter=a;function o(B){for(var j=new Int32Array(B.rowCount),Y=!1,G=0,$=B.rowCount;G<$;G++){var q=B.value(G);q!==G&&(Y=!1),j[q]=G}return{isIdentity:Y,invertedIndex:j}}var s="__InvertedAtomSrcIndex__";function u(B){if(B._staticPropertyData[s])return B._staticPropertyData[s];var j=o(B.atomicHierarchy.atomSourceIndex);return B._staticPropertyData[s]=j,j}e.getInvertedAtomSourceIndex=u;var l="__TrajectoryInfo__";e.TrajectoryInfo={get:function(B){return B._dynamicPropertyData[l]||{index:0,size:1}},set:function(B,j){return B._dynamicPropertyData[l]=j}};var c="__AsymIdCount__";e.AsymIdCount={get:function(B){if(B._dynamicPropertyData[c])return B._dynamicPropertyData[c];var j=QRe(B);return B._dynamicPropertyData[c]=j,j}},e.AsymIdOffset=mv.createSimple("asym_id_offset","static"),e.Index=mv.createSimple("index","static");function d(B){return B.parent||B}e.getRoot=d;function f(B,j){return B.atomicHierarchy===j.atomicHierarchy&&B.coarseHierarchy===j.coarseHierarchy}e.areHierarchiesEqual=f;var p="__CoordinatesHistory__";e.CoordinatesHistory={get:function(B){return B._staticPropertyData[p]},set:function(B,j){return B._staticPropertyData[p]=j}};var v="__CoarseGrained__";function h(B){if(B._staticPropertyData[v]!==void 0)return B._staticPropertyData[v];for(var j=0,Y=B.atomicHierarchy.derived.residue.polymerType,G=0;G<Y.length;++G)Y[G]!==0&&(j+=1);for(var $=!1,q=!1,ee=B.atomicHierarchy.atoms,fe=ee.label_atom_id,W=ee._rowCount,G=0;G<W;++G){var X=fe.value(G);if(!$&&X==="BB"&&($=!0),!q&&X==="SC1"&&(q=!0),$&&q)break}var U=$&&q||(j&&W?W/j<3:!1);return B._staticPropertyData[v]=U,U}e.isCoarseGrained=h;function m(B){return B.properties.saccharideComponentMap.size>0}e.hasCarbohydrate=m;function g(B){for(var j=B.entities.subtype,Y=0,G=j.rowCount;Y<G;++Y)if(j.value(Y).startsWith("polypeptide"))return!0;return!1}e.hasProtein=g;function y(B){for(var j=B.entities.subtype,Y=0,G=j.rowCount;Y<G;++Y){var $=j.value(Y);if($.endsWith("ribonucleotide hybrid")||$.endsWith("ribonucleotide"))return!0}return!1}e.hasNucleic=y;function b(B){if(!an.is(B.sourceData))return!1;var j=B.sourceData.data.db;return j.database_2.database_id.isDefined||B.entryId.match(/^[1-9][a-z0-9]{3,3}$/i)!==null||B.entryId.match(/^pdb_[0-9]{4,4}[1-9][a-z0-9]{3,3}$/i)!==null}e.isFromPdbArchive=b;function S(B){if(!an.is(B.sourceData))return!1;var j=B.sourceData.data.db;return j.struct_conf.id.isDefined||j.struct_sheet_range.id.isDefined}e.hasSecondaryStructure=S;var x=_.create(1.5707963,1.5707963,1.5707963),C=_.create(1,1,1);function w(B){var j,Y=(j=fi.Provider.get(B))===null||j===void 0?void 0:j.spacegroup;return!!Y&&!(Y.num===1&&_.equals(Y.cell.anglesInRadians,x)&&_.equals(Y.cell.size,C))}e.hasCrystalSymmetry=w;function A(B){if(!an.is(B.sourceData))return!1;for(var j=B.sourceData.data.db,Y=0;Y<j.exptl.method.rowCount;Y++){var G=j.exptl.method.value(Y).toUpperCase();if(G.indexOf("DIFFRACTION")>=0)return!0}return!1}e.isFromXray=A;function M(B){if(!an.is(B.sourceData))return!1;for(var j=B.sourceData.data.db,Y=0;Y<j.exptl.method.rowCount;Y++){var G=j.exptl.method.value(Y).toUpperCase();if(G.indexOf("MICROSCOPY")>=0)return!0}return!1}e.isFromEm=M;function D(B){if(!an.is(B.sourceData))return!1;for(var j=B.sourceData.data.db,Y=0;Y<j.exptl.method.rowCount;Y++){var G=j.exptl.method.value(Y).toUpperCase();if(G.indexOf("NMR")>=0)return!0}return!1}e.isFromNmr=D;function k(B){if(!an.is(B.sourceData)||!A(B))return!1;var j=B.sourceData.data.db,Y=j.pdbx_database_status.status_code_sf;return Y.isDefined&&Y.value(0)==="REL"}e.hasXrayMap=k;function R(B){if(!an.is(B.sourceData))return!1;for(var j=B.sourceData.data.db,Y=j.pdbx_database_related,G=Y.db_name,$=Y.content_type,q=0,ee=j.pdbx_database_related._rowCount;q<ee;++q)if(G.value(q).toUpperCase()==="EMDB"&&$.value(q)==="associated EM volume")return!0;return!1}e.hasEmMap=R;function O(B){return an.is(B.sourceData)?k(B)||R(B):!1}e.hasDensityMap=O;function H(B){if(!an.is(B.sourceData))return!1;var j=B.sourceData.data.db;return O(B)||b(B)&&(!j.exptl.method.isDefined||A(B)&&(!j.pdbx_database_status.status_code_sf.isDefined||j.pdbx_database_status.status_code_sf.valueKind(0)===2)||M(B)&&!j.pdbx_database_related.db_name.isDefined)}e.probablyHasDensityMap=H})($t||($t={}));var gD;(function(e){function t(d,f,p){if(!f)return{rowCount:0};if(p&&p[f.id])return p[f.id];var v=f.getElements(d),h={data:v,rowCount:v.elements.length};return p&&(p[f.id]=h),h}e.getCifDataSource=t;function r(d){return new bj(d)}e.fromAtomMap=r;function n(d){return new bj(F4(d))}e.fromAtomArray=n;var i=function(d){return d.atomicHierarchy.residueAtomSegments};function a(d){return new Mx("residue",d,i,0)}e.fromResidueMap=a;function o(d){return new Mx("residue",F4(d),i,0)}e.fromResidueArray=o;var s=function(d){return d.atomicHierarchy.chainAtomSegments};function u(d){return new Mx("chain",d,s,0)}e.fromChainMap=u;function l(d){return new Mx("chain",F4(d),s,0)}e.fromChainArray=l;function c(d){return new E8e(d)}e.fromEntityMap=c})(gD||(gD={}));function F4(e){for(var t=new Map,r=0,n=e.length;r<n;r++)t.set(r,e[r]);return t}var Mx=function(){function e(t,r,n,i){this.level=t,this.map=r,this.segmentGetter=n,this.id=mn.create22(),this.kind=i}return e.prototype.has=function(t){return this.map.has(t)},e.prototype.get=function(t){return this.map.get(t)},e.prototype.getStructureElements=function(t){var r=t.models;if(r.length!==1)throw new Error("Only works on structures with a single model.");for(var n=new Set,i=t.unitSymmetryGroups,a=[],o=this.segmentGetter(r[0]),s=0,u=i;s<u.length;s++){var l=u[s],c=l.units[0];if(c.kind===this.kind)for(var d=nr.transientSegments(o,c.elements);d.hasNext;){var f=d.move();!this.has(f.index)||n.has(f.index)||(n.add(f.index),a[a.length]=Ze.create(t,c,c.elements[f.start]))}}return a.sort(function(p,v){return p.element-v.element}),a},e.prototype.getElements=function(t){var r=this,n=this.segmentGetter(t.model).index,i=this.getStructureElements(t);return{elements:i,property:function(a){return r.get(n[i[a].element])}}},e}(),bj=function(){function e(t){this.map=t,this.id=mn.create22(),this.level="atom",this.kind=0}return e.prototype.has=function(t){return this.map.has(t)},e.prototype.get=function(t){return this.map.get(t)},e.prototype.getStructureElements=function(t){var r=t.models;if(r.length!==1)throw new Error("Only works on structures with a single model.");for(var n=new Set,i=t.unitSymmetryGroups,a=[],o=0,s=i;o<s.length;o++){var u=s[o],l=u.units[0];if(l.kind===this.kind)for(var c=l.elements,d=0,f=c.length;d<f;d++){var p=c[d];!this.has(p)||n.has(p)||(n.add(c[d]),a[a.length]=Ze.create(t,l,p))}}return a.sort(function(v,h){return v.element-h.element}),a},e.prototype.getElements=function(t){var r=this,n=this.getStructureElements(t);return{elements:n,property:function(i){return r.get(n[i].element)}}},e}(),E8e=function(){function e(t){this.map=t,this.id=mn.create22(),this.level="entity",this.kind=0}return e.prototype.has=function(t){return this.map.has(t)},e.prototype.get=function(t){return this.map.get(t)},e.prototype.getStructureElements=function(t){var r=t.models;if(r.length!==1)throw new Error("Only works on structures with a single model.");for(var n=r[0].atomicHierarchy.index,i=new Set,a=t.unitSymmetryGroups,o=[],s=r[0].atomicHierarchy.chainAtomSegments,u=0,l=a;u<l.length;u++){var c=l[u],d=c.units[0];if(d.kind===this.kind)for(var f=nr.transientSegments(s,d.elements);f.hasNext;){var p=f.move(),v=n.getEntityFromChain(p.index);!this.has(v)||i.has(v)||(i.add(v),o[o.length]=Ze.create(t,d,d.elements[p.start]))}}return o.sort(function(h,m){return h.element-m.element}),o},e.prototype.getElements=function(t){var r=this,n=this.getStructureElements(t),i=t.model.atomicHierarchy.chainAtomSegments.index,a=t.model.atomicHierarchy.index;return{elements:n,property:function(o){return r.get(a.getEntityFromChain(i[n[o].element]))}}},e}(),A8e=function(){function e(){this.map=new Map}return e.prototype.removeSymbol=function(t){this.map.delete(t.symbol.id)},e.prototype.addSymbol=function(t){this.map.has(t.symbol.id)&&console.warn("Symbol '"+t.symbol.id+"' already added. Call removeSymbol/removeCustomProps re-adding the symbol."),this.map.set(t.symbol.id,t)},e.prototype.addCustomProp=function(t){if(t.symbols)for(var r=0,n=Object.keys(t.symbols);r<n.length;r++){var i=n[r];this.addSymbol(t.symbols[i])}},e.prototype.removeCustomProp=function(t){if(t.symbols)for(var r=0,n=Object.keys(t.symbols);r<n.length;r++){var i=n[r];this.removeSymbol(t.symbols[i])}},e.prototype.getRuntime=function(t){return this.map.get(t)},e}(),Z_=new A8e,P8e=function(){function e(t){this.table=t,this.constQueryContext=new us(We.Empty)}return e}(),xj;(function(e){function t(n){return{kind:"const",value:n}}e.Const=t;function r(n){return{kind:"dynamic",runtime:n}}e.Dynamic=r})(xj||(xj={}));var jh;(function(e){function t(n){return{isConst:!0,fn:function(a){return n}}}e.Const=t;function r(n){return{isConst:!1,fn:n}}e.Dynamic=r})(jh||(jh={}));var C1;(function(e){function t(r,n,i,a){if(typeof r.length=="number")for(var o=0,s=r.length;o<s;o++)i(r[o](n),o,a);else for(var o=0,u=0,l=Object.keys(r);u<l.length;u++){var c=l[u];i(r[c](n),o++,a)}return a}e.forEachEval=t})(C1||(C1={}));var Kg;(function(e){function t(n,i){return new Sj(n,i,!0)}e.Const=t;function r(n,i){return new Sj(n,i,!1)}e.Dynamic=r})(Kg||(Kg={}));var Sj=function(){function e(t,r,n){this.symbol=t,this.fn=r,this.isConst=n}return e.prototype.compile=function(t,r){var n,i=!1;if(!r)n=void 0,i=!0;else if(Ii.isArgumentsArray(r)){n=[],i=!1;for(var a=0,o=r;a<o.length;a++){var s=o[a],u=yD(t,s);i=i&&u.isConst,n.push(u.fn)}}else{n=Object.create(null),i=!1;for(var l=0,c=Object.keys(r);l<c.length;l++){var d=c[l],u=yD(t,r[d]);i=i&&u.isConst,n[d]=u.fn}}return this.isConst?this.isConst&&i?jh.Const(this.fn(t.constQueryContext,n)):jh.Dynamic(Cj(this.fn,n)):jh.Dynamic(Cj(this.fn,n))},e}();function Cj(e,t){return function(n){return e(n,t)}}function yD(e,t){if(Ii.isLiteral(t))return jh.Const(t);if(Ii.isSymbol(t)){var r=e.table.getRuntime(t.name);return r?r.compile(e):jh.Const(t.name)}if(!Ii.isSymbol(t.head))throw new Error("Can only apply symbols.");var n=e.table.getRuntime(t.head.name);if(!n)throw new Error("Symbol '"+t.head.name+"' is not implemented.");return n.compile(e,t.args)}function gv(e){var t=new P8e(Z_);return yD(t,e).fn}var Zt=Kg.Const,Ut=Kg.Dynamic,T8e=[Zt(Ce.core.type.bool,function(t,r){return!!r[0](t)}),Zt(Ce.core.type.num,function(t,r){return+r[0](t)}),Zt(Ce.core.type.str,function(t,r){return""+r[0](t)}),Zt(Ce.core.type.list,function(t,r){return C1.forEachEval(r,t,function(n,i,a){return a[i]=n},[])}),Zt(Ce.core.type.set,function(t,r){return C1.forEachEval(r,t,function(i,a,o){return o.add(i)},new Set)}),Zt(Ce.core.type.regex,function(t,r){return new RegExp(r[0](t),r[1]&&r[1](t)||"")}),Zt(Ce.core.type.bitflags,function(t,r){return+r[0](t)}),Zt(Ce.core.type.compositeKey,function(t,r){return C1.forEachEval(r,t,function(n,i,a){return a[i]=""+n},[]).join("-")}),Zt(Ce.core.logic.not,function(e,t){return!t[0](e)}),Zt(Ce.core.logic.and,function(e,t){if(typeof t.length=="number"){for(var r=0,n=t.length;r<n;r++)if(!t[r](e))return!1}else for(var i=0,a=Object.keys(t);i<a.length;i++){var o=a[i];if(!t[o](e))return!1}return!0}),Zt(Ce.core.logic.or,function(e,t){if(typeof t.length=="number"){for(var r=0,n=t.length;r<n;r++)if(t[r](e))return!0}else for(var i=0,a=Object.keys(t);i<a.length;i++){var o=a[i];if(t[o](e))return!0}return!1}),Zt(Ce.core.rel.eq,function(e,t){return t[0](e)===t[1](e)}),Zt(Ce.core.rel.neq,function(e,t){return t[0](e)!==t[1](e)}),Zt(Ce.core.rel.lt,function(e,t){return t[0](e)<t[1](e)}),Zt(Ce.core.rel.lte,function(e,t){return t[0](e)<=t[1](e)}),Zt(Ce.core.rel.gr,function(e,t){return t[0](e)>t[1](e)}),Zt(Ce.core.rel.gre,function(e,t){return t[0](e)>=t[1](e)}),Zt(Ce.core.rel.inRange,function(e,t){var r=t[0](e);return r>=t[1](e)&&r<=t[2](e)}),Zt(Ce.core.math.add,function(e,t){var r=0;if(typeof t.length=="number")for(var n=0,i=t.length;n<i;n++)r+=t[n](e);else for(var a=0,o=Object.keys(t);a<o.length;a++){var s=o[a];r+=t[s](e)}return r}),Zt(Ce.core.math.sub,function(e,t){var r=0;if(typeof t.length=="number"){if(t.length===1)return-t[0](e);r=t[0](e)||0;for(var n=1,i=t.length;n<i;n++)r-=t[n](e)}else{var a=Object.keys(t);if(a.length===1)return-t[a[0]](e);r=t[a[0]](e)||0;for(var n=1,i=a.length;n<i;n++)r-=t[a[n]](e)}return r}),Zt(Ce.core.math.mult,function(e,t){var r=1;if(typeof t.length=="number")for(var n=0,i=t.length;n<i;n++)r*=t[n](e);else for(var a=0,o=Object.keys(t);a<o.length;a++){var s=o[a];r*=t[s](e)}return r}),Zt(Ce.core.math.div,function(e,t){return t[0](e)/t[1](e)}),Zt(Ce.core.math.pow,function(e,t){return Math.pow(t[0](e),t[1](e))}),Zt(Ce.core.math.mod,function(e,t){return t[0](e)%t[1](e)}),Zt(Ce.core.math.min,function(e,t){var r=Number.POSITIVE_INFINITY;if(typeof t.length=="number")for(var n=0,i=t.length;n<i;n++)r=Math.min(t[n](e),r);else for(var a=0,o=Object.keys(t);a<o.length;a++){var s=o[a];r=Math.min(t[s](e),r)}return r}),Zt(Ce.core.math.max,function(e,t){var r=Number.NEGATIVE_INFINITY;if(typeof t.length=="number")for(var n=0,i=t.length;n<i;n++)r=Math.max(t[n](e),r);else for(var a=0,o=Object.keys(t);a<o.length;a++){var s=o[a];r=Math.max(t[s](e),r)}return r}),Zt(Ce.core.math.floor,function(e,t){return Math.floor(t[0](e))}),Zt(Ce.core.math.ceil,function(e,t){return Math.ceil(t[0](e))}),Zt(Ce.core.math.roundInt,function(e,t){return Math.round(t[0](e))}),Zt(Ce.core.math.abs,function(e,t){return Math.abs(t[0](e))}),Zt(Ce.core.math.sqrt,function(e,t){return Math.sqrt(t[0](e))}),Zt(Ce.core.math.cbrt,function(e,t){return Math.cbrt(t[0](e))}),Zt(Ce.core.math.sin,function(e,t){return Math.sin(t[0](e))}),Zt(Ce.core.math.cos,function(e,t){return Math.cos(t[0](e))}),Zt(Ce.core.math.tan,function(e,t){return Math.tan(t[0](e))}),Zt(Ce.core.math.asin,function(e,t){return Math.asin(t[0](e))}),Zt(Ce.core.math.acos,function(e,t){return Math.acos(t[0](e))}),Zt(Ce.core.math.atan,function(e,t){return Math.atan(t[0](e))}),Zt(Ce.core.math.sinh,function(e,t){return Math.sinh(t[0](e))}),Zt(Ce.core.math.cosh,function(e,t){return Math.cosh(t[0](e))}),Zt(Ce.core.math.tanh,function(e,t){return Math.tanh(t[0](e))}),Zt(Ce.core.math.exp,function(e,t){return Math.exp(t[0](e))}),Zt(Ce.core.math.log,function(e,t){return Math.log(t[0](e))}),Zt(Ce.core.math.log10,function(e,t){return Math.log10(t[0](e))}),Zt(Ce.core.math.atan2,function(e,t){return Math.atan2(t[0](e),t[1](e))}),Zt(Ce.core.str.match,function(e,t){return t[0](e).test(t[1](e))}),Zt(Ce.core.str.concat,function(e,t){var r=[];if(typeof t.length=="number")for(var n=0,i=t.length;n<i;n++)r.push(t[n](e).toString());else for(var a=0,o=Object.keys(t);a<o.length;a++){var s=o[a];r.push(t[s](e).toString())}return r.join("")}),Zt(Ce.core.list.getAt,function(e,t){return t[0](e)[t[1](e)]}),Zt(Ce.core.list.equal,function(e,t){return sL(t[0](e),t[1](e))}),Zt(Ce.core.set.has,function(t,r){return r[0](t).has(r[1](t))}),Zt(Ce.core.set.isSubset,function(t,r){return hi.isSuperset(r[1](t),r[0](t))}),Zt(Ce.core.flags.hasAny,function(e,t){var r=t[1](e),n=t[0](e);return r?(n&r)!==0:!!n}),Zt(Ce.core.flags.hasAll,function(e,t){var r=t[1](e),n=t[0](e);return r?(n&r)===r:!n}),Zt(Ce.structureQuery.type.elementSymbol,function(e,t){return x0(t[0](e))}),Zt(Ce.structureQuery.type.atomName,function(e,t){return M4e(t[0](e))}),Zt(Ce.structureQuery.type.bondFlags,function(e,t){var r=0;if(typeof t.length=="number")for(var n=0,i=t.length;n<i;n++)r=_j(r,t[n](e));else for(var a=0,o=Object.keys(t);a<o.length;a++){var s=o[a];r=_j(r,t[s](e))}return r}),Zt(Ce.structureQuery.type.ringFingerprint,function(e,t){return Bs.elementFingerprint(I8e(e,t))}),Zt(Ce.structureQuery.type.secondaryStructureFlags,function(e,t){var r=0;if(typeof t.length=="number")for(var n=0,i=t.length;n<i;n++)r=wj(r,t[n](e));else for(var a=0,o=Object.keys(t);a<o.length;a++){var s=o[a];r=wj(r,t[s](e))}return r}),Ut(Ce.structureQuery.filter.pick,function(e,t){return nn.filters.pick(t[0],t.test)(e)}),Ut(Ce.structureQuery.filter.first,function(e,t){return nn.filters.first(t[0])(e)}),Ut(Ce.structureQuery.filter.withSameAtomProperties,function(e,t){return nn.filters.withSameAtomProperties(t[0],t.source,t.property)(e)}),Ut(Ce.structureQuery.filter.intersectedBy,function(e,t){return nn.filters.areIntersectedBy(t[0],t.by)(e)}),Ut(Ce.structureQuery.filter.within,function(e,t){return nn.filters.within({query:t[0],target:t.target,minRadius:t["min-radius"],maxRadius:t["max-radius"],elementRadius:t["atom-radius"],invert:t.invert})(e)}),Ut(Ce.structureQuery.filter.isConnectedTo,function(e,t){return nn.filters.isConnectedTo({query:t[0],target:t.target,disjunct:t.disjunct,invert:t.invert,bondTest:t["bond-test"]})(e)}),Ut(Ce.structureQuery.generator.atomGroups,function(t,r){return nn.generators.atoms({entityTest:r["entity-test"],chainTest:r["chain-test"],residueTest:r["residue-test"],atomTest:r["atom-test"],groupBy:r["group-by"]})(t)}),Ut(Ce.structureQuery.generator.all,function(t){return nn.generators.all(t)}),Ut(Ce.structureQuery.generator.empty,function(t){return nn.generators.none(t)}),Ut(Ce.structureQuery.generator.bondedAtomicPairs,function(t,r){return nn.generators.bondedAtomicPairs(r&&r[0])(t)}),Ut(Ce.structureQuery.generator.rings,function(t,r){var n,i;return nn.generators.rings((n=r==null?void 0:r.fingerprint)===null||n===void 0?void 0:n.call(r,t),(i=r==null?void 0:r["only-aromatic"])===null||i===void 0?void 0:i.call(r,t))(t)}),Ut(Ce.structureQuery.modifier.includeSurroundings,function(t,r){return nn.modifiers.includeSurroundings(r[0],{radius:r.radius(t),wholeResidues:!!(r["as-whole-residues"]&&r["as-whole-residues"](t)),elementRadius:r["atom-radius"]})(t)}),Ut(Ce.structureQuery.modifier.surroundingLigands,function(t,r){return nn.modifiers.surroundingLigands({query:r[0],radius:r.radius(t),includeWater:!!(r["include-water"]&&r["include-water"](t))})(t)}),Ut(Ce.structureQuery.modifier.wholeResidues,function(t,r){return nn.modifiers.wholeResidues(r[0])(t)}),Ut(Ce.structureQuery.modifier.union,function(t,r){return nn.modifiers.union(r[0])(t)}),Ut(Ce.structureQuery.modifier.expandProperty,function(t,r){return nn.modifiers.expandProperty(r[0],r.property)(t)}),Ut(Ce.structureQuery.modifier.exceptBy,function(t,r){return nn.modifiers.exceptBy(r[0],r.by)(t)}),Ut(Ce.structureQuery.modifier.includeConnected,function(t,r){var n,i;return nn.modifiers.includeConnected({query:r[0],bondTest:r["bond-test"],wholeResidues:!!(r["as-whole-residues"]&&r["as-whole-residues"](t)),layerCount:r["layer-count"]&&r["layer-count"](t)||1,fixedPoint:(i=(n=r["fixed-point"])===null||n===void 0?void 0:n.call(r,t))!==null&&i!==void 0?i:!1})(t)}),Ut(Ce.structureQuery.combinator.merge,function(e,t){return nn.combinators.merge(t)(e)}),Ut(Ce.structureQuery.atomProperty.core.elementSymbol,ln(lt.atom.type_symbol)),Ut(Ce.structureQuery.atomProperty.core.vdw,function(e,t){return i2(lt.atom.type_symbol(t&&t[0]&&t[0](e)||e.element))}),Ut(Ce.structureQuery.atomProperty.core.mass,function(e,t){return uke(lt.atom.type_symbol(t&&t[0]&&t[0](e)||e.element))}),Ut(Ce.structureQuery.atomProperty.core.atomicNumber,function(e,t){return a2(lt.atom.type_symbol(t&&t[0]&&t[0](e)||e.element))}),Ut(Ce.structureQuery.atomProperty.core.x,ln(lt.atom.x)),Ut(Ce.structureQuery.atomProperty.core.y,ln(lt.atom.y)),Ut(Ce.structureQuery.atomProperty.core.z,ln(lt.atom.z)),Ut(Ce.structureQuery.atomProperty.core.sourceIndex,ln(lt.atom.sourceIndex)),Ut(Ce.structureQuery.atomProperty.core.operatorName,ln(lt.unit.operator_name)),Ut(Ce.structureQuery.atomProperty.core.modelIndex,ln(lt.unit.model_index)),Ut(Ce.structureQuery.atomProperty.core.modelLabel,ln(lt.unit.model_label)),Ut(Ce.structureQuery.atomProperty.core.atomKey,function(e,t){var r=t&&t[0]&&t[0](e)||e.element;return Qf(r.unit.id,r.element)}),Ut(Ce.structureQuery.atomProperty.macromolecular.residueKey,function(e,t){return $Be(t&&t[0]&&t[0](e)||e.element)}),Ut(Ce.structureQuery.atomProperty.macromolecular.chainKey,function(e,t){return WBe(t&&t[0]&&t[0](e)||e.element)}),Ut(Ce.structureQuery.atomProperty.macromolecular.entityKey,function(e,t){return XBe(t&&t[0]&&t[0](e)||e.element)}),Ut(Ce.structureQuery.atomProperty.macromolecular.id,ln(lt.atom.id)),Ut(Ce.structureQuery.atomProperty.macromolecular.isHet,function(e,t){return lt.residue.group_PDB(t&&t[0]&&t[0](e)||e.element)!=="ATOM"}),Ut(Ce.structureQuery.atomProperty.macromolecular.label_atom_id,ln(lt.atom.label_atom_id)),Ut(Ce.structureQuery.atomProperty.macromolecular.label_alt_id,ln(lt.atom.label_alt_id)),Ut(Ce.structureQuery.atomProperty.macromolecular.label_comp_id,ln(lt.atom.label_comp_id)),Ut(Ce.structureQuery.atomProperty.macromolecular.label_seq_id,ln(lt.residue.label_seq_id)),Ut(Ce.structureQuery.atomProperty.macromolecular.label_asym_id,ln(lt.chain.label_asym_id)),Ut(Ce.structureQuery.atomProperty.macromolecular.label_entity_id,ln(lt.entity.id)),Ut(Ce.structureQuery.atomProperty.macromolecular.auth_atom_id,ln(lt.atom.auth_atom_id)),Ut(Ce.structureQuery.atomProperty.macromolecular.auth_comp_id,ln(lt.atom.auth_comp_id)),Ut(Ce.structureQuery.atomProperty.macromolecular.auth_seq_id,ln(lt.residue.auth_seq_id)),Ut(Ce.structureQuery.atomProperty.macromolecular.auth_asym_id,ln(lt.chain.auth_asym_id)),Ut(Ce.structureQuery.atomProperty.macromolecular.pdbx_PDB_ins_code,ln(lt.residue.pdbx_PDB_ins_code)),Ut(Ce.structureQuery.atomProperty.macromolecular.pdbx_formal_charge,ln(lt.atom.pdbx_formal_charge)),Ut(Ce.structureQuery.atomProperty.macromolecular.occupancy,ln(lt.atom.occupancy)),Ut(Ce.structureQuery.atomProperty.macromolecular.B_iso_or_equiv,ln(lt.atom.B_iso_or_equiv)),Ut(Ce.structureQuery.atomProperty.macromolecular.entityType,ln(lt.entity.type)),Ut(Ce.structureQuery.atomProperty.macromolecular.entitySubtype,ln(lt.entity.subtype)),Ut(Ce.structureQuery.atomProperty.macromolecular.entityPrdId,ln(lt.entity.prd_id)),Ut(Ce.structureQuery.atomProperty.macromolecular.entityDescription,ln(lt.entity.pdbx_description)),Ut(Ce.structureQuery.atomProperty.macromolecular.objectPrimitive,ln(lt.unit.object_primitive)),Ut(Ce.structureQuery.atomProperty.macromolecular.isNonStandard,ln(lt.residue.isNonStandard)),Ut(Ce.structureQuery.atomProperty.macromolecular.secondaryStructureKey,ln(lt.residue.secondary_structure_key)),Ut(Ce.structureQuery.atomProperty.macromolecular.secondaryStructureFlags,ln(lt.residue.secondary_structure_type)),Ut(Ce.structureQuery.atomProperty.macromolecular.chemCompType,ln(lt.residue.chem_comp_type)),Ut(Ce.structureQuery.bondProperty.order,function(e,t){return e.atomicBond.order}),Ut(Ce.structureQuery.bondProperty.flags,function(e,t){return e.atomicBond.type}),Ut(Ce.structureQuery.bondProperty.atomA,function(e,t){return e.atomicBond.a}),Ut(Ce.structureQuery.bondProperty.atomB,function(e,t){return e.atomicBond.b}),Ut(Ce.structureQuery.bondProperty.length,function(e,t){return e.atomicBond.length}),Ut(Ce.internal.generator.bundleElement,function(t,r){return jJ(r.groupedUnits(t),r.ranges(t),r.set(t))}),Ut(Ce.internal.generator.bundle,function(t,r){return zJ(r.elements(t))(t)}),Ut(Ce.internal.generator.current,function(t,r){return t.tryGetCurrentSelection()})];function ln(e){return function(t,r){return e(r&&r[0]&&r[0](t)||t.element)}}function _j(e,t){return e|(Ur.isName(t)?Ur.fromName(t):0)}function wj(e,t){switch(t.toLowerCase()){case"helix":return e|2;case"alpha":return e|2|4096;case"pi":return e|2|32768;case"310":return e|2|2048;case"beta":return e|4;case"strand":return e|4|4194304;case"sheet":return e|4|8388608;case"turn":return e|16;case"bend":return e|8;case"coil":return e|536870912;default:return e}}function I8e(e,t){var r=[];if(!t)return r;if(typeof t.length=="number")for(var n=0,i=t.length;n<i;n++)r.push(t[n](e));else for(var a=Object.keys(t),n=1,i=a.length;n<i;n++)r.push(t[a[n]](e));return r}(function(){for(var e=0,t=T8e;e<t.length;e++){var r=t[e];Z_.addSymbol(r)}})();var Mu;(function(e){function t(s){var u=new DataView(s.buffer);return Object.assign(s.subarray(0),{readInt8:function(l){return u.getInt8(l)},readUInt8:function(l){return u.getUint8(l)},writeInt8:function(l,c){return u.setInt8(c,l)},writeUInt8:function(l,c){return u.setUint8(c,l)},readInt16LE:function(l){return u.getInt16(l,!0)},readInt32LE:function(l){return u.getInt32(l,!0)},readUInt16LE:function(l){return u.getUint16(l,!0)},readUInt32LE:function(l){return u.getUint32(l,!0)},readFloatLE:function(l){return u.getFloat32(l,!0)},readDoubleLE:function(l){return u.getFloat64(l,!0)},writeInt16LE:function(l,c){return u.setInt16(c,l,!0)},writeInt32LE:function(l,c){return u.setInt32(c,l,!0)},writeUInt16LE:function(l,c){return u.setUint16(c,l,!0)},writeUInt32LE:function(l,c){return u.setUint32(c,l,!0)},writeFloatLE:function(l,c){return u.setFloat32(c,l,!0)},writeDoubleLE:function(l,c){return u.setFloat64(c,l,!0)},readInt16BE:function(l){return u.getInt16(l,!1)},readInt32BE:function(l){return u.getInt32(l,!1)},readUInt16BE:function(l){return u.getUint16(l,!1)},readUInt32BE:function(l){return u.getUint32(l,!1)},readFloatBE:function(l){return u.getFloat32(l,!1)},readDoubleBE:function(l){return u.getFloat64(l,!1)},writeInt16BE:function(l,c){return u.setInt16(c,l,!1)},writeInt32BE:function(l,c){return u.setInt32(c,l,!1)},writeUInt16BE:function(l,c){return u.setUint16(c,l,!1)},writeUInt32BE:function(l,c){return u.setUint32(c,l,!1)},writeFloatBE:function(l,c){return u.setFloat32(c,l,!1)},writeDoubleBE:function(l,c){return u.setFloat64(c,l,!1)},copy:function(l,c,d,f){return c=Di(c,0),d=Di(d,0),f=Di(f,s.length),l.set(s.subarray(d,f),c),f-d}})}e.fromUint8Array=t;function r(s){return t(new Uint8Array(s))}e.fromArrayBuffer=r;function n(s){return s}e.fromBuffer=n,e.IsNativeEndianLittle=new Uint16Array(new Uint8Array([18,52]).buffer)[0]===13330;function i(s,u,l,c,d){for(var f=0,p=l;f<p;f+=c)for(var v=0;v<c;v++)u[d+f+c-v-1]=s[d+f+v]}e.flipByteOrder=i;function a(s,u,l){u===void 0&&(u=0);for(var c=new Int16Array(s,u,l),d=0,f=c.length;d<f;++d){var p=c[d];c[d]=(p&255)<<8|p>>8&255}}e.flipByteOrderInPlace2=a;function o(s,u,l,c,d){e.IsNativeEndianLittle||!l||c<=1||i(s,u,l,c,d)}e.ensureLittleEndian=o})(Mu||(Mu={}));var J_;(function(e){function t(r,n){return{name:n,readBuffer:function(i,a,o,s){var u,l;if(typeof a=="number"){o=Di(o,a);var c=i,d=Math.min(r.length,c+o);u=d-c,l=Mu.fromUint8Array(new Uint8Array(r.buffer,c,d-c))}else{o=Di(o,a.length);var c=i,d=Math.min(r.length,c+o);a.set(r.subarray(c,d),s),u=d-c,l=a}return o!==u&&console.warn("byteCount "+o+" and bytesRead "+u+" differ"),Promise.resolve({bytesRead:u,buffer:l})},writeBuffer:function(i,a,o){return o=Di(o,a.length),console.error(".writeBuffer not implemented for FileHandle.fromBuffer"),Promise.resolve(0)},writeBufferSync:function(i,a,o){return o=Di(o,a.length),console.error(".writeSync not implemented for FileHandle.fromBuffer"),0},close:bf}}e.fromBuffer=t})(J_||(J_={}));var ma;(function(e){e.Float32="float32",e.Int8="int8",e.Int16="int16",e.Uint16="uint16"})(ma||(ma={}));function ree(e){return e===ma.Float32?4:e===ma.Int16||e===ma.Uint16?2:1}function M8e(e,t,r,n){return r===void 0&&(r=0),e===ma.Float32?new Float32Array(t,r,n):e===ma.Int16?new Int16Array(t,r,n):e===ma.Uint16?new Uint16Array(t,r,n):new Int8Array(t,r,n)}function D8e(e,t){var r=ree(t),n=new ArrayBuffer(r*e),i=Mu.fromArrayBuffer(n),a=Mu.IsNativeEndianLittle?n:new ArrayBuffer(r*e);return{type:t,elementByteSize:r,readBuffer:i,valuesBuffer:new Uint8Array(a),values:M8e(t,a)}}function R8e(e,t,r,n,i,a){return ce(this,void 0,void 0,function(){return de(this,function(o){switch(o.label){case 0:return[4,t.readBuffer(r,e.readBuffer,n,i)];case 1:return o.sent(),e.elementByteSize>1&&(a!==void 0&&a!==Mu.IsNativeEndianLittle||!Mu.IsNativeEndianLittle)&&Mu.flipByteOrder(e.readBuffer,e.valuesBuffer,n,e.elementByteSize,i),[2,e.values]}})})}function k8e(e){return ce(this,void 0,void 0,function(){var t,r,n,i,a,o,s,u,l;return de(this,function(c){switch(c.label){case 0:return t=1024,[4,e.readBuffer(0,t)];case 1:if(r=c.sent().buffer,n=String.fromCharCode(r.readUInt8(52*4),r.readUInt8(52*4+1),r.readUInt8(52*4+2),r.readUInt8(52*4+3)),n!=="MAP ")throw new Error('ccp4 format error, missing "MAP " string');return i=[r.readUInt8(53*4),r.readUInt8(53*4+1)],a=!1,i[0]===68&&i[1]===65?a=!0:i[0]===17&&i[1]===17?a=!1:(o=r.readInt32LE(3*4),o<=16&&(a=!0)),s=a?function(d){return r.readInt32LE(d*4)}:function(d){return r.readInt32BE(d*4)},u=a?function(d){return r.readFloatLE(d*4)}:function(d){return r.readFloatBE(d*4)},l={NC:s(0),NR:s(1),NS:s(2),MODE:s(3),NCSTART:s(4),NRSTART:s(5),NSSTART:s(6),NX:s(7),NY:s(8),NZ:s(9),xLength:u(10),yLength:u(11),zLength:u(12),alpha:u(13),beta:u(14),gamma:u(15),MAPC:s(16),MAPR:s(17),MAPS:s(18),AMIN:u(19),AMAX:u(20),AMEAN:u(21),ISPG:s(22),NSYMBT:s(23),LSKFLG:s(24),SKWMAT:[],SKWTRN:[],userFlag1:s(39),userFlag2:s(40),originX:u(49),originY:u(50),originZ:u(51),MAP:n,MACHST:i,ARMS:u(54)},[2,{header:l,littleEndian:a}]}})})}function O8e(e,t,r,n,i,a){return ce(this,void 0,void 0,function(){var o,s,u,l,c,d;return de(this,function(f){switch(f.label){case 0:return iee(e)?(o=3*i,[4,r.readBuffer(n,t.readBuffer,i,o)]):[3,2];case 1:for(f.sent(),s=new Int8Array(t.valuesBuffer.buffer,o),u=(e.AMAX-e.AMIN)/255,l=.5*(e.AMIN+e.AMAX+u),c=0,d=i;c<d;++c)t.values[c]=u*s[c]+l;return[3,4];case 2:return[4,R8e(t,r,n,i,0,a)];case 3:f.sent(),f.label=4;case 4:return[2]}})})}function nee(e){switch(e){case 0:return ma.Int8;case 1:return ma.Int16;case 2:return ma.Float32;case 3:throw new Error("mode 3 unsupported, complex 16-bit integers");case 4:throw new Error("mode 4 unsupported, complex 32-bit reals");case 6:ma.Uint16;case 16:throw new Error("mode 16 unsupported, unsigned char * 3 (for rgb data, non-standard)")}throw new Error("unknown mode '"+e+"'")}function iee(e){return e.userFlag1===-128&&e.userFlag2===127}function aee(e){return iee(e)?ma.Float32:nee(e.MODE)}function L8e(e){return 256*4+e.NSYMBT}function F8e(e,t,r){return ce(this,void 0,void 0,function(){var n,i,a,o,s,u,l,c,d,f,p;return de(this,function(v){switch(v.label){case 0:return[4,r.update({message:"Parsing CCP4/MRC/MAP file..."})];case 1:return v.sent(),[4,k8e(e)];case 2:return n=v.sent(),i=n.header,a=n.littleEndian,o=L8e(i),s=nee(i.MODE),u=aee(i),l=i.NC*i.NR*i.NS,c=ree(s),d=l*c,f=D8e(l,u),O8e(i,f,e,o,d,a),p={header:i,values:f.values,name:e.name},[2,p]}})})}function N8e(e,t){var r=this;return $e.create("Parse CCP4/MRC/MAP",function(n){return ce(r,void 0,void 0,function(){var i,a,o;return de(this,function(s){switch(s.label){case 0:return s.trys.push([0,2,,3]),a=(i=In).success,[4,F8e(e,t,n)];case 1:return[2,a.apply(i,[s.sent()])];case 2:return o=s.sent(),[2,In.error(o)];case 3:return[2]}})})})}function B8e(e,t){return N8e(J_.fromBuffer(Mu.fromUint8Array(e),t),e.length)}var bD=512;function U8e(e){return{xStart:parseInt(e.substr(10,5)),yStart:parseInt(e.substr(15,5)),zStart:parseInt(e.substr(20,5)),xExtent:parseInt(e.substr(32,5)),yExtent:parseInt(e.substr(38,5)),zExtent:parseInt(e.substr(42,5)),xRate:parseInt(e.substr(52,5)),yRate:parseInt(e.substr(58,5)),zRate:parseInt(e.substr(62,5)),xlen:parseFloat(e.substr(73,10)),ylen:parseFloat(e.substr(83,10)),zlen:parseFloat(e.substr(93,10)),alpha:parseFloat(e.substr(103,10)),beta:parseFloat(e.substr(113,10)),gamma:parseFloat(e.substr(123,10)),divisor:parseFloat(e.substr(138,12)),summand:parseInt(e.substr(155,8)),sigma:parseFloat(e.substr(170,12))}}function j8e(e,t){var r=t?function(i){return e.readInt16LE(i*2)}:function(i){return e.readInt16BE(i*2)},n=1/r(17);return{xStart:r(0),yStart:r(1),zStart:r(2),xExtent:r(3),yExtent:r(4),zExtent:r(5),xRate:r(6),yRate:r(7),zRate:r(8),xlen:r(9)*n,ylen:r(10)*n,zlen:r(11)*n,alpha:r(12)*n,beta:r(13)*n,gamma:r(14)*n,divisor:r(15)/100,summand:r(16),sigma:void 0}}function oee(e){var t=e.xExtent,r=e.yExtent,n=e.zExtent,i=Math.ceil(t/8),a=Math.ceil(r/8),o=Math.ceil(n/8);return{xBlocks:i,yBlocks:a,zBlocks:o}}function z8e(e){return ce(this,void 0,void 0,function(){var t,r,n,i,a;return de(this,function(o){switch(o.label){case 0:return[4,e.readBuffer(0,bD)];case 1:return t=o.sent().buffer,r=String.fromCharCode.apply(null,t),n=r.startsWith(":-)"),i=n||t.readInt16LE(18*2)===100,a=n?U8e(r):j8e(t,i),[2,{header:a,littleEndian:i}]}})})}function V8e(e,t,r,n){return ce(this,void 0,void 0,function(){var i,a,o,s,u,l,c,d,f,p,v,h,m,g,y,b,S,x,C,w;return de(this,function(A){for(n||Mu.flipByteOrderInPlace2(t.buffer),i=e.divisor,a=e.summand,o=e.xExtent,s=e.yExtent,u=e.zExtent,l=oee(e),c=l.xBlocks,d=l.yBlocks,f=l.zBlocks,p=0,v=0;v<f;++v)for(h=0;h<d;++h)for(m=0;m<c;++m)for(g=0;g<8;++g)for(y=8*v+g,b=0;b<8;++b)for(S=8*h+b,x=0;x<8;++x)if(C=8*m+x,C<o&&S<s&&y<u)w=(C*s+S)*u+y,r[w]=(t[p]-a)/i,++p;else{p+=8-x;break}return[2]})})}function H8e(e){var t=e.xExtent,r=e.yExtent,n=e.zExtent,i=oee(e),a=i.xBlocks,o=i.yBlocks,s=i.zBlocks,u=t*r*n,l=a*8*o*8*s*8,c=1,d=l*c;return{count:l,byteCount:d,valueCount:u}}function G8e(e,t,r){return ce(this,void 0,void 0,function(){var n,i,a,o,s,u,l;return de(this,function(c){switch(c.label){case 0:return[4,r.update({message:"Parsing DSN6/BRIX file..."})];case 1:return c.sent(),[4,z8e(e)];case 2:return n=c.sent(),i=n.header,a=n.littleEndian,[4,e.readBuffer(bD,t-bD)];case 3:return o=c.sent().buffer,s=H8e(i).valueCount,u=new Float32Array(s),[4,V8e(i,o,u,a)];case 4:return c.sent(),l={header:i,values:u,name:e.name},[2,l]}})})}function q8e(e,t){var r=this;return $e.create("Parse DSN6/BRIX",function(n){return ce(r,void 0,void 0,function(){var i,a,o;return de(this,function(s){switch(s.label){case 0:return s.trys.push([0,2,,3]),a=(i=In).success,[4,G8e(e,t,n)];case 1:return[2,a.apply(i,[s.sent()])];case 2:return o=s.sent(),[2,In.error(o)];case 3:return[2]}})})})}function $8e(e,t){return q8e(J_.fromBuffer(Mu.fromUint8Array(e),t),e.length)}var W8e={char:1,uchar:1,short:2,ushort:2,int:4,uint:4,float:4,double:8,int8:1,uint8:1,int16:2,uint16:2,int32:4,uint32:4,float32:4,float64:8},X8e=new Set(Object.keys(W8e));function N4(e){if(!X8e.has(e))throw new Error("unknown ply type '"+e+"'");return e}function Y8e(e,t,r){for(var n=new Map,i=0,a=t.length;i<a;++i)n.set(t[i],e[i]);return{comments:r,elementNames:t,getElement:function(o){return n.get(o)}}}function K8e(e,t){var r=It(e);return{data:e,tokenizer:r,runtimeCtx:t,comments:[],elementSpecs:[],elements:[]}}function Q8e(e){var t=e.data.indexOf("end_header",e.position);if(t===-1)throw new Error("no 'end_header' record found");e.tokenStart=e.position,e.tokenEnd=t,e.position=t,It.eatLine(e)}function Z8e(e){var t=e.tokenizer,r=e.comments,n=e.elementSpecs;Q8e(t);var i=It.getTokenString(t).split(/\r?\n/);if(i[0]!=="ply")throw new Error("data not starting with 'ply'");if(i[1]!=="format ascii 1.0")throw new Error("format not 'ascii 1.0'");var a,o,s;function u(){if(a!==void 0&&o!==void 0&&s!==void 0){for(var p=!1,v=0,h=s.length;v<h;++v){var m=s[v];if(m.kind==="list"){p=!0;break}}p&&s.length,p?n.push({kind:"list",name:a,count:o,property:s[0]}):n.push({kind:"table",name:a,count:o,properties:s})}}for(var l=2,c=i.length;l<c;++l){var d=i[l],f=d.split(" ");if(d.startsWith("comment"))r.push(d.substr(8));else if(d.startsWith("element"))u(),s=[],a=f[1],o=parseInt(f[2]);else if(d.startsWith("property")){if(s===void 0)throw new Error("properties outside of element");f[1]==="list"?s.push({kind:"list",countType:N4(f[2]),dataType:N4(f[3]),name:f[4]}):s.push({kind:"column",type:N4(f[1]),name:f[2]})}else d.startsWith("end_header")?u():console.warn("unknown header line")}}function J8e(e){for(var t=e.elementSpecs,r=0,n=t.length;r<n;++r){var i=t[r];i.kind==="table"?e7e(e,i):i.kind==="list"&&t7e(e,i)}}function see(e){switch(e){case"char":case"uchar":case"int8":case"uint8":case"short":case"ushort":case"int16":case"uint16":case"int":case"uint":case"int32":case"uint32":return ve.Schema.int;case"float":case"double":case"float32":case"float64":return ve.Schema.float}}function e7e(e,t){for(var r=e.elements,n=e.tokenizer,i=t.count,a=t.properties,o=a.length,s=[],u=[],l=[],c=new Map,d=0,f=o;d<f;++d){var p=pt.create(n.data,i*2);l.push(p)}for(var d=0,f=i;d<f;++d)for(var v=0,h=o;v<h;++v)It.skipWhitespace(n),It.markStart(n),It.eatValue(n),pt.addUnchecked(l[v],n.tokenStart,n.tokenEnd);for(var d=0,f=o;d<f;++d){var m=a[d],g=m.type,y=m.name,b=TL(l[d],see(g));s.push(y),u.push(g),c.set(y,b)}r.push({kind:"table",rowCount:i,propertyNames:s,propertyTypes:u,getProperty:function(S){return c.get(S)}})}function t7e(e,t){for(var r=e.elements,n=e.tokenizer,i=t.count,a=t.property,o=pt.create(n.data,i*2*3),s=new Uint32Array(i+1),u=0,l=0,c=i;l<c;++l){for(It.skipWhitespace(n),It.markStart(n);It.skipWhitespace(n)!==10;)++u,It.markStart(n),It.eatValue(n),pt.addToken(o,n);s[l+1]=u}var d={entries:[],count:0},f=TL(o,see(a.dataType));r.push({kind:"list",rowCount:i,name:a.name,type:a.dataType,value:function(p){for(var v=s[p]+1,h=f.value(v-1),m=v,g=v+h;m<g;++m)d.entries[m-v]=f.value(m);return d.count=h,d}})}function r7e(e,t){return ce(this,void 0,void 0,function(){var r,n,i,a,o,s;return de(this,function(u){return r=K8e(e,t),t.update({message:"Parsing...",current:0,max:e.length}),Z8e(r),J8e(r),n=r.elements,i=r.elementSpecs,a=r.comments,o=i.map(function(l){return l.name}),s=Y8e(n,o,a),[2,In.success(s)]})})}function n7e(e){var t=this;return $e.create("Parse PLY",function(r){return ce(t,void 0,void 0,function(){return de(this,function(n){switch(n.label){case 0:return[4,r7e(e,r)];case 1:return[2,n.sent()]}})})})}var ew=It.readLine,uee=It.skipWhitespace,lee=It.eatValue,i7e=It.eatLine,xD=It.markStart,rC=/\s+/,a7e=/(^\*|REMARK)*/;function o7e(e,t){return{tokenizer:e,runtimeCtx:t}}function s7e(e,t){return ce(this,void 0,void 0,function(){var r,n,i,a,o,s,u,l,c,d,f,p,v,h,m;return de(this,function(g){switch(g.label){case 0:return r=e.tokenizer,n=pt.create(r.data,t*2),i=pt.create(r.data,t*2),a=pt.create(r.data,t*2),o=pt.create(r.data,t*2),s=pt.create(r.data,t*2),u=pt.create(r.data,t*2),l=pt.create(r.data,t*2),c=pt.create(r.data,t*2),d=r.position,f=ew(r).trim(),r.position=d,p=f.split(rC).length===7,v=p?6:8,h=r.length,m=0,[4,Zc(e.runtimeCtx,1e5,void 0,function(y){for(var b=Math.min(t-m,y),S=0;S<b;++S){for(var x=0;x<v;++x)if(uee(r),xD(r),lee(r),p)switch(x){case 0:pt.addUnchecked(n,r.tokenStart,r.tokenEnd);break;case 1:pt.addUnchecked(a,r.tokenStart,r.tokenEnd);break;case 2:pt.addUnchecked(s,r.tokenStart,r.tokenEnd);break;case 3:pt.addUnchecked(u,r.tokenStart,r.tokenEnd);break;case 4:pt.addUnchecked(l,r.tokenStart,r.tokenEnd);break;case 5:pt.addUnchecked(c,r.tokenStart,r.tokenEnd);break}else switch(x){case 0:pt.addUnchecked(n,r.tokenStart,r.tokenEnd);break;case 1:pt.addUnchecked(i,r.tokenStart,r.tokenEnd);break;case 2:pt.addUnchecked(a,r.tokenStart,r.tokenEnd);break;case 3:pt.addUnchecked(o,r.tokenStart,r.tokenEnd);break;case 4:pt.addUnchecked(s,r.tokenStart,r.tokenEnd);break;case 5:pt.addUnchecked(u,r.tokenStart,r.tokenEnd);break;case 6:pt.addUnchecked(l,r.tokenStart,r.tokenEnd);break;case 7:pt.addUnchecked(c,r.tokenStart,r.tokenEnd);break}i7e(r),xD(r)}return m+=b,b},function(y){return y.update({message:"Parsing...",current:r.position,max:h})})];case 1:return g.sent(),[2,{count:t,atomId:Xr(n)(ve.Schema.int),segmentName:p?Xr(a)(ve.Schema.str):Xr(i)(ve.Schema.str),residueId:Xr(a)(ve.Schema.int),residueName:p?Xr(a)(ve.Schema.str):Xr(o)(ve.Schema.str),atomName:Xr(s)(ve.Schema.str),atomType:Xr(u)(ve.Schema.str),charge:Xr(l)(ve.Schema.float),mass:Xr(c)(ve.Schema.float)}]}})})}function u7e(e,t){return ce(this,void 0,void 0,function(){var r,n,i,a,o;return de(this,function(s){switch(s.label){case 0:return r=e.tokenizer,n=pt.create(r.data,t*2),i=pt.create(r.data,t*2),a=r.length,o=0,[4,Zc(e.runtimeCtx,10,void 0,function(u){for(var l=Math.min(t-o,u),c=0;c<l;++c)for(var d=0;d<2;++d)switch(uee(r),xD(r),lee(r),d){case 0:pt.addUnchecked(n,r.tokenStart,r.tokenEnd);break;case 1:pt.addUnchecked(i,r.tokenStart,r.tokenEnd);break}return o+=l,l},function(u){return u.update({message:"Parsing...",current:r.position,max:a})})];case 1:return s.sent(),[2,{count:t,atomIdA:Xr(n)(ve.Schema.int),atomIdB:Xr(i)(ve.Schema.int)}]}})})}function l7e(e,t){for(var r=[],n=0;n<t;++n){var i=ew(e.tokenizer);r.push(i.replace(a7e,"").trim())}return r}function c7e(e,t){return ce(this,void 0,void 0,function(){var r,n,i,a,o,s,u,l,c,d,f;return de(this,function(p){switch(p.label){case 0:r=It(e),n=o7e(r,t),i=void 0,a=void 0,o=void 0,s=ew(n.tokenizer).trim(),p.label=1;case 1:return r.tokenEnd<r.length?(u=ew(n.tokenizer).trim(),u.includes("!NTITLE")?(l=parseInt(u.split(rC)[0]),i=l7e(n,l),[3,7]):[3,2]):[3,8];case 2:return u.includes("!NATOM")?(c=parseInt(u.split(rC)[0]),[4,s7e(n,c)]):[3,4];case 3:return a=p.sent(),[3,7];case 4:return u.includes("!NBOND")?(d=parseInt(u.split(rC)[0]),[4,u7e(n,d)]):[3,6];case 5:return o=p.sent(),[3,8];case 6:u.includes("!NTHETA")||u.includes("!NPHI")||u.includes("!NIMPHI")||u.includes("!NDON")||u.includes("!NACC")||u.includes("!NNB")||u.includes("!NGRP NST2")||u.includes("!MOLNT")||u.includes("!NUMLP NUMLPH")||u.includes("!NCRTERM"),p.label=7;case 7:return[3,1];case 8:return i===void 0&&(i=[]),a===void 0?[2,In.error("no atoms data")]:o===void 0?[2,In.error("no bonds data")]:(f={id:s,title:i,atoms:a,bonds:o},[2,In.success(f)])}})})}function d7e(e){var t=this;return $e.create("Parse PSF",function(r){return ce(t,void 0,void 0,function(){return de(this,function(n){switch(n.label){case 0:return[4,c7e(e,r)];case 1:return[2,n.sent()]}})})})}var ge;(function(e){e.Create=On.factory();function t(s){return!!s&&s.type.typeClass==="Representation3D"}e.isRepresentation3D=t;function r(s){return!!s&&s.type.typeClass==="Behavior"}e.isBehavior=r;function n(s){return e.Create(E(E({},s),{typeClass:"Representation3D"}))}e.CreateRepresentation3D=n;function i(s){return e.Create(E(E({},s),{typeClass:"Behavior"}))}e.CreateBehavior=i;var a=function(s){Fe(u,s);function u(){return s!==null&&s.apply(this,arguments)||this}return u}(e.Create({name:"Root",typeClass:"Root"}));e.Root=a;var o=function(s){Fe(u,s);function u(){return s!==null&&s.apply(this,arguments)||this}return u}(e.Create({name:"Group",typeClass:"Group"}));e.Group=o,function(s){var u=function(d){Fe(f,d);function f(){return d!==null&&d.apply(this,arguments)||this}return f}(e.Create({name:"String Data",typeClass:"Data"}));s.String=u;var l=function(d){Fe(f,d);function f(){return d!==null&&d.apply(this,arguments)||this}return f}(e.Create({name:"Binary Data",typeClass:"Data"}));s.Binary=l;var c=function(d){Fe(f,d);function f(){return d!==null&&d.apply(this,arguments)||this}return f}(e.Create({name:"Data Blob",typeClass:"Data"}));s.Blob=c}(e.Data||(e.Data={})),function(s){var u=function(g){Fe(y,g);function y(){return g!==null&&g.apply(this,arguments)||this}return y}(e.Create({name:"JSON Data",typeClass:"Data"}));s.Json=u;var l=function(g){Fe(y,g);function y(){return g!==null&&g.apply(this,arguments)||this}return y}(e.Create({name:"CIF File",typeClass:"Data"}));s.Cif=l;var c=function(g){Fe(y,g);function y(){return g!==null&&g.apply(this,arguments)||this}return y}(e.Create({name:"Cube File",typeClass:"Data"}));s.Cube=c;var d=function(g){Fe(y,g);function y(){return g!==null&&g.apply(this,arguments)||this}return y}(e.Create({name:"PSF File",typeClass:"Data"}));s.Psf=d;var f=function(g){Fe(y,g);function y(){return g!==null&&g.apply(this,arguments)||this}return y}(e.Create({name:"PLY File",typeClass:"Data"}));s.Ply=f;var p=function(g){Fe(y,g);function y(){return g!==null&&g.apply(this,arguments)||this}return y}(e.Create({name:"CCP4/MRC/MAP File",typeClass:"Data"}));s.Ccp4=p;var v=function(g){Fe(y,g);function y(){return g!==null&&g.apply(this,arguments)||this}return y}(e.Create({name:"DSN6/BRIX File",typeClass:"Data"}));s.Dsn6=v;var h=function(g){Fe(y,g);function y(){return g!==null&&g.apply(this,arguments)||this}return y}(e.Create({name:"DX File",typeClass:"Data"}));s.Dx=h;var m=function(g){Fe(y,g);function y(){return g!==null&&g.apply(this,arguments)||this}return y}(e.Create({name:"Format Blob",typeClass:"Data"}));s.Blob=m}(e.Format||(e.Format={})),function(s){var u=function(p){Fe(v,p);function v(){return p!==null&&p.apply(this,arguments)||this}return v}(e.Create({name:"Coordinates",typeClass:"Object"}));s.Coordinates=u;var l=function(p){Fe(v,p);function v(){return p!==null&&p.apply(this,arguments)||this}return v}(e.Create({name:"Topology",typeClass:"Object"}));s.Topology=l;var c=function(p){Fe(v,p);function v(){return p!==null&&p.apply(this,arguments)||this}return v}(e.Create({name:"Model",typeClass:"Object"}));s.Model=c;var d=function(p){Fe(v,p);function v(){return p!==null&&p.apply(this,arguments)||this}return v}(e.Create({name:"Trajectory",typeClass:"Object"}));s.Trajectory=d;var f=function(p){Fe(v,p);function v(){return p!==null&&p.apply(this,arguments)||this}return v}(e.Create({name:"Structure",typeClass:"Object"}));s.Structure=f,function(p){var v=function(g){Fe(y,g);function y(){return g!==null&&g.apply(this,arguments)||this}return y}(n({name:"Structure 3D"}));p.Representation3D=v;var h=function(g){Fe(y,g);function y(){return g!==null&&g.apply(this,arguments)||this}return y}(e.Create({name:"Structure 3D State",typeClass:"Object"}));p.Representation3DState=h;var m=function(g){Fe(y,g);function y(){return g!==null&&g.apply(this,arguments)||this}return y}(e.Create({name:"Selections",typeClass:"Object"}));p.Selections=m}(f=s.Structure||(s.Structure={}))}(e.Molecule||(e.Molecule={})),function(s){var u=function(d){Fe(f,d);function f(){return d!==null&&d.apply(this,arguments)||this}return f}(e.Create({name:"Volume",typeClass:"Object"}));s.Data=u;var l=function(d){Fe(f,d);function f(){return d!==null&&d.apply(this,arguments)||this}return f}(e.Create({name:"Lazy Volume",typeClass:"Object"}));s.Lazy=l;var c=function(d){Fe(f,d);function f(){return d!==null&&d.apply(this,arguments)||this}return f}(n({name:"Volume 3D"}));s.Representation3D=c}(e.Volume||(e.Volume={})),function(s){var u=function(c){Fe(d,c);function d(){return c!==null&&c.apply(this,arguments)||this}return d}(e.Create({name:"Shape Provider",typeClass:"Object"}));s.Provider=u;var l=function(c){Fe(d,c);function d(){return c!==null&&c.apply(this,arguments)||this}return d}(n({name:"Shape 3D"}));s.Representation3D=l}(e.Shape||(e.Shape={}))})(ge||(ge={}));var kt;(function(e){e.CreateBuiltIn=ft.factory("ms-plugin"),e.BuiltIn=ft.builderFactory("ms-plugin")})(kt||(kt={}));var Ej=.529177210859;function f7e(e){var t=It.readLines(e,6),r=function(D,k){var R=+t[D].trim().split(/\s+/g)[k];return Number.isNaN(R)?0:R},n=function(D){var k=r(D+2,0),R=Ej;return[Math.abs(k),_.create(r(D+2,1)*R,r(D+2,2)*R,r(D+2,3)*R),k]},i=t[0].trim(),a=t[1].trim(),o=n(0),s=o[0],u=o[1],l=o[2],c=n(1),d=c[0],f=c[1],p=n(2),v=p[0],h=p[1],m=n(3),g=m[0],y=m[1],b=p7e(e,s,Ej),S=[];if(l>=0){var x=r(2,4);x===0&&(x=1);for(var C=0;C<x;C++)S.push(C)}else for(var w=It.readLine(e).trim().split(/\s+/g),C=0,A=+w[0];C<A;C++)S.push(+w[C+1]);var M={orbitals:l<0,comment1:i,comment2:a,atomCount:s,origin:u,dim:_.create(d,v,g),basisX:f,basisY:h,basisZ:y,dataSetIds:S};return{header:M,atoms:b}}function p7e(e,t,r){for(var n=new Int32Array(t),i=new Float64Array(t),a=new Float32Array(t),o=new Float32Array(t),s=new Float32Array(t),u=0;u<t;u++){var l=It.readLine(e).trim().split(/\s+/g);n[u]=+l[0],i[u]=+l[1],a[u]=+l[2]*r,o[u]=+l[3]*r,s[u]=+l[4]*r}return{count:t,number:ve.ofArray({array:n,schema:ve.Schema.int}),nuclearCharge:ve.ofArray({array:i,schema:ve.Schema.float}),x:ve.ofArray({array:a,schema:ve.Schema.float}),y:ve.ofArray({array:o,schema:ve.Schema.float}),z:ve.ofArray({array:s,schema:ve.Schema.float})}}function h7e(e,t,r){var n=r.dim[0]*r.dim[1]*r.dim[2]*r.dataSetIds.length,i=100*100*100,a=new Float64Array(n),o=0;return Zc(e,i,a,function(s,u){for(var l=Math.min(n,o+s),c=o;c<l;c++)It.skipWhitespace(t),t.tokenStart=t.position,It.eatValue(t),u[c]=Lc(t.data,t.tokenStart,t.tokenEnd);return o=l,l===n?0:i},function(s,u,l){return s.update({current:Math.min(l,n),max:n})})}function v7e(e,t){var r=this;return $e.create("Parse Cube",function(n){return ce(r,void 0,void 0,function(){var i,a,o,s,u;return de(this,function(l){switch(l.label){case 0:return[4,n.update("Reading header...")];case 1:return l.sent(),i=It(e),a=f7e(i),o=a.header,s=a.atoms,[4,h7e(n,i,o)];case 2:return u=l.sent(),[2,In.success({header:o,atoms:s,values:u,name:t})]}})})})}function cee(e){for(var t={h:_()},r=0,n=0,i=/\s+/g;;){var a=It.readLine(e),o=void 0;if(a.startsWith("object 1"))o=a.split(i),t.dim=_.create(parseInt(o[5]),parseInt(o[6]),parseInt(o[7]));else if(a.startsWith("origin"))o=a.split(i),t.min=_.create(parseFloat(o[1]),parseFloat(o[2]),parseFloat(o[3]));else if(a.startsWith("delta"))o=a.split(i),n===0?t.h[0]=parseFloat(o[1]):n===1?t.h[1]=parseFloat(o[2]):n===2&&(t.h[2]=parseFloat(o[3])),n+=1;else if(a.startsWith("object 3")){r+=a.length+1;break}r+=a.length+1}return{header:t,headerByteCount:r}}function m7e(e,t,r){var n=r.dim[0]*r.dim[1]*r.dim[2],i=100*100*100,a=new Float64Array(n),o=0;return Zc(e,i,a,function(s,u){for(var l=Math.min(n,o+s),c=o;c<l;c++)It.skipWhitespace(t),t.tokenStart=t.position,It.eatValue(t),u[c]=Lc(t.data,t.tokenStart,t.tokenEnd);return o=l,l===n?0:i},function(s,u,l){return s.update({current:Math.min(l,n),max:n})})}function g7e(e,t,r){return ce(this,void 0,void 0,function(){var n,i,a;return de(this,function(o){switch(o.label){case 0:return[4,e.update("Reading header...")];case 1:return o.sent(),n=It(t),i=cee(n).header,[4,e.update("Reading values...")];case 2:return o.sent(),[4,m7e(e,n,i)];case 3:return a=o.sent(),[2,In.success({header:i,values:a,name:r})]}})})}function y7e(e,t,r){return ce(this,void 0,void 0,function(){var n,i,a,o,s,u,l,c,d;return de(this,function(f){switch(f.label){case 0:return[4,e.update("Reading header...")];case 1:return f.sent(),n=oL(t,0,1e3),i=It(n),a=cee(i),o=a.header,s=a.headerByteCount,[4,e.update("Reading values...")];case 2:for(f.sent(),u=o.dim[0]*o.dim[1]*o.dim[2],l=new DataView(t.buffer,t.byteOffset+s),c=new Float64Array(u),d=0;d<u;d++)c[d]=l.getFloat64(d*8,!0);return[2,In.success({header:o,values:c,name:r})]}})})}function b7e(e,t){return $e.create("Parse Cube",function(r){return typeof e=="string"?g7e(r,e,t):y7e(r,e,t)})}var dee=kt.BuiltIn({name:"download",display:{name:"Download",description:"Download string or binary data from the specified URL"},from:[ge.Root],to:[ge.Data.String,ge.Data.Binary],params:{url:I.Url("https://www.ebi.ac.uk/pdbe/static/entry/1cbs_updated.cif",{description:"Resource URL. Must be the same domain or support CORS."}),label:I.Optional(I.Text("")),isBinary:I.Optional(I.Boolean(!1,{description:"If true, download data as binary (string otherwise)"}))}})({apply:function(e,t){var r=this,n=e.params,i=e.cache;return $e.create("Download",function(a){return ce(r,void 0,void 0,function(){var o,s;return de(this,function(u){switch(u.label){case 0:return o=Pn.getUrlAsset(t.managers.asset,n.url),[4,t.managers.asset.resolve(o,n.isBinary?"binary":"string").runInContext(a)];case 1:return s=u.sent(),i.asset=s,[2,n.isBinary?new ge.Data.Binary(s.data,{label:n.label?n.label:o.url}):new ge.Data.String(s.data,{label:n.label?n.label:o.url})]}})})})},dispose:function(e){var t,r,n=e.cache;(r=(t=n)===null||t===void 0?void 0:t.asset)===null||r===void 0||r.dispose()},update:function(e){var t=e.oldParams,r=e.newParams,n=e.b;return t.url!==r.url||t.isBinary!==r.isBinary?ft.UpdateResult.Recreate:t.label!==r.label?(n.label=r.label||(typeof r.url=="string"?r.url:r.url.url),ft.UpdateResult.Updated):ft.UpdateResult.Unchanged}}),fee=kt.BuiltIn({name:"download-blob",display:{name:"Download Blob",description:"Download multiple string or binary data from the specified URLs."},from:ge.Root,to:ge.Data.Blob,params:{sources:I.ObjectList({id:I.Text("",{label:"Unique ID"}),url:I.Url("https://www.ebi.ac.uk/pdbe/static/entry/1cbs_updated.cif",{description:"Resource URL. Must be the same domain or support CORS."}),isBinary:I.Optional(I.Boolean(!1,{description:"If true, download data as binary (string otherwise)"})),canFail:I.Optional(I.Boolean(!1,{description:"Indicate whether the download can fail and not be included in the blob as a result."}))},function(e){return e.id+": "+e.url}),maxConcurrency:I.Optional(I.Numeric(4,{min:1,max:12,step:1},{description:"The maximum number of concurrent downloads."}))}})({apply:function(e,t){var r=this,n=e.params,i=e.cache;return $e.create("Download Blob",function(a){return ce(r,void 0,void 0,function(){var o,s,u,l,c,d;return de(this,function(f){switch(f.label){case 0:return o=[],[4,uDe(a,t.managers.asset,n.sources,n.maxConcurrency||4)];case 1:for(s=f.sent(),u=[],l=0;l<s.length;l++)c=s[l],d=n.sources[l],c.kind==="error"?t.log.warn("Download "+c.id+" ("+d.url+") failed: "+c.error):(u.push(c.result),o.push(d.isBinary?{id:c.id,kind:"binary",data:c.result.data}:{id:c.id,kind:"string",data:c.result.data}));return i.assets=u,[2,new ge.Data.Blob(o,{label:"Data Blob",description:o.length+" "+(o.length===1?"entry":"entries")})]}})})})},dispose:function(e,t){var r,n=e.cache,i=(r=n)===null||r===void 0?void 0:r.assets;if(i)for(var a=0,o=i;a<o.length;a++){var s=o[a];s.dispose()}}}),pee=kt.BuiltIn({name:"raw-data",display:{name:"Raw Data",description:"Raw data supplied by value."},from:[ge.Root],to:[ge.Data.String,ge.Data.Binary],params:{data:I.Value("",{isHidden:!0}),label:I.Optional(I.Text(""))}})({apply:function(e){var t=this,r=e.params;return $e.create("Raw Data",function(){return ce(t,void 0,void 0,function(){return de(this,function(n){if(typeof r.data=="string")return[2,new ge.Data.String(r.data,{label:r.label?r.label:"String"})];if(Array.isArray(r.data))return[2,new ge.Data.Binary(new Uint8Array(r.data),{label:r.label?r.label:"Binary"})];if(r.data instanceof ArrayBuffer)return[2,new ge.Data.Binary(new Uint8Array(r.data),{label:r.label?r.label:"Binary"})];if(r.data instanceof Uint8Array)return[2,new ge.Data.Binary(r.data,{label:r.label?r.label:"Binary"})];throw new Error("Supplied binary data must be a plain array, ArrayBuffer, or Uint8Array.")})})})},update:function(e){var t=e.oldParams,r=e.newParams,n=e.b;return t.data!==r.data?ft.UpdateResult.Recreate:t.label!==r.label?(n.label=r.label||n.label,ft.UpdateResult.Updated):ft.UpdateResult.Unchanged},customSerialization:{toJSON:function(e){if(typeof e.data=="string"||Array.isArray(e.data))return e;if(e.data instanceof ArrayBuffer){for(var t=new Uint8Array(e.data),r=new Array(t.length),n=0,i=t.length;n<i;n++)r[n]=t[n];return{data:r,label:e.label}}else if(e.data instanceof Uint8Array){for(var r=new Array(e.data.length),n=0,i=e.data.length;n<i;n++)r[n]=e.data[n];return{data:r,label:e.label}}},fromJSON:function(e){return e}}}),hee=kt.BuiltIn({name:"read-file",display:{name:"Read File",description:"Read string or binary data from the specified file"},from:ge.Root,to:[ge.Data.String,ge.Data.Binary],params:{file:I.File(),label:I.Optional(I.Text("")),isBinary:I.Optional(I.Boolean(!1,{description:"If true, open file as as binary (string otherwise)"}))}})({apply:function(e,t){var r=this,n=e.params,i=e.cache;return $e.create("Open File",function(a){return ce(r,void 0,void 0,function(){var o,s;return de(this,function(u){switch(u.label){case 0:return n.file===null?(t.log.error("No file(s) selected"),[2,On.Null]):[4,t.managers.asset.resolve(n.file,n.isBinary?"binary":"string").runInContext(a)];case 1:return o=u.sent(),i.asset=o,s=n.isBinary?new ge.Data.Binary(o.data,{label:n.label?n.label:n.file.name}):new ge.Data.String(o.data,{label:n.label?n.label:n.file.name}),[2,s]}})})})},dispose:function(e){var t,r,n=e.cache;(r=(t=n)===null||t===void 0?void 0:t.asset)===null||r===void 0||r.dispose()},update:function(e){var t,r=e.oldParams,n=e.newParams,i=e.b;return r.label!==n.label?(i.label=n.label||((t=r.file)===null||t===void 0?void 0:t.name)||"",ft.UpdateResult.Updated):ft.UpdateResult.Unchanged},isSerializable:function(){return{isSerializable:!1,reason:"Cannot serialize user loaded files."}}}),x7e=kt.BuiltIn({name:"parse-blob",display:{name:"Parse Blob",description:"Parse multiple data enties"},from:ge.Data.Blob,to:ge.Format.Blob,params:{formats:I.ObjectList({id:I.Text("",{label:"Unique ID"}),format:I.Select("cif",[["cif","cif"]])},function(e){return e.id+": "+e.format})}})({apply:function(e,t){var r=this,n=e.a,i=e.params;return $e.create("Parse Blob",function(a){return ce(r,void 0,void 0,function(){var o,s,u,l,c,d,f,p,v;return de(this,function(h){switch(h.label){case 0:for(o=new Map,s=0,u=i.formats;s<u.length;s++)l=u[s],o.set(l.id,l.format);c=[],d=0,f=n.data,h.label=1;case 1:return d<f.length?(p=f[d],o.has(p.id)?[4,(p.kind==="string"?td.parse(p.data):td.parseBinary(p.data)).runInContext(a)]:[3,3]):[3,4];case 2:if(v=h.sent(),v.isError)throw new Error(p.id+": "+v.message);c.push({id:p.id,kind:"cif",data:v.result}),h.label=3;case 3:return d++,[3,1];case 4:return[2,new ge.Format.Blob(c,{label:"Format Blob",description:c.length+" "+(c.length===1?"entry":"entries")})]}})})})}}),S7e=kt.BuiltIn({name:"parse-cif",display:{name:"Parse CIF",description:"Parse CIF from String or Binary data"},from:[ge.Data.String,ge.Data.Binary],to:ge.Format.Cif})({apply:function(e){var t=this,r=e.a;return $e.create("Parse CIF",function(n){return ce(t,void 0,void 0,function(){var i;return de(this,function(a){switch(a.label){case 0:return[4,(ge.Data.String.is(r)?td.parse(r.data):td.parseBinary(r.data)).runInContext(n)];case 1:if(i=a.sent(),i.isError)throw new Error(i.message);return[2,new ge.Format.Cif(i.result)]}})})})}}),C7e=kt.BuiltIn({name:"parse-cube",display:{name:"Parse Cube",description:"Parse Cube from String data"},from:ge.Data.String,to:ge.Format.Cube})({apply:function(e){var t=this,r=e.a;return $e.create("Parse Cube",function(n){return ce(t,void 0,void 0,function(){var i;return de(this,function(a){switch(a.label){case 0:return[4,v7e(r.data,r.label).runInContext(n)];case 1:if(i=a.sent(),i.isError)throw new Error(i.message);return[2,new ge.Format.Cube(i.result)]}})})})}}),_7e=kt.BuiltIn({name:"parse-psf",display:{name:"Parse PSF",description:"Parse PSF from String data"},from:[ge.Data.String],to:ge.Format.Psf})({apply:function(e){var t=this,r=e.a;return $e.create("Parse PSF",function(n){return ce(t,void 0,void 0,function(){var i;return de(this,function(a){switch(a.label){case 0:return[4,d7e(r.data).runInContext(n)];case 1:if(i=a.sent(),i.isError)throw new Error(i.message);return[2,new ge.Format.Psf(i.result)]}})})})}}),w7e=kt.BuiltIn({name:"parse-ply",display:{name:"Parse PLY",description:"Parse PLY from String data"},from:[ge.Data.String],to:ge.Format.Ply})({apply:function(e){var t=this,r=e.a;return $e.create("Parse PLY",function(n){return ce(t,void 0,void 0,function(){var i;return de(this,function(a){switch(a.label){case 0:return[4,n7e(r.data).runInContext(n)];case 1:if(i=a.sent(),i.isError)throw new Error(i.message);return[2,new ge.Format.Ply(i.result,{label:i.result.comments[0]||"PLY Data"})]}})})})}}),E7e=kt.BuiltIn({name:"parse-ccp4",display:{name:"Parse CCP4/MRC/MAP",description:"Parse CCP4/MRC/MAP from Binary data"},from:[ge.Data.Binary],to:ge.Format.Ccp4})({apply:function(e){var t=this,r=e.a;return $e.create("Parse CCP4/MRC/MAP",function(n){return ce(t,void 0,void 0,function(){var i;return de(this,function(a){switch(a.label){case 0:return[4,B8e(r.data,r.label).runInContext(n)];case 1:if(i=a.sent(),i.isError)throw new Error(i.message);return[2,new ge.Format.Ccp4(i.result)]}})})})}}),A7e=kt.BuiltIn({name:"parse-dsn6",display:{name:"Parse DSN6/BRIX",description:"Parse CCP4/BRIX from Binary data"},from:[ge.Data.Binary],to:ge.Format.Dsn6})({apply:function(e){var t=this,r=e.a;return $e.create("Parse DSN6/BRIX",function(n){return ce(t,void 0,void 0,function(){var i;return de(this,function(a){switch(a.label){case 0:return[4,$8e(r.data,r.label).runInContext(n)];case 1:if(i=a.sent(),i.isError)throw new Error(i.message);return[2,new ge.Format.Dsn6(i.result)]}})})})}}),P7e=kt.BuiltIn({name:"parse-dx",display:{name:"Parse DX",description:"Parse DX from Binary/String data"},from:[ge.Data.Binary,ge.Data.String],to:ge.Format.Dx})({apply:function(e){var t=this,r=e.a;return $e.create("Parse DX",function(n){return ce(t,void 0,void 0,function(){var i;return de(this,function(a){switch(a.label){case 0:return[4,b7e(r.data,r.label).runInContext(n)];case 1:if(i=a.sent(),i.isError)throw new Error(i.message);return[2,new ge.Format.Dx(i.result)]}})})})}}),T7e=kt.BuiltIn({name:"import-string",display:{name:"Import String",description:"Import given data as a string"},from:ge.Root,to:ge.Data.String,params:{data:I.Value(""),label:I.Optional(I.Text(""))}})({apply:function(e){var t=e.params,r=t.data,n=t.label;return new ge.Data.String(r,{label:n||""})},update:function(e){var t=e.oldParams,r=e.newParams,n=e.b;return t.data!==r.data?ft.UpdateResult.Recreate:t.label!==r.label?(n.label=r.label||"",ft.UpdateResult.Updated):ft.UpdateResult.Unchanged},isSerializable:function(){return{isSerializable:!1,reason:"Cannot serialize user imported strings."}}}),I7e=kt.BuiltIn({name:"import-json",display:{name:"Import JSON",description:"Import given data as a JSON"},from:ge.Root,to:ge.Format.Json,params:{data:I.Value({}),label:I.Optional(I.Text(""))}})({apply:function(e){var t=e.params,r=t.data,n=t.label;return new ge.Format.Json(r,{label:n||""})},update:function(e){var t=e.oldParams,r=e.newParams,n=e.b;return t.data!==r.data?ft.UpdateResult.Recreate:t.label!==r.label?(n.label=r.label||"",ft.UpdateResult.Updated):ft.UpdateResult.Unchanged},isSerializable:function(){return{isSerializable:!1,reason:"Cannot serialize user imported JSON."}}}),M7e=kt.BuiltIn({name:"parse-json",display:{name:"Parse JSON",description:"Parse JSON from String data"},from:[ge.Data.String],to:ge.Format.Json})({apply:function(e){var t=this,r=e.a;return $e.create("Parse JSON",function(n){return ce(t,void 0,void 0,function(){var i;return de(this,function(a){switch(a.label){case 0:return[4,new Response(r.data).json()];case 1:return i=a.sent(),[2,new ge.Format.Json(i)]}})})})}}),D7e=kt.BuiltIn({name:"lazy-volume",display:{name:"Lazy Volume",description:"A placeholder for lazy loaded volume representation"},from:ge.Root,to:ge.Volume.Lazy,params:{url:I.Url(""),isBinary:I.Boolean(!1),format:I.Text("ccp4"),entryId:I.Value("",{isHidden:!0}),isovalues:I.ObjectList({type:I.Text("relative"),value:I.Numeric(0),color:I.Color(fr.black),alpha:I.Numeric(1,{min:0,max:1,step:.01}),volumeIndex:I.Numeric(0)},function(e){return e.type+" "+e.value})}})({apply:function(e){var t=this;e.a;var r=e.params;return $e.create("Lazy Volume",function(n){return ce(t,void 0,void 0,function(){var i;return de(this,function(a){return i=Array.isArray(r.entryId)?r.entryId.join(", "):r.entryId,[2,new ge.Volume.Lazy(r,{label:""+(i||r.url),description:"Lazy Volume"})]})})})}});const R7e=Object.freeze(Object.defineProperty({__proto__:null,Download:dee,DownloadBlob:fee,ImportJson:I7e,ImportString:T7e,LazyVolume:D7e,ParseBlob:x7e,ParseCcp4:E7e,ParseCif:S7e,ParseCube:C7e,ParseDsn6:A7e,ParseDx:P7e,ParseJson:M7e,ParsePly:w7e,ParsePsf:_7e,RawData:pee,ReadFile:hee},Symbol.toStringTag,{value:"Module"}));var k7e=kt.BuiltIn({name:"create-group",display:{name:"Group"},from:[],to:ge.Group,params:{label:I.Text("Group"),description:I.Optional(I.Text(""))}})({apply:function(e){var t=e.params;return new ge.Group({},t)},update:function(e){var t=e.oldParams,r=e.newParams,n=e.b;return Hg(t,r)?ft.UpdateResult.Unchanged:(n.label=r.label,n.description=r.description,ft.UpdateResult.Updated)}});const O7e=Object.freeze(Object.defineProperty({__proto__:null,CreateGroup:k7e},Symbol.toStringTag,{value:"Module"}));function L7e(e){var t=new DataView(e.buffer),r=Object.create(null),n=[],i=0,a=new Int32Array(e.buffer,0,23),o=a[0]!==t.getInt32(0);if(a[0]!==84)for(var s=e.byteLength,u=0;u<s;u+=4)t.setFloat32(u,t.getFloat32(u),!0);if(a[0]!==84)throw new Error("dcd bad format, header block start");var l=String.fromCharCode(t.getUint8(4),t.getUint8(5),t.getUint8(6),t.getUint8(7));if(l!=="CORD")throw new Error("dcd bad format, format string");var c=!1,d=!1,f=!1;if(a[22]!==0&&(c=!0,a[12]!==0&&(d=!0),a[13]===1&&(f=!0)),r.NSET=a[2],r.ISTART=a[3],r.NSAVC=a[4],r.NAMNF=a[10],c?r.DELTA=t.getFloat32(44,o):r.DELTA=t.getFloat64(44,o),a[22]!==84)throw new Error("dcd bad format, header block end");i=i+21*4+8;var p=t.getInt32(i,o),v=i+1;if((p-4)%80!==0)throw new Error("dcd bad format, title block start");if(r.TITLE=TOe(e.subarray(v,p)),t.getInt32(v+p+4-1,o)!==p)throw new Error("dcd bad format, title block end");if(i=i+p+8,t.getInt32(i,o)!==4)throw new Error("dcd bad format, natom block start");if(r.NATOM=t.getInt32(i+4,o),t.getInt32(i+8,o)!==4)throw new Error("dcd bad format, natom block end");if(i=i+4+8,r.NAMNF>0)throw new Error("dcd format with fixed atoms unsupported, aborting");for(var h=r.NATOM,m=h*4,u=0,s=r.NSET;u<s;++u){var g=Object.create(null);g.elementCount=h,d&&(i+=4,g.cell=[t.getFloat64(i,o),t.getFloat64(i+1,o),t.getFloat64(i+2*8,o),t.getFloat64(i+3*8,o),t.getFloat64(i+4*8,o),t.getFloat64(i+5*8,o)],i+=48,i+=4);for(var y=0;y<3;++y){if(t.getInt32(i,o)!==m)throw new Error("dcd bad format, coord block start: "+u+", "+y);i+=4;var b=new Float32Array(e.buffer,i,h);if(y===0?g.x=b:y===1?g.y=b:g.z=b,i+=m,t.getInt32(i,o)!==m)throw new Error("dcd bad format, coord block end: "+u+", "+y);i+=4}if(f){var S=t.getInt32(i,o);i+=4+S+4}n.push(g)}return{header:r,frames:n}}function F7e(e){var t=this;return $e.create("Parse DCD",function(r){return ce(t,void 0,void 0,function(){var n;return de(this,function(i){try{return n=L7e(e),[2,In.success(n)]}catch(a){return[2,In.error(a)]}return[2]})})})}function N7e(e){return function(t,r,n){return B7e(e,t,r,n)}}function B7e(e,t,r,n){var i=e.data,a=e.indices,o=e.count,s=n.valueType,u=s==="str"?function(l){var c=a[2*l]+t,d=a[2*l+1];if(c>=d)return"";var f=c+r;return f>d&&(f=d),aOe(i,c,f)}:s==="int"?function(l){var c=a[2*l]+t;return c>a[2*l+1]?0:ch(i,c,c+r)}:function(l){var c=a[2*l]+t;return c>a[2*l+1]?0:K4e(i,c,c+r)};return{schema:n,__array:void 0,isDefined:!0,rowCount:o,value:u,valueKind:function(l){return 0},toArray:function(l){return ia(o,u,l)},areValuesEqual:function(l,c){return u(l)===u(c)}}}function U7e(){return{title:"",timeInPs:0,hasVelocities:!1,precision:{position:0,velocity:0},box:[0,0,0]}}function j7e(e,t){return{tokenizer:e,header:U7e(),numberOfAtoms:0,runtimeCtx:t}}function z7e(e){var t=e.tokenizer,r=e.header,n=It.readLine(t);n.trim().length===0&&(n=It.readLine(t));var i=n.lastIndexOf("t=");i>=0?(r.timeInPs=parseFloat(n.substring(i+2)),r.title=n.substring(0,i).trim(),r.title&&r.title[r.title.length-1]===","&&(r.title=r.title.substring(0,r.title.length-1))):r.title=n}function V7e(e){var t=e.tokenizer;It.markLine(t);var r=It.getTokenString(t);e.numberOfAtoms=parseInt(r)}function H7e(e){return ce(this,void 0,void 0,function(){var t,r,n,i,a,o,s,u,l,c,d,f,p;return de(this,function(v){switch(v.label){case 0:return t=e.tokenizer,r=e.numberOfAtoms,[4,It.readLinesAsync(t,r,e.runtimeCtx,1e5)];case 1:return n=v.sent(),i=t.data.substring(n.indices[0],n.indices[1]).substring(20),a=i.match(/\.\d+/g),o=a.length===6,e.header.hasVelocities=o,e.header.precision.position=a[0].length-1,e.header.precision.velocity=o?a[3].length-1:0,s=20,u=e.header.precision.position+5,l=s+3*u,c=e.header.precision.velocity+4,d=N7e(n),f=ve.Undefined(e.numberOfAtoms,ve.Schema.float),p={count:e.numberOfAtoms,residueNumber:d(0,5,ve.Schema.int),residueName:d(5,5,ve.Schema.str),atomName:d(10,5,ve.Schema.str),atomNumber:d(15,5,ve.Schema.int),x:d(s,u,ve.Schema.float),y:d(s+u,u,ve.Schema.float),z:d(s+2*u,u,ve.Schema.float),vx:o?d(l,c,ve.Schema.float):f,vy:o?d(l+c,c,ve.Schema.float):f,vz:o?d(l+2*c,c,ve.Schema.float):f},[2,p]}})})}function G7e(e){var t=e.tokenizer,r=It.readLine(t).trim().split(/\s+/g);e.header.box=[+r[0],+r[1],+r[2]]}function q7e(e,t){return ce(this,void 0,void 0,function(){var r,n,i,a,o;return de(this,function(s){switch(s.label){case 0:return r=It(e),[4,t.update({message:"Parsing...",current:0,max:e.length})];case 1:s.sent(),n=[],s.label=2;case 2:return r.position<e.length?(i=j7e(r,t),z7e(i),V7e(i),[4,H7e(i)]):[3,4];case 3:return a=s.sent(),G7e(i),n.push({header:i.header,atoms:a}),[3,2];case 4:return o={structures:n},[2,In.success(o)]}})})}function $7e(e){var t=this;return $e.create("Parse GRO",function(r){return ce(t,void 0,void 0,function(){return de(this,function(n){switch(n.label){case 0:return[4,q7e(e,r)];case 1:return[2,n.sent()]}})})})}function W7e(e,t,r){var n=this;return r===void 0&&(r=!1),$e.create("Parse PDB",function(i){return ce(n,void 0,void 0,function(){var a,o,s;return de(this,function(u){switch(u.label){case 0:return o=(a=In).success,s={},[4,It.readAllLinesAsync(e,i)];case 1:return[2,o.apply(a,[(s.lines=u.sent(),s.id=t,s.isPdbqt=r,s)])]}})})})}function X7e(e,t){for(var r=0,n=t*3;r<n;r+=3){var i=e[r],a=e[r+1],o=e[r+2],s=1/Math.sqrt(i*i+a*a+o*o);e[r]=i*s,e[r+1]=a*s,e[r+2]=o*s}return e}var xo=_();function yv(e,t,r,n){for(var i=0,a=n*3;i<a;i+=3)_.fromArray(xo,t,r+i),_.transformMat4(xo,xo,e),_.toArray(xo,t,r+i)}function Y7e(e,t,r,n){for(var i=0,a=n*3;i<a;i+=3)_.fromArray(xo,t,r+i),_.transformMat3(xo,xo,e),_.toArray(xo,t,r+i)}function K7e(e,t){for(var r=0,n=e.length;r<n;r+=3)_.fromArray(xo,e,r),_.normalize(xo,xo),_.scale(xo,xo,t),_.toArray(xo,e,r)}var Aj=_(),B4=_(),Pj=_(),ys=_(),Tj=_();function vee(e,t,r,n,i){for(var a=0,o=i*3;a<o;a+=3){var s=t[a]*3,u=t[a+1]*3,l=t[a+2]*3;_.fromArray(Aj,e,s),_.fromArray(B4,e,u),_.fromArray(Pj,e,l),_.sub(ys,Pj,B4),_.sub(Tj,Aj,B4),_.cross(ys,ys,Tj),r[s]+=ys[0],r[s+1]+=ys[1],r[s+2]+=ys[2],r[u]+=ys[0],r[u+1]+=ys[1],r[u+2]+=ys[2],r[l]+=ys[0],r[l+1]+=ys[1],r[l+2]+=ys[2]}return X7e(r,n)}function w0(e,t,r){r===void 0&&(r=1);for(var n=Nl(e),i=new Int32Array(n+2),a=new Int32Array(t),o=new Int32Array(t),s=0,u=t*r;s<u;s+=r)++o[e[s]];for(var l=0,s=0;s<t;s++)i[s]=l,l+=o[s];i[t]=l;for(var c=new Int32Array(l),s=0,u=t*r;s<u;s+=r){var d=e[s],f=i[d]+a[d];c[f]=s,++a[d]}return{indices:c,offsets:i}}function Q7e(e,t){e=Math.max(e,2);var r=Math.sqrt(e),n=Math.ceil(r);n=n+(t-n%t)%t;var i=n>0?Math.ceil(e/n):0;return{width:n,height:i,length:n*i*t}}function Ca(e,t,r,n){var i=Q7e(e,t),a=i.length,o=i.width,s=i.height;return n=n&&n.length>=a?n:new r(a),{array:n,width:o,height:s}}var Ms=_(),Z7e=new ps("14"),J7e=new ps("98");function mee(e){return e>1e5?Z7e:J7e}function mp(e,t,r){var n=r*3,i=mee(t);i.reset();for(var a=0,o=t*3;a<o;a+=n)_.fromArray(Ms,e,a),i.includePosition(Ms);i.finishedIncludeStep();for(var a=0,o=t*3;a<o;a+=n)_.fromArray(Ms,e,a),i.radiusPosition(Ms);var s=i.getSphere();if(t<=98){for(var u=[],a=0,o=t*3;a<o;a+=n)u.push(_.fromArray(_(),e,a));Be.setExtrema(s,u)}return s}var U4=ue();function Yi(e,t,r){if(r===1){ue.fromArray(U4,t,0);var n=Be.clone(e);return ue.isIdentity(U4)?n:Be.transform(n,n,U4)}var i=mee(r);i.reset();var a=e.center,o=e.radius,s=e.extrema;if(s&&r<50){for(var u=0,l=r;u<l;++u)for(var c=0,d=s;c<d.length;c++){var f=d[c];_.transformMat4Offset(Ms,f,t,0,0,u*16),i.includePosition(Ms)}i.finishedIncludeStep();for(var u=0,l=r;u<l;++u)for(var p=0,v=s;p<v.length;p++){var f=v[p];_.transformMat4Offset(Ms,f,t,0,0,u*16),i.radiusPosition(Ms)}}else{for(var u=0,l=r;u<l;++u)_.transformMat4Offset(Ms,a,t,0,0,u*16),i.includePositionRadius(Ms,o);i.finishedIncludeStep();for(var u=0,l=r;u<l;++u)_.transformMat4Offset(Ms,a,t,0,0,u*16),i.radiusPositionRadius(Ms,o)}return i.getSphere()}function tu(e,t){var r=Ca(Math.max(1,e),1,Uint8Array,t&&t.tMarker.ref.value.array);return t?(F.update(t.tMarker,r),F.update(t.uMarkerTexDim,He.create(r.width,r.height)),t):{tMarker:F.create(r),uMarkerTexDim:F.create(He.create(r.width,r.height))}}var gee=new ArrayBuffer(4),e9e=new Int32Array(gee),t9e=new Float32Array(gee);function r9e(e){var t=e<-126?-126:e;return e9e[0]=(1<<23)*(t+126.94269504),t9e[0]}function n9e(e){return r9e(1.44269504*e)}var yee=new ArrayBuffer(4),i9e=new Int32Array(yee),a9e=new Float32Array(yee);function o9e(e){a9e[0]=e;var t=i9e[0]*11920928955078125e-23;return t-126.94269504}function s9e(e){return .6931471805599453*o9e(e)}var u9e=1e4;s9e(u9e+1);function u2(e,t,r){return e=Ba(e,0,16777216-1)+1,t[r+2]=e%256,e=Math.floor(e/256),t[r+1]=e%256,e=Math.floor(e/256),t[r]=e%256,t}function UL(e,t,r){return Math.floor(e)*256*256+Math.floor(t)*256+Math.floor(r)-1}var Dx=255/256,j4=_.create(256*256*256,256*256,256),l9e=Ar.create(Dx/j4[0],Dx/j4[1],Dx/j4[2],Dx/1),Ij=Ar();function c9e(e,t,r,n){return Ar.set(Ij,e/255,t/255,r/255,n/255),Ar.dot(Ij,l9e)}function Sd(e,t,r){switch(la.getGranularity(e,t.granularity)){case"uniform":return h9e(e,t.size,r);case"group":return m9e(e,t.size,r);case"groupInstance":return g9e(e,t.size,r);case"instance":return v9e(e,t.size,r)}}var DE=100;function Db(e){var t=e.dSizeType.ref.value;switch(t){case"uniform":return e.uSize.ref.value;case"instance":case"group":case"groupInstance":for(var r=0,n=e.tSize.ref.value.array,i=0,a=n.length;i<a;i+=3){var o=UL(n[i],n[i+1],n[i+2]);r<o&&(r=o)}return r/DE}}var d9e={array:new Uint8Array(3),width:1,height:1};function f9e(){return{tSize:F.create(d9e),uSizeTexDim:F.create(He.create(1,1))}}function p9e(e,t){return t?(F.update(t.uSize,e),F.updateIfChanged(t.dSizeType,"uniform"),t):E(E({uSize:F.create(e)},f9e()),{dSizeType:F.create("uniform")})}function h9e(e,t,r){return p9e(t(ss),r)}function jL(e,t,r){return r?(F.update(r.tSize,e),F.update(r.uSizeTexDim,He.create(e.width,e.height)),F.updateIfChanged(r.dSizeType,t),r):{uSize:F.create(0),tSize:F.create(e),uSizeTexDim:F.create(He.create(e.width,e.height)),dSizeType:F.create(t)}}function v9e(e,t,r){var n=e.instanceCount,i=Ca(Math.max(1,n),3,Uint8Array,r&&r.tSize.ref.value.array);for(e.reset();e.hasNext&&!e.isNextNewInstance;){var a=e.move();u2(t(a.location)*DE,i.array,a.instanceIndex*3),e.skipInstance()}return jL(i,"instance",r)}function m9e(e,t,r){var n=e.groupCount,i=Ca(Math.max(1,n),3,Uint8Array,r&&r.tSize.ref.value.array);for(e.reset();e.hasNext&&!e.isNextNewInstance;){var a=e.move();u2(t(a.location)*DE,i.array,a.groupIndex*3)}return jL(i,"group",r)}function g9e(e,t,r){var n=e.groupCount,i=e.instanceCount,a=i*n,o=Ca(Math.max(1,a),3,Uint8Array,r&&r.tSize.ref.value.array);for(e.reset();e.hasNext;){var s=e.move();u2(t(s.location)*DE,o.array,s.index*3)}return jL(o,"groupInstance",r)}function y9e(e,t,r,n){for(var i=t;i<r;++i)at.toArray(n,e,i*4),e[i*4+3]=255;return!0}function Mj(e,t,r){return e.fill(0,t*4,r*4),!0}function b9e(e,t){var r=Ca(Math.max(1,e),4,Uint8Array,t&&t.tOverpaint.ref.value.array);return t?(F.update(t.tOverpaint,r),F.update(t.uOverpaintTexDim,He.create(r.width,r.height)),F.updateIfChanged(t.dOverpaint,e>0),t):{tOverpaint:F.create(r),uOverpaintTexDim:F.create(He.create(r.width,r.height)),dOverpaint:F.create(e>0)}}var Dj={array:new Uint8Array(4),width:1,height:1};function Cd(e){return e?(F.update(e.tOverpaint,Dj),F.update(e.uOverpaintTexDim,He.create(1,1)),e):{tOverpaint:F.create(Dj),uOverpaintTexDim:F.create(He.create(1,1)),dOverpaint:F.create(!1)}}function x9e(e,t,r,n){for(var i=t;i<r;++i)e[i]=n*255;return!0}function bee(e,t){for(var r=0,n=0;n<t;++n)r+=e[n];return r/(255*t)}function S9e(e,t,r){e.fill(0,t,r)}function C9e(e,t){var r=Ca(Math.max(1,e),1,Uint8Array,t&&t.tTransparency.ref.value.array);return t?(F.update(t.tTransparency,r),F.update(t.uTransparencyTexDim,He.create(r.width,r.height)),F.updateIfChanged(t.dTransparency,e>0),F.updateIfChanged(t.transparencyAverage,bee(r.array,e)),t):{tTransparency:F.create(r),uTransparencyTexDim:F.create(He.create(r.width,r.height)),dTransparency:F.create(e>0),transparencyAverage:F.create(0)}}var Rj={array:new Uint8Array(1),width:1,height:1};function _d(e){return e?(F.update(e.tTransparency,Rj),F.update(e.uTransparencyTexDim,He.create(1,1)),e):{tTransparency:F.create(Rj),uTransparencyTexDim:F.create(He.create(1,1)),dTransparency:F.create(!1),transparencyAverage:F.create(0)}}function _9e(e,t,r,n){for(var i=t;i<r;++i)e[i]=n;return!0}function w9e(e,t,r){e.fill(0,t,r)}function E9e(e,t){var r=Ca(Math.max(1,e),1,Uint8Array,t&&t.tClipping.ref.value.array);return t?(F.update(t.tClipping,r),F.update(t.uClippingTexDim,He.create(r.width,r.height)),F.updateIfChanged(t.dClipping,e>0),t):{dClipObjectCount:F.create(0),dClipVariant:F.create("instance"),tClipping:F.create(r),uClippingTexDim:F.create(He.create(r.width,r.height)),dClipping:F.create(e>0)}}var kj={array:new Uint8Array(1),width:1,height:1};function wd(e){return e?(F.update(e.tClipping,kj),F.update(e.uClippingTexDim,He.create(1,1)),e):{dClipObjectCount:F.create(0),dClipVariant:F.create("instance"),tClipping:F.create(kj),uClippingTexDim:F.create(He.create(1,1)),dClipping:F.create(!1)}}var bv;(function(e){function t(v,h,m,g){return g?a(v,h,m,g):i(v,h,m)}e.create=t;function r(v){var h=v?v.centerBuffer.ref.value:new Float32Array(0),m=v?v.groupBuffer.ref.value:new Float32Array(0);return t(h,m,0,v)}e.createEmpty=r;function n(v){return Ga([v.pointCount,v.centerBuffer.ref.version,v.groupBuffer.ref.version])}function i(v,h,m){var g=Be(),y,b=-1,S=-1,x={kind:"points",pointCount:m,centerBuffer:F.create(v),groupBuffer:F.create(h),get boundingSphere(){var C=n(x);if(C!==b){var w=mp(x.centerBuffer.ref.value,x.pointCount,1);Be.copy(g,w),b=C}return g},get groupMapping(){return x.groupBuffer.ref.version!==S&&(y=w0(x.groupBuffer.ref.value,x.pointCount),S=x.groupBuffer.ref.version),y},setBoundingSphere:function(C){Be.copy(g,C),b=n(x)}};return x}function a(v,h,m,g){return g.pointCount=m,F.update(g.centerBuffer,v),F.update(g.groupBuffer,h),g}function o(v,h){var m=v.centerBuffer.ref.value;yv(h,m,0,v.pointCount),F.update(v.centerBuffer,m)}e.transform=o,e.Params=E(E({},Et.Params),{sizeFactor:I.Numeric(1.5,{min:0,max:10,step:.1}),pointSizeAttenuation:I.Boolean(!1),pointFilledCircle:I.Boolean(!1),pointEdgeBleach:I.Numeric(.2,{min:0,max:1,step:.05})}),e.Utils={Params:e.Params,createEmpty:r,createValues:u,createValuesSimple:l,updateValues:c,updateBoundingSphere:d,createRenderableState:f,updateRenderableState:p,createPositionIterator:s};function s(v,h){var m=v.pointCount,g=h.instanceCount.ref.value,y=Lv(),b=y.position,S=v.centerBuffer.ref.value,x=h.aTransform.ref.value,C=function(w,A){return A<0?_.fromArray(b,S,w*3):_.transformMat4Offset(b,S,x,0,w*3,A*16),y};return Sn(m,g,1,C)}function u(v,h,m,g,y){var b=m.instanceCount,S=m.groupCount,x=s(v,h),C=hs(m,x,g.color),w=Sd(m,g.size),A=tu(b*S),M=Cd(),D=_d(),k=wd(),R={drawCount:v.pointCount,vertexCount:v.pointCount,groupCount:S,instanceCount:b},O=Be.clone(v.boundingSphere),H=Yi(O,h.aTransform.ref.value,b);return E(E(E(E(E(E(E(E(E({aPosition:v.centerBuffer,aGroup:v.groupBuffer,boundingSphere:F.create(H),invariantBoundingSphere:F.create(O),uInvariantBoundingSphere:F.create(Ar.ofSphere(O))},C),w),A),M),D),k),h),Et.createValues(y,R)),{uSizeFactor:F.create(y.sizeFactor),dPointSizeAttenuation:F.create(y.pointSizeAttenuation),dPointFilledCircle:F.create(y.pointFilledCircle),uPointEdgeBleach:F.create(y.pointEdgeBleach)})}function l(v,h,m,g,y){var b=Et.createSimple(m,g,y),S=E(E({},I.getDefaultValues(e.Params)),h);return u(v,b.transform,b.locationIterator,b.theme,S)}function c(v,h){Et.updateValues(v,h),F.updateIfChanged(v.uSizeFactor,h.sizeFactor),F.updateIfChanged(v.dPointSizeAttenuation,h.pointSizeAttenuation),F.updateIfChanged(v.dPointFilledCircle,h.pointFilledCircle),F.updateIfChanged(v.uPointEdgeBleach,h.pointEdgeBleach)}function d(v,h){var m=Be.clone(h.boundingSphere),g=Yi(m,v.aTransform.ref.value,v.instanceCount.ref.value);Be.equals(g,v.boundingSphere.ref.value)||F.update(v.boundingSphere,g),Be.equals(m,v.invariantBoundingSphere.ref.value)||(F.update(v.invariantBoundingSphere,m),F.update(v.uInvariantBoundingSphere,Ar.fromSphere(v.uInvariantBoundingSphere.ref.value,m)))}function f(v){var h=Et.createRenderableState(v);return p(h,v),h}function p(v,h){Et.updateRenderableState(v,h),v.opaque=v.opaque&&(!h.pointFilledCircle||h.pointFilledCircle&&h.pointEdgeBleach===0),v.writeDepth=v.opaque}})(bv||(bv={}));function Oj(e,t,r,n,i,a,o){for(var s=0;s<t;s++){for(var u=0;u<r;u++)n[u]=e[u*t+s];Lj(n,i,a,o,r);for(var u=0;u<r;u++)e[u*t+s]=i[u]}for(var u=0;u<r;u++){for(var s=0;s<t;s++)n[s]=e[u*t+s];Lj(n,i,a,o,t);for(var s=0;s<t;s++)e[u*t+s]=Math.sqrt(i[s])}}function Lj(e,t,r,n,i){r[0]=0,n[0]=Number.MIN_SAFE_INTEGER,n[1]=Number.MAX_SAFE_INTEGER;for(var a=1,o=0;a<i;a++){for(var s=(e[a]+a*a-(e[r[o]]+r[o]*r[o]))/(2*a-2*r[o]);s<=n[o];)o--,s=(e[a]+a*a-(e[r[o]]+r[o]*r[o]))/(2*a-2*r[o]);o++,r[o]=a,n[o]=s,n[o+1]=Number.MAX_SAFE_INTEGER}for(var a=0,o=0;a<i;a++){for(;n[o+1]<a;)o++;t[a]=(a-r[o])*(a-r[o])+e[r[o]]}}var z4={};function A9e(e){var t=JSON.stringify(e);return z4[t]===void 0&&(z4[t]=new P9e(e)),z4[t]}var xee={fontFamily:I.Select("sans-serif",[["sans-serif","Sans Serif"],["monospace","Monospace"],["serif","Serif"],["cursive","Cursive"]]),fontQuality:I.Select(3,[[0,"lower"],[1,"low"],[2,"medium"],[3,"high"],[4,"higher"]]),fontStyle:I.Select("normal",[["normal","Normal"],["italic","Italic"],["oblique","Oblique"]]),fontVariant:I.Select("normal",[["normal","Normal"],["small-caps","Small Caps"]]),fontWeight:I.Select("normal",[["normal","Normal"],["bold","Bold"]])},P9e=function(){function e(t){t===void 0&&(t={}),this.mapped={},this.scratchW=0,this.scratchH=0,this.currentX=0,this.currentY=0,this.cutoff=.5;var r=E(E({},I.getDefaultValues(xee)),t);this.props=r;var n=32*(r.fontQuality+1);this.buffer=n/8,this.radius=n/3,this.lineHeight=Math.round(n+2*this.buffer+this.radius),this.maxWidth=Math.round(this.lineHeight*.75),this.texture=Ca(350*this.lineHeight*this.maxWidth,1,Uint8Array),this.scratchCanvas=document.createElement("canvas"),this.scratchCanvas.width=this.maxWidth,this.scratchCanvas.height=this.lineHeight,this.scratchContext=this.scratchCanvas.getContext("2d"),this.scratchContext.font=r.fontStyle+" "+r.fontVariant+" "+r.fontWeight+" "+n+"px "+r.fontFamily,this.scratchContext.fillStyle="black",this.scratchContext.textBaseline="middle",this.scratchData=new Uint8Array(this.lineHeight*this.maxWidth),this.gridOuter=new Float64Array(this.lineHeight*this.maxWidth),this.gridInner=new Float64Array(this.lineHeight*this.maxWidth),this.f=new Float64Array(Math.max(this.lineHeight,this.maxWidth)),this.d=new Float64Array(Math.max(this.lineHeight,this.maxWidth)),this.z=new Float64Array(Math.max(this.lineHeight,this.maxWidth)+1),this.v=new Int16Array(Math.max(this.lineHeight,this.maxWidth)),this.middle=Math.ceil(this.lineHeight/2),this.placeholder=this.get(String.fromCharCode(65533))}return e.prototype.get=function(t){if(this.mapped[t]===void 0){this.draw(t);var r=this.texture,n=r.array,i=r.width,a=r.height,o=this.scratchData;if(this.currentX+this.scratchW>i&&(this.currentX=0,this.currentY+=this.scratchH),this.currentY+this.scratchH>a)return console.warn("canvas to small"),this.placeholder;this.mapped[t]={x:this.currentX,y:this.currentY,w:this.scratchW,h:this.scratchH,nw:this.scratchW/this.lineHeight,nh:this.scratchH/this.lineHeight};for(var s=0;s<this.scratchH;++s)for(var u=0;u<this.scratchW;++u)n[i*(this.currentY+s)+this.currentX+u]=o[s*this.scratchW+u];this.currentX+=this.scratchW}return this.mapped[t]},e.prototype.draw=function(t){var r=this.lineHeight,n=this.scratchContext,i=this.scratchData,a=n.measureText(t),o=Math.min(this.maxWidth,Math.ceil(a.width+2*this.buffer)),s=o*r;n.clearRect(0,0,o,r),n.fillText(t,this.buffer,this.middle);for(var u=n.getImageData(0,0,o,r),l=0;l<s;l++){var c=u.data[l*4+3]/255;this.gridOuter[l]=c===1?0:c===0?Number.MAX_SAFE_INTEGER:Math.pow(Math.max(0,.5-c),2),this.gridInner[l]=c===1?Number.MAX_SAFE_INTEGER:c===0?0:Math.pow(Math.max(0,c-.5),2)}Oj(this.gridOuter,o,r,this.f,this.d,this.v,this.z),Oj(this.gridInner,o,r,this.f,this.d,this.v,this.z);for(var l=0;l<s;l++){var d=this.gridOuter[l]-this.gridInner[l];i[l]=Math.max(0,Math.min(255,Math.round(255-255*(d/this.radius+this.cutoff))))}this.scratchW=o,this.scratchH=r},e}(),Ks;(function(e){function t(p,v,h,m,g,y,b,S,x){return x?a(p,v,h,m,g,y,b,S,x):i(p,v,h,m,g,y,b,S)}e.create=t;function r(p){var v=p?p.fontTexture.ref.value:Ca(0,1,Uint8Array),h=p?p.centerBuffer.ref.value:new Float32Array(0),m=p?p.mappingBuffer.ref.value:new Float32Array(0),g=p?p.depthBuffer.ref.value:new Float32Array(0),y=p?p.indexBuffer.ref.value:new Uint32Array(0),b=p?p.groupBuffer.ref.value:new Float32Array(0),S=p?p.tcoordBuffer.ref.value:new Float32Array(0);return t(v,h,m,g,y,b,S,0,p)}e.createEmpty=r;function n(p){return Ga([p.charCount,p.fontTexture.ref.version,p.centerBuffer.ref.version,p.mappingBuffer.ref.version,p.depthBuffer.ref.version,p.indexBuffer.ref.version,p.groupBuffer.ref.version,p.tcoordBuffer.ref.version])}function i(p,v,h,m,g,y,b,S){var x=Be(),C,w=-1,A=-1,M={kind:"text",charCount:S,fontTexture:F.create(p),centerBuffer:F.create(v),mappingBuffer:F.create(h),depthBuffer:F.create(m),indexBuffer:F.create(g),groupBuffer:F.create(y),tcoordBuffer:F.create(b),get boundingSphere(){var D=n(M);if(D!==w){var k=mp(M.centerBuffer.ref.value,M.charCount*4,4);Be.copy(x,k),w=D}return x},get groupMapping(){return M.groupBuffer.ref.version!==A&&(C=w0(M.groupBuffer.ref.value,M.charCount,4),A=M.groupBuffer.ref.version),C},setBoundingSphere:function(D){Be.copy(x,D),w=n(M)}};return M}function a(p,v,h,m,g,y,b,S,x){return x.charCount=S,F.update(x.fontTexture,p),F.update(x.centerBuffer,v),F.update(x.mappingBuffer,h),F.update(x.depthBuffer,m),F.update(x.indexBuffer,g),F.update(x.groupBuffer,y),F.update(x.tcoordBuffer,b),x}e.Params=E(E(E({},Et.Params),xee),{sizeFactor:I.Numeric(1,{min:0,max:10,step:.1}),borderWidth:I.Numeric(0,{min:0,max:.5,step:.01}),borderColor:I.Color(fr.grey),offsetX:I.Numeric(0,{min:0,max:10,step:.1}),offsetY:I.Numeric(0,{min:0,max:10,step:.1}),offsetZ:I.Numeric(0,{min:0,max:10,step:.1}),background:I.Boolean(!1),backgroundMargin:I.Numeric(.2,{min:0,max:1,step:.01}),backgroundColor:I.Color(fr.grey),backgroundOpacity:I.Numeric(1,{min:0,max:1,step:.01}),tether:I.Boolean(!1),tetherLength:I.Numeric(1,{min:0,max:5,step:.1}),tetherBaseWidth:I.Numeric(.3,{min:0,max:1,step:.01}),attachment:I.Select("middle-center",[["bottom-left","bottom-left"],["bottom-center","bottom-center"],["bottom-right","bottom-right"],["middle-left","middle-left"],["middle-center","middle-center"],["middle-right","middle-right"],["top-left","top-left"],["top-center","top-center"],["top-right","top-right"]])}),e.Utils={Params:e.Params,createEmpty:r,createValues:s,createValuesSimple:u,updateValues:l,updateBoundingSphere:c,createRenderableState:d,updateRenderableState:f,createPositionIterator:o};function o(p,v){var h=p.charCount*4,m=v.instanceCount.ref.value,g=Lv(),y=g.position,b=p.centerBuffer.ref.value,S=v.aTransform.ref.value,x=function(C,w){return w<0?_.fromArray(y,b,C*3):_.transformMat4Offset(y,b,S,0,C*3,w*16),g};return Sn(h,m,4,x)}function s(p,v,h,m,g){var y=h.instanceCount,b=h.groupCount,S=o(p,v),x=hs(h,S,m.color),C=Sd(h,m.size),w=tu(y*b),A=Cd(),M=_d(),D=wd(),k={drawCount:p.charCount*2*3,vertexCount:p.charCount*4,groupCount:b,instanceCount:y},R=Fj(p.mappingBuffer.ref.value,p.depthBuffer.ref.value,p.charCount,Db(C)),O=Be.expand(Be(),p.boundingSphere,R),H=Yi(O,v.aTransform.ref.value,y);return E(E(E(E(E(E(E(E(E(E({aPosition:p.centerBuffer,aMapping:p.mappingBuffer,aDepth:p.depthBuffer,aGroup:p.groupBuffer,elements:p.indexBuffer,boundingSphere:F.create(H),invariantBoundingSphere:F.create(O),uInvariantBoundingSphere:F.create(Ar.ofSphere(O))},x),C),w),A),M),D),v),{aTexCoord:p.tcoordBuffer,tFont:p.fontTexture,padding:F.create(R)}),Et.createValues(g,k)),{uSizeFactor:F.create(g.sizeFactor),uBorderWidth:F.create(Ba(g.borderWidth/2,0,.5)),uBorderColor:F.create(at.toArrayNormalized(g.borderColor,_.zero(),0)),uOffsetX:F.create(g.offsetX),uOffsetY:F.create(g.offsetY),uOffsetZ:F.create(g.offsetZ),uBackgroundColor:F.create(at.toArrayNormalized(g.backgroundColor,_.zero(),0)),uBackgroundOpacity:F.create(g.backgroundOpacity)})}function u(p,v,h,m,g){var y=Et.createSimple(h,m,g),b=E(E({},I.getDefaultValues(e.Params)),v);return s(p,y.transform,y.locationIterator,y.theme,b)}function l(p,v){Et.updateValues(p,v),F.updateIfChanged(p.uSizeFactor,v.sizeFactor),F.updateIfChanged(p.uBorderWidth,v.borderWidth),at.fromNormalizedArray(p.uBorderColor.ref.value,0)!==v.borderColor&&(at.toArrayNormalized(v.borderColor,p.uBorderColor.ref.value,0),F.update(p.uBorderColor,p.uBorderColor.ref.value)),F.updateIfChanged(p.uOffsetX,v.offsetX),F.updateIfChanged(p.uOffsetY,v.offsetY),F.updateIfChanged(p.uOffsetZ,v.offsetZ),at.fromNormalizedArray(p.uBackgroundColor.ref.value,0)!==v.backgroundColor&&(at.toArrayNormalized(v.backgroundColor,p.uBackgroundColor.ref.value,0),F.update(p.uBackgroundColor,p.uBackgroundColor.ref.value)),F.updateIfChanged(p.uBackgroundOpacity,v.backgroundOpacity)}function c(p,v){var h=Fj(p.aMapping.ref.value,p.aDepth.ref.value,v.charCount,Db(p)),m=Be.expand(Be(),v.boundingSphere,h),g=Yi(m,p.aTransform.ref.value,p.instanceCount.ref.value);Be.equals(g,p.boundingSphere.ref.value)||F.update(p.boundingSphere,g),Be.equals(m,p.invariantBoundingSphere.ref.value)||(F.update(p.invariantBoundingSphere,m),F.update(p.uInvariantBoundingSphere,Ar.fromSphere(p.uInvariantBoundingSphere.ref.value,m))),F.update(p.padding,h)}function d(p){var v=Et.createRenderableState(p);return f(v,p),v}function f(p,v){Et.updateRenderableState(p,v),p.pickable=!1,p.opaque=!1,p.writeDepth=!0}})(Ks||(Ks={}));function Fj(e,t,r,n){for(var i=0,a=0,o=0,s=r*4;o<s;++o){var u=2*o,l=Math.abs(e[u]);l>i&&(i=l);var c=Math.abs(e[u+1]);c>i&&(i=c);var d=Math.abs(t[o]);d>a&&(a=d)}return Math.max(a,n+n*i)}var Ju=_(),el=_(),Up=_(),Nj=qe.add,Rx=qe.add3,ls;(function(e){function t(r,n,i){r===void 0&&(r=2048),n===void 0&&(n=1024);var a=qe.create(Float32Array,1,n,i?i.groupBuffer.ref.value:r),o=qe.create(Float32Array,3,n,i?i.startBuffer.ref.value:r),s=qe.create(Float32Array,3,n,i?i.endBuffer.ref.value:r),u=function(d,f,p,v,h,m,g){for(var y=0;y<4;++y)Rx(o,d,f,p),Rx(s,v,h,m),Nj(a,g)},l=function(d,f,p){for(var v=0;v<4;++v)Rx(o,d[0],d[1],d[2]),Rx(s,f[0],f[1],f[2]),Nj(a,p)},c=function(d,f,p,v){var h=_.distance(d,f),m=Math.floor(p/2),g=1/p;_.sub(Up,f,d);for(var y=0;y<m;++y){var b=g*(y*2+1);_.setMagnitude(Up,Up,h*b),_.add(Ju,d,Up),_.setMagnitude(Up,Up,h*g*((y+1)*2)),_.add(el,d,Up),u(Ju[0],Ju[1],Ju[2],el[0],el[1],el[2],v)}};return{add:u,addVec:l,addFixedCountDashes:c,addFixedLengthDashes:function(d,f,p,v){var h=_.distance(d,f);c(d,f,h/p,v)},addCage:function(d,f,p){for(var v=f.vertices,h=f.edges,m=0,g=h.length;m<g;m+=2)_.fromArray(Ju,v,h[m]*3),_.fromArray(el,v,h[m+1]*3),_.transformMat4(Ju,Ju,d),_.transformMat4(el,el,d),u(Ju[0],Ju[1],Ju[2],el[0],el[1],el[2],p)},getLines:function(){var d=a.elementCount/4,f=qe.compact(a,!0),p=qe.compact(o,!0),v=qe.compact(s,!0),h=i&&d<=i.lineCount?i.mappingBuffer.ref.value:new Float32Array(d*8),m=i&&d<=i.lineCount?i.indexBuffer.ref.value:new Uint32Array(d*6);return(!i||d>i.lineCount)&&T9e(d,h,m),wn.create(h,m,f,p,v,d,i)}}}e.create=t})(ls||(ls={}));function T9e(e,t,r){for(var n=0;n<e;++n){var i=n*8;t[i]=-1,t[i+1]=-1,t[i+2]=1,t[i+3]=-1,t[i+4]=-1,t[i+5]=1,t[i+6]=1,t[i+7]=1}for(var n=0;n<e;++n){var a=n*4,o=n*6;r[o]=a,r[o+1]=a+1,r[o+2]=a+2,r[o+3]=a+1,r[o+4]=a+3,r[o+5]=a+2}}var wn;(function(e){function t(p,v,h,m,g,y,b){return b?o(p,v,h,m,g,y,b):a(p,v,h,m,g,y)}e.create=t;function r(p){var v=p?p.mappingBuffer.ref.value:new Float32Array(0),h=p?p.indexBuffer.ref.value:new Uint32Array(0),m=p?p.groupBuffer.ref.value:new Float32Array(0),g=p?p.startBuffer.ref.value:new Float32Array(0),y=p?p.endBuffer.ref.value:new Float32Array(0);return t(v,h,m,g,y,0,p)}e.createEmpty=r;function n(p,v){for(var h=p.vertexBuffer.ref.value,m=p.indexBuffer.ref.value,g=p.groupBuffer.ref.value,y=ls.create(p.triangleCount*3,p.triangleCount/10,v),b=0,S=p.triangleCount*3;b<S;b+=3){var x=m[b],C=m[b+1],w=m[b+2],A=h[x*3],M=h[x*3+1],D=h[x*3+2],k=h[C*3],R=h[C*3+1],O=h[C*3+2],H=h[w*3],B=h[w*3+1],j=h[w*3+2];y.add(A,M,D,k,R,O,g[x]),y.add(A,M,D,H,B,j,g[x]),y.add(k,R,O,H,B,j,g[C])}return y.getLines()}e.fromMesh=n;function i(p){return Ga([p.lineCount,p.mappingBuffer.ref.version,p.indexBuffer.ref.version,p.groupBuffer.ref.version,p.startBuffer.ref.version,p.endBuffer.ref.version])}function a(p,v,h,m,g,y){var b=Be(),S,x=-1,C=-1,w={kind:"lines",lineCount:y,mappingBuffer:F.create(p),indexBuffer:F.create(v),groupBuffer:F.create(h),startBuffer:F.create(m),endBuffer:F.create(g),get boundingSphere(){var A=i(w);if(A!==x){var M=mp(w.startBuffer.ref.value,w.lineCount*4,4),D=mp(w.endBuffer.ref.value,w.lineCount*4,4);Be.expandBySphere(b,M,D),x=A}return b},get groupMapping(){return w.groupBuffer.ref.version!==C&&(S=w0(w.groupBuffer.ref.value,w.lineCount,4),C=w.groupBuffer.ref.version),S},setBoundingSphere:function(A){Be.copy(b,A),x=i(w)}};return w}function o(p,v,h,m,g,y,b){return y>b.lineCount&&(F.update(b.mappingBuffer,p),F.update(b.indexBuffer,v)),b.lineCount=y,F.update(b.groupBuffer,h),F.update(b.startBuffer,m),F.update(b.endBuffer,g),b}function s(p,v){var h=p.startBuffer.ref.value;yv(v,h,0,p.lineCount*4),F.update(p.startBuffer,h);var m=p.endBuffer.ref.value;yv(v,m,0,p.lineCount*4),F.update(p.endBuffer,m)}e.transform=s,e.Params=E(E({},Et.Params),{sizeFactor:I.Numeric(1.5,{min:0,max:10,step:.1}),lineSizeAttenuation:I.Boolean(!1)}),e.Utils={Params:e.Params,createEmpty:r,createValues:l,createValuesSimple:c,updateValues:d,updateBoundingSphere:f,createRenderableState:Et.createRenderableState,updateRenderableState:Et.updateRenderableState,createPositionIterator:u};function u(p,v){var h=p.lineCount*4,m=v.instanceCount.ref.value,g=Lv(),y=g.position,b=p.startBuffer.ref.value,S=p.endBuffer.ref.value,x=v.aTransform.ref.value,C=function(w,A){var M=w%4===0?b:S;return A<0?_.fromArray(y,M,w*3):_.transformMat4Offset(y,M,x,0,w*3,A*16),g};return Sn(h,m,2,C)}function l(p,v,h,m,g){var y=h.instanceCount,b=h.groupCount,S=u(p,v),x=hs(h,S,m.color),C=Sd(h,m.size),w=tu(y*b),A=Cd(),M=_d(),D=wd(),k={drawCount:p.lineCount*2*3,vertexCount:p.lineCount*4,groupCount:b,instanceCount:y},R=Be.clone(p.boundingSphere),O=Yi(R,v.aTransform.ref.value,y);return E(E(E(E(E(E(E(E(E({aMapping:p.mappingBuffer,aGroup:p.groupBuffer,aStart:p.startBuffer,aEnd:p.endBuffer,elements:p.indexBuffer,boundingSphere:F.create(O),invariantBoundingSphere:F.create(R),uInvariantBoundingSphere:F.create(Ar.ofSphere(R))},x),C),w),A),M),D),v),Et.createValues(g,k)),{uSizeFactor:F.create(g.sizeFactor),dLineSizeAttenuation:F.create(g.lineSizeAttenuation),dDoubleSided:F.create(!0),dFlipSided:F.create(!1)})}function c(p,v,h,m,g){var y=Et.createSimple(h,m,g),b=E(E({},I.getDefaultValues(e.Params)),v);return l(p,y.transform,y.locationIterator,y.theme,b)}function d(p,v){Et.updateValues(p,v),F.updateIfChanged(p.uSizeFactor,v.sizeFactor),F.updateIfChanged(p.dLineSizeAttenuation,v.lineSizeAttenuation)}function f(p,v){var h=Be.clone(v.boundingSphere),m=Yi(h,p.aTransform.ref.value,p.instanceCount.ref.value);Be.equals(m,p.boundingSphere.ref.value)||F.update(p.boundingSphere,m),Be.equals(h,p.invariantBoundingSphere.ref.value)||(F.update(p.invariantBoundingSphere,h),F.update(p.uInvariantBoundingSphere,Ar.fromSphere(p.uInvariantBoundingSphere.ref.value,h)))}})(wn||(wn={}));var Bj=_(),Uj=_(),jj=_();function RE(e,t){for(var r=t.length,n=E0(r/3),i=0;i<r;i+=3)_.fromArray(Bj,e,t[i]*3),_.fromArray(Uj,e,t[i+1]*3),_.fromArray(jj,e,t[i+2]*3),n.add(Bj,Uj,jj);return n.getPrimitive()}var kx=_();function E0(e,t){t===void 0&&(t=e*3);var r=new Float32Array(t*3),n=new Float32Array(t*3),i=new Uint32Array(e*3),a=0,o=0;return{add:function(s,u,l){_.toArray(s,r,a),_.toArray(u,r,a+3),_.toArray(l,r,a+6),_.triangleNormal(kx,s,u,l);for(var c=0;c<3;++c)_.toArray(kx,n,a+3*c),i[o+c]=a/3+c;a+=9,o+=3},addQuad:function(s,u,l,c){_.toArray(s,r,a),_.toArray(u,r,a+3),_.toArray(l,r,a+6),_.toArray(c,r,a+9),_.triangleNormal(kx,s,u,l);for(var d=0;d<4;++d)_.toArray(kx,n,a+3*d);var f=a/3;i[o]=f,i[o+1]=f+1,i[o+2]=f+2,i[o+3]=f+2,i[o+4]=f+3,i[o+5]=f,a+=12,o+=6},getPrimitive:function(){return{vertices:r,normals:n,indices:i}}}}var dm=_(),I9e=$n();function zL(e,t){for(var r=e.vertices,n=e.normals,i=$n.directionTransform(I9e,t),a=0,o=r.length;a<o;a+=3)_.transformMat4(dm,_.fromArray(dm,r,a),t),_.toArray(dm,r,a),_.transformMat3(dm,_.fromArray(dm,n,a),i),_.toArray(dm,n,a);return e}function ql(e,t,r){r===void 0&&(r=-1);for(var n=new Float32Array(e*3),i=r===-1?e<=4?Math.sqrt(2)/2:.6:r,a=t?1:0,o=0,s=e;o<s;++o){var u=(o*2+a)/e*Math.PI;n[o*3]=Math.cos(u)*i,n[o*3+1]=Math.sin(u)*i,n[o*3+2]=0}return n}function VL(e,t){return{vertices:e,edges:t}}function See(e){return{vertices:new Float32Array(e.vertices),edges:new Uint32Array(e.edges)}}var V4=_.zero();function Cee(e,t){for(var r=e.vertices,n=0,i=r.length;n<i;n+=3)_.transformMat4(V4,_.fromArray(V4,r,n),t),_.toArray(V4,r,n);return e}var ec=_(),tc=_(),rc=_(),fm=_(),Qn=ql(4,!0);function _ee(e){for(var t=12,r=e?12*3:6*4,n=E0(t,r),i=0;i<4;++i){var a=(i+1)%4;_.set(ec,Qn[i*3],Qn[i*3+1],-.5),_.set(tc,Qn[a*3],Qn[a*3+1],-.5),_.set(rc,Qn[a*3],Qn[a*3+1],.5),_.set(fm,Qn[i*3],Qn[i*3+1],.5),e?n.add(ec,tc,rc):n.addQuad(ec,tc,rc,fm)}return _.set(ec,Qn[0],Qn[1],-.5),_.set(tc,Qn[3],Qn[4],-.5),_.set(rc,Qn[6],Qn[7],-.5),_.set(fm,Qn[9],Qn[10],-.5),e?n.add(rc,tc,ec):n.addQuad(fm,rc,tc,ec),_.set(ec,Qn[0],Qn[1],.5),_.set(tc,Qn[3],Qn[4],.5),_.set(rc,Qn[6],Qn[7],.5),_.set(fm,Qn[9],Qn[10],.5),e?n.add(ec,tc,rc):n.addQuad(ec,tc,rc,fm),n.getPrimitive()}var H4;function HL(){return H4||(H4=_ee(!1)),H4}var G4;function M9e(){return G4||(G4=_ee(!0)),G4}var q4;function wee(){return q4||(q4=VL([.5,.5,-.5,-.5,.5,-.5,-.5,-.5,-.5,.5,-.5,-.5,.5,.5,.5,-.5,.5,.5,-.5,-.5,.5,.5,-.5,.5],[0,4,1,5,2,6,3,7,0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4])),q4}function zj(e){return e.map(function(t){return{x:t[0],alpha:t[1]}})}function Vj(e,t,r){for(var n=Nt(Nt([{x:0,alpha:0},{x:0,alpha:0}],e),[{x:1,alpha:0},{x:1,alpha:0}]),i=Bu.create({domain:[0,1],listOrName:t}),a=256,o=r?r.ref.value.array:new Uint8Array(a*4),s=0,u,l,c,d,f,p,v=e.length+1,h=0;h<v;++h){u=n[h+1].x,l=n[h+2].x,c=n[h].alpha,d=n[h+1].alpha,f=n[h+2].alpha,p=n[h+3].alpha;for(var m=Math.round((l-u)*a),g=0;g<m;++g){var y=g/m;o[s*4+3]=Math.max(0,WS(c,d,f,p,y,.5)*255),i.colorToArray(s/255,o,s*4),++s}}var b={array:o,width:256,height:1};return r?(F.update(r,b),r):F.create(b)}function D9e(e,t,r){if(r)return Hj(e,t,r.min,r.max);var n=jo(e),i=n[0],a=n[1];return Hj(e,t,i,a)}function Hj(e,t,r,n){var i=(n-r)/t;i===0&&(i=1);for(var a=new Int32Array(t),o=0,s=e.length;o<s;o++){var u=Math.floor((e[o]-r)/i);u>=t?u=t-1:u<0&&(u=0),a[u]++}return{min:r,max:n,binWidth:i,counts:a}}var Ra;(function(e){e.One={transform:{kind:"matrix",matrix:ue.identity()},cells:Mr.create(Mr.Space([1,1,1],[0,1,2]),Mr.Data1([0])),stats:{min:0,max:0,mean:0,sigma:0}};var t=ue.zero(),r=ue.zero();function n(u){if(u.transform.kind==="matrix")return ue.copy(ue(),u.transform.matrix);if(u.transform.kind==="spacegroup"){var l=u.cells.space,c=ue.fromScaling(t,_.div(_.zero(),Xt.size(_.zero(),u.transform.fractionalBox),_.ofArray(l.dimensions))),d=ue.fromTranslation(r,u.transform.fractionalBox.min);return ue.mul3(ue.zero(),u.transform.cell.fromFractional,d,c)}return ue.identity()}e.getGridToCartesianTransform=n;function i(u,l){return u===l}e.areEquivalent=i;function a(u){return u.cells.data.length===0}e.isEmpty=a;function o(u,l){l||(l=Be());var c=u.cells.space.dimensions,d=e.getGridToCartesianTransform(u);return Be.fromDimensionsAndTransform(l,c,d)}e.getBoundingSphere=o;function s(u,l){var c=u._historams;return c||(c=u._historams={}),c[l]||(c[l]=D9e(u.cells.data,l,{min:u.stats.min,max:u.stats.max})),c[l]}e.getHistogram=s})(Ra||(Ra={}));function R9e(e,t){var r=this;return $e.create("Create Volume",function(){return ce(r,void 0,void 0,function(){var n,i,a,o,s,u,l,c,d,f,p,v,h,m,g,y,b;return de(this,function(S){if(n=e.header,i=e.values,a=Mr.Space(n.dim,[0,1,2],Float64Array),n.dataSetIds.length===0)o=i;else for(s=n.dim,u=s[0],l=s[1],c=s[2],d=((t==null?void 0:t.dataIndex)||0)+1,f=0,p=0,o=new Float64Array(u*l*c),v=0;v<u;v++)for(h=0;h<l;h++)for(m=0;m<c;m++)o[f++]=i[p],p+=d;return g=Mr.create(a,Mr.Data1(o)),y=ue.fromTranslation(ue(),n.origin),b=ue.fromBasis(ue(),n.basisX,n.basisY,n.basisZ),ue.mul(y,y,b),[2,{label:t==null?void 0:t.label,entryId:t==null?void 0:t.entryId,grid:{transform:{kind:"matrix",matrix:y},cells:g,stats:{min:pE(o),max:Nl(o),mean:hE(o),sigma:vE(o)}},sourceData:tw.create(e),customProperties:new Hl,_propertyData:Object.create(null)}]})})})}var tw;(function(e){function t(n){return(n==null?void 0:n.kind)==="cube"}e.is=t;function r(n){return{kind:"cube",name:n.name,data:n}}e.create=r})(tw||(tw={}));var Ct;(function(e){function t(f){var p,v,h,m;return((m=(h=(v=(p=f==null?void 0:f.grid)===null||p===void 0?void 0:p.cells)===null||v===void 0?void 0:v.space)===null||h===void 0?void 0:h.dimensions)===null||m===void 0?void 0:m.length)&&(f==null?void 0:f.sourceData)&&(f==null?void 0:f.customProperties)&&(f==null?void 0:f._propertyData)}e.is=t,function(f){function p(x,C,w){return yn(y(x,w).absoluteValue,y(C,w).absoluteValue,w.sigma/100)}f.areSame=p;function v(x){return{kind:"absolute",absoluteValue:x}}f.absolute=v;function h(x){return{kind:"relative",relativeValue:x}}f.relative=h;function m(x,C){return C*x.sigma+x.mean}f.calcAbsolute=m;function g(x,C){return x.sigma===0?0:(C-x.mean)/x.sigma}f.calcRelative=g;function y(x,C){return x.kind==="absolute"?x:{kind:"absolute",absoluteValue:f.calcAbsolute(C,x.relativeValue)}}f.toAbsolute=y;function b(x,C){return x.kind==="relative"?x:{kind:"relative",relativeValue:f.calcRelative(C,x.absoluteValue)}}f.toRelative=b;function S(x){return x.kind==="relative"?x.relativeValue.toFixed(2)+" ":""+x.absoluteValue.toPrecision(4)}f.toString=S}(e.IsoValue||(e.IsoValue={}));var r={min:-1,max:1,mean:0,sigma:.1};function n(f,p){var v=p||r,h=v.min,m=v.max,g=v.mean,y=v.sigma,b=(h-g)/y,S=(m-g)/y,x=f;return f.kind==="absolute"?f.absoluteValue<h?x=e.IsoValue.absolute(h):f.absoluteValue>m&&(x=e.IsoValue.absolute(m)):f.relativeValue<b?x=e.IsoValue.relative(b):f.relativeValue>S&&(x=e.IsoValue.relative(S)),I.Conditioned(x,{absolute:I.Converted(function(C){return e.IsoValue.toAbsolute(C,Ra.One.stats).absoluteValue},function(C){return e.IsoValue.absolute(C)},I.Numeric(g,{min:h,max:m,step:nD(y/100,2)})),relative:I.Converted(function(C){return e.IsoValue.toRelative(C,Ra.One.stats).relativeValue},function(C){return e.IsoValue.relative(C)},I.Numeric(Math.min(1,S),{min:b,max:S,step:nD(Math.round((m-h)/y)/100,2)}))},function(C){return C.kind==="absolute"?"absolute":"relative"},function(C,w){return w==="absolute"?e.IsoValue.toAbsolute(C,v):e.IsoValue.toRelative(C,v)},{isEssential:!0})}e.createIsoValueParam=n,e.IsoValueParam=n(e.IsoValue.relative(2)),e.One={label:"",grid:Ra.One,sourceData:{kind:"",name:"",data:{}},customProperties:new Hl,_propertyData:Object.create(null)};function i(f,p){return Ra.areEquivalent(f.grid,p.grid)}e.areEquivalent=i;function a(f){return Ra.isEmpty(f.grid)}e.isEmpty=a;function o(f){return tw.is(f.sourceData)?f.sourceData.data.header.orbitals:!1}e.isOrbitals=o;function s(f){return{kind:"volume-loci",volume:f}}e.Loci=s;function u(f){return!!f&&f.kind==="volume-loci"}e.isLoci=u;function l(f,p){return f.volume===p.volume}e.areLociEqual=l;function c(f){return Ra.isEmpty(f.volume.grid)}e.isLociEmpty=c;function d(f,p){return Ra.getBoundingSphere(f.grid,p)}e.getBoundingSphere=d,function(f){function p(y,b){return{kind:"isosurface-loci",volume:y,isoValue:b}}f.Loci=p;function v(y){return!!y&&y.kind==="isosurface-loci"}f.isLoci=v;function h(y,b){return y.volume===b.volume&&e.IsoValue.areSame(y.isoValue,b.isoValue,y.volume.grid.stats)}f.areLociEqual=h;function m(y){return y.volume.grid.cells.data.length===0}f.isLociEmpty=m;function g(y,b,S){return e.getBoundingSphere(y,S)}f.getBoundingSphere=g}(e.Isosurface||(e.Isosurface={})),function(f){function p(S,x){return{kind:"cell-loci",volume:S,indices:x}}f.Loci=p;function v(S){return!!S&&S.kind==="cell-loci"}f.isLoci=v;function h(S,x){return S.volume===x.volume&&Le.areEqual(S.indices,x.indices)}f.areLociEqual=h;function m(S){return Le.size(S.indices)===0}f.isLociEmpty=m;var g=new ps("98"),y=_();function b(S,x,C){g.reset();for(var w=Ra.getGridToCartesianTransform(S.grid),A=S.grid.cells.space.getCoords,M=0,D=Le.size(x);M<D;M++){var k=Le.getAt(x,M);A(k,y),_.transformMat4(y,y,w),g.includePosition(y)}g.finishedIncludeStep();for(var M=0,D=Le.size(x);M<D;M++){var k=Le.getAt(x,M);A(k,y),_.transformMat4(y,y,w),g.radiusPosition(y)}var R=g.getSphere(C);return Be.expand(R,R,ue.getMaxScaleOnAxis(w)*10)}f.getBoundingSphere=b}(e.Cell||(e.Cell={}))})(Ct||(Ct={}));var $4=HL(),io;(function(e){function t(y,b,S,x,C,w,A,M,D){return D?i(y,b,S,x,C,w,A,M,D):n(y,b,S,x,C,w,A,M)}e.create=t;function r(y){return Ga([y.bboxSize.ref.version,y.gridDimension.ref.version,y.gridTexture.ref.version,y.transform.ref.version,y.gridStats.ref.version])}function n(y,b,S,x,C,w,A,M){var D=Be(),k=-1,R=w.getWidth(),O=w.getHeight(),H=w.getDepth(),B={kind:"direct-volume",gridDimension:F.create(b),gridTexture:F.create(w),gridTextureDim:F.create(_.create(R,O,H)),gridStats:F.create(Ar.create(A.min,A.max,A.mean,A.sigma)),bboxMin:F.create(y.min),bboxMax:F.create(y.max),bboxSize:F.create(_.sub(_(),y.max,y.min)),transform:F.create(S),cellDim:F.create(C),unitToCartn:F.create(x),cartnToUnit:F.create(ue.invert(ue(),x)),get boundingSphere(){var j=r(B);if(j!==k){var Y=k9e(B.gridDimension.ref.value,B.transform.ref.value);Be.copy(D,Y),k=j}return D},packedGroup:F.create(M),setBoundingSphere:function(j){Be.copy(D,j),k=r(B)}};return B}function i(y,b,S,x,C,w,A,M,D){var k=w.getWidth(),R=w.getHeight(),O=w.getDepth();return F.update(D.gridDimension,b),F.update(D.gridTexture,w),F.update(D.gridTextureDim,_.set(D.gridTextureDim.ref.value,k,R,O)),F.update(D.gridStats,Ar.set(D.gridStats.ref.value,A.min,A.max,A.mean,A.sigma)),F.update(D.bboxMin,y.min),F.update(D.bboxMax,y.max),F.update(D.bboxSize,_.sub(D.bboxSize.ref.value,y.max,y.min)),F.update(D.transform,S),F.update(D.cellDim,C),F.update(D.unitToCartn,x),F.update(D.cartnToUnit,ue.invert(ue(),x)),F.updateIfChanged(D.packedGroup,M),D}function a(y){return{}}e.createEmpty=a;function o(y){var b=y?Ct.createIsoValueParam(Ct.IsoValue.relative(2),y):Ct.IsoValueParam;return I.MappedStatic("volume",{isosurface:I.Group({isoValue:b,singleLayer:I.Boolean(!1,{isEssential:!0})},{isFlat:!0}),volume:I.Group({controlPoints:I.LineGraph([He.create(.19,0),He.create(.2,.05),He.create(.25,.05),He.create(.26,0),He.create(.79,0),He.create(.8,.05),He.create(.85,.05),He.create(.86,0)]),list:I.ColorList({kind:"interpolate",colors:[[fr.white,0],[fr.red,.25],[fr.white,.5],[fr.blue,.75],[fr.white,1]]},{offsets:!0})},{isFlat:!0})},{isEssential:!0})}e.createRenderModeParam=o,e.Params=E(E({},Et.Params),{doubleSided:I.Boolean(!1,Et.CustomQualityParamInfo),flipSided:I.Boolean(!1,Et.ShadingCategory),flatShaded:I.Boolean(!1,Et.ShadingCategory),ignoreLight:I.Boolean(!1,Et.ShadingCategory),xrayShaded:I.Boolean(!1,Et.ShadingCategory),renderMode:o(),stepsPerCell:I.Numeric(5,{min:1,max:20,step:1}),jumpLength:I.Numeric(0,{min:0,max:20,step:.1})}),e.Utils={Params:e.Params,createEmpty:a,createValues:f,createValuesSimple:p,updateValues:v,updateBoundingSphere:h,createRenderableState:m,updateRenderableState:g,createPositionIterator:s};function s(y,b){var S=y.transform.ref.value,x=y.gridDimension.ref.value,C=x[0],w=x[1],A=x[2],M=C*w*A,D=b.instanceCount.ref.value,k=Lv(),R=k.position,O=b.aTransform.ref.value,H=function(B,j){var Y=Math.floor(B/A);return R[0]=Math.floor(Y/w),R[1]=Y%w,R[2]=B%A,_.transformMat4(R,R,S),j>=0&&_.transformMat4Offset(R,R,O,0,0,j*16),k};return Sn(M,D,1,H)}function u(y,b,S){var x=S[0],C=S[1],w=S[2],A=S[3],M=Ct.IsoValue.toAbsolute(b,{min:x,max:C,mean:w,sigma:A}).absoluteValue;return He.set(y,(M-x)/(C-x),(0-x)/(C-x)),y}function l(y,b){return Math.ceil(_.magnitude(y)*b)}function c(y,b){return Math.min.apply(Math,y)*(1/b)}function d(y){return 1/y}function f(y,b,S,x,C){var w=y.gridTexture,A=y.gridTextureDim,M=y.gridStats,D=y.bboxSize,k=y.bboxMin,R=y.bboxMax,O=y.gridDimension,H=y.transform,B=S.instanceCount,j=S.groupCount,Y=e.Utils.createPositionIterator(y,b),G=hs(S,Y,x.color),$=tu(B*j),q=Cd(),ee=_d(),fe=wd(),W=O.ref.value,X=W[0],U=W[1],z=W[2],J={drawCount:$4.indices.length,vertexCount:X*U*z,groupCount:j,instanceCount:B},K=Be.clone(y.boundingSphere),Z=Yi(K,b.aTransform.ref.value,B),te=C.renderMode.name==="volume"?zj(C.renderMode.params.controlPoints):[],le=Vj(te,C.renderMode.name==="volume"?C.renderMode.params.list.colors:[]),ye=C.renderMode.name==="isosurface"?C.renderMode.params.isoValue:Ct.IsoValue.relative(2),be=C.renderMode.name==="isosurface"?C.renderMode.params.singleLayer:!1;return E(E(E(E(E(E(E(E({},G),$),q),ee),fe),b),Et.createValues(C,J)),{aPosition:F.create($4.vertices),elements:F.create($4.indices),boundingSphere:F.create(Z),invariantBoundingSphere:F.create(K),uInvariantBoundingSphere:F.create(Ar.ofSphere(K)),uIsoValue:F.create(u(He(),ye,y.gridStats.ref.value)),uBboxMin:k,uBboxMax:R,uBboxSize:D,uMaxSteps:F.create(l(O.ref.value,C.stepsPerCell)),uStepScale:F.create(c(y.cellDim.ref.value,C.stepsPerCell)),uJumpLength:F.create(C.jumpLength),uTransform:H,uGridDim:O,dRenderMode:F.create(C.renderMode.name),tTransferTex:le,uTransferScale:F.create(d(C.stepsPerCell)),dGridTexType:F.create(w.ref.value.getDepth()>0?"3d":"2d"),uGridTexDim:A,tGridTex:w,uGridStats:M,uCellDim:y.cellDim,uCartnToUnit:y.cartnToUnit,uUnitToCartn:y.unitToCartn,dPackedGroup:y.packedGroup,dSingleLayer:F.create(be),dDoubleSided:F.create(C.doubleSided),dFlatShaded:F.create(C.flatShaded),dFlipSided:F.create(C.flipSided),dIgnoreLight:F.create(C.ignoreLight),dXrayShaded:F.create(C.xrayShaded)})}function p(y,b,S,x,C){var w=Et.createSimple(S,x,C),A=E(E({},I.getDefaultValues(e.Params)),b);return f(y,w.transform,w.locationIterator,w.theme,A)}function v(y,b){if(F.updateIfChanged(y.alpha,b.alpha),F.updateIfChanged(y.uAlpha,b.alpha),F.updateIfChanged(y.dDoubleSided,b.doubleSided),F.updateIfChanged(y.dFlatShaded,b.flatShaded),F.updateIfChanged(y.dFlipSided,b.flipSided),F.updateIfChanged(y.dIgnoreLight,b.ignoreLight),F.updateIfChanged(y.dXrayShaded,b.xrayShaded),F.updateIfChanged(y.dRenderMode,b.renderMode.name),b.renderMode.name==="isosurface")F.updateIfChanged(y.uIsoValue,u(y.uIsoValue.ref.value,b.renderMode.params.isoValue,y.uGridStats.ref.value)),F.updateIfChanged(y.dSingleLayer,b.renderMode.params.singleLayer);else if(b.renderMode.name==="volume"){var S=zj(b.renderMode.params.controlPoints);Vj(S,b.renderMode.params.list.colors,y.tTransferTex)}F.updateIfChanged(y.uMaxSteps,l(y.uGridDim.ref.value,b.stepsPerCell)),F.updateIfChanged(y.uStepScale,c(y.uCellDim.ref.value,b.stepsPerCell)),F.updateIfChanged(y.uTransferScale,d(b.stepsPerCell)),F.updateIfChanged(y.uJumpLength,b.jumpLength)}function h(y,b){var S=Be.clone(b.boundingSphere),x=Yi(S,y.aTransform.ref.value,y.instanceCount.ref.value);Be.equals(x,y.boundingSphere.ref.value)||F.update(y.boundingSphere,x),Be.equals(S,y.invariantBoundingSphere.ref.value)||(F.update(y.invariantBoundingSphere,S),F.update(y.uInvariantBoundingSphere,Ar.fromSphere(y.uInvariantBoundingSphere.ref.value,S)))}function m(y){var b=Et.createRenderableState(y);return b.opaque=!1,b.writeDepth=y.renderMode.name==="isosurface",b}function g(y,b){Et.updateRenderableState(y,b),y.opaque=!1,y.writeDepth=b.renderMode.name==="isosurface"}})(io||(io={}));function k9e(e,t){return Be.fromDimensionsAndTransform(Be(),e,t)}var gp;(function(e){function t(p,v,h,m,g,y){return y?a(p,v,h,m,g,y):i(p,v,h,m,g)}e.create=t;function r(p){var v=p?p.centerBuffer.ref.value:new Float32Array(0),h=p?p.mappingBuffer.ref.value:new Float32Array(0),m=p?p.indexBuffer.ref.value:new Uint32Array(0),g=p?p.groupBuffer.ref.value:new Float32Array(0);return t(v,h,m,g,0,p)}e.createEmpty=r;function n(p){return Ga([p.sphereCount,p.centerBuffer.ref.version,p.mappingBuffer.ref.version,p.indexBuffer.ref.version,p.groupBuffer.ref.version])}function i(p,v,h,m,g){var y=Be(),b,S=-1,x=-1,C={kind:"spheres",sphereCount:g,centerBuffer:F.create(p),mappingBuffer:F.create(v),indexBuffer:F.create(h),groupBuffer:F.create(m),get boundingSphere(){var w=n(C);if(w!==S){var A=mp(C.centerBuffer.ref.value,C.sphereCount*4,4);Be.copy(y,A),S=w}return y},get groupMapping(){return C.groupBuffer.ref.version!==x&&(b=w0(C.groupBuffer.ref.value,C.sphereCount,4),x=C.groupBuffer.ref.version),b},setBoundingSphere:function(w){Be.copy(y,w),S=n(C)}};return C}function a(p,v,h,m,g,y){return g>y.sphereCount&&(F.update(y.mappingBuffer,v),F.update(y.indexBuffer,h)),y.sphereCount=g,F.update(y.centerBuffer,p),F.update(y.groupBuffer,m),y}e.Params=E(E({},Et.Params),{sizeFactor:I.Numeric(1,{min:0,max:10,step:.1}),doubleSided:I.Boolean(!1,Et.CustomQualityParamInfo),ignoreLight:I.Boolean(!1,Et.ShadingCategory),xrayShaded:I.Boolean(!1,Et.ShadingCategory)}),e.Utils={Params:e.Params,createEmpty:r,createValues:s,createValuesSimple:u,updateValues:l,updateBoundingSphere:c,createRenderableState:d,updateRenderableState:f,createPositionIterator:o};function o(p,v){var h=p.sphereCount*4,m=v.instanceCount.ref.value,g=Lv(),y=g.position,b=p.centerBuffer.ref.value,S=v.aTransform.ref.value,x=function(C,w){return w<0?_.fromArray(y,b,C*3):_.transformMat4Offset(y,b,S,0,C*3,w*16),g};return Sn(h,m,4,x)}function s(p,v,h,m,g){var y=h.instanceCount,b=h.groupCount,S=o(p,v),x=hs(h,S,m.color),C=Sd(h,m.size),w=tu(y*b),A=Cd(),M=_d(),D=wd(),k={drawCount:p.sphereCount*2*3,vertexCount:p.sphereCount*4,groupCount:b,instanceCount:y},R=p.boundingSphere.radius?Db(C)*g.sizeFactor:0,O=Be.expand(Be(),p.boundingSphere,R),H=Yi(O,v.aTransform.ref.value,y);return E(E(E(E(E(E(E(E(E(E({aPosition:p.centerBuffer,aMapping:p.mappingBuffer,aGroup:p.groupBuffer,elements:p.indexBuffer,boundingSphere:F.create(H),invariantBoundingSphere:F.create(O),uInvariantBoundingSphere:F.create(Ar.ofSphere(O))},x),C),w),A),M),D),v),{padding:F.create(R)}),Et.createValues(g,k)),{uSizeFactor:F.create(g.sizeFactor),dDoubleSided:F.create(g.doubleSided),dIgnoreLight:F.create(g.ignoreLight),dXrayShaded:F.create(g.xrayShaded)})}function u(p,v,h,m,g){var y=Et.createSimple(h,m,g),b=E(E({},I.getDefaultValues(e.Params)),v);return s(p,y.transform,y.locationIterator,y.theme,b)}function l(p,v){Et.updateValues(p,v),F.updateIfChanged(p.uSizeFactor,v.sizeFactor),F.updateIfChanged(p.dDoubleSided,v.doubleSided),F.updateIfChanged(p.dIgnoreLight,v.ignoreLight),F.updateIfChanged(p.dXrayShaded,v.xrayShaded)}function c(p,v){var h=v.boundingSphere.radius?Db(p)*p.uSizeFactor.ref.value:0,m=Be.expand(Be(),v.boundingSphere,h),g=Yi(m,p.aTransform.ref.value,p.instanceCount.ref.value);Be.equals(g,p.boundingSphere.ref.value)||F.update(p.boundingSphere,g),Be.equals(m,p.invariantBoundingSphere.ref.value)||(F.update(p.invariantBoundingSphere,m),F.update(p.uInvariantBoundingSphere,Ar.fromSphere(p.uInvariantBoundingSphere.ref.value,m))),F.update(p.padding,h)}function d(p){var v=Et.createRenderableState(p);return f(v,p),v}function f(p,v){Et.updateRenderableState(p,v),p.opaque=p.opaque&&!v.xrayShaded,p.writeDepth=p.opaque}})(gp||(gp={}));var Hu;(function(e){var t=function(){function u(){this.index=0,this.textures=[]}return u.prototype.get=function(){return this.textures[this.index]},u.prototype.set=function(l,c,d){this.textures[this.index]=Object.assign(this.textures[this.index]||{},{vertex:l,group:c,normal:d}),this.index=(this.index+1)%2},u.prototype.destroy=function(){for(var l=0,c=this.textures;l<c.length;l++){var d=c[l];d.vertex.destroy(),d.group.destroy(),d.normal.destroy()}},u}();e.DoubleBuffer=t;function r(u,l,c,d,f,p,v){var h=c.getWidth(),m=c.getHeight();return v?(v.vertexCount=u,v.groupCount=l,F.update(v.geoTextureDim,He.set(v.geoTextureDim.ref.value,h,m)),F.update(v.vertexTexture,c),F.update(v.groupTexture,d),F.update(v.normalTexture,f),v.doubleBuffer.set(c,d,f),Be.copy(v.boundingSphere,p),v):{kind:"texture-mesh",vertexCount:u,groupCount:l,geoTextureDim:F.create(He.create(h,m)),vertexTexture:F.create(c),groupTexture:F.create(d),normalTexture:F.create(f),doubleBuffer:new t,boundingSphere:Be.clone(p)}}e.create=r;function n(u){return{}}e.createEmpty=n,e.Params=E(E({},Et.Params),{doubleSided:I.Boolean(!1,Et.CustomQualityParamInfo),flipSided:I.Boolean(!1,Et.ShadingCategory),flatShaded:I.Boolean(!1,Et.ShadingCategory),ignoreLight:I.Boolean(!1,Et.ShadingCategory),xrayShaded:I.Boolean(!1,Et.ShadingCategory)}),e.Utils={Params:e.Params,createEmpty:n,createValues:i,createValuesSimple:a,updateValues:o,updateBoundingSphere:s,createRenderableState:Et.createRenderableState,updateRenderableState:Et.updateRenderableState,createPositionIterator:function(){return Sn(1,1,1,function(){return ss})}};function i(u,l,c,d,f){var p=c.instanceCount,v=c.groupCount,h=e.Utils.createPositionIterator(u,l),m=hs(c,h,d.color),g=tu(p*v),y=Cd(),b=_d(),S=wd(),x={drawCount:u.vertexCount,vertexCount:u.vertexCount,groupCount:v,instanceCount:p},C=Be.clone(u.boundingSphere),w=Yi(C,l.aTransform.ref.value,p);return E(E(E(E(E(E(E(E({uGeoTexDim:u.geoTextureDim,tPosition:u.vertexTexture,tGroup:u.groupTexture,tNormal:u.normalTexture,boundingSphere:F.create(w),invariantBoundingSphere:F.create(C),uInvariantBoundingSphere:F.create(Ar.ofSphere(C))},m),g),y),b),S),l),Et.createValues(f,x)),{dDoubleSided:F.create(f.doubleSided),dFlatShaded:F.create(f.flatShaded),dFlipSided:F.create(f.flipSided),dIgnoreLight:F.create(f.ignoreLight),dXrayShaded:F.create(f.xrayShaded),dGeoTexture:F.create(!0)})}function a(u,l,c,d,f){var p=Et.createSimple(c,d,f),v=E(E({},I.getDefaultValues(e.Params)),l);return i(u,p.transform,p.locationIterator,p.theme,v)}function o(u,l){Et.updateValues(u,l),F.updateIfChanged(u.dDoubleSided,l.doubleSided),F.updateIfChanged(u.dFlatShaded,l.flatShaded),F.updateIfChanged(u.dFlipSided,l.flipSided),F.updateIfChanged(u.dIgnoreLight,l.ignoreLight),F.updateIfChanged(u.dXrayShaded,l.xrayShaded)}function s(u,l){var c=Be.clone(l.boundingSphere),d=Yi(c,u.aTransform.ref.value,u.instanceCount.ref.value);Be.equals(d,u.boundingSphere.ref.value)||F.update(u.boundingSphere,d),Be.equals(c,u.invariantBoundingSphere.ref.value)||(F.update(u.invariantBoundingSphere,c),F.update(u.uInvariantBoundingSphere,Ar.fromSphere(u.uInvariantBoundingSphere.ref.value,c)))}})(Hu||(Hu={}));function O9e(e,t){var r={},n={},i={},a={},o={},s={};return Object.keys(e).forEach(function(u){var l=e[u];l.type==="attribute"&&(r[u]=t[u]),l.type==="define"&&(n[u]=t[u]),l.type==="texture"&&t[u]!==void 0&&(i[u]=t[u]),l.type==="uniform"&&t[u]!==void 0&&(l.variant==="material"?o[u]=t[u]:l.variant==="buffered"?s[u]=t[u]:a[u]=t[u])}),{attributeValues:r,defineValues:n,textureValues:i,uniformValues:a,materialUniformValues:o,bufferedUniformValues:s}}function L9e(e){var t={};return Object.keys(e).forEach(function(r){t[r]=e[r].ref.version}),t}function qr(e,t,r){return{type:"attribute",kind:e,itemSize:t,divisor:r}}function Ge(e,t){return{type:"uniform",kind:e,variant:t}}function ur(e,t,r,n){return{type:"texture",kind:e,format:t,dataType:r,filter:n}}function Nv(e){return{type:"elements",kind:e}}function Qt(e,t){return{type:"define",kind:e,options:t}}function _i(e){return{type:"value",kind:e}}var Ed={uModel:Ge("m4"),uView:Ge("m4"),uInvView:Ge("m4"),uModelView:Ge("m4"),uInvModelView:Ge("m4"),uProjection:Ge("m4"),uInvProjection:Ge("m4"),uModelViewProjection:Ge("m4"),uInvModelViewProjection:Ge("m4"),uIsOrtho:Ge("f"),uPixelRatio:Ge("f"),uViewportHeight:Ge("f"),uViewport:Ge("v4"),uViewOffset:Ge("v2"),uDrawingBufferSize:Ge("v2"),uCameraPosition:Ge("v3"),uCameraDir:Ge("v3"),uNear:Ge("f"),uFar:Ge("f"),uFogNear:Ge("f"),uFogFar:Ge("f"),uFogColor:Ge("v3"),uTransparentBackground:Ge("b"),uClipObjectType:Ge("i[]"),uClipObjectInvert:Ge("b[]"),uClipObjectPosition:Ge("v3[]"),uClipObjectRotation:Ge("v4[]"),uClipObjectScale:Ge("v3[]"),uLightIntensity:Ge("f"),uAmbientIntensity:Ge("f"),uMetalness:Ge("f"),uRoughness:Ge("f"),uReflectivity:Ge("f"),uPickingAlphaThreshold:Ge("f"),uInteriorDarkening:Ge("f"),uInteriorColorFlag:Ge("b"),uInteriorColor:Ge("v3"),uHighlightColor:Ge("v3"),uSelectColor:Ge("v3"),uXrayEdgeFalloff:Ge("f"),uRenderWboit:Ge("b")},Ad={tDepth:ur("texture","depth","ushort","nearest")},Pd={uObjectId:Ge("i")},F9e={uColor:Ge("v3","material"),uColorTexDim:Ge("v2"),uColorGridDim:Ge("v3"),uColorGridTransform:Ge("v4"),tColor:ur("image-uint8","rgb","ubyte","nearest"),tPalette:ur("image-uint8","rgb","ubyte","nearest"),tColorGrid:ur("texture","rgb","ubyte","linear"),dColorType:Qt("string",["uniform","attribute","instance","group","groupInstance","vertex","vertexInstance","volume","volumeInstance"]),dUsePalette:Qt("boolean")},l2={uSize:Ge("f","material"),uSizeTexDim:Ge("v2"),tSize:ur("image-uint8","rgb","ubyte","nearest"),dSizeType:Qt("string",["uniform","attribute","instance","group","groupInstance"]),uSizeFactor:Ge("f")},N9e={uMarkerTexDim:Ge("v2"),tMarker:ur("image-uint8","alpha","ubyte","nearest")},B9e={uOverpaintTexDim:Ge("v2"),tOverpaint:ur("image-uint8","rgba","ubyte","nearest"),dOverpaint:Qt("boolean")},U9e={uTransparencyTexDim:Ge("v2"),tTransparency:ur("image-uint8","alpha","ubyte","nearest"),dTransparency:Qt("boolean"),transparencyAverage:_i("number")},j9e={dClipObjectCount:Qt("number"),dClipVariant:Qt("string",["instance","pixel"]),uClippingTexDim:Ge("v2"),tClipping:ur("image-uint8","alpha","ubyte","nearest"),dClipping:Qt("boolean")},Td=E(E(E(E(E(E({},F9e),N9e),B9e),U9e),j9e),{aInstance:qr("float32",1,1),aTransform:qr("float32",16,1),uAlpha:Ge("f","material"),uVertexCount:Ge("i"),uInstanceCount:Ge("i"),uGroupCount:Ge("i"),uInvariantBoundingSphere:Ge("v4"),drawCount:_i("number"),instanceCount:_i("number"),alpha:_i("number"),matrix:_i("m4"),transform:_i("float32"),extraTransform:_i("float32"),hasReflection:_i("boolean"),boundingSphere:_i("sphere"),invariantBoundingSphere:_i("sphere")}),Eee=new Float32Array([1,1,-1,1,-1,-1,-1,-1,1,-1,1,1]),_a={drawCount:_i("number"),instanceCount:_i("number"),aPosition:qr("float32",2,0),uQuadScale:Ge("v2")},wa={drawCount:F.create(6),instanceCount:F.create(1),aPosition:F.create(Eee),uQuadScale:F.create(He.create(1,1))},Gj=new Uint32Array([0,1,2,1,3,2]),z9e=new Float32Array([0,1,0,0,1,1,1,0]),Aee={nearest:"Nearest",catmulrom:"Catmulrom (Cubic)",mitchell:"Mitchell (Cubic)",bspline:"B-Spline (Cubic)"},V9e=Object.keys(Aee),nd;(function(e){function t(f,p,v,h){return h?i(f,p,v,h):n(f,p,v)}e.create=t;function r(f){return Ga([f.cornerBuffer.ref.version])}function n(f,p,v){var h=Be(),m=-1,g=f.width,y=f.height,b={kind:"image",imageTexture:F.create(f),imageTextureDim:F.create(He.create(g,y)),cornerBuffer:F.create(p),groupTexture:F.create(v),get boundingSphere(){var S=r(b);if(S!==m){var x=H9e(b.cornerBuffer.ref.value);Be.copy(h,x),m=S}return h}};return b}function i(f,p,v,h){var m=f.width,g=f.height;return F.update(h.imageTexture,f),F.update(h.imageTextureDim,He.set(h.imageTextureDim.ref.value,m,g)),F.update(h.cornerBuffer,p),F.update(h.groupTexture,v),h}function a(f){return{}}e.createEmpty=a,e.Params=E(E({},Et.Params),{interpolation:I.Select("bspline",I.objectToOptions(Aee))}),e.Utils={Params:e.Params,createEmpty:a,createValues:o,createValuesSimple:s,updateValues:u,updateBoundingSphere:l,createRenderableState:c,updateRenderableState:d,createPositionIterator:function(){return Sn(1,1,1,function(){return ss})}};function o(f,p,v,h,m){var g=v.instanceCount,y=v.groupCount,b=e.Utils.createPositionIterator(f,p),S=hs(v,b,h.color),x=tu(g*y),C=Cd(),w=_d(),A=wd(),M={drawCount:Gj.length,vertexCount:Eee.length/3,groupCount:y,instanceCount:g},D=Be.clone(f.boundingSphere),k=Yi(D,p.aTransform.ref.value,g);return E(E(E(E(E(E(E(E({},S),x),C),w),A),p),Et.createValues(m,M)),{aPosition:f.cornerBuffer,aUv:F.create(z9e),elements:F.create(Gj),aGroup:F.create(Ys(new Float32Array(4))),boundingSphere:F.create(k),invariantBoundingSphere:F.create(D),uInvariantBoundingSphere:F.create(Ar.ofSphere(D)),dInterpolation:F.create(m.interpolation),uImageTexDim:f.imageTextureDim,tImageTex:f.imageTexture,tGroupTex:f.groupTexture})}function s(f,p,v,h,m){var g=Et.createSimple(v,h,m),y=E(E({},I.getDefaultValues(e.Params)),p);return o(f,g.transform,g.locationIterator,g.theme,y)}function u(f,p){Et.updateValues(f,p),F.updateIfChanged(f.dInterpolation,p.interpolation)}function l(f,p){var v=Be.clone(p.boundingSphere),h=Yi(v,f.aTransform.ref.value,f.instanceCount.ref.value);Be.equals(h,f.boundingSphere.ref.value)||F.update(f.boundingSphere,h),Be.equals(v,f.invariantBoundingSphere.ref.value)||(F.update(f.invariantBoundingSphere,v),F.update(f.uInvariantBoundingSphere,Ar.fromSphere(f.uInvariantBoundingSphere.ref.value,v)))}function c(f){var p=Et.createRenderableState(f);return p.opaque=!1,p}function d(f,p){Et.updateRenderableState(f,p),f.opaque=!1}})(nd||(nd={}));function H9e(e){for(var t=_(),r=[],n=0,i=e.length;n<i;n+=3){var a=_.fromArray(_(),e,n);r.push(a),_.add(t,t,a)}_.scale(t,t,1/(e.length/3));for(var o=0,s=0,u=r;s<u.length;s++){var a=u[s],l=_.distance(t,a);l>o&&(o=l)}var c=Be.create(t,o);return Be.setExtrema(c,r),c}var Jo;(function(e){function t(v,h,m,g,y,b,S,x,C){return C?a(v,h,m,g,y,b,S,x,C):i(v,h,m,g,y,b,S,x)}e.create=t;function r(v){var h=v?v.mappingBuffer.ref.value:new Float32Array(0),m=v?v.indexBuffer.ref.value:new Uint32Array(0),g=v?v.groupBuffer.ref.value:new Float32Array(0),y=v?v.startBuffer.ref.value:new Float32Array(0),b=v?v.endBuffer.ref.value:new Float32Array(0),S=v?v.scaleBuffer.ref.value:new Float32Array(0),x=v?v.capBuffer.ref.value:new Float32Array(0);return t(h,m,g,y,b,S,x,0,v)}e.createEmpty=r;function n(v){return Ga([v.cylinderCount,v.mappingBuffer.ref.version,v.indexBuffer.ref.version,v.groupBuffer.ref.version,v.startBuffer.ref.version,v.endBuffer.ref.version,v.scaleBuffer.ref.version,v.capBuffer.ref.version])}function i(v,h,m,g,y,b,S,x){var C=Be(),w,A=-1,M=-1,D={kind:"cylinders",cylinderCount:x,mappingBuffer:F.create(v),indexBuffer:F.create(h),groupBuffer:F.create(m),startBuffer:F.create(g),endBuffer:F.create(y),scaleBuffer:F.create(b),capBuffer:F.create(S),get boundingSphere(){var k=n(D);if(k!==A){var R=mp(D.startBuffer.ref.value,D.cylinderCount*6,6),O=mp(D.endBuffer.ref.value,D.cylinderCount*6,6);Be.expandBySphere(C,R,O),A=k}return C},get groupMapping(){return D.groupBuffer.ref.version!==M&&(w=w0(D.groupBuffer.ref.value,D.cylinderCount,6),M=D.groupBuffer.ref.version),w},setBoundingSphere:function(k){Be.copy(C,k),A=n(D)}};return D}function a(v,h,m,g,y,b,S,x,C){return x>C.cylinderCount&&(F.update(C.mappingBuffer,v),F.update(C.indexBuffer,h)),C.cylinderCount=x,F.update(C.groupBuffer,m),F.update(C.startBuffer,g),F.update(C.endBuffer,y),F.update(C.scaleBuffer,b),F.update(C.capBuffer,S),C}function o(v,h){var m=v.startBuffer.ref.value;yv(h,m,0,v.cylinderCount*6),F.update(v.startBuffer,m);var g=v.endBuffer.ref.value;yv(h,g,0,v.cylinderCount*6),F.update(v.endBuffer,g)}e.transform=o,e.Params=E(E({},Et.Params),{sizeFactor:I.Numeric(1,{min:0,max:10,step:.1}),sizeAspectRatio:I.Numeric(1,{min:0,max:3,step:.01}),doubleSided:I.Boolean(!1,Et.CustomQualityParamInfo),ignoreLight:I.Boolean(!1,Et.ShadingCategory),xrayShaded:I.Boolean(!1,Et.ShadingCategory)}),e.Utils={Params:e.Params,createEmpty:r,createValues:u,createValuesSimple:l,updateValues:c,updateBoundingSphere:d,createRenderableState:f,updateRenderableState:p,createPositionIterator:s};function s(v,h){var m=v.cylinderCount*6,g=h.instanceCount.ref.value,y=Lv(),b=y.position,S=v.startBuffer.ref.value,x=v.endBuffer.ref.value,C=h.aTransform.ref.value,w=function(A,M){var D=A%6===0?S:x;return M<0?_.fromArray(b,D,A*3):_.transformMat4Offset(b,D,C,0,A*3,M*16),y};return Sn(m,g,2,w)}function u(v,h,m,g,y){var b=m.instanceCount,S=m.groupCount,x=s(v,h),C=hs(m,x,g.color),w=Sd(m,g.size),A=tu(b*S),M=Cd(),D=_d(),k=wd(),R={drawCount:v.cylinderCount*4*3,vertexCount:v.cylinderCount*6,groupCount:S,instanceCount:b},O=Db(w)*y.sizeFactor,H=Be.clone(v.boundingSphere),B=Yi(H,h.aTransform.ref.value,b);return E(E(E(E(E(E(E(E(E(E({aMapping:v.mappingBuffer,aGroup:v.groupBuffer,aStart:v.startBuffer,aEnd:v.endBuffer,aScale:v.scaleBuffer,aCap:v.capBuffer,elements:v.indexBuffer,boundingSphere:F.create(B),invariantBoundingSphere:F.create(H),uInvariantBoundingSphere:F.create(Ar.ofSphere(H))},C),w),A),M),D),k),h),{padding:F.create(O)}),Et.createValues(y,R)),{uSizeFactor:F.create(y.sizeFactor*y.sizeAspectRatio),dDoubleSided:F.create(y.doubleSided),dIgnoreLight:F.create(y.ignoreLight),dXrayShaded:F.create(y.xrayShaded)})}function l(v,h,m,g,y){var b=Et.createSimple(m,g,y),S=E(E({},I.getDefaultValues(e.Params)),h);return u(v,b.transform,b.locationIterator,b.theme,S)}function c(v,h){Et.updateValues(v,h),F.updateIfChanged(v.uSizeFactor,h.sizeFactor*h.sizeAspectRatio),F.updateIfChanged(v.dDoubleSided,h.doubleSided),F.updateIfChanged(v.dIgnoreLight,h.ignoreLight),F.updateIfChanged(v.dXrayShaded,h.xrayShaded)}function d(v,h){var m=Be.clone(h.boundingSphere),g=Yi(m,v.aTransform.ref.value,v.instanceCount.ref.value);Be.equals(g,v.boundingSphere.ref.value)||F.update(v.boundingSphere,g),Be.equals(m,v.invariantBoundingSphere.ref.value)||(F.update(v.invariantBoundingSphere,m),F.update(v.uInvariantBoundingSphere,Ar.fromSphere(v.uInvariantBoundingSphere.ref.value,m)))}function f(v){var h=Et.createRenderableState(v);return p(h,v),h}function p(v,h){Et.updateRenderableState(v,h),v.opaque=v.opaque&&!h.xrayShaded,v.writeDepth=v.opaque}})(Jo||(Jo={}));var la;(function(e){function t(o){switch(o.kind){case"mesh":return o.triangleCount*3;case"points":return o.pointCount;case"spheres":return o.sphereCount*2*3;case"cylinders":return o.cylinderCount*4*3;case"text":return o.charCount*2*3;case"lines":return o.lineCount*2*3;case"direct-volume":return 12*3;case"image":return 2*3;case"texture-mesh":return o.vertexCount}}e.getDrawCount=t;function r(o){switch(o.kind){case"mesh":return o.vertexCount;case"points":return o.pointCount;case"spheres":return o.sphereCount*4;case"cylinders":return o.cylinderCount*6;case"text":return o.charCount*4;case"lines":return o.lineCount*4;case"direct-volume":var s=o.gridDimension.ref.value,u=s[0],l=s[1],c=s[2];return u*l*c;case"image":return 4;case"texture-mesh":return o.vertexCount}}e.getVertexCount=r;function n(o){switch(o.kind){case"mesh":case"points":case"spheres":case"cylinders":case"text":case"lines":return t(o)===0?0:Nl(o.groupBuffer.ref.value)+1;case"direct-volume":return 1;case"image":return Nl(o.groupTexture.ref.value.array)+1;case"texture-mesh":return o.groupCount}}e.getGroupCount=n;function i(o){switch(o.kind){case"mesh":return Ft.Utils;case"points":return bv.Utils;case"spheres":return gp.Utils;case"cylinders":return Jo.Utils;case"text":return Ks.Utils;case"lines":return wn.Utils;case"direct-volume":return io.Utils;case"image":return nd.Utils;case"texture-mesh":return Hu.Utils}}e.getUtils=i;function a(o,s){return s==="instance"&&o.nonInstanceable?"group":s}e.getGranularity=a})(la||(la={}));var Pee=$a();function G9e(e,t){switch(t){case e.FRAMEBUFFER_COMPLETE:return"complete";case e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"incomplete attachment";case e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"incomplete missing attachment";case e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"incomplete dimensions";case e.FRAMEBUFFER_UNSUPPORTED:return"unsupported"}if(Pr(e))switch(t){case e.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE:return"incomplete multisample";case e.RENDERBUFFER_SAMPLES:return"renderbuffer samples"}return"unknown error"}function GL(e){var t=e.checkFramebufferStatus(e.FRAMEBUFFER);if(t!==e.FRAMEBUFFER_COMPLETE){var r=G9e(e,t);throw new Error("Framebuffer status: "+r)}}function qj(e){var t=e.createFramebuffer();if(t===null)throw new Error("Could not create WebGL framebuffer");return t}function q9e(e){var t=qj(e),r=!1;return{id:Pee(),bind:function(){return e.bindFramebuffer(e.FRAMEBUFFER,t)},reset:function(){t=qj(e)},destroy:function(){r||(e.deleteFramebuffer(t),r=!0)}}}function $9e(){return{id:Pee(),bind:function(){},reset:function(){},destroy:function(){}}}function $j(e){var t=eze(e);if(t===null)throw new Error('Could not find support for "instanced_arrays"');var r=rze(e);if(r===null)throw new Error('Could not find support for "element_index_uint"');var n=tze(e);kr&&n===null&&console.log('Could not find support for "standard_derivatives"');var i=ize(e);kr&&i===null&&console.log('Could not find support for "texture_float"');var a=aze(e);kr&&a===null&&console.log('Could not find support for "texture_float_linear"');var o=oze(e);kr&&o===null&&console.log('Could not find support for "texture_half_float"');var s=sze(e);kr&&s===null&&console.log('Could not find support for "texture_half_float_linear"');var u=hze(e);kr&&u===null&&console.log('Could not find support for "depth_texture"');var l=uze(e);kr&&l===null&&console.log('Could not find support for "blend_minmax"');var c=nze(e);kr&&c===null&&console.log('Could not find support for "vertex_array_object"');var d=lze(e);kr&&d===null&&console.log('Could not find support for "frag_depth"');var f=cze(e);kr&&f===null&&console.log('Could not find support for "color_buffer_float"');var p=dze(e);kr&&p===null&&console.log('Could not find support for "color_buffer_half_float"');var v=fze(e);kr&&v===null&&console.log('Could not find support for "draw_buffers"');var h=pze(e);kr&&h===null&&console.log('Could not find support for "shader_texture_lod"');var m=vze(e);return kr&&m===null&&console.log('Could not find support for "sRGB"'),{instancedArrays:t,standardDerivatives:n,textureFloat:i,textureFloatLinear:a,textureHalfFloat:o,textureHalfFloatLinear:s,elementIndexUint:r,depthTexture:u,blendMinMax:l,vertexArrayObject:c,fragDepth:d,colorBufferFloat:f,colorBufferHalfFloat:p,drawBuffers:v,shaderTextureLod:h,sRGB:m}}function W9e(e){var t={},r=e.getParameter(e.FRONT_FACE),n=e.getParameter(e.CULL_FACE_MODE),i=e.getParameter(e.DEPTH_WRITEMASK),a=e.getParameter(e.COLOR_WRITEMASK),o=e.getParameter(e.COLOR_CLEAR_VALUE),s=e.getParameter(e.BLEND_SRC_RGB),u=e.getParameter(e.BLEND_DST_RGB),l=e.getParameter(e.BLEND_SRC_ALPHA),c=e.getParameter(e.BLEND_DST_ALPHA),d=e.getParameter(e.BLEND_EQUATION_RGB),f=e.getParameter(e.BLEND_EQUATION_ALPHA);return{currentProgramId:-1,currentMaterialId:-1,currentRenderItemId:-1,enable:function(p){t[p]!==!0&&(e.enable(p),t[p]=!0)},disable:function(p){t[p]!==!1&&(e.disable(p),t[p]=!1)},frontFace:function(p){p!==r&&(e.frontFace(p),r=p)},cullFace:function(p){p!==n&&(e.cullFace(p),n=p)},depthMask:function(p){p!==i&&(e.depthMask(p),i=p)},colorMask:function(p,v,h,m){(p!==a[0]||v!==a[1]||h!==a[2]||m!==a[3])&&(e.colorMask(p,v,h,m),a[0]=p,a[1]=v,a[2]=h,a[3]=m)},clearColor:function(p,v,h,m){(p!==o[0]||v!==o[1]||h!==o[2]||m!==o[3])&&(e.clearColor(p,v,h,m),o[0]=p,o[1]=v,o[2]=h,o[3]=m)},blendFunc:function(p,v){(p!==s||v!==u||p!==l||v!==c)&&(e.blendFunc(p,v),s=p,u=v,l=p,c=v)},blendFuncSeparate:function(p,v,h,m){(p!==s||v!==u||h!==l||m!==c)&&(e.blendFuncSeparate(p,v,h,m),s=p,u=v,l=h,c=m)},blendEquation:function(p){(p!==d||p!==f)&&(e.blendEquation(p),d=p,f=p)},blendEquationSeparate:function(p,v){(p!==d||v!==f)&&(e.blendEquationSeparate(p,v),d=p,f=v)},reset:function(){t={},r=e.getParameter(e.FRONT_FACE),n=e.getParameter(e.CULL_FACE_MODE),i=e.getParameter(e.DEPTH_WRITEMASK),a=e.getParameter(e.COLOR_WRITEMASK),o=e.getParameter(e.COLOR_CLEAR_VALUE),s=e.getParameter(e.BLEND_SRC_RGB),u=e.getParameter(e.BLEND_DST_RGB),l=e.getParameter(e.BLEND_SRC_ALPHA),c=e.getParameter(e.BLEND_DST_ALPHA),d=e.getParameter(e.BLEND_EQUATION_RGB),f=e.getParameter(e.BLEND_EQUATION_ALPHA)}}}var zh;(function(e){function t(i,a,o){return{array:i,width:a,height:o}}e.create=t;function r(i){for(var a=i.array,o=i.width,s=i.height,u=o*4,l=0,c=s/2;l<c;++l)for(var d=0,f=u;d<f;++d){var p=l*u+d,v=(s-l-1)*u+d,h=a[p];a[p]=a[v],a[v]=h}return i}e.flipY=r;function n(i){for(var a=i.array,o=0,s=a.length;o<s;o+=4){var u=a[o+3]/255;a[o]/=u,a[o+1]/=u,a[o+2]/=u}return i}e.divideByAlpha=n})(zh||(zh={}));var X9e=`
float viewZ = depthToViewZ(uIsOrtho, fragmentDepth, uNear, uFar);
float fogFactor = smoothstep(uFogNear, uFogFar, abs(viewZ));
float fogAlpha = (1.0 - fogFactor) * gl_FragColor.a;
float preFogAlpha = gl_FragColor.a;
if (!uTransparentBackground) {
    if (gl_FragColor.a < 1.0) {
        // transparent objects are blended with background color
        gl_FragColor.a = fogAlpha;
    } else {
        // mix opaque objects with background color
        gl_FragColor.rgb = mix(gl_FragColor.rgb, uFogColor, fogFactor);
    }
} else {
    // pre-multiplied alpha expected for transparent background
    gl_FragColor.rgb *= fogAlpha;
    gl_FragColor.a = fogAlpha;
}
`,Y9e=`
if (interior) {
    if (uInteriorColorFlag) {
        gl_FragColor.rgb = uInteriorColor;
    } else {
        gl_FragColor.rgb *= 1.0 - uInteriorDarkening;
    }
}
`,K9e=`
// inputs
// - vec4 material
// - vec3 vViewPosition
// - vec3 normal
// - float uMetalness
// - float uRoughness
// - float uReflectivity
// - float uLightIntensity
// - float uAmbientIntensity

// outputs
// - sets gl_FragColor

vec4 color = material;

ReflectedLight reflectedLight = ReflectedLight(vec3(0.0), vec3(0.0), vec3(0.0));

PhysicalMaterial physicalMaterial;
physicalMaterial.diffuseColor = color.rgb * (1.0 - uMetalness);
physicalMaterial.specularRoughness = clamp(uRoughness, 0.04, 1.0);
physicalMaterial.specularColor = mix(vec3(0.16 * pow2(uReflectivity)), color.rgb, uMetalness);

GeometricContext geometry;
geometry.position = -vViewPosition;
geometry.normal = normal;
geometry.viewDir = normalize(vViewPosition);

IncidentLight directLight;
directLight.direction = vec3(0.0, 0.0, -1.0);
directLight.color = vec3(uLightIntensity);

RE_Direct_Physical(directLight, geometry, physicalMaterial, reflectedLight);

vec3 irradiance = vec3(uAmbientIntensity) * PI;
RE_IndirectDiffuse_Physical(irradiance, geometry, physicalMaterial, reflectedLight);

vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular;

gl_FragColor = vec4(outgoingLight, color.a);

#ifdef dXrayShaded
    gl_FragColor.a *= 1.0 - pow(abs(dot(normal, vec3(0, 0, 1))), uXrayEdgeFalloff);
#endif
`,Q9e=`
float marker = floor(vMarker * 255.0 + 0.5); // rounding required to work on some cards on win
if (marker > 0.1) {
    if (intMod(marker, 2.0) > 0.1) {
        gl_FragColor.rgb = mix(uHighlightColor, gl_FragColor.rgb, 0.3);
        gl_FragColor.a = max(0.02, gl_FragColor.a); // for direct-volume rendering
    } else {
        gl_FragColor.rgb = mix(uSelectColor, gl_FragColor.rgb, 0.3);
    }
}
`,Z9e=`
#if dClipObjectCount != 0 && defined(dClipping)
    vClipping = readFromTexture(tClipping, aInstance * float(uGroupCount) + group, uClippingTexDim).a;
#endif
`,J9e=`
#if defined(dRenderVariant_color)
    #if defined(dColorType_attribute)
        vColor.rgb = aColor;
    #elif defined(dColorType_instance)
        vColor.rgb = readFromTexture(tColor, aInstance, uColorTexDim).rgb;
    #elif defined(dColorType_group)
        vColor.rgb = readFromTexture(tColor, group, uColorTexDim).rgb;
    #elif defined(dColorType_groupInstance)
        vColor.rgb = readFromTexture(tColor, aInstance * float(uGroupCount) + group, uColorTexDim).rgb;
    #elif defined(dColorType_vertex)
        vColor.rgb = readFromTexture(tColor, VertexID, uColorTexDim).rgb;
    #elif defined(dColorType_vertexInstance)
        vColor.rgb = readFromTexture(tColor, int(aInstance) * uVertexCount + VertexID, uColorTexDim).rgb;
    #elif defined(dColorType_volume)
        vec3 gridPos = (uColorGridTransform.w * (position - uColorGridTransform.xyz)) / uColorGridDim;
        vColor.rgb = texture3dFrom2dLinear(tColorGrid, gridPos, uColorGridDim, uColorTexDim).rgb;
    #elif defined(dColorType_volumeInstance)
        vec3 gridPos = (uColorGridTransform.w * (vModelPosition - uColorGridTransform.xyz)) / uColorGridDim;
        vColor.rgb = texture3dFrom2dLinear(tColorGrid, gridPos, uColorGridDim, uColorTexDim).rgb;
    #endif

    #ifdef dUsePalette
        vPaletteV = ((vColor.r * 256.0 * 256.0 * 255.0 + vColor.g * 256.0 * 255.0 + vColor.b * 255.0) - 1.0) / 16777215.0;
    #endif

    #ifdef dOverpaint
        vOverpaint = readFromTexture(tOverpaint, aInstance * float(uGroupCount) + group, uOverpaintTexDim);
    #endif
#elif defined(dRenderVariant_pick)
    #if defined(dRenderVariant_pickObject)
        vColor = vec4(encodeFloatRGB(float(uObjectId)), 1.0);
    #elif defined(dRenderVariant_pickInstance)
        vColor = vec4(encodeFloatRGB(aInstance), 1.0);
    #elif defined(dRenderVariant_pickGroup)
        vColor = vec4(encodeFloatRGB(group), 1.0);
    #endif
#endif

#ifdef dTransparency
    vGroup = group;
    vTransparency = readFromTexture(tTransparency, aInstance * float(uGroupCount) + group, uTransparencyTexDim).a;
#endif
`,eUe=`
#ifdef dGeoTexture
    float group = decodeFloatRGB(readFromTexture(tGroup, VertexID, uGeoTexDim).rgb);
#else
    float group = aGroup;
#endif
`,tUe=`
vMarker = readFromTexture(tMarker, aInstance * float(uGroupCount) + group, uMarkerTexDim).a;
`,rUe=`
#if defined(dRenderVariant_color)
    #if defined(dUsePalette)
        vec4 material = vec4(texture2D(tPalette, vec2(vPaletteV, 0.5)).rgb, uAlpha);
    #elif defined(dColorType_uniform)
        vec4 material = vec4(uColor, uAlpha);
    #elif defined(dColorType_varying)
        vec4 material = vec4(vColor.rgb, uAlpha);
    #endif

    // mix material with overpaint
    #if defined(dOverpaint)
        material.rgb = mix(material.rgb, vOverpaint.rgb, vOverpaint.a);
    #endif
#elif defined(dRenderVariant_pick)
    vec4 material = vColor;
#elif defined(dRenderVariant_depth)
    #ifdef enabledFragDepth
        vec4 material = packDepthToRGBA(gl_FragDepthEXT);
    #else
        vec4 material = packDepthToRGBA(gl_FragCoord.z);
    #endif
#endif

// apply screendoor transparency
#if defined(dTransparency)
    float ta = 1.0 - vTransparency;

    #if defined(dRenderVariant_pick)
        if (ta < uPickingAlphaThreshold)
            discard; // ignore so the element below can be picked
    #else
        #if defined(dRenderVariant_colorBlended)
            float at = 0.0;

            // shift by view-offset during multi-sample rendering to allow for blending
            vec2 coord = gl_FragCoord.xy + uViewOffset * 0.25;

            const mat4 thresholdMatrix = mat4(
                1.0 / 17.0,  9.0 / 17.0,  3.0 / 17.0, 11.0 / 17.0,
                13.0 / 17.0,  5.0 / 17.0, 15.0 / 17.0,  7.0 / 17.0,
                4.0 / 17.0, 12.0 / 17.0,  2.0 / 17.0, 10.0 / 17.0,
                16.0 / 17.0,  8.0 / 17.0, 14.0 / 17.0,  6.0 / 17.0
            );
            int ci = int(intMod(coord.x, 4.0));
            int ri = int(intMod(coord.y, 4.0));
            #if __VERSION__ == 100
                vec4 i = vec4(float(ci * 4 + ri));
                vec4 v = thresholdMatrix[0] * vec4(equal(i, vec4(0.0, 1.0, 2.0, 3.0))) +
                    thresholdMatrix[1] * vec4(equal(i, vec4(4.0, 5.0, 6.0, 7.0))) +
                    thresholdMatrix[2] * vec4(equal(i, vec4(8.0, 9.0, 10.0, 11.0))) +
                    thresholdMatrix[3] * vec4(equal(i, vec4(12.0, 13.0, 14.0, 15.0)));
                at = v.x + v.y + v.z + v.w;
            #else
                at = thresholdMatrix[ci][ri];
            #endif

            if (ta < 0.99 && (ta < 0.01 || ta < at)) {
                discard;
            }
        #elif defined(dRenderVariant_colorWboit)
            material.a *= ta;
        #endif
    #endif
#endif
`,nUe=`
mat4 model = uModel * aTransform;
mat4 modelView = uView * model;
#ifdef dGeoTexture
    vec3 position = readFromTexture(tPosition, VertexID, uGeoTexDim).xyz;
#else
    vec3 position = aPosition;
#endif
vec4 position4 = vec4(position, 1.0);
// for accessing tColorGrid in vert shader and for clipping in frag shader
vModelPosition = (model * position4).xyz;
vec4 mvPosition = modelView * position4;
vViewPosition = mvPosition.xyz;
gl_Position = uProjection * mvPosition;
`,iUe=`
#if defined(dSizeType_uniform)
    float size = uSize;
#elif defined(dSizeType_attribute)
    float size = aSize;
#elif defined(dSizeType_instance)
    float size = decodeFloatRGB(readFromTexture(tSize, aInstance, uSizeTexDim).rgb);
#elif defined(dSizeType_group)
    float size = decodeFloatRGB(readFromTexture(tSize, group, uSizeTexDim).rgb);
#elif defined(dSizeType_groupInstance)
    float size = decodeFloatRGB(readFromTexture(tSize, aInstance * float(uGroupCount) + group, uSizeTexDim).rgb);
#endif

#if defined(dSizeType_instance) || defined(dSizeType_group) || defined(dSizeType_groupInstance)
    size /= 100.0; // NOTE factor also set in TypeScript
#endif

size *= uSizeFactor;
`,aUe=`
float viewZ = depthToViewZ(uIsOrtho, fragmentDepth, uNear, uFar);
float fogFactor = smoothstep(uFogNear, uFogFar, abs(viewZ));
float alpha = (1.0 - fogFactor) * uAlpha;
if (uAlpha < uPickingAlphaThreshold || alpha < 0.1)
    discard; // ignore so the element below can be picked
`,oUe=`
#if defined(dClipVariant_instance) && dClipObjectCount != 0
    int flag = 0;
    #if defined(dClipping)
        flag = int(floor(vClipping * 255.0 + 0.5));
    #endif

    vec4 mCenter = uModel * aTransform * vec4(uInvariantBoundingSphere.xyz, 1.0);
    if (clipTest(vec4(mCenter.xyz, uInvariantBoundingSphere.w), flag))
        // move out of [ -w, +w ] to 'discard' in vert shader
        gl_Position.z = 2.0 * gl_Position.w;
#endif
`,sUe=`
#if defined(dClipVariant_pixel) && dClipObjectCount != 0
    #if defined(dClipping)
        int clippingFlag = int(floor(vClipping * 255.0 + 0.5));
    #else
        int clippingFlag = 0;
    #endif

    if (clipTest(vec4(vModelPosition, 0.0), clippingFlag))
        discard;
#endif
`,uUe=`
#if defined(dRenderVariant_color)
    #if defined(dColorType_uniform)
        uniform vec3 uColor;
    #elif defined(dColorType_varying)
        varying vec4 vColor;
    #endif

    #ifdef dOverpaint
        varying vec4 vOverpaint;
    #endif
#elif defined(dRenderVariant_pick)
    #if __VERSION__ == 100
        varying vec4 vColor;
    #else
        flat in vec4 vColor;
    #endif
#endif

#ifdef dTransparency
    varying float vGroup;
    varying float vTransparency;
#endif

#ifdef dUsePalette
    uniform sampler2D tPalette;
    varying float vPaletteV;
#endif
`,lUe=`
#if defined(dRenderVariant_color)
    #if defined(dColorType_uniform)
        uniform vec3 uColor;
    #elif defined(dColorType_attribute)
        varying vec4 vColor;
        attribute vec3 aColor;
    #elif defined(dColorType_texture)
        varying vec4 vColor;
        uniform vec2 uColorTexDim;
        uniform sampler2D tColor;
    #elif defined(dColorType_grid)
        varying vec4 vColor;
        uniform vec2 uColorTexDim;
        uniform vec3 uColorGridDim;
        uniform vec4 uColorGridTransform;
        uniform sampler2D tColorGrid;
    #endif

    #ifdef dOverpaint
        varying vec4 vOverpaint;
        uniform vec2 uOverpaintTexDim;
        uniform sampler2D tOverpaint;
    #endif
#elif defined(dRenderVariant_pick)
    #if __VERSION__ == 100
        varying vec4 vColor;
    #else
        flat out vec4 vColor;
    #endif
#endif

#ifdef dTransparency
    varying float vGroup;
    varying float vTransparency;
    uniform vec2 uTransparencyTexDim;
    uniform sampler2D tTransparency;
#endif

#ifdef dUsePalette
    varying float vPaletteV;
#endif
`,cUe=`
#if dClipObjectCount != 0
    vec3 quaternionTransform(vec4 q, vec3 v) {
        vec3 t = 2.0 * cross(q.xyz, v);
        return v + q.w * t + cross(q.xyz, t);
    }

    vec4 computePlane(vec3 normal, vec3 inPoint) {
        return vec4(normalize(normal), -dot(normal, inPoint));
    }

    float planeSD(vec4 plane, vec3 center) {
        return -dot(plane.xyz, center - plane.xyz * -plane.w);
    }

    float sphereSD(vec3 position, vec4 rotation, vec3 size, vec3 center) {
        return (
            length(quaternionTransform(vec4(-rotation.x, -rotation.y, -rotation.z, rotation.w), center - position) / size) - 1.0
        ) * min(min(size.x, size.y), size.z);
    }

    float cubeSD(vec3 position, vec4 rotation, vec3 size, vec3 center) {
        vec3 d = abs(quaternionTransform(vec4(-rotation.x, -rotation.y, -rotation.z, rotation.w), center - position)) - size;
        return min(max(d.x, max(d.y, d.z)), 0.0) + length(max(d, 0.0));
    }

    float cylinderSD(vec3 position, vec4 rotation, vec3 size, vec3 center) {
        vec3 t = quaternionTransform(vec4(-rotation.x, -rotation.y, -rotation.z, rotation.w), center - position);

        vec2 d = abs(vec2(length(t.xz), t.y)) - size.xy;
        return min(max(d.x, d.y), 0.0) + length(max(d, 0.0));
    }

    float infiniteConeSD(vec3 position, vec4 rotation, vec3 size, vec3 center) {
        vec3 t = quaternionTransform(vec4(-rotation.x, -rotation.y, -rotation.z, rotation.w), center - position);

        float q = length(t.xy);
        return dot(size.xy, vec2(q, t.z));
    }

    float getSignedDistance(vec3 center, int type, vec3 position, vec4 rotation, vec3 scale) {
        if (type == 1) {
            vec3 normal = quaternionTransform(rotation, vec3(0.0, 1.0, 0.0));
            vec4 plane = computePlane(normal, position);
            return planeSD(plane, center);
        } else if (type == 2) {
            return sphereSD(position, rotation, scale * 0.5, center);
        } else if (type == 3) {
            return cubeSD(position, rotation, scale * 0.5, center);
        } else if (type == 4) {
            return cylinderSD(position, rotation, scale * 0.5, center);
        } else if (type == 5) {
            return infiniteConeSD(position, rotation, scale * 0.5, center);
        } else {
            return 0.1;
        }
    }

    #if __VERSION__ == 100
        // 8-bit
        int bitwiseAnd(int a, int b) {
            int d = 128;
            int result = 0;
            for (int i = 0; i < 8; ++i) {
                if (d <= 0) break;
                if (a >= d && b >= d) result += d;
                if (a >= d) a -= d;
                if (b >= d) b -= d;
                d /= 2;
            }
            return result;
        }

        bool hasBit(int mask, int bit) {
            return bitwiseAnd(mask, bit) == 0;
        }
    #else
        bool hasBit(int mask, int bit) {
            return (mask & bit) == 0;
        }
    #endif

    // flag is a bit-flag for clip-objects to ignore (note, object ids start at 1 not 0)
    bool clipTest(vec4 sphere, int flag) {
        for (int i = 0; i < dClipObjectCount; ++i) {
            if (flag == 0 || hasBit(flag, i + 1)) {
                // TODO take sphere radius into account?
                bool test = getSignedDistance(sphere.xyz, uClipObjectType[i], uClipObjectPosition[i], uClipObjectRotation[i], uClipObjectScale[i]) <= 0.0;
                if ((!uClipObjectInvert[i] && test) || (uClipObjectInvert[i] && !test)) {
                    return true;
                }
            }
        }
        return false;
    }
#endif
`,dUe=`
uniform int uObjectId;
uniform int uInstanceCount;
uniform int uGroupCount;

#if dClipObjectCount != 0
    uniform int uClipObjectType[dClipObjectCount];
    uniform bool uClipObjectInvert[dClipObjectCount];
    uniform vec3 uClipObjectPosition[dClipObjectCount];
    uniform vec4 uClipObjectRotation[dClipObjectCount];
    uniform vec3 uClipObjectScale[dClipObjectCount];

    #if defined(dClipping)
        #if __VERSION__ == 100
            varying float vClipping;
        #else
            flat in float vClipping;
        #endif
    #endif
#endif

uniform vec3 uHighlightColor;
uniform vec3 uSelectColor;
#if __VERSION__ == 100
    varying float vMarker;
#else
    flat in float vMarker;
#endif

varying vec3 vModelPosition;
varying vec3 vViewPosition;

uniform vec2 uViewOffset;

uniform float uNear;
uniform float uFar;
uniform float uIsOrtho;

uniform float uFogNear;
uniform float uFogFar;
uniform vec3 uFogColor;

uniform float uAlpha;
uniform float uPickingAlphaThreshold;
uniform bool uTransparentBackground;

uniform float uInteriorDarkening;
uniform bool uInteriorColorFlag;
uniform vec3 uInteriorColor;
bool interior;

uniform float uXrayEdgeFalloff;

uniform mat4 uProjection;
`,fUe=`
uniform mat4 uProjection, uModel, uView;
uniform vec3 uCameraPosition;

uniform int uObjectId;
uniform int uVertexCount;
uniform int uInstanceCount;
uniform int uGroupCount;
uniform vec4 uInvariantBoundingSphere;

#if dClipObjectCount != 0
    uniform int uClipObjectType[dClipObjectCount];
    uniform bool uClipObjectInvert[dClipObjectCount];
    uniform vec3 uClipObjectPosition[dClipObjectCount];
    uniform vec4 uClipObjectRotation[dClipObjectCount];
    uniform vec3 uClipObjectScale[dClipObjectCount];

    #if defined(dClipping)
        uniform vec2 uClippingTexDim;
        uniform sampler2D tClipping;
        #if __VERSION__ == 100
            varying float vClipping;
        #else
            flat out float vClipping;
        #endif
    #endif
#endif

uniform vec2 uMarkerTexDim;
uniform sampler2D tMarker;
#if __VERSION__ == 100
    varying float vMarker;
#else
    flat out float vMarker;
#endif

varying vec3 vModelPosition;
varying vec3 vViewPosition;

#if __VERSION__ == 100
    attribute float aVertex;
    #define VertexID int(aVertex)
#else
    // not using gl_VertexID but aVertex to ensure there is an active attribute with divisor 0
    // since FF 85 this is not needed anymore but lets keep it for backwards compatibility
    // https://bugzilla.mozilla.org/show_bug.cgi?id=1679693
    // see also note in src/mol-gl/webgl/render-item.ts
    attribute float aVertex;
    #define VertexID int(aVertex)
    // #define VertexID gl_VertexID
#endif
`,pUe=`
// TODO find a better place for these convenience defines

#if defined(dRenderVariant_colorBlended) || defined(dRenderVariant_colorWboit)
    #define dRenderVariant_color
#endif

#if defined(dRenderVariant_pickObject) || defined(dRenderVariant_pickInstance) || defined(dRenderVariant_pickGroup)
    #define dRenderVariant_pick
#endif

#if defined(dColorType_instance) || defined(dColorType_group) || defined(dColorType_groupInstance) || defined(dColorType_vertex) || defined(dColorType_vertexInstance)
    #define dColorType_texture
#endif

#if defined(dColorType_volume) || defined(dColorType_volumeInstance)
    #define dColorType_grid
#endif

#if defined(dColorType_attribute) || defined(dColorType_texture) || defined(dColorType_grid)
    #define dColorType_varying
#endif

//

#define PI 3.14159265
#define RECIPROCAL_PI 0.31830988618
#define EPSILON 1e-6

#define saturate(a) clamp(a, 0.0, 1.0)

float intDiv(const in float a, const in float b) { return float(int(a) / int(b)); }
vec2 ivec2Div(const in vec2 a, const in vec2 b) { return vec2(ivec2(a) / ivec2(b)); }
float intMod(const in float a, const in float b) { return a - b * float(int(a) / int(b)); }
int imod(const in int a, const in int b) { return a - b * (a / b); }

float pow2(const in float x) { return x * x; }

const float maxFloat = 10000.0; // NOTE constant also set in TypeScript
const float floatLogFactor = 9.210440366976517; // log(maxFloat + 1.0);
float encodeFloatLog(const in float value) { return log(value + 1.0) / floatLogFactor; }
float decodeFloatLog(const in float value) { return exp(value * floatLogFactor) - 1.0; }

vec3 encodeFloatRGB(in float value) {
    value = clamp(value, 0.0, 16777216.0 - 1.0) + 1.0;
    vec3 c = vec3(0.0);
    c.b = mod(value, 256.0);
    value = floor(value / 256.0);
    c.g = mod(value, 256.0);
    value = floor(value / 256.0);
    c.r = mod(value, 256.0);
    return c / 255.0;
}
float decodeFloatRGB(const in vec3 rgb) {
    return (rgb.r * 256.0 * 256.0 * 255.0 + rgb.g * 256.0 * 255.0 + rgb.b * 255.0) - 1.0;
}

vec2 packUnitIntervalToRG(const in float v) {
    vec2 enc;
    enc.xy = vec2(fract(v * 256.0), v);
    enc.y -= enc.x * (1.0 / 256.0);
    enc.xy *=  256.0 / 255.0;

    return enc;
}

float unpackRGToUnitInterval(const in vec2 enc) {
    return dot(enc, vec2(255.0 / (256.0 * 256.0), 255.0 / 256.0));
}

vec3 screenSpaceToViewSpace(const in vec3 ssPos, const in mat4 invProjection) {
    vec4 p = vec4(ssPos * 2.0 - 1.0, 1.0);
    p = invProjection * p;
    return p.xyz / p.w;
}

const float PackUpscale = 256.0 / 255.0; // fraction -> 0..1 (including 1)
const float UnpackDownscale = 255.0 / 256.0; // 0..1 -> fraction (excluding 1)
const vec3 PackFactors = vec3(256.0 * 256.0 * 256.0, 256.0 * 256.0,  256.0);
const vec4 UnpackFactors = UnpackDownscale / vec4(PackFactors, 1.0);
const float ShiftRight8 = 1.0 / 256.0;

vec4 packDepthToRGBA(const in float v) {
    vec4 r = vec4(fract(v * PackFactors), v);
    r.yzw -= r.xyz * ShiftRight8; // tidy overflow
    return r * PackUpscale;
}
float unpackRGBAToDepth(const in vec4 v) {
    return dot(v, UnpackFactors);
}

vec4 sRGBToLinear(const in vec4 c) {
    return vec4(mix(pow(c.rgb * 0.9478672986 + vec3(0.0521327014), vec3(2.4)), c.rgb * 0.0773993808, vec3(lessThanEqual(c.rgb, vec3(0.04045)))), c.a);
}
vec4 linearTosRGB(const in vec4 c) {
    return vec4(mix(pow(c.rgb, vec3(0.41666)) * 1.055 - vec3(0.055), c.rgb * 12.92, vec3(lessThanEqual(c.rgb, vec3(0.0031308)))), c.a);
}

float linearizeDepth(const in float depth, const in float near, const in float far) {
    return (2.0 * near) / (far + near - depth * (far - near));
}

float perspectiveDepthToViewZ(const in float invClipZ, const in float near, const in float far) {
    return (near * far) / ((far - near) * invClipZ - far);
}

float orthographicDepthToViewZ(const in float linearClipZ, const in float near, const in float far) {
    return linearClipZ * (near - far) - near;
}

float depthToViewZ(const in float isOrtho, const in float linearClipZ, const in float near, const in float far) {
    return isOrtho == 1.0 ? orthographicDepthToViewZ(linearClipZ, near, far) : perspectiveDepthToViewZ(linearClipZ, near, far);
}

#if __VERSION__ == 100
    // transpose

    float transpose(const in float m) {
        return m;
    }

    mat2 transpose2(const in mat2 m) {
        return mat2(
            m[0][0], m[1][0],
            m[0][1], m[1][1]
        );
    }

    mat3 transpose3(const in mat3 m) {
        return mat3(
            m[0][0], m[1][0], m[2][0],
            m[0][1], m[1][1], m[2][1],
            m[0][2], m[1][2], m[2][2]
        );
    }

    mat4 transpose4(const in mat4 m) {
        return mat4(
            m[0][0], m[1][0], m[2][0], m[3][0],
            m[0][1], m[1][1], m[2][1], m[3][1],
            m[0][2], m[1][2], m[2][2], m[3][2],
            m[0][3], m[1][3], m[2][3], m[3][3]
        );
    }

    // inverse

    float inverse(const in float m) {
        return 1.0 / m;
    }

    mat2 inverse2(const in mat2 m) {
        return mat2(m[1][1],-m[0][1],
                -m[1][0], m[0][0]) / (m[0][0]*m[1][1] - m[0][1]*m[1][0]);
    }

    mat3 inverse3(const in mat3 m) {
        float a00 = m[0][0], a01 = m[0][1], a02 = m[0][2];
        float a10 = m[1][0], a11 = m[1][1], a12 = m[1][2];
        float a20 = m[2][0], a21 = m[2][1], a22 = m[2][2];

        float b01 = a22 * a11 - a12 * a21;
        float b11 = -a22 * a10 + a12 * a20;
        float b21 = a21 * a10 - a11 * a20;

        float det = a00 * b01 + a01 * b11 + a02 * b21;

        return mat3(b01, (-a22 * a01 + a02 * a21), (a12 * a01 - a02 * a11),
                    b11, (a22 * a00 - a02 * a20), (-a12 * a00 + a02 * a10),
                    b21, (-a21 * a00 + a01 * a20), (a11 * a00 - a01 * a10)) / det;
    }

    mat4 inverse4(const in mat4 m) {
        float
            a00 = m[0][0], a01 = m[0][1], a02 = m[0][2], a03 = m[0][3],
            a10 = m[1][0], a11 = m[1][1], a12 = m[1][2], a13 = m[1][3],
            a20 = m[2][0], a21 = m[2][1], a22 = m[2][2], a23 = m[2][3],
            a30 = m[3][0], a31 = m[3][1], a32 = m[3][2], a33 = m[3][3],

            b00 = a00 * a11 - a01 * a10,
            b01 = a00 * a12 - a02 * a10,
            b02 = a00 * a13 - a03 * a10,
            b03 = a01 * a12 - a02 * a11,
            b04 = a01 * a13 - a03 * a11,
            b05 = a02 * a13 - a03 * a12,
            b06 = a20 * a31 - a21 * a30,
            b07 = a20 * a32 - a22 * a30,
            b08 = a20 * a33 - a23 * a30,
            b09 = a21 * a32 - a22 * a31,
            b10 = a21 * a33 - a23 * a31,
            b11 = a22 * a33 - a23 * a32,

            det = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;

        return mat4(
            a11 * b11 - a12 * b10 + a13 * b09,
            a02 * b10 - a01 * b11 - a03 * b09,
            a31 * b05 - a32 * b04 + a33 * b03,
            a22 * b04 - a21 * b05 - a23 * b03,
            a12 * b08 - a10 * b11 - a13 * b07,
            a00 * b11 - a02 * b08 + a03 * b07,
            a32 * b02 - a30 * b05 - a33 * b01,
            a20 * b05 - a22 * b02 + a23 * b01,
            a10 * b10 - a11 * b08 + a13 * b06,
            a01 * b08 - a00 * b10 - a03 * b06,
            a30 * b04 - a31 * b02 + a33 * b00,
            a21 * b02 - a20 * b04 - a23 * b00,
            a11 * b07 - a10 * b09 - a12 * b06,
            a00 * b09 - a01 * b07 + a02 * b06,
            a31 * b01 - a30 * b03 - a32 * b00,
            a20 * b03 - a21 * b01 + a22 * b00) / det;
    }
#else
    #define transpose2(m) transpose(m)
    #define transpose3(m) transpose(m)
    #define transpose4(m) transpose(m)

    #define inverse2(m) inverse(m)
    #define inverse3(m) inverse(m)
    #define inverse4(m) inverse(m)
#endif
`,hUe=`
    // floatToRgba adapted from https://github.com/equinor/glsl-float-to-rgba
    // MIT License, Copyright (c) 2020 Equinor

    float shiftRight (float v, float amt) {
    v = floor(v) + 0.5;
    return floor(v / exp2(amt));
    }
    float shiftLeft (float v, float amt) {
        return floor(v * exp2(amt) + 0.5);
    }
    float maskLast (float v, float bits) {
        return mod(v, shiftLeft(1.0, bits));
    }
    float extractBits (float num, float from, float to) {
        from = floor(from + 0.5); to = floor(to + 0.5);
        return maskLast(shiftRight(num, from), to - from);
    }

    vec4 floatToRgba(float texelFloat, bool littleEndian) {
        if (texelFloat == 0.0) return vec4(0.0, 0.0, 0.0, 0.0);
        float sign = texelFloat > 0.0 ? 0.0 : 1.0;
        texelFloat = abs(texelFloat);
        float exponent = floor(log2(texelFloat));
        float biased_exponent = exponent + 127.0;
        float fraction = ((texelFloat / exp2(exponent)) - 1.0) * 8388608.0;
        float t = biased_exponent / 2.0;
        float last_bit_of_biased_exponent = fract(t) * 2.0;
        float remaining_bits_of_biased_exponent = floor(t);
        float byte4 = extractBits(fraction, 0.0, 8.0) / 255.0;
        float byte3 = extractBits(fraction, 8.0, 16.0) / 255.0;
        float byte2 = (last_bit_of_biased_exponent * 128.0 + extractBits(fraction, 16.0, 23.0)) / 255.0;
        float byte1 = (sign * 128.0 + remaining_bits_of_biased_exponent) / 255.0;
        return (
            littleEndian
                ? vec4(byte4, byte3, byte2, byte1)
                : vec4(byte1, byte2, byte3, byte4)
        );
    }
`,vUe=`
uniform float uLightIntensity;
uniform float uAmbientIntensity;
uniform float uReflectivity;
uniform float uMetalness;
uniform float uRoughness;

struct PhysicalMaterial {
    vec3 diffuseColor;
    float specularRoughness;
    vec3 specularColor;
};

struct IncidentLight {
    vec3 color;
    vec3 direction;
};

struct ReflectedLight {
    vec3 directDiffuse;
    vec3 directSpecular;
    vec3 indirectDiffuse;
};

struct GeometricContext {
    vec3 position;
    vec3 normal;
    vec3 viewDir;
};

vec3 F_Schlick(const in vec3 specularColor, const in float dotLH) {
    // Original approximation by Christophe Schlick '94
    // float fresnel = pow( 1.0 - dotLH, 5.0 );
    // Optimized variant (presented by Epic at SIGGRAPH '13)
    // https://cdn2.unrealengine.com/Resources/files/2013SiggraphPresentationsNotes-26915738.pdf
    float fresnel = exp2((-5.55473 * dotLH - 6.98316) * dotLH);
    return (1.0 - specularColor) * fresnel + specularColor;
}

// Moving Frostbite to Physically Based Rendering 3.0 - page 12, listing 2
// https://seblagarde.files.wordpress.com/2015/07/course_notes_moving_frostbite_to_pbr_v32.pdf
float G_GGX_SmithCorrelated(const in float alpha, const in float dotNL, const in float dotNV) {
    float a2 = pow2(alpha);
    // dotNL and dotNV are explicitly swapped. This is not a mistake.
    float gv = dotNL * sqrt(a2 + (1.0 - a2) * pow2(dotNV));
    float gl = dotNV * sqrt(a2 + (1.0 - a2) * pow2(dotNL));
    return 0.5 / max(gv + gl, EPSILON);
}

// Microfacet Models for Refraction through Rough Surfaces - equation (33)
// http://graphicrants.blogspot.com/2013/08/specular-brdf-reference.html
// alpha is "roughness squared" in Disneys reparameterization
float D_GGX(const in float alpha, const in float dotNH) {
    float a2 = pow2(alpha);
    float denom = pow2(dotNH) * (a2 - 1.0) + 1.0; // avoid alpha = 0 with dotNH = 1
    return RECIPROCAL_PI * a2 / pow2(denom);
}

vec3 BRDF_Diffuse_Lambert(const in vec3 diffuseColor) {
    return RECIPROCAL_PI * diffuseColor;
}

// GGX Distribution, Schlick Fresnel, GGX-Smith Visibility
vec3 BRDF_Specular_GGX(const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float roughness) {
    float alpha = pow2(roughness); // UE4's roughness
    vec3 halfDir = normalize(incidentLight.direction + geometry.viewDir);

    float dotNL = saturate(dot(geometry.normal, incidentLight.direction));
    float dotNV = saturate(dot(geometry.normal, geometry.viewDir));
    float dotNH = saturate(dot(geometry.normal, halfDir));
    float dotLH = saturate(dot(incidentLight.direction, halfDir));

    vec3 F = F_Schlick(specularColor, dotLH);
    float G = G_GGX_SmithCorrelated(alpha, dotNL, dotNV);
    float D = D_GGX(alpha, dotNH);
    return F * (G * D);
}

// ref: https://www.unrealengine.com/blog/physically-based-shading-on-mobile - environmentBRDF for GGX on mobile
vec3 BRDF_Specular_GGX_Environment(const in GeometricContext geometry, const in vec3 specularColor, const in float roughness) {
    float dotNV = saturate(dot(geometry.normal, geometry.viewDir));
    const vec4 c0 = vec4(-1, -0.0275, -0.572, 0.022);
    const vec4 c1 = vec4(1, 0.0425, 1.04, -0.04);
    vec4 r = roughness * c0 + c1;
    float a004 = min(r.x * r.x, exp2(-9.28 * dotNV)) * r.x + r.y;
    vec2 AB = vec2(-1.04, 1.04) * a004 + r.zw;
    return specularColor * AB.x + AB.y;
}

void RE_Direct_Physical(const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
    float dotNL = saturate(dot(geometry.normal, directLight.direction));
    vec3 irradiance = dotNL * directLight.color;
    irradiance *= PI; // punctual light

    reflectedLight.directSpecular += irradiance * BRDF_Specular_GGX(directLight, geometry, material.specularColor, material.specularRoughness);
    reflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert(material.diffuseColor);
}

void RE_IndirectDiffuse_Physical(const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
    reflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert(material.diffuseColor);
}
`,mUe=`
float matrixScale(in mat4 m){
    vec4 r = m[0];
    return sqrt(r[0] * r[0] + r[1] * r[1] + r[2] * r[2]);
}
`,gUe=`
varying vec3 vNormal;
`,yUe=`
vec4 readFromTexture(const in sampler2D tex, const in float i, const in vec2 dim) {
    float x = intMod(i, dim.x);
    float y = floor(intDiv(i, dim.x));
    vec2 uv = (vec2(x, y) + 0.5) / dim;
    return texture2D(tex, uv);
}

vec4 readFromTexture(const in sampler2D tex, const in int i, const in vec2 dim) {
    int x = imod(i, int(dim.x));
    int y = i / int(dim.x);
    vec2 uv = (vec2(x, y) + 0.5) / dim;
    return texture2D(tex, uv);
}
`,bUe=`
    // rgbaToFloat adapted from https://github.com/ihmeuw/glsl-rgba-to-float
    // BSD 3-Clause License
    //
    // Copyright (c) 2019, Institute for Health Metrics and Evaluation All rights reserved.
    // Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:
    //  - Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.
    //  - Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.
    //  - Neither the name of the copyright holder nor the names of its contributors may be used to endorse or promote products derived from this software without specific prior written permission.
    //
    // THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES,
    // INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.
    // IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY,
    // OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA,
    // OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
    // OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED
    // OF THE POSSIBILITY OF SUCH DAMAGE.

    ivec4 floatsToBytes(vec4 inputFloats, bool littleEndian) {
        ivec4 bytes = ivec4(inputFloats * 255.0);
        return (
            littleEndian
                ? bytes.abgr
                : bytes
        );
    }

    // Break the four bytes down into an array of 32 bits.
    void bytesToBits(const in ivec4 bytes, out bool bits[32]) {
        for (int channelIndex = 0; channelIndex < 4; ++channelIndex) {
            float acc = float(bytes[channelIndex]);
            for (int indexInByte = 7; indexInByte >= 0; --indexInByte) {
                float powerOfTwo = exp2(float(indexInByte));
                bool bit = acc >= powerOfTwo;
                bits[channelIndex * 8 + (7 - indexInByte)] = bit;
                acc = mod(acc, powerOfTwo);
            }
        }
    }

    // Compute the exponent of the 32-bit float.
    float getExponent(bool bits[32]) {
        const int startIndex = 1;
        const int bitStringLength = 8;
        const int endBeforeIndex = startIndex + bitStringLength;
        float acc = 0.0;
        int pow2 = bitStringLength - 1;
        for (int bitIndex = startIndex; bitIndex < endBeforeIndex; ++bitIndex) {
            acc += float(bits[bitIndex]) * exp2(float(pow2--));
        }
        return acc;
    }

    // Compute the mantissa of the 32-bit float.
    float getMantissa(bool bits[32], bool subnormal) {
        const int startIndex = 9;
        const int bitStringLength = 23;
        const int endBeforeIndex = startIndex + bitStringLength;
        // Leading/implicit/hidden bit convention:
        // If the number is not subnormal (with exponent 0), we add a leading 1 digit.
        float acc = float(!subnormal) * exp2(float(bitStringLength));
        int pow2 = bitStringLength - 1;
        for (int bitIndex = startIndex; bitIndex < endBeforeIndex; ++bitIndex) {
            acc += float(bits[bitIndex]) * exp2(float(pow2--));
        }
        return acc;
    }

    // Parse the float from its 32 bits.
    float bitsToFloat(bool bits[32]) {
        float signBit = float(bits[0]) * -2.0 + 1.0;
        float exponent = getExponent(bits);
        bool subnormal = abs(exponent - 0.0) < 0.01;
        float mantissa = getMantissa(bits, subnormal);
        float exponentBias = 127.0;
        return signBit * mantissa * exp2(exponent - exponentBias - 23.0);
    }

    float rgbaToFloat(vec4 texelRGBA, bool littleEndian) {
        ivec4 rgbaBytes = floatsToBytes(texelRGBA, littleEndian);
        bool bits[32];
        bytesToBits(rgbaBytes, bits);
        return bitsToFloat(bits);
    }
`,xUe=`
#if defined(dSizeType_uniform)
    uniform float uSize;
#elif defined(dSizeType_attribute)
    attribute float aSize;
#elif defined(dSizeType_instance) || defined(dSizeType_group) || defined(dSizeType_groupInstance)
    uniform vec2 uSizeTexDim;
    uniform sampler2D tSize;
#endif

uniform float uSizeFactor;
`,SUe=`
vec4 texture3dFrom1dTrilinear(const in sampler2D tex, const in vec3 pos, const in vec3 gridDim, const in vec2 texDim, const in float offset) {
    float gdYZ = gridDim.z * gridDim.y;
    float gdZ = gridDim.z;
    vec3 p0 = floor(pos * gridDim);
    vec3 p1 = ceil(pos * gridDim);
    vec3 pd = (pos * gridDim - p0) / (p1 - p0);
    vec4 s000 = readFromTexture(tex, offset + p0.z + p0.y * gdZ + p0.x * gdYZ, texDim);
    vec4 s100 = readFromTexture(tex, offset + p0.z + p0.y * gdZ + p1.x * gdYZ, texDim);
    vec4 s001 = readFromTexture(tex, offset + p1.z + p0.y * gdZ + p0.x * gdYZ, texDim);
    vec4 s101 = readFromTexture(tex, offset + p1.z + p0.y * gdZ + p1.x * gdYZ, texDim);
    vec4 s010 = readFromTexture(tex, offset + p0.z + p1.y * gdZ + p0.x * gdYZ, texDim);
    vec4 s110 = readFromTexture(tex, offset + p0.z + p1.y * gdZ + p1.x * gdYZ, texDim);
    vec4 s011 = readFromTexture(tex, offset + p1.z + p1.y * gdZ + p0.x * gdYZ, texDim);
    vec4 s111 = readFromTexture(tex, offset + p1.z + p1.y * gdZ + p1.x * gdYZ, texDim);
    vec4 s00 = mix(s000, s100, pd.x);
    vec4 s01 = mix(s001, s101, pd.x);
    vec4 s10 = mix(s010, s110, pd.x);
    vec4 s11 = mix(s011, s111, pd.x);
    vec4 s0 = mix(s00, s10, pd.y);
    vec4 s1 = mix(s01, s11, pd.y);
    return mix(s0, s1, pd.z);
}
`,CUe=`
vec4 texture3dFrom2dLinear(sampler2D tex, vec3 pos, vec3 gridDim, vec2 texDim) {
    float zSlice0 = floor(pos.z * gridDim.z);
    float column0 = intMod(zSlice0 * gridDim.x, texDim.x) / gridDim.x;
    float row0 = floor(intDiv(zSlice0 * gridDim.x, texDim.x));
    vec2 coord0 = (vec2(column0 * gridDim.x, row0 * gridDim.y) + (pos.xy * gridDim.xy)) / texDim;
    vec4 color0 = texture2D(tex, coord0);

    float zSlice1 = zSlice0 + 1.0;
    float column1 = intMod(zSlice1 * gridDim.x, texDim.x) / gridDim.x;
    float row1 = floor(intDiv(zSlice1 * gridDim.x, texDim.x));
    vec2 coord1 = (vec2(column1 * gridDim.x, row1 * gridDim.y) + (pos.xy * gridDim.xy)) / texDim;
    vec4 color1 = texture2D(tex, coord1);

    float delta0 = abs((pos.z * gridDim.z) - zSlice0);
    return mix(color0, color1, delta0);
}
`,_Ue=`
vec4 texture3dFrom2dNearest(sampler2D tex, vec3 pos, vec3 gridDim, vec2 texDim) {
    float zSlice = floor(pos.z * gridDim.z + 0.5); // round to nearest z-slice
    float column = intMod(zSlice * gridDim.x, texDim.x) / gridDim.x;
    float row = floor(intDiv(zSlice * gridDim.x, texDim.x));
    vec2 coord = (vec2(column * gridDim.x, row * gridDim.y) + (pos.xy * gridDim.xy)) / texDim;
    return texture2D(tex, coord);
}
`,wUe=`
#if defined(dRenderVariant_colorWboit)
    #if !defined(dRenderMode_volume) && !defined(dRenderMode_isosurface)
        uniform sampler2D tDepth;
        uniform vec2 uDrawingBufferSize;

        float getDepth(const in vec2 coords) {
            // always packed due to merged depth from primitives and volumes
            return unpackRGBAToDepth(texture2D(tDepth, coords));
        }
    #endif
#endif

uniform bool uRenderWboit;

float calcDepth(const in vec3 pos) {
    vec2 clipZW = pos.z * uProjection[2].zw + uProjection[3].zw;
    return 0.5 + 0.5 * clipZW.x / clipZW.y;
}
`,EUe=`
#if defined(dRenderVariant_colorWboit)
    if (!uRenderWboit) {
        if (preFogAlpha < 1.0) {
            discard;
        }
    } else if (uRenderWboit) {
        // the 'fragmentDepth > 0.99' check is to handle precision issues with packed depth
        if (preFogAlpha != 1.0 && !interior && (fragmentDepth < getDepth(gl_FragCoord.xy / uDrawingBufferSize) || fragmentDepth > 0.99)) {
            float alpha = gl_FragColor.a;
            float wboitWeight = alpha * clamp(pow(1.0 - fragmentDepth, 2.0), 0.01, 1.0);
            gl_FragColor = vec4(gl_FragColor.rgb * alpha * wboitWeight, alpha);
            // extra alpha is to handle pre-multiplied alpha
            #if !defined(dRenderMode_volume) && !defined(dRenderMode_isosurface)
                gl_FragData[1] = vec4((uTransparentBackground ? alpha : 1.0) * alpha * wboitWeight);
            #else
                gl_FragData[1] = vec4(alpha * alpha * wboitWeight);
            #endif
        } else {
            discard;
        }
    }
#endif
`,AUe=`
precision highp float;
precision highp int;

#include common
#include read_from_texture
#include common_vert_params
#include color_vert_params
#include size_vert_params
#include common_clip

uniform float uPixelRatio;
uniform float uViewportHeight;

attribute vec3 aPosition;
attribute mat4 aTransform;
attribute float aInstance;
attribute float aGroup;

void main(){
    #include assign_group
    #include assign_color_varying
    #include assign_marker_varying
    #include assign_clipping_varying
    #include assign_position
    #include assign_size

    #ifdef dPointSizeAttenuation
        gl_PointSize = size * uPixelRatio * ((uViewportHeight / 2.0) / -mvPosition.z) * 5.0;
    #else
        gl_PointSize = size * uPixelRatio;
    #endif

    gl_Position = uProjection * mvPosition;

    #include clip_instance
}
`,PUe=`
precision highp float;
precision highp int;

#include common
#include common_frag_params
#include color_frag_params
#include common_clip
#include wboit_params

#ifdef dPointFilledCircle
    uniform float uPointEdgeBleach;
#endif

const vec2 center = vec2(0.5);
const float radius = 0.5;

void main(){
    #include clip_pixel

    float fragmentDepth = gl_FragCoord.z;
    bool interior = false;
    #include assign_material_color

    #if defined(dRenderVariant_pick)
        #include check_picking_alpha
        gl_FragColor = material;
    #elif defined(dRenderVariant_depth)
        gl_FragColor = material;
    #elif defined(dRenderVariant_color)
        gl_FragColor = material;

        #ifdef dPointFilledCircle
            float dist = distance(gl_PointCoord, center);
            float alpha = 1.0 - smoothstep(radius - uPointEdgeBleach, radius, dist);
            if (alpha < 0.0001) discard;
            gl_FragColor.a *= alpha;
        #endif

        #include apply_marker_color
        #include apply_fog
        #include wboit_write
    #endif
}
`,TUe=`
precision highp float;
precision highp int;

#include common
#include read_from_texture
#include common_vert_params
#include color_vert_params
#include size_vert_params
#include common_clip

uniform mat4 uModelView;
uniform mat4 uInvProjection;

attribute vec3 aPosition;
attribute vec2 aMapping;
attribute mat4 aTransform;
attribute float aInstance;
attribute float aGroup;

varying float vRadius;
varying float vRadiusSq;
varying vec3 vPoint;
varying vec3 vPointViewPosition;

#include matrix_scale

const mat4 D = mat4(
    1.0, 0.0, 0.0, 0.0,
    0.0, 1.0, 0.0, 0.0,
    0.0, 0.0, 1.0, 0.0,
    0.0, 0.0, 0.0, -1.0
);

/**
 * Compute point size and center using the technique described in:
 * "GPU-Based Ray-Casting of Quadratic Surfaces" http://dl.acm.org/citation.cfm?id=2386396
 * by Christian Sigg, Tim Weyrich, Mario Botsch, Markus Gross.
 */
void quadraticProjection(const in float radius, const in vec3 position){
    vec2 xbc, ybc;

    mat4 T = mat4(
        radius, 0.0, 0.0, 0.0,
        0.0, radius, 0.0, 0.0,
        0.0, 0.0, radius, 0.0,
        position.x, position.y, position.z, 1.0
    );

    mat4 R = transpose4(uProjection * uModelView * aTransform * T);
    float A = dot(R[3], D * R[3]);
    float B = -2.0 * dot(R[0], D * R[3]);
    float C = dot(R[0], D * R[0]);
    xbc[0] = (-B - sqrt(B * B - 4.0 * A * C)) / (2.0 * A);
    xbc[1] = (-B + sqrt(B * B - 4.0 * A * C)) / (2.0 * A);
    float sx = abs(xbc[0] - xbc[1]) * 0.5;

    A = dot(R[3], D * R[3]);
    B = -2.0 * dot(R[1], D * R[3]);
    C = dot(R[1], D * R[1]);
    ybc[0] = (-B - sqrt(B * B - 4.0 * A * C)) / (2.0 * A);
    ybc[1] = (-B + sqrt(B * B - 4.0 * A * C)) / (2.0 * A);
    float sy = abs(ybc[0] - ybc[1]) * 0.5;

    gl_Position.xy = vec2(0.5 * (xbc.x + xbc.y), 0.5 * (ybc.x + ybc.y));
    gl_Position.xy -= aMapping * vec2(sx, sy);
    gl_Position.xy *= gl_Position.w;
}


void main(void){
    #include assign_group
    #include assign_color_varying
    #include assign_marker_varying
    #include assign_clipping_varying
    #include assign_size

    vRadius = size * matrixScale(uModelView);

    vec4 position4 = vec4(aPosition, 1.0);
    vec4 mvPosition = uModelView * aTransform * position4;
    mvPosition.z -= vRadius; // avoid clipping, added again in fragment shader

    gl_Position = uProjection * vec4(mvPosition.xyz, 1.0);
    quadraticProjection(size, aPosition);

    vRadiusSq = vRadius * vRadius;
    vec4 vPoint4 = uInvProjection * gl_Position;
    vPoint = vPoint4.xyz / vPoint4.w;
    vPointViewPosition = -mvPosition.xyz / mvPosition.w;

    vModelPosition = (uModel * aTransform * position4).xyz; // for clipping in frag shader

    #include clip_instance
}
`,IUe=`
precision highp float;
precision highp int;

#include common
#include common_frag_params
#include color_frag_params
#include light_frag_params
#include common_clip
#include wboit_params

varying float vRadius;
varying float vRadiusSq;
varying vec3 vPoint;
varying vec3 vPointViewPosition;

vec3 cameraPos;
vec3 cameraNormal;

bool Impostor(out vec3 cameraPos, out vec3 cameraNormal){
    vec3 cameraSpherePos = -vPointViewPosition;
    cameraSpherePos.z += vRadius;

    vec3 rayOrigin = mix(vec3(0.0, 0.0, 0.0), vPoint, uIsOrtho);
    vec3 rayDirection = mix(normalize(vPoint), vec3(0.0, 0.0, 1.0), uIsOrtho);
    vec3 cameraSphereDir = mix(cameraSpherePos, rayOrigin - cameraSpherePos, uIsOrtho);

    float B = dot(rayDirection, cameraSphereDir);
    float det = B * B + vRadiusSq - dot(cameraSphereDir, cameraSphereDir);

    if (det < 0.0){
        discard;
        return false;
    }

    float sqrtDet = sqrt(det);
    float posT = mix(B + sqrtDet, B + sqrtDet, uIsOrtho);
    float negT = mix(B - sqrtDet, sqrtDet - B, uIsOrtho);

    cameraPos = rayDirection * negT + rayOrigin;


    if (calcDepth(cameraPos) <= 0.0) {
        cameraPos = rayDirection * posT + rayOrigin;
        interior = true;
    } else {
        interior = false;
    }

    cameraNormal = normalize(cameraPos - cameraSpherePos);
    cameraNormal *= float(!interior) * 2.0 - 1.0;

    return !interior;
}

void main(void){
    #include clip_pixel

    bool flag = Impostor(cameraPos, cameraNormal);
    #ifndef dDoubleSided
        if (interior)
            discard;
    #endif

    vec3 vViewPosition = cameraPos;
    gl_FragDepthEXT = calcDepth(vViewPosition);
    if (!flag && gl_FragDepthEXT >= 0.0) {
        gl_FragDepthEXT = 0.0 + (0.0000001 / vRadius);
    }

    // bugfix (mac only?)
    if (gl_FragDepthEXT < 0.0) discard;
    if (gl_FragDepthEXT > 1.0) discard;

    float fragmentDepth = gl_FragDepthEXT;
    #include assign_material_color

    #if defined(dRenderVariant_pick)
        #include check_picking_alpha
        gl_FragColor = material;
    #elif defined(dRenderVariant_depth)
        gl_FragColor = material;
    #elif defined(dRenderVariant_color)
        #ifdef dIgnoreLight
            gl_FragColor = material;
        #else
            vec3 normal = -cameraNormal;
            #include apply_light_color
        #endif

        #include apply_interior_color
        #include apply_marker_color
        #include apply_fog
        #include wboit_write
    #endif
}
`,MUe=`
precision highp float;
precision highp int;

#include common
#include read_from_texture
#include common_vert_params
#include color_vert_params
#include size_vert_params
#include common_clip

uniform mat4 uModelView;

attribute mat4 aTransform;
attribute float aInstance;
attribute float aGroup;

attribute vec3 aMapping;
attribute vec3 aStart;
attribute vec3 aEnd;
attribute float aScale;
attribute float aCap;

varying mat4 vTransform;
varying vec3 vStart;
varying vec3 vEnd;
varying float vSize;
varying float vCap;

uniform float uIsOrtho;
uniform vec3 uCameraDir;

void main() {
    #include assign_group
    #include assign_color_varying
    #include assign_marker_varying
    #include assign_clipping_varying
    #include assign_size

    mat4 modelTransform = uModel * aTransform;

    vTransform = aTransform;
    vStart = (modelTransform * vec4(aStart, 1.0)).xyz;
    vEnd = (modelTransform * vec4(aEnd, 1.0)).xyz;
    vSize = size * aScale;
    vCap = aCap;

    vModelPosition = (vStart + vEnd) * 0.5;
    vec3 camDir = -mix(normalize(vModelPosition - uCameraPosition), uCameraDir, uIsOrtho);
    vec3 dir = vEnd - vStart;
    // ensure cylinder 'dir' is pointing towards the camera
    if(dot(camDir, dir) < 0.0) dir = -dir;

    vec3 left = cross(camDir, dir);
    vec3 up = cross(left, dir);
    left = vSize * normalize(left);
    up = vSize * normalize(up);

    // move vertex in object-space from center to corner
    vModelPosition += aMapping.x * dir + aMapping.y * left + aMapping.z * up;

    vec4 mvPosition = uView * vec4(vModelPosition, 1.0);
    vViewPosition = mvPosition.xyz;
    gl_Position = uProjection * mvPosition;

    #include clip_instance
}
`,DUe=`
precision highp float;
precision highp int;

uniform mat4 uView;

varying mat4 vTransform;
varying vec3 vStart;
varying vec3 vEnd;
varying float vSize;
varying float vCap;

uniform vec3 uCameraDir;
uniform vec3 uCameraPosition;

#include common
#include common_frag_params
#include color_frag_params
#include light_frag_params
#include common_clip
#include wboit_params

// adapted from https://www.shadertoy.com/view/4lcSRn
// The MIT License, Copyright 2016 Inigo Quilez
bool CylinderImpostor(
    in vec3 rayOrigin, in vec3 rayDir,
    in vec3 start, in vec3 end, in float radius,
    out vec4 intersection, out bool interior
){
    vec3 ba = end - start;
    vec3 oc = rayOrigin - start;

    float baba = dot(ba, ba);
    float bard = dot(ba, rayDir);
    float baoc = dot(ba, oc);

    float k2 = baba - bard*bard;
    float k1 = baba * dot(oc, rayDir) - baoc * bard;
    float k0 = baba * dot(oc, oc) - baoc * baoc - radius * radius * baba;

    float h = k1 * k1 - k2 * k0;
    if (h < 0.0) return false;

    bool topCap = (vCap > 0.9 && vCap < 1.1) || vCap >= 2.9;
    bool bottomCap = (vCap > 1.9 && vCap < 2.1) || vCap >= 2.9;

    // body outside
    h = sqrt(h);
    float t = (-k1 - h) / k2;
    float y = baoc + t * bard;
    if (y > 0.0 && y < baba) {
        interior = false;
        intersection = vec4(t, (oc + t * rayDir - ba * y / baba) / radius);
        return true;
    }

    if (topCap && y < 0.0) {
        // top cap
        t = -baoc / bard;
        if (abs(k1 + k2 * t) < h) {
            interior = false;
            intersection = vec4(t, ba * sign(y) / baba);
            return true;
        }
    } else if(bottomCap && y >= 0.0) {
        // bottom cap
        t = (baba - baoc) / bard;
        if (abs(k1 + k2 * t) < h) {
            interior = false;
            intersection = vec4(t, ba * sign(y) / baba);
            return true;
        }
    }

    #ifdef dDoubleSided
        // body inside
        h = -h;
        t = (-k1 - h) / k2;
        y = baoc + t * bard;
        if (y > 0.0 && y < baba) {
            interior = true;
            intersection = vec4(t, (oc + t * rayDir - ba * y / baba) / radius);
            return true;
        }

        // TODO: handle inside caps???
    #endif

    return false;
}

void main() {
    #include clip_pixel

    vec3 rayDir = mix(normalize(vModelPosition - uCameraPosition), uCameraDir, uIsOrtho);

    vec4 intersection;
    bool interior;
    bool hit = CylinderImpostor(vModelPosition, rayDir, vStart, vEnd, vSize, intersection, interior);
    if (!hit) discard;

    vec3 vViewPosition = vModelPosition + intersection.x * rayDir;
    vViewPosition = (uView * vec4(vViewPosition, 1.0)).xyz;
    gl_FragDepthEXT = calcDepth(vViewPosition);

    // bugfix (mac only?)
    if (gl_FragDepthEXT < 0.0) discard;
    if (gl_FragDepthEXT > 1.0) discard;

    float fragmentDepth = gl_FragDepthEXT;
    #include assign_material_color

    #if defined(dRenderVariant_pick)
        #include check_picking_alpha
        gl_FragColor = material;
    #elif defined(dRenderVariant_depth)
        gl_FragColor = material;
    #elif defined(dRenderVariant_color)
        #ifdef dIgnoreLight
            gl_FragColor = material;
        #else
            mat3 normalMatrix = transpose3(inverse3(mat3(uView)));
            vec3 normal = normalize(normalMatrix * -normalize(intersection.yzw));
            #include apply_light_color
        #endif

        #include apply_interior_color
        #include apply_marker_color
        #include apply_fog
        #include wboit_write
    #endif
}
`,RUe=`
precision highp float;
precision highp int;

#include common
#include read_from_texture
#include common_vert_params
#include color_vert_params
#include size_vert_params
#include common_clip

uniform mat4 uModelView;

attribute vec3 aPosition;
attribute vec2 aMapping;
attribute float aDepth;
attribute vec2 aTexCoord;
attribute mat4 aTransform;
attribute float aInstance;
attribute float aGroup;

uniform float uOffsetX;
uniform float uOffsetY;
uniform float uOffsetZ;

// uniform bool ortho;
uniform float uPixelRatio;
uniform float uViewportHeight;

varying vec2 vTexCoord;

#include matrix_scale

void main(void){
    #include assign_group
    #include assign_color_varying
    #include assign_marker_varying
    #include assign_clipping_varying
    #include assign_size

    vTexCoord = aTexCoord;

    float scale = matrixScale(uModelView);

    float offsetX = uOffsetX * scale;
    float offsetY = uOffsetY * scale;
    float offsetZ = (uOffsetZ + aDepth * 0.95) * scale;

    vec4 position4 = vec4(aPosition, 1.0);
    vec4 mvPosition = uModelView * aTransform * position4;

    vModelPosition = (uModel * aTransform * position4).xyz; // for clipping in frag shader

    // TODO
    // #ifdef FIXED_SIZE
    //     if (ortho) {
    //         scale /= pixelRatio * ((uViewportHeight / 2.0) / -uCameraPosition.z) * 0.1;
    //     } else {
    //         scale /= pixelRatio * ((uViewportHeight / 2.0) / -mvPosition.z) * 0.1;
    //     }
    // #endif

    vec4 mvCorner = vec4(mvPosition.xyz, 1.0);

    if (vTexCoord.x == 10.0) { // indicates background plane
        // move a bit to the back, taking distance to camera into account to avoid z-fighting
        offsetZ -= 0.001 * distance(uCameraPosition, (uProjection * mvCorner).xyz);
    }

    mvCorner.xy += aMapping * size * scale;
    mvCorner.x += offsetX;
    mvCorner.y += offsetY;

    // TODO
    // if(ortho){
    //     mvCorner.xyz += normalize(-uCameraPosition) * offsetZ;
    // } else {
    //     mvCorner.xyz += normalize(-mvCorner.xyz) * offsetZ;
    // }
    mvCorner.xyz += normalize(-mvCorner.xyz) * offsetZ;

    gl_Position = uProjection * mvCorner;

    vViewPosition = -mvCorner.xyz;

    #include clip_instance
}
`,kUe=`
precision highp float;
precision highp int;

#include common
#include common_frag_params
#include color_frag_params
#include common_clip
#include wboit_params

uniform sampler2D tFont;

uniform vec3 uBorderColor;
uniform float uBorderWidth;
uniform vec3 uBackgroundColor;
uniform float uBackgroundOpacity;

varying vec2 vTexCoord;

const float smoothness = 32.0;
const float gamma = 2.2;

void main2(){
    gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0);
}

void main(){
    #include clip_pixel

    float fragmentDepth = gl_FragCoord.z;
    bool interior = false;
    #include assign_material_color

    if (vTexCoord.x > 1.0) {
        gl_FragColor = vec4(uBackgroundColor, uBackgroundOpacity * material.a);
    } else {
        // retrieve signed distance
        float sdf = texture2D(tFont, vTexCoord).a + uBorderWidth;

        // perform adaptive anti-aliasing of the edges
        float w = clamp(smoothness * (abs(dFdx(vTexCoord.x)) + abs(dFdy(vTexCoord.y))), 0.0, 0.5);
        float a = smoothstep(0.5 - w, 0.5 + w, sdf);

        // gamma correction for linear attenuation
        a = pow(a, 1.0 / gamma);

        if (a < 0.5) discard;
        material.a *= a;

        // add border
        float t = 0.5 + uBorderWidth;
        if (uBorderWidth > 0.0 && sdf < t) {
            material.xyz = mix(uBorderColor, material.xyz, smoothstep(t - w, t, sdf));
        }

        gl_FragColor = material;
    }

    #if defined(dRenderVariant_pick)
        #include check_picking_alpha
    #elif defined(dRenderVariant_depth)
        gl_FragColor = material;
    #elif defined(dRenderVariant_color)
        #include apply_marker_color
        #include apply_fog
        #include wboit_write
    #endif
}
`,OUe=`
precision highp float;
precision highp int;

#include common
#include read_from_texture
#include common_vert_params
#include color_vert_params
#include size_vert_params
#include common_clip

uniform float uPixelRatio;
uniform float uViewportHeight;

attribute mat4 aTransform;
attribute float aInstance;
attribute float aGroup;

attribute vec2 aMapping;
attribute vec3 aStart;
attribute vec3 aEnd;

void trimSegment(const in vec4 start, inout vec4 end) {
    // trim end segment so it terminates between the camera plane and the near plane
    // conservative estimate of the near plane
    float a = uProjection[2][2];  // 3rd entry in 3rd column
    float b = uProjection[3][2];  // 3rd entry in 4th column
    float nearEstimate = -0.5 * b / a;
    float alpha = (nearEstimate - start.z) / (end.z - start.z);
    end.xyz = mix(start.xyz, end.xyz, alpha);
}

void main(){
    #include assign_group
    #include assign_color_varying
    #include assign_marker_varying
    #include assign_clipping_varying
    #include assign_size

    mat4 modelView = uView * uModel * aTransform;

    // camera space
    vec4 start = modelView * vec4(aStart, 1.0);
    vec4 end = modelView * vec4(aEnd, 1.0);

    // assign position
    vec4 position4 = vec4((aMapping.y < 0.5) ? aStart : aEnd, 1.0);
    vec4 mvPosition = modelView * position4;
    vViewPosition = mvPosition.xyz;

    vModelPosition = (uModel * aTransform * position4).xyz; // for clipping in frag shader

    // special case for perspective projection, and segments that terminate either in, or behind, the camera plane
    // clearly the gpu firmware has a way of addressing this issue when projecting into ndc space
    // but we need to perform ndc-space calculations in the shader, so we must address this issue directly
    // perhaps there is a more elegant solution -- WestLangley
    bool perspective = (uProjection[2][3] == -1.0); // 4th entry in the 3rd column
    if (perspective) {
        if (start.z < 0.0 && end.z >= 0.0) {
            trimSegment(start, end);
        } else if (end.z < 0.0 && start.z >= 0.0) {
            trimSegment(end, start);
        }
    }

    // clip space
    vec4 clipStart = uProjection * start;
    vec4 clipEnd = uProjection * end;

    // ndc space
    vec2 ndcStart = clipStart.xy / clipStart.w;
    vec2 ndcEnd = clipEnd.xy / clipEnd.w;

    // direction
    vec2 dir = ndcEnd - ndcStart;

    // account for clip-space aspect ratio
    dir.x *= uPixelRatio;
    dir = normalize(dir);

    // perpendicular to dir
    vec2 offset = vec2(dir.y, - dir.x);

    // undo aspect ratio adjustment
    dir.x /= uPixelRatio;
    offset.x /= uPixelRatio;

    // sign flip
    if (aMapping.x < 0.0) offset *= -1.0;

    // calculate linewidth
    float linewidth;
    #ifdef dLineSizeAttenuation
        linewidth = size * uPixelRatio * ((uViewportHeight / 2.0) / -start.z) * 5.0;
    #else
        linewidth = size * uPixelRatio;
    #endif

    // adjust for linewidth
    offset *= linewidth;

    // adjust for clip-space to screen-space conversion
    offset /= uViewportHeight;

    // select end
    vec4 clip = (aMapping.y < 0.5) ? clipStart : clipEnd;

    // back to clip space
    offset *= clip.w;
    clip.xy += offset;
    gl_Position = clip;

    #include clip_instance
}
`,LUe=`
precision highp float;
precision highp int;

#include common
#include common_frag_params
#include color_frag_params
#include common_clip
#include wboit_params

void main(){
    #include clip_pixel

    bool interior = false;
    float fragmentDepth = gl_FragCoord.z;
    #include assign_material_color

    #if defined(dRenderVariant_pick)
        #include check_picking_alpha
        gl_FragColor = material;
    #elif defined(dRenderVariant_depth)
        gl_FragColor = material;
    #elif defined(dRenderVariant_color)
        gl_FragColor = material;

        #include apply_marker_color
        #include apply_fog
        #include wboit_write
    #endif
}
`,FUe=`
precision highp float;
precision highp int;
precision highp sampler2D;

#include common
#include read_from_texture
#include common_vert_params
#include color_vert_params
#include common_clip

#if defined(dColorType_grid)
    #include texture3d_from_2d_linear
#endif

#ifdef dGeoTexture
    uniform vec2 uGeoTexDim;
    uniform sampler2D tPosition;
    uniform sampler2D tGroup;
    uniform sampler2D tNormal;
#else
    attribute vec3 aPosition;
    attribute float aGroup;
    attribute vec3 aNormal;
#endif
attribute mat4 aTransform;
attribute float aInstance;

varying vec3 vNormal;

void main(){
    #include assign_group
    #include assign_marker_varying
    #include assign_clipping_varying
    #include assign_position
    #include assign_color_varying
    #include clip_instance

    #ifdef dGeoTexture
        vec3 normal = readFromTexture(tNormal, VertexID, uGeoTexDim).xyz;
    #else
        vec3 normal = aNormal;
    #endif
    mat3 normalMatrix = transpose3(inverse3(mat3(modelView)));
    vec3 transformedNormal = normalize(normalMatrix * normalize(normal));
    #if defined(dFlipSided) && !defined(dDoubleSided) // TODO checking dDoubleSided should not be required, ASR
        transformedNormal = -transformedNormal;
    #endif
    vNormal = transformedNormal;
}
`,NUe=`
precision highp float;
precision highp int;

#include common
#include common_frag_params
#include color_frag_params
#include light_frag_params
#include normal_frag_params
#include common_clip
#include wboit_params

void main() {
    #include clip_pixel

    // Workaround for buggy gl_FrontFacing (e.g. on some integrated Intel GPUs)
    #if defined(enabledStandardDerivatives)
        vec3 fdx = dFdx(vViewPosition);
        vec3 fdy = dFdy(vViewPosition);
        vec3 faceNormal = normalize(cross(fdx,fdy));
        bool frontFacing = dot(vNormal, faceNormal) > 0.0;
    #else
        bool frontFacing = dot(vNormal, vViewPosition) < 0.0;
    #endif

    #if defined(dFlipSided)
        interior = frontFacing;
    #else
        interior = !frontFacing;
    #endif

    float fragmentDepth = gl_FragCoord.z;
    #include assign_material_color

    #if defined(dRenderVariant_pick)
        #include check_picking_alpha
        gl_FragColor = material;
    #elif defined(dRenderVariant_depth)
        gl_FragColor = material;
    #elif defined(dRenderVariant_color)
        #ifdef dIgnoreLight
            gl_FragColor = material;
        #else
            #if defined(dFlatShaded) && defined(enabledStandardDerivatives)
                vec3 normal = -faceNormal;
            #else
                vec3 normal = -normalize(vNormal);
                #ifdef dDoubleSided
                    normal = normal * (float(frontFacing) * 2.0 - 1.0);
                #endif
            #endif
            #include apply_light_color
        #endif

        #include apply_interior_color
        #include apply_marker_color
        #include apply_fog
        #include wboit_write
    #endif
}
`,BUe=`
precision highp float;

attribute vec3 aPosition;
attribute mat4 aTransform;
attribute float aInstance;

uniform mat4 uModelView;
uniform mat4 uProjection;
uniform vec4 uInvariantBoundingSphere;

varying vec3 vOrigPos;
varying float vInstance;
varying vec4 vBoundingSphere;
varying mat4 vTransform;

uniform vec3 uBboxSize;
uniform vec3 uBboxMin;
uniform vec3 uBboxMax;
uniform vec3 uGridDim;
uniform mat4 uTransform;

uniform mat4 uUnitToCartn;

void main() {
    vec4 unitCoord = vec4(aPosition + vec3(0.5), 1.0);
    vec4 mvPosition = uModelView * aTransform * uUnitToCartn * unitCoord;

    vOrigPos = (aTransform * uUnitToCartn * unitCoord).xyz;
    vInstance = aInstance;
    vBoundingSphere = vec4(
        (aTransform * vec4(uInvariantBoundingSphere.xyz, 1.0)).xyz,
        uInvariantBoundingSphere.w
    );
    vTransform = aTransform;

    gl_Position = uProjection * mvPosition;

    // move z position to near clip plane (but not too close to get precision issues)
    gl_Position.z = gl_Position.w - 0.01;
}
`,UUe=`
precision highp float;
precision highp int;

#include common
#include light_frag_params

#if dClipObjectCount != 0
    uniform int uClipObjectType[dClipObjectCount];
    uniform bool uClipObjectInvert[dClipObjectCount];
    uniform vec3 uClipObjectPosition[dClipObjectCount];
    uniform vec4 uClipObjectRotation[dClipObjectCount];
    uniform vec3 uClipObjectScale[dClipObjectCount];
#endif
#include common_clip

#include read_from_texture
#include texture3d_from_1d_trilinear
#include texture3d_from_2d_nearest
#include texture3d_from_2d_linear

uniform mat4 uProjection, uTransform, uModelView, uModel, uView;
uniform vec3 uCameraDir;

uniform sampler2D tDepth;
uniform vec2 uDrawingBufferSize;

varying vec3 vOrigPos;
varying float vInstance;
varying vec4 vBoundingSphere;
varying mat4 vTransform;

uniform mat4 uInvView;
uniform vec2 uIsoValue;
uniform vec3 uGridDim;
uniform vec3 uBboxSize;
uniform sampler2D tTransferTex;
uniform float uTransferScale;
uniform float uStepScale;
uniform float uJumpLength;

uniform int uObjectId;
uniform int uVertexCount;
uniform int uInstanceCount;
uniform int uGroupCount;

uniform vec3 uHighlightColor;
uniform vec3 uSelectColor;
uniform vec2 uMarkerTexDim;
uniform sampler2D tMarker;

uniform float uFogNear;
uniform float uFogFar;
uniform vec3 uFogColor;

uniform float uAlpha;
uniform float uPickingAlphaThreshold;
uniform bool uTransparentBackground;

uniform float uInteriorDarkening;
uniform bool uInteriorColorFlag;
uniform vec3 uInteriorColor;
bool interior;

uniform float uNear;
uniform float uFar;
uniform float uIsOrtho;

uniform vec3 uCellDim;
uniform vec3 uCameraPosition;
uniform mat4 uCartnToUnit;

#if __VERSION__ != 100
    // for webgl1 this is given as a 'define'
    uniform int uMaxSteps;
#endif

#if defined(dGridTexType_2d)
    precision highp sampler2D;
    uniform sampler2D tGridTex;
    uniform vec3 uGridTexDim;
#elif defined(dGridTexType_3d)
    precision highp sampler3D;
    uniform sampler3D tGridTex;
#endif

#if defined(dRenderVariant_color)
    #if defined(dColorType_uniform)
        uniform vec3 uColor;
    #elif defined(dColorType_texture)
        uniform vec2 uColorTexDim;
        uniform sampler2D tColor;
    #endif

    #ifdef dOverpaint
        varying vec4 vOverpaint;
        uniform vec2 uOverpaintTexDim;
        uniform sampler2D tOverpaint;
    #endif
#endif

#if defined(dGridTexType_2d)
    vec4 textureVal(vec3 pos) {
        return texture3dFrom2dLinear(tGridTex, pos + (vec3(0.5, 0.5, 0.0) / uGridDim), uGridDim, uGridTexDim.xy);
    }
    vec4 textureGroup(vec3 pos) {
        return texture3dFrom2dNearest(tGridTex, pos + (vec3(0.5, 0.5, 0.0) / uGridDim), uGridDim, uGridTexDim.xy);
    }
#elif defined(dGridTexType_3d)
    vec4 textureVal(vec3 pos) {
        return texture(tGridTex, pos + (vec3(0.5) / uGridDim));
    }
    vec4 textureGroup(vec3 pos) {
        return texelFetch(tGridTex, ivec3(pos * uGridDim), 0);
    }
#endif

#include wboit_params

vec4 transferFunction(float value) {
    return texture2D(tTransferTex, vec2(value, 0.0));
}

float getDepth(const in vec2 coords) {
    #ifdef depthTextureSupport
        if (!uRenderWboit) {
            // in case of opaque volumes (and depth texture support)
            return texture2D(tDepth, coords).r;
        } else {
            return unpackRGBAToDepth(texture2D(tDepth, coords));
        }
    #else
        return unpackRGBAToDepth(texture2D(tDepth, coords));
    #endif
}

const float gradOffset = 0.5;

vec3 v3m4(vec3 p, mat4 m) {
    return (m * vec4(p, 1.0)).xyz;
}

float preFogAlphaBlended = 0.0;

vec4 raymarch(vec3 startLoc, vec3 step, vec3 rayDir) {
    #if defined(dRenderVariant_color) && !defined(dIgnoreLight)
        mat3 normalMatrix = transpose3(inverse3(mat3(uModelView * vTransform)));
    #endif
    mat4 cartnToUnit = uCartnToUnit * inverse4(vTransform);
    #if defined(dClipVariant_pixel) && dClipObjectCount != 0
        mat4 modelTransform = uModel * vTransform * uTransform;
    #endif
    mat4 modelViewTransform = uModelView * vTransform * uTransform;

    vec3 scaleVol = vec3(1.0) / uGridDim;
    vec3 pos = startLoc;
    vec4 cell;
    float prevValue = -1.0;
    float value = 0.0;
    vec4 src = vec4(0.0);
    vec4 dst = vec4(0.0);
    bool hit = false;
    float fragmentDepth;

    vec3 posMin = vec3(0.0);
    vec3 posMax = vec3(1.0) - vec3(1.0) / uGridDim;

    vec3 unitPos;
    vec3 isoPos;

    vec3 nextPos;
    float nextValue;

    vec3 color = vec3(0.45, 0.55, 0.8);
    vec3 gradient = vec3(1.0);
    vec3 dx = vec3(gradOffset * scaleVol.x, 0.0, 0.0);
    vec3 dy = vec3(0.0, gradOffset * scaleVol.y, 0.0);
    vec3 dz = vec3(0.0, 0.0, gradOffset * scaleVol.z);

    float maxDist = min(vBoundingSphere.w * 2.0, uFar - uNear);
    float maxDistSq = maxDist * maxDist;

    for (int i = 0; i < uMaxSteps; ++i) {
        // break when beyond bounding-sphere or far-plane
        vec3 distVec = startLoc - pos;
        if (dot(distVec, distVec) > maxDistSq) break;

        unitPos = v3m4(pos, cartnToUnit);

        // continue when outside of grid
        if (unitPos.x > posMax.x || unitPos.y > posMax.y || unitPos.z > posMax.z ||
            unitPos.x < posMin.x || unitPos.y < posMin.y || unitPos.z < posMin.z
        ) {
            if (hit) break;
            prevValue = value;
            pos += step;
            continue;
        }

        cell = textureVal(unitPos);
        value = cell.a; // current voxel value

        if (uJumpLength > 0.0 && value < 0.01) {
            nextPos = pos + rayDir * uJumpLength;
            nextValue = textureVal(v3m4(nextPos, cartnToUnit)).a;
            if (nextValue < 0.01) {
                prevValue = nextValue;
                pos = nextPos;
                continue;
            }
        }

        #if defined(dRenderMode_isosurface)
            if (prevValue > 0.0 && ( // there was a prev Value
                (prevValue < uIsoValue.x && value > uIsoValue.x) || // entering isosurface
                (prevValue > uIsoValue.x && value < uIsoValue.x) // leaving isosurface
            )) {
                isoPos = v3m4(mix(pos - step, pos, ((prevValue - uIsoValue.x) / ((prevValue - uIsoValue.x) - (value - uIsoValue.x)))), cartnToUnit);

                vec4 mvPosition = modelViewTransform * vec4(isoPos * uGridDim, 1.0);

                #if defined(dClipVariant_pixel) && dClipObjectCount != 0
                    vec3 vModelPosition = v3m4(isoPos * uGridDim, modelTransform);
                    if (clipTest(vec4(vModelPosition, 0.0), 0)) {
                        prevValue = value;
                        pos += step;
                        continue;
                    }
                #endif

                float depth = calcDepth(mvPosition.xyz);
                if (depth > getDepth(gl_FragCoord.xy / uDrawingBufferSize))
                    break;

                #ifdef enabledFragDepth
                    if (!hit) {
                        gl_FragDepthEXT = depth;
                    }
                #endif

                #if defined(dRenderVariant_pickObject)
                    return vec4(encodeFloatRGB(float(uObjectId)), 1.0);
                #elif defined(dRenderVariant_pickInstance)
                    return vec4(encodeFloatRGB(vInstance), 1.0);
                #elif defined(dRenderVariant_pickGroup)
                    #ifdef dPackedGroup
                        return vec4(textureGroup(floor(isoPos * uGridDim + 0.5) / uGridDim).rgb, 1.0);
                    #else
                        vec3 g = floor(isoPos * uGridDim + 0.5);
                        return vec4(encodeFloatRGB(g.z + g.y * uGridDim.z + g.x * uGridDim.z * uGridDim.y), 1.0);
                    #endif
                #elif defined(dRenderVariant_depth)
                    #ifdef enabledFragDepth
                        return packDepthToRGBA(gl_FragDepthEXT);
                    #else
                        return packDepthToRGBA(depth);
                    #endif
                #elif defined(dRenderVariant_color)
                    #ifdef dPackedGroup
                        float group = decodeFloatRGB(textureGroup(floor(isoPos * uGridDim + 0.5) / uGridDim).rgb);
                    #else
                        vec3 g = floor(isoPos * uGridDim + 0.5);
                        float group = g.z + g.y * uGridDim.z + g.x * uGridDim.z * uGridDim.y;
                    #endif

                    #if defined(dColorType_uniform)
                        color = uColor;
                    #elif defined(dColorType_instance)
                        color = readFromTexture(tColor, vInstance, uColorTexDim).rgb;
                    #elif defined(dColorType_group)
                        color = readFromTexture(tColor, group, uColorTexDim).rgb;
                    #elif defined(dColorType_groupInstance)
                        color = readFromTexture(tColor, vInstance * float(uGroupCount) + group, uColorTexDim).rgb;
                    #elif defined(dColorType_vertex)
                        color = texture3dFrom1dTrilinear(tColor, isoPos, uGridDim, uColorTexDim, 0.0).rgb;
                    #elif defined(dColorType_vertexInstance)
                        color = texture3dFrom1dTrilinear(tColor, isoPos, uGridDim, uColorTexDim, vInstance * float(uVertexCount)).rgb;
                    #endif

                    // handle flipping and negative isosurfaces
                    #ifdef dFlipSided
                        bool flipped = value < uIsoValue.y; // flipped
                    #else
                        bool flipped = value > uIsoValue.y;
                    #endif
                    interior = value < uIsoValue.x && flipped;
                    #ifndef dDoubleSided
                        if (interior) {
                            prevValue = value;
                            pos += step;
                            continue;
                        }
                    #endif
                    vec3 vViewPosition = mvPosition.xyz;
                    vec4 material = vec4(color, uAlpha);

                    #ifdef dIgnoreLight
                        gl_FragColor = material;
                    #else
                        #if defined(dFlatShaded)
                            // nearest grid point
                            isoPos = floor(isoPos * uGridDim + 0.5) / uGridDim;
                        #endif
                        #ifdef dPackedGroup
                            // compute gradient by central differences
                            gradient.x = textureVal(isoPos - dx).a - textureVal(isoPos + dx).a;
                            gradient.y = textureVal(isoPos - dy).a - textureVal(isoPos + dy).a;
                            gradient.z = textureVal(isoPos - dz).a - textureVal(isoPos + dz).a;
                        #else
                            gradient = textureVal(isoPos).xyz * 2.0 - 1.0;
                        #endif
                        vec3 normal = -normalize(normalMatrix * normalize(gradient));
                        normal = normal * (float(flipped) * 2.0 - 1.0);
                        normal = normal * -(float(interior) * 2.0 - 1.0);
                        #include apply_light_color
                    #endif

                    float vMarker = readFromTexture(tMarker, vInstance * float(uGroupCount) + group, uMarkerTexDim).a;
                    #include apply_interior_color
                    #include apply_marker_color

                    preFogAlphaBlended = (1.0 - preFogAlphaBlended) * gl_FragColor.a + preFogAlphaBlended;
                    fragmentDepth = depth;
                    #include apply_fog

                    src = gl_FragColor;

                    if (!uTransparentBackground) {
                        // done in 'apply_fog' otherwise
                        src.rgb *= src.a;
                    }
                    dst = (1.0 - dst.a) * src + dst; // standard blending
                #endif

                #ifdef dSingleLayer
                    break;
                #endif

                hit = true;
            }
            prevValue = value;
        #elif defined(dRenderMode_volume)
            vec4 mvPosition = modelViewTransform * vec4(unitPos * uGridDim, 1.0);
            if (calcDepth(mvPosition.xyz) > getDepth(gl_FragCoord.xy / uDrawingBufferSize))
                break;

            #if defined(dClipVariant_pixel) && dClipObjectCount != 0
                vec3 vModelPosition = v3m4(unitPos * uGridDim, modelTransform);
                if (clipTest(vec4(vModelPosition, 0.0), 0)) {
                    prevValue = value;
                    pos += step;
                    continue;
                }
            #endif

            #if defined(dRenderVariant_color)
                vec3 vViewPosition = mvPosition.xyz;
                vec4 material = transferFunction(value);

                #ifdef dIgnoreLight
                    gl_FragColor.rgb = material.rgb;
                #else
                    if (material.a >= 0.01) {
                        #ifdef dPackedGroup
                            // compute gradient by central differences
                            gradient.x = textureVal(unitPos - dx).a - textureVal(unitPos + dx).a;
                            gradient.y = textureVal(unitPos - dy).a - textureVal(unitPos + dy).a;
                            gradient.z = textureVal(unitPos - dz).a - textureVal(unitPos + dz).a;
                        #else
                            gradient = cell.xyz * 2.0 - 1.0;
                        #endif
                        vec3 normal = -normalize(normalMatrix * normalize(gradient));
                        #include apply_light_color
                    } else {
                        gl_FragColor.rgb = material.rgb;
                    }
                #endif

                gl_FragColor.a = material.a * uAlpha * uTransferScale;

                #ifdef dPackedGroup
                    float group = decodeFloatRGB(textureGroup(floor(unitPos * uGridDim + 0.5) / uGridDim).rgb);
                #else
                    vec3 g = floor(unitPos * uGridDim + 0.5);
                    float group = g.z + g.y * uGridDim.z + g.x * uGridDim.z * uGridDim.y;
                #endif

                float vMarker = readFromTexture(tMarker, vInstance * float(uGroupCount) + group, uMarkerTexDim).a;
                #include apply_marker_color

                preFogAlphaBlended = (1.0 - preFogAlphaBlended) * gl_FragColor.a + preFogAlphaBlended;
                fragmentDepth = calcDepth(mvPosition.xyz);
                #include apply_fog

                src = gl_FragColor;

                if (!uTransparentBackground) {
                    // done in 'apply_fog' otherwise
                    src.rgb *= src.a;
                }
                dst = (1.0 - dst.a) * src + dst; // standard blending
            #endif
        #endif

        // break if the color is opaque enough
        if (dst.a > 0.95)
            break;

        pos += step;
    }

    #if defined(dRenderMode_isosurface) && defined(enabledFragDepth)
        // ensure depth is written everywhere
        if (!hit)
            gl_FragDepthEXT = 1.0;
    #endif

    return dst;
}

// TODO: support float texture for higher precision values???
// TODO: support clipping exclusion texture support

void main() {
    if (gl_FrontFacing)
        discard;

    #if defined(dRenderVariant_pick) || defined(dRenderVariant_depth)
        #if defined(dRenderMode_volume)
            // always ignore pick & depth for volume
            discard;
        #elif defined(dRenderMode_isosurface)
            if (uAlpha < uPickingAlphaThreshold)
                discard; // ignore so the element below can be picked
        #endif
    #endif

    vec3 rayDir = mix(normalize(vOrigPos - uCameraPosition), uCameraDir, uIsOrtho);
    vec3 step = rayDir * uStepScale;

    float boundingSphereNear = distance(vBoundingSphere.xyz, uCameraPosition) - vBoundingSphere.w;
    float d = max(uNear, boundingSphereNear) - mix(0.0, distance(vOrigPos, uCameraPosition), uIsOrtho);
    vec3 start = mix(uCameraPosition, vOrigPos, uIsOrtho) + (d * rayDir);
    gl_FragColor = raymarch(start, step, rayDir);

    #if defined(dRenderVariant_pick) || defined(dRenderVariant_depth)
        // discard when nothing was hit
        if (gl_FragColor == vec4(0.0))
            discard;
    #endif

    #if defined(dRenderVariant_color)
        #if defined(dRenderMode_isosurface) && defined(enabledFragDepth)
            float fragmentDepth = gl_FragDepthEXT;
        #else
            float fragmentDepth = calcDepth((uModelView * vec4(start, 1.0)).xyz);
        #endif
        float preFogAlpha = clamp(preFogAlphaBlended, 0.0, 1.0);
        interior = false;
        #include wboit_write
    #endif
}
`,jUe=`
precision highp float;
precision highp int;

#include common
#include common_vert_params

attribute vec3 aPosition;
attribute vec2 aUv;
attribute mat4 aTransform;
attribute float aInstance;

varying vec2 vUv;
varying float vInstance;

void main() {
    #include assign_position

    vUv = aUv;
    vInstance = aInstance;
}
`,zUe=`
precision highp float;
precision highp int;

#include common
#include read_from_texture
#include common_frag_params
#include common_clip
#include wboit_params

uniform vec2 uImageTexDim;
uniform sampler2D tImageTex;
uniform sampler2D tGroupTex;

uniform vec2 uMarkerTexDim;
uniform sampler2D tMarker;

varying vec2 vUv;
varying float vInstance;

#if defined(dInterpolation_catmulrom) || defined(dInterpolation_mitchell) || defined(dInterpolation_bspline)
    #define dInterpolation_cubic
#endif

#if defined(dInterpolation_cubic)
    #if defined(dInterpolation_catmulrom) || defined(dInterpolation_mitchell)
        #if defined(dInterpolation_catmulrom)
            const float B = 0.0;
            const float C = 0.5;
        #elif defined(dInterpolation_mitchell)
            const float B = 0.333;
            const float C = 0.333;
        #endif

        float cubicFilter(float x){
            float f = x;
            if (f < 0.0) {
                f = -f;
            }
            if (f < 1.0) {
                return ((12.0 - 9.0 * B - 6.0 * C) * (f * f * f) +
                    (-18.0 + 12.0 * B + 6.0 * C) * (f * f) +
                    (6.0 - 2.0 * B)) / 6.0;
            }else if (f >= 1.0 && f < 2.0){
                return ((-B - 6.0 * C) * ( f * f * f)
                    + (6.0 * B + 30.0 * C) * (f * f) +
                    (-(12.0 * B) - 48.0 * C) * f +
                    8.0 * B + 24.0 * C) / 6.0;
            }else{
                return 0.0;
            }
        }
    #elif defined(dInterpolation_bspline)
        float cubicFilter(float x) {
            float f = x;
            if (f < 0.0) {
                f = -f;
            }
            if (f >= 0.0 && f <= 1.0){
                return (2.0 / 3.0) + (0.5) * (f * f * f) - (f * f);
            } else if (f > 1.0 && f <= 2.0) {
                return 1.0 / 6.0 * pow((2.0 - f), 3.0);
            }
            return 1.0;
        }
    #endif

    vec4 biCubic(sampler2D tex, vec2 texCoord) {
        vec2 texelSize = 1.0 / uImageTexDim;
        texCoord -= texelSize / 2.0;
        vec4 nSum = vec4(0.0);
        float nDenom = 0.0;
        vec2 cell = fract(texCoord * uImageTexDim);
        for (float m = -1.0; m <= 2.0; ++m) {
            for (float n = -1.0; n <= 2.0; ++n) {
                vec4 vecData = texture2D(tex, texCoord + texelSize * vec2(m, n));
                float c = cubicFilter(m - cell.x) * cubicFilter(-n + cell.y);
                nSum += vecData * c;
                nDenom += c;
            }
        }
        return nSum / nDenom;
    }
#endif

void main() {
    #include clip_pixel

    #if defined(dInterpolation_cubic)
        vec4 imageData = biCubic(tImageTex, vUv);
    #else
        vec4 imageData = texture2D(tImageTex, vUv);
    #endif
    imageData.a = clamp(imageData.a, 0.0, 1.0);
    if (imageData.a > 0.9) imageData.a = 1.0;

    float fragmentDepth = gl_FragCoord.z;
    bool interior = false;

    #if defined(dRenderVariant_pick)
        if (imageData.a < 0.3)
            discard;

        #if defined(dRenderVariant_pickObject)
            gl_FragColor = vec4(encodeFloatRGB(float(uObjectId)), 1.0);
        #elif defined(dRenderVariant_pickInstance)
            gl_FragColor = vec4(encodeFloatRGB(vInstance), 1.0);
        #elif defined(dRenderVariant_pickGroup)
            gl_FragColor = vec4(texture2D(tGroupTex, vUv).rgb, 1.0);
        #endif
    #elif defined(dRenderVariant_depth)
        if (imageData.a < 0.05)
            discard;

        gl_FragColor = packDepthToRGBA(gl_FragCoord.z);
    #elif defined(dRenderVariant_color)
        if (imageData.a < 0.05)
            discard;

        gl_FragColor = imageData;
        gl_FragColor.a *= uAlpha;

        float group = decodeFloatRGB(texture2D(tGroupTex, vUv).rgb);
        float vMarker = readFromTexture(tMarker, vInstance * float(uGroupCount) + group, uMarkerTexDim).a;

        #include apply_marker_color
        #include apply_fog
        #include wboit_write
    #endif
}
`,Tee=$a(),VUe={apply_fog:X9e,apply_interior_color:Y9e,apply_light_color:K9e,apply_marker_color:Q9e,assign_clipping_varying:Z9e,assign_color_varying:J9e,assign_group:eUe,assign_marker_varying:tUe,assign_material_color:rUe,assign_position:nUe,assign_size:iUe,check_picking_alpha:aUe,clip_instance:oUe,clip_pixel:sUe,color_frag_params:uUe,color_vert_params:lUe,common_clip:cUe,common_frag_params:dUe,common_vert_params:fUe,common:pUe,float_to_rgba:hUe,light_frag_params:vUe,matrix_scale:mUe,normal_frag_params:gUe,read_from_texture:yUe,rgba_to_float:bUe,size_vert_params:xUe,texture3d_from_1d_trilinear:SUe,texture3d_from_2d_linear:CUe,texture3d_from_2d_nearest:_Ue,wboit_params:wUe,wboit_write:EUe},HUe=/^(?!\/\/)\s*#include\s+(\S+)/gmi,GUe=/[ \t]*\/\/.*\n/g,qUe=/[ \t]*\/\*[\s\S]*?\*\//g,$Ue=/\n{2,}/g;function Wj(e){return e.replace(HUe,function(t,r){var n=VUe[r];if(!n)throw new Error("empty chunk, '"+r+"'");return n}).trim().replace(GUe,`
`).replace(qUe,`
`).replace($Ue,`
`)}function Ln(e,t,r,n,i){return n===void 0&&(n={}),i===void 0&&(i={}),{id:Tee(),name:e,vert:Wj(t),frag:Wj(r),extensions:n,outTypes:i}}var WUe=Ln("points",AUe,PUe,{drawBuffers:"optional"}),XUe=Ln("spheres",TUe,IUe,{fragDepth:"required",drawBuffers:"optional"}),YUe=Ln("cylinders",MUe,DUe,{fragDepth:"required",drawBuffers:"optional"}),KUe=Ln("text",RUe,kUe,{standardDerivatives:"required",drawBuffers:"optional"}),QUe=Ln("lines",OUe,LUe,{drawBuffers:"optional"}),Iee=Ln("mesh",FUe,NUe,{standardDerivatives:"optional",drawBuffers:"optional"}),ZUe=Ln("direct-volume",BUe,UUe,{fragDepth:"optional",drawBuffers:"optional"}),JUe=Ln("image",jUe,zUe,{drawBuffers:"optional"});function eje(e){if(e===void 0)return"";var t=[];for(var r in e){var n=e[r],i=n.ref.value;if(i!==void 0)if(typeof i=="string")t.push("#define "+r+"_"+i);else if(typeof i=="number")t.push("#define "+r+" "+i);else if(typeof i=="boolean")i&&t.push("#define "+r);else throw new Error("unknown define type")}return t.join(`
`)+`
`}function tje(e,t){var r=[];if(t.standardDerivatives&&(r.push("#extension GL_OES_standard_derivatives : enable"),r.push("#define enabledStandardDerivatives")),t.fragDepth){if(e.fragDepth)r.push("#extension GL_EXT_frag_depth : enable"),r.push("#define enabledFragDepth");else if(t.fragDepth==="required")throw new Error("required 'GL_EXT_frag_depth' extension not available")}if(t.drawBuffers){if(e.drawBuffers)r.push("#extension GL_EXT_draw_buffers : require"),r.push("#define requiredDrawBuffers"),r.push("#define gl_FragColor gl_FragData[0]");else if(t.drawBuffers==="required")throw new Error("required 'GL_EXT_draw_buffers' extension not available")}if(t.shaderTextureLod){if(e.shaderTextureLod)r.push("#extension GL_EXT_shader_texture_lod : enable"),r.push("#define enabledShaderTextureLod");else if(t.shaderTextureLod==="required")throw new Error("required 'GL_EXT_shader_texture_lod' extension not available")}return e.depthTexture&&r.push("#define depthTextureSupport"),r.join(`
`)+`
`}var rje=`#version 300 es
#define attribute in
#define varying out
#define texture2D texture
`,nje=`
#define varying in
#define texture2D texture
#define texture2DLodEXT textureLod

#define gl_FragColor out_FragData0
#define gl_FragDepthEXT gl_FragDepth

#define depthTextureSupport
`;function ije(e,t,r,n){var i=["#version 300 es","layout(location = 0) out highp "+(n[0]||"vec4")+" out_FragData0;"];if(r.standardDerivatives&&i.push("#define enabledStandardDerivatives"),r.fragDepth&&i.push("#define enabledFragDepth"),r.drawBuffers){i.push("#define requiredDrawBuffers");for(var a=e.getParameter(e.MAX_DRAW_BUFFERS),o=1,s=a;o<s;++o)i.push("layout(location = "+o+") out highp "+(n[o]||"vec4")+" out_FragData"+o+";")}return r.shaderTextureLod&&i.push("#define enabledShaderTextureLod"),i.push(nje),i.join(`
`)+`
`}function aje(e){return e.replace(/gl_FragData\[([0-9]+)\]/g,"out_FragData$1")}function oje(e,t,r,n){var i=eje(r),a=Pr(e)?rje:"",o=Pr(e)?ije(e,t,n.extensions,n.outTypes):tje(t,n.extensions),s=Pr(e)?aje(n.frag):n.frag;return{id:Tee(),name:n.name,vert:""+a+i+n.vert,frag:""+o+i+s,extensions:n.extensions,outTypes:n.outTypes}}function sje(e,t){switch(t){case"b":case"b[]":return e.BOOL;case"f":case"f[]":return e.FLOAT;case"i":case"i[]":return e.INT;case"v2":case"v2[]":return e.FLOAT_VEC2;case"v3":case"v3[]":return e.FLOAT_VEC3;case"v4":case"v4[]":return e.FLOAT_VEC4;case"m3":case"m3[]":return e.FLOAT_MAT3;case"m4":case"m4[]":return e.FLOAT_MAT4;default:console.error("unknown uniform kind '"+t+"'")}}function uje(e,t,r){e.uniform1f(t,r)}function lje(e,t,r){e.uniform1fv(t,r)}function cje(e,t,r){e.uniform1i(t,r)}function dje(e,t,r){e.uniform1iv(t,r)}function fje(e,t,r){e.uniform2fv(t,r)}function pje(e,t,r){e.uniform3fv(t,r)}function hje(e,t,r){e.uniform4fv(t,r)}function vje(e,t,r){e.uniformMatrix3fv(t,!1,r)}function mje(e,t,r){e.uniformMatrix4fv(t,!1,r)}function Xj(e){switch(e){case"f":return uje;case"f[]":return lje;case"i":case"t":case"b":return cje;case"i[]":case"t[]":case"b[]":return dje;case"v2":case"v2[]":return fje;case"v3":case"v3[]":return pje;case"v4":case"v4[]":return hje;case"m3":case"m3[]":return vje;case"m4":case"m4[]":return mje}}function gje(e){var t={};return Object.keys(e).forEach(function(r){var n=e[r];n.type==="uniform"?t[r]=Xj(n.kind):n.type==="texture"&&(t[r]=Xj("t"))}),t}function yje(e){var t={};return Object.keys(e).forEach(function(r){t[r]=F.create(cp(e[r].ref.value))}),t}var bje=$a();function xje(e,t){switch(t){case"static":return e.STATIC_DRAW;case"dynamic":return e.DYNAMIC_DRAW;case"stream":return e.STREAM_DRAW}}function Sje(e,t){if(t instanceof Uint8Array)return e.UNSIGNED_BYTE;if(t instanceof Int8Array)return e.BYTE;if(t instanceof Uint16Array)return e.UNSIGNED_SHORT;if(t instanceof Int16Array)return e.SHORT;if(t instanceof Uint32Array)return e.UNSIGNED_INT;if(t instanceof Int32Array)return e.INT;if(t instanceof Float32Array)return e.FLOAT;throw new Error("Should nevver happen")}function Cje(e,t){switch(t){case"attribute":return e.ARRAY_BUFFER;case"elements":return e.ELEMENT_ARRAY_BUFFER;case"uniform":return e.UNIFORM_BUFFER}}function Yj(e){var t=e.createBuffer();if(t===null)throw new Error("Could not create WebGL buffer");return t}function Mee(e,t,r,n){var i=Yj(e),a=xje(e,r),o=Cje(e,n),s=Sje(e,t),u=t.BYTES_PER_ELEMENT,l=t.length;function c(f){e.bindBuffer(o,i),e.bufferData(o,f,a)}c(t);var d=!1;return{id:bje(),_usageHint:a,_bufferType:o,_dataType:s,_bpe:u,length:l,getBuffer:function(){return i},updateData:c,updateSubData:function(f,p,v){e.bindBuffer(o,i),v-p===f.length?e.bufferSubData(o,0,f):e.bufferSubData(o,p*u,f.subarray(p,p+v))},reset:function(){i=Yj(e),c(t)},destroy:function(){d||(e.deleteBuffer(i),d=!0)}}}function _je(e,t,r){switch(t){case"int32":switch(r){case 1:return e.INT;case 2:return e.INT_VEC2;case 3:return e.INT_VEC3;case 4:return e.INT_VEC4}break;case"float32":switch(r){case 1:return e.FLOAT;case 2:return e.FLOAT_VEC2;case 3:return e.FLOAT_VEC3;case 4:return e.FLOAT_VEC4;case 16:return e.FLOAT_MAT4}break}throw new Error("unknown attribute type for kind '"+t+"' and itemSize '"+r+"'")}function wje(e,t,r,n,i,a){a===void 0&&(a="dynamic");var o=t.instancedArrays,s=Mee(e,r,a,"attribute"),u=s._bufferType,l=s._dataType,c=s._bpe;return E(E({},s),{bind:function(d){if(e.bindBuffer(u,s.getBuffer()),n===16)for(var f=0;f<4;++f)e.enableVertexAttribArray(d+f),e.vertexAttribPointer(d+f,4,l,!1,4*4*c,f*4*c),o.vertexAttribDivisor(d+f,i);else e.enableVertexAttribArray(d),e.vertexAttribPointer(d,n,l,!1,0,0),o.vertexAttribDivisor(d,i)}})}function Eje(e,t,r){var n=[];return Object.keys(t).forEach(function(i){var a=t[i];a.type==="attribute"&&(n[n.length]=[i,e.resources.attribute(r[i].ref.value,a.itemSize,a.divisor)])}),n}function Aje(e,t,r){r===void 0&&(r="static");var n=Mee(e,t,r,"elements");return E(E({},n),{bind:function(){e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,n.getBuffer())}})}var Pje=$a();function Tje(e,t,r){var n={};return Object.keys(r).forEach(function(i){var a=r[i];if(a.type==="attribute"){var o=e.getAttribLocation(t,i);n[i]=o}else if(a.type==="uniform"||a.type==="texture"){var o=e.getUniformLocation(t,i);n[i]=o}}),n}function Ije(e,t,r){for(var n=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES),i=0;i<n;++i){var a=e.getActiveAttrib(t,i);if(a){var o=a.name,s=a.type;if(o.startsWith("__activeAttribute")||o==="gl_InstanceID"||o==="gl_VertexID")continue;var u=r[o];if(u===void 0)throw new Error("missing 'uniform' or 'texture' with name '"+o+"' in schema");if(u.type!=="attribute")throw new Error("'"+o+"' must be of type 'attribute' but is '"+u.type+"'");var l=_je(e,u.kind,u.itemSize);if(l!==s)throw new Error("unexpected attribute type for "+o)}}}function Mje(e,t,r){for(var n=e.getProgramParameter(t,e.ACTIVE_UNIFORMS),i=0;i<n;++i){var a=e.getActiveUniform(t,i);if(a){var o=a.name,s=a.type;if(o.startsWith("__activeUniform"))continue;var u=o.replace(/[[0-9]+\]$/,""),l=r[u];if(l===void 0)throw new Error("missing 'uniform' or 'texture' with name '"+o+"' in schema");if(l.type==="uniform"){var c=sje(e,l.kind);if(c!==s)throw new Error("unexpected uniform type for "+o)}else if(l.type==="texture"){if(l.kind==="image-float32"||l.kind==="image-uint8"){if(s!==e.SAMPLER_2D)throw new Error("unexpected sampler type for '"+o+"'")}else if((l.kind==="volume-float32"||l.kind==="volume-uint8")&&s!==e.SAMPLER_3D)throw new Error("unexpected sampler type for '"+o+"'")}else throw new Error("'"+o+"' must be of type 'uniform' or 'texture' but is '"+l.type+"'")}}}function Dje(e,t){if(!e.getProgramParameter(t,e.LINK_STATUS))throw new Error(`Could not compile WebGL program. 

`+e.getProgramInfoLog(t))}function SD(e){var t=e.createProgram();if(t===null)throw new Error("Could not create WebGL program");return t}function Rje(e,t,r,n,i){var a=i.defineValues,o=i.shaderCode,s=i.schema,u=SD(e),l=Pje(),c=oje(e,r,a,o),d=n("vert",c.vert),f=n("frag",c.frag),p,v;function h(){d.attach(u),f.attach(u),e.linkProgram(u),kr&&Dje(e,u),p=Tje(e,u,s),v=gje(s),kr&&(Ije(e,u,s),Mje(e,u,s))}h();var m=!1;return{id:l,use:function(){t.currentProgramId=l,e.useProgram(u)},setUniforms:function(g){for(var y=0,b=g.length;y<b;++y){var S=g[y],x=S[0],C=S[1];if(C){var w=p[x];w!==null&&v[x](e,w,C.ref.value)}}},bindAttributes:function(g){for(var y=0,b=g.length;y<b;++y){var S=g[y],x=S[0],C=S[1],w=p[x];w!==-1&&C.bind(w)}},bindTextures:function(g,y){for(var b=0,S=g.length;b<S;++b){var x=g[b],C=x[0],w=x[1],A=p[C];A!=null&&(w.bind(b+y),v[C](e,A,b+y))}},reset:function(){u=SD(e),h()},destroy:function(){m||(d.destroy(),f.destroy(),e.deleteProgram(u),m=!0)}}}var kje=$a();function Oje(e){for(var t=e.split(`
`),r=0;r<t.length;++r)t[r]=r+1+": "+t[r];return t.join(`
`)}function rw(e,t){var r=t.type,n=t.source,i=e.createShader(r==="vert"?e.VERTEX_SHADER:e.FRAGMENT_SHADER);if(i===null)throw new Error("Error creating "+r+" shader");if(e.shaderSource(i,n),e.compileShader(i),kr&&e.getShaderParameter(i,e.COMPILE_STATUS)===!1)throw console.warn("'"+r+"' shader info log '"+e.getShaderInfoLog(i)+`'
`+Oje(n)),new Error("Error compiling "+r+" shader");return i}function Lje(e,t){var r=rw(e,t);return{id:kje(),attach:function(n){e.attachShader(n,r)},reset:function(){r=rw(e,t)},destroy:function(){e.deleteShader(r)}}}function Fje(e,t){return t===void 0&&(t=0),{value:e,usageCount:t}}function Nje(e){return{free:function(){e.usageCount-=1},value:e.value}}function Kj(e,t,r){var n=new Map;return{get:function(i){var a=e(i),o=n.get(a);return o||(o=Fje(t(i)),n.set(a,o)),o.usageCount+=1,Nje(o)},clear:function(){n.forEach(function(i,a){i.usageCount<=0&&(i.usageCount<0&&console.warn("Reference usageCount below zero."),r(i.value),n.delete(a))})},get count(){return n.size},dispose:function(){n.forEach(function(i){return r(i.value)}),n.clear()}}}var Bje=$a();function Uje(e,t){switch(t){case"depth16":return e.DEPTH_COMPONENT16;case"stencil8":return e.STENCIL_INDEX8;case"rgba4":return e.RGBA4;case"depth-stencil":return e.DEPTH_STENCIL;case"depth32f":if(Pr(e))return e.DEPTH_COMPONENT32F;throw new Error("WebGL2 needed for `depth32f` renderbuffer format")}}function jje(e,t){switch(t){case"depth":return e.DEPTH_ATTACHMENT;case"stencil":return e.STENCIL_ATTACHMENT;case"depth-stencil":return e.DEPTH_STENCIL_ATTACHMENT;case"color0":return e.COLOR_ATTACHMENT0}}function Qj(e){var t=e.createRenderbuffer();if(t===null)throw new Error("Could not create WebGL renderbuffer");return t}function zje(e,t,r,n,i){var a=Qj(e),o=function(){return e.bindRenderbuffer(e.RENDERBUFFER,a)},s=Uje(e,t),u=jje(e,r);function l(){o(),e.renderbufferStorage(e.RENDERBUFFER,s,n,i)}l();var c=!1;return{id:Bje(),bind:o,attachFramebuffer:function(d){d.bind(),o(),e.framebufferRenderbuffer(e.FRAMEBUFFER,u,e.RENDERBUFFER,a),kr&&GL(e)},setSize:function(d,f){n=d,i=f,l()},reset:function(){a=Qj(e),l()},destroy:function(){c||(e.deleteRenderbuffer(a),c=!0)}}}var Vje=$a();function Zj(e){var t=e.vertexArrayObject;if(!t)throw new Error("VertexArrayObject not supported");var r=t.createVertexArray();if(!r)throw new Error("Could not create WebGL vertex array");return r}function Jj(e){var t=e.vertexArrayObject;if(t===null)throw new Error("VertexArrayObject not supported");return t}function Hje(e,t,r,n){var i=Vje(),a=Zj(e),o=Jj(e);function s(){o.bindVertexArray(a),n&&n.bind(),t.bindAttributes(r),o.bindVertexArray(null)}s();var u=!1;return{id:i,bind:function(){o.bindVertexArray(a)},update:s,reset:function(){a=Zj(e),o=Jj(e),s()},destroy:function(){u||(o.deleteVertexArray(a),u=!0)}}}function Gje(e){return typeof e=="boolean"?e?1:0:typeof e=="number"?e*1e4:YO(e)}function ez(e){var t=E(E({},e.value),{destroy:function(){e.free()}});return t}function qje(e,t,r,n){var i={attribute:new Set,elements:new Set,framebuffer:new Set,program:new Set,renderbuffer:new Set,shader:new Set,texture:new Set,vertexArray:new Set};function a(l,c){return i[l].add(c),r.resourceCounts[l]+=1,E(E({},c),{destroy:function(){c.destroy(),i[l].delete(c),r.resourceCounts[l]-=1}})}var o=Kj(function(l){return JSON.stringify(l)},function(l){return a("shader",Lje(e,l))},function(l){l.destroy()});function s(l,c){return ez(o.get({type:l,source:c}))}var u=Kj(function(l){var c=[l.shaderCode.id];return Object.keys(l.defineValues).forEach(function(d){return c.push(YO(d),Gje(l.defineValues[d].ref.value))}),Ga(c).toString()},function(l){return a("program",Rje(e,t,n,s,l))},function(l){l.destroy()});return{attribute:function(l,c,d,f){return a("attribute",wje(e,n,l,c,d,f))},elements:function(l,c){return a("elements",Aje(e,l,c))},framebuffer:function(){return a("framebuffer",q9e(e))},program:function(l,c,d){return ez(u.get({defineValues:l,shaderCode:c,schema:d}))},renderbuffer:function(l,c,d,f){return a("renderbuffer",zje(e,l,c,d,f))},shader:s,texture:function(l,c,d,f){return a("texture",_D(e,n,l,c,d,f))},vertexArray:function(l,c,d){return a("vertexArray",Hje(n,l,c,d))},getByteCounts:function(){var l=0;i.texture.forEach(function(f){l+=f.getByteCount()});var c=0;i.attribute.forEach(function(f){c+=f.length*4});var d=0;return i.elements.forEach(function(f){d+=f.length*4}),{texture:l,attribute:c,elements:d}},reset:function(){i.attribute.forEach(function(l){return l.reset()}),i.elements.forEach(function(l){return l.reset()}),i.framebuffer.forEach(function(l){return l.reset()}),i.renderbuffer.forEach(function(l){return l.reset()}),i.shader.forEach(function(l){return l.reset()}),i.program.forEach(function(l){return l.reset()}),i.vertexArray.forEach(function(l){return l.reset()}),i.texture.forEach(function(l){return l.reset()})},destroy:function(){i.attribute.forEach(function(l){return l.destroy()}),i.elements.forEach(function(l){return l.destroy()}),i.framebuffer.forEach(function(l){return l.destroy()}),i.renderbuffer.forEach(function(l){return l.destroy()}),i.shader.forEach(function(l){return l.destroy()}),i.program.forEach(function(l){return l.destroy()}),i.vertexArray.forEach(function(l){return l.destroy()}),i.texture.forEach(function(l){return l.destroy()}),o.clear(),u.clear()}}}var Dee=$a();function $je(e,t,r,n,i,a,o){i===void 0&&(i=!0),a===void 0&&(a="uint8"),o===void 0&&(o="nearest");var s=t.framebuffer(),u=a==="fp16"?t.texture("image-float16","rgba","fp16",o):a==="float32"?t.texture("image-float32","rgba","float",o):t.texture("image-uint8","rgba","ubyte",o),l=i?Pr(e)?t.renderbuffer("depth32f","depth",r,n):t.renderbuffer("depth16","depth",r,n):null;function c(){u.define(r,n),u.attachFramebuffer(s,"color0"),l&&l.attachFramebuffer(s)}c();var d=!1;return{id:Dee(),texture:u,framebuffer:s,getWidth:function(){return r},getHeight:function(){return n},bind:function(){s.bind()},setSize:function(f,p){r===f&&n===p||(r=f,n=p,u.define(r,n),l&&l.setSize(r,n))},reset:function(){c()},destroy:function(){d||(u.destroy(),s.destroy(),l&&l.destroy(),d=!0)}}}function Wje(e){return{id:Dee(),texture:kE(e),framebuffer:$9e(),getWidth:function(){return 0},getHeight:function(){return 0},bind:function(){e.bindFramebuffer(e.FRAMEBUFFER,null)},setSize:function(){},reset:function(){},destroy:function(){}}}function Xje(e,t){function r(i){try{return e.getContext(i,t)}catch{return null}}var n=r("webgl2")||r("webgl")||r("experimental-webgl");return kr&&console.log("isWebgl2: "+Pr(n)),n}function Ree(e,t){switch(t){case e.NO_ERROR:return"no error";case e.INVALID_ENUM:return"invalid enum";case e.INVALID_VALUE:return"invalid value";case e.INVALID_OPERATION:return"invalid operation";case e.INVALID_FRAMEBUFFER_OPERATION:return"invalid framebuffer operation";case e.OUT_OF_MEMORY:return"out of memory";case e.CONTEXT_LOST_WEBGL:return"context lost"}return"unknown error"}function kee(e){var t=e.getError();if(t!==e.NO_ERROR)throw new Error("WebGL error: '"+Ree(e,t)+"'")}function Yje(e){for(var t=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),r=0;r<t;++r)e.activeTexture(e.TEXTURE0+r),e.bindTexture(e.TEXTURE_2D,null),e.bindTexture(e.TEXTURE_CUBE_MAP,null),Pr(e)&&(e.bindTexture(e.TEXTURE_2D_ARRAY,null),e.bindTexture(e.TEXTURE_3D,null));var n=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,n);for(var i=e.getParameter(e.MAX_VERTEX_ATTRIBS),r=0;r<i;++r)e.vertexAttribPointer(r,1,e.FLOAT,!1,0,0);e.bindBuffer(e.ARRAY_BUFFER,null),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null),e.bindRenderbuffer(e.RENDERBUFFER,null),nw(e)}function nw(e){e.bindFramebuffer(e.FRAMEBUFFER,null)}var Oee=new Uint8Array(1*4);function Lee(e,t,r){e.getSyncParameter(t,e.SYNC_STATUS)===e.SIGNALED?(e.deleteSync(t),r()):nL.setImmediate(Lee,e,t,r)}function Fee(e,t){var r=e.fenceSync(e.SYNC_GPU_COMMANDS_COMPLETE,0);r?nL.setImmediate(Lee,e,r,t):(console.warn("Could not create a WebGLSync object"),e.readPixels(0,0,1,1,e.RGBA,e.UNSIGNED_BYTE,Oee),t())}var tz=!1;function Kje(e){return new Promise(function(t){Pr(e)?Fee(e,t):(tz||(console.info("Sync object not supported in WebGL"),tz=!0),Nee(e),t())})}function Nee(e){e.bindFramebuffer(e.FRAMEBUFFER,null),e.readPixels(0,0,1,1,e.RGBA,e.UNSIGNED_BYTE,Oee)}function CD(e,t,r,n,i,a){if(kr&&GL(e),a instanceof Uint8Array)e.readPixels(t,r,n,i,e.RGBA,e.UNSIGNED_BYTE,a);else if(a instanceof Float32Array)e.readPixels(t,r,n,i,e.RGBA,e.FLOAT,a);else if(a instanceof Int32Array&&Pr(e))e.readPixels(t,r,n,i,e.RGBA_INTEGER,e.INT,a);else throw new Error("unsupported readPixels buffer type");kr&&kee(e)}function Qje(e){var t=e.drawingBufferWidth,r=e.drawingBufferHeight,n=new Uint8Array(t*r*4);return nw(e),e.viewport(0,0,t,r),CD(e,0,0,t,r,n),zh.flipY(zh.create(n,t,r))}function Zje(){return{resourceCounts:{attribute:0,elements:0,framebuffer:0,program:0,renderbuffer:0,shader:0,texture:0,vertexArray:0},drawCount:0,instanceCount:0,instancedDrawCount:0}}function Jje(e,t){var r=this;t===void 0&&(t={});var n=$j(e),i=W9e(e),a=Zje(),o=qje(e,i,a,n),s={maxTextureSize:e.getParameter(e.MAX_TEXTURE_SIZE),max3dTextureSize:Pr(e)?e.getParameter(e.MAX_3D_TEXTURE_SIZE):0,maxRenderbufferSize:e.getParameter(e.MAX_RENDERBUFFER_SIZE),maxDrawBuffers:n.drawBuffers?e.getParameter(n.drawBuffers.MAX_DRAW_BUFFERS):0,maxTextureImageUnits:e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),maxVertexTextureImageUnits:e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS)};if(s.maxVertexTextureImageUnits<8)throw new Error('Need "MAX_VERTEX_TEXTURE_IMAGE_UNITS" >= 8');var u=!1,l=new kf(0),c;if(Pr(e)){var d=e.createBuffer(),f=void 0,p=void 0,v=!1,h=function(){e.bindBuffer(e.PIXEL_PACK_BUFFER,d),e.getBufferSubData(e.PIXEL_PACK_BUFFER,0,f),e.bindBuffer(e.PIXEL_PACK_BUFFER,null),v=!1,p(),p=void 0,f=void 0};c=function(g,y,b,S,x){return new Promise(function(C,w){if(v){w("Can not call multiple readPixelsAsync at the same time");return}v=!0,e.bindBuffer(e.PIXEL_PACK_BUFFER,d),e.bufferData(e.PIXEL_PACK_BUFFER,b*S*4,e.STREAM_READ),e.readPixels(g,y,b,S,e.RGBA,e.UNSIGNED_BYTE,0),e.bindBuffer(e.PIXEL_PACK_BUFFER,null),p=C,f=x,Fee(e,h)})}}else c=function(g,y,b,S,x){return ce(r,void 0,void 0,function(){return de(this,function(C){return CD(e,g,y,b,S,x),[2]})})};var m=new Set;return{gl:e,isWebGL2:Pr(e),get pixelRatio(){var g=typeof window<"u"?window.devicePixelRatio:1;return g*(t.pixelScale||1)},extensions:n,state:i,stats:a,resources:o,get maxTextureSize(){return s.maxTextureSize},get max3dTextureSize(){return s.max3dTextureSize},get maxRenderbufferSize(){return s.maxRenderbufferSize},get maxDrawBuffers(){return s.maxDrawBuffers},get maxTextureImageUnits(){return s.maxTextureImageUnits},namedComputeRenderables:Object.create(null),namedFramebuffers:Object.create(null),namedTextures:Object.create(null),get isContextLost(){return u||e.isContextLost()},contextRestored:l,setContextLost:function(){u=!0},handleContextRestored:function(g){Object.assign(n,$j(e)),i.reset(),i.currentMaterialId=-1,i.currentProgramId=-1,i.currentRenderItemId=-1,o.reset(),m.forEach(function(y){return y.reset()}),g==null||g(),u=!1,l.next(kn())},createRenderTarget:function(g,y,b,S,x){var C=$je(e,o,g,y,b,S,x);return m.add(C),E(E({},C),{destroy:function(){C.destroy(),m.delete(C)}})},unbindFramebuffer:function(){return nw(e)},readPixels:function(g,y,b,S,x){CD(e,g,y,b,S,x)},readPixelsAsync:c,waitForGpuCommandsComplete:function(){return Kje(e)},waitForGpuCommandsCompleteSync:function(){return Nee(e)},getDrawingBufferPixelData:function(){return Qje(e)},clear:function(g,y,b,S){nw(e),i.enable(e.SCISSOR_TEST),i.depthMask(!0),i.colorMask(!0,!0,!0,!0),i.clearColor(g,y,b,S),e.viewport(0,0,e.drawingBufferWidth,e.drawingBufferHeight),e.scissor(0,0,e.drawingBufferWidth,e.drawingBufferHeight),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT)},destroy:function(g){var y;o.destroy(),Yje(e),g!=null&&g.doNotForceWebGLContextLoss||(y=e.getExtension("WEBGL_lose_context"))===null||y===void 0||y.loseContext()}}}function Pr(e){return typeof WebGL2RenderingContext<"u"&&e instanceof WebGL2RenderingContext}function eze(e){if(Pr(e))return{drawArraysInstanced:e.drawArraysInstanced.bind(e),drawElementsInstanced:e.drawElementsInstanced.bind(e),vertexAttribDivisor:e.vertexAttribDivisor.bind(e),VERTEX_ATTRIB_ARRAY_DIVISOR:e.VERTEX_ATTRIB_ARRAY_DIVISOR};var t=e.getExtension("ANGLE_instanced_arrays");return t===null?null:{drawArraysInstanced:t.drawArraysInstancedANGLE.bind(t),drawElementsInstanced:t.drawElementsInstancedANGLE.bind(t),vertexAttribDivisor:t.vertexAttribDivisorANGLE.bind(t),VERTEX_ATTRIB_ARRAY_DIVISOR:t.VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE}}function tze(e){if(Pr(e))return{FRAGMENT_SHADER_DERIVATIVE_HINT:e.FRAGMENT_SHADER_DERIVATIVE_HINT};var t=e.getExtension("OES_standard_derivatives");return t===null?null:{FRAGMENT_SHADER_DERIVATIVE_HINT:t.FRAGMENT_SHADER_DERIVATIVE_HINT_OES}}function rze(e){return Pr(e)?{}:e.getExtension("OES_element_index_uint")}function nze(e){if(Pr(e))return{VERTEX_ARRAY_BINDING:e.VERTEX_ARRAY_BINDING,bindVertexArray:e.bindVertexArray.bind(e),createVertexArray:e.createVertexArray.bind(e),deleteVertexArray:e.deleteVertexArray.bind(e),isVertexArray:e.isVertexArray.bind(e)};var t=e.getExtension("OES_vertex_array_object");return t===null?null:{VERTEX_ARRAY_BINDING:t.VERTEX_ARRAY_BINDING_OES,bindVertexArray:t.bindVertexArrayOES.bind(t),createVertexArray:t.createVertexArrayOES.bind(t),deleteVertexArray:t.deleteVertexArrayOES.bind(t),isVertexArray:t.isVertexArrayOES.bind(t)}}function ize(e){return Pr(e)?{}:e.getExtension("OES_texture_float")}function aze(e){return e.getExtension("OES_texture_float_linear")}function oze(e){if(Pr(e))return{HALF_FLOAT:e.HALF_FLOAT};var t=e.getExtension("OES_texture_half_float");return t===null?null:{HALF_FLOAT:t.HALF_FLOAT_OES}}function sze(e){return e.getExtension("OES_texture_half_float_linear")}function uze(e){if(Pr(e))return{MIN:e.MIN,MAX:e.MAX};var t=e.getExtension("EXT_blend_minmax");return t===null?null:{MIN:t.MIN_EXT,MAX:t.MAX_EXT}}function lze(e){return Pr(e)?{}:e.getExtension("EXT_frag_depth")}function cze(e){if(Pr(e))return e.getExtension("EXT_color_buffer_float")===null?null:(e.getExtension("EXT_float_blend"),{RGBA32F:e.RGBA32F});var t=e.getExtension("WEBGL_color_buffer_float");return t===null?(e.getExtension("OES_texture_float"),Bee(e,e.FLOAT)?{RGBA32F:34836}:null):(e.getExtension("EXT_float_blend"),{RGBA32F:t.RGBA32F_EXT})}function dze(e){if(Pr(e))return e.getExtension("EXT_color_buffer_half_float")===null?null:(e.getExtension("EXT_float_blend"),{RGBA16F:e.RGBA16F});var t=e.getExtension("EXT_color_buffer_half_float");return t===null?(e.getExtension("OES_texture_half_float"),Bee(e,36193)?{RGBA16F:34842}:null):(e.getExtension("EXT_float_blend"),{RGBA16F:t.RGBA16F_EXT})}function fze(e){if(Pr(e))return{drawBuffers:e.drawBuffers.bind(e),COLOR_ATTACHMENT0:e.COLOR_ATTACHMENT0,COLOR_ATTACHMENT1:e.COLOR_ATTACHMENT1,COLOR_ATTACHMENT2:e.COLOR_ATTACHMENT2,COLOR_ATTACHMENT3:e.COLOR_ATTACHMENT3,COLOR_ATTACHMENT4:e.COLOR_ATTACHMENT4,COLOR_ATTACHMENT5:e.COLOR_ATTACHMENT5,COLOR_ATTACHMENT6:e.COLOR_ATTACHMENT6,COLOR_ATTACHMENT7:e.COLOR_ATTACHMENT7,DRAW_BUFFER0:e.DRAW_BUFFER0,DRAW_BUFFER1:e.DRAW_BUFFER1,DRAW_BUFFER2:e.DRAW_BUFFER2,DRAW_BUFFER3:e.DRAW_BUFFER3,DRAW_BUFFER4:e.DRAW_BUFFER4,DRAW_BUFFER5:e.DRAW_BUFFER5,DRAW_BUFFER6:e.DRAW_BUFFER6,DRAW_BUFFER7:e.DRAW_BUFFER7,MAX_COLOR_ATTACHMENTS:e.MAX_COLOR_ATTACHMENTS,MAX_DRAW_BUFFERS:e.MAX_DRAW_BUFFERS};var t=e.getExtension("WEBGL_draw_buffers");return t===null?null:{drawBuffers:t.drawBuffersWEBGL.bind(t),COLOR_ATTACHMENT0:t.COLOR_ATTACHMENT0_WEBGL,COLOR_ATTACHMENT1:t.COLOR_ATTACHMENT1_WEBGL,COLOR_ATTACHMENT2:t.COLOR_ATTACHMENT2_WEBGL,COLOR_ATTACHMENT3:t.COLOR_ATTACHMENT3_WEBGL,COLOR_ATTACHMENT4:t.COLOR_ATTACHMENT4_WEBGL,COLOR_ATTACHMENT5:t.COLOR_ATTACHMENT5_WEBGL,COLOR_ATTACHMENT6:t.COLOR_ATTACHMENT6_WEBGL,COLOR_ATTACHMENT7:t.COLOR_ATTACHMENT7_WEBGL,DRAW_BUFFER0:t.DRAW_BUFFER0_WEBGL,DRAW_BUFFER1:t.DRAW_BUFFER1_WEBGL,DRAW_BUFFER2:t.DRAW_BUFFER2_WEBGL,DRAW_BUFFER3:t.DRAW_BUFFER3_WEBGL,DRAW_BUFFER4:t.DRAW_BUFFER4_WEBGL,DRAW_BUFFER5:t.DRAW_BUFFER5_WEBGL,DRAW_BUFFER6:t.DRAW_BUFFER6_WEBGL,DRAW_BUFFER7:t.DRAW_BUFFER7_WEBGL,MAX_COLOR_ATTACHMENTS:t.MAX_COLOR_ATTACHMENTS_WEBGL,MAX_DRAW_BUFFERS:t.MAX_DRAW_BUFFERS_WEBGL}}function pze(e){return Pr(e)?{}:e.getExtension("EXT_shader_texture_lod")}function hze(e){if(Pr(e))return{UNSIGNED_INT_24_8:e.UNSIGNED_INT_24_8};var t=e.getExtension("WEBGL_depth_texture");return t===null?null:{UNSIGNED_INT_24_8:t.UNSIGNED_INT_24_8_WEBGL}}function vze(e){if(Pr(e))return{FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING:e.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING,SRGB8_ALPHA8:e.SRGB8_ALPHA8,SRGB8:e.SRGB8,SRGB:e.SRGB};var t=e.getExtension("EXT_sRGB");return t===null?null:{FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING:t.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING_EXT,SRGB8_ALPHA8:t.SRGB8_ALPHA8_EXT,SRGB8:t.SRGB_ALPHA_EXT,SRGB:t.SRGB_EXT}}var mze=`
attribute vec4 aPosition;

void main() {
    gl_Position = aPosition;
}`,gze=`
precision mediump float;
uniform vec4 uColor;
uniform sampler2D uTexture;

void main() {
    gl_FragColor = texture2D(uTexture, vec2(0.5, 0.5)) * uColor;
}`,yze=new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]);function Bee(e,t){var r=rw(e,{type:"vert",source:mze}),n=rw(e,{type:"frag",source:gze});if(!r||!n)return!1;var i=SD(e);e.attachShader(i,r),e.attachShader(i,n),e.linkProgram(i),e.useProgram(i);var a=e.getAttribLocation(i,"aPosition"),o=e.getUniformLocation(i,"uColor");if(!o)return kr&&console.log("error getting 'uColor' uniform location"),!1;var s=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,s),e.bufferData(e.ARRAY_BUFFER,yze,e.STATIC_DRAW),e.enableVertexAttribArray(a),e.vertexAttribPointer(a,2,e.FLOAT,!1,0,0);var u=e.createTexture(),l=new Uint8Array([255,255,255,255]);e.bindTexture(e.TEXTURE_2D,u),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,l);var c=e.createTexture();e.bindTexture(e.TEXTURE_2D,c),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,1,1,0,e.RGBA,t,null),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST);var d=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,d),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,c,0);var f=e.checkFramebufferStatus(e.FRAMEBUFFER);if(f!==e.FRAMEBUFFER_COMPLETE)return kr&&console.log("error creating framebuffer for '"+t+"'"),!1;e.bindTexture(e.TEXTURE_2D,u),e.uniform4fv(o,[0,10,20,1]),e.drawArrays(e.TRIANGLES,0,6),e.bindTexture(e.TEXTURE_2D,c),e.bindFramebuffer(e.FRAMEBUFFER,null),e.clearColor(1,0,0,1),e.clear(e.COLOR_BUFFER_BIT),e.uniform4fv(o,[0,1/10,1/20,1]),e.drawArrays(e.TRIANGLES,0,6);var p=new Uint8Array(4);if(e.readPixels(0,0,1,1,e.RGBA,e.UNSIGNED_BYTE,p),p[0]!==0||p[1]<248||p[2]<248||p[3]<254)return kr&&console.log("not able to actually render to '"+t+"' texture"),!1;if(t===e.FLOAT){e.bindFramebuffer(e.FRAMEBUFFER,d);var v=new Float32Array(4);e.readPixels(0,0,1,1,e.RGBA,e.FLOAT,v);var h=e.getError();if(h)return kr&&console.log("error reading float pixels: '"+Ree(e,h)+"'"),!1}return!0}var Uee=$a();function bze(e,t){switch(t){case"image-uint8":return e.TEXTURE_2D;case"image-float32":return e.TEXTURE_2D;case"image-float16":return e.TEXTURE_2D;case"image-depth":return e.TEXTURE_2D}if(Pr(e))switch(t){case"image-int32":return e.TEXTURE_2D;case"volume-uint8":return e.TEXTURE_3D;case"volume-float32":return e.TEXTURE_3D;case"volume-float16":return e.TEXTURE_3D}throw new Error("unknown texture kind '"+t+"'")}function jee(e,t,r){switch(t){case"alpha":return Pr(e)&&r==="float"?e.RED:Pr(e)&&r==="int"?e.RED_INTEGER:e.ALPHA;case"rgb":return Pr(e)&&r==="int"?e.RGB_INTEGER:e.RGB;case"rgba":return Pr(e)&&r==="int"?e.RGBA_INTEGER:e.RGBA;case"depth":return e.DEPTH_COMPONENT}}function xze(e,t,r){if(Pr(e))switch(t){case"alpha":switch(r){case"ubyte":return e.ALPHA;case"float":return e.R32F;case"fp16":return e.R16F;case"int":return e.R32I}case"rgb":switch(r){case"ubyte":return e.RGB;case"float":return e.RGB32F;case"fp16":return e.RGB16F;case"int":return e.RGB32I}case"rgba":switch(r){case"ubyte":return e.RGBA;case"float":return e.RGBA32F;case"fp16":return e.RGBA16F;case"int":return e.RGBA32I}case"depth":switch(r){case"ushort":return e.DEPTH_COMPONENT16;case"float":return e.DEPTH_COMPONENT32F}}return jee(e,t,r)}function Sze(e,t,r,n,i){var a=Cze(e)*_ze(t);return a*r*n*(i||1)}function Cze(e){switch(e){case"alpha":return 1;case"rgb":return 3;case"rgba":return 4;case"depth":return 4}}function _ze(e){switch(e){case"ubyte":return 1;case"ushort":return 2;case"float":return 4;case"fp16":return 2;case"int":return 4}}function wze(e,t,r){switch(r){case"ubyte":return e.UNSIGNED_BYTE;case"ushort":return e.UNSIGNED_SHORT;case"float":return e.FLOAT;case"fp16":if(t.textureHalfFloat)return t.textureHalfFloat.HALF_FLOAT;throw new Error('extension "texture_half_float" unavailable');case"int":if(Pr(e))return e.INT;throw new Error('texture type "int" requires webgl2')}}function rz(e,t){switch(t){case"nearest":return e.NEAREST;case"linear":return e.LINEAR}}function Ox(e,t,r){switch(r){case"depth":return e.DEPTH_ATTACHMENT;case"stencil":return e.STENCIL_ATTACHMENT;case"color0":case 0:return e.COLOR_ATTACHMENT0}if(t.drawBuffers)switch(r){case"color1":case 1:return t.drawBuffers.COLOR_ATTACHMENT1;case"color2":case 2:return t.drawBuffers.COLOR_ATTACHMENT2;case"color3":case 3:return t.drawBuffers.COLOR_ATTACHMENT3;case"color4":case 4:return t.drawBuffers.COLOR_ATTACHMENT4;case"color5":case 5:return t.drawBuffers.COLOR_ATTACHMENT5;case"color6":case 6:return t.drawBuffers.COLOR_ATTACHMENT6;case"color7":case 7:return t.drawBuffers.COLOR_ATTACHMENT7}throw new Error("unknown texture attachment")}function Eze(e){return typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement}function Aze(e,t,r){return t===r.TEXTURE_2D}function Pze(e,t,r){return t===r.TEXTURE_3D}function nz(e){var t=e.createTexture();if(t===null)throw new Error("Could not create WebGL texture");return t}function _D(e,t,r,n,i,a){var o=Uee(),s=nz(e);if(r.endsWith("float32")&&i!=="float"||r.endsWith("float16")&&i!=="fp16"||r.endsWith("uint8")&&i!=="ubyte"||r.endsWith("int32")&&i!=="int"||r.endsWith("depth")&&i!=="ushort"&&i!=="float")throw new Error("texture kind '"+r+"' and type '"+i+"' are incompatible");var u=bze(e,r),l=rz(e,a),c=jee(e,n,i),d=xze(e,n,i),f=wze(e,t,i);function p(){e.bindTexture(u,s),e.texParameteri(u,e.TEXTURE_MAG_FILTER,l),e.texParameteri(u,e.TEXTURE_MIN_FILTER,l),e.texParameteri(u,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(u,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.bindTexture(u,null)}p();var v=0,h=0,m=0,g,y=!1;function b(C,w,A){if(!(v===C&&h===w&&m===(A||0)))if(v=C,h=w,m=A||0,e.bindTexture(u,s),u===e.TEXTURE_2D)e.texImage2D(u,0,d,v,h,0,c,f,null);else if(Pr(e)&&u===e.TEXTURE_3D&&m!==void 0)e.texImage3D(u,0,d,v,h,m,0,c,f,null);else throw new Error("unknown texture target")}function S(C,w){if(w===void 0&&(w=!1),e.bindTexture(u,s),e.pixelStorei(e.UNPACK_ALIGNMENT,1),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,e.NONE),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),Eze(C))e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!1),e.bindTexture(e.TEXTURE_2D,s),e.texImage2D(e.TEXTURE_2D,0,d,c,f,C);else if(Aze(C,u,e)){var A=C.filter?rz(e,C.filter):l;e.texParameteri(u,e.TEXTURE_MAG_FILTER,A),e.texParameteri(u,e.TEXTURE_MIN_FILTER,A),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!!C.flipY),w?e.texSubImage2D(u,0,0,0,C.width,C.height,c,f,C.array):(v=C.width,h=C.height,e.texImage2D(u,0,d,v,h,0,c,f,C.array))}else if(Pr(e)&&Pze(C,u,e))e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!1),w?e.texSubImage3D(u,0,0,0,0,C.width,C.height,C.depth,c,f,C.array):(v=C.width,h=C.height,m=C.depth,e.texImage3D(u,0,d,v,h,m,0,c,f,C.array));else throw new Error("unknown texture target");e.bindTexture(u,null),g=C}function x(C,w,A){if(C.bind(),u===e.TEXTURE_2D)e.framebufferTexture2D(e.FRAMEBUFFER,Ox(e,t,w),e.TEXTURE_2D,s,0);else if(Pr(e)&&u===e.TEXTURE_3D){if(A===void 0)throw new Error("need `layer` to attach 3D texture");e.framebufferTextureLayer(e.FRAMEBUFFER,Ox(e,t,w),s,0,A)}else throw new Error("unknown/unsupported texture target")}return{id:o,target:u,format:c,internalFormat:d,type:f,filter:l,getWidth:function(){return v},getHeight:function(){return h},getDepth:function(){return m},getByteCount:function(){return Sze(n,i,v,h,m)},define:b,load:S,bind:function(C){e.activeTexture(e.TEXTURE0+C),e.bindTexture(u,s)},unbind:function(C){e.activeTexture(e.TEXTURE0+C),e.bindTexture(u,null)},attachFramebuffer:x,detachFramebuffer:function(C,w){if(C.bind(),u===e.TEXTURE_2D)e.framebufferTexture2D(e.FRAMEBUFFER,Ox(e,t,w),e.TEXTURE_2D,null,0);else if(Pr(e)&&u===e.TEXTURE_3D)e.framebufferTextureLayer(e.FRAMEBUFFER,Ox(e,t,w),null,0,0);else throw new Error("unknown texture target")},reset:function(){s=nz(e),p();var C=[v,h,m],w=C[0],A=C[1],M=C[2];v=0,h=0,m=0,b(w,A,M),g&&S(g)},destroy:function(){y||(e.deleteTexture(s),y=!0)}}}function Tze(e,t,r){var n=e.resources,i=[];return Object.keys(t).forEach(function(a){var o=t[a];if(o.type==="texture"){var s=r[a];if(s)if(o.kind==="texture")i[i.length]=[a,s.ref.value];else{var u=n.texture(o.kind,o.format,o.dataType,o.filter);u.load(s.ref.value),i[i.length]=[a,u]}}}),i}function iz(e,t,r){var n=new Image;n.onload=function(){r.load(n),F.update(t,r)},n.src=e}function kE(e){var t,r=(t=e==null?void 0:e.TEXTURE_2D)!==null&&t!==void 0?t:3553;return{id:Uee(),target:r,format:0,internalFormat:0,type:0,filter:0,getWidth:function(){return 0},getHeight:function(){return 0},getDepth:function(){return 0},getByteCount:function(){return 0},define:function(){},load:function(){},bind:function(n){e&&(e.activeTexture(e.TEXTURE0+n),e.bindTexture(r,null))},unbind:function(n){e&&(e.activeTexture(e.TEXTURE0+n),e.bindTexture(r,null))},attachFramebuffer:function(){},detachFramebuffer:function(){},reset:function(){},destroy:function(){}}}function hs(e,t,r,n){var i=Ize(e,t,r,n);return r.palette?(F.updateIfChanged(i.dUsePalette,!0),Mze(r.palette,i.tPalette)):F.updateIfChanged(i.dUsePalette,!1),i}function Ize(e,t,r,n){switch(la.getGranularity(e,r.granularity)){case"uniform":return Rze(e,r.color,n);case"instance":return kze(e,r.color,n);case"group":return Oze(e,r.color,n);case"groupInstance":return Lze(e,r.color,n);case"vertex":return Fze(t,r.color,n);case"vertexInstance":return Nze(t,r.color,n);case"volume":return az(r.grid,"volume",n);case"volumeInstance":return az(r.grid,"volumeInstance",n)}}function Mze(e,t){var r=!0,n=t.ref.value;if(e.colors.length!==n.width||n.filter!==e.filter)r=!1;else for(var i=n.array,a=0,o=0,s=e.colors;o<s.length;o++){var u=s[o],l=at.toRgb(u),c=l[0],d=l[1],f=l[2];if(i[a++]!==c||i[a++]!==d||i[a++]!==f){r=!1;break}}if(!r){for(var p=new Uint8Array(e.colors.length*3),v=0,h=0,m=e.colors;h<m.length;h++){var u=m[h],g=at.toRgb(u),c=g[0],d=g[1],f=g[2];p[v++]=c,p[v++]=d,p[v++]=f}F.update(t,{array:p,height:1,width:e.colors.length,filter:e.filter})}}function Dze(e,t){return t?(F.update(t.uColor,at.toVec3Normalized(t.uColor.ref.value,e)),F.updateIfChanged(t.dColorType,"uniform"),t):{uColor:F.create(at.toVec3Normalized(_(),e)),tColor:F.create({array:new Uint8Array(3),width:1,height:1}),tColorGrid:F.create(kE()),tPalette:F.create({array:new Uint8Array(3),width:1,height:1}),uColorTexDim:F.create(He.create(1,1)),uColorGridDim:F.create(_.create(1,1,1)),uColorGridTransform:F.create(Ar.create(0,0,0,1)),dColorType:F.create("uniform"),dUsePalette:F.create(!1)}}function Rze(e,t,r){return Dze(t(ss,!1),r)}function c2(e,t,r){return r?(F.update(r.tColor,e),F.update(r.uColorTexDim,He.create(e.width,e.height)),F.updateIfChanged(r.dColorType,t),r):{uColor:F.create(_()),tColor:F.create(e),tColorGrid:F.create(kE()),tPalette:F.create({array:new Uint8Array(3),width:1,height:1}),uColorTexDim:F.create(He.create(e.width,e.height)),uColorGridDim:F.create(_.create(1,1,1)),uColorGridTransform:F.create(Ar.create(0,0,0,1)),dColorType:F.create(t),dUsePalette:F.create(!1)}}function kze(e,t,r){var n=e.instanceCount,i=Ca(Math.max(1,n),3,Uint8Array,r&&r.tColor.ref.value.array);for(e.reset();e.hasNext;){var a=e.move(),o=a.location,s=a.isSecondary,u=a.instanceIndex;at.toArray(t(o,s),i.array,u*3),e.skipInstance()}return c2(i,"instance",r)}function Oze(e,t,r){var n=e.groupCount,i=Ca(Math.max(1,n),3,Uint8Array,r&&r.tColor.ref.value.array);for(e.reset();e.hasNext&&!e.isNextNewInstance;){var a=e.move(),o=a.location,s=a.isSecondary,u=a.groupIndex;at.toArray(t(o,s),i.array,u*3)}return c2(i,"group",r)}function Lze(e,t,r){var n=e.groupCount,i=e.instanceCount,a=i*n,o=Ca(Math.max(1,a),3,Uint8Array,r&&r.tColor.ref.value.array);for(e.reset();e.hasNext;){var s=e.move(),u=s.location,l=s.isSecondary,c=s.index;at.toArray(t(u,l),o.array,c*3)}return c2(o,"groupInstance",r)}function Fze(e,t,r){var n=e.groupCount,i=e.stride,a=Ca(Math.max(1,n),3,Uint8Array,r&&r.tColor.ref.value.array);for(e.reset(),e.voidInstances();e.hasNext&&!e.isNextNewInstance;)for(var o=e.move(),s=o.location,u=o.isSecondary,l=o.groupIndex,c=t(s,u),d=0;d<i;++d)at.toArray(c,a.array,(l+d)*3);return c2(a,"vertex",r)}function Nze(e,t,r){var n=e.groupCount,i=e.instanceCount,a=e.stride,o=i*n,s=Ca(Math.max(1,o),3,Uint8Array,r&&r.tColor.ref.value.array);for(e.reset();e.hasNext;)for(var u=e.move(),l=u.location,c=u.isSecondary,d=u.index,f=t(l,c),p=0;p<a;++p)at.toArray(f,s.array,(d+p)*3);return c2(s,"vertexInstance",r)}function az(e,t,r){var n=e.colors,i=e.dimension,a=e.transform,o=n.getWidth(),s=n.getHeight();return r?(F.update(r.tColorGrid,n),F.update(r.uColorTexDim,He.create(o,s)),F.update(r.uColorGridDim,_.clone(i)),F.update(r.uColorGridTransform,Ar.clone(a)),F.updateIfChanged(r.dColorType,t),r):{uColor:F.create(_()),tColor:F.create({array:new Uint8Array(3),width:1,height:1}),tColorGrid:F.create(n),tPalette:F.create({array:new Uint8Array(3),width:1,height:1}),uColorTexDim:F.create(He.create(o,s)),uColorGridDim:F.create(_.clone(i)),uColorGridTransform:F.create(Ar.clone(a)),dColorType:F.create(t),dUsePalette:F.create(!1)}}var Ft;(function(e){function t(b,S,x,C,w,A,M){return M?a(b,S,x,C,w,A,M):i(b,S,x,C,w,A)}e.create=t;function r(b){var S=b?b.vertexBuffer.ref.value:new Float32Array(0),x=b?b.indexBuffer.ref.value:new Uint32Array(0),C=b?b.normalBuffer.ref.value:new Float32Array(0),w=b?b.groupBuffer.ref.value:new Float32Array(0);return t(S,x,C,w,0,0,b)}e.createEmpty=r;function n(b){return Ga([b.vertexCount,b.triangleCount,b.vertexBuffer.ref.version,b.indexBuffer.ref.version,b.normalBuffer.ref.version,b.groupBuffer.ref.version])}function i(b,S,x,C,w,A){var M=Be(),D,k=-1,R=-1,O={kind:"mesh",vertexCount:w,triangleCount:A,vertexBuffer:F.create(b),indexBuffer:F.create(S),normalBuffer:F.create(x),groupBuffer:F.create(C),get boundingSphere(){var H=n(O);if(H!==k){var B=mp(O.vertexBuffer.ref.value,O.vertexCount,1);Be.copy(M,B),k=H}return M},get groupMapping(){return O.groupBuffer.ref.version!==R&&(D=w0(O.groupBuffer.ref.value,O.vertexCount),R=O.groupBuffer.ref.version),D},setBoundingSphere:function(H){Be.copy(M,H),k=n(O)},meta:{}};return O}function a(b,S,x,C,w,A,M){return M.vertexCount=w,M.triangleCount=A,F.update(M.vertexBuffer,b),F.update(M.indexBuffer,S),F.update(M.normalBuffer,x),F.update(M.groupBuffer,C),M}function o(b){var S=b.vertexCount,x=b.triangleCount,C=b.vertexBuffer.ref.value,w=b.indexBuffer.ref.value,A=b.normalBuffer.ref.value.length>=S*3?b.normalBuffer.ref.value:new Float32Array(S*3);A===b.normalBuffer.ref.value&&A.fill(0,0,S*3),vee(C,w,A,S,x),F.update(b.normalBuffer,A)}e.computeNormals=o;function s(b,S){S===void 0&&(S=3);for(var x=b.vertexBuffer.ref.value,C=new Map,w=function(H,B){return H[0].toFixed(B)+"|"+H[1].toFixed(B)+"|"+H[2].toFixed(B)},A=0,M=_(),D=0,k=b.vertexCount;D<k;++D){_.fromArray(M,x,D*3);var R=w(M,S),O=C.get(R);O!==void 0?(A+=1,C.set(R,O+1)):C.set(R,1)}return A}e.checkForDuplicateVertices=s;var u=$n();function l(b,S){var x=b.vertexBuffer.ref.value;if(yv(S,x,0,b.vertexCount),!ue.isTranslationAndUniformScaling(S)){var C=$n.directionTransform(u,S);Y7e(C,b.normalBuffer.ref.value,0,b.vertexCount)}F.update(b.vertexBuffer,x)}e.transform=l;function c(b){var S=("kind"in b?b.meta:b.meta.ref.value).originalData;return S}e.getOriginalData=c;function d(b,S){S===void 0&&(S=!0);var x=b.indexBuffer,C=b.vertexBuffer,w=b.groupBuffer,A=b.normalBuffer,M=b.triangleCount,D=b.vertexCount,k=x.ref.value,R=C.ref.value,O=w.ref.value,H=A.ref.value,B=qe.create(Uint32Array,3,1024,M),j=qe.create(Float32Array,3,1024,R);j.currentIndex=D*3,j.elementCount=D;var Y=qe.create(Float32Array,3,1024,H);Y.currentIndex=D*3,Y.elementCount=D;var G=qe.create(Float32Array,1,1024,O);G.currentIndex=D,G.elementCount=D;var $=_(),q=_(),ee=_(),fe=_(),W=_(),X=_();function U(Xe){_.fromArray($,R,Xe*3),_.fromArray(fe,H,Xe*3),qe.add3(j,$[0],$[1],$[2]),qe.add3(Y,fe[0],fe[1],fe[2])}function z(Xe,ct){_.fromArray($,R,Xe*3),_.fromArray(q,R,ct*3),_.scale($,_.add($,$,q),.5),_.fromArray(fe,H,Xe*3),_.fromArray(W,H,ct*3),_.scale(fe,_.add(fe,fe,W),.5),qe.add3(j,$[0],$[1],$[2]),qe.add3(Y,fe[0],fe[1],fe[2])}function J(Xe,ct,Ne){_.fromArray($,R,Xe*3),_.fromArray(q,R,ct*3),_.fromArray(ee,R,Ne*3),_.scale($,_.add($,_.add($,$,q),ee),1/3),_.fromArray(fe,H,Xe*3),_.fromArray(W,H,ct*3),_.fromArray(X,H,Ne*3),_.scale(fe,_.add(fe,_.add(fe,fe,W),X),1/3),qe.add3(j,$[0],$[1],$[2]),qe.add3(Y,fe[0],fe[1],fe[2])}function K(Xe,ct,Ne,Qe,it){++te,U(Xe),z(Xe,ct),z(Xe,Ne),qe.add3(B,Z,Z+1,Z+2);for(var ot=0;ot<3;++ot)qe.add(G,Qe);Z+=3,te+=2,U(ct),U(Ne),z(Xe,ct),z(Xe,Ne),qe.add3(B,Z,Z+1,Z+3),qe.add3(B,Z,Z+3,Z+2);for(var ot=0;ot<4;++ot)qe.add(G,it);Z+=4}var Z=D,te=0;if(S)for(var le=0,ye=M;le<ye;++le){var be=k[le*3],Ae=k[le*3+1],Se=k[le*3+2],ie=O[be],oe=O[Ae],L=O[Se];if(ie===oe&&ie===L)++te,qe.add3(B,be,Ae,Se);else if(ie===oe)K(Se,be,Ae,L,ie);else if(ie===L)K(Ae,Se,be,oe,L);else if(oe===L)K(be,Ae,Se,ie,oe);else{te+=2,U(be),z(be,Ae),z(be,Se),J(be,Ae,Se),qe.add3(B,Z,Z+1,Z+3),qe.add3(B,Z,Z+3,Z+2);for(var V=0;V<4;++V)qe.add(G,ie);Z+=4,te+=2,U(Ae),z(Ae,Se),z(Ae,be),J(be,Ae,Se),qe.add3(B,Z,Z+1,Z+3),qe.add3(B,Z,Z+3,Z+2);for(var V=0;V<4;++V)qe.add(G,oe);Z+=4,te+=2,U(Se),z(Se,Ae),z(Se,be),J(be,Ae,Se),qe.add3(B,Z+3,Z+1,Z),qe.add3(B,Z+2,Z+3,Z);for(var V=0;V<4;++V)qe.add(G,L);Z+=4}}else for(var le=0,ye=M;le<ye;++le){var be=k[le*3],Ae=k[le*3+1],Se=k[le*3+2],ie=O[be],oe=O[Ae],L=O[Se];if(ie!==oe||ie!==L){++te,U(be),U(Ae),U(Se),qe.add3(B,Z,Z+1,Z+2);for(var he=oe===L?oe:ie,V=0;V<3;++V)qe.add(G,he);Z+=3}else++te,qe.add3(B,be,Ae,Se)}var we=qe.compact(B),Te=qe.compact(j),ze=qe.compact(Y),Ve=qe.compact(G);return b.vertexCount=Z,b.triangleCount=te,F.update(C,Te),F.update(w,Ve),F.update(x,we),F.update(A,ze),b.meta.originalData={indexBuffer:k,vertexCount:D,triangleCount:M},b}e.uniformTriangleGroup=d,e.Params=E(E({},Et.Params),{doubleSided:I.Boolean(!1,Et.CustomQualityParamInfo),flipSided:I.Boolean(!1,Et.ShadingCategory),flatShaded:I.Boolean(!1,Et.ShadingCategory),ignoreLight:I.Boolean(!1,Et.ShadingCategory),xrayShaded:I.Boolean(!1,Et.ShadingCategory)}),e.Utils={Params:e.Params,createEmpty:r,createValues:p,createValuesSimple:v,updateValues:h,updateBoundingSphere:m,createRenderableState:g,updateRenderableState:y,createPositionIterator:f};function f(b,S){var x=b.vertexCount,C=S.instanceCount.ref.value,w=Lv(),A=w.position,M=b.vertexBuffer.ref.value,D=S.aTransform.ref.value,k=function(R,O){return O<0?_.fromArray(A,M,R*3):_.transformMat4Offset(A,M,D,0,R*3,O*16),w};return Sn(x,C,1,k)}function p(b,S,x,C,w){var A=x.instanceCount,M=x.groupCount,D=f(b,S),k=hs(x,D,C.color),R=tu(A*M),O=Cd(),H=_d(),B=wd(),j={drawCount:b.triangleCount*3,vertexCount:b.vertexCount,groupCount:M,instanceCount:A},Y=Be.clone(b.boundingSphere),G=Yi(Y,S.aTransform.ref.value,A);return E(E(E(E(E(E(E(E({aPosition:b.vertexBuffer,aNormal:b.normalBuffer,aGroup:b.groupBuffer,elements:b.indexBuffer,boundingSphere:F.create(G),invariantBoundingSphere:F.create(Y),uInvariantBoundingSphere:F.create(Ar.ofSphere(Y))},k),R),O),H),B),S),Et.createValues(w,j)),{dDoubleSided:F.create(w.doubleSided),dFlatShaded:F.create(w.flatShaded),dFlipSided:F.create(w.flipSided),dIgnoreLight:F.create(w.ignoreLight),dXrayShaded:F.create(w.xrayShaded),meta:F.create(b.meta)})}function v(b,S,x,C,w){var A=Et.createSimple(x,C,w),M=E(E({},I.getDefaultValues(e.Params)),S);return p(b,A.transform,A.locationIterator,A.theme,M)}function h(b,S){Et.updateValues(b,S),F.updateIfChanged(b.dDoubleSided,S.doubleSided),F.updateIfChanged(b.dFlatShaded,S.flatShaded),F.updateIfChanged(b.dFlipSided,S.flipSided),F.updateIfChanged(b.dIgnoreLight,S.ignoreLight),F.updateIfChanged(b.dXrayShaded,S.xrayShaded)}function m(b,S){var x=Be.clone(S.boundingSphere),C=Yi(x,b.aTransform.ref.value,b.instanceCount.ref.value);Be.equals(C,b.boundingSphere.ref.value)||F.update(b.boundingSphere,C),Be.equals(x,b.invariantBoundingSphere.ref.value)||(F.update(b.invariantBoundingSphere,x),F.update(b.uInvariantBoundingSphere,Ar.fromSphere(b.uInvariantBoundingSphere.ref.value,x)))}function g(b){var S=Et.createRenderableState(b);return y(S,b),S}function y(b,S){Et.updateRenderableState(b,S),b.opaque=b.opaque&&!S.xrayShaded,b.writeDepth=b.opaque}})(Ft||(Ft={}));var Bze={radius:1,detail:0};function Uze(e,t,r){var n=E(E({},Bze),r),i=n.radius,a=n.detail,o=jze(),s=o.vertices,u=o.indices;c(a),K7e(s,i);var l=new Float32Array(s.length);return vee(s,u,l,s.length/3,u.length/3),{vertices:new Float32Array(s),normals:new Float32Array(l),indices:new Uint32Array(u)};function c(f){for(var p=_(),v=_(),h=_(),m=0;m<t.length;m+=3)_.fromArray(p,e,t[m+0]*3),_.fromArray(v,e,t[m+1]*3),_.fromArray(h,e,t[m+2]*3),d(p,v,h,f)}function d(f,p,v,h){for(var m=Math.pow(2,h),g=[],y=0;y<=m;++y){g[y]=[];var b=_();_.lerp(b,f,v,y/m);var S=_();_.lerp(S,p,v,y/m);for(var x=m-y,C=0;C<=x;++C)if(C===0&&y===m)g[y][C]=b;else{var w=_();_.lerp(w,b,S,C/x),g[y][C]=w}}for(var y=0;y<m;++y)for(var C=0;C<2*(m-y)-1;++C){var A=Math.floor(C/2);C%2===0?o.add(g[y][A+1],g[y+1][A],g[y][A]):o.add(g[y][A+1],g[y+1][A+1],g[y+1][A])}}}function jze(){var e=[],t=[],r=new Map;function n(i){var a=i[0].toFixed(5)+"|"+i[1].toFixed(5)+"|"+i[2].toFixed(5),o=r.get(a);return o===void 0&&(o=e.length/3,r.set(a,o),e.push.apply(e,i)),o}return{vertices:e,indices:t,add:function(i,a,o){t.push(n(i),n(a),n(o))}}}var bs=(1+Math.sqrt(5))/2,zze=[-1,bs,0,1,bs,0,-1,-bs,0,1,-bs,0,0,-1,bs,0,1,bs,0,-1,-bs,0,1,-bs,bs,0,-1,bs,0,1,-bs,0,-1,-bs,0,1],Vze=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],W4;function Hze(){return W4||(W4=RE(zze,Vze)),W4}var zee=Hze(),Gze=zee.vertices,qze=zee.indices;function OE(e){return 10*Math.pow(Math.pow(2,e),2)+2}function $ze(e){return Uze(Gze,qze,{detail:e,radius:1})}var oz=new Map,Wze=ue.identity();function Xze(e,t,r){return ue.scaleUniformly(e,ue.fromTranslation(e,t),r)}function Vee(e){var t=oz.get(e);return t===void 0&&(t=$ze(e),oz.set(e,t)),t}function Ni(e,t,r,n){wt.addPrimitive(e,Xze(Wze,t,r),Vee(n))}var sl={radiusTop:1,radiusBottom:1,height:1,radialSegments:8,heightSegments:1,topCap:!1,bottomCap:!1,thetaStart:0,thetaLength:Math.PI*2};function Yze(e){var t=E(E({},sl),e),r=t.radiusTop,n=t.radiusBottom,i=t.height,a=t.radialSegments,o=t.heightSegments,s=t.topCap,u=t.bottomCap,l=t.thetaStart,c=t.thetaLength,d=[],f=[],p=[],v=0,h=[],m=i/2;return g(),s&&r>0&&y(!0),u&&n>0&&y(!1),{vertices:new Float32Array(f),normals:new Float32Array(p),indices:new Uint32Array(d)};function g(){for(var b=_.zero(),S=(n-r)/i,x=0;x<=o;++x){for(var C=[],w=x/o,A=w*(n-r)+r,M=0;M<=a;++M){var D=M/a,k=D*c+l,R=Math.sin(k),O=Math.cos(k);f.push(A*R,-w*i+m,A*O),_.normalize(b,_.set(b,R,S,O)),p.push.apply(p,b),C.push(v++)}h.push(C)}for(var M=0;M<a;++M)for(var x=0;x<o;++x){var H=h[x][M],B=h[x+1][M],j=h[x+1][M+1],Y=h[x][M+1];d.push(H,B,Y),d.push(B,j,Y)}}function y(b){for(var S=b===!0?r:n,x=b===!0?1:-1,C=v,w=1;w<=a;++w)f.push(0,m*x,0),p.push(0,x,0),++v;for(var A=v,w=0;w<=a;++w){var M=w/a,D=M*c+l,k=Math.cos(D),R=Math.sin(D);f.push(S*R,m*x,S*k),p.push(0,x,0),++v}for(var w=0;w<a;++w){var O=C+w,H=A+w;b===!0?d.push(H,H+1,O):d.push(H+1,H,O)}}}var sz=_(),uz=_(),po=_(),ho=_(),tl=_(),pm=_(),Kze={height:1,topCap:!0,bottomCap:!0};function A0(e,t){var r=e.length/3;if(r<3)throw new Error("need at least 3 points to build a prism");var n=E(E({},Kze),t),i=n.height,a=n.topCap,o=n.bottomCap,s=r*2,u=r*4,l=(a?1:0)+(o?1:0);r===3?(s+=l,u+=l*3):r===4?(s+=l*2,u+=l*4):(s+=l*r,u+=l*r*3);var c=E0(s,u),d=i*.5;_.set(sz,0,0,-d),_.set(uz,0,0,d);for(var f=0;f<r;++f){var p=(f+1)%r;_.set(po,e[f*3],e[f*3+1],-d),_.set(ho,e[p*3],e[p*3+1],-d),_.set(tl,e[p*3],e[p*3+1],d),_.set(pm,e[f*3],e[f*3+1],d),c.addQuad(po,ho,tl,pm)}if(r===3)a&&(_.set(po,e[0],e[1],-d),_.set(ho,e[3],e[4],-d),_.set(tl,e[6],e[7],-d),c.add(tl,ho,po)),o&&(_.set(po,e[0],e[1],d),_.set(ho,e[3],e[4],d),_.set(tl,e[6],e[7],d),c.add(po,ho,tl));else if(r===4)a&&(_.set(po,e[0],e[1],-d),_.set(ho,e[3],e[4],-d),_.set(tl,e[6],e[7],-d),_.set(pm,e[9],e[10],-d),c.addQuad(pm,tl,ho,po)),o&&(_.set(po,e[0],e[1],d),_.set(ho,e[3],e[4],d),_.set(tl,e[6],e[7],d),_.set(pm,e[9],e[10],d),c.addQuad(po,ho,tl,pm));else for(var f=0;f<r;++f){var p=(f+1)%r;a&&(_.set(po,e[f*3],e[f*3+1],-d),_.set(ho,e[p*3],e[p*3+1],-d),c.add(sz,ho,po)),o&&(_.set(po,e[f*3],e[f*3+1],d),_.set(ho,e[p*3],e[p*3+1],d),c.add(po,ho,uz))}return c.getPrimitive()}var X4;function Qze(){return X4||(X4=A0(ql(4,!1))),X4}var Y4;function Zze(){return Y4||(Y4=A0(ql(5,!1))),Y4}var K4;function Jze(){return K4||(K4=A0(ql(6,!1))),K4}var Q4;function eVe(){return Q4||(Q4=A0(ql(6,!0))),Q4}var Z4;function tVe(){return Z4||(Z4=A0(ql(7,!1))),Z4}var lz=new Map,cz=_.create(0,1,0),xl=_(),Lx=_(),dz=_(),Ff=ue(),fz=ue(),rVe=_(),pz=ue(),Xm=_(),J4=_();function iw(e,t,r,n,i){return _.setMagnitude(Lx,r,n/2),_.add(dz,t,Lx),i?_.matchDirection(J4,cz,Lx):_.copy(J4,cz),ue.fromScaling(pz,_.set(rVe,1,n,1)),_.makeRotation(fz,J4,Lx),ue.mul(e,fz,pz),ue.setTranslation(e,dz)}var rl=new Int32Array(9);function nVe(e){var t,r,n,i,a,o,s,u,l;return rl[0]=Math.round(1e3*((t=e.radiusTop)!==null&&t!==void 0?t:sl.radiusTop)),rl[1]=Math.round(1e3*((r=e.radiusBottom)!==null&&r!==void 0?r:sl.radiusBottom)),rl[2]=Math.round(1e3*((n=e.height)!==null&&n!==void 0?n:sl.height)),rl[3]=(i=e.radialSegments)!==null&&i!==void 0?i:sl.radialSegments,rl[4]=(a=e.heightSegments)!==null&&a!==void 0?a:sl.heightSegments,rl[5]=((o=e.topCap)!==null&&o!==void 0?o:sl.topCap)?1:0,rl[6]=((s=e.bottomCap)!==null&&s!==void 0?s:sl.bottomCap)?1:0,rl[7]=Math.round(1e3*((u=e.thetaStart)!==null&&u!==void 0?u:sl.thetaStart)),rl[8]=Math.round(1e3*((l=e.thetaLength)!==null&&l!==void 0?l:sl.thetaLength)),Ga(rl)}function qL(e){var t=nVe(e),r=lz.get(t);if(r===void 0){if(e.radialSegments&&e.radialSegments<=4){var n=Math.max(3,e.radialSegments),i=A0(ql(n,!0,e.radiusTop),e);r=zL(i,ue.rotX90)}else r=Yze(e);lz.set(t,r)}return r}function Ua(e,t,r,n,i){var a=_.distance(t,r)*n;_.sub(xl,r,t),iw(Ff,t,xl,a,!0),wt.addPrimitive(e,Ff,qL(i))}function iVe(e,t,r,n,i,a){var o=_.distance(t,r)*n,s=qL(a);_.sub(xl,r,t),_.add(Xm,t,i),iw(Ff,Xm,xl,o,!0),wt.addPrimitive(e,Ff,s),_.sub(Xm,t,i),iw(Ff,Xm,xl,o,!0),wt.addPrimitive(e,Ff,s)}function _1(e,t,r,n,i,a){var o=Math.floor(i/2),s=1/i;if(n<1){var u=n/2/i;n+=i%2===1?u:-u}var l=_.distance(t,r)*n,c=qL(a);_.sub(xl,r,t);for(var d=0;d<o;++d){var f=s*(d*2+1);_.setMagnitude(xl,xl,l*f),_.add(Xm,t,xl),iw(Ff,Xm,xl,l*s,!1),wt.addPrimitive(e,Ff,c)}}var Zn=_(),hz=$n(),nc=_(),nl=_(),jp=_(),Fx=_(),Bo=_.fromArray,aVe=_.triangleNormal,vz=_.copy,Nx=_.transformMat4,mz=_.transformMat3,gz=$n.directionTransform,su=qe.add3,eT=qe.add,wt;(function(e){function t(c,d,f){return c===void 0&&(c=2048),d===void 0&&(d=1024),{currentGroup:-1,vertices:qe.create(Float32Array,3,d,f?f.vertexBuffer.ref.value:c),normals:qe.create(Float32Array,3,d,f?f.normalBuffer.ref.value:c),indices:qe.create(Uint32Array,3,d*3,f?f.indexBuffer.ref.value:c*3),groups:qe.create(Float32Array,1,d,f?f.groupBuffer.ref.value:c),mesh:f}}e.createState=t;function r(c,d,f,p){var v=c.vertices,h=c.normals,m=c.indices,g=c.groups,y=c.currentGroup,b=v.elementCount;su(v,d[0],d[1],d[2]),su(v,f[0],f[1],f[2]),su(v,p[0],p[1],p[2]),aVe(Zn,d,f,p);for(var S=0;S<3;++S)su(h,Zn[0],Zn[1],Zn[2]),eT(g,y);su(m,b,b+1,b+2)}e.addTriangle=r;function n(c,d,f){Bo(jp,d,f[0]*3),Bo(Fx,d,f[1]*3);for(var p=2,v=f.length;p<v;p+=2)vz(nc,jp),vz(nl,Fx),Bo(jp,d,f[p]*3),Bo(Fx,d,f[p+1]*3),r(c,nc,nl,jp),r(c,nl,Fx,jp)}e.addTriangleStrip=n;function i(c,d,f){Bo(nc,d,f[0]*3);for(var p=2,v=f.length;p<v;++p)Bo(nl,d,f[p-1]*3),Bo(jp,d,f[p]*3),r(c,nc,jp,nl)}e.addTriangleFan=i;function a(c,d,f){for(var p=f.vertices,v=f.normals,h=f.indices,m=c.vertices,g=c.normals,y=c.indices,b=c.groups,S=c.currentGroup,x=m.elementCount,C=gz(hz,d),w=0,A=p.length;w<A;w+=3)Nx(Zn,Bo(Zn,p,w),d),su(m,Zn[0],Zn[1],Zn[2]),mz(Zn,Bo(Zn,v,w),C),su(g,Zn[0],Zn[1],Zn[2]),eT(b,S);for(var w=0,A=h.length;w<A;w+=3)su(y,h[w]+x,h[w+1]+x,h[w+2]+x)}e.addPrimitive=a;function o(c,d,f){for(var p=f.vertices,v=f.normals,h=f.indices,m=c.vertices,g=c.normals,y=c.indices,b=c.groups,S=c.currentGroup,x=m.elementCount,C=gz(hz,d),w=0,A=p.length;w<A;w+=3)Nx(Zn,Bo(Zn,p,w),d),su(m,Zn[0],Zn[1],Zn[2]),mz(Zn,Bo(Zn,v,w),C),su(g,-Zn[0],-Zn[1],-Zn[2]),eT(b,S);for(var w=0,A=h.length;w<A;w+=3)su(y,h[w+2]+x,h[w+1]+x,h[w]+x)}e.addPrimitiveFlipped=o;function s(c,d,f,p,v,h){for(var m=f.vertices,g=f.edges,y={radiusTop:p,radiusBottom:p,radialSegments:h},b=0,S=g.length;b<S;b+=2)Bo(nc,m,g[b]*3),Bo(nl,m,g[b+1]*3),Nx(nc,nc,d),Nx(nl,nl,d),Ni(c,nc,p,v),Ni(c,nl,p,v),Ua(c,nc,nl,1,y)}e.addCage=s;function u(c,d,f){a(c,d,{vertices:f.vertexBuffer.ref.value.subarray(0,f.vertexCount*3),normals:f.normalBuffer.ref.value.subarray(0,f.vertexCount*3),indices:f.indexBuffer.ref.value.subarray(0,f.triangleCount*3)})}e.addMesh=u;function l(c){var d=c.vertices,f=c.normals,p=c.indices,v=c.groups,h=c.mesh,m=qe.compact(d,!0),g=qe.compact(p,!0),y=qe.compact(f,!0),b=qe.compact(v,!0);return Ft.create(m,g,y,b,c.vertices.elementCount,c.indices.elementCount,h)}e.getMesh=l})(wt||(wt={}));var oVe=1,sVe="Assigns sizes as defined by the shape object.",Hee={};function uVe(e){return Hee}function $L(e,t){return{factory:$L,granularity:"groupInstance",size:function(r){return Ja.isLocation(r)?r.shape.getSize(r.group,r.instance):oVe},props:t,description:sVe}}var lVe={name:"shape-group",label:"Shape Group",category:"",factory:$L,getParams:uVe,defaultValues:I.getDefaultValues(Hee),isApplicable:function(e){return!!e.shape}},cVe=at(13421772),dVe="Assigns colors as defined by the shape object.",Gee={};function fVe(e){return Gee}function WL(e,t){return{factory:WL,granularity:"groupInstance",color:function(r){return Ja.isLocation(r)?r.shape.getColor(r.group,r.instance):cVe},props:t,description:dVe}}var pVe={name:"shape-group",label:"Shape Group",category:"Miscellaneous",factory:WL,getParams:fVe,defaultValues:I.getDefaultValues(Gee),isApplicable:function(e){return!!e.shape}},qee=$a();function Id(e,t,r){return{id:qee(),materialId:e.materialId,values:t,state:r,render:function(n,i){t.uAlpha&&t.alpha&&F.updateIfChanged(t.uAlpha,Ba(t.alpha.ref.value*r.alphaFactor,0,1)),e.render(n,i)},getProgram:function(n){return e.getProgram(n)},update:function(){return e.update()},dispose:function(){return e.destroy()}}}function Zi(e,t){return{id:qee(),values:t,render:function(){return e.render("compute")},update:function(){return e.update()},dispose:function(){return e.destroy()}}}var hVe=$a();function vVe(e,t){var r=e.gl;switch(t){case"points":return r.POINTS;case"lines":return r.LINES;case"line-strip":return r.LINE_STRIP;case"line-loop":return r.LINE_LOOP;case"triangles":return r.TRIANGLES;case"triangle-strip":return r.TRIANGLE_STRIP;case"triangle-fan":return r.TRIANGLE_FAN}}var mVe={colorBlended:"",colorWboit:"",pickObject:"",pickInstance:"",pickGroup:"",depth:""},gVe=Object.keys(mVe),yVe={compute:""},bVe=Object.keys(yVe);function yz(e,t,r,n,i){return r=E(E({},r),{dRenderVariant:F.create(t)}),i.dRenderVariant===void 0&&Object.defineProperty(i,"dRenderVariant",{value:Qt("string")}),e.resources.program(r,n,i)}function xVe(){return{attributes:!1,defines:!1,elements:!1,textures:!1}}function SVe(e){e.attributes=!1,e.defines=!1,e.elements=!1,e.textures=!1}function Md(e,t,r,n,i,a){return $ee(e,t,r,n,i,a,gVe)}function Ji(e,t,r,n,i,a){return a===void 0&&(a=-1),$ee(e,t,r,n,i,a,bVe)}function $ee(e,t,r,n,i,a,o){var s=hVe(),u=e.stats,l=e.state,c=e.resources,d=e.extensions,f=d.instancedArrays,p=d.vertexArrayObject;if(i.uVertexCount){var v=i.uVertexCount.ref.value;i.aVertex=F.create(Ys(new Float32Array(v))),n.aVertex=qr("float32",1,0)}for(var h=O9e(n,i),m=h.attributeValues,g=h.defineValues,y=h.textureValues,b=h.uniformValues,S=h.materialUniformValues,x=h.bufferedUniformValues,C=Object.entries(b),w=Object.entries(S),A=Object.entries(x),M=Object.entries(yje(x)),D=Object.entries(g),k=L9e(i),R=vVe(e,t),O={},H=0,B=o;H<B.length;H++){var j=B[H];O[j]=yz(e,j,g,r,n)}var Y=Tze(e,n,y),G=Eje(e,n,m),$,q=i.elements;q&&q.ref.value&&($=c.elements(q.ref.value));for(var ee={},fe=0,W=o;fe<W.length;fe++){var j=W[fe];ee[j]=p?c.vertexArray(O[j],G,$):null}var X=i.drawCount.ref.value,U=i.instanceCount.ref.value;u.drawCount+=X,u.instanceCount+=U,u.instancedDrawCount+=U*X;var z=xVe(),J=!1,K=-1;return{id:s,materialId:a,getProgram:function(Z){return O[Z]},render:function(Z,te){if(!(X===0||U===0||e.isContextLost)){var le=O[Z];if(le.id===K&&l.currentRenderItemId===s)le.setUniforms(C),te&&te.length>0?(le.bindTextures(te,0),le.bindTextures(Y,te.length)):le.bindTextures(Y,0);else{var ye=ee[Z];(le.id!==l.currentProgramId||le.id!==K||a===-1||a!==l.currentMaterialId)&&(le.id!==l.currentProgramId&&le.use(),le.setUniforms(w),l.currentMaterialId=a,K=le.id),le.setUniforms(C),le.setUniforms(M),te&&te.length>0?(le.bindTextures(te,0),le.bindTextures(Y,te.length)):le.bindTextures(Y,0),ye?(ye.bind(),$&&$.bind()):($&&$.bind(),le.bindAttributes(G)),l.currentRenderItemId=s}if(kr)try{GL(e.gl)}catch(be){throw new Error("Framebuffer error rendering item id "+s+": '"+be+"'")}if($?f.drawElementsInstanced(R,X,$._dataType,0,U):f.drawArraysInstanced(R,0,X,U),kr)try{kee(e.gl)}catch(be){throw new Error("Draw error rendering item id "+s+": '"+be+"'")}}},update:function(){if(SVe(z),i.aVertex){var Z=i.uVertexCount.ref.value;i.aVertex.ref.value.length<Z&&F.update(i.aVertex,Ys(new Float32Array(Z)))}for(var te=0,le=D.length;te<le;++te){var ye=D[te],be=ye[0],Ae=ye[1];Ae.ref.version!==k[be]&&(z.defines=!0,k[be]=Ae.ref.version)}if(z.defines)for(var Se=0,ie=o;Se<ie.length;Se++){var be=ie[Se];O[be].destroy(),O[be]=yz(e,be,g,r,n)}i.drawCount.ref.version!==k.drawCount&&(u.drawCount+=i.drawCount.ref.value-X,u.instancedDrawCount+=U*i.drawCount.ref.value-U*X,X=i.drawCount.ref.value,k.drawCount=i.drawCount.ref.version),i.instanceCount.ref.version!==k.instanceCount&&(u.instanceCount+=i.instanceCount.ref.value-U,u.instancedDrawCount+=i.instanceCount.ref.value*X-U*X,U=i.instanceCount.ref.value,k.instanceCount=i.instanceCount.ref.version);for(var te=0,le=G.length;te<le;++te){var oe=G[te],be=oe[0],L=oe[1],Ae=m[be];if(Ae.ref.version!==k[be]){if(L.length>=Ae.ref.value.length)L.updateSubData(Ae.ref.value,0,L.length);else{L.destroy();var V=n[be],he=V.itemSize,we=V.divisor;G[te][1]=c.attribute(Ae.ref.value,he,we),z.attributes=!0}k[be]=Ae.ref.version}}if($&&i.elements.ref.version!==k.elements&&($.length>=i.elements.ref.value.length?$.updateSubData(i.elements.ref.value,0,$.length):($.destroy(),$=c.elements(i.elements.ref.value),z.elements=!0),k.elements=i.elements.ref.version),z.attributes||z.defines||z.elements)for(var Te=0,ze=o;Te<ze.length;Te++){var be=ze[Te],Ve=ee[be];Ve&&Ve.destroy(),ee[be]=p?c.vertexArray(O[be],G,$):null}for(var te=0,le=Y.length;te<le;++te){var Xe=Y[te],be=Xe[0],ct=Xe[1],Ae=y[be];Ae.ref.version!==k[be]&&(n[be].kind!=="texture"?(ct.load(Ae.ref.value),z.textures=!0):Y[te][1]=Ae.ref.value,k[be]=Ae.ref.version)}for(var te=0,le=A.length;te<le;++te){var Ne=A[te],be=Ne[0],Qe=Ne[1];Qe.ref.version!==k[be]&&(F.update(M[te][1],cp(Qe.ref.value)),k[be]=Qe.ref.version)}return z},destroy:function(){if(!J){for(var Z=0,te=o;Z<te.length;Z++){var le=te[Z];O[le].destroy();var ye=ee[le];ye&&ye.destroy()}Y.forEach(function(be){var Ae=be[0],Se=be[1];n[Ae].kind!=="texture"&&Se.destroy()}),G.forEach(function(be){be[0];var Ae=be[1];return Ae.destroy()}),$&&$.destroy(),u.drawCount-=X,u.instanceCount-=U,u.instancedDrawCount-=U*X,J=!0}}}}var CVe=E(E({},Td),{aPosition:qr("float32",3,0),elements:Nv("uint32"),uColor:Ge("v3"),uColorTexDim:Ge("v2"),tColor:ur("image-uint8","rgb","ubyte","nearest"),dColorType:Qt("string",["uniform","attribute","instance","group","groupInstance","vertex","vertexInstance"]),uIsoValue:Ge("v2"),uBboxMin:Ge("v3"),uBboxMax:Ge("v3"),uBboxSize:Ge("v3"),uMaxSteps:Ge("i"),uStepScale:Ge("f"),uJumpLength:Ge("f"),uTransform:Ge("m4"),uGridDim:Ge("v3"),dRenderMode:Qt("string",["isosurface","volume"]),dSingleLayer:Qt("boolean"),tTransferTex:ur("image-uint8","rgba","ubyte","linear"),uTransferScale:Ge("f"),dGridTexType:Qt("string",["2d","3d"]),uGridTexDim:Ge("v3"),tGridTex:ur("texture","rgba","ubyte","linear"),uGridStats:Ge("v4"),uCellDim:Ge("v3"),uCartnToUnit:Ge("m4"),uUnitToCartn:Ge("m4"),dPackedGroup:Qt("boolean"),dDoubleSided:Qt("boolean"),dFlipSided:Qt("boolean"),dFlatShaded:Qt("boolean"),dIgnoreLight:Qt("boolean"),dXrayShaded:Qt("boolean")});function _Ve(e,t,r,n,i){var a=E(E(E(E({},Ed),Ad),Pd),CVe);e.isWebGL2||(a.uMaxSteps=Qt("number"));var o={uObjectId:F.create(t)},s=ZUe,u=Md(e,"triangles",s,a,E(E({},r),o),i);return Id(u,r,n)}var wVe=E(E({},Td),{aGroup:qr("float32",1,0),aPosition:qr("float32",3,0),aNormal:qr("float32",3,0),elements:Nv("uint32"),dFlatShaded:Qt("boolean"),dDoubleSided:Qt("boolean"),dFlipSided:Qt("boolean"),dIgnoreLight:Qt("boolean"),dXrayShaded:Qt("boolean"),meta:_i("unknown")});function EVe(e,t,r,n,i){var a=E(E(E(E({},Ed),Ad),Pd),wVe),o={uObjectId:F.create(t)},s=Iee,u=Md(e,"triangles",s,a,E(E({},r),o),i);return Id(u,r,n)}var AVe=E(E(E({},Td),l2),{aGroup:qr("float32",1,0),aPosition:qr("float32",3,0),dPointSizeAttenuation:Qt("boolean"),dPointFilledCircle:Qt("boolean"),uPointEdgeBleach:Ge("f")});function PVe(e,t,r,n,i){var a=E(E(E(E({},Ed),Ad),Pd),AVe),o={uObjectId:F.create(t)},s=WUe,u=Md(e,"points",s,a,E(E({},r),o),i);return Id(u,r,n)}var TVe=E(E(E({},Td),l2),{aGroup:qr("float32",1,0),aMapping:qr("float32",2,0),aStart:qr("float32",3,0),aEnd:qr("float32",3,0),elements:Nv("uint32"),dLineSizeAttenuation:Qt("boolean"),dDoubleSided:Qt("boolean"),dFlipSided:Qt("boolean")});function IVe(e,t,r,n,i){var a=E(E(E(E({},Ed),Ad),Pd),TVe),o={uObjectId:F.create(t)},s=QUe,u=Md(e,"triangles",s,a,E(E({},r),o),i);return Id(u,r,n)}var MVe=E(E(E({},Td),l2),{aGroup:qr("float32",1,0),aPosition:qr("float32",3,0),aMapping:qr("float32",2,0),elements:Nv("uint32"),padding:_i("number"),dDoubleSided:Qt("boolean"),dIgnoreLight:Qt("boolean"),dXrayShaded:Qt("boolean")});function DVe(e,t,r,n,i){var a=E(E(E(E({},Ed),Ad),Pd),MVe),o={uObjectId:F.create(t)},s=XUe,u=Md(e,"triangles",s,a,E(E({},r),o),i);return Id(u,r,n)}var RVe=E(E(E({},Td),l2),{aGroup:qr("float32",1,0),aPosition:qr("float32",3,0),aMapping:qr("float32",2,0),aDepth:qr("float32",1,0),elements:Nv("uint32"),aTexCoord:qr("float32",2,0),tFont:ur("image-uint8","alpha","ubyte","linear"),padding:_i("number"),uBorderWidth:Ge("f"),uBorderColor:Ge("v3"),uOffsetX:Ge("f"),uOffsetY:Ge("f"),uOffsetZ:Ge("f"),uBackgroundColor:Ge("v3"),uBackgroundOpacity:Ge("f")});function kVe(e,t,r,n,i){var a=E(E(E(E({},Ed),Ad),Pd),RVe),o={uObjectId:F.create(t)},s=KUe,u=Md(e,"triangles",s,a,E(E({},r),o),i);return Id(u,r,n)}var OVe=E(E({},Td),{uGeoTexDim:Ge("v2","buffered"),tPosition:ur("texture","rgb","float","nearest"),tGroup:ur("texture","alpha","float","nearest"),tNormal:ur("texture","rgb","float","nearest"),dFlatShaded:Qt("boolean"),dDoubleSided:Qt("boolean"),dFlipSided:Qt("boolean"),dIgnoreLight:Qt("boolean"),dXrayShaded:Qt("boolean"),dGeoTexture:Qt("boolean")});function LVe(e,t,r,n,i){var a=E(E(E(E({},Ed),Ad),Pd),OVe),o={uObjectId:F.create(t)},s=Iee,u=Md(e,"triangles",s,a,E(E({},r),o),i);return Id(u,r,n)}var FVe=E(E({},Td),{aGroup:qr("float32",1,0),aPosition:qr("float32",3,0),aUv:qr("float32",2,0),elements:Nv("uint32"),uImageTexDim:Ge("v2"),tImageTex:ur("image-uint8","rgba","ubyte","nearest"),tGroupTex:ur("image-uint8","rgba","ubyte","nearest"),dInterpolation:Qt("string",V9e)});function NVe(e,t,r,n,i){var a=E(E(E(E({},Ed),Ad),Pd),FVe),o={uObjectId:F.create(t)},s=JUe,u=Md(e,"triangles",s,a,E(E({},r),o),i);return Id(u,r,n)}var BVe=E(E(E({},Td),l2),{aGroup:qr("float32",1,0),aStart:qr("float32",3,0),aEnd:qr("float32",3,0),aMapping:qr("float32",3,0),aScale:qr("float32",1,0),aCap:qr("float32",1,0),elements:Nv("uint32"),padding:_i("number"),dDoubleSided:Qt("boolean"),dIgnoreLight:Qt("boolean"),dXrayShaded:Qt("boolean")});function UVe(e,t,r,n,i){var a=E(E(E(E({},Ed),Ad),Pd),BVe),o={uObjectId:F.create(t)},s=YUe,u=Md(e,"triangles",s,a,E(E({},r),o),i);return Id(u,r,n)}var jVe=$a(0,2147483647),Dd=$a(0,2147483647);function P0(e,t,r,n){return{id:jVe(),type:e,values:t,state:r,materialId:n}}function zVe(e,t){switch(t.type){case"mesh":return EVe(e,t.id,t.values,t.state,t.materialId);case"points":return PVe(e,t.id,t.values,t.state,t.materialId);case"spheres":return DVe(e,t.id,t.values,t.state,t.materialId);case"cylinders":return UVe(e,t.id,t.values,t.state,t.materialId);case"text":return kVe(e,t.id,t.values,t.state,t.materialId);case"lines":return IVe(e,t.id,t.values,t.state,t.materialId);case"direct-volume":return _Ve(e,t.id,t.values,t.state,t.materialId);case"image":return NVe(e,t.id,t.values,t.state,t.materialId);case"texture-mesh":return LVe(e,t.id,t.values,t.state,t.materialId)}throw new Error("unsupported type")}var Fr;(function(e){function t(c,d,f,p,v,h,m){return{id:mn.create22(),name:c,sourceData:d,geometry:f,transforms:m||[ue.identity()],get groupCount(){return la.getGroupCount(f)},getColor:p,getSize:v,getLabel:h}}e.create=t;function r(c){return{color:WL({shape:c},{}),size:$L({shape:c},{})}}e.getTheme=r;function n(c){var d=c.transforms.length,f=Ja.Location(c),p=function(v,h){return f.group=v,f.instance=h,f};return Sn(c.groupCount,d,1,p)}e.groupIterator=n;function i(c,d){for(var f=d&&d.aTransform.ref.value.length>=c.length*16?d.aTransform.ref.value:new Float32Array(c.length*16),p=0,v=c.length;p<v;++p)ue.toArray(c[p],f,p*16);return yL(f,c.length,d)}e.createTransform=i;function a(c,d){var f=e.getTheme(c),p=la.getUtils(c.geometry),v=Dd(),h=n(c),m=e.createTransform(c.transforms),g=p.createValues(c.geometry,m,h,f,d),y=p.createRenderableState(d);return P0(c.geometry.kind,g,y,v)}e.createRenderObject=a;function o(c){return{kind:"shape-loci",shape:c}}e.Loci=o;function s(c){return!!c&&c.kind==="shape-loci"}e.isLoci=s;function u(c,d){return c.shape===d.shape}e.areLociEqual=u;function l(c){return c.shape.groupCount===0}e.isLociEmpty=l})(Fr||(Fr={}));var Ja;(function(e){function t(p,v,h){return v===void 0&&(v=0),h===void 0&&(h=0),{kind:"group-location",shape:p,group:v,instance:h}}e.Location=t;function r(p){return!!p&&p.kind==="group-location"}e.isLocation=r;function n(p,v){return{kind:"group-loci",shape:p,groups:v}}e.Loci=n;function i(p){return!!p&&p.kind==="group-loci"}e.isLoci=i;function a(p,v){if(p.shape!==v.shape||p.groups.length!==v.groups.length)return!1;for(var h=0,m=p.groups.length;h<m;++h){var g=p.groups[h],y=g.ids,b=g.instance,S=v.groups[h],x=S.ids,C=S.instance;if(b!==C||!Le.areEqual(y,x))return!1}return!0}e.areLociEqual=a;function o(p){return s(p)===0}e.isLociEmpty=o;function s(p){for(var v=0,h=0,m=p.groups;h<m.length;h++){var g=m[h];v+=Le.size(g.ids)}return v}e.size=s;var u=new rd,l=_.zero();function c(p,v,h,m){for(var g=v.indices,y=v.offsets,b=function(M,D){Le.forEach(M,function(k){for(var R=y[k],O=y[k+1];R<O;++R)_.fromArray(l,h,g[R]*3),_.transformMat4(l,l,m[D]),u.includeStep(l)})},S=0,x=p;S<x.length;S++){var C=x[S],w=C.ids,A=C.instance;b(w,A)}}function d(p,v,h,m){for(var g=v.indices,y=v.offsets,b=function(M,D){Le.forEach(M,function(k){for(var R=y[k],O=y[k+1];R<O;++R)_.fromArray(l,h,g[R]*3),_.transformMat4(l,l,m[D]),u.radiusStep(l)})},S=0,x=p;S<x.length;S++){var C=x[S],w=C.ids,A=C.instance;b(w,A)}}function f(p,v){v||(v=Be()),u.reset();var h=0,m=p.shape,g=m.geometry,y=m.transforms;if(g.kind==="mesh"||g.kind==="points"){var b=g.kind==="mesh"?g.vertexBuffer.ref.value:g.centerBuffer.ref.value;c(p.groups,g.groupMapping,b,y),u.finishedIncludeStep(),d(p.groups,g.groupMapping,b,y)}else if(g.kind==="lines"){var S=g.startBuffer.ref.value,x=g.endBuffer.ref.value;c(p.groups,g.groupMapping,S,y),c(p.groups,g.groupMapping,x,y),u.finishedIncludeStep(),d(p.groups,g.groupMapping,S,y),d(p.groups,g.groupMapping,x,y)}else if(g.kind==="spheres"||g.kind==="text"){var b=g.centerBuffer.ref.value;c(p.groups,g.groupMapping,b,y),u.finishedIncludeStep(),d(p.groups,g.groupMapping,b,y);for(var C=function(O,H){Le.forEach(O,function(B){var j=p.shape.getSize(B,H);h<j&&(h=j)})},w=0,A=p.groups;w<A.length;w++){var M=A[w],D=M.ids,k=M.instance;C(D,k)}}else return Be.copy(v,g.boundingSphere);return _.copy(v.center,u.center),v.radius=Math.sqrt(u.radiusSq),Be.expand(v,v,h),v}e.getBoundingSphere=f})(Ja||(Ja={}));function Wee(e){var t=e&&e.getElement("vertex"),r=e&&e.getElement("material"),n={group:"",vRed:"",vGreen:"",vBlue:"",mRed:"",mGreen:"",mBlue:""},i=[["",""]],a=[["",""]];if(t){for(var o=0,s=t.propertyNames.length;o<s;++o){var u=t.propertyNames[o],l=t.propertyTypes[o];(l==="uchar"||l==="uint8"||l==="ushort"||l==="uint16"||l==="uint"||l==="uint32"||l==="int")&&i.push([u,u]),(l==="uchar"||l==="uint8")&&a.push([u,u])}t.propertyNames.includes("atomid")?n.group="atomid":t.propertyNames.includes("material_index")&&(n.group="material_index"),t.propertyNames.includes("red")&&(n.vRed="red"),t.propertyNames.includes("green")&&(n.vGreen="green"),t.propertyNames.includes("blue")&&(n.vBlue="blue")}var c=[["",""]];if(r){for(var o=0,s=r.propertyNames.length;o<s;++o){var d=r.propertyNames[o],l=r.propertyTypes[o];(l==="uchar"||l==="uint8")&&c.push([d,d])}r.propertyNames.includes("red")&&(n.mRed="red"),r.propertyNames.includes("green")&&(n.mGreen="green"),r.propertyNames.includes("blue")&&(n.mBlue="blue")}var f=n.vRed&&n.vGreen&&n.vBlue?"vertex":n.mRed&&n.mGreen&&n.mBlue?"material":"uniform";return E(E({},Ft.Params),{coloring:I.MappedStatic(f,{vertex:I.Group({red:I.Select(n.vRed,a,{label:"Red Property"}),green:I.Select(n.vGreen,a,{label:"Green Property"}),blue:I.Select(n.vBlue,a,{label:"Blue Property"})},{isFlat:!0}),material:I.Group({red:I.Select(n.mRed,c,{label:"Red Property"}),green:I.Select(n.mGreen,c,{label:"Green Property"}),blue:I.Select(n.mBlue,c,{label:"Blue Property"})},{isFlat:!0}),uniform:I.Group({color:I.Color(fr.grey)},{isFlat:!0})}),grouping:I.MappedStatic(n.group?"vertex":"none",{vertex:I.Group({group:I.Select(n.group,i,{label:"Group Property"})},{isFlat:!0}),none:I.Group({})})})}var bz=Wee();function VVe(e,t,r,n,i){var a=r.vertices,o=r.normals,s=r.groups,u=n.getProperty("x"),l=n.getProperty("y"),c=n.getProperty("z");if(!u||!l||!c)throw new Error("missing coordinate properties");for(var d=n.getProperty("nx"),f=n.getProperty("ny"),p=n.getProperty("nz"),v=!!d&&!!f&&!!p,h=e;h<t;++h)qe.add3(a,u.value(h),l.value(h),c.value(h)),v&&qe.add3(o,d.value(h),f.value(h),p.value(h)),qe.add(s,i[h])}function HVe(e,t,r,n){for(var i=r.indices,a=e;a<t;++a){var o=n.value(a),s=o.entries,u=o.count;u===3?qe.add3(i,s[0],s[1],s[2]):u===4&&(qe.add3(i,s[2],s[1],s[0]),qe.add3(i,s[2],s[0],s[3]))}}function GVe(e,t,r,n,i){return ce(this,void 0,void 0,function(){var a,o,s,u,l,c,d,f,p,v,h,v,h,m;return de(this,function(g){switch(g.label){case 0:if(a=wt.createState(t.rowCount,t.rowCount/4,i),o=t.getProperty("x"),s=t.getProperty("y"),u=t.getProperty("z"),!o||!s||!u)throw new Error("missing coordinate properties");l=t.getProperty("nx"),c=t.getProperty("ny"),d=t.getProperty("nz"),f=!!l&&!!c&&!!d,p=1e5,v=0,h=t.rowCount,g.label=1;case 1:return v<h?(VVe(v,Math.min(v+p,h),a,t,n),e.shouldUpdate?[4,e.update({message:"adding ply mesh vertices",current:v,max:h})]:[3,3]):[3,4];case 2:g.sent(),g.label=3;case 3:return v+=p,[3,1];case 4:v=0,h=r.rowCount,g.label=5;case 5:return v<h?(HVe(v,Math.min(v+p,h),a,r),e.shouldUpdate?[4,e.update({message:"adding ply mesh faces",current:v,max:h})]:[3,7]):[3,8];case 6:g.sent(),g.label=7;case 7:return v+=p,[3,5];case 8:return m=wt.getMesh(a),f||Ft.computeNormals(m),[2,m]}})})}var ic=ve.Schema.int;function qVe(e,t){for(var r=t.grouping,n=e.rowCount,i=r.name==="vertex"?e.getProperty(r.params.group):void 0,a=r.name==="vertex"?Zo(r.params.group):"Vertex",o=i?i.toArray({array:Uint32Array}):Ys(new Uint32Array(n)),s=i?Nl(o):n-1,u=new Uint32Array(s+1),l=0,c=o.length;l<c;++l)u[o[l]]=l;return{ids:o,map:u,label:a}}function xz(e,t,r){var n=r.coloring,i=e.rowCount,a,o,s;if(n.name==="vertex")a=e.getProperty(n.params.red)||ve.ofConst(127,i,ic),o=e.getProperty(n.params.green)||ve.ofConst(127,i,ic),s=e.getProperty(n.params.blue)||ve.ofConst(127,i,ic);else if(n.name==="material")a=t&&t.getProperty(n.params.red)||ve.ofConst(127,i,ic),o=t&&t.getProperty(n.params.green)||ve.ofConst(127,i,ic),s=t&&t.getProperty(n.params.blue)||ve.ofConst(127,i,ic);else{var u=at.toRgb(n.params.color),l=u[0],c=u[1],d=u[2];a=ve.ofConst(l,i,ic),o=ve.ofConst(c,i,ic),s=ve.ofConst(d,i,ic)}return{kind:n.name,red:a,green:o,blue:s}}function Sz(e,t,r,n){var i=r.kind,a=r.red,o=r.green,s=r.blue,u=n.ids,l=n.map,c=n.label;return Fr.create("ply-mesh",e,t,function(d){var f=i==="material"?d:l[d];return at.fromRgb(a.value(f),o.value(f),s.value(f))},function(){return 1},function(d){return c+" "+u[d]})}function $Ve(){var e=this,t,r,n,i,a,o,s=function(u,l,c,d){return ce(e,void 0,void 0,function(){var f,p,v,h,m;return de(this,function(g){switch(g.label){case 0:if(f=l.getElement("vertex"),!f)throw new Error("missing vertex element");if(p=l.getElement("face"),!p)throw new Error("missing face element");return v=l.getElement("material"),h=!1,m=!1,(!t||t!==l)&&(h=!0),(!r||!I.isParamEqual(bz.grouping,r.grouping,c.grouping))&&(h=!0),(!r||!I.isParamEqual(bz.coloring,r.coloring,c.coloring))&&(m=!0),h?(a=xz(f,v,c),o=qVe(f,c),[4,GVe(u,f,p,o.ids,d&&d.geometry)]):[3,2];case 1:return i=g.sent(),n=Sz(l,i,a,o),[3,3];case 2:m&&(a=xz(f,v,c),n=Sz(l,i,a,o)),g.label=3;case 3:return t=l,r=cp(c),[2,n]}})})};return s}function WVe(e,t){var r=this;return $e.create("Shape Provider",function(n){return ce(r,void 0,void 0,function(){return de(this,function(i){return[2,{label:"Mesh",data:e,params:Wee(e),getShape:$Ve(),geometryUtils:Ft.Utils}]})})})}function Vh(){return Vh.empty()}(function(e){function t(i,a){return{size:i,anglesInRadians:a}}e.create=t;function r(){return t(_(),_())}e.empty=r;function n(i,a,o){var s=_.magnitude(i),u=_.magnitude(a),l=_.magnitude(o),c=Math.acos(_.dot(a,o)/(u*l)),d=Math.acos(_.dot(i,o)/(s*l)),f=Math.acos(_.dot(i,a)/(s*u));return s<=0||u<=0||l<=0||c>=Math.PI||d>=Math.PI||f>=Math.PI?r():t(_.create(s,u,l),_.create(c,d,f))}e.fromBasis=n})(Vh||(Vh={}));var XVe=20.45482949774598;function YVe(e){var t=this;return $e.create("Parse DCD",function(r){return ce(t,void 0,void 0,function(){var n,i,a,o,s,u,l,c,d;return de(this,function(f){switch(f.label){case 0:return[4,r.update("Converting to coordinates")];case 1:for(f.sent(),n=e.header,i=n.DELTA?Sf(n.DELTA*XVe,"ps"):Sf(1,"step"),a=n.ISTART>=1?Sf((n.ISTART-1)*i.value,i.unit):Sf(0,i.unit),o=[],s=0,u=e.frames.length;s<u;++s)l=e.frames[s],c={elementCount:l.elementCount,time:Sf(a.value+i.value*s,i.unit),x:l.x,y:l.y,z:l.z,xyzOrdering:{isIdentity:!0}},l.cell&&(d=l.cell,d[1]>=-1&&d[1]<=1&&d[3]>=-1&&d[3]<=1&&d[4]>=-1&&d[4]<=1?c.cell=Vh.create(_.create(d[0],d[2],d[5]),_.create(Kr(90-Math.asin(d[1])*90/h1),Kr(90-Math.asin(d[3])*90/h1),Kr(90-Math.asin(d[4])*90/h1))):d[0]<0||d[1]<0||d[2]<0||d[3]<0||d[4]<0||d[5]<0||d[3]>180||d[4]>180||d[5]>180?c.cell=Vh.fromBasis(_.create(d[0],d[1],d[3]),_.create(d[1],d[2],d[4]),_.create(d[3],d[4],d[5])):c.cell=Vh.create(_.create(d[0],d[2],d[5]),_.create(Kr(yn(d[1],0,xn)?90:d[1]),Kr(yn(d[3],0,xn)?90:d[3]),Kr(yn(d[4],0,xn)?90:d[4])))),o.push(c);return[2,Sb.create(o,i,a)]}})})})}function aw(e,t,r,n){for(var i=r,a=n-1,o=t.charCodeAt(i);(o===32||o>=48&&o<=57)&&i<=a;)o=t.charCodeAt(++i);for(o=t.charCodeAt(a);(o===32||o>=48&&o<=57)&&a>=i;)o=t.charCodeAt(--a);if(++a,i===a||i+1===a)return pt.add(e,i,a);if(o=t.charCodeAt(i),i+2===a){var s=t.charCodeAt(i+1);if((o===78||o===110)&&(s===65||s===97)||(o===67||o===99)&&(s===76||s===108)||(o===70||o===102)&&(s===69||s===101)||(o===83||o===115)&&(s===73||s===105)||(o===66||o===98)&&(s===82||s===114)||(o===65||o===97)&&(s===83||s===115))return pt.add(e,i,i+2)}if(o===67||o===99||o===72||o===104||o===78||o===110||o===79||o===111||o===80||o===112||o===83||o===115)return pt.add(e,i,i+1);pt.add(e,i,i)}var KVe=/^[\s\d]+|[\s\d]+$/g;function LE(e){e=e.replace(KVe,"").toUpperCase();var t=e.length;if(t===0||t===1||t===2&&(e==="NA"||e==="CL"||e==="FE"||e==="SI"||e==="BR"||e==="AS"))return e;if(t===3){if(e==="SOD")return"NA";if(e==="POT")return"K";if(e==="CES")return"CS";if(e==="CAL")return"CA";if(e==="CLA")return"CL"}var r=e[0];return r==="C"||r==="H"||r==="N"||r==="O"||r==="P"||r==="S"?r:""}var QVe=[new Set(["CA"]),new Set(["C"]),new Set(["N"])],ZVe=[new Set(["P","O3'","O3*"]),new Set(["C4'","C4*"]),new Set(["O2'","O2*","F2'","F2*"])],JVe=[new Set(["P","O3'","O3*"]),new Set(["C3'","C3*"]),new Set(["O2'","O2*","F2'","F2*"])],eHe=new Set(["FMN","NCN","FNS","FMA"]),Cz=function(){var e=new Map,t=[{id:"HIS",name:"HISTIDINE",type:"L-peptide linking"},{id:"ARG",name:"ARGININE",type:"L-peptide linking"},{id:"LYS",name:"LYSINE",type:"L-peptide linking"},{id:"ILE",name:"ISOLEUCINE",type:"L-peptide linking"},{id:"PHE",name:"PHENYLALANINE",type:"L-peptide linking"},{id:"LEU",name:"LEUCINE",type:"L-peptide linking"},{id:"TRP",name:"TRYPTOPHAN",type:"L-peptide linking"},{id:"ALA",name:"ALANINE",type:"L-peptide linking"},{id:"MET",name:"METHIONINE",type:"L-peptide linking"},{id:"CYS",name:"CYSTEINE",type:"L-peptide linking"},{id:"ASN",name:"ASPARAGINE",type:"L-peptide linking"},{id:"VAL",name:"VALINE",type:"L-peptide linking"},{id:"GLY",name:"GLYCINE",type:"peptide linking"},{id:"SER",name:"SERINE",type:"L-peptide linking"},{id:"GLN",name:"GLUTAMINE",type:"L-peptide linking"},{id:"TYR",name:"TYROSINE",type:"L-peptide linking"},{id:"ASP",name:"ASPARTIC ACID",type:"L-peptide linking"},{id:"GLU",name:"GLUTAMIC ACID",type:"L-peptide linking"},{id:"THR",name:"THREONINE",type:"L-peptide linking"},{id:"PRO",name:"PROLINE",type:"L-peptide linking"},{id:"SEC",name:"SELENOCYSTEINE",type:"L-peptide linking"},{id:"PYL",name:"PYRROLYSINE",type:"L-peptide linking"},{id:"MSE",name:"SELENOMETHIONINE",type:"L-peptide linking"},{id:"SEP",name:"PHOSPHOSERINE",type:"L-peptide linking"},{id:"TPO",name:"PHOSPHOTHREONINE",type:"L-peptide linking"},{id:"PTR",name:"O-PHOSPHOTYROSINE",type:"L-peptide linking"},{id:"PCA",name:"PYROGLUTAMIC ACID",type:"L-peptide linking"},{id:"A",name:"ADENOSINE-5'-MONOPHOSPHATE",type:"RNA linking"},{id:"C",name:"CYTIDINE-5'-MONOPHOSPHATE",type:"RNA linking"},{id:"T",name:"THYMIDINE-5'-MONOPHOSPHATE",type:"RNA linking"},{id:"G",name:"GUANOSINE-5'-MONOPHOSPHATE",type:"RNA linking"},{id:"I",name:"INOSINIC ACID",type:"RNA linking"},{id:"U",name:"URIDINE-5'-MONOPHOSPHATE",type:"RNA linking"},{id:"DA",name:"2'-DEOXYADENOSINE-5'-MONOPHOSPHATE",type:"DNA linking"},{id:"DC",name:"2'-DEOXYCYTIDINE-5'-MONOPHOSPHATE",type:"DNA linking"},{id:"DT",name:"THYMIDINE-5'-MONOPHOSPHATE",type:"DNA linking"},{id:"DG",name:"2'-DEOXYGUANOSINE-5'-MONOPHOSPHATE",type:"DNA linking"},{id:"DI",name:"2'-DEOXYINOSINE-5'-MONOPHOSPHATE",type:"DNA linking"},{id:"DU",name:"2'-DEOXYURIDINE-5'-MONOPHOSPHATE",type:"DNA linking"}];return t.forEach(function(r){return e.set(r.id,r)}),e}(),_z=function(){var e=new Map,t=[{id:"ZN2",name:"ZINC ION",type:"Ion"},{id:"SOD",name:"SODIUM ION",type:"Ion"},{id:"CES",name:"CESIUM ION",type:"Ion"},{id:"CLA",name:"CHLORIDE ION",type:"Ion"},{id:"CAL",name:"CALCIUM ION",type:"Ion"},{id:"POT",name:"POTASSIUM ION",type:"Ion"}];return t.forEach(function(r){return e.set(r.id,r)}),e}(),Ip=function(){function e(t,r){this.seqId=t,this.atomId=r,this.namesMap=new Map,this.comps=new Map,this.ids=[],this.names=[],this.types=[],this.mon_nstd_flags=[]}return e.prototype.set=function(t){this.comps.set(t.id,t),this.ids.push(t.id),this.names.push(t.name),this.types.push(t.type),this.mon_nstd_flags.push(o2.has(t.id)?"y":"n")},e.prototype.getAtomIds=function(t){for(var r=new Set,n=this.seqId.value(t);t<this.seqId.rowCount;){var i=this.seqId.value(t);if(i!==n)break;r.add(this.atomId.value(t)),t+=1}return r},e.prototype.hasAtomIds=function(t,r){for(var n=0,i=r.length;n<i;++n)if(!hi.areIntersecting(t,r[n]))return!1;return!0},e.prototype.getType=function(t){return this.hasAtomIds(t,QVe)?"peptide linking":this.hasAtomIds(t,ZVe)?"RNA linking":this.hasAtomIds(t,JVe)?"DNA linking":"other"},e.prototype.has=function(t){return this.comps.has(t)},e.prototype.get=function(t){return this.comps.get(t)},e.prototype.add=function(t,r){if(!this.has(t))if(Cz.has(t))this.set(Cz.get(t));else if(xE.has(t))this.set({id:t,name:"WATER",type:"non-polymer"});else if(eHe.has(t))this.set({id:t,name:this.namesMap.get(t)||t,type:"non-polymer"});else{var n=this.getAtomIds(r);if(n.size===1&&_z.has(t))this.set(_z.get(t));else{var i=this.getType(n);this.set({id:t,name:this.namesMap.get(t)||t,type:i})}}return this.get(t)},e.prototype.getChemCompTable=function(){return Qr.ofPartialColumns(to.chem_comp,{id:ve.ofStringArray(this.ids),name:ve.ofStringArray(this.names),type:ve.ofStringAliasArray(this.types),mon_nstd_flag:ve.ofStringAliasArray(this.mon_nstd_flags)},this.ids.length)},e.prototype.setNames=function(t){var r=this;t.forEach(function(n){return r.namesMap.set(n[0],n[1])})},e}(),tT="ABCDEFGHIJKLMNOPQRSTUVWXYZ";function tHe(e){for(var t=tT.length,r=e,n=0,i=tT[r%t];r>=t;)r=Math.floor(r/t),i+=tT[r%t],n+=1;return n>=5&&console.warn("getChainId overflow"),i}var wD=ME(tHe),Mp=function(){function e(){this.count=0,this.ids=[],this.types=[],this.descriptions=[],this.compoundsMap=new Map,this.namesMap=new Map,this.heteroMap=new Map,this.chainMap=new Map}return e.prototype.set=function(t,r){this.count+=1,this.ids.push(""+this.count),this.types.push(t),this.descriptions.push([r])},e.prototype.getEntityId=function(t,r,n,i){return r===2?(this.waterId===void 0&&(this.set("water",(i==null?void 0:i.customName)||"Water"),this.waterId=""+this.count),this.waterId):AL(r)?this.compoundsMap.has(n)?this.compoundsMap.get(n):(this.chainMap.has(n)||(this.set("polymer",(i==null?void 0:i.customName)||"Polymer "+(this.chainMap.size+1)),this.chainMap.set(n,""+this.count)),this.chainMap.get(n)):(this.heteroMap.has(t)||(this.set("non-polymer",(i==null?void 0:i.customName)||this.namesMap.get(t)||t),this.heteroMap.set(t,""+this.count)),this.heteroMap.get(t))},e.prototype.getEntityTable=function(){return Qr.ofPartialColumns(to.entity,{id:ve.ofStringArray(this.ids),type:ve.ofStringAliasArray(this.types),pdbx_description:ve.ofStringListArray(this.descriptions)},this.count)},e.prototype.setCompounds=function(t){for(var r=0,n=t.length;r<n;++r){var i=t[r],a=i.chains,o=i.description;this.set("polymer",o);for(var s=0,u=a.length;s<u;++s)this.compoundsMap.set(a[s],""+this.count)}},e.prototype.setNames=function(t){var r=this;t.forEach(function(n){return r.namesMap.set(n[0],n[1])})},e}();function rHe(e,t){for(var r=e.atomName,n=e.residueName,i=new Array(e.count),a=new Array(e.count),o=new Uint32Array(e.count),s=new Uint32Array(e.count),u=new Mp,l=new Ip(e.residueNumber,e.atomName),c="",d=0,f="",p=0,v=0,h=-1,m=0,g=e.count;m<g;++m){var y=e.residueNumber.value(m);if(y!==h){var b=e.residueName.value(m),S=S0(l.add(b,m).type,b);(S!==v||y!==h+1&&!(h===99999&&y===0))&&(f=wD(d),d+=1,p=0),c=u.getEntityId(b,S,f),p+=1,h=y,v=S}i[m]=c,a[m]=f,o[m]=p,s[m]=m}var x=ve.ofStringArray(a),C=Qr.ofPartialColumns(to.atom_site,{auth_asym_id:x,auth_atom_id:r,auth_comp_id:n,auth_seq_id:e.residueNumber,Cartn_x:ve.ofFloatArray(ve.mapToArray(e.x,function(w){return w*10},Float32Array)),Cartn_y:ve.ofFloatArray(ve.mapToArray(e.y,function(w){return w*10},Float32Array)),Cartn_z:ve.ofFloatArray(ve.mapToArray(e.z,function(w){return w*10},Float32Array)),id:ve.ofIntArray(s),label_asym_id:x,label_atom_id:r,label_comp_id:n,label_seq_id:ve.ofIntArray(o),label_entity_id:ve.ofStringArray(i),occupancy:ve.ofConst(1,e.count,ve.Schema.float),type_symbol:ve.ofStringArray(ve.mapToArray(e.atomName,function(w){return LE(w)})),pdbx_PDB_model_num:ve.ofConst(t,e.count,ve.Schema.int)},e.count);return Fv({entity:u.getEntityTable(),chem_comp:l.getChemCompTable(),atom_site:C})}var ED;(function(e){function t(n){return(n==null?void 0:n.kind)==="gro"}e.is=t;function r(n){return{kind:"gro",name:n.structures[0].header.title,data:n}}e.fromGro=r})(ED||(ED={}));function nHe(e){var t=this;return $e.create("Parse GRO",function(r){return ce(t,void 0,void 0,function(){var n,i,a,o,s,u;return de(this,function(l){switch(l.label){case 0:n=ED.fromGro(e),i=[],a=0,o=e.structures.length,l.label=1;case 1:return a<o?(s=rHe(e.structures[a].atoms,a+1),[4,xd(s,n,r)]):[3,4];case 2:u=l.sent(),u.frameCount===1&&i.push(u.representative),l.label=3;case 3:return++a,[3,1];case 4:return[2,new vv(i)]}})})})}function iHe(e,t){var r=function(a,o){return(t.substr(a,o)||"").trim()},n={entry_id:St.ofString(e),length_a:St.ofString(r(6,9)),length_b:St.ofString(r(15,9)),length_c:St.ofString(r(24,9)),angle_alpha:St.ofString(r(33,7)),angle_beta:St.ofString(r(40,7)),angle_gamma:St.ofString(r(47,7)),Z_PDB:St.ofString(r(66,4)),pdbx_unique_axis:St.ofString("?")},i={entry_id:St.ofString(e),"space_group_name_H-M":St.ofString(r(55,11)),Int_Tables_number:St.ofString("?"),cell_setting:St.ofString("?"),space_group_name_Hall:St.ofString("?")};return[va.ofFields("cell",n),va.ofFields("symmetry",i)]}function wz(e,t){return{id:e,details:t,groups:[]}}function aHe(e,t,r){for(var n=[],i,a,o,s=1,u=1,l=function(X){return e.data.substring(e.indices[2*X],e.indices[2*X+1])},c=t;c<r;c++){var d=l(c);if(d.substr(11,12)==="BIOMOLECULE:"){var f=d.substr(23).trim(),p="Biomolecule "+f;d=l(c+1),d.substr(11,30)!=="APPLY THE FOLLOWING TO CHAINS:"&&(c++,p=d.substr(11).trim()),i=wz(f,p),n.push(i)}else if(d.substr(13,5)==="BIOMT"){var v=d.split(/\s+/),h=parseInt(d[18])-1;h===0&&(o=ue.identity(),a.operators.push({id:s++,matrix:o})),ue.setValue(o,h,0,parseFloat(v[4])),ue.setValue(o,h,1,parseFloat(v[5])),ue.setValue(o,h,2,parseFloat(v[6])),ue.setValue(o,h,3,parseFloat(v[7]))}else if(d.substr(11,30)==="APPLY THE FOLLOWING TO CHAINS:"||d.substr(11,30)==="                   AND CHAINS:"){d.substr(11,5)==="APPLY"&&(a={chains:[],operators:[]},i.groups.push(a));for(var m=d.substr(41,30).split(","),g=0,y=m.length;g<y;++g){var b=m[g].trim();b&&a.chains.push(b)}}else if(d.substr(11,33)==="APPLYING THE FOLLOWING TO CHAINS:"){i=wz(""+u,"Biomolecule "+u),n.push(i),u+=1,a={chains:[],operators:[]},i.groups.push(a),c++,d=l(c);for(var m=d.substr(11,69).split(","),g=0,y=m.length;g<y;++g){var b=m[g].trim();b&&a.chains.push(b)}}}if(n.length===0)return[];for(var S={id:St.ofStrings(n.map(function(X){return X.id})),details:St.ofStrings(n.map(function(X){return X.details}))},x=[],C=0,w=n;C<w.length;C++)for(var A=w[C],M=0,D=A.groups;M<D.length;M++){var k=D[M];x.push({assembly_id:A.id,oper_expression:k.operators.map(function(X){return X.id}).join(","),asym_id_list:k.chains.join(",")})}for(var R={assembly_id:St.ofStrings(x.map(function(X){return X.assembly_id})),oper_expression:St.ofStrings(x.map(function(X){return X.oper_expression})),asym_id_list:St.ofStrings(x.map(function(X){return X.asym_id_list}))},O=[],H=0,B=n;H<B.length;H++)for(var A=B[H],j=0,Y=A.groups;j<Y.length;j++)for(var G=Y[j],$=0,q=G.operators;$<q.length;$++){for(var ee=q[$],h={id:""+ee.id,type:"?",name:"?",symmetry_operation:"?"},c=0;c<3;c++){for(var g=0;g<3;g++)h["matrix["+(c+1)+"]["+(g+1)+"]"]=""+ue.getValue(ee.matrix,c,g);h["vector["+(c+1)+"]"]=""+ue.getValue(ee.matrix,c,3)}O.push(h)}for(var fe={id:St.ofStrings(O.map(function(X){return X.id})),type:St.ofStrings(O.map(function(X){return X.type})),name:St.ofStrings(O.map(function(X){return X.name})),symmetry_operation:St.ofStrings(O.map(function(X){return X.symmetry_operation}))},W=function(X){for(var U=function(K){var Z="matrix["+(X+1)+"]["+(K+1)+"]";fe[Z]=St.ofStrings(O.map(function(te){return te[Z]}))},z=0;z<3;z++)U(z);var J="vector["+(X+1)+"]";fe[J]=St.ofStrings(O.map(function(K){return K[J]}))},c=0;c<3;c++)W(c);return[va.ofFields("pdbx_struct_assembly",S),va.ofFields("pdbx_struct_assembly_gen",R),va.ofFields("pdbx_struct_oper_list",fe)]}function oHe(e,t,r){for(var n=[],i,a=function(y){return e.data.substring(e.indices[2*y],e.indices[2*y+1])},o=t;o<r;o++){var s=a(o),u=s.split(/\s+/),l=parseInt(s[5])-1;l===0&&(i=ue.identity(),n.push(i)),ue.setValue(i,l,0,parseFloat(u[2])),ue.setValue(i,l,1,parseFloat(u[3])),ue.setValue(i,l,2,parseFloat(u[4])),ue.setValue(i,l,3,parseFloat(u[5]))}if(n.length===0)return[];for(var c=[],d=1,f=0,p=n;f<p.length;f++){for(var v=p[f],l={id:"ncsop"+d++,code:".",details:"."},o=0;o<3;o++){for(var h=0;h<3;h++)l["matrix["+(o+1)+"]["+(h+1)+"]"]=""+ue.getValue(v,o,h);l["vector["+(o+1)+"]"]=""+ue.getValue(v,o,3)}c.push(l)}for(var m={id:St.ofStrings(c.map(function(y){return y.id})),code:St.ofStrings(c.map(function(y){return y.code})),details:St.ofStrings(c.map(function(y){return y.details}))},g=function(y){for(var b=function(C){var w="matrix["+(y+1)+"]["+(C+1)+"]";m[w]=St.ofStrings(c.map(function(A){return A[w]}))},S=0;S<3;S++)b(S);var x="vector["+(y+1)+"]";m[x]=St.ofStrings(c.map(function(C){return C[x]}))},o=0;o<3;o++)g(o);return[va.ofFields("struct_ncs_oper",m)]}var sHe={1:"HELX_RH_AL_P",2:"HELX_RH_OM_P",3:"HELX_RH_PI_P",4:"HELX_RH_GA_P",5:"HELX_RH_3T_P",6:"HELX_LH_AL_P",7:"HELX_LH_OM_P",8:"HELX_LH_GA_P",9:"HELX_RH_27_P",10:"HELX_RH_PP_P"};function uHe(e){return sHe[e]||"HELX_P"}function lHe(e,t,r){for(var n=[],i=function(f){return e.data.substring(e.indices[2*f],e.indices[2*f+1])},a=t;a<r;a++){var o=i(a);n.push({serNum:o.substr(7,3).trim(),helixID:o.substr(11,3).trim(),initResName:o.substr(15,3).trim(),initChainID:o.substr(19,1).trim(),initSeqNum:o.substr(21,4).trim(),initICode:o.substr(25,1).trim(),endResName:o.substr(27,3).trim(),endChainID:o.substr(31,3).trim(),endSeqNum:o.substr(33,4).trim(),endICode:o.substr(37,1).trim(),helixClass:o.substr(38,2).trim(),comment:o.substr(40,30).trim(),length:o.substr(71,5).trim()})}var s=St.ofStrings(n.map(function(f){return f.initChainID})),u=St.ofStrings(n.map(function(f){return f.initResName})),l=St.ofStrings(n.map(function(f){return f.endChainID})),c=St.ofStrings(n.map(function(f){return f.endResName})),d={beg_label_asym_id:s,beg_label_comp_id:u,beg_label_seq_id:St.ofUndefined(n.length,ve.Schema.int),beg_auth_asym_id:s,beg_auth_comp_id:u,beg_auth_seq_id:St.ofStrings(n.map(function(f){return f.initSeqNum})),conf_type_id:St.ofStrings(n.map(function(f){return uHe(f.helixClass)})),details:St.ofStrings(n.map(function(f){return f.comment})),end_label_asym_id:l,end_label_comp_id:c,end_label_seq_id:St.ofUndefined(n.length,ve.Schema.int),end_auth_asym_id:l,end_auth_comp_id:c,end_auth_seq_id:St.ofStrings(n.map(function(f){return f.endSeqNum})),id:St.ofStrings(n.map(function(f){return f.serNum})),pdbx_beg_PDB_ins_code:St.ofStrings(n.map(function(f){return f.initICode})),pdbx_end_PDB_ins_code:St.ofStrings(n.map(function(f){return f.endICode})),pdbx_PDB_helix_class:St.ofStrings(n.map(function(f){return f.helixClass})),pdbx_PDB_helix_length:St.ofStrings(n.map(function(f){return f.length})),pdbx_PDB_helix_id:St.ofStrings(n.map(function(f){return f.helixID}))};return va.ofFields("struct_conf",d)}function cHe(e,t,r){for(var n=[],i=function(v){return e.data.substring(e.indices[2*v],e.indices[2*v+1])},a=t;a<r;a++){var o=i(a);n.push({strand:o.substr(7,3).trim(),sheetID:o.substr(11,3).trim(),numStrands:o.substr(14,2).trim(),initResName:o.substr(17,3).trim(),initChainID:o.substr(21,1).trim(),initSeqNum:o.substr(22,4).trim(),initICode:o.substr(26,1).trim(),endResName:o.substr(28,3).trim(),endChainID:o.substr(32,1).trim(),endSeqNum:o.substr(33,4).trim(),endICode:o.substr(37,1).trim(),sense:o.substr(38,2).trim(),curAtom:o.substr(41,4).trim(),curResName:o.substr(45,3).trim(),curChainId:o.substr(49,1).trim(),curResSeq:o.substr(50,4).trim(),curICode:o.substr(54,1).trim(),prevAtom:o.substr(56,4).trim(),prevResName:o.substr(60,3).trim(),prevChainId:o.substr(64,1).trim(),prevResSeq:o.substr(65,4).trim(),prevICode:o.substr(69,1).trim()})}var s=St.ofStrings(n.map(function(v){return v.initChainID})),u=St.ofStrings(n.map(function(v){return v.initResName})),l=St.ofStrings(n.map(function(v){return v.initSeqNum})),c=St.ofStrings(n.map(function(v){return v.endChainID})),d=St.ofStrings(n.map(function(v){return v.endResName})),f=St.ofStrings(n.map(function(v){return v.endSeqNum})),p={beg_label_asym_id:s,beg_label_comp_id:u,beg_label_seq_id:l,beg_auth_asym_id:s,beg_auth_comp_id:u,beg_auth_seq_id:l,end_label_asym_id:c,end_label_comp_id:c,end_label_seq_id:f,end_auth_asym_id:c,end_auth_comp_id:d,end_auth_seq_id:f,id:St.ofStrings(n.map(function(v){return v.strand})),sheet_id:St.ofStrings(n.map(function(v){return v.sheetID})),pdbx_beg_PDB_ins_code:St.ofStrings(n.map(function(v){return v.initICode})),pdbx_end_PDB_ins_code:St.ofStrings(n.map(function(v){return v.endICode}))};return va.ofFields("struct_sheet_range",p)}var dHe={MOL_ID:"",MOLECULE:"",CHAIN:"",FRAGMENT:"",SYNONYM:"",EC:"",ENGINEERED:"",MUTATION:"",OTHER_DETAILS:""};function fHe(e,t,r){for(var n=function(p){return e.data.substring(e.indices[2*p],e.indices[2*p+1])},i,a={chains:[],description:""},o=[],s=t;s<r;s++){var u=n(s),l=u.substr(10,70).trim(),c=l.indexOf(":"),d=l.substring(0,c),f=void 0;d in dHe?(i=d,f=l.substring(c+2)):f=l,f=f.replace(/;$/,""),i==="MOL_ID"?(a={chains:[],description:""},o.push(a)):i==="MOLECULE"?(a.description&&(a.description+=" "),a.description+=f):i==="CHAIN"&&Array.prototype.push.apply(a.chains,f.split(/\s*,\s*/))}return o}function pHe(e,t,r){for(var n=function(l){return e.data.substring(e.indices[2*l],e.indices[2*l+1])},i=new Map,a=t;a<r;a++){var o=n(a),s=o.substr(11,3).trim(),u=o.substr(15).trim();i.has(s)?i.set(s,i.get(s)+" "+u):i.set(s,u)}return i}function hHe(e,t){var r=function(){return[]},n=function(){return pt.create(e,2*t)};return{index:0,group_PDB:n(),id:r(),auth_atom_id:n(),label_alt_id:n(),auth_comp_id:n(),auth_asym_id:n(),auth_seq_id:n(),pdbx_PDB_ins_code:n(),Cartn_x:n(),Cartn_y:n(),Cartn_z:n(),occupancy:n(),B_iso_or_equiv:n(),type_symbol:n(),pdbx_PDB_model_num:r(),label_entity_id:r(),partial_charge:n()}}function vHe(e){var t=St.ofTokens(e.auth_asym_id),r=St.ofTokens(e.auth_atom_id),n=St.ofTokens(e.auth_comp_id);return{auth_asym_id:t,auth_atom_id:r,auth_comp_id:n,auth_seq_id:St.ofTokens(e.auth_seq_id),B_iso_or_equiv:St.ofTokens(e.B_iso_or_equiv),Cartn_x:St.ofTokens(e.Cartn_x),Cartn_y:St.ofTokens(e.Cartn_y),Cartn_z:St.ofTokens(e.Cartn_z),group_PDB:St.ofTokens(e.group_PDB),id:St.ofStrings(e.id),label_alt_id:St.ofTokens(e.label_alt_id),label_asym_id:t,label_atom_id:r,label_comp_id:n,label_seq_id:St.ofUndefined(e.index,ve.Schema.int),label_entity_id:St.ofStrings(e.label_entity_id),occupancy:St.ofTokens(e.occupancy),type_symbol:St.ofTokens(e.type_symbol),pdbx_PDB_ins_code:St.ofTokens(e.pdbx_PDB_ins_code),pdbx_PDB_model_num:St.ofStrings(e.pdbx_PDB_model_num),partial_charge:St.ofTokens(e.partial_charge)}}function Ez(e,t,r,n,i,a){var o=r.data,s=i-n;pt.addToken(e.group_PDB,It.trim(r,n,n+6)),It.trim(r,n+6,n+11),e.id[e.index]=r.data.substring(r.tokenStart,r.tokenEnd),pt.addToken(e.auth_atom_id,It.trim(r,n+12,n+16)),o.charCodeAt(n+16)===32?pt.add(e.label_alt_id,0,0):pt.add(e.label_alt_id,n+16,n+17),pt.addToken(e.auth_comp_id,It.trim(r,n+17,n+20)),pt.add(e.auth_asym_id,n+21,n+22),pt.addToken(e.auth_seq_id,It.trim(r,n+22,n+26)),o.charCodeAt(n+26)===32?pt.add(e.pdbx_PDB_ins_code,0,0):pt.add(e.pdbx_PDB_ins_code,n+26,n+27),pt.addToken(e.Cartn_x,It.trim(r,n+30,n+38)),pt.addToken(e.Cartn_y,It.trim(r,n+38,n+46)),pt.addToken(e.Cartn_z,It.trim(r,n+46,n+54)),pt.addToken(e.occupancy,It.trim(r,n+54,n+60)),s>=66?pt.addToken(e.B_iso_or_equiv,It.trim(r,n+60,n+66)):pt.add(e.B_iso_or_equiv,0,0),a&&pt.addToken(e.partial_charge,It.trim(r,n+70,n+76)),s>=78&&!a?(It.trim(r,n+76,n+78),r.tokenStart<r.tokenEnd?pt.addToken(e.type_symbol,r):aw(e.type_symbol,o,n+12,n+16)):aw(e.type_symbol,o,n+12,n+16),e.pdbx_PDB_model_num[e.index]=t,e.index++}function mHe(e,t){var r=function(){return[]},n=function(){return new Float32Array(t)},i=function(){return pt.create(e,2*t)};return{index:0,count:t,id:r(),type_symbol:i(),pdbx_label_atom_id:i(),pdbx_label_alt_id:i(),pdbx_label_comp_id:i(),pdbx_label_asym_id:i(),pdbx_label_seq_id:i(),pdbx_PDB_ins_code:i(),"U[1][1]":n(),"U[2][2]":n(),"U[3][3]":n(),"U[1][2]":n(),"U[1][3]":n(),"U[2][3]":n(),pdbx_auth_seq_id:i(),pdbx_auth_comp_id:i(),pdbx_auth_asym_id:i(),pdbx_auth_atom_id:i()}}function gHe(e){var t=St.ofTokens(e.pdbx_auth_seq_id),r=St.ofTokens(e.pdbx_auth_comp_id),n=St.ofTokens(e.pdbx_auth_asym_id),i=St.ofTokens(e.pdbx_auth_atom_id),a={id:St.ofStrings(e.id),type_symbol:St.ofTokens(e.type_symbol),pdbx_label_atom_id:i,pdbx_label_alt_id:St.ofTokens(e.pdbx_label_alt_id),pdbx_label_comp_id:r,pdbx_label_asym_id:n,pdbx_label_seq_id:t,pdbx_PDB_ins_code:St.ofTokens(e.pdbx_PDB_ins_code),pdbx_auth_seq_id:t,pdbx_auth_comp_id:r,pdbx_auth_asym_id:n,pdbx_auth_atom_id:i};return a["U[1][1]"]=St.ofNumbers(e["U[1][1]"]),a["U[2][2]"]=St.ofNumbers(e["U[2][2]"]),a["U[3][3]"]=St.ofNumbers(e["U[3][3]"]),a["U[1][2]"]=St.ofNumbers(e["U[1][2]"]),a["U[1][3]"]=St.ofNumbers(e["U[1][3]"]),a["U[2][3]"]=St.ofNumbers(e["U[2][3]"]),a}function yHe(e,t,r,n,i){var a=r.data,o=i-n;It.trim(r,n+6,n+11),e.id[e.index]=a.substring(r.tokenStart,r.tokenEnd),pt.addToken(e.pdbx_auth_atom_id,It.trim(r,n+12,n+16)),a.charCodeAt(n+16)===32?pt.add(e.pdbx_label_alt_id,0,0):pt.add(e.pdbx_label_alt_id,n+16,n+17),pt.addToken(e.pdbx_auth_comp_id,It.trim(r,n+17,n+20)),pt.add(e.pdbx_auth_asym_id,n+21,n+22),pt.addToken(e.pdbx_auth_seq_id,It.trim(r,n+22,n+26)),a.charCodeAt(n+26)===32?pt.add(e.pdbx_PDB_ins_code,0,0):pt.add(e.pdbx_PDB_ins_code,n+26,n+27),e["U[1][1]"][e.index]=ch(a,n+28,n+35)/1e4,e["U[2][2]"][e.index]=ch(a,n+35,n+42)/1e4,e["U[3][3]"][e.index]=ch(a,n+42,n+49)/1e4,e["U[1][2]"][e.index]=ch(a,n+49,n+56)/1e4,e["U[1][3]"][e.index]=ch(a,n+56,n+63)/1e4,e["U[2][3]"][e.index]=ch(a,n+63,n+70)/1e4,o>=78?(It.trim(r,n+76,n+78),r.tokenStart<r.tokenEnd?pt.addToken(e.type_symbol,r):aw(e.type_symbol,a,n+12,n+16)):aw(e.type_symbol,a,n+12,n+16),e.index++}function bHe(e,t,r,n){for(var i={},a=0,o=n.id.rowCount;a<o;++a)i[n.id.str(a)]=a;for(var s=function(k){return e.data.substring(e.indices[2*k],e.indices[2*k+1])},u=[],l=[],c=[],d=[],f=[],p=[],v=[],h=[],m=[],g=[],y=[11,16,21,26],b=1,a=t;a<r;a++){var S=s(a),x=i[parseInt(S.substr(6,5))],C={};if(x!==void 0)for(var w=0;w<4;++w){var A=parseInt(S.substr(y[w],5));if(!Number.isNaN(A)){var M=i[A];M!==void 0&&(x>M||C[M]===void 0&&(u.push("covale"+b),l.push("covale"),c.push(n.label_asym_id.str(x)),f.push(n.auth_seq_id.int(x)),d.push(n.label_seq_id.int(x)),p.push(n.label_atom_id.str(x)),v.push(n.label_asym_id.str(M)),m.push(n.auth_seq_id.int(M)),h.push(n.label_seq_id.int(M)),g.push(n.label_atom_id.str(M)),b+=1))}}}var D={id:St.ofStrings(u),conn_type_id:St.ofStrings(l),ptnr1_label_asym_id:St.ofStrings(c),ptnr1_auth_seq_id:St.ofNumbers(f),ptnr1_label_seq_id:St.ofNumbers(d),ptnr1_label_atom_id:St.ofStrings(p),ptnr2_label_asym_id:St.ofStrings(v),ptnr2_label_seq_id:St.ofNumbers(h),ptnr2_auth_seq_id:St.ofNumbers(m),ptnr2_label_atom_id:St.ofStrings(g)};return va.ofFields("struct_conn",D)}function xHe(e){return ce(this,void 0,void 0,function(){var t,r,n,i,a,o,s,M,m,g,y,u,l,c,d,f,p,v,h,M,m,g,y,b,b,b,b,b,b,b,S,x,C,w,A,M,D,k,R,O,H,B,j,Y;return de(this,function(G){for(t=e.lines,r=t.data,n=t.indices,i=It(r),a=!!e.isPdbqt,o=0,s=0,M=0,m=t.count;M<m;M++)switch(g=n[2*M],y=n[2*M+1],r[g]){case"A":vi(r,g,y,"ATOM  ")?o++:vi(r,g,y,"ANISOU")&&s++;break;case"H":vi(r,g,y,"HETATM")&&o++;break}for(u=hHe(r,o),l=mHe(r,s),c=new Mp,d=[],f=[],p=0,v="",h=void 0,M=0,m=t.count;M<m;M++)switch(g=n[2*M],y=n[2*M+1],r[g]){case"A":vi(r,g,y,"ATOM  ")?(p||(p++,v=""+p),Ez(u,v,i,g,y,a)):vi(r,g,y,"ANISOU")&&yHe(l,v,i,g,y);break;case"C":if(vi(r,g,y,"CRYST1"))d.push.apply(d,iHe(e.id||"?",r.substring(g,y)));else if(vi(r,g,y,"CONECT")){for(b=M+1;g=n[2*b],y=n[2*b+1],!!vi(r,g,y,"CONECT");)b++;h?kr&&console.log("only single CONECT block allowed, ignoring others"):h=[M,b],M=b-1}else if(vi(r,g,y,"COMPND")){for(b=M+1;g=n[2*b],y=n[2*b+1],!!vi(r,g,y,"COMPND");)b++;c.setCompounds(fHe(t,M,b)),M=b-1}break;case"H":if(vi(r,g,y,"HETATM"))p||(p++,v=""+p),Ez(u,v,i,g,y,a);else if(vi(r,g,y,"HELIX")){for(b=M+1;g=n[2*b],y=n[2*b+1],!!vi(r,g,y,"HELIX");)b++;d.push(lHe(t,M,b)),M=b-1}else if(vi(r,g,y,"HETNAM")){for(b=M+1;g=n[2*b],y=n[2*b+1],!!vi(r,g,y,"HETNAM");)b++;f.push.apply(f,Array.from(pHe(t,M,b).entries())),M=b-1}break;case"M":if(vi(r,g,y,"MODEL ")&&(p++,v=""+p),vi(r,g,y,"MTRIX")){for(b=M+1;g=n[2*b],y=n[2*b+1],!!vi(r,g,y,"MTRIX");)b++;d.push.apply(d,oHe(t,M,b)),M=b-1}break;case"O":break;case"R":if(vi(r,g,y,"REMARK 350")){for(b=M+1;g=n[2*b],y=n[2*b+1],!!vi(r,g,y,"REMARK 350");)b++;d.push.apply(d,aHe(t,M,b)),M=b-1}break;case"S":if(vi(r,g,y,"SHEET")){for(b=M+1;g=n[2*b],y=n[2*b+1],!!vi(r,g,y,"SHEET");)b++;d.push(cHe(t,M,b)),M=b-1}break}for(S=ve.ofIntTokens(u.auth_seq_id),x=ve.ofStringTokens(u.auth_atom_id),C=ve.ofStringTokens(u.auth_comp_id),w=ve.ofStringTokens(u.auth_asym_id),A=new Ip(S,x),A.setNames(f),c.setNames(f),M=0,D=C.rowCount;M<D;++M)k=C.value(M),R=S0(A.add(k,M).type,k),u.label_entity_id[M]=c.getEntityId(k,R,w.value(M));for(O=vHe(u),a||delete O.partial_charge,h&&d.push(bHe(t,h[0],h[1],O)),H={entity:va.ofTable("entity",c.getEntityTable()),chem_comp:va.ofTable("chem_comp",A.getChemCompTable()),atom_site:va.ofFields("atom_site",O),atom_site_anisotrop:va.ofFields("atom_site_anisotrop",gHe(l))},B=0,j=d;B<j.length;B++)Y=j[B],H[Y.name]=Y;return[2,{header:e.id||"PDB",categoryNames:Object.keys(H),categories:H}]})})}var Qg;(function(e){e.Descriptor={name:"atom_partial_charge"},e.Provider=zu.create(e.Descriptor)})(Qg||(Qg={}));var AD;(function(e){function t(n){return(n==null?void 0:n.kind)==="pdb"}e.is=t;function r(n){return{kind:"pdb",name:n.id||"",data:n}}e.create=r})(AD||(AD={}));function SHe(e){var t=this;return $e.create("Parse PDB",function(r){return ce(t,void 0,void 0,function(){var n,i,a,o,s,u,l,c,d,f,p;return de(this,function(v){switch(v.label){case 0:return[4,r.update("Converting to mmCIF")];case 1:return v.sent(),[4,xHe(e)];case 2:return n=v.sent(),i=an.fromFrame(n,void 0,AD.create(e)),[4,xd(i.data.db,i,r)];case 3:return a=v.sent(),o=(p=n.categories.atom_site)===null||p===void 0?void 0:p.getField("partial_charge"),o&&a.frameCount===1&&(s=a.representative,u=s.atomicHierarchy.atomSourceIndex,l=ve.isIdentity(u),c=l?void 0:u.toArray({array:Int32Array}),d=o.toFloatArray(),f=c?ve.ofFloatArray(ve.mapToArray(u,function(h){return d[h]},Float32Array)):ve.ofFloatArray(d),Qg.Provider.set(s,{data:f,type:"GASTEIGER"})),[2,a]}})})})}function CHe(e){for(var t=new Array(e.count),r=new Array(e.count),n=new Uint32Array(e.count),i=new Uint32Array(e.count),a=new Mp,o=new Ip(e.residueId,e.atomName),s="",u=0,l="",c=0,d=e.segmentName.value(0),f=!1,p=0,v=-1,h=0,m=e.count;h<m;++h){var g=e.residueId.value(h),y=e.segmentName.value(h);if(d!==y?(l=wD(u),u+=1,c=0,f=!0,d=y):f=!1,f||g!==v){var b=e.residueName.value(h),S=S0(o.add(b,h).type,b);!f&&(S!==p||g!==v+1)&&(l=wD(u),u+=1,c=0),s=a.getEntityId(b,S,l),c+=1,v=g,p=S}t[h]=s,r[h]=l,n[h]=c,i[h]=h}var x=Qr.ofPartialColumns(to.atom_site,{auth_asym_id:e.segmentName,auth_atom_id:e.atomName,auth_comp_id:e.residueName,auth_seq_id:e.residueId,id:ve.ofIntArray(i),label_asym_id:ve.ofStringArray(r),label_atom_id:e.atomName,label_comp_id:e.residueName,label_seq_id:ve.ofIntArray(n),label_entity_id:ve.ofStringArray(t),occupancy:ve.ofConst(1,e.count,ve.Schema.float),type_symbol:ve.ofStringArray(ve.mapToArray(e.atomName,function(C){return LE(C)})),pdbx_PDB_model_num:ve.ofConst(1,e.count,ve.Schema.int)},e.count);return Fv({entity:a.getEntityTable(),chem_comp:o.getChemCompTable(),atom_site:x})}var PD;(function(e){function t(n){return(n==null?void 0:n.kind)==="psf"}e.is=t;function r(n){return{kind:"psf",name:n.id,data:n}}e.fromPsf=r})(PD||(PD={}));function _He(e){var t=this;return $e.create("Parse PSF",function(r){return ce(t,void 0,void 0,function(){var n,i,a,o,s,u;return de(this,function(l){return n=PD.fromPsf(e),i=CHe(e.atoms),a=e.bonds,o=a.atomIdA,s=a.atomIdB,u={indexA:ve.ofLambda({value:function(c){return o.value(c)-1},rowCount:o.rowCount,schema:o.schema}),indexB:ve.ofLambda({value:function(c){return s.value(c)-1},rowCount:s.rowCount,schema:s.schema}),order:ve.ofConst(1,e.bonds.count,ve.Schema.int)},[2,Z5.create(e.id,i,u,n)]})})})}function wHe(e){return Object.keys(e).filter(function(t){return!isNaN(t)}).map(function(t){return+t}).sort(function(t,r){return t-r}).map(function(t){return e[t]})}function rT(e,t,r){return e&&e[t]!==void 0?e[t]:r}function nt(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];return{kind:"alias",aliases:t,symbol:e}}function Bx(e,t){for(var r=[],n=2;n<arguments.length;n++)r[n-2]=arguments[n];return e.info.namespace="molscript-macro",e.id="molscript-macro."+e.info.name,{kind:"macro",symbol:e,translate:t,aliases:Nt([e.info.name],r)}}function EHe(e){return e.kind==="alias"||e.kind==="macro"}var AHe=[["Core symbols",nt(Ce.core.type.bool,"bool"),nt(Ce.core.type.num,"num"),nt(Ce.core.type.str,"str"),nt(Ce.core.type.regex,"regex"),nt(Ce.core.type.list,"list"),nt(Ce.core.type.set,"set"),nt(Ce.core.type.compositeKey,"composite-key"),nt(Ce.core.logic.not,"not"),nt(Ce.core.logic.and,"and"),nt(Ce.core.logic.or,"or"),nt(Ce.core.ctrl.if,"if"),nt(Ce.core.ctrl.fn,"fn"),nt(Ce.core.ctrl.eval,"eval"),nt(Ce.core.math.add,"add","+"),nt(Ce.core.math.sub,"sub","-"),nt(Ce.core.math.mult,"mult","*"),nt(Ce.core.math.div,"div","/"),nt(Ce.core.math.pow,"pow","**"),nt(Ce.core.math.mod,"mod"),nt(Ce.core.math.min,"min"),nt(Ce.core.math.max,"max"),nt(Ce.core.math.floor,"floor"),nt(Ce.core.math.ceil,"ceil"),nt(Ce.core.math.roundInt,"round"),nt(Ce.core.math.abs,"abs"),nt(Ce.core.math.sqrt,"sqrt"),nt(Ce.core.math.cbrt,"cbrt"),nt(Ce.core.math.sin,"sin"),nt(Ce.core.math.cos,"cos"),nt(Ce.core.math.tan,"tan"),nt(Ce.core.math.asin,"asin"),nt(Ce.core.math.acos,"acos"),nt(Ce.core.math.atan,"atan"),nt(Ce.core.math.sinh,"sinh"),nt(Ce.core.math.cosh,"cosh"),nt(Ce.core.math.tanh,"tanh"),nt(Ce.core.math.exp,"exp"),nt(Ce.core.math.log,"log"),nt(Ce.core.math.log10,"log10"),nt(Ce.core.math.atan2,"atan2"),nt(Ce.core.rel.eq,"eq","="),nt(Ce.core.rel.neq,"neq","!="),nt(Ce.core.rel.lt,"lt","<"),nt(Ce.core.rel.lte,"lte","<="),nt(Ce.core.rel.gr,"gr",">"),nt(Ce.core.rel.gre,"gre",">="),nt(Ce.core.rel.inRange,"in-range"),nt(Ce.core.str.concat,"concat"),nt(Ce.core.str.match,"regex.match"),nt(Ce.core.list.getAt,"list.get"),nt(Ce.core.set.has,"set.has"),nt(Ce.core.set.isSubset,"set.subset")],["Structure",["Types",nt(Ce.structureQuery.type.entityType,"ent-type"),nt(Ce.structureQuery.type.authResidueId,"auth-resid"),nt(Ce.structureQuery.type.labelResidueId,"label-resid"),nt(Ce.structureQuery.type.ringFingerprint,"ringfp"),nt(Ce.structureQuery.type.bondFlags,"bond-flags")],["Slots",nt(Ce.structureQuery.slot.elementSetReduce,"atom.set.reduce.value")],["Generators",nt(Ce.structureQuery.generator.atomGroups,"sel.atom.atom-groups"),nt(Ce.structureQuery.generator.queryInSelection,"sel.atom.query-in-selection"),nt(Ce.structureQuery.generator.rings,"sel.atom.rings"),nt(Ce.structureQuery.generator.empty,"sel.atom.empty"),nt(Ce.structureQuery.generator.all,"sel.atom.all"),nt(Ce.structureQuery.generator.bondedAtomicPairs,"sel.atom.bonded-pairs"),Bx(qy("sel.atom.atoms",Rt.Dictionary({0:vt(De.Bool,{isOptional:!0,defaultValue:!0,description:"Test applied to each atom."})}),At.ElementSelection,"A selection of singleton atom sets."),function(e){return se.struct.generator.atomGroups({"atom-test":rT(e,0,!0)})}),Bx(qy("sel.atom.res",Rt.Dictionary({0:vt(De.Bool,{isOptional:!0,defaultValue:!0,description:"Test applied to the 1st atom of each residue."})}),At.ElementSelection,"A selection of atom sets grouped by residue."),function(e){return se.struct.generator.atomGroups({"residue-test":rT(e,0,!0),"group-by":se.ammp("residueKey")})}),Bx(qy("sel.atom.chains",Rt.Dictionary({0:vt(De.Bool,{isOptional:!0,defaultValue:!0,description:"Test applied to the 1st atom of each chain."})}),At.ElementSelection,"A selection of atom sets grouped by chain."),function(e){return se.struct.generator.atomGroups({"chain-test":rT(e,0,!0),"group-by":se.ammp("chainKey")})})],["Modifiers",nt(Ce.structureQuery.modifier.queryEach,"sel.atom.query-each"),nt(Ce.structureQuery.modifier.intersectBy,"sel.atom.intersect-by"),nt(Ce.structureQuery.modifier.exceptBy,"sel.atom.except-by"),nt(Ce.structureQuery.modifier.unionBy,"sel.atom.union-by"),nt(Ce.structureQuery.modifier.union,"sel.atom.union"),nt(Ce.structureQuery.modifier.cluster,"sel.atom.cluster"),nt(Ce.structureQuery.modifier.includeSurroundings,"sel.atom.include-surroundings"),nt(Ce.structureQuery.modifier.surroundingLigands,"sel.atom.surrounding-ligands"),nt(Ce.structureQuery.modifier.includeConnected,"sel.atom.include-connected"),nt(Ce.structureQuery.modifier.expandProperty,"sel.atom.expand-property")],["Filters",nt(Ce.structureQuery.filter.pick,"sel.atom.pick"),nt(Ce.structureQuery.filter.first,"sel.atom.first"),nt(Ce.structureQuery.filter.withSameAtomProperties,"sel.atom.with-same-atom-properties"),nt(Ce.structureQuery.filter.intersectedBy,"sel.atom.intersected-by"),nt(Ce.structureQuery.filter.within,"sel.atom.within"),nt(Ce.structureQuery.filter.isConnectedTo,"sel.atom.is-connected-to")],["Combinators",nt(Ce.structureQuery.combinator.intersect,"sel.atom.intersect"),nt(Ce.structureQuery.combinator.merge,"sel.atom.merge"),nt(Ce.structureQuery.combinator.distanceCluster,"sel.atom.dist-cluster")],["Atom Set Properties",nt(Ce.structureQuery.atomSet.atomCount,"atom.set.atom-count"),nt(Ce.structureQuery.atomSet.countQuery,"atom.set.count-query"),nt(Ce.structureQuery.atomSet.reduce,"atom.set.reduce"),nt(Ce.structureQuery.atomSet.propertySet,"atom.set.property")],["Atom Properties",nt(Ce.structureQuery.atomProperty.core.elementSymbol,"atom.el"),nt(Ce.structureQuery.atomProperty.core.vdw,"atom.vdw"),nt(Ce.structureQuery.atomProperty.core.mass,"atom.mass"),nt(Ce.structureQuery.atomProperty.core.atomicNumber,"atom.atomic-number"),nt(Ce.structureQuery.atomProperty.core.x,"atom.x"),nt(Ce.structureQuery.atomProperty.core.y,"atom.y"),nt(Ce.structureQuery.atomProperty.core.z,"atom.z"),nt(Ce.structureQuery.atomProperty.core.sourceIndex,"atom.src-index"),nt(Ce.structureQuery.atomProperty.core.operatorName,"atom.op-name"),nt(Ce.structureQuery.atomProperty.core.modelIndex,"atom.model-index"),nt(Ce.structureQuery.atomProperty.core.modelLabel,"atom.model-label"),nt(Ce.structureQuery.atomProperty.core.atomKey,"atom.key"),nt(Ce.structureQuery.atomProperty.core.bondCount,"atom.bond-count"),nt(Ce.structureQuery.atomProperty.topology.connectedComponentKey,"atom.key.molecule"),nt(Ce.structureQuery.atomProperty.macromolecular.authResidueId,"atom.auth-resid"),nt(Ce.structureQuery.atomProperty.macromolecular.labelResidueId,"atom.label-resid"),nt(Ce.structureQuery.atomProperty.macromolecular.residueKey,"atom.key.res"),nt(Ce.structureQuery.atomProperty.macromolecular.chainKey,"atom.key.chain"),nt(Ce.structureQuery.atomProperty.macromolecular.entityKey,"atom.key.entity"),nt(Ce.structureQuery.atomProperty.macromolecular.isHet,"atom.is-het"),nt(Ce.structureQuery.atomProperty.macromolecular.id,"atom.id"),nt(Ce.structureQuery.atomProperty.macromolecular.label_atom_id,"atom.label_atom_id"),nt(Ce.structureQuery.atomProperty.macromolecular.label_alt_id,"atom.label_alt_id","atom.altloc"),nt(Ce.structureQuery.atomProperty.macromolecular.label_comp_id,"atom.label_comp_id"),nt(Ce.structureQuery.atomProperty.macromolecular.label_asym_id,"atom.label_asym_id"),nt(Ce.structureQuery.atomProperty.macromolecular.label_entity_id,"atom.label_entity_id"),nt(Ce.structureQuery.atomProperty.macromolecular.label_seq_id,"atom.label_seq_id"),nt(Ce.structureQuery.atomProperty.macromolecular.auth_atom_id,"atom.auth_atom_id","atom.name"),nt(Ce.structureQuery.atomProperty.macromolecular.auth_comp_id,"atom.auth_comp_id","atom.resname"),nt(Ce.structureQuery.atomProperty.macromolecular.auth_asym_id,"atom.auth_asym_id","atom.chain"),nt(Ce.structureQuery.atomProperty.macromolecular.auth_seq_id,"atom.auth_seq_id","atom.resno"),nt(Ce.structureQuery.atomProperty.macromolecular.pdbx_PDB_ins_code,"atom.pdbx_PDB_ins_code","atom.inscode"),nt(Ce.structureQuery.atomProperty.macromolecular.pdbx_formal_charge,"atom.pdbx_formal_charge"),nt(Ce.structureQuery.atomProperty.macromolecular.occupancy,"atom.occupancy"),nt(Ce.structureQuery.atomProperty.macromolecular.B_iso_or_equiv,"atom.B_iso_or_equiv","atom.bfactor"),nt(Ce.structureQuery.atomProperty.macromolecular.entityType,"atom.entity-type"),nt(Ce.structureQuery.atomProperty.macromolecular.entitySubtype,"atom.entity-subtype"),nt(Ce.structureQuery.atomProperty.macromolecular.entityPrdId,"atom.entity-prd-id"),nt(Ce.structureQuery.atomProperty.macromolecular.entityDescription,"atom.entity-description"),nt(Ce.structureQuery.atomProperty.macromolecular.objectPrimitive,"atom.object-primitive"),nt(Ce.structureQuery.atomProperty.macromolecular.chemCompType,"atom.chem-comp-type"),nt(Ce.structureQuery.atomProperty.macromolecular.secondaryStructureKey,"atom.key.sec-struct"),nt(Ce.structureQuery.atomProperty.macromolecular.isModified,"atom.is-modified"),nt(Ce.structureQuery.atomProperty.macromolecular.modifiedParentName,"atom.modified-parent")],["Bond Properties",nt(Ce.structureQuery.bondProperty.order,"bond.order"),nt(Ce.structureQuery.bondProperty.length,"bond.length"),nt(Ce.structureQuery.bondProperty.atomA,"bond.atom-a"),nt(Ce.structureQuery.bondProperty.atomB,"bond.atom-b"),Bx(qy("bond.is",Rt.List(At.BondFlag),De.Bool,"Test if the current bond has at least one (or all if partial = false) of the specified flags: "+De.oneOfValues(At.BondFlag).join(", ")),function(e){return se.core.flags.hasAny([se.struct.bondProperty.flags(),se.struct.type.bondFlags(wHe(e))])})]]],Xee=[];function Yee(e){for(var t=0,r=e;t<r.length;t++){var n=r[t];EHe(n)?Xee.push(n):n instanceof Array&&Yee(n)}}Yee(AHe);var PHe=function(){for(var e=[],t=Object.create(null),r=tn.create(),n=tn.create(),i=0,a=Xee;i<a.length;i++){for(var o=a[i],s=0,u=o.aliases;s<u.length;s++){var l=u[s];if(e.push([l,o]),t[l])throw new Error("Alias '"+l+"' already in use.");t[l]=o}var c=o.symbol.args;if(c.kind!=="dictionary"){c.type.kind==="oneof"&&De.oneOfValues(c.type).forEach(function(v){return tn.add(n,v,v)});continue}for(var d=0,f=Object.keys(c.map);d<f.length;d++){var l=f[d];isNaN(l)&&tn.add(r,l,l);var p=c.map[l];p.type.kind==="oneof"&&De.oneOfValues(p.type).forEach(function(h){return tn.add(n,h,h)})}}return{symbolList:e,symbolMap:t,namedArgs:r.array,constants:n.array}}(),hm=PHe.symbolMap;function Yy(e){if(Ii.isLiteral(e))return e;if(Ii.isSymbol(e)){if(!hm[e.name])return e;var t=hm[e.name];if(t.kind==="alias")return Ii.Symbol(hm[e.name].symbol.id);throw t.translate([])}var r=Ii.isSymbol(e.head)&&!!hm[e.head.name]&&hm[e.head.name].kind==="macro",n=r?e.head:Yy(e.head),i=n!==e.head;if(!e.args)return r?Yy(e.head):i?Ii.Apply(n):e;var a=!1,o;if(Ii.isArgumentsArray(e.args)){o=[];for(var s=0,u=e.args.length;s<u;s++){var l=e.args[s],c=Yy(l);l!==c&&(a=!0),o[o.length]=c}if(a||(o=e.args),!r&&!i&&!a)return e}else{o={};for(var d=0,f=Object.keys(e.args);d<f.length;d++){var p=f[d],l=e.args[p],c=Yy(l);l!==c&&(a=!0),o[p]=c}if(!r&&!i&&!a)return e;a||(o=e.args)}if(r){var v=hm[e.head.name];if(v.kind!=="macro")return Ii.Apply(n,o);var h=v.translate(o);return h}return Ii.Apply(n,o)}function THe(e){return Yy(e)}var hu=function(){function e(t){this._=t}return e.prototype.parse=function(t){var r=this.skip(e.eof)._(t,0);return r.status?{success:!0,value:r.value}:{success:!1,index:Kee(t,r.furthest),expected:r.expected}},e.prototype.tryParse=function(t){var r=this.parse(t);if(r.success)return r.value;var n=DHe(t,r),i=new Error(n);throw i},e.prototype.or=function(t){return e.alt(this,t)},e.prototype.trim=function(t){return this.wrap(t,t)},e.prototype.wrap=function(t,r){return nT(1,typeof t=="string"?e.string(t):t,this,typeof r=="string"?e.string(r):r)},e.prototype.thru=function(t){return t(this)},e.prototype.then=function(t){return nT(1,this,t)},e.prototype.many=function(){var t=this;return new e(function(r,n){for(var i=[],a=void 0;;)if(a=Rs(t._(r,n),a),a.status){if(n===a.index)throw new Error("infinite loop detected in .many() parser --- calling .many() on a parser which can accept zero characters is usually the cause");n=a.index,i.push(a.value)}else return Rs(Ma(n,i),a)})},e.prototype.times=function(t,r){var n=this,i=typeof r>"u"?t:r;return new e(function(a,o){var s=[],u=void 0,l=void 0,c;for(c=0;c<t;c++)if(u=n._(a,o),l=Rs(u,l),u.status)o=u.index,s.push(u.value);else return l;for(;c<i&&(u=n._(a,o),l=Rs(u,l),u.status);c+=1)o=u.index,s.push(u.value);return Rs(Ma(o,s),l)})},e.prototype.result=function(t){return this.map(function(){return t})},e.prototype.atMost=function(t){return this.times(0,t)},e.prototype.atLeast=function(t){return e.seq(this.times(t),this.many()).map(function(r){return Nt(Nt([],r[0]),r[1])})},e.prototype.map=function(t){var r=this;return new e(function(n,i){var a=r._(n,i);return a.status?Rs(Ma(a.index,t(a.value)),a):a})},e.prototype.skip=function(t){return nT(0,this,t)},e.prototype.mark=function(){return e.seq(e.index,this,e.index).map(function(t){return{start:t[0],value:t[1],end:t[2]}})},e.prototype.node=function(t){return e.seq(e.index,this,e.index).map(function(r){return{name:t,start:r[0],value:r[1],end:r[2]}})},e.prototype.sepBy=function(t){return e.sepBy(this,t)},e.prototype.sepBy1=function(t){return e.sepBy1(this,t)},e.prototype.lookahead=function(t){return this.skip(e.lookahead(t))},e.prototype.notFollowedBy=function(t){return this.skip(e.notFollowedBy(t))},e.prototype.desc=function(t){var r=this;return new e(function(n,i){var a=r._(n,i);return a.status||(a.expected=[t]),a})},e.prototype.fallback=function(t){return this.or(e.succeed(t))},e.prototype.ap=function(t){return e.seq(t,this).map(function(r){var n=r[0],i=r[1];return n(i)})},e.prototype.chain=function(t){var r=this;return new e(function(n,i){var a=r._(n,i);if(!a.status)return a;var o=t(a.value);return Rs(o._(n,a.index),a)})},e}();(function(e){function t(){for(var S=[],x=0;x<arguments.length;x++)S[x]=arguments[x];var C=S.length;return new e(function(w,A){for(var M,D=new Array(C),k=A,R=0;R<C;R++){if(M=Rs(S[R]._(w,k),M),!M.status)return M;D[R]=M.value,k=M.index}return Rs(Ma(k,D),M)})}e.seq=t;function r(){for(var S=[],x=0;x<arguments.length;x++)S[x]=arguments[x];var C=S.length;return C===0?c("zero alternates"):new e(function(w,A){for(var M,D=0;D<S.length;D++)if(M=Rs(S[D]._(w,A),M),M.status)return M;return M})}e.alt=r;function n(S,x){return i(S,x).or(l([]))}e.sepBy=n;function i(S,x){var C=x.then(S).many();return t(S,C).map(function(w){return Nt([w[0]],w[1])})}e.sepBy1=i;function a(S){var x="'"+S+"'";if(S.length===1){var C=S.charCodeAt(0);return new e(function(w,A){return w.charCodeAt(A)===C?Ma(A+1,S):ac(A,x)})}return new e(function(w,A){var M=A+S.length;return w.slice(A,M)===S?Ma(M,S):ac(A,x)})}e.string=a;function o(S){var x=""+S;return x.slice(x.lastIndexOf("/")+1)}function s(S){return RegExp("^(?:"+S.source+")",o(S))}function u(S,x){x===void 0&&(x=0);var C=s(S),w=""+S;return new e(function(A,M){var D=C.exec(A.slice(M));if(D){if(0<=x&&x<=D.length){var k=D[0],R=D[x];return Ma(M+k.length,R)}var O="invalid match group (0 to "+D.length+") in "+w;return ac(M,O)}return ac(M,w)})}e.regexp=u;function l(S){return new e(function(x,C){return Ma(C,S)})}e.succeed=l;function c(S){return new e(function(x,C){return ac(C,S)})}e.fail=c;function d(S){if(kHe(S))return new e(function(x,C){var w=S._(x,C);return w.status&&(w.index=C,w.value=null),w});if(typeof S=="string")return d(a(S));if(S instanceof RegExp)return d(u(S));throw new Error("not a string, regexp, or parser: "+S)}e.lookahead=d;function f(S){return new e(function(x,C){var w=S._(x,C);return w.status?ac(C,'not "'+x.slice(C,w.index)+'"'):Ma(C,null)})}e.notFollowedBy=f;function p(S){return new e(function(x,C){var w=x.charAt(C);return C<x.length&&S(w)?Ma(C+1,w):ac(C,"a character "+S)})}e.test=p;function v(S){return p(function(x){return S.indexOf(x)>=0})}e.oneOf=v;function h(S){return p(function(x){return S.indexOf(x)<0})}e.noneOf=h;function m(S,x){return p(function(C){return S<=C&&C<=x}).desc(S+"-"+x)}e.range=m;function g(S){return new e(function(x,C){for(var w=C;w<x.length&&S(x.charAt(w));)w++;return Ma(w,x.slice(C,w))})}e.takeWhile=g;function y(S){var x=new e(function(C,w){var A=S()._;return x._=A,A(C,w)});return x}e.lazy=y;function b(){return c("empty")}e.empty=b,e.index=new e(function(S,x){return Ma(x,Kee(S,x))}),e.anyChar=new e(function(S,x){return x>=S.length?ac(x,"any character"):Ma(x+1,S.charAt(x))}),e.all=new e(function(S,x){return Ma(S.length,S.slice(x))}),e.eof=new e(function(S,x){return x<S.length?ac(x,"EOF"):Ma(x,null)}),e.digit=u(/[0-9]/).desc("a digit"),e.digits=u(/[0-9]*/).desc("optional digits"),e.letter=u(/[a-z]/i).desc("a letter"),e.letters=u(/[a-z]*/i).desc("optional letters"),e.optWhitespace=u(/\s*/).desc("optional whitespace"),e.whitespace=u(/\s+/).desc("whitespace"),e.cr=a("\r"),e.lf=a(`
`),e.crlf=a(`\r
`),e.newline=r(e.crlf,e.lf,e.cr).desc("newline"),e.end=r(e.newline,e.eof)})(hu||(hu={}));function nT(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];var n=t.length;return new hu(function(i,a){for(var o,s,u=a,l=0;l<n;l++){if(o=Rs(t[l]._(i,u),o),!o.status)return o;e===l&&(s=o.value),u=o.index}return Rs(Ma(u,s),o)})}function Ma(e,t){return{status:!0,index:e,value:t}}function ac(e,t){return{status:!1,furthest:e,expected:[t]}}function Rs(e,t){if(!t||e.status||t.status||e.furthest>t.furthest)return e;var r=e.furthest===t.furthest?RHe(e.expected,t.expected):t.expected;return{status:e.status,furthest:t.furthest,expected:r}}function Kee(e,t){var r=e.slice(0,t).split(`
`),n=r.length,i=r[r.length-1].length+1;return{offset:t,line:n,column:i}}function IHe(e){return e.length===1?e[0]:"one of "+e.join(", ")}function MHe(e,t){var r=t.index,n=r.offset;if(n===e.length)return", got the end of the input";var i=n>0?"'...":"'",a=e.length-n>12?"...'":"'";return" at line "+r.line+" column "+r.column+", got "+i+e.slice(n,n+12)+a}function DHe(e,t){return"expected "+IHe(t.expected)+MHe(e,t)}function RHe(e,t){var r=e.length,n=t.length;if(r===0)return t;if(n===0)return e;for(var i=new Set,a=[],o=0;o<r;o++)i.has(e[o])||(a[a.length]=e[o],i.add(e[o]));for(var o=0;o<n;o++)i.has(t[o])||(a[a.length]=t[o],i.add(t[o]));return a.sort(),a}function kHe(e){return e instanceof hu}function OHe(e){return TD.parse(e)}var TD;(function(e){var t;(function(S){function x(M){return{kind:"string",value:M}}S.str=x;function C(M){return{kind:"symbol",value:M}}S.symb=C;function w(M,D){return{kind:"list",bracket:M,nodes:D}}S.list=w;function A(M){return{kind:"comment",value:M}}S.comment=A})(t||(t={}));var r=hu.regexp(/[\n\r\s]*/),n=hu.lazy(function(){return hu.alt(i,d,a,o).trim(r)}),i=hu.takeWhile(function(S){return S!=="`"}).trim("`").map(t.str),a=hu.regexp(/[^()\[\]{};`,\n\r\s]+/).map(t.symb),o=hu.regexp(/\s*;+([^\n\r]*)\n/,1).map(t.comment),s=n.many(),u=s.wrap("(",")").map(function(S){return t.list("(",S)}),l=s.wrap("[","]").map(function(S){return t.list("[",S)}),c=s.wrap("{","}").map(function(S){return t.list("{",S)}),d=hu.alt(u,l,c),f=n.many();function p(S){return f.tryParse(S)}function v(S){switch(S.kind){case"string":return S.value;case"symbol":{var x=S.value;if(x.length>1){var C=x.charAt(0);switch(C){case".":return se.atomName(x.substr(1));case"_":return se.struct.type.elementSymbol([x.substr(1)])}}return x==="true"?!0:x==="false"?!1:y(x)?+x:Ii.Symbol(x)}case"list":{switch(S.bracket){case"[":return se.core.type.list(g(S.nodes).map(v));case"{":return se.core.type.set(g(S.nodes).map(v));case"(":{var w=v(S.nodes[0]);return Ii.Apply(w,h(S.nodes))}}return 0}default:throw new Error("should not happen")}}function h(S){if(!(S.length<=1)){if(!m(S)){for(var x=[],C=1,w=S.length;C<w;C++){var A=S[C];A.kind!=="comment"&&(x[x.length]=v(A))}return x}for(var M={},D=!0,k=0,C=1,w=S.length;C<w;C++){var A=S[C];if(A.kind!=="comment")if(A.kind==="symbol"&&A.value.length>1&&A.value.charAt(0)===":"){var R=A.value.substr(1);for(++C;C<w&&S[C].kind==="comment";)C++;if(C>=w)throw new Error("There must be a value foolowed a named arg ':"+R+"'.");M[R]=v(S[C]),isNaN(+R)&&(D=!1)}else M[k++]=v(A)}if(D){for(var O=Object.keys(M).map(function(j){return+j}).sort(function(j,Y){return j-Y}),H=!0,C=0,w=O.length;C<w;C++)if(O[C]!==C){H=!1;break}if(H){for(var B=[],C=0,w=O.length;C<w;C++)B[C]=M[C];return B}}return M}}function m(S){for(var x=1,C=S.length;x<C;x++){var w=S[x];if(w.kind==="symbol"&&w.value.length>1&&w.value.charAt(0)===":")return!0}return!1}function g(S){for(var x=!1,C=0,w=S.length;C<w;C++)if(S[C].kind==="comment"){x=!0;break}return x?S.filter(function(A){return A.kind!=="comment"}):S}function y(S){return/-?(0|[1-9][0-9]*)([.][0-9]+)?([eE][+-]?[0-9]+)?/.test(S)&&!isNaN(+S)}function b(S){for(var x=p(S),C=[],w=0,A=x;w<A.length;w++){var M=A[w];M.kind!=="comment"&&(C[C.length]=v(M))}return C}e.parse=b})(TD||(TD={}));function Vi(e,t){return{expression:e,language:t}}(function(e){function t(s){return!!s&&typeof s.expression=="string"&&!!s.language}e.is=t;function r(s,u){return s.language===u.language&&s.expression===u.expression}e.areEqual=r;function n(s){switch(s.language){case"mol-script":var u=OHe(s.expression);if(u.length===0)throw new Error("No query");return THe(u[0])}throw new Error("unsupported script language")}e.toExpression=n;function i(s){var u=n(s);return gv(u)}e.toQuery=i;function a(s,u){var l=i(s),c=l(new us(u));return mt.toLociWithSourceUnits(c)}e.toLoci=a;function o(s,u,l){var c=typeof s=="function"?s(se):s,d=gv(c);return d(new us(u,l))}e.getStructureSelection=o})(Vi||(Vi={}));var Hh;(function(e){function t(u,l){var c=u&&fi.Provider.get(u),d=c?c.assemblies.map(function(S){return[S.id,S.id+": "+Zo(S.details)]}):[],f=c?!Mo.isZero(c.spacegroup.cell):!0,p=[];if(c)for(var v=c.spacegroup.operators,h=0,m=v.length;h<m;h++)p.push([h,h+1+": "+Vu.getOperatorXyz(v[h])]);var g=[];u&&u.properties.structAsymMap.forEach(function(S){var x=S.id===S.auth_id?S.id:S.id+" [auth "+S.auth_id+"]";g.push([S.id,x])});var y={auto:I.EmptyGroup(),model:I.EmptyGroup(),assembly:I.Group({id:I.Optional(u?I.Select(d.length?d[0][0]:"",d,{label:"Asm Id",description:"Assembly Id"}):I.Text("",{label:"Asm Id",description:"Assembly Id (use empty for the 1st assembly)"}))},{isFlat:!0}),"symmetry-mates":I.Group({radius:I.Numeric(5,{min:0,max:50,step:1})},{isFlat:!0}),symmetry:I.Group({ijkMin:I.Vec3(_.create(-1,-1,-1),{step:1},{label:"Min IJK",fieldLabels:{x:"I",y:"J",z:"K"}}),ijkMax:I.Vec3(_.create(1,1,1),{step:1},{label:"Max IJK",fieldLabels:{x:"I",y:"J",z:"K"}})},{isFlat:!0}),"symmetry-assembly":I.Group({generators:I.ObjectList({operators:I.ObjectList({index:I.Select(0,p),shift:I.Vec3(_(),{step:1},{label:"IJK",fieldLabels:{x:"I",y:"J",z:"K"}})},function(S){return S.index+1+"_"+S.shift.map(function(x){return x+5}).join("")},{defaultValue:[]}),asymIds:I.MultiSelect([],g)},function(S){return S.asymIds.length+" asym ids, "+S.operators.length+" operators"},{defaultValue:[]})},{isFlat:!0})},b=[];return l==="auto"&&b.push(["auto","Auto"]),b.push(["model","Model"]),d.length>0&&b.push(["assembly","Assembly"]),f&&(b.push(["symmetry-mates","Symmetry Mates"]),b.push(["symmetry","Symmetry (indices)"]),b.push(["symmetry-assembly","Symmetry (assembly)"])),{type:I.MappedStatic(l||"model",y,{options:b})}}e.getParams=t;function r(u,l){return!(l.name==="symmetry-assembly"||l.name==="symmetry"&&u.name==="symmetry")}e.canAutoUpdate=r;function n(u,l,c,d){return ce(this,void 0,void 0,function(){var f,p,v,h,m,g;return de(this,function(y){switch(y.label){case 0:return f=void 0,p=fi.Provider.get(c),!d&&p&&p.assemblies.length!==0&&(d=p.assemblies[0].id),!p||p.assemblies.length===0?u.log.warn("Model '"+c.entryId+"' has no assembly, returning model structure."):(f=wb.findAssembly(c,d||""),f||u.log.warn("Model '"+c.entryId+"' has no assembly called '"+d+"', returning model structure.")),v=We.ofModel(c),f?(d=f.id,[4,wl.buildAssembly(v,d).runInContext(l)]):(h={label:"Model",description:We.elementDescription(v)},[2,new ge.Molecule.Structure(v,h)]);case 1:return m=y.sent(),g={label:"Assembly "+d,description:We.elementDescription(m)},[2,new ge.Molecule.Structure(m,g)]}})})}function i(u,l,c,d){return ce(this,void 0,void 0,function(){var f,p,v;return de(this,function(h){switch(h.label){case 0:return f=We.ofModel(l),[4,wl.buildSymmetryRange(f,c,d).runInContext(u)];case 1:return p=h.sent(),v={label:"Symmetry ["+c+"] to ["+d+"]",description:We.elementDescription(p)},[2,new ge.Molecule.Structure(p,v)]}})})}function a(u,l,c){return ce(this,void 0,void 0,function(){var d,f,p;return de(this,function(v){switch(v.label){case 0:return d=We.ofModel(l),[4,wl.builderSymmetryMates(d,c).runInContext(u)];case 1:return f=v.sent(),p={label:"Symmetry Mates",description:We.elementDescription(f)},[2,new ge.Molecule.Structure(f,p)]}})})}function o(u,l,c,d){return ce(this,void 0,void 0,function(){var f,p,v;return de(this,function(h){switch(h.label){case 0:return f=We.ofModel(l),[4,wl.buildSymmetryAssembly(f,c,d).runInContext(u)];case 1:return p=h.sent(),v={label:"Symmetry Assembly",description:We.elementDescription(p)},[2,new ge.Molecule.Structure(p,v)]}})})}function s(u,l,c,d){return ce(this,void 0,void 0,function(){var f,p,p;return de(this,function(v){if(f=fi.Provider.get(c),!f||!d||d.name==="model")return p=We.ofModel(c),[2,new ge.Molecule.Structure(p,{label:"Model",description:We.elementDescription(p)})];if(d.name==="auto")return f.assemblies.length===0?(p=We.ofModel(c),[2,new ge.Molecule.Structure(p,{label:"Model",description:We.elementDescription(p)})]):[2,n(u,l,c)];if(d.name==="assembly")return[2,n(u,l,c,d.params.id)];if(d.name==="symmetry")return[2,i(l,c,d.params.ijkMin,d.params.ijkMax)];if(d.name==="symmetry-mates")return[2,a(l,c,d.params.radius)];if(d.name==="symmetry-assembly")return[2,o(l,c,d.params.generators,f)];throw new Error("Unknown represetation type: "+d.name)})})}e.create=s})(Hh||(Hh={}));var Na;(function(e){function t(s,u,l){return s.currentStructure!==l?!1:Vi.is(u)?!!s.script&&Vi.areEqual(s.script,u):s.expression===u}e.isUnchanged=t;function r(s,u){var l=Vi.is(u)?u:void 0,c=Vi.is(u)?Vi.toExpression(u):u,d=gv(c);return{script:l,expression:c,compiled:d,originalStructure:s,currentStructure:s}}e.create=r;function n(s,u){return s.compiled(new us(u))}e.run=n;function i(s,u){var l=r(s,u);return{entry:l,selection:n(l,s)}}e.createAndRun=i;function a(s,u){return s.currentStructure=u,s.compiled(new us(u))}e.updateStructure=a;function o(s,u,l){var c=mt.unionStructure(u);s.label=""+(l||"Selection"),s.description=We.elementDescription(c),s.data=c}e.updateStructureObject=o})(Na||(Na={}));var LHe=function(){return{type:I.MappedStatic("static",{static:I.Text("polymer"),expression:I.Value(se.struct.generator.all),bundle:I.Value(rn.Empty),script:I.Script({language:"mol-script",expression:"(sel.atom.all)"})},{isHidden:!0}),nullIfEmpty:I.Optional(I.Boolean(!0,{isHidden:!0})),label:I.Text("",{isHidden:!0})}};function FHe(e,t,r){r.source=e;var n=We.Empty,i=void 0;switch(t.type.name){case"static":{var a=void 0;switch(t.type.params){case"all":a=mi.all.query,i="All";break;case"polymer":a=mi.polymer.query,i="Polymer";break;case"protein":a=mi.protein.query,i="Protein";break;case"nucleic":a=mi.nucleic.query,i="Nucleic";break;case"water":a=nn.internal.water(),i="Water";break;case"ion":a=mi.ion.query,i="Ion";break;case"lipid":a=mi.lipid.query,i="Lipid";break;case"branched":a=mi.branchedPlusConnected.query,i="Branched";break;case"ligand":a=mi.ligandPlusConnected.query,i="Ligand";break;case"non-standard":a=mi.nonStandardPolymer.query,i="Non-standard";break;case"coarse":a=mi.coarse.query,i="Coarse";break;default:throw new Error(t.type+" is a not valid complex element.")}var o=a(new us(e));n=mt.unionStructure(o);break}case"script":case"expression":{var s=Na.createAndRun(e,t.type.params),u=s.selection,l=s.entry;r.entry=l,n=mt.unionStructure(u);break}case"bundle":{if(t.type.params.hash!==e.hashCode)break;n=rn.toStructure(t.type.params,e);break}}if(t.nullIfEmpty&&n.elementCount===0)return On.Null;var c={label:""+(t.label||i||"Component"),description:We.elementDescription(n)};return new ge.Molecule.Structure(n,c)}function NHe(e,t,r,n,i){if(r.type.name!==n.type.name)return ft.UpdateResult.Recreate;var a=!1;switch(n.type.name){case"static":return r.type.params!==n.type.params||!We.areEquivalent(e,i.source)?ft.UpdateResult.Recreate:t.data.model===e.model?ft.UpdateResult.Unchanged:$t.areHierarchiesEqual(e.model,t.data.model)?(t.data=t.data.remapModel(e.model),ft.UpdateResult.Updated):ft.UpdateResult.Recreate;case"script":if(!Vi.areEqual(r.type.params,n.type.params))return ft.UpdateResult.Recreate;case"expression":{if(r.type.params!==n.type.params)return ft.UpdateResult.Recreate;if(e===i.source)break;var o=i.entry,s=Na.updateStructure(o,e);i.source=e,t.data=mt.unionStructure(s),Na.updateStructureObject(t,s,n.label),a=!0;break}case"bundle":{if(e===i.source&&rn.areEqual(r.type.params,n.type.params))break;i.source=e,n.type.params.hash!==e.hashCode?(a=t.data.elementCount!==0,t.data=t.data.elementCount===0?t.data:We.Empty):(a=!0,t.data=rn.toStructure(n.type.params,e));break}}if(a){if(n.nullIfEmpty&&t.data.elementCount===0)return ft.UpdateResult.Null;t.description=We.elementDescription(t.data)}return r.label!==n.label&&(a=!0,t.label=""+(n.label||t.label)),a?ft.UpdateResult.Updated:ft.UpdateResult.Unchanged}function Qee(e,t){for(var r=pt.create(e.data,t*2),n=pt.create(e.data,t*2),i=pt.create(e.data,t*2),a=pt.create(e.data,t*2),o=0;o<t;++o){It.markLine(e);var s=e.tokenStart,u=e.position;It.trim(e,s,s+10),pt.addUnchecked(r,e.tokenStart,e.tokenEnd),It.trim(e,s+10,s+20),pt.addUnchecked(n,e.tokenStart,e.tokenEnd),It.trim(e,s+20,s+30),pt.addUnchecked(i,e.tokenStart,e.tokenEnd),It.trim(e,s+31,s+34),pt.addUnchecked(a,e.tokenStart,e.tokenEnd),e.position=u}return{count:t,x:Xr(r)(ve.Schema.float),y:Xr(n)(ve.Schema.float),z:Xr(i)(ve.Schema.float),type_symbol:Xr(a)(ve.Schema.str)}}function Zee(e,t){for(var r=pt.create(e.data,t*2),n=pt.create(e.data,t*2),i=pt.create(e.data,t*2),a=0;a<t;++a){It.markLine(e);var o=e.tokenStart,s=e.position;It.trim(e,o,o+3),pt.addUnchecked(r,e.tokenStart,e.tokenEnd),It.trim(e,o+3,o+6),pt.addUnchecked(n,e.tokenStart,e.tokenEnd),It.trim(e,o+6,o+9),pt.addUnchecked(i,e.tokenStart,e.tokenEnd),e.position=s}return{count:t,atomIdxA:Xr(r)(ve.Schema.int),atomIdxB:Xr(n)(ve.Schema.int),order:Xr(i)(ve.Schema.int)}}function BHe(e){var t=It(e),r=It.readLine(t).trim(),n=It.readLine(t).trim(),i=It.readLine(t).trim(),a=It.readLine(t),o=+a.substr(0,3),s=+a.substr(3,3),u=Qee(t,o),l=Zee(t,s),c={title:r,program:n,comment:i,atoms:u,bonds:l};return In.success(c)}function UHe(e){var t=this;return $e.create("Parse Mol",function(){return ce(t,void 0,void 0,function(){return de(this,function(r){return[2,BHe(e)]})})})}function Jee(e,t,r){return ce(this,void 0,void 0,function(){var n,i,a,o,s,u,l,c,d,f,p,v,h,m,g;return de(this,function(y){switch(y.label){case 0:return n=e.atoms,i=e.bonds,a=ve.ofConst("MOL",e.atoms.count,ve.Schema.str),o=ve.ofConst("A",e.atoms.count,ve.Schema.str),s=ve.asArrayColumn(n.type_symbol),u=ve.ofConst(1,n.count,ve.Schema.int),l=Qr.ofPartialColumns(to.atom_site,{auth_asym_id:o,auth_atom_id:s,auth_comp_id:a,auth_seq_id:u,Cartn_x:ve.asArrayColumn(n.x,Float32Array),Cartn_y:ve.asArrayColumn(n.y,Float32Array),Cartn_z:ve.asArrayColumn(n.z,Float32Array),id:ve.range(0,n.count-1),label_asym_id:o,label_atom_id:s,label_comp_id:a,label_seq_id:u,label_entity_id:ve.ofConst("1",n.count,ve.Schema.str),occupancy:ve.ofConst(1,n.count,ve.Schema.float),type_symbol:s,pdbx_PDB_model_num:ve.ofConst(1,n.count,ve.Schema.int)},n.count),c=new Mp,c.setNames([["MOL","Unknown Entity"]]),c.getEntityId("MOL",0,"A"),d=new Ip(u,s),d.setNames([["MOL","Unknown Molecule"]]),d.add("MOL",0),f=Fv({entity:c.getEntityTable(),chem_comp:d.getChemCompTable(),atom_site:l}),[4,xd(f,t??ID.create(e),r)];case 1:return p=y.sent(),p.frameCount>0&&(v=ve.ofIntArray(ve.mapToArray(i.atomIdxA,function(b){return b-1},Int32Array)),h=ve.ofIntArray(ve.mapToArray(i.atomIdxB,function(b){return b-1},Int32Array)),m=ve.asArrayColumn(i.order,Int32Array),g=xa.fromData({pairs:{indexA:v,indexB:h,order:m},count:n.count}),xa.Provider.set(p.representative,g)),[2,p]}})})}var ID;(function(e){function t(n){return(n==null?void 0:n.kind)==="mol"}e.is=t;function r(n){return{kind:"mol",name:n.title,data:n}}e.create=r})(ID||(ID={}));function jHe(e){return $e.create("Parse MOL",function(t){return Jee(e,void 0,t)})}function zHe(e){var t=e.IT_number.value(0),r=e["name_H-M_full"].value(0);return e.IT_number.isDefined?(e["name_H-M_full"].isDefined,t):r}function VHe(e){var t=e.cell,r=e.space_group,n=zHe(r),i=Mo.create(n,_.create(t.length_a.value(0),t.length_b.value(0),t.length_c.value(0)),_.scale(_(),_.create(t.angle_alpha.value(0),t.angle_beta.value(0),t.angle_gamma.value(0)),Math.PI/180));return{spacegroup:Vu.create(i),assemblies:[],isNonStandardCrystalFrame:!1,ncsOperators:[]}}function HHe(e,t,r){var n;return ce(this,void 0,void 0,function(){var i,a,o,s,u,l,c,d,f,p,v,h,m,g,Se,y,b,S,x,C,D,w,Se,A,M,D,Se,k,R,O,H,B,j,Y,G,$,q,Se,ee,fe,W,X,U,z,J,K,Z,te,le,ye,be,Ae,Se,ie,oe,L,V;return de(this,function(he){switch(he.label){case 0:for(i=e.atom_site._rowCount,a=ve.ofConst("MOL",i,ve.Schema.str),o=ve.ofConst("A",i,ve.Schema.str),s=ve.ofConst(1,i,ve.Schema.int),u=VHe(e),l=u.spacegroup.cell.fromFractional,c=e.atom_site,d=c.fract_x,f=c.fract_y,p=c.fract_z,v=new Float32Array(i),h=new Float32Array(i),m=new Float32Array(i),g=_(),Se=0;Se<i;++Se)_.set(g,d.value(Se),f.value(Se),p.value(Se)),_.transformMat4(g,g,l),v[Se]=g[0],h[Se]=g[1],m[Se]=g[2];if(y=e.atom_site,b=y.type_symbol,S=y.label,b.isDefined){for(D=new Array(i),w=new Int8Array(i),Se=0;Se<i;++Se)A=b.value(Se),M=A.length,A[M-1]==="+"?(D[Se]=A.substring(0,M-2),w[Se]=parseInt(A[M-2])):A[M-2]==="+"?(D[Se]=A.substring(0,M-2),w[Se]=parseInt(A[M-1])):A[M-1]==="-"?(D[Se]=A.substring(0,M-2),w[Se]=-parseInt(A[M-2])):A[M-2]==="-"?(D[Se]=A.substring(0,M-2),w[Se]=-parseInt(A[M-1])):(D[Se]=A,w[Se]=0);x=ve.ofStringArray(D),C=ve.ofIntArray(w)}else{for(D=new Array(i),Se=0;Se<i;++Se)D[Se]=LE(S.value(Se));x=ve.ofStringArray(D),C=ve.Undefined(i,ve.Schema.int)}return k=Qr.ofPartialColumns(to.atom_site,{auth_asym_id:o,auth_atom_id:S,auth_comp_id:a,auth_seq_id:s,Cartn_x:ve.ofFloatArray(v),Cartn_y:ve.ofFloatArray(h),Cartn_z:ve.ofFloatArray(m),id:ve.range(0,i-1),label_asym_id:o,label_atom_id:S,label_comp_id:a,label_seq_id:s,label_entity_id:ve.ofConst("1",i,ve.Schema.str),occupancy:e.atom_site.occupancy.isDefined?e.atom_site.occupancy:ve.ofConst(1,i,ve.Schema.float),type_symbol:x,pdbx_formal_charge:C,pdbx_PDB_model_num:ve.ofConst(1,i,ve.Schema.int),B_iso_or_equiv:e.atom_site.U_iso_or_equiv},i),R=e.chemical.name_common.value(0)||e.chemical.name_systematic.value(0)||e.chemical_formula.sum.value(0),O=new Mp,O.setNames([["MOL",R||"Unknown Entity"]]),O.getEntityId("MOL",0,"A"),H=new Ip(s,e.atom_site.type_symbol),H.setNames([["MOL",R||"Unknown Molecule"]]),H.add("MOL",0),B=Fv({entity:O.getEntityTable(),chem_comp:H.getChemCompTable(),atom_site:k}),[4,xd(B,t,r)];case 1:if(j=he.sent(),j.frameCount>0&&(Y=j.representative,fi.Provider.set(Y,u),G=e.geom_bond._rowCount,G>0)){for($={},q=e.atom_site.label,Se=0,ee=q.rowCount;Se<ee;++Se)$[q.value(Se)]=Se;for(fe=(n=t.data.frame.categories.ccdc_geom_bond_type)===null||n===void 0?void 0:n.getField(""),W=[],X=[],U=[],z=[],J=[],K=new Set,Z=0,te=e.geom_bond,le=te.atom_site_label_1,ye=te.atom_site_label_2,be=te.valence,Ae=te.distance,Se=0;Se<G;++Se)ie=$[le.value(Se)],oe=$[ye.value(Se)],L=ie<oe?Qf(ie,oe):Qf(oe,ie),!K.has(L)&&(K.add(L),W[Z]=ie,X[Z]=oe,z[Z]=Ae.value(Se)||-1,fe?(V=fe.str(Se),V==="D"?(U[Z]=2,J[Z]=1):V==="A"?(U[Z]=1,J[Z]=17):(U[Z]=1,J[Z]=1)):(J[Z]=1,U[Z]=be.isDefined?be.value(Se):1),Z+=1);xa.Provider.set(Y,xa.fromData({pairs:{indexA:ve.ofIntArray(W),indexB:ve.ofIntArray(X),order:ve.ofIntArray(U),distance:ve.ofFloatArray(z),flag:ve.ofIntArray(J)},count:i}))}return[2,j]}})})}function GHe(e){if(Rb.is(e.sourceData)){var t=e.sourceData.data.db,r=t.atom_site,n=t.atom_site_aniso,i=Qr.ofPartialColumns(Ul.Schema,{U:n.U,U_esd:n.U_su},n._rowCount),a=Ul.getElementToAnsiotropFromLabel(r.label,n.label);return{data:i,elementToAnsiotrop:a}}}function qHe(e){return Rb.is(e.sourceData)?e.sourceData.data.db.atom_site_aniso.U.isDefined:!1}Ul.Provider.formatRegistry.add("cifCore",GHe,qHe);var Rb;(function(e){function t(n){return(n==null?void 0:n.kind)==="cifCore"}e.is=t;function r(n,i){i||(i=td.schema.cifCore(n));var a=i.database_code.depnum_ccdc_archive.value(0)||i.database_code.depnum_ccdc_fiz.value(0)||i.database_code.ICSD.value(0)||i.database_code.MDF.value(0)||i.database_code.NBS.value(0)||i.database_code.CSD.value(0)||i.database_code.COD.value(0)||i._name;return{kind:"cifCore",name:a,data:{db:i,frame:n}}}e.fromFrame=r})(Rb||(Rb={}));function $He(e){var t=Rb.fromFrame(e);return $e.create("Parse CIF Core",function(r){return HHe(t.data.db,t,r)})}function WHe(e,t){return ce(this,void 0,void 0,function(){var r,n,i,a,o,s,u,l,c;return de(this,function(d){switch(d.label){case 0:return r=e.atoms,n=ve.ofConst("MOL",e.atoms.count,ve.Schema.str),i=ve.ofConst("A",e.atoms.count,ve.Schema.str),a=ve.ofArray({array:ve.mapToArray(r.number,function(f){return Ske(f)}),schema:ve.Schema.Aliased(ve.Schema.str)}),o=ve.ofConst(1,r.count,ve.Schema.int),s=Qr.ofPartialColumns(to.atom_site,{auth_asym_id:i,auth_atom_id:a,auth_comp_id:n,auth_seq_id:o,Cartn_x:ve.asArrayColumn(r.x,Float32Array),Cartn_y:ve.asArrayColumn(r.y,Float32Array),Cartn_z:ve.asArrayColumn(r.z,Float32Array),id:ve.range(0,r.count-1),label_asym_id:i,label_atom_id:a,label_comp_id:n,label_seq_id:o,label_entity_id:ve.ofConst("1",r.count,ve.Schema.str),occupancy:ve.ofConst(1,r.count,ve.Schema.float),type_symbol:a,pdbx_PDB_model_num:ve.ofConst(1,r.count,ve.Schema.int)},r.count),u=new Mp,u.setNames([["MOL","Unknown Entity"]]),u.getEntityId("MOL",0,"A"),l=new Ip(o,a),l.setNames([["MOL","Unknown Molecule"]]),l.add("MOL",0),c=Fv({entity:u.getEntityTable(),chem_comp:l.getChemCompTable(),atom_site:s}),[4,xd(c,MD.create(e),t)];case 1:return[2,d.sent()]}})})}var MD;(function(e){function t(n){return(n==null?void 0:n.kind)==="cube"}e.is=t;function r(n){return{kind:"cube",name:n.header.comment1,data:n}}e.create=r})(MD||(MD={}));function XHe(e){return $e.create("Parse Cube",function(t){return WHe(e,t)})}var XL=It.skipWhitespace,ete=It.eatValue,cl=It.markLine,dl=It.getTokenString,tte=It.readLine;function YHe(){return{mol_name:"",num_atoms:0,num_bonds:0,num_subst:0,num_feat:0,num_sets:0,mol_type:"",charge_type:"",status_bits:"",mol_comment:""}}function KHe(e,t){return{tokenizer:e,molecule:YHe(),runtimeCtx:t}}var QHe=/\s+/g;function ZHe(e){for(var t=e.tokenizer,r=e.molecule;dl(t)!=="@<TRIPOS>MOLECULE"&&t.position<t.data.length;)cl(t);cl(t),r.mol_name=dl(t),cl(t);var n=dl(t).trim().split(QHe);r.num_atoms=parseInt(n[0]),r.num_bonds=parseInt(n[1]),r.num_subst=parseInt(n[2]),r.num_feat=parseInt(n[3]),r.num_sets=parseInt(n[4]),cl(t);var i=dl(t);if(!i.startsWith("@<TRIPOS>")){r.mol_type=i,cl(t);var a=dl(t);if(!a.startsWith("@<TRIPOS>")){r.charge_type=a,cl(t);var o=dl(t);if(!o.startsWith("@<TRIPOS>")){r.status_bits=o,cl(t);var s=dl(t);s.startsWith("@<TRIPOS>")||(r.mol_comment=s)}}}}function JHe(e){return ce(this,void 0,void 0,function(){var t,r,n,i,a,o,s,u,l,c,d,f,p,v,h,m,g,y,b,S,x,C,w;return de(this,function(A){switch(A.label){case 0:for(t=e.tokenizer,r=e.molecule;dl(t)!=="@<TRIPOS>ATOM"&&t.position<t.data.length;)cl(t);return n=t.position,i=t.lineNumber,a=tte(t),o=a.trim().split(/\s+/g),s=o.length,u=pt.create(t.data,r.num_atoms*2),l=pt.create(t.data,r.num_atoms*2),c=pt.create(t.data,r.num_atoms*2),d=pt.create(t.data,r.num_atoms*2),f=pt.create(t.data,r.num_atoms*2),p=pt.create(t.data,r.num_atoms*2),v=pt.create(t.data,r.num_atoms*2),h=pt.create(t.data,r.num_atoms*2),m=pt.create(t.data,r.num_atoms*2),g=pt.create(t.data,r.num_atoms*2),y=ve.Undefined(r.num_atoms,ve.Schema.float),b=ve.Undefined(r.num_atoms,ve.Schema.int),S=ve.Undefined(r.num_atoms,ve.Schema.str),t.position=n,t.lineNumber=i,x=t.length,C=0,[4,Zc(e.runtimeCtx,1e5,void 0,function(M){for(var D=Math.min(r.num_atoms-C,M),k=0;k<D;k++)for(var R=0;R<s;R++)switch(XL(t),t.tokenStart=t.position,ete(t),R){case 0:pt.addUnchecked(u,t.tokenStart,t.tokenEnd);break;case 1:pt.addUnchecked(l,t.tokenStart,t.tokenEnd);break;case 2:pt.addUnchecked(c,t.tokenStart,t.tokenEnd);break;case 3:pt.addUnchecked(d,t.tokenStart,t.tokenEnd);break;case 4:pt.addUnchecked(f,t.tokenStart,t.tokenEnd);break;case 5:pt.addUnchecked(p,t.tokenStart,t.tokenEnd);break;case 6:pt.addUnchecked(v,t.tokenStart,t.tokenEnd);break;case 7:pt.addUnchecked(h,t.tokenStart,t.tokenEnd);break;case 8:pt.addUnchecked(m,t.tokenStart,t.tokenEnd);break;case 9:pt.addUnchecked(g,t.tokenStart,t.tokenEnd);break}return C+=D,D},function(M){return M.update({message:"Parsing...",current:t.position,max:x})})];case 1:return A.sent(),w={count:r.num_atoms,atom_id:Xr(u)(ve.Schema.int),atom_name:Xr(l)(ve.Schema.str),x:Xr(c)(ve.Schema.float),y:Xr(d)(ve.Schema.float),z:Xr(f)(ve.Schema.float),atom_type:s>5?Xr(p)(ve.Schema.str):S,subst_id:s>6?Xr(v)(ve.Schema.int):b,subst_name:s>7?Xr(h)(ve.Schema.str):S,charge:s>8?Xr(m)(ve.Schema.float):y,status_bit:s>9?Xr(g)(ve.Schema.str):S},[2,w]}})})}function eGe(e){return ce(this,void 0,void 0,function(){var t,r,n,i,a,o,s,u,l,c,d,f,p,v,h;return de(this,function(m){switch(m.label){case 0:for(t=e.tokenizer,r=e.molecule;dl(t)!=="@<TRIPOS>BOND"&&t.position<t.data.length;)cl(t);return n=t.position,i=t.lineNumber,a=tte(t),o=a.trim().split(/\s+/g),s=o.length,u=pt.create(t.data,r.num_bonds*2),l=pt.create(t.data,r.num_bonds*2),c=pt.create(t.data,r.num_bonds*2),d=pt.create(t.data,r.num_bonds*2),f=pt.create(t.data,r.num_bonds*2),t.position=n,t.lineNumber=i,p=t.length,v=0,[4,Zc(e.runtimeCtx,1e5,void 0,function(g){for(var y=Math.min(r.num_bonds-v,g),b=0;b<y;b++)for(var S=0;S<s;S++)switch(XL(t),t.tokenStart=t.position,ete(t),S){case 0:pt.addUnchecked(u,t.tokenStart,t.tokenEnd);break;case 1:pt.addUnchecked(l,t.tokenStart,t.tokenEnd);break;case 2:pt.addUnchecked(c,t.tokenStart,t.tokenEnd);break;case 3:pt.addUnchecked(d,t.tokenStart,t.tokenEnd);break;default:pt.addUnchecked(f,t.tokenStart,t.tokenEnd);break}return v+=y,y},function(g){return g.update({message:"Parsing...",current:t.position,max:p})})];case 1:return m.sent(),h={count:r.num_bonds,bond_id:Xr(u)(ve.Schema.int),origin_atom_id:Xr(l)(ve.Schema.int),target_atom_id:Xr(c)(ve.Schema.int),bond_type:Xr(d)(ve.Schema.str),status_bits:s>4?Xr(f)(ve.Schema.str):ve.Undefined(r.num_bonds,ve.Schema.str)},[2,h]}})})}function tGe(e,t,r){return ce(this,void 0,void 0,function(){var n,i,a,o,s,u;return de(this,function(l){switch(l.label){case 0:n=It(t),e.update({message:"Parsing...",current:0,max:t.length}),i=[],l.label=1;case 1:return n.position<t.length?(a=KHe(n,e),ZHe(a),[4,JHe(a)]):[3,4];case 2:return o=l.sent(),[4,eGe(a)];case 3:for(s=l.sent(),i.push({molecule:a.molecule,atoms:o,bonds:s}),XL(n);dl(n)!=="@<TRIPOS>MOLECULE"&&n.position<n.data.length;)cl(n);return[3,1];case 4:return u={name:r,structures:i},[2,In.success(u)]}})})}function rGe(e,t){var r=this;return $e.create("Parse MOL2",function(n){return ce(r,void 0,void 0,function(){return de(this,function(i){switch(i.label){case 0:return[4,tGe(n,e,t)];case 1:return[2,i.sent()]}})})})}function nGe(e,t){return ce(this,void 0,void 0,function(){var r,n,i,a,o,s,u,l,c,d,f,p,v,h,m,g,y,b,S,x,C,w,A;return de(this,function(M){switch(M.label){case 0:r=[],n=0,i=e.structures.length,M.label=1;case 1:if(!(n<i))return[3,4];for(a=e.structures[n],o=a.atoms,s=a.bonds,u=a.molecule,l=ve.ofConst("A",o.count,ve.Schema.str),c=new Array(o.count),d=0;d<o.count;++d)c[d]=LE(o.atom_name.value(d));for(f=Qr.ofPartialColumns(to.atom_site,{auth_asym_id:l,auth_atom_id:ve.asArrayColumn(o.atom_name),auth_comp_id:o.subst_name,auth_seq_id:o.subst_id,Cartn_x:ve.asArrayColumn(o.x,Float32Array),Cartn_y:ve.asArrayColumn(o.y,Float32Array),Cartn_z:ve.asArrayColumn(o.z,Float32Array),id:ve.asArrayColumn(o.atom_id),label_asym_id:l,label_atom_id:ve.asArrayColumn(o.atom_name),label_comp_id:o.subst_name,label_seq_id:o.subst_id,label_entity_id:ve.ofConst("1",o.count,ve.Schema.str),occupancy:ve.ofConst(1,o.count,ve.Schema.float),type_symbol:ve.ofStringArray(c),pdbx_PDB_model_num:ve.ofConst(n,o.count,ve.Schema.int)},o.count),p=new Mp,p.setNames([["MOL",u.mol_name||"Unknown Entity"]]),p.getEntityId("MOL",0,"A"),v=new Ip(o.subst_id,o.atom_name),h=0,m=o.subst_name.rowCount;h<m;++h)v.add(o.subst_name.value(h),h);return g=Fv({entity:p.getEntityTable(),chem_comp:v.getChemCompTable(),atom_site:f}),[4,xd(g,DD.create(e),t)];case 2:y=M.sent(),y.frameCount>0&&(b=ve.ofIntArray(ve.mapToArray(s.origin_atom_id,function(D){return D-1},Int32Array)),S=ve.ofIntArray(ve.mapToArray(s.target_atom_id,function(D){return D-1},Int32Array)),x=ve.ofIntArray(ve.mapToArray(s.bond_type,function(D){switch(D){case"ar":case"am":case"un":return 1;case"du":case"nc":return 0;default:return parseInt(D)}},Int8Array)),C=ve.ofIntArray(ve.mapToArray(s.bond_type,function(D){switch(D){case"ar":return 17;case"du":case"nc":return 0;case"am":case"un":default:return 1}},Int8Array)),w=xa.fromData({pairs:{indexA:b,indexB:S,order:x,flag:C},count:o.count}),A=y.representative,xa.Provider.set(A,w),Qg.Provider.set(A,{data:o.charge,type:u.charge_type}),r.push(A)),M.label=3;case 3:return++n,[3,1];case 4:return[2,new vv(r)]}})})}var DD;(function(e){function t(n){return(n==null?void 0:n.kind)==="mol2"}e.is=t;function r(n){return{kind:"mol2",name:n.name,data:n}}e.create=r})(DD||(DD={}));function iGe(e){return $e.create("Parse MOL2",function(t){return nGe(e,t)})}var vm=new Uint32Array([0,0,0,0,0,0,0,0,0,8,10,12,16,20,25,32,40,50,64,80,101,128,161,203,256,322,406,512,645,812,1024,1290,1625,2048,2580,3250,4096,5060,6501,8192,10321,13003,16384,20642,26007,32768,41285,52015,65536,82570,104031,131072,165140,208063,262144,330280,416127,524287,660561,832255,1048576,1321122,1664510,2097152,2642245,3329021,4194304,5284491,6658042,8388607,10568983,13316085,16777216]),iT=9,yo;(function(e){function t(c){for(var d=1,f=0;c>=d&&f<32;)f++,d<<=1;return f}e.sizeOfInt=t;var r=new Uint8Array(32);function n(c,d){var f=1,p=0;r[0]=1;for(var v=0;v<c;v++){var h=void 0,m=0;for(h=0;h<f;h++)m+=r[h]*d[v],r[h]=m&255,m>>=8;for(;m!==0;)r[h++]=m&255,m>>=8;f=h}var g=1;for(f--;r[f]>=g;)p++,g*=2;return p+f*8}e.sizeOfInts=n;var i=new ArrayBuffer(8*3);e.buf=new Int32Array(i);var a=new Uint32Array(i);function o(c,d,f){for(var p=f,v=(1<<p)-1,h=a[1],m=a[2],g=e.buf[0],y=0;p>=8;)m=m<<8|c[d+g++],y|=m>>h<<p-8,p-=8;return p>0&&(h<p&&(h+=8,m=m<<8|c[d+g++]),h-=p,y|=m>>h&(1<<p)-1),y&=v,e.buf[0]=g,e.buf[1]=h,e.buf[2]=m,y}e.decodeBits=o;function s(c,d){var f=a[2],p=e.buf[0];return f=f<<8|c[d+p],e.buf[0]=p+1,e.buf[2]=f,f>>a[1]&255}var u=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];function l(c,d,f,p,v){var h=f,m=0;for(u[0]=0,u[1]=0,u[2]=0,u[3]=0;h>8;)u[m++]=s(c,d),h-=8;h>0&&(u[m++]=o(c,d,h));for(var g=2;g>0;g--){for(var y=0,b=p[g],S=m-1;S>=0;S--){y=y<<8|u[S];var x=y/b|0;u[S]=x,y=y-x*b}v[g]=y}v[0]=u[0]|u[1]<<8|u[2]<<16|u[3]<<24}e.decodeInts=l})(yo||(yo={}));function aGe(){throw new Error("(xdrfile error) Undefined error.")}function oGe(e,t){return ce(this,void 0,void 0,function(){var r,n,i,a,o,s,u,l,c,d,f,p,v,h,m,g,O,O,y,b,S,x,C,w,A,M,D,k,R,O,H,B,j,Y,G;return de(this,function($){switch($.label){case 0:r=new DataView(t.buffer,t.byteOffset),n={frames:[],boxes:[],times:[],timeOffset:0,deltaTime:0},i=n.frames,a=n.boxes,o=n.times,s=[0,0,0,0,0,0],u=[0,0,0],l=[0,0,0],c=[0,0,0],d=[.1,.1,.1],f=[.1,.1,.1],p=0,v=yo.buf,$.label=1;case 1:for(h=void 0,m=r.getInt32(p+4),p+=12,o.push(r.getFloat32(p)),p+=4,g=new Float32Array(9),O=0;O<9;++O)g[O]=r.getFloat32(p)*10,p+=4;if(a.push(g),m<=9)for(h={count:m/3,x:new Float32Array(m/3),y:new Float32Array(m/3),z:new Float32Array(m/3)},O=0;O<m/3;++O)h.x[O]=r.getFloat32(p),h.y[O]=r.getFloat32(p),h.z[O]=r.getFloat32(p),p+=4;else{for(v[0]=v[1]=v[2]=0,u[0]=u[1]=u[2]=0,c[0]=c[1]=c[2]=0,l[0]=l[1]=l[2]=0,d[0]=d[1]=d[2]=0,f[0]=f[1]=f[2]=0,h={count:m,x:new Float32Array(m),y:new Float32Array(m),z:new Float32Array(m)},y=0,b=r.getInt32(p),p+=4,S=r.getFloat32(p),p+=4,s[0]=r.getInt32(p),s[1]=r.getInt32(p+4),s[2]=r.getInt32(p+8),s[3]=r.getInt32(p+12),s[4]=r.getInt32(p+16),s[5]=r.getInt32(p+20),u[0]=s[3]-s[0]+1,u[1]=s[4]-s[1]+1,u[2]=s[5]-s[2]+1,p+=24,x=void 0,(u[0]|u[1]|u[2])>16777215?(l[0]=yo.sizeOfInt(u[0]),l[1]=yo.sizeOfInt(u[1]),l[2]=yo.sizeOfInt(u[2]),x=0):x=yo.sizeOfInts(3,u),C=r.getInt32(p),p+=4,w=C-1,w=iT>w?iT:w,A=vm[w]/2|0,M=vm[C]/2|0,c[0]=c[1]=c[2]=vm[C],D=Math.ceil(r.getInt32(p)/4)*4,p+=4,k=1/S,R=0,O=0,d[0]=d[1]=d[2]=0;O<b;){if(x===0?(d[0]=yo.decodeBits(t,p,l[0]),d[1]=yo.decodeBits(t,p,l[1]),d[2]=yo.decodeBits(t,p,l[2])):yo.decodeInts(t,p,x,u,d),O++,d[0]+=s[0],d[1]+=s[1],d[2]+=s[2],f[0]=d[0],f[1]=d[1],f[2]=d[2],H=yo.decodeBits(t,p,1),B=0,H===1&&(R=yo.decodeBits(t,p,5),B=R%3,R-=B,B--),R>0)for(d[0]=d[1]=d[2]=0,j=0;j<R;j+=3)yo.decodeInts(t,p,C,c,d),O++,d[0]+=f[0]-M,d[1]+=f[1]-M,d[2]+=f[2]-M,j===0?(Y=d[0],d[0]=f[0],f[0]=Y,Y=d[1],d[1]=f[1],f[1]=Y,Y=d[2],d[2]=f[2],f[2]=Y,h.x[y]=f[0]*k,h.y[y]=f[1]*k,h.z[y]=f[2]*k,y++):(f[0]=d[0],f[1]=d[1],f[2]=d[2]),h.x[y]=d[0]*k,h.y[y]=d[1]*k,h.z[y]=d[2]*k,y++;else h.x[y]=d[0]*k,h.y[y]=d[1]*k,h.z[y]=d[2]*k,y++;C+=B,B<0?(M=A,C>iT?A=vm[C-1]/2|0:A=0):B>0&&(A=M,M=vm[C]/2|0),c[0]=c[1]=c[2]=vm[C],(c[0]===0||c[1]===0||c[2]===0)&&aGe()}p+=D}for(G=0;G<m;G++)h.x[G]*=10,h.y[G]*=10,h.z[G]*=10;return i.push(h),e.shouldUpdate?[4,e.update({current:p,max:t.length})]:[3,3];case 2:$.sent(),$.label=3;case 3:return p>=t.length?[3,4]:[3,1];case 4:return o.length>=1&&(n.timeOffset=o[0]),o.length>=2&&(n.deltaTime=o[1]-o[0]),[2,n]}})})}function sGe(e){var t=this;return $e.create("Parse XTC",function(r){return ce(t,void 0,void 0,function(){var n,i;return de(this,function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),r.update({canAbort:!0,message:"Parsing trajectory..."}),[4,oGe(r,e)];case 1:return n=a.sent(),[2,In.success(n)];case 2:return i=a.sent(),[2,In.error(""+i)];case 3:return[2]}})})})}function uGe(e){var t=this;return $e.create("Parse XTC",function(r){return ce(t,void 0,void 0,function(){var n,i,a,o,s,u,l,c,d;return de(this,function(f){switch(f.label){case 0:return[4,r.update("Converting to coordinates")];case 1:for(f.sent(),n=Sf(e.deltaTime,"step"),i=Sf(e.timeOffset,n.unit),a=[],o=0,s=e.frames.length;o<s;++o)u=e.boxes[o],l=_.fromArray(_(),u,0),c=_.fromArray(_(),u,3),d=_.fromArray(_(),u,6),a.push({elementCount:e.frames[o].count,cell:Vh.fromBasis(l,c,d),x:e.frames[o].x,y:e.frames[o].y,z:e.frames[o].z,xyzOrdering:{isIdentity:!0},time:Sf(i.value+n.value*o,n.unit)});return[2,Sb.create(a,n,i)]}})})})}function lGe(e){var t=e.position>=e.data.length-1?0:+It.readLine(e);isNaN(t)&&(t=0);for(var r=It.readLine(e),n=new Float64Array(t),i=new Float64Array(t),a=new Float64Array(t),o=new Array(t),s=0;s<t;++s){var u=It.readLineTrim(e),l=u.split(/\s+/g);o[s]=l[0],n[s]=+l[1],i[s]=+l[2],a[s]=+l[3]}return{count:t,comment:r,x:ve.ofFloatArray(n),y:ve.ofFloatArray(i),z:ve.ofFloatArray(a),type_symbol:ve.ofStringArray(o)}}function cGe(e){for(var t=It(e),r=[];;){var n=lGe(t);if(n.count===0)break;r.push(n)}var i={molecules:r};return In.success(i)}function dGe(e){var t=this;return $e.create("Parse Mol",function(){return ce(t,void 0,void 0,function(){return de(this,function(r){return[2,cGe(e)]})})})}function fGe(e,t){for(var r=e.molecules,n=0,i=0,a=r;i<a.length;i++){var o=a[i];n+=o.count}for(var s=new Array(n),u=new Int32Array(n),l=new Float32Array(n),c=new Float32Array(n),d=new Float32Array(n),f=new Int32Array(n),p=0,v=0;v<r.length;v++)for(var o=r[v],h=0;h<o.count;h++)s[p]=o.type_symbol.value(h),l[p]=o.x.value(h),c[p]=o.y.value(h),d[p]=o.z.value(h),u[p]=h,f[p]=v,p++;var m=ve.ofConst("MOL",n,ve.Schema.str),g=ve.ofConst("A",n,ve.Schema.str),y=ve.ofConst(1,n,ve.Schema.int),b=ve.ofStringArray(s),S=Qr.ofPartialColumns(to.atom_site,{auth_asym_id:g,auth_atom_id:b,auth_comp_id:m,auth_seq_id:y,Cartn_x:ve.ofFloatArray(l),Cartn_y:ve.ofFloatArray(c),Cartn_z:ve.ofFloatArray(d),id:ve.ofIntArray(u),label_asym_id:g,label_atom_id:b,label_comp_id:m,label_seq_id:y,label_entity_id:ve.ofConst("1",n,ve.Schema.str),occupancy:ve.ofConst(1,n,ve.Schema.float),type_symbol:b,pdbx_PDB_model_num:ve.ofIntArray(f)},n),x=new Mp;x.setNames([["MOL","Unknown Entity"]]),x.getEntityId("MOL",0,"A");var C=new Ip(y,b);C.setNames([["MOL","Unknown Molecule"]]),C.add("MOL",0);var w=Fv({entity:x.getEntityTable(),chem_comp:C.getChemCompTable(),atom_site:S});return xd(w,RD.create(e),t)}var RD;(function(e){function t(n){return(n==null?void 0:n.kind)==="xyz"}e.is=t;function r(n){return{kind:"xyz",name:"xyz",data:n}}e.create=r})(RD||(RD={}));function pGe(e){return $e.create("Parse XYZ",function(t){return fGe(e,t)})}var kD="$$$$";function hGe(e){for(var t=pt.create(e.data,32),r=pt.create(e.data,32);e.position<e.length;){var n=It.readLine(e);if(n.startsWith(kD))break;if(n&&n.startsWith("> ")){pt.add(t,e.tokenStart+2,e.tokenEnd),It.markLine(e);for(var i=e.tokenStart,a=e.tokenEnd,o=!1;e.position<e.length;){var s=It.readLine(e);if(!s||s.startsWith(kD)||s.startsWith("> ")){pt.add(r,i,a),o=!0;break}a=e.tokenEnd}o||pt.add(r,i,a)}}return{dataHeader:Xr(t)(ve.Schema.str),data:Xr(r)(ve.Schema.str)}}function vGe(e){var t=It.readLine(e).trim(),r=It.readLine(e).trim(),n=It.readLine(e).trim(),i=It.readLine(e),a=+i.substr(0,3),o=+i.substr(3,3);if(Number.isNaN(a)||Number.isNaN(o)){for(;e.position<e.length;){var s=It.readLine(e);if(s.startsWith(kD))break}return}var u=Qee(e,a),l=Zee(e,o),c=hGe(e);return{molFile:{title:t,program:r,comment:n,atoms:u,bonds:l},dataItems:c}}function mGe(e){for(var t=It(e),r=[];t.position<t.length;){var n=vGe(t);n&&r.push(n)}return In.success({compounds:r})}function gGe(e){var t=this;return $e.create("Parse Sdf",function(){return ce(t,void 0,void 0,function(){return de(this,function(r){return[2,mGe(e)]})})})}var OD;(function(e){function t(n){return(n==null?void 0:n.kind)==="sdf"}e.is=t;function r(n){return{kind:"sdf",name:n.molFile.title,data:n}}e.create=r})(OD||(OD={}));function yGe(e){return $e.create("Parse SDF",function(t){return Jee(e.molFile,OD.create(e),t)})}var bGe=kt.BuiltIn({name:"coordinates-from-dcd",display:{name:"Parse DCD",description:"Parse DCD binary data."},from:[ge.Data.Binary],to:ge.Molecule.Coordinates})({apply:function(e){var t=this,r=e.a;return $e.create("Parse DCD",function(n){return ce(t,void 0,void 0,function(){var i,a;return de(this,function(o){switch(o.label){case 0:return[4,F7e(r.data).runInContext(n)];case 1:if(i=o.sent(),i.isError)throw new Error(i.message);return[4,YVe(i.result).runInContext(n)];case 2:return a=o.sent(),[2,new ge.Molecule.Coordinates(a,{label:r.label,description:"Coordinates"})]}})})})}}),xGe=kt.BuiltIn({name:"coordinates-from-xtc",display:{name:"Parse XTC",description:"Parse XTC binary data."},from:[ge.Data.Binary],to:ge.Molecule.Coordinates})({apply:function(e){var t=this,r=e.a;return $e.create("Parse XTC",function(n){return ce(t,void 0,void 0,function(){var i,a;return de(this,function(o){switch(o.label){case 0:return[4,sGe(r.data).runInContext(n)];case 1:if(i=o.sent(),i.isError)throw new Error(i.message);return[4,uGe(i.result).runInContext(n)];case 2:return a=o.sent(),[2,new ge.Molecule.Coordinates(a,{label:r.label,description:"Coordinates"})]}})})})}}),SGe=kt.BuiltIn({name:"topology-from-psf",display:{name:"PSF Topology",description:"Parse PSF string data."},from:[ge.Format.Psf],to:ge.Molecule.Topology})({apply:function(e){var t=this,r=e.a;return $e.create("Create Topology",function(n){return ce(t,void 0,void 0,function(){var i;return de(this,function(a){switch(a.label){case 0:return[4,_He(r.data).runInContext(n)];case 1:return i=a.sent(),[2,new ge.Molecule.Topology(i,{label:i.label||r.label,description:"Topology"})]}})})})}});function CGe(e,t,r){return ce(this,void 0,void 0,function(){var n,i;return de(this,function(a){switch(a.label){case 0:return t.type!==ge.Molecule.Topology.type?[3,2]:(n=t.data,[4,$t.trajectoryFromTopologyAndCoordinates(n,r).runInContext(e)]);case 1:return[2,a.sent()];case 2:if(t.type===ge.Molecule.Model.type)return i=t.data,[2,$t.trajectoryFromModelAndCoordinates(i,r)];a.label=3;case 3:throw new Error("no model/topology found")}})})}var rte=kt.BuiltIn({name:"trajectory-from-model-and-coordinates",display:{name:"Trajectory from Topology & Coordinates",description:"Create a trajectory from existing model/topology and coordinates."},from:ge.Root,to:ge.Molecule.Trajectory,params:{modelRef:I.Text("",{isHidden:!0}),coordinatesRef:I.Text("",{isHidden:!0})}})({apply:function(e){var t=this,r=e.params,n=e.dependencies;return $e.create("Create trajectory from model/topology and coordinates",function(i){return ce(t,void 0,void 0,function(){var a,o,s;return de(this,function(u){switch(u.label){case 0:return a=n[r.coordinatesRef].data,[4,CGe(i,n[r.modelRef],a)];case 1:return o=u.sent(),s={label:"Trajectory",description:o.frameCount+" model"+(o.frameCount===1?"":"s")},[2,new ge.Molecule.Trajectory(o,s)]}})})})}}),_Ge=kt.BuiltIn({name:"trajectory-from-blob",display:{name:"Parse Blob",description:"Parse format blob into a single trajectory."},from:ge.Format.Blob,to:ge.Molecule.Trajectory})({apply:function(e){var t=this,r=e.a;return $e.create("Parse Format Blob",function(n){return ce(t,void 0,void 0,function(){var i,a,o,s,u,l,d,c,d,f;return de(this,function(p){switch(p.label){case 0:i=[],a=0,o=r.data,p.label=1;case 1:return a<o.length?(s=o[a],s.kind!=="cif"?[3,6]:(u=s.data.blocks[0],[4,IJ(u).runInContext(n)])):[3,7];case 2:if(l=p.sent(),l.frameCount===0)throw new Error("No models found.");d=0,p.label=3;case 3:return d<l.frameCount?[4,$e.resolveInContext(l.getFrameAtIndex(d),n)]:[3,6];case 4:c=p.sent(),i.push(c),p.label=5;case 5:return d++,[3,3];case 6:return a++,[3,1];case 7:for(d=0;d<i.length;d++)$t.TrajectoryInfo.set(i[d],{index:d,size:i.length});return f={label:"Trajectory",description:i.length+" model"+(i.length===1?"":"s")},[2,new ge.Molecule.Trajectory(new vv(i),f)]}})})})}});function Rd(e){var t=e.representative;return{label:""+t.entry,description:e.frameCount+" model"+(e.frameCount===1?"":"s")}}var wGe=kt.BuiltIn({name:"trajectory-from-mmcif",display:{name:"Trajectory from mmCIF",description:"Identify and create all separate models in the specified CIF data block"},from:ge.Format.Cif,to:ge.Molecule.Trajectory,params:function(e){if(!e)return{blockHeader:I.Optional(I.Text(void 0,{description:"Header of the block to parse. If none is specifed, the 1st data block in the file is used."}))};var t=e.data.blocks;return{blockHeader:I.Optional(I.Select(t[0]&&t[0].header,t.map(function(r){return[r.header,r.header]}),{description:"Header of the block to parse"}))}}})({isApplicable:function(e){return e.data.blocks.length>0},apply:function(e){var t=this,r=e.a,n=e.params;return $e.create("Parse mmCIF",function(i){return ce(t,void 0,void 0,function(){var a,o,s,u;return de(this,function(l){switch(l.label){case 0:if(a=n.blockHeader||r.data.blocks[0].header,o=r.data.blocks.find(function(c){return c.header===a}),!o)throw new Error("Data block '"+[a]+"' not found.");return[4,IJ(o).runInContext(i)];case 1:if(s=l.sent(),s.frameCount===0)throw new Error("No models found.");return u=Rd(s),[2,new ge.Molecule.Trajectory(s,u)]}})})})}}),EGe=kt.BuiltIn({name:"trajectory-from-pdb",display:{name:"Parse PDB",description:"Parse PDB string and create trajectory."},from:[ge.Data.String],to:ge.Molecule.Trajectory,params:{isPdbqt:I.Boolean(!1)}})({apply:function(e){var t=this,r=e.a,n=e.params;return $e.create("Parse PDB",function(i){return ce(t,void 0,void 0,function(){var a,o,s;return de(this,function(u){switch(u.label){case 0:return[4,W7e(r.data,r.label,n.isPdbqt).runInContext(i)];case 1:if(a=u.sent(),a.isError)throw new Error(a.message);return[4,SHe(a.result).runInContext(i)];case 2:return o=u.sent(),s=Rd(o),[2,new ge.Molecule.Trajectory(o,s)]}})})})}}),AGe=kt.BuiltIn({name:"trajectory-from-gro",display:{name:"Parse GRO",description:"Parse GRO string and create trajectory."},from:[ge.Data.String],to:ge.Molecule.Trajectory})({apply:function(e){var t=this,r=e.a;return $e.create("Parse GRO",function(n){return ce(t,void 0,void 0,function(){var i,a,o;return de(this,function(s){switch(s.label){case 0:return[4,$7e(r.data).runInContext(n)];case 1:if(i=s.sent(),i.isError)throw new Error(i.message);return[4,nHe(i.result).runInContext(n)];case 2:return a=s.sent(),o=Rd(a),[2,new ge.Molecule.Trajectory(a,o)]}})})})}}),PGe=kt.BuiltIn({name:"trajectory-from-xyz",display:{name:"Parse XYZ",description:"Parse XYZ string and create trajectory."},from:[ge.Data.String],to:ge.Molecule.Trajectory})({apply:function(e){var t=this,r=e.a;return $e.create("Parse XYZ",function(n){return ce(t,void 0,void 0,function(){var i,a,o;return de(this,function(s){switch(s.label){case 0:return[4,dGe(r.data).runInContext(n)];case 1:if(i=s.sent(),i.isError)throw new Error(i.message);return[4,pGe(i.result).runInContext(n)];case 2:return a=s.sent(),o=Rd(a),[2,new ge.Molecule.Trajectory(a,o)]}})})})}}),TGe=kt.BuiltIn({name:"trajectory-from-mol",display:{name:"Parse MOL",description:"Parse MOL string and create trajectory."},from:[ge.Data.String],to:ge.Molecule.Trajectory})({apply:function(e){var t=this,r=e.a;return $e.create("Parse MOL",function(n){return ce(t,void 0,void 0,function(){var i,a,o;return de(this,function(s){switch(s.label){case 0:return[4,UHe(r.data).runInContext(n)];case 1:if(i=s.sent(),i.isError)throw new Error(i.message);return[4,jHe(i.result).runInContext(n)];case 2:return a=s.sent(),o=Rd(a),[2,new ge.Molecule.Trajectory(a,o)]}})})})}}),IGe=kt.BuiltIn({name:"trajectory-from-sdf",display:{name:"Parse SDF",description:"Parse SDF string and create trajectory."},from:[ge.Data.String],to:ge.Molecule.Trajectory})({apply:function(e){var t=this,r=e.a;return $e.create("Parse SDF",function(n){return ce(t,void 0,void 0,function(){var i,a,o,s,u,l,c,d,f,p,v;return de(this,function(h){switch(h.label){case 0:return[4,gGe(r.data).runInContext(n)];case 1:if(i=h.sent(),i.isError)throw new Error(i.message);a=[],o=0,s=i.result.compounds,h.label=2;case 2:return o<s.length?(u=s[o],[4,yGe(u).runInContext(n)]):[3,8];case 3:l=h.sent(),c=0,h.label=4;case 4:return c<l.frameCount?(f=(d=a).push,[4,$e.resolveInContext(l.getFrameAtIndex(c),n)]):[3,7];case 5:f.apply(d,[h.sent()]),h.label=6;case 6:return c++,[3,4];case 7:return o++,[3,2];case 8:return p=new vv(a),v=Rd(p),[2,new ge.Molecule.Trajectory(p,v)]}})})})}}),MGe=kt.BuiltIn({name:"trajectory-from-mol2",display:{name:"Parse MOL2",description:"Parse MOL2 string and create trajectory."},from:[ge.Data.String],to:ge.Molecule.Trajectory})({apply:function(e){var t=this,r=e.a;return $e.create("Parse MOL2",function(n){return ce(t,void 0,void 0,function(){var i,a,o;return de(this,function(s){switch(s.label){case 0:return[4,rGe(r.data,r.label).runInContext(n)];case 1:if(i=s.sent(),i.isError)throw new Error(i.message);return[4,iGe(i.result).runInContext(n)];case 2:return a=s.sent(),o=Rd(a),[2,new ge.Molecule.Trajectory(a,o)]}})})})}}),DGe=kt.BuiltIn({name:"trajectory-from-cube",display:{name:"Parse Cube",description:"Parse Cube file to create a trajectory."},from:ge.Format.Cube,to:ge.Molecule.Trajectory})({apply:function(e){var t=this,r=e.a;return $e.create("Parse MOL",function(n){return ce(t,void 0,void 0,function(){var i,a;return de(this,function(o){switch(o.label){case 0:return[4,XHe(r.data).runInContext(n)];case 1:return i=o.sent(),a=Rd(i),[2,new ge.Molecule.Trajectory(i,a)]}})})})}}),RGe=kt.BuiltIn({name:"trajectory-from-cif-core",display:{name:"Parse CIF Core",description:"Identify and create all separate models in the specified CIF data block"},from:ge.Format.Cif,to:ge.Molecule.Trajectory,params:function(e){if(!e)return{blockHeader:I.Optional(I.Text(void 0,{description:"Header of the block to parse. If none is specifed, the 1st data block in the file is used."}))};var t=e.data.blocks;return{blockHeader:I.Optional(I.Select(t[0]&&t[0].header,t.map(function(r){return[r.header,r.header]}),{description:"Header of the block to parse"}))}}})({apply:function(e){var t=this,r=e.a,n=e.params;return $e.create("Parse CIF Core",function(i){return ce(t,void 0,void 0,function(){var a,o,s,u;return de(this,function(l){switch(l.label){case 0:if(a=n.blockHeader||r.data.blocks[0].header,o=r.data.blocks.find(function(c){return c.header===a}),!o)throw new Error("Data block '"+[a]+"' not found.");return[4,$He(o).runInContext(i)];case 1:if(s=l.sent(),s.frameCount===0)throw new Error("No models found.");return u=Rd(s),[2,new ge.Molecule.Trajectory(s,u)]}})})})}}),kGe=function(e){return e+1},OGe=function(e){return e-1},LGe=kt.BuiltIn({name:"model-from-trajectory",display:{name:"Molecular Model",description:"Create a molecular model from specified index in a trajectory."},from:ge.Molecule.Trajectory,to:ge.Molecule.Model,params:function(e){return e?{modelIndex:I.Converted(kGe,OGe,I.Numeric(1,{min:1,max:e.data.frameCount,step:1},{description:"Model Index",immediateUpdate:!0}))}:{modelIndex:I.Numeric(0,{},{description:"Zero-based index of the model",immediateUpdate:!0})}}})({isApplicable:function(e){return e.data.frameCount>0},apply:function(e){var t=this,r=e.a,n=e.params;return $e.create("Model from Trajectory",function(i){return ce(t,void 0,void 0,function(){var a,o,s,u;return de(this,function(l){switch(l.label){case 0:return a=n.modelIndex%r.data.frameCount,a<0&&(a+=r.data.frameCount),[4,$e.resolveInContext(r.data.getFrameAtIndex(a),i)];case 1:return o=l.sent(),s="Model "+(a+1),u=r.data.frameCount===1?void 0:"of "+r.data.frameCount,[2,new ge.Molecule.Model(o,{label:s,description:u})]}})})})},interpolate:function(e,t,r){var n=r>=1?t.modelIndex:e.modelIndex+Math.floor((t.modelIndex-e.modelIndex+1)*r);return{modelIndex:n}},dispose:function(e){var t=e.b;t==null||t.data.customProperties.dispose()}}),FGe=kt.BuiltIn({name:"structure-from-trajectory",display:{name:"Structure from Trajectory",description:"Create a molecular structure from a trajectory."},from:ge.Molecule.Trajectory,to:ge.Molecule.Structure})({apply:function(e){var t=this,r=e.a;return $e.create("Build Structure",function(n){return ce(t,void 0,void 0,function(){var i,a;return de(this,function(o){switch(o.label){case 0:return[4,We.ofTrajectory(r.data,n)];case 1:return i=o.sent(),a={label:"Ensemble",description:We.elementDescription(i)},[2,new ge.Molecule.Structure(i,a)]}})})})},dispose:function(e){var t=e.b;t==null||t.data.customPropertyDescriptors.dispose()}}),NGe=kt.BuiltIn({name:"structure-from-model",display:{name:"Structure",description:"Create a molecular structure (model, assembly, or symmetry) from the specified model."},from:ge.Molecule.Model,to:ge.Molecule.Structure,params:function(e){return Hh.getParams(e&&e.data)}})({canAutoUpdate:function(e){var t=e.oldParams,r=e.newParams;return Hh.canAutoUpdate(t.type,r.type)},apply:function(e,t){var r=this,n=e.a,i=e.params;return $e.create("Build Structure",function(a){return ce(r,void 0,void 0,function(){return de(this,function(o){return[2,Hh.create(t,a,n.data,i&&i.type)]})})})},update:function(e){var t=e.a,r=e.b,n=e.oldParams,i=e.newParams;return Xc(n,i)?r.data.model===t.data?ft.UpdateResult.Unchanged:$t.areHierarchiesEqual(t.data,r.data.model)?(r.data=r.data.remapModel(t.data),ft.UpdateResult.Updated):ft.UpdateResult.Recreate:ft.UpdateResult.Recreate},dispose:function(e){var t=e.b;t==null||t.data.customPropertyDescriptors.dispose()}}),Az=_(),Pz=ue(),Tz=ue(),BGe=kt.BuiltIn({name:"transform-structure-conformation",display:{name:"Transform Conformation"},isDecorator:!0,from:ge.Molecule.Structure,to:ge.Molecule.Structure,params:{transform:I.MappedStatic("components",{components:I.Group({axis:I.Vec3(_.create(1,0,0)),angle:I.Numeric(0,{min:-180,max:180,step:.1}),translation:I.Vec3(_.create(0,0,0))},{isFlat:!0}),matrix:I.Group({data:I.Mat4(ue.identity()),transpose:I.Boolean(!1)},{isFlat:!0})},{label:"Kind"})}})({canAutoUpdate:function(e){var t=e.newParams;return t.transform.name!=="matrix"},apply:function(e){var t=e.a,r=e.params,n=ue();if(r.transform.name==="components"){var i=r.transform.params,a=i.axis,o=i.angle,s=i.translation,u=t.data.boundary.sphere.center;ue.fromTranslation(Pz,_.negate(Az,u)),ue.fromTranslation(Tz,_.add(Az,u,s));var l=ue.fromRotation(ue(),Math.PI/180*o,_.normalize(_(),a));ue.mul3(n,Tz,l,Pz)}else r.transform.name==="matrix"&&(ue.copy(n,r.transform.params.data),r.transform.params.transpose&&ue.transpose(n,n));var c=We.transform(t.data,n);return new ge.Molecule.Structure(c,{label:t.label,description:t.description+" [Transformed]"})},dispose:function(e){var t=e.b;t==null||t.data.customPropertyDescriptors.dispose()}}),UGe=kt.BuiltIn({name:"structure-selection-from-expression",display:{name:"Selection",description:"Create a molecular structure from the specified expression."},from:ge.Molecule.Structure,to:ge.Molecule.Structure,params:function(){return{expression:I.Value(se.struct.generator.all,{isHidden:!0}),label:I.Optional(I.Text("",{isHidden:!0}))}}})({apply:function(e){var t=e.a,r=e.params,n=e.cache,i=Na.createAndRun(t.data,r.expression),a=i.selection,o=i.entry;if(n.entry=o,mt.isEmpty(a))return On.Null;var s=mt.unionStructure(a),u={label:""+(r.label||"Selection"),description:We.elementDescription(s)};return new ge.Molecule.Structure(s,u)},update:function(e){var t=e.a,r=e.b,n=e.oldParams,i=e.newParams,a=e.cache;if(n.expression!==i.expression)return ft.UpdateResult.Recreate;var o=a.entry;if(o.currentStructure===t.data)return ft.UpdateResult.Unchanged;var s=Na.updateStructure(o,t.data);return mt.isEmpty(s)?ft.UpdateResult.Null:(Na.updateStructureObject(r,s,i.label),ft.UpdateResult.Updated)},dispose:function(e){var t=e.b;t==null||t.data.customPropertyDescriptors.dispose()}}),jGe=kt.BuiltIn({name:"structure-multi-selection-from-expression",display:{name:"Multi-structure Measurement Selection",description:"Create selection object from multiple structures."},from:ge.Root,to:ge.Molecule.Structure.Selections,params:function(){return{selections:I.ObjectList({key:I.Text(void 0,{description:"A unique key."}),ref:I.Text(),groupId:I.Optional(I.Text()),expression:I.Value(se.struct.generator.empty)},function(e){return e.ref},{isHidden:!0}),isTransitive:I.Optional(I.Boolean(!1,{isHidden:!0,description:"Remap the selections from the original structure if structurally equivalent."})),label:I.Optional(I.Text("",{isHidden:!0}))}}})({apply:function(e){for(var t=e.params,r=e.cache,n=e.dependencies,i=new Map,a=[],o=0,s=0,u=t.selections;s<u.length;s++){var l=u[s],c=Na.createAndRun(n[l.ref].data,l.expression),d=c.selection,f=c.entry;i.set(l.key,f);var p=mt.toLociWithSourceUnits(d);a.push({key:l.key,loci:p,groupId:l.groupId}),o+=Re.size(p)}r.entries=i;var v={label:""+(t.label||"Multi-selection"),description:t.selections.length+" source(s), "+o+" element(s) total"};return new ge.Molecule.Structure.Selections(a,v)},update:function(e){var t=e.b,r=e.oldParams,n=e.newParams,i=e.cache,a=e.dependencies;if(!!r.isTransitive!=!!n.isTransitive)return ft.UpdateResult.Recreate;for(var o=i.entries,s=new Map,u=new Map,l=0,c=t.data;l<c.length;l++){var d=c[l];u.set(d.key,d)}for(var f=!1,p=0,v=[],h=0,m=n.selections;h<m.length;h++){var g=m[h],y=a[g.ref].data,b=!1;if(o.has(g.key)){var S=o.get(g.key);if(Na.isUnchanged(S,g.expression,y)&&u.has(g.key)){var x=u.get(g.key);x.groupId!==g.groupId&&(x.groupId=g.groupId,f=!0),s.set(g.key,S),v.push(x),p+=Re.size(x.loci);continue}if(S.expression!==g.expression)b=!0;else{var C=!1;if(n.isTransitive)if(We.areUnitIdsAndIndicesEqual(S.originalStructure,y)){var w=Na.run(S,S.originalStructure);S.currentStructure=y,s.set(g.key,S);var x=Re.remap(mt.toLociWithSourceUnits(w),y);v.push({key:g.key,loci:x,groupId:g.groupId}),p+=Re.size(x),f=!0}else C=!0;else C=!0;if(C){f=!0;var w=Na.updateStructure(S,y);s.set(g.key,S);var x=mt.toLociWithSourceUnits(w);v.push({key:g.key,loci:x,groupId:g.groupId}),p+=Re.size(x)}}}else b=!0;if(b){f=!0;var A=Na.createAndRun(y,g.expression),w=A.selection,S=A.entry;s.set(g.key,S);var x=mt.toLociWithSourceUnits(w);v.push({key:g.key,loci:x}),p+=Re.size(x)}}return f?(i.entries=s,t.data=v,t.label=""+(n.label||"Multi-selection"),t.description=v.length+" source(s), "+p+" element(s) total",ft.UpdateResult.Updated):ft.UpdateResult.Unchanged}}),zGe=kt.BuiltIn({name:"structure-selection-from-script",display:{name:"Selection",description:"Create a molecular structure from the specified script."},from:ge.Molecule.Structure,to:ge.Molecule.Structure,params:function(){return{script:I.Script({language:"mol-script",expression:"(sel.atom.atom-groups :residue-test (= atom.resname ALA))"}),label:I.Optional(I.Text(""))}}})({apply:function(e){var t=e.a,r=e.params,n=e.cache,i=Na.createAndRun(t.data,r.script),a=i.selection,o=i.entry;n.entry=o;var s=mt.unionStructure(a),u={label:""+(r.label||"Selection"),description:We.elementDescription(s)};return new ge.Molecule.Structure(s,u)},update:function(e){var t=e.a,r=e.b,n=e.oldParams,i=e.newParams,a=e.cache;if(!Vi.areEqual(n.script,i.script))return ft.UpdateResult.Recreate;var o=a.entry;if(o.currentStructure===t.data)return ft.UpdateResult.Unchanged;var s=Na.updateStructure(o,t.data);return Na.updateStructureObject(r,s,i.label),ft.UpdateResult.Updated},dispose:function(e){var t=e.b;t==null||t.data.customPropertyDescriptors.dispose()}}),VGe=kt.BuiltIn({name:"structure-selection-from-bundle",display:{name:"Selection",description:"Create a molecular structure from the specified structure-element bundle."},from:ge.Molecule.Structure,to:ge.Molecule.Structure,params:function(){return{bundle:I.Value(rn.Empty,{isHidden:!0}),label:I.Optional(I.Text("",{isHidden:!0}))}}})({apply:function(e){var t=e.a,r=e.params,n=e.cache;if(r.bundle.hash!==t.data.hashCode)return On.Null;n.source=t.data;var i=rn.toStructure(r.bundle,t.data);if(i.elementCount===0)return On.Null;var a={label:""+(r.label||"Selection"),description:We.elementDescription(i)};return new ge.Molecule.Structure(i,a)},update:function(e){var t=e.a,r=e.b,n=e.oldParams,i=e.newParams,a=e.cache;if(!rn.areEqual(n.bundle,i.bundle))return ft.UpdateResult.Recreate;if(i.bundle.hash!==t.data.hashCode)return ft.UpdateResult.Null;if(a.source===t.data)return ft.UpdateResult.Unchanged;a.source=t.data;var o=rn.toStructure(i.bundle,t.data);return o.elementCount===0?ft.UpdateResult.Null:(r.label=""+(i.label||"Selection"),r.description=We.elementDescription(o),r.data=o,ft.UpdateResult.Updated)},dispose:function(e){var t=e.b;t==null||t.data.customPropertyDescriptors.dispose()}}),nte={polymer:"polymer",protein:"protein",nucleic:"nucleic",water:"water",branched:"branched",ligand:"ligand","non-standard":"non-standard",coarse:"coarse","atomic-sequence":"atomic-sequence","atomic-het":"atomic-het",spheres:"spheres"},HGe=I.objectToOptions(nte),GGe=kt.BuiltIn({name:"structure-complex-element",display:{name:"Complex Element",description:"Create a molecular structure from the specified model."},from:ge.Molecule.Structure,to:ge.Molecule.Structure,params:{type:I.Select("atomic-sequence",HGe,{isHidden:!0})}})({apply:function(e){var t=e.a,r=e.params,n,i;switch(r.type){case"polymer":n=mi.polymer.query,i="Polymer";break;case"protein":n=mi.protein.query,i="Protein";break;case"nucleic":n=mi.nucleic.query,i="Nucleic";break;case"water":n=nn.internal.water(),i="Water";break;case"branched":n=mi.branchedPlusConnected.query,i="Branched";break;case"ligand":n=mi.ligandPlusConnected.query,i="Ligand";break;case"non-standard":n=mi.nonStandardPolymer.query,i="Non-standard";break;case"coarse":n=mi.coarse.query,i="Coarse";break;case"atomic-sequence":n=nn.internal.atomicSequence(),i="Sequence";break;case"atomic-het":n=nn.internal.atomicHet(),i="HET Groups/Ligands";break;case"spheres":n=nn.internal.spheres(),i="Coarse Spheres";break;default:throw new Error(r.type+" is a not valid complex element.")}var a=n(new us(t.data)),o=mt.unionStructure(a);return o.elementCount===0?On.Null:new ge.Molecule.Structure(o,{label:i,description:We.elementDescription(o)})},dispose:function(e){var t=e.b;t==null||t.data.customPropertyDescriptors.dispose()}}),qGe=kt.BuiltIn({name:"structure-component",display:{name:"Component",description:"A molecular structure component."},from:ge.Molecule.Structure,to:ge.Molecule.Structure,params:LHe})({apply:function(e){var t=e.a,r=e.params,n=e.cache;return FHe(t.data,r,n)},update:function(e){var t=e.a,r=e.b,n=e.oldParams,i=e.newParams,a=e.cache;return NHe(t.data,r,n,i,a)},dispose:function(e){var t=e.b;t==null||t.data.customPropertyDescriptors.dispose()}}),ite=kt.BuiltIn({name:"custom-model-properties",display:{name:"Custom Model Properties"},isDecorator:!0,from:ge.Molecule.Model,to:ge.Molecule.Model,params:function(e,t){return t.customModelProperties.getParams(e==null?void 0:e.data)}})({apply:function(e,t){var r=this,n=e.a,i=e.params;return $e.create("Custom Props",function(a){return ce(r,void 0,void 0,function(){return de(this,function(o){switch(o.label){case 0:return[4,Iz(n.data,t,a,i)];case 1:return o.sent(),[2,new ge.Molecule.Model(n.data,{label:n.label,description:n.description})]}})})})},update:function(e,t){var r=this,n=e.a,i=e.b,a=e.oldParams,o=e.newParams;return $e.create("Custom Props",function(s){return ce(r,void 0,void 0,function(){var u,l,c,d;return de(this,function(f){switch(f.label){case 0:for(i.data=n.data,i.label=n.label,i.description=n.description,u=0,l=a.autoAttach;u<l.length;u++)c=l[u],d=t.customModelProperties.get(c),d&&n.data.customProperties.reference(d.descriptor,!1);return[4,Iz(n.data,t,s,o)];case 1:return f.sent(),[2,ft.UpdateResult.Updated]}})})})},dispose:function(e){var t=e.b;t==null||t.data.customProperties.dispose()}});function Iz(e,t,r,n){return ce(this,void 0,void 0,function(){var i,a,o,s,u,l,c,d,f;return de(this,function(p){switch(p.label){case 0:i={runtime:r,assetManager:t.managers.asset},a=n.autoAttach,o=n.properties,s=0,u=Object.keys(o),p.label=1;case 1:if(!(s<u.length))return[3,8];if(l=u[s],c=t.customModelProperties.get(l),d=o[l],!(a.includes(l)||c.isHidden))return[3,6];p.label=2;case 2:return p.trys.push([2,4,,5]),[4,c.attach(i,e,d,!0)];case 3:return p.sent(),[3,5];case 4:return f=p.sent(),t.log.warn("Error attaching model prop '"+l+"': "+f),[3,5];case 5:return[3,7];case 6:c.set(e,d),p.label=7;case 7:return s++,[3,1];case 8:return[2]}})})}var ate=kt.BuiltIn({name:"custom-structure-properties",display:{name:"Custom Structure Properties"},isDecorator:!0,from:ge.Molecule.Structure,to:ge.Molecule.Structure,params:function(e,t){return t.customStructureProperties.getParams(e==null?void 0:e.data.root)}})({apply:function(e,t){var r=this,n=e.a,i=e.params;return $e.create("Custom Props",function(a){return ce(r,void 0,void 0,function(){return de(this,function(o){switch(o.label){case 0:return[4,Mz(n.data.root,t,a,i)];case 1:return o.sent(),[2,new ge.Molecule.Structure(n.data,{label:n.label,description:n.description})]}})})})},update:function(e,t){var r=this,n=e.a,i=e.b,a=e.oldParams,o=e.newParams;return n.data!==i.data?ft.UpdateResult.Recreate:$e.create("Custom Props",function(s){return ce(r,void 0,void 0,function(){var u,l,c,d;return de(this,function(f){switch(f.label){case 0:for(i.data=n.data,i.label=n.label,i.description=n.description,u=0,l=a.autoAttach;u<l.length;u++)c=l[u],d=t.customStructureProperties.get(c),d&&n.data.customPropertyDescriptors.reference(d.descriptor,!1);return[4,Mz(n.data.root,t,s,o)];case 1:return f.sent(),[2,ft.UpdateResult.Updated]}})})})},dispose:function(e){var t=e.b;t==null||t.data.customPropertyDescriptors.dispose()}});function Mz(e,t,r,n){return ce(this,void 0,void 0,function(){var i,a,o,s,u,l,c,d,f;return de(this,function(p){switch(p.label){case 0:i={runtime:r,assetManager:t.managers.asset},a=n.autoAttach,o=n.properties,s=0,u=Object.keys(o),p.label=1;case 1:if(!(s<u.length))return[3,8];if(l=u[s],c=t.customStructureProperties.get(l),d=o[l],!(a.includes(l)||c.isHidden))return[3,6];p.label=2;case 2:return p.trys.push([2,4,,5]),[4,c.attach(i,e,d,!0)];case 3:return p.sent(),[3,5];case 4:return f=p.sent(),t.log.warn("Error attaching structure prop '"+l+"': "+f),[3,5];case 5:return[3,7];case 6:c.set(e,d),p.label=7;case 7:return s++,[3,1];case 8:return[2]}})})}var $Ge=kt.BuiltIn({name:"shape-from-ply",display:{name:"Shape from PLY",description:"Create Shape from PLY data"},from:ge.Format.Ply,to:ge.Shape.Provider,params:function(e){return{}}})({apply:function(e){var t=this,r=e.a;return e.params,$e.create("Create shape from PLY",function(n){return ce(t,void 0,void 0,function(){var i,a;return de(this,function(o){switch(o.label){case 0:return[4,WVe(r.data).runInContext(n)];case 1:return i=o.sent(),a={label:"Shape"},[2,new ge.Shape.Provider(i,a)]}})})})}});const WGe=Object.freeze(Object.defineProperty({__proto__:null,CoordinatesFromDcd:bGe,CoordinatesFromXtc:xGe,CustomModelProperties:ite,CustomStructureProperties:ate,ModelFromTrajectory:LGe,MultiStructureSelectionFromExpression:jGe,ShapeFromPly:$Ge,StructureComplexElement:GGe,StructureComplexElementTypes:nte,StructureComponent:qGe,StructureFromModel:NGe,StructureFromTrajectory:FGe,StructureSelectionFromBundle:VGe,StructureSelectionFromExpression:UGe,StructureSelectionFromScript:zGe,TopologyFromPsf:SGe,TrajectoryFromBlob:_Ge,TrajectoryFromCifCore:RGe,TrajectoryFromCube:DGe,TrajectoryFromGRO:AGe,TrajectoryFromMOL:TGe,TrajectoryFromMOL2:MGe,TrajectoryFromMmCif:wGe,TrajectoryFromModelAndCoordinates:rte,TrajectoryFromPDB:EGe,TrajectoryFromSDF:IGe,TrajectoryFromXYZ:PGe,TransformStructureConformation:BGe},Symbol.toStringTag,{value:"Module"}));function XGe(e){return e.originX===0&&e.originY===0&&e.originZ===0?_.create(e.NCSTART,e.NRSTART,e.NSSTART):_.create(e.originX/(e.xLength/e.NX),e.originY/(e.yLength/e.NY),e.originZ/(e.zLength/e.NZ))}function YGe(e){var t=aee(e);switch(t){case ma.Float32:return Float32Array;case ma.Int8:return Int8Array;case ma.Int16:return Int16Array;case ma.Uint16:return Uint16Array}throw Error(t+" is not a supported value format.")}function KGe(e,t){var r=this;return $e.create("Create Volume",function(n){return ce(r,void 0,void 0,function(){var i,a,o,s,u,l,c,d,f,p,v,h,m,g,y,b,S;return de(this,function(x){return i=e.header,a=e.values,o=_.create(i.xLength,i.yLength,i.zLength),t&&t.voxelSize&&_.mul(o,o,t.voxelSize),s=_.create(Kr(i.alpha),Kr(i.beta),Kr(i.gamma)),u=i.ISPG>65536?0:i.ISPG,l=Mo.create(u||"P 1",o,s),c=_.create(i.MAPC-1,i.MAPR-1,i.MAPS-1),d=Mr.convertToCanonicalAxisIndicesFastToSlow(c),f=[i.NX,i.NY,i.NZ],p=d([i.NC,i.NR,i.NS]),v=XGe(i),t!=null&&t.offset&&_.add(v,v,t.offset),h=d(v),m=_.create(h[0]/f[0],h[1]/f[1],h[2]/f[2]),g=_.create(p[0]/f[0],p[1]/f[1],p[2]/f[2]),y=Mr.Space(p,Mr.invertAxisOrder(c),YGe(i)),b=Mr.create(y,Mr.Data1(a)),S=i.AMIN===0&&i.AMAX===0&&i.AMEAN===0&&i.ARMS===0,[2,{label:t==null?void 0:t.label,entryId:t==null?void 0:t.entryId,grid:{transform:{kind:"spacegroup",cell:l,fractionalBox:Xt.create(m,_.add(_.zero(),m,g))},cells:b,stats:{min:isNaN(i.AMIN)||S?pE(a):i.AMIN,max:isNaN(i.AMAX)||S?Nl(a):i.AMAX,mean:isNaN(i.AMEAN)||S?hE(a):i.AMEAN,sigma:isNaN(i.ARMS)||i.ARMS===0?vE(a):i.ARMS}},sourceData:LD.create(e),customProperties:new Hl,_propertyData:Object.create(null)}]})})})}var LD;(function(e){function t(n){return(n==null?void 0:n.kind)==="ccp4"}e.is=t;function r(n){return{kind:"ccp4",name:n.name,data:n}}e.create=r})(LD||(LD={}));function ote(e,t){var r=this;return $e.create("Create Volume",function(n){return ce(r,void 0,void 0,function(){var i,a,o,s,u,l,c,d,f,p;return de(this,function(v){return i=e.volume_data_3d_info,a=e.volume_data_3d,o=Mo.create(i.spacegroup_number.value(0),_.ofArray(i.spacegroup_cell_size.value(0)),_.scale(_.zero(),_.ofArray(i.spacegroup_cell_angles.value(0)),Math.PI/180)),s=i.axis_order.value(0),u=Mr.convertToCanonicalAxisIndicesFastToSlow(s),l=u(i.sample_count.value(0)),c=Mr.Space(l,Mr.invertAxisOrder(s),Float32Array),d=Mr.create(c,Mr.Data1(a.values.toArray({array:Float32Array}))),f=_.ofArray(u(i.origin.value(0))),p=_.ofArray(u(i.dimensions.value(0))),[2,{label:t==null?void 0:t.label,entryId:t==null?void 0:t.entryId,grid:{transform:{kind:"spacegroup",cell:o,fractionalBox:Xt.create(f,_.add(_.zero(),f,p))},cells:d,stats:{min:i.min_sampled.value(0),max:i.max_sampled.value(0),mean:i.mean_sampled.value(0),sigma:i.sigma_sampled.value(0)}},sourceData:ow.create(e),customProperties:new Hl,_propertyData:Object.create(null)}]})})})}var ow;(function(e){function t(n){return(n==null?void 0:n.kind)==="dscif"}e.is=t;function r(n){return{kind:"dscif",name:n._name,data:n}}e.create=r})(ow||(ow={}));function QGe(e,t){var r=this;return $e.create("Create Volume",function(n){return ce(r,void 0,void 0,function(){var i,a,o,s,u,l,c,d,f,p,v,h;return de(this,function(m){return i=e.header,a=e.values,o=_.create(i.xlen,i.ylen,i.zlen),t&&t.voxelSize&&_.mul(o,o,t.voxelSize),s=_.create(Kr(i.alpha),Kr(i.beta),Kr(i.gamma)),u=Mo.create("P 1",o,s),l=[i.xRate,i.yRate,i.zRate],c=[i.xExtent,i.yExtent,i.zExtent],d=[i.xStart,i.yStart,i.zStart],f=_.create(d[0]/l[0],d[1]/l[1],d[2]/l[2]),p=_.create(c[0]/l[0],c[1]/l[1],c[2]/l[2]),v=Mr.Space(c,[0,1,2],Float32Array),h=Mr.create(v,Mr.Data1(a)),[2,{label:t==null?void 0:t.label,entryId:t==null?void 0:t.entryId,grid:{transform:{kind:"spacegroup",cell:u,fractionalBox:Xt.create(f,_.add(_.zero(),f,p))},cells:h,stats:{min:pE(a),max:Nl(a),mean:hE(a),sigma:i.sigma!==void 0?i.sigma:vE(a)}},sourceData:FD.create(e),customProperties:new Hl,_propertyData:Object.create(null)}]})})})}var FD;(function(e){function t(n){return(n==null?void 0:n.kind)==="dsn6"}e.is=t;function r(n){return{kind:"dsn6",name:n.name,data:n}}e.create=r})(FD||(FD={}));function ZGe(e,t){var r=this;return $e.create("Create Volume",function(){return ce(r,void 0,void 0,function(){var n,i,a,o,s,u;return de(this,function(l){return n=e.header,i=e.values,a=Mr.Space(n.dim,[0,1,2],Float64Array),o=Mr.create(a,Mr.Data1(i)),s=ue.fromTranslation(ue(),n.min),u=ue.fromScaling(ue(),n.h),ue.mul(s,s,u),[2,{label:t==null?void 0:t.label,entryId:t==null?void 0:t.entryId,grid:{transform:{kind:"matrix",matrix:s},cells:o,stats:{min:pE(i),max:Nl(i),mean:hE(i),sigma:vE(i)}},sourceData:ND.create(e),customProperties:new Hl,_propertyData:Object.create(null)}]})})})}var ND;(function(e){function t(n){return(n==null?void 0:n.kind)==="dx"}e.is=t;function r(n){return{kind:"dx",name:n.name,data:n}}e.create=r})(ND||(ND={}));var JGe=kt.BuiltIn({name:"volume-from-ccp4",display:{name:"Volume from CCP4/MRC/MAP",description:"Create Volume from CCP4/MRC/MAP data"},from:ge.Format.Ccp4,to:ge.Volume.Data,params:function(e){return{voxelSize:I.Vec3(_.create(1,1,1)),offset:I.Vec3(_.create(0,0,0)),entryId:I.Text("")}}})({apply:function(e){var t=this,r=e.a,n=e.params;return $e.create("Create volume from CCP4/MRC/MAP",function(i){return ce(t,void 0,void 0,function(){var a,o;return de(this,function(s){switch(s.label){case 0:return[4,KGe(r.data,E(E({},n),{label:r.data.name||r.label})).runInContext(i)];case 1:return a=s.sent(),o={label:a.label||"Volume",description:"Volume "+r.data.header.NX+""+r.data.header.NX+""+r.data.header.NX},[2,new ge.Volume.Data(a,o)]}})})})},dispose:function(e){var t=e.b;t==null||t.data.customProperties.dispose()}}),eqe=kt.BuiltIn({name:"volume-from-dsn6",display:{name:"Volume from DSN6/BRIX",description:"Create Volume from DSN6/BRIX data"},from:ge.Format.Dsn6,to:ge.Volume.Data,params:function(e){return{voxelSize:I.Vec3(_.create(1,1,1)),entryId:I.Text("")}}})({apply:function(e){var t=this,r=e.a,n=e.params;return $e.create("Create volume from DSN6/BRIX",function(i){return ce(t,void 0,void 0,function(){var a,o;return de(this,function(s){switch(s.label){case 0:return[4,QGe(r.data,E(E({},n),{label:r.data.name||r.label})).runInContext(i)];case 1:return a=s.sent(),o={label:a.label||"Volume",description:"Volume "+r.data.header.xExtent+""+r.data.header.yExtent+""+r.data.header.zExtent},[2,new ge.Volume.Data(a,o)]}})})})},dispose:function(e){var t=e.b;t==null||t.data.customProperties.dispose()}}),tqe=kt.BuiltIn({name:"volume-from-cube",display:{name:"Volume from Cube",description:"Create Volume from Cube data"},from:ge.Format.Cube,to:ge.Volume.Data,params:function(e){var t=e?I.Select(0,e.data.header.dataSetIds.map(function(r,n){return[n,""+r]})):I.Numeric(0);return{dataIndex:t,entryId:I.Text("")}}})({apply:function(e){var t=this,r=e.a,n=e.params;return $e.create("Create volume from Cube",function(i){return ce(t,void 0,void 0,function(){var a,o;return de(this,function(s){switch(s.label){case 0:return[4,R9e(r.data,E(E({},n),{label:r.data.name||r.label})).runInContext(i)];case 1:return a=s.sent(),o={label:a.label||"Volume",description:"Volume "+r.data.header.dim[0]+""+r.data.header.dim[1]+""+r.data.header.dim[2]},[2,new ge.Volume.Data(a,o)]}})})})},dispose:function(e){var t=e.b;t==null||t.data.customProperties.dispose()}}),rqe=kt.BuiltIn({name:"volume-from-dx",display:{name:"Parse DX",description:"Create volume from DX data."},from:ge.Format.Dx,to:ge.Volume.Data})({apply:function(e){var t=this,r=e.a;return $e.create("Parse DX",function(n){return ce(t,void 0,void 0,function(){var i,a;return de(this,function(o){switch(o.label){case 0:return[4,ZGe(r.data,{label:r.data.name||r.label}).runInContext(n)];case 1:return i=o.sent(),a={label:i.label||"Volume",description:"Volume "+r.data.header.dim[0]+""+r.data.header.dim[1]+""+r.data.header.dim[2]},[2,new ge.Volume.Data(i,a)]}})})})},dispose:function(e){var t=e.b;t==null||t.data.customProperties.dispose()}}),nqe=kt.BuiltIn({name:"volume-from-density-server-cif",display:{name:"Volume from density-server CIF",description:"Identify and create all separate models in the specified CIF data block"},from:ge.Format.Cif,to:ge.Volume.Data,params:function(e){if(!e)return{blockHeader:I.Optional(I.Text(void 0,{description:"Header of the block to parse. If none is specifed, the 1st data block in the file is used."})),entryId:I.Text("")};var t=e.data.blocks.slice(1);return{blockHeader:I.Optional(I.Select(t[0]&&t[0].header,t.map(function(r){return[r.header,r.header]}),{description:"Header of the block to parse"})),entryId:I.Text("")}}})({isApplicable:function(e){return e.data.blocks.length>0},apply:function(e){var t=this,r=e.a,n=e.params;return $e.create("Parse density-server CIF",function(i){return ce(t,void 0,void 0,function(){var a,o,s,u,l,c,d,f,p,v;return de(this,function(h){switch(h.label){case 0:if(a=n.blockHeader||r.data.blocks[1].header,o=r.data.blocks.find(function(m){return m.header===a}),!o)throw new Error("Data block '"+[a]+"' not found.");return s=td.schema.densityServer(o),[4,ote(s,{entryId:n.entryId}).runInContext(i)];case 1:return u=h.sent(),l=u.grid.cells.space.dimensions,c=l[0],d=l[1],f=l[2],p={label:(v=n.entryId)!==null&&v!==void 0?v:s.volume_data_3d_info.name.value(0),description:"Volume "+c+""+d+""+f},[2,new ge.Volume.Data(u,p)]}})})})},dispose:function(e){var t=e.b;t==null||t.data.customProperties.dispose()}}),iqe=kt.BuiltIn({name:"assign-color-volume",display:{name:"Assign Color Volume",description:"Assigns another volume to be available for coloring."},from:ge.Volume.Data,to:ge.Volume.Data,isDecorator:!0,params:function(e,t){if(!e)return{ref:I.Text()};var r=t.state.data.select(ir.Generators.root.subtree().ofType(ge.Volume.Data).filter(function(n){var i;return!!n.obj&&!(!((i=n.obj)===null||i===void 0)&&i.data.colorVolume)&&n.obj!==e}));return r.length===0?{ref:I.Text("",{isHidden:!0})}:{ref:I.Select(r[0].transform.ref,r.map(function(n){return[n.transform.ref,n.obj.label]}))}}})({apply:function(e){var t=this,r=e.a,n=e.params,i=e.dependencies;return $e.create("Assign Color Volume",function(a){return ce(t,void 0,void 0,function(){var o,s,u;return de(this,function(l){if(!i||!i[n.ref])throw new Error("Dependency not available.");return o=i[n.ref].data,s=E(E({},r.data),{colorVolume:o}),u={label:r.label,description:"Volume + Colors"},[2,new ge.Volume.Data(s,u)]})})})}});const aqe=Object.freeze(Object.defineProperty({__proto__:null,AssignColorVolume:iqe,VolumeFromCcp4:JGe,VolumeFromCube:tqe,VolumeFromDensityServerCif:nqe,VolumeFromDsn6:eqe,VolumeFromDx:rqe},Symbol.toStringTag,{value:"Module"}));var Ux=at(13421772),oqe="Assigns colors according to the Symbol Nomenclature for Glycans (SNFG).",ste={};function sqe(e){return ste}function ute(e,t){var r;if(e.structure){var n=e.structure.carbohydrates,i=n.elements,a=n.getElementIndices,o=function(s,u){if(!je.isAtomic(s))return Ux;var l=a(s,u);return l.length>0?i[l[0]].component.color:Ux};r=function(s,u){return u?Dt.Secondary:Ze.is(s)?o(s.unit,s.element):Vt.isLocation(s)?o(s.aUnit,s.aUnit.elements[s.aIndex]):Ux}}else r=function(){return Ux};return{factory:ute,granularity:"group",color:r,props:t,description:oqe,legend:Pp(yke)}}var uqe={name:"carbohydrate-symbol",label:"Carbohydrate Symbol",category:"Residue Property",factory:ute,getParams:sqe,defaultValues:I.getDefaultValues(ste),isApplicable:function(e){return!!e.structure&&e.structure.models.some(function(t){return $t.hasCarbohydrate(t)})}},lte={hue:I.Interval([1,360],{min:0,max:360,step:1}),chroma:I.Interval([40,70],{min:0,max:100,step:1}),luminance:I.Interval([15,85],{min:0,max:100,step:1}),clusteringStepCount:I.Numeric(50,{min:10,max:200,step:1},{isHidden:!0}),minSampleCount:I.Numeric(800,{min:100,max:5e3,step:100},{isHidden:!0})};function cte(e,t){return Math.sqrt(Math.pow(Math.abs(e[0]-t[0]),2)+Math.pow(Math.abs(e[1]-t[1]),2)+Math.pow(Math.abs(e[2]-t[2]),2))}var mm=2,zp=[0,0,0],Vp=[0,0,0];function lqe(e,t){return sa.toHcl(zp,e),sa.fromColor(Vp,sa.toColor(e)),zp[0]>=t.hue[0]&&zp[0]<=t.hue[1]&&zp[1]>=t.chroma[0]&&zp[1]<=t.chroma[1]&&zp[2]>=t.luminance[0]&&zp[2]<=t.luminance[1]&&Vp[0]>=e[0]-mm&&Vp[0]<=e[0]+mm&&Vp[1]>=e[1]-mm&&Vp[1]<=e[1]+mm&&Vp[2]>=e[2]-mm&&Vp[2]<=e[2]+mm}function cqe(e){for(var t=e.slice(0),r=[t.shift()];t.length>0;){for(var n=r[r.length-1],i=0,a=Number.MIN_SAFE_INTEGER,o=0;o<t.length;++o){var s=cte(n,t[o]);s>a&&(a=s,i=o)}r.push(t.splice(i,1)[0])}return r}function dqe(e,t){for(var r=new Map,n=Math.cbrt(e)*1.001,i=(t.hue[1]-t.hue[0])/n,a=(t.chroma[1]-t.chroma[0])/n,o=(t.luminance[1]-t.luminance[0])/n,s=t.hue[0];s<=t.hue[1];s+=i)for(var u=t.chroma[0];u<=t.chroma[1];u+=a)for(var l=t.luminance[0];l<=t.luminance[1];l+=o){var c=sa.fromHcl(sa(),kl.create(s,u,l));lqe(c,t)&&r.set(c.toString(),c)}return Array.from(r.values())}function fqe(e,t){t===void 0&&(t={});var r=E(E({},I.getDefaultValues(lte)),t);if(e<=0)return[];var n=dqe(Math.max(r.minSampleCount,e*5),r);if(n.length<e)throw new Error("Not enough samples to generate distinct colors, increase sample count.");for(var i=[],a=[],o=Math.floor(n.length/e),s=0;s<n.length&&(i.push(n[s]),a.push([]),!(i.length>=e));s+=o);for(var u=1;u<=r.clusteringStepCount;++u){for(var l=cp(a),s=0;s<n.length;++s){for(var c=Number.MAX_SAFE_INTEGER,d=0,f=0;f<i.length;f++){var p=cte(n[s],i[f]);p<c&&(c=p,d=f)}l[d].push(n[s])}for(var v=cp(i),s=0;s<l.length;++s){for(var h=l[s],m=h.length,g=[],y=[],b=[],S=0,x=h;S<x.length;S++){var C=x[S];g.push(C[0]),y.push(C[1]),b.push(C[2])}var w=y1(g)/m,A=y1(y)/m,M=y1(b)/m;i[s]=[w,A,M]}if(Xc(v,i))break}return cqe(i).map(function(D){return sa.toColor(D)})}var dte={type:"generate",colorList:"red-yellow-blue"};function vs(e){e===void 0&&(e={});var t=E(E({},dte),e);return{palette:I.MappedStatic(t.type,{colors:I.Group({list:I.ColorList(t.colorList)},{isFlat:!0}),generate:I.Group(E(E({},lte),{maxCount:I.Numeric(75,{min:1,max:250,step:1})}),{isFlat:!0})},{options:[["colors","Color List"],["generate","Generate Distinct"]]})}}I.getDefaultValues(vs());var Dz={valueLabel:function(e){return""+(e+1)},minLabel:"Start",maxLabel:"End"};function ru(e,t,r){var n;r===void 0&&(r={});var i,a;if(t.palette.name==="colors"&&t.palette.params.list.kind==="interpolate"){var o=t.palette.params.list,s=[0,e-1],u=E(E({},Dz),r),l=u.minLabel,c=u.maxLabel,d=o.colors;d.length===0&&(d=$s(dte.colorList).list);var f=Bu.create({listOrName:d,domain:s,minLabel:l,maxLabel:c});a=f.legend,i=f.color}else{var p;t.palette.name==="colors"?(p=t.palette.params.list.colors.map(function(b){return Array.isArray(b)?b[0]:b}),p.length===0&&(p=$s("dark-2").list.map(function(b){return Array.isArray(b)?b[0]:b}))):(e=Math.min(e,t.palette.params.maxCount),p=fqe(e,t.palette.params));for(var v=(n=r.valueLabel)!==null&&n!==void 0?n:Dz.valueLabel,h=p.length,m=[],g=0;g<e;++g){var y=g%h;m[y]===void 0?m[y]=[v(g),p[y]]:m[y][0]+=", "+v(g)}a=Pp(m),i=function(b){return p[b%h]}}return{color:i,legend:a}}var pqe="many-distinct",Rz=at(16448250),hqe="Gives every chain a color based on its `asym_id` value.",FE=E({asymId:I.Select("auth",I.arrayToOptions(["auth","label"]))},vs({type:"colors",colorList:pqe}));function vqe(e){var t,r=I.clone(FE);return!((t=e.structure)===null||t===void 0)&&t.models.some(function(n){return n.coarseHierarchy.isDefined})&&(r.asymId.defaultValue="label"),r}function mqe(e,t){switch(e.kind){case 0:return t==="auth"?lt.chain.auth_asym_id:lt.chain.label_asym_id;case 1:case 2:return lt.coarse.asym_id}}function kz(e,t){var r=mqe(e.unit,t)(e);return e.structure.root.models.length>1?fte(e.unit.model,r):r}function fte(e,t){return t+"|"+(($t.Index.get(e).value||0)+1)}function gqe(e,t){for(var r=new Map,n=function(s){var u=$t.AsymIdOffset.get(s).value,l=(t==="auth"?u==null?void 0:u.auth:u==null?void 0:u.label)||0,c=0;s.properties.structAsymMap.forEach(function(d,f){var p=d.auth_id,v=t==="auth"?p:f,h=e.models.length>1?fte(s,v):v;r.has(h)||(r.set(h,c+l),++c)})},i=0,a=e.models;i<a.length;i++){var o=a[i];n(o)}return r}function NE(e,t){var r,n;if(e.structure){var i=Ze.create(e.structure.root),a=gqe(e.structure.root,t.asymId),o=Array.from(a.keys()),s=function(l){return o[l]},u=ru(a.size,t,{valueLabel:s});n=u.legend,r=function(l){var c=void 0;if(Ze.is(l)){var d=kz(l,t.asymId);c=a.get(d)}else if(Vt.isLocation(l)){i.unit=l.aUnit,i.element=l.aUnit.elements[l.aIndex];var d=kz(i,t.asymId);c=a.get(d)}return c===void 0?Rz:u.color(c)}}else r=function(){return Rz};return{factory:NE,granularity:"group",color:r,props:t,description:hqe,legend:n}}var pte={name:"chain-id",label:"Chain Id",category:"Chain Property",factory:NE,getParams:vqe,defaultValues:I.getDefaultValues(FE),isApplicable:function(e){return!!e.structure}},Oz=at(13421772),yqe="Gives every element (atom or coarse sphere/gaussian) a unique color based on the position (index) of the element in the list of elements in the structure.",hte=E({},vs({type:"colors",colorList:"red-yellow-blue"}));function bqe(e){return hte}function vte(e,t){var r,n;if(e.structure){for(var i=e.structure.root.units,a=i.length,o=new Map,s=new Map,u=0,l=0;l<a;++l)o.set(l,u),u+=i[l].elements.length,s.set(i[l].id,l);var c=ru(u,t);n=c.legend,r=function(d){if(Ze.is(d)){var f=s.get(d.unit.id),p=Le.findPredecessorIndex(i[f].elements,d.element);return c.color(o.get(f)+p)}else if(Vt.isLocation(d)){var f=s.get(d.aUnit.id),p=Le.findPredecessorIndex(i[f].elements,d.aUnit.elements[d.aIndex]);return c.color(o.get(f)+p)}return Oz}}else r=function(){return Oz};return{factory:vte,granularity:"groupInstance",preferSmoothing:!0,color:r,props:t,description:yqe,legend:n}}var xqe={name:"element-index",label:"Element Index",category:"Atom Property",factory:vte,getParams:bqe,defaultValues:I.getDefaultValues(hte),isApplicable:function(e){return!!e.structure}},Sqe="many-distinct",Lz=at(13421772),Cqe="Assigns a color based on the operator name of a transformed chain.",YL=E({},vs({type:"colors",colorList:Sqe}));function _qe(e){var t=I.clone(YL);return t}function wqe(e){for(var t=new Map,r=0,n=e.units.length;r<n;++r){var i=e.units[r].conformation.operator.name;t.has(i)||t.set(i,t.size)}return t}function KL(e,t){var r,n;if(e.structure){var i=wqe(e.structure.root),a=Array.from(i.keys()),o=function(u){return a[u]},s=ru(i.size,t,{valueLabel:o});n=s.legend,r=function(u){var l=void 0;if(Ze.is(u)){var c=u.unit.conformation.operator.name;l=i.get(c)}else if(Vt.isLocation(u)){var d=u.aUnit.conformation.operator.name;l=i.get(d)}return l===void 0?Lz:s.color(l)}}else r=function(){return Lz};return{factory:KL,granularity:"instance",color:r,props:t,description:Cqe,legend:n}}var QL={name:"operator-name",label:"Operator Name",category:"Symmetry",factory:KL,getParams:_qe,defaultValues:I.getDefaultValues(YL),isApplicable:function(e){return!!e.structure}},aT={H:16777215,D:16777152,T:16777120,HE:14286847,LI:13402367,BE:12779264,B:16758197,C:9474192,N:3166456,O:16715021,F:9494608,NE:11789301,NA:11230450,MG:9109248,AL:12560038,SI:1578e4,P:16744448,S:16777008,CL:2093087,AR:8442339,K:9388244,CA:4062976,SC:15132390,TI:12567239,V:10921643,CR:9083335,MN:10255047,FE:14706227,CO:15765664,NI:5296208,CU:13140019,ZN:8224944,GA:12750735,GE:6721423,AS:12419299,SE:16752896,BR:10889513,KR:6076625,RB:7351984,SR:65280,Y:9764863,ZR:9756896,NB:7586505,MO:5551541,TC:3907230,RU:2396047,RH:687500,PD:27013,AG:12632256,CD:16767375,IN:10909043,SN:6717568,SB:10380213,TE:13924864,I:9699476,XE:9699476,CS:5707663,BA:51456,LA:7394559,CE:16777159,PR:14286791,ND:13107143,PM:10747847,SM:9437127,EU:6422471,GD:4587463,TB:3211207,DY:2097095,HO:65436,ER:58997,TM:54354,YB:48952,LU:43812,HF:5096191,TA:5089023,W:2200790,RE:2522539,OS:2516630,IR:1528967,PT:13684960,AU:16765219,HG:12105936,TL:10900557,PB:5724513,BI:10375093,PO:11230208,AT:7688005,RN:4358806,FR:4325478,RA:32e3,AC:7384058,TH:47871,PA:41471,U:36863,NP:33023,PU:27647,AM:5528818,CM:7888099,BK:9064419,CF:10565332,ES:11739092,FM:11739066,MD:11734438,NO:12389767,LR:13041766,RF:13369433,DB:13697103,SG:14221381,BH:14680120,HS:15073326,MT:15400998,DS:16777215,RG:16777215,CN:16777215,UUT:16777215,FL:16777215,UUP:16777215,LV:16777215,UUH:16777215},mte=at(16777215),Eqe="Assigns a color to every atom according to its chemical element.",gte={carbonColor:I.MappedStatic("chain-id",{"chain-id":I.Group(E({},FE)),"operator-name":I.Group(E({},YL)),"element-symbol":I.Group({})},{description:"Use chain-id coloring for carbon atoms."}),saturation:I.Numeric(0,{min:-6,max:6,step:.1}),lightness:I.Numeric(.2,{min:-6,max:6,step:.1})};function Aqe(e){return gte}function Pqe(e,t){var r=e[t];return r===void 0?mte:r}function yte(e,t){var r=aE(aT,t.saturation,t.lightness),n=t.carbonColor.name==="chain-id"?NE(e,t.carbonColor.params).color:t.carbonColor.name==="operator-name"?KL(e,t.carbonColor.params).color:void 0;function i(s,u){return n&&s==="C"?n(u,!1):Pqe(r,s)}function a(s){if(Ze.is(s)){if(je.isAtomic(s.unit)){var u=s.unit.model.atomicHierarchy.atoms.type_symbol;return i(u.value(s.element),s)}}else if(Vt.isLocation(s)&&je.isAtomic(s.aUnit)){var u=s.aUnit.model.atomicHierarchy.atoms.type_symbol,l=u.value(s.aUnit.elements[s.aIndex]);return i(l,s)}return mte}var o=t.carbonColor.name==="operator-name"?"groupInstance":"group";return{factory:yte,granularity:o,preferSmoothing:!0,color:a,props:t,description:Eqe,legend:Pp(Object.keys(aT).map(function(s){return[s,aT[s]]}))}}var Tqe={name:"element-symbol",label:"Element Symbol",category:"Atom Property",factory:yte,getParams:Aqe,defaultValues:I.getDefaultValues(gte),isApplicable:function(e){return!!e.structure}},oT={water:3697840,ion:15729279,protein:12496596,RNA:16629894,DNA:12540695,PNA:4367514,saccharide:8374655},BD=at(16777113),Iqe="Assigns a color based on the molecule type of a residue.",bte={saturation:I.Numeric(0,{min:-6,max:6,step:.1}),lightness:I.Numeric(0,{min:-6,max:6,step:.1})};function Mqe(e){return bte}function Fz(e,t,r){var n=PL(t,r);switch(n){case 2:return e.water;case 3:return e.ion;case 5:return e.protein;case 6:return e.RNA;case 7:return e.DNA;case 8:return e.PNA;case 9:return e.saccharide}return BD}function xte(e,t){var r=aE(oT,t.saturation,t.lightness);function n(i){return Ze.is(i)?Fz(r,i.unit,i.element):Vt.isLocation(i)?Fz(r,i.aUnit,i.aUnit.elements[i.aIndex]):BD}return{factory:xte,granularity:"group",color:n,props:t,description:Iqe,legend:Pp(Object.keys(oT).map(function(i){return[i,oT[i]]}).concat([["Other/unknown",BD]]))}}var Dqe={name:"molecule-type",label:"Molecule Type",category:"Residue Property",factory:xte,getParams:Mqe,defaultValues:I.getDefaultValues(bte),isApplicable:function(e){return!!e.structure}},UD="dark-2",Nz=at(16448250),Rqe="Gives every polymer chain a color based on its `asym_id` value.",Ste=E({},vs({type:"colors",colorList:UD}));function kqe(e){var t=I.clone(Ste);return e.structure&&Cte(e.structure.root).size>Eo[UD].list.length&&(t.palette.defaultValue.name="colors",t.palette.defaultValue.params=E(E({},t.palette.defaultValue.params),{list:{kind:"interpolate",colors:$s(UD).list}})),t}function Bz(e){switch(e.kind){case 0:return lt.chain.label_asym_id;case 1:case 2:return lt.coarse.asym_id}}function Cte(e){for(var t=new Map,r=0,n=e.unitSymmetryGroups.length;r<n;++r){var i=e.unitSymmetryGroups[r].units[0],a=i.model;if(je.isAtomic(i))for(var o=a.atomicHierarchy,s=o.chainAtomSegments,u=o.chains,l=nr.transientSegments(s,i.elements);l.hasNext;){var c=l.move().index,d=u.label_entity_id.value(c),f=a.entities.getEntityIndex(d);if(a.entities.data.type.value(f)==="polymer"){var p=u.label_asym_id.value(c);t.has(p)||t.set(p,t.size)}}else if(je.isCoarse(i))for(var v=je.isSpheres(i)?a.coarseHierarchy.spheres:a.coarseHierarchy.gaussians,h=v.chainElementSegments,m=v.asym_id,g=v.entity_id,l=nr.transientSegments(h,i.elements);l.hasNext;){var c=l.move().index,y=h.offsets[c],d=g.value(y),f=a.entities.getEntityIndex(d);if(a.entities.data.type.value(f)==="polymer"){var p=m.value(y);t.has(p)||t.set(p,t.size)}}}return t}function _te(e,t){var r,n;if(e.structure){var i=Ze.create(e.structure),a=Cte(e.structure.root),o=Array.from(a.keys()),s=function(l){return o[l]},u=ru(a.size,t,{valueLabel:s});n=u.legend,r=function(l){var c=void 0;if(Ze.is(l)){var d=Bz(l.unit);c=a.get(d(l))}else if(Vt.isLocation(l)){var d=Bz(l.aUnit);i.unit=l.aUnit,i.element=l.aUnit.elements[l.aIndex],c=a.get(d(i))}return c===void 0?Nz:u.color(c)}}else r=function(){return Nz};return{factory:_te,granularity:"group",color:r,props:t,description:Rqe,legend:n}}var Oqe={name:"polymer-id",label:"Polymer Chain Id",category:"Chain Property",factory:_te,getParams:kqe,defaultValues:I.getDefaultValues(Ste),isApplicable:function(e){return!!e.structure}},jD="dark-2",Uz=at(13421772),Lqe="Gives every polymer chain instance a unique color based on the position (index) of the polymer in the list of polymers in the structure.",wte=E({},vs({type:"colors",colorList:jD}));function Fqe(e){var t=I.clone(wte);return e.structure&&Ete(e.structure.root)>Eo[jD].list.length&&(t.palette.defaultValue.name="colors",t.palette.defaultValue.params=E(E({},t.palette.defaultValue.params),{list:{kind:"interpolate",colors:$s(jD).list}})),t}function Ete(e){for(var t=0,r=e.units,n=0,i=r.length;n<i;++n)r[n].polymerElements.length>0&&++t;return t}function Ate(e,t){var r,n;if(e.structure){var i=ru(Ete(e.structure.root),t);n=i.legend;for(var a=e.structure.root.units,o=new Map,s=0,u=0,l=a.length;s<l;++s)a[s].polymerElements.length>0&&(o.set(a[s].id,i.color(u)),++u);r=function(c){var d;return Ze.is(c)?d=o.get(c.unit.id):Vt.isLocation(c)&&(d=o.get(c.aUnit.id)),d!==void 0?d:Uz}}else r=function(){return Uz};return{factory:Ate,granularity:"instance",color:r,props:t,description:Lqe,legend:n}}var Nqe={name:"polymer-index",label:"Polymer Chain Instance",category:"Chain Property",factory:Ate,getParams:Fqe,defaultValues:I.getDefaultValues(wte),isApplicable:function(e){return!!e.structure}},sT={ALA:9240460,ARG:124,ASN:16743536,ASP:10485826,CYS:16777072,GLN:16731212,GLU:6684672,GLY:15658734,HIS:7368959,ILE:19456,LEU:4546117,LYS:4671416,MET:12099650,PHE:5459026,PRO:5395026,SER:16740418,THR:12078080,TRP:5195264,TYR:9203788,VAL:16747775,A:14423100,G:3329330,I:10145074,C:16766720,T:4286945,U:4251856,DA:14423100,DG:3329330,DI:10145074,DC:16766720,DT:4286945,DU:4251856,APN:14423100,GPN:3329330,CPN:16766720,TPN:4286945},zD=at(16711935),Bqe="Assigns a color to every residue according to its name.",Pte={saturation:I.Numeric(0,{min:-6,max:6,step:.1}),lightness:I.Numeric(1,{min:-6,max:6,step:.1})};function Uqe(e){return Pte}function jz(e,t){return e.model.atomicHierarchy.atoms.label_comp_id.value(t)}function zz(e,t){var r=e.coarseElements.seq_id_begin.value(t),n=e.coarseElements.seq_id_end.value(t);if(r===n){var i=e.coarseElements.entityKey[t],a=e.model.sequence.byEntityKey[i].sequence;return a.compId.value(r-1)}}function jx(e,t){var r=e[t];return r===void 0?zD:r}function Tte(e,t){var r=aE(sT,t.saturation,t.lightness);function n(i){if(Ze.is(i))if(je.isAtomic(i.unit)){var a=jz(i.unit,i.element);return jx(r,a)}else{var a=zz(i.unit,i.element);if(a)return jx(r,a)}else if(Vt.isLocation(i))if(je.isAtomic(i.aUnit)){var a=jz(i.aUnit,i.aUnit.elements[i.aIndex]);return jx(r,a)}else{var a=zz(i.aUnit,i.aUnit.elements[i.aIndex]);if(a)return jx(r,a)}return zD}return{factory:Tte,granularity:"group",preferSmoothing:!0,color:n,props:t,description:Bqe,legend:Pp(Object.keys(sT).map(function(i){return[i,sT[i]]}).concat([["Unknown",zD]]))}}var jqe={name:"residue-name",label:"Residue Name",category:"Residue Property",factory:Tte,getParams:Uqe,defaultValues:I.getDefaultValues(Pte),isApplicable:function(e){return!!e.structure}},uT={alphaHelix:16711808,threeTenHelix:10485888,piHelix:6291584,betaTurn:6324479,betaStrand:16762880,coil:16777215,bend:6740169,turn:45670,dna:11403518,rna:16580962,carbohydrate:10921722},VD=at(8421504),zqe="Assigns a color based on the type of secondary structure and basic molecule type.",Ite={saturation:I.Numeric(-1,{min:-6,max:6,step:.1}),lightness:I.Numeric(0,{min:-6,max:6,step:.1})};function Vqe(e){return Ite}function Vz(e,t,r,n){var i=Br.create(0);if(n&&je.isAtomic(t)){var a=n.get(t.invariantId);a&&(i=a.type[a.getIndex(t.residueIndex[r])])}if(Br.is(i,2))return Br.is(i,2048)?e.threeTenHelix:Br.is(i,32768)?e.piHelix:e.alphaHelix;if(Br.is(i,4))return e.betaStrand;if(Br.is(i,8))return e.bend;if(Br.is(i,16))return e.turn;var o=PL(t,r);return o===7?e.dna:o===6?e.rna:o===9?e.carbohydrate:o===5?e.coil:VD}function Mte(e,t){var r=e.structure&&zl.get(e.structure),n=r?Dv(r.id,r.version):-1,i=aE(uT,t.saturation,t.lightness);function a(o){return Ze.is(o)?Vz(i,o.unit,o.element,r==null?void 0:r.value):Vt.isLocation(o)?Vz(i,o.aUnit,o.aUnit.elements[o.aIndex],r==null?void 0:r.value):VD}return{factory:Mte,granularity:"group",preferSmoothing:!0,color:a,props:t,contextHash:n,description:zqe,legend:Pp(Object.keys(uT).map(function(o){return[o,uT[o]]}).concat([["Other",VD]]))}}var Hqe={name:"secondary-structure",label:"Secondary Structure",category:"Residue Property",factory:Mte,getParams:Vqe,defaultValues:I.getDefaultValues(Ite),isApplicable:function(e){return!!e.structure},ensureCustomProperties:{attach:function(e,t){return t.structure?zl.attach(e,t.structure,void 0,!0):Promise.resolve()},detach:function(e){return e.structure&&zl.ref(e.structure,!1)}}},Gqe=at(13421772),qqe="Gives every polymer residue a color based on its `seq_id` value.",Dte={list:I.ColorList("turbo",{presetKind:"scale"})};function $qe(e){return Dte}function Hz(e,t){var r=e.model;switch(e.kind){case 0:var n=r.atomicHierarchy.residueAtomSegments.index[t];return r.atomicHierarchy.residues.label_seq_id.value(n);case 1:return Math.round((r.coarseHierarchy.spheres.seq_id_begin.value(t)+r.coarseHierarchy.spheres.seq_id_end.value(t))/2);case 2:return Math.round((r.coarseHierarchy.gaussians.seq_id_begin.value(t)+r.coarseHierarchy.gaussians.seq_id_end.value(t))/2)}}function Gz(e,t){var r=e.model,n="";switch(e.kind){case 0:var i=r.atomicHierarchy.chainAtomSegments.index[t];n=r.atomicHierarchy.chains.label_entity_id.value(i);break;case 1:n=r.coarseHierarchy.spheres.entity_id.value(t);break;case 2:n=r.coarseHierarchy.gaussians.entity_id.value(t);break}if(n==="")return 0;var a=r.entities.getEntityIndex(n);if(a===-1)return 0;var o=r.sequence.byEntityKey[a];return o===void 0?0:o.sequence.length}function Rte(e,t){var r=Bu.create({listOrName:t.list.colors,minLabel:"Start",maxLabel:"End"}),n=function(i){if(Ze.is(i)){var a=i.unit,o=i.element,s=Hz(a,o);if(s>0){var u=Gz(a,o);if(u)return r.setDomain(0,u-1),r.color(s)}}else if(Vt.isLocation(i)){var l=i.aUnit,c=i.aIndex,s=Hz(l,l.elements[c]);if(s>0){var u=Gz(l,l.elements[c]);if(u)return r.setDomain(0,u-1),r.color(s)}}return Gqe};return{factory:Rte,granularity:"group",preferSmoothing:!0,color:n,props:t,description:qqe,legend:r?r.legend:void 0}}var Wqe={name:"sequence-id",label:"Sequence Id",category:"Residue Property",factory:Rte,getParams:$qe,defaultValues:I.getDefaultValues(Dte),isApplicable:function(e){return!!e.structure}},HD="dark-2",qz=at(13421772),Xqe="Gives every chain instance (single chain or collection of single elements) a unique color based on the position (index) of the chain in the list of chains in the structure.",kte=E({},vs({type:"colors",colorList:HD}));function Yqe(e){var t=I.clone(kte);return e.structure&&e.structure.root.units.length>Eo[HD].list.length&&(t.palette.defaultValue.name="colors",t.palette.defaultValue.params=E(E({},t.palette.defaultValue.params),{list:{kind:"interpolate",colors:$s(HD).list}})),t}function Ote(e,t){var r,n;if(e.structure){var i=e.structure.root.units,a=ru(i.length,t);n=a.legend;for(var o=new Map,s=0,u=i.length;s<u;++s)o.set(i[s].id,a.color(s));r=function(l){return Ze.is(l)?o.get(l.unit.id):Vt.isLocation(l)?o.get(l.aUnit.id):qz}}else r=function(){return qz};return{factory:Ote,granularity:"instance",color:r,props:t,description:Xqe,legend:n}}var Kqe={name:"unit-index",label:"Chain Instance",category:"Chain Property",factory:Ote,getParams:Yqe,defaultValues:I.getDefaultValues(kte),isApplicable:function(e){return!!e.structure}},Qqe=at(16777113),Zqe="Assigns a color based on the uncertainty or disorder of an element's position, e.g. B-factor or RMSF, depending on the data availability and experimental technique.",Lte={domain:I.Interval([0,100]),list:I.ColorList("red-white-blue",{presetKind:"scale"})};function Jqe(e){return Lte}function $z(e,t){return je.isAtomic(e)?e.model.atomicConformation.B_iso_or_equiv.value(t):je.isSpheres(e)?e.model.coarseConformation.spheres.rmsf[t]:0}function Fte(e,t){var r=Bu.create({reverse:!0,domain:t.domain,listOrName:t.list.colors});function n(i){return Ze.is(i)?r.color($z(i.unit,i.element)):Vt.isLocation(i)?r.color($z(i.aUnit,i.aUnit.elements[i.aIndex])):Qqe}return{factory:Fte,granularity:"group",preferSmoothing:!0,color:n,props:t,description:Zqe,legend:r?r.legend:void 0}}var e$e={name:"uncertainty",label:"Uncertainty/Disorder",category:"Atom Property",factory:Fte,getParams:Jqe,defaultValues:I.getDefaultValues(Lte),isApplicable:function(e){return!!e.structure&&e.structure.models.some(function(t){return t.atomicConformation.B_iso_or_equiv.isDefined||t.coarseHierarchy.isDefined})}},GD="dark-2",zx=at(16448250),t$e="Gives ranges of a polymer chain a color based on the entity source it originates from (e.g. gene, plasmid, organism).",Nte=E({},vs({type:"colors",colorList:GD}));function r$e(e){var t=I.clone(Nte);return e.structure&&Ute(e.structure.root.models).srcKeySerialMap.size>Eo[GD].list.length&&(t.palette.defaultValue.name="colors",t.palette.defaultValue.params=E(E({},t.palette.defaultValue.params),{list:{kind:"interpolate",colors:$s(GD).list}})),t}function Bte(e,t){return e+"|"+t}function n$e(e,t,r,n,i,a){return e+"|"+t+"|"+r+"|"+(a||i||n)}function lT(e,t,r,n,i,a,o,s){for(var u=i.entity_id,l=i.pdbx_src_id,c=i.pdbx_beg_seq_num,d=i.pdbx_end_seq_num,f=0,p=i._rowCount;f<p;++f){var v=u.value(f),h=Bte(r,v),m=void 0;if(e.has(h))m=e.get(h);else{var g=n.entities.getEntityIndex(v),y=n.sequence.sequences[g].sequence;m=new Int16Array(y.length),e.set(h,m)}var b=o?o.value(f):"",S=s?s.value(f)[0]:"",x=n$e(r,v,a.value(f),l.value(f),b,S),C=c.valueKind(f)===0?c.value(f):1,w=d.valueKind(f)===0?d.value(f):m.length,A=void 0;t.has(x)?A=t.get(x):(A=t.size+1,t.set(x,A));for(var M=C,D=w;M<=D;++M)m[M-1]=A}}function Ute(e){for(var t=new Map,r=new Map,n=0,i=e.length;n<i;++n){var a=e[n];if(an.is(a.sourceData)){var o=a.sourceData.data.db,s=o.entity_src_gen,u=o.entity_src_nat,l=o.pdbx_entity_src_syn;lT(t,r,n,a,s,s.pdbx_gene_src_scientific_name,s.plasmid_name,s.pdbx_gene_src_gene),lT(t,r,n,a,u,u.pdbx_organism_scientific,u.pdbx_plasmid_name),lT(t,r,n,a,l,l.organism_scientific)}}return{seqToSrcByModelEntity:t,srcKeySerialMap:r}}function i$e(e){var t=0;return Array.from(e.keys()).map(function(r){var n=r.split("|"),i=n[2],a=YOe(n[3])?"Unnamed "+ ++t:n[3];return""+a+(i?" ("+i+")":"")})}function jte(e,t){var r,n;if(e.structure){var i=Ze.create(e.structure),a=e.structure.root.models,o=Ute(a),s=o.seqToSrcByModelEntity,u=o.srcKeySerialMap,l=i$e(u),c=function(p){return l[p]},d=ru(u.size,t,{valueLabel:c});n=d.legend;var f=function(p){var v=a.indexOf(p.unit.model),h=lt.entity.id(p),m=Bte(v,h),g=s.get(m);if(g){var y=g[lt.residue.label_seq_id(p)-1]-1;return y===-1?zx:d.color(y)}else return zx};r=function(p){return Ze.is(p)?f(p):Vt.isLocation(p)?(i.unit=p.aUnit,i.element=p.aUnit.elements[p.aIndex],f(i)):zx}}else r=function(){return zx};return{factory:jte,granularity:"group",color:r,props:t,description:t$e,legend:n}}var a$e={name:"entity-source",label:"Entity Source",category:"Chain Property",factory:jte,getParams:r$e,defaultValues:I.getDefaultValues(Nte),isApplicable:function(e){return!!e.structure}},o$e=at(15658734),s$e="Assigns an illustrative color that gives every chain a unique color with lighter carbons (inspired by David Goodsell's Molecule of the Month style).",zte=E({},FE);function u$e(e){return zte}function Vte(e,t){var r=NE(e,t),n=r.color,i=r.legend;function a(s,u){var l=n(s,!1);return u==="C"?at.lighten(l,.8):l}function o(s){if(Ze.is(s)&&je.isAtomic(s.unit)){var u=s.unit.model.atomicHierarchy.atoms.type_symbol.value(s.element);return a(s,u)}else if(Vt.isLocation(s)&&je.isAtomic(s.aUnit)){var l=s.aUnit.elements[s.aIndex],u=s.aUnit.model.atomicHierarchy.atoms.type_symbol.value(l);return a(s,u)}return o$e}return{factory:Vte,granularity:"group",preferSmoothing:!0,color:o,props:t,description:s$e,legend:i}}var l$e={name:"illustrative",label:"Illustrative",category:"Miscellaneous",factory:Vte,getParams:u$e,defaultValues:I.getDefaultValues(zte),isApplicable:function(e){return!!e.structure}},c$e='Assigns a color to every amino acid according to the "Experimentally determined hydrophobicity scale for proteins at membrane interfaces" by Wimely and White (doi:10.1038/nsb1096-842).',Hte={list:I.ColorList("red-yellow-green",{presetKind:"scale"}),scale:I.Select("DGwif",[["DGwif","DG water-membrane"],["DGwoct","DG water-octanol"],["Oct-IF","DG difference"]])};function d$e(e){return Hte}var f$e={DGwif:0,DGwoct:1,"Oct-IF":2};function p$e(e,t){var r=eD[e];return r===void 0?0:r[t]}function Wz(e,t){return e.model.atomicHierarchy.atoms.label_comp_id.value(t)}function Xz(e,t){var r=e.coarseElements.seq_id_begin.value(t),n=e.coarseElements.seq_id_end.value(t);if(r===n){var i=e.coarseElements.entityKey[t],a=e.model.sequence.byEntityKey[i].sequence;return a.compId.value(r-1)}}function Gte(e,t){var r=f$e[t.scale],n=1/0,i=-1/0;for(var a in eD){var o=eD[a][r];n=Math.min(n,o),i=Math.max(i,o)}var s=Bu.create({listOrName:t.list.colors,domain:[i,n],minLabel:"Hydrophobic",maxLabel:"Hydrophilic"});function u(l){var c;return Ze.is(l)?je.isAtomic(l.unit)?c=Wz(l.unit,l.element):c=Xz(l.unit,l.element):Vt.isLocation(l)&&(je.isAtomic(l.aUnit)?c=Wz(l.aUnit,l.aUnit.elements[l.aIndex]):c=Xz(l.aUnit,l.aUnit.elements[l.aIndex])),s.color(c?p$e(c,r):0)}return{factory:Gte,granularity:"group",preferSmoothing:!0,color:u,props:t,description:c$e,legend:s?s.legend:void 0}}var h$e={name:"hydrophobicity",label:"Hydrophobicity",category:"Residue Property",factory:Gte,getParams:d$e,defaultValues:I.getDefaultValues(Hte),isApplicable:function(e){return!!e.structure}},Yz=at(13421772),v$e="Gives every model a unique color based on the position (index) of the model in the list of models in the structure.",qte=E({},vs({type:"colors",colorList:"purples"}));function m$e(e){return qte}function $te(e,t){var r,n,i,a;if(e.structure){for(var o=e.structure.root.models,s=0,u=0,l=o;u<l.length;u++){var c=l[u];s=Math.max(s,((r=$t.TrajectoryInfo.get(c))===null||r===void 0?void 0:r.size)||0)}var d=ru(s,t);a=d.legend;for(var f=new Map,p=0,v=o.length;p<v;++p){var h=((n=$t.TrajectoryInfo.get(o[p]))===null||n===void 0?void 0:n.index)||0;f.set(h,d.color(h))}i=function(m){return Ze.is(m)?f.get($t.TrajectoryInfo.get(m.unit.model).index):Vt.isLocation(m)?f.get($t.TrajectoryInfo.get(m.aUnit.model).index):Yz}}else i=function(){return Yz};return{factory:$te,granularity:"instance",color:i,props:t,description:v$e,legend:a}}var g$e={name:"model-index",label:"Model Index",category:"Chain Property",factory:$te,getParams:m$e,defaultValues:I.getDefaultValues(qte),isApplicable:function(e){return!!e.structure&&e.structure.elementCount>0&&$t.TrajectoryInfo.get(e.structure.models[0]).size>1}},y$e=at(13421772),b$e="Assigns a color based on the occupancy of an atom.",Wte={domain:I.Interval([0,1]),list:I.ColorList("purples",{presetKind:"scale"})};function x$e(e){return Wte}function Kz(e,t){return je.isAtomic(e)?e.model.atomicConformation.occupancy.value(t):0}function Xte(e,t){var r=Bu.create({reverse:!1,domain:t.domain,listOrName:t.list.colors});function n(i){return Ze.is(i)?r.color(Kz(i.unit,i.element)):Vt.isLocation(i)?r.color(Kz(i.aUnit,i.aUnit.elements[i.aIndex])):y$e}return{factory:Xte,granularity:"group",preferSmoothing:!0,color:n,props:t,description:b$e,legend:r?r.legend:void 0}}var S$e={name:"occupancy",label:"Occupancy",category:"Atom Property",factory:Xte,getParams:x$e,defaultValues:I.getDefaultValues(Wte),isApplicable:function(e){return!!e.structure&&e.structure.models.some(function(t){return t.atomicConformation.occupancy.isDefined})}},qD="dark-2",Qz=at(13421772),C$e="Assigns a color based on the operator HKL value of a transformed chain.",Yte=E({},vs({type:"colors",colorList:qD}));function _$e(e){var t=I.clone(Yte);return e.structure&&Kte(e.structure.root).map.size>Eo[qD].list.length&&(t.palette.defaultValue.name="colors",t.palette.defaultValue.params=E(E({},t.palette.defaultValue.params),{list:{kind:"interpolate",colors:$s(qD).list}})),t}var Ky=1e4;function $D(e){return e.map(function(t){return(""+(t+Ky)).padStart(5,"0")}).join("")}function WD(e){var t=WOe(Ky,0),r=parseInt(e.substr(0,t)),n=parseInt(e.substr(t,t)),i=parseInt(e.substr(t+t,t));return[r-Ky,n-Ky,i-Ky]}function cT(e){return e.map(function(t){return t+5}).join("")}function Kte(e){for(var t=new Map,r=new Set,n=0,i=e.units.length;n<i;++n){var a=$D(e.units[n].conformation.operator.hkl);r.add(a)}var o=Array.from(r.values()).sort();o.forEach(function(l){return t.set(l,t.size)});var s=WD(o[0]),u=WD(o[o.length-1]);return{min:s,max:u,map:t}}function Qte(e,t){var r,n;if(e.structure){var i=Kte(e.structure.root),a=i.min,o=i.max,s=i.map,u=[];s.forEach(function(d,f){var p=d%s.size,v=cT(WD(f));u[p]===void 0?u[p]=v:u[p]+=", "+v});var l={minLabel:cT(a),maxLabel:cT(o),valueLabel:function(d){return u[d]}},c=ru(s.size,t,l);n=c.legend,r=function(d){var f=void 0;if(Ze.is(d)){var p=$D(d.unit.conformation.operator.hkl);f=s.get(p)}else if(Vt.isLocation(d)){var p=$D(d.aUnit.conformation.operator.hkl);f=s.get(p)}return f===void 0?Qz:c.color(f)}}else r=function(){return Qz};return{factory:Qte,granularity:"instance",color:r,props:t,description:C$e,legend:n}}var w$e={name:"operator-hkl",label:"Operator HKL",category:"Symmetry",factory:Qte,getParams:_$e,defaultValues:I.getDefaultValues(Yte),isApplicable:function(e){return!!e.structure}},dT=at(16777113),E$e="Assigns a color based on the partial charge of an atom.",Zte={domain:I.Interval([-1,1]),list:I.ColorList("red-white-blue",{presetKind:"scale"})};function A$e(e){return Zte}function Zz(e,t){var r;return(r=Qg.Provider.get(e.model))===null||r===void 0?void 0:r.data.value(t)}function Jte(e,t){var r=Bu.create({domain:t.domain,listOrName:t.list.colors});function n(i){if(Ze.is(i)){var a=Zz(i.unit,i.element);return a!==void 0?r.color(a):dT}else if(Vt.isLocation(i)){var a=Zz(i.aUnit,i.aUnit.elements[i.aIndex]);return a!==void 0?r.color(a):dT}return dT}return{factory:Jte,granularity:"group",preferSmoothing:!0,color:n,props:t,description:E$e,legend:r?r.legend:void 0}}var P$e={name:"partial-charge",label:"Partial Charge",category:"Atom Property",factory:Jte,getParams:A$e,defaultValues:I.getDefaultValues(Zte),isApplicable:function(e){return!!e.structure&&e.structure.models.some(function(t){return Qg.Provider.get(t)!==void 0})}},T$e="many-distinct",Jz=at(16448250),I$e="Gives every atom a color based on its `label_atom_id` value.",ere=E({},vs({type:"colors",colorList:T$e}));function M$e(e){var t=I.clone(ere);return t}function D$e(e){for(var t=new Map,r=0,n=e.models;r<n.length;r++)for(var i=n[r],a=i.atomicHierarchy.atoms.label_atom_id,o=0,s=a.rowCount;o<s;++o){var u=a.value(o);t.has(u)||t.set(u,t.size)}return t}function tre(e,t){var r,n;if(e.structure){var i=Ze.create(e.structure.root),a=D$e(e.structure.root),o=Array.from(a.keys()),s=function(l){return o[l]},u=ru(a.size,t,{valueLabel:s});n=u.legend,r=function(l){var c=void 0;if(Ze.is(l)){var d=lt.atom.label_atom_id(l);c=a.get(d)}else if(Vt.isLocation(l)){i.unit=l.aUnit,i.element=l.aUnit.elements[l.aIndex];var d=lt.atom.label_atom_id(i);c=a.get(d)}return c===void 0?Jz:u.color(c)}}else r=function(){return Jz};return{factory:tre,granularity:"group",preferSmoothing:!0,color:r,props:t,description:I$e,legend:n}}var R$e={name:"atom-id",label:"Atom Id",category:"Atom Property",factory:tre,getParams:M$e,defaultValues:I.getDefaultValues(ere),isApplicable:function(e){return!!e.structure}},k$e="many-distinct",eV=at(16448250),O$e="Gives every chain a color based on its `label_entity_id` value.",rre=E({},vs({type:"colors",colorList:k$e}));function L$e(e){var t=I.clone(rre);return t}function XD(e,t){return e+"|"+t}function F$e(e){for(var t=new Map,r=0,n=e.models.length;r<n;++r)for(var i=e.models[r].atomicHierarchy.chains.label_entity_id,a=0,o=i.rowCount;a<o;++a){var s=XD(i.value(a),r);t.has(s)||t.set(s,t.size)}return t}function nre(e,t){var r,n;if(e.structure){var i=Ze.create(e.structure.root),a=F$e(e.structure.root),o=Array.from(a.keys()),s=function(l){return o[l]},u=ru(a.size,t,{valueLabel:s});n=u.legend,r=function(l){var c=void 0;if(Ze.is(l)){var d=lt.chain.label_entity_id(l),f=l.structure.models.indexOf(l.unit.model),p=XD(d,f);c=a.get(p)}else if(Vt.isLocation(l)){i.unit=l.aUnit,i.element=l.aUnit.elements[l.aIndex];var d=lt.chain.label_entity_id(i),f=i.structure.models.indexOf(i.unit.model),p=XD(d,f);c=a.get(p)}return c===void 0?eV:u.color(c)}}else r=function(){return eV};return{factory:nre,granularity:"group",color:r,props:t,description:O$e,legend:n}}var N$e={name:"entity-id",label:"Entity Id",category:"Chain Property",factory:nre,getParams:L$e,defaultValues:I.getDefaultValues(rre),isApplicable:function(e){return!!e.structure}},id;(function(e){e.PaletteScale=(1<<24)-1,e.EmptyFactory=function(){return e.Empty};var t=at(13421772);e.Empty={factory:e.EmptyFactory,granularity:"uniform",color:function(){return t},props:{}};function r(i,a){return i.contextHash===a.contextHash&&i.factory===a.factory&&Xc(i.props,a.props)}e.areEqual=r,e.EmptyProvider={name:"",label:"",category:"",factory:e.EmptyFactory,getParams:function(){return{}},defaultValues:{},isApplicable:function(){return!0}};function n(){return new sre(e.BuiltIn,e.EmptyProvider)}e.createRegistry=n,e.BuiltIn={"atom-id":R$e,"carbohydrate-symbol":uqe,"chain-id":pte,"element-index":xqe,"element-symbol":Tqe,"entity-id":N$e,"entity-source":a$e,hydrophobicity:h$e,illustrative:l$e,"model-index":g$e,"molecule-type":Dqe,occupancy:S$e,"operator-hkl":w$e,"operator-name":QL,"partial-charge":P$e,"polymer-id":Oqe,"polymer-index":Nqe,"residue-name":jqe,"secondary-structure":Hqe,"sequence-id":Wqe,"shape-group":pVe,uncertainty:e$e,"unit-index":Kqe,uniform:GRe}})(id||(id={}));var B$e=1,U$e="Assigns a physical size, i.e. vdW radius for atoms or given radius for coarse spheres.",ire={scale:I.Numeric(1,{min:.1,max:5,step:.1})};function j$e(e){return ire}function fT(e,t){return je.isAtomic(e)?i2(e.model.atomicHierarchy.atoms.type_symbol.value(t)):je.isSpheres(e)?e.model.coarseConformation.spheres.radius[t]:0}function d2(e,t){var r=t.scale===void 0?1:t.scale;function n(i){var a;return Ze.is(i)?a=r*fT(i.unit,i.element):Vt.isLocation(i)?a=r*Math.min(fT(i.aUnit,i.aUnit.elements[i.aIndex]),fT(i.bUnit,i.bUnit.elements[i.bIndex])):a=r*B$e,a}return{factory:d2,granularity:"group",size:n,props:t,description:U$e}}var z$e={name:"physical",label:"Physical",category:"",factory:d2,getParams:j$e,defaultValues:I.getDefaultValues(ire),isApplicable:function(e){return!!e.structure}},V$e="Assigns a size reflecting the uncertainty or disorder of an element's position, e.g. B-factor or RMSF, depending on the data availability and experimental technique.",are={bfactorFactor:I.Numeric(.1,{min:0,max:1,step:.01}),rmsfFactor:I.Numeric(.05,{min:0,max:1,step:.01}),baseSize:I.Numeric(.2,{min:0,max:2,step:.1})};function H$e(e){return are}function tV(e,t,r){return je.isAtomic(e)?e.model.atomicConformation.B_iso_or_equiv.value(t)*r.bfactorFactor:je.isSpheres(e)?e.model.coarseConformation.spheres.rmsf[t]*r.rmsfFactor:0}function ore(e,t){function r(n){var i=t.baseSize;return Ze.is(n)?i+=tV(n.unit,n.element,t):Vt.isLocation(n)&&(i+=tV(n.aUnit,n.aUnit.elements[n.aIndex],t)),i}return{factory:ore,granularity:"group",size:r,props:t,description:V$e}}var G$e={name:"uncertainty",label:"Uncertainty/Disorder",category:"",factory:ore,getParams:H$e,defaultValues:I.getDefaultValues(are),isApplicable:function(e){return!!e.structure&&e.structure.models.some(function(t){return t.atomicConformation.B_iso_or_equiv.isDefined||t.coarseHierarchy.isDefined})}},Ki;(function(e){e.EmptyFactory=function(){return e.Empty},e.Empty={factory:e.EmptyFactory,granularity:"uniform",size:function(){return 1},props:{}};function t(n,i){return n.factory===i.factory&&Xc(n.props,i.props)}e.areEqual=t,e.EmptyProvider={name:"",label:"",category:"",factory:e.EmptyFactory,getParams:function(){return{}},defaultValues:{},isApplicable:function(){return!0}};function r(){return new sre(e.BuiltIn,e.EmptyProvider)}e.createRegistry=r,e.BuiltIn={physical:z$e,"shape-group":lVe,uncertainty:G$e,uniform:WRe}})(Ki||(Ki={}));var yi;(function(e){function t(a,o,s,u){u=u||r();var l=s.colorTheme,c=s.sizeTheme;return u.color=a.colorThemeRegistry.create(l.name,o,l.params),u.size=a.sizeThemeRegistry.create(c.name,o,c.params),u}e.create=t;function r(){return{color:id.Empty,size:Ki.Empty}}e.createEmpty=r;function n(a,o,s,u){var l,c;return ce(this,void 0,void 0,function(){return de(this,function(d){switch(d.label){case 0:return[4,(l=o.colorThemeRegistry.get(u.colorTheme.name).ensureCustomProperties)===null||l===void 0?void 0:l.attach(a,s)];case 1:return d.sent(),[4,(c=o.sizeThemeRegistry.get(u.sizeTheme.name).ensureCustomProperties)===null||c===void 0?void 0:c.attach(a,s)];case 2:return d.sent(),[2]}})})}e.ensureDependencies=n;function i(a,o,s){var u,l;(u=a.colorThemeRegistry.get(s.colorTheme.name).ensureCustomProperties)===null||u===void 0||u.detach(o),(l=a.sizeThemeRegistry.get(s.sizeTheme.name).ensureCustomProperties)===null||l===void 0||l.detach(o)}e.releaseDependencies=i})(yi||(yi={}));function rV(e){return e.map(function(t){return[t.name,t.provider.label,t.provider.category]})}var sre=function(){function e(t,r){var n=this;this.emptyProvider=r,this._list=[],this._map=new Map,this._name=new Map,ju(t,function(i,a){if(i.name!==a)throw new Error("Fix build in themes to have matching names. "+i.name+" "+a);n.add(i)})}return Object.defineProperty(e.prototype,"default",{get:function(){return this._list[0]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"list",{get:function(){return this._list},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"types",{get:function(){return rV(this._list)},enumerable:!1,configurable:!0}),e.prototype.sort=function(){this._list.sort(function(t,r){return t.provider.category===r.provider.category?t.provider.label<r.provider.label?-1:t.provider.label>r.provider.label?1:0:t.provider.category<r.provider.category?-1:1})},e.prototype.add=function(t){if(this._map.has(t.name))throw new Error(t.name+" already registered.");var r=t.name;this._list.push({name:r,provider:t}),this._map.set(r,t),this._name.set(t,r),this.sort()},e.prototype.remove=function(t){this._list.splice(this._list.findIndex(function(n){return n.name===t.name}),1);var r=this._map.get(t.name);r&&(this._map.delete(t.name),this._name.delete(r))},e.prototype.has=function(t){return this._map.has(t.name)},e.prototype.get=function(t){return this._map.get(t)||this.emptyProvider},e.prototype.getName=function(t){if(!this._name.has(t))throw new Error("'"+t.label+"' is not a registered theme provider.");return this._name.get(t)},e.prototype.create=function(t,r,n){n===void 0&&(n={});var i=this.get(t);return i.factory(r,E(E({},I.getDefaultValues(i.getParams(r))),n))},e.prototype.getApplicableList=function(t){return this._list.filter(function(r){return r.provider.isApplicable(t)})},e.prototype.getApplicableTypes=function(t){return rV(this.getApplicableList(t))},e}();function BE(e){return Object.keys(e)}function YD(e){throw new Error("unreachable")}function ZL(e){return typeof(e==null?void 0:e.then)=="function"}var tr;(function(e){e[e.None=0]="None",e[e.Highlight=1]="Highlight",e[e.RemoveHighlight=2]="RemoveHighlight",e[e.Select=4]="Select",e[e.Deselect=8]="Deselect",e[e.Toggle=16]="Toggle",e[e.Clear=32]="Clear"})(tr||(tr={}));var Do;(function(e){e.is=ba.has,e.All=tr.Highlight|tr.RemoveHighlight|tr.Select|tr.Deselect|tr.Toggle|tr.Clear,e.Highlighting=tr.Highlight|tr.RemoveHighlight|tr.Clear,e.Selecting=tr.Select|tr.Deselect|tr.Toggle|tr.Clear})(Do||(Do={}));function sw(e,t,r){switch(r){case tr.Highlight:e[t]|=1;break;case tr.RemoveHighlight:e[t]&=-2;break;case tr.Select:e[t]|=2;break;case tr.Deselect:e[t]&=-3;break;case tr.Toggle:e[t]^=2;break;case tr.Clear:e[t]=0;break}}function Gu(e,t,r){if(r===tr.None)return!1;if(Ie.is(t)){var n=Ie.start(t),i=Ie.end(t),a=new Uint32Array(e.buffer,0,e.buffer.byteLength>>2),o=n+3>>2,s=o+(i-4*o>>2),u=n,l=Math.min(4*o,i),c=Math.max(n,4*s),d=i;switch(r){case tr.Highlight:for(var f=o;f<s;++f)a[f]|=16843009;break;case tr.RemoveHighlight:for(var f=o;f<s;++f)a[f]&=-16843010;break;case tr.Select:for(var f=o;f<s;++f)a[f]|=33686018;break;case tr.Deselect:for(var f=o;f<s;++f)a[f]&=-33686019;break;case tr.Toggle:for(var f=o;f<s;++f)a[f]^=33686018;break;case tr.Clear:for(var f=o;f<s;++f)a[f]=0;break;default:YD()}for(var f=u;f<l;++f)sw(e,f,r);for(var f=c;f<d;++f)sw(e,f,r)}else switch(r){case tr.Highlight:for(var f=0,p=t.length;f<p;++f)e[t[f]]|=1;break;case tr.RemoveHighlight:for(var f=0,p=t.length;f<p;++f)e[t[f]]&=-2;break;case tr.Select:for(var f=0,p=t.length;f<p;++f)e[t[f]]|=2;break;case tr.Deselect:for(var f=0,p=t.length;f<p;++f)e[t[f]]&=-3;break;case tr.Toggle:for(var f=0,p=t.length;f<p;++f)e[t[f]]^=2;break;case tr.Clear:for(var f=0,p=t.length;f<p;++f)e[t[f]]=0;break;default:YD()}return!0}var q$e={kind:"every-loci"};function Hs(e){return!!e&&e.kind==="every-loci"}var Nr={kind:"empty-loci"};function Du(e){return!!e&&e.kind==="empty-loci"}function w1(e){return!!e&&e.kind==="data-loci"}function $$e(e,t){if(!__(e.data,t.data)||e.tag!==t.tag||e.elements.length!==t.elements.length)return!1;for(var r=0,n=e.elements.length;r<n;++r)if(!__(e.elements[r],t.elements[r]))return!1;return!0}function W$e(e){return e.elements.length===0}function UE(e,t,r,n,i){return{kind:"data-loci",tag:e,data:t,elements:r,getBoundingSphere:n,getLabel:i}}var ar;(function(e){var t=new ps("98");function r(h){var m=h.loci.map(function(C){return s(C)}).filter(function(C){return!!C});t.reset();for(var g=0,y=m;g<y.length;g++){var b=y[g];t.includePositionRadius(b.center,b.radius)}t.finishedIncludeStep();for(var S=0,x=m;S<x.length;S++){var b=x[S];t.radiusPositionRadius(b.center,b.radius)}return t.getSphere()}e.getBundleBoundingSphere=r;function n(h,m){return Hs(h)&&Hs(m)||Du(h)&&Du(m)?!0:w1(h)&&w1(m)?$$e(h,m):We.isLoci(h)&&We.isLoci(m)?We.areLociEqual(h,m):Re.is(h)&&Re.is(m)?Re.areEqual(h,m):Vt.isLoci(h)&&Vt.isLoci(m)?Vt.areLociEqual(h,m):Fr.isLoci(h)&&Fr.isLoci(m)?Fr.areLociEqual(h,m):Ja.isLoci(h)&&Ja.isLoci(m)?Ja.areLociEqual(h,m):Ct.isLoci(h)&&Ct.isLoci(m)?Ct.areLociEqual(h,m):Ct.Isosurface.isLoci(h)&&Ct.Isosurface.isLoci(m)?Ct.Isosurface.areLociEqual(h,m):Ct.Cell.isLoci(h)&&Ct.Cell.isLoci(m)?Ct.Cell.areLociEqual(h,m):!1}e.areEqual=n;function i(h){return!!h&&h.kind==="every-loci"}e.isEvery=i;function a(h){return Hs(h)?!1:Du(h)?!0:w1(h)?W$e(h):We.isLoci(h)?We.isLociEmpty(h):Re.is(h)?Re.isEmpty(h):Vt.isLoci(h)?Vt.isLociEmpty(h):Fr.isLoci(h)?Fr.isLociEmpty(h):Ja.isLoci(h)?Ja.isLociEmpty(h):Ct.isLoci(h)?Ct.isLociEmpty(h):Ct.Isosurface.isLoci(h)?Ct.Isosurface.isLociEmpty(h):Ct.Cell.isLoci(h)?Ct.Cell.isLociEmpty(h):!1}e.isEmpty=a;function o(h,m){return m instanceof We&&(Re.is(h)?h=Re.remap(h,m):We.isLoci(h)?h=We.remapLoci(h,m):Vt.isLoci(h)&&(h=Vt.remapLoci(h,m))),h}e.remap=o;function s(h,m){var g;if(!(h.kind==="every-loci"||h.kind==="empty-loci")){if(m||(m=Be()),h.kind==="structure-loci")return Be.copy(m,h.structure.boundary.sphere);if(h.kind==="element-loci")return Be.copy(m,Re.getBoundary(h).sphere);if(h.kind==="bond-loci")return Vt.getBoundingSphere(h,m);if(h.kind==="shape-loci")return Be.copy(m,h.shape.geometry.boundingSphere);if(h.kind==="group-loci")return Ja.getBoundingSphere(h,m);if(h.kind==="data-loci")return(g=h.getBoundingSphere)===null||g===void 0?void 0:g.call(h,m);if(h.kind==="volume-loci")return Ct.getBoundingSphere(h.volume,m);if(h.kind==="isosurface-loci")return Ct.Isosurface.getBoundingSphere(h.volume,h.isoValue,m);if(h.kind==="cell-loci")return Ct.Cell.getBoundingSphere(h.volume,h.indices,m)}}e.getBoundingSphere=s;var u=Be.zero();function l(h,m){var g=s(h,u);return g?_.copy(m||_(),g.center):void 0}e.getCenter=l;function c(h){if(!(h.kind==="every-loci"||h.kind==="empty-loci")){if(h.kind==="structure-loci")return Re.getPrincipalAxes(We.toStructureElementLoci(h.structure));if(h.kind==="element-loci")return Re.getPrincipalAxes(h);if(h.kind==="bond-loci")return;if(h.kind==="shape-loci")return;if(h.kind==="group-loci")return;if(h.kind==="data-loci")return;if(h.kind==="volume-loci")return;if(h.kind==="isosurface-loci")return;if(h.kind==="cell-loci")return}}e.getPrincipalAxes=c;var d={element:function(h){return h},residue:function(h){return Re.is(h)?Re.extendToWholeResidues(h,!0):h},chain:function(h){return Re.is(h)?Re.extendToWholeChains(h):h},entity:function(h){return Re.is(h)?Re.extendToWholeEntities(h):h},model:function(h){return Re.is(h)?Re.extendToWholeModels(h):h},operator:function(h){return Re.is(h)?Re.extendToWholeOperators(h):h},structure:function(h){return Re.is(h)?We.toStructureElementLoci(h.structure):Ja.isLoci(h)?Fr.Loci(h.shape):h},elementInstances:function(h){return Re.is(h)?Re.extendToAllInstances(h):h},residueInstances:function(h){return Re.is(h)?Re.extendToAllInstances(Re.extendToWholeResidues(h,!0)):h},chainInstances:function(h){return Re.is(h)?Re.extendToAllInstances(Re.extendToWholeChains(h)):h}};e.GranularityOptions=I.objectToOptions(d,function(h){switch(h){case"element":return"Atom/Coarse Element";case"elementInstances":return["Atom/Coarse Element Instances","With Symmetry"];case"structure":return"Structure/Shape";default:return h.indexOf("Instances")?[Zo(h),"With Symmetry"]:Zo(h)}});function f(h){return h.replace("Instances","")}e.simpleGranularity=f;function p(h,m){return d[m](h)}e.applyGranularity=p;function v(h,m){return m!=="element"&&Vt.isLoci(h)&&(h=Vt.toStructureElementLoci(h)),We.isLoci(h)&&(h=We.toStructureElementLoci(h.structure)),Re.is(h)&&(h=Re.remap(h,h.structure.root)),m&&(h=p(h,m)),h}e.normalize=v})(ar||(ar={}));function qi(e){return{layers:e}}(function(e){e.Empty={layers:[]};function t(l,c){if(l.layers.length===0&&c.layers.length===0)return!0;if(l.layers.length!==c.layers.length)return!1;for(var d=0,f=l.layers.length;d<f;++d)if(l.layers[d].clear!==c.layers[d].clear||l.layers[d].color!==c.layers[d].color||!ar.areEqual(l.layers[d].loci,c.layers[d].loci))return!1;return!0}e.areEqual=t;function r(l){return l.layers.length===0}e.isEmpty=r;function n(l,c){for(var d=[],f=0,p=l.layers;f<p.length;f++){var v=p[f],h=v.loci,m=v.color,g=v.clear;h=Re.remap(h,c),Re.isEmpty(h)||d.push({loci:h,color:m,clear:g})}return{layers:d}}e.remap=n;function i(l){if(r(l))return l;for(var c=l.layers[0].loci.structure,d=new Map,f=Re.none(c),p=0,v=l.layers.length;p<v;++p){var h=l.layers[v-p-1],m=h.loci,g=h.color,y=h.clear;if(m=Re.subtract(m,f),f=Re.union(m,f),!Re.isEmpty(m)){var b=y?-1:g;d.has(b)&&(m=Re.union(m,d.get(b))),d.set(b,m)}}var S=[];return d.forEach(function(x,C){var w=C===-1,A=C===-1?at(0):C;S.push({loci:x,color:A,clear:w})}),{layers:S}}e.merge=i;function a(l,c){if(r(l))return l;for(var d=l.layers[0].loci.structure,f=[],p=0,v=l.layers;p<v.length;p++){var h=v[p],m=h.loci,g=h.color,y=h.clear,b=Re.remap(m,c);m=Re.remap(b,d),Re.isEmpty(m)||f.push({loci:m,color:g,clear:y})}return{layers:f}}e.filter=a;function o(l,c){for(var d=[],f=0,p=l.length;f<p;++f){var v=l[f],h=v.script,m=v.color,g=v.clear,y=Vi.toLoci(h,c);Re.isEmpty(y)||d.push({loci:y,color:m,clear:g})}return{layers:d}}e.ofScript=o;function s(l,c){for(var d=[],f=0,p=l.length;f<p;++f){var v=l[f],h=v.bundle,m=v.color,g=v.clear,y=rn.toLoci(h,c.root);d.push({loci:y,color:m,clear:g})}return{layers:d}}e.ofBundle=s;function u(l){for(var c=[],d=0,f=l.layers.length;d<f;++d){var p=l.layers[d],v=p.loci,h=p.color,m=p.clear,g=rn.fromLoci(v);c.push({bundle:g,color:h,clear:m})}return{layers:c}}e.toBundle=u})(qi||(qi={}));function $i(e,t){return{kind:e,layers:t}}(function(e){e.Empty={kind:"empty-loci",layers:[]};function t(l,c){if(l.layers.length===0&&c.layers.length===0)return!0;if(l.layers.length!==c.layers.length)return!1;for(var d=0,f=l.layers.length;d<f;++d)if(l.layers[d].value!==c.layers[d].value||!ar.areEqual(l.layers[d].loci,c.layers[d].loci))return!1;return!0}e.areEqual=t;function r(l){return l.layers.length===0}e.isEmpty=r;function n(l,c){if(l.kind==="element-loci"){for(var d=[],f=0,p=l.layers;f<p.length;f++){var v=p[f],h=Re.remap(v.loci,c);Re.isEmpty(h)||d.push({loci:h,value:v.value})}return{kind:"element-loci",layers:d}}else return l}e.remap=n;function i(l){if(r(l))return l;if(l.kind==="element-loci"){for(var c=l.layers[0].loci.structure,d=new Map,f=Re.none(c),p=0,v=l.layers.length;p<v;++p){var h=l.layers[v-p-1],m=h.loci,g=h.value;m=Re.subtract(m,f),f=Re.union(m,f),Re.isEmpty(m)||(d.has(g)&&(m=Re.union(m,d.get(g))),d.set(g,m))}var y=[];return d.forEach(function(b,S){y.push({loci:b,value:S})}),{kind:"element-loci",layers:y}}else return l}e.merge=i;function a(l,c){if(r(l))return l;if(l.kind==="element-loci"){for(var d=l.layers[0].loci.structure,f=[],p=0,v=l.layers;p<v.length;p++){var h=v[p],m=h.loci,g=h.value,y=Re.remap(m,c);m=Re.remap(y,d),Re.isEmpty(m)||f.push({loci:m,value:g})}return{kind:"element-loci",layers:f}}else return l}e.filter=a;function o(l,c){for(var d=[],f=0,p=l.length;f<p;++f){var v=l[f],h=v.script,m=v.value,g=Vi.toLoci(h,c);Re.isEmpty(g)||d.push({loci:g,value:m})}return{kind:"element-loci",layers:d}}e.ofScript=o;function s(l,c){for(var d=[],f=0,p=l.length;f<p;++f){var v=l[f],h=v.bundle,m=v.value,g=rn.toLoci(h,c.root);d.push({loci:g,value:m})}return{kind:"element-loci",layers:d}}e.ofBundle=s;function u(l){for(var c=[],d=0,f=l.layers.length;d<f;++d){var p=l.layers[d],v=p.loci,h=p.value,m=rn.fromLoci(v);c.push({bundle:m,value:h})}return{kind:"element-loci",layers:c}}e.toBundle=u})($i||($i={}));var Vl;(function(e){function t(){return{updateTransform:!1,updateMatrix:!1,updateColor:!1,updateSize:!1,createGeometry:!1,createNew:!1,info:{}}}e.create=t;function r(n){n.updateTransform=!1,n.updateMatrix=!1,n.updateColor=!1,n.updateSize=!1,n.createGeometry=!1,n.createNew=!1}e.reset=r})(Vl||(Vl={}));var X$e={lowestElementCount:1e6,lowerElementCount:5e5,lowElementCount:1e5,mediumElementCount:2e4,highElementCount:2e3,coarseGrainedFactor:10,elementCountFactor:1};function ure(e,t){t===void 0&&(t={});var r=E(E({},X$e),t),n=e.elementCount*r.elementCountFactor;return e.isCoarseGrained&&(n*=r.coarseGrainedFactor),n>r.lowestElementCount?"lowest":n>r.lowerElementCount?"lower":n>r.lowElementCount?"low":n>r.mediumElementCount?"medium":n>r.highElementCount?"high":"higher"}function Y$e(e){if(e.root.models.length===1){var t=fi.Provider.get(e.root.model);if(t&&t.spacegroup.name==="P 1"&&!Mo.isZero(t.spacegroup.cell))return t.spacegroup.cell.volume}return Xt.volume(e.root.boundary.box)}function KD(e,t){var r=Di(e.quality,"auto"),n=Di(e.detail,1),i=Di(e.radialSegments,12),a=Di(e.linearSegments,8),o=Di(e.resolution,2),s=Di(e.probePositions,12),u=Di(e.doubleSided,!0),l=0;if(r==="auto"){if(t instanceof We)r=ure(t.root),l=Y$e(t);else if(Ct.is(t)){var c=t.grid.cells.space.dimensions,d=c[0],f=c[1],p=c[2];l=d*f*p,r=l<1e7?"medium":"low"}}switch(r){case"highest":n=3,i=36,a=18,o=.1,s=72,u=!0;break;case"higher":n=3,i=28,a=14,o=.3,s=48,u=!0;break;case"high":n=2,i=20,a=10,o=.5,s=36,u=!0;break;case"medium":n=1,i=12,a=8,o=.8,s=24,u=!0;break;case"low":n=0,i=8,a=3,o=1.3,s=24,u=!1;break;case"lower":n=0,i=4,a=2,o=3,s=12,u=!1;break;case"lowest":n=0,i=2,a=1,o=8,s=12,u=!1;break}return o=Math.max(o,l/5e8),o=Math.min(o,20),(e.alpha!==void 0&&e.alpha<1||e.xrayShaded)&&(u=!1),{detail:n,radialSegments:i,linearSegments:a,resolution:o,probePositions:s,doubleSided:u}}var wr;(function(e){function t(c,d){c&&(c.state.visible=d)}e.setVisibility=t;function r(c,d){c&&(c.state.alphaFactor=d)}e.setAlphaFactor=r;function n(c,d){c&&(c.state.pickable=d)}e.setPickable=n;function i(c,d){c&&(c.state.colorOnly=d)}e.setColorOnly=i;function a(c,d,f,p){if(!c)return!1;var v=c.values,h=v.tMarker,m=v.uGroupCount,g=v.instanceCount,y=m.ref.value*g.ref.value,b=h.ref.value.array,S=!1;return Hs(d)?S=Gu(b,Ie.ofLength(y),f):Du(d)||(S=p(d,function(x){return Gu(b,x,f)},!0)),S&&F.update(h,h.ref.value),S}e.mark=a;function o(c,d,f,p){if(c){var v=c.values,h=v.tOverpaint,m=v.uGroupCount,g=v.instanceCount,y=m.ref.value*g.ref.value;b9e(d.layers.length?y:0,c.values);var b=h.ref.value.array;p&&Mj(b,0,y);for(var S=function(w,A){var M=d.layers[w],D=M.loci,k=M.color,R=M.clear,O=function(H){var B=Ie.start(H),j=Ie.end(H);return R?Mj(b,B,j):y9e(b,B,j,k)};f(D,O,!1)},x=0,C=d.layers.length;x<C;++x)S(x);F.update(h,h.ref.value)}}e.setOverpaint=o;function s(c,d,f,p){if(c){var v=c.values,h=v.tTransparency,m=v.transparencyAverage,g=v.uGroupCount,y=v.instanceCount,b=g.ref.value*y.ref.value;C9e(d.layers.length?b:0,c.values);var S=h.ref.value.array;p&&S9e(S,0,b);for(var x=function(A,M){var D=d.layers[A],k=D.loci,R=D.value,O=function(H){var B=Ie.start(H),j=Ie.end(H);return x9e(S,B,j,R)};f(k,O,!1)},C=0,w=d.layers.length;C<w;++C)x(C);F.update(h,h.ref.value),F.updateIfChanged(m,bee(S,b))}}e.setTransparency=s;function u(c,d,f,p){if(c){var v=c.values,h=v.tClipping,m=v.uGroupCount,g=v.instanceCount,y=m.ref.value*g.ref.value;E9e(d.layers.length?y:0,c.values);var b=h.ref.value.array;p&&w9e(b,0,y);for(var S=function(w,A){var M=d.layers[w],D=M.loci,k=M.groups,R=function(O){var H=Ie.start(O),B=Ie.end(O);return _9e(b,H,B,k)};f(D,R,!1)},x=0,C=d.layers.length;x<C;++x)S(x);F.update(h,h.ref.value)}}e.setClipping=u;function l(c,d,f){if(!(!c||!d&&!f)){var p=c.values;d&&(ue.copy(p.matrix.ref.value,d),F.update(p.matrix,p.matrix.ref.value)),f?(p.extraTransform.ref.value.set(f),F.update(p.extraTransform,p.extraTransform.ref.value)):f===null&&(j_(p.extraTransform.ref.value,p.instanceCount.ref.value),F.update(p.extraTransform,p.extraTransform.ref.value)),GZ(p);var v=Yi(p.invariantBoundingSphere.ref.value,p.aTransform.ref.value,p.instanceCount.ref.value);F.update(p.boundingSphere,v)}}e.setTransform=l})(wr||(wr={}));function on(e){return{layers:e}}(function(e){e.Empty={layers:[]},function(l){l.is=ba.has;function c(h){return ba.create(h)}l.create=c,l.Names={one:1,two:2,three:4,four:8,five:16,six:32};function d(h){return h in l.Names}l.isName=d;function f(h){switch(h){case"one":return 1;case"two":return 2;case"three":return 4;case"four":return 8;case"five":return 16;case"six":return 32}}l.fromName=f;function p(h){for(var m=0,g=0,y=h.length;g<y;++g)m|=f(h[g]);return m}l.fromNames=p;function v(h){var m=[];return l.is(h,1)&&m.push("one"),l.is(h,2)&&m.push("two"),l.is(h,4)&&m.push("three"),l.is(h,8)&&m.push("four"),l.is(h,16)&&m.push("five"),l.is(h,32)&&m.push("six"),m}l.toNames=v}(e.Groups||(e.Groups={})),e.Type={none:0,plane:1,sphere:2,cube:3,cylinder:4,infiniteCone:5};function t(l,c){if(l.layers.length===0&&c.layers.length===0)return!0;if(l.layers.length!==c.layers.length)return!1;for(var d=0,f=l.layers.length;d<f;++d)if(l.layers[d].groups!==c.layers[d].groups||!ar.areEqual(l.layers[d].loci,c.layers[d].loci))return!1;return!0}e.areEqual=t;function r(l){return l.layers.length===0}e.isEmpty=r;function n(l,c){for(var d=[],f=0,p=l.layers;f<p.length;f++){var v=p[f],h=v.loci,m=v.groups;h=Re.remap(h,c),Re.isEmpty(h)||d.push({loci:h,groups:m})}return{layers:d}}e.remap=n;function i(l){if(r(l))return l;for(var c=l.layers[0].loci.structure,d=new Map,f=Re.none(c),p=0,v=l.layers.length;p<v;++p){var h=l.layers[v-p-1],m=h.loci,g=h.groups;m=Re.subtract(m,f),f=Re.union(m,f),Re.isEmpty(m)||(d.has(g)&&(m=Re.union(m,d.get(g))),d.set(g,m))}var y=[];return d.forEach(function(b,S){y.push({loci:b,groups:S})}),{layers:y}}e.merge=i;function a(l,c){if(r(l))return l;for(var d=l.layers[0].loci.structure,f=[],p=0,v=l.layers;p<v.length;p++){var h=v[p],m=h.loci,g=h.groups,y=Re.remap(m,c);m=Re.remap(y,d),Re.isEmpty(m)||f.push({loci:m,groups:g})}return{layers:f}}e.filter=a;function o(l,c){for(var d=[],f=0,p=l.length;f<p;++f){var v=l[f],h=v.script,m=v.groups,g=Vi.toLoci(h,c);Re.isEmpty(g)||d.push({loci:g,groups:m})}return{layers:d}}e.ofScript=o;function s(l,c){for(var d=[],f=0,p=l.length;f<p;++f){var v=l[f],h=v.bundle,m=v.groups,g=rn.toLoci(h,c.root);d.push({loci:g,groups:m})}return{layers:d}}e.ofBundle=s;function u(l){for(var c=[],d=0,f=l.layers.length;d<f;++d){var p=l.layers[d],v=p.loci,h=p.groups,m=rn.fromLoci(v);c.push({bundle:m,groups:h})}return{layers:c}}e.toBundle=u})(on||(on={}));var nV;(function(e){function t(r,n,i){return I.getDefaultValues(r.getParams(n,i))}e.getDetaultParams=t})(nV||(nV={}));var K$e={label:"",description:"",factory:function(){return or.Empty},getParams:function(){return{}},defaultValues:{}};function iV(e){return e.map(function(t){return[t.name,t.provider.label]})}var lre=function(){function e(){this._list=[],this._map=new Map,this._name=new Map}return Object.defineProperty(e.prototype,"default",{get:function(){return this._list[0]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"types",{get:function(){return iV(this._list)},enumerable:!1,configurable:!0}),e.prototype.add=function(t){if(this._map.has(t.name))throw new Error(t.name+" already registered.");this._list.push({name:t.name,provider:t}),this._map.set(t.name,t),this._name.set(t,t.name)},e.prototype.getName=function(t){if(!this._name.has(t))throw new Error("'"+t.label+"' is not a registered represenatation provider.");return this._name.get(t)},e.prototype.remove=function(t){var r=t.name;this._list.splice(this._list.findIndex(function(i){return i.name===r}),1);var n=this._map.get(r);n&&(this._map.delete(r),this._name.delete(n))},e.prototype.get=function(t){return this._map.get(t)||K$e},Object.defineProperty(e.prototype,"list",{get:function(){return this._list},enumerable:!1,configurable:!0}),e.prototype.getApplicableList=function(t){return this._list.filter(function(r){return r.provider.isApplicable(t)})},e.prototype.getApplicableTypes=function(t){return iV(this.getApplicableList(t))},e}(),or;(function(e){(function(a){function o(u,l){return u.repr===l.repr&&ar.areEqual(u.loci,l.loci)}a.areEqual=o;function s(u){return ar.isEmpty(u.loci)}a.isEmpty=s,a.Empty={loci:Nr}})(e.Loci||(e.Loci={}));function t(){return{visible:!0,alphaFactor:1,pickable:!0,colorOnly:!1,syncManually:!1,transform:ue.identity(),overpaint:qi.Empty,transparency:$i.Empty,clipping:on.Empty,markerActions:Do.All}}e.createState=t;function r(a,o){o.visible!==void 0&&(a.visible=o.visible),o.alphaFactor!==void 0&&(a.alphaFactor=o.alphaFactor),o.pickable!==void 0&&(a.pickable=o.pickable),o.colorOnly!==void 0&&(a.colorOnly=o.colorOnly),o.overpaint!==void 0&&(a.overpaint=o.overpaint),o.transparency!==void 0&&(a.transparency=o.transparency),o.clipping!==void 0&&(a.clipping=o.clipping),o.syncManually!==void 0&&(a.syncManually=o.syncManually),o.transform!==void 0&&ue.copy(a.transform,o.transform),o.markerActions!==void 0&&(a.markerActions=o.markerActions)}e.updateState=r,e.StateBuilder={create:t,update:r},e.Empty={label:"",groupCount:0,renderObjects:[],props:{},params:{},updated:new ri,state:t(),theme:yi.createEmpty(),createOrUpdate:function(){return $e.constant("",void 0)},setState:function(){},setTheme:function(){},getLoci:function(){return Nr},mark:function(){return!1},destroy:function(){}};function n(a,o,s,u,l){var c=this,d=0,f=new ri,p=u.create(),v=yi.createEmpty(),h,m,g,y={},b=Object.keys(l).map(function(S,x){y[x]=S;var C=l[S](o,s);return C.setState(p),C});return{label:a,updated:f,get groupCount(){var S=0;if(m)for(var x=m.visuals,C=0,w=b.length;C<w;++C)(!x||x.includes(y[C]))&&(S+=b[C].groupCount);return S},get renderObjects(){var S=[];if(m)for(var x=m.visuals,C=0,w=b.length;C<w;++C)(!x||x.includes(y[C]))&&S.push.apply(S,b[C].renderObjects);return S},get props(){return m},get params(){return h},createOrUpdate:function(S,x){S===void 0&&(S={}),x&&x!==g&&(h=s(o,x),g=x,m||(m=I.getDefaultValues(h)));var C=KD(Object.assign({},m,S),g);Object.assign(m,S,C);var w=m.visuals;return $e.create("Creating or updating '"+a+"' representation",function(A){return ce(c,void 0,void 0,function(){var M,D;return de(this,function(k){switch(k.label){case 0:M=0,D=b.length,k.label=1;case 1:return M<D?!w||w.includes(y[M])?[4,b[M].createOrUpdate(m,g).runInContext(A)]:[3,3]:[3,4];case 2:k.sent(),k.label=3;case 3:return++M,[3,1];case 4:return f.next(d++),[2]}})})})},get state(){return p},get theme(){return v},getLoci:function(S){for(var x=m.visuals,C=0,w=b.length;C<w;++C)if(!x||x.includes(y[C])){var A=b[C].getLoci(S);if(!Du(A))return A}return Nr},mark:function(S,x){for(var C=!1,w=0,A=b.length;w<A;++w)C=b[w].mark(S,x)||C;return C},setState:function(S){u.update(p,S);for(var x=0,C=b.length;x<C;++x)b[x].setState(p)},setTheme:function(S){for(var x=0,C=b.length;x<C;++x)b[x].setTheme(S)},destroy:function(){for(var S=0,x=b.length;S<x;++S)b[S].destroy()}}}e.createMulti=n;function i(a,o){var s=this,u=0,l=new ri,c=e.createState(),d=yi.createEmpty(),f=I.clone(Et.Params),p=I.getDefaultValues(Et.Params);return{label:a,updated:l,get groupCount(){return o.values.uGroupCount.ref.value},get renderObjects(){return[o]},get props(){return p},get params(){return f},createOrUpdate:function(v){v===void 0&&(v={});var h=KD(Object.assign({},p,v));return Object.assign(p,v,h),$e.create("Updating '"+a+"' representation",function(m){return ce(s,void 0,void 0,function(){return de(this,function(g){return l.next(u++),[2]})})})},get state(){return c},get theme(){return d},getLoci:function(){return Nr},mark:function(v,h){return!1},setState:function(v){v.visible!==void 0&&wr.setVisibility(o,v.visible),v.alphaFactor!==void 0&&wr.setAlphaFactor(o,v.alphaFactor),v.pickable!==void 0&&wr.setPickable(o,v.pickable),v.colorOnly!==void 0&&wr.setColorOnly(o,v.colorOnly),v.overpaint,v.transparency,v.transform!==void 0&&wr.setTransform(o,v.transform),e.updateState(c,v)},setTheme:function(){},destroy:function(){}}}e.fromRenderObject=i})(or||(or={}));function ki(e,t,r){r===void 0&&(r={});var n=0,i=new ri,a=or.createState(),o=Dd(),s=[],u,l,c=yi.createEmpty(),d=I.getDefaultValues(t.Params),f,p,v;r.modifyState&&or.updateState(a,r.modifyState(a));var h=Vl.create();function m(b,S){Vl.reset(h),!(!S&&!l)&&(S&&!l?h.createNew=!0:S&&l&&S.id===l.id||(S&&l&&S.id!==l.id?(h.updateTransform=!0,h.createGeometry=!0):S&&console.warn("unexpected state")),h.updateTransform&&(h.updateColor=!0,h.updateSize=!0),h.createGeometry&&(h.updateColor=!0,h.updateSize=!0))}function g(b,S){var x=this;return b===void 0&&(b={}),r.modifyProps&&(b=r.modifyProps(b)),$e.create("ShapeRepresentation.create",function(C){return ce(x,void 0,void 0,function(){var w,A,M,D,k,R,O,H;return de(this,function(B){switch(B.label){case 0:return w=Object.assign(d,b),S?[4,e(C,S,w,l)]:[3,2];case 1:return M=B.sent(),[3,3];case 2:M=void 0,B.label=3;case 3:if(A=M,m(b,A),A&&(l=A,Object.assign(c,Fr.getTheme(l))),h.createNew)s.length=0,p=Fr.groupIterator(l),D=Fr.createTransform(l.transforms),k=t.createValues(l.geometry,D,p,c,w),R=t.createRenderableState(w),r.modifyState&&Object.assign(R,r.modifyState(R)),or.updateState(a,R),u=P0(l.geometry.kind,k,R,o),u&&s.push(u),v=t.createPositionIterator(l.geometry,u.values);else{if(!u)throw new Error("expected renderObject to be available");h.updateTransform&&(Fr.createTransform(l.transforms,u.values),p=Fr.groupIterator(l),O=p.instanceCount,H=p.groupCount,tu(O*H,u.values)),h.createGeometry&&(F.updateIfChanged(u.values.drawCount,la.getDrawCount(l.geometry)),F.updateIfChanged(u.values.uVertexCount,la.getVertexCount(l.geometry))),(h.updateTransform||h.createGeometry)&&(t.updateBoundingSphere(u.values,l.geometry),v=t.createPositionIterator(l.geometry,u.values)),h.updateColor&&hs(p,v,c.color,u.values),h.updateSize&&"uSize"in u.values&&Sd(p,c.size,u.values),t.updateValues(u.values,w),t.updateRenderableState(u.state,w)}return d=w,i.next(n++),[2]}})})})}function y(b,S){return Hs(b)||Fr.isLoci(b)&&b.shape===l?S(Ie.ofBounds(0,l.groupCount*l.transforms.length)):Q$e(b,l,S)}return{label:"Shape geometry",get groupCount(){return p?p.count:0},get props(){return d},get params(){return f},get state(){return a},get theme(){return c},renderObjects:s,updated:i,createOrUpdate:g,getLoci:function(b){if(b===void 0)return Fr.Loci(l);var S=b.objectId,x=b.groupId,C=b.instanceId;return u&&u.id===S?Ja.Loci(l,[{ids:Le.ofSingleton(x),instance:C}]):Nr},mark:function(b,S){if(!Do.is(a.markerActions,S))return!1;if(Ja.isLoci(b)||Fr.isLoci(b)){if(b.shape!==l)return!1}else if(!Hs(b))return!1;return wr.mark(u,b,S,y)},setState:function(b){r.modifyState&&(b=r.modifyState(b)),u&&(b.visible!==void 0&&wr.setVisibility(u,b.visible),b.alphaFactor!==void 0&&wr.setAlphaFactor(u,b.alphaFactor),b.pickable!==void 0&&wr.setPickable(u,b.pickable),b.colorOnly!==void 0&&wr.setColorOnly(u,b.colorOnly),b.overpaint!==void 0&&wr.setOverpaint(u,b.overpaint,y,!0),b.transparency!==void 0&&wr.setTransparency(u,b.transparency,y,!0),b.transform!==void 0&&wr.setTransform(u,b.transform)),or.updateState(a,b)},setTheme:function(b){kr&&console.warn("The `ShapeRepresentation` theme is fixed to `ShapeGroupColorTheme` and `ShapeGroupSizeTheme`. Colors are taken from `Shape.getColor` and sizes from `Shape.getSize`")},destroy:function(){s.length=0,u&&(u.state.disposed=!0,u=void 0)}}}function Q$e(e,t,r){if(!Ja.isLoci(e)||e.shape!==t)return!1;for(var n=!1,i=t.groupCount,a=e.groups,o=0,s=a;o<s.length;o++){var u=s[o],l=u.ids,c=u.instance;if(Ie.is(l)){var d=c*i+Ie.start(l),f=c*i+Ie.end(l);r(Ie.ofBounds(d,f))&&(n=!0)}else for(var p=0,v=l.length;p<v;p++){var h=c*i+l[p];r(Ie.ofSingleton(h))&&(n=!0)}}return n}var aV=ue(),Zg=function(){function e(t){this.structure=t,this.groupUnitTransforms=[],this.unitOffsetMap=Ws.Mutable(),this.groupIndexMap=Ws.Mutable(),this._isIdentity=void 0,this.version=0,this.unitTransforms=new Float32Array(t.units.length*16),this.size=t.units.length,this.reset();for(var r=0,n=0,i=t.unitSymmetryGroups.length;n<i;++n){var a=t.unitSymmetryGroups[n];this.groupIndexMap.set(a.hashCode,n);var o=this.unitTransforms.subarray(r,r+a.units.length*16);this.groupUnitTransforms.push(o);for(var s=0,u=a.units.length;s<u;++s)this.unitOffsetMap.set(a.units[s].id,r+s*16);r+=a.units.length*16}}return e.prototype.reset=function(){this.version=0,j_(this.unitTransforms,this.size),this._isIdentity=!0},Object.defineProperty(e.prototype,"isIdentity",{get:function(){if(this._isIdentity===void 0){this._isIdentity=!0;for(var t=0,r=this.size*16;t<r;t+=16)if(ue.fromArray(aV,this.unitTransforms,t),!ue.isIdentity(aV)){this._isIdentity=!1;break}}return this._isIdentity},enumerable:!1,configurable:!0}),e.prototype.setTransform=function(t,r){this.version=(this.version+1)%2147483647,ue.toArray(t,this.unitTransforms,this.unitOffsetMap.get(r.id)),this._isIdentity=void 0},e.prototype.getTransform=function(t,r){return ue.fromArray(t,this.unitTransforms,this.unitOffsetMap.get(r.id))},e.prototype.getSymmetryGroupTransforms=function(t){return this.groupUnitTransforms[this.groupIndexMap.get(t.hashCode)]},e}(),oV=ue.zero();function sV(e,t,r){for(var n=0,i=e.units.length;n<i;n++){var a=e.units[n];bn.lerpFromIdentity(oV,a.conformation.operator,r),t.setTransform(oV,a)}}var uV=_.zero(),Ym=_.zero(),uw=ue.zero();function lV(e,t,r){for(var n=e.boundary.sphere,i=n.radius*r,a=0,o=e.units.length;a<o;a++){var s=e.units[a];_.transformMat4(uV,s.lookup3d.boundary.sphere.center,s.conformation.operator.matrix),_.sub(Ym,uV,n.center),_.setMagnitude(Ym,Ym,i),ue.fromTranslation(uw,Ym),t.setTransform(uw,s)}}var Z$e={axis:I.MappedStatic("custom",{structure:I.Group({principalAxis:I.Select("dirA",[["dirA","A"],["dirB","B"],["dirC","C"]])}),custom:I.Group({vector:I.Vec3(_.create(0,0,1))})}),origin:I.MappedStatic("structure",{structure:I.Group({}),custom:I.Group({vector:I.Vec3(_.create(0,0,0))})})};function cV(e,t){var r,n;if(t.axis.name==="custom")r=t.axis.params.vector;else{var i=We.getPrincipalAxes(e);r=i.momentsAxes[t.axis.params.principalAxis]}if(t.origin.name==="custom")n=t.origin.params.vector;else{var i=We.getPrincipalAxes(e);n=i.momentsAxes.origin}return{axis:r,origin:n}}var dV=ue(),fV=ue(),Vx=ue();function pV(e,t,r,n,i){for(var a=0,o=e.units.length;a<o;a++){var s=e.units[a];_.negate(Ym,i),ue.fromTranslation(uw,Ym),ue.fromRotation(dV,Math.PI*r*2,n),ue.fromTranslation(fV,i),ue.mul(Vx,dV,uw),ue.mul(Vx,fV,Vx),t.setTransform(Vx,s)}}var J$e=ue.fromTranslation(ue(),_.create(.5,.5,.5)),eWe=Cee(See(wee()),J$e),uu=_(),hV=ue(),tWe={origin:"Origin",model:"Model"},rWe={corner:"Corner",center:"Center"},nWe=E(E({},Ft.Params),{cellColor:I.Color(fr.orange),cellScale:I.Numeric(2,{min:.1,max:5,step:.1}),ref:I.Select("model",I.objectToOptions(tWe),{isEssential:!0}),attachment:I.Select("corner",I.objectToOptions(rWe),{isEssential:!0})}),iWe={mesh:function(e,t){return ki(oWe,Ft.Utils)}},vV=E({},nWe);function aWe(e,t,r){var n=wt.createState(256,128,r),i=e.symmetry.spacegroup.cell.fromFractional;_.copy(uu,e.ref),t.attachment==="center"?(_.trunc(uu,uu),_.subScalar(uu,uu,.5)):_.floor(uu,uu),ue.fromTranslation(hV,uu);var a=Cee(See(eWe),hV),o=Math.cbrt(e.symmetry.spacegroup.cell.volume)/300*t.cellScale;n.currentGroup=1,wt.addCage(n,i,a,o,2,20);var s=Be.fromDimensionsAndTransform(Be(),_.unit,i);_.transformMat4(uu,uu,i),Be.translate(s,s,uu),Be.expand(s,s,o);var u=wt.getMesh(n);return u.setBoundingSphere(s),u}function oWe(e,t,r,n){var i=aWe(t,r,n&&n.geometry),a=wb.getUnitcellLabel(t.symmetry);return Fr.create(a,t,i,function(){return r.cellColor},function(){return 1},function(){return a})}function mV(e,t,r){var n=_();return r.ref==="model"&&_.transformMat4(n,$t.getCenter(e),t.spacegroup.cell.toFractional),{symmetry:t,ref:n}}function sWe(e,t){return or.createMulti("Unit Cell",e,t,or.StateBuilder,iWe)}var xs=new Uint16Array([0,1,2,1,3,2]),Hp=qe.add3,ra=qe.add2,gV=qe.add,ad;(function(e){function t(r,n,i,a){r===void 0&&(r={}),n===void 0&&(n=2048),i===void 0&&(i=1024),n*=2,i*=2;var o=qe.create(Float32Array,3,i,a?a.centerBuffer.ref.value:n),s=qe.create(Float32Array,2,i,a?a.mappingBuffer.ref.value:n),u=qe.create(Float32Array,1,i,a?a.depthBuffer.ref.value:n),l=qe.create(Uint32Array,3,i,a?a.indexBuffer.ref.value:n),c=qe.create(Float32Array,1,i,a?a.groupBuffer.ref.value:n),d=qe.create(Float32Array,2,i,a?a.tcoordBuffer.ref.value:n),f=E(E({},I.getDefaultValues(Ks.Params)),r),p=f.attachment,v=f.background,h=f.backgroundMargin,m=f.tether,g=f.tetherLength,y=f.tetherBaseWidth,b=A9e(f),S=1/2.5*h,x=b.buffer/b.lineHeight,C=function(w,A,M,D,k){Hp(o,w,A,M),gV(u,D),gV(c,k)};return{add:function(w,A,M,D,k,R,O){for(var H=0,B=w.length,j=0;j<B;++j){var Y=b.get(w[j]);H+=Y.nw-2*x}var G=1/1.25,$,q;if(p.startsWith("top")?$=G:p.startsWith("middle")?$=G/2:$=0,p.endsWith("right")?q=H:p.endsWith("center")?q=H/2:q=0,m)switch(p){case"bottom-left":q-=g/2+S+.1,$-=g/2+S;break;case"bottom-center":$-=g+S;break;case"bottom-right":q+=g/2+S+.1,$-=g/2+S;break;case"middle-left":q-=g+S+.1;break;case"middle-center":break;case"middle-right":q+=g+S+.1;break;case"top-left":q-=g/2+S+.1,$+=g/2+S;break;case"top-center":$+=g+S;break;case"top-right":q+=g/2+S+.1,$+=g/2+S;break}var ee=(-q-S-.1)*R,fe=(H-q+S+.1)*R,W=(G-$+S)*R,X=(-$-S)*R;if(v){ra(s,ee,W),ra(s,ee,X),ra(s,fe,W),ra(s,fe,X);for(var U=o.elementCount,z=0;z<4;++z)ra(d,10,10),C(A,M,D,k,O);Hp(l,U+xs[0],U+xs[1],U+xs[2]),Hp(l,U+xs[3],U+xs[4],U+xs[5])}if(m){var J=void 0,K=void 0,Z=void 0,te=void 0,le=void 0,ye=void 0,be=void 0,Ae=void 0,Se=g*R,ie=y*R;switch(p){case"bottom-left":J=ee-Se/2,Z=ee+ie/2,le=ee,be=ee,K=X-Se/2,te=X,ye=X+ie/2,Ae=X;break;case"bottom-center":J=0,Z=ie/2,le=-ie/2,be=0,K=X-Se,te=X,ye=X,Ae=X;break;case"bottom-right":J=fe+Se/2,Z=fe,le=fe-ie/2,be=fe,K=X-Se/2,te=X+ie/2,ye=X,Ae=X;break;case"middle-left":J=ee-Se,Z=ee,le=ee,be=ee,K=0,te=-ie/2,ye=ie/2,Ae=0;break;case"middle-center":J=0,Z=0,le=0,be=0,K=0,te=0,ye=0,Ae=0;break;case"middle-right":J=fe+Se,Z=fe,le=fe,be=fe,K=0,te=ie/2,ye=-ie/2,Ae=0;break;case"top-left":J=ee-Se/2,Z=ee+ie/2,le=ee,be=ee,K=W+Se/2,te=W,ye=W-ie/2,Ae=W;break;case"top-center":J=0,Z=ie/2,le=-ie/2,be=0,K=W+Se,te=W,ye=W,Ae=W;break;case"top-right":J=fe+Se/2,Z=fe,le=fe-ie/2,be=fe,K=W+Se/2,te=W-ie/2,ye=W,Ae=W;break;default:throw new Error("unsupported attachment")}ra(s,J,K),ra(s,Z,te),ra(s,le,ye),ra(s,be,Ae);for(var U=o.elementCount,z=0;z<4;++z)ra(d,10,10),C(A,M,D,k,O);Hp(l,U,U+1,U+3),Hp(l,U,U+3,U+2)}q+=x,$+=x;for(var oe=0,j=0;j<B;++j){var Y=b.get(w[j]),L=(oe-q)*R,V=(oe+Y.nw-q)*R,he=(Y.nh-$)*R,we=-$*R;ra(s,L,he),ra(s,L,we),ra(s,V,he),ra(s,V,we);var Te=b.texture.width,ze=b.texture.height;ra(d,Y.x/Te,Y.y/ze),ra(d,Y.x/Te,(Y.y+Y.h)/ze),ra(d,(Y.x+Y.w)/Te,Y.y/ze),ra(d,(Y.x+Y.w)/Te,(Y.y+Y.h)/ze),oe+=Y.nw-2*x;for(var U=o.elementCount,z=0;z<4;++z)C(A,M,D,k,O);Hp(l,U+xs[0],U+xs[1],U+xs[2]),Hp(l,U+xs[3],U+xs[4],U+xs[5])}},getText:function(){var w=b.texture,A=qe.compact(o,!0),M=qe.compact(s,!0),D=qe.compact(u,!0),k=qe.compact(l,!0),R=qe.compact(c,!0),O=qe.compact(d,!0);return Ks.create(w,A,M,D,k,R,O,l.elementCount/2,a)}}}e.create=t})(ad||(ad={}));var T0={granularity:"element",condensed:!1,reverse:!1,countsOnly:!1,hidePrefix:!1,htmlStyling:!0};function yp(e,t){switch(t===void 0&&(t={}),e.kind){case"structure-loci":return e.structure.models.map(function(l){return l.entry}).filter(function(l){return!!l}).join(", ");case"element-loci":return lw(Lf.ofLoci(e),t);case"bond-loci":var r=e.bonds[0];return r?JL(r):"";case"shape-loci":return e.shape.name;case"group-loci":var n=e.groups[0];return n?e.shape.getLabel(Le.start(n.ids),n.instance):"";case"every-loci":return"Everything";case"empty-loci":return"Nothing";case"data-loci":return e.getLabel();case"volume-loci":return e.volume.label||"Volume";case"isosurface-loci":return[""+(e.volume.label||"Volume"),"Isosurface at "+Ct.IsoValue.toString(e.isoValue)].join(" | ");case"cell-loci":var i=Le.size(e.indices),a=Le.start(e.indices),o=Ct.IsoValue.absolute(e.volume.grid.cells.data[a]),s=Ct.IsoValue.toRelative(o,e.volume.grid.stats),u=[""+(e.volume.label||"Volume"),i===1?"Cell #"+a:i+" Cells"];return i===1&&u.push(Ct.IsoValue.toString(o)+" ("+Ct.IsoValue.toString(s)+")"),u.join(" | ")}}function Im(e,t){return e===1?"1 "+t:e+" "+t+"s"}function ly(e,t,r,n,i,a){return fu(t,{granularity:r,hidePrefix:n,reverse:i,condensed:a})+" <small>[+ "+Im(e-1,"other "+h0(r))+"]</small>"}function uWe(e){var t=e.elements,r=e.model,n=r.atomicHierarchy,i=n.chainAtomSegments,a=n.residueAtomSegments,o=i.offsets[i.index[t[0]]],s=i.offsets[i.index[t[t.length-1]]+1]-1;return a.index[s]-a.index[o]+1}function lw(e,t){t===void 0&&(t={});var r=E(E({},T0),t),n=lWe(e,r.countsOnly,r.hidePrefix,r.condensed,r.reverse);return r.htmlStyling?n:Mf(n)}function lWe(e,t,r,n,i){t===void 0&&(t=!1),r===void 0&&(r=!1),n===void 0&&(n=!1),i===void 0&&(i=!1);var a=e.structureCount,o=e.chainCount,s=e.residueCount,u=e.conformationCount,l=e.elementCount;if(!t&&l===1&&s===0&&o===0)return fu(e.firstElementLoc,{hidePrefix:r,condensed:n,granularity:"element",reverse:i});if(!t&&l===0&&s===1&&o===0)return fu(e.firstResidueLoc,{hidePrefix:r,condensed:n,granularity:"residue",reverse:i});if(!t&&l===0&&s===0&&o===1){var c=e.firstChainLoc.unit,d=je.isAtomic(c)&&uWe(c)===1||je.Traits.is(c.traits,1)?"residue":"chain";return fu(e.firstChainLoc,{hidePrefix:r,condensed:n,granularity:d,reverse:i})}else if(t){var f=[];return a>0&&f.push(Im(a,"Structure")),o>0&&f.push(Im(o,"Chain")),s>0&&f.push(Im(s,"Residue")),u>0&&f.push(Im(u,"Conformation")),l>0&&f.push(Im(l,"Element")),f.join("<small> + </small>")}else{var f=[];return a>0&&f.push(a===1?fu(e.firstStructureLoc,{hidePrefix:r,condensed:n,granularity:"structure",reverse:i}):ly(a,e.firstStructureLoc,"structure",r,i,n)),o>0&&(f.push(o===1?fu(e.firstChainLoc,{condensed:n,granularity:"chain",hidePrefix:r,reverse:i}):ly(o,e.firstChainLoc,"chain",r,i,n)),r=!0),s>0&&(f.push(s===1?fu(e.firstResidueLoc,{condensed:n,granularity:"residue",hidePrefix:r,reverse:i}):ly(s,e.firstResidueLoc,"residue",r,i,n)),r=!0),u>0&&(f.push(u===1?fu(e.firstConformationLoc,{condensed:n,granularity:"conformation",hidePrefix:r,reverse:i}):ly(u,e.firstConformationLoc,"conformation",r,i,n)),r=!0),l>0&&f.push(l===1?fu(e.firstElementLoc,{condensed:n,granularity:"element",hidePrefix:r,reverse:i}):ly(l,e.firstElementLoc,"element",r,i,n)),f.join("<small> + </small>")}}function JL(e,t){return t===void 0&&(t={}),jE({loci:[Re(e.aStructure,[{unit:e.aUnit,indices:Le.ofSingleton(e.aIndex)}]),Re(e.bStructure,[{unit:e.bUnit,indices:Le.ofSingleton(e.bIndex)}])]},t)}function jE(e,t){t===void 0&&(t={});var r=E(E({},T0),t),n=cWe(e,r);return r.htmlStyling?n:Mf(n)}function cWe(e,t){for(var r=t.granularity,n=t.hidePrefix,i=t.reverse,a=t.condensed,o=!0,s=0,u=e.loci;s<u.length;s++){var l=u[s];if(!Re.is(l)||Re.size(l)!==1){o=!1;break}}if(o){var c=e.loci.map(function(b){var S=b.elements[0],x=S.unit,C=S.indices;return Ze.create(b.structure,x,x.elements[Le.start(C)])}),d=c.map(function(b){return cre(b,r,n,i||a)});if(a)return d.map(function(b){return b[0].replace(/\[.*\]/g,"").trim()}).filter(function(b){return!!b}).join("  ");for(var f=0,p=0,v=Math.min.apply(Math,d.map(function(b){return b.length}))-1;p<v;++p){for(var h=!0,m=1,g=d.length;m<g;++m)if(d[0][p]!==d[m][p]){h=!1;break}if(h)f+=1;else break}if(f>0){for(var y=[d[0].join(" | ")],m=1,g=d.length;m<g;++m)y.push(d[m].slice(f).filter(function(x){return!!x}).join(" | "));return y.join("  ")}else return d.map(function(b){return b.filter(function(S){return!!S}).join(" | ")}).filter(function(b){return!!b}).join("</br>")}else{var d=e.loci.map(function(S){return yp(S,t)});return d.filter(function(S){return!!S}).join(a?"  ":"</br>")}}function fu(e,t){var r,n;t===void 0&&(t={});var i=E(E({},T0),t),a=cre(e,i.granularity,i.hidePrefix,i.reverse||i.condensed),o=i.condensed?(n=(r=a[0])===null||r===void 0?void 0:r.replace(/\[.*\]/g,"").trim())!==null&&n!==void 0?n:"":a.filter(function(s){return!!s}).join(" | ");return i.htmlStyling?o:Mf(o)}function cre(e,t,r,n){t===void 0&&(t="element"),r===void 0&&(r=!1),n===void 0&&(n=!1);var i=[];if(!r){var a=e.unit.model.entry;a.length>30&&(a=a.substr(0,27)+""),i.push("<small>"+a+"</small>"),t!=="structure"&&(i.push("<small>Model "+e.unit.model.modelNum+"</small>"),i.push("<small>Instance "+e.unit.conformation.operator.name+"</small>"))}return je.isAtomic(e.unit)?i.push.apply(i,dWe(e,t,n)):je.isCoarse(e.unit)?i.push.apply(i,fWe(e,t)):i.push("Unknown"),n?i.reverse():i}function dWe(e,t,r){r===void 0&&(r=!1);var n=Ze.residueIndex(e),i=lt.chain.label_asym_id(e),a=lt.chain.auth_asym_id(e),o=e.unit.model.atomicHierarchy.residues.label_seq_id.valueKind(n)===0,s=lt.residue.label_seq_id(e),u=lt.residue.auth_seq_id(e),l=lt.residue.pdbx_PDB_ins_code(e),c=lt.atom.label_comp_id(e),d=lt.atom.label_atom_id(e),f=lt.atom.label_alt_id(e),p=lt.atom.occupancy(e),v=lt.residue.microheterogeneityCompIds(e),h=t==="residue"&&v.length>1?"("+v.join("|")+")":c,m=[];switch(t){case"element":m.push("<b>"+d+"</b>"+(f?"%"+f:""));case"conformation":t==="conformation"&&f&&m.push("<small>Conformation</small> <b>"+f+"</b>");case"residue":var g=s===u||!o?u:s;m.push("<b>"+h+" "+g+"</b>"+(g!==u?" <small>[auth</small> <b>"+u+"</b><small>]</small>":"")+"<b>"+(l||"")+"</b>");case"chain":i===a?m.push("<b>"+i+"</b>"):t==="chain"&&je.Traits.is(e.unit.traits,1)?m.push("<small>[auth</small> <b>"+a+"</b><small>]</small>"):m.push("<b>"+i+"</b> <small>[auth</small> <b>"+a+"</b><small>]</small>")}return m.length>0&&p!==1&&!r&&(m[0]=m[0]+" <small>[occupancy</small> <b>"+Math.round(100*p)/100+"</b><small>]</small>"),m.reverse()}function fWe(e,t){var r=lt.coarse.asym_id(e),n=lt.coarse.seq_id_begin(e),i=lt.coarse.seq_id_end(e),a=[];switch(t){case"element":case"conformation":case"residue":if(n===i){var o=lt.coarse.entityKey(e),s=e.unit.model.sequence.byEntityKey[o],u=s.sequence.compId.value(n-1);a.push("<b>"+u+" "+n+"</b>")}else a.push("<b>"+n+"-"+i+"</b>");case"chain":a.push("<b>"+r+"</b>")}return a.reverse()}function zE(e,t){t===void 0&&(t={});var r=E(E(E({},T0),{measureOnly:!1,unitLabel:""}),t),n=e.loci.map(function(u){return ar.getCenter(u)}),i=n[0],a=n[1],o=_.distance(i,a).toFixed(2)+" "+r.unitLabel;if(r.measureOnly)return o;var s=jE(e,r);return r.condensed?o+" | "+s:"Distance "+o+"</br>"+s}function VE(e,t){t===void 0&&(t={});var r=E(E(E({},T0),{measureOnly:!1}),t),n=e.loci.map(function(d){return ar.getCenter(d)}),i=n[0],a=n[1],o=n[2],s=_.sub(_(),i,a),u=_.sub(_(),o,a),l=Pu(_.angle(s,u)).toFixed(2)+"";if(r.measureOnly)return l;var c=jE(e,r);return r.condensed?l+" | "+c:"Angle "+l+"</br>"+c}function HE(e,t){t===void 0&&(t={});var r=E(E(E({},T0),{measureOnly:!1}),t),n=e.loci.map(function(c){return ar.getCenter(c)}),i=n[0],a=n[1],o=n[2],s=n[3],u=Pu(_.dihedralAngle(i,a,o,s)).toFixed(2)+"";if(r.measureOnly)return u;var l=jE(e,r);return r.condensed?u+" | "+l:"Dihedral "+u+"</br>"+l}var dre={customText:I.Text("",{label:"Text",description:"Override the label with custom value."}),textColor:I.Color(fr.black,{isEssential:!0}),textSize:I.Numeric(.5,{min:.1,max:5,step:.1},{isEssential:!0})},GE=E(E(E({},Ks.Params),dre),{borderWidth:I.Numeric(.2,{min:0,max:.5,step:.01})}),fre={unitLabel:I.Text("",{isEssential:!0})},pWe=E(E(E({},wn.Params),fre),{lineSizeAttenuation:I.Boolean(!0),linesColor:I.Color(fr.lightgreen,{isEssential:!0}),linesSize:I.Numeric(.075,{min:.01,max:5,step:.01}),dashLength:I.Numeric(.2,{min:.01,max:.2,step:.01})}),hWe=E(E({},GE),fre),pre={lines:function(e,t){return ki(gWe,wn.Utils,{modifyState:function(r){return E(E({},r),{markerActions:Do.Highlighting})}})},text:function(e,t){return ki(bWe,Ks.Utils,{modifyState:function(r){return E(E({},r),{markerActions:tr.None})}})}},yV=E(E(E({},pWe),hWe),{visuals:I.MultiSelect(["lines","text"],I.objectToOptions(pre))});function vWe(){return{sphereA:Be(),sphereB:Be(),center:_(),distance:0}}function hre(e,t){var r=t.sphereA,n=t.sphereB,i=t.center,a=e.loci,o=a[0],s=a[1];return ar.getBoundingSphere(o,r),ar.getBoundingSphere(s,n),_.add(i,r.center,n.center),_.scale(i,i,.5),t.distance=_.distance(r.center,n.center),t}var wf=vWe();function vre(e,t){return e.pairs.length===1?"Distance "+zE(e.pairs[0],{unitLabel:t,measureOnly:!0}):e.pairs.length+" Distances"}function mWe(e,t,r){for(var n=ls.create(128,64,r),i=0,a=e.pairs.length;i<a;++i)hre(e.pairs[i],wf),n.addFixedLengthDashes(wf.sphereA.center,wf.sphereB.center,t.dashLength,i);return n.getLines()}function gWe(e,t,r,n){var i=mWe(t,r,n&&n.geometry),a=vre(t,r.unitLabel),o=function(s){return zE(t.pairs[s],r)};return Fr.create(a,t,i,function(){return r.linesColor},function(){return r.linesSize},o)}function yWe(e,t,r){for(var n=ad.create(t,128,64,r),i=0,a=e.pairs.length;i<a;++i){hre(e.pairs[i],wf);var o=wf.center,s=wf.distance,u=wf.sphereA,l=wf.sphereB,c=t.customText||s.toFixed(2)+" "+t.unitLabel,d=Math.max(2,u.radius,l.radius),f=d/2;n.add(c,o[0],o[1],o[2],1,f,i)}return n.getText()}function bWe(e,t,r,n){var i=yWe(t,r,n&&n.geometry),a=vre(t,r.unitLabel),o=function(s){return zE(t.pairs[s],r)};return Fr.create(a,t,i,function(){return r.textColor},function(){return r.textSize},o)}function xWe(e,t){return or.createMulti("Distance",e,t,or.StateBuilder,pre)}function bV(e){var t=e[0].loci,r=e[1].loci;return{pairs:[{loci:[t,r]}]}}function xV(e){var t=e[0].loci,r=e[1].loci,n=e[2].loci;return{triples:[{loci:[t,r,n]}]}}function SV(e){var t=e[0].loci,r=e[1].loci,n=e[2].loci,i=e[3].loci;return{quads:[{loci:[t,r,n,i]}]}}function CV(e){var t=e[0].loci;return{infos:[{loci:t}]}}function _V(e){var t=e[0].loci;return{locis:[t]}}var SWe=E(E({},GE),{offsetZ:I.Numeric(2,{min:0,max:10,step:.1})}),mre={text:function(e,t){return ki(EWe,Ks.Utils,{modifyState:function(r){return E(E({},r),{pickable:!1})}})}},wV=E(E({},SWe),{scaleByRadius:I.Boolean(!0),visuals:I.MultiSelect(["text"],I.objectToOptions(mre))}),CWe=Be();function eF(e,t){return t===void 0&&(t=!1),e.label||yp(e.loci,{hidePrefix:!0,htmlStyling:!1,condensed:t})}function _We(e){return e.infos.length===1?eF(e.infos[0]):e.infos.length+" Labels"}function wWe(e,t,r){for(var n=ad.create(t,128,64,r),i=t.customText.trim(),a=0,o=e.infos.length;a<o;++a){var s=e.infos[a],u=ar.getBoundingSphere(s.loci,CWe);if(u){var l=u.center,c=u.radius,d=i||eF(s,!0);n.add(d,l[0],l[1],l[2],t.scaleByRadius?c/.9:0,t.scaleByRadius?Math.max(1,c):1,a)}}return n.getText()}function EWe(e,t,r,n){var i=wWe(t,r,n&&n.geometry),a=_We(t),o=r.customText.trim(),s=o?function(u){return o}:function(u){return eF(t.infos[u])};return Fr.create(a,t,i,function(){return r.textColor},function(){return r.textSize},s)}function AWe(e,t){return or.createMulti("Label",e,t,or.StateBuilder,mre)}var Gp=_(),PWe=ue.identity(),qp=new Float32Array(6*3),TWe=new Uint8Array([0,1,2,3,4,5]);function IWe(e,t,r,n,i){var a=t.origin,o=t.dirA,s=t.dirB,u=t.dirC;_.add(Gp,a,o),_.toArray(_.add(Gp,a,o),qp,0),_.toArray(_.sub(Gp,a,o),qp,3),_.toArray(_.add(Gp,a,s),qp,6),_.toArray(_.sub(Gp,a,s),qp,9),_.toArray(_.add(Gp,a,u),qp,12),_.toArray(_.sub(Gp,a,u),qp,15);var l=VL(qp,TWe),c=_u.volume(t),d=Math.cbrt(c)/300*r;wt.addCage(e,PWe,l,d,n,i)}_.zero();_.zero();var Gd=_(),MWe=_(),DWe=_(),RWe=_(),kWe=ue.identity(),EV=new Float32Array(8*3),OWe=new Uint8Array([0,1,0,3,0,6,1,2,1,7,2,3,2,4,3,5,4,5,4,7,5,6,6,7]);function LWe(e,t,r,n,i){var a=t.origin,o=t.dirA,s=t.dirB,u=t.dirC,l=_.negate(MWe,o),c=_.negate(DWe,s),d=_.negate(RWe,u),f=0,p=function(g,y,b){_.copy(Gd,a),_.add(Gd,Gd,g),_.add(Gd,Gd,y),_.add(Gd,Gd,b),_.toArray(Gd,EV,f),f+=3};p(o,s,u),p(o,s,d),p(o,c,d),p(o,c,u),p(l,c,d),p(l,c,u),p(l,s,u),p(l,s,d);var v=VL(EV,OWe),h=_u.volume(t),m=Math.cbrt(h)/300*r;wt.addCage(e,kWe,v,m,n,i)}var FWe=ue.identity(),AV=_();function NWe(e,t,r,n,i){return _.add(AV,t,r),ue.targetTo(e,t,AV,n),ue.setTranslation(e,t),ue.scale(e,e,i)}function tF(e,t,r,n,i,a){wt.addPrimitive(e,NWe(FWe,t,r,n,i),Vee(a))}var rF={color:I.Color(fr.orange),scale:I.Numeric(2,{min:.1,max:10,step:.1})},BWe=E(E({},Ft.Params),rF),UWe=E(E({},Ft.Params),rF);E(E({},Ft.Params),rF);var gre={axes:function(e,t){return ki(zWe,Ft.Utils)},box:function(e,t){return ki(HWe,Ft.Utils)},ellipsoid:function(e,t){return ki(qWe,Ft.Utils)}},PV=E(E(E({},BWe),UWe),{visuals:I.MultiSelect(["box"],I.objectToOptions(gre)),color:I.Color(fr.orange),scale:I.Numeric(2,{min:.1,max:5,step:.1})});function qE(e){var t=yp(e,{countsOnly:!0});return"Principal Axes of "+t}function nF(e){return e.locis.length===1?qE(e.locis[0]):e.locis.length+" Orientations"}function jWe(e,t,r){for(var n=wt.createState(256,128,r),i=0,a=e.locis.length;i<a;++i){var o=ar.getPrincipalAxes(e.locis[i]);o&&(n.currentGroup=i,IWe(n,o.momentsAxes,t.scale,2,20))}return wt.getMesh(n)}function zWe(e,t,r,n){var i=jWe(t,r,n&&n.geometry),a=nF(t),o=function(s){return qE(t.locis[s])};return Fr.create(a,t,i,function(){return r.color},function(){return 1},o)}function VWe(e,t,r){for(var n=wt.createState(256,128,r),i=0,a=e.locis.length;i<a;++i){var o=ar.getPrincipalAxes(e.locis[i]);o&&(n.currentGroup=i,LWe(n,o.boxAxes,t.scale,2,20))}return wt.getMesh(n)}function HWe(e,t,r,n){var i=VWe(t,r,n&&n.geometry),a=nF(t),o=function(s){return qE(t.locis[s])};return Fr.create(a,t,i,function(){return r.color},function(){return 1},o)}function GWe(e,t,r){for(var n=wt.createState(256,128,r),i=0,a=e.locis.length;i<a;++i){var o=ar.getPrincipalAxes(e.locis[i]);if(o){var s=o.boxAxes,u=s.origin,l=s.dirA,c=s.dirB,d=_u.size(_(),s);_.scale(d,d,.5);var f=_.create(d[2],d[1],d[0]);n.currentGroup=i,tF(n,u,l,c,f,2)}}return wt.getMesh(n)}function qWe(e,t,r,n){var i=GWe(t,r,n&&n.geometry),a=nF(t),o=function(s){return qE(t.locis[s])};return Fr.create(a,t,i,function(){return r.color},function(){return 1},o)}function $We(e,t){var r=or.createMulti("Orientation",e,t,or.StateBuilder,gre);return r.setState({markerActions:Do.Highlighting}),r}var WWe={radius:1,segments:36,thetaStart:0,thetaLength:Math.PI*2};function yre(e){var t=E(E({},WWe),e),r=t.radius,n=t.segments,i=t.thetaStart,a=t.thetaLength,o=a===Math.PI*2,s=o?n+1:n+2,u=new Float32Array(s*3),l=new Float32Array(s*3),c=new Uint32Array(n*3);u[0]=0,u[1]=0,u[2]=0,l[0]=0,l[1]=1,l[2]=0;for(var d=0,f=3;d<n;++d,f+=3){var p=i+d/n*a;u[f]=r*Math.sin(p),u[f+1]=0,u[f+2]=r*Math.cos(p),l[f]=0,l[f+1]=1,l[f+2]=0}for(var d=1,f=0;d<n;++d,f+=3)c[f]=d,c[f+1]=d+1,c[f+2]=0;if(o){var v=(n-1)*3;c[v]=n,c[v+1]=1,c[v+2]=0}else{var p=i+a,f=(n+1)*3;u[f]=r*Math.sin(p),u[f+1]=0,u[f+2]=r*Math.cos(p),l[f]=0,l[f+1]=1,l[f+2]=0;var v=(n-1)*3;c[v]=n,c[v+1]=n+1,c[v+2]=0}return{vertices:u,normals:l,indices:c}}var bre={color:I.Color(fr.lightgreen),arcScale:I.Numeric(.7,{min:.01,max:1,step:.01})},xre=E(E(E({},wn.Params),bre),{lineSizeAttenuation:I.Boolean(!0),linesSize:I.Numeric(.04,{min:.01,max:5,step:.01}),dashLength:I.Numeric(.04,{min:.01,max:.2,step:.01})}),XWe=E({},xre),YWe=E({},xre),KWe=E(E(E({},Ft.Params),bre),{ignoreLight:I.Boolean(!0),sectorOpacity:I.Numeric(.75,{min:0,max:1,step:.01})}),Sre={vectors:function(e,t){return ki(JWe,wn.Utils,{modifyState:function(r){return E(E({},r),{pickable:!1})}})},arc:function(e,t){return ki(tXe,wn.Utils,{modifyState:function(r){return E(E({},r),{pickable:!1})}})},sector:function(e,t){return ki(nXe,Ft.Utils,{modifyProps:function(r){return E(E({},r),{alpha:r.sectorOpacity})},modifyState:function(r){return E(E({},r),{markerActions:Do.Highlighting})}})},text:function(e,t){return ki(aXe,Ks.Utils,{modifyState:function(r){return E(E({},r),{markerActions:tr.None})}})}},TV=E(E(E(E(E({},XWe),YWe),KWe),GE),{visuals:I.MultiSelect(["vectors","sector","text"],I.objectToOptions(Sre))});function QWe(){return{sphereA:Be(),sphereB:Be(),sphereC:Be(),arcDirA:_(),arcDirC:_(),arcNormal:_(),radius:0,angle:0}}var qd=_(),cy=ue();function $E(e,t,r){var n=t.sphereA,i=t.sphereB,a=t.sphereC,o=t.arcDirA,s=t.arcDirC,u=t.arcNormal,l=e.loci,c=l[0],d=l[1],f=l[2];ar.getBoundingSphere(c,n),ar.getBoundingSphere(d,i),ar.getBoundingSphere(f,a),_.sub(o,n.center,i.center),_.sub(s,a.center,i.center),_.cross(u,o,s);var p=Math.min(_.magnitude(o),_.magnitude(s)),v=p*r;return t.radius=v,t.angle=_.angle(o,s),t}function Cre(e,t){var r=e.radius,n=e.angle,i=t?jQ(n,r)/t:32;ue.targetTo(cy,e.sphereB.center,e.sphereA.center,e.arcNormal),ue.setTranslation(cy,e.sphereB.center),ue.mul(cy,cy,ue.rotY180);var a=yre({radius:r,thetaLength:n,segments:i});return zL(a,cy)}var aa=QWe();function WE(e){return e.triples.length===1?"Angle "+VE(e.triples[0],{measureOnly:!0}):e.triples.length+" Angles"}function ZWe(e,t,r){for(var n=ls.create(128,64,r),i=0,a=e.triples.length;i<a;++i)$E(e.triples[i],aa,t.arcScale),n.addFixedLengthDashes(aa.sphereB.center,aa.sphereA.center,t.dashLength,i),n.addFixedLengthDashes(aa.sphereB.center,aa.sphereC.center,t.dashLength,i);return n.getLines()}function JWe(e,t,r,n){var i=ZWe(t,r,n&&n.geometry),a=WE(t);return Fr.create(a,t,i,function(){return r.color},function(){return r.linesSize},function(){return""})}function eXe(e,t,r){for(var n=ls.create(128,64,r),i=0,a=e.triples.length;i<a;++i){$E(e.triples[i],aa,t.arcScale);for(var o=Cre(aa,t.dashLength),s=o.indices,u=o.vertices,l=0,c=s.length;l<c;l+=3)if(l%2!==1){var d=s[l]*3,f=s[l+1]*3,p=u[d],v=u[d+1],h=u[d+2],m=u[f],g=u[f+1],y=u[f+2];n.add(p,v,h,m,g,y,i)}}return n.getLines()}function tXe(e,t,r,n){var i=eXe(t,r,n&&n.geometry),a=WE(t);return Fr.create(a,t,i,function(){return r.color},function(){return r.linesSize},function(){return""})}function rXe(e,t,r){for(var n=wt.createState(128,64,r),i=0,a=e.triples.length;i<a;++i){$E(e.triples[i],aa,t.arcScale);var o=Cre(aa);n.currentGroup=i,wt.addPrimitive(n,ue.id,o),wt.addPrimitiveFlipped(n,ue.id,o)}return wt.getMesh(n)}function nXe(e,t,r,n){var i=rXe(t,r,n&&n.geometry),a=WE(t),o=function(s){return VE(t.triples[s])};return Fr.create(a,t,i,function(){return r.color},function(){return 1},o)}function iXe(e,t,r){for(var n=ad.create(t,128,64,r),i=0,a=e.triples.length;i<a;++i){$E(e.triples[i],aa,t.arcScale),_.add(qd,aa.arcDirA,aa.arcDirC),_.setMagnitude(qd,qd,aa.radius),_.add(qd,aa.sphereB.center,qd);var o=Pu(aa.angle).toFixed(2),s=t.customText||o+"",u=Math.max(2,aa.sphereA.radius,aa.sphereB.radius,aa.sphereC.radius),l=u/2;n.add(s,qd[0],qd[1],qd[2],.1,l,i)}return n.getText()}function aXe(e,t,r,n){var i=iXe(t,r,n&&n.geometry),a=WE(t),o=function(s){return VE(t.triples[s])};return Fr.create(a,t,i,function(){return r.textColor},function(){return r.textSize},o)}function oXe(e,t){return or.createMulti("Angle",e,t,or.StateBuilder,Sre)}var _re={color:I.Color(fr.lightgreen),arcScale:I.Numeric(.7,{min:.01,max:1,step:.01})},XE=E(E(E({},wn.Params),_re),{lineSizeAttenuation:I.Boolean(!0),linesSize:I.Numeric(.04,{min:.01,max:5,step:.01}),dashLength:I.Numeric(.04,{min:.01,max:.2,step:.01})}),sXe=E({},XE),uXe=E({},XE),lXe=E({},XE),cXe=E({},XE),dXe=E(E(E({},Ft.Params),_re),{ignoreLight:I.Boolean(!0),sectorOpacity:I.Numeric(.75,{min:0,max:1,step:.01})}),wre={vectors:function(e,t){return ki(hXe,wn.Utils,{modifyState:function(r){return E(E({},r),{pickable:!1})}})},extenders:function(e,t){return ki(xXe,wn.Utils,{modifyState:function(r){return E(E({},r),{pickable:!1})}})},connector:function(e,t){return ki(mXe,wn.Utils,{modifyState:function(r){return E(E({},r),{pickable:!1})}})},arms:function(e,t){return ki(yXe,wn.Utils,{modifyState:function(r){return E(E({},r),{pickable:!1})}})},arc:function(e,t){return ki(CXe,wn.Utils,{modifyState:function(r){return E(E({},r),{pickable:!1})}})},sector:function(e,t){return ki(wXe,Ft.Utils,{modifyProps:function(r){return E(E({},r),{alpha:r.sectorOpacity})},modifyState:function(r){return E(E({},r),{markerActions:Do.Highlighting})}})},text:function(e,t){return ki(AXe,Ks.Utils,{modifyState:function(r){return E(E({},r),{markerActions:tr.None})}})}},IV=E(E(E(E(E(E(E({},sXe),uXe),lXe),cXe),dXe),GE),{visuals:I.MultiSelect(["extenders","arms","sector","text"],I.objectToOptions(wre))});function fXe(){return{sphereA:Be(),sphereB:Be(),sphereC:Be(),sphereD:Be(),dirBA:_(),dirCD:_(),projA:_(),projD:_(),arcPointA:_(),arcPointD:_(),arcDirA:_(),arcDirD:_(),arcCenter:_(),arcNormal:_(),radius:0,angle:0}}var ka=_(),dy=ue();function Bv(e,t,r){var n=t.sphereA,i=t.sphereB,a=t.sphereC,o=t.sphereD,s=t.dirBA,u=t.dirCD,l=t.projA,c=t.projD,d=t.arcPointA,f=t.arcPointD,p=t.arcDirA,v=t.arcDirD,h=t.arcCenter,m=t.arcNormal,g=e.loci,y=g[0],b=g[1],S=g[2],x=g[3];ar.getBoundingSphere(y,n),ar.getBoundingSphere(b,i),ar.getBoundingSphere(S,a),ar.getBoundingSphere(x,o),_.add(h,i.center,a.center),_.scale(h,h,.5),_.sub(s,n.center,i.center),_.sub(u,o.center,a.center),_.add(d,h,s),_.add(f,h,u),_.sub(m,a.center,i.center),_.orthogonalize(p,m,s),_.orthogonalize(v,m,u),_.projectPointOnVector(l,d,p,h),_.projectPointOnVector(c,f,v,h);var C=Math.min(_.distance(l,h),_.distance(c,h)),w=C*r;_.setMagnitude(p,p,w),_.setMagnitude(v,v,w),_.add(d,h,p),_.add(f,h,v),t.radius=w,t.angle=_.dihedralAngle(n.center,i.center,a.center,o.center),_.matchDirection(ka,m,_.sub(ka,d,n.center));var A=_.angle(s,ka),M=w/Math.cos(A-h1);_.add(l,i.center,_.setMagnitude(ka,s,M)),_.matchDirection(ka,m,_.sub(ka,f,o.center));var D=_.angle(u,ka),k=w/Math.cos(D-h1);return _.add(c,a.center,_.setMagnitude(ka,u,k)),t}function Ere(e,t){var r=e.radius,n=e.angle,i=t?jQ(n,r)/t:32;ue.targetTo(dy,e.arcCenter,n<0?e.arcPointD:e.arcPointA,e.arcNormal),ue.setTranslation(dy,e.arcCenter),ue.mul(dy,dy,ue.rotY180);var a=yre({radius:r,thetaLength:Math.abs(n),segments:i});return zL(a,dy)}var dn=fXe();function Uv(e){return e.quads.length===1?"Dihedral "+HE(e.quads[0],{measureOnly:!0}):e.quads.length+" Dihedrals"}function pXe(e,t,r){for(var n=ls.create(128,64,r),i=0,a=e.quads.length;i<a;++i)Bv(e.quads[i],dn,t.arcScale),n.addFixedLengthDashes(dn.arcCenter,dn.arcPointA,t.dashLength,i),n.addFixedLengthDashes(dn.arcCenter,dn.arcPointD,t.dashLength,i);return n.getLines()}function hXe(e,t,r,n){var i=pXe(t,r,n&&n.geometry),a=Uv(t);return Fr.create(a,t,i,function(){return r.color},function(){return r.linesSize},function(){return""})}function vXe(e,t,r){for(var n=ls.create(128,64,r),i=0,a=e.quads.length;i<a;++i)Bv(e.quads[i],dn,t.arcScale),n.addFixedLengthDashes(dn.sphereB.center,dn.sphereC.center,t.dashLength,i);return n.getLines()}function mXe(e,t,r,n){var i=vXe(t,r,n&&n.geometry),a=Uv(t);return Fr.create(a,t,i,function(){return r.color},function(){return r.linesSize},function(){return""})}function gXe(e,t,r){for(var n=ls.create(128,64,r),i=0,a=e.quads.length;i<a;++i)Bv(e.quads[i],dn,t.arcScale),n.addFixedLengthDashes(dn.sphereB.center,dn.sphereA.center,t.dashLength,i),n.addFixedLengthDashes(dn.sphereC.center,dn.sphereD.center,t.dashLength,i);return n.getLines()}function yXe(e,t,r,n){var i=gXe(t,r,n&&n.geometry),a=Uv(t);return Fr.create(a,t,i,function(){return r.color},function(){return r.linesSize},function(){return""})}function bXe(e,t,r){for(var n=ls.create(128,64,r),i=0,a=e.quads.length;i<a;++i)Bv(e.quads[i],dn,t.arcScale),n.addFixedLengthDashes(dn.arcPointA,dn.projA,t.dashLength,i),n.addFixedLengthDashes(dn.arcPointD,dn.projD,t.dashLength,i);return n.getLines()}function xXe(e,t,r,n){var i=bXe(t,r,n&&n.geometry),a=Uv(t);return Fr.create(a,t,i,function(){return r.color},function(){return r.linesSize},function(){return""})}function SXe(e,t,r){for(var n=ls.create(128,64,r),i=0,a=e.quads.length;i<a;++i){Bv(e.quads[i],dn,t.arcScale);for(var o=Ere(dn,t.dashLength),s=o.indices,u=o.vertices,l=0,c=s.length;l<c;l+=3)if(l%2!==1){var d=s[l]*3,f=s[l+1]*3,p=u[d],v=u[d+1],h=u[d+2],m=u[f],g=u[f+1],y=u[f+2];n.add(p,v,h,m,g,y,i)}}return n.getLines()}function CXe(e,t,r,n){var i=SXe(t,r,n&&n.geometry),a=Uv(t);return Fr.create(a,t,i,function(){return r.color},function(){return r.linesSize},function(){return""})}function _Xe(e,t,r){for(var n=wt.createState(128,64,r),i=0,a=e.quads.length;i<a;++i){Bv(e.quads[i],dn,t.arcScale);var o=Ere(dn);n.currentGroup=i,wt.addPrimitive(n,ue.id,o),wt.addPrimitiveFlipped(n,ue.id,o)}return wt.getMesh(n)}function wXe(e,t,r,n){var i=_Xe(t,r,n&&n.geometry),a=Uv(t),o=function(s){return HE(t.quads[s])};return Fr.create(a,t,i,function(){return r.color},function(){return 1},o)}function EXe(e,t,r){for(var n=ad.create(t,128,64,r),i=0,a=e.quads.length;i<a;++i){Bv(e.quads[i],dn,t.arcScale),_.add(ka,dn.arcDirA,dn.arcDirD),_.setMagnitude(ka,ka,dn.radius),_.add(ka,dn.arcCenter,ka);var o=Pu(dn.angle).toFixed(2);o==="-0.00"&&(o="0.00");var s=t.customText||o+"",u=Math.max(2,dn.sphereA.radius,dn.sphereB.radius,dn.sphereC.radius,dn.sphereD.radius),l=u/2;n.add(s,ka[0],ka[1],ka[2],.1,l,i)}return n.getText()}function AXe(e,t,r,n){var i=EXe(t,r,n&&n.geometry),a=Uv(t),o=function(s){return HE(t.quads[s])};return Fr.create(a,t,i,function(){return r.textColor},function(){return r.textSize},o)}function PXe(e,t){return or.createMulti("Dihedral",e,t,or.StateBuilder,wre)}var TXe=kt.BuiltIn({name:"box-shape-3d",display:"Box Shape",from:ge.Root,to:ge.Shape.Provider,params:{bottomLeft:I.Vec3(_()),topRight:I.Vec3(_.create(1,1,1)),radius:I.Numeric(.15,{min:.01,max:4,step:.01}),color:I.Color(fr.red)}})({canAutoUpdate:function(){return!0},apply:function(e){var t=this,r=e.params;return $e.create("Shape Representation",function(n){return ce(t,void 0,void 0,function(){return de(this,function(i){return[2,new ge.Shape.Provider({label:"Box",data:r,params:Ft.Params,getShape:function(a,o){var s=iF(Xt.create(r.bottomLeft,r.topRight),r.radius);return Fr.create("Box",o,s,function(){return o.color},function(){return 1},function(){return"Box"})},geometryUtils:Ft.Utils},{label:"Box"})]})})})}});function iF(e,t,r){var n=_.sub(_(),e.max,e.min),i=ue.fromTranslation(ue(),_.create(.5,.5,.5)),a=ue.fromScaling(ue(),n),o=ue.fromTranslation(ue(),e.min),s=ue.mul3(ue(),o,a,i),u=wt.createState(256,128,r);u.currentGroup=1,wt.addCage(u,s,wee(),t,2,20);var l=wt.getMesh(u),c=_.scaleAndAdd(_(),e.min,n,.5),d=_.distance(e.min,c);return l.setBoundingSphere(Be.create(c,d)),l}const IXe=Object.freeze(Object.defineProperty({__proto__:null,BoxShape3D:TXe,getBoxMesh:iF},Symbol.toStringTag,{value:"Module"}));var cw=kt.BuiltIn({name:"structure-representation-3d",display:"3D Representation",from:ge.Molecule.Structure,to:ge.Molecule.Structure.Representation3D,params:function(e,t){var r=t.representation.structure,n=r.registry,i=r.themes,a=n.get(n.default.name);if(!e){var o={help:function(l){var c=l.name,d=l.params,f=i.colorThemeRegistry.get(c),p=f.factory({},d);return{description:p.description,legend:p.legend}}};return{type:I.Mapped(n.default.name,n.types,function(l){return I.Group(n.get(l).getParams(i,We.Empty))}),colorTheme:I.Mapped(a.defaultColorTheme.name,i.colorThemeRegistry.types,function(l){return I.Group(i.colorThemeRegistry.get(l).getParams({structure:We.Empty}))},o),sizeTheme:I.Mapped(a.defaultSizeTheme.name,i.sizeThemeRegistry.types,function(l){return I.Group(i.sizeThemeRegistry.get(l).getParams({structure:We.Empty}))})}}var s={structure:e.data},u={help:function(l){var c=l.name,d=l.params,f=i.colorThemeRegistry.get(c),p=f.factory(s,d);return{description:p.description,legend:p.legend}}};return{type:I.Mapped(n.default.name,n.getApplicableTypes(e.data),function(l){return I.Group(n.get(l).getParams(i,e.data))}),colorTheme:I.Mapped(a.defaultColorTheme.name,i.colorThemeRegistry.getApplicableTypes(s),function(l){return I.Group(i.colorThemeRegistry.get(l).getParams(s))},u),sizeTheme:I.Mapped(a.defaultSizeTheme.name,i.sizeThemeRegistry.types,function(l){return I.Group(i.sizeThemeRegistry.get(l).getParams(s))})}}})({canAutoUpdate:function(e){var t=e.a,r=e.oldParams,n=e.newParams;return t.data.elementCount<1e4||r.type.name===n.type.name&&n.type.params.quality!=="custom"},apply:function(e,t){var r=this,n=e.a,i=e.params;return e.cache,$e.create("Structure Representation",function(a){return ce(r,void 0,void 0,function(){var o,s,u,l,c,d,f;return de(this,function(p){switch(p.label){case 0:return o={runtime:a,assetManager:t.managers.asset},s=t.representation.structure.registry.get(i.type.name),u=((d=s.getData)===null||d===void 0?void 0:d.call(s,n.data,i.type.params))||n.data,s.ensureCustomProperties?[4,s.ensureCustomProperties.attach(o,u)]:[3,2];case 1:p.sent(),p.label=2;case 2:return l=s.factory(E({webgl:(f=t.canvas3d)===null||f===void 0?void 0:f.webgl},t.representation.structure.themes),s.getParams),[4,yi.ensureDependencies(o,t.representation.structure.themes,{structure:u},i)];case 3:return p.sent(),l.setTheme(yi.create(t.representation.structure.themes,{structure:u},i)),c=i.type.params||{},[4,l.createOrUpdate(c,u).runInContext(a)];case 4:return p.sent(),[2,new ge.Molecule.Structure.Representation3D({repr:l,sourceData:n.data},{label:s.label})]}})})})},update:function(e,t){var r=this,n=e.a,i=e.b,a=e.oldParams,o=e.newParams;return e.cache,$e.create("Structure Representation",function(s){return ce(r,void 0,void 0,function(){var u,l,c,d,f,p;return de(this,function(v){switch(v.label){case 0:return o.type.name!==a.type.name?[2,ft.UpdateResult.Recreate]:(u=t.representation.structure.registry.get(o.type.name),!((f=u.mustRecreate)===null||f===void 0)&&f.call(u,a.type.params,o.type.params)?[2,ft.UpdateResult.Recreate]:(l=((p=u.getData)===null||p===void 0?void 0:p.call(u,n.data,o.type.params))||n.data,c={runtime:s,assetManager:t.managers.asset},u.ensureCustomProperties?[4,u.ensureCustomProperties.attach(c,l)]:[3,2]));case 1:v.sent(),v.label=2;case 2:return yi.releaseDependencies(t.representation.structure.themes,{structure:i.data.sourceData},a),[4,yi.ensureDependencies(c,t.representation.structure.themes,{structure:l},o)];case 3:return v.sent(),i.data.repr.setTheme(yi.create(t.representation.structure.themes,{structure:l},o)),d=E(E({},i.data.repr.props),o.type.params),[4,i.data.repr.createOrUpdate(d,l).runInContext(s)];case 4:return v.sent(),i.data.sourceData=n.data,[2,ft.UpdateResult.Updated]}})})})},dispose:function(e,t){var r=e.b,n=e.params;if(!(!r||!n)){var i=r.data.sourceData,a=t.representation.structure.registry.get(n.type.name);a.ensureCustomProperties&&a.ensureCustomProperties.detach(i),yi.releaseDependencies(t.representation.structure.themes,{structure:i},n)}},interpolate:function(e,t,r){if(e.colorTheme.name!=="uniform"||t.colorTheme.name!=="uniform")return r<=.5?e:t;var n=e.colorTheme.params.value,i=t.colorTheme.params.value,a=at.interpolate(n,i,r);return{type:r<=.5?e.type:t.type,colorTheme:{name:"uniform",params:{value:a}},sizeTheme:r<=.5?e.sizeTheme:t.sizeTheme}}}),MXe=kt.BuiltIn({name:"unwind-structure-assembly-representation-3d",display:"Unwind Assembly 3D Representation",from:ge.Molecule.Structure.Representation3D,to:ge.Molecule.Structure.Representation3DState,params:{t:I.Numeric(0,{min:0,max:1,step:.01})}})({canAutoUpdate:function(){return!0},apply:function(e){var t=e.a,r=e.params,n=t.data.sourceData,i=new Zg(n);return sV(n,i,r.t),new ge.Molecule.Structure.Representation3DState({state:{unitTransforms:i},initialState:{unitTransforms:new Zg(n)},info:n,repr:t.data.repr},{label:"Unwind T = "+r.t.toFixed(2)})},update:function(e){var t=e.a,r=e.b,n=e.newParams,i=e.oldParams,a=r.data.info;if(t.data.sourceData!==a||t.data.repr!==r.data.repr)return ft.UpdateResult.Recreate;if(i.t===n.t)return ft.UpdateResult.Unchanged;var o=r.data.state.unitTransforms;return sV(a,o,n.t),r.label="Unwind T = "+n.t.toFixed(2),r.data.repr=t.data.repr,ft.UpdateResult.Updated}}),DXe=kt.BuiltIn({name:"explode-structure-representation-3d",display:"Explode 3D Representation",from:ge.Molecule.Structure.Representation3D,to:ge.Molecule.Structure.Representation3DState,params:{t:I.Numeric(0,{min:0,max:1,step:.01})}})({canAutoUpdate:function(){return!0},apply:function(e){var t=e.a,r=e.params,n=t.data.sourceData,i=new Zg(n.root);return lV(n,i,r.t),new ge.Molecule.Structure.Representation3DState({state:{unitTransforms:i},initialState:{unitTransforms:new Zg(n.root)},info:n.root,repr:t.data.repr},{label:"Explode T = "+r.t.toFixed(2)})},update:function(e){var t=e.a,r=e.b,n=e.newParams,i=e.oldParams,a=t.data.sourceData;if(r.data.info!==a.root||t.data.repr!==r.data.repr)return ft.UpdateResult.Recreate;if(i.t===n.t)return ft.UpdateResult.Unchanged;var o=r.data.state.unitTransforms;return lV(a.root,o,n.t),r.label="Explode T = "+n.t.toFixed(2),r.data.repr=t.data.repr,ft.UpdateResult.Updated}}),RXe=kt.BuiltIn({name:"spin-structure-representation-3d",display:"Spin 3D Representation",from:ge.Molecule.Structure.Representation3D,to:ge.Molecule.Structure.Representation3DState,params:E({t:I.Numeric(0,{min:0,max:1,step:.01})},Z$e)})({canAutoUpdate:function(){return!0},apply:function(e){var t=e.a,r=e.params,n=t.data.sourceData,i=new Zg(n.root),a=cV(n.root,r),o=a.axis,s=a.origin;return pV(n,i,r.t,o,s),new ge.Molecule.Structure.Representation3DState({state:{unitTransforms:i},initialState:{unitTransforms:new Zg(n.root)},info:n.root,repr:t.data.repr},{label:"Spin T = "+r.t.toFixed(2)})},update:function(e){var t=e.a,r=e.b,n=e.newParams,i=e.oldParams,a=t.data.sourceData;if(r.data.info!==a.root||t.data.repr!==r.data.repr)return ft.UpdateResult.Recreate;if(i.t===n.t&&i.axis===n.axis&&i.origin===n.origin)return ft.UpdateResult.Unchanged;var o=r.data.state.unitTransforms,s=cV(a.root,n),u=s.axis,l=s.origin;return pV(a.root,o,n.t,u,l),r.label="Spin T = "+n.t.toFixed(2),r.data.repr=t.data.repr,ft.UpdateResult.Updated}}),kXe=kt.BuiltIn({name:"overpaint-structure-representation-3d-from-script",display:"Overpaint 3D Representation",from:ge.Molecule.Structure.Representation3D,to:ge.Molecule.Structure.Representation3DState,params:function(){return{layers:I.ObjectList({script:I.Script(Vi("(sel.atom.all)","mol-script")),color:I.Color(fr.blueviolet),clear:I.Boolean(!1)},function(e){return""+(e.clear?"Clear":at.toRgbString(e.color))},{defaultValue:[{script:Vi("(sel.atom.all)","mol-script"),color:fr.blueviolet,clear:!1}]})}}})({canAutoUpdate:function(){return!0},apply:function(e){var t=e.a,r=e.params,n=t.data.sourceData,i=qi.ofScript(r.layers,n);return new ge.Molecule.Structure.Representation3DState({state:{overpaint:i},initialState:{overpaint:qi.Empty},info:n,repr:t.data.repr},{label:"Overpaint ("+i.layers.length+" Layers)"})},update:function(e){var t=e.a,r=e.b,n=e.newParams;e.oldParams;var i=r.data.info,a=t.data.sourceData;if(a!==i||t.data.repr!==r.data.repr)return ft.UpdateResult.Recreate;var o=r.data.state.overpaint,s=qi.ofScript(n.layers,a);return qi.areEqual(o,s)?ft.UpdateResult.Unchanged:(r.data.state.overpaint=s,r.data.repr=t.data.repr,r.label="Overpaint ("+s.layers.length+" Layers)",ft.UpdateResult.Updated)}}),OXe=kt.BuiltIn({name:"overpaint-structure-representation-3d-from-bundle",display:"Overpaint 3D Representation",from:ge.Molecule.Structure.Representation3D,to:ge.Molecule.Structure.Representation3DState,params:function(){return{layers:I.ObjectList({bundle:I.Value(rn.Empty),color:I.Color(fr.blueviolet),clear:I.Boolean(!1)},function(e){return""+(e.clear?"Clear":at.toRgbString(e.color))},{defaultValue:[{bundle:rn.Empty,color:fr.blueviolet,clear:!1}],isHidden:!0})}}})({canAutoUpdate:function(){return!0},apply:function(e){var t=e.a,r=e.params,n=t.data.sourceData,i=qi.ofBundle(r.layers,n);return new ge.Molecule.Structure.Representation3DState({state:{overpaint:i},initialState:{overpaint:qi.Empty},info:n,repr:t.data.repr},{label:"Overpaint ("+i.layers.length+" Layers)"})},update:function(e){var t=e.a,r=e.b,n=e.newParams;e.oldParams;var i=r.data.info,a=t.data.sourceData;if(a!==i||t.data.repr!==r.data.repr)return ft.UpdateResult.Recreate;var o=r.data.state.overpaint,s=qi.ofBundle(n.layers,a);return qi.areEqual(o,s)?ft.UpdateResult.Unchanged:(r.data.state.overpaint=s,r.data.repr=t.data.repr,r.label="Overpaint ("+s.layers.length+" Layers)",ft.UpdateResult.Updated)}}),LXe=kt.BuiltIn({name:"transparency-structure-representation-3d-from-script",display:"Transparency 3D Representation",from:ge.Molecule.Structure.Representation3D,to:ge.Molecule.Structure.Representation3DState,params:function(){return{layers:I.ObjectList({script:I.Script(Vi("(sel.atom.all)","mol-script")),value:I.Numeric(.5,{min:0,max:1,step:.01},{label:"Transparency"})},function(e){return"Transparency ("+e.value+")"},{defaultValue:[{script:Vi("(sel.atom.all)","mol-script"),value:.5}]})}}})({canAutoUpdate:function(){return!0},apply:function(e){var t=e.a,r=e.params,n=t.data.sourceData,i=$i.ofScript(r.layers,n);return new ge.Molecule.Structure.Representation3DState({state:{transparency:i},initialState:{transparency:$i.Empty},info:n,repr:t.data.repr},{label:"Transparency ("+i.layers.length+" Layers)"})},update:function(e){var t=e.a,r=e.b,n=e.newParams;e.oldParams;var i=r.data.info;if(t.data.sourceData!==i||t.data.repr!==r.data.repr)return ft.UpdateResult.Recreate;var a=r.data.state.transparency,o=$i.ofScript(n.layers,i);return $i.areEqual(a,o)?ft.UpdateResult.Unchanged:(r.data.state.transparency=o,r.data.repr=t.data.repr,r.label="Transparency ("+o.layers.length+" Layers)",ft.UpdateResult.Updated)}}),FXe=kt.BuiltIn({name:"transparency-structure-representation-3d-from-bundle",display:"Transparency 3D Representation",from:ge.Molecule.Structure.Representation3D,to:ge.Molecule.Structure.Representation3DState,params:function(){return{layers:I.ObjectList({bundle:I.Value(rn.Empty),value:I.Numeric(.5,{min:0,max:1,step:.01},{label:"Transparency"})},function(e){return"Transparency ("+e.value+")"},{defaultValue:[{bundle:rn.Empty,value:.5}],isHidden:!0})}}})({canAutoUpdate:function(){return!0},apply:function(e){var t=e.a,r=e.params,n=t.data.sourceData,i=$i.ofBundle(r.layers,n);return new ge.Molecule.Structure.Representation3DState({state:{transparency:i},initialState:{transparency:$i.Empty},info:n,repr:t.data.repr},{label:"Transparency ("+i.layers.length+" Layers)"})},update:function(e){var t=e.a,r=e.b,n=e.newParams;e.oldParams;var i=r.data.info;if(t.data.sourceData!==i||t.data.repr!==r.data.repr)return ft.UpdateResult.Recreate;var a=r.data.state.transparency,o=$i.ofBundle(n.layers,i);return $i.areEqual(a,o)?ft.UpdateResult.Unchanged:(r.data.state.transparency=o,r.data.repr=t.data.repr,r.label="Transparency ("+o.layers.length+" Layers)",ft.UpdateResult.Updated)}}),NXe=kt.BuiltIn({name:"clipping-structure-representation-3d-from-script",display:"Clipping 3D Representation",from:ge.Molecule.Structure.Representation3D,to:ge.Molecule.Structure.Representation3DState,params:function(){return{layers:I.ObjectList({script:I.Script(Vi("(sel.atom.all)","mol-script")),groups:I.Converted(function(e){return on.Groups.toNames(e)},function(e){return on.Groups.fromNames(e)},I.MultiSelect(BE(on.Groups.Names),I.objectToOptions(on.Groups.Names)))},function(e){return on.Groups.toNames(e.groups).length+" group(s)"},{defaultValue:[{script:Vi("(sel.atom.all)","mol-script"),groups:0}]})}}})({canAutoUpdate:function(){return!0},apply:function(e){var t=e.a,r=e.params,n=t.data.sourceData,i=on.ofScript(r.layers,n);return new ge.Molecule.Structure.Representation3DState({state:{clipping:i},initialState:{clipping:on.Empty},info:n,repr:t.data.repr},{label:"Clipping ("+i.layers.length+" Layers)"})},update:function(e){var t=e.a,r=e.b,n=e.newParams;e.oldParams;var i=r.data.info;if(t.data.sourceData!==i||t.data.repr!==r.data.repr)return ft.UpdateResult.Recreate;var a=r.data.state.clipping,o=on.ofScript(n.layers,i);return on.areEqual(a,o)?ft.UpdateResult.Unchanged:(r.data.state.clipping=o,r.data.repr=t.data.repr,r.label="Clipping ("+o.layers.length+" Layers)",ft.UpdateResult.Updated)}}),BXe=kt.BuiltIn({name:"clipping-structure-representation-3d-from-bundle",display:"Clipping 3D Representation",from:ge.Molecule.Structure.Representation3D,to:ge.Molecule.Structure.Representation3DState,params:function(){return{layers:I.ObjectList({bundle:I.Value(rn.Empty),groups:I.Converted(function(e){return on.Groups.toNames(e)},function(e){return on.Groups.fromNames(e)},I.MultiSelect(BE(on.Groups.Names),I.objectToOptions(on.Groups.Names)))},function(e){return on.Groups.toNames(e.groups).length+" group(s)"},{defaultValue:[{bundle:rn.Empty,groups:0}],isHidden:!0})}}})({canAutoUpdate:function(){return!0},apply:function(e){var t=e.a,r=e.params,n=t.data.sourceData,i=on.ofBundle(r.layers,n);return new ge.Molecule.Structure.Representation3DState({state:{clipping:i},initialState:{clipping:on.Empty},info:n,repr:t.data.repr},{label:"Clipping ("+i.layers.length+" Layers)"})},update:function(e){var t=e.a,r=e.b,n=e.newParams;e.oldParams;var i=r.data.info;if(t.data.sourceData!==i||t.data.repr!==r.data.repr)return ft.UpdateResult.Recreate;var a=r.data.state.clipping,o=on.ofBundle(n.layers,i);return on.areEqual(a,o)?ft.UpdateResult.Unchanged:(r.data.state.clipping=o,r.data.repr=t.data.repr,r.label="Clipping ("+o.layers.length+" Layers)",ft.UpdateResult.Updated)}}),Bc;(function(e){function t(i,a,o,s){var u=i.representation.volume.registry.get(a),l={volume:o},c=i.representation.volume.themes.colorThemeRegistry.get(u.defaultColorTheme.name).getParams(l),d=i.representation.volume.themes.sizeThemeRegistry.get(u.defaultSizeTheme.name).getParams(l),f=I.getDefaultValues(u.getParams(i.representation.volume.themes,o));return{type:{name:a,params:s?E(E({},f),s):f},colorTheme:{name:u.defaultColorTheme.name,params:I.getDefaultValues(c)},sizeTheme:{name:u.defaultSizeTheme.name,params:I.getDefaultValues(d)}}}e.getDefaultParams=t;function r(i,a,o,s,u,l,c){var d=i.representation.volume.registry.get(a),f=i.representation.volume.themes.colorThemeRegistry.get(s||d.defaultColorTheme.name),p=i.representation.volume.themes.sizeThemeRegistry.get(l||d.defaultSizeTheme.name);return{type:{name:a,params:o?E(E({},d.defaultValues),o):d.defaultValues},colorTheme:{name:d.defaultColorTheme.name,params:u?E(E({},f.defaultValues),u):f.defaultValues},sizeTheme:{name:d.defaultSizeTheme.name,params:c?E(E({},p.defaultValues),c):p.defaultValues}}}e.getDefaultParamsStatic=r;function n(i){var a,o,s,u;if(i.isoValue)return Ct.IsoValue.toString(i.isoValue);if(!((o=(a=i.renderMode)===null||a===void 0?void 0:a.params)===null||o===void 0)&&o.isoValue)return Ct.IsoValue.toString((u=(s=i.renderMode)===null||s===void 0?void 0:s.params)===null||u===void 0?void 0:u.isoValue)}e.getDescription=n})(Bc||(Bc={}));var UXe=kt.BuiltIn({name:"volume-representation-3d",display:"3D Representation",from:ge.Volume.Data,to:ge.Volume.Representation3D,params:function(e,t){var r=t.representation.volume,n=r.registry,i=r.themes,a=n.get(n.default.name);if(!e)return{type:I.Mapped(n.default.name,n.types,function(s){return I.Group(n.get(s).getParams(i,Ct.One))}),colorTheme:I.Mapped(a.defaultColorTheme.name,i.colorThemeRegistry.types,function(s){return I.Group(i.colorThemeRegistry.get(s).getParams({volume:Ct.One}))}),sizeTheme:I.Mapped(a.defaultSizeTheme.name,i.sizeThemeRegistry.types,function(s){return I.Group(i.sizeThemeRegistry.get(s).getParams({volume:Ct.One}))})};var o={volume:e.data};return{type:I.Mapped(n.default.name,n.types,function(s){return I.Group(n.get(s).getParams(i,e.data))}),colorTheme:I.Mapped(a.defaultColorTheme.name,i.colorThemeRegistry.getApplicableTypes(o),function(s){return I.Group(i.colorThemeRegistry.get(s).getParams(o))}),sizeTheme:I.Mapped(a.defaultSizeTheme.name,i.sizeThemeRegistry.types,function(s){return I.Group(i.sizeThemeRegistry.get(s).getParams(o))})}}})({canAutoUpdate:function(e){var t=e.oldParams,r=e.newParams;return t.type.name===r.type.name},apply:function(e,t){var r=this,n=e.a,i=e.params;return $e.create("Volume Representation",function(a){return ce(r,void 0,void 0,function(){var o,s,u,l,c;return de(this,function(d){switch(d.label){case 0:return o={runtime:a,assetManager:t.managers.asset},s=t.representation.volume.registry.get(i.type.name),s.ensureCustomProperties?[4,s.ensureCustomProperties.attach(o,n.data)]:[3,2];case 1:d.sent(),d.label=2;case 2:return u=s.factory(E({webgl:(c=t.canvas3d)===null||c===void 0?void 0:c.webgl},t.representation.volume.themes),s.getParams),u.setTheme(yi.create(t.representation.volume.themes,{volume:n.data},i)),l=i.type.params||{},[4,u.createOrUpdate(l,n.data).runInContext(a)];case 3:return d.sent(),[2,new ge.Volume.Representation3D({repr:u,sourceData:n.data},{label:s.label,description:Bc.getDescription(l)})]}})})})},update:function(e,t){var r=this,n=e.a,i=e.b,a=e.oldParams,o=e.newParams;return $e.create("Volume Representation",function(s){return ce(r,void 0,void 0,function(){var u,l,c;return de(this,function(d){switch(d.label){case 0:return o.type.name!==a.type.name?(u=t.representation.volume.registry.get(a.type.name),(c=u.ensureCustomProperties)===null||c===void 0||c.detach(n.data),[2,ft.UpdateResult.Recreate]):(l=E(E({},i.data.repr.props),o.type.params),i.data.repr.setTheme(yi.create(t.representation.volume.themes,{volume:n.data},o)),[4,i.data.repr.createOrUpdate(l,n.data).runInContext(s)]);case 1:return d.sent(),i.data.sourceData=n.data,i.description=Bc.getDescription(l),[2,ft.UpdateResult.Updated]}})})})}}),jXe=kt.BuiltIn({name:"shape-representation-3d",display:"3D Representation",from:ge.Shape.Provider,to:ge.Shape.Representation3D,params:function(e,t){return e?e.data.params:Et.Params}})({canAutoUpdate:function(){return!0},apply:function(e,t){var r=this,n=e.a,i=e.params;return $e.create("Shape Representation",function(a){return ce(r,void 0,void 0,function(){var o,s;return de(this,function(u){switch(u.label){case 0:return o=E(E({},I.getDefaultValues(n.data.params)),i),s=ki(n.data.getShape,n.data.geometryUtils),[4,s.createOrUpdate(o,n.data.data).runInContext(a)];case 1:return u.sent(),[2,new ge.Shape.Representation3D({repr:s,sourceData:n.data},{label:n.data.label})]}})})})},update:function(e,t){var r=this,n=e.a,i=e.b;e.oldParams;var a=e.newParams;return $e.create("Shape Representation",function(o){return ce(r,void 0,void 0,function(){var s;return de(this,function(u){switch(u.label){case 0:return s=E(E({},i.data.repr.props),a),[4,i.data.repr.createOrUpdate(s,n.data.data).runInContext(o)];case 1:return u.sent(),i.data.sourceData=n.data,[2,ft.UpdateResult.Updated]}})})})}}),zXe=kt.BuiltIn({name:"model-unitcell-3d",display:"Model Unit Cell",from:ge.Molecule.Model,to:ge.Shape.Representation3D,params:function(){return E({},vV)}})({isApplicable:function(e){return!!fi.Provider.get(e.data)},canAutoUpdate:function(e){return e.oldParams,e.newParams,!0},apply:function(e,t){var r=this,n=e.a,i=e.params;return $e.create("Model Unit Cell",function(a){return ce(r,void 0,void 0,function(){var o,s,u,l;return de(this,function(c){switch(c.label){case 0:return o=fi.Provider.get(n.data),o?(s=mV(n.data,o,i),u=sWe(E({webgl:(l=t.canvas3d)===null||l===void 0?void 0:l.webgl},t.representation.structure.themes),function(){return vV}),[4,u.createOrUpdate(i,s).runInContext(a)]):[2,On.Null];case 1:return c.sent(),[2,new ge.Shape.Representation3D({repr:u,sourceData:s},{label:"Unit Cell",description:o.spacegroup.name})]}})})})},update:function(e){var t=this,r=e.a,n=e.b,i=e.newParams;return $e.create("Model Unit Cell",function(a){return ce(t,void 0,void 0,function(){var o,s,u;return de(this,function(l){switch(l.label){case 0:return o=fi.Provider.get(r.data),o?(s=E(E({},n.data.repr.props),i),u=mV(r.data,o,s),[4,n.data.repr.createOrUpdate(s,u).runInContext(a)]):[2,ft.UpdateResult.Null];case 1:return l.sent(),n.data.sourceData=u,[2,ft.UpdateResult.Updated]}})})})}}),VXe=kt.BuiltIn({name:"structure-bounding-box-3d",display:"Bounding Box",from:ge.Molecule.Structure,to:ge.Shape.Representation3D,params:E({radius:I.Numeric(.05,{min:.01,max:4,step:.01},{isEssential:!0}),color:I.Color(fr.red,{isEssential:!0})},Ft.Params)})({canAutoUpdate:function(){return!0},apply:function(e,t){var r=this,n=e.a,i=e.params;return $e.create("Bounding Box",function(a){return ce(r,void 0,void 0,function(){var o;return de(this,function(s){switch(s.label){case 0:return o=ki(function(u,l,c,d){var f=iF(l.box,l.radius,d==null?void 0:d.geometry);return Fr.create("Bouding Box",l,f,function(){return l.color},function(){return 1},function(){return"Bounding Box"})},Ft.Utils),[4,o.createOrUpdate(i,{box:n.data.boundary.box,radius:i.radius,color:i.color}).runInContext(a)];case 1:return s.sent(),[2,new ge.Shape.Representation3D({repr:o,sourceData:n.data},{label:"Bounding Box"})]}})})})},update:function(e,t){var r=this,n=e.a,i=e.b;e.oldParams;var a=e.newParams;return $e.create("Bounding Box",function(o){return ce(r,void 0,void 0,function(){return de(this,function(s){switch(s.label){case 0:return[4,i.data.repr.createOrUpdate(a,{box:n.data.boundary.box,radius:a.radius,color:a.color}).runInContext(o)];case 1:return s.sent(),i.data.sourceData=n.data,[2,ft.UpdateResult.Updated]}})})})}}),HXe=kt.BuiltIn({name:"structure-selections-distance-3d",display:"3D Distance",from:ge.Molecule.Structure.Selections,to:ge.Shape.Representation3D,params:function(){return E({},yV)}})({canAutoUpdate:function(e){return e.oldParams,e.newParams,!0},apply:function(e,t){var r=this,n=e.a,i=e.params;return $e.create("Structure Distance",function(a){return ce(r,void 0,void 0,function(){var o,s,u;return de(this,function(l){switch(l.label){case 0:return o=bV(n.data),s=xWe(E({webgl:(u=t.canvas3d)===null||u===void 0?void 0:u.webgl},t.representation.structure.themes),function(){return yV}),[4,s.createOrUpdate(i,o).runInContext(a)];case 1:return l.sent(),[2,new ge.Shape.Representation3D({repr:s,sourceData:o},{label:"Distance"})]}})})})},update:function(e,t){var r=this,n=e.a,i=e.b;e.oldParams;var a=e.newParams;return $e.create("Structure Distance",function(o){return ce(r,void 0,void 0,function(){var s,u;return de(this,function(l){switch(l.label){case 0:return s=E(E({},i.data.repr.props),a),u=bV(n.data),[4,i.data.repr.createOrUpdate(s,u).runInContext(o)];case 1:return l.sent(),i.data.sourceData=u,[2,ft.UpdateResult.Updated]}})})})}}),GXe=kt.BuiltIn({name:"structure-selections-angle-3d",display:"3D Angle",from:ge.Molecule.Structure.Selections,to:ge.Shape.Representation3D,params:function(){return E({},TV)}})({canAutoUpdate:function(e){return e.oldParams,e.newParams,!0},apply:function(e,t){var r=this,n=e.a,i=e.params;return $e.create("Structure Angle",function(a){return ce(r,void 0,void 0,function(){var o,s,u;return de(this,function(l){switch(l.label){case 0:return o=xV(n.data),s=oXe(E({webgl:(u=t.canvas3d)===null||u===void 0?void 0:u.webgl},t.representation.structure.themes),function(){return TV}),[4,s.createOrUpdate(i,o).runInContext(a)];case 1:return l.sent(),[2,new ge.Shape.Representation3D({repr:s,sourceData:o},{label:"Angle"})]}})})})},update:function(e,t){var r=this,n=e.a,i=e.b;e.oldParams;var a=e.newParams;return $e.create("Structure Angle",function(o){return ce(r,void 0,void 0,function(){var s,u;return de(this,function(l){switch(l.label){case 0:return s=E(E({},i.data.repr.props),a),u=xV(n.data),[4,i.data.repr.createOrUpdate(s,u).runInContext(o)];case 1:return l.sent(),i.data.sourceData=u,[2,ft.UpdateResult.Updated]}})})})}}),qXe=kt.BuiltIn({name:"structure-selections-dihedral-3d",display:"3D Dihedral",from:ge.Molecule.Structure.Selections,to:ge.Shape.Representation3D,params:function(){return E({},IV)}})({canAutoUpdate:function(e){return e.oldParams,e.newParams,!0},apply:function(e,t){var r=this,n=e.a,i=e.params;return $e.create("Structure Dihedral",function(a){return ce(r,void 0,void 0,function(){var o,s,u;return de(this,function(l){switch(l.label){case 0:return o=SV(n.data),s=PXe(E({webgl:(u=t.canvas3d)===null||u===void 0?void 0:u.webgl},t.representation.structure.themes),function(){return IV}),[4,s.createOrUpdate(i,o).runInContext(a)];case 1:return l.sent(),[2,new ge.Shape.Representation3D({repr:s,sourceData:o},{label:"Dihedral"})]}})})})},update:function(e,t){var r=this,n=e.a,i=e.b;e.oldParams;var a=e.newParams;return $e.create("Structure Dihedral",function(o){return ce(r,void 0,void 0,function(){var s,u;return de(this,function(l){switch(l.label){case 0:return s=E(E({},i.data.repr.props),a),u=SV(n.data),[4,i.data.repr.createOrUpdate(s,u).runInContext(o)];case 1:return l.sent(),i.data.sourceData=u,[2,ft.UpdateResult.Updated]}})})})}}),$Xe=kt.BuiltIn({name:"structure-selections-label-3d",display:"3D Label",from:ge.Molecule.Structure.Selections,to:ge.Shape.Representation3D,params:function(){return E({},wV)}})({canAutoUpdate:function(e){return e.oldParams,e.newParams,!0},apply:function(e,t){var r=this,n=e.a,i=e.params;return $e.create("Structure Label",function(a){return ce(r,void 0,void 0,function(){var o,s,u;return de(this,function(l){switch(l.label){case 0:return o=CV(n.data),s=AWe(E({webgl:(u=t.canvas3d)===null||u===void 0?void 0:u.webgl},t.representation.structure.themes),function(){return wV}),[4,s.createOrUpdate(i,o).runInContext(a)];case 1:return l.sent(),[2,new ge.Shape.Representation3D({repr:s,sourceData:o},{label:"Label"})]}})})})},update:function(e,t){var r=this,n=e.a,i=e.b;e.oldParams;var a=e.newParams;return $e.create("Structure Label",function(o){return ce(r,void 0,void 0,function(){var s,u;return de(this,function(l){switch(l.label){case 0:return s=E(E({},i.data.repr.props),a),u=CV(n.data),[4,i.data.repr.createOrUpdate(s,u).runInContext(o)];case 1:return l.sent(),i.data.sourceData=u,[2,ft.UpdateResult.Updated]}})})})}}),WXe=kt.BuiltIn({name:"structure-selections-orientation-3d",display:"3D Orientation",from:ge.Molecule.Structure.Selections,to:ge.Shape.Representation3D,params:function(){return E({},PV)}})({canAutoUpdate:function(e){return e.oldParams,e.newParams,!0},apply:function(e,t){var r=this,n=e.a,i=e.params;return $e.create("Structure Orientation",function(a){return ce(r,void 0,void 0,function(){var o,s,u;return de(this,function(l){switch(l.label){case 0:return o=_V(n.data),s=$We(E({webgl:(u=t.canvas3d)===null||u===void 0?void 0:u.webgl},t.representation.structure.themes),function(){return PV}),[4,s.createOrUpdate(i,o).runInContext(a)];case 1:return l.sent(),[2,new ge.Shape.Representation3D({repr:s,sourceData:o},{label:"Orientation"})]}})})})},update:function(e,t){var r=this,n=e.a,i=e.b;e.oldParams;var a=e.newParams;return $e.create("Structure Orientation",function(o){return ce(r,void 0,void 0,function(){var s,u;return de(this,function(l){switch(l.label){case 0:return s=E(E({},i.data.repr.props),a),u=_V(n.data),[4,i.data.repr.createOrUpdate(s,u).runInContext(o)];case 1:return l.sent(),i.data.sourceData=u,[2,ft.UpdateResult.Updated]}})})})}});const XXe=Object.freeze(Object.defineProperty({__proto__:null,ClippingStructureRepresentation3DFromBundle:BXe,ClippingStructureRepresentation3DFromScript:NXe,ExplodeStructureRepresentation3D:DXe,ModelUnitcell3D:zXe,OverpaintStructureRepresentation3DFromBundle:OXe,OverpaintStructureRepresentation3DFromScript:kXe,ShapeRepresentation3D:jXe,SpinStructureRepresentation3D:RXe,StructureBoundingBox3D:VXe,StructureRepresentation3D:cw,StructureSelectionsAngle3D:GXe,StructureSelectionsDihedral3D:qXe,StructureSelectionsDistance3D:HXe,StructureSelectionsLabel3D:$Xe,StructureSelectionsOrientation3D:WXe,TransparencyStructureRepresentation3DFromBundle:FXe,TransparencyStructureRepresentation3DFromScript:LXe,UnwindStructureAssemblyRepresentation3D:MXe,VolumeRepresentation3D:UXe,get VolumeRepresentation3DHelpers(){return Bc}},Symbol.toStringTag,{value:"Module"}));var rt={Data:R7e,Misc:O7e,Model:WGe,Volume:aqe,Representation:XXe,Shape:IXe},YXe={H:"Hydrogen",HE:"Helium",LI:"Lithium",BE:"Beryllium",B:"Boron",C:"Carbon",N:"Nitrogen",O:"Oxygen",F:"Fluorine",NE:"Neon",NA:"Sodium",MG:"Magnesium",AL:"Aluminum",SI:"Silicon",P:"Phosphorus",S:"Sulfur",CL:"Chlorine",AR:"Argon",K:"Potassium",CA:"Calcium",SC:"Scandium",TI:"Titanium",V:"Vanadium",CR:"Chromium",MN:"Manganese",FE:"Iron",CO:"Cobalt",NI:"Nickel",CU:"Copper",ZN:"Zinc",GA:"Gallium",GE:"Germanium",AS:"Arsenic",SE:"Selenium",BR:"Bromine",KR:"Krypton",RB:"Rubidium",SR:"Strontium",Y:"Yttrium",ZR:"Zirconium",NB:"Niobium",MO:"Molybdenum",TC:"Technetium",RU:"Ruthenium",RH:"Rhodium",PD:"Palladium",AG:"Silver",CD:"Cadmium",IN:"Indium",SN:"Tin",SB:"Antimony",TE:"Tellurium",I:"Iodine",XE:"Xenon",CS:"Cesium",BA:"Barium",LA:"Lanthanum",CE:"Cerium",PR:"Praseodymium",ND:"Neodymium",PM:"Promethium",SM:"Samarium",EU:"Europium",GD:"Gadolinium",TB:"Terbium",DY:"Dysprosium",HO:"Holmium",ER:"Erbium",TM:"Thulium",YB:"Ytterbium",LU:"Lutetium",HF:"Hafnium",TA:"Tantalum",W:"Wolfram",RE:"Rhenium",OS:"Osmium",IR:"Iridium",PT:"Platinum",AU:"Gold",HG:"Mercury",TL:"Thallium",PB:"Lead",BI:"Bismuth",PO:"Polonium",AT:"Astatine",RN:"Radon",FR:"Francium",RA:"Radium",AC:"Actinium",TH:"Thorium",PA:"Protactinium",U:"Uranium",NP:"Neptunium",PU:"Plutonium",AM:"Americium",CM:"Curium",BK:"Berkelium",CF:"Californium",ES:"Einsteinium",FM:"Fermium",MD:"Mendelevium",NO:"Nobelium",LR:"Lawrencium",RF:"Rutherfordium",DB:"Dubnium",SG:"Seaborgium",BH:"Bohrium",HS:"Hassium",MT:"Meitnerium",DS:"Darmstadtium",RG:"Roentgenium",CN:"Copernicium",NH:"Nihonium",FL:"Flerovium",MC:"Moscovium",LV:"Livermorium",TS:"Tennessine",OG:"Oganesson"},KXe=new Set(["LI","NA","K","RB","CS","FR"]);function QXe(e){return KXe.has(e)}var ZXe=new Set(["BE","MG","CA","SR","BA","RA"]);function JXe(e){return ZXe.has(e)}var eYe=new Set(["ZN","GA","CD","IN","SN","HG","TI","PB","BI","PO","CN"]);function tYe(e){return eYe.has(e)}var rYe=new Set(["F","CL","BR","I","AT"]);function nYe(e){return rYe.has(e)}function Are(e){var t=a2(e);return t>=21&&t<=29||t>=39&&t<=47||t>=72&&t<=79||t>=104&&t<=108}function iYe(e){var t=a2(e);return t>=57&&t<=71}function aYe(e){var t=a2(e);return t>=89&&t<=103}function oYe(e){return QXe(e)||JXe(e)||iYe(e)||aYe(e)||Are(e)||tYe(e)}var zr;(function(e){e.Type="Type",e.Structure="Structure Property",e.Atom="Atom Property",e.Bond="Bond Property",e.Residue="Residue Property",e.AminoAcid="Amino Acid",e.NucleicBase="Nucleic Base",e.Manipulate="Manipulate Selection",e.Validation="Validation",e.Misc="Miscellaneous",e.Internal="Internal"})(zr||(zr={}));function Vr(e,t,r){var n;r===void 0&&(r={});var i;return{label:e,expression:t,description:r.description||"",category:(n=r.category)!==null&&n!==void 0?n:zr.Misc,isHidden:!!r.isHidden,priority:r.priority||0,referencesCurrent:!!r.referencesCurrent,get query(){return i||(i=gv(t)),i},ensureCustomProperties:r.ensureCustomProperties,getSelection:function(a,o,s){return ce(this,void 0,void 0,function(){var u,l;return de(this,function(c){switch(c.label){case 0:return u=a.managers.structure.selection.getStructure(s),l=u?mt.Sequence(s,[u]):mt.Empty(s),r.ensureCustomProperties?[4,r.ensureCustomProperties({runtime:o,assetManager:a.managers.asset},s)]:[3,2];case 1:c.sent(),c.label=2;case 2:return i||(i=gv(t)),[2,i(new us(s,{currentSelection:l}))]}})})}}}var sYe=Vr("All",se.struct.generator.all(),{category:"",priority:1e3}),uYe=Vr("Current Selection",se.internal.generator.current(),{category:"",referencesCurrent:!0}),lYe=Vr("Polymer",se.struct.modifier.union([se.struct.generator.atomGroups({"entity-test":se.core.logic.and([se.core.rel.eq([se.ammp("entityType"),"polymer"]),se.core.str.match([se.re("(polypeptide|cyclic-pseudo-peptide|peptide-like|nucleotide|peptide nucleic acid)","i"),se.ammp("entitySubtype")])])})]),{category:zr.Type}),cYe=Vr("Trace",se.struct.modifier.union([se.struct.combinator.merge([se.struct.modifier.union([se.struct.generator.atomGroups({"entity-test":se.core.rel.eq([se.ammp("entityType"),"polymer"]),"chain-test":se.core.set.has([se.set("sphere","gaussian"),se.ammp("objectPrimitive")])})]),se.struct.modifier.union([se.struct.generator.atomGroups({"entity-test":se.core.rel.eq([se.ammp("entityType"),"polymer"]),"chain-test":se.core.rel.eq([se.ammp("objectPrimitive"),"atomistic"]),"atom-test":se.core.set.has([se.set("CA","P"),se.ammp("label_atom_id")])})])])]),{category:zr.Structure}),I0=se.core.logic.and([se.core.rel.eq([se.ammp("entityType"),"polymer"]),se.core.str.match([se.re("(polypeptide|cyclic-pseudo-peptide|peptide-like)","i"),se.ammp("entitySubtype")])]),YE=se.core.logic.and([se.core.rel.eq([se.ammp("entityType"),"polymer"]),se.core.str.match([se.re("(nucleotide|peptide nucleic acid)","i"),se.ammp("entitySubtype")])]),xv=se.core.str.match([se.re("non-polymer|(amino|carboxy) terminus|peptide-like","i"),se.ammp("chemCompType")]),dYe=Vr("Backbone",se.struct.modifier.union([se.struct.combinator.merge([se.struct.modifier.union([se.struct.generator.atomGroups({"entity-test":I0,"chain-test":se.core.rel.eq([se.ammp("objectPrimitive"),"atomistic"]),"residue-test":se.core.logic.not([xv]),"atom-test":se.core.set.has([se.set.apply(se,hi.toArray(ed)),se.ammp("label_atom_id")])})]),se.struct.modifier.union([se.struct.generator.atomGroups({"entity-test":YE,"chain-test":se.core.rel.eq([se.ammp("objectPrimitive"),"atomistic"]),"residue-test":se.core.logic.not([xv]),"atom-test":se.core.set.has([se.set.apply(se,hi.toArray(bE)),se.ammp("label_atom_id")])})])])]),{category:zr.Structure}),fYe=Vr("Sidechain",se.struct.modifier.union([se.struct.combinator.merge([se.struct.modifier.union([se.struct.generator.atomGroups({"entity-test":I0,"chain-test":se.core.rel.eq([se.ammp("objectPrimitive"),"atomistic"]),"residue-test":se.core.logic.not([xv]),"atom-test":se.core.logic.or([se.core.logic.not([se.core.set.has([se.set.apply(se,hi.toArray(ed)),se.ammp("label_atom_id")])])])})]),se.struct.modifier.union([se.struct.generator.atomGroups({"entity-test":YE,"chain-test":se.core.rel.eq([se.ammp("objectPrimitive"),"atomistic"]),"residue-test":se.core.logic.not([xv]),"atom-test":se.core.logic.or([se.core.logic.not([se.core.set.has([se.set.apply(se,hi.toArray(bE)),se.ammp("label_atom_id")])])])})])])]),{category:zr.Structure}),pYe=Vr("Sidechain with Trace",se.struct.modifier.union([se.struct.combinator.merge([se.struct.modifier.union([se.struct.generator.atomGroups({"entity-test":I0,"chain-test":se.core.rel.eq([se.ammp("objectPrimitive"),"atomistic"]),"residue-test":se.core.logic.not([xv]),"atom-test":se.core.logic.or([se.core.logic.not([se.core.set.has([se.set.apply(se,hi.toArray(ed)),se.ammp("label_atom_id")])]),se.core.rel.eq([se.ammp("label_atom_id"),"CA"]),se.core.logic.and([se.core.rel.eq([se.ammp("auth_comp_id"),"PRO"]),se.core.rel.eq([se.ammp("label_atom_id"),"N"])])])})]),se.struct.modifier.union([se.struct.generator.atomGroups({"entity-test":YE,"chain-test":se.core.rel.eq([se.ammp("objectPrimitive"),"atomistic"]),"residue-test":se.core.logic.not([xv]),"atom-test":se.core.logic.or([se.core.logic.not([se.core.set.has([se.set.apply(se,hi.toArray(bE)),se.ammp("label_atom_id")])]),se.core.rel.eq([se.ammp("label_atom_id"),"P"])])})])])]),{category:zr.Structure}),hYe=Vr("Protein",se.struct.modifier.union([se.struct.generator.atomGroups({"entity-test":I0})]),{category:zr.Type}),vYe=Vr("Nucleic",se.struct.modifier.union([se.struct.generator.atomGroups({"entity-test":YE})]),{category:zr.Type}),mYe=Vr("Helix",se.struct.modifier.union([se.struct.generator.atomGroups({"entity-test":I0,"residue-test":se.core.flags.hasAny([se.ammp("secondaryStructureFlags"),se.core.type.bitflags([2])])})]),{category:zr.Structure}),gYe=Vr("Beta Strand/Sheet",se.struct.modifier.union([se.struct.generator.atomGroups({"entity-test":I0,"residue-test":se.core.flags.hasAny([se.ammp("secondaryStructureFlags"),se.core.type.bitflags([4])])})]),{category:zr.Structure}),yYe=Vr("Water",se.struct.modifier.union([se.struct.generator.atomGroups({"entity-test":se.core.rel.eq([se.ammp("entityType"),"water"])})]),{category:zr.Type}),bYe=Vr("Ion",se.struct.modifier.union([se.struct.generator.atomGroups({"entity-test":se.core.rel.eq([se.ammp("entitySubtype"),"ion"])})]),{category:zr.Type}),xYe=Vr("Lipid",se.struct.modifier.union([se.struct.generator.atomGroups({"entity-test":se.core.rel.eq([se.ammp("entitySubtype"),"lipid"])})]),{category:zr.Type}),KE=Vr("Carbohydrate",se.struct.modifier.union([se.struct.generator.atomGroups({"entity-test":se.core.logic.or([se.core.rel.eq([se.ammp("entityType"),"branched"]),se.core.logic.and([se.core.rel.eq([se.ammp("entityType"),"non-polymer"]),se.core.str.match([se.re("oligosaccharide","i"),se.ammp("entitySubtype")])])])})]),{category:zr.Type}),Pre=Vr("Carbohydrate with Connected",se.struct.modifier.union([se.struct.modifier.includeConnected({0:KE.expression,"layer-count":1,"as-whole-residues":!0})]),{category:zr.Internal,isHidden:!0}),Tre=Vr("Connected to Carbohydrate",se.struct.modifier.union([se.struct.modifier.exceptBy({0:Pre.expression,by:KE.expression})]),{category:zr.Internal,isHidden:!0}),aF=Vr("Ligand",se.struct.modifier.union([se.struct.combinator.merge([se.struct.modifier.union([se.struct.generator.atomGroups({"entity-test":se.core.logic.and([se.core.logic.or([se.core.rel.eq([se.ammp("entityType"),"non-polymer"]),se.core.rel.neq([se.ammp("entityPrdId"),""])]),se.core.logic.not([se.core.str.match([se.re("(oligosaccharide|lipid|ion)","i"),se.ammp("entitySubtype")])])]),"chain-test":se.core.rel.eq([se.ammp("objectPrimitive"),"atomistic"]),"residue-test":se.core.logic.not([se.core.str.match([se.re("saccharide","i"),se.ammp("chemCompType")])])})]),se.struct.modifier.union([se.struct.generator.atomGroups({"entity-test":se.core.rel.eq([se.ammp("entityType"),"polymer"]),"chain-test":se.core.rel.eq([se.ammp("objectPrimitive"),"atomistic"]),"residue-test":xv})])])]),{category:zr.Type}),Ire=Vr("Ligand with Connected",se.struct.modifier.union([se.struct.modifier.exceptBy({0:se.struct.modifier.union([se.struct.modifier.includeConnected({0:aF.expression,"layer-count":1,"as-whole-residues":!0,"bond-test":se.core.flags.hasAny([se.struct.bondProperty.flags(),se.core.type.bitflags([3])])})]),by:KE.expression})]),{category:zr.Internal,isHidden:!0}),Mre=Vr("Connected to Ligand",se.struct.modifier.union([se.struct.modifier.exceptBy({0:Ire.expression,by:aF.expression})]),{category:zr.Internal,isHidden:!0}),SYe=Vr("Connected to Ligand or Carbohydrate",se.struct.modifier.union([se.struct.combinator.merge([Tre.expression,Mre.expression])]),{category:zr.Internal,isHidden:!0}),CYe=Vr("Disulfide Bridges",se.struct.modifier.union([se.struct.combinator.merge([se.struct.modifier.union([se.struct.modifier.wholeResidues([se.struct.filter.isConnectedTo({0:se.struct.generator.atomGroups({"residue-test":se.core.set.has([se.set("CYS"),se.ammp("auth_comp_id")]),"atom-test":se.core.set.has([se.set("SG"),se.ammp("label_atom_id")])}),target:se.struct.generator.atomGroups({"residue-test":se.core.set.has([se.set("CYS"),se.ammp("auth_comp_id")]),"atom-test":se.core.set.has([se.set("SG"),se.ammp("label_atom_id")])}),"bond-test":!0})])]),se.struct.modifier.union([se.struct.modifier.wholeResidues([se.struct.modifier.union([se.struct.generator.bondedAtomicPairs({0:se.core.flags.hasAny([se.struct.bondProperty.flags(),se.core.type.bitflags([8])])})])])])])]),{category:zr.Bond}),_Ye=Vr("NOS Bridges",se.struct.modifier.union([se.struct.modifier.wholeResidues([se.struct.filter.isConnectedTo({0:se.struct.generator.atomGroups({"residue-test":se.core.set.has([se.set("CSO","LYS"),se.ammp("auth_comp_id")]),"atom-test":se.core.set.has([se.set("OD","NZ"),se.ammp("label_atom_id")])}),target:se.struct.generator.atomGroups({"residue-test":se.core.set.has([se.set("CSO","LYS"),se.ammp("auth_comp_id")]),"atom-test":se.core.set.has([se.set("OD","NZ"),se.ammp("label_atom_id")])}),"bond-test":!0})])]),{category:zr.Bond}),wYe=Vr("Non-standard Residues in Polymers",se.struct.modifier.union([se.struct.generator.atomGroups({"entity-test":se.core.rel.eq([se.ammp("entityType"),"polymer"]),"chain-test":se.core.rel.eq([se.ammp("objectPrimitive"),"atomistic"]),"residue-test":se.ammp("isNonStandard")})]),{category:zr.Residue}),EYe=Vr("Coarse Elements",se.struct.modifier.union([se.struct.generator.atomGroups({"chain-test":se.core.set.has([se.set("sphere","gaussian"),se.ammp("objectPrimitive")])})]),{category:zr.Type}),AYe=Vr("Rings in Residues",se.struct.modifier.union([se.struct.generator.rings()]),{category:zr.Residue}),PYe=Vr("Aromatic Rings in Residues",se.struct.modifier.union([se.struct.generator.rings({"only-aromatic":!0})]),{category:zr.Residue}),TYe=Vr("Surrounding Residues (5 ) of Selection",se.struct.modifier.union([se.struct.modifier.exceptBy({0:se.struct.modifier.includeSurroundings({0:se.internal.generator.current(),radius:5,"as-whole-residues":!0}),by:se.internal.generator.current()})]),{description:"Select residues within 5  of the current selection.",category:zr.Manipulate,referencesCurrent:!0}),IYe=Vr("Surrounding Ligands (5 ) of Selection",se.struct.modifier.union([se.struct.modifier.surroundingLigands({0:se.internal.generator.current(),radius:5,"include-water":!0})]),{description:"Select ligand components within 5  of the current selection.",category:zr.Manipulate,referencesCurrent:!0}),MYe=Vr("Inverse / Complement of Selection",se.struct.modifier.union([se.struct.modifier.exceptBy({0:se.struct.generator.all(),by:se.internal.generator.current()})]),{description:"Select everything not in the current selection.",category:zr.Manipulate,referencesCurrent:!0}),DYe=Vr("Residues Covalently Bonded to Selection",se.struct.modifier.union([se.struct.modifier.includeConnected({0:se.internal.generator.current(),"layer-count":1,"as-whole-residues":!0})]),{description:"Select residues covalently bonded to current selection.",category:zr.Manipulate,referencesCurrent:!0}),RYe=Vr("Covalently Bonded Component",se.struct.modifier.union([se.struct.modifier.includeConnected({0:se.internal.generator.current(),"fixed-point":!0})]),{description:"Select covalently bonded component based on current selection.",category:zr.Manipulate,referencesCurrent:!0}),kYe=Vr("Residues with Cov. or Metallic Bond to Selection",se.struct.modifier.union([se.struct.modifier.includeConnected({0:se.internal.generator.current(),"layer-count":1,"as-whole-residues":!0,"bond-test":se.core.flags.hasAny([se.struct.bondProperty.flags(),se.core.type.bitflags([3])])})]),{description:"Select residues with covalent or metallic bond to current selection.",category:zr.Manipulate,referencesCurrent:!0}),OYe=Vr("Whole Residues of Selection",se.struct.modifier.union([se.struct.modifier.wholeResidues({0:se.internal.generator.current()})]),{description:"Expand current selection to whole residues.",category:zr.Manipulate,referencesCurrent:!0}),LYe=[[["HIS"],"Histidine"],[["ARG"],"Arginine"],[["LYS"],"Lysine"],[["ILE"],"Isoleucine"],[["PHE"],"Phenylalanine"],[["LEU"],"Leucine"],[["TRP"],"Tryptophan"],[["ALA"],"Alanine"],[["MET"],"Methionine"],[["PRO"],"Proline"],[["CYS"],"Cysteine"],[["ASN"],"Asparagine"],[["VAL"],"Valine"],[["GLY"],"Glycine"],[["SER"],"Serine"],[["GLN"],"Glutamine"],[["TYR"],"Tyrosine"],[["ASP"],"Aspartic Acid"],[["GLU"],"Glutamic Acid"],[["THR"],"Threonine"],[["SEC"],"Selenocysteine"],[["PYL"],"Pyrrolysine"],[["UNK"],"Unknown"]].sort(function(e,t){return e[1]<t[1]?-1:e[1]>t[1]?1:0}),FYe=[[["A","DA"],"Adenosine"],[["C","DC"],"Cytidine"],[["T","DT"],"Thymidine"],[["G","DG"],"Guanosine"],[["I","DI"],"Inosine"],[["U","DU"],"Uridine"],[["N","DN"],"Unknown"]].sort(function(e,t){return e[1]<t[1]?-1:e[1]>t[1]?1:0});function QD(e,t,r){var n=e[0],i=e[1];r===void 0&&(r=0);var a=n.length===1&&!Dre.has(n[0])?"["+n[0]+"] "+i:i+" ("+n.join(", ")+")";return Vr(a,se.struct.modifier.union([se.struct.generator.atomGroups({"residue-test":se.core.set.has([se.set.apply(se,n),se.ammp("auth_comp_id")])})]),{category:t,priority:r,description:a})}function NYe(e,t,r){var n=e[0],i=e[1],a=i+" ("+n.join(", ")+")";return Vr(a,se.struct.modifier.union([se.struct.generator.atomGroups({"atom-test":se.core.set.has([se.set.apply(se,n),se.acp("elementSymbol")])})]),{category:t,priority:r,description:a})}function BYe(e,t,r){var n=e[0],i=e[1],a=""+i;return Vr(""+i,se.struct.modifier.union([se.struct.generator.atomGroups({"entity-test":se.core.list.equal([se.list.apply(se,n),se.ammp("entityDescription")])})]),{category:t,priority:r,description:a})}var Dre=hi.unionMany(wL,CE,_E,xE);function UYe(e){for(var t=new Set,r=0,n=e;r<n.length;r++){var i=n[r];i.uniqueElementSymbols.forEach(function(o){return t.add(o)})}var a=[];return t.forEach(function(o){var s=YXe[o]||o;a.push(NYe([[o],s],"Element Symbol",0))}),a}function jYe(e){for(var t=new Map,r=new Set,n=0,i=e;n<i.length;n++){var a=i[n];a.uniqueResidueNames.forEach(function(d){return r.add(d)});for(var o=function(d){a.uniqueResidueNames.forEach(function(f){var p=d.properties.chemicalComponentMap.get(f);p&&t.set(f,p.name)})},s=0,u=a.models;s<u.length;s++){var l=u[s];o(l)}}var c=[];return hi.difference(r,Dre).forEach(function(d){var f=t.get(d)||d;c.push(QD([[d],f],"Ligand/Non-standard Residue",200))}),c}function zYe(e){for(var t=new Map,r=Ze.create(),n=0,i=e;n<i.length;n++){var a=i[n];r.structure=a;for(var o=0,s=a.unitSymmetryGroups;o<s.length;o++){var u=s[o];r.unit=u.units[0],r.element=u.elements[0];var l=lt.entity.type(r);if(l==="polymer"||l==="branched"){var c=lt.entity.pdbx_description(r);t.set(c.join(", "),c)}}}var d=[];return t.forEach(function(f,p){d.push(BYe([f,p],"Polymer/Carbohydrate Entities",300))}),d}var mi={all:sYe,current:uYe,polymer:lYe,trace:cYe,backbone:dYe,sidechain:fYe,sidechainWithTrace:pYe,protein:hYe,nucleic:vYe,helix:mYe,beta:gYe,water:yYe,ion:bYe,lipid:xYe,branched:KE,branchedPlusConnected:Pre,branchedConnectedOnly:Tre,ligand:aF,ligandPlusConnected:Ire,ligandConnectedOnly:Mre,connectedOnly:SYe,disulfideBridges:CYe,nosBridges:_Ye,nonStandardPolymer:wYe,coarse:EYe,ring:AYe,aromaticRing:PYe,surroundings:TYe,surroundingLigands:IYe,complement:MYe,covalentlyBonded:DYe,covalentlyOrMetallicBonded:kYe,covalentlyBondedComponent:RYe,wholeResidues:OYe},VYe=function(){function e(){var t,r;this.list=[],this.options=[],this.version=1,(t=this.list).push.apply(t,Nt(Nt(Nt([],Object.values(mi)),LYe.map(function(n){return QD(n,zr.AminoAcid)})),FYe.map(function(n){return QD(n,zr.NucleicBase)}))),(r=this.options).push.apply(r,this.list.map(function(n){return[n,n.label,n.category]}))}return e.prototype.add=function(t){this.list.push(t),this.options.push([t,t.label,t.category]),this.version+=1},e.prototype.remove=function(t){var r=this.list.indexOf(t);r!==-1&&(this.list.splice(r,1),this.options.splice(r,1),this.version+=1)},e}(),HYe=function(){function e(t,r){this.key=t,this.defaultValue=r}return e.prototype.toString=function(){return this.key},e.prototype.valueOf=function(){return this.key},e}();function oi(e,t){return new HYe(e,t)}var Yr={item:oi,General:{IsBusyTimeoutMs:oi("plugin-config.is-busy-timeout",750),DisableAntialiasing:oi("plugin-config.disable-antialiasing",!1),DisablePreserveDrawingBuffer:oi("plugin-config.disable-preserve-drawing-buffer",!1),PixelScale:oi("plugin-config.pixel-scale",1),PickScale:oi("plugin-config.pick-scale",.25),EnableWboit:oi("plugin-config.enable-wboit",!0)},State:{DefaultServer:oi("plugin-state.server","https://webchem.ncbr.muni.cz/molstar-state"),CurrentServer:oi("plugin-state.server","https://webchem.ncbr.muni.cz/molstar-state"),HistoryCapacity:oi("history-capacity.server",5)},VolumeStreaming:{Enabled:oi("volume-streaming.enabled",!0),DefaultServer:oi("volume-streaming.server","https://ds.litemol.org"),CanStream:oi("volume-streaming.can-stream",function(e,t){return e.models.length===1&&$t.probablyHasDensityMap(e.models[0])}),EmdbHeaderServer:oi("volume-streaming.emdb-header-server","https://ftp.wwpdb.org/pub/emdb/structures")},Viewport:{ShowExpand:oi("viewer.show-expand-button",!0),ShowControls:oi("viewer.show-controls-button",!0),ShowSettings:oi("viewer.show-settings-button",!0),ShowSelectionMode:oi("viewer.show-selection-model-button",!0),ShowAnimation:oi("viewer.show-animation-button",!0)},Download:{DefaultPdbProvider:oi("download.default-pdb-provider","pdbe"),DefaultEmdbProvider:oi("download.default-emdb-provider","pdbe")},Structure:{SizeThresholds:oi("structure.size-thresholds",We.DefaultSizeThresholds),DefaultRepresentationPresetParams:oi("structure.default-representation-preset-params",{})}},GYe=function(){function e(t){var r=this;this._config=new Map,t&&t.forEach(function(n){var i=n[0],a=n[1];return r._config.set(i,a)})}return e.prototype.get=function(t){return this._config.has(t)?this._config.get(t):t.defaultValue},e.prototype.set=function(t,r){this._config.set(t,r)},e.prototype.delete=function(t){this._config.delete(t)},e}();function Ru(e,t,r,n){var i=0,a=t.webgl,o=new ri,s=Dd(),u=[],l=Ui.create(),c,d,f,p,v=yi.createEmpty();function h(x,C){var w=this;return x===void 0&&(x={}),C&&C!==d&&(f=r(t,C),d=C,p||(p=I.getDefaultValues(f))),p=Object.assign({},p,x),$e.create("Creating or updating ComplexRepresentation",function(A){return ce(w,void 0,void 0,function(){var M,D,k;return de(this,function(R){switch(R.label){case 0:return M=!1,c?!((k=c.mustRecreate)===null||k===void 0)&&k.call(c,d,p,a)&&(c.destroy(),c=n(s,d,p,a),M=!0):(c=n(s,d,p,a),M=!0),D=c.createOrUpdate({webgl:a,runtime:A},v,p,C),D?[4,D]:[3,2];case 1:R.sent(),R.label=2;case 2:return M&&y(l),u.length=0,c&&c.renderObject&&u.push(c.renderObject),o.next(i++),[2]}})})})}function m(x){return x===void 0?We.Loci(d.target):c?c.getLoci(x):Nr}function g(x,C){if(!d||!Do.is(l.markerActions,C))return!1;if(We.isLoci(x)||Re.is(x)||Vt.isLoci(x)){if(!We.areRootsEquivalent(x.structure,d))return!1;x=ar.remap(x,d)}else if(!Hs(x)&&!w1(x))return!1;return ar.isEmpty(x)?!1:c?c.mark(x,C):!1}function y(x){if(Ui.update(l,x),x.visible!==void 0&&c&&c.setVisibility(x.visible&&(l.unitTransforms===null||l.unitTransforms.isIdentity)),x.alphaFactor!==void 0&&c&&c.setAlphaFactor(x.alphaFactor),x.pickable!==void 0&&c&&c.setPickable(x.pickable),x.overpaint!==void 0&&c){var C=qi.remap(x.overpaint,d);c.setOverpaint(C)}if(x.transparency!==void 0&&c){var w=$i.remap(x.transparency,d);c.setTransparency(w)}if(x.clipping!==void 0&&c){var A=on.remap(x.clipping,d);c.setClipping(A)}x.transform!==void 0&&c&&c.setTransform(x.transform),x.unitTransforms!==void 0&&c&&c.setVisibility(l.visible&&(x.unitTransforms===null||x.unitTransforms.isIdentity))}function b(x){v=x}function S(){c&&c.destroy()}return{label:e,get groupCount(){return c?c.groupCount:0},get props(){return p},get params(){return f},get state(){return l},get theme(){return v},renderObjects:u,updated:o,createOrUpdate:h,setState:y,setTheme:b,getLoci:m,mark:g,destroy:S}}function Rre(e,t,r){var n=t.elements,i=t.model;if(Le.indexOf(n,r)!==-1){for(var a=i.atomicHierarchy.residueAtomSegments,o=a.index,s=a.offsets,u=o[r],l=[],c=s[u],d=s[u+1];c<d;++c){var f=Le.indexOf(n,c);f!==-1&&l.push(f)}var p=Le.ofSortedArray(Je.ofSortedArray(l));return Re(e,[{unit:t,indices:p}])}return Nr}function qYe(e,t,r){var n=t.elements,i=t.model,a=i.atomicHierarchy.atoms.label_alt_id,o=a.value(r);if(Le.indexOf(n,r)!==-1){var s=i.atomicHierarchy.residueAtomSegments.index,u=s[r];return kb(e,t,u,o)}return Re(e,[])}function kb(e,t,r,n){for(var i=t.elements,a=t.model,o=a.atomicHierarchy.atoms.label_alt_id,s=a.atomicHierarchy.residueAtomSegments.offsets,u=[],l=s[r],c=s[r+1];l<c;++l){var d=Le.indexOf(i,l);if(d!==-1){var f=o.value(l);(n===f||f==="")&&u.push(d)}}var p=Le.ofSortedArray(Je.ofSortedArray(u));return Re(e,[{unit:t,indices:p}])}function kre(e,t,r){for(var n=e.structure.child,i=t&&n?e.group.units.filter(function(l){return n.unitMap.has(l.id)}):e.group.units,a=i.length,o=a*16,s=r&&r.aTransform.ref.value.length>=o?r.aTransform.ref.value:new Float32Array(o),u=0;u<a;u++)ue.toArray(i[u].conformation.operator.matrix,s,u*16);return yL(s,a,r)}var $Ye={atomic:{},spheres:{},gaussians:{}},WYe=I.objectToOptions($Ye);function XYe(e,t){for(var r=0,n=e.length;r<n;++r)if(je.isAtomic(t)&&e[r]==="atomic"||je.isSpheres(t)&&e[r]==="spheres"||je.isGaussians(t)&&e[r]==="gaussians")return!0;return!1}var Ore=5e8;function Lre(e,t,r){r===void 0&&(r=Ore);var n=Xt.size(_(),e);_.ceil(n,n),n.sort(function(s,u){return u-s});var i=Math.floor(Math.cbrt(r)*Math.cbrt(r)),a=n[0]*n[1],o=Math.ceil(a/(t*t));return{area:a,areaCells:o,maxAreaCells:i}}function jv(e,t,r){r===void 0&&(r=Ore);var n=Lre(e,t.resolution,r),i=n.area,a=n.areaCells,o=n.maxAreaCells,s=a>o?Math.sqrt(i/o):t.resolution;return E(E({},t),{resolution:s})}function YYe(e){switch(e.kind){case 0:return e.model.atomicConformation;case 1:return e.model.coarseConformation.spheres;case 2:return e.model.coarseConformation.gaussians}}var QE={ignoreHydrogens:I.Boolean(!1,{description:"Whether or not to include hydrogen atoms in the surface calculation."}),traceOnly:I.Boolean(!1,{description:"Whether or not to only use trace atoms in the surface calculation."}),includeParent:I.Boolean(!1,{description:"Include elements of the parent structure in surface calculation to get a surface patch of the current structure."})};I.getDefaultValues(QE);var KYe=_();function QYe(e,t,r,n){return _.squaredDistance(_.set(KYe,e,t,r),n)}function ZYe(e,t,r){for(var n=0,i=t.length,a=0,o=r.length;a<o;++a){var s=Je.indexOfInRange(t,r[a],n,i);s===-1?e[a]=-2:(e[a]=s,n=s)}}function ZE(e,t,r){var n=r.ignoreHydrogens,i=r.traceOnly,a=r.includeParent,o=a?e.root.unitMap.get(t.id):t,s=YYe(o),u=s.x,l=s.y,c=s.z,d=o.elements,f=t.boundary.sphere,p=f.center,v=f.radius,h=(2+1.5)*2,m=(v+h)*(v+h),g,y;if(n||i||a&&o!==t){for(var b=[],S=[],x=0,C=d.length;x<C;++x){var w=d[x];n&&dw(o,w)||i&&!sF(o,w)||a&&QYe(u[w],l[w],c[w],p)>m||(b.push(w),S.push(x))}g=Je.ofSortedArray(b),y=S}else g=d,y=Ys(new Int32Array(g.length));a&&o!==t&&ZYe(y,t.elements,g);var A={indices:g,x:u,y:l,z:c,id:y},M=t===o?t.boundary:Xg(A),D=Ze.create(e,o),k=d2({},{scale:1}),R=function(O){return D.element=O,k.size(D)};return{position:A,boundary:M,radius:R}}function oF(e,t,r){var n=Ze.create(e),i=d2({},{scale:1}),a,o,s,u,l;if(t||r){for(var c=[],d=[],f=[],p=[],v=[],h=0,m=0,g=e.units.length;h<g;++h){var y=e.units[h],b=y.elements,S=y.conformation,x=S.x,C=S.y,w=S.z;n.unit=y;for(var A=0,M=b.length;A<M;++A){var D=b[A];t&&dw(y,D)||r&&!sF(y,D)||(c.push(x(D)),d.push(C(D)),f.push(w(D)),n.element=D,p.push(i.size(n)),v.push(m+A))}m+=b.length}a=c,o=d,s=f,u=p,l=v}else{for(var k=e.elementCount,c=new Float32Array(k),d=new Float32Array(k),f=new Float32Array(k),p=new Float32Array(k),h=0,m=0,g=e.units.length;h<g;++h){var y=e.units[h],b=y.elements,R=y.conformation,x=R.x,C=R.y,w=R.z;n.unit=y;for(var A=0,M=b.length;A<M;++A){var D=b[A],O=m+A;c[O]=x(D),d[O]=C(D),f[O]=w(D),n.element=D,p[O]=i.size(n)}m+=b.length}a=c,o=d,s=f,u=p,l=Ys(new Uint32Array(k))}var H={indices:Le.ofRange(0,l.length),x:a,y:o,z:s,id:l},B=function(j){return u[j]};return{position:H,radius:B}}var Fre=yE.H;function dw(e,t){return je.isCoarse(e)?!1:e.model.atomicHierarchy.derived.atom.atomicNumber[t]===Fre}function fw(e,t){return e[t]===Fre}function sF(e,t){if(je.isCoarse(e))return!0;var r=e.model.atomicHierarchy.atoms.label_atom_id.value(t);return r==="CA"||r==="BB"||r==="P"}function M0(e){if(je.isAtomic(e))return 4;for(var t=0,r=e.elements,n=e.conformation.r,i=0,a=r.length;i<a;i++){var o=n(r[i]);o>t&&(t=o)}return t+1}function JE(e){for(var t=0,r=0,n=e.unitSymmetryGroups;r<n.length;r++){var i=n[r],a=M0(i.units[0]);a>t&&(t=a)}return t}function f2(e){return I.MultiSelect(e,WYe,{description:"For which kinds of units/chains to show the representation visuals."})}var Ro={unitKinds:f2(["atomic","spheres"]),includeParent:I.Boolean(!1,{isHidden:!0})},Nre=E({},Ft.Params),JYe=E({},gp.Params),Bre=E({},Jo.Params),eKe=E({},bv.Params),Ure=E({},wn.Params),jre=E({},Ks.Params),zre=E({},io.Params),Vre=E({},Hu.Params);function tKe(e,t,r,n,i,a){var o=la.getUtils(t),s=o.createValues,u=o.createRenderableState,l=xL(),c=s(t,l,r,n,i),d=u(i);return P0(t.kind,c,d,a)}function D0(e,t){var r=e.defaultProps,n=e.createGeometry,i=e.createLocationIterator,a=e.getLoci,o=e.eachLocation,s=e.setUpdateState,u=e.mustRecreate,l=e.processValues,c=e.dispose,d=e.geometryUtils,f=d.updateValues,p=d.updateBoundingSphere,v=d.updateRenderableState,h=d.createPositionIterator,m=Vl.create(),g,y,b,S,x=Object.assign({},r),C=yi.createEmpty(),w,A,M,D;function k(j,Y,G){if(!G&&!w)throw new Error("missing structure");if(y=Object.assign({},x,Y),b=j,S=G,Vl.reset(m),!g||!w){m.createNew=!0,m.createGeometry=!0;return}s(m,y,x,b,C,S,w),We.areEquivalent(S,w)||(m.createGeometry=!0),We.areHierarchiesEqual(S,w)||(m.updateTransform=!0,m.createGeometry=!0),id.areEqual(j.color,C.color)||(m.updateColor=!0),Xc(y.unitKinds,x.unitKinds)||(m.createGeometry=!0),w.child!==S.child&&(m.createGeometry=!0),m.updateSize&&!("uSize"in g.values)&&(m.createGeometry=!0),m.createGeometry&&(m.updateColor=!0,m.updateSize=!0)}function R(j){if(m.createNew)if(M=i(S),j)g=tKe(S,j,M,b,y,t),D=h(j,g.values);else throw new Error("expected geometry to be given");else{if(!g)throw new Error("expected renderObject to be available");if(m.updateTransform){M=i(S);var Y=M.instanceCount,G=M.groupCount;tu(Y*G,g.values)}if(m.createGeometry)if(j)F.updateIfChanged(g.values.drawCount,la.getDrawCount(j)),F.updateIfChanged(g.values.uVertexCount,la.getVertexCount(j));else throw new Error("expected geometry to be given");(m.updateTransform||m.createGeometry)&&(p(g.values,j||A),D=h(A,g.values)),m.updateSize&&"uSize"in g.values&&Sd(M,b.size,g.values),m.updateColor&&hs(M,D,b.color,g.values),f(g.values,y),v(g.state,y)}x=y,C=b,w=S,j&&(A=j)}function O(j){return!!(Hs(j)||We.isLoci(j)&&We.areRootsEquivalent(j.structure,w)||Re.is(j)&&We.areRootsEquivalent(j.structure,w)&&Re.isWholeStructure(j))}function H(j,Y,G){return O(j)?Y(Ie.ofBounds(0,M.groupCount*M.instanceCount)):o(j,w,Y,G)}function B(j){g&&(l==null||l(g.values,A,x,C,j.webgl))}return{get groupCount(){return M?M.count:0},get renderObject(){return M&&M.count?g:void 0},createOrUpdate:function(j,Y,G,$){if(G===void 0&&(G={}),k(Y,G,$||w),m.createGeometry){var q=n(j,S,b,y,A);if(ZL(q))return q.then(function(ee){R(ee),B(j)});R(q)}else R();B(j)},getLoci:function(j){return g?a(j,w,g.id):Nr},mark:function(j,Y){return wr.mark(g,j,Y,H)},setVisibility:function(j){wr.setVisibility(g,j)},setAlphaFactor:function(j){wr.setAlphaFactor(g,j)},setPickable:function(j){wr.setPickable(g,j)},setColorOnly:function(j){wr.setColorOnly(g,j)},setTransform:function(j,Y){wr.setTransform(g,j,Y)},setOverpaint:function(j){wr.setOverpaint(g,j,H,!0)},setTransparency:function(j){wr.setTransparency(g,j,H,!0)},setClipping:function(j){wr.setClipping(g,j,H,!0)},destroy:function(){c==null||c(A),g&&(g.state.disposed=!0,g=void 0)},mustRecreate:u}}var p2=E(E({},Nre),Ro);function zv(e,t){return D0(E(E({},e),{setUpdateState:function(r,n,i,a,o,s,u){e.setUpdateState(r,n,i,a,o,s,u),Ki.areEqual(a.size,o.size)||(r.createGeometry=!0)},geometryUtils:Ft.Utils}),t)}var rKe=E(E({},Bre),Ro);function nKe(e,t){return D0(E(E({},e),{setUpdateState:function(r,n,i,a,o,s,u){e.setUpdateState(r,n,i,a,o,s,u),Ki.areEqual(a.size,o.size)||(r.updateSize=!0)},geometryUtils:Jo.Utils}),t)}var iKe=E(E({},Ure),Ro);function aKe(e,t){return D0(E(E({},e),{setUpdateState:function(r,n,i,a,o,s,u){e.setUpdateState(r,n,i,a,o,s,u),Ki.areEqual(a.size,o.size)||(r.updateSize=!0)},geometryUtils:wn.Utils}),t)}var oKe=E(E({},jre),Ro);function sKe(e,t){return D0(E(E({},e),{setUpdateState:function(r,n,i,a,o,s,u){e.setUpdateState(r,n,i,a,o,s,u),Ki.areEqual(a.size,o.size)||(r.updateSize=!0),n.background!==i.background&&(r.createGeometry=!0),n.backgroundMargin!==i.backgroundMargin&&(r.createGeometry=!0),n.tether!==i.tether&&(r.createGeometry=!0),n.tetherLength!==i.tetherLength&&(r.createGeometry=!0),n.tetherBaseWidth!==i.tetherBaseWidth&&(r.createGeometry=!0),n.attachment!==i.attachment&&(r.createGeometry=!0),n.fontFamily!==i.fontFamily&&(r.createGeometry=!0),n.fontQuality!==i.fontQuality&&(r.createGeometry=!0),n.fontStyle!==i.fontStyle&&(r.createGeometry=!0),n.fontVariant!==i.fontVariant&&(r.createGeometry=!0),n.fontWeight!==i.fontWeight&&(r.createGeometry=!0)},geometryUtils:Ks.Utils}),t)}var uKe=E(E({},zre),Ro);function lKe(e,t){return D0(E(E({},e),{setUpdateState:function(r,n,i,a,o,s,u){e.setUpdateState(r,n,i,a,o,s,u),Ki.areEqual(a.size,o.size)||(r.createGeometry=!0)},geometryUtils:io.Utils}),t)}var cKe=E(E({},Vre),Ro);function dKe(e,t){return D0(E(E({},e),{setUpdateState:function(r,n,i,a,o,s,u){e.setUpdateState(r,n,i,a,o,s,u),Ki.areEqual(a.size,o.size)||(r.createGeometry=!0)},geometryUtils:Hu.Utils}),t)}function ii(e,t,r,n){var i=0,a=t.webgl,o=new ri,s=Dd(),u=[],l=Ui.create(),c=new Map,d,f,p,v,h=yi.createEmpty();function m(w,A){var M=this;return w===void 0&&(w={}),A&&A!==d&&(p=r(t,A),v||(v=I.getDefaultValues(p))),v=Object.assign({},v,w),$e.create("Creating or updating UnitsRepresentation",function(D){return ce(M,void 0,void 0,function(){var B,$,G,q,k,B,$,O,G,q,q,R,G,q,B,$,O,G,q,q,H,B,j,Y,G,$,q,q,ee,fe,W;return de(this,function(X){switch(X.label){case 0:if(!(!d&&!A))return[3,1];throw new Error("missing structure");case 1:if(!(A&&!d))return[3,8];f=A.unitSymmetryGroups,B=0,X.label=2;case 2:return B<f.length?($=f[B],G=n(s,A,v,a),q=G.createOrUpdate({webgl:a,runtime:D},h,v,{group:$,structure:A}),q?[4,q]:[3,4]):[3,7];case 3:X.sent(),X.label=4;case 4:return b(G,$,l),c.set($.hashCode,{visual:G,group:$}),D.shouldUpdate?[4,D.update({message:"Creating or updating UnitsVisual",current:B,max:f.length})]:[3,6];case 5:X.sent(),X.label=6;case 6:return B++,[3,2];case 7:return[3,43];case 8:if(!(A&&(!We.areUnitIdsAndIndicesEqual(A,d)||A.child!==d.child)))return[3,22];f=A.unitSymmetryGroups,k=c,c=new Map,B=0,X.label=9;case 9:return B<f.length?($=f[B],O=k.get($.hashCode),O?(G=O.visual,!((ee=G.mustRecreate)===null||ee===void 0)&&ee.call(G,{group:$,structure:A},v,a)?(G.destroy(),G=n(s,A,v,a),q=G.createOrUpdate({webgl:a,runtime:D},h,v,{group:$,structure:A}),q?[4,q]:[3,11]):[3,12]):[3,15]):[3,21];case 10:X.sent(),X.label=11;case 11:return b(G,$,l),[3,14];case 12:return q=G.createOrUpdate({webgl:a,runtime:D},h,v,{group:$,structure:A}),q?[4,q]:[3,14];case 13:X.sent(),X.label=14;case 14:return c.set($.hashCode,{visual:G,group:$}),k.delete($.hashCode),G.renderObject&&(R=G.renderObject.values.tMarker.ref.value.array,Gu(R,Ie.ofBounds(0,R.length),tr.RemoveHighlight)),[3,18];case 15:return G=n(s,A,v,a),q=G.createOrUpdate({webgl:a,runtime:D},h,v,{group:$,structure:A}),q?[4,q]:[3,17];case 16:X.sent(),X.label=17;case 17:b(G,$,l),c.set($.hashCode,{visual:G,group:$}),X.label=18;case 18:return D.shouldUpdate?[4,D.update({message:"Creating or updating UnitsVisual",current:B,max:f.length})]:[3,20];case 19:X.sent(),X.label=20;case 20:return B++,[3,9];case 21:return k.forEach(function(U){var z=U.visual;z.destroy()}),[3,43];case 22:if(!(A&&A!==d&&We.areUnitIdsAndIndicesEqual(A,d)))return[3,34];f=A.unitSymmetryGroups,B=0,X.label=23;case 23:return B<f.length?($=f[B],O=c.get($.hashCode),O?(G=O.visual,!((fe=G.mustRecreate)===null||fe===void 0)&&fe.call(G,{group:$,structure:A},v,t.webgl)?(G.destroy(),G=n(s,A,v,t.webgl),O.visual=G,q=G.createOrUpdate({webgl:a,runtime:D},h,v,{group:$,structure:A}),q?[4,q]:[3,25]):[3,26]):[3,29]):[3,33];case 24:X.sent(),X.label=25;case 25:return b(G,$,l),[3,28];case 26:return q=G.createOrUpdate({webgl:a,runtime:D},h,v,{group:$,structure:A}),q?[4,q]:[3,28];case 27:X.sent(),X.label=28;case 28:return O.group=$,[3,30];case 29:throw new Error("expected to find visual for hashCode "+$.hashCode);case 30:return D.shouldUpdate?[4,D.update({message:"Creating or updating UnitsVisual",current:B,max:f.length})]:[3,32];case 31:X.sent(),X.label=32;case 32:return B++,[3,23];case 33:return[3,43];case 34:H=[],c.forEach(function(U){return H.push(U)}),B=0,j=H.length,X.label=35;case 35:return B<j?(Y=H[B],G=Y.visual,$=Y.group,!((W=G.mustRecreate)===null||W===void 0)&&W.call(G,{group:$,structure:d},v,t.webgl)?(G.destroy(),G=n(s,d,v,a),H[B].visual=G,q=G.createOrUpdate({webgl:a,runtime:D},h,v,{group:$,structure:d}),q?[4,q]:[3,37]):[3,38]):[3,43];case 36:X.sent(),X.label=37;case 37:return b(G,$,l),[3,40];case 38:return q=G.createOrUpdate({webgl:a,runtime:D},h,v),q?[4,q]:[3,40];case 39:X.sent(),X.label=40;case 40:return D.shouldUpdate?[4,D.update({message:"Creating or updating UnitsVisual",current:B,max:j})]:[3,42];case 41:X.sent(),X.label=42;case 42:return++B,[3,35];case 43:return u.length=0,c.forEach(function(U){var z=U.visual;z.renderObject&&u.push(z.renderObject)}),A&&(d=A),o.next(i++),[2]}})})})}function g(w){if(w===void 0)return We.Loci(d.target);var A=Nr;return c.forEach(function(M){var D=M.visual,k=D.getLoci(w);Du(k)||(A=k)}),A}function y(w,A){if(!d||!Do.is(l.markerActions,A))return!1;if(We.isLoci(w)||Re.is(w)||Vt.isLoci(w)){if(!We.areRootsEquivalent(w.structure,d))return!1;w=ar.remap(w,d)}else if(!Hs(w)&&!w1(w))return!1;if(ar.isEmpty(w))return!1;var M=!1;return c.forEach(function(D){var k=D.visual;M=k.mark(w,A)||M}),M}function b(w,A,M){var D=M.visible,k=M.alphaFactor,R=M.pickable,O=M.overpaint,H=M.transparency,B=M.clipping,j=M.transform,Y=M.unitTransforms;D!==void 0&&w.setVisibility(D),k!==void 0&&w.setAlphaFactor(k),R!==void 0&&w.setPickable(R),O!==void 0&&w.setOverpaint(O),H!==void 0&&w.setTransparency(H),B!==void 0&&w.setClipping(B),j!==void 0&&w.setTransform(j),Y!==void 0&&(Y?w.setTransform(void 0,Y.getSymmetryGroupTransforms(A)):w.setTransform(void 0,null))}function S(w){var A=w.visible,M=w.alphaFactor,D=w.pickable,k=w.overpaint,R=w.transparency,O=w.clipping,H=w.transform,B=w.unitTransforms,j=w.syncManually,Y=w.markerActions,G={};A!==l.visible&&(G.visible=A),M!==l.alphaFactor&&(G.alphaFactor=M),D!==l.pickable&&(G.pickable=D),k!==void 0&&!qi.areEqual(k,l.overpaint)&&d&&(G.overpaint=qi.remap(k,d)),R!==void 0&&!$i.areEqual(R,l.transparency)&&d&&(G.transparency=$i.remap(R,d)),O!==void 0&&!on.areEqual(O,l.clipping)&&d&&(G.clipping=on.remap(O,d)),H!==void 0&&!ue.areEqual(H,l.transform,xn)&&(G.transform=H),(B!==l.unitTransforms||(B==null?void 0:B.version)!==w.unitTransformsVersion)&&(G.unitTransforms=B,l.unitTransformsVersion=B?B==null?void 0:B.version:-1),j!==l.syncManually&&(G.syncManually=j),Y!==l.markerActions&&(G.markerActions=Y),c.forEach(function($){var q=$.visual,ee=$.group;return b(q,ee,G)}),Ui.update(l,G)}function x(w){h=w}function C(){c.forEach(function(w){var A=w.visual;return A.destroy()}),c.clear()}return{label:e,get groupCount(){var w=0;return c.forEach(function(A){var M=A.visual;M.renderObject&&(w+=M.groupCount)}),w},get props(){return v},get params(){return p},get state(){return l},get theme(){return h},renderObjects:u,updated:o,createOrUpdate:m,setState:S,setTheme:x,getLoci:g,mark:y,destroy:C}}function fKe(e,t,r,n,i,a){var o=la.getUtils(t),s=o.createValues,u=o.createRenderableState,l=kre(e,i.includeParent),c=s(t,l,r,n,i),d=u(i);return P0(t.kind,c,d,a)}function Vv(e,t){var r=e.defaultProps,n=e.createGeometry,i=e.createLocationIterator,a=e.getLoci,o=e.eachLocation,s=e.setUpdateState,u=e.mustRecreate,l=e.processValues,c=e.dispose,d=e.geometryUtils,f=d.createEmpty,p=d.updateValues,v=d.updateBoundingSphere,h=d.updateRenderableState,m=d.createPositionIterator,g=Vl.create(),y,b=Object.assign({},r),S=yi.createEmpty(),x,C,w,A,M,D,k;function R(G,$,q){if(!q&&!A)throw new Error("missing structureGroup");if(b=$,S=G,x=q,Vl.reset(g),!y||!A){g.createNew=!0,g.createGeometry=!0;return}s(g,b,C,S,w,x,A),We.areHierarchiesEqual(A.structure,x.structure)||(g.updateTransform=!0,g.updateColor=!0,g.updateSize=!0),id.areEqual(S.color,w.color)||(g.updateColor=!0),A.structure.child!==x.structure.child&&(g.createGeometry=!0),Xc(b.unitKinds,C.unitKinds)||(g.createGeometry=!0),x.group.transformHash!==A.group.transformHash&&(x.group.units.length!==A.group.units.length||g.updateColor?g.updateTransform=!0:g.updateMatrix=!0);var ee=x.group.units[0],fe=A.group.units[0];je.areOperatorsEqual(ee,fe)||(g.updateTransform=!0),je.areConformationsEqual(ee,fe)||(g.createGeometry=!0),g.updateTransform&&(g.updateMatrix=!0),g.updateSize&&!("uSize"in y.values)&&(g.createGeometry=!0),(g.createGeometry||g.updateTransform)&&(A.structure.hashCode!==x.structure.hashCode&&(g.updateColor=!0,g.updateSize=!0),(S.color.granularity.startsWith("vertex")||y.values.dColorType.ref.value.startsWith("vertex")||S.color.granularity.startsWith("volume")||y.values.dColorType.ref.value.startsWith("volume"))&&(g.updateColor=!0))}function O(G){if(g.createNew)if(D=i(x),G)y=fKe(x,G,D,S,b,t),k=m(G,y.values);else throw new Error("expected geometry to be given");else{if(!y)throw new Error("expected renderObject to be available");if(g.updateTransform){D=i(x);var $=D.instanceCount,q=D.groupCount;tu($*q,y.values)}if(g.updateMatrix&&kre(x,b.includeParent,y.values),g.createGeometry)if(G)F.updateIfChanged(y.values.drawCount,la.getDrawCount(G)),F.updateIfChanged(y.values.uVertexCount,la.getVertexCount(G));else throw new Error("expected geometry to be given");(g.updateTransform||g.createGeometry)&&(v(y.values,G||M),k=m(G||M,y.values)),g.updateSize&&"uSize"in y.values&&Sd(D,S.size,y.values),g.updateColor&&hs(D,k,S.color,y.values),p(y.values,b),h(y.state,b)}C=b,w=S,A=x,G&&(M=G)}function H(G,$,q,ee,fe,W){return XYe(fe.unitKinds,$)?n(G,$,q,ee,fe,W):f(W)}function B(G){return!!(Hs(G)||We.isLoci(G)&&We.areRootsEquivalent(G.structure,A.structure)||Re.is(G)&&We.areRootsEquivalent(G.structure,A.structure)&&Re.isWholeStructure(G))}function j(G,$,q){return B(G)?$(Ie.ofBounds(0,D.groupCount*D.instanceCount)):o(G,A,$,q)}function Y(G){y&&(l==null||l(y.values,M,C,w,G.webgl))}return{get groupCount(){return D?D.count:0},get renderObject(){return D&&D.count?y:void 0},createOrUpdate:function(G,$,q,ee){if(R($,q,ee||A),g.createGeometry){var fe=H(G,x.group.units[0],x.structure,S,b,M);if(ZL(fe))return fe.then(function(W){O(W),Y(G)});O(fe)}else O();Y(G)},getLoci:function(G){return y?a(G,A,y.id):Nr},mark:function(G,$){return wr.mark(y,G,$,j)},setVisibility:function(G){wr.setVisibility(y,G)},setAlphaFactor:function(G){wr.setAlphaFactor(y,G)},setPickable:function(G){wr.setPickable(y,G)},setColorOnly:function(G){wr.setColorOnly(y,G)},setTransform:function(G,$){wr.setTransform(y,G,$)},setOverpaint:function(G){wr.setOverpaint(y,G,j,!0)},setTransparency:function(G){wr.setTransparency(y,G,j,!0)},setClipping:function(G){wr.setClipping(y,G,j,!0)},destroy:function(){c==null||c(M),y&&(y.state.disposed=!0,y=void 0)},mustRecreate:u}}var Ea=E(E({},Nre),Ro);function uo(e,t){return Vv(E(E({},e),{setUpdateState:function(r,n,i,a,o,s,u){e.setUpdateState(r,n,i,a,o,s,u),Ki.areEqual(a.size,o.size)||(r.createGeometry=!0)},geometryUtils:Ft.Utils}),t)}var Hre=E(E({},JYe),Ro);function Gre(e,t){return Vv(E(E({},e),{setUpdateState:function(r,n,i,a,o,s,u){e.setUpdateState(r,n,i,a,o,s,u),Ki.areEqual(a.size,o.size)||(r.updateSize=!0)},geometryUtils:gp.Utils}),t)}var qre=E(E({},Bre),Ro);function $re(e,t){return Vv(E(E({},e),{setUpdateState:function(r,n,i,a,o,s,u){e.setUpdateState(r,n,i,a,o,s,u),Ki.areEqual(a.size,o.size)||(r.updateSize=!0)},geometryUtils:Jo.Utils}),t)}var pKe=E(E({},eKe),Ro);function hKe(e,t){return Vv(E(E({},e),{setUpdateState:function(r,n,i,a,o,s,u){e.setUpdateState(r,n,i,a,o,s,u),Ki.areEqual(a.size,o.size)||(r.updateSize=!0)},geometryUtils:bv.Utils}),t)}var uF=E(E({},Ure),Ro);function lF(e,t){return Vv(E(E({},e),{setUpdateState:function(r,n,i,a,o,s,u){e.setUpdateState(r,n,i,a,o,s,u),Ki.areEqual(a.size,o.size)||(r.updateSize=!0)},geometryUtils:wn.Utils}),t)}E(E({},jre),Ro);var vKe=E(E({},zre),Ro);function mKe(e,t){return Vv(E(E({},e),{setUpdateState:function(r,n,i,a,o,s,u){e.setUpdateState(r,n,i,a,o,s,u),Ki.areEqual(a.size,o.size)||(r.createGeometry=!0)},geometryUtils:io.Utils}),t)}var gKe=E(E({},Vre),Ro);function yKe(e,t){return Vv(E(E({},e),{setUpdateState:function(r,n,i,a,o,s,u){e.setUpdateState(r,n,i,a,o,s,u),Ki.areEqual(a.size,o.size)||(r.createGeometry=!0)},geometryUtils:Hu.Utils}),t)}var Ui={create:function(){return E(E({},or.createState()),{unitTransforms:null,unitTransformsVersion:-1})},update:function(e,t){or.updateState(e,t),t.unitTransforms!==void 0&&(e.unitTransforms=t.unitTransforms)}};function jr(e,t){return e.model.atomicHierarchy.atoms.type_symbol.value(e.elements[t])}function Wre(e,t){return e.model.atomicHierarchy.atoms.pdbx_formal_charge.value(e.elements[t])}function Ob(e,t){return e.model.atomicHierarchy.atoms.label_atom_id.value(e.elements[t])}function pw(e,t){return e.model.atomicHierarchy.atoms.label_alt_id.value(e.elements[t])}function cF(e,t){return e.model.atomicHierarchy.atoms.label_comp_id.value(e.elements[t])}function bKe(e,t,r){for(var n=0,i=e.interUnitBonds.getEdgeIndices(r,t.id),a=0,o=i.length;a<o;++a){var s=e.interUnitBonds.edges[i[a]];Ur.isCovalent(s.props.flag)&&(n+=1)}return n}function xKe(e,t){for(var r=0,n=e.bonds,i=n.offset,a=n.edgeProps.flags,o=i[t],s=i[t+1];o<s;++o)Ur.isCovalent(a[o])&&(r+=1);return r}function od(e,t,r){return bKe(e,t,r)+xKe(t,r)}function ro(e,t,r,n){var i=0;return Qs(e,t,r,function(a,o){jr(a,o)===n&&(i+=1)}),i}function SKe(e,t,r){var n=e.bonds,i=n.offset,a=n.b,o=n.edgeProps.flags;Ur.is;for(var s=i[t],u=i[t+1];s<u;++s)if(a[s]===r&&Ur.isCovalent(o[s]))return!0;return!1}function CKe(e,t,r,n,i){var a=e.interUnitBonds.getEdge(r,t.id,i,n.id);return a&&Ur.isCovalent(a.props.flag)}function _Ke(e,t,r,n,i){return t===n?SKe(t,r,i):CKe(e,t,r,n,i)}function wKe(e,t,r,n){for(var i=e.interUnitBonds.getEdgeIndices(r,t.id),a=0,o=i.length;a<o;++a){var s=e.interUnitBonds.edges[i[a]],u=e.unitMap.get(s.unitB);Ur.isCovalent(s.props.flag)&&n(u,s.indexB)}}function EKe(e,t,r){for(var n=e.bonds,i=n.offset,a=n.b,o=n.edgeProps.flags,s=i[t],u=i[t+1];s<u;++s)Ur.isCovalent(o[s])&&r(e,a[s])}function Qs(e,t,r,n){wKe(e,t,r,n),EKe(t,r,n)}function AKe(e){switch(e){case 0:return"Spherical";case 1:return"Terminal";case 2:return"Linear";case 3:return"Trigonal";case 4:return"Tetrahedral";case 5:return"Trigonal Bi-Pyramidal";case 6:return"Octahedral";case 7:return"Square Planar";case 8:return"Unknown"}}function gm(e){switch(e){case 0:return 0;case 1:return 1;case 2:return 2;case 3:return 3;case 4:return 4;default:return 8}}var MV=new Map([[2,Kr(180)],[3,Kr(120)],[4,Kr(109.4721)],[6,Kr(90)]]),hw=_(),vw=_(),Eh=_(),mw=_(),Km=_();function gw(e,t,r,n,i){var a=[];return t.conformation.position(t.elements[r],Eh),n.conformation.position(n.elements[i],mw),_.sub(hw,mw,Eh),Qs(e,t,r,function(o,s){jr(o,s)!=="H"&&(o.conformation.position(o.elements[s],Km),_.sub(vw,Km,Eh),a.push(_.angle(hw,vw)))}),a}function DV(e,t,r,n,i){t.conformation.position(t.elements[r],Eh),n.conformation.position(n.elements[i],mw),_.sub(hw,mw,Eh);var a=[_(),_()],o=0,s,u;if(Qs(e,t,r,function(l,c){o>1||jr(l,c)!=="H"&&(s=l,u=c,l.conformation.position(l.elements[c],Km),_.sub(a[o++],Km,Eh))}),o===1&&s&&u&&Qs(e,s,u,function(l,c){o>1||l===t&&c===r||jr(l,c)!=="H"&&(l.conformation.position(l.elements[c],Km),_.sub(a[o++],Km,Eh))}),o===2)return _.cross(vw,a[0],a[1]),Math.abs(Math.PI/2-_.angle(vw,hw))}var pT=new Vt.ElementBondIterator,hT=new Vt.ElementBondIterator;function PKe(e,t,r){var n=jr(t,r),i=n==="O"||n==="N";if(i&&od(e,t,r)===4)return!1;for(pT.setElement(e,t,r);pT.hasNext;){var a=pT.move();if(a.order>1)return!0;if(i){var o=jr(a.otherUnit,a.otherIndex);for(hT.setElement(e,a.otherUnit,a.otherIndex);hT.hasNext;){var s=hT.move();if(s.order>1){if((o==="P"||o==="S")&&jr(s.otherUnit,s.otherIndex)==="O")continue;return!0}}}}return!1}function TKe(e,t,r){for(var n=0,i=t.bonds,a=i.offset,o=i.edgeProps,s=o.flags,u=o.order,l=a[r],c=a[r+1];l<c;++l)Ur.isCovalent(s[l])&&(n+=u[l]);return e.interUnitBonds.getEdgeIndices(r,t.id).forEach(function(d){var f=e.interUnitBonds.edges[d];Ur.isCovalent(f.props.flag)&&(n+=f.props.order)}),n}var ym=new Vt.ElementBondIterator,vT=new Vt.ElementBondIterator;function IKe(e,t,r,n){var i=ro(e,t,r,"H"),a=jr(t,r),o=Wre(t,r),s=n.assignCharge==="always"||n.assignCharge==="auto"&&o===0,u=n.assignH==="always"||n.assignH==="auto"&&i===0,l=od(e,t,r),c=TKe(e,t,r),d=PKe(e,t,r),f=c-l>0,p=0,v=8;switch(a){case"H":s&&(l===0?(o=1,v=0):l===1&&(o=0,v=1));break;case"C":s&&(o=0),u&&(p=Math.max(0,4-c-Math.abs(o))),v=gm(l+p+Math.max(0,-o));break;case"N":if(s)if(!u)o=c-3;else if(d&&c<4)l-i===1&&c-i===2?o=1:o=0;else for(ym.setElement(e,t,r);ym.hasNext;){var h=ym.move(),m=jr(h.otherUnit,h.otherIndex);if(m==="S"||oYe(m)){o=0;break}else o=1}u&&(p=Math.max(0,3-c+o)),d&&!f?v=gm(l+p-o):v=gm(l+p+1-o);break;case"O":if(s&&(u||(o=c-2),c===1)){ym.setElement(e,t,r);e:for(;ym.hasNext;){var g=ym.move();for(vT.setElement(e,g.otherUnit,g.otherIndex);vT.hasNext;){var y=vT.move();if(!(y.otherUnit===t&&y.otherIndex===r)&&jr(y.otherUnit,y.otherIndex)==="O"&&y.order===2){o=-1;break e}}}}u&&(p=Math.max(0,2-c+o)),d&&!f?v=gm(l+p-o+1):v=gm(l+p-o+2);break;case"S":s&&(u||(c<=3&&ro(e,t,r,"O")===0?o=c-2:o=0)),u&&c<2&&(p=Math.max(0,2-c+o)),c<=3&&(v=gm(l+p-o+2));break;case"F":case"CL":case"BR":case"I":case"AT":s&&(o=c-1);break;case"LI":case"NA":case"K":case"RB":case"CS":case"FR":s&&(o=1-c);break;case"BE":case"MG":case"CA":case"SR":case"BA":case"RA":s&&(o=2-c);break;default:kr&&console.warn("Requested charge, protonation for an unhandled element",a)}return[o,p,p+i,v]}function MKe(e,t,r){var n=t.elements.length,i=new Int8Array(n),a=new Int8Array(n),o=new Int8Array(n),s=new Int8Array(n),u=!!e.parent,l;if(u){var c=e.root.unitMap.get(t.id);if(l=Je.indicesOf(c.elements,t.elements),l.length!==t.elements.length)throw new Error("expected to find an index for every element");t=c,e=e.root}for(var d=0;d<n;++d){var f=u?l[d]:d,p=IKe(e,t,f,r),v=p[0],h=p[1],m=p[2],g=p[3];i[d]=v,a[d]=h,o[d]=m,s[d]=g}return{charge:i,implicitH:a,totalH:o,idealGeometry:s}}var Xre={assignCharge:I.Select("auto",[["always","always"],["auto","auto"],["never","never"]]),assignH:I.Select("auto",[["always","always"],["auto","auto"],["never","never"]])};function DKe(e,t,r){return ce(this,void 0,void 0,function(){var n,i,a,o,s,u;return de(this,function(l){for(n=E(E({},I.getDefaultValues(Xre)),r),i=new Map,a=0,o=t.units.length;a<o;++a)s=t.units[a],je.isAtomic(s)&&(u=MKe(t,s,n),i.set(s.id,u));return[2,i]})})}var mT=E({},Xre),h2=hp.createProvider({label:"Valence Model",descriptor:To({name:"molstar_computed_valence_model"}),type:"local",defaultParams:mT,getParams:function(e){return mT},isApplicable:function(e){return!0},obtain:function(e,t,r){return ce(void 0,void 0,void 0,function(){var n,i;return de(this,function(a){switch(a.label){case 0:return n=E(E({},I.getDefaultValues(mT)),r),i={},[4,DKe(e.runtime,t,n)];case 1:return[2,(i.value=a.sent(),i)]}})})}}),Tn;(function(e){function t(d,f,p,v){return _.set(d,v.x[p],v.y[p],v.z[p]),_.transformMat4(d,d,f.conformation.operator.matrix),d}e.setPosition=t;function r(d,f){for(var p=new Int32Array(f+1),v=new Int32Array(f),h=new Int32Array(f),m=d.members,g=d.count,y=d.offsets,b=0,S=y[g];b<S;++b)++h[m[b]];for(var x=0,b=0;b<f;b++)p[b]=x,x+=h[b];p[f]=x;for(var C=new Int32Array(x),b=0;b<g;++b)for(var w=y[b],A=y[b+1];w<A;++w){var M=m[w],D=p[M]+v[M];C[D]=b,++v[M]}return{indices:C,offsets:p}}e.createElementsIndex=r;function n(d,f){var p,v;return E(E({},f),{get lookup3d(){if(!p){var h={x:f.x,y:f.y,z:f.z,indices:Le.ofBounds(0,f.count)};p=fv(h,Xg(h))}return p},get elementsIndex(){return v||(v=r(f,d))},subset:function(h){return i(f,h)}})}e.create=n;function i(d,f){for(var p,v=d.count,h=d.types,m=[],g=0;g<v;++g)f.has(h[g])&&m.push(g);var y=Je.ofSortedArray(m);return{indices:y,get lookup3d(){if(!p){var b={x:d.x,y:d.y,z:d.z,indices:y};p=fv(b,Xg(b))}return p}}}e.createSubset=i;function a(d,f,p){var v=h2.get(d).value;if(!v||!v.has(f.id))throw new Error("valence model required");return{unit:f,types:p.types,feature:-1,x:p.x,y:p.y,z:p.z,members:p.members,offsets:p.offsets,idealGeometry:v.get(f.id).idealGeometry}}e.Info=a;function o(d,f){return _.set(d,f.x[f.feature],f.y[f.feature],f.z[f.feature]),_.transformMat4(d,d,f.unit.conformation.operator.matrix),d}e.position=o;var s=_(),u=_();function l(d,f){var p=d.members[d.offsets[d.feature]],v=f.members[f.offsets[f.feature]];return d.unit.conformation.position(d.unit.elements[p],s),f.unit.conformation.position(f.unit.elements[v],u),_.distance(s,u)}e.distance=l;function c(d,f){return{types:new Set(d),add:f}}e.Provider=c})(Tn||(Tn={}));var ZD;(function(e){function t(r,n,i){r===void 0&&(r=2048),n===void 0&&(n=1024);var a=qe.create(Float32Array,1,n,i?i.x:r),o=qe.create(Float32Array,1,n,i?i.y:r),s=qe.create(Float32Array,1,n,i?i.z:r),u=qe.create(Uint8Array,1,n,i?i.types:r),l=qe.create(Uint8Array,1,n,i?i.groups:r),c=qe.create(Uint32Array,1,n,i?i.offsets:r),d=qe.create(Uint32Array,1,n,i?i.members:r),f={x:0,y:0,z:0,offset:0,count:0};return{startState:function(){f.x=0,f.y=0,f.z=0,f.offset=d.elementCount,f.count=0},pushMember:function(p,v,h,m){qe.add(d,m),f.x+=p,f.y+=v,f.z+=h,f.count+=1},finishState:function(p,v){var h=f.count;h!==0&&(qe.add(u,p),qe.add(l,v),qe.add(a,f.x/h),qe.add(o,f.y/h),qe.add(s,f.z/h),qe.add(c,f.offset))},add:function(p,v,h,m,g,y){qe.add(u,p),qe.add(l,v),qe.add(a,h),qe.add(o,m),qe.add(s,g),qe.add(c,d.elementCount),qe.add(d,y)},getFeatures:function(p){qe.add(c,d.elementCount);var v=qe.compact(a,!0),h=qe.compact(o,!0),m=qe.compact(s,!0),g=a.elementCount;return Tn.create(p,{x:v,y:h,z:m,count:g,types:qe.compact(u,!0),groups:qe.compact(l,!0),offsets:qe.compact(c,!0),members:qe.compact(d,!0)})}}}e.create=t})(ZD||(ZD={}));var JD;(function(e){function t(r,n,i){for(var a=new Int32Array(i+1),o=new Int32Array(i),s=new Int32Array(i),u=n.members,l=n.offsets,c=0,d=r.edgeCount*2;c<d;++c){var f=r.a[c],p=r.b[c];if(!(f>p)){for(var v=l[f],h=l[f+1];v<h;++v)++s[u[v]];for(var v=l[p],h=l[p+1];v<h;++v)++s[u[v]]}}for(var m=0,c=0;c<i;c++)a[c]=m,m+=s[c];a[i]=m;for(var g=new Int32Array(m),c=0,d=r.edgeCount*2;c<d;++c){var f=r.a[c],p=r.b[c];if(!(f>p)){for(var v=l[f],h=l[f+1];v<h;++v){var y=u[v],b=a[y]+o[y];g[b]=c,++o[y]}for(var v=l[p],h=l[p+1];v<h;++v){var y=u[v],b=a[y]+o[y];g[b]=c,++o[y]}}}return{indices:g,offsets:a}}e.createElementsIndex=t})(JD||(JD={}));var RKe=function(e){Fe(t,e);function t(r,n){var i=e.call(this,r)||this,a=0,o=new Map,s=function(u,l){var c=i.getElementKey(u,l),d=o.get(c);d===void 0?o.set(c,[a]):d.push(a)};return i.map.forEach(function(u){u.forEach(function(l){var c=l.unitA,d=l.connectedIndices;d.forEach(function(f){for(var p=n.get(c),v=p.offsets,h=p.members,m=v[f],g=v[f+1];m<g;++m)s(h[m],c);a+=1})})}),i.elementKeyIndex=o,i}return t.prototype.getContactIndicesForElement=function(r,n){return this.elementKeyIndex.get(this.getElementKey(r,n.id))||[]},t.prototype.getElementKey=function(r,n){return r+"|"+n},t}(pv);function RV(e){switch(e){case 4:return"Hydrogen Bond";case 6:return"Hydrophobic Contact";case 5:return"Halogen Bond";case 1:return"Ionic Interaction";case 7:return"Metal Coordination";case 2:return"Cation-Pi Interaction";case 3:return"Pi Stacking";case 8:return"Weak Hydrogen Bond";case 0:return"Unknown Interaction"}}function kKe(e){switch(e){case 0:return"None";case 1:return"Positive Charge";case 2:return"Negative Charge";case 3:return"Aromatic Ring";case 4:return"Hydrogen Donor";case 5:return"Hydrogen Acceptor";case 6:return"Halogen Donor";case 7:return"Halogen Acceptor";case 8:return"HydrophobicAtom";case 9:return"Weak Hydrogen Donor";case 10:return"Ionic Type Partner";case 11:return"Dative Bond Partner";case 12:return"Transition Metal";case 13:return"Ionic Type Metal"}}function OKe(e){switch(e){case 0:return"None";case 1:return"Quaternary Amine";case 2:return"Tertiary Amine";case 3:return"Sulfonium";case 4:return"Sulfonic Acid";case 5:return"Sulfate";case 6:return"Phosphate";case 7:return"Halocarbon";case 8:return"Guanidine";case 9:return"Acetamidine";case 10:return"Carboxylate"}}var eR;(function(e){function t(r,n){var i=[],a=[],o=[];return{add:function(s,u,l){i[i.length]=s,a[a.length]=u,o[o.length]=l},getContacts:function(){for(var s=new Io.EdgeBuilder(r.count,i,a),u=new Int8Array(s.slotCount),l=new Int8Array(s.slotCount),c=0,d=s.edgeCount;c<d;c++)s.addNextEdge(),s.assignProperty(u,o[c]);var f=s.createGraph({type:u,flag:l}),p,v=Object.defineProperty(f,"elementsIndex",{get:function(){return p||(p=JD.createElementsIndex(f,r,n))}});return v}}}e.create=t})(eR||(eR={}));var tR;(function(e){function t(){var r=new pv.Builder;return{startUnitPair:function(n,i){r.startUnitPair(n.id,i.id)},finishUnitPair:function(){r.finishUnitPair()},add:function(n,i,a){r.add(n,i,{type:a,flag:0})},getContacts:function(n){return new RKe(r.getMap(),n)}}}e.create=t})(tR||(tR={}));var LKe={lineOfSightDistFactor:I.Numeric(1,{min:0,max:3,step:.1})},FKe=3;function Yre(e,t,r){var n=t.members[t.offsets[t.feature]],i=r.members[r.offsets[r.feature]];if(n===i&&t.unit===r.unit)return!1;var a=pw(t.unit,n),o=pw(r.unit,i);return!(a&&o&&a!==o||t.unit.residueIndex[t.unit.elements[n]]===r.unit.residueIndex[r.unit.elements[i]]&&t.unit===r.unit||_Ke(e,t.unit,n,r.unit,i))}function kV(e,t,r,n){var i=pw(e,t),a=pw(r,n);return i&&a&&i!==a}function OV(e,t){for(var r=t.feature,n=t.offsets,i=t.members,a=n[r],o=n[r+1];a<o;++a)if(i[a]===e)return!0;return!1}var $d=_(),gT=_(),yT=_(),NKe=BJ();function Kre(e,t,r,n){var i=t.feature,a=r.feature,o=t.members[t.offsets[i]],s=r.members[r.offsets[a]];Tn.position(gT,t),Tn.position(yT,r),_.scale($d,_.add($d,gT,yT),.5);var u=n*FKe,l=e.lookup3d.find($d[0],$d[1],$d[2],u,NKe),c=l.count,d=l.indices,f=l.units,p=l.squaredDistances;if(c===0)return!0;for(var v=0;v<c;++v){var h=d[v],m=f[v];if(je.isAtomic(m)){var g=jr(m,h);if(g!=="H"){var y=i2(g);if(!(y*y*n*n<=p[v])&&!(kV(m,h,t.unit,o)||kV(m,h,r.unit,s))&&!(t.unit===m&&OV(h,t)||r.unit===m&&OV(h,r))&&(m.conformation.position(m.elements[h],$d),!(_.squaredDistance($d,gT)<1||_.squaredDistance($d,yT)<1)))return!1}}}return!0}function BKe(e,t,r,n,i,a){for(var o=0,s=i;o<s.length;o++){var u=s[o];UKe(e,t,r,n,u,a)}}function UKe(e,t,r,n,i,a){for(var o=r.x,s=r.y,u=r.z,l=r.subset(i.requiredFeatures),c=l.lookup3d,d=l.indices,f=Tn.Info(e,t,r),p=E({},f),v=a.lineOfSightDistFactor,h=0,m=Le.size(d);h<m;++h){var g=Le.getAt(d,h),y=c.find(o[g],s[g],u[g],i.maxDistance),b=y.count,S=y.indices,x=y.squaredDistances;if(b!==0){f.feature=g;for(var C=0;C<b;++C){var w=Le.getAt(d,S[C]);if(!(w<=g)&&(p.feature=w,!!Yre(e,f,p))){var A=i.getType(e,f,p,x[C]);A&&Kre(e,f,p,v)&&n.add(g,w,A)}}}}}var jKe=ue();function zKe(e,t,r,n,i,a,o,s){var u=r.count,l=r.x,c=r.y,d=r.z,f=i.lookup3d,p=ue.mul(jKe,n.conformation.operator.inverse,t.conformation.operator.matrix),v=!ue.isIdentity(p),h=_(),m=Math.max.apply(Math,o.map(function(q){return q.maxDistance})),g=f.boundary.sphere,y=g.center,b=g.radius,S=(b+m)*(b+m),x=s.lineOfSightDistFactor,C=Tn.Info(e,t,r),w=Tn.Info(e,n,i);a.startUnitPair(t,n);for(var A=0;A<u;++A)if(_.set(h,l[A],c[A],d[A]),v&&_.transformMat4(h,h,p),!(_.squaredDistance(h,y)>S)){var M=f.find(h[0],h[1],h[2],m),D=M.indices,k=M.count,R=M.squaredDistances;if(k!==0){C.feature=A;for(var O=0;O<k;++O){var H=D[O];if(w.feature=H,!!Yre(e,C,w))for(var B=R[O],j=0,Y=o;j<Y.length;j++){var G=Y[j];if(B<G.maxDistance*G.maxDistance){var $=G.getType(e,C,w,B);if($&&Kre(e,C,w,x)){a.add(A,H,$);break}}}}}}a.finishUnitPair()}var VKe={distanceMax:I.Numeric(4,{min:1,max:5,step:.1}),angleMax:I.Numeric(30,{min:0,max:60,step:1})},HKe=["CL","BR","I","AT"];function GKe(e,t,r){for(var n=t.elements,i=t.model.atomicConformation,a=i.x,o=i.y,s=i.z,u=0,l=n.length;u<l;++u){var c=jr(t,u);HKe.includes(c)&&r.add(6,0,a[n[u]],o[n[u]],s[n[u]],u)}}var qKe=["N","O","S"],$Ke=["C","N","P","S"];function WKe(e,t,r){for(var n=t.elements,i=t.model.atomicConformation,a=i.x,o=i.y,s=i.z,u=function(d,f){var p=jr(t,d);if(qKe.includes(p)){var v=!1;Qs(e,t,d,function(h,m){$Ke.includes(jr(h,m))&&(v=!0)}),v&&r.add(7,0,a[n[d]],o[n[d]],s[n[d]],d)}},l=0,c=n.length;l<c;++l)u(l)}function XKe(e,t){return e===7&&t===6||e===6&&t===7}var YKe=Kr(180),KKe=Kr(120);function QKe(e){return{angleMax:Kr(e.angleMax)}}function ZKe(e,t,r,n){var i=t.types[t.feature],a=r.types[r.feature];if(XKe(i,a)){var o=i===6?[t,r]:[r,t],s=o[0],u=o[1],l=s.members[s.offsets[s.feature]],c=u.members[u.offsets[u.feature]],d=gw(e,s.unit,l,u.unit,c);if(d.length===1&&!(YKe-d[0]>n.angleMax)){var f=gw(e,u.unit,c,s.unit,l);if(f.length!==0&&!f.some(function(p){return KKe-p>n.angleMax}))return 5}}}var JKe=Tn.Provider([6],GKe),eQe=Tn.Provider([7],WKe),tQe={name:"halogen-bonds",params:VKe,createTester:function(e){var t=QKe(e);return{maxDistance:e.distanceMax,requiredFeatures:new Set([6,7]),getType:function(r,n,i){return ZKe(r,n,i,t)}}}},Qre={distanceMax:I.Numeric(3.5,{min:1,max:5,step:.1}),backbone:I.Boolean(!0,{description:"Include backbone-to-backbone hydrogen bonds"}),accAngleDevMax:I.Numeric(45,{min:0,max:180,step:1},{description:"Max deviation from ideal acceptor angle"}),donAngleDevMax:I.Numeric(45,{min:0,max:180,step:1},{description:"Max deviation from ideal donor angle"}),accOutOfPlaneAngleMax:I.Numeric(90,{min:0,max:180,step:1}),donOutOfPlaneAngleMax:I.Numeric(45,{min:0,max:180,step:1})},rQe=E(E({},Qre),{water:I.Boolean(!1,{description:"Include water-to-water hydrogen bonds"}),sulfurDistanceMax:I.Numeric(4.1,{min:1,max:5,step:.1})}),nQe=E({},Qre);function dF(e,t){var r=h2.get(e).value;if(!r)throw Error("expected valence model to be available");var n=r.get(t.id);if(!n)throw Error("expected valence model for unit to be available");return n}function iQe(e,t,r){for(var n=dF(e,t).totalH,i=t.elements,a=t.model.atomicConformation,o=a.x,s=a.y,u=a.z,l=t.rings.elementAromaticRingIndices,c=0,d=i.length;c<d;++c)if(!l.has(c)){var f=jr(t,c);(Zre(t,c)||n[c]>0&&(f==="N"||f==="O"||f==="S"))&&r.add(4,0,o[i[c]],s[i[c]],u[i[c]],c)}}function aQe(e,t,r){for(var n=dF(e,t).totalH,i=t.elements,a=t.model.atomicConformation,o=a.x,s=a.y,u=a.z,l=0,c=i.length;l<c;++l)jr(t,l)==="C"&&n[l]>0&&(ro(e,t,l,"N")>0||ro(e,t,l,"O")>0||oQe(t,l))&&r.add(9,0,o[i[l]],s[i[l]],u[i[l]],l)}function oQe(e,t){var r=e.rings,n=r.elementAromaticRingIndices,i=r.all,a=n.get(t);if(a===void 0)return!1;for(var o=0,s=a.length;o<s;++o)for(var u=i[a[o]],l=0,c=u.length;l<c;++l){var d=jr(e,u[l]);if(d==="N"||d==="O")return!0}return!1}function sQe(e,t,r){for(var n=dF(e,t),i=n.charge,a=n.implicitH,o=n.idealGeometry,s=t.elements,u=t.model.atomicConformation,l=u.x,c=u.y,d=u.z,f=t.rings.elementAromaticRingIndices,p=function(S){r.add(5,0,l[s[S]],c[s[S]],d[s[S]],S)},v=0,h=s.length;v<h;++v)if(!f.has(v)){var m=jr(t,v);if(m==="O")p(v);else if(m==="N"){if(Zre(t,v))p(v);else if(i[v]<1){var g=od(e,t,v)+a[v],y=o[v];(y===4&&g<4||y===3&&g<3||y===2&&g<2)&&p(v)}}else if(m==="S"){var b=cF(t,v);(b==="CYS"||b==="MET"||Wre(t,v)===-1)&&p(v)}}}function LV(e,t){return e.model.atomicHierarchy.derived.residue.moleculeType[e.residueIndex[e.elements[t]]]===2}function FV(e,t){return ed.has(Ob(e,t))}function uQe(e,t){return e.rings.elementRingIndices.has(t)}function Zre(e,t){return cF(e,t)==="HIS"&&jr(e,t)==="N"&&uQe(e,t)}function lQe(e,t,r,n){return FV(e,t)&&FV(r,n)}function cQe(e,t,r,n){return LV(e,t)&&LV(r,n)}function dQe(e,t){return e===5&&t===4||e===4&&t===5}function fQe(e,t){return e===9&&t===5||e===5&&t===9}function Jre(e){return{includeBackbone:e.backbone,maxAccAngleDev:Kr(e.accAngleDevMax),maxDonAngleDev:Kr(e.donAngleDevMax),maxAccOutOfPlaneAngle:Kr(e.accOutOfPlaneAngleMax),maxDonOutOfPlaneAngle:Kr(e.donOutOfPlaneAngleMax)}}function pQe(e){return E(E({},Jre(e)),{includeWater:e.water,maxSulfurDistSq:e.sulfurDistanceMax*e.sulfurDistanceMax,maxDistSq:e.distanceMax*e.distanceMax})}var NV=Kr(120);function ene(e,t,r,n){var i=t.members[t.offsets[t.feature]],a=r.members[r.offsets[r.feature]];if(!(!n.includeBackbone&&lQe(t.unit,i,r.unit,a))){var o=gw(e,t.unit,i,r.unit,a),s=MV.get(t.idealGeometry[i])||NV;if(!o.some(function(d){return Math.abs(s-d)>n.maxDonAngleDev})){if(t.idealGeometry[i]===3){var u=DV(e,t.unit,i,r.unit,a);if(u!==void 0&&u>n.maxDonOutOfPlaneAngle)return}var l=gw(e,r.unit,a,t.unit,i),c=MV.get(r.idealGeometry[a])||NV;if(!l.some(function(d){return c-d>n.maxAccAngleDev})){if(r.idealGeometry[a]===3){var u=DV(e,r.unit,a,t.unit,i);if(u!==void 0&&u>n.maxAccOutOfPlaneAngle)return}return!0}}}}function hQe(e,t,r,n,i){var a=t.types[t.feature],o=r.types[r.feature];if(dQe(a,o)){var s=o===5?[t,r]:[r,t],u=s[0],l=s[1],c=u.members[u.offsets[u.feature]],d=l.members[l.offsets[l.feature]],f=jr(u.unit,c)==="S"||jr(l.unit,d)==="S"?i.maxSulfurDistSq:i.maxDistSq;if(!(n>f)&&!(!i.includeWater&&cQe(u.unit,c,l.unit,d))&&ene(e,u,l,i))return 4}}function vQe(e,t,r,n,i){var a=t.types[t.feature],o=r.types[r.feature];if(fQe(a,o)){var s=o===5?[t,r]:[r,t],u=s[0],l=s[1];if(ene(e,u,l,i))return 8}}var mQe=Tn.Provider([4],iQe),gQe=Tn.Provider([9],aQe),yQe=Tn.Provider([5],sQe),bQe={name:"hydrogen-bonds",params:rQe,createTester:function(e){var t=Math.max(e.distanceMax,e.sulfurDistanceMax),r=pQe(e);return{maxDistance:t,requiredFeatures:new Set([4,5]),getType:function(n,i,a,o){return hQe(n,i,a,o,r)}}}},xQe={name:"weak-hydrogen-bonds",params:nQe,createTester:function(e){var t=Jre(e);return{maxDistance:e.distanceMax,requiredFeatures:new Set([9,5]),getType:function(r,n,i,a){return vQe(r,n,i,a,t)}}}};function SQe(e,t,r){return jr(t,r)==="S"&&ro(e,t,r,"O")===3}function CQe(e,t,r){return jr(t,r)==="S"&&ro(e,t,r,"O")===4}function BV(e,t,r){return jr(t,r)==="P"&&ro(e,t,r,"O")===od(e,t,r)}function _Qe(e,t,r){var n=0;return jr(t,r)==="C"&&ro(e,t,r,"O")===2&&ro(e,t,r,"C")===1&&Qs(e,t,r,function(i,a){jr(i,a)==="O"&&od(e,i,a)-ro(e,i,a,"H")===1&&(n+=1)}),n===2}function wQe(e,t,r){var n=0;return jr(t,r)==="C"&&od(e,t,r)===3&&ro(e,t,r,"N")===3&&Qs(e,t,r,function(i,a){od(e,i,a)-ro(e,i,a,"H")===1&&(n+=1)}),n===2}function EQe(e,t,r){var n=0;return jr(t,r)==="C"&&od(e,t,r)===3&&ro(e,t,r,"N")===2&&ro(e,t,r,"C")===1&&Qs(e,t,r,function(i,a){od(e,i,a)-ro(e,i,a,"H")===1&&(n+=1)}),n===2}var AQe={distanceMax:I.Numeric(5,{min:0,max:8,step:.1})},PQe={distanceMax:I.Numeric(5.5,{min:1,max:8,step:.1}),offsetMax:I.Numeric(2,{min:0,max:4,step:.1}),angleDevMax:I.Numeric(30,{min:0,max:180,step:1})},TQe={distanceMax:I.Numeric(6,{min:1,max:8,step:.1}),offsetMax:I.Numeric(2,{min:0,max:4,step:.1})},IQe=["ARG","HIS","LYS"],MQe=["GLU","ASP"];function tne(e,t){var r=h2.get(e).value;if(!r)throw Error("expected valence model to be available");var n=r.get(t.id);if(!n)throw Error("expected valence model for unit to be available");return n}function DQe(e,t,r){for(var n=tne(e,t).charge,i=t.elements,a=t.model.atomicConformation,o=a.x,s=a.y,u=a.z,l=new Set,c=t.model.atomicHierarchy.atoms.label_comp_id,d=nr.transientSegments(t.model.atomicHierarchy.residueAtomSegments,i);d.hasNext;){var f=d.move(),p=f.index,v=f.start,h=f.end,m=c.value(t.model.atomicHierarchy.residueAtomSegments.offsets[p]);if(IQe.includes(m)){r.startState();for(var g=v;g<h;++g)jr(t,g)==="N"&&!ed.has(Ob(t,g))&&r.pushMember(o[i[g]],s[i[g]],u[i[g]],g);r.finishState(1,0)}else if(!o2.has(m)){l.clear();for(var g=v;g<h;++g){var y=0;wQe(e,t,g)?y=8:EQe(e,t,g)&&(y=9),y&&(r.startState(),Qs(e,t,g,function(S,x){jr(t,x)==="N"&&(l.add(x),r.pushMember(o[i[x]],s[i[x]],u[i[x]],x))}),r.finishState(1,y))}for(var g=v;g<h;++g)n[g]>0&&!l.has(g)&&r.add(1,0,o[i[g]],s[i[g]],u[i[g]],g)}}}function RQe(e,t,r){for(var n=tne(e,t).charge,i=t.elements,a=t.model.atomicConformation,o=a.x,s=a.y,u=a.z,l=new Set,c=t.model.atomicHierarchy.atoms.label_comp_id,d=nr.transientSegments(t.model.atomicHierarchy.residueAtomSegments,i);d.hasNext;){var f=d.move(),p=f.index,v=f.start,h=f.end,m=c.value(t.model.atomicHierarchy.residueAtomSegments.offsets[p]);if(MQe.includes(m)){r.startState();for(var g=v;g<h;++g)jr(t,g)==="O"&&!ed.has(Ob(t,g))&&r.pushMember(o[i[g]],s[i[g]],u[i[g]],g);r.finishState(2,0)}else if(wE.has(m))for(var g=v;g<h;++g)BV(e,t,g)&&(r.startState(),Qs(e,t,g,function(S,x){jr(t,x)==="O"&&r.pushMember(o[i[x]],s[i[x]],u[i[x]],x)}),r.finishState(2,6));else if(!o2.has(m)){for(var g=v;g<h;++g){r.startState(),jr(t,g)==="N"&&!ed.has(Ob(t,g))&&r.pushMember(o[i[g]],s[i[g]],u[i[g]],g),r.finishState(2,0);var y=0;SQe(e,t,g)?y=4:BV(e,t,g)?y=6:CQe(e,t,g)?y=5:_Qe(e,t,g)&&(y=10),y&&(r.startState(),Qs(e,t,g,function(S,x){jr(t,x)==="O"&&(l.add(x),r.pushMember(o[i[x]],s[i[x]],u[i[x]],x))}),r.finishState(2,y))}for(var g=v;g<h;++g)n[g]<0&&!l.has(g)&&r.add(2,0,o[i[g]],s[i[g]],u[i[g]],g)}}}function kQe(e,t,r){for(var n=t.elements,i=t.model.atomicConformation,a=i.x,o=i.y,s=i.z,u=0,l=t.rings.aromaticRings;u<l.length;u++){var c=l[u],d=t.rings.all[c];r.startState();for(var f=0,p=d.length;f<p;++f){var v=d[f];r.pushMember(a[n[v]],o[n[v]],s[n[v]],v)}r.finishState(3,0)}}function OQe(e,t){return e===2&&t===1||e===1&&t===2}function LQe(e,t){return e===3&&t===3}function FQe(e,t){return e===3&&t===1||e===1&&t===3}var UV=_(),jV=_();function NQe(e,t,r){for(var n=e.feature,i=e.offsets,a=e.members,o=t.feature,s=t.offsets,u=t.members,l=i[n],c=i[n+1];l<c;++l){var d=a[l];e.unit.conformation.position(e.unit.elements[d],UV);for(var f=s[o],p=s[o+1];f<p;++f){var v=u[f];if(t.unit.conformation.position(t.unit.elements[v],jV),_.squaredDistance(UV,jV)<r)return!0}}return!1}var yw=_(),Qm=_(),bw=_(),Hx=_();function rR(e,t){var r=t.unit,n=t.feature,i=t.offsets,a=t.members,o=r.elements,s=i[n];return t.unit.conformation.position(o[a[s]],yw),t.unit.conformation.position(o[a[s+1]],Qm),t.unit.conformation.position(o[a[s+2]],bw),_.triangleNormal(e,yw,Qm,bw)}var nR=function(e,t,r){return Tn.position(yw,e),Tn.position(Qm,t),_.sub(bw,yw,Qm),_.projectOnPlane(Hx,bw,r),_.add(Hx,Hx,Qm),_.distance(Hx,Qm)};function BQe(e){return{distanceMaxSq:e.distanceMax*e.distanceMax}}function UQe(e){return{offsetMax:e.offsetMax,angleDevMax:Kr(e.angleDevMax)}}function jQe(e){return{offsetMax:e.offsetMax}}var zQe=Kr(180),zV=Kr(90),E1=_(),bT=_();function VQe(e,t,r,n,i){var a=t.types[t.feature],o=r.types[r.feature];if(OQe(a,o)&&NQe(t,r,i.distanceMaxSq))return 1}function HQe(e,t,r,n,i){var a=t.types[t.feature],o=r.types[r.feature];if(LQe(a,o)){rR(E1,t),rR(bT,r);var s=_.angle(E1,bT),u=Math.min(nR(t,r,bT),nR(r,t,E1));if(u<=i.offsetMax){if(s<=i.angleDevMax||s>=zQe-i.angleDevMax)return 3;if(s<=i.angleDevMax+zV&&s>=zV-i.angleDevMax)return 3}}}function GQe(e,t,r,n,i){var a=t.types[t.feature],o=r.types[r.feature];if(FQe(a,o)){var s=a===3?[t,r]:[r,t],u=s[0],l=s[1];rR(E1,u);var c=nR(l,u,E1);if(c<=i.offsetMax)return 2}}var qQe=Tn.Provider([2],RQe),$Qe=Tn.Provider([1],DQe),WQe=Tn.Provider([3],kQe),XQe={name:"ionic",params:AQe,createTester:function(e){var t=BQe(e);return{maxDistance:e.distanceMax,requiredFeatures:new Set([2,1]),getType:function(r,n,i,a){return VQe(r,n,i,a,t)}}}},YQe={name:"pi-stacking",params:PQe,createTester:function(e){var t=UQe(e);return{maxDistance:e.distanceMax,requiredFeatures:new Set([3]),getType:function(r,n,i,a){return HQe(r,n,i,a,t)}}}},KQe={name:"cation-pi",params:TQe,createTester:function(e){var t=jQe(e);return{maxDistance:e.distanceMax,requiredFeatures:new Set([3,1]),getType:function(r,n,i,a){return GQe(r,n,i,a,t)}}}},QQe={distanceMax:I.Numeric(4,{min:1,max:5,step:.1})};function ZQe(e,t,r){for(var n=t.elements,i=t.model.atomicConformation,a=i.x,o=i.y,s=i.z,u=function(d,f){var p=jr(t,d),v=!1;p==="C"?(v=!0,Qs(e,t,d,function(h,m){var g=jr(h,m);g!=="C"&&g!=="H"&&(v=!1)})):p==="F"&&(v=!0),v&&r.add(8,0,a[n[d]],o[n[d]],s[n[d]],d)},l=0,c=n.length;l<c;++l)u(l)}function JQe(e,t){return e===8&&t===8}function eZe(e,t,r,n){var i=t.types[t.feature],a=r.types[r.feature];if(JQe(i,a)){var o=t.members[t.offsets[t.feature]],s=r.members[r.offsets[r.feature]];if(!(jr(t.unit,o)==="F"&&jr(r.unit,s)==="F"))return 6}}var tZe=Tn.Provider([8],ZQe),rZe={name:"hydrophobic",params:QQe,createTester:function(e){return{maxDistance:e.distanceMax,requiredFeatures:new Set([8]),getType:function(t,r,n,i){return eZe(t,r,n)}}}},nZe={distanceMax:I.Numeric(3,{min:1,max:5,step:.1})},iZe=["LI","NA","K","RB","CS","MG","CA","SR","BA","AL","GA","IN","TL","SC","SN","PB","BI","SB","HG"];function aZe(e,t,r){for(var n=t.elements,i=t.model.atomicConformation,a=i.x,o=i.y,s=i.z,u=0,l=n.length;u<l;++u){var c=jr(t,u),d=0;iZe.includes(c)?d=13:(Are(c)||c==="ZN"||c==="CD")&&(d=12),d&&r.add(d,0,a[n[u]],o[n[u]],s[n[u]],u)}}function VV(e){return!ed.has(e)}function oZe(e){return ed.has(e)}function sZe(e){return bE.has(e)}function uZe(e,t,r){for(var n=t.elements,i=t.model.atomicConformation,a=i.x,o=i.y,s=i.z,u=0,l=n.length;u<l;++u){var c=jr(t,u),d=cF(t,u),f=Ob(t,u),p=!1,v=!1,h=SE.has(d),m=wE.has(d);!h&&!m?nYe(c)||c==="O"||c==="S"?(p=!0,v=!0):c==="N"&&(p=!0):h?c==="O"?(["ASP","GLU","SER","THR","TYR","ASN","GLN"].includes(d)&&VV(f)||oZe(f))&&(p=!0,v=!0):c==="S"&&(d==="CYS"||d==="MET")?(p=!0,v=!0):c==="N"&&d==="HIS"&&VV(f)&&(p=!0):m&&(c==="O"&&sZe(f)?(p=!0,v=!0):["N3","N4","N7"].includes(f)?p=!0:["O2","O4","O6"].includes(f)&&(p=!0,v=!0)),p&&r.add(11,0,a[n[u]],o[n[u]],s[n[u]],u),v&&r.add(10,0,a[n[u]],o[n[u]],s[n[u]],u)}}function HV(e,t){if(e===12)return t===11||t===12;if(e===13)return t===10}function lZe(e,t,r,n){var i=t.types[t.feature],a=r.types[r.feature];if(!(!HV(i,a)&&!HV(a,i)))return 7}var cZe=Tn.Provider([13,12],aZe),dZe=Tn.Provider([10,11],uZe),fZe={name:"metal-coordination",params:nZe,createTester:function(e){return{maxDistance:e.distanceMax,requiredFeatures:new Set([13,12,10,11]),getType:function(t,r,n,i){return lZe(t,r,n)}}}};function pZe(e,t){for(var r=t.contacts,n=t.unitsContacts,i=t.unitsFeatures,a=[hZe(e,t),vZe(e,t),mZe(e,t),gZe(e,t),yZe(e,t)],o=0,s=r.edgeCount;o<s;++o){var u=r.edges[o],l=e.unitMap.get(u.unitA),c=e.unitMap.get(u.unitB),d=Tn.Info(e,l,i.get(u.unitA));d.feature=u.indexA;var f=Tn.Info(e,c,i.get(u.unitB));f.feature=u.indexB;for(var p=0,v=a;p<v.length;p++){var h=v[p];h.isApplicable(u.props.type)&&h.handleInterContact(o,d,f)}}for(var m=n.keys();;){var g=m.next(),y=g.done,b=g.value;if(y)break;var S=n.get(b),x=i.get(b),C=e.unitMap.get(b);if(je.isAtomic(C)){for(var d=Tn.Info(e,C,x),f=Tn.Info(e,C,x),w=0,A=a;w<A.length;w++){var h=A[w];h.startUnit(C,S,x)}for(var o=0,s=S.edgeCount*2;o<s;++o){d.feature=S.a[o],f.feature=S.b[o];for(var M=0,D=a;M<D.length;M++){var h=D[M];h.isApplicable(S.edgeProps.type[o])&&h.handleIntraContact(o,d,f)}}}}}function hZe(e,t){var r=t.contacts,n=function(l,c,d,f,p){var v=f.get(d)||[1/0,-1],h=v[0],m=v[1];l<h?(m!==-1&&p(m),f.set(d,[l,c])):p(c)};function i(l,c,d,f,p){var v=c.members[c.offsets[c.feature]],h=d.members[d.offsets[d.feature]],m=c.unit.getResidueIndex(v),g=d.unit.getResidueIndex(h),y=v+"|"+c.unit.id+"|"+g+"|"+d.unit.id+"|A",b=h+"|"+d.unit.id+"|"+m+"|"+c.unit.id+"|B",S=Tn.distance(c,d);n(S,l,y,f,p),n(S,l,b,f,p)}var a=new Map,o=function(l){return r.edges[l].props.flag=1},s,u;return{isApplicable:function(l){return l===6},handleInterContact:function(l,c,d){i(l,c,d,a,o)},startUnit:function(l,c,d){s=new Map,u=function(f){return c.edgeProps.flag[f]=1}},handleIntraContact:function(l,c,d){i(l,c,d,s,u)}}}function vZe(e,t){var r=t.contacts,n=function(i,a){for(var o=i.types[i.feature]===9?a:i,s=o.members[o.offsets[o.feature]],u=t.unitsContacts.get(o.unit.id),l=u.edgeProps.type,c=u.elementsIndex,d=c.offsets,f=c.indices,p=d[s],v=d[s+1];p<v;++p)if(l[f[p]]===4)return!0;for(var h=r.getEdgeIndices(o.feature,o.unit.id),p=0,v=h.length;p<v;++p)if(r.edges[h[p]].props.type===4)return!0;return!1};return{isApplicable:function(i){return i===8},handleInterContact:function(i,a,o){n(a,o)&&(r.edges[i].props.flag=1)},startUnit:function(){},handleIntraContact:function(i,a,o){if(n(a,o)){var s=t.unitsContacts.get(a.unit.id).edgeProps.flag;s[i]=1}}}}function fF(e,t,r,n,i){for(var a=r.offsets,o=r.feature,s=n.offsets,u=n.feature,l=a[o],c=a[o+1];l<c;++l)for(var d=r.members[l],f=i.getContactIndicesForElement(d,r.unit),p=0,v=f.length;p<v;++p){var h=f[p];if(e.includes(i.edges[h].props.type))for(var m=s[u],g=s[u+1];m<g;++m){var y=n.members[m];if(i.getContactIndicesForElement(y,n.unit).includes(h)){i.edges[t].props.flag=1;return}}}}function pF(e,t,r,n,i){for(var a=i.edgeProps,o=a.type,s=a.flag,u=i.elementsIndex,l=u.offsets,c=u.indices,d=r.offsets,f=r.feature,p=n.offsets,v=n.feature,h=d[f],m=d[f+1];h<m;++h)for(var g=r.members[h],y=l[g],b=l[g+1];y<b;++y){var S=c[y];if(e.includes(o[S])){for(var x=p[v],C=p[v+1];x<C;++x)for(var w=n.members[x],A=l[w],M=l[w+1];A<M;++A)if(S===c[A]){s[t]=1;return}}}}function mZe(e,t){var r=t.contacts;return{isApplicable:function(n){return n===1},handleInterContact:function(n,i,a){fF([4,8],n,i,a,r)},startUnit:function(){},handleIntraContact:function(n,i,a){pF([4,8],n,i,a,t.unitsContacts.get(i.unit.id))}}}function gZe(e,t){var r=t.contacts;return{isApplicable:function(n){return n===6||n===2},handleInterContact:function(n,i,a){fF([3],n,i,a,r)},startUnit:function(){},handleIntraContact:function(n,i,a){pF([3],n,i,a,t.unitsContacts.get(i.unit.id))}}}function yZe(e,t){var r=t.contacts;return{isApplicable:function(n){return n===1},handleInterContact:function(n,i,a){fF([7],n,i,a,r)},startUnit:function(){},handleIntraContact:function(n,i,a){pF([7],n,i,a,t.unitsContacts.get(i.unit.id))}}}var sd;(function(e){function t(c,d,f,p,v,h){return HZ("interactions",{structure:d,interactions:c},{unitA:f,indexA:p,unitB:v,indexB:h})}e.Location=t;function r(c){return!!c&&c.kind==="data-location"&&c.tag==="interactions"}e.isLocation=r;function n(c,d){return c.data.structure===d.data.structure&&c.data.interactions===d.data.interactions&&c.element.indexA===d.element.indexA&&c.element.indexB===d.element.indexB&&c.element.unitA===d.element.unitA&&c.element.unitB===d.element.unitB}e.areLocationsEqual=n;function i(c,d){var f=d.unitA,p=d.indexA,v=d.unitB,h=d.indexB,m=c.contacts,g=c.unitsContacts;if(f===v){var y=g.get(f.id),b=y.getDirectedEdgeIndex(p,h);return RV(y.edgeProps.type[b])}else{var b=m.getEdgeIndex(p,f.id,h,v.id);return RV(m.edges[b].props.type)}}function a(c){return i(c.data.interactions,c.element)}e.locationLabel=a;function o(c,d,f){return UE("interactions",{structure:c,interactions:d},f,function(p){return u(d,f,p)},function(){return l(c,d,f)})}e.Loci=o;function s(c){return!!c&&c.kind==="data-loci"&&c.tag==="interactions"}e.isLoci=s;function u(c,d,f){var p=c.unitsFeatures;return rd.fromPairProvider(d.length,function(v,h,m){var g=d[v];Tn.setPosition(h,g.unitA,g.indexA,p.get(g.unitA.id)),Tn.setPosition(m,g.unitB,g.indexB,p.get(g.unitB.id))},f)}e.getBoundingSphere=u;function l(c,d,f){var p=f[0];if(p===void 0)return"";var v=p.unitA,h=p.indexA,m=p.unitB,g=p.indexB,y=d.unitsFeatures,b=y.get(v.id),S=b.members,x=b.offsets,C=y.get(m.id),w=C.members,A=C.offsets,M={granularity:"element"};return(x[h+1]-x[h]>1||A[g+1]-A[g]>1)&&(M.granularity="residue"),[i(d,p),JL(Vt.Location(c,v,S[x[h]],c,m,w[A[g]]),M)].join("</br>")}e.getLabel=l})(sd||(sd={}));var bZe=[mQe,gQe,yQe,qQe,$Qe,WQe,JKe,eQe,tZe,cZe,dZe],xw={ionic:XQe,"pi-stacking":YQe,"cation-pi":KQe,"halogen-bonds":tQe,"hydrogen-bonds":bQe,"weak-hydrogen-bonds":xQe,hydrophobic:rZe,"metal-coordination":fZe};function xZe(e){e===void 0&&(e=[]);var t=Object.create(null);return Object.keys(xw).forEach(function(r){t[r]=I.MappedStatic(e.includes(r)?"on":"off",{on:I.Group(xw[r].params),off:I.Group({})},{cycle:!0})}),t}var SZe=xZe(["cation-pi","pi-stacking","hydrogen-bonds","halogen-bonds","metal-coordination"]),rne={providers:I.Group(SZe,{isFlat:!0}),contacts:I.Group(LKe,{label:"Advanced Options"})};function CZe(e,t,r){return ce(this,void 0,void 0,function(){var n,i,a,o,s,u,l,c,d,f,p,v,h,m,g,y;return de(this,function(b){switch(b.label){case 0:return n=E(E({},I.getDefaultValues(rne)),r),[4,h2.attach(e,t)];case 1:b.sent(),i=[],BE(xw).forEach(function(S){var x=n.providers[S],C=x.name,w=x.params;C==="on"&&i.push(xw[S].createTester(w))}),a=new Set,i.forEach(function(S){return hi.add(a,S.requiredFeatures)}),o=bZe.filter(function(S){return hi.areIntersecting(a,S.types)}),s=Ws.Mutable(),u=Ws.Mutable(),l=0,c=t.unitSymmetryGroups.length,b.label=2;case 2:return l<c?(d=t.unitSymmetryGroups[l],e.runtime.shouldUpdate?[4,e.runtime.update({message:"computing interactions",current:l,max:c})]:[3,4]):[3,6];case 3:b.sent(),b.label=4;case 4:for(f=_Ze(t,d.units[0],o),p=wZe(t,d.units[0],f,i,n.contacts),v=0,h=d.units.length;v<h;++v)m=d.units[v],s.set(m.id,f),u.set(m.id,p);b.label=5;case 5:return++l,[3,2];case 6:return g=EZe(t,s,i,n.contacts),y={unitsFeatures:s,unitsContacts:u,contacts:g},pZe(t,y),[2,y]}})})}function _Ze(e,t,r){var n=t.elements.length,i=ZD.create(n,n/2);if(je.isAtomic(t))for(var a=0,o=r;a<o.length;a++){var s=o[a];s.add(e,t,i)}return i.getFeatures(n)}function wZe(e,t,r,n,i){var a=eR.create(r,t.elements.length);return je.isAtomic(t)&&BKe(e,t,r,a,n,i),a.getContacts()}function EZe(e,t,r,n){var i=tR.create();return We.eachUnitPair(e,function(a,o){var s=t.get(a.id),u=t.get(o.id);zKe(e,a,s,o,u,i,r,n)},{maxRadius:Math.max.apply(Math,r.map(function(a){return a.maxDistance})),validUnit:function(a){return je.isAtomic(a)},validUnitPair:function(a,o){return We.validUnitPair(e,a,o)}}),i.getContacts(t)}var xT=E({},rne),Wn=hp.createProvider({label:"Interactions",descriptor:To({name:"molstar_computed_interactions"}),type:"local",defaultParams:xT,getParams:function(e){return xT},isApplicable:function(e){return!e.isCoarseGrained},obtain:function(e,t,r){return ce(void 0,void 0,void 0,function(){var n,i;return de(this,function(a){switch(a.label){case 0:return n=E(E({},I.getDefaultValues(xT)),r),i={},[4,CZe(e,t,n)];case 1:return[2,(i.value=a.sent(),i)]}})})}}),Gx=_(),qx=_(),$p=_(),ST=qe.add,GV=qe.add3,Sw;(function(e){function t(r,n,i){r===void 0&&(r=2048),n===void 0&&(n=1024);var a=qe.create(Float32Array,1,n,i?i.groupBuffer.ref.value:r),o=qe.create(Float32Array,3,n,i?i.startBuffer.ref.value:r),s=qe.create(Float32Array,3,n,i?i.endBuffer.ref.value:r),u=qe.create(Float32Array,1,n,i?i.scaleBuffer.ref.value:r),l=qe.create(Float32Array,1,n,i?i.capBuffer.ref.value:r),c=function(f,p,v,h,m,g,y,b,S,x){for(var C=0;C<6;++C)GV(o,f,p,v),GV(s,h,m,g),ST(a,x),ST(u,y),ST(l,(b?1:0)+(S?2:0))},d=function(f,p,v,h,m,g,y){var b=_.distance(f,p),S=Math.floor(v/2),x=1/v;_.sub($p,p,f);for(var C=0;C<S;++C){var w=x*(C*2+1);_.setMagnitude($p,$p,b*w),_.add(Gx,f,$p),_.setMagnitude($p,$p,b*x*((C+1)*2)),_.add(qx,f,$p),c(Gx[0],Gx[1],Gx[2],qx[0],qx[1],qx[2],h,m,g,y)}};return{add:c,addFixedCountDashes:d,addFixedLengthDashes:function(f,p,v,h,m,g,y){var b=_.distance(f,p);d(f,p,b/v,h,m,g,y)},getCylinders:function(){var f=a.elementCount/6,p=qe.compact(a,!0),v=qe.compact(o,!0),h=qe.compact(s,!0),m=qe.compact(u,!0),g=qe.compact(l,!0),y=i&&f<=i.cylinderCount?i.mappingBuffer.ref.value:new Float32Array(f*18),b=i&&f<=i.cylinderCount?i.indexBuffer.ref.value:new Uint32Array(f*12);return(!i||f>i.cylinderCount)&&AZe(f,y,b),Jo.create(y,b,p,v,h,m,g,f,i)}}}e.create=t})(Sw||(Sw={}));function AZe(e,t,r){for(var n=0;n<e;++n){var i=n*18;t[i]=-1,t[i+1]=1,t[i+2]=-1,t[i+3]=-1,t[i+4]=-1,t[i+5]=-1,t[i+6]=1,t[i+7]=1,t[i+8]=-1,t[i+9]=1,t[i+10]=1,t[i+11]=1,t[i+12]=1,t[i+13]=-1,t[i+14]=-1,t[i+15]=1,t[i+16]=-1,t[i+17]=1}for(var n=0;n<e;++n){var a=n*6,o=n*12;r[o]=a,r[o+1]=a+1,r[o+2]=a+2,r[o+3]=a+1,r[o+4]=a+4,r[o+5]=a+2,r[o+6]=a+2,r[o+7]=a+4,r[o+8]=a+3,r[o+9]=a+4,r[o+10]=a+5,r[o+11]=a+3}}var Hv={linkScale:I.Numeric(.45,{min:0,max:1,step:.01}),linkSpacing:I.Numeric(1,{min:0,max:2,step:.01}),linkCap:I.Boolean(!1),dashCount:I.Numeric(4,{min:2,max:10,step:2}),dashScale:I.Numeric(.8,{min:0,max:2,step:.1}),dashCap:I.Boolean(!0),stubCap:I.Boolean(!0),radialSegments:I.Numeric(16,{min:2,max:56,step:2},Et.CustomQualityParamInfo)};I.getDefaultValues(Hv);var nne={linkScale:I.Numeric(.5,{min:0,max:1,step:.1}),linkSpacing:I.Numeric(.1,{min:0,max:2,step:.01}),dashCount:I.Numeric(4,{min:2,max:10,step:2})};I.getDefaultValues(nne);var Nn=_(),Wd=_(),Ss=_(),PZe=_.create(0,1,0);function hF(e,t,r,n){_.normalize(Wd,_.sub(Wd,t,r)),n!==null?_.sub(Ss,t,n):_.copy(Ss,t),_.normalize(Ss,Ss);var i=_.dot(Wd,Ss);return 1-Math.abs(i)<1e-5&&(_.set(Ss,1,0,0),i=_.dot(Wd,Ss),1-Math.abs(i)<1e-5&&(_.set(Ss,0,1,0),i=_.dot(Wd,Ss))),_.setMagnitude(Wd,Wd,i),_.sub(Ss,Ss,Wd),_.normalize(e,Ss)}var Cu=_.scale,qo=_.add,Mi=_.sub,Uc=_.setMagnitude,TZe=_.dot;function Gv(e,t,r,n){var i=t.linkCount,a=t.referencePosition,o=t.position,s=t.style,u=t.radius,l=t.ignore,c=t.stub;if(!i)return Ft.createEmpty(n);for(var d=r.linkScale,f=r.linkSpacing,p=r.radialSegments,v=r.linkCap,h=r.dashCount,m=r.dashScale,g=r.dashCap,y=r.stubCap,b=p*2*i*2,S=wt.createState(b,b/4,n),x=_(),C=_(),w=_(),A={radiusTop:1,radiusBottom:1,radialSegments:p,topCap:v,bottomCap:v},M=h+1,D=0,k=i;D<k;++D)if(!(l&&l(D))){o(x,C,D),Mi(Nn,C,x);var R=u(D),O=s?s(D):0,H=y&&(c?c(D):!1),B=TZe(Nn,PZe)>0?[H,v]:[v,H],j=B[0],Y=B[1];S.currentGroup=D;var G=4.5;if(O===0)A.radiusTop=A.radiusBottom=R,A.topCap=j,A.bottomCap=Y,Ua(S,x,C,.5,A);else if(O===1)A.radiusTop=A.radiusBottom=R*m,A.topCap=A.bottomCap=g,_1(S,x,C,.5,M,A);else if(O===2||O===3||O===5||O===6){var $=O===2?2:O===3?3:1.5,q=R*(d/(.5*$)),ee=(R-q)*f;hF(w,x,C,a?a(D):null),A.topCap=j,A.bottomCap=Y,O===5||O===6?(A.radiusTop=A.radiusBottom=R,Ua(S,x,C,.5,A),A.radiusTop=A.radiusBottom=R*d,A.topCap=A.bottomCap=g,Uc(w,w,ee*G),Mi(x,x,w),Mi(C,C,w),_1(S,x,C,.5,3,A),O===6&&(Uc(w,w,ee*G*2),qo(x,x,w),qo(C,C,w),_1(S,x,C,.5,3,A))):(Uc(w,w,ee),A.radiusTop=A.radiusBottom=q,$===3&&Ua(S,x,C,.5,A),iVe(S,x,C,.5,w,A))}else O===4&&(Cu(Nn,Nn,.475),qo(x,x,Nn),Mi(C,C,Nn),A.radiusTop=A.radiusBottom=R,A.topCap=j,A.bottomCap=Y,Ua(S,x,C,.5,A))}return wt.getMesh(S)}function ine(e,t,r,n){var i=t.linkCount,a=t.referencePosition,o=t.position,s=t.style,u=t.radius,l=t.ignore,c=t.stub;if(!i)return Jo.createEmpty(n);for(var d=r.linkScale,f=r.linkSpacing,p=r.linkCap,v=r.dashCount,h=r.dashScale,m=r.dashCap,g=r.stubCap,y=i*2,b=Sw.create(y,y/4,n),S=_(),x=_(),C=_(),w=_(),A=v%2===1?v:v+1,M=.5-.5/2/A,D=3,k=.5-.5/2/D,R=4.5,O=0,H=i;O<H;++O)if(!(l&&l(O))){o(S,x,O);var B=u(O),j=s?s(O):0,Y=g&&(c?c(O):!1);if(j===0)Cu(C,qo(C,S,x),.5),b.add(S[0],S[1],S[2],C[0],C[1],C[2],1,p,Y,O);else if(j===1)Cu(Nn,Mi(Nn,x,S),M),Mi(x,x,Nn),b.addFixedCountDashes(S,x,A,h,m,m,O);else if(j===2||j===3||j===5||j===6){var G=j===2?2:j===3?3:1.5,$=d/(.5*G),q=(B-$*B)*f;Cu(C,qo(C,S,x),.5),hF(w,S,x,a?a(O):null),j===5||j===6?(b.add(S[0],S[1],S[2],C[0],C[1],C[2],1,p,Y,O),Cu(Nn,Mi(Nn,x,S),k),Mi(x,x,Nn),Uc(w,w,q*R),Mi(S,S,w),Mi(x,x,w),b.addFixedCountDashes(S,x,D,d,m,m,O),j===6&&(Uc(w,w,q*R*2),qo(S,S,w),qo(x,x,w),b.addFixedCountDashes(S,x,D,d,m,m,O))):(Uc(w,w,q),G===3&&b.add(S[0],S[1],S[2],C[0],C[1],C[2],$,p,!1,O),b.add(S[0]+w[0],S[1]+w[1],S[2]+w[2],C[0]+w[0],C[1]+w[1],C[2]+w[2],$,p,Y,O),b.add(S[0]-w[0],S[1]-w[1],S[2]-w[2],C[0]-w[0],C[1]-w[1],C[2]-w[2],$,p,Y,O))}else j===4&&(Cu(Nn,Mi(Nn,x,S),.475),qo(S,S,Nn),Mi(x,x,Nn),b.add(S[0],S[1],S[2],x[0],x[1],x[2],1,p,Y,O))}return b.getCylinders()}function ane(e,t,r,n){var i=t.linkCount,a=t.referencePosition,o=t.position,s=t.style,u=t.ignore;if(!i)return wn.createEmpty(n);for(var l=r.linkScale,c=r.linkSpacing,d=r.dashCount,f=i*2,p=ls.create(f,f/4,n),v=_(),h=_(),m=_(),g=_(),y=d%2===1?d:d+1,b=.5-.5/2/y,S=3,x=.5-.5/2/S,C=4.5,w=0,A=i;w<A;++w)if(!(u&&u(w))){o(v,h,w);var M=s?s(w):0;if(M===0)Cu(m,qo(m,v,h),.5),p.add(v[0],v[1],v[2],m[0],m[1],m[2],w);else if(M===1)Cu(Nn,Mi(Nn,h,v),b),Mi(h,h,Nn),p.addFixedCountDashes(v,h,y,w);else if(M===2||M===3||M===5||M===6){var D=M===2?2:M===3?3:1.5,k=1*(l/(.5*D)),R=(1-k)*c;Cu(m,qo(m,v,h),.5),hF(g,v,h,a?a(w):null),M===5||M===6?(p.add(v[0],v[1],v[2],m[0],m[1],m[2],w),Cu(Nn,Mi(Nn,h,v),x),Mi(h,h,Nn),Uc(g,g,R*C),Mi(v,v,g),Mi(h,h,g),p.addFixedCountDashes(v,h,S,w),M===6&&(Uc(g,g,R*C*2),qo(v,v,g),qo(h,h,g),p.addFixedCountDashes(v,h,S,w))):(Uc(g,g,R),D===3&&p.add(v[0],v[1],v[2],m[0],m[1],m[2],w),p.add(v[0]+g[0],v[1]+g[1],v[2]+g[2],m[0]+g[0],m[1]+g[1],m[2]+g[2],w),p.add(v[0]-g[0],v[1]-g[1],v[2]-g[2],m[0]-g[0],m[1]-g[1],m[2]-g[2],w))}else M===4&&(Cu(Nn,Mi(Nn,h,v),.475),qo(v,v,Nn),Mi(h,h,Nn),p.add(v[0],v[1],v[2],h[0],h[1],h[2],w))}return p.getLines()}function IZe(e,t,r,n,i,a){return ce(this,void 0,void 0,function(){var o,s,u,l,c,d,f,p,v,h,m,g,y,b,S,x,C,w,A;return de(this,function(M){return je.isAtomic(t)?(o=r.child,s=o==null?void 0:o.unitMap.get(t.id),o&&!s?[2,Ft.createEmpty(a)]:(u=Ze.create(r,t),l=Wn.get(r).value,c=l.unitsFeatures.get(t.id),d=l.unitsContacts.get(t.id),f=c.x,p=c.y,v=c.z,h=c.members,m=c.offsets,g=d.edgeCount,y=d.a,b=d.b,S=d.edgeProps.flag,x=i.sizeFactor,g?(C={linkCount:g*2,position:function(D,k,R){_.set(D,f[y[R]],p[y[R]],v[y[R]]),_.set(k,f[b[R]],p[b[R]],v[b[R]])},style:function(D){return 1},radius:function(D){u.element=t.elements[h[m[y[D]]]];var k=n.size.size(u);u.element=t.elements[h[m[b[D]]]];var R=n.size.size(u);return Math.min(k,R)*x},ignore:function(D){return S[D]===1||!!s&&!Je.has(s.elements,t.elements[h[m[y[D]]]])}},w=Gv(e,C,i,a),A=Be.expand(Be(),(s??t).boundary.sphere,1*x),w.setBoundingSphere(A),[2,w]):[2,Ft.createEmpty(a)])):[2,Ft.createEmpty(a)]})})}var one=E(E(E({},Ea),Hv),{sizeFactor:I.Numeric(.3,{min:0,max:10,step:.01}),dashCount:I.Numeric(6,{min:2,max:10,step:2}),dashScale:I.Numeric(.4,{min:0,max:2,step:.1}),includeParent:I.Boolean(!1)});function MZe(e){return uo({defaultProps:I.getDefaultValues(one),createGeometry:IZe,createLocationIterator:kZe,getLoci:DZe,eachLocation:RZe,setUpdateState:function(t,r,n,i,a,o,s){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.dashCount!==n.dashCount||r.dashScale!==n.dashScale||r.dashCap!==n.dashCap||r.radialSegments!==n.radialSegments;var u=Wn.get(o.structure).version;t.info.interactionsHash!==u&&(t.createGeometry=!0,t.updateTransform=!0,t.updateColor=!0,t.info.interactionsHash=u)}},e)}function DZe(e,t,r){var n=e.objectId,i=e.instanceId,a=e.groupId;if(r===n){var o=t.structure,s=t.group,u=o.unitMap.get(s.units[i].id),l=Wn.get(o).value,c=l.unitsContacts.get(u.id),d=c.a,f=c.b;return sd.Loci(o,l,[{unitA:u,indexA:d[a],unitB:u,indexB:f[a]},{unitA:u,indexA:f[a],unitB:u,indexB:d[a]}])}return Nr}function RZe(e,t,r,n){var i=!1;if(sd.isLoci(e)){var a=t.structure,o=t.group;if(!We.areEquivalent(e.data.structure,a))return!1;var s=Wn.get(a).value;if(e.data.interactions!==s)return!1;for(var u=o.units[0],l=s.unitsContacts.get(u.id),c=l.edgeCount*2,d=0,f=e.elements;d<f.length;d++){var p=f[d];if(p.unitA===p.unitB){var v=o.unitIndexMap.get(p.unitA.id);if(v!==void 0){var h=l.getDirectedEdgeIndex(p.indexA,p.indexB);h!==-1&&r(Ie.ofSingleton(v*c+h))&&(i=!0)}}}}else if(Re.is(e)){var a=t.structure,o=t.group;if(!We.areEquivalent(e.structure,a))return!1;var s=Wn.get(a).value;if(!s)return!1;for(var u=o.units[0],l=s.unitsContacts.get(u.id),m=s.unitsFeatures.get(u.id),g=l.edgeCount*2,y=l.offset,b=m.elementsIndex,S=b.offsets,x=b.indices,C=function(H){var B=o.unitIndexMap.get(H.unit.id);if(B!==void 0||n&&Le.size(H.indices)===1)return"continue";Le.forEach(H.indices,function(j){for(var Y=S[j],G=S[j+1];Y<G;++Y)for(var $=x[Y],q=y[$],ee=y[$+1];q<ee;++q)r(Ie.ofSingleton(B*g+q))&&(i=!0)})},w=0,A=e.elements;w<A.length;w++){var p=A[w];C(p)}}return i}function kZe(e){var t=e.structure,r=e.group,n=r.units[0],i=Wn.get(t).value,a=i.unitsContacts.get(n.id),o=a.edgeCount*2,s=r.units.length,u=sd.Location(i,t),l=u.element,c=function(d,f){var p=r.units[f];return l.unitA=p,l.indexA=a.a[d],l.unitB=p,l.indexB=a.b[d],u};return Sn(o,s,1,c)}function OZe(e,t,r,n,i){if(!t.hasAtomic)return Ft.createEmpty(i);var a=Ze.create(t),o=Wn.get(t).value,s=o.contacts,u=o.unitsFeatures,l=s.edgeCount,c=s.edges,d=n.sizeFactor;if(!l)return Ft.createEmpty(i);var f=t.child,p={linkCount:l,position:function(m,g,y){var b=c[y],S=b.unitA,x=b.indexA,C=b.unitB,w=b.indexB,A=u.get(S),M=u.get(C),D=t.unitMap.get(S),k=t.unitMap.get(C);_.set(m,A.x[x],A.y[x],A.z[x]),_.transformMat4(m,m,D.conformation.operator.matrix),_.set(g,M.x[w],M.y[w],M.z[w]),_.transformMat4(g,g,k.conformation.operator.matrix)},style:function(m){return 1},radius:function(m){var g=c[m],y=u.get(g.unitA);a.unit=t.unitMap.get(g.unitA),a.element=a.unit.elements[y.members[y.offsets[g.indexA]]];var b=r.size.size(a),S=u.get(g.unitB);a.unit=t.unitMap.get(g.unitB),a.element=a.unit.elements[S.members[S.offsets[g.indexB]]];var x=r.size.size(a);return Math.min(b,x)*d},ignore:function(m){if(c[m].props.flag===1)return!0;if(f){var g=c[m],y=f.unitMap.get(g.unitA);if(!y)return!0;var b=t.unitMap.get(g.unitA),S=u.get(g.unitA),x=b.elements[S.members[S.offsets[g.indexA]]];if(!Je.has(y.elements,x))return!0}return!1}},v=Gv(e,p,n,i),h=Be.expand(Be(),(f??t).boundary.sphere,1*d);return v.setBoundingSphere(h),v}var sne=E(E(E({},p2),Hv),{sizeFactor:I.Numeric(.3,{min:0,max:10,step:.01}),dashCount:I.Numeric(6,{min:2,max:10,step:2}),dashScale:I.Numeric(.4,{min:0,max:2,step:.1}),includeParent:I.Boolean(!1)});function LZe(e){return zv({defaultProps:I.getDefaultValues(sne),createGeometry:OZe,createLocationIterator:BZe,getLoci:FZe,eachLocation:NZe,setUpdateState:function(t,r,n,i,a,o,s){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.dashCount!==n.dashCount||r.dashScale!==n.dashScale||r.dashCap!==n.dashCap||r.radialSegments!==n.radialSegments;var u=Wn.get(o).version;t.info.interactionsHash!==u&&(t.createGeometry=!0,t.updateTransform=!0,t.updateColor=!0,t.info.interactionsHash=u)}},e)}function FZe(e,t,r){var n=e.objectId,i=e.groupId;if(r===n){var a=Wn.get(t).value,o=a.contacts.edges[i],s=t.unitMap.get(o.unitA),u=t.unitMap.get(o.unitB);return sd.Loci(t,a,[{unitA:s,indexA:o.indexA,unitB:u,indexB:o.indexB},{unitA:u,indexA:o.indexB,unitB:s,indexB:o.indexA}])}return Nr}function NZe(e,t,r,n){var i,a=!1;if(sd.isLoci(e)){if(!We.areEquivalent(e.data.structure,t))return!1;var o=Wn.get(t).value;if(e.data.interactions!==o)return!1;for(var s=o.contacts,u=0,l=e.elements;u<l.length;u++){var c=l[u],d=s.getEdgeIndex(c.indexA,c.unitA.id,c.indexB,c.unitB.id);d!==-1&&r(Ie.ofSingleton(d))&&(a=!0)}}else if(Re.is(e)){if(!We.areEquivalent(e.structure,t)||n&&e.elements.length===1)return!1;var f=(i=Wn.get(t).value)===null||i===void 0?void 0:i.contacts;if(!f)return!1;for(var p=function(g){var y=g.unit;if(!je.isAtomic(y)||n&&Le.size(g.indices)===1)return"continue";Le.forEach(g.indices,function(b){for(var S=0,x=f.getContactIndicesForElement(b,y);S<x.length;S++){var C=x[S];r(Ie.ofSingleton(C))&&(a=!0)}})},v=0,h=e.elements;v<h.length;v++){var m=h[v];p(m)}}return a}function BZe(e){var t=Wn.get(e).value,r=t.contacts,n=r.edgeCount,i=1,a=sd.Location(t,e),o=a.element,s=function(u){var l=r.edges[u];return o.unitA=e.unitMap.get(l.unitA),o.indexA=l.indexA,o.unitB=e.unitMap.get(l.unitB),o.indexB=l.indexB,a};return Sn(n,i,1,s,!0)}var une={"intra-unit":function(e,t){return ii("Intra-unit interactions cylinder",e,t,MZe)},"inter-unit":function(e,t){return Ru("Inter-unit interactions cylinder",e,t,LZe)}},lne=E(E(E({},one),sne),{unitKinds:f2(["atomic"]),sizeFactor:I.Numeric(.2,{min:.01,max:1,step:.01}),visuals:I.MultiSelect(["intra-unit","inter-unit"],I.objectToOptions(une))});function UZe(e,t){return I.clone(lne)}function jZe(e,t){return or.createMulti("Interactions",e,t,Ui,une)}var Cw={name:"interactions",label:"Non-covalent Interactions",description:"Displays non-covalent interactions as dashed cylinders.",factory:jZe,getParams:UZe,defaultValues:I.getDefaultValues(lne),defaultColorTheme:{name:"interaction-type"},defaultSizeTheme:{name:"uniform"},isApplicable:function(e){return e.elementCount>0&&Wn.isApplicable(e)},ensureCustomProperties:{attach:function(e,t){return Wn.attach(e,t,void 0,!0)},detach:function(e){return Wn.ref(e,!1)}},getData:function(e,t){return t.includeParent?e.asParent():e},mustRecreate:function(e,t){return e.includeParent!==t.includeParent}},iR=at(13421772),zZe="Assigns colors according the interaction type of a link.",Oa={HydrogenBond:2851770,Hydrophobic:8421504,HalogenBond:4259775,Ionic:15779860,MetalCoordination:9191577,CationPi:16744448,PiStacking:9220966,WeakHydrogenBond:12967404},VZe=[["Hydrogen Bond",Oa.HydrogenBond],["Hydrophobic",Oa.Hydrophobic],["Halogen Bond",Oa.HalogenBond],["Ionic",Oa.Ionic],["Metal Coordination",Oa.MetalCoordination],["Cation Pi",Oa.CationPi],["Pi Stacking",Oa.PiStacking],["Weak HydrogenBond",Oa.WeakHydrogenBond]];function qV(e){switch(e){case 4:return Oa.HydrogenBond;case 6:return Oa.Hydrophobic;case 5:return Oa.HalogenBond;case 1:return Oa.Ionic;case 7:return Oa.MetalCoordination;case 2:return Oa.CationPi;case 3:return Oa.PiStacking;case 8:return Oa.WeakHydrogenBond;case 0:return iR}}var cne={};function HZe(e){return cne}function dne(e,t){var r,n=e.structure?Wn.get(e.structure):void 0,i=n?Dv(n.id,n.version):-1;return n&&n.value?r=function(a){if(sd.isLocation(a)){var o=a.data.interactions,s=o.unitsContacts,u=o.contacts,l=a.element,c=l.unitA,d=l.unitB,f=l.indexA,p=l.indexB;if(c===d){var v=s.get(c.id),h=v.getDirectedEdgeIndex(f,p);return qV(v.edgeProps.type[h])}else{var h=u.getEdgeIndex(f,c.id,p,d.id);return qV(u.edges[h].props.type)}}return iR}:r=function(){return iR},{factory:dne,granularity:"group",color:r,props:t,contextHash:i,description:zZe,legend:Pp(VZe)}}var aR={name:"interaction-type",label:"Interaction Type",category:"Miscellaneous",factory:dne,getParams:HZe,defaultValues:I.getDefaultValues(cne),isApplicable:function(e){return!!e.structure},ensureCustomProperties:{attach:function(e,t){return t.structure?Wn.attach(e,t.structure,void 0,!0):Promise.resolve()},detach:function(e){return e.structure&&Wn.ref(e.structure,!1)}}};function nC(e,t,r){r===void 0&&(r={});var n=r;return typeof n.type=="string"||typeof n.color=="string"||typeof n.size=="string"?qZe(e,t||We.Empty,r):fne(e,t||We.Empty,r)}function GZe(e,t){var r=e.representation.structure.themes;return t?r.colorThemeRegistry.getApplicableTypes({structure:t}):r.colorThemeRegistry.types}function oR(e,t,r,n,i){var a=e.representation.structure,o=a.registry,s=a.themes,u=o.get(r||o.default.name),l=s.colorThemeRegistry.get(n||u.defaultColorTheme.name),c=I.getDefaultValues(l.getParams({structure:t||We.Empty}));return l.name===u.defaultColorTheme.name&&Object.assign(c,u.defaultColorTheme.props),{name:l.name,params:Object.assign(c,i)}}function $V(e,t,r,n,i){var a=e.representation.structure,o=a.registry,s=a.themes,u=o.get(r||o.default.name),l=s.sizeThemeRegistry.get(n||u.defaultSizeTheme.name),c=I.getDefaultValues(l.getParams({structure:t||We.Empty}));return l.name===u.defaultSizeTheme.name&&Object.assign(c,u.defaultSizeTheme.props),{name:l.name,params:Object.assign(c,i)}}function qZe(e,t,r){var n=r.type&&e.representation.structure.registry.get(r.type)||e.representation.structure.registry.default.provider,i=r.color&&e.representation.structure.themes.colorThemeRegistry.get(r.color)||e.representation.structure.themes.colorThemeRegistry.get(n.defaultColorTheme.name),a=r.size&&e.representation.structure.themes.sizeThemeRegistry.get(r.size)||e.representation.structure.themes.sizeThemeRegistry.get(n.defaultSizeTheme.name);return fne(e,t,{type:n,typeParams:r.typeParams,color:i,colorParams:r.colorParams,size:a,sizeParams:r.sizeParams})}function fne(e,t,r){r===void 0&&(r={});var n=e.representation.structure.themes,i={structure:t},a=r.type||e.representation.structure.registry.default.provider,o=I.getDefaultValues(a.getParams(n,t)),s=Object.assign(o,r.typeParams),u=r.color||n.colorThemeRegistry.get(a.defaultColorTheme.name),l=I.getDefaultValues(u.getParams(i));u.name===a.defaultColorTheme.name&&Object.assign(l,a.defaultColorTheme.props);var c=Object.assign(l,r.colorParams),d=r.size||n.sizeThemeRegistry.get(a.defaultSizeTheme.name),f=I.getDefaultValues(d.getParams(i));d.name===a.defaultSizeTheme.name&&Object.assign(f,a.defaultSizeTheme.props);var p=Object.assign(f,r.sizeParams);return{type:{name:a.name,params:s},colorTheme:{name:u.name,params:c},sizeTheme:{name:d.name,params:p}}}var Or;(function(e){var t=function(c){Fe(d,c);function d(){return c!==null&&c.apply(this,arguments)||this}return d}(ge.Create({name:"Root",typeClass:"Root"}));e.Root=t;var r=function(c){Fe(d,c);function d(){return c!==null&&c.apply(this,arguments)||this}return d}(ge.Create({name:"Category",typeClass:"Object"}));e.Category=r;var n=function(c){Fe(d,c);function d(){return c!==null&&c.apply(this,arguments)||this}return d}(ge.CreateBehavior({name:"Behavior"}));e.Behavior=n,e.Categories={common:"Common",representation:"Representation",interaction:"Interaction","custom-props":"Custom Properties",misc:"Miscellaneous"},e.CreateCategory=kt.BuiltIn({name:"create-behavior-category",display:{name:"Behavior Category"},from:t,to:r,params:{label:I.Text("",{isHidden:!0})}})({apply:function(c){var d=c.params;return new r({},{label:d.label})}});var i=new Map;function a(c){return i.get(c.id)}e.getCategoryId=a;function o(c){var d=kt.CreateBuiltIn({name:c.name,display:c.display,from:[t],to:[n],params:c.params,apply:function(f,p){var v=f.params,h=c.label?c.label(v):{label:c.display.name,description:c.display.description};return new n(new c.ctor(p,v),h)},update:function(f){var p=this,v=f.b,h=f.newParams;return $e.create("Update Behavior",function(){return ce(p,void 0,void 0,function(){var m;return de(this,function(g){switch(g.label){case 0:return v.data.update?[4,v.data.update(h)]:[2,ft.UpdateResult.Unchanged];case 1:return m=g.sent(),[2,m?ft.UpdateResult.Updated:ft.UpdateResult.Unchanged]}})})})},canAutoUpdate:c.canAutoUpdate});return i.set(d.id,c.category),d}e.create=o;function s(c,d){return function(){function f(p){this.ctx=p,this.sub=void 0}return f.prototype.register=function(){var p=this;this.sub=c.subscribe(this.ctx,function(v){return d(v,p.ctx)})},f.prototype.unregister=function(){this.sub&&this.sub.unsubscribe(),this.sub=void 0},f}()}e.simpleCommandHandler=s;var u=function(){function c(d,f){this.ctx=d,this.params=f,this.subs=[]}return c.prototype.subscribeCommand=function(d,f){this.subs.push(d.subscribe(this.ctx,f))},c.prototype.subscribeObservable=function(d,f){this.subs.push(d.subscribe(f))},c.prototype.track=function(d){this.subs.push(d)},c.prototype.unregister=function(){for(var d=0,f=this.subs;d<f.length;d++){var p=f[d];p.unsubscribe()}this.subs=[]},c.prototype.update=function(d){return Hg(d,this.params)?!1:(this.params=d,!0)},c}();e.Handler=u;var l=function(){function c(d,f){this.plugin=d,this.params=f,this.subs=[]}return c.prototype.subscribeCommand=function(d,f){this.subs.push(d.subscribe(this.plugin,f))},c.prototype.subscribeObservable=function(d,f){this.subs.push(d.subscribe(f))},c.prototype.unregister=function(){for(var d=0,f=this.subs;d<f.length;d++){var p=f[d];p.unsubscribe()}this.subs=[]},c}();e.WithSubscribers=l})(Or||(Or={}));var v2=function(){function e(){this.subs=void 0}return e.prototype.subscribe=function(t,r){var n=this;typeof this.subs>"u"&&(this.subs=[]);var i=t.subscribe(r);return this.subs.push(i),{unsubscribe:function(){i&&n.subs&&Nh(n.subs,i)&&(i.unsubscribe(),i=void 0)}}},Object.defineProperty(e.prototype,"ev",{get:function(){return this._ev||(this._ev=Jc.create())},enumerable:!1,configurable:!0}),e.prototype.dispose=function(){if(this._ev&&this._ev.dispose(),this.subs){for(var t=0,r=this.subs;t<r.length;t++){var n=r[t];n.unsubscribe()}this.subs=void 0}},e}(),kd=function(e){Fe(t,e);function t(r){var n=e.call(this)||this;return n._state=r,n}return t.prototype.updateState=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];var i=this.state,a=g5e(i,r);return a!==i?(this._state=a,!0):!1},Object.defineProperty(t.prototype,"state",{get:function(){return this._state},enumerable:!1,configurable:!0}),t}(v2),sR="2.2.0",$Ze=new Date(typeof __MOLSTAR_DEBUG_TIMESTAMP__<"u"?__MOLSTAR_DEBUG_TIMESTAMP__:1627737258743),_w=function(e){Fe(t,e);function t(r){var n=e.call(this,{current:void 0,entries:si.List(),isPlaying:!1,nextSnapshotDelayInMs:t.DefaultNextSnapshotDelayInMs})||this;return n.plugin=r,n.entryMap=new Map,n.events={changed:n.ev()},n.timeoutHandle=void 0,n.next=function(){return ce(n,void 0,void 0,function(){var i,a,o;return de(this,function(s){switch(s.label){case 0:return this.timeoutHandle=void 0,i=this.getNextId(this.state.current,1),!i||i===this.state.current?(this.stop(),[2]):(a=this.setCurrent(i),[4,this.plugin.state.setSnapshot(a)]);case 1:return s.sent(),o=typeof a.durationInMs<"u"?a.durationInMs:this.state.nextSnapshotDelayInMs,this.state.isPlaying&&(this.timeoutHandle=setTimeout(this.next,o)),[2]}})})},n}return t.prototype.getIndex=function(r){return this.state.entries.indexOf(r)},t.prototype.getEntry=function(r){if(r)return this.entryMap.get(r)},t.prototype.remove=function(r){var n=this.entryMap.get(r);n&&(this.entryMap.delete(r),this.updateState({current:this.state.current===r?void 0:this.state.current,entries:this.state.entries.delete(this.getIndex(n))}),this.events.changed.next())},t.prototype.add=function(r){this.entryMap.set(r.snapshot.id,r),this.updateState({current:r.snapshot.id,entries:this.state.entries.push(r)}),this.events.changed.next()},t.prototype.replace=function(r,n){var i=this.getEntry(r);if(i){var a=this.getIndex(i),o=t.Entry(n,{name:i.name,description:i.description});this.entryMap.set(n.id,o),this.updateState({current:o.snapshot.id,entries:this.state.entries.set(a,o)}),this.events.changed.next()}},t.prototype.move=function(r,n){var i=this.state.entries.size;if(!(i<2)){var a=this.getEntry(r);if(a){var o=this.getIndex(a),s=(o+n)%i;s<0&&(s+=i);var u=this.state.entries.get(s),l=this.state.entries.asMutable();l.set(s,a),l.set(o,u),this.updateState({current:a.snapshot.id,entries:l.asImmutable()}),this.events.changed.next()}}},t.prototype.clear=function(){this.state.entries.size!==0&&(this.entryMap.clear(),this.updateState({current:void 0,entries:si.List()}),this.events.changed.next())},t.prototype.setCurrent=function(r){var n=this.getEntry(r);return n&&(this.updateState({current:r}),this.events.changed.next()),n&&n.snapshot},t.prototype.getNextId=function(r,n){var i=this.state.entries.size;if(!r){if(i===0)return;var a=n===-1?i-1:0;return this.state.entries.get(a).snapshot.id}var o=this.getEntry(r);if(o){var s=this.getIndex(o);if(!(s<0))return s=(s+n)%i,s<0&&(s+=i),this.state.entries.get(s).snapshot.id}},t.prototype.setStateSnapshot=function(r){return ce(this,void 0,void 0,function(){var n,i,a,o,s,u,l;return de(this,function(c){switch(c.label){case 0:for(r.version,this.clear(),n=si.List().asMutable(),i=0,a=r.entries;i<a.length;i++)o=a[i],this.entryMap.set(o.snapshot.id,o),n.push(o);return s=r.current?r.current:r.entries.length>0?r.entries[0].snapshot.id:void 0,this.updateState({current:s,entries:n.asImmutable(),isPlaying:!1,nextSnapshotDelayInMs:r.playback?r.playback.nextSnapshotDelayInMs:t.DefaultNextSnapshotDelayInMs}),this.events.changed.next(),s?(u=this.getEntry(s),l=u&&u.snapshot,l?[4,this.plugin.state.setSnapshot(l)]:[2]):[2];case 1:return c.sent(),r.playback&&r.playback.isPlaying&&this.play(!0),[2,l]}})})},t.prototype.syncCurrent=function(r){var n=this.plugin.state.getSnapshot(r==null?void 0:r.params);this.state.entries.size===0||!this.state.current?this.add(t.Entry(n,{name:r==null?void 0:r.name,description:r==null?void 0:r.description})):this.replace(this.state.current,n)},t.prototype.getStateSnapshot=function(r){return this.syncCurrent(r),{timestamp:+new Date,version:sR,name:r&&r.name,description:r&&r.description,current:this.state.current,playback:{isPlaying:!!(r&&r.playOnLoad),nextSnapshotDelayInMs:this.state.nextSnapshotDelayInMs},entries:this.state.entries.valueSeq().toArray()}},t.prototype.serialize=function(r){return ce(this,void 0,void 0,function(){var n,i,a,o,s,u,l,c,d,f,p,v,h,m,g;return de(this,function(y){switch(y.label){case 0:return n=JSON.stringify(this.getStateSnapshot({params:r==null?void 0:r.params}),null,2),!(r!=null&&r.type)||r.type==="json"||r.type==="molj"?[2,new Blob([n],{type:"application/json;charset=utf-8"})]:[3,1];case 1:i=new Uint8Array(R_(n)),$m(i,0,n),a={"state.json":i},o=[],s=0,u=this.plugin.managers.asset.assets,y.label=2;case 2:return s<u.length?(l=u[s],c=l.asset,d=l.file,o.push([c.id,c]),f=a,p="assets/"+c.id,v=Uint8Array.bind,[4,d.arrayBuffer()]):[3,5];case 3:f[p]=new(v.apply(Uint8Array,[void 0,y.sent()])),y.label=4;case 4:return s++,[3,2];case 5:return o.length>0&&(h=JSON.stringify(o,null,2),m=new Uint8Array(R_(h)),$m(m,0,h),a["assets.json"]=m),[4,this.plugin.runTask(Y5e(a))];case 6:return g=y.sent(),[2,new Blob([g],{type:"application/zip"})]}})})},t.prototype.open=function(r){return ce(this,void 0,void 0,function(){var n,i,g,i,a,o,s,u,l,c,d,f,p,v,h,m,g,y;return de(this,function(b){switch(b.label){case 0:return b.trys.push([0,8,,9]),n=r.name.toLowerCase(),n.endsWith("json")||n.endsWith("molj")?[4,this.plugin.runTask(Rf(r,"string"))]:[3,2];case 1:return i=b.sent(),g=JSON.parse(i),t.isStateSnapshot(g)?[2,this.setStateSnapshot(g)]:t.isStateSnapshot(g.data)?[2,this.setStateSnapshot(g.data)]:(this.plugin.state.setSnapshot(g),[3,7]);case 2:return[4,this.plugin.runTask(Rf(r,"zip"))];case 3:return i=b.sent(),a=Object.create(null),ju(i,function(S,x){if(!(x==="state.json"||x==="assets.json")){var C=x.substring(x.indexOf("/")+1);a[C]=new File([S],C)}}),o=new File([i["state.json"]],"state.json"),[4,this.plugin.runTask(Rf(o,"string"))];case 4:return s=b.sent(),i["assets.json"]?(u=new File([i["assets.json"]],"assets.json"),d=(c=JSON).parse,[4,this.plugin.runTask(Rf(u,"string"))]):[3,6];case 5:for(l=d.apply(c,[b.sent()]),f=0,p=l;f<p.length;f++)v=p[f],h=v[0],m=v[1],this.plugin.managers.asset.set(m,a[h]);b.label=6;case 6:return g=JSON.parse(s),[2,this.setStateSnapshot(g)];case 7:return[3,9];case 8:return y=b.sent(),this.plugin.log.error("Reading state: "+y),[3,9];case 9:return[2]}})})},t.prototype.play=function(r){if(r===void 0&&(r=!1),this.updateState({isPlaying:!0}),r){var n=this.getEntry(this.state.current);if(!n){this.next();return}this.events.changed.next();var i=n.snapshot,a=typeof i.durationInMs<"u"?i.durationInMs:this.state.nextSnapshotDelayInMs;this.timeoutHandle=setTimeout(this.next,a)}else this.next()},t.prototype.stop=function(){this.updateState({isPlaying:!1}),typeof this.timeoutHandle<"u"&&clearTimeout(this.timeoutHandle),this.timeoutHandle=void 0,this.events.changed.next()},t.prototype.togglePlay=function(){this.state.isPlaying?(this.stop(),this.plugin.managers.animation.stop()):this.play()},t.DefaultNextSnapshotDelayInMs=1500,t}(kd);(function(e){function t(n,i){return E({timestamp:+new Date,snapshot:n},i)}e.Entry=t;function r(n){var i=n;return!!i&&!!i.timestamp&&!!i.entries}e.isStateSnapshot=r})(_w||(_w={}));function WZe(e){return e.toISOString().replace(/T/," ").replace(/\..+/,"")}function XZe(){var e=new Date,t=e.getFullYear(),r=e.getMonth()+1,n=e.getDate(),i=e.getHours(),a=e.getMinutes(),o=e.getSeconds();return t+"-"+r+"-"+n+"-"+i+"-"+a+"-"+o}function YZe(e){var t=window.open(e,"_blank");t||(window.location.href=e)}function WV(e){try{e.dispatchEvent(new MouseEvent("click"))}catch{var t=document.createEvent("MouseEvents");t.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),e.dispatchEvent(t)}}function pne(e,t){if(t===void 0&&(t="download"),!!e)if("download"in HTMLAnchorElement.prototype){var r=document.createElement("a");r.download=t,r.rel="noopener",typeof e=="string"?(r.href=e,WV(r)):(r.href=URL.createObjectURL(e),setTimeout(function(){return URL.revokeObjectURL(r.href)},4e4),setTimeout(function(){return WV(r)}))}else if(typeof navigator<"u"&&navigator.msSaveOrOpenBlob)navigator.msSaveOrOpenBlob(e,t);else{var n=window.navigator.userAgent,i=/Safari/i.test(n),a=/CriOS\/[\d]+/.test(n),o=function(l){YZe(a?l:l.replace(/^data:[^;]*;/,"data:attachment/file;"))};if((i||a)&&FileReader)if(e instanceof Blob){var s=new FileReader;s.onloadend=function(){return o(s.result)},s.readAsDataURL(e)}else o(e);else{var u=URL.createObjectURL(e);location.href=u,setTimeout(function(){return URL.revokeObjectURL(u)},4e4)}}}function eA(e,t){return""+e+(e[e.length-1]==="/"||t[0]==="/"?"":"/")+t}function _n(){var e=function(t,r){return t.commands.dispatch(e,r||{})};return e.subscribe=function(t,r){return t.commands.subscribe(e,r)},e.id=mn.create22(),e}var KZe=function(){function e(){this.subs=new Map,this.disposing=!1}return e.prototype.subscribe=function(t,r){var n=this,i=this.subs.get(t.id);return i||(i=[],this.subs.set(t.id,i)),i.push(r),{unsubscribe:function(){var a=n.subs.get(t.id);if(a){var o=a.indexOf(r);if(!(o<0)){for(var s=o+1;s<a.length;s++)a[s-1]=a[s];a.pop()}}}}},e.prototype.dispatch=function(t,r){var n=this;return new Promise(function(i,a){if(n.disposing){a("disposed");return}var o=n.subs.get(t.id);if(!o){i();return}n.resolve({cmd:t,params:r,resolve:i,reject:a})})},e.prototype.dispose=function(){this.subs.clear()},e.prototype.resolve=function(t){return ce(this,void 0,void 0,function(){var r,n,i,a,o;return de(this,function(s){switch(s.label){case 0:if(r=this.subs.get(t.cmd.id),!r)return t.resolve(),[2];s.label=1;case 1:s.trys.push([1,6,,7]),n=0,i=r,s.label=2;case 2:return n<i.length?(a=i[n],[4,a(t.params)]):[3,5];case 3:s.sent(),s.label=4;case 4:return n++,[3,2];case 5:return t.resolve(),[3,7];case 6:return o=s.sent(),t.reject(o),[3,7];case 7:return[2]}})})},e}(),_t={State:{SetCurrentObject:_n(),ApplyAction:_n(),Update:_n(),RemoveObject:_n(),ToggleExpanded:_n(),ToggleVisibility:_n(),Snapshots:{Add:_n(),Replace:_n(),Move:_n(),Remove:_n(),Apply:_n(),Clear:_n(),Upload:_n(),Fetch:_n(),DownloadToFile:_n(),OpenFile:_n(),OpenUrl:_n()}},Interactivity:{Object:{Highlight:_n()},Structure:{Highlight:_n(),Select:_n()},ClearHighlights:_n()},Layout:{Update:_n()},Toast:{Show:_n(),Hide:_n()},Camera:{Reset:_n(),SetSnapshot:_n(),Focus:_n()},Canvas3D:{SetSettings:_n(),ResetSettings:_n()}};function QZe(e){hne(e),vne(e),mne(e),gne(e),yne(e),bne(e),xne(e),Sne(e),Cne(e),_ne(e)}function hne(e){e.state.events.object.created.subscribe(function(t){ge.isBehavior(t.obj)&&t.obj.data.register(t.ref)}),e.state.events.object.removed.subscribe(function(t){ge.isBehavior(t.obj)&&t.obj.data.unregister()}),e.state.events.object.updated.subscribe(function(t){t.action==="recreate"&&(t.oldObj&&ge.isBehavior(t.oldObj)&&t.oldObj.data.unregister(),t.obj&&ge.isBehavior(t.obj)&&t.obj.data.register(t.ref))})}function vne(e){_t.State.SetCurrentObject.subscribe(e,function(t){var r=t.state,n=t.ref;return r.setCurrent(n)})}function mne(e){_t.State.Update.subscribe(e,function(t){var r=t.state,n=t.tree,i=t.options;return e.runTask(r.updateTree(n,i))})}function gne(e){_t.State.ApplyAction.subscribe(e,function(t){var r=t.state,n=t.action,i=t.ref;return e.runTask(r.applyAction(n.action,n.params,i))})}function yne(e){function t(r,n){var i=r.build().delete(n);return e.runTask(r.updateTree(i))}_t.State.RemoveObject.subscribe(e,function(r){var n=r.state,i=r.ref,a=r.removeParentGhosts;if(a){var o=n.tree,s=o.transforms.get(i);if(s.parent===i)return t(n,i);for(;;){var u=o.children.get(s.parent);if(s.parent===s.ref||u.size>1)return t(n,s.ref);var l=o.transforms.get(s.parent);if(!l.state.isGhost)return t(n,s.ref);s=l}}else return t(n,i)})}function bne(e){_t.State.ToggleExpanded.subscribe(e,function(t){var r=t.state,n=t.ref;return r.updateCellState(n,function(i){var a=i.isCollapsed;return{isCollapsed:!a}})})}function xne(e){_t.State.ToggleVisibility.subscribe(e,function(t){var r=t.state,n=t.ref;return Sv(r,n,!r.cells.get(n).state.isHidden)})}function Sv(e,t,r){li.doPreOrder(e.tree,e.transforms.get(t),{state:e,value:r},ZZe)}function ZZe(e,t,r){r.state.updateCellState(e.ref,{isHidden:r.value})}function Sne(e){_t.Interactivity.Object.Highlight.subscribe(e,function(t){var r=t.state,n=t.ref;if(!(!e.canvas3d||e.isBusy)){e.managers.interactivity.lociHighlights.clearHighlights();for(var i=typeof n=="string"?[n]:n,a=0,o=i;a<o.length;a++){var s=o[a],u=r.cells.get(s);if(u){if(ge.Molecule.Structure.is(u.obj))e.managers.interactivity.lociHighlights.highlight({loci:We.Loci(u.obj.data)},!1);else if(u&&ge.isRepresentation3D(u.obj)){var l=u.obj.data.repr;e.managers.interactivity.lociHighlights.highlight({loci:l.getLoci(),repr:l},!1)}else if(ge.Molecule.Structure.Selections.is(u.obj))for(var c=0,d=u.obj.data;c<d.length;c++){var f=d[c];e.managers.interactivity.lociHighlights.highlight({loci:f.loci},!1)}}}}})}function Cne(e){_t.Interactivity.ClearHighlights.subscribe(e,function(){e.managers.interactivity.lociHighlights.clearHighlights()})}function _ne(e){var t=this;e.config.set(Yr.State.CurrentServer,e.config.get(Yr.State.DefaultServer)),_t.State.Snapshots.Clear.subscribe(e,function(){e.managers.snapshot.clear()}),_t.State.Snapshots.Remove.subscribe(e,function(r){var n=r.id;e.managers.snapshot.remove(n)}),_t.State.Snapshots.Add.subscribe(e,function(r){var n=r.name,i=r.description,a=r.params,o=_w.Entry(e.state.getSnapshot(a),{name:n,description:i});e.managers.snapshot.add(o)}),_t.State.Snapshots.Replace.subscribe(e,function(r){var n=r.id,i=r.params;e.managers.snapshot.replace(n,e.state.getSnapshot(i))}),_t.State.Snapshots.Move.subscribe(e,function(r){var n=r.id,i=r.dir;e.managers.snapshot.move(n,i)}),_t.State.Snapshots.Apply.subscribe(e,function(r){var n=r.id,i=e.managers.snapshot.setCurrent(n);if(i)return e.state.setSnapshot(i)}),_t.State.Snapshots.Upload.subscribe(e,function(r){var n=r.name,i=r.description,a=r.playOnLoad,o=r.serverUrl;return r.params,fetch(eA(o,"set?name="+encodeURIComponent(n||"")+"&description="+encodeURIComponent(i||"")),{method:"POST",mode:"cors",referrer:"no-referrer",headers:{"Content-Type":"application/json; charset=utf-8"},body:JSON.stringify(e.managers.snapshot.getStateSnapshot({name:n,description:i,playOnLoad:a}))})}),_t.State.Snapshots.Fetch.subscribe(e,function(r){var n=r.url;return ce(t,void 0,void 0,function(){var i;return de(this,function(a){switch(a.label){case 0:return[4,e.runTask(e.fetch({url:n,type:"json"}))];case 1:return i=a.sent(),[4,e.managers.snapshot.setStateSnapshot(i.data)];case 2:return a.sent(),[2]}})})}),_t.State.Snapshots.DownloadToFile.subscribe(e,function(r){var n=r.name,i=r.type,a=r.params;return ce(t,void 0,void 0,function(){var o,s;return de(this,function(u){switch(u.label){case 0:return o="mol-star_state_"+(n||XZe())+"."+(i==="json"?"molj":"molx"),[4,e.managers.snapshot.serialize({type:i,params:a})];case 1:return s=u.sent(),pne(s,""+o),[2]}})})}),_t.State.Snapshots.OpenFile.subscribe(e,function(r){var n=r.file;return e.managers.snapshot.open(n)}),_t.State.Snapshots.OpenUrl.subscribe(e,function(r){var n=r.url,i=r.type;return ce(t,void 0,void 0,function(){var a;return de(this,function(o){switch(o.label){case 0:return[4,e.runTask(e.fetch({url:n,type:"binary"}))];case 1:return a=o.sent(),[2,e.managers.snapshot.open(new File([a],"state."+i))]}})})})}const JZe=Object.freeze(Object.defineProperty({__proto__:null,ApplyAction:gne,ClearHighlights:Cne,Highlight:Sne,RemoveObject:yne,SetCurrentObject:vne,Snapshots:_ne,SyncBehaviors:hne,ToggleExpanded:bne,ToggleVisibility:xne,Update:mne,registerDefault:QZe,setSubtreeVisibility:Sv},Symbol.toStringTag,{value:"Module"}));function eJe(e){wne(e),Ene(e),Ane(e)}function wne(e){var t=e.state.data.events;t.object.created.subscribe(function(r){var n;ge.isRepresentation3D(r.obj)&&(uR(r.state.cells.get(r.ref),r.obj.data.repr),r.obj.data.repr.setState({syncManually:!0}),(n=e.canvas3d)===null||n===void 0||n.add(r.obj.data.repr))}),t.object.updated.subscribe(function(r){var n,i;r.oldObj&&ge.isRepresentation3D(r.oldObj)&&((n=e.canvas3d)===null||n===void 0||n.remove(r.oldObj.data.repr),r.oldObj.data.repr.destroy()),ge.isRepresentation3D(r.obj)&&(uR(r.state.cells.get(r.ref),r.obj.data.repr),r.action==="recreate"&&r.obj.data.repr.setState({syncManually:!0}),(i=e.canvas3d)===null||i===void 0||i.add(r.obj.data.repr))}),t.object.removed.subscribe(function(r){var n;ge.isRepresentation3D(r.obj)&&((n=e.canvas3d)===null||n===void 0||n.remove(r.obj.data.repr),r.obj.data.repr.destroy())})}function Ene(e){var t=e.state.data.events;t.object.created.subscribe(function(r){var n;if(ge.Molecule.Structure.Representation3DState.is(r.obj)){var i=r.obj.data;i.repr.setState(i.state),(n=e.canvas3d)===null||n===void 0||n.update(i.repr)}}),t.object.updated.subscribe(function(r){var n;if(ge.Molecule.Structure.Representation3DState.is(r.obj)){var i=r.obj.data;i.repr.setState(i.state),(n=e.canvas3d)===null||n===void 0||n.update(i.repr)}}),t.object.removed.subscribe(function(r){var n;if(ge.Molecule.Structure.Representation3DState.is(r.obj)){var i=r.obj.data;i.repr.setState(i.initialState),(n=e.canvas3d)===null||n===void 0||n.update(i.repr)}})}function Ane(e){e.state.data.events.cell.stateUpdated.subscribe(function(t){var r,n=t.state.cells.get(t.ref);ge.isRepresentation3D(n.obj)&&uR(n,n.obj.data.repr)&&((r=e.canvas3d)===null||r===void 0||r.syncVisibility())})}function uR(e,t){return t.state.visible===e.state.isHidden?(t.setState({visible:!e.state.isHidden}),!0):!1}const tJe=Object.freeze(Object.defineProperty({__proto__:null,SyncRepresentationToCanvas:wne,SyncStructureRepresentation3DState:Ene,UpdateRepresentationVisibility:Ane,registerDefault:eJe},Symbol.toStringTag,{value:"Module"}));function rJe(e){Pne(e),Ine(e),Tne(e)}function Pne(e){_t.Camera.Reset.subscribe(e,function(t){e.managers.camera.reset(t==null?void 0:t.snapshot,t==null?void 0:t.durationMs)})}function Tne(e){_t.Camera.SetSnapshot.subscribe(e,function(t){var r=t.snapshot,n=t.durationMs;e.managers.camera.setSnapshot(r,n)})}function Ine(e){_t.Camera.Focus.subscribe(e,function(t){var r=t.center,n=t.radius,i=t.durationMs;e.managers.camera.focusSphere({center:r,radius:n},{durationMs:i}),e.events.canvas3d.settingsUpdated.next()})}const nJe=Object.freeze(Object.defineProperty({__proto__:null,Focus:Ine,Reset:Pne,SetSnapshot:Tne,registerDefault:rJe},Symbol.toStringTag,{value:"Module"}));function Ah(e){if(typeof e=="object"){if("buttons"in e)return e.buttons;if("which"in e){var t=e.which;if(t===2)return 4;if(t===3)return 2;if(t>0)return 1<<t-1}}return 0}function Zm(e){if(typeof e=="object"&&"button"in e){var t=e.button;if(t===1)return 4;if(t===2)return 2;if(t>=0)return 1<<t}return 0}function $x(e){return{alt:"altKey"in e?e.altKey:!1,shift:"shiftKey"in e?e.shiftKey:!1,control:"ctrlKey"in e?e.ctrlKey:!1,meta:"metaKey"in e?e.metaKey:!1}}var XV={noScroll:!0,noMiddleClickScroll:!0,noContextMenu:!0,noPinchZoom:!0,noTextSelect:!0,mask:function(e,t){return!0},pixelScale:1},ku;(function(e){e.None=n();function t(i,a){return i.shift===a.shift&&i.alt===a.alt&&i.control===a.control&&i.meta===a.meta}e.areEqual=t;function r(i){if(!i)return 0;var a=0;return i.shift&&a++,i.alt&&a++,i.control&&a++,i.meta&&a++,a}e.size=r;function n(i){return i===void 0&&(i={}),{shift:!!i.shift,alt:!!i.alt,control:!!i.control,meta:!!i.meta}}e.create=n})(ku||(ku={}));var Cv;(function(e){e.has=ba.has,e.create=ba.create})(Cv||(Cv={}));function YV(){return{drag:new ri,interactionEnd:new ri,click:new ri,move:new ri,wheel:new ri,pinch:new ri,resize:new ri,leave:new ri,enter:new ri,modifiers:new ri,key:new ri}}var iJe=["Backspace","Delete"],lR;(function(e){function t(n){n===void 0&&(n={});var i=E(E({},XV),n),a=i.noScroll,o=i.noContextMenu;return E(E({noScroll:a,noContextMenu:o,width:0,height:0,pixelRatio:1},YV()),{dispose:bf})}e.create=t;function r(n,i){i===void 0&&(i={});var a=E(E({},XV),i),o=a.noScroll,s=a.noMiddleClickScroll,u=a.noContextMenu,l=a.noPinchZoom,c=a.noTextSelect,d=a.mask,f=a.pixelScale,p=n.clientWidth*C(),v=n.clientHeight*C(),h=0,m=He(),g=He(),y=He(),b=He(),S=He(),x={shift:!1,alt:!1,control:!1,meta:!1};function C(){return window.devicePixelRatio*f}function w(){return E({},x)}var A=0,M=!1,D=Cv.create(0),k=0,R=!1,O=YV(),H=O.drag,B=O.interactionEnd,j=O.wheel,Y=O.pinch,G=O.click,$=O.move,q=O.leave,ee=O.enter,fe=O.resize,W=O.modifiers,X=O.key;return U(),E(E({get noScroll(){return o},set noScroll(ke){o=ke},get noContextMenu(){return u},set noContextMenu(ke){u=ke},get width(){return p},get height(){return v},get pixelRatio(){return C()}},O),{dispose:z});function U(){n.addEventListener("contextmenu",J,!1),n.addEventListener("wheel",Xe,!1),n.addEventListener("mousedown",L,!1),window.addEventListener("mousemove",V,!1),window.addEventListener("mouseup",he,!1),n.addEventListener("mouseenter",ct,!1),n.addEventListener("mouseleave",Ne,!1),n.addEventListener("touchstart",Se,!1),n.addEventListener("touchmove",oe,!1),n.addEventListener("touchend",ie,!1),window.addEventListener("blur",Z),window.addEventListener("keyup",le,!1),window.addEventListener("keydown",te,!1),window.addEventListener("keypress",ye,!1),window.addEventListener("resize",Qe,!1)}function z(){M||(M=!0,n.removeEventListener("contextmenu",J,!1),n.removeEventListener("wheel",Xe,!1),n.removeEventListener("mousedown",L,!1),window.removeEventListener("mousemove",V,!1),window.removeEventListener("mouseup",he,!1),n.removeEventListener("mouseenter",ct,!1),n.removeEventListener("mouseleave",Ne,!1),n.removeEventListener("touchstart",Se,!1),n.removeEventListener("touchmove",oe,!1),n.removeEventListener("touchend",ie,!1),window.removeEventListener("blur",Z),window.removeEventListener("keyup",le,!1),window.removeEventListener("keydown",te,!1),window.removeEventListener("keypress",ye,!1),window.removeEventListener("resize",Qe,!1))}function J(ke){d(ke.clientX,ke.clientY)&&u&&ke.preventDefault()}function K(ke){x.alt=ke.altKey,x.shift=ke.shiftKey,x.control=ke.ctrlKey,x.meta=ke.metaKey}function Z(){(D||x.shift||x.alt||x.meta||x.control)&&(D=0,x.shift=x.alt=x.control=x.meta=!1)}function te(ke){var Me=!1;!x.alt&&ke.altKey&&(Me=!0,x.alt=!0),!x.shift&&ke.shiftKey&&(Me=!0,x.shift=!0),!x.control&&ke.ctrlKey&&(Me=!0,x.control=!0),!x.meta&&ke.metaKey&&(Me=!0,x.meta=!0),Me&&R&&W.next(w())}function le(ke){var Me=!1;x.alt&&!ke.altKey&&(Me=!0,x.alt=!1),x.shift&&!ke.shiftKey&&(Me=!0,x.shift=!1),x.control&&!ke.ctrlKey&&(Me=!0,x.control=!1),x.meta&&!ke.metaKey&&(Me=!0,x.meta=!1),Me&&R&&W.next(w()),iJe.includes(ke.key)&&ye(ke)}function ye(ke){X.next({key:ke.key,modifiers:w()})}function be(ke){var Me=ke.touches[0],Ye=ke.touches[1];return{clientX:(Me.clientX+Ye.clientX)/2,clientY:(Me.clientY+Ye.clientY)/2,pageX:(Me.pageX+Ye.pageX)/2,pageY:(Me.pageY+Ye.pageY)/2}}function Ae(ke){var Me=ke.touches[0].pageX-ke.touches[1].pageX,Ye=ke.touches[0].pageY-ke.touches[1].pageY;return Math.sqrt(Me*Me+Ye*Ye)}function Se(ke){if(ke.touches.length===1)D=k=1,Te(ke.touches[0]);else if(ke.touches.length===2){D=0,k=2,Te(be(ke));var Me=Ae(ke);h=Me,Y.next({distance:Me,fraction:1,delta:0,isStart:!0,buttons:D,button:k,modifiers:w()})}else ke.touches.length===3&&(D=k=8,Te(be(ke)))}function ie(ke){we()}function oe(ke){if(k=0,l&&(ke.preventDefault(),ke.stopPropagation(),ke.originalEvent&&(ke.originalEvent.preventDefault(),ke.originalEvent.stopPropagation())),ke.touches.length===1)D=1,Ve(ke.touches[0]);else if(ke.touches.length===2){var Me=Ae(ke),Ye=h-Me;Math.abs(Ye)<4?(D=2,Ve(be(ke))):(D=4,K(ke),Y.next({delta:Ye,fraction:h/Me,distance:Me,isStart:!1,buttons:D,button:k,modifiers:w()})),h=Me}else ke.touches.length===3&&(D=8,Ve(be(ke)))}function L(ke){K(ke),D=Ah(ke),k=Zm(ke),s&&D===4&&ke.preventDefault,Te(ke)}function V(ke){K(ke),D=Ah(ke),k=0,Ve(ke)}function he(ke){K(ke),D=Ah(ke),k=Zm(ke),ze(ke),we()}function we(){B.next()}function Te(ke){d(ke.clientX,ke.clientY)&&(dt(g,ke),He.copy(m,g),it(g)&&(A=1))}function ze(ke){if(A=0,!!d(ke.clientX,ke.clientY)&&(dt(y,ke),He.distance(y,m)<4)){var Me=ke.pageX,Ye=ke.pageY,tt=y[0],xt=y[1];G.next({x:tt,y:xt,pageX:Me,pageY:Ye,buttons:D,button:k,modifiers:w()})}}function Ve(ke){var Me;dt(y,ke);var Ye=ke.pageX,tt=ke.pageY,xt=y[0],ht=y[1],ut=it(y);if($.next({x:xt,y:ht,pageX:Ye,pageY:tt,buttons:D,button:k,modifiers:w(),inside:ut}),A!==0&&(c&&((Me=ke.preventDefault)===null||Me===void 0||Me.call(ke)),He.div(b,He.sub(b,y,g),ot(S)),!(He.magnitude(b)<xn))){var pe=A===1;if(!(pe&&!d(ke.clientX,ke.clientY))){var me=b[0],Ee=b[1];H.next({x:xt,y:ht,dx:me,dy:Ee,pageX:Ye,pageY:tt,buttons:D,button:k,modifiers:w(),isStart:pe}),He.copy(g,y),A=2}}}function Xe(ke){if(d(ke.clientX,ke.clientY)){dt(y,ke);var Me=ke.pageX,Ye=ke.pageY,tt=y[0],xt=y[1];o&&ke.preventDefault();var ht=1;switch(ke.deltaMode){case 0:ht=1;break;case 1:ht=40;break;case 2:ht=800;break}var ut=(ke.deltaX||0)*ht,pe=(ke.deltaY||0)*ht,me=(ke.deltaZ||0)*ht;D=k=4,(ut||pe||me)&&j.next({x:tt,y:xt,pageX:Me,pageY:Ye,dx:ut,dy:pe,dz:me,buttons:D,button:k,modifiers:w()})}}function ct(ke){R=!0,ee.next()}function Ne(ke){R=!1,q.next()}function Qe(ke){fe.next()}function it(ke){if(n instanceof Window||n instanceof Document||n===document.body)return!0;var Me=n.getBoundingClientRect();return ke[0]>=0&&ke[1]>=0&&ke[0]<Me.width&&ke[1]<Me.height}function ot(ke){return ke[0]=n.clientWidth,ke[1]=n.clientHeight,ke}function dt(ke,Me){p=n.clientWidth*C(),v=n.clientHeight*C();var Ye=Me.clientX||0,tt=Me.clientY||0,xt=n.getBoundingClientRect();return ke[0]=Ye-xt.left,ke[1]=tt-xt.top,ke}}e.fromElement=r})(lR||(lR={}));function Xi(){return Xi.zero()}(function(e){function t(){return{x:0,y:0,width:0,height:0}}e.zero=t;function r(u,l,c,d){return{x:u,y:l,width:c,height:d}}e.create=r;function n(u){return E({},u)}e.clone=n;function i(u,l){return Object.assign(u,l)}e.copy=i;function a(u,l,c,d,f){return u.x=l,u.y=c,u.width=d,u.height=f,u}e.set=a;function o(u,l){return u[0]=l.x,u[1]=l.y,u[2]=l.width,u[3]=l.height,u}e.toVec4=o;function s(u,l){return u.x===l.x&&u.y===l.y&&u.width===l.width&&u.height===l.height}e.equals=s})(Xi||(Xi={}));var KV=0,QV=1,il=Ar();function aJe(e,t,r,n){var i=r.x,a=r.y,o=r.width,s=r.height;Ar.set(il,t[0],t[1],t[2],1),Ar.transformMat4(il,il,n);var u=il[3];return u!==0&&(il[0]/=u,il[1]/=u,il[2]/=u),e[0]=i+o/2*il[0]+(0+o/2),e[1]=a+s/2*il[1]+(0+s/2),e[2]=(QV-KV)/2*il[2]+(QV+KV)/2,e[3]=u===0?0:1/u,e}function iC(e,t,r,n){var i=r.x,a=r.y,o=r.width,s=r.height,u=t[0]-i,l=s-t[1]-1-a,c=t[2];return e[0]=2*u/o-1,e[1]=2*l/s-1,e[2]=2*c-1,_.transformMat4(e,e,n)}var cR={backgroundColor:I.Color(at(0),{description:"Background color of the 3D canvas"}),pickingAlphaThreshold:I.Numeric(.5,{min:0,max:1,step:.01},{description:"The minimum opacity value needed for an object to be pickable."}),interiorDarkening:I.Numeric(.5,{min:0,max:1,step:.01}),interiorColorFlag:I.Boolean(!0,{label:"Use Interior Color"}),interiorColor:I.Color(at.fromNormalizedRgb(.3,.3,.3)),highlightColor:I.Color(at.fromNormalizedRgb(1,.4,.6)),selectColor:I.Color(at.fromNormalizedRgb(.2,1,.1)),xrayEdgeFalloff:I.Numeric(1,{min:0,max:3,step:.1}),style:I.MappedStatic("matte",{custom:I.Group({lightIntensity:I.Numeric(.6,{min:0,max:1,step:.01}),ambientIntensity:I.Numeric(.4,{min:0,max:1,step:.01}),metalness:I.Numeric(0,{min:0,max:1,step:.01}),roughness:I.Numeric(1,{min:0,max:1,step:.01}),reflectivity:I.Numeric(.5,{min:0,max:1,step:.01})},{isExpanded:!0}),flat:I.Group({}),matte:I.Group({}),glossy:I.Group({}),metallic:I.Group({}),plastic:I.Group({})},{label:"Lighting",description:"Style in which the 3D scene is rendered/lighted"}),clip:I.Group({variant:I.Select("instance",I.arrayToOptions(["instance","pixel"])),objects:I.ObjectList({type:I.Select("plane",I.objectToOptions(on.Type,function(e){return Zo(e)})),invert:I.Boolean(!1),position:I.Vec3(_()),rotation:I.Group({axis:I.Vec3(_.create(1,0,0)),angle:I.Numeric(0,{min:-180,max:180,step:1},{description:"Angle in Degrees"})},{isExpanded:!0}),scale:I.Vec3(_.create(1,1,1))},function(e){return Zo(e.type)})})};function ZV(e){switch(e.name){case"custom":return e.params;case"flat":return{lightIntensity:0,ambientIntensity:1,metalness:0,roughness:.4,reflectivity:.5};case"matte":return{lightIntensity:.7,ambientIntensity:.3,metalness:0,roughness:1,reflectivity:.5};case"glossy":return{lightIntensity:.7,ambientIntensity:.3,metalness:0,roughness:.4,reflectivity:.5};case"metallic":return{lightIntensity:.7,ambientIntensity:.7,metalness:.6,roughness:.6,reflectivity:.5};case"plastic":return{lightIntensity:.7,ambientIntensity:.3,metalness:0,roughness:.2,reflectivity:.5}}}var oJe=qn();function JV(e,t){for(var r=(t==null?void 0:t.objects)||{type:new Array(5).fill(1),invert:new Array(5).fill(!1),position:new Array(15).fill(0),rotation:new Array(20).fill(0),scale:new Array(15).fill(1)},n=r.type,i=r.invert,a=r.position,o=r.rotation,s=r.scale,u=0,l=e.objects.length;u<l;++u){var c=e.objects[u];n[u]=on.Type[c.type],i[u]=c.invert,_.toArray(c.position,a,u*3),qn.toArray(qn.setAxisAngle(oJe,c.rotation.axis,Kr(c.rotation.angle)),o,u*4),_.toArray(c.scale,s,u*3)}return{variant:e.variant,objects:{count:e.objects.length,type:n,invert:i,position:a,rotation:o,scale:s}}}var dR;(function(e){function t(r,n){n===void 0&&(n={});var i=r.gl,a=r.state,o=r.stats,s=r.extensions.fragDepth,u=I.merge(cR,I.getDefaultValues(cR),n),l=ZV(u.style),c=JV(u.clip),d=Xi(),f=He.create(i.drawingBufferWidth,i.drawingBufferHeight),p=at.toVec3Normalized(_(),u.backgroundColor),v=!1,h=kE(i),m=[["tDepth",h]],g=ue(),y=ue(),b=ue(),S=ue(),x=ue(),C=ue(),w=ue(),A=_(),M=He(),D={uModel:F.create(ue.identity()),uView:F.create(g),uInvView:F.create(y),uModelView:F.create(b),uInvModelView:F.create(S),uInvProjection:F.create(x),uProjection:F.create(ue()),uModelViewProjection:F.create(C),uInvModelViewProjection:F.create(w),uIsOrtho:F.create(1),uViewOffset:F.create(M),uPixelRatio:F.create(r.pixelRatio),uViewportHeight:F.create(d.height),uViewport:F.create(Xi.toVec4(Ar(),d)),uDrawingBufferSize:F.create(f),uCameraPosition:F.create(_()),uCameraDir:F.create(A),uNear:F.create(1),uFar:F.create(1e4),uFogNear:F.create(1),uFogFar:F.create(1e4),uFogColor:F.create(p),uRenderWboit:F.create(!1),uTransparentBackground:F.create(!1),uClipObjectType:F.create(c.objects.type),uClipObjectInvert:F.create(c.objects.invert),uClipObjectPosition:F.create(c.objects.position),uClipObjectRotation:F.create(c.objects.rotation),uClipObjectScale:F.create(c.objects.scale),uLightIntensity:F.create(l.lightIntensity),uAmbientIntensity:F.create(l.ambientIntensity),uMetalness:F.create(l.metalness),uRoughness:F.create(l.roughness),uReflectivity:F.create(l.reflectivity),uPickingAlphaThreshold:F.create(u.pickingAlphaThreshold),uInteriorDarkening:F.create(u.interiorDarkening),uInteriorColorFlag:F.create(u.interiorColorFlag),uInteriorColor:F.create(at.toVec3Normalized(_(),u.interiorColor)),uHighlightColor:F.create(at.toVec3Normalized(_(),u.highlightColor)),uSelectColor:F.create(at.toVec3Normalized(_(),u.selectColor)),uXrayEdgeFalloff:F.create(u.xrayEdgeFalloff)},k=Object.entries(D),R=!0,O=function(U,z){if(!(U.state.disposed||!U.state.visible||!U.state.pickable&&z[0]==="p")){var J=!1;U.state.noClip?U.values.dClipObjectCount.ref.value!==0&&(F.update(U.values.dClipObjectCount,0),J=!0):(U.values.dClipObjectCount.ref.value!==c.objects.count&&(F.update(U.values.dClipObjectCount,c.objects.count),J=!0),U.values.dClipVariant.ref.value!==c.variant&&(F.update(U.values.dClipVariant,c.variant),J=!0)),J&&U.update();var K=U.getProgram(z);a.currentProgramId!==K.id&&(R=!0,K.use()),R&&(K.setUniforms(k),R=!1),U.values.dRenderMode?(a.disable(i.CULL_FACE),a.frontFace(i.CCW),z==="colorBlended"&&(U.values.dRenderMode.ref.value==="volume"||!s?(a.disable(i.DEPTH_TEST),a.depthMask(!1)):(a.enable(i.DEPTH_TEST),a.depthMask(U.values.uAlpha.ref.value===1)))):(U.values.dDoubleSided?U.values.dDoubleSided.ref.value||U.values.hasReflection.ref.value?a.disable(i.CULL_FACE):a.enable(i.CULL_FACE):a.disable(i.CULL_FACE),U.values.dFlipSided&&U.values.dFlipSided.ref.value?(a.frontFace(i.CW),a.cullFace(i.FRONT)):(a.frontFace(i.CCW),a.cullFace(i.BACK))),U.render(z,m)}},H=function(U){F.update(D.uView,U.view),F.update(D.uInvView,ue.invert(y,U.view)),F.update(D.uProjection,U.projection),F.update(D.uInvProjection,ue.invert(x,U.projection)),F.updateIfChanged(D.uIsOrtho,U.state.mode==="orthographic"?1:0),F.update(D.uViewOffset,U.viewOffset.enabled?He.set(M,U.viewOffset.offsetX*16,U.viewOffset.offsetY*16):He.set(M,0,0)),F.update(D.uCameraPosition,U.state.position),F.update(D.uCameraDir,_.normalize(A,_.sub(A,U.state.target,U.state.position))),F.updateIfChanged(D.uFar,U.far),F.updateIfChanged(D.uNear,U.near),F.updateIfChanged(D.uFogFar,U.fogFar),F.updateIfChanged(D.uFogNear,U.fogNear),F.updateIfChanged(D.uTransparentBackground,v)},B=function(U,z,J,K){dDe(m,"tDepth",J||h),F.update(D.uModel,U.view),F.update(D.uModelView,ue.mul(b,U.view,z.view)),F.update(D.uInvModelView,ue.invert(S,b)),F.update(D.uModelViewProjection,ue.mul(C,b,z.projection)),F.update(D.uInvModelViewProjection,ue.invert(w,C)),F.updateIfChanged(D.uRenderWboit,K),a.enable(i.SCISSOR_TEST),a.colorMask(!0,!0,!0,!0);var Z=d.x,te=d.y,le=d.width,ye=d.height;i.viewport(Z,te,le,ye),i.scissor(Z,te,le,ye),R=!0,a.currentRenderItemId=-1},j=function(U,z,J,K){a.disable(i.BLEND),a.enable(i.DEPTH_TEST),a.depthMask(!0),B(U,z,K,!1);for(var Z=U.renderables,te=0,le=Z.length;te<le;++te)Z[te].state.colorOnly||O(Z[te],J)},Y=function(U,z,J){a.disable(i.BLEND),a.enable(i.DEPTH_TEST),a.depthMask(!0),B(U,z,J,!1);for(var K=U.renderables,Z=0,te=K.length;Z<te;++Z)O(K[Z],"depth")},G=function(U,z,J){$(U,z,J),q(U,z,J)},$=function(U,z,J){a.disable(i.BLEND),a.enable(i.DEPTH_TEST),a.depthMask(!0),B(U,z,J,!1);for(var K=U.renderables,Z=0,te=K.length;Z<te;++Z){var le=K[Z];le.state.opaque&&O(le,"colorBlended")}},q=function(U,z,J){a.enable(i.DEPTH_TEST),B(U,z,J,!1);var K=U.renderables;v?a.blendFunc(i.ONE,i.ONE_MINUS_SRC_ALPHA):a.blendFuncSeparate(i.SRC_ALPHA,i.ONE_MINUS_SRC_ALPHA,i.ONE,i.ONE_MINUS_SRC_ALPHA),a.enable(i.BLEND),a.depthMask(!0);for(var Z=0,te=K.length;Z<te;++Z){var le=K[Z];!le.state.opaque&&le.state.writeDepth&&O(le,"colorBlended")}a.depthMask(!1);for(var Z=0,te=K.length;Z<te;++Z){var le=K[Z];!le.state.opaque&&!le.state.writeDepth&&O(le,"colorBlended")}},ee=function(U,z,J){var K;a.blendFunc(i.ONE,i.ONE_MINUS_SRC_ALPHA),a.enable(i.BLEND),B(U,z,J,!1);for(var Z=U.renderables,te=0,le=Z.length;te<le;++te){var ye=Z[te],be=Ba(ye.values.alpha.ref.value*ye.state.alphaFactor,0,1);be===1&&ye.values.transparencyAverage.ref.value!==1&&!(!((K=ye.values.dXrayShaded)===null||K===void 0)&&K.ref.value)&&O(ye,"colorBlended")}},fe=function(U,z,J){var K;a.blendFunc(i.ONE,i.ONE_MINUS_SRC_ALPHA),a.enable(i.BLEND),B(U,z,J,!1);for(var Z=U.renderables,te=0,le=Z.length;te<le;++te){var ye=Z[te],be=Ba(ye.values.alpha.ref.value*ye.state.alphaFactor,0,1);(be<1||ye.values.transparencyAverage.ref.value>0||!((K=ye.values.dXrayShaded)===null||K===void 0)&&K.ref.value)&&O(ye,"colorBlended")}},W=function(U,z,J){var K,Z,te;a.disable(i.BLEND),a.enable(i.DEPTH_TEST),a.depthMask(!0),B(U,z,J,!1);for(var le=U.renderables,ye=0,be=le.length;ye<be;++ye){var Ae=le[ye],Se=Ba(Ae.values.alpha.ref.value*Ae.state.alphaFactor,0,1);Se===1&&Ae.values.transparencyAverage.ref.value!==1&&((K=Ae.values.dRenderMode)===null||K===void 0?void 0:K.ref.value)!=="volume"&&!(!((Z=Ae.values.dPointFilledCircle)===null||Z===void 0)&&Z.ref.value)&&!(!((te=Ae.values.dXrayShaded)===null||te===void 0)&&te.ref.value)&&O(Ae,"colorWboit")}},X=function(U,z,J){var K,Z,te;B(U,z,J,!0);for(var le=U.renderables,ye=0,be=le.length;ye<be;++ye){var Ae=le[ye],Se=Ba(Ae.values.alpha.ref.value*Ae.state.alphaFactor,0,1);(Se<1||Ae.values.transparencyAverage.ref.value>0||((K=Ae.values.dRenderMode)===null||K===void 0?void 0:K.ref.value)==="volume"||!((Z=Ae.values.dPointFilledCircle)===null||Z===void 0)&&Z.ref.value||Ae.values.uBackgroundColor||!((te=Ae.values.dXrayShaded)===null||te===void 0)&&te.ref.value)&&O(Ae,"colorWboit")}};return{clear:function(U){a.enable(i.SCISSOR_TEST),a.enable(i.DEPTH_TEST),a.colorMask(!0,!0,!0,!0),a.depthMask(!0),v?a.clearColor(0,0,0,0):U?a.clearColor(p[0],p[1],p[2],1):a.clearColor(1,1,1,1),i.clear(i.COLOR_BUFFER_BIT|i.DEPTH_BUFFER_BIT)},clearDepth:function(){a.enable(i.SCISSOR_TEST),a.enable(i.DEPTH_TEST),a.depthMask(!0),i.clear(i.DEPTH_BUFFER_BIT)},update:H,renderPick:j,renderDepth:Y,renderBlended:G,renderBlendedOpaque:$,renderBlendedTransparent:q,renderBlendedVolumeOpaque:ee,renderBlendedVolumeTransparent:fe,renderWboitOpaque:W,renderWboitTransparent:X,setProps:function(U){U.backgroundColor!==void 0&&U.backgroundColor!==u.backgroundColor&&(u.backgroundColor=U.backgroundColor,at.toVec3Normalized(p,u.backgroundColor),F.update(D.uFogColor,_.copy(D.uFogColor.ref.value,p))),U.pickingAlphaThreshold!==void 0&&U.pickingAlphaThreshold!==u.pickingAlphaThreshold&&(u.pickingAlphaThreshold=U.pickingAlphaThreshold,F.update(D.uPickingAlphaThreshold,u.pickingAlphaThreshold)),U.interiorDarkening!==void 0&&U.interiorDarkening!==u.interiorDarkening&&(u.interiorDarkening=U.interiorDarkening,F.update(D.uInteriorDarkening,u.interiorDarkening)),U.interiorColorFlag!==void 0&&U.interiorColorFlag!==u.interiorColorFlag&&(u.interiorColorFlag=U.interiorColorFlag,F.update(D.uInteriorColorFlag,u.interiorColorFlag)),U.interiorColor!==void 0&&U.interiorColor!==u.interiorColor&&(u.interiorColor=U.interiorColor,F.update(D.uInteriorColor,at.toVec3Normalized(D.uInteriorColor.ref.value,u.interiorColor))),U.highlightColor!==void 0&&U.highlightColor!==u.highlightColor&&(u.highlightColor=U.highlightColor,F.update(D.uHighlightColor,at.toVec3Normalized(D.uHighlightColor.ref.value,u.highlightColor))),U.selectColor!==void 0&&U.selectColor!==u.selectColor&&(u.selectColor=U.selectColor,F.update(D.uSelectColor,at.toVec3Normalized(D.uSelectColor.ref.value,u.selectColor))),U.xrayEdgeFalloff!==void 0&&U.xrayEdgeFalloff!==u.xrayEdgeFalloff&&(u.xrayEdgeFalloff=U.xrayEdgeFalloff,F.update(D.uXrayEdgeFalloff,u.xrayEdgeFalloff)),U.style!==void 0&&(u.style=U.style,Object.assign(l,ZV(U.style)),F.updateIfChanged(D.uLightIntensity,l.lightIntensity),F.updateIfChanged(D.uAmbientIntensity,l.ambientIntensity),F.updateIfChanged(D.uMetalness,l.metalness),F.updateIfChanged(D.uRoughness,l.roughness),F.updateIfChanged(D.uReflectivity,l.reflectivity)),U.clip!==void 0&&!Xc(U.clip,u.clip)&&(u.clip=U.clip,Object.assign(c,JV(U.clip,c)),F.update(D.uClipObjectPosition,c.objects.position),F.update(D.uClipObjectRotation,c.objects.rotation),F.update(D.uClipObjectScale,c.objects.scale),F.update(D.uClipObjectType,c.objects.type))},setViewport:function(U,z,J,K){i.viewport(U,z,J,K),i.scissor(U,z,J,K),(U!==d.x||z!==d.y||J!==d.width||K!==d.height)&&(Xi.set(d,U,z,J,K),F.update(D.uViewportHeight,K),F.update(D.uViewport,Ar.set(D.uViewport.ref.value,U,z,J,K)))},setTransparentBackground:function(U){v=U},setDrawingBufferSize:function(U,z){(U!==f[0]||z!==f[1])&&F.update(D.uDrawingBufferSize,He.set(f,U,z))},props:u,get stats(){return{programCount:r.stats.resourceCounts.program,shaderCount:r.stats.resourceCounts.shader,attributeCount:r.stats.resourceCounts.attribute,elementsCount:r.stats.resourceCounts.elements,framebufferCount:r.stats.resourceCounts.framebuffer,renderbufferCount:r.stats.resourceCounts.renderbuffer,textureCount:r.stats.resourceCounts.texture,vertexArrayCount:r.stats.resourceCounts.vertexArray,drawCount:o.drawCount,instanceCount:o.instanceCount,instancedDrawCount:o.instancedDrawCount}},dispose:function(){}}}e.create=t})(dR||(dR={}));function hr(e,t,r){return t===void 0&&(t=""),r===void 0&&(r=""),hr.create(e,t,r)}(function(e){function t(s,u,l){return u===void 0&&(u=""),l===void 0&&(l=""),{triggers:s,action:u,description:l}}e.create=t,e.Empty={triggers:[],action:"",description:""};function r(s){return s.triggers.length===0||s.triggers.every(function(u){return u.buttons===void 0&&u.modifiers===void 0})}e.isEmpty=r;function n(s,u,l){return s.triggers.some(function(c){return o.match(c,u,l)})}e.match=n;function i(s){return s.triggers.map(o.format).join(" or ")}e.formatTriggers=i;function a(s,u){u===void 0&&(u="");var l=s.description||Zo(u);return k4e(l,{triggers:"<i>"+i(s)+"</i>"})}e.format=a;function o(s,u){return o.create(s,u)}e.Trigger=o,function(s){function u(d,f){return{buttons:d,modifiers:f}}s.create=u,s.Empty={};function l(d,f,p){var v=d.buttons,h=d.modifiers;return v!==void 0&&(v===f||Cv.has(v,f))&&(!h||ku.areEqual(h,p))}s.match=l;function c(d){var f=[],p=sJe(d.buttons);p&&f.push(p);var v=uJe(d.modifiers);return v&&f.push(v),f.join(" + ")}s.format=c}(o=e.Trigger||(e.Trigger={}))})(hr||(hr={}));var Wx=Cv;function sJe(e){var t=[];return e===void 0?t.push("any mouse button"):e===0?t.push("mouse hover"):(Wx.has(e,1)&&t.push("left mouse button"),Wx.has(e,2)&&t.push("right mouse button"),Wx.has(e,4)&&t.push("wheel/middle mouse button"),Wx.has(e,8)&&t.push("three fingers")),t.join(" + ")}function uJe(e,t){var r=[];return e?(e.alt&&r.push("alt key"),e.control&&r.push("control key"),e.meta&&r.push("meta/command key"),e.shift&&r.push("shift key"),t&&r.length===0&&r.push("no key")):t&&r.push("any key"),r.join(" + ")}var Xd=ku,Yd=hr.Trigger,lJe={dragRotate:hr([Yd(1,Xd.create())],"Rotate","Drag using ${triggers}"),dragRotateZ:hr([Yd(1,Xd.create({shift:!0}))],"Rotate around z-axis","Drag using ${triggers}"),dragPan:hr([Yd(2,Xd.create()),Yd(1,Xd.create({control:!0}))],"Pan","Drag using ${triggers}"),dragZoom:hr.Empty,dragFocus:hr([Yd(8,Xd.create())],"Focus","Drag using ${triggers}"),dragFocusZoom:hr([Yd(4,Xd.create())],"Focus and zoom","Drag using ${triggers}"),scrollZoom:hr([Yd(4,Xd.create())],"Zoom","Scroll using ${triggers}"),scrollFocus:hr([Yd(4,Xd.create({shift:!0}))],"Clip","Scroll using ${triggers}"),scrollFocusZoom:hr.Empty},Mne={noScroll:I.Boolean(!0,{isHidden:!0}),rotateSpeed:I.Numeric(5,{min:1,max:10,step:1}),zoomSpeed:I.Numeric(7,{min:1,max:15,step:1}),panSpeed:I.Numeric(1,{min:.1,max:5,step:.1}),spin:I.Boolean(!1,{description:"Spin the 3D scene around the x-axis in view space"}),spinSpeed:I.Numeric(1,{min:-20,max:20,step:1}),staticMoving:I.Boolean(!0,{isHidden:!0}),dynamicDampingFactor:I.Numeric(.2,{},{isHidden:!0}),minDistance:I.Numeric(.01,{},{isHidden:!0}),maxDistance:I.Numeric(1e150,{},{isHidden:!0}),bindings:I.Value(lJe,{isHidden:!0}),autoAdjustMinMaxDistance:I.MappedStatic("on",{off:I.EmptyGroup(),on:I.Group({minDistanceFactor:I.Numeric(0),minDistancePadding:I.Numeric(5),maxDistanceFactor:I.Numeric(10),maxDistanceMin:I.Numeric(20)})},{isHidden:!0})},fR;(function(e){function t(r,n,i){i===void 0&&(i={});var a=E(E({},I.getDefaultValues(Mne)),i),o=Xi.clone(n.viewport),s=!1,u=r.drag.subscribe(V),l=r.interactionEnd.subscribe(he),c=r.wheel.subscribe(we),d=r.pinch.subscribe(Te),f=!1,p=_(),v=_(),h=He(),m=He(),g=_(),y=0,b=He(),S=He(),x=0,C=He(),w=He(),A=He(),M=He(),D=He(),k=He(),R=_.clone(n.target),O=_.clone(n.position),H=_.clone(n.up),B=He();function j(Ne,Qe){return He.set(B,(Ne-o.x)/o.width,(Qe-o.y)/o.height)}var Y=He();function G(Ne,Qe){return He.set(Y,(Ne-o.width*.5-o.x)/(o.width*.5),(o.height+2*(o.y-Qe))/o.width)}var $=_(),q=qn(),ee=_(),fe=_(),W=_(),X=_();function U(){var Ne=m[0]-h[0],Qe=m[1]-h[1];_.set(X,Ne,Qe,0);var it=r.width/r.height,ot=_.magnitude(X)*a.rotateSpeed*r.pixelRatio*it;ot?(_.sub(v,n.position,n.target),_.normalize(ee,v),_.normalize(fe,n.up),_.normalize(W,_.cross(W,fe,ee)),_.setMagnitude(fe,fe,Qe),_.setMagnitude(W,W,Ne),_.add(X,fe,W),_.normalize($,_.cross($,X,v)),qn.setAxisAngle(q,$,ot),_.transformQuat(v,v,q),_.transformQuat(n.up,n.up,q),_.copy(g,$),y=ot):!a.staticMoving&&y&&(y*=Math.sqrt(1-a.dynamicDampingFactor),_.sub(v,n.position,n.target),qn.setAxisAngle(q,g,y),_.transformQuat(v,v,q),_.transformQuat(n.up,n.up,q)),He.copy(h,m)}var z=qn();function J(){var Ne=S[0]-b[0],Qe=S[1]-b[1],it=a.rotateSpeed*(-Ne+Qe)*-.05;it?(_.sub(v,n.position,n.target),qn.setAxisAngle(z,v,it),_.transformQuat(n.up,n.up,z),x=it):!a.staticMoving&&x&&(x*=Math.sqrt(1-a.dynamicDampingFactor),_.sub(v,n.position,n.target),qn.setAxisAngle(z,v,x),_.transformQuat(n.up,n.up,z)),He.copy(b,S)}function K(){var Ne=1+(w[1]-C[1])*a.zoomSpeed;Ne!==1&&Ne>0&&_.scale(v,v,Ne),a.staticMoving?He.copy(C,w):C[1]+=(w[1]-C[1])*a.dynamicDampingFactor}function Z(){var Ne=(M[1]-A[1])*a.zoomSpeed;if(Ne!==0){var Qe=Math.max(1,n.state.radius+n.state.radius*Ne);n.setState({radius:Qe})}a.staticMoving?He.copy(A,M):A[1]+=(M[1]-A[1])*a.dynamicDampingFactor}var te=He(),le=_(),ye=_();function be(){if(He.sub(te,He.copy(te,k),D),He.squaredMagnitude(te)){var Ne=r.pixelRatio*a.panSpeed;te[0]*=1/n.zoom*n.viewport.width*Ne,te[1]*=1/n.zoom*n.viewport.height*Ne,_.cross(ye,_.copy(ye,v),n.up),_.setMagnitude(ye,ye,te[0]),_.setMagnitude(le,n.up,te[1]),_.add(ye,ye,le),_.add(n.position,n.position,ye),_.add(n.target,n.target,ye),a.staticMoving?He.copy(D,k):(He.sub(te,k,D),He.scale(te,te,a.dynamicDampingFactor),He.add(D,D,te))}}function Ae(){var Ne=Math.min(Math.max(n.state.radiusMax*1e3,.01),a.maxDistance);_.squaredMagnitude(v)>Ne*Ne&&(_.setMagnitude(v,v,Ne),_.add(n.position,n.target,v),He.copy(C,w),He.copy(A,M)),_.squaredMagnitude(v)<a.minDistance*a.minDistance&&(_.setMagnitude(v,v,a.minDistance),_.add(n.position,n.target,v),He.copy(C,w),He.copy(A,M))}function Se(Ne,Qe){return Ne*=r.pixelRatio,Qe*=r.pixelRatio,Ne>o.x+o.width||r.height-Qe>o.y+o.height||Ne<o.x||r.height-Qe<o.y}var ie=-1;function oe(Ne){ie!==Ne&&(a.spin&&ie>0&&Xe(Ne-ie),_.sub(v,n.position,n.target),U(),J(),K(),Z(),be(),_.add(n.position,n.target,v),Ae(),_.squaredDistance(p,n.position)>xn&&_.copy(p,n.position),ie=Ne)}function L(){_.copy(n.target,R),_.copy(n.position,O),_.copy(n.up,H),_.sub(v,n.position,n.target),_.copy(p,n.position)}function V(Ne){var Qe=Ne.x,it=Ne.y,ot=Ne.pageX,dt=Ne.pageY,ke=Ne.buttons,Me=Ne.modifiers,Ye=Ne.isStart,tt=Se(Qe,it);if(!(Ye&&tt)&&!(!Ye&&!f)){f=!0;var xt=hr.match(a.bindings.dragRotate,ke,Me),ht=hr.match(a.bindings.dragRotateZ,ke,Me),ut=hr.match(a.bindings.dragPan,ke,Me),pe=hr.match(a.bindings.dragZoom,ke,Me),me=hr.match(a.bindings.dragFocus,ke,Me),Ee=hr.match(a.bindings.dragFocusZoom,ke,Me);if(G(ot,dt),j(ot,dt),Ye&&(xt&&(He.copy(m,Y),He.copy(h,m)),ht&&(He.copy(S,Y),He.copy(b,S)),(pe||Ee)&&(He.copy(C,B),He.copy(w,C)),me&&(He.copy(A,B),He.copy(M,A)),ut&&(He.copy(D,B),He.copy(k,D))),xt&&He.copy(m,Y),ht&&He.copy(S,Y),(pe||Ee)&&He.copy(w,B),me&&He.copy(M,B),Ee){var Ke=_.distance(n.state.position,n.state.target);n.setState({radius:Ke/5})}ut&&He.copy(k,B)}}function he(){f=!1}function we(Ne){var Qe=Ne.x,it=Ne.y,ot=Ne.dx,dt=Ne.dy,ke=Ne.dz,Me=Ne.buttons,Ye=Ne.modifiers;if(!Se(Qe,it)){var tt=A4e(ot,dt,ke);hr.match(a.bindings.scrollZoom,Me,Ye)&&(w[1]+=tt*1e-4),hr.match(a.bindings.scrollFocus,Me,Ye)&&(M[1]+=tt*1e-4)}}function Te(Ne){var Qe=Ne.fraction,it=Ne.buttons,ot=Ne.modifiers;hr.match(a.bindings.scrollZoom,it,ot)&&(f=!0,w[1]+=(Qe-1)*.1)}function ze(){s||(s=!0,u.unsubscribe(),c.unsubscribe(),d.unsubscribe(),l.unsubscribe())}var Ve=He.create(.005,0);function Xe(Ne){if(a.spinSpeed!==0){var Qe=(a.spinSpeed||0)/1e3;Ve[0]=60*Math.min(Math.abs(Ne),1e3/8)/1e3*Qe,f||He.add(m,h,Ve)}}function ct(Ne){ie=-1,oe(Ne)}return{viewport:o,get props(){return a},setProps:function(Ne){Object.assign(a,Ne)},start:ct,update:oe,reset:L,dispose:ze}}e.create=t})(fR||(fR={}));var ww;(function(e){function t(){return{view:ue.identity(),position:_.create(0,0,0),direction:_.create(0,0,-1),up:_.create(0,1,0)}}e.create=t;var r=_.zero();function n(i){_.add(r,i.position,i.direction),ue.lookAt(i.view,i.position,r,i.up)}e.update=n})(ww||(ww={}));var cJe=function(){function e(){this.removeList=Y5(),this.removeMap=new Map,this.addList=Y5(),this.addMap=new Map}return Object.defineProperty(e.prototype,"isEmpty",{get:function(){return this.removeList.count===0&&this.addList.count===0},enumerable:!1,configurable:!0}),e.prototype.add=function(t){if(this.removeMap.has(t)){var r=this.removeMap.get(t);this.removeMap.delete(t),this.removeList.remove(r)}if(!this.addMap.has(t)){var n=this.addList.addLast(t);this.addMap.set(t,n)}},e.prototype.remove=function(t){if(this.addMap.has(t)){var r=this.addMap.get(t);this.addMap.delete(t),this.addList.remove(r)}if(!this.removeMap.has(t)){var n=this.removeList.addLast(t);this.removeMap.set(t,n)}},e.prototype.tryGetRemove=function(){var t=this.removeList.removeFirst();return t&&this.removeMap.delete(t),t},e.prototype.tryGetAdd=function(){var t=this.addList.removeFirst();return t&&this.addMap.delete(t),t},e}(),fy=new ps("98");function eH(e,t,r){fy.reset();for(var n=0,i=e.length;n<i;++n)if(!(r&&!e[n].state.visible)){var a=e[n].values.boundingSphere.ref.value;a.radius&&fy.includeSphere(a)}fy.finishedIncludeStep();for(var n=0,i=e.length;n<i;++n)if(!(r&&!e[n].state.visible)){var o=e[n].values.boundingSphere.ref.value;o.radius&&fy.radiusSphere(o)}return fy.getSphere(t)}function dJe(e,t){var r=e.getProgram("colorBlended").id,n=t.getProgram("colorBlended").id,i=e.materialId,a=t.materialId;return r!==n?r-n:i!==a?i-a:e.id-t.id}var Jg;(function(e){function t(r){var n=new Map,i=[],a=Be(),o=Be(),s=[],u=[],l=!0,c=!0,d=ww.create(),f=d.view,p=d.position,v=d.direction,h=d.up;function m(A){if(n.has(A))return console.warn("RenderObject with id '"+A.id+"' already present"),n.get(A);var M=zVe(r,A);return i.push(M),A.type==="direct-volume"?u.push(M):s.push(M),n.set(A,M),l=!0,c=!0,M}function g(A){var M=n.get(A);M&&(M.dispose(),Nh(i,M),Nh(s,M),Nh(u,M),n.delete(A),l=!0,c=!0)}var y=100;function b(A){for(var M=kn(),D=0;;){var k=S.tryGetRemove();if(!k)break;if(g(k),++D%y===0&&kn()-M>A)return!1}for(;;){var k=S.tryGetAdd();if(!k)break;if(m(k),++D%y===0&&kn()-M>A)return!1}return i.sort(dJe),!0}var S=new cJe,x=-1;function C(){for(var A=23,M=0,D=i.length;M<D;++M)i[M].state.visible&&(A=31*A+i[M].id|0);return A=qQ(A),A===-1&&(A=0),A}function w(){var A=C();return A!==x?(c=!0,!0):!1}return{view:f,position:p,direction:v,up:h,renderables:i,primitives:{view:f,position:p,direction:v,up:h,renderables:s},volumes:{view:f,position:p,direction:v,up:h,renderables:u},syncVisibility:w,update:function(A,M){var D;if(ww.update(d),A)for(var k=0,R=A.length;k<R;++k)(D=n.get(A[k]))===null||D===void 0||D.update();else for(var k=0,R=i.length;k<R;++k)i[k].update();M?w():(l=!0,c=!0)},add:function(A){return S.add(A)},remove:function(A){return S.remove(A)},commit:function(A){return A===void 0&&(A=Number.MAX_VALUE),b(A)},get needsCommit(){return!S.isEmpty},has:function(A){return n.has(A)},clear:function(){for(var A=0,M=i.length;A<M;++A)i[A].dispose();i.length=0,n.clear(),l=!0,c=!0},forEach:function(A){n.forEach(A)},get count(){return i.length},get boundingSphere(){return l&&(eH(i,a,!1),l=!1),a},get boundingSphereVisible(){return c&&(eH(i,o,!0),c=!1,x=C()),o}}}e.create=t})(Jg||(Jg={}));var pR=function(){function e(t){this.camera=t,this.t=0,this.func=e.defaultTransition,this.start=0,this.inTransition=!1,this.durationMs=0,this._source=ci.createDefaultSnapshot(),this._target=ci.createDefaultSnapshot(),this._current=ci.createDefaultSnapshot()}return Object.defineProperty(e.prototype,"source",{get:function(){return this._source},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"target",{get:function(){return this._target},enumerable:!1,configurable:!0}),e.prototype.apply=function(t,r,n){if(r===void 0&&(r=0),(!this.inTransition||r>0)&&ci.copySnapshot(this._source,this.camera.state),this.inTransition||ci.copySnapshot(this._target,this.camera.state),ci.copySnapshot(this._target,t),this._target.radius>this._target.radiusMax&&(this._target.radius=this._target.radiusMax),this._target.radius<.01&&(this._target.radius=.01),this._target.radiusMax<.01&&(this._target.radiusMax=.01),!this.inTransition&&r<=0||typeof t.mode<"u"&&t.mode!==this.camera.state.mode){this.finish(this._target);return}this.inTransition=!0,this.func=n||e.defaultTransition,(!this.inTransition||r>0)&&(this.start=this.t,this.durationMs=r)},e.prototype.tick=function(t){this.t=t,this.update()},e.prototype.finish=function(t){ci.copySnapshot(this.camera.state,t),this.inTransition=!1},e.prototype.update=function(){if(this.inTransition){var t=Math.min((this.t-this.start)/this.durationMs,1);if(t===1){this.finish(this._target);return}this.func(this._current,t,this._source,this._target),ci.copySnapshot(this.camera.state,this._current)}},e}();(function(e){var t=qn.identity();function r(n,i,a,o){ci.copySnapshot(n,o),qn.slerp(t,qn.Identity,qn.rotationTo(t,a.up,o.up),i),_.transformQuat(n.up,a.up,t),_.lerp(n.target,a.target,o.target,i),_.lerp(n.position,a.position,o.position,i),n.radius=Xo(a.radius,o.radius,i),n.radiusMax=Xo(a.radiusMax,o.radiusMax,i),n.fov=Xo(a.fov,o.fov,i),n.fog=Xo(a.fog,o.fog,i)}e.defaultTransition=r})(pR||(pR={}));var ci=function(){function e(t,r,n){r===void 0&&(r=Xi.create(0,0,128,128)),n===void 0&&(n={}),this.view=ue.identity(),this.projection=ue.identity(),this.projectionView=ue.identity(),this.inverseProjectionView=ue.identity(),this.state=e.createDefaultSnapshot(),this.viewOffset=e.ViewOffset(),this.near=1,this.far=1e4,this.fogNear=5e3,this.fogFar=1e4,this.zoom=1,this.transition=new pR(this),this.stateChanged=new kf(this.state),this.prevProjection=ue.identity(),this.prevView=ue.identity(),this.deltaDirection=_(),this.newPosition=_(),this.viewport=r,this.pixelScale=n.pixelScale||1,e.copySnapshot(this.state,t)}return Object.defineProperty(e.prototype,"pixelRatio",{get:function(){var t=typeof window<"u"?window.devicePixelRatio:1;return t*this.pixelScale},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"position",{get:function(){return this.state.position},set:function(t){_.copy(this.state.position,t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"up",{get:function(){return this.state.up},set:function(t){_.copy(this.state.up,t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"target",{get:function(){return this.state.target},set:function(t){_.copy(this.state.target,t)},enumerable:!1,configurable:!0}),e.prototype.update=function(){var t=this.state;if(t.radiusMax===0)return!1;var r=2*Math.tan(t.fov/2)*_.distance(t.position,t.target);switch(this.zoom=this.viewport.height/r,hJe(this),this.state.mode){case"orthographic":fJe(this);break;case"perspective":pJe(this);break;default:throw new Error("unknown camera mode")}var n=!ue.areEqual(this.projection,this.prevProjection,xn)||!ue.areEqual(this.view,this.prevView,xn);if(n){if(ue.mul(this.projectionView,this.projection,this.view),!ue.tryInvert(this.inverseProjectionView,this.projectionView))return ue.copy(this.view,this.prevView),ue.copy(this.projection,this.prevProjection),ue.mul(this.projectionView,this.projection,this.view),!1;ue.copy(this.prevView,this.view),ue.copy(this.prevProjection,this.projection)}return n},e.prototype.setState=function(t,r){this.transition.apply(t,r),this.stateChanged.next(t)},e.prototype.getSnapshot=function(){return e.copySnapshot(e.createDefaultSnapshot(),this.state)},e.prototype.getTargetDistance=function(t){return e.targetDistance(t,this.state.fov,this.viewport.width,this.viewport.height)},e.prototype.getFocus=function(t,r,n,i){var a=Math.max(r,.01),o=this.getTargetDistance(a);_.sub(this.deltaDirection,this.target,this.position),i&&_.matchDirection(this.deltaDirection,i,this.deltaDirection),_.setMagnitude(this.deltaDirection,this.deltaDirection,o),_.sub(this.newPosition,t,this.deltaDirection);var s=e.copySnapshot(e.createDefaultSnapshot(),this.state);return s.target=_.clone(t),s.radius=a,s.position=_.clone(this.newPosition),n&&_.matchDirection(s.up,n,s.up),s},e.prototype.getInvariantFocus=function(t,r,n,i){var a=Math.max(r,.01),o=this.getTargetDistance(a);_.copy(this.deltaDirection,i),_.setMagnitude(this.deltaDirection,this.deltaDirection,o),_.sub(this.newPosition,t,this.deltaDirection);var s=e.copySnapshot(e.createDefaultSnapshot(),this.state);return s.target=_.clone(t),s.radius=a,s.position=_.clone(this.newPosition),_.copy(s.up,n),s},e.prototype.focus=function(t,r,n,i,a){r>0&&this.setState(this.getFocus(t,r,i,a),n)},e.prototype.project=function(t,r){return aJe(t,r,this.viewport,this.projectionView)},e.prototype.unproject=function(t,r){return iC(t,r,this.viewport,this.inverseProjectionView)},e}();(function(e){function t(){return{enabled:!1,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}}e.ViewOffset=t;function r(u,l,c,d,f,p,v){u.fullWidth=l,u.fullHeight=c,u.offsetX=d,u.offsetY=f,u.width=p,u.height=v}e.setViewOffset=r;function n(u,l){u.enabled=l.enabled,u.fullWidth=l.fullWidth,u.fullHeight=l.fullHeight,u.offsetX=l.offsetX,u.offsetY=l.offsetY,u.width=l.width,u.height=l.height}e.copyViewOffset=n;function i(u,l,c,d){var f=Math.max(u,.01),p=c/d,v=d<c?1:p;return Math.abs(f/v/Math.sin(l/2))}e.targetDistance=i;function a(){return{mode:"perspective",fov:Math.PI/4,position:_.create(0,0,100),up:_.create(0,1,0),target:_.create(0,0,0),radius:0,radiusMax:10,fog:50,clipFar:!0}}e.createDefaultSnapshot=a;function o(u,l){return l&&(typeof l.mode<"u"&&(u.mode=l.mode),typeof l.fov<"u"&&(u.fov=l.fov),typeof l.position<"u"&&_.copy(u.position,l.position),typeof l.up<"u"&&_.copy(u.up,l.up),typeof l.target<"u"&&_.copy(u.target,l.target),typeof l.radius<"u"&&(u.radius=l.radius),typeof l.radiusMax<"u"&&(u.radiusMax=l.radiusMax),typeof l.fog<"u"&&(u.fog=l.fog),typeof l.clipFar<"u"&&(u.clipFar=l.clipFar)),u}e.copySnapshot=o;function s(u,l){return u.mode===l.mode&&u.fov===l.fov&&u.radius===l.radius&&u.radiusMax===l.radiusMax&&u.fog===l.fog&&u.clipFar===l.clipFar&&_.exactEquals(u.position,l.position)&&_.exactEquals(u.up,l.up)&&_.exactEquals(u.target,l.target)}e.areSnapshotsEqual=s})(ci||(ci={}));function fJe(e){var t=e.viewport,r=e.zoom,n=e.near,i=e.far,a=e.viewOffset,o=-t.width/2,s=t.width/2,u=t.height/2,l=-t.height/2,c=(s-o)/(2*r),d=(u-l)/(2*r),f=(s+o)/2,p=(u+l)/2,v=f-c,h=f+c,m=p+d,g=p-d;if(a.enabled){var y=r/(a.width/a.fullWidth),b=r/(a.height/a.fullHeight),S=(s-o)/a.width,x=(u-l)/a.height;v+=S*(a.offsetX/y),h=v+S*(a.width/y),m-=x*(a.offsetY/b),g=m-x*(a.height/b)}ue.ortho(e.projection,v,h,m,g,n,i),ue.lookAt(e.view,e.position,e.target,e.up)}function pJe(e){var t=e.viewport.width/e.viewport.height,r=e.near,n=e.far,i=e.viewOffset,a=r*Math.tan(.5*e.state.fov),o=2*a,s=t*o,u=-.5*s;i.enabled&&(u+=i.offsetX*s/i.fullWidth,a-=i.offsetY*o/i.fullHeight,s*=i.width/i.fullWidth,o*=i.height/i.fullHeight),ue.perspective(e.projection,u,u+s,a,a-o,r,n),ue.lookAt(e.view,e.position,e.target,e.up)}function hJe(e){var t=e.state,r=t.radius,n=t.radiusMax,i=t.mode,a=t.fog,o=t.clipFar;r<.01&&(r=.01);var s=o?r:n,u=_.distance(e.position,e.target),l=u-r,c=u+s,d=-(50-a)/50,f=u-s*d,p=c;l=Math.max(Math.min(n,5),l),c=Math.max(5,c),l===c&&(c=l+.01),e.near=l,e.far=2*c,e.fogNear=f,e.fogFar=p}var vF={sceneBoundingSpheres:I.Boolean(!1,{description:"Show full scene bounding spheres."}),visibleSceneBoundingSpheres:I.Boolean(!1,{description:"Show visible scene bounding spheres."}),objectBoundingSpheres:I.Boolean(!1,{description:"Show bounding spheres of visible render objects."}),instanceBoundingSpheres:I.Boolean(!1,{description:"Show bounding spheres of visible instances."})},vJe=function(){function e(t,r,n){this.objectsData=new Map,this.instancesData=new Map,this.scene=Jg.create(t),this.parent=r,this._props=E(E({},I.getDefaultValues(vF)),n)}return e.prototype.update=function(){var t=this,r=Xx(this.scene,this.parent.boundingSphere,this.sceneData,fr.lightgrey,gJe);r&&(this.sceneData=r);var n=Xx(this.scene,this.parent.boundingSphereVisible,this.visibleSceneData,fr.black,yJe);n&&(this.visibleSceneData=n),this.parent.forEach(function(i,a){var o=t.objectsData.get(a),s=Xx(t.scene,i.values.boundingSphere.ref.value,o,fr.tomato,bJe);s&&t.objectsData.set(a,s);var u=t.instancesData.get(a),l=Xx(t.scene,i.values.invariantBoundingSphere.ref.value,u,fr.skyblue,xJe,{aTransform:a.values.aTransform,matrix:a.values.matrix,transform:a.values.transform,extraTransform:a.values.extraTransform,uInstanceCount:a.values.uInstanceCount,instanceCount:a.values.instanceCount,aInstance:a.values.aInstance,hasReflection:a.values.hasReflection});l&&t.instancesData.set(a,l)}),this.objectsData.forEach(function(i,a){t.parent.has(a)||(t.scene.remove(i.renderObject),t.objectsData.delete(a))}),this.instancesData.forEach(function(i,a){t.parent.has(a)||(t.scene.remove(i.renderObject),t.instancesData.delete(a))}),this.scene.update(void 0,!1),this.scene.commit()},e.prototype.syncVisibility=function(){var t=this;this.sceneData&&(this.sceneData.renderObject.state.visible=this._props.sceneBoundingSpheres),this.visibleSceneData&&(this.visibleSceneData.renderObject.state.visible=this._props.visibleSceneBoundingSpheres),this.parent.forEach(function(r,n){var i=t.objectsData.get(n);i&&(i.renderObject.state.visible=n.state.visible&&t._props.objectBoundingSpheres);var a=t.instancesData.get(n);a&&(a.renderObject.state.visible=n.state.visible&&t._props.instanceBoundingSpheres)})},e.prototype.clear=function(){this.sceneData=void 0,this.objectsData.clear(),this.scene.clear()},Object.defineProperty(e.prototype,"isEnabled",{get:function(){return this._props.sceneBoundingSpheres||this._props.visibleSceneBoundingSpheres||this._props.objectBoundingSpheres||this._props.instanceBoundingSpheres},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"props",{get:function(){return this._props},enumerable:!1,configurable:!0}),e.prototype.setProps=function(t){Object.assign(this._props,t),this.isEnabled&&this.update()},e}();function Xx(e,t,r,n,i,a){if(!r||!Be.equals(r.boundingSphere,t)){var o=mJe(t,r&&r.mesh),s=r?r.renderObject:SJe(o,n,i,a);return r?F.updateIfChanged(s.values.drawCount,la.getDrawCount(o)):e.add(s),{boundingSphere:Be.clone(t),renderObject:s,mesh:o}}}function mJe(e,t){var r=2,n=OE(r),i=wt.createState(n,n/2,t);if(e.radius&&(Ni(i,e.center,e.radius,r),Be.hasExtrema(e)))for(var a=0,o=e.extrema;a<o.length;a++){var s=o[a];Ni(i,s,1,0)}return wt.getMesh(i)}var gJe=Dd(),yJe=Dd(),bJe=Dd(),xJe=Dd();function SJe(e,t,r,n){var i=Ft.Utils.createValuesSimple(e,{alpha:.1,doubleSided:!1},t,1,n);return P0("mesh",i,{disposed:!1,visible:!0,alphaFactor:1,pickable:!1,colorOnly:!1,opaque:!1,writeDepth:!1,noClip:!1},r)}var CJe=function(){function e(t,r,n,i,a){var o=this;a===void 0&&(a=30),this.canvasIdentify=t,this.getLoci=r,this.input=n,this.camera=i,this.maxFps=a,this.ev=Jc.create(),this.events={hover:this.ev(),drag:this.ev(),click:this.ev()},this.startX=-1,this.startY=-1,this.endX=-1,this.endY=-1,this.id=void 0,this.position=void 0,this.currentIdentifyT=0,this.isInteracting=!1,this.prevLoci=or.Loci.Empty,this.prevT=0,this.inside=!1,this.buttons=Cv.create(0),this.button=Cv.create(0),this.modifiers=ku.None,n.drag.subscribe(function(s){var u=s.x,l=s.y,c=s.buttons,d=s.button,f=s.modifiers;o.isInteracting=!0,o.drag(u,l,c,d,f)}),n.move.subscribe(function(s){var u=s.x,l=s.y,c=s.inside,d=s.buttons,f=s.button,p=s.modifiers;!c||o.isInteracting||o.move(u,l,d,f,p)}),n.leave.subscribe(function(){o.leave()}),n.click.subscribe(function(s){var u=s.x,l=s.y,c=s.buttons,d=s.button,f=s.modifiers;o.outsideViewport(u,l)||o.click(u,l,c,d,f)}),n.interactionEnd.subscribe(function(){o.isInteracting=!1}),n.modifiers.subscribe(function(s){o.modify(s)})}return e.prototype.identify=function(t,r){var n=this.startX!==this.endX||this.startY!==this.endY;if(t===2){n&&!or.Loci.isEmpty(this.prevLoci)&&(this.events.drag.next({current:this.prevLoci,buttons:this.buttons,button:this.button,modifiers:this.modifiers,pageStart:He.create(this.startX,this.startY),pageEnd:He.create(this.endX,this.endY)}),this.startX=this.endX,this.startY=this.endY);return}if(n){var i=this.canvasIdentify(this.endX,this.endY);this.id=i==null?void 0:i.id,this.position=i==null?void 0:i.position,this.startX=this.endX,this.startY=this.endY}if(t===1){var a=this.getLoci(this.id);this.events.click.next({current:a,buttons:this.buttons,button:this.button,modifiers:this.modifiers,page:He.create(this.endX,this.endY),position:this.position}),this.prevLoci=a;return}if(!(!this.inside||this.currentIdentifyT!==r||!n||this.outsideViewport(this.endX,this.endY))){var o=this.getLoci(this.id);this.events.hover.next({current:o,buttons:this.buttons,button:this.button,modifiers:this.modifiers,page:He.create(this.endX,this.endY),position:this.position}),this.prevLoci=o}},e.prototype.tick=function(t){this.inside&&t-this.prevT>1e3/this.maxFps&&(this.prevT=t,this.currentIdentifyT=t,this.identify(this.isInteracting?2:0,t))},e.prototype.leave=function(){this.inside=!1,or.Loci.isEmpty(this.prevLoci)||(this.prevLoci=or.Loci.Empty,this.events.hover.next({current:this.prevLoci,buttons:this.buttons,button:this.button,modifiers:this.modifiers}))},e.prototype.move=function(t,r,n,i,a){this.inside=!0,this.buttons=n,this.button=i,this.modifiers=a,this.endX=t,this.endY=r},e.prototype.click=function(t,r,n,i,a){this.endX=t,this.endY=r,this.buttons=n,this.button=i,this.modifiers=a,this.identify(1,0)},e.prototype.drag=function(t,r,n,i,a){this.endX=t,this.endY=r,this.buttons=n,this.button=i,this.modifiers=a,this.identify(2,0)},e.prototype.modify=function(t){ku.areEqual(t,this.modifiers)||(this.modifiers=t,this.events.hover.next({current:this.prevLoci,buttons:this.buttons,button:this.button,modifiers:this.modifiers,page:He.create(this.endX,this.endY),position:this.position}))},e.prototype.outsideViewport=function(t,r){var n=this,i=n.input,a=n.camera.viewport;return t*=i.pixelRatio,r*=i.pixelRatio,t>a.x+a.width||i.height-r>a.y+a.height||t<a.x||i.height-r<a.y},e.prototype.dispose=function(){this.ev.dispose()},e}(),ko=`
precision highp float;

attribute vec2 aPosition;
uniform vec2 uQuadScale;

void main(void) {
    vec2 position = aPosition * uQuadScale - vec2(1.0, 1.0) + uQuadScale;
    gl_Position = vec4(position, 0.0, 1.0);
}
`,_Je=`
precision highp float;
precision highp int;
precision highp sampler2D;

uniform sampler2D tDepth;
uniform vec2 uTexSize;

uniform float uNear;
uniform float uFar;

uniform float uMaxPossibleViewZDiff;

#include common

float getViewZ(const in float depth) {
    #if dOrthographic == 1
        return orthographicDepthToViewZ(depth, uNear, uFar);
    #else
        return perspectiveDepthToViewZ(depth, uNear, uFar);
    #endif
}

float getDepth(const in vec2 coords) {
    return unpackRGBAToDepth(texture2D(tDepth, coords));
}

bool isBackground(const in float depth) {
    return depth == 1.0;
}

void main(void) {
    float backgroundViewZ = uFar + 3.0 * uMaxPossibleViewZDiff;

    vec2 coords = gl_FragCoord.xy / uTexSize;
    vec2 invTexSize = 1.0 / uTexSize;

    float selfDepth = getDepth(coords);
    float selfViewZ = isBackground(selfDepth) ? backgroundViewZ : getViewZ(getDepth(coords));

    float outline = 1.0;
    float bestDepth = 1.0;

    for (int y = -1; y <= 1; y++) {
        for (int x = -1; x <= 1; x++) {
            vec2 sampleCoords = coords + vec2(float(x), float(y)) * invTexSize;
            float sampleDepth = getDepth(sampleCoords);
            float sampleViewZ = isBackground(sampleDepth) ? backgroundViewZ : getViewZ(sampleDepth);

            if (abs(selfViewZ - sampleViewZ) > uMaxPossibleViewZDiff && selfDepth > sampleDepth && sampleDepth <= bestDepth) {
                outline = 0.0;
                bestDepth = sampleDepth;
            }
        }
    }

    gl_FragColor = vec4(outline, packUnitIntervalToRG(bestDepth), 0.0);
}
`,wJe=`
precision highp float;
precision highp int;
precision highp sampler2D;

#include common

uniform sampler2D tDepth;
uniform vec2 uTexSize;
uniform vec4 uBounds;

uniform vec3 uSamples[dNSamples];

uniform mat4 uProjection;
uniform mat4 uInvProjection;

uniform float uRadius;
uniform float uBias;

float smootherstep(float edge0, float edge1, float x) {
    x = clamp((x - edge0) / (edge1 - edge0), 0.0, 1.0);
    return x * x * x * (x * (x * 6.0 - 15.0) + 10.0);
}

float noise(const in vec2 coords) {
    float a = 12.9898;
    float b = 78.233;
    float c = 43758.5453;
    float dt = dot(coords, vec2(a,b));
    float sn = mod(dt, PI);
    return abs(fract(sin(sn) * c)); // is abs necessary?
}

vec2 getNoiseVec2(const in vec2 coords) {
    return vec2(noise(coords), noise(coords + vec2(PI, 2.71828)));
}

bool isBackground(const in float depth) {
    return depth == 1.0;
}

bool outsideBounds(const in vec2 p) {
    return p.x < uBounds.x || p.y < uBounds.y || p.x > uBounds.z || p.y > uBounds.w;
}

float getDepth(const in vec2 coords) {
    return outsideBounds(coords) ? 1.0 : unpackRGBAToDepth(texture2D(tDepth, coords));
}

vec3 normalFromDepth(const in float depth, const in float depth1, const in float depth2, vec2 offset1, vec2 offset2) {
    vec3 p1 = vec3(offset1, depth1 - depth);
    vec3 p2 = vec3(offset2, depth2 - depth);

    vec3 normal = cross(p1, p2);
    normal.z = -normal.z;

    return normalize(normal);
}

// StarCraft II Ambient Occlusion by [Filion and McNaughton 2008]
void main(void) {
    vec2 invTexSize = 1.0 / uTexSize;
    vec2 selfCoords = gl_FragCoord.xy * invTexSize;

    float selfDepth = getDepth(selfCoords);
    vec2 selfPackedDepth = packUnitIntervalToRG(selfDepth);

    if (isBackground(selfDepth)) {
        gl_FragColor = vec4(packUnitIntervalToRG(0.0), selfPackedDepth);
        return;
    }

    vec2 offset1 = vec2(0.0, invTexSize.y);
    vec2 offset2 = vec2(invTexSize.x, 0.0);

    float selfDepth1 = getDepth(selfCoords + offset1);
    float selfDepth2 = getDepth(selfCoords + offset2);

    vec3 selfViewNormal = normalFromDepth(selfDepth, selfDepth1, selfDepth2, offset1, offset2);
    vec3 selfViewPos = screenSpaceToViewSpace(vec3(selfCoords, selfDepth), uInvProjection);

    vec3 randomVec = normalize(vec3(getNoiseVec2(selfCoords) * 2.0 - 1.0, 0.0));

    vec3 tangent = normalize(randomVec - selfViewNormal * dot(randomVec, selfViewNormal));
    vec3 bitangent = cross(selfViewNormal, tangent);
    mat3 TBN = mat3(tangent, bitangent, selfViewNormal);

    float occlusion = 0.0;
    for(int i = 0; i < dNSamples; i++){
        vec3 sampleViewPos = TBN * uSamples[i];
        sampleViewPos = selfViewPos + sampleViewPos * uRadius;

        vec4 offset = vec4(sampleViewPos, 1.0);
        offset = uProjection * offset;
        offset.xyz = (offset.xyz / offset.w) * 0.5 + 0.5;

        float sampleViewZ = screenSpaceToViewSpace(vec3(offset.xy, getDepth(offset.xy)), uInvProjection).z;

        occlusion += step(sampleViewPos.z + 0.025, sampleViewZ) * smootherstep(0.0, 1.0, uRadius / abs(selfViewPos.z - sampleViewZ));
    }
    occlusion = 1.0 - (uBias * occlusion / float(dNSamples));

    vec2 packedOcclusion = packUnitIntervalToRG(occlusion);

    gl_FragColor = vec4(packedOcclusion, selfPackedDepth);
}
`,EJe=`
precision highp float;
precision highp int;
precision highp sampler2D;

uniform sampler2D tSsaoDepth;
uniform vec2 uTexSize;
uniform vec4 uBounds;

uniform float uKernel[dOcclusionKernelSize];

uniform float uBlurDirectionX;
uniform float uBlurDirectionY;

uniform float uMaxPossibleViewZDiff;

uniform float uNear;
uniform float uFar;

#include common

float getViewZ(const in float depth) {
    #if dOrthographic == 1
        return orthographicDepthToViewZ(depth, uNear, uFar);
    #else
        return perspectiveDepthToViewZ(depth, uNear, uFar);
    #endif
}

bool isBackground(const in float depth) {
    return depth == 1.0;
}

bool outsideBounds(const in vec2 p) {
    return p.x < uBounds.x || p.y < uBounds.y || p.x > uBounds.z || p.y > uBounds.w;
}

void main(void) {
    vec2 coords = gl_FragCoord.xy / uTexSize;

    vec2 packedDepth = texture2D(tSsaoDepth, coords).zw;

    if (outsideBounds(coords)) {
        gl_FragColor = vec4(packUnitIntervalToRG(1.0), packedDepth);
        return;
    }

    float selfDepth = unpackRGToUnitInterval(packedDepth);
    // if background and if second pass
    if (isBackground(selfDepth) && uBlurDirectionY != 0.0) {
        gl_FragColor = vec4(packUnitIntervalToRG(1.0), packedDepth);
        return;
    }

    float selfViewZ = getViewZ(selfDepth);

    vec2 offset = vec2(uBlurDirectionX, uBlurDirectionY) / uTexSize;

    float sum = 0.0;
    float kernelSum = 0.0;
    // only if kernelSize is odd
    for (int i = -dOcclusionKernelSize / 2; i <= dOcclusionKernelSize / 2; i++) {
        vec2 sampleCoords = coords + float(i) * offset;
        if (outsideBounds(sampleCoords)) {
            continue;
        }

        vec4 sampleSsaoDepth = texture2D(tSsaoDepth, sampleCoords);

        float sampleDepth = unpackRGToUnitInterval(sampleSsaoDepth.zw);
        if (isBackground(sampleDepth)) {
            continue;
        }

        if (abs(float(i)) > 1.0) { // abs is not defined for int in webgl1
            float sampleViewZ = getViewZ(sampleDepth);
            if (abs(selfViewZ - sampleViewZ) > uMaxPossibleViewZDiff) {
                continue;
            }
        }

        float kernel = uKernel[int(abs(float(i)))]; // abs is not defined for int in webgl1
        float sampleValue = unpackRGToUnitInterval(sampleSsaoDepth.xy);

        sum += kernel * sampleValue;
        kernelSum += kernel;
    }

    gl_FragColor = vec4(packUnitIntervalToRG(sum / kernelSum), packedDepth);
}
`,AJe=`
precision highp float;
precision highp int;
precision highp sampler2D;

uniform sampler2D tSsaoDepth;
uniform sampler2D tColor;
uniform sampler2D tDepth;
uniform sampler2D tOutlines;
uniform vec2 uTexSize;

uniform float uNear;
uniform float uFar;
uniform float uFogNear;
uniform float uFogFar;
uniform vec3 uFogColor;
uniform bool uTransparentBackground;

uniform float uOcclusionBias;
uniform float uOcclusionRadius;

uniform float uMaxPossibleViewZDiff;

const vec3 occlusionColor = vec3(0.0);

#include common

float getViewZ(const in float depth) {
    #if dOrthographic == 1
        return orthographicDepthToViewZ(depth, uNear, uFar);
    #else
        return perspectiveDepthToViewZ(depth, uNear, uFar);
    #endif
}

float getDepth(const in vec2 coords) {
    return unpackRGBAToDepth(texture2D(tDepth, coords));
}

bool isBackground(const in float depth) {
    return depth == 1.0;
}

float getOutline(const in vec2 coords, out float closestTexel) {
    float backgroundViewZ = uFar + 3.0 * uMaxPossibleViewZDiff;
    vec2 invTexSize = 1.0 / uTexSize;

    float selfDepth = getDepth(coords);
    float selfViewZ = isBackground(selfDepth) ? backgroundViewZ : getViewZ(selfDepth);

    float outline = 1.0;
    closestTexel = 1.0;
    for (int y = -dOutlineScale; y <= dOutlineScale; y++) {
        for (int x = -dOutlineScale; x <= dOutlineScale; x++) {
            if (x * x + y * y > dOutlineScale * dOutlineScale) {
                continue;
            }

            vec2 sampleCoords = coords + vec2(float(x), float(y)) * invTexSize;

            vec4 sampleOutlineCombined = texture2D(tOutlines, sampleCoords);
            float sampleOutline = sampleOutlineCombined.r;
            float sampleOutlineDepth = unpackRGToUnitInterval(sampleOutlineCombined.gb);

            if (sampleOutline == 0.0 && sampleOutlineDepth < closestTexel && abs(selfViewZ - sampleOutlineDepth) > uMaxPossibleViewZDiff) {
                outline = 0.0;
                closestTexel = sampleOutlineDepth;
            }
        }
    }
    return outline;
}

float getSsao(vec2 coords) {
    float rawSsao = unpackRGToUnitInterval(texture2D(tSsaoDepth, coords).xy);
    if (rawSsao > 0.999) {
        return 1.0;
    } else if (rawSsao > 0.001) {
        return rawSsao;
    }
    // treat values close to 0.0 as errors and return no occlusion
    return 1.0;
}

void main(void) {
    vec2 coords = gl_FragCoord.xy / uTexSize;
    vec4 color = texture2D(tColor, coords);

    float viewDist;
    float fogFactor;

    #ifdef dOcclusionEnable
        float depth = getDepth(coords);
        if (!isBackground(depth)) {
            viewDist = abs(getViewZ(depth));
            fogFactor = smoothstep(uFogNear, uFogFar, viewDist);
            float occlusionFactor = getSsao(coords);
            if (!uTransparentBackground) {
                color.rgb = mix(mix(occlusionColor, uFogColor, fogFactor), color.rgb, occlusionFactor);
            } else {
                color.rgb = mix(occlusionColor * (1.0 - fogFactor), color.rgb, occlusionFactor);
            }
        }
    #endif

    // outline needs to be handled after occlusion to keep them clean
    #ifdef dOutlineEnable
        float closestTexel;
        float outline = getOutline(coords, closestTexel);

        if (outline == 0.0) {
            color.rgb *= outline;
            viewDist = abs(getViewZ(closestTexel));
            fogFactor = smoothstep(uFogNear, uFogFar, viewDist);
            if (!uTransparentBackground) {
                color.rgb = mix(color.rgb, uFogColor, fogFactor);
            } else {
                color.a = 1.0 - fogFactor;
            }
        }
    #endif

    gl_FragColor = color;
}
`,PJe=`
precision highp float;
precision highp int;
precision highp sampler2D;

uniform sampler2D tColor;
uniform vec2 uTexSizeInv;

// adapted from https://github.com/kosua20/Rendu
// MIT License Copyright (c) 2017 Simon Rodriguez

#define QUALITY(q) ((q) < 5 ? 1.0 : ((q) > 5 ? ((q) < 10 ? 2.0 : ((q) < 11 ? 4.0 : 8.0)) : 1.5))

float rgb2luma(vec3 rgb){
    return sqrt(dot(rgb, vec3(0.299, 0.587, 0.114)));
}

float sampleLuma(vec2 uv) {
    return rgb2luma(texture2D(tColor, uv).rgb);
}

float sampleLuma(vec2 uv, float uOffset, float vOffset) {
    uv += uTexSizeInv * vec2(uOffset, vOffset);
    return sampleLuma(uv);
}

void main(void) {
    vec2 coords = gl_FragCoord.xy * uTexSizeInv;
    vec2 inverseScreenSize = uTexSizeInv;

    vec4 colorCenter = texture2D(tColor, coords);

    // Luma at the current fragment
    float lumaCenter = rgb2luma(colorCenter.rgb);

    // Luma at the four direct neighbours of the current fragment.
    float lumaDown = sampleLuma(coords, 0.0, -1.0);
    float lumaUp = sampleLuma(coords, 0.0, 1.0);
    float lumaLeft = sampleLuma(coords, -1.0, 0.0);
    float lumaRight = sampleLuma(coords, 1.0, 0.0);

    // Find the maximum and minimum luma around the current fragment.
    float lumaMin = min(lumaCenter, min(min(lumaDown, lumaUp), min(lumaLeft, lumaRight)));
    float lumaMax = max(lumaCenter, max(max(lumaDown, lumaUp), max(lumaLeft, lumaRight)));

    // Compute the delta.
    float lumaRange = lumaMax - lumaMin;

    // If the luma variation is lower that a threshold (or if we are in a really dark area),
    // we are not on an edge, don't perform any AA.
    if (lumaRange < max(dEdgeThresholdMin, lumaMax * dEdgeThresholdMax)) {
        gl_FragColor = colorCenter;
        return;
    }

    // Query the 4 remaining corners lumas.
    float lumaDownLeft = sampleLuma(coords, -1.0, -1.0);
    float lumaUpRight = sampleLuma(coords, 1.0, 1.0);
    float lumaUpLeft = sampleLuma(coords, -1.0, 1.0);
    float lumaDownRight = sampleLuma(coords, 1.0, -1.0);

    // Combine the four edges lumas (using intermediary variables for future computations
    // with the same values).
    float lumaDownUp = lumaDown + lumaUp;
    float lumaLeftRight = lumaLeft + lumaRight;

    // Same for corners
    float lumaLeftCorners = lumaDownLeft + lumaUpLeft;
    float lumaDownCorners = lumaDownLeft + lumaDownRight;
    float lumaRightCorners = lumaDownRight + lumaUpRight;
    float lumaUpCorners = lumaUpRight + lumaUpLeft;

    // Compute an estimation of the gradient along the horizontal and vertical axis.
    float edgeHorizontal = abs(-2.0 * lumaLeft + lumaLeftCorners) + abs(-2.0 * lumaCenter + lumaDownUp) * 2.0 + abs(-2.0 * lumaRight + lumaRightCorners);
    float edgeVertical = abs(-2.0 * lumaUp + lumaUpCorners) + abs(-2.0 * lumaCenter + lumaLeftRight) * 2.0 + abs(-2.0 * lumaDown + lumaDownCorners);

    // Is the local edge horizontal or vertical ?
    bool isHorizontal = (edgeHorizontal >= edgeVertical);

    // Choose the step size (one pixel) accordingly.
    float stepLength = isHorizontal ? inverseScreenSize.y : inverseScreenSize.x;

    // Select the two neighboring texels lumas in the opposite direction to the local edge.
    float luma1 = isHorizontal ? lumaDown : lumaLeft;
    float luma2 = isHorizontal ? lumaUp : lumaRight;
    // Compute gradients in this direction.
    float gradient1 = luma1 - lumaCenter;
    float gradient2 = luma2 - lumaCenter;

    // Which direction is the steepest ?
    bool is1Steepest = abs(gradient1) >= abs(gradient2);

    // Gradient in the corresponding direction, normalized.
    float gradientScaled = 0.25 * max(abs(gradient1), abs(gradient2));

    // Average luma in the correct direction.
    float lumaLocalAverage = 0.0;
    if(is1Steepest){
        // Switch the direction
        stepLength = -stepLength;
        lumaLocalAverage = 0.5 * (luma1 + lumaCenter);
    } else {
        lumaLocalAverage = 0.5 * (luma2 + lumaCenter);
    }

    // Shift UV in the correct direction by half a pixel.
    vec2 currentUv = coords;
    if(isHorizontal){
        currentUv.y += stepLength * 0.5;
    } else {
        currentUv.x += stepLength * 0.5;
    }

    // Compute offset (for each iteration step) in the right direction.
    vec2 offset = isHorizontal ? vec2(inverseScreenSize.x, 0.0) : vec2(0.0, inverseScreenSize.y);
    // Compute UVs to explore on each side of the edge, orthogonally.
    // The QUALITY allows us to step faster.
    vec2 uv1 = currentUv - offset * QUALITY(0);
    vec2 uv2 = currentUv + offset * QUALITY(0);

    // Read the lumas at both current extremities of the exploration segment,
    // and compute the delta wrt to the local average luma.
    float lumaEnd1 = sampleLuma(uv1);
    float lumaEnd2 = sampleLuma(uv2);
    lumaEnd1 -= lumaLocalAverage;
    lumaEnd2 -= lumaLocalAverage;

    // If the luma deltas at the current extremities is larger than the local gradient,
    // we have reached the side of the edge.
    bool reached1 = abs(lumaEnd1) >= gradientScaled;
    bool reached2 = abs(lumaEnd2) >= gradientScaled;
    bool reachedBoth = reached1 && reached2;

    // If the side is not reached, we continue to explore in this direction.
    if(!reached1){
        uv1 -= offset * QUALITY(1);
    }
    if(!reached2){
        uv2 += offset * QUALITY(1);
    }

    // If both sides have not been reached, continue to explore.
    if(!reachedBoth){
        for(int i = 2; i < dIterations; i++){
            // If needed, read luma in 1st direction, compute delta.
            if(!reached1){
                lumaEnd1 = sampleLuma(uv1);
                lumaEnd1 = lumaEnd1 - lumaLocalAverage;
            }
            // If needed, read luma in opposite direction, compute delta.
            if(!reached2){
                lumaEnd2 = sampleLuma(uv2);
                lumaEnd2 = lumaEnd2 - lumaLocalAverage;
            }
            // If the luma deltas at the current extremities is larger than the local gradient,
            // we have reached the side of the edge.
            reached1 = abs(lumaEnd1) >= gradientScaled;
            reached2 = abs(lumaEnd2) >= gradientScaled;
            reachedBoth = reached1 && reached2;

            // If the side is not reached, we continue to explore in this direction,
            // with a variable quality.
            if(!reached1){
                uv1 -= offset * QUALITY(i);
            }
            if(!reached2){
                uv2 += offset * QUALITY(i);
            }

            // If both sides have been reached, stop the exploration.
            if(reachedBoth){
                break;
            }
        }
    }

    // Compute the distances to each side edge of the edge (!).
    float distance1 = isHorizontal ? (coords.x - uv1.x) : (coords.y - uv1.y);
    float distance2 = isHorizontal ? (uv2.x - coords.x) : (uv2.y - coords.y);

    // In which direction is the side of the edge closer ?
    bool isDirection1 = distance1 < distance2;
    float distanceFinal = min(distance1, distance2);

    // Thickness of the edge.
    float edgeThickness = (distance1 + distance2);

    // Is the luma at center smaller than the local average ?
    bool isLumaCenterSmaller = lumaCenter < lumaLocalAverage;

    // If the luma at center is smaller than at its neighbour,
    // the delta luma at each end should be positive (same variation).
    bool correctVariation1 = (lumaEnd1 < 0.0) != isLumaCenterSmaller;
    bool correctVariation2 = (lumaEnd2 < 0.0) != isLumaCenterSmaller;

    // Only keep the result in the direction of the closer side of the edge.
    bool correctVariation = isDirection1 ? correctVariation1 : correctVariation2;

    // UV offset: read in the direction of the closest side of the edge.
    float pixelOffset = - distanceFinal / edgeThickness + 0.5;

    // If the luma variation is incorrect, do not offset.
    float finalOffset = correctVariation ? pixelOffset : 0.0;

    // Sub-pixel shifting
    // Full weighted average of the luma over the 3x3 neighborhood.
    float lumaAverage = (1.0 / 12.0) * (2.0 * (lumaDownUp + lumaLeftRight) + lumaLeftCorners + lumaRightCorners);
    // Ratio of the delta between the global average and the center luma,
    // over the luma range in the 3x3 neighborhood.
    float subPixelOffset1 = clamp(abs(lumaAverage - lumaCenter) / lumaRange, 0.0, 1.0);
    float subPixelOffset2 = (-2.0 * subPixelOffset1 + 3.0) * subPixelOffset1 * subPixelOffset1;
    // Compute a sub-pixel offset based on this delta.
    float subPixelOffsetFinal = subPixelOffset2 * subPixelOffset2 * float(dSubpixelQuality);

    // Pick the biggest of the two offsets.
    finalOffset = max(finalOffset, subPixelOffsetFinal);

    // Compute the final UV coordinates.
    vec2 finalUv = coords;
    if(isHorizontal){
        finalUv.y += finalOffset * stepLength;
    } else {
        finalUv.x += finalOffset * stepLength;
    }

    // Read the color at the new UV coordinates, and use it.
    gl_FragColor = texture2D(tColor, finalUv);
}
`,TJe={edgeThresholdMin:I.Numeric(.0312,{min:.0312,max:.0833,step:1e-4},{description:"Trims the algorithm from processing darks."}),edgeThresholdMax:I.Numeric(.063,{min:.063,max:.333,step:.001},{description:"The minimum amount of local contrast required to apply algorithm."}),iterations:I.Numeric(12,{min:0,max:16,step:1},{description:"Number of edge exploration steps."}),subpixelQuality:I.Numeric(.3,{min:0,max:1,step:.01},{description:"Choose the amount of sub-pixel aliasing removal."})},IJe=function(){function e(t,r){this.webgl=t,this.renderable=RJe(t,r)}return e.prototype.updateState=function(t){var r=this.webgl,n=r.gl,i=r.state;i.enable(n.SCISSOR_TEST),i.disable(n.BLEND),i.disable(n.DEPTH_TEST),i.depthMask(!1);var a=t.x,o=t.y,s=t.width,u=t.height;n.viewport(a,o,s,u),n.scissor(a,o,s,u),i.clearColor(0,0,0,1),n.clear(n.COLOR_BUFFER_BIT)},e.prototype.setSize=function(t,r){F.update(this.renderable.values.uTexSizeInv,He.set(this.renderable.values.uTexSizeInv.ref.value,1/t,1/r))},e.prototype.update=function(t,r){var n=this.renderable.values,i=r.edgeThresholdMin,a=r.edgeThresholdMax,o=r.iterations,s=r.subpixelQuality,u=!1;n.tColor.ref.value!==t&&(F.update(this.renderable.values.tColor,t),u=!0),n.dEdgeThresholdMin.ref.value!==i&&(u=!0),F.updateIfChanged(n.dEdgeThresholdMin,i),n.dEdgeThresholdMax.ref.value!==a&&(u=!0),F.updateIfChanged(n.dEdgeThresholdMax,a),n.dIterations.ref.value!==o&&(u=!0),F.updateIfChanged(n.dIterations,o),n.dSubpixelQuality.ref.value!==s&&(u=!0),F.updateIfChanged(n.dSubpixelQuality,s),u&&this.renderable.update()},e.prototype.render=function(t,r){r?r.bind():this.webgl.unbindFramebuffer(),this.updateState(t),this.renderable.render()},e}(),MJe=E(E({},_a),{tColor:ur("texture","rgba","ubyte","linear"),uTexSizeInv:Ge("v2"),dEdgeThresholdMin:Qt("number"),dEdgeThresholdMax:Qt("number"),dIterations:Qt("number"),dSubpixelQuality:Qt("number")}),DJe=Ln("fxaa",ko,PJe);function RJe(e,t){var r=t.getWidth(),n=t.getHeight(),i=E(E({},wa),{tColor:F.create(t),uTexSizeInv:F.create(He.create(1/r,1/n)),dEdgeThresholdMin:F.create(.0312),dEdgeThresholdMax:F.create(.125),dIterations:F.create(12),dSubpixelQuality:F.create(.3)}),a=E({},MJe),o=Ji(e,"triangles",DJe,a,i);return Zi(o,i)}var kJe=`
precision highp float;

attribute vec2 aPosition;
uniform vec2 uQuadScale;

uniform vec2 uTexSizeInv;
uniform vec4 uViewport;

varying vec2 vUv;
varying vec4 vOffset[2];

void SMAANeighborhoodBlendingVS(vec2 texCoord) {
    vOffset[0] = texCoord.xyxy + uTexSizeInv.xyxy * vec4(-1.0, 0.0, 0.0, 1.0); // WebGL port note: Changed sign in W component
    vOffset[1] = texCoord.xyxy + uTexSizeInv.xyxy * vec4(1.0, 0.0, 0.0, -1.0); // WebGL port note: Changed sign in W component
}

void main() {
    vec2 scale = uViewport.zw * uTexSizeInv;
    vec2 shift = uViewport.xy * uTexSizeInv;
    vUv = (aPosition + 1.0) * 0.5 * scale + shift;
    SMAANeighborhoodBlendingVS(vUv);
    vec2 position = aPosition * uQuadScale - vec2(1.0, 1.0) + uQuadScale;
    gl_Position = vec4(position, 0.0, 1.0);
}
`,OJe=`
precision highp float;
precision highp int;
precision highp sampler2D;

uniform sampler2D tWeights;
uniform sampler2D tColor;
uniform vec2 uTexSizeInv;

varying vec2 vUv;
varying vec4 vOffset[2];

vec4 SMAANeighborhoodBlendingPS(vec2 texCoord, vec4 offset[2], sampler2D colorTex, sampler2D blendTex) {
    // Fetch the blending weights for current pixel:
    vec4 a;
    a.xz = texture2D(blendTex, texCoord).xz;
    a.y = texture2D(blendTex, offset[1].zw).g;
    a.w = texture2D(blendTex, offset[1].xy).a;

    // Is there any blending weight with a value greater than 0.0?
    if (dot(a, vec4(1.0, 1.0, 1.0, 1.0)) < 1e-5) {
        return texture2D(colorTex, texCoord, 0.0);
    } else {
        // Up to 4 lines can be crossing a pixel (one through each edge). We
        // favor blending by choosing the line with the maximum weight for each
        // direction:
        vec2 offset;
        offset.x = a.a > a.b ? a.a : -a.b; // left vs. right
        offset.y = a.g > a.r ? -a.g : a.r; // top vs. bottom // WebGL port note: Changed signs

        // Then we go in the direction that has the maximum weight:
        if (abs(offset.x) > abs(offset.y)) { // horizontal vs. vertical
            offset.y = 0.0;
        } else {
            offset.x = 0.0;
        }

        // Fetch the opposite color and lerp by hand:
        vec4 C = texture2D(colorTex, texCoord, 0.0);
        texCoord += sign(offset) * uTexSizeInv;
        vec4 Cop = texture2D(colorTex, texCoord, 0.0);
        float s = abs(offset.x) > abs(offset.y) ? abs(offset.x) : abs(offset.y);

        // WebGL port note: Added gamma correction
        C.xyz = pow(C.xyz, vec3(2.2));
        Cop.xyz = pow(Cop.xyz, vec3(2.2));
        vec4 mixed = mix(C, Cop, s);
        mixed.xyz = pow(mixed.xyz, vec3(1.0 / 2.2));

        return mixed;
    }
}

void main() {
    gl_FragColor = SMAANeighborhoodBlendingPS(vUv, vOffset, tColor, tWeights);
}
`,LJe=`
precision highp float;

attribute vec2 aPosition;
uniform vec2 uQuadScale;

uniform vec2 uTexSizeInv;
uniform vec4 uViewport;

varying vec2 vUv;
varying vec4 vOffset[3];
varying vec2 vPixCoord;

void SMAABlendingWeightCalculationVS(vec2 texCoord) {
    vPixCoord = texCoord / uTexSizeInv;

    // We will use these offsets for the searches later on (see @PSEUDO_GATHER4):
    vOffset[0] = texCoord.xyxy + uTexSizeInv.xyxy * vec4(-0.25, 0.125, 1.25, 0.125); // WebGL port note: Changed sign in Y and W components
    vOffset[1] = texCoord.xyxy + uTexSizeInv.xyxy * vec4(-0.125, 0.25, -0.125, -1.25); // WebGL port note: Changed sign in Y and W components

    // And these for the searches, they indicate the ends of the loops:
    vOffset[2] = vec4(vOffset[0].xz, vOffset[1].yw) + vec4(-2.0, 2.0, -2.0, 2.0) * uTexSizeInv.xxyy * float(dMaxSearchSteps);
}

void main() {
    vec2 scale = uViewport.zw * uTexSizeInv;
    vec2 shift = uViewport.xy * uTexSizeInv;
    vUv = (aPosition + 1.0) * 0.5 * scale + shift;
    SMAABlendingWeightCalculationVS(vUv);
    vec2 position = aPosition * uQuadScale - vec2(1.0, 1.0) + uQuadScale;
    gl_Position = vec4(position, 0.0, 1.0);
}
`,FJe=`
precision highp float;
precision highp int;
precision highp sampler2D;

#define SMAASampleLevelZeroOffset(tex, coord, offset) texture2D(tex, coord + float(offset) * uTexSizeInv, 0.0)

#define SMAA_AREATEX_MAX_DISTANCE 16
#define SMAA_AREATEX_PIXEL_SIZE (1.0 / vec2(160.0, 560.0))
#define SMAA_AREATEX_SUBTEX_SIZE (1.0 / 7.0)

uniform sampler2D tEdges;
uniform sampler2D tArea;
uniform sampler2D tSearch;
uniform vec2 uTexSizeInv;

varying vec2 vUv;
varying vec4 vOffset[3];
varying vec2 vPixCoord;

#if __VERSION__ == 100
    vec2 round(vec2 x) {
        return sign(x) * floor(abs(x) + 0.5);
    }
#endif

float SMAASearchLength(sampler2D searchTex, vec2 e, float bias, float scale) {
    // Not required if searchTex accesses are set to point:
    // float2 SEARCH_TEX_PIXEL_SIZE = 1.0 / float2(66.0, 33.0);
    // e = float2(bias, 0.0) + 0.5 * SEARCH_TEX_PIXEL_SIZE +
    //     e * float2(scale, 1.0) * float2(64.0, 32.0) * SEARCH_TEX_PIXEL_SIZE;
    e.r = bias + e.r * scale;
    return 255.0 * texture2D(searchTex, e, 0.0).r;
}

float SMAASearchXLeft(sampler2D edgesTex, sampler2D searchTex, vec2 texCoord, float end) {
    /**
     * @PSEUDO_GATHER4
     * This texCoord has been offset by (-0.25, -0.125) in the vertex shader to
     * sample between edge, thus fetching four edges in a row.
     * Sampling with different offsets in each direction allows to disambiguate
     * which edges are active from the four fetched ones.
     */
    vec2 e = vec2(0.0, 1.0);

    for (int i = 0; i < dMaxSearchSteps; i++) { // WebGL port note: Changed while to for
        e = texture2D( edgesTex, texCoord, 0.0).rg;
        texCoord -= vec2(2.0, 0.0) * uTexSizeInv;
        if (!(texCoord.x > end && e.g > 0.8281 && e.r == 0.0)) break;
    }

    // We correct the previous (-0.25, -0.125) offset we applied:
    texCoord.x += 0.25 * uTexSizeInv.x;

    // The searches are bias by 1, so adjust the coords accordingly:
    texCoord.x += uTexSizeInv.x;

    // Disambiguate the length added by the last step:
    texCoord.x += 2.0 * uTexSizeInv.x; // Undo last step
    texCoord.x -= uTexSizeInv.x * SMAASearchLength(searchTex, e, 0.0, 0.5);

    return texCoord.x;
}

float SMAASearchXRight(sampler2D edgesTex, sampler2D searchTex, vec2 texCoord, float end) {
    vec2 e = vec2( 0.0, 1.0 );

    for (int i = 0; i < dMaxSearchSteps; i++) { // WebGL port note: Changed while to for
        e = texture2D(edgesTex, texCoord, 0.0).rg;
        texCoord += vec2(2.0, 0.0) * uTexSizeInv;
        if (!(texCoord.x < end && e.g > 0.8281 && e.r == 0.0)) break;
    }

    texCoord.x -= 0.25 * uTexSizeInv.x;
    texCoord.x -= uTexSizeInv.x;
    texCoord.x -= 2.0 * uTexSizeInv.x;
    texCoord.x += uTexSizeInv.x * SMAASearchLength( searchTex, e, 0.5, 0.5 );

    return texCoord.x;
}

float SMAASearchYUp(sampler2D edgesTex, sampler2D searchTex, vec2 texCoord, float end) {
    vec2 e = vec2( 1.0, 0.0 );

    for (int i = 0; i < dMaxSearchSteps; i++) { // WebGL port note: Changed while to for
        e = texture2D(edgesTex, texCoord, 0.0).rg;
        texCoord += vec2(0.0, 2.0) * uTexSizeInv; // WebGL port note: Changed sign
        if (!(texCoord.y > end && e.r > 0.8281 && e.g == 0.0)) break;
    }

    texCoord.y -= 0.25 * uTexSizeInv.y; // WebGL port note: Changed sign
    texCoord.y -= uTexSizeInv.y; // WebGL port note: Changed sign
    texCoord.y -= 2.0 * uTexSizeInv.y; // WebGL port note: Changed sign
    texCoord.y += uTexSizeInv.y * SMAASearchLength(searchTex, e.gr, 0.0, 0.5); // WebGL port note: Changed sign

    return texCoord.y;
}

float SMAASearchYDown(sampler2D edgesTex, sampler2D searchTex, vec2 texCoord, float end) {
    vec2 e = vec2( 1.0, 0.0 );

    for (int i = 0; i < dMaxSearchSteps; i++) { // WebGL port note: Changed while to for
        e = texture2D(edgesTex, texCoord, 0.0).rg;
        texCoord -= vec2( 0.0, 2.0 ) * uTexSizeInv; // WebGL port note: Changed sign
        if (!(texCoord.y < end && e.r > 0.8281 && e.g == 0.0)) break;
    }

    texCoord.y += 0.25 * uTexSizeInv.y; // WebGL port note: Changed sign
    texCoord.y += uTexSizeInv.y; // WebGL port note: Changed sign
    texCoord.y += 2.0 * uTexSizeInv.y; // WebGL port note: Changed sign
    texCoord.y -= uTexSizeInv.y * SMAASearchLength(searchTex, e.gr, 0.5, 0.5); // WebGL port note: Changed sign

    return texCoord.y;
}

vec2 SMAAArea(sampler2D areaTex, vec2 dist, float e1, float e2, float offset) {
    // Rounding prevents precision errors of bilinear filtering:
    vec2 texCoord = float(SMAA_AREATEX_MAX_DISTANCE) * round(4.0 * vec2(e1, e2)) + dist;

    // We do a scale and bias for mapping to texel space:
    texCoord = SMAA_AREATEX_PIXEL_SIZE * texCoord + (0.5 * SMAA_AREATEX_PIXEL_SIZE);

    // Move to proper place, according to the subpixel offset:
    texCoord.y += SMAA_AREATEX_SUBTEX_SIZE * offset;

    return texture2D(areaTex, texCoord, 0.0).rg;
}

vec4 SMAABlendingWeightCalculationPS(vec2 texCoord, vec2 pixCoord, vec4 offset[3], sampler2D edgesTex, sampler2D areaTex, sampler2D searchTex, ivec4 subsampleIndices) {
    vec4 weights = vec4(0.0, 0.0, 0.0, 0.0);

    vec2 e = texture2D(edgesTex, texCoord).rg;

    if (e.g > 0.0) { // Edge at north
        vec2 d;

        // Find the distance to the left:
        vec2 coords;
        coords.x = SMAASearchXLeft(edgesTex, searchTex, offset[0].xy, offset[2].x );
        coords.y = offset[1].y; // offset[1].y = texCoord.y - 0.25 * uTexSizeInv.y (@CROSSING_OFFSET)
        d.x = coords.x;

        // Now fetch the left crossing edges, two at a time using bilinear
        // filtering. Sampling at -0.25 (see @CROSSING_OFFSET) enables to
        // discern what value each edge has:
        float e1 = texture2D(edgesTex, coords, 0.0).r;

        // Find the distance to the right:
        coords.x = SMAASearchXRight(edgesTex, searchTex, offset[0].zw, offset[2].y);
        d.y = coords.x;

        // We want the distances to be in pixel units (doing this here allow to
        // better interleave arithmetic and memory accesses):
        d = d / uTexSizeInv.x - pixCoord.x;

        // SMAAArea below needs a sqrt, as the areas texture is compressed
        // quadratically:
        vec2 sqrt_d = sqrt(abs(d));

        // Fetch the right crossing edges:
        coords.y -= 1.0 * uTexSizeInv.y; // WebGL port note: Added
        float e2 = SMAASampleLevelZeroOffset(edgesTex, coords, ivec2(1, 0)).r;

        // Ok, we know how this pattern looks like, now it is time for getting
        // the actual area:
        weights.rg = SMAAArea(areaTex, sqrt_d, e1, e2, float(subsampleIndices.y));
    }

    if (e.r > 0.0) { // Edge at west
        vec2 d;

        // Find the distance to the top:
        vec2 coords;

        coords.y = SMAASearchYUp(edgesTex, searchTex, offset[1].xy, offset[2].z );
        coords.x = offset[0].x; // offset[1].x = texCoord.x - 0.25 * uTexSizeInv.x;
        d.x = coords.y;

        // Fetch the top crossing edges:
        float e1 = texture2D(edgesTex, coords, 0.0).g;

        // Find the distance to the bottom:
        coords.y = SMAASearchYDown(edgesTex, searchTex, offset[1].zw, offset[2].w);
        d.y = coords.y;

        // We want the distances to be in pixel units:
        d = d / uTexSizeInv.y - pixCoord.y;

        // SMAAArea below needs a sqrt, as the areas texture is compressed
        // quadratically:
        vec2 sqrt_d = sqrt(abs(d));

        // Fetch the bottom crossing edges:
        coords.y -= 1.0 * uTexSizeInv.y; // WebGL port note: Added
        float e2 = SMAASampleLevelZeroOffset(edgesTex, coords, ivec2(0, 1)).g;

        // Get the area for this direction:
        weights.ba = SMAAArea(areaTex, sqrt_d, e1, e2, float(subsampleIndices.x));
    }

    return weights;
}

void main() {
    gl_FragColor = SMAABlendingWeightCalculationPS(vUv, vPixCoord, vOffset, tEdges, tArea, tSearch, ivec4(0.0));
}
`,NJe=`
precision highp float;

attribute vec2 aPosition;
uniform vec2 uQuadScale;

uniform vec2 uTexSizeInv;
uniform vec4 uViewport;

varying vec2 vUv;
varying vec4 vOffset[3];

void SMAAEdgeDetectionVS(vec2 texCoord) {
    vOffset[0] = texCoord.xyxy + uTexSizeInv.xyxy * vec4(-1.0, 0.0, 0.0, 1.0); // WebGL port note: Changed sign in W component
    vOffset[1] = texCoord.xyxy + uTexSizeInv.xyxy * vec4(1.0, 0.0, 0.0, -1.0); // WebGL port note: Changed sign in W component
    vOffset[2] = texCoord.xyxy + uTexSizeInv.xyxy * vec4(-2.0, 0.0, 0.0, 2.0); // WebGL port note: Changed sign in W component
}

void main() {
    vec2 scale = uViewport.zw * uTexSizeInv;
    vec2 shift = uViewport.xy * uTexSizeInv;
    vUv = (aPosition + 1.0) * 0.5 * scale + shift;
    SMAAEdgeDetectionVS(vUv);
    vec2 position = aPosition * uQuadScale - vec2(1.0, 1.0) + uQuadScale;
    gl_Position = vec4(position, 0.0, 1.0);
}
`,BJe=`
precision highp float;
precision highp int;
precision highp sampler2D;

uniform sampler2D tColor;
uniform vec2 uTexSizeInv;

varying vec2 vUv;
varying vec4 vOffset[3];

vec4 SMAAColorEdgeDetectionPS(vec2 texcoord, vec4 offset[3], sampler2D colorTex) {
    vec2 threshold = vec2(dEdgeThreshold, dEdgeThreshold);

    // Calculate color deltas:
    vec4 delta;
    vec3 C = texture2D(colorTex, texcoord).rgb;

    vec3 Cleft = texture2D(colorTex, offset[0].xy).rgb;
    vec3 t = abs(C - Cleft);
    delta.x = max(max(t.r, t.g), t.b);

    vec3 Ctop = texture2D(colorTex, offset[0].zw).rgb;
    t = abs(C - Ctop);
    delta.y = max(max(t.r, t.g), t.b);

    // We do the usual threshold:
    vec2 edges = step(threshold, delta.xy);

    // Then discard if there is no edge:
    if (dot(edges, vec2(1.0, 1.0 )) == 0.0)
        discard;

    // Calculate right and bottom deltas:
    vec3 Cright = texture2D(colorTex, offset[1].xy).rgb;
    t = abs( C - Cright );
    delta.z = max(max(t.r, t.g), t.b);

    vec3 Cbottom  = texture2D(colorTex, offset[1].zw).rgb;
    t = abs(C - Cbottom);
    delta.w = max(max(t.r, t.g), t.b);

    // Calculate the maximum delta in the direct neighborhood:
    float maxDelta = max(max(max(delta.x, delta.y), delta.z), delta.w );

    // Calculate left-left and top-top deltas:
    vec3 Cleftleft  = texture2D(colorTex, offset[2].xy).rgb;
    t = abs( C - Cleftleft );
    delta.z = max(max(t.r, t.g), t.b);

    vec3 Ctoptop = texture2D(colorTex, offset[2].zw).rgb;
    t = abs(C - Ctoptop);
    delta.w = max(max(t.r, t.g), t.b);

    // Calculate the final maximum delta:
    maxDelta = max(max(maxDelta, delta.z), delta.w);

    // Local contrast adaptation in action:
    edges.xy *= step(0.5 * maxDelta, delta.xy);

    return vec4(edges, 0.0, 0.0);
}

void main() {
    gl_FragColor = SMAAColorEdgeDetectionPS(vUv, vOffset, tColor);
}
`,UJe={edgeThreshold:I.Numeric(.1,{min:.05,max:.15,step:.01}),maxSearchSteps:I.Numeric(16,{min:0,max:32,step:1})},jJe=function(){function e(t,r){if(this.webgl=t,this._supported=!1,typeof HTMLImageElement>"u"){kr&&console.log('Missing "HTMLImageElement" required for "SMAA"');return}var n=r.getWidth(),i=r.getHeight();this.edgesTarget=t.createRenderTarget(n,i,!1,"uint8","linear"),this.weightsTarget=t.createRenderTarget(n,i,!1,"uint8","linear"),this.edgesRenderable=HJe(t,r),this.weightsRenderable=$Je(t,this.edgesTarget.texture),this.blendRenderable=YJe(t,r,this.weightsTarget.texture),this._supported=!0}return Object.defineProperty(e.prototype,"supported",{get:function(){return this._supported},enumerable:!1,configurable:!0}),e.prototype.updateState=function(t){var r=this.webgl,n=r.gl,i=r.state;i.enable(n.SCISSOR_TEST),i.disable(n.BLEND),i.disable(n.DEPTH_TEST),i.depthMask(!1);var a=t.x,o=t.y,s=t.width,u=t.height;n.viewport(a,o,s,u),n.scissor(a,o,s,u),i.clearColor(0,0,0,1),n.clear(n.COLOR_BUFFER_BIT),F.update(this.edgesRenderable.values.uViewport,Xi.toVec4(this.edgesRenderable.values.uViewport.ref.value,t)),F.update(this.weightsRenderable.values.uViewport,Xi.toVec4(this.weightsRenderable.values.uViewport.ref.value,t)),F.update(this.blendRenderable.values.uViewport,Xi.toVec4(this.blendRenderable.values.uViewport.ref.value,t))},e.prototype.setSize=function(t,r){var n=this.edgesTarget.getWidth(),i=this.edgesTarget.getHeight();(t!==n||r!==i)&&(this.edgesTarget.setSize(t,r),this.weightsTarget.setSize(t,r),F.update(this.edgesRenderable.values.uTexSizeInv,He.set(this.edgesRenderable.values.uTexSizeInv.ref.value,1/t,1/r)),F.update(this.weightsRenderable.values.uTexSizeInv,He.set(this.weightsRenderable.values.uTexSizeInv.ref.value,1/t,1/r)),F.update(this.blendRenderable.values.uTexSizeInv,He.set(this.blendRenderable.values.uTexSizeInv.ref.value,1/t,1/r)))},e.prototype.update=function(t,r){var n=!1;this.edgesRenderable.values.tColor.ref.value!==t&&(F.update(this.edgesRenderable.values.tColor,t),n=!0),this.edgesRenderable.values.dEdgeThreshold.ref.value!==r.edgeThreshold&&(F.update(this.edgesRenderable.values.dEdgeThreshold,r.edgeThreshold),n=!0),n&&this.edgesRenderable.update(),this.weightsRenderable.values.dMaxSearchSteps.ref.value!==r.maxSearchSteps&&(F.update(this.weightsRenderable.values.dMaxSearchSteps,r.maxSearchSteps),this.weightsRenderable.update()),this.blendRenderable.values.tColor.ref.value!==t&&(F.update(this.blendRenderable.values.tColor,t),this.blendRenderable.update())},e.prototype.render=function(t,r){this.edgesTarget.bind(),this.updateState(t),this.edgesRenderable.render(),this.weightsTarget.bind(),this.updateState(t),this.weightsRenderable.render(),r?r.bind():this.webgl.unbindFramebuffer(),this.updateState(t),this.blendRenderable.render()},e}(),zJe=E(E({},_a),{tColor:ur("texture","rgba","ubyte","linear"),uTexSizeInv:Ge("v2"),uViewport:Ge("v4"),dEdgeThreshold:Qt("number")}),VJe=Ln("smaa-edges",NJe,BJe);function HJe(e,t){var r=t.getWidth(),n=t.getHeight(),i=E(E({},wa),{tColor:F.create(t),uTexSizeInv:F.create(He.create(1/r,1/n)),uViewport:F.create(Ar()),dEdgeThreshold:F.create(.1)}),a=E({},zJe),o=Ji(e,"triangles",VJe,a,i);return Zi(o,i)}var GJe=E(E({},_a),{tEdges:ur("texture","rgba","ubyte","linear"),tArea:ur("texture","rgb","ubyte","linear"),tSearch:ur("texture","rgba","ubyte","nearest"),uTexSizeInv:Ge("v2"),uViewport:Ge("v4"),dMaxSearchSteps:Qt("number")}),qJe=Ln("smaa-weights",LJe,FJe);function $Je(e,t){var r=t.getWidth(),n=t.getHeight(),i=_D(e.gl,e.extensions,"image-uint8","rgb","ubyte","linear"),a=_D(e.gl,e.extensions,"image-uint8","rgba","ubyte","nearest"),o=E(E({},wa),{tEdges:F.create(t),tArea:F.create(i),tSearch:F.create(a),uTexSizeInv:F.create(He.create(1/r,1/n)),uViewport:F.create(Ar()),dMaxSearchSteps:F.create(8)});iz(KJe(),o.tArea,i),iz(QJe(),o.tSearch,a);var s=E({},GJe),u=Ji(e,"triangles",qJe,s,o);return Zi(u,o)}var WJe=E(E({},_a),{tColor:ur("texture","rgba","ubyte","linear"),tWeights:ur("texture","rgba","ubyte","linear"),uTexSizeInv:Ge("v2"),uViewport:Ge("v4")}),XJe=Ln("smaa-blend",kJe,OJe);function YJe(e,t,r){var n=t.getWidth(),i=t.getHeight(),a=E(E({},wa),{tColor:F.create(t),tWeights:F.create(r),uTexSizeInv:F.create(He.create(1/n,1/i)),uViewport:F.create(Ar())}),o=E({},WJe),s=Ji(e,"triangles",XJe,o,a);return Zi(s,a)}function KJe(){return"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAKAAAAIwCAIAAACOVPcQAACBeklEQVR42u39W4xlWXrnh/3WWvuciIzMrKxrV8/0rWbY0+SQFKcb4owIkSIFCjY9AC1BT/LYBozRi+EX+cV+8IMsYAaCwRcBwjzMiw2jAWtgwC8WR5Q8mDFHZLNHTarZGrLJJllt1W2qKrsumZWZcTvn7L3W54e1vrXX3vuciLPPORFR1XE2EomorB0nVuz//r71re/y/1eMvb4Cb3N11xV/PP/2v4UBAwJG/7H8urx6/25/Gf8O5hypMQ0EEEQwAqLfoN/Z+97f/SW+/NvcgQk4sGBJK6H7N4PFVL+K+e0N11yNfkKvwUdwdlUAXPHHL38oa15f/i/46Ih6SuMSPmLAYAwyRKn7dfMGH97jaMFBYCJUgotIC2YAdu+LyW9vvubxAP8kAL8H/koAuOKP3+q6+xGnd5kdYCeECnGIJViwGJMAkQKfDvB3WZxjLKGh8VSCCzhwEWBpMc5/kBbjawT4HnwJfhr+pPBIu7uu+OOTo9vsmtQcniMBGkKFd4jDWMSCRUpLjJYNJkM+IRzQ+PQvIeAMTrBS2LEiaiR9b/5PuT6Ap/AcfAFO4Y3dA3DFH7/VS+M8k4baEAQfMI4QfbVDDGIRg7GKaIY52qAjTAgTvGBAPGIIghOCYAUrGFNgzA7Q3QhgCwfwAnwe5vDejgG44o/fbm1C5ZlYQvQDARPAIQGxCWBM+wWl37ZQESb4gImexGMDouhGLx1Cst0Saa4b4AqO4Hk4gxo+3DHAV/nx27p3JziPM2pVgoiia5MdEzCGULprIN7gEEeQ5IQxEBBBQnxhsDb5auGmAAYcHMA9eAAz8PBol8/xij9+C4Djlim4gJjWcwZBhCBgMIIYxGAVIkH3ZtcBuLdtRFMWsPGoY9rN+HoBji9VBYdwD2ZQg4cnO7OSq/z4rU5KKdwVbFAjNojCQzTlCLPFSxtamwh2jMUcEgg2Wm/6XgErIBhBckQtGN3CzbVacERgCnfgLswhnvqf7QyAq/z4rRZm1YglYE3affGITaZsdIe2FmMIpnOCap25I6jt2kCwCW0D1uAD9sZctNGXcQIHCkINDQgc78aCr+zjtw3BU/ijdpw3zhCwcaONwBvdeS2YZKkJNJsMPf2JKEvC28RXxxI0ASJyzQCjCEQrO4Q7sFArEzjZhaFc4cdv+/JFdKULM4px0DfUBI2hIsy06BqLhGTQEVdbfAIZXYMPesq6VoCHICzUyjwInO4Y411//LYLs6TDa9wvg2CC2rElgAnpTBziThxaL22MYhzfkghz6GAs2VHbbdM91VZu1MEEpupMMwKyVTb5ij9+u4VJG/5EgEMMmFF01cFai3isRbKbzb+YaU/MQbAm2XSMoUPAmvZzbuKYRIFApbtlrfFuUGd6vq2hXNnH78ZLh/iFhsQG3T4D1ib7k5CC6vY0DCbtrohgLEIClXiGtl10zc0CnEGIhhatLBva7NP58Tvw0qE8yWhARLQ8h4+AhQSP+I4F5xoU+VilGRJs6wnS7ruti/4KvAY/CfdgqjsMy4pf8fodQO8/gnuX3f/3xi3om1/h7THr+co3x93PP9+FBUfbNUjcjEmhcrkT+8K7ml7V10Jo05mpIEFy1NmCJWx9SIKKt+EjAL4Ez8EBVOB6havuT/rByPvHXK+9zUcfcbb254+9fydJknYnRr1oGfdaiAgpxu1Rx/Rek8KISftx3L+DfsLWAANn8Hvw0/AFeAGO9DFV3c6D+CcWbL8Dj9e7f+T1k8AZv/d7+PXWM/Z+VvdCrIvuAKO09RpEEQJM0Ci6+B4xhTWr4cZNOvhktabw0ta0rSJmqz3Yw5/AKXwenod7cAhTmBSPKf6JBdvH8IP17h95pXqw50/+BFnj88fev4NchyaK47OPhhtI8RFSvAfDSNh0Ck0p2gLxGkib5NJj/JWCr90EWQJvwBzO4AHcgztwAFN1evHPUVGwfXON+0debT1YeGON9Yy9/63X+OguiwmhIhQhD7l4sMqlG3D86Suc3qWZ4rWjI1X7u0Ytw6x3rIMeIOPDprfe2XzNgyj6PahhBjO4C3e6puDgXrdg+/5l948vF3bqwZetZ+z9Rx9zdIY5pInPK4Nk0t+l52xdK2B45Qd87nM8fsD5EfUhIcJcERw4RdqqH7Yde5V7m1vhNmtedkz6EDzUMF/2jJYWbC+4fzzA/Y+/8PPH3j9dcBAPIRP8JLXd5BpAu03aziOL3VVHZzz3CXWDPWd+SH2AnxIqQoTZpo9Ckc6HIrFbAbzNmlcg8Ag8NFDDAhbJvTBZXbC94P7t68EXfv6o+21gUtPETU7bbkLxvNKRFG2+KXzvtObonPP4rBvsgmaKj404DlshFole1Glfh02fE7bYR7dZ82oTewIBGn1Md6CG6YUF26X376oevOLzx95vhUmgblI6LBZwTCDY7vMq0op5WVXgsObOXJ+1x3qaBl9j1FeLxbhU9w1F+Wiba6s1X/TBz1LnUfuYDi4r2C69f1f14BWfP+p+W2GFKuC9phcELMYRRLur9DEZTUdEH+iEqWdaM7X4WOoPGI+ZYD2+wcQ+y+ioHUZ9dTDbArzxmi/bJI9BND0Ynd6lBdve/butBw8+f/T9D3ABa3AG8W3VPX4hBin+bj8dMMmSpp5pg7fJ6xrBFE2WQQEWnV8Qg3FbAWzYfM1rREEnmvkN2o1+acG2d/9u68GDzx91v3mAjb1zkpqT21OipPKO0b9TO5W0nTdOmAQm0TObts3aBKgwARtoPDiCT0gHgwnbArzxmtcLc08HgF1asN0C4Ms/fvD5I+7PhfqyXE/b7RbbrGyRQRT9ARZcwAUmgdoz0ehJ9Fn7QAhUjhDAQSw0bV3T3WbNa59jzmiP6GsWbGXDX2ytjy8+f9T97fiBPq9YeLdBmyuizZHaqXITnXiMUEEVcJ7K4j3BFPurtB4bixW8wTpweL8DC95szWMOqucFYGsWbGU7p3TxxxefP+r+oTVktxY0v5hbq3KiOKYnY8ddJVSBxuMMVffNbxwIOERShst73HZ78DZrHpmJmH3K6sGz0fe3UUj0eyRrSCGTTc+rjVNoGzNSv05srAxUBh8IhqChiQgVNIIBH3AVPnrsnXQZbLTm8ammv8eVXn/vWpaTem5IXRlt+U/LA21zhSb9cye6jcOfCnOwhIAYXAMVTUNV0QhVha9xjgA27ODJbLbmitt3tRN80lqG6N/khgot4ZVlOyO4WNg3OIMzhIZQpUEHieg2im6F91hB3I2tubql6BYNN9Hj5S7G0G2tahslBWKDnOiIvuAEDzakDQKDNFQT6gbn8E2y4BBubM230YIpBnDbMa+y3dx0n1S0BtuG62lCCXwcY0F72T1VRR3t2ONcsmDjbmzNt9RFs2LO2hQNyb022JisaI8rAWuw4HI3FuAIhZdOGIcdjLJvvObqlpqvWTJnnQbyi/1M9O8UxWhBs//H42I0q1Yb/XPGONzcmm+ri172mHKvZBpHkJaNJz6v9jxqiklDj3U4CA2ugpAaYMWqNXsdXbmJNd9egCnJEsphXNM+MnK3m0FCJ5S1kmJpa3DgPVbnQnPGWIDspW9ozbcO4K/9LkfaQO2KHuqlfFXSbdNzcEcwoqNEFE9zcIXu9/6n/ym/BC/C3aJLzEKPuYVlbFnfhZ8kcWxV3dbv4bKl28566wD+8C53aw49lTABp9PWbsB+knfc/Li3eVizf5vv/xmvnPKg5ihwKEwlrcHqucuVcVOxEv8aH37E3ZqpZypUulrHEtIWKUr+txHg+ojZDGlwnqmkGlzcVi1dLiNSJiHjfbRNOPwKpx9TVdTn3K05DBx4psIk4Ei8aCkJahRgffk4YnEXe07T4H2RR1u27E6wfQsBDofUgjFUFnwC2AiVtA+05J2zpiDK2Oa0c5fmAecN1iJzmpqFZxqYBCYhFTCsUNEmUnIcZ6aEA5rQVhEywG6w7HSW02XfOoBlQmjwulOFQAg66SvJblrTEX1YtJ3uG15T/BH1OfOQeuR8g/c0gdpT5fx2SKbs9EfHTKdM8A1GaJRHLVIwhcGyydZsbifAFVKl5EMKNU2Hryo+06BeTgqnxzYjThVySDikbtJPieco75lYfKAJOMEZBTjoITuWHXXZVhcUDIS2hpiXHV9Ku4u44bN5OYLDOkJo8w+xJSMbhBRHEdEs9JZUCkQrPMAvaHyLkxgkEHxiNkx/x2YB0mGsQ8EUWj/stW5YLhtS5SMu+/YBbNPDCkGTUybN8krRLBGPlZkVOA0j+a1+rkyQKWGaPHPLZOkJhioQYnVZ2hS3zVxMtgC46KuRwbJNd9nV2PHgb36F194ecf/Yeu2vAFe5nm/bRBFrnY4BauE8ERmZRFUn0k8hbftiVYSKMEme2dJCJSCGYAlNqh87bXOPdUkGy24P6d1ll21MBqqx48Fvv8ZHH8HZFY7j/uAq1xMJUFqCSUlJPmNbIiNsmwuMs/q9CMtsZsFO6SprzCS1Z7QL8xCQClEelpjTduDMsmWD8S1PT152BtvmIGvUeDA/yRn83u/x0/4qxoPHjx+PXY9pqX9bgMvh/Nz9kpP4pOe1/fYf3axUiMdHLlPpZCNjgtNFAhcHEDxTumNONhHrBduW+vOyY++70WWnPXj98eA4kOt/mj/5E05l9+O4o8ePx67HFqyC+qSSnyselqjZGaVK2TadbFLPWAQ4NBhHqDCCV7OTpo34AlSSylPtIdd2AJZlyzYQrDJ5lcWGNceD80CunPLGGzsfD+7wRb95NevJI5docQ3tgCyr5bGnyaPRlmwNsFELViOOx9loebGNq2moDOKpHLVP5al2cymWHbkfzGXL7kfRl44H9wZy33tvt+PB/Xnf93e+nh5ZlU18wCiRUa9m7kib9LYuOk+hudQNbxwm0AQqbfloimaB2lM5fChex+ylMwuTbfmXQtmWlenZljbdXTLuOxjI/fDDHY4Hjx8/Hrse0zXfPFxbUN1kKqSCCSk50m0Ajtx3ub9XHBKHXESb8iO6E+qGytF4nO0OG3SXzbJlhxBnKtKyl0NwybjvYCD30aMdjgePHz8eu56SVTBbgxJMliQ3Oauwg0QHxXE2Ez/EIReLdQj42Gzb4CLS0YJD9xUx7bsi0vJi5mUbW1QzL0h0PFk17rtiIPfJk52MB48fPx67npJJwyrBa2RCCQRTbGZSPCxTPOiND4G2pYyOQ4h4jINIJh5wFU1NFZt+IsZ59LSnDqBjZ2awbOku+yInunLcd8VA7rNnOxkPHj9+PGY9B0MWJJNozOJmlglvDMXDEozdhQWbgs/U6oBanGzLrdSNNnZFjOkmbi5bNt1lX7JLLhn3vXAg9/h4y/Hg8ePHI9dzQMEkWCgdRfYykYKnkP7D4rIujsujaKPBsB54vE2TS00ccvFY/Tth7JXeq1hz+qgVy04sAJawTsvOknHfCwdyT062HA8eP348Zj0vdoXF4pilKa2BROed+9fyw9rWRXeTFXESMOanvDZfJuJaSXouQdMdDJZtekZcLLvEeK04d8m474UDuaenW44Hjx8/Xns9YYqZpszGWB3AN/4VHw+k7WSFtJ3Qicuqb/NlVmgXWsxh570xg2UwxUw3WfO6B5nOuO8aA7lnZxuPB48fPx6znm1i4bsfcbaptF3zNT78eFPtwi1OaCNOqp1x3zUGcs/PN++AGD1+fMXrSVm2baTtPhPahbPhA71wIHd2bXzRa69nG+3CraTtPivahV/55tXWg8fyRY/9AdsY8VbSdp8V7cKrrgdfM//z6ILQFtJ2nxHtwmuoB4/kf74+gLeRtvvMaBdeSz34+vifx0YG20jbfTa0C6+tHrwe//NmOG0L8EbSdp8R7cLrrQe/996O+ai3ujQOskpTNULa7jOjXXj99eCd8lHvoFiwsbTdZ0a78PrrwTvlo966pLuRtB2fFe3Cm6oHP9kNH/W2FryxtN1nTLvwRurBO+Kj3pWXHidtx2dFu/Bm68Fb81HvykuPlrb7LGkX3mw9eGs+6h1Y8MbSdjegXcguQLjmevDpTQLMxtJ2N6NdyBZu9AbrwVvwUW+LbteULUpCdqm0HTelXbhNPe8G68Gb8lFvVfYfSNuxvrTdTWoXbozAzdaDZzfkorOj1oxVxlIMlpSIlpLrt8D4hrQL17z+c3h6hU/wv4Q/utps4+bm+6P/hIcf0JwQ5oQGPBL0eKPTYEXTW+eL/2DKn73J9BTXYANG57hz1cEMviVf/4tf5b/6C5pTQkMIWoAq7hTpOJjtAM4pxKu5vg5vXeUrtI09/Mo/5H+4z+Mp5xULh7cEm2QbRP2tFIKR7WM3fPf/jZ3SWCqLM2l4NxID5zB72HQXv3jj/8mLR5xXNA5v8EbFQEz7PpRfl1+MB/hlAN65qgDn3wTgH13hK7T59bmP+NIx1SHHU84nLOITt3iVz8mNO+lPrjGAnBFqmioNn1mTyk1ta47R6d4MrX7tjrnjYUpdUbv2rVr6YpVfsGG58AG8Ah9eyUN8CX4WfgV+G8LVWPDGb+Zd4cU584CtqSbMKxauxTg+dyn/LkVgA+IR8KHtejeFKRtTmLLpxN6mYVLjYxwXf5x2VofiZcp/lwKk4wGOpYDnoIZPdg/AAbwMfx0+ge9dgZvYjuqKe4HnGnykYo5TvJbG0Vj12JagRhwKa44H95ShkZa5RyLGGdfYvG7aw1TsF6iapPAS29mNS3NmsTQZCmgTzFwgL3upCTgtBTRwvGMAKrgLn4evwin8+afJRcff+8izUGUM63GOOuAs3tJkw7J4kyoNreqrpO6cYLQeFUd7TTpr5YOTLc9RUUogUOVJQ1GYJaFLAW0oTmKyYS46ZooP4S4EON3xQ5zC8/CX4CnM4c1PE8ApexpoYuzqlP3d4S3OJP8ZDK7cKWNaTlqmgDiiHwl1YsE41w1zT4iRTm3DBqxvOUsbMKKDa/EHxagtnta072ejc3DOIh5ojvh8l3tk1JF/AV6FU6jh3U8HwEazLgdCLYSQ+MYiAI2ltomkzttUb0gGHdSUUgsIYjTzLG3mObX4FBRaYtpDVNZrih9TgTeYOBxsEnN1gOCTM8Bsw/ieMc75w9kuAT6A+/AiHGvN/+Gn4KRkiuzpNNDYhDGFndWRpE6SVfm8U5bxnSgVV2jrg6JCKmneqey8VMFgq2+AM/i4L4RUbfSi27lNXZ7R7W9RTcq/q9fk4Xw3AMQd4I5ifAZz8FcVtm9SAom/dyN4lczJQW/kC42ZrHgcCoIf1oVMKkVItmMBi9cOeNHGLqOZk+QqQmrbc5YmYgxELUUN35z2iohstgfLIFmcMV7s4CFmI74L9+EFmGsi+tGnAOD4Yk9gIpo01Y4cA43BWGygMdr4YZekG3OBIUXXNukvJS8tqa06e+lSDCtnqqMFu6hWHXCF+WaYt64m9QBmNxi7Ioy7D+fa1yHw+FMAcPt7SysFLtoG4PXAk7JOA3aAxBRqUiAdU9Yp5lK3HLSRFtOim0sa8euEt08xvKjYjzeJ2GU7YawexrnKI9tmobInjFXCewpwriY9+RR4aaezFhMhGCppKwom0ChrgFlKzyPKkGlTW1YQrE9HJqu8hKGgMc6hVi5QRq0PZxNfrYNgE64utmRv6KKHRpxf6VDUaOvNP5jCEx5q185My/7RKz69UQu2im5k4/eownpxZxNLwiZ1AZTO2ZjWjkU9uaB2HFn6Q3u0JcsSx/qV9hTEApRzeBLDJQXxYmTnq7bdLa3+uqFrxLJ5w1TehnNHx5ECvCh2g2c3hHH5YsfdaSKddztfjQ6imKFGSyFwlLzxEGPp6r5IevVjk1AMx3wMqi1NxDVjLBiPs9tbsCkIY5we5/ML22zrCScFxnNtzsr9Wcc3CnD+pYO+4VXXiDE0oc/vQQ/fDK3oPESJMYXNmJa/DuloJZkcTpcYE8lIH8Dz8DJMiynNC86Mb2lNaaqP/+L7f2fcE/yP7/Lde8xfgSOdMxvOixZf/9p3+M4hT1+F+zApxg9XfUvYjc8qX2lfOOpK2gNRtB4flpFu9FTKCp2XJRgXnX6olp1zyYjTKJSkGmLE2NjUr1bxFM4AeAAHBUFIeSLqXR+NvH/M9fOnfHzOD2vCSyQJKzfgsCh+yi/Mmc35F2fUrw7miW33W9hBD1vpuUojFphIyvg7aTeoymDkIkeW3XLHmguMzbIAJejN6B5MDrhipE2y6SoFRO/AK/AcHHZHNIfiWrEe/C6cr3f/yOvrQKB+zMM55/GQdLDsR+ifr5Fiuu+/y+M78LzOE5dsNuXC3PYvYWd8NXvphLSkJIasrlD2/HOqQ+RjcRdjKTGWYhhVUm4yxlyiGPuMsZR7sMCHUBeTuNWA7if+ifXgc/hovftHXs/DV+Fvwe+f8shzMiMcweFgBly3//vwJfg5AN4450fn1Hd1Rm1aBLu22Dy3y3H2+OqMemkbGZ4jozcDjJf6596xOLpC0eMTHbKnxLxH27uZ/bMTGs2jOaMOY4m87CfQwF0dw53oa1k80JRuz/XgS+8fX3N9Af4qPIMfzKgCp4H5TDGe9GGeFPzSsZz80SlPTxXjgwJmC45njzgt2vbQ4b4OAdUK4/vWhO8d8v6EE8fMUsfakXbPpFJeLs2ubM/qdm/la3WP91uWhxXHjoWhyRUq2iJ/+5mA73zwIIo+LoZ/SgvIRjAd1IMvvn98PfgOvAJfhhm8scAKVWDuaRaK8aQ9f7vuPDH6Bj47ZXau7rqYJ66mTDwEDU6lLbCjCK0qTXyl5mnDoeNRxanj3FJbaksTk0faXxHxLrssgPkWB9LnA/MFleXcJozzjwsUvUG0X/QCve51qkMDXp9mtcyOy3rwBfdvVJK7D6/ACSzg3RoruIq5UDeESfEmVclDxnniU82vxMLtceD0hGZWzBNPMM/jSPne2OVatiTKUpY5vY7gc0LdUAWeWM5tH+O2I66AOWw9xT2BuyRVLGdoDHUsVRXOo/c+ZdRXvFfnxWyIV4upFLCl9eAL7h8Zv0QH8Ry8pA2cHzQpGesctVA37ZtklBTgHjyvdSeKY/RZw/kJMk0Y25cSNRWSigQtlULPTw+kzuJPeYEkXjQRpoGZobYsLF79pyd1dMRHInbgFTZqNLhDqiIsTNpoex2WLcy0/X6rHcdMMQvFSd5dWA++4P7xv89deACnmr36uGlL69bRCL6BSZsS6c0TU2TKK5gtWCzgAOOwQcurqk9j8whvziZSMLcq5hbuwBEsYjopUBkqw1yYBGpLA97SRElEmx5MCInBY5vgLk94iKqSWmhIGmkJ4Bi9m4L645J68LyY4wsFYBfUg5feP/6gWWm58IEmKQM89hq7KsZNaKtP5TxxrUZZVkNmMJtjbKrGxLNEbHPJxhqy7lAmbC32ZqeF6lTaknRWcYaFpfLUBh/rwaQycCCJmW15Kstv6jRHyJFry2C1ahkkIW0LO75s61+owxK1y3XqweX9m5YLM2DPFeOjn/iiqCKJ+yKXF8t5Yl/kNsqaSCryxPq5xWTFIaP8KSW0RYxqupaUf0RcTNSSdJZGcKYdYA6kdtrtmyBckfKXwqk0pHpUHlwWaffjNRBYFPUDWa8e3Lt/o0R0CdisKDM89cX0pvRHEfM8ca4t0s2Xx4kgo91MPQJ/0c9MQYq0co8MBh7bz1fio0UUHLR4aAIOvOmoYO6kwlEVODSSTliWtOtH6sPkrtctF9ZtJ9GIerBskvhdVS5cFNv9s1BU0AbdUgdK4FG+dRnjFmDTzniRMdZO1QhzMK355vigbdkpz9P6qjUGE5J2qAcXmwJ20cZUiAD0z+pGMx6xkzJkmEf40Hr4qZfVg2XzF9YOyoV5BjzVkUJngKf8lgNYwKECEHrCNDrWZzMlflS3yBhr/InyoUgBc/lKT4pxVrrC6g1YwcceK3BmNxZcAtz3j5EIpqguh9H6wc011YN75cKDLpFDxuwkrPQmUwW4KTbj9mZTwBwLq4aQMUZbHm1rylJ46dzR0dua2n3RYCWZsiHROeywyJGR7mXKlpryyCiouY56sFkBWEnkEB/raeh/Sw4162KeuAxMQpEkzy5alMY5wamMsWKKrtW2WpEWNnReZWONKWjrdsKZarpFjqCslq773PLmEhM448Pc3+FKr1+94vv/rfw4tEcu+lKTBe4kZSdijBrykwv9vbCMPcLQTygBjzVckSLPRVGslqdunwJ4oegtFOYb4SwxNgWLCmD7T9kVjTv5YDgpo0XBmN34Z/rEHp0sgyz7lngsrm4lvMm2Mr1zNOJYJ5cuxuQxwMGJq/TP5emlb8fsQBZviK4t8hFL+zbhtlpwaRSxQRWfeETjuauPsdGxsBVdO7nmP4xvzSoT29pRl7kGqz+k26B3Oy0YNV+SXbbQas1ctC/GarskRdFpKczVAF1ZXnLcpaMuzVe6lZ2g/1ndcvOVgRG3sdUAY1bKD6achijMPdMxV4muKVorSpiDHituH7rSTs7n/4y5DhRXo4FVBN4vO/zbAcxhENzGbHCzU/98Mcx5e7a31kWjw9FCe/zNeYyQjZsWb1uc7U33pN4Mji6hCLhivqfa9Ss6xLg031AgfesA/l99m9fgvnaF9JoE6bYKmkGNK3aPbHB96w3+DnxFm4hs0drLsk7U8kf/N/CvwQNtllna0rjq61sH8L80HAuvwH1tvBy2ChqWSCaYTaGN19sTvlfzFD6n+iKTbvtayfrfe9ueWh6GJFoxLdr7V72a5ZpvHcCPDzma0wTO4EgbLyedxstO81n57LYBOBzyfsOhUKsW1J1BB5vr/tz8RyqOFylQP9Tvst2JALsC5lsH8PyQ40DV4ANzYa4dedNiKNR1s+x2wwbR7q4/4cTxqEk4LWDebfisuo36JXLiWFjOtLrlNWh3K1rRS4xvHcDNlFnNmWBBAl5SWaL3oPOfnvbr5pdjVnEaeBJSYjuLEkyLLsWhKccadmOphZkOPgVdalj2QpSmfOsADhMWE2ZBu4+EEJI4wKTAuCoC4xwQbWXBltpxbjkXJtKxxabo9e7tyhlgb6gNlSbUpMh+l/FaqzVwewGu8BW1Zx7pTpQDJUjb8tsUTW6+GDXbMn3mLbXlXJiGdggxFAoUrtPS3wE4Nk02UZG2OOzlk7fRs7i95QCLo3E0jtrjnM7SR3uS1p4qtS2nJ5OwtQVHgOvArLBFijZUV9QtSl8dAY5d0E0hM0w3HS2DpIeB6m/A1+HfhJcGUq4sOxH+x3f5+VO+Ds9rYNI7zPXOYWPrtf8bYMx6fuOAX5jzNR0PdsuON+X1f7EERxMJJoU6GkTEWBvVolVlb5lh3tKCg6Wx1IbaMDdJ+9sUCc5KC46hKGCk3IVOS4TCqdBNfUs7Kd4iXf2RjnT/LLysJy3XDcHLh/vde3x8DoGvwgsa67vBk91G5Pe/HbOe7xwym0NXbtiuuDkGO2IJDh9oQvJ4cY4vdoqLDuoH9Zl2F/ofsekn8lkuhIlhQcffUtSjytFyp++p6NiE7Rqx/lodgKVoceEp/CP4FfjrquZaTtj2AvH5K/ywpn7M34K/SsoYDAdIN448I1/0/wveW289T1/lX5xBzc8N5IaHr0XMOQdHsIkDuJFifj20pBm5jzwUv9e2FhwRsvhAbalCIuIw3bhJihY3p6nTFFIZgiSYjfTf3aXuOjmeGn4bPoGvwl+CFzTRczBIuHBEeImHc37/lGfwZR0cXzVDOvaKfNHvwe+suZ771K/y/XcBlsoN996JpBhoE2toYxOznNEOS5TJc6Id5GEXLjrWo+LEWGNpPDU4WAwsIRROu+1vM+0oW37z/MBN9kqHnSArwPfgFJ7Cq/Ai3Ie7g7ncmI09v8sjzw9mzOAEXoIHxURueaAce5V80f/DOuuZwHM8vsMb5wBzOFWM7wymTXPAEvm4vcFpZ2ut0VZRjkiP2MlmLd6DIpbGSiHOjdnUHN90hRYmhTnmvhzp1iKDNj+b7t5hi79lWGwQ+HN9RsfFMy0FXbEwhfuczKgCbyxYwBmcFhhvo/7a44v+i3XWcwDP86PzpGQYdWh7csP5dBvZ1jNzdxC8pBGuxqSW5vw40nBpj5JhMwvOzN0RWqERHMr4Lv1kWX84xLR830G3j6yqZ1a8UstTlW+qJPOZ+sZ7xZPKTJLhiNOAFd6tk+jrTH31ncLOxid8+nzRb128HhUcru/y0Wn6iT254YPC6FtVSIMoW2sk727AhvTtrWKZTvgsmckfXYZWeNRXx/3YQ2OUxLDrbHtN11IwrgXT6c8dATDwLniYwxzO4RzuQqTKSC5gAofMZ1QBK3zQ4JWobFbcvJm87FK+6JXrKahLn54m3p+McXzzYtP8VF/QpJuh1OwieElEoI1pRxPS09FBrkq2tWCU59+HdhNtTIqKm8EBrw2RTOEDpG3IKo2Y7mFdLm3ZeVjYwVw11o/oznceMve4CgMfNym/utA/d/ILMR7gpXzRy9eDsgLcgbs8O2Va1L0zzIdwGGemTBuwROHeoMShkUc7P+ISY3KH5ZZeWqO8mFTxQYeXTNuzvvK5FGPdQfuu00DwYFY9dyhctEt+OJDdnucfpmyhzUJzfsJjr29l8S0bXBfwRS9ZT26tmMIdZucch5ZboMz3Nio3nIOsYHCGoDT4kUA9MiXEp9Xsui1S8th/kbWIrMBxDGLodWUQIWcvnXy+9M23xPiSMOiRPqM+YMXkUN3gXFrZJwXGzUaMpJfyRS9ZT0lPe8TpScuRlbMHeUmlaKDoNuy62iWNTWNFYjoxFzuJs8oR+RhRx7O4SVNSXpa0ZJQ0K1LAHDQ+D9IepkMXpcsq5EVCvClBUIzDhDoyKwDw1Lc59GbTeORivugw1IcuaEOaGWdNm+Ps5fQ7/tm0DjMegq3yM3vb5j12qUId5UZD2oxDSEWOZMSqFl/W+5oynWDa/aI04tJRQ2eTXusg86SQVu/nwSYwpW6wLjlqIzwLuxGIvoAvul0PS+ZNz0/akp/pniO/8JDnGyaCkzbhl6YcqmK/69prxPqtpx2+Km9al9sjL+rwMgHw4jE/C8/HQ3m1vBuL1fldbzd8mOueVJ92syqdEY4KJjSCde3mcRw2TA6szxedn+zwhZMps0XrqEsiUjnC1hw0TELC2Ek7uAAdzcheXv1BYLagspxpzSAoZZUsIzIq35MnFQ9DOrlNB30jq3L4pkhccKUAA8/ocvN1Rzx9QyOtERs4CVsJRK/DF71kPYrxYsGsm6RMh4cps5g1DOmM54Ly1ii0Hd3Y/BMk8VWFgBVmhqrkJCPBHAolwZaWzLR9Vb7bcWdX9NyUYE+uB2BKfuaeBUcjDljbYVY4DdtsVWvzRZdWnyUzDpjNl1Du3aloAjVJTNDpcIOVVhrHFF66lLfJL1zJr9PQ2nFJSBaKoDe+sAvLufZVHVzYh7W0h/c6AAZ+7Tvj6q9j68G/cTCS/3n1vLKHZwNi+P+pS0WkZNMBMUl+LDLuiE4omZy71r3UFMwNJV+VJ/GC5ixVUkBStsT4gGKh0Gm4Oy3qvq7Lbmq24nPdDuDR9deR11XzP4vFu3TYzfnIyiSVmgizUYGqkIXNdKTY9pgb9D2Ix5t0+NHkVzCdU03suWkkVZAoCONCn0T35gAeW38de43mf97sMOpSvj4aa1KYUm58USI7Wxxes03bAZdRzk6UtbzMaCQ6IxO0dy7X+XsjoD16hpsBeGz9dfzHj+R/Hp8nCxZRqkEDTaCKCSywjiaoMJ1TITE9eg7Jqnq8HL6gDwiZb0u0V0Rr/rmvqjxKuaLCX7ZWXTvAY+uvm3z8CP7nzVpngqrJpZKwWnCUjIviYVlirlGOzPLI3SMVyp/elvBUjjDkNhrtufFFErQ8pmdSlbK16toBHlt/HV8uHMX/vEGALkV3RJREiSlopxwdMXOZPLZ+ix+kAHpMKIk8UtE1ygtquttwxNhphrIZ1IBzjGF3IIGxGcBj6q8bHJBG8T9vdsoWrTFEuebEZuVxhhClH6P5Zo89OG9fwHNjtNQTpD0TG9PJLEYqvEY6Rlxy+ZZGfL0Aj62/bnQCXp//eeM4KzfQVJbgMQbUjlMFIm6TpcfWlZje7NBSV6IsEVmumWIbjiloUzQX9OzYdo8L1wjw2PrrpimONfmfNyzKklrgnEkSzT5QWYQW40YShyzqsRmMXbvVxKtGuYyMKaU1ugenLDm5Ily4iT14fP11Mx+xJv+zZ3MvnfdFqxU3a1W/FTB4m3Qfsyc1XUcdVhDeUDZXSFHHLQj/Y5jtC7ZqM0CXGwB4bP11i3LhOvzPGygYtiUBiwQV/4wFO0majijGsafHyRLu0yG6q35cL1rOpVxr2s5cM2jJYMCdc10Aj6q/blRpWJ//+dmm5psMl0KA2+AFRx9jMe2WbC4jQxnikd4DU8TwUjRVacgdlhmr3bpddzuJ9zXqr2xnxJfzP29RexdtjDVZqzkqa6PyvcojGrfkXiJ8SEtml/nYskicv0ivlxbqjemwUjMw5evdg8fUX9nOiC/lf94Q2i7MURk9nW1MSj5j8eAyV6y5CN2S6qbnw3vdA1Iwq+XOSCl663udN3IzLnrt+us25cI1+Z83SXQUldqQq0b5XOT17bGpLd6ssN1VMPf8c+jG8L3NeCnMdF+Ra3fRa9dft39/LuZ/3vwHoHrqGmQFafmiQw6eyzMxS05K4bL9uA+SKUQzCnSDkqOGokXyJvbgJ/BHI+qvY69//4rl20NsmK2ou2dTsyIALv/91/8n3P2Aao71WFGi8KKv1fRC5+J67Q/507/E/SOshqN5TsmYIjVt+kcjAx98iz/4SaojbIV1rexE7/C29HcYD/DX4a0rBOF5VTu7omsb11L/AWcVlcVZHSsqGuXLLp9ha8I//w3Mv+T4Ew7nTBsmgapoCrNFObIcN4pf/Ob/mrvHTGqqgAupL8qWjWPS9m/31jAe4DjA+4+uCoQoT/zOzlrNd3qd4SdphFxsUvYwGWbTWtISc3wNOWH+kHBMfc6kpmpwPgHWwqaSUG2ZWWheYOGQGaHB+eQ/kn6b3pOgLV+ODSn94wDvr8Bvb70/LLuiPPEr8OGVWfDmr45PZyccEmsVXZGe1pRNX9SU5+AVQkNTIVPCHF/jGmyDC9j4R9LfWcQvfiETmgMMUCMN1uNCakkweZsowdYobiMSlnKA93u7NzTXlSfe+SVbfnPQXmg9LpYAQxpwEtONyEyaueWM4FPjjyjG3uOaFmBTWDNgBXGEiQpsaWhnAqIijB07Dlsy3fUGeP989xbWkyf+FF2SNEtT1E0f4DYYVlxFlbaSMPIRMk/3iMU5pME2SIWJvjckciebkQuIRRyhUvkHg/iUljG5kzVog5hV7vIlCuBrmlhvgPfNHQM8lCf+FEGsYbMIBC0qC9a0uuy2wLXVbLBaP5kjHokCRxapkQyzI4QEcwgYHRZBp+XEFTqXFuNVzMtjXLJgX4gAid24Hjwc4N3dtVSe+NNiwTrzH4WVUOlDobUqr1FuAgYllc8pmzoVrELRHSIW8ViPxNy4xwjBpyR55I6J220qQTZYR4guvUICJiSpr9gFFle4RcF/OMB7BRiX8sSfhpNSO3lvEZCQfLUVTKT78Ek1LRLhWN+yLyTnp8qWUZ46b6vxdRGXfHVqx3eI75YaLa4iNNiK4NOW7wPW6lhbSOF9/M9qw8e/aoB3d156qTzxp8pXx5BKAsYSTOIIiPkp68GmTq7sZtvyzBQaRLNxIZ+paozHWoLFeExIhRBrWitHCAHrCF7/thhD8JhYz84wg93QRV88wLuLY8zF8sQ36qF1J455bOlgnELfshKVxYOXKVuKx0jaj22sczTQqPqtV/XDgpswmGTWWMSDw3ssyUunLLrVPGjYRsH5ggHeHSWiV8kT33ycFSfMgkoOK8apCye0J6VW6GOYvffgU9RWsukEi2kUV2nl4dOYUzRik9p7bcA4ggdJ53LxKcEe17B1R8eqAd7dOepV8sTXf5lhejoL85hUdhDdknPtKHFhljOT+bdq0hxbm35p2nc8+Ja1Iw+tJykgp0EWuAAZYwMVwac5KzYMslhvgHdHRrxKnvhTYcfKsxTxtTETkjHO7rr3zjoV25lAQHrqpV7bTiy2aXMmUhTBnKS91jhtR3GEoF0oLnWhWNnYgtcc4N0FxlcgT7yz3TgNIKkscx9jtV1ZKpWW+Ub1tc1eOv5ucdgpx+FJy9pgbLE7xDyXb/f+hLHVGeitHOi6A7ybo3sF8sS7w7cgdk0nJaOn3hLj3uyD0Zp5pazFIUXUpuTTU18d1EPkDoX8SkmWTnVIozEdbTcZjoqxhNHf1JrSS/AcvHjZ/SMHhL/7i5z+POsTUh/8BvNfYMTA8n+yU/MlTZxSJDRStqvEuLQKWwDctMTQogUDyQRoTQG5Kc6oQRE1yV1jCA7ri7jdZyK0sYTRjCR0Hnnd+y7nHxNgTULqw+8wj0mQKxpYvhjm9uSUxg+TTy7s2GtLUGcywhXSKZN275GsqlclX90J6bRI1aouxmgL7Q0Nen5ziM80SqMIo8cSOo+8XplT/5DHNWsSUr/6lLN/QQ3rDyzLruEW5enpf7KqZoShEduuSFOV7DLX7Ye+GmXb6/hnNNqKsVXuMDFpb9Y9eH3C6NGEzuOuI3gpMH/I6e+zDiH1fXi15t3vA1czsLws0TGEtmPEJdiiFPwlwKbgLHAFk4P6ZyPdymYYHGE0dutsChQBl2JcBFlrEkY/N5bQeXQ18gjunuMfMfsBlxJSx3niO485fwO4fGD5T/+3fPQqkneWVdwnw/3bMPkW9Wbqg+iC765Zk+xcT98ibKZc2EdgHcLoF8cSOo/Oc8fS+OyEULF4g4sJqXVcmfMfsc7A8v1/yfGXmL9I6Fn5pRwZhsPv0TxFNlAfZCvG+Oohi82UC5f/2IsJo0cTOm9YrDoKhFPEUr/LBYTUNht9zelHXDqwfPCIw4owp3mOcIQcLttWXFe3VZ/j5H3cIc0G6oPbCR+6Y2xF2EC5cGUm6wKC5tGEzhsWqw5hNidUiKX5gFWE1GXh4/Qplw4sVzOmx9QxU78g3EF6wnZlEN4FzJ1QPSLEZz1KfXC7vd8ssGdIbNUYpVx4UapyFUHzJoTOo1McSkeNn1M5MDQfs4qQuhhX5vQZFw8suwWTcyYTgioISk2YdmkhehG4PkE7w51inyAGGaU+uCXADabGzJR1fn3lwkty0asIo8cROm9Vy1g0yDxxtPvHDAmpu+PKnM8Ix1wwsGw91YJqhteaWgjYBmmQiebmSpwKKzE19hx7jkzSWOm66oPbzZ8Yj6kxVSpYjVAuvLzYMCRo3oTQecOOjjgi3NQ4l9K5/hOGhNTdcWVOTrlgYNkEXINbpCkBRyqhp+LdRB3g0OU6rMfW2HPCFFMV9nSp+uB2woepdbLBuJQyaw/ZFysXrlXwHxI0b0LovEkiOpXGA1Ijagf+KUNC6rKNa9bQnLFqYNkEnMc1uJrg2u64ELPBHpkgWbmwKpJoDhMwNbbGzAp7Yg31wS2T5rGtzit59PrKhesWG550CZpHEzpv2NGRaxlNjbMqpmEIzygJqQfjypycs2pg2cS2RY9r8HUqkqdEgKTWtWTKoRvOBPDYBltja2SO0RGjy9UHtxwRjA11ujbKF+ti5cIR9eCnxUg6owidtyoU5tK4NLji5Q3HCtiyF2IqLGYsHViOXTXOYxucDqG0HyttqYAKqYo3KTY1ekyDXRAm2AWh9JmsVh/ccg9WJ2E8YjG201sPq5ULxxX8n3XLXuMInbft2mk80rRGjCGctJ8/GFdmEQ9Ug4FlE1ll1Y7jtiraqm5Fe04VV8lvSVBL8hiPrfFVd8+7QH3Qbu2ipTVi8cvSGivc9cj8yvH11YMHdNSERtuOslM97feYFOPKzGcsI4zW0YGAbTAOaxCnxdfiYUmVWslxiIblCeAYr9VYR1gM7GmoPrilunSxxeT3DN/2eBQ9H11+nk1adn6VK71+5+Jfct4/el10/7KBZfNryUunWSCPxPECk1rdOv1WVSrQmpC+Tl46YD3ikQYcpunSQgzVB2VHFhxHVGKDgMEY5GLlQnP7FMDzw7IacAWnO6sBr12u+XanW2AO0wQ8pknnFhsL7KYIqhkEPmEXFkwaN5KQphbkUmG72wgw7WSm9RiL9QT925hkjiVIIhphFS9HKI6/8QAjlpXqg9W2C0apyaVDwKQwrwLY3j6ADR13ZyUNByQXHQu6RY09Hu6zMqXRaNZGS/KEJs0cJEe9VH1QdvBSJv9h09eiRmy0V2uJcqHcShcdvbSNg5fxkenkVprXM9rDVnX24/y9MVtncvbKY706anNl3ASll9a43UiacVquXGhvq4s2FP62NGKfQLIQYu9q1WmdMfmUrDGt8eDS0cXozH/fjmUH6Jruvm50hBDSaEU/2Ru2LEN/dl006TSc/g7tfJERxGMsgDUEr104pfWH9lQaN+M4KWQjwZbVc2rZVNHsyHal23wZtIs2JJqtIc/WLXXRFCpJkfE9jvWlfFbsNQ9pP5ZBS0zKh4R0aMFj1IjTcTnvi0Zz2rt7NdvQb2mgbju1plsH8MmbnEk7KbK0b+wC2iy3aX3szW8xeZvDwET6hWZYwqTXSSG+wMETKum0Dq/q+x62gt2ua2ppAo309TRk9TPazfV3qL9H8z7uhGqGqxNVg/FKx0HBl9OVUORn8Q8Jx9gFttGQUDr3tzcXX9xGgN0EpzN9mdZ3GATtPhL+CjxFDmkeEU6x56kqZRusLzALXVqkCN7zMEcqwjmywDQ6OhyUe0Xao1Qpyncrg6wKp9XfWDsaZplElvQ/b3sdweeghorwBDlHzgk1JmMc/wiERICVy2VJFdMjFuLQSp3S0W3+sngt2njwNgLssFGVQdJ0tu0KH4ky1LW4yrbkuaA6Iy9oz/qEMMXMMDWyIHhsAyFZc2peV9hc7kiKvfULxCl9iddfRK1f8kk9qvbdOoBtOg7ZkOZ5MsGrSHsokgLXUp9y88smniwWyuFSIRVmjplga3yD8Uij5QS1ZiM4U3Qw5QlSm2bXjFe6jzzBFtpg+/YBbLAWG7OPynNjlCw65fukGNdkJRf7yM1fOxVzbxOJVocFoYIaGwH22mIQkrvu1E2nGuebxIgW9U9TSiukPGU+Lt++c3DJPKhyhEEbXCQLUpae2exiKy6tMPe9mDRBFCEMTWrtwxN8qvuGnt6MoihKWS5NSyBhbH8StXoAz8PLOrRgLtOT/+4vcu+7vDLnqNvztOq7fmd8sMmY9Xzn1zj8Dq8+XVdu2Nv0IIySgEdQo3xVHps3Q5i3fLFsV4aiqzAiBhbgMDEd1uh8qZZ+lwhjkgokkOIv4xNJmyncdfUUzgB4oFMBtiu71Xumpz/P+cfUP+SlwFExwWW62r7b+LSPxqxn/gvMZ5z9C16t15UbNlq+jbGJtco7p8wbYlL4alSyfWdeuu0j7JA3JFNuVAwtst7F7FhWBbPFNKIUORndWtLraFLmMu7KFVDDOzqkeaiN33YAW/r76wR4XDN/yN1z7hejPau06EddkS/6XThfcz1fI/4K736fO48vlxt2PXJYFaeUkFS8U15XE3428xdtn2kc8GQlf1vkIaNRRnOMvLTWrZbElEHeLWi1o0dlKPAh1MVgbbVquPJ5+Cr8LU5/H/+I2QlHIU2ClXM9G8v7Rr7oc/hozfUUgsPnb3D+I+7WF8kNO92GY0SNvuxiE+2Bt8prVJTkzE64sfOstxuwfxUUoyk8VjcTlsqe2qITSFoSj6Epd4KsT6BZOWmtgE3hBfir8IzZDwgV4ZTZvD8VvPHERo8v+vL1DASHTz/i9OlKueHDjK5Rnx/JB1Vb1ioXdBra16dmt7dgik10yA/FwJSVY6XjA3oy4SqM2frqDPPSRMex9qs3XQtoWxMj7/Er8GWYsXgjaVz4OYumP2+9kbxvny/6kvWsEBw+fcb5bInc8APdhpOSs01tEqIkoiZjbAqKMruLbJYddHuHFRIyJcbdEdbl2sVLaySygunutBg96Y2/JjKRCdyHV+AEFtTvIpbKIXOamknYSiB6KV/0JetZITgcjjk5ZdaskBtWO86UF0ap6ozGXJk2WNiRUlCPFir66lzdm/SLSuK7EUdPz8f1z29Skq6F1fXg8+5UVR6bszncP4Tn4KUkkdJ8UFCY1zR1i8RmL/qQL3rlei4THG7OODlnKko4oI01kd3CaM08Ia18kC3GNoVaO9iDh+hWxSyTXFABXoau7Q6q9OxYg/OVEMw6jdbtSrJ9cBcewGmaZmg+bvkUnUUaGr+ZfnMH45Ivevl61hMcXsxYLFTu1hTm2zViCp7u0o5l+2PSUh9bDj6FgYypufBDhqK2+oXkiuHFHR3zfj+9PtA8oR0xnqX8qn+sx3bFODSbbF0X8EUvWQ8jBIcjo5bRmLOljDNtcqNtOe756h3l0VhKa9hDd2l1eqmsnh0MNMT/Cqnx6BInumhLT8luljzQ53RiJeA/0dxe5NK0o2fA1+GLXr6eNQWHNUOJssQaTRlGpLHKL9fD+IrQzTOMZS9fNQD4AnRNVxvTdjC+fJdcDDWQcyB00B0t9BDwTxXgaAfzDZ/DBXzRnfWMFRwuNqocOmX6OKNkY63h5n/fFcB28McVHqnXZVI27K0i4rDLNE9lDKV/rT+udVbD8dFFu2GGZ8mOt0kAXcoX3ZkIWVtw+MNf5NjR2FbivROHmhV1/pj2egv/fMGIOWTIWrV3Av8N9imV9IWml36H6cUjqEWNv9aNc+veb2sH46PRaHSuMBxvtW+twxctq0z+QsHhux8Q7rCY4Ct8lqsx7c6Sy0dl5T89rIeEuZKoVctIk1hNpfavER6yyH1Vvm3MbsUHy4ab4hWr/OZPcsRBphnaV65/ZcdYPNNwsjN/djlf9NqCw9U5ExCPcdhKxUgLSmfROpLp4WSUr8ojdwbncbvCf+a/YzRaEc6QOvXcGO256TXc5Lab9POvB+AWY7PigWYjzhifbovuunzRawsO24ZqQQAqguBtmpmPB7ysXJfyDDaV/aPGillgz1MdQg4u5MYaEtBNNHFjkRlSpd65lp4hd2AVPTfbV7FGpyIOfmNc/XVsPfg7vzaS/3nkvLL593ANLvMuRMGpQIhiF7kUEW9QDpAUbTWYBcbp4WpacHHY1aacqQyjGZS9HI3yCBT9kUZJhVOD+zUDvEH9ddR11fzPcTDQ5TlgB0KwqdXSavk9BC0pKp0WmcuowSw07VXmXC5guzSa4p0UvRw2lbDiYUx0ExJJRzWzi6Gm8cnEkfXXsdcG/M/jAJa0+bmCgdmQ9CYlNlSYZOKixmRsgiFxkrmW4l3KdFKv1DM8tk6WxPYJZhUUzcd8Kdtgrw/gkfXXDT7+avmfVak32qhtkg6NVdUS5wgkru1YzIkSduTW1FDwVWV3JQVJVuieTc0y4iDpFwc7/BvSalvKdQM8sv662cevz/+8sQVnjVAT0W2wLllw1JiMhJRxgDjCjLQsOzSFSgZqx7lAW1JW0e03yAD3asC+GD3NbQhbe+mN5GXH1F83KDOM4n/e5JIuH4NpdQARrFPBVptUNcjj4cVMcFSRTE2NpR1LEYbYMmfWpXgP9KejaPsLUhuvLCsVXznAG9dfx9SR1ud/3hZdCLHb1GMdPqRJgqDmm76mHbvOXDtiO2QPUcKo/TWkQ0i2JFXpBoo7vij1i1Lp3ADAo+qvG3V0rM//vFnnTE4hxd5Ka/Cor5YEdsLVJyKtDgVoHgtW11pWSjolPNMnrlrVj9Fv2Qn60twMwKPqr+N/wvr8z5tZcDsDrv06tkqyzESM85Ycv6XBWA2birlNCXrI6VbD2lx2L0vQO0QVTVVLH4SE67fgsfVXv8n7sz7/85Z7cMtbE6f088wSaR4kCkCm10s6pKbJhfqiUNGLq+0gLWC6eUAZFPnLjwqtKd8EwGvWX59t7iPW4X/eAN1svgRVSY990YZg06BD1ohLMtyFTI4pKTJsS9xREq9EOaPWiO2gpms7397x6nQJkbh+Fz2q/rqRROX6/M8bJrqlVW4l6JEptKeUFuMYUbtCQ7CIttpGc6MY93x1r1vgAnRXvY5cvwWPqb9uWQm+lP95QxdNMeWhOq1x0Db55C7GcUv2ZUuN6n8iKzsvOxibC//Yfs9Na8r2Rlz02vXXDT57FP/zJi66/EJSmsJKa8QxnoqW3VLQ+jZVUtJwJ8PNX1NQCwfNgdhhHD9on7PdRdrdGPF28rJr1F+3LBdeyv+8yYfLoMYet1vX4upNAjVvwOUWnlNXJXlkzk5Il6kqeoiL0C07qno+/CYBXq/+utlnsz7/Mzvy0tmI4zm4ag23PRN3t/CWryoUVJGm+5+K8RJ0V8Hc88/XHUX/HfiAq7t+BH+x6v8t438enWmdJwFA6ZINriLGKv/95f8lT9/FnyA1NMVEvQyaXuu+gz36f/DD73E4pwqpLcvm/o0Vle78n//+L/NPvoefp1pTJye6e4A/D082FERa5/opeH9zpvh13cNm19/4v/LDe5xMWTi8I0Ta0qKlK27AS/v3/r+/x/2GO9K2c7kVMonDpq7//jc5PKCxeNPpFVzaRr01wF8C4Pu76hXuX18H4LduTr79guuFD3n5BHfI+ZRFhY8w29TYhbbLi/bvBdqKE4fUgg1pBKnV3FEaCWOWyA+m3WpORZr/j+9TKJtW8yBTF2/ZEODI9/QavHkVdGFp/Pjn4Q+u5hXapsP5sOH+OXXA1LiKuqJxiMNbhTkbdJTCy4llEt6NnqRT4dhg1V3nbdrm6dYMecA1yTOL4PWTE9L5VzPFlLBCvlG58AhehnN4uHsAYinyJ+AZ/NkVvELbfOBUuOO5syBIEtiqHU1k9XeISX5bsimrkUUhnGDxourN8SgUsCZVtKyGbyGzHXdjOhsAvOAswSRyIBddRdEZWP6GZhNK/yjwew9ehBo+3jEADu7Ay2n8mDc+TS7awUHg0OMzR0LABhqLD4hJEh/BEGyBdGlSJoXYXtr+3HS4ijzVpgi0paWXtdruGTknXBz+11qT1Q2inxaTzQCO46P3lfLpyS4fou2PH/PupwZgCxNhGlj4IvUuWEsTkqMWm6i4xCSMc9N1RDQoCVcuGItJ/MRWefais+3synowi/dESgJjkilnWnBTGvRWmaw8oR15257t7CHmCf8HOn7cwI8+NQBXMBEmAa8PMRemrNCEhLGEhDQKcGZWS319BX9PFBEwGTbRBhLbDcaV3drFcDqk5kCTd2JF1Wp0HraqBx8U0wwBTnbpCadwBA/gTH/CDrcCs93LV8E0YlmmcyQRQnjBa8JESmGUfIjK/7fkaDJpmD2QptFNVJU1bbtIAjjWQizepOKptRjbzR9Kag6xZmMLLjHOtcLT3Tx9o/0EcTT1XN3E45u24AiwEypDJXihKjQxjLprEwcmRKclaDNZCVqr/V8mYWyFADbusiY5hvgFoU2vio49RgJLn5OsReRFN6tabeetiiy0V7KFHT3HyZLx491u95sn4K1QQSPKM9hNT0wMVvAWbzDSVdrKw4zRjZMyJIHkfq1VAVCDl/bUhNKlGq0zGr05+YAceXVPCttVk0oqjVwMPt+BBefx4yPtGVkUsqY3CHDPiCM5ngupUwCdbkpd8kbPrCWHhkmtIKLEetF2499eS1jZlIPGYnlcPXeM2KD9vLS0bW3ktYNqUllpKLn5ZrsxlIzxvDu5eHxzGLctkZLEY4PgSOg2IUVVcUONzUDBEpRaMoXNmUc0tFZrTZquiLyKxrSm3DvIW9Fil+AkhXu5PhEPx9mUNwqypDvZWdKlhIJQY7vn2OsnmBeOWnYZ0m1iwbbw1U60by5om47iHRV6fOgzjMf/DAZrlP40Z7syxpLK0lJ0gqaAK1c2KQKu7tabTXkLFz0sCftuwX++MyNeNn68k5Buq23YQhUh0SNTJa1ioQ0p4nUG2y0XilF1JqODqdImloPS4Bp111DEWT0jJjVv95uX9BBV7eB3bUWcu0acSVM23YZdd8R8UbQUxJ9wdu3oMuhdt929ME+mh6JXJ8di2RxbTi6TbrDquqV4aUKR2iwT6aZbyOwEXN3DUsWr8Hn4EhwNyHuXHh7/pdaUjtR7vnDh/d8c9xD/s5f501eQ1+CuDiCvGhk1AN/4Tf74RfxPwD3toLarR0zNtsnPzmS64KIRk861dMWCU8ArasG9T9H0ZBpsDGnjtAOM2+/LuIb2iIUGXNgl5ZmKD/Tw8TlaAuihaFP5yrw18v4x1898zIdP+DDAX1bM3GAMvPgRP/cJn3zCW013nrhHkrITyvYuwOUkcHuKlRSW5C6rzIdY4ppnF7J8aAJbQepgbJYBjCY9usGXDKQxq7RZfh9eg5d1UHMVATRaD/4BHK93/1iAgYZ/+jqPn8Dn4UExmWrpa3+ZOK6MvM3bjwfzxNWA2dhs8+51XHSPJiaAhGSpWevEs5xHLXcEGFXYiCONySH3fPWq93JIsBiSWvWyc3CAN+EcXoT7rCSANloPPoa31rt/5PUA/gp8Q/jDD3hyrjzlR8VkanfOvB1XPubt17vzxAfdSVbD1pzAnfgyF3ycadOTOTXhpEUoLC1HZyNGW3dtmjeXgr2r56JNmRwdNNWaQVBddd6rh4MhviEB9EFRD/7RGvePvCbwAL4Mx/D6M541hHO4D3e7g6PafdcZVw689z7NGTwo5om7A8sPhccT6qKcl9NJl9aM/9kX+e59Hh1yPqGuCCZxuITcsmNaJ5F7d0q6J3H48TO1/+M57085q2icdu2U+W36Ldllz9Agiv4YGljoEN908EzvDOrBF98/vtJwCC/BF2AG75xxEmjmMIcjxbjoaxqOK3/4hPOZzhMPBpYPG44CM0dTVm1LjLtUWWVz1Bcf8tEx0zs8O2A2YVHRxKYOiy/aOVoAaMu0i7ubu43njjmd4ibMHU1sIDHaQNKrZND/FZYdk54oCXetjq7E7IVl9eAL7t+oHnwXXtLx44czzoRFHBztYVwtH1d+NOMkupZ5MTM+gUmq90X+Bh9zjRlmaQ+m7YMqUL/veemcecAtOJ0yq1JnVlN27di2E0+Klp1tAJ4KRw1eMI7aJjsO3R8kPSI3fUFXnIOfdQe86sIIVtWDL7h//Ok6vj8vwDk08NEcI8zz7OhBy+WwalzZeZ4+0XniRfst9pAJqQHDGLzVQ2pheZnnv1OWhwO43/AgcvAEXEVVpa4db9sGvNK8wjaENHkfFQ4Ci5i7dqnQlPoLQrHXZDvO3BIXZbJOBrOaEbML6sFL798I4FhKihjHMsPjBUZYCMFr6nvaArxqXPn4lCa+cHfSa2cP27g3Z3ziYTRrcbQNGLQmGF3F3cBdzzzX7AILx0IB9rbwn9kx2G1FW3Inic+ZLIsVvKR8Zwfj0l1fkqo8LWY1M3IX14OX3r9RKTIO+d9XzAI8qRPGPn/4NC2n6o4rN8XJ82TOIvuVA8zLKUHRFgBCetlDZlqR1gLKjS39xoE7Bt8UvA6BxuEDjU3tFsEijgA+615tmZkXKqiEENrh41iLDDZNq4pKTWR3LZfnos81LOuNa15cD956vLMsJd1rqYp51gDUQqMYm2XsxnUhD2jg1DM7SeuJxxgrmpfISSXVIJIS5qJJSvJPEQ49DQTVIbYWJ9QWa/E2+c/oPK1drmC7WSfJRNKBO5Yjvcp7Gc3dmmI/Xh1kDTEuiSnWqQf37h+fTMhGnDf6dsS8SQfQWlqqwXXGlc/PEZ/SC5mtzIV0nAshlQdM/LvUtYutrEZ/Y+EAFtq1k28zQhOwLr1AIeANzhF8t9qzTdZf2qRKO6MWE9ohBYwibbOmrFtNmg3mcS+tB28xv2uKd/agYCvOP+GkSc+0lr7RXzyufL7QbkUpjLjEWFLqOIkAGu2B0tNlO9Eau2W1qcOUvVRgKzypKIQZ5KI3q0MLzqTNRYqiZOqmtqloIRlmkBHVpHmRYV6/HixbO6UC47KOFJnoMrVyr7wYz+SlW6GUaghYbY1I6kkxA2W1fSJokUdSh2LQ1GAimRGm0MT+uu57H5l7QgOWxERpO9moLRPgTtquWCfFlGlIjQaRly9odmzMOWY+IBO5tB4sW/0+VWGUh32qYk79EidWKrjWuiLpiVNGFWFRJVktyeXWmbgBBzVl8anPuXyNJlBJOlKLTgAbi/EYHVHxWiDaVR06GnHQNpJcWcK2jJtiCfG2sEHLzuI66sGrMK47nPIInPnu799935aOK2cvmvubrE38ZzZjrELCmXM2hM7UcpXD2oC3+ECVp7xtIuxptJ0jUr3sBmBS47TVxlvJ1Sqb/E0uLdvLj0lLr29ypdd/eMX3f6lrxGlKwKQxEGvw0qHbkbwrF3uHKwVENbIV2wZ13kNEF6zD+x24aLNMfDTCbDPnEikZFyTNttxWBXDaBuM8KtI2rmaMdUY7cXcUPstqTGvBGSrFWIpNMfbdea990bvAOC1YX0qbc6smDS1mPxSJoW4fwEXvjMmhlijDRq6qale6aJEuFGoppYDoBELQzLBuh/mZNx7jkinv0EtnUp50lO9hbNK57lZaMAWuWR5Yo9/kYwcYI0t4gWM47Umnl3YmpeBPqSyNp3K7s2DSAS/39KRuEN2bS4xvowV3dFRMx/VFcp2Yp8w2nTO9hCXtHG1kF1L4KlrJr2wKfyq77R7MKpFKzWlY9UkhYxyHWW6nBWPaudvEAl3CGcNpSXPZ6R9BbBtIl6cHL3gIBi+42CYXqCx1gfGWe7Ap0h3luyXdt1MKy4YUT9xSF01G16YEdWsouW9mgDHd3veyA97H+Ya47ZmEbqMY72oPztCGvK0onL44AvgC49saZKkWRz4veWljE1FHjbRJaWv6ZKKtl875h4CziFCZhG5rx7tefsl0aRT1bMHZjm8dwL/6u7wCRysaQblQoG5yAQN5zpatMNY/+yf8z+GLcH/Qn0iX2W2oEfXP4GvwQHuIL9AYGnaO3zqAX6946nkgqZNnUhx43DIdQtMFeOPrgy/y3Yd85HlJWwjLFkU3kFwq28xPnuPhMWeS+tDLV9Otllq7pQCf3uXJDN9wFDiUTgefHaiYbdfi3b3u8+iY6TnzhgehI1LTe8lcd7s1wJSzKbahCRxKKztTLXstGAiu3a6rPuQs5pk9TWAan5f0BZmGf7Ylxzzk/A7PAs4QPPPAHeFQ2hbFHszlgZuKZsJcUmbDC40sEU403cEjczstOEypa+YxevL4QBC8oRYqWdK6b7sK25tfE+oDZgtOQ2Jg8T41HGcBE6fTWHn4JtHcu9S7uYgU5KSCkl/mcnq+5/YBXOEr6lCUCwOTOM1taOI8mSxx1NsCXBEmLKbMAg5MkwbLmpBaFOPrNSlO2HnLiEqW3tHEwd8AeiQLmn+2gxjC3k6AxREqvKcJbTEzlpLiw4rNZK6oJdidbMMGX9FULKr0AkW+2qDEPBNNm5QAt2Ik2nftNWHetubosHLo2nG4vQA7GkcVCgVCgaDixHqo9UUn1A6OshapaNR/LPRYFV8siT1cCtJE0k/3WtaNSuUZYKPnsVIW0xXWnMUxq5+En4Kvw/MqQmVXnAXj9Z+9zM98zM/Agy7F/qqj2Nh67b8HjFnPP3iBn/tkpdzwEJX/whIcQUXOaikeliCRGUk7tiwF0rItwMEhjkZ309hikFoRAmLTpEXWuHS6y+am/KB/fM50aLEhGnSMwkpxzOov4H0AvgovwJ1iGzDLtJn/9BU+fAINfwUe6FHSLhu83viV/+/HrOePX+STT2B9uWGbrMHHLldRBlhS/CJQmcRxJFqZica01XixAZsYiH1uolZxLrR/SgxVIJjkpQP4PE9sE59LKLr7kltSBogS5tyszzH8Fvw8/AS8rNOg0xUS9fIaHwb+6et8Q/gyvKRjf5OusOzGx8evA/BP4IP11uN/grca5O0lcsPLJ5YjwI4QkJBOHa0WdMZYGxPbh2W2nR9v3WxEWqgp/G3+6VZbRLSAAZ3BhdhAaUL33VUSw9yjEsvbaQ9u4A/gGXwZXoEHOuU1GSj2chf+Mo+f8IcfcAxfIKVmyunRbYQVnoevwgfw3TXXcw++xNuP4fhyueEUNttEduRVaDttddoP0eSxLe2LENk6itYxlrxBNBYrNNKSQmeaLcm9c8UsaB5WyO6675yyQIAWSDpBVoA/gxmcwEvwoDv0m58UE7gHn+fJOa8/Ywan8EKRfjsopF83eCglX/Sfr7OeaRoQfvt1CGvIDccH5BCvw1sWIzRGC/66t0VTcLZQZtm6PlAasbOJ9iwWtUo7biktTSIPxnR24jxP1ZKaqq+2RcXM9OrBAm/AAs7hDJ5bNmGb+KIfwCs8a3jnjBrOFeMjHSCdbKr+2uOLfnOd9eiA8Hvvwwq54VbP2OqwkB48Ytc4YEOiH2vTXqodabfWEOzso4qxdbqD5L6tbtNPECqbhnA708DZH4QOJUXqScmUlks7Ot6FBuZw3n2mEbaUX7kDzxHOOQk8nKWMzAzu6ZZ8sOFw4RK+6PcuXo9tB4SbMz58ApfKDXf3szjNIIbGpD5TKTRxGkEMLjLl+K3wlWXBsCUxIDU+jbOiysESqAy1MGUJpXgwbTWzNOVEziIXZrJ+VIztl1PUBxTSo0dwn2bOmfDRPD3TRTGlfbCJvO9KvuhL1hMHhB9wPuPRLGHcdOWG2xc0U+5bQtAJT0nRTewXL1pgk2+rZAdeWmz3jxAqfNQQdzTlbF8uJ5ecEIWvTkevAHpwz7w78QujlD/Lr491bD8/1vhM2yrUQRrWXNQY4fGilfctMWYjL72UL/qS9eiA8EmN88nbNdour+PBbbAjOjIa4iBhfFg6rxeKdEGcL6p3EWR1Qq2Qkhs2DrnkRnmN9tG2EAqmgPw6hoL7Oza7B+3SCrR9tRftko+Lsf2F/mkTndN2LmzuMcKTuj/mX2+4Va3ki16+nnJY+S7MefpkidxwnV+4wkXH8TKnX0tsYzYp29DOOoSW1nf7nTh2akYiWmcJOuTidSaqESrTYpwjJJNVGQr+rLI7WsqerHW6Kp/oM2pKuV7T1QY9gjqlZp41/WfKpl56FV/0kvXQFRyeQ83xaTu5E8p5dNP3dUF34ihyI3GSpeCsywSh22ZJdWto9winhqifb7VRvgktxp13vyjrS0EjvrRfZ62uyqddSWaWYlwTPAtJZ2oZ3j/Sgi/mi+6vpzesfAcWNA0n8xVyw90GVFGuZjTXEQy+6GfLGLMLL523f5E0OmxVjDoOuRiH91RKU+vtoCtH7TgmvBLvtFXWLW15H9GTdVw8ow4IlRLeHECN9ym1e9K0I+Cbnhgv4Yu+aD2HaQJ80XDqOzSGAV4+4yCqBxrsJAX6ZTIoX36QnvzhhzzMfFW2dZVLOJfo0zbce5OvwXMFaZ81mOnlTVXpDZsQNuoYWveketKb5+6JOOsgX+NTm7H49fUTlx+WLuWL7qxnOFh4BxpmJx0p2gDzA/BUARuS6phR+pUsY7MMboAHx5xNsSVfVZcYSwqCKrqon7zM+8ecCkeS4nm3rINuaWvVNnMRI1IRpxTqx8PZUZ0Br/UEduo3B3hNvmgZfs9gQPj8vIOxd2kndir3awvJ6BLvoUuOfFWNYB0LR1OQJoUySKb9IlOBx74q1+ADC2G6rOdmFdJcD8BkfualA+BdjOOzP9uUhGUEX/TwhZsUduwRr8wNuXKurCixLBgpQI0mDbJr9dIqUuV+92ngkJZ7xduCk2yZKbfWrH1VBiTg9VdzsgRjW3CVXCvAwDd+c1z9dWw9+B+8MJL/eY15ZQ/HqvTwVdsZn5WQsgRRnMaWaecu3jFvMBEmgg+FJFZsnSl0zjB9OqPYaBD7qmoVyImFvzi41usesV0julaAR9dfR15Xzv9sEruRDyk1nb+QaLU67T885GTls6YgcY+UiMa25M/pwGrbCfzkvR3e0jjtuaFtnwuagHTSb5y7boBH119HXhvwP487jJLsLJ4XnUkHX5sLbS61dpiAXRoZSCrFJ+EjpeU3puVfitngYNo6PJrAigKktmwjyQdZpfq30mmtulaAx9Zfx15Xzv+cyeuiBFUs9zq8Kq+XB9a4PVvph3GV4E3y8HENJrN55H1X2p8VyqSKwVusJDKzXOZzplWdzBUFK9e+B4+uv468xvI/b5xtSAkBHQaPvtqWzllVvEOxPbuiE6+j2pvjcKsbvI7txnRErgfH7LdXqjq0IokKzga14GzQ23SSbCQvO6r+Or7SMIr/efOkkqSdMnj9mBx2DRsiY29Uj6+qK9ZrssCKaptR6HKURdwUYeUWA2kPzVKQO8ku2nU3Anhs/XWkBx3F/7wJtCTTTIKftthue1ty9xvNYLY/zo5KSbIuKbXpbEdSyeRyYdAIwKY2neyoc3+k1XUaufYga3T9daMUx/r8z1s10ITknIO0kuoMt+TB8jK0lpayqqjsJ2qtXAYwBU932zinimgmd6mTRDnQfr88q36NAI+tv24E8Pr8zxtasBqx0+xHH9HhlrwsxxNUfKOHQaZBITNf0uccj8GXiVmXAuPEAKSdN/4GLHhs/XWj92dN/uetNuBMnVR+XWDc25JLjo5Mg5IZIq226tmCsip2zZliL213YrTlL2hcFjpCduyim3M7/eB16q/blQsv5X/esDRbtJeabLIosWy3ycavwLhtxdWzbMmHiBTiVjJo6lCLjXZsi7p9PEPnsq6X6wd4bP11i0rD5fzPm/0A6brrIsllenZs0lCJlU4abakR59enZKrKe3BZihbTxlyZ2zl1+g0wvgmA166/bhwDrcn/7Ddz0eWZuJvfSESug6NzZsox3Z04FIxz0mUjMwVOOVTq1CQ0AhdbBGVdjG/CgsfUX7esJl3K/7ytWHRv683praW/8iDOCqWLLhpljDY1ZpzK75QiaZoOTpLKl60auHS/97oBXrv+umU9+FL+5+NtLFgjqVLCdbmj7pY5zPCPLOHNCwXGOcLquOhi8CmCWvbcuO73XmMUPab+ug3A6/A/78Bwe0bcS2+tgHn4J5pyS2WbOck0F51Vq3LcjhLvZ67p1ABbaL2H67bg78BfjKi/jr3+T/ABV3ilLmNXTI2SpvxWBtt6/Z//D0z/FXaGbSBgylzlsEGp+5//xrd4/ae4d8DUUjlslfIYS3t06HZpvfQtvv0N7AHWqtjP2pW08QD/FLy//da38vo8PNlKHf5y37Dxdfe/oj4kVIgFq3koLReSR76W/bx//n9k8jonZxzWTANVwEniDsg87sOSd/z7//PvMp3jQiptGVWFX2caezzAXwfgtzYUvbr0iozs32c3Uge7varH+CNE6cvEYmzbPZ9hMaYDdjK4V2iecf6EcEbdUDVUARda2KzO/JtCuDbNQB/iTeL0EG1JSO1jbXS+nLxtPMDPw1fh5+EPrgSEKE/8Gry5A73ui87AmxwdatyMEBCPNOCSKUeRZ2P6Myb5MRvgCHmA9ywsMifU+AYXcB6Xa5GibUC5TSyerxyh0j6QgLVpdyhfArRTTLqQjwe4HOD9s92D4Ap54odXAPBWLAwB02igG5Kkc+piN4lvODIFGAZgT+EO4Si1s7fjSR7vcQETUkRm9O+MXyo9OYhfe4xt9STQ2pcZRLayCV90b4D3jR0DYAfyxJ+eywg2IL7NTMXna7S/RpQ63JhWEM8U41ZyQGjwsVS0QBrEKLu8xwZsbi4wLcCT+OGidPIOCe1PiSc9Qt+go+vYqB7cG+B9d8cAD+WJPz0Am2gxXgU9IneOqDpAAXOsOltVuMzpdakJXrdPCzXiNVUpCeOos5cxnpQT39G+XVLhs1osQVvJKPZyNq8HDwd4d7pNDuWJPxVX7MSzqUDU6gfadKiNlUFTzLeFHHDlzO4kpa7aiKhBPGKwOqxsBAmYkOIpipyXcQSPlRTf+Tii0U3EJGaZsDER2qoB3h2hu0qe+NNwUooYU8y5mILbJe6OuX+2FTKy7bieTDAemaQyQ0CPthljSWO+xmFDIYiESjM5xKd6Ik5lvLq5GrQ3aCMLvmCA9wowLuWJb9xF59hVVP6O0CrBi3ZjZSNOvRy+I6klNVRJYRBaEzdN+imiUXQ8iVF8fsp+W4JXw7WISW7fDh7lptWkCwZ4d7QTXyBPfJMYK7SijjFppGnlIVJBJBYj7eUwtiP1IBXGI1XCsjNpbjENVpSAJ2hq2LTywEly3hUYazt31J8w2+aiLx3g3fohXixPfOMYm6zCGs9LVo9MoW3MCJE7R5u/WsOIjrqBoHUO0bJE9vxBpbhsd3+Nb4/vtPCZ4oZYCitNeYuC/8UDvDvy0qvkiW/cgqNqRyzqSZa/s0mqNGjtKOoTm14zZpUauiQgVfqtQiZjq7Q27JNaSK5ExRcrGCXO1FJYh6jR6CFqK7bZdQZ4t8g0rSlPfP1RdBtqaa9diqtzJkQ9duSryi2brQXbxDwbRUpFMBHjRj8+Nt7GDKgvph9okW7LX47gu0SpGnnFQ1S1lYldOsC7hYteR574ZuKs7Ei1lBsfdz7IZoxzzCVmmVqaSySzQbBVAWDek+N4jh9E/4VqZrJjPwiv9BC1XcvOWgO8275CVyBPvAtTVlDJfZkaZGU7NpqBogAj/xEHkeAuJihWYCxGN6e8+9JtSegFXF1TrhhLGP1fak3pebgPz192/8gB4d/6WT7+GdYnpH7hH/DJzzFiYPn/vjW0SgNpTNuPIZoAEZv8tlGw4+RLxy+ZjnKa5NdFoC7UaW0aduoYse6+bXg1DLg6UfRYwmhGEjqPvF75U558SANrElK/+MdpXvmqBpaXOa/MTZaa1DOcSiLaw9j0NNNst3c+63c7EKTpkvKHzu6bPbP0RkuHAVcbRY8ijP46MIbQeeT1mhA+5PV/inyDdQipf8LTvMXbwvoDy7IruDNVZKTfV4CTSRUYdybUCnGU7KUTDxLgCknqUm5aAW6/1p6eMsOYsphLzsHrE0Y/P5bQedx1F/4yPHnMB3/IOoTU9+BL8PhtjuFKBpZXnYNJxTuv+2XqolKR2UQgHhS5novuxVySJhBNRF3SoKK1XZbbXjVwWNyOjlqWJjrWJIy+P5bQedyldNScP+HZ61xKSK3jyrz+NiHG1hcOLL/+P+PDF2gOkekKGiNWKgJ+8Z/x8Iv4DdQHzcpZyF4v19I27w9/yPGDFQvmEpKtqv/TLiWMfn4sofMm9eAH8Ao0zzh7h4sJqYtxZd5/D7hkYPneDzl5idlzNHcIB0jVlQ+8ULzw/nc5/ojzl2juE0apD7LRnJxe04dMz2iOCFNtGFpTuXA5AhcTRo8mdN4kz30nVjEC4YTZQy4gpC7GlTlrePKhGsKKgeXpCYeO0MAd/GH7yKQUlXPLOasOH3FnSphjHuDvEu4gB8g66oNbtr6eMbFIA4fIBJkgayoXriw2XEDQPJrQeROAlY6aeYOcMf+IVYTU3XFlZufMHinGywaW3YLpObVBAsbjF4QJMsVUSayjk4voPsHJOQfPWDhCgDnmDl6XIRerD24HsGtw86RMHOLvVSHrKBdeVE26gKB5NKHzaIwLOmrqBWJYZDLhASG16c0Tn+CdRhWDgWXnqRZUTnPIHuMJTfLVpkoYy5CzylHVTGZMTwkGAo2HBlkQplrJX6U+uF1wZz2uwS1SQ12IqWaPuO4baZaEFBdukksJmkcTOm+YJSvoqPFzxFA/YUhIvWxcmSdPWTWwbAKVp6rxTtPFUZfKIwpzm4IoMfaYQLWgmlG5FME2gdBgm+J7J+rtS/XBbaVLsR7bpPQnpMFlo2doWaVceHk9+MkyguZNCJ1He+kuHTWyQAzNM5YSUg/GlTk9ZunAsg1qELVOhUSAK0LABIJHLKbqaEbHZLL1VA3VgqoiOKXYiS+HRyaEKgsfIqX64HYWbLRXy/qWoylIV9gudL1OWBNgBgTNmxA6b4txDT4gi3Ri7xFSLxtXpmmYnzAcWDZgY8d503LFogz5sbonDgkKcxGsWsE1OI+rcQtlgBBCSOKD1mtqYpIU8cTvBmAT0yZe+zUzeY92fYjTtGipXLhuR0ePoHk0ofNWBX+lo8Z7pAZDk8mEw5L7dVyZZoE/pTewbI6SNbiAL5xeygW4xPRuLCGbhcO4RIeTMFYHEJkYyEO9HmJfXMDEj/LaH781wHHZEtqSQ/69UnGpzH7LKIAZEDSPJnTesJTUa+rwTepI9dLJEawYV+ZkRn9g+QirD8vF8Mq0jFQ29js6kCS3E1+jZIhgPNanHdHFqFvPJLHqFwQqbIA4jhDxcNsOCCQLDomaL/dr5lyJaJU6FxPFjO3JOh3kVMcROo8u+C+jo05GjMF3P3/FuDLn5x2M04xXULPwaS6hBYki+MrMdZJSgPHlcB7nCR5bJ9Kr5ACUn9jk5kivdd8tk95SOGrtqu9lr2IhK65ZtEl7ZKrp7DrqwZfRUSN1el7+7NJxZbywOC8neNKTch5vsTEMNsoCCqHBCqIPRjIPkm0BjvFODGtto99rCl+d3wmHkW0FPdpZtC7MMcVtGFQjJLX5bdQ2+x9ypdc313uj8xlsrfuLgWXz1cRhZvJYX0iNVBRcVcmCXZs6aEf3RQF2WI/TcCbKmGU3IOoDJGDdDub0+hYckt6PlGu2BcxmhbTdj/klhccLGJMcqRjMJP1jW2ETqLSWJ/29MAoORluJ+6LPffBZbi5gqi5h6catQpmOT7/OFf5UorRpLzCqcMltBLhwd1are3kztrSzXO0LUbXRQcdLh/RdSZ+swRm819REDrtqzC4es6Gw4JCKlSnjYVpo0xeq33PrADbFLL3RuCmObVmPN+24kfa+AojDuM4umKe2QwCf6EN906HwjujaitDs5o0s1y+k3lgbT2W2i7FJdnwbLXhJUBq/9liTctSmFC/0OqUinb0QddTWamtjbHRFuWJJ6NpqZ8vO3fZJ37Db+2GkaPYLGHs7XTTdiFQJ68SkVJFVmY6McR5UycflNCsccHFaV9FNbR4NttLxw4pQ7wJd066Z0ohVbzihaxHVExd/ay04oxUKWt+AsdiQ9OUyZ2krzN19IZIwafSTFgIBnMV73ADj7V/K8u1MaY2sJp2HWm0f41tqwajEvdHWOJs510MaAqN4aoSiPCXtN2KSi46dUxHdaMquar82O1x5jqhDGvqmoE9LfxcY3zqA7/x3HA67r9ZG4O6Cuxu12/+TP+eLP+I+HErqDDCDVmBDO4larujNe7x8om2rMug0MX0rL1+IWwdwfR+p1TNTyNmVJ85ljWzbWuGv8/C7HD/izjkHNZNYlhZcUOKVzKFUxsxxN/kax+8zPWPSFKw80rJr9Tizyj3o1gEsdwgWGoxPezDdZ1TSENE1dLdNvuKL+I84nxKesZgxXVA1VA1OcL49dFlpFV5yJMhzyCmNQ+a4BqusPJ2bB+xo8V9u3x48VVIEPS/mc3DvAbXyoYr6VgDfh5do5hhHOCXMqBZUPhWYbWZECwVJljLgMUWOCB4MUuMaxGNUQDVI50TQ+S3kFgIcu2qKkNSHVoM0SHsgoZxP2d5HH8B9woOk4x5bPkKtAHucZsdykjxuIpbUrSILgrT8G7G5oCW+K0990o7E3T6AdW4TilH5kDjds+H64kS0mz24grtwlzDHBJqI8YJQExotPvoC4JBq0lEjjQkyBZ8oH2LnRsQ4Hu1QsgDTJbO8fQDnllitkxuVskoiKbRF9VwzMDvxHAdwB7mD9yCplhHFEyUWHx3WtwCbSMMTCUCcEmSGlg4gTXkHpZXWQ7kpznK3EmCHiXInqndkQjunG5kxTKEeGye7jWz9cyMR2mGiFQ15ENRBTbCp+Gh86vAyASdgmJq2MC6hoADQ3GosP0QHbnMHjyBQvQqfhy/BUbeHd5WY/G/9LK/8Ka8Jd7UFeNWEZvzPb458Dn8DGLOe3/wGL/4xP+HXlRt+M1PE2iLhR8t+lfgxsuh7AfO2AOf+owWhSZRYQbd622hbpKWKuU+XuvNzP0OseRDa+mObgDHJUSc/pKx31QdKffQ5OIJpt8GWjlgTwMc/w5MPCR/yl1XC2a2Yut54SvOtMev55Of45BOat9aWG27p2ZVORRvnEk1hqWMVUmqa7S2YtvlIpspuF1pt0syuZS2NV14mUidCSfzQzg+KqvIYCMljIx2YK2AO34fX4GWdu5xcIAb8MzTw+j/lyWM+Dw/gjs4GD6ehNgA48kX/AI7XXM/XAN4WHr+9ntywqoCakCqmKP0rmQrJJEErG2Upg1JObr01lKQy4jskWalKYfJ/EDLMpjNSHFEUAde2fltaDgmrNaWQ9+AAb8I5vKjz3L1n1LriB/BXkG/wwR9y/oRX4LlioHA4LzP2inzRx/DWmutRweFjeP3tNeSGlaE1Fde0OS11yOpmbIp2u/jF1n2RRZviJM0yBT3IZl2HWImKjQOxIyeU325b/qWyU9Moj1o07tS0G7qJDoGHg5m8yeCxMoEH8GU45tnrNM84D2l297DQ9t1YP7jki/7RmutRweEA77/HWXOh3HCxkRgldDQkAjNTMl2Iloc1qN5JfJeeTlyTRzxURTdn1Ixv2uKjs12AbdEWlBtmVdk2k7FFwj07PCZ9XAwW3dG+8xKzNFr4EnwBZpy9Qzhh3jDXebBpYcpuo4fQ44u+fD1dweEnHzI7v0xuuOALRUV8rXpFyfSTQYkhd7IHm07jpyhlkCmI0ALYqPTpUxXS+z4jgDj1Pflvmz5ecuItpIBxyTHpSTGWd9g1ApfD/bvwUhL4nT1EzqgX7cxfCcNmb3mPL/qi9SwTHJ49oj5ZLjccbTG3pRmlYi6JCG0mQrAt1+i2UXTZ2dv9IlQpN5naMYtviaXlTrFpoMsl3bOAFEa8sqPj2WCMrx3Yjx99qFwO59Aw/wgx+HlqNz8oZvA3exRDvuhL1jMQHPaOJ0+XyA3fp1OfM3qObEVdhxjvynxNMXQV4+GJyvOEFqeQBaIbbO7i63rpxCltdZShPFxkjM2FPVkn3TG+Rp9pO3l2RzFegGfxGDHIAh8SteR0C4HopXzRF61nheDw6TFN05Ebvq8M3VKKpGjjO6r7nhudTEGMtYM92HTDaR1FDMXJ1eThsbKfywyoWwrzRSXkc51flG3vIid62h29bIcFbTGhfV+faaB+ohj7dPN0C2e2lC96+XouFByen9AsunLDJZ9z7NExiUc0OuoYW6UZkIyx2YUR2z6/TiRjyKMx5GbbjLHvHuf7YmtKghf34LJfx63Yg8vrvN2zC7lY0x0tvKezo4HmGYDU+Gab6dFL+KI761lDcNifcjLrrr9LWZJctG1FfU1uwhoQE22ObjdfkSzY63CbU5hzs21WeTddH2BaL11Gi7lVdlxP1nkxqhnKhVY6knS3EPgVGg1JpN5cP/hivujOelhXcPj8HC/LyI6MkteVjlolBdMmF3a3DbsuAYhL44dxzthWSN065xxUd55Lmf0wRbOYOqH09/o9WbO2VtFdaMb4qBgtFJoT1SqoN8wPXMoXLb3p1PUEhxfnnLzGzBI0Ku7FxrKsNJj/8bn/H8fPIVOd3rfrklUB/DOeO+nkghgSPzrlPxluCMtOnDL4Yml6dK1r3vsgMxgtPOrMFUZbEUbTdIzii5beq72G4PD0DKnwjmBULUVFmy8t+k7fZ3pKc0Q4UC6jpVRqS9Umv8bxw35flZVOU1X7qkjnhZlsMbk24qQ6Hz7QcuL6sDC0iHHki96Uh2UdvmgZnjIvExy2TeJdMDZNSbdZyAHe/Yd1xsQhHiKzjh7GxQ4yqMPaywPkjMamvqrYpmO7Knad+ZQC5msCuAPWUoxrxVhrGv7a+KLXFhyONdTMrZ7ke23qiO40ZJUyzgYyX5XyL0mV7NiUzEs9mjtbMN0dERqwyAJpigad0B3/zRV7s4PIfXSu6YV/MK7+OrYe/JvfGMn/PHJe2fyUdtnFrKRNpXV0Y2559aWPt/G4BlvjTMtXlVIWCnNyA3YQBDmYIodFz41PvXPSa6rq9lWZawZ4dP115HXV/M/tnFkkrBOdzg6aP4pID+MZnTJ1SuuB6iZlyiox4HT2y3YBtkUKWooacBQUDTpjwaDt5poBHl1/HXltwP887lKKXxNUEyPqpGTyA699UqY/lt9yGdlUKra0fFWS+36iylVWrAyd7Uw0CZM0z7xKTOduznLIjG2Hx8cDPLb+OvK6Bv7n1DYci4CxUuRxrjBc0bb4vD3rN5Zz36ntLb83eVJIB8LiIzCmn6SMPjlX+yNlTjvIGjs+QzHPf60Aj62/jrzG8j9vYMFtm1VoRWCJdmw7z9N0t+c8cxZpPeK4aTRicS25QhrVtUp7U578chk4q04Wx4YoQSjFryUlpcQ1AbxZ/XVMknIU//OGl7Q6z9Zpxi0+3yFhSkjUDpnCIUhLWVX23KQ+L9vKvFKI0ZWFQgkDLvBoylrHNVmaw10zwCPrr5tlodfnf94EWnQ0lFRWy8pW9LbkLsyUVDc2NSTHGDtnD1uMtchjbCeb1mpxFP0YbcClhzdLu6lfO8Bj6q+bdT2sz/+8SZCV7VIxtt0DUn9L7r4cLYWDSXnseEpOGFuty0qbOVlS7NNzs5FOGJUqQpl2Q64/yBpZf90sxbE+//PGdZ02HSipCbmD6NItmQ4Lk5XUrGpDMkhbMm2ZVheNYV+VbUWTcv99+2NyX1VoafSuC+AN6q9bFIMv5X/eagNWXZxEa9JjlMwNWb00akGUkSoepp1/yRuuqHGbUn3UdBSTxBU6SEVklzWRUkPndVvw2PrrpjvxOvzPmwHc0hpmq82npi7GRro8dXp0KXnUQmhZbRL7NEVp1uuZmO45vuzKsHrktS3GLWXODVjw+vXXLYx4Hf7njRPd0i3aoAGX6W29GnaV5YdyDj9TFkakje7GHYzDoObfddHtOSpoi2SmzJHrB3hM/XUDDEbxP2/oosszcRlehWXUvzHv4TpBVktHqwenFo8uLVmy4DKLa5d3RtLrmrM3aMFr1183E4sewf+85VWeg1c5ag276NZrM9IJVNcmLEvDNaV62aq+14IAOGFsBt973Ra8Xv11YzXwNfmft7Jg2oS+XOyoC8/cwzi66Dhmgk38kUmP1CUiYWOX1bpD2zWXt2FCp7uq8703APAa9dfNdscR/M/bZLIyouVxqJfeWvG9Je+JVckHQ9+CI9NWxz+blX/KYYvO5n2tAP/vrlZ7+8/h9y+9qeB/Hnt967e5mevX10rALDWK//FaAT5MXdBXdP0C/BAes792c40H+AiAp1e1oH8HgH94g/Lttx1gp63op1eyoM/Bvw5/G/7xFbqJPcCXnmBiwDPb/YKO4FX4OjyCb289db2/Noqicw4i7N6TVtoz8tNwDH+8x/i6Ae7lmaQVENzJFb3Di/BFeAwz+Is9SjeQySpPqbLFlNmyz47z5a/AF+AYFvDmHqibSXTEzoT4Gc3OALaqAP4KPFUJ6n+1x+rGAM6Zd78bgJ0a8QN4GU614vxwD9e1Amy6CcskNrczLx1JIp6HE5UZD/DBHrFr2oNlgG4Odv226BodoryjGJ9q2T/AR3vQrsOCS0ctXZi3ruLlhpFDJYl4HmYtjQCP9rhdn4suySLKDt6wLcC52h8xPlcjju1fn+yhuw4LZsAGUuo2b4Fx2UwQu77uqRHXGtg92aN3tQCbFexc0uk93vhTXbct6y7MulLycoUljx8ngDMBg1tvJjAazpEmOtxlzclvj1vQf1Tx7QlPDpGpqgtdSKz/d9/hdy1vTfFHSmC9dGDZbLiezz7Ac801HirGZsWjydfZyPvHXL/Y8Mjzg8BxTZiuwKz4Eb8sBE9zznszmjvFwHKPIWUnwhqfVRcd4Ck0K6ate48m1oOfrX3/yOtvAsJ8zsPAM89sjnddmuLuDPjX9Bu/L7x7xpMzFk6nWtyQfPg278Gn4Aekz2ZgOmU9eJ37R14vwE/BL8G3aibCiWMWWDQ0ZtkPMnlcGeAu/Ag+8ZyecU5BPuy2ILD+sQqyZhAKmn7XZd+jIMTN9eBL7x95xVLSX4On8EcNlXDqmBlqS13jG4LpmGbkF/0CnOi3H8ETOIXzmnmtb0a16Tzxj1sUvQCBiXZGDtmB3KAefPH94xcUa/6vwRn80GOFyjEXFpba4A1e8KQfFF+259tx5XS4egYn8fQsLGrqGrHbztr+uByTahWuL1NUGbDpsnrwBfePPwHHIf9X4RnM4Z2ABWdxUBlqQ2PwhuDxoS0vvqB1JzS0P4h2nA/QgTrsJFn+Y3AOjs9JFC07CGWX1oNX3T/yHOzgDjwPn1PM3g9Jk9lZrMEpxnlPmBbjyo2+KFXRU52TJM/2ALcY57RUzjObbjqxVw++4P6RAOf58pcVsw9Daje3htriYrpDOonre3CudSe6bfkTEgHBHuDiyu5MCsc7BHhYDx7ePxLjqigXZsw+ijMHFhuwBmtoTPtOxOrTvYJDnC75dnUbhfwu/ZW9AgYd+peL68HD+0emKquiXHhWjJg/UrkJYzuiaL3E9aI/ytrCvAd4GcYZMCkSQxfUg3v3j8c4e90j5ZTPdvmJJGHnOCI2nHS8081X013pHuBlV1gB2MX1YNmWLHqqGN/TWmG0y6clJWthxNUl48q38Bi8vtMKyzzpFdSDhxZ5WBA5ZLt8Jv3895DduBlgbPYAj8C4B8hO68FDkoh5lydC4FiWvBOVqjYdqjiLv92t8yPDjrDaiHdUD15qkSURSGmXJwOMSxWAXYwr3zaAufJ66l+94vv3AO+vPcD7aw/w/toDvL/2AO+vPcD7aw/wHuD9tQd4f+0B3l97gPfXHuD9tQd4f+0B3l97gG8LwP8G/AL8O/A5OCq0Ys2KIdv/qOIXG/4mvFAMF16gZD+2Xvu/B8as5+8bfllWyg0zaNO5bfXj6vfhhwD86/Aq3NfRS9t9WPnhfnvCIw/CT8GLcFTMnpntdF/z9V+PWc/vWoIH+FL3Znv57PitcdGP4R/C34avw5fgRVUInCwbsn1yyA8C8zm/BH8NXoXnVE6wVPjdeCI38kX/3+Ct9dbz1pTmHFRu+Hm4O9Ch3clr99negxfwj+ER/DR8EV6B5+DuQOnTgUw5rnkY+FbNU3gNXh0o/JYTuWOvyBf9FvzX663HH/HejO8LwAl8Hl5YLTd8q7sqA3wbjuExfAFegQdwfyDoSkWY8swzEf6o4Qyewefg+cHNbqMQruSL/u/WWc+E5g7vnnEXgDmcDeSGb/F4cBcCgT+GGRzDU3hZYburAt9TEtHgbM6JoxJ+6NMzzTcf6c2bycv2+KK/f+l6LBzw5IwfqZJhA3M472pWT/ajKxnjv4AFnMEpnBTPND6s2J7qHbPAqcMK74T2mZ4VGB9uJA465It+/eL1WKhYOD7xHOkr1ajK7d0C4+ke4Hy9qXZwpgLr+Znm/uNFw8xQOSy8H9IzjUrd9+BIfenYaylf9FsXr8fBAadnPIEDna8IBcwlxnuA0/Wv6GAWPd7dDIKjMdSWueAsBj4M7TOd06qBbwDwKr7oleuxMOEcTuEZTHWvDYUO7aHqAe0Bbq+HEFRzOz7WVoTDQkVds7A4sIIxfCQdCefFRoIOF/NFL1mPab/nvOakSL/Q1aFtNpUb/nFOVX6gzyg/1nISyDfUhsokIzaBR9Kxm80s5mK+6P56il1jXic7nhQxsxSm3OwBHl4fFdLqi64nDQZvqE2at7cWAp/IVvrN6/BFL1mPhYrGMBfOi4PyjuSGf6wBBh7p/FZTghCNWGgMzlBbrNJoPJX2mW5mwZfyRffXo7OFi5pZcS4qZUrlViptrXtw+GQoyhDPS+ANjcGBNRiLCQDPZPMHuiZfdFpPSTcQwwKYdRNqpkjm7AFeeT0pJzALgo7g8YYGrMHS0iocy+YTm2vyRUvvpXCIpQ5pe666TJrcygnScUf/p0NDs/iAI/nqDHC8TmQT8x3NF91l76oDdQGwu61Z6E0ABv7uO1dbf/37Zlv+Zw/Pbh8f1s4Avur6657/+YYBvur6657/+YYBvur6657/+YYBvur6657/+aYBvuL6657/+VMA8FXWX/f8zzcN8BXXX/f8zzcNMFdbf93zP38KLPiK6697/uebtuArrr/u+Z9vGmCusP6653/+1FjwVdZf9/zPN7oHX339dc//fNMu+irrr3v+50+Bi+Zq6697/uebA/jz8Pudf9ht/fWv517J/XUzAP8C/BAeX9WCDrUpZ3/dEMBxgPcfbtTVvsYV5Yn32u03B3Ac4P3b8I+vxNBKeeL9dRMAlwO83959qGO78sT769oB7g3w/vGVYFzKE++v6wV4OMD7F7tckFkmT7y/rhHgpQO8b+4Y46XyxPvrugBeNcB7BRiX8sT767oAvmCA9woAHsoT76+rBJjLBnh3txOvkifeX1dswZcO8G6N7sXyxPvr6i340gHe3TnqVfLE++uKAb50gHcXLnrX8sR7gNdPRqwzwLu7Y/FO5Yn3AK9jXCMGeHdgxDuVJ75VAI8ljP7PAb3/RfjcZfePHBB+79dpfpH1CanN30d+mT1h9GqAxxJGM5LQeeQ1+Tb+EQJrElLb38VHQ94TRq900aMIo8cSOo+8Dp8QfsB8zpqE1NO3OI9Zrj1h9EV78PqE0WMJnUdeU6E+Jjyk/hbrEFIfeWbvId8H9oTRFwdZaxJGvziW0Hn0gqYB/wyZ0PwRlxJST+BOw9m77Amj14ii1yGM/txYQudN0qDzGe4EqfA/5GJCagsHcPaEPWH0esekSwmjRxM6b5JEcZ4ww50ilvAOFxBSx4yLW+A/YU8YvfY5+ALC6NGEzhtmyZoFZoarwBLeZxUhtY4rc3bKnjB6TKJjFUHzJoTOozF2YBpsjcyxDgzhQ1YRUse8+J4wenwmaylB82hC5w0zoRXUNXaRBmSMQUqiWSWkLsaVqc/ZE0aPTFUuJWgeTei8SfLZQeMxNaZSIzbII4aE1Nmr13P2hNHjc9E9guYNCZ032YlNwESMLcZiLQHkE4aE1BFg0yAR4z1h9AiAGRA0jyZ03tyIxWMajMPWBIsxYJCnlITU5ShiHYdZ94TR4wCmSxg9jtB5KyPGYzymAYexWEMwAPIsAdYdV6aObmNPGD0aYLoEzaMJnTc0Ygs+YDw0GAtqxBjkuP38bMRWCHn73xNGjz75P73WenCEJnhwyVe3AEe8TtKdJcYhBl97wuhNAObK66lvD/9J9NS75v17wuitAN5fe4D31x7g/bUHeH/tAd5fe4D3AO+vPcD7aw/w/toDvL/2AO+vPcD7aw/w/toDvAd4f/24ABzZ8o+KLsSLS+Pv/TqTb3P4hKlQrTGh+fbIBT0Axqznnb+L/V2mb3HkN5Mb/nEHeK7d4IcDld6lmDW/iH9E+AH1MdOw/Jlu2T1xNmY98sv4wHnD7D3uNHu54WUuOsBTbQuvBsPT/UfzNxGYzwkP8c+Yz3C+r/i6DcyRL/rZ+utRwWH5PmfvcvYEt9jLDS/bg0/B64DWKrQM8AL8FPwS9beQCe6EMKNZYJol37jBMy35otdaz0Bw2H/C2Smc7+WGB0HWDELBmOByA3r5QONo4V+DpzR/hFS4U8wMW1PXNB4TOqYz9urxRV++ntWCw/U59Ty9ebdWbrgfRS9AYKKN63ZokZVygr8GZ/gfIhZXIXPsAlNjPOLBby5c1eOLvmQ9lwkOy5x6QV1j5TYqpS05JtUgUHUp5toHGsVfn4NX4RnMCe+AxTpwmApTYxqMxwfCeJGjpXzRF61nbcHhUBPqWze9svwcHJ+S6NPscKrEjug78Dx8Lj3T8D4YxGIdxmJcwhi34fzZUr7olevZCw5vkOhoClq5zBPZAnygD/Tl9EzDh6kl3VhsHYcDEb+hCtJSvuiV69kLDm+WycrOTArHmB5/VYyP6jOVjwgGawk2zQOaTcc1L+aLXrKeveDwZqlKrw8U9Y1p66uK8dEzdYwBeUQAY7DbyYNezBfdWQ97weEtAKYQg2xJIkuveAT3dYeLGH+ShrWNwZgN0b2YL7qznr3g8JYAo5bQBziPjx7BPZ0d9RCQp4UZbnFdzBddor4XHN4KYMrB2qHFRIzzcLAHQZ5the5ovui94PCWAPefaYnxIdzRwdHCbuR4B+tbiy96Lzi8E4D7z7S0mEPd+eqO3cT53Z0Y8SV80XvB4Z0ADJi/f7X113f+7p7/+UYBvur6657/+YYBvur6657/+aYBvuL6657/+aYBvuL6657/+aYBvuL6657/+aYBvuL6657/+VMA8FXWX/f8z58OgK+y/rrnf75RgLna+uue//lTA/CV1V/3/M837aKvvv6653++UQvmauuve/7nTwfAV1N/3fM/fzr24Cuuv+75nz8FFnxl9dc9//MOr/8/glixwRuUfM4AAAAASUVORK5CYII="}function QJe(){return"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEIAAAAhCAAAAABIXyLAAAAAOElEQVRIx2NgGAWjYBSMglEwEICREYRgFBZBqDCSLA2MGPUIVQETE9iNUAqLR5gIeoQKRgwXjwAAGn4AtaFeYLEAAAAASUVORK5CYII="}var ZJe=E(E({},_a),{tDepth:ur("texture","rgba","ubyte","nearest"),uTexSize:Ge("v2"),dOrthographic:Qt("number"),uNear:Ge("f"),uFar:Ge("f"),uMaxPossibleViewZDiff:Ge("f")});function JJe(e,t){var r=E(E({},wa),{tDepth:F.create(t),uTexSize:F.create(He.create(t.getWidth(),t.getHeight())),dOrthographic:F.create(0),uNear:F.create(1),uFar:F.create(1e4),uMaxPossibleViewZDiff:F.create(.5)}),n=E({},ZJe),i=Ln("outlines",ko,_Je),a=Ji(e,"triangles",i,n,r);return Zi(a,r)}var eet=E(E({},_a),{tDepth:ur("texture","rgba","ubyte","nearest"),uSamples:Ge("v3[]"),dNSamples:Qt("number"),uProjection:Ge("m4"),uInvProjection:Ge("m4"),uBounds:Ge("v4"),uTexSize:Ge("v2"),uRadius:Ge("f"),uBias:Ge("f")});function tet(e,t){var r=E(E({},wa),{tDepth:F.create(t),uSamples:F.create([0,0,1]),dNSamples:F.create(1),uProjection:F.create(ue.identity()),uInvProjection:F.create(ue.identity()),uBounds:F.create(Ar()),uTexSize:F.create(He.create(e.gl.drawingBufferWidth,e.gl.drawingBufferHeight)),uRadius:F.create(8),uBias:F.create(.025)}),n=E({},eet),i=Ln("ssao",ko,wJe),a=Ji(e,"triangles",i,n,r);return Zi(a,r)}var ret=E(E({},_a),{tSsaoDepth:ur("texture","rgba","ubyte","nearest"),uTexSize:Ge("v2"),uKernel:Ge("f[]"),dOcclusionKernelSize:Qt("number"),uBlurDirectionX:Ge("f"),uBlurDirectionY:Ge("f"),uMaxPossibleViewZDiff:Ge("f"),uNear:Ge("f"),uFar:Ge("f"),uBounds:Ge("v4"),dOrthographic:Qt("number")});function tH(e,t,r){var n=E(E({},wa),{tSsaoDepth:F.create(t),uTexSize:F.create(He.create(t.getWidth(),t.getHeight())),uKernel:F.create([0]),dOcclusionKernelSize:F.create(1),uBlurDirectionX:F.create(r==="horizontal"?1:0),uBlurDirectionY:F.create(r==="vertical"?1:0),uMaxPossibleViewZDiff:F.create(.5),uNear:F.create(0),uFar:F.create(1e4),uBounds:F.create(Ar()),dOrthographic:F.create(0)}),i=E({},ret),a=Ln("ssao_blur",ko,EJe),o=Ji(e,"triangles",a,i,n);return Zi(o,n)}function net(e){for(var t=e/3,r=Math.floor((e+1)/2),n=[],i=0;i<r;i++)n.push(1/(Math.sqrt(2*Math.PI)*t)*Math.exp(-i*i/(2*t*t)));return n}function iet(e,t){for(var r=[],n=0;n<t;n++){var i=(n*n+2*n+1)/(t*t);i=.1+i*(1-.1),r.push(e[n][0]*i),r.push(e[n][1]*i),r.push(e[n][2]*i)}return r}var aet=E(E({},_a),{tSsaoDepth:ur("texture","rgba","ubyte","nearest"),tColor:ur("texture","rgba","ubyte","nearest"),tDepth:ur("texture","rgba","ubyte","nearest"),tOutlines:ur("texture","rgba","ubyte","nearest"),uTexSize:Ge("v2"),dOrthographic:Qt("number"),uNear:Ge("f"),uFar:Ge("f"),uFogNear:Ge("f"),uFogFar:Ge("f"),uFogColor:Ge("v3"),uTransparentBackground:Ge("b"),uMaxPossibleViewZDiff:Ge("f"),dOcclusionEnable:Qt("boolean"),dOutlineEnable:Qt("boolean"),dOutlineScale:Qt("number"),uOutlineThreshold:Ge("f")});function oet(e,t,r,n,i){var a=E(E({},wa),{tSsaoDepth:F.create(i),tColor:F.create(t),tDepth:F.create(r),tOutlines:F.create(n),uTexSize:F.create(He.create(t.getWidth(),t.getHeight())),dOrthographic:F.create(0),uNear:F.create(1),uFar:F.create(1e4),uFogNear:F.create(1e4),uFogFar:F.create(1e4),uFogColor:F.create(_.create(1,1,1)),uTransparentBackground:F.create(!1),uMaxPossibleViewZDiff:F.create(.5),dOcclusionEnable:F.create(!1),dOutlineEnable:F.create(!1),dOutlineScale:F.create(1),uOutlineThreshold:F.create(.33)}),o=E({},aet),s=Ln("postprocessing",ko,AJe),u=Ji(e,"triangles",s,o,a);return Zi(u,a)}var Dne={occlusion:I.MappedStatic("on",{on:I.Group({samples:I.Numeric(32,{min:1,max:256,step:1}),radius:I.Numeric(5,{min:0,max:10,step:.1},{description:"Final radius is 2^x."}),bias:I.Numeric(.8,{min:0,max:3,step:.1}),blurKernelSize:I.Numeric(15,{min:1,max:25,step:2})}),off:I.Group({})},{cycle:!0,description:"Darken occluded crevices with the ambient occlusion effect"}),outline:I.MappedStatic("off",{on:I.Group({scale:I.Numeric(1,{min:1,max:5,step:1}),threshold:I.Numeric(.33,{min:.01,max:1,step:.01})}),off:I.Group({})},{cycle:!0,description:"Draw outline around 3D objects"}),antialiasing:I.MappedStatic("smaa",{fxaa:I.Group(TJe),smaa:I.Group(UJe),off:I.Group({})},{options:[["fxaa","FXAA"],["smaa","SMAA"],["off","Off"]],description:"Smooth pixel edges"})},hc=function(){function e(t,r){this.webgl=t,this.ssaoScale=this.calcSsaoScale();var n=r.colorTarget,i=r.depthTexture,a=n.getWidth(),o=n.getHeight();this.nSamples=1,this.blurKernelSize=1,this.target=t.createRenderTarget(a,o,!1,"uint8","linear"),this.outlinesTarget=t.createRenderTarget(a,o,!1),this.outlinesRenderable=JJe(t,i),this.randomHemisphereVector=[];for(var s=0;s<256;s++){var u=_();u[0]=Math.random()*2-1,u[1]=Math.random()*2-1,u[2]=Math.random(),_.normalize(u,u),_.scale(u,u,Math.random()),this.randomHemisphereVector.push(u)}this.ssaoFramebuffer=t.resources.framebuffer(),this.ssaoBlurFirstPassFramebuffer=t.resources.framebuffer(),this.ssaoBlurSecondPassFramebuffer=t.resources.framebuffer();var l=Math.floor(a*this.ssaoScale),c=Math.floor(o*this.ssaoScale);this.ssaoDepthTexture=t.resources.texture("image-uint8","rgba","ubyte","nearest"),this.ssaoDepthTexture.define(l,c),this.ssaoDepthTexture.attachFramebuffer(this.ssaoFramebuffer,"color0"),this.ssaoDepthBlurProxyTexture=t.resources.texture("image-uint8","rgba","ubyte","nearest"),this.ssaoDepthBlurProxyTexture.define(l,c),this.ssaoDepthBlurProxyTexture.attachFramebuffer(this.ssaoBlurFirstPassFramebuffer,"color0"),this.ssaoDepthTexture.attachFramebuffer(this.ssaoBlurSecondPassFramebuffer,"color0"),this.ssaoRenderable=tet(t,i),this.ssaoBlurFirstPassRenderable=tH(t,this.ssaoDepthTexture,"horizontal"),this.ssaoBlurSecondPassRenderable=tH(t,this.ssaoDepthBlurProxyTexture,"vertical"),this.renderable=oet(t,n.texture,i,this.outlinesTarget.texture,this.ssaoDepthTexture)}return e.isEnabled=function(t){return t.occlusion.name==="on"||t.outline.name==="on"},e.prototype.calcSsaoScale=function(){return Math.min(1,1/this.webgl.pixelRatio)},e.prototype.setSize=function(t,r){var n=this.renderable.values.uTexSize.ref.value,i=n[0],a=n[1],o=this.calcSsaoScale();if(t!==i||r!==a||this.ssaoScale!==o){this.ssaoScale=o;var s=Math.floor(t*this.ssaoScale),u=Math.floor(r*this.ssaoScale);this.target.setSize(t,r),this.outlinesTarget.setSize(t,r),this.ssaoDepthTexture.define(s,u),this.ssaoDepthBlurProxyTexture.define(s,u),F.update(this.renderable.values.uTexSize,He.set(this.renderable.values.uTexSize.ref.value,t,r)),F.update(this.outlinesRenderable.values.uTexSize,He.set(this.outlinesRenderable.values.uTexSize.ref.value,t,r)),F.update(this.ssaoRenderable.values.uTexSize,He.set(this.ssaoRenderable.values.uTexSize.ref.value,s,u)),F.update(this.ssaoBlurFirstPassRenderable.values.uTexSize,He.set(this.ssaoBlurFirstPassRenderable.values.uTexSize.ref.value,s,u)),F.update(this.ssaoBlurSecondPassRenderable.values.uTexSize,He.set(this.ssaoBlurSecondPassRenderable.values.uTexSize.ref.value,s,u))}},e.prototype.updateState=function(t,r,n,i){var a=!1,o=!1,s=!1,u=t.state.mode==="orthographic"?1:0,l=i.outline.name==="on",c=i.occlusion.name==="on",d=ue.identity();if(ue.invert(d,t.projection),i.occlusion.name==="on"){F.update(this.ssaoRenderable.values.uProjection,t.projection),F.update(this.ssaoRenderable.values.uInvProjection,d);var f=this.renderable.values.uTexSize.ref.value,p=f[0],v=f[1],h=this.ssaoRenderable.values.uBounds,m=t.viewport,g=this.ssaoScale;if(Ar.set(h.ref.value,Math.floor(m.x*g)/(p*g),Math.floor(m.y*g)/(v*g),Math.ceil((m.x+m.width)*g)/(p*g),Math.ceil((m.y+m.height)*g)/(v*g)),F.update(h,h.ref.value),F.update(this.ssaoBlurFirstPassRenderable.values.uBounds,h.ref.value),F.update(this.ssaoBlurSecondPassRenderable.values.uBounds,h.ref.value),F.updateIfChanged(this.ssaoBlurFirstPassRenderable.values.uNear,t.near),F.updateIfChanged(this.ssaoBlurSecondPassRenderable.values.uNear,t.near),F.updateIfChanged(this.ssaoBlurFirstPassRenderable.values.uFar,t.far),F.updateIfChanged(this.ssaoBlurSecondPassRenderable.values.uFar,t.far),this.ssaoBlurFirstPassRenderable.values.dOrthographic.ref.value!==u&&(s=!0),F.updateIfChanged(this.ssaoBlurFirstPassRenderable.values.dOrthographic,u),F.updateIfChanged(this.ssaoBlurSecondPassRenderable.values.dOrthographic,u),this.nSamples!==i.occlusion.params.samples&&(o=!0,this.nSamples=i.occlusion.params.samples,F.update(this.ssaoRenderable.values.uSamples,iet(this.randomHemisphereVector,this.nSamples)),F.updateIfChanged(this.ssaoRenderable.values.dNSamples,this.nSamples)),F.updateIfChanged(this.ssaoRenderable.values.uRadius,Math.pow(2,i.occlusion.params.radius)),F.updateIfChanged(this.ssaoRenderable.values.uBias,i.occlusion.params.bias),this.blurKernelSize!==i.occlusion.params.blurKernelSize){s=!0,this.blurKernelSize=i.occlusion.params.blurKernelSize;var y=net(this.blurKernelSize);F.update(this.ssaoBlurFirstPassRenderable.values.uKernel,y),F.update(this.ssaoBlurSecondPassRenderable.values.uKernel,y),F.updateIfChanged(this.ssaoBlurFirstPassRenderable.values.dOcclusionKernelSize,this.blurKernelSize),F.updateIfChanged(this.ssaoBlurSecondPassRenderable.values.dOcclusionKernelSize,this.blurKernelSize)}}if(i.outline.name==="on"){var b=i.outline.params.threshold;t.state.mode==="orthographic"&&(b/=5);var S=Math.pow(1e3,b)/1e3,x=S*t.state.radiusMax,C=i.outline.params.scale-1;F.updateIfChanged(this.outlinesRenderable.values.uNear,t.near),F.updateIfChanged(this.outlinesRenderable.values.uFar,t.far),F.updateIfChanged(this.outlinesRenderable.values.uMaxPossibleViewZDiff,x),F.updateIfChanged(this.renderable.values.uMaxPossibleViewZDiff,x),this.renderable.values.dOutlineScale.ref.value!==C&&(a=!0),F.updateIfChanged(this.renderable.values.dOutlineScale,C)}F.updateIfChanged(this.renderable.values.uFar,t.far),F.updateIfChanged(this.renderable.values.uNear,t.near),F.updateIfChanged(this.renderable.values.uFogFar,t.fogFar),F.updateIfChanged(this.renderable.values.uFogNear,t.fogNear),F.update(this.renderable.values.uFogColor,at.toVec3Normalized(this.renderable.values.uFogColor.ref.value,n)),F.updateIfChanged(this.renderable.values.uTransparentBackground,r),this.renderable.values.dOrthographic.ref.value!==u&&(a=!0),F.updateIfChanged(this.renderable.values.dOrthographic,u),this.renderable.values.dOutlineEnable.ref.value!==l&&(a=!0),F.updateIfChanged(this.renderable.values.dOutlineEnable,l),this.renderable.values.dOcclusionEnable.ref.value!==c&&(a=!0),F.updateIfChanged(this.renderable.values.dOcclusionEnable,c),o&&this.ssaoRenderable.update(),s&&(this.ssaoBlurFirstPassRenderable.update(),this.ssaoBlurSecondPassRenderable.update()),a&&this.renderable.update();var w=this.webgl,A=w.gl,M=w.state;M.enable(A.SCISSOR_TEST),M.disable(A.BLEND),M.disable(A.DEPTH_TEST),M.depthMask(!1);var D=t.viewport,k=D.x,R=D.y,O=D.width,H=D.height;A.viewport(k,R,O,H),A.scissor(k,R,O,H)},e.prototype.render=function(t,r,n,i,a){if(this.updateState(t,n,i,a),a.outline.name==="on"&&(this.outlinesTarget.bind(),this.outlinesRenderable.render()),a.occlusion.name==="on"){var o=t.viewport,s=o.x,u=o.y,l=o.width,c=o.height,d=Math.floor(s*this.ssaoScale),f=Math.floor(u*this.ssaoScale),p=Math.ceil(l*this.ssaoScale),v=Math.ceil(c*this.ssaoScale);this.webgl.gl.viewport(d,f,p,v),this.webgl.gl.scissor(d,f,p,v),this.ssaoFramebuffer.bind(),this.ssaoRenderable.render(),this.ssaoBlurFirstPassFramebuffer.bind(),this.ssaoBlurFirstPassRenderable.render(),this.ssaoBlurSecondPassFramebuffer.bind(),this.ssaoBlurSecondPassRenderable.render(),this.webgl.gl.viewport(s,u,l,c),this.webgl.gl.scissor(s,u,l,c)}r?this.webgl.unbindFramebuffer():this.target.bind();var h=this.webgl,m=h.gl,g=h.state;g.clearColor(0,0,0,1),m.clear(m.COLOR_BUFFER_BIT),this.renderable.render()},e}(),CT=function(){function e(t,r){this.drawPass=r;var n=r.colorTarget,i=n.getWidth(),a=n.getHeight();this.target=t.createRenderTarget(i,a,!1),this.fxaa=new IJe(t,this.target.texture),this.smaa=new jJe(t,this.target.texture)}return e.isEnabled=function(t){return t.antialiasing.name!=="off"},e.prototype.setSize=function(t,r){var n=this.target.texture.getWidth(),i=this.target.texture.getHeight();(t!==n||r!==i)&&(this.target.setSize(t,r),this.fxaa.setSize(t,r),this.smaa.supported&&this.smaa.setSize(t,r))},e.prototype._renderFxaa=function(t,r,n){if(n.antialiasing.name==="fxaa"){var i=hc.isEnabled(n)?this.drawPass.postprocessing.target.texture:this.drawPass.colorTarget.texture;this.fxaa.update(i,n.antialiasing.params),this.fxaa.render(t.viewport,r?void 0:this.target)}},e.prototype._renderSmaa=function(t,r,n){if(n.antialiasing.name==="smaa"){var i=hc.isEnabled(n)?this.drawPass.postprocessing.target.texture:this.drawPass.colorTarget.texture;this.smaa.update(i,n.antialiasing.params),this.smaa.render(t.viewport,r?void 0:this.target)}},e.prototype.render=function(t,r,n){if(n.antialiasing.name!=="off"){if(n.antialiasing.name==="fxaa")this._renderFxaa(t,r,n);else if(n.antialiasing.name==="smaa"){if(!this.smaa.supported)throw new Error('SMAA not supported, missing "HTMLImageElement"');this._renderSmaa(t,r,n)}}},e}(),set=`
precision highp float;
precision highp sampler2D;

uniform sampler2D tColor;
uniform vec2 uTexSize;
uniform float uWeight;

void main() {
    vec2 coords = gl_FragCoord.xy / uTexSize;
    gl_FragColor = texture2D(tColor, coords) * uWeight;
}
`,uet=E(E({},_a),{tColor:ur("texture","rgba","ubyte","nearest"),uTexSize:Ge("v2"),uWeight:Ge("f")}),cet=Ln("compose",ko,set);function det(e,t){var r=E(E({},wa),{tColor:F.create(t),uTexSize:F.create(He.create(t.getWidth(),t.getHeight())),uWeight:F.create(1)}),n=E({},uet),i=Ji(e,"triangles",cet,n,r);return Zi(i,r)}var Rne={mode:I.Select("off",[["off","Off"],["on","On"],["temporal","Temporal"]]),sampleLevel:I.Numeric(2,{min:0,max:5,step:1})},Ew=function(){function e(t,r){this.webgl=t,this.drawPass=r;var n=t.extensions,i=n.colorBufferFloat,a=n.textureFloat,o=n.colorBufferHalfFloat,s=n.textureHalfFloat,u=r.colorTarget.getWidth(),l=r.colorTarget.getHeight();this.colorTarget=t.createRenderTarget(u,l,!1);var c=o&&s?"fp16":i&&a?"float32":"uint8";this.composeTarget=t.createRenderTarget(u,l,!1,c),this.holdTarget=t.createRenderTarget(u,l,!1),this.compose=det(t,r.colorTarget.texture)}return e.isEnabled=function(t){return t.mode!=="off"},e.prototype.syncSize=function(){var t=this.drawPass.colorTarget.getWidth(),r=this.drawPass.colorTarget.getHeight(),n=this.compose.values.uTexSize.ref.value,i=n[0],a=n[1];(t!==i||r!==a)&&(this.colorTarget.setSize(t,r),this.composeTarget.setSize(t,r),this.holdTarget.setSize(t,r),F.update(this.compose.values.uTexSize,He.set(this.compose.values.uTexSize.ref.value,t,r)))},e.prototype.render=function(t,r,n,i,a,o,s,u){return u.multiSample.mode==="temporal"?this.renderTemporalMultiSample(t,r,n,i,a,o,s,u):(this.renderMultiSample(r,n,i,a,o,s,u),t)},e.prototype.bindOutputTarget=function(t){t?this.webgl.unbindFramebuffer():this.colorTarget.bind()},e.prototype.renderMultiSample=function(t,r,n,i,a,o,s){var u=this,l=u.compose,c=u.composeTarget,d=u.drawPass,f=u.webgl,p=f.gl,v=f.state,h=hR[Math.max(0,Math.min(s.multiSample.sampleLevel,5))],m=r.viewport,g=m.x,y=m.y,b=m.width,S=m.height,x=1/h.length,C=1/32;r.viewOffset.enabled=!0,F.update(l.values.tColor,d.getColorTarget(s.postprocessing).texture),l.update();for(var w=0;w<h.length;++w){var A=h[w];ci.setViewOffset(r.viewOffset,b,S,A[0],A[1],b,S),r.update();var M=-.5+(w+.5)/h.length,D=x+C*M;F.update(l.values.uWeight,D),d.render(t,r,n,i,!1,o,s.postprocessing),c.bind(),v.enable(p.BLEND),v.blendEquationSeparate(p.FUNC_ADD,p.FUNC_ADD),v.blendFuncSeparate(p.ONE,p.ONE,p.ONE,p.ONE),v.disable(p.DEPTH_TEST),v.depthMask(!1),p.viewport(g,y,b,S),p.scissor(g,y,b,S),w===0&&(v.clearColor(0,0,0,0),p.clear(p.COLOR_BUFFER_BIT)),l.render()}F.update(l.values.uWeight,1),F.update(l.values.tColor,c.texture),l.update(),this.bindOutputTarget(a),p.viewport(g,y,b,S),p.scissor(g,y,b,S),v.disable(p.BLEND),l.render(),r.viewOffset.enabled=!1,r.update()},e.prototype.renderTemporalMultiSample=function(t,r,n,i,a,o,s,u){var l=this,c=l.compose,d=l.composeTarget,f=l.holdTarget,p=l.drawPass,v=l.webgl,h=v.gl,m=v.state,g=hR[Math.max(0,Math.min(u.multiSample.sampleLevel,5))];if(t===-2||t>=g.length)return-2;var y=n.viewport,b=y.x,S=y.y,x=y.width,C=y.height,w=1/g.length;if(t===-1)p.render(r,n,i,a,!1,s,u.postprocessing),F.update(c.values.uWeight,1),F.update(c.values.tColor,p.getColorTarget(u.postprocessing).texture),c.update(),f.bind(),m.disable(h.BLEND),m.disable(h.DEPTH_TEST),m.depthMask(!1),h.viewport(b,S,x,C),h.scissor(b,S,x,C),c.render(),t+=1;else{n.viewOffset.enabled=!0,F.update(c.values.tColor,p.getColorTarget(u.postprocessing).texture),F.update(c.values.uWeight,w),c.update();for(var A=Math.pow(2,Math.max(0,u.multiSample.sampleLevel-2)),M=0;M<A;++M){var D=g[t];if(ci.setViewOffset(n.viewOffset,x,C,D[0],D[1],x,C),n.update(),p.render(r,n,i,a,!1,s,u.postprocessing),d.bind(),m.enable(h.BLEND),m.blendEquationSeparate(h.FUNC_ADD,h.FUNC_ADD),m.blendFuncSeparate(h.ONE,h.ONE,h.ONE,h.ONE),m.disable(h.DEPTH_TEST),m.depthMask(!1),h.viewport(b,S,x,C),h.scissor(b,S,x,C),t===0&&(m.clearColor(0,0,0,0),h.clear(h.COLOR_BUFFER_BIT)),c.render(),t+=1,t>=g.length)break}}this.bindOutputTarget(o),h.viewport(b,S,x,C),h.scissor(b,S,x,C);var k=t*w;return k>0&&(F.update(c.values.uWeight,1),F.update(c.values.tColor,d.texture),c.update(),m.disable(h.BLEND),c.render()),k<1&&(F.update(c.values.uWeight,1-k),F.update(c.values.tColor,f.texture),c.update(),k===0?m.disable(h.BLEND):m.enable(h.BLEND),c.render()),n.viewOffset.enabled=!1,n.update(),t>=g.length?-2:t},e}(),hR=[[[0,0]],[[4,4],[-4,-4]],[[-2,-6],[6,-2],[-6,2],[2,6]],[[1,-3],[-1,3],[5,1],[-3,-5],[-5,5],[-7,-1],[3,7],[7,-7]],[[1,1],[-1,-3],[-3,2],[4,-1],[-5,-2],[2,5],[5,3],[3,-5],[-2,6],[0,-7],[-4,-6],[-6,4],[-8,0],[7,-4],[6,7],[-7,-8]],[[-4,-7],[-7,-5],[-3,-5],[-5,-4],[-1,-4],[-2,-2],[-6,-1],[-4,0],[-7,1],[-1,2],[-6,3],[-3,3],[-7,6],[-3,6],[-5,7],[-1,7],[5,-7],[1,-6],[6,-5],[4,-4],[2,-3],[7,-2],[1,-1],[4,-1],[2,1],[6,2],[0,4],[4,4],[2,5],[7,5],[5,6],[3,7]]];hR.forEach(function(e){e.forEach(function(t){t[0]*=.0625,t[1]*=.0625})});var kne=function(){function e(t){this.multiSamplePass=t,this.sampleIndex=-2}return e.prototype.update=function(t,r){return t&&(this.sampleIndex=-1),r.mode==="temporal"?this.sampleIndex!==-2:!1},e.prototype.render=function(t,r,n,i,a,o,s){this.sampleIndex=this.multiSamplePass.render(this.sampleIndex,t,r,n,i,a,o,s)},e}(),One={eyeSeparation:I.Numeric(.064,{min:.01,max:.5,step:.001}),focus:I.Numeric(10,{min:1,max:100,step:.01})},fet=I.getDefaultValues(One),e0=function(){function e(t,r){r===void 0&&(r={}),this.parent=t,this.left=new rH,this.right=new rH,this.props=E(E({},fet),r)}return Object.defineProperty(e.prototype,"viewport",{get:function(){return this.parent.viewport},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"viewOffset",{get:function(){return this.parent.viewOffset},enumerable:!1,configurable:!0}),e.prototype.setProps=function(t){Object.assign(this.props,t)},e.prototype.update=function(){this.parent.update(),pet(this.parent,this.props,this.left,this.right)},e}();(function(e){function t(r){return"left"in r&&"right"in r}e.is=t})(e0||(e0={}));var rH=function(){function e(){this.viewport=Xi.create(0,0,0,0),this.view=ue(),this.projection=ue(),this.projectionView=ue(),this.inverseProjectionView=ue(),this.state=ci.createDefaultSnapshot(),this.viewOffset=ci.ViewOffset(),this.far=0,this.near=0,this.fogFar=0,this.fogNear=0}return e}(),nH=ue.identity(),iH=ue.identity();function pet(e,t,r,n){Xi.copy(r.viewport,e.viewport),ue.copy(r.view,e.view),ue.copy(r.projection,e.projection),ci.copySnapshot(r.state,e.state),ci.copyViewOffset(r.viewOffset,e.viewOffset),r.far=e.far,r.near=e.near,r.fogFar=e.fogFar,r.fogNear=e.fogNear,Xi.copy(n.viewport,e.viewport),ue.copy(n.view,e.view),ue.copy(n.projection,e.projection),ci.copySnapshot(n.state,e.state),ci.copyViewOffset(n.viewOffset,e.viewOffset),n.far=e.far,n.near=e.near,n.fogFar=e.fogFar,n.fogNear=e.fogNear;var i=Math.floor(e.viewport.width/2),a=i/e.viewport.height;r.viewport.width=i,n.viewport.x+=i,n.viewport.width-=i;var o=t.eyeSeparation/2,s=o*e.near/t.focus,u=e.near*Math.tan(e.state.fov*.5),l,c;nH[12]=-o,iH[12]=o,l=-u*a+s,c=u*a+s,r.projection[0]=2*e.near/(c-l),r.projection[8]=(c+l)/(c-l),ue.mul(r.view,r.view,nH),ue.mul(r.projectionView,r.projection,r.view),ue.invert(r.inverseProjectionView,r.projectionView),l=-u*a-s,c=u*a-s,n.projection[0]=2*e.near/(c-l),n.projection[8]=(c+l)/(c-l),ue.mul(n.view,n.view,iH),ue.mul(n.projectionView,n.projection,n.view),ue.invert(n.inverseProjectionView,n.projectionView)}var _T=Math.pow(2,24)-2,het=function(){function e(t,r,n){this.webgl=t,this.drawPass=r,this.pickBaseScale=n;var i=n/t.pixelRatio;this.pickWidth=Math.ceil(r.colorTarget.getWidth()*i),this.pickHeight=Math.ceil(r.colorTarget.getHeight()*i),this.objectPickTarget=t.createRenderTarget(this.pickWidth,this.pickHeight),this.instancePickTarget=t.createRenderTarget(this.pickWidth,this.pickHeight),this.groupPickTarget=t.createRenderTarget(this.pickWidth,this.pickHeight),this.depthPickTarget=t.createRenderTarget(this.pickWidth,this.pickHeight)}return Object.defineProperty(e.prototype,"drawingBufferHeight",{get:function(){return this.drawPass.colorTarget.getHeight()},enumerable:!1,configurable:!0}),e.prototype.syncSize=function(){var t=this.pickBaseScale/this.webgl.pixelRatio,r=Math.ceil(this.drawPass.colorTarget.getWidth()*t),n=Math.ceil(this.drawPass.colorTarget.getHeight()*t);(r!==this.pickWidth||n!==this.pickHeight)&&(this.pickWidth=r,this.pickHeight=n,this.objectPickTarget.setSize(this.pickWidth,this.pickHeight),this.instancePickTarget.setSize(this.pickWidth,this.pickHeight),this.groupPickTarget.setSize(this.pickWidth,this.pickHeight),this.depthPickTarget.setSize(this.pickWidth,this.pickHeight))},e.prototype.renderVariant=function(t,r,n,i,a){var o=this.drawPass.depthTexturePrimitives;t.clear(!1),t.update(r),t.renderPick(n.primitives,r,a,null),t.renderPick(n.volumes,r,a,o),t.renderPick(i.handle.scene,r,a,null),i.camera.isEnabled&&(i.camera.update(r),t.update(i.camera.camera),t.renderPick(i.camera.scene,i.camera.camera,a,null))},e.prototype.render=function(t,r,n,i){this.objectPickTarget.bind(),this.renderVariant(t,r,n,i,"pickObject"),this.instancePickTarget.bind(),this.renderVariant(t,r,n,i,"pickInstance"),this.groupPickTarget.bind(),this.renderVariant(t,r,n,i,"pickGroup"),this.depthPickTarget.bind(),this.renderVariant(t,r,n,i,"depth")},e}(),vet=function(){function e(t,r,n,i,a,o){this.webgl=t,this.renderer=r,this.scene=n,this.helper=i,this.pickPass=a,this.dirty=!0,this.viewport=Xi(),this.setViewport(o.x,o.y,o.width,o.height)}return e.prototype.setupBuffers=function(){var t=this.pickWidth*this.pickHeight*4;(!this.objectBuffer||this.objectBuffer.length!==t)&&(this.objectBuffer=new Uint8Array(t),this.instanceBuffer=new Uint8Array(t),this.groupBuffer=new Uint8Array(t),this.depthBuffer=new Uint8Array(t))},e.prototype.setViewport=function(t,r,n,i){Xi.set(this.viewport,t,r,n,i),this.pickScale=this.pickPass.pickBaseScale/this.webgl.pixelRatio,this.pickX=Math.ceil(t*this.pickScale),this.pickY=Math.ceil(r*this.pickScale);var a=Math.floor(n*this.pickScale),o=Math.floor(i*this.pickScale);(a!==this.pickWidth||o!==this.pickHeight)&&(this.pickWidth=a,this.pickHeight=o,this.halfPickWidth=Math.floor(this.pickWidth/2),this.setupBuffers())},e.prototype.syncBuffers=function(){var t=this,r=t.pickX,n=t.pickY,i=t.pickWidth,a=t.pickHeight;this.pickPass.objectPickTarget.bind(),this.webgl.readPixels(r,n,i,a,this.objectBuffer),this.pickPass.instancePickTarget.bind(),this.webgl.readPixels(r,n,i,a,this.instanceBuffer),this.pickPass.groupPickTarget.bind(),this.webgl.readPixels(r,n,i,a,this.groupBuffer),this.pickPass.depthPickTarget.bind(),this.webgl.readPixels(r,n,i,a,this.depthBuffer)},e.prototype.getBufferIdx=function(t,r){return(r*this.pickWidth+t)*4},e.prototype.getDepth=function(t,r){var n=this.getBufferIdx(t,r),i=this.depthBuffer;return c9e(i[n],i[n+1],i[n+2],i[n+3])},e.prototype.getId=function(t,r,n){var i=this.getBufferIdx(t,r);return UL(n[i],n[i+1],n[i+2])},e.prototype.render=function(t){var r=this,n=r.pickX,i=r.pickY,a=r.pickWidth,o=r.pickHeight,s=r.halfPickWidth,u=this,l=u.renderer,c=u.scene,d=u.helper;l.setTransparentBackground(!1),l.setDrawingBufferSize(this.pickPass.objectPickTarget.getWidth(),this.pickPass.objectPickTarget.getHeight()),e0.is(t)?(l.setViewport(n,i,s,o),this.pickPass.render(l,t.left,c,d),l.setViewport(n+s,i,a-s,o),this.pickPass.render(l,t.right,c,d)):(l.setViewport(n,i,a,o),this.pickPass.render(l,t,c,d)),this.dirty=!1},e.prototype.identify=function(t,r,n){var i=this,a=i.webgl,o=i.pickScale;if(!a.isContextLost){t*=a.pixelRatio,r*=a.pixelRatio,r=this.pickPass.drawingBufferHeight-r;var s=this.viewport;if(!(t<s.x||r<s.y||t>s.x+s.width||r>s.y+s.height)){this.dirty&&(this.render(n),this.syncBuffers());var u=t-s.x,l=r-s.y,c=Math.floor(u*o),d=Math.floor(l*o),f=this.getId(c,d,this.objectBuffer);if(!(f===-1||f===_T)){var p=this.getId(c,d,this.instanceBuffer);if(!(p===-1||p===_T)){var v=this.getId(c,d,this.groupBuffer);if(!(v===-1||v===_T)){var h=this.getDepth(c,d),m=_.create(t,s.height-r,h);if(e0.is(n)){var g=Math.floor(s.width/2);t>s.x+g?(m[0]=s.x+(u-g)*2,iC(m,m,s,n.right.inverseProjectionView)):(m[0]=s.x+u*2,iC(m,m,s,n.left.inverseProjectionView))}else iC(m,m,s,n.inverseProjectionView);return{id:{objectId:f,instanceId:p,groupId:v},position:m}}}}}}},e}(),met=`
precision highp float;
precision highp sampler2D;

uniform sampler2D tDepthPrimitives;
uniform sampler2D tDepthVolumes;
uniform vec2 uTexSize;

#include common

float getDepth(const in vec2 coords, sampler2D tDepth) {
    #ifdef dPackedDepth
        return unpackRGBAToDepth(texture2D(tDepth, coords));
    #else
        return texture2D(tDepth, coords).r;
    #endif
}

void main() {
    vec2 coords = gl_FragCoord.xy / uTexSize;
    float depth = min(getDepth(coords, tDepthPrimitives), getDepth(coords, tDepthVolumes));
    gl_FragColor = packDepthToRGBA(depth);
}
`,get=`
precision highp float;
precision highp sampler2D;

uniform sampler2D tColor;
uniform vec2 uTexSize;

void main() {
    vec2 coords = gl_FragCoord.xy / uTexSize;
    gl_FragColor = texture2D(tColor, coords);
}
`,yet=`
precision highp float;

uniform sampler2D tWboitA;
uniform sampler2D tWboitB;
uniform vec2 uTexSize;

void main() {
    vec2 coords = gl_FragCoord.xy / uTexSize;

    vec4 accum = texture2D(tWboitA, coords);
    float r = 1.0 - accum.a;

    accum.a = texture2D(tWboitB, coords).r;
    // divisor needs to allow very small values for nice fading
    gl_FragColor = vec4(accum.rgb / clamp(accum.a, 0.00000001, 50000.0), r);
}
`,bet=E(E({},_a),{tWboitA:ur("texture","rgba","float","nearest"),tWboitB:ur("texture","rgba","float","nearest"),uTexSize:Ge("v2")}),xet=Ln("evaluate-wboit",ko,yet);function Cet(e,t,r){var n=E(E({},wa),{tWboitA:F.create(t),tWboitB:F.create(r),uTexSize:F.create(He.create(t.getWidth(),t.getHeight()))}),i=E({},bet),a=Ji(e,"triangles",xet,i,n);return Zi(a,n)}var _et=function(){function e(t,r,n){if(this.webgl=t,this._supported=!1,!!e.isSupported(t)){var i=t.resources;this.textureA=i.texture("image-float32","rgba","float","nearest"),this.textureA.define(r,n),this.textureB=i.texture("image-float32","rgba","float","nearest"),this.textureB.define(r,n),this.renderable=Cet(t,this.textureA,this.textureB),this.framebuffer=i.framebuffer(),this._supported=!0,this._init()}}return Object.defineProperty(e.prototype,"supported",{get:function(){return this._supported},enumerable:!1,configurable:!0}),e.prototype.bind=function(){var t=this.webgl,r=t.state,n=t.gl;this.framebuffer.bind(),r.clearColor(0,0,0,1),n.clear(n.COLOR_BUFFER_BIT),r.disable(n.DEPTH_TEST),r.blendFuncSeparate(n.ONE,n.ONE,n.ZERO,n.ONE_MINUS_SRC_ALPHA),r.enable(n.BLEND)},e.prototype.render=function(){var t=this.webgl,r=t.state,n=t.gl;r.blendFuncSeparate(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA),r.enable(n.BLEND),this.renderable.update(),this.renderable.render()},e.prototype.setSize=function(t,r){var n=this.renderable.values.uTexSize.ref.value,i=n[0],a=n[1];(t!==i||r!==a)&&(this.textureA.define(t,r),this.textureB.define(t,r),F.update(this.renderable.values.uTexSize,He.set(this.renderable.values.uTexSize.ref.value,t,r)))},e.prototype.reset=function(){this._supported&&this._init()},e.prototype._init=function(){var t=this.webgl.extensions.drawBuffers;this.framebuffer.bind(),t.drawBuffers([t.COLOR_ATTACHMENT0,t.COLOR_ATTACHMENT1]),this.textureA.attachFramebuffer(this.framebuffer,"color0"),this.textureB.attachFramebuffer(this.framebuffer,"color1")},e.isSupported=function(t){var r=t.extensions,n=r.drawBuffers,i=r.textureFloat,a=r.colorBufferFloat,o=r.depthTexture;if(!i||!a||!o||!n){if(kr){var s=[];i||s.push("textureFloat"),a||s.push("colorBufferFloat"),o||s.push("depthTexture"),n||s.push("drawBuffers"),console.log('Missing "'+s.join('", "')+'" extensions required for "wboit"')}return!1}else return!0},e}(),wet=E(E({},_a),{tDepthPrimitives:ur("texture","depth","ushort","nearest"),tDepthVolumes:ur("texture","depth","ushort","nearest"),uTexSize:Ge("v2"),dPackedDepth:Qt("boolean")}),Eet=Ln("depth-merge",ko,met);function Aet(e,t,r,n){var i=E(E({},wa),{tDepthPrimitives:F.create(t),tDepthVolumes:F.create(r),uTexSize:F.create(He.create(t.getWidth(),t.getHeight())),dPackedDepth:F.create(n)}),a=E({},wet),o=Ji(e,"triangles",Eet,a,i);return Zi(o,i)}var Pet=E(E({},_a),{tColor:ur("texture","rgba","ubyte","nearest"),uTexSize:Ge("v2")}),Tet=Ln("copy",ko,get);function aH(e,t){var r=E(E({},wa),{tColor:F.create(t),uTexSize:F.create(He.create(t.getWidth(),t.getHeight()))}),n=E({},Pet),i=Ji(e,"triangles",Tet,n,r);return Zi(i,r)}var Lne=function(){function e(t,r,n,i){this.webgl=t;var a=t.extensions,o=t.resources,s=t.isWebGL2;this.drawTarget=Wje(t.gl),this.colorTarget=t.createRenderTarget(r,n,!0,"uint8","linear"),this.packedDepth=!a.depthTexture,this.depthTarget=t.createRenderTarget(r,n),this.depthTexture=this.depthTarget.texture,this.depthTargetPrimitives=this.packedDepth?t.createRenderTarget(r,n):null,this.depthTargetVolumes=this.packedDepth?t.createRenderTarget(r,n):null,this.depthTexturePrimitives=this.depthTargetPrimitives?this.depthTargetPrimitives.texture:o.texture("image-depth","depth",s?"float":"ushort","nearest"),this.depthTextureVolumes=this.depthTargetVolumes?this.depthTargetVolumes.texture:o.texture("image-depth","depth",s?"float":"ushort","nearest"),this.packedDepth||(this.depthTexturePrimitives.define(r,n),this.depthTextureVolumes.define(r,n)),this.depthMerge=Aet(t,this.depthTexturePrimitives,this.depthTextureVolumes,this.packedDepth),this.wboit=i?new _et(t,r,n):void 0,this.postprocessing=new hc(t,this),this.antialiasing=new CT(t,this),this.copyFboTarget=aH(t,this.colorTarget.texture),this.copyFboPostprocessing=aH(t,this.postprocessing.target.texture)}return Object.defineProperty(e.prototype,"wboitEnabled",{get:function(){var t;return!!(!((t=this.wboit)===null||t===void 0)&&t.supported)},enumerable:!1,configurable:!0}),e.prototype.reset=function(){var t;(t=this.wboit)===null||t===void 0||t.reset()},e.prototype.setSize=function(t,r){var n,i=this.colorTarget.getWidth(),a=this.colorTarget.getHeight();(t!==i||r!==a)&&(this.colorTarget.setSize(t,r),this.depthTarget.setSize(t,r),this.depthTargetPrimitives?this.depthTargetPrimitives.setSize(t,r):this.depthTexturePrimitives.define(t,r),this.depthTargetVolumes?this.depthTargetVolumes.setSize(t,r):this.depthTextureVolumes.define(t,r),F.update(this.depthMerge.values.uTexSize,He.set(this.depthMerge.values.uTexSize.ref.value,t,r)),F.update(this.copyFboTarget.values.uTexSize,He.set(this.copyFboTarget.values.uTexSize.ref.value,t,r)),F.update(this.copyFboPostprocessing.values.uTexSize,He.set(this.copyFboPostprocessing.values.uTexSize.ref.value,t,r)),!((n=this.wboit)===null||n===void 0)&&n.supported&&this.wboit.setSize(t,r),this.postprocessing.setSize(t,r),this.antialiasing.setSize(t,r))},e.prototype._depthMerge=function(){var t=this.webgl,r=t.state,n=t.gl;this.depthMerge.update(),this.depthTarget.bind(),r.disable(n.BLEND),r.disable(n.DEPTH_TEST),r.disable(n.CULL_FACE),r.depthMask(!1),r.clearColor(1,1,1,1),n.clear(n.COLOR_BUFFER_BIT),this.depthMerge.render()},e.prototype._renderWboit=function(t,r,n,i,a){var o;if(!(!((o=this.wboit)===null||o===void 0)&&o.supported))throw new Error("expected wboit to be supported");this.colorTarget.bind(),t.clear(!0),this.depthTexturePrimitives.attachFramebuffer(this.colorTarget.framebuffer,"depth"),this.colorTarget.bind(),t.clearDepth(),t.renderWboitOpaque(n.primitives,r,null),this.depthTextureVolumes.attachFramebuffer(this.colorTarget.framebuffer,"depth"),this.colorTarget.bind(),t.clearDepth(),t.renderWboitOpaque(n.volumes,r,this.depthTexturePrimitives),this._depthMerge(),hc.isEnabled(a)&&this.postprocessing.render(r,!1,i,t.props.backgroundColor,a),this.wboit.bind(),t.renderWboitTransparent(n.primitives,r,this.depthTexture),t.renderWboitTransparent(n.volumes,r,this.depthTexture),hc.isEnabled(a)?(this.depthTexturePrimitives.attachFramebuffer(this.postprocessing.target.framebuffer,"depth"),this.postprocessing.target.bind()):(this.depthTexturePrimitives.attachFramebuffer(this.colorTarget.framebuffer,"depth"),this.colorTarget.bind()),this.wboit.render()},e.prototype._renderBlended=function(t,r,n,i,a,o){if(i?this.drawTarget.bind():(this.colorTarget.bind(),this.packedDepth||this.depthTexturePrimitives.attachFramebuffer(this.colorTarget.framebuffer,"depth")),t.clear(!0),t.renderBlendedOpaque(n.primitives,r,null),!i){this.depthTargetPrimitives&&(this.depthTargetPrimitives.bind(),t.clear(!1),t.renderDepth(n.primitives,r,null),this.colorTarget.bind()),this.packedDepth||(this.depthTextureVolumes.attachFramebuffer(this.colorTarget.framebuffer,"depth"),t.clearDepth()),t.renderBlendedVolumeOpaque(n.volumes,r,this.depthTexturePrimitives),this.depthTargetVolumes&&(this.depthTargetVolumes.bind(),t.clear(!1),t.renderDepth(n.volumes,r,this.depthTexturePrimitives),this.colorTarget.bind()),this._depthMerge(),this.colorTarget.bind(),hc.isEnabled(o)&&this.postprocessing.render(r,!1,a,t.props.backgroundColor,o),t.renderBlendedVolumeTransparent(n.volumes,r,this.depthTexturePrimitives);var s=hc.isEnabled(o)?this.postprocessing.target:this.colorTarget;this.packedDepth||this.depthTexturePrimitives.attachFramebuffer(s.framebuffer,"depth"),s.bind()}t.renderBlendedTransparent(n.primitives,r,null)},e.prototype._render=function(t,r,n,i,a,o,s){var u=n.volumes.renderables.length>0,l=hc.isEnabled(s),c=CT.isEnabled(s),d=r.viewport,f=d.x,p=d.y,v=d.width,h=d.height;t.setViewport(f,p,v,h),t.update(r),o&&!c&&a&&(this.drawTarget.bind(),t.clear(!1)),this.wboitEnabled?this._renderWboit(t,r,n,o,s):this._renderBlended(t,r,n,!u&&!l&&!c&&a,o,s),l?this.postprocessing.target.bind():!a||u||this.wboitEnabled?this.colorTarget.bind():this.drawTarget.bind(),i.debug.isEnabled&&(i.debug.syncVisibility(),t.renderBlended(i.debug.scene,r,null)),i.handle.isEnabled&&t.renderBlended(i.handle.scene,r,null),i.camera.isEnabled&&(i.camera.update(r),t.update(i.camera.camera),t.renderBlended(i.camera.scene,i.camera.camera,null)),c?this.antialiasing.render(r,a,s):a&&(this.drawTarget.bind(),this.webgl.state.disable(this.webgl.gl.DEPTH_TEST),l?this.copyFboPostprocessing.render():(u||this.wboitEnabled)&&this.copyFboTarget.render()),this.webgl.gl.flush()},e.prototype.render=function(t,r,n,i,a,o,s){t.setTransparentBackground(o),t.setDrawingBufferSize(this.colorTarget.getWidth(),this.colorTarget.getHeight()),e0.is(r)?(this._render(t,r.left,n,i,a,o,s),this._render(t,r.right,n,i,a,o,s)):this._render(t,r,n,i,a,o,s)},e.prototype.getColorTarget=function(t){return CT.isEnabled(t)?this.antialiasing.target:hc.isEnabled(t)?this.postprocessing.target:this.colorTarget},e}(),Iet=E(E({},Ft.Params),{alpha:E(E({},Ft.Params.alpha),{defaultValue:.51}),ignoreLight:E(E({},Ft.Params.ignoreLight),{defaultValue:!0}),colorX:I.Color(fr.red,{isEssential:!0}),colorY:I.Color(fr.green,{isEssential:!0}),colorZ:I.Color(fr.blue,{isEssential:!0}),scale:I.Numeric(.33,{min:.1,max:2,step:.1},{isEssential:!0})}),tA={axes:I.MappedStatic("on",{on:I.Group(Iet),off:I.Group({})},{cycle:!0,description:"Show camera orientation axes"})},Fne=function(){function e(t,r){var n=this;r===void 0&&(r={}),this.webgl=t,this.props={axes:{name:"off",params:{}}},this.eachGroup=function(i,a){if(!n.renderObject||!vR(i))return!1;for(var o=!1,s=n.renderObject.values.uGroupCount.ref.value,u=i.elements,l=0,c=u;l<c.length;l++){var d=c[l],f=d.groupId,p=d.instanceId,v=p*s+f;a(Ie.ofSingleton(v))&&(o=!0)}return o},this.scene=Jg.create(t),this.camera=new ci,_.set(this.camera.up,0,1,0),_.set(this.camera.target,0,0,0),this.setProps(r)}return e.prototype.setProps=function(t){var r=this;this.props=vL(this.props,function(n){if(t.axes!==void 0&&(n.axes.name=t.axes.name,t.axes.name==="on")){r.scene.clear();var i=E(E({},t.axes.params),{scale:t.axes.params.scale*r.webgl.pixelRatio});r.renderObject=Let(i),r.renderObject.state.noClip=!0,r.scene.add(r.renderObject),r.scene.commit(),_.set(r.camera.position,0,0,i.scale*200),ue.lookAt(r.camera.view,r.camera.position,r.camera.target,r.camera.up),n.axes.params=E({},t.axes.params)}})},Object.defineProperty(e.prototype,"isEnabled",{get:function(){return this.props.axes.name==="on"},enumerable:!1,configurable:!0}),e.prototype.getLoci=function(t){var r=t.objectId,n=t.groupId,i=t.instanceId;return!this.renderObject||r!==this.renderObject.id||n===0?Nr:Det(this,n,i)},e.prototype.mark=function(t,r){return!Do.is(Do.Highlighting,r)||!vR(t)||t.data!==this?!1:wr.mark(this.renderObject,t,r,this.eachGroup)},e.prototype.update=function(t){if(this.renderObject){Ret(this.camera,t.viewport,t.viewOffset),ue.extractRotation(this.scene.view,t.view);var r=this.renderObject.values.boundingSphere.ref.value.radius;ue.setTranslation(this.scene.view,_.create(-t.viewport.width/2+r,-t.viewport.height/2+r,0))}},e}();function Met(e){switch(e){case 1:return"X Axis";case 2:return"Y Axis";case 3:return"Z Axis";case 4:return"XY Plane";case 5:return"XZ Plane";case 6:return"YZ Plane";default:return"Axes"}}function Det(e,t,r){return UE("camera-axes",e,[{groupId:t,instanceId:r}],void 0,function(){return Met(t)})}function vR(e){return e.kind==="data-loci"&&e.tag==="camera-axes"}function Ret(e,t,r){var n=e.near,i=e.far,a=-t.width/2,o=t.width/2,s=t.height/2,u=-t.height/2,l=(o-a)/2,c=(s-u)/2,d=(o+a)/2,f=(s+u)/2,p=d-l,v=d+l,h=f+c,m=f-c;if(r.enabled){var g=(o-a)/r.width,y=(s-u)/r.height;p+=g*r.offsetX,v=p+g*r.width,h-=y*r.offsetY,m=h-y*r.height}ue.ortho(e.projection,p,v,h,m,n,i)}function ket(e,t){var r=wt.createState(512,256,t),n=.075*e,i=_.scale(_(),_.unitX,e),a=_.scale(_(),_.unitY,e),o=_.scale(_(),_.unitZ,e),s={radiusTop:n,radiusBottom:n,radialSegments:32};r.currentGroup=0,Ni(r,_.origin,n,2),r.currentGroup=1,Ni(r,i,n,2),Ua(r,_.origin,i,1,s),r.currentGroup=2,Ni(r,a,n,2),Ua(r,_.origin,a,1,s),r.currentGroup=3,Ni(r,o,n,2),Ua(r,_.origin,o,1,s),_.scale(i,i,.5),_.scale(a,a,.5),_.scale(o,o,.5),r.currentGroup=4,wt.addTriangle(r,_.origin,i,a),wt.addTriangle(r,_.origin,a,i);var u=_.add(_(),i,a);wt.addTriangle(r,u,i,a),wt.addTriangle(r,u,a,i),r.currentGroup=5,wt.addTriangle(r,_.origin,i,o),wt.addTriangle(r,_.origin,o,i);var l=_.add(_(),i,o);wt.addTriangle(r,l,i,o),wt.addTriangle(r,l,o,i),r.currentGroup=6,wt.addTriangle(r,_.origin,a,o),wt.addTriangle(r,_.origin,o,a);var c=_.add(_(),a,o);return wt.addTriangle(r,c,a,o),wt.addTriangle(r,c,o,a),wt.getMesh(r)}function Oet(e,t){var r=100*e.scale,n=ket(r,t==null?void 0:t.geometry);n.setBoundingSphere(Be.create(_.create(r/2,r/2,r/2),r+r/4));var i=function(a){switch(a){case 1:return e.colorX;case 2:return e.colorY;case 3:return e.colorZ;default:return fr.grey}};return Fr.create("axes",{},n,i,function(){return 1},function(){return""})}function Let(e){var t=Oet(e);return Fr.createRenderObject(t,e)}var Fet={transparentBackground:I.Boolean(!1),multiSample:I.Group(Rne),postprocessing:I.Group(Dne),cameraHelper:I.Group(tA)},Net=function(){function e(t,r,n,i,a,o,s){this.webgl=t,this.renderer=r,this.scene=n,this.camera=i,this._width=0,this._height=0,this._camera=new ci,this.props=E(E({},I.getDefaultValues(Fet)),s),this.drawPass=new Lne(t,128,128,o),this.multiSamplePass=new Ew(t,this.drawPass),this.multiSampleHelper=new kne(this.multiSamplePass),this.helper={camera:new Fne(t,this.props.cameraHelper),debug:a.debug,handle:a.handle},this.setSize(1024,768)}return Object.defineProperty(e.prototype,"colorTarget",{get:function(){return this._colorTarget},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return this._width},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height},enumerable:!1,configurable:!0}),e.prototype.setSize=function(t,r){t===this._width&&r===this._height||(this._width=t,this._height=r,this.drawPass.setSize(t,r),this.multiSamplePass.syncSize())},e.prototype.setProps=function(t){t===void 0&&(t={}),Object.assign(this.props,t),t.cameraHelper&&this.helper.camera.setProps(t.cameraHelper)},e.prototype.render=function(){ci.copySnapshot(this._camera.state,this.camera.state),Xi.set(this._camera.viewport,0,0,this._width,this._height),this._camera.update(),Ew.isEnabled(this.props.multiSample)?(this.multiSampleHelper.render(this.renderer,this._camera,this.scene,this.helper,!1,this.props.transparentBackground,this.props),this._colorTarget=this.multiSamplePass.colorTarget):(this.drawPass.render(this.renderer,this._camera,this.scene,this.helper,!1,this.props.transparentBackground,this.props.postprocessing),this._colorTarget=this.drawPass.getColorTarget(this.props.postprocessing))},e.prototype.getImageData=function(t,r,n){var i,a;this.setSize(t,r),this.render(),this.colorTarget.bind();var o=(i=n==null?void 0:n.width)!==null&&i!==void 0?i:t,s=(a=n==null?void 0:n.height)!==null&&a!==void 0?a:r,u=new Uint8Array(o*s*4);n?this.webgl.readPixels(n.x,r-n.y-n.height,o,s,u):this.webgl.readPixels(0,0,o,s,u);var l=zh.create(u,o,s);return zh.flipY(l),zh.divideByAlpha(l),new ImageData(new Uint8ClampedArray(u),o,s)},e}(),Bet=E(E({},Ft.Params),{alpha:E(E({},Ft.Params.alpha),{defaultValue:1}),ignoreLight:E(E({},Ft.Params.ignoreLight),{defaultValue:!0}),colorX:I.Color(fr.red,{isEssential:!0}),colorY:I.Color(fr.green,{isEssential:!0}),colorZ:I.Color(fr.blue,{isEssential:!0}),scale:I.Numeric(.33,{min:.1,max:2,step:.1},{isEssential:!0})}),Nne={handle:I.MappedStatic("off",{on:I.Group(Bet),off:I.Group({})},{cycle:!0,description:"Show handle tool"})},Uet=function(){function e(t,r){var n=this;r===void 0&&(r={}),this.webgl=t,this.props={handle:{name:"off",params:{}}},this._transform=ue(),this.eachGroup=function(i,a){if(!n.renderObject||!oH(i))return!1;for(var o=!1,s=n.renderObject.values.uGroupCount.ref.value,u=i.elements,l=0,c=u;l<c.length;l++){var d=c[l],f=d.groupId,p=d.instanceId,v=p*s+f;a(Ie.ofSingleton(v))&&(o=!0)}return o},this.scene=Jg.create(t),this.setProps(r)}return e.prototype.getBoundingSphere=function(t,r){return this.renderObject&&(Be.copy(t,this.renderObject.values.invariantBoundingSphere.ref.value),ue.fromArray(this._transform,this.renderObject.values.aTransform.ref.value,r*16),Be.transform(t,t,this._transform)),t},e.prototype.setProps=function(t){var r=this;this.props=vL(this.props,function(n){if(t.handle!==void 0&&(n.handle.name=t.handle.name,t.handle.name==="on")){r.scene.clear();var i=E(E({},t.handle.params),{scale:t.handle.params.scale*r.webgl.pixelRatio});r.renderObject=Het(i),r.renderObject.state.noClip=!0,r.scene.add(r.renderObject),r.scene.commit(),n.handle.params=E({},t.handle.params)}})},Object.defineProperty(e.prototype,"isEnabled",{get:function(){return this.props.handle.name==="on"},enumerable:!1,configurable:!0}),e.prototype.update=function(t,r,n){this.renderObject&&(ue.setTranslation(this.renderObject.values.aTransform.ref.value,r),ue.fromMat3(this.renderObject.values.aTransform.ref.value,n),F.update(this.renderObject.values.aTransform,this.renderObject.values.aTransform.ref.value),this.scene.update([this.renderObject],!0))},e.prototype.getLoci=function(t){var r=t.objectId,n=t.groupId,i=t.instanceId;return!this.renderObject||r!==this.renderObject.id?Nr:zet(this,n,i)},e.prototype.mark=function(t,r){return!Do.is(Do.Highlighting,r)||!oH(t)||t.data!==this?!1:wr.mark(this.renderObject,t,r,this.eachGroup)},e}();function jet(e,t){var r=wt.createState(512,256,t),n=.05*e,i=_.scale(_(),_.unitX,e),a=_.scale(_(),_.unitY,e),o=_.scale(_(),_.unitZ,e),s={radiusTop:n,radiusBottom:n,radialSegments:32};return r.currentGroup=Ph.TranslateScreenXY,Ni(r,_.origin,n*3,2),r.currentGroup=Ph.TranslateObjectX,Ni(r,i,n,2),Ua(r,_.origin,i,1,s),r.currentGroup=Ph.TranslateObjectY,Ni(r,a,n,2),Ua(r,_.origin,a,1,s),r.currentGroup=Ph.TranslateObjectZ,Ni(r,o,n,2),Ua(r,_.origin,o,1,s),wt.getMesh(r)}var Ph={None:0,TranslateScreenXY:1,TranslateObjectX:3,TranslateObjectY:4,TranslateObjectZ:5};function zet(e,t,r){return UE("handle",e,[{groupId:t,instanceId:r}],function(n){return e.getBoundingSphere(n,r)},function(){return"Handle Helper | Group Id "+t+" | Instance Id "+r})}function oH(e){return e.kind==="data-loci"&&e.tag==="handle"}function Vet(e,t){var r=10*e.scale,n=jet(r,t==null?void 0:t.geometry);n.setBoundingSphere(Be.create(_.create(r/2,r/2,r/2),r+r/4));var i=function(a){switch(a){case Ph.TranslateObjectX:return e.colorX;case Ph.TranslateObjectY:return e.colorY;case Ph.TranslateObjectZ:return e.colorZ;default:return fr.grey}};return Fr.create("handle",{},n,i,function(){return 1},function(){return""})}function Het(e){var t=Vet(e);return Fr.createRenderObject(t,e)}var Get={debug:I.Group(vF),camera:I.Group({helper:I.Group(tA)}),handle:I.Group(Nne)},qet=I.getDefaultValues(Get),$et=function(){function e(t,r,n){n===void 0&&(n={});var i=E(E({},qet),n);this.debug=new vJe(t,r,i.debug),this.camera=new Fne(t,i.camera.helper),this.handle=new Uet(t,i.handle)}return e}(),Wet=function(){function e(t,r){r===void 0&&(r={}),this.webgl=t;var n=t.gl;this.draw=new Lne(t,n.drawingBufferWidth,n.drawingBufferHeight,r.enableWboit||!1),this.pick=new het(t,this.draw,r.pickScale||.25),this.multiSample=new Ew(t,this.draw)}return e.prototype.updateSize=function(){var t=this.webgl.gl;this.draw.setSize(t.drawingBufferWidth,t.drawingBufferHeight),this.pick.syncSize(),this.multiSample.syncSize()},e}(),Ts={camera:I.Group({mode:I.Select("perspective",I.arrayToOptions(["perspective","orthographic"]),{label:"Camera"}),helper:I.Group(tA,{isFlat:!0}),stereo:I.MappedStatic("off",{on:I.Group(One),off:I.Group({})},{cycle:!0,hideIf:function(e){return(e==null?void 0:e.mode)!=="perspective"}}),manualReset:I.Boolean(!1,{isHidden:!0})},{pivot:"mode"}),cameraFog:I.MappedStatic("on",{on:I.Group({intensity:I.Numeric(15,{min:1,max:100,step:1})}),off:I.Group({})},{cycle:!0,description:"Show fog in the distance"}),cameraClipping:I.Group({radius:I.Numeric(100,{min:0,max:99,step:1},{label:"Clipping",description:"How much of the scene to show."}),far:I.Boolean(!0,{description:"Hide scene in the distance"})},{pivot:"radius"}),viewport:I.MappedStatic("canvas",{canvas:I.Group({}),"static-frame":I.Group({x:I.Numeric(0),y:I.Numeric(0),width:I.Numeric(128),height:I.Numeric(128)}),"relative-frame":I.Group({x:I.Numeric(.33,{min:0,max:1,step:.01}),y:I.Numeric(.33,{min:0,max:1,step:.01}),width:I.Numeric(.5,{min:.01,max:1,step:.01}),height:I.Numeric(.5,{min:.01,max:1,step:.01})})}),cameraResetDurationMs:I.Numeric(250,{min:0,max:1e3,step:1},{description:"The time it takes to reset the camera."}),transparentBackground:I.Boolean(!1),multiSample:I.Group(Rne),postprocessing:I.Group(Dne),renderer:I.Group(cR),trackball:I.Group(Mne),debug:I.Group(vF),handle:I.Group(Nne)},mF=I.getDefaultValues(Ts),mR;(function(e){e.DefaultAttribs={antialias:!0,preserveDrawingBuffer:!0,pixelScale:1,pickScale:.25,enableWboit:!0};function t(r,n){n===void 0&&(n={});var i=E(E({},e.DefaultAttribs),n),a=i.antialias,o=i.preserveDrawingBuffer,s=i.pixelScale,u=Xje(r,{antialias:a,preserveDrawingBuffer:o,alpha:!0,depth:!0,premultipliedAlpha:!0});if(u===null)throw new Error("Could not create a WebGL rendering context");var l=lR.fromElement(r,{pixelScale:s}),c=Jje(u,{pixelScale:s}),d=new Wet(c,n);if(kr){var f=u.getExtension("WEBGL_lose_context");f&&r.addEventListener("mousedown",function(m){c.isContextLost||!m.shiftKey||!m.ctrlKey||!m.altKey||(kr&&console.log("lose context"),f.loseContext(),setTimeout(function(){c.isContextLost&&(kr&&console.log("restore context"),f.restoreContext())},1e3))},!1)}var p=new kf(0),v=function(m){c.setContextLost(),m.preventDefault(),kr&&console.log("context lost"),p.next(kn())},h=function(){c.isContextLost&&(c.handleContextRestored(function(){d.draw.reset()}),kr&&console.log("context restored"))};return r.addEventListener("webglcontextlost",v,!1),r.addEventListener("webglcontextrestored",h,!1),{canvas:r,webgl:c,input:l,passes:d,attribs:i,contextLost:p,contextRestored:c.contextRestored,dispose:function(m){l.dispose(),r.removeEventListener("webglcontextlost",v,!1),r.removeEventListener("webglcontextrestored",h,!1),c.destroy(m)}}}e.fromCanvas=t})(mR||(mR={}));var Xet=typeof window<"u"?window.requestAnimationFrame:function(e){return setImmediate(function(){return e(Date.now())})},Yet=typeof window<"u"?window.cancelAnimationFrame:function(e){return clearImmediate(e)},gR;(function(e){function t(r,n){var i=r.webgl,a=r.input,o=r.passes,s=r.attribs;n===void 0&&(n={});var u=E(E({},mF),n),l=new Map,c=new Map,d=new kf(0),f=kn(),p=new kf(0),v=new kf(0),h=i.gl,m=i.contextRestored,g=0,y=0,b=128,S=128;dt();var x=Jg.create(i),C=new ci({position:_.create(0,0,100),mode:u.camera.mode,fog:u.cameraFog.name==="on"?u.cameraFog.params.intensity:0,clipFar:u.cameraClipping.far},{x:g,y,width:b,height:S},{pixelScale:s.pixelScale}),w=new e0(C,u.camera.stereo.params),A=fR.create(a,C,u.trackball),M=dR.create(i,u.renderer),D=new $et(i,x,u),k=new vet(i,M,x,D,o.pick,{x:g,y,width:b,height:S}),R=new CJe(Ae,$,a,C),O=new kne(o.multiSample),H=!1,B=void 0,j=void 0,Y=!1,G=!0;function $(Me){var Ye=Nr,tt=or.Empty;if(Me){var xt=D.camera.getLoci(Me);if(xt!==Nr)return{loci:xt,repr:tt};Ye=D.handle.getLoci(Me),l.forEach(function(ht,ut){var pe=ut.getLoci(Me);Du(pe)||(Du(Ye)||console.warn("found another loci, this should not happen"),Ye=pe,tt=ut)})}return{loci:Ye,repr:tt}}function q(Me,Ye){var tt=Me.repr,xt=Me.loci,ht=!1;if(tt?ht=tt.mark(xt,Ye):(ht=D.handle.mark(xt,Ye),ht=D.camera.mark(xt,Ye)||ht,l.forEach(function(pe,me){ht=me.mark(xt,Ye)||ht})),ht){x.update(void 0,!0),D.handle.scene.update(void 0,!0),D.camera.scene.update(void 0,!0);var ut=k.dirty;z(!0),k.dirty=ut}}function ee(Me){if(i.isContextLost)return!1;var Ye=!1;if(Y&&(ot(!1),Y=!1,Ye=!0),g>h.drawingBufferWidth||g+b<0||y>h.drawingBufferHeight||y+S<0)return!1;var tt=!1;A.update(X);var xt=C.update(),ht=Me||xt||Ye||fe;fe=!1;var ut=O.update(ht,u.multiSample);if(ht||ut){var pe=C;u.camera.stereo.name==="on"&&(w.update(),pe=w),Ew.isEnabled(u.multiSample)?O.render(M,pe,x,D,!0,u.transparentBackground,u):o.draw.render(M,pe,x,D,!0,u.transparentBackground,u.postprocessing),k.dirty=!0,tt=!0}return tt}var fe=!1,W=!1,X=0,U=!1;function z(Me){U||ee(!!Me)&&G&&p.next(kn()-f)}function J(Me){fe=fe||!!Me}var K=0;function Z(Me,Ye){X=Me,Se(Ye==null?void 0:Ye.isSynchronous),C.transition.tick(X),!(Ye!=null&&Ye.manualDraw)&&(z(!1),!C.transition.inTransition&&!i.isContextLost&&R.tick(X))}function te(){Z(kn()),K=Xet(te)}function le(Me){f=Me,A.start(Me)}function ye(){U=!1,A.start(kn()),K===0&&te()}function be(Me){Me===void 0&&(Me=!1),U=Me,Yet(K),K=0}function Ae(Me,Ye){var tt=u.camera.stereo.name==="on"?w:C;return i.isContextLost?void 0:k.identify(Me,Ye,tt)}function Se(Me){Me===void 0&&(Me=!1);var Ye=we(Me);Ye&&(ie(),W&&(D.debug.isEnabled&&D.debug.update(),z(!0),W=!1),v.next(kn()))}function ie(){if(H){var Me=x.boundingSphereVisible,Ye=Me.center,tt=Me.radius,xt=A.props.autoAdjustMinMaxDistance;if(xt.name==="on"){var ht=xt.params.minDistanceFactor*tt+xt.params.minDistancePadding,ut=Math.max(xt.params.maxDistanceFactor*tt,xt.params.maxDistanceMin);A.setProps({minDistance:ht,maxDistance:ut})}if(tt>0){var pe=B===void 0?u.cameraResetDurationMs:B,me=C.getFocus(Ye,tt),Ee=typeof j=="function"?j(x,C):j,Ke=Ee?E(E({},me),Ee):me;C.setState(E(E({},Ke),{radiusMax:x.boundingSphere.radius}),pe)}B=void 0,j=void 0,H=!1}}var oe=Be(),L=Be();function V(){if(C.state.radiusMax===0)return!0;if(C.transition.inTransition||j)return!1;var Me=!0;Be.set(L,C.state.target,C.state.radius);for(var Ye=0,tt=x.renderables;Ye<tt.length;Ye++){var xt=tt[Ye];if(xt.state.visible){var ht=xt.values.boundingSphere.ref.value;if(ht.radius){var ut=_.distance(L.center,ht.center);if((ut>L.radius||ut>ht.radius||ht.radius>C.state.radiusMax)&&!Be.includes(oe,ht))return!0;Be.overlaps(L,ht)&&(Me=!1)}}}return Me}var he=250;function we(Me){return x.needsCommit?(Be.copy(oe,x.boundingSphereVisible),x.commit(Me?void 0:he)?(D.debug.isEnabled&&D.debug.update(),!u.camera.manualReset&&(d.value===0||V())&&(H=!0),oe.radius===0&&(B=0),C.setState({radiusMax:x.boundingSphere.radius},0),d.next(l.size),kr&&Te(),!0):!1):!0}function Te(){console.table(x.renderables.map(function(ht){return{drawCount:ht.values.drawCount.ref.value,instanceCount:ht.values.instanceCount.ref.value,materialId:ht.materialId,renderItemId:ht.id}})),console.log(i.stats);var Me=i.resources.getByteCounts(),Ye=Me.texture,tt=Me.attribute,xt=Me.elements;console.log({texture:(Ye/1024/1024).toFixed(3)+" MiB",attribute:(tt/1024/1024).toFixed(3)+" MiB",elements:(xt/1024/1024).toFixed(3)+" MiB"})}function ze(Me){Xe(Me);var Ye=l.get(Me),tt=new Set;Me.renderObjects.forEach(function(xt){return tt.add(xt)}),Ye?hi.areEqual(tt,Ye)||(tt.forEach(function(xt){Ye.has(xt)||x.add(xt)}),Ye.forEach(function(xt){tt.has(xt)||x.remove(xt)})):Me.renderObjects.forEach(function(xt){return x.add(xt)}),l.set(Me,tt),x.update(Me.renderObjects,!1),W=!0,kr&&Te()}function Ve(Me){ct(Me);var Ye=l.get(Me);Ye&&(Ye.forEach(function(tt){return x.remove(tt)}),l.delete(Me),W=!0,kr&&Te())}function Xe(Me){c.has(Me)||c.set(Me,Me.updated.subscribe(function(Ye){Me.state.syncManually||ze(Me)}))}function ct(Me){var Ye=c.get(Me);Ye&&(Ye.unsubscribe(),c.delete(Me))}function Ne(){var Me=x.boundingSphere.radius>0?100-Math.round(C.transition.target.radius/x.boundingSphere.radius*100):0;return{camera:{mode:C.state.mode,helper:E({},D.camera.props),stereo:E({},u.camera.stereo),manualReset:!!u.camera.manualReset},cameraFog:C.state.fog>0?{name:"on",params:{intensity:C.state.fog}}:{name:"off",params:{}},cameraClipping:{far:C.state.clipFar,radius:Me},cameraResetDurationMs:u.cameraResetDurationMs,transparentBackground:u.transparentBackground,viewport:u.viewport,postprocessing:E({},u.postprocessing),multiSample:E({},u.multiSample),renderer:E({},M.props),trackball:E({},A.props),debug:E({},D.debug.props),handle:E({},D.handle.props)}}var Qe=m.subscribe(function(){k.dirty=!0,z(!0),z(!0)}),it=new kf(0);function ot(Me){Me===void 0&&(Me=!0),o.updateSize(),dt(),ke(),Me&&J(!0),it.next(+new Date)}return{webgl:i,add:ze,remove:Ve,commit:Se,update:function(Me,Ye){if(Me){if(!l.has(Me))return;x.update(Me.renderObjects,!!Ye)}else x.update(void 0,!!Ye);W=!0},clear:function(){c.forEach(function(Me){return Me.unsubscribe()}),c.clear(),l.clear(),x.clear(),D.debug.clear(),J(!0),d.next(l.size)},syncVisibility:function(){C.state.radiusMax===0&&(H=!0,B=0),x.syncVisibility()&&D.debug.isEnabled&&D.debug.update(),J(!0)},requestDraw:J,tick:Z,animate:ye,resetTime:le,pause:be,resume:function(){U=!1},identify:Ae,mark:q,getLoci:$,handleResize:ot,requestResize:function(){Y=!0},requestCameraReset:function(Me){B=Me==null?void 0:Me.durationMs,j=Me==null?void 0:Me.snapshot,H=!0},camera:C,boundingSphere:x.boundingSphere,boundingSphereVisible:x.boundingSphereVisible,get notifyDidDraw(){return G},set notifyDidDraw(Me){G=Me},didDraw:p,commited:v,reprCount:d,resized:it,setProps:function(Me,Ye){var tt,xt,ht;Ye===void 0&&(Ye=!1);var ut=typeof Me=="function"?cv(Ne(),Me):Me,pe=Object.create(null);if(ut.camera&&ut.camera.mode!==void 0&&ut.camera.mode!==C.state.mode&&(pe.mode=ut.camera.mode),ut.cameraFog!==void 0&&ut.cameraFog.params){var me=ut.cameraFog.name==="on"?ut.cameraFog.params.intensity:0;me!==C.state.fog&&(pe.fog=me)}if(ut.cameraClipping!==void 0&&(ut.cameraClipping.far!==void 0&&ut.cameraClipping.far!==C.state.clipFar&&(pe.clipFar=ut.cameraClipping.far),ut.cameraClipping.radius!==void 0)){var Ee=x.boundingSphere.radius/100*(100-ut.cameraClipping.radius);Ee>0&&Ee!==pe.radius&&(pe.radius=Math.max(Ee,.01))}if(Object.keys(pe).length>0&&C.setState(pe),!((tt=ut.camera)===null||tt===void 0)&&tt.helper&&D.camera.setProps(ut.camera.helper),((xt=ut.camera)===null||xt===void 0?void 0:xt.manualReset)!==void 0&&(u.camera.manualReset=ut.camera.manualReset),((ht=ut.camera)===null||ht===void 0?void 0:ht.stereo)!==void 0&&Object.assign(u.camera.stereo,ut.camera.stereo),ut.cameraResetDurationMs!==void 0&&(u.cameraResetDurationMs=ut.cameraResetDurationMs),ut.transparentBackground!==void 0&&(u.transparentBackground=ut.transparentBackground),ut.viewport!==void 0){var Ke=u.viewport===ut.viewport||u.viewport.name===ut.viewport.name&&__(u.viewport.params,ut.viewport.params);Ke||(u.viewport=ut.viewport,dt(),ke())}ut.postprocessing&&Object.assign(u.postprocessing,ut.postprocessing),ut.multiSample&&Object.assign(u.multiSample,ut.multiSample),ut.renderer&&M.setProps(ut.renderer),ut.trackball&&A.setProps(ut.trackball),ut.debug&&D.debug.setProps(ut.debug),ut.handle&&D.handle.setProps(ut.handle),pe.mode==="orthographic"&&(u.camera.stereo.name="off"),Ye||J(!0)},getImagePass:function(Me){return Me===void 0&&(Me={}),new Net(i,M,x,C,D,o.draw.wboitEnabled,Me)},getRenderObjects:function(){var Me=[];return x.forEach(function(Ye,tt){return Me.push(tt)}),Me},get props(){return Ne()},get input(){return a},get stats(){return M.stats},get interaction(){return R.events},dispose:function(){Qe.unsubscribe(),x.clear(),D.debug.clear(),A.dispose(),M.dispose(),R.dispose()}};function dt(){var Me=g,Ye=y,tt=b,xt=S;u.viewport.name==="canvas"?(g=0,y=0,b=h.drawingBufferWidth,S=h.drawingBufferHeight):u.viewport.name==="static-frame"?(g=u.viewport.params.x*i.pixelRatio,S=u.viewport.params.height*i.pixelRatio,y=h.drawingBufferHeight-S-u.viewport.params.y*i.pixelRatio,b=u.viewport.params.width*i.pixelRatio):u.viewport.name==="relative-frame"&&(g=Math.round(u.viewport.params.x*h.drawingBufferWidth),S=Math.round(u.viewport.params.height*h.drawingBufferHeight),y=Math.round(h.drawingBufferHeight-S-u.viewport.params.y*h.drawingBufferHeight),b=Math.round(u.viewport.params.width*h.drawingBufferWidth)),(Me!==g||Ye!==y||tt!==b||xt!==S)&&(fe=!0)}function ke(){k.setViewport(g,y,b,S),M.setViewport(g,y,b,S),Xi.set(C.viewport,g,y,b,S),Xi.set(A.viewport,g,y,b,S)}}e.create=t})(gR||(gR={}));function Ket(e){Bne(e)}function Bne(e){_t.Canvas3D.ResetSettings.subscribe(e,function(){var t;(t=e.canvas3d)===null||t===void 0||t.setProps(mF),e.events.canvas3d.settingsUpdated.next()}),_t.Canvas3D.SetSettings.subscribe(e,function(t){var r;e.canvas3d&&((r=e.canvas3d)===null||r===void 0||r.setProps(t.settings),e.events.canvas3d.settingsUpdated.next())})}const Qet=Object.freeze(Object.defineProperty({__proto__:null,Canvas3DSetSettings:Bne,registerDefault:Ket},Symbol.toStringTag,{value:"Module"}));var tp=ku,Gh=hr.Trigger,Zet={hoverHighlightOnly:hr([Gh(0)],"Highlight","Hover element using ${triggers}"),hoverHighlightOnlyExtend:hr([Gh(0,tp.create({shift:!0}))],"Extend highlight","From selected to hovered element along polymer using ${triggers}")},Jet={bindings:I.Value(Zet,{isHidden:!0}),ignore:I.Value([],{isHidden:!0}),mark:I.Boolean(!0)},ett=Or.create({name:"representation-highlight-loci",category:"interaction",ctor:function(e){Fe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.lociMarkProvider=function(n,i){!r.ctx.canvas3d||!r.params.mark||r.ctx.canvas3d.mark(n,i)},r}return t.prototype.register=function(){var r=this;this.subscribeObservable(this.ctx.behaviors.interaction.hover,function(n){var i,a=n.current,o=n.buttons,s=n.modifiers;if(!(!r.ctx.canvas3d||r.ctx.isBusy)){if(((i=r.params.ignore)===null||i===void 0?void 0:i.indexOf(a.loci.kind))>=0){r.ctx.managers.interactivity.lociHighlights.highlightOnly({repr:a.repr,loci:Nr});return}var u=!1;hr.match(r.params.bindings.hoverHighlightOnly,o,s)&&(r.ctx.managers.interactivity.lociHighlights.highlightOnly({loci:a.loci}),u=!0),hr.match(r.params.bindings.hoverHighlightOnlyExtend,o,s)&&(r.ctx.managers.interactivity.lociHighlights.highlightOnlyExtend({loci:a.loci}),u=!0),u||r.ctx.managers.interactivity.lociHighlights.highlightOnly({repr:a.repr,loci:Nr})}}),this.ctx.managers.interactivity.lociHighlights.addProvider(this.lociMarkProvider)},t.prototype.unregister=function(){this.ctx.managers.interactivity.lociHighlights.removeProvider(this.lociMarkProvider)},t}(Or.Handler),params:function(){return Jet},display:{name:"Highlight Loci on Canvas"}}),ttt={clickSelect:hr.Empty,clickToggleExtend:hr([Gh(1,tp.create({shift:!0}))],"Toggle extended selection","${triggers} to extend selection along polymer"),clickSelectOnly:hr.Empty,clickToggle:hr([Gh(1,tp.create())],"Toggle selection","${triggers} on element"),clickDeselect:hr.Empty,clickDeselectAllOnEmpty:hr([Gh(1,tp.create())],"Deselect all","Click on nothing using ${triggers}")},rtt={bindings:I.Value(ttt,{isHidden:!0}),ignore:I.Value([],{isHidden:!0}),mark:I.Boolean(!0)},Une=Or.create({name:"representation-select-loci",category:"interaction",ctor:function(e){Fe(t,e);function t(r,n){var i=e.call(this,r,n)||this;return i.lociMarkProvider=function(a,o){!i.ctx.canvas3d||!i.params.mark||i.ctx.canvas3d.mark({loci:a.loci},o)},i.spine=new xb.Impl(r.state.data.cells),i}return t.prototype.applySelectMark=function(r,n){var i=this.ctx.state.data.cells.get(r);if(i&&ge.isRepresentation3D(i.obj)){this.spine.current=i;var a=this.spine.getRootOfType(ge.Molecule.Structure);if(a){n&&this.lociMarkProvider({loci:We.Loci(a.data)},tr.Deselect);var o=this.ctx.managers.structure.selection.getLoci(a.data);this.lociMarkProvider({loci:o},tr.Select)}}},t.prototype.register=function(){var r=this,n=function(o){return ar.isEmpty(o.loci)},i=function(o){return!ar.isEmpty(o.loci)},a=[["clickSelect",function(o){return r.ctx.managers.interactivity.lociSelects.select(o)},i],["clickToggle",function(o){return r.ctx.managers.interactivity.lociSelects.toggle(o)},i],["clickToggleExtend",function(o){return r.ctx.managers.interactivity.lociSelects.toggleExtend(o)},i],["clickSelectOnly",function(o){return r.ctx.managers.interactivity.lociSelects.selectOnly(o)},i],["clickDeselect",function(o){return r.ctx.managers.interactivity.lociSelects.deselect(o)},i],["clickDeselectAllOnEmpty",function(){return r.ctx.managers.interactivity.lociSelects.deselectAll()},n]];a.sort(function(o,s){var u=r.params.bindings[o[0]],l=r.params.bindings[s[0]],c=u.triggers.length===0?0:Nl(u.triggers.map(function(f){return tp.size(f.modifiers)})),d=l.triggers.length===0?0:Nl(l.triggers.map(function(f){return tp.size(f.modifiers)}));return d-c}),this.subscribeObservable(this.ctx.behaviors.interaction.click,function(o){var s,u=o.current,l=o.button,c=o.modifiers;if(!(!r.ctx.canvas3d||r.ctx.isBusy||!r.ctx.selectionMode)&&!(((s=r.params.ignore)===null||s===void 0?void 0:s.indexOf(u.loci.kind))>=0))for(var d=0,f=a;d<f.length;d++){var p=f[d],v=p[0],h=p[1],m=p[2];if(hr.match(r.params.bindings[v],l,c)&&(!m||m(u))){h(u);break}}}),this.ctx.managers.interactivity.lociSelects.addProvider(this.lociMarkProvider),this.subscribeObservable(this.ctx.state.events.object.created,function(o){var s=o.ref;return r.applySelectMark(s)}),this.subscribeObservable(this.ctx.state.events.object.updated,function(o){var s=o.ref,u=o.obj,l=o.oldObj,c=o.oldData,d=o.action,f=r.ctx.state.data.cells.get(s);if(f&&ge.Molecule.Structure.is(f.obj)){var p=u.data,v=d==="recreate"?l==null?void 0:l.data:d==="in-place"?c:void 0;if(v&&We.areEquivalent(p,v)&&We.areHierarchiesEqual(p,v))return;for(var h=r.ctx.state.data.select(ir.Generators.ofType(ge.Molecule.Structure.Representation3D,s)),m=0,g=h;m<g.length;m++){var y=g[m];r.applySelectMark(y.transform.ref,!0)}}})},t.prototype.unregister=function(){this.ctx.managers.interactivity.lociSelects.removeProvider(this.lociMarkProvider)},t}(Or.Handler),params:function(){return rtt},display:{name:"Select Loci on Canvas"}}),ntt=Or.create({name:"default-loci-label-provider",category:"interaction",ctor:function(){function e(t){this.ctx=t,this.f={label:function(r){var n=[];if(Re.is(r)&&r.elements.length===1){var i=r.elements[0].unit,a=Ze.create(r.structure,i,i.elements[0]),o=lt.entity.pdbx_description(a).join(", ");n.push(o)}return n.push(yp(r)),n.filter(function(s){return!!s}).join("</br>")},group:function(r){return r.toString().replace(/Model [0-9]+/g,"Models")},priority:100}}return e.prototype.register=function(){this.ctx.managers.lociLabels.addProvider(this.f)},e.prototype.unregister=function(){this.ctx.managers.lociLabels.removeProvider(this.f)},e}(),display:{name:"Provide Default Loci Label"}}),itt={clickFocus:hr([Gh(1,tp.create())],"Representation Focus","Click element using ${triggers}"),clickFocusAdd:hr([Gh(1,tp.create({shift:!0}))],"Representation Focus Add","Click element using ${triggers}"),clickFocusSelectMode:hr([],"Representation Focus","Click element using ${triggers}"),clickFocusAddSelectMode:hr([],"Representation Focus Add","Click element using ${triggers}")},att={bindings:I.Value(itt,{isHidden:!0})},rA=Or.create({name:"representation-focus-loci",category:"interaction",ctor:function(e){Fe(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.register=function(){var r=this;this.subscribeObservable(this.ctx.behaviors.interaction.click,function(n){var i,a=n.current,o=n.button,s=n.modifiers,u=r.params.bindings,l=u.clickFocus,c=u.clickFocusAdd,d=u.clickFocusSelectMode,f=u.clickFocusAddSelectMode,p=r.ctx.managers.interactivity.props.granularity;if(!(p!=="residue"&&p!=="element")){var v=r.ctx.selectionMode?d:l,h=hr.match(v,o,s),m=r.ctx.selectionMode?f:c,g=hr.match(m,o,s);if(!(!h&&!g)){var y=ar.normalize(a.loci,"residue"),b=r.ctx.managers.structure.focus.current;if(b&&ar.areEqual(b.loci,y))r.ctx.managers.structure.focus.clear();else if(h)r.ctx.managers.structure.focus.setFromLoci(y);else{r.ctx.managers.structure.focus.addFromLoci(y);var S=(i=r.ctx.managers.structure.focus.current)===null||i===void 0?void 0:i.loci;S&&r.ctx.managers.camera.focusLoci(S)}}}})},t}(Or.Handler),params:function(){return att},display:{name:"Representation Focus Loci on Canvas"}});const ott=Object.freeze(Object.defineProperty({__proto__:null,DefaultLociLabelProvider:ntt,FocusLoci:rA,HighlightLoci:ett,SelectLoci:Une},Symbol.toStringTag,{value:"Module"}));var py=ku,hy=hr.Trigger,stt={clickCenterFocus:hr([hy(1,py.create()),hy(2,py.create()),hy(1,py.create({control:!0}))],"Camera center and focus","Click element using ${triggers}"),clickCenterFocusSelectMode:hr([hy(2,py.create()),hy(1,py.create({control:!0}))],"Camera center and focus","Click element using ${triggers}")},utt={minRadius:I.Numeric(8,{min:1,max:50,step:1}),extraRadius:I.Numeric(4,{min:1,max:50,step:1},{description:"Value added to the bounding-sphere radius of the Loci"}),durationMs:I.Numeric(250,{min:0,max:1e3,step:1},{description:"Camera transition duration"}),bindings:I.Value(stt,{isHidden:!0})},ltt=Or.create({name:"camera-focus-loci",category:"interaction",ctor:function(e){Fe(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.register=function(){var r=this;this.subscribeObservable(this.ctx.behaviors.interaction.click,function(n){var i=n.current,a=n.button,o=n.modifiers;if(r.ctx.canvas3d){var s=r.ctx.selectionMode?r.params.bindings.clickCenterFocusSelectMode:r.params.bindings.clickCenterFocus;if(hr.match(s,a,o)){if(ar.isEmpty(i.loci)){_t.Camera.Reset(r.ctx,{});return}var u=ar.normalize(i.loci,r.ctx.managers.interactivity.props.granularity);r.ctx.managers.camera.focusLoci(u,r.params)}}})},t}(Or.Handler),params:function(){return utt},display:{name:"Camera Focus Loci on Canvas"}}),ctt=Or.create({name:"camera-axis-helper",category:"interaction",ctor:function(e){Fe(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.register=function(){var r=this,n=0,i=0;this.subscribeObservable(this.ctx.behaviors.interaction.click,function(a){var o=a.current;if(!(!r.ctx.canvas3d||!vR(o.loci))){var s=o.loci.elements[0].groupId;if(s===0){n=0,i=0;return}var u=r.ctx.canvas3d.camera,l,c;if(s>=1&&s<=3){n=0,i=0;var d=_.sub(_(),u.target,u.position),f=_.cross(_(),d,u.up);c=_(),c[s-1]=1,l=_.cross(_(),c,f),_.magnitude(l)===0&&(l=d)}else n===s?i=(i+1)%2:(n=s,i=0),s===4?(c=i?_.unitX:_.unitY,l=_.negUnitZ):s===5?(c=i?_.unitX:_.unitZ,l=_.negUnitY):(c=i?_.unitY:_.unitZ,l=_.negUnitX);r.ctx.canvas3d.requestCameraReset({snapshot:function(p,v){return v.getInvariantFocus(p.boundingSphereVisible.center,p.boundingSphereVisible.radius,c,l)}})}})},t}(Or.Handler),params:function(){return{}},display:{name:"Camera Axis Helper"}});const dtt=Object.freeze(Object.defineProperty({__proto__:null,CameraAxisHelper:ctt,FocusLoci:ltt},Symbol.toStringTag,{value:"Module"}));var ftt=Or.create({name:"structure-info-prop",category:"custom-props",display:{name:"Structure Info"},ctor:function(e){Fe(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return Object.defineProperty(t.prototype,"maxModelIndex",{get:function(){for(var r,n,i=-1,a=this.ctx.state.data.select(ir.Generators.rootsOfType(ge.Molecule.Model)),o=0,s=a;o<s.length;o++){var u=s[o],l=((r=u.obj)===null||r===void 0?void 0:r.data)&&$t.Index.get((n=u.obj)===null||n===void 0?void 0:n.data).value;l!==void 0&&l>i&&(i=l)}return i},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"maxStructureIndex",{get:function(){for(var r,n,i=-1,a=this.ctx.state.data.select(ir.Generators.rootsOfType(ge.Molecule.Structure)),o=0,s=a;o<s.length;o++){var u=s[o],l=((r=u.obj)===null||r===void 0?void 0:r.data)&&We.Index.get((n=u.obj)===null||n===void 0?void 0:n.data).value;l!==void 0&&l>i&&(i=l)}return i},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"asymIdOffset",{get:function(){for(var r,n=0,i=0,a=this.ctx.state.data.select(ir.Generators.rootsOfType(ge.Molecule.Model)),o=0,s=a;o<s.length;o++){var u=s[o],l=(r=u.obj)===null||r===void 0?void 0:r.data;if(l){var c=$t.AsymIdCount.get(l),d=$t.AsymIdOffset.get(l).value;c!==void 0&&d!==void 0&&(n=Math.max(n,d.auth+c.auth),i=Math.max(i,d.label+c.label))}}return{auth:n,label:i}},enumerable:!1,configurable:!0}),t.prototype.handleModel=function(r,n){if($t.Index.get(r).value===void 0){var i=n&&$t.Index.get(n).value,a=i??this.maxModelIndex+1;$t.Index.set(r,{value:a})}if($t.AsymIdOffset.get(r).value===void 0){var o=n&&$t.AsymIdOffset.get(n).value,a=o??E({},this.asymIdOffset);$t.AsymIdOffset.set(r,{value:a})}},t.prototype.handleStructure=function(r,n){if(r.parent===void 0&&We.Index.get(r).value===void 0){var i=n&&We.Index.get(n).value,a=i??this.maxStructureIndex+1;We.Index.set(r,{value:a})}},t.prototype.handle=function(r,n,i){if(ge.Molecule.Structure.is(n)){var a=this.ctx.state.data.tree.transforms.get(r);!a.transformer.definition.isDecorator&&n.data.parent===void 0&&this.handleStructure(n.data,i==null?void 0:i.data)}else if(ge.Molecule.Model.is(n)){var a=this.ctx.state.data.tree.transforms.get(r);a.transformer.definition.isDecorator||this.handleModel(n.data,i==null?void 0:i.data)}},t.prototype.register=function(){var r=this;this.ctx.customModelProperties.register($t.AsymIdOffset,!0),this.ctx.customModelProperties.register($t.Index,!0),this.ctx.customStructureProperties.register(We.Index,!0),this.subscribeObservable(this.ctx.state.data.events.object.created,function(n){r.handle(n.ref,n.obj)}),this.subscribeObservable(this.ctx.state.data.events.object.updated,function(n){r.handle(n.ref,n.obj,n.oldObj)})},t.prototype.unregister=function(){this.ctx.customModelProperties.unregister($t.AsymIdOffset.descriptor.name),this.ctx.customModelProperties.unregister($t.Index.descriptor.name),this.ctx.customStructureProperties.unregister(We.Index.descriptor.name)},t}(Or.Handler)}),Nf=[-1,1.76,1.87,1.65,1.5,1.4,1.85,1.8,1.6,1.4],jne={ALA:121,ARG:265,ASN:187,ASP:187,CYS:148,GLU:214,GLN:214,GLY:97,HIS:216,ILE:195,LEU:191,LYS:230,MET:203,PHE:228,PRO:154,SER:143,THR:163,TRP:264,TYR:255,VAL:165},ptt=121;function htt(e){var t=lt.residue.key,r=lt.atom,n=r.type_symbol,i=r.label_atom_id,a=r.label_comp_id,o=e.structure,s=e.atomRadiusType,u=e.serialResidueIndex,l=Ze.create(o),c=0,d=0,f=-1;l.structure=o;for(var p=0,v=0,h=o.units.length;p<h;++p){var m=o.units[p],g=m.elements;l.unit=m,c=-1;for(var y=0,b=g.length;y<b;++y){var S=g[y],x=v+y;l.element=S,d=t(l),c!==d&&++f,c=d;var C=n(l),w=Wg(C);if(Tb(w)){s[x]=0,u[x]=-1;continue}var A=i(l),M=PL(m,S);if(M===2||!e.nonPolymer&&!AL(M)){s[x]=0,u[x]=-1;continue}var D=a(l);if(e.traceOnly&&(A!=="CA"&&A!=="BB"||!jne[D])){s[x]=0,u[x]=f;continue}Gl(M)?s[x]=mtt(A,C):M===5?s[x]=vtt(A,C,D):s[x]=gF(C),u[x]=f}v+=g.length}}function vtt(e,t,r){switch(t){case"O":return 5;case"S":return 6;case"N":return e==="NZ"?4:3;case"C":switch(e){case"C":case"CE1":case"CE2":case"CE3":case"CH2":case"CZ":case"CZ2":case"CZ3":return 1;case"CA":case"CB":case"CE":case"CG1":case"CG2":return 2;default:switch(r){case"PHE":case"TRP":case"TYR":case"HIS":case"ASP":case"ASN":return 1;case"PRO":case"LYS":case"ARG":case"MET":case"ILE":case"LEU":return 2;case"GLU":case"GLN":return e==="CD"?1:2}}}return gF(t)}function mtt(e,t,r){switch(t){case"C":return 7;case"N":return 8;case"P":return 9;case"O":return 5}return gF(t)}function gF(e){var t=i2(e),r=Nf.indexOf(t);return r===-1&&(r=Nf.length,Nf[r]=t),r}var sH=5e3;function gtt(e,t){return ce(this,void 0,void 0,function(){var r,n;return de(this,function(i){switch(i.label){case 0:r=t.atomRadiusType,n=0,i.label=1;case 1:return n<r.length?e.shouldUpdate?[4,e.update({message:"Computing per residue surface accessibility...",current:n,max:r.length})]:[3,3]:[3,5];case 2:i.sent(),i.label=3;case 3:ytt(t,n,Math.min(n+sH,r.length)),i.label=4;case 4:return n+=sH,[3,1];case 5:return[2]}})})}function ytt(e,t,r){for(var n=e.structure,i=e.atomRadiusType,a=e.serialResidueIndex,o=e.area,s=e.spherePoints,u=e.scalingConstant,l=e.maxLookupRadius,c=e.probeSize,d=n.lookup3d,f=n.serialMapping,p=n.unitIndexMap,v=n.units,h=f.cumulativeUnitElementCount,m=f.elementIndices,g=f.unitIndices,y=t;y<r;++y){var b=Nf[i[y]];if(b!==Nf[0]){for(var S=v[g[y]],x=m[y],C=S.conformation.x(x),w=S.conformation.y(x),A=S.conformation.z(x),M=d.find(C,w,A,l),D=M.count,k=M.units,R=M.indices,O=M.squaredDistances,H=c+b,B=c+H,j=[],Y=0;Y<D;++Y){var G=k[Y],$=h[p.get(G.id)]+R[Y],q=m[$],ee=Nf[i[$]];if(!(S===G&&x===q||ee===Nf[0])){var fe=c+ee;if(O[Y]<(B+ee)*(B+ee)){var W=m[$];j[j.length]=[O[Y],(O[Y]+H*H-fe*fe)/(2*H),G.conformation.x(W)-C,G.conformation.y(W)-w,G.conformation.z(W)-A]}}}j.sort(function(oe,L){return oe[0]-L[0]});var X=0;e:for(var U=0;U<s.length;++U){for(var z=s[U],J=z[0],K=z[1],Z=z[2],te=0;te<j.length;++te){var le=j[te],ye=le[1],be=le[2],Ae=le[3],Se=le[4],ie=J*be+K*Ae+Z*Se;if(ie>ye)continue e}++X}o[a[y]]+=u*X*H*H}}}var zne={numberOfSpherePoints:I.Numeric(92,{min:12,max:360,step:1},{description:"Number of sphere points to sample per atom: 92 (original paper), 960 (BioJava), 3000 (EPPIC) - see Shrake A, Rupley JA: Environment and exposure to solvent of protein atoms. Lysozyme and insulin. J Mol Biol 1973."}),probeSize:I.Numeric(1.4,{min:.1,max:4,step:.01},{description:"Corresponds to the size of a water molecule: 1.4 (original paper), 1.5 (occassionally used)"}),nonPolymer:I.Boolean(!1,{description:"Include non-polymer atoms as occluders."}),traceOnly:I.Boolean(!1,{description:"Compute only using alpha-carbons, if true increase probeSize accordingly (e.g., 4 A). Considers only canonical amino acids."})},t0;(function(e){function t(l,c){var d=this;c===void 0&&(c={});var f=E(E({},I.getDefaultValues(zne)),c);return $e.create("Compute Accessible Surface Area",function(p){return ce(d,void 0,void 0,function(){return de(this,function(v){switch(v.label){case 0:return[4,r(p,l,f)];case 1:return[2,v.sent()]}})})})}e.compute=t;function r(l,c,d){return ce(this,void 0,void 0,function(){var f,p,v;return de(this,function(h){switch(h.label){case 0:return f=n(c,d),htt(f),[4,gtt(l,f)];case 1:return h.sent(),p=f.area,v=f.serialResidueIndex,[2,{area:p,serialResidueIndex:v}]}})})}function n(l,c){var d=l.elementCount,f=l.atomicResidueCount,p=c.probeSize,v=c.nonPolymer,h=c.traceOnly,m=c.numberOfSpherePoints;return{structure:l,probeSize:p,nonPolymer:v,traceOnly:h,spherePoints:i(m),scalingConstant:4*Math.PI/m,maxLookupRadius:2*c.probeSize+2*Nf[2],atomRadiusType:new Int8Array(d),serialResidueIndex:new Int32Array(d),area:new Float32Array(f)}}function i(l){for(var c=[],d=Math.PI*(3-Math.sqrt(5)),f=2/l,p=0;p<l;++p){var v=p*f-1+f/2,h=Math.sqrt(1-v*v),m=p*d;c[c.length]=_.create(Math.cos(m)*h,v,Math.sin(m)*h)}return c}function a(l,c){var d=jne[l]||ptt;return c/d}e.normalize=a;function o(l,c){var d=c.area,f=c.serialResidueIndex,p=f[Je.indexOf(Je.ofSortedArray(l.structure.root.serialMapping.elementIndices),l.element)];return p===-1?-1:d[p]}e.getValue=o;function s(l,c){var d=o(l,c);return d===-1?-1:a(lt.atom.label_comp_id(l),d)}e.getNormalizedValue=s;function u(l,c){var d=s(l,c);return d===-1?0:d<.16?1:2}e.getFlag=u})(t0||(t0={}));var wT=E({},zne),yF={isBuried:Kg.Dynamic(DU("computed","accessible-surface-area.is-buried",De.Bool),function(e){if(!je.isAtomic(e.element.unit))return!1;var t=Us.get(e.element.structure).value;return t?t0.getFlag(e.element,t)===1:!1}),isAccessible:Kg.Dynamic(DU("computed","accessible-surface-area.is-accessible",De.Bool),function(e){if(!je.isAtomic(e.element.unit))return!1;var t=Us.get(e.element.structure).value;return t?t0.getFlag(e.element,t)===2:!1})},Us=hp.createProvider({label:"Accessible Surface Area",descriptor:To({name:"molstar_accessible_surface_area",symbols:yF}),type:"root",defaultParams:wT,getParams:function(e){return wT},isApplicable:function(e){return!0},obtain:function(e,t,r){return ce(void 0,void 0,void 0,function(){var n,i;return de(this,function(a){switch(a.label){case 0:return n=E(E({},I.getDefaultValues(wT)),r),i={},[4,t0.compute(t,n).runInContext(e.runtime)];case 1:return[2,(i.value=a.sent(),i)]}})})}}),ET=at(16448250),btt="Assigns a color based on the relative accessible surface area of a residue.",Vne={list:I.ColorList("rainbow",{presetKind:"scale"})};function xtt(e){return Vne}function Hne(e,t){var r,n=Bu.create({listOrName:t.list.colors,minLabel:"buried",maxLabel:"exposed",domain:[0,1]}),i=e.structure&&Us.get(e.structure),a=i?Dv(i.id,i.version):-1;if(i!=null&&i.value&&e.structure){var o=Ze.create(e.structure),s=i.value,u=function(l){var c=t0.getNormalizedValue(l,s);return c===-1?ET:n.color(c)};r=function(l){return Ze.is(l)&&je.isAtomic(l.unit)?u(l):Vt.isLocation(l)?(o.unit=l.aUnit,o.element=l.aUnit.elements[l.aIndex],u(o)):ET}}else r=function(){return ET};return{factory:Hne,granularity:"group",preferSmoothing:!0,color:r,props:t,contextHash:a,description:btt,legend:n?n.legend:void 0}}var uH={name:"accessible-surface-area",label:"Accessible Surface Area",category:"Residue Property",factory:Hne,getParams:xtt,defaultValues:I.getDefaultValues(Vne),isApplicable:function(e){return!!e.structure},ensureCustomProperties:{attach:function(e,t){return t.structure?Us.attach(e,t.structure,void 0,!0):Promise.resolve()},detach:function(e){return e.structure&&Us.ref(e.structure,!1)}}},Stt=Or.create({name:"computed-accessible-surface-area-prop",category:"custom-props",display:{name:"Accessible Surface Area"},ctor:function(e){Fe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.provider=Us,r.labelProvider={label:function(n){if(r.params.showTooltip)return Ctt(n)}},r}return t.prototype.update=function(r){var n=this.params.autoAttach!==r.autoAttach||this.params.showTooltip!==r.showTooltip;return this.params.autoAttach=r.autoAttach,this.params.showTooltip=r.showTooltip,this.ctx.customStructureProperties.setDefaultAutoAttach(this.provider.descriptor.name,this.params.autoAttach),n},t.prototype.register=function(){Z_.addCustomProp(this.provider.descriptor),this.ctx.customStructureProperties.register(this.provider,this.params.autoAttach),this.ctx.representation.structure.themes.colorThemeRegistry.add(uH),this.ctx.managers.lociLabels.addProvider(this.labelProvider),this.ctx.query.structure.registry.add(lH),this.ctx.query.structure.registry.add(cH)},t.prototype.unregister=function(){Z_.removeCustomProp(this.provider.descriptor),this.ctx.customStructureProperties.unregister(this.provider.descriptor.name),this.ctx.representation.structure.themes.colorThemeRegistry.remove(uH),this.ctx.managers.lociLabels.removeProvider(this.labelProvider),this.ctx.query.structure.registry.remove(lH),this.ctx.query.structure.registry.remove(cH)},t}(Or.Handler),params:function(){return{autoAttach:I.Boolean(!1),showTooltip:I.Boolean(!0)}}});function Ctt(e){if(e.kind==="element-loci"){if(e.elements.length===0)return;var t=Us.get(e.structure).value;if(!t||e.structure.customPropertyDescriptors.hasReference(Us.descriptor))return;for(var r=e.structure.root.serialMapping.getSerialIndex,n=t.area,i=t.serialResidueIndex,a=new Set,o=0,s=function(v,h){var m=h.elements;Le.forEach(v,function(g){var y=i[r(h,m[g])];y!==-1&&!a.has(y)&&(o+=n[y],a.add(y))})},u=0,l=e.elements;u<l.length;u++){var c=l[u],d=c.indices,f=c.unit;s(d,f)}if(a.size===0)return;var p="<small>("+a.size+" "+(a.size>1?"Residues sum":"Residue")+")</small>";return"Accessible Surface Area "+p+": "+o.toFixed(2)+" <sup>2</sup>"}else if(e.kind==="structure-loci"){var t=Us.get(e.structure).value;return!t||e.structure.customPropertyDescriptors.hasReference(Us.descriptor)?void 0:"Accessible Surface Area <small>(Whole Structure)</small>: "+y1(t.area).toFixed(2)+" <sup>2</sup>"}}var lH=Vr("Buried Protein Residues",se.struct.modifier.union([se.struct.modifier.wholeResidues([se.struct.modifier.union([se.struct.generator.atomGroups({"chain-test":se.core.rel.eq([se.ammp("objectPrimitive"),"atomistic"]),"residue-test":yF.isBuried.symbol()})])])]),{description:"Select buried protein residues.",category:zr.Residue,ensureCustomProperties:function(e,t){return Us.attach(e,t)}}),cH=Vr("Accessible Protein Residues",se.struct.modifier.union([se.struct.modifier.wholeResidues([se.struct.modifier.union([se.struct.generator.atomGroups({"chain-test":se.core.rel.eq([se.ammp("objectPrimitive"),"atomistic"]),"residue-test":yF.isAccessible.symbol()})])])]),{description:"Select accessible protein residues.",category:zr.Residue,ensureCustomProperties:function(e,t){return Us.attach(e,t)}}),_tt=Or.create({name:"computed-interactions-prop",category:"custom-props",display:{name:"Interactions"},ctor:function(e){Fe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.provider=Wn,r.labelProvider={label:function(n){if(r.params.showTooltip)switch(n.kind){case"element-loci":if(n.elements.length===0)return;for(var i=[],a=r.getStructures(n.structure),o=0,s=a;o<s.length;o++){var u=s[o],l=r.provider.get(u).value;if(l){var c=Re.remap(n,u);if(c.elements.length===1){var d=c.elements[0];if(Le.size(d.indices)===1){var f=l.unitsFeatures.get(d.unit.id);if(f){for(var p=[],v=[],h=[],m=Le.start(d.indices),g=f.types,y=f.groups,b=f.elementsIndex,S=b.indices,x=b.offsets,C=x[m],w=x[m+1];C<w;++C){var A=S[C],M=g[A],D=y[A];M&&p.push(kKe(M)),D&&v.push(OKe(D))}p.length&&h.push("<small>Types</small> "+p.join(", ")),v.length&&h.push("<small>Groups</small> "+v.join(", ")),h.length&&i.push("Interaction Feature: "+h.join(" | "))}}}}}return i.length?i.join("<br/>"):void 0;default:return}}},r}return t.prototype.getStructures=function(r){var n=[],i=this.ctx.helpers.substructureParent.get(r);if(i)for(var a=this.ctx.state.data,o=a.select(ir.Generators.ofType(ge.Molecule.Structure,i.transform.ref)),s=0,u=o;s<u.length;s++){var l=u[s];l.obj&&Fa(n,l.obj.data)}return n},t.prototype.update=function(r){var n=this.params.autoAttach!==r.autoAttach||this.params.showTooltip!==r.showTooltip;return this.params.autoAttach=r.autoAttach,this.params.showTooltip=r.showTooltip,this.ctx.customStructureProperties.setDefaultAutoAttach(this.provider.descriptor.name,this.params.autoAttach),n},t.prototype.register=function(){this.ctx.customStructureProperties.register(this.provider,this.params.autoAttach),this.ctx.representation.structure.themes.colorThemeRegistry.add(aR),this.ctx.managers.lociLabels.addProvider(this.labelProvider),this.ctx.representation.structure.registry.add(Cw)},t.prototype.unregister=function(){this.ctx.customStructureProperties.unregister(this.provider.descriptor.name),this.ctx.representation.structure.themes.colorThemeRegistry.remove(aR),this.ctx.managers.lociLabels.removeProvider(this.labelProvider),this.ctx.representation.structure.registry.remove(Cw)},t}(Or.Handler),params:function(){return{autoAttach:I.Boolean(!1),showTooltip:I.Boolean(!0)}}}),wtt=Or.create({name:"computed-secondary-structure-prop",category:"custom-props",display:{name:"Secondary Structure"},ctor:function(e){Fe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.provider=zl,r}return t.prototype.update=function(r){var n=this.params.autoAttach!==r.autoAttach;return this.params.autoAttach=r.autoAttach,this.ctx.customStructureProperties.setDefaultAutoAttach(this.provider.descriptor.name,this.params.autoAttach),n},t.prototype.register=function(){this.ctx.customStructureProperties.register(this.provider,this.params.autoAttach)},t.prototype.unregister=function(){this.ctx.customStructureProperties.unregister(this.provider.descriptor.name)},t}(Or.Handler),params:function(){return{autoAttach:I.Boolean(!1)}}}),Ett=Or.create({name:"computed-valence-model-prop",category:"custom-props",display:{name:"Valence Model"},ctor:function(e){Fe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.provider=h2,r.labelProvider={label:function(n){if(r.params.showTooltip)switch(n.kind){case"element-loci":if(n.elements.length===0)return;for(var i=[],a=r.getStructures(n.structure),o=0,s=a;o<s.length;o++){var u=s[o],l=r.provider.get(u).value;if(l){var c=Re.remap(n,u);if(c.elements.length===1){var d=c.elements[0];if(Le.size(d.indices)===1){var f=l.get(d.unit.id);if(f){var p=Le.start(d.indices),v=f.charge[p],h=f.idealGeometry[p],m=f.implicitH[p],g=f.totalH[p];i.push("Valence Model: <small>Charge</small> "+v+" | <small>Ideal Geometry</small> "+AKe(h)+" | <small>Implicit H</small> "+m+" | <small>Total H</small> "+g)}}}}}return i.length?i.join("<br/>"):void 0;default:return}}},r}return t.prototype.getStructures=function(r){var n=[],i=this.ctx.helpers.substructureParent.get(r);if(i)for(var a=this.ctx.state.data,o=a.select(ir.Generators.ofType(ge.Molecule.Structure,i.transform.ref)),s=0,u=o;s<u.length;s++){var l=u[s];l.obj&&Fa(n,l.obj.data)}return n},t.prototype.update=function(r){var n=this.params.autoAttach!==r.autoAttach||this.params.showTooltip!==r.showTooltip;return this.params.autoAttach=r.autoAttach,this.params.showTooltip=r.showTooltip,this.ctx.customStructureProperties.setDefaultAutoAttach(this.provider.descriptor.name,this.params.autoAttach),n},t.prototype.register=function(){this.ctx.customStructureProperties.register(this.provider,this.params.autoAttach),this.ctx.managers.lociLabels.addProvider(this.labelProvider)},t.prototype.unregister=function(){this.ctx.customStructureProperties.unregister(this.provider.descriptor.name),this.ctx.managers.lociLabels.removeProvider(this.labelProvider)},t}(Or.Handler),params:function(){return{autoAttach:I.Boolean(!1),showTooltip:I.Boolean(!0)}}}),Ou;(function(e){var t=this;e.Provider=mv.createProvider({label:"Best Database Sequence Mapping",descriptor:To({name:"molstar_best_database_sequence_mapping"}),type:"static",defaultParams:{},getParams:function(){return{}},isApplicable:function(a){var o,s;return an.is(a.sourceData)&&((s=(o=a.sourceData.data.frame.categories)===null||o===void 0?void 0:o.atom_site)===null||s===void 0?void 0:s.fieldNames.indexOf("db_name"))>=0},obtain:function(a,o){return ce(t,void 0,void 0,function(){return de(this,function(s){return[2,{value:i(o)}]})})}});function r(a){var o=a.unit.model,s=e.Provider.get(o).value;if(!s)return"";var u=a.unit.elements[a.element],l=o.atomicHierarchy.residueAtomSegments.offsets[u];return s.accession[l]}e.getKey=r;function n(a){var o=a.unit.model,s=e.Provider.get(o).value;if(s){var u=a.unit.elements[a.element],l=o.atomicHierarchy.residueAtomSegments.offsets[u],c=s.dbName[l];if(c)return c+" "+s.accession[l]+" "+s.num[l]+" "+s.residue[l]}}e.getLabel=n;function i(a){if(an.is(a.sourceData)){var o=a.sourceData.data.frame.categories.atom_site,s=o.getField("db_name"),u=o.getField("db_acc"),l=o.getField("db_num"),c=o.getField("db_res");if(!(!s||!u||!l||!c)){for(var d=a.atomicHierarchy.atomSourceIndex,f=a.atomicHierarchy.residueAtomSegments,p=f.count,v=f.offsets,h=new Array(p),m=new Array(p),g=new Array(p),y=new Array(p),b=0;b<p;b++){var S=d.value(v[b]);if(s.valueKind(S)!==0){h[S]="",m[S]="",g[S]=0,y[S]="";continue}h[S]=s.str(S),m[S]=u.str(S),g[S]=l.int(S),y[S]=c.str(S)}return{dbName:h,accession:m,num:g,residue:y}}}}})(Ou||(Ou={}));var AT=at(16448250),Att="Assigns a color based on best dababase sequence mapping.",vy=new Map,Gne=E({},vs({type:"colors",colorList:"set-1"}));function Ptt(e){return Gne}function qne(e,t){var r;if(e.structure){for(var n=0,i=e.structure.models;n<i.length;n++){var a=i[n],o=Ou.Provider.get(a).value;if(o)for(var s=0,u=o.accession;s<u.length;s++){var l=u[s];!l||vy.has(l)||vy.set(l,vy.size)}}var c=Ze.create(e.structure),d=ru(vy.size+1,t,{valueLabel:function(v){return""+v}}),f=new Map,p=function(v){var h=Ou.getKey(v);if(!h)return AT;if(f.has(h))return f.get(h);var m=d.color(vy.get(h));return f.set(h,m),m};r=function(v){return Ze.is(v)&&je.isAtomic(v.unit)?p(v):Vt.isLocation(v)?(c.unit=v.aUnit,c.element=v.aUnit.elements[v.aIndex],p(c)):AT}}else r=function(){return AT};return{factory:qne,granularity:"group",preferSmoothing:!0,color:r,props:t,description:Att}}var dH={name:"best-sequence-database-mapping",label:"Best Database Sequence Mapping",category:"Residue Property",factory:qne,getParams:Ptt,defaultValues:I.getDefaultValues(Gne),isApplicable:function(e){var t;return!!(!((t=e.structure)===null||t===void 0)&&t.models.some(function(r){return Ou.Provider.isApplicable(r)}))},ensureCustomProperties:{attach:function(e,t){return ce(void 0,void 0,void 0,function(){var r,n,i;return de(this,function(a){switch(a.label){case 0:if(!t.structure)return[2];r=0,n=t.structure.models,a.label=1;case 1:return r<n.length?(i=n[r],[4,Ou.Provider.attach(e,i,void 0,!0)]):[3,4];case 2:a.sent(),a.label=3;case 3:return r++,[3,1];case 4:return[2]}})})},detach:function(e){if(e.structure)for(var t=0,r=e.structure.models;t<r.length;t++){var n=r[t];Ou.Provider.ref(n,!1)}}}},Ttt=Or.create({name:"best-sequence-database-mapping-prop",category:"custom-props",display:{name:"Best Database Sequence Mapping"},ctor:function(e){Fe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.provider=Ou.Provider,r.labelProvider={label:function(n){if(r.params.showTooltip)return Itt(n)}},r}return t.prototype.update=function(r){var n=this.params.autoAttach!==r.autoAttach||this.params.showTooltip!==r.showTooltip;return this.params.autoAttach=r.autoAttach,this.params.showTooltip=r.showTooltip,this.ctx.customStructureProperties.setDefaultAutoAttach(this.provider.descriptor.name,this.params.autoAttach),n},t.prototype.register=function(){this.ctx.customModelProperties.register(this.provider,this.params.autoAttach),this.ctx.representation.structure.themes.colorThemeRegistry.add(dH),this.ctx.managers.lociLabels.addProvider(this.labelProvider)},t.prototype.unregister=function(){this.ctx.customModelProperties.unregister(this.provider.descriptor.name),this.ctx.representation.structure.themes.colorThemeRegistry.remove(dH),this.ctx.managers.lociLabels.removeProvider(this.labelProvider)},t}(Or.Handler),params:function(){return{autoAttach:I.Boolean(!0),showTooltip:I.Boolean(!0)}}});function Itt(e){if(e.kind==="element-loci"){if(e.elements.length===0)return;var t=e.elements[0],r=t.unit,n=Ze.create(e.structure,r,r.elements[Le.getAt(t.indices,0)]);return Ou.getLabel(n)}}var ud;(function(e){e.Descriptor={name:"ihm_cross_link_restraint"},e.Provider=zu.create(e.Descriptor);function t(r,n){var i={entity_id:r.entity_id_1,asym_id:r.asym_id_1,seq_id:r.seq_id_1,atom_id:r.atom_id_1},a={entity_id:r.entity_id_2,asym_id:r.asym_id_2,seq_id:r.seq_id_2,atom_id:r.atom_id_2};function o(v,h,m){var g=v.get(h);g?g.push(m):v.set(h,[m])}function s(v,h){var m=h.entity_id.value(v),g=h.asym_id.value(v),y=h.seq_id.value(v);if(r.model_granularity.value(v)==="by-atom"){var b=n.atomicHierarchy.index.findAtom({auth_seq_id:y,label_asym_id:g,label_atom_id:h.atom_id.value(v),label_entity_id:m});b>=0&&o(l,b,v)}else if(n.coarseHierarchy.isDefined){var S=n.coarseHierarchy.spheres.findSequenceKey(m,g,y);if(S>=0)o(c,S,v);else{var x=n.coarseHierarchy.gaussians.findSequenceKey(m,g,y);x>=0&&o(d,x,v)}}}function u(v){switch(v){case 0:return l;case 1:return c;case 2:return d}}for(var l=new Map,c=new Map,d=new Map,f=[],p=0;p<r._rowCount;++p)s(p,i),s(p,a);return{getIndicesByElement:function(v,h){var m=u(h),g=m.get(v);return g!==void 0?g:f},data:r}}e.fromTable=t})(ud||(ud={}));var Mtt=[];function fH(e,t,r,n){return e+"|"+t.id+"|"+r+"|"+n.id}var pH=function(){function e(t){this.pairs=t;var r=new Map;this.pairs.forEach(function(n,i){var a=fH(n.indexA,n.unitA,n.indexB,n.unitB),o=r.get(a);o?o.push(i):r.set(a,[i])}),this.count=t.length,this.pairKeyIndices=r}return e.prototype.getPairIndices=function(t,r,n,i){var a=fH(t,r,n,i);return this.pairKeyIndices.get(a)||Mtt},e.prototype.getPairs=function(t,r,n,i){var a=this,o=this.getPairIndices(t,r,n,i);return o.map(function(s){return a.pairs[s]})},e}(),ld=hp.createProvider({label:"Cross Link Restraint",descriptor:To({name:"integrative-cross-link-restraint"}),type:"local",defaultParams:{},getParams:function(e){return{}},isApplicable:function(e){return e.models.some(function(t){return!!ud.Provider.get(t)})},obtain:function(e,t,r){return ce(void 0,void 0,void 0,function(){return de(this,function(n){return[2,{value:ktt(t)}]})})}}),Lu;(function(e){(function(v){v.CrossLinkRestraint="cross-link-restraint"})(e.Tag||(e.Tag={}));function t(v){return v.models.some(function(h){return!!ud.Provider.get(h)})}e.isApplicable=t;var r=_(),n=_();function i(v){return v.unitA.conformation.position(v.unitA.elements[v.indexA],r),v.unitB.conformation.position(v.unitB.elements[v.indexB],n),_.distance(r,n)}e.distance=i;function a(v,h,m){return HZ("cross-link-restraints",{structure:h,crossLinkRestraints:v},m)}e.Location=a;function o(v){return!!v&&v.kind==="data-location"&&v.tag==="cross-link-restraints"}e.isLocation=o;function s(v,h){return v.data.structure===h.data.structure&&v.data.crossLinkRestraints===h.data.crossLinkRestraints&&v.element===h.element}e.areLocationsEqual=s;function u(v,h){var m=v.pairs[h];return"Cross Link Restraint | Type: "+m.restraintType+" | Threshold: "+m.distanceThreshold+"  | Psi: "+m.psi+" | Sigma 1: "+m.sigma1+" | Sigma 2: "+m.sigma2+" | Distance: "+i(m).toFixed(2)+" "}function l(v){return u(v.data.crossLinkRestraints,v.element)}e.locationLabel=l;function c(v,h,m){return UE("cross-link-restraints",{structure:v,crossLinkRestraints:h},m,function(g){return f(h,m,g)},function(){return p(v,h,m)})}e.Loci=c;function d(v){return!!v&&v.kind==="data-loci"&&v.tag==="interactions"}e.isLoci=d;function f(v,h,m){return rd.fromPairProvider(h.length,function(g,y,b){var S=v.pairs[h[g]];S.unitA.conformation.position(S.unitA.elements[S.indexA],y),S.unitB.conformation.position(S.unitB.elements[S.indexB],b)},m)}e.getBoundingSphere=f;function p(v,h,m){var g=m[0];if(g===void 0)return"";var y=h.pairs[g];return[u(h,g),JL(Vt.Location(v,y.unitA,y.indexA,v,y.unitB,y.indexB))].join("</br>")}e.getLabel=p})(Lu||(Lu={}));function hH(e,t,r){for(var n=t.elements,i=n.length,a=t.kind,o=function(u){var l=n[u];r.getIndicesByElement(l,a).forEach(function(c){return e.set(c,u)})},s=0;s<i;s++)o(s)}function Dtt(e,t,r){if(t.model===r.model&&t.model.sourceData.kind==="mmCIF"){var n=ud.Provider.get(t.model);if(n){var i=new Map,a=new Map;hH(i,t,n),hH(a,r,n),i.forEach(function(o,s){var u=a.get(s);u!==void 0&&e.push(Aw(t,o,r,u,n,s),Aw(r,u,t,o,n,s))})}}}function Rtt(e,t){if(t.model.sourceData.kind==="mmCIF"){var r=ud.Provider.get(t.model);if(r){for(var n=t.elements,i=n.length,a=t.kind,o=new Map,s=function(l){var c=n[l];r.getIndicesByElement(c,a).forEach(function(d){var f=o.get(d);f?f.push(l):o.set(d,[l])})},u=0;u<i;u++)s(u);o.forEach(function(l,c){if(!(l.length<2)){var d=l[0],f=l[1];e.push(Aw(t,d,t,f,r,c),Aw(t,f,t,d,r,c))}})}}}function Aw(e,t,r,n,i,a){return{unitA:e,indexA:t,unitB:r,indexB:n,restraintType:i.data.restraint_type.value(a),distanceThreshold:i.data.distance_threshold.value(a),psi:i.data.psi.value(a),sigma1:i.data.sigma_1.value(a),sigma2:i.data.sigma_2.value(a)}}function ktt(e){var t=[];if(!e.models.some(function(s){return ud.Provider.get(s)}))return new pH(t);for(var r=e.units.length,n=0;n<r;++n){var i=e.units[n];Rtt(t,i);for(var a=n+1;a<r;++a){var o=e.units[a];i.model===o.model&&Dtt(t,i,o)}}return new pH(t)}function Ott(e,t,r,n,i){var a=ld.get(t).value;if(!a.count)return Ft.createEmpty(i);var o=n.sizeFactor,s=Ze.create(t),u={linkCount:a.count,position:function(l,c,d){var f=a.pairs[d],p=f.unitA,v=f.unitB;p.conformation.position(p.elements[f.indexA],l),v.conformation.position(v.elements[f.indexB],c)},radius:function(l){var c=a.pairs[l];return s.unit=c.unitA,s.element=c.unitA.elements[c.indexA],r.size.size(s)*o}};return Gv(e,u,n,i)}var $ne=E(E(E({},p2),Hv),{sizeFactor:I.Numeric(.5,{min:0,max:10,step:.1})});function Ltt(e){return zv({defaultProps:I.getDefaultValues($ne),createGeometry:Ott,createLocationIterator:Ftt,getLoci:Ntt,eachLocation:Btt,setUpdateState:function(t,r,n){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.radialSegments!==n.radialSegments||r.linkCap!==n.linkCap}},e)}function Ftt(e){var t=ld.get(e).value,r=t.pairs,n=r.length,i=1,a=Lu.Location(t,e),o=function(s){return a.element=s,a};return Sn(n,i,1,o,!0)}function Ntt(e,t,r){var n=e.objectId,i=e.groupId;if(r===n){var a=ld.get(t).value,o=a.pairs[i];if(o)return Lu.Loci(t,a,[i])}return Nr}function Btt(e,t,r){var n=!1;if(Lu.isLoci(e)){if(!We.areEquivalent(e.data.structure,t))return!1;var i=ld.get(t).value;if(e.data.crossLinkRestraints!==i)return!1;for(var a=0,o=e.elements;a<o.length;a++){var s=o[a];r(Ie.ofSingleton(s))&&(n=!0)}}return n}var Utt={"cross-link-restraint":function(e,t){return Ru("Cross-link restraint",e,t,Ltt)}},Wne=E({},$ne);function jtt(e,t){return I.clone(Wne)}function ztt(e,t){return or.createMulti("CrossLinkRestraint",e,t,Ui,Utt)}var vH={name:Lu.Tag.CrossLinkRestraint,label:"Cross Link Restraint",description:"Displays cross-link restraints.",factory:ztt,getParams:jtt,defaultValues:I.getDefaultValues(Wne),defaultColorTheme:{name:Lu.Tag.CrossLinkRestraint},defaultSizeTheme:{name:"uniform"},isApplicable:function(e){return Lu.isApplicable(e)},ensureCustomProperties:{attach:function(e,t){return ld.attach(e,t,void 0,!0)},detach:function(e){return ld.ref(e,!1)}}},mH=at(13421772),Vtt="Colors cross-links by the deviation of the observed distance versus the modeled distance (e.g. modeled / `ihm_cross_link_restraint.distance_threshold`).",Xne={domain:I.Interval([.5,1.5],{step:.01}),list:I.ColorList("red-grey",{presetKind:"scale"})};function Htt(e){return Xne}function Yne(e,t){var r,n=void 0,i=e.structure&&ld.get(e.structure).value;if(i){n=Bu.create({domain:t.domain,listOrName:t.list.colors});var a=n.color;r=function(o){if(Lu.isLocation(o)){var s=i.pairs[o.element];if(s)return a(Lu.distance(s)/s.distanceThreshold)}return mH}}else r=function(){return mH};return{factory:Yne,granularity:"group",color:r,props:t,description:Vtt,legend:n?n.legend:void 0}}var gH={name:"cross-link",label:"Cross Link",category:"Miscellaneous",factory:Yne,getParams:Htt,defaultValues:I.getDefaultValues(Xne),isApplicable:function(e){return!!e.structure&&Lu.isApplicable(e.structure)},ensureCustomProperties:{attach:function(e,t){return t.structure?ld.attach(e,t.structure,void 0,!0):Promise.resolve()},detach:function(e){return e.structure&&ld.ref(e.structure,!1)}}},Gtt=Or.create({name:"integrative-cross-link-restraint",category:"custom-props",display:{name:"Cross Link Restraint"},ctor:function(e){Fe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.provider=ud.Provider,r}return t.prototype.register=function(){this.provider.formatRegistry.add("mmCIF",qtt),this.ctx.representation.structure.themes.colorThemeRegistry.add(gH),this.ctx.representation.structure.registry.add(vH)},t.prototype.unregister=function(){this.provider.formatRegistry.remove("mmCIF"),this.ctx.representation.structure.themes.colorThemeRegistry.remove(gH),this.ctx.representation.structure.registry.remove(vH)},t}(Or.Handler)});function qtt(e){if(an.is(e.sourceData)){var t=e.sourceData.data.db.ihm_cross_link_restraint;if(t._rowCount!==0)return ud.fromTable(t,e)}}const $tt=Object.freeze(Object.defineProperty({__proto__:null,AccessibleSurfaceArea:Stt,BestDatabaseSequenceMapping:Ttt,CrossLinkRestraint:Gtt,Interactions:_tt,SecondaryStructure:wtt,StructureInfo:ftt,ValenceModel:Ett},Symbol.toStringTag,{value:"Module"}));var Yx={State:JZe,Representation:tJe,Camera:nJe,Misc:Qet},Uo={Representation:ott,Camera:dtt,CustomProps:$tt},Wtt=function(e){var t=rt.Representation.StructureRepresentation3D.definition.params(void 0,e);return{expandRadius:I.Numeric(5,{min:1,max:10,step:1}),targetParams:I.Group(t,{label:"Target",customDefault:nC(e,void 0,{type:"ball-and-stick",size:"physical",typeParams:{sizeFactor:.26,alpha:.51}})}),surroundingsParams:I.Group(t,{label:"Surroundings",customDefault:nC(e,void 0,{type:"ball-and-stick",size:"physical",typeParams:{sizeFactor:.16}})}),nciParams:I.Group(t,{label:"Non-covalent Int.",customDefault:nC(e,void 0,{type:Cw,color:aR,size:Ki.BuiltIn.uniform})}),components:I.MultiSelect(yH,I.arrayToOptions(yH)),excludeTargetFromSurroundings:I.Boolean(!1,{label:"Exclude Target",description:'Exclude the focus "target" from the surroudings component.'}),ignoreHydrogens:I.Boolean(!1)}},yH=["target","surroundings","interactions"],cn;(function(e){e.TargetSel="structure-focus-target-sel",e.TargetRepr="structure-focus-target-repr",e.SurrSel="structure-focus-surr-sel",e.SurrRepr="structure-focus-surr-repr",e.SurrNciRepr="structure-focus-surr-nci-repr"})(cn||(cn={}));var Xtt=new Set([cn.TargetSel,cn.TargetRepr,cn.SurrSel,cn.SurrRepr,cn.SurrNciRepr]),Ytt=function(e){Fe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.currentSource=void 0,r}return Object.defineProperty(t.prototype,"surrLabel",{get:function(){return"[Focus] Surroundings ("+this.params.expandRadius+" )"},enumerable:!1,configurable:!0}),t.prototype.getReprParams=function(r){return E(E({},this.params.targetParams),{type:{name:r.type.name,params:E(E({},r.type.params),{ignoreHydrogens:this.params.ignoreHydrogens})}})},t.prototype.ensureShape=function(r){var n,i=this.plugin.state.data,a=i.tree,o=i.build(),s=ir.findUniqueTagsInSubtree(a,r.transform.ref,Xtt);s[cn.TargetSel]||(s[cn.TargetSel]=o.to(r).apply(rt.Model.StructureSelectionFromBundle,{bundle:rn.Empty,label:"[Focus] Target"},{tags:cn.TargetSel}).ref),s[cn.SurrSel]||(s[cn.SurrSel]=o.to(r).apply(rt.Model.StructureSelectionFromExpression,{expression:se.struct.generator.empty(),label:this.surrLabel},{tags:cn.SurrSel}).ref);var u=this.params.components;return u.indexOf("target")>=0&&!s[cn.TargetRepr]&&(s[cn.TargetRepr]=o.to(s[cn.TargetSel]).apply(rt.Representation.StructureRepresentation3D,this.getReprParams(this.params.targetParams),{tags:cn.TargetRepr}).ref),u.indexOf("surroundings")>=0&&!s[cn.SurrRepr]&&(s[cn.SurrRepr]=o.to(s[cn.SurrSel]).apply(rt.Representation.StructureRepresentation3D,this.getReprParams(this.params.surroundingsParams),{tags:cn.SurrRepr}).ref),u.indexOf("interactions")>=0&&!s[cn.SurrNciRepr]&&r.obj&&Cw.isApplicable((n=r.obj)===null||n===void 0?void 0:n.data)&&(s[cn.SurrNciRepr]=o.to(s[cn.SurrSel]).apply(rt.Representation.StructureRepresentation3D,this.params.nciParams,{tags:cn.SurrNciRepr}).ref),{state:i,builder:o,refs:s}},t.prototype.clear=function(r){var n=this.plugin.state.data;this.currentSource=void 0;var i=n.select(ir.Generators.byRef(r).subtree().withTag(cn.TargetSel)),a=n.select(ir.Generators.byRef(r).subtree().withTag(cn.SurrSel));if(!(i.length===0&&a.length===0)){for(var o=n.build(),s=rn.Empty,u=0,l=i;u<l.length;u++){var c=l[u];o.to(c).update(rt.Model.StructureSelectionFromBundle,function(h){return E(E({},h),{bundle:s})})}for(var d=se.struct.generator.empty(),f=0,p=a;f<p.length;f++){var v=p[f];o.to(v).update(rt.Model.StructureSelectionFromExpression,function(h){return E(E({},h),{expression:d})})}return _t.State.Update(this.plugin,{state:n,tree:o,options:{doNotLogTiming:!0,doNotUpdateCurrent:!0}})}},t.prototype.focus=function(r){return ce(this,void 0,void 0,function(){var n,i,a,o,s,u,l,c,d,f,p=this;return de(this,function(v){switch(v.label){case 0:return n=this.plugin.helpers.substructureParent.get(r.structure),!n||!n.obj?[2]:(this.currentSource=r,i=Re.remap(r,n.obj.data),a=Re.extendToWholeResidues(i),o=rn.fromLoci(a),s=rn.toExpression(o),u=se.struct.modifier.includeSurroundings({0:s,radius:this.params.expandRadius,"as-whole-residues":!0}),this.params.excludeTargetFromSurroundings&&(u=se.struct.modifier.exceptBy({0:u,by:s})),l=this.ensureShape(n),c=l.state,d=l.builder,f=l.refs,d.to(f[cn.TargetSel]).update(rt.Model.StructureSelectionFromBundle,function(h){return E(E({},h),{bundle:o})}),d.to(f[cn.SurrSel]).update(rt.Model.StructureSelectionFromExpression,function(h){return E(E({},h),{expression:u,label:p.surrLabel})}),[4,_t.State.Update(this.plugin,{state:c,tree:d,options:{doNotLogTiming:!0,doNotUpdateCurrent:!0}})]);case 1:return v.sent(),[2]}})})},t.prototype.register=function(r){var n=this;this.subscribeObservable(this.plugin.managers.structure.focus.behaviors.current,function(i){i?n.focus(i.loci):n.clear(cr.RootRef)})},t.prototype.update=function(r){return ce(this,void 0,void 0,function(){var n,i,a,o,s,u,l,c,h,d,f,h,p,v,h;return de(this,function(m){switch(m.label){case 0:if(n=this.params,this.params=r,n.excludeTargetFromSurroundings!==r.excludeTargetFromSurroundings)return this.currentSource&&this.focus(this.currentSource),[2,!0];for(i=this.plugin.state.data,a=i.build(),o=ir.Generators.root.subtree(),s=this.params.components,u=s.indexOf("target")>=0,l=0,c=i.select(o.withTag(cn.TargetRepr));l<c.length;l++)h=c[l],u?a.to(h).update(this.getReprParams(this.params.targetParams)):a.delete(h.transform.ref);for(u=s.indexOf("surroundings")>=0,d=0,f=i.select(o.withTag(cn.SurrRepr));d<f.length;d++)h=f[d],u?a.to(h).update(this.getReprParams(this.params.surroundingsParams)):a.delete(h.transform.ref);for(u=s.indexOf("interactions")>=0,p=0,v=i.select(o.withTag(cn.SurrNciRepr));p<v.length;p++)h=v[p],u?a.to(h).update(this.params.nciParams):a.delete(h.transform.ref);return[4,_t.State.Update(this.plugin,{state:i,tree:a,options:{doNotLogTiming:!0,doNotUpdateCurrent:!0}})];case 1:return m.sent(),r.expandRadius!==n.expandRadius?(this.currentSource&&this.focus(this.currentSource),[2,!0]):[2,!0]}})})},t}(Or.WithSubscribers),bF=Or.create({name:"create-structure-focus-representation",display:{name:"Structure Focus Representation"},category:"interaction",ctor:Ytt,params:function(e,t){return Wtt(t)}});function ao(e){return e}(function(e){e.CommonParams={ignoreHydrogens:I.Optional(I.Boolean(!1)),quality:I.Optional(I.Select("auto",_L)),theme:I.Optional(I.Group({globalName:I.Optional(I.Text("")),carbonColor:I.Optional(I.Select("chain-id",I.arrayToOptions(["chain-id","operator-name","element-symbol"]))),symmetryColor:I.Optional(I.Text("")),focus:I.Optional(I.Group({name:I.Optional(I.Text("")),params:I.Optional(I.Value({}))}))}))};function t(a){return a==="chain-id"?{name:a,params:pte.defaultValues}:a==="operator-name"?{name:a,params:QL.defaultValues}:{name:a,params:{}}}function r(a){return a.units.some(function(o){return!o.conformation.operator.assembly&&o.conformation.operator.spgrOp>=0})}function n(a,o,s){var u,l,c,d,f,p,v=a.state.data.build(),h=a.builders.structure.representation,m={quality:a.managers.structure.component.state.options.visualQuality,ignoreHydrogens:!a.managers.structure.component.state.options.showHydrogens};o.quality&&o.quality!=="auto"&&(m.quality=o.quality),o.ignoreHydrogens!==void 0&&(m.ignoreHydrogens=!!o.ignoreHydrogens);var g=!((u=o.theme)===null||u===void 0)&&u.globalName?(l=o.theme)===null||l===void 0?void 0:l.globalName:void 0,y=((c=o.theme)===null||c===void 0?void 0:c.carbonColor)!==void 0?{carbonColor:t((d=o.theme)===null||d===void 0?void 0:d.carbonColor)}:{},b=s&&(!((f=o.theme)===null||f===void 0)&&f.symmetryColor)&&r(s)?(p=o.theme)===null||p===void 0?void 0:p.symmetryColor:g;return{update:v,builder:h,color:g,symmetryColor:b,typeParams:m,ballAndStickColor:y}}e.reprBuilder=n;function i(a,o,s,u){return a.state.updateBehavior(bF,function(l){var c=oR(a,o,"ball-and-stick",s||"element-symbol",u);l.surroundingsParams.colorTheme=c,l.targetParams.colorTheme=c})}e.updateFocusRepr=i})(ao||(ao={}));var R0=ao.CommonParams,m2=ao.reprBuilder,nA=ao.updateFocusRepr,Ktt=ao({id:"preset-structure-representation-auto",display:{name:"Automatic",description:"Show representations based on the size of the structure. Smaller structures are shown with more detail than larger ones, ranging from atomistic display to coarse surfaces."},params:function(){return R0},apply:function(e,t,r){var n,i,a=(i=(n=Fi.resolveAndCheck(r.state.data,e))===null||n===void 0?void 0:n.obj)===null||i===void 0?void 0:i.data;if(!a)return{};var o=r.config.get(Yr.Structure.SizeThresholds)||We.DefaultSizeThresholds,s=We.getSize(a,o),u=a.polymerResidueCount/a.polymerGapCount;switch(s){case We.Size.Gigantic:case We.Size.Huge:return Qne.apply(e,t,r);case We.Size.Large:return Zne.apply(e,t,r);case We.Size.Medium:if(u>3)return Kne.apply(e,t,r);case We.Size.Small:return Jne.apply(e,E(E({},t),{showCarbohydrateSymbol:!0}),r);default:YD()}}}),Qtt=ao({id:"preset-structure-representation-empty",display:{name:"Empty",description:"Removes all existing representations."},apply:function(e,t,r){return ce(this,void 0,void 0,function(){return de(this,function(n){return[2,{}]})})}}),g2="Basic",Kne=ao({id:"preset-structure-representation-polymer-and-ligand",display:{name:"Polymer & Ligand",group:g2,description:"Shows polymers as Cartoon, ligands as Ball & Stick, carbohydrates as 3D-SNFG and water molecules semi-transparent."},params:function(){return R0},apply:function(e,t,r){var n,i,a,o,s,u,l,c,d,f;return ce(this,void 0,void 0,function(){var p,v,h,m,g,y,b,S,x,C,w,A,M,D,k;return de(this,function(R){switch(R.label){case 0:return p=Fi.resolveAndCheck(r.state.data,e),p?(k={},[4,Vo(r,p,"polymer")]):[2,{}];case 1:return k.polymer=R.sent(),[4,Vo(r,p,"ligand")];case 2:return k.ligand=R.sent(),[4,Vo(r,p,"non-standard")];case 3:return k.nonStandard=R.sent(),[4,Vo(r,p,"branched",{label:"Carbohydrate"})];case 4:return k.branched=R.sent(),[4,Vo(r,p,"water")];case 5:return k.water=R.sent(),[4,Vo(r,p,"ion")];case 6:return k.ion=R.sent(),[4,Vo(r,p,"lipid")];case 7:return k.lipid=R.sent(),[4,Vo(r,p,"coarse")];case 8:return v=(k.coarse=R.sent(),k),h=p.obj.data,m={sizeFactor:h.isCoarseGrained?.8:.2},g=(((a=(i=(n=v.water)===null||n===void 0?void 0:n.obj)===null||i===void 0?void 0:i.data)===null||a===void 0?void 0:a.elementCount)||0)>5e4?"line":"ball-and-stick",y=(((u=(s=(o=v.lipid)===null||o===void 0?void 0:o.obj)===null||s===void 0?void 0:s.data)===null||u===void 0?void 0:u.elementCount)||0)>2e4?"line":"ball-and-stick",b=m2(r,t,h),S=b.update,x=b.builder,C=b.typeParams,w=b.color,A=b.symmetryColor,M=b.ballAndStickColor,D={polymer:x.buildRepresentation(S,v.polymer,{type:"cartoon",typeParams:E(E({},C),m),color:A},{tag:"polymer"}),ligand:x.buildRepresentation(S,v.ligand,{type:"ball-and-stick",typeParams:C,color:w,colorParams:M},{tag:"ligand"}),nonStandard:x.buildRepresentation(S,v.nonStandard,{type:"ball-and-stick",typeParams:C,color:w,colorParams:M},{tag:"non-standard"}),branchedBallAndStick:x.buildRepresentation(S,v.branched,{type:"ball-and-stick",typeParams:E(E({},C),{alpha:.3}),color:w,colorParams:M},{tag:"branched-ball-and-stick"}),branchedSnfg3d:x.buildRepresentation(S,v.branched,{type:"carbohydrate",typeParams:C,color:w},{tag:"branched-snfg-3d"}),water:x.buildRepresentation(S,v.water,{type:g,typeParams:E(E({},C),{alpha:.6}),color:w,colorParams:{carbonColor:{name:"element-symbol",params:{}}}},{tag:"water"}),ion:x.buildRepresentation(S,v.ion,{type:"ball-and-stick",typeParams:C,color:w,colorParams:{carbonColor:{name:"element-symbol",params:{}}}},{tag:"ion"}),lipid:x.buildRepresentation(S,v.lipid,{type:y,typeParams:E(E({},C),{alpha:.6}),color:w,colorParams:{carbonColor:{name:"element-symbol",params:{}}}},{tag:"lipid"}),coarse:x.buildRepresentation(S,v.coarse,{type:"spacefill",typeParams:C,color:w||"chain-id"},{tag:"coarse"})},[4,S.commit({revertOnError:!1})];case 9:return R.sent(),[4,nA(r,h,(c=(l=t.theme)===null||l===void 0?void 0:l.focus)===null||c===void 0?void 0:c.name,(f=(d=t.theme)===null||d===void 0?void 0:d.focus)===null||f===void 0?void 0:f.params)];case 10:return R.sent(),[2,{components:v,representations:D}]}})})}}),Ztt=ao({id:"preset-structure-representation-protein-and-nucleic",display:{name:"Protein & Nucleic",group:g2,description:"Shows proteins as Cartoon and RNA/DNA as Gaussian Surface."},params:function(){return R0},apply:function(e,t,r){var n,i,a,o;return ce(this,void 0,void 0,function(){var s,u,l,c,d,f,p,v,h,m,g,y;return de(this,function(b){switch(b.label){case 0:return s=Fi.resolveAndCheck(r.state.data,e),s?(y={},[4,bH(r,s,"protein")]):[2,{}];case 1:return y.protein=b.sent(),[4,bH(r,s,"nucleic")];case 2:return u=(y.nucleic=b.sent(),y),l=s.obj.data,c={sizeFactor:l.isCoarseGrained?.8:.2},d={radiusOffset:l.isCoarseGrained?2:0,smoothness:l.isCoarseGrained?1:1.5},f=m2(r,t,l),p=f.update,v=f.builder,h=f.typeParams,m=f.symmetryColor,g={protein:v.buildRepresentation(p,u.protein,{type:"cartoon",typeParams:E(E({},h),c),color:m},{tag:"protein"}),nucleic:v.buildRepresentation(p,u.nucleic,{type:"gaussian-surface",typeParams:E(E({},h),d),color:m},{tag:"nucleic"})},[4,p.commit({revertOnError:!0})];case 3:return b.sent(),[4,nA(r,l,(i=(n=t.theme)===null||n===void 0?void 0:n.focus)===null||i===void 0?void 0:i.name,(o=(a=t.theme)===null||a===void 0?void 0:a.focus)===null||o===void 0?void 0:o.params)];case 4:return b.sent(),[2,{components:u,representations:g}]}})})}}),Qne=ao({id:"preset-structure-representation-coarse-surface",display:{name:"Coarse Surface",group:g2,description:"Shows polymers and lipids as coarse Gaussian Surface."},params:function(){return R0},apply:function(e,t,r){var n,i,a,o;return ce(this,void 0,void 0,function(){var s,u,l,c,d,f,p,v,h,m,g,y;return de(this,function(b){switch(b.label){case 0:return s=Fi.resolveAndCheck(r.state.data,e),s?(y={},[4,Vo(r,s,"polymer")]):[2,{}];case 1:return y.polymer=b.sent(),[4,Vo(r,s,"lipid")];case 2:return u=(y.lipid=b.sent(),y),l=s.obj.data,c=We.getSize(l),d=Object.create(null),c===We.Size.Gigantic?Object.assign(d,{traceOnly:!l.isCoarseGrained,radiusOffset:2,smoothness:1,visuals:["structure-gaussian-surface-mesh"]}):c===We.Size.Huge?Object.assign(d,{radiusOffset:l.isCoarseGrained?2:0,smoothness:1}):l.isCoarseGrained&&Object.assign(d,{radiusOffset:2,smoothness:1}),f=m2(r,t,l),p=f.update,v=f.builder,h=f.typeParams,m=f.symmetryColor,g={polymer:v.buildRepresentation(p,u.polymer,{type:"gaussian-surface",typeParams:E(E({},h),d),color:m},{tag:"polymer"}),lipid:v.buildRepresentation(p,u.lipid,{type:"gaussian-surface",typeParams:E(E({},h),d),color:m},{tag:"lipid"})},[4,p.commit({revertOnError:!0})];case 3:return b.sent(),[4,nA(r,l,(i=(n=t.theme)===null||n===void 0?void 0:n.focus)===null||i===void 0?void 0:i.name,(o=(a=t.theme)===null||a===void 0?void 0:a.focus)===null||o===void 0?void 0:o.params)];case 4:return b.sent(),[2,{components:u,representations:g}]}})})}}),Zne=ao({id:"preset-structure-representation-polymer-cartoon",display:{name:"Polymer Cartoon",group:g2,description:"Shows polymers as Cartoon."},params:function(){return R0},apply:function(e,t,r){var n,i,a,o;return ce(this,void 0,void 0,function(){var s,u,l,c,d,f,p,v,h,m,g;return de(this,function(y){switch(y.label){case 0:return s=Fi.resolveAndCheck(r.state.data,e),s?(g={},[4,Vo(r,s,"polymer")]):[2,{}];case 1:return u=(g.polymer=y.sent(),g),l=s.obj.data,c={sizeFactor:l.isCoarseGrained?.8:.2},d=m2(r,t,l),f=d.update,p=d.builder,v=d.typeParams,h=d.symmetryColor,m={polymer:p.buildRepresentation(f,u.polymer,{type:"cartoon",typeParams:E(E({},v),c),color:h},{tag:"polymer"})},[4,f.commit({revertOnError:!0})];case 2:return y.sent(),[4,nA(r,l,(i=(n=t.theme)===null||n===void 0?void 0:n.focus)===null||i===void 0?void 0:i.name,(o=(a=t.theme)===null||a===void 0?void 0:a.focus)===null||o===void 0?void 0:o.params)];case 3:return y.sent(),[2,{components:u,representations:m}]}})})}}),Jne=ao({id:"preset-structure-representation-atomic-detail",display:{name:"Atomic Detail",group:g2,description:"Shows everything in atomic detail with Ball & Stick."},params:function(){return E(E({},R0),{showCarbohydrateSymbol:I.Boolean(!1)})},apply:function(e,t,r){return ce(this,void 0,void 0,function(){var n,i,a,o,s,u,l,c,d,f,p,v,h,m,g,y,b,S,x,C,w,A;return de(this,function(M){switch(M.label){case 0:return n=Fi.resolveAndCheck(r.state.data,e),n?(w={},[4,Vo(r,n,"all")]):[2,{}];case 1:return i=(w.all=M.sent(),w.branched=void 0,w),a=n.obj.data,o=a.elementCount>1e5,s=a.atomicResidueCount&&a.elementCount>1e3&&a.atomicResidueCount/a.elementCount<3,u=a.models[0],l=!!xa.Provider.get(u)||jl.isExhaustive(u),c="ball-and-stick",a.isCoarseGrained?c=a.elementCount>1e6?"point":"spacefill":s&&!l?c="spacefill":o&&(c="line"),d=t.showCarbohydrateSymbol&&!o&&!s,d?(p=(f=Object).assign,v=[i],A={},[4,Vo(r,n,"branched",{label:"Carbohydrate"})]):[3,3];case 2:p.apply(f,v.concat([(A.branched=M.sent(),A)])),M.label=3;case 3:return h=m2(r,t,a),m=h.update,g=h.builder,y=h.typeParams,b=h.color,S=h.ballAndStickColor,x=s&&!l?{carbonColor:{name:"element-symbol",params:{}}}:S,C={all:g.buildRepresentation(m,i.all,{type:c,typeParams:y,color:b,colorParams:x},{tag:"all"})},d&&Object.assign(C,{snfg3d:g.buildRepresentation(m,i.branched,{type:"carbohydrate",typeParams:E(E({},y),{alpha:.4,visuals:["carbohydrate-symbol"]}),color:b},{tag:"snfg-3d"})}),[4,m.commit({revertOnError:!0})];case 4:return M.sent(),[2,{components:i,representations:C}]}})})}});function Vo(e,t,r,n){return e.builders.structure.tryCreateComponentStatic(t,r,n)}function bH(e,t,r,n){return e.builders.structure.tryCreateComponentFromSelection(t,mi[r],"selection-"+r,n)}var xg={empty:Qtt,auto:Ktt,"atomic-detail":Jne,"polymer-cartoon":Zne,"polymer-and-ligand":Kne,"protein-and-nucleic":Ztt,"coarse-surface":Qne};function xF(e,t){if(e.ext==="bcif")try{if(bJ(t).encoder.startsWith("VolumeServer"))return"dscif"}catch{}else if(e.ext==="cif"){var r=t;if(r.startsWith(`data_SERVER
#
_density_server_result`))return"dscif";if(r.includes("atom_site_fract_x")||r.includes("atom_site.fract_x"))return"coreCif"}return-1}var Od="Trajectory";function Ld(e,t){return e.builders.structure.hierarchy.applyPreset(t.trajectory,"default")}var Jtt={label:"mmCIF",description:"mmCIF",category:Od,stringExtensions:["cif","mmcif","mcif"],binaryExtensions:["bcif"],isApplicable:function(e,t){return e.ext==="mmcif"||e.ext==="mcif"?!0:e.ext==="cif"||e.ext==="bcif"?xF(e,t)===-1:!1},parse:function(e,t,r){return ce(void 0,void 0,void 0,function(){var n,i,a,o,s;return de(this,function(u){switch(u.label){case 0:return n=e.state.data,i=n.build().to(t).apply(rt.Data.ParseCif,void 0,{state:{isGhost:!0}}),[4,i.apply(rt.Model.TrajectoryFromMmCif,void 0,{tags:r==null?void 0:r.trajectoryTags}).commit({revertOnError:!0})];case 1:return a=u.sent(),(((s=(o=i.selector.cell)===null||o===void 0?void 0:o.obj)===null||s===void 0?void 0:s.data.blocks.length)||0)>1&&e.state.data.updateCellState(i.ref,{isGhost:!1}),[2,{trajectory:a}]}})})},visuals:Ld},ert={label:"cifCore",description:"CIF Core",category:Od,stringExtensions:["cif"],isApplicable:function(e,t){return e.ext==="cif"?xF(e,t)==="coreCif":!1},parse:function(e,t,r){return ce(void 0,void 0,void 0,function(){var n,i,a,o,s;return de(this,function(u){switch(u.label){case 0:return n=e.state.data,i=n.build().to(t).apply(rt.Data.ParseCif,void 0,{state:{isGhost:!0}}),[4,i.apply(rt.Model.TrajectoryFromCifCore,void 0,{tags:r==null?void 0:r.trajectoryTags}).commit({revertOnError:!0})];case 1:return a=u.sent(),(((s=(o=i.selector.cell)===null||o===void 0?void 0:o.obj)===null||s===void 0?void 0:s.data.blocks.length)||0)>1&&e.state.data.updateCellState(i.ref,{isGhost:!1}),[2,{trajectory:a}]}})})},visuals:Ld};function qv(e,t){var r=this;return function(n,i,a){return ce(r,void 0,void 0,function(){var o,s;return de(this,function(u){switch(u.label){case 0:return o=n.state.data,[4,o.build().to(i).apply(e,t,{tags:a==null?void 0:a.trajectoryTags}).commit({revertOnError:!0})];case 1:return s=u.sent(),[2,{trajectory:s}]}})})}}var trt={label:"PDB",description:"PDB",category:Od,stringExtensions:["pdb","ent"],parse:qv(rt.Model.TrajectoryFromPDB),visuals:Ld},rrt={label:"PDBQT",description:"PDBQT",category:Od,stringExtensions:["pdbqt"],parse:qv(rt.Model.TrajectoryFromPDB,{isPdbqt:!0}),visuals:Ld},nrt={label:"XYZ",description:"XYZ",category:Od,stringExtensions:["xyz"],parse:qv(rt.Model.TrajectoryFromXYZ),visuals:Ld},irt={label:"GRO",description:"GRO",category:Od,stringExtensions:["gro"],binaryExtensions:[],parse:qv(rt.Model.TrajectoryFromGRO),visuals:Ld},art={label:"MOL",description:"MOL",category:Od,stringExtensions:["mol"],parse:qv(rt.Model.TrajectoryFromMOL),visuals:Ld},ort={label:"SDF",description:"SDF",category:Od,stringExtensions:["sdf","sd"],parse:qv(rt.Model.TrajectoryFromSDF),visuals:Ld},srt={label:"MOL2",description:"MOL2",category:Od,stringExtensions:["mol2"],parse:qv(rt.Model.TrajectoryFromMOL2),visuals:Ld},eie=[["mmcif",Jtt],["cifCore",ert],["pdb",trt],["pdbqt",rrt],["gro",irt],["xyz",nrt],["mol",art],["sdf",ort],["mol2",srt]],urt=function(e){return I.Group({type:Hh.getParams(void 0,"auto").type,representation:I.Select(xg.auto.id,e.builders.structure.representation.getPresets().map(function(t){return[t.id,t.display.name,t.display.group]}),{description:"Which representation preset to use."}),representationParams:I.Group(ao.CommonParams,{isHidden:!0}),asTrajectory:I.Optional(I.Boolean(!1,{description:"Load all entries into a single trajectory."}))},{isExpanded:!1})},SF={rcsb:I.Group({encoding:I.Select("bcif",[["cif","cif"],["bcif","bcif"]])},{label:"RCSB PDB",isFlat:!0}),pdbe:I.Group({variant:I.Select("updated-bcif",[["updated-bcif","Updated (bcif)"],["updated","Updated"],["archival","Archival"]])},{label:"PDBe",isFlat:!0})},yR=Po.build({from:ge.Root,display:{name:"Download Structure",description:"Load a structure from the provided source and create its representation."},params:function(e,t){var r=urt(t),n=t.config.get(Yr.Download.DefaultPdbProvider)||"pdbe";return{source:I.MappedStatic("pdb",{pdb:I.Group({provider:I.Group({id:I.Text("1tqn",{label:"PDB Id(s)",description:"One or more comma/space separated PDB ids."}),server:I.MappedStatic(n,SF)},{pivot:"id"}),options:r},{isFlat:!0,label:"PDB"}),"pdb-dev":I.Group({provider:I.Group({id:I.Text("PDBDEV_00000001",{label:"PDBDev Id(s)",description:"One or more comma/space separated ids."}),encoding:I.Select("bcif",[["cif","cif"],["bcif","bcif"]])},{pivot:"id"}),options:r},{isFlat:!0,label:"PDBDEV"}),swissmodel:I.Group({id:I.Text("Q9Y2I8",{label:"UniProtKB AC(s)",description:"One or more comma/space separated ACs."}),options:r},{isFlat:!0,label:"SWISS-MODEL",description:"Loads the best homology model or experimental structure"}),pubchem:I.Group({id:I.Text("2244,2245",{label:"PubChem ID",description:"One or more comma/space separated IDs."}),options:r},{isFlat:!0,label:"PubChem",description:"Loads 3D conformer from PubChem."}),url:I.Group({url:I.Url(""),format:I.Select("mmcif",I.arrayToOptions(eie.map(function(i){return i[0]}),function(i){return i})),isBinary:I.Boolean(!1),options:r},{isFlat:!0,label:"URL"})})}}})(function(e,t){var r=e.params,n=e.state;return $e.create("Download Structure",function(i){return ce(void 0,void 0,void 0,function(){var a,o,s,u,l,c,d;return de(this,function(f){switch(f.label){case 0:switch(t.behaviors.layout.leftPanelTabName.next("data"),a=r.source,s=!1,u="mmcif",a.name){case"url":o=[{url:a.params.url,isBinary:a.params.isBinary}],u=a.params.format;break;case"pdb":o=a.params.provider.server.name==="pdbe"?a.params.provider.server.params.variant==="updated"?Kd(a.params.provider.id,function(p){return"https://www.ebi.ac.uk/pdbe/static/entry/"+p.toLowerCase()+"_updated.cif"},function(p){return"PDBe: "+p+" (updated cif)"},!1):a.params.provider.server.params.variant==="updated-bcif"?Kd(a.params.provider.id,function(p){return"https://www.ebi.ac.uk/pdbe/entry-files/download/"+p.toLowerCase()+".bcif"},function(p){return"PDBe: "+p+" (updated cif)"},!0):Kd(a.params.provider.id,function(p){return"https://www.ebi.ac.uk/pdbe/static/entry/"+p.toLowerCase()+".cif"},function(p){return"PDBe: "+p+" (cif)"},!1):a.params.provider.server.params.encoding==="cif"?Kd(a.params.provider.id,function(p){return"https://files.rcsb.org/download/"+p.toUpperCase()+".cif"},function(p){return"RCSB: "+p+" (cif)"},!1):Kd(a.params.provider.id,function(p){return"https://models.rcsb.org/"+p.toUpperCase()+".bcif"},function(p){return"RCSB: "+p+" (bcif)"},!0),s=!!a.params.options.asTrajectory;break;case"pdb-dev":o=Kd(a.params.provider.id,function(p){var v=p.toUpperCase().startsWith("PDBDEV_")?p:"PDBDEV_"+p.padStart(8,"0");return a.params.provider.encoding==="bcif"?"https://pdb-dev.wwpdb.org/bcif/"+v.toUpperCase()+".bcif":"https://pdb-dev.wwpdb.org/cif/"+v.toUpperCase()+".cif"},function(p){return p.toUpperCase().startsWith("PDBDEV_")?p:"PDBDEV_"+p.padStart(8,"0")},a.params.provider.encoding==="bcif"),s=!!a.params.options.asTrajectory;break;case"swissmodel":o=Kd(a.params.id,function(p){return"https://swissmodel.expasy.org/repository/uniprot/"+p.toUpperCase()+".pdb"},function(p){return"SWISS-MODEL: "+p},!1),s=!!a.params.options.asTrajectory,u="pdb";break;case"pubchem":o=Kd(a.params.id,function(p){return"https://pubchem.ncbi.nlm.nih.gov/rest/pug/compound/CID/"+p.trim()+"/record/SDF/?record_type=3d"},function(p){return"PubChem: "+p},!1),s=!!a.params.options.asTrajectory,u="mol";break;default:throw new Error(a.name+" not supported.")}return l=r.source.params.options.representation||xg.auto.id,c=l!==xg.empty.id,d=a.params.options.type.name==="auto"?void 0:a.params.options.type,[4,n.transaction(function(){return ce(void 0,void 0,void 0,function(){var p,y,v,h,m,g,y;return de(this,function(b){switch(b.label){case 0:return o.length>0&&s?[4,t.builders.data.downloadBlob({sources:o.map(function(S,x){return{id:""+x,url:S.url,isBinary:S.isBinary}}),maxConcurrency:6},{state:{isGhost:!0}})]:[3,4];case 1:return p=b.sent(),[4,t.builders.structure.parseTrajectory(p,{formats:o.map(function(S,x){return{id:""+x,format:"cif"}})})];case 2:return y=b.sent(),[4,t.builders.structure.hierarchy.applyPreset(y,"default",{structure:d,showUnitcell:c,representationPreset:l,representationPresetParams:r.source.params.options.representationParams})];case 3:return b.sent(),[3,10];case 4:v=0,h=o,b.label=5;case 5:return v<h.length?(m=h[v],[4,t.builders.data.download(m,{state:{isGhost:!0}})]):[3,10];case 6:return g=b.sent(),[4,t.builders.structure.parseTrajectory(g,u)];case 7:return y=b.sent(),[4,t.builders.structure.hierarchy.applyPreset(y,"default",{structure:d,showUnitcell:c,representationPreset:l,representationPresetParams:r.source.params.options.representationParams})];case 8:b.sent(),b.label=9;case 9:return v++,[3,5];case 10:return[2]}})})}).runInContext(i)];case 1:return f.sent(),[2]}})})})});function Kd(e,t,r,n){for(var i=e.split(/[,\s]/).map(function(l){return l.trim()}).filter(function(l){return!!l&&(l.length>=4||/^[1-9][0-9]*$/.test(l))}),a=[],o=0,s=i;o<s.length;o++){var u=s[o];a.push({url:Pn.Url(t(u)),isBinary:n,label:r(u)})}return a}var aC=Po.build({display:{name:"Update Trajectory"},params:{action:I.Select("advance",[["advance","Advance"],["reset","Reset"]]),by:I.Optional(I.Numeric(1,{min:-1,max:1,step:1}))}})(function(e){var t=e.params,r=e.state,n=r.selectQ(function(d){return d.ofTransformer(rt.Model.ModelFromTrajectory)}),i=r.build();if(t.action==="reset")for(var a=0,o=n;a<o.length;a++){var s=o[a];i.to(s).update({modelIndex:0})}else for(var u=function(d){var f=ir.findAncestorOfType(r.tree,r.cells,d.transform.ref,ge.Molecule.Trajectory);if(!f||!f.obj)return"continue";var p=f.obj;i.to(d).update(function(v){var h=(v.modelIndex+t.by)%p.data.frameCount;return h<0&&(h+=p.data.frameCount),{modelIndex:h}})},l=0,c=n;l<c.length;l++){var s=c[l];u(s)}return r.updateTree(i)}),lrt=Po.build({display:{name:"Custom Model Properties",description:"Enable parameters for custom properties of the model."},from:ge.Molecule.Model,params:function(e,t){return t.customModelProperties.getParams(e==null?void 0:e.data)},isApplicable:function(e,t,r){return t.transformer!==ite}})(function(e,t){var r=e.ref,n=e.params;return t.builders.structure.insertModelProperties(r,n)}),crt=Po.build({display:{name:"Custom Structure Properties",description:"Enable parameters for custom properties of the structure."},from:ge.Molecule.Structure,params:function(e,t){return t.customStructureProperties.getParams(e==null?void 0:e.data)},isApplicable:function(e,t,r){return t.transformer!==ate}})(function(e,t){var r=e.ref,n=e.params;return t.builders.structure.insertStructureProperties(r,n)}),drt=Po.build({display:{name:"Add Trajectory",description:"Add trajectory from existing model/topology and coordinates."},from:ge.Root,params:function(e,t){var r=t.state.data,n=Nt(Nt([],r.selectQ(function(s){return s.rootsOfType(ge.Molecule.Model)})),r.selectQ(function(s){return s.rootsOfType(ge.Molecule.Topology)})),i=n.map(function(s){return[s.transform.ref,s.obj.label]}),a=r.selectQ(function(s){return s.rootsOfType(ge.Molecule.Coordinates)}),o=a.map(function(s){return[s.transform.ref,s.obj.label]});return{model:I.Select(i.length?i[0][0]:"",i),coordinates:I.Select(o.length?o[0][0]:"",o)}}})(function(e,t){var r=e.params,n=e.state;return $e.create("Add Trajectory",function(i){return n.transaction(function(){return ce(void 0,void 0,void 0,function(){var a,o,s;return de(this,function(u){switch(u.label){case 0:return a=[r.model,r.coordinates],o=n.build().toRoot().apply(rte,{modelRef:r.model,coordinatesRef:r.coordinates},{dependsOn:a}).apply(rt.Model.ModelFromTrajectory,{modelIndex:0}),[4,n.updateTree(o).runInContext(i)];case 1:return u.sent(),[4,t.builders.structure.createStructure(o.selector)];case 2:return s=u.sent(),[4,t.builders.structure.representation.applyPreset(s,"auto")];case 3:return u.sent(),[2]}})})}).runInContext(i)})});const frt=Object.freeze(Object.defineProperty({__proto__:null,AddTrajectory:drt,DownloadStructure:yR,EnableModelCustomProps:lrt,EnableStructureCustomProps:crt,PdbDownloadProvider:SF,UpdateTrajectory:aC},Symbol.toStringTag,{value:"Module"}));var er=function(e){Fe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.hide=function(){return r.props.onSelect(void 0)},r}return t.prototype.render=function(){var r=this.props,n=P.jsx(prt,{items:r.items,onSelect:r.onSelect,current:r.current,multiselect:this.props.multiselect,noOffset:this.props.noOffset,noAccent:this.props.noAccent},void 0);return P.jsxs("div",E({className:"msp-action-menu-options"+(r.header?"":" msp-action-menu-options-no-header")},{children:[r.header&&P.jsx(Pc,E({header:r.header,title:r.title,initialExpanded:!0,hideExpander:!0,hideOffset:!0,onHeaderClick:this.hide,topRightIcon:Ac},{children:n}),void 0),!r.header&&n]}),void 0)},t}(_e.PureComponent);(function(e){function t(l,c){return c?E({kind:"header",label:l},c):{kind:"header",label:l}}e.Header=t;function r(l,c,d){return E({kind:"item",label:l,value:c},d)}e.Item=r;function n(l,c){for(var d=c||{},f=d.label,p=d.value,v=d.category,h=d.selected,m=d.icon,g=d.addOn,y=d.description,b=void 0,S=[],x=0;x<l.length;x++){var C=l[x];if(!(c!=null&&c.filter&&!c.filter(C))){var w=v==null?void 0:v(C),A=f?f(C):""+C,M=p?p(C):C,D=y?y(C):typeof C=="string"?C:void 0,k=void 0;w?(b||(b=new Map),k=b.get(w),k||(k=[e.Header(w,{description:w})],b.set(w,k),S.push(k))):k=S;var R=g==null?void 0:g(C);k.push({kind:"item",label:A,value:M,icon:m?m(C):void 0,selected:h?h(C):void 0,addOn:R,description:D})}}return S}e.createItems=n;var i={value:function(l){return l[0]},label:function(l){return l[1]},category:function(l){return l[2]}};function a(l,c){return n(l,c?E(E({},i),c):i)}e.createItemsFromSelectOptions=a;function o(l){if(yc(l))return!1;if(Sg(l))return!!l.selected;for(var c=0,d=l;c<d.length;c++){var f=d[c],p=o(f);if(p)return!0}return!1}e.hasSelectedItem=o;function s(l,c){if(!yc(l)){if(Sg(l))return l.value===c?l:void 0;for(var d=0,f=l;d<f.length;d++){var p=f[d],v=s(p,c);if(v)return v}}}e.findItem=s;function u(l){if(!yc(l)){if(Sg(l))return l;for(var c=0,d=l;c<d.length;c++){var f=d[c],p=u(f);if(p)return p}}}e.getFirstItem=u})(er||(er={}));var prt=function(e){Fe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state=t.createState(r.props),r.toggleExpanded=function(n){r.setState({isExpanded:!r.state.isExpanded}),n.currentTarget.blur()},r.selectAll=function(){var n=bR(r.props.items,[]).filter(function(i){return!i.selected});r.props.onSelect(n)},r.selectNone=function(){var n=bR(r.props.items,[]).filter(function(i){return!!i.selected});r.props.onSelect(n)},r}return t.createState=function(r,n){var i=PT(r.items)&&yc(r.items[0])?r.items[0]:void 0,a=i!=null&&i.isIndependent?!1:r.multiselect?er.hasSelectedItem(r.items):!!r.current&&!!er.findItem(r.items,r.current.value)||er.hasSelectedItem(r.items);return{header:i,hasCurrent:a,isExpanded:a||(n??!!(i!=null&&i.initiallyExpanded))}},t.prototype.componentDidUpdate=function(r){if(this.props.items!==r.items||this.props.current!==r.current){var n=PT(this.props.items)&&PT(r.items)&&yc(this.props.items[0])&&yc(r.items[0])&&this.props.items[0].label===r.items[0].label?this.state.isExpanded:void 0;this.setState(t.createState(this.props,n))}},Object.defineProperty(t.prototype,"multiselectHeader",{get:function(){var r=this.state,n=r.header,i=r.hasCurrent;return P.jsxs("div",E({className:"msp-flex-row msp-control-group-header"},{children:[P.jsx(mr,E({icon:this.state.isExpanded?Kc:Qc,flex:!0,noOverflow:!0,onClick:this.toggleExpanded,title:"Click to "+(this.state.isExpanded?"collapse":"expand")+"."+(n!=null&&n.description?" "+(n==null?void 0:n.description):"")},{children:i?P.jsx("b",{children:n==null?void 0:n.label},void 0):n==null?void 0:n.label}),void 0),P.jsx(mr,E({icon:m0,flex:!0,onClick:this.selectAll,style:{flex:"0 0 50px",textAlign:"right"}},{children:"All"}),void 0),P.jsx(mr,E({icon:Ac,flex:!0,onClick:this.selectNone,style:{flex:"0 0 50px",textAlign:"right"}},{children:"None"}),void 0)]}),void 0)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"basicHeader",{get:function(){var r=this.state,n=r.header,i=r.hasCurrent;return P.jsx("div",E({className:"msp-control-group-header",style:{marginTop:"1px"}},{children:P.jsx(mr,E({noOverflow:!0,icon:this.state.isExpanded?Kc:Qc,onClick:this.toggleExpanded,title:"Click to "+(this.state.isExpanded?"collapse":"expand")+". "+(n!=null&&n.description?n==null?void 0:n.description:"")},{children:i?P.jsx("b",{children:n==null?void 0:n.label},void 0):n==null?void 0:n.label}),void 0)}),void 0)},enumerable:!1,configurable:!0}),t.prototype.render=function(){var r=this,n=this.props,i=n.items,a=n.onSelect,o=n.current;if(yc(i))return null;if(Sg(i))return P.jsx(xH,{item:i,onSelect:a,current:o,multiselect:this.props.multiselect},void 0);var s=this.state.header;return P.jsxs(P.Fragment,{children:[s&&(this.props.multiselect&&this.state.isExpanded?this.multiselectHeader:this.basicHeader),P.jsx("div",E({className:this.props.noOffset?void 0:this.props.noAccent?"msp-control-offset":"msp-accent-offset"},{children:(!s||this.state.isExpanded)&&i.map(function(u,l){return yc(u)?null:Sg(u)?P.jsx(xH,{item:u,onSelect:a,current:o,multiselect:r.props.multiselect},l):P.jsx(t,{items:u,onSelect:a,current:o,multiselect:r.props.multiselect,noAccent:!0},l)})}),void 0)]},void 0)},t}(_e.PureComponent),xH=function(e){var t=e.item,r=e.onSelect,n=e.current,i=e.multiselect,a=n===t,o=t.addOn?{position:"relative"}:void 0;return P.jsxs(mr,E({icon:t.icon,noOverflow:!0,className:"msp-action-menu-button",onClick:function(s){return r(i?[t]:t,s)},disabled:t.disabled,style:o,title:t.description},{children:[a||t.selected?P.jsx("b",{children:t.label},void 0):t.label,t.addOn]}),void 0)};function PT(e){return!!e&&Array.isArray(e)}function Sg(e){var t=e;return t&&t.kind==="item"}function yc(e){var t=e;return t&&t.kind==="header"}function bR(e,t){if(yc(e))return t;if(Sg(e))return t.push(e),t;for(var r=0,n=e;r<n.length;r++){var i=n[r];bR(i,t)}return t}var CF=[["black",0],["gray",8421504],["white",16777215],["red",13840661],["orange",14840576],["yellow",16565248],["green",6863872],["cyan",1484197],["blue",40160],["purple",8086783],["magenta",16394495],["violet",8200583]],hrt=function(e){Fe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isExpanded:!!r.props.param.isExpanded,lightness:0},r.toggleExpanded=function(n){r.setState({isExpanded:!r.state.isExpanded}),n.currentTarget.blur()},r.onClickSwatch=function(n){var i=at(+(n.currentTarget.getAttribute("data-color")||"0"));i!==r.props.value&&(r.props.param.isExpanded||r.setState({isExpanded:!1}),r.update(i))},r.onR=function(n){var i=at.toRgb(r.props.value),a=i[1],o=i[2],s=at.fromRgb(n,a,o);s!==r.props.value&&r.update(s)},r.onG=function(n){var i=at.toRgb(r.props.value),a=i[0],o=i[2],s=at.fromRgb(a,n,o);s!==r.props.value&&r.update(s)},r.onB=function(n){var i=at.toRgb(r.props.value),a=i[0],o=i[1],s=at.fromRgb(a,o,n);s!==r.props.value&&r.update(s)},r.onLighten=function(){r.update(at.lighten(r.props.value,.1))},r.onDarken=function(){r.update(at.darken(r.props.value,.1))},r}return t.prototype.update=function(r){this.props.onChange({param:this.props.param,name:this.props.name,value:r})},t.prototype.swatch=function(){var r=this;return P.jsx("div",E({className:"msp-combined-color-swatch"},{children:CF.map(function(n){return P.jsx(mr,{inline:!0,"data-color":n[1],onClick:r.onClickSwatch,style:{background:at.toStyle(n[1])}},n[1])})}),void 0)},t.prototype.render=function(){var r=this.props.param.label||Ha(this.props.name),n=at.toRgb(this.props.value),i=n[0],a=n[1],o=n[2];return P.jsxs(P.Fragment,{children:[P.jsx(Xs,{title:this.props.param.description,label:r,control:P.jsx(mr,{onClick:this.toggleExpanded,inline:!0,className:"msp-combined-color-button",style:{background:at.toStyle(this.props.value)}},void 0)},void 0),this.state.isExpanded&&P.jsxs("div",E({className:"msp-control-offset"},{children:[this.swatch(),P.jsx(Xs,{label:"RGB",className:"msp-control-label-short",control:P.jsxs("div",E({style:{display:"flex",textAlignLast:"center",left:"80px"}},{children:[P.jsx(Fc,{onChange:this.onR,numeric:!0,value:i,delayMs:250,style:{order:1,flex:"1 1 auto",minWidth:0},className:"msp-form-control",onEnter:this.props.onEnter,blurOnEnter:!0,blurOnEscape:!0},void 0),P.jsx(Fc,{onChange:this.onG,numeric:!0,value:a,delayMs:250,style:{order:2,flex:"1 1 auto",minWidth:0},className:"msp-form-control",onEnter:this.props.onEnter,blurOnEnter:!0,blurOnEscape:!0},void 0),P.jsx(Fc,{onChange:this.onB,numeric:!0,value:o,delayMs:250,style:{order:3,flex:"1 1 auto",minWidth:0},className:"msp-form-control",onEnter:this.props.onEnter,blurOnEnter:!0,blurOnEscape:!0},void 0)]}),void 0)},void 0),P.jsxs("div",E({style:{display:"flex",textAlignLast:"center"}},{children:[P.jsx(mr,E({onClick:this.onLighten,style:{order:1,flex:"1 1 auto",minWidth:0},className:"msp-form-control"},{children:"Lighten"}),void 0),P.jsx(mr,E({onClick:this.onDarken,style:{order:1,flex:"1 1 auto",minWidth:0},className:"msp-form-control"},{children:"Darken"}),void 0)]}),void 0)]}),void 0)]},void 0)},t}(_e.PureComponent),Kx=void 0;function vrt(){return Kx||(Kx=P.jsx(P.Fragment,{children:CF.map(function(e){return P.jsx("option",E({value:e[1],style:{background:""+at.toStyle(e[1])}},{children:Zo(e[0])}),e[1])})},void 0),Kx)}var mrt=function(){for(var e=new Map,t=0,r=CF;t<r.length;t++){var n=r[t];e.set(n[1],n[0])}return e}();function grt(e){return mrt.has(e)?null:P.jsx("option",E({value:e,style:{background:""+at.toStyle(e)}},{children:at.toRgbString(e)}),at.toHexString(e))}function yrt(e){switch(e.kind){case"scale-legend":return brt;case"table-legend":return xrt;default:var t=e;console.warn(t+" has no associated UI component");return}}var brt=function(e){Fe(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.render=function(){var r=this.props.legend,n=r.colors.map(function(i){return Array.isArray(i)?at.toStyle(i[0])+" "+100*i[1]+"%":at.toStyle(i)}).join(", ");return P.jsx("div",E({className:"msp-scale-legend"},{children:P.jsxs("div",E({style:{background:"linear-gradient(to right, "+n+")"}},{children:[P.jsx("span",E({style:{float:"left"}},{children:r.minLabel}),void 0),P.jsx("span",E({style:{float:"right"}},{children:r.maxLabel}),void 0)]}),void 0)}),void 0)},t}(_e.PureComponent),xrt=function(e){Fe(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.render=function(){var r=this.props.legend;return P.jsx("div",E({className:"msp-table-legend"},{children:r.table.map(function(n,i){var a=n[0],o=n[1];return P.jsxs("div",{children:[P.jsx("div",{className:"msp-table-legend-color",style:{backgroundColor:at.toStyle(o)}},void 0),P.jsx("div",E({className:"msp-table-legend-text"},{children:a}),void 0)]},i)})}),void 0)},t}(_e.PureComponent),Srt=function(e){Fe(t,e);function t(r){var n=e.call(this,r)||this;return n.state={show:!1},n.handleHover=n.handleHover.bind(n),n.handleHoverOff=n.handleHoverOff.bind(n),n.deletePoint=n.deletePoint.bind(n),n}return t.prototype.handleHover=function(){this.setState({show:!0});var r=He.create(this.props.nX,this.props.nY);this.props.onmouseover(r)},t.prototype.handleHoverOff=function(){this.setState({show:!1}),this.props.onmouseover(void 0)},t.prototype.deletePoint=function(){this.props.delete(this.props.id)},t.prototype.render=function(){return[P.jsx("circle",{r:"10",id:""+this.props.id,cx:this.props.x,cy:this.props.y,onClick:this.props.onclick,onDoubleClick:this.props.delete(this.props.id),onMouseEnter:this.handleHover,onMouseLeave:this.handleHoverOff,onMouseDown:this.props.onmousedown,fill:"black"},this.props.id+"circle")]},t}(_e.Component),Crt=function(e){Fe(t,e);function t(r){var n=e.call(this,r)||this;n.handleKeyDown=function(s){},n.handleKeyUp=function(s){},n.handleClick=function(s){return function(u){}},n.handleMouseDown=function(s){return function(u){if(!(s===0||s===n.state.points.length-1)&&!n.state.canSelectMultiple){var l=n.normalizePoint(He.create(n.state.points[s][0],n.state.points[s][1]));n.ghostPoints.push(document.createElementNS(n.namespace,"circle")),n.ghostPoints[0].setAttribute("r","10"),n.ghostPoints[0].setAttribute("fill","orange"),n.ghostPoints[0].setAttribute("cx",""+l[0]),n.ghostPoints[0].setAttribute("cy",""+l[1]),n.ghostPoints[0].setAttribute("style","display: none"),n.gElement.appendChild(n.ghostPoints[0]),n.updatedX=l[0],n.updatedY=l[1],n.selected=[s]}}},n.deletePoint=function(s){return function(u){if(!(s===0||s===n.state.points.length-1)){var l=n.state.points.filter(function(c,d){return d!==s});l.sort(function(c,d){return c[0]===d[0]?c[0]===0?c[1]-d[1]:c[1]===1?d[1]-c[1]:c[1]-d[1]:c[0]-d[0]}),n.setState({points:l}),n.change(l),u.stopPropagation()}}},n.myRef=_e.createRef(),n.state={points:[He.create(0,0),He.create(1,0)],copyPoint:void 0,canSelectMultiple:!1},n.height=400,n.width=600,n.padding=70,n.selected=void 0,n.ghostPoints=[],n.namespace="http://www.w3.org/2000/svg";for(var i=0,a=n.props.data;i<a.length;i++){var o=a[i];n.state.points.push(o)}return n.state.points.sort(function(s,u){return s[0]===u[0]?s[0]===0?s[1]-u[1]:s[1]===1?u[1]-s[1]:s[1]-u[1]:s[0]-u[0]}),n.handleDrag=n.handleDrag.bind(n),n.handleMultipleDrag=n.handleMultipleDrag.bind(n),n.handleDoubleClick=n.handleDoubleClick.bind(n),n.refCallBack=n.refCallBack.bind(n),n.handlePointUpdate=n.handlePointUpdate.bind(n),n.change=n.change.bind(n),n.handleKeyUp=n.handleKeyUp.bind(n),n.handleLeave=n.handleLeave.bind(n),n.handleEnter=n.handleEnter.bind(n),n}return t.prototype.render=function(){var r=this.renderPoints(),n=this.renderLines();return[P.jsx("div",{children:P.jsxs("svg",E({className:"msp-canvas",ref:this.refCallBack,viewBox:"0 0 "+(this.width+this.padding)+" "+(this.height+this.padding),onMouseMove:this.handleDrag,onMouseUp:this.handlePointUpdate,onMouseLeave:this.handleLeave,onMouseEnter:this.handleEnter,tabIndex:0,onKeyDown:this.handleKeyDown,onKeyUp:this.handleKeyUp,onDoubleClick:this.handleDoubleClick},{children:[P.jsxs("g",E({stroke:"black",fill:"black"},{children:[n,r]}),void 0),P.jsx("g",{className:"ghost-points",stroke:"black",fill:"black"},void 0)]}),void 0)},"LineGraph"),P.jsx("div",{id:"modal-root"},"modal")]},t.prototype.componentDidMount=function(){this.gElement=document.getElementsByClassName("ghost-points")[0]},t.prototype.change=function(r){var n=r.slice();n.shift(),n.pop(),this.props.onChange(n)},t.prototype.handleDrag=function(r){if(this.selected!==void 0){var n=this.myRef.createSVGPoint(),i,a=this.padding/2;n.x=r.clientX,n.y=r.clientY;var o=n.matrixTransform(this.myRef.getScreenCTM().inverse());i=He.create(o.x,o.y),(o.x<a||o.x>this.width+a)&&(o.y>this.height+a||o.y<a)?i=He.create(this.updatedX,this.updatedY):o.x<a?i=He.create(a,o.y):o.x>this.width+a?i=He.create(this.width+a,o.y):o.y>this.height+a?i=He.create(o.x,this.height+a):o.y<a?i=He.create(o.x,a):i=He.create(o.x,o.y),this.updatedX=i[0],this.updatedY=i[1];var s=this.unNormalizePoint(i);this.ghostPoints[0].setAttribute("style","display: visible"),this.ghostPoints[0].setAttribute("cx",""+i[0]),this.ghostPoints[0].setAttribute("cy",""+i[1]),this.props.onDrag(s)}},t.prototype.handleMultipleDrag=function(){},t.prototype.handlePointUpdate=function(r){var n=this.selected;if(!this.state.canSelectMultiple){if(n===void 0||n[0]===0||n[0]===this.state.points.length-1){this.setState({copyPoint:void 0});return}this.selected=void 0;var i=this.unNormalizePoint(He.create(this.updatedX,this.updatedY)),a=this.state.points.filter(function(o,s){return s!==n[0]});a.push(i),a.sort(function(o,s){return o[0]===s[0]?o[0]===0?o[1]-s[1]:o[1]===1?s[1]-o[1]:o[1]-s[1]:o[0]-s[0]}),this.setState({points:a}),this.change(a),this.gElement.innerHTML="",this.ghostPoints=[],document.removeEventListener("mousemove",this.handleDrag,!0),document.removeEventListener("mouseup",this.handlePointUpdate,!0)}},t.prototype.handleDoubleClick=function(r){var n,i=this.myRef.createSVGPoint();i.x=r.clientX,i.y=r.clientY;var a=i.matrixTransform(this.myRef.getScreenCTM().inverse()),o=this.state.points,s=this.padding/2;a.x<s||a.x>this.width+s||a.y>this.height+s||a.y<this.padding/2||(n=this.unNormalizePoint(He.create(a.x,a.y)),o.push(n),o.sort(function(u,l){return u[0]===l[0]?u[0]===0?u[1]-l[1]:u[1]===1?l[1]-u[1]:u[1]-l[1]:u[0]-l[0]}),this.setState({points:o}),this.change(o))},t.prototype.handleLeave=function(){this.selected!==void 0&&(document.addEventListener("mousemove",this.handleDrag,!0),document.addEventListener("mouseup",this.handlePointUpdate,!0))},t.prototype.handleEnter=function(){document.removeEventListener("mousemove",this.handleDrag,!0),document.removeEventListener("mouseup",this.handlePointUpdate,!0)},t.prototype.normalizePoint=function(r){var n=this.padding/2,i=this.width+n,a=this.height+n,o=r[0]*(i-n)+n,s=r[1]*(a-n)+n,u=this.height+this.padding-s,l=He.create(o,u);return l},t.prototype.unNormalizePoint=function(r){var n=this.padding/2,i=this.width+n,a=this.height+n,o=(r[0]-n)/(i-n),s=(this.height+this.padding-r[1]-n)/(a-n);return He.create(o,s)},t.prototype.refCallBack=function(r){r&&(this.myRef=r)},t.prototype.renderPoints=function(){for(var r=[],n,i=0;i<this.state.points.length;i++)i!==0&&i!==this.state.points.length-1&&(n=this.normalizePoint(this.state.points[i]),r.push(P.jsx(Srt,{id:i,x:n[0],y:n[1],nX:this.state.points[i][0],nY:this.state.points[i][1],selected:!1,delete:this.deletePoint,onmouseover:this.props.onHover,onmousedown:this.handleMouseDown(i),onclick:this.handleClick(i)},i)));return r},t.prototype.renderLines=function(){for(var r=[],n=[],i,a,o,s,u,l,c=0,d=this.state.points;c<d.length;c++){var f=d[c];i=this.padding/2,a=this.width+i,o=this.height+i,s=f[0]*(a-i)+i,u=f[1]*(o-i)+i,l=this.height+this.padding-u,r.push(He.create(s,l))}for(var p=r,v=p.length,h=0;h<v-1;h++){var m=p[h][0],g=p[h][1],y=p[h+1][0],b=p[h+1][1];n.push(P.jsx("line",{x1:m,x2:y,y1:g,y2:b,stroke:"#cec9ba",strokeWidth:"5"},"lineOf"+h))}return n},t}(_e.Component),tie=function(e){Fe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isChanging:!1,current:0},r.begin=function(){r.setState({isChanging:!0})},r.end=function(n){r.setState({isChanging:!1}),r.props.onChange(n)},r.updateCurrent=function(n){var i,a;r.setState({current:n}),(a=(i=r.props).onChangeImmediate)===null||a===void 0||a.call(i,n)},r.updateManually=function(n){r.setState({isChanging:!0});var i=n;r.props.step===1&&(i=Math.round(i)),i<r.props.min&&(i=r.props.min),i>r.props.max&&(i=r.props.max),r.setState({current:i,isChanging:!0})},r.onManualBlur=function(){r.setState({isChanging:!1}),r.props.onChange(r.state.current)},r}return t.getDerivedStateFromProps=function(r,n){return n.isChanging||r.value===n.current?null:{current:r.value}},t.prototype.render=function(){var r=this.props.step;return r===void 0&&(r=1),P.jsxs("div",E({className:"msp-slider"},{children:[P.jsx("div",{children:P.jsx(rie,{min:this.props.min,max:this.props.max,step:r,value:this.state.current,disabled:this.props.disabled,onBeforeChange:this.begin,onChange:this.updateCurrent,onAfterChange:this.end},void 0)},void 0),P.jsx("div",{children:P.jsx(Fc,{numeric:!0,delayMs:50,value:this.state.current,blurOnEnter:!0,onBlur:this.onManualBlur,isDisabled:this.props.disabled,onChange:this.updateManually},void 0)},void 0)]}),void 0)},t}(_e.Component),_rt=function(e){Fe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isChanging:!1,current:[0,1]},r.begin=function(){r.setState({isChanging:!0})},r.end=function(n){r.setState({isChanging:!1}),r.props.onChange(n)},r.updateCurrent=function(n){r.setState({current:n})},r.updateMax=function(n){var i=n;r.props.step===1&&(i=Math.round(i)),i<r.state.current[0]?i=r.state.current[0]:i<r.props.min&&(i=r.props.min),i>r.props.max&&(i=r.props.max),r.props.onChange([r.state.current[0],i])},r.updateMin=function(n){var i=n;r.props.step===1&&(i=Math.round(i)),i<r.props.min&&(i=r.props.min),i>r.state.current[1]?i=r.state.current[1]:i>r.props.max&&(i=r.props.max),r.props.onChange([i,r.state.current[1]])},r}return t.getDerivedStateFromProps=function(r,n){return n.isChanging||r.value[0]===n.current[0]&&r.value[1]===n.current[1]?null:{current:r.value}},t.prototype.render=function(){var r=this.props.step;return r===void 0&&(r=1),P.jsxs("div",E({className:"msp-slider2"},{children:[P.jsx("div",{children:P.jsx(Fc,{numeric:!0,delayMs:50,value:this.state.current[0],onEnter:this.props.onEnter,blurOnEnter:!0,isDisabled:this.props.disabled,onChange:this.updateMin},void 0)},void 0),P.jsx("div",{children:P.jsx(rie,{min:this.props.min,max:this.props.max,step:r,value:this.state.current,disabled:this.props.disabled,onBeforeChange:this.begin,onChange:this.updateCurrent,onAfterChange:this.end,range:!0,allowCross:!0},void 0)},void 0),P.jsx("div",{children:P.jsx(Fc,{numeric:!0,delayMs:50,value:this.state.current[1],onEnter:this.props.onEnter,blurOnEnter:!0,isDisabled:this.props.disabled,onChange:this.updateMax},void 0)},void 0)]}),void 0)},t}(_e.Component);function xR(e){for(var t=[],r={}.hasOwnProperty,n=0;n<arguments.length;n++){var i=arguments[n];if(i){var a=typeof i;if(a==="string"||a==="number")t.push(i);else if(Array.isArray(i))t.push(xR.apply(null,i));else if(a==="object")for(var o in i)r.call(i,o)&&i[o]&&t.push(o)}}return t.join(" ")}function SH(e){return e.touches.length>1||e.type.toLowerCase()==="touchend"&&e.touches.length>0}function CH(e,t){return e?t.touches[0].clientY:t.touches[0].pageX}function _H(e,t){return e?t.clientY:t.pageX}function wH(e,t){var r=t.getBoundingClientRect();return e?r.top+r.height*.5:r.left+r.width*.5}function TT(e){e.stopPropagation(),e.preventDefault()}var wrt=function(e){Fe(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.render=function(){var r=this.props,n=r.className,i=r.tipFormatter,a=r.vertical,o=r.offset,s=r.value,u=r.index,l=a?{bottom:o+"%"}:{left:o+"%"};return P.jsx("div",{className:n,style:l,title:i(s,u)},void 0)},t}(_e.Component),rie=function(e){Fe(t,e);function t(r){var n=e.call(this,r)||this;n.sliderElement=_e.createRef(),n.handleElements=[],n.dragOffset=0,n.startPosition=0,n.startValue=0,n._getPointsCache=void 0,n.onMouseDown=function(f){if(f.button===0){var p=_H(n.props.vertical,f);if(!n.isEventFromHandle(f))n.dragOffset=0;else{var v=wH(n.props.vertical,f.target);n.dragOffset=p-v,p=v}n.onStart(p),n.addDocumentEvents("mouse"),TT(f)}},n.onTouchMove=function(f){if(SH(f)){n.end("touch");return}var p=CH(n.props.vertical,f);n.onMove(f,p-n.dragOffset)},n.onTouchStart=function(f){if(!SH(f)){var p=CH(n.props.vertical,f);if(!n.isEventFromHandle(f))n.dragOffset=0;else{var v=wH(n.props.vertical,f.target);n.dragOffset=p-v,p=v}n.onStart(p),n.addDocumentEvents("touch"),TT(f)}},n.eventHandlers={touchmove:function(f){return n.onTouchMove(f)},touchend:function(f){return n.end("touch")},mousemove:function(f){return n.onMouseMove(f)},mouseup:function(f){return n.end("mouse")}},n.calcOffset=function(f){var p=n.props,v=p.min,h=p.max,m=(f-v)/(h-v);return m*100};var i=r.range,a=r.min,o=r.max,s=i?Array.apply(null,Array(+i+1)).map(function(){return a}):a,u="defaultValue"in r?r.defaultValue:s,l=r.value!==void 0?r.value:u,c=(i?l:[a,l]).map(function(f){return n.trimAlignValue(f)}),d;return i&&c[0]===c[c.length-1]&&c[0]===o?d=0:d=c.length-1,n.state={handle:null,recent:d,bounds:c},n}return t.prototype.componentDidUpdate=function(r){var n=this;if("value"in this.props||"min"in this.props||"max"in this.props){var i=this.state.bounds;if(r.range){var a=this.props.value||i,o=a.map(function(u){return n.trimAlignValue(u,n.props)});if(o.every(function(u,l){return u===i[l]}))return;this.setState({bounds:o}),i.some(function(u){return n.isValueOutOfBounds(u,n.props)})&&this.props.onChange(o)}else{var a=this.props.value!==void 0?this.props.value:i[1],s=this.trimAlignValue(a,this.props);if(s===i[1]&&i[0]===r.min)return;this.setState({bounds:[r.min,s]}),this.isValueOutOfBounds(i[1],this.props)&&this.props.onChange(s)}}},t.prototype.onChange=function(r){var n=this.props,i=!("value"in n);i?this.setState(r):r.handle!==void 0&&this.setState({handle:r.handle});var a=E(E({},this.state),r),o=n.range?a.bounds:a.bounds[1];n.onChange(o)},t.prototype.onMouseMove=function(r){var n=_H(this.props.vertical,r);this.onMove(r,n-this.dragOffset)},t.prototype.onMove=function(r,n){TT(r);var i=this.props,a=this.state,o=n-this.startPosition;o=this.props.vertical?-o:o;var s=o/this.getSliderLength()*(i.max-i.min),u=this.trimAlignValue(this.startValue+s),l=a.bounds[a.handle];if(u!==l){var c=Nt([],a.bounds);c[a.handle]=u;var d=a.handle;if(i.pushable){var f=a.bounds[d];this.pushSurroundingHandles(c,d,f)}else i.allowCross&&(c.sort(function(p,v){return p-v}),d=c.indexOf(u));this.onChange({handle:d,bounds:c})}},t.prototype.onStart=function(r){var n=this.props;n.onBeforeChange(this.getValue());var i=this.calcValueByPos(r);this.startValue=i,this.startPosition=r;var a=this.state,o=a.bounds,s=1;if(this.props.range){for(var u=0,l=1;l<o.length-1;++l)i>o[l]&&(u=l);Math.abs(o[u+1]-i)<Math.abs(o[u]-i)&&(u=u+1),s=u;var c=o[u+1]===o[u];c&&(s=a.recent),c&&i!==o[u+1]&&(s=i<o[u+1]?u:u+1)}this.setState({handle:s,recent:s});var d=a.bounds[s];if(i!==d){var f=Nt([],a.bounds);f[s]=i,this.onChange({bounds:f})}},t.prototype.getPoints=function(){var r=this.props,n=r.marks,i=r.step,a=r.min,o=r.max,s=this._getPointsCache;if(!s||s.marks!==n||s.step!==i){var u=E({},n);if(i!==null)for(var l=a;l<=o;l+=i)u[l]=l;var c=Object.keys(u).map(parseFloat);c.sort(function(d,f){return d-f}),this._getPointsCache={marks:n,step:i,points:c}}return this._getPointsCache.points},t.prototype.getPrecision=function(r){var n=r.toString(),i=0;return n.indexOf(".")>=0&&(i=n.length-n.indexOf(".")-1),i},t.prototype.getSliderLength=function(){var r=this.sliderElement.current;return r?this.props.vertical?r.clientHeight:r.clientWidth:0},t.prototype.getSliderStart=function(){var r=this.sliderElement.current,n=r.getBoundingClientRect();return this.props.vertical?n.top:n.left},t.prototype.getValue=function(){var r=this.state.bounds;return this.props.range?r:r[1]},t.prototype.addDocumentEvents=function(r){r==="touch"?(document.addEventListener("touchmove",this.eventHandlers.touchmove),document.addEventListener("touchend",this.eventHandlers.touchend)):r==="mouse"&&(document.addEventListener("mousemove",this.eventHandlers.mousemove),document.addEventListener("mouseup",this.eventHandlers.mouseup))},t.prototype.calcValue=function(r){var n=this.props,i=n.vertical,a=n.min,o=n.max,s=Math.abs(r/this.getSliderLength()),u=i?(1-s)*(o-a)+a:s*(o-a)+a;return u},t.prototype.calcValueByPos=function(r){var n=r-this.getSliderStart(),i=this.trimAlignValue(this.calcValue(n));return i},t.prototype.end=function(r){this.removeEvents(r),this.props.onAfterChange(this.getValue()),this.setState({handle:null})},t.prototype.isEventFromHandle=function(r){for(var n=0,i=this.handleElements;n<i.length;n++){var a=i[n];if(a.current===r.target)return!0}return!1},t.prototype.isValueOutOfBounds=function(r,n){return r<n.min||r>n.max},t.prototype.pushHandle=function(r,n,i,a){for(var o=r[n],s=r[n];i*(s-o)<a;){if(!this.pushHandleOnePoint(r,n,i))return r[n]=o,!1;s=r[n]}return!0},t.prototype.pushHandleOnePoint=function(r,n,i){var a=this.getPoints(),o=a.indexOf(r[n]),s=o+i;if(s>=a.length||s<0)return!1;var u=n+i,l=a[s],c=this.props.pushable,d=i*(r[u]-l);return this.pushHandle(r,u,i,+c-d)?(r[n]=l,!0):!1},t.prototype.pushSurroundingHandles=function(r,n,i){var a=this.props.pushable,o=r[n],s=0;if(r[n+1]-o<a?s=1:o-r[n-1]<a&&(s=-1),s!==0){var u=n+s,l=s*(r[u]-o);this.pushHandle(r,u,s,+a-l)||(r[n]=i)}},t.prototype.removeEvents=function(r){r==="touch"?(document.removeEventListener("touchmove",this.eventHandlers.touchmove),document.removeEventListener("touchend",this.eventHandlers.touchend)):r==="mouse"&&(document.removeEventListener("mousemove",this.eventHandlers.mousemove),document.removeEventListener("mouseup",this.eventHandlers.mouseup))},t.prototype.trimAlignValue=function(r,n){var i=this.state||{},a=i.handle,o=i.bounds,s=E(E({},this.props),n||{}),u=s.marks,l=s.step,c=s.min,d=s.max,f=s.allowCross,p=r;p<=c&&(p=c),p>=d&&(p=d),!f&&a!=null&&a>0&&p<=o[a-1]&&(p=o[a-1]),!f&&a!=null&&a<o.length-1&&p>=o[a+1]&&(p=o[a+1]);var v=Object.keys(u).map(parseFloat);if(l!==null){var h=Math.round((p-c)/l)*l+c;v.push(h)}var m=v.map(function(y){return Math.abs(p-y)}),g=v[m.indexOf(Math.min.apply(Math,m))];return l!==null?parseFloat(g.toFixed(this.getPrecision(l))):g},t.prototype.render=function(){var r,n=this,i=this.state,a=i.handle,o=i.bounds,s=this.props,u=s.className,l=s.prefixCls,c=s.disabled,d=s.vertical,f=s.range,p=s.step,v=s.marks,h=s.tipFormatter,m=this.props.handle,g=o.map(this.calcOffset),y=l+"-handle",b=o.map(function(M,D){var k;return xR((k={},k[y]=!0,k[y+"-"+(D+1)]=!0,k[y+"-lower"]=D===0,k[y+"-upper"]=D===o.length-1,k))}),S=p===null||h===null,x={prefixCls:l,noTip:S,tipFormatter:h,vertical:d};if(this.handleElements.length!==o.length){this.handleElements=[];for(var C=0;C<o.length;C++)this.handleElements.push(_e.createRef())}var w=o.map(function(M,D){return _e.cloneElement(m,E(E({},x),{className:b[D],value:M,offset:g[D],dragging:a===D,index:D,key:D,ref:n.handleElements[D]}))});f||w.shift();var A=xR((r={},r[l]=!0,r[l+"-with-marks"]=Object.keys(v).length,r[l+"-disabled"]=c,r[l+"-vertical"]=this.props.vertical,r[u]=!!u,r));return P.jsxs("div",E({ref:this.sliderElement,className:A,onTouchStart:c?bf:this.onTouchStart,onMouseDown:c?bf:this.onMouseDown},{children:[P.jsx("div",{className:l+"-rail"},void 0),w]}),void 0)},t.defaultProps={prefixCls:"msp-slider-base",className:"",min:0,max:100,step:1,marks:{},handle:P.jsx(wrt,{className:"",vertical:!1,offset:0,tipFormatter:function(r){return r},value:0,index:0},void 0),onBeforeChange:bf,onChange:bf,onAfterChange:bf,tipFormatter:function(r,n){return r},disabled:!1,range:!1,vertical:!1,allowCross:!0,pushable:!1},t}(_e.Component),Un=function(e){Fe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.onChange=function(n){var i,a,o;if((o=(a=r.props).onChange)===null||o===void 0||o.call(a,n,r.props.values),r.props.onChangeValues){var s=E(E({},r.props.values),(i={},i[n.name]=n.value,i));r.props.onChangeValues(s,r.props.values)}},r.paramGroups=vp(function(n){return Art(n)}),r}return t.prototype.renderGroup=function(r){var n;if(r.length===0)return null;for(var i=this.props.values,a=null,o=void 0,s=0,u=r;s<u.length;s++){var l=u[s],c=l[0],d=l[1],f=l[2];!((n=d.hideIf)===null||n===void 0)&&n.call(d,i)||(a||(a=[]),o=d.category,a.push(P.jsx(f,{param:d,onChange:this.onChange,onEnter:this.props.onEnter,isDisabled:this.props.isDisabled,name:c,value:i[c]},c)))}return a?o?[P.jsx(Uu,E({header:o},{children:a}),o)]:a:null},t.prototype.renderPart=function(r){for(var n=null,i=0,a=r;i<a.length;i++){var o=a[i],s=this.renderGroup(o);if(s){n||(n=[]);for(var u=0,l=s;u<l.length;u++){var c=l[u];n.push(c)}}}return n},t.prototype.render=function(){var r=this.paramGroups(this.props.params),n=this.renderPart(r.essentials),i=this.renderPart(r.advanced);return n&&i?P.jsxs(P.Fragment,{children:[n,P.jsx(Uu,E({header:"Advanced Options"},{children:i}),void 0)]},void 0):n||i},t}(_e.PureComponent),Ert=function(e){Fe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.setSettings=function(n,i){var a,o=E(E({},i),(a={},a[n.name]=n.value,a)),s=r.props.mapping.update(o,r.plugin);r.props.mapping.apply(s,r.plugin)},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.events.canvas3d.settingsUpdated,function(){return r.forceUpdate()})},t.prototype.render=function(){var r=this.props.mapping.getTarget(this.plugin),n=this.props.mapping.getValues(r,this.plugin),i=this.props.mapping.params(this.plugin);return P.jsx(Un,{params:i,values:n,onChange:this.setSettings},void 0)},t}(gr);function Art(e){function t(c,d,f){var p=y2(d);if(p)if(!d.category)f.params[0].push([c,d,p]);else{f.map||(f.map=new Map);var v=f.map.get(d.category);v||(v=[],f.map.set(d.category,v),f.params.push(v)),v.push([c,d,p])}}function r(c,d){var f=c[0],p=d[0];return!f||!f[1].category?-1:!p||!p[1].category?1:f[1].category<p[1].category?-1:1}for(var n=Object.keys(e),i={params:[[]],map:void 0},a={params:[[]],map:void 0},o=0,s=n;o<s.length;o++){var u=s[o],l=e[u];l.isHidden||(l.isEssential?t(u,l,i):t(u,l,a))}return i.params.sort(r),a.params.sort(r),{essentials:i.params,advanced:a.params}}function y2(e){switch(e.type){case"value":return;case"boolean":return _F;case"number":return typeof e.min<"u"&&typeof e.max<"u"?Mrt:Irt;case"converted":return Krt;case"conditioned":return Yrt;case"multi-select":return $rt;case"color":return hrt;case"color-list":return e.offsets?jrt:Urt;case"vec3":return zrt;case"mat4":return Vrt;case"url":return Hrt;case"file":return Grt;case"file-list":return qrt;case"select":return wF;case"value-ref":return Rrt;case"data-ref":return;case"text":return Drt;case"interval":return typeof e.min<"u"&&typeof e.max<"u"?Ort:krt;case"group":return iie;case"mapped":return Wrt;case"line-graph":return Trt;case"script":return Qrt;case"object-list":return AF;default:var t=e;console.warn(t+" has no associated UI component");return}}var Prt=function(e){Fe(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.render=function(){var r=this.props,n=r.legend,i=r.description,a=n&&yrt(n);return P.jsx("div",E({className:"msp-help-text"},{children:P.jsxs("div",{children:[P.jsxs("div",E({className:"msp-help-description"},{children:[P.jsx(sn,{svg:Fl,inline:!0},void 0),i]}),void 0),a&&P.jsx("div",E({className:"msp-help-legend"},{children:P.jsx(a,{legend:n},void 0)}),void 0)]},void 0)}),void 0)},t}(_e.PureComponent);function $v(e){var t=e.props,r=e.state,n=e.control,i=e.toggleHelp,a=e.addOn,o=[];t.param.shortLabel&&o.push("msp-control-label-short"),t.param.twoColumns&&o.push("msp-control-col-2");var s=o.join(" "),u=t.param.label||Ha(t.name),l=t.param.help?t.param.help(t.value):{description:t.param.description,legend:t.param.legend},c=l.description||l.legend,d=u+(c?". Click for help.":"");return P.jsxs(P.Fragment,{children:[P.jsx(Xs,{className:s,title:d,label:P.jsxs(P.Fragment,{children:[u,c&&P.jsx("button",E({className:"msp-help msp-btn-link msp-btn-icon msp-control-group-expander",onClick:i,title:d||(r.showHelp?"Hide":"Show")+" help",style:{background:"transparent",textAlign:"left",padding:"0"}},{children:P.jsx(sn,{svg:Fl},void 0)}),void 0)]},void 0),control:n},void 0),c&&r.showHelp&&P.jsx("div",E({className:"msp-control-offset"},{children:P.jsx(Prt,{legend:l.legend,description:l.description},void 0)}),void 0),a]},void 0)}var Wv=function(e){Fe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={showHelp:!1},r.toggleHelp=function(){return r.setState({showHelp:!r.state.showHelp})},r}return t.prototype.update=function(r){this.props.onChange({param:this.props.param,name:this.props.name,value:r})},t.prototype.renderAddOn=function(){return null},t.prototype.render=function(){return $v({props:this.props,state:this.state,control:this.renderControl(),toggleHelp:this.toggleHelp,addOn:this.renderAddOn()})},t}(_e.PureComponent),_F=function(e){Fe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.onClick=function(n){r.update(!r.props.value),n.currentTarget.blur()},r}return t.prototype.renderControl=function(){return P.jsxs("button",E({onClick:this.onClick,disabled:this.props.isDisabled},{children:[P.jsx(sn,{svg:this.props.value?m0:aZ},void 0),this.props.value?"On":"Off"]}),void 0)},t}(Wv),Trt=function(e){Fe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isExpanded:!1,isOverPoint:!1,message:r.props.param.defaultValue.length+" points"},r.onHover=function(n){if(r.setState({isOverPoint:!r.state.isOverPoint}),n){r.setState({message:"("+n[0].toFixed(2)+", "+n[1].toFixed(2)+")"});return}r.setState({message:r.props.value.length+" points"})},r.onDrag=function(n){r.setState({message:"("+n[0].toFixed(2)+", "+n[1].toFixed(2)+")"})},r.onChange=function(n){r.props.onChange({name:r.props.name,param:r.props.param,value:n})},r.toggleExpanded=function(n){r.setState({isExpanded:!r.state.isExpanded}),n.currentTarget.blur()},r}return t.prototype.render=function(){var r=this.props.param.label||Ha(this.props.name);return P.jsxs(P.Fragment,{children:[P.jsx(Xs,{label:r,control:P.jsx("button",E({onClick:this.toggleExpanded,disabled:this.props.isDisabled},{children:""+this.state.message}),void 0)},void 0),P.jsx("div",E({className:"msp-control-offset",style:{display:this.state.isExpanded?"block":"none"}},{children:P.jsx(Crt,{data:this.props.param.defaultValue,onChange:this.onChange,onHover:this.onHover,onDrag:this.onDrag},void 0)}),void 0)]},void 0)},t}(_e.PureComponent),Irt=function(e){Fe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={value:"0"},r.update=function(n){var i=H_(r.props.param.step||.01);n=parseFloat(n.toFixed(i)),r.props.onChange({param:r.props.param,name:r.props.name,value:n})},r}return t.prototype.render=function(){var r=this.props.param.label||Ha(this.props.name),n=this.props.param.label||Ha(this.props.name),i=H_(this.props.param.step||.01);return P.jsx(Xs,{title:this.props.param.description,label:n,control:P.jsx(Fc,{numeric:!0,value:parseFloat(this.props.value.toFixed(i)),onEnter:this.props.onEnter,placeholder:r,isDisabled:this.props.isDisabled,onChange:this.update},void 0)},void 0)},t}(_e.PureComponent),Mrt=function(e){Fe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.onChange=function(n){r.update(n)},r}return t.prototype.renderControl=function(){var r=typeof this.props.value>"u"?this.props.param.defaultValue:this.props.value;return P.jsx(tie,{value:r,min:this.props.param.min,max:this.props.param.max,step:this.props.param.step,onChange:this.onChange,onChangeImmediate:this.props.param.immediateUpdate?this.onChange:void 0,disabled:this.props.isDisabled,onEnter:this.props.onEnter},void 0)},t}(Wv),Drt=function(e){Fe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.onChange=function(n){var i=n.target.value;i!==r.props.value&&r.update(i)},r.onKeyPress=function(n){(n.keyCode===13||n.charCode===13||n.key==="Enter")&&r.props.onEnter&&r.props.onEnter(),n.stopPropagation()},r}return t.prototype.renderControl=function(){var r=this.props.param.label||Ha(this.props.name);return P.jsx("input",{type:"text",value:this.props.value||"",placeholder:r,onChange:this.onChange,onKeyPress:this.props.onEnter?this.onKeyPress:void 0,disabled:this.props.isDisabled},void 0)},t}(Wv),Mm=function(e){Fe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.onChange=function(n){typeof r.props.param.defaultValue=="number"?r.update(parseInt(n.target.value,10)):r.update(n.target.value)},r}return t.prototype.update=function(r){this.props.onChange({param:this.props.param,name:this.props.name,value:r})},t.prototype.render=function(){var r=this,n=this.props.value!==void 0&&!this.props.param.options.some(function(i){return i[0]===r.props.value});return P.jsxs("select",E({className:"msp-form-control",title:this.props.title,value:this.props.value!==void 0?this.props.value:this.props.param.defaultValue,onChange:this.onChange,disabled:this.props.isDisabled},{children:[n&&P.jsx("option",E({value:this.props.value},{children:"[Invalid] "+this.props.value}),this.props.value),this.props.param.options.map(function(i){var a=i[0],o=i[1];return P.jsx("option",E({value:a},{children:o}),a)})]}),void 0)},t}(_e.PureComponent),wF=function(e){Fe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={showHelp:!1,showOptions:!1},r.onSelect=function(n){!n||n.value===r.props.value?r.setState({showOptions:!1}):r.setState({showOptions:!1},function(){r.props.onChange({param:r.props.param,name:r.props.name,value:n.value})})},r.toggle=function(){return r.setState({showOptions:!r.state.showOptions})},r.cycle=function(){var n=r.props.param.options,i=n.findIndex(function(o){return o[0]===r.props.value}),a=i===n.length-1?0:i+1;r.props.onChange({param:r.props.param,name:r.props.name,value:n[a][0]})},r.items=vp(function(n){return er.createItemsFromSelectOptions(n.options)}),r.toggleHelp=function(){return r.setState({showHelp:!r.state.showHelp})},r}return t.prototype.renderControl=function(){var r,n=this.items(this.props.param),i=this.props.value!==void 0?er.findItem(n,this.props.value):void 0,a=i?i.label:typeof this.props.value>"u"?(((r=er.getFirstItem(n))===null||r===void 0?void 0:r.label)||"")+" [Default]":"[Invalid] "+this.props.value,o=this.props.param.cycle?this.cycle:this.toggle,s=this.props.param.cycle?"center":"left",u=this.props.param.cycle?this.props.value==="on"?m0:this.props.value==="off"?aZ:void 0:void 0;return P.jsx(Ri,{disabled:this.props.isDisabled,style:{textAlign:s,overflow:"hidden",textOverflow:"ellipsis"},label:a,title:a,icon:u,toggle:o,isSelected:this.state.showOptions},void 0)},t.prototype.renderAddOn=function(){if(!this.state.showOptions)return null;var r=this.items(this.props.param),n=er.findItem(r,this.props.value);return P.jsx(er,{items:r,current:n,onSelect:this.onSelect},void 0)},t.prototype.render=function(){return $v({props:this.props,state:this.state,control:this.renderControl(),toggleHelp:this.toggleHelp,addOn:this.renderAddOn()})},t}(_e.PureComponent),Rrt=function(e){Fe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={showHelp:!1,showOptions:!1},r.onSelect=function(n){!n||n.value===r.props.value?r.setState({showOptions:!1}):r.setState({showOptions:!1},function(){r.props.onChange({param:r.props.param,name:r.props.name,value:{ref:n.value}})})},r.toggle=function(){return r.setState({showOptions:!r.state.showOptions})},r.items=vp(function(n){return er.createItemsFromSelectOptions(n.getOptions())}),r.toggleHelp=function(){return r.setState({showHelp:!r.state.showHelp})},r}return t.prototype.renderControl=function(){var r,n=this.items(this.props.param),i=this.props.value.ref?er.findItem(n,this.props.value.ref):void 0,a=i?i.label:"[Ref] "+((r=this.props.value.ref)!==null&&r!==void 0?r:"");return P.jsx(Ri,{disabled:this.props.isDisabled,style:{textAlign:"left",overflow:"hidden",textOverflow:"ellipsis"},label:a,title:a,toggle:this.toggle,isSelected:this.state.showOptions},void 0)},t.prototype.renderAddOn=function(){if(!this.state.showOptions)return null;var r=this.items(this.props.param),n=er.findItem(r,this.props.value.ref);return P.jsx(er,{items:r,current:n,onSelect:this.onSelect},void 0)},t.prototype.render=function(){return $v({props:this.props,state:this.state,control:this.renderControl(),toggleHelp:this.toggleHelp,addOn:this.renderAddOn()})},t}(_e.PureComponent),krt=function(e){Fe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isExpanded:!1},r.components={0:I.Numeric(0,{step:r.props.param.step},{label:"Min"}),1:I.Numeric(0,{step:r.props.param.step},{label:"Max"})},r.componentChange=function(n){var i=n.name,a=n.value,o=Nt([],r.props.value);o[+i]=a,r.change(o)},r.toggleExpanded=function(n){r.setState({isExpanded:!r.state.isExpanded}),n.currentTarget.blur()},r}return t.prototype.change=function(r){this.props.onChange({name:this.props.name,param:this.props.param,value:r})},t.prototype.render=function(){var r=this.props.value,n=this.props.param.label||Ha(this.props.name),i=H_(this.props.param.step||.01),a="["+r[0].toFixed(i)+", "+r[1].toFixed(i)+"]";return P.jsxs(P.Fragment,{children:[P.jsx(Xs,{label:n,control:P.jsx("button",E({onClick:this.toggleExpanded,disabled:this.props.isDisabled},{children:a}),void 0)},void 0),this.state.isExpanded&&P.jsx("div",E({className:"msp-control-offset"},{children:P.jsx(Un,{params:this.components,values:r,onChange:this.componentChange,onEnter:this.props.onEnter},void 0)}),void 0)]},void 0)},t}(_e.PureComponent),Ort=function(e){Fe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.onChange=function(n){r.update(n)},r}return t.prototype.renderControl=function(){return P.jsx(_rt,{value:this.props.value,min:this.props.param.min,max:this.props.param.max,step:this.props.param.step,onChange:this.onChange,disabled:this.props.isDisabled,onEnter:this.props.onEnter},void 0)},t}(Wv);(function(e){Fe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.onChange=function(n){r.update(at(parseInt(n.target.value)))},r}return t.prototype.stripStyle=function(){return{background:at.toStyle(this.props.value),position:"absolute",bottom:"0",height:"4px",right:"0",left:"0"}},t.prototype.renderControl=function(){return P.jsxs("div",E({style:{position:"relative"}},{children:[P.jsxs("select",E({value:this.props.value,onChange:this.onChange},{children:[grt(this.props.value),vrt()]}),void 0),P.jsx("div",{style:this.stripStyle()},void 0)]}),void 0)},t})(Wv);function Qy(e,t){return t===void 0&&(t=!1),Array.isArray(e)?t?at.toStyle(e[0])+" "+(100*e[1]).toFixed(2)+"%":at.toStyle(e[0]):at.toStyle(e)}var Lrt=ME(function(e){var t=e.map(function(r){return Qy(r,!0)});return"linear-gradient(to right, "+t.join(", ")+")"}),Frt=ME(function(e){for(var t=e.length,r=[Qy(e[0])+" "+100*(1/t)+"%"],n=1,i=t-1;n<i;++n)r.push(Qy(e[n])+" "+100*(n/t)+"%",Qy(e[n])+" "+100*((n+1)/t)+"%");return r.push(Qy(e[t-1])+" "+100*((t-1)/t)+"%"),"linear-gradient(to right, "+r.join(", ")+")"});function EF(e,t){return t===void 0&&(t="0"),{background:Nrt(e.colors,e.kind==="set"),position:"absolute",bottom:"0",height:"4px",right:t,left:"0"}}function Nrt(e,t){return t?Frt(e):Lrt(e)}function Brt(){var e=function(t){var r=$s(t[0]);return P.jsx("div",{style:EF({kind:r.type!=="qualitative"?"interpolate":"set",colors:r.list})},void 0)};return{ColorPresets:{all:er.createItemsFromSelectOptions(XO,{addOn:e}),scale:er.createItemsFromSelectOptions(L4e,{addOn:e}),set:er.createItemsFromSelectOptions(F4e,{addOn:e})},ColorsParam:I.ObjectList({color:I.Color(0)},function(t){var r=t.color;return at.toHexString(r).toUpperCase()}),OffsetColorsParam:I.ObjectList({color:I.Color(0),offset:I.Numeric(0,{min:0,max:1,step:.01})},function(t){var r=t.color,n=t.offset;return at.toHexString(r).toUpperCase()+" ["+n.toFixed(2)+"]"}),IsInterpolatedParam:I.Boolean(!1,{label:"Interpolated"})}}var Qx;function nie(){return Qx||(Qx=Brt(),Qx)}var Urt=function(e){Fe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={showHelp:!1,show:void 0},r.toggleEdit=function(){return r.setState({show:r.state.show==="edit"?void 0:"edit"})},r.togglePresets=function(){return r.setState({show:r.state.show==="presets"?void 0:"presets"})},r.selectPreset=function(n){if(n){r.setState({show:void 0});var i=$s(n.value);r.update({kind:i.type!=="qualitative"?"interpolate":"set",colors:i.list})}},r.colorsChanged=function(n){var i=n.value;r.update({kind:r.props.value.kind,colors:i.map(function(a){return a.color})})},r.isInterpolatedChanged=function(n){var i=n.value;r.update({kind:i?"interpolate":"set",colors:r.props.value.colors})},r.toggleHelp=function(){return r.setState({showHelp:!r.state.showHelp})},r}return t.prototype.update=function(r){this.props.onChange({param:this.props.param,name:this.props.name,value:r})},t.prototype.renderControl=function(){var r=this.props.value;return P.jsxs(P.Fragment,{children:[P.jsxs("button",E({onClick:this.toggleEdit,style:{position:"relative",paddingRight:"33px"}},{children:[r.colors.length===1?"1 color":r.colors.length+" colors",P.jsx("div",{style:EF(r,"33px")},void 0)]}),void 0),P.jsx(Ht,{svg:cE,onClick:this.togglePresets,toggleState:this.state.show==="presets",title:"Color Presets",style:{padding:0,position:"absolute",right:0,top:0,width:"32px"}},void 0)]},void 0)},t.prototype.renderColors=function(){if(!this.state.show)return null;var r=nie(),n=r.ColorPresets,i=r.ColorsParam,a=r.IsInterpolatedParam,o=n[this.props.param.presetKind];if(this.state.show==="presets")return P.jsx(er,{items:o,onSelect:this.selectPreset},void 0);var s=this.props.value.colors.map(function(u){return{color:u}});return P.jsxs("div",E({className:"msp-control-offset"},{children:[P.jsx(AF,{name:"colors",param:i,value:s,onChange:this.colorsChanged,isDisabled:this.props.isDisabled,onEnter:this.props.onEnter},void 0),P.jsx(_F,{name:"isInterpolated",param:a,value:this.props.value.kind==="interpolate",onChange:this.isInterpolatedChanged,isDisabled:this.props.isDisabled,onEnter:this.props.onEnter},void 0)]}),void 0)},t.prototype.render=function(){return $v({props:this.props,state:this.state,control:this.renderControl(),toggleHelp:this.toggleHelp,addOn:this.renderColors()})},t}(_e.PureComponent),jrt=function(e){Fe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={showHelp:!1,show:void 0},r.toggleEdit=function(){return r.setState({show:r.state.show==="edit"?void 0:"edit"})},r.togglePresets=function(){return r.setState({show:r.state.show==="presets"?void 0:"presets"})},r.selectPreset=function(n){if(n){r.setState({show:void 0});var i=$s(n.value);r.update({kind:i.type!=="qualitative"?"interpolate":"set",colors:i.list})}},r.colorsChanged=function(n){var i=n.value,a=i.map(function(o){return[o.color,o.offset]});a.sort(function(o,s){return o[1]-s[1]}),r.update({kind:r.props.value.kind,colors:a})},r.isInterpolatedChanged=function(n){var i=n.value;r.update({kind:i?"interpolate":"set",colors:r.props.value.colors})},r.toggleHelp=function(){return r.setState({showHelp:!r.state.showHelp})},r}return t.prototype.update=function(r){this.props.onChange({param:this.props.param,name:this.props.name,value:r})},t.prototype.renderControl=function(){var r=this.props.value;return P.jsxs(P.Fragment,{children:[P.jsxs("button",E({onClick:this.toggleEdit,style:{position:"relative",paddingRight:"33px"}},{children:[r.colors.length===1?"1 color":r.colors.length+" colors",P.jsx("div",{style:EF(r,"33px")},void 0)]}),void 0),P.jsx(Ht,{svg:cE,onClick:this.togglePresets,toggleState:this.state.show==="presets",title:"Color Presets",style:{padding:0,position:"absolute",right:0,top:0,width:"32px"}},void 0)]},void 0)},t.prototype.renderColors=function(){if(!this.state.show)return null;var r=nie(),n=r.ColorPresets,i=r.OffsetColorsParam,a=r.IsInterpolatedParam,o=n[this.props.param.presetKind];if(this.state.show==="presets")return P.jsx(er,{items:o,onSelect:this.selectPreset},void 0);var s=this.props.value.colors,u=s.map(function(l,c){return Array.isArray(l)?{color:l[0],offset:l[1]}:{color:l,offset:c/s.length}});return u.sort(function(l,c){return l.offset-c.offset}),P.jsxs("div",E({className:"msp-control-offset"},{children:[P.jsx(AF,{name:"colors",param:i,value:u,onChange:this.colorsChanged,isDisabled:this.props.isDisabled,onEnter:this.props.onEnter},void 0),P.jsx(_F,{name:"isInterpolated",param:a,value:this.props.value.kind==="interpolate",onChange:this.isInterpolatedChanged,isDisabled:this.props.isDisabled,onEnter:this.props.onEnter},void 0)]}),void 0)},t.prototype.render=function(){return $v({props:this.props,state:this.state,control:this.renderControl(),toggleHelp:this.toggleHelp,addOn:this.renderColors()})},t}(_e.PureComponent),zrt=function(e){Fe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isExpanded:!1},r.components={0:I.Numeric(0,{step:r.props.param.step},{label:r.props.param.fieldLabels&&r.props.param.fieldLabels.x||"X"}),1:I.Numeric(0,{step:r.props.param.step},{label:r.props.param.fieldLabels&&r.props.param.fieldLabels.y||"Y"}),2:I.Numeric(0,{step:r.props.param.step},{label:r.props.param.fieldLabels&&r.props.param.fieldLabels.z||"Z"})},r.componentChange=function(n){var i=n.name,a=n.value,o=_.copy(_.zero(),r.props.value);o[+i]=a,r.change(o)},r.toggleExpanded=function(n){r.setState({isExpanded:!r.state.isExpanded}),n.currentTarget.blur()},r}return t.prototype.change=function(r){this.props.onChange({name:this.props.name,param:this.props.param,value:r})},t.prototype.render=function(){var r=this.props.value,n=this.props.param.label||Ha(this.props.name),i=H_(this.props.param.step||.01),a="["+r[0].toFixed(i)+", "+r[1].toFixed(i)+", "+r[2].toFixed(i)+"]";return P.jsxs(P.Fragment,{children:[P.jsx(Xs,{label:n,control:P.jsx("button",E({onClick:this.toggleExpanded,disabled:this.props.isDisabled},{children:a}),void 0)},void 0),this.state.isExpanded&&P.jsx("div",E({className:"msp-control-offset"},{children:P.jsx(Un,{params:this.components,values:r,onChange:this.componentChange,onEnter:this.props.onEnter},void 0)}),void 0)]},void 0)},t}(_e.PureComponent),Vrt=function(e){Fe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isExpanded:!1},r.components={json:I.Text(JSON.stringify(ue()),{description:"JSON array with 4x4 matrix in a column major (j * 4 + i indexing) format"})},r.componentChange=function(n){var i=n.name,a=n.value,o=ue.copy(ue(),r.props.value);i==="json"?ue.copy(o,JSON.parse(a)):o[+i]=a,r.change(o)},r.toggleExpanded=function(n){r.setState({isExpanded:!r.state.isExpanded}),n.currentTarget.blur()},r}return t.prototype.change=function(r){this.props.onChange({name:this.props.name,param:this.props.param,value:r})},t.prototype.changeValue=function(r){var n=this;return function(i){var a=ue.copy(ue(),n.props.value);a[r]=i,n.change(a)}},Object.defineProperty(t.prototype,"grid",{get:function(){for(var r=this.props.value,n=[],i=0;i<4;i++){for(var a=[],o=0;o<4;o++)a.push(P.jsx(Fc,{numeric:!0,delayMs:50,value:ue.getValue(r,i,o),onChange:this.changeValue(4*o+i),className:"msp-form-control",blurOnEnter:!0,isDisabled:this.props.isDisabled},o));n.push(P.jsx("div",E({className:"msp-flex-row"},{children:a}),i))}return P.jsx("div",E({className:"msp-parameter-matrix"},{children:n}),void 0)},enumerable:!1,configurable:!0}),t.prototype.render=function(){var r={json:JSON.stringify(this.props.value)},n=this.props.param.label||Ha(this.props.name);return P.jsxs(P.Fragment,{children:[P.jsx(Xs,{label:n,control:P.jsx("button",E({onClick:this.toggleExpanded,disabled:this.props.isDisabled},{children:"44 Matrix"}),void 0)},void 0),this.state.isExpanded&&P.jsxs("div",E({className:"msp-control-offset"},{children:[this.grid,P.jsx(Un,{params:this.components,values:r,onChange:this.componentChange,onEnter:this.props.onEnter},void 0)]}),void 0)]},void 0)},t}(_e.PureComponent),Hrt=function(e){Fe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.onChange=function(n){var i=n.target.value;i!==Pn.getUrl(r.props.value||"")&&r.update(Pn.Url(i))},r.onKeyPress=function(n){(n.keyCode===13||n.charCode===13||n.key==="Enter")&&r.props.onEnter&&r.props.onEnter(),n.stopPropagation()},r}return t.prototype.renderControl=function(){var r=this.props.param.label||Ha(this.props.name);return P.jsx("input",{type:"text",value:Pn.getUrl(this.props.value||""),placeholder:r,onChange:this.onChange,onKeyPress:this.props.onEnter?this.onKeyPress:void 0,disabled:this.props.isDisabled},void 0)},t}(Wv),Grt=function(e){Fe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={showHelp:!1},r.onChangeFile=function(n){r.change(n.target.files[0])},r.toggleHelp=function(){return r.setState({showHelp:!r.state.showHelp})},r}return t.prototype.change=function(r){this.props.onChange({name:this.props.name,param:this.props.param,value:Pn.File(r)})},t.prototype.renderControl=function(){var r=this.props.value;return P.jsxs("div",E({className:"msp-btn msp-btn-block msp-btn-action msp-loader-msp-btn-file",style:{marginTop:"1px"}},{children:[r?r.name:"Select a file..."," ",P.jsx("input",{disabled:this.props.isDisabled,onChange:this.onChangeFile,type:"file",multiple:!1,accept:this.props.param.accept},void 0)]}),void 0)},t.prototype.render=function(){return this.props.param.label?$v({props:this.props,state:this.state,control:this.renderControl(),toggleHelp:this.toggleHelp,addOn:null}):this.renderControl()},t}(_e.PureComponent),qrt=function(e){Fe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={showHelp:!1},r.onChangeFileList=function(n){r.change(n.target.files)},r.toggleHelp=function(){return r.setState({showHelp:!r.state.showHelp})},r}return t.prototype.change=function(r){var n=[];if(r)for(var i=0,a=r.length;i<a;++i)n.push(Pn.File(r[i]));this.props.onChange({name:this.props.name,param:this.props.param,value:n})},t.prototype.renderControl=function(){var r=this.props.value,n=[];if(r)for(var i=0,a=r;i<a.length;i++){var o=a[i];n.push(o.name)}var s=n.length===0?"Select files...":n.length===1?n[0]:n.length+" files selected";return P.jsxs("div",E({className:"msp-btn msp-btn-block msp-btn-action msp-loader-msp-btn-file",style:{marginTop:"1px"}},{children:[s," ",P.jsx("input",{disabled:this.props.isDisabled,onChange:this.onChangeFileList,type:"file",multiple:!0,accept:this.props.param.accept},void 0)]}),void 0)},t.prototype.render=function(){return this.props.param.label?$v({props:this.props,state:this.state,control:this.renderControl(),toggleHelp:this.toggleHelp,addOn:null}):this.renderControl()},t}(_e.PureComponent),$rt=function(e){Fe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isExpanded:!1},r.toggleExpanded=function(n){r.setState({isExpanded:!r.state.isExpanded}),n.currentTarget.blur()},r}return t.prototype.change=function(r){this.props.onChange({name:this.props.name,param:this.props.param,value:r})},t.prototype.toggle=function(r){var n=this;return function(i){n.props.value.indexOf(r)<0?n.change(n.props.value.concat(r)):n.change(n.props.value.filter(function(a){return a!==r})),i.currentTarget.blur()}},t.prototype.render=function(){var r=this,n=this.props.value,i=this.props.param.emptyValue,a=this.props.param.label||Ha(this.props.name);return P.jsxs(P.Fragment,{children:[P.jsx(Xs,{label:a,control:P.jsx("button",E({onClick:this.toggleExpanded,disabled:this.props.isDisabled},{children:n.length===0&&i?i:n.length+" of "+this.props.param.options.length}),void 0)},void 0),this.state.isExpanded&&P.jsx("div",E({className:"msp-control-offset"},{children:this.props.param.options.map(function(o){var s=o[0],u=o[1],l=n.indexOf(s)>=0;return P.jsx(mr,E({onClick:r.toggle(s),disabled:r.props.isDisabled,style:{marginTop:"1px"}},{children:P.jsx("span",E({style:{float:l?"left":"right"}},{children:l?" "+u:u+" "}),void 0)}),s)})}),void 0)]},void 0)},t}(_e.PureComponent),iie=function(e){Fe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isExpanded:!!r.props.param.isExpanded,showHelp:!1},r.onChangeParam=function(n){var i;r.change(E(E({},r.props.value),(i={},i[n.name]=n.value,i)))},r.toggleExpanded=function(){return r.setState({isExpanded:!r.state.isExpanded})},r}return t.prototype.change=function(r){this.props.onChange({name:this.props.name,param:this.props.param,value:r})},t.prototype.pivoted=function(){var r=this.props.param.pivot,n=this.props.param.params,i=n[r],a=y2(i),o=P.jsx(a,{name:r,param:i,value:this.props.value[r],onChange:this.onChangeParam,onEnter:this.props.onEnter,isDisabled:this.props.isDisabled},void 0);if(!this.state.isExpanded)return P.jsxs("div",E({className:"msp-mapped-parameter-group"},{children:[o,P.jsx(Ht,{svg:sv,onClick:this.toggleExpanded,toggleState:this.state.isExpanded,title:"More Options"},void 0)]}),void 0);for(var s=Object.create(null),u=0,l=Object.keys(n);u<l.length;u++){var c=l[u];c!==r&&(s[c]=n[c])}return P.jsxs("div",E({className:"msp-mapped-parameter-group"},{children:[o,P.jsx(Ht,{svg:sv,onClick:this.toggleExpanded,toggleState:this.state.isExpanded,title:"More Options"},void 0),P.jsx("div",E({className:"msp-control-offset"},{children:P.jsx(Un,{params:s,onEnter:this.props.onEnter,values:this.props.value,onChange:this.onChangeParam,isDisabled:this.props.isDisabled},void 0)}),void 0)]}),void 0)},t.prototype.render=function(){var r=this.props.param.params;if(Object.keys(r).length===0)return null;if(this.props.param.pivot)return this.pivoted();var n=this.props.param.label||Ha(this.props.name),i=P.jsx(Un,{params:r,onChange:this.onChangeParam,values:this.props.value,onEnter:this.props.onEnter,isDisabled:this.props.isDisabled},void 0);return this.props.inMapped?P.jsx("div",E({className:"msp-control-offset"},{children:i}),void 0):this.props.param.isFlat?i:P.jsxs("div",E({className:"msp-control-group-wrapper"},{children:[P.jsx("div",E({className:"msp-control-group-header"},{children:P.jsxs("button",E({className:"msp-btn msp-form-control msp-btn-block",onClick:this.toggleExpanded},{children:[P.jsx(sn,{svg:this.state.isExpanded?Kc:Qc},void 0),n]}),void 0)}),void 0),this.state.isExpanded&&P.jsx("div",E({className:"msp-control-offset"},{children:i}),void 0)]}),void 0)},t}(_e.PureComponent),Wrt=function(e){Fe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isExpanded:!1},r.valuesCache={},r.onChangeName=function(n){r.change({name:n.value,params:r.getValues(n.value)})},r.onChangeParam=function(n){r.setValues(r.props.value.name,n.value),r.change({name:r.props.value.name,params:n.value})},r.toggleExpanded=function(){return r.setState({isExpanded:!r.state.isExpanded})},r}return t.prototype.setValues=function(r,n){this.valuesCache[r]=n},t.prototype.getValues=function(r){return r in this.valuesCache?this.valuesCache[r]:this.props.param.map(r).defaultValue},t.prototype.change=function(r){this.props.onChange({name:this.props.name,param:this.props.param,value:r})},t.prototype.areParamsEmpty=function(r){for(var n=0,i=Object.keys(r);n<i.length;n++){var a=i[n];if(!r[a].isHidden)return!1}return!0},t.prototype.render=function(){var r=this,n=this.props.value||this.props.param.defaultValue,i=this.props.param.map(n.name),a=this.props.param.label||Ha(this.props.name),o=y2(i),s=this.props.param.help,u=s?E(E({},this.props.param.select),{help:function(c){return s({name:c,params:r.getValues(c)})}}):this.props.param.select,l=P.jsx(wF,{param:u,isDisabled:this.props.isDisabled,onChange:this.onChangeName,onEnter:this.props.onEnter,name:a,value:n.name},void 0);return o?i.type==="group"&&!i.isFlat?this.areParamsEmpty(i.params)?l:P.jsxs("div",E({className:"msp-mapped-parameter-group"},{children:[l,P.jsx(Ht,{svg:sv,onClick:this.toggleExpanded,toggleState:this.state.isExpanded,title:a+" Properties"},void 0),this.state.isExpanded&&P.jsx(iie,{inMapped:!0,param:i,value:n.params,name:n.name,onChange:this.onChangeParam,onEnter:this.props.onEnter,isDisabled:this.props.isDisabled},void 0)]}),void 0):P.jsxs(P.Fragment,{children:[l,P.jsx(o,{param:i,value:n.params,name:n.name,onChange:this.onChangeParam,onEnter:this.props.onEnter,isDisabled:this.props.isDisabled},void 0)]},void 0):l},t}(_e.PureComponent),aie=function(e){Fe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={current:r.props.value},r.onChangeParam=function(n){var i;r.setState({current:E(E({},r.state.current),(i={},i[n.name]=n.value,i))})},r.apply=function(){r.props.apply(r.state.current)},r}return t.prototype.componentDidUpdate=function(r){(this.props.params!==r.params||this.props.value!==r.value)&&this.setState({current:this.props.value})},t.prototype.render=function(){return P.jsxs(P.Fragment,{children:[P.jsx(Un,{params:this.props.params,onChange:this.onChangeParam,values:this.state.current,onEnter:this.apply,isDisabled:this.props.isDisabled},void 0),P.jsx("button",E({className:"msp-btn msp-btn-block msp-form-control msp-control-top-offset",onClick:this.apply,disabled:this.props.isDisabled},{children:this.props.isUpdate?"Update":"Add"}),void 0)]},void 0)},t}(_e.PureComponent),Xrt=function(e){Fe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isExpanded:!1},r.update=function(n){r.props.actions.update(n,r.props.index)},r.moveUp=function(){r.props.actions.move(r.props.index,-1)},r.moveDown=function(){r.props.actions.move(r.props.index,1)},r.remove=function(){r.setState({isExpanded:!1}),r.props.actions.remove(r.props.index)},r.toggleExpanded=function(n){r.setState({isExpanded:!r.state.isExpanded}),n.currentTarget.blur()},r}return t.prototype.render=function(){return P.jsxs(P.Fragment,{children:[P.jsxs("div",E({className:"msp-param-object-list-item"},{children:[P.jsxs("button",E({className:"msp-btn msp-btn-block msp-form-control",onClick:this.toggleExpanded},{children:[P.jsx("span",{children:this.props.index+1+": "},void 0),this.props.param.getLabel(this.props.value)]}),void 0),P.jsxs("div",{children:[P.jsx(Ht,{svg:uE,title:"Move Up",onClick:this.moveUp,small:!0},void 0),P.jsx(Ht,{svg:lE,title:"Move Down",onClick:this.moveDown,small:!0},void 0),P.jsx(Ht,{svg:eu,title:"Remove",onClick:this.remove,small:!0},void 0)]},void 0)]}),void 0),this.state.isExpanded&&P.jsx("div",E({className:"msp-control-offset"},{children:P.jsx(aie,{params:this.props.param.element,apply:this.update,value:this.props.value,isUpdate:!0,isDisabled:this.props.isDisabled},void 0)}),void 0)]},void 0)},t}(_e.PureComponent),AF=function(e){Fe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isExpanded:!1},r.add=function(n){r.change(Nt(Nt([],r.props.value),[n]))},r.actions={update:function(n,i){var a=r.props.value.slice(0);a[i]=n,r.change(a)},move:function(n,i){var a=r.props.value;if(a.length!==1){var o=(n+i)%a.length;o<0&&(o+=a.length),a=a.slice(0);var s=a[n];a[n]=a[o],a[o]=s,r.change(a)}},remove:function(n){for(var i=r.props.value,a=[],o=0;o<i.length;o++)n!==o&&a.push(i[o]);r.change(a)}},r.toggleExpanded=function(n){r.setState({isExpanded:!r.state.isExpanded}),n.currentTarget.blur()},r}return t.prototype.change=function(r){this.props.onChange({name:this.props.name,param:this.props.param,value:r})},t.prototype.render=function(){var r=this,n=this.props.value,i=this.props.param.label||Ha(this.props.name),a=n.length+" item"+(n.length!==1?"s":"");return P.jsxs(P.Fragment,{children:[P.jsx(Xs,{label:i,control:P.jsx("button",E({onClick:this.toggleExpanded,disabled:this.props.isDisabled},{children:a}),void 0)},void 0),this.state.isExpanded&&P.jsxs("div",E({className:"msp-control-offset"},{children:[this.props.value.map(function(o,s){return P.jsx(Xrt,{param:r.props.param,value:o,index:s,actions:r.actions,isDisabled:r.props.isDisabled},s)}),P.jsx(Pc,E({header:"New Item"},{children:P.jsx(aie,{params:this.props.param.element,apply:this.add,value:this.props.param.ctor(),isDisabled:this.props.isDisabled},void 0)}),void 0)]}),void 0)]},void 0)},t}(_e.PureComponent),Yrt=function(e){Fe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.onChangeCondition=function(n){r.change(r.props.param.conditionedValue(r.props.value,n.value))},r.onChangeParam=function(n){r.change(n.value)},r}return t.prototype.change=function(r){this.props.onChange({name:this.props.name,param:this.props.param,value:r})},t.prototype.render=function(){var r=this.props.value,n=this.props.param.conditionForValue(r),i=this.props.param.conditionParams[n],a=this.props.param.label||Ha(this.props.name),o=y2(i),s=P.jsx(wF,{param:this.props.param.select,isDisabled:this.props.isDisabled,onChange:this.onChangeCondition,onEnter:this.props.onEnter,name:a+" Kind",value:n},void 0);return o?P.jsxs(P.Fragment,{children:[s,P.jsx(o,{param:i,value:r,name:a,onChange:this.onChangeParam,onEnter:this.props.onEnter,isDisabled:this.props.isDisabled},void 0)]},void 0):s},t}(_e.PureComponent),Krt=function(e){Fe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.onChange=function(n){r.props.onChange({name:r.props.name,param:r.props.param,value:r.props.param.toValue(n.value)})},r}return t.prototype.render=function(){var r=this.props.param.fromValue(this.props.value),n=y2(this.props.param.converted);return n?P.jsx(n,{param:this.props.param.converted,value:r,name:this.props.name,onChange:this.onChange,onEnter:this.props.onEnter,isDisabled:this.props.isDisabled},void 0):null},t}(_e.PureComponent),Qrt=function(e){Fe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.onChange=function(n){var i=n.target.value;i!==r.props.value.expression&&r.update({language:r.props.value.language,expression:i})},r.onKeyPress=function(n){(n.keyCode===13||n.charCode===13||n.key==="Enter")&&r.props.onEnter&&r.props.onEnter(),n.stopPropagation()},r}return t.prototype.renderControl=function(){var r=this.props.param.label||Ha(this.props.name);return P.jsx("input",{type:"text",value:this.props.value.expression||"",placeholder:r,onChange:this.onChange,onKeyPress:this.props.onEnter?this.onKeyPress:void 0,disabled:this.props.isDisabled},void 0)},t}(Wv),Zrt=function(e){Fe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.updateParams=function(n){var i;r.plugin.managers.animation.updateParams((i={},i[n.name]=n.value,i))},r.updateCurrentParams=function(n){var i;r.plugin.managers.animation.updateCurrentParams((i={},i[n.name]=n.value,i))},r.startOrStop=function(){var n=r.plugin.managers.animation;n.state.animationState==="playing"?n.stop():(r.props.onStart&&r.props.onStart(),n.start())},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.managers.animation.events.updated,function(){return r.forceUpdate()})},t.prototype.render=function(){var r,n,i=this.plugin.managers.animation;if(i.isEmpty)return null;var a=i.state.animationState==="playing",o=(n=(r=i.current.anim).canApply)===null||n===void 0?void 0:n.call(r,this.plugin);return P.jsxs(P.Fragment,{children:[P.jsx(Un,{params:i.getParams(),values:i.state.params,onChange:this.updateParams,isDisabled:a},void 0),P.jsx(Un,{params:i.current.params,values:i.current.paramValues,onChange:this.updateCurrentParams,isDisabled:a},void 0),P.jsx("div",E({className:"msp-flex-row"},{children:P.jsx(mr,E({icon:i.state.animationState!=="playing"?void 0:uZ,onClick:this.startOrStop,disabled:o!==void 0&&o.canApply===!1},{children:i.state.animationState==="playing"?"Stop":o===void 0||o.canApply?"Start":o.reason||"Start"}),void 0)}),void 0)]},void 0)},t}(gr),oie="overpaint-controls";function EH(e,t,r,n,i){return ce(this,void 0,void 0,function(){var a=this;return de(this,function(o){switch(o.label){case 0:return[4,Jrt(e,t,function(s,u,l){return ce(a,void 0,void 0,function(){var c,d,f,p,v,v;return de(this,function(h){switch(h.label){case 0:return i&&i.length>0&&!i.includes(u.params.values.type.name)?[2]:(c=u.obj.data.sourceData,[4,n(c.root)]);case 1:return d=h.sent(),ar.isEmpty(d)?[2]:(f={bundle:rn.fromLoci(d),color:r===-1?at(0):r,clear:r===-1},l?(p=Nt(Nt([],l.params.values.layers),[f]),v=AH(p,c),s.to(l).update(qi.toBundle(v))):(v=AH([f],c),s.to(u.transform.ref).apply(rt.Representation.OverpaintStructureRepresentation3DFromBundle,qi.toBundle(v),{tags:oie})),[2])}})})})];case 1:return o.sent(),[2]}})})}function Jrt(e,t,r){return ce(this,void 0,void 0,function(){var n,i,a,o,s,u,l,c,d;return de(this,function(f){switch(f.label){case 0:n=e.state.data,i=n.build(),a=0,o=t,f.label=1;case 1:if(!(a<o.length))return[3,6];s=o[a],u=0,l=s.representations,f.label=2;case 2:return u<l.length?(c=l[u],d=n.select(ir.Generators.ofTransformer(rt.Representation.OverpaintStructureRepresentation3DFromBundle,c.cell.transform.ref).withTag(oie)),[4,r(i,c.cell,d[0])]):[3,5];case 3:f.sent(),f.label=4;case 4:return u++,[3,2];case 5:return a++,[3,1];case 6:return[2,i.commit({doNotUpdateCurrent:!0})]}})})}function AH(e,t){var r=qi.ofBundle(e,t.root),n=qi.merge(r);return qi.filter(n,t)}var sie="clipping-controls";function ent(e,t,r,n,i){return ce(this,void 0,void 0,function(){var a=this;return de(this,function(o){switch(o.label){case 0:return[4,tnt(e,t,function(s,u,l){return ce(a,void 0,void 0,function(){var c,d,f,p,v,v;return de(this,function(h){switch(h.label){case 0:return i&&i.length>0&&!i.includes(u.params.values.type.name)?[2]:(c=u.obj.data.sourceData,[4,n(c.root)]);case 1:return d=h.sent(),ar.isEmpty(d)?[2]:(f={bundle:rn.fromLoci(d),groups:r},l?(p=Nt(Nt([],l.params.values.layers),[f]),v=PH(p,c),s.to(l).update(on.toBundle(v))):(v=PH([f],c),s.to(u.transform.ref).apply(rt.Representation.ClippingStructureRepresentation3DFromBundle,on.toBundle(v),{tags:sie})),[2])}})})})];case 1:return o.sent(),[2]}})})}function tnt(e,t,r){return ce(this,void 0,void 0,function(){var n,i,a,o,s,u,l,c,d;return de(this,function(f){switch(f.label){case 0:n=e.state.data,i=n.build(),a=0,o=t,f.label=1;case 1:if(!(a<o.length))return[3,6];s=o[a],u=0,l=s.representations,f.label=2;case 2:return u<l.length?(c=l[u],d=n.select(ir.Generators.ofTransformer(rt.Representation.ClippingStructureRepresentation3DFromBundle,c.cell.transform.ref).withTag(sie)),[4,r(i,c.cell,d[0])]):[3,5];case 3:f.sent(),f.label=4;case 4:return u++,[3,2];case 5:return a++,[3,1];case 6:return[2,i.commit({doNotUpdateCurrent:!0})]}})})}function PH(e,t){var r=on.ofBundle(e,t.root),n=on.merge(r);return on.filter(n,t)}var uie="transparency-controls";function rnt(e,t,r,n,i){return ce(this,void 0,void 0,function(){var a=this;return de(this,function(o){switch(o.label){case 0:return[4,nnt(e,t,function(s,u,l){return ce(a,void 0,void 0,function(){var c,d,f,p,v,v;return de(this,function(h){switch(h.label){case 0:return i&&i.length>0&&!i.includes(u.params.values.type.name)?[2]:(c=u.obj.data.sourceData,[4,n(c.root)]);case 1:return d=h.sent(),ar.isEmpty(d)?[2]:(f={bundle:rn.fromLoci(d),value:r},l?(p=Nt(Nt([],l.params.values.layers),[f]),v=TH(p,c),s.to(l).update($i.toBundle(v))):(v=TH([f],c),s.to(u.transform.ref).apply(rt.Representation.TransparencyStructureRepresentation3DFromBundle,$i.toBundle(v),{tags:uie})),[2])}})})})];case 1:return o.sent(),[2]}})})}function nnt(e,t,r){return ce(this,void 0,void 0,function(){var n,i,a,o,s,u,l,c,d;return de(this,function(f){switch(f.label){case 0:n=e.state.data,i=n.build(),a=0,o=t,f.label=1;case 1:if(!(a<o.length))return[3,6];s=o[a],u=0,l=s.representations,f.label=2;case 2:return u<l.length?(c=l[u],d=n.select(ir.Generators.ofTransformer(rt.Representation.TransparencyStructureRepresentation3DFromBundle,c.cell.transform.ref).withTag(uie)),[4,r(i,c.cell,d[0])]):[3,5];case 3:f.sent(),f.label=4;case 4:return u++,[3,2];case 5:return a++,[3,1];case 6:return[2,i.commit({doNotUpdateCurrent:!0})]}})})}function TH(e,t){var r=$i.ofBundle(e,t.root),n=$i.merge(r);return $i.filter(n,t)}var _v=function(e){Fe(t,e);function t(r){var n=e.call(this,{options:I.getDefaultValues(t.OptionsParams)})||this;return n.plugin=r,n.events={optionsUpdated:n.ev()},n}return Object.defineProperty(t.prototype,"currentStructures",{get:function(){return this.plugin.managers.structure.hierarchy.selection.structures},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"pivotStructure",{get:function(){return this.currentStructures[0]},enumerable:!1,configurable:!0}),t.prototype.setOptions=function(r){return ce(this,void 0,void 0,function(){var n,i,a,o,s,u,l,c,d=this;return de(this,function(f){for(n=r.interactions!==this.state.options.interactions,this.updateState({options:r}),this.events.optionsUpdated.next(),i=this.dataState.build(),a=0,o=this.currentStructures;a<o.length;a++)for(s=o[a],u=0,l=s.components;u<l.length;u++)c=l[u],this.updateReprParams(i,c);return[2,this.plugin.dataTransaction(function(){return ce(d,void 0,void 0,function(){return de(this,function(p){switch(p.label){case 0:return[4,i.commit()];case 1:return p.sent(),[4,this.plugin.state.updateBehavior(bF,function(v){v.ignoreHydrogens=!r.showHydrogens})];case 2:return p.sent(),n?[4,this.updateInterationProps()]:[3,4];case 3:p.sent(),p.label=4;case 4:return[2]}})})})]})})},t.prototype.updateReprParams=function(r,n){for(var i=this.state.options,a=i.showHydrogens,o=i.visualQuality,s=!a,u=0,l=n.representations;u<l.length;u++){var c=l[u];if(c.cell.transform.transformer===cw){var d=c.cell.transform.params;(!!d.type.params.ignoreHydrogens!==s||d.type.params.quality!==o)&&r.to(c.cell).update(function(f){f.type.params.ignoreHydrogens=s,f.type.params.quality=o})}}},t.prototype.updateInterationProps=function(){var r,n,i;return ce(this,void 0,void 0,function(){var a,o,s,u,l,c,d,f=this;return de(this,function(p){switch(p.label){case 0:a=0,o=this.currentStructures,p.label=1;case 1:return a<o.length?(s=o[a],u=Wn.getParams((r=s.cell.obj)===null||r===void 0?void 0:r.data),s.properties?(l=(n=s.properties.cell.transform.params)===null||n===void 0?void 0:n.properties[Wn.descriptor.name],I.areEqual(u,l,this.state.options.interactions)?[3,5]:[4,this.dataState.build().to(s.properties.cell).update(function(v){v.properties[Wn.descriptor.name]=f.state.options.interactions}).commit()]):[3,3]):[3,6];case 2:return p.sent(),[3,5];case 3:return c=this.plugin.customStructureProperties.getParams((i=s.cell.obj)===null||i===void 0?void 0:i.data),d=I.getDefaultValues(c),I.areEqual(u,d.properties[Wn.descriptor.name],this.state.options.interactions)?[3,5]:(d.properties[Wn.descriptor.name]=this.state.options.interactions,[4,this.plugin.builders.structure.insertStructureProperties(s.cell,d)]);case 4:p.sent(),p.label=5;case 5:return a++,[3,1];case 6:return[2]}})})},t.prototype.applyPreset=function(r,n,i){var a=this;return this.plugin.dataTransaction(function(){return ce(a,void 0,void 0,function(){var o,s,u,l;return de(this,function(c){switch(c.label){case 0:o=0,s=r,c.label=1;case 1:return o<s.length?(u=s[o],[4,this.plugin.builders.structure.representation.applyPreset(u.cell,n,i)]):[3,5];case 2:return l=c.sent(),[4,this.syncPreset(u,l)];case 3:c.sent(),c.label=4;case 4:return o++,[3,1];case 5:return[2]}})})},{canUndo:"Preset"})},t.prototype.syncPreset=function(r,n){if(!n||!n.components)return this.clearComponents([r]);var i=new Set;if(ju(n.components,function(y){y&&i.add(y.ref)}),n.representations&&ju(n.representations,function(y){y&&i.add(y.ref)}),i.size===0)return this.clearComponents([r]);for(var a=!1,o=this.dataState.build(),s=function(y){i.has(y.cell.transform.ref)||(a=!0,o.delete(y.cell))},u=0,l=r.components;u<l.length;u++){var c=l[u];s(c);for(var d=0,f=c.representations;d<f.length;d++){var p=f[d];s(p)}if(c.genericRepresentations)for(var v=0,h=c.genericRepresentations;v<h.length;v++){var p=h[v];s(p)}}if(r.genericRepresentations)for(var m=0,g=r.genericRepresentations;m<g.length;m++){var p=g[m];s(p)}if(a)return o.commit()},t.prototype.clear=function(r){return this.clearComponents(r)},t.prototype.selectThis=function(r){var n,i=this.plugin.managers.structure.selection;i.clear();for(var a=0,o=r;a<o.length;a++){var s=o[a],u=We.toSubStructureElementLoci(s.structure.cell.obj.data,(n=s.cell.obj)===null||n===void 0?void 0:n.data);i.fromLoci("set",u)}},t.prototype.canBeModified=function(r){return this.plugin.builders.structure.isComponentTransform(r.cell)},t.prototype.modifyByCurrentSelection=function(r,n){var i=this;return this.plugin.runTask($e.create("Modify Component",function(a){return ce(i,void 0,void 0,function(){var o,s,u,l,c;return de(this,function(d){switch(d.label){case 0:for(o=this.dataState.build(),s=0,u=r;s<u.length;s++)l=u[s],this.canBeModified(l)&&(c=this.plugin.managers.structure.selection.getStructure(l.structure.cell.obj.data),!(!c||c.elementCount===0)&&this.modifyComponent(o,l,c,n));return[4,this.dataState.updateTree(o,{canUndo:"Modify Selection"}).runInContext(a)];case 1:return d.sent(),[2]}})})}))},t.prototype.toggleVisibility=function(r,n){if(r.length!==0)if(n)for(var u=r[0].representations.indexOf(n),i=!n.cell.state.isHidden,l=0,c=r;l<c.length;l++){var s=c[l],d=s.representations[u];d&&Sv(this.dataState,d.cell.transform.ref,i)}else for(var i=!r[0].cell.state.isHidden,a=0,o=r;a<o.length;a++){var s=o[a];Sv(this.dataState,s.cell.transform.ref,i)}},t.prototype.removeRepresentations=function(r,n){if(r.length!==0){var i=[];if(n){var a=r[0].representations.indexOf(n);if(a<0)return;for(var o=0,s=r;o<s.length;o++){var u=s[o];u.representations[a]&&i.push(u.representations[a])}}else for(var l=0,c=r;l<c.length;l++)for(var u=c[l],d=0,f=u.representations;d<f.length;d++){var p=f[d];i.push(p)}return this.plugin.managers.structure.hierarchy.remove(i,!0)}},t.prototype.updateRepresentations=function(r,n,i){if(r.length===0)return Promise.resolve();var a=r[0].representations.indexOf(n);if(a<0)return Promise.resolve();for(var o=this.dataState.build(),s=0,u=r;s<u.length;s++){var l=u[s],c=l.representations[a];c&&c.cell.transform.transformer===n.cell.transform.transformer&&o.to(c.cell).update(i)}return o.commit({canUndo:"Update Representation"})},t.prototype.updateRepresentationsTheme=function(r,n){var i,a,o,s;if(r.length!==0){for(var u=this.dataState.build(),l=0,c=r;l<c.length;l++)for(var d=c[l],f=function(g){var y=g.cell.transform.params,b=typeof n=="function"?n(d,g):n,S=b.color==="default"?oR(p.plugin,(i=d.structure.cell.obj)===null||i===void 0?void 0:i.data,y==null?void 0:y.type.name):b.color?oR(p.plugin,(a=d.structure.cell.obj)===null||a===void 0?void 0:a.data,y==null?void 0:y.type.name,b.color,b.colorParams):void 0,x=b.size==="default"?$V(p.plugin,(o=d.structure.cell.obj)===null||o===void 0?void 0:o.data,y==null?void 0:y.type.name):b.color?$V(p.plugin,(s=d.structure.cell.obj)===null||s===void 0?void 0:s.data,y==null?void 0:y.type.name,b.size,b.sizeParams):void 0;(S||x)&&u.to(g.cell).update(function(C){S&&(C.colorTheme=S),x&&(C.sizeTheme=x)})},p=this,v=0,h=d.representations;v<h.length;v++){var m=h[v];f(m)}return u.commit({canUndo:"Update Theme"})}},t.prototype.addRepresentation=function(r,n){var i=this;if(r.length!==0){var a=this.state.options,o=a.showHydrogens,s=a.visualQuality,u=!o,l={ignoreHydrogens:u,quality:s};return this.plugin.dataTransaction(function(){return ce(i,void 0,void 0,function(){var c,d,f;return de(this,function(p){switch(p.label){case 0:c=0,d=r,p.label=1;case 1:return c<d.length?(f=d[c],[4,this.plugin.builders.structure.representation.addRepresentation(f.cell,{type:this.plugin.representation.structure.registry.get(n),typeParams:l})]):[3,4];case 2:p.sent(),p.label=3;case 3:return c++,[3,1];case 4:return[2]}})})},{canUndo:"Add Representation"})}},t.prototype.tryFindComponent=function(r,n){var i=this;if(r.components.length!==0)return this.plugin.runTask($e.create("Find Component",function(a){return ce(i,void 0,void 0,function(){var o,s,u,l,c,d,f,p,v,h;return de(this,function(m){switch(m.label){case 0:return o=(v=r.cell.obj)===null||v===void 0?void 0:v.data,o?(l=(u=mt).unionStructure,[4,n.getSelection(this.plugin,a,o)]):[2];case 1:for(s=l.apply(u,[m.sent()]),c=0,d=r.components;c<d.length;c++)if(f=d[c],p=(h=f.cell.obj)===null||h===void 0?void 0:h.data,!(!p||!f.cell.parent)&&R6e(s,p))return[2,f.cell];return[2]}})})}))},t.prototype.add=function(r,n){return ce(this,void 0,void 0,function(){var i=this;return de(this,function(a){return[2,this.plugin.dataTransaction(function(){return ce(i,void 0,void 0,function(){var o,s,u,l,c,d,f,p,v,h,m;return de(this,function(g){switch(g.label){case 0:if(o=n||this.currentStructures,o.length===0)return[2];s=this.state.options,u=s.showHydrogens,l=s.visualQuality,c=!u,d={ignoreHydrogens:c,quality:l},f=mn.create22(),p=0,v=o,g.label=1;case 1:return p<v.length?(h=v[p],m=void 0,r.options.checkExisting?[4,this.tryFindComponent(h,r.selection)]:[3,3]):[3,8];case 2:m=g.sent(),g.label=3;case 3:return m?[3,5]:[4,this.plugin.builders.structure.tryCreateComponentFromSelection(h.cell,r.selection,f,{label:r.options.label||(r.selection===mi.current?"Custom Selection":"")})];case 4:m=g.sent(),g.label=5;case 5:return r.representation==="none"||!m?[3,7]:[4,this.plugin.builders.structure.representation.addRepresentation(m,{type:this.plugin.representation.structure.registry.get(r.representation),typeParams:d})];case 6:g.sent(),g.label=7;case 7:return p++,[3,1];case 8:return[2]}})})},{canUndo:"Add Selection"})]})})},t.prototype.applyTheme=function(r,n){return ce(this,void 0,void 0,function(){var i=this;return de(this,function(a){return[2,this.plugin.dataTransaction(function(o){return ce(i,void 0,void 0,function(){var s,u,l,c,d,f,f,f,p=this;return de(this,function(v){switch(v.label){case 0:if(s=n||this.currentStructures,s.length===0)return[2];u=function(h){return ce(p,void 0,void 0,function(){var m,g;return de(this,function(y){switch(y.label){case 0:return g=(m=mt).toLociWithSourceUnits,[4,r.selection.getSelection(this.plugin,o,h)];case 1:return[2,g.apply(m,[y.sent()])]}})})},l=0,c=s,v.label=1;case 1:return l<c.length?(d=c[l],r.action.name!=="reset"?[3,3]:[4,EH(this.plugin,d.components,-1,u,r.representations)]):[3,10];case 2:return v.sent(),[3,9];case 3:return r.action.name!=="color"?[3,5]:(f=r.action.params,[4,EH(this.plugin,d.components,f.color,u,r.representations)]);case 4:return v.sent(),[3,9];case 5:return r.action.name!=="transparency"?[3,7]:(f=r.action.params,[4,rnt(this.plugin,d.components,f.value,u,r.representations)]);case 6:return v.sent(),[3,9];case 7:return r.action.name!=="clipping"?[3,9]:(f=r.action.params,[4,ent(this.plugin,d.components,on.Groups.fromNames(f.excludeGroups),u,r.representations)]);case 8:v.sent(),v.label=9;case 9:return l++,[3,1];case 10:return[2]}})})},{canUndo:"Apply Theme"})]})})},t.prototype.modifyComponent=function(r,n,i,a){var o,s,u,l=(o=n.cell.obj)===null||o===void 0?void 0:o.data;if(l&&!((a==="subtract"||a==="intersect")&&!TE(l,i))){var c=(s=n.structure.cell.obj)===null||s===void 0?void 0:s.data,d=a==="union"?Ib(c,[l,i]):a==="intersect"?UJ(l,i):OL(l,i);if(d.elementCount===0)r.delete(n.cell.transform.ref);else{var f=rn.fromSubStructure(c,d),p={type:{name:"bundle",params:f},nullIfEmpty:!0,label:(u=n.cell.obj)===null||u===void 0?void 0:u.label};r.to(n.cell).update(p)}}},t.prototype.updateLabel=function(r,n){var i,a,o={type:(i=r.cell.params)===null||i===void 0?void 0:i.values.type,nullIfEmpty:(a=r.cell.params)===null||a===void 0?void 0:a.values.nullIfEmpty,label:n};this.dataState.build().to(r.cell).update(o).commit()},Object.defineProperty(t.prototype,"dataState",{get:function(){return this.plugin.state.data},enumerable:!1,configurable:!0}),t.prototype.clearComponents=function(r){for(var n=this.dataState.build(),i=0,a=r;i<a.length;i++)for(var o=a[i],s=0,u=o.components;s<u.length;s++){var l=u[s];n.delete(l.cell.transform.ref)}return n.commit({canUndo:"Clear Selections"})},t}(kd);(function(e){e.OptionsParams={showHydrogens:I.Boolean(!0,{description:"Toggle display of hydrogen atoms in representations"}),visualQuality:I.Select("auto",_L,{description:"Control the visual/rendering quality of representations"}),interactions:I.Group(Wn.defaultParams,{label:"Non-covalent Interactions"})};function t(a,o){var s=a.query.structure.registry.options;return o=E({pivot:a.managers.structure.component.pivotStructure,allowNone:!0,hideSelection:!1,checkExisting:!1},o),{selection:I.Select(s[1][0],s,{isHidden:o==null?void 0:o.hideSelection}),representation:i(a,o==null?void 0:o.pivot,o!=null&&o.allowNone?[["none","< Create Later >"]]:[]),options:I.Group({label:I.Text(""),checkExisting:I.Boolean(!!(o!=null&&o.checkExisting),{help:function(){return{description:"Checks if a selection with the specifield elements already exists to avoid creating duplicate components."}}})})}}e.getAddParams=t;function r(a,o){var s=a.query.structure.registry.options;return{selection:I.Select(s[1][0],s,{isHidden:!1}),action:I.MappedStatic("color",{color:I.Group({color:I.Color(fr.blue,{isExpanded:!0})},{isFlat:!0}),reset:I.EmptyGroup({label:"Reset Color"}),transparency:I.Group({value:I.Numeric(.5,{min:0,max:1,step:.01})},{isFlat:!0}),clipping:I.Group({excludeGroups:I.MultiSelect([],I.objectToOptions(on.Groups.Names))},{isFlat:!0})}),representations:I.MultiSelect([],n(a,o),{emptyValue:"All"})}}e.getThemeParams=r;function n(a,o){var s,u;return!((s=o==null?void 0:o.cell.obj)===null||s===void 0)&&s.data?a.representation.structure.registry.getApplicableTypes((u=o.cell.obj)===null||u===void 0?void 0:u.data):a.representation.structure.registry.types}e.getRepresentationTypes=n;function i(a,o,s,u){var l=Nt(Nt([],s),n(a,o));return I.Select(l[0][0],l,{label:u})}})(_v||(_v={}));var A1;(function(e){function t(a,o){return{key:a,data:o}}function r(a){return{entries:Y5(),capacity:Math.max(1,a)}}e.create=r;function n(a,o){for(var s=a.entries.first;s;s=s.next)if(s.value.key===o)return a.entries.remove(s),a.entries.addLast(s.value),s.value.data}e.get=n;function i(a,o,s){var u=void 0;if(a.entries.count>=a.capacity){var l=a.entries.first;u=l.value.data,a.entries.remove(l)}return a.entries.addLast(t(o,s)),u}e.set=i})(A1||(A1={}));var ja=function(e){Fe(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t}(ge.CreateBehavior({name:"Volume Streaming"}));(function(e){e.RootTag="volume-streaming-info";function t(o,s,u,l,c){var d,f,p,v;return c===void 0&&(c={}),I.Group({isoValue:Ct.createIsoValueParam((d=c.isoValue)!==null&&d!==void 0?d:u,l),color:I.Color((f=c.color)!==null&&f!==void 0?f:s),wireframe:I.Boolean((p=c.wireframe)!==null&&p!==void 0?p:!1),opacity:I.Numeric((v=c.opacity)!==null&&v!==void 0?v:.3,{min:0,max:1,step:.01})},{label:o,isExpanded:!0})}var r={byteOffset:0,rate:1,sampleCount:[1,1,1],valuesInfo:[{mean:0,min:-1,max:1,sigma:.1},{mean:0,min:-1,max:1,sigma:.1}]};function n(o){o===void 0&&(o={});var s=o.data,u=o.defaultView,l=o.channelParams,c=new Map;s&&s.entries.forEach(function(p){return c.set(p.dataId,p)});var d=s?s.entries.map(function(p){return[p.dataId,p.dataId]}):[],f=s?s.entries[0].dataId:"";return{entry:I.Mapped(f,d,function(p){return I.Group(i({entryData:c.get(p),defaultView:u,structure:s&&s.structure,channelParams:l}))})}}e.createParams=n;function i(o){var s=o.entryData,u=o.defaultView,l=o.structure,c=o.channelParams,d=c===void 0?{}:c,f=s||{kind:"em",header:{sampling:[r],availablePrecisions:[{precision:0,maxVoxels:0}]},emDefaultContourLevel:Ct.IsoValue.relative(0)},p=l&&l.boundary.box||Xt();return{view:I.MappedStatic(u||(f.kind==="em"?"cell":"selection-box"),{off:I.Group({}),box:I.Group({bottomLeft:I.Vec3(p.min),topRight:I.Vec3(p.max)},{description:"Static box defined by cartesian coords.",isFlat:!0}),"selection-box":I.Group({radius:I.Numeric(5,{min:0,max:50,step:.5},{description:"Radius in  within which the volume is shown."}),bottomLeft:I.Vec3(_.create(0,0,0),{},{isHidden:!0}),topRight:I.Vec3(_.create(0,0,0),{},{isHidden:!0})},{description:"Box around focused element.",isFlat:!0}),cell:I.Group({}),auto:I.Group({radius:I.Numeric(5,{min:0,max:50,step:.5},{description:"Radius in  within which the volume is shown."}),selectionDetailLevel:I.Select(Math.min(6,f.header.availablePrecisions.length-1),f.header.availablePrecisions.map(function(v,h){return[h,h+1+" [ "+(Math.pow(v.maxVoxels,1/3)|0)+"^3 cells ]"]}),{label:"Selection Detail",description:"Determines the maximum number of voxels. Depending on the size of the volume options are in the range from 0 (0.52M voxels) to 6 (25.17M voxels)."}),isSelection:I.Boolean(!1,{isHidden:!0}),bottomLeft:I.Vec3(p.min,{},{isHidden:!0}),topRight:I.Vec3(p.max,{},{isHidden:!0})},{description:"Box around focused element.",isFlat:!0})},{options:e.ViewTypeOptions,description:'Controls what of the volume is displayed. "Off" hides the volume alltogether. "Bounded box" shows the volume inside the given box. "Around Interaction" shows the volume around the focused element/atom. "Whole Structure" shows the volume for the whole structure.'}),detailLevel:I.Select(Math.min(3,f.header.availablePrecisions.length-1),f.header.availablePrecisions.map(function(v,h){return[h,h+1+" [ "+(Math.pow(v.maxVoxels,1/3)|0)+"^3 cells ]"]}),{description:"Determines the maximum number of voxels. Depending on the size of the volume options are in the range from 0 (0.52M voxels) to 6 (25.17M voxels)."}),channels:f.kind==="em"?I.Group({em:t("EM",at(6524815),f.emDefaultContourLevel||Ct.IsoValue.relative(1),f.header.sampling[0].valuesInfo[0],d.em)},{isFlat:!0}):I.Group({"2fo-fc":t("2Fo-Fc",at(3367602),Ct.IsoValue.relative(1.5),f.header.sampling[0].valuesInfo[0],d["2fo-fc"]),"fo-fc(+ve)":t("Fo-Fc(+ve)",at(3390259),Ct.IsoValue.relative(3),f.header.sampling[0].valuesInfo[1],d["fo-fc(+ve)"]),"fo-fc(-ve)":t("Fo-Fc(-ve)",at(12268339),Ct.IsoValue.relative(-3),f.header.sampling[0].valuesInfo[1],d["fo-fc(-ve)"])},{isFlat:!0})}}e.createEntryParams=i,e.ViewTypeOptions=[["off","Off"],["box","Bounded Box"],["selection-box","Around Focus"],["cell","Whole Structure"],["auto","Auto"]],e.ChannelTypeOptions=[["em","em"],["2fo-fc","2fo-fc"],["fo-fc(+ve)","fo-fc(+ve)"],["fo-fc(-ve)","fo-fc(-ve)"]];var a=function(o){Fe(s,o);function s(u,l){var c=o.call(this,u,{})||this;return c.plugin=u,c.data=l,c.cache=A1.create(25),c.params={},c.lastLoci=Nr,c.ref="",c.channels={},c._invTransform=ue(),c.infoMap=new Map,c.data.entries.forEach(function(d){return c.infoMap.set(d.dataId,d)}),c}return Object.defineProperty(s.prototype,"info",{get:function(){return this.infoMap.get(this.params.entry.name)},enumerable:!1,configurable:!0}),s.prototype.queryData=function(u){return ce(this,void 0,void 0,function(){var l,c,d,f,p,v,h,m,g;return de(this,function(y){switch(y.label){case 0:return l=eA(this.data.serverUrl,this.info.kind+"/"+this.info.dataId.toLowerCase()),u?(c=u.min,d=u.max,l+="/box"+("/"+c.map(function(b){return Math.round(1e3*b)/1e3}).join(","))+("/"+d.map(function(b){return Math.round(1e3*b)/1e3}).join(","))):l+="/cell",f=this.params.entry.params.detailLevel,this.params.entry.params.view.name==="auto"&&this.params.entry.params.view.params.isSelection&&(f=this.params.entry.params.view.params.selectionDetailLevel),l+="?detail="+f,p=A1.get(this.cache,l),p?[2,p.data]:(v=Pn.getUrlAsset(this.plugin.managers.asset,l),[4,this.plugin.runTask(this.plugin.managers.asset.resolve(v,"binary"))]);case 1:return h=y.sent(),[4,this.parseCif(h.data)];case 2:return m=y.sent(),m?(g=A1.set(this.cache,l,{data:m,asset:h}),g&&g.asset.dispose(),[2,m]):[2]}})})},s.prototype.parseCif=function(u){return ce(this,void 0,void 0,function(){var l,c,d,f,p,v;return de(this,function(h){switch(h.label){case 0:return[4,this.plugin.runTask(td.parseBinary(u))];case 1:if(l=h.sent(),l.isError)return this.plugin.log.error("VolumeStreaming, parsing CIF: "+l.toString()),[2];if(l.result.blocks.length<2)return this.plugin.log.error("VolumeStreaming: Invalid data."),[2];c={},d=1,h.label=2;case 2:return d<l.result.blocks.length?(f=l.result.blocks[d],p=td.schema.densityServer(f),[4,this.plugin.runTask(ote(p))]):[3,5];case 3:v=h.sent(),c[f.header]=v,h.label=4;case 4:return d++,[3,2];case 5:return[2,c]}})})},s.prototype.updateSelectionBoxParams=function(u){if(this.params.entry.params.view.name==="selection-box"){var l=this.plugin.state.data,c=E(E({},this.params),{entry:{name:this.params.entry.name,params:E(E({},this.params.entry.params),{view:{name:"selection-box",params:{radius:this.params.entry.params.view.params.radius,bottomLeft:u.min,topRight:u.max}}})}}),d=l.build().to(this.ref).update(c);_t.State.Update(this.plugin,{state:l,tree:d,options:{doNotUpdateCurrent:!0}})}},s.prototype.updateAutoParams=function(u,l){if(this.params.entry.params.view.name==="auto"){var c=this.plugin.state.data,d=E(E({},this.params),{entry:{name:this.params.entry.name,params:E(E({},this.params.entry.params),{view:{name:"auto",params:{radius:this.params.entry.params.view.params.radius,selectionDetailLevel:this.params.entry.params.view.params.selectionDetailLevel,isSelection:l,bottomLeft:(u==null?void 0:u.min)||_.zero(),topRight:(u==null?void 0:u.max)||_.zero()}}})}}),f=c.build().to(this.ref).update(d);_t.State.Update(this.plugin,{state:c,tree:f,options:{doNotUpdateCurrent:!0}})}},s.prototype.getStructureRoot=function(){return this.plugin.state.data.select(ir.Generators.byRef(this.ref).rootOfType(ge.Molecule.Structure))[0]},s.prototype.register=function(u){var l=this;this.ref=u,this.subscribeObservable(this.plugin.state.events.object.removed,function(c){!ge.Molecule.Structure.is(c.obj)||!Re.is(l.lastLoci)||l.lastLoci.structure===c.obj.data&&(l.lastLoci=Nr)}),this.subscribeObservable(this.plugin.state.events.object.updated,function(c){!ge.Molecule.Structure.is(c.oldObj)||!Re.is(l.lastLoci)||l.lastLoci.structure===c.oldObj.data&&(l.lastLoci=Nr)}),this.subscribeObservable(this.plugin.managers.structure.focus.behaviors.current,function(c){if(l.plugin.state.data.tree.children.has(l.ref)){var d=c?c.loci:Nr;switch(l.params.entry.params.view.name){case"auto":l.updateAuto(d);break;case"selection-box":l.updateSelectionBox(d);break;default:l.lastLoci=d;break}}})},s.prototype.unregister=function(){for(var u=this.cache.entries.first;u;)u.value.data.asset.dispose(),u=u.next},s.prototype.getBoxFromLoci=function(u){var l,c,d;if(ar.isEmpty(u))return Xt();var f=this.plugin.helpers.substructureParent.get(u.structure,!0);if(!f)return Xt();var p=this.getStructureRoot();if(!p||((l=p.obj)===null||l===void 0?void 0:l.data)!==((c=f.obj)===null||c===void 0?void 0:c.data))return Xt();var v=Uh.get((d=p.obj)===null||d===void 0?void 0:d.data.models[0]);v&&ue.invert(this._invTransform,v);var h=Re.extendToWholeResidues(u),m=Re.getBoundary(h,v&&!Number.isNaN(this._invTransform[0])?this._invTransform:void 0).box;return Re.size(h)===1&&Xt.expand(m,m,_.create(1,1,1)),m},s.prototype.updateAuto=function(u){if(this.lastLoci=u,Du(u)){this.updateAutoParams(this.info.kind==="x-ray"?this.data.structure.boundary.box:void 0,!1);return}var l=this.getBoxFromLoci(u);this.updateAutoParams(l,!0)},s.prototype.updateSelectionBox=function(u){if(ar.areEqual(this.lastLoci,u)){this.lastLoci=Nr,this.updateSelectionBoxParams(Xt());return}if(this.lastLoci=u,Du(u)){this.updateSelectionBoxParams(Xt());return}var l=this.getBoxFromLoci(u);this.updateSelectionBoxParams(l)},s.prototype.update=function(u){return ce(this,void 0,void 0,function(){var l,c,d,f,f,p,v,h;return de(this,function(m){switch(m.label){case 0:switch(l=u.entry.params.view.name==="selection-box"&&this.params&&this.params.entry&&this.params.entry.params&&this.params.entry.params.view&&this.params.entry.params.view.name!=="selection-box",this.params=u,c=void 0,d=!1,u.entry.params.view.name){case"off":d=!0;break;case"box":c=Xt.create(u.entry.params.view.params.bottomLeft,u.entry.params.view.params.topRight),d=Xt.volume(c)<1e-4;break;case"selection-box":{l?c=this.getBoxFromLoci(this.lastLoci)||Xt():c=Xt.create(_.clone(u.entry.params.view.params.bottomLeft),_.clone(u.entry.params.view.params.topRight)),f=u.entry.params.view.params.radius,d=Xt.volume(c)<1e-4,Xt.expand(c,c,_.create(f,f,f));break}case"cell":c=this.info.kind==="x-ray"?this.data.structure.boundary.box:void 0;break;case"auto":c=u.entry.params.view.params.isSelection||this.info.kind==="x-ray"?Xt.create(_.clone(u.entry.params.view.params.bottomLeft),_.clone(u.entry.params.view.params.topRight)):void 0,c&&(d=Xt.volume(c)<1e-4,u.entry.params.view.params.isSelection&&(f=u.entry.params.view.params.radius,Xt.expand(c,c,_.create(f,f,f))));break}return d?(v={},[3,3]):[3,1];case 1:return[4,this.queryData(c)];case 2:v=m.sent(),m.label=3;case 3:return p=v,p?(h=u.entry.params.channels,this.info.kind==="x-ray"?(this.channels["2fo-fc"]=this.createChannel(p["2FO-FC"]||Ct.One,h["2fo-fc"],this.info.header.sampling[0].valuesInfo[0]),this.channels["fo-fc(+ve)"]=this.createChannel(p["FO-FC"]||Ct.One,h["fo-fc(+ve)"],this.info.header.sampling[0].valuesInfo[1]),this.channels["fo-fc(-ve)"]=this.createChannel(p["FO-FC"]||Ct.One,h["fo-fc(-ve)"],this.info.header.sampling[0].valuesInfo[1])):this.channels.em=this.createChannel(p.EM||Ct.One,h.em,this.info.header.sampling[0].valuesInfo[0]),[2,!0]):[2,!1]}})})},s.prototype.createChannel=function(u,l,c){var d=l;return{data:u,color:d.color,wireframe:d.wireframe,opacity:d.opacity,isoValue:d.isoValue.kind==="relative"?d.isoValue:Ct.IsoValue.toRelative(d.isoValue,c)}},s.prototype.getDescription=function(){return this.params.entry.params.view.name==="selection-box"?"Selection":this.params.entry.params.view.name==="box"?"Static Box":this.params.entry.params.view.name==="cell"?"Cell":""},s}(Or.WithSubscribers);e.Behavior=a})(ja||(ja={}));function int(e,t){var r=vnt(e,t||PF());return bnt(e.tree,r),t&&t.refs.forEach(gnt,r),{hierarchy:r.hierarchy,added:r.added,changed:r.changed}}function PF(){return{trajectories:[],models:[],structures:[],refs:new Map}}function ant(e){return{kind:"trajectory",cell:e,version:e.transform.version,models:[]}}function IH(e,t){return{kind:"model",cell:e,version:e.transform.version,trajectory:t,structures:[]}}function ont(e,t){return{kind:"model-properties",cell:e,version:e.transform.version,model:t}}function snt(e,t){return{kind:"model-unitcell",cell:e,version:e.transform.version,model:t}}function MH(e,t){return{kind:"structure",cell:e,version:e.transform.version,model:t,components:[]}}function unt(e,t){return{kind:"structure-properties",cell:e,version:e.transform.version,structure:t}}function lnt(e,t){return{kind:"structure-transform",cell:e,version:e.transform.version,structure:t}}function cnt(e,t){return{kind:"structure-volume-streaming",cell:e,version:e.transform.version,structure:t}}function dnt(e){return e.transform.tags?Nt([],e.transform.tags).sort().join():e.transform.ref}function fnt(e,t){return{kind:"structure-component",cell:e,version:e.transform.version,structure:t,key:dnt(e),representations:[]}}function pnt(e,t){return{kind:"structure-representation",cell:e,version:e.transform.version,component:t}}function hnt(e,t){return{kind:"generic-representation",cell:e,version:e.transform.version,parent:t}}function vnt(e,t){return{state:e,oldHierarchy:t,hierarchy:PF(),changed:!1,added:new Set}}function bm(e,t,r,n){for(var i=[],a=4;a<arguments.length;a++)i[a-4]=arguments[a];var o=n.apply(void 0,i);r.push(o),e.hierarchy.refs.set(t.transform.ref,o);var s=e.oldHierarchy.refs.get(t.transform.ref);return s?s.version!==t.transform.version&&(e.changed=!0):(e.added.add(o.cell.transform.ref),e.changed=!0),o}function Wp(e,t,r){for(var n=[],i=3;i<arguments.length;i++)n[i-3]=arguments[i];var a=r.apply(void 0,n);e.hierarchy.refs.set(t.transform.ref,a);var o=e.oldHierarchy.refs.get(t.transform.ref);return o?o.version!==t.transform.version&&(e.changed=!0):(e.added.add(a.cell.transform.ref),e.changed=!0),a}function DH(e){return function(t){return e.is(t.obj)}}function RH(e,t){return function(r,n){return!t(n)&&e.is(r.obj)}}function Zx(e){return function(t){return t.transform.transformer===e}}function Xp(){}var mnt=[[DH(ge.Molecule.Trajectory),function(e,t){e.currentTrajectory=bm(e,t,e.hierarchy.trajectories,ant,t)},function(e){return e.currentTrajectory=void 0}],[RH(ge.Molecule.Model,function(e){return e.currentModel}),function(e,t){e.currentTrajectory?e.currentModel=bm(e,t,e.currentTrajectory.models,IH,t,e.currentTrajectory):e.currentModel=Wp(e,t,IH,t),e.hierarchy.models.push(e.currentModel)},function(e){return e.currentModel=void 0}],[Zx(rt.Model.CustomModelProperties),function(e,t){if(!e.currentModel)return!1;e.currentModel.properties=Wp(e,t,ont,t,e.currentModel)},Xp],[Zx(rt.Representation.ModelUnitcell3D),function(e,t){if(!e.currentModel)return!1;e.currentModel.unitcell=Wp(e,t,snt,t,e.currentModel)},Xp],[RH(ge.Molecule.Structure,function(e){return e.currentStructure}),function(e,t){e.currentModel?e.currentStructure=bm(e,t,e.currentModel.structures,MH,t,e.currentModel):e.currentStructure=Wp(e,t,MH,t),e.hierarchy.structures.push(e.currentStructure)},function(e){return e.currentStructure=void 0}],[Zx(rt.Model.CustomStructureProperties),function(e,t){if(!e.currentStructure)return!1;e.currentStructure.properties=Wp(e,t,unt,t,e.currentStructure)},Xp],[Zx(rt.Model.TransformStructureConformation),function(e,t){if(!e.currentStructure)return!1;e.currentStructure.transform=Wp(e,t,lnt,t,e.currentStructure)},Xp],[DH(ja),function(e,t){return e.currentStructure&&(e.currentStructure.volumeStreaming=Wp(e,t,cnt,t,e.currentStructure)),!1},Xp],[function(e,t){return t.currentComponent||!t.currentStructure||e.transform.transformer.definition.isDecorator?!1:ge.Molecule.Structure.is(e.obj)},function(e,t){e.currentStructure&&(e.currentComponent=bm(e,t,e.currentStructure.components,fnt,t,e.currentStructure))},function(e){return e.currentComponent=void 0}],[function(e,t){return!e.state.isGhost&&!!t.currentComponent&&ge.Molecule.Structure.Representation3D.is(e.obj)},function(e,t){return e.currentComponent&&bm(e,t,e.currentComponent.representations,pnt,t,e.currentComponent),!1},Xp],[function(e){return!e.state.isGhost&&ge.isRepresentation3D(e.obj)},function(e,t){var r=e.currentComponent||e.currentStructure||e.currentModel;r&&(r.genericRepresentations||(r.genericRepresentations=[]),bm(e,t,r.genericRepresentations,hnt,t,r))},Xp]];function lie(e){if(!e||!(e!=null&&e.parent)||!e.parent.cells.has(e.transform.ref))return!1;var t=e.obj;return!(!t||t===On.Null||e.status!=="ok"&&e.status!=="error")}function gnt(e){var t=e.cell;lie(t)||(this.changed=!0)}function ynt(e){cie(this,this.tree.transforms.get(e))}function cie(e,t){var r=e.state,n=r.state.cells.get(t.ref);if(lie(n)){for(var i=void 0,a=!1,o=0,s=mnt;o<s.length;o++){var u=s[o],l=u[0],c=u[1],d=u[2];if(l(n,r)){var f=c(r,n);if(f===!1){a=!0;break}i=d;break}}if(!a){var p=e.tree.children.get(t.ref);p&&p.size&&p.forEach(ynt,e),i&&i(r)}}}function bnt(e,t){var r={tree:e,state:t};return cie(r,e.root),r.state}var Lb=function(e){Fe(t,e);function t(r){var n=e.call(this)||this;return n.plugin=r,n.state={syncedTree:n.dataState.tree,notified:!1,hierarchy:PF(),selection:{trajectories:[],models:[],structures:[]}},n.behaviors={selection:n.ev.behavior({hierarchy:n.current,trajectories:n.selection.trajectories,models:n.selection.models,structures:n.selection.structures})},n._currentComponentGroups=void 0,n._currentSelectionSet=void 0,n.subscribe(r.state.data.events.changed,function(i){i.inTransaction||r.behaviors.state.isAnimating.value||n.sync(!0)}),n.subscribe(r.behaviors.state.isAnimating,function(i){!i&&!r.behaviors.state.isUpdating.value&&n.sync(!0)}),n}return Object.defineProperty(t.prototype,"dataState",{get:function(){return this.plugin.state.data},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"currentComponentGroups",{get:function(){return this._currentComponentGroups?this._currentComponentGroups:(this._currentComponentGroups=t.getComponentGroups(this.selection.structures),this._currentComponentGroups)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"seletionSet",{get:function(){if(this._currentSelectionSet)return this._currentSelectionSet;this._currentSelectionSet=new Set;for(var r=0,n=this.selection.trajectories;r<n.length;r++){var i=n[r];this._currentSelectionSet.add(i.cell.transform.ref)}for(var a=0,o=this.selection.models;a<o.length;a++){var i=o[a];this._currentSelectionSet.add(i.cell.transform.ref)}for(var s=0,u=this.selection.structures;s<u.length;s++){var i=u[s];this._currentSelectionSet.add(i.cell.transform.ref)}return this._currentSelectionSet},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"current",{get:function(){return this.sync(!1),this.state.hierarchy},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"selection",{get:function(){return this.sync(!1),this.state.selection},enumerable:!1,configurable:!0}),t.prototype.getStructuresWithSelection=function(){for(var r=this.plugin.managers.structure.hierarchy.current.structures,n=[],i=0,a=r;i<a.length;i++){var o=a[i];this.plugin.managers.structure.selection.structureHasSelection(o)&&n.push(o)}return n},t.prototype.syncCurrent=function(r,n){for(var i=this.seletionSet,a=[],o=0,s=r;o<s.length;o++){var u=s[o],l=u.cell.transform.ref;(i.has(l)||n.has(l))&&a.push(u)}return a.length===0?r.length>0?[r[0]]:[]:a},t.prototype.sync=function(r){if(!(!r&&this.dataState.inUpdate)){if(this.state.syncedTree===this.dataState.tree){r&&!this.state.notified&&(this.state.notified=!0,this.behaviors.selection.next(E({hierarchy:this.state.hierarchy},this.state.selection)));return}this.state.syncedTree=this.dataState.tree;var n=int(this.plugin.state.data,this.current);if(n.changed){var i=n.hierarchy,a=this.syncCurrent(i.trajectories,n.added),o=this.syncCurrent(i.models,n.added),s=this.syncCurrent(i.structures,n.added);this._currentComponentGroups=void 0,this._currentSelectionSet=void 0,this.state.hierarchy=i,this.state.selection.trajectories=a,this.state.selection.models=o,this.state.selection.structures=s,r?(this.state.notified=!0,this.behaviors.selection.next({hierarchy:i,trajectories:a,models:o,structures:s})):this.state.notified=!1}}},t.prototype.updateCurrent=function(r,n){for(var i=this.current,a=n==="add"?hi.union(this.seletionSet,new Set(r.map(function(y){return y.cell.transform.ref}))):hi.difference(this.seletionSet,new Set(r.map(function(y){return y.cell.transform.ref}))),o=[],s=[],u=[],l=0,c=i.trajectories;l<c.length;l++){var d=c[l];a.has(d.cell.transform.ref)&&o.push(d)}for(var f=0,p=i.models;f<p.length;f++){var v=p[f];a.has(v.cell.transform.ref)&&s.push(v)}for(var h=0,m=i.structures;h<m.length;h++){var g=m[h];a.has(g.cell.transform.ref)&&u.push(g)}this._currentComponentGroups=void 0,this._currentSelectionSet=void 0,this.state.selection.trajectories=o,this.state.selection.models=s,this.state.selection.structures=u,this.behaviors.selection.next({hierarchy:i,trajectories:o,models:s,structures:u})},t.prototype.remove=function(r,n){if(r.length!==0){for(var i=this.plugin.state.data.build(),a=0,o=r;a<o.length;a++){var s=o[a];i.delete(typeof s=="string"?s:s.cell.transform.ref)}return i.commit({canUndo:n?"Remove":!1})}},t.prototype.toggleVisibility=function(r,n){if(r.length!==0)for(var i=n!==void 0?n!=="show":!r[0].cell.state.isHidden,a=0,o=r;a<o.length;a++){var s=o[a];Sv(this.dataState,s.cell.transform.ref,i)}},t.prototype.applyPreset=function(r,n,i){var a=this;return this.plugin.dataTransaction(function(){return ce(a,void 0,void 0,function(){var o,s,u;return de(this,function(l){switch(l.label){case 0:o=0,s=r,l.label=1;case 1:return o<s.length?(u=s[o],u.models.length>0?[4,this.clearTrajectory(u)]:[3,3]):[3,6];case 2:l.sent(),l.label=3;case 3:return[4,this.plugin.builders.structure.hierarchy.applyPreset(u.cell,n,i)];case 4:l.sent(),l.label=5;case 5:return o++,[3,1];case 6:return[2]}})})})},t.prototype.updateStructure=function(r,n){return ce(this,void 0,void 0,function(){var i=this;return de(this,function(a){switch(a.label){case 0:return[4,this.plugin.dataTransaction(function(){return ce(i,void 0,void 0,function(){var o,s;return de(this,function(u){switch(u.label){case 0:return o=li.getDecoratorRoot(this.dataState.tree,r.cell.transform.ref),s=this.dataState.tree.children.get(o).toArray(),[4,this.remove(s,!1)];case 1:return u.sent(),[4,this.plugin.state.updateTransform(this.plugin.state.data,r.cell.transform.ref,n,"Structure Type")];case 2:return u.sent(),[4,this.plugin.builders.structure.representation.applyPreset(r.cell.transform.ref,"auto")];case 3:return u.sent(),[2]}})})},{canUndo:"Structure Type"})];case 1:return a.sent(),_t.Camera.Reset(this.plugin),[2]}})})},t.prototype.clearTrajectory=function(r){for(var n=this.dataState.build(),i=0,a=r.models;i<a.length;i++){var o=a[i];n.delete(o.cell)}return n.commit()},t}(v2);(function(e){function t(n){if(!n.length)return[];if(n.length===1)return n[0].components.map(function(v){return[v]});for(var i=[],a=new Map,o=0,s=n;o<s.length;o++)for(var u=s[o],l=0,c=u.components;l<c.length;l++){var d=c[l],f=d.key;if(f){var p=a.get(f);p||(p=[],a.set(f,p),i.push(p)),p.push(d)}}return i}e.getComponentGroups=t;function r(n){var i,a,o,s,u,l,c,d,f,p=n.managers.structure.hierarchy.selection.structures;if(p.length===0)return"";if(p.length===1){var v=p[0],h=(i=v.cell.obj)===null||i===void 0?void 0:i.data;if(!h)return((a=v.cell.obj)===null||a===void 0?void 0:a.label)||"Structure";var m=h.models[0]||h.representativeModel||h.masterModel;if(!m)return((o=v.cell.obj)===null||o===void 0?void 0:o.label)||"Structure";var g=m.entryId;return!((u=(s=v.model)===null||s===void 0?void 0:s.trajectory)===null||u===void 0)&&u.models&&v.model.trajectory.models.length===1?g:v.model?((l=v.model.cell.obj)===null||l===void 0?void 0:l.label)+" | "+g:g}for(var y=p[0],b=(c=y==null?void 0:y.model)===null||c===void 0?void 0:c.trajectory,S=!0,x=0,C=p;x<C.length;x++){var v=C[x];if(((d=v==null?void 0:v.model)===null||d===void 0?void 0:d.trajectory)!==b){S=!1;break}}return S&&b?((f=b.cell.obj)===null||f===void 0?void 0:f.label)+" | "+p.length+" structures":p.length+" structures"}e.getSelectedStructuresDescription=r})(Lb||(Lb={}));var wv=function(e){Fe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.onChange=function(n){var i,a=n.name,o=n.value,s=E(E({},r.props.params),(i={},i[a]=o,i));r.props.events.onChange(s,r.areInitial(s),r.validate(s))},r}return t.prototype.validate=function(r){},t.prototype.areInitial=function(r){return I.areEqual(this.props.info.params,r,this.props.info.initialValues)},t.prototype.render=function(){return P.jsx(Un,{params:this.props.info.params,values:this.props.params,onChange:this.onChange,onEnter:this.props.events.onEnter,isDisabled:this.props.isDisabled},void 0)},t}(Qi);(function(e){function t(i){for(var a=Object.keys(i),o=0,s=a;o<s.length;o++){var u=s[o];if(!i[u].isHidden)return!1}return!0}function r(i,a,o,s){var u=a.cells.get(s).obj,l=o.definition.params?o.definition.params(u,i):{},c=I.getDefaultValues(l);return{initialValues:c,params:l,isEmpty:t(l)}}e.infoFromAction=r;function n(i,a,o){var s=a.cells.get(o.ref),u=s.params&&s.params.definition||{},l=s.params&&s.params.values||{};return{initialValues:l,params:u,isEmpty:t(u)}}e.infoFromTransform=n})(wv||(wv={}));var die=function(e){Fe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.busy=new ri,r.onEnter=function(){r.state.error||r.apply()},r.autoApplyHandle=void 0,r.events={onEnter:r.onEnter,onChange:function(n,i,a){r.clearAutoApply(),r.setState({params:n,isInitial:i,error:a&&a[0]},function(){!i&&!r.state.error&&r.canAutoApply(n)&&(r.clearAutoApply(),r.autoApplyHandle=setTimeout(r.apply,50))})}},r.apply=function(){return ce(r,void 0,void 0,function(){var n,i;return de(this,function(a){switch(a.label){case 0:this.clearAutoApply(),this.setState({busy:!0}),a.label=1;case 1:return a.trys.push([1,3,4,5]),[4,this.applyAction()];case 2:return a.sent(),[3,5];case 3:return a.sent(),[3,5];case 4:return(i=(n=this.props).onApply)===null||i===void 0||i.call(n),this.busy.next(!1),[7];case 5:return[2]}})})},r.refresh=function(){r.setState({params:r.getInfo().initialValues,isInitial:!0,error:void 0})},r.setDefault=function(){var n=r.getInfo(),i=I.getDefaultValues(n.params);r.setState({params:i,isInitial:I.areEqual(n.params,i,n.initialValues),error:void 0})},r.toggleExpanded=function(){r.setState({isCollapsed:!r.state.isCollapsed})},r}return t.prototype.clearAutoApply=function(){this.autoApplyHandle!==void 0&&(clearTimeout(this.autoApplyHandle),this.autoApplyHandle=void 0)},t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.behaviors.state.isBusy,function(n){r.state.busy!==n&&r.busy.next(n)}),this.subscribe(this.busy,function(n){r.state.busy!==n&&r.setState({busy:n})})},t.prototype.renderApply=function(){var r=this.canApply();return this.props.autoHideApply&&(!r||this.canAutoApply(this.state.params))?null:P.jsxs("div",E({className:"msp-transform-apply-wrap"},{children:[P.jsx(Ht,{svg:L5,className:"msp-transform-default-params",onClick:this.setDefault,disabled:this.state.busy,title:"Set default params"},void 0),P.jsx("div",E({className:"msp-transform-apply-wider"},{children:P.jsx(mr,E({icon:r?m0:void 0,className:"msp-btn-commit msp-btn-commit-"+(r?"on":"off"),onClick:this.apply,disabled:!r},{children:this.props.applyLabel||this.applyText()}),void 0)}),void 0)]}),void 0)},t.prototype.renderDefault=function(){var r=this.getInfo(),n=r.isEmpty&&this.isUpdate(),i=this.getHeader(),a=this.getTransformerId(),o=this.plugin.customParamEditors.has(a)?this.plugin.customParamEditors.get(a):wv,s=this.state.isCollapsed?"msp-transform-wrapper msp-transform-wrapper-collapsed":"msp-transform-wrapper",u=null;if(!n&&!this.state.isCollapsed){var l=this.getSourceAndTarget(),c=l.a,d=l.b,f=l.bCell,p=this.renderApply();u=P.jsxs(P.Fragment,{children:[P.jsx(o,{info:r,a:c,b:d,bCell:f,events:this.events,params:this.state.params,isDisabled:this.state.busy},void 0),p]},void 0)}var v=P.jsxs("div",E({className:s,style:{marginBottom:this.props.noMargin?0:void 0}},{children:[i!=="none"&&!this.props.wrapInExpander&&P.jsx("div",E({className:"msp-transform-header"},{children:P.jsxs(mr,E({onClick:this.toggleExpanded,title:i.description},{children:[!n&&P.jsx(sn,{svg:this.state.isCollapsed?Qc:Kc},void 0),i.name]}),void 0)}),void 0),u]}),void 0);return n||!this.props.wrapInExpander?v:P.jsx(Uu,E({header:this.isUpdate()?"Update "+(i==="none"?"":i.name):"Apply "+(i==="none"?"":i.name),headerLeftMargin:this.props.expanderHeaderLeftMargin},{children:v}),void 0)},t.prototype.renderSimple=function(){var r,n,i,a=this.getInfo(),o=this.canApply(),s=P.jsxs("div",E({className:"msp-flex-row"},{children:[P.jsx(mr,E({icon:(r=this.props.simpleApply)===null||r===void 0?void 0:r.icon,title:(n=this.props.simpleApply)===null||n===void 0?void 0:n.title,disabled:this.state.busy||!o,onClick:this.apply,className:"msp-btn-apply-simple"},{children:(i=this.props.simpleApply)===null||i===void 0?void 0:i.header}),void 0),!a.isEmpty&&P.jsx(Ri,{icon:uv,label:"",title:"Options",toggle:this.toggleExpanded,isSelected:!this.state.isCollapsed,disabled:this.state.busy,style:{flex:"0 0 40px",padding:0}},void 0)]}),void 0);if(this.state.isCollapsed)return s;var u=this.getTransformerId(),l=this.plugin.customParamEditors.has(u)?this.plugin.customParamEditors.get(u):wv,c=this.getSourceAndTarget(),d=c.a,f=c.b,p=c.bCell;return P.jsxs(P.Fragment,{children:[s,P.jsx(l,{info:a,a:d,b:f,bCell:p,events:this.events,params:this.state.params,isDisabled:this.state.busy},void 0)]},void 0)},t.prototype.render=function(){return this.props.simpleApply?this.renderSimple():this.renderDefault()},t}(Qi),cd=function(e){Fe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r._getInfo=vp(function(n){return wv.infoFromTransform(r.plugin,r.props.state,n)}),r.state={error:void 0,isInitial:!0,params:r.getInfo().initialValues,busy:!1,isCollapsed:r.props.initiallyCollapsed},r}return t.prototype.applyAction=function(){return this.props.customUpdate?this.props.customUpdate(this.state.params):this.plugin.state.updateTransform(this.props.state,this.props.transform.ref,this.state.params)},t.prototype.getInfo=function(){return this._getInfo(this.props.transform)},t.prototype.getTransformerId=function(){return this.props.transform.transformer.id},t.prototype.getHeader=function(){return this.props.customHeader||this.props.transform.transformer.definition.display},t.prototype.canApply=function(){var r=this.props.state,n=r.cells.get(this.props.transform.ref);if(!n)return!1;if(n.status==="error"){var i=r.cells.get(this.props.transform.parent);return i?i.status==="ok":!1}return!this.state.error&&!this.state.busy&&!this.state.isInitial},t.prototype.applyText=function(){return this.canApply()?"Update":"Nothing to Update"},t.prototype.isUpdate=function(){return!0},t.prototype.getSourceAndTarget=function(){var r=this.props.state.cells.get(this.props.transform.ref);return{a:this.props.state.cells.get(this.props.transform.parent).obj,b:r==null?void 0:r.obj,bCell:r}},t.prototype.canAutoApply=function(r){var n=this.props.transform.transformer.definition.canAutoUpdate;if(!n)return!1;var i=this.props.state,a=i.cells.get(this.props.transform.ref);if(!a||!a.sourceRef||a.status!=="ok")return!1;var o=i.cells.get(a.sourceRef);return n({a:o.obj,b:a.obj,oldParams:this.getInfo().initialValues,newParams:r},this.plugin)},t.prototype.componentDidMount=function(){var r=this;e.prototype.componentDidMount.call(this),this.props.toggleCollapsed&&this.subscribe(this.props.toggleCollapsed,function(){return r.setState({isCollapsed:!r.state.isCollapsed})}),this.subscribe(this.plugin.state.events.object.updated,function(n){var i=n.ref,a=n.state;r.props.transform.ref!==i||r.props.state!==a||r.state.params!==r.props.transform.params&&(r._getInfo=vp(function(o){return wv.infoFromTransform(r.plugin,r.props.state,o)}),r.setState({params:r.props.transform.params,isInitial:!0}))})},t.prototype.componentDidUpdate=function(r){var n;if(this.props.transform!==r.transform){var i=this.props.state.cells.get(this.props.transform.ref);this.setState({params:((n=i.params)===null||n===void 0?void 0:n.values)||{},isInitial:!0,error:void 0,simpleOnly:this.state.simpleOnly})}},t}(die);(function(e){Fe(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.state.events.object.updated,function(n){var i=n.ref,a=n.state;r.props.nodeRef!==i||r.plugin.state.data!==a||r.forceUpdate()})},t.prototype.render=function(){var r=this.plugin.state.data,n=this.props.nodeRef,i=r.cells.get(n);if(!i||i.status!=="ok"&&i.status!=="error")return null;var a=i.transform;return P.jsx(cd,{state:r,transform:a,initiallyCollapsed:this.props.initiallyCollapsed,customHeader:this.props.header},void 0)},t})(gr);var xnt=function(e){Fe(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return Object.defineProperty(t.prototype,"current",{get:function(){return this.plugin.managers.structure.hierarchy.behaviors.selection},enumerable:!1,configurable:!0}),t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.current,function(){return r.forceUpdate()})},Object.defineProperty(t.prototype,"unitcell",{get:function(){var r,n=this.plugin.managers.structure.hierarchy.selection;if(n.structures.length===0)return null;for(var i=[],a=0,o=n.structures;a<o.length;a++){var s=o[a],u=s.model;u!=null&&u.unitcell&&(!((r=u.unitcell)===null||r===void 0)&&r.cell.obj)&&i.push(u.unitcell)}return i.length===0?null:P.jsx(kH,{refs:i,labelMultiple:"Unit Cells"},void 0)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"customControls",{get:function(){var r=this,n=[];return this.plugin.genericRepresentationControls.forEach(function(i,a){var o=i(r.plugin.managers.structure.hierarchy.selection),s=o[0],u=o[1];s.length>0&&n.push(P.jsx("div",{children:P.jsx(kH,{refs:s,labelMultiple:u},void 0)},a))}),n.length>0?n:null},enumerable:!1,configurable:!0}),t.prototype.render=function(){return P.jsx(P.Fragment,{children:P.jsxs("div",E({style:{marginTop:"6px"}},{children:[this.unitcell,this.customControls]}),void 0)},void 0)},t}(Qi),kH=function(e){Fe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={showOptions:!1},r.toggleVisibility=function(n){n.preventDefault(),r.plugin.managers.structure.hierarchy.toggleVisibility(r.props.refs),n.currentTarget.blur()},r.highlight=function(n){n.preventDefault(),r.pivot.cell.parent&&_t.Interactivity.Object.Highlight(r.plugin,{state:r.pivot.cell.parent,ref:r.props.refs.map(function(i){return i.cell.transform.ref})})},r.clearHighlight=function(n){n.preventDefault(),_t.Interactivity.ClearHighlights(r.plugin)},r.focus=function(n){var i;n.preventDefault();for(var a=!0,o=0,s=r.props.refs;o<s.length;o++){var u=s[o];if(!u.cell.state.isHidden){a=!1;break}}a&&r.plugin.managers.structure.hierarchy.toggleVisibility(r.props.refs,"show");for(var l=[],c=0,d=r.props.refs;c<d.length;c++){var u=d[c];if(!u.cell.state.isHidden){var f=(i=u.cell.obj)===null||i===void 0?void 0:i.data.repr.getLoci();f&&l.push(f)}}r.plugin.managers.camera.focusLoci(l)},r.toggleOptions=function(){return r.setState({showOptions:!r.state.showOptions})},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.state.events.cell.stateUpdated,function(n){var i;dp.ObjectEvent.isCell(n,(i=r.pivot)===null||i===void 0?void 0:i.cell)&&r.forceUpdate()})},Object.defineProperty(t.prototype,"pivot",{get:function(){return this.props.refs[0]},enumerable:!1,configurable:!0}),t.prototype.render=function(){var r=this.props,n=r.refs,i=r.labelMultiple;if(n.length===0)return null;var a=n[0],o,s;if(n.length===1){var u=a.cell.obj;if(!u)return null;o=u==null?void 0:u.label,s=u==null?void 0:u.description}else o=n.length+" "+(i||"Objects");return P.jsxs(P.Fragment,{children:[P.jsxs("div",E({className:"msp-flex-row"},{children:[P.jsxs("button",E({className:"msp-form-control msp-control-button-label",title:o+". Click to focus.",onClick:this.focus,onMouseEnter:this.highlight,onMouseLeave:this.clearHighlight,style:{textAlign:"left"}},{children:[o," ",P.jsx("small",{children:s},void 0)]}),void 0),P.jsx(Ht,{svg:a.cell.state.isHidden?kv:Ov,toggleState:!1,className:"msp-form-control",onClick:this.toggleVisibility,title:a.cell.state.isHidden?"Show":"Hide",small:!0,flex:!0},void 0),n.length===1&&P.jsx(Ht,{svg:sv,className:"msp-form-control",onClick:this.toggleOptions,title:"Options",toggleState:this.state.showOptions,flex:!0},void 0)]}),void 0),n.length===1&&this.state.showOptions&&a.cell.parent&&P.jsx(P.Fragment,{children:P.jsx("div",E({className:"msp-control-offset"},{children:P.jsx(cd,{state:a.cell.parent,transform:a.cell.transform,customHeader:"none",autoHideApply:!0},void 0)}),void 0)},void 0)]},void 0)},t}(Qi),Snt=function(e){Fe(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.defaultState=function(){return{header:"Components",isCollapsed:!1,isDisabled:!1,brand:{accent:"blue",svg:D5}}},t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.managers.structure.hierarchy.behaviors.selection,function(n){return r.setState({description:Lb.getSelectedStructuresDescription(r.plugin)})})},t.prototype.renderControls=function(){return P.jsxs(P.Fragment,{children:[P.jsx(Cnt,{},void 0),P.jsx(wnt,{},void 0),P.jsx(xnt,{},void 0)]},void 0)},t}(g0),Cnt=function(e){Fe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isEmpty:!0,isBusy:!1,canUndo:!1},r.togglePreset=r.toggleAction("preset"),r.toggleAdd=r.toggleAction("add"),r.toggleOptions=r.toggleAction("options"),r.hideAction=function(){return r.setState({action:void 0})},r.applyPreset=function(n){if(r.hideAction(),!!n){var i=r.plugin.managers.structure,a=i.hierarchy.selection.structures;n.value===null?i.component.clear(a):i.component.applyPreset(a,n.value)}},r.undo=function(){var n=r.plugin.state.data.undo();n&&r.plugin.runTask(n)},r}return Object.defineProperty(t.prototype,"isDisabled",{get:function(){return this.state.isBusy||this.state.isEmpty},enumerable:!1,configurable:!0}),t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.managers.structure.hierarchy.behaviors.selection,function(n){return r.setState({action:r.state.action!=="options"||n.structures.length===0?void 0:"options",isEmpty:n.structures.length===0})}),this.subscribe(this.plugin.behaviors.state.isBusy,function(n){r.setState({isBusy:n,action:r.state.action!=="options"?void 0:"options"})}),this.subscribe(this.plugin.state.data.events.historyUpdated,function(n){var i=n.state;r.setState({canUndo:i.canUndo})})},t.prototype.toggleAction=function(r){var n=this;return function(){return n.setState({action:n.state.action===r?void 0:r})}},Object.defineProperty(t.prototype,"presetControls",{get:function(){return P.jsx(er,{items:this.presetActions,onSelect:this.applyPreset},void 0)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"presetActions",{get:function(){var r=this.plugin.managers.structure.component.pivotStructure,n=this.plugin.builders.structure.representation.getPresets(r==null?void 0:r.cell.obj);return er.createItems(n,{label:function(i){return i.display.name},category:function(i){return i.display.group},description:function(i){return i.display.description}})},enumerable:!1,configurable:!0}),t.prototype.render=function(){var r=this.state.canUndo?"Undo "+this.plugin.state.data.latestUndoLabel:"Some mistakes of the past can be undone.";return P.jsxs(P.Fragment,{children:[P.jsxs("div",E({className:"msp-flex-row"},{children:[P.jsx(Ri,{icon:cE,label:"Preset",title:"Apply a representation preset for the current structure(s).",toggle:this.togglePreset,isSelected:this.state.action==="preset",disabled:this.isDisabled},void 0),P.jsx(Ri,{icon:v0,label:"Add",title:"Add a new representation component for a selection.",toggle:this.toggleAdd,isSelected:this.state.action==="add",disabled:this.isDisabled},void 0),P.jsx(Ri,{icon:uv,label:"",title:"Options that are applied to all applicable representations.",style:{flex:"0 0 40px",padding:0},toggle:this.toggleOptions,isSelected:this.state.action==="options",disabled:this.isDisabled},void 0),P.jsx(Ht,{svg:N5,className:"msp-flex-item",flex:"40px",onClick:this.undo,disabled:!this.state.canUndo||this.isDisabled,title:r},void 0)]}),void 0),this.state.action==="preset"&&this.presetControls,this.state.action==="add"&&P.jsx("div",E({className:"msp-control-offset"},{children:P.jsx(fie,{onApply:this.hideAction},void 0)}),void 0),this.state.action==="options"&&P.jsx("div",E({className:"msp-control-offset"},{children:P.jsx(_nt,{isDisabled:this.isDisabled},void 0)}),void 0)]},void 0)},t}(Qi),fie=function(e){Fe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state=r.createState(),r.apply=function(){var n=r.props.forSelection?r.currentStructures:r.selectedStructures;r.props.onApply(),r.plugin.managers.structure.component.add(r.state.values,n)},r.paramsChanged=function(n){return r.setState({values:n})},r}return t.prototype.createState=function(){var r=_v.getAddParams(this.plugin);return{params:r,values:I.getDefaultValues(r)}},Object.defineProperty(t.prototype,"selectedStructures",{get:function(){return this.plugin.managers.structure.component.currentStructures},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"currentStructures",{get:function(){return this.plugin.managers.structure.hierarchy.current.structures},enumerable:!1,configurable:!0}),t.prototype.render=function(){return P.jsxs(P.Fragment,{children:[P.jsx(Un,{params:this.state.params,values:this.state.values,onChangeValues:this.paramsChanged},void 0),P.jsx(mr,E({icon:v0,title:"Use Selection and optional Representation to create a new Component.",className:"msp-btn-commit msp-btn-commit-on",onClick:this.apply,style:{marginTop:"1px"}},{children:"Create Component"}),void 0)]},void 0)},t}(Qi),_nt=function(e){Fe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.update=function(n){return r.plugin.managers.structure.component.setOptions(n)},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.managers.structure.component.events.optionsUpdated,function(){return r.forceUpdate()})},t.prototype.render=function(){return P.jsx(Un,{params:_v.OptionsParams,values:this.plugin.managers.structure.component.state.options,onChangeValues:this.update,isDisabled:this.props.isDisabled},void 0)},t}(Qi),wnt=function(e){Fe(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.managers.structure.hierarchy.behaviors.selection,function(){r.forceUpdate()})},t.prototype.render=function(){var r=this.plugin.managers.structure.hierarchy.currentComponentGroups;return r.length===0?null:P.jsx("div",E({style:{marginTop:"6px"}},{children:r.map(function(n){return P.jsx(Ent,{group:n},n[0].cell.transform.ref)})}),void 0)},t}(Qi),Ent=function(e){Fe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={action:void 0},r.toggleVisible=function(n){n.preventDefault(),n.currentTarget.blur(),r.plugin.managers.structure.component.toggleVisibility(r.props.group)},r.selectAction=function(n){n&&(r.setState({action:void 0}),(n==null?void 0:n.value)())},r.remove=function(){return r.plugin.managers.structure.hierarchy.remove(r.props.group,!0)},r.toggleAction=function(){return r.setState({action:r.state.action==="action"?void 0:"action"})},r.toggleLabel=function(){return r.setState({action:r.state.action==="label"?void 0:"label"})},r.highlight=function(n){n.preventDefault(),r.props.group[0].cell.parent&&_t.Interactivity.Object.Highlight(r.plugin,{state:r.props.group[0].cell.parent,ref:r.props.group.map(function(i){return i.cell.transform.ref})})},r.clearHighlight=function(n){n.preventDefault(),_t.Interactivity.ClearHighlights(r.plugin)},r.focus=function(){for(var n=!0,i=0,a=r.props.group;i<a.length;i++){var o=a[i];if(!o.cell.state.isHidden){n=!1;break}}n&&r.plugin.managers.structure.hierarchy.toggleVisibility(r.props.group,"show"),r.plugin.managers.camera.focusSpheres(r.props.group,function(s){var u;if(!s.cell.state.isHidden)return(u=s.cell.obj)===null||u===void 0?void 0:u.data.boundary.sphere})},r.updateLabel=function(n){r.plugin.managers.structure.component.updateLabel(r.pivot,n)},r}return Object.defineProperty(t.prototype,"pivot",{get:function(){return this.props.group[0]},enumerable:!1,configurable:!0}),t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.state.events.cell.stateUpdated,function(n){dp.ObjectEvent.isCell(n,r.pivot.cell)&&r.forceUpdate()})},Object.defineProperty(t.prototype,"colorByActions",{get:function(){var r=this,n,i,a=this.plugin.managers.structure.component,o=this.pivot.representations[0],s=(n=o.cell.transform.params)===null||n===void 0?void 0:n.colorTheme.name,u=GZe(this.plugin,(i=this.pivot.cell.obj)===null||i===void 0?void 0:i.data);return er.createItemsFromSelectOptions(u,{value:function(l){return function(){return a.updateRepresentationsTheme(r.props.group,{color:l[0]})}},selected:function(l){return l[0]===s}})},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"actions",{get:function(){var r=this,n=this.plugin.managers.structure.component,i=[Nt([er.Header("Add Representation")],_v.getRepresentationTypes(this.plugin,this.props.group[0]).map(function(a){return er.Item(a[1],function(){return n.addRepresentation(r.props.group,a[0])})}))];return this.pivot.representations.length>0&&i.push(Nt([er.Header("Set Coloring",{isIndependent:!0})],this.colorByActions)),n.canBeModified(this.props.group[0])&&i.push([er.Header("Modify by Selection"),er.Item("Include",function(){return n.modifyByCurrentSelection(r.props.group,"union")},{icon:T5}),er.Item("Subtract",function(){return n.modifyByCurrentSelection(r.props.group,"subtract")},{icon:I5}),er.Item("Intersect",function(){return n.modifyByCurrentSelection(r.props.group,"intersect")},{icon:M5})]),i.push(er.Item("Select This",function(){return n.selectThis(r.props.group)},{icon:D_})),n.canBeModified(this.props.group[0])&&i.push(er.Item("Edit Label",this.toggleLabel)),i},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"reprLabel",{get:function(){var r,n=this.pivot;return n.representations.length===0?"No repr.":n.representations.length===1?(r=n.representations[0].cell.obj)===null||r===void 0?void 0:r.label:n.representations.length+" reprs"},enumerable:!1,configurable:!0}),t.prototype.render=function(){var r=this,n,i=this.pivot,a=i.cell,o=(n=a.obj)===null||n===void 0?void 0:n.label,s=this.reprLabel;return P.jsxs(P.Fragment,{children:[P.jsxs("div",E({className:"msp-flex-row"},{children:[P.jsxs(mr,E({noOverflow:!0,className:"msp-control-button-label",title:o+". Click to focus.",onClick:this.focus,onMouseEnter:this.highlight,onMouseLeave:this.clearHighlight,style:{textAlign:"left"}},{children:[o,P.jsx("small",E({className:"msp-25-lower-contrast-text",style:{float:"right"}},{children:s}),void 0)]}),void 0),P.jsx(Ht,{svg:a.state.isHidden?kv:Ov,toggleState:!1,onClick:this.toggleVisible,title:(a.state.isHidden?"Show":"Hide")+" component",small:!0,className:"msp-form-control",flex:!0},void 0),P.jsx(Ht,{svg:eu,toggleState:!1,onClick:this.remove,title:"Remove",small:!0,className:"msp-form-control",flex:!0},void 0),P.jsx(Ht,{svg:sv,onClick:this.toggleAction,title:"Actions",toggleState:this.state.action==="action",className:"msp-form-control",flex:!0},void 0)]}),void 0),this.state.action==="label"&&P.jsx("div",E({className:"msp-control-offset",style:{marginBottom:"6px"}},{children:P.jsx(Xs,{label:"Label",control:P.jsxs("div",E({style:{display:"flex",textAlignLast:"center"}},{children:[P.jsx(Fc,{onChange:this.updateLabel,value:o,style:{flex:"1 1 auto",minWidth:0},className:"msp-form-control",blurOnEnter:!0,blurOnEscape:!0},void 0),P.jsx(Ht,{svg:m0,onClick:this.toggleLabel,className:"msp-form-control msp-control-button-label",flex:!0},void 0)]}),void 0)},void 0)}),void 0),this.state.action==="action"&&P.jsxs("div",E({className:"msp-accent-offset"},{children:[P.jsx("div",E({style:{marginBottom:"6px"}},{children:P.jsx(er,{items:this.actions,onSelect:this.selectAction,noOffset:!0},void 0)}),void 0),P.jsx("div",E({style:{marginBottom:"6px"}},{children:i.representations.map(function(u){return P.jsx(Ant,{group:r.props.group,representation:u},u.cell.transform.ref)})}),void 0)]}),void 0)]},void 0)},t}(Qi),Ant=function(e){Fe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.remove=function(){return r.plugin.managers.structure.component.removeRepresentations(r.props.group,r.props.representation)},r.toggleVisible=function(n){n.preventDefault(),n.currentTarget.blur(),r.plugin.managers.structure.component.toggleVisibility(r.props.group,r.props.representation)},r.update=function(n){return r.plugin.managers.structure.component.updateRepresentations(r.props.group,r.props.representation,n)},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.state.events.cell.stateUpdated,function(n){dp.ObjectEvent.isCell(n,r.props.representation.cell)&&r.forceUpdate()})},t.prototype.render=function(){var r,n=this.props.representation.cell;return P.jsxs("div",E({className:"msp-representation-entry"},{children:[n.parent&&P.jsx(Uu,E({header:(((r=n.obj)===null||r===void 0?void 0:r.label)||"")+" Representation",noOffset:!0},{children:P.jsx(cd,{state:n.parent,transform:n.transform,customHeader:"none",customUpdate:this.update,noMargin:!0},void 0)}),void 0),P.jsx(Ht,{svg:eu,onClick:this.remove,title:"Remove",small:!0,className:"msp-default-bg",toggleState:!1,style:{position:"absolute",top:0,right:"32px",lineHeight:"24px",height:"24px",textAlign:"right",width:"44px",paddingRight:"6px",background:"none"}},void 0),P.jsx(Ht,{svg:this.props.representation.cell.state.isHidden?kv:Ov,toggleState:!1,onClick:this.toggleVisible,title:"Toggle Visibility",small:!0,className:"msp-default-bg",style:{position:"absolute",top:0,right:0,lineHeight:"24px",height:"24px",textAlign:"right",width:"32px",paddingRight:"6px",background:"none"}},void 0)]}),void 0)},t}(Qi),IT="measurement-group",pie={distanceUnitLabel:I.Text("",{isEssential:!0}),textColor:dre.textColor},Pnt=I.getDefaultValues(pie),Tnt=function(e){Fe(t,e);function t(r){var n=e.call(this,{labels:[],distances:[],angles:[],dihedrals:[],orientations:[],options:Pnt})||this;return n.plugin=r,n.behaviors={state:n.ev.behavior(n.state)},n._empty=[],r.state.data.events.changed.subscribe(function(i){i.inTransaction||r.behaviors.state.isAnimating.value||n.sync()}),r.behaviors.state.isAnimating.subscribe(function(i){!i&&!r.behaviors.state.isUpdating.value&&n.sync()}),n}return t.prototype.stateUpdated=function(){this.behaviors.state.next(this.state)},t.prototype.getGroup=function(){var r=this.plugin.state.data,n=ir.findTagInSubtree(r.tree,cr.RootRef,IT),i=this.plugin.state.data.build();return n?i.to(n):i.toRoot().group(rt.Misc.CreateGroup,{label:"Measurements"},{tags:IT})},t.prototype.setOptions=function(r){return ce(this,void 0,void 0,function(){var n,i,a,f,o,s,f,u,l,f,c,d,f;return de(this,function(p){switch(p.label){case 0:for(this.updateState({options:r})&&this.stateUpdated(),n=this.plugin.state.data.build(),i=0,a=this.state.distances;i<a.length;i++)f=a[i],n.to(f).update(function(v){v.unitLabel=r.distanceUnitLabel,v.textColor=r.textColor});for(o=0,s=this.state.labels;o<s.length;o++)f=s[o],n.to(f).update(function(v){v.textColor=r.textColor});for(u=0,l=this.state.angles;u<l.length;u++)f=l[u],n.to(f).update(function(v){v.textColor=r.textColor});for(c=0,d=this.state.dihedrals;c<d.length;c++)f=d[c],n.to(f).update(function(v){v.textColor=r.textColor});return n.editInfo.count===0?[2]:[4,_t.State.Update(this.plugin,{state:this.plugin.state.data,tree:n,options:{doNotLogTiming:!0}})];case 1:return p.sent(),[2]}})})},t.prototype.addDistance=function(r,n,i){return ce(this,void 0,void 0,function(){var a,o,s,u,l;return de(this,function(c){switch(c.label){case 0:return a=this.plugin.helpers.substructureParent.get(r.structure),o=this.plugin.helpers.substructureParent.get(n.structure),!a||!o?[2]:(s=[a.transform.ref],Fa(s,o.transform.ref),u=this.getGroup(),u.apply(rt.Model.MultiStructureSelectionFromExpression,{selections:[{key:"a",groupId:"a",ref:a.transform.ref,expression:Re.toExpression(r)},{key:"b",groupId:"b",ref:o.transform.ref,expression:Re.toExpression(n)}],isTransitive:!0,label:"Distance"},{dependsOn:s,tags:i==null?void 0:i.selectionTags}).apply(rt.Representation.StructureSelectionsDistance3D,E(E(E({customText:(i==null?void 0:i.customText)||"",unitLabel:this.state.options.distanceUnitLabel,textColor:this.state.options.textColor},i==null?void 0:i.lineParams),i==null?void 0:i.labelParams),i==null?void 0:i.visualParams),{tags:i==null?void 0:i.reprTags}),l=this.plugin.state.data,[4,_t.State.Update(this.plugin,{state:l,tree:u,options:{doNotLogTiming:!0}})]);case 1:return c.sent(),[2]}})})},t.prototype.addAngle=function(r,n,i,a){return ce(this,void 0,void 0,function(){var o,s,u,l,c,d;return de(this,function(f){switch(f.label){case 0:return o=this.plugin.helpers.substructureParent.get(r.structure),s=this.plugin.helpers.substructureParent.get(n.structure),u=this.plugin.helpers.substructureParent.get(i.structure),!o||!s||!u?[2]:(l=[o.transform.ref],Fa(l,s.transform.ref),Fa(l,u.transform.ref),c=this.getGroup(),c.apply(rt.Model.MultiStructureSelectionFromExpression,{selections:[{key:"a",ref:o.transform.ref,expression:Re.toExpression(r)},{key:"b",ref:s.transform.ref,expression:Re.toExpression(n)},{key:"c",ref:u.transform.ref,expression:Re.toExpression(i)}],isTransitive:!0,label:"Angle"},{dependsOn:l,tags:a==null?void 0:a.selectionTags}).apply(rt.Representation.StructureSelectionsAngle3D,E(E(E({customText:(a==null?void 0:a.customText)||"",textColor:this.state.options.textColor},a==null?void 0:a.lineParams),a==null?void 0:a.labelParams),a==null?void 0:a.visualParams),{tags:a==null?void 0:a.reprTags}),d=this.plugin.state.data,[4,_t.State.Update(this.plugin,{state:d,tree:c,options:{doNotLogTiming:!0}})]);case 1:return f.sent(),[2]}})})},t.prototype.addDihedral=function(r,n,i,a,o){return ce(this,void 0,void 0,function(){var s,u,l,c,d,f,p;return de(this,function(v){switch(v.label){case 0:return s=this.plugin.helpers.substructureParent.get(r.structure),u=this.plugin.helpers.substructureParent.get(n.structure),l=this.plugin.helpers.substructureParent.get(i.structure),c=this.plugin.helpers.substructureParent.get(a.structure),!s||!u||!l||!c?[2]:(d=[s.transform.ref],Fa(d,u.transform.ref),Fa(d,l.transform.ref),Fa(d,c.transform.ref),f=this.getGroup(),f.apply(rt.Model.MultiStructureSelectionFromExpression,{selections:[{key:"a",ref:s.transform.ref,expression:Re.toExpression(r)},{key:"b",ref:u.transform.ref,expression:Re.toExpression(n)},{key:"c",ref:l.transform.ref,expression:Re.toExpression(i)},{key:"d",ref:c.transform.ref,expression:Re.toExpression(a)}],isTransitive:!0,label:"Dihedral"},{dependsOn:d,tags:o==null?void 0:o.selectionTags}).apply(rt.Representation.StructureSelectionsDihedral3D,E(E(E({customText:(o==null?void 0:o.customText)||"",textColor:this.state.options.textColor},o==null?void 0:o.lineParams),o==null?void 0:o.labelParams),o==null?void 0:o.visualParams),{tags:o==null?void 0:o.reprTags}),p=this.plugin.state.data,[4,_t.State.Update(this.plugin,{state:p,tree:f,options:{doNotLogTiming:!0}})]);case 1:return v.sent(),[2]}})})},t.prototype.addLabel=function(r,n){return ce(this,void 0,void 0,function(){var i,a,o,s;return de(this,function(u){switch(u.label){case 0:return i=this.plugin.helpers.substructureParent.get(r.structure),i?(a=[i.transform.ref],o=this.getGroup(),o.apply(rt.Model.MultiStructureSelectionFromExpression,{selections:[{key:"a",ref:i.transform.ref,expression:Re.toExpression(r)}],isTransitive:!0,label:"Label"},{dependsOn:a,tags:n==null?void 0:n.selectionTags}).apply(rt.Representation.StructureSelectionsLabel3D,E(E({textColor:this.state.options.textColor},n==null?void 0:n.labelParams),n==null?void 0:n.visualParams),{tags:n==null?void 0:n.reprTags}),s=this.plugin.state.data,[4,_t.State.Update(this.plugin,{state:s,tree:o,options:{doNotLogTiming:!0}})]):[2];case 1:return u.sent(),[2]}})})},t.prototype.addOrientation=function(r){return ce(this,void 0,void 0,function(){var n,i,a,o;return de(this,function(s){switch(s.label){case 0:return n=this.plugin.helpers.substructureParent.get(r.structure),n?(i=[n.transform.ref],a=this.getGroup(),a.apply(rt.Model.MultiStructureSelectionFromExpression,{selections:[{key:"a",ref:n.transform.ref,expression:Re.toExpression(r)}],isTransitive:!0,label:"Orientation"},{dependsOn:i}).apply(rt.Representation.StructureSelectionsOrientation3D),o=this.plugin.state.data,[4,_t.State.Update(this.plugin,{state:o,tree:a,options:{doNotLogTiming:!0}})]):[2];case 1:return s.sent(),[2]}})})},t.prototype.getTransforms=function(r){var n=this.plugin.state.data,i=ir.findTagInSubtree(n.tree,cr.RootRef,IT),a=i?n.select(ir.Generators.ofTransformer(r,i)):this._empty;return a.length===0?this._empty:a},t.prototype.sync=function(){var r=this.updateState({labels:this.getTransforms(rt.Representation.StructureSelectionsLabel3D),distances:this.getTransforms(rt.Representation.StructureSelectionsDistance3D),angles:this.getTransforms(rt.Representation.StructureSelectionsAngle3D),dihedrals:this.getTransforms(rt.Representation.StructureSelectionsDihedral3D),orientations:this.getTransforms(rt.Representation.StructureSelectionsOrientation3D)});r&&this.stateUpdated()},t}(kd),Pw=function(e){Fe(t,e);function t(r,n){n===void 0&&(n={});var i=e.call(this,{props:E(E({},I.getDefaultValues(t.Params)),n)})||this;return i.plugin=r,i._props=I.getDefaultValues(t.Params),i.events={propsUpdated:i.ev()},i.lociSelects=new t.LociSelectManager(r,i._props),i.lociHighlights=new t.LociHighlightManager(r,i._props),i}return Object.defineProperty(t.prototype,"props",{get:function(){return E({},this.state.props)},enumerable:!1,configurable:!0}),t.prototype.setProps=function(r){var n=this.props,i=E(E({},this.state.props),r);rL(n,i)||(this.updateState({props:i}),this.lociSelects.setProps(i),this.lociHighlights.setProps(i),this.events.propsUpdated.next())},t}(kd);(function(e){e.Params={granularity:I.Select("residue",ar.GranularityOptions,{label:"Picking Level",description:"Controls if selections are expanded upon picking to whole residues, chains, structures, instances, or left as atoms and coarse elements"})};var t=function(){function i(a,o){o===void 0&&(o={}),this.ctx=a,this.providers=[],this.props=I.getDefaultValues(e.Params),this.sel=a.managers.structure.selection,this.setProps(o)}return i.prototype.setProps=function(a){Object.assign(this.props,a)},i.prototype.addProvider=function(a){this.providers.push(a)},i.prototype.removeProvider=function(a){this.providers=this.providers.filter(function(o){return o!==a})},i.prototype.normalizedLoci=function(a,o){o===void 0&&(o=!0);var s=a.loci,u=a.repr,l=o?this.props.granularity:void 0;return{loci:ar.normalize(s,l),repr:u}},i.prototype.mark=function(a,o){if(!ar.isEmpty(a.loci))for(var s=0,u=this.providers;s<u.length;s++){var l=u[s];l(a,o)}},i}();e.LociMarkManager=t;var r=function(i){Fe(a,i);function a(){var o=i!==null&&i.apply(this,arguments)||this;return o.prev=[],o.clearHighlights=function(){for(var s=0,u=o.prev;s<u.length;s++){var l=u[s];o.mark(l,tr.RemoveHighlight)}o.prev.length=0},o}return a.prototype.isHighlighted=function(o){for(var s=0,u=this.prev;s<u.length;s++){var l=u[s];if(or.Loci.areEqual(l,o))return!0}return!1},a.prototype.addHighlight=function(o){this.mark(o,tr.Highlight),this.prev.push(o)},a.prototype.highlight=function(o,s){s===void 0&&(s=!0);var u=this.normalizedLoci(o,s);this.isHighlighted(u)||this.addHighlight(u)},a.prototype.highlightOnly=function(o,s){s===void 0&&(s=!0);var u=this.normalizedLoci(o,s);this.isHighlighted(u)||(this.clearHighlights(),this.addHighlight(u))},a.prototype.highlightOnlyExtend=function(o,s){s===void 0&&(s=!0);var u=this.normalizedLoci(o,s);if(Re.is(u.loci)){var l={loci:this.sel.tryGetRange(u.loci)||u.loci,repr:u.repr};this.isHighlighted(l)||(this.clearHighlights(),this.addHighlight(l))}},a}(t);e.LociHighlightManager=r;var n=function(i){Fe(a,i);function a(){return i!==null&&i.apply(this,arguments)||this}return a.prototype.toggle=function(o,s){if(s===void 0&&(s=!0),!ar.isEmpty(o.loci)){var u=this.normalizedLoci(o,s);Re.is(u.loci)?this.toggleSel(u):i.prototype.mark.call(this,u,tr.Toggle)}},a.prototype.toggleExtend=function(o,s){if(s===void 0&&(s=!0),!ar.isEmpty(o.loci)){var u=this.normalizedLoci(o,s);if(Re.is(u.loci)){var l=this.sel.tryGetRange(u.loci)||u.loci;this.toggleSel({loci:l,repr:u.repr})}}},a.prototype.select=function(o,s){s===void 0&&(s=!0);var u=this.normalizedLoci(o,s);Re.is(u.loci)&&this.sel.modify("add",u.loci),this.mark(u,tr.Select)},a.prototype.selectJoin=function(o,s){s===void 0&&(s=!0);var u=this.normalizedLoci(o,s);Re.is(u.loci)&&this.sel.modify("intersect",u.loci),this.mark(u,tr.Select)},a.prototype.selectOnly=function(o,s){s===void 0&&(s=!0);var u=this.normalizedLoci(o,s);Re.is(u.loci)&&(this.deselect({loci:We.toStructureElementLoci(u.loci.structure),repr:u.repr},!1),this.sel.modify("set",u.loci)),this.mark(u,tr.Select)},a.prototype.deselect=function(o,s){s===void 0&&(s=!0);var u=this.normalizedLoci(o,s);Re.is(u.loci)&&this.sel.modify("remove",u.loci),this.mark(u,tr.Deselect)},a.prototype.deselectAll=function(){this.sel.clear(),this.mark({loci:q$e},tr.Deselect)},a.prototype.deselectAllOnEmpty=function(o){Du(o.loci)&&this.deselectAll()},a.prototype.mark=function(o,s){var u=o.loci;ar.isEmpty(u)||(Re.is(u)?(i.prototype.mark.call(this,{loci:We.Loci(u.structure)},tr.Deselect),i.prototype.mark.call(this,{loci:this.sel.getLoci(u.structure)},tr.Select)):i.prototype.mark.call(this,o,s))},a.prototype.toggleSel=function(o){this.sel.has(o.loci)?(this.sel.modify("remove",o.loci),this.mark(o,tr.Deselect)):(this.sel.modify("add",o.loci),this.mark(o,tr.Select))},a}(t);e.LociSelectManager=n})(Pw||(Pw={}));function Int(e,t){for(var r,n=[],i=t==="auth"?"auth_asym_id":"label_asym_id",a=t==="auth"?"auth_seq_id":"label_seq_id",o=0,s=e;o<s.length;o++){var u=s[o];if(u.kind==="range")n.push(se.struct.generator.atomGroups({"chain-test":se.core.rel.eq([se.ammp(i),u.asym_id]),"residue-test":se.core.rel.inRange([se.ammp(a),u.seq_id_beg,u.seq_id_end])}));else{var l=((r=u.ins_code)!==null&&r!==void 0?r:"").trim();n.push(se.struct.generator.atomGroups({"chain-test":se.core.rel.eq([se.ammp(i),u.asym_id]),"residue-test":se.core.logic.and([se.core.rel.eq([se.ammp(a),u.seq_id]),se.core.rel.eq([se.ammp("pdbx_PDB_ins_code"),l])])}))}}var c=se.struct.combinator.merge(n);return gv(c)}function Mnt(e){for(var t=tn.create(),r=0,n=e;r<n.length;r++)for(var i=n[r],a=i[0],o=i[1],s=a;s<=o;s++)tn.add(t,s,s);var u=se.struct.generator.atomGroups({"atom-test":se.core.set.has([se.set.apply(se,t.array),se.ammp("id")])});return gv(u)}function Dnt(e,t,r){if(!(!e||t.length===0||Number.isNaN(+t[0])))return Number.isNaN(r)?{kind:"single",asym_id:e,seq_id:+t[0],ins_code:t[1]}:{kind:"range",asym_id:e,seq_id_beg:+t[0],seq_id_end:r}}function Rnt(e){return e?e.split(":"):[]}function knt(e){return e.split(",").map(function(t){return t.trim().split(/\s+|[-]/g).filter(function(r){return!!r})}).map(function(t){return Dnt(t[0],Rnt(t[1]),+t[2])}).filter(function(t){return!!t})}function Ont(e){return e.split(",").map(function(t){return t.trim().split(/\s+|[-]/g).filter(function(r){return!!r})}).filter(function(t){return t.length===1||t.length===2}).map(function(t){return t.length===1?[+t[0],+t[0]]:[+t[0],+t[1]]})}function Lnt(e,t){if(t==="atom-id"){var r=Ont(e);return Mnt(r)}else{var r=knt(e);return Int(r,t)}}function Fnt(e){return Object.keys(e).map(function(t){return[t,e[t]]})}var SR=function(e){Fe(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.getBindingComponents=function(){var r=Fnt(this.props.bindings);return P.jsx(P.Fragment,{children:r.map(function(n){var i=n[0],a=n[1];return hr.isEmpty(a)?null:P.jsxs("div",E({style:{marginBottom:"6px"}},{children:[P.jsx("b",{children:a.action},void 0),P.jsx("br",{},void 0),P.jsx("span",{dangerouslySetInnerHTML:{__html:hr.format(a,i)}},void 0)]}),i)})},void 0)},t.prototype.render=function(){return P.jsx(fl,{children:this.getBindingComponents()},void 0)},t}(_e.PureComponent),fl=function(e){Fe(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.render=function(){return P.jsx("div",E({className:"msp-help-text"},{children:P.jsx("div",{children:this.props.children},void 0)}),void 0)},t}(_e.PureComponent),gl=function(e){Fe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={header:r.props.header,isExpanded:!!r.props.initiallyExpanded},r.toggleExpanded=function(){return r.setState({isExpanded:!r.state.isExpanded})},r}return t.prototype.render=function(){return P.jsxs("div",E({className:"msp-control-group-wrapper"},{children:[P.jsx("div",E({className:"msp-control-group-header"},{children:P.jsxs(mr,E({onClick:this.toggleExpanded},{children:[P.jsx(sn,{svg:this.state.isExpanded?Kc:Qc},void 0),this.props.header]}),void 0)}),void 0),this.state.isExpanded&&P.jsx("div",E({className:"msp-control-offset",style:{display:this.state.isExpanded?"block":"none"}},{children:this.props.children}),void 0)]}),void 0)},t}(_e.PureComponent);function MT(e){return P.jsx("div",E({className:"msp-simple-help-section"},{children:e.header}),void 0)}var TF=function(e){Fe(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.events.canvas3d.settingsUpdated,function(){return r.forceUpdate()})},t.prototype.render=function(){var r={};return this.plugin.spec.behaviors.forEach(function(n){var i=n.defaultParams.bindings;i&&Object.assign(r,i)}),P.jsxs(P.Fragment,{children:[!this.props.selectOnly&&this.plugin.canvas3d&&P.jsx(gl,E({header:"Moving in 3D"},{children:P.jsx(SR,{bindings:this.plugin.canvas3d.props.trackball.bindings},void 0)}),"trackball"),P.jsx(gl,E({header:"Mouse Controls"},{children:P.jsx(SR,{bindings:r},void 0)}),"interactions")]},void 0)},t}(gr),Nnt=function(e){Fe(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.events.canvas3d.settingsUpdated,function(){return r.forceUpdate()})},t.prototype.formatTriggers=function(r){return r.triggers.map(function(n){return hr.Trigger.format(n)}).join(" or ")},t.prototype.getTriggerFor=function(r,n){var i=this.plugin.state.behaviors,a=i.select(ir.Generators.ofTransformer(r)),o=a.length===1?a[0].params:void 0,s=o?o.values.bindings:{},u=n in s?s[n]:hr.Empty;return this.formatTriggers(u)},t.prototype.render=function(){var r=this.getTriggerFor(Une,"clickSelectToggle"),n=this.getTriggerFor(rA,"clickFocus");return P.jsxs("div",{children:[P.jsx(MT,{header:"Interface Controls"},void 0),P.jsxs(gl,E({header:"Inline Help"},{children:[P.jsx(fl,{children:"Many user interface elements show a little questionmark icon when hovered over. Clicking the icon toggles the display of an inline help text."},void 0),P.jsx(fl,{children:"Tooltips may provide additional information on a user interface element and are shown when hovering over it with the mouse."},void 0)]}),void 0),P.jsx(gl,E({header:"Selections"},{children:P.jsxs(fl,{children:["The viewer allows changing colors and representations for selections of atoms, residues or chains. Selections can be created by",P.jsxs("ul",E({style:{paddingLeft:"20px"}},{children:[P.jsxs("li",{children:["picking elements on the 3D canvas or the sequence view using the mouse, e.g. toggle selection using ",r," (for more see help section on ",P.jsx("i",{children:"Mouse Controls"},void 0),")"]},void 0),P.jsxs("li",{children:["using the ",P.jsx("i",{children:"Add"},void 0),", ",P.jsx("i",{children:"Remove"},void 0)," and ",P.jsx("i",{children:"Only"},void 0)," dropdown buttons in the ",P.jsx("i",{children:"Manage Selection"},void 0)," panel which allow modifing the current selection by predefined sets"]},void 0)]}),void 0)]},void 0)}),void 0),P.jsx(gl,E({header:"Coloring"},{children:P.jsxs(fl,{children:["There are two ways to color structures. Every representation (e.g. cartoon or spacefill) has a color theme which can be changed using the dropdown for each representation in the ",P.jsx("i",{children:"Structure Settings"},void 0)," panel. Additionally any selection atoms, residues or chains can by given a custom color. For that, first select the parts of the structure to be colored (see help section on ",P.jsx("i",{children:"Selections"},void 0),") and, second, choose a color from the color dropdown botton in the ",P.jsx("i",{children:"Selection"},void 0)," row of the ",P.jsx("i",{children:"Change Representation"},void 0)," panel. The theme color can be seen as a base color that is overpainted by the custom color. Custom colors can be removed for a selection with the 'Clear' option in the color dropdown."]},void 0)}),void 0),P.jsx(gl,E({header:"Representations"},{children:P.jsxs(fl,{children:["Structures can be shown with many different representations (e.g. cartoon or spacefill). The ",P.jsx("i",{children:"Change Representation"},void 0)," panel offers a collection of predefined styles which can be applied using the ",P.jsx("i",{children:"Preset"},void 0)," dropdown button. Additionally any selection atoms, residues or chains can by shown with a custom representation. For that, first select the parts of the structure to be mofified (see help section on ",P.jsx("i",{children:"Selections"},void 0),") and, second, choose a representation to hide or show from the ",P.jsx("i",{children:"Show"},void 0)," and ",P.jsx("i",{children:"Hide"},void 0)," dropdown bottons in the ",P.jsx("i",{children:"Selection"},void 0)," row of the ",P.jsx("i",{children:"Change Representation"},void 0)," panel. The ",P.jsx("i",{children:"Everything"},void 0)," row applies the action to the whole structure instead of the current selection."]},void 0)}),void 0),P.jsx(gl,E({header:"Surroundings"},{children:P.jsxs(fl,{children:["To show the surroundings of a residue or ligand, click it in the 3D scene or in the sequence widget using ",n,"."]},void 0)}),void 0),P.jsx(MT,{header:"How-to Guides"},void 0),P.jsx(gl,E({header:"Create an Image"},{children:P.jsxs(fl,{children:[P.jsxs("p",{children:["Use the ",P.jsx(sn,{svg:cMe},void 0)," icon in the viewport to bring up the screenshot controls."]},void 0),P.jsxs("p",{children:["To adjust the size of the image, use the ",P.jsx("i",{children:"Resolution"},void 0)," dropdown."]},void 0)]},void 0)}),void 0),P.jsx(MT,{header:"Mouse Controls"},void 0),P.jsx(TF,{},void 0)]},void 0)},t}(gr),Tw=function(e){Fe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r._toggleSelMode=function(){r.plugin.selectionMode=!r.plugin.selectionMode},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.events.canvas3d.settingsUpdated,function(){return r.forceUpdate()}),this.subscribe(this.plugin.layout.events.updated,function(){return r.forceUpdate()}),this.subscribe(this.plugin.behaviors.interaction.selectionMode,function(){return r.forceUpdate()})},t.prototype.render=function(){var r=this.props.inline?{background:"transparent",width:"auto",height:"auto",lineHeight:"unset"}:{background:"transparent"};return P.jsx(Ht,{svg:d5e,onClick:this._toggleSelMode,title:"Toggle Selection Mode",style:r,toggleState:this.plugin.selectionMode},void 0)},t}(Qi),Bnt={granularity:Pw.Params.granularity},xm=new Map([["add","Add/Union Selection"],["remove","Remove/Subtract Selection"],["intersect","Intersect Selection"],["set","Set Selection"]]),Unt=function(e){Fe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={action:void 0,helper:void 0,isEmpty:!0,isBusy:!1,canUndo:!1},r.set=function(n,i){r.plugin.managers.structure.selection.fromSelectionQuery(n,i,!1)},r.selectQuery=function(n,i){if(!n||!r.state.action){r.setState({action:void 0});return}var a=r.state.action;i!=null&&i.shiftKey?r.set(a,n.value):r.setState({action:void 0},function(){r.set(a,n.value)})},r.selectHelper=function(n,i){if(console.log(n),!n||!r.state.action){r.setState({action:void 0,helper:void 0});return}r.setState({helper:n.value.kind})},r.queriesItems=[],r.queriesVersion=-1,r.helpersItems=void 0,r.toggleAdd=r.showAction("add"),r.toggleRemove=r.showAction("remove"),r.toggleIntersect=r.showAction("intersect"),r.toggleSet=r.showAction("set"),r.toggleTheme=r.showAction("theme"),r.toggleAddComponent=r.showAction("add-component"),r.toggleHelp=r.showAction("help"),r.setGranuality=function(n){var i=n.value;r.plugin.managers.interactivity.setProps({granularity:i})},r.turnOff=function(){return r.plugin.selectionMode=!1},r.undo=function(){var n=r.plugin.state.data.undo();n&&r.plugin.runTask(n)},r.subtract=function(){for(var n=r.plugin.managers.structure.hierarchy.getStructuresWithSelection(),i=[],a=0,o=n;a<o.length;a++){var s=o[a];i.push.apply(i,s.components)}i.length!==0&&r.plugin.managers.structure.component.modifyByCurrentSelection(i,"subtract")},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.managers.structure.hierarchy.behaviors.selection,function(n){var i=n.hierarchy.structures.length===0;r.state.isEmpty!==i&&r.setState({isEmpty:i}),r.queriesVersion=-1,r.forceUpdate()}),this.subscribe(this.plugin.behaviors.state.isBusy,function(n){r.setState({isBusy:n,action:void 0})}),this.subscribe(this.plugin.managers.interactivity.events.propsUpdated,function(){r.forceUpdate()}),this.subscribe(this.plugin.state.data.events.historyUpdated,function(n){var i=n.state;r.setState({canUndo:i.canUndo})})},Object.defineProperty(t.prototype,"isDisabled",{get:function(){return this.state.isBusy||this.state.isEmpty},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"structures",{get:function(){for(var r,n=[],i=0,a=this.plugin.managers.structure.hierarchy.selection.structures;i<a.length;i++){var o=a[i],s=(r=o.cell.obj)===null||r===void 0?void 0:r.data;s&&n.push(s)}return n},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"queries",{get:function(){var r=this.plugin.query.structure.registry;if(r.version!==this.queriesVersion){var n=this.structures,i=Nt(Nt(Nt(Nt([],r.list),zYe(n)),jYe(n)),UYe(n)).sort(function(a,o){return o.priority-a.priority});this.queriesItems=er.createItems(i,{filter:function(a){return a!==mi.current&&!a.isHidden},label:function(a){return a.label},category:function(a){return a.category},description:function(a){return a.description}}),this.queriesVersion=r.version}return this.queriesItems},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"helpers",{get:function(){if(this.helpersItems)return this.helpersItems;var r=[{kind:"residue-list",category:"Helpers",label:"Atom/Residue Identifier List",description:"Create a selection from a list of atom/residue ranges."}];return this.helpersItems=er.createItems(r,{label:function(n){return n.label},category:function(n){return n.category},description:function(n){return n.description}}),this.helpersItems},enumerable:!1,configurable:!0}),t.prototype.showAction=function(r){var n=this;return function(){return n.setState({action:n.state.action===r?void 0:r,helper:void 0})}},t.prototype.render=function(){var r=this,n=this.plugin.managers.interactivity.props.granularity,i=this.state.canUndo?"Undo "+this.plugin.state.data.latestUndoLabel:"Some mistakes of the past can be undone.",a=void 0;if(this.state.action&&!this.state.helper)a=P.jsxs(P.Fragment,{children:[this.state.action&&this.state.action!=="theme"&&this.state.action!=="add-component"&&this.state.action!=="help"&&P.jsxs("div",E({className:"msp-selection-viewport-controls-actions"},{children:[P.jsx(er,{header:xm.get(this.state.action),title:"Click to close.",items:this.queries,onSelect:this.selectQuery,noOffset:!0},void 0),P.jsx(er,{items:this.helpers,onSelect:this.selectHelper,noOffset:!0},void 0)]}),void 0),this.state.action==="theme"&&P.jsx("div",E({className:"msp-selection-viewport-controls-actions"},{children:P.jsx(Pc,E({header:"Theme",title:"Click to close.",initialExpanded:!0,hideExpander:!0,hideOffset:!0,onHeaderClick:this.toggleTheme,topRightIcon:Ac},{children:P.jsx(znt,{onApply:this.toggleTheme},void 0)}),void 0)}),void 0),this.state.action==="add-component"&&P.jsx("div",E({className:"msp-selection-viewport-controls-actions"},{children:P.jsx(Pc,E({header:"Add Component",title:"Click to close.",initialExpanded:!0,hideExpander:!0,hideOffset:!0,onHeaderClick:this.toggleAddComponent,topRightIcon:Ac},{children:P.jsx(fie,{onApply:this.toggleAddComponent,forSelection:!0},void 0)}),void 0)}),void 0),this.state.action==="help"&&P.jsx("div",E({className:"msp-selection-viewport-controls-actions"},{children:P.jsxs(Pc,E({header:"Help",title:"Click to close.",initialExpanded:!0,hideExpander:!0,hideOffset:!0,onHeaderClick:this.toggleHelp,topRightIcon:Ac,maxHeight:"300px"},{children:[P.jsx(gl,E({header:"Selection Operations"},{children:P.jsxs(fl,{children:["Use ",P.jsx(sn,{svg:T5,inline:!0},void 0)," ",P.jsx(sn,{svg:I5,inline:!0},void 0)," ",P.jsx(sn,{svg:M5,inline:!0},void 0)," ",P.jsx(sn,{svg:D_,inline:!0},void 0)," to modify the selection."]},void 0)}),void 0),P.jsx(gl,E({header:"Representation Operations"},{children:P.jsxs(fl,{children:["Use ",P.jsx(sn,{svg:R5,inline:!0},void 0)," ",P.jsx(sn,{svg:D5,inline:!0},void 0)," ",P.jsx(sn,{svg:F5,inline:!0},void 0)," ",P.jsx(sn,{svg:N5,inline:!0},void 0)," to color, create components, remove from components, or undo actions."]},void 0)}),void 0),P.jsx(TF,{selectOnly:!0},void 0)]}),void 0)}),void 0)]},void 0);else if(xm.has(this.state.action)&&this.state.helper==="residue-list"){var o=function(){return r.setState({action:void 0,helper:void 0})};a=P.jsx("div",E({className:"msp-selection-viewport-controls-actions"},{children:P.jsx(Pc,E({header:"Atom/Residue Identifier List",title:"Click to close.",initialExpanded:!0,hideExpander:!0,hideOffset:!0,onHeaderClick:o,topRightIcon:Ac},{children:P.jsx(Hnt,{modifier:this.state.action,plugin:this.plugin,close:o},void 0)}),void 0)}),void 0)}return P.jsxs(P.Fragment,{children:[P.jsxs("div",E({className:"msp-flex-row",style:{background:"none"}},{children:[P.jsx(Mm,{title:"Picking Level for selecting and highlighting",param:Bnt.granularity,name:"granularity",value:n,onChange:this.setGranuality,isDisabled:this.isDisabled},void 0),P.jsx(Ri,{icon:T5,title:xm.get("add")+". Hold shift key to keep menu open.",toggle:this.toggleAdd,isSelected:this.state.action==="add",disabled:this.isDisabled},void 0),P.jsx(Ri,{icon:I5,title:xm.get("remove")+". Hold shift key to keep menu open.",toggle:this.toggleRemove,isSelected:this.state.action==="remove",disabled:this.isDisabled},void 0),P.jsx(Ri,{icon:M5,title:xm.get("intersect")+". Hold shift key to keep menu open.",toggle:this.toggleIntersect,isSelected:this.state.action==="intersect",disabled:this.isDisabled},void 0),P.jsx(Ri,{icon:D_,title:xm.get("set")+". Hold shift key to keep menu open.",toggle:this.toggleSet,isSelected:this.state.action==="set",disabled:this.isDisabled},void 0),P.jsx(Ri,{icon:R5,title:"Apply Theme to Selection",toggle:this.toggleTheme,isSelected:this.state.action==="theme",disabled:this.isDisabled,style:{marginLeft:"10px"}},void 0),P.jsx(Ri,{icon:D5,title:"Create Component of Selection with Representation",toggle:this.toggleAddComponent,isSelected:this.state.action==="add-component",disabled:this.isDisabled},void 0),P.jsx(Ht,{svg:F5,title:"Remove/subtract Selection from all Components",onClick:this.subtract,disabled:this.isDisabled},void 0),P.jsx(Ht,{svg:N5,onClick:this.undo,disabled:!this.state.canUndo||this.isDisabled,title:i},void 0),P.jsx(Ri,{icon:Fl,title:"Show/hide help",toggle:this.toggleHelp,style:{marginLeft:"10px"},isSelected:this.state.action==="help"},void 0),P.jsx(Ht,{svg:tL,title:"Turn selection mode off",onClick:this.turnOff},void 0)]}),void 0),a]},void 0)},t}(gr),jnt=function(e){Fe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isEmpty:!0,isBusy:!1},r.clear=function(){return r.plugin.managers.interactivity.lociSelects.deselectAll()},r.focus=function(){if(r.plugin.managers.structure.selection.stats.elementCount!==0){var n=r.plugin.managers.structure.selection.getBoundary().sphere;r.plugin.managers.camera.focusSphere(n)}},r.highlight=function(n){r.plugin.managers.interactivity.lociHighlights.clearHighlights(),r.plugin.managers.structure.selection.entries.forEach(function(i){r.plugin.managers.interactivity.lociHighlights.highlight({loci:i.selection},!1)})},r.clearHighlight=function(){r.plugin.managers.interactivity.lociHighlights.clearHighlights()},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.managers.structure.selection.events.changed,function(){r.forceUpdate()}),this.subscribe(this.plugin.managers.structure.hierarchy.behaviors.selection,function(n){var i=n.structures.length===0;r.state.isEmpty!==i&&r.setState({isEmpty:i})}),this.subscribe(this.plugin.behaviors.state.isBusy,function(n){r.setState({isBusy:n})})},Object.defineProperty(t.prototype,"isDisabled",{get:function(){return this.state.isBusy||this.state.isEmpty},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"stats",{get:function(){var r=this.plugin.managers.structure.selection.stats;return r.structureCount===0||r.elementCount===0?"Nothing Selected":Mf(r.label)+" Selected"},enumerable:!1,configurable:!0}),t.prototype.render=function(){var r=this.plugin.managers.structure.selection.stats,n=r.structureCount===0||r.elementCount===0;return n&&this.props.hideOnEmpty?null:P.jsx(P.Fragment,{children:P.jsxs("div",E({className:"msp-flex-row"},{children:[P.jsx(mr,E({noOverflow:!0,onClick:this.focus,title:"Click to Focus Selection",disabled:n,onMouseEnter:this.highlight,onMouseLeave:this.clearHighlight,style:{textAlignLast:n?void 0:"left"}},{children:this.stats}),void 0),!n&&P.jsx(Ht,{svg:tL,onClick:this.clear,title:"Clear",className:"msp-form-control",flex:!0},void 0)]}),void 0)},void 0)},t}(gr),znt=function(e){Fe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r._params=vp(function(n){return _v.getThemeParams(r.plugin,n)}),r.state={values:I.getDefaultValues(r.params)},r.apply=function(){var n,i;r.plugin.managers.structure.component.applyTheme(r.state.values,r.plugin.managers.structure.hierarchy.current.structures),(i=(n=r.props).onApply)===null||i===void 0||i.call(n)},r.paramsChanged=function(n){return r.setState({values:n})},r}return Object.defineProperty(t.prototype,"params",{get:function(){return this._params(this.plugin.managers.structure.component.pivotStructure)},enumerable:!1,configurable:!0}),t.prototype.render=function(){return P.jsxs(P.Fragment,{children:[P.jsx(Un,{params:this.params,values:this.state.values,onChangeValues:this.paramsChanged},void 0),P.jsx(mr,E({icon:R5,className:"msp-btn-commit msp-btn-commit-on",onClick:this.apply,style:{marginTop:"1px"}},{children:"Apply Theme"}),void 0)]},void 0)},t}(Qi),hie={idType:I.Select("auth",I.arrayToOptions(["auth","label","atom-id"])),identifiers:I.Text("",{description:"A comma separated list of atom identifiers (e.g. 10, 15-25) or residue ranges in given chain (e.g. A 10-15, B 25, C 30:i)"})},Vnt=I.getDefaultValues(hie);function Hnt(e){var t=e.modifier,r=e.plugin,n=e.close,i=_e.useState(Vnt),a=i[0],o=i[1],s=function(){if(a.identifiers.trim().length!==0)try{n();var u=Lnt(a.identifiers,a.idType);r.managers.structure.selection.fromCompiledQuery(t,u,!1)}catch(l){r.log.error("Failed to create selection: "+l)}};return P.jsxs(P.Fragment,{children:[P.jsx(Un,{params:hie,values:a,onChangeValues:o,onEnter:s},void 0),P.jsxs(mr,E({className:"msp-btn-commit msp-btn-commit-on",disabled:a.identifiers.trim().length===0,onClick:s,style:{marginTop:"1px"}},{children:[h0(t)," Selection"]}),void 0)]},void 0)}var Gnt=function(e){Fe(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.defaultState=function(){return{isCollapsed:!1,header:"Measurements",brand:{accent:"gray",svg:qIe}}},t.prototype.renderControls=function(){return P.jsxs(P.Fragment,{children:[P.jsx($nt,{},void 0),P.jsx(qnt,{},void 0)]},void 0)},t}(g0),qnt=function(e){Fe(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.managers.structure.measurement.behaviors.state,function(){r.forceUpdate()})},t.prototype.renderGroup=function(r,n){for(var i=[],a=0,o=r;a<o.length;a++){var s=o[a];s.obj&&i.push(P.jsx(Xnt,{cell:s},s.obj.id))}return i.length?P.jsx(Uu,E({header:n,initiallyExpanded:!0},{children:i}),void 0):null},t.prototype.render=function(){var r=this.plugin.managers.structure.measurement.state;return P.jsxs("div",E({style:{marginTop:"6px"}},{children:[this.renderGroup(r.labels,"Labels"),this.renderGroup(r.distances,"Distances"),this.renderGroup(r.angles,"Angles"),this.renderGroup(r.dihedrals,"Dihedrals")]}),void 0)},t}(Qi),$nt=function(e){Fe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isBusy:!1,action:void 0},r.measureDistance=function(){var n=r.plugin.managers.structure.selection.additionsHistory;r.plugin.managers.structure.measurement.addDistance(n[0].loci,n[1].loci)},r.measureAngle=function(){var n=r.plugin.managers.structure.selection.additionsHistory;r.plugin.managers.structure.measurement.addAngle(n[0].loci,n[1].loci,n[2].loci)},r.measureDihedral=function(){var n=r.plugin.managers.structure.selection.additionsHistory;r.plugin.managers.structure.measurement.addDihedral(n[0].loci,n[1].loci,n[2].loci,n[3].loci)},r.addLabel=function(){var n=r.plugin.managers.structure.selection.additionsHistory;r.plugin.managers.structure.measurement.addLabel(n[0].loci)},r.selectAction=function(n){r.toggleAdd(),n&&(n==null?void 0:n.value)()},r.toggleAdd=function(){return r.setState({action:r.state.action==="add"?void 0:"add"})},r.toggleOptions=function(){return r.setState({action:r.state.action==="options"?void 0:"options"})},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.selection.events.additionsHistoryUpdated,function(){r.forceUpdate()}),this.subscribe(this.plugin.behaviors.state.isBusy,function(n){r.setState({isBusy:n})})},Object.defineProperty(t.prototype,"selection",{get:function(){return this.plugin.managers.structure.selection},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"actions",{get:function(){var r=this.selection.additionsHistory,n=[{kind:"item",label:"Label "+(r.length===0?" (1 selection required)":" (1st selection)"),value:this.addLabel,disabled:r.length===0},{kind:"item",label:"Distance "+(r.length<2?" (2 selections required)":" (top 2 selections)"),value:this.measureDistance,disabled:r.length<2},{kind:"item",label:"Angle "+(r.length<3?" (3 selections required)":" (top 3 selections)"),value:this.measureAngle,disabled:r.length<3},{kind:"item",label:"Dihedral "+(r.length<4?" (4 selections required)":" (top 4 selections)"),value:this.measureDihedral,disabled:r.length<4}];return n},enumerable:!1,configurable:!0}),t.prototype.highlight=function(r){this.plugin.managers.interactivity.lociHighlights.highlightOnly({loci:r},!1)},t.prototype.moveHistory=function(r,n){this.plugin.managers.structure.selection.modifyHistory(r,n,4)},t.prototype.focusLoci=function(r){this.plugin.managers.camera.focusLoci(r)},t.prototype.historyEntry=function(r,n){var i=this,a=this.plugin.managers.structure.selection.additionsHistory;return P.jsxs("div",E({className:"msp-flex-row"},{children:[P.jsxs(mr,E({noOverflow:!0,title:"Click to focus. Hover to highlight.",onClick:function(){return i.focusLoci(r.loci)},style:{width:"auto",textAlign:"left"},onMouseEnter:function(){return i.highlight(r.loci)},onMouseLeave:this.plugin.managers.interactivity.lociHighlights.clearHighlights},{children:[n,". ",P.jsx("span",{dangerouslySetInnerHTML:{__html:r.label}},void 0)]}),void 0),a.length>1&&P.jsx(Ht,{svg:lE,small:!0,className:"msp-form-control",onClick:function(){return i.moveHistory(r,"up")},flex:"20px",title:"Move up"},void 0),a.length>1&&P.jsx(Ht,{svg:uE,small:!0,className:"msp-form-control",onClick:function(){return i.moveHistory(r,"down")},flex:"20px",title:"Move down"},void 0),P.jsx(Ht,{svg:eu,small:!0,className:"msp-form-control",onClick:function(){return i.plugin.managers.structure.selection.modifyHistory(r,"remove")},flex:!0,title:"Remove"},void 0)]}),r.id)},t.prototype.add=function(){for(var r=this.plugin.managers.structure.selection.additionsHistory,n=[],i=0,a=Math.min(r.length,4);i<a;i++)n.push(this.historyEntry(r[i],i+1));return P.jsxs(P.Fragment,{children:[P.jsx(er,{items:this.actions,onSelect:this.selectAction},void 0),n.length>0&&P.jsx("div",E({className:"msp-control-offset"},{children:n}),void 0),n.length===0&&P.jsx("div",E({className:"msp-control-offset msp-help-text"},{children:P.jsxs("div",E({className:"msp-help-description"},{children:[P.jsx(sn,{svg:Fl,inline:!0},void 0),"Add one or more selections (toggle ",P.jsx(Tw,{inline:!0},void 0)," mode)"]}),void 0)}),void 0)]},void 0)},t.prototype.render=function(){return P.jsxs(P.Fragment,{children:[P.jsxs("div",E({className:"msp-flex-row"},{children:[P.jsx(Ri,{icon:v0,label:"Add",toggle:this.toggleAdd,isSelected:this.state.action==="add",disabled:this.state.isBusy,className:"msp-btn-apply-simple"},void 0),P.jsx(Ri,{icon:uv,label:"",title:"Options",toggle:this.toggleOptions,isSelected:this.state.action==="options",disabled:this.state.isBusy,style:{flex:"0 0 40px",padding:0}},void 0)]}),void 0),this.state.action==="add"&&this.add(),this.state.action==="options"&&P.jsx(Wnt,{},void 0)]},void 0)},t}(Qi),Wnt=function(e){Fe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isDisabled:!1},r.changed=function(n){r.plugin.managers.structure.measurement.setOptions(n)},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.managers.structure.measurement.behaviors.state,function(){r.forceUpdate()}),this.subscribe(this.plugin.behaviors.state.isBusy,function(n){r.setState({isDisabled:n})})},t.prototype.render=function(){var r=this.plugin.managers.structure.measurement.state;return P.jsx("div",E({className:"msp-control-offset"},{children:P.jsx(Un,{params:pie,values:r.options,onChangeValues:this.changed,isDisabled:this.state.isDisabled},void 0)}),void 0)},t}(Qi),Xnt=function(e){Fe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={showUpdate:!1},r.delete=function(){_t.State.RemoveObject(r.plugin,{state:r.props.cell.parent,ref:r.props.cell.transform.parent,removeParentGhosts:!0})},r.toggleVisibility=function(n){n.preventDefault(),_t.State.ToggleVisibility(r.plugin,{state:r.props.cell.parent,ref:r.props.cell.transform.parent}),n.currentTarget.blur()},r.highlight=function(){var n,i=r.selections;if(i){r.plugin.managers.interactivity.lociHighlights.clearHighlights();for(var a=0,o=r.lociArray;a<o.length;a++){var s=o[a];r.plugin.managers.interactivity.lociHighlights.highlight({loci:s},!1)}r.plugin.managers.interactivity.lociHighlights.highlight({loci:(n=r.props.cell.obj)===null||n===void 0?void 0:n.data.repr.getLoci()},!1)}},r.clearHighlight=function(){r.plugin.managers.interactivity.lociHighlights.clearHighlights()},r.toggleUpdate=function(){return r.setState({showUpdate:!r.state.showUpdate})},r.focus=function(){var n=r.selections;if(n){var i=ar.getBundleBoundingSphere({loci:r.lociArray});i&&r.plugin.managers.camera.focusSphere(i)}},r.selectAction=function(n){n&&(r.setState({showUpdate:!1}),(n==null?void 0:n.value)())},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.state.events.cell.stateUpdated,function(n){r.forceUpdate()})},Object.defineProperty(t.prototype,"selections",{get:function(){var r;return(r=this.props.cell.obj)===null||r===void 0?void 0:r.data.sourceData},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"lociArray",{get:function(){var r=this.selections;return r?r.infos?[r.infos[0].loci]:r.pairs?r.pairs[0].loci:r.triples?r.triples[0].loci:r.quads?r.quads[0].loci:[]:[]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"label",{get:function(){var r=this.selections;return r?r.infos?yp(r.infos[0].loci,{condensed:!0}):r.pairs?zE(r.pairs[0],{condensed:!0,unitLabel:this.plugin.managers.structure.measurement.state.options.distanceUnitLabel}):r.triples?VE(r.triples[0],{condensed:!0}):r.quads?HE(r.quads[0],{condensed:!0}):"<empty>":"<empty>"},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"actions",{get:function(){var r=this;return this.props.cell.sourceRef,[er.Item("Select This",function(){return r.plugin.managers.structure.selection.fromSelections(r.props.cell.sourceRef)},{icon:D_})]},enumerable:!1,configurable:!0}),t.prototype.render=function(){var r=this.props.cell,n=r.obj;return n?P.jsxs(P.Fragment,{children:[P.jsxs("div",E({className:"msp-flex-row",onMouseEnter:this.highlight,onMouseLeave:this.clearHighlight},{children:[P.jsx("button",E({className:"msp-form-control msp-control-button-label msp-no-overflow",title:"Click to focus. Hover to highlight.",onClick:this.focus,style:{width:"auto",textAlign:"left"}},{children:P.jsx("span",{dangerouslySetInnerHTML:{__html:this.label}},void 0)}),void 0),P.jsx(Ht,{svg:r.state.isHidden?kv:Ov,toggleState:!1,small:!0,className:"msp-form-control",onClick:this.toggleVisibility,flex:!0,title:r.state.isHidden?"Show":"Hide"},void 0),P.jsx(Ht,{svg:eu,small:!0,className:"msp-form-control",onClick:this.delete,flex:!0,title:"Delete",toggleState:!1},void 0),P.jsx(Ht,{svg:sv,className:"msp-form-control",onClick:this.toggleUpdate,flex:!0,title:"Actions",toggleState:this.state.showUpdate},void 0)]}),n.id),this.state.showUpdate&&r.parent&&P.jsx(P.Fragment,{children:P.jsxs("div",E({className:"msp-accent-offset"},{children:[P.jsx(er,{items:this.actions,onSelect:this.selectAction,noOffset:!0},void 0),P.jsx(Uu,E({header:"Options",noOffset:!0},{children:P.jsx(cd,{state:r.parent,transform:r.transform,customHeader:"none",autoHideApply:!0},void 0)}),void 0)]}),void 0)},void 0)]},void 0):null},t}(Qi);function DT(e,t,r,n){for(var i=Je.indexOf(t.unit.elements,t.element),a=Re(t.structure,[{unit:t.unit,indices:Le.ofSingleton(i)}]),o=n==="residue"?Re.extendToWholeResidues(a):Re.extendToWholeChains(a),s=lt.entity.pdbx_description(t).join(", "),u=0,l=r.units;u<l.length;u++){var c=l[u],d=Re(o.structure,[{unit:c,indices:o.elements[0].indices}]),f=yp(d,{reverse:!0,hidePrefix:!0,htmlStyling:!1,granularity:n});f||(f=yp(d,{hidePrefix:!1,htmlStyling:!1})),r.units.length>1&&(f+=" | "+d.elements[0].unit.conformation.operator.name);var p={label:f,category:s,loci:d};e.has(s)?e.get(s).push(p):e.set(s,[p])}}function Ynt(e){for(var t=new Map,r=Ze.create(e),n=0,i=e.unitSymmetryGroups;n<i.length;n++){var a=i[n];if(je.isAtomic(a.units[0])){r.unit=a.units[0],r.element=a.elements[0];var o=je.Traits.is(r.unit.traits,1),s=lt.entity.type(r),u=s==="non-polymer",l=s==="branched",c=!!lt.entity.prd_id(r);if(c)DT(t,r,a,"chain");else if(u&&!o)DT(t,r,a,"residue");else if(l||u&&o)for(var d=r.unit,f=d.model.atomicHierarchy.residueAtomSegments.index,p=-1,v=0,h=d.elements.length;v<h;++v){var m=d.elements[v],g=f[m];g!==p&&(r.element=m,DT(t,r,a,"residue"),p=g)}}}var y=[];return t.forEach(function(b,S){b.length===1?y.push({label:S+": "+b[0].label,loci:b[0].loci}):b.length<2e3&&y.push.apply(y,b)}),y}var Knt=function(e){Fe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isBusy:!1,showAction:!1},r.getSelectionItems=vp(function(n){for(var i,a=[],o=0,s=n;o<s.length;o++){var u=s[o],l=(i=u.cell.obj)===null||i===void 0?void 0:i.data;if(l){var c=Ynt(l);c.length>0&&a.push(Nt([er.Header(l.label,{description:l.label})],er.createItems(c,{label:function(d){return d.label},category:function(d){return d.category},description:function(d){return d.label}})))}}return a}),r.selectAction=function(n,i){if(!n||!r.state.showAction){r.setState({showAction:!1});return}var a=n.value;i!=null&&i.shiftKey?r.plugin.managers.structure.focus.addFromLoci(a.loci):r.plugin.managers.structure.focus.set(a),r.focusCamera()},r.toggleAction=function(){return r.setState({showAction:!r.state.showAction})},r.focusCamera=function(){var n=r.plugin.managers.structure.focus.current;n&&r.plugin.managers.camera.focusLoci(n.loci)},r.clear=function(){r.plugin.managers.structure.focus.clear(),r.plugin.managers.camera.reset()},r.highlightCurrent=function(){var n=r.plugin.managers.structure.focus.current;n&&r.plugin.managers.interactivity.lociHighlights.highlightOnly({loci:n.loci},!1)},r.clearHighlights=function(){r.plugin.managers.interactivity.lociHighlights.clearHighlights()},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.managers.structure.focus.behaviors.current,function(n){r.getSelectionItems([]),r.forceUpdate()}),this.subscribe(this.plugin.managers.structure.focus.events.historyUpdated,function(n){r.forceUpdate()}),this.subscribe(this.plugin.behaviors.state.isBusy,function(n){r.setState({isBusy:n,showAction:!1})})},Object.defineProperty(t.prototype,"isDisabled",{get:function(){return this.state.isBusy||this.actionItems.length===0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"actionItems",{get:function(){var r=[],n=this.plugin.managers.structure.focus.history;n.length>0&&r.push(Nt([er.Header("History",{description:"Previously focused on items."})],er.createItems(n,{label:function(u){return u.label},description:function(u){return u.category&&u.label!==u.category?u.category+" | "+u.label:u.label}})));var i=this.getSelectionItems(this.plugin.managers.structure.hierarchy.selection.structures);if(i.length===1){var a=i[0],o=a[0];o.initiallyExpanded=!0}var s=[];return i.length>0&&s.push.apply(s,i),r.length>0&&s.push.apply(s,r),s},enumerable:!1,configurable:!0}),t.prototype.getToggleBindingLabel=function(){var r,n=this.plugin.state.behaviors.transforms.get(rA.id);if(!n)return"";var i=(r=n.params)===null||r===void 0?void 0:r.bindings.clickFocus;return!i||hr.isEmpty(i)?"":hr.formatTriggers(i)},t.prototype.render=function(){var r=this.plugin.managers.structure.focus.current,n=(r==null?void 0:r.label)||"Nothing Focused",i="Click to Center Camera";if(!r){i="Select focus using the menu";var a=this.getToggleBindingLabel();a&&(i+=`
or use '`+a+"' on element")}return P.jsxs(P.Fragment,{children:[P.jsxs("div",E({className:"msp-flex-row"},{children:[P.jsx(mr,E({noOverflow:!0,onClick:this.focusCamera,title:i,onMouseEnter:this.highlightCurrent,onMouseLeave:this.clearHighlights,disabled:this.isDisabled||!r,style:{textAlignLast:r?"left":void 0}},{children:n}),void 0),r&&P.jsx(Ht,{svg:tL,onClick:this.clear,title:"Clear",className:"msp-form-control",flex:!0,disabled:this.isDisabled},void 0),P.jsx(Ri,{icon:hMe,title:"Select a focus target to center on an show its surroundings. Hold shift to focus on multiple targets.",toggle:this.toggleAction,isSelected:this.state.showAction,disabled:this.isDisabled,style:{flex:"0 0 40px",padding:0}},void 0)]}),void 0),this.state.showAction&&P.jsx(er,{items:this.actionItems,onSelect:this.selectAction},void 0)]},void 0)},t}(gr),Qnt=function(e){Fe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.item=function(n){var i,a,o,s,u,l,c,d,f,p=r.plugin.managers.structure.hierarchy.seletionSet,v;switch(n.kind){case"model":{var h=(i=n.cell.obj)===null||i===void 0?void 0:i.data;h&&$t.TrajectoryInfo.get(h).size>1&&(v=((a=n.cell.obj)===null||a===void 0?void 0:a.data.entryId)+" | Model "+($t.TrajectoryInfo.get(h).index+1)+" of "+$t.TrajectoryInfo.get(h).size),v=((o=n.cell.obj)===null||o===void 0?void 0:o.data.entryId)+" | "+((s=n.cell.obj)===null||s===void 0?void 0:s.label);break}case"structure":{var h=(u=n.cell.obj)===null||u===void 0?void 0:u.data.models[0];if(h&&$t.TrajectoryInfo.get(h).size>1){v=h.entryId+" | "+((l=n.cell.obj)===null||l===void 0?void 0:l.label)+" (Model "+($t.TrajectoryInfo.get(h).index+1)+" of "+$t.TrajectoryInfo.get(h).size+")";break}else if(h){v=h.entryId+" | "+((c=n.cell.obj)===null||c===void 0?void 0:c.label);break}else{v=""+((d=n.cell.obj)===null||d===void 0?void 0:d.label);break}}default:v=(f=n.cell.obj)===null||f===void 0?void 0:f.label;break}var m={kind:"item",label:v||n.kind,selected:p.has(n.cell.transform.ref),value:[n]};return m},r.getTrajectoryItems=function(n){var i;return n.models.length===0?r.item(n):Nt([er.Header((i=n.cell.obj)===null||i===void 0?void 0:i.label)],n.models.map(r.getModelItems))},r.getModelItems=function(n){var i,a,o;if(n.structures.length===0)return r.item(n);if(n.structures.length===1){var s=r.plugin.managers.structure.hierarchy.seletionSet,u=n.structures[0];return{label:((i=n.cell.obj)===null||i===void 0?void 0:i.label)+" | "+((a=u.cell.obj)===null||a===void 0?void 0:a.label),selected:s.has(u.cell.transform.ref),value:[n,u]}}return Nt([er.Header((o=n.cell.obj)===null||o===void 0?void 0:o.label)],n.structures.map(r.item))},r.selectHierarchy=function(n){if(!(!n||n.length===0)){for(var i=[],a=0,o=n;a<o.length;a++)for(var s=o[a],u=0,l=s.value;u<l.length;u++){var c=l[u];i.push(c)}r.plugin.managers.structure.hierarchy.updateCurrent(i,n[0].selected?"remove":"add")}},r.toggleHierarchy=function(){return r.setState({show:r.state.show!=="hierarchy"?"hierarchy":void 0})},r.togglePreset=function(){return r.setState({show:r.state.show!=="presets"?"presets":void 0})},r.applyPreset=function(n){if(r.setState({show:void 0}),!!n){var i=r.plugin.managers.structure,a=i.hierarchy.selection.trajectories;i.hierarchy.applyPreset(a,n.value)}},r.updateModelQueueParams=void 0,r.isUpdatingModel=!1,r.updateStructureModel=function(n){r.updateModelQueueParams=n,r._updateStructureModel()},r.updateStructure=function(n){var i=r.plugin.managers.structure.hierarchy.selection,a=i.structures[0];return r.plugin.managers.structure.hierarchy.updateStructure(a,n)},r}return t.prototype.defaultState=function(){return{header:"Structure",isCollapsed:!1,isBusy:!1,brand:{accent:"purple",svg:jIe}}},t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.managers.structure.hierarchy.behaviors.selection,function(){return r.forceUpdate()}),this.subscribe(this.plugin.behaviors.state.isBusy,function(n){r.setState({isBusy:n})})},Object.defineProperty(t.prototype,"hierarchyItems",{get:function(){var r=this.plugin.managers.structure.hierarchy,n=r.current,i=[];return n.trajectories.length>1&&i.push(Nt([er.Header("Trajectories")],n.trajectories.map(this.item))),(n.models.length>1||n.trajectories.length>1)&&i.push(Nt([er.Header("Models")],n.models.map(this.item))),n.trajectories.length===1&&n.models.length===1?i.push.apply(i,n.structures.map(this.item)):n.structures.length>0&&i.push(Nt([er.Header("Structures")],n.structures.map(this.item))),i},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isEmpty",{get:function(){var r=this.plugin.managers.structure.hierarchy.current,n=r.structures,i=r.models,a=r.trajectories;return a.length===0&&i.length===0&&n.length===0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"label",{get:function(){var r,n,i,a,o,s,u,l,c,d,f,p,v,h,m=this.plugin.managers.structure.hierarchy.selection,g=m.structures,y=m.models,b=m.trajectories;if(g.length===1){var S=g[0];return!((n=(r=S.model)===null||r===void 0?void 0:r.trajectory)===null||n===void 0)&&n.models&&S.model.trajectory.models.length===1?(i=S.cell.obj)===null||i===void 0?void 0:i.data.label:S.model?((a=S.model.cell.obj)===null||a===void 0?void 0:a.label)+" | "+((o=S.cell.obj)===null||o===void 0?void 0:o.data.label):(s=S.cell.obj)===null||s===void 0?void 0:s.data.label}if(g.length>1){for(var x=g[0],C=(u=x==null?void 0:x.model)===null||u===void 0?void 0:u.trajectory,w=!0,A=0,M=g;A<M.length;A++){var S=M[A];if(((l=S==null?void 0:S.model)===null||l===void 0?void 0:l.trajectory)!==C){w=!1;break}}return w&&C?((c=C.cell.obj)===null||c===void 0?void 0:c.label)+" | "+g.length+" structures":g.length+" structures"}if(y.length>0){var C=y[0].trajectory;if(y.length===1){var D=(d=y[0].cell.obj)===null||d===void 0?void 0:d.data;return D&&$t.TrajectoryInfo.get(D).size>1?((f=C==null?void 0:C.cell.obj)===null||f===void 0?void 0:f.label)+" | Model "+($t.TrajectoryInfo.get(D).index+1)+" of "+$t.TrajectoryInfo.get(D).size:((p=C==null?void 0:C.cell.obj)===null||p===void 0?void 0:p.label)+" | Model"}for(var w=!0,k=0,R=y;k<R.length;k++){var O=R[k];if(O.trajectory!==C){w=!1;break}}return w?((v=C==null?void 0:C.cell.obj)===null||v===void 0?void 0:v.label)+" | "+y.length+" models":y.length+" models"}return b.length>0?b.length===1?((h=b[0].cell.obj)===null||h===void 0?void 0:h.label)+" trajectory":b.length+" trajectories":b.length===0&&y.length===0&&g.length===0?"Nothing Loaded":"Nothing Selected"},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"presetActions",{get:function(){var r=[],n=this.plugin.managers.structure.hierarchy.selection.trajectories;if(n.length===0)return r;var i=this.plugin.builders.structure.hierarchy.getPresets(n[0].cell.obj);if(n.length>1){for(var a=new Set(i),o=1;o<n.length;o++)for(var s=this.plugin.builders.structure.hierarchy.getPresets(n[o].cell.obj),u=new Set(s),l=0,c=s;l<c.length;l++){var d=c[l];u.has(d)||a.delete(d)}i=i.filter(function(v){return a.has(v)})}for(var f=0,p=i;f<p.length;f++){var d=p[f];r.push(er.Item(d.display.name,d,{description:d.display.description}))}return r},enumerable:!1,configurable:!0}),t.prototype._updateStructureModel=function(){return ce(this,void 0,void 0,function(){var r,n,i;return de(this,function(a){switch(a.label){case 0:if(!this.updateModelQueueParams||this.isUpdatingModel)return[2];r=this.updateModelQueueParams,this.updateModelQueueParams=void 0,a.label=1;case 1:return a.trys.push([1,,3,4]),this.isUpdatingModel=!0,n=this.plugin.managers.structure.hierarchy.selection,i=n.structures[0].model,[4,this.plugin.state.updateTransform(this.plugin.state.data,i.cell.transform.ref,r,"Model Index")];case 2:return a.sent(),[3,4];case 3:return this.isUpdatingModel=!1,this._updateStructureModel(),[7];case 4:return[2]}})})},Object.defineProperty(t.prototype,"modelIndex",{get:function(){var r,n,i=this.plugin.managers.structure.hierarchy.selection;if(i.structures.length!==1)return null;var a=i.structures[0].model;if(!a||a.cell.transform.transformer!==rt.Model.ModelFromTrajectory||!a.cell.obj||$t.TrajectoryInfo.get(a.cell.obj.data).size<=1)return null;var o=(r=a.cell.params)===null||r===void 0?void 0:r.definition;return o?P.jsx(Un,{params:o,values:(n=a.cell.params)===null||n===void 0?void 0:n.values,onChangeValues:this.updateStructureModel,isDisabled:this.state.isBusy},void 0):null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"structureType",{get:function(){var r,n=this.plugin.managers.structure.hierarchy.selection;if(n.structures.length!==1)return null;var i=n.structures[0],a=(r=i.cell.params)===null||r===void 0?void 0:r.definition;return!a||!i.cell.parent?null:P.jsx(cd,{state:i.cell.parent,transform:i.cell.transform,customHeader:"none",customUpdate:this.updateStructure,noMargin:!0,autoHideApply:!0},void 0)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"transform",{get:function(){var r=this.plugin.managers.structure.hierarchy.selection;if(r.structures.length!==1)return null;var n=r.structures[0];if(!n.cell.parent)return null;var i=ir.tryFindDecorator(this.plugin.state.data,n.cell.transform.ref,rt.Model.TransformStructureConformation);if(i)return P.jsx(Uu,E({header:"Conformation Transform"},{children:P.jsx(cd,{state:i.parent,transform:i.transform,customHeader:"none",noMargin:!0,autoHideApply:!0},void 0)}),void 0)},enumerable:!1,configurable:!0}),t.prototype.renderControls=function(){var r=this.state.isBusy||this.isEmpty,n=this.presetActions,i=this.label;return P.jsxs(P.Fragment,{children:[P.jsxs("div",E({className:"msp-flex-row",style:{marginTop:"1px"}},{children:[P.jsx(mr,E({noOverflow:!0,flex:!0,onClick:this.toggleHierarchy,disabled:r,title:i},{children:i}),void 0),n.length>0&&P.jsx(Ht,{svg:cE,className:"msp-form-control",flex:"40px",onClick:this.togglePreset,title:"Apply a structure presets to the current hierarchy.",toggleState:this.state.show==="presets",disabled:r},void 0)]}),void 0),this.state.show==="hierarchy"&&P.jsx(er,{items:this.hierarchyItems,onSelect:this.selectHierarchy,multiselect:!0},void 0),this.state.show==="presets"&&P.jsx(er,{items:n,onSelect:this.applyPreset},void 0),this.modelIndex,this.structureType,this.transform,P.jsxs("div",E({style:{marginTop:"6px"}},{children:[P.jsx(Knt,{},void 0),P.jsx(jnt,{hideOnEmpty:!0},void 0)]}),void 0)]},void 0)},t}(g0);function Znt(e,t){var r=rit(e,t||IF());return sit(e.tree,r),t&&t.refs.forEach(ait,r),{hierarchy:r.hierarchy,added:r.added,changed:r.changed}}function IF(){return{volumes:[],lazyVolumes:[],refs:new Map}}function Jnt(e){return{kind:"volume",cell:e,version:e.transform.version,representations:[]}}function eit(e){return{kind:"lazy-volume",cell:e,version:e.transform.version}}function tit(e,t){return{kind:"volume-representation",cell:e,version:e.transform.version,volume:t}}function rit(e,t){return{state:e,oldHierarchy:t,hierarchy:IF(),changed:!1,added:new Set}}function RT(e,t,r,n){for(var i=[],a=4;a<arguments.length;a++)i[a-4]=arguments[a];var o=n.apply(void 0,i);r.push(o),e.hierarchy.refs.set(t.transform.ref,o);var s=e.oldHierarchy.refs.get(t.transform.ref);return s?s.version!==t.transform.version&&(e.changed=!0):(e.added.add(o.cell.transform.ref),e.changed=!0),o}function nit(e,t){return function(r,n){return!t(n)&&e.is(r.obj)}}function OH(){}var iit=[[nit(ge.Volume.Data,function(e){return e.currentVolume}),function(e,t){e.currentVolume=RT(e,t,e.hierarchy.volumes,Jnt,t)},function(e){return e.currentVolume=void 0}],[function(e){return ge.Volume.Lazy.is(e.obj)},function(e,t){RT(e,t,e.hierarchy.lazyVolumes,eit,t)},OH],[function(e,t){return!e.state.isGhost&&!!t.currentVolume&&ge.Volume.Representation3D.is(e.obj)},function(e,t){return e.currentVolume&&RT(e,t,e.currentVolume.representations,tit,t,e.currentVolume),!1},OH]];function vie(e){if(!e||!(e!=null&&e.parent)||!e.parent.cells.has(e.transform.ref))return!1;var t=e.obj;return!(!t||t===On.Null||e.status!=="ok"&&e.status!=="error")}function ait(e){var t=e.cell;vie(t)||(this.changed=!0)}function oit(e){mie(this,this.tree.transforms.get(e))}function mie(e,t){var r=e.state,n=r.state.cells.get(t.ref);if(vie(n)){for(var i=void 0,a=!1,o=0,s=iit;o<s.length;o++){var u=s[o],l=u[0],c=u[1],d=u[2];if(l(n,r)){var f=c(r,n);if(f===!1){a=!0;break}i=d;break}}if(!a){var p=e.tree.children.get(t.ref);p&&p.size&&p.forEach(oit,e),i&&i(r)}}}function sit(e,t){var r={tree:e,state:t};return mie(r,e.root),r.state}function Cg(e,t,r){r===void 0&&(r={});var n=r;return typeof n.type=="string"||typeof n.color=="string"||typeof n.size=="string"?uit(e,t||Ct.One,r):gie(e,t||Ct.One,r)}function uit(e,t,r){var n=r.type&&e.representation.volume.registry.get(r.type)||e.representation.volume.registry.default.provider,i=r.color&&e.representation.volume.themes.colorThemeRegistry.get(r.color)||e.representation.volume.themes.colorThemeRegistry.get(n.defaultColorTheme.name),a=r.size&&e.representation.volume.themes.sizeThemeRegistry.get(r.size)||e.representation.volume.themes.sizeThemeRegistry.get(n.defaultSizeTheme.name);return gie(e,t,{type:n,typeParams:r.typeParams,color:i,colorParams:r.colorParams,size:a,sizeParams:r.sizeParams})}function gie(e,t,r){r===void 0&&(r={});var n=e.representation.volume.themes,i={volume:t},a=r.type||e.representation.volume.registry.default.provider,o=I.getDefaultValues(a.getParams(n,t)),s=Object.assign(o,r.typeParams),u=r.color||n.colorThemeRegistry.get(a.defaultColorTheme.name),l=I.getDefaultValues(u.getParams(i));u.name===a.defaultColorTheme.name&&Object.assign(l,a.defaultColorTheme.props);var c=Object.assign(l,r.colorParams),d=r.size||n.sizeThemeRegistry.get(a.defaultSizeTheme.name),f=I.getDefaultValues(d.getParams(i));d.name===a.defaultSizeTheme.name&&Object.assign(f,a.defaultSizeTheme.props);var p=Object.assign(f,r.sizeParams);return{type:{name:a.name,params:s},colorTheme:{name:u.name,params:c},sizeTheme:{name:d.name,params:p}}}var Iw=function(e){Fe(t,e);function t(r){var n=e.call(this)||this;return n.plugin=r,n.state={syncedTree:n.dataState.tree,notified:!1,hierarchy:IF(),selection:void 0},n.behaviors={selection:n.ev.behavior({hierarchy:n.current,volume:n.selection})},n.subscribe(r.state.data.events.changed,function(i){i.inTransaction||r.behaviors.state.isAnimating.value||n.sync(!0)}),n.subscribe(r.behaviors.state.isAnimating,function(i){!i&&!r.behaviors.state.isUpdating.value&&n.sync(!0)}),n}return Object.defineProperty(t.prototype,"dataState",{get:function(){return this.plugin.state.data},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"current",{get:function(){return this.sync(!1),this.state.hierarchy},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"selection",{get:function(){return this.sync(!1),this.state.selection},enumerable:!1,configurable:!0}),t.prototype.sync=function(r){if(!(!r&&this.dataState.inUpdate)){if(this.state.syncedTree===this.dataState.tree){r&&!this.state.notified&&(this.state.notified=!0,this.behaviors.selection.next({hierarchy:this.state.hierarchy,volume:this.state.selection}));return}this.state.syncedTree=this.dataState.tree;var n=Znt(this.plugin.state.data,this.current);if(n.changed){var i=n.hierarchy;this.state.hierarchy=i,this.state.selection?this.state.selection=i.refs.has(this.state.selection.cell.transform.ref)?i.refs.get(this.state.selection.cell.transform.ref):i.volumes[0]:this.state.selection=i.volumes[0],r?(this.state.notified=!0,this.behaviors.selection.next({hierarchy:i,volume:this.state.selection})):this.state.notified=!1}}},t.prototype.setCurrent=function(r){this.state.selection=r||this.state.hierarchy.volumes[0],this.behaviors.selection.next({hierarchy:this.state.hierarchy,volume:r||this.state.hierarchy.volumes[0]})},t.prototype.remove=function(r,n){if(r.length!==0){for(var i=this.plugin.state.data.build(),a=0,o=r;a<o.length;a++){var s=o[a];i.delete(typeof s=="string"?s:s.cell.transform.ref)}return i.commit({canUndo:n?"Remove":!1})}},t.prototype.toggleVisibility=function(r,n){if(r.length!==0)for(var i=n!==void 0?n!=="show":!r[0].cell.state.isHidden,a=0,o=r;a<o.length;a++){var s=o[a];Sv(this.dataState,s.cell.transform.ref,i)}},t.prototype.addRepresentation=function(r,n){var i,a=this.dataState.build().to(r.cell).apply(rt.Representation.VolumeRepresentation3D,Cg(this.plugin,(i=r.cell.obj)===null||i===void 0?void 0:i.data,{type:n}));return a.commit({canUndo:"Add Representation"})},t}(v2);(function(e){function t(r,n){var i,a;return!((i=n==null?void 0:n.cell.obj)===null||i===void 0)&&i.data?r.representation.volume.registry.getApplicableTypes((a=n.cell.obj)===null||a===void 0?void 0:a.data):r.representation.volume.registry.types}e.getRepresentationTypes=t})(Iw||(Iw={}));var CR=function(e){Fe(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t}(ge.Create({name:"Volume Streaming",typeClass:"Object"})),LH;(function(e){(function(t){t.Float32="float32",t.Int8="int8"})(e.ValueType||(e.ValueType={}))})(LH||(LH={}));function lit(e,t){if(t===void 0&&(t="x-ray"),!e)return t;var r=e.models[0];return an.is(r.sourceData)?$t.hasEmMap(r)?"em":$t.hasXrayMap(r)?"x-ray":$t.isFromEm(r)?"em":$t.isFromXray(r)?"x-ray":t:t}function cit(e){var t=[];if(!an.is(e.sourceData))return[e.entryId];var r=e.sourceData.data.db.pdbx_database_related,n=r.db_id,i=r.db_name,a=r.content_type;if(!i.isDefined)return[e.entryId];for(var o=0,s=i.rowCount;o<s;++o)i.value(o).toUpperCase()==="EMDB"&&a.value(o)==="associated EM volume"&&t.push(n.value(o));return t}function dit(e){return[e.entryId]}function fit(e,t){if(!t||!t.models.length)return[];var r=t.models[0];switch(e){case"em":return cit(r);case"x-ray":return dit(r)}}function FH(e,t,r,n){return ce(this,void 0,void 0,function(){return de(this,function(i){switch(e){case"emdb":return[2,yie(t,r,n)];case"pdbe":return[2,pit(t,r,n)]}return[2]})})}function yie(e,t,r){return ce(this,void 0,void 0,function(){var n,i,a,o;return de(this,function(s){switch(s.label){case 0:return n=e.config.get(Yr.VolumeStreaming.EmdbHeaderServer),[4,e.fetch({url:n+"/"+r.toUpperCase()+"/header/"+r.toLowerCase()+".xml",type:"xml"}).runInContext(t)];case 1:return i=s.sent(),a=i.getElementsByTagName("map")[0],o=parseFloat(a.getElementsByTagName("contourLevel")[0].textContent),[2,o]}})})}function pit(e,t,r){var n,i,a,o;return ce(this,void 0,void 0,function(){var s,u;return de(this,function(l){switch(l.label){case 0:return r=r.toUpperCase(),[4,e.fetch({url:"https://www.ebi.ac.uk/emdb/api/entry/map/"+r,type:"json"}).runInContext(t)];case 1:return s=l.sent(),u=(i=(n=s==null?void 0:s.map)===null||n===void 0?void 0:n.contour_list)===null||i===void 0?void 0:i.contour,!u||u.length===0?[2,hit(e,t,r)]:[2,(o=(a=u.find(function(c){return c.primary}))===null||a===void 0?void 0:a.level)!==null&&o!==void 0?o:u[0].level]}})})}function hit(e,t,r){var n,i,a;return ce(this,void 0,void 0,function(){var o,s,u;return de(this,function(l){switch(l.label){case 0:return r=r.toUpperCase(),[4,e.fetch({url:"https://www.ebi.ac.uk/pdbe/api/emdb/entry/map/"+r,type:"json"}).runInContext(t)];case 1:return o=l.sent(),s=o==null?void 0:o[r],u=void 0,((a=(i=(n=s==null?void 0:s[0])===null||n===void 0?void 0:n.map)===null||i===void 0?void 0:i.contour_level)===null||a===void 0?void 0:a.value)!==void 0&&(u=+s[0].map.contour_level.value),[2,u]}})})}function vit(e,t,r){var n;return ce(this,void 0,void 0,function(){var i,a,o,s;return de(this,function(u){switch(u.label){case 0:return[4,e.fetch({url:"https://www.ebi.ac.uk/pdbe/api/pdb/entry/summary/"+r,type:"json"}).runInContext(t)];case 1:if(i=u.sent(),a=i==null?void 0:i[r],o=[],!((n=a==null?void 0:a[0])===null||n===void 0)&&n.related_structures){if(s=a[0].related_structures.filter(function(l){return l.resource==="EMDB"&&l.relationship==="associated EM volume"}),!s.length)throw new Error("No related EMDB entry found for '"+r+"'.");o.push.apply(o,s.map(function(l){return l.accession}))}else throw new Error("No related EMDB entry found for '"+r+"'.");return[2,o]}})})}function Qd(e,t,r){return{i:e,j:t,k:r}}function Cs(e,t){return{a:e,b:t}}var Jn=[Qd(0,0,0),Qd(1,0,0),Qd(1,1,0),Qd(0,1,0),Qd(0,0,1),Qd(1,0,1),Qd(1,1,1),Qd(0,1,1)],mit=[Cs(Jn[0],Jn[1]),Cs(Jn[1],Jn[2]),Cs(Jn[2],Jn[3]),Cs(Jn[3],Jn[0]),Cs(Jn[4],Jn[5]),Cs(Jn[5],Jn[6]),Cs(Jn[6],Jn[7]),Cs(Jn[7],Jn[4]),Cs(Jn[0],Jn[4]),Cs(Jn[1],Jn[5]),Cs(Jn[2],Jn[6]),Cs(Jn[3],Jn[7])],git=[{i:0,j:0,k:0,e:0},{i:1,j:0,k:0,e:1},{i:0,j:1,k:0,e:0},{i:0,j:0,k:0,e:1},{i:0,j:0,k:1,e:0},{i:1,j:0,k:1,e:1},{i:0,j:1,k:1,e:0},{i:0,j:0,k:1,e:1},{i:0,j:0,k:0,e:2},{i:1,j:0,k:0,e:2},{i:1,j:1,k:0,e:2},{i:0,j:1,k:0,e:2}],yit=[0,265,515,778,1030,1295,1541,1804,2060,2309,2575,2822,3082,3331,3593,3840,400,153,915,666,1430,1183,1941,1692,2460,2197,2975,2710,3482,3219,3993,3728,560,825,51,314,1590,1855,1077,1340,2620,2869,2111,2358,3642,3891,3129,3376,928,681,419,170,1958,1711,1445,1196,2988,2725,2479,2214,4010,3747,3497,3232,1120,1385,1635,1898,102,367,613,876,3180,3429,3695,3942,2154,2403,2665,2912,1520,1273,2035,1786,502,255,1013,764,3580,3317,4095,3830,2554,2291,3065,2800,1616,1881,1107,1370,598,863,85,348,3676,3925,3167,3414,2650,2899,2137,2384,1984,1737,1475,1226,966,719,453,204,4044,3781,3535,3270,3018,2755,2505,2240,2240,2505,2755,3018,3270,3535,3781,4044,204,453,719,966,1226,1475,1737,1984,2384,2137,2899,2650,3414,3167,3925,3676,348,85,863,598,1370,1107,1881,1616,2800,3065,2291,2554,3830,4095,3317,3580,764,1013,255,502,1786,2035,1273,1520,2912,2665,2403,2154,3942,3695,3429,3180,876,613,367,102,1898,1635,1385,1120,3232,3497,3747,4010,2214,2479,2725,2988,1196,1445,1711,1958,170,419,681,928,3376,3129,3891,3642,2358,2111,2869,2620,1340,1077,1855,1590,314,51,825,560,3728,3993,3219,3482,2710,2975,2197,2460,1692,1941,1183,1430,666,915,153,400,3840,3593,3331,3082,2822,2575,2309,2060,1804,1541,1295,1030,778,515,265,0],_g=[[],[0,8,3],[0,1,9],[1,8,3,9,8,1],[1,2,10],[0,8,3,1,2,10],[9,2,10,0,2,9],[2,8,3,2,10,8,10,9,8],[3,11,2],[0,11,2,8,11,0],[1,9,0,2,3,11],[1,11,2,1,9,11,9,8,11],[3,10,1,11,10,3],[0,10,1,0,8,10,8,11,10],[3,9,0,3,11,9,11,10,9],[9,8,10,10,8,11],[4,7,8],[4,3,0,7,3,4],[0,1,9,8,4,7],[4,1,9,4,7,1,7,3,1],[1,2,10,8,4,7],[3,4,7,3,0,4,1,2,10],[9,2,10,9,0,2,8,4,7],[2,10,9,2,9,7,2,7,3,7,9,4],[8,4,7,3,11,2],[11,4,7,11,2,4,2,0,4],[9,0,1,8,4,7,2,3,11],[4,7,11,9,4,11,9,11,2,9,2,1],[3,10,1,3,11,10,7,8,4],[1,11,10,1,4,11,1,0,4,7,11,4],[4,7,8,9,0,11,9,11,10,11,0,3],[4,7,11,4,11,9,9,11,10],[9,5,4],[9,5,4,0,8,3],[0,5,4,1,5,0],[8,5,4,8,3,5,3,1,5],[1,2,10,9,5,4],[3,0,8,1,2,10,4,9,5],[5,2,10,5,4,2,4,0,2],[2,10,5,3,2,5,3,5,4,3,4,8],[9,5,4,2,3,11],[0,11,2,0,8,11,4,9,5],[0,5,4,0,1,5,2,3,11],[2,1,5,2,5,8,2,8,11,4,8,5],[10,3,11,10,1,3,9,5,4],[4,9,5,0,8,1,8,10,1,8,11,10],[5,4,0,5,0,11,5,11,10,11,0,3],[5,4,8,5,8,10,10,8,11],[9,7,8,5,7,9],[9,3,0,9,5,3,5,7,3],[0,7,8,0,1,7,1,5,7],[1,5,3,3,5,7],[9,7,8,9,5,7,10,1,2],[10,1,2,9,5,0,5,3,0,5,7,3],[8,0,2,8,2,5,8,5,7,10,5,2],[2,10,5,2,5,3,3,5,7],[7,9,5,7,8,9,3,11,2],[9,5,7,9,7,2,9,2,0,2,7,11],[2,3,11,0,1,8,1,7,8,1,5,7],[11,2,1,11,1,7,7,1,5],[9,5,8,8,5,7,10,1,3,10,3,11],[5,7,0,5,0,9,7,11,0,1,0,10,11,10,0],[11,10,0,11,0,3,10,5,0,8,0,7,5,7,0],[11,10,5,7,11,5],[10,6,5],[0,8,3,5,10,6],[9,0,1,5,10,6],[1,8,3,1,9,8,5,10,6],[1,6,5,2,6,1],[1,6,5,1,2,6,3,0,8],[9,6,5,9,0,6,0,2,6],[5,9,8,5,8,2,5,2,6,3,2,8],[2,3,11,10,6,5],[11,0,8,11,2,0,10,6,5],[0,1,9,2,3,11,5,10,6],[5,10,6,1,9,2,9,11,2,9,8,11],[6,3,11,6,5,3,5,1,3],[0,8,11,0,11,5,0,5,1,5,11,6],[3,11,6,0,3,6,0,6,5,0,5,9],[6,5,9,6,9,11,11,9,8],[5,10,6,4,7,8],[4,3,0,4,7,3,6,5,10],[1,9,0,5,10,6,8,4,7],[10,6,5,1,9,7,1,7,3,7,9,4],[6,1,2,6,5,1,4,7,8],[1,2,5,5,2,6,3,0,4,3,4,7],[8,4,7,9,0,5,0,6,5,0,2,6],[7,3,9,7,9,4,3,2,9,5,9,6,2,6,9],[3,11,2,7,8,4,10,6,5],[5,10,6,4,7,2,4,2,0,2,7,11],[0,1,9,4,7,8,2,3,11,5,10,6],[9,2,1,9,11,2,9,4,11,7,11,4,5,10,6],[8,4,7,3,11,5,3,5,1,5,11,6],[5,1,11,5,11,6,1,0,11,7,11,4,0,4,11],[0,5,9,0,6,5,0,3,6,11,6,3,8,4,7],[6,5,9,6,9,11,4,7,9,7,11,9],[10,4,9,6,4,10],[4,10,6,4,9,10,0,8,3],[10,0,1,10,6,0,6,4,0],[8,3,1,8,1,6,8,6,4,6,1,10],[1,4,9,1,2,4,2,6,4],[3,0,8,1,2,9,2,4,9,2,6,4],[0,2,4,4,2,6],[8,3,2,8,2,4,4,2,6],[10,4,9,10,6,4,11,2,3],[0,8,2,2,8,11,4,9,10,4,10,6],[3,11,2,0,1,6,0,6,4,6,1,10],[6,4,1,6,1,10,4,8,1,2,1,11,8,11,1],[9,6,4,9,3,6,9,1,3,11,6,3],[8,11,1,8,1,0,11,6,1,9,1,4,6,4,1],[3,11,6,3,6,0,0,6,4],[6,4,8,11,6,8],[7,10,6,7,8,10,8,9,10],[0,7,3,0,10,7,0,9,10,6,7,10],[10,6,7,1,10,7,1,7,8,1,8,0],[10,6,7,10,7,1,1,7,3],[1,2,6,1,6,8,1,8,9,8,6,7],[2,6,9,2,9,1,6,7,9,0,9,3,7,3,9],[7,8,0,7,0,6,6,0,2],[7,3,2,6,7,2],[2,3,11,10,6,8,10,8,9,8,6,7],[2,0,7,2,7,11,0,9,7,6,7,10,9,10,7],[1,8,0,1,7,8,1,10,7,6,7,10,2,3,11],[11,2,1,11,1,7,10,6,1,6,7,1],[8,9,6,8,6,7,9,1,6,11,6,3,1,3,6],[0,9,1,11,6,7],[7,8,0,7,0,6,3,11,0,11,6,0],[7,11,6],[7,6,11],[3,0,8,11,7,6],[0,1,9,11,7,6],[8,1,9,8,3,1,11,7,6],[10,1,2,6,11,7],[1,2,10,3,0,8,6,11,7],[2,9,0,2,10,9,6,11,7],[6,11,7,2,10,3,10,8,3,10,9,8],[7,2,3,6,2,7],[7,0,8,7,6,0,6,2,0],[2,7,6,2,3,7,0,1,9],[1,6,2,1,8,6,1,9,8,8,7,6],[10,7,6,10,1,7,1,3,7],[10,7,6,1,7,10,1,8,7,1,0,8],[0,3,7,0,7,10,0,10,9,6,10,7],[7,6,10,7,10,8,8,10,9],[6,8,4,11,8,6],[3,6,11,3,0,6,0,4,6],[8,6,11,8,4,6,9,0,1],[9,4,6,9,6,3,9,3,1,11,3,6],[6,8,4,6,11,8,2,10,1],[1,2,10,3,0,11,0,6,11,0,4,6],[4,11,8,4,6,11,0,2,9,2,10,9],[10,9,3,10,3,2,9,4,3,11,3,6,4,6,3],[8,2,3,8,4,2,4,6,2],[0,4,2,4,6,2],[1,9,0,2,3,4,2,4,6,4,3,8],[1,9,4,1,4,2,2,4,6],[8,1,3,8,6,1,8,4,6,6,10,1],[10,1,0,10,0,6,6,0,4],[4,6,3,4,3,8,6,10,3,0,3,9,10,9,3],[10,9,4,6,10,4],[4,9,5,7,6,11],[0,8,3,4,9,5,11,7,6],[5,0,1,5,4,0,7,6,11],[11,7,6,8,3,4,3,5,4,3,1,5],[9,5,4,10,1,2,7,6,11],[6,11,7,1,2,10,0,8,3,4,9,5],[7,6,11,5,4,10,4,2,10,4,0,2],[3,4,8,3,5,4,3,2,5,10,5,2,11,7,6],[7,2,3,7,6,2,5,4,9],[9,5,4,0,8,6,0,6,2,6,8,7],[3,6,2,3,7,6,1,5,0,5,4,0],[6,2,8,6,8,7,2,1,8,4,8,5,1,5,8],[9,5,4,10,1,6,1,7,6,1,3,7],[1,6,10,1,7,6,1,0,7,8,7,0,9,5,4],[4,0,10,4,10,5,0,3,10,6,10,7,3,7,10],[7,6,10,7,10,8,5,4,10,4,8,10],[6,9,5,6,11,9,11,8,9],[3,6,11,0,6,3,0,5,6,0,9,5],[0,11,8,0,5,11,0,1,5,5,6,11],[6,11,3,6,3,5,5,3,1],[1,2,10,9,5,11,9,11,8,11,5,6],[0,11,3,0,6,11,0,9,6,5,6,9,1,2,10],[11,8,5,11,5,6,8,0,5,10,5,2,0,2,5],[6,11,3,6,3,5,2,10,3,10,5,3],[5,8,9,5,2,8,5,6,2,3,8,2],[9,5,6,9,6,0,0,6,2],[1,5,8,1,8,0,5,6,8,3,8,2,6,2,8],[1,5,6,2,1,6],[1,3,6,1,6,10,3,8,6,5,6,9,8,9,6],[10,1,0,10,0,6,9,5,0,5,6,0],[0,3,8,5,6,10],[10,5,6],[11,5,10,7,5,11],[11,5,10,11,7,5,8,3,0],[5,11,7,5,10,11,1,9,0],[10,7,5,10,11,7,9,8,1,8,3,1],[11,1,2,11,7,1,7,5,1],[0,8,3,1,2,7,1,7,5,7,2,11],[9,7,5,9,2,7,9,0,2,2,11,7],[7,5,2,7,2,11,5,9,2,3,2,8,9,8,2],[2,5,10,2,3,5,3,7,5],[8,2,0,8,5,2,8,7,5,10,2,5],[9,0,1,5,10,3,5,3,7,3,10,2],[9,8,2,9,2,1,8,7,2,10,2,5,7,5,2],[1,3,5,3,7,5],[0,8,7,0,7,1,1,7,5],[9,0,3,9,3,5,5,3,7],[9,8,7,5,9,7],[5,8,4,5,10,8,10,11,8],[5,0,4,5,11,0,5,10,11,11,3,0],[0,1,9,8,4,10,8,10,11,10,4,5],[10,11,4,10,4,5,11,3,4,9,4,1,3,1,4],[2,5,1,2,8,5,2,11,8,4,5,8],[0,4,11,0,11,3,4,5,11,2,11,1,5,1,11],[0,2,5,0,5,9,2,11,5,4,5,8,11,8,5],[9,4,5,2,11,3],[2,5,10,3,5,2,3,4,5,3,8,4],[5,10,2,5,2,4,4,2,0],[3,10,2,3,5,10,3,8,5,4,5,8,0,1,9],[5,10,2,5,2,4,1,9,2,9,4,2],[8,4,5,8,5,3,3,5,1],[0,4,5,1,0,5],[8,4,5,8,5,3,9,0,5,0,3,5],[9,4,5],[4,11,7,4,9,11,9,10,11],[0,8,3,4,9,7,9,11,7,9,10,11],[1,10,11,1,11,4,1,4,0,7,4,11],[3,1,4,3,4,8,1,10,4,7,4,11,10,11,4],[4,11,7,9,11,4,9,2,11,9,1,2],[9,7,4,9,11,7,9,1,11,2,11,1,0,8,3],[11,7,4,11,4,2,2,4,0],[11,7,4,11,4,2,8,3,4,3,2,4],[2,9,10,2,7,9,2,3,7,7,4,9],[9,10,7,9,7,4,10,2,7,8,7,0,2,0,7],[3,7,10,3,10,2,7,4,10,1,10,0,4,0,10],[1,10,2,8,7,4],[4,9,1,4,1,7,7,1,3],[4,9,1,4,1,7,0,8,1,8,7,1],[4,0,3,7,4,3],[4,8,7],[9,10,8,10,11,8],[3,0,9,3,9,11,11,9,10],[0,1,10,0,10,8,8,10,11],[3,1,10,11,3,10],[1,2,11,1,11,9,9,11,8],[3,0,9,3,9,11,1,2,9,2,11,9],[0,2,11,8,0,11],[3,2,11],[2,3,8,2,8,10,10,8,9],[9,10,2,0,9,2],[2,3,8,2,8,10,0,1,8,1,10,8],[1,10,2],[1,3,8,9,1,8],[0,9,1],[0,3,8],[]],kT=[[0,4,4,4,2,0,0,0,2,2,0,0],[4,0,4,4,0,8,0,0,0,8,8,0],[4,4,0,4,0,0,8,0,0,0,8,8],[4,4,4,0,0,0,0,1,1,0,0,1],[2,0,0,0,0,8,8,8,2,2,0,0],[0,8,0,0,8,0,8,8,0,8,8,0],[0,0,8,0,8,8,0,8,0,0,8,8],[0,0,0,1,8,8,8,0,1,0,0,1],[2,0,0,1,2,0,0,1,0,2,0,1],[2,8,0,0,2,8,0,0,2,0,8,0],[0,8,8,0,0,8,8,0,0,8,0,8],[0,0,8,1,0,0,8,1,1,0,8,0]];function bit(e,t){var r=Math.min(65536,e*4),n=qe.create(Float32Array,3,e,t&&t.vertexBuffer.ref.value),i=qe.create(Float32Array,3,e,t&&t.normalBuffer.ref.value),a=qe.create(Float32Array,1,e,t&&t.groupBuffer.ref.value),o=qe.create(Uint32Array,3,r,t&&t.indexBuffer.ref.value),s=0,u=0;return{addVertex:function(l,c,d){return++s,qe.add3(n,l,c,d)},addNormal:function(l,c,d){qe.add3(i,l,c,d)},addGroup:function(l){qe.add(a,l)},addTriangle:function(l,c,d,f){var p=l[c],v=l[d],h=l[f];p>=0&&v>=0&&h>=0&&(++u,qe.add3(o,p,v,h))},get:function(){var l=qe.compact(n,!0),c=qe.compact(i,!0),d=qe.compact(o,!0),f=qe.compact(a,!0);return Ft.create(l,d,c,f,s,u,t)}}}function xit(e,t){var r=qe.create(Float32Array,3,e),n=qe.create(Float32Array,1,e),i=qe.create(Float32Array,2,e),a=0;return{addVertex:function(o,s,u){return qe.add3(r,o,s,u)},addNormal:function(){return bf},addGroup:function(o){qe.add(n,o)},addTriangle:function(o,s,u,l,c){var d=o[s],f=o[u],p=o[l];d>=0&&f>=0&&p>=0&&(kT[s][u]&c&&(++a,qe.add2(i,o[s],o[u])),kT[u][l]&c&&(++a,qe.add2(i,o[u],o[l])),kT[s][l]&c&&(++a,qe.add2(i,o[s],o[l])))},get:function(){for(var o=qe.compact(r,!0),s=qe.compact(i,!0),u=qe.compact(n,!0),l=ls.create(a,a/10,t),c=0;c<a;++c){var d=s[c*2],f=s[c*2+1];l.add(o[d*3],o[d*3+1],o[d*3+2],o[f*3],o[f*3+1],o[f*3+2],u[d])}return l.getLines()}}}function bie(e){return E(E({},e),{bottomLeft:Di(e.bottomLeft,[0,0,0]),topRight:Di(e.topRight,e.scalarField.space.dimensions)})}function xie(e){return{dX:e.topRight[0]-e.bottomLeft[0],dY:e.topRight[1]-e.bottomLeft[1],dZ:e.topRight[2]-e.bottomLeft[2]}}function iA(e,t){var r=this;return $e.create("Marching Cubes Mesh",function(n){return ce(r,void 0,void 0,function(){var i,a,o,s,u,l,c;return de(this,function(d){switch(d.label){case 0:return i=bie(e),a=xie(i),o=a.dX,s=a.dY,u=a.dZ,l=Math.min(262144,Math.max(o*s*u/32,1024)),c=bit(l,t),[4,new Sie(n,c,i).run()];case 1:return d.sent(),[2,c.get()]}})})})}function MF(e,t){var r=this;return $e.create("Marching Cubes Lines",function(n){return ce(r,void 0,void 0,function(){var i,a,o,s,u,l,c;return de(this,function(d){switch(d.label){case 0:return i=bie(e),a=xie(i),o=a.dX,s=a.dY,u=a.dZ,l=Math.min(262144,Math.max(o*s*u/32,1024)),c=xit(l,t),[4,new Sie(n,c,i).run()];case 1:return d.sent(),[2,c.get()]}})})})}var Sie=function(){function e(t,r,n){this.ctx=t,this.minX=0,this.minY=0,this.minZ=0,this.maxX=0,this.maxY=0,this.maxZ=0,this.state=new Sit(r,n),this.minX=n.bottomLeft[0],this.minY=n.bottomLeft[1],this.minZ=n.bottomLeft[2],this.maxX=n.topRight[0]-1,this.maxY=n.topRight[1]-1,this.maxZ=n.topRight[2]-1,this.size=(this.maxX-this.minX)*(this.maxY-this.minY)*(this.maxZ-this.minZ),this.sliceSize=(this.maxX-this.minX)*(this.maxY-this.minY)}return e.prototype.doSlices=function(){return ce(this,void 0,void 0,function(){var t,r;return de(this,function(n){switch(n.label){case 0:t=0,this.edgeFilter=15,r=this.minZ,n.label=1;case 1:return r<this.maxZ?(this.slice(r),t+=this.sliceSize,this.ctx.shouldUpdate?[4,this.ctx.update({message:"Computing surface...",current:t,max:this.size})]:[3,3]):[3,4];case 2:n.sent(),n.label=3;case 3:return r++,this.edgeFilter&=-5,[3,1];case 4:return[2]}})})},e.prototype.slice=function(t){this.edgeFilter|=2;for(var r=this.minY;r<this.maxY;r++,this.edgeFilter&=-3){this.edgeFilter|=1;for(var n=this.minX;n<this.maxX;n++,this.edgeFilter&=-2)this.state.processCell(n,r,t,this.edgeFilter)}this.state.clearEdgeVertexIndexSlice(t)},e.prototype.run=function(){return ce(this,void 0,void 0,function(){return de(this,function(t){switch(t.label){case 0:return[4,this.doSlices()];case 1:return t.sent(),[2]}})})},e}(),Sit=function(){function e(t,r){this.builder=t,this.vertList=[0,0,0,0,0,0,0,0,0,0,0,0],this.i=0,this.j=0,this.k=0;var n=r.scalarField.space.dimensions;this.nX=n[0],this.nY=n[1],this.nZ=n[2],this.isoLevel=r.isoLevel,this.scalarFieldGet=r.scalarField.space.get,this.scalarField=r.scalarField.data,r.idField&&(this.idField=r.idField.data,this.idFieldGet=r.idField.space.get),this.verticesOnEdges=new Int32Array(3*this.nX*this.nY*2)}return e.prototype.get3dOffsetFromEdgeInfo=function(t){return this.nX*((this.k+t.k)%2*this.nY+this.j+t.j)+this.i+t.i},e.prototype.clearEdgeVertexIndexSlice=function(t){var r=t%2===0?0:3*this.nX*this.nY,n=t%2===0?3*this.nX*this.nY:this.verticesOnEdges.length;this.verticesOnEdges.fill(0,r,n)},e.prototype.interpolate=function(t){var r=git[t],n=3*this.get3dOffsetFromEdgeInfo(r)+r.e,i=this.verticesOnEdges[n];if(i>0)return i-1;var a=this.scalarField,o=this.scalarFieldGet,s=mit[t],u=s.a,l=s.b,c=u.i+this.i,d=u.j+this.j,f=u.k+this.k,p=l.i+this.i,v=l.j+this.j,h=l.k+this.k,m=o(a,c,d,f),g=o(a,p,v,h),y=(this.isoLevel-m)/(m-g);if(this.idField){var b=this.idFieldGet(this.idField,c,d,f),S=this.idFieldGet(this.idField,p,v,h),x=y<.5?b:S;if(x===-1&&(x=y<.5?S:b),x===-2)return-1;this.builder.addGroup(x)}else this.builder.addGroup(0);var C=this.builder.addVertex(c+y*(c-p),d+y*(d-v),f+y*(f-h));this.verticesOnEdges[n]=C+1;var w=o(a,Math.max(0,c-1),d,f)-o(a,Math.min(this.nX-1,c+1),d,f),A=o(a,c,Math.max(0,d-1),f)-o(a,c,Math.min(this.nY-1,d+1),f),M=o(a,c,d,Math.max(0,f-1))-o(a,c,d,Math.min(this.nZ,f+1)),D=o(a,Math.max(0,p-1),v,h)-o(a,Math.min(this.nX-1,p+1),v,h),k=o(a,p,Math.max(0,v-1),h)-o(a,p,Math.min(this.nY-1,v+1),h),R=o(a,p,v,Math.max(0,h-1))-o(a,p,v,Math.min(this.nZ-1,h+1)),O=w+y*(w-D),H=A+y*(A-k),B=M+y*(M-R);return this.isoLevel>=0?this.builder.addNormal(O,H,B):this.builder.addNormal(-O,-H,-B),C},e.prototype.get=function(t,r,n){return this.scalarFieldGet(this.scalarField,t,r,n)},e.prototype.processCell=function(t,r,n,i){var a=0;if(this.get(t,r,n)<this.isoLevel&&(a|=1),this.get(t+1,r,n)<this.isoLevel&&(a|=2),this.get(t+1,r+1,n)<this.isoLevel&&(a|=4),this.get(t,r+1,n)<this.isoLevel&&(a|=8),this.get(t,r,n+1)<this.isoLevel&&(a|=16),this.get(t+1,r,n+1)<this.isoLevel&&(a|=32),this.get(t+1,r+1,n+1)<this.isoLevel&&(a|=64),this.get(t,r+1,n+1)<this.isoLevel&&(a|=128),!(a===0||a===255)){this.i=t,this.j=r,this.k=n;var o=yit[a];(o&1)>0&&(this.vertList[0]=this.interpolate(0)),(o&2)>0&&(this.vertList[1]=this.interpolate(1)),(o&4)>0&&(this.vertList[2]=this.interpolate(2)),(o&8)>0&&(this.vertList[3]=this.interpolate(3)),(o&16)>0&&(this.vertList[4]=this.interpolate(4)),(o&32)>0&&(this.vertList[5]=this.interpolate(5)),(o&64)>0&&(this.vertList[6]=this.interpolate(6)),(o&128)>0&&(this.vertList[7]=this.interpolate(7)),(o&256)>0&&(this.vertList[8]=this.interpolate(8)),(o&512)>0&&(this.vertList[9]=this.interpolate(9)),(o&1024)>0&&(this.vertList[10]=this.interpolate(10)),(o&2048)>0&&(this.vertList[11]=this.interpolate(11));for(var s=_g[a],u=0;u<s.length;u+=3){var l=s[u],c=s[u+1],d=s[u+2];this.isoLevel>=0?this.builder.addTriangle(this.vertList,l,c,d,i):this.builder.addTriangle(this.vertList,d,c,l,i)}}},e}();function Cit(e,t,r,n,i,a){var o=la.getUtils(t),s=o.createValues,u=o.createRenderableState,l=xL(),c=s(t,l,r,n,i),d=u(i);return P0(t.kind,c,d,a)}function b2(e,t){var r=e.defaultProps,n=e.createGeometry,i=e.createLocationIterator,a=e.getLoci,o=e.eachLocation,s=e.setUpdateState,u=e.mustRecreate,l=e.dispose,c=e.geometryUtils,d=c.updateValues,f=c.updateBoundingSphere,p=c.updateRenderableState,v=c.createPositionIterator,h=Vl.create(),m,g,y,b,S=Object.assign({},r),x=yi.createEmpty(),C,w,A,M;function D(O,H,B){if(!B&&!C)throw new Error("missing volume");if(g=Object.assign({},S,H),y=O,b=B,Vl.reset(h),m?(!C||!Ct.areEquivalent(b,C))&&(h.createNew=!0):h.createNew=!0,h.createNew){h.createGeometry=!0;return}s(h,B,g,S,y,x),id.areEqual(O.color,x.color)||(h.updateColor=!0),h.createGeometry&&(h.updateColor=!0)}function k(O){if(h.createNew)if(A=i(b),O)m=Cit(b,O,A,y,g,t),M=v(O,m.values);else throw new Error("expected geometry to be given");else{if(!m)throw new Error("expected renderObject to be available");if(A.reset(),h.createGeometry)if(O)F.updateIfChanged(m.values.drawCount,la.getDrawCount(O)),F.updateIfChanged(m.values.uVertexCount,la.getVertexCount(O));else throw new Error("expected geometry to be given");(h.updateTransform||h.createGeometry)&&(f(m.values,O||w),M=v(O||w,m.values)),h.updateSize&&"uSize"in m.values&&Sd(A,y.size,m.values),h.updateColor&&hs(A,M,y.color,m.values),d(m.values,g),p(m.state,g)}S=g,x=y,C=b,O&&(w=O)}function R(O,H){return Hs(O)?H(Ie.ofBounds(0,A.groupCount*A.instanceCount)):o(O,C,S,H)}return{get groupCount(){return A?A.count:0},get renderObject(){return m},createOrUpdate:function(O,H,B,j){return B===void 0&&(B={}),ce(this,void 0,void 0,function(){var Y;return de(this,function(G){return D(H,B,j||C),h.createGeometry?(Y=n(O,b,y,g,w),[2,ZL(Y)?Y.then(k):k(Y)]):(k(),[2])})})},getLoci:function(O){return m?a(O,C,S,m.id):Nr},mark:function(O,H){return wr.mark(m,O,H,R)},setVisibility:function(O){wr.setVisibility(m,O)},setAlphaFactor:function(O){wr.setAlphaFactor(m,O)},setPickable:function(O){wr.setPickable(m,O)},setColorOnly:function(O){wr.setColorOnly(m,O)},setTransform:function(O,H){wr.setTransform(m,O,H)},setOverpaint:function(O){return wr.setOverpaint(m,O,R,!0)},setTransparency:function(O){return wr.setTransparency(m,O,R,!0)},setClipping:function(O){return wr.setClipping(m,O,R,!0)},destroy:function(){l==null||l(w),m&&(m.state.disposed=!0,m=void 0)},mustRecreate:u}}E({},Et.Params);function Mw(e,t,r,n,i){var a=0,o=t.webgl,s=new ri,u=Dd(),l=[],c=or.createState(),d,f,p,v,h=yi.createEmpty();function m(x,C){var w=this;x===void 0&&(x={}),C&&C!==f&&(p=r(t,C),f=C,v||(v=I.getDefaultValues(p)));var A=KD(Object.assign({},v,x),f);return Object.assign(v,x,A),$e.create("Creating or updating VolumeRepresentation",function(M){return ce(w,void 0,void 0,function(){var D,k;return de(this,function(R){switch(R.label){case 0:return d?!((k=d.mustRecreate)===null||k===void 0)&&k.call(d,f,v,o)&&(d.destroy(),d=n(u,f,v,o)):d=n(u,f,v,o),D=d.createOrUpdate({webgl:o,runtime:M},h,v,C),D?[4,D]:[3,2];case 1:R.sent(),R.label=2;case 2:return l.length=0,d&&d.renderObject&&l.push(d.renderObject),s.next(a++),[2]}})})})}function g(x,C){return d?d.mark(x,C):!1}function y(x){x.visible!==void 0&&d&&d.setVisibility(x.visible),x.alphaFactor!==void 0&&d&&d.setAlphaFactor(x.alphaFactor),x.pickable!==void 0&&d&&d.setPickable(x.pickable),x.overpaint!==void 0&&d&&d.setOverpaint(x.overpaint),x.transparency!==void 0&&d&&d.setTransparency(x.transparency),x.transform!==void 0&&d&&d.setTransform(x.transform),or.updateState(c,x)}function b(x){h=x}function S(){d&&d.destroy()}return{label:e,get groupCount(){return d?d.groupCount:0},get props(){return v},get params(){return p},get state(){return c},get theme(){return h},renderObjects:l,updated:s,createOrUpdate:m,setState:y,setTheme:b,getLoci:function(x){return x===void 0?i(f,v):d?d.getLoci(x):Nr},mark:g,destroy:S}}var Dw=_.set,Cie=_.normalize,_ie=_.sub,wie=_.addScalar,Rw=_.scale,Eie=_.toArray;function DF(e,t,r,n){var i=!1;if(Ct.isLoci(e)){if(!Ct.areEquivalent(e.volume,t))return!1;n(Ie.ofLength(t.grid.cells.data.length))&&(i=!0)}else if(Ct.Isosurface.isLoci(e)){if(!Ct.areEquivalent(e.volume,t))return!1;if(r){if(!Ct.IsoValue.areSame(e.isoValue,r,t.grid.stats))return!1;n(Ie.ofLength(t.grid.cells.data.length))&&(i=!0)}else for(var a=t.grid,o=a.stats,s=a.cells.data,u=o.sigma,l=Ct.IsoValue.toAbsolute(e.isoValue,o).absoluteValue,c=0,d=s.length;c<d;++c)yn(l,s[c],u)&&n(Ie.ofSingleton(c))&&(i=!0)}else if(Ct.Cell.isLoci(e)){if(!Ct.areEquivalent(e.volume,t))return!1;Ie.is(e.indices)?n(e.indices)&&(i=!0):Le.forEach(e.indices,function(f){n(Ie.ofSingleton(f))&&(i=!0)})}return i}function x2(e,t){t===void 0&&(t=0);var r=e[0]*e[1]*e[2],n=Math.sqrt(r),i=Math.pow(2,Math.ceil(Math.log(n)/Math.log(2))),a=e[0]+t,o=e[1]+t,s=1,u=a;return i<a*e[2]?(u=Math.floor(i/a),s=Math.ceil(e[2]/u),a*=u,o*=s):a*=e[2],{width:a,height:o,columns:u,rows:s,powerOfTwoSize:o<i?i:i*2}}function Aie(e,t,r){r===void 0&&(r=0);for(var n=e.grid,i=n.cells,a=i.space,o=i.data,s=n.stats,u=s.max,l=s.min,c=a.dimensions,d=a.dataOffset,f=x2(c,r),p=f.width,v=f.height,h=t==="data"?1:4,m=new Uint8Array(p*v*h),g={array:m,width:p,height:v},y=u-l,b=c[0],S=c[1],x=c[2],C=b+r,w=S+r,A=_(),M=_(),D=b-1,k=S-1,R=x-1,O=0;O<x;++O)for(var H=0;H<S;++H)for(var B=0;B<b;++B){var j=Math.floor(O*C%p/C),Y=Math.floor(O*C/p),G=j*C+B,$=h*(Y*w*p+H*p+G),q=d(B,H,O);t==="data"?m[$]=Math.round((o[q]-l)/y*255):(t==="groups"?u2(q,m,$):(Dw(A,o[d(Math.max(0,B-1),H,O)],o[d(B,Math.max(0,H-1),O)],o[d(B,H,Math.max(0,O-1))]),Dw(M,o[d(Math.min(D,B+1),H,O)],o[d(B,Math.min(k,H+1),O)],o[d(B,H,Math.min(R,O+1))]),Cie(A,_ie(A,A,M)),wie(A,Rw(A,A,.5),.5),Eie(Rw(A,A,255),m,$)),m[$+3]=Math.round((o[q]-l)/y*255))}return g}function _it(e){for(var t=e.grid,r=t.cells,n=r.space,i=r.data,a=t.stats,o=a.max,s=a.min,u=n.dimensions,l=u[0],c=u[1],d=u[2],f=n.dataOffset,p=new Uint8Array(l*c*d*4),v={array:p,width:l,height:c,depth:d},h=o-s,m=_(),g=_(),y=l-1,b=c-1,S=d-1,x=0,C=0;C<d;++C)for(var w=0;w<c;++w)for(var A=0;A<l;++A){var M=f(A,w,C);Dw(m,i[f(Math.max(0,A-1),w,C)],i[f(A,Math.max(0,w-1),C)],i[f(A,w,Math.max(0,C-1))]),Dw(g,i[f(Math.min(y,A+1),w,C)],i[f(A,Math.min(b,w+1),C)],i[f(A,w,Math.min(S,C+1))]),Cie(m,_ie(m,m,g)),wie(m,Rw(m,m,.5),.5),Eie(Rw(m,m,255),p,x),p[x+3]=Math.round((i[M]-s)/h*255),x+=4}return v}var wit=`
precision highp float;
precision highp int;

#if __VERSION__ == 100
    precision highp sampler2D;
    uniform sampler2D tTexture;
#else
    precision highp isampler2D;
    uniform isampler2D tTexture;
#endif

void main(void) {
    #if __VERSION__ == 100
        gl_FragColor = texture2D(tTexture, vec2(0.5));
    #else
        gl_FragColor = ivec4(texture2D(tTexture, vec2(0.5)).r);
    #endif
}
`,Eit=E(E({},_a),{tTexture:ur("texture","rgba","float","nearest")}),ks="histopyramid-sum";function Ait(e,t){if(e.namedComputeRenderables[ks]){var r=e.namedComputeRenderables[ks].values;F.update(r.tTexture,t),e.namedComputeRenderables[ks].update()}else e.namedComputeRenderables[ks]=Pit(e,t);return e.namedComputeRenderables[ks]}function Pit(e,t){var r=E(E({},wa),{tTexture:F.create(t)}),n=E({},Eit),i=Ln("sum",ko,wit,{},{0:"ivec4"}),a=Ji(e,"triangles",i,n,r);return Zi(a,r)}function Tit(e){var t=e.gl,r=e.state;r.disable(t.CULL_FACE),r.disable(t.BLEND),r.disable(t.DEPTH_TEST),r.disable(t.SCISSOR_TEST),r.depthMask(!1),r.colorMask(!0,!0,!0,!0),r.clearColor(0,0,0,0)}var Jx=new Uint8Array(4),NH=new Int32Array(4);function Iit(e,t){var r=e.gl,n=e.resources,i=Ait(e,t);e.state.currentRenderItemId=-1,e.namedFramebuffers[ks]||(e.namedFramebuffers[ks]=n.framebuffer());var a=e.namedFramebuffers[ks];e.namedTextures[ks]||(e.namedTextures[ks]=Pr(r)?n.texture("image-int32","rgba","int","nearest"):n.texture("image-uint8","rgba","ubyte","nearest"),e.namedTextures[ks].define(1,1));var o=e.namedTextures[ks];return o.attachFramebuffer(a,0),Tit(e),r.viewport(0,0,1,1),i.render(),r.finish(),e.readPixels(0,0,1,1,Pr(r)?NH:Jx),e.unbindFramebuffer(),Pr(r)?NH[0]:UL(Jx[0],Jx[1],Jx[2])}var Mit=`
precision highp float;
precision highp int;
precision highp sampler2D;

uniform sampler2D tInputLevel;

// previous level used to evaluate the new level
#if __VERSION__ == 100
    uniform sampler2D tPreviousLevel;
#else
    precision highp isampler2D;
    uniform isampler2D tPreviousLevel;
#endif

// inverted size of the previous level texture.
uniform float uSize;
uniform float uTexSize;
uniform bool uFirst;

#include common

void main(void) {
    float k = 0.5 * uSize;
    vec2 position = floor((gl_FragCoord.xy / uTexSize) / uSize) * uSize;

    #if __VERSION__ == 100
        float a, b, c, d;

        if (uFirst) {
            a = texture2D(tInputLevel, position).r * 255.0;
            b = texture2D(tInputLevel, position + vec2(k, 0.0)).r * 255.0;
            c = texture2D(tInputLevel, position + vec2(0.0, k)).r * 255.0;
            d = texture2D(tInputLevel, position + vec2(k, k)).r * 255.0;
        } else {
            a = decodeFloatRGB(texture2D(tPreviousLevel, position).rgb);
            b = decodeFloatRGB(texture2D(tPreviousLevel, position + vec2(k, 0.0)).rgb);
            c = decodeFloatRGB(texture2D(tPreviousLevel, position + vec2(0.0, k)).rgb);
            d = decodeFloatRGB(texture2D(tPreviousLevel, position + vec2(k, k)).rgb);
        }
        gl_FragColor = vec4(encodeFloatRGB(a + b + c + d), 1.0);
    #else
        int a, b, c, d;

        if (uFirst) {
            a = int(texture2D(tInputLevel, position).r * 255.0);
            b = int(texture2D(tInputLevel, position + vec2(k, 0.0)).r * 255.0);
            c = int(texture2D(tInputLevel, position + vec2(0.0, k)).r * 255.0);
            d = int(texture2D(tInputLevel, position + vec2(k, k)).r * 255.0);
        } else {
            a = texture2D(tPreviousLevel, position).r;
            b = texture2D(tPreviousLevel, position + vec2(k, 0.0)).r;
            c = texture2D(tPreviousLevel, position + vec2(0.0, k)).r;
            d = texture2D(tPreviousLevel, position + vec2(k, k)).r;
        }
        gl_FragColor = ivec4(a + b + c + d);
    #endif
}
`,Dit=E(E({},_a),{tInputLevel:ur("texture","rgba","float","nearest"),tPreviousLevel:ur("texture","rgba","float","nearest"),uSize:Ge("f"),uTexSize:Ge("f"),uFirst:Ge("b")}),gh="histogram-pyramid";function Rit(e,t,r){if(e.namedComputeRenderables[gh]){var n=e.namedComputeRenderables[gh].values;F.update(n.tInputLevel,t),F.update(n.tPreviousLevel,r),e.namedComputeRenderables[gh].update()}else e.namedComputeRenderables[gh]=kit(e,t,r);return e.namedComputeRenderables[gh]}function kit(e,t,r){var n=E(E({},wa),{tInputLevel:F.create(t),tPreviousLevel:F.create(r),uSize:F.create(0),uTexSize:F.create(0),uFirst:F.create(!0)}),i=E({},Dit),a=Ln("reduction",ko,Mit,{},{0:"ivec4"}),o=Ji(e,"triangles",a,i,n);return Zi(o,n)}var BH=[];function Oit(e,t){var r=BH[t],n=Math.pow(2,t);if(r===void 0){var i=e.isWebGL2?kw("level"+t,e,"image-int32","alpha","int","nearest"):kw("level"+t,e,"image-uint8","rgba","ubyte","nearest");i.define(n,n);var a=Pie("level"+t,e);i.attachFramebuffer(a,0),r={texture:i,framebuffer:a},BH[t]=r}return r}function Lit(e){var t=e.gl,r=e.state;r.disable(t.CULL_FACE),r.disable(t.BLEND),r.disable(t.DEPTH_TEST),r.enable(t.SCISSOR_TEST),r.depthMask(!1),r.colorMask(!0,!0,!0,!0),r.clearColor(0,0,0,0)}function Pie(e,t){var r=gh+"-"+e;return t.namedFramebuffers[r]||(t.namedFramebuffers[r]=t.resources.framebuffer()),t.namedFramebuffers[r]}function kw(e,t,r,n,i,a){var o=gh+"-"+e;return t.namedTextures[o]||(t.namedTextures[o]=t.resources.texture(r,n,i,a)),t.namedTextures[o]}function Fit(e,t,r,n){var i=e.gl,a=t.getWidth(),o=t.getHeight();if(a!==o||!E4e(a))throw new Error("inputTexture must be of square power-of-two size");var s=Math.ceil(Math.log(a)/Math.log(2)),u=Math.pow(2,s),l=Math.pow(2,s),c=Math.pow(2,s-1),d=e.isWebGL2?kw("pyramid",e,"image-int32","alpha","int","nearest"):kw("pyramid",e,"image-uint8","rgba","ubyte","nearest");d.define(l,c);var f=Pie("pyramid",e);d.attachFramebuffer(f,0),i.viewport(0,0,l,c),Pr(i)?i.clearBufferiv(i.COLOR,0,[0,0,0,0]):i.clear(i.COLOR_BUFFER_BIT);for(var p=[],v=0;v<s;++v)p.push(Oit(e,v));var h=Rit(e,t,p[0].texture);e.state.currentRenderItemId=-1,Lit(e);for(var m=0,v=0;v<s;v++){var g=s-1-v,y=p[g];y.framebuffer.bind();var b=Math.pow(2,g);F.update(h.values.uSize,Math.pow(2,v+1)/u),F.update(h.values.uTexSize,b),F.updateIfChanged(h.values.uFirst,v===0),v>0&&(F.update(h.values.tPreviousLevel,p[s-v].texture),h.update()),e.state.currentRenderItemId=-1,i.viewport(0,0,b,b),i.scissor(0,0,b,b),Pr(i)?i.clearBufferiv(i.COLOR,0,[0,0,0,0]):i.clear(i.COLOR_BUFFER_BIT),i.scissor(0,0,n[0],n[1]),h.render(),d.bind(0),i.copyTexSubImage2D(i.TEXTURE_2D,0,m,0,0,0,b,b),d.unbind(0),m+=b}i.finish();var S=Math.max(1,Iit(e,p[0].texture)),x=Math.ceil(S/Math.pow(2,s));return{pyramidTex:d,count:S,height:x,levels:s,scale:r}}var my;function Nit(){if(my!==void 0)return my;my=Ca(16*16,1,Uint8Array);for(var e=my.array,t=0,r=_g.length;t<r;++t)e[t]=_g[t].length/3;return my}var gy;function Bit(){if(gy!==void 0)return gy;gy=Ca(64*64,1,Uint8Array);for(var e=gy.array,t=0,r=_g.length;t<r;++t)for(var n=0;n<16;++n)n<_g[t].length?e[t*16+n]=_g[t][n]:e[t*16+n]=255;return gy}var Uit=`
precision highp float;
precision highp int;
precision highp sampler2D;

#if __VERSION__ == 100
    uniform sampler2D tActiveVoxelsPyramid;
#else
    precision highp isampler2D;
    uniform isampler2D tActiveVoxelsPyramid;
#endif

uniform sampler2D tActiveVoxelsBase;
uniform sampler2D tVolumeData;
uniform sampler2D tTriIndices;

uniform float uIsoValue;
uniform float uLevels;
uniform float uSize;
uniform float uCount;
uniform bool uInvert;

uniform vec3 uGridDim;
uniform vec3 uGridTexDim;
uniform mat4 uGridTransform;

// scale to volume data coord
uniform vec2 uScale;

#include common

// cube corners (excluding origin)
const vec3 c1 = vec3(1., 0., 0.);
const vec3 c2 = vec3(1., 1., 0.);
const vec3 c3 = vec3(0., 1., 0.);
const vec3 c4 = vec3(0., 0., 1.);
const vec3 c5 = vec3(1., 0., 1.);
const vec3 c6 = vec3(1., 1., 1.);
const vec3 c7 = vec3(0., 1., 1.);

vec3 index3dFrom2d(vec2 coord) {
    vec2 gridTexPos = coord * uGridTexDim.xy;
    vec2 columnRow = ivec2Div(gridTexPos, uGridDim.xy);
    vec2 posXY = gridTexPos - columnRow * uGridDim.xy;
    float posZ = columnRow.y * intDiv(uGridTexDim.x, uGridDim.x) + columnRow.x;
    return vec3(posXY, posZ);
}

vec4 texture3dFrom2dNearest(sampler2D tex, vec3 pos, vec3 gridDim, vec2 texDim) {
    float zSlice = floor(pos.z * gridDim.z + 0.5); // round to nearest z-slice
    float column = intDiv(intMod(zSlice * gridDim.x, texDim.x), gridDim.x);
    float row = intDiv(zSlice * gridDim.x, texDim.x);
    vec2 coord = (vec2(column * gridDim.x, row * gridDim.y) + (pos.xy * gridDim.xy)) / (texDim / uScale);
    return texture2D(tex, coord + 0.5 / (texDim / uScale));
}

vec4 voxel(vec3 pos) {
    pos = min(max(vec3(0.0), pos), uGridDim - vec3(1.0));
    return texture3dFrom2dNearest(tVolumeData, pos / uGridDim, uGridDim, uGridTexDim.xy);
}

vec4 voxelPadded(vec3 pos) {
    pos = min(max(vec3(0.0), pos), uGridDim - vec3(vec2(2.0), 1.0)); // remove xy padding
    return texture3dFrom2dNearest(tVolumeData, pos / uGridDim, uGridDim, uGridTexDim.xy);
}

int idot2(const in ivec2 a, const in ivec2 b) {
    return a.x * b.x + a.y * b.y;
}

int idot4(const in ivec4 a, const in ivec4 b) {
    return a.x * b.x + a.y * b.y + a.z * b.z + a.w * b.w;
}

#if __VERSION__ == 100
    int pyramidVoxel(vec2 pos) {
        return int(decodeFloatRGB(texture2D(tActiveVoxelsPyramid, pos / (vec2(1.0, 0.5) * uSize)).rgb));
    }
#else
    int pyramidVoxel(vec2 pos) {
        return texture2D(tActiveVoxelsPyramid, pos / (vec2(1.0, 0.5) * uSize)).r;
    }
#endif

vec4 baseVoxel(vec2 pos) {
    return texture2D(tActiveVoxelsBase, pos / uSize);
}

void main(void) {
    // get 1D index
    int vI = int(gl_FragCoord.x) + int(gl_FragCoord.y) * int(uSize);

    // ignore 1D indices outside of the grid
    if(vI >= int(uCount)) discard;

    ivec2 offset = ivec2(int(uSize) - 2, 0);

    int start = 0;
    ivec4 starts = ivec4(0);
    ivec4 ends = ivec4(0);
    int diff = 2;
    ivec4 m = ivec4(0);
    ivec2 position = ivec2(0);
    ivec4 vI4 = ivec4(vI);

    ivec2 relativePosition = ivec2(0);
    int end = 0;
    ivec2 pos1 = ivec2(0);
    ivec2 pos2 = ivec2(0);
    ivec2 pos3 = ivec2(0);
    ivec2 pos4 = ivec2(0);
    ivec3 vI3 = ivec3(vI);
    ivec3 mask = ivec3(0);

    // traverse the different levels of the pyramid
    for(int i = 1; i < 14; i++) {
        if(float(i) >= uLevels) break;

        offset.x -= diff;
        diff *= 2;
        relativePosition = position + offset;

        end = start + pyramidVoxel(vec2(relativePosition));
        pos1 = ivec2(relativePosition);
        starts.x = start;
        ends.x = end;
        pos2 = ivec2(relativePosition + ivec2(1, 0));
        starts.y = ends.x;
        ends.y = ends.x + pyramidVoxel(vec2(pos2));
        pos3 = relativePosition + ivec2(0, 1);
        starts.z = ends.y;
        ends.z = ends.y + pyramidVoxel(vec2(pos3));
        pos4 = relativePosition + ivec2(1, 1);
        starts.w = ends.z;
        mask = ivec3(greaterThanEqual(vI3, starts.rgb)) * ivec3(lessThan(vI3, ends.rgb));
        m = ivec4(mask, 1 - int(any(bvec3(mask))));

        relativePosition = m.x * pos1 + m.y * pos2 + m.z * pos3 + m.w * pos4;
        start = idot4(m, starts);
        position = 2 * (relativePosition - offset);
    }

    end = start + int(baseVoxel(vec2(position)).r * 255.0);
    pos1 = position;
    starts.x = start;
    ends.x = end;
    pos2 = position + ivec2(1, 0);
    starts.y = ends.x;
    ends.y = ends.x + int(baseVoxel(vec2(pos2)).r * 255.0);
    pos3 = position + ivec2(0, 1);
    starts.z = ends.y;
    ends.z = ends.y + int(baseVoxel(vec2(pos3)).r * 255.0);
    pos4 = position + ivec2(1, 1);
    starts.w = ends.z;
    mask = ivec3(greaterThanEqual(vI3, starts.rgb)) * ivec3(lessThan(vI3, ends.rgb));
    m = ivec4(mask, 1 - int(any(bvec3(mask))));
    position = m.x * pos1 + m.y * pos2 + m.z * pos3 + m.w * pos4;

    vec2 coord2d = (vec2(position) / uSize) / uScale;
    vec3 coord3d = floor(index3dFrom2d(coord2d) + 0.5);

    float edgeIndex = floor(baseVoxel(vec2(position)).a * 255.0 + 0.5);

    // current vertex for the up to 15 MC cases
    int currentVertex = vI - idot4(m, starts);

    // ensure winding-order is the same for negative and positive iso-levels
    if (uInvert) {
        int v = imod(currentVertex + 1, 3);
        if (v == 1) currentVertex += 2;
        else if (v == 0) currentVertex -= 2;
    }

    // get index into triIndices table
    int mcIndex = 16 * int(edgeIndex) + currentVertex;
    vec4 mcData = texture2D(tTriIndices, vec2(imod(mcIndex, 64), mcIndex / 64) / 64.);

    // bit mask to avoid conditionals (see comment below) for getting MC case corner
    vec4 m0 = vec4(floor(mcData.a * 255.0 + 0.5));

    // get edge value masks
    vec4 m1 = vec4(equal(m0, vec4(0., 1., 2., 3.)));
    vec4 m2 = vec4(equal(m0, vec4(4., 5., 6., 7.)));
    vec4 m3 = vec4(equal(m0, vec4(8., 9., 10., 11.)));

    // apply bit masks
    vec3 b0 = coord3d +
                m1.y * c1 +
                m1.z * c2 +
                m1.w * c3 +
                m2.x * c4 +
                m2.y * c5 +
                m2.z * c6 +
                m2.w * c7 +
                m3.y * c1 +
                m3.z * c2 +
                m3.w * c3;
    vec3 b1 = coord3d +
                m1.x * c1 +
                m1.y * c2 +
                m1.z * c3 +
                m2.x * c5 +
                m2.y * c6 +
                m2.z * c7 +
                m2.w * c4 +
                m3.x * c4 +
                m3.y * c5 +
                m3.z * c6 +
                m3.w * c7;

    // the conditionals that are avoided by above bitmasks
    // vec3 b0 = coord3d;
    // vec3 b1 = coord3d;
    // if (mcIndex == 0.0) {
    //     b1 += c1;
    // } else if (mcIndex == 1.0) {
    //     b0 += c1; b1 += c2;
    // } else if (mcIndex == 2.0) {
    //     b0 += c2; b1 += c3;
    // } else if (mcIndex == 3.0) {
    //     b0 += c3;
    // } else if (mcIndex == 4.0) {
    //     b0 += c4; b1 += c5;
    // } else if (mcIndex == 5.0) {
    //     b0 += c5; b1 += c6;
    // } else if (mcIndex == 6.0) {
    //     b0 += c6; b1 += c7;
    // } else if (mcIndex == 7.0) {
    //     b0 += c7; b1 += c4;
    // } else if (mcIndex == 8.0) {
    //     b1 += c4;
    // } else if (mcIndex == 9.0) {
    //     b0 += c1; b1 += c5;
    // } else if (mcIndex == 10.0) {
    //     b0 += c2; b1 += c6;
    // } else if (mcIndex == 11.0) {
    //     b0 += c3; b1 += c7;
    // }
    // b0 = floor(b0 + 0.5);
    // b1 = floor(b1 + 0.5);

    vec4 d0 = voxel(b0);
    vec4 d1 = voxel(b1);

    float v0 = d0.a;
    float v1 = d1.a;

    float t = (uIsoValue - v0) / (v0 - v1);
    gl_FragData[0].xyz = (uGridTransform * vec4(b0 + t * (b0 - b1), 1.0)).xyz;

    // group id
    #if __VERSION__ == 100
        // webgl1 does not support 'flat' interpolation (i.e. no interpolation)
        // so we ensure a constant group id per triangle here
        #ifdef dPackedGroup
            gl_FragData[1] = vec4(voxel(coord3d).rgb, 1.0);
        #else
            vec3 gridDim = uGridDim - vec3(1.0, 1.0, 0.0); // remove xy padding
            float group = coord3d.z + coord3d.y * gridDim.z + coord3d.x * gridDim.z * gridDim.y;
            gl_FragData[1] = vec4(group > 16777215.5 ? vec3(1.0) : encodeFloatRGB(group), 1.0);
        #endif
    #else
        #ifdef dPackedGroup
            gl_FragData[1] = vec4(t < 0.5 ? d0.rgb : d1.rgb, 1.0);
        #else
            vec3 b = t < 0.5 ? b0 : b1;
            vec3 gridDim = uGridDim - vec3(1.0, 1.0, 0.0); // remove xy padding
            float group = b.z + b.y * gridDim.z + b.x * gridDim.z * gridDim.y;
            gl_FragData[1] = vec4(group > 16777215.5 ? vec3(1.0) : encodeFloatRGB(group), 1.0);
        #endif
    #endif

    // normals from gradients
    vec3 n0 = -normalize(vec3(
        voxelPadded(b0 - c1).a - voxelPadded(b0 + c1).a,
        voxelPadded(b0 - c3).a - voxelPadded(b0 + c3).a,
        voxelPadded(b0 - c4).a - voxelPadded(b0 + c4).a
    ));
    vec3 n1 = -normalize(vec3(
        voxelPadded(b1 - c1).a - voxelPadded(b1 + c1).a,
        voxelPadded(b1 - c3).a - voxelPadded(b1 + c3).a,
        voxelPadded(b1 - c4).a - voxelPadded(b1 + c4).a
    ));
    gl_FragData[2].xyz = -vec3(
        n0.x + t * (n0.x - n1.x),
        n0.y + t * (n0.y - n1.y),
        n0.z + t * (n0.z - n1.z)
    );

    // ensure normal-direction is the same for negative and positive iso-levels
    if (uInvert) {
        gl_FragData[2].xyz *= -1.0;
    }

    // apply normal matrix
    gl_FragData[2].xyz *= transpose3(inverse3(mat3(uGridTransform)));
}
`,jit=`
precision highp float;
precision highp int;
precision highp sampler2D;

uniform sampler2D tTriCount;
uniform sampler2D tVolumeData;

uniform float uIsoValue;
uniform vec3 uGridDim;
uniform vec3 uGridTexDim;
uniform vec2 uScale;

#include common

// cube corners (excluding origin)
const vec3 c1 = vec3(1., 0., 0.);
const vec3 c2 = vec3(1., 1., 0.);
const vec3 c3 = vec3(0., 1., 0.);
const vec3 c4 = vec3(0., 0., 1.);
const vec3 c5 = vec3(1., 0., 1.);
const vec3 c6 = vec3(1., 1., 1.);
const vec3 c7 = vec3(0., 1., 1.);

vec3 index3dFrom2d(vec2 coord) {
    vec2 gridTexPos = coord * uGridTexDim.xy;
    vec2 columnRow = ivec2Div(gridTexPos, uGridDim.xy);
    vec2 posXY = gridTexPos - columnRow * uGridDim.xy;
    float posZ = columnRow.y * intDiv(uGridTexDim.x, uGridDim.x) + columnRow.x;
    return vec3(posXY, posZ);
}

vec4 texture3dFrom2dNearest(sampler2D tex, vec3 pos, vec3 gridDim, vec2 texDim) {
    float zSlice = floor(pos.z * gridDim.z + 0.5); // round to nearest z-slice
    float column = intDiv(intMod(zSlice * gridDim.x, texDim.x), gridDim.x);
    float row = intDiv(zSlice * gridDim.x, texDim.x);
    vec2 coord = (vec2(column * gridDim.x, row * gridDim.y) + (pos.xy * gridDim.xy)) / (texDim / uScale);
    return texture2D(tex, coord);
}

vec4 voxel(vec3 pos) {
    pos = min(max(vec3(0.0), pos), uGridDim - vec3(1.0));
    return texture3dFrom2dNearest(tVolumeData, pos / uGridDim, uGridDim, uGridTexDim.xy);
}

void main(void) {
    vec2 uv = gl_FragCoord.xy / uGridTexDim.xy;
    vec3 posXYZ = index3dFrom2d(uv);

    // get MC case as the sum of corners that are below the given iso level
    float c = step(voxel(posXYZ).a, uIsoValue)
        + 2. * step(voxel(posXYZ + c1).a, uIsoValue)
        + 4. * step(voxel(posXYZ + c2).a, uIsoValue)
        + 8. * step(voxel(posXYZ + c3).a, uIsoValue)
        + 16. * step(voxel(posXYZ + c4).a, uIsoValue)
        + 32. * step(voxel(posXYZ + c5).a, uIsoValue)
        + 64. * step(voxel(posXYZ + c6).a, uIsoValue)
        + 128. * step(voxel(posXYZ + c7).a, uIsoValue);
    c *= step(c, 254.);

    // handle out of bounds positions
    posXYZ += 1.0;
    posXYZ.xy += 1.0; // pixel padding (usually ok even if the texture has no padding)
    if (posXYZ.x >= uGridDim.x || posXYZ.y >= uGridDim.y || posXYZ.z >= uGridDim.z)
        c = 0.0;

    // get total triangles to generate for calculated MC case from triCount texture
    float totalTrianglesToGenerate = texture2D(tTriCount, vec2(intMod(c, 16.), floor(c / 16.)) / 16.).a;
    gl_FragColor = vec4(vec3(totalTrianglesToGenerate * 3.0), c / 255.0);
}
`,zit=E(E({},_a),{tTriCount:ur("image-uint8","alpha","ubyte","nearest"),tVolumeData:ur("texture","rgba","ubyte","nearest"),uIsoValue:Ge("f"),uGridDim:Ge("v3"),uGridTexDim:Ge("v3"),uScale:Ge("v2")}),gu="active-voxels";function Vit(e,t,r,n,i,a){if(e.namedComputeRenderables[gu]){var o=e.namedComputeRenderables[gu].values;F.update(o.uQuadScale,a),F.update(o.tVolumeData,t),F.updateIfChanged(o.uIsoValue,i),F.update(o.uGridDim,r),F.update(o.uGridTexDim,n),F.update(o.uScale,a),e.namedComputeRenderables[gu].update()}else e.namedComputeRenderables[gu]=Hit(e,t,r,n,i,a);return e.namedComputeRenderables[gu]}function Hit(e,t,r,n,i,a){var o=E(E({},wa),{tTriCount:F.create(Nit()),uQuadScale:F.create(a),tVolumeData:F.create(t),uIsoValue:F.create(i),uGridDim:F.create(r),uGridTexDim:F.create(n),uScale:F.create(a)}),s=E({},zit),u=Ln("active-voxels",ko,jit),l=Ji(e,"triangles",u,s,o);return Zi(l,o)}function Git(e){var t=e.gl,r=e.state;r.disable(t.CULL_FACE),r.disable(t.BLEND),r.disable(t.DEPTH_TEST),r.enable(t.SCISSOR_TEST),r.depthMask(!1),r.colorMask(!0,!0,!0,!0),r.clearColor(0,0,0,0)}function qit(e,t,r,n,i,a){var o=e.gl,s=e.resources,u=t.getWidth(),l=t.getHeight();e.namedFramebuffers[gu]||(e.namedFramebuffers[gu]=s.framebuffer());var c=e.namedFramebuffers[gu];c.bind(),e.namedTextures[gu]||(e.namedTextures[gu]=s.texture("image-uint8","rgba","ubyte","nearest"));var d=e.namedTextures[gu];d.define(u,l);var f=Vit(e,t,r,n,i,a);return e.state.currentRenderItemId=-1,d.attachFramebuffer(c,0),Git(e),o.viewport(0,0,u,l),o.scissor(0,0,u,l),o.clear(o.COLOR_BUFFER_BIT),o.scissor(0,0,n[0],n[1]),f.render(),o.finish(),d}var $it=E(E({},_a),{tTriIndices:ur("image-uint8","alpha","ubyte","nearest"),tActiveVoxelsPyramid:ur("texture","rgba","float","nearest"),tActiveVoxelsBase:ur("texture","rgba","float","nearest"),tVolumeData:ur("texture","rgba","ubyte","nearest"),uIsoValue:Ge("f"),uSize:Ge("f"),uLevels:Ge("f"),uCount:Ge("f"),uInvert:Ge("b"),uGridDim:Ge("v3"),uGridTexDim:Ge("v3"),uGridTransform:Ge("m4"),uScale:Ge("v2"),dPackedGroup:Qt("boolean")}),Ef="isosurface";function Wit(e,t,r,n,i,a,o,s,u,l,c,d,f){if(e.namedComputeRenderables[Ef]){var p=e.namedComputeRenderables[Ef].values;F.update(p.tActiveVoxelsPyramid,t),F.update(p.tActiveVoxelsBase,r),F.update(p.tVolumeData,n),F.updateIfChanged(p.uIsoValue,s),F.updateIfChanged(p.uSize,Math.pow(2,u)),F.updateIfChanged(p.uLevels,u),F.updateIfChanged(p.uCount,c),F.updateIfChanged(p.uInvert,d),F.update(p.uGridDim,i),F.update(p.uGridTexDim,a),F.update(p.uGridTransform,o),F.update(p.uScale,l),F.update(p.dPackedGroup,f),e.namedComputeRenderables[Ef].update()}else e.namedComputeRenderables[Ef]=Xit(e,t,r,n,i,a,o,s,u,l,c,d,f);return e.namedComputeRenderables[Ef]}function Xit(e,t,r,n,i,a,o,s,u,l,c,d,f){var p=E(E({},wa),{tTriIndices:F.create(Bit()),tActiveVoxelsPyramid:F.create(t),tActiveVoxelsBase:F.create(r),tVolumeData:F.create(n),uIsoValue:F.create(s),uSize:F.create(Math.pow(2,u)),uLevels:F.create(u),uCount:F.create(c),uInvert:F.create(d),uGridDim:F.create(i),uGridTexDim:F.create(a),uGridTransform:F.create(o),uScale:F.create(l),dPackedGroup:F.create(f)}),v=E({},$it),h=Ln("isosurface",ko,Uit,{drawBuffers:"required"}),m=Ji(e,"triangles",h,v,p);return Zi(m,p)}function Yit(e){var t=e.gl,r=e.state;r.disable(t.CULL_FACE),r.disable(t.BLEND),r.disable(t.DEPTH_TEST),r.disable(t.SCISSOR_TEST),r.depthMask(!1),r.colorMask(!0,!0,!0,!0),r.clearColor(0,0,0,0)}function Kit(e,t,r,n,i,a,o,s,u,l,c,d,f){var p=e.gl,v=e.resources,h=e.extensions,m=n.pyramidTex,g=n.height,y=n.levels,b=n.scale,S=n.count,x=m.getWidth();e.namedFramebuffers[Ef]||(e.namedFramebuffers[Ef]=v.framebuffer());var C=e.namedFramebuffers[Ef];Pr(p)?(c||(c=h.colorBufferHalfFloat&&h.textureHalfFloat?v.texture("image-float16","rgba","fp16","nearest"):v.texture("image-float32","rgba","float","nearest")),d||(d=v.texture("image-uint8","rgba","ubyte","nearest")),f||(f=h.colorBufferHalfFloat&&h.textureHalfFloat?v.texture("image-float16","rgba","fp16","nearest"):v.texture("image-float32","rgba","float","nearest"))):(c||(c=v.texture("image-float32","rgba","float","nearest")),d||(d=v.texture("image-float32","rgba","float","nearest")),f||(f=v.texture("image-float32","rgba","float","nearest"))),c.define(x,g),d.define(x,g),f.define(x,g),c.attachFramebuffer(C,0),d.attachFramebuffer(C,1),f.attachFramebuffer(C,2);var w=Wit(e,m,t,r,i,a,o,s,y,b,S,u,l);e.state.currentRenderItemId=-1;var A=e.extensions.drawBuffers;if(!A)throw new Error("need WebGL draw buffers");return C.bind(),A.drawBuffers([A.COLOR_ATTACHMENT0,A.COLOR_ATTACHMENT1,A.COLOR_ATTACHMENT2]),Yit(e),p.viewport(0,0,x,g),p.clear(p.COLOR_BUFFER_BIT),w.render(),p.finish(),{vertexTexture:c,groupTexture:d,normalTexture:f,vertexCount:S}}function RF(e,t,r,n,i,a,o,s,u,l,c,d){var f=qit(e,t,r,n,o,i),p=Fit(e,f,i,n),v=Kit(e,f,t,p,r,n,a,o,s,u,l,c,d);return v}var Tie={isoValue:Ct.IsoValueParam};function Qit(e){return e.extensions.colorBufferFloat&&e.extensions.textureFloat&&e.extensions.drawBuffers}var Zy=1;function kF(e,t){var r=e.grid.cells.space.dimensions,n=x2(r,Zy).powerOfTwoSize;return n<=t.maxTextureSize/2}function Zit(e,t,r,n){return r.tryUseGpu&&n&&Qit(n)&&kF(t,n)?rat(e):eat(e)}function UH(e,t){return Ct.Isosurface.Loci(e,t.isoValue)}function OF(e,t,r,n){var i=e.objectId,a=e.groupId;return n===i?Ct.Cell.Loci(t,Ie.ofSingleton(a)):Nr}function LF(e,t,r,n){return DF(e,t,r.isoValue,n)}function Jit(e,t,r,n,i){return ce(this,void 0,void 0,function(){var a,o,s;return de(this,function(u){switch(u.label){case 0:return e.runtime.update({message:"Marching cubes..."}),a=Ys(new Int32Array(t.grid.cells.data.length)),[4,iA({isoLevel:Ct.IsoValue.toAbsolute(n.isoValue,t.grid.stats).absoluteValue,scalarField:t.grid.cells,idField:Mr.create(t.grid.cells.space,Mr.Data1(a))},i).runAsChild(e.runtime)];case 1:return o=u.sent(),s=Ra.getGridToCartesianTransform(t.grid),Ft.transform(o,s),e.webgl&&!e.webgl.isWebGL2&&Ft.uniformTriangleGroup(o,!1),o.setBoundingSphere(Ct.getBoundingSphere(t)),[2,o]}})})}var FF=E(E(E(E({},Ft.Params),Hu.Params),Tie),{quality:E(E({},Ft.Params.quality),{isEssential:!1}),tryUseGpu:I.Boolean(!0)});function eat(e){return b2({defaultProps:I.getDefaultValues(FF),createGeometry:Jit,createLocationIterator:function(t){return Sn(t.grid.cells.data.length,1,1,function(){return ss})},getLoci:OF,eachLocation:LF,setUpdateState:function(t,r,n,i){Ct.IsoValue.areSame(n.isoValue,i.isoValue,r.grid.stats)||(t.createGeometry=!0)},geometryUtils:Ft.Utils,mustRecreate:function(t,r,n){return r.tryUseGpu&&!!n&&kF(t,n)}},e)}var _R;(function(e){var t="volume-isosurface-texture";e.descriptor=To({name:t});function r(n,i){var a=i.resources,o=Ra.getGridToCartesianTransform(n.grid),s=_.clone(n.grid.cells.space.dimensions),u=x2(s,Zy),l=u.width,c=u.height,d=u.powerOfTwoSize,f=_.create(l,c,0),p=He.create(l/d,c/d);if(d>i.maxTextureSize/2)throw new Error("volume too large for gpu isosurface extraction");if(!n._propertyData[t]){n._propertyData[t]=a.texture("image-uint8","alpha","ubyte","linear");var v=n._propertyData[t];v.define(d,d),v.load(Aie(n,"data",Zy),!0),n.customProperties.add(e.descriptor),n.customProperties.assets(e.descriptor,[{dispose:function(){return v.destroy()}}])}return s[0]+=Zy,s[1]+=Zy,{texture:n._propertyData[t],transform:o,gridDimension:s,gridTexDim:f,gridTexScale:p}}e.get=r})(_R||(_R={}));function tat(e,t,r,n,i){return ce(this,void 0,void 0,function(){var a,o,s,u,l,c,d,f,p,v,h,m,g,y,b;return de(this,function(S){if(!e.webgl)throw new Error("webgl context required to create volume isosurface texture-mesh");return a=t.grid.stats,o=a.max,s=a.min,u=o-s,l=Ct.IsoValue.toAbsolute(n.isoValue,t.grid.stats).absoluteValue,c=(l-s)/u,d=_R.get(t,e.webgl),f=d.texture,p=d.gridDimension,v=d.gridTexDim,h=d.gridTexScale,m=d.transform,g=i==null?void 0:i.doubleBuffer.get(),y=RF(e.webgl,f,p,v,h,m,c,l<0,!1,g==null?void 0:g.vertex,g==null?void 0:g.group,g==null?void 0:g.normal),b=Hu.create(y.vertexCount,1,y.vertexTexture,y.groupTexture,y.normalTexture,Ct.getBoundingSphere(t),i),[2,b]})})}function rat(e){return b2({defaultProps:I.getDefaultValues(FF),createGeometry:tat,createLocationIterator:function(t){return Sn(t.grid.cells.data.length,1,1,function(){return ss})},getLoci:OF,eachLocation:LF,setUpdateState:function(t,r,n,i){Ct.IsoValue.areSame(n.isoValue,i.isoValue,r.grid.stats)||(t.createGeometry=!0)},geometryUtils:Hu.Utils,mustRecreate:function(t,r,n){return!r.tryUseGpu||!n||!kF(t,n)},dispose:function(t){t.vertexTexture.ref.value.destroy(),t.groupTexture.ref.value.destroy(),t.normalTexture.ref.value.destroy(),t.doubleBuffer.destroy()}},e)}function nat(e,t,r,n,i){return ce(this,void 0,void 0,function(){var a,o,s;return de(this,function(u){switch(u.label){case 0:return e.runtime.update({message:"Marching cubes..."}),a=Ys(new Int32Array(t.grid.cells.data.length)),[4,MF({isoLevel:Ct.IsoValue.toAbsolute(n.isoValue,t.grid.stats).absoluteValue,scalarField:t.grid.cells,idField:Mr.create(t.grid.cells.space,Mr.Data1(a))},i).runAsChild(e.runtime)];case 1:return o=u.sent(),s=Ra.getGridToCartesianTransform(t.grid),wn.transform(o,s),o.setBoundingSphere(Ct.getBoundingSphere(t)),[2,o]}})})}var Iie=E(E(E({},wn.Params),Tie),{quality:E(E({},wn.Params.quality),{isEssential:!1}),sizeFactor:I.Numeric(3,{min:0,max:10,step:.1})});function iat(e){return b2({defaultProps:I.getDefaultValues(Iie),createGeometry:nat,createLocationIterator:function(t){return Sn(t.grid.cells.data.length,1,1,function(){return ss})},getLoci:OF,eachLocation:LF,setUpdateState:function(t,r,n,i){Ct.IsoValue.areSame(n.isoValue,i.isoValue,r.grid.stats)||(t.createGeometry=!0)},geometryUtils:wn.Utils},e)}var Mie={solid:function(e,t){return Mw("Isosurface mesh",e,t,Zit,UH)},wireframe:function(e,t){return Mw("Isosurface wireframe",e,t,iat,UH)}},Die=E(E(E({},FF),Iie),{visuals:I.MultiSelect(["solid"],I.objectToOptions(Mie))});function aat(e,t){var r=I.clone(Die);return r.isoValue=Ct.createIsoValueParam(Ct.IsoValue.relative(2),t.grid.stats),r}function oat(e,t){return or.createMulti("Isosurface",e,t,or.StateBuilder,Mie)}var sat={name:"isosurface",label:"Isosurface",description:"Displays a triangulated isosurface of volumetric data.",factory:oat,getParams:aat,defaultValues:I.getDefaultValues(Die),defaultColorTheme:{name:"uniform"},defaultSizeTheme:{name:"uniform"},isApplicable:function(e){return!Ct.isEmpty(e)}};function uat(e,t,r,n,i){return ce(this,void 0,void 0,function(){var a,o,s,u,l,c,d,f,p,v,h,m,g,y,b,S,x,C,w,A,M,D,k,R,O,H,B,j,Y,G,$,q,ee,fe,W,X,U,z;return de(this,function(J){for(a=n.dimension.name,o=n.isoValue,s=t.grid.cells,u=s.space,l=s.data,c=t.grid.stats,d=c.min,f=c.max,p=Ct.IsoValue.toAbsolute(o,t.grid.stats).absoluteValue,v=r.color.color(ss,!1),h=at.toRgbNormalized(v),m=h[0],g=h[1],y=h[2],b=NF(t.grid,n),S=b.width,x=b.height,C=b.x,w=b.y,A=b.z,M=b.x0,D=b.y0,k=b.z0,R=b.nx,O=b.ny,H=b.nz,B=new Float32Array(a==="x"?[C,0,0,C,w,0,C,0,A,C,w,A]:a==="y"?[0,w,0,C,w,0,0,w,A,C,w,A]:[0,0,A,0,w,A,C,0,A,C,w,A]),j=new Uint8Array(S*x*4),Y=lat(t.grid,n),G=0,$=D;$<O;++$)for(q=M;q<R;++q)for(ee=k;ee<H;++ee)fe=u.get(l,q,$,ee),W=(fe-d)/(f-d),j[G]=m*W*2*255,j[G+1]=g*W*2*255,j[G+2]=y*W*2*255,j[G+3]=fe>=p?255:0,G+=4;return X={width:S,height:x,array:j,flipY:!0},U={width:S,height:x,array:Y,flipY:!0},z=Ra.getGridToCartesianTransform(t.grid),yv(z,B,0,4),[2,nd.create(X,B,U,i)]})})}function NF(e,t){var r=t.dimension,n=r.name,i=r.params,a=e.cells.space,o,s,u,l,c,d=0,f=0,p=0,v=a.dimensions,h=v[0],m=v[1],g=v[2];return n==="x"?(u=i,l=m-1,c=g-1,o=g,s=m,d=u,h=d+1):n==="y"?(u=h-1,l=i,c=g-1,o=g,s=h,f=l,m=f+1):(u=h-1,l=m-1,c=i,o=h,s=m,p=c,g=p+1),{width:o,height:s,x:u,y:l,z:c,x0:d,y0:f,z0:p,nx:h,ny:m,nz:g}}function lat(e,t){for(var r=e.cells.space,n=NF(e,t),i=n.width,a=n.height,o=n.x0,s=n.y0,u=n.z0,l=n.nx,c=n.ny,d=n.nz,f=new Uint8Array(i*a*4),p=0,v=s;v<c;++v)for(var h=o;h<l;++h)for(var m=u;m<d;++m)u2(r.dataOffset(h,v,m),f,p),p+=4;return f}function cat(e,t){for(var r=e.cells.space,n=NF(e,t),i=n.width,a=n.height,o=n.x0,s=n.y0,u=n.z0,l=n.nx,c=n.ny,d=n.nz,f=new Uint32Array(i*a),p=0,v=s;v<c;++v)for(var h=o;h<l;++h)for(var m=u;m<d;++m)f[p]=r.dataOffset(h,v,m),p+=1;return f}function dat(e,t){var r=cat(e.grid,t);return Ct.Cell.Loci(e,Je.ofUnsortedArray(r))}function fat(e,t,r,n){var i=e.objectId,a=e.groupId;return n===i?Ct.Cell.Loci(t,Ie.ofSingleton(a)):Nr}function pat(e,t,r,n){return DF(e,t,void 0,n)}var BF=E(E({},nd.Params),{quality:E(E({},nd.Params.quality),{isEssential:!1}),dimension:I.MappedStatic("x",{x:I.Numeric(0,{min:0,max:0,step:1}),y:I.Numeric(0,{min:0,max:0,step:1}),z:I.Numeric(0,{min:0,max:0,step:1})},{isEssential:!0}),isoValue:Ct.IsoValueParam});function hat(e,t){var r=I.clone(BF),n=t.grid.cells.space.dimensions;return r.dimension=I.MappedStatic("x",{x:I.Numeric(0,{min:0,max:n[0]-1,step:1}),y:I.Numeric(0,{min:0,max:n[1]-1,step:1}),z:I.Numeric(0,{min:0,max:n[2]-1,step:1})},{isEssential:!0}),r.isoValue=Ct.createIsoValueParam(Ct.IsoValue.absolute(t.grid.stats.min),t.grid.stats),r}function vat(e){return b2({defaultProps:I.getDefaultValues(BF),createGeometry:uat,createLocationIterator:function(t){return Sn(t.grid.cells.data.length,1,1,function(){return ss})},getLoci:fat,eachLocation:pat,setUpdateState:function(t,r,n,i,a,o){t.createGeometry=n.dimension.name!==i.dimension.name||n.dimension.params!==i.dimension.params||!Ct.IsoValue.areSame(n.isoValue,i.isoValue,r.grid.stats)||!id.areEqual(a.color,o.color)},geometryUtils:E(E({},nd.Utils),{createRenderableState:function(t){var r=nd.Utils.createRenderableState(t);return jH(r,t),r},updateRenderableState:jH})},e)}function jH(e,t){nd.Utils.updateRenderableState(e,t),e.opaque=!1,e.writeDepth=!0}function mat(e,t){return Mw("Slice",e,t,vat,dat)}var gat={name:"slice",label:"Slice",description:"Slice of volume rendered as image with interpolation.",factory:mat,getParams:hat,defaultValues:I.getDefaultValues(BF),defaultColorTheme:{name:"uniform"},defaultSizeTheme:{name:"uniform"},isApplicable:function(e){return!Ct.isEmpty(e)}};function Rie(e,t){var r=Xt();return Xt.add(r,e),Xt.transform(r,r,t),r}function yat(e,t,r,n){var i=r.grid.cells.space.dimensions,a=x2(i),o=a.width,s=a.height;if(Math.max(o,s)>t.maxTextureSize/2)throw new Error("volume too large for direct-volume rendering");var u=Aie(r,"normals"),l=Ra.getGridToCartesianTransform(r.grid),c=Rie(i,l),d=n?n.gridTexture.ref.value:t.resources.texture("image-uint8","rgba","ubyte","linear");d.load(u);var f=kie(r.grid),p=f.unitToCartn,v=f.cellDim;return io.create(c,i,l,p,v,d,r.grid.stats,!1,n)}function kie(e){if(e.transform.kind==="matrix")return{unitToCartn:ue.mul(ue(),e.transform.matrix,ue.fromScaling(ue(),e.cells.space.dimensions)),cellDim:ue.getScaling(_(),e.transform.matrix)};var t=e.transform.fractionalBox,r=Xt.size(_(),t);return{unitToCartn:ue.mul3(ue(),e.transform.cell.fromFractional,ue.fromTranslation(ue(),t.min),ue.fromScaling(ue(),r)),cellDim:_.div(_(),e.transform.cell.size,e.cells.space.dimensions)}}function bat(e,t,r,n){var i=r.grid.cells.space.dimensions;if(Math.max.apply(Math,i)>t.max3dTextureSize/2)throw new Error("volume too large for direct-volume rendering");var a=_it(r),o=Ra.getGridToCartesianTransform(r.grid),s=Rie(i,o),u=n?n.gridTexture.ref.value:t.resources.texture("volume-uint8","rgba","ubyte","linear");u.load(a);var l=kie(r.grid),c=l.unitToCartn,d=l.cellDim;return io.create(s,i,o,c,d,u,r.grid.stats,!1,n)}function xat(e,t,r,n,i){return ce(this,void 0,void 0,function(){var a,o;return de(this,function(s){if(a=e.runtime,o=e.webgl,o===void 0)throw new Error("DirectVolumeVisual requires `webgl` in props");return[2,o.isWebGL2?bat(a,o,t,i):yat(a,o,t,i)]})})}function Sat(e,t){return t.renderMode.name==="isosurface"?Ct.Isosurface.Loci(e,t.renderMode.params.isoValue):Ct.Loci(e)}function Cat(e,t,r,n){var i=e.objectId,a=e.groupId;return n===i?Ct.Cell.Loci(t,Ie.ofSingleton(a)):Nr}function _at(e,t,r,n){var i=r.renderMode.name==="isosurface"?r.renderMode.params.isoValue:void 0;return DF(e,t,i,n)}var UF=E(E({},io.Params),{quality:E(E({},io.Params.quality),{isEssential:!1})});function wat(e,t){var r=I.clone(UF);return r.renderMode=io.createRenderModeParam(t.grid.stats),r}function Eat(e){return b2({defaultProps:I.getDefaultValues(UF),createGeometry:xat,createLocationIterator:function(t){return Sn(t.grid.cells.data.length,1,1,function(){return ss})},getLoci:Cat,eachLocation:_at,setUpdateState:function(t,r,n,i){},geometryUtils:io.Utils,dispose:function(t){t.gridTexture.ref.value.destroy()}},e)}function Aat(e,t){return Mw("Direct Volume",e,t,Eat,Sat)}var Pat={name:"direct-volume",label:"Direct Volume",description:"Direct rendering of volumetric data.",factory:Aat,getParams:wat,defaultValues:I.getDefaultValues(UF),defaultColorTheme:{name:"uniform"},defaultSizeTheme:{name:"uniform"},isApplicable:function(e){return!Ct.isEmpty(e)}},Ow=function(e){Fe(t,e);function t(){var r=e.call(this)||this;return ju(t.BuiltIn,function(n,i){if(n.name!==i)throw new Error("Fix BuiltInVolumeRepresentations to have matching names. "+n.name+" "+i);r.add(n)}),r}return t}(lre);(function(e){e.BuiltIn={isosurface:sat,slice:gat,"direct-volume":Pat}})(Ow||(Ow={}));function zH(e,t,r,n){e.push({source:t==="em"?{name:"em",params:{isoValue:Ct.IsoValue.absolute(n||0)}}:{name:"x-ray",params:{}},dataId:r})}var wR=Po.build({display:{name:"Volume Streaming"},from:ge.Molecule.Structure,params:function(e,t){var r=lit(e&&e.data),n=fit(r,e&&e.data);return{method:I.Select(r,[["em","EM"],["x-ray","X-Ray"]]),entries:I.ObjectList({id:I.Text(n[0]||"")},function(i){var a=i.id;return a},{defaultValue:n.map(function(i){return{id:i}})}),defaultView:I.Select(r==="em"?"cell":"selection-box",ja.ViewTypeOptions),options:I.Group({serverUrl:I.Text(t.config.get(Yr.VolumeStreaming.DefaultServer)||"https://ds.litemol.org"),behaviorRef:I.Text("",{isHidden:!0}),emContourProvider:I.Select("emdb",[["emdb","EMDB"],["pdbe","PDBe"]],{isHidden:!0}),channelParams:I.Value({},{isHidden:!0})})}},isApplicable:function(e,t,r){var n=r.config.get(Yr.VolumeStreaming.CanStream);return n?n(e.data,r):e.data.models.length===1&&$t.probablyHasDensityMap(e.data.models[0])}})(function(e,t){var r=e.ref,n=e.state,i=e.params;return $e.create("Volume Streaming",function(a){return ce(void 0,void 0,void 0,function(){var o,s,u,l,c,d,f,p,v,h,m,g,y,b,S,x,C;return de(this,function(w){switch(w.label){case 0:o=[],s=0,u=i.entries.length,w.label=1;case 1:return s<u?(l=i.entries[s].id.toLowerCase(),c=void 0,i.method!=="em"?[3,14]:l.toUpperCase().startsWith("EMD")?[3,11]:[4,a.update("Getting EMDB info...")]):[3,16];case 2:return w.sent(),[4,vit(t,a,l)];case 3:d=w.sent(),f=0,p=d.length,w.label=4;case 4:if(!(f<p))return[3,10];v=d[f],h=void 0,w.label=5;case 5:return w.trys.push([5,7,,8]),[4,FH(i.options.emContourProvider,t,a,v)];case 6:return h=w.sent(),[3,8];case 7:return m=w.sent(),console.info("Could not get map info for "+v+": "+m),[3,9];case 8:zH(o,i.method,v,h||0),w.label=9;case 9:return++f,[3,4];case 10:return[3,15];case 11:return w.trys.push([11,13,,14]),[4,FH(i.options.emContourProvider,t,a,l)];case 12:return c=w.sent(),[3,14];case 13:return g=w.sent(),console.info("Could not get map info for "+l+": "+g),[3,15];case 14:zH(o,i.method,l,c||0),w.label=15;case 15:return++s,[3,1];case 16:return y=n.build().to(r).applyOrUpdateTagged(ja.RootTag,Mat,{serverUrl:i.options.serverUrl,entries:o}),[4,y.commit()];case 17:return w.sent(),b=y.selector,b.isOk?(S=n.tree.children.get(b.ref),(S==null?void 0:S.size)>0?[4,t.managers.structure.hierarchy.remove(S==null?void 0:S.toArray())]:[3,19]):[2];case 18:w.sent(),w.label=19;case 19:return x=b.cell.obj,C=n.build().to(y.ref).apply(jF,I.getDefaultValues(ja.createParams({data:x.data,defaultView:i.defaultView,channelParams:i.options.channelParams})),{ref:i.options.behaviorRef?i.options.behaviorRef:void 0}),i.method==="em"?C.apply(eS,{channel:"em"},{state:{isGhost:!0},tags:"em"}):(C.apply(eS,{channel:"2fo-fc"},{state:{isGhost:!0},tags:"2fo-fc"}),C.apply(eS,{channel:"fo-fc(+ve)"},{state:{isGhost:!0},tags:"fo-fc(+ve)"}),C.apply(eS,{channel:"fo-fc(-ve)"},{state:{isGhost:!0},tags:"fo-fc(-ve)"})),[4,n.updateTree(C).runInContext(a)];case 20:return w.sent(),[2]}})})})}),Tat=Po.build({display:{name:"Boxify Volume Streaming",description:"Make the current box permanent."},from:ja,isApplicable:function(e){return e.data.params.entry.params.view.name==="selection-box"}})(function(e,t){var r=e.a,n=e.ref,i=e.state,a=r.data.params;if(a.entry.params.view.name==="selection-box"){var o=Xt.create(_.clone(a.entry.params.view.params.bottomLeft),_.clone(a.entry.params.view.params.topRight)),s=a.entry.params.view.params.radius;Xt.expand(o,o,_.create(s,s,s));var u=E(E({},a),{entry:{name:a.entry.name,params:E(E({},a.entry.params),{view:{name:"box",params:{bottomLeft:o.min,topRight:o.max}}})}});return i.updateTree(i.build().to(n).update(u))}}),Iat={dataId:I.Text(""),source:I.MappedStatic("x-ray",{em:I.Group({isoValue:Ct.createIsoValueParam(Ct.IsoValue.relative(1))}),"x-ray":I.Group({})})},Mat=kt.BuiltIn({name:"create-volume-streaming-info",display:{name:"Volume Streaming Info"},from:ge.Molecule.Structure,to:CR,params:function(e){return{serverUrl:I.Text("https://ds.litemol.org"),entries:I.ObjectList(Iat,function(t){var r=t.dataId;return r},{defaultValue:[{dataId:"",source:{name:"x-ray",params:{}}}]})}}})({apply:function(e,t){var r=e.a,n=e.params;return $e.create("",function(i){return ce(void 0,void 0,void 0,function(){var a,o,s,u,l,c,d,f;return de(this,function(p){switch(p.label){case 0:a=[],o=0,s=n.entries.length,p.label=1;case 1:return o<s?(u=n.entries[o],l=u.dataId,c=u.source.name==="em"?u.source.params.isoValue:Ct.IsoValue.relative(1),[4,i.update("Getting server header...")]):[3,5];case 2:return p.sent(),[4,t.fetch({url:eA(n.serverUrl,u.source.name+"/"+l.toLocaleLowerCase()),type:"json"}).runInContext(i)];case 3:d=p.sent(),a.push({dataId:l,kind:u.source.name,header:d,emDefaultContourLevel:c}),p.label=4;case 4:return++o,[3,1];case 5:return f={serverUrl:n.serverUrl,entries:a,structure:r.data},[2,new CR(f,{label:"Volume Server",description:""+a.map(function(v){return v.dataId}).join(", ")})]}})})})}}),jF=kt.BuiltIn({name:"create-volume-streaming-behavior",display:{name:"Volume Streaming Behavior"},from:CR,to:ja,params:function(e){return ja.createParams({data:e&&e.data})}})({canAutoUpdate:function(e){var t=e.oldParams,r=e.newParams;return t.entry.params.view===r.entry.params.view||r.entry.params.view.name==="selection-box"||r.entry.params.view.name==="off"},apply:function(e,t){var r=e.a,n=e.params;return $e.create("Volume streaming",function(i){return ce(void 0,void 0,void 0,function(){var a;return de(this,function(o){switch(o.label){case 0:return a=new ja.Behavior(t,r.data),[4,a.update(n)];case 1:return o.sent(),[2,new ja(a,{label:"Volume Streaming",description:a.getDescription()})]}})})})},update:function(e){var t=this;e.a;var r=e.b,n=e.oldParams,i=e.newParams;return $e.create("Update Volume Streaming",function(a){return ce(t,void 0,void 0,function(){var o,s;return de(this,function(u){switch(u.label){case 0:return n.entry.name!==i.entry.name&&"em"in i.entry.params.channels&&(o=r.data.infoMap.get(i.entry.name).emDefaultContourLevel,o&&(i.entry.params.channels.em.isoValue=o)),[4,r.data.update(i)];case 1:return s=u.sent()?ft.UpdateResult.Updated:ft.UpdateResult.Unchanged,r.description=r.data.getDescription(),[2,s]}})})})}}),eS=kt.BuiltIn({name:"create-volume-streaming-visual",display:{name:"Volume Streaming Visual"},from:ja,to:ge.Volume.Representation3D,params:{channel:I.Select("em",ja.ChannelTypeOptions,{isHidden:!0})}})({apply:function(e,t){var r=e.a,n=e.params,i=e.spine;return $e.create("Volume Representation",function(a){return ce(void 0,void 0,void 0,function(){var o,s,u,l,c,d,f,p,v;return de(this,function(h){switch(h.label){case 0:return o=r.data.channels[n.channel],o?(s=VH(r.data,n.channel),u=Ow.BuiltIn.isosurface,l=s.type.params||{},c=u.factory(E({webgl:(p=t.canvas3d)===null||p===void 0?void 0:p.webgl},t.representation.volume.themes),u.getParams),c.setTheme(yi.create(t.representation.volume.themes,{volume:o.data},s)),d=(v=i.getAncestorOfType(ge.Molecule.Structure))===null||v===void 0?void 0:v.data,f=(d==null?void 0:d.models.length)===0?void 0:Uh.get(d==null?void 0:d.models[0]),[4,c.createOrUpdate(l,o.data).runInContext(a)]):[2,On.Null];case 1:return h.sent(),f&&c.setState({transform:f}),[2,new ge.Volume.Representation3D({repr:c,sourceData:o.data},{label:Math.round(o.isoValue.relativeValue*100)/100+"  ["+n.channel+"]"})]}})})})},update:function(e,t){var r=e.a,n=e.b,i=e.newParams;return e.spine,$e.create("Volume Representation",function(a){return ce(void 0,void 0,void 0,function(){var o,s,u,l;return de(this,function(c){switch(c.label){case 0:return o=r.data.channels[i.channel],o?(s=n.data.repr.state.visible,u=VH(r.data,i.channel),l=E(E({},n.data.repr.props),u.type.params),n.data.repr.setTheme(yi.create(t.representation.volume.themes,{volume:o.data},u)),[4,n.data.repr.createOrUpdate(l,o.data).runInContext(a)]):[2,ft.UpdateResult.Unchanged];case 1:return c.sent(),n.data.repr.setState({visible:s}),n.data.sourceData=o.data,[2,ft.UpdateResult.Updated]}})})})}});function VH(e,t){var r=e.channels[t];return Bc.getDefaultParamsStatic(e.plugin,"isosurface",{isoValue:r.isoValue,alpha:r.opacity,visuals:r.wireframe?["wireframe"]:["solid"]},"uniform",{value:r.color})}var zF=function(e){Fe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r._getInfo=vp(function(n,i){return wv.infoFromAction(r.plugin,r.props.state,r.props.action,r.props.nodeRef)}),r.state={plugin:r.plugin,ref:r.props.nodeRef,version:r.props.state.transforms.get(r.props.nodeRef).version,error:void 0,isInitial:!0,params:r.getInfo().initialValues,busy:!1,isCollapsed:r.props.initiallyCollapsed},r}return t.prototype.applyAction=function(){return _t.State.ApplyAction(this.plugin,{state:this.props.state,action:this.props.action.create(this.state.params),ref:this.props.nodeRef})},t.prototype.getInfo=function(){return this._getInfo(this.props.nodeRef,this.props.state.transforms.get(this.props.nodeRef).version)},t.prototype.getTransformerId=function(){return this.props.state.transforms.get(this.props.nodeRef).transformer.id},t.prototype.getHeader=function(){return this.props.hideHeader?"none":this.props.action.definition.display},t.prototype.canApply=function(){return!this.state.error&&!this.state.busy},t.prototype.canAutoApply=function(){return!1},t.prototype.applyText=function(){return"Apply"},t.prototype.isUpdate=function(){return!1},t.prototype.getSourceAndTarget=function(){return{a:this.props.state.cells.get(this.props.nodeRef).obj}},t.getDerivedStateFromProps=function(r,n){var i=r.state.transforms.get(r.nodeRef).version;if(r.nodeRef===n.ref&&i===n.version)return null;var a=r.state.cells.get(r.nodeRef).obj,o=r.action.definition.params?I.getDefaultValues(r.action.definition.params(a,n.plugin)):{},s={plugin:n.plugin,ref:r.nodeRef,version:i,params:o,isInitial:!0,error:void 0};return s},t}(die),Dat=function(e){Fe(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.defaultState=function(){return{header:"Volume Streaming",isCollapsed:!1,isBusy:!1,isHidden:!0,brand:{accent:"cyan",svg:nZ}}},t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.managers.structure.hierarchy.behaviors.selection,function(){r.setState({isHidden:!r.canEnable(),description:Lb.getSelectedStructuresDescription(r.plugin)})}),this.subscribe(this.plugin.state.events.cell.stateUpdated,function(n){cr.hasTag(n.cell.transform,ja.RootTag)&&r.forceUpdate()}),this.subscribe(this.plugin.behaviors.state.isBusy,function(n){r.setState({isBusy:n})})},Object.defineProperty(t.prototype,"pivot",{get:function(){return this.plugin.managers.structure.hierarchy.selection.structures[0]},enumerable:!1,configurable:!0}),t.prototype.canEnable=function(){var r,n,i=this.plugin.managers.structure.hierarchy.selection;if(i.structures.length!==1)return!1;var a=this.pivot.cell;return a.obj?!!(!((n=(r=wR.definition).isApplicable)===null||n===void 0)&&n.call(r,a.obj,a.transform,this.plugin)):!1},t.prototype.renderEnable=function(){var r,n=this.pivot;if(!n.cell.parent)return null;var i=ir.findTagInSubtree(n.cell.parent.tree,this.pivot.cell.transform.ref,ja.RootTag),a=i&&n.cell.parent.cells.get(i),o=a&&a.status==="error"?{header:"Error enabling",icon:B9,title:a.errorText}:a&&((r=a.obj)===null||r===void 0?void 0:r.data.entries.length)===0?{header:"Error enabling",icon:B9,title:"No entry for streaming found"}:{header:"Enable",icon:m0,title:"Enable"};return P.jsx(zF,{state:n.cell.parent,action:wR,initiallyCollapsed:!0,nodeRef:n.cell.transform.ref,simpleApply:o},void 0)},t.prototype.renderParams=function(){var r,n,i,a,o,s=this.pivot;if(!s.cell.parent)return null;var u=((n=(r=s.volumeStreaming)===null||r===void 0?void 0:r.cell.transform.params)===null||n===void 0?void 0:n.entry.params.view.name)==="selection-box"&&((o=(a=(i=this.plugin.state.behaviors.cells.get(rA.id))===null||i===void 0?void 0:i.params)===null||a===void 0?void 0:a.values)===null||o===void 0?void 0:o.bindings);return P.jsxs(P.Fragment,{children:[P.jsx(cd,{state:s.cell.parent,transform:s.volumeStreaming.cell.transform,customHeader:"none",noMargin:!0},void 0),u&&P.jsx(Uu,E({header:"Controls Help"},{children:P.jsx(SR,{bindings:u},void 0)}),void 0)]},void 0)},t.prototype.renderControls=function(){var r=this.pivot;return r?r.volumeStreaming?this.renderParams():this.renderEnable():null},t}(g0),Rat=function(e){Fe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.item=function(n){var i,a=r.plugin.managers.volume.hierarchy.selection,o=((i=n.cell.obj)===null||i===void 0?void 0:i.label)||"Volume",s={kind:"item",label:(n.kind==="lazy-volume"?"Load ":"")+(o||n.kind),selected:a===n,value:n};return s},r.selectCurrent=function(n){if(r.toggleHierarchy(),!!n){var i=n.value;i.kind==="volume"?r.plugin.managers.volume.hierarchy.setCurrent(i):r.lazyLoad(i.cell)}},r.selectAdd=function(n){n&&(r.setState({show:void 0}),n.value())},r.toggleHierarchy=function(){return r.setState({show:r.state.show!=="hierarchy"?"hierarchy":void 0})},r.toggleAddRepr=function(){return r.setState({show:r.state.show!=="add-repr"?"add-repr":void 0})},r}return t.prototype.defaultState=function(){return{header:"Volume",isCollapsed:!1,isBusy:!1,isHidden:!0,brand:{accent:"purple",svg:nZ}}},t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.managers.volume.hierarchy.behaviors.selection,function(n){r.setState({isHidden:n.hierarchy.volumes.length===0&&n.hierarchy.lazyVolumes.length===0})}),this.subscribe(this.plugin.behaviors.state.isBusy,function(n){r.setState({isBusy:n})})},Object.defineProperty(t.prototype,"hierarchyItems",{get:function(){for(var r=this.plugin.managers.volume.hierarchy,n=r.current,i=[],a=0,o=n.volumes;a<o.length;a++){var s=o[a];i.push(this.item(s))}for(var u=0,l=n.lazyVolumes;u<l.length;u++){var s=l[u];i.push(this.item(s))}return i},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"addActions",{get:function(){var r=this.plugin.managers.volume.hierarchy,n=r.selection,i=Nt([],Iw.getRepresentationTypes(this.plugin,n).map(function(a){return er.Item(a[1],function(){return r.addRepresentation(n,a[0])})}));return i},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isEmpty",{get:function(){var r=this.plugin.managers.volume.hierarchy.current,n=r.volumes,i=r.lazyVolumes;return n.length===0&&i.length===0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"label",{get:function(){var r;if(this.state.loadingLabel)return"Loading "+this.state.loadingLabel+"...";var n=this.plugin.managers.volume.hierarchy.selection;return n?((r=n==null?void 0:n.cell.obj)===null||r===void 0?void 0:r.label)||"Volume":"Nothing Selected"},enumerable:!1,configurable:!0}),t.prototype.lazyLoad=function(r){return ce(this,void 0,void 0,function(){var n,i,a,o,s,u,l,c=this;return de(this,function(d){switch(d.label){case 0:n=r.obj.data,i=n.url,a=n.isBinary,o=n.format,s=n.entryId,u=n.isovalues,this.setState({isBusy:!0,loadingLabel:r.obj.label}),d.label=1;case 1:return d.trys.push([1,,3,4]),l=this.plugin,[4,l.dataTransaction(function(){return ce(c,void 0,void 0,function(){var f,p,v,h,m,g,y,b,S,x,C;return de(this,function(w){switch(w.label){case 0:return[4,l.builders.data.download({url:i,isBinary:a},{state:{isGhost:!0}})];case 1:return f=w.sent(),[4,l.dataFormats.get(o).parse(l,f,{entryId:s})];case 2:if(p=w.sent(),v=p.volume||p.volumes[0],!(v!=null&&v.isOk))throw new Error("Failed to parse any volume.");for(h=l.build(),m=0,g=u;m<g.length;m++)y=g[m],h.to((x=(b=p.volumes)===null||b===void 0?void 0:b[(S=y.volumeIndex)!==null&&S!==void 0?S:0])!==null&&x!==void 0?x:p.volume).apply(rt.Representation.VolumeRepresentation3D,Cg(this.plugin,v.data,{type:"isosurface",typeParams:{alpha:(C=y.alpha)!==null&&C!==void 0?C:1,isoValue:y.type==="absolute"?{kind:"absolute",absoluteValue:y.value}:{kind:"relative",relativeValue:y.value}},color:"uniform",colorParams:{value:y.color}}));return[4,h.commit()];case 3:return w.sent(),[4,l.build().delete(r).commit()];case 4:return w.sent(),[2]}})})})];case 2:return d.sent(),[3,4];case 3:return this.setState({isBusy:!1,loadingLabel:void 0}),[7];case 4:return[2]}})})},t.prototype.renderControls=function(){var r=this.state.isBusy||this.isEmpty,n=this.label,i=this.plugin.managers.volume.hierarchy.selection;return P.jsxs(P.Fragment,{children:[P.jsxs("div",E({className:"msp-flex-row",style:{marginTop:"1px"}},{children:[P.jsx(mr,E({noOverflow:!0,flex:!0,onClick:this.toggleHierarchy,disabled:r,title:n},{children:n}),void 0),!this.isEmpty&&i&&P.jsx(Ht,{svg:v0,onClick:this.toggleAddRepr,title:"Apply a structure presets to the current hierarchy.",toggleState:this.state.show==="add-repr",disabled:r},void 0)]}),void 0),this.state.show==="hierarchy"&&P.jsx(er,{items:this.hierarchyItems,onSelect:this.selectCurrent},void 0),this.state.show==="add-repr"&&P.jsx(er,{items:this.addActions,onSelect:this.selectAdd},void 0),i&&i.representations.length>0&&P.jsx("div",E({style:{marginTop:"6px"}},{children:i.representations.map(function(a){return P.jsx(kat,{representation:a},a.cell.transform.ref)})}),void 0)]},void 0)},t}(g0),kat=function(e){Fe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={action:void 0},r.remove=function(){return r.plugin.managers.volume.hierarchy.remove([r.props.representation],!0)},r.toggleVisible=function(n){n.preventDefault(),n.currentTarget.blur(),r.plugin.managers.volume.hierarchy.toggleVisibility([r.props.representation])},r.toggleUpdate=function(){return r.setState({action:r.state.action==="update"?void 0:"update"})},r.highlight=function(n){n.preventDefault(),r.props.representation.cell.parent&&_t.Interactivity.Object.Highlight(r.plugin,{state:r.props.representation.cell.parent,ref:r.props.representation.cell.transform.ref})},r.clearHighlight=function(n){n.preventDefault(),_t.Interactivity.ClearHighlights(r.plugin)},r.focus=function(){var n,i=r.props.representation,a=(n=r.props.representation.cell.obj)===null||n===void 0?void 0:n.data.repr.renderObjects;i.cell.state.isHidden&&r.plugin.managers.volume.hierarchy.toggleVisibility([r.props.representation],"show"),r.plugin.managers.camera.focusRenderObjects(a,{extraRadius:1})},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.state.events.cell.stateUpdated,function(n){dp.ObjectEvent.isCell(n,r.props.representation.cell)&&r.forceUpdate()})},t.prototype.render=function(){var r,n,i,a=this.props.representation.cell;return P.jsxs(P.Fragment,{children:[P.jsxs("div",E({className:"msp-flex-row"},{children:[P.jsxs(mr,E({noOverflow:!0,className:"msp-control-button-label",title:((r=a.obj)===null||r===void 0?void 0:r.label)+". Click to focus.",onClick:this.focus,onMouseEnter:this.highlight,onMouseLeave:this.clearHighlight,style:{textAlign:"left"}},{children:[(n=a.obj)===null||n===void 0?void 0:n.label,P.jsx("small",E({className:"msp-25-lower-contrast-text",style:{float:"right"}},{children:(i=a.obj)===null||i===void 0?void 0:i.description}),void 0)]}),void 0),P.jsx(Ht,{svg:a.state.isHidden?kv:Ov,toggleState:!1,onClick:this.toggleVisible,title:(a.state.isHidden?"Show":"Hide")+" component",small:!0,className:"msp-form-control",flex:!0},void 0),P.jsx(Ht,{svg:eu,onClick:this.remove,title:"Remove",small:!0},void 0),P.jsx(Ht,{svg:sv,onClick:this.toggleUpdate,title:"Actions",toggleState:this.state.action==="update"},void 0)]}),void 0),this.state.action==="update"&&!!a.parent&&P.jsx("div",E({style:{marginBottom:"6px"},className:"msp-accent-offset"},{children:P.jsx(cd,{state:a.parent,transform:a.transform,customHeader:"none",noMargin:!0},void 0)}),void 0)]},void 0)},t}(Qi),Lw;(function(e){function t(n){return{size:n,matrix:Ir.create(n,n),eigenValues:new Float64Array(n),D:new Float64Array(n),E:new Float64Array(n)}}e.createCache=t;function r(n){Oat(n.size,n.matrix.data,n.eigenValues,n.D,n.E)}e.compute=r})(Lw||(Lw={}));function Oat(e,t,r,n,i){for(var a=0;a<e;a++)i[a]=0;for(var o=e-1,a=0;a<e;a++)n[a]=t[a*e+o];Lat(t,n,i,e),Fat(t,n,i,e);for(var a=0;a<e;a++)r[a]=n[a]}function Lat(e,t,r,n){for(var i=n-1;i>0;i--){for(var a=0,o=0,s=0;s<i;s++)a=a+Math.abs(t[s]);if(a===0){r[i]=t[i-1];for(var u=0;u<i;u++)t[u]=e[u*n+i-1],e[u*n+i]=0,e[i*n+u]=0}else{for(var s=0;s<i;s++)t[s]/=a,o+=t[s]*t[s];var l=t[i-1],c=Math.sqrt(o);l>0&&(c=-c),r[i]=a*c,o=o-l*c,t[i-1]=l-c;for(var u=0;u<i;u++)r[u]=0;for(var u=0;u<i;u++){l=t[u],e[i*n+u]=l,c=r[u]+e[u*n+u]*l;for(var s=u+1;s<=i-1;s++)c+=e[u*n+s]*t[s],r[s]+=e[u*n+s]*l;r[u]=c}l=0;for(var u=0;u<i;u++)r[u]/=o,l+=r[u]*t[u];for(var d=l/(o+o),u=0;u<i;u++)r[u]-=d*t[u];for(var u=0;u<i;u++){l=t[u],c=r[u];for(var s=u;s<=i-1;s++)e[u*n+s]-=l*r[s]+c*t[s];t[u]=e[u*n+i-1],e[u*n+i]=0}}t[i]=o}for(var i=0;i<n-1;i++){e[i*n+n-1]=e[i*n+i],e[i*n+i]=1;var o=t[i+1];if(o!==0){for(var s=0;s<=i;s++)t[s]=e[(i+1)*n+s]/o;for(var u=0;u<=i;u++){for(var c=0,s=0;s<=i;s++)c+=e[(i+1)*n+s]*e[u*n+s];for(var s=0;s<=i;s++)e[u*n+s]-=c*t[s]}}for(var s=0;s<=i;s++)e[(i+1)*n+s]=0}for(var u=0;u<n;u++)t[u]=e[u*n+n-1],e[u*n+n-1]=0;e[n*n-1]=1,r[0]=0}function Fat(e,t,r,n){for(var i=1e3,a=1;a<n;a++)r[a-1]=r[a];r[n-1]=0;for(var o=0,s=0,u=Math.pow(2,-53),l=0;l<n;l++){s=Math.max(s,Math.abs(t[l])+Math.abs(r[l]));for(var c=l;c<n&&!(Math.abs(r[c])<=u*s);)c++;if(c>l){var d=0;do{d=d+1;var f=t[l],p=(t[l+1]-f)/(2*r[l]),v=HH(p,1);p<0&&(v=-v),t[l]=r[l]/(p+v),t[l+1]=r[l]*(p+v);for(var h=t[l+1],m=f-t[l],a=l+2;a<n;a++)t[a]-=m;o=o+m,p=t[c];for(var g=1,y=g,b=g,S=r[l+1],x=0,C=0,a=c-1;a>=l;a--){b=y,y=g,C=x,f=g*r[a],m=g*p,v=HH(p,r[a]),r[a+1]=x*v,x=r[a]/v,g=p/v,p=g*t[a]-x*f,t[a+1]=m+x*(g*f+x*t[a]);for(var w=0;w<n;w++)m=e[(a+1)*n+w],e[(a+1)*n+w]=x*e[a*n+w]+g*m,e[a*n+w]=g*e[a*n+w]-x*m}if(p=-x*C*b*S*r[l]/h,r[l]=x*p,t[l]=g*p,d>=i)throw"SVD: Not converging."}while(Math.abs(r[l])>u*s)}t[l]=t[l]+o,r[l]=0}for(var a=0;a<n-1;a++){for(var w=a,p=t[a],A=a+1;A<n;A++)t[A]<p&&(w=A,p=t[A]);if(w!==a){t[w]=t[a],t[a]=p;for(var A=0;A<n;A++)p=e[a*n+A],e[a*n+A]=e[w*n+A],e[w*n+A]=p}}}function HH(e,t){if(Math.abs(e)>Math.abs(t)){var r=t/e;return Math.abs(e)*Math.sqrt(1+r*r)}if(t!==0){var r=e/t;return Math.abs(t)*Math.sqrt(1+r*r)}return 0}var dd;(function(e){(function(r){function n(i){return{x:new Float64Array(i),y:new Float64Array(i),z:new Float64Array(i)}}r.empty=n})(e.Positions||(e.Positions={}));function t(r,n){return typeof n>"u"&&(n={bTransform:ue.zero(),rmsd:0}),jat(new Nat(r,n)),n}e.compute=t})(dd||(dd={}));var Nat=function(){function e(t,r){this.evdCache=Lw.createCache(4),this.translateB=ue.identity(),this.rotateB=ue.identity(),this.tempMatrix=ue.identity(),this.a=t.a,this.b=t.b,t.centerA?this.centerA=t.centerA:this.centerA=t.centerA=rd.fromArrays(t.a,Be()).center,t.centerB?this.centerB=t.centerB:this.centerB=t.centerB=rd.fromArrays(t.b,Be()).center,this.result=r}return e}();function Bat(e){var t=e.evdCache.matrix;Ir.makeZero(t);for(var r=e.a.x,n=e.a.y,i=e.a.z,a=e.b.x,o=e.b.y,s=e.b.z,u=e.centerA,l=e.centerB,c=0,d=0,f=e.a.x.length;d<f;d++){var p=r[d]-u[0],v=n[d]-u[1],h=i[d]-u[2],m=a[d]-l[0],g=o[d]-l[1],y=s[d]-l[2];c+=p*p+v*v+h*h+m*m+g*g+y*y,Ir.add(t,0,0,p*m+v*g+h*y),Ir.add(t,0,1,-(h*g)+v*y),Ir.add(t,0,2,h*m-p*y),Ir.add(t,0,3,-(v*m)+p*g),Ir.add(t,1,0,-(h*g)+v*y),Ir.add(t,1,1,p*m-v*g-h*y),Ir.add(t,1,2,v*m+p*g),Ir.add(t,1,3,h*m+p*y),Ir.add(t,2,0,h*m-p*y),Ir.add(t,2,1,v*m+p*g),Ir.add(t,2,2,-(p*m)+v*g-h*y),Ir.add(t,2,3,h*g+v*y),Ir.add(t,3,0,-(v*m)+p*g),Ir.add(t,3,1,h*m+p*y),Ir.add(t,3,2,h*g+v*y),Ir.add(t,3,3,-(p*m)-v*g+h*y)}return c}function Uat(e){var t=e.evdCache.matrix,r=Ir.get(t,1,3),n=Ir.get(t,2,3),i=Ir.get(t,3,3),a=Ir.get(t,0,3),o=2*n*n,s=2*i*i,u=2*r*r,l=2*r*n,c=2*a*i,d=2*r*i,f=2*a*n,p=2*n*i,v=2*a*r,h=e.translateB;ue.setValue(h,0,3,-e.centerB[0]),ue.setValue(h,1,3,-e.centerB[1]),ue.setValue(h,2,3,-e.centerB[2]),h=e.rotateB,ue.setValue(h,0,0,1-o-s),ue.setValue(h,0,1,l+c),ue.setValue(h,0,2,d-f),ue.setValue(h,1,0,l-c),ue.setValue(h,1,1,1-u-s),ue.setValue(h,1,2,p+v),ue.setValue(h,2,0,d+f),ue.setValue(h,2,1,p-v),ue.setValue(h,2,2,1-u-o),ue.setValue(h,3,3,1),ue.mul(e.tempMatrix,e.rotateB,e.translateB),h=e.translateB,ue.setValue(h,0,3,e.centerA[0]),ue.setValue(h,1,3,e.centerA[1]),ue.setValue(h,2,3,e.centerA[2]),ue.mul(e.result.bTransform,e.translateB,e.tempMatrix)}function jat(e){var t=Bat(e);Lw.compute(e.evdCache);var r=t-2*e.evdCache.eigenValues[3];r=r<0?0:Math.sqrt(r/e.a.x.length),Uat(e),e.result.rmsd=r}var zat="ACDEFGHIKLMNPQRSTVWY",Vat="ARNDCQEGHILKMFPSTWYVBZX",Hat=[[4,0,-2,-1,-2,0,-2,-1,-1,-1,-1,-2,-1,-1,-1,1,0,0,-3,-2],[0,9,-3,-4,-2,-3,-3,-1,-3,-1,-1,-3,-3,-3,-3,-1,-1,-1,-2,-2],[-2,-3,6,2,-3,-1,-1,-3,-1,-4,-3,1,-1,0,-2,0,-1,-3,-4,-3],[-1,-4,2,5,-3,-2,0,-3,1,-3,-2,0,-1,2,0,0,-1,-2,-3,-2],[-2,-2,-3,-3,6,-3,-1,0,-3,0,0,-3,-4,-3,-3,-2,-2,-1,1,3],[0,-3,-1,-2,-3,6,-2,-4,-2,-4,-3,0,-2,-2,-2,0,-2,-3,-2,-3],[-2,-3,-1,0,-1,-2,8,-3,-1,-3,-2,1,-2,0,0,-1,-2,-3,-2,2],[-1,-1,-3,-3,0,-4,-3,4,-3,2,1,-3,-3,-3,-3,-2,-1,3,-3,-1],[-1,-3,-1,1,-3,-2,-1,-3,5,-2,-1,0,-1,1,2,0,-1,-2,-3,-2],[-1,-1,-4,-3,0,-4,-3,2,-2,4,2,-3,-3,-2,-2,-2,-1,1,-2,-1],[-1,-1,-3,-2,0,-3,-2,1,-1,2,5,-2,-2,0,-1,-1,-1,1,-1,-1],[-2,-3,1,0,-3,0,1,-3,0,-3,-2,6,-2,0,0,1,0,-3,-4,-2],[-1,-3,-1,-1,-4,-2,-2,-3,-1,-3,-2,-2,7,-1,-2,-1,-1,-2,-4,-3],[-1,-3,0,2,-3,-2,0,-3,1,-2,0,0,-1,5,1,0,-1,-2,-2,-1],[-1,-3,-2,0,-3,-2,0,-3,2,-2,-1,0,-2,1,5,-1,-1,-3,-3,-2],[1,-1,0,0,-2,0,-1,-2,0,-2,-1,1,-1,0,-1,4,1,-2,-3,-2],[0,-1,-1,-1,-2,-2,-2,-1,-1,-1,-1,0,-1,-1,-1,1,5,0,-2,-2],[0,-1,-3,-2,-1,-3,-3,3,-2,1,1,-3,-2,-2,-3,-2,0,4,-3,-1],[-3,-2,-4,-3,1,-2,-2,-3,-3,-2,-1,-4,-4,-2,-3,-3,-2,-3,11,2],[-2,-2,-3,-2,3,-3,2,-1,-2,-1,-1,-2,-3,-1,-2,-2,-2,-1,2,7]],Gat=[[4,-1,-2,-2,0,-1,-1,0,-2,-1,-1,-1,-1,-2,-1,1,0,-3,-2,0,-2,-1,0],[-1,5,0,-2,-3,1,0,-2,0,-3,-2,2,-1,-3,-2,-1,-1,-3,-2,-3,-1,0,-1],[-2,0,6,1,-3,0,0,0,1,-3,-3,0,-2,-3,-2,1,0,-4,-2,-3,3,0,-1],[-2,-2,1,6,-3,0,2,-1,-1,-3,-4,-1,-3,-3,-1,0,-1,-4,-3,-3,4,1,-1],[0,-3,-3,-3,9,-3,-4,-3,-3,-1,-1,-3,-1,-2,-3,-1,-1,-2,-2,-1,-3,-3,-2],[-1,1,0,0,-3,5,2,-2,0,-3,-2,1,0,-3,-1,0,-1,-2,-1,-2,0,3,-1],[-1,0,0,2,-4,2,5,-2,0,-3,-3,1,-2,-3,-1,0,-1,-3,-2,-2,1,4,-1],[0,-2,0,-1,-3,-2,-2,6,-2,-4,-4,-2,-3,-3,-2,0,-2,-2,-3,-3,-1,-2,-1],[-2,0,1,-1,-3,0,0,-2,8,-3,-3,-1,-2,-1,-2,-1,-2,-2,2,-3,0,0,-1],[-1,-3,-3,-3,-1,-3,-3,-4,-3,4,2,-3,1,0,-3,-2,-1,-3,-1,3,-3,-3,-1],[-1,-2,-3,-4,-1,-2,-3,-4,-3,2,4,-2,2,0,-3,-2,-1,-2,-1,1,-4,-3,-1],[-1,2,0,-1,-3,1,1,-2,-1,-3,-2,5,-1,-3,-1,0,-1,-3,-2,-2,0,1,-1],[-1,-1,-2,-3,-1,0,-2,-3,-2,1,2,-1,5,0,-2,-1,-1,-1,-1,1,-3,-1,-1],[-2,-3,-3,-3,-2,-3,-3,-3,-1,0,0,-3,0,6,-4,-2,-2,1,3,-1,-3,-3,-1],[-1,-2,-2,-1,-3,-1,-1,-2,-2,-3,-3,-1,-2,-4,7,-1,-1,-4,-3,-2,-2,-1,-2],[1,-1,1,0,-1,0,0,0,-1,-2,-2,0,-1,-2,-1,4,1,-3,-2,-2,0,0,0],[0,-1,0,-1,-1,-1,-1,-2,-2,-1,-1,-1,-1,-2,-1,1,5,-2,-2,0,-1,-1,0],[-3,-3,-4,-4,-2,-2,-3,-2,-2,-3,-2,-3,-1,1,-4,-3,-2,11,2,-3,-4,-3,-2],[-2,-2,-2,-3,-2,-1,-2,-3,2,-1,-1,-2,-1,3,-3,-2,-2,2,7,-1,-3,-2,-1],[0,-3,-3,-3,-1,-2,-2,-3,-3,3,1,-2,1,-1,-2,-2,0,-3,-1,4,-3,-2,-1],[-2,-1,3,4,-3,0,1,-1,0,-3,-4,0,-3,-3,-2,0,-1,-4,-3,-3,4,1,-1],[-1,0,0,1,-3,3,4,-2,0,-3,-3,1,-1,-3,-1,0,-1,-3,-2,-2,1,4,-1],[0,-1,-1,-1,-2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-2,0,0,-2,-1,-1,-1,-1,-1]];function GH(e,t){var r,n=0,i={};return t.forEach(function(a){r=0;var o={};a.forEach(function(s){return o[e[r++]]=s}),i[e[n++]]=o}),i}var qat=function(){return{blosum62:GH(Vat,Gat),blosum62x:GH(zat,Hat)}}(),$at={gapPenalty:-11,gapExtensionPenalty:-1,substMatrix:"default"};function Wat(e,t,r){r===void 0&&(r={});var n=E(E({},$at),r),i=new Xat(e,t,n);return i.calculate(),i.trace()}var Xat=function(){function e(t,r,n){this.seqA=t,this.seqB=r,this.S=[],this.V=[],this.H=[],this.gapPenalty=n.gapPenalty,this.gapExtensionPenalty=n.gapExtensionPenalty,this.substMatrix=n.substMatrix==="default"?void 0:qat[n.substMatrix],this.n=this.seqA.length,this.m=this.seqB.length}return e.prototype.initMatrices=function(){for(var t=this,r=t.n,n=t.m,i=t.gapPenalty,a=t.S,o=t.V,s=t.H,u=0;u<=r;++u){a[u]=[],o[u]=[],s[u]=[];for(var l=0;l<=n;++l)a[u][l]=0,o[u][l]=0,s[u][l]=0}for(var u=0;u<=r;++u)a[u][0]=i,s[u][0]=-1/0;for(var l=0;l<=n;++l)a[0][l]=i,o[0][l]=-1/0;a[0][0]=0},e.prototype.makeScoreFn=function(){var t=this,r=t.seqA,n=t.seqB,i=t.substMatrix;return i?function(o,s){var u,l,c=r[o],d=n[s];return(l=(u=i[c])===null||u===void 0?void 0:u[d])!==null&&l!==void 0?l:-4}:function(o,s){var u=r[o],l=n[s];return u===l?5:-3}},e.prototype.calculate=function(){this.initMatrices();for(var t=this.makeScoreFn(),r=this,n=r.V,i=r.H,a=r.S,o=r.n,s=r.m,u=r.gapExtensionPenalty,l=r.gapPenalty,c,d,f,p,v,h=1;h<=o;++h){d=a[h-1],c=n[h-1],f=n[h],p=i[h],v=a[h];for(var m=1;m<=s;++m)f[m]=Math.max(d[m]+l,c[m]+u),p[m]=Math.max(v[m-1]+l,p[m-1]+u),v[m]=Math.max(d[m-1]+t(h-1,m-1),f[m],p[m])}},e.prototype.trace=function(){var t=this.makeScoreFn(),r=this,n=r.V,i=r.H,a=r.S,o=r.seqA,s=r.seqB,u=r.gapExtensionPenalty,l=r.gapPenalty,c=this.n,d=this.m,f,p,v="",h="";for(a[c][d]>=n[c][d]?(f="S",p=a[c][d]):n[c][d]>=i[c][d]?(f="V",p=n[c][d]):(f="H",p=i[c][d]);c>0&&d>0;)f==="S"?a[c][d]===a[c-1][d-1]+t(c-1,d-1)?(v=o[c-1]+v,h=s[d-1]+h,--c,--d,f="S"):a[c][d]===n[c][d]?f="V":a[c][d]===i[c][d]?f="H":(--c,--d):f==="V"?n[c][d]===n[c-1][d]+u?(v=o[c-1]+v,h="-"+h,--c,f="V"):n[c][d]===a[c-1][d]+l?(v=o[c-1]+v,h="-"+h,--c,f="S"):--c:f==="H"&&(i[c][d]===i[c][d-1]+u?(v="-"+v,h=s[d-1]+h,--d,f="H"):i[c][d]===a[c][d-1]+l?(v="-"+v,h=s[d-1]+h,--d,f="S"):--d);for(;c>0;)v=o[c-1]+v,h="-"+h,--c;for(;d>0;)v="-"+v,h=s[d-1]+h,--d;return{aliA:v,aliB:h,score:p}},e}(),ER;(function(e){function t(n){var i=new Map;if(je.isAtomic(n.unit))for(var a=n.unit.model.atomicHierarchy.residues.label_seq_id,o=n.unit.residueIndex,s=0,u=Le.size(n.indices);s<u;++s){var l=Le.getAt(n.indices,s),c=n.unit.elements[l],d=a.value(o[c]);i.has(d)?i.get(d).push(l):i.set(d,[l])}else if(je.isCoarse(n.unit))for(var f=(je.isSpheres(n.unit)?n.unit.model.coarseHierarchy.spheres:n.unit.model.coarseHierarchy.gaussians).seq_id_begin,s=0,u=Le.size(n.indices);s<u;++s){var l=Le.getAt(n.indices,s),c=n.unit.elements[l],d=f.value(c);i.set(d,[l])}return i}function r(n,i){i===void 0&&(i={});for(var a=qH(n.a.unit),o=qH(n.b.unit),s=t(n.a),u=t(n.b),l=[],c=[],d=Wat(a.code.toArray(),o.code.toArray(),i),f=d.aliA,p=d.aliB,v=d.score,h=0,m=0,g=0,y=f.length;g<y;++g){if(f[g]==="-"||p[g]==="-"){f[g]!=="-"&&(h+=1),p[g]!=="-"&&(m+=1);continue}var b=a.seqId.value(h),S=o.seqId.value(m);if(s.has(b)&&u.has(S))for(var x=s.get(b),C=u.get(S),w=0,A=Math.min(x.length,C.length);w<A;++w)l.push(x[w]),c.push(C[w]);h+=1,m+=1}var M=Le.intersect(Le.ofSortedArray(l),n.a.indices),D=Le.intersect(Le.ofSortedArray(c),n.b.indices);return{a:{unit:n.a.unit,indices:M},b:{unit:n.b.unit,indices:D},score:v}}e.compute=r})(ER||(ER={}));function Yat(e){switch(e.kind){case 0:return e.model.atomicHierarchy.index.getEntityFromChain(e.chainIndex[e.elements[0]]);case 1:return e.model.coarseHierarchy.spheres.entityKey[e.elements[0]];case 2:return e.model.coarseHierarchy.gaussians.entityKey[e.elements[0]]}}function qH(e){return e.model.sequence.byEntityKey[Yat(e)].sequence}function $H(e){var t=[];if(e.length<=0)return t;var r=Zat(e),n={a:P1(e[0],r),b:P1(e[1],r)};t[0]=dd.compute(n);for(var i=2;i<e.length;i++)n.b=P1(e[i],r),n.centerB=void 0,t.push(dd.compute(n));return t}var Kat=/(polypeptide|cyclic-pseudo-peptide)/i;function Qat(e){var t=[];if(e.length<=0)return t;for(var r=Re.getFirstLocation(e[0]),n=lt.entity.subtype(r),i=n.match(Kat)?"blosum62":"default",a=1;a<e.length;a++){var o=ER.compute({a:e[0].elements[0],b:e[a].elements[0]},{substMatrix:i}),s=o.a,u=o.b,l=o.score,c=Re(e[0].structure,[s]),d=Re(e[a].structure,[u]),f=Le.size(s.indices);t.push(E(E({},dd.compute({a:P1(c,f),b:P1(d,f)})),{alignmentScore:l}))}return t}function P1(e,t){for(var r=dd.Positions.empty(t),n=0,i=0,a=e.elements;i<a.length;i++){for(var o=a[i],s=o.unit,u=o.indices,l=s.elements,c=s.conformation,d=c.x,f=c.y,p=c.z,v=0,h=Le.size(u);v<h;v++){var m=l[Le.getAt(u,v)];if(r.x[n]=d(m),r.y[n]=f(m),r.z[n]=p(m),n++,n>=t)break}if(n>=t)break}return r}function Zat(e){if(e.length===0)return 0;for(var t=Re.size(e[0]),r=1;r<e.length;r++){var n=Re.size(e[r]);n<t&&(t=n)}return t}function Jat(e){for(var t=new Map,r=0;r<e.length;r++)rot(e[r],t,r);for(var n=Array.from(t.values()),i=tot(e.length,n),a=[],o=0,s=i;o<s.length;o++){var u=s[o],l=eot(n,u.i,u.j,u.count),c=l[0],d=l[1],f=dd.compute({a:c,b:d});a.push({transform:f,pivot:u.i,other:u.j})}return a}function eot(e,t,r,n){for(var i=dd.Positions.empty(n),a=dd.Positions.empty(n),o=0,s=0,u=e;s<u.length;s++){var l=u[s].pivots,c=l[t],d=l[r];if(!(!c||!d))for(var f=Math.min(c[2]-c[1],d[2]-d[1]),p=0;p<f;p++){var v=c[1]+p;i.x[o]=c[0].conformation.x(v),i.y[o]=c[0].conformation.y(v),i.z[o]=c[0].conformation.z(v),v=d[1]+p,a.x[o]=d[0].conformation.x(v),a.y[o]=d[0].conformation.y(v),a.z[o]=d[0].conformation.z(v),o++}}return[i,a]}function tot(e,t){for(var r=[],n=0;n<e;n++){r[n]=[];for(var i=0;i<e;i++)r[n][i]=0}for(var a=0,o=t;a<o.length;a++)for(var s=o[a].pivots,n=0;n<e;n++)if(s[n]){for(var u=s[n][2]-s[n][1],i=n+1;i<e;i++)if(s[i]){var l=s[i][2]-s[i][1];r[n][i]=r[n][i]+Math.min(u,l)}}for(var c=[],i=1;i<e;i++)c[i-1]={i:0,j:i,count:r[0][i]};return c}function rot(e,t,r){for(var n,i=0,a=e.units;i<a.length;i++){var o=a[i];if(o.kind===0){var s=o.elements,u=o.model,l=u.atomicHierarchy.residueAtomSegments.offsets,c=Ou.Provider.get(u).value;if(!c)return;for(var d=c.dbName,f=c.accession,p=c.num,v=nr.transientSegments(o.model.atomicHierarchy.chainAtomSegments,s),h=nr.transientSegments(o.model.atomicHierarchy.residueAtomSegments,s);v.hasNext;){var m=v.move();for(h.setSegment(m);h.hasNext;){var g=h.move(),y=s[g.start],b=l[y];if(d[b]){var S=d[b]+"-"+f[b]+"-"+p[b];if(!t.has(S))t.set(S,{key:S,pivots:(n={},n[r]=[o,y,s[g.end]],n)});else{var x=t.get(S);x.pivots[r]||(x.pivots[r]=[o,y,s[g.end]])}}}}}}}var not=function(e){Fe(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.defaultState=function(){return{isCollapsed:!1,header:"Superposition",brand:{accent:"gray",svg:p5e},isHidden:!0}},t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.managers.structure.hierarchy.behaviors.selection,function(n){r.setState({isHidden:n.structures.length<2})})},t.prototype.renderControls=function(){return P.jsx(P.Fragment,{children:P.jsx(aot,{},void 0)},void 0)},t}(g0),Oie={alignSequences:I.Boolean(!0,{isEssential:!0,description:"Perform a sequence alignment and use the aligned residue pairs to guide the 3D superposition."})},iot=I.getDefaultValues(Oie),WH="SuperpositionTransform",aot=function(e){Fe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isBusy:!1,canUseDb:!1,action:void 0,options:iot},r.superposeChains=function(){return ce(r,void 0,void 0,function(){var n,i,a,o,s,u,l,c,d,f,p,v,h,m=this;return de(this,function(g){switch(g.label){case 0:n=mi.trace.query,i=this.chainEntries,a=i.map(function(y,b){var S=Re.toStructure(y.loci),x=mt.toLociWithSourceUnits(n(new us(S)));return Re.remap(x,b===0?m.plugin.helpers.substructureParent.get(y.loci.structure.root).obj.data:x.structure.root)}),o=this.state.options.alignSequences?Qat(a):$H(a),s=i[0],u=1,l=a.length,g.label=1;case 1:return u<l?(c=i[u],d=o[u-1],f=d.bTransform,p=d.rmsd,[4,this.transform(c.cell,f)]):[3,4];case 2:g.sent(),v=Mf(s.label),h=Mf(c.label),this.plugin.log.info("Superposed ["+v+"] and ["+h+"] with RMSD "+p.toFixed(2)+"."),g.label=3;case 3:return++u,[3,1];case 4:return[2]}})})},r.superposeAtoms=function(){return ce(r,void 0,void 0,function(){var n,i,a,o,s,u,l,c,d,f,p,v,h,m=this;return de(this,function(g){switch(g.label){case 0:n=this.atomEntries,i=n.map(function(y,b){return Re.remap(y.loci,b===0?m.plugin.helpers.substructureParent.get(y.loci.structure.root).obj.data:y.loci.structure.root)}),a=$H(i),o=n[0],s=1,u=i.length,g.label=1;case 1:return s<u?(l=n[s],c=a[s-1],d=c.bTransform,f=c.rmsd,[4,this.transform(l.cell,d)]):[3,4];case 2:g.sent(),p=Mf(o.label),v=Mf(l.label),h=n[s].atoms.length,this.plugin.log.info("Superposed "+h+" "+(h===1?"atom":"atoms")+" of ["+p+"] and ["+v+"] with RMSD "+f.toFixed(2)+"."),g.label=3;case 3:return++s,[3,1];case 4:return[2]}})})},r.superposeDb=function(){return ce(r,void 0,void 0,function(){var n,i,a,o,s,u;return de(this,function(l){switch(l.label){case 0:n=this.plugin.managers.structure.hierarchy.behaviors.selection.value.structures,i=Jat(n.map(function(c){var d;return(d=c.cell.obj)===null||d===void 0?void 0:d.data})),a=0,o=0,s=i,l.label=1;case 1:return o<s.length?(u=s[o],[4,this.transform(n[u.other].cell,u.transform.bTransform)]):[3,4];case 2:l.sent(),a+=u.transform.rmsd,l.label=3;case 3:return o++,[3,1];case 4:return a/=i.length-1,this.plugin.log.info("Superposed "+n.length+" structures with avg. RMSD "+a.toFixed(2)+"."),[4,new Promise(function(c){return requestAnimationFrame(c)})];case 5:return l.sent(),_t.Camera.Reset(this.plugin),[2]}})})},r.toggleByChains=function(){return r.setState({action:r.state.action==="byChains"?void 0:"byChains"})},r.toggleByAtoms=function(){return r.setState({action:r.state.action==="byAtoms"?void 0:"byAtoms"})},r.toggleOptions=function(){return r.setState({action:r.state.action==="options"?void 0:"options"})},r.setOptions=function(n){r.setState({options:n})},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.selection.events.changed,function(){r.forceUpdate()}),this.subscribe(this.selection.events.additionsHistoryUpdated,function(){r.forceUpdate()}),this.subscribe(this.plugin.behaviors.state.isBusy,function(n){r.setState({isBusy:n})}),this.subscribe(this.plugin.managers.structure.hierarchy.behaviors.selection,function(n){r.setState({canUseDb:n.structures.every(function(i){var a;return!!(!((a=i.cell.obj)===null||a===void 0)&&a.data)&&i.cell.obj.data.models.some(function(o){return Ou.Provider.isApplicable(o)})})})})},Object.defineProperty(t.prototype,"selection",{get:function(){return this.plugin.managers.structure.selection},enumerable:!1,configurable:!0}),t.prototype.transform=function(r,n){return ce(this,void 0,void 0,function(){var i,a,o,s;return de(this,function(u){switch(u.label){case 0:return i=Fi.resolveAndCheck(this.plugin.state.data,r),i?(a=ir.findTagInSubtree(this.plugin.state.data.tree,i.transform.ref,WH),o={transform:{name:"matrix",params:{data:n,transpose:!1}}},s=a?this.plugin.state.data.build().to(a).update(o):this.plugin.state.data.build().to(r).insert(rt.Model.TransformStructureConformation,o,{tags:WH}),[4,this.plugin.runTask(this.plugin.state.data.updateTree(s))]):[2];case 1:return u.sent(),[2]}})})},t.prototype.highlight=function(r){this.plugin.managers.interactivity.lociHighlights.highlightOnly({loci:r},!1)},t.prototype.moveHistory=function(r,n){this.plugin.managers.structure.selection.modifyHistory(r,n,void 0,!0)},t.prototype.focusLoci=function(r){this.plugin.managers.camera.focusLoci(r)},t.prototype.lociEntry=function(r,n){var i=this;return P.jsx("div",E({className:"msp-flex-row"},{children:P.jsx(mr,E({noOverflow:!0,title:"Click to focus. Hover to highlight.",onClick:function(){return i.focusLoci(r.loci)},style:{width:"auto",textAlign:"left"},onMouseEnter:function(){return i.highlight(r.loci)},onMouseLeave:this.plugin.managers.interactivity.lociHighlights.clearHighlights},{children:P.jsx("span",{dangerouslySetInnerHTML:{__html:r.label}},void 0)}),void 0)}),n)},t.prototype.historyEntry=function(r,n){var i=this,a=this.plugin.managers.structure.selection.additionsHistory;return P.jsxs("div",E({className:"msp-flex-row"},{children:[P.jsxs(mr,E({noOverflow:!0,title:"Click to focus. Hover to highlight.",onClick:function(){return i.focusLoci(r.loci)},style:{width:"auto",textAlign:"left"},onMouseEnter:function(){return i.highlight(r.loci)},onMouseLeave:this.plugin.managers.interactivity.lociHighlights.clearHighlights},{children:[n,". ",P.jsx("span",{dangerouslySetInnerHTML:{__html:r.label}},void 0)]}),void 0),a.length>1&&P.jsx(Ht,{svg:lE,small:!0,className:"msp-form-control",onClick:function(){return i.moveHistory(r,"up")},flex:"20px",title:"Move up"},void 0),a.length>1&&P.jsx(Ht,{svg:uE,small:!0,className:"msp-form-control",onClick:function(){return i.moveHistory(r,"down")},flex:"20px",title:"Move down"},void 0),P.jsx(Ht,{svg:eu,small:!0,className:"msp-form-control",onClick:function(){return i.plugin.managers.structure.selection.modifyHistory(r,"remove")},flex:!0,title:"Remove"},void 0)]}),r.id)},t.prototype.atomsLociEntry=function(r,n){var i=this;return P.jsxs("div",{children:[P.jsx("div",E({className:"msp-control-group-header"},{children:P.jsx("div",E({className:"msp-no-overflow",title:r.label},{children:r.label}),void 0)}),void 0),P.jsx("div",E({className:"msp-control-offset"},{children:r.atoms.map(function(a,o){return i.historyEntry(a,o)})}),void 0)]},n)},Object.defineProperty(t.prototype,"chainEntries",{get:function(){var r=this,n=Ze.create(),i=[];return this.plugin.managers.structure.selection.entries.forEach(function(a,o){var s=a.selection,u=Fi.resolveAndCheck(r.plugin.state.data,o);if(!(!u||Re.isEmpty(s))){var l=Re.getFirstLocation(s,n);if(!(s.elements.length>1||lt.entity.type(l)!=="polymer")){var c=Lf.ofLoci(s),d=lw(c,{countsOnly:!0}),f=fu(l,{reverse:!0,granularity:"chain"}).split("|"),p=d+" | "+f[0]+" | "+f[f.length-1];i.push({loci:s,label:p,cell:u})}}}),i},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"atomEntries",{get:function(){for(var r=this,n=new Map,i=this.plugin.managers.structure.selection.additionsHistory,a=0,o=i.length;a<o;++a){var s=i[a];if(Re.size(s.loci)===1){var u=s.loci.structure;n.has(u)?n.get(u).push(s):n.set(u,[s])}}var l=[];return n.forEach(function(c,d){for(var f=r.plugin.helpers.substructureParent.get(d),p=[],v=0,h=c.length;v<h;++v)p.push(c[v].loci.elements[0]);var m=Re(c[0].loci.structure,p),g=m.structure.label.split(" | ")[0];l.push({loci:m,label:g,cell:f,atoms:c})}),l},enumerable:!1,configurable:!0}),t.prototype.addByChains=function(){var r=this,n=this.chainEntries;return P.jsxs(P.Fragment,{children:[n.length>0&&P.jsx("div",E({className:"msp-control-offset"},{children:n.map(function(i,a){return r.lociEntry(i,a)})}),void 0),n.length<2&&P.jsx("div",E({className:"msp-control-offset msp-help-text"},{children:P.jsxs("div",E({className:"msp-help-description"},{children:[P.jsx(sn,{svg:Fl,inline:!0},void 0),"Add 2 or more selections (toggle ",P.jsx(Tw,{inline:!0},void 0)," mode) from separate structures. Selections must be limited to single polymer chains or residues therein."]}),void 0)}),void 0),n.length>1&&P.jsx(mr,E({title:"Superpose structures by selected chains.",className:"msp-btn-commit msp-btn-commit-on",onClick:this.superposeChains,style:{marginTop:"1px"}},{children:"Superpose"}),void 0)]},void 0)},t.prototype.addByAtoms=function(){var r=this,n=this.atomEntries;return P.jsxs(P.Fragment,{children:[n.length>0&&P.jsx("div",E({className:"msp-control-offset"},{children:n.map(function(i,a){return r.atomsLociEntry(i,a)})}),void 0),n.length<2&&P.jsx("div",E({className:"msp-control-offset msp-help-text"},{children:P.jsxs("div",E({className:"msp-help-description"},{children:[P.jsx(sn,{svg:Fl,inline:!0},void 0),"Add 1 or more selections (toggle ",P.jsx(Tw,{inline:!0},void 0)," mode) from separate structures. Selections must be limited to single atoms."]}),void 0)}),void 0),n.length>1&&P.jsx(mr,E({title:"Superpose structures by selected atoms.",className:"msp-btn-commit msp-btn-commit-on",onClick:this.superposeAtoms,style:{marginTop:"1px"}},{children:"Superpose"}),void 0)]},void 0)},t.prototype.superposeByDbMapping=function(){return P.jsx(P.Fragment,{children:P.jsx(mr,E({icon:U9,title:"Superpose structures using database mapping.",className:"msp-btn msp-btn-block",onClick:this.superposeDb,style:{marginTop:"1px"},disabled:this.state.isBusy},{children:"DB"}),void 0)},void 0)},t.prototype.render=function(){return P.jsxs(P.Fragment,{children:[P.jsxs("div",E({className:"msp-flex-row"},{children:[P.jsx(Ri,{icon:U9,label:"Chains",toggle:this.toggleByChains,isSelected:this.state.action==="byChains",disabled:this.state.isBusy},void 0),P.jsx(Ri,{icon:f5e,label:"Atoms",toggle:this.toggleByAtoms,isSelected:this.state.action==="byAtoms",disabled:this.state.isBusy},void 0),this.state.canUseDb&&this.superposeByDbMapping(),P.jsx(Ri,{icon:uv,label:"",title:"Options",toggle:this.toggleOptions,isSelected:this.state.action==="options",disabled:this.state.isBusy,style:{flex:"0 0 40px",padding:0}},void 0)]}),void 0),this.state.action==="byChains"&&this.addByChains(),this.state.action==="byAtoms"&&this.addByAtoms(),this.state.action==="options"&&P.jsx("div",E({className:"msp-control-offset"},{children:P.jsx(Un,{params:Oie,values:this.state.options,onChangeValues:this.setOptions,isDisabled:this.state.isBusy},void 0)}),void 0)]},void 0)},t}(Qi),oot=function(e){Fe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={show:!1,label:""},r.update=function(){var n=r.plugin.state.data,i=n.selectQ(function(p){return p.ofTransformer(rt.Model.ModelFromTrajectory)});if(i.length===0){r.setState({show:!1});return}for(var a="",o=0,s=new Set,u=0,l=i;u<l.length;u++){var c=l[u];if(c.sourceRef){var d=n.cells.get(c.sourceRef).obj;if(d&&d.data.frameCount>1){if(s.has(c.sourceRef)){r.setState({show:!1});return}if(s.add(c.sourceRef),o++,!a){var f=c.transform.params.modelIndex;a="Model "+(f+1)+" / "+d.data.frameCount}}}}o>1&&(a=""),r.setState({show:o>0,label:a})},r.reset=function(){return _t.State.ApplyAction(r.plugin,{state:r.plugin.state.data,action:aC.create({action:"reset"})})},r.prev=function(){return _t.State.ApplyAction(r.plugin,{state:r.plugin.state.data,action:aC.create({action:"advance",by:-1})})},r.next=function(){return _t.State.ApplyAction(r.plugin,{state:r.plugin.state.data,action:aC.create({action:"advance",by:1})})},r}return t.prototype.componentDidMount=function(){this.subscribe(this.plugin.state.data.events.changed,this.update),this.subscribe(this.plugin.behaviors.state.isAnimating,this.update)},t.prototype.render=function(){var r=this.plugin.behaviors.state.isAnimating.value;return!this.state.show||r&&!this.state.label?null:P.jsxs("div",E({className:"msp-traj-controls"},{children:[!r&&P.jsx(Ht,{svg:e5e,title:"First Model",onClick:this.reset,disabled:r},void 0),!r&&P.jsx(Ht,{svg:oZ,title:"Previous Model",onClick:this.prev,disabled:r},void 0),!r&&P.jsx(Ht,{svg:sZ,title:"Next Model",onClick:this.next,disabled:r},void 0),!!this.state.label&&P.jsx("span",{children:this.state.label},void 0)]}),void 0)},t}(gr),sot=function(e){Fe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isBusy:!1,show:!0},r.keyUp=function(n){if(!(!n.ctrlKey||r.state.isBusy||n.target!==document.body)){var i=r.plugin.managers.snapshot;if(n.keyCode===37||n.key==="ArrowLeft")i.state.isPlaying&&i.stop(),r.prev();else if(n.keyCode===38||n.key==="ArrowUp"){if(i.state.isPlaying&&i.stop(),i.state.entries.size===0)return;var a=i.state.entries.get(0);r.update(a.snapshot.id)}else if(n.keyCode===39||n.key==="ArrowRight")i.state.isPlaying&&i.stop(),r.next();else if(n.keyCode===40||n.key==="ArrowDown"){if(i.state.isPlaying&&i.stop(),i.state.entries.size===0)return;var o=i.state.entries.get(i.state.entries.size-1);r.update(o.snapshot.id)}}},r.change=function(n){n.target.value!=="none"&&r.update(n.target.value)},r.prev=function(){var n=r.plugin.managers.snapshot,i=n.getNextId(n.state.current,-1);i&&r.update(i)},r.next=function(){var n=r.plugin.managers.snapshot,i=n.getNextId(n.state.current,1);i&&r.update(i)},r.togglePlay=function(){r.plugin.managers.snapshot.togglePlay()},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.managers.snapshot.events.changed,function(){return r.forceUpdate()}),this.subscribe(this.plugin.behaviors.state.isBusy,function(n){return r.setState({isBusy:n})}),this.subscribe(this.plugin.behaviors.state.isAnimating,function(n){return r.setState({isBusy:n})}),window.addEventListener("keyup",this.keyUp,!1)},t.prototype.componentWillUnmount=function(){e.prototype.componentWillUnmount.call(this),window.removeEventListener("keyup",this.keyUp,!1)},t.prototype.update=function(r){return ce(this,void 0,void 0,function(){return de(this,function(n){switch(n.label){case 0:return this.setState({isBusy:!0}),[4,_t.State.Snapshots.Apply(this.plugin,{id:r})];case 1:return n.sent(),this.setState({isBusy:!1}),[2]}})})},t.prototype.render=function(){var r=this.plugin.managers.snapshot,n=r.state.entries.size;if(n<2||!this.state.show)return null;var i=r.state.current,a=r.state.isPlaying;return P.jsxs("div",E({className:"msp-state-snapshot-viewport-controls"},{children:[P.jsxs("select",E({className:"msp-form-control",value:i||"none",onChange:this.change,disabled:this.state.isBusy||a},{children:[!i&&P.jsx("option",{value:"none"},"none"),r.state.entries.valueSeq().map(function(o,s){return P.jsxs("option",E({value:o.snapshot.id},{children:["["+(s+1)+"/"+n+"]"," ",o.name||new Date(o.timestamp).toLocaleString()]}),o.snapshot.id)})]}),void 0),P.jsx(Ht,{svg:a?cZ:uZ,title:a?"Pause":"Cycle States",onClick:this.togglePlay,disabled:a?!1:this.state.isBusy},void 0),!a&&P.jsxs(P.Fragment,{children:[P.jsx(Ht,{svg:oZ,title:"Previous State",onClick:this.prev,disabled:this.state.isBusy||a},void 0),P.jsx(Ht,{svg:sZ,title:"Next State",onClick:this.next,disabled:this.state.isBusy||a},void 0)]},void 0)]}),void 0)},t}(gr),uot=function(e){Fe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isEmpty:!0,isExpanded:!1,isBusy:!1,isAnimating:!1,isPlaying:!1},r.toggleExpanded=function(){return r.setState({isExpanded:!r.state.isExpanded})},r.stop=function(){r.plugin.managers.animation.stop(),r.plugin.managers.snapshot.stop()},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.managers.snapshot.events.changed,function(){r.plugin.managers.snapshot.state.isPlaying?r.setState({isPlaying:!0,isExpanded:!1}):r.setState({isPlaying:!1})}),this.subscribe(this.plugin.behaviors.state.isBusy,function(n){n?r.setState({isBusy:!0,isExpanded:!1,isEmpty:r.plugin.state.data.tree.transforms.size<2}):r.setState({isBusy:!1,isEmpty:r.plugin.state.data.tree.transforms.size<2})}),this.subscribe(this.plugin.behaviors.state.isAnimating,function(n){n?r.setState({isAnimating:!0,isExpanded:!1}):r.setState({isAnimating:!1})})},t.prototype.render=function(){var r=this.plugin.managers.snapshot.state.isPlaying;if(r||this.state.isEmpty||this.plugin.managers.animation.isEmpty||!this.plugin.config.get(Yr.Viewport.ShowAnimation))return null;var n=this.state.isAnimating;return P.jsxs("div",E({className:"msp-animation-viewport-controls"},{children:[P.jsxs("div",{children:[P.jsx("div",{className:"msp-semi-transparent-background"},void 0),P.jsx(Ht,{svg:n||r?cZ:n5e,transparent:!0,title:n?"Stop":"Select Animation",onClick:n||r?this.stop:this.toggleExpanded,toggleState:this.state.isExpanded,disabled:n||r?!1:this.state.isBusy||this.state.isPlaying||this.state.isEmpty},void 0)]},void 0),this.state.isExpanded&&!this.state.isBusy&&P.jsx("div",E({className:"msp-animation-viewport-controls-select"},{children:P.jsx(Zrt,{onStart:this.toggleExpanded},void 0)}),void 0)]}),void 0)},t}(gr),lot=function(e){Fe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.onMouseMove=function(n){n.buttons===0&&n.stopPropagation()},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.behaviors.interaction.selectionMode,function(){return r.forceUpdate()})},t.prototype.render=function(){return this.plugin.selectionMode?P.jsx("div",E({className:"msp-selection-viewport-controls",onMouseMove:this.onMouseMove},{children:P.jsx(Unt,{},void 0)}),void 0):null},t}(gr),cot=function(e){Fe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={labels:[]},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.behaviors.labels.highlight,function(n){return r.setState({labels:n.labels})})},t.prototype.render=function(){return this.state.labels.length===0?null:P.jsx("div",E({className:"msp-highlight-info"},{children:this.state.labels.map(function(r,n){return P.jsx("div",{dangerouslySetInnerHTML:{__html:r}},""+n)})}),void 0)},t}(gr),dot=function(e){Fe(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.state.behaviors.events.changed,function(){return r.forceUpdate()})},t.prototype.render=function(){var r=this,n=[];return this.plugin.customStructureControls.forEach(function(i,a){n.push(P.jsx(i,{initiallyCollapsed:r.props.initiallyCollapsed},a))}),n.length>0?P.jsx(P.Fragment,{children:n},void 0):null},t}(gr),fot=function(e){Fe(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.render=function(){return P.jsxs(P.Fragment,{children:[P.jsxs("div",E({className:"msp-section-header"},{children:[P.jsx(sn,{svg:oMe},void 0),"Structure Tools"]}),void 0),P.jsx(Qnt,{},void 0),P.jsx(Gnt,{},void 0),P.jsx(not,{},void 0),P.jsx(Snt,{},void 0),this.plugin.config.get(Yr.VolumeStreaming.Enabled)&&P.jsx(Dat,{},void 0),P.jsx(Rat,{},void 0),P.jsx(dot,{},void 0)]},void 0)},t}(gr),pot=function(e){Fe(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return Object.defineProperty(t.prototype,"current",{get:function(){return this.props.state.behaviors.currentObject.value},enumerable:!1,configurable:!0}),t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.state.events.object.updated,function(n){var i=n.ref,a=n.state,o=r.current;o.ref!==i||o.state!==a||r.forceUpdate()}),this.subscribe(this.plugin.state.data.actions.events.added,function(){return r.forceUpdate()}),this.subscribe(this.plugin.state.data.actions.events.removed,function(){return r.forceUpdate()})},t.prototype.render=function(){var r=this,n=this.props,i=n.state,a=n.nodeRef,o=i.cells.get(a),s=i.actions.fromCell(o,this.plugin);if(s.length===0)return null;var u=o.transform.transformer.definition,l=o.obj?o.obj.label:u.display&&u.display.name||u.name;return P.jsxs("div",E({className:"msp-state-actions"},{children:[!this.props.hideHeader&&P.jsxs("div",E({className:"msp-section-header"},{children:[P.jsx(sn,{svg:SMe},void 0)," ","Actions ("+l+")"]}),void 0),s.map(function(c,d){return P.jsx(zF,{state:i,action:c,nodeRef:a,initiallyCollapsed:d===0?!r.props.alwaysExpandFirst&&r.props.initiallyCollapsed:r.props.initiallyCollapsed},""+c.id)})]}),void 0)},t}(gr),Fw=function(e){Fe(t,e);function t(r){var n=e.call(this)||this;return n.plugin=r,n.data=dp.create(new ge.Root({}),{runTask:n.plugin.runTask,globalContext:n.plugin,historyCapacity:n.plugin.config.get(Yr.State.HistoryCapacity)}),n.behaviors=dp.create(new Or.Root({}),{runTask:n.plugin.runTask,globalContext:n.plugin,rootState:{isLocked:!0}}),n.events={cell:{stateUpdated:gc(n.data.events.cell.stateUpdated,n.behaviors.events.cell.stateUpdated),created:gc(n.data.events.cell.created,n.behaviors.events.cell.created),removed:gc(n.data.events.cell.removed,n.behaviors.events.cell.removed)},object:{created:gc(n.data.events.object.created,n.behaviors.events.object.created),removed:gc(n.data.events.object.removed,n.behaviors.events.object.removed),updated:gc(n.data.events.object.updated,n.behaviors.events.object.updated)}},n.snapshotParams=n.ev.behavior(t.DefaultSnapshotParams),n.setSnapshotParams=function(i){n.snapshotParams.next(E(E({},t.DefaultSnapshotParams),i))},n}return Object.defineProperty(t.prototype,"animation",{get:function(){return this.plugin.managers.animation},enumerable:!1,configurable:!0}),t.prototype.getSnapshot=function(r){var n,i,a=E(E({},this.snapshotParams.value),r);return{id:mn.create22(),data:a.data?this.data.getSnapshot():void 0,behaviour:a.behavior?this.behaviors.getSnapshot():void 0,animation:a.animation?this.animation.getSnapshot():void 0,startAnimation:a.startAnimation?!!a.startAnimation:void 0,camera:a.camera?{current:this.plugin.canvas3d.camera.getSnapshot(),transitionStyle:a.cameraTransition.name,transitionDurationInMs:((n=a==null?void 0:a.cameraTransition)===null||n===void 0?void 0:n.name)==="animate"?a.cameraTransition.params.durationInMs:void 0}:void 0,canvas3d:a.canvas3d?{props:(i=this.plugin.canvas3d)===null||i===void 0?void 0:i.props}:void 0,interactivity:a.interactivity?{props:this.plugin.managers.interactivity.props}:void 0,structureFocus:this.plugin.managers.structure.focus.getSnapshot(),durationInMs:a==null?void 0:a.durationInMs}},t.prototype.setSnapshot=function(r){var n;return ce(this,void 0,void 0,function(){var i;return de(this,function(a){switch(a.label){case 0:return[4,this.animation.stop()];case 1:return a.sent(),r.behaviour?[4,this.plugin.runTask(this.behaviors.setSnapshot(r.behaviour))]:[3,3];case 2:a.sent(),a.label=3;case 3:return r.data?[4,this.plugin.runTask(this.data.setSnapshot(r.data))]:[3,5];case 4:a.sent(),a.label=5;case 5:return!((n=r.canvas3d)===null||n===void 0)&&n.props?(i=I.normalizeParams(Ts,r.canvas3d.props,"children"),[4,_t.Canvas3D.SetSettings(this.plugin,{settings:i})]):[3,7];case 6:a.sent(),a.label=7;case 7:return r.interactivity&&r.interactivity.props&&this.plugin.managers.interactivity.setProps(r.interactivity.props),r.structureFocus&&this.plugin.managers.structure.focus.setSnapshot(r.structureFocus),r.animation&&this.animation.setSnapshot(r.animation),r.camera&&_t.Camera.Reset(this.plugin,{snapshot:r.camera.current,durationMs:r.camera.transitionStyle==="animate"?r.camera.transitionDurationInMs:void 0}),r.startAnimation&&this.animation.start(),[2]}})})},t.prototype.updateTransform=function(r,n,i,a){var o=r.build().to(n).update(i);return _t.State.Update(this.plugin,{state:r,tree:o,options:{canUndo:a}})},t.prototype.updateBehavior=function(r,n){var i=this.behaviors.build();if(this.behaviors.tree.transforms.has(r.id))i.to(r.id).update(n);else{var a=r.createDefaultParams(void 0,this.plugin);i.to(Or.getCategoryId(r)).apply(r,cv(a,n),{ref:r.id})}return this.plugin.runTask(this.behaviors.updateTree(i))},t.prototype.dispose=function(){this.behaviors.cells.forEach(function(r){Or.Behavior.is(r.obj)&&r.obj.data.unregister()}),e.prototype.dispose.call(this),this.data.dispose(),this.behaviors.dispose(),this.animation.dispose()},t}(v2);(function(e){e.SnapshotParams={durationInMs:I.Numeric(1500,{min:100,max:15e3,step:100},{label:"Duration in ms"}),data:I.Boolean(!0),behavior:I.Boolean(!1),animation:I.Boolean(!0),startAnimation:I.Boolean(!1),canvas3d:I.Boolean(!0),interactivity:I.Boolean(!0),camera:I.Boolean(!0),cameraTransition:I.MappedStatic("animate",{animate:I.Group({durationInMs:I.Numeric(250,{min:100,max:5e3,step:500},{label:"Duration in ms"})}),instant:I.Group({})},{options:[["animate","Animate"],["instant","Instant"]]})},e.DefaultSnapshotParams=I.getDefaultValues(e.SnapshotParams)})(Fw||(Fw={}));var hot=function(e){Fe(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.render=function(){var r;return P.jsxs("div",{children:[P.jsx(Tc,{icon:lZ,title:"Plugin State"},void 0),P.jsx("div",E({style:{marginBottom:"10px"}},{children:P.jsx(Uu,E({header:"Save Options",initiallyExpanded:!1},{children:P.jsx(Fie,{},void 0)}),void 0)}),void 0),P.jsx(vot,{},void 0),P.jsx(mot,{},void 0),P.jsx(Tc,{title:"Save as File",accent:"blue"},void 0),P.jsx(Lie,{},void 0),((r=this.plugin.spec.components)===null||r===void 0?void 0:r.remoteState)!=="none"&&P.jsx(Nie,{},void 0)]},void 0)},t}(gr),Lie=function(e){Fe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.downloadToFileJson=function(){var n,i;(i=(n=r.props).onAction)===null||i===void 0||i.call(n),_t.State.Snapshots.DownloadToFile(r.plugin,{type:"json"})},r.downloadToFileZip=function(){var n,i;(i=(n=r.props).onAction)===null||i===void 0||i.call(n),_t.State.Snapshots.DownloadToFile(r.plugin,{type:"zip"})},r.open=function(n){var i,a;if(!n.target.files||!n.target.files[0]){r.plugin.log.error("No state file selected");return}(a=(i=r.props).onAction)===null||a===void 0||a.call(i),_t.State.Snapshots.OpenFile(r.plugin,{file:n.target.files[0]})},r}return t.prototype.render=function(){return P.jsxs(P.Fragment,{children:[P.jsxs("div",E({className:"msp-flex-row"},{children:[P.jsx(mr,E({icon:k5,onClick:this.downloadToFileJson,title:"Save the state description. Input data are loaded using the provided sources. Does not work if local files are used as input."},{children:"State"}),void 0),P.jsx(mr,E({icon:k5,onClick:this.downloadToFileZip,title:"Save the state including the input data."},{children:"Session"}),void 0),P.jsxs("div",E({className:"msp-btn msp-btn-block msp-btn-action msp-loader-msp-btn-file"},{children:[P.jsx(sn,{svg:qMe,inline:!0},void 0)," Open ",P.jsx("input",{onChange:this.open,type:"file",multiple:!1,accept:".molx,.molj"},void 0)]}),void 0)]}),void 0),P.jsxs("div",E({className:"msp-help-text",style:{padding:"10px"}},{children:[P.jsx(sn,{svg:c5e},void 0)," This is an experimental feature and stored states/sessions might not be openable in a future version."]}),void 0)]},void 0)},t}(gr),Fie=function(e){Fe(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.state.snapshotParams,function(){return r.forceUpdate()})},t.prototype.render=function(){return P.jsx(Un,{params:Fw.SnapshotParams,values:this.plugin.state.snapshotParams.value,onChangeValues:this.plugin.state.setSnapshotParams},void 0)},t}(gr),vot=function(e){Fe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={params:I.getDefaultValues(t.Params)},r.add=function(){_t.State.Snapshots.Add(r.plugin,{name:r.state.params.name,description:r.state.params.description})},r.updateParams=function(n){return r.setState({params:n})},r.clear=function(){_t.State.Snapshots.Clear(r.plugin,{})},r}return t.prototype.shouldComponentUpdate=function(r,n){return!Hg(this.props,r)||!Hg(this.state,n)},t.prototype.render=function(){return P.jsxs("div",{children:[P.jsx(Un,{params:t.Params,values:this.state.params,onEnter:this.add,onChangeValues:this.updateParams},void 0),P.jsxs("div",E({className:"msp-flex-row"},{children:[P.jsx(Ht,{onClick:this.clear,svg:eu,title:"Remove All"},void 0),P.jsx(mr,E({onClick:this.add,icon:v0,style:{textAlign:"right"},commit:!0},{children:"Add"}),void 0)]}),void 0)]},void 0)},t.Params={name:I.Text(),description:I.Text()},t}(gr),mot=function(e){Fe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.apply=function(n){var i=n.currentTarget.getAttribute("data-id");i&&_t.State.Snapshots.Apply(r.plugin,{id:i})},r.remove=function(n){var i=n.currentTarget.getAttribute("data-id");i&&_t.State.Snapshots.Remove(r.plugin,{id:i})},r.moveUp=function(n){var i=n.currentTarget.getAttribute("data-id");i&&_t.State.Snapshots.Move(r.plugin,{id:i,dir:-1})},r.moveDown=function(n){var i=n.currentTarget.getAttribute("data-id");i&&_t.State.Snapshots.Move(r.plugin,{id:i,dir:1})},r.replace=function(n){var i=n.currentTarget.getAttribute("data-id");i&&_t.State.Snapshots.Replace(r.plugin,{id:i})},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.managers.snapshot.events.changed,function(){return r.forceUpdate()})},t.prototype.render=function(){var r=this,n=this.plugin.managers.snapshot.state.current;return P.jsx("ul",E({style:{listStyle:"none",marginTop:"10px"},className:"msp-state-list"},{children:this.plugin.managers.snapshot.state.entries.map(function(i){return P.jsxs("li",E({className:"msp-flex-row"},{children:[P.jsxs(mr,E({"data-id":i.snapshot.id,onClick:r.apply,className:"msp-no-overflow"},{children:[P.jsx("span",E({style:{fontWeight:i.snapshot.id===n?"bold":void 0}},{children:i.name||new Date(i.timestamp).toLocaleString()}),void 0)," ",P.jsx("small",{children:(i.snapshot.durationInMs?$S(i.snapshot.durationInMs,!1)+(i.description?", ":""):"")+(i.description?i.description:"")},void 0)]}),void 0),P.jsx(Ht,{svg:lE,"data-id":i.snapshot.id,title:"Move Up",onClick:r.moveUp,flex:"20px"},void 0),P.jsx(Ht,{svg:uE,"data-id":i.snapshot.id,title:"Move Down",onClick:r.moveDown,flex:"20px"},void 0),P.jsx(Ht,{svg:a5e,"data-id":i.snapshot.id,title:"Replace",onClick:r.replace,flex:"20px"},void 0),P.jsx(Ht,{svg:eu,"data-id":i.snapshot.id,title:"Remove",onClick:r.remove,flex:"20px"},void 0)]}),i.snapshot.id)})}),void 0)},t}(gr),Nie=function(e){Fe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.Params={name:I.Text(),options:I.Group({description:I.Text(),playOnLoad:I.Boolean(!1),serverUrl:I.Text(r.plugin.config.get(Yr.State.CurrentServer))})},r.state={params:I.getDefaultValues(r.Params),entries:si.OrderedMap(),isBusy:!1},r.ListOnlyParams={options:I.Group({serverUrl:I.Text(r.plugin.config.get(Yr.State.CurrentServer))},{isFlat:!0})},r._mounted=!1,r.refresh=function(){return ce(r,void 0,void 0,function(){var n,i,a,o,s,u;return de(this,function(l){switch(l.label){case 0:return l.trys.push([0,2,,3]),this.setState({isBusy:!0}),this.plugin.config.set(Yr.State.CurrentServer,this.state.params.options.serverUrl),[4,this.plugin.runTask(this.plugin.fetch({url:this.serverUrl("list"),type:"json"}))];case 1:for(n=l.sent()||[],n.sort(function(c,d){return c.isSticky===d.isSticky?c.timestamp-d.timestamp:c.isSticky?-1:1}),i=si.OrderedMap().asMutable(),a=0,o=n;a<o.length;a++)s=o[a],i.set(s.id,E(E({},s),{url:this.serverUrl("get/"+s.id),removeUrl:this.serverUrl("remove/"+s.id)}));return this._mounted&&this.setState({entries:i.asImmutable(),isBusy:!1}),[3,3];case 2:return u=l.sent(),this.plugin.log.error("Fetching Remote Snapshots: "+u),this._mounted&&this.setState({entries:si.OrderedMap(),isBusy:!1}),[3,3];case 3:return[2]}})})},r.upload=function(){return ce(r,void 0,void 0,function(){return de(this,function(n){switch(n.label){case 0:return this.setState({isBusy:!0}),this.plugin.config.set(Yr.State.CurrentServer,this.state.params.options.serverUrl),[4,_t.State.Snapshots.Upload(this.plugin,{name:this.state.params.name,description:this.state.params.options.description,playOnLoad:this.state.params.options.playOnLoad,serverUrl:this.state.params.options.serverUrl})];case 1:return n.sent(),this.plugin.log.message("Snapshot uploaded."),this._mounted&&(this.setState({isBusy:!1}),this.refresh()),[2]}})})},r.fetch=function(n){return ce(r,void 0,void 0,function(){var i,a;return de(this,function(o){switch(o.label){case 0:if(i=n.currentTarget.getAttribute("data-id"),!i)return[2];if(a=this.state.entries.get(i),!a)return[2];this.setState({isBusy:!0}),o.label=1;case 1:return o.trys.push([1,,3,4]),[4,_t.State.Snapshots.Fetch(this.plugin,{url:a.url})];case 2:return o.sent(),[3,4];case 3:return this._mounted&&this.setState({isBusy:!1}),[7];case 4:return[2]}})})},r.remove=function(n){return ce(r,void 0,void 0,function(){var i,a;return de(this,function(o){switch(o.label){case 0:if(i=n.currentTarget.getAttribute("data-id"),!i)return[2];if(a=this.state.entries.get(i),!a)return[2];this.setState({entries:this.state.entries.remove(i)}),o.label=1;case 1:return o.trys.push([1,3,,4]),[4,fetch(a.removeUrl)];case 2:return o.sent(),[3,4];case 3:return o.sent(),[3,4];case 4:return[2]}})})},r}return t.prototype.componentDidMount=function(){this.refresh(),this._mounted=!0},t.prototype.componentWillUnmount=function(){this._mounted=!1},t.prototype.serverUrl=function(r){return r?eA(this.state.params.options.serverUrl,r):this.state.params.options.serverUrl},t.prototype.render=function(){var r=this;return P.jsxs(P.Fragment,{children:[P.jsx(Tc,{title:"Remote States",accent:"blue"},void 0),!this.props.listOnly&&P.jsxs(P.Fragment,{children:[P.jsx(Un,{params:this.Params,values:this.state.params,onEnter:this.upload,onChange:function(n){var i;r.setState({params:E(E({},r.state.params),(i={},i[n.name]=n.value,i))})},isDisabled:this.state.isBusy},void 0),P.jsxs("div",E({className:"msp-flex-row"},{children:[P.jsx(Ht,{onClick:this.refresh,disabled:this.state.isBusy,svg:L5},void 0),P.jsx(mr,E({icon:bMe,onClick:this.upload,disabled:this.state.isBusy,commit:!0},{children:"Upload"}),void 0)]}),void 0)]},void 0),P.jsx(got,{entries:this.state.entries,isBusy:this.state.isBusy,serverUrl:this.state.params.options.serverUrl,fetch:this.fetch,remove:this.props.listOnly?void 0:this.remove},void 0),this.props.listOnly&&P.jsxs("div",E({style:{marginTop:"10px"}},{children:[P.jsx(Un,{params:this.ListOnlyParams,values:this.state.params,onEnter:this.upload,onChange:function(n){var i;r.setState({params:E(E({},r.state.params),(i={},i[n.name]=n.value,i))})},isDisabled:this.state.isBusy},void 0),P.jsx("div",E({className:"msp-flex-row"},{children:P.jsx(mr,E({onClick:this.refresh,disabled:this.state.isBusy,icon:L5},{children:"Refresh"}),void 0)}),void 0)]}),void 0)]},void 0)},t}(gr),got=function(e){Fe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.open=function(n){return ce(r,void 0,void 0,function(){var i,a,o,s;return de(this,function(u){return i=n.currentTarget.getAttribute("data-id"),i?(a=this.props.entries.get(i),a?(n.preventDefault(),o=""+window.location,s=o.indexOf("?"),s>0&&(o=o.substr(0,s)),window.open(o+"?snapshot-url="+encodeURIComponent(a.url),"_blank"),[2]):[2]):[2]})})},r}return t.prototype.render=function(){var r=this;return P.jsx("ul",E({style:{listStyle:"none",marginTop:"10px"},className:"msp-state-list"},{children:this.props.entries.valueSeq().map(function(n){return P.jsxs("li",E({className:"msp-flex-row"},{children:[P.jsxs(mr,E({"data-id":n.id,onClick:r.props.fetch,disabled:r.props.isBusy,onContextMenu:r.open,title:"Click to download, right-click to open in a new tab."},{children:[n.name||new Date(n.timestamp).toLocaleString()," ",P.jsx("small",{children:n.description},void 0)]}),void 0),!n.isSticky&&r.props.remove&&P.jsx(Ht,{svg:eu,"data-id":n.id,title:"Remove",onClick:r.props.remove,disabled:r.props.isBusy,small:!0},void 0)]}),n.id)})}),void 0)},t}(Qi);function Bie(e,t){return t===void 0&&(t=ODe),function(r){return r.lift(new yot(e,t))}}var yot=function(){function e(t,r){this.dueTime=t,this.scheduler=r}return e.prototype.call=function(t,r){return r.subscribe(new bot(t,this.dueTime,this.scheduler))},e}(),bot=function(e){Sa(t,e);function t(r,n,i){var a=e.call(this,r)||this;return a.dueTime=n,a.scheduler=i,a.debouncedSubscription=null,a.lastValue=null,a.hasValue=!1,a}return t.prototype._next=function(r){this.clearDebounce(),this.lastValue=r,this.hasValue=!0,this.add(this.debouncedSubscription=this.scheduler.schedule(xot,this.dueTime,this))},t.prototype._complete=function(){this.debouncedNext(),this.destination.complete()},t.prototype.debouncedNext=function(){if(this.clearDebounce(),this.hasValue){var r=this.lastValue;this.lastValue=null,this.hasValue=!1,this.destination.next(r)}},t.prototype.clearDebounce=function(){var r=this.debouncedSubscription;r!==null&&(this.remove(r),r.unsubscribe(),this.debouncedSubscription=null)},t}(Vs);function xot(e){e.debouncedNext()}function Sot(e){return function(t){return e===0?IDe():t.lift(new Cot(e))}}var Cot=function(){function e(t){if(this.total=t,this.total<0)throw new FDe}return e.prototype.call=function(t,r){return r.subscribe(new _ot(t,this.total))},e}(),_ot=function(e){Sa(t,e);function t(r,n){var i=e.call(this,r)||this;return i.total=n,i.count=0,i}return t.prototype._next=function(r){var n=this.total,i=++this.count;i<=n&&(this.destination.next(r),i===n&&(this.destination.complete(),this.unsubscribe()))},t}(Vs),Uie=function(e){Fe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={showActions:!0},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.state.events.cell.created,function(n){n.cell.transform.parent===cr.RootRef&&r.forceUpdate()}),this.subscribe(this.plugin.state.events.cell.removed,function(n){n.parent===cr.RootRef&&r.forceUpdate()})},t.getDerivedStateFromProps=function(r,n){var i=r.state.tree.root.ref,a=r.state.tree.children.get(i),o=a.size===0;return n.showActions===o?null:{showActions:o}},t.prototype.render=function(){var r=this.props.state.tree.root.ref;return this.state.showActions?P.jsxs("div",E({style:{margin:"10px",cursor:"default"}},{children:[P.jsx("p",{children:"Nothing to see here yet."},void 0),P.jsxs("p",{children:["Structures and Volumes can be loaded from the ",P.jsx(sn,{svg:O5},void 0)," tab."]},void 0)]}),void 0):P.jsx(wot,{cell:this.props.state.cells.get(r),depth:0},void 0)},t}(gr),wot=function(e){Fe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isCollapsed:!!r.props.cell.state.isCollapsed,isNull:t.isNull(r.props.cell),showLabel:t.showLabel(r.props.cell)},r}return t.prototype.is=function(r){return r.ref===this.ref&&r.state===this.props.cell.parent},Object.defineProperty(t.prototype,"ref",{get:function(){return this.props.cell.transform.ref},enumerable:!1,configurable:!0}),t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.state.events.cell.stateUpdated,function(n){r.props.cell===n.cell&&r.is(n)&&n.state.cells.has(r.ref)&&(r.state.isCollapsed!==!!n.cell.state.isCollapsed||r.state.isNull!==t.isNull(n.cell)||r.state.showLabel!==t.showLabel(n.cell))&&r.forceUpdate()}),this.subscribe(this.plugin.state.events.cell.created,function(n){r.props.cell.parent===n.state&&r.ref===n.cell.transform.parent&&r.forceUpdate()}),this.subscribe(this.plugin.state.events.cell.removed,function(n){r.props.cell.parent===n.state&&r.ref===n.parent&&r.forceUpdate()})},t.getDerivedStateFromProps=function(r,n){var i=t.isNull(r.cell),a=t.showLabel(r.cell);return!!r.cell.state.isCollapsed===n.isCollapsed&&n.isNull===i&&n.showLabel===a?null:{isCollapsed:!!r.cell.state.isCollapsed,isNull:i,showLabel:a}},t.hasDecorator=function(r){var n,i=r.parent.tree.children.get(r.transform.ref);return i.size!==1?!1:!!(!((n=r.parent)===null||n===void 0)&&n.tree.transforms.get(i.first()).transformer.definition.isDecorator)},t.isNull=function(r){return!r||!r.parent||r.obj===On.Null||!r.parent.tree.transforms.has(r.transform.ref)},t.showLabel=function(r){return r.transform.ref!==cr.RootRef&&(r.status!=="ok"||!r.state.isGhost&&!t.hasDecorator(r))},t.prototype.render=function(){var r=this;if(this.state.isNull)return null;var n=this.props.cell,i=n.parent.tree.children.get(this.ref);if(!this.state.showLabel)return i.size===0?null:P.jsx(P.Fragment,{children:i.map(function(o){return P.jsx(t,{cell:n.parent.cells.get(o),depth:r.props.depth},o)})},void 0);var a=this.props.depth+1;return P.jsxs(P.Fragment,{children:[P.jsx(Eot,{cell:n,depth:this.props.depth},void 0),i.size===0?void 0:P.jsx("div",E({style:{display:this.state.isCollapsed?"none":"block"}},{children:i.map(function(o){return P.jsx(t,{cell:n.parent.cells.get(o),depth:a},o)})}),void 0)]},void 0)},t}(gr),Eot=function(e){Fe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isCurrent:r.props.cell.parent.current===r.ref,isCollapsed:!!r.props.cell.state.isCollapsed,action:void 0,currentAction:void 0},r.setCurrent=function(n){n==null||n.preventDefault(),n==null||n.currentTarget.blur(),_t.State.SetCurrentObject(r.plugin,{state:r.props.cell.parent,ref:r.ref})},r.setCurrentRoot=function(n){n==null||n.preventDefault(),n==null||n.currentTarget.blur(),_t.State.SetCurrentObject(r.plugin,{state:r.props.cell.parent,ref:cr.RootRef})},r.remove=function(n){n==null||n.preventDefault(),_t.State.RemoveObject(r.plugin,{state:r.props.cell.parent,ref:r.ref,removeParentGhosts:!0})},r.toggleVisible=function(n){n.preventDefault(),_t.State.ToggleVisibility(r.plugin,{state:r.props.cell.parent,ref:r.ref}),n.currentTarget.blur()},r.toggleExpanded=function(n){n.preventDefault(),_t.State.ToggleExpanded(r.plugin,{state:r.props.cell.parent,ref:r.ref}),n.currentTarget.blur()},r.highlight=function(n){n.preventDefault(),_t.Interactivity.Object.Highlight(r.plugin,{state:r.props.cell.parent,ref:r.ref}),n.currentTarget.blur()},r.clearHighlight=function(n){n.preventDefault(),_t.Interactivity.ClearHighlights(r.plugin),n.currentTarget.blur()},r.hideApply=function(){r.setCurrentRoot()},r.selectAction=function(n){n&&(n==null?void 0:n.value)()},r}return t.prototype.is=function(r){return r.ref===this.ref&&r.state===this.props.cell.parent},Object.defineProperty(t.prototype,"ref",{get:function(){return this.props.cell.transform.ref},enumerable:!1,configurable:!0}),t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.state.events.cell.stateUpdated.pipe(gE(function(n){return r.is(n)}),Bie(33)),function(n){r.forceUpdate()}),this.subscribe(this.props.cell.parent.behaviors.currentObject,function(n){if(!r.is(n)){r.state.isCurrent&&n.state.transforms.has(r.ref)&&r._setCurrent(r.props.cell.parent.current===r.ref,r.state.isCollapsed);return}n.state.transforms.has(r.ref)&&r._setCurrent(r.props.cell.parent.current===r.ref,!!r.props.cell.state.isCollapsed)})},t.prototype._setCurrent=function(r,n){r?this.setState({isCurrent:r,action:"options",currentAction:void 0,isCollapsed:n}):this.setState({isCurrent:r,action:void 0,currentAction:void 0,isCollapsed:n})},t.getDerivedStateFromProps=function(r,n){var i=r.cell.parent.current===r.cell.transform.ref,a=!!r.cell.state.isCollapsed;return n.isCollapsed===a&&n.isCurrent===i?null:{isCurrent:i,isCollapsed:a,action:void 0,currentAction:void 0}},Object.defineProperty(t.prototype,"actions",{get:function(){var r=this,n=this.props.cell,i=Nt([],n.parent.actions.fromCell(n,this.plugin));if(i.length!==0)return i.sort(function(a,o){return a.definition.display.name<o.definition.display.name?-1:a.definition.display.name===o.definition.display.name?0:1}),Nt([er.Header("Apply Action")],i.map(function(a){return er.Item(a.definition.display.name,function(){return r.setState({action:"apply",currentAction:a})})}))},enumerable:!1,configurable:!0}),t.prototype.updates=function(r){for(var n=this.props.cell,i=xb.getDecoratorChain(n.parent,n.transform.ref),a=[],o=i.length-1;o>=0;o--){var s=i[o];a.push(P.jsx(cd,{state:n.parent,transform:s.transform,noMargin:!0,wrapInExpander:!0,expanderHeaderLeftMargin:r},s.transform.transformer.id+"-"+o))}return P.jsx("div",E({className:"msp-tree-updates-wrapper"},{children:a}),void 0)},t.prototype.render=function(){var r=this.props.cell,n=r.transform;if(!r)return null;var i=this.is(r.parent.behaviors.currentObject.value),a=r.status!=="error"&&r.status!=="ok",o;if(r.status==="error"||!r.obj){var s=r.status==="error"?r.errorText:n.transformer.definition.display.name;o=P.jsxs(mr,E({className:"msp-btn-tree-label msp-no-hover-outline",noOverflow:!0,title:s,onClick:this.state.isCurrent?this.setCurrentRoot:this.setCurrent,disabled:a},{children:[r.status==="error"&&P.jsxs("b",{children:["[",r.status,"]"]},void 0)," ",P.jsx("span",{children:s},void 0)]}),void 0)}else{var u=r.obj,l=u.label+" "+(u.description?u.description:"");o=P.jsxs(mr,E({className:"msp-btn-tree-label msp-type-class-"+u.type.typeClass,noOverflow:!0,disabled:a,title:l,onClick:this.state.isCurrent?this.setCurrentRoot:this.setCurrent},{children:[P.jsx("span",{children:u.label},void 0)," ",u.description?P.jsx("small",{children:u.description},void 0):void 0]}),void 0)}var c=r.parent.tree.children.get(this.ref),d=r.state,f=P.jsx(Ht,{svg:d.isCollapsed?Qc:Kc,flex:"20px",disabled:a,onClick:this.toggleExpanded,transparent:!0,className:"msp-no-hover-outline",style:{visibility:c.size>0?"visible":"hidden"}},void 0),p=r.state.isLocked?void 0:P.jsx(Ht,{svg:eu,onClick:this.remove,disabled:a,small:!0,toggleState:!1},void 0),v=P.jsx(Ht,{svg:d.isHidden?kv:Ov,toggleState:!1,disabled:a,small:!0,onClick:this.toggleVisible},void 0),h={marginLeft:this.props.depth*8+"px"},m=P.jsxs("div",E({className:"msp-flex-row msp-tree-row"+(i?" msp-tree-row-current":""),onMouseEnter:this.highlight,onMouseLeave:this.clearHighlight,style:h},{children:[f,o,p,v]}),void 0);if(!i)return m;if(this.state.action==="apply"&&this.state.currentAction)return P.jsxs("div",E({style:{marginBottom:"1px"}},{children:[m,P.jsx(Pc,E({header:"Apply "+this.state.currentAction.definition.display.name,initialExpanded:!0,hideExpander:!0,hideOffset:!1,onHeaderClick:this.hideApply,topRightIcon:Ac,headerLeftMargin:this.props.depth*8+21+"px"},{children:P.jsx(zF,{onApply:this.hideApply,state:this.props.cell.parent,action:this.state.currentAction,nodeRef:this.props.cell.transform.ref,hideHeader:!0,noMargin:!0},void 0)}),void 0)]}),void 0);if(this.state.action==="options"){var g=this.actions,y=this.updates(this.props.depth*8+21+"px");return P.jsxs("div",E({style:{marginBottom:"1px"}},{children:[m,y,g&&P.jsx("div",E({style:{marginLeft:this.props.depth*8+21+"px",marginTop:"-1px"}},{children:P.jsx(er,{items:g,onSelect:this.selectAction},void 0)}),void 0)]}),void 0)}return m},t}(gr),Aot=function(e){Fe(t,e);function t(){var r,n=e.apply(this,arguments)||this;return n.state={tab:n.plugin.behaviors.layout.leftPanelTabName.value},n.set=function(i){if(n.state.tab===i){n.setState({tab:"none"},function(){return n.plugin.behaviors.layout.leftPanelTabName.next("none")}),_t.Layout.Update(n.plugin,{state:{regionState:E(E({},n.plugin.layout.state.regionState),{left:"collapsed"})}});return}n.setState({tab:i},function(){return n.plugin.behaviors.layout.leftPanelTabName.next(i)}),n.plugin.layout.state.regionState.left!=="full"&&_t.Layout.Update(n.plugin,{state:{regionState:E(E({},n.plugin.layout.state.regionState),{left:"full"})}})},n.tabs={none:P.jsx(P.Fragment,{},void 0),root:P.jsxs(P.Fragment,{children:[P.jsx(Tc,{icon:O5,title:"Home"},void 0),P.jsx(pot,{state:n.plugin.state.data,nodeRef:cr.RootRef,hideHeader:!0,initiallyCollapsed:!0,alwaysExpandFirst:!0},void 0),((r=n.plugin.spec.components)===null||r===void 0?void 0:r.remoteState)!=="none"&&P.jsx(Nie,{listOnly:!0},void 0)]},void 0),data:P.jsxs(P.Fragment,{children:[P.jsx(Tc,{icon:rZ,title:P.jsxs(P.Fragment,{children:[P.jsx(Iot,{},void 0)," State Tree"]},void 0)},void 0),P.jsx(Uie,{state:n.plugin.state.data},void 0)]},void 0),states:P.jsx(hot,{},void 0),settings:P.jsxs(P.Fragment,{children:[P.jsx(Tc,{icon:uv,title:"Plugin Settings"},void 0),P.jsx(Tot,{},void 0)]},void 0),help:P.jsxs(P.Fragment,{children:[P.jsx(Tc,{icon:Fl,title:"Help"},void 0),P.jsx(Nnt,{},void 0)]},void 0)},n}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.behaviors.layout.leftPanelTabName,function(n){r.state.tab!==n&&r.setState({tab:n}),n==="none"&&r.plugin.layout.state.regionState.left!=="collapsed"&&_t.Layout.Update(r.plugin,{state:{regionState:E(E({},r.plugin.layout.state.regionState),{left:"collapsed"})}})}),this.subscribe(this.plugin.state.data.events.changed,function(n){var i=n.state;r.state.tab==="data"&&i.cells.size===1&&r.set("root")})},t.prototype.render=function(){var r=this,n=this.state.tab;return P.jsxs("div",E({className:"msp-left-panel-controls"},{children:[P.jsxs("div",E({className:"msp-left-panel-controls-buttons"},{children:[P.jsx(Ht,{svg:O5,toggleState:n==="root",transparent:!0,onClick:function(){return r.set("root")},title:"Home"},void 0),P.jsx(Pot,{set:this.set},void 0),P.jsx(Ht,{svg:lZ,toggleState:n==="states",transparent:!0,onClick:function(){return r.set("states")},title:"Plugin State"},void 0),P.jsx(Ht,{svg:Fl,toggleState:n==="help",transparent:!0,onClick:function(){return r.set("help")},title:"Help"},void 0),P.jsx("div",E({className:"msp-left-panel-controls-buttons-bottom"},{children:P.jsx(Ht,{svg:uv,toggleState:n==="settings",transparent:!0,onClick:function(){return r.set("settings")},title:"Settings"},void 0)}),void 0)]}),void 0),P.jsx("div",E({className:"msp-scrollable-container"},{children:this.tabs[n]}),void 0)]}),void 0)},t}(gr),Pot=function(e){Fe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={changed:!1},r}return Object.defineProperty(t.prototype,"tab",{get:function(){return this.plugin.behaviors.layout.leftPanelTabName.value},enumerable:!1,configurable:!0}),t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.behaviors.layout.leftPanelTabName,function(n){r.tab==="data"?r.setState({changed:!1}):r.forceUpdate()}),this.subscribe(this.plugin.state.data.events.changed,function(n){r.tab!=="data"&&r.setState({changed:!0})})},t.prototype.render=function(){var r=this;return P.jsx(Ht,{svg:rZ,toggleState:this.tab==="data",transparent:!0,onClick:function(){return r.props.set("data")},title:"State Tree",style:{position:"relative"},extraContent:this.state.changed?P.jsx("div",{className:"msp-left-panel-controls-button-data-dirty"},void 0):void 0},void 0)},t}(gr),Tot=function(e){Fe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.setSettings=function(n){var i;_t.Canvas3D.SetSettings(r.plugin,{settings:(i={},i[n.name]=n.value,i)})},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.events.canvas3d.settingsUpdated,function(){return r.forceUpdate()}),this.subscribe(this.plugin.layout.events.updated,function(){return r.forceUpdate()}),this.subscribe(this.plugin.canvas3d.camera.stateChanged,function(n){(n.radiusMax!==void 0||n.radius!==void 0)&&r.forceUpdate()})},t.prototype.render=function(){return P.jsxs(P.Fragment,{children:[this.plugin.canvas3d&&P.jsxs(P.Fragment,{children:[P.jsx(Tc,{title:"Viewport"},void 0),P.jsx(Un,{params:Ts,values:this.plugin.canvas3d.props,onChange:this.setSettings},void 0)]},void 0),P.jsx(Tc,{title:"Behavior"},void 0),P.jsx(Uie,{state:this.plugin.state.behaviors},void 0)]},void 0)},t}(gr),Iot=function(e){Fe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.remove=function(n){n.preventDefault(),_t.State.RemoveObject(r.plugin,{state:r.plugin.state.data,ref:cr.RootRef})},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.state.events.cell.created,function(n){n.cell.transform.parent===cr.RootRef&&r.forceUpdate()}),this.subscribe(this.plugin.state.events.cell.removed,function(n){n.parent===cr.RootRef&&r.forceUpdate()})},t.prototype.render=function(){var r=this.plugin.state.data.tree.children.get(cr.RootRef).size;return r===0?null:P.jsx(Ht,{svg:eu,onClick:this.remove,title:"Remove All",style:{display:"inline-block"},small:!0,className:"msp-no-hover-outline",transparent:!0},void 0)},t}(gr),XH=5,Mot=function(e){Fe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.parentDiv=_e.createRef(),r.lastMouseOverSeqIdx=-1,r.highlightQueue=new ri,r.lociHighlightProvider=function(n,i){var a=r.props.sequenceWrapper.markResidue(n.loci,i);a&&r.updateMarker()},r.lociSelectionProvider=function(n,i){var a=r.props.sequenceWrapper.markResidue(n.loci,i);a&&r.updateMarker()},r.contextMenu=function(n){n.preventDefault()},r.mouseDownLoci=void 0,r.mouseDown=function(n){n.stopPropagation();var i=r.getSeqIdx(n),a=r.getLoci(i),o=Ah(n.nativeEvent),s=Zm(n.nativeEvent),u=$x(n.nativeEvent);r.click(a,o,s,u),r.mouseDownLoci=a},r.mouseUp=function(n){if(n.stopPropagation(),r.mouseDownLoci!==void 0){var i=r.getSeqIdx(n),a=r.getLoci(i);if(a&&!Re.areEqual(r.mouseDownLoci,a)){var o=Ah(n.nativeEvent),s=Zm(n.nativeEvent),u=$x(n.nativeEvent),l=r.mouseDownLoci.elements[0],c=a.elements[0],d=Math.min(Le.min(l.indices),Le.min(c.indices)),f=Math.max(Le.max(l.indices),Le.max(c.indices)),p=Re(a.structure,[{unit:l.unit,indices:Le.ofRange(d,f)}]);r.click(Re.subtract(p,r.mouseDownLoci),o,s,u)}r.mouseDownLoci=void 0}},r.location=Ze.create(void 0),r.mouseMove=function(n){n.stopPropagation();var i=Ah(n.nativeEvent),a=Zm(n.nativeEvent),o=$x(n.nativeEvent),s=n.target;if(!s||!s.getAttribute){if(r.lastMouseOverSeqIdx===-1)return;r.lastMouseOverSeqIdx=-1,r.highlightQueue.next({seqIdx:-1,buttons:i,button:a,modifiers:o});return}var u=s.hasAttribute("data-seqid")?+s.getAttribute("data-seqid"):-1;if(r.lastMouseOverSeqIdx!==u)if(r.lastMouseOverSeqIdx=u,r.mouseDownLoci!==void 0){var l=r.getLoci(u);r.hover(l,0,0,E(E({},o),{shift:!0}))}else r.highlightQueue.next({seqIdx:u,buttons:i,button:a,modifiers:o})},r.mouseLeave=function(n){if(n.stopPropagation(),r.mouseDownLoci=void 0,r.lastMouseOverSeqIdx!==-1){r.lastMouseOverSeqIdx=-1;var i=Ah(n.nativeEvent),a=Zm(n.nativeEvent),o=$x(n.nativeEvent);r.highlightQueue.next({seqIdx:-1,buttons:i,button:a,modifiers:o})}},r}return Object.defineProperty(t.prototype,"sequenceNumberPeriod",{get:function(){if(this.props.sequenceNumberPeriod!==void 0)return this.props.sequenceNumberPeriod;if(this.props.sequenceWrapper.length>10)return 10;var r=this.getSequenceNumber(this.props.sequenceWrapper.length-1);return r.length>1?5:1},enumerable:!1,configurable:!0}),t.prototype.componentDidMount=function(){var r=this;this.plugin.managers.interactivity.lociHighlights.addProvider(this.lociHighlightProvider),this.plugin.managers.interactivity.lociSelects.addProvider(this.lociSelectionProvider),this.subscribe(Bie(15)(this.highlightQueue),function(n){var i=r.getLoci(n.seqIdx<0?void 0:n.seqIdx);r.hover(i,n.buttons,n.button,n.modifiers)})},t.prototype.componentWillUnmount=function(){e.prototype.componentWillUnmount.call(this),this.plugin.managers.interactivity.lociHighlights.removeProvider(this.lociHighlightProvider),this.plugin.managers.interactivity.lociSelects.removeProvider(this.lociSelectionProvider)},t.prototype.getLoci=function(r){if(r!==void 0){var n=this.props.sequenceWrapper.getLoci(r);if(!Re.isEmpty(n))return n}},t.prototype.getSeqIdx=function(r){var n=void 0,i=r.target;return i&&i.getAttribute&&(n=i.hasAttribute("data-seqid")?+i.getAttribute("data-seqid"):void 0),n},t.prototype.hover=function(r,n,i,a){var o={current:or.Loci.Empty,buttons:n,button:i,modifiers:a};r!==void 0&&!Re.isEmpty(r)&&(o.current={loci:r}),this.plugin.behaviors.interaction.hover.next(o)},t.prototype.click=function(r,n,i,a){var o={current:or.Loci.Empty,buttons:n,button:i,modifiers:a};r!==void 0&&!Re.isEmpty(r)&&(o.current={loci:r}),this.plugin.behaviors.interaction.click.next(o)},t.prototype.getBackgroundColor=function(r){return typeof r>"u"&&console.error("unexpected marker value"),r===0?"":r%2===0?"rgb(51, 255, 25)":"rgb(255, 102, 153)"},t.prototype.getResidueClass=function(r,n){return n.length>1?this.props.sequenceWrapper.residueClass(r)+(r===0?" msp-sequence-residue-long-begin":" msp-sequence-residue-long"):this.props.sequenceWrapper.residueClass(r)},t.prototype.residue=function(r,n,i){return P.jsx("span",E({"data-seqid":r,style:{backgroundColor:this.getBackgroundColor(i)},className:this.getResidueClass(r,n)},{children:""+n+""}),r)},t.prototype.getSequenceNumberClass=function(r,n,i){var a=["msp-sequence-number"];return n.startsWith("-")?i.length>1&&r>0?a.push("msp-sequence-number-long-negative"):a.push("msp-sequence-number-negative"):i.length>1&&r>0&&a.push("msp-sequence-number-long"),a.join(" ")},t.prototype.getSequenceNumber=function(r){var n="",i=this.props.sequenceWrapper.getLoci(r),a=Re.getFirstLocation(i,this.location);if(a)if(je.isAtomic(a.unit)){var o=lt.residue.auth_seq_id(a),s=lt.residue.pdbx_PDB_ins_code(a);n=""+o+(s||"")}else je.isCoarse(a.unit)&&(n=""+(r+1));return n},t.prototype.padSeqNum=function(r){return r.length<XH?r+new Array(XH-r.length+1).join(""):r},t.prototype.getSequenceNumberSpan=function(r,n){var i=this.getSequenceNumber(r);return P.jsx("span",E({className:this.getSequenceNumberClass(r,i,n)},{children:this.padSeqNum(i)}),"marker-"+r)},t.prototype.updateMarker=function(){if(this.parentDiv.current)for(var r=this.parentDiv.current.children,n=this.props.sequenceWrapper.markerArray,i=!this.props.hideSequenceNumbers,a=this.sequenceNumberPeriod,o=0,s=0,u=n.length;s<u;s++){i&&s%a===0&&s<u&&o++;var l=r[o];if(!l)return;o++;var c=this.getBackgroundColor(n[s]);l.style.backgroundColor!==c&&(l.style.backgroundColor=c)}},t.prototype.render=function(){for(var r=this.props.sequenceWrapper,n=[],i=!this.props.hideSequenceNumbers,a=this.sequenceNumberPeriod,o=0,s=r.length;o<s;++o){var u=r.residueLabel(o);i&&o%a===0&&o<s&&(n[n.length]=this.getSequenceNumberSpan(o,u)),n[n.length]=this.residue(o,u,r.markerArray[o])}return this.updateMarker(),P.jsx("div",E({className:"msp-sequence-wrapper",onContextMenu:this.contextMenu,onMouseDown:this.mouseDown,onMouseUp:this.mouseUp,onMouseMove:this.mouseMove,onMouseLeave:this.mouseLeave,ref:this.parentDiv},{children:n}),void 0)},t}(gr),aA=function(){function e(t,r,n){this.data=t,this.markerArray=r,this.length=n}return e.prototype.markResidue=function(t,r){return Hs(t)?Gu(this.markerArray,Ie.ofLength(this.length),r):this.mark(t,r)},e}(),Dot=function(e){Fe(t,e);function t(r){var n=this,i=Ze.create(r.structure,r.units[0],r.units[0].elements[0]),a=r.units[0].model.sequence.byEntityKey[lt.entity.key(i)],o=a.sequence.length,s=new Uint8Array(o);n=e.call(this,r,s,o)||this,n.unitMap=new Map;for(var u=0,l=r.units;u<l.length;u++){var c=l[u];n.unitMap.set(c.id,c)}n.sequence=a.sequence,n.missing=r.units[0].model.properties.missingResidues,n.modelNum=r.units[0].model.modelNum,n.asymId=je.isAtomic(r.units[0])?lt.chain.label_asym_id(i):lt.coarse.asym_id(i);for(var d=[],f=0;f<o;++f)n.missing.has(n.modelNum,n.asymId,n.seqId(f))&&d.push(f);return n.observed=Le.subtract(Ie.ofBounds(0,o),Je.ofSortedArray(d)),n}return t.prototype.seqId=function(r){return this.sequence.seqId.value(r)},t.prototype.residueLabel=function(r){return this.sequence.label.value(r)||this.sequence.code.value(r)},t.prototype.residueColor=function(r){return this.missing.has(this.modelNum,this.asymId,this.seqId(r))?fr.grey:fr.black},t.prototype.residueClass=function(r){return this.missing.has(this.modelNum,this.asymId,this.seqId(r))?"msp-sequence-missing":"msp-sequence-present"},t.prototype.mark=function(r,n){var i=this,a=!1,o=this.data.structure,s=function(d){return i.sequence.index(d)};if(Re.is(r)){if(!We.areRootsEquivalent(r.structure,o))return!1;r=Re.remap(r,o);for(var u=0,l=r.elements;u<l.length;u++){var c=l[u];this.unitMap.has(c.unit.id)&&(je.isAtomic(c.unit)?a=kot(c,n,this.markerArray,s):a=Oot(c,n,this.markerArray,s))}}else if(We.isLoci(r)){if(!We.areRootsEquivalent(r.structure,o))return!1;Gu(this.markerArray,this.observed,n)&&(a=!0)}return a},t.prototype.getLoci=function(r){var n=Rot(this.data.units[0].chainGroupId,this.data.units[0].conformation.operator.name,this.seqId(r));return mt.toLociWithSourceUnits(dD.run(n,this.data.structure))},t}(aA);function Rot(e,t,r){return nn.generators.atoms({unitTest:function(n){return lt.unit.chainGroupId(n.element)===e&&lt.unit.operator_name(n.element)===t},residueTest:function(n){return n.element.unit.kind===0?lt.residue.label_seq_id(n.element)===r:lt.coarse.seq_id_begin(n.element)<=r&&lt.coarse.seq_id_end(n.element)>=r}})}function kot(e,t,r,n){var i=e.unit,a=i.model,o=i.elements,s=a.atomicHierarchy.residueAtomSegments.index,u=a.atomicHierarchy.residues.label_seq_id;return Le.forEachSegment(e.indices,function(l){return s[o[l]]},function(l){var c=u.value(l);sw(r,n(c),t)}),!0}function Oot(e,t,r,n){var i=e.unit,a=i.model,o=i.elements,s=je.isSpheres(e.unit)?a.coarseHierarchy.spheres.seq_id_begin:a.coarseHierarchy.gaussians.seq_id_begin,u=je.isSpheres(e.unit)?a.coarseHierarchy.spheres.seq_id_end:a.coarseHierarchy.gaussians.seq_id_end;return Le.forEach(e.indices,function(l){for(var c=o[l],d=n(s.value(c)),f=n(u.value(c));d<=f;d++)sw(r,d,t)}),!0}var Lot=function(e){Fe(t,e);function t(r){for(var n=this,i=[],a=new Map,o=new Map,s=new Map,u=0,l=r.units.length;u<l;++u)for(var c=r.units[u],d=c.model.atomicHierarchy,f=d.residueAtomSegments,p=d.atoms,v=nr.transientSegments(f,c.elements);v.hasNext;){var h=v.move().index;a.set(h,i.length),o.set(i.length,h),s.set(i.length,c),i.push(p.label_comp_id.value(f.offsets[h]))}var m=i.length,g=new Uint8Array(m);n=e.call(this,r,g,m)||this,n.unitMap=new Map;for(var y=0,b=r.units;y<b.length;y++){var c=b[y];n.unitMap.set(c.id,c)}return n.sequence=i,n.sequenceIndices=a,n.residueIndices=o,n.seqToUnit=s,n}return t.prototype.residueLabel=function(r){return this.sequence[r]},t.prototype.residueColor=function(r){return fr.black},t.prototype.residueClass=function(r){return"msp-sequence-present"},t.prototype.mark=function(r,n){var i=this,a=!1,o=this.data.structure;if(Re.is(r)){if(!We.areRootsEquivalent(r.structure,o))return!1;r=Re.remap(r,o);for(var s=function(f){var p=u.unitMap.get(f.unit.id);if(p){var v=f.unit.model.atomicHierarchy.residueAtomSegments.index;Le.forEach(f.indices,function(h){var m=i.sequenceIndices.get(v[p.elements[h]]);m!==void 0&&Gu(i.markerArray,Ie.ofSingleton(m),n)&&(a=!0)})}},u=this,l=0,c=r.elements;l<c.length;l++){var d=c[l];s(d)}}else if(We.isLoci(r)){if(!We.areRootsEquivalent(r.structure,o))return!1;Gu(this.markerArray,Ie.ofBounds(0,this.length),n)&&(a=!0)}return a},t.prototype.getLoci=function(r){var n=[],i=this.residueIndices.get(r);if(i!==void 0){var a=this.seqToUnit.get(r),o=a.model.atomicHierarchy.residueAtomSegments.offsets,s=Je.findPredecessorIndex(a.elements,o[i]),u=Je.findPredecessorIndex(a.elements,o[i+1]);n.push({unit:a,indices:Ie.ofBounds(s,u)})}return Re(this.data.structure,n)},t}(aA),OT=function(e){Fe(t,e);function t(r){for(var n=this,i=0,a=0,o=[],s=Ze.create(r.structure),u=new Map,l=[],c=0,d=r.units.length;c<d;++c){var f=r.units[c];Ze.set(s,r.structure,f,f.elements[0]);var p=f.model.sequence.byEntityKey[lt.entity.key(s)];p&&(i+=p.sequence.length),a+=f.elements.length;var v=Ie.ofBounds(0,f.elements.length);u.set(f.id,v),l.push({unit:f,indices:v})}i>0&&o.push(i+" residues"),o.push(a+" elements");var h=1,m=new Uint8Array(h);return n=e.call(this,r,m,h)||this,n.label="Whole Chain ("+o.join(", ")+")",n.unitIndices=u,n.loci=Re(n.data.structure,l),n}return t.prototype.residueLabel=function(r){return this.label},t.prototype.residueColor=function(r){return fr.black},t.prototype.residueClass=function(r){return"msp-sequence-present"},t.prototype.mark=function(r,n){var i=!1,a=this.data.structure;if(Re.is(r)){if(!We.areRootsEquivalent(r.structure,a))return!1;r=Re.remap(r,a);for(var o=0,s=r.elements;o<s.length;o++){var u=s[o],l=this.unitIndices.get(u.unit.id);l&&Le.isSubset(l,u.indices)&&Gu(this.markerArray,Ie.ofSingleton(0),n)&&(i=!0)}}else if(We.isLoci(r)){if(!We.areRootsEquivalent(r.structure,a))return!1;Gu(this.markerArray,Ie.ofSingleton(0),n)&&(i=!0)}return i},t.prototype.getLoci=function(r){return this.loci},t}(aA),Fot=function(e){Fe(t,e);function t(r){for(var n=this,i=0,a=new Map,o=0,s=r.units.length;o<s;++o){var u=r.units[o];i+=u.elements.length;var l=Ie.ofBounds(0,u.elements.length);a.set(u.id,l)}var c=new Uint8Array(i);return n=e.call(this,r,c,i)||this,n.unitIndices=a,n}return t.prototype.residueLabel=function(r){return"X"},t.prototype.residueColor=function(r){return fr.black},t.prototype.residueClass=function(r){return"msp-sequence-present"},t.prototype.mark=function(r,n){var i=!1,a=this.data,o=a.structure,s=a.units;if(Re.is(r)){if(!We.areRootsEquivalent(r.structure,o))return!1;r=Re.remap(r,o);for(var u=0,l=r.elements;u<l.length;u++){var c=l[u],d=this.unitIndices.get(c.unit.id);d&&Le.isSubset(d,c.indices)&&Gu(this.markerArray,c.indices,n)&&(i=!0)}}else if(We.isLoci(r)){if(!We.areRootsEquivalent(r.structure,o))return!1;for(var f=0,p=s.length;f<p;++f){var d=this.unitIndices.get(s[f].id);Gu(this.markerArray,d,n)&&(i=!0)}}return i},t.prototype.getLoci=function(r){for(var n=this.data.units,i=[],a=0,o=0,s=n.length;o<s;++o){var u=n[o];if(r<a+u.elements.length){i.push({unit:u,indices:Ie.ofSingleton(r-a)});break}a+=u.elements.length}return Re(this.data.structure,i)},t}(aA),LT=5e3;function jie(e){var t=lt.unit.pdbx_struct_oper_list_ids(e),r=lt.unit.struct_ncs_oper_id(e),n=lt.unit.hkl(e),i=lt.unit.spgrOp(e);return t.sort().join(",")+"|"+r+"|"+n+"|"+i}function VF(e){var t=e.split("|"),r=t[0],n=t[1];return[parseInt(r),n]}function YH(e,t){for(var r=e.structure,n=e.modelEntityId,i=e.chainGroupId,a=e.operatorKey,o=Ze.create(r),s=VF(n),u=s[0],l=s[1],c=[],d=0,f=r.units;d<f.length;d++){var p=f[d];Ze.set(o,r,p,p.elements[0]),r.getModelIndex(p.model)===u&&lt.entity.id(o)===l&&p.chainGroupId===i&&jie(o)===a&&c.push(p)}if(c.length>0){var v={structure:r,units:c},p=c[0],h=void 0;if(p.polymerElements.length){var m=Ze.create(r,p,p.elements[0]),g=p.model.sequence.byEntityKey[lt.entity.key(m)];if(g&&g.sequence.length<=LT)h=new Dot(v);else{var y=c.reduce(function(x,C){return x+C.polymerElements.length},0);je.isAtomic(p)||y>LT?h=new OT(v):h=new Fot(v)}}else if(je.isAtomic(p)){var b=c.reduce(function(x,C){return x+C.residueCount},0);b>LT?h=new OT(v):h=new Lot(v)}else console.warn("should not happen, expecting coarse units to be polymeric"),h=new OT(v);return h.markResidue(t.getLoci(r),tr.Select),h}else return"No sequence available"}function tS(e,t){t===void 0&&(t=!1);for(var r=[],n=Ze.create(e),i=new Set,a=0,o=e.units;a<o.length;a++){var s=o[a];Ze.set(n,e,s,s.elements[0]);var u=lt.entity.id(n),l=e.getModelIndex(s.model),c=l+"|"+u;if(!i.has(c)&&!(t&&lt.entity.type(n)!=="polymer")){var d=lt.entity.pdbx_description(n).join(", ");e.models.length&&(e.representativeModel?d+=" (Model "+e.models[l].modelNum+")":d.startsWith("Polymer ")&&(d+=" ("+e.models[l].entry+")"));var f=u+": "+d;r.push([c,f]),i.add(c)}}return r.length===0&&r.push(["","No entities"]),r}function yy(e,t){for(var r=[],n=Ze.create(e),i=new Set,a=VF(t),o=a[0],s=a[1],u=0,l=e.units;u<l.length;u++){var c=l[u];if(Ze.set(n,e,c,c.elements[0]),e.getModelIndex(c.model)===o&&lt.entity.id(n)===s){var d=c.chainGroupId;if(!i.has(d)){var f=fu(n,{granularity:"chain",hidePrefix:!0,htmlStyling:!1});r.push([d,f]),i.add(d)}}}return r.length===0&&r.push([-1,"No units"]),r}function Sm(e,t,r){for(var n=[],i=Ze.create(e),a=new Set,o=VF(t),s=o[0],u=o[1],l=0,c=e.units;l<c.length;l++){var d=c[l];if(Ze.set(i,e,d,d.elements[0]),e.getModelIndex(d.model)===s&&lt.entity.id(i)===u&&d.chainGroupId===r){var f=jie(i);if(!a.has(f)){var p=d.conformation.operator.name;n.push([f,p]),a.add(f)}}}return n.length===0&&n.push(["","No operators"]),n}function KH(e){for(var t,r=[],n=[],i=e.select(ir.Generators.rootsOfType(ge.Molecule.Structure)),a=0,o=i;a<o.length;a++){var s=o[a];!((t=s.obj)===null||t===void 0)&&t.data&&(n.push(s.obj.data),r.push([s.transform.ref,s.obj.data.label]))}return r.length===0&&r.push(["","No structure"]),{options:r,all:n}}var QH=I.Select("single",[["single","Chain"],["polymers","Polymers"],["all","Everything"]]),Not=function(e){Fe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={structureOptions:{options:[],all:[]},structure:We.Empty,structureRef:"",modelEntityId:"",chainGroupId:-1,operatorKey:"",mode:"single"},r.setParamProps=function(n){var i=E({},r.state);switch(n.name){case"mode":if(i.mode=n.value,r.state.mode===i.mode)return;if(i.mode==="all"||i.mode==="polymers")break;case"structure":n.name==="structure"&&(i.structureRef=n.value),i.structure=r.getStructure(i.structureRef),i.modelEntityId=tS(i.structure)[0][0],i.chainGroupId=yy(i.structure,i.modelEntityId)[0][0],i.operatorKey=Sm(i.structure,i.modelEntityId,i.chainGroupId)[0][0];break;case"entity":i.modelEntityId=n.value,i.chainGroupId=yy(i.structure,i.modelEntityId)[0][0],i.operatorKey=Sm(i.structure,i.modelEntityId,i.chainGroupId)[0][0];break;case"chain":i.chainGroupId=n.value,i.operatorKey=Sm(i.structure,i.modelEntityId,i.chainGroupId)[0][0];break;case"operator":i.operatorKey=n.value;break}r.setState(i)},r}return t.prototype.componentDidMount=function(){var r=this;this.plugin.state.data.select(ir.Generators.rootsOfType(ge.Molecule.Structure)).length>0&&this.setState(this.getInitialState()),this.subscribe(this.plugin.state.events.object.updated,function(n){var i=n.ref,a=n.obj;i===r.state.structureRef&&a&&a.type===ge.Molecule.Structure.type&&a.data!==r.state.structure&&r.sync()}),this.subscribe(this.plugin.state.events.object.created,function(n){var i=n.obj;i&&i.type===ge.Molecule.Structure.type&&r.sync()}),this.subscribe(this.plugin.state.events.object.removed,function(n){var i=n.obj;i&&i.type===ge.Molecule.Structure.type&&i.data===r.state.structure&&r.sync()})},t.prototype.sync=function(){var r=KH(this.plugin.state.data);sL(r.all,this.state.structureOptions.all)||this.setState(this.getInitialState())},t.prototype.getStructure=function(r){var n=this.plugin.state.data,i=n.select(r)[0];return!r||!i||!i.obj?We.Empty:i.obj.data},t.prototype.getSequenceWrapper=function(r){return{wrapper:YH(this.state,this.plugin.managers.structure.selection),label:I.optionLabel(r.chain,this.state.chainGroupId)+" | "+I.optionLabel(r.entity,this.state.modelEntityId)}},t.prototype.getSequenceWrappers=function(r){if(this.state.mode==="single")return[this.getSequenceWrapper(r)];for(var n=this.getStructure(this.state.structureRef),i=[],a=0,o=tS(n,this.state.mode==="polymers");a<o.length;a++)for(var s=o[a],u=s[0],l=s[1],c=0,d=yy(n,u);c<d.length;c++)for(var f=d[c],p=f[0],v=f[1],h=0,m=Sm(n,u,p);h<m.length;h++){var g=m[h][0];i.push({wrapper:YH({structure:n,modelEntityId:u,chainGroupId:p,operatorKey:g},this.plugin.managers.structure.selection),label:v+" | "+l})}return i},t.prototype.getInitialState=function(){var r,n=KH(this.plugin.state.data),i=n.options[0][0],a=this.getStructure(i),o=tS(a)[0][0],s=yy(a,o)[0][0],u=Sm(a,o,s)[0][0];return this.state.structure&&this.state.structure===a&&(o=this.state.modelEntityId,s=this.state.chainGroupId,u=this.state.operatorKey),{structureOptions:n,structure:a,structureRef:i,modelEntityId:o,chainGroupId:s,operatorKey:u,mode:(r=this.props.defaultMode)!==null&&r!==void 0?r:"single"}},Object.defineProperty(t.prototype,"params",{get:function(){var r=this.state,n=r.structureOptions,i=r.structure,a=r.modelEntityId,o=r.chainGroupId,s=tS(i),u=yy(i,a),l=Sm(i,a,o);return{structure:I.Select(n.options[0][0],n.options,{shortLabel:!0}),entity:I.Select(s[0][0],s,{shortLabel:!0}),chain:I.Select(u[0][0],u,{shortLabel:!0,twoColumns:!0,label:"Chain"}),operator:I.Select(l[0][0],l,{shortLabel:!0,twoColumns:!0}),mode:QH}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"values",{get:function(){return{structure:this.state.structureRef,entity:this.state.modelEntityId,chain:this.state.chainGroupId,operator:this.state.operatorKey,mode:this.state.mode}},enumerable:!1,configurable:!0}),t.prototype.render=function(){if(this.getStructure(this.state.structureRef)===We.Empty)return P.jsx("div",E({className:"msp-sequence"},{children:P.jsxs("div",E({className:"msp-sequence-select"},{children:[P.jsx(sn,{svg:Fl,style:{cursor:"help",position:"absolute",right:0,top:0},title:"Shows a sequence of one or more chains. Use the controls to alter selection."},void 0),P.jsx("span",{children:"Sequence"},void 0),P.jsx("span",E({style:{fontWeight:"normal"}},{children:"No structure available"}),void 0)]}),void 0)}),void 0);var r=this.params,n=this.values,i=this.getSequenceWrappers(r);return P.jsxs("div",E({className:"msp-sequence"},{children:[P.jsxs("div",E({className:"msp-sequence-select"},{children:[P.jsx(sn,{svg:Fl,style:{cursor:"help",position:"absolute",right:0,top:0},title:"This shows a single sequence. Use the controls to show a different sequence."},void 0),P.jsx("span",{children:"Sequence of"},void 0),P.jsx(Mm,{title:"[Structure] "+I.optionLabel(r.structure,n.structure),param:r.structure,name:"structure",value:n.structure,onChange:this.setParamProps},void 0),P.jsx(Mm,{title:"[Mode]",param:QH,name:"mode",value:n.mode,onChange:this.setParamProps},void 0),n.mode==="single"&&P.jsx(Mm,{title:"[Entity] "+I.optionLabel(r.entity,n.entity),param:r.entity,name:"entity",value:n.entity,onChange:this.setParamProps},void 0),n.mode==="single"&&P.jsx(Mm,{title:"[Chain] "+I.optionLabel(r.chain,n.chain),param:r.chain,name:"chain",value:n.chain,onChange:this.setParamProps},void 0),r.operator.options.length>1&&P.jsx(P.Fragment,{children:P.jsx(Mm,{title:"[Instance] "+I.optionLabel(r.operator,n.operator),param:r.operator,name:"operator",value:n.operator,onChange:this.setParamProps},void 0)},void 0)]}),void 0),P.jsx(Bot,{children:i.map(function(a,o){var s=typeof a.wrapper=="string"?P.jsx("div",E({className:"msp-sequence-wrapper"},{children:a.wrapper}),o):P.jsx(Mot,{sequenceWrapper:a.wrapper},o);return n.mode==="single"?s:P.jsxs(_e.Fragment,{children:[P.jsx("div",E({className:"msp-sequence-chain-label"},{children:a.label}),void 0),s]},o)})},void 0)]}),void 0)},t}(gr);function Bot(e){var t=e.children;return P.jsx("div",E({className:"msp-sequence-wrapper-non-empty"},{children:t}),void 0)}var Uot=function(e){Fe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={tracked:si.OrderedMap()},r}return t.prototype.componentDidMount=function(){var r=this,n,i=!!(!((n=this.plugin.spec.components)===null||n===void 0)&&n.hideTaskOverlay);this.subscribe(this.plugin.events.task.progress.pipe(gE(function(a){return a.level==="background"&&(i||!a.useOverlay)})),function(a){r.setState({tracked:r.state.tracked.set(a.id,a)})}),this.subscribe(this.plugin.events.task.finished,function(a){var o=a.id;r.setState({tracked:r.state.tracked.delete(o)})})},t.prototype.render=function(){return P.jsx("div",E({className:"msp-background-tasks"},{children:this.state.tracked.valueSeq().map(function(r){return P.jsx(zie,{event:r},r.id)})}),void 0)},t}(gr),zie=function(e){Fe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.abort=function(){r.plugin.managers.task.requestAbort(r.props.event.progress.root.progress.taskId,"User Request")},r}return t.prototype.render=function(){var r=this.props.event.progress.root,n=Vie(this.props.event.progress.root)-1,i=r.progress.isIndeterminate?void 0:P.jsxs(P.Fragment,{children:["[",r.progress.current,"/",r.progress.max,"]"]},void 0),a=n>0?P.jsxs(P.Fragment,{children:["[",n," subtask(s)]"]},void 0):void 0;return P.jsx("div",E({className:"msp-task-state"},{children:P.jsxs("div",{children:[r.progress.canAbort&&P.jsx(Ht,{svg:iZ,onClick:this.abort,title:"Abort"},void 0),P.jsxs("div",{children:[r.progress.message," ",i," ",a]},void 0)]},void 0)}),void 0)},t}(gr);function Vie(e){if(e.children.length===0)return 1;for(var t=0,r=0,n=e.children;r<n.length;r++){var i=n[r];t+=Vie(i)}return t}var jot=function(e){Fe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={tracked:si.OrderedMap()},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.events.task.progress.pipe(gE(function(n){return!!n.useOverlay})),function(n){r.setState({tracked:r.state.tracked.set(n.id,n)})}),this.subscribe(this.plugin.events.task.finished,function(n){var i=n.id;r.setState({tracked:r.state.tracked.delete(i)})})},t.prototype.render=function(){return this.state.tracked.size===0?null:P.jsx("div",E({className:"msp-overlay-tasks"},{children:this.state.tracked.valueSeq().map(function(r){return P.jsx(zie,{event:r},r.id)})}),void 0)},t}(gr),zot=function(e){Fe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.hide=function(){var n=r.props.entry;(n.hide||function(){}).call(null)},r}return t.prototype.render=function(){var r=this,n=this.props.entry,i=typeof n.message=="string"?P.jsx("div",{dangerouslySetInnerHTML:{__html:n.message}},void 0):P.jsx("div",{children:P.jsx(n.message,{},void 0)},void 0);return P.jsxs("div",E({className:"msp-toast-entry"},{children:[P.jsx("div",E({className:"msp-toast-title",onClick:function(){return r.hide()}},{children:n.title}),void 0),P.jsx("div",E({className:"msp-toast-message"},{children:i}),void 0),P.jsx("div",{className:"msp-toast-clear"},void 0),P.jsx("div",E({className:"msp-toast-hide"},{children:P.jsx(Ht,{svg:iZ,onClick:this.hide,title:"Hide",className:"msp-no-hover-outline"},void 0)}),void 0)]}),void 0)},t}(gr),Vot=function(e){Fe(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.managers.toast.events.changed,function(){return r.forceUpdate()})},t.prototype.render=function(){var r=this.plugin.managers.toast.state;if(!r.entries.count())return null;var n=[];return r.entries.forEach(function(i,a){return n.push(i)}),n.sort(function(i,a){return i.serialNumber-a.serialNumber}),P.jsx("div",E({className:"msp-toast-container"},{children:n.map(function(i){return P.jsx(zot,{entry:i},i.serialNumber)})}),void 0)},t}(gr),Hot=function(e){Fe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.container=_e.createRef(),r.canvas=_e.createRef(),r.state={noWebGl:!1,showLogo:!0},r.handleLogo=function(){var n;r.setState({showLogo:!(!((n=r.plugin.canvas3d)===null||n===void 0)&&n.reprCount.value)})},r}return t.prototype.componentDidMount=function(){if(!this.canvas.current||!this.container.current||!this.plugin.initViewer(this.canvas.current,this.container.current)){this.setState({noWebGl:!0});return}this.handleLogo(),this.subscribe(this.plugin.canvas3d.reprCount,this.handleLogo)},t.prototype.componentWillUnmount=function(){e.prototype.componentWillUnmount.call(this)},t.prototype.renderMissing=function(){if(this.props.noWebGl){var r=this.props.noWebGl;return P.jsx(r,{},void 0)}return P.jsx("div",E({className:"msp-no-webgl"},{children:P.jsxs("div",{children:[P.jsx("p",{children:P.jsx("b",{children:"WebGL does not seem to be available."},void 0)},void 0),P.jsx("p",{children:"This can be caused by an outdated browser, graphics card driver issue, or bad weather. Sometimes, just restarting the browser helps."},void 0),P.jsxs("p",{children:["For a list of supported browsers, refer to ",P.jsx("a",E({href:"http://caniuse.com/#feat=webgl",target:"_blank"},{children:"http://caniuse.com/#feat=webgl"}),void 0),"."]},void 0)]},void 0)}),void 0)},t.prototype.render=function(){if(this.state.noWebGl)return this.renderMissing();var r=this.props.logo;return P.jsxs("div",E({className:this.props.parentClassName||"msp-viewport",style:this.props.parentStyle},{children:[P.jsx("div",E({className:this.props.hostClassName||"msp-viewport-host3d",style:this.props.hostStyle,ref:this.container},{children:P.jsx("canvas",{ref:this.canvas},void 0)}),void 0),this.state.showLogo&&r&&P.jsx(r,{},void 0)]}),void 0)},t}(gr);function Th(e){var t=_e.useState(e==null?void 0:e.value),r=t[0],n=t[1];return _e.useEffect(function(){if(!e){r!==void 0&&n(void 0);return}var i=!0,a=e.subscribe(function(o){i?(i=!1,o!==r&&n(o)):n(o)});return function(){a.unsubscribe()}},[e]),r}var Got=function(e){var t=e.plugin,r=e.cropFrameColor,n=t.helpers.viewportScreenshot,i=_e.useState(null),a=i[0],o=i[1],s=_e.useRef(null),u=_e.useRef(e);return _e.useEffect(function(){u.current=e},Object.values(e)),_e.useEffect(function(){a!==s.current&&o(s.current)}),_e.useEffect(function(){var l,c=!1,d=[];function f(g,y){g&&d.push(g.subscribe(y))}function p(){var g=u.current;!g.suspend&&s.current&&ZH(n,s.current,g.customBackground,g.borderColor,g.borderWidth),s.current||(c=!0)}var v=setInterval(function(){c&&(c=!1,p())},1e3/8);f(t.events.canvas3d.settingsUpdated,function(){return c=!0}),f((l=t.canvas3d)===null||l===void 0?void 0:l.didDraw,function(){return c=!0}),f(t.state.data.behaviors.isUpdating,function(g){g||(c=!0)}),f(n.behaviors.values,function(){return c=!0}),f(n.behaviors.cropParams,function(){return c=!0});var h=void 0;typeof ResizeObserver<"u"&&(h=new ResizeObserver(function(){return c=!0}));var m=s.current;return h==null||h.observe(m),p(),function(){clearInterval(v),d.forEach(function(g){return g.unsubscribe()}),h==null||h.unobserve(m)}},[n]),_e.useLayoutEffect(function(){s.current&&ZH(n,s.current,e.customBackground,e.borderColor,e.borderWidth)},Nt([],Object.values(e))),P.jsx(P.Fragment,{children:P.jsxs("div",E({style:{position:"relative",width:"100%",height:"100%"}},{children:[P.jsx("canvas",{ref:s,onContextMenu:function(l){l.preventDefault(),l.stopPropagation()},style:{display:"block",width:"100%",height:"100%"}},void 0),P.jsx($ot,{plugin:t,canvas:a,color:r},void 0)]}),void 0)},void 0)},qot=_e.memo(Got,function(e,t){return rL(e,t)});function ZH(e,t,r,n,i){var a=e.getPreview(),o=a.canvas,s=a.width,u=a.height,l=t.getContext("2d");if(l){var c=t.clientWidth,d=t.clientHeight;t.width=c,t.height=d,l.clearRect(0,0,c,d);var f=Hie(s,u,c,d);if(r)l.fillStyle=r,l.fillRect(f.x,f.y,f.width,f.height);else if(e.values.transparent)for(var p=13,v=0;v<f.width;v+=p)for(var h=0;h<f.height;h+=p){l.fillStyle=(v+h)%2?"#ffffff":"#bfbfbf";var m=f.x+v,g=f.y+h,y=v+p>f.width?f.width-v:p,b=h+p>f.height?f.height-h:p;l.fillRect(m,g,y,b)}if(l.drawImage(o,f.x,f.y,f.width,f.height),n&&i){var S=i;l.rect(f.x,f.y,f.width,f.height),l.rect(f.x+S,f.y+S,f.width-2*S,f.height-2*S),l.fillStyle=n,l.fill("evenodd")}}}function $ot(e){var t,r=e.plugin,n=e.canvas,i=e.color,a=i===void 0?"rgba(255, 87, 45, 0.75)":i,o=r.helpers.viewportScreenshot,s=Th(o==null?void 0:o.behaviors.values),u=Th(o==null?void 0:o.behaviors.cropParams),l=Th(o==null?void 0:o.behaviors.relativeCrop),c=_e.useRef({x:0,y:0,width:0,height:0});Th((s==null?void 0:s.resolution.name)==="viewport"?(t=r.canvas3d)===null||t===void 0?void 0:t.resized:void 0);var d=_e.useState(""),f=d[0],p=d[1],v=_e.useState([0,0]),h=v[0],m=v[1],g=_e.useState([0,0]),y=g[0],b=g[1];if(!o||!n)return null;var S=o.getSizeAndViewport(),x=S.width,C=S.height,w=Hie(x,C,n.clientWidth,n.clientHeight),A={x:w.x+Math.floor(w.width*l.x),y:w.y+Math.floor(w.height*l.y),width:Math.ceil(w.width*l.width),height:Math.ceil(w.height*l.height)},M=JH(A),D=JH(w);if(f==="move"?(M.l+=y[0]-h[0],M.r+=y[0]-h[0],M.t+=y[1]-h[1],M.b+=y[1]-h[1]):f&&(f.indexOf("left")>=0?M.l+=y[0]-h[0]:f.indexOf("right")>=0&&(M.r+=y[0]-h[0]),f.indexOf("top")>=0?M.t+=y[1]-h[1]:f.indexOf("bottom")>=0&&(M.b+=y[1]-h[1])),M.l>M.r){var k=M.l;M.l=M.r,M.r=k}if(M.t>M.b){var k=M.t;M.t=M.b,M.b=k}var R=40;M.l=Math.min(D.r-R,Math.max(D.l,M.l)),M.r=Math.max(D.l+R,Math.min(D.r,M.r)),M.t=Math.min(D.b-R,Math.max(D.t,M.t)),M.b=Math.max(D.t+R,Math.min(D.b,M.b)),A.x=M.l,A.y=M.t,A.width=M.r-M.l+1,A.height=M.b-M.t+1,c.current=A;var O=function(X){X.preventDefault(),b([X.pageX,X.pageY])},H=function(X){X.preventDefault();var U=X.touches[0];b([U.pageX,U.pageY])},B=function(X){X.preventDefault(),p(X.currentTarget.getAttribute("data-drag"));var U=X.touches[0],z=[U.pageX,U.pageY];m(z),b(z),window.addEventListener("touchend",G),window.addEventListener("touchmove",H)},j=function(X){X.preventDefault(),p(X.currentTarget.getAttribute("data-drag"));var U=[X.pageX,X.pageY];m(U),b(U),window.addEventListener("mouseup",Y),window.addEventListener("mousemove",O)},Y=function(){window.removeEventListener("mouseup",Y),window.removeEventListener("mousemove",O),$()},G=function(){window.removeEventListener("touchend",G),window.removeEventListener("touchmove",H),$()};function $(){var X=c.current;u.auto&&(o==null||o.behaviors.cropParams.next(E(E({},u),{auto:!1}))),o==null||o.behaviors.relativeCrop.next({x:(X.x-w.x)/w.width,y:(X.y-w.y)/w.height,width:X.width/w.width,height:X.height/w.height}),p("");var U=[0,0];m(U),b(U)}var q=function(X){X.preventDefault(),X.stopPropagation()},ee=4,fe="3px solid "+a,W="transparent";return P.jsxs(P.Fragment,{children:[P.jsx("div",{"data-drag":"move",style:{position:"absolute",left:A.x,top:A.y,width:A.width,height:A.height,border:fe,cursor:"move"},onMouseDown:j,onTouchStart:B,draggable:!1,onContextMenu:q},void 0),P.jsx("div",{"data-drag":"left",style:{position:"absolute",left:A.x-ee,top:A.y+ee,width:4*ee,height:A.height-ee,background:W,cursor:"w-resize"},onMouseDown:j,onTouchStart:B,draggable:!1,onContextMenu:q},void 0),P.jsx("div",{"data-drag":"right",style:{position:"absolute",left:M.r-2*ee,top:A.y,width:4*ee,height:A.height-ee,background:W,cursor:"w-resize"},onMouseDown:j,onTouchStart:B,draggable:!1,onContextMenu:q},void 0),P.jsx("div",{"data-drag":"top",style:{position:"absolute",left:A.x-ee,top:A.y-ee,width:A.width+2*ee,height:4*ee,background:W,cursor:"n-resize"},onMouseDown:j,onTouchStart:B,draggable:!1,onContextMenu:q},void 0),P.jsx("div",{"data-drag":"bottom",style:{position:"absolute",left:A.x-ee,top:M.b-2*ee,width:A.width+2*ee,height:4*ee,background:W,cursor:"n-resize"},onMouseDown:j,onTouchStart:B,draggable:!1,onContextMenu:q},void 0),P.jsx("div",{"data-drag":"top, left",style:{position:"absolute",left:M.l-ee,top:M.t-ee,width:4*ee,height:4*ee,background:W,cursor:"nw-resize"},onMouseDown:j,onTouchStart:B,draggable:!1,onContextMenu:q},void 0),P.jsx("div",{"data-drag":"bottom, right",style:{position:"absolute",left:M.r-2*ee,top:M.b-2*ee,width:4*ee,height:4*ee,background:W,cursor:"nw-resize"},onMouseDown:j,onTouchStart:B,draggable:!1,onContextMenu:q},void 0),P.jsx("div",{"data-drag":"top, right",style:{position:"absolute",left:M.r-2*ee,top:M.t-ee,width:4*ee,height:4*ee,background:W,cursor:"ne-resize"},onMouseDown:j,onTouchStart:B,draggable:!1,onContextMenu:q},void 0),P.jsx("div",{"data-drag":"bottom, left",style:{position:"absolute",left:M.l-ee,top:M.b-2*ee,width:4*ee,height:4*ee,background:W,cursor:"ne-resize"},onMouseDown:j,onTouchStart:B,draggable:!1,onContextMenu:q},void 0)]},void 0)}function JH(e){return{l:e.x,t:e.y,r:e.x+e.width-1,b:e.y+e.height-1}}function Hie(e,t,r,n){var i=e/t,a=r/n;if(i<=a){var o=n*i;return{x:Math.round((r-o)/2),y:0,width:Math.round(o),height:n}}else{var o=r/i;return{x:0,y:Math.round((n-o)/2),width:r,height:Math.round(o)}}}var Wot=function(e){Fe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={showPreview:!0,isDisabled:!1},r.download=function(){var n;(n=r.plugin.helpers.viewportScreenshot)===null||n===void 0||n.download(),r.props.close()},r.copy=function(){return ce(r,void 0,void 0,function(){var n;return de(this,function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,(n=this.plugin.helpers.viewportScreenshot)===null||n===void 0?void 0:n.copyToClipboard()];case 1:return i.sent(),_t.Toast.Show(this.plugin,{message:"Copied to clipboard.",title:"Screenshot",timeoutMs:1500}),[3,3];case 2:return i.sent(),[2,this.copyImg()];case 3:return[2]}})})},r.copyImg=function(){return ce(r,void 0,void 0,function(){var n,i;return de(this,function(a){switch(a.label){case 0:return[4,(i=this.plugin.helpers.viewportScreenshot)===null||i===void 0?void 0:i.getImageDataUri()];case 1:return n=a.sent(),this.setState({imageData:n}),[2]}})})},r.open=function(n){!n.target.files||!n.target.files[0]||_t.State.Snapshots.OpenFile(r.plugin,{file:n.target.files[0]})},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.state.data.behaviors.isUpdating,function(n){r.setState({isDisabled:n})})},t.prototype.componentWillUnmount=function(){this.setState({imageData:void 0})},t.prototype.render=function(){var r=this,n,i=!!(!((n=navigator.clipboard)===null||n===void 0)&&n.write);return P.jsxs("div",{children:[this.state.showPreview&&P.jsxs("div",E({className:"msp-image-preview"},{children:[P.jsx(qot,{plugin:this.plugin},void 0),P.jsx(Yot,{plugin:this.plugin},void 0)]}),void 0),P.jsxs("div",E({className:"msp-flex-row"},{children:[!this.state.imageData&&P.jsx(mr,E({icon:_Me,onClick:i?this.copy:this.copyImg,disabled:this.state.isDisabled},{children:"Copy"}),void 0),this.state.imageData&&P.jsx(mr,E({onClick:function(){return r.setState({imageData:void 0})},disabled:this.state.isDisabled},{children:"Clear"}),void 0),P.jsx(mr,E({icon:k5,onClick:this.download,disabled:this.state.isDisabled},{children:"Download"}),void 0)]}),void 0),this.state.imageData&&P.jsxs("div",E({className:"msp-row msp-copy-image-wrapper"},{children:[P.jsx("div",{children:"Right click below + Copy Image"},void 0),P.jsx("img",{src:this.state.imageData,style:{width:"100%",height:32,display:"block"}},void 0)]}),void 0),P.jsx(Xot,{plugin:this.plugin,isDisabled:this.state.isDisabled},void 0),P.jsxs(Uu,E({header:"State"},{children:[P.jsx(Lie,{onAction:this.props.close},void 0),P.jsx(Uu,E({header:"Save Options",initiallyExpanded:!1,noOffset:!0},{children:P.jsx(Fie,{},void 0)}),void 0)]}),void 0)]},void 0)},t}(gr);function Xot(e){var t=e.plugin,r=e.isDisabled,n=t.helpers.viewportScreenshot,i=Th(n.behaviors.values);return P.jsx(Un,{params:n.params,values:i,onChangeValues:function(a){return n.behaviors.values.next(a)},isDisabled:r},void 0)}function Yot(e){var t=e.plugin,r=t.helpers.viewportScreenshot,n=Th(r==null?void 0:r.behaviors.cropParams);return Th(r==null?void 0:r.behaviors.relativeCrop),r?P.jsxs("div",E({style:{width:"100%",height:"24px",marginTop:"8px"}},{children:[P.jsx(Ri,{icon:IMe,title:"Auto-crop",inline:!0,isSelected:n.auto,style:{background:"transparent",float:"left",width:"auto",height:"24px",lineHeight:"24px"},toggle:function(){return r.toggleAutocrop()},label:"Auto-crop "+(n.auto?"On":"Off")},void 0),!n.auto&&P.jsx(mr,{icon:EMe,title:"Crop",style:{background:"transparent",float:"right",height:"24px",lineHeight:"24px",width:"24px",padding:"0"},onClick:function(){return r.autocrop()}},void 0),!n.auto&&!r.isFullFrame&&P.jsx(mr,{icon:PMe,title:"Reset Crop",style:{background:"transparent",float:"right",height:"24px",lineHeight:"24px",width:"24px",padding:"0"},onClick:function(){return r.resetCrop()}},void 0)]}),void 0):null}function Kot(e){return function(t){var r=t.values,n=t.update,i=t.apply;return{params:typeof e.params=="function"?e.params:function(a){return e.params},getTarget:e.target,getValues:r,update:function(a,o){var s=e.target(o);return cv(s,function(u){return n(a,u,o)})},apply:i||function(){}}}}var Qot=function(e){Fe(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.events.canvas3d.settingsUpdated,function(){return r.forceUpdate()}),this.subscribe(this.plugin.canvas3d.camera.stateChanged,function(n){(n.radiusMax!==void 0||n.radius!==void 0)&&r.forceUpdate()})},t.prototype.render=function(){return this.plugin.canvas3d?P.jsxs(P.Fragment,{children:[P.jsx(Ert,{mapping:Jot},void 0),P.jsx(TF,{},void 0)]},void 0):null},t}(gr),oC={sequence:"Sequence",log:"Log",left:"Left Panel"},Zot={spin:I.Group({spin:Ts.trackball.params.spin,speed:Ts.trackball.params.spinSpeed},{pivot:"spin"}),camera:Ts.camera,background:I.Group({color:I.Color(at(16579577),{label:"Background",description:"Custom background color"}),transparent:I.Boolean(!1)},{pivot:"color"}),lighting:I.Group({renderStyle:Ts.renderer.params.style,occlusion:Ts.postprocessing.params.occlusion,outline:Ts.postprocessing.params.outline,fog:Ts.cameraFog},{pivot:"renderStyle"}),clipping:I.Group(E(E({},Ts.cameraClipping.params),Ts.renderer.params.clip.params),{pivot:"radius"}),layout:I.MultiSelect([],I.objectToOptions(oC))},Jot=Kot({params:function(e){var t,r=I.clone(Zot),n=(t=e.spec.components)===null||t===void 0?void 0:t.controls;if(n){var i=[];n.top!=="none"&&i.push(["sequence",oC.sequence]),n.bottom!=="none"&&i.push(["log",oC.log]),n.left!=="none"&&i.push(["left",oC.left]),r.layout.options=i}return r},target:function(e){var t,r,n=(t=e.spec.components)===null||t===void 0?void 0:t.controls,i=e.layout.state.regionState,a=[];return i.top!=="hidden"&&(!n||n.top!=="none")&&a.push("sequence"),i.bottom!=="hidden"&&(!n||n.bottom!=="none")&&a.push("log"),i.left!=="hidden"&&(!n||n.left!=="none")&&a.push("left"),{canvas:(r=e.canvas3d)===null||r===void 0?void 0:r.props,layout:a}}})({values:function(e,t){var r=e.canvas,n=r.renderer;return{layout:e.layout,spin:{spin:!!r.trackball.spin,speed:r.trackball.spinSpeed},camera:r.camera,background:{color:n.backgroundColor,transparent:r.transparentBackground},lighting:{renderStyle:n.style,occlusion:r.postprocessing.occlusion,outline:r.postprocessing.outline,fog:r.cameraFog},clipping:E(E({},r.cameraClipping),r.renderer.clip)}},update:function(e,t){var r=t.canvas;r.trackball.spin=e.spin.spin,r.trackball.spinSpeed=e.spin.speed,r.camera=e.camera,r.transparentBackground=e.background.transparent,r.renderer.backgroundColor=e.background.color,r.renderer.style=e.lighting.renderStyle,r.postprocessing.occlusion=e.lighting.occlusion,r.postprocessing.outline=e.lighting.outline,r.cameraFog=e.lighting.fog,r.cameraClipping={radius:e.clipping.radius,far:e.clipping.far},r.renderer.clip={variant:e.clipping.variant,objects:e.clipping.objects},t.layout=e.layout},apply:function(e,t){return ce(this,void 0,void 0,function(){var r,n;return de(this,function(i){switch(i.label){case 0:return[4,_t.Canvas3D.SetSettings(t,{settings:e.canvas})];case 1:return i.sent(),r=e.layout.indexOf("left")<0,n=cv(t.layout.state,function(a){a.regionState.top=e.layout.indexOf("sequence")>=0?"full":"hidden",a.regionState.bottom=e.layout.indexOf("log")>=0?"full":"hidden",a.regionState.left=r?"hidden":t.behaviors.layout.leftPanelTabName.value==="none"?"collapsed":"full"}),[4,_t.Layout.Update(t,{state:n})];case 2:return i.sent(),r&&_t.State.SetCurrentObject(t,{state:t.state.data,ref:cr.RootRef}),[2]}})})}}),est=function(e){Fe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.allCollapsedState={isSettingsExpanded:!1,isScreenshotExpanded:!1},r.state=E({},r.allCollapsedState),r.resetCamera=function(){_t.Camera.Reset(r.plugin,{})},r.toggleSettingsExpanded=r.toggle("isSettingsExpanded"),r.toggleScreenshotExpanded=r.toggle("isScreenshotExpanded"),r.toggleControls=function(){_t.Layout.Update(r.plugin,{state:{showControls:!r.plugin.layout.state.showControls}})},r.toggleExpanded=function(){_t.Layout.Update(r.plugin,{state:{isExpanded:!r.plugin.layout.state.isExpanded}})},r.setSettings=function(n){var i;_t.Canvas3D.SetSettings(r.plugin,{settings:(i={},i[n.name]=n.value,i)})},r.setLayout=function(n){var i;_t.Layout.Update(r.plugin,{state:(i={},i[n.name]=n.value,i)})},r.screenshot=function(){var n;(n=r.plugin.helpers.viewportScreenshot)===null||n===void 0||n.download()},r.onMouseMove=function(n){n.buttons===0&&n.stopPropagation()},r}return t.prototype.toggle=function(r){var n=this;return function(i){var a;n.setState(E(E({},n.allCollapsedState),(a={},a[r]=!n.state[r],a))),i==null||i.currentTarget.blur()}},t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.events.canvas3d.settingsUpdated,function(){return r.forceUpdate()}),this.subscribe(this.plugin.layout.events.updated,function(){return r.forceUpdate()})},t.prototype.icon=function(r,n,i,a){return a===void 0&&(a=!0),P.jsx(Ht,{svg:r,toggleState:a,onClick:n,title:i,style:{background:"transparent"}},void 0)},t.prototype.render=function(){return P.jsxs("div",E({className:"msp-viewport-controls",onMouseMove:this.onMouseMove},{children:[P.jsxs("div",E({className:"msp-viewport-controls-buttons"},{children:[P.jsxs("div",{children:[P.jsx("div",{className:"msp-semi-transparent-background"},void 0),this.icon(JIe,this.resetCamera,"Reset Camera")]},void 0),P.jsxs("div",{children:[P.jsx("div",{className:"msp-semi-transparent-background"},void 0),this.icon(uMe,this.toggleScreenshotExpanded,"Screenshot / State Snapshot",this.state.isScreenshotExpanded)]},void 0),P.jsxs("div",{children:[P.jsx("div",{className:"msp-semi-transparent-background"},void 0),this.plugin.config.get(Yr.Viewport.ShowControls)&&this.icon(iMe,this.toggleControls,"Toggle Controls Panel",this.plugin.layout.state.showControls),this.plugin.config.get(Yr.Viewport.ShowExpand)&&this.icon(LMe,this.toggleExpanded,"Toggle Expanded Viewport",this.plugin.layout.state.isExpanded),this.plugin.config.get(Yr.Viewport.ShowSettings)&&this.icon(uv,this.toggleSettingsExpanded,"Settings / Controls Info",this.state.isSettingsExpanded)]},void 0),this.plugin.config.get(Yr.Viewport.ShowSelectionMode)&&P.jsxs("div",{children:[P.jsx("div",{className:"msp-semi-transparent-background"},void 0),P.jsx(Tw,{},void 0)]},void 0)]}),void 0),this.state.isScreenshotExpanded&&P.jsx("div",E({className:"msp-viewport-controls-panel"},{children:P.jsx(Pc,E({header:"Screenshot / State",title:"Click to close.",initialExpanded:!0,hideExpander:!0,hideOffset:!0,onHeaderClick:this.toggleScreenshotExpanded,topRightIcon:Ac,noTopMargin:!0,childrenClassName:"msp-viewport-controls-panel-controls"},{children:P.jsx(Wot,{close:this.toggleScreenshotExpanded},void 0)}),void 0)}),void 0),this.state.isSettingsExpanded&&P.jsx("div",E({className:"msp-viewport-controls-panel"},{children:P.jsx(Pc,E({header:"Settings / Controls Info",title:"Click to close.",initialExpanded:!0,hideExpander:!0,hideOffset:!0,onHeaderClick:this.toggleSettingsExpanded,topRightIcon:Ac,noTopMargin:!0,childrenClassName:"msp-viewport-controls-panel-controls"},{children:P.jsx(Qot,{},void 0)}),void 0)}),void 0)]}),void 0)},t}(gr),tst=function(){return P.jsx("a",{className:"msp-logo",href:"https://molstar.org",target:"_blank"},void 0)},rst=function(){return P.jsx(Hot,{logo:tst},void 0)},nst=function(e){Fe(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.region=function(r,n){return P.jsx("div",E({className:"msp-layout-region msp-layout-"+r},{children:P.jsx("div",E({className:"msp-layout-static"},{children:n}),void 0)}),void 0)},t.prototype.render=function(){return P.jsx(dE.Provider,E({value:this.props.plugin},{children:P.jsx(ist,{},void 0)}),void 0)},t}(_e.Component);(function(e){Fe(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.render=function(){return P.jsx(dE.Provider,E({value:this.props.plugin},{children:P.jsx("div",E({className:"msp-plugin"},{children:this.props.children}),void 0)}),void 0)},t})(_e.Component);var ist=function(e){Fe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.onDrop=function(n){n.preventDefault();var i;if(n.dataTransfer.items){for(var a=0;a<n.dataTransfer.items.length;a++)if(n.dataTransfer.items[a].kind==="file"){i=n.dataTransfer.items[a].getAsFile();break}}else i=n.dataTransfer.files[0];if(i){var o=(i==null?void 0:i.name.toLowerCase())||"";(o.endsWith("molx")||o.endsWith("molj"))&&_t.State.Snapshots.OpenFile(r.plugin,{file:i})}},r.onDragOver=function(n){n.preventDefault()},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.layout.events.updated,function(){return r.forceUpdate()})},t.prototype.region=function(r,n){return P.jsx("div",E({className:"msp-layout-region msp-layout-"+r},{children:P.jsx("div",E({className:"msp-layout-static"},{children:n?P.jsx(n,{},void 0):null}),void 0)}),void 0)},Object.defineProperty(t.prototype,"layoutVisibilityClassName",{get:function(){var r,n,i=this.plugin.layout.state,a=(n=(r=this.plugin.spec.components)===null||r===void 0?void 0:r.controls)!==null&&n!==void 0?n:{},o=[];return(a.top==="none"||!i.showControls||i.regionState.top==="hidden")&&o.push("msp-layout-hide-top"),a.left==="none"||!i.showControls||i.regionState.left==="hidden"?o.push("msp-layout-hide-left"):i.regionState.left==="collapsed"&&o.push("msp-layout-collapse-left"),(a.right==="none"||!i.showControls||i.regionState.right==="hidden")&&o.push("msp-layout-hide-right"),(a.bottom==="none"||!i.showControls||i.regionState.bottom==="hidden")&&o.push("msp-layout-hide-bottom"),o.join(" ")},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"layoutClassName",{get:function(){var r=this.plugin.layout.state,n=["msp-plugin-content"];return r.isExpanded?n.push("msp-layout-expanded"):n.push("msp-layout-standard","msp-layout-standard-"+r.controlsDisplay),n.join(" ")},enumerable:!1,configurable:!0}),t.prototype.render=function(){var r,n,i,a,o=this.plugin.layout.state,s=((r=this.plugin.spec.components)===null||r===void 0?void 0:r.controls)||{},u=((i=(n=this.plugin.spec.components)===null||n===void 0?void 0:n.viewport)===null||i===void 0?void 0:i.view)||ost;return P.jsx("div",E({className:"msp-plugin",onDrop:this.onDrop,onDragOver:this.onDragOver},{children:P.jsxs("div",E({className:this.layoutClassName},{children:[P.jsxs("div",E({className:this.layoutVisibilityClassName},{children:[this.region("main",u),o.showControls&&s.top!=="none"&&this.region("top",s.top||Not),o.showControls&&s.left!=="none"&&this.region("left",s.left||Aot),o.showControls&&s.right!=="none"&&this.region("right",s.right||ast),o.showControls&&s.bottom!=="none"&&this.region("bottom",s.bottom||sst)]}),void 0),!(!((a=this.plugin.spec.components)===null||a===void 0)&&a.hideTaskOverlay)&&P.jsx(jot,{},void 0)]}),void 0)}),void 0)},t}(gr),ast=function(e){Fe(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.render=function(){var r,n=((r=this.plugin.spec.components)===null||r===void 0?void 0:r.structureTools)||fot;return P.jsx("div",E({className:"msp-scrollable-container"},{children:P.jsx(n,{},void 0)}),void 0)},t}(gr),ost=function(e){Fe(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.render=function(){var r,n,i=((n=(r=this.plugin.spec.components)===null||r===void 0?void 0:r.viewport)===null||n===void 0?void 0:n.controls)||est;return P.jsxs(P.Fragment,{children:[P.jsx(rst,{},void 0),P.jsxs("div",E({className:"msp-viewport-top-left-controls"},{children:[P.jsx(uot,{},void 0),P.jsx(oot,{},void 0),P.jsx(sot,{},void 0)]}),void 0),P.jsx(lot,{},void 0),P.jsx(i,{},void 0),P.jsx(Uot,{},void 0),P.jsxs("div",E({className:"msp-highlight-toast-wrapper"},{children:[P.jsx(cot,{},void 0),P.jsx(Vot,{},void 0)]}),void 0)]},void 0)},t}(gr),sst=function(e){Fe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.wrapper=_e.createRef(),r.state={entries:r.plugin.log.entries},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.events.log,function(){return r.setState({entries:r.plugin.log.entries})})},t.prototype.componentDidUpdate=function(){this.scrollToBottom()},t.prototype.scrollToBottom=function(){var r=this.wrapper.current;r&&(r.scrollTop=r.scrollHeight-r.clientHeight-1)},t.prototype.render=function(){for(var r=10,n=this.state.entries,i=n.size,a=[],o=Math.max(0,i-r),s=0;o<i;o++){var u=n.get(o);a.push(P.jsxs("li",{children:[P.jsx("div",{className:"msp-log-entry-badge msp-log-entry-"+u.type},void 0),P.jsx("div",E({className:"msp-log-timestamp"},{children:w4e(u.timestamp)}),void 0),P.jsx("div",E({className:"msp-log-entry"},{children:u.message}),void 0)]},s++))}return P.jsx("div",E({ref:this.wrapper,className:"msp-log",style:{position:"absolute",top:"0",right:"0",bottom:"0",left:"0",overflowY:"auto"}},{children:P.jsx("ul",E({className:"msp-list-unstyled"},{children:a}),void 0)}),void 0)},t}(gr);function ust(e,t,r,n){n===void 0&&(n=1),e.width=Math.round(window.devicePixelRatio*n*t),e.height=Math.round(window.devicePixelRatio*n*r),Object.assign(e.style,{width:t+"px",height:r+"px"})}function lst(e,t,r){r===void 0&&(r=1);var n=window.innerWidth,i=window.innerHeight;t!==document.body&&(n=t.offsetWidth,i=t.offsetHeight),ust(e,n,i,r)}function cst(e,t,r,n){for(var i=atob(e.toDataURL(r,n).split(",")[1]),a=i.length,o=a>>2,s=new Uint8Array(a),u=new Uint32Array(s.buffer,0,o),l=0,c=0;c<o;++c)u[c]=i.charCodeAt(l++)|i.charCodeAt(l++)<<8|i.charCodeAt(l++)<<16|i.charCodeAt(l++)<<24;for(var d=a&3;d--;)s[l]=i.charCodeAt(l++);t(new Blob([s],{type:r||"image/png"}))}function eG(e,t,r){return ce(this,void 0,void 0,function(){return de(this,function(n){return[2,new Promise(function(i,a){var o=function(s){s?i(s):a("no blob returned")};HTMLCanvasElement.prototype.toBlob?e.toBlob(o,t,r):cst(e,o,t,r)})]})})}var Nw;(function(e){var t=function(){function r(){this.providers=si.OrderedMap().asMutable(),this.defaultAutoAttachValues=new Map}return r.prototype.getParams=function(n){var i={},a=[],o=[];if(n)for(var s=this.providers.values();;){var u=s.next();if(u.done)break;var l=u.value;l.isApplicable(n)&&(l.isHidden||(a.push([l.descriptor.name,l.label]),this.defaultAutoAttachValues.get(l.descriptor.name)&&o.push(l.descriptor.name)),i[l.descriptor.name]=I.Group(E({},l.getParams(n)),{label:l.label,isHidden:l.isHidden}))}return{autoAttach:I.MultiSelect(o,a),properties:I.Group(i,{isFlat:!0})}},r.prototype.setDefaultAutoAttach=function(n,i){this.defaultAutoAttachValues.set(n,i)},r.prototype.get=function(n){var i=this.providers.get(n);if(!i)throw new Error("Custom property '"+n+"' is not registered.");return this.providers.get(n)},r.prototype.register=function(n,i){this.providers.set(n.descriptor.name,n),this.defaultAutoAttachValues.set(n.descriptor.name,i)},r.prototype.unregister=function(n){this.providers.delete(n),this.defaultAutoAttachValues.delete(n)},r}();e.Registry=t})(Nw||(Nw={}));var dst=["gz","zip"],fst=["bcif","ccp4","dcd"];function HF(e){var t,r,n="";e instanceof File?t=e.name:e instanceof Blob?t="":t=e;var i=t.lastIndexOf("?"),a=i!==-1?t.substring(i):"";t=t.substring(0,i===-1?t.length:i);var o=t.replace(/^.*[\\/]/,""),s=o.substring(0,o.lastIndexOf(".")),u=o.split("."),l=u.length>1?(u.pop()||"").toLowerCase():"",c=t.match(/^(.+):\/\/(.+)$/);c&&(n=c[1].toLowerCase(),t=c[2]||"");var d=t.substring(0,t.lastIndexOf("/")+1);if(dst.includes(l)){r=l;var f=t.length-l.length-1;l=(t.substr(0,f).split(".").pop()||"").toLowerCase();var p=s.length-l.length-1;s=s.substr(0,p)}else r=!1;var v=fst.includes(l);return{path:t,name:o,ext:l,base:s,dir:d,compressed:r,binary:v,protocol:n,query:a,src:e}}var pst=function(){function e(t){this.plugin=t}return Object.defineProperty(e.prototype,"dataState",{get:function(){return this.plugin.state.data},enumerable:!1,configurable:!0}),e.prototype.rawData=function(t,r){var n=this.dataState.build().toRoot().apply(pee,t,r);return n.commit({revertOnError:!0})},e.prototype.download=function(t,r){var n=this.dataState.build().toRoot().apply(dee,t,r);return n.commit({revertOnError:!0})},e.prototype.downloadBlob=function(t,r){var n=this.dataState.build().toRoot().apply(fee,t,r);return n.commit({revertOnError:!0})},e.prototype.readFile=function(t,r){var n;return ce(this,void 0,void 0,function(){var i,a;return de(this,function(o){switch(o.label){case 0:return[4,this.dataState.build().toRoot().apply(hee,t,r).commit({revertOnError:!0})];case 1:return i=o.sent(),a=HF(((n=t.file)===null||n===void 0?void 0:n.file)||""),[2,{data:i,fileInfo:a}]}})})},e}(),hst=function(){function e(t){var r=this;this.plugin=t,this._providers=[],this.providerMap=new Map,this.defaultProvider=xg.auto,ju(xg,function(n){return r.registerPreset(n)})}return Object.defineProperty(e.prototype,"dataState",{get:function(){return this.plugin.state.data},enumerable:!1,configurable:!0}),e.prototype.resolveProvider=function(t){var r;return typeof t=="string"?(r=xg[t])!==null&&r!==void 0?r:QO(this._providers,function(n){return n.id===t}):t},e.prototype.hasPreset=function(t){for(var r=0,n=this._providers;r<n.length;r++){var i=n[r];if(!i.isApplicable||i.isApplicable(t,this.plugin))return!0}return!1},Object.defineProperty(e.prototype,"providers",{get:function(){return this._providers},enumerable:!1,configurable:!0}),e.prototype.getPresets=function(t){if(!t)return this.providers;for(var r=[],n=0,i=this._providers;n<i.length;n++){var a=i[n];a.isApplicable&&!a.isApplicable(t,this.plugin)||r.push(a)}return r},e.prototype.getPresetSelect=function(t){for(var r=[],n=0,i=this._providers;n<i.length;n++){var a=i[n];t&&a.isApplicable&&!a.isApplicable(t,this.plugin)||r.push([a.id,a.display.name,a.display.group])}return I.Select("auto",r)},e.prototype.getPresetsWithOptions=function(t){for(var r=[],n=Object.create(null),i=0,a=this._providers;i<a.length;i++){var o=a[i];o.isApplicable&&!o.isApplicable(t,this.plugin)||(r.push([o.id,o.display.name]),n[o.id]=o.params?I.Group(o.params(t,this.plugin)):I.EmptyGroup())}return r.length===0?I.MappedStatic("",{"":I.EmptyGroup()}):I.MappedStatic(r[0][0],n,{options:r})},e.prototype.registerPreset=function(t){if(this.providerMap.has(t.id))throw new Error("Representation provider with id '"+t.id+"' already registered.");this._providers.push(t),this.providerMap.set(t.id,t)},e.prototype.unregisterPreset=function(t){this.providerMap.delete(t.id),mb(this._providers,t)},e.prototype.applyPreset=function(t,r,n){var i=this,a,o=this.resolveProvider(r);if(o){var s=this.plugin.state.data,u=Fi.resolveAndCheck(s,t);if(!u){y0||console.warn("Applying structure repr. provider to bad cell.");return}var l=((a=o.params)===null||a===void 0?void 0:a.call(o,u.obj,this.plugin))||{},c=n||(o.params?I.getDefaultValues(l):{}),d=this.plugin.config.get(Yr.Structure.DefaultRepresentationPresetParams);c=I.merge(l,d,c);var f=$e.create(""+o.display.name,function(){return o.apply(u,c,i.plugin)});return this.plugin.runTask(f)}},e.prototype.addRepresentation=function(t,r,n){return ce(this,void 0,void 0,function(){var i,a;return de(this,function(o){switch(o.label){case 0:return i=this.dataState.build(),a=this.buildRepresentation(i,t,r,n),a?[4,i.commit()]:[2];case 1:return o.sent(),[2,a]}})})},e.prototype.buildRepresentation=function(t,r,n,i){var a,o;if(r){var s=(o=(a=Fi.resolveAndCheck(this.dataState,r))===null||a===void 0?void 0:a.obj)===null||o===void 0?void 0:o.data;if(s){var u=nC(this.plugin,s,n);return i!=null&&i.tag?t.to(r).applyOrUpdateTagged(i.tag,cw,u,{state:i==null?void 0:i.initialState}).selector:t.to(r).apply(cw,u,{state:i==null?void 0:i.initialState}).selector}}},e}();function bp(e){return e}(function(e){e.CommonParams=function(t,r){return{modelProperties:I.Optional(I.Group(ft.getParamDefinition(rt.Model.CustomModelProperties,void 0,r))),structureProperties:I.Optional(I.Group(ft.getParamDefinition(rt.Model.CustomStructureProperties,void 0,r))),representationPreset:I.Optional(I.Text("auto"))}}})(bp||(bp={}));var oA=bp.CommonParams,vst=function(e,t){return E({model:I.Optional(I.Group(ft.getParamDefinition(rt.Model.ModelFromTrajectory,e,t))),showUnitcell:I.Optional(I.Boolean(!1)),structure:I.Optional(Hh.getParams(void 0,"assembly").type),representationPresetParams:I.Optional(I.Group(ao.CommonParams))},oA(e,t))},Gie=bp({id:"preset-trajectory-default",display:{name:"Default (Assembly)",group:"Preset",description:"Shows the first assembly or, if that is unavailable, the first model."},isApplicable:function(e){return!0},params:vst,apply:function(e,t,r){return ce(this,void 0,void 0,function(){var n,i,a,o,s,u,l,c;return de(this,function(d){switch(d.label){case 0:return n=r.builders.structure,[4,n.createModel(e,t.model)];case 1:return i=d.sent(),[4,n.insertModelProperties(i,t.modelProperties)];case 2:return a=d.sent(),[4,n.createStructure(a||i,t.structure)];case 3:return o=d.sent(),[4,n.insertStructureProperties(o,t.structureProperties)];case 4:return s=d.sent(),t.showUnitcell===void 0||t.showUnitcell?[4,n.tryCreateUnitcell(a,void 0,{isHidden:!0})]:[3,6];case 5:return l=d.sent(),[3,7];case 6:l=void 0,d.label=7;case 7:return u=l,[4,r.builders.structure.representation.applyPreset(s,t.representationPreset||"auto",t.representationPresetParams)];case 8:return c=d.sent(),[2,{model:i,modelProperties:a,unitcell:u,structure:o,structureProperties:s,representation:c}]}})})}}),mst=function(e,t){return E({useDefaultIfSingleModel:I.Optional(I.Boolean(!1)),representationPresetParams:I.Optional(I.Group(ao.CommonParams))},oA(e,t))},gst=bp({id:"preset-trajectory-all-models",display:{name:"All Models",group:"Preset",description:"Shows all models; colored by model-index."},isApplicable:function(e){return e.data.frameCount>1},params:mst,apply:function(e,t,r){var n,i;return ce(this,void 0,void 0,function(){var a,o,s,u,l,c,d,f,p,v;return de(this,function(h){switch(h.label){case 0:if(a=(i=(n=Fi.resolveAndCheck(r.state.data,e))===null||n===void 0?void 0:n.obj)===null||i===void 0?void 0:i.data,!a)return[2,{}];if(a.frameCount===1&&t.useDefaultIfSingleModel)return[2,Gie.apply(e,t,r)];o=r.builders.structure,s=[],u=[],l=0,h.label=1;case 1:return l<a.frameCount?[4,o.createModel(e,{modelIndex:l})]:[3,8];case 2:return c=h.sent(),[4,o.insertModelProperties(c,t.modelProperties,{isCollapsed:!0})];case 3:return d=h.sent(),[4,o.createStructure(d||c,{name:"model",params:{}})];case 4:return f=h.sent(),[4,o.insertStructureProperties(f,t.structureProperties)];case 5:return p=h.sent(),s.push(c),u.push(f),v=f.obj?ure(f.obj.data,{elementCountFactor:a.frameCount}):"medium",[4,o.representation.applyPreset(p,t.representationPreset||"auto",{theme:{globalName:"model-index"},quality:v})];case 6:h.sent(),h.label=7;case 7:return l++,[3,1];case 8:return[2,{models:s,structures:u}]}})})}}),qie=function(e,t){return E({model:I.Optional(I.Group(ft.getParamDefinition(rt.Model.ModelFromTrajectory,e,t)))},oA(e,t))};function $ie(e,t,r,n){return ce(this,void 0,void 0,function(){var i,a,o,s,u,l,c;return de(this,function(d){switch(d.label){case 0:return i=n.builders.structure,[4,i.createModel(t,r.model)];case 1:return a=d.sent(),[4,i.insertModelProperties(a,r.modelProperties)];case 2:return o=d.sent(),[4,i.createStructure(o||a,{name:"symmetry",params:e})];case 3:return s=d.sent(),[4,i.insertStructureProperties(s,r.structureProperties)];case 4:return u=d.sent(),[4,i.tryCreateUnitcell(o,void 0,{isHidden:!1})];case 5:return l=d.sent(),[4,n.builders.structure.representation.applyPreset(u,r.representationPreset||"auto",{theme:{globalName:e.theme}})];case 6:return c=d.sent(),[2,{model:a,modelProperties:o,unitcell:l,structure:s,structureProperties:u,representation:c}]}})})}var yst=bp({id:"preset-trajectory-unitcell",display:{name:"Unit Cell",group:"Preset",description:"Shows the fully populated unit cell."},isApplicable:function(e){return $t.hasCrystalSymmetry(e.data.representative)},params:qie,apply:function(e,t,r){return ce(this,void 0,void 0,function(){return de(this,function(n){switch(n.label){case 0:return[4,$ie({ijkMin:_.create(0,0,0),ijkMax:_.create(0,0,0)},e,t,r)];case 1:return[2,n.sent()]}})})}}),bst=bp({id:"preset-trajectory-supercell",display:{name:"Super Cell",group:"Preset",description:"Shows the super cell, i.e. the central unit cell and all adjacent unit cells."},isApplicable:function(e){return $t.hasCrystalSymmetry(e.data.representative)},params:qie,apply:function(e,t,r){return ce(this,void 0,void 0,function(){return de(this,function(n){switch(n.label){case 0:return[4,$ie({ijkMin:_.create(-1,-1,-1),ijkMax:_.create(1,1,1),theme:"operator-hkl"},e,t,r)];case 1:return[2,n.sent()]}})})}}),xst=function(e,t){return E({model:I.Optional(I.Group(ft.getParamDefinition(rt.Model.ModelFromTrajectory,e,t)))},oA(e,t))},Sst=bp({id:"preset-trajectory-crystal-contacts",display:{name:"Crystal Contacts",group:"Preset",description:"Showsasymetric unit and chains from neighbours within 5 , i.e., symmetry mates."},isApplicable:function(e){return $t.hasCrystalSymmetry(e.data.representative)},params:xst,apply:function(e,t,r){return ce(this,void 0,void 0,function(){var n,i,a,o,s,u,l;return de(this,function(c){switch(c.label){case 0:return n=r.builders.structure,[4,n.createModel(e,t.model)];case 1:return i=c.sent(),[4,n.insertModelProperties(i,t.modelProperties)];case 2:return a=c.sent(),[4,n.createStructure(a||i,{name:"symmetry-mates",params:{radius:5}})];case 3:return o=c.sent(),[4,n.insertStructureProperties(o,t.structureProperties)];case 4:return s=c.sent(),[4,n.tryCreateUnitcell(a,void 0,{isHidden:!0})];case 5:return u=c.sent(),[4,r.builders.structure.representation.applyPreset(s,t.representationPreset||"auto",{theme:{globalName:"operator-name",carbonColor:"operator-name",focus:{name:"element-symbol",params:{carbonColor:{name:"operator-name",params:QL.defaultValues}}}}})];case 6:return l=c.sent(),[2,{model:i,modelProperties:a,unitcell:u,structure:o,structureProperties:s,representation:l}]}})})}}),FT={default:Gie,"all-models":gst,unitcell:yst,supercell:bst,crystalContacts:Sst},Cst=function(){function e(t){var r=this;this.plugin=t,this._providers=[],this.providerMap=new Map,this.defaultProvider=FT.default,ju(FT,function(n){return r.registerPreset(n)})}return e.prototype.resolveProvider=function(t){var r;return typeof t=="string"?(r=FT[t])!==null&&r!==void 0?r:QO(this._providers,function(n){return n.id===t}):t},e.prototype.hasPreset=function(t){for(var r=0,n=this._providers;r<n.length;r++){var i=n[r];if(!i.isApplicable||i.isApplicable(t,this.plugin))return!0}return!1},Object.defineProperty(e.prototype,"providers",{get:function(){return this._providers},enumerable:!1,configurable:!0}),e.prototype.getPresets=function(t){if(!t)return this.providers;for(var r=[],n=0,i=this._providers;n<i.length;n++){var a=i[n];a.isApplicable&&!a.isApplicable(t,this.plugin)||r.push(a)}return r},e.prototype.getPresetSelect=function(t){for(var r=[],n=0,i=this._providers;n<i.length;n++){var a=i[n];t&&a.isApplicable&&!a.isApplicable(t,this.plugin)||r.push([a.id,a.display.name])}return I.Select("auto",r)},e.prototype.getPresetsWithOptions=function(t){for(var r=[],n=Object.create(null),i=0,a=this._providers;i<a.length;i++){var o=a[i];o.isApplicable&&!o.isApplicable(t,this.plugin)||(r.push([o.id,o.display.name]),n[o.id]=o.params?I.Group(o.params(t,this.plugin)):I.EmptyGroup())}return r.length===0?I.MappedStatic("",{"":I.EmptyGroup()}):I.MappedStatic(r[0][0],n,{options:r})},e.prototype.registerPreset=function(t){if(this.providerMap.has(t.id))throw new Error("Hierarchy provider with id '"+t.id+"' already registered.");this._providers.push(t),this.providerMap.set(t.id,t)},e.prototype.unregisterPreset=function(t){this.providerMap.delete(t.id),mb(this._providers,t)},e.prototype.applyPreset=function(t,r,n){var i=this,a=this.resolveProvider(r);if(a){var o=this.plugin.state.data,s=Fi.resolveAndCheck(o,t);if(!s){y0||console.warn("Applying hierarchy preset provider to bad cell.");return}var u=n||(a.params?I.getDefaultValues(a.params(s.obj,this.plugin)):{}),l=$e.create(""+a.display.name,function(){return a.apply(s,u,i.plugin)});return this.plugin.runTask(l)}},e}(),_st=function(){function e(t){this.plugin=t,this.hierarchy=new Cst(this.plugin),this.representation=new hst(this.plugin)}return Object.defineProperty(e.prototype,"dataState",{get:function(){return this.plugin.state.data},enumerable:!1,configurable:!0}),e.prototype.parseTrajectoryData=function(t,r){return ce(this,void 0,void 0,function(){var n,i;return de(this,function(a){switch(a.label){case 0:if(n=typeof r=="string"?this.plugin.dataFormats.get(r):r,!n)throw new Error("'"+r+"' is not a supported data format.");return[4,n.parse(this.plugin,t)];case 1:return i=a.sent().trajectory,[2,i]}})})},e.prototype.parseTrajectoryBlob=function(t,r){var n=this.dataState,i=n.build().to(t).apply(rt.Data.ParseBlob,r,{state:{isGhost:!0}}).apply(rt.Model.TrajectoryFromBlob,void 0);return i.commit({revertOnError:!0})},e.prototype.parseTrajectory=function(t,r){var n=Fi.resolveAndCheck(this.dataState,t);if(!n)throw new Error("Invalid data cell.");return ge.Data.Blob.is(n.obj)?this.parseTrajectoryBlob(t,r):this.parseTrajectoryData(t,r)},e.prototype.createModel=function(t,r,n){var i=this.dataState,a=i.build().to(t).apply(rt.Model.ModelFromTrajectory,r||{modelIndex:0},{state:n});return a.commit({revertOnError:!0})},e.prototype.insertModelProperties=function(t,r,n){var i=this.dataState,a=i.build().to(t).apply(rt.Model.CustomModelProperties,r,{state:n});return a.commit({revertOnError:!0})},e.prototype.tryCreateUnitcell=function(t,r,n){var i,a,o,s=this.dataState,u=(a=(i=Fi.resolveAndCheck(s,t))===null||i===void 0?void 0:i.obj)===null||a===void 0?void 0:a.data;if(u){var l=(o=fi.Provider.get(u))===null||o===void 0?void 0:o.spacegroup.cell;if(!Mo.isZero(l)){var c=s.build().to(t).apply(rt.Representation.ModelUnitcell3D,r,{state:n});return c.commit({revertOnError:!0})}}},e.prototype.createStructure=function(t,r,n){var i,a=this.dataState;if(!r){var o=Fi.resolveAndCheck(a,t);if(o){var s=fi.Provider.get((i=o.obj)===null||i===void 0?void 0:i.data);(!s||(s==null?void 0:s.assemblies.length)===0)&&(r={name:"model",params:{}})}}var u=a.build().to(t).apply(rt.Model.StructureFromModel,{type:r||{name:"assembly",params:{}}},{state:n});return u.commit({revertOnError:!0})},e.prototype.insertStructureProperties=function(t,r){var n=this.dataState,i=n.build().to(t).apply(rt.Model.CustomStructureProperties,r);return i.commit({revertOnError:!0})},e.prototype.isComponentTransform=function(t){return t.transform.transformer===rt.Model.StructureComponent},e.prototype.tryCreateComponent=function(t,r,n,i){var a,o;return ce(this,void 0,void 0,function(){var s,u,l,c,d;return de(this,function(f){switch(f.label){case 0:return s=this.dataState,u=s.build().to(t),l="structure-component-"+n,c=u.applyOrUpdateTagged(l,rt.Model.StructureComponent,r,{tags:i?Nt(Nt([],i),[l]):[l]}),[4,c.commit()];case 1:return f.sent(),d=c.selector,!d.isOk||((o=(a=d.cell)===null||a===void 0?void 0:a.obj)===null||o===void 0?void 0:o.data.elementCount)===0?[4,s.build().delete(d.ref).commit()]:[3,3];case 2:return f.sent(),[2];case 3:return[2,d]}})})},e.prototype.tryCreateComponentFromExpression=function(t,r,n,i){return this.tryCreateComponent(t,{type:{name:"expression",params:r},nullIfEmpty:!0,label:((i==null?void 0:i.label)||"").trim()},n,i==null?void 0:i.tags)},e.prototype.tryCreateComponentStatic=function(t,r,n){return this.tryCreateComponent(t,{type:{name:"static",params:r},nullIfEmpty:!0,label:((n==null?void 0:n.label)||"").trim()},"static-"+r,n==null?void 0:n.tags)},e.prototype.tryCreateComponentFromSelection=function(t,r,n,i){var a=this;return this.plugin.runTask($e.create("Query Component",function(o){return ce(a,void 0,void 0,function(){var s,u,l,c,d,f,p,v,h,m,g,y;return de(this,function(b){switch(b.label){case 0:return s=i||{},u=s.label,l=s.tags,u=(u||"").trim(),c=(y=(g=Fi.resolveAndCheck(this.dataState,t))===null||g===void 0?void 0:g.obj)===null||y===void 0?void 0:y.data,c?r.referencesCurrent?(h={},m={name:"bundle"},v=(p=rn).fromSelection,[4,r.getSelection(this.plugin,o,c)]):[3,2]:[2];case 1:return f=(h.type=(m.params=v.apply(p,[b.sent()]),m),h.nullIfEmpty=!0,h.label=u||r.label,h),[3,3];case 2:f={type:{name:"expression",params:r.expression},nullIfEmpty:!0,label:u||r.label},b.label=3;case 3:return d=f,r.ensureCustomProperties?[4,r.ensureCustomProperties({runtime:o,assetManager:this.plugin.managers.asset},c)]:[3,5];case 4:b.sent(),b.label=5;case 5:return[2,this.tryCreateComponent(t,d,n,l)]}})})}))},e}(),AR;(function(e){function t(r){var n=r.name;return{descriptor:r,get:function(i){return i._propertyData[n]},set:function(i,a){i.customProperties.add(r),i._propertyData[n]=a}}}e.create=t})(AR||(AR={}));var Bw;(function(e){e.Descriptor={name:"recommended_iso_value"},e.Provider=AR.create(e.Descriptor)})(Bw||(Bw={}));var S2="Volume";function C2(e,t){return ce(this,void 0,void 0,function(){var r,n=this;return de(this,function(i){return t?(r=t.entryId,!r||!r.toLowerCase().startsWith("emd")?[2]:[2,e.runTask($e.create("Try Set Recommended IsoValue",function(a){return ce(n,void 0,void 0,function(){var o;return de(this,function(s){switch(s.label){case 0:return s.trys.push([0,2,,3]),[4,yie(e,a,r)];case 1:return o=s.sent(),Bw.Provider.set(t,Ct.IsoValue.absolute(o)),[3,3];case 2:return s.sent(),[3,3];case 3:return[2]}})})}))]):[2]})})}function Wie(e){var t=Bw.Provider.get(e);if(t){if(t.kind==="relative")return t;var r=e.grid.stats;return ow.is(e.sourceData)&&(r={min:e.sourceData.data.volume_data_3d_info.min_source.value(0),max:e.sourceData.data.volume_data_3d_info.max_source.value(0),mean:e.sourceData.data.volume_data_3d_info.mean_source.value(0),sigma:e.sourceData.data.volume_data_3d_info.sigma_source.value(0)}),Ct.IsoValue.toRelative(t,r)}}function GF(e,t){return ce(this,void 0,void 0,function(){var r,n,i;return de(this,function(a){switch(a.label){case 0:return r={},n=t.volume.data&&Wie(t.volume.data),n&&(r.isoValue=n),i=e.build().to(t.volume).apply(rt.Representation.VolumeRepresentation3D,Cg(e,t.volume.data,{type:"isosurface",typeParams:r})),[4,i.commit()];case 1:return[2,[a.sent()]]}})})}var wst={label:"CCP4/MRC/MAP",description:"CCP4/MRC/MAP",category:S2,binaryExtensions:["ccp4","mrc","map"],parse:function(e,t,r){return ce(void 0,void 0,void 0,function(){var n,i;return de(this,function(a){switch(a.label){case 0:return n=e.build().to(t).apply(rt.Data.ParseCcp4,{},{state:{isGhost:!0}}),i=n.apply(rt.Volume.VolumeFromCcp4,{entryId:r==null?void 0:r.entryId}),[4,n.commit({revertOnError:!0})];case 1:return a.sent(),[4,C2(e,i.selector.data)];case 2:return a.sent(),[2,{format:n.selector,volume:i.selector}]}})})},visuals:GF},Est={label:"DSN6/BRIX",description:"DSN6/BRIX",category:S2,binaryExtensions:["dsn6","brix"],parse:function(e,t,r){return ce(void 0,void 0,void 0,function(){var n,i;return de(this,function(a){switch(a.label){case 0:return n=e.build().to(t).apply(rt.Data.ParseDsn6,{},{state:{isGhost:!0}}),i=n.apply(rt.Volume.VolumeFromDsn6,{entryId:r==null?void 0:r.entryId}),[4,n.commit({revertOnError:!0})];case 1:return a.sent(),[4,C2(e,i.selector.data)];case 2:return a.sent(),[2,{format:n.selector,volume:i.selector}]}})})},visuals:GF},Ast={label:"DX",description:"DX",category:S2,stringExtensions:["dx"],binaryExtensions:["dxbin"],parse:function(e,t,r){return ce(void 0,void 0,void 0,function(){var n,i;return de(this,function(a){switch(a.label){case 0:return n=e.build().to(t).apply(rt.Data.ParseDx,{},{state:{isGhost:!0}}),i=n.apply(rt.Volume.VolumeFromDx,{entryId:r==null?void 0:r.entryId}),[4,i.commit({revertOnError:!0})];case 1:return a.sent(),[4,C2(e,i.selector.data)];case 2:return a.sent(),[2,{volume:i.selector}]}})})},visuals:GF},Pst={label:"Cube",description:"Cube",category:S2,stringExtensions:["cub","cube"],parse:function(e,t,r){return ce(void 0,void 0,void 0,function(){var n,i,a;return de(this,function(o){switch(o.label){case 0:return n=e.build().to(t).apply(rt.Data.ParseCube,{},{state:{isGhost:!0}}),i=n.apply(rt.Volume.VolumeFromCube,{entryId:r==null?void 0:r.entryId}),a=n.apply(rt.Model.TrajectoryFromCube,void 0,{state:{isGhost:!0}}).apply(rt.Model.ModelFromTrajectory).apply(rt.Model.StructureFromModel),[4,n.commit({revertOnError:!0})];case 1:return o.sent(),[4,C2(e,i.selector.data)];case 2:return o.sent(),[2,{format:n.selector,volume:i.selector,structure:a.selector}]}})})},visuals:function(e,t){return ce(void 0,void 0,void 0,function(){var r,n,i,a,o,s,u,l,c,d;return de(this,function(f){switch(f.label){case 0:return r=e.build(),n=[],i=(d=(c=t.volume.cell)===null||c===void 0?void 0:c.obj)===null||d===void 0?void 0:d.data,i&&Ct.isOrbitals(i)?(a=r.to(t.volume).apply(rt.Representation.VolumeRepresentation3D,Cg(e,i,{type:"isosurface",typeParams:{isoValue:Ct.IsoValue.relative(1),alpha:.4},color:"uniform",colorParams:{value:fr.blue}})),o=r.to(t.volume).apply(rt.Representation.VolumeRepresentation3D,Cg(e,i,{type:"isosurface",typeParams:{isoValue:Ct.IsoValue.relative(-1),alpha:.4},color:"uniform",colorParams:{value:fr.red}})),n.push(a.selector,o.selector)):(s=r.to(t.volume).apply(rt.Representation.VolumeRepresentation3D,Cg(e,i,{type:"isosurface",typeParams:{isoValue:Ct.IsoValue.relative(2),alpha:.4},color:"uniform",colorParams:{value:fr.grey}})),n.push(s.selector)),[4,e.builders.structure.representation.applyPreset(t.structure,"auto")];case 1:return u=f.sent(),[4,r.commit()];case 2:return f.sent(),l=[],ju(u==null?void 0:u.representations,function(p){p&&l.push(p)}),[2,Nt(Nt([],n),l)]}})})}},Tst={label:"DensityServer CIF",description:"DensityServer CIF",category:S2,stringExtensions:["cif"],binaryExtensions:["bcif"],isApplicable:function(e,t){return xF(e,t)==="dscif"},parse:function(e,t,r){return ce(void 0,void 0,void 0,function(){var n,i,a,o,s,u,l,c,d,f,p,v;return de(this,function(h){switch(h.label){case 0:return[4,e.build().to(t).apply(rt.Data.ParseCif).commit()];case 1:if(n=h.sent(),i=e.build().to(n),a=n.obj.data.blocks.slice(1),a.length!==1&&a.length!==2)throw new Error("unknown number of blocks");for(o=[],s=0,u=0,l=a;u<l.length;u++)c=l[u],d=Array.isArray(r==null?void 0:r.entryId)?r==null?void 0:r.entryId[s]:r==null?void 0:r.entryId,o.push(i.apply(rt.Volume.VolumeFromDensityServerCif,{blockHeader:c.header,entryId:d}).selector),s++;return[4,i.commit()];case 2:h.sent(),f=0,p=o,h.label=3;case 3:return f<p.length?(v=p[f],[4,C2(e,v.data)]):[3,6];case 4:h.sent(),h.label=5;case 5:return f++,[3,3];case 6:return[2,{volumes:o}]}})})},visuals:function(e,t){return ce(void 0,void 0,void 0,function(){var r,n,i,a,o,s;return de(this,function(u){switch(u.label){case 0:return r=t.volumes,n=e.build(),i=[],r.length>0&&(a=r[0].data&&Wie(r[0].data)||Ct.IsoValue.relative(1.5),i[0]=n.to(r[0]).apply(rt.Representation.VolumeRepresentation3D,Bc.getDefaultParamsStatic(e,"isosurface",{isoValue:a,alpha:1},"uniform",{value:fr.teal})).selector),r.length>1&&(o=Bc.getDefaultParamsStatic(e,"isosurface",{isoValue:Ct.IsoValue.relative(3),alpha:.3},"uniform",{value:fr.green}),s=Bc.getDefaultParamsStatic(e,"isosurface",{isoValue:Ct.IsoValue.relative(-3),alpha:.3},"uniform",{value:fr.red}),i[i.length]=n.to(r[1]).apply(rt.Representation.VolumeRepresentation3D,o).selector,i[i.length]=n.to(r[1]).apply(rt.Representation.VolumeRepresentation3D,s).selector),[4,n.commit()];case 1:return u.sent(),[2,i]}})})}},Ist=[["ccp4",wst],["dsn6",Est],["cube",Pst],["dx",Ast],["dscif",Tst]],Mst="Shape",Dst={label:"PLY",description:"PLY",category:Mst,stringExtensions:["ply"],parse:function(e,t){return ce(void 0,void 0,void 0,function(){var r,n;return de(this,function(i){switch(i.label){case 0:return r=e.state.data.build().to(t).apply(rt.Data.ParsePly,{},{state:{isGhost:!0}}),n=r.apply(rt.Model.ShapeFromPly),[4,r.commit()];case 1:return i.sent(),[2,{format:r.selector,shape:n.selector}]}})})},visuals:function(e,t){var r=e.state.data.build().to(t.shape).apply(rt.Representation.ShapeRepresentation3D);return r.commit()}},Rst=[["ply",Dst]],qF="Structure",kst={label:"PSF",description:"PSF",category:qF,stringExtensions:["psf"],parse:function(e,t){return ce(void 0,void 0,void 0,function(){var r,n;return de(this,function(i){switch(i.label){case 0:return r=e.state.data.build().to(t).apply(rt.Data.ParsePsf,{},{state:{isGhost:!0}}),n=r.apply(rt.Model.TopologyFromPsf),[4,r.commit()];case 1:return i.sent(),[2,{format:r.selector,topology:n.selector}]}})})}},Ost={label:"DCD",description:"DCD",category:qF,binaryExtensions:["dcd"],parse:function(e,t){var r=e.state.data.build().to(t).apply(rt.Model.CoordinatesFromDcd);return r.commit()}},Lst={label:"XTC",description:"XTC",category:qF,binaryExtensions:["xtc"],parse:function(e,t){var r=e.state.data.build().to(t).apply(rt.Model.CoordinatesFromXtc);return r.commit()}},Fst=[["psf",kst],["dcd",Ost],["xtc",Lst]],Nst=function(){function e(){this._list=[],this._map=new Map,this._extensions=void 0,this._binaryExtensions=void 0,this._options=void 0;for(var t=0,r=Ist;t<r.length;t++){var n=r[t],i=n[0],a=n[1];this.add(i,a)}for(var o=0,s=Fst;o<s.length;o++){var u=s[o],i=u[0],a=u[1];this.add(i,a)}for(var l=0,c=Rst;l<c.length;l++){var d=c[l],i=d[0],a=d[1];this.add(i,a)}for(var f=0,p=eie;f<p.length;f++){var v=p[f],i=v[0],a=v[1];this.add(i,a)}}return Object.defineProperty(e.prototype,"types",{get:function(){return this._list.map(function(t){return[t.name,t.provider.label]})},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"extensions",{get:function(){if(this._extensions)return this._extensions;var t=new Set;return this._list.forEach(function(r){var n,i,a=r.provider;(n=a.stringExtensions)===null||n===void 0||n.forEach(function(o){return t.add(o)}),(i=a.binaryExtensions)===null||i===void 0||i.forEach(function(o){return t.add(o)})}),this._extensions=t,t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"binaryExtensions",{get:function(){if(this._binaryExtensions)return this._binaryExtensions;var t=new Set;return this._list.forEach(function(r){var n,i=r.provider;return(n=i.binaryExtensions)===null||n===void 0?void 0:n.forEach(function(a){return t.add(a)})}),this._binaryExtensions=t,t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"options",{get:function(){if(this._options)return this._options;var t=[];return this._list.forEach(function(r){var n=r.name,i=r.provider;return t.push([n,i.label,i.category||""])}),this._options=t,t},enumerable:!1,configurable:!0}),e.prototype._clear=function(){this._extensions=void 0,this._binaryExtensions=void 0,this._options=void 0},e.prototype.add=function(t,r){this._clear(),this._list.push({name:t,provider:r}),this._map.set(t,r)},e.prototype.remove=function(t){this._clear(),this._list.splice(this._list.findIndex(function(r){return r.name===t}),1),this._map.delete(t)},e.prototype.auto=function(t,r){for(var n=0,i=this.list.length;n<i;++n){var a=this._list[n].provider,o=!1;if((a.binaryExtensions&&a.binaryExtensions.indexOf(t.ext)>=0||a.stringExtensions&&a.stringExtensions.indexOf(t.ext)>=0)&&(o=!0),o&&(!a.isApplicable||a.isApplicable(t,r.data)))return a}},e.prototype.get=function(t){if(this._map.has(t))return this._map.get(t);throw new Error("unknown data format name '"+t+"'")},Object.defineProperty(e.prototype,"list",{get:function(){return this._list},enumerable:!1,configurable:!0}),e}(),Bst=function(e){Fe(t,e);function t(r){var n=e.call(this,{params:{current:""},animationState:"stopped"})||this;return n.context=r,n.map=new Map,n._animations=[],n.currentTime=0,n._params=void 0,n.events={updated:n.ev(),applied:n.ev()},n.isStopped=!0,n.isApplying=!1,n}return Object.defineProperty(t.prototype,"isEmpty",{get:function(){return this._animations.length===0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"current",{get:function(){return this._current},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"animations",{get:function(){return this._animations},enumerable:!1,configurable:!0}),t.prototype.triggerUpdate=function(){this.events.updated.next()},t.prototype.triggerApply=function(){this.events.applied.next()},t.prototype.getParams=function(){return this._params||(this._params={current:I.Select(this._animations[0]&&this._animations[0].name,this._animations.map(function(r){return[r.name,r.display.name]}),{label:"Animation"})}),this._params},t.prototype.updateParams=function(r){if(!this.isEmpty){this.updateState({params:E(E({},this.state.params),r)});var n=this.map.get(this.state.params.current),i=n.params(this.context);this._current={anim:n,params:i,paramValues:I.getDefaultValues(i),state:{},startedTime:-1,lastTime:0},this.triggerUpdate()}},t.prototype.updateCurrentParams=function(r){this.isEmpty||(this._current.paramValues=E(E({},this._current.paramValues),r),this.triggerUpdate())},t.prototype.register=function(r){if(this.map.has(r.name)){this.context.log.error("Animation '"+r.name+"' is already registered.");return}this._params=void 0,this.map.set(r.name,r),this._animations.push(r),this._animations.length===1?this.updateParams({current:r.name}):this.triggerUpdate()},t.prototype.play=function(r,n){return ce(this,void 0,void 0,function(){return de(this,function(i){switch(i.label){case 0:return[4,this.stop()];case 1:return i.sent(),this.map.has(r.name)||this.register(r),this.updateParams({current:r.name}),this.updateCurrentParams(n),[4,this.start()];case 2:return i.sent(),[2]}})})},t.prototype.tick=function(r,n){return ce(this,void 0,void 0,function(){return de(this,function(i){switch(i.label){case 0:return this.currentTime=r,this.isStopped?[2]:n?[4,this.applyFrame()]:[3,2];case 1:return i.sent(),[3,3];case 2:this.applyAsync(),i.label=3;case 3:return[2]}})})},t.prototype.start=function(){return ce(this,void 0,void 0,function(){var r,n,i;return de(this,function(a){switch(a.label){case 0:return this.updateState({animationState:"playing"}),this.context.behaviors.state.isAnimating.value||this.context.behaviors.state.isAnimating.next(!0),this.triggerUpdate(),r=this._current.anim,n=this._current.anim.initialState(this._current.paramValues,this.context),r.setup?[4,r.setup(this._current.paramValues,n,this.context)]:[3,2];case 1:i=a.sent(),i&&(n=i),a.label=2;case 2:return this._current.lastTime=0,this._current.startedTime=-1,this._current.state=n,this.isStopped=!1,[2]}})})},t.prototype.stop=function(){return ce(this,void 0,void 0,function(){var r;return de(this,function(n){switch(n.label){case 0:return this.isStopped=!0,this.state.animationState==="stopped"?[3,3]:(r=this._current.anim,r.teardown?[4,r.teardown(this._current.paramValues,this._current.state,this.context)]:[3,2]);case 1:n.sent(),n.label=2;case 2:this.updateState({animationState:"stopped"}),this.triggerUpdate(),n.label=3;case 3:return this.context.behaviors.state.isAnimating.value&&this.context.behaviors.state.isAnimating.next(!1),[2]}})})},Object.defineProperty(t.prototype,"isAnimating",{get:function(){return this.state.animationState==="playing"},enumerable:!1,configurable:!0}),t.prototype.applyAsync=function(){return ce(this,void 0,void 0,function(){return de(this,function(r){switch(r.label){case 0:if(this.isApplying)return[2];this.isApplying=!0,r.label=1;case 1:return r.trys.push([1,,3,4]),[4,this.applyFrame()];case 2:return r.sent(),[3,4];case 3:return this.isApplying=!1,[7];case 4:return[2]}})})},t.prototype.applyFrame=function(){return ce(this,void 0,void 0,function(){var r,n;return de(this,function(i){switch(i.label){case 0:return r=this.currentTime,this._current.startedTime<0&&(this._current.startedTime=r),[4,this._current.anim.apply(this._current.state,{lastApplied:this._current.lastTime,current:r-this._current.startedTime},{params:this._current.paramValues,plugin:this.context})];case 1:return n=i.sent(),n.kind==="finished"?this.stop():n.kind==="next"&&(this._current.state=n.state,this._current.lastTime=r-this._current.startedTime),this.triggerApply(),[2]}})})},t.prototype.getSnapshot=function(){return this.current?{state:this.state,current:{paramValues:this._current.paramValues,state:this._current.anim.stateSerialization?this._current.anim.stateSerialization.toJSON(this._current.state):this._current.state}}:{state:this.state}},t.prototype.setSnapshot=function(r){this.isEmpty||(this.updateState({animationState:r.state.animationState}),this.updateParams(r.state.params),r.current&&(this.current.paramValues=r.current.paramValues,this.current.state=this._current.anim.stateSerialization?this._current.anim.stateSerialization.fromJSON(r.current.state):r.current.state,this.triggerUpdate(),this.state.animationState==="playing"&&this.resume()))},t.prototype.resume=function(){return ce(this,void 0,void 0,function(){var r;return de(this,function(n){switch(n.label){case 0:return this._current.lastTime=0,this._current.startedTime=-1,r=this._current.anim,this.context.behaviors.state.isAnimating.value||this.context.behaviors.state.isAnimating.next(!0),r.setup?[4,r.setup(this._current.paramValues,this._current.state,this.context)]:[3,2];case 1:n.sent(),n.label=2;case 2:return this.isStopped=!1,[2]}})})},t}(kd),Ust={minRadius:5,extraRadius:4,durationMs:250},jst=function(){function e(t){this.plugin=t,this.boundaryHelper=new ps("98")}return e.prototype.transformedLoci=function(t){var r,n;if(Re.is(t)){var i=(n=(r=this.plugin.helpers.substructureParent.get(t.structure))===null||r===void 0?void 0:r.obj)===null||n===void 0?void 0:n.data;i&&(t=Re.remap(t,i))}return t},e.prototype.focusRenderObjects=function(t,r){if(t){for(var n=[],i=0,a=t;i<a.length;i++){var o=a[i],s=o.values.boundingSphere.ref.value;s.radius!==0&&n.push(s)}this.focusSpheres(n,function(u){return u},r)}},e.prototype.focusLoci=function(t,r){var n;if(Array.isArray(t)&&t.length>1){for(var i=[],a=0,o=t;a<o.length;a++){var s=o[a],u=ar.getBoundingSphere(this.transformedLoci(s));u&&i.push(u)}if(i.length===0)return;this.boundaryHelper.reset();for(var l=0,c=i;l<c.length;l++){var u=c[l];this.boundaryHelper.includeSphere(u)}this.boundaryHelper.finishedIncludeStep();for(var d=0,f=i;d<f.length;d++){var u=f[d];this.boundaryHelper.radiusSphere(u)}n=this.boundaryHelper.getSphere()}else if(Array.isArray(t)){if(t.length===0)return;n=ar.getBoundingSphere(this.transformedLoci(t[0]))}else n=ar.getBoundingSphere(this.transformedLoci(t));n&&this.focusSphere(n,r)},e.prototype.focusSpheres=function(t,r,n){for(var i=[],a=0,o=t;a<o.length;a++){var s=o[a],u=r(s);u&&i.push(u)}if(i.length!==0){if(i.length===1)return this.focusSphere(i[0],n);this.boundaryHelper.reset();for(var l=0,c=i;l<c.length;l++){var u=c[l];this.boundaryHelper.includeSphere(u)}this.boundaryHelper.finishedIncludeStep();for(var d=0,f=i;d<f.length;d++){var u=f[d];this.boundaryHelper.radiusSphere(u)}this.focusSphere(this.boundaryHelper.getSphere(),n)}},e.prototype.focusSphere=function(t,r){var n,i,a,o,s=E(E({},Ust),r),u=s.extraRadius,l=s.minRadius,c=s.durationMs,d=Math.max(t.radius+u,l);if(r!=null&&r.principalAxes){var f=r==null?void 0:r.principalAxes.boxAxes,p=f.origin,v=f.dirA,h=f.dirC,m=(n=this.plugin.canvas3d)===null||n===void 0?void 0:n.camera.getFocus(p,d,v,h);(i=this.plugin.canvas3d)===null||i===void 0||i.requestCameraReset({durationMs:c,snapshot:m})}else{var m=(a=this.plugin.canvas3d)===null||a===void 0?void 0:a.camera.getFocus(t.center,d);(o=this.plugin.canvas3d)===null||o===void 0||o.requestCameraReset({durationMs:c,snapshot:m})}},e.prototype.setSnapshot=function(t,r){var n;(n=this.plugin.canvas3d)===null||n===void 0||n.requestCameraReset({snapshot:t,durationMs:r})},e.prototype.reset=function(t,r){var n;(n=this.plugin.canvas3d)===null||n===void 0||n.requestCameraReset({snapshot:t,durationMs:r})},e}(),zst=function(){function e(t){var r=this;this.ctx=t,this.providers=[],this.locis=[],this.isDirty=!1,this.labels=[],this.groupedLabels=new Map,t.managers.interactivity.lociHighlights.addProvider(function(n,i){r.mark(n,i),r.showLabels()})}return e.prototype.clearProviders=function(){this.providers=[],this.isDirty=!0,this.showLabels()},e.prototype.addProvider=function(t){this.providers.push(t),this.providers.sort(function(r,n){return(n.priority||0)-(r.priority||0)}),this.isDirty=!0,this.showLabels()},e.prototype.removeProvider=function(t){this.providers=this.providers.filter(function(r){return r!==t}),this.isDirty=!0,this.showLabels()},e.prototype.mark=function(t,r){var n=this.locis.findIndex(function(i){return or.Loci.areEqual(t,i)});n===-1&&r===tr.Highlight?(this.locis.push(t),this.isDirty=!0):n!==-1&&r===tr.RemoveHighlight&&(gb(this.locis,n),this.isDirty=!0)},e.prototype.showLabels=function(){this.ctx.behaviors.labels.highlight.next({labels:this.getLabels()})},e.prototype.getLabels=function(){var t=this;if(this.isDirty){this.groupedLabels.clear(),this.labels.length=0;for(var r=0,n=this.providers;r<n.length;r++)for(var i=n[r],a=0,o=this.locis;a<o.length;a++){var s=o[a];if(!ar.isEmpty(s.loci)){var u=i.label(s.loci,s.repr);if(u){var l=i.group?i.group(u):u.toString(),c=this.groupedLabels.get(l);c?c.push(u):this.groupedLabels.set(l,[u])}}}this.labels.length=0,this.groupedLabels.forEach(function(d,f){var p=d.length,v=p>1&&d[0]!==d[1]?f:d[0];t.labels.push(p===1?v:v+" <small>||  "+p+"</small>")}),this.isDirty=!1}return this.labels},e}(),Vst=8,Hst=function(e){Fe(t,e);function t(r){var n=e.call(this,{history:[]})||this;n.plugin=r,n.events={historyUpdated:n.ev()},n.behaviors={current:n.ev.behavior(void 0)},r.state.data.events.object.removed.subscribe(function(a){var o,s,u=a.obj;if(ge.Molecule.Structure.is(u)){((s=n.current)===null||s===void 0?void 0:s.loci.structure)===u.data&&n.clear();for(var l=[],c=0,d=n.history;c<d.length;c++){var f=d[c];f.loci.structure===u.data&&l.push(f)}l.length!==n.history.length&&(n.history.length=0,(o=n.history).push.apply(o,l),n.events.historyUpdated.next())}});var i=Be();return r.state.data.events.object.updated.subscribe(function(a){var o,s=a.oldData,u=a.obj,l=a.action;if(ge.Molecule.Structure.is(u)&&s!==u.data&&l==="in-place"){var c=n.state.current,d=u.data;if(c&&c.loci.structure===s){var f=Re.remap(c.loci,d);n.state.current=E(E({},c),{loci:f}),n.behaviors.current.next(n.state.current),ar.getBoundingSphere(f,i);var p=(o=n.plugin.canvas3d)===null||o===void 0?void 0:o.camera,v=p.getTargetDistance(i.radius+4);(_.distance(p.target,i.center)>i.radius||v>p.viewport.height/p.zoom)&&n.plugin.managers.camera.focusSphere(i,{durationMs:0})}}}),n}return Object.defineProperty(t.prototype,"current",{get:function(){return this.state.current},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"history",{get:function(){return this.state.history},enumerable:!1,configurable:!0}),t.prototype.tryAddHistory=function(r){if(!Re.isEmpty(r.loci)){for(var n=0,i=void 0,a=0,o=this.state.history;a<o.length;a++){var s=o[a];if(Re.areEqual(s.loci,r.loci)){i=s;break}n++}if(i){gb(this.state.history,n),this.state.history.unshift(r),this.events.historyUpdated.next();return}this.state.history.unshift(r),this.state.history.length>Vst&&this.state.history.pop(),this.events.historyUpdated.next()}},t.prototype.set=function(r){this.tryAddHistory(r),(!this.state.current||!Re.areEqual(this.state.current.loci,r.loci))&&(this.state.current=r,this.behaviors.current.next(r))},t.prototype.setFromLoci=function(r){var n=ar.normalize(r);if(!Re.is(n)||Re.isEmpty(n)){this.clear();return}this.set({loci:n,label:yp(n,{reverse:!0,hidePrefix:!0,htmlStyling:!1})})},t.prototype.addFromLoci=function(r){var n=this.state.current&&Re.is(r)&&r.structure===this.state.current.loci.structure?Re.union(r,this.state.current.loci):r;this.setFromLoci(n)},t.prototype.clear=function(){this.state.current&&(this.state.current=void 0,this.behaviors.current.next(void 0))},t.prototype.getSnapshot=function(){if(!this.current)return{};var r=this.plugin.helpers.substructureParent.get(this.current.loci.structure),n=r==null?void 0:r.transform.ref;return n?{current:{label:this.current.label,ref:n,bundle:rn.fromLoci(this.current.loci),category:this.current.category}}:{}},t.prototype.setSnapshot=function(r){var n,i;if(!r.current){this.clear();return}var a=r.current,o=a.label,s=a.ref,u=a.bundle,l=a.category,c=(i=(n=this.plugin.state.data.select(ir.Generators.byRef(s))[0])===null||n===void 0?void 0:n.obj)===null||i===void 0?void 0:i.data;if(c){var d=rn.toLoci(u,c);this.set({label:o,loci:d,category:l})}},t}(kd),by=new ps("98"),Gst=24,qst=function(e){Fe(t,e);function t(r){var n=e.call(this,{entries:new Map,additionsHistory:[],stats:$st()})||this;return n.plugin=r,n.events={changed:n.ev(),additionsHistoryUpdated:n.ev(),loci:{add:n.ev(),remove:n.ev(),clear:n.ev()}},r.helpers.substructureParent.events.removed.subscribe(function(i){return n.onRemove(i.ref,i.obj)}),r.helpers.substructureParent.events.updated.subscribe(function(i){return n.onUpdate(i.ref,i.oldObj,i.obj)}),n}return Object.defineProperty(t.prototype,"entries",{get:function(){return this.state.entries},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"additionsHistory",{get:function(){return this.state.additionsHistory},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"stats",{get:function(){return this.state.stats?this.state.stats:(this.state.stats=this.calcStats(),this.state.stats)},enumerable:!1,configurable:!0}),t.prototype.getEntry=function(r){var n=this.plugin.helpers.substructureParent.get(r,!0);if(n){var i=n.transform.ref;if(!this.entries.has(i)){var a=new PR(Re(r,[]));return this.entries.set(i,a),a}return this.entries.get(i)}},t.prototype.calcStats=function(){var r=0,n=0,i=Lf.create();this.entries.forEach(function(o){var s=o.selection.elements;if(s.length){r+=1;for(var u=0,l=s.length;u<l;++u)n+=Le.size(s[u].indices);Lf.add(i,i,Lf.ofLoci(o.selection))}});var a=lw(i,{countsOnly:!0});return{structureCount:r,elementCount:n,label:a}},t.prototype.add=function(r){if(!Re.is(r))return!1;var n=this.getEntry(r.structure);if(!n)return!1;var i=n.selection;return n.selection=Re.union(n.selection,r),this.tryAddHistory(r),this.referenceLoci=r,this.events.loci.add.next(r),!Re.areEqual(i,n.selection)},t.prototype.remove=function(r){if(!Re.is(r))return!1;var n=this.getEntry(r.structure);if(!n)return!1;var i=n.selection;return n.selection=Re.subtract(n.selection,r),this.referenceLoci=r,this.events.loci.remove.next(r),!Re.areEqual(i,n.selection)},t.prototype.intersect=function(r){if(!Re.is(r))return!1;var n=this.getEntry(r.structure);if(!n)return!1;var i=n.selection;return n.selection=Re.intersect(n.selection,r),this.referenceLoci=r,!Re.areEqual(i,n.selection)},t.prototype.set=function(r){if(!Re.is(r))return!1;var n=this.getEntry(r.structure);if(!n)return!1;var i=n.selection;return n.selection=r,this.tryAddHistory(r),this.referenceLoci=void 0,!Re.areEqual(i,n.selection)},t.prototype.modifyHistory=function(r,n,i,a){a===void 0&&(a=!1);var o=this.additionsHistory,s=o.indexOf(r);if(!(s<0)){var u=void 0;switch(n){case"remove":gb(o,s);break;case"up":u=s-1;break;case"down":u=s+1;break}if(u!==void 0)for(var l=i?Math.min(o.length,i):o.length;;)if(u=u%l,u<0&&(u+=l),!a||o[s].loci.structure===o[u].loci.structure){var c=o[s];o[s]=o[u],o[u]=c;break}else u+=n==="up"?-1:1;this.events.additionsHistoryUpdated.next()}},t.prototype.tryAddHistory=function(r){if(!ar.isEmpty(r)){for(var n=0,i=void 0,a=0,o=this.additionsHistory;a<o.length;a++){var s=o[a];if(ar.areEqual(s.loci,r)){i=s;break}n++}if(i){gb(this.additionsHistory,n),this.additionsHistory.unshift(i),this.events.additionsHistoryUpdated.next();return}var u=Lf.ofLoci(r),l=lw(u,{reverse:!0});this.additionsHistory.unshift({id:mn.create22(),loci:r,label:l}),this.additionsHistory.length>Gst&&this.additionsHistory.pop(),this.events.additionsHistoryUpdated.next()}},t.prototype.clearHistory=function(){this.state.additionsHistory.length!==0&&(this.state.additionsHistory=[],this.events.additionsHistoryUpdated.next())},t.prototype.clearHistoryForStructure=function(r){for(var n=[],i=0,a=this.state.additionsHistory;i<a.length;i++){var o=a[i];o.loci.structure.root===r.root&&n.push(o)}for(var s=0,u=n;s<u.length;s++){var o=u[s];this.modifyHistory(o,"remove")}n.length!==0&&this.events.additionsHistoryUpdated.next()},t.prototype.onRemove=function(r,n){var i;this.entries.has(r)&&(this.entries.delete(r),n!=null&&n.data&&this.clearHistoryForStructure(n.data),((i=this.referenceLoci)===null||i===void 0?void 0:i.structure)===(n==null?void 0:n.data)&&(this.referenceLoci=void 0),this.state.stats=void 0,this.events.changed.next())},t.prototype.onUpdate=function(r,n,i){var a,o,s,u;if(!(n===i||(n==null?void 0:n.data)===i.data)){var l=this.plugin.helpers.substructureParent.get(i.data,!0);if(l&&(r=l.transform.ref,!!this.entries.has(r))){var c=(o=(a=this.plugin.helpers.substructureParent.get(i.data))===null||a===void 0?void 0:a.obj)===null||o===void 0?void 0:o.data;if(c)if(!(n!=null&&n.data)||We.areUnitIdsAndIndicesEqual(n.data,i.data)){this.entries.set(r,Wst(this.entries.get(r),c)),((s=this.referenceLoci)===null||s===void 0?void 0:s.structure.root)===c.root&&(this.referenceLoci=Re.remap(this.referenceLoci,c));for(var d=!1,f=0,p=this.state.additionsHistory;f<p.length;f++){var v=p[f];v.loci.structure.root===c.root&&(v.loci=Re.remap(v.loci,c),d=!0)}d&&this.events.additionsHistoryUpdated.next()}else this.entries.set(r,new PR(Re(c,[]))),((u=this.referenceLoci)===null||u===void 0?void 0:u.structure.root)===c.root&&(this.referenceLoci=void 0),this.clearHistoryForStructure(c),this.state.stats=void 0,this.events.changed.next()}}},t.prototype.clear=function(){for(var r=this.entries.keys(),n=[];;){var i=r.next();if(i.done)break;var a=this.entries.get(i.value);Re.isEmpty(a.selection)||n.push(a.selection),a.selection=Re(a.selection.structure,[])}return this.referenceLoci=void 0,this.state.stats=void 0,this.events.changed.next(),this.events.loci.clear.next(),this.clearHistory(),n},t.prototype.getLoci=function(r){var n=this.getEntry(r);return n?n.selection:Nr},t.prototype.getStructure=function(r){var n=this.getEntry(r);if(n)return n.structure},t.prototype.structureHasSelection=function(r){var n,i,a=(i=(n=r.cell)===null||n===void 0?void 0:n.obj)===null||i===void 0?void 0:i.data;if(!a)return!1;var o=this.getEntry(a);return!!o&&!Re.isEmpty(o.selection)},t.prototype.has=function(r){if(Re.is(r)){var n=this.getEntry(r.structure);if(n)return Re.isSubset(n.selection,r)}return!1},t.prototype.tryGetRange=function(r){if(Re.is(r)&&r.elements.length===1){var n=this.getEntry(r.structure);if(n){var i=r.elements[0];if(i){var a=this.referenceLoci;if(!(!a||!Re.is(a)||a.structure!==r.structure)){for(var o,s=0,u=a.elements;s<u.length;s++){var l=u[s];if(i.unit===l.unit){o=l;break}}if(o&&i.unit===o.unit)return Xst(r.structure,o,i)}}}}},t.prototype.elementCount=function(){var r=0;return this.entries.forEach(function(n){r+=Re.size(n.selection)}),r},t.prototype.getBoundary=function(){var r=_.create(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),n=_.create(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);by.reset();var i=[];this.entries.forEach(function(c){var d=c.selection;Re.isEmpty(d)||i.push(Re.getBoundary(d))});for(var a=0,o=i.length;a<o;++a){var s=i[a],u=s.box,l=s.sphere;_.min(r,r,u.min),_.max(n,n,u.max),by.includePositionRadius(l.center,l.radius)}by.finishedIncludeStep();for(var a=0,o=i.length;a<o;++a){var l=i[a].sphere;by.radiusPositionRadius(l.center,l.radius)}return{box:{min:r,max:n},sphere:by.getSphere()}},t.prototype.getPrincipalAxes=function(){var r=this.elementCount(),n=new Float32Array(3*r),i=0;return this.entries.forEach(function(a){Re.toPositionsArray(a.selection,n,i),i+=Re.size(a.selection)*3}),hv.ofPositions(n)},t.prototype.modify=function(r,n){var i=!1;switch(r){case"add":i=this.add(n);break;case"remove":i=this.remove(n);break;case"intersect":i=this.intersect(n);break;case"set":i=this.set(n);break}i&&(this.state.stats=void 0,this.events.changed.next())},Object.defineProperty(t.prototype,"applicableStructures",{get:function(){return this.plugin.managers.structure.hierarchy.selection.structures.filter(function(r){return!!r.cell.obj}).map(function(r){return r.cell.obj.data})},enumerable:!1,configurable:!0}),t.prototype.triggerInteraction=function(r,n,i){switch(i===void 0&&(i=!0),r){case"add":this.plugin.managers.interactivity.lociSelects.select({loci:n},i);break;case"remove":this.plugin.managers.interactivity.lociSelects.deselect({loci:n},i);break;case"intersect":this.plugin.managers.interactivity.lociSelects.selectJoin({loci:n},i);break;case"set":this.plugin.managers.interactivity.lociSelects.selectOnly({loci:n},i);break}},t.prototype.fromLoci=function(r,n,i){i===void 0&&(i=!0),this.triggerInteraction(r,n,i)},t.prototype.fromCompiledQuery=function(r,n,i){i===void 0&&(i=!0);for(var a=0,o=this.applicableStructures;a<o.length;a++){var s=o[a],u=n(new us(s));this.triggerInteraction(r,mt.toLociWithSourceUnits(u),i)}},t.prototype.fromSelectionQuery=function(r,n,i){var a=this;i===void 0&&(i=!0),this.plugin.runTask($e.create("Structure Selection",function(o){return ce(a,void 0,void 0,function(){var s,u,l,c;return de(this,function(d){switch(d.label){case 0:s=0,u=this.applicableStructures,d.label=1;case 1:return s<u.length?(l=u[s],[4,n.getSelection(this.plugin,o,l)]):[3,4];case 2:c=d.sent(),this.triggerInteraction(r,mt.toLociWithSourceUnits(c),i),d.label=3;case 3:return s++,[3,1];case 4:return[2]}})})}))},t.prototype.fromSelections=function(r){var n,i=Fi.resolveAndCheck(this.plugin.state.data,r);if(!(!i||!i.obj)){if(!ge.Molecule.Structure.Selections.is(i.obj)){console.warn("fromSelections applied to wrong object type.",i.obj);return}this.clear();for(var a=0,o=(n=i.obj)===null||n===void 0?void 0:n.data;a<o.length;a++){var s=o[a];this.fromLoci("set",s.loci)}}},t}(kd);function $st(){return{structureCount:0,elementCount:0,label:"Nothing Selected"}}var PR=function(){function e(t){this._structure=void 0,this._selection=t}return Object.defineProperty(e.prototype,"selection",{get:function(){return this._selection},set:function(t){this._selection=t,this._structure=void 0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"structure",{get:function(){return this._structure?this._structure:(ar.isEmpty(this._selection)?this._structure=void 0:this._structure=Re.toStructure(this._selection),this._structure)},enumerable:!1,configurable:!0}),e}();function Wst(e,t){return new PR(Re.remap(e.selection,t))}function Xst(e,t,r){var n=Math.min(Le.min(t.indices),Le.min(r.indices)),i=Math.max(Le.max(t.indices),Le.max(r.indices));return Re(e,[{unit:t.unit,indices:Le.ofRange(n,i)}])}var Yst=[["full","Full"],["collapsed","Collapsed"],["hidden","Hidden"]],NT=[["full","Full"],["hidden","Hidden"]],Kst={isExpanded:I.Boolean(!1),showControls:I.Boolean(!0),regionState:I.Group({left:I.Select("full",Yst),top:I.Select("full",NT),right:I.Select("full",NT),bottom:I.Select("full",NT)}),controlsDisplay:I.Value("outside",{isHidden:!0})},Qst=function(e){Fe(t,e);function t(r){var n=e.call(this,E(E({},I.getDefaultValues(Kst)),r.spec.layout&&r.spec.layout.initial))||this;return n.context=r,n.events={updated:n.ev()},n.rootState=void 0,_t.Layout.Update.subscribe(r,function(i){return n.updateProps(i.state)}),typeof document<"u"&&(n.expandedViewport=document.createElement("meta"),n.expandedViewport.name="viewport",n.expandedViewport.content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"),n}return t.prototype.updateProps=function(r){var n=!!this.state.isExpanded;this.updateState(r),this.root&&typeof r.isExpanded=="boolean"&&r.isExpanded!==n&&this.handleExpand(),this.events.updated.next()},t.prototype.setProps=function(r){this.updateState(r)},t.prototype.setRoot=function(r){this.root=r,this.state.isExpanded&&this.handleExpand()},t.prototype.getScrollElement=function(){return document.scrollingElement?document.scrollingElement:document.documentElement?document.documentElement:document.body},t.prototype.handleExpand=function(){try{var r=document.getElementsByTagName("body")[0],n=document.getElementsByTagName("head")[0];if(!r||!n||!this.root)return;if(this.state.isExpanded){for(var i=n.children,a=[],o=!1,s=0;s<i.length;s++)i[s]===this.expandedViewport?o=!0:(i[s].name||"").toLowerCase()==="viewport"&&a.push(i[s]);for(var u=0,l=a;u<l.length;u++){var c=l[u];n.removeChild(c)}o||n.appendChild(this.expandedViewport);var d=r.style,f=this.getScrollElement(),p=f.scrollLeft,v=f.scrollTop;this.rootState={top:d.top,bottom:d.bottom,right:d.right,left:d.left,scrollTop:v,scrollLeft:p,position:d.position,overflow:d.overflow,viewports:a,zIndex:this.root.style.zIndex,width:d.width,height:d.height,maxWidth:d.maxWidth,maxHeight:d.maxHeight,margin:d.margin,marginLeft:d.marginLeft,marginRight:d.marginRight,marginTop:d.marginTop,marginBottom:d.marginBottom},d.overflow="hidden",d.position="fixed",d.top="0",d.bottom="0",d.right="0",d.left="0",d.width="100%",d.height="100%",d.maxWidth="100%",d.maxHeight="100%",d.margin="0",d.marginLeft="0",d.marginRight="0",d.marginTop="0",d.marginBottom="0"}else{for(var i=n.children,s=0;s<i.length;s++)if(i[s]===this.expandedViewport){n.removeChild(this.expandedViewport);break}if(this.rootState){for(var h=this.rootState,m=0,g=h.viewports;m<g.length;m++){var c=g[m];n.appendChild(c)}var d=r.style;d.top=h.top,d.bottom=h.bottom,d.left=h.left,d.right=h.right,d.width=h.width,d.height=h.height,d.maxWidth=h.maxWidth,d.maxHeight=h.maxHeight,d.margin=h.margin,d.marginLeft=h.marginLeft,d.marginRight=h.marginRight,d.marginTop=h.marginTop,d.marginBottom=h.marginBottom,d.position=h.position,d.overflow=h.overflow||"";var f=this.getScrollElement();f.scrollTop=h.scrollTop,f.scrollLeft=h.scrollLeft,this.rootState=void 0,this.root.style.zIndex=h.zIndex}}}catch(b){var y="Layout change error, you might have to reload the page.";this.context.log.error(y),console.error(y,b)}},t}(kd),$F={includeTypes:I.MultiSelect(BE(Ur.Names),I.objectToOptions(Ur.Names)),excludeTypes:I.MultiSelect([],I.objectToOptions(Ur.Names)),ignoreHydrogens:I.Boolean(!1),aromaticBonds:I.Boolean(!1,{description:"Display aromatic bonds with dashes"})};I.getDefaultValues($F);var WF=E(E(E({},Hv),$F),{adjustCylinderLength:I.Boolean(!0,{description:"Shorten cylinders to reduce overlap with spheres."})});I.getDefaultValues(WF);var XF=E(E({},nne),$F);I.getDefaultValues(XF);function Xie(e,t,r){return!Ur.is(e,r)||Ur.is(t,r)}function Yie(e,t,r){var n=t.elements,i=t.model.atomicHierarchy.derived.atom.atomicNumber,a=t.bonds,o=a.a,s=a.b,u=a.edgeProps,l=u.flags,c=r.ignoreHydrogens,d=r.includeTypes,f=r.excludeTypes,p=Ur.fromNames(d),v=Ur.fromNames(f),h=Ur.isAll(p)&&v===0,m=e.child,g=m==null?void 0:m.unitMap.get(t.id);if(m&&!g)throw new Error("expected childUnit to exist if child exists");if(!(h&&!c&&!m))return function(y){return!!g&&!Je.has(g.elements,n[o[y]])||c&&(fw(i,n[o[y]])||fw(i,n[s[y]]))||!h&&Xie(p,v,l[y])}}function Kie(e,t){var r=e.interUnitBonds,n=r.edges,i=t.ignoreHydrogens,a=t.includeTypes,o=t.excludeTypes,s=Ur.fromNames(a),u=Ur.fromNames(o),l=Ur.isAll(s)&&u===0,c=e.child;if(!(l&&!i&&!c))return function(d){if(c){var f=n[d],p=c.unitMap.get(f.unitA);if(!p)return!0;var v=e.unitMap.get(f.unitA),h=v.elements[f.indexA];if(!Je.has(p.elements,h))return!0}if(i){var f=n[d],m=e.unitMap.get(f.unitA),g=e.unitMap.get(f.unitB);if(dw(m,m.elements[f.indexA])||dw(g,g.elements[f.indexB]))return!0}return!!(!l&&Xie(s,u,n[d].props.flag))}}var xp;(function(e){function t(n){var i=n.group,a=n.structure,o=i.units[0],s=je.isAtomic(o)?o.bonds.edgeCount*2:0,u=i.units.length,l=Vt.Location(a,void 0,void 0,a,void 0,void 0),c=function(d,f){var p=i.units[f];return l.aUnit=p,l.bUnit=p,l.aIndex=p.bonds.a[d],l.bIndex=p.bonds.b[d],l};return Sn(s,u,1,c)}e.fromGroup=t;function r(n){var i=n.interUnitBonds.edgeCount,a=1,o=Vt.Location(n,void 0,void 0,n,void 0,void 0),s=function(u){var l=n.interUnitBonds.edges[u];return o.aUnit=n.unitMap.get(l.unitA),o.aIndex=l.indexA,o.bUnit=n.unitMap.get(l.unitB),o.bIndex=l.indexB,o};return Sn(i,a,1,s,!0)}e.fromStructure=r})(xp||(xp={}));function YF(e,t,r){var n=e.objectId,i=e.instanceId,a=e.groupId;if(r===n){var o=t.structure,s=t.group,u=s.units[i];if(je.isAtomic(u)){var l=o.target,c=u.bonds.a[a],d=u.bonds.b[a];return Vt.Loci(l,[Vt.Location(l,u,c,l,u,d),Vt.Location(l,u,d,l,u,c)])}}return Nr}function KF(e,t,r,n){var i=!1;if(Vt.isLoci(e)){var a=t.structure,o=t.group;if(!We.areEquivalent(e.structure,a))return!1;var s=o.units[0];if(!je.isAtomic(s))return!1;for(var u=s.bonds.edgeCount*2,l=0,c=e.bonds;l<c.length;l++){var d=c[l];if(d.aUnit===d.bUnit){var f=o.unitIndexMap.get(d.aUnit.id);if(f!==void 0){var p=s.bonds.getDirectedEdgeIndex(d.aIndex,d.bIndex);p!==-1&&r(Ie.ofSingleton(f*u+p))&&(i=!0)}}}}else if(Re.is(e)){var a=t.structure,o=t.group;if(!We.areEquivalent(e.structure,a))return!1;var s=o.units[0];if(!je.isAtomic(s))return!1;for(var v=s.bonds.edgeCount*2,h=function(C){var w=o.unitIndexMap.get(C.unit.id);if(w!==void 0){var A=s.bonds,M=A.offset,D=A.b;Le.forEach(C.indices,function(k){for(var R=M[k],O=M[k+1];R<O;R++)(!n||Le.has(C.indices,D[R]))&&r(Ie.ofSingleton(w*v+R))&&(i=!0)})}},m=0,g=e.elements;m<g.length;m++){var y=g[m];h(y)}}return i}function QF(e,t,r){var n=e.objectId,i=e.groupId;if(r===n){var a=t.target,o=t.interUnitBonds.edges[i],s=t.unitMap.get(o.unitA),u=t.unitMap.get(o.unitB);return Vt.Loci(a,[Vt.Location(a,s,o.indexA,a,u,o.indexB),Vt.Location(a,u,o.indexB,a,s,o.indexA)])}return Nr}function ZF(e,t,r,n){var i=!1;if(Vt.isLoci(e)){if(!We.areEquivalent(e.structure,t))return!1;for(var a=0,o=e.bonds;a<o.length;a++){var s=o[a],u=t.interUnitBonds.getBondIndexFromLocation(s);u!==-1&&r(Ie.ofSingleton(u))&&(i=!0)}}else if(Re.is(e)){if(!We.areEquivalent(e.structure,t)||n&&e.elements.length===1)return!1;for(var l=new Map,c=0,d=e.elements;c<d.length;c++){var f=d[c];l.set(f.unit.id,f.indices)}for(var p=function(m){var g=m.unit;if(!je.isAtomic(g))return"continue";t.interUnitBonds.getConnectedUnits(g.id).forEach(function(y){var b=l.get(y.unitB);(!n||b)&&Le.forEach(m.indices,function(S){y.connectedIndices.includes(S)&&y.getEdges(S).forEach(function(x){if(!n||b&&Le.has(b,x.indexB)){var C=t.interUnitBonds.getEdgeIndex(S,g.id,x.indexB,y.unitB);r(Ie.ofSingleton(C))&&(i=!0)}})})})},v=0,h=e.elements;v<h.length;v++){var f=h[v];p(f)}}return i}var BT=Ur.is;function Qie(e,t,r,n){var i=e.elements,a=e.bonds,o=a.edgeCount,s=a.a,u=a.b,l=a.edgeProps,c=a.offset,d=l.order,f=l.flags,p=n.sizeFactor,v=n.sizeAspectRatio,h=n.adjustCylinderLength,m=n.aromaticBonds,g=_(),y=_(),b=e.conformation.invariantPosition,S,x=Ze.create(t,e),C=Vt.Location(t,e,void 0,t,e,void 0),w=t.child;if(n.includeParent&&w){var A=w.unitMap.get(e.id);if(!A)throw new Error("expected childUnit to exist");S=function(B){var j=i[s[B]],Y=i[u[B]];return Je.has(A.elements,j)&&!Je.has(A.elements,Y)}}var M=function(B){return C.aIndex=s[B],C.bIndex=u[B],r.size.size(C)*p},D=function(B){return x.element=i[s[B]],r.size.size(x)*p},k=function(B){return x.element=i[u[B]],r.size.size(x)*p},R=e.rings,O=R.elementRingIndices,H=R.elementAromaticRingIndices;return{linkCount:o*2,referencePosition:function(B){var j,Y,G=s[B],$=u[B];G>$&&(j=[$,G],G=j[0],$=j[1]),c[G+1]-c[G]===1&&(Y=[$,G],G=Y[0],$=Y[1]);for(var q=O.get(G),ee=0,fe=c[G],W=c[G+1];fe<W;++fe){var X=u[fe];if(X!==$&&X!==G)if(q){var U=O.get(X);if(!U)continue;var z=k_(q,U);z>ee&&(ee=z,b(i[X],g))}else return b(i[X],g)}return ee>0?g:null},position:function(B,j,Y){if(b(i[s[Y]],B),b(i[u[Y]],j),h){var G=D(Y),$=k(Y),q=Math.min(G,$)*v,ee=Math.sqrt(Math.max(0,G*G-q*q))-.05,fe=Math.sqrt(Math.max(0,$*$-q*q))-.05;if(ee<=.01&&fe<=.01)return;_.normalize(y,_.sub(y,j,B)),_.scaleAndAdd(B,B,y,ee),_.scaleAndAdd(j,j,y,-fe)}},style:function(B){var j=d[B],Y=f[B];if(BT(Y,2)||BT(Y,4))return 1;if(j===3)return 3;if(m){var G=s[B],$=u[B],q=H.get(G),ee=H.get($),fe=q&&ee?k_(q,ee):0;if(fe||BT(Y,16))return fe===2?6:5}return j===2?2:0},radius:function(B){return M(B)*v},ignore:Yie(t,e,n),stub:S}}function Zst(e,t,r,n,i,a){if(!je.isAtomic(t)||!t.bonds.edgeCount)return Jo.createEmpty(a);var o=r.child,s=o==null?void 0:o.unitMap.get(t.id);if(o&&!s)return Jo.createEmpty(a);var u=Qie(t,r,n,i),l=ine(e,u,i,a),c=Be.expand(Be(),(s??t).boundary.sphere,1*i.sizeFactor);return l.setBoundingSphere(c),l}function Jst(e,t,r,n,i,a){if(!je.isAtomic(t)||!t.bonds.edgeCount)return Ft.createEmpty(a);var o=r.child,s=o==null?void 0:o.unitMap.get(t.id);if(o&&!s)return Ft.createEmpty(a);var u=Qie(t,r,n,i),l=Gv(e,u,i,a),c=Be.expand(Be(),(s??t).boundary.sphere,1*i.sizeFactor);return l.setBoundingSphere(c),l}var sA=E(E(E(E({},Ea),qre),WF),{sizeFactor:I.Numeric(.3,{min:0,max:10,step:.01}),sizeAspectRatio:I.Numeric(2/3,{min:0,max:3,step:.01}),tryUseImpostor:I.Boolean(!0),includeParent:I.Boolean(!1)});function Zie(e,t,r,n){return r.tryUseImpostor&&n&&n.extensions.fragDepth?eut(e):tut(e)}function eut(e){return $re({defaultProps:I.getDefaultValues(sA),createGeometry:Zst,createLocationIterator:xp.fromGroup,getLoci:YF,eachLocation:KF,setUpdateState:function(t,r,n,i,a,o,s){t.createGeometry=r.sizeAspectRatio!==n.sizeAspectRatio||r.linkScale!==n.linkScale||r.linkSpacing!==n.linkSpacing||r.ignoreHydrogens!==n.ignoreHydrogens||r.linkCap!==n.linkCap||r.dashCount!==n.dashCount||r.dashScale!==n.dashScale||r.dashCap!==n.dashCap||r.stubCap!==n.stubCap||!no(r.includeTypes,n.includeTypes)||!no(r.excludeTypes,n.excludeTypes)||r.adjustCylinderLength!==n.adjustCylinderLength||r.aromaticBonds!==n.aromaticBonds;var u=o.group.units[0],l=s.group.units[0];je.isAtomic(u)&&je.isAtomic(l)&&(Io.areEqual(u.bonds,l.bonds)||(t.createGeometry=!0,t.updateTransform=!0,t.updateColor=!0,t.updateSize=!0))},mustRecreate:function(t,r,n){return!r.tryUseImpostor||!n}},e)}function tut(e){return uo({defaultProps:I.getDefaultValues(sA),createGeometry:Jst,createLocationIterator:xp.fromGroup,getLoci:YF,eachLocation:KF,setUpdateState:function(t,r,n,i,a,o,s){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.sizeAspectRatio!==n.sizeAspectRatio||r.radialSegments!==n.radialSegments||r.linkScale!==n.linkScale||r.linkSpacing!==n.linkSpacing||r.ignoreHydrogens!==n.ignoreHydrogens||r.linkCap!==n.linkCap||r.dashCount!==n.dashCount||r.dashScale!==n.dashScale||r.dashCap!==n.dashCap||r.stubCap!==n.stubCap||!no(r.includeTypes,n.includeTypes)||!no(r.excludeTypes,n.excludeTypes)||r.adjustCylinderLength!==n.adjustCylinderLength||r.aromaticBonds!==n.aromaticBonds;var u=o.group.units[0],l=s.group.units[0];je.isAtomic(u)&&je.isAtomic(l)&&(Io.areEqual(u.bonds,l.bonds)||(t.createGeometry=!0,t.updateTransform=!0,t.updateColor=!0,t.updateSize=!0))},mustRecreate:function(t,r,n){return r.tryUseImpostor&&!!n}},e)}var UT=new Vt.ElementBondIterator;function tG(e,t,r,n){for(UT.setElement(t,r,n);UT.hasNext;){var i=UT.move();return i.otherUnit.conformation.position(i.otherUnit.elements[i.otherIndex],e),e}return null}var rG=_();function Jie(e,t,r){var n=Ze.create(e),i=Vt.Location(e,void 0,void 0,e,void 0,void 0),a=e.interUnitBonds,o=a.edgeCount,s=a.edges,u=r.sizeFactor,l=r.sizeAspectRatio,c=r.adjustCylinderLength,d=r.aromaticBonds,f=_(),p,v=e.child;r.includeParent&&v&&(p=function(y){var b=s[y],S=v.unitMap.get(b.unitA),x=v.unitMap.get(b.unitB),C=e.unitMap.get(b.unitA),w=C.elements[b.indexA],A=e.unitMap.get(b.unitB),M=A.elements[b.indexB];return S&&Je.has(S.elements,w)&&(!x||!Je.has(x.elements,M))});var h=function(y){var b=s[y];return i.aUnit=e.unitMap.get(b.unitA),i.aIndex=b.indexA,i.bUnit=e.unitMap.get(b.unitB),i.bIndex=b.indexB,t.size.size(i)*u},m=function(y){var b=s[y];return n.unit=e.unitMap.get(b.unitA),n.element=n.unit.elements[b.indexA],t.size.size(n)*u},g=function(y){var b=s[y];return n.unit=e.unitMap.get(b.unitB),n.element=n.unit.elements[b.indexB],t.size.size(n)*u};return{linkCount:o,referencePosition:function(y){var b=s[y],S,x,C,w;if(b.unitA<b.unitB)S=e.unitMap.get(b.unitA),x=e.unitMap.get(b.unitB),C=b.indexA,w=b.indexB;else if(b.unitA>b.unitB)S=e.unitMap.get(b.unitB),x=e.unitMap.get(b.unitA),C=b.indexB,w=b.indexA;else throw new Error("same units in createInterUnitBondCylinderMesh");return tG(rG,e,S,C)||tG(rG,e,x,w)},position:function(y,b,S){var x=s[S],C=e.unitMap.get(x.unitA),w=e.unitMap.get(x.unitB);if(C.conformation.position(C.elements[x.indexA],y),w.conformation.position(w.elements[x.indexB],b),c){var A=m(S),M=g(S),D=Math.min(A,M)*l,k=Math.sqrt(Math.max(0,A*A-D*D))-.05,R=Math.sqrt(Math.max(0,M*M-D*D))-.05;if(k<=.01&&R<=.01)return;_.normalize(f,_.sub(f,b,y)),_.scaleAndAdd(y,y,f,k),_.scaleAndAdd(b,b,f,-R)}},style:function(y){var b=s[y].props.order,S=ba.create(s[y].props.flag);return Ur.is(S,2)||Ur.is(S,4)?1:b===3?3:d&&Ur.is(S,16)?5:b===2?2:0},radius:function(y){return h(y)*l},ignore:Kie(e,r),stub:p}}function rut(e,t,r,n,i){if(!t.interUnitBonds.edgeCount)return Jo.createEmpty(i);var a=Jie(t,r,n),o=ine(e,a,n,i),s=t.child,u=Be.expand(Be(),(s??t).boundary.sphere,1*n.sizeFactor);return o.setBoundingSphere(u),o}function nut(e,t,r,n,i){if(!t.interUnitBonds.edgeCount)return Ft.createEmpty(i);var a=Jie(t,r,n),o=Gv(e,a,n,i),s=t.child,u=Be.expand(Be(),(s??t).boundary.sphere,1*n.sizeFactor);return o.setBoundingSphere(u),o}var uA=E(E(E(E({},p2),rKe),WF),{sizeFactor:I.Numeric(.3,{min:0,max:10,step:.01}),sizeAspectRatio:I.Numeric(2/3,{min:0,max:3,step:.01}),tryUseImpostor:I.Boolean(!0),includeParent:I.Boolean(!1)});function eae(e,t,r,n){return r.tryUseImpostor&&n&&n.extensions.fragDepth?iut(e):aut(e)}function iut(e){return nKe({defaultProps:I.getDefaultValues(uA),createGeometry:rut,createLocationIterator:xp.fromStructure,getLoci:QF,eachLocation:ZF,setUpdateState:function(t,r,n){t.createGeometry=r.sizeAspectRatio!==n.sizeAspectRatio||r.linkScale!==n.linkScale||r.linkSpacing!==n.linkSpacing||r.ignoreHydrogens!==n.ignoreHydrogens||r.linkCap!==n.linkCap||r.dashCount!==n.dashCount||r.dashScale!==n.dashScale||r.dashCap!==n.dashCap||r.stubCap!==n.stubCap||!no(r.includeTypes,n.includeTypes)||!no(r.excludeTypes,n.excludeTypes)||r.adjustCylinderLength!==n.adjustCylinderLength},mustRecreate:function(t,r,n){return!r.tryUseImpostor||!n}},e)}function aut(e){return zv({defaultProps:I.getDefaultValues(uA),createGeometry:nut,createLocationIterator:xp.fromStructure,getLoci:QF,eachLocation:ZF,setUpdateState:function(t,r,n){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.sizeAspectRatio!==n.sizeAspectRatio||r.radialSegments!==n.radialSegments||r.linkScale!==n.linkScale||r.linkSpacing!==n.linkSpacing||r.ignoreHydrogens!==n.ignoreHydrogens||r.linkCap!==n.linkCap||r.dashCount!==n.dashCount||r.dashScale!==n.dashScale||r.dashCap!==n.dashCap||r.stubCap!==n.stubCap||!no(r.includeTypes,n.includeTypes)||!no(r.excludeTypes,n.excludeTypes)||r.adjustCylinderLength!==n.adjustCylinderLength},mustRecreate:function(t,r,n){return r.tryUseImpostor&&!!n}},e)}var nG=new Float32Array([-1,1,-1,-1,1,1,1,-1]),Cm=new Uint16Array([0,1,2,1,3,2]),jT=qe.add3,out=qe.add2,sut=qe.add,Uw;(function(e){function t(r,n,i){r===void 0&&(r=2048),n===void 0&&(n=1024),r*=4,n*=4;var a=qe.create(Float32Array,3,n,i?i.centerBuffer.ref.value:r),o=qe.create(Float32Array,2,n,i?i.mappingBuffer.ref.value:r),s=qe.create(Uint32Array,3,n/2,i?i.indexBuffer.ref.value:r/2),u=qe.create(Float32Array,1,n,i?i.groupBuffer.ref.value:r);return{add:function(l,c,d,f){for(var p=a.elementCount,v=0;v<4;++v)jT(a,l,c,d),out(o,nG[v*2],nG[v*2+1]),sut(u,f);jT(s,p+Cm[0],p+Cm[1],p+Cm[2]),jT(s,p+Cm[3],p+Cm[4],p+Cm[5])},getSpheres:function(){var l=qe.compact(a,!0),c=qe.compact(o,!0),d=qe.compact(s,!0),f=qe.compact(u,!0);return gp.create(l,c,d,f,a.elementCount/4,i)}}}e.create=t})(Uw||(Uw={}));var tae=_.add;function JF(e,t,r){var n=r.ignoreHydrogens,i=r.traceOnly,a=t.model.atomicHierarchy.derived.atom.atomicNumber,o=je.isCoarse(t),s=e.child,u=s==null?void 0:s.unitMap.get(t.id);if(s&&!u)throw new Error("expected childUnit to exist if child exists");if(!(!s&&!n&&!i))return function(l){return!!u&&!Je.has(u.elements,l)||!o&&n&&fw(a,l)||i&&!sF(t,l)}}function uut(e,t,r,n,i,a){var o=r.child,s=o==null?void 0:o.unitMap.get(t.id);if(o&&!s)return Ft.createEmpty(a);for(var u=i.detail,l=i.sizeFactor,c=t.elements,d=c.length,f=d*OE(u),p=wt.createState(f,f/2,a),v=_(),h=t.conformation.invariantPosition,m=JF(r,t,i),g=Ze.create(r,t),y=n.size.size,b=_(),S=0,x=0,C=0;C<d;C++)if(!(m&&m(c[C]))){g.element=c[C],h(c[C],v),tae(b,b,v),x+=1,p.currentGroup=C;var w=y(g);w>S&&(S=w),Ni(p,v,w*l,u)}var A;_.scale(b,b,1/x),a&&_.distance(b,a.boundingSphere.center)/a.boundingSphere.radius<1?A=Be.clone(a.boundingSphere):A=Be.expand(Be(),(s??t).boundary.sphere,S*l+.05);var M=wt.getMesh(p);return M.setBoundingSphere(A),M}function lut(e,t,r,n,i,a){var o=r.child,s=o==null?void 0:o.unitMap.get(t.id);if(o&&!s)return gp.createEmpty(a);for(var u=t.elements,l=u.length,c=Uw.create(l,l/2,a),d=_(),f=t.conformation.invariantPosition,p=JF(r,t,i),v=Ze.create(r,t),h=n.size.size,m=_(),g=0,y=0,b=0;b<l;b++)if(!(p!=null&&p(u[b]))){f(u[b],d),c.add(d[0],d[1],d[2],b),tae(m,m,d),y+=1,v.element=u[b];var S=h(v);S>g&&(g=S)}var x;_.scale(m,m,1/y),a&&_.distance(m,a.boundingSphere.center)/a.boundingSphere.radius<1?x=Be.clone(a.boundingSphere):x=Be.expand(Be(),(s??t).boundary.sphere,g*i.sizeFactor+.05);var C=c.getSpheres();return C.setBoundingSphere(x),C}function $l(e,t,r){var n=!1;if(!Re.is(e))return!1;var i=t.structure,a=t.group;if(!We.areEquivalent(e.structure,i))return!1;for(var o=a.elements.length,s=0,u=e.elements;s<u.length;s++){var l=u[s],c=a.unitIndexMap.get(l.unit.id);if(c!==void 0){var d=c*o;if(Ie.is(l.indices)){var f=d+Ie.start(l.indices),p=d+Ie.end(l.indices);r(Ie.ofBounds(f,p))&&(n=!0)}else for(var v=0,h=l.indices.length;v<h;v++){for(var f=l.indices[v],m=v+1;m<h&&l.indices[m]===f;)m++;v=m-1;var p=l.indices[v];n=r(Ie.ofRange(d+f,d+p))||n}}}return n}function Wl(e,t,r){var n=e.objectId,i=e.instanceId,a=e.groupId;if(r===n){var o=t.structure,s=t.group,u=s.units[i],l=Le.ofSingleton(a);return Re(o.target,[{unit:u,indices:l}])}return Nr}function lA(e,t,r){var n=!1;if(!Re.is(e)||!We.areEquivalent(e.structure,t))return!1;for(var i=t.serialMapping.cumulativeUnitElementCount,a=0,o=e.elements;a<o.length;a++){var s=o[a],u=t.unitIndexMap.get(s.unit.id);if(u!==void 0)if(Ie.is(s.indices)){var l=i[u]+Ie.start(s.indices),c=i[u]+Ie.end(s.indices);r(Ie.ofBounds(l,c))&&(n=!0)}else for(var d=0,f=s.indices.length;d<f;d++){var p=i[u]+s.indices[d];r(Ie.ofSingleton(p))&&(n=!0)}}return n}function cA(e,t,r){var n=e.objectId,i=e.groupId;if(r===n){var a=t.serialMapping,o=a.unitIndices,s=a.cumulativeUnitElementCount,u=o[i],l=t.units[u],c=i-s[u],d=Le.ofSingleton(c);return Re(t,[{unit:l,indices:d}])}return Nr}var qa;(function(e){function t(n){var i=n.group,a=n.structure,o=i.elements.length,s=i.units.length,u=Ze.create(a),l=function(c,d){var f=i.units[d];return u.unit=f,u.element=f.elements[c],u};return Sn(o,s,1,l)}e.fromGroup=t;function r(n){var i=n.units,a=n.elementCount,o=a,s=1,u=n.serialMapping,l=u.unitIndices,c=u.elementIndices,d=Ze.create(n),f=function(p){return d.unit=i[l[p]],d.element=c[p],d};return Sn(o,s,1,f,!0)}e.fromStructure=r})(qa||(qa={}));var dA=E(E(E({},Ea),Hre),{sizeFactor:I.Numeric(1,{min:0,max:10,step:.1}),detail:I.Numeric(0,{min:0,max:3,step:1},Et.CustomQualityParamInfo),ignoreHydrogens:I.Boolean(!1),traceOnly:I.Boolean(!1),tryUseImpostor:I.Boolean(!0)});function rae(e,t,r,n){return r.tryUseImpostor&&n&&n.extensions.fragDepth?cut(e):dut(e)}function cut(e){return Gre({defaultProps:I.getDefaultValues(dA),createGeometry:lut,createLocationIterator:qa.fromGroup,getLoci:Wl,eachLocation:$l,setUpdateState:function(t,r,n){t.createGeometry=r.ignoreHydrogens!==n.ignoreHydrogens||r.traceOnly!==n.traceOnly},mustRecreate:function(t,r,n){return!r.tryUseImpostor||!n}},e)}function dut(e){return uo({defaultProps:I.getDefaultValues(dA),createGeometry:uut,createLocationIterator:qa.fromGroup,getLoci:Wl,eachLocation:$l,setUpdateState:function(t,r,n){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.detail!==n.detail||r.ignoreHydrogens!==n.ignoreHydrogens||r.traceOnly!==n.traceOnly},mustRecreate:function(t,r,n){return r.tryUseImpostor&&!!n}},e)}var nae={"element-sphere":function(e,t){return ii("Element sphere",e,t,rae)},"intra-bond":function(e,t){return ii("Intra-unit bond cylinder",e,t,Zie)},"inter-bond":function(e,t){return Ru("Inter-unit bond cylinder",e,t,eae)}},iae=E(E(E(E(E({},dA),{traceOnly:I.Boolean(!1,{isHidden:!0})}),sA),uA),{includeParent:I.Boolean(!1),unitKinds:f2(["atomic"]),sizeFactor:I.Numeric(.15,{min:.01,max:10,step:.01}),sizeAspectRatio:I.Numeric(2/3,{min:.01,max:3,step:.01}),visuals:I.MultiSelect(["element-sphere","intra-bond","inter-bond"],I.objectToOptions(nae))});function fut(e,t){return I.clone(iae)}function put(e,t){return or.createMulti("Ball & Stick",e,t,Ui,nae)}var hut={name:"ball-and-stick",label:"Ball & Stick",description:"Displays atoms as spheres and bonds as cylinders.",factory:put,getParams:fut,defaultValues:I.getDefaultValues(iae),defaultColorTheme:{name:"element-symbol"},defaultSizeTheme:{name:"physical"},isApplicable:function(e){return e.elementCount>0},getData:function(e,t){return t.includeParent?e.asParent():e},mustRecreate:function(e,t){return e.includeParent!==t.includeParent}};function vut(e,t,r,n,i){var a=t.carbohydrates,o=a.links,s=a.elements,u=n.linkSizeFactor,l=Ze.create(t),c={linkCount:o.length,position:function(d,f,p){var v=o[p];_.copy(d,s[v.carbohydrateIndexA].geometry.center),_.copy(f,s[v.carbohydrateIndexB].geometry.center)},radius:function(d){var f=o[d],p=s[f.carbohydrateIndexA],v=p.unit.rings.all[p.ringIndex];return l.unit=p.unit,l.element=p.unit.elements[v[0]],r.size.size(l)*u}};return Gv(e,c,n,i)}var aae=E(E(E({},Ea),Hv),{linkSizeFactor:I.Numeric(.3,{min:0,max:3,step:.01})});function mut(e){return zv({defaultProps:I.getDefaultValues(aae),createGeometry:vut,createLocationIterator:gut,getLoci:yut,eachLocation:but,setUpdateState:function(t,r,n){t.createGeometry=r.linkSizeFactor!==n.linkSizeFactor||r.radialSegments!==n.radialSegments||r.linkCap!==n.linkCap}},e)}function gut(e){var t=e.carbohydrates,r=t.elements,n=t.links,i=n.length,a=1,o=Ze.create(e),s=function(u){var l=n[u],c=r[l.carbohydrateIndexA],d=c.unit.rings.all[c.ringIndex];return o.unit=c.unit,o.element=c.unit.elements[d[0]],o};return Sn(i,a,1,s,!0)}function yut(e,t,r){var n=e.objectId,i=e.groupId;if(r===n){var a=t.carbohydrates,o=a.links,s=a.elements,u=o[i],l=s[u.carbohydrateIndexA],c=s[u.carbohydrateIndexB];return Re.union(kb(t,l.unit,l.residueIndex,l.altId),kb(t,c.unit,c.residueIndex,c.altId))}return Nr}function but(e,t,r){var n=!1;if(!Re.is(e)||!We.areEquivalent(e.structure,t))return!1;for(var i=t.carbohydrates.getLinkIndices,a=function(d,f){if(!je.isAtomic(d))return"continue";Le.forEach(f,function(p){for(var v=i(d,d.elements[p]),h=0,m=v.length;h<m;++h)r(Ie.ofSingleton(v[h]))&&(n=!0)})},o=0,s=e.elements;o<s.length;o++){var u=s[o],l=u.unit,c=u.indices;a(l,c)}return n}var xut=_.create(0,0,-.5),Sut=_.create(0,0,.5),Zd=_(),Jd=_(),rS=_(),iG=_();function Cut(e){for(var t=e.length/3,r=t===3?1:t===4?2:t,n=r+t,i=t===4?t*3+4:n*3,a=E0(n,i),o=0;o<t;++o){var s=(o+1)%t;_.set(Zd,e[o*3],e[o*3+1],-.5),_.set(Jd,e[s*3],e[s*3+1],-.5),a.add(Zd,Jd,Sut)}if(t===3)_.set(Zd,e[0],e[1],-.5),_.set(Jd,e[3],e[4],-.5),_.set(rS,e[6],e[7],-.5),a.add(rS,Jd,Zd);else if(t===4)_.set(Zd,e[0],e[1],-.5),_.set(Jd,e[3],e[4],-.5),_.set(rS,e[6],e[7],-.5),_.set(iG,e[9],e[10],-.5),a.addQuad(iG,rS,Jd,Zd);else for(var o=0;o<t;++o){var s=(o+1)%t;_.set(Zd,e[o*3],e[o*3+1],-.5),_.set(Jd,e[s*3],e[s*3+1],-.5),a.add(xut,Jd,Zd)}return a.getPrimitive()}var zT;function _ut(){return zT||(zT=Cut(ql(8,!0))),zT}var VT;function wut(){if(!VT){for(var e=ql(8,!0),t=new Float32Array(8*3+6),r=0;r<8;++r)t[r*3]=e[r*3],t[r*3+1]=e[r*3+1],t[r*3+2]=-.5;t[8*3]=0,t[8*3+1]=0,t[8*3+2]=-.5,t[8*3+3]=0,t[8*3+4]=0,t[8*3+5]=.5;var n=[0,1,8,1,2,8,4,5,8,5,6,8,2,3,9,3,4,9,6,7,9,7,0,9];VT=RE(t,n)}return VT}var Eut={pointCount:5,outerRadius:1,innerRadius:.5,thickness:.3},HT=_.zero(),GT=_.zero(),qT=_.zero(),xy=_.zero(),$T=_.zero();function Aut(e){for(var t=E(E({},Eut),e),r=t.outerRadius,n=t.innerRadius,i=t.thickness,a=t.pointCount,o=a*2*2,s=E0(o),u=new Float32Array(a*2),l=new Float32Array(a*2),c=0;c<a;++c){var d=c*2,f=c*2+1,p=(d+1)/a*Math.PI,v=(f+1)/a*Math.PI;l[d]=Math.cos(p)*r,l[f]=Math.sin(p)*r,u[d]=Math.cos(v)*n,u[f]=Math.sin(v)*n}_.set(HT,0,0,i/2),_.set(GT,0,0,-i/2);for(var c=0;c<a;++c){var h=(c+1)%a;_.set(qT,l[c*2],l[c*2+1],0),_.set(xy,u[c*2],u[c*2+1],0),_.set($T,l[h*2],l[h*2+1],0),s.add(HT,qT,xy),s.add(xy,qT,GT),s.add(HT,xy,$T),s.add($T,xy,GT)}return s.getPrimitive()}var oae=[.5,0,0,-.5,0,0,0,.5,0,0,-.5,0,0,0,.5,0,0,-.5],Put=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],Tut=[0,2,4,0,4,3,1,2,5,1,5,3],WT;function Iut(){return WT||(WT=RE(oae,Put)),WT}var XT;function Mut(){return XT||(XT=RE(oae,Tut)),XT}var Ot=ue.identity(),oc=_.zero(),aG=_.zero(),Dut=2*.806,oG=HL(),sG=M9e(),Rut=_ut(),uG=wut(),kut=Aut({outerRadius:1,innerRadius:.5,thickness:.5,pointCount:5}),Out=Iut(),lG=Mut(),cG=Qze(),Lut=Zze(),Fut=Jze(),Nut=eVe(),But=tVe();function Uut(e,t,r,n,i){for(var a=wt.createState(256,128,i),o=n.detail,s=n.sizeFactor,u=t.carbohydrates,l=u.elements.length,c=Ze.create(t),d=0;d<l;++d){var f=u.elements[d],p=f.unit.rings.all[f.ringIndex],v=mke(f.component.type,p.length);c.unit=f.unit,c.element=f.unit.elements[p[0]];var h=r.size.size(c),m=h*s,g=h*s*Dut,y=f.geometry,b=y.center,S=y.normal,x=y.direction;switch(_.add(aG,b,x),ue.targetTo(Ot,b,aG,S),ue.setTranslation(Ot,b),a.currentGroup=d*2,v){case 0:Ni(a,b,m,o);break;case 1:ue.scaleUniformly(Ot,Ot,g),wt.addPrimitive(a,Ot,oG);break;case 2:ue.scaleUniformly(Ot,Ot,g),wt.addPrimitive(a,Ot,sG),ue.mul(Ot,Ot,ue.rotZ90X180),a.currentGroup+=1,wt.addPrimitive(a,Ot,sG);break;case 4:ue.scaleUniformly(Ot,Ot,g*1.2),wt.addPrimitive(a,Ot,Rut);break;case 5:ue.scaleUniformly(Ot,Ot,g*1.2),wt.addPrimitive(a,Ot,uG),ue.mul(Ot,Ot,ue.rotZ90),a.currentGroup+=1,wt.addPrimitive(a,Ot,uG);break;case 6:ue.mul(Ot,Ot,ue.rotZY90),ue.scale(Ot,Ot,_.set(oc,g,g,g/2)),wt.addPrimitive(a,Ot,oG);break;case 7:ue.scaleUniformly(Ot,Ot,g),ue.mul(Ot,Ot,ue.rotZY90),wt.addPrimitive(a,Ot,kut);break;case 8:ue.mul(Ot,Ot,ue.rotZY90),ue.scale(Ot,Ot,_.set(oc,g*1.4,g*1.4,g*1.4)),wt.addPrimitive(a,Ot,Out);break;case 3:ue.mul(Ot,Ot,ue.rotZY90),ue.scale(Ot,Ot,_.set(oc,g*1.4,g*1.4,g*1.4)),wt.addPrimitive(a,Ot,lG),ue.mul(Ot,Ot,ue.rotY90),a.currentGroup+=1,wt.addPrimitive(a,Ot,lG);break;case 9:ue.mul(Ot,Ot,ue.rotZY90),ue.scale(Ot,Ot,_.set(oc,g,g/2,g/2)),wt.addPrimitive(a,Ot,cG);break;case 12:ue.mul(Ot,Ot,ue.rotZY90),ue.scale(Ot,Ot,_.set(oc,g,g,g/2)),wt.addPrimitive(a,Ot,cG);break;case 13:case 11:ue.mul(Ot,Ot,ue.rotZY90),ue.scale(Ot,Ot,_.set(oc,g,g,g/2)),wt.addPrimitive(a,Ot,Lut);break;case 14:ue.mul(Ot,Ot,ue.rotZY90),ue.scale(Ot,Ot,_.set(oc,g,g,g/2)),wt.addPrimitive(a,Ot,Fut);break;case 15:ue.mul(Ot,Ot,ue.rotZY90),ue.scale(Ot,Ot,_.set(oc,g,g,g/2)),wt.addPrimitive(a,Ot,But);break;case 10:default:ue.mul(Ot,Ot,ue.rotZYZ90),ue.scale(Ot,Ot,_.set(oc,g/1.5,g,g/2)),wt.addPrimitive(a,Ot,Nut);break}}return wt.getMesh(a)}var sae=E(E({},p2),{detail:I.Numeric(0,{min:0,max:3,step:1},Et.CustomQualityParamInfo),sizeFactor:I.Numeric(1.75,{min:0,max:10,step:.01})});function jut(e){return zv({defaultProps:I.getDefaultValues(sae),createGeometry:Uut,createLocationIterator:zut,getLoci:Vut,eachLocation:Hut,setUpdateState:function(t,r,n){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.detail!==n.detail}},e)}function zut(e){var t=e.carbohydrates.elements,r=t.length*2,n=1,i=Ze.create(e);function a(s,u){var l=t[Math.floor(s/2)],c=l.unit.rings.all[l.ringIndex];return i.unit=l.unit,i.element=l.unit.elements[c[0]],i}function o(s,u){return s%2===1}return Sn(r,n,1,a,!0,o)}function Vut(e,t,r){var n=e.objectId,i=e.groupId;if(r===n){var a=t.carbohydrates.elements[Math.floor(i/2)];return kb(t,a.unit,a.residueIndex,a.altId)}return Nr}function Hut(e,t,r){var n=t.carbohydrates.getElementIndices,i=!1;if(!Re.is(e)||!We.areEquivalent(e.structure,t))return!1;for(var a=function(d,f){if(!je.isAtomic(d))return"continue";Le.forEach(f,function(p){for(var v=n(d,d.elements[p]),h=0,m=v.length;h<m;++h)r(Ie.ofSingleton(v[h]*2))&&(i=!0)})},o=0,s=e.elements;o<s.length;o++){var u=s[o],l=u.unit,c=u.indices;a(l,c)}return i}function Gut(e,t,r,n,i){var a=t.carbohydrates,o=a.terminalLinks,s=a.elements,u=n.terminalLinkSizeFactor,l=Ze.create(t),c={linkCount:o.length,position:function(d,f,p){var v=o[p];v.fromCarbohydrate?(_.copy(d,s[v.carbohydrateIndex].geometry.center),v.elementUnit.conformation.position(v.elementUnit.elements[v.elementIndex],f)):(v.elementUnit.conformation.position(v.elementUnit.elements[v.elementIndex],d),_.copy(f,s[v.carbohydrateIndex].geometry.center))},radius:function(d){var f=o[d];if(f.fromCarbohydrate){var p=s[f.carbohydrateIndex],v=p.unit.rings.all[p.ringIndex];l.unit=p.unit,l.element=p.unit.elements[v[0]]}else l.unit=f.elementUnit,l.element=f.elementUnit.elements[f.elementIndex];return r.size.size(l)*u},style:function(d){var f=o[d],p=f.elementUnit.elements[f.elementIndex],v=Wg(f.elementUnit.model.atomicHierarchy.atoms.type_symbol.value(p));return Pb.has(v)?1:0}};return Gv(e,c,n,i)}var uae=E(E(E({},Ea),Hv),{terminalLinkSizeFactor:I.Numeric(.2,{min:0,max:3,step:.01})});function qut(e){return zv({defaultProps:I.getDefaultValues(uae),createGeometry:Gut,createLocationIterator:$ut,getLoci:Wut,eachLocation:Xut,setUpdateState:function(t,r,n){t.createGeometry=r.terminalLinkSizeFactor!==n.terminalLinkSizeFactor||r.radialSegments!==n.radialSegments||r.linkCap!==n.linkCap}},e)}function $ut(e){var t=e.carbohydrates,r=t.elements,n=t.terminalLinks,i=n.length,a=1,o=Ze.create(e),s=function(u){var l=n[u];if(l.fromCarbohydrate){var c=r[l.carbohydrateIndex],d=c.unit.rings.all[c.ringIndex];o.unit=c.unit,o.element=c.unit.elements[d[0]]}else o.unit=l.elementUnit,o.element=l.elementUnit.elements[l.elementIndex];return o};return Sn(i,a,1,s,!0)}function Wut(e,t,r){var n=e.objectId,i=e.groupId;if(r===n){var a=t.carbohydrates,o=a.terminalLinks,s=a.elements,u=o[i],l=s[u.carbohydrateIndex];return Re.union(kb(t,l.unit,l.residueIndex,l.altId),qYe(t,u.elementUnit,u.elementUnit.elements[u.elementIndex]))}return Nr}function Xut(e,t,r){var n=!1;if(!Re.is(e)||!We.areEquivalent(e.structure,t))return!1;for(var i=t.carbohydrates.getTerminalLinkIndices,a=function(d,f){if(!je.isAtomic(d))return"continue";Le.forEach(f,function(p){for(var v=i(d,d.elements[p]),h=0,m=v.length;h<m;++h)r(Ie.ofSingleton(v[h]))&&(n=!0)})},o=0,s=e.elements;o<s.length;o++){var u=s[o],l=u.unit,c=u.indices;a(l,c)}return n}var lae={"carbohydrate-symbol":function(e,t){return Ru("Carbohydrate symbol mesh",e,t,jut)},"carbohydrate-link":function(e,t){return Ru("Carbohydrate link cylinder",e,t,mut)},"carbohydrate-terminal-link":function(e,t){return Ru("Carbohydrate terminal link cylinder",e,t,qut)}},cae=E(E(E(E({},sae),aae),uae),{visuals:I.MultiSelect(["carbohydrate-symbol","carbohydrate-link","carbohydrate-terminal-link"],I.objectToOptions(lae))});function Yut(e,t){return I.clone(cae)}function Kut(e,t){return or.createMulti("Carbohydrate",e,t,Ui,lae)}var Qut={name:"carbohydrate",label:"Carbohydrate",description:"Displays carbohydrate symbols (3D SNFG).",factory:Kut,getParams:Yut,defaultValues:I.getDefaultValues(cae),defaultColorTheme:{name:"carbohydrate-symbol"},defaultSizeTheme:{name:"uniform"},isApplicable:function(e){return e.models.some(function(t){return $t.hasCarbohydrate(t)})}};function dae(e,t){switch(e.kind){case 0:return Zut(e,t);case 1:case 2:return Jut(e,t)}}function Zut(e,t){for(var r=e.model.atomicRanges.cyclicPolymerMap,n=en.transientSegments(_2(e),e.elements),i=nr.transientSegments(e.model.atomicHierarchy.residueAtomSegments,e.elements),a=e.model.atomicHierarchy.derived.residue.traceElementIndex,o=e.model.atomicHierarchy.derived.residue.moleculeType,s=-1,u=-1,l=!0,c=-1,d=0;n.hasNext;){for(l=!0,c=d,i.setSegment(n.move());i.hasNext;){if(l){var f=i.move().index;if(++d,!i.hasNext)continue;l=!1,u=f}var p=i.move().index;s=u,u=p,t(a[s],a[u],d-1,d,o[s]),++d}r.has(u)&&(s=u,u=r.get(s),t(a[s],a[u],d-1,c,o[s]))}}function Jut(e,t){for(var r=en.transientSegments(_2(e),e.elements),n=e.elements,i=!0,a=0;r.hasNext;){i=!0;for(var o=r.move(),s=o.start,u=o.end,l=s,c=u;l<c;++l){if(i){if(++l,++a,l>c)continue;i=!1}t(n[l-1],n[l],a-1,a,0),++a}}}function fae(e,t){switch(e.kind){case 0:return elt(e,t);case 1:case 2:return tlt(e,t)}}function elt(e,t){for(var r=en.transientSegments(_2(e),e.elements),n=nr.transientSegments(e.model.atomicHierarchy.residueAtomSegments,e.elements),i=e.model.atomicHierarchy.derived.residue.traceElementIndex,a=0;r.hasNext;)for(n.setSegment(r.move());n.hasNext;){var o=n.move().index;t(i[o],a),++a}}function tlt(e,t){for(var r=en.transientSegments(_2(e),e.elements),n=e.elements,i=0;r.hasNext;)for(var a=r.move(),o=a.start,s=a.end,u=o,l=s;u<l;++u)t(n[u],i),++i}function rlt(e,t){switch(t.kind){case 0:return new nlt(e,t);case 1:case 2:return new ilt(e,t)}}function pae(e,t){return{centerA:Ze.create(e,t),centerB:Ze.create(e,t)}}var nlt=function(){function e(t,r){this.unit=r,this.hasNext=!1,this.traceElementIndex=r.model.atomicHierarchy.derived.residue.traceElementIndex,this.gapIt=en.transientSegments(mae(r),r.elements),this.value=pae(t,r),this.hasNext=this.gapIt.hasNext}return e.prototype.move=function(){var t=this.unit,r=t.elements,n=t.residueIndex,i=this.gapIt.move();return this.value.centerA.element=this.traceElementIndex[n[r[i.start]]],this.value.centerB.element=this.traceElementIndex[n[r[i.end-1]]],this.hasNext=this.gapIt.hasNext,this.value},e}(),ilt=function(){function e(t,r){this.unit=r,this.hasNext=!1,this.gapIt=en.transientSegments(mae(r),r.elements),this.value=pae(t,r),this.hasNext=this.gapIt.hasNext}return e.prototype.move=function(){var t=this.gapIt.move();return this.value.centerA.element=this.unit.elements[t.start],this.value.centerB.element=this.unit.elements[t.end-1],this.hasNext=this.gapIt.hasNext,this.value},e}();function alt(e){for(var t=e.atomicConformation,r=t.x,n=t.y,i=t.z,a=e.atomicHierarchy.derived.residue,o=a.polymerType,s=a.traceElementIndex,u=o.length,l=Le.ofBounds(0,e.atomicConformation.atomId.rowCount),c=en.transientSegments(e.atomicRanges.polymerRanges,l),d=nr.transientSegments(e.atomicHierarchy.residueAtomSegments,l),f=new Float32Array(u*3),p=new Float32Array(u*3),v=0,h=-1,m=-1,g=_(),y=_(),b=_(),S=_(),x=_(),C=_(),w=_(),A=_(),M=_(),D=_(),k=_(),R=_(),O=_(),H=_();c.hasNext;){var B=c.move();for(d.setSegment(B),v=-1,m=-1;d.hasNext;){v+=1;var j=d.move().index;v===0&&(m=j),h=j-2;var Y=h*3;_.copy(g,y),_.copy(y,b),_.copy(b,S);var G=s[j];if(_.set(S,r[G],n[G],i[G]),!(v<3)){_.sub(x,y,g),_.sub(C,b,y),_.sub(w,S,b),_.sub(k,x,C),_.sub(R,C,w),_.cross(O,k,R),_.normalize(O,O),_.toArray(O,p,Y);var $=Math.cos(_.angle(k,R)),q=_.magnitude(k),ee=_.magnitude(R),fe=Math.sqrt(ee*q)/Math.max(2,2*(1-$));_.scale(A,k,fe/q),_.sub(A,y,A),_.toArray(A,f,Y),_.scale(M,R,fe/ee),_.sub(M,b,M),_.toArray(M,f,Y+3),_.copy(H,O)}}var W=m*3;_.fromArray(A,f,W+3),_.fromArray(M,f,W+6),_.normalize(O,_.sub(O,A,M));var X=s[m];_.set(g,r[X],n[X],i[X]),_.copy(D,g),_.projectPointOnVector(D,D,O,A),_.toArray(D,f,W);var U=h+2,z=U*3;_.fromArray(A,f,z-3),_.fromArray(M,f,z-6),_.normalize(O,_.sub(O,A,M));var J=s[U];_.set(g,r[J],n[J],i[J]),_.copy(D,g),_.projectPointOnVector(D,D,O,A),_.toArray(D,f,z)}return{centers:f}}var TR=mv.createProvider({label:"Helix Orientation",descriptor:To({name:"molstar_helix_orientation"}),type:"dynamic",defaultParams:{},getParams:function(){return{}},isApplicable:function(e){return!0},obtain:function(e,t){return ce(void 0,void 0,void 0,function(){return de(this,function(r){return[2,{value:alt(t)}]})})}});function lu(e){return Br.is(e,2)}function olt(e){return Br.is(e,4)}function e6(e,t,r){switch(r===void 0&&(r={}),e.kind){case 0:return new slt(e,t,r);case 1:case 2:return new ult(e,t)}}var sC=Br.create(536870912);function hae(e,t){return{center:Ze.create(e,t),centerPrev:Ze.create(e,t),centerNext:Ze.create(e,t),first:!1,last:!1,initial:!1,final:!1,secStrucFirst:!1,secStrucLast:!1,secStrucType:sC,moleculeType:0,coarseBackboneFirst:!1,coarseBackboneLast:!1,isCoarseBackbone:!1,p0:_(),p1:_(),p2:_(),p3:_(),p4:_(),d12:_(),d23:_()}}var Kt=_(),nS=_(),iS=_(),slt=function(){function e(t,r,n){n===void 0&&(n={});var i;if(this.unit=t,this.state=0,this.p0=_(),this.p1=_(),this.p2=_(),this.p3=_(),this.p4=_(),this.p5=_(),this.p6=_(),this.d01=_(),this.d12=_(),this.d23=_(),this.d34=_(),this.hasNext=!1,this.atomicConformation=t.model.atomicConformation,this.residueAtomSegments=t.model.atomicHierarchy.residueAtomSegments,this.polymerRanges=t.model.atomicRanges.polymerRanges,this.traceElementIndex=t.model.atomicHierarchy.derived.residue.traceElementIndex,this.directionFromElementIndex=t.model.atomicHierarchy.derived.residue.directionFromElementIndex,this.directionToElementIndex=t.model.atomicHierarchy.derived.residue.directionToElementIndex,this.moleculeType=t.model.atomicHierarchy.derived.residue.moleculeType,this.cyclicPolymerMap=t.model.atomicRanges.cyclicPolymerMap,this.polymerIt=en.transientSegments(this.polymerRanges,t.elements),this.residueIt=nr.transientSegments(this.residueAtomSegments,t.elements),this.value=hae(r,t),this.hasNext=this.residueIt.hasNext&&this.polymerIt.hasNext,n.ignoreSecondaryStructure||(this.secondaryStructure=(i=zl.get(r).value)===null||i===void 0?void 0:i.get(t.invariantId)),n.useHelixOrientation){var a=TR.get(t.model).value;if(!a)throw new Error("missing helix-orientation");this.helixOrientationCenters=a.centers}}return e.prototype.atomicPos=function(t,r){r!==-1&&(t[0]=this.atomicConformation.x[r],t[1]=this.atomicConformation.y[r],t[2]=this.atomicConformation.z[r])},e.prototype.pos=function(t,r,n){var i=this.traceElementIndex[r];this.helixOrientationCenters&&lu(n)?_.fromArray(t,this.helixOrientationCenters,r*3):this.atomicPos(t,i)},e.prototype.updateResidueSegmentRange=function(t){var r=this.residueAtomSegments.index;this.residueSegmentMin=r[this.polymerRanges[t.index*2]],this.residueSegmentMax=r[this.polymerRanges[t.index*2+1]]},e.prototype.getResidueIndex=function(t){if(t<this.residueSegmentMin){var r=this.cyclicPolymerMap.get(this.residueSegmentMin);r!==void 0?t=r-(this.residueSegmentMin-t-1):t=this.residueSegmentMin}else if(t>this.residueSegmentMax){var r=this.cyclicPolymerMap.get(this.residueSegmentMax);r!==void 0?t=r+(t-this.residueSegmentMax-1):t=this.residueSegmentMax}return t},e.prototype.getSecStruc=function(t){if(this.secondaryStructure){var r=this.secondaryStructure,n=r.type,i=r.getIndex,a=n[i(t)];return lu(a)?2:a}else return sC},e.prototype.setControlPoint=function(t,r,n,i,a){olt(a)||this.helixOrientationCenters&&lu(a)?_.scale(t,_.add(t,r,_.add(t,i,_.add(t,n,n))),1/4):_.copy(t,n)},e.prototype.setFromToVector=function(t,r,n){this.value.isCoarseBackbone||this.helixOrientationCenters&&lu(n)?_.set(t,1,0,0):(this.atomicPos(nS,this.directionFromElementIndex[r]),this.atomicPos(iS,this.directionToElementIndex[r]),_.sub(t,iS,nS))},e.prototype.setDirection=function(t,r,n,i){_.matchDirection(nS,r,n),_.matchDirection(iS,i,n),_.scale(t,_.add(t,nS,_.add(t,iS,_.add(t,n,n))),1/4)},e.prototype.move=function(){var t=this,r=t.residueIt,n=t.polymerIt,i=t.value;if(this.state===0){for(;n.hasNext;)if(this.polymerSegment=n.move(),r.setSegment(this.polymerSegment),this.updateResidueSegmentRange(this.polymerSegment),r.hasNext){this.state=1;var a=this.residueAtomSegments.index[this.unit.elements[this.polymerSegment.start]],o=this.getResidueIndex(a-1);this.currSecStrucType=a===o?sC:this.getSecStruc(o),this.nextSecStrucType=this.getSecStruc(a),this.currCoarseBackbone=this.directionFromElementIndex[o]===-1||this.directionToElementIndex[o]===-1,this.nextCoarseBackbone=this.directionFromElementIndex[a]===-1||this.directionToElementIndex[a]===-1;break}}if(this.state===1){var s=r.move().index,u=this.getResidueIndex(s-3),l=this.getResidueIndex(s-2),c=this.getResidueIndex(s-1),d=this.getResidueIndex(s+1),f=this.getResidueIndex(s+2),p=this.getResidueIndex(s+3);this.prevSecStrucType=this.currSecStrucType,this.currSecStrucType=this.nextSecStrucType,this.nextSecStrucType=s===d?sC:this.getSecStruc(d),this.prevCoarseBackbone=this.currCoarseBackbone,this.currCoarseBackbone=this.nextCoarseBackbone,this.nextCoarseBackbone=this.directionFromElementIndex[d]===-1||this.directionToElementIndex[d]===-1,i.secStrucType=this.currSecStrucType,i.secStrucFirst=this.prevSecStrucType!==this.currSecStrucType,i.secStrucLast=this.currSecStrucType!==this.nextSecStrucType,i.isCoarseBackbone=this.currCoarseBackbone,i.coarseBackboneFirst=this.prevCoarseBackbone!==this.currCoarseBackbone,i.coarseBackboneLast=this.currCoarseBackbone!==this.nextCoarseBackbone,i.first=s===this.residueSegmentMin,i.last=s===this.residueSegmentMax,i.moleculeType=this.moleculeType[s],i.initial=s===c,i.final=s===d,i.centerPrev.element=this.traceElementIndex[c],i.center.element=this.traceElementIndex[s],i.centerNext.element=this.traceElementIndex[d];var v=this.getSecStruc(u),h=this.getSecStruc(l),m=this.getSecStruc(c),g=this.getSecStruc(s),y=this.getSecStruc(d),b=this.getSecStruc(f),S=this.getSecStruc(p);this.pos(this.p0,u,v),this.pos(this.p1,l,h),this.pos(this.p2,c,m),this.pos(this.p3,s,g),this.pos(this.p4,d,y),this.pos(this.p5,f,b),this.pos(this.p6,p,S);var x=lu(v),C=lu(h),w=lu(m),A=lu(g),M=lu(y),D=lu(b),k=lu(S);this.helixOrientationCenters&&(A!==w?A?(_.copy(this.p0,this.p3),_.copy(this.p1,this.p3),_.copy(this.p2,this.p3)):w&&(_.scale(Kt,_.sub(Kt,this.p2,this.p3),2),_.add(this.p2,this.p3,Kt),_.add(this.p1,this.p2,Kt),_.add(this.p0,this.p1,Kt)):A!==C?A?(_.copy(this.p0,this.p2),_.copy(this.p1,this.p2)):C&&(_.scale(Kt,_.sub(Kt,this.p1,this.p2),2),_.add(this.p1,this.p2,Kt),_.add(this.p0,this.p1,Kt)):A!==x&&(A?_.copy(this.p0,this.p1):x&&(_.scale(Kt,_.sub(Kt,this.p0,this.p1),2),_.add(this.p0,this.p1,Kt))),A!==M?A?(_.copy(this.p4,this.p3),_.copy(this.p5,this.p3),_.copy(this.p6,this.p3)):M&&(_.scale(Kt,_.sub(Kt,this.p4,this.p3),2),_.add(this.p4,this.p3,Kt),_.add(this.p5,this.p4,Kt),_.add(this.p6,this.p5,Kt)):A!==D?A?(_.copy(this.p5,this.p4),_.copy(this.p6,this.p4)):D&&(_.scale(Kt,_.sub(Kt,this.p5,this.p4),2),_.add(this.p5,this.p4,Kt),_.add(this.p6,this.p5,Kt)):A!==k&&(A?_.copy(this.p6,this.p5):k&&(_.scale(Kt,_.sub(Kt,this.p6,this.p5),2),_.add(this.p6,this.p5,Kt)))),this.setFromToVector(this.d01,c,m),this.setFromToVector(this.d12,s,g),this.setFromToVector(this.d23,d,y),this.setFromToVector(this.d34,f,b);var R=A&&this.helixOrientationCenters,O=1.5;s===c||g!==m&&R?(_.setMagnitude(Kt,_.sub(Kt,this.p3,this.p4),O),_.add(this.p2,this.p3,Kt),_.add(this.p1,this.p2,Kt),_.add(this.p0,this.p1,Kt)):c===l||g!==h&&R?(_.setMagnitude(Kt,_.sub(Kt,this.p2,this.p3),O),_.add(this.p1,this.p2,Kt),_.add(this.p0,this.p1,Kt)):(l===u||g!==v&&R)&&(_.setMagnitude(Kt,_.sub(Kt,this.p1,this.p2),O),_.add(this.p0,this.p1,Kt)),s===d||g!==y&&R?(_.setMagnitude(Kt,_.sub(Kt,this.p3,this.p2),O),_.add(this.p4,this.p3,Kt),_.add(this.p5,this.p4,Kt),_.add(this.p6,this.p5,Kt)):d===f||g!==b&&R?(_.setMagnitude(Kt,_.sub(Kt,this.p4,this.p3),O),_.add(this.p5,this.p4,Kt),_.add(this.p6,this.p5,Kt)):(f===p||g!==S&&R)&&(_.setMagnitude(Kt,_.sub(Kt,this.p5,this.p4),O),_.add(this.p6,this.p5,Kt)),this.setControlPoint(i.p0,this.p0,this.p1,this.p2,h),this.setControlPoint(i.p1,this.p1,this.p2,this.p3,m),this.setControlPoint(i.p2,this.p2,this.p3,this.p4,g),this.setControlPoint(i.p3,this.p3,this.p4,this.p5,y),this.setControlPoint(i.p4,this.p4,this.p5,this.p6,b),this.setDirection(i.d12,this.d01,this.d12,this.d23),this.setDirection(i.d23,this.d12,this.d23,this.d34),r.hasNext||(this.state=0)}return this.hasNext=r.hasNext||n.hasNext,this.value},e}(),ult=function(){function e(t,r){switch(this.unit=t,this.state=0,this.hasNext=!1,this.polymerIt=en.transientSegments(_2(t),t.elements),this.value=hae(r,t),_.set(this.value.d12,1,0,0),_.set(this.value.d23,1,0,0),t.kind){case 1:this.conformation=t.model.coarseConformation.spheres;break;case 2:this.conformation=t.model.coarseConformation.gaussians;break}this.hasNext=this.polymerIt.hasNext}return e.prototype.getElementIndex=function(t){return Math.min(Math.max(this.polymerSegment.start,t),this.polymerSegment.end-1)},e.prototype.pos=function(t,r){var n=this.unit.elements[r];t[0]=this.conformation.x[n],t[1]=this.conformation.y[n],t[2]=this.conformation.z[n]},e.prototype.move=function(){if(this.state===0){for(;this.polymerIt.hasNext;)if(this.polymerSegment=this.polymerIt.move(),this.elementIndex=this.polymerSegment.start,this.elementIndex<this.polymerSegment.end){this.state=1;break}}if(this.state===1){var t=this.getElementIndex(this.elementIndex-2),r=this.getElementIndex(this.elementIndex-1),n=this.getElementIndex(this.elementIndex+1),i=this.getElementIndex(this.elementIndex+2);this.value.centerPrev.element=this.value.center.unit.elements[r],this.value.center.element=this.value.center.unit.elements[this.elementIndex],this.value.centerNext.element=this.value.center.unit.elements[n],this.pos(this.value.p0,t),this.pos(this.value.p1,r),this.pos(this.value.p2,this.elementIndex),this.pos(this.value.p3,n),this.pos(this.value.p4,i);var a=.5;this.elementIndex===r?(_.scale(Kt,_.sub(Kt,this.value.p2,this.value.p3),a),_.add(this.value.p1,this.value.p2,Kt),_.add(this.value.p0,this.value.p1,Kt)):r===t&&(_.scale(Kt,_.sub(Kt,this.value.p1,this.value.p2),a),_.add(this.value.p0,this.value.p1,Kt)),this.elementIndex===n?(_.scale(Kt,_.sub(Kt,this.value.p2,this.value.p1),a),_.add(this.value.p3,this.value.p2,Kt),_.add(this.value.p4,this.value.p3,Kt)):n===i&&(_.scale(Kt,_.sub(Kt,this.value.p3,this.value.p2),a),_.add(this.value.p4,this.value.p3,Kt)),this.value.first=this.elementIndex===this.polymerSegment.start,this.value.last=this.elementIndex===this.polymerSegment.end-1,this.elementIndex+1>=this.polymerSegment.end&&(this.state=0)}return this.hasNext=this.elementIndex+1<this.polymerSegment.end||this.polymerIt.hasNext,this.elementIndex+=1,this.value},e}(),Yp=_.fromArray,Jm=_.toArray,IR=_.normalize,llt=_.sub,_m=_.spline,clt=_.slerp,dG=_.copy,fG=_.cross,YT=_.orthogonalize,dlt=_.matchDirection,flt=_.scale,pG=_.add;function t6(e){var t=e+1,r=t*3;return{curvePoints:new Float32Array(r),tangentVectors:new Float32Array(r),normalVectors:new Float32Array(r),binormalVectors:new Float32Array(r),widthValues:new Float32Array(t),heightValues:new Float32Array(t),linearSegments:e}}function r6(e,t,r,n){plt(e,t,r,n),vlt(e,t)}var KT=_(),QT=_(),ZT=_();function plt(e,t,r,n){for(var i=e.curvePoints,a=e.tangentVectors,o=e.linearSegments,s=t.p0,u=t.p1,l=t.p2,c=t.p3,d=t.p4,f=t.secStrucFirst,p=t.secStrucLast,v=1-n,h=f?.5:r,m=p?.5:r,g=0;g<=o;++g){var y=g*1/o;if(y<v){var b=Xo(h,r,y);_m(ZT,s,u,l,c,y+n,b),_m(KT,s,u,l,c,y+n+.01,h),_m(QT,s,u,l,c,y+n-.01,h)}else{var b=Xo(r,m,y);_m(ZT,u,l,c,d,y-v,b),_m(KT,u,l,c,d,y-v+.01,b),_m(QT,u,l,c,d,y-v-.01,b)}Jm(ZT,i,g*3),IR(Af,llt(Af,KT,QT)),Jm(Af,a,g*3)}}var hlt=_(),Af=_(),cu=_(),wm=_(),Sy=_(),hG=_(),vG=_(),mG=_(),JT=_(),aS=_();function vlt(e,t){var r=e.curvePoints,n=e.tangentVectors,i=e.normalVectors,a=e.binormalVectors,o=t.d12,s=t.d23,u=r.length/3;Yp(vG,n,0),Yp(mG,n,(u-1)*3),YT(JT,vG,o),YT(aS,mG,s),dlt(aS,aS,JT),dG(Sy,JT);for(var l=u-1,c=0;c<u;++c){var d=zQ(0,l,c)*l,f=c===0?0:1/(u-d);Yp(Af,n,c*3),YT(cu,Af,clt(hlt,Sy,aS,f)),Jm(cu,i,c*3),dG(Sy,cu),IR(wm,fG(wm,Af,cu)),Jm(wm,a,c*3)}for(var c=1;c<l;++c)Yp(Sy,i,(c-1)*3),Yp(cu,i,c*3),Yp(hG,i,(c+1)*3),flt(cu,pG(cu,Sy,pG(cu,hG,cu)),1/3),Jm(cu,i,c*3),Yp(Af,n,c*3),IR(wm,fG(wm,Af,cu)),Jm(wm,a,c*3)}function MR(e,t,r,n,i,a,o,s){for(var u=e.widthValues,l=e.heightValues,c=e.linearSegments,d=1-s,f=0;f<=c;++f){var p=f*1/c;p<d?(u[f]=Xo(t,r,p+s),l[f]=Xo(i,a,p+s)):(u[f]=Xo(r,n,p-d),l[f]=Xo(a,o,p-d))}}var vae=.5,mlt=.9,fA=.5,pA=.3,jw=2;function _2(e){switch(e.kind){case 0:return e.model.atomicRanges.polymerRanges;case 1:return e.model.coarseHierarchy.spheres.polymerRanges;case 2:return e.model.coarseHierarchy.gaussians.polymerRanges}}function mae(e){switch(e.kind){case 0:return e.model.atomicRanges.gapRanges;case 1:return e.model.coarseHierarchy.spheres.gapRanges;case 2:return e.model.coarseHierarchy.gaussians.gapRanges}}var fd;(function(e){function t(r){var n=r.group,i=r.structure,a=n.units[0].polymerElements,o=a.length,s=n.units.length,u=Ze.create(i),l=function(c,d){var f=n.units[d];return u.unit=f,u.element=a[c],u};return Sn(o,s,1,l)}e.fromGroup=t})(fd||(fd={}));var DR;(function(e){function t(r){var n=r.group,i=r.structure,a=n.units[0].gapElements,o=a.length,s=n.units.length,u=Ze.create(i),l=function(c,d){var f=n.units[d];return u.unit=f,u.element=a[c],u};return Sn(o,s,1,l)}e.fromGroup=t})(DR||(DR={}));function Xv(e,t,r){var n=e.objectId,i=e.instanceId,a=e.groupId;if(r===n){var o=t.structure,s=t.group,u=s.units[i];if(je.isAtomic(u))return Rre(o,u,u.polymerElements[a]);var l=u.elements,c=u.polymerElements[a],d=Le.indexOf(l,c);if(d!==-1){var f=Le.ofSingleton(d);return Re(o,[{unit:u,indices:f}])}}return Nr}function gG(e,t,r,n,i,a){for(var o=-1,s=-1,u=i;u<=a;u++){var l=r[u];if(!(l<0)&&(o=Le.indexOf(t,l),o>=0)){s=u;break}}if(o<0)return!1;for(var c=o,u=a;u>s;u--){var l=r[u];if(!(l<0)){var d=Le.indexOf(t,l);if(d>=0){c=d;break}}}return n(Ie.ofRange(e+o,e+c))}function gae(e,t,r,n,i){var a=!1,o=i.unit.elements,s=i.unit.model.atomicHierarchy.derived.residue.traceElementIndex,u=i.unit.model.atomicHierarchy.residueAtomSegments.index,l=r(i.unit);if(Ie.is(i.indices))if(Ie.start(i.indices)===0&&Ie.end(i.indices)===i.unit.elements.length)a=n(Ie.ofBounds(e,e+t))||a;else{var c=u[o[Ie.min(i.indices)]],d=u[o[Ie.max(i.indices)]];a=gG(e,l,s,n,c,d)||a}else for(var f=i.indices,p=0,v=f.length;p<v;p++){for(var c=u[o[f[p]]],d=c,h=p+1;h<v;){var m=u[o[f[h]]];if(m-d>1)break;d=m,h++}p=h-1,a=gG(e,l,s,n,c,d)||a}return a}function glt(e){return e.polymerElements}function Yv(e,t,r){var n=!1;if(!Re.is(e))return!1;var i=t.structure,a=t.group;if(!We.areEquivalent(e.structure,i))return!1;for(var o=a.units[0].polymerElements.length,s=0,u=e.elements;s<u.length;s++){var l=u[s];if(a.unitIndexMap.has(l.unit.id)){var c=a.unitIndexMap.get(l.unit.id)*o;if(je.isAtomic(l.unit))n=gae(c,o,glt,r,l)||n;else if(Ie.is(l.indices)){var d=c+Ie.start(l.indices),f=c+Ie.end(l.indices);n=r(Ie.ofBounds(d,f))||n}else for(var p=0,v=l.indices.length;p<v;p++){for(var d=l.indices[p],h=p+1;h<v&&l.indices[h]===d;)h++;p=h-1;var f=l.indices[p];n=r(Ie.ofRange(c+d,c+f))||n}}}return n}function ylt(e,t,r){var n=e.objectId,i=e.instanceId,a=e.groupId;if(r===n){var o=t.structure,s=t.group,u=s.units[i],l=Le.indexOf(u.elements,u.gapElements[a]),c=Le.indexOf(u.elements,u.gapElements[a%2?a-1:a+1]);if(l!==-1&&c!==-1)return Vt.Loci(o,[Vt.Location(o,u,l,o,u,c),Vt.Location(o,u,c,o,u,l)])}return Nr}function blt(e,t,r){var n=!1;if(Vt.isLoci(e)){var i=t.structure,a=t.group;if(!We.areRootsEquivalent(e.structure,i))return!1;e=Vt.remapLoci(e,i);for(var o=a.units[0].gapElements.length,s=0,u=e.bonds;s<u.length;s++){var l=u[s],c=a.unitIndexMap.get(l.aUnit.id);if(c!==void 0){var d=Le.indexOf(l.aUnit.gapElements,l.aUnit.elements[l.aIndex]),f=Le.indexOf(l.bUnit.gapElements,l.bUnit.elements[l.bIndex]);d!==-1&&f!==-1&&r(Ie.ofSingleton(c*o+d))&&(n=!0)}}}else if(Re.is(e)){var i=t.structure,a=t.group;if(!We.areRootsEquivalent(e.structure,i))return!1;e=Re.remap(e,i);for(var p=a.units[0].gapElements.length,v=function(S){var x=a.unitIndexMap.get(S.unit.id);x!==void 0&&Le.forEach(S.indices,function(C){var w=Le.indexOf(S.unit.gapElements,S.unit.elements[C]);w!==-1&&r(Ie.ofSingleton(x*p+w))&&(n=!0)})},h=0,m=e.elements;h<m.length;h++){var g=m[h];v(g)}}return n}var zw;(function(e){function t(r){var n=r.group,i=r.structure,a=n.units[0],o=je.isAtomic(a)?a.nucleotideElements:[],s=o.length,u=n.units.length,l=Ze.create(i),c=function(d,f){var p=n.units[f];return l.unit=p,l.element=o[d],l};return Sn(s,u,1,c)}e.fromGroup=t})(zw||(zw={}));function yae(e,t,r){var n=e.objectId,i=e.instanceId,a=e.groupId;if(r===n){var o=t.structure,s=t.group,u=s.units[i];if(je.isAtomic(u))return Rre(o,u,u.nucleotideElements[a])}return Nr}function xlt(e){return e.nucleotideElements}function bae(e,t,r){var n=!1;if(!Re.is(e))return!1;var i=t.structure,a=t.group;if(!We.areEquivalent(e.structure,i))return!1;var o=a.units[0];if(!je.isAtomic(o))return!1;for(var s=o.nucleotideElements,u=s.length,l=0,c=e.elements;l<c.length;l++){var d=c[l];if(je.isAtomic(d.unit)&&a.unitIndexMap.has(d.unit.id)){var f=a.unitIndexMap.get(d.unit.id)*u;je.isAtomic(d.unit)&&(n=gae(f,u,xlt,r,d)||n)}}return n}var Cy=_.zero(),oS=_.zero(),yG=_.zero(),bG=_.zero(),xG=_.zero(),SG=_.zero(),sS=_.zero(),eI=_.zero(),tI=_.zero(),CG=_.zero(),_y=ue.identity(),Slt=_.zero(),_G=HL(),xae={sizeFactor:I.Numeric(.2,{min:0,max:10,step:.01}),radialSegments:I.Numeric(16,{min:2,max:56,step:2},Et.CustomQualityParamInfo)};I.getDefaultValues(xae);function Clt(e,t,r,n,i,a){if(!je.isAtomic(t))return Ft.createEmpty(a);var o=t.nucleotideElements.length;if(!o)return Ft.createEmpty(a);for(var s=i.sizeFactor,u=i.radialSegments,l=o*(_G.vertices.length/3+u*2),c=wt.createState(l,l/4,a),d=t.elements,f=t.model,p=f.atomicHierarchy,v=p.chainAtomSegments,h=p.residueAtomSegments,m=p.atoms,g=p.index,y=f.atomicHierarchy.derived.residue,b=y.moleculeType,S=y.traceElementIndex,x=m.label_comp_id,C=t.conformation.invariantPosition,w=nr.transientSegments(v,d),A=nr.transientSegments(h,d),M={radiusTop:1*s,radiusBottom:1*s,radialSegments:u,bottomCap:!0},D=0;w.hasNext;)for(A.setSegment(w.move());A.hasNext;){var k=A.move().index;if(Gl(b[k])){var R=x.value(h.offsets[k]),O=-1,H=-1,B=-1,j=-1,Y=-1,G=-1,$=4.5,q=4.5,ee=2.5*s,fe=aJ(R),W=oJ(R);if(!fe&&!W){var X=g.findAtomOnResidue(k,"C4"),U=g.findAtomOnResidue(k,"N9");X!==-1&&U!==-1&&_.distance(C(X,Cy),C(U,oS))<1.6?fe=!0:W=!0}fe?(q=4.5,O=g.findAtomOnResidue(k,"N1"),H=g.findAtomOnResidue(k,"C4"),B=g.findAtomOnResidue(k,"C6"),j=g.findAtomOnResidue(k,"C2"),Y=g.findAtomOnResidue(k,"N9"),G=S[k]):W&&(q=3,O=g.findAtomOnResidue(k,"N3"),H=g.findAtomOnResidue(k,"C6"),B=g.findAtomOnResidue(k,"C4"),j=g.findAtomOnResidue(k,"C2"),Y=g.findAtomOnResidue(k,"N1"),Y===-1&&(Y=g.findAtomOnResidue(k,"C1")),G=S[k]),Y!==-1&&G!==-1&&(C(Y,xG),C(G,SG),c.currentGroup=D,Ua(c,xG,SG,1,M),O!==-1&&H!==-1&&B!==-1&&j!==-1&&(C(O,Cy),C(H,oS),C(B,yG),C(j,bG),_.normalize(sS,_.sub(sS,oS,Cy)),_.normalize(eI,_.sub(eI,bG,yG)),_.normalize(tI,_.cross(tI,sS,eI)),ue.targetTo(_y,Cy,oS,tI),_.scaleAndAdd(CG,Cy,sS,q/2-.2),ue.scale(_y,_y,_.set(Slt,$,ee,q)),ue.setTranslation(_y,CG),wt.addPrimitive(c,_y,_G))),++D}}var z=wt.getMesh(c),J=Be.expand(Be(),t.boundary.sphere,1*i.sizeFactor);return z.setBoundingSphere(J),z}var Sae=E(E({},Ea),xae);function _lt(e){return uo({defaultProps:I.getDefaultValues(Sae),createGeometry:Clt,createLocationIterator:zw.fromGroup,getLoci:yae,eachLocation:bae,setUpdateState:function(t,r,n){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.radialSegments!==n.radialSegments}},e)}var uS=_.zero(),ef=_.zero(),lS=_.zero(),cS=_.zero(),Kp=_.zero(),Em=_.zero(),dS=_.zero(),wG=_.zero(),EG=_.zero(),wy=_.zero(),tf=_.zero(),Cae={sizeFactor:I.Numeric(.2,{min:0,max:10,step:.01}),radialSegments:I.Numeric(16,{min:2,max:56,step:2},Et.CustomQualityParamInfo),detail:I.Numeric(0,{min:0,max:3,step:1},Et.CustomQualityParamInfo)};I.getDefaultValues(Cae);var fS=new Float32Array(2*9*3),wlt=new Uint32Array([0,1,2,3,4,5,6,7,16,17,14,15,12,13,8,9,10,11,0,1]),Elt=new Uint32Array([8,12,14,16,6,4,2,0,10]),Alt=new Uint32Array([9,11,1,3,5,7,17,15,13]),pS=new Float32Array(2*6*3),Plt=new Uint32Array([0,1,2,3,4,5,6,7,8,9,10,11,0,1]),Tlt=new Uint32Array([0,10,8,6,4,2]),Ilt=new Uint32Array([1,3,5,7,9,11]),AG=_.zero();function PG(e,t){for(var r=[],n=2;n<arguments.length;n++)r[n-2]=arguments[n];for(var i=0,a=r.length;i<a;++i){var o=r[i];_.toArray(_.add(AG,o,t),e,i*2*3),_.toArray(_.sub(AG,o,t),e,(i*2+1)*3)}}function Mlt(e,t,r,n,i,a){if(!je.isAtomic(t))return Ft.createEmpty(a);var o=t.nucleotideElements.length;if(!o)return Ft.createEmpty(a);for(var s=i.sizeFactor,u=i.radialSegments,l=i.detail,c=o*(26+u*2),d=wt.createState(c,c/4,a),f=t.elements,p=t.model,v=p.atomicHierarchy,h=v.chainAtomSegments,m=v.residueAtomSegments,g=v.atoms,y=v.index,b=p.atomicHierarchy.derived.residue,S=b.moleculeType,x=b.traceElementIndex,C=g.label_comp_id,w=t.conformation.invariantPosition,A=nr.transientSegments(h,f),M=nr.transientSegments(m,f),D=1*s,k=1.25*s,R={radiusTop:1*s,radiusBottom:1*s,radialSegments:u},O=0;A.hasNext;)for(M.setSegment(A.move());M.hasNext;){var H=M.move().index;if(Gl(S[H])){var B=C.value(m.offsets[H]),j=-1,Y=-1,G=-1,$=-1,q=-1,ee=-1,fe=-1,W=-1,X=-1,U=-1;d.currentGroup=O;var z=aJ(B),J=oJ(B);if(!z&&!J){var K=y.findAtomOnResidue(H,"C4"),Z=y.findAtomOnResidue(H,"N9");K!==-1&&Z!==-1&&_.distance(w(K,Kp),w(Z,wy))<1.6?z=!0:J=!0}z?(j=x[H],Y=y.findAtomOnResidue(H,"N1"),G=y.findAtomOnResidue(H,"C2"),$=y.findAtomOnResidue(H,"N3"),q=y.findAtomOnResidue(H,"C4"),ee=y.findAtomOnResidue(H,"C5"),ee===-1&&(ee=y.findAtomOnResidue(H,"N5")),fe=y.findAtomOnResidue(H,"C6"),W=y.findAtomOnResidue(H,"N7"),W===-1&&(W=y.findAtomOnResidue(H,"C7")),X=y.findAtomOnResidue(H,"C8"),U=y.findAtomOnResidue(H,"N9"),U!==-1&&j!==-1&&(w(U,wy),w(j,uS),d.currentGroup=O,Ua(d,wy,uS,1,R),Ni(d,wy,D,l)),Y!==-1&&G!==-1&&$!==-1&&q!==-1&&ee!==-1&&fe!==-1&&W!==-1&&X!==-1&&U!==-1&&(w(Y,ef),w(G,lS),w($,cS),w(q,Kp),w(ee,Em),w(fe,dS),w(W,wG),w(X,EG),_.triangleNormal(tf,ef,Kp,Em),_.scale(tf,tf,k),PG(fS,tf,ef,lS,cS,Kp,Em,dS,wG,EG,wy),wt.addTriangleStrip(d,fS,wlt),wt.addTriangleFan(d,fS,Elt),wt.addTriangleFan(d,fS,Alt))):J&&(j=x[H],Y=y.findAtomOnResidue(H,"N1"),Y===-1&&(Y=y.findAtomOnResidue(H,"C1")),G=y.findAtomOnResidue(H,"C2"),$=y.findAtomOnResidue(H,"N3"),q=y.findAtomOnResidue(H,"C4"),ee=y.findAtomOnResidue(H,"C5"),fe=y.findAtomOnResidue(H,"C6"),Y!==-1&&j!==-1&&(w(Y,ef),w(j,uS),d.currentGroup=O,Ua(d,ef,uS,1,R),Ni(d,ef,D,l)),Y!==-1&&G!==-1&&$!==-1&&q!==-1&&ee!==-1&&fe!==-1&&(w(G,lS),w($,cS),w(q,Kp),w(ee,Em),w(fe,dS),_.triangleNormal(tf,ef,Kp,Em),_.scale(tf,tf,k),PG(pS,tf,ef,lS,cS,Kp,Em,dS),wt.addTriangleStrip(d,pS,Plt),wt.addTriangleFan(d,pS,Tlt),wt.addTriangleFan(d,pS,Ilt))),++O}}var te=wt.getMesh(d),le=Be.expand(Be(),t.boundary.sphere,1*i.sizeFactor);return te.setBoundingSphere(le),te}var _ae=E(E({},Ea),Cae);function Dlt(e){return uo({defaultProps:I.getDefaultValues(_ae),createGeometry:Mlt,createLocationIterator:zw.fromGroup,getLoci:yae,eachLocation:bae,setUpdateState:function(t,r,n){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.radialSegments!==n.radialSegments}},e)}var Qp=_.zero(),Am=_.zero(),Zp=_.zero(),TG=_.zero(),Ai=ql(3,!1);function Rlt(){for(var e=E0(8),t=0;t<3;++t){var r=(t+1)%3;_.set(Qp,Ai[t*3],Ai[t*3+1],-.5),_.set(Am,Ai[r*3],Ai[r*3+1],-.5),_.set(Zp,Ai[r*3],Ai[r*3+1],.5),_.set(TG,Ai[t*3],Ai[t*3+1],.5),e.add(Qp,Am,Zp),e.add(Zp,TG,Qp)}return _.set(Qp,Ai[0],Ai[1],-.5),_.set(Am,Ai[3],Ai[4],-.5),_.set(Zp,Ai[6],Ai[7],-.5),e.add(Zp,Am,Qp),_.set(Qp,Ai[0],Ai[1],.5),_.set(Am,Ai[3],Ai[4],.5),_.set(Zp,Ai[6],Ai[7],.5),e.add(Qp,Am,Zp),e.getPrimitive()}var rI;function klt(){return rI||(rI=Rlt()),rI}var Jp=ue.identity(),Olt=_.zero(),IG=_.zero(),MG=_.zero(),nI=_.zero(),Llt=4,Flt=4,Nlt=6,Blt=klt(),wae={sizeFactor:I.Numeric(.2,{min:0,max:10,step:.01})};I.getDefaultValues(wae);function Ult(e,t,r,n,i,a){var o=t.polymerElements.length;if(!o)return Ft.createEmpty(a);for(var s=i.sizeFactor,u=o*24,l=wt.createState(u,u/10,a),c=1,d=t6(c),f=d.normalVectors,p=d.binormalVectors,v=0,h=e6(t,r);h.hasNext;){var m=h.move();l.currentGroup=v;var g=Gl(m.moleculeType),y=Br.is(m.secStrucType,4),b=g||y?.5:.9,S=g?.3:.5;if(r6(d,m,b,S),y&&!m.secStrucLast||!y){var x=n.size.size(m.center)*s,C=Llt*x,w=Flt*x,A=Nlt*x,M=g?p:f;_.fromArray(IG,M,0),_.fromArray(MG,M,3),_.normalize(nI,_.add(nI,IG,MG)),ue.targetTo(Jp,m.p3,m.p1,nI),ue.mul(Jp,Jp,ue.rotY90Z180),ue.scale(Jp,Jp,_.set(Olt,A,w,C)),ue.setTranslation(Jp,m.p2),wt.addPrimitive(l,Jp,Blt)}++v}var D=wt.getMesh(l),k=Be.expand(Be(),t.boundary.sphere,1*i.sizeFactor);return D.setBoundingSphere(k),D}var Eae=E(E({},Ea),wae);function jlt(e){return uo({defaultProps:I.getDefaultValues(Eae),createGeometry:Ult,createLocationIterator:fd.fromGroup,getLoci:Xv,eachLocation:Yv,setUpdateState:function(t,r,n){t.createGeometry=r.sizeFactor!==n.sizeFactor}},e)}var iI=10,Aae={sizeFactor:I.Numeric(.2,{min:0,max:10,step:.01}),radialSegments:I.Numeric(16,{min:2,max:56,step:2},Et.CustomQualityParamInfo)};I.getDefaultValues(Aae);function zlt(e,t,r,n,i,a){var o=t.gapElements.length;if(!o)return Ft.createEmpty(a);for(var s=i.sizeFactor,u=i.radialSegments,l=iI*u*2*o*2,c=wt.createState(l,l/10,a),d=t.conformation.invariantPosition,f=_.zero(),p=_.zero(),v={radiusTop:1,radiusBottom:1,topCap:!0,bottomCap:!0,radialSegments:u},h=0,m=rlt(r,t);m.hasNext;){var g=m.move(),y=g.centerA,b=g.centerB;y.element===b.element||(d(y.element,f),d(b.element,p),v.radiusTop=v.radiusBottom=n.size.size(y)*s,c.currentGroup=h,_1(c,f,p,.5,iI,v),v.radiusTop=v.radiusBottom=n.size.size(b)*s,c.currentGroup=h+1,_1(c,p,f,.5,iI,v)),h+=2}var S=wt.getMesh(c),x=Be.expand(Be(),t.boundary.sphere,1*i.sizeFactor);return S.setBoundingSphere(x),S}var hA=E(E({},Ea),Aae);function n6(e){return uo({defaultProps:I.getDefaultValues(hA),createGeometry:zlt,createLocationIterator:DR.fromGroup,getLoci:ylt,eachLocation:blt,setUpdateState:function(t,r,n){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.radialSegments!==n.radialSegments}},e)}var Rr=_(),Wr=_(),Vlt=_(),Ho=_(),ll=_(),hS=_(),vS=_(),Ey=_(),yu=_(),Ih=_(),aI=_(),rf=_(),nf=_(),af=_(),of=_(),Is=_.fromArray,wg=_.scale,Ds=_.add,bc=_.sub,Hlt=_.magnitude,DG=_.negate,RR=_.copy,Pae=_.cross,Glt=_.set,vn=qe.add3,qlt=qe.add;function mS(e,t,r,n,i,a,o,s){var u=t.vertices,l=t.normals,c=t.indices,d=u.elementCount;Is(Rr,n,e),wg(vS,Rr,o),wg(hS,Rr,s),Is(Wr,i,e),wg(Ho,Wr,a),Pae(Ih,Wr,Rr),Is(yu,r,e),Ds(rf,Ds(rf,yu,Ho),hS),bc(nf,Ds(nf,yu,Ho),vS),bc(af,bc(af,yu,Ho),vS),Ds(of,bc(of,yu,Ho),hS),o<s?(vn(u,of[0],of[1],of[2]),vn(u,af[0],af[1],af[2]),vn(u,nf[0],nf[1],nf[2]),vn(u,rf[0],rf[1],rf[2]),RR(ll,hS)):(vn(u,rf[0],rf[1],rf[2]),vn(u,nf[0],nf[1],nf[2]),vn(u,af[0],af[1],af[2]),vn(u,of[0],of[1],of[2]),RR(ll,vS));for(var f=0;f<4;++f)vn(l,Ih[0],Ih[1],Ih[2]);vn(c,d+2,d+1,d),vn(c,d,d+3,d+2)}function kR(e,t,r,n,i,a,o,s,u,l){var c=e.currentGroup,d=e.vertices,f=e.normals,p=e.indices,v=e.groups,h=d.elementCount,m=0;s>0?(Is(Rr,t,0),Is(Wr,t,i*3),m=s/Hlt(bc(Vlt,Wr,Rr))):Glt(Ey,0,0,0);for(var g=0;g<=i;++g){var y=a[g],b=o[g],S=s===0?b:s*(1-g/i),x=g*3;Is(ll,r,x),wg(ll,ll,S),Is(Ho,n,x),wg(Ho,Ho,y),s>0&&(Is(Rr,r,x),Is(Wr,n,x),wg(Ey,Pae(Ey,Rr,Wr),m)),Is(yu,t,x),Is(Ih,r,x),Is(aI,n,x),Ds(Rr,Ds(Rr,yu,Ho),ll),Ds(Wr,Ih,Ey),vn(d,Rr[0],Rr[1],Rr[2]),vn(f,Wr[0],Wr[1],Wr[2]),Ds(Rr,bc(Rr,yu,Ho),ll),vn(d,Rr[0],Rr[1],Rr[2]),vn(f,Wr[0],Wr[1],Wr[2]),DG(Wr,aI),vn(d,Rr[0],Rr[1],Rr[2]),vn(f,Wr[0],Wr[1],Wr[2]),bc(Rr,bc(Rr,yu,Ho),ll),vn(d,Rr[0],Rr[1],Rr[2]),vn(f,Wr[0],Wr[1],Wr[2]),Ds(Wr,DG(Wr,Ih),Ey),vn(d,Rr[0],Rr[1],Rr[2]),vn(f,Wr[0],Wr[1],Wr[2]),bc(Rr,Ds(Rr,yu,Ho),ll),vn(d,Rr[0],Rr[1],Rr[2]),vn(f,Wr[0],Wr[1],Wr[2]),RR(Wr,aI),vn(d,Rr[0],Rr[1],Rr[2]),vn(f,Wr[0],Wr[1],Wr[2]),Ds(Rr,Ds(Rr,yu,Ho),ll),vn(d,Rr[0],Rr[1],Rr[2]),vn(f,Wr[0],Wr[1],Wr[2])}for(var g=0;g<i;++g){for(var C=0;C<2;C++)vn(p,h+g*8+2*C,h+(g+1)*8+2*C+1,h+g*8+2*C+1),vn(p,h+g*8+2*C,h+(g+1)*8+2*C,h+(g+1)*8+2*C+1);for(var C=2;C<4;C++)vn(p,h+g*8+2*C,h+(g+1)*8+2*C,h+g*8+2*C+1),vn(p,h+(g+1)*8+2*C,h+(g+1)*8+2*C+1,h+g*8+2*C+1)}if(u){var y=a[0],b=o[0],w=s===0?b:s;mS(0,e,t,r,n,y,w,w)}else if(s>0){var y=a[0],b=o[0];mS(0,e,t,r,n,y,s,-b),mS(0,e,t,r,n,y,-s,b)}if(l&&s===0){var y=a[i],b=o[i];mS(i*3,e,t,r,n,y,-b,-b)}for(var A=(i+1)*8+(u?4:s>0?8:0)+(l&&s===0?4:0),g=0,M=A;g<M;++g)qlt(v,c)}var zn=_(),_s=_(),ws=_(),sc=_(),al=_();function $lt(e,t,r,n,i){e[0]=t[0]*n+r[0]*i,e[1]=t[1]*n+r[1]*i,e[2]=t[2]*n+r[2]*i}function oI(e,t,r,n,i,a){e[0]=t[0]*i+r[0]*a+n[0],e[1]=t[1]*i+r[1]*a+n[1],e[2]=t[2]*i+r[2]*a+n[2]}var uc=_.fromArray,RG=_.normalize,Wlt=_.negate,Xlt=_.copy,kG=_.cross,vo=qe.add3,sI=new Map;function Ylt(e){if(!sI.has(e)){for(var t=[],r=[],n=0;n<e;++n){var i=2*Math.PI*n/e;t[n]=Math.cos(i),r[n]=Math.sin(i)}sI.set(e,{cos:t,sin:r})}return sI.get(e)}function Tae(e,t,r,n,i,a,o,s,u,l){for(var c=e.currentGroup,d=e.vertices,f=e.normals,p=e.indices,v=e.groups,h=d.elementCount,m=Ylt(a),g=m.cos,y=m.sin,b=0;b<=i;++b){var S=b*3;uc(sc,r,S),uc(al,n,S),uc(ws,t,S);for(var x=o[b],C=s[b],w=0;w<a;++w)oI(_s,sc,al,ws,C*g[w],x*y[w]),a===2?(Xlt(zn,al),RG(zn,zn),(w!==0||b%2===0)&&Wlt(zn,zn)):$lt(zn,sc,al,x*g[w],C*y[w]),RG(zn,zn),vo(d,_s[0],_s[1],_s[2]),vo(f,zn[0],zn[1],zn[2])}for(var b=0;b<i;++b)for(var w=0;w<a;++w)vo(p,h+b*a+(w+1)%a,h+(b+1)*a+(w+1)%a,h+b*a+w),vo(p,h+(b+1)*a+(w+1)%a,h+(b+1)*a+w,h+b*a+w);if(u){var A=0,M=d.elementCount;uc(sc,r,A),uc(al,n,A),uc(ws,t,A),kG(zn,al,sc),vo(d,ws[0],ws[1],ws[2]),vo(f,zn[0],zn[1],zn[2]);var x=o[0],C=s[0];h=d.elementCount;for(var b=0;b<a;++b)oI(_s,sc,al,ws,C*g[b],x*y[b]),vo(d,_s[0],_s[1],_s[2]),vo(f,zn[0],zn[1],zn[2]),vo(p,h+(b+1)%a,h+b,M)}if(l){var A=i*3,M=d.elementCount;uc(sc,r,A),uc(al,n,A),uc(ws,t,A),kG(zn,sc,al),vo(d,ws[0],ws[1],ws[2]),vo(f,zn[0],zn[1],zn[2]);var x=o[i],C=s[i];h=d.elementCount;for(var b=0;b<a;++b)oI(_s,sc,al,ws,C*g[b],x*y[b]),vo(d,_s[0],_s[1],_s[2]),vo(f,zn[0],zn[1],zn[2]),vo(p,h+b,h+(b+1)%a,M)}var D=(i+1)*a+(u?a+1:0)+(l?a+1:0);qe.addRepeat(v,D,c)}var lc=_.fromArray,Klt=_.magnitude,uI=_.sub,OG=_.add,lI=_.scale,Qlt=_.negate,Zlt=_.copy,Jlt=_.cross,Es=qe.add3,ect=qe.add,Pi=_(),na=_(),tct=_(),cI=_(),eh=_(),LG=_(),Ay=_(),rct=_(),dI=_();function uC(e,t,r,n,i,a,o,s){var u=e.currentGroup,l=e.vertices,c=e.normals,d=e.indices,f=e.groups,p=l.elementCount,v=0;s>0&&(lc(Pi,t,0),lc(na,t,i*3),v=s/Klt(uI(tct,na,Pi)));for(var h=0;h<=i;++h){var m=a[h],g=o[h],y=s===0?g:s*(1-h/i),b=h*3;lc(eh,r,b),lI(eh,eh,y),lc(cI,n,b),lI(cI,cI,m),s>0&&(lc(Pi,r,b),lc(na,n,b),lI(LG,Jlt(LG,Pi,na),v)),lc(Ay,t,b),lc(rct,r,b),lc(dI,n,b),OG(Pi,Ay,eh),Qlt(na,dI),Es(l,Pi[0],Pi[1],Pi[2]),Es(c,na[0],na[1],na[2]),uI(Pi,Ay,eh),Es(l,Pi[0],Pi[1],Pi[2]),Es(c,na[0],na[1],na[2]),OG(Pi,Ay,eh),Zlt(na,dI),Es(l,Pi[0],Pi[1],Pi[2]),Es(c,na[0],na[1],na[2]),uI(Pi,Ay,eh),Es(l,Pi[0],Pi[1],Pi[2]),Es(c,na[0],na[1],na[2])}for(var h=0;h<i;++h)Es(d,p+h*4,p+(h+1)*4+1,p+h*4+1),Es(d,p+h*4,p+(h+1)*4,p+(h+1)*4+1),Es(d,p+h*4+2+1,p+(h+1)*4+2+1,p+h*4+2),Es(d,p+h*4+2,p+(h+1)*4+2+1,p+(h+1)*4+2);for(var S=(i+1)*4,h=0,x=S;h<x;++h)ect(f,u)}var Iae={sizeFactor:I.Numeric(.2,{min:0,max:10,step:.01}),aspectRatio:I.Numeric(5,{min:.1,max:10,step:.1}),arrowFactor:I.Numeric(1.5,{min:0,max:3,step:.1}),tubularHelices:I.Boolean(!1),detail:I.Numeric(0,{min:0,max:3,step:1},Et.CustomQualityParamInfo),linearSegments:I.Numeric(8,{min:1,max:48,step:1},Et.CustomQualityParamInfo),radialSegments:I.Numeric(16,{min:2,max:56,step:2},Et.CustomQualityParamInfo)};I.getDefaultValues(Iae);var mo=_();function nct(e,t,r,n,i,a){var o,s,u,l=t.polymerElements.length;if(!l)return Ft.createEmpty(a);for(var c=i.sizeFactor,d=i.detail,f=i.linearSegments,p=i.radialSegments,v=i.aspectRatio,h=i.arrowFactor,m=i.tubularHelices,g=f*p*l+(p+1)*l*2,y=wt.createState(g,g/10,a),b=je.isCoarse(t),S=t6(f),x=S.curvePoints,C=S.normalVectors,w=S.binormalVectors,A=S.widthValues,M=S.heightValues,D=0,k=e6(t,r,{ignoreSecondaryStructure:!1,useHelixOrientation:m});k.hasNext;){var R=k.move();y.currentGroup=D;var O=Gl(R.moleculeType),H=Br.is(R.secStrucType,4),B=Br.is(R.secStrucType,2),j=B&&!m?mlt:vae,Y=O?pA:fA;r6(S,R,j,Y);var G=n.size.size(R.centerPrev)*c,$=n.size.size(R.center)*c,q=n.size.size(R.centerNext)*c;b&&(G*=v/2,$*=v/2,q*=v/2);var ee=R.secStrucFirst||R.coarseBackboneFirst||R.first,fe=R.secStrucLast||R.coarseBackboneLast||R.last,W=f;if(R.initial){W=Math.max(Math.round(f*Y),1);var X=f-W;x.copyWithin(0,X*3),w.copyWithin(0,X*3),C.copyWithin(0,X*3),_.fromArray(mo,x,3),_.normalize(mo,_.sub(mo,R.p2,mo)),_.scaleAndAdd(mo,R.p2,mo,$*jw),_.toArray(mo,x,0)}else R.final&&(W=Math.max(Math.round(f*(1-Y)),1),_.fromArray(mo,x,W*3-3),_.normalize(mo,_.sub(mo,R.p2,mo)),_.scaleAndAdd(mo,R.p2,mo,$*jw),_.toArray(mo,x,W*3));if(R.initial===!0&&R.final===!0)Ni(y,R.p2,$*2,d);else if(H){var U=G*v,z=$*v,J=q*v,K=R.secStrucLast?z*h:0;MR(S,G,$,q,U,z,J,Y),p===2?uC(y,x,C,w,W,A,M,K):kR(y,x,C,w,W,A,M,K,ee,fe)}else{var U=void 0,z=void 0,J=void 0;if(B&&!R.isCoarseBackbone?m?(G*=v*1.5,$*=v*1.5,q*=v*1.5,U=G,z=$,J=q):(U=G*v,z=$*v,J=q*v):O&&!R.isCoarseBackbone?(U=G*v,z=$*v,J=q*v,o=[U,G],G=o[0],U=o[1],s=[z,$],$=s[0],z=s[1],u=[J,q],q=u[0],J=u[1]):(U=G,z=$,J=q),MR(S,G,$,q,U,z,J,Y),p===2)if(O&&!R.isCoarseBackbone){for(var Z=0,te=w.length;Z<te;Z++)w[Z]*=-1;uC(y,x,w,C,W,M,A,0)}else uC(y,x,C,w,W,A,M,0);else p===4?kR(y,x,C,w,W,A,M,0,ee,fe):Tae(y,x,C,w,W,p,A,M,ee,fe)}++D}var le=wt.getMesh(y),ye=Be.expand(Be(),t.boundary.sphere,1*i.sizeFactor);return le.setBoundingSphere(ye),le}var Mae=E(E({},Ea),Iae);function ict(e){return uo({defaultProps:I.getDefaultValues(Mae),createGeometry:nct,createLocationIterator:fd.fromGroup,getLoci:Xv,eachLocation:Yv,setUpdateState:function(t,r,n,i,a,o,s){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.tubularHelices!==n.tubularHelices||r.detail!==n.detail||r.linearSegments!==n.linearSegments||r.radialSegments!==n.radialSegments||r.aspectRatio!==n.aspectRatio||r.arrowFactor!==n.arrowFactor;var u=zl.get(o.structure).version;t.info.secondaryStructureHash!==u&&(t.createGeometry=!0,t.info.secondaryStructureHash=u)}},e)}var Dae={"polymer-trace":function(e,t){return ii("Polymer trace mesh",e,t,ict)},"polymer-gap":function(e,t){return ii("Polymer gap cylinder",e,t,n6)},"nucleotide-block":function(e,t){return ii("Nucleotide block mesh",e,t,_lt)},"nucleotide-ring":function(e,t){return ii("Nucleotide ring mesh",e,t,Dlt)},"direction-wedge":function(e,t){return ii("Polymer direction wedge",e,t,jlt)}},Rae=E(E(E(E(E(E({},Mae),hA),Sae),_ae),Eae),{sizeFactor:I.Numeric(.2,{min:0,max:10,step:.01}),visuals:I.MultiSelect(["polymer-trace","polymer-gap","nucleotide-block"],I.objectToOptions(Dae))});function act(e,t){var r=I.clone(Rae),n=!1,i=!1;return t.units.forEach(function(a){!n&&je.isAtomic(a)&&a.nucleotideElements.length&&(n=!0),!i&&a.gapElements.length&&(i=!0)}),r.visuals.defaultValue=["polymer-trace"],n&&r.visuals.defaultValue.push("nucleotide-block"),i&&r.visuals.defaultValue.push("polymer-gap"),r}function oct(e,t){return or.createMulti("Cartoon",e,t,Ui,Dae)}var sct={name:"cartoon",label:"Cartoon",description:"Displays ribbons, planks, tubes smoothly following the trace atoms of polymers.",factory:oct,getParams:act,defaultValues:I.getDefaultValues(Rae),defaultColorTheme:{name:"chain-id"},defaultSizeTheme:{name:"uniform"},isApplicable:function(e){return e.polymerResidueCount>0},ensureCustomProperties:{attach:function(e,t){return ce(void 0,void 0,void 0,function(){var r,n,i;return de(this,function(a){switch(a.label){case 0:return[4,zl.attach(e,t,void 0,!0)];case 1:a.sent(),r=0,n=t.models,a.label=2;case 2:return r<n.length?(i=n[r],[4,TR.attach(e,i,void 0,!0)]):[3,5];case 3:a.sent(),a.label=4;case 4:return r++,[3,2];case 5:return[2]}})})},detach:function(e){zl.ref(e,!1);for(var t=0,r=e.models;t<r.length;t++){var n=r[t];TR.ref(n,!1)}}}},kae=E(E({},Ea),{sizeFactor:I.Numeric(1,{min:0,max:10,step:.1}),detail:I.Numeric(0,{min:0,max:3,step:1},Et.CustomQualityParamInfo),ignoreHydrogens:I.Boolean(!1)});function uct(e){return uo({defaultProps:I.getDefaultValues(kae),createGeometry:lct,createLocationIterator:qa.fromGroup,getLoci:Wl,eachLocation:$l,setUpdateState:function(t,r,n){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.detail!==n.detail||r.ignoreHydrogens!==n.ignoreHydrogens}},e)}function lct(e,t,r,n,i,a){var o=r.child,s=o==null?void 0:o.unitMap.get(t.id);if(o&&!s)return Ft.createEmpty(a);var u=i.detail,l=i.sizeFactor,c=i.ignoreHydrogens,d=t.elements,f=t.model,p=t.model.atomicHierarchy.derived.atom.atomicNumber,v=d.length,h=v*OE(u),m=wt.createState(h,h/2,a),g=Ul.Provider.get(f);if(!g)return Ft.createEmpty(a);var y=_(),b=$n(),S=_(),x=_(),C=_(),w=g.elementToAnsiotrop,A=g.data,M=A.U,D=A._schema.U.space,k=t.conformation.invariantPosition,R=Ze.create(r);R.unit=t;for(var O=0;O<v;O++){var H=d[O],B=w[H];if(B!==-1&&!(s&&!Je.has(s.elements,H)||c&&fw(p,H))){R.element=H,k(H,y),m.currentGroup=O,Mr.toMat3(b,D,M.value(B)),$n.symmtricFromLower(b,b),$n.symmetricEigenvalues(S,b),$n.eigenvector(x,b,S[1]),$n.eigenvector(C,b,S[2]);for(var j=0;j<3;++j)S[j]=l*1.5958*Math.sqrt(Math.abs(S[j]));yn(S[0],S[1],xn)&&yn(S[1],S[2],xn)?Ni(m,y,S[0],u):tF(m,y,C,x,S,u)}}var Y=wt.getMesh(m),G=Be.expand(Be(),(s||t).boundary.sphere,1*l);return Y.setBoundingSphere(G),Y}var Oae={"ellipsoid-mesh":function(e,t){return ii("Ellipsoid Mesh",e,t,uct)},"intra-bond":function(e,t){return ii("Intra-unit bond cylinder",e,t,Zie)},"inter-bond":function(e,t){return Ru("Inter-unit bond cylinder",e,t,eae)}},Lae=E(E(E(E({},kae),sA),uA),{includeParent:I.Boolean(!1),adjustCylinderLength:I.Boolean(!1,{isHidden:!0}),unitKinds:f2(["atomic"]),sizeFactor:I.Numeric(1,{min:.01,max:10,step:.01}),sizeAspectRatio:I.Numeric(.1,{min:.01,max:3,step:.01}),linkCap:I.Boolean(!0),visuals:I.MultiSelect(["ellipsoid-mesh","intra-bond","inter-bond"],I.objectToOptions(Oae))});function cct(e,t){return I.clone(Lae)}function dct(e,t){return or.createMulti("Ellipsoid",e,t,Ui,Oae)}var fct={name:"ellipsoid",label:"Ellipsoid",description:"Displays anisotropic displacement ellipsoids of atomic elements plus bonds as cylinders.",factory:dct,getParams:cct,defaultValues:I.getDefaultValues(Lae),defaultColorTheme:{name:"element-symbol"},defaultSizeTheme:{name:"uniform"},isApplicable:function(e){return e.elementCount>0&&e.models.some(function(t){return Ul.Provider.isApplicable(t)})},getData:function(e,t){return t.includeParent?e.asParent():e},mustRecreate:function(e,t){return e.includeParent!==t.includeParent}},pct=`
precision highp float;

attribute vec3 aPosition;
attribute float aRadius;

varying vec3 vPosition;
varying float vRadiusSqInv;

#if defined(dCalcType_groupId)
    attribute float aGroup;
    varying float vGroup;
#endif

uniform vec3 uBboxSize;
uniform vec3 uBboxMin;
uniform float uResolution;

void main() {
    vRadiusSqInv = 1.0 / (aRadius * aRadius);
    #if defined(dCalcType_groupId)
        vGroup = aGroup;
    #endif
    gl_PointSize = ceil(((aRadius * 3.0) / uResolution) + uResolution);
    vPosition = (aPosition - uBboxMin) / uResolution;
    gl_Position = vec4(((aPosition - uBboxMin) / uBboxSize) * 2.0 - 1.0, 1.0);
}
`,hct=`
precision highp float;

varying vec3 vPosition;
varying float vRadiusSqInv;
#if defined(dCalcType_groupId)
    #if defined(dGridTexType_2d)
        precision highp sampler2D;
        uniform sampler2D tMinDistanceTex;
        uniform vec3 uGridTexDim;
    #elif defined(dGridTexType_3d)
        precision highp sampler3D;
        uniform sampler3D tMinDistanceTex;
    #endif
    varying float vGroup;
#endif

#include common

uniform vec3 uGridDim;
uniform vec2 uGridTexScale;
uniform float uCurrentSlice;
uniform float uCurrentX;
uniform float uCurrentY;
uniform float uAlpha;
uniform float uResolution;
uniform float uRadiusFactorInv;

void main() {
    vec2 v = gl_FragCoord.xy - vec2(uCurrentX, uCurrentY) - 0.5;
    vec3 fragPos = vec3(v.x, v.y, uCurrentSlice);
    float dist = distance(fragPos, vPosition) * uResolution;

    #if defined(dCalcType_density)
        float density = exp(-uAlpha * ((dist * dist) * vRadiusSqInv));
        gl_FragColor.a = density * uRadiusFactorInv;
    #elif defined(dCalcType_minDistance)
        gl_FragColor.a = 1.0 - dist * uRadiusFactorInv;
    #elif defined(dCalcType_groupId)
        #if defined(dGridTexType_2d)
            float minDistance = 1.0 - texture2D(tMinDistanceTex, (gl_FragCoord.xy) / (uGridTexDim.xy / uGridTexScale)).a;
        #elif defined(dGridTexType_3d)
            float minDistance = 1.0 - texelFetch(tMinDistanceTex, ivec3(gl_FragCoord.xy, uCurrentSlice), 0).a;
        #endif
        if (dist * uRadiusFactorInv > minDistance + uResolution * 0.05)
            discard;
        gl_FragColor.rgb = encodeFloatRGB(vGroup);
    #endif
}
`,vct={drawCount:_i("number"),instanceCount:_i("number"),aRadius:qr("float32",1,0),aPosition:qr("float32",3,0),aGroup:qr("float32",1,0),uCurrentSlice:Ge("f"),uCurrentX:Ge("f"),uCurrentY:Ge("f"),uBboxMin:Ge("v3","material"),uBboxSize:Ge("v3","material"),uGridDim:Ge("v3","material"),uGridTexDim:Ge("v3","material"),uGridTexScale:Ge("v2","material"),uAlpha:Ge("f","material"),uResolution:Ge("f","material"),uRadiusFactorInv:Ge("f","material"),tMinDistanceTex:ur("texture","rgba","float","nearest"),dGridTexType:Qt("string",["2d","3d"]),dCalcType:Qt("string",["density","minDistance","groupId"])},Sl="gaussian-density";function Fae(e){return e.namedFramebuffers[Sl]||(e.namedFramebuffers[Sl]=e.resources.framebuffer()),e.namedFramebuffers[Sl]}function Nae(e,t,r,n,i,a){var o=Sl+"-"+e;return t.namedTextures[o]||(t.namedTextures[o]=t.resources.texture(r,n,i,a)),t.namedTextures[o]}function Bae(e,t,r,n,i,a){return e.isWebGL2?mct(e,t,r,n,i,a):i6(e,t,r,n,!1,i,a)}function i6(e,t,r,n,i,a,o){return Uae(yct(e,t,r,n,i,a,o))}function mct(e,t,r,n,i,a){return Uae(bct(e,t,r,n,i,a))}function Uae(e){var t=e.texture,r=e.scale,n=e.bbox,i=e.gridDim,a=e.gridTexDim,o=e.gridTexScale,s=e.radiusFactor,u=e.resolution;return{transform:gct(r,n),texture:t,bbox:n,gridDim:i,gridTexDim:a,gridTexScale:o,radiusFactor:s,resolution:u}}function gct(e,t){var r=ue.identity();return ue.fromScaling(r,e),ue.setTranslation(r,t.min),r}function yct(e,t,r,n,i,a,o){var s=e.gl,u=e.resources,l=e.state,c=e.extensions,d=c.colorBufferFloat,f=c.textureFloat,p=c.colorBufferHalfFloat,v=c.textureHalfFloat,h=c.blendMinMax,m=a.smoothness,g=a.resolution,y=jae(t,r,n,a),b=y.drawCount,S=y.positions,x=y.radii,C=y.groups,w=y.scale,A=y.expandedBox,M=y.dim,D=y.maxRadius,k=M[0],R=M[1],O=M[2],H=Sct(M),B=H.texDimX,j=H.texDimY,Y=H.texCols,G=H.powerOfTwoSize,$=_.create(B,j,0),q=He.create(B/G,j/G),ee=D*2,fe=i?G:B,W=i?G:j,X=Nae("min-dist-2d",e,"image-uint8","rgba","ubyte","nearest");X.define(fe,W);var U=zae(e,b,S,x,C,X,A,M,$,q,m,g,ee),z=U.values,J=z.uCurrentSlice,K=z.uCurrentX,Z=z.uCurrentY,te=Fae(e);te.bind(),Vae(e),o||(o=p&&v?u.texture("image-float16","rgba","fp16","linear"):d&&f?u.texture("image-float32","rgba","float","linear"):u.texture("image-uint8","rgba","ubyte","linear")),o.define(fe,W);function le(ye,be){l.currentRenderItemId=-1,ye.attachFramebuffer(te,0),be&&(s.viewport(0,0,fe,W),s.scissor(0,0,fe,W),s.clear(s.COLOR_BUFFER_BIT)),F.update(Z,0);for(var Ae=0,Se=0,ie=0,oe=0;oe<O;++oe)Ae>=Y&&(Ae-=Y,Se+=R,ie=0,F.update(Z,Se)),F.update(K,ie),F.update(J,oe),s.viewport(ie,Se,k,R),s.scissor(ie,Se,k,R),U.render(),++Ae,ie+=k;s.flush()}return Gae(e,U),le(o,!0),h&&(Hae(e,U),le(X,!0),qae(e,U),le(o,!1)),{texture:o,scale:w,bbox:A,gridDim:M,gridTexDim:$,gridTexScale:q,radiusFactor:ee,resolution:g}}function bct(e,t,r,n,i,a){var o=e.gl,s=e.resources,u=e.state,l=e.extensions,c=l.colorBufferFloat,d=l.textureFloat,f=l.colorBufferHalfFloat,p=l.textureHalfFloat,v=i.smoothness,h=i.resolution,m=jae(t,r,n,i),g=m.drawCount,y=m.positions,b=m.radii,S=m.groups,x=m.scale,C=m.expandedBox,w=m.dim,A=m.maxRadius,M=w[0],D=w[1],k=w[2],R=Nae("min-dist-3d",e,"volume-uint8","rgba","ubyte","nearest");R.define(M,D,k);var O=He.create(1,1),H=A*2,B=zae(e,g,y,b,S,R,C,w,w,O,v,h,H),j=B.values.uCurrentSlice,Y=Fae(e);Y.bind(),Vae(e),o.viewport(0,0,M,D),o.scissor(0,0,M,D),a||(a=f&&p?s.texture("volume-float16","rgba","fp16","linear"):c&&d?s.texture("volume-float32","rgba","float","linear"):s.texture("volume-uint8","rgba","ubyte","linear")),a.define(M,D,k);function G($,q){u.currentRenderItemId=-1;for(var ee=0;ee<k;++ee)F.update(j,ee),$.attachFramebuffer(Y,0,ee),q&&o.clear(o.COLOR_BUFFER_BIT),B.render();o.flush()}return Gae(e,B),G(a,!0),Hae(e,B),G(R,!0),qae(e,B),G(a,!1),{texture:a,scale:x,bbox:C,gridDim:w,gridTexDim:w,gridTexScale:O,radiusFactor:H,resolution:h}}function jae(e,t,r,n){for(var i=n.resolution,a=n.radiusOffset,o=1/i,s=e.indices,u=e.x,l=e.y,c=e.z,d=e.id,f=Le.size(s),p=new Float32Array(f*3),v=new Float32Array(f),h=new Float32Array(f),m=0,g=0;g<f;++g){var y=Le.getAt(s,g);p[g*3]=u[y],p[g*3+1]=l[y],p[g*3+2]=c[y];var b=r(y)+a;m<b&&(m=b),v[g]=b,h[g]=d?d[g]:g}var S=m*2+i*4,x=Xt.expand(Xt(),t,_.create(S,S,S)),C=Xt.scale(Xt(),x,o),w=Xt.size(_(),C);_.ceil(w,w);var A=_.create(i,i,i);return{drawCount:f,positions:p,radii:v,groups:h,scale:A,expandedBox:x,dim:w,maxRadius:m}}function zae(e,t,r,n,i,a,o,s,u,l,c,d,f){if(e.namedComputeRenderables[Sl]){var p=_.sub(_(),o.max,o.min),v=e.namedComputeRenderables[Sl].values;F.updateIfChanged(v.drawCount,t),F.updateIfChanged(v.instanceCount,1),F.update(v.aRadius,n),F.update(v.aPosition,r),F.update(v.aGroup,i),F.updateIfChanged(v.uCurrentSlice,0),F.updateIfChanged(v.uCurrentX,0),F.updateIfChanged(v.uCurrentY,0),F.update(v.uBboxMin,o.min),F.update(v.uBboxSize,p),F.update(v.uGridDim,s),F.update(v.uGridTexDim,u),F.update(v.uGridTexScale,l),F.updateIfChanged(v.uAlpha,c),F.updateIfChanged(v.uResolution,d),F.updateIfChanged(v.uRadiusFactorInv,1/f),F.update(v.tMinDistanceTex,a),F.updateIfChanged(v.dGridTexType,a.getDepth()>0?"3d":"2d"),F.updateIfChanged(v.dCalcType,"density"),e.namedComputeRenderables[Sl].update()}else e.namedComputeRenderables[Sl]=xct(e,t,r,n,i,a,o,s,u,l,c,d,f);return e.namedComputeRenderables[Sl]}function xct(e,t,r,n,i,a,o,s,u,l,c,d,f){var p=_.sub(_(),o.max,o.min),v={drawCount:F.create(t),instanceCount:F.create(1),aRadius:F.create(n),aPosition:F.create(r),aGroup:F.create(i),uCurrentSlice:F.create(0),uCurrentX:F.create(0),uCurrentY:F.create(0),uBboxMin:F.create(o.min),uBboxSize:F.create(p),uGridDim:F.create(s),uGridTexDim:F.create(u),uGridTexScale:F.create(l),uAlpha:F.create(c),uResolution:F.create(d),uRadiusFactorInv:F.create(1/f),tMinDistanceTex:F.create(a),dGridTexType:F.create(a.getDepth()>0?"3d":"2d"),dCalcType:F.create("density")},h=E({},vct),m=Ln(Sl,pct,hct),g=Ji(e,"points",m,h,v);return Zi(g,v)}function Vae(e){var t=e.gl,r=e.state;r.disable(t.CULL_FACE),r.enable(t.BLEND),r.disable(t.DEPTH_TEST),r.enable(t.SCISSOR_TEST),r.depthMask(!1),r.clearColor(0,0,0,0)}function Hae(e,t){var r=e.gl,n=e.state;if(F.update(t.values.dCalcType,"minDistance"),t.update(),n.colorMask(!1,!1,!1,!0),n.blendFunc(r.ONE,r.ONE),!e.extensions.blendMinMax)throw new Error("GPU gaussian surface calculation requires EXT_blend_minmax");n.blendEquation(e.extensions.blendMinMax.MAX)}function Gae(e,t){var r=e.gl,n=e.state;F.update(t.values.dCalcType,"density"),t.update(),n.colorMask(!1,!1,!1,!0),n.blendFunc(r.ONE,r.ONE),n.blendEquation(r.FUNC_ADD)}function qae(e,t){var r=e.gl,n=e.state;F.update(t.values.dCalcType,"groupId"),t.update(),n.colorMask(!0,!0,!0,!1),n.blendFunc(r.ONE,r.ZERO),n.blendEquation(r.FUNC_ADD)}function Sct(e){var t=e[0]*e[1]*e[2],r=Math.sqrt(t),n=Math.pow(2,Math.ceil(Math.log(r)/Math.log(2))),i=0,a=e[1],o=1,s=e[2];return n<e[0]*e[2]?(s=Math.floor(n/e[0]),o=Math.ceil(e[2]/s),i=s*e[0],a*=o):i=e[0]*e[2],{texDimX:i,texDimY:a,texRows:o,texCols:s,powerOfTwoSize:a<n?n:n*2}}function $ae(e,t,r,n,i){return ce(this,void 0,void 0,function(){function a(K,Z){for(var te=K;te<Z;++te)for(var le=Le.getAt(d,te),ye=f[le],be=p[le],Ae=v[le],Se=g[te],ie=Se*Se,oe=1/ie,L=Se*2,V=L*L,he=Math.ceil(L*c),we=Math.floor(c*(ye-w[0])),Te=Math.floor(c*(be-w[1])),ze=Math.floor(c*(Ae-w[2])),Ve=Math.max(0,we-he),Xe=Math.max(0,Te-he),ct=Math.max(0,ze-he),Ne=Math.min(B,we+he+2),Qe=Math.min(j,Te+he+2),it=Math.min(Y,ze+he+2),ot=Ve;ot<Ne;++ot)for(var dt=ee[ot]-ye,ke=ot*q,Me=Xe;Me<Qe;++Me)for(var Ye=fe[Me]-be,tt=dt*dt+Ye*Ye,xt=Me*G+ke,ht=ct;ht<it;++ht){var ut=W[ht]-Ae,pe=tt+ut*ut;if(pe<=V){var me=n9e(-U*(pe*oe)),Ee=ht+xt;k[Ee]+=me,me>X[Ee]&&(X[Ee]=me,O[Ee]=h?h[te]:te)}}}function o(){return ce(this,void 0,void 0,function(){var K;return de(this,function(Z){switch(Z.label){case 0:K=0,Z.label=1;case 1:return K<m?(a(K,Math.min(K+z,m)),e.shouldUpdate?[4,e.update({message:"filling density grid",current:K,max:m})]:[3,3]):[3,4];case 2:Z.sent(),Z.label=3;case 3:return K+=z,[3,1];case 4:return[2]}})})}var s,u,l,c,d,f,p,v,h,m,g,y,b,S,x,C,w,A,M,D,k,R,O,H,B,j,Y,G,$,q,ee,fe,W,X,U,z,J;return de(this,function(K){switch(K.label){case 0:for(s=i.resolution,u=i.radiusOffset,l=i.smoothness,c=1/s,d=t.indices,f=t.x,p=t.y,v=t.z,h=t.id,m=Le.size(d),g=new Float32Array(m),y=0,b=0;b<m;++b)S=n(Le.getAt(d,b))+u,y<S&&(y=S),g[b]=S;return x=y*2+s,C=Xt.expand(Xt(),r,_.create(x,x,x)),w=C.min,A=Xt.scale(Xt(),C,c),M=Xt.size(_(),A),_.ceil(M,M),D=Mr.Space(M,[0,1,2],Float32Array),k=D.create(),R=Mr.create(D,k),O=D.create(),O.fill(-1),H=Mr.create(D,O),B=M[0],j=M[1],Y=M[2],G=Y,$=j,q=G*$,ee=yg(M[0],w[0],s),fe=yg(M[1],w[1],s),W=yg(M[2],w[2],s),X=D.create(),U=l,z=Math.ceil(1e5/(Math.pow(Math.pow(y,3),3)*c)),[4,o()];case 1:return K.sent(),J=ue.identity(),ue.fromScaling(J,_.create(s,s,s)),ue.setTranslation(J,C.min),[2,{field:R,idField:H,transform:J,radiusFactor:1,resolution:s}]}})})}var w2=E({resolution:I.Numeric(1,{min:.1,max:20,step:.1},E({description:"Grid resolution/cell spacing."},Et.CustomQualityParamInfo)),radiusOffset:I.Numeric(0,{min:0,max:10,step:.1},{description:"Extra/offset radius added to the atoms/coarse elements for gaussian calculation. Useful to create coarse, low resolution surfaces."}),smoothness:I.Numeric(1.5,{min:.5,max:2.5,step:.1},{description:"Smoothness of the gausian surface, lower is smoother."})},QE);I.getDefaultValues(w2);function vA(e,t){var r=e.maxTextureSize/3;return r*r/Math.max(1,t?t.units.length/16:1)}function Wae(e,t,r){var n=this,i=t.lookup3d.boundary.box,a=jv(i,r),o=ZE(e,t,a),s=o.position,u=o.radius;return $e.create("Gaussian Density",function(l){return ce(n,void 0,void 0,function(){return de(this,function(c){switch(c.label){case 0:return[4,$ae(l,s,i,u,a)];case 1:return[2,c.sent()]}})})})}function Cct(e,t,r,n,i){var a=this,o=t.lookup3d.boundary.box,s=jv(o,r,vA(n,e)),u=ZE(e,t,s),l=u.position,c=u.radius;return $e.create("Gaussian Density",function(d){return ce(a,void 0,void 0,function(){return de(this,function(f){return[2,Bae(n,l,o,c,s,i)]})})})}function _ct(e,t,r,n,i,a){var o=this,s=t.lookup3d.boundary.box,u=jv(s,n,vA(i,e)),l=ZE(e,t,u),c=l.position,d=l.radius;return $e.create("Gaussian Density",function(f){return ce(o,void 0,void 0,function(){return de(this,function(p){return[2,i6(i,c,s,d,r,u,a)]})})})}function wct(e,t){var r=this,n=e.lookup3d.boundary.box,i=jv(n,t),a=oF(e,t.ignoreHydrogens,t.traceOnly),o=a.position,s=a.radius;return $e.create("Gaussian Density",function(u){return ce(r,void 0,void 0,function(){return de(this,function(l){switch(l.label){case 0:return[4,$ae(u,o,n,s,i)];case 1:return[2,l.sent()]}})})})}function Ect(e,t,r,n){var i=this,a=e.lookup3d.boundary.box,o=jv(a,t,vA(r)),s=oF(e,t.ignoreHydrogens,t.traceOnly),u=s.position,l=s.radius;return $e.create("Gaussian Density",function(c){return ce(i,void 0,void 0,function(){return de(this,function(d){return[2,Bae(r,u,a,l,o,n)]})})})}function Act(e,t,r,n,i){var a=this,o=e.lookup3d.boundary.box,s=jv(o,r,vA(n)),u=oF(e,r.ignoreHydrogens,r.traceOnly),l=u.position,c=u.radius;return $e.create("Gaussian Density",function(d){return ce(a,void 0,void 0,function(){return de(this,function(f){return[2,i6(n,l,o,c,t,s,i)]})})})}function Pct(e,t,r,n,i){var a=e.colorType,o=e.vertexCount,s=e.groupCount,u=e.positionBuffer,l=e.transformBuffer,c=e.groupBuffer,d=a.endsWith("Instance"),f=Xt.fromSphere3D(Xt(),d?e.boundingSphere:e.invariantBoundingSphere),p=1/t,v=Xt.scale(Xt(),f,p),h=Xt.size(_(),v);_.ceil(h,h),_.add(h,h,_.create(2,2,2));var m=f.min,g=h[0],y=h[1],b=x2(h),S=b.width,x=b.height,C=3,w=new Float32Array(S*x*C),A=new Float32Array(S*x),M=new Uint8Array(S*x*C),D={array:M,width:S,height:x,filter:"linear"},k=d?e.instanceCount:1,R=e.colorData.array;function O(Me,Ye,tt){var xt=Math.floor(tt*g%S/g),ht=Math.floor(tt*g/S),ut=xt*g+Me;return C*(ht*y*S+Ye*S+ut)}for(var H=2,B=h[0],j=h[1],Y=h[2],G=_(),$=0;$<k;++$)for(var q=0;q<o;q+=r){_.fromArray(G,u,q*3),d&&_.transformMat4Offset(G,G,l,0,0,$*16),_.sub(G,G,m),_.scale(G,G,p);for(var ee=G[0],fe=G[1],W=G[2],X=Math.floor(ee),U=Math.floor(fe),z=Math.floor(W),J=$*s+c[q],K=R[J*3],Z=R[J*3+1],te=R[J*3+2],le=Math.max(0,X-H),ye=Math.max(0,U-H),be=Math.max(0,z-H),Ae=Math.min(B,X+H+2),Se=Math.min(j,U+H+2),ie=Math.min(Y,z+H+2),oe=le;oe<Ae;++oe)for(var L=oe-ee,V=ye;V<Se;++V)for(var he=V-fe,we=be;we<ie;++we){var Te=we-W,ze=Math.sqrt(L*L+he*he+Te*Te);if(!(ze>H)){var Ve=H-ze,Xe=O(oe,V,we);w[Xe]+=K*Ve,w[Xe+1]+=Z*Ve,w[Xe+2]+=te*Ve,A[Xe/3]+=Ve}}}for(var $=0,ct=A.length;$<ct;++$){var Ne=$*3,Qe=A[$];M[Ne]=Math.round(w[Ne]/Qe),M[Ne+1]=Math.round(w[Ne+1]/Qe),M[Ne+2]=Math.round(w[Ne+2]/Qe)}var it=He.create(S,x),ot=Ar.create(m[0],m[1],m[2],p),dt=d?"volumeInstance":"volume";if(n)return i||(i=n.resources.texture("image-uint8","rgb","ubyte","linear")),i.load(D),{kind:"volume",texture:i,gridTexDim:it,gridDim:h,gridTransform:ot,type:dt};var ke=Tct({vertexCount:o,instanceCount:k,transformBuffer:l,positionBuffer:u,colorType:dt,grid:M,gridDim:h,gridTexDim:it,gridTransform:ot,vertexStride:3,colorStride:3});return{kind:"vertex",texture:ke,texDim:He.create(ke.width,ke.height),type:d?"vertexInstance":"vertex"}}function Tct(e){var t=e.vertexCount,r=e.positionBuffer,n=e.transformBuffer,i=e.grid,a=e.gridDim,o=e.gridTexDim,s=e.gridTransform,u=e.vertexStride,l=e.colorStride,c=e.colorType.endsWith("Instance"),d=c?e.instanceCount:1,f=Ca(Math.max(1,d*t),3,Uint8Array),p=f.array,v=a[0],h=a[1],m=o[0],g=_.fromArray(_(),s,0),y=s[3];function b(be,Ae,Se){var ie=Math.floor(Se*v%m/v),oe=Math.floor(Se*v/m),L=ie*v+be;return l*(oe*h*m+Ae*m+L)}for(var S=_(),x=_(),C=_(),w=_(),A=0;A<d;++A)for(var M=0;M<t;++M){_.fromArray(S,r,M*u),c&&_.transformMat4Offset(S,S,n,0,0,A*16),_.sub(S,S,g),_.scale(S,S,y),_.floor(x,S),_.ceil(C,S),_.sub(w,S,x),_.sub(S,C,x),_.div(w,w,S);var D=x[0],k=x[1],R=x[2],O=C[0],H=C[1],B=C[2],j=w[0],Y=w[1],G=w[2],$=at.fromArray(i,b(D,k,R)),q=at.fromArray(i,b(O,k,R)),ee=at.fromArray(i,b(D,k,B)),fe=at.fromArray(i,b(O,k,B)),W=at.fromArray(i,b(D,H,R)),X=at.fromArray(i,b(O,H,R)),U=at.fromArray(i,b(D,H,B)),z=at.fromArray(i,b(O,H,B)),J=at.interpolate($,q,j),K=at.interpolate(ee,fe,j),Z=at.interpolate(W,X,j),te=at.interpolate(U,z,j),le=at.interpolate(J,Z,Y),ye=at.interpolate(K,te,Y);at.toArray(at.interpolate(le,ye,G),p,(A*t+M)*3)}return f}var Ict=`
precision highp float;
precision highp sampler2D;

uniform sampler2D tColor;
uniform vec2 uTexSize;

void main(void) {
    vec2 coords = gl_FragCoord.xy / uTexSize;
    vec4 color = texture2D(tColor, coords);

    gl_FragColor.rgb = color.rgb / color.a;
}
`,Mct=`
precision highp float;

varying vec3 vPosition;
varying vec3 vColor;

uniform float uCurrentSlice;
uniform float uCurrentX;
uniform float uCurrentY;
uniform float uResolution;

const float p = 2.0;

void main() {
    vec2 v = gl_FragCoord.xy - vec2(uCurrentX, uCurrentY) - 0.5;
    vec3 fragPos = vec3(v.x, v.y, uCurrentSlice);
    float dist = distance(fragPos, vPosition);
    if (dist > p) discard;

    gl_FragColor = vec4(vColor, 1.0) * (p - dist);
}
`,Dct=`
precision highp float;

#include common
#include read_from_texture

uniform int uTotalCount;
uniform int uGroupCount;

attribute float aSample;
#define SampleID int(aSample)

attribute mat4 aTransform;
attribute float aInstance;

uniform vec2 uGeoTexDim;
uniform sampler2D tPosition;
uniform sampler2D tGroup;

uniform vec2 uColorTexDim;
uniform sampler2D tColor;

varying vec3 vPosition;
varying vec3 vColor;

uniform vec3 uBboxSize;
uniform vec3 uBboxMin;
uniform float uResolution;

void main() {
    vec3 position = readFromTexture(tPosition, SampleID, uGeoTexDim).xyz;
    float group = decodeFloatRGB(readFromTexture(tGroup, SampleID, uGeoTexDim).rgb);

    position = (aTransform * vec4(position, 1.0)).xyz;
    gl_PointSize = 7.0;
    vPosition = (position - uBboxMin) / uResolution;
    gl_Position = vec4(((position - uBboxMin) / uBboxSize) * 2.0 - 1.0, 1.0);

    #if defined(dColorType_group)
        vColor = readFromTexture(tColor, group, uColorTexDim).rgb;
    #elif defined(dColorType_groupInstance)
        vColor = readFromTexture(tColor, aInstance * float(uGroupCount) + group, uColorTexDim).rgb;
    #endif
}
`,Rct={drawCount:_i("number"),instanceCount:_i("number"),stride:_i("number"),uTotalCount:Ge("i"),uInstanceCount:Ge("i"),uGroupCount:Ge("i"),aTransform:qr("float32",16,1),aInstance:qr("float32",1,1),aSample:qr("float32",1,0),uGeoTexDim:Ge("v2","buffered"),tPosition:ur("texture","rgba","float","nearest"),tGroup:ur("texture","rgba","float","nearest"),uColorTexDim:Ge("v2"),tColor:ur("image-uint8","rgb","ubyte","nearest"),dColorType:Qt("string",["group","groupInstance","vertex","vertexInstance"]),uCurrentSlice:Ge("f"),uCurrentX:Ge("f"),uCurrentY:Ge("f"),uBboxMin:Ge("v3","material"),uBboxSize:Ge("v3","material"),uResolution:Ge("f","material")},bu="color-accumulate";function Xae(e,t){for(var r=new Float32Array(e),n=0;n<e;++n)r[n]=n*t;return r}function kct(e,t,r,n,i){if(e.namedComputeRenderables[bu]){var a=_.sub(_(),r.max,r.min),o=e.namedComputeRenderables[bu].values,s=Math.round(t.vertexCount/i);(s>o.drawCount.ref.value||i!==o.stride.ref.value)&&F.update(o.aSample,Xae(s,i)),F.updateIfChanged(o.drawCount,s),F.updateIfChanged(o.instanceCount,t.instanceCount),F.updateIfChanged(o.stride,i),F.updateIfChanged(o.uTotalCount,t.vertexCount),F.updateIfChanged(o.uInstanceCount,t.instanceCount),F.updateIfChanged(o.uGroupCount,t.groupCount),F.update(o.aTransform,t.transformBuffer),F.update(o.aInstance,t.instanceBuffer),F.update(o.uGeoTexDim,He.set(o.uGeoTexDim.ref.value,t.positionTexture.getWidth(),t.positionTexture.getHeight())),F.update(o.tPosition,t.positionTexture),F.update(o.tGroup,t.groupTexture),F.update(o.uColorTexDim,He.set(o.uColorTexDim.ref.value,t.colorData.width,t.colorData.height)),F.update(o.tColor,t.colorData),F.updateIfChanged(o.dColorType,t.colorType),F.updateIfChanged(o.uCurrentSlice,0),F.updateIfChanged(o.uCurrentX,0),F.updateIfChanged(o.uCurrentY,0),F.update(o.uBboxMin,r.min),F.update(o.uBboxSize,a),F.updateIfChanged(o.uResolution,n),e.namedComputeRenderables[bu].update()}else e.namedComputeRenderables[bu]=Oct(e,t,r,n,i);return e.namedComputeRenderables[bu]}function Oct(e,t,r,n,i){var a=_.sub(_(),r.max,r.min),o=Math.round(t.vertexCount/i),s={drawCount:F.create(o),instanceCount:F.create(t.instanceCount),stride:F.create(i),uTotalCount:F.create(t.vertexCount),uInstanceCount:F.create(t.instanceCount),uGroupCount:F.create(t.groupCount),aTransform:F.create(t.transformBuffer),aInstance:F.create(t.instanceBuffer),aSample:F.create(Xae(o,i)),uGeoTexDim:F.create(He.create(t.positionTexture.getWidth(),t.positionTexture.getHeight())),tPosition:F.create(t.positionTexture),tGroup:F.create(t.groupTexture),uColorTexDim:F.create(He.create(t.colorData.width,t.colorData.height)),tColor:F.create(t.colorData),dColorType:F.create(t.colorType),uCurrentSlice:F.create(0),uCurrentX:F.create(0),uCurrentY:F.create(0),uBboxMin:F.create(r.min),uBboxSize:F.create(a),uResolution:F.create(n)},u=E({},Rct),l=Ln("accumulate",Dct,Mct),c=Ji(e,"points",l,u,s);return Zi(c,s)}function Lct(e){var t=e.gl,r=e.state;r.disable(t.CULL_FACE),r.enable(t.BLEND),r.disable(t.DEPTH_TEST),r.enable(t.SCISSOR_TEST),r.depthMask(!1),r.clearColor(0,0,0,0),r.blendFunc(t.ONE,t.ONE),r.blendEquation(t.FUNC_ADD)}var Fct=E(E({},_a),{tColor:ur("texture","rgba","float","nearest"),uTexSize:Ge("v2")}),Py="color-normalize";function Nct(e,t){if(e.namedComputeRenderables[Py]){var r=e.namedComputeRenderables[Py].values;F.update(r.tColor,t),F.update(r.uTexSize,He.set(r.uTexSize.ref.value,t.getWidth(),t.getHeight())),e.namedComputeRenderables[Py].update()}else e.namedComputeRenderables[Py]=Bct(e,t);return e.namedComputeRenderables[Py]}function Bct(e,t){var r=E(E({},wa),{tColor:F.create(t),uTexSize:F.create(He.create(t.getWidth(),t.getHeight()))}),n=E({},Fct),i=Ln("normalize",ko,Ict),a=Ji(e,"triangles",i,n,r);return Zi(a,r)}function Uct(e){var t=e.gl,r=e.state;r.disable(t.CULL_FACE),r.enable(t.BLEND),r.disable(t.DEPTH_TEST),r.enable(t.SCISSOR_TEST),r.depthMask(!1),r.clearColor(0,0,0,0),r.blendFunc(t.ONE,t.ONE),r.blendEquation(t.FUNC_ADD)}function jct(e){var t=e[0]*e[1]*e[2],r=Math.sqrt(t),n=Math.pow(2,Math.ceil(Math.log(r)/Math.log(2))),i=0,a=e[1],o=1,s=e[2];return n<e[0]*e[2]?(s=Math.floor(n/e[0]),o=Math.ceil(e[2]/s),i=s*e[0],a*=o):i=e[0]*e[2],{texDimX:i,texDimY:a,texRows:o,texCols:s,powerOfTwoSize:a<n?n:n*2}}function zct(e,t,r,n,i){var a=n.gl,o=n.resources,s=n.state,u=n.extensions,l=u.colorBufferHalfFloat,c=u.textureHalfFloat,d=e.colorType.endsWith("Instance"),f=Xt.fromSphere3D(Xt(),d?e.boundingSphere:e.invariantBoundingSphere),p=1/t,v=Xt.scale(Xt(),f,p),h=Xt.size(_(),v);_.ceil(h,h),_.add(h,h,_.create(2,2,2));var m=f.min,g=h[0],y=h[1],b=h[2],S=jct(h),x=S.texDimX,C=S.texDimY,w=S.texCols;n.namedTextures[bu]||(n.namedTextures[bu]=l&&c?o.texture("image-float16","rgba","fp16","nearest"):o.texture("image-float32","rgba","float","nearest"));var A=n.namedTextures[bu];A.define(x,C);var M=kct(n,e,f,t,r),D=M.values,k=D.uCurrentSlice,R=D.uCurrentX,O=D.uCurrentY;n.namedFramebuffers[bu]||(n.namedFramebuffers[bu]=n.resources.framebuffer());var H=n.namedFramebuffers[bu];H.bind(),Lct(n),s.currentRenderItemId=-1,A.attachFramebuffer(H,0),a.viewport(0,0,x,C),a.scissor(0,0,x,C),a.clear(a.COLOR_BUFFER_BIT),F.update(O,0);for(var B=0,j=0,Y=0,G=0;G<b;++G)B>=w&&(B-=w,j+=y,Y=0,F.update(O,j)),F.update(R,Y),F.update(k,G),a.viewport(Y,j,g,y),a.scissor(Y,j,g,y),M.render(),++B,Y+=g;i||(i=o.texture("image-uint8","rgb","ubyte","linear")),i.define(x,C);var $=Nct(n,A);Uct(n),s.currentRenderItemId=-1,i.attachFramebuffer(H,0),a.viewport(0,0,x,C),a.scissor(0,0,x,C),a.clear(a.COLOR_BUFFER_BIT),$.render();var q=Ar.create(m[0],m[1],m[2],p),ee=d?"volumeInstance":"volume";return{texture:i,gridDim:h,gridTexDim:He.create(x,C),gridTransform:q,type:ee}}var Yae={smoothColors:I.MappedStatic("auto",{auto:I.Group({}),on:I.Group({resolutionFactor:I.Numeric(2,{min:.5,max:6,step:.1}),sampleStride:I.Numeric(3,{min:1,max:12,step:1})}),off:I.Group({})})};function E2(e,t,r,n){if((e.smoothColors.name==="on"||e.smoothColors.name==="auto"&&t.color.preferSmoothing)&&r&&r<3&&n){var i=3;return e.smoothColors.name==="on"?(r*=e.smoothColors.params.resolutionFactor,i=e.smoothColors.params.sampleStride):(r*=2-zQ(0,1.1,r),r=Math.max(.5,r),r>1.2&&(i=2)),{resolution:r,stride:i,webgl:n}}}function Kae(e){return e==="group"||e==="groupInstance"}function a6(e,t,r,n,i){if(Kae(e.dColorType.ref.value)){var a=Pct({vertexCount:e.uVertexCount.ref.value,instanceCount:e.uInstanceCount.ref.value,groupCount:e.uGroupCount.ref.value,transformBuffer:e.aTransform.ref.value,instanceBuffer:e.aInstance.ref.value,positionBuffer:e.aPosition.ref.value,groupBuffer:e.aGroup.ref.value,colorData:e.tColor.ref.value,colorType:e.dColorType.ref.value,boundingSphere:e.boundingSphere.ref.value,invariantBoundingSphere:e.invariantBoundingSphere.ref.value},t,r,n,i);a.kind==="volume"?(F.updateIfChanged(e.dColorType,a.type),F.update(e.tColorGrid,a.texture),F.update(e.uColorTexDim,a.gridTexDim),F.update(e.uColorGridDim,a.gridDim),F.update(e.uColorGridTransform,a.gridTransform)):a.kind==="vertex"&&(F.updateIfChanged(e.dColorType,a.type),F.update(e.tColor,a.texture),F.update(e.uColorTexDim,a.texDim))}}function Qae(e,t,r,n,i){if(Kae(e.dColorType.ref.value)){r*=3;var a=zct({vertexCount:e.uVertexCount.ref.value,instanceCount:e.uInstanceCount.ref.value,groupCount:e.uGroupCount.ref.value,transformBuffer:e.aTransform.ref.value,instanceBuffer:e.aInstance.ref.value,positionTexture:e.tPosition.ref.value,groupTexture:e.tGroup.ref.value,colorData:e.tColor.ref.value,colorType:e.dColorType.ref.value,boundingSphere:e.boundingSphere.ref.value,invariantBoundingSphere:e.invariantBoundingSphere.ref.value},t,r,n,i);F.updateIfChanged(e.dColorType,a.type),F.update(e.tColorGrid,a.texture),F.update(e.uColorTexDim,a.gridTexDim),F.update(e.uColorGridDim,a.gridDim),F.update(e.uColorGridTransform,a.gridTransform)}}var Zae=E(E(E({},w2),Yae),{ignoreHydrogens:I.Boolean(!1),tryUseGpu:I.Boolean(!0)}),o6=E(E(E({},Ea),gKe),Zae),Jae=E(E(E({},p2),cKe),Zae);function eoe(e){return e.extensions.colorBufferFloat&&e.extensions.textureFloat&&e.extensions.blendMinMax&&e.extensions.drawBuffers}function k0(e,t,r){if(t.resolution>1)return!1;var n=r.maxTextureSize/3,i=Lre(e.boundary.box,t.resolution,n*n),a=i.areaCells,o=i.maxAreaCells;return a<o}function Vct(e,t,r,n){return r.tryUseGpu&&n&&eoe(n)&&k0(t,r,n)?Yct(e):qct(e)}function Hct(e,t,r,n){return r.tryUseGpu&&n&&eoe(n)&&k0(t,r,n)?Qct(e):Wct(e)}function Gct(e,t,r,n,i,a){return ce(this,void 0,void 0,function(){var o,s,u,l,c,d,f,p,v,h;return de(this,function(m){switch(m.label){case 0:return o=i.smoothness,[4,Wae(r,t,i).runInContext(e.runtime)];case 1:return s=m.sent(),u=s.transform,l=s.field,c=s.idField,d=s.radiusFactor,f=s.resolution,p={isoLevel:Math.exp(-o)/d,scalarField:l,idField:c},[4,iA(p,a).runAsChild(e.runtime)];case 2:return v=m.sent(),v.meta.resolution=f,Ft.transform(v,u),e.webgl&&!e.webgl.isWebGL2&&Ft.uniformTriangleGroup(v),h=Be.expand(Be(),t.boundary.sphere,i.radiusOffset+M0(t)),v.setBoundingSphere(h),[2,v]}})})}function qct(e){return uo({defaultProps:I.getDefaultValues(o6),createGeometry:Gct,createLocationIterator:qa.fromGroup,getLoci:Wl,eachLocation:$l,setUpdateState:function(t,r,n){r.resolution!==n.resolution&&(t.createGeometry=!0),r.radiusOffset!==n.radiusOffset&&(t.createGeometry=!0),r.smoothness!==n.smoothness&&(t.createGeometry=!0),r.ignoreHydrogens!==n.ignoreHydrogens&&(t.createGeometry=!0),r.traceOnly!==n.traceOnly&&(t.createGeometry=!0),r.includeParent!==n.includeParent&&(t.createGeometry=!0),r.smoothColors.name!==n.smoothColors.name?t.updateColor=!0:r.smoothColors.name==="on"&&n.smoothColors.name==="on"&&(r.smoothColors.params.resolutionFactor!==n.smoothColors.params.resolutionFactor&&(t.updateColor=!0),r.smoothColors.params.sampleStride!==n.smoothColors.params.sampleStride&&(t.updateColor=!0))},mustRecreate:function(t,r,n){return r.tryUseGpu&&!!n&&k0(t.structure,r,n)},processValues:function(t,r,n,i,a){var o=r.meta,s=o.resolution,u=o.colorTexture,l=E2(n,i,s,a);l&&(a6(t,l.resolution,l.stride,l.webgl,u),r.meta.colorTexture=t.tColorGrid.ref.value)},dispose:function(t){var r;(r=t.meta.colorTexture)===null||r===void 0||r.destroy()}},e)}function $ct(e,t,r,n,i){return ce(this,void 0,void 0,function(){var a,o,s,u,l,c,d,f,p,v;return de(this,function(h){switch(h.label){case 0:return a=n.smoothness,[4,wct(t,n).runInContext(e.runtime)];case 1:return o=h.sent(),s=o.transform,u=o.field,l=o.idField,c=o.radiusFactor,d=o.resolution,f={isoLevel:Math.exp(-a)/c,scalarField:u,idField:l},[4,iA(f,i).runAsChild(e.runtime)];case 2:return p=h.sent(),p.meta.resolution=d,Ft.transform(p,s),e.webgl&&!e.webgl.isWebGL2&&Ft.uniformTriangleGroup(p),v=Be.expand(Be(),t.boundary.sphere,n.radiusOffset+JE(t)),p.setBoundingSphere(v),[2,p]}})})}function Wct(e){return zv({defaultProps:I.getDefaultValues(Jae),createGeometry:$ct,createLocationIterator:qa.fromStructure,getLoci:cA,eachLocation:lA,setUpdateState:function(t,r,n){r.resolution!==n.resolution&&(t.createGeometry=!0),r.radiusOffset!==n.radiusOffset&&(t.createGeometry=!0),r.smoothness!==n.smoothness&&(t.createGeometry=!0),r.ignoreHydrogens!==n.ignoreHydrogens&&(t.createGeometry=!0),r.traceOnly!==n.traceOnly&&(t.createGeometry=!0),r.smoothColors.name!==n.smoothColors.name?t.updateColor=!0:r.smoothColors.name==="on"&&n.smoothColors.name==="on"&&(r.smoothColors.params.resolutionFactor!==n.smoothColors.params.resolutionFactor&&(t.updateColor=!0),r.smoothColors.params.sampleStride!==n.smoothColors.params.sampleStride&&(t.updateColor=!0))},mustRecreate:function(t,r,n){return r.tryUseGpu&&!!n&&k0(t,r,n)},processValues:function(t,r,n,i,a){var o=r.meta,s=o.resolution,u=o.colorTexture,l=E2(n,i,s,a);l&&(a6(t,l.resolution,l.stride,l.webgl,u),r.meta.colorTexture=t.tColorGrid.ref.value)},dispose:function(t){var r;(r=t.meta.colorTexture)===null||r===void 0||r.destroy()}},e)}var Eg="gaussian-surface";function Xct(e,t,r,n,i,a){return ce(this,void 0,void 0,function(){var o,s,u,l,c,d,f,p,v,h,m,g,y,b;return de(this,function(S){switch(S.label){case 0:if(!e.webgl)throw new Error("webgl context required to create gaussian surface texture-mesh");return o=e.webgl,s=o.namedTextures,u=o.resources,l=o.extensions,c=l.colorBufferFloat,d=l.textureFloat,f=l.colorBufferHalfFloat,p=l.textureHalfFloat,s[Eg]||(s[Eg]=f&&p?u.texture("image-float16","rgba","fp16","linear"):c&&d?u.texture("image-float32","rgba","float","linear"):u.texture("image-uint8","rgba","ubyte","linear")),[4,_ct(r,t,!0,i,e.webgl,s[Eg]).runInContext(e.runtime)];case 1:return v=S.sent(),h=Math.exp(-i.smoothness)/v.radiusFactor,m=a==null?void 0:a.doubleBuffer.get(),g=RF(e.webgl,v.texture,v.gridDim,v.gridTexDim,v.gridTexScale,v.transform,h,!1,!0,m==null?void 0:m.vertex,m==null?void 0:m.group,m==null?void 0:m.normal),y=Be.expand(Be(),t.boundary.sphere,i.radiusOffset+JE(r)),b=Hu.create(g.vertexCount,1,g.vertexTexture,g.groupTexture,g.normalTexture,y,a),b.meta={resolution:v.resolution},[2,b]}})})}function Yct(e){return yKe({defaultProps:I.getDefaultValues(o6),createGeometry:Xct,createLocationIterator:qa.fromGroup,getLoci:Wl,eachLocation:$l,setUpdateState:function(t,r,n){r.resolution!==n.resolution&&(t.createGeometry=!0),r.radiusOffset!==n.radiusOffset&&(t.createGeometry=!0),r.smoothness!==n.smoothness&&(t.createGeometry=!0),r.ignoreHydrogens!==n.ignoreHydrogens&&(t.createGeometry=!0),r.traceOnly!==n.traceOnly&&(t.createGeometry=!0),r.includeParent!==n.includeParent&&(t.createGeometry=!0),r.smoothColors.name!==n.smoothColors.name?t.updateColor=!0:r.smoothColors.name==="on"&&n.smoothColors.name==="on"&&(r.smoothColors.params.resolutionFactor!==n.smoothColors.params.resolutionFactor&&(t.updateColor=!0),r.smoothColors.params.sampleStride!==n.smoothColors.params.sampleStride&&(t.updateColor=!0))},mustRecreate:function(t,r,n){return!r.tryUseGpu||!n||!k0(t.structure,r,n)},processValues:function(t,r,n,i,a){var o=r.meta,s=o.resolution,u=o.colorTexture,l=E2(n,i,s,a);l&&(Qae(t,l.resolution,l.stride,l.webgl,u),r.meta.colorTexture=t.tColorGrid.ref.value)},dispose:function(t){var r;t.vertexTexture.ref.value.destroy(),t.groupTexture.ref.value.destroy(),t.normalTexture.ref.value.destroy(),t.doubleBuffer.destroy(),(r=t.meta.colorTexture)===null||r===void 0||r.destroy()}},e)}function Kct(e,t,r,n,i){return ce(this,void 0,void 0,function(){var a,o,s,u,l,c,d,f,p,v,h,m,g,y;return de(this,function(b){switch(b.label){case 0:if(!e.webgl)throw new Error("webgl context required to create structure gaussian surface texture-mesh");return a=e.webgl,o=a.namedTextures,s=a.resources,u=a.extensions,l=u.colorBufferFloat,c=u.textureFloat,d=u.colorBufferHalfFloat,f=u.textureHalfFloat,o[Eg]||(o[Eg]=d&&f?s.texture("image-float16","rgba","fp16","linear"):l&&c?s.texture("image-float32","rgba","float","linear"):s.texture("image-uint8","rgba","ubyte","linear")),[4,Act(t,!0,n,e.webgl,o[Eg]).runInContext(e.runtime)];case 1:return p=b.sent(),v=Math.exp(-n.smoothness)/p.radiusFactor,h=i==null?void 0:i.doubleBuffer.get(),m=RF(e.webgl,p.texture,p.gridDim,p.gridTexDim,p.gridTexScale,p.transform,v,!1,!0,h==null?void 0:h.vertex,h==null?void 0:h.group,h==null?void 0:h.normal),g=Be.expand(Be(),t.boundary.sphere,n.radiusOffset+JE(t)),y=Hu.create(m.vertexCount,1,m.vertexTexture,m.groupTexture,m.normalTexture,g,i),y.meta={resolution:p.resolution},[2,y]}})})}function Qct(e){return dKe({defaultProps:I.getDefaultValues(Jae),createGeometry:Kct,createLocationIterator:qa.fromStructure,getLoci:cA,eachLocation:lA,setUpdateState:function(t,r,n){r.resolution!==n.resolution&&(t.createGeometry=!0),r.radiusOffset!==n.radiusOffset&&(t.createGeometry=!0),r.smoothness!==n.smoothness&&(t.createGeometry=!0),r.ignoreHydrogens!==n.ignoreHydrogens&&(t.createGeometry=!0),r.traceOnly!==n.traceOnly&&(t.createGeometry=!0),r.includeParent!==n.includeParent&&(t.createGeometry=!0),r.smoothColors.name!==n.smoothColors.name?t.updateColor=!0:r.smoothColors.name==="on"&&n.smoothColors.name==="on"&&(r.smoothColors.params.resolutionFactor!==n.smoothColors.params.resolutionFactor&&(t.updateColor=!0),r.smoothColors.params.sampleStride!==n.smoothColors.params.sampleStride&&(t.updateColor=!0))},mustRecreate:function(t,r,n){return!r.tryUseGpu||!n||!k0(t,r,n)},processValues:function(t,r,n,i,a){var o=r.meta,s=o.resolution,u=o.colorTexture,l=E2(n,i,s,a);l&&(Qae(t,l.resolution,l.stride,l.webgl,u),r.meta.colorTexture=t.tColorGrid.ref.value)},dispose:function(t){var r;t.vertexTexture.ref.value.destroy(),t.groupTexture.ref.value.destroy(),t.normalTexture.ref.value.destroy(),t.doubleBuffer.destroy(),(r=t.meta.colorTexture)===null||r===void 0||r.destroy()}},e)}function Zct(e,t,r,n,i,a){return ce(this,void 0,void 0,function(){var o,s,u,l,c,d,f,p;return de(this,function(v){switch(v.label){case 0:return o=i.smoothness,[4,Wae(r,t,i).runInContext(e.runtime)];case 1:return s=v.sent(),u=s.transform,l=s.field,c=s.idField,d={isoLevel:Math.exp(-o),scalarField:l,idField:c},[4,MF(d,a).runAsChild(e.runtime)];case 2:return f=v.sent(),wn.transform(f,u),p=Be.expand(Be(),t.boundary.sphere,i.radiusOffset+M0(t)),f.setBoundingSphere(p),[2,f]}})})}var toe=E(E(E({},uF),w2),{sizeFactor:I.Numeric(3,{min:0,max:10,step:.1}),lineSizeAttenuation:I.Boolean(!1),ignoreHydrogens:I.Boolean(!1)});function Jct(e){return lF({defaultProps:I.getDefaultValues(toe),createGeometry:Zct,createLocationIterator:qa.fromGroup,getLoci:Wl,eachLocation:$l,setUpdateState:function(t,r,n){r.resolution!==n.resolution&&(t.createGeometry=!0),r.radiusOffset!==n.radiusOffset&&(t.createGeometry=!0),r.smoothness!==n.smoothness&&(t.createGeometry=!0),r.ignoreHydrogens!==n.ignoreHydrogens&&(t.createGeometry=!0),r.traceOnly!==n.traceOnly&&(t.createGeometry=!0),r.includeParent!==n.includeParent&&(t.createGeometry=!0)}},e)}var roe={"gaussian-surface-mesh":function(e,t){return ii("Gaussian surface mesh",e,t,Vct)},"structure-gaussian-surface-mesh":function(e,t){return Ru("Structure-Gaussian surface mesh",e,t,Hct)},"gaussian-surface-wireframe":function(e,t){return ii("Gaussian surface wireframe",e,t,Jct)}},noe=E(E(E({},o6),toe),{visuals:I.MultiSelect(["gaussian-surface-mesh"],I.objectToOptions(roe))});function edt(e,t){return I.clone(noe)}function tdt(e,t){return or.createMulti("Gaussian Surface",e,t,Ui,roe)}var rdt={name:"gaussian-surface",label:"Gaussian Surface",description:"Displays a gaussian molecular surface.",factory:tdt,getParams:edt,defaultValues:I.getDefaultValues(noe),defaultColorTheme:{name:"chain-id"},defaultSizeTheme:{name:"uniform"},isApplicable:function(e){return e.elementCount>0}},ioe=E(E({},oKe),{background:I.Boolean(!0),backgroundMargin:I.Numeric(0,{min:0,max:1,step:.01}),backgroundColor:I.Color(fr.black),backgroundOpacity:I.Numeric(.5,{min:0,max:1,step:.01}),level:I.Select("residue",[["chain","Chain"],["residue","Residue"],["element","Element"]]),chainScale:I.Numeric(10,{min:0,max:20,step:.1}),residueScale:I.Numeric(1,{min:0,max:20,step:.1}),elementScale:I.Numeric(.5,{min:0,max:20,step:.1})});function ndt(e){return sKe({defaultProps:I.getDefaultValues(ioe),createGeometry:idt,createLocationIterator:qa.fromStructure,getLoci:cA,eachLocation:lA,setUpdateState:function(t,r,n){t.createGeometry=r.level!==n.level||r.level==="chain"&&r.chainScale!==n.chainScale||r.level==="residue"&&r.residueScale!==n.residueScale||r.level==="element"&&r.elementScale!==n.elementScale}},e)}function idt(e,t,r,n,i){switch(n.level){case"chain":return adt(e,t,r,n,i);case"residue":return odt(e,t,r,n,i);case"element":return sdt(e,t,r,n,i)}}var js=_(),Ty=new ps("98");function adt(e,t,r,n,i){for(var a=Ze.create(t),o=t.units,s=t.serialMapping,u=lt.chain,l=u.auth_asym_id,c=u.label_asym_id,d=s.cumulativeUnitElementCount,f=o.length,p=n.chainScale,v=ad.create(n,f,f/2,i),h=0,m=o.length;h<m;++h){var g=o[h];a.unit=g,a.element=g.elements[0];var y=g.lookup3d.boundary.sphere,b=y.center,S=y.radius;_.transformMat4(js,b,g.conformation.operator.matrix);var x=l(a),C=c(a),w=x===C?C:C+" ["+x+"]";v.add(w,js[0],js[1],js[2],S,p,d[h])}return v.getText()}function odt(e,t,r,n,i){for(var a=Ze.create(t),o=t.units,s=t.serialMapping,u=lt.atom.label_comp_id,l=lt.residue.auth_seq_id,c=s.cumulativeUnitElementCount,d=t.polymerResidueCount*2,f=n.residueScale,p=ad.create(n,d,d/2,i),v=0,h=o.length;v<h;++v){var m=o[v],g=m.conformation.position,y=m.elements;a.unit=m,a.element=m.elements[0];for(var b=m.model.atomicHierarchy.residueAtomSegments.index,S=c[v],x=0,C=y.length;x<C;){var w=x,A=b[y[x]];for(x++;x<C&&b[y[x]]===A;)x++;Ty.reset();for(var M=w;M<x;M++)g(y[M],js),Ty.includePosition(js);Ty.finishedIncludeStep();for(var M=w;M<x;M++)g(y[M],js),Ty.radiusPosition(js);a.element=y[w];var D=Ty.getSphere(),k=D.center,R=D.radius,O=l(a),H=u(a),B=H+" "+O;p.add(B,k[0],k[1],k[2],R,f,S+w)}}return p.getText()}function sdt(e,t,r,n,i){for(var a=Ze.create(t),o=t.units,s=t.serialMapping,u=lt.atom,l=u.label_atom_id,c=u.label_alt_id,d=s.cumulativeUnitElementCount,f=d2({},{scale:1}),p=t.elementCount,v=n.elementScale,h=ad.create(n,p,p/2,i),m=0,g=o.length;m<g;++m){var y=o[m],b=y.conformation.position,S=y.elements;a.unit=y;for(var x=d[m],C=0,w=S.length;C<w;C++){a.element=S[C],b(a.element,js);var A=l(a),M=c(a),D=M?A+"%"+M:A;h.add(D,js[0],js[1],js[2],f.size(a),v,x+C)}}return h.getText()}var aoe={"label-text":function(e,t){return Ru("Label text",e,t,ndt)}},ooe=E(E({},ioe),{visuals:I.MultiSelect(["label-text"],I.objectToOptions(aoe))});function udt(e,t){return I.clone(ooe)}function ldt(e,t){var r=or.createMulti("Label",e,t,Ui,aoe);return r.setState({pickable:!1,markerActions:tr.None}),r}var cdt={name:"label",label:"Label",description:"Displays labels.",factory:ldt,getParams:udt,defaultValues:I.getDefaultValues(ooe),defaultColorTheme:{name:"uniform"},defaultSizeTheme:{name:"uniform"},isApplicable:function(e){return e.elementCount>0}};function ddt(e,t){return e[0]=e[1]=e[2]=1,t[0]!==0?e[0]=(t[1]+t[2])/-t[0]:t[1]!==0?e[1]=(t[0]+t[2])/-t[1]:t[2]!==0&&(e[2]=(t[0]+t[1])/-t[2]),e}function fdt(e){for(var t=0,r=2*Math.PI/e,n=new Float32Array(e),i=new Float32Array(e),a=0;a<e;a++)n[a]=Math.cos(t),i[a]=Math.sin(t),t+=r;return{cosTable:n,sinTable:i}}var s6={probeRadius:I.Numeric(1.4,{min:0,max:10,step:.1},{description:"Radius of the probe tracing the molecular surface."}),resolution:I.Numeric(.5,{min:.01,max:20,step:.01},E({description:"Grid resolution/cell spacing."},Et.CustomQualityParamInfo)),probePositions:I.Numeric(36,{min:12,max:90,step:1},E({description:"Number of positions tested for probe target intersection."},Et.CustomQualityParamInfo))};I.getDefaultValues(s6);function pdt(e,t,r,n,i,a){return ce(this,void 0,void 0,function(){function o(Ve,Xe,ct,Ne,Qe){if(p!==-1){var it=p;if(it!==Ne&&it!==Qe&&s(it,Ve,Xe,ct))return it;p=-1}for(var ot=0,dt=M.count;ot<dt;++ot){var it=Le.getAt(D,M.indices[ot]);if(it!==Ne&&it!==Qe&&s(it,Ve,Xe,ct))return p=it,it}return-1}function s(Ve,Xe,ct,Ne){var Qe=B[Ve],it=k[Ve]-Xe,ot=R[Ve]-ct,dt=O[Ve]-Ne,ke=it*it+ot*ot+dt*dt;return ke<Qe*Qe}function u(Ve,Xe){for(var ct=Ve;ct<Xe;++ct){var Ne=Le.getAt(D,ct),Qe=k[Ne],it=R[Ne],ot=O[Ne],dt=B[Ne],ke=dt*dt;A.find(Qe,it,ot,dt);for(var Me=Math.ceil(dt*x),Ye=Math.floor(x*(Qe-q)),tt=Math.floor(x*(it-ee)),xt=Math.floor(x*(ot-fe)),ht=Math.max(0,Ye-Me),ut=Math.max(0,tt-Me),pe=Math.max(0,xt-Me),me=Math.min(U,Ye+Me+2),Ee=Math.min(z,tt+Me+2),Ke=Math.min(J,xt+Me+2),gt=ht;gt<me;++gt)for(var Pt=oe[gt]-Qe,Wt=gt*te,lr=ut;lr<Ee;++lr)for(var Tr=L[lr]-it,Yt=Pt*Pt+Tr*Tr,ai=lr*K+Wt,ea=pe;ea<Ke;++ea){var ta=V[ea]-ot,Oo=Yt+ta*ta;if(Oo<ke){var Wu=ea+ai;Se[Wu]<0&&(Se[Wu]*=-1);var Xl=Math.sqrt(Oo),nu=dt/Xl,Dp=Pt*nu+Qe,Rp=Tr*nu+it,lo=ta*nu+ot;if(o(Dp,Rp,lo,Ne,-1)===-1){var Fd=dt-Xl;Fd<Se[Wu]&&(Se[Wu]=Fd,ie[Wu]=H[ct])}}}}}function l(){return ce(this,void 0,void 0,function(){var Ve;return de(this,function(Xe){switch(Xe.label){case 0:Ve=0,Xe.label=1;case 1:return Ve<j?(u(Ve,Math.min(Ve+he,j)),e.shouldUpdate?[4,e.update({message:"projecting points",current:Ve,max:j})]:[3,3]):[3,4];case 2:Xe.sent(),Xe.label=3;case 3:return Ve+=he,[3,1];case 4:return[2]}})})}function c(Ve,Xe){var ct=B[Ve],Ne=B[Xe],Qe=v[0]=k[Xe]-k[Ve],it=v[1]=R[Xe]-R[Ve],ot=v[2]=O[Xe]-O[Ve],dt=Qe*Qe+it*it+ot*ot,ke=Math.sqrt(dt),Me=(ct*ct+ke*ke-Ne*Ne)/(2*ct*ke),Ye=ct*Me;_.normalize(v,v),ddt(m,v),_.normalize(m,m),_.cross(g,v,m),_.normalize(g,g);var tt=Math.sqrt(ct*ct-Ye*Ye);_.scale(m,m,tt),_.scale(g,g,tt),_.scale(v,v,Ye),h[0]=v[0]+k[Ve],h[1]=v[1]+R[Ve],h[2]=v[2]+O[Ve],p=-1;for(var xt=0;xt<S;++xt){var ht=ye[xt],ut=be[xt],pe=h[0]+ht*m[0]+ut*g[0],me=h[1]+ht*m[1]+ut*g[1],Ee=h[2]+ht*m[2]+ut*g[2];if(o(pe,me,Ee,Ve,Xe)===-1)for(var Ke=Math.floor(x*(pe-q)),gt=Math.floor(x*(me-ee)),Pt=Math.floor(x*(Ee-fe)),Wt=Math.max(0,Ke-C),lr=Math.max(0,gt-C),Tr=Math.max(0,Pt-C),Yt=Math.min(U,Ke+C+2),ai=Math.min(z,gt+C+2),ea=Math.min(J,Pt+C+2),ta=Wt;ta<Yt;++ta)for(var Oo=pe-oe[ta],Wu=ta*te,Xl=lr;Xl<ai;++Xl)for(var nu=me-L[Xl],Dp=Oo*Oo+nu*nu,Rp=Xl*K+Wu,lo=Tr;lo<ea;++lo){var Fd=Ee-V[lo],A2=Dp+Fd*Fd,kp=lo+Rp,Op=Se[kp];if(Op>0&&A2<Op*Op){Se[kp]=Math.sqrt(A2);var Wa=Oo*v[0]+nu*v[1]+Fd*v[2];ie[kp]=H[Le.indexOf(D,Wa<0?Xe:Ve)]}}}}function d(Ve,Xe){for(var ct=Ve;ct<Xe;++ct){var Ne=Le.getAt(D,ct);A.find(k[Ne],R[Ne],O[Ne],B[Ne]);for(var Qe=0,it=M.count;Qe<it;++Qe){var ot=Le.getAt(D,M.indices[Qe]);Ne<ot&&c(Ne,ot)}}}function f(){return ce(this,void 0,void 0,function(){var Ve;return de(this,function(Xe){switch(Xe.label){case 0:Ve=0,Xe.label=1;case 1:return Ve<j?(d(Ve,Math.min(Ve+he,j)),e.shouldUpdate?[4,e.update({message:"projecting torii",current:Ve,max:j})]:[3,3]):[3,4];case 2:Xe.sent(),Xe.label=3;case 3:return Ve+=he,[3,1];case 4:return[2]}})})}var p,v,h,m,g,y,b,S,x,C,w,A,M,D,k,R,O,H,B,j,Y,G,$,q,ee,fe,W,X,U,z,J,K,Z,te,le,ye,be,Ae,Se,ie,oe,L,V,he,we,Te,ze;return de(this,function(Ve){switch(Ve.label){case 0:return p=-1,v=_(),h=_(),m=_(),g=_(),y=a.resolution,b=a.probeRadius,S=a.probePositions,x=1/y,C=Math.max(5,2+Math.floor(b*x)),w=_.create(n,n,n),_.scale(w,w,2),A=fv(t,r,w),M=A.result,i===null&&(i=A.boundary.box),D=t.indices,k=t.x,R=t.y,O=t.z,H=t.id,B=t.radius,j=Le.size(D),Y=n+y,G=Xt.expand(Xt(),i,_.create(Y,Y,Y)),$=G.min,q=$[0],ee=$[1],fe=$[2],W=Xt.scale(Xt(),G,x),X=Xt.size(_(),W),_.ceil(X,X),U=X[0],z=X[1],J=X[2],K=J,Z=z,te=K*Z,le=fdt(S),ye=le.cosTable,be=le.sinTable,Ae=Mr.Space(X,[0,1,2],Float32Array),Se=Ae.create(),ie=Ae.create(),Se.fill(-1001),ie.fill(-1),oe=yg(U,q,y),L=yg(z,ee,y),V=yg(J,fe,y),he=Math.ceil(1e5/(Math.pow(Math.pow(n,3),3)*x)),[4,l()];case 1:return Ve.sent(),[4,f()];case 2:return Ve.sent(),we=Mr.create(Ae,Se),Te=Mr.create(Ae,ie),ze=ue.identity(),ue.fromScaling(ze,_.create(y,y,y)),ue.setTranslation(ze,G.min),[2,{field:we,idField:Te,transform:ze,resolution:y}]}})})}function hdt(e,t,r){for(var n=r.probeRadius,i=ZE(e,t,r),a=i.position,o=i.boundary,s=i.radius,u=a.indices,l=Le.size(u),c=new Float32Array(Le.end(u)),d=0,f=0;f<l;++f){var p=Le.getAt(u,f),v=s(p);d<v&&(d=v),c[p]=v+n}return{position:E(E({},a),{radius:c}),boundary:o,maxRadius:d}}function soe(e,t,r){var n=this,i=t.lookup3d.boundary.box,a=jv(i,r),o=hdt(e,t,a),s=o.position,u=o.boundary,l=o.maxRadius;return $e.create("Molecular Surface",function(c){return ce(n,void 0,void 0,function(){return de(this,function(d){switch(d.label){case 0:return[4,vdt(c,s,u,l,i,a)];case 1:return[2,d.sent()]}})})})}function vdt(e,t,r,n,i,a){return ce(this,void 0,void 0,function(){return de(this,function(o){return[2,pdt(e,t,r,n,i,a)]})})}var uoe=E(E(E(E({},Ea),s6),QE),Yae);function mdt(e,t,r,n,i,a){return ce(this,void 0,void 0,function(){var o,s,u,l,c,d,f,p;return de(this,function(v){switch(v.label){case 0:return[4,soe(r,t,i).runInContext(e.runtime)];case 1:return o=v.sent(),s=o.transform,u=o.field,l=o.idField,c=o.resolution,d={isoLevel:i.probeRadius,scalarField:u,idField:l},[4,iA(d,a).runAsChild(e.runtime)];case 2:return f=v.sent(),Ft.transform(f,s),e.webgl&&!e.webgl.isWebGL2&&Ft.uniformTriangleGroup(f),p=Be.expand(Be(),t.boundary.sphere,i.probeRadius+M0(t)),f.setBoundingSphere(p),f.meta.resolution=c,[2,f]}})})}function gdt(e){return uo({defaultProps:I.getDefaultValues(uoe),createGeometry:mdt,createLocationIterator:qa.fromGroup,getLoci:Wl,eachLocation:$l,setUpdateState:function(t,r,n){r.resolution!==n.resolution&&(t.createGeometry=!0),r.probeRadius!==n.probeRadius&&(t.createGeometry=!0),r.probePositions!==n.probePositions&&(t.createGeometry=!0),r.ignoreHydrogens!==n.ignoreHydrogens&&(t.createGeometry=!0),r.traceOnly!==n.traceOnly&&(t.createGeometry=!0),r.includeParent!==n.includeParent&&(t.createGeometry=!0),r.smoothColors.name!==n.smoothColors.name?t.updateColor=!0:r.smoothColors.name==="on"&&n.smoothColors.name==="on"&&(r.smoothColors.params.resolutionFactor!==n.smoothColors.params.resolutionFactor&&(t.updateColor=!0),r.smoothColors.params.sampleStride!==n.smoothColors.params.sampleStride&&(t.updateColor=!0))},processValues:function(t,r,n,i,a){var o=r.meta,s=o.resolution,u=o.colorTexture,l=E2(n,i,s,a);l&&(a6(t,l.resolution,l.stride,l.webgl,u),r.meta.colorTexture=t.tColorGrid.ref.value)},dispose:function(t){var r;(r=t.meta.colorTexture)===null||r===void 0||r.destroy()}},e)}var loe=E(E(E(E({},uF),s6),QE),{sizeFactor:I.Numeric(1.5,{min:0,max:10,step:.1})});function ydt(e,t,r,n,i,a){return ce(this,void 0,void 0,function(){var o,s,u,l,c,d,f;return de(this,function(p){switch(p.label){case 0:return[4,soe(r,t,i).runInContext(e.runtime)];case 1:return o=p.sent(),s=o.transform,u=o.field,l=o.idField,c={isoLevel:i.probeRadius,scalarField:u,idField:l},[4,MF(c,a).runAsChild(e.runtime)];case 2:return d=p.sent(),wn.transform(d,s),f=Be.expand(Be(),t.boundary.sphere,i.probeRadius+M0(t)),d.setBoundingSphere(f),[2,d]}})})}function bdt(e){return lF({defaultProps:I.getDefaultValues(loe),createGeometry:ydt,createLocationIterator:qa.fromGroup,getLoci:Wl,eachLocation:$l,setUpdateState:function(t,r,n){r.resolution!==n.resolution&&(t.createGeometry=!0),r.probeRadius!==n.probeRadius&&(t.createGeometry=!0),r.probePositions!==n.probePositions&&(t.createGeometry=!0),r.ignoreHydrogens!==n.ignoreHydrogens&&(t.createGeometry=!0),r.includeParent!==n.includeParent&&(t.createGeometry=!0)}},e)}var coe={"molecular-surface-mesh":function(e,t){return ii("Molecular surface mesh",e,t,gdt)},"molecular-surface-wireframe":function(e,t){return ii("Molecular surface wireframe",e,t,bdt)}},doe=E(E(E({},uoe),loe),{visuals:I.MultiSelect(["molecular-surface-mesh"],I.objectToOptions(coe))});function xdt(e,t){return I.clone(doe)}function Sdt(e,t){return or.createMulti("Molecular Surface",e,t,Ui,coe)}var Cdt={name:"molecular-surface",label:"Molecular Surface",description:"Displays a molecular surface.",factory:Sdt,getParams:xdt,defaultValues:I.getDefaultValues(doe),defaultColorTheme:{name:"chain-id"},defaultSizeTheme:{name:"uniform"},isApplicable:function(e){return e.elementCount>0}},foe=E(E({},Ea),{sizeFactor:I.Numeric(1,{min:0,max:2,step:.1}),detail:I.Numeric(0,{min:0,max:3,step:1},Et.CustomQualityParamInfo)});function _dt(e){return uo({defaultProps:I.getDefaultValues(foe),createGeometry:Edt,createLocationIterator:Adt,getLoci:Pdt,eachLocation:Tdt,setUpdateState:function(t,r,n){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.detail!==n.detail}},e)}function wdt(e){if(je.Traits.is(e.traits,1)||je.Traits.is(e.traits,2))return!1;if(je.isCoarse(e))return!0;if(e.elements.length===0)return!1;e.model.atomicHierarchy.derived.residue.moleculeType;var t=e.residueIndex[e.elements[0]],r=e.model.atomicHierarchy.derived.residue.moleculeType[t];return!(r===3||r===2)}function Edt(e,t,r,n,i,a){if(!wdt(t))return Ft.createEmpty(a);var o=i.detail,s=i.sizeFactor,u=256,l=wt.createState(u,u/2,a),c=t.principalAxes.boxAxes,d=c.origin,f=c.dirA,p=c.dirB,v=_u.size(_(),c);_.scale(v,v,s/2);var h=_.create(v[2],v[1],v[0]);l.currentGroup=0,tF(l,d,f,p,h,o+1);var m=wt.getMesh(l),g=Be.expand(Be(),t.boundary.sphere,1*i.sizeFactor);return m.setBoundingSphere(g),m}function Adt(e){var t=e.group,r=e.structure,n=1,i=t.units.length,a=Ze.create(r),o=function(s,u){var l=t.units[u];return a.unit=l,a.element=l.elements[s],a};return Sn(n,i,1,o)}function Pdt(e,t,r){var n=e.objectId,i=e.instanceId;if(r===n){var a=t.structure,o=t.group,s=o.units[i],u=Le.ofBounds(0,s.elements.length);return Re(a,[{unit:s,indices:u}])}return Nr}function Tdt(e,t,r){var n=!1;if(!Re.is(e))return!1;var i=t.structure,a=t.group;if(!We.areEquivalent(e.structure,i))return!1;for(var o=a.elements.length,s=0,u=e.elements;s<u.length;s++){var l=u[s],c=a.unitIndexMap.get(l.unit.id);c!==void 0&&Le.size(l.indices)===o&&r(Ie.ofSingleton(c))&&(n=!0)}return n}var poe={"orientation-ellipsoid-mesh":function(e,t){return ii("Orientation ellipsoid mesh",e,t,_dt)}},hoe=E(E({},foe),{visuals:I.MultiSelect(["orientation-ellipsoid-mesh"],I.objectToOptions(poe))});function Idt(e,t){return I.clone(hoe)}function Mdt(e,t){return or.createMulti("Orientation",e,t,Ui,poe)}var Ddt={name:"orientation",label:"Orientation",description:"Displays orientation ellipsoids for polymer chains.",factory:Mdt,getParams:Idt,defaultValues:I.getDefaultValues(hoe),defaultColorTheme:{name:"chain-id"},defaultSizeTheme:{name:"uniform"},isApplicable:function(e){return e.elementCount>0}},Rdt=qe.add3,kdt=qe.add,OR;(function(e){function t(r,n,i){r===void 0&&(r=2048),n===void 0&&(n=1024);var a=qe.create(Float32Array,3,n,i?i.centerBuffer.ref.value:r),o=qe.create(Float32Array,1,n,i?i.groupBuffer.ref.value:r);return{add:function(s,u,l,c){Rdt(a,s,u,l),kdt(o,c)},getPoints:function(){var s=qe.compact(a,!0),u=qe.compact(o,!0);return bv.create(s,u,a.elementCount,i)}}}e.create=t})(OR||(OR={}));var voe=E(E({},pKe),{pointSizeAttenuation:I.Boolean(!0),ignoreHydrogens:I.Boolean(!1),traceOnly:I.Boolean(!1)});function Odt(e,t,r,n,i,a){var o=r.child;if(o&&!o.unitMap.get(t.id))return bv.createEmpty(a);var s=t.elements,u=s.length,l=OR.create(u,u/10,a),c=_(),d=t.conformation.invariantPosition,f=JF(r,t,i);if(f)for(var p=0;p<u;++p)f(s[p])||(d(s[p],c),l.add(c[0],c[1],c[2],p));else for(var p=0;p<u;++p)d(s[p],c),l.add(c[0],c[1],c[2],p);var v=l.getPoints(),h=Be.expand(Be(),t.boundary.sphere,1*i.sizeFactor);return v.setBoundingSphere(h),v}function Ldt(e){return hKe({defaultProps:I.getDefaultValues(voe),createGeometry:Odt,createLocationIterator:qa.fromGroup,getLoci:Wl,eachLocation:$l,setUpdateState:function(t,r,n){t.createGeometry=r.ignoreHydrogens!==n.ignoreHydrogens||r.traceOnly!==n.traceOnly}},e)}var Fdt={"element-point":function(e,t){return ii("Points",e,t,Ldt)}},moe=E({},voe);function Ndt(e,t){return I.clone(moe)}function Bdt(e,t){return or.createMulti("Point",e,t,Ui,Fdt)}var Udt={name:"point",label:"Point",description:"Displays elements (atoms, coarse spheres) as spheres.",factory:Bdt,getParams:Ndt,defaultValues:I.getDefaultValues(moe),defaultColorTheme:{name:"element-symbol"},defaultSizeTheme:{name:"physical"},isApplicable:function(e){return e.elementCount>0}},goe={sizeFactor:I.Numeric(.2,{min:0,max:10,step:.01}),detail:I.Numeric(0,{min:0,max:3,step:1},Et.CustomQualityParamInfo),linearSegments:I.Numeric(8,{min:1,max:48,step:1},Et.CustomQualityParamInfo),radialSegments:I.Numeric(16,{min:2,max:56,step:2},Et.CustomQualityParamInfo)};I.getDefaultValues(goe);var go=_();function jdt(e,t,r,n,i,a){var o=t.polymerElements.length;if(!o)return Ft.createEmpty(a);for(var s=i.sizeFactor,u=i.detail,l=i.linearSegments,c=i.radialSegments,d=l*c*o+(c+1)*o*2,f=wt.createState(d,d/10,a),p=t6(l),v=p.curvePoints,h=p.normalVectors,m=p.binormalVectors,g=p.widthValues,y=p.heightValues,b=0,S=e6(t,r,{ignoreSecondaryStructure:!0});S.hasNext;){var x=S.move();f.currentGroup=b;var C=Gl(x.moleculeType),w=C?pA:fA;r6(p,x,vae,w);var A=x.coarseBackboneFirst||x.first,M=x.coarseBackboneLast||x.last,D=n.size.size(x.centerPrev)*s,k=n.size.size(x.center)*s,R=n.size.size(x.centerNext)*s;MR(p,D,k,R,D,k,R,w);var O=l;if(x.initial){O=Math.max(Math.round(l*w),1);var H=l-O;v.copyWithin(0,H*3),m.copyWithin(0,H*3),h.copyWithin(0,H*3),g.copyWithin(0,H*3),y.copyWithin(0,H*3),_.fromArray(go,v,3),_.normalize(go,_.sub(go,x.p2,go)),_.scaleAndAdd(go,x.p2,go,k*jw),_.toArray(go,v,0)}else x.final&&(O=Math.max(Math.round(l*(1-w)),1),_.fromArray(go,v,O*3-3),_.normalize(go,_.sub(go,x.p2,go)),_.scaleAndAdd(go,x.p2,go,k*jw),_.toArray(go,v,O*3));x.initial===!0&&x.final===!0?Ni(f,x.p2,k*2,u):c===2?uC(f,v,h,m,O,g,y,0):c===4?kR(f,v,h,m,O,g,y,0,A,M):Tae(f,v,h,m,O,c,g,y,A,M),++b}var B=wt.getMesh(f),j=Be.expand(Be(),t.boundary.sphere,1*i.sizeFactor);return B.setBoundingSphere(j),B}var yoe=E(E({},Ea),goe);function zdt(e){return uo({defaultProps:I.getDefaultValues(yoe),createGeometry:jdt,createLocationIterator:fd.fromGroup,getLoci:Xv,eachLocation:Yv,setUpdateState:function(t,r,n){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.detail!==n.detail||r.linearSegments!==n.linearSegments||r.radialSegments!==n.radialSegments}},e)}var boe={"polymer-tube":function(e,t){return ii("Polymer tube mesh",e,t,zdt)},"polymer-gap":function(e,t){return ii("Polymer gap cylinder",e,t,n6)}},xoe=E(E(E({},yoe),hA),{sizeFactor:I.Numeric(.2,{min:0,max:10,step:.01}),visuals:I.MultiSelect(["polymer-tube","polymer-gap"],I.objectToOptions(boe))});function Vdt(e,t){var r=I.clone(xoe),n=!1,i=!1;return t.units.forEach(function(a){!n&&je.isAtomic(a)&&a.nucleotideElements.length&&(n=!0),!i&&a.gapElements.length&&(i=!0)}),r.visuals.defaultValue=["polymer-tube"],i&&r.visuals.defaultValue.push("polymer-gap"),r}function Hdt(e,t){return or.createMulti("Putty",e,t,Ui,boe)}var Gdt={name:"putty",label:"Putty",description:"Displays a tube smoothly following the trace atoms of polymers.",factory:Hdt,getParams:Vdt,defaultValues:I.getDefaultValues(xoe),defaultColorTheme:{name:"chain-id"},defaultSizeTheme:{name:"uncertainty"},isApplicable:function(e){return e.polymerResidueCount>0}},qdt={"element-sphere":function(e,t){return ii("Sphere mesh",e,t,rae)}},Soe=E({},dA);function $dt(e,t){var r=I.clone(Soe);return t.isCoarseGrained&&(r.sizeFactor.defaultValue=2),r}function Wdt(e,t){return or.createMulti("Spacefill",e,t,Ui,qdt)}var Xdt={name:"spacefill",label:"Spacefill",description:"Displays atomic/coarse elements as spheres.",factory:Wdt,getParams:$dt,defaultValues:I.getDefaultValues(Soe),defaultColorTheme:{name:"element-symbol"},defaultSizeTheme:{name:"physical"},isApplicable:function(e){return e.elementCount>0}},fI=Ur.is;function Ydt(e,t,r,n,i,a){if(!je.isAtomic(t))return wn.createEmpty(a);var o=r.child,s=o==null?void 0:o.unitMap.get(t.id);if(o&&!s)return wn.createEmpty(a);var u=Ze.create(r,t),l=t.elements,c=t.bonds,d=c.edgeCount,f=c.a,p=c.b,v=c.edgeProps,h=c.offset,m=v.order,g=v.flags,y=i.sizeFactor,b=i.aromaticBonds;if(!d)return wn.createEmpty(a);var S=_(),x=t.conformation.invariantPosition,C=t.rings,w=C.elementRingIndices,A=C.elementAromaticRingIndices,M={linkCount:d*2,referencePosition:function(R){var O,H,B=f[R],j=p[R];B>j&&(O=[j,B],B=O[0],j=O[1]),h[B+1]-h[B]===1&&(H=[j,B],B=H[0],j=H[1]);for(var Y=w.get(B),G=0,$=h[B],q=h[B+1];$<q;++$){var ee=p[$];if(ee!==j&&ee!==B)if(Y){var fe=w.get(ee);if(!fe)continue;var W=k_(Y,fe);W>G&&(G=W,x(l[ee],S))}else return x(l[ee],S)}return G>0?S:null},position:function(R,O,H){x(l[f[H]],R),x(l[p[H]],O)},style:function(R){var O=m[R],H=g[R];if(fI(H,2)||fI(H,4))return 1;if(O===3)return 3;if(b){var B=f[R],j=p[R],Y=A.get(B),G=A.get(j),$=Y&&G?k_(Y,G):0;if($||fI(H,16))return $===2?6:5}return O===2?2:0},radius:function(R){u.element=l[f[R]];var O=n.size.size(u);u.element=l[p[R]];var H=n.size.size(u);return Math.min(O,H)*y},ignore:Yie(r,t,i)},D=ane(e,M,i,a),k=Be.expand(Be(),(s??t).boundary.sphere,1*y);return D.setBoundingSphere(k),D}var Coe=E(E(E({},uF),XF),{includeParent:I.Boolean(!1)});function Kdt(e){return lF({defaultProps:I.getDefaultValues(Coe),createGeometry:Ydt,createLocationIterator:xp.fromGroup,getLoci:YF,eachLocation:KF,setUpdateState:function(t,r,n,i,a,o,s){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.linkScale!==n.linkScale||r.linkSpacing!==n.linkSpacing||r.dashCount!==n.dashCount||r.ignoreHydrogens!==n.ignoreHydrogens||!no(r.includeTypes,n.includeTypes)||!no(r.excludeTypes,n.excludeTypes)||r.aromaticBonds!==n.aromaticBonds;var u=o.group.units[0],l=s.group.units[0];je.isAtomic(u)&&je.isAtomic(l)&&(Io.areEqual(u.bonds,l.bonds)||(t.createGeometry=!0,t.updateTransform=!0,t.updateColor=!0,t.updateSize=!0))}},e)}var pI=new Vt.ElementBondIterator;function FG(e,t,r,n){for(pI.setElement(t,r,n);pI.hasNext;){var i=pI.move();return i.otherUnit.conformation.position(i.otherUnit.elements[i.otherIndex],e),e}return null}function Qdt(e,t,r,n,i){var a=t.interUnitBonds,o=a.edgeCount,s=a.edges,u=n.sizeFactor,l=n.aromaticBonds;if(!o)return wn.createEmpty(i);var c=_(),d=Ze.create(),f={linkCount:o,referencePosition:function(m){var g=s[m],y,b,S,x;if(g.unitA<g.unitB)y=t.unitMap.get(g.unitA),b=t.unitMap.get(g.unitB),S=g.indexA,x=g.indexB;else if(g.unitA>g.unitB)y=t.unitMap.get(g.unitB),b=t.unitMap.get(g.unitA),S=g.indexB,x=g.indexA;else throw new Error("same units in createInterUnitBondLines");return FG(c,t,y,S)||FG(c,t,b,x)},position:function(m,g,y){var b=s[y],S=t.unitMap.get(b.unitA),x=t.unitMap.get(b.unitB);S.conformation.position(S.elements[b.indexA],m),x.conformation.position(x.elements[b.indexB],g)},style:function(m){var g=s[m].props.order,y=ba.create(s[m].props.flag);return Ur.is(y,2)||Ur.is(y,4)?1:g===3?3:l&&Ur.is(y,16)?5:g===2?2:0},radius:function(m){var g=s[m];d.structure=t,d.unit=t.unitMap.get(g.unitA),d.element=d.unit.elements[g.indexA];var y=r.size.size(d);d.unit=t.unitMap.get(g.unitB),d.element=d.unit.elements[g.indexB];var b=r.size.size(d);return Math.min(y,b)*u},ignore:Kie(t,n)},p=ane(e,f,n,i),v=t.child,h=Be.expand(Be(),(v??t).boundary.sphere,1*n.sizeFactor);return p.setBoundingSphere(h),p}var _oe=E(E(E({},iKe),XF),{includeParent:I.Boolean(!1)});function Zdt(e){return aKe({defaultProps:I.getDefaultValues(_oe),createGeometry:Qdt,createLocationIterator:xp.fromStructure,getLoci:QF,eachLocation:ZF,setUpdateState:function(t,r,n){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.linkScale!==n.linkScale||r.linkSpacing!==n.linkSpacing||r.dashCount!==n.dashCount||r.ignoreHydrogens!==n.ignoreHydrogens||!no(r.includeTypes,n.includeTypes)||!no(r.excludeTypes,n.excludeTypes)}},e)}var woe={"intra-bond":function(e,t){return ii("Intra-unit bond line",e,t,Kdt)},"inter-bond":function(e,t){return Ru("Inter-unit bond line",e,t,Zdt)}},Eoe=E(E(E({},Coe),_oe),{includeParent:I.Boolean(!1),sizeFactor:I.Numeric(1.5,{min:.01,max:10,step:.01}),unitKinds:f2(["atomic"]),visuals:I.MultiSelect(["intra-bond","inter-bond"],I.objectToOptions(woe))});function Jdt(e,t){return I.clone(Eoe)}function eft(e,t){return or.createMulti("Line",e,t,Ui,woe)}var tft={name:"line",label:"Line",description:"Displays bonds as lines.",factory:eft,getParams:Jdt,defaultValues:I.getDefaultValues(Eoe),defaultColorTheme:{name:"element-symbol"},defaultSizeTheme:{name:"uniform"},isApplicable:function(e){return e.elementCount>0},getData:function(e,t){return t.includeParent?e.asParent():e},mustRecreate:function(e,t){return e.includeParent!==t.includeParent}};function rft(e,t,r,n,i){return ce(this,void 0,void 0,function(){var a,o,s,u,l,c,d,f,p,v,h,m,g;return de(this,function(y){switch(y.label){case 0:if(a=e.runtime,o=e.webgl,!o||!o.extensions.blendMinMax)throw new Error("GaussianDensityVolume requires `webgl` and `blendMinMax` extension");return s=i?i.gridTexture.ref.value:void 0,[4,Ect(t,n,o,s).runInContext(a)];case 1:return u=y.sent(),l=u.transform,c=u.texture,d=u.bbox,f=u.gridDim,p={min:0,max:1,mean:.04,sigma:.01},v=ue.mul(ue(),l,ue.fromScaling(ue(),f)),h=ue.getScaling(_(),l),m=io.create(d,f,l,v,h,c,p,!0,i),g=Be.expand(Be(),t.boundary.sphere,n.radiusOffset+JE(t)),m.setBoundingSphere(g),[2,m]}})})}var Aoe=E(E(E({},uKe),w2),{ignoreHydrogens:I.Boolean(!1)});function nft(e){return lKe({defaultProps:I.getDefaultValues(Aoe),createGeometry:rft,createLocationIterator:qa.fromStructure,getLoci:cA,eachLocation:lA,setUpdateState:function(t,r,n){r.resolution!==n.resolution&&(t.createGeometry=!0),r.radiusOffset!==n.radiusOffset&&(t.createGeometry=!0),r.smoothness!==n.smoothness&&(t.createGeometry=!0),r.ignoreHydrogens!==n.ignoreHydrogens&&(t.createGeometry=!0),r.traceOnly!==n.traceOnly&&(t.createGeometry=!0),r.includeParent!==n.includeParent&&(t.createGeometry=!0)},dispose:function(t){t.gridTexture.ref.value.destroy()}},e)}function ift(e,t,r,n,i,a){return ce(this,void 0,void 0,function(){var o,s,u,l,c,d,f,p,v,h,m,g,y;return de(this,function(b){switch(b.label){case 0:if(o=e.runtime,s=e.webgl,!s)throw new Error("GaussianDensityVolume requires `webgl`");return u=a?a.gridTexture.ref.value:void 0,[4,Cct(r,t,i,s,u).runInContext(o)];case 1:return l=b.sent(),c=l.transform,d=l.texture,f=l.bbox,p=l.gridDim,v={min:0,max:1,mean:.04,sigma:.01},h=ue.mul(ue(),c,ue.fromScaling(ue(),p)),m=ue.getScaling(_(),c),g=io.create(f,p,c,h,m,d,v,!0,a),y=Be.expand(Be(),t.boundary.sphere,i.radiusOffset+M0(t)),g.setBoundingSphere(y),[2,g]}})})}var aft=E(E(E({},vKe),w2),{ignoreHydrogens:I.Boolean(!1)});function oft(e){return mKe({defaultProps:I.getDefaultValues(aft),createGeometry:ift,createLocationIterator:qa.fromGroup,getLoci:Wl,eachLocation:$l,setUpdateState:function(t,r,n){r.resolution!==n.resolution&&(t.createGeometry=!0),r.radiusOffset!==n.radiusOffset&&(t.createGeometry=!0),r.smoothness!==n.smoothness&&(t.createGeometry=!0),r.ignoreHydrogens!==n.ignoreHydrogens&&(t.createGeometry=!0),r.traceOnly!==n.traceOnly&&(t.createGeometry=!0),r.includeParent!==n.includeParent&&(t.createGeometry=!0)},dispose:function(t){t.gridTexture.ref.value.destroy()}},e)}var Poe={"gaussian-volume":function(e,t){return Ru("Gaussian volume",e,t,nft)},"units-gaussian-volume":function(e,t){return ii("Units-Gaussian volume",e,t,oft)}},Toe=E(E({},Aoe),{visuals:I.MultiSelect(["gaussian-volume"],I.objectToOptions(Poe))});function sft(e,t){var r=I.clone(Toe);return r.renderMode=io.createRenderModeParam({min:0,max:1,mean:.04,sigma:.01}),r.jumpLength=I.Numeric(4,{min:0,max:20,step:.1}),r}function uft(e,t){return or.createMulti("Gaussian Volume",e,t,Ui,Poe)}var lft={name:"gaussian-volume",label:"Gaussian Volume",description:"Displays a gaussian molecular density using direct volume rendering.",factory:uft,getParams:sft,defaultValues:I.getDefaultValues(Toe),defaultColorTheme:{name:"chain-id"},defaultSizeTheme:{name:"uniform"},isApplicable:function(e){return e.elementCount>0}},cft=_.scale,dft=_.add,fft=_.sub,u6=E(E(E({},Ea),qre),{sizeFactor:I.Numeric(.3,{min:0,max:10,step:.01}),radialSegments:I.Numeric(16,{min:2,max:56,step:2},Et.CustomQualityParamInfo),tryUseImpostor:I.Boolean(!0)});function pft(e,t,r,n){return r.tryUseImpostor&&n&&n.extensions.fragDepth?vft(e):gft(e)}function hft(e,t,r,n,i,a){var o=t.polymerElements.length;if(!o)return Jo.createEmpty(a);var s=o*2,u=Sw.create(s,s/4,a),l=t.conformation.invariantPosition,c=_(),d=_(),f=_(),p=function(m,g,y,b,S){l(m,c),l(g,d);var x=Gl(S),C=x?pA:fA;dft(f,c,cft(f,fft(f,d,c),C)),u.add(c[0],c[1],c[2],f[0],f[1],f[2],1,!1,!1,y),u.add(f[0],f[1],f[2],d[0],d[1],d[2],1,!1,!1,b)};dae(t,p);var v=u.getCylinders(),h=Be.expand(Be(),t.boundary.sphere,1*i.sizeFactor);return v.setBoundingSphere(h),v}function vft(e){return $re({defaultProps:I.getDefaultValues(u6),createGeometry:hft,createLocationIterator:fd.fromGroup,getLoci:Xv,eachLocation:Yv,setUpdateState:function(t,r,n){},mustRecreate:function(t,r,n){return!r.tryUseImpostor||!n}},e)}function mft(e,t,r,n,i,a){var o=t.polymerElements.length;if(!o)return Ft.createEmpty(a);var s=i.radialSegments,u=i.sizeFactor,l=s*2*o*2,c=wt.createState(l,l/10,a),d=t.conformation.invariantPosition,f=_(),p=_(),v={radiusTop:1,radiusBottom:1,radialSegments:s},h=Ze.create(r,t),m=Ze.create(r,t),g=function(S,x,C,w,A){h.element=S,m.element=x,d(h.element,f),d(m.element,p);var M=Gl(A),D=M?pA:fA;v.radiusTop=v.radiusBottom=n.size.size(h)*u,c.currentGroup=C,Ua(c,f,p,D,v),v.radiusTop=v.radiusBottom=n.size.size(m)*u,c.currentGroup=w,Ua(c,p,f,1-D,v)};dae(t,g);var y=wt.getMesh(c),b=Be.expand(Be(),t.boundary.sphere,1*i.sizeFactor);return y.setBoundingSphere(b),y}function gft(e){return uo({defaultProps:I.getDefaultValues(u6),createGeometry:mft,createLocationIterator:fd.fromGroup,getLoci:Xv,eachLocation:Yv,setUpdateState:function(t,r,n){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.radialSegments!==n.radialSegments},mustRecreate:function(t,r,n){return r.tryUseImpostor&&!!n}},e)}var l6=E(E(E({},Ea),Hre),{sizeFactor:I.Numeric(.3,{min:0,max:10,step:.01}),detail:I.Numeric(0,{min:0,max:3,step:1},Et.CustomQualityParamInfo),tryUseImpostor:I.Boolean(!0)});function yft(e,t,r,n){return r.tryUseImpostor&&n&&n.extensions.fragDepth?xft(e):Cft(e)}function bft(e,t,r,n,i,a){var o=t.polymerElements.length;if(!o)return gp.createEmpty(a);var s=Uw.create(o,o/2,a),u=t.conformation.invariantPosition,l=_(),c=function(p,v){u(p,l),s.add(l[0],l[1],l[2],v)};fae(t,c);var d=s.getSpheres(),f=Be.expand(Be(),t.boundary.sphere,1*i.sizeFactor);return d.setBoundingSphere(f),d}function xft(e){return Gre({defaultProps:I.getDefaultValues(l6),createGeometry:bft,createLocationIterator:fd.fromGroup,getLoci:Xv,eachLocation:Yv,setUpdateState:function(t,r,n){},mustRecreate:function(t,r,n){return!r.tryUseImpostor||!n}},e)}function Sft(e,t,r,n,i,a){var o=t.polymerElements.length;if(!o)return Ft.createEmpty(a);var s=i.detail,u=i.sizeFactor,l=o*OE(s),c=wt.createState(l,l/2,a),d=t.conformation.invariantPosition,f=_(),p=Ze.create(r,t),v=function(g,y){p.element=g,d(p.element,f),c.currentGroup=y,Ni(c,f,n.size.size(p)*u,s)};fae(t,v);var h=wt.getMesh(c),m=Be.expand(Be(),t.boundary.sphere,1*i.sizeFactor);return h.setBoundingSphere(m),h}function Cft(e){return uo({defaultProps:I.getDefaultValues(l6),createGeometry:Sft,createLocationIterator:fd.fromGroup,getLoci:Xv,eachLocation:Yv,setUpdateState:function(t,r,n){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.detail!==n.detail},mustRecreate:function(t,r,n){return r.tryUseImpostor&&!!n}},e)}var Ioe={"polymer-backbone-cylinder":function(e,t){return ii("Polymer backbone cylinder",e,t,pft)},"polymer-backbone-sphere":function(e,t){return ii("Polymer backbone sphere",e,t,yft)},"polymer-gap":function(e,t){return ii("Polymer gap cylinder",e,t,n6)}},Moe=E(E(E(E({},l6),u6),hA),{sizeAspectRatio:I.Numeric(1,{min:.1,max:3,step:.1}),visuals:I.MultiSelect(["polymer-backbone-cylinder","polymer-backbone-sphere","polymer-gap"],I.objectToOptions(Ioe))});function _ft(e,t){var r=I.clone(Moe),n=!1;return t.units.forEach(function(i){!n&&i.gapElements.length&&(n=!0)}),r.visuals.defaultValue=["polymer-backbone-cylinder","polymer-backbone-sphere"],n&&r.visuals.defaultValue.push("polymer-gap"),r}function wft(e,t){return or.createMulti("Backbone",e,t,Ui,Ioe)}var Eft={name:"backbone",label:"Backbone",description:"Displays polymer backbone with cylinders and spheres.",factory:wft,getParams:_ft,defaultValues:I.getDefaultValues(Moe),defaultColorTheme:{name:"chain-id"},defaultSizeTheme:{name:"uniform"},isApplicable:function(e){return e.polymerResidueCount>0}},LR=function(e){Fe(t,e);function t(){var r=e.call(this)||this;return ju(t.BuiltIn,function(n,i){if(n.name!==i)throw new Error("Fix BuiltInStructureRepresentations to have matching names. "+n.name+" "+i);r.add(n)}),r}return t}(lre);(function(e){e.BuiltIn={cartoon:sct,backbone:Eft,"ball-and-stick":hut,carbohydrate:Qut,ellipsoid:fct,"gaussian-surface":rdt,"gaussian-volume":lft,label:cdt,line:tft,"molecular-surface":Cdt,orientation:Ddt,point:Udt,putty:Gdt,spacefill:Xdt}})(LR||(LR={}));var Aft=function(){function e(t){var r=this;this.plugin=t,this.currentFrame=void 0,this._isAnimating=!1,this.frame=function(){r.tick(kn()),r._isAnimating&&(r.currentFrame=requestAnimationFrame(r.frame))}}return Object.defineProperty(e.prototype,"isAnimating",{get:function(){return this._isAnimating},enumerable:!1,configurable:!0}),e.prototype.tick=function(t,r){var n;return ce(this,void 0,void 0,function(){return de(this,function(i){switch(i.label){case 0:return[4,this.plugin.managers.animation.tick(t,r==null?void 0:r.isSynchronous)];case 1:return i.sent(),(n=this.plugin.canvas3d)===null||n===void 0||n.tick(t,r),[2]}})})},e.prototype.resetTime=function(t){var r;t===void 0&&(t=kn()),(r=this.plugin.canvas3d)===null||r===void 0||r.resetTime(t)},e.prototype.start=function(t){var r;(r=this.plugin.canvas3d)===null||r===void 0||r.resume(),this._isAnimating=!0,this.resetTime(),t!=null&&t.immediate?this.frame():this.currentFrame=requestAnimationFrame(this.frame)},e.prototype.stop=function(t){var r;this._isAnimating=!1,this.currentFrame!==void 0&&(cancelAnimationFrame(this.currentFrame),this.currentFrame=void 0),t!=null&&t.noDraw&&((r=this.plugin.canvas3d)===null||r===void 0||r.pause(t==null?void 0:t.noDraw))},e}(),Pft=function(){function e(t){var r=this;this.plugin=t,this.ev=Jc.create(),this.events={updated:this.ev(),removed:this.ev()},this.root=new Map,this.tracked=new Map,t.state.data.events.object.created.subscribe(function(n){r.addMapping(n.state,n.ref,n.obj)}),t.state.data.events.object.removed.subscribe(function(n){r.removeMapping(n.ref)&&r.events.removed.next({ref:n.ref,obj:n.obj})}),t.state.data.events.object.updated.subscribe(function(n){r.updateMapping(n.state,n.ref,n.oldObj,n.obj)&&r.events.updated.next({ref:n.ref,oldObj:n.oldObj,obj:n.obj})})}return e.prototype.getDecorator=function(t){var r=this.plugin.state.data.tree,n=r.children.get(t);if(n.size!==1)return t;var i=n.first();return r.transforms.get(i).transformer.definition.isDecorator?this.getDecorator(i):t},e.prototype.get=function(t,r){r===void 0&&(r=!1);var n=this.root.get(t);if(n)return r?this.plugin.state.data.cells.get(n.ref):this.plugin.state.data.cells.get(this.getDecorator(n.ref))},e.prototype.addMapping=function(t,r,n){if(!ge.Molecule.Structure.is(n))return!1;if(this.tracked.set(r,n.data),this.root.has(n.data)){var i=this.root.get(n.data);i.count++}else{var a=t.select(ir.Generators.byRef(r).rootOfType([ge.Molecule.Structure]))[0];a?this.root.set(n.data,{ref:a.transform.ref,count:1}):this.root.set(n.data,{ref:r,count:1})}return!0},e.prototype.removeMapping=function(t){if(!this.tracked.has(t))return!1;var r=this.tracked.get(t);this.tracked.delete(t);var n=this.root.get(r);return n.count>1?n.count--:this.root.delete(r),!0},e.prototype.updateMapping=function(t,r,n,i){return ge.Molecule.Structure.is(i)?(this.removeMapping(r),this.addMapping(t,r,i),!0):!1},e.prototype.dispose=function(){this.ev.dispose()},e}(),FR=function(){function e(){this.ev=Jc.create(),this.id=0,this.runningTasks=new Set,this.abortRequests=new Map,this.options=new Map,this.currentContext=[],this.events={progress:this.ev(),finished:this.ev()}}return e.prototype.tryGetAbortTaskId=function(t){if(this.abortRequests.has(t.progress.taskId))return t.progress.taskId;for(var r=0,n=t.children;r<n.length;r++){var i=n[r],a=this.tryGetAbortTaskId(i);if(a!==void 0)return a}},e.prototype.track=function(t,r){var n=this;return function(i){var a;if(i.canAbort&&i.requestAbort){var o=n.tryGetAbortTaskId(i.root);o!==void 0&&i.requestAbort(n.abortRequests.get(o))}var s=kn()-i.root.progress.startedTime;n.events.progress.next({id:t,useOverlay:(a=n.options.get(r))===null||a===void 0?void 0:a.useOverlay,level:s<250?"none":"background",progress:i})}},e.prototype.run=function(t,r){return ce(this,void 0,void 0,function(){var n,i,a;return de(this,function(o){switch(o.label){case 0:n=this.id++,r!=null&&r.createNewContext||this.currentContext.length===0?i={ctx:C5e(t,this.track(n,t.id),100),refCount:1}:(i=this.currentContext[this.currentContext.length-1],i.refCount++),o.label=1;case 1:return o.trys.push([1,,3,4]),this.options.set(t.id,{useOverlay:!!(r!=null&&r.useOverlay)}),this.runningTasks.add(t.id),[4,pZ(i.ctx,t)];case 2:return a=o.sent(),[2,a];case 3:return this.options.delete(t.id),this.runningTasks.delete(t.id),this.events.finished.next({id:n}),this.abortRequests.delete(t.id),i.refCount--,i.refCount===0&&mb(this.currentContext,i),[7];case 4:return[2]}})})},e.prototype.requestAbortAll=function(t){var r=this;this.runningTasks.forEach(function(n){return r.abortRequests.set(n,t)})},e.prototype.requestAbort=function(t,r){var n=typeof t=="number"?t:t.root.progress.taskId;this.abortRequests.set(n,r)},e.prototype.dispose=function(){this.ev.dispose()},e}();(function(e){function t(n){return new Promise(function(i){return setTimeout(i,n)})}function r(n){var i=this;return $e.create("Test",function(a){return ce(i,void 0,void 0,function(){var o;return de(this,function(s){switch(s.label){case 0:o=0,s.label=1;case 1:return o<n?[4,t(100+Math.random()*200)]:[3,5];case 2:return s.sent(),a.shouldUpdate?[4,a.update({message:"Step "+o,current:o,max:n,isIndeterminate:!1})]:[3,4];case 3:s.sent(),s.label=4;case 4:return o++,[3,1];case 5:return[2]}})})})}e.testTask=r})(FR||(FR={}));var Tft=function(e){Fe(t,e);function t(r){var n=e.call(this,{entries:si.OrderedMap()})||this;return n.events={changed:n.ev()},n.serialNumber=0,n.serialId=0,_t.Toast.Show.subscribe(r,function(i){return n.show(i)}),_t.Toast.Hide.subscribe(r,function(i){return n.hide(n.findByKey(i.key))}),n}return t.prototype.findByKey=function(r){return this.state.entries.find(function(n){return!!n&&n.key===r})},t.prototype.show=function(r){var n=this,i=this.state.entries,a=void 0,o=++this.serialId,s;r.key&&(a=this.findByKey(r.key))?(a.timeout!==void 0&&clearTimeout(a.timeout),s=a.serialNumber,i=i.remove(a.id)):s=++this.serialNumber,a={id:o,serialNumber:s,key:r.key,title:r.title,message:r.message,timeout:this.timeout(o,r.timeoutMs),hide:function(){return n.hideId(o)}},this.updateState({entries:i.set(o,a)})&&this.events.changed.next()},t.prototype.timeout=function(r,n){var i=this;if(n!==void 0)return n<0&&(n=500),setTimeout(function(){var a=i.state.entries.get(r);a.timeout=void 0,i.hide(a)},n)},t.prototype.hideId=function(r){this.hide(this.state.entries.get(r))},t.prototype.hide=function(r){r&&(r.timeout!==void 0&&clearTimeout(r.timeout),r.hide=void 0,this.updateState({entries:this.state.entries.delete(r.id)})&&this.events.changed.next())},t}(kd),Ift=function(e){Fe(t,e);function t(r){var n=e.call(this)||this;return n.plugin=r,n._params=void 0,n.behaviors={values:n.ev.behavior({transparent:n.params.transparent.defaultValue,axes:{name:"off",params:{}},resolution:n.params.resolution.defaultValue}),cropParams:n.ev.behavior({auto:!0,relativePadding:.1}),relativeCrop:n.ev.behavior({x:0,y:0,width:1,height:1})},n.events={previewed:n.ev()},n.canvas=function(){var i=document.createElement("canvas");return i}(),n.previewCanvas=function(){var i=document.createElement("canvas");return i}(),n.previewData={image:{data:new Uint8ClampedArray(1),width:1,height:0},background:at(0),transparent:!1},n}return t.prototype.createParams=function(){var r=Math.min(this.plugin.canvas3d?this.plugin.canvas3d.webgl.maxRenderbufferSize:4096,4096);return{resolution:I.MappedStatic("viewport",{viewport:I.Group({}),hd:I.Group({}),"full-hd":I.Group({}),"ultra-hd":I.Group({}),custom:I.Group({width:I.Numeric(1920,{min:128,max:r,step:1}),height:I.Numeric(1080,{min:128,max:r,step:1})},{isFlat:!0})},{options:[["viewport","Viewport"],["hd","HD (1280 x 720)"],["full-hd","Full HD (1920 x 1080)"],["ultra-hd","Ultra HD (3840 x 2160)"],["custom","Custom"]]}),transparent:I.Boolean(!1),axes:tA.axes}},Object.defineProperty(t.prototype,"params",{get:function(){return this._params?this._params:this._params=this.createParams()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"values",{get:function(){return this.behaviors.values.value},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cropParams",{get:function(){return this.behaviors.cropParams.value},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"relativeCrop",{get:function(){return this.behaviors.relativeCrop.value},enumerable:!1,configurable:!0}),t.prototype.getCanvasSize=function(){var r,n;return{width:((r=this.plugin.canvas3d)===null||r===void 0?void 0:r.webgl.gl.drawingBufferWidth)||0,height:((n=this.plugin.canvas3d)===null||n===void 0?void 0:n.webgl.gl.drawingBufferHeight)||0}},t.prototype.getSize=function(){var r=this.values;switch(r.resolution.name){case"viewport":return this.getCanvasSize();case"hd":return{width:1280,height:720};case"full-hd":return{width:1920,height:1080};case"ultra-hd":return{width:3840,height:2160};default:return{width:r.resolution.params.width,height:r.resolution.params.height}}},t.prototype.createPass=function(r){var n=this.plugin.canvas3d,i=n.webgl.extensions,a=i.colorBufferFloat,o=i.textureFloat,s=this.plugin.canvas3d.props.postprocessing.occlusion;return this.plugin.canvas3d.getImagePass({transparentBackground:this.values.transparent,cameraHelper:{axes:this.values.axes},multiSample:{mode:r?"on":"off",sampleLevel:a&&o?4:2},postprocessing:E(E({},n.props.postprocessing),{occlusion:s.name==="on"?{name:"on",params:E(E({},s.params),{samples:128})}:s})})},Object.defineProperty(t.prototype,"previewPass",{get:function(){return this._previewPass||(this._previewPass=this.createPass(!1))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"imagePass",{get:function(){if(this._imagePass){var r=this.plugin.canvas3d.props.postprocessing.occlusion;return this._imagePass.setProps({cameraHelper:{axes:this.values.axes},transparentBackground:this.values.transparent,postprocessing:E(E({},this.plugin.canvas3d.props.postprocessing),{occlusion:r.name==="on"?{name:"on",params:E(E({},r.params),{samples:128})}:r})}),this._imagePass}return this._imagePass=this.createPass(!0)},enumerable:!1,configurable:!0}),t.prototype.getFilename=function(r){r===void 0&&(r=".png");var n=this.plugin.state.data.select(ir.Generators.rootsOfType(ge.Molecule.Model)).map(function(o){return o.obj.data}),i=new Set;n.forEach(function(o){return i.add(o.entryId.toUpperCase())});var a=hi.toArray(i).join("-");return""+(a||"molstar-image")+r},t.prototype.resetCrop=function(){this.behaviors.relativeCrop.next({x:0,y:0,width:1,height:1})},t.prototype.toggleAutocrop=function(){this.cropParams.auto?(this.behaviors.cropParams.next(E(E({},this.cropParams),{auto:!1})),this.resetCrop()):this.behaviors.cropParams.next(E(E({},this.cropParams),{auto:!0}))},Object.defineProperty(t.prototype,"isFullFrame",{get:function(){var r=this.relativeCrop;return yn(r.x,0,1e-5)&&yn(r.y,0,1e-5)&&yn(r.width,1,1e-5)&&yn(r.height,1,1e-5)},enumerable:!1,configurable:!0}),t.prototype.autocrop=function(r){r===void 0&&(r=this.cropParams.relativePadding);for(var n=this.previewData.image,i=n.data,a=n.width,o=n.height,s=this.previewData.transparent,u=s?this.previewData.background:4278190080|this.previewData.background,l=a,c=0,d=o,f=0,p=0;p<o;p++)for(var v=p*a,h=0;h<a;h++){var m=4*(v+h);if(s){if(i[m+3]===0)continue}else{var g=i[m]<<16|i[m+1]<<8|i[m+2]|i[m+3]<<24;if(g===u)continue}h<l&&(l=h),h>c&&(c=h),p<d&&(d=p),p>f&&(f=p)}if(l>c){var y=l;l=c,c=y}if(d>f){var y=d;d=f,f=y}var b=c-l+1,S=f-d+1;l-=r*b,c+=r*b,d-=r*S,f+=r*S;var x={x:Math.max(0,l/a),y:Math.max(0,d/o),width:Math.min(1,(c-l+1)/a),height:Math.min(1,(f-d+1)/o)};this.behaviors.relativeCrop.next(x)},t.prototype.getPreview=function(r){r===void 0&&(r=320);var n=this.getSize(),i=n.width,a=n.height;if(!(i<=0||a<=0)){var o=i/a,s=0,u=0;o>1?(s=r,u=Math.round(r/o)):(u=r,s=Math.round(r*o));var l=this.plugin.canvas3d.props;this.previewPass.setProps({cameraHelper:{axes:this.values.axes},transparentBackground:this.values.transparent,postprocessing:l.postprocessing});var c=this.previewPass.getImageData(s,u),d=this.previewCanvas;d.width=c.width,d.height=c.height,this.previewData.image=c,this.previewData.background=l.renderer.backgroundColor,this.previewData.transparent=this.values.transparent;var f=d.getContext("2d");if(!f)throw new Error("Could not create canvas 2d context");return f.putImageData(c,0,0),this.cropParams.auto&&this.autocrop(),this.events.previewed.next(),{canvas:d,width:s,height:u}}},t.prototype.getSizeAndViewport=function(){var r=this.getSize(),n=r.width,i=r.height,a=this.relativeCrop,o={x:Math.floor(a.x*n),y:Math.floor(a.y*i),width:Math.ceil(a.width*n),height:Math.ceil(a.height*i)};return o.width+o.x>n&&(o.width=n-o.x),o.height+o.y>i&&(o.height=i-o.y),{width:n,height:i,viewport:o}},t.prototype.draw=function(r){return ce(this,void 0,void 0,function(){var n,i,a,o,s,u,l;return de(this,function(c){switch(c.label){case 0:return n=this.getSizeAndViewport(),i=n.width,a=n.height,o=n.viewport,i<=0||a<=0?[2]:[4,r.update("Rendering image...")];case 1:return c.sent(),s=this.imagePass.getImageData(i,a,o),[4,r.update("Encoding image...")];case 2:if(c.sent(),u=this.canvas,u.width=s.width,u.height=s.height,l=u.getContext("2d"),!l)throw new Error("Could not create canvas 2d context");return l.putImageData(s,0,0),[2]}})})},t.prototype.copyToClipboardTask=function(){var r=this,n=navigator.clipboard;if(!(n!=null&&n.write)){this.plugin.log.error("clipboard.write not supported!");return}return $e.create("Copy Image",function(i){return ce(r,void 0,void 0,function(){var a,o;return de(this,function(s){switch(s.label){case 0:return[4,this.draw(i)];case 1:return s.sent(),[4,i.update("Converting image...")];case 2:return s.sent(),[4,eG(this.canvas,"png")];case 3:return a=s.sent(),o=new ClipboardItem({"image/png":a}),[4,n.write([o])];case 4:return s.sent(),this.plugin.log.message("Image copied to clipboard."),[2]}})})})},t.prototype.getImageDataUri=function(){var r=this;return this.plugin.runTask($e.create("Generate Image",function(n){return ce(r,void 0,void 0,function(){return de(this,function(i){switch(i.label){case 0:return[4,this.draw(n)];case 1:return i.sent(),[4,n.update("Converting image...")];case 2:return i.sent(),[2,this.canvas.toDataURL("png")]}})})}))},t.prototype.copyToClipboard=function(){var r=this.copyToClipboardTask();if(r)return this.plugin.runTask(r)},t.prototype.downloadTask=function(r){var n=this;return $e.create("Download Image",function(i){return ce(n,void 0,void 0,function(){var a;return de(this,function(o){switch(o.label){case 0:return[4,this.draw(i)];case 1:return o.sent(),[4,i.update("Downloading image...")];case 2:return o.sent(),[4,eG(this.canvas,"png")];case 3:return a=o.sent(),pne(a,r??this.getFilename()),[2]}})})})},t.prototype.download=function(r){this.plugin.runTask(this.downloadTask(r))},t}(v2),Mft=function(){function e(t){var r=this;this.spec=t,this.runTask=function(n,i){return r.managers.task.run(n,i)},this.resolveTask=function(n){if(n)return $e.is(n)?r.runTask(n):n},this.subs=[],this.disposed=!1,this.ev=Jc.create(),this.config=new GYe(this.spec.config),this.state=new Fw(this),this.commands=new KZe,this.canvas3dInit=this.ev.behavior(!1),this.behaviors={state:{isAnimating:this.ev.behavior(!1),isUpdating:this.ev.behavior(!1),isBusy:this.ev.behavior(!1)},interaction:{hover:this.ev.behavior({current:or.Loci.Empty,modifiers:ku.None,buttons:0,button:0}),click:this.ev.behavior({current:or.Loci.Empty,modifiers:ku.None,buttons:0,button:0}),drag:this.ev.behavior({current:or.Loci.Empty,modifiers:ku.None,buttons:0,button:0,pageStart:He(),pageEnd:He()}),selectionMode:this.ev.behavior(!1)},labels:{highlight:this.ev.behavior({labels:[]})},layout:{leftPanelTabName:this.ev.behavior("root")},canvas3d:{initialized:this.canvas3dInit.pipe(gE(function(n){return!!n}),Sot(1))}},this.layout=new Qst(this),this.animationLoop=new Aft(this),this.representation={structure:{registry:new LR,themes:{colorThemeRegistry:id.createRegistry(),sizeThemeRegistry:Ki.createRegistry()}},volume:{registry:new Ow,themes:{colorThemeRegistry:id.createRegistry(),sizeThemeRegistry:Ki.createRegistry()}}},this.query={structure:{registry:new VYe}},this.dataFormats=new Nst,this.builders={data:new pst(this),structure:void 0},this.helpers={substructureParent:new Pft(this),viewportScreenshot:void 0},this.managers={structure:{hierarchy:new Lb(this),component:new _v(this),measurement:new Tnt(this),selection:new qst(this),focus:new Hst(this)},volume:{hierarchy:new Iw(this)},interactivity:void 0,camera:new jst(this),animation:new Bst(this),snapshot:new _w(this),lociLabels:void 0,toast:new Tft(this),asset:new lDe,task:new FR},this.events={log:this.ev(),task:this.managers.task.events,canvas3d:{settingsUpdated:this.ev()}},this.customModelProperties=new Nw.Registry,this.customStructureProperties=new Nw.Registry,this.customStructureControls=new Map,this.genericRepresentationControls=new Map,this.customState=Object.create(null),this.log={entries:si.List(),entry:function(n){return r.events.log.next(n)},error:function(n){return r.events.log.next(_l.error(n))},message:function(n){return r.events.log.next(_l.message(n))},info:function(n){return r.events.log.next(_l.info(n))},warn:function(n){return r.events.log.next(_l.warning(n))}},this.fetch=z5,gRe(!1)}return e.prototype.build=function(){return this.state.data.build()},e.prototype.initViewer=function(t,r,n){var i=this,a,o,s,u,l;try{if(this.layout.setRoot(r),this.spec.layout&&this.spec.layout.initial&&this.layout.setProps(this.spec.layout.initial),n)this.canvas3dContext=n;else{var c=!((a=this.config.get(Yr.General.DisableAntialiasing))!==null&&a!==void 0&&a),d=!((o=this.config.get(Yr.General.DisablePreserveDrawingBuffer))!==null&&o!==void 0&&o),f=this.config.get(Yr.General.PixelScale)||1,p=this.config.get(Yr.General.PickScale)||.25,v=this.config.get(Yr.General.EnableWboit)||!1;this.canvas3dContext=mR.fromCanvas(t,{antialias:c,preserveDrawingBuffer:d,pixelScale:f,pickScale:p,enableWboit:v})}this.canvas3d=gR.create(this.canvas3dContext),this.canvas3dInit.next(!0);var h=this.spec.canvas3d,m=at(16579577);return h?(((u=h.renderer)===null||u===void 0?void 0:u.backgroundColor)===void 0&&(h=vL(h,function(g){g.renderer?g.renderer.backgroundColor=m:g.renderer={backgroundColor:m}})),(l=this.canvas3d)===null||l===void 0||l.setProps(h)):(s=this.canvas3d)===null||s===void 0||s.setProps({renderer:{backgroundColor:m}}),this.animationLoop.start(),this.helpers.viewportScreenshot=new Ift(this),this.subs.push(this.canvas3d.interaction.click.subscribe(function(g){return i.behaviors.interaction.click.next(g)})),this.subs.push(this.canvas3d.interaction.drag.subscribe(function(g){return i.behaviors.interaction.drag.next(g)})),this.subs.push(this.canvas3d.interaction.hover.subscribe(function(g){return i.behaviors.interaction.hover.next(g)})),this.subs.push(this.canvas3d.input.resize.subscribe(function(){return i.handleResize()})),this.subs.push(this.layout.events.updated.subscribe(function(){return requestAnimationFrame(function(){return i.handleResize()})})),this.handleResize(),!0}catch(g){return this.log.error(""+g),console.error(g),!1}},e.prototype.handleResize=function(){var t,r,n=(t=this.canvas3dContext)===null||t===void 0?void 0:t.canvas,i=this.layout.root;if(i&&n){var a=this.config.get(Yr.General.PixelScale)||1;lst(n,i,a),(r=this.canvas3d)===null||r===void 0||r.requestResize()}},Object.defineProperty(e.prototype,"isBusy",{get:function(){return this.behaviors.state.isAnimating.value||this.behaviors.state.isUpdating.value},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"selectionMode",{get:function(){return this.behaviors.interaction.selectionMode.value},set:function(t){this.behaviors.interaction.selectionMode.next(t)},enumerable:!1,configurable:!0}),e.prototype.dataTransaction=function(t,r){return this.runTask(this.state.data.transaction(t,r))},e.prototype.clear=function(t){var r;return t===void 0&&(t=!1),t&&((r=this.canvas3d)===null||r===void 0||r.setProps(mF)),_t.State.RemoveObject(this,{state:this.state.data,ref:cr.RootRef})},e.prototype.dispose=function(t){var r,n;if(!this.disposed){for(var i=0,a=this.subs;i<a.length;i++){var o=a[i];o.unsubscribe()}this.subs=[],this.commands.dispose(),(r=this.canvas3d)===null||r===void 0||r.dispose(),(n=this.canvas3dContext)===null||n===void 0||n.dispose(t),this.ev.dispose(),this.state.dispose(),this.managers.task.dispose(),this.helpers.substructureParent.dispose(),ju(this.managers,function(s){var u,l;return(l=(u=s)===null||u===void 0?void 0:u.dispose)===null||l===void 0?void 0:l.call(u)}),ju(this.managers.structure,function(s){var u,l;return(l=(u=s)===null||u===void 0?void 0:u.dispose)===null||l===void 0?void 0:l.call(u)}),this.disposed=!0}},e.prototype.initBehaviorEvents=function(){var t=this;this.subs.push(gc(this.state.data.behaviors.isUpdating,this.state.behaviors.behaviors.isUpdating).subscribe(function(s){t.behaviors.state.isUpdating.value!==s&&t.behaviors.state.isUpdating.next(s)}));var r=this.config.get(Yr.General.IsBusyTimeoutMs)||750,n=this.behaviors.state.isBusy,i=void 0,a=function(){n.value||n.next(!0)},o=function(){i!==void 0&&clearTimeout(i),i=void 0};this.subs.push(gc(this.behaviors.state.isUpdating,this.behaviors.state.isAnimating).subscribe(function(s){var u=t.behaviors.state.isUpdating.value,l=t.behaviors.state.isAnimating.value;u||l?n.value||(o(),i=setTimeout(a,r)):(o(),n.next(!1))})),this.subs.push(this.behaviors.interaction.selectionMode.subscribe(function(s){var u;s||(u=t.managers.interactivity)===null||u===void 0||u.lociSelects.deselectAll()}))},e.prototype.initBuiltInBehavior=function(){var t=this;Yx.State.registerDefault(this),Yx.Representation.registerDefault(this),Yx.Camera.registerDefault(this),Yx.Misc.registerDefault(this),this.subs.push(gc(this.state.data.events.log,this.state.behaviors.events.log).subscribe(function(r){return t.events.log.next(r)}))},e.prototype.initBehaviors=function(){return ce(this,void 0,void 0,function(){var t,r,n,l,i,a,u,l,o,s,u,l;return de(this,function(c){switch(c.label){case 0:for(t=this.state.behaviors.build(),r=0,n=Object.keys(Or.Categories);r<n.length;r++)l=n[r],t.toRoot().apply(Or.CreateCategory,{label:Or.Categories[l]},{ref:l,state:{isLocked:!0}});for(i=0,a=this.spec.behaviors;i<a.length;i++)u=a[i],l=Or.getCategoryId(u.transformer),l==="custom-props"&&t.to(Or.getCategoryId(u.transformer)).apply(u.transformer,u.defaultParams,{ref:u.transformer.id});return[4,this.runTask(this.state.behaviors.updateTree(t,{doNotUpdateCurrent:!0,doNotLogTiming:!0}))];case 1:for(c.sent(),t=this.state.behaviors.build(),o=0,s=this.spec.behaviors;o<s.length;o++)u=s[o],l=Or.getCategoryId(u.transformer),l!=="custom-props"&&t.to(Or.getCategoryId(u.transformer)).apply(u.transformer,u.defaultParams,{ref:u.transformer.id});return[4,this.runTask(this.state.behaviors.updateTree(t,{doNotUpdateCurrent:!0,doNotLogTiming:!0}))];case 2:return c.sent(),[2]}})})},e.prototype.initCustomFormats=function(){if(this.spec.customFormats)for(var t=0,r=this.spec.customFormats;t<r.length;t++){var n=r[t];this.dataFormats.add(n[0],n[1])}},e.prototype.initAnimations=function(){if(this.spec.animations)for(var t=0,r=this.spec.animations;t<r.length;t++){var n=r[t];this.managers.animation.register(n)}},e.prototype.initDataActions=function(){if(this.spec.actions)for(var t=0,r=this.spec.actions;t<r.length;t++){var n=r[t];this.state.data.actions.add(n.action)}},e.prototype.init=function(){return ce(this,void 0,void 0,function(){var t=this;return de(this,function(r){switch(r.label){case 0:return this.subs.push(this.events.log.subscribe(function(n){return t.log.entries=t.log.entries.push(n)})),this.initCustomFormats(),this.initBehaviorEvents(),this.initBuiltInBehavior(),this.managers.interactivity=new Pw(this),this.managers.lociLabels=new zst(this),this.builders.structure=new _st(this),this.initAnimations(),this.initDataActions(),[4,this.initBehaviors()];case 1:return r.sent(),this.log.message("Mol* Plugin "+sR+" ["+$Ze.toLocaleString()+"]"),y0||this.log.message("Development mode enabled"),kr&&this.log.message("Debug mode enabled"),[2]}})})},e}(),Dft=function(e){Fe(t,e);function t(r){var n=e.call(this,r)||this;return n.spec=r,n.customParamEditors=new Map,n.initCustomParamEditors(),n}return t.prototype.initCustomParamEditors=function(){if(this.spec.customParamEditors)for(var r=0,n=this.spec.customParamEditors;r<n.length;r++){var i=n[r],a=i[0],o=i[1];this.customParamEditors.set(a.id,o)}},t.prototype.dispose=function(r){e.prototype.dispose.call(this,r),this.layout.dispose()},t}(Mft),Sp;(function(e){function t(n){return n}e.create=t;function r(n,i){var a,o;if(i.customDurationMs)return i.customDurationMs;var s=(o=(a=i.definition).getDuration)===null||o===void 0?void 0:o.call(a,i.params,n);if((s==null?void 0:s.kind)==="fixed")return s.durationMs}e.getDuration=r})(Sp||(Sp={}));var Rft=Sp.create({name:"built-in.animate-assembly-unwind",display:{name:"Unwind Assembly"},isExportable:!0,params:function(e){for(var t=[["all","All"]],r=e.state.data.select(ir.Generators.rootsOfType(ge.Molecule.Structure)),n=0,i=r;n<i.length;n++){var a=i[n];t.push([a.transform.ref,a.obj.data.models[0].label])}return{durationInMs:I.Numeric(3e3,{min:100,max:1e4,step:100}),playOnce:I.Boolean(!1),target:I.Select(t[0][0],t)}},canApply:function(e){var t=e.state.data,r=cr.RootRef,n=t.select(ir.Generators.ofType(ge.Molecule.Structure.Representation3D,r));return{canApply:n.length>0}},getDuration:function(e){return{kind:"fixed",durationMs:e.durationInMs}},initialState:function(){return{t:0}},setup:function(e,t,r){for(var n=r.state.data,i=!e.target||e.target==="all"?cr.RootRef:e.target,a=n.select(ir.Generators.ofType(ge.Molecule.Structure.Representation3D,i)),o=n.build(),s=!1,u=0,l=a;u<l.length;u++){var c=l[u],d=n.select(ir.Generators.ofTransformer(rt.Representation.UnwindStructureAssemblyRepresentation3D,c.transform.ref));d.length>0||(s=!0,o.to(c).apply(rt.Representation.UnwindStructureAssemblyRepresentation3D,{t:0},{tags:"animate-assembly-unwind"}))}if(s)return o.commit({doNotUpdateCurrent:!0})},teardown:function(e,t,r){var n=r.state.data,i=n.select(ir.Generators.ofType(ge.Molecule.Structure.Representation3DState).withTag("animate-assembly-unwind"));if(i.length!==0){for(var a=n.build(),o=0,s=i;o<s.length;o++){var u=s[o];a.delete(u.transform.ref)}return a.commit()}},apply:function(e,t,r){return ce(this,void 0,void 0,function(){var n,i,a,o,s,u,l,c,d,f;return de(this,function(p){switch(p.label){case 0:if(n=r.plugin.state.data,i=!r.params.target||r.params.target==="all"?cr.RootRef:r.params.target,a=n.select(ir.Generators.ofTransformer(rt.Representation.UnwindStructureAssemblyRepresentation3D,i)),a.length===0)return[2,{kind:"finished"}];for(o=n.build(),s=(t.current-t.lastApplied)/r.params.durationInMs,u=e.t+s,l=!1,r.params.playOnce&&u>=1?(l=!0,u=1):u=u%1,c=0,d=a;c<d.length;c++)f=d[c],o.to(f).update({t:u});return[4,_t.State.Update(r.plugin,{state:n,tree:o,options:{doNotLogTiming:!0}})];case 1:return p.sent(),l?[2,{kind:"finished"}]:[2,{kind:"next",state:{t:u}}]}})})}}),gS=_(),NG=_(),BG=qn(),kft=Sp.create({name:"built-in.animate-camera-spin",display:{name:"Camera Spin"},isExportable:!0,params:function(){return{durationInMs:I.Numeric(4e3,{min:100,max:2e4,step:100}),speed:I.Numeric(1,{min:1,max:10,step:1},{description:"How many times to spin in the specified dutation."}),direction:I.Select("cw",[["cw","Clockwise"],["ccw","Counter Clockwise"]],{cycle:!0})}},initialState:function(e,t){var r;return{snapshot:(r=t.canvas3d)===null||r===void 0?void 0:r.camera.getSnapshot()}},getDuration:function(e){return{kind:"fixed",durationMs:e.durationInMs}},teardown:function(e,t,r){var n;(n=r.canvas3d)===null||n===void 0||n.requestCameraReset({snapshot:t.snapshot,durationMs:0})},apply:function(e,t,r){var n,i;return ce(this,void 0,void 0,function(){var a,o,s,u;return de(this,function(l){return t.current===0?[2,{kind:"next",state:e}]:(a=e.snapshot,a.radiusMax<1e-4?[2,{kind:"finished"}]:(o=Ba(t.current/r.params.durationInMs,0,1),o>=.99999?((n=r.plugin.canvas3d)===null||n===void 0||n.requestCameraReset({snapshot:a,durationMs:0}),[2,{kind:"finished"}]):(s=2*Math.PI*o*r.params.speed*(r.params.direction==="ccw"?-1:1),_.sub(gS,a.position,a.target),_.normalize(NG,a.up),qn.setAxisAngle(BG,NG,s),_.transformQuat(gS,gS,BG),u=_.add(_(),a.target,gS),(i=r.plugin.canvas3d)===null||i===void 0||i.requestCameraReset({snapshot:E(E({},a),{position:u}),durationMs:0}),[2,{kind:"next",state:e}])))})})}}),Oft=Sp.create({name:"built-in.animate-model-index",display:{name:"Animate Trajectory"},isExportable:!0,params:function(){return{mode:I.MappedStatic("loop",{palindrome:I.Group({}),loop:I.Group({direction:I.Select("forward",[["forward","Forward"],["backward","Backward"]])}),once:I.Group({direction:I.Select("forward",[["forward","Forward"],["backward","Backward"]])},{isFlat:!0})},{options:[["palindrome","Palindrome"],["loop","Loop"],["once","Once"]]}),duration:I.MappedStatic("fixed",{fixed:I.Group({durationInS:I.Numeric(5,{min:1,max:120,step:.1},{description:"Duration in seconds"})},{isFlat:!0}),computed:I.Group({targetFps:I.Numeric(30,{min:5,max:250,step:1},{label:"Target FPS"})},{isFlat:!0}),sequential:I.Group({maxFps:I.Numeric(30,{min:5,max:60,step:1})},{isFlat:!0})})}},canApply:function(e){for(var t=e.state.data,r=t.select(ir.Generators.ofTransformer(rt.Model.ModelFromTrajectory)),n=0,i=r;n<i.length;n++){var a=i[n],o=ir.findAncestorOfType(t.tree,t.cells,a.transform.ref,ge.Molecule.Trajectory);if(o&&o.obj&&o.obj.data.frameCount>1)return{canApply:!0}}return{canApply:!1,reason:"No trajectory to animate"}},getDuration:function(e,t){var r;if(((r=e.duration)===null||r===void 0?void 0:r.name)==="fixed")return{kind:"fixed",durationMs:e.duration.params.durationInS*1e3};if(e.duration.name==="computed"){for(var n=t.state.data,i=n.select(ir.Generators.ofTransformer(rt.Model.ModelFromTrajectory)),a=0,o=0,s=i;o<s.length;o++){var u=s[o],l=ir.findAncestorOfType(n.tree,n.cells,u.transform.ref,ge.Molecule.Trajectory);if(!(!l||!l.obj)){var c=l.obj;a=Math.max(Math.ceil(1e3*c.data.frameCount/e.duration.params.targetFps),a)}}return{kind:"fixed",durationMs:a}}return{kind:"unknown"}},initialState:function(){return{}},apply:function(e,t,r){return ce(this,void 0,void 0,function(){var n,i,a,o,s,u,l,c,d,f,p;return de(this,function(v){switch(v.label){case 0:if(r.params.duration.name==="sequential"&&t.current>0&&t.current-t.lastApplied<1e3/r.params.duration.params.maxFps)return[2,{kind:"skip"}];if(n=r.plugin.state.data,i=n.select(ir.Generators.ofTransformer(rt.Model.ModelFromTrajectory)),i.length===0)return[2,{kind:"finished"}];for(a=n.build(),o=r.params,s=e.palindromeDirections||{},u=!1,l=!0,c=function(h){var m=ir.findAncestorOfType(n.tree,n.cells,h.transform.ref,ge.Molecule.Trajectory);if(!m||!m.obj)return"continue";var g=m.obj;if(g.data.frameCount<=1)return"continue";a.to(h).update(function(y){var b=g.data.frameCount;if(b!==1)l=!1;else return y;if(o.duration.name==="sequential"){var S=1;if(o.mode.name==="once"){if(S=o.mode.params.direction==="backward"?-1:1,S===-1&&y.modelIndex===0||S===1&&y.modelIndex===b-1)return u=!0,y}else o.mode.name==="palindrome"&&(y.modelIndex===0?S=1:y.modelIndex===b-1?S=-1:S=s[h.transform.ref]||1);s[h.transform.ref]=S;var x=(y.modelIndex+S)%b;return x<0&&(x+=b),u=u||S===-1&&x===0||S===1&&x===b-1,{modelIndex:x}}else{var C=o.duration.name==="fixed"?o.duration.params.durationInS*1e3:Math.ceil(1e3*g.data.frameCount/o.duration.params.targetFps),w=t.current%C/C;o.mode.name==="loop"&&o.mode.params.direction==="backward"&&(w=1-w),o.mode.name==="palindrome"&&(w=2*w,w>1&&(w=2-w));var x=Math.min(Math.floor(g.data.frameCount*w),g.data.frameCount-1);return u=u||x===g.data.frameCount-1,{modelIndex:x}}})},d=0,f=i;d<f.length;d++)p=f[d],c(p);return l?[3,2]:[4,_t.State.Update(r.plugin,{state:n,tree:a,options:{doNotLogTiming:!0}})];case 1:v.sent(),v.label=2;case 2:return l||o.mode.name==="once"&&u?[2,{kind:"finished"}]:o.mode.name==="palindrome"?[2,{kind:"next",state:{palindromeDirections:s}}]:[2,{kind:"next",state:{}}]}})})}});function UG(e,t,r){var n;return r===void 0&&(r=!1),ce(this,void 0,void 0,function(){return de(this,function(i){switch(i.label){case 0:return t.snapshot.data?[4,e.runTask(e.state.data.setSnapshot(t.snapshot.data))]:[3,2];case 1:i.sent(),i.label=2;case 2:return t.snapshot.camera&&((n=e.canvas3d)===null||n===void 0||n.requestCameraReset({snapshot:t.snapshot.camera.current,durationMs:r||t.snapshot.camera.transitionStyle==="instant"?0:t.snapshot.camera.transitionDurationInMs})),[2]}})})}var Lft=Sp.create({name:"built-in.animate-state-snapshots",display:{name:"State Snapshots"},isExportable:!0,params:function(){return{}},canApply:function(e){var t=e.managers.snapshot.state.entries;return t.size<2?{canApply:!1,reason:"At least 2 states required."}:t.some(function(r){return!!(r!=null&&r.snapshot.startAnimation)})?{canApply:!1,reason:"Nested animations not supported."}:{canApply:e.managers.snapshot.state.entries.size>1}},setup:function(e,t,r){var n=r.managers.snapshot.state.entries.get(0);UG(r,n,!0)},getDuration:function(e,t){return{kind:"fixed",durationMs:t.managers.snapshot.state.entries.toArray().reduce(function(r,n){var i;return r+((i=n.snapshot.durationInMs)!==null&&i!==void 0?i:0)},0)}},initialState:function(e,t){var r=t.managers.snapshot.state.entries.toArray();return{totalDuration:r.reduce(function(n,i){var a;return n+((a=i.snapshot.durationInMs)!==null&&a!==void 0?a:0)},0),snapshots:r,currentIndex:0}},apply:function(e,t,r){var n;return ce(this,void 0,void 0,function(){var i,a,o,s,u;return de(this,function(l){if(t.current>=e.totalDuration)return[2,{kind:"finished"}];for(i=0,a=0,o=0,s=e.snapshots;o<s.length&&(u=s[o],i+=(n=u.snapshot.durationInMs)!==null&&n!==void 0?n:0,!(t.current<i));o++)a++;return a>=e.snapshots.length?[2,{kind:"finished"}]:a===e.currentIndex?[2,{kind:"skip"}]:(UG(r.plugin,e.snapshots[a]),[2,{kind:"next",state:E(E({},e),{currentIndex:a})}])})})}}),Fft=Po.build({from:ge.Root,display:{name:"Download Density",description:"Load a density from the provided source and create its default visual."},params:function(e,t){var r=t.dataFormats.options;return{source:I.MappedStatic("pdb-xray",{"pdb-xray":I.Group({provider:I.Group({id:I.Text("1tqn",{label:"Id"}),server:I.Select("rcsb",[["pdbe","PDBe"],["rcsb","RCSB PDB"]])},{pivot:"id"}),type:I.Select("2fofc",[["2fofc","2Fo-Fc"],["fofc","Fo-Fc"]])},{isFlat:!0}),"pdb-xray-ds":I.Group({provider:I.Group({id:I.Text("1tqn",{label:"Id"}),server:I.Select("pdbe",[["pdbe","PDBe"],["rcsb","RCSB PDB"]])},{pivot:"id"}),detail:I.Numeric(3,{min:0,max:6,step:1},{label:"Detail"})},{isFlat:!0}),"pdb-emd-ds":I.Group({provider:I.Group({id:I.Text("emd-8004",{label:"Id"}),server:I.Select("pdbe",[["pdbe","PDBe"],["rcsb","RCSB PDB"]])},{pivot:"id"}),detail:I.Numeric(3,{min:0,max:6,step:1},{label:"Detail"})},{isFlat:!0}),url:I.Group({url:I.Url(""),isBinary:I.Boolean(!1),format:I.Select("auto",r)},{isFlat:!0})},{options:[["pdb-xray","PDB X-ray maps"],["pdb-emd-ds","PDB EMD Density Server"],["pdb-xray-ds","PDB X-ray Density Server"],["url","URL"]]})}}})(function(e,t){var r=e.params;return $e.create("Download Density",function(n){return ce(void 0,void 0,void 0,function(){var i,a,o,s,u,l,c,d;return de(this,function(f){switch(f.label){case 0:switch(i=r.source,i.name){case"url":a=i.params;break;case"pdb-xray":a=i.params.provider.server==="pdbe"?{url:Pn.Url(i.params.type==="2fofc"?"http://www.ebi.ac.uk/pdbe/coordinates/files/"+i.params.provider.id.toLowerCase()+".ccp4":"http://www.ebi.ac.uk/pdbe/coordinates/files/"+i.params.provider.id.toLowerCase()+"_diff.ccp4"),isBinary:!0,label:"PDBe X-ray map: "+i.params.provider.id}:{url:Pn.Url(i.params.type==="2fofc"?"https://edmaps.rcsb.org/maps/"+i.params.provider.id.toLowerCase()+"_2fofc.dsn6":"https://edmaps.rcsb.org/maps/"+i.params.provider.id.toLowerCase()+"_fofc.dsn6"),isBinary:!0,label:"RCSB X-ray map: "+i.params.provider.id};break;case"pdb-emd-ds":a=i.params.provider.server==="pdbe"?{url:Pn.Url("https://www.ebi.ac.uk/pdbe/densities/emd/"+i.params.provider.id.toLowerCase()+"/cell?detail="+i.params.detail),isBinary:!0,label:"PDBe EMD Density Server: "+i.params.provider.id}:{url:Pn.Url("https://maps.rcsb.org/em/"+i.params.provider.id.toLowerCase()+"/cell?detail="+i.params.detail),isBinary:!0,label:"RCSB PDB EMD Density Server: "+i.params.provider.id};break;case"pdb-xray-ds":a=i.params.provider.server==="pdbe"?{url:Pn.Url("https://www.ebi.ac.uk/pdbe/densities/x-ray/"+i.params.provider.id.toLowerCase()+"/cell?detail="+i.params.detail),isBinary:!0,label:"PDBe X-ray Density Server: "+i.params.provider.id}:{url:Pn.Url("https://maps.rcsb.org/x-ray/"+i.params.provider.id.toLowerCase()+"/cell?detail="+i.params.detail),isBinary:!0,label:"RCSB PDB X-ray Density Server: "+i.params.provider.id};break;default:throw new Error(i.name+" not supported.")}return[4,t.builders.data.download(a)];case 1:switch(s=f.sent(),u=void 0,i.name){case"url":a=i.params,o=i.params.format==="auto"?t.dataFormats.auto(HF(Pn.getUrl(a.url)),(c=s.cell)===null||c===void 0?void 0:c.obj):t.dataFormats.get(i.params.format);break;case"pdb-xray":u=i.params.provider.id,o=i.params.provider.server==="pdbe"?t.dataFormats.get("ccp4"):t.dataFormats.get("dsn6");break;case"pdb-emd-ds":case"pdb-xray-ds":u=i.params.provider.id,o=t.dataFormats.get("dscif");break;default:throw new Error(i.name+" not supported.")}return o?[4,o.parse(t,s,{entryId:u})]:(t.log.warn("DownloadDensity: Format provider not found."),[2]);case 2:return l=f.sent(),[4,(d=o.visuals)===null||d===void 0?void 0:d.call(o,t,l)];case 3:return f.sent(),[2]}})})})}),Doe=Po.build({display:{name:"Assign Volume Colors",description:"Assigns another volume to be available for coloring."},from:ge.Volume.Data,isApplicable:function(e){return!e.data.colorVolume},params:function(e,t){var r=t.state.data.select(ir.Generators.root.subtree().ofType(ge.Volume.Data).filter(function(n){var i;return!!n.obj&&!(!((i=n.obj)===null||i===void 0)&&i.data.colorVolume)&&n.obj!==e}));return r.length===0?{ref:I.Text("",{isHidden:!0,label:"Volume"})}:{ref:I.Select(r[0].transform.ref,r.map(function(n){return[n.transform.ref,n.obj.label]}),{label:"Volume"})}}})(function(e,t){var r=e.ref,n=e.params;return e.state,t.build().to(r).apply(rt.Volume.AssignColorVolume,{ref:n.ref},{dependsOn:[n.ref]}).commit()});const Nft=Object.freeze(Object.defineProperty({__proto__:null,AssignColorVolume:Doe,DownloadDensity:Fft},Symbol.toStringTag,{value:"Module"}));var Bft=Po.build({display:{name:"Open Files",description:"Load one or more files and optionally create default visuals"},from:ge.Root,params:function(e,t){var r=t.dataFormats,n=r.extensions,i=r.options;return{files:I.FileList({accept:Array.from(n.values()).map(function(a){return"."+a}).join(",")+",.gz,.zip",multiple:!0}),format:I.MappedStatic("auto",{auto:I.EmptyGroup(),specific:I.Select(i[0][0],i)}),visuals:I.Boolean(!0,{description:"Add default visuals"})}}})(function(e,t){var r=e.params,n=e.state;return $e.create("Open Files",function(i){return ce(void 0,void 0,void 0,function(){return de(this,function(a){switch(a.label){case 0:return t.behaviors.layout.leftPanelTabName.next("data"),[4,n.transaction(function(){return ce(void 0,void 0,void 0,function(){var o,s,u,l,c,d,f,p,v,h,m;return de(this,function(g){switch(g.label){case 0:if(r.files===null)return t.log.error("No file(s) selected"),[2];o=0,s=r.files,g.label=1;case 1:if(!(o<s.length))return[3,9];u=s[o],g.label=2;case 2:return g.trys.push([2,7,,8]),l=HF(u.file),c=t.dataFormats.binaryExtensions.has(l.ext),[4,t.builders.data.readFile({file:u,isBinary:c})];case 3:return d=g.sent().data,f=r.format.name==="auto"?t.dataFormats.auto(l,(h=d.cell)===null||h===void 0?void 0:h.obj):t.dataFormats.get(r.format.params),f?[4,f.parse(t,d)]:(t.log.warn("OpenFiles: could not find data provider for '"+l.name+"."+l.ext+"'"),[3,8]);case 4:return p=g.sent(),r.visuals?[4,(m=f.visuals)===null||m===void 0?void 0:m.call(f,t,p)]:[3,6];case 5:g.sent(),g.label=6;case 6:return[3,8];case 7:return v=g.sent(),t.log.error(v),[3,8];case 8:return o++,[3,1];case 9:return[2]}})})}).runInContext(i)];case 1:return a.sent(),[2]}})})})}),Uft=Po.build({display:{name:"Download File",description:"Load one or more file from an URL"},from:ge.Root,params:function(e,t){var r=t.dataFormats.options;return{url:I.Url(""),format:I.Select(r[0][0],r),isBinary:I.Boolean(!1),visuals:I.Boolean(!0,{description:"Add default visuals"})}}})(function(e,t){var r=e.params,n=e.state;return $e.create("Open Files",function(i){return ce(void 0,void 0,void 0,function(){return de(this,function(a){switch(a.label){case 0:return t.behaviors.layout.leftPanelTabName.next("data"),[4,n.transaction(function(){return ce(void 0,void 0,void 0,function(){var o,s,u,l,c;return de(this,function(d){switch(d.label){case 0:return d.trys.push([0,5,,6]),o=t.dataFormats.get(r.format),o?[4,t.builders.data.download({url:r.url,isBinary:r.isBinary})]:(t.log.warn("DownloadFile: could not find data provider for '"+r.format+"'"),[2]);case 1:return s=d.sent(),[4,o.parse(t,s)];case 2:return u=d.sent(),r.visuals?[4,(c=o.visuals)===null||c===void 0?void 0:c.call(o,t,u)]:[3,4];case 3:d.sent(),d.label=4;case 4:return[3,6];case 5:return l=d.sent(),t.log.error(l),[3,6];case 6:return[2]}})})}).runInContext(i)];case 1:return a.sent(),[2]}})})})});const jft=Object.freeze(Object.defineProperty({__proto__:null,DownloadFile:Uft,OpenFiles:Bft},Symbol.toStringTag,{value:"Module"}));var th={Structure:frt,Volume:Nft,DataFormat:jft},zft=Sp.create({name:"built-in.animate-state-interpolation",display:{name:"Animate State (experimental)"},params:function(){return{transtionDurationInMs:I.Numeric(2e3,{min:100,max:3e4,step:10})}},canApply:function(e){return{canApply:e.managers.snapshot.state.entries.size>1}},initialState:function(){return{}},apply:function(e,t,r){return ce(this,void 0,void 0,function(){var n,i,a,o,s,u,l,c,d,f,p,v,h,m,g,y,b,S,x,C;return de(this,function(w){switch(w.label){case 0:if(n=r.plugin.managers.snapshot.state.entries,n.size<2)return[2,{kind:"finished"}];if(i=t.current%r.params.transtionDurationInMs/r.params.transtionDurationInMs,a=Math.floor(t.current/r.params.transtionDurationInMs)%n.size,o=Math.ceil(t.current/r.params.transtionDurationInMs),o===a&&o++,o=o%n.size,s=n.get(a).snapshot,u=n.get(o).snapshot,!s.data||!u.data)return[2,{kind:"skip"}];for(l=s.data.tree.transforms,c=u.data.tree.transforms,d=r.plugin.state.data,f=d.build(),p=0,v=l;p<v.length;p++)for(h=v[p],m=0,g=c;m<g.length;m++)y=g[m],y.ref===h.ref&&y.version!==h.version&&(b=cr.fromJSON(h),S=cr.fromJSON(y),x=d.cells.get(h.ref),x&&(C=void 0,b.transformer.definition.interpolate?C=b.transformer.definition.interpolate(b.params,S.params,i,r.plugin):C=i<=.5?b.params:S.params,__(x,C)||f.to(h.ref).update(C)));return[4,_t.State.Update(r.plugin,{state:d,tree:f,options:{doNotLogTiming:!0}})];case 1:return w.sent(),[2,{kind:"next",state:{}}]}})})}}),Vft=Sp.create({name:"built-in.animate-structure-spin",display:{name:"Spin Structure"},isExportable:!0,params:function(){return{durationInMs:I.Numeric(3e3,{min:100,max:1e4,step:100})}},initialState:function(){return{t:0}},getDuration:function(e){return{kind:"fixed",durationMs:e.durationInMs}},setup:function(e,t,r){return ce(this,void 0,void 0,function(){var n,i,a,o,s,u,l,c;return de(this,function(d){for(n=r.state.data,i=n.select(ir.Generators.ofType(ge.Molecule.Structure.Representation3D)),a=n.build(),o=!1,s=0,u=i;s<u.length;s++)l=u[s],c=n.select(ir.Generators.ofTransformer(rt.Representation.SpinStructureRepresentation3D,l.transform.ref)),!(c.length>0)&&(o=!0,a.to(l.transform.ref).apply(rt.Representation.SpinStructureRepresentation3D,{t:0},{tags:"animate-structure-spin"}));return o?[2,a.commit({doNotUpdateCurrent:!0})]:[2]})})},teardown:function(e,t,r){var n=r.state.data,i=n.select(ir.Generators.ofType(ge.Molecule.Structure.Representation3DState).withTag("animate-structure-spin"));if(i.length!==0){for(var a=n.build(),o=0,s=i;o<s.length;o++){var u=s[o];a.delete(u.transform.ref)}return a.commit()}},apply:function(e,t,r){var n;return ce(this,void 0,void 0,function(){var i,a,o,s,u,l,c,d;return de(this,function(f){switch(f.label){case 0:if(i=r.plugin.state.data,a=i.select(ir.Generators.ofTransformer(rt.Representation.SpinStructureRepresentation3D)),a.length===0)return[2,{kind:"finished"}];for(o=i.build(),s=(t.current-t.lastApplied)/r.params.durationInMs,u=(e.t+s)%1,l=0,c=a;l<c.length;l++)d=c[l],o.to(d).update(E(E({},(n=d.params)===null||n===void 0?void 0:n.values),{t:u}));return[4,_t.State.Update(r.plugin,{state:i,tree:o,options:{doNotLogTiming:!0}})];case 1:return f.sent(),[2,{kind:"next",state:{t:u}}]}})})}}),Jt;(function(e){function t(n,i){return{action:n,customControl:i&&i.customControl,autoUpdate:i&&i.autoUpdate}}e.Action=t;function r(n,i){return i===void 0&&(i={}),{transformer:n,defaultParams:i}}e.Behavior=r})(Jt||(Jt={}));var Hft=function(){return{actions:[Jt.Action(th.Structure.DownloadStructure),Jt.Action(th.Structure.AddTrajectory),Jt.Action(th.Volume.DownloadDensity),Jt.Action(th.DataFormat.DownloadFile),Jt.Action(th.DataFormat.OpenFiles),Jt.Action(th.Structure.EnableModelCustomProps),Jt.Action(th.Structure.EnableStructureCustomProps),Jt.Action(wR),Jt.Action(Tat),Jt.Action(jF),Jt.Action(rt.Data.Download),Jt.Action(rt.Data.ParseCif),Jt.Action(rt.Data.ParseCcp4),Jt.Action(rt.Data.ParseDsn6),Jt.Action(rt.Model.TrajectoryFromMmCif),Jt.Action(rt.Model.TrajectoryFromCifCore),Jt.Action(rt.Model.TrajectoryFromPDB),Jt.Action(rt.Model.TransformStructureConformation),Jt.Action(rt.Model.StructureFromModel),Jt.Action(rt.Model.StructureFromTrajectory),Jt.Action(rt.Model.ModelFromTrajectory),Jt.Action(rt.Model.StructureSelectionFromScript),Jt.Action(rt.Representation.StructureRepresentation3D),Jt.Action(rt.Representation.StructureSelectionsDistance3D),Jt.Action(rt.Representation.StructureSelectionsAngle3D),Jt.Action(rt.Representation.StructureSelectionsDihedral3D),Jt.Action(rt.Representation.StructureSelectionsLabel3D),Jt.Action(rt.Representation.StructureSelectionsOrientation3D),Jt.Action(rt.Representation.ModelUnitcell3D),Jt.Action(rt.Representation.StructureBoundingBox3D),Jt.Action(rt.Representation.ExplodeStructureRepresentation3D),Jt.Action(rt.Representation.SpinStructureRepresentation3D),Jt.Action(rt.Representation.UnwindStructureAssemblyRepresentation3D),Jt.Action(rt.Representation.OverpaintStructureRepresentation3DFromScript),Jt.Action(rt.Representation.TransparencyStructureRepresentation3DFromScript),Jt.Action(Doe),Jt.Action(rt.Volume.VolumeFromCcp4),Jt.Action(rt.Volume.VolumeFromDsn6),Jt.Action(rt.Volume.VolumeFromCube),Jt.Action(rt.Volume.VolumeFromDx),Jt.Action(rt.Representation.VolumeRepresentation3D)],behaviors:[Jt.Behavior(Uo.Representation.HighlightLoci),Jt.Behavior(Uo.Representation.SelectLoci),Jt.Behavior(Uo.Representation.DefaultLociLabelProvider),Jt.Behavior(Uo.Representation.FocusLoci),Jt.Behavior(Uo.Camera.FocusLoci),Jt.Behavior(Uo.Camera.CameraAxisHelper),Jt.Behavior(bF),Jt.Behavior(Uo.CustomProps.StructureInfo),Jt.Behavior(Uo.CustomProps.AccessibleSurfaceArea),Jt.Behavior(Uo.CustomProps.BestDatabaseSequenceMapping),Jt.Behavior(Uo.CustomProps.Interactions),Jt.Behavior(Uo.CustomProps.SecondaryStructure),Jt.Behavior(Uo.CustomProps.ValenceModel),Jt.Behavior(Uo.CustomProps.CrossLinkRestraint)],animations:[Oft,kft,Lft,Rft,Vft,zft]}},Gft={color:I.Color(fr.black,{description:"Display color of the volume."}),wireframe:I.Boolean(!1,{description:"Control display of the volume as a wireframe."}),opacity:I.Numeric(.3,{min:0,max:1,step:.01},{description:"Opacity of the volume."})},qft=new Map([["em",[-5,5]],["2fo-fc",[0,3]],["fo-fc(+ve)",[1,5]],["fo-fc(-ve)",[-5,-1]]]),yS=function(e){Fe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.ref=ir.findTagInSubtree(r.plugin.state.data.tree,r.props.bCell.transform.ref,r.props.name),r.getVisible=function(){var n=r.plugin.state.data,i=r.ref;return i?!n.cells.get(i).state.isHidden:!1},r.toggleVisible=function(){var n=r.plugin.state.data,i=r.ref;i&&Sv(n,i,!n.cells.get(i).state.isHidden)},r}return t.prototype.componentDidUpdate=function(){this.ref=ir.findTagInSubtree(this.plugin.state.data.tree,this.props.bCell.transform.ref,this.props.name)},t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.state.data.events.cell.stateUpdated,function(n){r.ref===n.ref&&r.forceUpdate()})},t.prototype.render=function(){var r=this.props,n=r.isRelative,i=r.stats,a=r.channels[r.name],o=i.min,s=i.max,u=i.mean,l=i.sigma,c=Math.round(100*(a.isoValue.kind==="relative"?a.isoValue.relativeValue:a.isoValue.absoluteValue))/100,d=(o-u)/l,f=(s-u)/l;if(!this.props.isUnbounded){var p=qft.get(this.props.name);this.props.name==="em"?(d=Math.max(p[0],d),f=Math.min(p[1],f)):(d=p[0],f=p[1])}var v=u+l*d,h=u+l*f,m=nD(n?Math.round((h-v)/l)/100:l/100,2),g=n?d:v,y=n?f:h;return P.jsx(h5e,{label:r.label+(r.isRelative?" ":""),colorStripe:a.color,pivot:P.jsxs("div",E({className:"msp-volume-channel-inline-controls"},{children:[P.jsx(tie,{value:c,min:g,max:y,step:m,onChange:function(b){return r.changeIso(r.name,b,n)},disabled:r.params.isDisabled,onEnter:r.params.events.onEnter},void 0),P.jsx(Ht,{svg:this.getVisible()?Ov:kv,onClick:this.toggleVisible,toggleState:!1,disabled:r.params.isDisabled},void 0)]}),void 0),controls:P.jsx(Un,{onChange:function(b){var S=b.name,x=b.value;return r.changeParams(r.name,S,x)},params:Gft,values:a,onEnter:r.params.events.onEnter,isDisabled:r.params.isDisabled},void 0)},void 0)},t}(gr),$ft=function(e){Fe(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.changeIso=function(n,i,a){var o,s=r.props.params;r.newParams(E(E({},s),{entry:{name:s.entry.name,params:E(E({},s.entry.params),{channels:E(E({},s.entry.params.channels),(o={},o[n]=E(E({},s.entry.params.channels[n]),{isoValue:a?Ct.IsoValue.relative(i):Ct.IsoValue.absolute(i)}),o))})}}))},r.changeParams=function(n,i,a){var o,s,u=r.props.params;r.newParams(E(E({},u),{entry:{name:u.entry.name,params:E(E({},u.entry.params),{channels:E(E({},u.entry.params.channels),(o={},o[n]=E(E({},u.entry.params.channels[n]),(s={},s[i]=a,s)),o))})}}))},r.changeOption=function(n){var i=n.name,a=n.value,o=r.props.params;if(i==="entry")r.newParams(E(E({},o),{entry:{name:a,params:o.entry.params}}));else{var s=r.props.b.data,u=s.info.kind==="em",l=a.params.isRelative,c=s.info.header.sampling[0],d=o.entry.params.channels,f=o.entry.params.view.name===a.name?o.entry.params.view.params:r.props.info.params.entry.map(o.entry.name).params.view.map(a.name).defaultValue,p=E({},f);a.name==="selection-box"?p.radius=a.params.radius:a.name==="box"?(p.bottomLeft=a.params.bottomLeft,p.topRight=a.params.topRight):a.name==="auto"&&(p.radius=a.params.radius,p.selectionDetailLevel=a.params.selectionDetailLevel),p.isUnbounded=!!a.params.isUnbounded,r.newParams(E(E({},o),{entry:{name:o.entry.name,params:E(E({},o.entry.params),{view:{name:a.name,params:p},detailLevel:a.params.detailLevel,channels:u?{em:r.convert(d.em,c.valuesInfo[0],l)}:{"2fo-fc":r.convert(d["2fo-fc"],c.valuesInfo[0],l),"fo-fc(+ve)":r.convert(d["fo-fc(+ve)"],c.valuesInfo[1],l),"fo-fc(-ve)":r.convert(d["fo-fc(-ve)"],c.valuesInfo[1],l)}})}}))}},r}return t.prototype.areInitial=function(r){return I.areEqual(this.props.info.params,r,this.props.info.initialValues)},t.prototype.newParams=function(r){this.props.events.onChange(r,this.areInitial(r))},t.prototype.convert=function(r,n,i){return E(E({},r),{isoValue:i?Ct.IsoValue.toRelative(r.isoValue,n):Ct.IsoValue.toAbsolute(r.isoValue,n)})},t.prototype.render=function(){if(!this.props.b)return null;var r=this.props.b.data,n=r.info.kind==="em",i=n?"em":"2fo-fc",a=this.props.params,o=this.props.info.params.entry.map(a.entry.name),s=o.params.detailLevel,u=a.entry.params.channels[i].isoValue.kind==="relative",l=r.info.header.sampling[0],c=I.Boolean(u,{description:"Use normalized or absolute isocontour scale.",label:"Normalized"}),d=!!a.entry.params.view.params.isUnbounded,f=I.Boolean(d,{description:"Show full/limited range of iso-values for more fine-grained control.",label:"Unbounded"}),p=a.entry.params.view.name==="off",v={entry:I.Select(a.entry.name,r.data.entries.map(function(m){return[m.dataId,m.dataId]}),{isHidden:p,description:"Which entry with volume data to display."}),view:I.MappedStatic(a.entry.params.view.name,{off:I.Group({isRelative:I.Boolean(u,{isHidden:!0}),isUnbounded:I.Boolean(d,{isHidden:!0})},{description:"Display off."}),box:I.Group({bottomLeft:I.Vec3(_.zero()),topRight:I.Vec3(_.zero()),detailLevel:s,isRelative:c,isUnbounded:f},{description:"Static box defined by cartesian coords."}),"selection-box":I.Group({radius:I.Numeric(5,{min:0,max:50,step:.5},{description:"Radius in  within which the volume is shown."}),detailLevel:s,isRelative:c,isUnbounded:f},{description:"Box around focused element."}),cell:I.Group({detailLevel:s,isRelative:c,isUnbounded:f},{description:"Box around the structure's bounding box."}),auto:I.Group({radius:I.Numeric(5,{min:0,max:50,step:.5},{description:"Radius in  within which the volume is shown."}),detailLevel:s,selectionDetailLevel:E(E({},s),{label:"Selection Detail"}),isRelative:c,isUnbounded:f},{description:"Box around focused element."})},{options:ja.ViewTypeOptions,description:'Controls what of the volume is displayed. "Off" hides the volume alltogether. "Bounded box" shows the volume inside the given box. "Around Focus" shows the volume around the element/atom last interacted with. "Whole Structure" shows the volume for the whole structure.'})},h={entry:a.entry.name,view:{name:a.entry.params.view.name,params:{detailLevel:a.entry.params.detailLevel,radius:a.entry.params.view.params.radius,bottomLeft:a.entry.params.view.params.bottomLeft,topRight:a.entry.params.view.params.topRight,selectionDetailLevel:a.entry.params.view.params.selectionDetailLevel,isRelative:u,isUnbounded:d}}};return p?P.jsx(Un,{onChange:this.changeOption,params:v,values:h,onEnter:this.props.events.onEnter,isDisabled:this.props.isDisabled},void 0):P.jsxs(P.Fragment,{children:[!n&&P.jsx(yS,{label:"2Fo-Fc",name:"2fo-fc",bCell:this.props.bCell,channels:a.entry.params.channels,changeIso:this.changeIso,changeParams:this.changeParams,isRelative:u,params:this.props,stats:l.valuesInfo[0],isUnbounded:d},void 0),!n&&P.jsx(yS,{label:"Fo-Fc(+ve)",name:"fo-fc(+ve)",bCell:this.props.bCell,channels:a.entry.params.channels,changeIso:this.changeIso,changeParams:this.changeParams,isRelative:u,params:this.props,stats:l.valuesInfo[1],isUnbounded:d},void 0),!n&&P.jsx(yS,{label:"Fo-Fc(-ve)",name:"fo-fc(-ve)",bCell:this.props.bCell,channels:a.entry.params.channels,changeIso:this.changeIso,changeParams:this.changeParams,isRelative:u,params:this.props,stats:l.valuesInfo[1],isUnbounded:d},void 0),n&&P.jsx(yS,{label:"EM",name:"em",bCell:this.props.bCell,channels:a.entry.params.channels,changeIso:this.changeIso,changeParams:this.changeParams,isRelative:u,params:this.props,stats:l.valuesInfo[0],isUnbounded:d},void 0),P.jsx(Un,{onChange:this.changeOption,params:v,values:h,onEnter:this.props.events.onEnter,isDisabled:this.props.isDisabled},void 0)]},void 0)},t}(gr),Roe=function(){return E(E({},Hft()),{customParamEditors:[[jF,$ft]]})};function Wft(e,t){var r=new Dft(t||Roe());return r.init(),o3.render(_e.createElement(nst,{plugin:r}),e),r}var koe=globalThis&&globalThis.__awaiter||function(e,t,r,n){function i(a){return a instanceof r?a:new r(function(o){o(a)})}return new(r||(r=Promise))(function(a,o){function s(c){try{l(n.next(c))}catch(d){o(d)}}function u(c){try{l(n.throw(c))}catch(d){o(d)}}function l(c){c.done?a(c.value):i(c.value).then(s,u)}l((n=n.apply(e,t||[])).next())})};const Xft="",Ooe=e=>!!e&&$t.isFromPdbArchive(e),Yft={local_metric_values:{label_asym_id:ve.Schema.str,label_comp_id:ve.Schema.str,label_seq_id:ve.Schema.int,metric_id:ve.Schema.int,metric_value:ve.Schema.float,model_id:ve.Schema.int,ordinal_id:ve.Schema.int}},Kft=(e,t)=>{if(!an.is(t.sourceData)||!t.sourceData.data.frame.categoryNames.includes(e))return;const r=t.sourceData.data.frame.categories[e].getField("metric_value");if(!(!r||r.rowCount===0))return{timestamp_utc:r.str(0)||WZe(new Date)}},Qft=(e,t)=>{const r=Kft("ma_qa_metric_local",t);if(!r)return;const n=ept(t),i=tpt(t,n.residues);return{info:r,data:i}};function Zft(e,t,r){return koe(this,void 0,void 0,function*(){return{value:Qft(e,t)}})}function NR(e){if(!je.isAtomic(e.unit))return[-1,"No Score"];const t=rp.get(e.unit.model).value;if(!t||!t.data)return[-1,"No Score"];const r=e.unit.residueIndex[e.element];return t.data.score.has(r)?t.data.score.get(r):[-1,"No Score"]}const jG=[];function Jft(e){if(!e)return jG;const t=rp.get(e.models[0]).value;return!t||!t.data?jG:t.data.category}function ept(e){if(!an.is(e.sourceData))throw new Error("Data format must be mmCIF.");return{residues:xJ(Yft.local_metric_values,e.sourceData.data.frame.categories.ma_qa_metric_local)}}const hI={serverUrl:I.Text(Xft,{description:"JSON API Server URL"})},rp=mv.createProvider({label:"AF Confidence Score",descriptor:To({name:"af_confidence_score"}),type:"static",defaultParams:hI,getParams:e=>hI,isApplicable:e=>Ooe(e),obtain:(e,t,r)=>koe(void 0,void 0,void 0,function*(){return Object.assign(Object.assign({},I.getDefaultValues(hI)),r),yield Zft(e,t)})});function tpt(e,t){const r=new Map,{label_asym_id:n,label_seq_id:i,metric_value:a,_rowCount:o}=t,s=[];for(let u=0;u<o;u++){const l=a.value(u),c=e.atomicHierarchy.index.findResidue("1",n.value(u),i.value(u),"");let d="Very low";l>50&&l<=70?d="Low":l>70&&l<=90?d="Medium":l>90&&(d="High"),r.set(c,[l,d]),Fa(s,d)}return{score:gD.fromResidueMap(r),category:s}}const Pm={"No Score":at.fromRgb(170,170,170),"Very low":at.fromRgb(255,125,69),Low:at.fromRgb(255,219,19),Medium:at.fromRgb(101,203,243),High:at.fromRgb(0,83,214)},rpt={type:I.MappedStatic("score",{score:I.Group({}),category:I.Group({kind:I.Text()})})};function Loe(e,t){let r;if(e.structure&&!e.structure.isEmpty&&e.structure.models[0].customProperties.has(rp.descriptor))if(t.type.name==="score")r=n=>{if(Ze.is(n)){const i=NR(n);return Pm[i[1]]}return Pm["No Score"]};else{const n=t.type.params.kind;r=i=>{if(Ze.is(i)){const a=NR(i);return a[1]===n?Pm[a[1]]:Pm["No Score"]}return Pm["No Score"]}}else r=()=>Pm["No Score"];return{factory:Loe,granularity:"group",color:r,props:t,description:"Assigns residue colors according to the AF Confidence score"}}const zG={name:"af-confidence",label:"AF Confidence",category:"Validation",factory:Loe,getParams:e=>{const t=Jft(e.structure);return t.length===0?{type:I.MappedStatic("score",{score:I.Group({})})}:{type:I.MappedStatic("score",{score:I.Group({}),category:I.Group({kind:I.Select(t[0],I.arrayToOptions(t))},{isFlat:!0})})}},defaultValues:I.getDefaultValues(rpt),isApplicable:e=>{var t;return Ooe((t=e.structure)===null||t===void 0?void 0:t.models[0])},ensureCustomProperties:{attach:(e,t)=>t.structure?rp.attach(e,t.structure.models[0],void 0,!0):Promise.resolve(),detach:e=>e.structure&&e.structure.models[0].customProperties.reference(rp.descriptor,!1)}},npt=Or.create({name:"af-confidence-prop",category:"custom-props",display:{name:"AlphaFold Confidence Score",description:"AlphaFold Confidence Score."},ctor:class extends Or.Handler{constructor(){super(...arguments),this.provider=rp,this.labelAfConfScore={label:e=>{if(this.params.showTooltip&&e.kind==="element-loci"&&e.elements.length!==0){const t=e.elements[0],r=t.unit;if(!r.model.customProperties.hasReference(rp.descriptor))return;const n=Ze.create(e.structure,r,r.elements[Le.getAt(t.indices,0)]),i=NR(n);return i&&i[0]>0?`Confidence score: ${i[0]} <small>( ${i[1]} )</small>`:""}}}}register(){this.ctx.customModelProperties.register(this.provider,this.params.autoAttach),this.ctx.managers.lociLabels.addProvider(this.labelAfConfScore),this.ctx.representation.structure.themes.colorThemeRegistry.add(zG)}update(e){const t=this.params.autoAttach!==e.autoAttach;return this.params.autoAttach=e.autoAttach,this.params.showTooltip=e.showTooltip,this.ctx.customModelProperties.setDefaultAutoAttach(this.provider.descriptor.name,this.params.autoAttach),t}unregister(){this.ctx.customModelProperties.unregister(rp.descriptor.name),this.ctx.managers.lociLabels.removeProvider(this.labelAfConfScore),this.ctx.representation.structure.themes.colorThemeRegistry.remove(zG)}},params:()=>({autoAttach:I.Boolean(!1),showTooltip:I.Boolean(!0)})});var ipt=globalThis&&globalThis.__awaiter||function(e,t,r,n){function i(a){return a instanceof r?a:new r(function(o){o(a)})}return new(r||(r=Promise))(function(a,o){function s(c){try{l(n.next(c))}catch(d){o(d)}}function u(c){try{l(n.throw(c))}catch(d){o(d)}}function l(c){c.done?a(c.value):i(c.value).then(s,u)}l((n=n.apply(e,t||[])).next())})};const cc={layoutIsExpanded:!1,layoutShowControls:!1,layoutShowRemoteState:!1,layoutControlsDisplay:"reactive",layoutShowSequence:!1,layoutShowLog:!1,layoutShowLeftPanel:!1,disableAntialiasing:!1,pixelScale:1,enableWboit:!1,viewportShowExpand:!0,viewportShowSelectionMode:!1,viewportShowAnimation:!1,pdbProvider:"pdbe",viewportShowControls:Yr.Viewport.ShowControls.defaultValue,viewportShowSettings:Yr.Viewport.ShowSettings.defaultValue};class apt{constructor(t,r,n){const i=Roe(),a={actions:i.actions,behaviors:[...i.behaviors,Jt.Behavior(npt,{autoAttach:!0,showTooltip:!0})],layout:{initial:{isExpanded:cc.layoutIsExpanded,showControls:cc.layoutShowControls,controlsDisplay:cc.layoutControlsDisplay}},config:[[Yr.General.DisableAntialiasing,cc.disableAntialiasing],[Yr.General.PixelScale,cc.pixelScale],[Yr.General.EnableWboit,cc.enableWboit],[Yr.Viewport.ShowExpand,cc.viewportShowExpand],[Yr.Viewport.ShowSelectionMode,cc.viewportShowSelectionMode],[Yr.Download.DefaultPdbProvider,cc.pdbProvider],[Yr.Structure.DefaultRepresentationPresetParams,{theme:{globalName:"af-confidence",carbonByChainId:!1,focus:{name:"element-symbol",params:{carbonByChainId:!1}}}}]]},o=typeof t=="string"?document.getElementById(t):t;if(!o)throw new Error(`Could not get element with id '${t}'`);this.plugin=Wft(o,a),this.plugin.behaviors.interaction.click.subscribe(s=>{if(Re.is(s.current.loci)){const u=Ze.create();Re.getFirstLocation(s.current.loci,u);const l=lt.residue.label_seq_id(u),c=lt.chain.auth_asym_id(u);r([{position:l,chain:c}])}}),_t.Canvas3D.SetSettings(this.plugin,{settings:s=>{s.renderer.backgroundColor=at(16777215)}}),n&&(_t.Canvas3D.SetSettings(this.plugin,{settings:s=>{s.trackball.bindings.scrollZoom.triggers[0].modifiers.control=!0}}),this.plugin.canvas3dContext.input.noScroll=!1,o.addEventListener("wheel",s=>{s.ctrlKey&&s.preventDefault()},!1))}clear(t){this.plugin.clear(),t&&this.showMessage("Loading",t)}loadPdb(t,r){const n=yR.createDefaultParams(this.plugin.state.data.root.obj,this.plugin),i=this.plugin.config.get(Yr.Download.DefaultPdbProvider);return this.plugin.runTask(this.plugin.state.data.applyAction(yR,{source:{name:"pdb",params:{provider:{id:t,server:{name:i,params:SF[i].defaultValue}},options:Object.assign(Object.assign({},n.source.params.options),{representationParams:r==null?void 0:r.representationParams})}}})).then(()=>{this.clearMessages()})}loadCifUrl(t,r){return ipt(this,void 0,void 0,function*(){const{plugin:n}=this,i=yield n.builders.data.download({url:r,isBinary:!1},{state:{isGhost:!0}}),a=yield n.builders.structure.parseTrajectory(i,"mmcif");return this.plugin.builders.structure.hierarchy.applyPreset(a,"all-models",{useDefaultIfSingleModel:!0}).then(()=>this.clearMessages())})}highlight(t){var r,n;const i=(n=(r=this.plugin.managers.structure.hierarchy.current.structures[0])===null||r===void 0?void 0:r.cell.obj)===null||n===void 0?void 0:n.data;if(!i)return;const a=Vi.getStructureSelection(s=>s.struct.generator.atomGroups({"residue-test":s.core.logic.or(t.map(({start:u,end:l,chain:c})=>s.core.logic.and([s.core.rel.inRange([s.struct.atomProperty.macromolecular.label_seq_id(),u,l]),s.core.rel.eq([s.struct.atomProperty.macromolecular.auth_asym_id(),c])])))}),i),o=mt.toLociWithSourceUnits(a);this.plugin.managers.camera.focusLoci(o),this.plugin.managers.interactivity.lociSelects.selectOnly({loci:o})}clearHighlight(){this.plugin.managers.interactivity.lociSelects.deselectAll(),_t.Camera.Reset(this.plugin,{})}showMessage(t,r,n){this.clearMessages(),_t.Toast.Show(this.plugin,{title:t,message:r,timeoutMs:n})}clearMessages(){_t.Toast.Hide(this.plugin)}handleResize(){this.plugin.layout.events.updated.next()}}class T1 extends Error{}const VG=(e,t,r,n)=>{if(!r)return[];if(!e||!t||Number.isNaN(e)||Number.isNaN(t))throw new T1("Invalid start, end coordinates");const i=Object.entries(zg(r,a=>a.chain_id)).map(([a,o])=>{let s=null,u=null;for(const c of o){if(c.unp_end-c.unp_start!==c.end.residue_number-c.start.residue_number)throw new T1("Mismatch between protein sequence and structure residues");const d=n==="UP_PDB"?c.unp_start:c.start.residue_number,f=n==="UP_PDB"?c.unp_end:c.end.residue_number;e>=d&&e<=f&&(s=c),t>=d&&t<=f&&(u=c)}if(s===null||u===null)return null;const l=n==="UP_PDB"?1:-1;return{entity:s.entity_id,chain:s.chain_id,start:e+l*(s.start.residue_number-s.unp_start),end:t+l*(u.start.residue_number-u.unp_start)}}).filter(Boolean);if(!i.length)throw new T1("Start or end coordinate outside of mapping range");return i};var vI=globalThis&&globalThis.__awaiter||function(e,t,r,n){function i(a){return a instanceof r?a:new r(function(o){o(a)})}return new(r||(r=Promise))(function(a,o){function s(c){try{l(n.next(c))}catch(d){o(d)}}function u(c){try{l(n.throw(c))}catch(d){o(d)}}function l(c){c.done?a(c.value):i(c.value).then(s,u)}l((n=n.apply(e,t||[])).next())})};const HG=(e,t)=>{const{ga:r}=window;r&&r("send","event","protvista-structure",e,t)};class Vw extends HTMLElement{constructor(){super(),this._uniProtMappingUrl="https://www.ebi.ac.uk/pdbe/api/mappings/uniprot/",this._alphaFoldMappingUrl="https://alphafold.ebi.ac.uk/api/prediction/",this._planHighlight=this._planHighlight.bind(this),this.propagateHighlight=this.propagateHighlight.bind(this)}static get is(){return"protvista-structure"}get css(){return`
    protvista-structure h4 {
      display: inline;
      margin-right: 1em;
    }
      
    .structure-viewer-container {
      position: relative;
      height: ${this._height};
    }
    `}get accession(){return this._accession}set accession(t){this.setAttribute("accession",t)}get structureId(){return this._structureId}set structureId(t){this.setAttribute("structureid",t),this._structureId=t}get height(){return this.getAttribute("height")}set height(t){this.setAttribute("height",t),this._height=t}updateUrls(){this._uniProtMappingUrl=this.getAttribute("uniprot-mapping-url")||this._uniProtMappingUrl,this._alphaFoldMappingUrl=this.getAttribute("alphafold-mapping-url")||this._alphaFoldMappingUrl,this._customDownloadUrl=this.getAttribute("custom-download-url")}connectedCallback(){this.innerHTML="";const t=this.closest("protvista-manager");t&&"register"in t&&"unregister"in t&&(this.manager=t,this.manager.register(this)),this._structureId=this.getAttribute("structureid"),this._accession=this.getAttribute("accession"),this._height=this.getAttribute("height")||"480px",this._highlight=this.getAttribute("highlight")&&Vw._parseHighlight(this.getAttribute("highlight")),this.updateUrls();const r=document.createElement("style");r.innerHTML=this.css,this.appendChild(r);const n=document.createElement("div");n.className="structure-viewer-container",n.id="structure-viewer-instance",this.appendChild(n),this._structureViewer=new apt(n,this.propagateHighlight,this.hasAttribute("use-ctrl-to-zoom"))}disconnectedCallback(){this.manager&&this.manager.unregister(this)}static get observedAttributes(){return["highlight","structureid","accession","height"]}static _parseHighlight(t){return t?t.split(",").map(n=>{const[i,a]=n.split(":");return{start:Number(i),end:Number(a)}}):[]}attributeChangedCallback(t,r,n){if(r!==n){switch(t){case"structureid":n!==null&&(this._structureId=n),this.selectMolecule();break;case"accession":this._accession=n,this.selectMolecule();break;case"highlight":this._highlight=Vw._parseHighlight(this.getAttribute("highlight"));break;case"height":this._height=n;break}this._planHighlight()}}_planHighlight(){this._plannedRender||(this._plannedRender=!0,requestAnimationFrame(()=>{this._plannedRender=!1,this._selectedMolecule&&this.highlightChain()}))}loadPDBEntry(t){var r;return vI(this,void 0,void 0,function*(){(r=this._structureViewer)===null||r===void 0||r.clear(t);try{HG("load-PDBe",t);const{payload:n}=yield w9(`${this._uniProtMappingUrl}${t}`);return n}catch(n){throw this._structureViewer.showMessage("Error","Couldn't load PDB entry"),n}})}loadAFEntry(t){var r;return vI(this,void 0,void 0,function*(){(r=this._structureViewer)===null||r===void 0||r.clear(t);try{const{payload:n}=yield w9(`${this._alphaFoldMappingUrl}${t}`);return HG("load-AF",t),n}catch(n){throw this._structureViewer.showMessage("Error","Couldn't load AF entry"),n}})}isAF(){return this._structureId.startsWith("AF-")}selectMolecule(){var t;return vI(this,void 0,void 0,function*(){if(!this._structureId||!this._accession)return;this.updateUrls();let r;if(this.isAF()){const i=(yield this.loadAFEntry(this._accession)).find(a=>a.entryId===this._structureId);yield this._structureViewer.loadCifUrl(this._structureId,i.cifUrl)}else{const n=yield this.loadPDBEntry(this._structureId);r=(t=Object.values(n)[0].UniProt[this._accession])===null||t===void 0?void 0:t.mappings,this._customDownloadUrl?yield this._structureViewer.loadCifUrl(this._structureId,`${this._customDownloadUrl}${this._structureId.toLowerCase()}.cif`):yield this._structureViewer.loadPdb(this._structureId.toLowerCase())}this._selectedMolecule={id:this._structureId,mappings:r},this._planHighlight()})}propagateHighlight(t){if(!(t!=null&&t.length)||t.some(a=>!Number.isInteger(a.position)))return;let r;try{r=E9(t,a=>VG(a.position,a.position,this._selectedMolecule.mappings,"PDB_UP").filter(o=>o.chain===a.chain)).filter(Boolean)}catch(a){if(a instanceof T1){this._structureViewer.showMessage("Error",a.message);return}throw a}if(!r.length){this._structureViewer.showMessage("Error","Residue outside of sequence range");return}const n=r.map(a=>`${a.start}:${a.end}`);this.setAttribute("highlight",n.join(","));const i=new CustomEvent("change",{detail:{highlight:n},bubbles:!0,cancelable:!0});this.dispatchEvent(i)}highlightChain(){if(!this._highlight||typeof this._highlight=="string")return;let t;try{t=E9(this._highlight,({start:r,end:n})=>this.isAF()?{start:r,end:n,chain:"A"}:VG(r,n,this._selectedMolecule.mappings,"UP_PDB")).filter(Boolean)}catch(r){if(r instanceof T1){this._structureViewer.clearHighlight(),this._structureViewer.showMessage("Error",r.message);return}throw r}if(!(t!=null&&t.length)){this._structureViewer.clearHighlight();return}this._structureViewer.highlight(t),this._structureViewer.clearMessages()}}const opt=e=>{const t=new Map;return e.forEach(r=>{r.dataset.filter&&t.set(r.dataset.filter,new Set)}),t},spt=(e,t,r,n)=>!r&&t===n||!n&&e===r||e<=r&&t>=n,upt=(e,t,r,n)=>e>n||t<r,BR=Js`pd-group-trigger__expanded`,Hw=Js`active`,I1=Js`transparent`,UR=Js`overlapped`,jR=Js`hidden`,lpt=Js`
  protvista-datatable table {
    width: 100%;
    padding: 0;
    margin: 0;
    border-spacing: 0;
  }

  protvista-datatable table th {
    position: sticky;
    position: -webkit-sticky;
    position: -moz-sticky;
    position: -ms-sticky;
    position: -o-sticky;
    text-align: left;
    vertical-align: top;
    background-color: var(--protvista-datable__header-background, #fff);
    color: var(--protvista-datable__header-text, #393b42);
    text-overflow: ellipsis;
    top: 0;
    text-transform: uppercase;
    z-index: 400;
  }

  protvista-datatable table th .filter-wrap {
    display: flex;
    flex-direction: column;
  }

  protvista-datatable table th .filter-wrap select {
    width: fit-content;
  }

  protvista-datatable table td,
  protvista-datatable table th {
    padding: 0.2rem;
    border-bottom: 1px solid #c2c4c4;
  }

  protvista-datatable table tr:hover:not(.${Hw}):not(.${I1}) {
    background-color: var(--protvista-datatable__hover, #f1f1f1);
  }

  protvista-datatable table td {
    cursor: pointer;
  }

  protvista-datatable table .pd-group-trigger {
    width: 1rem;
  }

  protvista-datatable table .pd-group-trigger button {
    background: none;
    border: none;
    padding: 0.2rem; // increase click area
    position: relative;
    text-decoration: none;
    cursor: pointer;
    transition: background 250ms ease-in-out, transform 150ms ease;
    -webkit-appearance: none;
    -moz-appearance: none;
  }

  protvista-datatable table .pd-group-trigger button:before {
    display: inline-block;
    content: " ";
    border-style: solid;
    border-width: 0.4rem 0 0.4rem 0.6rem;
    border-color: transparent transparent transparent #161d39;
    transition-duration: 0.3s;
    transition-property: transform;
  }

  protvista-datatable table .pd-group-trigger button.${BR}:before {
    transform: rotate(90deg);
  }

  protvista-datatable table td:nth-child(1) {
    border-left: 0.5rem solid transparent;
  }

  protvista-datatable table .${UR} td:nth-child(1) {
    border-left: 0.5rem solid
      var(--protvista-datatable__overlapped, rgba(255, 0, 0, 0.8));
  }

  protvista-datatable table .${Hw} {
    background-color: var(
      --protvista-datatable__active,
      rgba(255, 235, 59, 0.3)
    ) !important;
  }

  protvista-datatable table .${I1} {
    opacity: 0.2;
  }
  protvista-datatable table .${I1} td:hover {
    cursor: default;
    background-color: inherit;
  }

  protvista-datatable table .${jR} {
    display: none;
  }

  protvista-datatable table tr[data-group-for] td {
    padding-left: 1.7rem;
    padding-bottom: 0.7rem;
  }

  protvista-datatable table .odd {
    background-color: var(--protvista-datatable__odd, #e4e8eb);
  }

  protvista-datatable table .even {
    background-color: var(--protvista-datatable__even, #fff);
  }
`;class cpt extends Ap{constructor(){super(),this.height="25rem",this.visibleChildren=[],this.noScrollToRow=!1,this.noDeselect=!1,this.expandTable=!1,this.scrollFilter=new eQ(this),this.wheelListener=t=>this.scrollFilter.wheel(t),this.eventHandler=this.eventHandler.bind(this)}static get is(){return"protvista-datatable"}connectedCallback(){super.connectedCallback();const t=this.querySelector("table tbody");if(!t)return;this.mutationObserver=new MutationObserver(()=>{this.init()}),this.mutationObserver.observe(t,{characterData:!0,childList:!0,subtree:!0});const r=document.createElement("style");r.innerHTML=lpt.toString(),document.querySelector("head").appendChild(r),this.closest("protvista-manager")&&(this.manager=this.closest("protvista-manager"),this.manager.register(this)),this.noDeselect||document.addEventListener("click",this.eventHandler),this.classList.add("feature"),this.hasAttribute("filter-scroll")&&document.addEventListener("wheel",this.wheelListener),this.init()}disconnectedCallback(){super.disconnectedCallback(),this.manager&&this.manager.unregister(this),document.removeEventListener("click",this.eventHandler),document.removeEventListener("wheel",this.wheelListener),this.mutationObserver.disconnect()}init(){if(this.columns=this.querySelectorAll("table thead th"),!this.querySelector(".pd-group-column-header")){const t=document.createElement("th");t.classList.add("pd-group-column-header");const r=this.querySelector("table thead tr");r.insertBefore(t,r.firstChild)}this.rows=this.querySelectorAll("table tbody tr"),this.rows.forEach(t=>{if(!t.dataset.groupFor&&!t.querySelector(".pd-group-trigger")){const r=t.insertCell(0);if(r.classList.add("pd-group-trigger"),this.querySelector("[data-group-for]")){const n=document.createElement("button");n.dataset.triggerId=t.dataset.id,r.appendChild(n),n.addEventListener("click",i=>this.handleGroupToggle(i))}}t.addEventListener("click",r=>this.handleClick(r,t))}),this.updateRowStyling(),this.selectedFilters=new Map,this.filterMap=this.parseDataForFilters(),this.addFilterOptions()}parseDataForFilters(){const t=opt(this.columns);return this.rows.forEach(r=>{r.childNodes.forEach(i=>{var a;!((a=i.dataset)===null||a===void 0)&&a.filter&&t.get(i.dataset.filter).add(i.dataset.filterValue)})}),t}addFilterOptions(){this.columns.forEach(t=>{if(t.dataset.filter){let r,n;t.querySelector(".filter-wrap")?(r=t.querySelector("select"),n=t.querySelector(".filter-wrap")):(n=document.createElement("span"),n.className="filter-wrap",n.innerHTML=t.innerHTML,r=document.createElement("select"),r.dataset.testid="select",r.onchange=i=>this.handleFilterChange(i,t.dataset.filter)),r.innerHTML="<option  selected value>-- Select --</option>",this.filterMap.get(t.dataset.filter).forEach(i=>{const a=document.createElement("option");a.value=i,a.label=i,a.dataset.testid="select-option",r.appendChild(a)}),t.innerHTML="",n.appendChild(r),t.appendChild(n)}})}eventHandler(t){const r=t.target;!r.closest("protvista-datatable")&&!r.closest(".feature")&&(this.selectedid=null,this.highlight=null)}static get properties(){return{highlight:{converter:t=>{if(t&&t!=="null")try{const r=t.split(":").map(n=>Number(n));if(r.length!==2)throw new Error("Highlight should be only 2 values separated by ':'.");return[r[0],r[1]]}catch(r){console.error("Invalid highlight coordinates:",r)}return null}},height:{type:String},displayStart:{type:Number},displayEnd:{type:Number},visibleChildren:{type:Array},selectedid:{type:String},noScrollToRow:{type:Boolean},noDeselect:{type:Boolean},expandTable:{type:Boolean}}}static get styles(){return Js`
      :host {
        display: block;
      }

      .protvista-datatable-container {
        overflow-y: auto;
        // Note: overflow-x was set to 'hidden' but changing
        // to 'auto' doesn't seem to be an issue.
        overflow-x: auto;
        scrollbar-gutter: stable;
      }

      :host([scrollable="true"]) .protvista-datatable-container {
        overflow-y: auto;
      }

      :host([scrollable="false"]) .protvista-datatable-container {
        overflow-y: hidden;
      }
    `}handleGroupToggle(t){const{triggerId:r}=t.target.dataset;this.visibleChildren.includes(r)?(this.visibleChildren=this.visibleChildren.filter(n=>n!==r),t.target.classList.remove(BR.cssText)):(this.visibleChildren=[...this.visibleChildren,r],t.target.classList.add(BR.cssText))}handleClick(t,r){if(r.classList.contains("transparent"))return;const{id:n,start:i,end:a}=r.dataset;this.selectedid=n;const o={};i&&a&&(o.highlight=`${i}:${a}`),this.selectedid&&(o.selectedid=this.selectedid),this.dispatchEvent(new CustomEvent("change",{detail:o,bubbles:!0,cancelable:!0}))}handleFilterChange(t,r){const{selectedOptions:n}=t.target,{value:i}=n.item(0);i?this.selectedFilters.set(r,i):this.selectedFilters.delete(r),this.updateRowStyling()}isRowVisible(t){const r=!t.dataset.groupFor||t.dataset.groupFor&&this.visibleChildren.includes(t.dataset.groupFor);if(!this.selectedFilters||this.selectedFilters.size===0)return r;for(const[n,i]of this.selectedFilters){let a;if(t.dataset.groupFor?a=this.querySelector(`[data-id="${t.dataset.groupFor}"]`).querySelector(`[data-filter="${n}"]`):a=t.querySelector(`[data-filter="${n}"]`),a&&a.dataset.filterValue!==i)return!1}return r}updateRowStyling(){var t;let r=0;(t=this.rows)===null||t===void 0||t.forEach(n=>{this.isRowVisible(n)?n.classList.remove(jR.cssText):n.classList.add(jR.cssText),n.dataset.groupFor||r++;const{start:a,end:o}=n.dataset;if(n.classList.add(r%2===0?"even":"odd"),this.selectedid&&(this.selectedid===n.dataset.id||n.dataset.groupFor===this.selectedid)?n.classList.add(Hw.cssText):n.classList.remove(Hw.cssText),upt(this.displayStart,this.displayEnd,Number(a),Number(o))?n.classList.add(I1.cssText):n.classList.remove(I1.cssText),this.highlight&&spt(this.highlight[0],this.highlight[1],Number(a),Number(o))?n.classList.add(UR.cssText):n.classList.remove(UR.cssText),n.dataset.groupFor){const s=this.columns.length+1;n.cells[0].colSpan=s-n.cells.length+1}})}scrollIntoView(){if(!this.selectedid)return;const t=this.querySelector(`[data-id="${this.selectedid}"]`);t==null||t.scrollIntoView({behavior:"smooth",block:"center"})}render(){const t=this.expandTable||this.hasAttribute("expand-table")?"height: auto":`max-height:${this.height}`;return Gr`
      <div class="protvista-datatable-container" style=${t}>
        <slot></slot>
      </div>
    `}updated(){this.updateRowStyling(),this.noScrollToRow||this.scrollIntoView()}}const Ps=function(e,t){customElements.get(e)||customElements.define(e,t)},Foe="/assets/spinner-374aaf14.svg",dpt="/assets/download-325e4c97.svg",Noe=Js`
  .protvista-loader {
    display: flex;
    justify-content: center;
    padding: 4rem 0;
  }
  .protvista-loader svg {
    height: 100px;
  }

  .protvista-no-results {
    background-color: #e4e8eb;
    display: flex;
    justify-content: center;
    padding: 1rem;
    font-size: 0.8rem;
  }
`,fpt=[{name:"PDBe",link:"https://www.ebi.ac.uk/pdbe-srv/view/entry/"},{name:"RCSB-PDB",link:"https://www.rcsb.org/structure/"},{name:"PDBj",link:"https://pdbj.org/mine/summary/"},{name:"PDBsum",link:"https://www.ebi.ac.uk/pdbsum/"}],ppt="https://alphafold.ebi.ac.uk/entry/",hpt=e=>e.dbReferences.filter(t=>t.type==="PDB").sort((t,r)=>t.id.localeCompare(r.id)).map(({id:t,properties:r})=>{if(!r)return;const{chains:n,resolution:i,method:a}=r;let o,s;if(n){const l=n.split("=");l.length===2&&([o,s]=l)}return{id:t,source:"PDB",method:a,resolution:!i||i==="-"?void 0:i,downloadLink:`https://www.ebi.ac.uk/pdbe/entry-files/download/pdb${t.toLowerCase()}.ent`,chain:o,positions:s,protvistaFeatureId:t}}).filter(t=>t!==void 0),vpt=e=>e.map(t=>({id:t.entryId,source:"AlphaFold",method:"Predicted",positions:`${t.uniprotStart}-${t.uniprotEnd}`,protvistaFeatureId:t.entryId,downloadLink:t.pdbUrl})),mpt=Gr`
  <strong>Model Confidence:</strong>
  <ul class="no-bullet">
    <li>
      <span class="af-legend" style="background-color: rgb(0, 83, 214)"></span>
      Very high (pLDDT > 90)
    </li>
    <li>
      <span
        class="af-legend"
        style="background-color: rgb(101, 203, 243)"
      ></span>
      Confident (90 > pLDDT > 70)
    </li>
    <li>
      <span class="af-legend" style="background-color:rgb(255, 219, 19)"></span>
      Low (70 > pLDDT > 50)
    </li>
    <li>
      <span class="af-legend" style="background-color:rgb(255, 125, 69)"></span>
      Very low (pLDDT < 50)
    </li>
  </ul>
  <p class="small">
    AlphaFold produces a per-residue confidence score (pLDDT) between 0 and 100.
    Some regions with low pLDDT may be unstructured in isolation.
  </p>
`,mI="protvista-styles";class gpt extends Ap{constructor(){super(),Ps("protvista-structure",Vw),Ps("protvista-datatable",cpt),this.loading=!0,this.onTableRowClick=this.onTableRowClick.bind(this),this.addStyles()}static get properties(){return{accession:{type:String},structureId:{type:String},data:{type:Object},loading:{type:Boolean}}}async connectedCallback(){if(super.connectedCallback(),!this.accession)return;const t=`https://www.ebi.ac.uk/proteins/api/proteins/${this.accession}`,r=`https://alphafold.ebi.ac.uk/api/prediction/${this.accession}`,n=[];await Promise.all([t,r].map(s=>kQ(s).then(u=>n[s]=u.payload,u=>console.warn(u)))),this.loading=!1;const i=hpt(n[t]||[]),a=vpt(n[r]||[]),o=[...i,...a];!o||!o.length||(this.data=o)}disconnectedCallback(){this.removeStyles()}updated(){var t;const r=this.querySelector("protvista-datatable");!(r!=null&&r.selectedid)&&(!((t=this.data)===null||t===void 0)&&t[0])&&(this.onTableRowClick({id:this.data[0].id}),r.selectedid=this.structureId)}addStyles(){var t;if(!document.getElementById(mI)){const r=document.createElement("style");r.id=mI,r.innerHTML=`
      ${Noe.toString()}
      ${this.cssStyle}
      `,(t=document.querySelector("head"))===null||t===void 0||t.append(r)}}removeStyles(){const t=document.getElementById(mI);t&&t.remove()}onTableRowClick({id:t}){this.structureId=t,this.structureId.startsWith("AF-")?this.metaInfo=mpt:this.metaInfo=void 0}get cssStyle(){return Js`
      .protvista-uniprot-structure__structure {
        display: flex;
      }
      .protvista-uniprot-structure__meta {
        flex: 1;
        padding: 1rem;
      }
      .protvista-uniprot-structure__structure protvista-structure {
        z-index: 40000;
        width: 100%;
        flex: 4;
      }
      .protvista-uniprot-structure__meta .small {
        font-size: 0.75rem;
      }
      .protvista-uniprot-structure__meta .no-bullet {
        list-style: none;
        padding: 0;
        margin: 0;
      }
      .protvista-uniprot-structure__meta .no-bullet li {
        padding: 0;
        margin: 0.5rem 0;
      }
      .protvista-uniprot-structure__meta .af-legend::before {
        content: '';
        margin: 0;
        display: inline-block;
        width: 20px;
        height: 16px;
      }
      .download-link svg {
        width: 1rem;
      }
    `}createRenderRoot(){return this}render(){var t;return Gr`
      <div class="protvista-uniprot-structure">
        <div class="protvista-uniprot-structure__structure">
          ${this.metaInfo?Gr`<div class="protvista-uniprot-structure__meta">
                ${this.metaInfo}
              </div>`:Gr``}
          ${this.structureId?Gr`<protvista-structure
                structureid=${this.structureId}
                accession=${this.accession}
              ></protvista-structure>`:Gr``}
        </div>
        <div class="class="protvista-uniprot-structure__table">
        ${this.data&&this.data.length?Gr`<protvista-datatable noScrollToRow noDeselect filter-scroll>
              <table>
                <thead>
                  <tr>
                    <th data-filter="source">Source</th>
                    <th>Identifier</th>
                    <th data-filter="method">Method</th>
                    <th>Resolution</th>
                    <th>Chain</th>
                    <th>Positions</th>
                    <th>Links</th>
                    <th><!--Download--></th>
                  </tr>
                </thead>
                <tbody>
                  ${(t=this.data)===null||t===void 0?void 0:t.map(({source:r,id:n,method:i,resolution:a,chain:o,positions:s,downloadLink:u})=>Gr`<tr
                      data-id="${n}"
                      @click="${()=>this.onTableRowClick({id:n})}"
                    >
                      <td data-filter="source" data-filter-value="${r}">
                        <strong>${r}</strong>
                      </td>
                      <td>${n}</td>
                      <td data-filter="method" data-filter-value="${i}">
                        ${i}
                      </td>
                      <td>${a?a.replace("A",""):""}</td>
                      <td>${o||""}</td>
                      <td>${s||""}</td>
                      <td>
                        ${r==="PDB"?Gr`
                              ${fpt.map(l=>Gr`
                                  <a href="${l.link}${n}"
                                    >${l.name}</a
                                  >
                                `).reduce((l,c)=>Gr` ${l}  ${c} `)}
                            `:Gr`<a href="${ppt}${this.accession}"
                              >AlphaFold</a
                            >`}
                      </td>
                      <td>
                        ${u?Gr`<a href="${u}" class="download-link"
                              >${VM`${$M(dpt)}`}</a
                            >`:""}
                      </td>
                    </tr>`)}
                </tbody>
              </table>
            </protvista-datatable>`:Gr``}
        ${this.loading?Gr`<div class="protvista-loader">
              ${VM`${$M(Foe)}`}
            </div>`:Gr``}
        ${!this.data&&!this.loading?Gr`<div class="protvista-no-results">
              No structure information available for ${this.accession}
            </div>`:Gr``}
      </div>
    `}}var ypt={exports:{}};(function(e){(function(t,r,n){e.exports?e.exports=n():r[t]=n()})("urljoin",fh,function(){function t(r){var n=[];if(r.length===0)return"";if(typeof r[0]!="string")throw new TypeError("Url must be a string. Received "+r[0]);if(r[0].match(/^[^/:]+:\/*$/)&&r.length>1){var i=r.shift();r[0]=i+r[0]}r[0].match(/^file:\/\/\//)?r[0]=r[0].replace(/^([^/:]+):\/*/,"$1:///"):r[0]=r[0].replace(/^([^/:]+):\/*/,"$1://");for(var a=0;a<r.length;a++){var o=r[a];if(typeof o!="string")throw new TypeError("Url must be a string. Received "+o);o!==""&&(a>0&&(o=o.replace(/^[\/]+/,"")),a<r.length-1?o=o.replace(/[\/]+$/,""):o=o.replace(/[\/]+$/,"/"),n.push(o))}var s=n.join("/");s=s.replace(/\/(\?|&|#[^!])/g,"$1");var u=s.split("?");return s=u.shift()+(u.length>0?"?":"")+u.join("&"),s}return function(){var r;return typeof arguments[0]=="object"?r=arguments[0]:r=[].slice.call(arguments),t(r)}})})(ypt);var bpt={exports:{}};(function(e,t){(function(r,n){n()})(fh,function(){function r(l,c){return typeof c>"u"?c={autoBom:!1}:typeof c!="object"&&(console.warn("Deprecated: Expected third argument to be a object"),c={autoBom:!c}),c.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(l.type)?new Blob(["\uFEFF",l],{type:l.type}):l}function n(l,c,d){var f=new XMLHttpRequest;f.open("GET",l),f.responseType="blob",f.onload=function(){u(f.response,c,d)},f.onerror=function(){console.error("could not download file")},f.send()}function i(l){var c=new XMLHttpRequest;c.open("HEAD",l,!1);try{c.send()}catch{}return 200<=c.status&&299>=c.status}function a(l){try{l.dispatchEvent(new MouseEvent("click"))}catch{var c=document.createEvent("MouseEvents");c.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),l.dispatchEvent(c)}}var o=typeof window=="object"&&window.window===window?window:typeof self=="object"&&self.self===self?self:typeof fh=="object"&&fh.global===fh?fh:void 0,s=o.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),u=o.saveAs||(typeof window!="object"||window!==o?function(){}:"download"in HTMLAnchorElement.prototype&&!s?function(l,c,d){var f=o.URL||o.webkitURL,p=document.createElement("a");c=c||l.name||"download",p.download=c,p.rel="noopener",typeof l=="string"?(p.href=l,p.origin===location.origin?a(p):i(p.href)?n(l,c,d):a(p,p.target="_blank")):(p.href=f.createObjectURL(l),setTimeout(function(){f.revokeObjectURL(p.href)},4e4),setTimeout(function(){a(p)},0))}:"msSaveOrOpenBlob"in navigator?function(l,c,d){if(c=c||l.name||"download",typeof l!="string")navigator.msSaveOrOpenBlob(r(l,d),c);else if(i(l))n(l,c,d);else{var f=document.createElement("a");f.href=l,f.target="_blank",setTimeout(function(){a(f)})}}:function(l,c,d,f){if(f=f||open("","_blank"),f&&(f.document.title=f.document.body.innerText="downloading..."),typeof l=="string")return n(l,c,d);var p=l.type==="application/octet-stream",v=/constructor/i.test(o.HTMLElement)||o.safari,h=/CriOS\/[\d]+/.test(navigator.userAgent);if((h||p&&v||s)&&typeof FileReader<"u"){var m=new FileReader;m.onloadend=function(){var b=m.result;b=h?b:b.replace(/^data:[^;]*;/,"data:attachment/file;"),f?f.location.href=b:location=b,f=null},m.readAsDataURL(l)}else{var g=o.URL||o.webkitURL,y=g.createObjectURL(l);f?f.location=y:location.href=y,f=null,setTimeout(function(){g.revokeObjectURL(y)},4e4)}});o.saveAs=u.saveAs=u,e.exports=u})})(bpt);const xc={UPDiseaseColor:"#990000",UPNonDiseaseColor:"#99cc00",predictedColor:"#4c8acd",othersColor:"#009e73"},xpt={uncertain:[/uncertain/i,/conflicting/i,/unclassified/i,/risk factor/i]},Spt=(e,t)=>e.some(({type:r})=>t.some(n=>n.test(r))),rh=(e,t)=>e.map(r=>{const n=r.variants.filter(i=>t(i));return{...r,variants:[...n]}}),Boe=[{name:"disease",type:{name:"consequence",text:"Filter Consequence"},options:{labels:["Likely disease"],colors:[xc.UPDiseaseColor]},filterData:e=>rh(e,t=>{var r;return(r=t.association)===null||r===void 0?void 0:r.some(n=>n.disease)})},{name:"predicted",type:{name:"consequence",text:"Filter Consequence"},options:{labels:["Predicted consequence"],colors:[xc.predictedColor]},filterData:e=>rh(e,t=>t.hasPredictions)},{name:"nonDisease",type:{name:"consequence",text:"Filter Consequence"},options:{labels:["Likely benign"],colors:[xc.UPNonDiseaseColor]},filterData:e=>rh(e,t=>{var r;return(r=t.association)===null||r===void 0?void 0:r.some(n=>n.disease===!1)})},{name:"uncertain",type:{name:"consequence",text:"Filter Consequence"},options:{labels:["Uncertain"],colors:[xc.othersColor]},filterData:e=>rh(e,t=>typeof t.clinicalSignificances>"u"&&!t.hasPredictions||t.clinicalSignificances&&Spt(t.clinicalSignificances,xpt.uncertain))},{name:"UniProt",type:{name:"provenance",text:"Filter Provenance"},options:{labels:["UniProt reviewed"],colors:["#9f9f9f"]},filterData:e=>rh(e,t=>t.xrefNames&&(t.xrefNames.includes("uniprot")||t.xrefNames.includes("UniProt")))},{name:"ClinVar",type:{name:"provenance",text:"Filter Provenance"},options:{labels:["ClinVar reviewed"],colors:["#9f9f9f"]},filterData:e=>rh(e,t=>t.xrefNames&&(t.xrefNames.includes("ClinVar")||t.xrefNames.includes("clinvar")))},{name:"LSS",type:{name:"provenance",text:"Filter Provenance"},options:{labels:["Large scale studies"],colors:["#9f9f9f"]},filterData:e=>rh(e,t=>t.sourceType==="large_scale_study"||t.sourceType==="mixed")}],bS=(e,t)=>{const r=[{variants:[t]}],n=Boe.find(i=>i.name===e);return n?n.filterData(r)[0].variants.length>0:!1},Cpt=e=>bS("disease",e)?xc.UPDiseaseColor:bS("nonDisease",e)?xc.UPNonDiseaseColor:bS("uncertain",e)?xc.othersColor:bS("predicted",e)?xc.predictedColor:xc.othersColor,_pt=Js`
  protvista-tooltip a {
    text-decoration: underline;
    color: #fff;
  }
  .track-content {
    width: 80vw;
  }

  .nav-container,
  .category__track {
    display: flex;
    margin-bottom: 0.1rem;
  }

  .category {
    display: none;
    margin-bottom: 0.1rem;
  }

  .category-label,
  .track-label,
  .action-buttons,
  .credits {
    width: 20vw;
    padding: 0.5em;
  }

  .action-buttons {
    display: flex;
    justify-content: flex-end;
    align-items: flex-end;
  }

  .category-label {
    background-color: #b2f5ff;
    cursor: pointer;
  }

  .category-label::before {
    content: ' ';
    display: inline-block;
    width: 0;
    height: 0;
    border-top: 5px solid transparent;
    border-bottom: 5px solid transparent;
    border-left: 5px solid #333;
    margin-right: 5px;
    -webkit-transition: all 0.1s;
    /* Safari */
    -o-transition: all 0.1s;
    transition: all 0.1s;
  }

  .category-label.open::before {
    content: ' ';
    display: inline-block;
    width: 0;
    height: 0;
    border-left: 5px solid transparent;
    border-right: 5px solid transparent;
    border-top: 5px solid #333;
    margin-right: 5px;
  }

  .track-label {
    background-color: #d9faff;
  }

  protvista-track {
    border-top: 1px solid #d9faff;
  }

  .feature {
    cursor: pointer;
  }
`,wpt=GPe,Ept=qPe,Apt=t4e,Ppt=l4e,Tpt=c4e,Ipt=p4e,GG=Boe,qG=Cpt,Mpt={"protvista-feature-adapter":wpt,"protvista-interpro-adapter":Tpt,"protvista-proteomics-adapter":Ept,"protvista-structure-adapter":Apt,"protvista-variation-adapter":Ppt,"protvista-proteomics-ptm-adapter":Ipt};class Dpt extends Ap{constructor(){super(),this.displayCoordinates={},this.openCategories=[],this.notooltip=!1,this.nostructure=!1,this.hasData=!1,this.loading=!0,this.data={},this.rawData={},this.displayCoordinates={},this.addStyles()}static get properties(){return{suspend:{type:Boolean,reflect:!0},accession:{type:String,reflect:!0},sequence:{type:String},data:{type:Object},openCategories:{type:Array},config:{type:Object},notooltip:{type:Boolean,reflect:!0},nostructure:{type:Boolean,reflect:!0}}}addStyles(){var t;const r=document.createElement("style");r.innerHTML=`${_pt.toString()} ${Noe.toString()}`,(t=document.querySelector("head"))===null||t===void 0||t.append(r)}registerWebComponents(){Ps("protvista-navigation",w_e),Ps("protvista-tooltip",E_e),Ps("protvista-track",ov),Ps("protvista-interpro-track",f1),Ps("protvista-sequence",PPe),Ps("protvista-variation",WO),Ps("protvista-variation-graph",DPe),Ps("protvista-filter",RPe),Ps("protvista-manager",C_),Ps("protvista-uniprot-structure",gpt)}async _loadData(){const t=this.accession;if(t&&this.config){const r=this.config.categories.map(({tracks:i})=>i.map(({data:a})=>a[0].url)).flat(),n=[...new Set(r)];await Promise.all(n.map(i=>kQ(i.replace("{accession}",t)).then(a=>{var o,s;this.rawData[i]=a.payload,!this.hasData&&(!((s=(o=a.payload)===null||o===void 0?void 0:o.features)===null||s===void 0)&&s.length)&&(this.hasData=!0)},a=>console.warn(a)).catch(a=>{console.log(a)}))),this.config.categories.map(({name:i,tracks:a,trackType:o})=>{const s=a.map(({data:u,name:l,filter:c})=>{const{url:d,adapter:f}=u[0],p=this.rawData[d]||[];if(!p||f==="protvista-variation-adapter"&&p.length===0)return;const v=f?Mpt[f](p):p,h=Array.isArray(v)&&c?v.filter(({type:m})=>m===c):v;if(h)return this.data[`${i}-${l}`]=h,h});this.data[i]=o==="protvista-variation-graph"?s[0]:s.flat()})}this.loading=!1,this.requestUpdate()}async _loadDataInComponents(){await Hbe(),Object.entries(this.data).forEach(([t,r])=>{var n,i;const a=document.getElementById(`track-${t}`);a&&a.data!==r&&(a.data=r);const o=(n=this.config)===null||n===void 0?void 0:n.categories.find(({name:s})=>s===t);if(o&&o.tracks&&r&&(r.length>0||!((i=r.variants)===null||i===void 0)&&i.length)){const s=document.getElementById(`category_${o.name}`);s&&(s.style.display="flex");for(const u of o.tracks){const l=document.getElementById(`track-${t}-${u.name}`);l&&(l.data=this.data[`${t}-${u.name}`])}}})}updated(t){super.updated(t);const r=this.querySelector("protvista-filter");r&&r.filters!==GG&&(r.filters=GG);const n=this.querySelector("protvista-variation");if(n&&n.colorConfig!==qG&&(n.colorConfig=qG),t.has("suspend")){if(this.suspend)return;this._init()}this._loadDataInComponents()}_init(){this.config||(this.config=m4e),this.accession&&(this.loadEntry(this.accession).then(t=>{var r;this.sequence=t.sequence.sequence,this.displayCoordinates={start:1,end:(r=this.sequence)===null||r===void 0?void 0:r.length}}),this._loadData())}connectedCallback(){super.connectedCallback(),this.registerWebComponents(),this.suspend||this._init(),this.addEventListener("change",t=>{var r,n,i;!((r=t.detail)===null||r===void 0)&&r.displaystart&&(this.displayCoordinates.start=t.detail.displaystart),!((n=t.detail)===null||n===void 0)&&n.displayend&&(this.displayCoordinates.end=t.detail.displayend),this.notooltip||(!((i=t.detail)===null||i===void 0)&&i.eventtype?t.detail.eventtype==="click"&&this.updateTooltip(t):this._resetTooltip())}),this.notooltip||(this.addEventListener("click",t=>{const r=t.target;if(!r.closest(".feature")&&!r.closest("protvista-tooltip")){const n=this.querySelector("protvista-tooltip");n&&(n.visible=!1)}}),document.addEventListener("click",this._resetTooltip)),this.addEventListener("load",()=>{this.hasData||(this.dispatchEvent(new CustomEvent("protvista-event",{detail:{hasData:!0},bubbles:!0})),this.hasData=!0)})}disconnectedCallback(){this.notooltip||document.removeEventListener("click",this._resetTooltip)}_resetTooltip(t){var r;if(this&&(!t||!(!((r=t.target)===null||r===void 0)&&r.closest("protvista-uniprot")))){const n=this.querySelector("protvista-tooltip");n&&(n.visible=!1)}}async loadEntry(t){try{return await(await fetch(`https://www.ebi.ac.uk/proteins/api/proteins/${t}`)).json()}catch(r){console.error("Couldn't load UniProt entry",r)}}createRenderRoot(){return this}render(){var t,r;return!this.sequence||!this.config||this.suspend?Gr``:this.loading?Gr`<div class="protvista-loader">
        ${VM`${$M(Foe)}`}
      </div>`:this.hasData?Gr`
      <protvista-manager
        attributes="length displaystart displayend highlight activefilters filters"
        additionalsubscribers="protvista-structure"
      >
        <div class="nav-container">
          <div class="action-buttons">
            <download-panel
              accession="${this.accession}"
              config="${JSON.stringify(this.config.download)}"
            />
          </div>
          <div class="track-content">
            <protvista-navigation
              length="${this.sequence.length}"
            ></protvista-navigation>
            <protvista-sequence
              length="${this.sequence.length}"
              sequence="${this.sequence}"
              displaystart=${(t=this.displayCoordinates)===null||t===void 0?void 0:t.start}
              displayend="${(r=this.displayCoordinates)===null||r===void 0?void 0:r.end}"
            ></protvista-sequence>
          </div>
        </div>
        ${this.config.categories.map(n=>this.data[n.name]&&Gr`
              <div class="category" id="category_${n.name}">
                <div
                  class="category-label"
                  data-category-toggle="${n.name}"
                  @click="${this.handleCategoryClick}"
                >
                  ${n.label}
                </div>

                <div
                  data-id="category_${n.name}"
                  class="aggregate-track-content track-content"
                  .style="${this.openCategories.includes(n.name)?"opacity:0":"opacity:1"}"
                >
                  ${this.data[n.name]&&this.getTrack(n.trackType,"non-overlapping",n.color,n.shape,n.name)}
                </div>
              </div>

              <!-- Expanded Categories -->
              ${n.tracks&&n.tracks.map(i=>{if(this.openCategories.includes(n.name)){const a=this.data[`${n.name}-${i.name}`];return a&&(Array.isArray(a)&&a.length||Object.keys(a).length)?Gr`
                        <div class="category__track" id="track_${i.name}">
                          <div class="track-label" title="${i.tooltip}">
                            ${i.filterComponent?this.getFilterComponent(`${n.name}-${i.name}`):i.label}
                          </div>
                          <div
                            class="track-content"
                            data-id="track_${i.name}"
                          >
                            ${this.getTrack(i.trackType,"non-overlapping",i.color||n.color,i.shape||n.shape,`${n.name}-${i.name}`)}
                          </div>
                        </div>
                      `:""}})}
              ${n.tracks?"":this.data[n.name].map(i=>{if(this.openCategories.includes(n.name))return!i||!i.accession?"":Gr`
                          <div
                            class="category__track"
                            id="track_${i.accession}"
                          >
                            <div class="track-label" title="${i.accession}">
                              ${i.accession}
                            </div>
                            <div
                              class="track-content"
                              data-id="track_${i.accession}"
                            >
                              ${this.getTrack(n.trackType,"non-overlapping",n.color,n.shape,`${n.name}-${i.accession}`)}
                            </div>
                          </div>
                        `})}
            `)}
        <div class="nav-container">
          <div class="credits"></div>
          <div class="track-content">
            <protvista-sequence
              length="${this.sequence.length}"
              sequence="${this.sequence}"
              displaystart=${this.displayCoordinates.start}
              displayend="${this.displayCoordinates.end}"
            ></protvista-sequence>
          </div>
        </div>
        ${this.nostructure?"":Gr`
              <protvista-uniprot-structure
                accession="${this.accession||""}"
              ></protvista-uniprot-structure>
            `}
        <protvista-tooltip />
      </protvista-manager>
    `:Gr`<div class="protvista-no-results">
        No feature data available for ${this.accession}
      </div>`}async updateTooltip(t){var r,n;const i=(r=t.detail)===null||r===void 0?void 0:r.feature;if(!i.tooltipContent)return;const a=this.querySelector("protvista-tooltip");if(a&&(a.title=`${i.type} ${i.start}-${i.end}`,a.innerHTML=i.tooltipContent,a.visible=!0,!((n=t.detail)===null||n===void 0)&&n.coords)){const[o,s]=t.detail.coords;a.x=o,a.y=s}}handleCategoryClick(t){const r=t.target,n=r.getAttribute("data-category-toggle");n&&!r.classList.contains("open")?(r.classList.add("open"),this.openCategories=[...this.openCategories,n]):(r.classList.remove("open"),this.openCategories=[...this.openCategories].filter(i=>i!==n))}getCategoryTypesAsString(t){return t.map(r=>r.filter).join(",")}getFilterComponent(t){return Gr`
      <protvista-filter
        style="minWidth: 20%"
        for="track-${t}"
      ></protvista-filter>
    `}getTrack(t,r="",n="",i="",a=""){var o,s,u,l,c,d,f,p,v,h,m,g;switch(t){case"protvista-track":return Gr`
          <protvista-track
            length="${(o=this.sequence)===null||o===void 0?void 0:o.length}"
            layout="${r}"
            color="${n}"
            shape="${i}"
            displaystart="${(s=this.displayCoordinates)===null||s===void 0?void 0:s.start}"
            displayend="${(u=this.displayCoordinates)===null||u===void 0?void 0:u.end}"
            id="track-${a}"
          >
          </protvista-track>
        `;case"protvista-interpro-track":return Gr`
          <protvista-interpro-track
            length="${(l=this.sequence)===null||l===void 0?void 0:l.length}"
            color="${n}"
            shape="${i}"
            displaystart="${(c=this.displayCoordinates)===null||c===void 0?void 0:c.start}"
            displayend="${(d=this.displayCoordinates)===null||d===void 0?void 0:d.end}"
            id="track-${a}"
          >
          </protvista-interpro-track>
        `;case"protvista-variation":return Gr`
          <protvista-variation
            length="${(f=this.sequence)===null||f===void 0?void 0:f.length}"
            displaystart="${(p=this.displayCoordinates)===null||p===void 0?void 0:p.start}"
            displayend="${(v=this.displayCoordinates)===null||v===void 0?void 0:v.end}"
            id="track-${a}"
          >
          </protvista-variation>
        `;case"protvista-variation-graph":return Gr`
          <protvista-variation-graph
            length="${(h=this.sequence)===null||h===void 0?void 0:h.length}"
            displaystart="${(m=this.displayCoordinates)===null||m===void 0?void 0:m.start}"
            displayend="${(g=this.displayCoordinates)===null||g===void 0?void 0:g.end}"
            id="track-${a}"
          >
          </protvista-variation-graph>
        `;default:console.warn("No Matching ProtvistaTrack Found.");break}}}const Rpt=({proteinData:e})=>{const t=_e.useRef(null);return _e.useEffect(()=>{if(typeof window<"u"&&window.document&&(window.customElements.get("protvista-uniprot")||window.customElements.define("protvista-uniprot",Dpt),t.current)){const r=document.createElement("protvista-uniprot");r.setAttribute("accession",e.id),t.current.appendChild(r)}},[e.id]),P.jsx("div",{ref:t,className:"protein-feature-viewer-wrapper"})};var lC=(e=>(e[e.PUBMED=0]="PUBMED",e[e.EUROPEPMC=1]="EUROPEPMC",e[e.DOI=2]="DOI",e))(lC||{});const gI=e=>{if(!e.id&&e.type!=2)return P.jsx(P.Fragment,{});let t;switch(e.type){case 0:t=`${Kf.PUBMED_HOST}${e.id}`;break;case 1:t=`${Kf.PMC_HOST}${e.id}`;break;case 2:t=`${Kf.DOI_HOST}${e.id}`;break}const r=n=>P.jsxs("div",{className:"protein-publications-link-content",children:[n,P.jsx("svg",{width:"14",height:"14",viewBox:"0 0 14 14",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:P.jsx("path",{d:"M8.55556 1.55556C8.34928 1.55556 8.15145 1.47361 8.00558 1.32775C7.85972 1.18189 7.77778 0.984057 7.77778 0.777778C7.77778 0.571498 7.85972 0.373667 8.00558 0.227806C8.15145 0.0819442 8.34928 0 8.55556 0H13.2222C13.4285 0 13.6263 0.0819442 13.7722 0.227806C13.9181 0.373667 14 0.571498 14 0.777778V5.44444C14 5.65072 13.9181 5.84855 13.7722 5.99442C13.6263 6.14028 13.4285 6.22222 13.2222 6.22222C13.0159 6.22222 12.8181 6.14028 12.6722 5.99442C12.5264 5.84855 12.4444 5.65072 12.4444 5.44444V2.65533L5.21656 9.88322C5.06986 10.0249 4.8734 10.1033 4.66947 10.1015C4.46554 10.0998 4.27046 10.018 4.12625 9.87375C3.98205 9.72954 3.90025 9.53446 3.89848 9.33053C3.8967 9.1266 3.9751 8.93014 4.11678 8.78344L11.3447 1.55556H8.55556ZM0 3.11111C0 2.69855 0.163888 2.30289 0.455612 2.01117C0.747335 1.71944 1.143 1.55556 1.55556 1.55556H5.44444C5.65072 1.55556 5.84855 1.6375 5.99442 1.78336C6.14028 1.92922 6.22222 2.12705 6.22222 2.33333C6.22222 2.53961 6.14028 2.73744 5.99442 2.88331C5.84855 3.02917 5.65072 3.11111 5.44444 3.11111H1.55556V12.4444H10.8889V8.55556C10.8889 8.34928 10.9708 8.15145 11.1167 8.00558C11.2626 7.85972 11.4604 7.77778 11.6667 7.77778C11.8729 7.77778 12.0708 7.85972 12.2166 8.00558C12.3625 8.15145 12.4444 8.34928 12.4444 8.55556V12.4444C12.4444 12.857 12.2806 13.2527 11.9888 13.5444C11.6971 13.8361 11.3014 14 10.8889 14H1.55556C1.143 14 0.747335 13.8361 0.455612 13.5444C0.163888 13.2527 0 12.857 0 12.4444V3.11111Z"})})]});return e.type!=2||e.id?P.jsx("a",{href:t,target:"_blank",rel:"noopener noreferrer",className:"protein-publications-link protein-publications-link-enabled",children:r(e.title)}):P.jsx("div",{className:"protein-publications-link protein-publications-link-disabled",children:r(e.title)})},kpt=({proteinid:e})=>{const t=N3(),[r,n]=_e.useState(!1),i=rv(s=>s.appState.proteinCache),a=_e.useMemo(()=>i[e].publications,[i,e]);_e.useEffect(()=>{(!a||a.length==0)&&(n(!0),t(Nge(e)).finally(()=>{n(!1)}))},[a,t]);const o=()=>r?P.jsx(B3,{}):a?P.jsx(P.Fragment,{children:a.map(s=>{var u,l,c,d,f,p,v;return P.jsxs("div",{className:"protein-publications-publication",children:[P.jsx("div",{className:"protein-publications-publication-title",children:s.title}),P.jsx("div",{className:"protein-publications-publication-authors",children:Array.isArray(s.authors)&&((u=s.authors)==null?void 0:u.map((h,m)=>P.jsxs("span",{children:[m>0?", ":"",P.jsx("span",{className:"protein-publication-author",children:h})]},s.id+h+m)))}),P.jsxs("div",{className:"protein-publications-publication-prop",children:[P.jsx("span",{className:"protein-publications-publication-prop-key",children:"Categories: "}),P.jsx("span",{className:"protein-publications-publication-prop-value",children:Array.isArray(s.references)&&Array.isArray((l=s.references[0])==null?void 0:l.categories)&&((d=(c=s.references[0])==null?void 0:c.categories)==null?void 0:d.map((h,m)=>P.jsxs("span",{children:[m>0?", ":"",h]},s.id+h)))})]}),P.jsxs("div",{className:"protein-publications-publication-prop",children:[P.jsx("span",{className:"protein-publications-publication-prop-key",children:"Cited for: "}),P.jsx("span",{className:"protein-publications-publication-prop-value",children:Array.isArray(s.references)&&Array.isArray(s.references[0].positions)&&((p=(f=s.references[0])==null?void 0:f.positions)==null?void 0:p.map((h,m)=>P.jsxs("span",{children:[m>0?", ":"",h]},s.id+h)))})]}),P.jsxs("div",{className:"protein-publications-publication-prop",children:[P.jsx("span",{className:"protein-publications-publication-prop-key",children:"Source: "}),P.jsx("span",{className:"protein-publications-publication-prop-value",children:(Array.isArray(s.references)&&((v=s.references[0])==null?void 0:v.source))??""})]}),P.jsxs("div",{className:"protein-publications-publication-links",children:[P.jsx(gI,{id:s.id,title:"PubMed",type:lC.PUBMED},"pm_"+s.id),P.jsx(gI,{id:s.id,title:"Europe PMC",type:lC.EUROPEPMC},"ep_"+s.id),P.jsx(gI,{id:s.doiId,title:`${s.journal} ${s.volume}:${s.firstPage} ${s.lastPage} (${s.publicationDate})`,type:lC.DOI},"doi_"+s.doiId)]})]},s.id)})}):P.jsx("div",{className:"protein-publications-no-data",children:"No Publications found"});return P.jsx("div",{className:"protein-publications-wrapper",children:o()})},Opt=()=>{const{id:e}=Qpe(),t=N3(),[r,n]=_e.useState(!1),[i,a]=_e.useState("tab1"),o=rv(d=>d.appState.proteinCache),s=_e.useMemo(()=>o[e],[o,e]);_e.useEffect(()=>{e&&(s||(n(!0),t(Fge(e)).finally(()=>{n(!1)})))},[e,t]);const u=d=>{a(d)},l=()=>r?P.jsx(B3,{}):s?P.jsxs(P.Fragment,{children:[P.jsx(pbe,{proteinData:s}),P.jsxs("div",{className:"protein-page-tab-buttons",children:[P.jsx("div",{className:`protein-page-tab-button ${i==="tab1"?"protein-page-tab-button-active":""}`,onClick:()=>u("tab1"),children:"Details"}),P.jsx("div",{className:`protein-page-tab-button ${i==="tab2"?"protein-page-tab-button-active":""}`,onClick:()=>u("tab2"),children:"Feature Viewer"}),P.jsx("div",{className:`protein-page-tab-button ${i==="tab3"?"protein-page-tab-button-active":""}`,onClick:()=>u("tab3"),children:"Publications"})]})]}):P.jsx("div",{className:"protein-no-data",children:"Protein ID is not found"}),c=()=>{if(!s)return null;switch(i){case"tab1":return P.jsx(L8,{proteinData:s});case"tab2":return P.jsx(Rpt,{proteinData:s});case"tab3":return P.jsx(kpt,{proteinid:s.id});default:return P.jsx(L8,{proteinData:s})}};return P.jsxs(P.Fragment,{children:[P.jsx(Kk,{}),P.jsx("div",{className:"protein-page-wrapper-scroll",children:P.jsxs("div",{className:"protein-page-wrapper",children:[l(),P.jsx("div",{className:"protein-page-tab",children:c()})]})})]})},Uoe=new RegExp("[^@s]+@[^@s]+.[^@s]+$"),Lpt=new RegExp("[a-z]"),Fpt=new RegExp("[A-Z]"),Npt=new RegExp("[0-9]"),Bpt=()=>{const[e,t]=Fs.useState(""),[r,n]=Fs.useState(""),[i,a]=Fs.useState(""),[o,s]=Fs.useState(""),u=()=>e.length===0?(s(""),!0):r!==i?(s("Passwords do not match!"),!0):e.length>0&&!Uoe.test(e)?(s("Login must be a valid e-mail!"),!0):r.length===0&&i.length===0?(s(""),!0):(r.length>0||i.length>0)&&(r.length<6||!Lpt.test(r)||!Fpt.test(r)||!Npt.test(r))?(s("Password must be at least 6 symbols, contain uppercase, lowercase letter and a number."),!0):(s(""),!1),l=_e.useMemo(()=>u(),[e,r,i]),c=async()=>{try{const f=(await tfe(Jh,e,r)).user;console.info("User created: "+f)}catch(d){const f=d,p=f.code,v=f.message;s("Sign Up Error: "+v+" code: "+p)}};return P.jsxs(P.Fragment,{children:[P.jsx("h3",{className:"form-h3",children:"Sign Up"}),P.jsx("label",{className:"form-label",htmlFor:"login-input",children:"Email"}),P.jsx("input",{className:"form-input form-text-input",id:"login-input",type:"email",value:e,onChange:d=>t(d.target.value),name:"login-input",placeholder:"Enter your email"}),P.jsx("label",{className:"form-label",htmlFor:"password-input",children:"Password"}),P.jsx("input",{className:"form-input form-text-input",id:"password-input",type:"password",value:r,onChange:d=>n(d.target.value),name:"password-input",placeholder:"Enter your password"}),P.jsx("label",{className:"form-label",htmlFor:"password-input-repeat",children:"Repeat Password"}),P.jsx("input",{className:"form-input form-text-input",id:"password-input-repeat",type:"password",value:i,onChange:d=>a(d.target.value),name:"password-input-repeat",placeholder:"Enter your password again"}),P.jsx("div",{className:"error-message",children:o}),P.jsx("button",{className:"form-button",onClick:c,disabled:l,children:"Create Account"})]})},Upt=()=>{const e=vd(),[t,r]=Fs.useState(""),[n,i]=Fs.useState(""),[a,o]=Fs.useState(""),s=()=>t.length===0?(o(""),!0):Uoe.test(t)?n.length===0?(o(""),!0):n.length<6?(o("Password must be at least 6 symbols!"),!0):(o(""),!1):(o("Login must be a valid e-mail!"),!0),u=_e.useMemo(()=>s(),[t,n]),l=async()=>{rfe(Jh,t,n).then(c=>{const d=c.user;console.log("User signed in: "+d.email),e("/search")}).catch(c=>{const d=c.code,f=c.message;o("Login Error: "+f+" code: "+d)})};return P.jsxs(P.Fragment,{children:[P.jsx("h3",{className:"form-h3",children:"Login"}),P.jsx("label",{className:"form-label",htmlFor:"login-input",children:"Email"}),P.jsx("input",{className:"form-input form-text-input",id:"login-input",autoComplete:"current-login",type:"email",value:t,onChange:c=>r(c.target.value),name:"login-input",placeholder:"Enter your email"}),P.jsx("label",{className:"form-label",htmlFor:"password-input",children:"Password"}),P.jsx("input",{className:"form-input form-text-input",id:"password-input",type:"password",autoComplete:"current-password",value:n,onChange:c=>i(c.target.value),name:"password-input",placeholder:"Enter your password"}),P.jsx("div",{className:"error-message",children:a}),P.jsx("button",{className:"form-button",disabled:u,onClick:l,children:"Login"})]})},jpt=()=>{const e=vd(),[t,r]=_e.useState(!0);return _e.useEffect(()=>{const n=Gk(Jh,i=>{i&&e("/search")});return()=>n()},[]),P.jsx("div",{className:"auth-wrapper",children:P.jsxs("div",{className:"auth-form-container",children:[t?P.jsx(Upt,{}):P.jsx(Bpt,{}),P.jsxs("div",{className:"auth-form-text-small",children:[t?"Don't have an account? ":"Already have an account? ",P.jsx("span",{className:"auth-form-link",onClick:()=>r(!t),children:t?"Sign Up":"Login"}),"!"]})]})})},zpt=()=>{const e=vd(),t=()=>{e("/search")};return P.jsxs(P.Fragment,{children:[P.jsx(Kk,{}),P.jsxs("div",{className:"notfound-content",children:[P.jsx("span",{className:"notfound-header",children:"404"}),P.jsx("span",{className:"notfound-description",children:"Page not found"}),P.jsx("button",{className:"notfound-button",onClick:t,children:"Back to Search"})]})]})},Vpt=()=>{const e=vd();return _e.useEffect(()=>{e("/not-found")},[]),null},Hpt=()=>P.jsx(phe,{children:P.jsxs(dhe,{children:[P.jsx(oh,{path:"/",element:P.jsx(vhe,{})}),P.jsx(oh,{path:"/search",element:P.jsx(fbe,{})}),P.jsx(oh,{path:"/protein/:id",element:P.jsx(Opt,{})}),P.jsx(oh,{path:"/auth",element:P.jsx(jpt,{})}),P.jsx(oh,{path:"/not-found",element:P.jsx(zpt,{})}),P.jsx(oh,{path:"*",element:P.jsx(Vpt,{})})]})});yI.createRoot(document.querySelector("#root")).render(P.jsx(Fs.StrictMode,{children:P.jsx(Spe,{children:P.jsx(Zve,{store:KX,children:P.jsx(Hpt,{})})})}))});export default Gpt();
