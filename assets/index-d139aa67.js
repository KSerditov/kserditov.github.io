(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const a of i)if(a.type==="childList")for(const o of a.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function r(i){const a={};return i.integrity&&(a.integrity=i.integrity),i.referrerPolicy&&(a.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?a.credentials="include":i.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function n(i){if(i.ep)return;i.ep=!0;const a=r(i);fetch(i.href,a)}})();var $h=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function nH(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function Tie(e){if(e.__esModule)return e;var t=e.default;if(typeof t=="function"){var r=function n(){if(this instanceof n){var i=[null];i.push.apply(i,arguments);var a=Function.bind.apply(t,i);return new a}return t.apply(this,arguments)};r.prototype=t.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(e).forEach(function(n){var i=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(r,n,i.get?i:{enumerable:!0,get:function(){return e[n]}})}),r}var iH={exports:{}},J_={},aH={exports:{}},Yr={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ob=Symbol.for("react.element"),Iie=Symbol.for("react.portal"),Mie=Symbol.for("react.fragment"),Die=Symbol.for("react.strict_mode"),Rie=Symbol.for("react.profiler"),kie=Symbol.for("react.provider"),Oie=Symbol.for("react.context"),Lie=Symbol.for("react.forward_ref"),Nie=Symbol.for("react.suspense"),Fie=Symbol.for("react.memo"),Bie=Symbol.for("react.lazy"),B6=Symbol.iterator;function Uie(e){return e===null||typeof e!="object"?null:(e=B6&&e[B6]||e["@@iterator"],typeof e=="function"?e:null)}var oH={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},sH=Object.assign,uH={};function kg(e,t,r){this.props=e,this.context=t,this.refs=uH,this.updater=r||oH}kg.prototype.isReactComponent={};kg.prototype.setState=function(e,t){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")};kg.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function lH(){}lH.prototype=kg.prototype;function DD(e,t,r){this.props=e,this.context=t,this.refs=uH,this.updater=r||oH}var RD=DD.prototype=new lH;RD.constructor=DD;sH(RD,kg.prototype);RD.isPureReactComponent=!0;var U6=Array.isArray,cH=Object.prototype.hasOwnProperty,kD={current:null},dH={key:!0,ref:!0,__self:!0,__source:!0};function fH(e,t,r){var n,i={},a=null,o=null;if(t!=null)for(n in t.ref!==void 0&&(o=t.ref),t.key!==void 0&&(a=""+t.key),t)cH.call(t,n)&&!dH.hasOwnProperty(n)&&(i[n]=t[n]);var s=arguments.length-2;if(s===1)i.children=r;else if(1<s){for(var u=Array(s),l=0;l<s;l++)u[l]=arguments[l+2];i.children=u}if(e&&e.defaultProps)for(n in s=e.defaultProps,s)i[n]===void 0&&(i[n]=s[n]);return{$$typeof:ob,type:e,key:a,ref:o,props:i,_owner:kD.current}}function jie(e,t){return{$$typeof:ob,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}function OD(e){return typeof e=="object"&&e!==null&&e.$$typeof===ob}function zie(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(r){return t[r]})}var j6=/\/+/g;function BE(e,t){return typeof e=="object"&&e!==null&&e.key!=null?zie(""+e.key):t.toString(36)}function Ux(e,t,r,n,i){var a=typeof e;(a==="undefined"||a==="boolean")&&(e=null);var o=!1;if(e===null)o=!0;else switch(a){case"string":case"number":o=!0;break;case"object":switch(e.$$typeof){case ob:case Iie:o=!0}}if(o)return o=e,i=i(o),e=n===""?"."+BE(o,0):n,U6(i)?(r="",e!=null&&(r=e.replace(j6,"$&/")+"/"),Ux(i,t,r,"",function(l){return l})):i!=null&&(OD(i)&&(i=jie(i,r+(!i.key||o&&o.key===i.key?"":(""+i.key).replace(j6,"$&/")+"/")+e)),t.push(i)),1;if(o=0,n=n===""?".":n+":",U6(e))for(var s=0;s<e.length;s++){a=e[s];var u=n+BE(a,s);o+=Ux(a,t,r,u,i)}else if(u=Uie(e),typeof u=="function")for(e=u.call(e),s=0;!(a=e.next()).done;)a=a.value,u=n+BE(a,s++),o+=Ux(a,t,r,u,i);else if(a==="object")throw t=String(e),Error("Objects are not valid as a React child (found: "+(t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return o}function a2(e,t,r){if(e==null)return e;var n=[],i=0;return Ux(e,n,"","",function(a){return t.call(r,a,i++)}),n}function Vie(e){if(e._status===-1){var t=e._result;t=t(),t.then(function(r){(e._status===0||e._status===-1)&&(e._status=1,e._result=r)},function(r){(e._status===0||e._status===-1)&&(e._status=2,e._result=r)}),e._status===-1&&(e._status=0,e._result=t)}if(e._status===1)return e._result.default;throw e._result}var Qa={current:null},jx={transition:null},Hie={ReactCurrentDispatcher:Qa,ReactCurrentBatchConfig:jx,ReactCurrentOwner:kD};Yr.Children={map:a2,forEach:function(e,t,r){a2(e,function(){t.apply(this,arguments)},r)},count:function(e){var t=0;return a2(e,function(){t++}),t},toArray:function(e){return a2(e,function(t){return t})||[]},only:function(e){if(!OD(e))throw Error("React.Children.only expected to receive a single React element child.");return e}};Yr.Component=kg;Yr.Fragment=Mie;Yr.Profiler=Rie;Yr.PureComponent=DD;Yr.StrictMode=Die;Yr.Suspense=Nie;Yr.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Hie;Yr.cloneElement=function(e,t,r){if(e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var n=sH({},e.props),i=e.key,a=e.ref,o=e._owner;if(t!=null){if(t.ref!==void 0&&(a=t.ref,o=kD.current),t.key!==void 0&&(i=""+t.key),e.type&&e.type.defaultProps)var s=e.type.defaultProps;for(u in t)cH.call(t,u)&&!dH.hasOwnProperty(u)&&(n[u]=t[u]===void 0&&s!==void 0?s[u]:t[u])}var u=arguments.length-2;if(u===1)n.children=r;else if(1<u){s=Array(u);for(var l=0;l<u;l++)s[l]=arguments[l+2];n.children=s}return{$$typeof:ob,type:e.type,key:i,ref:a,props:n,_owner:o}};Yr.createContext=function(e){return e={$$typeof:Oie,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},e.Provider={$$typeof:kie,_context:e},e.Consumer=e};Yr.createElement=fH;Yr.createFactory=function(e){var t=fH.bind(null,e);return t.type=e,t};Yr.createRef=function(){return{current:null}};Yr.forwardRef=function(e){return{$$typeof:Lie,render:e}};Yr.isValidElement=OD;Yr.lazy=function(e){return{$$typeof:Bie,_payload:{_status:-1,_result:e},_init:Vie}};Yr.memo=function(e,t){return{$$typeof:Fie,type:e,compare:t===void 0?null:t}};Yr.startTransition=function(e){var t=jx.transition;jx.transition={};try{e()}finally{jx.transition=t}};Yr.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")};Yr.useCallback=function(e,t){return Qa.current.useCallback(e,t)};Yr.useContext=function(e){return Qa.current.useContext(e)};Yr.useDebugValue=function(){};Yr.useDeferredValue=function(e){return Qa.current.useDeferredValue(e)};Yr.useEffect=function(e,t){return Qa.current.useEffect(e,t)};Yr.useId=function(){return Qa.current.useId()};Yr.useImperativeHandle=function(e,t,r){return Qa.current.useImperativeHandle(e,t,r)};Yr.useInsertionEffect=function(e,t){return Qa.current.useInsertionEffect(e,t)};Yr.useLayoutEffect=function(e,t){return Qa.current.useLayoutEffect(e,t)};Yr.useMemo=function(e,t){return Qa.current.useMemo(e,t)};Yr.useReducer=function(e,t,r){return Qa.current.useReducer(e,t,r)};Yr.useRef=function(e){return Qa.current.useRef(e)};Yr.useState=function(e){return Qa.current.useState(e)};Yr.useSyncExternalStore=function(e,t,r){return Qa.current.useSyncExternalStore(e,t,r)};Yr.useTransition=function(){return Qa.current.useTransition()};Yr.version="18.2.0";aH.exports=Yr;var Ve=aH.exports;const du=nH(Ve);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Gie=Ve,qie=Symbol.for("react.element"),Wie=Symbol.for("react.fragment"),$ie=Object.prototype.hasOwnProperty,Xie=Gie.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Yie={key:!0,ref:!0,__self:!0,__source:!0};function hH(e,t,r){var n,i={},a=null,o=null;r!==void 0&&(a=""+r),t.key!==void 0&&(a=""+t.key),t.ref!==void 0&&(o=t.ref);for(n in t)$ie.call(t,n)&&!Yie.hasOwnProperty(n)&&(i[n]=t[n]);if(e&&e.defaultProps)for(n in t=e.defaultProps,t)i[n]===void 0&&(i[n]=t[n]);return{$$typeof:qie,type:e,key:a,ref:o,props:i,_owner:Xie.current}}J_.Fragment=Wie;J_.jsx=hH;J_.jsxs=hH;iH.exports=J_;var T=iH.exports;var v4={},pH={exports:{}},Jo={},vH={exports:{}},mH={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function t(G,W){var q=G.length;G.push(W);e:for(;0<q;){var ee=q-1>>>1,he=G[ee];if(0<i(he,W))G[ee]=W,G[q]=he,q=ee;else break e}}function r(G){return G.length===0?null:G[0]}function n(G){if(G.length===0)return null;var W=G[0],q=G.pop();if(q!==W){G[0]=q;e:for(var ee=0,he=G.length,$=he>>>1;ee<$;){var X=2*(ee+1)-1,U=G[X],z=X+1,J=G[z];if(0>i(U,q))z<he&&0>i(J,U)?(G[ee]=J,G[z]=q,ee=z):(G[ee]=U,G[X]=q,ee=X);else if(z<he&&0>i(J,q))G[ee]=J,G[z]=q,ee=z;else break e}}return W}function i(G,W){var q=G.sortIndex-W.sortIndex;return q!==0?q:G.id-W.id}if(typeof performance=="object"&&typeof performance.now=="function"){var a=performance;e.unstable_now=function(){return a.now()}}else{var o=Date,s=o.now();e.unstable_now=function(){return o.now()-s}}var u=[],l=[],c=1,d=null,f=3,h=!1,v=!1,p=!1,m=typeof setTimeout=="function"?setTimeout:null,g=typeof clearTimeout=="function"?clearTimeout:null,y=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function b(G){for(var W=r(l);W!==null;){if(W.callback===null)n(l);else if(W.startTime<=G)n(l),W.sortIndex=W.expirationTime,t(u,W);else break;W=r(l)}}function S(G){if(p=!1,b(G),!v)if(r(u)!==null)v=!0,j(x);else{var W=r(l);W!==null&&Q(S,W.startTime-G)}}function x(G,W){v=!1,p&&(p=!1,g(A),A=-1),h=!0;var q=f;try{for(b(W),d=r(u);d!==null&&(!(d.expirationTime>W)||G&&!k());){var ee=d.callback;if(typeof ee=="function"){d.callback=null,f=d.priorityLevel;var he=ee(d.expirationTime<=W);W=e.unstable_now(),typeof he=="function"?d.callback=he:d===r(u)&&n(u),b(W)}else n(u);d=r(u)}if(d!==null)var $=!0;else{var X=r(l);X!==null&&Q(S,X.startTime-W),$=!1}return $}finally{d=null,f=q,h=!1}}var C=!1,w=null,A=-1,M=5,D=-1;function k(){return!(e.unstable_now()-D<M)}function R(){if(w!==null){var G=e.unstable_now();D=G;var W=!0;try{W=w(!0,G)}finally{W?L():(C=!1,w=null)}}else C=!1}var L;if(typeof y=="function")L=function(){y(R)};else if(typeof MessageChannel<"u"){var H=new MessageChannel,B=H.port2;H.port1.onmessage=R,L=function(){B.postMessage(null)}}else L=function(){m(R,0)};function j(G){w=G,C||(C=!0,L())}function Q(G,W){A=m(function(){G(e.unstable_now())},W)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(G){G.callback=null},e.unstable_continueExecution=function(){v||h||(v=!0,j(x))},e.unstable_forceFrameRate=function(G){0>G||125<G?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):M=0<G?Math.floor(1e3/G):5},e.unstable_getCurrentPriorityLevel=function(){return f},e.unstable_getFirstCallbackNode=function(){return r(u)},e.unstable_next=function(G){switch(f){case 1:case 2:case 3:var W=3;break;default:W=f}var q=f;f=W;try{return G()}finally{f=q}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(G,W){switch(G){case 1:case 2:case 3:case 4:case 5:break;default:G=3}var q=f;f=G;try{return W()}finally{f=q}},e.unstable_scheduleCallback=function(G,W,q){var ee=e.unstable_now();switch(typeof q=="object"&&q!==null?(q=q.delay,q=typeof q=="number"&&0<q?ee+q:ee):q=ee,G){case 1:var he=-1;break;case 2:he=250;break;case 5:he=1073741823;break;case 4:he=1e4;break;default:he=5e3}return he=q+he,G={id:c++,callback:W,priorityLevel:G,startTime:q,expirationTime:he,sortIndex:-1},q>ee?(G.sortIndex=q,t(l,G),r(u)===null&&G===r(l)&&(p?(g(A),A=-1):p=!0,Q(S,q-ee))):(G.sortIndex=he,t(u,G),v||h||(v=!0,j(x))),G},e.unstable_shouldYield=k,e.unstable_wrapCallback=function(G){var W=f;return function(){var q=f;f=W;try{return G.apply(this,arguments)}finally{f=q}}}})(mH);vH.exports=mH;var Kie=vH.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var gH=Ve,Ho=Kie;function Tt(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,r=1;r<arguments.length;r++)t+="&args[]="+encodeURIComponent(arguments[r]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var yH=new Set,r1={};function iv(e,t){ng(e,t),ng(e+"Capture",t)}function ng(e,t){for(r1[e]=t,e=0;e<t.length;e++)yH.add(t[e])}var Cc=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),m4=Object.prototype.hasOwnProperty,Qie=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,z6={},V6={};function Zie(e){return m4.call(V6,e)?!0:m4.call(z6,e)?!1:Qie.test(e)?V6[e]=!0:(z6[e]=!0,!1)}function Jie(e,t,r,n){if(r!==null&&r.type===0)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return n?!1:r!==null?!r.acceptsBooleans:(e=e.toLowerCase().slice(0,5),e!=="data-"&&e!=="aria-");default:return!1}}function eae(e,t,r,n){if(t===null||typeof t>"u"||Jie(e,t,r,n))return!0;if(n)return!1;if(r!==null)switch(r.type){case 3:return!t;case 4:return t===!1;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}function Za(e,t,r,n,i,a,o){this.acceptsBooleans=t===2||t===3||t===4,this.attributeName=n,this.attributeNamespace=i,this.mustUseProperty=r,this.propertyName=e,this.type=t,this.sanitizeURL=a,this.removeEmptyString=o}var ca={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){ca[e]=new Za(e,0,!1,e,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];ca[t]=new Za(t,1,!1,e[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(e){ca[e]=new Za(e,2,!1,e.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){ca[e]=new Za(e,2,!1,e,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){ca[e]=new Za(e,3,!1,e.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(e){ca[e]=new Za(e,3,!0,e,null,!1,!1)});["capture","download"].forEach(function(e){ca[e]=new Za(e,4,!1,e,null,!1,!1)});["cols","rows","size","span"].forEach(function(e){ca[e]=new Za(e,6,!1,e,null,!1,!1)});["rowSpan","start"].forEach(function(e){ca[e]=new Za(e,5,!1,e.toLowerCase(),null,!1,!1)});var LD=/[\-:]([a-z])/g;function ND(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(LD,ND);ca[t]=new Za(t,1,!1,e,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(LD,ND);ca[t]=new Za(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(LD,ND);ca[t]=new Za(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(e){ca[e]=new Za(e,1,!1,e.toLowerCase(),null,!1,!1)});ca.xlinkHref=new Za("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(e){ca[e]=new Za(e,1,!1,e.toLowerCase(),null,!0,!0)});function FD(e,t,r,n){var i=ca.hasOwnProperty(t)?ca[t]:null;(i!==null?i.type!==0:n||!(2<t.length)||t[0]!=="o"&&t[0]!=="O"||t[1]!=="n"&&t[1]!=="N")&&(eae(t,r,i,n)&&(r=null),n||i===null?Zie(t)&&(r===null?e.removeAttribute(t):e.setAttribute(t,""+r)):i.mustUseProperty?e[i.propertyName]=r===null?i.type===3?!1:"":r:(t=i.attributeName,n=i.attributeNamespace,r===null?e.removeAttribute(t):(i=i.type,r=i===3||i===4&&r===!0?"":""+r,n?e.setAttributeNS(n,t,r):e.setAttribute(t,r))))}var Yc=gH.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,o2=Symbol.for("react.element"),lm=Symbol.for("react.portal"),cm=Symbol.for("react.fragment"),BD=Symbol.for("react.strict_mode"),g4=Symbol.for("react.profiler"),bH=Symbol.for("react.provider"),xH=Symbol.for("react.context"),UD=Symbol.for("react.forward_ref"),y4=Symbol.for("react.suspense"),b4=Symbol.for("react.suspense_list"),jD=Symbol.for("react.memo"),Vd=Symbol.for("react.lazy"),SH=Symbol.for("react.offscreen"),H6=Symbol.iterator;function v0(e){return e===null||typeof e!="object"?null:(e=H6&&e[H6]||e["@@iterator"],typeof e=="function"?e:null)}var ui=Object.assign,UE;function ry(e){if(UE===void 0)try{throw Error()}catch(r){var t=r.stack.trim().match(/\n( *(at )?)/);UE=t&&t[1]||""}return`
`+UE+e}var jE=!1;function zE(e,t){if(!e||jE)return"";jE=!0;var r=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(t,[])}catch(l){var n=l}Reflect.construct(e,[],t)}else{try{t.call()}catch(l){n=l}e.call(t.prototype)}else{try{throw Error()}catch(l){n=l}e()}}catch(l){if(l&&n&&typeof l.stack=="string"){for(var i=l.stack.split(`
`),a=n.stack.split(`
`),o=i.length-1,s=a.length-1;1<=o&&0<=s&&i[o]!==a[s];)s--;for(;1<=o&&0<=s;o--,s--)if(i[o]!==a[s]){if(o!==1||s!==1)do if(o--,s--,0>s||i[o]!==a[s]){var u=`
`+i[o].replace(" at new "," at ");return e.displayName&&u.includes("<anonymous>")&&(u=u.replace("<anonymous>",e.displayName)),u}while(1<=o&&0<=s);break}}}finally{jE=!1,Error.prepareStackTrace=r}return(e=e?e.displayName||e.name:"")?ry(e):""}function tae(e){switch(e.tag){case 5:return ry(e.type);case 16:return ry("Lazy");case 13:return ry("Suspense");case 19:return ry("SuspenseList");case 0:case 2:case 15:return e=zE(e.type,!1),e;case 11:return e=zE(e.type.render,!1),e;case 1:return e=zE(e.type,!0),e;default:return""}}function x4(e){if(e==null)return null;if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case cm:return"Fragment";case lm:return"Portal";case g4:return"Profiler";case BD:return"StrictMode";case y4:return"Suspense";case b4:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case xH:return(e.displayName||"Context")+".Consumer";case bH:return(e._context.displayName||"Context")+".Provider";case UD:var t=e.render;return e=e.displayName,e||(e=t.displayName||t.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case jD:return t=e.displayName||null,t!==null?t:x4(e.type)||"Memo";case Vd:t=e._payload,e=e._init;try{return x4(e(t))}catch{}}return null}function rae(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=t.render,e=e.displayName||e.name||"",t.displayName||(e!==""?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return x4(t);case 8:return t===BD?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t}return null}function Bf(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function CH(e){var t=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(t==="checkbox"||t==="radio")}function nae(e){var t=CH(e)?"checked":"value",r=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),n=""+e[t];if(!e.hasOwnProperty(t)&&typeof r<"u"&&typeof r.get=="function"&&typeof r.set=="function"){var i=r.get,a=r.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return i.call(this)},set:function(o){n=""+o,a.call(this,o)}}),Object.defineProperty(e,t,{enumerable:r.enumerable}),{getValue:function(){return n},setValue:function(o){n=""+o},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}function s2(e){e._valueTracker||(e._valueTracker=nae(e))}function _H(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var r=t.getValue(),n="";return e&&(n=CH(e)?e.checked?"true":"false":e.value),e=n,e!==r?(t.setValue(e),!0):!1}function ES(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}function S4(e,t){var r=t.checked;return ui({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:r??e._wrapperState.initialChecked})}function G6(e,t){var r=t.defaultValue==null?"":t.defaultValue,n=t.checked!=null?t.checked:t.defaultChecked;r=Bf(t.value!=null?t.value:r),e._wrapperState={initialChecked:n,initialValue:r,controlled:t.type==="checkbox"||t.type==="radio"?t.checked!=null:t.value!=null}}function wH(e,t){t=t.checked,t!=null&&FD(e,"checked",t,!1)}function C4(e,t){wH(e,t);var r=Bf(t.value),n=t.type;if(r!=null)n==="number"?(r===0&&e.value===""||e.value!=r)&&(e.value=""+r):e.value!==""+r&&(e.value=""+r);else if(n==="submit"||n==="reset"){e.removeAttribute("value");return}t.hasOwnProperty("value")?_4(e,t.type,r):t.hasOwnProperty("defaultValue")&&_4(e,t.type,Bf(t.defaultValue)),t.checked==null&&t.defaultChecked!=null&&(e.defaultChecked=!!t.defaultChecked)}function q6(e,t,r){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var n=t.type;if(!(n!=="submit"&&n!=="reset"||t.value!==void 0&&t.value!==null))return;t=""+e._wrapperState.initialValue,r||t===e.value||(e.value=t),e.defaultValue=t}r=e.name,r!==""&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,r!==""&&(e.name=r)}function _4(e,t,r){(t!=="number"||ES(e.ownerDocument)!==e)&&(r==null?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+r&&(e.defaultValue=""+r))}var ny=Array.isArray;function Rm(e,t,r,n){if(e=e.options,t){t={};for(var i=0;i<r.length;i++)t["$"+r[i]]=!0;for(r=0;r<e.length;r++)i=t.hasOwnProperty("$"+e[r].value),e[r].selected!==i&&(e[r].selected=i),i&&n&&(e[r].defaultSelected=!0)}else{for(r=""+Bf(r),t=null,i=0;i<e.length;i++){if(e[i].value===r){e[i].selected=!0,n&&(e[i].defaultSelected=!0);return}t!==null||e[i].disabled||(t=e[i])}t!==null&&(t.selected=!0)}}function w4(e,t){if(t.dangerouslySetInnerHTML!=null)throw Error(Tt(91));return ui({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function W6(e,t){var r=t.value;if(r==null){if(r=t.children,t=t.defaultValue,r!=null){if(t!=null)throw Error(Tt(92));if(ny(r)){if(1<r.length)throw Error(Tt(93));r=r[0]}t=r}t==null&&(t=""),r=t}e._wrapperState={initialValue:Bf(r)}}function EH(e,t){var r=Bf(t.value),n=Bf(t.defaultValue);r!=null&&(r=""+r,r!==e.value&&(e.value=r),t.defaultValue==null&&e.defaultValue!==r&&(e.defaultValue=r)),n!=null&&(e.defaultValue=""+n)}function $6(e){var t=e.textContent;t===e._wrapperState.initialValue&&t!==""&&t!==null&&(e.value=t)}function AH(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function E4(e,t){return e==null||e==="http://www.w3.org/1999/xhtml"?AH(t):e==="http://www.w3.org/2000/svg"&&t==="foreignObject"?"http://www.w3.org/1999/xhtml":e}var u2,PH=function(e){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(t,r,n,i){MSApp.execUnsafeLocalFunction(function(){return e(t,r,n,i)})}:e}(function(e,t){if(e.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in e)e.innerHTML=t;else{for(u2=u2||document.createElement("div"),u2.innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=u2.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}});function n1(e,t){if(t){var r=e.firstChild;if(r&&r===e.lastChild&&r.nodeType===3){r.nodeValue=t;return}}e.textContent=t}var Ey={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},iae=["Webkit","ms","Moz","O"];Object.keys(Ey).forEach(function(e){iae.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),Ey[t]=Ey[e]})});function TH(e,t,r){return t==null||typeof t=="boolean"||t===""?"":r||typeof t!="number"||t===0||Ey.hasOwnProperty(e)&&Ey[e]?(""+t).trim():t+"px"}function IH(e,t){e=e.style;for(var r in t)if(t.hasOwnProperty(r)){var n=r.indexOf("--")===0,i=TH(r,t[r],n);r==="float"&&(r="cssFloat"),n?e.setProperty(r,i):e[r]=i}}var aae=ui({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function A4(e,t){if(t){if(aae[e]&&(t.children!=null||t.dangerouslySetInnerHTML!=null))throw Error(Tt(137,e));if(t.dangerouslySetInnerHTML!=null){if(t.children!=null)throw Error(Tt(60));if(typeof t.dangerouslySetInnerHTML!="object"||!("__html"in t.dangerouslySetInnerHTML))throw Error(Tt(61))}if(t.style!=null&&typeof t.style!="object")throw Error(Tt(62))}}function P4(e,t){if(e.indexOf("-")===-1)return typeof t.is=="string";switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var T4=null;function zD(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var I4=null,km=null,Om=null;function X6(e){if(e=lb(e)){if(typeof I4!="function")throw Error(Tt(280));var t=e.stateNode;t&&(t=iw(t),I4(e.stateNode,e.type,t))}}function MH(e){km?Om?Om.push(e):Om=[e]:km=e}function DH(){if(km){var e=km,t=Om;if(Om=km=null,X6(e),t)for(e=0;e<t.length;e++)X6(t[e])}}function RH(e,t){return e(t)}function kH(){}var VE=!1;function OH(e,t,r){if(VE)return e(t,r);VE=!0;try{return RH(e,t,r)}finally{VE=!1,(km!==null||Om!==null)&&(kH(),DH())}}function i1(e,t){var r=e.stateNode;if(r===null)return null;var n=iw(r);if(n===null)return null;r=n[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(n=!n.disabled)||(e=e.type,n=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!n;break e;default:e=!1}if(e)return null;if(r&&typeof r!="function")throw Error(Tt(231,t,typeof r));return r}var M4=!1;if(Cc)try{var m0={};Object.defineProperty(m0,"passive",{get:function(){M4=!0}}),window.addEventListener("test",m0,m0),window.removeEventListener("test",m0,m0)}catch{M4=!1}function oae(e,t,r,n,i,a,o,s,u){var l=Array.prototype.slice.call(arguments,3);try{t.apply(r,l)}catch(c){this.onError(c)}}var Ay=!1,AS=null,PS=!1,D4=null,sae={onError:function(e){Ay=!0,AS=e}};function uae(e,t,r,n,i,a,o,s,u){Ay=!1,AS=null,oae.apply(sae,arguments)}function lae(e,t,r,n,i,a,o,s,u){if(uae.apply(this,arguments),Ay){if(Ay){var l=AS;Ay=!1,AS=null}else throw Error(Tt(198));PS||(PS=!0,D4=l)}}function av(e){var t=e,r=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do t=e,t.flags&4098&&(r=t.return),e=t.return;while(e)}return t.tag===3?r:null}function LH(e){if(e.tag===13){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function Y6(e){if(av(e)!==e)throw Error(Tt(188))}function cae(e){var t=e.alternate;if(!t){if(t=av(e),t===null)throw Error(Tt(188));return t!==e?null:e}for(var r=e,n=t;;){var i=r.return;if(i===null)break;var a=i.alternate;if(a===null){if(n=i.return,n!==null){r=n;continue}break}if(i.child===a.child){for(a=i.child;a;){if(a===r)return Y6(i),e;if(a===n)return Y6(i),t;a=a.sibling}throw Error(Tt(188))}if(r.return!==n.return)r=i,n=a;else{for(var o=!1,s=i.child;s;){if(s===r){o=!0,r=i,n=a;break}if(s===n){o=!0,n=i,r=a;break}s=s.sibling}if(!o){for(s=a.child;s;){if(s===r){o=!0,r=a,n=i;break}if(s===n){o=!0,n=a,r=i;break}s=s.sibling}if(!o)throw Error(Tt(189))}}if(r.alternate!==n)throw Error(Tt(190))}if(r.tag!==3)throw Error(Tt(188));return r.stateNode.current===r?e:t}function NH(e){return e=cae(e),e!==null?FH(e):null}function FH(e){if(e.tag===5||e.tag===6)return e;for(e=e.child;e!==null;){var t=FH(e);if(t!==null)return t;e=e.sibling}return null}var BH=Ho.unstable_scheduleCallback,K6=Ho.unstable_cancelCallback,dae=Ho.unstable_shouldYield,fae=Ho.unstable_requestPaint,yi=Ho.unstable_now,hae=Ho.unstable_getCurrentPriorityLevel,VD=Ho.unstable_ImmediatePriority,UH=Ho.unstable_UserBlockingPriority,TS=Ho.unstable_NormalPriority,pae=Ho.unstable_LowPriority,jH=Ho.unstable_IdlePriority,ew=null,fl=null;function vae(e){if(fl&&typeof fl.onCommitFiberRoot=="function")try{fl.onCommitFiberRoot(ew,e,void 0,(e.current.flags&128)===128)}catch{}}var hu=Math.clz32?Math.clz32:yae,mae=Math.log,gae=Math.LN2;function yae(e){return e>>>=0,e===0?32:31-(mae(e)/gae|0)|0}var l2=64,c2=4194304;function iy(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return e&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function IS(e,t){var r=e.pendingLanes;if(r===0)return 0;var n=0,i=e.suspendedLanes,a=e.pingedLanes,o=r&268435455;if(o!==0){var s=o&~i;s!==0?n=iy(s):(a&=o,a!==0&&(n=iy(a)))}else o=r&~i,o!==0?n=iy(o):a!==0&&(n=iy(a));if(n===0)return 0;if(t!==0&&t!==n&&!(t&i)&&(i=n&-n,a=t&-t,i>=a||i===16&&(a&4194240)!==0))return t;if(n&4&&(n|=r&16),t=e.entangledLanes,t!==0)for(e=e.entanglements,t&=n;0<t;)r=31-hu(t),i=1<<r,n|=e[r],t&=~i;return n}function bae(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function xae(e,t){for(var r=e.suspendedLanes,n=e.pingedLanes,i=e.expirationTimes,a=e.pendingLanes;0<a;){var o=31-hu(a),s=1<<o,u=i[o];u===-1?(!(s&r)||s&n)&&(i[o]=bae(s,t)):u<=t&&(e.expiredLanes|=s),a&=~s}}function R4(e){return e=e.pendingLanes&-1073741825,e!==0?e:e&1073741824?1073741824:0}function zH(){var e=l2;return l2<<=1,!(l2&4194240)&&(l2=64),e}function HE(e){for(var t=[],r=0;31>r;r++)t.push(e);return t}function sb(e,t,r){e.pendingLanes|=t,t!==536870912&&(e.suspendedLanes=0,e.pingedLanes=0),e=e.eventTimes,t=31-hu(t),e[t]=r}function Sae(e,t){var r=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var n=e.eventTimes;for(e=e.expirationTimes;0<r;){var i=31-hu(r),a=1<<i;t[i]=0,n[i]=-1,e[i]=-1,r&=~a}}function HD(e,t){var r=e.entangledLanes|=t;for(e=e.entanglements;r;){var n=31-hu(r),i=1<<n;i&t|e[n]&t&&(e[n]|=t),r&=~i}}var xn=0;function VH(e){return e&=-e,1<e?4<e?e&268435455?16:536870912:4:1}var HH,GD,GH,qH,WH,k4=!1,d2=[],xf=null,Sf=null,Cf=null,a1=new Map,o1=new Map,Wd=[],Cae="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Q6(e,t){switch(e){case"focusin":case"focusout":xf=null;break;case"dragenter":case"dragleave":Sf=null;break;case"mouseover":case"mouseout":Cf=null;break;case"pointerover":case"pointerout":a1.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":o1.delete(t.pointerId)}}function g0(e,t,r,n,i,a){return e===null||e.nativeEvent!==a?(e={blockedOn:t,domEventName:r,eventSystemFlags:n,nativeEvent:a,targetContainers:[i]},t!==null&&(t=lb(t),t!==null&&GD(t)),e):(e.eventSystemFlags|=n,t=e.targetContainers,i!==null&&t.indexOf(i)===-1&&t.push(i),e)}function _ae(e,t,r,n,i){switch(t){case"focusin":return xf=g0(xf,e,t,r,n,i),!0;case"dragenter":return Sf=g0(Sf,e,t,r,n,i),!0;case"mouseover":return Cf=g0(Cf,e,t,r,n,i),!0;case"pointerover":var a=i.pointerId;return a1.set(a,g0(a1.get(a)||null,e,t,r,n,i)),!0;case"gotpointercapture":return a=i.pointerId,o1.set(a,g0(o1.get(a)||null,e,t,r,n,i)),!0}return!1}function $H(e){var t=Jh(e.target);if(t!==null){var r=av(t);if(r!==null){if(t=r.tag,t===13){if(t=LH(r),t!==null){e.blockedOn=t,WH(e.priority,function(){GH(r)});return}}else if(t===3&&r.stateNode.current.memoizedState.isDehydrated){e.blockedOn=r.tag===3?r.stateNode.containerInfo:null;return}}}e.blockedOn=null}function zx(e){if(e.blockedOn!==null)return!1;for(var t=e.targetContainers;0<t.length;){var r=O4(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(r===null){r=e.nativeEvent;var n=new r.constructor(r.type,r);T4=n,r.target.dispatchEvent(n),T4=null}else return t=lb(r),t!==null&&GD(t),e.blockedOn=r,!1;t.shift()}return!0}function Z6(e,t,r){zx(e)&&r.delete(t)}function wae(){k4=!1,xf!==null&&zx(xf)&&(xf=null),Sf!==null&&zx(Sf)&&(Sf=null),Cf!==null&&zx(Cf)&&(Cf=null),a1.forEach(Z6),o1.forEach(Z6)}function y0(e,t){e.blockedOn===t&&(e.blockedOn=null,k4||(k4=!0,Ho.unstable_scheduleCallback(Ho.unstable_NormalPriority,wae)))}function s1(e){function t(i){return y0(i,e)}if(0<d2.length){y0(d2[0],e);for(var r=1;r<d2.length;r++){var n=d2[r];n.blockedOn===e&&(n.blockedOn=null)}}for(xf!==null&&y0(xf,e),Sf!==null&&y0(Sf,e),Cf!==null&&y0(Cf,e),a1.forEach(t),o1.forEach(t),r=0;r<Wd.length;r++)n=Wd[r],n.blockedOn===e&&(n.blockedOn=null);for(;0<Wd.length&&(r=Wd[0],r.blockedOn===null);)$H(r),r.blockedOn===null&&Wd.shift()}var Lm=Yc.ReactCurrentBatchConfig,MS=!0;function Eae(e,t,r,n){var i=xn,a=Lm.transition;Lm.transition=null;try{xn=1,qD(e,t,r,n)}finally{xn=i,Lm.transition=a}}function Aae(e,t,r,n){var i=xn,a=Lm.transition;Lm.transition=null;try{xn=4,qD(e,t,r,n)}finally{xn=i,Lm.transition=a}}function qD(e,t,r,n){if(MS){var i=O4(e,t,r,n);if(i===null)JE(e,t,n,DS,r),Q6(e,n);else if(_ae(i,e,t,r,n))n.stopPropagation();else if(Q6(e,n),t&4&&-1<Cae.indexOf(e)){for(;i!==null;){var a=lb(i);if(a!==null&&HH(a),a=O4(e,t,r,n),a===null&&JE(e,t,n,DS,r),a===i)break;i=a}i!==null&&n.stopPropagation()}else JE(e,t,n,null,r)}}var DS=null;function O4(e,t,r,n){if(DS=null,e=zD(n),e=Jh(e),e!==null)if(t=av(e),t===null)e=null;else if(r=t.tag,r===13){if(e=LH(t),e!==null)return e;e=null}else if(r===3){if(t.stateNode.current.memoizedState.isDehydrated)return t.tag===3?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return DS=e,null}function XH(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(hae()){case VD:return 1;case UH:return 4;case TS:case pae:return 16;case jH:return 536870912;default:return 16}default:return 16}}var lf=null,WD=null,Vx=null;function YH(){if(Vx)return Vx;var e,t=WD,r=t.length,n,i="value"in lf?lf.value:lf.textContent,a=i.length;for(e=0;e<r&&t[e]===i[e];e++);var o=r-e;for(n=1;n<=o&&t[r-n]===i[a-n];n++);return Vx=i.slice(e,1<n?1-n:void 0)}function Hx(e){var t=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&t===13&&(e=13)):e=t,e===10&&(e=13),32<=e||e===13?e:0}function f2(){return!0}function J6(){return!1}function es(e){function t(r,n,i,a,o){this._reactName=r,this._targetInst=i,this.type=n,this.nativeEvent=a,this.target=o,this.currentTarget=null;for(var s in e)e.hasOwnProperty(s)&&(r=e[s],this[s]=r?r(a):a[s]);return this.isDefaultPrevented=(a.defaultPrevented!=null?a.defaultPrevented:a.returnValue===!1)?f2:J6,this.isPropagationStopped=J6,this}return ui(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var r=this.nativeEvent;r&&(r.preventDefault?r.preventDefault():typeof r.returnValue!="unknown"&&(r.returnValue=!1),this.isDefaultPrevented=f2)},stopPropagation:function(){var r=this.nativeEvent;r&&(r.stopPropagation?r.stopPropagation():typeof r.cancelBubble!="unknown"&&(r.cancelBubble=!0),this.isPropagationStopped=f2)},persist:function(){},isPersistent:f2}),t}var Og={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},$D=es(Og),ub=ui({},Og,{view:0,detail:0}),Pae=es(ub),GE,qE,b0,tw=ui({},ub,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:XD,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==b0&&(b0&&e.type==="mousemove"?(GE=e.screenX-b0.screenX,qE=e.screenY-b0.screenY):qE=GE=0,b0=e),GE)},movementY:function(e){return"movementY"in e?e.movementY:qE}}),eN=es(tw),Tae=ui({},tw,{dataTransfer:0}),Iae=es(Tae),Mae=ui({},ub,{relatedTarget:0}),WE=es(Mae),Dae=ui({},Og,{animationName:0,elapsedTime:0,pseudoElement:0}),Rae=es(Dae),kae=ui({},Og,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),Oae=es(kae),Lae=ui({},Og,{data:0}),tN=es(Lae),Nae={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Fae={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Bae={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Uae(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):(e=Bae[e])?!!t[e]:!1}function XD(){return Uae}var jae=ui({},ub,{key:function(e){if(e.key){var t=Nae[e.key]||e.key;if(t!=="Unidentified")return t}return e.type==="keypress"?(e=Hx(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?Fae[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:XD,charCode:function(e){return e.type==="keypress"?Hx(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?Hx(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),zae=es(jae),Vae=ui({},tw,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),rN=es(Vae),Hae=ui({},ub,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:XD}),Gae=es(Hae),qae=ui({},Og,{propertyName:0,elapsedTime:0,pseudoElement:0}),Wae=es(qae),$ae=ui({},tw,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),Xae=es($ae),Yae=[9,13,27,32],YD=Cc&&"CompositionEvent"in window,Py=null;Cc&&"documentMode"in document&&(Py=document.documentMode);var Kae=Cc&&"TextEvent"in window&&!Py,KH=Cc&&(!YD||Py&&8<Py&&11>=Py),nN=String.fromCharCode(32),iN=!1;function QH(e,t){switch(e){case"keyup":return Yae.indexOf(t.keyCode)!==-1;case"keydown":return t.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function ZH(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var dm=!1;function Qae(e,t){switch(e){case"compositionend":return ZH(t);case"keypress":return t.which!==32?null:(iN=!0,nN);case"textInput":return e=t.data,e===nN&&iN?null:e;default:return null}}function Zae(e,t){if(dm)return e==="compositionend"||!YD&&QH(e,t)?(e=YH(),Vx=WD=lf=null,dm=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return KH&&t.locale!=="ko"?null:t.data;default:return null}}var Jae={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function aN(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t==="input"?!!Jae[e.type]:t==="textarea"}function JH(e,t,r,n){MH(n),t=RS(t,"onChange"),0<t.length&&(r=new $D("onChange","change",null,r,n),e.push({event:r,listeners:t}))}var Ty=null,u1=null;function eoe(e){cG(e,0)}function rw(e){var t=pm(e);if(_H(t))return e}function toe(e,t){if(e==="change")return t}var eG=!1;if(Cc){var $E;if(Cc){var XE="oninput"in document;if(!XE){var oN=document.createElement("div");oN.setAttribute("oninput","return;"),XE=typeof oN.oninput=="function"}$E=XE}else $E=!1;eG=$E&&(!document.documentMode||9<document.documentMode)}function sN(){Ty&&(Ty.detachEvent("onpropertychange",tG),u1=Ty=null)}function tG(e){if(e.propertyName==="value"&&rw(u1)){var t=[];JH(t,u1,e,zD(e)),OH(eoe,t)}}function roe(e,t,r){e==="focusin"?(sN(),Ty=t,u1=r,Ty.attachEvent("onpropertychange",tG)):e==="focusout"&&sN()}function noe(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return rw(u1)}function ioe(e,t){if(e==="click")return rw(t)}function aoe(e,t){if(e==="input"||e==="change")return rw(t)}function ooe(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var Eu=typeof Object.is=="function"?Object.is:ooe;function l1(e,t){if(Eu(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;var r=Object.keys(e),n=Object.keys(t);if(r.length!==n.length)return!1;for(n=0;n<r.length;n++){var i=r[n];if(!m4.call(t,i)||!Eu(e[i],t[i]))return!1}return!0}function uN(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function lN(e,t){var r=uN(e);e=0;for(var n;r;){if(r.nodeType===3){if(n=e+r.textContent.length,e<=t&&n>=t)return{node:r,offset:t-e};e=n}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=uN(r)}}function rG(e,t){return e&&t?e===t?!0:e&&e.nodeType===3?!1:t&&t.nodeType===3?rG(e,t.parentNode):"contains"in e?e.contains(t):e.compareDocumentPosition?!!(e.compareDocumentPosition(t)&16):!1:!1}function nG(){for(var e=window,t=ES();t instanceof e.HTMLIFrameElement;){try{var r=typeof t.contentWindow.location.href=="string"}catch{r=!1}if(r)e=t.contentWindow;else break;t=ES(e.document)}return t}function KD(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&(t==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||t==="textarea"||e.contentEditable==="true")}function soe(e){var t=nG(),r=e.focusedElem,n=e.selectionRange;if(t!==r&&r&&r.ownerDocument&&rG(r.ownerDocument.documentElement,r)){if(n!==null&&KD(r)){if(t=n.start,e=n.end,e===void 0&&(e=t),"selectionStart"in r)r.selectionStart=t,r.selectionEnd=Math.min(e,r.value.length);else if(e=(t=r.ownerDocument||document)&&t.defaultView||window,e.getSelection){e=e.getSelection();var i=r.textContent.length,a=Math.min(n.start,i);n=n.end===void 0?a:Math.min(n.end,i),!e.extend&&a>n&&(i=n,n=a,a=i),i=lN(r,a);var o=lN(r,n);i&&o&&(e.rangeCount!==1||e.anchorNode!==i.node||e.anchorOffset!==i.offset||e.focusNode!==o.node||e.focusOffset!==o.offset)&&(t=t.createRange(),t.setStart(i.node,i.offset),e.removeAllRanges(),a>n?(e.addRange(t),e.extend(o.node,o.offset)):(t.setEnd(o.node,o.offset),e.addRange(t)))}}for(t=[],e=r;e=e.parentNode;)e.nodeType===1&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for(typeof r.focus=="function"&&r.focus(),r=0;r<t.length;r++)e=t[r],e.element.scrollLeft=e.left,e.element.scrollTop=e.top}}var uoe=Cc&&"documentMode"in document&&11>=document.documentMode,fm=null,L4=null,Iy=null,N4=!1;function cN(e,t,r){var n=r.window===r?r.document:r.nodeType===9?r:r.ownerDocument;N4||fm==null||fm!==ES(n)||(n=fm,"selectionStart"in n&&KD(n)?n={start:n.selectionStart,end:n.selectionEnd}:(n=(n.ownerDocument&&n.ownerDocument.defaultView||window).getSelection(),n={anchorNode:n.anchorNode,anchorOffset:n.anchorOffset,focusNode:n.focusNode,focusOffset:n.focusOffset}),Iy&&l1(Iy,n)||(Iy=n,n=RS(L4,"onSelect"),0<n.length&&(t=new $D("onSelect","select",null,t,r),e.push({event:t,listeners:n}),t.target=fm)))}function h2(e,t){var r={};return r[e.toLowerCase()]=t.toLowerCase(),r["Webkit"+e]="webkit"+t,r["Moz"+e]="moz"+t,r}var hm={animationend:h2("Animation","AnimationEnd"),animationiteration:h2("Animation","AnimationIteration"),animationstart:h2("Animation","AnimationStart"),transitionend:h2("Transition","TransitionEnd")},YE={},iG={};Cc&&(iG=document.createElement("div").style,"AnimationEvent"in window||(delete hm.animationend.animation,delete hm.animationiteration.animation,delete hm.animationstart.animation),"TransitionEvent"in window||delete hm.transitionend.transition);function nw(e){if(YE[e])return YE[e];if(!hm[e])return e;var t=hm[e],r;for(r in t)if(t.hasOwnProperty(r)&&r in iG)return YE[e]=t[r];return e}var aG=nw("animationend"),oG=nw("animationiteration"),sG=nw("animationstart"),uG=nw("transitionend"),lG=new Map,dN="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function nh(e,t){lG.set(e,t),iv(t,[e])}for(var KE=0;KE<dN.length;KE++){var QE=dN[KE],loe=QE.toLowerCase(),coe=QE[0].toUpperCase()+QE.slice(1);nh(loe,"on"+coe)}nh(aG,"onAnimationEnd");nh(oG,"onAnimationIteration");nh(sG,"onAnimationStart");nh("dblclick","onDoubleClick");nh("focusin","onFocus");nh("focusout","onBlur");nh(uG,"onTransitionEnd");ng("onMouseEnter",["mouseout","mouseover"]);ng("onMouseLeave",["mouseout","mouseover"]);ng("onPointerEnter",["pointerout","pointerover"]);ng("onPointerLeave",["pointerout","pointerover"]);iv("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));iv("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));iv("onBeforeInput",["compositionend","keypress","textInput","paste"]);iv("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));iv("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));iv("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var ay="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),doe=new Set("cancel close invalid load scroll toggle".split(" ").concat(ay));function fN(e,t,r){var n=e.type||"unknown-event";e.currentTarget=r,lae(n,t,void 0,e),e.currentTarget=null}function cG(e,t){t=(t&4)!==0;for(var r=0;r<e.length;r++){var n=e[r],i=n.event;n=n.listeners;e:{var a=void 0;if(t)for(var o=n.length-1;0<=o;o--){var s=n[o],u=s.instance,l=s.currentTarget;if(s=s.listener,u!==a&&i.isPropagationStopped())break e;fN(i,s,l),a=u}else for(o=0;o<n.length;o++){if(s=n[o],u=s.instance,l=s.currentTarget,s=s.listener,u!==a&&i.isPropagationStopped())break e;fN(i,s,l),a=u}}}if(PS)throw e=D4,PS=!1,D4=null,e}function Fn(e,t){var r=t[z4];r===void 0&&(r=t[z4]=new Set);var n=e+"__bubble";r.has(n)||(dG(t,e,2,!1),r.add(n))}function ZE(e,t,r){var n=0;t&&(n|=4),dG(r,e,n,t)}var p2="_reactListening"+Math.random().toString(36).slice(2);function c1(e){if(!e[p2]){e[p2]=!0,yH.forEach(function(r){r!=="selectionchange"&&(doe.has(r)||ZE(r,!1,e),ZE(r,!0,e))});var t=e.nodeType===9?e:e.ownerDocument;t===null||t[p2]||(t[p2]=!0,ZE("selectionchange",!1,t))}}function dG(e,t,r,n){switch(XH(t)){case 1:var i=Eae;break;case 4:i=Aae;break;default:i=qD}r=i.bind(null,t,r,e),i=void 0,!M4||t!=="touchstart"&&t!=="touchmove"&&t!=="wheel"||(i=!0),n?i!==void 0?e.addEventListener(t,r,{capture:!0,passive:i}):e.addEventListener(t,r,!0):i!==void 0?e.addEventListener(t,r,{passive:i}):e.addEventListener(t,r,!1)}function JE(e,t,r,n,i){var a=n;if(!(t&1)&&!(t&2)&&n!==null)e:for(;;){if(n===null)return;var o=n.tag;if(o===3||o===4){var s=n.stateNode.containerInfo;if(s===i||s.nodeType===8&&s.parentNode===i)break;if(o===4)for(o=n.return;o!==null;){var u=o.tag;if((u===3||u===4)&&(u=o.stateNode.containerInfo,u===i||u.nodeType===8&&u.parentNode===i))return;o=o.return}for(;s!==null;){if(o=Jh(s),o===null)return;if(u=o.tag,u===5||u===6){n=a=o;continue e}s=s.parentNode}}n=n.return}OH(function(){var l=a,c=zD(r),d=[];e:{var f=lG.get(e);if(f!==void 0){var h=$D,v=e;switch(e){case"keypress":if(Hx(r)===0)break e;case"keydown":case"keyup":h=zae;break;case"focusin":v="focus",h=WE;break;case"focusout":v="blur",h=WE;break;case"beforeblur":case"afterblur":h=WE;break;case"click":if(r.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":h=eN;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":h=Iae;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":h=Gae;break;case aG:case oG:case sG:h=Rae;break;case uG:h=Wae;break;case"scroll":h=Pae;break;case"wheel":h=Xae;break;case"copy":case"cut":case"paste":h=Oae;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":h=rN}var p=(t&4)!==0,m=!p&&e==="scroll",g=p?f!==null?f+"Capture":null:f;p=[];for(var y=l,b;y!==null;){b=y;var S=b.stateNode;if(b.tag===5&&S!==null&&(b=S,g!==null&&(S=i1(y,g),S!=null&&p.push(d1(y,S,b)))),m)break;y=y.return}0<p.length&&(f=new h(f,v,null,r,c),d.push({event:f,listeners:p}))}}if(!(t&7)){e:{if(f=e==="mouseover"||e==="pointerover",h=e==="mouseout"||e==="pointerout",f&&r!==T4&&(v=r.relatedTarget||r.fromElement)&&(Jh(v)||v[_c]))break e;if((h||f)&&(f=c.window===c?c:(f=c.ownerDocument)?f.defaultView||f.parentWindow:window,h?(v=r.relatedTarget||r.toElement,h=l,v=v?Jh(v):null,v!==null&&(m=av(v),v!==m||v.tag!==5&&v.tag!==6)&&(v=null)):(h=null,v=l),h!==v)){if(p=eN,S="onMouseLeave",g="onMouseEnter",y="mouse",(e==="pointerout"||e==="pointerover")&&(p=rN,S="onPointerLeave",g="onPointerEnter",y="pointer"),m=h==null?f:pm(h),b=v==null?f:pm(v),f=new p(S,y+"leave",h,r,c),f.target=m,f.relatedTarget=b,S=null,Jh(c)===l&&(p=new p(g,y+"enter",v,r,c),p.target=b,p.relatedTarget=m,S=p),m=S,h&&v)t:{for(p=h,g=v,y=0,b=p;b;b=Fv(b))y++;for(b=0,S=g;S;S=Fv(S))b++;for(;0<y-b;)p=Fv(p),y--;for(;0<b-y;)g=Fv(g),b--;for(;y--;){if(p===g||g!==null&&p===g.alternate)break t;p=Fv(p),g=Fv(g)}p=null}else p=null;h!==null&&hN(d,f,h,p,!1),v!==null&&m!==null&&hN(d,m,v,p,!0)}}e:{if(f=l?pm(l):window,h=f.nodeName&&f.nodeName.toLowerCase(),h==="select"||h==="input"&&f.type==="file")var x=toe;else if(aN(f))if(eG)x=aoe;else{x=noe;var C=roe}else(h=f.nodeName)&&h.toLowerCase()==="input"&&(f.type==="checkbox"||f.type==="radio")&&(x=ioe);if(x&&(x=x(e,l))){JH(d,x,r,c);break e}C&&C(e,f,l),e==="focusout"&&(C=f._wrapperState)&&C.controlled&&f.type==="number"&&_4(f,"number",f.value)}switch(C=l?pm(l):window,e){case"focusin":(aN(C)||C.contentEditable==="true")&&(fm=C,L4=l,Iy=null);break;case"focusout":Iy=L4=fm=null;break;case"mousedown":N4=!0;break;case"contextmenu":case"mouseup":case"dragend":N4=!1,cN(d,r,c);break;case"selectionchange":if(uoe)break;case"keydown":case"keyup":cN(d,r,c)}var w;if(YD)e:{switch(e){case"compositionstart":var A="onCompositionStart";break e;case"compositionend":A="onCompositionEnd";break e;case"compositionupdate":A="onCompositionUpdate";break e}A=void 0}else dm?QH(e,r)&&(A="onCompositionEnd"):e==="keydown"&&r.keyCode===229&&(A="onCompositionStart");A&&(KH&&r.locale!=="ko"&&(dm||A!=="onCompositionStart"?A==="onCompositionEnd"&&dm&&(w=YH()):(lf=c,WD="value"in lf?lf.value:lf.textContent,dm=!0)),C=RS(l,A),0<C.length&&(A=new tN(A,e,null,r,c),d.push({event:A,listeners:C}),w?A.data=w:(w=ZH(r),w!==null&&(A.data=w)))),(w=Kae?Qae(e,r):Zae(e,r))&&(l=RS(l,"onBeforeInput"),0<l.length&&(c=new tN("onBeforeInput","beforeinput",null,r,c),d.push({event:c,listeners:l}),c.data=w))}cG(d,t)})}function d1(e,t,r){return{instance:e,listener:t,currentTarget:r}}function RS(e,t){for(var r=t+"Capture",n=[];e!==null;){var i=e,a=i.stateNode;i.tag===5&&a!==null&&(i=a,a=i1(e,r),a!=null&&n.unshift(d1(e,a,i)),a=i1(e,t),a!=null&&n.push(d1(e,a,i))),e=e.return}return n}function Fv(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5);return e||null}function hN(e,t,r,n,i){for(var a=t._reactName,o=[];r!==null&&r!==n;){var s=r,u=s.alternate,l=s.stateNode;if(u!==null&&u===n)break;s.tag===5&&l!==null&&(s=l,i?(u=i1(r,a),u!=null&&o.unshift(d1(r,u,s))):i||(u=i1(r,a),u!=null&&o.push(d1(r,u,s)))),r=r.return}o.length!==0&&e.push({event:t,listeners:o})}var foe=/\r\n?/g,hoe=/\u0000|\uFFFD/g;function pN(e){return(typeof e=="string"?e:""+e).replace(foe,`
`).replace(hoe,"")}function v2(e,t,r){if(t=pN(t),pN(e)!==t&&r)throw Error(Tt(425))}function kS(){}var F4=null,B4=null;function U4(e,t){return e==="textarea"||e==="noscript"||typeof t.children=="string"||typeof t.children=="number"||typeof t.dangerouslySetInnerHTML=="object"&&t.dangerouslySetInnerHTML!==null&&t.dangerouslySetInnerHTML.__html!=null}var j4=typeof setTimeout=="function"?setTimeout:void 0,poe=typeof clearTimeout=="function"?clearTimeout:void 0,vN=typeof Promise=="function"?Promise:void 0,voe=typeof queueMicrotask=="function"?queueMicrotask:typeof vN<"u"?function(e){return vN.resolve(null).then(e).catch(moe)}:j4;function moe(e){setTimeout(function(){throw e})}function eA(e,t){var r=t,n=0;do{var i=r.nextSibling;if(e.removeChild(r),i&&i.nodeType===8)if(r=i.data,r==="/$"){if(n===0){e.removeChild(i),s1(t);return}n--}else r!=="$"&&r!=="$?"&&r!=="$!"||n++;r=i}while(r);s1(t)}function _f(e){for(;e!=null;e=e.nextSibling){var t=e.nodeType;if(t===1||t===3)break;if(t===8){if(t=e.data,t==="$"||t==="$!"||t==="$?")break;if(t==="/$")return null}}return e}function mN(e){e=e.previousSibling;for(var t=0;e;){if(e.nodeType===8){var r=e.data;if(r==="$"||r==="$!"||r==="$?"){if(t===0)return e;t--}else r==="/$"&&t++}e=e.previousSibling}return null}var Lg=Math.random().toString(36).slice(2),al="__reactFiber$"+Lg,f1="__reactProps$"+Lg,_c="__reactContainer$"+Lg,z4="__reactEvents$"+Lg,goe="__reactListeners$"+Lg,yoe="__reactHandles$"+Lg;function Jh(e){var t=e[al];if(t)return t;for(var r=e.parentNode;r;){if(t=r[_c]||r[al]){if(r=t.alternate,t.child!==null||r!==null&&r.child!==null)for(e=mN(e);e!==null;){if(r=e[al])return r;e=mN(e)}return t}e=r,r=e.parentNode}return null}function lb(e){return e=e[al]||e[_c],!e||e.tag!==5&&e.tag!==6&&e.tag!==13&&e.tag!==3?null:e}function pm(e){if(e.tag===5||e.tag===6)return e.stateNode;throw Error(Tt(33))}function iw(e){return e[f1]||null}var V4=[],vm=-1;function ih(e){return{current:e}}function Hn(e){0>vm||(e.current=V4[vm],V4[vm]=null,vm--)}function kn(e,t){vm++,V4[vm]=e.current,e.current=t}var Uf={},Ra=ih(Uf),ho=ih(!1),Ap=Uf;function ig(e,t){var r=e.type.contextTypes;if(!r)return Uf;var n=e.stateNode;if(n&&n.__reactInternalMemoizedUnmaskedChildContext===t)return n.__reactInternalMemoizedMaskedChildContext;var i={},a;for(a in r)i[a]=t[a];return n&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=i),i}function po(e){return e=e.childContextTypes,e!=null}function OS(){Hn(ho),Hn(Ra)}function gN(e,t,r){if(Ra.current!==Uf)throw Error(Tt(168));kn(Ra,t),kn(ho,r)}function fG(e,t,r){var n=e.stateNode;if(t=t.childContextTypes,typeof n.getChildContext!="function")return r;n=n.getChildContext();for(var i in n)if(!(i in t))throw Error(Tt(108,rae(e)||"Unknown",i));return ui({},r,n)}function LS(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Uf,Ap=Ra.current,kn(Ra,e),kn(ho,ho.current),!0}function yN(e,t,r){var n=e.stateNode;if(!n)throw Error(Tt(169));r?(e=fG(e,t,Ap),n.__reactInternalMemoizedMergedChildContext=e,Hn(ho),Hn(Ra),kn(Ra,e)):Hn(ho),kn(ho,r)}var ec=null,aw=!1,tA=!1;function hG(e){ec===null?ec=[e]:ec.push(e)}function boe(e){aw=!0,hG(e)}function ah(){if(!tA&&ec!==null){tA=!0;var e=0,t=xn;try{var r=ec;for(xn=1;e<r.length;e++){var n=r[e];do n=n(!0);while(n!==null)}ec=null,aw=!1}catch(i){throw ec!==null&&(ec=ec.slice(e+1)),BH(VD,ah),i}finally{xn=t,tA=!1}}return null}var mm=[],gm=0,NS=null,FS=0,_s=[],ws=0,Pp=null,oc=1,sc="";function Bh(e,t){mm[gm++]=FS,mm[gm++]=NS,NS=e,FS=t}function pG(e,t,r){_s[ws++]=oc,_s[ws++]=sc,_s[ws++]=Pp,Pp=e;var n=oc;e=sc;var i=32-hu(n)-1;n&=~(1<<i),r+=1;var a=32-hu(t)+i;if(30<a){var o=i-i%5;a=(n&(1<<o)-1).toString(32),n>>=o,i-=o,oc=1<<32-hu(t)+i|r<<i|n,sc=a+e}else oc=1<<a|r<<i|n,sc=e}function QD(e){e.return!==null&&(Bh(e,1),pG(e,1,0))}function ZD(e){for(;e===NS;)NS=mm[--gm],mm[gm]=null,FS=mm[--gm],mm[gm]=null;for(;e===Pp;)Pp=_s[--ws],_s[ws]=null,sc=_s[--ws],_s[ws]=null,oc=_s[--ws],_s[ws]=null}var jo=null,No=null,Zn=!1,nu=null;function vG(e,t){var r=Es(5,null,null,0);r.elementType="DELETED",r.stateNode=t,r.return=e,t=e.deletions,t===null?(e.deletions=[r],e.flags|=16):t.push(r)}function bN(e,t){switch(e.tag){case 5:var r=e.type;return t=t.nodeType!==1||r.toLowerCase()!==t.nodeName.toLowerCase()?null:t,t!==null?(e.stateNode=t,jo=e,No=_f(t.firstChild),!0):!1;case 6:return t=e.pendingProps===""||t.nodeType!==3?null:t,t!==null?(e.stateNode=t,jo=e,No=null,!0):!1;case 13:return t=t.nodeType!==8?null:t,t!==null?(r=Pp!==null?{id:oc,overflow:sc}:null,e.memoizedState={dehydrated:t,treeContext:r,retryLane:1073741824},r=Es(18,null,null,0),r.stateNode=t,r.return=e,e.child=r,jo=e,No=null,!0):!1;default:return!1}}function H4(e){return(e.mode&1)!==0&&(e.flags&128)===0}function G4(e){if(Zn){var t=No;if(t){var r=t;if(!bN(e,t)){if(H4(e))throw Error(Tt(418));t=_f(r.nextSibling);var n=jo;t&&bN(e,t)?vG(n,r):(e.flags=e.flags&-4097|2,Zn=!1,jo=e)}}else{if(H4(e))throw Error(Tt(418));e.flags=e.flags&-4097|2,Zn=!1,jo=e}}}function xN(e){for(e=e.return;e!==null&&e.tag!==5&&e.tag!==3&&e.tag!==13;)e=e.return;jo=e}function m2(e){if(e!==jo)return!1;if(!Zn)return xN(e),Zn=!0,!1;var t;if((t=e.tag!==3)&&!(t=e.tag!==5)&&(t=e.type,t=t!=="head"&&t!=="body"&&!U4(e.type,e.memoizedProps)),t&&(t=No)){if(H4(e))throw mG(),Error(Tt(418));for(;t;)vG(e,t),t=_f(t.nextSibling)}if(xN(e),e.tag===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(Tt(317));e:{for(e=e.nextSibling,t=0;e;){if(e.nodeType===8){var r=e.data;if(r==="/$"){if(t===0){No=_f(e.nextSibling);break e}t--}else r!=="$"&&r!=="$!"&&r!=="$?"||t++}e=e.nextSibling}No=null}}else No=jo?_f(e.stateNode.nextSibling):null;return!0}function mG(){for(var e=No;e;)e=_f(e.nextSibling)}function ag(){No=jo=null,Zn=!1}function JD(e){nu===null?nu=[e]:nu.push(e)}var xoe=Yc.ReactCurrentBatchConfig;function Js(e,t){if(e&&e.defaultProps){t=ui({},t),e=e.defaultProps;for(var r in e)t[r]===void 0&&(t[r]=e[r]);return t}return t}var BS=ih(null),US=null,ym=null,eR=null;function tR(){eR=ym=US=null}function rR(e){var t=BS.current;Hn(BS),e._currentValue=t}function q4(e,t,r){for(;e!==null;){var n=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,n!==null&&(n.childLanes|=t)):n!==null&&(n.childLanes&t)!==t&&(n.childLanes|=t),e===r)break;e=e.return}}function Nm(e,t){US=e,eR=ym=null,e=e.dependencies,e!==null&&e.firstContext!==null&&(e.lanes&t&&(fo=!0),e.firstContext=null)}function Rs(e){var t=e._currentValue;if(eR!==e)if(e={context:e,memoizedValue:t,next:null},ym===null){if(US===null)throw Error(Tt(308));ym=e,US.dependencies={lanes:0,firstContext:e}}else ym=ym.next=e;return t}var ep=null;function nR(e){ep===null?ep=[e]:ep.push(e)}function gG(e,t,r,n){var i=t.interleaved;return i===null?(r.next=r,nR(t)):(r.next=i.next,i.next=r),t.interleaved=r,wc(e,n)}function wc(e,t){e.lanes|=t;var r=e.alternate;for(r!==null&&(r.lanes|=t),r=e,e=e.return;e!==null;)e.childLanes|=t,r=e.alternate,r!==null&&(r.childLanes|=t),r=e,e=e.return;return r.tag===3?r.stateNode:null}var Hd=!1;function iR(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function yG(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function pc(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function wf(e,t,r){var n=e.updateQueue;if(n===null)return null;if(n=n.shared,an&2){var i=n.pending;return i===null?t.next=t:(t.next=i.next,i.next=t),n.pending=t,wc(e,r)}return i=n.interleaved,i===null?(t.next=t,nR(n)):(t.next=i.next,i.next=t),n.interleaved=t,wc(e,r)}function Gx(e,t,r){if(t=t.updateQueue,t!==null&&(t=t.shared,(r&4194240)!==0)){var n=t.lanes;n&=e.pendingLanes,r|=n,t.lanes=r,HD(e,r)}}function SN(e,t){var r=e.updateQueue,n=e.alternate;if(n!==null&&(n=n.updateQueue,r===n)){var i=null,a=null;if(r=r.firstBaseUpdate,r!==null){do{var o={eventTime:r.eventTime,lane:r.lane,tag:r.tag,payload:r.payload,callback:r.callback,next:null};a===null?i=a=o:a=a.next=o,r=r.next}while(r!==null);a===null?i=a=t:a=a.next=t}else i=a=t;r={baseState:n.baseState,firstBaseUpdate:i,lastBaseUpdate:a,shared:n.shared,effects:n.effects},e.updateQueue=r;return}e=r.lastBaseUpdate,e===null?r.firstBaseUpdate=t:e.next=t,r.lastBaseUpdate=t}function jS(e,t,r,n){var i=e.updateQueue;Hd=!1;var a=i.firstBaseUpdate,o=i.lastBaseUpdate,s=i.shared.pending;if(s!==null){i.shared.pending=null;var u=s,l=u.next;u.next=null,o===null?a=l:o.next=l,o=u;var c=e.alternate;c!==null&&(c=c.updateQueue,s=c.lastBaseUpdate,s!==o&&(s===null?c.firstBaseUpdate=l:s.next=l,c.lastBaseUpdate=u))}if(a!==null){var d=i.baseState;o=0,c=l=u=null,s=a;do{var f=s.lane,h=s.eventTime;if((n&f)===f){c!==null&&(c=c.next={eventTime:h,lane:0,tag:s.tag,payload:s.payload,callback:s.callback,next:null});e:{var v=e,p=s;switch(f=t,h=r,p.tag){case 1:if(v=p.payload,typeof v=="function"){d=v.call(h,d,f);break e}d=v;break e;case 3:v.flags=v.flags&-65537|128;case 0:if(v=p.payload,f=typeof v=="function"?v.call(h,d,f):v,f==null)break e;d=ui({},d,f);break e;case 2:Hd=!0}}s.callback!==null&&s.lane!==0&&(e.flags|=64,f=i.effects,f===null?i.effects=[s]:f.push(s))}else h={eventTime:h,lane:f,tag:s.tag,payload:s.payload,callback:s.callback,next:null},c===null?(l=c=h,u=d):c=c.next=h,o|=f;if(s=s.next,s===null){if(s=i.shared.pending,s===null)break;f=s,s=f.next,f.next=null,i.lastBaseUpdate=f,i.shared.pending=null}}while(1);if(c===null&&(u=d),i.baseState=u,i.firstBaseUpdate=l,i.lastBaseUpdate=c,t=i.shared.interleaved,t!==null){i=t;do o|=i.lane,i=i.next;while(i!==t)}else a===null&&(i.shared.lanes=0);Ip|=o,e.lanes=o,e.memoizedState=d}}function CN(e,t,r){if(e=t.effects,t.effects=null,e!==null)for(t=0;t<e.length;t++){var n=e[t],i=n.callback;if(i!==null){if(n.callback=null,n=r,typeof i!="function")throw Error(Tt(191,i));i.call(n)}}}var bG=new gH.Component().refs;function W4(e,t,r,n){t=e.memoizedState,r=r(n,t),r=r==null?t:ui({},t,r),e.memoizedState=r,e.lanes===0&&(e.updateQueue.baseState=r)}var ow={isMounted:function(e){return(e=e._reactInternals)?av(e)===e:!1},enqueueSetState:function(e,t,r){e=e._reactInternals;var n=qa(),i=Af(e),a=pc(n,i);a.payload=t,r!=null&&(a.callback=r),t=wf(e,a,i),t!==null&&(pu(t,e,i,n),Gx(t,e,i))},enqueueReplaceState:function(e,t,r){e=e._reactInternals;var n=qa(),i=Af(e),a=pc(n,i);a.tag=1,a.payload=t,r!=null&&(a.callback=r),t=wf(e,a,i),t!==null&&(pu(t,e,i,n),Gx(t,e,i))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var r=qa(),n=Af(e),i=pc(r,n);i.tag=2,t!=null&&(i.callback=t),t=wf(e,i,n),t!==null&&(pu(t,e,n,r),Gx(t,e,n))}};function _N(e,t,r,n,i,a,o){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(n,a,o):t.prototype&&t.prototype.isPureReactComponent?!l1(r,n)||!l1(i,a):!0}function xG(e,t,r){var n=!1,i=Uf,a=t.contextType;return typeof a=="object"&&a!==null?a=Rs(a):(i=po(t)?Ap:Ra.current,n=t.contextTypes,a=(n=n!=null)?ig(e,i):Uf),t=new t(r,a),e.memoizedState=t.state!==null&&t.state!==void 0?t.state:null,t.updater=ow,e.stateNode=t,t._reactInternals=e,n&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=i,e.__reactInternalMemoizedMaskedChildContext=a),t}function wN(e,t,r,n){e=t.state,typeof t.componentWillReceiveProps=="function"&&t.componentWillReceiveProps(r,n),typeof t.UNSAFE_componentWillReceiveProps=="function"&&t.UNSAFE_componentWillReceiveProps(r,n),t.state!==e&&ow.enqueueReplaceState(t,t.state,null)}function $4(e,t,r,n){var i=e.stateNode;i.props=r,i.state=e.memoizedState,i.refs=bG,iR(e);var a=t.contextType;typeof a=="object"&&a!==null?i.context=Rs(a):(a=po(t)?Ap:Ra.current,i.context=ig(e,a)),i.state=e.memoizedState,a=t.getDerivedStateFromProps,typeof a=="function"&&(W4(e,t,a,r),i.state=e.memoizedState),typeof t.getDerivedStateFromProps=="function"||typeof i.getSnapshotBeforeUpdate=="function"||typeof i.UNSAFE_componentWillMount!="function"&&typeof i.componentWillMount!="function"||(t=i.state,typeof i.componentWillMount=="function"&&i.componentWillMount(),typeof i.UNSAFE_componentWillMount=="function"&&i.UNSAFE_componentWillMount(),t!==i.state&&ow.enqueueReplaceState(i,i.state,null),jS(e,r,i,n),i.state=e.memoizedState),typeof i.componentDidMount=="function"&&(e.flags|=4194308)}function x0(e,t,r){if(e=r.ref,e!==null&&typeof e!="function"&&typeof e!="object"){if(r._owner){if(r=r._owner,r){if(r.tag!==1)throw Error(Tt(309));var n=r.stateNode}if(!n)throw Error(Tt(147,e));var i=n,a=""+e;return t!==null&&t.ref!==null&&typeof t.ref=="function"&&t.ref._stringRef===a?t.ref:(t=function(o){var s=i.refs;s===bG&&(s=i.refs={}),o===null?delete s[a]:s[a]=o},t._stringRef=a,t)}if(typeof e!="string")throw Error(Tt(284));if(!r._owner)throw Error(Tt(290,e))}return e}function g2(e,t){throw e=Object.prototype.toString.call(t),Error(Tt(31,e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function EN(e){var t=e._init;return t(e._payload)}function SG(e){function t(g,y){if(e){var b=g.deletions;b===null?(g.deletions=[y],g.flags|=16):b.push(y)}}function r(g,y){if(!e)return null;for(;y!==null;)t(g,y),y=y.sibling;return null}function n(g,y){for(g=new Map;y!==null;)y.key!==null?g.set(y.key,y):g.set(y.index,y),y=y.sibling;return g}function i(g,y){return g=Pf(g,y),g.index=0,g.sibling=null,g}function a(g,y,b){return g.index=b,e?(b=g.alternate,b!==null?(b=b.index,b<y?(g.flags|=2,y):b):(g.flags|=2,y)):(g.flags|=1048576,y)}function o(g){return e&&g.alternate===null&&(g.flags|=2),g}function s(g,y,b,S){return y===null||y.tag!==6?(y=uA(b,g.mode,S),y.return=g,y):(y=i(y,b),y.return=g,y)}function u(g,y,b,S){var x=b.type;return x===cm?c(g,y,b.props.children,S,b.key):y!==null&&(y.elementType===x||typeof x=="object"&&x!==null&&x.$$typeof===Vd&&EN(x)===y.type)?(S=i(y,b.props),S.ref=x0(g,y,b),S.return=g,S):(S=Kx(b.type,b.key,b.props,null,g.mode,S),S.ref=x0(g,y,b),S.return=g,S)}function l(g,y,b,S){return y===null||y.tag!==4||y.stateNode.containerInfo!==b.containerInfo||y.stateNode.implementation!==b.implementation?(y=lA(b,g.mode,S),y.return=g,y):(y=i(y,b.children||[]),y.return=g,y)}function c(g,y,b,S,x){return y===null||y.tag!==7?(y=dp(b,g.mode,S,x),y.return=g,y):(y=i(y,b),y.return=g,y)}function d(g,y,b){if(typeof y=="string"&&y!==""||typeof y=="number")return y=uA(""+y,g.mode,b),y.return=g,y;if(typeof y=="object"&&y!==null){switch(y.$$typeof){case o2:return b=Kx(y.type,y.key,y.props,null,g.mode,b),b.ref=x0(g,null,y),b.return=g,b;case lm:return y=lA(y,g.mode,b),y.return=g,y;case Vd:var S=y._init;return d(g,S(y._payload),b)}if(ny(y)||v0(y))return y=dp(y,g.mode,b,null),y.return=g,y;g2(g,y)}return null}function f(g,y,b,S){var x=y!==null?y.key:null;if(typeof b=="string"&&b!==""||typeof b=="number")return x!==null?null:s(g,y,""+b,S);if(typeof b=="object"&&b!==null){switch(b.$$typeof){case o2:return b.key===x?u(g,y,b,S):null;case lm:return b.key===x?l(g,y,b,S):null;case Vd:return x=b._init,f(g,y,x(b._payload),S)}if(ny(b)||v0(b))return x!==null?null:c(g,y,b,S,null);g2(g,b)}return null}function h(g,y,b,S,x){if(typeof S=="string"&&S!==""||typeof S=="number")return g=g.get(b)||null,s(y,g,""+S,x);if(typeof S=="object"&&S!==null){switch(S.$$typeof){case o2:return g=g.get(S.key===null?b:S.key)||null,u(y,g,S,x);case lm:return g=g.get(S.key===null?b:S.key)||null,l(y,g,S,x);case Vd:var C=S._init;return h(g,y,b,C(S._payload),x)}if(ny(S)||v0(S))return g=g.get(b)||null,c(y,g,S,x,null);g2(y,S)}return null}function v(g,y,b,S){for(var x=null,C=null,w=y,A=y=0,M=null;w!==null&&A<b.length;A++){w.index>A?(M=w,w=null):M=w.sibling;var D=f(g,w,b[A],S);if(D===null){w===null&&(w=M);break}e&&w&&D.alternate===null&&t(g,w),y=a(D,y,A),C===null?x=D:C.sibling=D,C=D,w=M}if(A===b.length)return r(g,w),Zn&&Bh(g,A),x;if(w===null){for(;A<b.length;A++)w=d(g,b[A],S),w!==null&&(y=a(w,y,A),C===null?x=w:C.sibling=w,C=w);return Zn&&Bh(g,A),x}for(w=n(g,w);A<b.length;A++)M=h(w,g,A,b[A],S),M!==null&&(e&&M.alternate!==null&&w.delete(M.key===null?A:M.key),y=a(M,y,A),C===null?x=M:C.sibling=M,C=M);return e&&w.forEach(function(k){return t(g,k)}),Zn&&Bh(g,A),x}function p(g,y,b,S){var x=v0(b);if(typeof x!="function")throw Error(Tt(150));if(b=x.call(b),b==null)throw Error(Tt(151));for(var C=x=null,w=y,A=y=0,M=null,D=b.next();w!==null&&!D.done;A++,D=b.next()){w.index>A?(M=w,w=null):M=w.sibling;var k=f(g,w,D.value,S);if(k===null){w===null&&(w=M);break}e&&w&&k.alternate===null&&t(g,w),y=a(k,y,A),C===null?x=k:C.sibling=k,C=k,w=M}if(D.done)return r(g,w),Zn&&Bh(g,A),x;if(w===null){for(;!D.done;A++,D=b.next())D=d(g,D.value,S),D!==null&&(y=a(D,y,A),C===null?x=D:C.sibling=D,C=D);return Zn&&Bh(g,A),x}for(w=n(g,w);!D.done;A++,D=b.next())D=h(w,g,A,D.value,S),D!==null&&(e&&D.alternate!==null&&w.delete(D.key===null?A:D.key),y=a(D,y,A),C===null?x=D:C.sibling=D,C=D);return e&&w.forEach(function(R){return t(g,R)}),Zn&&Bh(g,A),x}function m(g,y,b,S){if(typeof b=="object"&&b!==null&&b.type===cm&&b.key===null&&(b=b.props.children),typeof b=="object"&&b!==null){switch(b.$$typeof){case o2:e:{for(var x=b.key,C=y;C!==null;){if(C.key===x){if(x=b.type,x===cm){if(C.tag===7){r(g,C.sibling),y=i(C,b.props.children),y.return=g,g=y;break e}}else if(C.elementType===x||typeof x=="object"&&x!==null&&x.$$typeof===Vd&&EN(x)===C.type){r(g,C.sibling),y=i(C,b.props),y.ref=x0(g,C,b),y.return=g,g=y;break e}r(g,C);break}else t(g,C);C=C.sibling}b.type===cm?(y=dp(b.props.children,g.mode,S,b.key),y.return=g,g=y):(S=Kx(b.type,b.key,b.props,null,g.mode,S),S.ref=x0(g,y,b),S.return=g,g=S)}return o(g);case lm:e:{for(C=b.key;y!==null;){if(y.key===C)if(y.tag===4&&y.stateNode.containerInfo===b.containerInfo&&y.stateNode.implementation===b.implementation){r(g,y.sibling),y=i(y,b.children||[]),y.return=g,g=y;break e}else{r(g,y);break}else t(g,y);y=y.sibling}y=lA(b,g.mode,S),y.return=g,g=y}return o(g);case Vd:return C=b._init,m(g,y,C(b._payload),S)}if(ny(b))return v(g,y,b,S);if(v0(b))return p(g,y,b,S);g2(g,b)}return typeof b=="string"&&b!==""||typeof b=="number"?(b=""+b,y!==null&&y.tag===6?(r(g,y.sibling),y=i(y,b),y.return=g,g=y):(r(g,y),y=uA(b,g.mode,S),y.return=g,g=y),o(g)):r(g,y)}return m}var og=SG(!0),CG=SG(!1),cb={},hl=ih(cb),h1=ih(cb),p1=ih(cb);function tp(e){if(e===cb)throw Error(Tt(174));return e}function aR(e,t){switch(kn(p1,t),kn(h1,e),kn(hl,cb),e=t.nodeType,e){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:E4(null,"");break;default:e=e===8?t.parentNode:t,t=e.namespaceURI||null,e=e.tagName,t=E4(t,e)}Hn(hl),kn(hl,t)}function sg(){Hn(hl),Hn(h1),Hn(p1)}function _G(e){tp(p1.current);var t=tp(hl.current),r=E4(t,e.type);t!==r&&(kn(h1,e),kn(hl,r))}function oR(e){h1.current===e&&(Hn(hl),Hn(h1))}var ni=ih(0);function zS(e){for(var t=e;t!==null;){if(t.tag===13){var r=t.memoizedState;if(r!==null&&(r=r.dehydrated,r===null||r.data==="$?"||r.data==="$!"))return t}else if(t.tag===19&&t.memoizedProps.revealOrder!==void 0){if(t.flags&128)return t}else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var rA=[];function sR(){for(var e=0;e<rA.length;e++)rA[e]._workInProgressVersionPrimary=null;rA.length=0}var qx=Yc.ReactCurrentDispatcher,nA=Yc.ReactCurrentBatchConfig,Tp=0,oi=null,Oi=null,Ji=null,VS=!1,My=!1,v1=0,Soe=0;function ya(){throw Error(Tt(321))}function uR(e,t){if(t===null)return!1;for(var r=0;r<t.length&&r<e.length;r++)if(!Eu(e[r],t[r]))return!1;return!0}function lR(e,t,r,n,i,a){if(Tp=a,oi=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,qx.current=e===null||e.memoizedState===null?Eoe:Aoe,e=r(n,i),My){a=0;do{if(My=!1,v1=0,25<=a)throw Error(Tt(301));a+=1,Ji=Oi=null,t.updateQueue=null,qx.current=Poe,e=r(n,i)}while(My)}if(qx.current=HS,t=Oi!==null&&Oi.next!==null,Tp=0,Ji=Oi=oi=null,VS=!1,t)throw Error(Tt(300));return e}function cR(){var e=v1!==0;return v1=0,e}function Qu(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Ji===null?oi.memoizedState=Ji=e:Ji=Ji.next=e,Ji}function ks(){if(Oi===null){var e=oi.alternate;e=e!==null?e.memoizedState:null}else e=Oi.next;var t=Ji===null?oi.memoizedState:Ji.next;if(t!==null)Ji=t,Oi=e;else{if(e===null)throw Error(Tt(310));Oi=e,e={memoizedState:Oi.memoizedState,baseState:Oi.baseState,baseQueue:Oi.baseQueue,queue:Oi.queue,next:null},Ji===null?oi.memoizedState=Ji=e:Ji=Ji.next=e}return Ji}function m1(e,t){return typeof t=="function"?t(e):t}function iA(e){var t=ks(),r=t.queue;if(r===null)throw Error(Tt(311));r.lastRenderedReducer=e;var n=Oi,i=n.baseQueue,a=r.pending;if(a!==null){if(i!==null){var o=i.next;i.next=a.next,a.next=o}n.baseQueue=i=a,r.pending=null}if(i!==null){a=i.next,n=n.baseState;var s=o=null,u=null,l=a;do{var c=l.lane;if((Tp&c)===c)u!==null&&(u=u.next={lane:0,action:l.action,hasEagerState:l.hasEagerState,eagerState:l.eagerState,next:null}),n=l.hasEagerState?l.eagerState:e(n,l.action);else{var d={lane:c,action:l.action,hasEagerState:l.hasEagerState,eagerState:l.eagerState,next:null};u===null?(s=u=d,o=n):u=u.next=d,oi.lanes|=c,Ip|=c}l=l.next}while(l!==null&&l!==a);u===null?o=n:u.next=s,Eu(n,t.memoizedState)||(fo=!0),t.memoizedState=n,t.baseState=o,t.baseQueue=u,r.lastRenderedState=n}if(e=r.interleaved,e!==null){i=e;do a=i.lane,oi.lanes|=a,Ip|=a,i=i.next;while(i!==e)}else i===null&&(r.lanes=0);return[t.memoizedState,r.dispatch]}function aA(e){var t=ks(),r=t.queue;if(r===null)throw Error(Tt(311));r.lastRenderedReducer=e;var n=r.dispatch,i=r.pending,a=t.memoizedState;if(i!==null){r.pending=null;var o=i=i.next;do a=e(a,o.action),o=o.next;while(o!==i);Eu(a,t.memoizedState)||(fo=!0),t.memoizedState=a,t.baseQueue===null&&(t.baseState=a),r.lastRenderedState=a}return[a,n]}function wG(){}function EG(e,t){var r=oi,n=ks(),i=t(),a=!Eu(n.memoizedState,i);if(a&&(n.memoizedState=i,fo=!0),n=n.queue,dR(TG.bind(null,r,n,e),[e]),n.getSnapshot!==t||a||Ji!==null&&Ji.memoizedState.tag&1){if(r.flags|=2048,g1(9,PG.bind(null,r,n,i,t),void 0,null),ta===null)throw Error(Tt(349));Tp&30||AG(r,t,i)}return i}function AG(e,t,r){e.flags|=16384,e={getSnapshot:t,value:r},t=oi.updateQueue,t===null?(t={lastEffect:null,stores:null},oi.updateQueue=t,t.stores=[e]):(r=t.stores,r===null?t.stores=[e]:r.push(e))}function PG(e,t,r,n){t.value=r,t.getSnapshot=n,IG(t)&&MG(e)}function TG(e,t,r){return r(function(){IG(t)&&MG(e)})}function IG(e){var t=e.getSnapshot;e=e.value;try{var r=t();return!Eu(e,r)}catch{return!0}}function MG(e){var t=wc(e,1);t!==null&&pu(t,e,1,-1)}function AN(e){var t=Qu();return typeof e=="function"&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:m1,lastRenderedState:e},t.queue=e,e=e.dispatch=woe.bind(null,oi,e),[t.memoizedState,e]}function g1(e,t,r,n){return e={tag:e,create:t,destroy:r,deps:n,next:null},t=oi.updateQueue,t===null?(t={lastEffect:null,stores:null},oi.updateQueue=t,t.lastEffect=e.next=e):(r=t.lastEffect,r===null?t.lastEffect=e.next=e:(n=r.next,r.next=e,e.next=n,t.lastEffect=e)),e}function DG(){return ks().memoizedState}function Wx(e,t,r,n){var i=Qu();oi.flags|=e,i.memoizedState=g1(1|t,r,void 0,n===void 0?null:n)}function sw(e,t,r,n){var i=ks();n=n===void 0?null:n;var a=void 0;if(Oi!==null){var o=Oi.memoizedState;if(a=o.destroy,n!==null&&uR(n,o.deps)){i.memoizedState=g1(t,r,a,n);return}}oi.flags|=e,i.memoizedState=g1(1|t,r,a,n)}function PN(e,t){return Wx(8390656,8,e,t)}function dR(e,t){return sw(2048,8,e,t)}function RG(e,t){return sw(4,2,e,t)}function kG(e,t){return sw(4,4,e,t)}function OG(e,t){if(typeof t=="function")return e=e(),t(e),function(){t(null)};if(t!=null)return e=e(),t.current=e,function(){t.current=null}}function LG(e,t,r){return r=r!=null?r.concat([e]):null,sw(4,4,OG.bind(null,t,e),r)}function fR(){}function NG(e,t){var r=ks();t=t===void 0?null:t;var n=r.memoizedState;return n!==null&&t!==null&&uR(t,n[1])?n[0]:(r.memoizedState=[e,t],e)}function FG(e,t){var r=ks();t=t===void 0?null:t;var n=r.memoizedState;return n!==null&&t!==null&&uR(t,n[1])?n[0]:(e=e(),r.memoizedState=[e,t],e)}function BG(e,t,r){return Tp&21?(Eu(r,t)||(r=zH(),oi.lanes|=r,Ip|=r,e.baseState=!0),t):(e.baseState&&(e.baseState=!1,fo=!0),e.memoizedState=r)}function Coe(e,t){var r=xn;xn=r!==0&&4>r?r:4,e(!0);var n=nA.transition;nA.transition={};try{e(!1),t()}finally{xn=r,nA.transition=n}}function UG(){return ks().memoizedState}function _oe(e,t,r){var n=Af(e);if(r={lane:n,action:r,hasEagerState:!1,eagerState:null,next:null},jG(e))zG(t,r);else if(r=gG(e,t,r,n),r!==null){var i=qa();pu(r,e,n,i),VG(r,t,n)}}function woe(e,t,r){var n=Af(e),i={lane:n,action:r,hasEagerState:!1,eagerState:null,next:null};if(jG(e))zG(t,i);else{var a=e.alternate;if(e.lanes===0&&(a===null||a.lanes===0)&&(a=t.lastRenderedReducer,a!==null))try{var o=t.lastRenderedState,s=a(o,r);if(i.hasEagerState=!0,i.eagerState=s,Eu(s,o)){var u=t.interleaved;u===null?(i.next=i,nR(t)):(i.next=u.next,u.next=i),t.interleaved=i;return}}catch{}finally{}r=gG(e,t,i,n),r!==null&&(i=qa(),pu(r,e,n,i),VG(r,t,n))}}function jG(e){var t=e.alternate;return e===oi||t!==null&&t===oi}function zG(e,t){My=VS=!0;var r=e.pending;r===null?t.next=t:(t.next=r.next,r.next=t),e.pending=t}function VG(e,t,r){if(r&4194240){var n=t.lanes;n&=e.pendingLanes,r|=n,t.lanes=r,HD(e,r)}}var HS={readContext:Rs,useCallback:ya,useContext:ya,useEffect:ya,useImperativeHandle:ya,useInsertionEffect:ya,useLayoutEffect:ya,useMemo:ya,useReducer:ya,useRef:ya,useState:ya,useDebugValue:ya,useDeferredValue:ya,useTransition:ya,useMutableSource:ya,useSyncExternalStore:ya,useId:ya,unstable_isNewReconciler:!1},Eoe={readContext:Rs,useCallback:function(e,t){return Qu().memoizedState=[e,t===void 0?null:t],e},useContext:Rs,useEffect:PN,useImperativeHandle:function(e,t,r){return r=r!=null?r.concat([e]):null,Wx(4194308,4,OG.bind(null,t,e),r)},useLayoutEffect:function(e,t){return Wx(4194308,4,e,t)},useInsertionEffect:function(e,t){return Wx(4,2,e,t)},useMemo:function(e,t){var r=Qu();return t=t===void 0?null:t,e=e(),r.memoizedState=[e,t],e},useReducer:function(e,t,r){var n=Qu();return t=r!==void 0?r(t):t,n.memoizedState=n.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},n.queue=e,e=e.dispatch=_oe.bind(null,oi,e),[n.memoizedState,e]},useRef:function(e){var t=Qu();return e={current:e},t.memoizedState=e},useState:AN,useDebugValue:fR,useDeferredValue:function(e){return Qu().memoizedState=e},useTransition:function(){var e=AN(!1),t=e[0];return e=Coe.bind(null,e[1]),Qu().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,r){var n=oi,i=Qu();if(Zn){if(r===void 0)throw Error(Tt(407));r=r()}else{if(r=t(),ta===null)throw Error(Tt(349));Tp&30||AG(n,t,r)}i.memoizedState=r;var a={value:r,getSnapshot:t};return i.queue=a,PN(TG.bind(null,n,a,e),[e]),n.flags|=2048,g1(9,PG.bind(null,n,a,r,t),void 0,null),r},useId:function(){var e=Qu(),t=ta.identifierPrefix;if(Zn){var r=sc,n=oc;r=(n&~(1<<32-hu(n)-1)).toString(32)+r,t=":"+t+"R"+r,r=v1++,0<r&&(t+="H"+r.toString(32)),t+=":"}else r=Soe++,t=":"+t+"r"+r.toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},Aoe={readContext:Rs,useCallback:NG,useContext:Rs,useEffect:dR,useImperativeHandle:LG,useInsertionEffect:RG,useLayoutEffect:kG,useMemo:FG,useReducer:iA,useRef:DG,useState:function(){return iA(m1)},useDebugValue:fR,useDeferredValue:function(e){var t=ks();return BG(t,Oi.memoizedState,e)},useTransition:function(){var e=iA(m1)[0],t=ks().memoizedState;return[e,t]},useMutableSource:wG,useSyncExternalStore:EG,useId:UG,unstable_isNewReconciler:!1},Poe={readContext:Rs,useCallback:NG,useContext:Rs,useEffect:dR,useImperativeHandle:LG,useInsertionEffect:RG,useLayoutEffect:kG,useMemo:FG,useReducer:aA,useRef:DG,useState:function(){return aA(m1)},useDebugValue:fR,useDeferredValue:function(e){var t=ks();return Oi===null?t.memoizedState=e:BG(t,Oi.memoizedState,e)},useTransition:function(){var e=aA(m1)[0],t=ks().memoizedState;return[e,t]},useMutableSource:wG,useSyncExternalStore:EG,useId:UG,unstable_isNewReconciler:!1};function ug(e,t){try{var r="",n=t;do r+=tae(n),n=n.return;while(n);var i=r}catch(a){i=`
Error generating stack: `+a.message+`
`+a.stack}return{value:e,source:t,stack:i,digest:null}}function oA(e,t,r){return{value:e,source:null,stack:r??null,digest:t??null}}function X4(e,t){try{console.error(t.value)}catch(r){setTimeout(function(){throw r})}}var Toe=typeof WeakMap=="function"?WeakMap:Map;function HG(e,t,r){r=pc(-1,r),r.tag=3,r.payload={element:null};var n=t.value;return r.callback=function(){qS||(qS=!0,iI=n),X4(e,t)},r}function GG(e,t,r){r=pc(-1,r),r.tag=3;var n=e.type.getDerivedStateFromError;if(typeof n=="function"){var i=t.value;r.payload=function(){return n(i)},r.callback=function(){X4(e,t)}}var a=e.stateNode;return a!==null&&typeof a.componentDidCatch=="function"&&(r.callback=function(){X4(e,t),typeof n!="function"&&(Ef===null?Ef=new Set([this]):Ef.add(this));var o=t.stack;this.componentDidCatch(t.value,{componentStack:o!==null?o:""})}),r}function TN(e,t,r){var n=e.pingCache;if(n===null){n=e.pingCache=new Toe;var i=new Set;n.set(t,i)}else i=n.get(t),i===void 0&&(i=new Set,n.set(t,i));i.has(r)||(i.add(r),e=Voe.bind(null,e,t,r),t.then(e,e))}function IN(e){do{var t;if((t=e.tag===13)&&(t=e.memoizedState,t=t!==null?t.dehydrated!==null:!0),t)return e;e=e.return}while(e!==null);return null}function MN(e,t,r,n,i){return e.mode&1?(e.flags|=65536,e.lanes=i,e):(e===t?e.flags|=65536:(e.flags|=128,r.flags|=131072,r.flags&=-52805,r.tag===1&&(r.alternate===null?r.tag=17:(t=pc(-1,1),t.tag=2,wf(r,t,1))),r.lanes|=1),e)}var Ioe=Yc.ReactCurrentOwner,fo=!1;function Ha(e,t,r,n){t.child=e===null?CG(t,null,r,n):og(t,e.child,r,n)}function DN(e,t,r,n,i){r=r.render;var a=t.ref;return Nm(t,i),n=lR(e,t,r,n,a,i),r=cR(),e!==null&&!fo?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~i,Ec(e,t,i)):(Zn&&r&&QD(t),t.flags|=1,Ha(e,t,n,i),t.child)}function RN(e,t,r,n,i){if(e===null){var a=r.type;return typeof a=="function"&&!xR(a)&&a.defaultProps===void 0&&r.compare===null&&r.defaultProps===void 0?(t.tag=15,t.type=a,qG(e,t,a,n,i)):(e=Kx(r.type,null,n,t,t.mode,i),e.ref=t.ref,e.return=t,t.child=e)}if(a=e.child,!(e.lanes&i)){var o=a.memoizedProps;if(r=r.compare,r=r!==null?r:l1,r(o,n)&&e.ref===t.ref)return Ec(e,t,i)}return t.flags|=1,e=Pf(a,n),e.ref=t.ref,e.return=t,t.child=e}function qG(e,t,r,n,i){if(e!==null){var a=e.memoizedProps;if(l1(a,n)&&e.ref===t.ref)if(fo=!1,t.pendingProps=n=a,(e.lanes&i)!==0)e.flags&131072&&(fo=!0);else return t.lanes=e.lanes,Ec(e,t,i)}return Y4(e,t,r,n,i)}function WG(e,t,r){var n=t.pendingProps,i=n.children,a=e!==null?e.memoizedState:null;if(n.mode==="hidden")if(!(t.mode&1))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},kn(xm,Do),Do|=r;else{if(!(r&1073741824))return e=a!==null?a.baseLanes|r:r,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,kn(xm,Do),Do|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},n=a!==null?a.baseLanes:r,kn(xm,Do),Do|=n}else a!==null?(n=a.baseLanes|r,t.memoizedState=null):n=r,kn(xm,Do),Do|=n;return Ha(e,t,i,r),t.child}function $G(e,t){var r=t.ref;(e===null&&r!==null||e!==null&&e.ref!==r)&&(t.flags|=512,t.flags|=2097152)}function Y4(e,t,r,n,i){var a=po(r)?Ap:Ra.current;return a=ig(t,a),Nm(t,i),r=lR(e,t,r,n,a,i),n=cR(),e!==null&&!fo?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~i,Ec(e,t,i)):(Zn&&n&&QD(t),t.flags|=1,Ha(e,t,r,i),t.child)}function kN(e,t,r,n,i){if(po(r)){var a=!0;LS(t)}else a=!1;if(Nm(t,i),t.stateNode===null)$x(e,t),xG(t,r,n),$4(t,r,n,i),n=!0;else if(e===null){var o=t.stateNode,s=t.memoizedProps;o.props=s;var u=o.context,l=r.contextType;typeof l=="object"&&l!==null?l=Rs(l):(l=po(r)?Ap:Ra.current,l=ig(t,l));var c=r.getDerivedStateFromProps,d=typeof c=="function"||typeof o.getSnapshotBeforeUpdate=="function";d||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(s!==n||u!==l)&&wN(t,o,n,l),Hd=!1;var f=t.memoizedState;o.state=f,jS(t,n,o,i),u=t.memoizedState,s!==n||f!==u||ho.current||Hd?(typeof c=="function"&&(W4(t,r,c,n),u=t.memoizedState),(s=Hd||_N(t,r,s,n,f,u,l))?(d||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(t.flags|=4194308)):(typeof o.componentDidMount=="function"&&(t.flags|=4194308),t.memoizedProps=n,t.memoizedState=u),o.props=n,o.state=u,o.context=l,n=s):(typeof o.componentDidMount=="function"&&(t.flags|=4194308),n=!1)}else{o=t.stateNode,yG(e,t),s=t.memoizedProps,l=t.type===t.elementType?s:Js(t.type,s),o.props=l,d=t.pendingProps,f=o.context,u=r.contextType,typeof u=="object"&&u!==null?u=Rs(u):(u=po(r)?Ap:Ra.current,u=ig(t,u));var h=r.getDerivedStateFromProps;(c=typeof h=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(s!==d||f!==u)&&wN(t,o,n,u),Hd=!1,f=t.memoizedState,o.state=f,jS(t,n,o,i);var v=t.memoizedState;s!==d||f!==v||ho.current||Hd?(typeof h=="function"&&(W4(t,r,h,n),v=t.memoizedState),(l=Hd||_N(t,r,l,n,f,v,u)||!1)?(c||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(n,v,u),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(n,v,u)),typeof o.componentDidUpdate=="function"&&(t.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(t.flags|=1024)):(typeof o.componentDidUpdate!="function"||s===e.memoizedProps&&f===e.memoizedState||(t.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||s===e.memoizedProps&&f===e.memoizedState||(t.flags|=1024),t.memoizedProps=n,t.memoizedState=v),o.props=n,o.state=v,o.context=u,n=l):(typeof o.componentDidUpdate!="function"||s===e.memoizedProps&&f===e.memoizedState||(t.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||s===e.memoizedProps&&f===e.memoizedState||(t.flags|=1024),n=!1)}return K4(e,t,r,n,a,i)}function K4(e,t,r,n,i,a){$G(e,t);var o=(t.flags&128)!==0;if(!n&&!o)return i&&yN(t,r,!1),Ec(e,t,a);n=t.stateNode,Ioe.current=t;var s=o&&typeof r.getDerivedStateFromError!="function"?null:n.render();return t.flags|=1,e!==null&&o?(t.child=og(t,e.child,null,a),t.child=og(t,null,s,a)):Ha(e,t,s,a),t.memoizedState=n.state,i&&yN(t,r,!0),t.child}function XG(e){var t=e.stateNode;t.pendingContext?gN(e,t.pendingContext,t.pendingContext!==t.context):t.context&&gN(e,t.context,!1),aR(e,t.containerInfo)}function ON(e,t,r,n,i){return ag(),JD(i),t.flags|=256,Ha(e,t,r,n),t.child}var Q4={dehydrated:null,treeContext:null,retryLane:0};function Z4(e){return{baseLanes:e,cachePool:null,transitions:null}}function YG(e,t,r){var n=t.pendingProps,i=ni.current,a=!1,o=(t.flags&128)!==0,s;if((s=o)||(s=e!==null&&e.memoizedState===null?!1:(i&2)!==0),s?(a=!0,t.flags&=-129):(e===null||e.memoizedState!==null)&&(i|=1),kn(ni,i&1),e===null)return G4(t),e=t.memoizedState,e!==null&&(e=e.dehydrated,e!==null)?(t.mode&1?e.data==="$!"?t.lanes=8:t.lanes=1073741824:t.lanes=1,null):(o=n.children,e=n.fallback,a?(n=t.mode,a=t.child,o={mode:"hidden",children:o},!(n&1)&&a!==null?(a.childLanes=0,a.pendingProps=o):a=cw(o,n,0,null),e=dp(e,n,r,null),a.return=t,e.return=t,a.sibling=e,t.child=a,t.child.memoizedState=Z4(r),t.memoizedState=Q4,e):hR(t,o));if(i=e.memoizedState,i!==null&&(s=i.dehydrated,s!==null))return Moe(e,t,o,n,s,i,r);if(a){a=n.fallback,o=t.mode,i=e.child,s=i.sibling;var u={mode:"hidden",children:n.children};return!(o&1)&&t.child!==i?(n=t.child,n.childLanes=0,n.pendingProps=u,t.deletions=null):(n=Pf(i,u),n.subtreeFlags=i.subtreeFlags&14680064),s!==null?a=Pf(s,a):(a=dp(a,o,r,null),a.flags|=2),a.return=t,n.return=t,n.sibling=a,t.child=n,n=a,a=t.child,o=e.child.memoizedState,o=o===null?Z4(r):{baseLanes:o.baseLanes|r,cachePool:null,transitions:o.transitions},a.memoizedState=o,a.childLanes=e.childLanes&~r,t.memoizedState=Q4,n}return a=e.child,e=a.sibling,n=Pf(a,{mode:"visible",children:n.children}),!(t.mode&1)&&(n.lanes=r),n.return=t,n.sibling=null,e!==null&&(r=t.deletions,r===null?(t.deletions=[e],t.flags|=16):r.push(e)),t.child=n,t.memoizedState=null,n}function hR(e,t){return t=cw({mode:"visible",children:t},e.mode,0,null),t.return=e,e.child=t}function y2(e,t,r,n){return n!==null&&JD(n),og(t,e.child,null,r),e=hR(t,t.pendingProps.children),e.flags|=2,t.memoizedState=null,e}function Moe(e,t,r,n,i,a,o){if(r)return t.flags&256?(t.flags&=-257,n=oA(Error(Tt(422))),y2(e,t,o,n)):t.memoizedState!==null?(t.child=e.child,t.flags|=128,null):(a=n.fallback,i=t.mode,n=cw({mode:"visible",children:n.children},i,0,null),a=dp(a,i,o,null),a.flags|=2,n.return=t,a.return=t,n.sibling=a,t.child=n,t.mode&1&&og(t,e.child,null,o),t.child.memoizedState=Z4(o),t.memoizedState=Q4,a);if(!(t.mode&1))return y2(e,t,o,null);if(i.data==="$!"){if(n=i.nextSibling&&i.nextSibling.dataset,n)var s=n.dgst;return n=s,a=Error(Tt(419)),n=oA(a,n,void 0),y2(e,t,o,n)}if(s=(o&e.childLanes)!==0,fo||s){if(n=ta,n!==null){switch(o&-o){case 4:i=2;break;case 16:i=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:i=32;break;case 536870912:i=268435456;break;default:i=0}i=i&(n.suspendedLanes|o)?0:i,i!==0&&i!==a.retryLane&&(a.retryLane=i,wc(e,i),pu(n,e,i,-1))}return bR(),n=oA(Error(Tt(421))),y2(e,t,o,n)}return i.data==="$?"?(t.flags|=128,t.child=e.child,t=Hoe.bind(null,e),i._reactRetry=t,null):(e=a.treeContext,No=_f(i.nextSibling),jo=t,Zn=!0,nu=null,e!==null&&(_s[ws++]=oc,_s[ws++]=sc,_s[ws++]=Pp,oc=e.id,sc=e.overflow,Pp=t),t=hR(t,n.children),t.flags|=4096,t)}function LN(e,t,r){e.lanes|=t;var n=e.alternate;n!==null&&(n.lanes|=t),q4(e.return,t,r)}function sA(e,t,r,n,i){var a=e.memoizedState;a===null?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:n,tail:r,tailMode:i}:(a.isBackwards=t,a.rendering=null,a.renderingStartTime=0,a.last=n,a.tail=r,a.tailMode=i)}function KG(e,t,r){var n=t.pendingProps,i=n.revealOrder,a=n.tail;if(Ha(e,t,n.children,r),n=ni.current,n&2)n=n&1|2,t.flags|=128;else{if(e!==null&&e.flags&128)e:for(e=t.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&LN(e,r,t);else if(e.tag===19)LN(e,r,t);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;e.sibling===null;){if(e.return===null||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}n&=1}if(kn(ni,n),!(t.mode&1))t.memoizedState=null;else switch(i){case"forwards":for(r=t.child,i=null;r!==null;)e=r.alternate,e!==null&&zS(e)===null&&(i=r),r=r.sibling;r=i,r===null?(i=t.child,t.child=null):(i=r.sibling,r.sibling=null),sA(t,!1,i,r,a);break;case"backwards":for(r=null,i=t.child,t.child=null;i!==null;){if(e=i.alternate,e!==null&&zS(e)===null){t.child=i;break}e=i.sibling,i.sibling=r,r=i,i=e}sA(t,!0,r,null,a);break;case"together":sA(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function $x(e,t){!(t.mode&1)&&e!==null&&(e.alternate=null,t.alternate=null,t.flags|=2)}function Ec(e,t,r){if(e!==null&&(t.dependencies=e.dependencies),Ip|=t.lanes,!(r&t.childLanes))return null;if(e!==null&&t.child!==e.child)throw Error(Tt(153));if(t.child!==null){for(e=t.child,r=Pf(e,e.pendingProps),t.child=r,r.return=t;e.sibling!==null;)e=e.sibling,r=r.sibling=Pf(e,e.pendingProps),r.return=t;r.sibling=null}return t.child}function Doe(e,t,r){switch(t.tag){case 3:XG(t),ag();break;case 5:_G(t);break;case 1:po(t.type)&&LS(t);break;case 4:aR(t,t.stateNode.containerInfo);break;case 10:var n=t.type._context,i=t.memoizedProps.value;kn(BS,n._currentValue),n._currentValue=i;break;case 13:if(n=t.memoizedState,n!==null)return n.dehydrated!==null?(kn(ni,ni.current&1),t.flags|=128,null):r&t.child.childLanes?YG(e,t,r):(kn(ni,ni.current&1),e=Ec(e,t,r),e!==null?e.sibling:null);kn(ni,ni.current&1);break;case 19:if(n=(r&t.childLanes)!==0,e.flags&128){if(n)return KG(e,t,r);t.flags|=128}if(i=t.memoizedState,i!==null&&(i.rendering=null,i.tail=null,i.lastEffect=null),kn(ni,ni.current),n)break;return null;case 22:case 23:return t.lanes=0,WG(e,t,r)}return Ec(e,t,r)}var QG,J4,ZG,JG;QG=function(e,t){for(var r=t.child;r!==null;){if(r.tag===5||r.tag===6)e.appendChild(r.stateNode);else if(r.tag!==4&&r.child!==null){r.child.return=r,r=r.child;continue}if(r===t)break;for(;r.sibling===null;){if(r.return===null||r.return===t)return;r=r.return}r.sibling.return=r.return,r=r.sibling}};J4=function(){};ZG=function(e,t,r,n){var i=e.memoizedProps;if(i!==n){e=t.stateNode,tp(hl.current);var a=null;switch(r){case"input":i=S4(e,i),n=S4(e,n),a=[];break;case"select":i=ui({},i,{value:void 0}),n=ui({},n,{value:void 0}),a=[];break;case"textarea":i=w4(e,i),n=w4(e,n),a=[];break;default:typeof i.onClick!="function"&&typeof n.onClick=="function"&&(e.onclick=kS)}A4(r,n);var o;r=null;for(l in i)if(!n.hasOwnProperty(l)&&i.hasOwnProperty(l)&&i[l]!=null)if(l==="style"){var s=i[l];for(o in s)s.hasOwnProperty(o)&&(r||(r={}),r[o]="")}else l!=="dangerouslySetInnerHTML"&&l!=="children"&&l!=="suppressContentEditableWarning"&&l!=="suppressHydrationWarning"&&l!=="autoFocus"&&(r1.hasOwnProperty(l)?a||(a=[]):(a=a||[]).push(l,null));for(l in n){var u=n[l];if(s=i!=null?i[l]:void 0,n.hasOwnProperty(l)&&u!==s&&(u!=null||s!=null))if(l==="style")if(s){for(o in s)!s.hasOwnProperty(o)||u&&u.hasOwnProperty(o)||(r||(r={}),r[o]="");for(o in u)u.hasOwnProperty(o)&&s[o]!==u[o]&&(r||(r={}),r[o]=u[o])}else r||(a||(a=[]),a.push(l,r)),r=u;else l==="dangerouslySetInnerHTML"?(u=u?u.__html:void 0,s=s?s.__html:void 0,u!=null&&s!==u&&(a=a||[]).push(l,u)):l==="children"?typeof u!="string"&&typeof u!="number"||(a=a||[]).push(l,""+u):l!=="suppressContentEditableWarning"&&l!=="suppressHydrationWarning"&&(r1.hasOwnProperty(l)?(u!=null&&l==="onScroll"&&Fn("scroll",e),a||s===u||(a=[])):(a=a||[]).push(l,u))}r&&(a=a||[]).push("style",r);var l=a;(t.updateQueue=l)&&(t.flags|=4)}};JG=function(e,t,r,n){r!==n&&(t.flags|=4)};function S0(e,t){if(!Zn)switch(e.tailMode){case"hidden":t=e.tail;for(var r=null;t!==null;)t.alternate!==null&&(r=t),t=t.sibling;r===null?e.tail=null:r.sibling=null;break;case"collapsed":r=e.tail;for(var n=null;r!==null;)r.alternate!==null&&(n=r),r=r.sibling;n===null?t||e.tail===null?e.tail=null:e.tail.sibling=null:n.sibling=null}}function ba(e){var t=e.alternate!==null&&e.alternate.child===e.child,r=0,n=0;if(t)for(var i=e.child;i!==null;)r|=i.lanes|i.childLanes,n|=i.subtreeFlags&14680064,n|=i.flags&14680064,i.return=e,i=i.sibling;else for(i=e.child;i!==null;)r|=i.lanes|i.childLanes,n|=i.subtreeFlags,n|=i.flags,i.return=e,i=i.sibling;return e.subtreeFlags|=n,e.childLanes=r,t}function Roe(e,t,r){var n=t.pendingProps;switch(ZD(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return ba(t),null;case 1:return po(t.type)&&OS(),ba(t),null;case 3:return n=t.stateNode,sg(),Hn(ho),Hn(Ra),sR(),n.pendingContext&&(n.context=n.pendingContext,n.pendingContext=null),(e===null||e.child===null)&&(m2(t)?t.flags|=4:e===null||e.memoizedState.isDehydrated&&!(t.flags&256)||(t.flags|=1024,nu!==null&&(sI(nu),nu=null))),J4(e,t),ba(t),null;case 5:oR(t);var i=tp(p1.current);if(r=t.type,e!==null&&t.stateNode!=null)ZG(e,t,r,n,i),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!n){if(t.stateNode===null)throw Error(Tt(166));return ba(t),null}if(e=tp(hl.current),m2(t)){n=t.stateNode,r=t.type;var a=t.memoizedProps;switch(n[al]=t,n[f1]=a,e=(t.mode&1)!==0,r){case"dialog":Fn("cancel",n),Fn("close",n);break;case"iframe":case"object":case"embed":Fn("load",n);break;case"video":case"audio":for(i=0;i<ay.length;i++)Fn(ay[i],n);break;case"source":Fn("error",n);break;case"img":case"image":case"link":Fn("error",n),Fn("load",n);break;case"details":Fn("toggle",n);break;case"input":G6(n,a),Fn("invalid",n);break;case"select":n._wrapperState={wasMultiple:!!a.multiple},Fn("invalid",n);break;case"textarea":W6(n,a),Fn("invalid",n)}A4(r,a),i=null;for(var o in a)if(a.hasOwnProperty(o)){var s=a[o];o==="children"?typeof s=="string"?n.textContent!==s&&(a.suppressHydrationWarning!==!0&&v2(n.textContent,s,e),i=["children",s]):typeof s=="number"&&n.textContent!==""+s&&(a.suppressHydrationWarning!==!0&&v2(n.textContent,s,e),i=["children",""+s]):r1.hasOwnProperty(o)&&s!=null&&o==="onScroll"&&Fn("scroll",n)}switch(r){case"input":s2(n),q6(n,a,!0);break;case"textarea":s2(n),$6(n);break;case"select":case"option":break;default:typeof a.onClick=="function"&&(n.onclick=kS)}n=i,t.updateQueue=n,n!==null&&(t.flags|=4)}else{o=i.nodeType===9?i:i.ownerDocument,e==="http://www.w3.org/1999/xhtml"&&(e=AH(r)),e==="http://www.w3.org/1999/xhtml"?r==="script"?(e=o.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):typeof n.is=="string"?e=o.createElement(r,{is:n.is}):(e=o.createElement(r),r==="select"&&(o=e,n.multiple?o.multiple=!0:n.size&&(o.size=n.size))):e=o.createElementNS(e,r),e[al]=t,e[f1]=n,QG(e,t,!1,!1),t.stateNode=e;e:{switch(o=P4(r,n),r){case"dialog":Fn("cancel",e),Fn("close",e),i=n;break;case"iframe":case"object":case"embed":Fn("load",e),i=n;break;case"video":case"audio":for(i=0;i<ay.length;i++)Fn(ay[i],e);i=n;break;case"source":Fn("error",e),i=n;break;case"img":case"image":case"link":Fn("error",e),Fn("load",e),i=n;break;case"details":Fn("toggle",e),i=n;break;case"input":G6(e,n),i=S4(e,n),Fn("invalid",e);break;case"option":i=n;break;case"select":e._wrapperState={wasMultiple:!!n.multiple},i=ui({},n,{value:void 0}),Fn("invalid",e);break;case"textarea":W6(e,n),i=w4(e,n),Fn("invalid",e);break;default:i=n}A4(r,i),s=i;for(a in s)if(s.hasOwnProperty(a)){var u=s[a];a==="style"?IH(e,u):a==="dangerouslySetInnerHTML"?(u=u?u.__html:void 0,u!=null&&PH(e,u)):a==="children"?typeof u=="string"?(r!=="textarea"||u!=="")&&n1(e,u):typeof u=="number"&&n1(e,""+u):a!=="suppressContentEditableWarning"&&a!=="suppressHydrationWarning"&&a!=="autoFocus"&&(r1.hasOwnProperty(a)?u!=null&&a==="onScroll"&&Fn("scroll",e):u!=null&&FD(e,a,u,o))}switch(r){case"input":s2(e),q6(e,n,!1);break;case"textarea":s2(e),$6(e);break;case"option":n.value!=null&&e.setAttribute("value",""+Bf(n.value));break;case"select":e.multiple=!!n.multiple,a=n.value,a!=null?Rm(e,!!n.multiple,a,!1):n.defaultValue!=null&&Rm(e,!!n.multiple,n.defaultValue,!0);break;default:typeof i.onClick=="function"&&(e.onclick=kS)}switch(r){case"button":case"input":case"select":case"textarea":n=!!n.autoFocus;break e;case"img":n=!0;break e;default:n=!1}}n&&(t.flags|=4)}t.ref!==null&&(t.flags|=512,t.flags|=2097152)}return ba(t),null;case 6:if(e&&t.stateNode!=null)JG(e,t,e.memoizedProps,n);else{if(typeof n!="string"&&t.stateNode===null)throw Error(Tt(166));if(r=tp(p1.current),tp(hl.current),m2(t)){if(n=t.stateNode,r=t.memoizedProps,n[al]=t,(a=n.nodeValue!==r)&&(e=jo,e!==null))switch(e.tag){case 3:v2(n.nodeValue,r,(e.mode&1)!==0);break;case 5:e.memoizedProps.suppressHydrationWarning!==!0&&v2(n.nodeValue,r,(e.mode&1)!==0)}a&&(t.flags|=4)}else n=(r.nodeType===9?r:r.ownerDocument).createTextNode(n),n[al]=t,t.stateNode=n}return ba(t),null;case 13:if(Hn(ni),n=t.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(Zn&&No!==null&&t.mode&1&&!(t.flags&128))mG(),ag(),t.flags|=98560,a=!1;else if(a=m2(t),n!==null&&n.dehydrated!==null){if(e===null){if(!a)throw Error(Tt(318));if(a=t.memoizedState,a=a!==null?a.dehydrated:null,!a)throw Error(Tt(317));a[al]=t}else ag(),!(t.flags&128)&&(t.memoizedState=null),t.flags|=4;ba(t),a=!1}else nu!==null&&(sI(nu),nu=null),a=!0;if(!a)return t.flags&65536?t:null}return t.flags&128?(t.lanes=r,t):(n=n!==null,n!==(e!==null&&e.memoizedState!==null)&&n&&(t.child.flags|=8192,t.mode&1&&(e===null||ni.current&1?Ni===0&&(Ni=3):bR())),t.updateQueue!==null&&(t.flags|=4),ba(t),null);case 4:return sg(),J4(e,t),e===null&&c1(t.stateNode.containerInfo),ba(t),null;case 10:return rR(t.type._context),ba(t),null;case 17:return po(t.type)&&OS(),ba(t),null;case 19:if(Hn(ni),a=t.memoizedState,a===null)return ba(t),null;if(n=(t.flags&128)!==0,o=a.rendering,o===null)if(n)S0(a,!1);else{if(Ni!==0||e!==null&&e.flags&128)for(e=t.child;e!==null;){if(o=zS(e),o!==null){for(t.flags|=128,S0(a,!1),n=o.updateQueue,n!==null&&(t.updateQueue=n,t.flags|=4),t.subtreeFlags=0,n=r,r=t.child;r!==null;)a=r,e=n,a.flags&=14680066,o=a.alternate,o===null?(a.childLanes=0,a.lanes=e,a.child=null,a.subtreeFlags=0,a.memoizedProps=null,a.memoizedState=null,a.updateQueue=null,a.dependencies=null,a.stateNode=null):(a.childLanes=o.childLanes,a.lanes=o.lanes,a.child=o.child,a.subtreeFlags=0,a.deletions=null,a.memoizedProps=o.memoizedProps,a.memoizedState=o.memoizedState,a.updateQueue=o.updateQueue,a.type=o.type,e=o.dependencies,a.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext}),r=r.sibling;return kn(ni,ni.current&1|2),t.child}e=e.sibling}a.tail!==null&&yi()>lg&&(t.flags|=128,n=!0,S0(a,!1),t.lanes=4194304)}else{if(!n)if(e=zS(o),e!==null){if(t.flags|=128,n=!0,r=e.updateQueue,r!==null&&(t.updateQueue=r,t.flags|=4),S0(a,!0),a.tail===null&&a.tailMode==="hidden"&&!o.alternate&&!Zn)return ba(t),null}else 2*yi()-a.renderingStartTime>lg&&r!==1073741824&&(t.flags|=128,n=!0,S0(a,!1),t.lanes=4194304);a.isBackwards?(o.sibling=t.child,t.child=o):(r=a.last,r!==null?r.sibling=o:t.child=o,a.last=o)}return a.tail!==null?(t=a.tail,a.rendering=t,a.tail=t.sibling,a.renderingStartTime=yi(),t.sibling=null,r=ni.current,kn(ni,n?r&1|2:r&1),t):(ba(t),null);case 22:case 23:return yR(),n=t.memoizedState!==null,e!==null&&e.memoizedState!==null!==n&&(t.flags|=8192),n&&t.mode&1?Do&1073741824&&(ba(t),t.subtreeFlags&6&&(t.flags|=8192)):ba(t),null;case 24:return null;case 25:return null}throw Error(Tt(156,t.tag))}function koe(e,t){switch(ZD(t),t.tag){case 1:return po(t.type)&&OS(),e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 3:return sg(),Hn(ho),Hn(Ra),sR(),e=t.flags,e&65536&&!(e&128)?(t.flags=e&-65537|128,t):null;case 5:return oR(t),null;case 13:if(Hn(ni),e=t.memoizedState,e!==null&&e.dehydrated!==null){if(t.alternate===null)throw Error(Tt(340));ag()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 19:return Hn(ni),null;case 4:return sg(),null;case 10:return rR(t.type._context),null;case 22:case 23:return yR(),null;case 24:return null;default:return null}}var b2=!1,Aa=!1,Ooe=typeof WeakSet=="function"?WeakSet:Set,zt=null;function bm(e,t){var r=e.ref;if(r!==null)if(typeof r=="function")try{r(null)}catch(n){fi(e,t,n)}else r.current=null}function eI(e,t,r){try{r()}catch(n){fi(e,t,n)}}var NN=!1;function Loe(e,t){if(F4=MS,e=nG(),KD(e)){if("selectionStart"in e)var r={start:e.selectionStart,end:e.selectionEnd};else e:{r=(r=e.ownerDocument)&&r.defaultView||window;var n=r.getSelection&&r.getSelection();if(n&&n.rangeCount!==0){r=n.anchorNode;var i=n.anchorOffset,a=n.focusNode;n=n.focusOffset;try{r.nodeType,a.nodeType}catch{r=null;break e}var o=0,s=-1,u=-1,l=0,c=0,d=e,f=null;t:for(;;){for(var h;d!==r||i!==0&&d.nodeType!==3||(s=o+i),d!==a||n!==0&&d.nodeType!==3||(u=o+n),d.nodeType===3&&(o+=d.nodeValue.length),(h=d.firstChild)!==null;)f=d,d=h;for(;;){if(d===e)break t;if(f===r&&++l===i&&(s=o),f===a&&++c===n&&(u=o),(h=d.nextSibling)!==null)break;d=f,f=d.parentNode}d=h}r=s===-1||u===-1?null:{start:s,end:u}}else r=null}r=r||{start:0,end:0}}else r=null;for(B4={focusedElem:e,selectionRange:r},MS=!1,zt=t;zt!==null;)if(t=zt,e=t.child,(t.subtreeFlags&1028)!==0&&e!==null)e.return=t,zt=e;else for(;zt!==null;){t=zt;try{var v=t.alternate;if(t.flags&1024)switch(t.tag){case 0:case 11:case 15:break;case 1:if(v!==null){var p=v.memoizedProps,m=v.memoizedState,g=t.stateNode,y=g.getSnapshotBeforeUpdate(t.elementType===t.type?p:Js(t.type,p),m);g.__reactInternalSnapshotBeforeUpdate=y}break;case 3:var b=t.stateNode.containerInfo;b.nodeType===1?b.textContent="":b.nodeType===9&&b.documentElement&&b.removeChild(b.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(Tt(163))}}catch(S){fi(t,t.return,S)}if(e=t.sibling,e!==null){e.return=t.return,zt=e;break}zt=t.return}return v=NN,NN=!1,v}function Dy(e,t,r){var n=t.updateQueue;if(n=n!==null?n.lastEffect:null,n!==null){var i=n=n.next;do{if((i.tag&e)===e){var a=i.destroy;i.destroy=void 0,a!==void 0&&eI(t,r,a)}i=i.next}while(i!==n)}}function uw(e,t){if(t=t.updateQueue,t=t!==null?t.lastEffect:null,t!==null){var r=t=t.next;do{if((r.tag&e)===e){var n=r.create;r.destroy=n()}r=r.next}while(r!==t)}}function tI(e){var t=e.ref;if(t!==null){var r=e.stateNode;switch(e.tag){case 5:e=r;break;default:e=r}typeof t=="function"?t(e):t.current=e}}function eq(e){var t=e.alternate;t!==null&&(e.alternate=null,eq(t)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(t=e.stateNode,t!==null&&(delete t[al],delete t[f1],delete t[z4],delete t[goe],delete t[yoe])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function tq(e){return e.tag===5||e.tag===3||e.tag===4}function FN(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||tq(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function rI(e,t,r){var n=e.tag;if(n===5||n===6)e=e.stateNode,t?r.nodeType===8?r.parentNode.insertBefore(e,t):r.insertBefore(e,t):(r.nodeType===8?(t=r.parentNode,t.insertBefore(e,r)):(t=r,t.appendChild(e)),r=r._reactRootContainer,r!=null||t.onclick!==null||(t.onclick=kS));else if(n!==4&&(e=e.child,e!==null))for(rI(e,t,r),e=e.sibling;e!==null;)rI(e,t,r),e=e.sibling}function nI(e,t,r){var n=e.tag;if(n===5||n===6)e=e.stateNode,t?r.insertBefore(e,t):r.appendChild(e);else if(n!==4&&(e=e.child,e!==null))for(nI(e,t,r),e=e.sibling;e!==null;)nI(e,t,r),e=e.sibling}var oa=null,tu=!1;function Sd(e,t,r){for(r=r.child;r!==null;)rq(e,t,r),r=r.sibling}function rq(e,t,r){if(fl&&typeof fl.onCommitFiberUnmount=="function")try{fl.onCommitFiberUnmount(ew,r)}catch{}switch(r.tag){case 5:Aa||bm(r,t);case 6:var n=oa,i=tu;oa=null,Sd(e,t,r),oa=n,tu=i,oa!==null&&(tu?(e=oa,r=r.stateNode,e.nodeType===8?e.parentNode.removeChild(r):e.removeChild(r)):oa.removeChild(r.stateNode));break;case 18:oa!==null&&(tu?(e=oa,r=r.stateNode,e.nodeType===8?eA(e.parentNode,r):e.nodeType===1&&eA(e,r),s1(e)):eA(oa,r.stateNode));break;case 4:n=oa,i=tu,oa=r.stateNode.containerInfo,tu=!0,Sd(e,t,r),oa=n,tu=i;break;case 0:case 11:case 14:case 15:if(!Aa&&(n=r.updateQueue,n!==null&&(n=n.lastEffect,n!==null))){i=n=n.next;do{var a=i,o=a.destroy;a=a.tag,o!==void 0&&(a&2||a&4)&&eI(r,t,o),i=i.next}while(i!==n)}Sd(e,t,r);break;case 1:if(!Aa&&(bm(r,t),n=r.stateNode,typeof n.componentWillUnmount=="function"))try{n.props=r.memoizedProps,n.state=r.memoizedState,n.componentWillUnmount()}catch(s){fi(r,t,s)}Sd(e,t,r);break;case 21:Sd(e,t,r);break;case 22:r.mode&1?(Aa=(n=Aa)||r.memoizedState!==null,Sd(e,t,r),Aa=n):Sd(e,t,r);break;default:Sd(e,t,r)}}function BN(e){var t=e.updateQueue;if(t!==null){e.updateQueue=null;var r=e.stateNode;r===null&&(r=e.stateNode=new Ooe),t.forEach(function(n){var i=Goe.bind(null,e,n);r.has(n)||(r.add(n),n.then(i,i))})}}function Xs(e,t){var r=t.deletions;if(r!==null)for(var n=0;n<r.length;n++){var i=r[n];try{var a=e,o=t,s=o;e:for(;s!==null;){switch(s.tag){case 5:oa=s.stateNode,tu=!1;break e;case 3:oa=s.stateNode.containerInfo,tu=!0;break e;case 4:oa=s.stateNode.containerInfo,tu=!0;break e}s=s.return}if(oa===null)throw Error(Tt(160));rq(a,o,i),oa=null,tu=!1;var u=i.alternate;u!==null&&(u.return=null),i.return=null}catch(l){fi(i,t,l)}}if(t.subtreeFlags&12854)for(t=t.child;t!==null;)nq(t,e),t=t.sibling}function nq(e,t){var r=e.alternate,n=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(Xs(t,e),zu(e),n&4){try{Dy(3,e,e.return),uw(3,e)}catch(p){fi(e,e.return,p)}try{Dy(5,e,e.return)}catch(p){fi(e,e.return,p)}}break;case 1:Xs(t,e),zu(e),n&512&&r!==null&&bm(r,r.return);break;case 5:if(Xs(t,e),zu(e),n&512&&r!==null&&bm(r,r.return),e.flags&32){var i=e.stateNode;try{n1(i,"")}catch(p){fi(e,e.return,p)}}if(n&4&&(i=e.stateNode,i!=null)){var a=e.memoizedProps,o=r!==null?r.memoizedProps:a,s=e.type,u=e.updateQueue;if(e.updateQueue=null,u!==null)try{s==="input"&&a.type==="radio"&&a.name!=null&&wH(i,a),P4(s,o);var l=P4(s,a);for(o=0;o<u.length;o+=2){var c=u[o],d=u[o+1];c==="style"?IH(i,d):c==="dangerouslySetInnerHTML"?PH(i,d):c==="children"?n1(i,d):FD(i,c,d,l)}switch(s){case"input":C4(i,a);break;case"textarea":EH(i,a);break;case"select":var f=i._wrapperState.wasMultiple;i._wrapperState.wasMultiple=!!a.multiple;var h=a.value;h!=null?Rm(i,!!a.multiple,h,!1):f!==!!a.multiple&&(a.defaultValue!=null?Rm(i,!!a.multiple,a.defaultValue,!0):Rm(i,!!a.multiple,a.multiple?[]:"",!1))}i[f1]=a}catch(p){fi(e,e.return,p)}}break;case 6:if(Xs(t,e),zu(e),n&4){if(e.stateNode===null)throw Error(Tt(162));i=e.stateNode,a=e.memoizedProps;try{i.nodeValue=a}catch(p){fi(e,e.return,p)}}break;case 3:if(Xs(t,e),zu(e),n&4&&r!==null&&r.memoizedState.isDehydrated)try{s1(t.containerInfo)}catch(p){fi(e,e.return,p)}break;case 4:Xs(t,e),zu(e);break;case 13:Xs(t,e),zu(e),i=e.child,i.flags&8192&&(a=i.memoizedState!==null,i.stateNode.isHidden=a,!a||i.alternate!==null&&i.alternate.memoizedState!==null||(mR=yi())),n&4&&BN(e);break;case 22:if(c=r!==null&&r.memoizedState!==null,e.mode&1?(Aa=(l=Aa)||c,Xs(t,e),Aa=l):Xs(t,e),zu(e),n&8192){if(l=e.memoizedState!==null,(e.stateNode.isHidden=l)&&!c&&e.mode&1)for(zt=e,c=e.child;c!==null;){for(d=zt=c;zt!==null;){switch(f=zt,h=f.child,f.tag){case 0:case 11:case 14:case 15:Dy(4,f,f.return);break;case 1:bm(f,f.return);var v=f.stateNode;if(typeof v.componentWillUnmount=="function"){n=f,r=f.return;try{t=n,v.props=t.memoizedProps,v.state=t.memoizedState,v.componentWillUnmount()}catch(p){fi(n,r,p)}}break;case 5:bm(f,f.return);break;case 22:if(f.memoizedState!==null){jN(d);continue}}h!==null?(h.return=f,zt=h):jN(d)}c=c.sibling}e:for(c=null,d=e;;){if(d.tag===5){if(c===null){c=d;try{i=d.stateNode,l?(a=i.style,typeof a.setProperty=="function"?a.setProperty("display","none","important"):a.display="none"):(s=d.stateNode,u=d.memoizedProps.style,o=u!=null&&u.hasOwnProperty("display")?u.display:null,s.style.display=TH("display",o))}catch(p){fi(e,e.return,p)}}}else if(d.tag===6){if(c===null)try{d.stateNode.nodeValue=l?"":d.memoizedProps}catch(p){fi(e,e.return,p)}}else if((d.tag!==22&&d.tag!==23||d.memoizedState===null||d===e)&&d.child!==null){d.child.return=d,d=d.child;continue}if(d===e)break e;for(;d.sibling===null;){if(d.return===null||d.return===e)break e;c===d&&(c=null),d=d.return}c===d&&(c=null),d.sibling.return=d.return,d=d.sibling}}break;case 19:Xs(t,e),zu(e),n&4&&BN(e);break;case 21:break;default:Xs(t,e),zu(e)}}function zu(e){var t=e.flags;if(t&2){try{e:{for(var r=e.return;r!==null;){if(tq(r)){var n=r;break e}r=r.return}throw Error(Tt(160))}switch(n.tag){case 5:var i=n.stateNode;n.flags&32&&(n1(i,""),n.flags&=-33);var a=FN(e);nI(e,a,i);break;case 3:case 4:var o=n.stateNode.containerInfo,s=FN(e);rI(e,s,o);break;default:throw Error(Tt(161))}}catch(u){fi(e,e.return,u)}e.flags&=-3}t&4096&&(e.flags&=-4097)}function Noe(e,t,r){zt=e,iq(e)}function iq(e,t,r){for(var n=(e.mode&1)!==0;zt!==null;){var i=zt,a=i.child;if(i.tag===22&&n){var o=i.memoizedState!==null||b2;if(!o){var s=i.alternate,u=s!==null&&s.memoizedState!==null||Aa;s=b2;var l=Aa;if(b2=o,(Aa=u)&&!l)for(zt=i;zt!==null;)o=zt,u=o.child,o.tag===22&&o.memoizedState!==null?zN(i):u!==null?(u.return=o,zt=u):zN(i);for(;a!==null;)zt=a,iq(a),a=a.sibling;zt=i,b2=s,Aa=l}UN(e)}else i.subtreeFlags&8772&&a!==null?(a.return=i,zt=a):UN(e)}}function UN(e){for(;zt!==null;){var t=zt;if(t.flags&8772){var r=t.alternate;try{if(t.flags&8772)switch(t.tag){case 0:case 11:case 15:Aa||uw(5,t);break;case 1:var n=t.stateNode;if(t.flags&4&&!Aa)if(r===null)n.componentDidMount();else{var i=t.elementType===t.type?r.memoizedProps:Js(t.type,r.memoizedProps);n.componentDidUpdate(i,r.memoizedState,n.__reactInternalSnapshotBeforeUpdate)}var a=t.updateQueue;a!==null&&CN(t,a,n);break;case 3:var o=t.updateQueue;if(o!==null){if(r=null,t.child!==null)switch(t.child.tag){case 5:r=t.child.stateNode;break;case 1:r=t.child.stateNode}CN(t,o,r)}break;case 5:var s=t.stateNode;if(r===null&&t.flags&4){r=s;var u=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":u.autoFocus&&r.focus();break;case"img":u.src&&(r.src=u.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(t.memoizedState===null){var l=t.alternate;if(l!==null){var c=l.memoizedState;if(c!==null){var d=c.dehydrated;d!==null&&s1(d)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(Tt(163))}Aa||t.flags&512&&tI(t)}catch(f){fi(t,t.return,f)}}if(t===e){zt=null;break}if(r=t.sibling,r!==null){r.return=t.return,zt=r;break}zt=t.return}}function jN(e){for(;zt!==null;){var t=zt;if(t===e){zt=null;break}var r=t.sibling;if(r!==null){r.return=t.return,zt=r;break}zt=t.return}}function zN(e){for(;zt!==null;){var t=zt;try{switch(t.tag){case 0:case 11:case 15:var r=t.return;try{uw(4,t)}catch(u){fi(t,r,u)}break;case 1:var n=t.stateNode;if(typeof n.componentDidMount=="function"){var i=t.return;try{n.componentDidMount()}catch(u){fi(t,i,u)}}var a=t.return;try{tI(t)}catch(u){fi(t,a,u)}break;case 5:var o=t.return;try{tI(t)}catch(u){fi(t,o,u)}}}catch(u){fi(t,t.return,u)}if(t===e){zt=null;break}var s=t.sibling;if(s!==null){s.return=t.return,zt=s;break}zt=t.return}}var Foe=Math.ceil,GS=Yc.ReactCurrentDispatcher,pR=Yc.ReactCurrentOwner,Is=Yc.ReactCurrentBatchConfig,an=0,ta=null,Ti=null,la=0,Do=0,xm=ih(0),Ni=0,y1=null,Ip=0,lw=0,vR=0,Ry=null,lo=null,mR=0,lg=1/0,Kl=null,qS=!1,iI=null,Ef=null,x2=!1,cf=null,WS=0,ky=0,aI=null,Xx=-1,Yx=0;function qa(){return an&6?yi():Xx!==-1?Xx:Xx=yi()}function Af(e){return e.mode&1?an&2&&la!==0?la&-la:xoe.transition!==null?(Yx===0&&(Yx=zH()),Yx):(e=xn,e!==0||(e=window.event,e=e===void 0?16:XH(e.type)),e):1}function pu(e,t,r,n){if(50<ky)throw ky=0,aI=null,Error(Tt(185));sb(e,r,n),(!(an&2)||e!==ta)&&(e===ta&&(!(an&2)&&(lw|=r),Ni===4&&$d(e,la)),vo(e,n),r===1&&an===0&&!(t.mode&1)&&(lg=yi()+500,aw&&ah()))}function vo(e,t){var r=e.callbackNode;xae(e,t);var n=IS(e,e===ta?la:0);if(n===0)r!==null&&K6(r),e.callbackNode=null,e.callbackPriority=0;else if(t=n&-n,e.callbackPriority!==t){if(r!=null&&K6(r),t===1)e.tag===0?boe(VN.bind(null,e)):hG(VN.bind(null,e)),voe(function(){!(an&6)&&ah()}),r=null;else{switch(VH(n)){case 1:r=VD;break;case 4:r=UH;break;case 16:r=TS;break;case 536870912:r=jH;break;default:r=TS}r=fq(r,aq.bind(null,e))}e.callbackPriority=t,e.callbackNode=r}}function aq(e,t){if(Xx=-1,Yx=0,an&6)throw Error(Tt(327));var r=e.callbackNode;if(Fm()&&e.callbackNode!==r)return null;var n=IS(e,e===ta?la:0);if(n===0)return null;if(n&30||n&e.expiredLanes||t)t=$S(e,n);else{t=n;var i=an;an|=2;var a=sq();(ta!==e||la!==t)&&(Kl=null,lg=yi()+500,cp(e,t));do try{joe();break}catch(s){oq(e,s)}while(1);tR(),GS.current=a,an=i,Ti!==null?t=0:(ta=null,la=0,t=Ni)}if(t!==0){if(t===2&&(i=R4(e),i!==0&&(n=i,t=oI(e,i))),t===1)throw r=y1,cp(e,0),$d(e,n),vo(e,yi()),r;if(t===6)$d(e,n);else{if(i=e.current.alternate,!(n&30)&&!Boe(i)&&(t=$S(e,n),t===2&&(a=R4(e),a!==0&&(n=a,t=oI(e,a))),t===1))throw r=y1,cp(e,0),$d(e,n),vo(e,yi()),r;switch(e.finishedWork=i,e.finishedLanes=n,t){case 0:case 1:throw Error(Tt(345));case 2:Uh(e,lo,Kl);break;case 3:if($d(e,n),(n&130023424)===n&&(t=mR+500-yi(),10<t)){if(IS(e,0)!==0)break;if(i=e.suspendedLanes,(i&n)!==n){qa(),e.pingedLanes|=e.suspendedLanes&i;break}e.timeoutHandle=j4(Uh.bind(null,e,lo,Kl),t);break}Uh(e,lo,Kl);break;case 4:if($d(e,n),(n&4194240)===n)break;for(t=e.eventTimes,i=-1;0<n;){var o=31-hu(n);a=1<<o,o=t[o],o>i&&(i=o),n&=~a}if(n=i,n=yi()-n,n=(120>n?120:480>n?480:1080>n?1080:1920>n?1920:3e3>n?3e3:4320>n?4320:1960*Foe(n/1960))-n,10<n){e.timeoutHandle=j4(Uh.bind(null,e,lo,Kl),n);break}Uh(e,lo,Kl);break;case 5:Uh(e,lo,Kl);break;default:throw Error(Tt(329))}}}return vo(e,yi()),e.callbackNode===r?aq.bind(null,e):null}function oI(e,t){var r=Ry;return e.current.memoizedState.isDehydrated&&(cp(e,t).flags|=256),e=$S(e,t),e!==2&&(t=lo,lo=r,t!==null&&sI(t)),e}function sI(e){lo===null?lo=e:lo.push.apply(lo,e)}function Boe(e){for(var t=e;;){if(t.flags&16384){var r=t.updateQueue;if(r!==null&&(r=r.stores,r!==null))for(var n=0;n<r.length;n++){var i=r[n],a=i.getSnapshot;i=i.value;try{if(!Eu(a(),i))return!1}catch{return!1}}}if(r=t.child,t.subtreeFlags&16384&&r!==null)r.return=t,t=r;else{if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function $d(e,t){for(t&=~vR,t&=~lw,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var r=31-hu(t),n=1<<r;e[r]=-1,t&=~n}}function VN(e){if(an&6)throw Error(Tt(327));Fm();var t=IS(e,0);if(!(t&1))return vo(e,yi()),null;var r=$S(e,t);if(e.tag!==0&&r===2){var n=R4(e);n!==0&&(t=n,r=oI(e,n))}if(r===1)throw r=y1,cp(e,0),$d(e,t),vo(e,yi()),r;if(r===6)throw Error(Tt(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,Uh(e,lo,Kl),vo(e,yi()),null}function gR(e,t){var r=an;an|=1;try{return e(t)}finally{an=r,an===0&&(lg=yi()+500,aw&&ah())}}function Mp(e){cf!==null&&cf.tag===0&&!(an&6)&&Fm();var t=an;an|=1;var r=Is.transition,n=xn;try{if(Is.transition=null,xn=1,e)return e()}finally{xn=n,Is.transition=r,an=t,!(an&6)&&ah()}}function yR(){Do=xm.current,Hn(xm)}function cp(e,t){e.finishedWork=null,e.finishedLanes=0;var r=e.timeoutHandle;if(r!==-1&&(e.timeoutHandle=-1,poe(r)),Ti!==null)for(r=Ti.return;r!==null;){var n=r;switch(ZD(n),n.tag){case 1:n=n.type.childContextTypes,n!=null&&OS();break;case 3:sg(),Hn(ho),Hn(Ra),sR();break;case 5:oR(n);break;case 4:sg();break;case 13:Hn(ni);break;case 19:Hn(ni);break;case 10:rR(n.type._context);break;case 22:case 23:yR()}r=r.return}if(ta=e,Ti=e=Pf(e.current,null),la=Do=t,Ni=0,y1=null,vR=lw=Ip=0,lo=Ry=null,ep!==null){for(t=0;t<ep.length;t++)if(r=ep[t],n=r.interleaved,n!==null){r.interleaved=null;var i=n.next,a=r.pending;if(a!==null){var o=a.next;a.next=i,n.next=o}r.pending=n}ep=null}return e}function oq(e,t){do{var r=Ti;try{if(tR(),qx.current=HS,VS){for(var n=oi.memoizedState;n!==null;){var i=n.queue;i!==null&&(i.pending=null),n=n.next}VS=!1}if(Tp=0,Ji=Oi=oi=null,My=!1,v1=0,pR.current=null,r===null||r.return===null){Ni=1,y1=t,Ti=null;break}e:{var a=e,o=r.return,s=r,u=t;if(t=la,s.flags|=32768,u!==null&&typeof u=="object"&&typeof u.then=="function"){var l=u,c=s,d=c.tag;if(!(c.mode&1)&&(d===0||d===11||d===15)){var f=c.alternate;f?(c.updateQueue=f.updateQueue,c.memoizedState=f.memoizedState,c.lanes=f.lanes):(c.updateQueue=null,c.memoizedState=null)}var h=IN(o);if(h!==null){h.flags&=-257,MN(h,o,s,a,t),h.mode&1&&TN(a,l,t),t=h,u=l;var v=t.updateQueue;if(v===null){var p=new Set;p.add(u),t.updateQueue=p}else v.add(u);break e}else{if(!(t&1)){TN(a,l,t),bR();break e}u=Error(Tt(426))}}else if(Zn&&s.mode&1){var m=IN(o);if(m!==null){!(m.flags&65536)&&(m.flags|=256),MN(m,o,s,a,t),JD(ug(u,s));break e}}a=u=ug(u,s),Ni!==4&&(Ni=2),Ry===null?Ry=[a]:Ry.push(a),a=o;do{switch(a.tag){case 3:a.flags|=65536,t&=-t,a.lanes|=t;var g=HG(a,u,t);SN(a,g);break e;case 1:s=u;var y=a.type,b=a.stateNode;if(!(a.flags&128)&&(typeof y.getDerivedStateFromError=="function"||b!==null&&typeof b.componentDidCatch=="function"&&(Ef===null||!Ef.has(b)))){a.flags|=65536,t&=-t,a.lanes|=t;var S=GG(a,s,t);SN(a,S);break e}}a=a.return}while(a!==null)}lq(r)}catch(x){t=x,Ti===r&&r!==null&&(Ti=r=r.return);continue}break}while(1)}function sq(){var e=GS.current;return GS.current=HS,e===null?HS:e}function bR(){(Ni===0||Ni===3||Ni===2)&&(Ni=4),ta===null||!(Ip&268435455)&&!(lw&268435455)||$d(ta,la)}function $S(e,t){var r=an;an|=2;var n=sq();(ta!==e||la!==t)&&(Kl=null,cp(e,t));do try{Uoe();break}catch(i){oq(e,i)}while(1);if(tR(),an=r,GS.current=n,Ti!==null)throw Error(Tt(261));return ta=null,la=0,Ni}function Uoe(){for(;Ti!==null;)uq(Ti)}function joe(){for(;Ti!==null&&!dae();)uq(Ti)}function uq(e){var t=dq(e.alternate,e,Do);e.memoizedProps=e.pendingProps,t===null?lq(e):Ti=t,pR.current=null}function lq(e){var t=e;do{var r=t.alternate;if(e=t.return,t.flags&32768){if(r=koe(r,t),r!==null){r.flags&=32767,Ti=r;return}if(e!==null)e.flags|=32768,e.subtreeFlags=0,e.deletions=null;else{Ni=6,Ti=null;return}}else if(r=Roe(r,t,Do),r!==null){Ti=r;return}if(t=t.sibling,t!==null){Ti=t;return}Ti=t=e}while(t!==null);Ni===0&&(Ni=5)}function Uh(e,t,r){var n=xn,i=Is.transition;try{Is.transition=null,xn=1,zoe(e,t,r,n)}finally{Is.transition=i,xn=n}return null}function zoe(e,t,r,n){do Fm();while(cf!==null);if(an&6)throw Error(Tt(327));r=e.finishedWork;var i=e.finishedLanes;if(r===null)return null;if(e.finishedWork=null,e.finishedLanes=0,r===e.current)throw Error(Tt(177));e.callbackNode=null,e.callbackPriority=0;var a=r.lanes|r.childLanes;if(Sae(e,a),e===ta&&(Ti=ta=null,la=0),!(r.subtreeFlags&2064)&&!(r.flags&2064)||x2||(x2=!0,fq(TS,function(){return Fm(),null})),a=(r.flags&15990)!==0,r.subtreeFlags&15990||a){a=Is.transition,Is.transition=null;var o=xn;xn=1;var s=an;an|=4,pR.current=null,Loe(e,r),nq(r,e),soe(B4),MS=!!F4,B4=F4=null,e.current=r,Noe(r),fae(),an=s,xn=o,Is.transition=a}else e.current=r;if(x2&&(x2=!1,cf=e,WS=i),a=e.pendingLanes,a===0&&(Ef=null),vae(r.stateNode),vo(e,yi()),t!==null)for(n=e.onRecoverableError,r=0;r<t.length;r++)i=t[r],n(i.value,{componentStack:i.stack,digest:i.digest});if(qS)throw qS=!1,e=iI,iI=null,e;return WS&1&&e.tag!==0&&Fm(),a=e.pendingLanes,a&1?e===aI?ky++:(ky=0,aI=e):ky=0,ah(),null}function Fm(){if(cf!==null){var e=VH(WS),t=Is.transition,r=xn;try{if(Is.transition=null,xn=16>e?16:e,cf===null)var n=!1;else{if(e=cf,cf=null,WS=0,an&6)throw Error(Tt(331));var i=an;for(an|=4,zt=e.current;zt!==null;){var a=zt,o=a.child;if(zt.flags&16){var s=a.deletions;if(s!==null){for(var u=0;u<s.length;u++){var l=s[u];for(zt=l;zt!==null;){var c=zt;switch(c.tag){case 0:case 11:case 15:Dy(8,c,a)}var d=c.child;if(d!==null)d.return=c,zt=d;else for(;zt!==null;){c=zt;var f=c.sibling,h=c.return;if(eq(c),c===l){zt=null;break}if(f!==null){f.return=h,zt=f;break}zt=h}}}var v=a.alternate;if(v!==null){var p=v.child;if(p!==null){v.child=null;do{var m=p.sibling;p.sibling=null,p=m}while(p!==null)}}zt=a}}if(a.subtreeFlags&2064&&o!==null)o.return=a,zt=o;else e:for(;zt!==null;){if(a=zt,a.flags&2048)switch(a.tag){case 0:case 11:case 15:Dy(9,a,a.return)}var g=a.sibling;if(g!==null){g.return=a.return,zt=g;break e}zt=a.return}}var y=e.current;for(zt=y;zt!==null;){o=zt;var b=o.child;if(o.subtreeFlags&2064&&b!==null)b.return=o,zt=b;else e:for(o=y;zt!==null;){if(s=zt,s.flags&2048)try{switch(s.tag){case 0:case 11:case 15:uw(9,s)}}catch(x){fi(s,s.return,x)}if(s===o){zt=null;break e}var S=s.sibling;if(S!==null){S.return=s.return,zt=S;break e}zt=s.return}}if(an=i,ah(),fl&&typeof fl.onPostCommitFiberRoot=="function")try{fl.onPostCommitFiberRoot(ew,e)}catch{}n=!0}return n}finally{xn=r,Is.transition=t}}return!1}function HN(e,t,r){t=ug(r,t),t=HG(e,t,1),e=wf(e,t,1),t=qa(),e!==null&&(sb(e,1,t),vo(e,t))}function fi(e,t,r){if(e.tag===3)HN(e,e,r);else for(;t!==null;){if(t.tag===3){HN(t,e,r);break}else if(t.tag===1){var n=t.stateNode;if(typeof t.type.getDerivedStateFromError=="function"||typeof n.componentDidCatch=="function"&&(Ef===null||!Ef.has(n))){e=ug(r,e),e=GG(t,e,1),t=wf(t,e,1),e=qa(),t!==null&&(sb(t,1,e),vo(t,e));break}}t=t.return}}function Voe(e,t,r){var n=e.pingCache;n!==null&&n.delete(t),t=qa(),e.pingedLanes|=e.suspendedLanes&r,ta===e&&(la&r)===r&&(Ni===4||Ni===3&&(la&130023424)===la&&500>yi()-mR?cp(e,0):vR|=r),vo(e,t)}function cq(e,t){t===0&&(e.mode&1?(t=c2,c2<<=1,!(c2&130023424)&&(c2=4194304)):t=1);var r=qa();e=wc(e,t),e!==null&&(sb(e,t,r),vo(e,r))}function Hoe(e){var t=e.memoizedState,r=0;t!==null&&(r=t.retryLane),cq(e,r)}function Goe(e,t){var r=0;switch(e.tag){case 13:var n=e.stateNode,i=e.memoizedState;i!==null&&(r=i.retryLane);break;case 19:n=e.stateNode;break;default:throw Error(Tt(314))}n!==null&&n.delete(t),cq(e,r)}var dq;dq=function(e,t,r){if(e!==null)if(e.memoizedProps!==t.pendingProps||ho.current)fo=!0;else{if(!(e.lanes&r)&&!(t.flags&128))return fo=!1,Doe(e,t,r);fo=!!(e.flags&131072)}else fo=!1,Zn&&t.flags&1048576&&pG(t,FS,t.index);switch(t.lanes=0,t.tag){case 2:var n=t.type;$x(e,t),e=t.pendingProps;var i=ig(t,Ra.current);Nm(t,r),i=lR(null,t,n,e,i,r);var a=cR();return t.flags|=1,typeof i=="object"&&i!==null&&typeof i.render=="function"&&i.$$typeof===void 0?(t.tag=1,t.memoizedState=null,t.updateQueue=null,po(n)?(a=!0,LS(t)):a=!1,t.memoizedState=i.state!==null&&i.state!==void 0?i.state:null,iR(t),i.updater=ow,t.stateNode=i,i._reactInternals=t,$4(t,n,e,r),t=K4(null,t,n,!0,a,r)):(t.tag=0,Zn&&a&&QD(t),Ha(null,t,i,r),t=t.child),t;case 16:n=t.elementType;e:{switch($x(e,t),e=t.pendingProps,i=n._init,n=i(n._payload),t.type=n,i=t.tag=Woe(n),e=Js(n,e),i){case 0:t=Y4(null,t,n,e,r);break e;case 1:t=kN(null,t,n,e,r);break e;case 11:t=DN(null,t,n,e,r);break e;case 14:t=RN(null,t,n,Js(n.type,e),r);break e}throw Error(Tt(306,n,""))}return t;case 0:return n=t.type,i=t.pendingProps,i=t.elementType===n?i:Js(n,i),Y4(e,t,n,i,r);case 1:return n=t.type,i=t.pendingProps,i=t.elementType===n?i:Js(n,i),kN(e,t,n,i,r);case 3:e:{if(XG(t),e===null)throw Error(Tt(387));n=t.pendingProps,a=t.memoizedState,i=a.element,yG(e,t),jS(t,n,null,r);var o=t.memoizedState;if(n=o.element,a.isDehydrated)if(a={element:n,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},t.updateQueue.baseState=a,t.memoizedState=a,t.flags&256){i=ug(Error(Tt(423)),t),t=ON(e,t,n,r,i);break e}else if(n!==i){i=ug(Error(Tt(424)),t),t=ON(e,t,n,r,i);break e}else for(No=_f(t.stateNode.containerInfo.firstChild),jo=t,Zn=!0,nu=null,r=CG(t,null,n,r),t.child=r;r;)r.flags=r.flags&-3|4096,r=r.sibling;else{if(ag(),n===i){t=Ec(e,t,r);break e}Ha(e,t,n,r)}t=t.child}return t;case 5:return _G(t),e===null&&G4(t),n=t.type,i=t.pendingProps,a=e!==null?e.memoizedProps:null,o=i.children,U4(n,i)?o=null:a!==null&&U4(n,a)&&(t.flags|=32),$G(e,t),Ha(e,t,o,r),t.child;case 6:return e===null&&G4(t),null;case 13:return YG(e,t,r);case 4:return aR(t,t.stateNode.containerInfo),n=t.pendingProps,e===null?t.child=og(t,null,n,r):Ha(e,t,n,r),t.child;case 11:return n=t.type,i=t.pendingProps,i=t.elementType===n?i:Js(n,i),DN(e,t,n,i,r);case 7:return Ha(e,t,t.pendingProps,r),t.child;case 8:return Ha(e,t,t.pendingProps.children,r),t.child;case 12:return Ha(e,t,t.pendingProps.children,r),t.child;case 10:e:{if(n=t.type._context,i=t.pendingProps,a=t.memoizedProps,o=i.value,kn(BS,n._currentValue),n._currentValue=o,a!==null)if(Eu(a.value,o)){if(a.children===i.children&&!ho.current){t=Ec(e,t,r);break e}}else for(a=t.child,a!==null&&(a.return=t);a!==null;){var s=a.dependencies;if(s!==null){o=a.child;for(var u=s.firstContext;u!==null;){if(u.context===n){if(a.tag===1){u=pc(-1,r&-r),u.tag=2;var l=a.updateQueue;if(l!==null){l=l.shared;var c=l.pending;c===null?u.next=u:(u.next=c.next,c.next=u),l.pending=u}}a.lanes|=r,u=a.alternate,u!==null&&(u.lanes|=r),q4(a.return,r,t),s.lanes|=r;break}u=u.next}}else if(a.tag===10)o=a.type===t.type?null:a.child;else if(a.tag===18){if(o=a.return,o===null)throw Error(Tt(341));o.lanes|=r,s=o.alternate,s!==null&&(s.lanes|=r),q4(o,r,t),o=a.sibling}else o=a.child;if(o!==null)o.return=a;else for(o=a;o!==null;){if(o===t){o=null;break}if(a=o.sibling,a!==null){a.return=o.return,o=a;break}o=o.return}a=o}Ha(e,t,i.children,r),t=t.child}return t;case 9:return i=t.type,n=t.pendingProps.children,Nm(t,r),i=Rs(i),n=n(i),t.flags|=1,Ha(e,t,n,r),t.child;case 14:return n=t.type,i=Js(n,t.pendingProps),i=Js(n.type,i),RN(e,t,n,i,r);case 15:return qG(e,t,t.type,t.pendingProps,r);case 17:return n=t.type,i=t.pendingProps,i=t.elementType===n?i:Js(n,i),$x(e,t),t.tag=1,po(n)?(e=!0,LS(t)):e=!1,Nm(t,r),xG(t,n,i),$4(t,n,i,r),K4(null,t,n,!0,e,r);case 19:return KG(e,t,r);case 22:return WG(e,t,r)}throw Error(Tt(156,t.tag))};function fq(e,t){return BH(e,t)}function qoe(e,t,r,n){this.tag=e,this.key=r,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=n,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Es(e,t,r,n){return new qoe(e,t,r,n)}function xR(e){return e=e.prototype,!(!e||!e.isReactComponent)}function Woe(e){if(typeof e=="function")return xR(e)?1:0;if(e!=null){if(e=e.$$typeof,e===UD)return 11;if(e===jD)return 14}return 2}function Pf(e,t){var r=e.alternate;return r===null?(r=Es(e.tag,t,e.key,e.mode),r.elementType=e.elementType,r.type=e.type,r.stateNode=e.stateNode,r.alternate=e,e.alternate=r):(r.pendingProps=t,r.type=e.type,r.flags=0,r.subtreeFlags=0,r.deletions=null),r.flags=e.flags&14680064,r.childLanes=e.childLanes,r.lanes=e.lanes,r.child=e.child,r.memoizedProps=e.memoizedProps,r.memoizedState=e.memoizedState,r.updateQueue=e.updateQueue,t=e.dependencies,r.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext},r.sibling=e.sibling,r.index=e.index,r.ref=e.ref,r}function Kx(e,t,r,n,i,a){var o=2;if(n=e,typeof e=="function")xR(e)&&(o=1);else if(typeof e=="string")o=5;else e:switch(e){case cm:return dp(r.children,i,a,t);case BD:o=8,i|=8;break;case g4:return e=Es(12,r,t,i|2),e.elementType=g4,e.lanes=a,e;case y4:return e=Es(13,r,t,i),e.elementType=y4,e.lanes=a,e;case b4:return e=Es(19,r,t,i),e.elementType=b4,e.lanes=a,e;case SH:return cw(r,i,a,t);default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case bH:o=10;break e;case xH:o=9;break e;case UD:o=11;break e;case jD:o=14;break e;case Vd:o=16,n=null;break e}throw Error(Tt(130,e==null?e:typeof e,""))}return t=Es(o,r,t,i),t.elementType=e,t.type=n,t.lanes=a,t}function dp(e,t,r,n){return e=Es(7,e,n,t),e.lanes=r,e}function cw(e,t,r,n){return e=Es(22,e,n,t),e.elementType=SH,e.lanes=r,e.stateNode={isHidden:!1},e}function uA(e,t,r){return e=Es(6,e,null,t),e.lanes=r,e}function lA(e,t,r){return t=Es(4,e.children!==null?e.children:[],e.key,t),t.lanes=r,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function $oe(e,t,r,n,i){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=HE(0),this.expirationTimes=HE(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=HE(0),this.identifierPrefix=n,this.onRecoverableError=i,this.mutableSourceEagerHydrationData=null}function SR(e,t,r,n,i,a,o,s,u){return e=new $oe(e,t,r,s,u),t===1?(t=1,a===!0&&(t|=8)):t=0,a=Es(3,null,null,t),e.current=a,a.stateNode=e,a.memoizedState={element:n,isDehydrated:r,cache:null,transitions:null,pendingSuspenseBoundaries:null},iR(a),e}function Xoe(e,t,r){var n=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:lm,key:n==null?null:""+n,children:e,containerInfo:t,implementation:r}}function hq(e){if(!e)return Uf;e=e._reactInternals;e:{if(av(e)!==e||e.tag!==1)throw Error(Tt(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(po(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(t!==null);throw Error(Tt(171))}if(e.tag===1){var r=e.type;if(po(r))return fG(e,r,t)}return t}function pq(e,t,r,n,i,a,o,s,u){return e=SR(r,n,!0,e,i,a,o,s,u),e.context=hq(null),r=e.current,n=qa(),i=Af(r),a=pc(n,i),a.callback=t??null,wf(r,a,i),e.current.lanes=i,sb(e,i,n),vo(e,n),e}function dw(e,t,r,n){var i=t.current,a=qa(),o=Af(i);return r=hq(r),t.context===null?t.context=r:t.pendingContext=r,t=pc(a,o),t.payload={element:e},n=n===void 0?null:n,n!==null&&(t.callback=n),e=wf(i,t,o),e!==null&&(pu(e,i,o,a),Gx(e,i,o)),o}function XS(e){if(e=e.current,!e.child)return null;switch(e.child.tag){case 5:return e.child.stateNode;default:return e.child.stateNode}}function GN(e,t){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var r=e.retryLane;e.retryLane=r!==0&&r<t?r:t}}function CR(e,t){GN(e,t),(e=e.alternate)&&GN(e,t)}function Yoe(){return null}var vq=typeof reportError=="function"?reportError:function(e){console.error(e)};function _R(e){this._internalRoot=e}fw.prototype.render=_R.prototype.render=function(e){var t=this._internalRoot;if(t===null)throw Error(Tt(409));dw(e,t,null,null)};fw.prototype.unmount=_R.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var t=e.containerInfo;Mp(function(){dw(null,e,null,null)}),t[_c]=null}};function fw(e){this._internalRoot=e}fw.prototype.unstable_scheduleHydration=function(e){if(e){var t=qH();e={blockedOn:null,target:e,priority:t};for(var r=0;r<Wd.length&&t!==0&&t<Wd[r].priority;r++);Wd.splice(r,0,e),r===0&&$H(e)}};function wR(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function hw(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11&&(e.nodeType!==8||e.nodeValue!==" react-mount-point-unstable "))}function qN(){}function Koe(e,t,r,n,i){if(i){if(typeof n=="function"){var a=n;n=function(){var l=XS(o);a.call(l)}}var o=pq(t,n,e,0,null,!1,!1,"",qN);return e._reactRootContainer=o,e[_c]=o.current,c1(e.nodeType===8?e.parentNode:e),Mp(),o}for(;i=e.lastChild;)e.removeChild(i);if(typeof n=="function"){var s=n;n=function(){var l=XS(u);s.call(l)}}var u=SR(e,0,!1,null,null,!1,!1,"",qN);return e._reactRootContainer=u,e[_c]=u.current,c1(e.nodeType===8?e.parentNode:e),Mp(function(){dw(t,u,r,n)}),u}function pw(e,t,r,n,i){var a=r._reactRootContainer;if(a){var o=a;if(typeof i=="function"){var s=i;i=function(){var u=XS(o);s.call(u)}}dw(t,o,e,i)}else o=Koe(r,t,e,i,n);return XS(o)}HH=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var r=iy(t.pendingLanes);r!==0&&(HD(t,r|1),vo(t,yi()),!(an&6)&&(lg=yi()+500,ah()))}break;case 13:Mp(function(){var n=wc(e,1);if(n!==null){var i=qa();pu(n,e,1,i)}}),CR(e,1)}};GD=function(e){if(e.tag===13){var t=wc(e,134217728);if(t!==null){var r=qa();pu(t,e,134217728,r)}CR(e,134217728)}};GH=function(e){if(e.tag===13){var t=Af(e),r=wc(e,t);if(r!==null){var n=qa();pu(r,e,t,n)}CR(e,t)}};qH=function(){return xn};WH=function(e,t){var r=xn;try{return xn=e,t()}finally{xn=r}};I4=function(e,t,r){switch(t){case"input":if(C4(e,r),t=r.name,r.type==="radio"&&t!=null){for(r=e;r.parentNode;)r=r.parentNode;for(r=r.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<r.length;t++){var n=r[t];if(n!==e&&n.form===e.form){var i=iw(n);if(!i)throw Error(Tt(90));_H(n),C4(n,i)}}}break;case"textarea":EH(e,r);break;case"select":t=r.value,t!=null&&Rm(e,!!r.multiple,t,!1)}};RH=gR;kH=Mp;var Qoe={usingClientEntryPoint:!1,Events:[lb,pm,iw,MH,DH,gR]},C0={findFiberByHostInstance:Jh,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},Zoe={bundleType:C0.bundleType,version:C0.version,rendererPackageName:C0.rendererPackageName,rendererConfig:C0.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Yc.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return e=NH(e),e===null?null:e.stateNode},findFiberByHostInstance:C0.findFiberByHostInstance||Yoe,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var S2=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!S2.isDisabled&&S2.supportsFiber)try{ew=S2.inject(Zoe),fl=S2}catch{}}Jo.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Qoe;Jo.createPortal=function(e,t){var r=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!wR(t))throw Error(Tt(200));return Xoe(e,t,null,r)};Jo.createRoot=function(e,t){if(!wR(e))throw Error(Tt(299));var r=!1,n="",i=vq;return t!=null&&(t.unstable_strictMode===!0&&(r=!0),t.identifierPrefix!==void 0&&(n=t.identifierPrefix),t.onRecoverableError!==void 0&&(i=t.onRecoverableError)),t=SR(e,1,!1,null,null,r,!1,n,i),e[_c]=t.current,c1(e.nodeType===8?e.parentNode:e),new _R(t)};Jo.findDOMNode=function(e){if(e==null)return null;if(e.nodeType===1)return e;var t=e._reactInternals;if(t===void 0)throw typeof e.render=="function"?Error(Tt(188)):(e=Object.keys(e).join(","),Error(Tt(268,e)));return e=NH(t),e=e===null?null:e.stateNode,e};Jo.flushSync=function(e){return Mp(e)};Jo.hydrate=function(e,t,r){if(!hw(t))throw Error(Tt(200));return pw(null,e,t,!0,r)};Jo.hydrateRoot=function(e,t,r){if(!wR(e))throw Error(Tt(405));var n=r!=null&&r.hydratedSources||null,i=!1,a="",o=vq;if(r!=null&&(r.unstable_strictMode===!0&&(i=!0),r.identifierPrefix!==void 0&&(a=r.identifierPrefix),r.onRecoverableError!==void 0&&(o=r.onRecoverableError)),t=pq(t,null,e,1,r??null,i,!1,a,o),e[_c]=t.current,c1(e),n)for(e=0;e<n.length;e++)r=n[e],i=r._getVersion,i=i(r._source),t.mutableSourceEagerHydrationData==null?t.mutableSourceEagerHydrationData=[r,i]:t.mutableSourceEagerHydrationData.push(r,i);return new fw(t)};Jo.render=function(e,t,r){if(!hw(t))throw Error(Tt(200));return pw(null,e,t,!1,r)};Jo.unmountComponentAtNode=function(e){if(!hw(e))throw Error(Tt(40));return e._reactRootContainer?(Mp(function(){pw(null,null,e,!1,function(){e._reactRootContainer=null,e[_c]=null})}),!0):!1};Jo.unstable_batchedUpdates=gR;Jo.unstable_renderSubtreeIntoContainer=function(e,t,r,n){if(!hw(r))throw Error(Tt(200));if(e==null||e._reactInternals===void 0)throw Error(Tt(38));return pw(e,t,r,!1,n)};Jo.version="18.2.0-next-9e3b772b8-20220608";function mq(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(mq)}catch(e){console.error(e)}}mq(),pH.exports=Jo;var ER=pH.exports,WN=ER;v4.createRoot=WN.createRoot,v4.hydrateRoot=WN.hydrateRoot;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gq=function(e){const t=[];let r=0;for(let n=0;n<e.length;n++){let i=e.charCodeAt(n);i<128?t[r++]=i:i<2048?(t[r++]=i>>6|192,t[r++]=i&63|128):(i&64512)===55296&&n+1<e.length&&(e.charCodeAt(n+1)&64512)===56320?(i=65536+((i&1023)<<10)+(e.charCodeAt(++n)&1023),t[r++]=i>>18|240,t[r++]=i>>12&63|128,t[r++]=i>>6&63|128,t[r++]=i&63|128):(t[r++]=i>>12|224,t[r++]=i>>6&63|128,t[r++]=i&63|128)}return t},Joe=function(e){const t=[];let r=0,n=0;for(;r<e.length;){const i=e[r++];if(i<128)t[n++]=String.fromCharCode(i);else if(i>191&&i<224){const a=e[r++];t[n++]=String.fromCharCode((i&31)<<6|a&63)}else if(i>239&&i<365){const a=e[r++],o=e[r++],s=e[r++],u=((i&7)<<18|(a&63)<<12|(o&63)<<6|s&63)-65536;t[n++]=String.fromCharCode(55296+(u>>10)),t[n++]=String.fromCharCode(56320+(u&1023))}else{const a=e[r++],o=e[r++];t[n++]=String.fromCharCode((i&15)<<12|(a&63)<<6|o&63)}}return t.join("")},yq={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();const r=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,n=[];for(let i=0;i<e.length;i+=3){const a=e[i],o=i+1<e.length,s=o?e[i+1]:0,u=i+2<e.length,l=u?e[i+2]:0,c=a>>2,d=(a&3)<<4|s>>4;let f=(s&15)<<2|l>>6,h=l&63;u||(h=64,o||(f=64)),n.push(r[c],r[d],r[f],r[h])}return n.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(gq(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):Joe(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();const r=t?this.charToByteMapWebSafe_:this.charToByteMap_,n=[];for(let i=0;i<e.length;){const a=r[e.charAt(i++)],s=i<e.length?r[e.charAt(i)]:0;++i;const l=i<e.length?r[e.charAt(i)]:64;++i;const d=i<e.length?r[e.charAt(i)]:64;if(++i,a==null||s==null||l==null||d==null)throw new ese;const f=a<<2|s>>4;if(n.push(f),l!==64){const h=s<<4&240|l>>2;if(n.push(h),d!==64){const v=l<<6&192|d;n.push(v)}}}return n},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class ese extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const tse=function(e){const t=gq(e);return yq.encodeByteArray(t,!0)},bq=function(e){return tse(e).replace(/\./g,"")},xq=function(e){try{return yq.decodeString(e,!0)}catch(t){console.error("base64Decode failed: ",t)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rse(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nse=()=>rse().__FIREBASE_DEFAULTS__,ise=()=>{if(typeof process>"u"||typeof process.env>"u")return;const e={}.__FIREBASE_DEFAULTS__;if(e)return JSON.parse(e)},ase=()=>{if(typeof document>"u")return;let e;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const t=e&&xq(e[1]);return t&&JSON.parse(t)},AR=()=>{try{return nse()||ise()||ase()}catch(e){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`);return}},ose=e=>{var t,r;return(r=(t=AR())===null||t===void 0?void 0:t.emulatorHosts)===null||r===void 0?void 0:r[e]},Sq=()=>{var e;return(e=AR())===null||e===void 0?void 0:e.config},Cq=e=>{var t;return(t=AR())===null||t===void 0?void 0:t[`_${e}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sse{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((t,r)=>{this.resolve=t,this.reject=r})}wrapCallback(t){return(r,n)=>{r?this.reject(r):this.resolve(n),typeof t=="function"&&(this.promise.catch(()=>{}),t.length===1?t(r):t(r,n))}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ka(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function use(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(ka())}function lse(){const e=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof e=="object"&&e.id!==void 0}function cse(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function dse(){const e=ka();return e.indexOf("MSIE ")>=0||e.indexOf("Trident/")>=0}function fse(){try{return typeof indexedDB=="object"}catch{return!1}}function hse(){return new Promise((e,t)=>{try{let r=!0;const n="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(n);i.onsuccess=()=>{i.result.close(),r||self.indexedDB.deleteDatabase(n),e(!0)},i.onupgradeneeded=()=>{r=!1},i.onerror=()=>{var a;t(((a=i.error)===null||a===void 0?void 0:a.message)||"")}}catch(r){t(r)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pse="FirebaseError";class oh extends Error{constructor(t,r,n){super(r),this.code=t,this.customData=n,this.name=pse,Object.setPrototypeOf(this,oh.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,db.prototype.create)}}class db{constructor(t,r,n){this.service=t,this.serviceName=r,this.errors=n}create(t,...r){const n=r[0]||{},i=`${this.service}/${t}`,a=this.errors[t],o=a?vse(a,n):"Error",s=`${this.serviceName}: ${o} (${i}).`;return new oh(i,s,n)}}function vse(e,t){return e.replace(mse,(r,n)=>{const i=t[n];return i!=null?String(i):`<${n}?>`})}const mse=/\{\$([^}]+)}/g;function gse(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}function YS(e,t){if(e===t)return!0;const r=Object.keys(e),n=Object.keys(t);for(const i of r){if(!n.includes(i))return!1;const a=e[i],o=t[i];if($N(a)&&$N(o)){if(!YS(a,o))return!1}else if(a!==o)return!1}for(const i of n)if(!r.includes(i))return!1;return!0}function $N(e){return e!==null&&typeof e=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fb(e){const t=[];for(const[r,n]of Object.entries(e))Array.isArray(n)?n.forEach(i=>{t.push(encodeURIComponent(r)+"="+encodeURIComponent(i))}):t.push(encodeURIComponent(r)+"="+encodeURIComponent(n));return t.length?"&"+t.join("&"):""}function oy(e){const t={};return e.replace(/^\?/,"").split("&").forEach(n=>{if(n){const[i,a]=n.split("=");t[decodeURIComponent(i)]=decodeURIComponent(a)}}),t}function sy(e){const t=e.indexOf("?");if(!t)return"";const r=e.indexOf("#",t);return e.substring(t,r>0?r:void 0)}function yse(e,t){const r=new bse(e,t);return r.subscribe.bind(r)}class bse{constructor(t,r){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=r,this.task.then(()=>{t(this)}).catch(n=>{this.error(n)})}next(t){this.forEachObserver(r=>{r.next(t)})}error(t){this.forEachObserver(r=>{r.error(t)}),this.close(t)}complete(){this.forEachObserver(t=>{t.complete()}),this.close()}subscribe(t,r,n){let i;if(t===void 0&&r===void 0&&n===void 0)throw new Error("Missing Observer.");xse(t,["next","error","complete"])?i=t:i={next:t,error:r,complete:n},i.next===void 0&&(i.next=cA),i.error===void 0&&(i.error=cA),i.complete===void 0&&(i.complete=cA);const a=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?i.error(this.finalError):i.complete()}catch{}}),this.observers.push(i),a}unsubscribeOne(t){this.observers===void 0||this.observers[t]===void 0||(delete this.observers[t],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(t){if(!this.finalized)for(let r=0;r<this.observers.length;r++)this.sendOne(r,t)}sendOne(t,r){this.task.then(()=>{if(this.observers!==void 0&&this.observers[t]!==void 0)try{r(this.observers[t])}catch(n){typeof console<"u"&&console.error&&console.error(n)}})}close(t){this.finalized||(this.finalized=!0,t!==void 0&&(this.finalError=t),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function xse(e,t){if(typeof e!="object"||e===null)return!1;for(const r of t)if(r in e&&typeof e[r]=="function")return!0;return!1}function cA(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Kc(e){return e&&e._delegate?e._delegate:e}class cg{constructor(t,r,n){this.name=t,this.instanceFactory=r,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(t){return this.instantiationMode=t,this}setMultipleInstances(t){return this.multipleInstances=t,this}setServiceProps(t){return this.serviceProps=t,this}setInstanceCreatedCallback(t){return this.onInstanceCreated=t,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jh="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Sse=class{constructor(t,r){this.name=t,this.container=r,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(t){const r=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(r)){const n=new sse;if(this.instancesDeferred.set(r,n),this.isInitialized(r)||this.shouldAutoInitialize())try{const i=this.getOrInitializeService({instanceIdentifier:r});i&&n.resolve(i)}catch{}}return this.instancesDeferred.get(r).promise}getImmediate(t){var r;const n=this.normalizeInstanceIdentifier(t==null?void 0:t.identifier),i=(r=t==null?void 0:t.optional)!==null&&r!==void 0?r:!1;if(this.isInitialized(n)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:n})}catch(a){if(i)return null;throw a}else{if(i)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(t){if(t.name!==this.name)throw Error(`Mismatching Component ${t.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=t,!!this.shouldAutoInitialize()){if(_se(t))try{this.getOrInitializeService({instanceIdentifier:jh})}catch{}for(const[r,n]of this.instancesDeferred.entries()){const i=this.normalizeInstanceIdentifier(r);try{const a=this.getOrInitializeService({instanceIdentifier:i});n.resolve(a)}catch{}}}}clearInstance(t=jh){this.instancesDeferred.delete(t),this.instancesOptions.delete(t),this.instances.delete(t)}async delete(){const t=Array.from(this.instances.values());await Promise.all([...t.filter(r=>"INTERNAL"in r).map(r=>r.INTERNAL.delete()),...t.filter(r=>"_delete"in r).map(r=>r._delete())])}isComponentSet(){return this.component!=null}isInitialized(t=jh){return this.instances.has(t)}getOptions(t=jh){return this.instancesOptions.get(t)||{}}initialize(t={}){const{options:r={}}=t,n=this.normalizeInstanceIdentifier(t.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const i=this.getOrInitializeService({instanceIdentifier:n,options:r});for(const[a,o]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(a);n===s&&o.resolve(i)}return i}onInit(t,r){var n;const i=this.normalizeInstanceIdentifier(r),a=(n=this.onInitCallbacks.get(i))!==null&&n!==void 0?n:new Set;a.add(t),this.onInitCallbacks.set(i,a);const o=this.instances.get(i);return o&&t(o,i),()=>{a.delete(t)}}invokeOnInitCallbacks(t,r){const n=this.onInitCallbacks.get(r);if(n)for(const i of n)try{i(t,r)}catch{}}getOrInitializeService({instanceIdentifier:t,options:r={}}){let n=this.instances.get(t);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:Cse(t),options:r}),this.instances.set(t,n),this.instancesOptions.set(t,r),this.invokeOnInitCallbacks(n,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,n)}catch{}return n||null}normalizeInstanceIdentifier(t=jh){return this.component?this.component.multipleInstances?t:jh:t}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}};function Cse(e){return e===jh?void 0:e}function _se(e){return e.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wse{constructor(t){this.name=t,this.providers=new Map}addComponent(t){const r=this.getProvider(t.name);if(r.isComponentSet())throw new Error(`Component ${t.name} has already been registered with ${this.name}`);r.setComponent(t)}addOrOverwriteComponent(t){this.getProvider(t.name).isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)}getProvider(t){if(this.providers.has(t))return this.providers.get(t);const r=new Sse(t,this);return this.providers.set(t,r),r}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Pn;(function(e){e[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"})(Pn||(Pn={}));const Ese={debug:Pn.DEBUG,verbose:Pn.VERBOSE,info:Pn.INFO,warn:Pn.WARN,error:Pn.ERROR,silent:Pn.SILENT},Ase=Pn.INFO,Pse={[Pn.DEBUG]:"log",[Pn.VERBOSE]:"log",[Pn.INFO]:"info",[Pn.WARN]:"warn",[Pn.ERROR]:"error"},Tse=(e,t,...r)=>{if(t<e.logLevel)return;const n=new Date().toISOString(),i=Pse[t];if(i)console[i](`[${n}]  ${e.name}:`,...r);else throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`)};class _q{constructor(t){this.name=t,this._logLevel=Ase,this._logHandler=Tse,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(t){if(!(t in Pn))throw new TypeError(`Invalid value "${t}" assigned to \`logLevel\``);this._logLevel=t}setLogLevel(t){this._logLevel=typeof t=="string"?Ese[t]:t}get logHandler(){return this._logHandler}set logHandler(t){if(typeof t!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t}get userLogHandler(){return this._userLogHandler}set userLogHandler(t){this._userLogHandler=t}debug(...t){this._userLogHandler&&this._userLogHandler(this,Pn.DEBUG,...t),this._logHandler(this,Pn.DEBUG,...t)}log(...t){this._userLogHandler&&this._userLogHandler(this,Pn.VERBOSE,...t),this._logHandler(this,Pn.VERBOSE,...t)}info(...t){this._userLogHandler&&this._userLogHandler(this,Pn.INFO,...t),this._logHandler(this,Pn.INFO,...t)}warn(...t){this._userLogHandler&&this._userLogHandler(this,Pn.WARN,...t),this._logHandler(this,Pn.WARN,...t)}error(...t){this._userLogHandler&&this._userLogHandler(this,Pn.ERROR,...t),this._logHandler(this,Pn.ERROR,...t)}}const Ise=(e,t)=>t.some(r=>e instanceof r);let XN,YN;function Mse(){return XN||(XN=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Dse(){return YN||(YN=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const wq=new WeakMap,uI=new WeakMap,Eq=new WeakMap,dA=new WeakMap,PR=new WeakMap;function Rse(e){const t=new Promise((r,n)=>{const i=()=>{e.removeEventListener("success",a),e.removeEventListener("error",o)},a=()=>{r(Tf(e.result)),i()},o=()=>{n(e.error),i()};e.addEventListener("success",a),e.addEventListener("error",o)});return t.then(r=>{r instanceof IDBCursor&&wq.set(r,e)}).catch(()=>{}),PR.set(t,e),t}function kse(e){if(uI.has(e))return;const t=new Promise((r,n)=>{const i=()=>{e.removeEventListener("complete",a),e.removeEventListener("error",o),e.removeEventListener("abort",o)},a=()=>{r(),i()},o=()=>{n(e.error||new DOMException("AbortError","AbortError")),i()};e.addEventListener("complete",a),e.addEventListener("error",o),e.addEventListener("abort",o)});uI.set(e,t)}let lI={get(e,t,r){if(e instanceof IDBTransaction){if(t==="done")return uI.get(e);if(t==="objectStoreNames")return e.objectStoreNames||Eq.get(e);if(t==="store")return r.objectStoreNames[1]?void 0:r.objectStore(r.objectStoreNames[0])}return Tf(e[t])},set(e,t,r){return e[t]=r,!0},has(e,t){return e instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in e}};function Ose(e){lI=e(lI)}function Lse(e){return e===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(t,...r){const n=e.call(fA(this),t,...r);return Eq.set(n,t.sort?t.sort():[t]),Tf(n)}:Dse().includes(e)?function(...t){return e.apply(fA(this),t),Tf(wq.get(this))}:function(...t){return Tf(e.apply(fA(this),t))}}function Nse(e){return typeof e=="function"?Lse(e):(e instanceof IDBTransaction&&kse(e),Ise(e,Mse())?new Proxy(e,lI):e)}function Tf(e){if(e instanceof IDBRequest)return Rse(e);if(dA.has(e))return dA.get(e);const t=Nse(e);return t!==e&&(dA.set(e,t),PR.set(t,e)),t}const fA=e=>PR.get(e);function Fse(e,t,{blocked:r,upgrade:n,blocking:i,terminated:a}={}){const o=indexedDB.open(e,t),s=Tf(o);return n&&o.addEventListener("upgradeneeded",u=>{n(Tf(o.result),u.oldVersion,u.newVersion,Tf(o.transaction),u)}),r&&o.addEventListener("blocked",u=>r(u.oldVersion,u.newVersion,u)),s.then(u=>{a&&u.addEventListener("close",()=>a()),i&&u.addEventListener("versionchange",l=>i(l.oldVersion,l.newVersion,l))}).catch(()=>{}),s}const Bse=["get","getKey","getAll","getAllKeys","count"],Use=["put","add","delete","clear"],hA=new Map;function KN(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&typeof t=="string"))return;if(hA.get(t))return hA.get(t);const r=t.replace(/FromIndex$/,""),n=t!==r,i=Use.includes(r);if(!(r in(n?IDBIndex:IDBObjectStore).prototype)||!(i||Bse.includes(r)))return;const a=async function(o,...s){const u=this.transaction(o,i?"readwrite":"readonly");let l=u.store;return n&&(l=l.index(s.shift())),(await Promise.all([l[r](...s),i&&u.done]))[0]};return hA.set(t,a),a}Ose(e=>({...e,get:(t,r,n)=>KN(t,r)||e.get(t,r,n),has:(t,r)=>!!KN(t,r)||e.has(t,r)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jse{constructor(t){this.container=t}getPlatformInfoString(){return this.container.getProviders().map(r=>{if(zse(r)){const n=r.getImmediate();return`${n.library}/${n.version}`}else return null}).filter(r=>r).join(" ")}}function zse(e){const t=e.getComponent();return(t==null?void 0:t.type)==="VERSION"}const cI="@firebase/app",QN="0.9.10";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Dp=new _q("@firebase/app"),Vse="@firebase/app-compat",Hse="@firebase/analytics-compat",Gse="@firebase/analytics",qse="@firebase/app-check-compat",Wse="@firebase/app-check",$se="@firebase/auth",Xse="@firebase/auth-compat",Yse="@firebase/database",Kse="@firebase/database-compat",Qse="@firebase/functions",Zse="@firebase/functions-compat",Jse="@firebase/installations",eue="@firebase/installations-compat",tue="@firebase/messaging",rue="@firebase/messaging-compat",nue="@firebase/performance",iue="@firebase/performance-compat",aue="@firebase/remote-config",oue="@firebase/remote-config-compat",sue="@firebase/storage",uue="@firebase/storage-compat",lue="@firebase/firestore",cue="@firebase/firestore-compat",due="firebase",fue="9.22.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dI="[DEFAULT]",hue={[cI]:"fire-core",[Vse]:"fire-core-compat",[Gse]:"fire-analytics",[Hse]:"fire-analytics-compat",[Wse]:"fire-app-check",[qse]:"fire-app-check-compat",[$se]:"fire-auth",[Xse]:"fire-auth-compat",[Yse]:"fire-rtdb",[Kse]:"fire-rtdb-compat",[Qse]:"fire-fn",[Zse]:"fire-fn-compat",[Jse]:"fire-iid",[eue]:"fire-iid-compat",[tue]:"fire-fcm",[rue]:"fire-fcm-compat",[nue]:"fire-perf",[iue]:"fire-perf-compat",[aue]:"fire-rc",[oue]:"fire-rc-compat",[sue]:"fire-gcs",[uue]:"fire-gcs-compat",[lue]:"fire-fst",[cue]:"fire-fst-compat","fire-js":"fire-js",[due]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const KS=new Map,fI=new Map;function pue(e,t){try{e.container.addComponent(t)}catch(r){Dp.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,r)}}function b1(e){const t=e.name;if(fI.has(t))return Dp.debug(`There were multiple attempts to register component ${t}.`),!1;fI.set(t,e);for(const r of KS.values())pue(r,e);return!0}function Aq(e,t){const r=e.container.getProvider("heartbeat").getImmediate({optional:!0});return r&&r.triggerHeartbeat(),e.container.getProvider(t)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vue={["no-app"]:"No Firebase App '{$appName}' has been created - call initializeApp() first",["bad-app-name"]:"Illegal App name: '{$appName}",["duplicate-app"]:"Firebase App named '{$appName}' already exists with different options or config",["app-deleted"]:"Firebase App named '{$appName}' already deleted",["no-options"]:"Need to provide options, when not being deployed to hosting via source.",["invalid-app-argument"]:"firebase.{$appName}() takes either no argument or a Firebase App instance.",["invalid-log-argument"]:"First argument to `onLog` must be null or a function.",["idb-open"]:"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.",["idb-get"]:"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.",["idb-set"]:"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.",["idb-delete"]:"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}."},If=new db("app","Firebase",vue);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mue{constructor(t,r,n){this._isDeleted=!1,this._options=Object.assign({},t),this._config=Object.assign({},r),this._name=r.name,this._automaticDataCollectionEnabled=r.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new cg("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(t){this.checkDestroyed(),this._automaticDataCollectionEnabled=t}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(t){this._isDeleted=t}checkDestroyed(){if(this.isDeleted)throw If.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hb=fue;function Pq(e,t={}){let r=e;typeof t!="object"&&(t={name:t});const n=Object.assign({name:dI,automaticDataCollectionEnabled:!1},t),i=n.name;if(typeof i!="string"||!i)throw If.create("bad-app-name",{appName:String(i)});if(r||(r=Sq()),!r)throw If.create("no-options");const a=KS.get(i);if(a){if(YS(r,a.options)&&YS(n,a.config))return a;throw If.create("duplicate-app",{appName:i})}const o=new wse(i);for(const u of fI.values())o.addComponent(u);const s=new mue(r,n,o);return KS.set(i,s),s}function gue(e=dI){const t=KS.get(e);if(!t&&e===dI&&Sq())return Pq();if(!t)throw If.create("no-app",{appName:e});return t}function Bm(e,t,r){var n;let i=(n=hue[e])!==null&&n!==void 0?n:e;r&&(i+=`-${r}`);const a=i.match(/\s|\//),o=t.match(/\s|\//);if(a||o){const s=[`Unable to register library "${i}" with version "${t}":`];a&&s.push(`library name "${i}" contains illegal characters (whitespace or "/")`),a&&o&&s.push("and"),o&&s.push(`version name "${t}" contains illegal characters (whitespace or "/")`),Dp.warn(s.join(" "));return}b1(new cg(`${i}-version`,()=>({library:i,version:t}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yue="firebase-heartbeat-database",bue=1,x1="firebase-heartbeat-store";let pA=null;function Tq(){return pA||(pA=Fse(yue,bue,{upgrade:(e,t)=>{switch(t){case 0:e.createObjectStore(x1)}}}).catch(e=>{throw If.create("idb-open",{originalErrorMessage:e.message})})),pA}async function xue(e){try{return await(await Tq()).transaction(x1).objectStore(x1).get(Iq(e))}catch(t){if(t instanceof oh)Dp.warn(t.message);else{const r=If.create("idb-get",{originalErrorMessage:t==null?void 0:t.message});Dp.warn(r.message)}}}async function ZN(e,t){try{const n=(await Tq()).transaction(x1,"readwrite");await n.objectStore(x1).put(t,Iq(e)),await n.done}catch(r){if(r instanceof oh)Dp.warn(r.message);else{const n=If.create("idb-set",{originalErrorMessage:r==null?void 0:r.message});Dp.warn(n.message)}}}function Iq(e){return`${e.name}!${e.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Sue=1024,Cue=30*24*60*60*1e3;class _ue{constructor(t){this.container=t,this._heartbeatsCache=null;const r=this.container.getProvider("app").getImmediate();this._storage=new Eue(r),this._heartbeatsCachePromise=this._storage.read().then(n=>(this._heartbeatsCache=n,n))}async triggerHeartbeat(){const r=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),n=JN();if(this._heartbeatsCache===null&&(this._heartbeatsCache=await this._heartbeatsCachePromise),!(this._heartbeatsCache.lastSentHeartbeatDate===n||this._heartbeatsCache.heartbeats.some(i=>i.date===n)))return this._heartbeatsCache.heartbeats.push({date:n,agent:r}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(i=>{const a=new Date(i.date).valueOf();return Date.now()-a<=Cue}),this._storage.overwrite(this._heartbeatsCache)}async getHeartbeatsHeader(){if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,this._heartbeatsCache===null||this._heartbeatsCache.heartbeats.length===0)return"";const t=JN(),{heartbeatsToSend:r,unsentEntries:n}=wue(this._heartbeatsCache.heartbeats),i=bq(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=t,n.length>0?(this._heartbeatsCache.heartbeats=n,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}}function JN(){return new Date().toISOString().substring(0,10)}function wue(e,t=Sue){const r=[];let n=e.slice();for(const i of e){const a=r.find(o=>o.agent===i.agent);if(a){if(a.dates.push(i.date),eF(r)>t){a.dates.pop();break}}else if(r.push({agent:i.agent,dates:[i.date]}),eF(r)>t){r.pop();break}n=n.slice(1)}return{heartbeatsToSend:r,unsentEntries:n}}class Eue{constructor(t){this.app=t,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return fse()?hse().then(()=>!0).catch(()=>!1):!1}async read(){return await this._canUseIndexedDBPromise?await xue(this.app)||{heartbeats:[]}:{heartbeats:[]}}async overwrite(t){var r;if(await this._canUseIndexedDBPromise){const i=await this.read();return ZN(this.app,{lastSentHeartbeatDate:(r=t.lastSentHeartbeatDate)!==null&&r!==void 0?r:i.lastSentHeartbeatDate,heartbeats:t.heartbeats})}else return}async add(t){var r;if(await this._canUseIndexedDBPromise){const i=await this.read();return ZN(this.app,{lastSentHeartbeatDate:(r=t.lastSentHeartbeatDate)!==null&&r!==void 0?r:i.lastSentHeartbeatDate,heartbeats:[...i.heartbeats,...t.heartbeats]})}else return}}function eF(e){return bq(JSON.stringify({version:2,heartbeats:e})).length}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Aue(e){b1(new cg("platform-logger",t=>new jse(t),"PRIVATE")),b1(new cg("heartbeat",t=>new _ue(t),"PRIVATE")),Bm(cI,QN,e),Bm(cI,QN,"esm2017"),Bm("fire-js","")}Aue("");var Pue="firebase",Tue="9.22.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Bm(Pue,Tue,"app");function TR(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]]);return r}function Mq(){return{["dependent-sdk-initialized-before-auth"]:"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const Iue=Mq,Dq=new db("auth","Firebase",Mq());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const QS=new _q("@firebase/auth");function Mue(e,...t){QS.logLevel<=Pn.WARN&&QS.warn(`Auth (${hb}): ${e}`,...t)}function Qx(e,...t){QS.logLevel<=Pn.ERROR&&QS.error(`Auth (${hb}): ${e}`,...t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Au(e,...t){throw IR(e,...t)}function pl(e,...t){return IR(e,...t)}function Due(e,t,r){const n=Object.assign(Object.assign({},Iue()),{[t]:r});return new db("auth","Firebase",n).create(t,{appName:e.name})}function IR(e,...t){if(typeof e!="string"){const r=t[0],n=[...t.slice(1)];return n[0]&&(n[0].appName=e.name),e._errorFactory.create(r,...n)}return Dq.create(e,...t)}function gr(e,t,...r){if(!e)throw IR(t,...r)}function uc(e){const t="INTERNAL ASSERTION FAILED: "+e;throw Qx(t),new Error(t)}function Ac(e,t){e||uc(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hI(){var e;return typeof self<"u"&&((e=self.location)===null||e===void 0?void 0:e.href)||""}function Rue(){return tF()==="http:"||tF()==="https:"}function tF(){var e;return typeof self<"u"&&((e=self.location)===null||e===void 0?void 0:e.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function kue(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(Rue()||lse()||"connection"in navigator)?navigator.onLine:!0}function Oue(){if(typeof navigator>"u")return null;const e=navigator;return e.languages&&e.languages[0]||e.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pb{constructor(t,r){this.shortDelay=t,this.longDelay=r,Ac(r>t,"Short delay should be less than long delay!"),this.isMobile=use()||cse()}get(){return kue()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function MR(e,t){Ac(e.emulator,"Emulator should always be set here");const{url:r}=e.emulator;return t?`${r}${t.startsWith("/")?t.slice(1):t}`:r}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rq{static initialize(t,r,n){this.fetchImpl=t,r&&(this.headersImpl=r),n&&(this.responseImpl=n)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;uc("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;uc("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;uc("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Lue={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Nue=new pb(3e4,6e4);function Ng(e,t){return e.tenantId&&!t.tenantId?Object.assign(Object.assign({},t),{tenantId:e.tenantId}):t}async function Fg(e,t,r,n,i={}){return kq(e,i,async()=>{let a={},o={};n&&(t==="GET"?o=n:a={body:JSON.stringify(n)});const s=fb(Object.assign({key:e.config.apiKey},o)).slice(1),u=await e._getAdditionalHeaders();return u["Content-Type"]="application/json",e.languageCode&&(u["X-Firebase-Locale"]=e.languageCode),Rq.fetch()(Oq(e,e.config.apiHost,r,s),Object.assign({method:t,headers:u,referrerPolicy:"no-referrer"},a))})}async function kq(e,t,r){e._canInitEmulator=!1;const n=Object.assign(Object.assign({},Lue),t);try{const i=new Fue(e),a=await Promise.race([r(),i.promise]);i.clearNetworkTimeout();const o=await a.json();if("needConfirmation"in o)throw C2(e,"account-exists-with-different-credential",o);if(a.ok&&!("errorMessage"in o))return o;{const s=a.ok?o.errorMessage:o.error.message,[u,l]=s.split(" : ");if(u==="FEDERATED_USER_ID_ALREADY_LINKED")throw C2(e,"credential-already-in-use",o);if(u==="EMAIL_EXISTS")throw C2(e,"email-already-in-use",o);if(u==="USER_DISABLED")throw C2(e,"user-disabled",o);const c=n[u]||u.toLowerCase().replace(/[_\s]+/g,"-");if(l)throw Due(e,c,l);Au(e,c)}}catch(i){if(i instanceof oh)throw i;Au(e,"network-request-failed",{message:String(i)})}}async function vb(e,t,r,n,i={}){const a=await Fg(e,t,r,n,i);return"mfaPendingCredential"in a&&Au(e,"multi-factor-auth-required",{_serverResponse:a}),a}function Oq(e,t,r,n){const i=`${t}${r}?${n}`;return e.config.emulator?MR(e.config,i):`${e.config.apiScheme}://${i}`}class Fue{constructor(t){this.auth=t,this.timer=null,this.promise=new Promise((r,n)=>{this.timer=setTimeout(()=>n(pl(this.auth,"network-request-failed")),Nue.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function C2(e,t,r){const n={appName:e.name};r.email&&(n.email=r.email),r.phoneNumber&&(n.phoneNumber=r.phoneNumber);const i=pl(e,t,n);return i.customData._tokenResponse=r,i}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Bue(e,t){return Fg(e,"POST","/v1/accounts:delete",t)}async function Uue(e,t){return Fg(e,"POST","/v1/accounts:lookup",t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Oy(e){if(e)try{const t=new Date(Number(e));if(!isNaN(t.getTime()))return t.toUTCString()}catch{}}async function jue(e,t=!1){const r=Kc(e),n=await r.getIdToken(t),i=DR(n);gr(i&&i.exp&&i.auth_time&&i.iat,r.auth,"internal-error");const a=typeof i.firebase=="object"?i.firebase:void 0,o=a==null?void 0:a.sign_in_provider;return{claims:i,token:n,authTime:Oy(vA(i.auth_time)),issuedAtTime:Oy(vA(i.iat)),expirationTime:Oy(vA(i.exp)),signInProvider:o||null,signInSecondFactor:(a==null?void 0:a.sign_in_second_factor)||null}}function vA(e){return Number(e)*1e3}function DR(e){const[t,r,n]=e.split(".");if(t===void 0||r===void 0||n===void 0)return Qx("JWT malformed, contained fewer than 3 sections"),null;try{const i=xq(r);return i?JSON.parse(i):(Qx("Failed to decode base64 JWT payload"),null)}catch(i){return Qx("Caught error parsing JWT payload as JSON",i==null?void 0:i.toString()),null}}function zue(e){const t=DR(e);return gr(t,"internal-error"),gr(typeof t.exp<"u","internal-error"),gr(typeof t.iat<"u","internal-error"),Number(t.exp)-Number(t.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function S1(e,t,r=!1){if(r)return t;try{return await t}catch(n){throw n instanceof oh&&Vue(n)&&e.auth.currentUser===e&&await e.auth.signOut(),n}}function Vue({code:e}){return e==="auth/user-disabled"||e==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hue{constructor(t){this.user=t,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(t){var r;if(t){const n=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),n}else{this.errorBackoff=3e4;const i=((r=this.user.stsTokenManager.expirationTime)!==null&&r!==void 0?r:0)-Date.now()-3e5;return Math.max(0,i)}}schedule(t=!1){if(!this.isRunning)return;const r=this.getInterval(t);this.timerId=setTimeout(async()=>{await this.iteration()},r)}async iteration(){try{await this.user.getIdToken(!0)}catch(t){(t==null?void 0:t.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lq{constructor(t,r){this.createdAt=t,this.lastLoginAt=r,this._initializeTime()}_initializeTime(){this.lastSignInTime=Oy(this.lastLoginAt),this.creationTime=Oy(this.createdAt)}_copy(t){this.createdAt=t.createdAt,this.lastLoginAt=t.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ZS(e){var t;const r=e.auth,n=await e.getIdToken(),i=await S1(e,Uue(r,{idToken:n}));gr(i==null?void 0:i.users.length,r,"internal-error");const a=i.users[0];e._notifyReloadListener(a);const o=!((t=a.providerUserInfo)===null||t===void 0)&&t.length?Wue(a.providerUserInfo):[],s=que(e.providerData,o),u=e.isAnonymous,l=!(e.email&&a.passwordHash)&&!(s!=null&&s.length),c=u?l:!1,d={uid:a.localId,displayName:a.displayName||null,photoURL:a.photoUrl||null,email:a.email||null,emailVerified:a.emailVerified||!1,phoneNumber:a.phoneNumber||null,tenantId:a.tenantId||null,providerData:s,metadata:new Lq(a.createdAt,a.lastLoginAt),isAnonymous:c};Object.assign(e,d)}async function Gue(e){const t=Kc(e);await ZS(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}function que(e,t){return[...e.filter(n=>!t.some(i=>i.providerId===n.providerId)),...t]}function Wue(e){return e.map(t=>{var{providerId:r}=t,n=TR(t,["providerId"]);return{providerId:r,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function $ue(e,t){const r=await kq(e,{},async()=>{const n=fb({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:i,apiKey:a}=e.config,o=Oq(e,i,"/v1/token",`key=${a}`),s=await e._getAdditionalHeaders();return s["Content-Type"]="application/x-www-form-urlencoded",Rq.fetch()(o,{method:"POST",headers:s,body:n})});return{accessToken:r.access_token,expiresIn:r.expires_in,refreshToken:r.refresh_token}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class C1{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(t){gr(t.idToken,"internal-error"),gr(typeof t.idToken<"u","internal-error"),gr(typeof t.refreshToken<"u","internal-error");const r="expiresIn"in t&&typeof t.expiresIn<"u"?Number(t.expiresIn):zue(t.idToken);this.updateTokensAndExpiration(t.idToken,t.refreshToken,r)}async getToken(t,r=!1){return gr(!this.accessToken||this.refreshToken,t,"user-token-expired"),!r&&this.accessToken&&!this.isExpired?this.accessToken:this.refreshToken?(await this.refresh(t,this.refreshToken),this.accessToken):null}clearRefreshToken(){this.refreshToken=null}async refresh(t,r){const{accessToken:n,refreshToken:i,expiresIn:a}=await $ue(t,r);this.updateTokensAndExpiration(n,i,Number(a))}updateTokensAndExpiration(t,r,n){this.refreshToken=r||null,this.accessToken=t||null,this.expirationTime=Date.now()+n*1e3}static fromJSON(t,r){const{refreshToken:n,accessToken:i,expirationTime:a}=r,o=new C1;return n&&(gr(typeof n=="string","internal-error",{appName:t}),o.refreshToken=n),i&&(gr(typeof i=="string","internal-error",{appName:t}),o.accessToken=i),a&&(gr(typeof a=="number","internal-error",{appName:t}),o.expirationTime=a),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(t){this.accessToken=t.accessToken,this.refreshToken=t.refreshToken,this.expirationTime=t.expirationTime}_clone(){return Object.assign(new C1,this.toJSON())}_performRefresh(){return uc("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Cd(e,t){gr(typeof e=="string"||typeof e>"u","internal-error",{appName:t})}class fp{constructor(t){var{uid:r,auth:n,stsTokenManager:i}=t,a=TR(t,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new Hue(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=r,this.auth=n,this.stsTokenManager=i,this.accessToken=i.accessToken,this.displayName=a.displayName||null,this.email=a.email||null,this.emailVerified=a.emailVerified||!1,this.phoneNumber=a.phoneNumber||null,this.photoURL=a.photoURL||null,this.isAnonymous=a.isAnonymous||!1,this.tenantId=a.tenantId||null,this.providerData=a.providerData?[...a.providerData]:[],this.metadata=new Lq(a.createdAt||void 0,a.lastLoginAt||void 0)}async getIdToken(t){const r=await S1(this,this.stsTokenManager.getToken(this.auth,t));return gr(r,this.auth,"internal-error"),this.accessToken!==r&&(this.accessToken=r,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),r}getIdTokenResult(t){return jue(this,t)}reload(){return Gue(this)}_assign(t){this!==t&&(gr(this.uid===t.uid,this.auth,"internal-error"),this.displayName=t.displayName,this.photoURL=t.photoURL,this.email=t.email,this.emailVerified=t.emailVerified,this.phoneNumber=t.phoneNumber,this.isAnonymous=t.isAnonymous,this.tenantId=t.tenantId,this.providerData=t.providerData.map(r=>Object.assign({},r)),this.metadata._copy(t.metadata),this.stsTokenManager._assign(t.stsTokenManager))}_clone(t){const r=new fp(Object.assign(Object.assign({},this),{auth:t,stsTokenManager:this.stsTokenManager._clone()}));return r.metadata._copy(this.metadata),r}_onReload(t){gr(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=t,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(t){this.reloadListener?this.reloadListener(t):this.reloadUserInfo=t}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(t,r=!1){let n=!1;t.idToken&&t.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(t),n=!0),r&&await ZS(this),await this.auth._persistUserIfCurrent(this),n&&this.auth._notifyListenersIfCurrent(this)}async delete(){const t=await this.getIdToken();return await S1(this,Bue(this.auth,{idToken:t})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(t=>Object.assign({},t)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(t,r){var n,i,a,o,s,u,l,c;const d=(n=r.displayName)!==null&&n!==void 0?n:void 0,f=(i=r.email)!==null&&i!==void 0?i:void 0,h=(a=r.phoneNumber)!==null&&a!==void 0?a:void 0,v=(o=r.photoURL)!==null&&o!==void 0?o:void 0,p=(s=r.tenantId)!==null&&s!==void 0?s:void 0,m=(u=r._redirectEventId)!==null&&u!==void 0?u:void 0,g=(l=r.createdAt)!==null&&l!==void 0?l:void 0,y=(c=r.lastLoginAt)!==null&&c!==void 0?c:void 0,{uid:b,emailVerified:S,isAnonymous:x,providerData:C,stsTokenManager:w}=r;gr(b&&w,t,"internal-error");const A=C1.fromJSON(this.name,w);gr(typeof b=="string",t,"internal-error"),Cd(d,t.name),Cd(f,t.name),gr(typeof S=="boolean",t,"internal-error"),gr(typeof x=="boolean",t,"internal-error"),Cd(h,t.name),Cd(v,t.name),Cd(p,t.name),Cd(m,t.name),Cd(g,t.name),Cd(y,t.name);const M=new fp({uid:b,auth:t,email:f,emailVerified:S,displayName:d,isAnonymous:x,photoURL:v,phoneNumber:h,tenantId:p,stsTokenManager:A,createdAt:g,lastLoginAt:y});return C&&Array.isArray(C)&&(M.providerData=C.map(D=>Object.assign({},D))),m&&(M._redirectEventId=m),M}static async _fromIdTokenResponse(t,r,n=!1){const i=new C1;i.updateFromServerResponse(r);const a=new fp({uid:r.localId,auth:t,stsTokenManager:i,isAnonymous:n});return await ZS(a),a}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rF=new Map;function lc(e){Ac(e instanceof Function,"Expected a class definition");let t=rF.get(e);return t?(Ac(t instanceof e,"Instance stored in cache mismatched with class"),t):(t=new e,rF.set(e,t),t)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nq{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(t,r){this.storage[t]=r}async _get(t){const r=this.storage[t];return r===void 0?null:r}async _remove(t){delete this.storage[t]}_addListener(t,r){}_removeListener(t,r){}}Nq.type="NONE";const nF=Nq;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Zx(e,t,r){return`firebase:${e}:${t}:${r}`}class Um{constructor(t,r,n){this.persistence=t,this.auth=r,this.userKey=n;const{config:i,name:a}=this.auth;this.fullUserKey=Zx(this.userKey,i.apiKey,a),this.fullPersistenceKey=Zx("persistence",i.apiKey,a),this.boundEventHandler=r._onStorageEvent.bind(r),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(t){return this.persistence._set(this.fullUserKey,t.toJSON())}async getCurrentUser(){const t=await this.persistence._get(this.fullUserKey);return t?fp._fromJSON(this.auth,t):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(t){if(this.persistence===t)return;const r=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=t,r)return this.setCurrentUser(r)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(t,r,n="authUser"){if(!r.length)return new Um(lc(nF),t,n);const i=(await Promise.all(r.map(async l=>{if(await l._isAvailable())return l}))).filter(l=>l);let a=i[0]||lc(nF);const o=Zx(n,t.config.apiKey,t.name);let s=null;for(const l of r)try{const c=await l._get(o);if(c){const d=fp._fromJSON(t,c);l!==a&&(s=d),a=l;break}}catch{}const u=i.filter(l=>l._shouldAllowMigration);return!a._shouldAllowMigration||!u.length?new Um(a,t,n):(a=u[0],s&&await a._set(o,s.toJSON()),await Promise.all(r.map(async l=>{if(l!==a)try{await l._remove(o)}catch{}})),new Um(a,t,n))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function iF(e){const t=e.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";if(Uq(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(Fq(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(zq(t))return"Blackberry";if(Vq(t))return"Webos";if(RR(t))return"Safari";if((t.includes("chrome/")||Bq(t))&&!t.includes("edge/"))return"Chrome";if(jq(t))return"Android";{const r=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,n=e.match(r);if((n==null?void 0:n.length)===2)return n[1]}return"Other"}function Fq(e=ka()){return/firefox\//i.test(e)}function RR(e=ka()){const t=e.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function Bq(e=ka()){return/crios\//i.test(e)}function Uq(e=ka()){return/iemobile/i.test(e)}function jq(e=ka()){return/android/i.test(e)}function zq(e=ka()){return/blackberry/i.test(e)}function Vq(e=ka()){return/webos/i.test(e)}function vw(e=ka()){return/iphone|ipad|ipod/i.test(e)||/macintosh/i.test(e)&&/mobile/i.test(e)}function Xue(e=ka()){var t;return vw(e)&&!!(!((t=window.navigator)===null||t===void 0)&&t.standalone)}function Yue(){return dse()&&document.documentMode===10}function Hq(e=ka()){return vw(e)||jq(e)||Vq(e)||zq(e)||/windows phone/i.test(e)||Uq(e)}function Kue(){try{return!!(window&&window!==window.top)}catch{return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Gq(e,t=[]){let r;switch(e){case"Browser":r=iF(ka());break;case"Worker":r=`${iF(ka())}-${e}`;break;default:r=e}const n=t.length?t.join(","):"FirebaseCore-web";return`${r}/JsCore/${hb}/${n}`}async function qq(e,t){return Fg(e,"GET","/v2/recaptchaConfig",Ng(e,t))}function aF(e){return e!==void 0&&e.enterprise!==void 0}class Wq{constructor(t){if(this.siteKey="",this.emailPasswordEnabled=!1,t.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=t.recaptchaKey.split("/")[3],this.emailPasswordEnabled=t.recaptchaEnforcementState.some(r=>r.provider==="EMAIL_PASSWORD_PROVIDER"&&r.enforcementState!=="OFF")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Que(){var e,t;return(t=(e=document.getElementsByTagName("head"))===null||e===void 0?void 0:e[0])!==null&&t!==void 0?t:document}function $q(e){return new Promise((t,r)=>{const n=document.createElement("script");n.setAttribute("src",e),n.onload=t,n.onerror=i=>{const a=pl("internal-error");a.customData=i,r(a)},n.type="text/javascript",n.charset="UTF-8",Que().appendChild(n)})}function Zue(e){return`__${e}${Math.floor(Math.random()*1e6)}`}const Jue="https://www.google.com/recaptcha/enterprise.js?render=",ele="recaptcha-enterprise",tle="NO_RECAPTCHA";class Xq{constructor(t){this.type=ele,this.auth=Bg(t)}async verify(t="verify",r=!1){async function n(a){if(!r){if(a.tenantId==null&&a._agentRecaptchaConfig!=null)return a._agentRecaptchaConfig.siteKey;if(a.tenantId!=null&&a._tenantRecaptchaConfigs[a.tenantId]!==void 0)return a._tenantRecaptchaConfigs[a.tenantId].siteKey}return new Promise(async(o,s)=>{qq(a,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(u=>{if(u.recaptchaKey===void 0)s(new Error("recaptcha Enterprise site key undefined"));else{const l=new Wq(u);return a.tenantId==null?a._agentRecaptchaConfig=l:a._tenantRecaptchaConfigs[a.tenantId]=l,o(l.siteKey)}}).catch(u=>{s(u)})})}function i(a,o,s){const u=window.grecaptcha;aF(u)?u.enterprise.ready(()=>{u.enterprise.execute(a,{action:t}).then(l=>{o(l)}).catch(()=>{o(tle)})}):s(Error("No reCAPTCHA enterprise script loaded."))}return new Promise((a,o)=>{n(this.auth).then(s=>{if(!r&&aF(window.grecaptcha))i(s,a,o);else{if(typeof window>"u"){o(new Error("RecaptchaVerifier is only supported in browser"));return}$q(Jue+s).then(()=>{i(s,a,o)}).catch(u=>{o(u)})}}).catch(s=>{o(s)})})}}async function JS(e,t,r,n=!1){const i=new Xq(e);let a;try{a=await i.verify(r)}catch{a=await i.verify(r,!0)}const o=Object.assign({},t);return n?Object.assign(o,{captchaResp:a}):Object.assign(o,{captchaResponse:a}),Object.assign(o,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(o,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),o}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rle{constructor(t){this.auth=t,this.queue=[]}pushCallback(t,r){const n=a=>new Promise((o,s)=>{try{const u=t(a);o(u)}catch(u){s(u)}});n.onAbort=r,this.queue.push(n);const i=this.queue.length-1;return()=>{this.queue[i]=()=>Promise.resolve()}}async runMiddleware(t){if(this.auth.currentUser===t)return;const r=[];try{for(const n of this.queue)await n(t),n.onAbort&&r.push(n.onAbort)}catch(n){r.reverse();for(const i of r)try{i()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:n==null?void 0:n.message})}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nle{constructor(t,r,n,i){this.app=t,this.heartbeatServiceProvider=r,this.appCheckServiceProvider=n,this.config=i,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new oF(this),this.idTokenSubscription=new oF(this),this.beforeStateQueue=new rle(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=Dq,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=t.name,this.clientVersion=i.sdkClientVersion}_initializeWithPersistence(t,r){return r&&(this._popupRedirectResolver=lc(r)),this._initializationPromise=this.queue(async()=>{var n,i;if(!this._deleted&&(this.persistenceManager=await Um.create(this,t),!this._deleted)){if(!((n=this._popupRedirectResolver)===null||n===void 0)&&n._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(r),this.lastNotifiedUid=((i=this.currentUser)===null||i===void 0?void 0:i.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const t=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!t)){if(this.currentUser&&t&&this.currentUser.uid===t.uid){this._currentUser._assign(t),await this.currentUser.getIdToken();return}await this._updateCurrentUser(t,!0)}}async initializeCurrentUser(t){var r;const n=await this.assertedPersistence.getCurrentUser();let i=n,a=!1;if(t&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const o=(r=this.redirectUser)===null||r===void 0?void 0:r._redirectEventId,s=i==null?void 0:i._redirectEventId,u=await this.tryRedirectSignIn(t);(!o||o===s)&&(u!=null&&u.user)&&(i=u.user,a=!0)}if(!i)return this.directlySetCurrentUser(null);if(!i._redirectEventId){if(a)try{await this.beforeStateQueue.runMiddleware(i)}catch(o){i=n,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return i?this.reloadAndSetCurrentUserOrClear(i):this.directlySetCurrentUser(null)}return gr(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===i._redirectEventId?this.directlySetCurrentUser(i):this.reloadAndSetCurrentUserOrClear(i)}async tryRedirectSignIn(t){let r=null;try{r=await this._popupRedirectResolver._completeRedirectFn(this,t,!0)}catch{await this._setRedirectUser(null)}return r}async reloadAndSetCurrentUserOrClear(t){try{await ZS(t)}catch(r){if((r==null?void 0:r.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(t)}useDeviceLanguage(){this.languageCode=Oue()}async _delete(){this._deleted=!0}async updateCurrentUser(t){const r=t?Kc(t):null;return r&&gr(r.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(r&&r._clone(this))}async _updateCurrentUser(t,r=!1){if(!this._deleted)return t&&gr(this.tenantId===t.tenantId,this,"tenant-id-mismatch"),r||await this.beforeStateQueue.runMiddleware(t),this.queue(async()=>{await this.directlySetCurrentUser(t),this.notifyAuthListeners()})}async signOut(){return await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0)}setPersistence(t){return this.queue(async()=>{await this.assertedPersistence.setPersistence(lc(t))})}async initializeRecaptchaConfig(){const t=await qq(this,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}),r=new Wq(t);this.tenantId==null?this._agentRecaptchaConfig=r:this._tenantRecaptchaConfigs[this.tenantId]=r,r.emailPasswordEnabled&&new Xq(this).verify()}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(t){this._errorFactory=new db("auth","Firebase",t())}onAuthStateChanged(t,r,n){return this.registerStateListener(this.authStateSubscription,t,r,n)}beforeAuthStateChanged(t,r){return this.beforeStateQueue.pushCallback(t,r)}onIdTokenChanged(t,r,n){return this.registerStateListener(this.idTokenSubscription,t,r,n)}toJSON(){var t;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(t=this._currentUser)===null||t===void 0?void 0:t.toJSON()}}async _setRedirectUser(t,r){const n=await this.getOrInitRedirectPersistenceManager(r);return t===null?n.removeCurrentUser():n.setCurrentUser(t)}async getOrInitRedirectPersistenceManager(t){if(!this.redirectPersistenceManager){const r=t&&lc(t)||this._popupRedirectResolver;gr(r,this,"argument-error"),this.redirectPersistenceManager=await Um.create(this,[lc(r._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(t){var r,n;return this._isInitialized&&await this.queue(async()=>{}),((r=this._currentUser)===null||r===void 0?void 0:r._redirectEventId)===t?this._currentUser:((n=this.redirectUser)===null||n===void 0?void 0:n._redirectEventId)===t?this.redirectUser:null}async _persistUserIfCurrent(t){if(t===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(t))}_notifyListenersIfCurrent(t){t===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var t,r;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const n=(r=(t=this.currentUser)===null||t===void 0?void 0:t.uid)!==null&&r!==void 0?r:null;this.lastNotifiedUid!==n&&(this.lastNotifiedUid=n,this.authStateSubscription.next(this.currentUser))}registerStateListener(t,r,n,i){if(this._deleted)return()=>{};const a=typeof r=="function"?r:r.next.bind(r),o=this._isInitialized?Promise.resolve():this._initializationPromise;return gr(o,this,"internal-error"),o.then(()=>a(this.currentUser)),typeof r=="function"?t.addObserver(r,n,i):t.addObserver(r)}async directlySetCurrentUser(t){this.currentUser&&this.currentUser!==t&&this._currentUser._stopProactiveRefresh(),t&&this.isProactiveRefreshEnabled&&t._startProactiveRefresh(),this.currentUser=t,t?await this.assertedPersistence.setCurrentUser(t):await this.assertedPersistence.removeCurrentUser()}queue(t){return this.operations=this.operations.then(t,t),this.operations}get assertedPersistence(){return gr(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(t){!t||this.frameworks.includes(t)||(this.frameworks.push(t),this.frameworks.sort(),this.clientVersion=Gq(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var t;const r={["X-Client-Version"]:this.clientVersion};this.app.options.appId&&(r["X-Firebase-gmpid"]=this.app.options.appId);const n=await((t=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||t===void 0?void 0:t.getHeartbeatsHeader());n&&(r["X-Firebase-Client"]=n);const i=await this._getAppCheckToken();return i&&(r["X-Firebase-AppCheck"]=i),r}async _getAppCheckToken(){var t;const r=await((t=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||t===void 0?void 0:t.getToken());return r!=null&&r.error&&Mue(`Error while retrieving App Check token: ${r.error}`),r==null?void 0:r.token}}function Bg(e){return Kc(e)}let oF=class{constructor(t){this.auth=t,this.observer=null,this.addObserver=yse(r=>this.observer=r)}get next(){return gr(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ile(e,t){const r=Aq(e,"auth");if(r.isInitialized()){const i=r.getImmediate(),a=r.getOptions();if(YS(a,t??{}))return i;Au(i,"already-initialized")}return r.initialize({options:t})}function ale(e,t){const r=(t==null?void 0:t.persistence)||[],n=(Array.isArray(r)?r:[r]).map(lc);t!=null&&t.errorMap&&e._updateErrorMap(t.errorMap),e._initializeWithPersistence(n,t==null?void 0:t.popupRedirectResolver)}function ole(e,t,r){const n=Bg(e);gr(n._canInitEmulator,n,"emulator-config-failed"),gr(/^https?:\/\//.test(t),n,"invalid-emulator-scheme");const i=!!(r!=null&&r.disableWarnings),a=Yq(t),{host:o,port:s}=sle(t),u=s===null?"":`:${s}`;n.config.emulator={url:`${a}//${o}${u}/`},n.settings.appVerificationDisabledForTesting=!0,n.emulatorConfig=Object.freeze({host:o,port:s,protocol:a.replace(":",""),options:Object.freeze({disableWarnings:i})}),i||ule()}function Yq(e){const t=e.indexOf(":");return t<0?"":e.substr(0,t+1)}function sle(e){const t=Yq(e),r=/(\/\/)?([^?#/]+)/.exec(e.substr(t.length));if(!r)return{host:"",port:null};const n=r[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(n);if(i){const a=i[1];return{host:a,port:sF(n.substr(a.length+1))}}else{const[a,o]=n.split(":");return{host:a,port:sF(o)}}}function sF(e){if(!e)return null;const t=Number(e);return isNaN(t)?null:t}function ule(){function e(){const t=document.createElement("p"),r=t.style;t.innerText="Running in emulator mode. Do not use with production credentials.",r.position="fixed",r.width="100%",r.backgroundColor="#ffffff",r.border=".1em solid #000000",r.color="#b50000",r.bottom="0px",r.left="0px",r.margin="0px",r.zIndex="10000",r.textAlign="center",t.classList.add("firebase-emulator-warning"),document.body.appendChild(t)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",e):e())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kR{constructor(t,r){this.providerId=t,this.signInMethod=r}toJSON(){return uc("not implemented")}_getIdTokenResponse(t){return uc("not implemented")}_linkToIdToken(t,r){return uc("not implemented")}_getReauthenticationResolver(t){return uc("not implemented")}}async function lle(e,t){return Fg(e,"POST","/v1/accounts:update",t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function mA(e,t){return vb(e,"POST","/v1/accounts:signInWithPassword",Ng(e,t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function cle(e,t){return vb(e,"POST","/v1/accounts:signInWithEmailLink",Ng(e,t))}async function dle(e,t){return vb(e,"POST","/v1/accounts:signInWithEmailLink",Ng(e,t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _1 extends kR{constructor(t,r,n,i=null){super("password",n),this._email=t,this._password=r,this._tenantId=i}static _fromEmailAndPassword(t,r){return new _1(t,r,"password")}static _fromEmailAndCode(t,r,n=null){return new _1(t,r,"emailLink",n)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(t){const r=typeof t=="string"?JSON.parse(t):t;if(r!=null&&r.email&&(r!=null&&r.password)){if(r.signInMethod==="password")return this._fromEmailAndPassword(r.email,r.password);if(r.signInMethod==="emailLink")return this._fromEmailAndCode(r.email,r.password,r.tenantId)}return null}async _getIdTokenResponse(t){var r;switch(this.signInMethod){case"password":const n={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};if(!((r=t._getRecaptchaConfig())===null||r===void 0)&&r.emailPasswordEnabled){const i=await JS(t,n,"signInWithPassword");return mA(t,i)}else return mA(t,n).catch(async i=>{if(i.code==="auth/missing-recaptcha-token"){console.log("Sign-in with email address and password is protected by reCAPTCHA for this project. Automatically triggering the reCAPTCHA flow and restarting the sign-in flow.");const a=await JS(t,n,"signInWithPassword");return mA(t,a)}else return Promise.reject(i)});case"emailLink":return cle(t,{email:this._email,oobCode:this._password});default:Au(t,"internal-error")}}async _linkToIdToken(t,r){switch(this.signInMethod){case"password":return lle(t,{idToken:r,returnSecureToken:!0,email:this._email,password:this._password});case"emailLink":return dle(t,{idToken:r,email:this._email,oobCode:this._password});default:Au(t,"internal-error")}}_getReauthenticationResolver(t){return this._getIdTokenResponse(t)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function jm(e,t){return vb(e,"POST","/v1/accounts:signInWithIdp",Ng(e,t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fle="http://localhost";class Rp extends kR{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(t){const r=new Rp(t.providerId,t.signInMethod);return t.idToken||t.accessToken?(t.idToken&&(r.idToken=t.idToken),t.accessToken&&(r.accessToken=t.accessToken),t.nonce&&!t.pendingToken&&(r.nonce=t.nonce),t.pendingToken&&(r.pendingToken=t.pendingToken)):t.oauthToken&&t.oauthTokenSecret?(r.accessToken=t.oauthToken,r.secret=t.oauthTokenSecret):Au("argument-error"),r}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(t){const r=typeof t=="string"?JSON.parse(t):t,{providerId:n,signInMethod:i}=r,a=TR(r,["providerId","signInMethod"]);if(!n||!i)return null;const o=new Rp(n,i);return o.idToken=a.idToken||void 0,o.accessToken=a.accessToken||void 0,o.secret=a.secret,o.nonce=a.nonce,o.pendingToken=a.pendingToken||null,o}_getIdTokenResponse(t){const r=this.buildRequest();return jm(t,r)}_linkToIdToken(t,r){const n=this.buildRequest();return n.idToken=r,jm(t,n)}_getReauthenticationResolver(t){const r=this.buildRequest();return r.autoCreate=!1,jm(t,r)}buildRequest(){const t={requestUri:fle,returnSecureToken:!0};if(this.pendingToken)t.pendingToken=this.pendingToken;else{const r={};this.idToken&&(r.id_token=this.idToken),this.accessToken&&(r.access_token=this.accessToken),this.secret&&(r.oauth_token_secret=this.secret),r.providerId=this.providerId,this.nonce&&!this.pendingToken&&(r.nonce=this.nonce),t.postBody=fb(r)}return t}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hle(e){switch(e){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function ple(e){const t=oy(sy(e)).link,r=t?oy(sy(t)).deep_link_id:null,n=oy(sy(e)).deep_link_id;return(n?oy(sy(n)).link:null)||n||r||t||e}class OR{constructor(t){var r,n,i,a,o,s;const u=oy(sy(t)),l=(r=u.apiKey)!==null&&r!==void 0?r:null,c=(n=u.oobCode)!==null&&n!==void 0?n:null,d=hle((i=u.mode)!==null&&i!==void 0?i:null);gr(l&&c&&d,"argument-error"),this.apiKey=l,this.operation=d,this.code=c,this.continueUrl=(a=u.continueUrl)!==null&&a!==void 0?a:null,this.languageCode=(o=u.languageCode)!==null&&o!==void 0?o:null,this.tenantId=(s=u.tenantId)!==null&&s!==void 0?s:null}static parseLink(t){const r=ple(t);try{return new OR(r)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ug{constructor(){this.providerId=Ug.PROVIDER_ID}static credential(t,r){return _1._fromEmailAndPassword(t,r)}static credentialWithLink(t,r){const n=OR.parseLink(r);return gr(n,"argument-error"),_1._fromEmailAndCode(t,n.code,n.tenantId)}}Ug.PROVIDER_ID="password";Ug.EMAIL_PASSWORD_SIGN_IN_METHOD="password";Ug.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kq{constructor(t){this.providerId=t,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(t){this.defaultLanguageCode=t}setCustomParameters(t){return this.customParameters=t,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mb extends Kq{constructor(){super(...arguments),this.scopes=[]}addScope(t){return this.scopes.includes(t)||this.scopes.push(t),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xd extends mb{constructor(){super("facebook.com")}static credential(t){return Rp._fromParams({providerId:Xd.PROVIDER_ID,signInMethod:Xd.FACEBOOK_SIGN_IN_METHOD,accessToken:t})}static credentialFromResult(t){return Xd.credentialFromTaggedObject(t)}static credentialFromError(t){return Xd.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t||!("oauthAccessToken"in t)||!t.oauthAccessToken)return null;try{return Xd.credential(t.oauthAccessToken)}catch{return null}}}Xd.FACEBOOK_SIGN_IN_METHOD="facebook.com";Xd.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yd extends mb{constructor(){super("google.com"),this.addScope("profile")}static credential(t,r){return Rp._fromParams({providerId:Yd.PROVIDER_ID,signInMethod:Yd.GOOGLE_SIGN_IN_METHOD,idToken:t,accessToken:r})}static credentialFromResult(t){return Yd.credentialFromTaggedObject(t)}static credentialFromError(t){return Yd.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t)return null;const{oauthIdToken:r,oauthAccessToken:n}=t;if(!r&&!n)return null;try{return Yd.credential(r,n)}catch{return null}}}Yd.GOOGLE_SIGN_IN_METHOD="google.com";Yd.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kd extends mb{constructor(){super("github.com")}static credential(t){return Rp._fromParams({providerId:Kd.PROVIDER_ID,signInMethod:Kd.GITHUB_SIGN_IN_METHOD,accessToken:t})}static credentialFromResult(t){return Kd.credentialFromTaggedObject(t)}static credentialFromError(t){return Kd.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t||!("oauthAccessToken"in t)||!t.oauthAccessToken)return null;try{return Kd.credential(t.oauthAccessToken)}catch{return null}}}Kd.GITHUB_SIGN_IN_METHOD="github.com";Kd.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qd extends mb{constructor(){super("twitter.com")}static credential(t,r){return Rp._fromParams({providerId:Qd.PROVIDER_ID,signInMethod:Qd.TWITTER_SIGN_IN_METHOD,oauthToken:t,oauthTokenSecret:r})}static credentialFromResult(t){return Qd.credentialFromTaggedObject(t)}static credentialFromError(t){return Qd.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t)return null;const{oauthAccessToken:r,oauthTokenSecret:n}=t;if(!r||!n)return null;try{return Qd.credential(r,n)}catch{return null}}}Qd.TWITTER_SIGN_IN_METHOD="twitter.com";Qd.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function gA(e,t){return vb(e,"POST","/v1/accounts:signUp",Ng(e,t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kp{constructor(t){this.user=t.user,this.providerId=t.providerId,this._tokenResponse=t._tokenResponse,this.operationType=t.operationType}static async _fromIdTokenResponse(t,r,n,i=!1){const a=await fp._fromIdTokenResponse(t,n,i),o=uF(n);return new kp({user:a,providerId:o,_tokenResponse:n,operationType:r})}static async _forOperation(t,r,n){await t._updateTokensIfNecessary(n,!0);const i=uF(n);return new kp({user:t,providerId:i,_tokenResponse:n,operationType:r})}}function uF(e){return e.providerId?e.providerId:"phoneNumber"in e?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eC extends oh{constructor(t,r,n,i){var a;super(r.code,r.message),this.operationType=n,this.user=i,Object.setPrototypeOf(this,eC.prototype),this.customData={appName:t.name,tenantId:(a=t.tenantId)!==null&&a!==void 0?a:void 0,_serverResponse:r.customData._serverResponse,operationType:n}}static _fromErrorAndOperation(t,r,n,i){return new eC(t,r,n,i)}}function Qq(e,t,r,n){return(t==="reauthenticate"?r._getReauthenticationResolver(e):r._getIdTokenResponse(e)).catch(a=>{throw a.code==="auth/multi-factor-auth-required"?eC._fromErrorAndOperation(e,a,t,n):a})}async function vle(e,t,r=!1){const n=await S1(e,t._linkToIdToken(e.auth,await e.getIdToken()),r);return kp._forOperation(e,"link",n)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function mle(e,t,r=!1){const{auth:n}=e,i="reauthenticate";try{const a=await S1(e,Qq(n,i,t,e),r);gr(a.idToken,n,"internal-error");const o=DR(a.idToken);gr(o,n,"internal-error");const{sub:s}=o;return gr(e.uid===s,n,"user-mismatch"),kp._forOperation(e,i,a)}catch(a){throw(a==null?void 0:a.code)==="auth/user-not-found"&&Au(n,"user-mismatch"),a}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Zq(e,t,r=!1){const n="signIn",i=await Qq(e,n,t),a=await kp._fromIdTokenResponse(e,n,i);return r||await e._updateCurrentUser(a.user),a}async function gle(e,t){return Zq(Bg(e),t)}async function yle(e,t,r){var n;const i=Bg(e),a={returnSecureToken:!0,email:t,password:r,clientType:"CLIENT_TYPE_WEB"};let o;if(!((n=i._getRecaptchaConfig())===null||n===void 0)&&n.emailPasswordEnabled){const l=await JS(i,a,"signUpPassword");o=gA(i,l)}else o=gA(i,a).catch(async l=>{if(l.code==="auth/missing-recaptcha-token"){console.log("Sign-up is protected by reCAPTCHA for this project. Automatically triggering the reCAPTCHA flow and restarting the sign-up flow.");const c=await JS(i,a,"signUpPassword");return gA(i,c)}else return Promise.reject(l)});const s=await o.catch(l=>Promise.reject(l)),u=await kp._fromIdTokenResponse(i,"signIn",s);return await i._updateCurrentUser(u.user),u}function ble(e,t,r){return gle(Kc(e),Ug.credential(t,r))}function xle(e,t,r,n){return Kc(e).onIdTokenChanged(t,r,n)}function Sle(e,t,r){return Kc(e).beforeAuthStateChanged(t,r)}function LR(e,t,r,n){return Kc(e).onAuthStateChanged(t,r,n)}function Cle(e){return Kc(e).signOut()}const tC="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jq{constructor(t,r){this.storageRetriever=t,this.type=r}_isAvailable(){try{return this.storage?(this.storage.setItem(tC,"1"),this.storage.removeItem(tC),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(t,r){return this.storage.setItem(t,JSON.stringify(r)),Promise.resolve()}_get(t){const r=this.storage.getItem(t);return Promise.resolve(r?JSON.parse(r):null)}_remove(t){return this.storage.removeItem(t),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _le(){const e=ka();return RR(e)||vw(e)}const wle=1e3,Ele=10;class eW extends Jq{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(t,r)=>this.onStorageEvent(t,r),this.listeners={},this.localCache={},this.pollTimer=null,this.safariLocalStorageNotSynced=_le()&&Kue(),this.fallbackToPolling=Hq(),this._shouldAllowMigration=!0}forAllChangedKeys(t){for(const r of Object.keys(this.listeners)){const n=this.storage.getItem(r),i=this.localCache[r];n!==i&&t(r,i,n)}}onStorageEvent(t,r=!1){if(!t.key){this.forAllChangedKeys((o,s,u)=>{this.notifyListeners(o,u)});return}const n=t.key;if(r?this.detachListener():this.stopPolling(),this.safariLocalStorageNotSynced){const o=this.storage.getItem(n);if(t.newValue!==o)t.newValue!==null?this.storage.setItem(n,t.newValue):this.storage.removeItem(n);else if(this.localCache[n]===t.newValue&&!r)return}const i=()=>{const o=this.storage.getItem(n);!r&&this.localCache[n]===o||this.notifyListeners(n,o)},a=this.storage.getItem(n);Yue()&&a!==t.newValue&&t.newValue!==t.oldValue?setTimeout(i,Ele):i()}notifyListeners(t,r){this.localCache[t]=r;const n=this.listeners[t];if(n)for(const i of Array.from(n))i(r&&JSON.parse(r))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((t,r,n)=>{this.onStorageEvent(new StorageEvent("storage",{key:t,oldValue:r,newValue:n}),!0)})},wle)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(t,r){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[t]||(this.listeners[t]=new Set,this.localCache[t]=this.storage.getItem(t)),this.listeners[t].add(r)}_removeListener(t,r){this.listeners[t]&&(this.listeners[t].delete(r),this.listeners[t].size===0&&delete this.listeners[t]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(t,r){await super._set(t,r),this.localCache[t]=JSON.stringify(r)}async _get(t){const r=await super._get(t);return this.localCache[t]=JSON.stringify(r),r}async _remove(t){await super._remove(t),delete this.localCache[t]}}eW.type="LOCAL";const Ale=eW;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tW extends Jq{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(t,r){}_removeListener(t,r){}}tW.type="SESSION";const rW=tW;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ple(e){return Promise.all(e.map(async t=>{try{return{fulfilled:!0,value:await t}}catch(r){return{fulfilled:!1,reason:r}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mw{constructor(t){this.eventTarget=t,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(t){const r=this.receivers.find(i=>i.isListeningto(t));if(r)return r;const n=new mw(t);return this.receivers.push(n),n}isListeningto(t){return this.eventTarget===t}async handleEvent(t){const r=t,{eventId:n,eventType:i,data:a}=r.data,o=this.handlersMap[i];if(!(o!=null&&o.size))return;r.ports[0].postMessage({status:"ack",eventId:n,eventType:i});const s=Array.from(o).map(async l=>l(r.origin,a)),u=await Ple(s);r.ports[0].postMessage({status:"done",eventId:n,eventType:i,response:u})}_subscribe(t,r){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[t]||(this.handlersMap[t]=new Set),this.handlersMap[t].add(r)}_unsubscribe(t,r){this.handlersMap[t]&&r&&this.handlersMap[t].delete(r),(!r||this.handlersMap[t].size===0)&&delete this.handlersMap[t],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}mw.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function NR(e="",t=10){let r="";for(let n=0;n<t;n++)r+=Math.floor(Math.random()*10);return e+r}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tle{constructor(t){this.target=t,this.handlers=new Set}removeMessageHandler(t){t.messageChannel&&(t.messageChannel.port1.removeEventListener("message",t.onMessage),t.messageChannel.port1.close()),this.handlers.delete(t)}async _send(t,r,n=50){const i=typeof MessageChannel<"u"?new MessageChannel:null;if(!i)throw new Error("connection_unavailable");let a,o;return new Promise((s,u)=>{const l=NR("",20);i.port1.start();const c=setTimeout(()=>{u(new Error("unsupported_event"))},n);o={messageChannel:i,onMessage(d){const f=d;if(f.data.eventId===l)switch(f.data.status){case"ack":clearTimeout(c),a=setTimeout(()=>{u(new Error("timeout"))},3e3);break;case"done":clearTimeout(a),s(f.data.response);break;default:clearTimeout(c),clearTimeout(a),u(new Error("invalid_response"));break}}},this.handlers.add(o),i.port1.addEventListener("message",o.onMessage),this.target.postMessage({eventType:t,eventId:l,data:r},[i.port2])}).finally(()=>{o&&this.removeMessageHandler(o)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vl(){return window}function Ile(e){vl().location.href=e}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nW(){return typeof vl().WorkerGlobalScope<"u"&&typeof vl().importScripts=="function"}async function Mle(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function Dle(){var e;return((e=navigator==null?void 0:navigator.serviceWorker)===null||e===void 0?void 0:e.controller)||null}function Rle(){return nW()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const iW="firebaseLocalStorageDb",kle=1,rC="firebaseLocalStorage",aW="fbase_key";class gb{constructor(t){this.request=t}toPromise(){return new Promise((t,r)=>{this.request.addEventListener("success",()=>{t(this.request.result)}),this.request.addEventListener("error",()=>{r(this.request.error)})})}}function gw(e,t){return e.transaction([rC],t?"readwrite":"readonly").objectStore(rC)}function Ole(){const e=indexedDB.deleteDatabase(iW);return new gb(e).toPromise()}function pI(){const e=indexedDB.open(iW,kle);return new Promise((t,r)=>{e.addEventListener("error",()=>{r(e.error)}),e.addEventListener("upgradeneeded",()=>{const n=e.result;try{n.createObjectStore(rC,{keyPath:aW})}catch(i){r(i)}}),e.addEventListener("success",async()=>{const n=e.result;n.objectStoreNames.contains(rC)?t(n):(n.close(),await Ole(),t(await pI()))})})}async function lF(e,t,r){const n=gw(e,!0).put({[aW]:t,value:r});return new gb(n).toPromise()}async function Lle(e,t){const r=gw(e,!1).get(t),n=await new gb(r).toPromise();return n===void 0?null:n.value}function cF(e,t){const r=gw(e,!0).delete(t);return new gb(r).toPromise()}const Nle=800,Fle=3;class oW{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await pI(),this.db)}async _withRetries(t){let r=0;for(;;)try{const n=await this._openDb();return await t(n)}catch(n){if(r++>Fle)throw n;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return nW()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=mw._getInstance(Rle()),this.receiver._subscribe("keyChanged",async(t,r)=>({keyProcessed:(await this._poll()).includes(r.key)})),this.receiver._subscribe("ping",async(t,r)=>["keyChanged"])}async initializeSender(){var t,r;if(this.activeServiceWorker=await Mle(),!this.activeServiceWorker)return;this.sender=new Tle(this.activeServiceWorker);const n=await this.sender._send("ping",{},800);n&&!((t=n[0])===null||t===void 0)&&t.fulfilled&&!((r=n[0])===null||r===void 0)&&r.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(t){if(!(!this.sender||!this.activeServiceWorker||Dle()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:t},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const t=await pI();return await lF(t,tC,"1"),await cF(t,tC),!0}catch{}return!1}async _withPendingWrite(t){this.pendingWrites++;try{await t()}finally{this.pendingWrites--}}async _set(t,r){return this._withPendingWrite(async()=>(await this._withRetries(n=>lF(n,t,r)),this.localCache[t]=r,this.notifyServiceWorker(t)))}async _get(t){const r=await this._withRetries(n=>Lle(n,t));return this.localCache[t]=r,r}async _remove(t){return this._withPendingWrite(async()=>(await this._withRetries(r=>cF(r,t)),delete this.localCache[t],this.notifyServiceWorker(t)))}async _poll(){const t=await this._withRetries(i=>{const a=gw(i,!1).getAll();return new gb(a).toPromise()});if(!t)return[];if(this.pendingWrites!==0)return[];const r=[],n=new Set;for(const{fbase_key:i,value:a}of t)n.add(i),JSON.stringify(this.localCache[i])!==JSON.stringify(a)&&(this.notifyListeners(i,a),r.push(i));for(const i of Object.keys(this.localCache))this.localCache[i]&&!n.has(i)&&(this.notifyListeners(i,null),r.push(i));return r}notifyListeners(t,r){this.localCache[t]=r;const n=this.listeners[t];if(n)for(const i of Array.from(n))i(r)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),Nle)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(t,r){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[t]||(this.listeners[t]=new Set,this._get(t)),this.listeners[t].add(r)}_removeListener(t,r){this.listeners[t]&&(this.listeners[t].delete(r),this.listeners[t].size===0&&delete this.listeners[t]),Object.keys(this.listeners).length===0&&this.stopPolling()}}oW.type="LOCAL";const Ble=oW;new pb(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ule(e,t){return t?lc(t):(gr(e._popupRedirectResolver,e,"argument-error"),e._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FR extends kR{constructor(t){super("custom","custom"),this.params=t}_getIdTokenResponse(t){return jm(t,this._buildIdpRequest())}_linkToIdToken(t,r){return jm(t,this._buildIdpRequest(r))}_getReauthenticationResolver(t){return jm(t,this._buildIdpRequest())}_buildIdpRequest(t){const r={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return t&&(r.idToken=t),r}}function jle(e){return Zq(e.auth,new FR(e),e.bypassAuthState)}function zle(e){const{auth:t,user:r}=e;return gr(r,t,"internal-error"),mle(r,new FR(e),e.bypassAuthState)}async function Vle(e){const{auth:t,user:r}=e;return gr(r,t,"internal-error"),vle(r,new FR(e),e.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sW{constructor(t,r,n,i,a=!1){this.auth=t,this.resolver=n,this.user=i,this.bypassAuthState=a,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(r)?r:[r]}execute(){return new Promise(async(t,r)=>{this.pendingPromise={resolve:t,reject:r};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(n){this.reject(n)}})}async onAuthEvent(t){const{urlResponse:r,sessionId:n,postBody:i,tenantId:a,error:o,type:s}=t;if(o){this.reject(o);return}const u={auth:this.auth,requestUri:r,sessionId:n,tenantId:a||void 0,postBody:i||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(s)(u))}catch(l){this.reject(l)}}onError(t){this.reject(t)}getIdpTask(t){switch(t){case"signInViaPopup":case"signInViaRedirect":return jle;case"linkViaPopup":case"linkViaRedirect":return Vle;case"reauthViaPopup":case"reauthViaRedirect":return zle;default:Au(this.auth,"internal-error")}}resolve(t){Ac(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(t),this.unregisterAndCleanUp()}reject(t){Ac(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(t),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Hle=new pb(2e3,1e4);class Sm extends sW{constructor(t,r,n,i,a){super(t,r,i,a),this.provider=n,this.authWindow=null,this.pollId=null,Sm.currentPopupAction&&Sm.currentPopupAction.cancel(),Sm.currentPopupAction=this}async executeNotNull(){const t=await this.execute();return gr(t,this.auth,"internal-error"),t}async onExecution(){Ac(this.filter.length===1,"Popup operations only handle one event");const t=NR();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],t),this.authWindow.associatedEvent=t,this.resolver._originValidation(this.auth).catch(r=>{this.reject(r)}),this.resolver._isIframeWebStorageSupported(this.auth,r=>{r||this.reject(pl(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var t;return((t=this.authWindow)===null||t===void 0?void 0:t.associatedEvent)||null}cancel(){this.reject(pl(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Sm.currentPopupAction=null}pollUserCancellation(){const t=()=>{var r,n;if(!((n=(r=this.authWindow)===null||r===void 0?void 0:r.window)===null||n===void 0)&&n.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(pl(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(t,Hle.get())};t()}}Sm.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Gle="pendingRedirect",Jx=new Map;class qle extends sW{constructor(t,r,n=!1){super(t,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],r,void 0,n),this.eventId=null}async execute(){let t=Jx.get(this.auth._key());if(!t){try{const n=await Wle(this.resolver,this.auth)?await super.execute():null;t=()=>Promise.resolve(n)}catch(r){t=()=>Promise.reject(r)}Jx.set(this.auth._key(),t)}return this.bypassAuthState||Jx.set(this.auth._key(),()=>Promise.resolve(null)),t()}async onAuthEvent(t){if(t.type==="signInViaRedirect")return super.onAuthEvent(t);if(t.type==="unknown"){this.resolve(null);return}if(t.eventId){const r=await this.auth._redirectUserForId(t.eventId);if(r)return this.user=r,super.onAuthEvent(t);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function Wle(e,t){const r=Yle(t),n=Xle(e);if(!await n._isAvailable())return!1;const i=await n._get(r)==="true";return await n._remove(r),i}function $le(e,t){Jx.set(e._key(),t)}function Xle(e){return lc(e._redirectPersistence)}function Yle(e){return Zx(Gle,e.config.apiKey,e.name)}async function Kle(e,t,r=!1){const n=Bg(e),i=Ule(n,t),o=await new qle(n,i,r).execute();return o&&!r&&(delete o.user._redirectEventId,await n._persistUserIfCurrent(o.user),await n._setRedirectUser(null,t)),o}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Qle=10*60*1e3;class Zle{constructor(t){this.auth=t,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(t){this.consumers.add(t),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,t)&&(this.sendToConsumer(this.queuedRedirectEvent,t),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(t){this.consumers.delete(t)}onEvent(t){if(this.hasEventBeenHandled(t))return!1;let r=!1;return this.consumers.forEach(n=>{this.isEventForConsumer(t,n)&&(r=!0,this.sendToConsumer(t,n),this.saveEventToCache(t))}),this.hasHandledPotentialRedirect||!Jle(t)||(this.hasHandledPotentialRedirect=!0,r||(this.queuedRedirectEvent=t,r=!0)),r}sendToConsumer(t,r){var n;if(t.error&&!uW(t)){const i=((n=t.error.code)===null||n===void 0?void 0:n.split("auth/")[1])||"internal-error";r.onError(pl(this.auth,i))}else r.onAuthEvent(t)}isEventForConsumer(t,r){const n=r.eventId===null||!!t.eventId&&t.eventId===r.eventId;return r.filter.includes(t.type)&&n}hasEventBeenHandled(t){return Date.now()-this.lastProcessedEventTime>=Qle&&this.cachedEventUids.clear(),this.cachedEventUids.has(dF(t))}saveEventToCache(t){this.cachedEventUids.add(dF(t)),this.lastProcessedEventTime=Date.now()}}function dF(e){return[e.type,e.eventId,e.sessionId,e.tenantId].filter(t=>t).join("-")}function uW({type:e,error:t}){return e==="unknown"&&(t==null?void 0:t.code)==="auth/no-auth-event"}function Jle(e){switch(e.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return uW(e);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ece(e,t={}){return Fg(e,"GET","/v1/projects",t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tce=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,rce=/^https?/;async function nce(e){if(e.config.emulator)return;const{authorizedDomains:t}=await ece(e);for(const r of t)try{if(ice(r))return}catch{}Au(e,"unauthorized-domain")}function ice(e){const t=hI(),{protocol:r,hostname:n}=new URL(t);if(e.startsWith("chrome-extension://")){const o=new URL(e);return o.hostname===""&&n===""?r==="chrome-extension:"&&e.replace("chrome-extension://","")===t.replace("chrome-extension://",""):r==="chrome-extension:"&&o.hostname===n}if(!rce.test(r))return!1;if(tce.test(e))return n===e;const i=e.replace(/\./g,"\\.");return new RegExp("^(.+\\."+i+"|"+i+")$","i").test(n)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ace=new pb(3e4,6e4);function fF(){const e=vl().___jsl;if(e!=null&&e.H){for(const t of Object.keys(e.H))if(e.H[t].r=e.H[t].r||[],e.H[t].L=e.H[t].L||[],e.H[t].r=[...e.H[t].L],e.CP)for(let r=0;r<e.CP.length;r++)e.CP[r]=null}}function oce(e){return new Promise((t,r)=>{var n,i,a;function o(){fF(),gapi.load("gapi.iframes",{callback:()=>{t(gapi.iframes.getContext())},ontimeout:()=>{fF(),r(pl(e,"network-request-failed"))},timeout:ace.get()})}if(!((i=(n=vl().gapi)===null||n===void 0?void 0:n.iframes)===null||i===void 0)&&i.Iframe)t(gapi.iframes.getContext());else if(!((a=vl().gapi)===null||a===void 0)&&a.load)o();else{const s=Zue("iframefcb");return vl()[s]=()=>{gapi.load?o():r(pl(e,"network-request-failed"))},$q(`https://apis.google.com/js/api.js?onload=${s}`).catch(u=>r(u))}}).catch(t=>{throw eS=null,t})}let eS=null;function sce(e){return eS=eS||oce(e),eS}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uce=new pb(5e3,15e3),lce="__/auth/iframe",cce="emulator/auth/iframe",dce={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},fce=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function hce(e){const t=e.config;gr(t.authDomain,e,"auth-domain-config-required");const r=t.emulator?MR(t,cce):`https://${e.config.authDomain}/${lce}`,n={apiKey:t.apiKey,appName:e.name,v:hb},i=fce.get(e.config.apiHost);i&&(n.eid=i);const a=e._getFrameworks();return a.length&&(n.fw=a.join(",")),`${r}?${fb(n).slice(1)}`}async function pce(e){const t=await sce(e),r=vl().gapi;return gr(r,e,"internal-error"),t.open({where:document.body,url:hce(e),messageHandlersFilter:r.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:dce,dontclear:!0},n=>new Promise(async(i,a)=>{await n.restyle({setHideOnLeave:!1});const o=pl(e,"network-request-failed"),s=vl().setTimeout(()=>{a(o)},uce.get());function u(){vl().clearTimeout(s),i(n)}n.ping(u).then(u,()=>{a(o)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vce={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},mce=500,gce=600,yce="_blank",bce="http://localhost";class hF{constructor(t){this.window=t,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function xce(e,t,r,n=mce,i=gce){const a=Math.max((window.screen.availHeight-i)/2,0).toString(),o=Math.max((window.screen.availWidth-n)/2,0).toString();let s="";const u=Object.assign(Object.assign({},vce),{width:n.toString(),height:i.toString(),top:a,left:o}),l=ka().toLowerCase();r&&(s=Bq(l)?yce:r),Fq(l)&&(t=t||bce,u.scrollbars="yes");const c=Object.entries(u).reduce((f,[h,v])=>`${f}${h}=${v},`,"");if(Xue(l)&&s!=="_self")return Sce(t||"",s),new hF(null);const d=window.open(t||"",s,c);gr(d,e,"popup-blocked");try{d.focus()}catch{}return new hF(d)}function Sce(e,t){const r=document.createElement("a");r.href=e,r.target=t;const n=document.createEvent("MouseEvent");n.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),r.dispatchEvent(n)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Cce="__/auth/handler",_ce="emulator/auth/handler",wce=encodeURIComponent("fac");async function pF(e,t,r,n,i,a){gr(e.config.authDomain,e,"auth-domain-config-required"),gr(e.config.apiKey,e,"invalid-api-key");const o={apiKey:e.config.apiKey,appName:e.name,authType:r,redirectUrl:n,v:hb,eventId:i};if(t instanceof Kq){t.setDefaultLanguage(e.languageCode),o.providerId=t.providerId||"",gse(t.getCustomParameters())||(o.customParameters=JSON.stringify(t.getCustomParameters()));for(const[c,d]of Object.entries(a||{}))o[c]=d}if(t instanceof mb){const c=t.getScopes().filter(d=>d!=="");c.length>0&&(o.scopes=c.join(","))}e.tenantId&&(o.tid=e.tenantId);const s=o;for(const c of Object.keys(s))s[c]===void 0&&delete s[c];const u=await e._getAppCheckToken(),l=u?`#${wce}=${encodeURIComponent(u)}`:"";return`${Ece(e)}?${fb(s).slice(1)}${l}`}function Ece({config:e}){return e.emulator?MR(e,_ce):`https://${e.authDomain}/${Cce}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yA="webStorageSupport";class Ace{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=rW,this._completeRedirectFn=Kle,this._overrideRedirectResult=$le}async _openPopup(t,r,n,i){var a;Ac((a=this.eventManagers[t._key()])===null||a===void 0?void 0:a.manager,"_initialize() not called before _openPopup()");const o=await pF(t,r,n,hI(),i);return xce(t,o,NR())}async _openRedirect(t,r,n,i){await this._originValidation(t);const a=await pF(t,r,n,hI(),i);return Ile(a),new Promise(()=>{})}_initialize(t){const r=t._key();if(this.eventManagers[r]){const{manager:i,promise:a}=this.eventManagers[r];return i?Promise.resolve(i):(Ac(a,"If manager is not set, promise should be"),a)}const n=this.initAndGetManager(t);return this.eventManagers[r]={promise:n},n.catch(()=>{delete this.eventManagers[r]}),n}async initAndGetManager(t){const r=await pce(t),n=new Zle(t);return r.register("authEvent",i=>(gr(i==null?void 0:i.authEvent,t,"invalid-auth-event"),{status:n.onEvent(i.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[t._key()]={manager:n},this.iframes[t._key()]=r,n}_isIframeWebStorageSupported(t,r){this.iframes[t._key()].send(yA,{type:yA},i=>{var a;const o=(a=i==null?void 0:i[0])===null||a===void 0?void 0:a[yA];o!==void 0&&r(!!o),Au(t,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(t){const r=t._key();return this.originValidationPromises[r]||(this.originValidationPromises[r]=nce(t)),this.originValidationPromises[r]}get _shouldInitProactively(){return Hq()||RR()||vw()}}const Pce=Ace;var vF="@firebase/auth",mF="0.23.2";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tce{constructor(t){this.auth=t,this.internalListeners=new Map}getUid(){var t;return this.assertAuthConfigured(),((t=this.auth.currentUser)===null||t===void 0?void 0:t.uid)||null}async getToken(t){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(t)}:null}addAuthTokenListener(t){if(this.assertAuthConfigured(),this.internalListeners.has(t))return;const r=this.auth.onIdTokenChanged(n=>{t((n==null?void 0:n.stsTokenManager.accessToken)||null)});this.internalListeners.set(t,r),this.updateProactiveRefresh()}removeAuthTokenListener(t){this.assertAuthConfigured();const r=this.internalListeners.get(t);r&&(this.internalListeners.delete(t),r(),this.updateProactiveRefresh())}assertAuthConfigured(){gr(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ice(e){switch(e){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";default:return}}function Mce(e){b1(new cg("auth",(t,{options:r})=>{const n=t.getProvider("app").getImmediate(),i=t.getProvider("heartbeat"),a=t.getProvider("app-check-internal"),{apiKey:o,authDomain:s}=n.options;gr(o&&!o.includes(":"),"invalid-api-key",{appName:n.name});const u={apiKey:o,authDomain:s,clientPlatform:e,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Gq(e)},l=new nle(n,i,a,u);return ale(l,r),l},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((t,r,n)=>{t.getProvider("auth-internal").initialize()})),b1(new cg("auth-internal",t=>{const r=Bg(t.getProvider("auth").getImmediate());return(n=>new Tce(n))(r)},"PRIVATE").setInstantiationMode("EXPLICIT")),Bm(vF,mF,Ice(e)),Bm(vF,mF,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Dce=5*60,Rce=Cq("authIdTokenMaxAge")||Dce;let gF=null;const kce=e=>async t=>{const r=t&&await t.getIdTokenResult(),n=r&&(new Date().getTime()-Date.parse(r.issuedAtTime))/1e3;if(n&&n>Rce)return;const i=r==null?void 0:r.token;gF!==i&&(gF=i,await fetch(e,{method:i?"POST":"DELETE",headers:i?{Authorization:`Bearer ${i}`}:{}}))};function Oce(e=gue()){const t=Aq(e,"auth");if(t.isInitialized())return t.getImmediate();const r=ile(e,{popupRedirectResolver:Pce,persistence:[Ble,Ale,rW]}),n=Cq("authTokenSyncURL");if(n){const a=kce(n);Sle(r,a,()=>a(r.currentUser)),xle(r,o=>a(o))}const i=ose("auth");return i&&ole(r,`http://${i}`),r}Mce("Browser");const Lce={apiKey:"AIzaSyAgwFmiZzi7wejk8yhpOXQ9T9ST58NEba8",authDomain:"ksprotauth.firebaseapp.com",projectId:"ksprotauth",storageBucket:"ksprotauth.appspot.com",messagingSenderId:"430140733022",appId:"1:430140733022:web:c83ed9c239dc6bdacbe6cf",measurementId:"G-VFEEYCG3H1"},Nce=Pq(Lce),Op=Oce(Nce),Fce=du.createContext({user:null}),Bce=({children:e})=>{const[t,r]=Ve.useState(null);return Ve.useEffect(()=>Op.onAuthStateChanged(i=>{r(i)}),[]),T.jsx(Fce.Provider,{value:{user:t},children:e})};/**
 * @remix-run/router v1.6.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function w1(){return w1=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},w1.apply(this,arguments)}var df;(function(e){e.Pop="POP",e.Push="PUSH",e.Replace="REPLACE"})(df||(df={}));const yF="popstate";function Uce(e){e===void 0&&(e={});function t(n,i){let{pathname:a,search:o,hash:s}=n.location;return vI("",{pathname:a,search:o,hash:s},i.state&&i.state.usr||null,i.state&&i.state.key||"default")}function r(n,i){return typeof i=="string"?i:lW(i)}return zce(t,r,null,e)}function ji(e,t){if(e===!1||e===null||typeof e>"u")throw new Error(t)}function BR(e,t){if(!e){typeof console<"u"&&console.warn(t);try{throw new Error(t)}catch{}}}function jce(){return Math.random().toString(36).substr(2,8)}function bF(e,t){return{usr:e.state,key:e.key,idx:t}}function vI(e,t,r,n){return r===void 0&&(r=null),w1({pathname:typeof e=="string"?e:e.pathname,search:"",hash:""},typeof t=="string"?jg(t):t,{state:r,key:t&&t.key||n||jce()})}function lW(e){let{pathname:t="/",search:r="",hash:n=""}=e;return r&&r!=="?"&&(t+=r.charAt(0)==="?"?r:"?"+r),n&&n!=="#"&&(t+=n.charAt(0)==="#"?n:"#"+n),t}function jg(e){let t={};if(e){let r=e.indexOf("#");r>=0&&(t.hash=e.substr(r),e=e.substr(0,r));let n=e.indexOf("?");n>=0&&(t.search=e.substr(n),e=e.substr(0,n)),e&&(t.pathname=e)}return t}function zce(e,t,r,n){n===void 0&&(n={});let{window:i=document.defaultView,v5Compat:a=!1}=n,o=i.history,s=df.Pop,u=null,l=c();l==null&&(l=0,o.replaceState(w1({},o.state,{idx:l}),""));function c(){return(o.state||{idx:null}).idx}function d(){s=df.Pop;let m=c(),g=m==null?null:m-l;l=m,u&&u({action:s,location:p.location,delta:g})}function f(m,g){s=df.Push;let y=vI(p.location,m,g);r&&r(y,m),l=c()+1;let b=bF(y,l),S=p.createHref(y);try{o.pushState(b,"",S)}catch{i.location.assign(S)}a&&u&&u({action:s,location:p.location,delta:1})}function h(m,g){s=df.Replace;let y=vI(p.location,m,g);r&&r(y,m),l=c();let b=bF(y,l),S=p.createHref(y);o.replaceState(b,"",S),a&&u&&u({action:s,location:p.location,delta:0})}function v(m){let g=i.location.origin!=="null"?i.location.origin:i.location.href,y=typeof m=="string"?m:lW(m);return ji(g,"No window.location.(origin|href) available to create URL for href: "+y),new URL(y,g)}let p={get action(){return s},get location(){return e(i,o)},listen(m){if(u)throw new Error("A history only accepts one active listener");return i.addEventListener(yF,d),u=m,()=>{i.removeEventListener(yF,d),u=null}},createHref(m){return t(i,m)},createURL:v,encodeLocation(m){let g=v(m);return{pathname:g.pathname,search:g.search,hash:g.hash}},push:f,replace:h,go(m){return o.go(m)}};return p}var xF;(function(e){e.data="data",e.deferred="deferred",e.redirect="redirect",e.error="error"})(xF||(xF={}));function Vce(e,t,r){r===void 0&&(r="/");let n=typeof t=="string"?jg(t):t,i=fW(n.pathname||"/",r);if(i==null)return null;let a=cW(e);Hce(a);let o=null;for(let s=0;o==null&&s<a.length;++s)o=Zce(a[s],tde(i));return o}function cW(e,t,r,n){t===void 0&&(t=[]),r===void 0&&(r=[]),n===void 0&&(n="");let i=(a,o,s)=>{let u={relativePath:s===void 0?a.path||"":s,caseSensitive:a.caseSensitive===!0,childrenIndex:o,route:a};u.relativePath.startsWith("/")&&(ji(u.relativePath.startsWith(n),'Absolute route path "'+u.relativePath+'" nested under path '+('"'+n+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),u.relativePath=u.relativePath.slice(n.length));let l=hp([n,u.relativePath]),c=r.concat(u);a.children&&a.children.length>0&&(ji(a.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+l+'".')),cW(a.children,t,c,l)),!(a.path==null&&!a.index)&&t.push({path:l,score:Kce(l,a.index),routesMeta:c})};return e.forEach((a,o)=>{var s;if(a.path===""||!((s=a.path)!=null&&s.includes("?")))i(a,o);else for(let u of dW(a.path))i(a,o,u)}),t}function dW(e){let t=e.split("/");if(t.length===0)return[];let[r,...n]=t,i=r.endsWith("?"),a=r.replace(/\?$/,"");if(n.length===0)return i?[a,""]:[a];let o=dW(n.join("/")),s=[];return s.push(...o.map(u=>u===""?a:[a,u].join("/"))),i&&s.push(...o),s.map(u=>e.startsWith("/")&&u===""?"/":u)}function Hce(e){e.sort((t,r)=>t.score!==r.score?r.score-t.score:Qce(t.routesMeta.map(n=>n.childrenIndex),r.routesMeta.map(n=>n.childrenIndex)))}const Gce=/^:\w+$/,qce=3,Wce=2,$ce=1,Xce=10,Yce=-2,SF=e=>e==="*";function Kce(e,t){let r=e.split("/"),n=r.length;return r.some(SF)&&(n+=Yce),t&&(n+=Wce),r.filter(i=>!SF(i)).reduce((i,a)=>i+(Gce.test(a)?qce:a===""?$ce:Xce),n)}function Qce(e,t){return e.length===t.length&&e.slice(0,-1).every((n,i)=>n===t[i])?e[e.length-1]-t[t.length-1]:0}function Zce(e,t){let{routesMeta:r}=e,n={},i="/",a=[];for(let o=0;o<r.length;++o){let s=r[o],u=o===r.length-1,l=i==="/"?t:t.slice(i.length)||"/",c=Jce({path:s.relativePath,caseSensitive:s.caseSensitive,end:u},l);if(!c)return null;Object.assign(n,c.params);let d=s.route;a.push({params:n,pathname:hp([i,c.pathname]),pathnameBase:sde(hp([i,c.pathnameBase])),route:d}),c.pathnameBase!=="/"&&(i=hp([i,c.pathnameBase]))}return a}function Jce(e,t){typeof e=="string"&&(e={path:e,caseSensitive:!1,end:!0});let[r,n]=ede(e.path,e.caseSensitive,e.end),i=t.match(r);if(!i)return null;let a=i[0],o=a.replace(/(.)\/+$/,"$1"),s=i.slice(1);return{params:n.reduce((l,c,d)=>{if(c==="*"){let f=s[d]||"";o=a.slice(0,a.length-f.length).replace(/(.)\/+$/,"$1")}return l[c]=rde(s[d]||"",c),l},{}),pathname:a,pathnameBase:o,pattern:e}}function ede(e,t,r){t===void 0&&(t=!1),r===void 0&&(r=!0),BR(e==="*"||!e.endsWith("*")||e.endsWith("/*"),'Route path "'+e+'" will be treated as if it were '+('"'+e.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+e.replace(/\*$/,"/*")+'".'));let n=[],i="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^$?{}|()[\]]/g,"\\$&").replace(/\/:(\w+)/g,(o,s)=>(n.push(s),"/([^\\/]+)"));return e.endsWith("*")?(n.push("*"),i+=e==="*"||e==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):r?i+="\\/*$":e!==""&&e!=="/"&&(i+="(?:(?=\\/|$))"),[new RegExp(i,t?void 0:"i"),n]}function tde(e){try{return decodeURI(e)}catch(t){return BR(!1,'The URL path "'+e+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+t+").")),e}}function rde(e,t){try{return decodeURIComponent(e)}catch(r){return BR(!1,'The value for the URL param "'+t+'" will not be decoded because'+(' the string "'+e+'" is a malformed URL segment. This is probably')+(" due to a bad percent encoding ("+r+").")),e}}function fW(e,t){if(t==="/")return e;if(!e.toLowerCase().startsWith(t.toLowerCase()))return null;let r=t.endsWith("/")?t.length-1:t.length,n=e.charAt(r);return n&&n!=="/"?null:e.slice(r)||"/"}function nde(e,t){t===void 0&&(t="/");let{pathname:r,search:n="",hash:i=""}=typeof e=="string"?jg(e):e;return{pathname:r?r.startsWith("/")?r:ide(r,t):t,search:ude(n),hash:lde(i)}}function ide(e,t){let r=t.replace(/\/+$/,"").split("/");return e.split("/").forEach(i=>{i===".."?r.length>1&&r.pop():i!=="."&&r.push(i)}),r.length>1?r.join("/"):"/"}function bA(e,t,r,n){return"Cannot include a '"+e+"' character in a manually specified "+("`to."+t+"` field ["+JSON.stringify(n)+"].  Please separate it out to the ")+("`to."+r+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function ade(e){return e.filter((t,r)=>r===0||t.route.path&&t.route.path.length>0)}function ode(e,t,r,n){n===void 0&&(n=!1);let i;typeof e=="string"?i=jg(e):(i=w1({},e),ji(!i.pathname||!i.pathname.includes("?"),bA("?","pathname","search",i)),ji(!i.pathname||!i.pathname.includes("#"),bA("#","pathname","hash",i)),ji(!i.search||!i.search.includes("#"),bA("#","search","hash",i)));let a=e===""||i.pathname==="",o=a?"/":i.pathname,s;if(n||o==null)s=r;else{let d=t.length-1;if(o.startsWith("..")){let f=o.split("/");for(;f[0]==="..";)f.shift(),d-=1;i.pathname=f.join("/")}s=d>=0?t[d]:"/"}let u=nde(i,s),l=o&&o!=="/"&&o.endsWith("/"),c=(a||o===".")&&r.endsWith("/");return!u.pathname.endsWith("/")&&(l||c)&&(u.pathname+="/"),u}const hp=e=>e.join("/").replace(/\/\/+/g,"/"),sde=e=>e.replace(/\/+$/,"").replace(/^\/*/,"/"),ude=e=>!e||e==="?"?"":e.startsWith("?")?e:"?"+e,lde=e=>!e||e==="#"?"":e.startsWith("#")?e:"#"+e;function cde(e){return e!=null&&typeof e.status=="number"&&typeof e.statusText=="string"&&typeof e.internal=="boolean"&&"data"in e}const hW=["post","put","patch","delete"];new Set(hW);const dde=["get",...hW];new Set(dde);/**
 * React Router v6.11.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function nC(){return nC=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},nC.apply(this,arguments)}const UR=Ve.createContext(null),fde=Ve.createContext(null),yw=Ve.createContext(null),bw=Ve.createContext(null),ov=Ve.createContext({outlet:null,matches:[],isDataRoute:!1}),pW=Ve.createContext(null);function xw(){return Ve.useContext(bw)!=null}function jR(){return xw()||ji(!1),Ve.useContext(bw).location}function vW(e){Ve.useContext(yw).static||Ve.useLayoutEffect(e)}function Qc(){let{isDataRoute:e}=Ve.useContext(ov);return e?Ade():hde()}function hde(){xw()||ji(!1);let e=Ve.useContext(UR),{basename:t,navigator:r}=Ve.useContext(yw),{matches:n}=Ve.useContext(ov),{pathname:i}=jR(),a=JSON.stringify(ade(n).map(u=>u.pathnameBase)),o=Ve.useRef(!1);return vW(()=>{o.current=!0}),Ve.useCallback(function(u,l){if(l===void 0&&(l={}),!o.current)return;if(typeof u=="number"){r.go(u);return}let c=ode(u,JSON.parse(a),i,l.relative==="path");e==null&&t!=="/"&&(c.pathname=c.pathname==="/"?t:hp([t,c.pathname])),(l.replace?r.replace:r.push)(c,l.state,l)},[t,r,a,i,e])}function pde(){let{matches:e}=Ve.useContext(ov),t=e[e.length-1];return t?t.params:{}}function vde(e,t){return mde(e,t)}function mde(e,t,r){xw()||ji(!1);let{navigator:n}=Ve.useContext(yw),{matches:i}=Ve.useContext(ov),a=i[i.length-1],o=a?a.params:{};a&&a.pathname;let s=a?a.pathnameBase:"/";a&&a.route;let u=jR(),l;if(t){var c;let p=typeof t=="string"?jg(t):t;s==="/"||(c=p.pathname)!=null&&c.startsWith(s)||ji(!1),l=p}else l=u;let d=l.pathname||"/",f=s==="/"?d:d.slice(s.length)||"/",h=Vce(e,{pathname:f}),v=Sde(h&&h.map(p=>Object.assign({},p,{params:Object.assign({},o,p.params),pathname:hp([s,n.encodeLocation?n.encodeLocation(p.pathname).pathname:p.pathname]),pathnameBase:p.pathnameBase==="/"?s:hp([s,n.encodeLocation?n.encodeLocation(p.pathnameBase).pathname:p.pathnameBase])})),i,r);return t&&v?Ve.createElement(bw.Provider,{value:{location:nC({pathname:"/",search:"",hash:"",state:null,key:"default"},l),navigationType:df.Pop}},v):v}function gde(){let e=Ede(),t=cde(e)?e.status+" "+e.statusText:e instanceof Error?e.message:JSON.stringify(e),r=e instanceof Error?e.stack:null,i={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"},a=null;return Ve.createElement(Ve.Fragment,null,Ve.createElement("h2",null,"Unexpected Application Error!"),Ve.createElement("h3",{style:{fontStyle:"italic"}},t),r?Ve.createElement("pre",{style:i},r):null,a)}const yde=Ve.createElement(gde,null);class bde extends Ve.Component{constructor(t){super(t),this.state={location:t.location,revalidation:t.revalidation,error:t.error}}static getDerivedStateFromError(t){return{error:t}}static getDerivedStateFromProps(t,r){return r.location!==t.location||r.revalidation!=="idle"&&t.revalidation==="idle"?{error:t.error,location:t.location,revalidation:t.revalidation}:{error:t.error||r.error,location:r.location,revalidation:t.revalidation||r.revalidation}}componentDidCatch(t,r){console.error("React Router caught the following error during render",t,r)}render(){return this.state.error?Ve.createElement(ov.Provider,{value:this.props.routeContext},Ve.createElement(pW.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function xde(e){let{routeContext:t,match:r,children:n}=e,i=Ve.useContext(UR);return i&&i.static&&i.staticContext&&(r.route.errorElement||r.route.ErrorBoundary)&&(i.staticContext._deepestRenderedBoundaryId=r.route.id),Ve.createElement(ov.Provider,{value:t},n)}function Sde(e,t,r){var n;if(t===void 0&&(t=[]),r===void 0&&(r=null),e==null){var i;if((i=r)!=null&&i.errors)e=r.matches;else return null}let a=e,o=(n=r)==null?void 0:n.errors;if(o!=null){let s=a.findIndex(u=>u.route.id&&(o==null?void 0:o[u.route.id]));s>=0||ji(!1),a=a.slice(0,Math.min(a.length,s+1))}return a.reduceRight((s,u,l)=>{let c=u.route.id?o==null?void 0:o[u.route.id]:null,d=null;r&&(d=u.route.errorElement||yde);let f=t.concat(a.slice(0,l+1)),h=()=>{let v;return c?v=d:u.route.Component?v=Ve.createElement(u.route.Component,null):u.route.element?v=u.route.element:v=s,Ve.createElement(xde,{match:u,routeContext:{outlet:s,matches:f,isDataRoute:r!=null},children:v})};return r&&(u.route.ErrorBoundary||u.route.errorElement||l===0)?Ve.createElement(bde,{location:r.location,revalidation:r.revalidation,component:d,error:c,children:h(),routeContext:{outlet:null,matches:f,isDataRoute:!0}}):h()},null)}var mI;(function(e){e.UseBlocker="useBlocker",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate"})(mI||(mI={}));var E1;(function(e){e.UseBlocker="useBlocker",e.UseLoaderData="useLoaderData",e.UseActionData="useActionData",e.UseRouteError="useRouteError",e.UseNavigation="useNavigation",e.UseRouteLoaderData="useRouteLoaderData",e.UseMatches="useMatches",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e.UseRouteId="useRouteId"})(E1||(E1={}));function Cde(e){let t=Ve.useContext(UR);return t||ji(!1),t}function _de(e){let t=Ve.useContext(fde);return t||ji(!1),t}function wde(e){let t=Ve.useContext(ov);return t||ji(!1),t}function mW(e){let t=wde(),r=t.matches[t.matches.length-1];return r.route.id||ji(!1),r.route.id}function Ede(){var e;let t=Ve.useContext(pW),r=_de(E1.UseRouteError),n=mW(E1.UseRouteError);return t||((e=r.errors)==null?void 0:e[n])}function Ade(){let{router:e}=Cde(mI.UseNavigateStable),t=mW(E1.UseNavigateStable),r=Ve.useRef(!1);return vW(()=>{r.current=!0}),Ve.useCallback(function(i,a){a===void 0&&(a={}),r.current&&(typeof i=="number"?e.navigate(i):e.navigate(i,nC({fromRouteId:t},a)))},[e,t])}function zh(e){ji(!1)}function Pde(e){let{basename:t="/",children:r=null,location:n,navigationType:i=df.Pop,navigator:a,static:o=!1}=e;xw()&&ji(!1);let s=t.replace(/^\/*/,"/"),u=Ve.useMemo(()=>({basename:s,navigator:a,static:o}),[s,a,o]);typeof n=="string"&&(n=jg(n));let{pathname:l="/",search:c="",hash:d="",state:f=null,key:h="default"}=n,v=Ve.useMemo(()=>{let p=fW(l,s);return p==null?null:{location:{pathname:p,search:c,hash:d,state:f,key:h},navigationType:i}},[s,l,c,d,f,h,i]);return v==null?null:Ve.createElement(yw.Provider,{value:u},Ve.createElement(bw.Provider,{children:r,value:v}))}function Tde(e){let{children:t,location:r}=e;return vde(gI(t),r)}var CF;(function(e){e[e.pending=0]="pending",e[e.success=1]="success",e[e.error=2]="error"})(CF||(CF={}));new Promise(()=>{});function gI(e,t){t===void 0&&(t=[]);let r=[];return Ve.Children.forEach(e,(n,i)=>{if(!Ve.isValidElement(n))return;let a=[...t,i];if(n.type===Ve.Fragment){r.push.apply(r,gI(n.props.children,a));return}n.type!==zh&&ji(!1),!n.props.index||!n.props.children||ji(!1);let o={id:n.props.id||a.join("-"),caseSensitive:n.props.caseSensitive,element:n.props.element,Component:n.props.Component,index:n.props.index,path:n.props.path,loader:n.props.loader,action:n.props.action,errorElement:n.props.errorElement,ErrorBoundary:n.props.ErrorBoundary,hasErrorBoundary:n.props.ErrorBoundary!=null||n.props.errorElement!=null,shouldRevalidate:n.props.shouldRevalidate,handle:n.props.handle,lazy:n.props.lazy};n.props.children&&(o.children=gI(n.props.children,a)),r.push(o)}),r}/**
 * React Router DOM v6.11.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function yI(e){return e===void 0&&(e=""),new URLSearchParams(typeof e=="string"||Array.isArray(e)||e instanceof URLSearchParams?e:Object.keys(e).reduce((t,r)=>{let n=e[r];return t.concat(Array.isArray(n)?n.map(i=>[r,i]):[[r,n]])},[]))}function Ide(e,t){let r=yI(e);if(t)for(let n of t.keys())r.has(n)||t.getAll(n).forEach(i=>{r.append(n,i)});return r}function Mde(e){let{basename:t,children:r,window:n}=e,i=Ve.useRef();i.current==null&&(i.current=Uce({window:n,v5Compat:!0}));let a=i.current,[o,s]=Ve.useState({action:a.action,location:a.location});return Ve.useLayoutEffect(()=>a.listen(s),[a]),Ve.createElement(Pde,{basename:t,children:r,location:o.location,navigationType:o.action,navigator:a})}var _F;(function(e){e.UseScrollRestoration="useScrollRestoration",e.UseSubmitImpl="useSubmitImpl",e.UseFetcher="useFetcher"})(_F||(_F={}));var wF;(function(e){e.UseFetchers="useFetchers",e.UseScrollRestoration="useScrollRestoration"})(wF||(wF={}));function Dde(e){let t=Ve.useRef(yI(e)),r=Ve.useRef(!1),n=jR(),i=Ve.useMemo(()=>Ide(n.search,r.current?null:t.current),[n.search]),a=Qc(),o=Ve.useCallback((s,u)=>{const l=yI(typeof s=="function"?s(i):s);r.current=!0,a("?"+l,u)},[a,i]);return[i,o]}const Rde=()=>{const e=Qc(),t=()=>{e("/auth")};return Ve.useEffect(()=>{const r=LR(Op,n=>{n&&e("/search")});return()=>r()},[]),T.jsx("div",{className:"app-main-wrapper",children:T.jsxs("div",{className:"app-main",children:[T.jsx("span",{className:"app-title",children:"Q-1 Search"}),T.jsx("span",{className:"app-description",children:"Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt u"}),T.jsx("button",{className:"app-login",onClick:t,children:"Login"})]})})};const zR=()=>{const e=Qc(),[t,r]=du.useState("");Ve.useEffect(()=>{const i=LR(Op,a=>{a?r(a.email?a.email:""):e("/")});return()=>i()},[]);const n=()=>{Cle(Op).then(()=>{e("/")}).catch(i=>{console.error("Sign out error: "+i)})};return T.jsxs("div",{className:"app-header",children:[T.jsx("div",{className:"app-header-login",children:t}),T.jsx("button",{className:"app-header-button",onClick:n,children:"Log Out"})]})};function uu(e){for(var t=arguments.length,r=Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];throw Error("[Immer] minified error nr: "+e+(r.length?" "+r.map(function(i){return"'"+i+"'"}).join(","):"")+". Find the full error at: https://bit.ly/3cXEKWf")}function jf(e){return!!e&&!!e[Kn]}function Pc(e){var t;return!!e&&(function(r){if(!r||typeof r!="object")return!1;var n=Object.getPrototypeOf(r);if(n===null)return!0;var i=Object.hasOwnProperty.call(n,"constructor")&&n.constructor;return i===Object||typeof i=="function"&&Function.toString.call(i)===zde}(e)||Array.isArray(e)||!!e[DF]||!!(!((t=e.constructor)===null||t===void 0)&&t[DF])||VR(e)||HR(e))}function Lp(e,t,r){r===void 0&&(r=!1),zg(e)===0?(r?Object.keys:Vm)(e).forEach(function(n){r&&typeof n=="symbol"||t(n,e[n],e)}):e.forEach(function(n,i){return t(i,n,e)})}function zg(e){var t=e[Kn];return t?t.i>3?t.i-4:t.i:Array.isArray(e)?1:VR(e)?2:HR(e)?3:0}function zm(e,t){return zg(e)===2?e.has(t):Object.prototype.hasOwnProperty.call(e,t)}function kde(e,t){return zg(e)===2?e.get(t):e[t]}function gW(e,t,r){var n=zg(e);n===2?e.set(t,r):n===3?e.add(r):e[t]=r}function yW(e,t){return e===t?e!==0||1/e==1/t:e!=e&&t!=t}function VR(e){return Ude&&e instanceof Map}function HR(e){return jde&&e instanceof Set}function Vh(e){return e.o||e.t}function GR(e){if(Array.isArray(e))return Array.prototype.slice.call(e);var t=xW(e);delete t[Kn];for(var r=Vm(t),n=0;n<r.length;n++){var i=r[n],a=t[i];a.writable===!1&&(a.writable=!0,a.configurable=!0),(a.get||a.set)&&(t[i]={configurable:!0,writable:!0,enumerable:a.enumerable,value:e[i]})}return Object.create(Object.getPrototypeOf(e),t)}function qR(e,t){return t===void 0&&(t=!1),WR(e)||jf(e)||!Pc(e)||(zg(e)>1&&(e.set=e.add=e.clear=e.delete=Ode),Object.freeze(e),t&&Lp(e,function(r,n){return qR(n,!0)},!0)),e}function Ode(){uu(2)}function WR(e){return e==null||typeof e!="object"||Object.isFrozen(e)}function ml(e){var t=CI[e];return t||uu(18,e),t}function Lde(e,t){CI[e]||(CI[e]=t)}function bI(){return A1}function xA(e,t){t&&(ml("Patches"),e.u=[],e.s=[],e.v=t)}function iC(e){xI(e),e.p.forEach(Nde),e.p=null}function xI(e){e===A1&&(A1=e.l)}function EF(e){return A1={p:[],l:A1,h:e,m:!0,_:0}}function Nde(e){var t=e[Kn];t.i===0||t.i===1?t.j():t.g=!0}function SA(e,t){t._=t.p.length;var r=t.p[0],n=e!==void 0&&e!==r;return t.h.O||ml("ES5").S(t,e,n),n?(r[Kn].P&&(iC(t),uu(4)),Pc(e)&&(e=aC(t,e),t.l||oC(t,e)),t.u&&ml("Patches").M(r[Kn].t,e,t.u,t.s)):e=aC(t,r,[]),iC(t),t.u&&t.v(t.u,t.s),e!==bW?e:void 0}function aC(e,t,r){if(WR(t))return t;var n=t[Kn];if(!n)return Lp(t,function(s,u){return AF(e,n,t,s,u,r)},!0),t;if(n.A!==e)return t;if(!n.P)return oC(e,n.t,!0),n.t;if(!n.I){n.I=!0,n.A._--;var i=n.i===4||n.i===5?n.o=GR(n.k):n.o,a=i,o=!1;n.i===3&&(a=new Set(i),i.clear(),o=!0),Lp(a,function(s,u){return AF(e,n,i,s,u,r,o)}),oC(e,i,!1),r&&e.u&&ml("Patches").N(n,r,e.u,e.s)}return n.o}function AF(e,t,r,n,i,a,o){if(jf(i)){var s=aC(e,i,a&&t&&t.i!==3&&!zm(t.R,n)?a.concat(n):void 0);if(gW(r,n,s),!jf(s))return;e.m=!1}else o&&r.add(i);if(Pc(i)&&!WR(i)){if(!e.h.D&&e._<1)return;aC(e,i),t&&t.A.l||oC(e,i)}}function oC(e,t,r){r===void 0&&(r=!1),!e.l&&e.h.D&&e.m&&qR(t,r)}function CA(e,t){var r=e[Kn];return(r?Vh(r):e)[t]}function PF(e,t){if(t in e)for(var r=Object.getPrototypeOf(e);r;){var n=Object.getOwnPropertyDescriptor(r,t);if(n)return n;r=Object.getPrototypeOf(r)}}function Zd(e){e.P||(e.P=!0,e.l&&Zd(e.l))}function _A(e){e.o||(e.o=GR(e.t))}function SI(e,t,r){var n=VR(t)?ml("MapSet").F(t,r):HR(t)?ml("MapSet").T(t,r):e.O?function(i,a){var o=Array.isArray(i),s={i:o?1:0,A:a?a.A:bI(),P:!1,I:!1,R:{},l:a,t:i,k:null,o:null,j:null,C:!1},u=s,l=P1;o&&(u=[s],l=uy);var c=Proxy.revocable(u,l),d=c.revoke,f=c.proxy;return s.k=f,s.j=d,f}(t,r):ml("ES5").J(t,r);return(r?r.A:bI()).p.push(n),n}function Fde(e){return jf(e)||uu(22,e),function t(r){if(!Pc(r))return r;var n,i=r[Kn],a=zg(r);if(i){if(!i.P&&(i.i<4||!ml("ES5").K(i)))return i.t;i.I=!0,n=TF(r,a),i.I=!1}else n=TF(r,a);return Lp(n,function(o,s){i&&kde(i.t,o)===s||gW(n,o,t(s))}),a===3?new Set(n):n}(e)}function TF(e,t){switch(t){case 2:return new Map(e);case 3:return Array.from(e)}return GR(e)}function Bde(){function e(a,o){var s=i[a];return s?s.enumerable=o:i[a]=s={configurable:!0,enumerable:o,get:function(){var u=this[Kn];return P1.get(u,a)},set:function(u){var l=this[Kn];P1.set(l,a,u)}},s}function t(a){for(var o=a.length-1;o>=0;o--){var s=a[o][Kn];if(!s.P)switch(s.i){case 5:n(s)&&Zd(s);break;case 4:r(s)&&Zd(s)}}}function r(a){for(var o=a.t,s=a.k,u=Vm(s),l=u.length-1;l>=0;l--){var c=u[l];if(c!==Kn){var d=o[c];if(d===void 0&&!zm(o,c))return!0;var f=s[c],h=f&&f[Kn];if(h?h.t!==d:!yW(f,d))return!0}}var v=!!o[Kn];return u.length!==Vm(o).length+(v?0:1)}function n(a){var o=a.k;if(o.length!==a.t.length)return!0;var s=Object.getOwnPropertyDescriptor(o,o.length-1);if(s&&!s.get)return!0;for(var u=0;u<o.length;u++)if(!o.hasOwnProperty(u))return!0;return!1}var i={};Lde("ES5",{J:function(a,o){var s=Array.isArray(a),u=function(c,d){if(c){for(var f=Array(d.length),h=0;h<d.length;h++)Object.defineProperty(f,""+h,e(h,!0));return f}var v=xW(d);delete v[Kn];for(var p=Vm(v),m=0;m<p.length;m++){var g=p[m];v[g]=e(g,c||!!v[g].enumerable)}return Object.create(Object.getPrototypeOf(d),v)}(s,a),l={i:s?5:4,A:o?o.A:bI(),P:!1,I:!1,R:{},l:o,t:a,k:u,o:null,g:!1,C:!1};return Object.defineProperty(u,Kn,{value:l,writable:!0}),u},S:function(a,o,s){s?jf(o)&&o[Kn].A===a&&t(a.p):(a.u&&function u(l){if(l&&typeof l=="object"){var c=l[Kn];if(c){var d=c.t,f=c.k,h=c.R,v=c.i;if(v===4)Lp(f,function(b){b!==Kn&&(d[b]!==void 0||zm(d,b)?h[b]||u(f[b]):(h[b]=!0,Zd(c)))}),Lp(d,function(b){f[b]!==void 0||zm(f,b)||(h[b]=!1,Zd(c))});else if(v===5){if(n(c)&&(Zd(c),h.length=!0),f.length<d.length)for(var p=f.length;p<d.length;p++)h[p]=!1;else for(var m=d.length;m<f.length;m++)h[m]=!0;for(var g=Math.min(f.length,d.length),y=0;y<g;y++)f.hasOwnProperty(y)||(h[y]=!0),h[y]===void 0&&u(f[y])}}}}(a.p[0]),t(a.p))},K:function(a){return a.i===4?r(a):n(a)}})}var IF,A1,$R=typeof Symbol<"u"&&typeof Symbol("x")=="symbol",Ude=typeof Map<"u",jde=typeof Set<"u",MF=typeof Proxy<"u"&&Proxy.revocable!==void 0&&typeof Reflect<"u",bW=$R?Symbol.for("immer-nothing"):((IF={})["immer-nothing"]=!0,IF),DF=$R?Symbol.for("immer-draftable"):"__$immer_draftable",Kn=$R?Symbol.for("immer-state"):"__$immer_state",zde=""+Object.prototype.constructor,Vm=typeof Reflect<"u"&&Reflect.ownKeys?Reflect.ownKeys:Object.getOwnPropertySymbols!==void 0?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:Object.getOwnPropertyNames,xW=Object.getOwnPropertyDescriptors||function(e){var t={};return Vm(e).forEach(function(r){t[r]=Object.getOwnPropertyDescriptor(e,r)}),t},CI={},P1={get:function(e,t){if(t===Kn)return e;var r=Vh(e);if(!zm(r,t))return function(i,a,o){var s,u=PF(a,o);return u?"value"in u?u.value:(s=u.get)===null||s===void 0?void 0:s.call(i.k):void 0}(e,r,t);var n=r[t];return e.I||!Pc(n)?n:n===CA(e.t,t)?(_A(e),e.o[t]=SI(e.A.h,n,e)):n},has:function(e,t){return t in Vh(e)},ownKeys:function(e){return Reflect.ownKeys(Vh(e))},set:function(e,t,r){var n=PF(Vh(e),t);if(n!=null&&n.set)return n.set.call(e.k,r),!0;if(!e.P){var i=CA(Vh(e),t),a=i==null?void 0:i[Kn];if(a&&a.t===r)return e.o[t]=r,e.R[t]=!1,!0;if(yW(r,i)&&(r!==void 0||zm(e.t,t)))return!0;_A(e),Zd(e)}return e.o[t]===r&&(r!==void 0||t in e.o)||Number.isNaN(r)&&Number.isNaN(e.o[t])||(e.o[t]=r,e.R[t]=!0),!0},deleteProperty:function(e,t){return CA(e.t,t)!==void 0||t in e.t?(e.R[t]=!1,_A(e),Zd(e)):delete e.R[t],e.o&&delete e.o[t],!0},getOwnPropertyDescriptor:function(e,t){var r=Vh(e),n=Reflect.getOwnPropertyDescriptor(r,t);return n&&{writable:!0,configurable:e.i!==1||t!=="length",enumerable:n.enumerable,value:r[t]}},defineProperty:function(){uu(11)},getPrototypeOf:function(e){return Object.getPrototypeOf(e.t)},setPrototypeOf:function(){uu(12)}},uy={};Lp(P1,function(e,t){uy[e]=function(){return arguments[0]=arguments[0][0],t.apply(this,arguments)}}),uy.deleteProperty=function(e,t){return uy.set.call(this,e,t,void 0)},uy.set=function(e,t,r){return P1.set.call(this,e[0],t,r,e[0])};var Vde=function(){function e(r){var n=this;this.O=MF,this.D=!0,this.produce=function(i,a,o){if(typeof i=="function"&&typeof a!="function"){var s=a;a=i;var u=n;return function(p){var m=this;p===void 0&&(p=s);for(var g=arguments.length,y=Array(g>1?g-1:0),b=1;b<g;b++)y[b-1]=arguments[b];return u.produce(p,function(S){var x;return(x=a).call.apply(x,[m,S].concat(y))})}}var l;if(typeof a!="function"&&uu(6),o!==void 0&&typeof o!="function"&&uu(7),Pc(i)){var c=EF(n),d=SI(n,i,void 0),f=!0;try{l=a(d),f=!1}finally{f?iC(c):xI(c)}return typeof Promise<"u"&&l instanceof Promise?l.then(function(p){return xA(c,o),SA(p,c)},function(p){throw iC(c),p}):(xA(c,o),SA(l,c))}if(!i||typeof i!="object"){if((l=a(i))===void 0&&(l=i),l===bW&&(l=void 0),n.D&&qR(l,!0),o){var h=[],v=[];ml("Patches").M(i,l,h,v),o(h,v)}return l}uu(21,i)},this.produceWithPatches=function(i,a){if(typeof i=="function")return function(l){for(var c=arguments.length,d=Array(c>1?c-1:0),f=1;f<c;f++)d[f-1]=arguments[f];return n.produceWithPatches(l,function(h){return i.apply(void 0,[h].concat(d))})};var o,s,u=n.produce(i,a,function(l,c){o=l,s=c});return typeof Promise<"u"&&u instanceof Promise?u.then(function(l){return[l,o,s]}):[u,o,s]},typeof(r==null?void 0:r.useProxies)=="boolean"&&this.setUseProxies(r.useProxies),typeof(r==null?void 0:r.autoFreeze)=="boolean"&&this.setAutoFreeze(r.autoFreeze)}var t=e.prototype;return t.createDraft=function(r){Pc(r)||uu(8),jf(r)&&(r=Fde(r));var n=EF(this),i=SI(this,r,void 0);return i[Kn].C=!0,xI(n),i},t.finishDraft=function(r,n){var i=r&&r[Kn],a=i.A;return xA(a,n),SA(void 0,a)},t.setAutoFreeze=function(r){this.D=r},t.setUseProxies=function(r){r&&!MF&&uu(20),this.O=r},t.applyPatches=function(r,n){var i;for(i=n.length-1;i>=0;i--){var a=n[i];if(a.path.length===0&&a.op==="replace"){r=a.value;break}}i>-1&&(n=n.slice(i+1));var o=ml("Patches").$;return jf(r)?o(r,n):this.produce(r,function(s){return o(s,n)})},e}(),Go=new Vde,SW=Go.produce;Go.produceWithPatches.bind(Go);Go.setAutoFreeze.bind(Go);Go.setUseProxies.bind(Go);Go.applyPatches.bind(Go);Go.createDraft.bind(Go);Go.finishDraft.bind(Go);function T1(e){return T1=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},T1(e)}function Hde(e,t){if(T1(e)!=="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(T1(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function Gde(e){var t=Hde(e,"string");return T1(t)==="symbol"?t:String(t)}function qde(e,t,r){return t=Gde(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function RF(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function kF(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?RF(Object(r),!0).forEach(function(n){qde(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):RF(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function xa(e){return"Minified Redux error #"+e+"; visit https://redux.js.org/Errors?code="+e+" for the full message or use the non-minified dev environment for full errors. "}var OF=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}(),wA=function(){return Math.random().toString(36).substring(7).split("").join(".")},sC={INIT:"@@redux/INIT"+wA(),REPLACE:"@@redux/REPLACE"+wA(),PROBE_UNKNOWN_ACTION:function(){return"@@redux/PROBE_UNKNOWN_ACTION"+wA()}};function Wde(e){if(typeof e!="object"||e===null)return!1;for(var t=e;Object.getPrototypeOf(t)!==null;)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}function CW(e,t,r){var n;if(typeof t=="function"&&typeof r=="function"||typeof r=="function"&&typeof arguments[3]=="function")throw new Error(xa(0));if(typeof t=="function"&&typeof r>"u"&&(r=t,t=void 0),typeof r<"u"){if(typeof r!="function")throw new Error(xa(1));return r(CW)(e,t)}if(typeof e!="function")throw new Error(xa(2));var i=e,a=t,o=[],s=o,u=!1;function l(){s===o&&(s=o.slice())}function c(){if(u)throw new Error(xa(3));return a}function d(p){if(typeof p!="function")throw new Error(xa(4));if(u)throw new Error(xa(5));var m=!0;return l(),s.push(p),function(){if(m){if(u)throw new Error(xa(6));m=!1,l();var y=s.indexOf(p);s.splice(y,1),o=null}}}function f(p){if(!Wde(p))throw new Error(xa(7));if(typeof p.type>"u")throw new Error(xa(8));if(u)throw new Error(xa(9));try{u=!0,a=i(a,p)}finally{u=!1}for(var m=o=s,g=0;g<m.length;g++){var y=m[g];y()}return p}function h(p){if(typeof p!="function")throw new Error(xa(10));i=p,f({type:sC.REPLACE})}function v(){var p,m=d;return p={subscribe:function(y){if(typeof y!="object"||y===null)throw new Error(xa(11));function b(){y.next&&y.next(c())}b();var S=m(b);return{unsubscribe:S}}},p[OF]=function(){return this},p}return f({type:sC.INIT}),n={dispatch:f,subscribe:d,getState:c,replaceReducer:h},n[OF]=v,n}function $de(e){Object.keys(e).forEach(function(t){var r=e[t],n=r(void 0,{type:sC.INIT});if(typeof n>"u")throw new Error(xa(12));if(typeof r(void 0,{type:sC.PROBE_UNKNOWN_ACTION()})>"u")throw new Error(xa(13))})}function Xde(e){for(var t=Object.keys(e),r={},n=0;n<t.length;n++){var i=t[n];typeof e[i]=="function"&&(r[i]=e[i])}var a=Object.keys(r),o;try{$de(r)}catch(s){o=s}return function(u,l){if(u===void 0&&(u={}),o)throw o;for(var c=!1,d={},f=0;f<a.length;f++){var h=a[f],v=r[h],p=u[h],m=v(p,l);if(typeof m>"u")throw l&&l.type,new Error(xa(14));d[h]=m,c=c||m!==p}return c=c||a.length!==Object.keys(u).length,c?d:u}}function uC(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return t.length===0?function(n){return n}:t.length===1?t[0]:t.reduce(function(n,i){return function(){return n(i.apply(void 0,arguments))}})}function Yde(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return function(n){return function(){var i=n.apply(void 0,arguments),a=function(){throw new Error(xa(15))},o={getState:i.getState,dispatch:function(){return a.apply(void 0,arguments)}},s=t.map(function(u){return u(o)});return a=uC.apply(void 0,s)(i.dispatch),kF(kF({},i),{},{dispatch:a})}}}function _W(e){var t=function(n){var i=n.dispatch,a=n.getState;return function(o){return function(s){return typeof s=="function"?s(i,a,e):o(s)}}};return t}var wW=_W();wW.withExtraArgument=_W;const _I=wW;var EW=globalThis&&globalThis.__extends||function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(n[a]=i[a])},e(t,r)};return function(t,r){if(typeof r!="function"&&r!==null)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");e(t,r);function n(){this.constructor=t}t.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}}(),Kde=globalThis&&globalThis.__generator||function(e,t){var r={label:0,sent:function(){if(a[0]&1)throw a[1];return a[1]},trys:[],ops:[]},n,i,a,o;return o={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function s(l){return function(c){return u([l,c])}}function u(l){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,i&&(a=l[0]&2?i.return:l[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,l[1])).done)return a;switch(i=0,a&&(l=[l[0]&2,a.value]),l[0]){case 0:case 1:a=l;break;case 4:return r.label++,{value:l[1],done:!1};case 5:r.label++,i=l[1],l=[0];continue;case 7:l=r.ops.pop(),r.trys.pop();continue;default:if(a=r.trys,!(a=a.length>0&&a[a.length-1])&&(l[0]===6||l[0]===2)){r=0;continue}if(l[0]===3&&(!a||l[1]>a[0]&&l[1]<a[3])){r.label=l[1];break}if(l[0]===6&&r.label<a[1]){r.label=a[1],a=l;break}if(a&&r.label<a[2]){r.label=a[2],r.ops.push(l);break}a[2]&&r.ops.pop(),r.trys.pop();continue}l=t.call(e,r)}catch(c){l=[6,c],i=0}finally{n=a=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}},dg=globalThis&&globalThis.__spreadArray||function(e,t){for(var r=0,n=t.length,i=e.length;r<n;r++,i++)e[i]=t[r];return e},Qde=Object.defineProperty,Zde=Object.defineProperties,Jde=Object.getOwnPropertyDescriptors,LF=Object.getOwnPropertySymbols,efe=Object.prototype.hasOwnProperty,tfe=Object.prototype.propertyIsEnumerable,NF=function(e,t,r){return t in e?Qde(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r},Mf=function(e,t){for(var r in t||(t={}))efe.call(t,r)&&NF(e,r,t[r]);if(LF)for(var n=0,i=LF(t);n<i.length;n++){var r=i[n];tfe.call(t,r)&&NF(e,r,t[r])}return e},EA=function(e,t){return Zde(e,Jde(t))},rfe=function(e,t,r){return new Promise(function(n,i){var a=function(u){try{s(r.next(u))}catch(l){i(l)}},o=function(u){try{s(r.throw(u))}catch(l){i(l)}},s=function(u){return u.done?n(u.value):Promise.resolve(u.value).then(a,o)};s((r=r.apply(e,t)).next())})},nfe=typeof window<"u"&&window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__?window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__:function(){if(arguments.length!==0)return typeof arguments[0]=="object"?uC:uC.apply(null,arguments)};function ife(e){if(typeof e!="object"||e===null)return!1;var t=Object.getPrototypeOf(e);if(t===null)return!0;for(var r=t;Object.getPrototypeOf(r)!==null;)r=Object.getPrototypeOf(r);return t===r}var afe=function(e){EW(t,e);function t(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];var i=e.apply(this,r)||this;return Object.setPrototypeOf(i,t.prototype),i}return Object.defineProperty(t,Symbol.species,{get:function(){return t},enumerable:!1,configurable:!0}),t.prototype.concat=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];return e.prototype.concat.apply(this,r)},t.prototype.prepend=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];return r.length===1&&Array.isArray(r[0])?new(t.bind.apply(t,dg([void 0],r[0].concat(this)))):new(t.bind.apply(t,dg([void 0],r.concat(this))))},t}(Array),ofe=function(e){EW(t,e);function t(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];var i=e.apply(this,r)||this;return Object.setPrototypeOf(i,t.prototype),i}return Object.defineProperty(t,Symbol.species,{get:function(){return t},enumerable:!1,configurable:!0}),t.prototype.concat=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];return e.prototype.concat.apply(this,r)},t.prototype.prepend=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];return r.length===1&&Array.isArray(r[0])?new(t.bind.apply(t,dg([void 0],r[0].concat(this)))):new(t.bind.apply(t,dg([void 0],r.concat(this))))},t}(Array);function wI(e){return Pc(e)?SW(e,function(){}):e}function sfe(e){return typeof e=="boolean"}function ufe(){return function(t){return lfe(t)}}function lfe(e){e===void 0&&(e={});var t=e.thunk,r=t===void 0?!0:t;e.immutableCheck,e.serializableCheck;var n=new afe;return r&&(sfe(r)?n.push(_I):n.push(_I.withExtraArgument(r.extraArgument))),n}var cfe=!0;function dfe(e){var t=ufe(),r=e||{},n=r.reducer,i=n===void 0?void 0:n,a=r.middleware,o=a===void 0?t():a,s=r.devTools,u=s===void 0?!0:s,l=r.preloadedState,c=l===void 0?void 0:l,d=r.enhancers,f=d===void 0?void 0:d,h;if(typeof i=="function")h=i;else if(ife(i))h=Xde(i);else throw new Error('"reducer" is a required argument, and must be a function or an object of functions that can be passed to combineReducers');var v=o;typeof v=="function"&&(v=v(t));var p=Yde.apply(void 0,v),m=uC;u&&(m=nfe(Mf({trace:!cfe},typeof u=="object"&&u)));var g=new ofe(p),y=g;Array.isArray(f)?y=dg([p],f):typeof f=="function"&&(y=f(g));var b=m.apply(void 0,y);return CW(h,c,b)}function Df(e,t){function r(){for(var n=[],i=0;i<arguments.length;i++)n[i]=arguments[i];if(t){var a=t.apply(void 0,n);if(!a)throw new Error("prepareAction did not return an object");return Mf(Mf({type:e,payload:a.payload},"meta"in a&&{meta:a.meta}),"error"in a&&{error:a.error})}return{type:e,payload:n[0]}}return r.toString=function(){return""+e},r.type=e,r.match=function(n){return n.type===e},r}function AW(e){var t={},r=[],n,i={addCase:function(a,o){var s=typeof a=="string"?a:a.type;if(s in t)throw new Error("addCase cannot be called with two reducers for the same action type");return t[s]=o,i},addMatcher:function(a,o){return r.push({matcher:a,reducer:o}),i},addDefaultCase:function(a){return n=a,i}};return e(i),[t,r,n]}function ffe(e){return typeof e=="function"}function hfe(e,t,r,n){r===void 0&&(r=[]);var i=typeof t=="function"?AW(t):[t,r,n],a=i[0],o=i[1],s=i[2],u;if(ffe(e))u=function(){return wI(e())};else{var l=wI(e);u=function(){return l}}function c(d,f){d===void 0&&(d=u());var h=dg([a[f.type]],o.filter(function(v){var p=v.matcher;return p(f)}).map(function(v){var p=v.reducer;return p}));return h.filter(function(v){return!!v}).length===0&&(h=[s]),h.reduce(function(v,p){if(p)if(jf(v)){var m=v,g=p(m,f);return g===void 0?v:g}else{if(Pc(v))return SW(v,function(y){return p(y,f)});var g=p(v,f);if(g===void 0){if(v===null)return v;throw Error("A case reducer on a non-draftable value must not return undefined")}return g}return v},d)}return c.getInitialState=u,c}function pfe(e,t){return e+"/"+t}function vfe(e){var t=e.name;if(!t)throw new Error("`name` is a required option for createSlice");typeof process<"u";var r=typeof e.initialState=="function"?e.initialState:wI(e.initialState),n=e.reducers||{},i=Object.keys(n),a={},o={},s={};i.forEach(function(c){var d=n[c],f=pfe(t,c),h,v;"reducer"in d?(h=d.reducer,v=d.prepare):h=d,a[c]=h,o[f]=h,s[c]=v?Df(f,v):Df(f)});function u(){var c=typeof e.extraReducers=="function"?AW(e.extraReducers):[e.extraReducers],d=c[0],f=d===void 0?{}:d,h=c[1],v=h===void 0?[]:h,p=c[2],m=p===void 0?void 0:p,g=Mf(Mf({},f),o);return hfe(r,function(y){for(var b in g)y.addCase(b,g[b]);for(var S=0,x=v;S<x.length;S++){var C=x[S];y.addMatcher(C.matcher,C.reducer)}m&&y.addDefaultCase(m)})}var l;return{name:t,reducer:function(c,d){return l||(l=u()),l(c,d)},actions:s,caseReducers:a,getInitialState:function(){return l||(l=u()),l.getInitialState()}}}var mfe="ModuleSymbhasOwnPr-0123456789ABCDEFGHNRVfgctiUvz_KqYTJkLxpZXIjQW",gfe=function(e){e===void 0&&(e=21);for(var t="",r=e;r--;)t+=mfe[Math.random()*64|0];return t},yfe=["name","message","stack","code"],AA=function(){function e(t,r){this.payload=t,this.meta=r}return e}(),FF=function(){function e(t,r){this.payload=t,this.meta=r}return e}(),bfe=function(e){if(typeof e=="object"&&e!==null){for(var t={},r=0,n=yfe;r<n.length;r++){var i=n[r];typeof e[i]=="string"&&(t[i]=e[i])}return t}return{message:String(e)}};(function(){function e(t,r,n){var i=Df(t+"/fulfilled",function(l,c,d,f){return{payload:l,meta:EA(Mf({},f||{}),{arg:d,requestId:c,requestStatus:"fulfilled"})}}),a=Df(t+"/pending",function(l,c,d){return{payload:void 0,meta:EA(Mf({},d||{}),{arg:c,requestId:l,requestStatus:"pending"})}}),o=Df(t+"/rejected",function(l,c,d,f,h){return{payload:f,error:(n&&n.serializeError||bfe)(l||"Rejected"),meta:EA(Mf({},h||{}),{arg:d,requestId:c,rejectedWithValue:!!f,requestStatus:"rejected",aborted:(l==null?void 0:l.name)==="AbortError",condition:(l==null?void 0:l.name)==="ConditionError"})}}),s=typeof AbortController<"u"?AbortController:function(){function l(){this.signal={aborted:!1,addEventListener:function(){},dispatchEvent:function(){return!1},onabort:function(){},removeEventListener:function(){},reason:void 0,throwIfAborted:function(){}}}return l.prototype.abort=function(){},l}();function u(l){return function(c,d,f){var h=n!=null&&n.idGenerator?n.idGenerator(l):gfe(),v=new s,p;function m(y){p=y,v.abort()}var g=function(){return rfe(this,null,function(){var y,b,S,x,C,w,A;return Kde(this,function(M){switch(M.label){case 0:return M.trys.push([0,4,,5]),x=(y=n==null?void 0:n.condition)==null?void 0:y.call(n,l,{getState:d,extra:f}),Sfe(x)?[4,x]:[3,2];case 1:x=M.sent(),M.label=2;case 2:if(x===!1||v.signal.aborted)throw{name:"ConditionError",message:"Aborted due to condition callback returning false."};return C=new Promise(function(D,k){return v.signal.addEventListener("abort",function(){return k({name:"AbortError",message:p||"Aborted"})})}),c(a(h,l,(b=n==null?void 0:n.getPendingMeta)==null?void 0:b.call(n,{requestId:h,arg:l},{getState:d,extra:f}))),[4,Promise.race([C,Promise.resolve(r(l,{dispatch:c,getState:d,extra:f,requestId:h,signal:v.signal,abort:m,rejectWithValue:function(D,k){return new AA(D,k)},fulfillWithValue:function(D,k){return new FF(D,k)}})).then(function(D){if(D instanceof AA)throw D;return D instanceof FF?i(D.payload,h,l,D.meta):i(D,h,l)})])];case 3:return S=M.sent(),[3,5];case 4:return w=M.sent(),S=w instanceof AA?o(null,h,l,w.payload,w.meta):o(w,h,l),[3,5];case 5:return A=n&&!n.dispatchConditionRejection&&o.match(S)&&S.meta.condition,A||c(S),[2,S]}})})}();return Object.assign(g,{abort:m,requestId:h,arg:l,unwrap:function(){return g.then(xfe)}})}}return Object.assign(u,{pending:a,rejected:o,fulfilled:i,typePrefix:t})}return e.withTypes=function(){return e},e})();function xfe(e){if(e.meta&&e.meta.rejectedWithValue)throw e.payload;if(e.error)throw e.error;return e.payload}function Sfe(e){return e!==null&&typeof e=="object"&&typeof e.then=="function"}var XR="listenerMiddleware";Df(XR+"/add");Df(XR+"/removeAll");Df(XR+"/remove");var BF;typeof queueMicrotask=="function"&&queueMicrotask.bind(typeof window<"u"?window:typeof global<"u"?global:globalThis);Bde();const Cfe={searchString:"",searchFilters:{geneName:"",sequenceLengthMin:"",sequenceLengthMax:"",annotationScore:"",proteinWith:""},searchResults:{searchString:"",nextLink:"",totalResults:-1,items:[]},proteinCache:{}},PW=vfe({name:"items",initialState:Cfe,reducers:{fetchItems:(e,t)=>(e.searchResults=t.payload,e),appendItems:(e,t)=>(e.searchResults.nextLink=t.payload.nextLink,e.searchResults.items.push(...t.payload.items),e),setSearchFilters:(e,t)=>(e.searchFilters=t.payload,e),fetchProtein:(e,t)=>(e.proteinCache={...e.proteinCache,[t.payload.id]:t.payload},e),fetchProteinPublications:(e,t)=>(t.payload.proteinId in e.proteinCache?e.proteinCache[t.payload.proteinId].publications=t.payload.publications:console.error("proteinId does not exist in cache - this is not expected to happen: "+t.payload.proteinId),e)}}),{fetchItems:_fe,appendItems:wfe,setSearchFilters:Efe,fetchProtein:Afe,fetchProteinPublications:Pfe}=PW.actions,Tfe=PW.reducer;var TW={exports:{}},IW={};/**
 * @license React
 * use-sync-external-store-shim.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var fg=Ve;function Ife(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var Mfe=typeof Object.is=="function"?Object.is:Ife,Dfe=fg.useState,Rfe=fg.useEffect,kfe=fg.useLayoutEffect,Ofe=fg.useDebugValue;function Lfe(e,t){var r=t(),n=Dfe({inst:{value:r,getSnapshot:t}}),i=n[0].inst,a=n[1];return kfe(function(){i.value=r,i.getSnapshot=t,PA(i)&&a({inst:i})},[e,r,t]),Rfe(function(){return PA(i)&&a({inst:i}),e(function(){PA(i)&&a({inst:i})})},[e]),Ofe(r),r}function PA(e){var t=e.getSnapshot;e=e.value;try{var r=t();return!Mfe(e,r)}catch{return!0}}function Nfe(e,t){return t()}var Ffe=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?Nfe:Lfe;IW.useSyncExternalStore=fg.useSyncExternalStore!==void 0?fg.useSyncExternalStore:Ffe;TW.exports=IW;var Bfe=TW.exports,MW={exports:{}},DW={};/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Sw=Ve,Ufe=Bfe;function jfe(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var zfe=typeof Object.is=="function"?Object.is:jfe,Vfe=Ufe.useSyncExternalStore,Hfe=Sw.useRef,Gfe=Sw.useEffect,qfe=Sw.useMemo,Wfe=Sw.useDebugValue;DW.useSyncExternalStoreWithSelector=function(e,t,r,n,i){var a=Hfe(null);if(a.current===null){var o={hasValue:!1,value:null};a.current=o}else o=a.current;a=qfe(function(){function u(h){if(!l){if(l=!0,c=h,h=n(h),i!==void 0&&o.hasValue){var v=o.value;if(i(v,h))return d=v}return d=h}if(v=d,zfe(c,h))return v;var p=n(h);return i!==void 0&&i(v,p)?v:(c=h,d=p)}var l=!1,c,d,f=r===void 0?null:r;return[function(){return u(t())},f===null?void 0:function(){return u(f())}]},[t,r,n,i]);var s=Vfe(e,a[0],a[1]);return Gfe(function(){o.hasValue=!0,o.value=s},[s]),Wfe(s),s};MW.exports=DW;var $fe=MW.exports;function Xfe(e){e()}let RW=Xfe;const Yfe=e=>RW=e,Kfe=()=>RW,zf=Ve.createContext(null);function kW(){return Ve.useContext(zf)}const Qfe=()=>{throw new Error("uSES not initialized!")};let OW=Qfe;const Zfe=e=>{OW=e},Jfe=(e,t)=>e===t;function ehe(e=zf){const t=e===zf?kW:()=>Ve.useContext(e);return function(n,i=Jfe){const{store:a,subscription:o,getServerState:s}=t(),u=OW(o.addNestedSub,a.getState,s||a.getState,n,i);return Ve.useDebugValue(u),u}}const hg=ehe();var LW={exports:{}},Sn={};/** @license React v16.13.1
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var na=typeof Symbol=="function"&&Symbol.for,YR=na?Symbol.for("react.element"):60103,KR=na?Symbol.for("react.portal"):60106,Cw=na?Symbol.for("react.fragment"):60107,_w=na?Symbol.for("react.strict_mode"):60108,ww=na?Symbol.for("react.profiler"):60114,Ew=na?Symbol.for("react.provider"):60109,Aw=na?Symbol.for("react.context"):60110,QR=na?Symbol.for("react.async_mode"):60111,Pw=na?Symbol.for("react.concurrent_mode"):60111,Tw=na?Symbol.for("react.forward_ref"):60112,Iw=na?Symbol.for("react.suspense"):60113,the=na?Symbol.for("react.suspense_list"):60120,Mw=na?Symbol.for("react.memo"):60115,Dw=na?Symbol.for("react.lazy"):60116,rhe=na?Symbol.for("react.block"):60121,nhe=na?Symbol.for("react.fundamental"):60117,ihe=na?Symbol.for("react.responder"):60118,ahe=na?Symbol.for("react.scope"):60119;function ts(e){if(typeof e=="object"&&e!==null){var t=e.$$typeof;switch(t){case YR:switch(e=e.type,e){case QR:case Pw:case Cw:case ww:case _w:case Iw:return e;default:switch(e=e&&e.$$typeof,e){case Aw:case Tw:case Dw:case Mw:case Ew:return e;default:return t}}case KR:return t}}}function NW(e){return ts(e)===Pw}Sn.AsyncMode=QR;Sn.ConcurrentMode=Pw;Sn.ContextConsumer=Aw;Sn.ContextProvider=Ew;Sn.Element=YR;Sn.ForwardRef=Tw;Sn.Fragment=Cw;Sn.Lazy=Dw;Sn.Memo=Mw;Sn.Portal=KR;Sn.Profiler=ww;Sn.StrictMode=_w;Sn.Suspense=Iw;Sn.isAsyncMode=function(e){return NW(e)||ts(e)===QR};Sn.isConcurrentMode=NW;Sn.isContextConsumer=function(e){return ts(e)===Aw};Sn.isContextProvider=function(e){return ts(e)===Ew};Sn.isElement=function(e){return typeof e=="object"&&e!==null&&e.$$typeof===YR};Sn.isForwardRef=function(e){return ts(e)===Tw};Sn.isFragment=function(e){return ts(e)===Cw};Sn.isLazy=function(e){return ts(e)===Dw};Sn.isMemo=function(e){return ts(e)===Mw};Sn.isPortal=function(e){return ts(e)===KR};Sn.isProfiler=function(e){return ts(e)===ww};Sn.isStrictMode=function(e){return ts(e)===_w};Sn.isSuspense=function(e){return ts(e)===Iw};Sn.isValidElementType=function(e){return typeof e=="string"||typeof e=="function"||e===Cw||e===Pw||e===ww||e===_w||e===Iw||e===the||typeof e=="object"&&e!==null&&(e.$$typeof===Dw||e.$$typeof===Mw||e.$$typeof===Ew||e.$$typeof===Aw||e.$$typeof===Tw||e.$$typeof===nhe||e.$$typeof===ihe||e.$$typeof===ahe||e.$$typeof===rhe)};Sn.typeOf=ts;LW.exports=Sn;var ohe=LW.exports,FW=ohe,she={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},uhe={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},BW={};BW[FW.ForwardRef]=she;BW[FW.Memo]=uhe;var En={};/**
 * @license React
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ZR=Symbol.for("react.element"),JR=Symbol.for("react.portal"),Rw=Symbol.for("react.fragment"),kw=Symbol.for("react.strict_mode"),Ow=Symbol.for("react.profiler"),Lw=Symbol.for("react.provider"),Nw=Symbol.for("react.context"),lhe=Symbol.for("react.server_context"),Fw=Symbol.for("react.forward_ref"),Bw=Symbol.for("react.suspense"),Uw=Symbol.for("react.suspense_list"),jw=Symbol.for("react.memo"),zw=Symbol.for("react.lazy"),che=Symbol.for("react.offscreen"),UW;UW=Symbol.for("react.module.reference");function js(e){if(typeof e=="object"&&e!==null){var t=e.$$typeof;switch(t){case ZR:switch(e=e.type,e){case Rw:case Ow:case kw:case Bw:case Uw:return e;default:switch(e=e&&e.$$typeof,e){case lhe:case Nw:case Fw:case zw:case jw:case Lw:return e;default:return t}}case JR:return t}}}En.ContextConsumer=Nw;En.ContextProvider=Lw;En.Element=ZR;En.ForwardRef=Fw;En.Fragment=Rw;En.Lazy=zw;En.Memo=jw;En.Portal=JR;En.Profiler=Ow;En.StrictMode=kw;En.Suspense=Bw;En.SuspenseList=Uw;En.isAsyncMode=function(){return!1};En.isConcurrentMode=function(){return!1};En.isContextConsumer=function(e){return js(e)===Nw};En.isContextProvider=function(e){return js(e)===Lw};En.isElement=function(e){return typeof e=="object"&&e!==null&&e.$$typeof===ZR};En.isForwardRef=function(e){return js(e)===Fw};En.isFragment=function(e){return js(e)===Rw};En.isLazy=function(e){return js(e)===zw};En.isMemo=function(e){return js(e)===jw};En.isPortal=function(e){return js(e)===JR};En.isProfiler=function(e){return js(e)===Ow};En.isStrictMode=function(e){return js(e)===kw};En.isSuspense=function(e){return js(e)===Bw};En.isSuspenseList=function(e){return js(e)===Uw};En.isValidElementType=function(e){return typeof e=="string"||typeof e=="function"||e===Rw||e===Ow||e===kw||e===Bw||e===Uw||e===che||typeof e=="object"&&e!==null&&(e.$$typeof===zw||e.$$typeof===jw||e.$$typeof===Lw||e.$$typeof===Nw||e.$$typeof===Fw||e.$$typeof===UW||e.getModuleId!==void 0)};En.typeOf=js;function dhe(){const e=Kfe();let t=null,r=null;return{clear(){t=null,r=null},notify(){e(()=>{let n=t;for(;n;)n.callback(),n=n.next})},get(){let n=[],i=t;for(;i;)n.push(i),i=i.next;return n},subscribe(n){let i=!0,a=r={callback:n,next:null,prev:r};return a.prev?a.prev.next=a:t=a,function(){!i||t===null||(i=!1,a.next?a.next.prev=a.prev:r=a.prev,a.prev?a.prev.next=a.next:t=a.next)}}}}const UF={notify(){},get:()=>[]};function fhe(e,t){let r,n=UF;function i(d){return u(),n.subscribe(d)}function a(){n.notify()}function o(){c.onStateChange&&c.onStateChange()}function s(){return!!r}function u(){r||(r=t?t.addNestedSub(o):e.subscribe(o),n=dhe())}function l(){r&&(r(),r=void 0,n.clear(),n=UF)}const c={addNestedSub:i,notifyNestedSubs:a,handleChangeWrapper:o,isSubscribed:s,trySubscribe:u,tryUnsubscribe:l,getListeners:()=>n};return c}const hhe=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",phe=hhe?Ve.useLayoutEffect:Ve.useEffect;function vhe({store:e,context:t,children:r,serverState:n}){const i=Ve.useMemo(()=>{const s=fhe(e);return{store:e,subscription:s,getServerState:n?()=>n:void 0}},[e,n]),a=Ve.useMemo(()=>e.getState(),[e]);phe(()=>{const{subscription:s}=i;return s.onStateChange=s.notifyNestedSubs,s.trySubscribe(),a!==e.getState()&&s.notifyNestedSubs(),()=>{s.tryUnsubscribe(),s.onStateChange=void 0}},[i,a]);const o=t||zf;return du.createElement(o.Provider,{value:i},r)}function jW(e=zf){const t=e===zf?kW:()=>Ve.useContext(e);return function(){const{store:n}=t();return n}}const mhe=jW();function ghe(e=zf){const t=e===zf?mhe:jW(e);return function(){return t().dispatch}}const yhe=ghe();Zfe($fe.useSyncExternalStoreWithSelector);Yfe(ER.unstable_batchedUpdates);var Un={};function bhe(e){return!!(e&&typeof e.then=="function")}function lC(e){return e||(e=0),new Promise(function(t){return setTimeout(t,e)})}function xhe(e,t){return Math.floor(Math.random()*(t-e+1)+e)}function Vw(){return Math.random().toString(36).substring(2)}var jF=0,TA=0;function Hw(){var e=new Date().getTime();return e===jF?(TA++,e*1e3+TA):(jF=e,TA=0,e*1e3)}var yb=Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]",She=Hw,Che="native";function _he(e){var t={messagesCallback:null,bc:new BroadcastChannel(e),subFns:[]};return t.bc.onmessage=function(r){t.messagesCallback&&t.messagesCallback(r.data)},t}function whe(e){e.bc.close(),e.subFns=[]}function Ehe(e,t){try{return e.bc.postMessage(t,!1),Promise.resolve()}catch(r){return Promise.reject(r)}}function Ahe(e,t){e.messagesCallback=t}function Phe(){if(yb&&typeof window>"u")return!1;if(typeof BroadcastChannel=="function"){if(BroadcastChannel._pubkey)throw new Error("BroadcastChannel: Do not overwrite window.BroadcastChannel with this module, this is not a polyfill");return!0}else return!1}function The(){return 150}const Ihe={create:_he,close:whe,onMessage:Ahe,postMessage:Ehe,canBeUsed:Phe,type:Che,averageResponseTime:The,microSeconds:She};var zW=function(){function e(t){this.ttl=t,this.set=new Set,this.timeMap=new Map}return e.prototype.has=function(t){return this.set.has(t)},e.prototype.add=function(t){var r=this;this.timeMap.set(t,VW()),this.set.add(t),setTimeout(function(){Mhe(r)},0)},e.prototype.clear=function(){this.set.clear(),this.timeMap.clear()},e}();function Mhe(e){for(var t=VW()-e.ttl,r=e.set[Symbol.iterator]();;){var n=r.next().value;if(!n)return;var i=e.timeMap.get(n);if(i<t)e.timeMap.delete(n),e.set.delete(n);else return}}function VW(){return new Date().getTime()}function Gw(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=JSON.parse(JSON.stringify(e));return typeof t.webWorkerSupport>"u"&&(t.webWorkerSupport=!0),t.idb||(t.idb={}),t.idb.ttl||(t.idb.ttl=1e3*45),t.idb.fallbackInterval||(t.idb.fallbackInterval=150),e.idb&&typeof e.idb.onclose=="function"&&(t.idb.onclose=e.idb.onclose),t.localstorage||(t.localstorage={}),t.localstorage.removeTimeout||(t.localstorage.removeTimeout=1e3*60),e.methods&&(t.methods=e.methods),t.node||(t.node={}),t.node.ttl||(t.node.ttl=1e3*60*2),typeof t.node.useFastPath>"u"&&(t.node.useFastPath=!0),t}var Dhe=Hw,Rhe="pubkey.broadcast-channel-0-",Tc="messages",khe="idb";function HW(){if(typeof indexedDB<"u")return indexedDB;if(typeof window<"u"){if(typeof window.mozIndexedDB<"u")return window.mozIndexedDB;if(typeof window.webkitIndexedDB<"u")return window.webkitIndexedDB;if(typeof window.msIndexedDB<"u")return window.msIndexedDB}return!1}function Ohe(e){var t=HW(),r=Rhe+e,n=t.open(r,1);n.onupgradeneeded=function(a){var o=a.target.result;o.createObjectStore(Tc,{keyPath:"id",autoIncrement:!0})};var i=new Promise(function(a,o){n.onerror=function(s){return o(s)},n.onsuccess=function(){a(n.result)}});return i}function Lhe(e,t,r){var n=new Date().getTime(),i={uuid:t,time:n,data:r},a=e.transaction([Tc],"readwrite");return new Promise(function(o,s){a.oncomplete=function(){return o()},a.onerror=function(l){return s(l)};var u=a.objectStore(Tc);u.add(i)})}function Nhe(e,t){var r=e.transaction(Tc).objectStore(Tc),n=[];function i(){try{var a=IDBKeyRange.bound(t+1,1/0);return r.openCursor(a)}catch{return r.openCursor()}}return new Promise(function(a){i().onsuccess=function(o){var s=o.target.result;s?s.value.id<t+1?s.continue(t+1):(n.push(s.value),s.continue()):a(n)}})}function Fhe(e,t){var r=e.transaction([Tc],"readwrite").objectStore(Tc).delete(t);return new Promise(function(n){r.onsuccess=function(){return n()}})}function Bhe(e,t){var r=new Date().getTime()-t,n=e.transaction(Tc).objectStore(Tc),i=[];return new Promise(function(a){n.openCursor().onsuccess=function(o){var s=o.target.result;if(s){var u=s.value;if(u.time<r)i.push(u),s.continue();else{a(i);return}}else a(i)}})}function Uhe(e,t){return Bhe(e,t).then(function(r){return Promise.all(r.map(function(n){return Fhe(e,n.id)}))})}function jhe(e,t){return t=Gw(t),Ohe(e).then(function(r){var n={closed:!1,lastCursorId:0,channelName:e,options:t,uuid:Vw(),eMIs:new zW(t.idb.ttl*2),writeBlockPromise:Promise.resolve(),messagesCallback:null,readQueuePromises:[],db:r};return r.onclose=function(){n.closed=!0,t.idb.onclose&&t.idb.onclose()},GW(n),n})}function GW(e){e.closed||qW(e).then(function(){return lC(e.options.idb.fallbackInterval)}).then(function(){return GW(e)})}function zhe(e,t){return!(e.uuid===t.uuid||t.eMIs.has(e.id)||e.data.time<t.messagesCallbackTime)}function qW(e){return e.closed||!e.messagesCallback?Promise.resolve():Nhe(e.db,e.lastCursorId).then(function(t){var r=t.filter(function(n){return!!n}).map(function(n){return n.id>e.lastCursorId&&(e.lastCursorId=n.id),n}).filter(function(n){return zhe(n,e)}).sort(function(n,i){return n.time-i.time});return r.forEach(function(n){e.messagesCallback&&(e.eMIs.add(n.id),e.messagesCallback(n.data))}),Promise.resolve()})}function Vhe(e){e.closed=!0,e.db.close()}function Hhe(e,t){return e.writeBlockPromise=e.writeBlockPromise.then(function(){return Lhe(e.db,e.uuid,t)}).then(function(){xhe(0,10)===0&&Uhe(e.db,e.options.idb.ttl)}),e.writeBlockPromise}function Ghe(e,t,r){e.messagesCallbackTime=r,e.messagesCallback=t,qW(e)}function qhe(){if(yb)return!1;var e=HW();return!!e}function Whe(e){return e.idb.fallbackInterval*2}const $he={create:jhe,close:Vhe,onMessage:Ghe,postMessage:Hhe,canBeUsed:qhe,type:khe,averageResponseTime:Whe,microSeconds:Dhe};var Xhe=Hw,Yhe="pubkey.broadcastChannel-",Khe="localstorage";function WW(){var e;if(typeof window>"u")return null;try{e=window.localStorage,e=window["ie8-eventlistener/storage"]||window.localStorage}catch{}return e}function $W(e){return Yhe+e}function Qhe(e,t){return new Promise(function(r){lC().then(function(){var n=$W(e.channelName),i={token:Vw(),time:new Date().getTime(),data:t,uuid:e.uuid},a=JSON.stringify(i);WW().setItem(n,a);var o=document.createEvent("Event");o.initEvent("storage",!0,!0),o.key=n,o.newValue=a,window.dispatchEvent(o),r()})})}function Zhe(e,t){var r=$W(e),n=function(a){a.key===r&&t(JSON.parse(a.newValue))};return window.addEventListener("storage",n),n}function Jhe(e){window.removeEventListener("storage",e)}function epe(e,t){if(t=Gw(t),!XW())throw new Error("BroadcastChannel: localstorage cannot be used");var r=Vw(),n=new zW(t.localstorage.removeTimeout),i={channelName:e,uuid:r,eMIs:n};return i.listener=Zhe(e,function(a){i.messagesCallback&&a.uuid!==r&&(!a.token||n.has(a.token)||a.data.time&&a.data.time<i.messagesCallbackTime||(n.add(a.token),i.messagesCallback(a.data)))}),i}function tpe(e){Jhe(e.listener)}function rpe(e,t,r){e.messagesCallbackTime=r,e.messagesCallback=t}function XW(){if(yb)return!1;var e=WW();if(!e)return!1;try{var t="__broadcastchannel_check";e.setItem(t,"works"),e.removeItem(t)}catch{return!1}return!0}function npe(){var e=120,t=navigator.userAgent.toLowerCase();return t.includes("safari")&&!t.includes("chrome")?e*2:e}const ipe={create:epe,close:tpe,onMessage:rpe,postMessage:Qhe,canBeUsed:XW,type:Khe,averageResponseTime:npe,microSeconds:Xhe};var ape=Hw,ope="simulate",ek=new Set;function spe(e){var t={name:e,messagesCallback:null};return ek.add(t),t}function upe(e){ek.delete(e)}function lpe(e,t){return new Promise(function(r){return setTimeout(function(){var n=Array.from(ek);n.filter(function(i){return i.name===e.name}).filter(function(i){return i!==e}).filter(function(i){return!!i.messagesCallback}).forEach(function(i){return i.messagesCallback(t)}),r()},5)})}function cpe(e,t){e.messagesCallback=t}function dpe(){return!0}function fpe(){return 5}const hpe={create:spe,close:upe,onMessage:cpe,postMessage:lpe,canBeUsed:dpe,type:ope,averageResponseTime:fpe,microSeconds:ape};var EI=[Ihe,$he,ipe];if(yb){var zF=require("../../src/methods/node.js");typeof zF.canBeUsed=="function"&&EI.push(zF)}function YW(e){var t=[].concat(e.methods,EI).filter(Boolean);if(e.type){if(e.type==="simulate")return hpe;var r=t.find(function(i){return i.type===e.type});if(r)return r;throw new Error("method-type "+e.type+" not found")}!e.webWorkerSupport&&!yb&&(t=t.filter(function(i){return i.type!=="idb"}));var n=t.find(function(i){return i.canBeUsed()});if(n)return n;throw new Error("No useable methode found:"+JSON.stringify(EI.map(function(i){return i.type})))}var tk=function(t,r){this.name=t,AI&&(r=AI),this.options=Gw(r),this.method=YW(this.options),this._iL=!1,this._onML=null,this._addEL={message:[],internal:[]},this._uMP=new Set,this._befC=[],this._prepP=null,mpe(this)};tk._pubkey=!0;function ppe(e){e=Gw(e);var t=YW(e);return t.type==="node"?t.clearNodeFolder().then(function(){return!0}):Promise.resolve(!1)}var AI;function vpe(e){AI=e}tk.prototype={postMessage:function(t){if(this.closed)throw new Error("BroadcastChannel.postMessage(): Cannot post message after channel has closed");return VF(this,"message",t)},postInternal:function(t){return VF(this,"internal",t)},set onmessage(e){var t=this.method.microSeconds(),r={time:t,fn:e};GF(this,"message",this._onML),e&&typeof e=="function"?(this._onML=r,HF(this,"message",r)):this._onML=null},addEventListener:function(t,r){var n=this.method.microSeconds(),i={time:n,fn:r};HF(this,t,i)},removeEventListener:function(t,r){var n=this._addEL[t].find(function(i){return i.fn===r});GF(this,t,n)},close:function(){var t=this;if(!this.closed){this.closed=!0;var r=this._prepP?this._prepP:Promise.resolve();return this._onML=null,this._addEL.message=[],r.then(function(){return Promise.all(Array.from(t._uMP))}).then(function(){return Promise.all(t._befC.map(function(n){return n()}))}).then(function(){return t.method.close(t._state)})}},get type(){return this.method.type},get isClosed(){return this.closed}};function VF(e,t,r){var n=e.method.microSeconds(),i={time:n,type:t,data:r},a=e._prepP?e._prepP:Promise.resolve();return a.then(function(){var o=e.method.postMessage(e._state,i);return e._uMP.add(o),o.catch().then(function(){return e._uMP.delete(o)}),o})}function mpe(e){var t=e.method.create(e.name,e.options);bhe(t)?(e._prepP=t,t.then(function(r){e._state=r})):e._state=t}function KW(e){return e._addEL.message.length>0||e._addEL.internal.length>0}function HF(e,t,r){e._addEL[t].push(r),gpe(e)}function GF(e,t,r){e._addEL[t]=e._addEL[t].filter(function(n){return n!==r}),ype(e)}function gpe(e){if(!e._iL&&KW(e)){var t=function(i){e._addEL[i.type].forEach(function(a){i.time>=a.time&&a.fn(i.data)})},r=e.method.microSeconds();e._prepP?e._prepP.then(function(){e._iL=!0,e.method.onMessage(e._state,t,r)}):(e._iL=!0,e.method.onMessage(e._state,t,r))}}function ype(e){if(e._iL&&!KW(e)){e._iL=!1;var t=e.method.microSeconds();e.method.onMessage(e._state,null,t)}}const bpe=Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]";function xpe(e){if(!(typeof WorkerGlobalScope=="function"&&self instanceof WorkerGlobalScope)){if(typeof window.addEventListener!="function")return;window.addEventListener("beforeunload",function(){e()},!0),window.addEventListener("unload",function(){e()},!0)}}const Spe={add:xpe},Cpe={};var _pe=bpe?Cpe:Spe,pp=new Set,qF=!1;function wpe(){qF||(qF=!0,_pe.add(QW))}function Epe(e){if(wpe(),typeof e!="function")throw new Error("Listener is no function");pp.add(e);var t={remove:function(){return pp.delete(e)},run:function(){return pp.delete(e),e()}};return t}function QW(){var e=[];return pp.forEach(function(t){e.push(t()),pp.delete(t)}),Promise.all(e)}function Ape(){pp.clear()}function Ppe(){return pp.size}const Tpe={add:Epe,runAll:QW,removeAll:Ape,getSize:Ppe};var ZW=function(t,r){this._channel=t,this._options=r,this.isLeader=!1,this.isDead=!1,this.token=Vw(),this._isApl=!1,this._reApply=!1,this._unl=[],this._lstns=[],this._invs=[],this._dpL=function(){},this._dpLC=!1};ZW.prototype={applyOnce:function(){var t=this;if(this.isLeader||this.isDead)return Promise.resolve(!1);if(this._isApl)return this._reApply=!0,Promise.resolve(!1);this._isApl=!0;var r=!1,n=function(o){o.context==="leader"&&o.token!=t.token&&(o.action==="apply"&&o.token>t.token&&(r=!0),o.action==="tell"&&(r=!0))};this._channel.addEventListener("internal",n);var i=rp(this,"apply").then(function(){return lC(t._options.responseTime)}).then(function(){return r?Promise.reject(new Error):rp(t,"apply")}).then(function(){return lC(t._options.responseTime)}).then(function(){return r?Promise.reject(new Error):rp(t)}).then(function(){return JW(t)}).then(function(){return!0}).catch(function(){return!1}).then(function(a){return t._channel.removeEventListener("internal",n),t._isApl=!1,!a&&t._reApply?(t._reApply=!1,t.applyOnce()):a});return i},awaitLeadership:function(){return this._aLP||(this._aLP=Ipe(this)),this._aLP},set onduplicate(e){this._dpL=e},die:function(){var t=this;if(!this.isDead)return this.isDead=!0,this._lstns.forEach(function(r){return t._channel.removeEventListener("internal",r)}),this._invs.forEach(function(r){return clearInterval(r)}),this._unl.forEach(function(r){r.remove()}),rp(this,"death")}};function Ipe(e){return e.isLeader?Promise.resolve():new Promise(function(t){var r=!1;function n(){r||(r=!0,clearInterval(i),e._channel.removeEventListener("internal",a),t(!0))}e.applyOnce().then(function(){e.isLeader&&n()});var i=setInterval(function(){e.applyOnce().then(function(){e.isLeader&&n()})},e._options.fallbackInterval);e._invs.push(i);var a=function(s){s.context==="leader"&&s.action==="death"&&e.applyOnce().then(function(){e.isLeader&&n()})};e._channel.addEventListener("internal",a),e._lstns.push(a)})}function rp(e,t){var r={context:"leader",action:t,token:e.token};return e._channel.postInternal(r)}function JW(e){e.isLeader=!0;var t=Tpe.add(function(){return e.die()});e._unl.push(t);var r=function(i){i.context==="leader"&&i.action==="apply"&&rp(e,"tell"),i.context==="leader"&&i.action==="tell"&&!e._dpLC&&(e._dpLC=!0,e._dpL(),rp(e,"tell"))};return e._channel.addEventListener("internal",r),e._lstns.push(r),rp(e,"tell")}function Mpe(e,t){return e||(e={}),e=JSON.parse(JSON.stringify(e)),e.fallbackInterval||(e.fallbackInterval=3e3),e.responseTime||(e.responseTime=t.method.averageResponseTime(t.options)),e}function Dpe(e,t){if(e._leaderElector)throw new Error("BroadcastChannel already has a leader-elector");t=Mpe(t,e);var r=new ZW(e,t);return e._befC.push(function(){return r.die()}),e._leaderElector=r,r}const Rpe=Object.freeze(Object.defineProperty({__proto__:null,BroadcastChannel:tk,beLeader:JW,clearNodeFolder:ppe,createLeaderElection:Dpe,enforceOptions:vpe},Symbol.toStringTag,{value:"Module"})),kpe=Tie(Rpe);var rk;Object.defineProperty(Un,"__esModule",{value:!0});var e$=Un.initMessageListener=Un.initStateWithPrevTab=Un.withReduxStateSync=Un.createReduxStateSync=rk=Un.createStateSyncMiddleware=Un.WINDOW_STATE_SYNC_ID=Un.INIT_MESSAGE_LISTENER=Un.RECEIVE_INIT_STATE=Un.SEND_INIT_STATE=Un.GET_INIT_STATE=void 0;Un.generateUuidForAction=n$;Un.isActionAllowed=i$;Un.isActionSynced=jpe;Un.MessageListener=a$;var Ope=kpe,PI=0,nk=Un.GET_INIT_STATE="&_GET_INIT_STATE",ik=Un.SEND_INIT_STATE="&_SEND_INIT_STATE",ak=Un.RECEIVE_INIT_STATE="&_RECEIVE_INIT_STATE",Lpe=Un.INIT_MESSAGE_LISTENER="&_INIT_MESSAGE_LISTENER",TI={channel:"redux_state_sync",predicate:null,blacklist:[],whitelist:[],broadcastChannelOption:void 0,prepareState:function(t){return t},receiveState:function(t,r){return r}},Npe=function(){return{type:nk}},Fpe=function(){return{type:ik}},Bpe=function(t){return{type:ak,payload:t}},Upe=function(){return{type:Lpe}};function _d(){return Math.floor((1+Math.random())*65536).toString(16).substring(1)}function t$(){return""+_d()+_d()+"-"+_d()+"-"+_d()+"-"+_d()+"-"+_d()+_d()+_d()}var r$=Un.WINDOW_STATE_SYNC_ID=t$();function n$(e){var t=e;return t.$uuid=t$(),t.$wuid=r$,t}function i$(e){var t=e.predicate,r=e.blacklist,n=e.whitelist,i=function(){return!0};return t&&typeof t=="function"?i=t:Array.isArray(r)?i=function(o){return r.indexOf(o.type)<0}:Array.isArray(n)&&(i=function(o){return n.indexOf(o.type)>=0}),i}function jpe(e){return!!e.$isSync}function a$(e){var t=e.channel,r=e.dispatch,n=e.allowed,i=!1,a={};this.handleOnMessage=function(o){o.$wuid!==r$&&o.type!==ak&&o.$uuid&&o.$uuid!==PI&&(o.type===nk&&!a[o.$wuid]?(a[o.$wuid]=!0,r(Fpe())):o.type===ik&&!a[o.$wuid]?i||(i=!0,r(Bpe(o.payload))):n(o)&&(PI=o.$uuid,r(Object.assign(o,{$isSync:!0}))))},this.messageChannel=t,this.messageChannel.onmessage=this.handleOnMessage}rk=Un.createStateSyncMiddleware=function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:TI,r=i$(t),n=new Ope.BroadcastChannel(t.channel,t.broadcastChannelOption),i=t.prepareState||TI.prepareState,a=null;return function(o){var s=o.getState,u=o.dispatch;return function(l){return function(c){if(a||(a=new a$({channel:n,dispatch:u,allowed:r})),c&&!c.$uuid){var d=n$(c);PI=d.$uuid;try{if(c.type===ik)return s()&&(d.payload=i(s()),n.postMessage(d)),l(c);(r(d)||c.type===nk)&&n.postMessage(d)}catch{console.error("Your browser doesn't support cross tab communication")}}return l(Object.assign(c,{$isSync:typeof c.$isSync>"u"?!1:c.$isSync}))}}}};var zpe=Un.createReduxStateSync=function(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:TI.receiveState;return function(n,i){var a=n;return i.type===ak&&(a=r(n,i.payload)),t(a,i)}};Un.withReduxStateSync=zpe;Un.initStateWithPrevTab=function(t){var r=t.dispatch;r(Npe())};e$=Un.initMessageListener=function(t){var r=t.dispatch;r(Upe())};const Vpe={},o$=dfe({reducer:{appState:Tfe},middleware:e=>e().concat(_I).concat(rk(Vpe))});e$(o$);const qw=yhe;function Hpe(e){var s,u,l,c,d;let t="",r;e.comments&&Array.isArray(e.comments)&&(r=e.comments.find(f=>f.commentType==="SUBCELLULAR LOCATION")),r&&r.subcellularLocations&&Array.isArray(r.subcellularLocations)&&((s=r.subcellularLocations)==null?void 0:s.length)>0&&(t=((l=(u=r.subcellularLocations[0])==null?void 0:u.location)==null?void 0:l.value)??"");let n=[],i=[],a={name:"",synonyms:[]};return e.genes&&Array.isArray(e.genes)&&(n=e.genes[0].synonyms||[],i=n?n.map(f=>f.value):[],a={name:((d=(c=e==null?void 0:e.genes[0])==null?void 0:c.geneName)==null?void 0:d.value)??"",synonyms:i}),{primaryAccession:e.primaryAccession,id:e.uniProtkbId,organism_name:e.organism.scientificName,gene_names:a,cc_subcellular_location:t,length:e.sequence.length}}function Gpe(e){var r,n,i,a,o,s,u,l,c,d;return{id:(e==null?void 0:e.primaryAccession)??"",uniProtkbId:(e==null?void 0:e.uniProtkbId)??"",organism:((r=e==null?void 0:e.organism)==null?void 0:r.scientificName)??"",description:((a=(i=(n=e==null?void 0:e.proteinDescription)==null?void 0:n.recommendedName)==null?void 0:i.fullName)==null?void 0:a.value)??"",gene:((o=e==null?void 0:e.genes[0])==null?void 0:o.geneName.value)??"",length:((s=e==null?void 0:e.sequence)==null?void 0:s.length)??"",sequence:((u=e==null?void 0:e.sequence)==null?void 0:u.value)??"",lastUpdated:((l=e==null?void 0:e.entryAudit)==null?void 0:l.lastSequenceUpdateDate)??"",molWeight:((c=e==null?void 0:e.sequence)==null?void 0:c.molWeight)??"",checksum:((d=e==null?void 0:e.sequence)==null?void 0:d.crc64)??"",publications:[]}}const vp={API_HOST:"https://rest.uniprot.org/uniprotkb/",API_ITEMS_PER_PAGE:25,PUBMED_HOST:"https://pubmed.ncbi.nlm.nih.gov/",PMC_HOST:"https://europepmc.org/article/MED/",DOI_HOST:"https://dx.doi.org/"};function qpe(e){var a,o,s,u,l,c,d,f,h,v;let t;try{e.citation&&e.citation.citationCrossReferences&&(t=((a=e.citation.citationCrossReferences.find(p=>p.database==="PubMed"))==null?void 0:a.id)??"")}catch(p){console.error(p)}let r;try{e.citation&&e.citation.citationCrossReferences&&(r=((o=e.citation.citationCrossReferences.find(p=>p.database==="DOI"))==null?void 0:o.id)??"")}catch(p){console.error(p)}let n;n=e.references.map(p=>{var m;return{id:p.citationId??"",source:((m=p.source)==null?void 0:m.name)??"",categories:p.sourceCategories??"",positions:p.referencePositions??""}});let i;return i={id:((s=e.citation)==null?void 0:s.id)??"",authors:((u=e.citation)==null?void 0:u.authors)??"",title:((l=e.citation)==null?void 0:l.title)??"",journal:((c=e.citation)==null?void 0:c.journal)??"",volume:((d=e.citation)==null?void 0:d.volume)??"",firstPage:((f=e.citation)==null?void 0:f.firstPage)??"",lastPage:((h=e.citation)==null?void 0:h.lastPage)??"",publicationDate:((v=e.citation)==null?void 0:v.publicationDate)??"",references:n,pubMedId:t,doiId:r},i}const Wpe=async e=>{const t=new URL(`${vp.API_HOST}/${e}`);try{const r=await fetch(t,{method:"GET"});if(!r.ok)throw new Error(`Error retrieving data from API: ${r.statusText}`);const n=await r.json();return Gpe(n)}catch(r){throw r}},$pe=async e=>{const t=new URL(`${vp.API_HOST}/${e}/publications`);try{const r=await fetch(t,{method:"GET"});if(!r.ok)throw new Error(`Error retrieving data from API: ${r.statusText}`);return(await r.json()).results.map(qpe)}catch(r){throw r}},s$=async(e,t)=>{var r,n;try{const i=await fetch(e,{method:"GET"});if(!i.ok)throw new Error(`Error retrieving data from API: ${i.statusText}`);let a=((r=i==null?void 0:i.headers)==null?void 0:r.get("Link"))??"";a=a.split("; ")[0].replace(/^<|>$/g,"");let o=parseInt(((n=i==null?void 0:i.headers)==null?void 0:n.get("X-Total-Results"))??"");Number.isNaN(o)&&(o=-1);const l=(await i.json()).results.map(Hpe);return{searchString:t,totalResults:o,nextLink:a,items:l}}catch(i){throw i}},Xpe=async(e,t)=>{let r="";t.geneName&&(r+=` AND (gene:${t.geneName})`),t.sequenceLengthMin&&t.sequenceLengthMax&&(r+=" AND "+encodeURIComponent(`length:[${t.sequenceLengthMin} TO ${t.sequenceLengthMax}]`).replace(/%20/g,"+")),t.annotationScore&&(r+=` AND annotation_score:${t.annotationScore}`),t.proteinWith&&(r+=` AND proteins_with:${t.proteinWith}`);const n=new URL(`${vp.API_HOST}search?fields=accession,id,gene_names,organism_name,length,cc_subcellular_location&query=(${e}${r})&size=${vp.API_ITEMS_PER_PAGE}`);return s$(n,e)},Ype=async(e,t)=>s$(e,t),Kpe=(e,t)=>async r=>{try{const n=await Xpe(e,t);r(Efe(t)),r(_fe(n))}catch(n){n instanceof Error?console.error(`Error retrieving data: ${n.message}`):console.error("Unexpected error occurred:",n)}},Qpe=(e,t)=>async r=>{try{const n=await Ype(e,t);r(wfe(n))}catch(n){n instanceof Error?console.error(`Error retrieving data: ${n.message}`):console.error("Unexpected error occurred:",n)}},Zpe=e=>async t=>{try{const r=await Wpe(e);t(Afe(r))}catch(r){r instanceof Error?console.error(`Error retrieving protein data: ${r.message}`):console.error("Unexpected error occurred while obtaining protein data:",r)}},Jpe=e=>async t=>{try{const r=await $pe(e);t(Pfe({proteinId:e,publications:r}))}catch(r){r instanceof Error?console.error(`Error retrieving data: ${r.message}`):console.error("Unexpected error occurred:",r)}};const Ww=()=>T.jsx("div",{className:"loading-wrapper",children:T.jsx("div",{className:"loading"})}),eve=()=>{const e=Qc(),t=qw(),r=hg(s=>s.appState.searchResults),[n,i]=Ve.useState(!1),a=s=>{if(!s)return;const u=`/protein/${s}`;e(u)},o=s=>{if(s.currentTarget.scrollHeight-s.currentTarget.scrollTop<s.currentTarget.clientHeight+100&&!n&&r.items.length<r.totalResults){i(!0);const l=new URL(r.nextLink);t(Qpe(l,r.searchString)).finally(()=>{i(!1)})}};return T.jsx("div",{className:"protein-table-wrapper",onScroll:o,children:T.jsxs("table",{className:"protein-table",children:[T.jsx("thead",{className:"protein-table-header",children:T.jsxs("tr",{className:"protein-table-header-row",children:[T.jsx("th",{className:"protein-table-header-column",children:"#"}),T.jsx("th",{className:"protein-table-header-column",children:"Primary Accession"}),T.jsx("th",{className:"protein-table-header-column",children:"ID"}),T.jsx("th",{className:"protein-table-header-column",children:"Organism Name"}),T.jsx("th",{className:"protein-table-header-column",children:"Gene Names"}),T.jsx("th",{className:"protein-table-header-column",children:"Subcellular Location"}),T.jsx("th",{className:"protein-table-header-column",children:"Length"})]})}),T.jsxs("tbody",{children:[r.items.map((s,u)=>T.jsxs("tr",{children:[T.jsx("td",{className:"protein-table-content protein-table-column-generic",children:u+1}),T.jsx("td",{className:"protein-table-content protein-table-column-entry",children:T.jsx("span",{className:"protein-table-entry",onClick:()=>{a(s.primaryAccession)},children:s.primaryAccession})}),T.jsx("td",{className:"protein-table-content protein-table-column-generic",children:s.id}),T.jsx("td",{className:"protein-table-content",children:T.jsx("div",{"data-organism":s.organism_name,children:s.organism_name})}),T.jsxs("td",{className:"protein-table-content protein-table-column-generic",children:[T.jsx("span",{className:"protein-table-gene-main",children:s.gene_names.name}),s.gene_names.synonyms.length>0?", ":"",s.gene_names.synonyms.join(", ")]}),T.jsx("td",{className:"protein-table-content protein-table-column-generic",children:s.cc_subcellular_location}),T.jsx("td",{className:"protein-table-content protein-table-column-generic",children:s.length})]},s.primaryAccession)),n&&T.jsx("tr",{className:"protein-table-content-loading",children:T.jsx("td",{colSpan:7,children:T.jsx(Ww,{})})})]})]})})};const tve=({onApply:e,onClose:t})=>{const r=hg(S=>S.appState.searchFilters),[n,i]=Ve.useState(r.geneName),[a,o]=Ve.useState(r.sequenceLengthMin),[s,u]=Ve.useState(r.sequenceLengthMax),[l,c]=Ve.useState(r.annotationScore),[d,f]=Ve.useState(r.proteinWith),[h,v]=Ve.useState(""),p=()=>{if(a){const S=Number(a);if(!Number.isInteger(S)||S<0)return v("Sequence length must be positive integer value"),!0}if(s){const S=Number(s);if(!Number.isInteger(S)||S<0)return v("Sequence length must be positive integer value"),!0}if(a&&s){const S=Number(a);if(Number(s)<S)return v("Sequence length maximum value must be larger than minimum value"),!0}return a&&!s||!a&&s?(v("Both or none of min and max sequence length values must be populated"),!0):(v(""),!1)},m=Ve.useMemo(()=>p(),[n,a,s,l,d]),g=()=>{i(""),o(""),u(""),c(""),f("")},y=()=>{g(),e({geneName:"",sequenceLengthMin:"",sequenceLengthMax:"",annotationScore:"",proteinWith:""}),t()},b=()=>{e({geneName:n,sequenceLengthMin:a,sequenceLengthMax:s,annotationScore:l,proteinWith:d}),t()};return T.jsxs("div",{className:"search-filters-wrapper",children:[T.jsx("div",{className:"search-filters-title",children:"Filters"}),T.jsxs("div",{className:"search-filter-input-wrapper",children:[T.jsx("label",{htmlFor:"gene-name",className:"search-filters-label",children:"Gene Name"}),T.jsx("input",{type:"text",className:"search-filter-input",name:"gene-name",id:"gene-name",placeholder:"Enter Gene Name",value:n,onChange:S=>i(S.target.value)})]}),T.jsx("div",{className:"search-filter-input-wrapper search-item-tbd","tbd-item":"TBD: Organism Name - how do i get full list of options?"}),T.jsxs("div",{className:"search-filter-input-wrapper",children:[T.jsx("label",{htmlFor:"sequence-min",className:"search-filters-label",children:"Sequence Length"}),T.jsxs("div",{className:"search-filter-input-row-wrapper",children:[T.jsx("input",{type:"text",className:"search-filter-input",name:"sequence-min",id:"sequence-min",placeholder:"From",value:a,onChange:S=>o(S.target.value)}),T.jsx("span",{className:"search-filter-dash",children:"—"}),T.jsx("input",{type:"text",className:"search-filter-input",name:"sequence-max",id:"sequence-max",placeholder:"To",value:s,onChange:S=>u(S.target.value)})]})]}),T.jsxs("div",{className:"search-filter-input-wrapper",children:[T.jsx("label",{htmlFor:"annotation-score",className:"search-filters-label",children:"Annotation Score"}),T.jsxs("select",{className:"search-filter-input",name:"annotation-score",id:"annotation-score",placeholder:"Select an option",value:l,onChange:S=>c(S.target.value),children:[T.jsx("option",{value:""}),T.jsx("option",{value:"5",children:"5"}),T.jsx("option",{value:"4",children:"4"}),T.jsx("option",{value:"3",children:"3"}),T.jsx("option",{value:"2",children:"2"}),T.jsx("option",{value:"1",children:"1"})]})]}),T.jsxs("div",{className:"search-filter-input-wrapper search-item-tbd",children:[T.jsx("label",{htmlFor:"protein-with",className:"search-filters-label",children:"Protein With"}),T.jsx("input",{type:"text",className:"search-filter-input",name:"protein-with",id:"protein-with",placeholder:"Select",value:d,onChange:S=>f(S.target.value)})]}),T.jsx("div",{className:"search-filter-error-message",children:h}),T.jsxs("div",{className:"search-filter-input-row-wrapper",children:[T.jsx("button",{className:"form-button",onClick:y,children:"Clear"}),T.jsx("button",{className:"form-button",disabled:m,onClick:b,children:"Apply Filters"})]})]})},rve=()=>T.jsx("div",{className:"search-results-wrapper",children:T.jsxs("div",{className:"search-results-nodata-wrapper",children:[T.jsx("span",{className:"search-results-text",children:"No data to display"}),T.jsx("span",{className:"search-results-text",children:"Please start search to display results"})]})}),nve=()=>{const e=Qc(),t=qw(),r=hg(g=>g.appState.searchResults),n=hg(g=>g.appState.searchFilters),[i,a]=Ve.useState(""),[o,s]=Ve.useState(!1),[u]=Dde(),[l,c]=Ve.useState(!1);Ve.useEffect(()=>{const g=u.get("query"),y={geneName:u.get("geneName")||"",sequenceLengthMin:u.get("sequenceLengthMin")||"",sequenceLengthMax:u.get("sequenceLengthMax")||"",annotationScore:u.get("annotationScore")||"",proteinWith:u.get("proteinWith")||""};g&&(s(!0),a(decodeURIComponent(g)),t(Kpe(g,y)).finally(()=>{s(!1)}))},[u,t]);const d=g=>{const y=new URLSearchParams;let b="/search";i?y.append("query",encodeURIComponent(i)):y.append("query",encodeURIComponent("*"));let S=`${b}?${y.toString()}`;g&&(S=`${S}&${g}`),e(S)},f=()=>{m(n)},h=g=>{g.key==="Enter"&&m(n)},v=()=>o?T.jsx(Ww,{}):r.items.length===0?T.jsx(rve,{}):T.jsxs(T.Fragment,{children:[T.jsxs("div",{className:"search-results-count",children:[r.totalResults,` Search Results for "${decodeURIComponent(r.searchString)}"`]}),T.jsx(eve,{})]}),p=()=>{c(!l)},m=g=>{const y=Object.entries(g).filter(([b,S])=>b&&S).map(([b,S])=>`${encodeURIComponent(b)}=${encodeURIComponent(S)}`).join("&");d(y)};return T.jsxs(T.Fragment,{children:[T.jsx(zR,{}),T.jsxs("div",{className:"search-wrapper",children:[T.jsx("input",{type:"text",className:"search-input form-text-input",placeholder:"Enter search value",value:i,onChange:g=>a(g.target.value),onKeyDown:h}),T.jsx("button",{className:"search-button-search search-button",onClick:f,children:"Search"}),T.jsx("button",{className:"search-button-filters search-button"+(l?" search-filters-popup-opened":""),onClick:p,children:T.jsx("svg",{width:"22px",height:"18px",viewBox:"0 0 22 18",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:T.jsx("path",{d:"M7.2 10.8C8.87744 10.8 10.2869 11.9473 10.6866 13.5H20.7C21.197 13.5 21.6 13.903 21.6 14.4C21.6 14.8419 21.2816 15.2093 20.8618 15.2854L20.7 15.3L10.6861 15.3018C10.2858 16.8536 8.87679 18 7.2 18C5.52321 18 4.11417 16.8536 3.71389 15.3018L0.9 15.3C0.402948 15.3 0 14.897 0 14.4C0 13.9581 0.318384 13.5907 0.738216 13.5146L0.9 13.5H3.71342C4.11307 11.9473 5.52256 10.8 7.2 10.8ZM7.2 12.6C6.2059 12.6 5.4 13.4059 5.4 14.4C5.4 15.3941 6.2059 16.2 7.2 16.2C8.1941 16.2 9 15.3941 9 14.4C9 13.4059 8.1941 12.6 7.2 12.6ZM14.4 0C16.0774 0 17.487 1.14728 17.8866 2.69996L20.7 2.7C21.197 2.7 21.6 3.10295 21.6 3.6C21.6 4.04183 21.2816 4.4093 20.8618 4.48549L20.7 4.5L17.8861 4.50184C17.4859 6.05362 16.0769 7.2 14.4 7.2C12.7232 7.2 11.3142 6.05362 10.9139 4.50184L0.9 4.5C0.402948 4.5 0 4.09705 0 3.6C0 3.15817 0.318384 2.7907 0.738216 2.71451L0.9 2.7L10.9134 2.69996C11.3131 1.14728 12.7226 0 14.4 0ZM14.4 1.8C13.4059 1.8 12.6 2.6059 12.6 3.6C12.6 4.5941 13.4059 5.4 14.4 5.4C15.3941 5.4 16.2 4.5941 16.2 3.6C16.2 2.6059 15.3941 1.8 14.4 1.8Z"})})})]}),l&&T.jsx("div",{className:"search-filters-popup",children:T.jsx(tve,{onClose:p,onApply:m})}),v()]})};const ive=({proteinData:e})=>T.jsxs("div",{className:"protein-common-wrapper",children:[T.jsxs("div",{className:"protein-header-wrapper",children:[T.jsxs("div",{className:"protein-header",children:[e.id," / ",e.uniProtkbId]}),T.jsx("div",{className:"protein-organism","data-organism":e.organism,children:e.organism})]}),T.jsxs("div",{className:"protein-property",children:[T.jsx("div",{className:"protein-title",children:"Protein"}),T.jsx("div",{className:"protein-text",children:e.description})]}),T.jsxs("div",{className:"protein-property",children:[T.jsx("div",{className:"protein-title",children:"Gene"}),T.jsx("div",{className:"protein-text",children:e.gene})]})]});/*! clipboard-copy. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */var ave=uve;function ok(){return new DOMException("The request is not allowed","NotAllowedError")}async function ove(e){if(!navigator.clipboard)throw ok();return navigator.clipboard.writeText(e)}async function sve(e){const t=document.createElement("span");t.textContent=e,t.style.whiteSpace="pre",t.style.webkitUserSelect="auto",t.style.userSelect="all",document.body.appendChild(t);const r=window.getSelection(),n=window.document.createRange();r.removeAllRanges(),n.selectNode(t),r.addRange(n);let i=!1;try{i=window.document.execCommand("copy")}finally{r.removeAllRanges(),window.document.body.removeChild(t)}if(!i)throw ok()}async function uve(e){try{await ove(e)}catch(t){try{await sve(e)}catch(r){throw r||t||ok()}}}const lve=nH(ave),WF=({proteinData:e})=>{const[t,r]=Ve.useState(" Copy"),n=()=>{lve(e.sequence),r(" Copied!"),setTimeout(()=>r(" Copy"),2e3)};return T.jsxs("div",{className:"protein-details-wrapper",children:[T.jsx("div",{className:"protein-details-title",children:"Sequence"}),T.jsx("table",{className:"protein-property-table",children:T.jsxs("tbody",{children:[T.jsxs("tr",{children:[T.jsx("td",{children:T.jsxs("div",{className:"protein-property",children:[T.jsx("div",{className:"protein-title",children:"Length"}),T.jsx("div",{className:"protein-text",children:e.length})]})}),T.jsx("td",{children:T.jsxs("div",{className:"protein-property",children:[T.jsx("div",{className:"protein-title",children:"Last Updated"}),T.jsx("div",{className:"protein-text",children:e.lastUpdated})]})})]}),T.jsxs("tr",{children:[T.jsx("td",{children:T.jsxs("div",{className:"protein-property",children:[T.jsx("div",{className:"protein-title",children:"Mass (Da)"}),T.jsx("div",{className:"protein-text",children:e.molWeight})]})}),T.jsx("td",{children:T.jsxs("div",{className:"protein-property",children:[T.jsx("div",{className:"protein-title",children:"Checksum"}),T.jsx("div",{className:"protein-text",children:e.checksum})]})})]})]})}),T.jsx("div",{className:"protein-sequence-button-copy",children:T.jsxs("div",{className:"protein-sequence-button-copy-clickable",onClick:n,children:[T.jsx("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:T.jsx("path",{d:"M0 1.6C0 1.17565 0.168571 0.768687 0.468629 0.468629C0.768687 0.168571 1.17565 0 1.6 0H9.6C10.0243 0 10.4313 0.168571 10.7314 0.468629C11.0314 0.768687 11.2 1.17565 11.2 1.6V4.8H14.4C14.8243 4.8 15.2313 4.96857 15.5314 5.26863C15.8314 5.56869 16 5.97565 16 6.4V14.4C16 14.8243 15.8314 15.2313 15.5314 15.5314C15.2313 15.8314 14.8243 16 14.4 16H6.4C5.97565 16 5.56869 15.8314 5.26863 15.5314C4.96857 15.2313 4.8 14.8243 4.8 14.4V11.2H1.6C1.17565 11.2 0.768687 11.0314 0.468629 10.7314C0.168571 10.4313 0 10.0243 0 9.6V1.6ZM6.4 11.2V14.4H14.4V6.4H11.2V9.6C11.2 10.0243 11.0314 10.4313 10.7314 10.7314C10.4313 11.0314 10.0243 11.2 9.6 11.2H6.4ZM9.6 9.6V1.6H1.6V9.6H9.6Z",fill:"#0D0D0D"})}),t]})}),T.jsx("div",{className:"protein-sequence",children:e.sequence})]})};/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */const $F=typeof window<"u"&&window.customElements!=null&&window.customElements.polyfillWrapFlushCallback!==void 0,cve=(e,t,r=null,n=null)=>{for(;t!==r;){const i=t.nextSibling;e.insertBefore(t,n),t=i}},sk=(e,t,r=null)=>{for(;t!==r;){const n=t.nextSibling;e.removeChild(t),t=n}};/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */const vc=`{{lit-${String(Math.random()).slice(2)}}}`,u$=`<!--${vc}-->`,XF=new RegExp(`${vc}|${u$}`),ly="$lit$";class l${constructor(t,r){this.parts=[],this.element=r;const n=[],i=[],a=document.createTreeWalker(r.content,133,null,!1);let o=0,s=-1,u=0;const{strings:l,values:{length:c}}=t;for(;u<c;){const d=a.nextNode();if(d===null){a.currentNode=i.pop();continue}if(s++,d.nodeType===1){if(d.hasAttributes()){const f=d.attributes,{length:h}=f;let v=0;for(let p=0;p<h;p++)YF(f[p].name,ly)&&v++;for(;v-- >0;){const p=l[u],m=II.exec(p)[2],g=m.toLowerCase()+ly,y=d.getAttribute(g);d.removeAttribute(g);const b=y.split(XF);this.parts.push({type:"attribute",index:s,name:m,strings:b}),u+=b.length-1}}d.tagName==="TEMPLATE"&&(i.push(d),a.currentNode=d.content)}else if(d.nodeType===3){const f=d.data;if(f.indexOf(vc)>=0){const h=d.parentNode,v=f.split(XF),p=v.length-1;for(let m=0;m<p;m++){let g,y=v[m];if(y==="")g=Jd();else{const b=II.exec(y);b!==null&&YF(b[2],ly)&&(y=y.slice(0,b.index)+b[1]+b[2].slice(0,-ly.length)+b[3]),g=document.createTextNode(y)}h.insertBefore(g,d),this.parts.push({type:"node",index:++s})}v[p]===""?(h.insertBefore(Jd(),d),n.push(d)):d.data=v[p],u+=p}}else if(d.nodeType===8)if(d.data===vc){const f=d.parentNode;(d.previousSibling===null||s===o)&&(s++,f.insertBefore(Jd(),d)),o=s,this.parts.push({type:"node",index:s}),d.nextSibling===null?d.data="":(n.push(d),s--),u++}else{let f=-1;for(;(f=d.data.indexOf(vc,f+1))!==-1;)this.parts.push({type:"node",index:-1}),u++}}for(const d of n)d.parentNode.removeChild(d)}}const YF=(e,t)=>{const r=e.length-t.length;return r>=0&&e.slice(r)===t},c$=e=>e.index!==-1,Jd=()=>document.createComment(""),II=/([ \x09\x0a\x0c\x0d])([^\0-\x1F\x7F-\x9F "'>=/]+)([ \x09\x0a\x0c\x0d]*=[ \x09\x0a\x0c\x0d]*(?:[^ \x09\x0a\x0c\x0d"'`<>=]*|"[^"]*|'[^']*))$/;/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */const uk=133;function d$(e,t){const{element:{content:r},parts:n}=e,i=document.createTreeWalker(r,uk,null,!1);let a=Ly(n),o=n[a],s=-1,u=0;const l=[];let c=null;for(;i.nextNode();){s++;const d=i.currentNode;for(d.previousSibling===c&&(c=null),t.has(d)&&(l.push(d),c===null&&(c=d)),c!==null&&u++;o!==void 0&&o.index===s;)o.index=c!==null?-1:o.index-u,a=Ly(n,a),o=n[a]}l.forEach(d=>d.parentNode.removeChild(d))}const dve=e=>{let t=e.nodeType===11?0:1;const r=document.createTreeWalker(e,uk,null,!1);for(;r.nextNode();)t++;return t},Ly=(e,t=-1)=>{for(let r=t+1;r<e.length;r++){const n=e[r];if(c$(n))return r}return-1};function fve(e,t,r=null){const{element:{content:n},parts:i}=e;if(r==null){n.appendChild(t);return}const a=document.createTreeWalker(n,uk,null,!1);let o=Ly(i),s=0,u=-1;for(;a.nextNode();)for(u++,a.currentNode===r&&(s=dve(t),r.parentNode.insertBefore(t,r));o!==-1&&i[o].index===u;){if(s>0){for(;o!==-1;)i[o].index+=s,o=Ly(i,o);return}o=Ly(i,o)}}/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */const f$=new WeakMap,hve=e=>(...t)=>{const r=e(...t);return f$.set(r,!0),r},I1=e=>typeof e=="function"&&f$.has(e);/**
 * @license
 * Copyright (c) 2018 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */const vu={},KF={};/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class MI{constructor(t,r,n){this.__parts=[],this.template=t,this.processor=r,this.options=n}update(t){let r=0;for(const n of this.__parts)n!==void 0&&n.setValue(t[r]),r++;for(const n of this.__parts)n!==void 0&&n.commit()}_clone(){const t=$F?this.template.element.content.cloneNode(!0):document.importNode(this.template.element.content,!0),r=[],n=this.template.parts,i=document.createTreeWalker(t,133,null,!1);let a=0,o=0,s,u=i.nextNode();for(;a<n.length;){if(s=n[a],!c$(s)){this.__parts.push(void 0),a++;continue}for(;o<s.index;)o++,u.nodeName==="TEMPLATE"&&(r.push(u),i.currentNode=u.content),(u=i.nextNode())===null&&(i.currentNode=r.pop(),u=i.nextNode());if(s.type==="node"){const l=this.processor.handleTextExpression(this.options);l.insertAfterNode(u.previousSibling),this.__parts.push(l)}else this.__parts.push(...this.processor.handleAttributeExpressions(u,s.name,s.strings,this.options));a++}return $F&&(document.adoptNode(t),customElements.upgrade(t)),t}}/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */const QF=window.trustedTypes&&trustedTypes.createPolicy("lit-html",{createHTML:e=>e}),pve=` ${vc} `;class lk{constructor(t,r,n,i){this.strings=t,this.values=r,this.type=n,this.processor=i}getHTML(){const t=this.strings.length-1;let r="",n=!1;for(let i=0;i<t;i++){const a=this.strings[i],o=a.lastIndexOf("<!--");n=(o>-1||n)&&a.indexOf("-->",o+1)===-1;const s=II.exec(a);s===null?r+=a+(n?pve:u$):r+=a.substr(0,s.index)+s[1]+s[2]+ly+s[3]+vc}return r+=this.strings[t],r}getTemplateElement(){const t=document.createElement("template");let r=this.getHTML();return QF!==void 0&&(r=QF.createHTML(r)),t.innerHTML=r,t}}class vve extends lk{getHTML(){return`<svg>${super.getHTML()}</svg>`}getTemplateElement(){const t=super.getTemplateElement(),r=t.content,n=r.firstChild;return r.removeChild(n),cve(r,n.firstChild),t}}/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */const $w=e=>e===null||!(typeof e=="object"||typeof e=="function"),DI=e=>Array.isArray(e)||!!(e&&e[Symbol.iterator]);class h${constructor(t,r,n){this.dirty=!0,this.element=t,this.name=r,this.strings=n,this.parts=[];for(let i=0;i<n.length-1;i++)this.parts[i]=this._createPart()}_createPart(){return new p$(this)}_getValue(){const t=this.strings,r=t.length-1,n=this.parts;if(r===1&&t[0]===""&&t[1]===""){const a=n[0].value;if(typeof a=="symbol")return String(a);if(typeof a=="string"||!DI(a))return a}let i="";for(let a=0;a<r;a++){i+=t[a];const o=n[a];if(o!==void 0){const s=o.value;if($w(s)||!DI(s))i+=typeof s=="string"?s:String(s);else for(const u of s)i+=typeof u=="string"?u:String(u)}}return i+=t[r],i}commit(){this.dirty&&(this.dirty=!1,this.element.setAttribute(this.name,this._getValue()))}}class p${constructor(t){this.value=void 0,this.committer=t}setValue(t){t!==vu&&(!$w(t)||t!==this.value)&&(this.value=t,I1(t)||(this.committer.dirty=!0))}commit(){for(;I1(this.value);){const t=this.value;this.value=vu,t(this)}this.value!==vu&&this.committer.commit()}}class bb{constructor(t){this.value=void 0,this.__pendingValue=void 0,this.options=t}appendInto(t){this.startNode=t.appendChild(Jd()),this.endNode=t.appendChild(Jd())}insertAfterNode(t){this.startNode=t,this.endNode=t.nextSibling}appendIntoPart(t){t.__insert(this.startNode=Jd()),t.__insert(this.endNode=Jd())}insertAfterPart(t){t.__insert(this.startNode=Jd()),this.endNode=t.endNode,t.endNode=this.startNode}setValue(t){this.__pendingValue=t}commit(){if(this.startNode.parentNode===null)return;for(;I1(this.__pendingValue);){const r=this.__pendingValue;this.__pendingValue=vu,r(this)}const t=this.__pendingValue;t!==vu&&($w(t)?t!==this.value&&this.__commitText(t):t instanceof lk?this.__commitTemplateResult(t):t instanceof Node?this.__commitNode(t):DI(t)?this.__commitIterable(t):t===KF?(this.value=KF,this.clear()):this.__commitText(t))}__insert(t){this.endNode.parentNode.insertBefore(t,this.endNode)}__commitNode(t){this.value!==t&&(this.clear(),this.__insert(t),this.value=t)}__commitText(t){const r=this.startNode.nextSibling;t=t??"";const n=typeof t=="string"?t:String(t);r===this.endNode.previousSibling&&r.nodeType===3?r.data=n:this.__commitNode(document.createTextNode(n)),this.value=t}__commitTemplateResult(t){const r=this.options.templateFactory(t);if(this.value instanceof MI&&this.value.template===r)this.value.update(t.values);else{const n=new MI(r,t.processor,this.options),i=n._clone();n.update(t.values),this.__commitNode(i),this.value=n}}__commitIterable(t){Array.isArray(this.value)||(this.value=[],this.clear());const r=this.value;let n=0,i;for(const a of t)i=r[n],i===void 0&&(i=new bb(this.options),r.push(i),n===0?i.appendIntoPart(this):i.insertAfterPart(r[n-1])),i.setValue(a),i.commit(),n++;n<r.length&&(r.length=n,this.clear(i&&i.endNode))}clear(t=this.startNode){sk(this.startNode.parentNode,t.nextSibling,this.endNode)}}class mve{constructor(t,r,n){if(this.value=void 0,this.__pendingValue=void 0,n.length!==2||n[0]!==""||n[1]!=="")throw new Error("Boolean attributes can only contain a single expression");this.element=t,this.name=r,this.strings=n}setValue(t){this.__pendingValue=t}commit(){for(;I1(this.__pendingValue);){const r=this.__pendingValue;this.__pendingValue=vu,r(this)}if(this.__pendingValue===vu)return;const t=!!this.__pendingValue;this.value!==t&&(t?this.element.setAttribute(this.name,""):this.element.removeAttribute(this.name),this.value=t),this.__pendingValue=vu}}class gve extends h${constructor(t,r,n){super(t,r,n),this.single=n.length===2&&n[0]===""&&n[1]===""}_createPart(){return new yve(this)}_getValue(){return this.single?this.parts[0].value:super._getValue()}commit(){this.dirty&&(this.dirty=!1,this.element[this.name]=this._getValue())}}class yve extends p${}let v$=!1;(()=>{try{const e={get capture(){return v$=!0,!1}};window.addEventListener("test",e,e),window.removeEventListener("test",e,e)}catch{}})();class bve{constructor(t,r,n){this.value=void 0,this.__pendingValue=void 0,this.element=t,this.eventName=r,this.eventContext=n,this.__boundHandleEvent=i=>this.handleEvent(i)}setValue(t){this.__pendingValue=t}commit(){for(;I1(this.__pendingValue);){const a=this.__pendingValue;this.__pendingValue=vu,a(this)}if(this.__pendingValue===vu)return;const t=this.__pendingValue,r=this.value,n=t==null||r!=null&&(t.capture!==r.capture||t.once!==r.once||t.passive!==r.passive),i=t!=null&&(r==null||n);n&&this.element.removeEventListener(this.eventName,this.__boundHandleEvent,this.__options),i&&(this.__options=xve(t),this.element.addEventListener(this.eventName,this.__boundHandleEvent,this.__options)),this.value=t,this.__pendingValue=vu}handleEvent(t){typeof this.value=="function"?this.value.call(this.eventContext||this.element,t):this.value.handleEvent(t)}}const xve=e=>e&&(v$?{capture:e.capture,passive:e.passive,once:e.once}:e.capture);/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */function Sve(e){let t=M1.get(e.type);t===void 0&&(t={stringsArray:new WeakMap,keyString:new Map},M1.set(e.type,t));let r=t.stringsArray.get(e.strings);if(r!==void 0)return r;const n=e.strings.join(vc);return r=t.keyString.get(n),r===void 0&&(r=new l$(e,e.getTemplateElement()),t.keyString.set(n,r)),t.stringsArray.set(e.strings,r),r}const M1=new Map;/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */const Cm=new WeakMap,Cve=(e,t,r)=>{let n=Cm.get(t);n===void 0&&(sk(t,t.firstChild),Cm.set(t,n=new bb(Object.assign({templateFactory:Sve},r))),n.appendInto(t)),n.setValue(e),n.commit()};/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class _ve{handleAttributeExpressions(t,r,n,i){const a=r[0];return a==="."?new gve(t,r.slice(1),n).parts:a==="@"?[new bve(t,r.slice(1),i.eventContext)]:a==="?"?[new mve(t,r.slice(1),n)]:new h$(t,r,n).parts}handleTextExpression(t){return new bb(t)}}const m$=new _ve;/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */typeof window<"u"&&(window.litHtmlVersions||(window.litHtmlVersions=[])).push("1.4.1");const zr=(e,...t)=>new lk(e,t,"html",m$),RI=(e,...t)=>new vve(e,t,"svg",m$);/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */const g$=(e,t)=>`${e}--${t}`;let cC=!0;typeof window.ShadyCSS>"u"?cC=!1:typeof window.ShadyCSS.prepareTemplateDom>"u"&&(console.warn("Incompatible ShadyCSS version detected. Please update to at least @webcomponents/webcomponentsjs@2.0.2 and @webcomponents/shadycss@1.3.1."),cC=!1);const wve=e=>t=>{const r=g$(t.type,e);let n=M1.get(r);n===void 0&&(n={stringsArray:new WeakMap,keyString:new Map},M1.set(r,n));let i=n.stringsArray.get(t.strings);if(i!==void 0)return i;const a=t.strings.join(vc);if(i=n.keyString.get(a),i===void 0){const o=t.getTemplateElement();cC&&window.ShadyCSS.prepareTemplateDom(o,e),i=new l$(t,o),n.keyString.set(a,i)}return n.stringsArray.set(t.strings,i),i},Eve=["html","svg"],Ave=e=>{Eve.forEach(t=>{const r=M1.get(g$(t,e));r!==void 0&&r.keyString.forEach(n=>{const{element:{content:i}}=n,a=new Set;Array.from(i.querySelectorAll("style")).forEach(o=>{a.add(o)}),d$(n,a)})})},y$=new Set,Pve=(e,t,r)=>{y$.add(e);const n=r?r.element:document.createElement("template"),i=t.querySelectorAll("style"),{length:a}=i;if(a===0){window.ShadyCSS.prepareTemplateStyles(n,e);return}const o=document.createElement("style");for(let l=0;l<a;l++){const c=i[l];c.parentNode.removeChild(c),o.textContent+=c.textContent}Ave(e);const s=n.content;r?fve(r,o,s.firstChild):s.insertBefore(o,s.firstChild),window.ShadyCSS.prepareTemplateStyles(n,e);const u=s.querySelector("style");if(window.ShadyCSS.nativeShadow&&u!==null)t.insertBefore(u.cloneNode(!0),t.firstChild);else if(r){s.insertBefore(o,s.firstChild);const l=new Set;l.add(o),d$(r,l)}},Tve=(e,t,r)=>{if(!r||typeof r!="object"||!r.scopeName)throw new Error("The `scopeName` option is required.");const n=r.scopeName,i=Cm.has(t),a=cC&&t.nodeType===11&&!!t.host,o=a&&!y$.has(n),s=o?document.createDocumentFragment():t;if(Cve(e,s,Object.assign({templateFactory:wve(n)},r)),o){const u=Cm.get(s);Cm.delete(s);const l=u.value instanceof MI?u.value.template:void 0;Pve(n,s,l),sk(t,t.firstChild),t.appendChild(s),Cm.set(t,u)}!i&&a&&window.ShadyCSS.styleElement(t.host)};/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */var b$;window.JSCompiler_renameProperty=(e,t)=>e;const kI={toAttribute(e,t){switch(t){case Boolean:return e?"":null;case Object:case Array:return e==null?e:JSON.stringify(e)}return e},fromAttribute(e,t){switch(t){case Boolean:return e!==null;case Number:return e===null?null:Number(e);case Object:case Array:return JSON.parse(e)}return e}},x$=(e,t)=>t!==e&&(t===t||e===e),IA={attribute:!0,type:String,converter:kI,reflect:!1,hasChanged:x$},MA=1,DA=1<<2,RA=1<<3,kA=1<<4,OI="finalized";class S$ extends HTMLElement{constructor(){super(),this.initialize()}static get observedAttributes(){this.finalize();const t=[];return this._classProperties.forEach((r,n)=>{const i=this._attributeNameForProperty(n,r);i!==void 0&&(this._attributeToPropertyMap.set(i,n),t.push(i))}),t}static _ensureClassProperties(){if(!this.hasOwnProperty(JSCompiler_renameProperty("_classProperties",this))){this._classProperties=new Map;const t=Object.getPrototypeOf(this)._classProperties;t!==void 0&&t.forEach((r,n)=>this._classProperties.set(n,r))}}static createProperty(t,r=IA){if(this._ensureClassProperties(),this._classProperties.set(t,r),r.noAccessor||this.prototype.hasOwnProperty(t))return;const n=typeof t=="symbol"?Symbol():`__${t}`,i=this.getPropertyDescriptor(t,n,r);i!==void 0&&Object.defineProperty(this.prototype,t,i)}static getPropertyDescriptor(t,r,n){return{get(){return this[r]},set(i){const a=this[t];this[r]=i,this.requestUpdateInternal(t,a,n)},configurable:!0,enumerable:!0}}static getPropertyOptions(t){return this._classProperties&&this._classProperties.get(t)||IA}static finalize(){const t=Object.getPrototypeOf(this);if(t.hasOwnProperty(OI)||t.finalize(),this[OI]=!0,this._ensureClassProperties(),this._attributeToPropertyMap=new Map,this.hasOwnProperty(JSCompiler_renameProperty("properties",this))){const r=this.properties,n=[...Object.getOwnPropertyNames(r),...typeof Object.getOwnPropertySymbols=="function"?Object.getOwnPropertySymbols(r):[]];for(const i of n)this.createProperty(i,r[i])}}static _attributeNameForProperty(t,r){const n=r.attribute;return n===!1?void 0:typeof n=="string"?n:typeof t=="string"?t.toLowerCase():void 0}static _valueHasChanged(t,r,n=x$){return n(t,r)}static _propertyValueFromAttribute(t,r){const n=r.type,i=r.converter||kI,a=typeof i=="function"?i:i.fromAttribute;return a?a(t,n):t}static _propertyValueToAttribute(t,r){if(r.reflect===void 0)return;const n=r.type,i=r.converter;return(i&&i.toAttribute||kI.toAttribute)(t,n)}initialize(){this._updateState=0,this._updatePromise=new Promise(t=>this._enableUpdatingResolver=t),this._changedProperties=new Map,this._saveInstanceProperties(),this.requestUpdateInternal()}_saveInstanceProperties(){this.constructor._classProperties.forEach((t,r)=>{if(this.hasOwnProperty(r)){const n=this[r];delete this[r],this._instanceProperties||(this._instanceProperties=new Map),this._instanceProperties.set(r,n)}})}_applyInstanceProperties(){this._instanceProperties.forEach((t,r)=>this[r]=t),this._instanceProperties=void 0}connectedCallback(){this.enableUpdating()}enableUpdating(){this._enableUpdatingResolver!==void 0&&(this._enableUpdatingResolver(),this._enableUpdatingResolver=void 0)}disconnectedCallback(){}attributeChangedCallback(t,r,n){r!==n&&this._attributeToProperty(t,n)}_propertyToAttribute(t,r,n=IA){const i=this.constructor,a=i._attributeNameForProperty(t,n);if(a!==void 0){const o=i._propertyValueToAttribute(r,n);if(o===void 0)return;this._updateState=this._updateState|RA,o==null?this.removeAttribute(a):this.setAttribute(a,o),this._updateState=this._updateState&~RA}}_attributeToProperty(t,r){if(this._updateState&RA)return;const n=this.constructor,i=n._attributeToPropertyMap.get(t);if(i!==void 0){const a=n.getPropertyOptions(i);this._updateState=this._updateState|kA,this[i]=n._propertyValueFromAttribute(r,a),this._updateState=this._updateState&~kA}}requestUpdateInternal(t,r,n){let i=!0;if(t!==void 0){const a=this.constructor;n=n||a.getPropertyOptions(t),a._valueHasChanged(this[t],r,n.hasChanged)?(this._changedProperties.has(t)||this._changedProperties.set(t,r),n.reflect===!0&&!(this._updateState&kA)&&(this._reflectingProperties===void 0&&(this._reflectingProperties=new Map),this._reflectingProperties.set(t,n))):i=!1}!this._hasRequestedUpdate&&i&&(this._updatePromise=this._enqueueUpdate())}requestUpdate(t,r){return this.requestUpdateInternal(t,r),this.updateComplete}async _enqueueUpdate(){this._updateState=this._updateState|DA;try{await this._updatePromise}catch{}const t=this.performUpdate();return t!=null&&await t,!this._hasRequestedUpdate}get _hasRequestedUpdate(){return this._updateState&DA}get hasUpdated(){return this._updateState&MA}performUpdate(){if(!this._hasRequestedUpdate)return;this._instanceProperties&&this._applyInstanceProperties();let t=!1;const r=this._changedProperties;try{t=this.shouldUpdate(r),t?this.update(r):this._markUpdated()}catch(n){throw t=!1,this._markUpdated(),n}t&&(this._updateState&MA||(this._updateState=this._updateState|MA,this.firstUpdated(r)),this.updated(r))}_markUpdated(){this._changedProperties=new Map,this._updateState=this._updateState&~DA}get updateComplete(){return this._getUpdateComplete()}_getUpdateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._updatePromise}shouldUpdate(t){return!0}update(t){this._reflectingProperties!==void 0&&this._reflectingProperties.size>0&&(this._reflectingProperties.forEach((r,n)=>this._propertyToAttribute(n,this[n],r)),this._reflectingProperties=void 0),this._markUpdated()}updated(t){}firstUpdated(t){}}b$=OI;S$[b$]=!0;/**
@license
Copyright (c) 2019 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at
http://polymer.github.io/LICENSE.txt The complete set of authors may be found at
http://polymer.github.io/AUTHORS.txt The complete set of contributors may be
found at http://polymer.github.io/CONTRIBUTORS.txt Code distributed by Google as
part of the polymer project is also subject to an additional IP rights grant
found at http://polymer.github.io/PATENTS.txt
*/const LI=window.ShadowRoot&&(window.ShadyCSS===void 0||window.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,ck=Symbol();class dk{constructor(t,r){if(r!==ck)throw new Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=t}get styleSheet(){return this._styleSheet===void 0&&(LI?(this._styleSheet=new CSSStyleSheet,this._styleSheet.replaceSync(this.cssText)):this._styleSheet=null),this._styleSheet}toString(){return this.cssText}}const Ive=e=>new dk(String(e),ck),Mve=e=>{if(e instanceof dk)return e.cssText;if(typeof e=="number")return e;throw new Error(`Value passed to 'css' function must be a 'css' function result: ${e}. Use 'unsafeCSS' to pass non-literal values, but
            take care to ensure page security.`)},zs=(e,...t)=>{const r=t.reduce((n,i,a)=>n+Mve(i)+e[a+1],e[0]);return new dk(r,ck)};/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */(window.litElementVersions||(window.litElementVersions=[])).push("2.5.1");const ZF={};class sh extends S${static getStyles(){return this.styles}static _getUniqueStyles(){if(this.hasOwnProperty(JSCompiler_renameProperty("_styles",this)))return;const t=this.getStyles();if(Array.isArray(t)){const r=(a,o)=>a.reduceRight((s,u)=>Array.isArray(u)?r(u,s):(s.add(u),s),o),n=r(t,new Set),i=[];n.forEach(a=>i.unshift(a)),this._styles=i}else this._styles=t===void 0?[]:[t];this._styles=this._styles.map(r=>{if(r instanceof CSSStyleSheet&&!LI){const n=Array.prototype.slice.call(r.cssRules).reduce((i,a)=>i+a.cssText,"");return Ive(n)}return r})}initialize(){super.initialize(),this.constructor._getUniqueStyles(),this.renderRoot=this.createRenderRoot(),window.ShadowRoot&&this.renderRoot instanceof window.ShadowRoot&&this.adoptStyles()}createRenderRoot(){return this.attachShadow(this.constructor.shadowRootOptions)}adoptStyles(){const t=this.constructor._styles;t.length!==0&&(window.ShadyCSS!==void 0&&!window.ShadyCSS.nativeShadow?window.ShadyCSS.ScopingShim.prepareAdoptedCssText(t.map(r=>r.cssText),this.localName):LI?this.renderRoot.adoptedStyleSheets=t.map(r=>r instanceof CSSStyleSheet?r:r.styleSheet):this._needsShimAdoptedStyleSheets=!0)}connectedCallback(){super.connectedCallback(),this.hasUpdated&&window.ShadyCSS!==void 0&&window.ShadyCSS.styleElement(this)}update(t){const r=this.render();super.update(t),r!==ZF&&this.constructor.render(r,this.renderRoot,{scopeName:this.localName,eventContext:this}),this._needsShimAdoptedStyleSheets&&(this._needsShimAdoptedStyleSheets=!1,this.constructor._styles.forEach(n=>{const i=document.createElement("style");i.textContent=n.cssText,this.renderRoot.appendChild(i)}))}render(){return ZF}}sh.finalized=!0;sh.render=Tve;sh.shadowRootOptions={mode:"open"};/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */const JF=new WeakMap,NI=hve(e=>t=>{if(!(t instanceof bb))throw new Error("unsafeHTML can only be used in text bindings");const r=JF.get(t);if(r!==void 0&&$w(e)&&e===r.value&&t.value===r.fragment)return;const n=document.createElement("template");n.innerHTML=e;const i=document.importNode(n.content,!0);t.setValue(i),JF.set(t,{value:e,fragment:i})});var Dve=function(e){return new Promise(function(t){return setTimeout(function(){return t()},e)})},FI="node";typeof importScripts<"u"?FI="worker":typeof window<"u"&&(FI="browser");var Rve=FI,C$=function(){return Dve(0)};Rve==="browser"&&"requestAnimationFrame"in window&&(C$=function(){return new Promise(function(e){return window.requestAnimationFrame(function(){return e()})})});var kve=C$,Ove=kve;function _$(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function Lve(e){return e.length===1&&(e=Nve(e)),{left:function(t,r,n,i){for(n==null&&(n=0),i==null&&(i=t.length);n<i;){var a=n+i>>>1;e(t[a],r)<0?n=a+1:i=a}return n},right:function(t,r,n,i){for(n==null&&(n=0),i==null&&(i=t.length);n<i;){var a=n+i>>>1;e(t[a],r)>0?i=a:n=a+1}return n}}}function Nve(e){return function(t,r){return _$(e(t),r)}}var Fve=Lve(_$),Bve=Fve.right;function Uve(e,t,r){e=+e,t=+t,r=(i=arguments.length)<2?(t=e,e=0,1):i<3?1:+r;for(var n=-1,i=Math.max(0,Math.ceil((t-e)/r))|0,a=new Array(i);++n<i;)a[n]=e+n*r;return a}var BI=Math.sqrt(50),UI=Math.sqrt(10),jI=Math.sqrt(2);function jve(e,t,r){var n,i=-1,a,o,s;if(t=+t,e=+e,r=+r,e===t&&r>0)return[e];if((n=t<e)&&(a=e,e=t,t=a),(s=tS(e,t,r))===0||!isFinite(s))return[];if(s>0)for(e=Math.ceil(e/s),t=Math.floor(t/s),o=new Array(a=Math.ceil(t-e+1));++i<a;)o[i]=(e+i)*s;else for(e=Math.floor(e*s),t=Math.ceil(t*s),o=new Array(a=Math.ceil(e-t+1));++i<a;)o[i]=(e-i)/s;return n&&o.reverse(),o}function tS(e,t,r){var n=(t-e)/Math.max(0,r),i=Math.floor(Math.log(n)/Math.LN10),a=n/Math.pow(10,i);return i>=0?(a>=BI?10:a>=UI?5:a>=jI?2:1)*Math.pow(10,i):-Math.pow(10,-i)/(a>=BI?10:a>=UI?5:a>=jI?2:1)}function zve(e,t,r){var n=Math.abs(t-e)/Math.max(0,r),i=Math.pow(10,Math.floor(Math.log(n)/Math.LN10)),a=n/i;return a>=BI?i*=10:a>=UI?i*=5:a>=jI&&(i*=2),t<e?-i:i}function eB(e,t){var r=e.length,n=-1,i,a;if(t==null){for(;++n<r;)if((i=e[n])!=null&&i>=i)for(a=i;++n<r;)(i=e[n])!=null&&i>a&&(a=i)}else for(;++n<r;)if((i=t(e[n],n,e))!=null&&i>=i)for(a=i;++n<r;)(i=t(e[n],n,e))!=null&&i>a&&(a=i);return a}var OA=Array.prototype.slice;function Vve(e){return e}var LA=1,rS=2,zI=3,cy=4,tB=1e-6;function Hve(e){return"translate("+(e+.5)+",0)"}function Gve(e){return"translate(0,"+(e+.5)+")"}function qve(e){return function(t){return+e(t)}}function Wve(e){var t=Math.max(0,e.bandwidth()-1)/2;return e.round()&&(t=Math.round(t)),function(r){return+e(r)+t}}function $ve(){return!this.__axis}function fk(e,t){var r=[],n=null,i=null,a=6,o=6,s=3,u=e===LA||e===cy?-1:1,l=e===cy||e===rS?"x":"y",c=e===LA||e===zI?Hve:Gve;function d(f){var h=n??(t.ticks?t.ticks.apply(t,r):t.domain()),v=i??(t.tickFormat?t.tickFormat.apply(t,r):Vve),p=Math.max(a,0)+s,m=t.range(),g=+m[0]+.5,y=+m[m.length-1]+.5,b=(t.bandwidth?Wve:qve)(t.copy()),S=f.selection?f.selection():f,x=S.selectAll(".domain").data([null]),C=S.selectAll(".tick").data(h,t).order(),w=C.exit(),A=C.enter().append("g").attr("class","tick"),M=C.select("line"),D=C.select("text");x=x.merge(x.enter().insert("path",".tick").attr("class","domain").attr("stroke","currentColor")),C=C.merge(A),M=M.merge(A.append("line").attr("stroke","currentColor").attr(l+"2",u*a)),D=D.merge(A.append("text").attr("fill","currentColor").attr(l,u*p).attr("dy",e===LA?"0em":e===zI?"0.71em":"0.32em")),f!==S&&(x=x.transition(f),C=C.transition(f),M=M.transition(f),D=D.transition(f),w=w.transition(f).attr("opacity",tB).attr("transform",function(k){return isFinite(k=b(k))?c(k):this.getAttribute("transform")}),A.attr("opacity",tB).attr("transform",function(k){var R=this.parentNode.__axis;return c(R&&isFinite(R=R(k))?R:b(k))})),w.remove(),x.attr("d",e===cy||e==rS?o?"M"+u*o+","+g+"H0.5V"+y+"H"+u*o:"M0.5,"+g+"V"+y:o?"M"+g+","+u*o+"V0.5H"+y+"V"+u*o:"M"+g+",0.5H"+y),C.attr("opacity",1).attr("transform",function(k){return c(b(k))}),M.attr(l+"2",u*a),D.attr(l,u*p).text(v),S.filter($ve).attr("fill","none").attr("font-size",10).attr("font-family","sans-serif").attr("text-anchor",e===rS?"start":e===cy?"end":"middle"),S.each(function(){this.__axis=b})}return d.scale=function(f){return arguments.length?(t=f,d):t},d.ticks=function(){return r=OA.call(arguments),d},d.tickArguments=function(f){return arguments.length?(r=f==null?[]:OA.call(f),d):r.slice()},d.tickValues=function(f){return arguments.length?(n=f==null?null:OA.call(f),d):n&&n.slice()},d.tickFormat=function(f){return arguments.length?(i=f,d):i},d.tickSize=function(f){return arguments.length?(a=o=+f,d):a},d.tickSizeInner=function(f){return arguments.length?(a=+f,d):a},d.tickSizeOuter=function(f){return arguments.length?(o=+f,d):o},d.tickPadding=function(f){return arguments.length?(s=+f,d):s},d}function Xve(e){return fk(rS,e)}function w$(e){return fk(zI,e)}function Yve(e){return fk(cy,e)}var Kve={value:function(){}};function Xw(){for(var e=0,t=arguments.length,r={},n;e<t;++e){if(!(n=arguments[e]+"")||n in r||/[\s.]/.test(n))throw new Error("illegal type: "+n);r[n]=[]}return new nS(r)}function nS(e){this._=e}function Qve(e,t){return e.trim().split(/^|\s+/).map(function(r){var n="",i=r.indexOf(".");if(i>=0&&(n=r.slice(i+1),r=r.slice(0,i)),r&&!t.hasOwnProperty(r))throw new Error("unknown type: "+r);return{type:r,name:n}})}nS.prototype=Xw.prototype={constructor:nS,on:function(e,t){var r=this._,n=Qve(e+"",r),i,a=-1,o=n.length;if(arguments.length<2){for(;++a<o;)if((i=(e=n[a]).type)&&(i=Zve(r[i],e.name)))return i;return}if(t!=null&&typeof t!="function")throw new Error("invalid callback: "+t);for(;++a<o;)if(i=(e=n[a]).type)r[i]=rB(r[i],e.name,t);else if(t==null)for(i in r)r[i]=rB(r[i],e.name,null);return this},copy:function(){var e={},t=this._;for(var r in t)e[r]=t[r].slice();return new nS(e)},call:function(e,t){if((i=arguments.length-2)>0)for(var r=new Array(i),n=0,i,a;n<i;++n)r[n]=arguments[n+2];if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(a=this._[e],n=0,i=a.length;n<i;++n)a[n].value.apply(t,r)},apply:function(e,t,r){if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(var n=this._[e],i=0,a=n.length;i<a;++i)n[i].value.apply(t,r)}};function Zve(e,t){for(var r=0,n=e.length,i;r<n;++r)if((i=e[r]).name===t)return i.value}function rB(e,t,r){for(var n=0,i=e.length;n<i;++n)if(e[n].name===t){e[n]=Kve,e=e.slice(0,n).concat(e.slice(n+1));break}return r!=null&&e.push({name:t,value:r}),e}var VI="http://www.w3.org/1999/xhtml";const nB={svg:"http://www.w3.org/2000/svg",xhtml:VI,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function Yw(e){var t=e+="",r=t.indexOf(":");return r>=0&&(t=e.slice(0,r))!=="xmlns"&&(e=e.slice(r+1)),nB.hasOwnProperty(t)?{space:nB[t],local:e}:e}function Jve(e){return function(){var t=this.ownerDocument,r=this.namespaceURI;return r===VI&&t.documentElement.namespaceURI===VI?t.createElement(e):t.createElementNS(r,e)}}function eme(e){return function(){return this.ownerDocument.createElementNS(e.space,e.local)}}function E$(e){var t=Yw(e);return(t.local?eme:Jve)(t)}function tme(){}function hk(e){return e==null?tme:function(){return this.querySelector(e)}}function rme(e){typeof e!="function"&&(e=hk(e));for(var t=this._groups,r=t.length,n=new Array(r),i=0;i<r;++i)for(var a=t[i],o=a.length,s=n[i]=new Array(o),u,l,c=0;c<o;++c)(u=a[c])&&(l=e.call(u,u.__data__,c,a))&&("__data__"in u&&(l.__data__=u.__data__),s[c]=l);return new qo(n,this._parents)}function nme(){return[]}function A$(e){return e==null?nme:function(){return this.querySelectorAll(e)}}function ime(e){typeof e!="function"&&(e=A$(e));for(var t=this._groups,r=t.length,n=[],i=[],a=0;a<r;++a)for(var o=t[a],s=o.length,u,l=0;l<s;++l)(u=o[l])&&(n.push(e.call(u,u.__data__,l,o)),i.push(u));return new qo(n,i)}function P$(e){return function(){return this.matches(e)}}function ame(e){typeof e!="function"&&(e=P$(e));for(var t=this._groups,r=t.length,n=new Array(r),i=0;i<r;++i)for(var a=t[i],o=a.length,s=n[i]=[],u,l=0;l<o;++l)(u=a[l])&&e.call(u,u.__data__,l,a)&&s.push(u);return new qo(n,this._parents)}function T$(e){return new Array(e.length)}function ome(){return new qo(this._enter||this._groups.map(T$),this._parents)}function dC(e,t){this.ownerDocument=e.ownerDocument,this.namespaceURI=e.namespaceURI,this._next=null,this._parent=e,this.__data__=t}dC.prototype={constructor:dC,appendChild:function(e){return this._parent.insertBefore(e,this._next)},insertBefore:function(e,t){return this._parent.insertBefore(e,t)},querySelector:function(e){return this._parent.querySelector(e)},querySelectorAll:function(e){return this._parent.querySelectorAll(e)}};function sme(e){return function(){return e}}var iB="$";function ume(e,t,r,n,i,a){for(var o=0,s,u=t.length,l=a.length;o<l;++o)(s=t[o])?(s.__data__=a[o],n[o]=s):r[o]=new dC(e,a[o]);for(;o<u;++o)(s=t[o])&&(i[o]=s)}function lme(e,t,r,n,i,a,o){var s,u,l={},c=t.length,d=a.length,f=new Array(c),h;for(s=0;s<c;++s)(u=t[s])&&(f[s]=h=iB+o.call(u,u.__data__,s,t),h in l?i[s]=u:l[h]=u);for(s=0;s<d;++s)h=iB+o.call(e,a[s],s,a),(u=l[h])?(n[s]=u,u.__data__=a[s],l[h]=null):r[s]=new dC(e,a[s]);for(s=0;s<c;++s)(u=t[s])&&l[f[s]]===u&&(i[s]=u)}function cme(e,t){if(!e)return h=new Array(this.size()),l=-1,this.each(function(C){h[++l]=C}),h;var r=t?lme:ume,n=this._parents,i=this._groups;typeof e!="function"&&(e=sme(e));for(var a=i.length,o=new Array(a),s=new Array(a),u=new Array(a),l=0;l<a;++l){var c=n[l],d=i[l],f=d.length,h=e.call(c,c&&c.__data__,l,n),v=h.length,p=s[l]=new Array(v),m=o[l]=new Array(v),g=u[l]=new Array(f);r(c,d,p,m,g,h,t);for(var y=0,b=0,S,x;y<v;++y)if(S=p[y]){for(y>=b&&(b=y+1);!(x=m[b])&&++b<v;);S._next=x||null}}return o=new qo(o,n),o._enter=s,o._exit=u,o}function dme(){return new qo(this._exit||this._groups.map(T$),this._parents)}function fme(e,t,r){var n=this.enter(),i=this,a=this.exit();return n=typeof e=="function"?e(n):n.append(e+""),t!=null&&(i=t(i)),r==null?a.remove():r(a),n&&i?n.merge(i).order():i}function hme(e){for(var t=this._groups,r=e._groups,n=t.length,i=r.length,a=Math.min(n,i),o=new Array(n),s=0;s<a;++s)for(var u=t[s],l=r[s],c=u.length,d=o[s]=new Array(c),f,h=0;h<c;++h)(f=u[h]||l[h])&&(d[h]=f);for(;s<n;++s)o[s]=t[s];return new qo(o,this._parents)}function pme(){for(var e=this._groups,t=-1,r=e.length;++t<r;)for(var n=e[t],i=n.length-1,a=n[i],o;--i>=0;)(o=n[i])&&(a&&o.compareDocumentPosition(a)^4&&a.parentNode.insertBefore(o,a),a=o);return this}function vme(e){e||(e=mme);function t(d,f){return d&&f?e(d.__data__,f.__data__):!d-!f}for(var r=this._groups,n=r.length,i=new Array(n),a=0;a<n;++a){for(var o=r[a],s=o.length,u=i[a]=new Array(s),l,c=0;c<s;++c)(l=o[c])&&(u[c]=l);u.sort(t)}return new qo(i,this._parents).order()}function mme(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function gme(){var e=arguments[0];return arguments[0]=this,e.apply(null,arguments),this}function yme(){var e=new Array(this.size()),t=-1;return this.each(function(){e[++t]=this}),e}function bme(){for(var e=this._groups,t=0,r=e.length;t<r;++t)for(var n=e[t],i=0,a=n.length;i<a;++i){var o=n[i];if(o)return o}return null}function xme(){var e=0;return this.each(function(){++e}),e}function Sme(){return!this.node()}function Cme(e){for(var t=this._groups,r=0,n=t.length;r<n;++r)for(var i=t[r],a=0,o=i.length,s;a<o;++a)(s=i[a])&&e.call(s,s.__data__,a,i);return this}function _me(e){return function(){this.removeAttribute(e)}}function wme(e){return function(){this.removeAttributeNS(e.space,e.local)}}function Eme(e,t){return function(){this.setAttribute(e,t)}}function Ame(e,t){return function(){this.setAttributeNS(e.space,e.local,t)}}function Pme(e,t){return function(){var r=t.apply(this,arguments);r==null?this.removeAttribute(e):this.setAttribute(e,r)}}function Tme(e,t){return function(){var r=t.apply(this,arguments);r==null?this.removeAttributeNS(e.space,e.local):this.setAttributeNS(e.space,e.local,r)}}function Ime(e,t){var r=Yw(e);if(arguments.length<2){var n=this.node();return r.local?n.getAttributeNS(r.space,r.local):n.getAttribute(r)}return this.each((t==null?r.local?wme:_me:typeof t=="function"?r.local?Tme:Pme:r.local?Ame:Eme)(r,t))}function I$(e){return e.ownerDocument&&e.ownerDocument.defaultView||e.document&&e||e.defaultView}function Mme(e){return function(){this.style.removeProperty(e)}}function Dme(e,t,r){return function(){this.style.setProperty(e,t,r)}}function Rme(e,t,r){return function(){var n=t.apply(this,arguments);n==null?this.style.removeProperty(e):this.style.setProperty(e,n,r)}}function kme(e,t,r){return arguments.length>1?this.each((t==null?Mme:typeof t=="function"?Rme:Dme)(e,t,r??"")):pg(this.node(),e)}function pg(e,t){return e.style.getPropertyValue(t)||I$(e).getComputedStyle(e,null).getPropertyValue(t)}function Ome(e){return function(){delete this[e]}}function Lme(e,t){return function(){this[e]=t}}function Nme(e,t){return function(){var r=t.apply(this,arguments);r==null?delete this[e]:this[e]=r}}function Fme(e,t){return arguments.length>1?this.each((t==null?Ome:typeof t=="function"?Nme:Lme)(e,t)):this.node()[e]}function M$(e){return e.trim().split(/^|\s+/)}function pk(e){return e.classList||new D$(e)}function D$(e){this._node=e,this._names=M$(e.getAttribute("class")||"")}D$.prototype={add:function(e){var t=this._names.indexOf(e);t<0&&(this._names.push(e),this._node.setAttribute("class",this._names.join(" ")))},remove:function(e){var t=this._names.indexOf(e);t>=0&&(this._names.splice(t,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(e){return this._names.indexOf(e)>=0}};function R$(e,t){for(var r=pk(e),n=-1,i=t.length;++n<i;)r.add(t[n])}function k$(e,t){for(var r=pk(e),n=-1,i=t.length;++n<i;)r.remove(t[n])}function Bme(e){return function(){R$(this,e)}}function Ume(e){return function(){k$(this,e)}}function jme(e,t){return function(){(t.apply(this,arguments)?R$:k$)(this,e)}}function zme(e,t){var r=M$(e+"");if(arguments.length<2){for(var n=pk(this.node()),i=-1,a=r.length;++i<a;)if(!n.contains(r[i]))return!1;return!0}return this.each((typeof t=="function"?jme:t?Bme:Ume)(r,t))}function Vme(){this.textContent=""}function Hme(e){return function(){this.textContent=e}}function Gme(e){return function(){var t=e.apply(this,arguments);this.textContent=t??""}}function qme(e){return arguments.length?this.each(e==null?Vme:(typeof e=="function"?Gme:Hme)(e)):this.node().textContent}function Wme(){this.innerHTML=""}function $me(e){return function(){this.innerHTML=e}}function Xme(e){return function(){var t=e.apply(this,arguments);this.innerHTML=t??""}}function Yme(e){return arguments.length?this.each(e==null?Wme:(typeof e=="function"?Xme:$me)(e)):this.node().innerHTML}function Kme(){this.nextSibling&&this.parentNode.appendChild(this)}function Qme(){return this.each(Kme)}function Zme(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function Jme(){return this.each(Zme)}function ege(e){var t=typeof e=="function"?e:E$(e);return this.select(function(){return this.appendChild(t.apply(this,arguments))})}function tge(){return null}function rge(e,t){var r=typeof e=="function"?e:E$(e),n=t==null?tge:typeof t=="function"?t:hk(t);return this.select(function(){return this.insertBefore(r.apply(this,arguments),n.apply(this,arguments)||null)})}function nge(){var e=this.parentNode;e&&e.removeChild(this)}function ige(){return this.each(nge)}function age(){var e=this.cloneNode(!1),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function oge(){var e=this.cloneNode(!0),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function sge(e){return this.select(e?oge:age)}function uge(e){return arguments.length?this.property("__data__",e):this.node().__data__}var O$={},qt=null;if(typeof document<"u"){var lge=document.documentElement;"onmouseenter"in lge||(O$={mouseenter:"mouseover",mouseleave:"mouseout"})}function cge(e,t,r){return e=L$(e,t,r),function(n){var i=n.relatedTarget;(!i||i!==this&&!(i.compareDocumentPosition(this)&8))&&e.call(this,n)}}function L$(e,t,r){return function(n){var i=qt;qt=n;try{e.call(this,this.__data__,t,r)}finally{qt=i}}}function dge(e){return e.trim().split(/^|\s+/).map(function(t){var r="",n=t.indexOf(".");return n>=0&&(r=t.slice(n+1),t=t.slice(0,n)),{type:t,name:r}})}function fge(e){return function(){var t=this.__on;if(t){for(var r=0,n=-1,i=t.length,a;r<i;++r)a=t[r],(!e.type||a.type===e.type)&&a.name===e.name?this.removeEventListener(a.type,a.listener,a.capture):t[++n]=a;++n?t.length=n:delete this.__on}}}function hge(e,t,r){var n=O$.hasOwnProperty(e.type)?cge:L$;return function(i,a,o){var s=this.__on,u,l=n(t,a,o);if(s){for(var c=0,d=s.length;c<d;++c)if((u=s[c]).type===e.type&&u.name===e.name){this.removeEventListener(u.type,u.listener,u.capture),this.addEventListener(u.type,u.listener=l,u.capture=r),u.value=t;return}}this.addEventListener(e.type,l,r),u={type:e.type,name:e.name,value:t,listener:l,capture:r},s?s.push(u):this.__on=[u]}}function pge(e,t,r){var n=dge(e+""),i,a=n.length,o;if(arguments.length<2){var s=this.node().__on;if(s){for(var u=0,l=s.length,c;u<l;++u)for(i=0,c=s[u];i<a;++i)if((o=n[i]).type===c.type&&o.name===c.name)return c.value}return}for(s=t?hge:fge,r==null&&(r=!1),i=0;i<a;++i)this.each(s(n[i],t,r));return this}function N$(e,t,r,n){var i=qt;e.sourceEvent=qt,qt=e;try{return t.apply(r,n)}finally{qt=i}}function F$(e,t,r){var n=I$(e),i=n.CustomEvent;typeof i=="function"?i=new i(t,r):(i=n.document.createEvent("Event"),r?(i.initEvent(t,r.bubbles,r.cancelable),i.detail=r.detail):i.initEvent(t,!1,!1)),e.dispatchEvent(i)}function vge(e,t){return function(){return F$(this,e,t)}}function mge(e,t){return function(){return F$(this,e,t.apply(this,arguments))}}function gge(e,t){return this.each((typeof t=="function"?mge:vge)(e,t))}var B$=[null];function qo(e,t){this._groups=e,this._parents=t}function xb(){return new qo([[document.documentElement]],B$)}qo.prototype=xb.prototype={constructor:qo,select:rme,selectAll:ime,filter:ame,data:cme,enter:ome,exit:dme,join:fme,merge:hme,order:pme,sort:vme,call:gme,nodes:yme,node:bme,size:xme,empty:Sme,each:Cme,attr:Ime,style:kme,property:Fme,classed:zme,text:qme,html:Yme,raise:Qme,lower:Jme,append:ege,insert:rge,remove:ige,clone:sge,datum:uge,on:pge,dispatch:gge};function Fi(e){return typeof e=="string"?new qo([[document.querySelector(e)]],[document.documentElement]):new qo([[e]],B$)}function U$(){for(var e=qt,t;t=e.sourceEvent;)e=t;return e}function j$(e,t){var r=e.ownerSVGElement||e;if(r.createSVGPoint){var n=r.createSVGPoint();return n.x=t.clientX,n.y=t.clientY,n=n.matrixTransform(e.getScreenCTM().inverse()),[n.x,n.y]}var i=e.getBoundingClientRect();return[t.clientX-i.left-e.clientLeft,t.clientY-i.top-e.clientTop]}function dy(e){var t=U$();return t.changedTouches&&(t=t.changedTouches[0]),j$(e,t)}function HI(e,t,r){arguments.length<3&&(r=t,t=U$().changedTouches);for(var n=0,i=t?t.length:0,a;n<i;++n)if((a=t[n]).identifier===r)return j$(e,a);return null}function GI(){qt.preventDefault(),qt.stopImmediatePropagation()}function z$(e){var t=e.document.documentElement,r=Fi(e).on("dragstart.drag",GI,!0);"onselectstart"in t?r.on("selectstart.drag",GI,!0):(t.__noselect=t.style.MozUserSelect,t.style.MozUserSelect="none")}function V$(e,t){var r=e.document.documentElement,n=Fi(e).on("dragstart.drag",null);t&&(n.on("click.drag",GI,!0),setTimeout(function(){n.on("click.drag",null)},0)),"onselectstart"in r?n.on("selectstart.drag",null):(r.style.MozUserSelect=r.__noselect,delete r.__noselect)}function vk(e,t,r){e.prototype=t.prototype=r,r.constructor=e}function H$(e,t){var r=Object.create(e.prototype);for(var n in t)r[n]=t[n];return r}function Sb(){}var D1=.7,fC=1/D1,Hm="\\s*([+-]?\\d+)\\s*",R1="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",gl="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",yge=/^#([0-9a-f]{3,8})$/,bge=new RegExp("^rgb\\("+[Hm,Hm,Hm]+"\\)$"),xge=new RegExp("^rgb\\("+[gl,gl,gl]+"\\)$"),Sge=new RegExp("^rgba\\("+[Hm,Hm,Hm,R1]+"\\)$"),Cge=new RegExp("^rgba\\("+[gl,gl,gl,R1]+"\\)$"),_ge=new RegExp("^hsl\\("+[R1,gl,gl]+"\\)$"),wge=new RegExp("^hsla\\("+[R1,gl,gl,R1]+"\\)$"),aB={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};vk(Sb,Np,{copy:function(e){return Object.assign(new this.constructor,this,e)},displayable:function(){return this.rgb().displayable()},hex:oB,formatHex:oB,formatHsl:Ege,formatRgb:sB,toString:sB});function oB(){return this.rgb().formatHex()}function Ege(){return G$(this).formatHsl()}function sB(){return this.rgb().formatRgb()}function Np(e){var t,r;return e=(e+"").trim().toLowerCase(),(t=yge.exec(e))?(r=t[1].length,t=parseInt(t[1],16),r===6?uB(t):r===3?new Fo(t>>8&15|t>>4&240,t>>4&15|t&240,(t&15)<<4|t&15,1):r===8?_2(t>>24&255,t>>16&255,t>>8&255,(t&255)/255):r===4?_2(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|t&240,((t&15)<<4|t&15)/255):null):(t=bge.exec(e))?new Fo(t[1],t[2],t[3],1):(t=xge.exec(e))?new Fo(t[1]*255/100,t[2]*255/100,t[3]*255/100,1):(t=Sge.exec(e))?_2(t[1],t[2],t[3],t[4]):(t=Cge.exec(e))?_2(t[1]*255/100,t[2]*255/100,t[3]*255/100,t[4]):(t=_ge.exec(e))?dB(t[1],t[2]/100,t[3]/100,1):(t=wge.exec(e))?dB(t[1],t[2]/100,t[3]/100,t[4]):aB.hasOwnProperty(e)?uB(aB[e]):e==="transparent"?new Fo(NaN,NaN,NaN,0):null}function uB(e){return new Fo(e>>16&255,e>>8&255,e&255,1)}function _2(e,t,r,n){return n<=0&&(e=t=r=NaN),new Fo(e,t,r,n)}function Age(e){return e instanceof Sb||(e=Np(e)),e?(e=e.rgb(),new Fo(e.r,e.g,e.b,e.opacity)):new Fo}function qI(e,t,r,n){return arguments.length===1?Age(e):new Fo(e,t,r,n??1)}function Fo(e,t,r,n){this.r=+e,this.g=+t,this.b=+r,this.opacity=+n}vk(Fo,qI,H$(Sb,{brighter:function(e){return e=e==null?fC:Math.pow(fC,e),new Fo(this.r*e,this.g*e,this.b*e,this.opacity)},darker:function(e){return e=e==null?D1:Math.pow(D1,e),new Fo(this.r*e,this.g*e,this.b*e,this.opacity)},rgb:function(){return this},displayable:function(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:lB,formatHex:lB,formatRgb:cB,toString:cB}));function lB(){return"#"+NA(this.r)+NA(this.g)+NA(this.b)}function cB(){var e=this.opacity;return e=isNaN(e)?1:Math.max(0,Math.min(1,e)),(e===1?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(e===1?")":", "+e+")")}function NA(e){return e=Math.max(0,Math.min(255,Math.round(e)||0)),(e<16?"0":"")+e.toString(16)}function dB(e,t,r,n){return n<=0?e=t=r=NaN:r<=0||r>=1?e=t=NaN:t<=0&&(e=NaN),new ol(e,t,r,n)}function G$(e){if(e instanceof ol)return new ol(e.h,e.s,e.l,e.opacity);if(e instanceof Sb||(e=Np(e)),!e)return new ol;if(e instanceof ol)return e;e=e.rgb();var t=e.r/255,r=e.g/255,n=e.b/255,i=Math.min(t,r,n),a=Math.max(t,r,n),o=NaN,s=a-i,u=(a+i)/2;return s?(t===a?o=(r-n)/s+(r<n)*6:r===a?o=(n-t)/s+2:o=(t-r)/s+4,s/=u<.5?a+i:2-a-i,o*=60):s=u>0&&u<1?0:o,new ol(o,s,u,e.opacity)}function Pge(e,t,r,n){return arguments.length===1?G$(e):new ol(e,t,r,n??1)}function ol(e,t,r,n){this.h=+e,this.s=+t,this.l=+r,this.opacity=+n}vk(ol,Pge,H$(Sb,{brighter:function(e){return e=e==null?fC:Math.pow(fC,e),new ol(this.h,this.s,this.l*e,this.opacity)},darker:function(e){return e=e==null?D1:Math.pow(D1,e),new ol(this.h,this.s,this.l*e,this.opacity)},rgb:function(){var e=this.h%360+(this.h<0)*360,t=isNaN(e)||isNaN(this.s)?0:this.s,r=this.l,n=r+(r<.5?r:1-r)*t,i=2*r-n;return new Fo(FA(e>=240?e-240:e+120,i,n),FA(e,i,n),FA(e<120?e+240:e-120,i,n),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl:function(){var e=this.opacity;return e=isNaN(e)?1:Math.max(0,Math.min(1,e)),(e===1?"hsl(":"hsla(")+(this.h||0)+", "+(this.s||0)*100+"%, "+(this.l||0)*100+"%"+(e===1?")":", "+e+")")}}));function FA(e,t,r){return(e<60?t+(r-t)*e/60:e<180?r:e<240?t+(r-t)*(240-e)/60:t)*255}function mk(e){return function(){return e}}function Tge(e,t){return function(r){return e+r*t}}function Ige(e,t,r){return e=Math.pow(e,r),t=Math.pow(t,r)-e,r=1/r,function(n){return Math.pow(e+n*t,r)}}function Mge(e){return(e=+e)==1?q$:function(t,r){return r-t?Ige(t,r,e):mk(isNaN(t)?r:t)}}function q$(e,t){var r=t-e;return r?Tge(e,r):mk(isNaN(e)?t:e)}const hC=function e(t){var r=Mge(t);function n(i,a){var o=r((i=qI(i)).r,(a=qI(a)).r),s=r(i.g,a.g),u=r(i.b,a.b),l=q$(i.opacity,a.opacity);return function(c){return i.r=o(c),i.g=s(c),i.b=u(c),i.opacity=l(c),i+""}}return n.gamma=e,n}(1);function Dge(e,t){t||(t=[]);var r=e?Math.min(t.length,e.length):0,n=t.slice(),i;return function(a){for(i=0;i<r;++i)n[i]=e[i]*(1-a)+t[i]*a;return n}}function Rge(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function kge(e,t){var r=t?t.length:0,n=e?Math.min(r,e.length):0,i=new Array(n),a=new Array(r),o;for(o=0;o<n;++o)i[o]=Kw(e[o],t[o]);for(;o<r;++o)a[o]=t[o];return function(s){for(o=0;o<n;++o)a[o]=i[o](s);return a}}function Oge(e,t){var r=new Date;return e=+e,t=+t,function(n){return r.setTime(e*(1-n)+t*n),r}}function iu(e,t){return e=+e,t=+t,function(r){return e*(1-r)+t*r}}function Lge(e,t){var r={},n={},i;(e===null||typeof e!="object")&&(e={}),(t===null||typeof t!="object")&&(t={});for(i in t)i in e?r[i]=Kw(e[i],t[i]):n[i]=t[i];return function(a){for(i in r)n[i]=r[i](a);return n}}var WI=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,BA=new RegExp(WI.source,"g");function Nge(e){return function(){return e}}function Fge(e){return function(t){return e(t)+""}}function W$(e,t){var r=WI.lastIndex=BA.lastIndex=0,n,i,a,o=-1,s=[],u=[];for(e=e+"",t=t+"";(n=WI.exec(e))&&(i=BA.exec(t));)(a=i.index)>r&&(a=t.slice(r,a),s[o]?s[o]+=a:s[++o]=a),(n=n[0])===(i=i[0])?s[o]?s[o]+=i:s[++o]=i:(s[++o]=null,u.push({i:o,x:iu(n,i)})),r=BA.lastIndex;return r<t.length&&(a=t.slice(r),s[o]?s[o]+=a:s[++o]=a),s.length<2?u[0]?Fge(u[0].x):Nge(t):(t=u.length,function(l){for(var c=0,d;c<t;++c)s[(d=u[c]).i]=d.x(l);return s.join("")})}function Kw(e,t){var r=typeof t,n;return t==null||r==="boolean"?mk(t):(r==="number"?iu:r==="string"?(n=Np(t))?(t=n,hC):W$:t instanceof Np?hC:t instanceof Date?Oge:Rge(t)?Dge:Array.isArray(t)?kge:typeof t.valueOf!="function"&&typeof t.toString!="function"||isNaN(t)?Lge:iu)(e,t)}function Bge(e,t){return e=+e,t=+t,function(r){return Math.round(e*(1-r)+t*r)}}var fB=180/Math.PI,$I={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function $$(e,t,r,n,i,a){var o,s,u;return(o=Math.sqrt(e*e+t*t))&&(e/=o,t/=o),(u=e*r+t*n)&&(r-=e*u,n-=t*u),(s=Math.sqrt(r*r+n*n))&&(r/=s,n/=s,u/=s),e*n<t*r&&(e=-e,t=-t,u=-u,o=-o),{translateX:i,translateY:a,rotate:Math.atan2(t,e)*fB,skewX:Math.atan(u)*fB,scaleX:o,scaleY:s}}var _0,UA,hB,w2;function Uge(e){return e==="none"?$I:(_0||(_0=document.createElement("DIV"),UA=document.documentElement,hB=document.defaultView),_0.style.transform=e,e=hB.getComputedStyle(UA.appendChild(_0),null).getPropertyValue("transform"),UA.removeChild(_0),e=e.slice(7,-1).split(","),$$(+e[0],+e[1],+e[2],+e[3],+e[4],+e[5]))}function jge(e){return e==null||(w2||(w2=document.createElementNS("http://www.w3.org/2000/svg","g")),w2.setAttribute("transform",e),!(e=w2.transform.baseVal.consolidate()))?$I:(e=e.matrix,$$(e.a,e.b,e.c,e.d,e.e,e.f))}function X$(e,t,r,n){function i(l){return l.length?l.pop()+" ":""}function a(l,c,d,f,h,v){if(l!==d||c!==f){var p=h.push("translate(",null,t,null,r);v.push({i:p-4,x:iu(l,d)},{i:p-2,x:iu(c,f)})}else(d||f)&&h.push("translate("+d+t+f+r)}function o(l,c,d,f){l!==c?(l-c>180?c+=360:c-l>180&&(l+=360),f.push({i:d.push(i(d)+"rotate(",null,n)-2,x:iu(l,c)})):c&&d.push(i(d)+"rotate("+c+n)}function s(l,c,d,f){l!==c?f.push({i:d.push(i(d)+"skewX(",null,n)-2,x:iu(l,c)}):c&&d.push(i(d)+"skewX("+c+n)}function u(l,c,d,f,h,v){if(l!==d||c!==f){var p=h.push(i(h)+"scale(",null,",",null,")");v.push({i:p-4,x:iu(l,d)},{i:p-2,x:iu(c,f)})}else(d!==1||f!==1)&&h.push(i(h)+"scale("+d+","+f+")")}return function(l,c){var d=[],f=[];return l=e(l),c=e(c),a(l.translateX,l.translateY,c.translateX,c.translateY,d,f),o(l.rotate,c.rotate,d,f),s(l.skewX,c.skewX,d,f),u(l.scaleX,l.scaleY,c.scaleX,c.scaleY,d,f),l=c=null,function(h){for(var v=-1,p=f.length,m;++v<p;)d[(m=f[v]).i]=m.x(h);return d.join("")}}}var zge=X$(Uge,"px, ","px)","deg)"),Vge=X$(jge,", ",")",")"),w0=Math.SQRT2,jA=2,pB=4,Hge=1e-12;function vB(e){return((e=Math.exp(e))+1/e)/2}function Gge(e){return((e=Math.exp(e))-1/e)/2}function qge(e){return((e=Math.exp(2*e))-1)/(e+1)}function Wge(e,t){var r=e[0],n=e[1],i=e[2],a=t[0],o=t[1],s=t[2],u=a-r,l=o-n,c=u*u+l*l,d,f;if(c<Hge)f=Math.log(s/i)/w0,d=function(y){return[r+y*u,n+y*l,i*Math.exp(w0*y*f)]};else{var h=Math.sqrt(c),v=(s*s-i*i+pB*c)/(2*i*jA*h),p=(s*s-i*i-pB*c)/(2*s*jA*h),m=Math.log(Math.sqrt(v*v+1)-v),g=Math.log(Math.sqrt(p*p+1)-p);f=(g-m)/w0,d=function(y){var b=y*f,S=vB(m),x=i/(jA*h)*(S*qge(w0*b+m)-Gge(m));return[r+x*u,n+x*l,i*S/vB(w0*b+m)]}}return d.duration=f*1e3,d}var vg=0,fy=0,E0=0,Y$=1e3,pC,hy,vC=0,Fp=0,Qw=0,k1=typeof performance=="object"&&performance.now?performance:Date,K$=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(e){setTimeout(e,17)};function Zw(){return Fp||(K$($ge),Fp=k1.now()+Qw)}function $ge(){Fp=0}function mC(){this._call=this._time=this._next=null}mC.prototype=Q$.prototype={constructor:mC,restart:function(e,t,r){if(typeof e!="function")throw new TypeError("callback is not a function");r=(r==null?Zw():+r)+(t==null?0:+t),!this._next&&hy!==this&&(hy?hy._next=this:pC=this,hy=this),this._call=e,this._time=r,XI()},stop:function(){this._call&&(this._call=null,this._time=1/0,XI())}};function Q$(e,t,r){var n=new mC;return n.restart(e,t,r),n}function Xge(){Zw(),++vg;for(var e=pC,t;e;)(t=Fp-e._time)>=0&&e._call.call(null,t),e=e._next;--vg}function mB(){Fp=(vC=k1.now())+Qw,vg=fy=0;try{Xge()}finally{vg=0,Kge(),Fp=0}}function Yge(){var e=k1.now(),t=e-vC;t>Y$&&(Qw-=t,vC=e)}function Kge(){for(var e,t=pC,r,n=1/0;t;)t._call?(n>t._time&&(n=t._time),e=t,t=t._next):(r=t._next,t._next=null,t=e?e._next=r:pC=r);hy=e,XI(n)}function XI(e){if(!vg){fy&&(fy=clearTimeout(fy));var t=e-Fp;t>24?(e<1/0&&(fy=setTimeout(mB,e-k1.now()-Qw)),E0&&(E0=clearInterval(E0))):(E0||(vC=k1.now(),E0=setInterval(Yge,Y$)),vg=1,K$(mB))}}function gB(e,t,r){var n=new mC;return t=t==null?0:+t,n.restart(function(i){n.stop(),e(i+t)},t,r),n}var Qge=Xw("start","end","cancel","interrupt"),Zge=[],Z$=0,yB=1,YI=2,iS=3,bB=4,KI=5,aS=6;function Jw(e,t,r,n,i,a){var o=e.__transition;if(!o)e.__transition={};else if(r in o)return;Jge(e,r,{name:t,index:n,group:i,on:Qge,tween:Zge,time:a.time,delay:a.delay,duration:a.duration,ease:a.ease,timer:null,state:Z$})}function gk(e,t){var r=Ou(e,t);if(r.state>Z$)throw new Error("too late; already scheduled");return r}function Zc(e,t){var r=Ou(e,t);if(r.state>iS)throw new Error("too late; already running");return r}function Ou(e,t){var r=e.__transition;if(!r||!(r=r[t]))throw new Error("transition not found");return r}function Jge(e,t,r){var n=e.__transition,i;n[t]=r,r.timer=Q$(a,0,r.time);function a(l){r.state=yB,r.timer.restart(o,r.delay,r.time),r.delay<=l&&o(l-r.delay)}function o(l){var c,d,f,h;if(r.state!==yB)return u();for(c in n)if(h=n[c],h.name===r.name){if(h.state===iS)return gB(o);h.state===bB?(h.state=aS,h.timer.stop(),h.on.call("interrupt",e,e.__data__,h.index,h.group),delete n[c]):+c<t&&(h.state=aS,h.timer.stop(),h.on.call("cancel",e,e.__data__,h.index,h.group),delete n[c])}if(gB(function(){r.state===iS&&(r.state=bB,r.timer.restart(s,r.delay,r.time),s(l))}),r.state=YI,r.on.call("start",e,e.__data__,r.index,r.group),r.state===YI){for(r.state=iS,i=new Array(f=r.tween.length),c=0,d=-1;c<f;++c)(h=r.tween[c].value.call(e,e.__data__,r.index,r.group))&&(i[++d]=h);i.length=d+1}}function s(l){for(var c=l<r.duration?r.ease.call(null,l/r.duration):(r.timer.restart(u),r.state=KI,1),d=-1,f=i.length;++d<f;)i[d].call(e,c);r.state===KI&&(r.on.call("end",e,e.__data__,r.index,r.group),u())}function u(){r.state=aS,r.timer.stop(),delete n[t];for(var l in n)return;delete e.__transition}}function Gm(e,t){var r=e.__transition,n,i,a=!0,o;if(r){t=t==null?null:t+"";for(o in r){if((n=r[o]).name!==t){a=!1;continue}i=n.state>YI&&n.state<KI,n.state=aS,n.timer.stop(),n.on.call(i?"interrupt":"cancel",e,e.__data__,n.index,n.group),delete r[o]}a&&delete e.__transition}}function e0e(e){return this.each(function(){Gm(this,e)})}function t0e(e,t){var r,n;return function(){var i=Zc(this,e),a=i.tween;if(a!==r){n=r=a;for(var o=0,s=n.length;o<s;++o)if(n[o].name===t){n=n.slice(),n.splice(o,1);break}}i.tween=n}}function r0e(e,t,r){var n,i;if(typeof r!="function")throw new Error;return function(){var a=Zc(this,e),o=a.tween;if(o!==n){i=(n=o).slice();for(var s={name:t,value:r},u=0,l=i.length;u<l;++u)if(i[u].name===t){i[u]=s;break}u===l&&i.push(s)}a.tween=i}}function n0e(e,t){var r=this._id;if(e+="",arguments.length<2){for(var n=Ou(this.node(),r).tween,i=0,a=n.length,o;i<a;++i)if((o=n[i]).name===e)return o.value;return null}return this.each((t==null?t0e:r0e)(r,e,t))}function yk(e,t,r){var n=e._id;return e.each(function(){var i=Zc(this,n);(i.value||(i.value={}))[t]=r.apply(this,arguments)}),function(i){return Ou(i,n).value[t]}}function J$(e,t){var r;return(typeof t=="number"?iu:t instanceof Np?hC:(r=Np(t))?(t=r,hC):W$)(e,t)}function i0e(e){return function(){this.removeAttribute(e)}}function a0e(e){return function(){this.removeAttributeNS(e.space,e.local)}}function o0e(e,t,r){var n,i=r+"",a;return function(){var o=this.getAttribute(e);return o===i?null:o===n?a:a=t(n=o,r)}}function s0e(e,t,r){var n,i=r+"",a;return function(){var o=this.getAttributeNS(e.space,e.local);return o===i?null:o===n?a:a=t(n=o,r)}}function u0e(e,t,r){var n,i,a;return function(){var o,s=r(this),u;return s==null?void this.removeAttribute(e):(o=this.getAttribute(e),u=s+"",o===u?null:o===n&&u===i?a:(i=u,a=t(n=o,s)))}}function l0e(e,t,r){var n,i,a;return function(){var o,s=r(this),u;return s==null?void this.removeAttributeNS(e.space,e.local):(o=this.getAttributeNS(e.space,e.local),u=s+"",o===u?null:o===n&&u===i?a:(i=u,a=t(n=o,s)))}}function c0e(e,t){var r=Yw(e),n=r==="transform"?Vge:J$;return this.attrTween(e,typeof t=="function"?(r.local?l0e:u0e)(r,n,yk(this,"attr."+e,t)):t==null?(r.local?a0e:i0e)(r):(r.local?s0e:o0e)(r,n,t))}function d0e(e,t){return function(r){this.setAttribute(e,t.call(this,r))}}function f0e(e,t){return function(r){this.setAttributeNS(e.space,e.local,t.call(this,r))}}function h0e(e,t){var r,n;function i(){var a=t.apply(this,arguments);return a!==n&&(r=(n=a)&&f0e(e,a)),r}return i._value=t,i}function p0e(e,t){var r,n;function i(){var a=t.apply(this,arguments);return a!==n&&(r=(n=a)&&d0e(e,a)),r}return i._value=t,i}function v0e(e,t){var r="attr."+e;if(arguments.length<2)return(r=this.tween(r))&&r._value;if(t==null)return this.tween(r,null);if(typeof t!="function")throw new Error;var n=Yw(e);return this.tween(r,(n.local?h0e:p0e)(n,t))}function m0e(e,t){return function(){gk(this,e).delay=+t.apply(this,arguments)}}function g0e(e,t){return t=+t,function(){gk(this,e).delay=t}}function y0e(e){var t=this._id;return arguments.length?this.each((typeof e=="function"?m0e:g0e)(t,e)):Ou(this.node(),t).delay}function b0e(e,t){return function(){Zc(this,e).duration=+t.apply(this,arguments)}}function x0e(e,t){return t=+t,function(){Zc(this,e).duration=t}}function S0e(e){var t=this._id;return arguments.length?this.each((typeof e=="function"?b0e:x0e)(t,e)):Ou(this.node(),t).duration}function C0e(e,t){if(typeof t!="function")throw new Error;return function(){Zc(this,e).ease=t}}function _0e(e){var t=this._id;return arguments.length?this.each(C0e(t,e)):Ou(this.node(),t).ease}function w0e(e){typeof e!="function"&&(e=P$(e));for(var t=this._groups,r=t.length,n=new Array(r),i=0;i<r;++i)for(var a=t[i],o=a.length,s=n[i]=[],u,l=0;l<o;++l)(u=a[l])&&e.call(u,u.__data__,l,a)&&s.push(u);return new Ic(n,this._parents,this._name,this._id)}function E0e(e){if(e._id!==this._id)throw new Error;for(var t=this._groups,r=e._groups,n=t.length,i=r.length,a=Math.min(n,i),o=new Array(n),s=0;s<a;++s)for(var u=t[s],l=r[s],c=u.length,d=o[s]=new Array(c),f,h=0;h<c;++h)(f=u[h]||l[h])&&(d[h]=f);for(;s<n;++s)o[s]=t[s];return new Ic(o,this._parents,this._name,this._id)}function A0e(e){return(e+"").trim().split(/^|\s+/).every(function(t){var r=t.indexOf(".");return r>=0&&(t=t.slice(0,r)),!t||t==="start"})}function P0e(e,t,r){var n,i,a=A0e(t)?gk:Zc;return function(){var o=a(this,e),s=o.on;s!==n&&(i=(n=s).copy()).on(t,r),o.on=i}}function T0e(e,t){var r=this._id;return arguments.length<2?Ou(this.node(),r).on.on(e):this.each(P0e(r,e,t))}function I0e(e){return function(){var t=this.parentNode;for(var r in this.__transition)if(+r!==e)return;t&&t.removeChild(this)}}function M0e(){return this.on("end.remove",I0e(this._id))}function D0e(e){var t=this._name,r=this._id;typeof e!="function"&&(e=hk(e));for(var n=this._groups,i=n.length,a=new Array(i),o=0;o<i;++o)for(var s=n[o],u=s.length,l=a[o]=new Array(u),c,d,f=0;f<u;++f)(c=s[f])&&(d=e.call(c,c.__data__,f,s))&&("__data__"in c&&(d.__data__=c.__data__),l[f]=d,Jw(l[f],t,r,f,l,Ou(c,r)));return new Ic(a,this._parents,t,r)}function R0e(e){var t=this._name,r=this._id;typeof e!="function"&&(e=A$(e));for(var n=this._groups,i=n.length,a=[],o=[],s=0;s<i;++s)for(var u=n[s],l=u.length,c,d=0;d<l;++d)if(c=u[d]){for(var f=e.call(c,c.__data__,d,u),h,v=Ou(c,r),p=0,m=f.length;p<m;++p)(h=f[p])&&Jw(h,t,r,p,f,v);a.push(f),o.push(c)}return new Ic(a,o,t,r)}var k0e=xb.prototype.constructor;function O0e(){return new k0e(this._groups,this._parents)}function L0e(e,t){var r,n,i;return function(){var a=pg(this,e),o=(this.style.removeProperty(e),pg(this,e));return a===o?null:a===r&&o===n?i:i=t(r=a,n=o)}}function eX(e){return function(){this.style.removeProperty(e)}}function N0e(e,t,r){var n,i=r+"",a;return function(){var o=pg(this,e);return o===i?null:o===n?a:a=t(n=o,r)}}function F0e(e,t,r){var n,i,a;return function(){var o=pg(this,e),s=r(this),u=s+"";return s==null&&(u=s=(this.style.removeProperty(e),pg(this,e))),o===u?null:o===n&&u===i?a:(i=u,a=t(n=o,s))}}function B0e(e,t){var r,n,i,a="style."+t,o="end."+a,s;return function(){var u=Zc(this,e),l=u.on,c=u.value[a]==null?s||(s=eX(t)):void 0;(l!==r||i!==c)&&(n=(r=l).copy()).on(o,i=c),u.on=n}}function U0e(e,t,r){var n=(e+="")=="transform"?zge:J$;return t==null?this.styleTween(e,L0e(e,n)).on("end.style."+e,eX(e)):typeof t=="function"?this.styleTween(e,F0e(e,n,yk(this,"style."+e,t))).each(B0e(this._id,e)):this.styleTween(e,N0e(e,n,t),r).on("end.style."+e,null)}function j0e(e,t,r){return function(n){this.style.setProperty(e,t.call(this,n),r)}}function z0e(e,t,r){var n,i;function a(){var o=t.apply(this,arguments);return o!==i&&(n=(i=o)&&j0e(e,o,r)),n}return a._value=t,a}function V0e(e,t,r){var n="style."+(e+="");if(arguments.length<2)return(n=this.tween(n))&&n._value;if(t==null)return this.tween(n,null);if(typeof t!="function")throw new Error;return this.tween(n,z0e(e,t,r??""))}function H0e(e){return function(){this.textContent=e}}function G0e(e){return function(){var t=e(this);this.textContent=t??""}}function q0e(e){return this.tween("text",typeof e=="function"?G0e(yk(this,"text",e)):H0e(e==null?"":e+""))}function W0e(e){return function(t){this.textContent=e.call(this,t)}}function $0e(e){var t,r;function n(){var i=e.apply(this,arguments);return i!==r&&(t=(r=i)&&W0e(i)),t}return n._value=e,n}function X0e(e){var t="text";if(arguments.length<1)return(t=this.tween(t))&&t._value;if(e==null)return this.tween(t,null);if(typeof e!="function")throw new Error;return this.tween(t,$0e(e))}function Y0e(){for(var e=this._name,t=this._id,r=tX(),n=this._groups,i=n.length,a=0;a<i;++a)for(var o=n[a],s=o.length,u,l=0;l<s;++l)if(u=o[l]){var c=Ou(u,t);Jw(u,e,r,l,o,{time:c.time+c.delay+c.duration,delay:0,duration:c.duration,ease:c.ease})}return new Ic(n,this._parents,e,r)}function K0e(){var e,t,r=this,n=r._id,i=r.size();return new Promise(function(a,o){var s={value:o},u={value:function(){--i===0&&a()}};r.each(function(){var l=Zc(this,n),c=l.on;c!==e&&(t=(e=c).copy(),t._.cancel.push(s),t._.interrupt.push(s),t._.end.push(u)),l.on=t})})}var Q0e=0;function Ic(e,t,r,n){this._groups=e,this._parents=t,this._name=r,this._id=n}function tX(){return++Q0e}var Bv=xb.prototype;Ic.prototype={constructor:Ic,select:D0e,selectAll:R0e,filter:w0e,merge:E0e,selection:O0e,transition:Y0e,call:Bv.call,nodes:Bv.nodes,node:Bv.node,size:Bv.size,empty:Bv.empty,each:Bv.each,on:T0e,attr:c0e,attrTween:v0e,style:U0e,styleTween:V0e,text:q0e,textTween:X0e,remove:M0e,tween:n0e,delay:y0e,duration:S0e,ease:_0e,end:K0e};function Z0e(e){return((e*=2)<=1?e*e*e:(e-=2)*e*e+2)/2}var QI={time:null,delay:0,duration:250,ease:Z0e};function J0e(e,t){for(var r;!(r=e.__transition)||!(r=r[t]);)if(!(e=e.parentNode))return QI.time=Zw(),QI;return r}function eye(e){var t,r;e instanceof Ic?(t=e._id,e=e._name):(t=tX(),(r=QI).time=Zw(),e=e==null?null:e+"");for(var n=this._groups,i=n.length,a=0;a<i;++a)for(var o=n[a],s=o.length,u,l=0;l<s;++l)(u=o[l])&&Jw(u,e,t,l,o,r||J0e(u,t));return new Ic(n,this._parents,e,t)}xb.prototype.interrupt=e0e;xb.prototype.transition=eye;function zA(e){return function(){return e}}function tye(e,t,r){this.target=e,this.type=t,this.selection=r}function xB(){qt.stopImmediatePropagation()}function VA(){qt.preventDefault(),qt.stopImmediatePropagation()}var SB={name:"drag"},HA={name:"space"},Uv={name:"handle"},jv={name:"center"};function CB(e){return[+e[0],+e[1]]}function _B(e){return[CB(e[0]),CB(e[1])]}function rye(e){return function(t){return HI(t,qt.touches,e)}}var oS={name:"x",handles:["w","e"].map(gC),input:function(e,t){return e==null?null:[[+e[0],t[0][1]],[+e[1],t[1][1]]]},output:function(e){return e&&[e[0][0],e[1][0]]}},GA={name:"y",handles:["n","s"].map(gC),input:function(e,t){return e==null?null:[[t[0][0],+e[0]],[t[1][0],+e[1]]]},output:function(e){return e&&[e[0][1],e[1][1]]}},Ll={overlay:"crosshair",selection:"move",n:"ns-resize",e:"ew-resize",s:"ns-resize",w:"ew-resize",nw:"nwse-resize",ne:"nesw-resize",se:"nwse-resize",sw:"nesw-resize"},wB={e:"w",w:"e",nw:"ne",ne:"nw",se:"sw",sw:"se"},EB={n:"s",s:"n",nw:"sw",ne:"se",se:"ne",sw:"nw"},nye={overlay:1,selection:1,n:null,e:1,s:null,w:-1,nw:-1,ne:1,se:1,sw:-1},iye={overlay:1,selection:1,n:-1,e:null,s:1,w:null,nw:-1,ne:-1,se:1,sw:1};function gC(e){return{type:e}}function aye(){return!qt.ctrlKey&&!qt.button}function oye(){var e=this.ownerSVGElement||this;return e.hasAttribute("viewBox")?(e=e.viewBox.baseVal,[[e.x,e.y],[e.x+e.width,e.y+e.height]]):[[0,0],[e.width.baseVal.value,e.height.baseVal.value]]}function sye(){return navigator.maxTouchPoints||"ontouchstart"in this}function qA(e){for(;!e.__brush;)if(!(e=e.parentNode))return;return e.__brush}function uye(e){return e[0][0]===e[1][0]||e[0][1]===e[1][1]}function lye(){return cye(oS)}function cye(e){var t=oye,r=aye,n=sye,i=!0,a=Xw("start","brush","end"),o=6,s;function u(m){var g=m.property("__brush",p).selectAll(".overlay").data([gC("overlay")]);g.enter().append("rect").attr("class","overlay").attr("pointer-events","all").attr("cursor",Ll.overlay).merge(g).each(function(){var b=qA(this).extent;Fi(this).attr("x",b[0][0]).attr("y",b[0][1]).attr("width",b[1][0]-b[0][0]).attr("height",b[1][1]-b[0][1])}),m.selectAll(".selection").data([gC("selection")]).enter().append("rect").attr("class","selection").attr("cursor",Ll.selection).attr("fill","#777").attr("fill-opacity",.3).attr("stroke","#fff").attr("shape-rendering","crispEdges");var y=m.selectAll(".handle").data(e.handles,function(b){return b.type});y.exit().remove(),y.enter().append("rect").attr("class",function(b){return"handle handle--"+b.type}).attr("cursor",function(b){return Ll[b.type]}),m.each(l).attr("fill","none").attr("pointer-events","all").on("mousedown.brush",f).filter(n).on("touchstart.brush",f).on("touchmove.brush",h).on("touchend.brush touchcancel.brush",v).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}u.move=function(m,g){m.selection?m.on("start.brush",function(){c(this,arguments).beforestart().start()}).on("interrupt.brush end.brush",function(){c(this,arguments).end()}).tween("brush",function(){var y=this,b=y.__brush,S=c(y,arguments),x=b.selection,C=e.input(typeof g=="function"?g.apply(this,arguments):g,b.extent),w=Kw(x,C);function A(M){b.selection=M===1&&C===null?null:w(M),l.call(y),S.brush()}return x!==null&&C!==null?A:A(1)}):m.each(function(){var y=this,b=arguments,S=y.__brush,x=e.input(typeof g=="function"?g.apply(y,b):g,S.extent),C=c(y,b).beforestart();Gm(y),S.selection=x===null?null:x,l.call(y),C.start().brush().end()})},u.clear=function(m){u.move(m,null)};function l(){var m=Fi(this),g=qA(this).selection;g?(m.selectAll(".selection").style("display",null).attr("x",g[0][0]).attr("y",g[0][1]).attr("width",g[1][0]-g[0][0]).attr("height",g[1][1]-g[0][1]),m.selectAll(".handle").style("display",null).attr("x",function(y){return y.type[y.type.length-1]==="e"?g[1][0]-o/2:g[0][0]-o/2}).attr("y",function(y){return y.type[0]==="s"?g[1][1]-o/2:g[0][1]-o/2}).attr("width",function(y){return y.type==="n"||y.type==="s"?g[1][0]-g[0][0]+o:o}).attr("height",function(y){return y.type==="e"||y.type==="w"?g[1][1]-g[0][1]+o:o})):m.selectAll(".selection,.handle").style("display","none").attr("x",null).attr("y",null).attr("width",null).attr("height",null)}function c(m,g,y){var b=m.__brush.emitter;return b&&(!y||!b.clean)?b:new d(m,g,y)}function d(m,g,y){this.that=m,this.args=g,this.state=m.__brush,this.active=0,this.clean=y}d.prototype={beforestart:function(){return++this.active===1&&(this.state.emitter=this,this.starting=!0),this},start:function(){return this.starting?(this.starting=!1,this.emit("start")):this.emit("brush"),this},brush:function(){return this.emit("brush"),this},end:function(){return--this.active===0&&(delete this.state.emitter,this.emit("end")),this},emit:function(m){N$(new tye(u,m,e.output(this.state.selection)),a.apply,a,[m,this.that,this.args])}};function f(){if(s&&!qt.touches||!r.apply(this,arguments))return;var m=this,g=qt.target.__data__.type,y=(i&&qt.metaKey?g="overlay":g)==="selection"?SB:i&&qt.altKey?jv:Uv,b=e===GA?null:nye[g],S=e===oS?null:iye[g],x=qA(m),C=x.extent,w=x.selection,A=C[0][0],M,D,k=C[0][1],R,L,H=C[1][0],B,j,Q=C[1][1],G,W,q=0,ee=0,he,$=b&&S&&i&&qt.shiftKey,X,U,z=qt.touches?rye(qt.changedTouches[0].identifier):dy,J=z(m),Y=J,Z=c(m,arguments,!0).beforestart();g==="overlay"?(w&&(he=!0),x.selection=w=[[M=e===GA?A:J[0],R=e===oS?k:J[1]],[B=e===GA?H:M,G=e===oS?Q:R]]):(M=w[0][0],R=w[0][1],B=w[1][0],G=w[1][1]),D=M,L=R,j=B,W=G;var te=Fi(m).attr("pointer-events","none"),le=te.selectAll(".overlay").attr("cursor",Ll[g]);if(qt.touches)Z.moved=be,Z.ended=Se;else{var ye=Fi(qt.view).on("mousemove.brush",be,!0).on("mouseup.brush",Se,!0);i&&ye.on("keydown.brush",ie,!0).on("keyup.brush",oe,!0),z$(qt.view)}xB(),Gm(m),l.call(m),Z.start();function be(){var O=z(m);$&&!X&&!U&&(Math.abs(O[0]-Y[0])>Math.abs(O[1]-Y[1])?U=!0:X=!0),Y=O,he=!0,VA(),Ee()}function Ee(){var O;switch(q=Y[0]-J[0],ee=Y[1]-J[1],y){case HA:case SB:{b&&(q=Math.max(A-M,Math.min(H-B,q)),D=M+q,j=B+q),S&&(ee=Math.max(k-R,Math.min(Q-G,ee)),L=R+ee,W=G+ee);break}case Uv:{b<0?(q=Math.max(A-M,Math.min(H-M,q)),D=M+q,j=B):b>0&&(q=Math.max(A-B,Math.min(H-B,q)),D=M,j=B+q),S<0?(ee=Math.max(k-R,Math.min(Q-R,ee)),L=R+ee,W=G):S>0&&(ee=Math.max(k-G,Math.min(Q-G,ee)),L=R,W=G+ee);break}case jv:{b&&(D=Math.max(A,Math.min(H,M-q*b)),j=Math.max(A,Math.min(H,B+q*b))),S&&(L=Math.max(k,Math.min(Q,R-ee*S)),W=Math.max(k,Math.min(Q,G+ee*S)));break}}j<D&&(b*=-1,O=M,M=B,B=O,O=D,D=j,j=O,g in wB&&le.attr("cursor",Ll[g=wB[g]])),W<L&&(S*=-1,O=R,R=G,G=O,O=L,L=W,W=O,g in EB&&le.attr("cursor",Ll[g=EB[g]])),x.selection&&(w=x.selection),X&&(D=w[0][0],j=w[1][0]),U&&(L=w[0][1],W=w[1][1]),(w[0][0]!==D||w[0][1]!==L||w[1][0]!==j||w[1][1]!==W)&&(x.selection=[[D,L],[j,W]],l.call(m),Z.brush())}function Se(){if(xB(),qt.touches){if(qt.touches.length)return;s&&clearTimeout(s),s=setTimeout(function(){s=null},500)}else V$(qt.view,he),ye.on("keydown.brush keyup.brush mousemove.brush mouseup.brush",null);te.attr("pointer-events","all"),le.attr("cursor",Ll.overlay),x.selection&&(w=x.selection),uye(w)&&(x.selection=null,l.call(m)),Z.end()}function ie(){switch(qt.keyCode){case 16:{$=b&&S;break}case 18:{y===Uv&&(b&&(B=j-q*b,M=D+q*b),S&&(G=W-ee*S,R=L+ee*S),y=jv,Ee());break}case 32:{(y===Uv||y===jv)&&(b<0?B=j-q:b>0&&(M=D-q),S<0?G=W-ee:S>0&&(R=L-ee),y=HA,le.attr("cursor",Ll.selection),Ee());break}default:return}VA()}function oe(){switch(qt.keyCode){case 16:{$&&(X=U=$=!1,Ee());break}case 18:{y===jv&&(b<0?B=j:b>0&&(M=D),S<0?G=W:S>0&&(R=L),y=Uv,Ee());break}case 32:{y===HA&&(qt.altKey?(b&&(B=j-q*b,M=D+q*b),S&&(G=W-ee*S,R=L+ee*S),y=jv):(b<0?B=j:b>0&&(M=D),S<0?G=W:S>0&&(R=L),y=Uv),le.attr("cursor",Ll[g]),Ee());break}default:return}VA()}}function h(){c(this,arguments).moved()}function v(){c(this,arguments).ended()}function p(){var m=this.__brush||{selection:null};return m.extent=_B(t.apply(this,arguments)),m.dim=e,m}return u.extent=function(m){return arguments.length?(t=typeof m=="function"?m:zA(_B(m)),u):t},u.filter=function(m){return arguments.length?(r=typeof m=="function"?m:zA(!!m),u):r},u.touchable=function(m){return arguments.length?(n=typeof m=="function"?m:zA(!!m),u):n},u.handleSize=function(m){return arguments.length?(o=+m,u):o},u.keyModifiers=function(m){return arguments.length?(i=!!m,u):i},u.on=function(){var m=a.on.apply(a,arguments);return m===a?u:m},u}var ZI=Math.PI,JI=2*ZI,Hh=1e-6,dye=JI-Hh;function eM(){this._x0=this._y0=this._x1=this._y1=null,this._=""}function rX(){return new eM}eM.prototype=rX.prototype={constructor:eM,moveTo:function(e,t){this._+="M"+(this._x0=this._x1=+e)+","+(this._y0=this._y1=+t)},closePath:function(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")},lineTo:function(e,t){this._+="L"+(this._x1=+e)+","+(this._y1=+t)},quadraticCurveTo:function(e,t,r,n){this._+="Q"+ +e+","+ +t+","+(this._x1=+r)+","+(this._y1=+n)},bezierCurveTo:function(e,t,r,n,i,a){this._+="C"+ +e+","+ +t+","+ +r+","+ +n+","+(this._x1=+i)+","+(this._y1=+a)},arcTo:function(e,t,r,n,i){e=+e,t=+t,r=+r,n=+n,i=+i;var a=this._x1,o=this._y1,s=r-e,u=n-t,l=a-e,c=o-t,d=l*l+c*c;if(i<0)throw new Error("negative radius: "+i);if(this._x1===null)this._+="M"+(this._x1=e)+","+(this._y1=t);else if(d>Hh)if(!(Math.abs(c*s-u*l)>Hh)||!i)this._+="L"+(this._x1=e)+","+(this._y1=t);else{var f=r-a,h=n-o,v=s*s+u*u,p=f*f+h*h,m=Math.sqrt(v),g=Math.sqrt(d),y=i*Math.tan((ZI-Math.acos((v+d-p)/(2*m*g)))/2),b=y/g,S=y/m;Math.abs(b-1)>Hh&&(this._+="L"+(e+b*l)+","+(t+b*c)),this._+="A"+i+","+i+",0,0,"+ +(c*f>l*h)+","+(this._x1=e+S*s)+","+(this._y1=t+S*u)}},arc:function(e,t,r,n,i,a){e=+e,t=+t,r=+r,a=!!a;var o=r*Math.cos(n),s=r*Math.sin(n),u=e+o,l=t+s,c=1^a,d=a?n-i:i-n;if(r<0)throw new Error("negative radius: "+r);this._x1===null?this._+="M"+u+","+l:(Math.abs(this._x1-u)>Hh||Math.abs(this._y1-l)>Hh)&&(this._+="L"+u+","+l),r&&(d<0&&(d=d%JI+JI),d>dye?this._+="A"+r+","+r+",0,1,"+c+","+(e-o)+","+(t-s)+"A"+r+","+r+",0,1,"+c+","+(this._x1=u)+","+(this._y1=l):d>Hh&&(this._+="A"+r+","+r+",0,"+ +(d>=ZI)+","+c+","+(this._x1=e+r*Math.cos(i))+","+(this._y1=t+r*Math.sin(i))))},rect:function(e,t,r,n){this._+="M"+(this._x0=this._x1=+e)+","+(this._y0=this._y1=+t)+"h"+ +r+"v"+ +n+"h"+-r+"Z"},toString:function(){return this._}};var vs="$";function yC(){}yC.prototype=bC.prototype={constructor:yC,has:function(e){return vs+e in this},get:function(e){return this[vs+e]},set:function(e,t){return this[vs+e]=t,this},remove:function(e){var t=vs+e;return t in this&&delete this[t]},clear:function(){for(var e in this)e[0]===vs&&delete this[e]},keys:function(){var e=[];for(var t in this)t[0]===vs&&e.push(t.slice(1));return e},values:function(){var e=[];for(var t in this)t[0]===vs&&e.push(this[t]);return e},entries:function(){var e=[];for(var t in this)t[0]===vs&&e.push({key:t.slice(1),value:this[t]});return e},size:function(){var e=0;for(var t in this)t[0]===vs&&++e;return e},empty:function(){for(var e in this)if(e[0]===vs)return!1;return!0},each:function(e){for(var t in this)t[0]===vs&&e(this[t],t.slice(1),this)}};function bC(e,t){var r=new yC;if(e instanceof yC)e.each(function(s,u){r.set(u,s)});else if(Array.isArray(e)){var n=-1,i=e.length,a;if(t==null)for(;++n<i;)r.set(n,e[n]);else for(;++n<i;)r.set(t(a=e[n],n,e),a)}else if(e)for(var o in e)r.set(o,e[o]);return r}function AB(){}var mh=bC.prototype;AB.prototype={constructor:AB,has:mh.has,add:function(e){return e+="",this[vs+e]=e,this},remove:mh.remove,clear:mh.clear,values:mh.keys,size:mh.size,empty:mh.empty,each:mh.each};function fye(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)}function xC(e,t){if((r=(e=t?e.toExponential(t-1):e.toExponential()).indexOf("e"))<0)return null;var r,n=e.slice(0,r);return[n.length>1?n[0]+n.slice(2):n,+e.slice(r+1)]}function mg(e){return e=xC(Math.abs(e)),e?e[1]:NaN}function hye(e,t){return function(r,n){for(var i=r.length,a=[],o=0,s=e[0],u=0;i>0&&s>0&&(u+s+1>n&&(s=Math.max(1,n-u)),a.push(r.substring(i-=s,i+s)),!((u+=s+1)>n));)s=e[o=(o+1)%e.length];return a.reverse().join(t)}}function pye(e){return function(t){return t.replace(/[0-9]/g,function(r){return e[+r]})}}var vye=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function SC(e){if(!(t=vye.exec(e)))throw new Error("invalid format: "+e);var t;return new bk({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}SC.prototype=bk.prototype;function bk(e){this.fill=e.fill===void 0?" ":e.fill+"",this.align=e.align===void 0?">":e.align+"",this.sign=e.sign===void 0?"-":e.sign+"",this.symbol=e.symbol===void 0?"":e.symbol+"",this.zero=!!e.zero,this.width=e.width===void 0?void 0:+e.width,this.comma=!!e.comma,this.precision=e.precision===void 0?void 0:+e.precision,this.trim=!!e.trim,this.type=e.type===void 0?"":e.type+""}bk.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function mye(e){e:for(var t=e.length,r=1,n=-1,i;r<t;++r)switch(e[r]){case".":n=i=r;break;case"0":n===0&&(n=r),i=r;break;default:if(!+e[r])break e;n>0&&(n=0);break}return n>0?e.slice(0,n)+e.slice(i+1):e}var nX;function gye(e,t){var r=xC(e,t);if(!r)return e+"";var n=r[0],i=r[1],a=i-(nX=Math.max(-8,Math.min(8,Math.floor(i/3)))*3)+1,o=n.length;return a===o?n:a>o?n+new Array(a-o+1).join("0"):a>0?n.slice(0,a)+"."+n.slice(a):"0."+new Array(1-a).join("0")+xC(e,Math.max(0,t+a-1))[0]}function PB(e,t){var r=xC(e,t);if(!r)return e+"";var n=r[0],i=r[1];return i<0?"0."+new Array(-i).join("0")+n:n.length>i+1?n.slice(0,i+1)+"."+n.slice(i+1):n+new Array(i-n.length+2).join("0")}const TB={"%":function(e,t){return(e*100).toFixed(t)},b:function(e){return Math.round(e).toString(2)},c:function(e){return e+""},d:fye,e:function(e,t){return e.toExponential(t)},f:function(e,t){return e.toFixed(t)},g:function(e,t){return e.toPrecision(t)},o:function(e){return Math.round(e).toString(8)},p:function(e,t){return PB(e*100,t)},r:PB,s:gye,X:function(e){return Math.round(e).toString(16).toUpperCase()},x:function(e){return Math.round(e).toString(16)}};function IB(e){return e}var MB=Array.prototype.map,DB=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"];function yye(e){var t=e.grouping===void 0||e.thousands===void 0?IB:hye(MB.call(e.grouping,Number),e.thousands+""),r=e.currency===void 0?"":e.currency[0]+"",n=e.currency===void 0?"":e.currency[1]+"",i=e.decimal===void 0?".":e.decimal+"",a=e.numerals===void 0?IB:pye(MB.call(e.numerals,String)),o=e.percent===void 0?"%":e.percent+"",s=e.minus===void 0?"-":e.minus+"",u=e.nan===void 0?"NaN":e.nan+"";function l(d){d=SC(d);var f=d.fill,h=d.align,v=d.sign,p=d.symbol,m=d.zero,g=d.width,y=d.comma,b=d.precision,S=d.trim,x=d.type;x==="n"?(y=!0,x="g"):TB[x]||(b===void 0&&(b=12),S=!0,x="g"),(m||f==="0"&&h==="=")&&(m=!0,f="0",h="=");var C=p==="$"?r:p==="#"&&/[boxX]/.test(x)?"0"+x.toLowerCase():"",w=p==="$"?n:/[%p]/.test(x)?o:"",A=TB[x],M=/[defgprs%]/.test(x);b=b===void 0?6:/[gprs]/.test(x)?Math.max(1,Math.min(21,b)):Math.max(0,Math.min(20,b));function D(k){var R=C,L=w,H,B,j;if(x==="c")L=A(k)+L,k="";else{k=+k;var Q=k<0||1/k<0;if(k=isNaN(k)?u:A(Math.abs(k),b),S&&(k=mye(k)),Q&&+k==0&&v!=="+"&&(Q=!1),R=(Q?v==="("?v:s:v==="-"||v==="("?"":v)+R,L=(x==="s"?DB[8+nX/3]:"")+L+(Q&&v==="("?")":""),M){for(H=-1,B=k.length;++H<B;)if(j=k.charCodeAt(H),48>j||j>57){L=(j===46?i+k.slice(H+1):k.slice(H))+L,k=k.slice(0,H);break}}}y&&!m&&(k=t(k,1/0));var G=R.length+k.length+L.length,W=G<g?new Array(g-G+1).join(f):"";switch(y&&m&&(k=t(W+k,W.length?g-L.length:1/0),W=""),h){case"<":k=R+k+L+W;break;case"=":k=R+W+k+L;break;case"^":k=W.slice(0,G=W.length>>1)+R+k+L+W.slice(G);break;default:k=W+R+k+L;break}return a(k)}return D.toString=function(){return d+""},D}function c(d,f){var h=l((d=SC(d),d.type="f",d)),v=Math.max(-8,Math.min(8,Math.floor(mg(f)/3)))*3,p=Math.pow(10,-v),m=DB[8+v/3];return function(g){return h(p*g)+m}}return{format:l,formatPrefix:c}}var E2,CC,iX;bye({decimal:".",thousands:",",grouping:[3],currency:["$",""],minus:"-"});function bye(e){return E2=yye(e),CC=E2.format,iX=E2.formatPrefix,E2}function xye(e){return Math.max(0,-mg(Math.abs(e)))}function Sye(e,t){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(mg(t)/3)))*3-mg(Math.abs(e)))}function Cye(e,t){return e=Math.abs(e),t=Math.abs(t)-e,Math.max(0,mg(t)-mg(e))+1}function Vg(){return Math.random()}(function e(t){function r(n,i){return n=n==null?0:+n,i=i==null?1:+i,arguments.length===1?(i=n,n=0):i-=n,function(){return t()*i+n}}return r.source=e,r})(Vg);const _ye=function e(t){function r(n,i){var a,o;return n=n==null?0:+n,i=i==null?1:+i,function(){var s;if(a!=null)s=a,a=null;else do a=t()*2-1,s=t()*2-1,o=a*a+s*s;while(!o||o>1);return n+i*s*Math.sqrt(-2*Math.log(o)/o)}}return r.source=e,r}(Vg);(function e(t){function r(){var n=_ye.source(t).apply(this,arguments);return function(){return Math.exp(n())}}return r.source=e,r})(Vg);const wye=function e(t){function r(n){return function(){for(var i=0,a=0;a<n;++a)i+=t();return i}}return r.source=e,r}(Vg);(function e(t){function r(n){var i=wye.source(t)(n);return function(){return i()/n}}return r.source=e,r})(Vg);(function e(t){function r(n){return function(){return-Math.log(1-t())/n}}return r.source=e,r})(Vg);function e3(e,t){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(t).domain(e);break}return this}var aX=Array.prototype,Eye=aX.map,tM=aX.slice,RB={name:"implicit"};function oX(){var e=bC(),t=[],r=[],n=RB;function i(a){var o=a+"",s=e.get(o);if(!s){if(n!==RB)return n;e.set(o,s=t.push(a))}return r[(s-1)%r.length]}return i.domain=function(a){if(!arguments.length)return t.slice();t=[],e=bC();for(var o=-1,s=a.length,u,l;++o<s;)e.has(l=(u=a[o])+"")||e.set(l,t.push(u));return i},i.range=function(a){return arguments.length?(r=tM.call(a),i):r.slice()},i.unknown=function(a){return arguments.length?(n=a,i):n},i.copy=function(){return oX(t,r).unknown(n)},e3.apply(i,arguments),i}function sX(){var e=oX().unknown(void 0),t=e.domain,r=e.range,n=[0,1],i,a,o=!1,s=0,u=0,l=.5;delete e.unknown;function c(){var d=t().length,f=n[1]<n[0],h=n[f-0],v=n[1-f];i=(v-h)/Math.max(1,d-s+u*2),o&&(i=Math.floor(i)),h+=(v-h-i*(d-s))*l,a=i*(1-s),o&&(h=Math.round(h),a=Math.round(a));var p=Uve(d).map(function(m){return h+i*m});return r(f?p.reverse():p)}return e.domain=function(d){return arguments.length?(t(d),c()):t()},e.range=function(d){return arguments.length?(n=[+d[0],+d[1]],c()):n.slice()},e.rangeRound=function(d){return n=[+d[0],+d[1]],o=!0,c()},e.bandwidth=function(){return a},e.step=function(){return i},e.round=function(d){return arguments.length?(o=!!d,c()):o},e.padding=function(d){return arguments.length?(s=Math.min(1,u=+d),c()):s},e.paddingInner=function(d){return arguments.length?(s=Math.min(1,d),c()):s},e.paddingOuter=function(d){return arguments.length?(u=+d,c()):u},e.align=function(d){return arguments.length?(l=Math.max(0,Math.min(1,d)),c()):l},e.copy=function(){return sX(t(),n).round(o).paddingInner(s).paddingOuter(u).align(l)},e3.apply(c(),arguments)}function uX(e){var t=e.copy;return e.padding=e.paddingOuter,delete e.paddingInner,delete e.paddingOuter,e.copy=function(){return uX(t())},e}function Aye(){return uX(sX.apply(null,arguments).paddingInner(1))}function Pye(e){return function(){return e}}function Tye(e){return+e}var kB=[0,1];function ll(e){return e}function rM(e,t){return(t-=e=+e)?function(r){return(r-e)/t}:Pye(isNaN(t)?NaN:.5)}function OB(e){var t=e[0],r=e[e.length-1],n;return t>r&&(n=t,t=r,r=n),function(i){return Math.max(t,Math.min(r,i))}}function Iye(e,t,r){var n=e[0],i=e[1],a=t[0],o=t[1];return i<n?(n=rM(i,n),a=r(o,a)):(n=rM(n,i),a=r(a,o)),function(s){return a(n(s))}}function Mye(e,t,r){var n=Math.min(e.length,t.length)-1,i=new Array(n),a=new Array(n),o=-1;for(e[n]<e[0]&&(e=e.slice().reverse(),t=t.slice().reverse());++o<n;)i[o]=rM(e[o],e[o+1]),a[o]=r(t[o],t[o+1]);return function(s){var u=Bve(e,s,1,n)-1;return a[u](i[u](s))}}function lX(e,t){return t.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function cX(){var e=kB,t=kB,r=Kw,n,i,a,o=ll,s,u,l;function c(){return s=Math.min(e.length,t.length)>2?Mye:Iye,u=l=null,d}function d(f){return isNaN(f=+f)?a:(u||(u=s(e.map(n),t,r)))(n(o(f)))}return d.invert=function(f){return o(i((l||(l=s(t,e.map(n),iu)))(f)))},d.domain=function(f){return arguments.length?(e=Eye.call(f,Tye),o===ll||(o=OB(e)),c()):e.slice()},d.range=function(f){return arguments.length?(t=tM.call(f),c()):t.slice()},d.rangeRound=function(f){return t=tM.call(f),r=Bge,c()},d.clamp=function(f){return arguments.length?(o=f?OB(e):ll,d):o!==ll},d.interpolate=function(f){return arguments.length?(r=f,c()):r},d.unknown=function(f){return arguments.length?(a=f,d):a},function(f,h){return n=f,i=h,c()}}function Dye(e,t){return cX()(e,t)}function Rye(e,t,r,n){var i=zve(e,t,r),a;switch(n=SC(n??",f"),n.type){case"s":{var o=Math.max(Math.abs(e),Math.abs(t));return n.precision==null&&!isNaN(a=Sye(i,o))&&(n.precision=a),iX(n,o)}case"":case"e":case"g":case"p":case"r":{n.precision==null&&!isNaN(a=Cye(i,Math.max(Math.abs(e),Math.abs(t))))&&(n.precision=a-(n.type==="e"));break}case"f":case"%":{n.precision==null&&!isNaN(a=xye(i))&&(n.precision=a-(n.type==="%")*2);break}}return CC(n)}function dX(e){var t=e.domain;return e.ticks=function(r){var n=t();return jve(n[0],n[n.length-1],r??10)},e.tickFormat=function(r,n){var i=t();return Rye(i[0],i[i.length-1],r??10,n)},e.nice=function(r){r==null&&(r=10);var n=t(),i=0,a=n.length-1,o=n[i],s=n[a],u;return s<o&&(u=o,o=s,s=u,u=i,i=a,a=u),u=tS(o,s,r),u>0?(o=Math.floor(o/u)*u,s=Math.ceil(s/u)*u,u=tS(o,s,r)):u<0&&(o=Math.ceil(o*u)/u,s=Math.floor(s*u)/u,u=tS(o,s,r)),u>0?(n[i]=Math.floor(o/u)*u,n[a]=Math.ceil(s/u)*u,t(n)):u<0&&(n[i]=Math.ceil(o*u)/u,n[a]=Math.floor(s*u)/u,t(n)),e},e}function Cb(){var e=Dye(ll,ll);return e.copy=function(){return lX(e,Cb())},e3.apply(e,arguments),dX(e)}function LB(e){return function(t){return t<0?-Math.pow(-t,e):Math.pow(t,e)}}function kye(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function Oye(e){return e<0?-e*e:e*e}function Lye(e){var t=e(ll,ll),r=1;function n(){return r===1?e(ll,ll):r===.5?e(kye,Oye):e(LB(r),LB(1/r))}return t.exponent=function(i){return arguments.length?(r=+i,n()):r},dX(t)}function fX(){var e=Lye(cX());return e.copy=function(){return lX(e,fX()).exponent(e.exponent())},e3.apply(e,arguments),e}function A2(e){return function(){return e}}function hX(e){this._context=e}hX.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:this._context.lineTo(e,t);break}}};function Nye(e){return new hX(e)}function Fye(e){return e[0]}function Bye(e){return e[1]}function Uye(){var e=Fye,t=Bye,r=A2(!0),n=null,i=Nye,a=null;function o(s){var u,l=s.length,c,d=!1,f;for(n==null&&(a=i(f=rX())),u=0;u<=l;++u)!(u<l&&r(c=s[u],u,s))===d&&((d=!d)?a.lineStart():a.lineEnd()),d&&a.point(+e(c,u,s),+t(c,u,s));if(f)return a=null,f+""||null}return o.x=function(s){return arguments.length?(e=typeof s=="function"?s:A2(+s),o):e},o.y=function(s){return arguments.length?(t=typeof s=="function"?s:A2(+s),o):t},o.defined=function(s){return arguments.length?(r=typeof s=="function"?s:A2(!!s),o):r},o.curve=function(s){return arguments.length?(i=s,n!=null&&(a=i(n)),o):i},o.context=function(s){return arguments.length?(s==null?n=a=null:a=i(n=s),o):n},o}function _C(){this._=null}function t3(e){e.U=e.C=e.L=e.R=e.P=e.N=null}_C.prototype={constructor:_C,insert:function(e,t){var r,n,i;if(e){if(t.P=e,t.N=e.N,e.N&&(e.N.P=t),e.N=t,e.R){for(e=e.R;e.L;)e=e.L;e.L=t}else e.R=t;r=e}else this._?(e=NB(this._),t.P=null,t.N=e,e.P=e.L=t,r=e):(t.P=t.N=null,this._=t,r=null);for(t.L=t.R=null,t.U=r,t.C=!0,e=t;r&&r.C;)n=r.U,r===n.L?(i=n.R,i&&i.C?(r.C=i.C=!1,n.C=!0,e=n):(e===r.R&&(A0(this,r),e=r,r=e.U),r.C=!1,n.C=!0,P0(this,n))):(i=n.L,i&&i.C?(r.C=i.C=!1,n.C=!0,e=n):(e===r.L&&(P0(this,r),e=r,r=e.U),r.C=!1,n.C=!0,A0(this,n))),r=e.U;this._.C=!1},remove:function(e){e.N&&(e.N.P=e.P),e.P&&(e.P.N=e.N),e.N=e.P=null;var t=e.U,r,n=e.L,i=e.R,a,o;if(n?i?a=NB(i):a=n:a=i,t?t.L===e?t.L=a:t.R=a:this._=a,n&&i?(o=a.C,a.C=e.C,a.L=n,n.U=a,a!==i?(t=a.U,a.U=e.U,e=a.R,t.L=e,a.R=i,i.U=a):(a.U=t,t=a,e=a.R)):(o=e.C,e=a),e&&(e.U=t),!o){if(e&&e.C){e.C=!1;return}do{if(e===this._)break;if(e===t.L){if(r=t.R,r.C&&(r.C=!1,t.C=!0,A0(this,t),r=t.R),r.L&&r.L.C||r.R&&r.R.C){(!r.R||!r.R.C)&&(r.L.C=!1,r.C=!0,P0(this,r),r=t.R),r.C=t.C,t.C=r.R.C=!1,A0(this,t),e=this._;break}}else if(r=t.L,r.C&&(r.C=!1,t.C=!0,P0(this,t),r=t.L),r.L&&r.L.C||r.R&&r.R.C){(!r.L||!r.L.C)&&(r.R.C=!1,r.C=!0,A0(this,r),r=t.L),r.C=t.C,t.C=r.L.C=!1,P0(this,t),e=this._;break}r.C=!0,e=t,t=t.U}while(!e.C);e&&(e.C=!1)}}};function A0(e,t){var r=t,n=t.R,i=r.U;i?i.L===r?i.L=n:i.R=n:e._=n,n.U=i,r.U=n,r.R=n.L,r.R&&(r.R.U=r),n.L=r}function P0(e,t){var r=t,n=t.L,i=r.U;i?i.L===r?i.L=n:i.R=n:e._=n,n.U=i,r.U=n,r.L=n.R,r.L&&(r.L.U=r),n.R=r}function NB(e){for(;e.L;)e=e.L;return e}function py(e,t,r,n){var i=[null,null],a=Ca.push(i)-1;return i.left=e,i.right=t,r&&wC(i,e,t,r),n&&wC(i,t,e,n),Oo[e.index].halfedges.push(a),Oo[t.index].halfedges.push(a),i}function T0(e,t,r){var n=[t,r];return n.left=e,n}function wC(e,t,r,n){!e[0]&&!e[1]?(e[0]=n,e.left=t,e.right=r):e.left===r?e[1]=n:e[0]=n}function jye(e,t,r,n,i){var a=e[0],o=e[1],s=a[0],u=a[1],l=o[0],c=o[1],d=0,f=1,h=l-s,v=c-u,p;if(p=t-s,!(!h&&p>0)){if(p/=h,h<0){if(p<d)return;p<f&&(f=p)}else if(h>0){if(p>f)return;p>d&&(d=p)}if(p=n-s,!(!h&&p<0)){if(p/=h,h<0){if(p>f)return;p>d&&(d=p)}else if(h>0){if(p<d)return;p<f&&(f=p)}if(p=r-u,!(!v&&p>0)){if(p/=v,v<0){if(p<d)return;p<f&&(f=p)}else if(v>0){if(p>f)return;p>d&&(d=p)}if(p=i-u,!(!v&&p<0)){if(p/=v,v<0){if(p>f)return;p>d&&(d=p)}else if(v>0){if(p<d)return;p<f&&(f=p)}return!(d>0)&&!(f<1)||(d>0&&(e[0]=[s+d*h,u+d*v]),f<1&&(e[1]=[s+f*h,u+f*v])),!0}}}}}function zye(e,t,r,n,i){var a=e[1];if(a)return!0;var o=e[0],s=e.left,u=e.right,l=s[0],c=s[1],d=u[0],f=u[1],h=(l+d)/2,v=(c+f)/2,p,m;if(f===c){if(h<t||h>=n)return;if(l>d){if(!o)o=[h,r];else if(o[1]>=i)return;a=[h,i]}else{if(!o)o=[h,i];else if(o[1]<r)return;a=[h,r]}}else if(p=(l-d)/(f-c),m=v-p*h,p<-1||p>1)if(l>d){if(!o)o=[(r-m)/p,r];else if(o[1]>=i)return;a=[(i-m)/p,i]}else{if(!o)o=[(i-m)/p,i];else if(o[1]<r)return;a=[(r-m)/p,r]}else if(c<f){if(!o)o=[t,p*t+m];else if(o[0]>=n)return;a=[n,p*n+m]}else{if(!o)o=[n,p*n+m];else if(o[0]<t)return;a=[t,p*t+m]}return e[0]=o,e[1]=a,!0}function Vye(e,t,r,n){for(var i=Ca.length,a;i--;)(!zye(a=Ca[i],e,t,r,n)||!jye(a,e,t,r,n)||!(Math.abs(a[0][0]-a[1][0])>Yn||Math.abs(a[0][1]-a[1][1])>Yn))&&delete Ca[i]}function Hye(e){return Oo[e.index]={site:e,halfedges:[]}}function Gye(e,t){var r=e.site,n=t.left,i=t.right;return r===i&&(i=n,n=r),i?Math.atan2(i[1]-n[1],i[0]-n[0]):(r===n?(n=t[1],i=t[0]):(n=t[0],i=t[1]),Math.atan2(n[0]-i[0],i[1]-n[1]))}function pX(e,t){return t[+(t.left!==e.site)]}function qye(e,t){return t[+(t.left===e.site)]}function Wye(){for(var e=0,t=Oo.length,r,n,i,a;e<t;++e)if((r=Oo[e])&&(a=(n=r.halfedges).length)){var o=new Array(a),s=new Array(a);for(i=0;i<a;++i)o[i]=i,s[i]=Gye(r,Ca[n[i]]);for(o.sort(function(u,l){return s[l]-s[u]}),i=0;i<a;++i)s[i]=n[o[i]];for(i=0;i<a;++i)n[i]=s[i]}}function $ye(e,t,r,n){var i=Oo.length,a,o,s,u,l,c,d,f,h,v,p,m,g=!0;for(a=0;a<i;++a)if(o=Oo[a]){for(s=o.site,l=o.halfedges,u=l.length;u--;)Ca[l[u]]||l.splice(u,1);for(u=0,c=l.length;u<c;)v=qye(o,Ca[l[u]]),p=v[0],m=v[1],d=pX(o,Ca[l[++u%c]]),f=d[0],h=d[1],(Math.abs(p-f)>Yn||Math.abs(m-h)>Yn)&&(l.splice(u,0,Ca.push(T0(s,v,Math.abs(p-e)<Yn&&n-m>Yn?[e,Math.abs(f-e)<Yn?h:n]:Math.abs(m-n)<Yn&&r-p>Yn?[Math.abs(h-n)<Yn?f:r,n]:Math.abs(p-r)<Yn&&m-t>Yn?[r,Math.abs(f-r)<Yn?h:t]:Math.abs(m-t)<Yn&&p-e>Yn?[Math.abs(h-t)<Yn?f:e,t]:null))-1),++c);c&&(g=!1)}if(g){var y,b,S,x=1/0;for(a=0,g=null;a<i;++a)(o=Oo[a])&&(s=o.site,y=s[0]-e,b=s[1]-t,S=y*y+b*b,S<x&&(x=S,g=o));if(g){var C=[e,t],w=[e,n],A=[r,n],M=[r,t];g.halfedges.push(Ca.push(T0(s=g.site,C,w))-1,Ca.push(T0(s,w,A))-1,Ca.push(T0(s,A,M))-1,Ca.push(T0(s,M,C))-1)}}for(a=0;a<i;++a)(o=Oo[a])&&(o.halfedges.length||delete Oo[a])}var vX=[],xk;function Xye(){t3(this),this.x=this.y=this.arc=this.site=this.cy=null}function _m(e){var t=e.P,r=e.N;if(!(!t||!r)){var n=t.site,i=e.site,a=r.site;if(n!==a){var o=i[0],s=i[1],u=n[0]-o,l=n[1]-s,c=a[0]-o,d=a[1]-s,f=2*(u*d-l*c);if(!(f>=-Jye)){var h=u*u+l*l,v=c*c+d*d,p=(d*h-l*v)/f,m=(u*v-c*h)/f,g=vX.pop()||new Xye;g.arc=e,g.site=i,g.x=p+o,g.y=(g.cy=m+s)+Math.sqrt(p*p+m*m),e.circle=g;for(var y=null,b=O1._;b;)if(g.y<b.y||g.y===b.y&&g.x<=b.x)if(b.L)b=b.L;else{y=b.P;break}else if(b.R)b=b.R;else{y=b;break}O1.insert(y,g),y||(xk=g)}}}}function qm(e){var t=e.circle;t&&(t.P||(xk=t.N),O1.remove(t),vX.push(t),t3(t),e.circle=null)}var mX=[];function Yye(){t3(this),this.edge=this.site=this.circle=null}function FB(e){var t=mX.pop()||new Yye;return t.site=e,t}function WA(e){qm(e),Wm.remove(e),mX.push(e),t3(e)}function Kye(e){var t=e.circle,r=t.x,n=t.cy,i=[r,n],a=e.P,o=e.N,s=[e];WA(e);for(var u=a;u.circle&&Math.abs(r-u.circle.x)<Yn&&Math.abs(n-u.circle.cy)<Yn;)a=u.P,s.unshift(u),WA(u),u=a;s.unshift(u),qm(u);for(var l=o;l.circle&&Math.abs(r-l.circle.x)<Yn&&Math.abs(n-l.circle.cy)<Yn;)o=l.N,s.push(l),WA(l),l=o;s.push(l),qm(l);var c=s.length,d;for(d=1;d<c;++d)l=s[d],u=s[d-1],wC(l.edge,u.site,l.site,i);u=s[0],l=s[c-1],l.edge=py(u.site,l.site,null,i),_m(u),_m(l)}function Qye(e){for(var t=e[0],r=e[1],n,i,a,o,s=Wm._;s;)if(a=gX(s,r)-t,a>Yn)s=s.L;else if(o=t-Zye(s,r),o>Yn){if(!s.R){n=s;break}s=s.R}else{a>-Yn?(n=s.P,i=s):o>-Yn?(n=s,i=s.N):n=i=s;break}Hye(e);var u=FB(e);if(Wm.insert(n,u),!(!n&&!i)){if(n===i){qm(n),i=FB(n.site),Wm.insert(u,i),u.edge=i.edge=py(n.site,u.site),_m(n),_m(i);return}if(!i){u.edge=py(n.site,u.site);return}qm(n),qm(i);var l=n.site,c=l[0],d=l[1],f=e[0]-c,h=e[1]-d,v=i.site,p=v[0]-c,m=v[1]-d,g=2*(f*m-h*p),y=f*f+h*h,b=p*p+m*m,S=[(m*y-h*b)/g+c,(f*b-p*y)/g+d];wC(i.edge,l,v,S),u.edge=py(l,e,null,S),i.edge=py(e,v,null,S),_m(n),_m(i)}}function gX(e,t){var r=e.site,n=r[0],i=r[1],a=i-t;if(!a)return n;var o=e.P;if(!o)return-1/0;r=o.site;var s=r[0],u=r[1],l=u-t;if(!l)return s;var c=s-n,d=1/a-1/l,f=c/l;return d?(-f+Math.sqrt(f*f-2*d*(c*c/(-2*l)-u+l/2+i-a/2)))/d+n:(n+s)/2}function Zye(e,t){var r=e.N;if(r)return gX(r,t);var n=e.site;return n[1]===t?n[0]:1/0}var Yn=1e-6,Jye=1e-12,Wm,Oo,O1,Ca;function e1e(e,t,r){return(e[0]-r[0])*(t[1]-e[1])-(e[0]-t[0])*(r[1]-e[1])}function t1e(e,t){return t[1]-e[1]||t[0]-e[0]}function BB(e,t){var r=e.sort(t1e).pop(),n,i,a;for(Ca=[],Oo=new Array(e.length),Wm=new _C,O1=new _C;;)if(a=xk,r&&(!a||r[1]<a.y||r[1]===a.y&&r[0]<a.x))(r[0]!==n||r[1]!==i)&&(Qye(r),n=r[0],i=r[1]),r=e.pop();else if(a)Kye(a.arc);else break;if(Wye(),t){var o=+t[0][0],s=+t[0][1],u=+t[1][0],l=+t[1][1];Vye(o,s,u,l),$ye(o,s,u,l)}this.edges=Ca,this.cells=Oo,Wm=O1=Ca=Oo=null}BB.prototype={constructor:BB,polygons:function(){var e=this.edges;return this.cells.map(function(t){var r=t.halfedges.map(function(n){return pX(t,e[n])});return r.data=t.site.data,r})},triangles:function(){var e=[],t=this.edges;return this.cells.forEach(function(r,n){if(s=(a=r.halfedges).length)for(var i=r.site,a,o=-1,s,u,l=t[a[s-1]],c=l.left===i?l.right:l.left;++o<s;)u=c,l=t[a[o]],c=l.left===i?l.right:l.left,u&&c&&n<u.index&&n<c.index&&e1e(i,u,c)<0&&e.push([i.data,u.data,c.data])}),e},links:function(){return this.edges.filter(function(e){return e.right}).map(function(e){return{source:e.left.data,target:e.right.data}})},find:function(e,t,r){for(var n=this,i,a=n._found||0,o=n.cells.length,s;!(s=n.cells[a]);)if(++a>=o)return null;var u=e-s.site[0],l=t-s.site[1],c=u*u+l*l;do s=n.cells[i=a],a=null,s.halfedges.forEach(function(d){var f=n.edges[d],h=f.left;if(!((h===s.site||!h)&&!(h=f.right))){var v=e-h[0],p=t-h[1],m=v*v+p*p;m<c&&(c=m,a=h.index)}});while(a!==null);return n._found=i,r==null||c<=r*r?s.site:null}};function P2(e){return function(){return e}}function r1e(e,t,r){this.target=e,this.type=t,this.transform=r}function cc(e,t,r){this.k=e,this.x=t,this.y=r}cc.prototype={constructor:cc,scale:function(e){return e===1?this:new cc(this.k*e,this.x,this.y)},translate:function(e,t){return e===0&t===0?this:new cc(this.k,this.x+this.k*e,this.y+this.k*t)},apply:function(e){return[e[0]*this.k+this.x,e[1]*this.k+this.y]},applyX:function(e){return e*this.k+this.x},applyY:function(e){return e*this.k+this.y},invert:function(e){return[(e[0]-this.x)/this.k,(e[1]-this.y)/this.k]},invertX:function(e){return(e-this.x)/this.k},invertY:function(e){return(e-this.y)/this.k},rescaleX:function(e){return e.copy().domain(e.range().map(this.invertX,this).map(e.invert,e))},rescaleY:function(e){return e.copy().domain(e.range().map(this.invertY,this).map(e.invert,e))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var Sk=new cc(1,0,0);cc.prototype;function $A(){qt.stopImmediatePropagation()}function I0(){qt.preventDefault(),qt.stopImmediatePropagation()}function n1e(){return!qt.ctrlKey&&!qt.button}function i1e(){var e=this;return e instanceof SVGElement?(e=e.ownerSVGElement||e,e.hasAttribute("viewBox")?(e=e.viewBox.baseVal,[[e.x,e.y],[e.x+e.width,e.y+e.height]]):[[0,0],[e.width.baseVal.value,e.height.baseVal.value]]):[[0,0],[e.clientWidth,e.clientHeight]]}function UB(){return this.__zoom||Sk}function a1e(){return-qt.deltaY*(qt.deltaMode===1?.05:qt.deltaMode?1:.002)}function o1e(){return navigator.maxTouchPoints||"ontouchstart"in this}function s1e(e,t,r){var n=e.invertX(t[0][0])-r[0][0],i=e.invertX(t[1][0])-r[1][0],a=e.invertY(t[0][1])-r[0][1],o=e.invertY(t[1][1])-r[1][1];return e.translate(i>n?(n+i)/2:Math.min(0,n)||Math.max(0,i),o>a?(a+o)/2:Math.min(0,a)||Math.max(0,o))}function u1e(){var e=n1e,t=i1e,r=s1e,n=a1e,i=o1e,a=[0,1/0],o=[[-1/0,-1/0],[1/0,1/0]],s=250,u=Wge,l=Xw("start","zoom","end"),c,d,f=500,h=150,v=0;function p(R){R.property("__zoom",UB).on("wheel.zoom",C).on("mousedown.zoom",w).on("dblclick.zoom",A).filter(i).on("touchstart.zoom",M).on("touchmove.zoom",D).on("touchend.zoom touchcancel.zoom",k).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}p.transform=function(R,L,H){var B=R.selection?R.selection():R;B.property("__zoom",UB),R!==B?b(R,L,H):B.interrupt().each(function(){S(this,arguments).start().zoom(null,typeof L=="function"?L.apply(this,arguments):L).end()})},p.scaleBy=function(R,L,H){p.scaleTo(R,function(){var B=this.__zoom.k,j=typeof L=="function"?L.apply(this,arguments):L;return B*j},H)},p.scaleTo=function(R,L,H){p.transform(R,function(){var B=t.apply(this,arguments),j=this.__zoom,Q=H==null?y(B):typeof H=="function"?H.apply(this,arguments):H,G=j.invert(Q),W=typeof L=="function"?L.apply(this,arguments):L;return r(g(m(j,W),Q,G),B,o)},H)},p.translateBy=function(R,L,H){p.transform(R,function(){return r(this.__zoom.translate(typeof L=="function"?L.apply(this,arguments):L,typeof H=="function"?H.apply(this,arguments):H),t.apply(this,arguments),o)})},p.translateTo=function(R,L,H,B){p.transform(R,function(){var j=t.apply(this,arguments),Q=this.__zoom,G=B==null?y(j):typeof B=="function"?B.apply(this,arguments):B;return r(Sk.translate(G[0],G[1]).scale(Q.k).translate(typeof L=="function"?-L.apply(this,arguments):-L,typeof H=="function"?-H.apply(this,arguments):-H),j,o)},B)};function m(R,L){return L=Math.max(a[0],Math.min(a[1],L)),L===R.k?R:new cc(L,R.x,R.y)}function g(R,L,H){var B=L[0]-H[0]*R.k,j=L[1]-H[1]*R.k;return B===R.x&&j===R.y?R:new cc(R.k,B,j)}function y(R){return[(+R[0][0]+ +R[1][0])/2,(+R[0][1]+ +R[1][1])/2]}function b(R,L,H){R.on("start.zoom",function(){S(this,arguments).start()}).on("interrupt.zoom end.zoom",function(){S(this,arguments).end()}).tween("zoom",function(){var B=this,j=arguments,Q=S(B,j),G=t.apply(B,j),W=H==null?y(G):typeof H=="function"?H.apply(B,j):H,q=Math.max(G[1][0]-G[0][0],G[1][1]-G[0][1]),ee=B.__zoom,he=typeof L=="function"?L.apply(B,j):L,$=u(ee.invert(W).concat(q/ee.k),he.invert(W).concat(q/he.k));return function(X){if(X===1)X=he;else{var U=$(X),z=q/U[2];X=new cc(z,W[0]-U[0]*z,W[1]-U[1]*z)}Q.zoom(null,X)}})}function S(R,L,H){return!H&&R.__zooming||new x(R,L)}function x(R,L){this.that=R,this.args=L,this.active=0,this.extent=t.apply(R,L),this.taps=0}x.prototype={start:function(){return++this.active===1&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(R,L){return this.mouse&&R!=="mouse"&&(this.mouse[1]=L.invert(this.mouse[0])),this.touch0&&R!=="touch"&&(this.touch0[1]=L.invert(this.touch0[0])),this.touch1&&R!=="touch"&&(this.touch1[1]=L.invert(this.touch1[0])),this.that.__zoom=L,this.emit("zoom"),this},end:function(){return--this.active===0&&(delete this.that.__zooming,this.emit("end")),this},emit:function(R){N$(new r1e(p,R,this.that.__zoom),l.apply,l,[R,this.that,this.args])}};function C(){if(!e.apply(this,arguments))return;var R=S(this,arguments),L=this.__zoom,H=Math.max(a[0],Math.min(a[1],L.k*Math.pow(2,n.apply(this,arguments)))),B=dy(this);if(R.wheel)(R.mouse[0][0]!==B[0]||R.mouse[0][1]!==B[1])&&(R.mouse[1]=L.invert(R.mouse[0]=B)),clearTimeout(R.wheel);else{if(L.k===H)return;R.mouse=[B,L.invert(B)],Gm(this),R.start()}I0(),R.wheel=setTimeout(j,h),R.zoom("mouse",r(g(m(L,H),R.mouse[0],R.mouse[1]),R.extent,o));function j(){R.wheel=null,R.end()}}function w(){if(d||!e.apply(this,arguments))return;var R=S(this,arguments,!0),L=Fi(qt.view).on("mousemove.zoom",Q,!0).on("mouseup.zoom",G,!0),H=dy(this),B=qt.clientX,j=qt.clientY;z$(qt.view),$A(),R.mouse=[H,this.__zoom.invert(H)],Gm(this),R.start();function Q(){if(I0(),!R.moved){var W=qt.clientX-B,q=qt.clientY-j;R.moved=W*W+q*q>v}R.zoom("mouse",r(g(R.that.__zoom,R.mouse[0]=dy(R.that),R.mouse[1]),R.extent,o))}function G(){L.on("mousemove.zoom mouseup.zoom",null),V$(qt.view,R.moved),I0(),R.end()}}function A(){if(e.apply(this,arguments)){var R=this.__zoom,L=dy(this),H=R.invert(L),B=R.k*(qt.shiftKey?.5:2),j=r(g(m(R,B),L,H),t.apply(this,arguments),o);I0(),s>0?Fi(this).transition().duration(s).call(b,j,L):Fi(this).call(p.transform,j)}}function M(){if(e.apply(this,arguments)){var R=qt.touches,L=R.length,H=S(this,arguments,qt.changedTouches.length===L),B,j,Q,G;for($A(),j=0;j<L;++j)Q=R[j],G=HI(this,R,Q.identifier),G=[G,this.__zoom.invert(G),Q.identifier],H.touch0?!H.touch1&&H.touch0[2]!==G[2]&&(H.touch1=G,H.taps=0):(H.touch0=G,B=!0,H.taps=1+!!c);c&&(c=clearTimeout(c)),B&&(H.taps<2&&(c=setTimeout(function(){c=null},f)),Gm(this),H.start())}}function D(){if(this.__zooming){var R=S(this,arguments),L=qt.changedTouches,H=L.length,B,j,Q,G;for(I0(),c&&(c=clearTimeout(c)),R.taps=0,B=0;B<H;++B)j=L[B],Q=HI(this,L,j.identifier),R.touch0&&R.touch0[2]===j.identifier?R.touch0[0]=Q:R.touch1&&R.touch1[2]===j.identifier&&(R.touch1[0]=Q);if(j=R.that.__zoom,R.touch1){var W=R.touch0[0],q=R.touch0[1],ee=R.touch1[0],he=R.touch1[1],$=($=ee[0]-W[0])*$+($=ee[1]-W[1])*$,X=(X=he[0]-q[0])*X+(X=he[1]-q[1])*X;j=m(j,Math.sqrt($/X)),Q=[(W[0]+ee[0])/2,(W[1]+ee[1])/2],G=[(q[0]+he[0])/2,(q[1]+he[1])/2]}else if(R.touch0)Q=R.touch0[0],G=R.touch0[1];else return;R.zoom("touch",r(g(j,Q,G),R.extent,o))}}function k(){if(this.__zooming){var R=S(this,arguments),L=qt.changedTouches,H=L.length,B,j;for($A(),d&&clearTimeout(d),d=setTimeout(function(){d=null},f),B=0;B<H;++B)j=L[B],R.touch0&&R.touch0[2]===j.identifier?delete R.touch0:R.touch1&&R.touch1[2]===j.identifier&&delete R.touch1;if(R.touch1&&!R.touch0&&(R.touch0=R.touch1,delete R.touch1),R.touch0)R.touch0[1]=this.__zoom.invert(R.touch0[0]);else if(R.end(),R.taps===2){var Q=Fi(this).on("dblclick.zoom");Q&&Q.apply(this,arguments)}}}return p.wheelDelta=function(R){return arguments.length?(n=typeof R=="function"?R:P2(+R),p):n},p.filter=function(R){return arguments.length?(e=typeof R=="function"?R:P2(!!R),p):e},p.touchable=function(R){return arguments.length?(i=typeof R=="function"?R:P2(!!R),p):i},p.extent=function(R){return arguments.length?(t=typeof R=="function"?R:P2([[+R[0][0],+R[0][1]],[+R[1][0],+R[1][1]]]),p):t},p.scaleExtent=function(R){return arguments.length?(a[0]=+R[0],a[1]=+R[1],p):[a[0],a[1]]},p.translateExtent=function(R){return arguments.length?(o[0][0]=+R[0][0],o[1][0]=+R[1][0],o[0][1]=+R[0][1],o[1][1]=+R[1][1],p):[[o[0][0],o[0][1]],[o[1][0],o[1][1]]]},p.constrain=function(R){return arguments.length?(r=R,p):r},p.duration=function(R){return arguments.length?(s=+R,p):s},p.interpolate=function(R){return arguments.length?(u=R,p):u},p.on=function(){var R=l.on.apply(l,arguments);return R===l?p:R},p.clickDistance=function(R){return arguments.length?(v=(R=+R)*R,p):Math.sqrt(v)},p}class l1e{constructor({min:t=-1/0,max:r=1/0}={}){this.segments=[],this.max=r,this.min=t,this.regionString=null}encode(t=!1){return this.segments.map(({start:r,end:n,color:i})=>{if(t)return`${r}:${n}${i?`:${i}`:""}`;const a=r===this.min?"":r,o=n===this.max?"":n;return`${a}:${o}${i?`:${i}`:""}`}).join(",")}decode(t){if(typeof t<"u"&&(this.regionString=t),!this.regionString){this.segments=[];return}this.segments=this.regionString.split(",").map(r=>{const[n,i,a,o]=r.split(":");if(typeof o<"u")throw new Error(`there should be at most 2 ':' per region. Region: ${r}`);let s=n?Number(n):this.min,u=i?Number(i):this.max;const l=a!==""?a:void 0;if(s>u&&([s,u]=[u,s]),s<this.min&&(s=this.min),u>this.max&&(u=this.max),Number.isNaN(s))throw new Error(`The parsed value of ${n} is NaN. Region: ${r}`);if(Number.isNaN(u))throw new Error(`The parsed value of ${i} is NaN. Region: ${r}`);if(l&&!l.match(/^#[0-9a-f]{6,8}$/i))throw new Error(`The parsed value of ${a} is not a color in hex format. Region: ${r}`);return{start:s,end:u,color:l}})}}const jB="#FFEB3B66",XA=(e,t)=>e?t?`${e},${t}`:e:t;let c1e=class{constructor({element:t,min:r,max:n}){this.element=t,this.element._highlightcolor=jB,this.region=new l1e({min:r,max:n}),this.fixedHighlight=null}set max(t){this.region.max=t}setAttributesInElement(){this.region.decode(this.element.getAttribute("highlight")),this.region.segments.length===0&&(this.element._highlightstart=Number(this.element.getAttribute("highlightstart")),this.element._highlightend=Number(this.element.getAttribute("highlightend")),this.element._highlightcolor=this.element.getAttribute("highlightcolor")||jB,this.element._highlightstart!==null&&this.element._highlightend!==null&&typeof this.element._highlightstart=="number"&&typeof this.element._highlightend=="number"&&(this.element._highlight=`${this.element._highlightstart}:${this.element._highlightend}`,this.region.decode(XA(this.fixedHighlight,this.element._highlight))))}setFloatAttribute(t,r){const n=parseFloat(r);this.element[`_${t}`]=Number.isNaN(n)?r:n}changedCallBack(t,r){switch(t){case"highlightstart":case"highlightend":this.setFloatAttribute(t,r),this.element._highlight=Number.isNaN(this.element._highlightstart)||Number.isNaN(this.element._highlightend)||this.element._highlightstart===void 0||this.element._highlightend===void 0||this.element._highlightstart===null||this.element._highlightend===null?"":`${Math.max(this.region.min,this.element._highlightstart)}:${Math.min(this.region.max,this.element._highlightend)}`;break;default:this.element._highlight=r}this.region.decode(XA(this.fixedHighlight,this.element._highlight)),this.element.refresh()}setFixedHighlight(t){this.fixedHighlight=t,this.region.decode(XA(t,this.element._highlight)),this.element.refresh()}appendHighlightTo(t){this.highlighted=t.append("g").attr("class","highlighted")}updateHighlight(){const t=this.highlighted.selectAll("rect").data(this.region.segments);t.enter().append("rect").style("pointer-events","none").merge(t).attr("fill",r=>r.color?r.color:this.element._highlightcolor).attr("height",this.element._height).attr("x",r=>this.element.getXFromSeqPosition(r.start)).attr("width",r=>this.element.getSingleBaseWidth()*(r.end-r.start+1)),t.exit().remove()}},d1e=class{constructor(t,r=400){this.element=t,this.timeStampWheelOutside=0,this.resetScrollableTimeout=null,this.scrollDelay=r}setElementScrollable(t){this.element.setAttribute("scrollable",t)}startResetScrollableTimer(){this.resetScrollableTimeout&&clearTimeout(this.resetScrollableTimeout),this.resetScrollableTimeout=setTimeout(()=>{this.setElementScrollable(!0),this.resetScrollableTimeout=null},this.scrollDelay)}blockScroll(t){this.timeStampWheelOutside=t,this.setElementScrollable(!1),this.startResetScrollableTimer()}wheel({target:t,timeStamp:r}){this.element.contains(t)?r<this.timeStampWheelOutside+this.scrollDelay?this.blockScroll(r):this.setElementScrollable(!0):this.blockScroll(r)}};const yX=["left","right","top","bottom"],zB=yX.map(e=>`margin${e}`),f1e=(e,t={initialValue:{top:0,bottom:0,left:0,right:0}})=>{class r extends e{constructor(){super(),this.margin=t.initialValue}static get observedAttributes(){return[...super.observedAttributes,...zB]}attributeChangedCallback(i,a,o){a!==o&&zB.includes(i)&&(this[i]=o),super.attributeChangedCallback(i,a,o)}}for(const n of yX)Object.defineProperty(r.prototype,`margin${n}`,{get(){return this.margin[n]||0},set(i){this.margin[n]=+i}});return r},h1e=c1e,bX=d1e,xX=f1e;class p1e extends HTMLElement{constructor(){super(),this._x=null,this._padding=0,this.height=40,this.dontDispatch=!1}_refreshWidth(){this.style.display="block",this.style.width="100%",this.width=this.offsetWidth-this.margin.left-this.margin.right,this.width>0&&(this._padding=10)}connectedCallback(){this._refreshWidth(),this.closest("protvista-manager")&&(this.manager=this.closest("protvista-manager"),this.manager.register(this)),this._length=parseFloat(this.getAttribute("length")),this._displaystart=parseFloat(this.getAttribute("displaystart"))||1,this._displayend=parseFloat(this.getAttribute("displayend"))||this._length,this._highlightStart=parseFloat(this.getAttribute("highlightStart")),this._highlightEnd=parseFloat(this.getAttribute("highlightEnd")),this._rulerstart=parseFloat(this.getAttribute("rulerStart"))||1,this._onResize=this._onResize.bind(this),this._createNavRuler()}disconnectedCallback(){this.manager&&this.manager.unregister(this),this._ro&&this._ro.unobserve(this),window.removeEventListener("resize",this._onResize)}static get observedAttributes(){return["length","displaystart","displayend","highlightStart","highlightEnd","width","rulerstart"]}attributeChangedCallback(t,r,n){r!==n&&(this[`_${t}`]=parseFloat(n),this._updateNavRuler())}get width(){return this._width}set width(t){this._width=t}_createNavRuler(){this._x=Cb().range([this._padding,this.width-this._padding]),this._x.domain([this._rulerstart,this._rulerstart+this._length-1]),Fi(this).selectAll("div").remove(),this._container=Fi(this).append("div").attr("class","container"),this._svg=this._container.append("svg").attr("id","").attr("width",this.width).attr("height",this.height),this._xAxis=w$(this._x),this._displaystartLabel=this._svg.append("text").attr("class","start-label").attr("x",0).attr("y",this.height-this._padding),this._displayendLabel=this._svg.append("text").attr("class","end-label").attr("x",this.width).attr("y",this.height-this._padding).attr("text-anchor","end"),this._axis=this._svg.append("g").attr("class","x axis").call(this._xAxis),this._viewport=lye().extent([[this._padding,0],[this.width-this._padding,this.height*.51]]).on("brush",()=>{qt.selection&&(this._displaystart=CC("d")(this._x.invert(qt.selection[0])),this._displayend=CC("d")(this._x.invert(qt.selection[1])),this.dontDispatch||this.dispatchEvent(new CustomEvent("change",{detail:{displayend:this._displayend,displaystart:this._displaystart,extra:{transform:qt.transform}},bubbles:!0,cancelable:!0})),this._updateLabels(),this._updatePolygon())}),this._brushG=this._svg.append("g").attr("class","brush").call(this._viewport),this._brushG.call(this._viewport.move,[this._x(this._displaystart),this._x(this._displayend)]),this.polygon=this._svg.append("polygon").attr("class","zoom-polygon").attr("fill","#777").attr("fill-opacity","0.3"),this._updateNavRuler(),"ResizeObserver"in window&&(this._ro=new ResizeObserver(this._onResize),this._ro.observe(this)),window.addEventListener("resize",this._onResize)}_onResize(){this._refreshWidth(),this._x=this._x.range([this._padding,this.width-this._padding]),this._svg.attr("width",this.width),this._viewport.extent([[this._padding,0],[this.width-this._padding,this.height*.51]]),this._brushG.call(this._viewport),this._updateNavRuler()}_updateNavRuler(){this._x&&(this._container.style("padding-left",`${this.margin.left}px`).style("padding-right",`${this.margin.right}px`).style("padding-top",`${this.margin.top}px`).style("padding-bottom",`${this.margin.bottom}px`),this._x.domain([this._rulerstart,this._rulerstart+this._length-1]),this._axis.call(this._xAxis),this._updatePolygon(),this._updateLabels(),this._brushG&&(this.dontDispatch=!0,this._brushG.call(this._viewport.move,[this._x(this._displaystart),this._x(this._displayend)]),this.dontDispatch=!1))}_updateLabels(){this._displaystartLabel&&this._displaystartLabel.text(this._displaystart),this._displayendLabel&&this._displayendLabel.attr("x",this.width).text(this._displayend)}_updatePolygon(){this.polygon&&this.polygon.attr("points",`${this._x(this._displaystart)},${this.height/2}
        ${this._x(this._displayend)},${this.height/2}
        ${this.width},${this.height}
        0,${this.height}`)}}const v1e=xX(p1e),VB=16,HB=10,GB=10,qB=5,T2=(e,t=0)=>{const r=(e||"").match(/(\d+\.?\d*)px/);return r?+r[1]:t};class m1e extends sh{static get properties(){return{title:{type:String,reflect:!0},x:{type:Number,reflect:!0},y:{type:Number,reflect:!0},visible:{type:Boolean,reflect:!0},container:{type:String,reflect:!0}}}constructor(){super(),this.title="",this.x=0,this.y=0,this.visible=!1,this.container="html",this._changeHandler=()=>this.requestUpdate(),this._observer=new MutationObserver(this._changeHandler)}connectedCallback(){super.connectedCallback(),this._observer.observe(this,{subtree:!0,characterData:!0,childList:!0}),window.addEventListener("resize",this._changeHandler)}disconnectedCallback(){super.disconnectedCallback(),this._observer.disconnect(),window.removeEventListener("resize",this._changeHandler)}static get styles(){return zs`
      :host {
        --z-index: 50000;
        --title-color: black;
        --text-color: white;
        --body-color: #616161;
        --triangle-width: ${VB}px;
        --triangle-height: ${HB}px;
        --triangle-margin: ${GB}px;
        --vertical-distance: ${qB}px;
      }

      h1,
      h2,
      h3,
      h4,
      h5,
      h6 {
        margin: 0;
      }

      h1 {
        background-color: var(--title-color);
        line-height: 2em;
        padding: 0 1ch;
      }

      .tooltip {
        font-family: Roboto, Arial, sans-serif;
        font-size: 0.9rem;
        top: 0;
        left: 0;
        display: block;
        position: absolute;
        min-width: 220px;
        max-width: 50vw;

        /* user overridable through custom properties */
        z-index: var(--z-index);
        color: var(--text-color);

        /* will change those */
        opacity: 0;
        pointer-events: none;
        transform: translate(0, 0);
      }

      .tooltip.visible {
        opacity: 0.9;
        pointer-events: auto;
      }

      .tooltip::before {
        content: "";
        position: absolute;
        pointer-events: none;
        border-style: solid;
        border-color: transparent;
        border-width: 0 calc(var(--triangle-width) / 2);
      }

      .tooltip.arrow-left::before {
        left: var(--triangle-margin);
      }

      .tooltip.arrow-right::before {
        right: var(--triangle-margin);
      }

      .tooltip.arrow-up::before {
        top: calc(-1 * var(--triangle-height));
        border-bottom-color: var(--title-color);
        border-bottom-width: var(--triangle-height);
      }

      .tooltip.arrow-down::before {
        bottom: calc(-1 * var(--triangle-height));
        border-top-color: var(--body-color);
        border-top-width: var(--triangle-height);
      }

      :host a,
      :host a:link,
      :host a:active,
      :host a:hover,
      ::slotted(a),
      ::slotted(a:link),
      ::slotted(a:active),
      ::slotted(a:hover) {
        color: #fff;
      }

      .tooltip-body {
        padding: 1em;
        background: var(--body-color);
        font-weight: normal;
        overflow-y: auto;
        max-height: 40vh;
      }

      ::slotted(h4) {
        font-size: 1.2rem !important;
        margin: 0 0 0.5rem 0 !important;
        font-weight: 600 !important;
        color: #fff !important;
      }

      ::slotted(h5) {
        font-size: 1rem !important;
        margin: 0 !important;
        font-weight: 500 !important;
        color: #fff !important;
      }

      ::slotted(h6) {
        font-size: 1rem !important;
        margin: 0 !important;
        font-weight: 300 !important;
        color: #fff !important;
      }

      ::slotted(p) {
        margin: 0.25rem 0 1rem 0 !important;
      }

      ::slotted(ul) {
        list-style: none !important;
        margin: 0.25rem 0 1rem 0 !important;
        padding: 0 !important;
      }
    `}_getPosition(){if(!this.shadowRoot.firstElementChild)return{};const r=document.querySelector(this.container||"html").getBoundingClientRect(),n=this.shadowRoot.firstElementChild.getBoundingClientRect(),i=getComputedStyle(this),a=T2(i.getPropertyValue("--triangle-width"),VB),o=T2(i.getPropertyValue("--triangle-height"),HB),s=T2(i.getPropertyValue("--triangle-margin"),GB),u=T2(i.getPropertyValue("--vertical-distance"),qB);let l=this.x-a/2-s,c="left";l+n.width<=r.right||(c="right",l=this.x-n.width+a/2+s);let f=this.y+o+u,h="up";return f+n.height<=r.height||(h="down",f=this.y-n.height-o-u),{x:l,y:f,horizontal:c,vertical:h}}firstUpdated(){this.requestUpdate()}render(){let t=this.title&&this.visible;const r=t?this._getPosition():{};t=r.x&&t;const n=t&&`transform: translate(${r.x}px, ${r.y}px);`;return zr`
      <section
        class="tooltip arrow-${r.horizontal||"left"} arrow-${r.vertical||"up"} ${t?"visible":""}"
        style="${n}"
      >
        <h1>${this.title}</h1>
        <div class="tooltip-body"><slot></slot></div>
      </section>
    `}}function g1e(e,t,r,n){for(var i=e.length,a=r+(n?1:-1);n?a--:++a<i;)if(t(e[a],a,e))return a;return-1}function y1e(e){return e!==e}function b1e(e,t,r){for(var n=r-1,i=e.length;++n<i;)if(e[n]===t)return n;return-1}function SX(e,t,r){return t===t?b1e(e,t,r):g1e(e,y1e,r)}var x1e=typeof global=="object"&&global&&global.Object===Object&&global;const CX=x1e;var S1e=typeof self=="object"&&self&&self.Object===Object&&self,C1e=CX||S1e||Function("return this")();const Jc=C1e;var _1e=Jc.Symbol;const bl=_1e;var _X=Object.prototype,w1e=_X.hasOwnProperty,E1e=_X.toString,M0=bl?bl.toStringTag:void 0;function A1e(e){var t=w1e.call(e,M0),r=e[M0];try{e[M0]=void 0;var n=!0}catch{}var i=E1e.call(e);return n&&(t?e[M0]=r:delete e[M0]),i}var P1e=Object.prototype,T1e=P1e.toString;function I1e(e){return T1e.call(e)}var M1e="[object Null]",D1e="[object Undefined]",WB=bl?bl.toStringTag:void 0;function sv(e){return e==null?e===void 0?D1e:M1e:WB&&WB in Object(e)?A1e(e):I1e(e)}function L1(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}var R1e="[object AsyncFunction]",k1e="[object Function]",O1e="[object GeneratorFunction]",L1e="[object Proxy]";function wX(e){if(!L1(e))return!1;var t=sv(e);return t==k1e||t==O1e||t==R1e||t==L1e}var N1e=9007199254740991;function Ck(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=N1e}function _b(e){return e!=null&&Ck(e.length)&&!wX(e)}var F1e=Array.isArray;const Wo=F1e;function Vf(e){return e!=null&&typeof e=="object"}var B1e="[object String]";function U1e(e){return typeof e=="string"||!Wo(e)&&Vf(e)&&sv(e)==B1e}var j1e=/\s/;function z1e(e){for(var t=e.length;t--&&j1e.test(e.charAt(t)););return t}var V1e=/^\s+/;function H1e(e){return e&&e.slice(0,z1e(e)+1).replace(V1e,"")}var G1e="[object Symbol]";function r3(e){return typeof e=="symbol"||Vf(e)&&sv(e)==G1e}var $B=0/0,q1e=/^[-+]0x[0-9a-f]+$/i,W1e=/^0b[01]+$/i,$1e=/^0o[0-7]+$/i,X1e=parseInt;function Y1e(e){if(typeof e=="number")return e;if(r3(e))return $B;if(L1(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=L1(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=H1e(e);var r=W1e.test(e);return r||$1e.test(e)?X1e(e.slice(2),r?2:8):q1e.test(e)?$B:+e}var XB=1/0,K1e=17976931348623157e292;function Q1e(e){if(!e)return e===0?e:0;if(e=Y1e(e),e===XB||e===-XB){var t=e<0?-1:1;return t*K1e}return e===e?e:0}function Z1e(e){var t=Q1e(e),r=t%1;return t===t?r?t-r:t:0}function wb(e,t){for(var r=-1,n=e==null?0:e.length,i=Array(n);++r<n;)i[r]=t(e[r],r,e);return i}function J1e(e,t){return wb(t,function(r){return e[r]})}function ebe(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n}var tbe="[object Arguments]";function YB(e){return Vf(e)&&sv(e)==tbe}var EX=Object.prototype,rbe=EX.hasOwnProperty,nbe=EX.propertyIsEnumerable,ibe=YB(function(){return arguments}())?YB:function(e){return Vf(e)&&rbe.call(e,"callee")&&!nbe.call(e,"callee")};const _k=ibe;function abe(){return!1}var AX=typeof exports=="object"&&exports&&!exports.nodeType&&exports,KB=AX&&typeof module=="object"&&module&&!module.nodeType&&module,obe=KB&&KB.exports===AX,QB=obe?Jc.Buffer:void 0,sbe=QB?QB.isBuffer:void 0,ube=sbe||abe;const nM=ube;var lbe=9007199254740991,cbe=/^(?:0|[1-9]\d*)$/;function PX(e,t){var r=typeof e;return t=t??lbe,!!t&&(r=="number"||r!="symbol"&&cbe.test(e))&&e>-1&&e%1==0&&e<t}var dbe="[object Arguments]",fbe="[object Array]",hbe="[object Boolean]",pbe="[object Date]",vbe="[object Error]",mbe="[object Function]",gbe="[object Map]",ybe="[object Number]",bbe="[object Object]",xbe="[object RegExp]",Sbe="[object Set]",Cbe="[object String]",_be="[object WeakMap]",wbe="[object ArrayBuffer]",Ebe="[object DataView]",Abe="[object Float32Array]",Pbe="[object Float64Array]",Tbe="[object Int8Array]",Ibe="[object Int16Array]",Mbe="[object Int32Array]",Dbe="[object Uint8Array]",Rbe="[object Uint8ClampedArray]",kbe="[object Uint16Array]",Obe="[object Uint32Array]",Bn={};Bn[Abe]=Bn[Pbe]=Bn[Tbe]=Bn[Ibe]=Bn[Mbe]=Bn[Dbe]=Bn[Rbe]=Bn[kbe]=Bn[Obe]=!0;Bn[dbe]=Bn[fbe]=Bn[wbe]=Bn[hbe]=Bn[Ebe]=Bn[pbe]=Bn[vbe]=Bn[mbe]=Bn[gbe]=Bn[ybe]=Bn[bbe]=Bn[xbe]=Bn[Sbe]=Bn[Cbe]=Bn[_be]=!1;function Lbe(e){return Vf(e)&&Ck(e.length)&&!!Bn[sv(e)]}function TX(e){return function(t){return e(t)}}var IX=typeof exports=="object"&&exports&&!exports.nodeType&&exports,Ny=IX&&typeof module=="object"&&module&&!module.nodeType&&module,Nbe=Ny&&Ny.exports===IX,YA=Nbe&&CX.process,Fbe=function(){try{var e=Ny&&Ny.require&&Ny.require("util").types;return e||YA&&YA.binding&&YA.binding("util")}catch{}}();const ZB=Fbe;var JB=ZB&&ZB.isTypedArray,Bbe=JB?TX(JB):Lbe;const MX=Bbe;var Ube=Object.prototype,jbe=Ube.hasOwnProperty;function zbe(e,t){var r=Wo(e),n=!r&&_k(e),i=!r&&!n&&nM(e),a=!r&&!n&&!i&&MX(e),o=r||n||i||a,s=o?ebe(e.length,String):[],u=s.length;for(var l in e)(t||jbe.call(e,l))&&!(o&&(l=="length"||i&&(l=="offset"||l=="parent")||a&&(l=="buffer"||l=="byteLength"||l=="byteOffset")||PX(l,u)))&&s.push(l);return s}var Vbe=Object.prototype;function Hbe(e){var t=e&&e.constructor,r=typeof t=="function"&&t.prototype||Vbe;return e===r}function Gbe(e,t){return function(r){return e(t(r))}}var qbe=Gbe(Object.keys,Object);const Wbe=qbe;var $be=Object.prototype,Xbe=$be.hasOwnProperty;function Ybe(e){if(!Hbe(e))return Wbe(e);var t=[];for(var r in Object(e))Xbe.call(e,r)&&r!="constructor"&&t.push(r);return t}function n3(e){return _b(e)?zbe(e):Ybe(e)}function Kbe(e){return e==null?[]:J1e(e,n3(e))}var Qbe=Math.max;function Zbe(e,t,r,n){e=_b(e)?e:Kbe(e),r=r&&!n?Z1e(r):0;var i=e.length;return r<0&&(r=Qbe(i+r,0)),U1e(e)?r<=i&&e.indexOf(t,r)>-1:!!i&&SX(e,t,r)>-1}var Jbe=Jc["__core-js_shared__"];const KA=Jbe;var e8=function(){var e=/[^.]+$/.exec(KA&&KA.keys&&KA.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}();function e2e(e){return!!e8&&e8 in e}var t2e=Function.prototype,r2e=t2e.toString;function uv(e){if(e!=null){try{return r2e.call(e)}catch{}try{return e+""}catch{}}return""}var n2e=/[\\^$.*+?()[\]{}|]/g,i2e=/^\[object .+?Constructor\]$/,a2e=Function.prototype,o2e=Object.prototype,s2e=a2e.toString,u2e=o2e.hasOwnProperty,l2e=RegExp("^"+s2e.call(u2e).replace(n2e,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function c2e(e){if(!L1(e)||e2e(e))return!1;var t=wX(e)?l2e:i2e;return t.test(uv(e))}function d2e(e,t){return e==null?void 0:e[t]}function lv(e,t){var r=d2e(e,t);return c2e(r)?r:void 0}var f2e=function(){try{var e=lv(Object,"defineProperty");return e({},"",{}),e}catch{}}();const EC=f2e;function h2e(e,t,r){t=="__proto__"&&EC?EC(e,t,{configurable:!0,enumerable:!0,value:r,writable:!0}):e[t]=r}function p2e(e,t,r,n){for(var i=-1,a=e==null?0:e.length;++i<a;){var o=e[i];t(n,o,r(o),e)}return n}function v2e(e){return function(t,r,n){for(var i=-1,a=Object(t),o=n(t),s=o.length;s--;){var u=o[e?s:++i];if(r(a[u],u,a)===!1)break}return t}}var m2e=v2e();const g2e=m2e;function y2e(e,t){return e&&g2e(e,t,n3)}function b2e(e,t){return function(r,n){if(r==null)return r;if(!_b(r))return e(r,n);for(var i=r.length,a=t?i:-1,o=Object(r);(t?a--:++a<i)&&n(o[a],a,o)!==!1;);return r}}var x2e=b2e(y2e);const DX=x2e;function S2e(e,t,r,n){return DX(e,function(i,a,o){t(n,i,r(i),o)}),n}function C2e(){this.__data__=[],this.size=0}function RX(e,t){return e===t||e!==e&&t!==t}function i3(e,t){for(var r=e.length;r--;)if(RX(e[r][0],t))return r;return-1}var _2e=Array.prototype,w2e=_2e.splice;function E2e(e){var t=this.__data__,r=i3(t,e);if(r<0)return!1;var n=t.length-1;return r==n?t.pop():w2e.call(t,r,1),--this.size,!0}function A2e(e){var t=this.__data__,r=i3(t,e);return r<0?void 0:t[r][1]}function P2e(e){return i3(this.__data__,e)>-1}function T2e(e,t){var r=this.__data__,n=i3(r,e);return n<0?(++this.size,r.push([e,t])):r[n][1]=t,this}function ed(e){var t=-1,r=e==null?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}ed.prototype.clear=C2e;ed.prototype.delete=E2e;ed.prototype.get=A2e;ed.prototype.has=P2e;ed.prototype.set=T2e;function I2e(){this.__data__=new ed,this.size=0}function M2e(e){var t=this.__data__,r=t.delete(e);return this.size=t.size,r}function D2e(e){return this.__data__.get(e)}function R2e(e){return this.__data__.has(e)}var k2e=lv(Jc,"Map");const N1=k2e;var O2e=lv(Object,"create");const F1=O2e;function L2e(){this.__data__=F1?F1(null):{},this.size=0}function N2e(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}var F2e="__lodash_hash_undefined__",B2e=Object.prototype,U2e=B2e.hasOwnProperty;function j2e(e){var t=this.__data__;if(F1){var r=t[e];return r===F2e?void 0:r}return U2e.call(t,e)?t[e]:void 0}var z2e=Object.prototype,V2e=z2e.hasOwnProperty;function H2e(e){var t=this.__data__;return F1?t[e]!==void 0:V2e.call(t,e)}var G2e="__lodash_hash_undefined__";function q2e(e,t){var r=this.__data__;return this.size+=this.has(e)?0:1,r[e]=F1&&t===void 0?G2e:t,this}function Bp(e){var t=-1,r=e==null?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}Bp.prototype.clear=L2e;Bp.prototype.delete=N2e;Bp.prototype.get=j2e;Bp.prototype.has=H2e;Bp.prototype.set=q2e;function W2e(){this.size=0,this.__data__={hash:new Bp,map:new(N1||ed),string:new Bp}}function $2e(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null}function a3(e,t){var r=e.__data__;return $2e(t)?r[typeof t=="string"?"string":"hash"]:r.map}function X2e(e){var t=a3(this,e).delete(e);return this.size-=t?1:0,t}function Y2e(e){return a3(this,e).get(e)}function K2e(e){return a3(this,e).has(e)}function Q2e(e,t){var r=a3(this,e),n=r.size;return r.set(e,t),this.size+=r.size==n?0:1,this}function td(e){var t=-1,r=e==null?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}td.prototype.clear=W2e;td.prototype.delete=X2e;td.prototype.get=Y2e;td.prototype.has=K2e;td.prototype.set=Q2e;var Z2e=200;function J2e(e,t){var r=this.__data__;if(r instanceof ed){var n=r.__data__;if(!N1||n.length<Z2e-1)return n.push([e,t]),this.size=++r.size,this;r=this.__data__=new td(n)}return r.set(e,t),this.size=r.size,this}function mc(e){var t=this.__data__=new ed(e);this.size=t.size}mc.prototype.clear=I2e;mc.prototype.delete=M2e;mc.prototype.get=D2e;mc.prototype.has=R2e;mc.prototype.set=J2e;var exe="__lodash_hash_undefined__";function txe(e){return this.__data__.set(e,exe),this}function rxe(e){return this.__data__.has(e)}function gg(e){var t=-1,r=e==null?0:e.length;for(this.__data__=new td;++t<r;)this.add(e[t])}gg.prototype.add=gg.prototype.push=txe;gg.prototype.has=rxe;function nxe(e,t){for(var r=-1,n=e==null?0:e.length;++r<n;)if(t(e[r],r,e))return!0;return!1}function AC(e,t){return e.has(t)}var ixe=1,axe=2;function kX(e,t,r,n,i,a){var o=r&ixe,s=e.length,u=t.length;if(s!=u&&!(o&&u>s))return!1;var l=a.get(e),c=a.get(t);if(l&&c)return l==t&&c==e;var d=-1,f=!0,h=r&axe?new gg:void 0;for(a.set(e,t),a.set(t,e);++d<s;){var v=e[d],p=t[d];if(n)var m=o?n(p,v,d,t,e,a):n(v,p,d,e,t,a);if(m!==void 0){if(m)continue;f=!1;break}if(h){if(!nxe(t,function(g,y){if(!AC(h,y)&&(v===g||i(v,g,r,n,a)))return h.push(y)})){f=!1;break}}else if(!(v===p||i(v,p,r,n,a))){f=!1;break}}return a.delete(e),a.delete(t),f}var oxe=Jc.Uint8Array;const t8=oxe;function sxe(e){var t=-1,r=Array(e.size);return e.forEach(function(n,i){r[++t]=[i,n]}),r}function wk(e){var t=-1,r=Array(e.size);return e.forEach(function(n){r[++t]=n}),r}var uxe=1,lxe=2,cxe="[object Boolean]",dxe="[object Date]",fxe="[object Error]",hxe="[object Map]",pxe="[object Number]",vxe="[object RegExp]",mxe="[object Set]",gxe="[object String]",yxe="[object Symbol]",bxe="[object ArrayBuffer]",xxe="[object DataView]",r8=bl?bl.prototype:void 0,QA=r8?r8.valueOf:void 0;function Sxe(e,t,r,n,i,a,o){switch(r){case xxe:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case bxe:return!(e.byteLength!=t.byteLength||!a(new t8(e),new t8(t)));case cxe:case dxe:case pxe:return RX(+e,+t);case fxe:return e.name==t.name&&e.message==t.message;case vxe:case gxe:return e==t+"";case hxe:var s=sxe;case mxe:var u=n&uxe;if(s||(s=wk),e.size!=t.size&&!u)return!1;var l=o.get(e);if(l)return l==t;n|=lxe,o.set(e,t);var c=kX(s(e),s(t),n,i,a,o);return o.delete(e),c;case yxe:if(QA)return QA.call(e)==QA.call(t)}return!1}function OX(e,t){for(var r=-1,n=t.length,i=e.length;++r<n;)e[i+r]=t[r];return e}function Cxe(e,t,r){var n=t(e);return Wo(e)?n:OX(n,r(e))}function _xe(e,t){for(var r=-1,n=e==null?0:e.length,i=0,a=[];++r<n;){var o=e[r];t(o,r,e)&&(a[i++]=o)}return a}function wxe(){return[]}var Exe=Object.prototype,Axe=Exe.propertyIsEnumerable,n8=Object.getOwnPropertySymbols,Pxe=n8?function(e){return e==null?[]:(e=Object(e),_xe(n8(e),function(t){return Axe.call(e,t)}))}:wxe;const Txe=Pxe;function i8(e){return Cxe(e,n3,Txe)}var Ixe=1,Mxe=Object.prototype,Dxe=Mxe.hasOwnProperty;function Rxe(e,t,r,n,i,a){var o=r&Ixe,s=i8(e),u=s.length,l=i8(t),c=l.length;if(u!=c&&!o)return!1;for(var d=u;d--;){var f=s[d];if(!(o?f in t:Dxe.call(t,f)))return!1}var h=a.get(e),v=a.get(t);if(h&&v)return h==t&&v==e;var p=!0;a.set(e,t),a.set(t,e);for(var m=o;++d<u;){f=s[d];var g=e[f],y=t[f];if(n)var b=o?n(y,g,f,t,e,a):n(g,y,f,e,t,a);if(!(b===void 0?g===y||i(g,y,r,n,a):b)){p=!1;break}m||(m=f=="constructor")}if(p&&!m){var S=e.constructor,x=t.constructor;S!=x&&"constructor"in e&&"constructor"in t&&!(typeof S=="function"&&S instanceof S&&typeof x=="function"&&x instanceof x)&&(p=!1)}return a.delete(e),a.delete(t),p}var kxe=lv(Jc,"DataView");const iM=kxe;var Oxe=lv(Jc,"Promise");const aM=Oxe;var Lxe=lv(Jc,"Set");const $m=Lxe;var Nxe=lv(Jc,"WeakMap");const oM=Nxe;var a8="[object Map]",Fxe="[object Object]",o8="[object Promise]",s8="[object Set]",u8="[object WeakMap]",l8="[object DataView]",Bxe=uv(iM),Uxe=uv(N1),jxe=uv(aM),zxe=uv($m),Vxe=uv(oM),Gh=sv;(iM&&Gh(new iM(new ArrayBuffer(1)))!=l8||N1&&Gh(new N1)!=a8||aM&&Gh(aM.resolve())!=o8||$m&&Gh(new $m)!=s8||oM&&Gh(new oM)!=u8)&&(Gh=function(e){var t=sv(e),r=t==Fxe?e.constructor:void 0,n=r?uv(r):"";if(n)switch(n){case Bxe:return l8;case Uxe:return a8;case jxe:return o8;case zxe:return s8;case Vxe:return u8}return t});const c8=Gh;var Hxe=1,d8="[object Arguments]",f8="[object Array]",I2="[object Object]",Gxe=Object.prototype,h8=Gxe.hasOwnProperty;function qxe(e,t,r,n,i,a){var o=Wo(e),s=Wo(t),u=o?f8:c8(e),l=s?f8:c8(t);u=u==d8?I2:u,l=l==d8?I2:l;var c=u==I2,d=l==I2,f=u==l;if(f&&nM(e)){if(!nM(t))return!1;o=!0,c=!1}if(f&&!c)return a||(a=new mc),o||MX(e)?kX(e,t,r,n,i,a):Sxe(e,t,u,r,n,i,a);if(!(r&Hxe)){var h=c&&h8.call(e,"__wrapped__"),v=d&&h8.call(t,"__wrapped__");if(h||v){var p=h?e.value():e,m=v?t.value():t;return a||(a=new mc),i(p,m,r,n,a)}}return f?(a||(a=new mc),Rxe(e,t,r,n,i,a)):!1}function Ek(e,t,r,n,i){return e===t?!0:e==null||t==null||!Vf(e)&&!Vf(t)?e!==e&&t!==t:qxe(e,t,r,n,Ek,i)}var Wxe=1,$xe=2;function Xxe(e,t,r,n){var i=r.length,a=i,o=!n;if(e==null)return!a;for(e=Object(e);i--;){var s=r[i];if(o&&s[2]?s[1]!==e[s[0]]:!(s[0]in e))return!1}for(;++i<a;){s=r[i];var u=s[0],l=e[u],c=s[1];if(o&&s[2]){if(l===void 0&&!(u in e))return!1}else{var d=new mc;if(n)var f=n(l,c,u,e,t,d);if(!(f===void 0?Ek(c,l,Wxe|$xe,n,d):f))return!1}}return!0}function LX(e){return e===e&&!L1(e)}function Yxe(e){for(var t=n3(e),r=t.length;r--;){var n=t[r],i=e[n];t[r]=[n,i,LX(i)]}return t}function NX(e,t){return function(r){return r==null?!1:r[e]===t&&(t!==void 0||e in Object(r))}}function Kxe(e){var t=Yxe(e);return t.length==1&&t[0][2]?NX(t[0][0],t[0][1]):function(r){return r===e||Xxe(r,e,t)}}var Qxe=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Zxe=/^\w*$/;function Ak(e,t){if(Wo(e))return!1;var r=typeof e;return r=="number"||r=="symbol"||r=="boolean"||e==null||r3(e)?!0:Zxe.test(e)||!Qxe.test(e)||t!=null&&e in Object(t)}var Jxe="Expected a function";function Pk(e,t){if(typeof e!="function"||t!=null&&typeof t!="function")throw new TypeError(Jxe);var r=function(){var n=arguments,i=t?t.apply(this,n):n[0],a=r.cache;if(a.has(i))return a.get(i);var o=e.apply(this,n);return r.cache=a.set(i,o)||a,o};return r.cache=new(Pk.Cache||td),r}Pk.Cache=td;var eSe=500;function tSe(e){var t=Pk(e,function(n){return r.size===eSe&&r.clear(),n}),r=t.cache;return t}var rSe=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,nSe=/\\(\\)?/g,iSe=tSe(function(e){var t=[];return e.charCodeAt(0)===46&&t.push(""),e.replace(rSe,function(r,n,i,a){t.push(i?a.replace(nSe,"$1"):n||r)}),t});const aSe=iSe;var oSe=1/0,p8=bl?bl.prototype:void 0,v8=p8?p8.toString:void 0;function FX(e){if(typeof e=="string")return e;if(Wo(e))return wb(e,FX)+"";if(r3(e))return v8?v8.call(e):"";var t=e+"";return t=="0"&&1/e==-oSe?"-0":t}function sSe(e){return e==null?"":FX(e)}function BX(e,t){return Wo(e)?e:Ak(e,t)?[e]:aSe(sSe(e))}var uSe=1/0;function o3(e){if(typeof e=="string"||r3(e))return e;var t=e+"";return t=="0"&&1/e==-uSe?"-0":t}function UX(e,t){t=BX(t,e);for(var r=0,n=t.length;e!=null&&r<n;)e=e[o3(t[r++])];return r&&r==n?e:void 0}function lSe(e,t,r){var n=e==null?void 0:UX(e,t);return n===void 0?r:n}function cSe(e,t){return e!=null&&t in Object(e)}function dSe(e,t,r){t=BX(t,e);for(var n=-1,i=t.length,a=!1;++n<i;){var o=o3(t[n]);if(!(a=e!=null&&r(e,o)))break;e=e[o]}return a||++n!=i?a:(i=e==null?0:e.length,!!i&&Ck(i)&&PX(o,i)&&(Wo(e)||_k(e)))}function fSe(e,t){return e!=null&&dSe(e,t,cSe)}var hSe=1,pSe=2;function vSe(e,t){return Ak(e)&&LX(t)?NX(o3(e),t):function(r){var n=lSe(r,e);return n===void 0&&n===t?fSe(r,e):Ek(t,n,hSe|pSe)}}function Tk(e){return e}function mSe(e){return function(t){return t==null?void 0:t[e]}}function gSe(e){return function(t){return UX(t,e)}}function ySe(e){return Ak(e)?mSe(o3(e)):gSe(e)}function jX(e){return typeof e=="function"?e:e==null?Tk:typeof e=="object"?Wo(e)?vSe(e[0],e[1]):Kxe(e):ySe(e)}function bSe(e,t){return function(r,n){var i=Wo(r)?p2e:S2e,a=t?t():{};return i(r,e,jX(n),a)}}var xSe=Object.prototype,SSe=xSe.hasOwnProperty,CSe=bSe(function(e,t,r){SSe.call(e,r)?e[r].push(t):h2e(e,r,[t])});const yg=CSe;var m8=bl?bl.isConcatSpreadable:void 0;function _Se(e){return Wo(e)||_k(e)||!!(m8&&e&&e[m8])}function Ik(e,t,r,n,i){var a=-1,o=e.length;for(r||(r=_Se),i||(i=[]);++a<o;){var s=e[a];t>0&&r(s)?t>1?Ik(s,t-1,r,n,i):OX(i,s):n||(i[i.length]=s)}return i}function wSe(e,t,r){switch(r.length){case 0:return e.call(t);case 1:return e.call(t,r[0]);case 2:return e.call(t,r[0],r[1]);case 3:return e.call(t,r[0],r[1],r[2])}return e.apply(t,r)}var g8=Math.max;function ESe(e,t,r){return t=g8(t===void 0?e.length-1:t,0),function(){for(var n=arguments,i=-1,a=g8(n.length-t,0),o=Array(a);++i<a;)o[i]=n[t+i];i=-1;for(var s=Array(t+1);++i<t;)s[i]=n[i];return s[t]=r(o),wSe(e,this,s)}}function ASe(e){return function(){return e}}var PSe=EC?function(e,t){return EC(e,"toString",{configurable:!0,enumerable:!1,value:ASe(t),writable:!0})}:Tk;const TSe=PSe;var ISe=800,MSe=16,DSe=Date.now;function RSe(e){var t=0,r=0;return function(){var n=DSe(),i=MSe-(n-r);if(r=n,i>0){if(++t>=ISe)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}var kSe=RSe(TSe);const OSe=kSe;function zX(e,t){return OSe(ESe(e,t,Tk),e+"")}function VX(e,t){var r=e==null?0:e.length;return!!r&&SX(e,t,0)>-1}function HX(e,t,r){for(var n=-1,i=e==null?0:e.length;++n<i;)if(r(t,e[n]))return!0;return!1}function LSe(){}var NSe=1/0,FSe=$m&&1/wk(new $m([,-0]))[1]==NSe?function(e){return new $m(e)}:LSe;const BSe=FSe;var USe=200;function jSe(e,t,r){var n=-1,i=VX,a=e.length,o=!0,s=[],u=s;if(r)o=!1,i=HX;else if(a>=USe){var l=t?null:BSe(e);if(l)return wk(l);o=!1,i=AC,u=new gg}else u=t?[]:s;e:for(;++n<a;){var c=e[n],d=t?t(c):c;if(c=r||c!==0?c:0,o&&d===d){for(var f=u.length;f--;)if(u[f]===d)continue e;t&&u.push(d),s.push(c)}else i(u,d,r)||(u!==s&&u.push(d),s.push(c))}return s}function GX(e){return Vf(e)&&_b(e)}var zSe=zX(function(e){return jSe(Ik(e,1,GX,!0))});const qX=zSe;var VSe=Math.min;function HSe(e,t,r){for(var n=r?HX:VX,i=e[0].length,a=e.length,o=a,s=Array(a),u=1/0,l=[];o--;){var c=e[o];o&&t&&(c=wb(c,TX(t))),u=VSe(c.length,u),s[o]=!r&&(t||i>=120&&c.length>=120)?new gg(o&&c):void 0}c=e[0];var d=-1,f=s[0];e:for(;++d<i&&l.length<u;){var h=c[d],v=t?t(h):h;if(h=r||h!==0?h:0,!(f?AC(f,v):n(l,v,r))){for(o=a;--o;){var p=s[o];if(!(p?AC(p,v):n(e[o],v,r)))continue e}f&&f.push(v),l.push(h)}}return l}function GSe(e){return GX(e)?e:[]}var qSe=zX(function(e){var t=wb(e,GSe);return t.length&&t[0]===e[0]?HSe(t):[]});const WX=qSe;var $X=function(){if(typeof Map<"u")return Map;function e(t,r){var n=-1;return t.some(function(i,a){return i[0]===r?(n=a,!0):!1}),n}return function(){function t(){this.__entries__=[]}return Object.defineProperty(t.prototype,"size",{get:function(){return this.__entries__.length},enumerable:!0,configurable:!0}),t.prototype.get=function(r){var n=e(this.__entries__,r),i=this.__entries__[n];return i&&i[1]},t.prototype.set=function(r,n){var i=e(this.__entries__,r);~i?this.__entries__[i][1]=n:this.__entries__.push([r,n])},t.prototype.delete=function(r){var n=this.__entries__,i=e(n,r);~i&&n.splice(i,1)},t.prototype.has=function(r){return!!~e(this.__entries__,r)},t.prototype.clear=function(){this.__entries__.splice(0)},t.prototype.forEach=function(r,n){n===void 0&&(n=null);for(var i=0,a=this.__entries__;i<a.length;i++){var o=a[i];r.call(n,o[1],o[0])}},t}()}(),sM=typeof window<"u"&&typeof document<"u"&&window.document===document,PC=function(){return typeof global<"u"&&global.Math===Math?global:typeof self<"u"&&self.Math===Math?self:typeof window<"u"&&window.Math===Math?window:Function("return this")()}(),WSe=function(){return typeof requestAnimationFrame=="function"?requestAnimationFrame.bind(PC):function(e){return setTimeout(function(){return e(Date.now())},1e3/60)}}(),$Se=2;function XSe(e,t){var r=!1,n=!1,i=0;function a(){r&&(r=!1,e()),n&&s()}function o(){WSe(a)}function s(){var u=Date.now();if(r){if(u-i<$Se)return;n=!0}else r=!0,n=!1,setTimeout(o,t);i=u}return s}var YSe=20,KSe=["top","right","bottom","left","width","height","size","weight"],QSe=typeof MutationObserver<"u",ZSe=function(){function e(){this.connected_=!1,this.mutationEventsAdded_=!1,this.mutationsObserver_=null,this.observers_=[],this.onTransitionEnd_=this.onTransitionEnd_.bind(this),this.refresh=XSe(this.refresh.bind(this),YSe)}return e.prototype.addObserver=function(t){~this.observers_.indexOf(t)||this.observers_.push(t),this.connected_||this.connect_()},e.prototype.removeObserver=function(t){var r=this.observers_,n=r.indexOf(t);~n&&r.splice(n,1),!r.length&&this.connected_&&this.disconnect_()},e.prototype.refresh=function(){var t=this.updateObservers_();t&&this.refresh()},e.prototype.updateObservers_=function(){var t=this.observers_.filter(function(r){return r.gatherActive(),r.hasActive()});return t.forEach(function(r){return r.broadcastActive()}),t.length>0},e.prototype.connect_=function(){!sM||this.connected_||(document.addEventListener("transitionend",this.onTransitionEnd_),window.addEventListener("resize",this.refresh),QSe?(this.mutationsObserver_=new MutationObserver(this.refresh),this.mutationsObserver_.observe(document,{attributes:!0,childList:!0,characterData:!0,subtree:!0})):(document.addEventListener("DOMSubtreeModified",this.refresh),this.mutationEventsAdded_=!0),this.connected_=!0)},e.prototype.disconnect_=function(){!sM||!this.connected_||(document.removeEventListener("transitionend",this.onTransitionEnd_),window.removeEventListener("resize",this.refresh),this.mutationsObserver_&&this.mutationsObserver_.disconnect(),this.mutationEventsAdded_&&document.removeEventListener("DOMSubtreeModified",this.refresh),this.mutationsObserver_=null,this.mutationEventsAdded_=!1,this.connected_=!1)},e.prototype.onTransitionEnd_=function(t){var r=t.propertyName,n=r===void 0?"":r,i=KSe.some(function(a){return!!~n.indexOf(a)});i&&this.refresh()},e.getInstance=function(){return this.instance_||(this.instance_=new e),this.instance_},e.instance_=null,e}(),XX=function(e,t){for(var r=0,n=Object.keys(t);r<n.length;r++){var i=n[r];Object.defineProperty(e,i,{value:t[i],enumerable:!1,writable:!1,configurable:!0})}return e},bg=function(e){var t=e&&e.ownerDocument&&e.ownerDocument.defaultView;return t||PC},YX=s3(0,0,0,0);function TC(e){return parseFloat(e)||0}function y8(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];return t.reduce(function(n,i){var a=e["border-"+i+"-width"];return n+TC(a)},0)}function JSe(e){for(var t=["top","right","bottom","left"],r={},n=0,i=t;n<i.length;n++){var a=i[n],o=e["padding-"+a];r[a]=TC(o)}return r}function eCe(e){var t=e.getBBox();return s3(0,0,t.width,t.height)}function tCe(e){var t=e.clientWidth,r=e.clientHeight;if(!t&&!r)return YX;var n=bg(e).getComputedStyle(e),i=JSe(n),a=i.left+i.right,o=i.top+i.bottom,s=TC(n.width),u=TC(n.height);if(n.boxSizing==="border-box"&&(Math.round(s+a)!==t&&(s-=y8(n,"left","right")+a),Math.round(u+o)!==r&&(u-=y8(n,"top","bottom")+o)),!nCe(e)){var l=Math.round(s+a)-t,c=Math.round(u+o)-r;Math.abs(l)!==1&&(s-=l),Math.abs(c)!==1&&(u-=c)}return s3(i.left,i.top,s,u)}var rCe=function(){return typeof SVGGraphicsElement<"u"?function(e){return e instanceof bg(e).SVGGraphicsElement}:function(e){return e instanceof bg(e).SVGElement&&typeof e.getBBox=="function"}}();function nCe(e){return e===bg(e).document.documentElement}function iCe(e){return sM?rCe(e)?eCe(e):tCe(e):YX}function aCe(e){var t=e.x,r=e.y,n=e.width,i=e.height,a=typeof DOMRectReadOnly<"u"?DOMRectReadOnly:Object,o=Object.create(a.prototype);return XX(o,{x:t,y:r,width:n,height:i,top:r,right:t+n,bottom:i+r,left:t}),o}function s3(e,t,r,n){return{x:e,y:t,width:r,height:n}}var oCe=function(){function e(t){this.broadcastWidth=0,this.broadcastHeight=0,this.contentRect_=s3(0,0,0,0),this.target=t}return e.prototype.isActive=function(){var t=iCe(this.target);return this.contentRect_=t,t.width!==this.broadcastWidth||t.height!==this.broadcastHeight},e.prototype.broadcastRect=function(){var t=this.contentRect_;return this.broadcastWidth=t.width,this.broadcastHeight=t.height,t},e}(),sCe=function(){function e(t,r){var n=aCe(r);XX(this,{target:t,contentRect:n})}return e}(),uCe=function(){function e(t,r,n){if(this.activeObservations_=[],this.observations_=new $X,typeof t!="function")throw new TypeError("The callback provided as parameter 1 is not a function.");this.callback_=t,this.controller_=r,this.callbackCtx_=n}return e.prototype.observe=function(t){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if(!(typeof Element>"u"||!(Element instanceof Object))){if(!(t instanceof bg(t).Element))throw new TypeError('parameter 1 is not of type "Element".');var r=this.observations_;r.has(t)||(r.set(t,new oCe(t)),this.controller_.addObserver(this),this.controller_.refresh())}},e.prototype.unobserve=function(t){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if(!(typeof Element>"u"||!(Element instanceof Object))){if(!(t instanceof bg(t).Element))throw new TypeError('parameter 1 is not of type "Element".');var r=this.observations_;r.has(t)&&(r.delete(t),r.size||this.controller_.removeObserver(this))}},e.prototype.disconnect=function(){this.clearActive(),this.observations_.clear(),this.controller_.removeObserver(this)},e.prototype.gatherActive=function(){var t=this;this.clearActive(),this.observations_.forEach(function(r){r.isActive()&&t.activeObservations_.push(r)})},e.prototype.broadcastActive=function(){if(this.hasActive()){var t=this.callbackCtx_,r=this.activeObservations_.map(function(n){return new sCe(n.target,n.broadcastRect())});this.callback_.call(t,r,t),this.clearActive()}},e.prototype.clearActive=function(){this.activeObservations_.splice(0)},e.prototype.hasActive=function(){return this.activeObservations_.length>0},e}(),KX=typeof WeakMap<"u"?new WeakMap:new $X,QX=function(){function e(t){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function.");if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");var r=ZSe.getInstance(),n=new uCe(t,r,this);KX.set(this,n)}return e}();["observe","unobserve","disconnect"].forEach(function(e){QX.prototype[e]=function(){var t;return(t=KX.get(this))[e].apply(t,arguments)}});var lCe=function(){return typeof PC.ResizeObserver<"u"?PC.ResizeObserver:QX}();class IC extends HTMLElement{constructor(){super(),IC._polyfillElementClosest(),this._updateScaleDomain=this._updateScaleDomain.bind(this),this._initZoom=this._initZoom.bind(this),this.zoomed=this.zoomed.bind(this),this._applyZoomTranslation=this.applyZoomTranslation.bind(this),this._resetEventHandler=this._resetEventHandler.bind(this);let t=!1;this.applyZoomTranslation=()=>{t||(t=!0,requestAnimationFrame(()=>{t=!1,this._applyZoomTranslation()}))},this._onResize=this._onResize.bind(this),this._listenForResize=this._listenForResize.bind(this),this.trackHighlighter=new h1e({element:this,min:1}),this.scrollFilter=new bX(this),this.wheelListener=r=>this.scrollFilter.wheel(r)}connectedCallback(){this.style.display="block",this.style.width="100%",this.width=this.offsetWidth,this.closest("protvista-manager")&&(this.manager=this.closest("protvista-manager"),this.manager.register(this)),this._length=this.getAttribute("length")?parseFloat(this.getAttribute("length")):0,this._displaystart=this.getAttribute("displaystart")?parseFloat(this.getAttribute("displaystart")):1,this._displayend=this.getAttribute("displayend")?parseFloat(this.getAttribute("displayend")):this.length,this._height=this.getAttribute("height")?Number(this.getAttribute("height")):44,this._highlightEvent=this.getAttribute("highlight-event")?this.getAttribute("highlight-event"):"onclick",this.trackHighlighter.setAttributesInElement(this),this._updateScaleDomain(),this._originXScale=this.xScale.copy(),this._initZoom(),this._listenForResize(),this.addEventListener("error",t=>{console.error(t)}),this._highlightEvent!=="none"&&this.addEventListener("click",this._resetEventHandler),this.hasAttribute("filter-scroll")&&document.addEventListener("wheel",this.wheelListener,{capture:!0})}disconnectedCallback(){this.manager&&this.manager.unregister(this),this._ro?this._ro.unobserve(this):window.removeEventListener("resize",this._onResize),this._highlightEvent!=="none"&&this.removeEventListener("click",this._resetEventHandler),document.removeEventListener("wheel",this.wheelListener)}get width(){return this._width}set width(t){this._width=t}set height(t){this._height=t}get height(){return this._height}set length(t){this._length=t,this.trackHighlighter.max=t}get length(){return this._length}get xScale(){return this._xScale}set xScale(t){this._xScale=t}get zoom(){return this._zoom}set svg(t){this._svg=t,t.call(this._zoom),this.applyZoomTranslation()}get svg(){return this._svg}set fixedHighlight(t){this.trackHighlighter.setFixedHighlight(t)}getWidthWithMargins(){return this.width?this.width-this.margin.left-this.margin.right:0}_updateScaleDomain(){this.xScale=Cb().domain([1,this._length+1]).range([0,this.getWidthWithMargins()])}_initZoom(){this._zoom=u1e().scaleExtent([1,1/0]).translateExtent([[0,0],[this.getWidthWithMargins(),0]]).extent([[0,0],[this.getWidthWithMargins(),0]]).filter(()=>{if(!(qt instanceof WheelEvent))return!0;if(this.hasAttribute("scroll-filter")){const t=this.getAttribute("scrollable");if(t)return t==="true"}return!this.hasAttribute("use-ctrl-to-zoom")||qt.ctrlKey}).on("zoom",this.zoomed)}static get observedAttributes(){return["displaystart","displayend","length","highlight"]}setFloatAttribute(t,r){const n=parseFloat(r);this[`_${t}`]=Number.isNaN(n)?r:n}attributeChangedCallback(t,r,n){if(n==="null"&&(n=null),r!==n){if(t.startsWith("highlight")){this.trackHighlighter.changedCallBack(t,n);return}this.setFloatAttribute(t,n),t==="length"&&(this._updateScaleDomain(),this._originXScale=this.xScale.copy()),this.applyZoomTranslation()}}zoomed(){if(this.xScale=qt.transform.rescaleX(this._originXScale),this.dontDispatch)return;const[t,r]=this.xScale.domain();this.dispatchEvent(new CustomEvent("change",{detail:{displaystart:Math.max(1,t),displayend:Math.min(this.length,Math.max(r-1,t+1))},bubbles:!0,cancelable:!0}))}applyZoomTranslation(){if(!this.svg||!this._originXScale)return;const t=Math.max(1,this.length/(1+this._displayend-this._displaystart)),r=-this._originXScale(this._displaystart);this.dontDispatch=!0,this.svg.call(this.zoom.transform,Sk.scale(t).translate(r,0)),this.dontDispatch=!1,this.refresh()}_onResize(){this.width=this.offsetWidth,this._updateScaleDomain(),this._originXScale=this.xScale.copy(),this.svg&&this.svg.attr("width",this.width),this._zoom.scaleExtent([1,1/0]).translateExtent([[0,0],[this.getWidthWithMargins(),0]]),this.applyZoomTranslation()}_listenForResize(){this._ro=new lCe(this._onResize),this._ro.observe(this)}_resetEventHandler(t){t.target.closest(".feature")||this.dispatchEvent(this.createEvent("reset",null,!0))}getXFromSeqPosition(t){return this.margin.left+this.xScale(t)}getSingleBaseWidth(){return this.xScale(2)-this.xScale(1)}static _getClickCoords(){return qt?[qt.pageX,qt.pageY]:null}static _polyfillElementClosest(){Element.prototype.matches||(Element.prototype.matches=Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector),Element.prototype.closest||(Element.prototype.closest=t=>{let r=this;do{if(r.matches(t))return r;r=r.parentElement||r.parentNode}while(r!==null&&r.nodeType===1);return null})}createEvent(t,r=null,n=!1,i=!1,a,o,s){r&&(r=r.feature?r.feature:r);const u={eventtype:t,coords:IC._getClickCoords(),feature:r,target:s};return n&&(r&&r.fragments?u.highlight=r.fragments.map(l=>`${l.start}:${l.end}`).join(","):qt&&qt.shiftKey&&this._highlight?u.highlight=`${this._highlight},${a}:${o}`:u.highlight=a&&o?`${a}:${o}`:null),i&&(u.selectedid=r&&r.protvistaFeatureId),new CustomEvent("change",{detail:u,bubbles:!0,cancelable:!0})}bindEvents(t,r){t.on("mouseover",(n,i,a)=>{r.dispatchEvent(r.createEvent("mouseover",n,r._highlightEvent==="onmouseover",!1,n.start,n.end,a[i]))}).on("mouseout",()=>{r.dispatchEvent(r.createEvent("mouseout",null,r._highlightEvent==="onmouseover"))}).on("click",(n,i,a)=>{r.dispatchEvent(r.createEvent("click",n,r._highlightEvent==="onclick",!0,n.start,n.end,a[i]))})}}const MC=xX(IC,{initialValue:{top:10,right:10,bottom:10,left:10}}),gn=10;class cCe{getFeatureShape(t,r,n,i){return i=i||"rectangle",this._ftLength=n,this._ftHeight=r,this._ftWidth=t*n,typeof this["_"+i]!="function"&&(i="rectangle"),this["_"+i]()}static isContinuous(t){return t=t.toLowerCase(),t!=="bridge"}_rectangle(){return"M0,0L"+this._ftWidth+",0L"+this._ftWidth+","+this._ftHeight+"L0,"+this._ftHeight+"Z"}_roundRectangle(){return"M6,0h"+(this._ftWidth-2*6)+",0a6,6 0 0 1 6,6v"+(this._ftHeight-2*6)+"a6,6 0 0 1 -6,6h"+(2*6-this._ftWidth)+"a6,6 0 0 1 -6,-6v"+(2*6-this._ftHeight)+"a6,6 0 0 1 6,-6Z"}_line(){return`M0,${this._ftHeight/2} L${this._ftWidth},${this._ftHeight/2}`}_bridge(){return this._ftLength!==1?"M0,"+this._ftHeight+"L0,0L"+this._ftWidth+",0L"+this._ftWidth+","+this._ftHeight+"L"+this._ftWidth+",2L0,2Z":"M0,"+this._ftHeight+"L0,"+this._ftHeight/2+"L"+this._ftWidth/2+","+this._ftHeight/2+"L"+this._ftWidth/2+",0L"+this._ftWidth/2+","+this._ftHeight/2+"L"+this._ftWidth+","+this._ftHeight/2+"L"+this._ftWidth+","+this._ftHeight+"Z"}_getMiddleLine(t){return"M0,"+t+"L"+this._ftWidth+","+t+"Z"}_diamond(){const t=gn/2,r=this._ftWidth/2,n="M"+r+",0L"+(r+t)+","+t+"L"+r+","+gn+"L"+(r-t)+","+t;return this._ftLength!==1?n+this._getMiddleLine(t,this._ftWidth):n+"Z"}_chevron(){const t=this._ftWidth/2,r=gn/2,n="M"+t+","+r+"L"+(r+t)+",0L"+(r+t)+","+r+"L"+t+","+gn+"L"+(-r+t)+","+r+"L"+(-r+t)+",0";return this._ftLength!==1?n+"L"+t+","+r+this._getMiddleLine(r,this._ftWidth)+"Z":n+"Z"}_catFace(){const t=gn/2,r=gn/10,n=this._ftWidth/2,i="M"+(-t+n)+",0L"+(-t+n)+","+6*r+"L"+(-2*r+n)+","+gn+"L"+(2*r+n)+","+gn+"L"+(t+n)+","+6*r+"L"+(t+n)+",0L"+(2*r+n)+","+4*r+"L"+(-2*r+n)+","+4*r;return this._ftLength!==1?i+"M"+n+",0"+this._getMiddleLine(t,this._ftWidth)+"Z":i+"Z"}_triangle(){const t=gn/2,r=this._ftWidth/2,n="M"+r+",0L"+(t+r)+","+gn+"L"+(-t+r)+","+gn;return this._ftLength!==1?n+"L"+r+",0"+this._getMiddleLine(t,this._ftWidth)+"Z":n+"Z"}_wave(){const t=gn/4,r=gn/2,n=this._ftWidth/2,i="M"+(-gn/2+n)+","+r+"A"+t+","+r+" 0 1,1 "+n+","+r+"A"+t+","+r+" 0 1,0 "+(gn/2+n)+","+r;return this._ftLength!==1?i+this._getMiddleLine(r,this._ftWidth)+"Z":i+"Z"}_getPolygon(t){const r=gn/2;let n="M ";const i=this._ftWidth/2;for(let a=0;a<t;a++)n+=r*Math.cos(2*Math.PI*a/t)+i+","+(r*Math.sin(2*Math.PI*a/t)+r)+" ";return this._ftLength!==1?n+" "+(r*Math.cos(0)+i)+","+(r*Math.sin(0)+r)+" "+this._getMiddleLine(r,this._ftWidth)+"Z":n+"Z"}_hexagon(){return this._getPolygon(6)}_pentagon(){return this._getPolygon(5)}_circle(){const t=this._ftWidth/2,r=Math.sqrt(gn/Math.PI),n="M"+t+",0A"+r+","+r+" 0 1,1 "+t+","+gn+"A"+r+","+r+" 0 1,1 "+t+",0";return this._ftLength!==1?n+this._getMiddleLine(gn/2,this._ftWidth)+"Z":n+"Z"}_arrow(){const t=gn/10,r=this._ftWidth/2,n="M"+r+",0L"+(-t+r)+",0L"+(-5*t+r)+","+4*t+"L"+(-t+r)+","+this._ftHeight+"L"+r+","+this._ftHeight+"L"+(4*t+r)+","+4*t;return this._ftLength!==1?n+"L"+r+",0"+this._getMiddleLine(gn/2,this._ftWidth)+"Z":n+"Z"}_doubleBar(){const t=this._ftWidth/2,r=gn/2,n="M"+t+",0L"+(-r+t)+","+gn+"L"+t+","+gn+"L"+(r+t)+",0";return this._ftLength!==1?n+"L"+t+",0"+this._getMiddleLine(gn/2,this._ftWidth)+"Z":n+"Z"}_getBrokenEnd(){const t=this._ftHeight/4;return"L"+(this._ftWidth-t)+","+t+"L"+this._ftWidth+","+2*t+"L"+(this._ftWidth-t)+","+3*t+"L"+this._ftWidth+","+this._ftHeight}_getBrokenStart(){const t=this._ftHeight/4;return"L"+t+","+3*t+"L0,"+2*t+"L"+t+","+t}_discontinuosStart(){return"M0,0L"+this._ftWidth+",0L"+this._ftWidth+","+this._ftHeight+"L0,"+this._ftHeight+this._getBrokenStart()+"Z"}_discontinuos(){return"M0,0L"+this._ftWidth+",0"+this._getBrokenEnd()+"L0,"+this._ftHeight+this._getBrokenStart()+"Z"}_discontinuosEnd(){return"M0,0L"+this._ftWidth+",0"+this._getBrokenEnd()+"L0,"+this._ftHeight+"Z"}_helix(){const t=gn/2,r=gn/4;let n=t/2;const i=Math.round(this._ftWidth/t);let a="";for(let o=0;o<i;o++){const s="M"+(-(t/2)+n)+","+this._ftHeight+" C"+(n+r)+","+3*r+" "+(t/2+n)+","+r+" "+n+", 0 C"+(n-r)+","+r+" "+n+","+3*r+" "+(t/2+n)+","+this._ftHeight;a+=s,n+=t}return a}_strand(){let t=0;this._ftWidth>gn/2&&(t=this._ftWidth-gn/2);const r=this._ftHeight/4,n="M0,"+r+"L"+t+","+r+"L"+t+","+3*r+"L0,"+3*r+"L0,"+r,i="M"+t+",0L"+this._ftWidth+","+2*r+"L"+t+","+this._ftHeight+"Z";return n+i}}class Mk{constructor({layoutHeight:t,padding:r=1,minHeight:n=17}){this._padding=r,this._minHeight=n,this._layoutHeight=t}init(t){this._features=t}getFeatureYPos(){const t=this.getFeatureHeight();return this._layoutHeight/2-t/2}getFeatureHeight(){return Math.min(this._layoutHeight,this._minHeight)-this._padding}}const dCe=(e,t)=>!(Number(t.start)>Number(e.end)||Number(t.end)<Number(e.start)),fCe=(e,t)=>t.some(r=>dCe(e,r));class hCe extends Mk{constructor(t){super(t),this.featuresMap=new Map,this._rowHeight=0,this._rows=[],this._minHeight=15}init(t){t.forEach(r=>{const n=this._rows.findIndex(i=>!fCe(r,i));n>=0?(this._rows[n].push(r),this.featuresMap.set(r,n)):(this._rows.push([r]),this.featuresMap.set(r,this._rows.length-1))}),this._rowHeight=Math.min(this._layoutHeight/this._rows.length,this._minHeight)}getOffset(){return this._rows.length*this._rowHeight<this._layoutHeight?this._layoutHeight/2-this._rows.length*this._rowHeight/2:0}getFeatureYPos(t){const r=this.featuresMap.get(t);return this.getOffset()+this._rowHeight*r+2*this._padding}getFeatureHeight(){return this._rowHeight-2*this._padding}}const Xm={CHAIN:{name:"chain",label:"Chain",tooltip:"(aka mature region). This describes the extent of a polypeptide chain in the mature protein following processing",shape:"rectangle",color:"#CC9933"},TRANSIT:{name:"transit peptide",label:"Transit peptide",tooltip:"This describes the extent of a transit peptide",shape:"rectangle",color:"#009966"},INIT_MET:{name:"initiator methionine",label:"Initiator methionine",tooltip:"This indicates that the initiator methionine is cleaved from the mature protein",shape:"arrow",color:"#996633"},PROPEP:{name:"propeptide",label:"Propeptide",tooltip:"Part of a protein that is cleaved during maturation or activation",shape:"rectangle",color:"#99CCCC"},PEPTIDE:{name:"peptide",label:"Peptide",tooltip:"The position and length of an active peptide in the mature protein",shape:"rectangle",color:"#006699"},SIGNAL:{name:"signal peptide",label:"Signal peptide",tooltip:"N-terminal signal peptide",shape:"rectangle",color:"#CC0033"},HELIX:{name:"helix",label:"Helix",tooltip:"The positions of experimentally determined helical regions",shape:"rectangle",color:"#FF0066"},STRAND:{name:"strand",label:"Beta strand",tooltip:"The positions of experimentally determined beta strands",shape:"rectangle",color:"#FFCC00"},TURN:{name:"turn",label:"Turn",tooltip:"The positions of experimentally determined hydrogen-bonded turns",shape:"rectangle",color:"#0571AF"},DISULFID:{name:"disulfide bond",label:"Disulfide bond",tooltip:"The positions of cysteine residues participating in disulphide bonds",shape:"bridge",color:"#23B14D"},CROSSLNK:{name:"cross-link",label:"Cross-link",tooltip:"Covalent linkages of various types formed between two proteins or between two parts of the same protein",shape:"bridge",color:"#FF6600"},REGION:{name:"region of interest",label:"Region of interest",tooltip:"Regions in multifunctional enzymes or fusion proteins, or characteristics of a region, e.g., protein-protein interactions mediation",shape:"rectangle",color:"#B33E00"},COILED:{name:"coiled-coil region",label:"Coiled-coil region",tooltip:"Coiled coils are built by two or more alpha-helices that wind around each other to form a supercoil",shape:"rectangle",color:"#006699"},MOTIF:{name:"short sequence motif",label:"Short sequence motif",tooltip:"Short conserved sequence motif of biological significance",shape:"rectangle",color:"#402060"},REPEAT:{name:"repeat",label:"Repeat",tooltip:"Repeated sequence motifs or repeated domains within the protein",shape:"rectangle",color:"#9900FF"},CA_BIND:{name:"calcium-binding region",label:"Calcium-binding region",tooltip:"Calcium-binding regions, such as the EF-hand motif",shape:"rectangle",color:"#FF3399"},DNA_BIND:{name:"DNA-binding region",label:"DNA binding",tooltip:"DNA-binding domains such as AP2/ERF domain, the ETS domain, the Fork-Head domain, the HMG box and the Myb domain",shape:"rectangle",color:"#009933"},DOMAIN:{name:"other domain of interest",label:"Other domain of interest",tooltip:"Specific combination of secondary structures organized into a characteristic three-dimensional structure or fold",shape:"rectangle",color:"#9999FF"},ZN_FING:{name:"zinc finger region",label:"Zinc finger",tooltip:"Small, functional, independently folded domain that coordinates one or more zinc ions",shape:"rectangle",color:"#990066"},NP_BIND:{name:"nucleotide-binding region",label:"Nucleotide-binding region",tooltip:"(aka flavin-binding). Region in the protein which binds nucleotide phosphates",shape:"rectangle",color:"#FF9900"},METAL:{name:"metal ion-binding site",label:"Metal ion-binding site",tooltip:"Binding site for a metal ion",shape:"diamond",color:"#009900"},SITE:{name:"other site of interest",label:"Other site of interest",tooltip:"Any interesting single amino acid site on the sequence",shape:"chevron",color:"#660033"},BINDING:{name:"other binding site",label:"Other binding site",tooltip:"Binding site for any chemical group (co-enzyme, prosthetic group, etc.)",shape:"rectangle",color:"#catFace"},ACT_SITE:{name:"active site",label:"Active site",tooltip:"Amino acid(s) directly involved in the activity of an enzyme",shape:"circle",color:"#FF6666"},MOD_RES:{name:"Post-translationally modified residue",label:"Modified residue",tooltip:"Modified residues such as phosphorylation, acetylation, acylation, methylation",shape:"triangle",color:"#000066"},LIPID:{name:"lipid moiety-binding region",label:"Lipidation",tooltip:"Covalently attached lipid group(s)",shape:"wave",color:"#99CC33"},CARBOHYD:{name:"glycosylation site",label:"Glycosylation",tooltip:"Covalently attached glycan group(s)",shape:"hexagon",color:"#CC3366"},COMPBIAS:{name:"compositionally biased region",label:"Compositionally biased region",tooltip:"Position of regions of compositional bias within the protein and the particular amino acids that are over-represented within those regions",shape:"rectangle",color:"#FF3366"},CONFLICT:{name:"sequence conflict",label:"Sequence conflict",tooltip:"Sequence discrepancies of unknown origin",shape:"rectangle",color:"#6633CC"},NON_CONS:{name:"non-consecutive residues",label:"Non-adjacent residues",tooltip:"Indicates that two residues in a sequence are not consecutive and that there is an undetermined number of unsequenced residues between them",shape:"doubleBar",color:"#FF0033"},NON_TER:{name:"non-terminal residue",label:"Non-terminal residue",tooltip:"The sequence is incomplete. The residue is not the terminal residue of the complete protein",shape:"doubleBar",color:"#339933"},UNSURE:{name:"unsure residue",label:"Sequence uncertainty",tooltip:"Regions of a sequence for which the authors are unsure about the sequence assignment",shape:"rectangle",color:"#33FF00"},NON_STD:{name:"non-standard amino acid",label:"Non-standard residue",tooltip:"Non-standard amino acids (selenocysteine and pyrrolysine)",shape:"pentagon",color:"#330066"},MUTAGEN:{name:"mutagenesis site",label:"Mutagenesis",tooltip:"Site which has been experimentally altered by mutagenesis",shape:"rectangle",color:"#FF9900"},TOPO_DOM:{name:"topological domain",label:"Topological domain",tooltip:"Location of non-membrane regions of membrane-spanning proteins",shape:"rectangle",color:"#CC0000"},TRANSMEM:{name:"transmembrane region",label:"Transmembrane",tooltip:"Extent of a membrane-spanning region",shape:"rectangle",color:"#CC00CC"},INTRAMEM:{name:"intramembrane region",label:"Intramembrane",tooltip:"Extent of a region located in a membrane without crossing it",shape:"rectangle",color:"#0000CC"},VAR_SEQ:{name:"splice variant",label:"Splice variant",tooltip:"",shape:"rectangle",color:"#CC11CC"},VARIANT:{name:"sequence variant",label:"Natural variant",tooltip:"Natural variant of the protein, including polymorphisms, variations between strains, isolates or cultivars, disease-associated mutations and RNA editing events",shape:"circle",color:"black"},UNIQUE:{name:"unique",label:"Unique peptide",tooltip:"",shape:"rectangle",color:"#fc3133"},NON_UNIQUE:{name:"non-unique",label:"Non-unique peptide",tooltip:"",shape:"rectangle",color:"#8585fc"},ANTIGEN:{name:"antigen",label:"Antibody binding sequences",tooltip:"",shape:"rectangle",color:"#996699"},PDBE_COVER:{name:"pdbe coverage",label:"PDBe 3D structure coverage",tooltip:"",shape:"rectangle",color:"#669966"}},b8=e=>{if(Xm[e.toUpperCase()])return Xm[e.toUpperCase()].shape;const t=Object.values(Xm).find(r=>r.name.toUpperCase()===e.toUpperCase());return t?t.shape:"rectangle"},x8=e=>{if(Xm[e.toUpperCase()])return Xm[e.toUpperCase()].color;const t=Object.values(Xm).find(r=>r.name.toUpperCase()===e.toUpperCase());return t||console.log(e),t?t.color:"black"};class Up extends MC{getLayout(){return String(this.getAttribute("layout")).toLowerCase()==="non-overlapping"?new hCe({layoutHeight:this._height}):new Mk({layoutHeight:this._height})}connectedCallback(){super.connectedCallback(),this._color=this.getAttribute("color"),this._shape=this.getAttribute("shape"),this._featureShape=new cCe,this._layoutObj=this.getLayout(),this._data&&this._createTrack(),this.addEventListener("load",t=>{Zbe(this.children,t.target)&&(this.data=t.detail.payload)})}static normalizeLocations(t){return t.map(r=>{const{locations:n,start:i,end:a}=r;return n?r:Object.assign(r,{locations:[{fragments:[{start:i,end:a}]}]})})}processData(t){this._originalData=Up.normalizeLocations(t)}set data(t){this.processData(t),this._applyFilters(),this._layoutObj=this.getLayout(),this._createTrack()}set filters(t){this._filters=t,this._applyFilters(),this._createTrack()}static get observedAttributes(){return MC.observedAttributes.concat(["highlight","color","shape","filters"])}_getFeatureColor(t){return t.color?t.color:t.feature&&t.feature.color?t.feature.color:this._color?this._color:t.type?x8(t.type):t.feature&&t.feature.type?x8(t.feature.type):"black"}_getFeatureFillColor(t){return t.fill?t.fill:t.feature&&t.feature.fill?t.feature.fill:this._getFeatureColor(t)}_getShape(t){return t.shape?t.shape:t.feature&&t.feature.shape?t.feature.shape:this._shape?this._shape:t.type?b8(t.type):t.feature&&t.feature.type?b8(t.feature.type):"rectangle"}_createTrack(){this._layoutObj.init(this._data),Fi(this).selectAll("div").remove(),this.svg=Fi(this).append("div").style("line-height",0).append("svg").attr("width",this.width).attr("height",this._height),this.trackHighlighter.appendHighlightTo(this.svg),this.seq_g=this.svg.append("g").attr("class","sequence-features"),this._createFeatures()}_createFeatures(){this.featuresG=this.seq_g.selectAll("g.feature-group").data(this._data),this.locations=this.featuresG.enter().append("g").attr("class","feature-group").attr("id",n=>`g_${n.accession}`).selectAll("g.location-group").data(n=>n.locations.map(i=>Object.assign({},i,{feature:n}))).enter().append("g").attr("class","location-group");const t=this.locations.selectAll("g.fragment-group").data(n=>n.fragments.map(i=>Object.assign({},i,{feature:n.feature}))).enter().append("g").attr("class","fragment-group");t.append("path").attr("class",n=>`${this._getShape(n)} feature`).attr("d",n=>this._featureShape.getFeatureShape(this.getSingleBaseWidth(),this._layoutObj.getFeatureHeight(n),n.end?n.end-n.start+1:1,this._getShape(n))).attr("transform",n=>`translate(${this.getXFromSeqPosition(n.start)},${this._layoutObj.getFeatureYPos(n.feature)})`).attr("fill",n=>this._getFeatureFillColor(n)).attr("stroke",n=>this._getFeatureColor(n)).style("fill-opacity",({feature:n})=>n.opacity?n.opacity:.9).style("stroke-opacity",({feature:n})=>n.opacity?n.opacity:.9);const r=t.selectAll("g.residue-group").data(n=>{var i;return n.feature.ptms?[(i=n.feature.ptms)==null?void 0:i.map(a=>Object.assign({},a,{feature:n.feature,position:a.position}))]:[]}).enter().append("g").attr("class","residue-group");t.append("rect").attr("class","outer-rectangle feature").attr("width",n=>this.getSingleBaseWidth()*(n.end?n.end-n.start+1:1)).attr("height",n=>this._layoutObj.getFeatureHeight(n)).attr("transform",n=>`translate(${this.getXFromSeqPosition(n.start)},${this._layoutObj.getFeatureYPos(n.feature)})`).attr("fill","transparent").attr("stroke","transparent").call(this.bindEvents,this),r.selectAll("g.residue").data(n=>n).enter().append("path").attr("class",n=>`${this._getShape(n)} residue`).attr("d",n=>{let i=1;return this.length>500&&(i=this.getSingleBaseWidth()<4?4:1),this._featureShape.getFeatureShape(this.getSingleBaseWidth()/2,this._layoutObj.getFeatureHeight(),i,this._getShape(n))}).attr("transform",n=>`translate(${this.getXFromSeqPosition(Number(n.feature.start)+Number(n.position)-1)+this.getSingleBaseWidth()/4},
          ${this._layoutObj.getFeatureYPos(n.feature)})`).attr("fill","#06038D").style("fill-opacity",({feature:n})=>n.opacity?n.opacity:.9).style("stroke-opacity",({feature:n})=>n.opacity?n.opacity:.9).call(this.bindEvents,this)}_applyFilters(){if(!this._filters||this._filters.length<=0){this._data=this._originalData;return}const t=yg(this._filters,"category"),r=Object.values(t).map(i=>{const a=i.map(o=>o.filterFn(this._originalData));return qX(...a)}),n=WX(...r);this._data=n}refresh(){if(this.xScale&&this.seq_g){const t=this.seq_g.selectAll("g.fragment-group").data(this._data.reduce((n,i)=>n.concat(i.locations.reduce((a,o)=>a.concat(o.fragments.map(s=>Object.assign({},s,{feature:i}))),[])),[])),r=this.seq_g.selectAll("g.residue-group").data(this._data.reduce((n,i)=>{var a;return n.concat([(a=i.ptms)==null?void 0:a.reduce(o=>o.concat(s=>Object.assign({},s,{feature:i,position:s.position})),[])])},[]));t.selectAll("path.feature").attr("d",n=>this._featureShape.getFeatureShape(this.getSingleBaseWidth(),this._layoutObj.getFeatureHeight(n),n.end?n.end-n.start+1:1,this._getShape(n))).attr("transform",n=>`translate(${this.getXFromSeqPosition(n.start)},${this._layoutObj.getFeatureYPos(n.feature)})`),r.selectAll("path.residue").attr("d",n=>{let i=1;return this.length>500&&(i=this.getSingleBaseWidth()<4?4:1),this._featureShape.getFeatureShape(this.getSingleBaseWidth()/2,this._layoutObj.getFeatureHeight(n),i,this._getShape(n))}).attr("transform",n=>`translate(${this.getXFromSeqPosition(Number(n.feature.start)+Number(n.position)-1)+this.getSingleBaseWidth()/4},${this._layoutObj.getFeatureYPos(n.feature)})`),t.selectAll("rect.outer-rectangle").attr("width",n=>this.getSingleBaseWidth()*(n.end?n.end-n.start+1:1)).attr("height",n=>this._layoutObj.getFeatureHeight(n)).attr("transform",n=>`translate(${this.getXFromSeqPosition(n.start)},${this._layoutObj.getFeatureYPos(n.feature)})`),this._updateHighlight()}}_updateHighlight(){this.trackHighlighter.updateHighlight()}}const S8=16,pCe=14,M2=10;class Fy extends Mk{init(t,r){let n=0;if(this.height={},this.yPos={},this.maxYPos=0,!t)return;this.innerPadding=(S8-M2)/2;const i={};for(let a=0;a<t.length;a++){const o=t[a];this.height[o.accession]=this.expanded?pCe:S8,this.yPos[o.accession]=this._padding,n=this.height[o.accession]+2*this._padding,this.maxYPos=Math.max(this.maxYPos,n),o.accession in i||(i[o.accession]={}),o.residues&&(n=this._initResidues(o.residues,o.accession,o.locations,this.expanded?n:this.yPos[o.accession],a,i,this.expanded))}if(r)for(let a=0;a<r.length;a++){const o=r[a];o.accession in this.height||(this.height[o.accession]=M2,this.yPos[o.accession]=(this.expanded?this.maxYPos:this.innerPadding)+this._padding,n+=2*this._padding+(this.expanded?this.height[o.accession]:0),this.maxYPos=Math.max(this.maxYPos,n)),o.accession in i||(i[o.accession]={}),o.residues&&(n=this._initResidues(o.residues,o.accession,o.locations,o.expanded?n:this.yPos[o.accession],a,i,o.expanded))}this.maxYPos+=this._padding}_initResidues(t,r,n,i,a,o={},s=!0){for(let u=0;u<t.length;u++){const l=t[u];Fy._filterOutResidueFragmentsOutOfLocation(l,n),l.accession in o[r]||(o[r][l.accession]={});for(let c=0;c<l.locations.length;c++){const d=l.locations[c].description;d in o[r][l.accession]||(o[r][l.accession][d]={height:s?M2:this.height[r]-2*this.innerPadding,yPos:s?this.maxYPos+this._padding:i+this.innerPadding},i=s?this.maxYPos+2*this._padding+M2:i),this.height[`${l.accession}_${a}_${u}_${c}`]=o[r][l.accession][d].height,this.yPos[`${l.accession}_${a}_${u}_${c}`]=o[r][l.accession][d].yPos,this.maxYPos=Math.max(this.maxYPos,i)}}return s?i:this.maxYPos+2*this._padding}static _filterOutResidueFragmentsOutOfLocation(t,r){t.locations.forEach(n=>n.fragments=n.fragments.filter(i=>r.some(a=>a.fragments.some(o=>i.start>=o.start&&i.end<=o.end)))),t.locations=t.locations.filter(n=>n.fragments.length)}static _getAccFromFeature(t){let r="";return typeof t=="string"?r=t:t.accession&&(r=t.accession),r}getFeatureYPos(t){const r=Fy._getAccFromFeature(t);return r in this.yPos?this.yPos[r]:0}getFeatureHeight(t){const r=Fy._getAccFromFeature(t);return r in this.height?this.height[r]:0}}const C8=(e,t)=>{let r={value:1,...e};const n=[];for(const i of t)r?r.end<i.start?(n.push(r),r=null,n.push(i)):r.start<i.start&&r.end>=i.end?(n.push({start:r.start,end:i.start-1,value:r.value}),n.push({start:i.start,end:i.end,value:i.value+r.value}),r=i.end===r.end?null:{start:i.end+1,end:r.end,value:r.value}):i.start<r.start&&i.end>r.end?(n.push({start:i.start,end:r.start-1,value:i.value}),n.push({start:r.start,end:r.end,value:i.value+r.value}),n.push({start:r.end+1,end:i.end,value:i.value}),r=null):i.end>=r.start&&i.end<=r.end?(i.start<r.start&&n.push({start:i.start,end:r.start-1,value:i.value}),n.push({start:r.start,end:i.end,value:i.value+r.value}),r=i.end<r.end?{start:i.end+1,end:r.end,value:r.value}:null):r.end>=i.start&&r.end<i.end?(n.push({start:r.start,end:i.start-1,value:r.value}),n.push({start:i.start,end:r.end,value:i.value+r.value}),n.push({start:r.end+1,end:i.end,value:i.value}),r=null):n.push(i):n.push(i);return r&&n.push(r),n},vCe=(e,t=100,r=!0)=>{let n=[];return r&&(n=C8({start:1,end:t,value:0},n)),e.forEach(i=>i.locations.forEach(a=>a.fragments.forEach(o=>{n=C8(o,n)}))),n},D0={top:2,right:10,bottom:2,left:10},_8=.8,w8=.3,mCe=e=>(e+w8)/(1+w8);class By extends Up{_createTrack(){this._layoutObj.expanded=this._expanded,super._createTrack(),this.children_g=null}connectedCallback(){super.connectedCallback(),this._expanded=this.hasAttribute("expanded"),this._haveCreatedFeatures=!1}attributeChangedCallback(t,r,n){if(t==="expanded"&&r!==n&&this._contributors)for(const i of this._contributors)i.expanded=!r;super.attributeChangedCallback(t,r,n)}set contributors(t){this._contributors=By.normalizeLocations(t),this._coverage=vCe(this._contributors,this._length),this._data&&this._createTrack()}getLayout(){return new Fy({layoutHeight:this._height,expanded:this._expanded,padding:2})}static get observedAttributes(){return Up.observedAttributes.concat(["expanded","color"])}set color(t){this._color!==t&&(this._color=t,this.refresh())}static _createResidueGroup(t){return t.selectAll("g.residues-group").data(r=>r.residues?r.residues.map((n,i)=>({...n,feature:r,i})):[]).enter().append("g").attr("class","residues-group").selectAll("g.residues-locations").data(r=>r.locations.map((n,i)=>({...n,accession:r.accession,feature:r.feature,location:n,i:r.i,j:i}))).enter().append("g").attr("class","residues-locations")}_createResiduePaths(t){return t.selectAll("g.residue").data(r=>r.fragments.map(n=>({...n,accession:r.accession,feature:{...r.feature,currentResidue:{...n,description:r.location.description}},location:r.location,k:r.feature.k,i:r.i,j:r.j}))).enter().append("path").attr("class","feature rectangle residue").attr("d",r=>this._featureShape.getFeatureShape(this.getSingleBaseWidth(),this._layoutObj.getFeatureHeight(`${r.accession}_${r.k}_${r.i}_${r.j}`),r.end?r.end-r.start+1:1,"rectangle")).attr("transform",r=>`translate(${this.getXFromSeqPosition(r.start)},${D0.top+this._layoutObj.getFeatureYPos(`${r.accession}_${r.k}_${r.i}_${r.j}`)})`).attr("fill",r=>this._getFeatureColor(r)).attr("stroke","transparent").call(this.bindEvents,this)}_refreshResiduePaths(t,r){const n=new Set(t.data().map(i=>`${i.feature.accession}-${i.location.description}`)).size;t.attr("d",i=>this._featureShape.getFeatureShape(this.getSingleBaseWidth(),this._layoutObj.getFeatureHeight(`${i.accession}_${i.k}_${i.i}_${i.j}`),i.end?i.end-i.start+1:1,"rectangle")).attr("transform",i=>`translate(${this.getXFromSeqPosition(i.start)},${D0.top+this._layoutObj.getFeatureYPos(`${i.accession}_${i.k}_${i.i}_${i.j}`)})`).style("pointer-events",i=>r||i.feature&&i.feature.expanded?"auto":"none").style("stroke",()=>r?null:"none").style("opacity",()=>r?null:_8/n).attr("fill",i=>r||i.feature&&i.feature.expanded?this._getFeatureColor(i):"white")}_createFeatures(){if(this._layoutObj.init(this._data,this._contributors),this._data.forEach((t,r)=>t.k=r),this.featuresG=this.seq_g.selectAll("g.feature-group").data(this._data).enter().append("g").attr("class","feature-group").attr("id",t=>`g_${t.accession}`),this.locations=this.featuresG.selectAll("g.location-group").data(t=>t.locations.map(r=>({...r,feature:t}))).enter().append("g").attr("class","location-group"),this.coverLines=this.locations.selectAll("line.cover").data(t=>[t.fragments.reduce((r,n)=>({start:Math.min(r.start,n.start),end:Math.max(r.end,n.end),feature:t.feature}),{start:1/0,end:-1/0})]).enter().append("line").attr("class","cover"),this.features=this.locations.selectAll("path.feature").data(t=>t.fragments.map(r=>({...r,feature:t.feature,fragments:t.fragments}))).enter().append("path").attr("class",t=>`${this._getShape(t)} feature`).on("click.expanded",()=>{this._expanded?this.removeAttribute("expanded"):this.setAttribute("expanded","expanded")}).call(this.bindEvents,this),this.residues_g=By._createResidueGroup(this.featuresG),this.residues_loc=this._createResiduePaths(this.residues_g),this._contributors){this._contributors.forEach((r,n)=>r.k=n),this.children_g||(this.children_g=this.svg.append("g").attr("class","children-features")),this.childrenGroup=this.children_g.append("g").attr("class","children-group"),this.childGroup=this.childrenGroup.selectAll("g.child-group").data(this._contributors).enter().append("g").attr("class","child-group");const t=this.childGroup.selectAll("g.child-location-group").data(r=>(r.expanded=this._expanded,r.locations.map(n=>({...n,feature:r})))).enter().append("g").attr("class",(r,n)=>`child-location-group clg-${n}`);this.coverLinesChildren=t.selectAll("line.cover").data(r=>[r.fragments.reduce((n,i)=>({start:Math.min(n.start,i.start),end:Math.max(n.end,i.end),feature:r.feature}),{start:1/0,end:-1/0})]).enter().append("line").attr("class","cover"),this.featureChildren=t.selectAll("path.child-fragment").data(r=>r.fragments.map(n=>({...n,feature:r.feature,fragments:r.fragments}))).enter().append("path").attr("class",r=>`${this._getShape(r)} child-fragment feature`).call(this.bindEvents,this).on("click.expanded",r=>{r.feature.expanded=!r.feature.expanded,this.refresh()}),this.child_residues_g=By._createResidueGroup(this.childGroup),this.child_residues_loc=this._createResiduePaths(this.child_residues_g),this._coverage&&this._coverage.length&&this._createCoverage()}this.svg.attr("height",this._layoutObj.maxYPos),this._haveCreatedFeatures=!0}_createCoverage(){this._accession=this._data&&this._data[0]&&this._data[0].accession||"_",this.coverage_mask=this.svg.append("defs").append("mask").attr("id",`mask-${this._accession}`),this.coverageMaskFragment=this.coverage_mask.selectAll("rect").data(this._coverage).enter().append("rect").attr("y",0).attr("height",this._height)}_refreshCoverage(){this.featuresG.attr("mask",this._expanded?null:`url(#mask-${this._accession})`),this.coverageMaskFragment.attr("x",t=>this.getXFromSeqPosition(t.start)).attr("width",t=>this.getSingleBaseWidth()*(t.end-t.start+1)).attr("fill","white").attr("opacity",t=>mCe(t.value/this._contributors.length))}_refreshFeatures(t,r=!0){const n=new Set(t.data().map(i=>i.feature.accession)).size;t.attr("d",i=>this._featureShape.getFeatureShape(this.getSingleBaseWidth(),this._layoutObj.getFeatureHeight(i.feature),i.end?i.end-i.start+1:1,r?this._getShape(i.shape?i:i.feature):"rectangle")).attr("fill",i=>r?this._getFeatureColor(i.feature):"white").attr("opacity",r?1:_8/n).style("stroke",i=>r?this._getFeatureColor(i.feature):"none").attr("transform",i=>`translate(${this.getXFromSeqPosition(i.start)},${D0.top+this._layoutObj.getFeatureYPos(i.feature)})`).style("pointer-events",r?"auto":"none")}_refreshCoverLine(t,r=!0){t.attr("x1",n=>this.getXFromSeqPosition(n.start)).attr("x2",n=>this.getXFromSeqPosition(n.end+1)).attr("y1",n=>D0.top+this._layoutObj.getFeatureYPos(n.feature)+this._layoutObj.getFeatureHeight(n.feature)/2).attr("y2",n=>D0.top+this._layoutObj.getFeatureYPos(n.feature)+this._layoutObj.getFeatureHeight(n.feature)/2).attr("stroke",n=>this._getFeatureColor(n.feature)).attr("visibility",r?"visible":"hidden")}refresh(){this._haveCreatedFeatures&&(this._layoutObj.expanded=this._expanded,this._layoutObj.init(this._data,this._contributors),this.height=this._layoutObj.maxYPos,this._refreshCoverLine(this.coverLines),this._refreshFeatures(this.features),this._refreshResiduePaths(this.residues_loc,this._expanded),this._contributors&&(this.childrenGroup.attr("visibility",this._expanded?"visible":"hidden"),this._refreshCoverLine(this.coverLinesChildren,this._expanded),this._refreshFeatures(this.featureChildren,this._expanded),this.child_residues_g.attr("visibility",()=>this._expanded?"visible":"hidden"),this._refreshResiduePaths(this.child_residues_loc),this._coverage&&this._coverage.length&&this._refreshCoverage()),this._updateHighlight(),this.svg.attr("height",this._layoutObj.maxYPos))}}const gCe=3;class yCe extends MC{connectedCallback(){super.connectedCallback(),this.sequence=this.getAttribute("sequence");const t=this.getAttribute("numberofticks");this.numberOfTicks=Number.isInteger(parseInt(t,10))?t:gCe,this.sequence&&this._createSequence(),this.addEventListener("load",r=>{this.data=r.detail.payload})}static get observedAttributes(){return MC.observedAttributes.concat("highlightstart","highlightend")}get data(){return this.sequence}set data(t){typeof t=="string"?this.sequence=t:"sequence"in t&&(this.sequence=t.sequence),this.sequence&&!super.svg?this._createSequence():this.refresh()}_getCharSize(){if(!this.seq_g)return;const t=.8,r=1.6,n=this.seq_g.select("text.base").node();if(n)this.chWidth=n.getBBox().width*t,this.chHeight=n.getBBox().height*r;else{const i=this.seq_g.append("text").attr("class","base").text("T");this.chWidth=i.node().getBBox().width*t,this.chHeight=i.node().getBBox().height*r,i.remove()}}_createSequence(){Fi(this).selectAll("div").remove(),super.svg=Fi(this).append("div").attr("class","").append("svg").attr("id","").attr("width",this.width).attr("height",this._height),this.seq_bg=super.svg.append("g").attr("class","background"),this.axis=super.svg.append("g").attr("class","x axis"),this.seq_g=super.svg.append("g").attr("class","sequence").attr("transform",`translate(0,${.75*this._height})`),this.trackHighlighter.appendHighlightTo(this.svg),this.refresh()}refresh(){if(this._getCharSize(),this.axis){const t=this.getSingleBaseWidth(),r=t-this.chWidth,n=t/2,i=Math.round(Math.max(0,this._displaystart-2)),a=Math.round(Math.min(this.sequence.length,this._displayend+1)),o=r<0?[]:this.sequence.slice(i,a).split("").map((s,u)=>({start:1+i+u,end:1+i+u,aa:s}));this.height>this.chHeight&&(this.xAxis=w$(this.xScale).tickFormat(s=>Number.isInteger(s)?s:"").ticks(this.numberOfTicks,"s"),this.axis.call(this.xAxis)),this.axis.attr("transform",`translate(${this.margin.left+n},0)`),this.axis.select(".domain").remove(),this.axis.selectAll(".tick line").remove(),this.bases=this.seq_g.selectAll("text.base").data(o,s=>s.start),this.bases.enter().append("text").attr("class","base").attr("text-anchor","middle").attr("x",s=>this.getXFromSeqPosition(s.start)+n).text(s=>s.aa).style("pointer-events","none").style("font-family","monospace"),this.bases.exit().remove(),this.bases.attr("x",s=>this.getXFromSeqPosition(s.start)+n),this.background=this.seq_bg.selectAll("rect.base_bg").data(o,s=>s.start),this.background.enter().append("rect").attr("class","base_bg feature").attr("height",this._height).merge(this.background).attr("width",t).attr("fill",s=>Math.round(s.start)%2?"#ccc":"#eee").attr("x",s=>this.getXFromSeqPosition(s.start)).call(this.bindEvents,this),this.background.exit().remove(),this.seq_g.style("opacity",Math.min(1,r)),this.background.style("opacity",Math.min(1,r)),this._updateHighlight()}}_updateHighlight(){this.trackHighlighter.updateHighlight()}}function bCe(e){const{variants:t,sequence:r}=e;if(!r||!t)return null;const i=r.split("").map((a,o)=>({type:"VARIANT",normal:a,pos:o+1,variants:[]}));return t.forEach(a=>{i[a.start-1]&&i[a.start-1].variants.push(a)}),i}class xCe{constructor(){this._frequency=fX().exponent(.001).domain([0,1]).range([5,10]),this.drawVariationPlot=this.drawVariationPlot.bind(this)}drawVariationPlot(t,r){const i=r.getSingleBaseWidth()/2;t.each((a,o,s)=>{const u=Fi(s[o]),l=a.filter(f=>f.variants.length!==0),c=u.selectAll("g").data(l,f=>f.pos);c.exit().remove();const d=c.enter().append("g").merge(c).selectAll("circle").data(f=>f.variants);d.exit().remove(),d.enter().append("circle").merge(d).attr("class","feature").attr("title",f=>f.start).attr("r",f=>f.size?f.size:5).attr("cx",f=>r.getXFromSeqPosition(f.start)+i).attr("cy",f=>r._yScale(f.variant.charAt(0))).attr("name",f=>{const h=f.alternativeSequence==="*"?"STOP":f.alternativeSequence;return f.internalId=`var_${f.wildType}${f.start}${h}`,f.internalId}).attr("fill",f=>f.color?f.color:r._colorConfig(f)).call(r.bindEvents,r)})}}const SCe=["G","A","V","L","I","S","T","C","M","D","N","E","Q","R","K","H","F","Y","W","P","d","*"],E8=(e,t)=>{if(!e||e.length<=0)return null;const r=e[0];return r.forEach((n,i)=>{const a=e.map(o=>o[i].variants);n.variants=t(...a)}),r};class Dk extends Up{connectedCallback(){super.connectedCallback();const t=document.createElement("style");t.innerHTML=Dk.css,this.appendChild(t),this._height=Number(this.getAttribute("height"))?Number(this.getAttribute("height")):430,this._width=this._width?this._width:0,this._yScale=Cb(),this._yScale=Aye().domain(SCe).range([0,this._height-this.margin.top-this.margin.bottom])}processData(t){this._originalData=bCe(t)}static get css(){return`
    <style>
    protvista-variation {
      display: flex;
      width: 100%;
    }
    
    protvista-variation svg {
      background-color: #fff;
    }
    
    protvista-variation circle {
      opacity: 0.6;
    }
    protvista-variation circle:hover {
      opacity: 0.9;
    }
    protvista-variation .tick line,
    protvista-variation .axis path {
      opacity: 0.1;
    }
    
    .protvista-highlight {
      fill: #ffe999;
    }
    
    protvista-variation .variation-y-right line,
    protvista-variation .axis path {
      fill: none;
      stroke: none;
    }
    
    </style>
    `}_createFeatures(){this._variationPlot=new xCe;const t=super.svg.select("g.sequence-features"),r=t.attr("transform",`translate(0, ${this.margin.top})`).append("g");this._series=r.datum(this._data),this._axisLeft=t.append("g"),this._axisRight=t.append("g"),this.updateScale()}set filters(t){super.filters=t,this.updateData(this._data),this.refresh()}_applyFilters(){if(!this._filters||this._filters.length<=0){this._data=this._originalData;return}const t=yg(this._filters,"category"),r=Object.values(t).map(n=>{const i=n.map(a=>a.filterFn(this._originalData));return E8(i,qX)});this._data=E8(r,WX)}set colorConfig(t){this._colorConfig=t}get colorConfig(){return this._colorConfig}refresh(){this._series&&(this.updateScale(),this._series.call(this._variationPlot.drawVariationPlot,this),this._updateHighlight())}updateScale(){this._yAxisLScale=Yve().scale(this._yScale).tickSize(-this.getWidthWithMargins()),this._yAxisRScale=Xve().scale(this._yScale),this._axisLeft.attr("class","variation-y-left axis").attr("transform",`translate(${this.margin.left},0)`).call(this._yAxisLScale),this._axisRight.attr("transform",`translate(${this.getWidthWithMargins()-this.margin.right+2}, 0)`).attr("class","variation-y-right axis").call(this._yAxisRScale)}updateData(t){this._series&&this._series.datum(t)}}class CCe extends Up{constructor(){super(),this._line=Uye().x((t,r)=>this.getXFromSeqPosition(r+1)-this.getSingleBaseWidth()/2).y(t=>this._yScale(t))}init(){this._totalsArray={total:null,diseaseTotal:null}}connectedCallback(){super.connectedCallback(),this._data=void 0,this._height=Number(this.getAttribute("height"))||40,this._yScale=Cb(),this.init()}set data(t){if(this.init(),!(!t.sequence||t.variants.length<=0)){this._totalsArray.total=new Uint8ClampedArray(t.sequence.length),this._totalsArray.diseaseTotal=new Uint8ClampedArray(t.sequence.length);for(const{start:r,association:n}of t.variants){const i=+r;if(i<1||i>t.sequence.length||(this._totalsArray.total[i]++,!n))continue;n.find(o=>o.disease===!0)&&this._totalsArray.diseaseTotal[i]++}this._createTrack()}}_createTrack(){Fi(this).selectAll("svg").remove(),this.svg=Fi(this).append("svg").attr("width",this.width).attr("height",this._height),this.trackHighlighter.appendHighlightTo(this.svg),this._initYScale(),this.refresh()}_initYScale(){this._yScale.domain([0,Math.max(eB(this._totalsArray.total),eB(this._totalsArray.diseaseTotal))]).range([this._height,0])}refresh(){this.svg&&(this.svg.selectAll("path").remove(),this.svg.append("path").attr("d",this._line(this._totalsArray.diseaseTotal)).attr("fill","none").attr("stroke","red").attr("transform","translate(0,0)"),this.svg.append("path").attr("d",this._line(this._totalsArray.total)).attr("fill","none").attr("stroke","darkgrey").attr("transform","translate(0,0)"),this._updateHighlight())}}class _Ce extends sh{static get properties(){return{filters:{type:Array},selectedFilters:{type:Set},for:{type:String}}}constructor(){super(),this.filters=[],this.selectedFilters=new Set}connectedCallback(){super.connectedCallback(),this.addEventListener("filterChange",this._onFilterChange),this.closest("protvista-manager")&&(this.manager=this.closest("protvista-manager"),this.manager.register(this))}disconnectedCallback(){super.disconnectedCallback(),this.manager&&this.manager.unregister(this),this.removeEventListener("filterChange",this._onFilterChange)}static get styles(){return zs`
      :host {
        font-size: 0.8rem;
      }

      :host[disabled] {
        opacity: 0.5;
      }

      .protvista_checkbox {
        position: relative;
        cursor: pointer;
        box-sizing: border-box;
        display: flex;
        align-items: center;
        margin-top: 10px;
        line-height: 24px;
        outline: none;
      }

      .protvista_checkbox_input {
        position: absolute;
        opacity: 0;
        cursor: pointer;
        height: 0;
        width: 0;
      }

      .checkmark {
        opacity: 0.4;
        height: 25px;
        width: 25px;
        background-color: #eee;
        border-radius: 4px;
        box-sizing: border-box;
        border: 1px solid #bdc3c7;
      }

      .protvista_checkbox_input:checked ~ .checkmark {
        opacity: 1;
      }

      .protvista_checkbox_label {
        margin-left: 0.2rem;
        line-height: 1rem;
      }
    `}render(){const t=yg(this.filters,r=>r.type.text);return zr`
      ${Object.keys(t).map(r=>zr`
            <h4>${r}</h4>
            <div>
              ${t[r].map(n=>zr`
                    ${this.getCheckBox(n)}
                  `)}
            </div>
          `)}
    `}getCheckBox(t){const{name:r,options:n}=t,{labels:i}=n;n.colors.length==null&&(n.colors=[n.colors]);const a=n.colors.length>1;return zr`
      <label
        class="protvista_checkbox ${a?"compound":""}"
        tabindex="0"
      >
        <input
          type="checkbox"
          class="protvista_checkbox_input"
          ?checked="true"
          .value="${r}"
          @change="${()=>this.toggleFilter(r)}"
        />
        <span
          class="checkmark"
          style=${`background: ${a?`
            linear-gradient(${n.colors[0]},
            ${n.colors[1]})
          `:n.colors[0]};`}
        ></span>
        <span class="protvista_checkbox_label">
          ${i.join("/")}
        </span>
      </label>
    `}toggleFilter(t){this.selectedFilters.has(t)?this.selectedFilters.delete(t):this.selectedFilters.add(t),this.dispatchEvent(new CustomEvent("change",{bubbles:!0,composed:!0,detail:{type:"filters",handler:"property",for:this.for,value:this.filters.filter(r=>this.selectedFilters.has(r.name)).map(r=>({category:r.type.name,filterFn:r.filterData}))}}))}}const D2="length",R2="displaystart",k2="displayend",O2="highlight";class DC extends HTMLElement{constructor(){super(),this.protvistaElements=new Set,this.attributeValues=new Map,this.propertyValues=new Map,this.mouseOver=!1}static get observedAttributes(){return["attributes",D2,R2,k2,O2]}set length(t){this.attributeValues.set(D2,t)}get length(){return this.attributeValues.get(D2)}set displaystart(t){this.attributeValues.set(R2,t)}get displaystart(){return this.attributeValues.get(R2)}set displayend(t){this.attributeValues.set(k2,t)}get displayend(){return this.attributeValues.get(k2)}set highlight(t){this.attributeValues.set(O2,t)}get highlight(){return this.attributeValues.get(O2)}attributeChangedCallback(t,r,n){if(r!==n){if(t==="attributes"){if(this._attributes=n.split(" "),this._attributes.indexOf("type")!==-1)throw new Error("'type' can't be used as a protvista attribute");if(this._attributes.indexOf("value")!==-1)throw new Error("'value' can't be used as a protvista attribute");this.attributeValues=new Map(this._attributes.filter(i=>!DC.observedAttributes.includes(i)).map(i=>[i,null]))}else t===D2&&(this.length=n),t===R2&&(this.displaystart=n),t===k2&&(this.displayend=n),t===O2&&(this.highlight=n);this.applyAttributes()}}register(t){this.protvistaElements.add(t),this.applyAttributes()}unregister(t){this.protvistaElements.delete(t)}_polyfillElementClosest(){Element.prototype.matches||(Element.prototype.matches=Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector),Element.prototype.closest||(Element.prototype.closest=t=>{let r=this;do{if(r.matches(t))return r;r=r.parentElement||r.parentNode}while(r!==null&&r.nodeType===1);return null})}applyAttributes(){this.protvistaElements.forEach(t=>{this.attributeValues.forEach((r,n)=>{r===!1||r===null||r===void 0?t.removeAttribute(n):t.setAttribute(n,typeof r=="boolean"?"":r)})})}applyProperties(t){if(t){const r=this.querySelector(`#${t}`);this.propertyValues.forEach((n,i)=>{r[i]=n})}else this.protvistaElements.forEach(r=>{this.propertyValues.forEach((n,i)=>{r[i]=n})})}isRegisteredAttribute(t){return[...this.attributeValues.keys()].includes(t)||DC.observedAttributes.includes(t)}_changeListener(t){if(t.detail)switch(t.detail.handler){case"property":this.propertyValues.set(t.detail.type,t.detail.value),this.applyProperties(t.detail.for);break;default:this.isRegisteredAttribute(t.detail.type)&&this.attributeValues.set(t.detail.type,t.detail.value),Object.keys(t.detail).forEach(r=>{this.isRegisteredAttribute(r)&&this.attributeValues.set(r,t.detail[r])}),this.applyAttributes()}}connectedCallback(){this.addEventListener("change",this._changeListener)}}var wCe=globalThis&&globalThis.__awaiter||function(e,t,r,n){function i(a){return a instanceof r?a:new r(function(o){o(a)})}return new(r||(r=Promise))(function(a,o){function s(c){try{l(n.next(c))}catch(d){o(d)}}function u(c){try{l(n.throw(c))}catch(d){o(d)}}function l(c){c.done?a(c.value):i(c.value).then(s,u)}l((n=n.apply(e,t||[])).next())})};const ZA=new Map,ZX=(e,t=new Headers({accept:"application/json"}))=>{const r=ZA.get(e);if(r)return r;const n=(()=>wCe(void 0,void 0,void 0,function*(){const i=yield window.fetch(e,{headers:t});if(!i.ok)throw new Error(`Request Failed: Status = ${i.status}; URI = ${e}; Time = ${new Date}`);return i.status===204?{payload:null,headers:i.headers}:{payload:yield i.json(),headers:i.headers}}))();return ZA.set(e,n),n.catch(()=>ZA.delete(e)),n};var L2,ECe=new Uint8Array(16);function ACe(){if(!L2&&(L2=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto<"u"&&typeof msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto),!L2))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return L2(ECe)}const PCe=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function TCe(e){return typeof e=="string"&&PCe.test(e)}var aa=[];for(var JA=0;JA<256;++JA)aa.push((JA+256).toString(16).substr(1));function ICe(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=(aa[e[t+0]]+aa[e[t+1]]+aa[e[t+2]]+aa[e[t+3]]+"-"+aa[e[t+4]]+aa[e[t+5]]+"-"+aa[e[t+6]]+aa[e[t+7]]+"-"+aa[e[t+8]]+aa[e[t+9]]+"-"+aa[e[t+10]]+aa[e[t+11]]+aa[e[t+12]]+aa[e[t+13]]+aa[e[t+14]]+aa[e[t+15]]).toLowerCase();if(!TCe(r))throw TypeError("Stringified UUID is invalid");return r}var A8,eP,tP=0,rP=0;function u3(e,t,r){var n=t&&r||0,i=t||new Array(16);e=e||{};var a=e.node||A8,o=e.clockseq!==void 0?e.clockseq:eP;if(a==null||o==null){var s=e.random||(e.rng||ACe)();a==null&&(a=A8=[s[0]|1,s[1],s[2],s[3],s[4],s[5]]),o==null&&(o=eP=(s[6]<<8|s[7])&16383)}var u=e.msecs!==void 0?e.msecs:Date.now(),l=e.nsecs!==void 0?e.nsecs:rP+1,c=u-tP+(l-rP)/1e4;if(c<0&&e.clockseq===void 0&&(o=o+1&16383),(c<0||u>tP)&&e.nsecs===void 0&&(l=0),l>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");tP=u,rP=l,eP=o,u+=122192928e5;var d=((u&268435455)*1e4+l)%4294967296;i[n++]=d>>>24&255,i[n++]=d>>>16&255,i[n++]=d>>>8&255,i[n++]=d&255;var f=u/4294967296*1e4&268435455;i[n++]=f>>>8&255,i[n++]=f&255,i[n++]=f>>>24&15|16,i[n++]=f>>>16&255,i[n++]=o>>>8|128,i[n++]=o&255;for(var h=0;h<6;++h)i[n+h]=a[h];return t||ICe(i)}const MCe=[{name:"ECO:0000269",description:"Manual assertion based on experiment",shortDescription:"Publication",acronym:"EXP",isManual:!0},{name:"ECO:0000303",description:"Manual assertion based on opinion",shortDescription:"Publication",acronym:"NAS",isManual:!0},{name:"ECO:0000305",description:"Manual assertion inferred by curator",shortDescription:"Curated",acronym:"IC",isManual:!0},{name:"ECO:0000250",description:"Manual assertion inferred from sequence similarity",shortDescription:"By similarity",acronym:"ISS",isManual:!0},{name:"ECO:0000255",description:"Manual assertion according to rules",shortDescription:"Sequence Analysis",acronym:"ISM",isManual:!0},{name:"ECO:0007744",description:"Manual assertion inferred from combination of experimental and computational evidence",shortDescription:"Combined sources",acronym:"MIXM",isManual:!0},{name:"ECO:0000312",description:"Manual assertion inferred from database entries",shortDescription:"Imported",acronym:"MI",isManual:!0},{name:"ECO:0000256",description:"Automatic assertion according to rules",shortDescription:"Automatic annotation",acronym:"AA"},{name:"ECO:0000259",description:"Automatic assertion inferred from signature match",shortDescription:"Automatic annotation",acronym:"AA"},{name:"ECO:0007829",description:"Automatic assertion inferred from combination of experimental and computational evidence",shortDescription:"Combined sources",acronym:"MIXA"},{name:"ECO:0000213",description:"Automatic assertion inferred from combination of experimental and computational evidence",shortDescription:"Combined sources",acronym:"MIXA"},{name:"ECO:0000244",description:"Manual assertion inferred from combination of experimental and computational evidence",shortDescription:"Combined sources",acronym:"MIXM",isManual:!0},{name:"ECO:0000313",description:"Automatic assertion inferred from database entries",shortDescription:"Imported",acronym:"AI"},{name:"ECO:0000260",description:"Manual assertion inferred from signature match",shortDescription:"InterPro annotation",acronym:"SGNM",isManual:!0}],JX=e=>e.map(t=>{const r={};return t.begin&&(r.start=t.begin),{...t,...r}}),DCe=e=>{var t;return((t=e.name)==null?void 0:t.toLowerCase())==="PubMed".toLowerCase()?`${e.id}&nbsp;(<a href='${e.url}' style="color:#FFF" target='_blank'>${e.name}</a>&nbsp;<a href='${e.alternativeUrl}' style="color:#FFF" target='_blank'>EuropePMC</a>)`:`&nbsp;<a href='${e.url}' style="color:#FFF" target='_blank'>${e.id}</a>&nbsp;${e.name?`(${e.name})`:""}`},eY=e=>e?`
      <ul>${e.map(t=>{const r=MCe.find(n=>n.name===t.code);return r?`<li title='${r.description}' style="padding: .25rem 0">${r.shortDescription}:&nbsp;${t.source?DCe(t.source):""}</li>`:""}).join("")}</ul>
    `:"",tY=e=>`<ul>${e.map(t=>`<li style="padding: .25rem 0">${t.name} ${t.url?`<a href="${t.url}" style="color:#FFF" target="_blank">${t.id}</a>`:`${t.name} ${t.id}`}</li>`).join("")}</ul>`,RCe=e=>{if(!e)return"";const t=e.flatMap(({dbReferences:i})=>i.map(a=>a.id)),r=[...new Set(t.flat())],n="https://www.ebi.ac.uk/pride/archive/projects/";return`
  <ul>${r.map(i=>{const a=i==="Glue project"?"PXD012174":i;return`<li title='${a}' style="padding: .25rem 0">${a}&nbsp;(<a href="${n}${a}" style="color:#FFF" target="_blank">PRIDE</a>
      ${i==="Glue project"?')</li><li title="publication" style="padding: .25rem 0">Publication:&nbsp;31819260&nbsp;(<a href="https://pubmed.ncbi.nlm.nih.gov/31819260" style="color:#FFF" target="_blank">PubMed</a>)</li>':'&nbsp;<a href="http://www.peptideatlas.org/builds/rice/phospho/" style="color:#FFF" target="_blank">PeptideAtlas</a>)</li>'}`}).join("")}</ul>
`},kCe=(e,t)=>{if(!t)return"";const r=t.map(a=>({name:a.name,position:a.position}));let n="",i=0;return r.forEach(a=>{n=`${n}${e.slice(i,a.position)}[${a.name}]`,i=a.position}),n=`${n}${e.slice(i)}`,`<p>${n}</p>`},OCe={A:"alanine",S:"serine",T:"threonine",Y:"tyrosine"},P8=(e,t)=>{const{peptide:r,begin:n}=e,i=Number(n)+t.position-1,a=r.charAt(t.position-1);return`${i} phospho${OCe[a]}`},rY=e=>{const t=e.type==="PROTEOMICS_PTM"?RCe(e.ptms):eY(e.evidences),r=e.type==="PROTEOMICS_PTM"&&e.ptms.map(i=>P8(e,i)),n=e.type==="PROTEOMICS_PTM"&&e.ptms.flatMap(({dbReferences:i})=>i.map(a=>a.id));try{return`
      ${e.description?`<h5>Description</h5><p>${e.description}</p>`:""}
      ${e.matchScore?`<h5>Match score</h5><p>${e.matchScore}%</p>`:""}
      ${e.ftId?`<h5>Feature ID</h5><p>${e.ftId}</p>`:""}
      ${e.alternativeSequence?`<h5>Alternative sequence</h5><p>${e.alternativeSequence}</p>`:""}
      ${r?`<h5 data-article-id="ptm_processing_section">PTMs</h5><ul>${r.map(i=>`<li>${i}</li>`).join("")}</ul>
            `:""}
      ${e.peptide&&e.type==="PROTEOMICS_PTM"?`<h5 data-article-id="mod_res_large_scale#what-is-the-goldsilverbronze-criterion">Peptidoform</h5><p>${kCe(e.peptide,e.ptms)}</p>`:""}
      ${e.peptide&&e.type!=="PROTEOMICS_PTM"?`<h5>Peptide</h5><p>${e.peptide}</p>`:""} 
      ${e.xrefs?`<h5>Cross-references</h5>${tY(e.xrefs)}`:""}
      ${t?`<h5>Evidence</h5>${t}`:""}
      ${e.ptms&&n&&!n.includes("Glue project")?`<hr /><h5 data-article-id="mod_res_large_scale#what-is-the-goldsilverbronze-criterion">PTM statistical attributes</h5><ul>${e.ptms.map(i=>i.dbReferences.map(a=>`<li><b>${a.id}</b></li>
                      <li style="text-indent: 1em"><b>${P8(e,i)}</b></li>
                      <li style="text-indent: 2em">PubMed ID: <a href="https://europepmc.org/article/MED/${a.properties["Pubmed ID"]}" style="color:#FFF" target="_blank">
                      ${a.properties["Pubmed ID"]}</a>
                      </li>
                      <li style="text-indent: 2em"><span data-article-id="mod_res_large_scale#confidence-score">Confidence score</span>: ${a.properties["Confidence score"]}</li>
                      <li style="text-indent: 2em">Universal Spectrum Id: 
                      <a href="http://proteomecentral.proteomexchange.org/usi/?usi=${a.properties["Universal Spectrum Id"]}" style="color:#FFF" target="_blank">View on ProteomeXchange</a>
                      </li>
                      <li style="text-indent: 2em">PSM Count: ${a.properties["PSM Count"]}</li>
                      <li style="text-indent: 2em">Site probability: ${a.properties["Site probability"]}</li>
                      `).join("")).join("")}</ul>`:""}
        `}catch(i){return console.error(i),""}},LCe=e=>{let t=[];const{features:r}=e;return r&&r.length>0&&(t=r.map(n=>({...n,tooltipContent:rY(n),protvistaFeatureId:u3()})),t=JX(t)),t},NCe=e=>{let t=[];return e&&e.length!==0&&(t=e.features.map(r=>Object.assign(r,{category:"PROTEOMICS",type:r.unique?"unique":"non_unique",tooltipContent:rY(r),protvistaFeatureId:u3()})),t=JX(t)),t},FCe="PDBE_COVER",BCe="STRUCTURE_COVERAGE",UCe=e=>e.charAt(0).toUpperCase()+e.slice(1),jCe=e=>Object.keys(e).reduce((t,r)=>`${t}${UCe(r)}: ${e[r]}. `,""),zCe=e=>{const t=e.indexOf("="),r=e.indexOf("-");return t===-1||r===-1?{start:0,end:0}:{start:+e.slice(t+1,r),end:+e.slice(r+1)}},VCe=e=>e.dbReferences.filter(t=>t.type==="PDB").map(t=>{const r=t.properties.chains?zCe(t.properties.chains):{start:0,end:0};return{type:FCe,category:BCe,structures:[{description:jCe(t.properties),start:r.start,end:r.end,source:{id:t.id,url:`http://www.ebi.ac.uk/pdbe-srv/view/entry/${t.id}`}}],start:r.start,end:r.end}}),HCe=e=>{if(!e||e.length<=0)return[];const t=e.sort((n,i)=>n.start-i.start),r=[];return t.forEach(n=>{const i=r[r.length-1];!i||i.end<n.start?r.push(n):(i.end<n.end&&(i.end=n.end),i.structures.push(n.structures[0]))}),r},GCe=e=>`<ul>
            ${e.map(t=>`<li style="margin: 0.25rem 0"><a style="color:#FFF" href='${t.source.url}' target='_blank'>
            ${t.source.id}
        </a> (${t.start}-${t.end})</li>`).join("")}
        </ul>`,qCe=e=>{const t=GCe(e.structures);return`${t?`<h5>Structures</h5>${t}`:""}`},WCe=e=>{let t=[];if(e&&e.length!==0){const r=VCe(e);t=HCe(r),t.forEach(n=>{n.tooltipContent=qCe(n),n.protvistaFeatureId=u3()})}return t},$Ce=e=>e==null?void 0:e.map(t=>`
              <h4>Disease association</h4><p>${t.name}</p>
              ${t.description?`<>${t.description}</p>`:""}
              ${t.dbReferences?`<h5>Cross-references</h5>${tY(t.dbReferences)}`:""}
              ${eY(t.evidences)}
          `).join(""),XCe=e=>`<hr/><h5>Description</h5>${e.map(t=>`<p>${t.value}</p>`).join("")}
  `,YCe=e=>`<hr/><h5>Population frequencies</h5>${e.map(t=>`<p>${t.frequency} - ${t.populationName} (${t.source})</p>`).join("")}`,KCe=e=>{if(e.locations.some(r=>r.source==="EnsemblViruses")){const r=e.xrefs.find(n=>n.name==="ENA");return r.id?`<h5>Ensembl COVID-19</h5>
          <p>
          <a href="https://covid-19.ensembl.org/Sars_cov_2/Variation/Explore?v=${r.id}" target="_blank" rel="noopener noreferrer">${r.id}</a>
        </p>`:""}return""},QCe=e=>{const t=yg(e,"predAlgorithmNameType");return Object.keys(t).map(n=>{const i=yg(t[n],"predictionValType");return{algorithm:n,values:Object.keys(i).map(a=>({name:a,count:i[a].length}))}}).map(n=>`<h6>${n.algorithm}</h6><ul class="no-bullet">${n.values.map(i=>`<li>${i.name}</li>`).join("")}</ul>`).join("")},ZCe=e=>`
                <h5>Variant</h5><p>${e.wildType} > ${e.alternativeSequence||""}</p>
                ${e.populationFrequencies?YCe(e.populationFrequencies):""}
                ${e.consequenceType?`<h5>Consequence</h5><p>${e.consequenceType}</p>`:""}
                ${e.somaticStatus?`<h5>Somatic</h5><p>${e.somaticStatus===0?"No":"Yes"}</p>`:""}
                ${e.genomicLocation?`<h5>Location</h5><p>${e.genomicLocation}</p>`:""}
                ${e.ftId?`<h5>Feature ID</h5><p>${e.ftId}</p>`:""}
                ${e.descriptions?XCe(e.descriptions):""}
                ${e.association?$Ce(e.association):""}
                ${e.predictions?QCe(e.predictions):""}
                ${KCe(e)}
                
        `;var uM;(function(e){e.A="A",e.C="C",e.D="D",e.E="E",e.Empty="*",e.F="F",e.G="G",e.H="H",e.I="I",e.K="K",e.L="L",e.M="M",e.N="N",e.Nl="NL",e.P="P",e.Q="Q",e.R="R",e.S="S",e.T="T",e.V="V",e.W="W",e.Y="Y"})(uM||(uM={}));var T8;(function(e){e.CLINVAR="ClinVar",e.ESP="ESP",e.EXAC="ExAC",e.GENOMES1K="1000Genomes",e.BOVINE_SNP50="BovineSNP50",e.BOVINE_LD="BovineLD",e.BOVINE_HD="BovineHD",e.EQUINE_SNP50="EquineSNP50",e.CHICKEN_600K="Chicken600K",e.KG_HQ="1kg_hq",e.COSMIC="cosmic curated",e.REVIEWED="reviewed",e.UNIPROT="UniProt",e.DBSNP="dbSNP",e.ENSEMBL="Ensembl",e.ENSEMBL_PLANTS="EnsemblPlants",e.VECTORBASE="VectorBase",e.REFSEQ="RefSeq",e.DBGAP="dbGaP",e.DDD="DDD",e.PHARMCOGKB="PharmGKB",e.ENSEMBL_FUNGI="EnsemblFungi",e.ENSEMBL_METAZOA="EnsemblMetazoa",e.GNOMAD_V2="gnomAD_v2.0",e.GNOMAD_V3="gnomAD_v3.0",e.TCGA="NCI-TCGA",e.TCGA_COSMIC="NCI-TCGA Cosmic",e.DECIPHER="ddG2P",e.TOPMED="TOPMed",e.GNOMAD="gnomAD",e.PHARMGKB="pharmgkb",e.SGRP="SGRP",e.SGD="SGD",e.JEFFARES_SNPS="Jeffares_SNPs",e.JEFFARES_INDELS="Jeffares_Indels",e.ENSEMBL_VIRUSES="EnsemblViruses"})(T8||(T8={}));var I8;(function(e){e.Benign="Benign",e.Disease="Disease",e.LikelyBenign="Likely benign",e.LikelyPathogenic="Likely pathogenic",e.Pathogenic="Pathogenic",e.Protective="Protective",e.VariantOfUncertainSignificance="Variant of uncertain significance"})(I8||(I8={}));var M8;(function(e){e.Empty="-",e.Frameshift="frameshift",e.InframeDeletion="inframe deletion",e.Insertion="insertion",e.Missense="missense",e.StopGained="stop gained"})(M8||(M8={}));var D8;(function(e){e.PolyPhen="PolyPhen",e.Sift="SIFT"})(D8||(D8={}));var R8;(function(e){e.Benign="benign",e.Deleterious="deleterious",e.DeleteriousLowConfidence="deleterious - low confidence",e.PossiblyDamaging="possibly damaging",e.ProbablyDamaging="probably damaging",e.Tolerated="tolerated",e.ToleratedLowConfidence="tolerated - low confidence",e.Unknown="unknown"})(R8||(R8={}));var k8;(function(e){e.LargeScaleStudy="large_scale_study",e.Mixed="mixed",e.UniProt="uniprot"})(k8||(k8={}));const JCe=(e,t)=>{const r=e?e.map(n=>n.name):[];return(t==="uniprot"||t==="mixed")&&r.push("uniprot"),r},e_e=e=>{const{sequence:t,features:r}=e,n=r.map(i=>Object.assign(Object.assign({},i),{accession:i.genomicLocation,variant:i.alternativeSequence?i.alternativeSequence:uM.Empty,start:i.begin,xrefNames:JCe(i.xrefs,i.sourceType),hasPredictions:i.predictions&&i.predictions.length>0,tooltipContent:ZCe(i),protvistaFeatureId:u3()}));return n?{sequence:t,variants:n}:null},t_e=e=>{try{return e.results.map(({metadata:t,proteins:r})=>({...t,locations:r[0].entry_protein_locations,start:Math.min(...r[0].entry_protein_locations.map(n=>Math.min(...n.fragments.map(i=>i.start)))),end:Math.max(...r[0].entry_protein_locations.map(n=>Math.max(...n.fragments.map(i=>i.end)))),tooltipContent:`
        <h5>Accession</h5>
        <a
          target="_blank"
          rel="noopener"
          href="https://www.ebi.ac.uk/interpro/entry/InterPro/${t.accession}/"
        >
        ${t.accession}
        </a>
        <h5>Name</h5>
        <p>${t.name}</p>
      `,length:r[0].protein_length}))}catch{throw new Error("Failed transforming the data")}};var lM;(function(e){e.Gold="#c39b00",e.Silver="#8194a1",e.Bronze="#a65708"})(lM||(lM={}));const O8={R:"Phosphoarginine",C:"Phosphocysteine",H:"Phosphohistidine",S:"Phosphoserine",T:"Phosphothreonine",Y:"Phosphotyrosine"},r_e=e=>{const t=e.toUpperCase();return t in O8?O8[t]:(console.error(`${t} not a valid amino acid for phosphorylation`),"")},n_e=(e,t,r)=>{const n=[...e.flatMap(({dbReferences:s})=>s==null?void 0:s.flatMap(({id:u})=>[u]))],i=new Set(e.flatMap(({dbReferences:s})=>s==null?void 0:s.map(({properties:u})=>u["Confidence score"])));let a;i.size?i.size>1?console.error(`PTM has a mixture of confidence scores: ${Array.from(i)}`):[a]=i:console.log("PTM has no confidence score");const o=`
  <h5>Description</h5><p>${r_e(t)}</p>
  ${a?`<h5 data-article-id="mod_res_large_scale#confidence-score">Confidence Score</h5><p>${a}</p>`:""}
  ${n?`<h5>Evidence</h5><ul>${n.map(s=>{const u=s==="Glue project"?"PXD012174":s;return`<li title='${u}' style="padding: .25rem 0">${u}&nbsp;
              (<a href="https://www.ebi.ac.uk/pride/archive/projects/${s}" style="color:#FFF" target="_blank">PRIDE</a>)
              </li>
              ${s==="Glue project"?'<li title="publication" style="padding: .25rem 0">Publication:&nbsp;31819260&nbsp;(<a href="https://pubmed.ncbi.nlm.nih.gov/31819260" style="color:#FFF" target="_blank">PubMed</a>)</li>':""}
              `}).join("")}</ul>`:""}
  `;return{source:"PTMeXchange",type:"MOD_RES_LS",start:r,end:r,shape:"triangle",tooltipContent:o,color:lM[a]||"black"}},i_e=e=>{if(e){const{features:t}=e,r={};if(t){for(const n of t)for(const i of n.ptms){const a=+n.begin+i.position-1;if(!Number.isFinite(a)){console.error(`Encountered infinite number: +feature.begin + ptm.position - 1 = ${+n.begin} + ${i.position} - 1`);continue}const o=n.peptide[i.position-1];a in r?r[a].aa!==o?console.error(`One PTM has different amino acid values: [${r[a].aa}, ${o}]`):r[a].ptms.push(i):r[a]={ptms:[i],aa:o}}return Object.entries(r).map(([n,{ptms:i,aa:a}])=>n_e(i,a,+n))}}return[]},a_e=[{name:"DOMAINS_AND_SITES",label:"Domains & sites",trackType:"protvista-track",tracks:[{name:"domain",label:"Domain",filter:"DOMAIN",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"Specific combination of secondary structures organized into a characteristic three-dimensional structure or fold"},{name:"region",label:"Region",filter:"REGION",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"Regions in multifunctional enzymes or fusion proteins, or characteristics of a region, e.g., protein-protein interactions mediation"},{name:"motif",label:"Motif",filter:"MOTIF",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"Short conserved sequence motif of biological significance"},{name:"metal",label:"Metal binding",filter:"METAL",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"Binding site for a metal ion"},{name:"site",label:"Site",filter:"SITE",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"Any interesting single amino acid site on the sequence"},{name:"repeat",label:"Repeat",filter:"REPEAT",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"Repeated sequence motifs or repeated domains within the protein"},{name:"ca_bind",label:"Calcium binding",filter:"CA_BIND",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"Calcium-binding regions, such as the EF-hand motif"},{name:"dna_bind",label:"DNA binding",filter:"DNA_BIND",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"DNA-binding domains such as AP2/ERF domain, the ETS domain, the Fork-Head domain, the HMG box and the Myb domain"},{name:"zn_fing",label:"Zinc finger",filter:"ZN_FING",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"Small, functional, independently folded domain that coordinates one or more zinc ions"},{name:"np_bind",label:"Nucleotide binding",filter:"NP_BIND",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"(aka flavin-binding). Region in the protein which binds nucleotide phosphates"},{name:"binding",label:"Binding site",filter:"BINDING",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"Binding site for any chemical group (co-enzyme, prosthetic group, etc.)"},{name:"act_site",label:"Active site",filter:"ACT_SITE",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"Amino acid(s) directly involved in the activity of an enzyme"}]},{name:"MOLECULE_PROCESSING",label:"Molecule processing",trackType:"protvista-track",tracks:[{name:"signal",label:"Signal peptide",filter:"SIGNAL",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"N-terminal signal peptide"},{name:"chain",label:"Chain",filter:"CHAIN",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"(aka mature region). This describes the extent of a polypeptide chain in the mature protein following processing"},{name:"transit",label:"Transit peptide",filter:"TRANSIT",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"This describes the extent of a transit peptide"},{name:"init_met",label:"Initiator methionine",filter:"INIT_MET",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"This indicates that the initiator methionine is cleaved from the mature protein"},{name:"propep",label:"Propeptide",filter:"PROPEP",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"Part of a protein that is cleaved during maturation or activation"},{name:"peptide",label:"Peptide",filter:"PEPTIDE",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"The position and length of an active peptide in the mature protein"}]},{name:"PTM",label:"PTM",trackType:"protvista-track",tracks:[{name:"mod_res",label:"Modified residue",filter:"MOD_RES",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"Modified residues such as phosphorylation, acetylation, acylation, methylation"},{name:"mod_res_ls",label:"Modified residue (large scale data)",filter:"MOD_RES_LS",trackType:"protvista-track",data:[{adapter:"protvista-proteomics-ptm-adapter",url:"https://www.ebi.ac.uk/proteins/api/proteomics-ptm/{accession}"}],tooltip:"Modified residues from Large scale studies"},{name:"carbohyd",label:"Glycosylation",filter:"CARBOHYD",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"Covalently attached glycan group(s)"},{name:"disulfid",label:"Disulfide bond",filter:"DISULFID",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"The positions of cysteine residues participating in disulphide bonds"},{name:"crosslnk",label:"Cross-link",filter:"CROSSLNK",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"Covalent linkages of various types formed between two proteins or between two parts of the same protein"},{name:"lipid",label:"Lipidation",filter:"LIPID",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"Covalently attached lipid group(s)"}]},{name:"SEQUENCE_INFORMATION",label:"Sequence information",trackType:"protvista-track",tracks:[{name:"compbias",label:"Compositional bias",filter:"COMPBIAS",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"Position of regions of compositional bias within the protein and the particular amino acids that are over-represented within those regions"},{name:"conflict",label:"Sequence conflict",filter:"CONFLICT",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"Sequence discrepancies of unknown origin"},{name:"non_cons",filter:"NON_CONS",trackType:"protvista-track",label:"Non-adjacent residues",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"Indicates that two residues in a sequence are not consecutive and that there is an undetermined number of unsequenced residues between them"},{name:"non_ter",filter:"NON_TER",trackType:"protvista-track",label:"Non-terminal residue",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"The sequence is incomplete. The residue is not the terminal residue of the complete protein"},{name:"unsure",filter:"UNSURE",trackType:"protvista-track",label:"Sequence uncertainty",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"Regions of a sequence for which the authors are unsure about the sequence assignment"},{name:"non_std",filter:"NON_STD",trackType:"protvista-track",label:"Non-standard residue",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"Non-standard amino acids (selenocysteine and pyrrolysine)"}]},{name:"STRUCTURAL",label:"Structural features",trackType:"protvista-track",tracks:[{name:"helix",label:"Helix",filter:"HELIX",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"The positions of experimentally determined helical regions"},{name:"strand",label:"Beta strand",filter:"STRAND",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"The positions of experimentally determined beta strands"},{name:"turn",label:"Turn",filter:"TURN",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"The positions of experimentally determined hydrogen-bonded turns"},{name:"coiled",label:"Coiled coil",filter:"COILED",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"Coiled coils are built by two or more alpha-helices that wind around each other to form a supercoil"}]},{name:"STRUCTURE_COVERAGE",label:"PDBe 3D structure coverage",trackType:"protvista-track",tracks:[{name:"pdbe_cover",label:"PDBe coverage",trackType:"protvista-track",tooltip:"PDBe 3D structure coverage",data:[{adapter:"protvista-structure-adapter",url:"https://www.ebi.ac.uk/proteins/api/proteins/{accession}"}]}]},{name:"TOPOLOGY",label:"Topology",trackType:"protvista-track",tracks:[{name:"topo_dom",label:"Topological domain",filter:"TOPO_DOM",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"Location of non-membrane regions of membrane-spanning proteins"},{name:"transmem",label:"Transmembrane",filter:"TRANSMEM",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"Extent of a membrane-spanning region"},{name:"intramem",label:"Intramembrane",filter:"INTRAMEM",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"Extent of a region located in a membrane without crossing it"}]},{name:"MUTAGENESIS",label:"Mutagenesis",trackType:"protvista-track",tracks:[{name:"mutagen",label:"Mutagenesis",filter:"MUTAGEN",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"Site which has been experimentally altered by mutagenesis"},{name:"othermutagen",label:"Other Mutagenesis",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/mutagenesis/{accession}"}],tooltip:"Site which has been experimentally altered by mutagenesis"}]},{name:"PROTEOMICS",label:"Proteomics",trackType:"protvista-track",adapter:"protvista-proteomics-adapter",urls:["https://www.ebi.ac.uk/proteins/api/proteomics/{accession}","https://www.ebi.ac.uk/proteins/api/proteomics-ptm/{accession}"],tracks:[{name:"unique",label:"Unique peptide",filter:"unique",trackType:"protvista-track",data:[{adapter:"protvista-proteomics-adapter",url:"https://www.ebi.ac.uk/proteins/api/proteomics/{accession}"}],tooltip:""},{name:"non_unique",label:"Non-unique peptide",filter:"non_unique",trackType:"protvista-track",data:[{adapter:"protvista-proteomics-adapter",url:"https://www.ebi.ac.uk/proteins/api/proteomics/{accession}"}],tooltip:""},{name:"proteomics-ptm",label:"PTM-containing peptide",trackType:"protvista-track",data:[{adapter:"protvista-proteomics-adapter",url:"https://www.ebi.ac.uk/proteins/api/proteomics-ptm/{accession}"}],tooltip:""}]},{name:"ANTIGEN",label:"Antigenic sequences",trackType:"protvista-track",tracks:[{name:"antigen",label:"Antibody binding sequences",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/antigen/{accession}"}],tooltip:""}]},{name:"VARIATION",label:"Variants",trackType:"protvista-variation-graph",tracks:[{name:"variation",filterComponent:"protvista-filter",trackType:"protvista-variation",data:[{adapter:"protvista-variation-adapter",url:"https://www.ebi.ac.uk/proteins/api/variation/{accession}"}],tooltip:"Natural variant of the protein, including polymorphisms, variations between strains, isolates or cultivars, disease-associated mutations and RNA editing events"}]}],o_e=[{type:"features",url:"https://www.ebi.ac.uk/proteins/api/features/"},{type:"variants",url:"https://www.ebi.ac.uk/proteins/api/variation/"},{type:"antigens",url:"https://www.ebi.ac.uk/proteins/api/antigen/"},{type:"proteomics",url:"https://www.ebi.ac.uk/proteins/api/proteomics/"}],s_e={categories:a_e,download:o_e};var u_e=globalThis&&globalThis.__awaiter||function(e,t,r,n){function i(a){return a instanceof r?a:new r(function(o){o(a)})}return new(r||(r=Promise))(function(a,o){function s(c){try{l(n.next(c))}catch(d){o(d)}}function u(c){try{l(n.throw(c))}catch(d){o(d)}}function l(c){c.done?a(c.value):i(c.value).then(s,u)}l((n=n.apply(e,t||[])).next())})};const nP=new Map,L8=(e,t=new Headers({accept:"application/json"}))=>{const r=nP.get(e);if(r)return r;const n=(()=>u_e(void 0,void 0,void 0,function*(){const i=yield window.fetch(e,{headers:t});if(!i.ok)throw new Error(`Request Failed: Status = ${i.status}; URI = ${e}; Time = ${new Date}`);return i.status===204?{payload:null,headers:i.headers}:{payload:yield i.json(),headers:i.headers}}))();return nP.set(e,n),n.catch(()=>nP.delete(e)),n};function l_e(e,t){var r=-1,n=_b(e)?Array(e.length):[];return DX(e,function(i,a,o){n[++r]=t(i,a,o)}),n}function c_e(e,t){var r=Wo(e)?wb:l_e;return r(e,jX(t))}function N8(e,t){return Ik(c_e(e,t),1)}typeof window<"u"&&function(){window.console=window.console||{};for(var e=window.console,t,r,n={},i=function(){},a="memory".split(","),o="assert,clear,count,debug,dir,dirxml,error,exception,group,groupCollapsed,groupEnd,info,log,markTimeline,profile,profiles,profileEnd,show,table,time,timeEnd,timeline,timelineEnd,timeStamp,trace,warn".split(",");t=a.pop();)e[t]||(e[t]=n);for(;r=o.pop();)e[r]||(e[r]=i)}();typeof window.HTMLCanvasElement<"u"&&!window.HTMLCanvasElement.prototype.toBlob&&Object.defineProperty(window.HTMLCanvasElement.prototype,"toBlob",{value:function(e,t,r){for(var n=window.atob(this.toDataURL(t,r).split(",")[1]),i=n.length,a=i>>2,o=new Uint8Array(i),s=new Uint32Array(o.buffer,0,a),u=0,l=0;l<a;l++)s[l]=n.charCodeAt(u++)|n.charCodeAt(u++)<<8|n.charCodeAt(u++)<<16|n.charCodeAt(u++)<<24;for(var c=i&3;c--;)o[u]=n.charCodeAt(u++);e(new window.Blob([o],{type:t||"image/png"}))}});Math.cbrt=Math.cbrt||function(e){var t=Math.pow(Math.abs(e),.3333333333333333);return e<0?-t:t};Math.sign||(Math.sign=function(e){return e=+e,e===0||isNaN(e)?Number(e):e>0?1:-1});Number.isInteger||(Number.isInteger=function(t){return typeof t=="number"&&isFinite(t)&&t>-9007199254740992&&t<9007199254740992&&Math.floor(t)===t});Number.isNaN||(Number.isNaN=function(t){return t!==t});Object.assign||Object.defineProperty(Object,"assign",{enumerable:!1,configurable:!0,writable:!0,value:function(e){if(e==null)throw new TypeError("Cannot convert first argument to object");for(var t=Object(e),r=!1,n,i=1;i<arguments.length;i++){var a=arguments[i];if(a!=null){for(var o=Object.keys(Object(a)),s=0,u=o.length;s<u;s++){var l=o[s];try{var c=Object.getOwnPropertyDescriptor(a,l);c!==void 0&&c.enumerable&&(t[l]=a[l])}catch(d){r||(r=!0,n=d)}}if(r)throw n}}return t}});String.prototype.startsWith||function(){var e=function(){var n;try{var i={},a=Object.defineProperty;n=a(i,i,i)&&a}catch{}return n}(),t={}.toString,r=function(n){if(this===null)throw TypeError();var i=String(this);if(n&&t.call(n)==="[object RegExp]")throw TypeError();var a=i.length,o=String(n),s=o.length,u=arguments.length>1?arguments[1]:void 0,l=u?Number(u):0;Number.isNaN(l)&&(l=0);var c=Math.min(Math.max(l,0),a);if(s+c>a)return!1;for(var d=-1;++d<s;)if(i.charCodeAt(c+d)!==o.charCodeAt(d))return!1;return!0};e?e(String.prototype,"startsWith",{value:r,configurable:!0,writable:!0}):String.prototype.startsWith=r}();String.prototype.endsWith||(String.prototype.endsWith=function(e,t){var r=this.toString();(typeof t!="number"||!isFinite(t)||Math.floor(t)!==t||t>r.length)&&(t=r.length),t-=e.length;var n=r.indexOf(e,t);return n!==-1&&n===t});String.prototype.repeat||(String.prototype.repeat=function(e){if(this===null)throw new TypeError("can't convert "+this+" to object");var t=""+this;if(e=+e,Number.isNaN(e)&&(e=0),e<0)throw new RangeError("repeat count must be non-negative");if(e===1/0)throw new RangeError("repeat count must be less than infinity");if(e=Math.floor(e),t.length===0||e===0)return"";if(t.length*e>=1<<28)throw new RangeError("repeat count must not overflow maximum string size");for(var r="";(e&1)===1&&(r+=t),e>>>=1,e!==0;)t+=t;return r});String.prototype.includes||(String.prototype.includes=function(e,t){return typeof t!="number"&&(t=0),t+e.length>this.length?!1:this.indexOf(e,t)!==-1});Array.prototype.includes||(Array.prototype.includes=function(e){if(this==null)throw new TypeError("Array.prototype.includes called on null or undefined");var t=Object(this),r=parseInt(t.length,10)||0;if(r===0)return!1;var n=parseInt(arguments[1],10)||0,i;n>=0?i=n:(i=r+n,i<0&&(i=0));for(var a;i<r;){if(a=t[i],e===a||Number.isNaN(e)&&Number.isNaN(a))return!0;i++}return!1});Array.from||(Array.from=function(){var e=Object.prototype.toString,t=function(a){return typeof a=="function"||e.call(a)==="[object Function]"},r=function(a){var o=Number(a);return isNaN(o)?0:o===0||!isFinite(o)?o:(o>0?1:-1)*Math.floor(Math.abs(o))},n=Math.pow(2,53)-1,i=function(a){var o=r(a);return Math.min(Math.max(o,0),n)};return function(o){var s=this,u=Object(o);if(o==null)throw new TypeError("Array.from requires an array-like object - not null or undefined");var l=arguments.length>1?arguments[1]:void 0,c;if(typeof l<"u"){if(!t(l))throw new TypeError("Array.from: when provided, the second argument must be a function");arguments.length>2&&(c=arguments[2])}for(var d=i(u.length),f=t(s)?Object(new s(d)):new Array(d),h=0,v;h<d;)v=u[h],l?f[h]=typeof c>"u"?l(v,h):l.call(c,v,h):f[h]=v,h+=1;return f.length=d,f}}());typeof window<"u"&&function(){for(var e=0,t=["ms","moz","webkit","o"],r=0;r<t.length&&!window.requestAnimationFrame;++r)window.requestAnimationFrame=window[t[r]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[t[r]+"CancelAnimationFrame"]||window[t[r]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(n){var i=new Date().getTime(),a=Math.max(0,16-(i-e)),o=window.setTimeout(function(){var s=i+a;n(s)},a);return e=i+a,o}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(n){clearTimeout(n)})}();Function.prototype.name===void 0&&Object.defineProperty!==void 0&&Object.defineProperty(Function.prototype,"name",{get:function(){return this.toString().match(/^\s*function\s*(\S*)\s*\(/)[1]}});typeof window<"u"&&(window.performance===void 0&&(window.performance={}),window.performance.now===void 0&&function(){var e=Date.now();window.performance.now=function(){return Date.now()-e}}());Object.defineProperty!==void 0&&(Number.MAX_SAFE_INTEGER===void 0&&Object.defineProperty(Number,"MAX_SAFE_INTEGER",{enumerable:!1,configurable:!1,writable:!1,value:Math.pow(2,53)-1}),Number.MIN_SAFE_INTEGER===void 0&&Object.defineProperty(Number,"MIN_SAFE_INTEGER",{enumerable:!1,configurable:!1,writable:!1,value:-(Math.pow(2,53)-1)}));Object.entries||(Object.entries=function(e){for(var t=Object.keys(e),r=t.length,n=new Array(r);r--;)n[r]=[t[r],e[t[r]]];return n});Array.prototype.find||Object.defineProperty(Array.prototype,"find",{value:function(e){if(this==null)throw TypeError('"this" is null or not defined');var t=Object(this),r=t.length>>>0;if(typeof e!="function")throw TypeError("predicate must be a function");for(var n=arguments[1],i=0;i<r;){var a=t[i];if(e.call(n,a,i,t))return a;i++}},configurable:!0,writable:!0});Array.prototype.fill||Object.defineProperty(Array.prototype,"fill",{value:function(e){if(this==null)throw new TypeError("this is null or not defined");for(var t=Object(this),r=t.length>>>0,n=arguments[1],i=n>>0,a=i<0?Math.max(r+i,0):Math.min(i,r),o=arguments[2],s=o===void 0?r:o>>0,u=s<0?Math.max(r+s,0):Math.min(s,r);a<u;)t[a]=e,a++;return t}});Array.prototype.copyWithin||Object.defineProperty(Array.prototype,"copyWithin",{value:function(e,t){if(this==null)throw new TypeError("this is null or not defined");var r=Object(this),n=r.length>>>0,i=e>>0,a=i<0?Math.max(n+i,0):Math.min(i,n),o=t>>0,s=o<0?Math.max(n+o,0):Math.min(o,n),u=arguments[2],l=u===void 0?n:u>>0,c=l<0?Math.max(n+l,0):Math.min(l,n),d=Math.min(c-s,n-a),f=1;for(s<a&&a<s+d&&(f=-1,s+=d-1,a+=d-1);d>0;)s in r?r[a]=r[s]:delete r[a],s+=f,a+=f,d--;return r},configurable:!0,writable:!0});Int8Array.prototype.copyWithin||Object.defineProperty(Int8Array.prototype,"copyWithin",{value:Array.prototype.copyWithin});Int16Array.prototype.copyWithin||Object.defineProperty(Int16Array.prototype,"copyWithin",{value:Array.prototype.copyWithin});Int32Array.prototype.copyWithin||Object.defineProperty(Int32Array.prototype,"copyWithin",{value:Array.prototype.copyWithin});Uint8Array.prototype.copyWithin||Object.defineProperty(Uint8Array.prototype,"copyWithin",{value:Array.prototype.copyWithin});Uint16Array.prototype.copyWithin||Object.defineProperty(Uint16Array.prototype,"copyWithin",{value:Array.prototype.copyWithin});Uint32Array.prototype.copyWithin||Object.defineProperty(Uint32Array.prototype,"copyWithin",{value:Array.prototype.copyWithin});Float32Array.prototype.copyWithin||Object.defineProperty(Float32Array.prototype,"copyWithin",{value:Array.prototype.copyWithin});Float64Array.prototype.copyWithin||Object.defineProperty(Float64Array.prototype,"copyWithin",{value:Array.prototype.copyWithin});var cM=function(e,t){return cM=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(r[i]=n[i])},cM(e,t)};function Le(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");cM(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}var E=function(){return E=Object.assign||function(t){for(var r,n=1,i=arguments.length;n<i;n++){r=arguments[n];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(t[a]=r[a])}return t},E.apply(this,arguments)};function ce(e,t,r,n){function i(a){return a instanceof r?a:new r(function(o){o(a)})}return new(r||(r=Promise))(function(a,o){function s(c){try{l(n.next(c))}catch(d){o(d)}}function u(c){try{l(n.throw(c))}catch(d){o(d)}}function l(c){c.done?a(c.value):i(c.value).then(s,u)}l((n=n.apply(e,t||[])).next())})}function de(e,t){var r={label:0,sent:function(){if(a[0]&1)throw a[1];return a[1]},trys:[],ops:[]},n,i,a,o;return o={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function s(l){return function(c){return u([l,c])}}function u(l){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,l[0]&&(r=0)),r;)try{if(n=1,i&&(a=l[0]&2?i.return:l[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,l[1])).done)return a;switch(i=0,a&&(l=[l[0]&2,a.value]),l[0]){case 0:case 1:a=l;break;case 4:return r.label++,{value:l[1],done:!1};case 5:r.label++,i=l[1],l=[0];continue;case 7:l=r.ops.pop(),r.trys.pop();continue;default:if(a=r.trys,!(a=a.length>0&&a[a.length-1])&&(l[0]===6||l[0]===2)){r=0;continue}if(l[0]===3&&(!a||l[1]>a[0]&&l[1]<a[3])){r.label=l[1];break}if(l[0]===6&&r.label<a[1]){r.label=a[1],a=l;break}if(a&&r.label<a[2]){r.label=a[2],r.ops.push(l);break}a[2]&&r.ops.pop(),r.trys.pop();continue}l=t.call(e,r)}catch(c){l=[6,c],i=0}finally{n=a=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}function Ft(e,t,r){if(r||arguments.length===2)for(var n=0,i=t.length,a;n<i;n++)(a||!(n in t))&&(a||(a=Array.prototype.slice.call(t,0,n)),a[n]=t[n]);return e.concat(a||Array.prototype.slice.call(t))}var da;(function(e){function t(i){return i}e.create=t;function r(i,a){return(i&a)!==0}e.has=r;function n(i,a){return!!a&&(i&a)===a}e.hasAll=n})(da||(da={}));var Rr;(function(e){function t(S){return S===void 0&&(S=512),{current:[],offset:0,capacity:S,chunks:[]}}e.create=t;function r(S){return S.chunks.length?(S.offset>0&&(S.chunks[S.chunks.length]=S.current.length===S.offset?S.current.join(""):S.current.slice(0,S.offset).join("")),S.chunks.join("")):S.current.length===S.offset?S.current.join(""):S.current.splice(0,S.offset).join("")}e.getString=r;function n(S){for(var x=0,C=0,w=S.chunks;C<w.length;C++){var A=w[C];x+=A.length}for(var M=0;M<S.offset;M++)x+=S.current[M].length;return x}e.getSize=n;function i(S){return S.offset>0&&(S.current.length===S.offset?S.chunks[S.chunks.length]=S.current.join(""):S.chunks[S.chunks.length]=S.current.slice(0,S.offset).join(""),S.offset=0),S.chunks}e.getChunks=i;var a=[];(function(){for(var S="",x=0;x<512;x++)a[x]=S,S=S+" "})();function o(S){c(S,`
`)}e.newline=o;function s(S,x){x>0&&c(S,a[x])}e.whitespace=s;function u(S){c(S," ")}e.whitespace1=u;function l(S,x){x&&(S.offset===S.capacity&&(S.chunks[S.chunks.length]=S.current.join(""),S.offset=0),S.current[S.offset++]=x)}e.write=l;function c(S,x){S.offset===S.capacity&&(S.chunks[S.chunks.length]=S.current.join(""),S.offset=0),S.current[S.offset++]=x}e.writeSafe=c;function d(S,x,C){if(!x){s(S,C);return}var w=C-x.length;s(S,w),c(S,x)}e.writePadLeft=d;function f(S,x,C){if(!x){s(S,C);return}var w=C-x.length;c(S,x),s(S,w)}e.writePadRight=f;function h(S,x){c(S,""+x)}e.writeInteger=h;function v(S,x){c(S,""+x+" ")}e.writeIntegerAndSpace=v;function p(S,x,C){var w=""+x,A=C-w.length;s(S,A),c(S,w)}e.writeIntegerPadLeft=p;function m(S,x,C){var w=""+x,A=C-w.length;c(S,w),s(S,A)}e.writeIntegerPadRight=m;function g(S,x,C){c(S,""+Math.round(C*x)/C)}e.writeFloat=g;function y(S,x,C,w){var A=""+Math.round(C*x)/C,M=w-A.length;s(S,M),c(S,A)}e.writeFloatPadLeft=y;function b(S,x,C,w){var A=""+Math.round(C*x)/C,M=w-A.length;c(S,A),s(S,M)}e.writeFloatPadRight=b})(Rr||(Rr={}));var Tn=function(){if(typeof window<"u"&&window.performance){var e=window.performance;return function(){return e.now()}}else return typeof process<"u"&&process.hrtime!=="undefined"&&typeof process.hrtime=="function"?function(){var t=process.hrtime();return t[0]*1e3+t[1]/1e6}:Date.now?function(){return Date.now()}:function(){return+new Date}}();function sS(e,t){if(t===void 0&&(t=!0),isNaN(e))return"n/a";for(var r=Math.floor(e/(60*60*1e3)),n=Math.floor(e/(60*1e3)%60),i=Math.floor(e/1e3%60),a=Math.floor(e%1e3).toString();a.length<3;)a="0"+a;for(;!t&&a.length>1&&a[a.length-1]==="0";)a=a.substr(0,a.length-1);return r>0?r+"h"+n+"m"+i+"."+a+"s":n>0?n+"m"+i+"."+a+"s":i>0?i+"."+a+"s":e.toFixed(0)+"ms"}var dn;(function(e){var t=typeof btoa<"u"?btoa:function(o){return Buffer.from(o).toString("base64")},r=[];function n(){for(var o=+new Date+Tn(),s=0;s<16;s++)r[s]=String.fromCharCode((o+Math.random()*255)%255|0),o=Math.floor(o/255);return t(r.join("")).replace(/\+/g,"-").replace(/\//g,"_").substr(0,22)}e.create22=n;function i(){var o=+new Date+Tn(),s="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(u){var l=(o+Math.random()*16)%16|0;return o=Math.floor(o/16),(u==="x"?l:l&3|8).toString(16)});return s}e.createv4=i;function a(o){return typeof o=="string"}e.is=a})(dn||(dn={}));function d_e(e,t){return e-t}function f_e(e){return Array.prototype.sort.call(e,d_e),e}var F8;(function(e){var t=function(){function h(){this.size=0}return h.prototype.has=function(v){return!1},h.prototype.forEach=function(v,p){return p},h}(),r=function(){function h(v){this.idx=v,this.size=1}return h.prototype.has=function(v){return v===this.idx},h.prototype.forEach=function(v,p){return v(this.idx,p),p},h}(),n=function(){function h(v,p){this.mask=v,this.size=p,this.length=v.length}return h.prototype.has=function(v){return v<this.length&&!!this.mask[v]},h.prototype._forEach=function(v,p){for(var m=0;m<this.length;m++)this.mask[m]&&v(m,p)},h.prototype.forEach=function(v,p){return this._forEach(v,p),p},h}(),i=function(){function h(v){this.size=v}return h.prototype.has=function(v){return!0},h.prototype._forEach=function(v,p){for(var m=0;m<this.size;m++)v(m,p)},h.prototype.forEach=function(v,p){return this._forEach(v,p),p},h}(),a=function(){function h(v){this.set=v,this._flat=void 0,this.size=v.size}return h.prototype.has=function(v){return this.set.has(v)},h.prototype._forEach=function(v,p){for(var m=0,g=this.flatten();m<g.length;m++){var y=g[m];v(y,p)}},h.prototype.flatten=function(){if(this._flat)return this._flat;var v=new Int32Array(this.size),p=0;return this.set.forEach(function(m){return v[p++]=m}),f_e(v),this._flat=v,this._flat},h.prototype.forEach=function(v,p){return this._forEach(v,p),p},h}();function o(h){return new i(h)}e.always=o,e.never=new t;function s(h){return new a(h)}e.ofSet=s;function u(h){return new r(h)}e.singleton=u;function l(h){var v=h.length;if(v===0)return new t;if(v===1)return new r(h[0]);for(var p=0,m=0,g=h;m<g.length;m++){var y=g[m];y>p&&(p=y)}if(v===p)return new i(v);var b=v/p;if(b<1/12){for(var S=new Set,x=0,C=h;x<C.length;x++){var y=C[x];S.add(y)}return new a(S)}for(var w=new Int8Array(p+1),A=0,M=h;A<M.length;A++){var y=M[A];w[y]=1}return new n(w,h.length)}e.ofUniqueIndices=l;function c(h,v){return new n(h,v)}e.ofMask=c;function d(h,v){for(var p=0,m=v;p<m.length;p++){var g=m[p];if(h.has(g))return!0}return!1}e.hasAny=d;function f(h,v){var p=0,m=0;if(v.forEach(function(b){h.has(b)||(p++,b>m&&(m=b))}),p/m<1/12){var g=new Set;return v.forEach(function(b){h.has(b)||g.add(b)}),s(g)}else{var y=new Uint8Array(m+1);return v.forEach(function(b){h.has(b)||(y[b]=1)}),c(y,p)}}e.complement=f})(F8||(F8={}));function Fa(e,t){e===void 0&&(e=0),t===void 0&&(t=Number.MAX_SAFE_INTEGER);var r=e;return function(){var n=r;return r=(r+1)%t,n}}var Uy;(function(e){function t(n){return{ref:n}}e.create=t;function r(n,i){return n.ref=i,n}e.set=r})(Uy||(Uy={}));var h_e=Fa(0,2147483647),Hf;(function(e){function t(n,i){return{id:h_e(),version:0,value:n,metadata:i}}e.create=t;function r(n,i){return{id:n.id,version:n.version+1,value:i,metadata:n.metadata}}e.withValue=r})(Hf||(Hf={}));var N;(function(e){function t(a,o){return Uy.create(Hf.create(a,o))}e.create=t;function r(a,o){return Uy.set(a,Hf.withValue(a.ref,o))}e.update=r;function n(a,o){return Uy.set(a,o)}e.set=n;function i(a,o){return a.ref.value!==o?r(a,o):a}e.updateIfChanged=i})(N||(N={}));var ef=function(){};function Xa(e,t){var r=e.length;if(r!==t.length)return!1;for(var n=0;n<r;n++)if(e[n]!==t[n])return!1;return!0}var nY=Object.prototype.hasOwnProperty;function Mc(e,t){if(e===t)return!0;var r=Array.isArray(e),n=Array.isArray(t);if(r&&n){if(e.length!==t.length)return!1;for(var i=0;i<e.length;i++)if(!Mc(e[i],t[i]))return!1;return!0}if(r!==n)return!1;if(e&&t&&typeof e=="object"&&typeof t=="object"){var a=Object.keys(e);if(a.length!==Object.keys(t).length)return!1;var o=e instanceof Date,s=t instanceof Date;if(o&&s)return e.getTime()===t.getTime();if(o!==s)return!1;var u=e instanceof RegExp,l=t instanceof RegExp;if(u&&l)return e.toString()===t.toString();if(u!==l)return!1;for(var i=0;i<a.length;i++)if(!nY.call(t,a[i]))return!1;for(var i=0;i<a.length;i++)if(!Mc(e[a[i]],t[a[i]]))return!1;return!0}return!1}function RC(e,t){if(e===t)return!0;var r=Array.isArray(e),n=Array.isArray(t);return r&&n?p_e(e,t):r!==n?!1:e&&t&&typeof e=="object"&&typeof t=="object"?xg(e,t):!1}function xg(e,t){if(e===t)return!0;if(!e||!t)return!1;var r=Object.keys(e);if(Object.keys(t).length!==r.length)return!1;for(var n=0,i=r;n<i.length;n++){var a=i[n];if(!nY.call(e,a)||e[a]!==t[a])return!1}return!0}function p_e(e,t){if(e===t)return!0;if(!e||!t||e.length!==t.length)return!1;for(var r=0,n=e.length;r<n;++r)if(e[r]!==t[r])return!1;return!0}function Ei(e,t){return e!==void 0?e:t}function B8(e){return(e<10?"0":"")+e}function v_e(e){var t=e.getHours(),r=e.getMinutes(),n=e.getSeconds();return t+":"+B8(r)+":"+B8(n)}var jy=Math.PI/2,iY=Math.PI/180;function $r(e){return e*iY}function mu(e){return e/iY}function m_e(e){return e!==0&&(e&e-1)===0}function g_e(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var r=0,n=0,i=0,a=e.length;i<a;++i){var o=e[i],s=Math.abs(o);s>n&&(r=o,n=s)}return r}function aY(e,t){return e*t}function y_e(e,t,r){return(e-t)/(r-t)}function Ia(e,t,r){return Math.max(t,Math.min(r,e))}function b_e(e){return Ia(e,0,1)}function Bo(e,t,r){return e+(t-e)*r}function uS(e,t,r,n,i,a){var o=(r-e)*a,s=(n-t)*a,u=i*i,l=i*u;return(2*t-2*r+o+s)*l+(-3*t+3*r-2*o-s)*u+o*i+t}function iP(e,t,r,n){var i=1-n;return i*i*e+2*i*n*t+n*n*r}function oY(e,t,r){return r=b_e(y_e(r,e,t)),r*r*(3-2*r)}function ea(){return ea.zero()}(function(e){function t(){var D=[.1,0,0];return D[0]=0,D}e.zero=t;function r(D,k,R){var L=t();return L[0]=D,L[1]=k,L[2]=R,L}e.create=r;function n(D,k){var R=at.toRgb(k),L=R[0],H=R[1],B=R[2],j=M(L,H,B),Q=j[0],G=j[1],W=j[2],q=116*G-16;return D[0]=q<0?0:q,D[1]=500*(Q-G),D[2]=200*(G-W),D}e.fromColor=n;function i(D,k){return yl.toLab(D,k)}e.fromHcl=i;function a(D){var k=(D[0]+16)/116,R=isNaN(D[1])?k:k+D[1]/500,L=isNaN(D[2])?k:k-D[2]/200;k=p*C(k),R=v*C(R),L=m*C(L);var H=x(3.2404542*R-1.5371385*k-.4985314*L),B=x(-.969266*R+1.8760108*k+.041556*L),j=x(.0556434*R-.2040259*k+1.0572252*L);return at.fromRgb(Math.round(Ia(H,0,255)),Math.round(Ia(B,0,255)),Math.round(Ia(j,0,255)))}e.toColor=a;function o(D,k){var R=k[0],L=k[1],H=k[2],B=Math.sqrt(L*L+H*H),j=(mu(Math.atan2(H,L))+360)%360;return Math.round(B*1e4)===0&&(j=Number.NaN),D[0]=j,D[1]=B,D[2]=R,D}e.toHcl=o;function s(D,k){return D[0]=k[0],D[1]=k[1],D[2]=k[2],D}e.copy=s;function u(D,k,R){return D[0]=k[0]-h*R,D[1]=k[1],D[2]=k[2],D}e.darken=u;function l(D,k,R){return u(D,k,-R)}e.lighten=l;var c=[0,0,0];function d(D,k,R){return o(c,k),yl.toLab(D,yl.saturate(c,c,R))}e.saturate=d;function f(D,k,R){return d(D,k,-R)}e.desaturate=f;var h=18,v=.95047,p=1,m=1.08883,g=.137931034,y=.206896552,b=.12841855,S=.008856452;function x(D){return 255*(D<=.00304?12.92*D:1.055*Math.pow(D,1/2.4)-.055)}function C(D){return D>y?D*D*D:b*(D-g)}function w(D){return(D/=255)<=.04045?D/12.92:Math.pow((D+.055)/1.055,2.4)}function A(D){return D>S?Math.pow(D,1/3):D/b+g}function M(D,k,R){D=w(D),k=w(k),R=w(R);var L=A((.4124564*D+.3575761*k+.1804375*R)/v),H=A((.2126729*D+.7151522*k+.072175*R)/p),B=A((.0193339*D+.119192*k+.9503041*R)/m);return[L,H,B]}})(ea||(ea={}));function yl(){return yl.zero()}(function(e){function t(){var m=[.1,0,0];return m[0]=0,m}e.zero=t;function r(m,g,y){var b=t();return b[0]=m,b[1]=g,b[2]=y,b}e.create=r;var n=[0,0,0];function i(m,g){return ea.toHcl(m,ea.fromColor(n,g))}e.fromColor=i;function a(m,g){return ea.toHcl(m,g)}e.fromLab=a;var o=[0,0,0];function s(m){return ea.toColor(u(o,m))}e.toColor=s;function u(m,g){var y=g[0],b=g[1],S=g[2];return isNaN(y)&&(y=0),y=$r(y),m[0]=S,m[1]=Math.cos(y)*b,m[2]=Math.sin(y)*b,m}e.toLab=u;function l(m,g){return m[0]=g[0],m[1]=g[1],m[2]=g[2],m}e.copy=l;function c(m,g,y){return m[0]=g[0],m[1]=Math.max(0,g[1]+p*y),m[2]=g[2],m}e.saturate=c;function d(m,g,y){return c(m,g,-y)}e.desaturate=d;var f=[0,0,0];function h(m,g,y){return u(f,g),ea.toHcl(m,ea.darken(f,f,y))}e.darken=h;function v(m,g,y){return h(m,g,-y)}e.lighten=v;var p=18})(yl||(yl={}));function at(e){return e}(function(e){function t(M){return"rgb("+(M>>16&255)+", "+(M>>8&255)+", "+(M&255)+")"}e.toStyle=t;function r(M){return"0x"+("000000"+M.toString(16)).slice(-6)}e.toHexString=r;function n(M){return"RGB: "+e.toRgb(M).join(", ")}e.toRgbString=n;function i(M){return[M>>16&255,M>>8&255,M&255]}e.toRgb=i;function a(M){return[(M>>16&255)/255,(M>>8&255)/255,(M&255)/255]}e.toRgbNormalized=a;function o(M,D,k){return M<<16|D<<8|k}e.fromRgb=o;function s(M,D,k){return M*255<<16|D*255<<8|k*255}e.fromNormalizedRgb=s;function u(M,D){return o(M[D],M[D+1],M[D+2])}e.fromArray=u;function l(M,D){return s(M[D],M[D+1],M[D+2])}e.fromNormalizedArray=l;function c(M,D,k){return D[k]=M>>16&255,D[k+1]=M>>8&255,D[k+2]=M&255,D}e.toArray=c;function d(M,D,k){return D[k]=(M>>16&255)/255,D[k+1]=(M>>8&255)/255,D[k+2]=(M&255)/255,D}e.toArrayNormalized=d;function f(M,D){return M[0]=D>>16&255,M[1]=D>>8&255,M[2]=D&255,M}e.toVec3=f;function h(M,D){return M[0]=(D>>16&255)/255,M[1]=(D>>8&255)/255,M[2]=(D&255)/255,M}e.toVec3Normalized=h;function v(M,D,k){var R=M>>16&255,L=M>>8&255,H=M&255,B=D>>16&255,j=D>>8&255,Q=D&255,G=R+(B-R)*k,W=L+(j-L)*k,q=H+(Q-H)*k;return G<<16|W<<8|q}e.interpolate=v;var p=[0,0,0];function m(M,D){return yl.fromColor(p,M),yl.toColor(yl.saturate(p,p,D))}e.saturate=m;function g(M,D){return m(M,-D)}e.desaturate=g;var y=[0,0,0];function b(M,D){return ea.fromColor(y,M),ea.toColor(ea.darken(y,y,D))}e.darken=b;function S(M,D){return b(M,-D)}e.lighten=S;function x(M){return M<.04045?M*.0773993808:Math.pow(M*.9478672986+.0521327014,2.4)}function C(M){return s(x((M>>16&255)/255),x((M>>8&255)/255),x((M&255)/255))}e.sRGBToLinear=C;function w(M){return M<.0031308?M*12.92:1.055*Math.pow(M,.41666)-.055}function A(M){return s(w((M>>16&255)/255),w((M>>8&255)/255),w((M&255)/255))}e.linearToSRGB=A})(at||(at={}));function yr(e,t,r,n){return{label:e,description:r,list:n,type:t}}function l3(e,t,r){var n={};for(var i in e){var a=e[i];a=at.saturate(a,t),a=at.darken(a,-r),n[i]=a}return n}function sY(e,t){return t===void 0&&(t=" "),e.replace(/([a-z\xE0-\xFF])([A-Z\xC0\xDF])/g,"$1"+t+"$2")}function Oa(e){return Hg(sY(e))}var x_e=function(e){return e.toUpperCase()};function S_e(e){return e?typeof e=="string"?e.toUpperCase():(""+e).toUpperCase():""}function Hg(e){return e.toLowerCase().replace(/^\w|\s\w/g,x_e)}function C_e(e){return e.replace(/_/g," ")}function __e(e){return e.replace(/-/g," ")}function zo(e){return Hg(sY(C_e(__e(e))))}function ci(e,t,r,n){var i=n.length;if(i>r-t)return!1;for(var a=0;a<i;a++)if(e.charCodeAt(t+a)!==n.charCodeAt(a))return!1;return!0}function w_e(e,t){var r=Object.keys(t),n=Object.values(t);return new(Function.bind.apply(Function,Ft(Ft([void 0],r),["return `"+e+"`;"])))().apply(void 0,n)}function ff(e){return e.replace(/<\/?[^>]+>/g,"")}var mo={"orange-red":yr("Orange-Red","sequential","Orange-Red, sequential color scheme from ColorBrewer 2.0",[16775148,16705736,16635038,16628612,16551257,15689032,14102559,11730944,8323072]),"purple-blue":yr("Purple-Blue","sequential","Purple-Blue, sequential color scheme from ColorBrewer 2.0",[16775163,15525874,13685222,10927579,7645647,3576e3,356528,285325,145496]),"blue-purple":yr("Blue-Purple","sequential","Blue-Purple, sequential color scheme from ColorBrewer 2.0",[16252157,14740724,12571622,10403034,9213638,9202609,8929693,8458108,5046347]),oranges:yr("Oranges","sequential","",[16774635,16705230,16634018,16625259,16616764,15821075,14239745,10892803,8333060]),"blue-green":yr("Blue-Green","sequential","",[16252157,15070713,13429990,10082505,6734500,4304502,2329413,27948,17435]),"yellow-orange-brown":yr("Yellow-Orange-Brown","sequential","",[16777189,16775100,16704401,16696399,16685353,15495188,13388802,10040324,6694150]),"yellow-green":yr("Yellow-Green","sequential","",[16777189,16252089,14282915,11394446,7915129,4303709,2327619,26679,17705]),reds:yr("Reds","sequential","",[16774640,16703698,16563105,16552562,16476746,15678252,13309981,10817301,6750221]),"red-purple":yr("Red-Purple","sequential","",[16775155,16638173,16565696,16424885,16214177,14496919,11403646,7995767,4784234]),greens:yr("Greens","sequential","",[16252149,15070688,13101504,10607003,7652470,4303709,2329413,27948,17435]),"yellow-green-blue":yr("Yellow-Green-Blue","sequential","",[16777177,15595697,13101492,8375739,4306628,1937856,2252456,2438292,531800]),purples:yr("Purples","sequential","",[16579581,15724021,14342891,12369372,10394312,8420794,6967715,5515151,4128893]),"green-blue":yr("Green-Blue","sequential","",[16252144,14742491,13429701,11066805,8113348,5157843,2854078,551084,540801]),greys:yr("Greys","sequential","",[16777215,15790320,14277081,12434877,9868950,7566195,5395026,2434341,0]),"yellow-orange-red":yr("Yellow-Orange-Red","sequential","",[16777164,16772512,16701814,16691788,16616764,16535082,14883356,12386342,8388646]),"purple-red":yr("Purple-Red","sequential","",[16250105,15196655,13941210,13210823,14640560,15149450,13505110,9961539,6750239]),blues:yr("Blues","sequential","",[16251903,14609399,13032431,10406625,7057110,4362950,2191797,545180,536683]),"purple-blue-green":yr("Purple-Blue-Green","sequential","",[16775163,15524592,13685222,10927579,6793679,3576e3,164234,93273,83510]),spectral:yr("Spectral","diverging","",[10355010,13975119,16018755,16625249,16703627,16777151,15136152,11263396,6734501,3311805,6180770]),"red-yellow-green":yr("Red-Yellow-Green","diverging","",[10813478,14102567,16018755,16625249,16703627,16777151,14282635,10934634,6733155,1742928,26679]),"red-blue":yr("Red-Blue","diverging","",[6750239,11671595,14049357,16033154,16636871,16250871,13755888,9618910,4428739,2188972,340065]),"pink-yellow-green":yr("Pink-Yellow-Green","diverging","",[9306450,12917629,14579630,15840986,16638191,16250871,15136208,12116358,8371265,5083681,2581529]),"purple-green":yr("Purple-Green","diverging","",[4194379,7744131,10055851,12756431,15193320,16250871,14282963,10935200,5942881,1800247,17435]),"red-yellow-blue":yr("Red-Yellow-Blue","diverging","Red-Yellow-Blue, diverging color scheme from ColorBrewer 2.0",[10813478,14102567,16018755,16625249,16703632,16777151,14742520,11262441,7646673,4552116,3225237]),"brown-white-green":yr("Brown-White-Green","diverging","",[5517317,9195786,12550445,14664317,16181443,16119285,13101797,8441281,3512207,91742,15408]),"red-grey":yr("Red-Grey","diverging","",[6750239,11671595,14049357,16033154,16636871,16777215,14737632,12237498,8882055,5066061,1710618]),"orange-purple":yr("Orange-Purple","diverging","",[8338184,11753478,14713364,16627811,16703670,16250871,14211819,11709394,8418220,5515144,2949195]),"set-2":yr("Set-2","qualitative","",[6734501,16551266,9281739,15174339,10934356,16767279,15058068,11776947]),accent:yr("Accent","qualitative","",[8374655,12496596,16629894,16777113,3697840,15729279,12540695,6710886]),"set-1":yr("Set-1","qualitative","",[14948892,3636920,5091146,9981603,16744192,16777011,10901032,16220607,10066329]),"set-3":yr("Set-3","qualitative","",[9294791,16777139,12499674,16482418,8434131,16626786,11787881,16567781,14277081,12353725,13429701,16772463]),"dark-2":yr("Dark-2","qualitative","",[1810039,14245634,7696563,15149450,6727198,15117058,10909213,6710886]),paired:yr("Paired","qualitative","",[10931939,2062516,11722634,3383340,16489113,14883356,16629615,16744192,13284054,6962586,16777113,11622696]),"pastel-2":yr("Pastel-2","qualitative","",[11789005,16633260,13358568,16042724,15136201,16773806,15852236,13421772]),"pastel-1":yr("Pastel-1","qualitative","",[16495790,11783651,13429701,14601188,16701862,16777164,15063229,16636652,15921906]),"many-distinct":yr("Many-Distinct","qualitative","",[1810039,14245634,7696563,15149450,6727198,15117058,10909213,6710886,14948892,3636920,5091146,9981603,16744192,16777011,10901032,16220607,10066329,6734501,16551266,9281739,15174339,10934356,16767279,15058068,11776947]),magma:yr("Magma","sequential","Perceptually uniform shades of black-red-white",[4329332,4853881,5378684,5903742,6363263,6888576,7413633,7938689,8463745,8988801,9513600,10038655,10563454,11088508,11613562,12138360,12728949,13254258,13714030,14239338,14699366,15094114,15489119,15753309,16017499,16216411,16350045,16483424,16551523,16619368,16621934,16689780,16692091,16694402,16696969,16633746,16636058,16638371,16575148,16577461,16514239]),inferno:yr("Inferno","sequential","Perceptually uniform shades of black-red-yellow",[4721514,5246316,5771373,6296430,6821486,7346542,7871597,8396651,8921450,9446504,9971557,10496610,10956127,11481435,12006486,12466258,12926285,13386056,13780802,14241085,14570295,14965297,15229227,15558693,15757342,15956248,16154897,16288267,16421638,16489734,16492043,16494612,16496926,16368426,16305463,16111429,15982678,15853928,15856253,16119953,16580260]),plasma:yr("Plasma","sequential","Perceptually uniform shades of blue-red-yellow",[1771148,2426257,3081365,3671193,4195228,4784799,5308834,5833124,6357158,6815911,7340200,7864744,8324007,8783782,9309348,9769377,10164126,10624154,11018902,11413393,11808141,12137352,12466307,12795519,13124730,13453685,13717361,14046573,14309992,14573668,14837344,15035483,15299159,15497299,15695438,15893834,16091974,16224833,16357693,16425017,16557877,16625457,16627245,16629289,16631334,16567845,16438820,16310052,16115494,15921190,15726625]),viridis:yr("Viridis","sequential","Perceptually uniform shades of blue-green-yellow",[4524123,4656994,4658793,4726127,4727668,4663929,4599933,4535937,4406404,4276870,4081800,3952010,3822475,3627148,3497356,3302029,3172237,3042446,2912654,2782862,2652814,2523022,2393229,2328973,2198924,2069132,2004874,2005897,2007175,2139525,2337154,2666111,3060348,3520376,4045684,4570991,5227369,5883748,6605661,7392854,8180303,8967495,9819967,10672695,11525166,12443174,13295646,14148121,15000344,15852828,16639780]),cividis:yr("Cividis","sequential","Perceptually uniform shades of blue-green-yellow, should look effectively identical to colorblind and non-colorblind users",[11367,12400,537456,1455727,2046574,2571629,3031404,3425388,3754092,4148075,4476779,4805227,5133932,5396844,5725549,5988462,6317166,6580079,6843249,7171698,7434867,7697781,7960951,8289656,8618104,8881272,9209976,9538679,9867127,10195830,10524533,10853235,11181938,11510640,11839343,12168045,12497002,12891240,13219941,13548642,13943134,14271834,14666326,14995025,15389516,15718470,16112703,16507190,16639799]),twilight:yr("Twilight","sequential","Perceptually uniform shades of white-blue-black-red-white, cyclic",[14670305,14211037,13554648,12766675,11847630,10993866,10139847,9351365,8628419,8036290,7509952,7048895,6718653,6519739,6386105,6252470,6184114,6181293,6112935,6044831,5976470,5777291,5447293,5052270,4592479,4067665,3674181,3281211,3150646,3543352,4067644,4657728,5379141,6166345,6953549,7741007,8463184,9120336,9777743,10304079,10830671,11291984,11687762,12083541,12348505,12613471,12878439,13077872,13211771,13411209,13545111,13809830,14074293,14338756,14537169,14735067,14801121]),turbo:yr("Turbo","sequential","Improved (smooth) rainbow colormap for visualization",[4866485,4872413,4354034,3770361,3120629,2667241,2475736,2611140,3073454,3928216,5109892,6487408,8126047,9829201,11531332,13167162,14605618,15780908,16693543,16753699,16748063,16741916,16146200,15026195,13644558,12198408,10818563,9833728]),rainbow:yr("Rainbow","sequential","",[3367393,3516485,16383744,15501073,12526114]),"red-white-blue":yr("Red-White-Blue","diverging","",[12526114,16777215,3367393])},E_e=Object.keys(mo),Rk=E_e.map(function(e){return[e,mo[e].label,Hg(mo[e].type)]}),A_e=Rk.filter(function(e){return mo[e[0]].type==="diverging"||mo[e[0]].type==="sequential"}),P_e=Rk.filter(function(e){return mo[e[0]].type==="qualitative"});function Os(e){return e in mo?mo[e]:(console.warn("unknown color list named '"+e+"'"),mo["red-yellow-blue"])}function uh(e){return{kind:"table-legend",table:e}}function T_e(e,t,r){return{kind:"scale-legend",minLabel:e,maxLabel:t,colors:r}}var qe;(function(e){function t(f){return f.creator&&f.chunkSize}e.is=t;function r(f){var h=f.growBy*f.elementSize;f.currentSize=h,f.currentIndex=0,f.currentChunk=new f.ctor(h),f.allocatedSize+=h,f.chunks[f.chunks.length]=f.currentChunk}function n(f,h,v,p,m){f.currentIndex>=f.currentSize&&r(f);var g=f.currentChunk,y=f.currentIndex;return g[y]=h,g[y+1]=v,g[y+2]=p,g[y+3]=m,f.currentIndex+=4,f.elementCount++}e.add4=n;function i(f,h,v,p){f.currentIndex>=f.currentSize&&r(f);var m=f.currentChunk,g=f.currentIndex;return m[g]=h,m[g+1]=v,m[g+2]=p,f.currentIndex+=3,f.elementCount++}e.add3=i;function a(f,h,v){f.currentIndex>=f.currentSize&&r(f);var p=f.currentChunk,m=f.currentIndex;return p[m]=h,p[m+1]=v,f.currentIndex+=2,f.elementCount++}e.add2=a;function o(f,h){return f.currentIndex>=f.currentSize&&r(f),f.currentChunk[f.currentIndex]=h,f.currentIndex+=1,f.elementCount++}e.add=o;function s(f,h,v){for(var p=0;p<h;p++)f.currentIndex>=f.currentSize&&r(f),f.currentChunk[f.currentIndex++]=v,f.elementCount++;return f.elementCount}e.addRepeat=s;function u(f,h){for(var v=f.elementSize,p=0,m=h.length;p<m;p+=v){f.currentIndex>=f.currentSize&&r(f);for(var g=f.currentChunk,y=0;y<v;y++)g[f.currentIndex++]=h[p+y];f.elementCount++}return f.elementCount}e.addMany=u;function l(f,h){return h===void 0&&(h=!1),c(f,h)}e.compact=l;function c(f,h){var v=f.ctor,p=f.chunks,m=f.currentIndex;if(!p.length)return new v(0);if(p.length===1&&(h||m===f.allocatedSize))return p[0];for(var g=0,y=0,b=p.length-1;y<b;y++)g+=p[y].length;g+=f.currentIndex;var S=new v(g),x=0;if(S.buffer)for(var y=0,b=p.length-1;y<b;y++)S.set(p[y],x),x+=p[y].length;else for(var y=0,b=p.length-1;y<b;y++){for(var C=p[y],w=0,A=C.length;w<A;w++)S[x+w]=C[w];x+=C.length}var M=p[p.length-1];if(S.buffer&&m>=f.currentSize)S.set(M,x);else for(var w=0,A=M.length;w<A;w++)S[x+w]=M[w];return S}e._compact=c;function d(f,h,v,p){var m={ctor:f,elementSize:h,growBy:Math.max(1,Math.ceil(v)),allocatedSize:0,elementCount:0,currentSize:0,currentChunk:void 0,currentIndex:0,chunks:[]};if(typeof p>"u")return m;if(typeof p=="number")return m.currentChunk=new f(p*h),m.allocatedSize=p*h,m.currentSize=m.currentChunk.length,m.chunks[0]=m.currentChunk,m;var g=p;if(g.length%h!==0)throw new Error("initialChunk length must be a multiple of the element size.");return m.currentChunk=g,m.allocatedSize=g.length,m.currentSize=g.length,m.chunks[0]=g,m}e.create=d})(qe||(qe={}));function kC(e,t,r){return e[t]-e[r]}function np(e,t,r){var n=e[t];e[t]=e[r],e[r]=n}function uY(e,t,r,n){var i=r+n>>1;return t(e,r,n)>0?t(e,r,i)>0?t(e,i,n)>0?i:n:r:t(e,n,i)>0?t(e,i,r)>0?i:r:n}function I_e(e,t,r){var n=e.cmp,i=e.swap,a=e.data,o=e.parts,s=t+1,u=r;for(i(a,t,uY(a,n,t,r));n(a,u,t)>0;)--u;for(var l=t+1;l<=u;l++){var c=n(a,l,t);if(c>0){for(i(a,l,u),--u;n(a,u,t)>0;)--u;l--}else c===0&&(i(a,l,s),s++)}for(var l=t;l<s;l++)i(a,l,t+u-l);o[0]=u-s+t+1,o[1]=u}function M_e(e,t,r){for(var n=e.data,i=e.cmp,a=e.swap,o=t+1;o<=r;o++)for(var s=o-1;s>=t&&i(n,s,s+1)>0;)a(n,s,s+1),s=s-1}function OC(e,t,r){for(var n=e.parts;t<r;){if(r-t<16){M_e(e,t,r);return}I_e(e,t,r);var i=n[0],a=n[1];i-t<r-a?(OC(e,t,i-1),t=a+1):(OC(e,a+1,r),r=i-1)}}function D_e(e,t,r,n){var i=r+1,a=n;np(e,r,uY(e,kC,r,n));for(var o=e[r];e[a]>o;)--a;for(var s=r+1;s<=a;s++){var u=e[s];if(u>o){for(np(e,s,a),--a;e[a]>o;)--a;s--}else u===o&&(np(e,s,i),++i)}for(var s=r;s<i;s++)np(e,s,r+a-s);t[0]=a-i+r+1,t[1]=a}function R_e(e,t,r){for(var n=t+1;n<=r;n++){for(var i=e[n],a=n-1;a>=t&&e[a]>i;)e[a+1]=e[a],a=a-1;e[a+1]=i}}function dM(e,t,r,n){for(;r<n;){if(n-r<16){R_e(e,r,n);return}D_e(e,t,r,n);var i=t[0],a=t[1];i-r<n-a?(dM(e,t,r,i-1),r=a+1):(dM(e,t,a+1,n),n=i-1)}}function gu(e,t){return t===void 0&&(t=kC),k_e(e,0,e.length,t)}function k_e(e,t,r,n){return n===void 0&&(n=kC),n===kC?dM(e,[0,0],t,r-1):OC({data:e,cmp:n,swap:np,parts:[0,0]},t,r-1),e}function lY(e,t,r,n,i){var a={data:e,cmp:n,swap:i,parts:[0,0]};return OC(a,t,r-1),e}function O_e(e,t,r){return e[t].key<e[r].key?-1:1}function L_e(e,t,r,n,i){for(var a=new Map,o=[],s=t(e[0]),u=!0,l=n;l<i;l++){var c=t(e[l]);if(a.has(c))a.get(c).count++,s!==c&&(u=!1);else{var d={key:c,count:1,offset:l};a.set(c,d),o[o.length]=d}s=c}var f=new Int32Array(o.length+1);f[o.length]=i;var h=!0;if(r){for(var l=1,v=o.length;l<v;l++)if(o[l-1].key>o[l].key){h=!1;break}}if(u&&h){for(var l=0;l<o.length;l++)f[l]=o[l].offset;return f}r&&!h&&lY(o,0,o.length,O_e,np);for(var p=0,l=0;l<o.length;l++){var m=o[l];m.offset=p,p+=m.count}for(var g=new Int32Array(i-n),l=n;l<i;l++){var c=t(e[l]),d=a.get(c);g[d.offset++]=e[l]}for(var l=0,v=g.length;l<v;l++)e[l+n]=g[l];f[0]=n;for(var l=1;l<o.length;l++)f[l]=o[l-1].offset+n;return f}function aP(e,t,r){var n=r&&r.start||0,i=r&&r.end||e.length;if(i-n<=0)throw new Error("Can only bucket non-empty collections.");return L_e(e,t,!!(r&&r.sort),n,i)}var N_e=function(){function e(t,r){this.getHash=t,this.areEqual=r,this.id=0,this.byHash=new Map,this.groups=[]}return e.prototype.createGroup=function(t,r){var n=this.id++,i=[t];return this.groups[n]=i,{id:n,keys:i,value:r}},e.prototype.add=function(t,r){var n=this.getHash(r);if(this.byHash.has(n)){for(var i=this.byHash.get(n),a=0,o=i.length;a<o;a++){var s=i[a];if(this.areEqual(r,s.value))return s.keys[s.keys.length]=t,s.value}var u=this.createGroup(t,r);return i[i.length]=u,u.value}else{var u=this.createGroup(t,r);return this.byHash.set(n,[u]),u.value}},e}();function F_e(e,t){return new N_e(e,t)}function cY(e){var t=e^e>>4;return t=(t^3735928559)+(t<<5),t=t^t>>11,t}function cv(e,t){var r=23;return r=31*r+e|0,r=31*r+t|0,r=r^r>>4,r=(r^3735928559)+(r<<5),r=r^r>>11,r}function B_e(e,t,r){var n=23;return n=31*n+e|0,n=31*n+t|0,n=31*n+r|0,n=n^n>>4,n=(n^3735928559)+(n<<5),n=n^n>>11,n}function U_e(e,t,r,n){var i=23;return i=31*i+e|0,i=31*i+t|0,i=31*i+r|0,i=31*i+n|0,i=i^i>>4,i=(i^3735928559)+(i<<5),i=i^i>>11,i}function kk(e){for(var t=0,r=0,n=e.length;r<n;r++)t=(t<<5)-t+e.charCodeAt(r++)|0;return t}function Rf(e,t){return(e+t)*(e+t+1)/2+t}function La(e){for(var t=2166136261,r=0,n=e.length;r<n;++r)t^=e[r],t+=(t<<1)+(t<<4)+(t<<7)+(t<<8)+(t<<24);return t>>>0}function LC(e,t){var r=t&&typeof t.start<"u"?Math.max(Math.min(t.start,e-1),0):0,n=t&&typeof t.end<"u"?Math.min(t.end,e):e;return{start:r,end:n}}function Eb(e,t){var r=t&&typeof t.array<"u"?t.array:Array,n=LC(e,t),i=n.start,a=n.end;return{array:new r(a-i),start:i,end:a}}function j_e(e,t,r){for(var n=0,i=t.length;n<i;n++)t[n]=e(r+n);return t}function Qi(e,t,r){var n=Eb(e,r),i=n.array,a=n.start;return j_e(t,i,a)}function Ok(e){return!!e.buffer&&typeof e.byteLength=="number"&&typeof e.BYTES_PER_ELEMENT=="number"}function NC(e,t){var r=e.constructor,n=e.buffer,i=e.length,a=e.byteOffset,o=e.BYTES_PER_ELEMENT,s=LC(i,t),u=s.start,l=s.end;return u===0&&l===i?e:new r(n,a+o*u,Math.min(i,l-u))}var vn=1e-6;function hn(e,t,r){return Math.abs(e-t)<=r}function ue(){return ue.zero()}(function(e){function t(){var O=[.1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];return O[0]=0,O}e.zero=t;function r(){var O=t();return O[0]=1,O[1]=0,O[2]=0,O[3]=0,O[4]=0,O[5]=1,O[6]=0,O[7]=0,O[8]=0,O[9]=0,O[10]=1,O[11]=0,O[12]=0,O[13]=0,O[14]=0,O[15]=1,O}e.identity=r;function n(O){return O[0]=1,O[1]=0,O[2]=0,O[3]=0,O[4]=0,O[5]=1,O[6]=0,O[7]=0,O[8]=0,O[9]=0,O[10]=1,O[11]=0,O[12]=0,O[13]=0,O[14]=0,O[15]=1,O}e.setIdentity=n;function i(O){for(var V=0;V<16;V++)O[V]=0;return O}e.setZero=i;function a(O){for(var V=t(),pe=0;pe<4;pe++)for(var _e=O[pe],Pe=0;Pe<4;Pe++)V[4*Pe+pe]=_e[Pe];return V}e.ofRows=a;var o=r();function s(O,V){return l(O,o,typeof V>"u"?vn:V)}e.isIdentity=s;function u(O){for(var V=0;V<16;V++)if(isNaN(O[V]))return!0;return!1}e.hasNaN=u;function l(O,V,pe){for(var _e=0;_e<16;_e++)if(Math.abs(O[_e]-V[_e])>pe)return!1;return!0}e.areEqual=l;function c(O,V,pe,_e){O[4*pe+V]=_e}e.setValue=c;function d(O,V,pe){return O[4*pe+V]}e.getValue=d;function f(O,V,pe){return V[pe+0]=O[0],V[pe+1]=O[1],V[pe+2]=O[2],V[pe+3]=O[3],V[pe+4]=O[4],V[pe+5]=O[5],V[pe+6]=O[6],V[pe+7]=O[7],V[pe+8]=O[8],V[pe+9]=O[9],V[pe+10]=O[10],V[pe+11]=O[11],V[pe+12]=O[12],V[pe+13]=O[13],V[pe+14]=O[14],V[pe+15]=O[15],V}e.toArray=f;function h(O,V,pe){return O[0]=V[pe+0],O[1]=V[pe+1],O[2]=V[pe+2],O[3]=V[pe+3],O[4]=V[pe+4],O[5]=V[pe+5],O[6]=V[pe+6],O[7]=V[pe+7],O[8]=V[pe+8],O[9]=V[pe+9],O[10]=V[pe+10],O[11]=V[pe+11],O[12]=V[pe+12],O[13]=V[pe+13],O[14]=V[pe+14],O[15]=V[pe+15],O}e.fromArray=h;function v(O,V,pe,_e){return i(O),c(O,0,0,V[0]),c(O,1,0,V[1]),c(O,2,0,V[2]),c(O,0,1,pe[0]),c(O,1,1,pe[1]),c(O,2,1,pe[2]),c(O,0,2,_e[0]),c(O,1,2,_e[1]),c(O,2,2,_e[2]),c(O,3,3,1),O}e.fromBasis=v;function p(O,V){return O[0]=V[0],O[1]=V[1],O[2]=V[2],O[3]=V[3],O[4]=V[4],O[5]=V[5],O[6]=V[6],O[7]=V[7],O[8]=V[8],O[9]=V[9],O[10]=V[10],O[11]=V[11],O[12]=V[12],O[13]=V[13],O[14]=V[14],O[15]=V[15],O}e.copy=p;function m(O){return p(t(),O)}e.clone=m;function g(O,V){return O[0]=V[12],O[1]=V[13],O[2]=V[14],O}e.getTranslation=g;function y(O,V){var pe=V[0],_e=V[1],Pe=V[2],je=V[4],ze=V[5],Xe=V[6],ct=V[8],Ne=V[9],Qe=V[10];return O[0]=Math.sqrt(pe*pe+_e*_e+Pe*Pe),O[1]=Math.sqrt(je*je+ze*ze+Xe*Xe),O[2]=Math.sqrt(ct*ct+Ne*Ne+Qe*Qe),O}e.getScaling=y;function b(O,V){var pe=V[0]+V[5]+V[10],_e=0;return pe>0?(_e=Math.sqrt(pe+1)*2,O[3]=.25*_e,O[0]=(V[6]-V[9])/_e,O[1]=(V[8]-V[2])/_e,O[2]=(V[1]-V[4])/_e):V[0]>V[5]&&V[0]>V[10]?(_e=Math.sqrt(1+V[0]-V[5]-V[10])*2,O[3]=(V[6]-V[9])/_e,O[0]=.25*_e,O[1]=(V[1]+V[4])/_e,O[2]=(V[8]+V[2])/_e):V[5]>V[10]?(_e=Math.sqrt(1+V[5]-V[0]-V[10])*2,O[3]=(V[8]-V[2])/_e,O[0]=(V[1]+V[4])/_e,O[1]=.25*_e,O[2]=(V[6]+V[9])/_e):(_e=Math.sqrt(1+V[10]-V[0]-V[5])*2,O[3]=(V[1]-V[4])/_e,O[0]=(V[8]+V[2])/_e,O[1]=(V[6]+V[9])/_e,O[2]=.25*_e),O}e.getRotation=b;function S(O,V){var pe=1/Math.sqrt(V[0]*V[0]+V[1]*V[1]+V[2]*V[2]),_e=1/Math.sqrt(V[4]*V[4]+V[5]*V[5]+V[6]*V[6]),Pe=1/Math.sqrt(V[8]*V[8]+V[9]*V[9]+V[10]*V[10]);return O[0]=V[0]*pe,O[1]=V[1]*pe,O[2]=V[2]*pe,O[3]=0,O[4]=V[4]*_e,O[5]=V[5]*_e,O[6]=V[6]*_e,O[7]=0,O[8]=V[8]*Pe,O[9]=V[9]*Pe,O[10]=V[10]*Pe,O[11]=0,O[12]=0,O[13]=0,O[14]=0,O[15]=1,O}e.extractRotation=S;function x(O,V){if(O===V){var pe=V[1],_e=V[2],Pe=V[3],je=V[6],ze=V[7],Xe=V[11];O[1]=V[4],O[2]=V[8],O[3]=V[12],O[4]=pe,O[6]=V[9],O[7]=V[13],O[8]=_e,O[9]=je,O[11]=V[14],O[12]=Pe,O[13]=ze,O[14]=Xe}else O[0]=V[0],O[1]=V[4],O[2]=V[8],O[3]=V[12],O[4]=V[1],O[5]=V[5],O[6]=V[9],O[7]=V[13],O[8]=V[2],O[9]=V[6],O[10]=V[10],O[11]=V[14],O[12]=V[3],O[13]=V[7],O[14]=V[11],O[15]=V[15];return O}e.transpose=x;function C(O,V){var pe=V[0],_e=V[1],Pe=V[2],je=V[3],ze=V[4],Xe=V[5],ct=V[6],Ne=V[7],Qe=V[8],it=V[9],ot=V[10],dt=V[11],Re=V[12],Ie=V[13],Ye=V[14],tt=V[15],xt=pe*Xe-_e*ze,pt=pe*ct-Pe*ze,ut=pe*Ne-je*ze,fe=_e*ct-Pe*Xe,me=_e*Ne-je*Xe,we=Pe*Ne-je*ct,Ke=Qe*Ie-it*Re,gt=Qe*Ye-ot*Re,Pt=Qe*tt-dt*Re,$t=it*Ye-ot*Ie,lr=it*tt-dt*Ie,Er=ot*tt-dt*Ye,Yt=xt*Er-pt*lr+ut*$t+fe*Pt-me*gt+we*Ke;return Yt?(Yt=1/Yt,O[0]=(Xe*Er-ct*lr+Ne*$t)*Yt,O[1]=(Pe*lr-_e*Er-je*$t)*Yt,O[2]=(Ie*we-Ye*me+tt*fe)*Yt,O[3]=(ot*me-it*we-dt*fe)*Yt,O[4]=(ct*Pt-ze*Er-Ne*gt)*Yt,O[5]=(pe*Er-Pe*Pt+je*gt)*Yt,O[6]=(Ye*ut-Re*we-tt*pt)*Yt,O[7]=(Qe*we-ot*ut+dt*pt)*Yt,O[8]=(ze*lr-Xe*Pt+Ne*Ke)*Yt,O[9]=(_e*Pt-pe*lr-je*Ke)*Yt,O[10]=(Re*me-Ie*ut+tt*xt)*Yt,O[11]=(it*ut-Qe*me-dt*xt)*Yt,O[12]=(Xe*gt-ze*$t-ct*Ke)*Yt,O[13]=(pe*$t-_e*gt+Pe*Ke)*Yt,O[14]=(Ie*pt-Re*fe-Ye*xt)*Yt,O[15]=(Qe*fe-it*pt+ot*xt)*Yt,!0):!1}e.tryInvert=C;function w(O,V){return C(O,V)||console.warn("non-invertible matrix.",V),O}e.invert=w;function A(O,V,pe){var _e=V[0],Pe=V[1],je=V[2],ze=V[3],Xe=V[4],ct=V[5],Ne=V[6],Qe=V[7],it=V[8],ot=V[9],dt=V[10],Re=V[11],Ie=V[12],Ye=V[13],tt=V[14],xt=V[15],pt=pe[0],ut=pe[1],fe=pe[2],me=pe[3];return O[0]=pt*_e+ut*Xe+fe*it+me*Ie,O[1]=pt*Pe+ut*ct+fe*ot+me*Ye,O[2]=pt*je+ut*Ne+fe*dt+me*tt,O[3]=pt*ze+ut*Qe+fe*Re+me*xt,pt=pe[4],ut=pe[5],fe=pe[6],me=pe[7],O[4]=pt*_e+ut*Xe+fe*it+me*Ie,O[5]=pt*Pe+ut*ct+fe*ot+me*Ye,O[6]=pt*je+ut*Ne+fe*dt+me*tt,O[7]=pt*ze+ut*Qe+fe*Re+me*xt,pt=pe[8],ut=pe[9],fe=pe[10],me=pe[11],O[8]=pt*_e+ut*Xe+fe*it+me*Ie,O[9]=pt*Pe+ut*ct+fe*ot+me*Ye,O[10]=pt*je+ut*Ne+fe*dt+me*tt,O[11]=pt*ze+ut*Qe+fe*Re+me*xt,pt=pe[12],ut=pe[13],fe=pe[14],me=pe[15],O[12]=pt*_e+ut*Xe+fe*it+me*Ie,O[13]=pt*Pe+ut*ct+fe*ot+me*Ye,O[14]=pt*je+ut*Ne+fe*dt+me*tt,O[15]=pt*ze+ut*Qe+fe*Re+me*xt,O}e.mul=A;function M(O,V,pe,_e,Pe,je){var ze=V[0+Pe],Xe=V[1+Pe],ct=V[2+Pe],Ne=V[3+Pe],Qe=V[4+Pe],it=V[5+Pe],ot=V[6+Pe],dt=V[7+Pe],Re=V[8+Pe],Ie=V[9+Pe],Ye=V[10+Pe],tt=V[11+Pe],xt=V[12+Pe],pt=V[13+Pe],ut=V[14+Pe],fe=V[15+Pe],me=pe[0+je],we=pe[1+je],Ke=pe[2+je],gt=pe[3+je];return O[0+_e]=me*ze+we*Qe+Ke*Re+gt*xt,O[1+_e]=me*Xe+we*it+Ke*Ie+gt*pt,O[2+_e]=me*ct+we*ot+Ke*Ye+gt*ut,O[3+_e]=me*Ne+we*dt+Ke*tt+gt*fe,me=pe[4+je],we=pe[5+je],Ke=pe[6+je],gt=pe[7+je],O[4+_e]=me*ze+we*Qe+Ke*Re+gt*xt,O[5+_e]=me*Xe+we*it+Ke*Ie+gt*pt,O[6+_e]=me*ct+we*ot+Ke*Ye+gt*ut,O[7+_e]=me*Ne+we*dt+Ke*tt+gt*fe,me=pe[8+je],we=pe[9+je],Ke=pe[10+je],gt=pe[11+je],O[8+_e]=me*ze+we*Qe+Ke*Re+gt*xt,O[9+_e]=me*Xe+we*it+Ke*Ie+gt*pt,O[10+_e]=me*ct+we*ot+Ke*Ye+gt*ut,O[11+_e]=me*Ne+we*dt+Ke*tt+gt*fe,me=pe[12+je],we=pe[13+je],Ke=pe[14+je],gt=pe[15+je],O[12+_e]=me*ze+we*Qe+Ke*Re+gt*xt,O[13+_e]=me*Xe+we*it+Ke*Ie+gt*pt,O[14+_e]=me*ct+we*ot+Ke*Ye+gt*ut,O[15+_e]=me*Ne+we*dt+Ke*tt+gt*fe,O}e.mulOffset=M;function D(O,V,pe,_e){return A(O,A(O,V,pe),_e)}e.mul3=D;function k(O,V,pe){var _e=pe[0],Pe=pe[1],je=pe[2],ze,Xe,ct,Ne,Qe,it,ot,dt,Re,Ie,Ye,tt;return V===O?(O[12]=V[0]*_e+V[4]*Pe+V[8]*je+V[12],O[13]=V[1]*_e+V[5]*Pe+V[9]*je+V[13],O[14]=V[2]*_e+V[6]*Pe+V[10]*je+V[14],O[15]=V[3]*_e+V[7]*Pe+V[11]*je+V[15]):(ze=V[0],Xe=V[1],ct=V[2],Ne=V[3],Qe=V[4],it=V[5],ot=V[6],dt=V[7],Re=V[8],Ie=V[9],Ye=V[10],tt=V[11],O[0]=ze,O[1]=Xe,O[2]=ct,O[3]=Ne,O[4]=Qe,O[5]=it,O[6]=ot,O[7]=dt,O[8]=Re,O[9]=Ie,O[10]=Ye,O[11]=tt,O[12]=ze*_e+Qe*Pe+Re*je+V[12],O[13]=Xe*_e+it*Pe+Ie*je+V[13],O[14]=ct*_e+ot*Pe+Ye*je+V[14],O[15]=Ne*_e+dt*Pe+tt*je+V[15]),O}e.translate=k;function R(O,V){return O[0]=1,O[1]=0,O[2]=0,O[3]=0,O[4]=0,O[5]=1,O[6]=0,O[7]=0,O[8]=0,O[9]=0,O[10]=1,O[11]=0,O[12]=V[0],O[13]=V[1],O[14]=V[2],O[15]=1,O}e.fromTranslation=R;function L(O,V){return O[12]=V[0],O[13]=V[1],O[14]=V[2],O}e.setTranslation=L;function H(O,V,pe,_e){return O[0]=pe[0],O[4]=pe[1],O[8]=pe[2],O[1]=_e[0],O[5]=_e[1],O[9]=_e[2],O[2]=V[0],O[6]=V[1],O[10]=V[2],O}e.setAxes=H;function B(O,V,pe,_e){var Pe=_e[0],je=_e[1],ze=_e[2],Xe=Math.sqrt(Pe*Pe+je*je+ze*ze),ct,Ne,Qe,it,ot,dt,Re,Ie,Ye,tt,xt,pt,ut,fe,me,we,Ke,gt,Pt,$t,lr,Er,Yt,ei;return Math.abs(Xe)<vn?r():(Xe=1/Xe,Pe*=Xe,je*=Xe,ze*=Xe,ct=Math.sin(pe),Ne=Math.cos(pe),Qe=1-Ne,it=V[0],ot=V[1],dt=V[2],Re=V[3],Ie=V[4],Ye=V[5],tt=V[6],xt=V[7],pt=V[8],ut=V[9],fe=V[10],me=V[11],we=Pe*Pe*Qe+Ne,Ke=je*Pe*Qe+ze*ct,gt=ze*Pe*Qe-je*ct,Pt=Pe*je*Qe-ze*ct,$t=je*je*Qe+Ne,lr=ze*je*Qe+Pe*ct,Er=Pe*ze*Qe+je*ct,Yt=je*ze*Qe-Pe*ct,ei=ze*ze*Qe+Ne,O[0]=it*we+Ie*Ke+pt*gt,O[1]=ot*we+Ye*Ke+ut*gt,O[2]=dt*we+tt*Ke+fe*gt,O[3]=Re*we+xt*Ke+me*gt,O[4]=it*Pt+Ie*$t+pt*lr,O[5]=ot*Pt+Ye*$t+ut*lr,O[6]=dt*Pt+tt*$t+fe*lr,O[7]=Re*Pt+xt*$t+me*lr,O[8]=it*Er+Ie*Yt+pt*ei,O[9]=ot*Er+Ye*Yt+ut*ei,O[10]=dt*Er+tt*Yt+fe*ei,O[11]=Re*Er+xt*Yt+me*ei,V!==O&&(O[12]=V[12],O[13]=V[13],O[14]=V[14],O[15]=V[15]),O)}e.rotate=B;function j(O,V,pe){var _e=pe[0],Pe=pe[1],je=pe[2],ze=Math.sqrt(_e*_e+Pe*Pe+je*je),Xe,ct,Ne;return Math.abs(ze)<vn?n(O):(ze=1/ze,_e*=ze,Pe*=ze,je*=ze,Xe=Math.sin(V),ct=Math.cos(V),Ne=1-ct,O[0]=_e*_e*Ne+ct,O[1]=Pe*_e*Ne+je*Xe,O[2]=je*_e*Ne-Pe*Xe,O[3]=0,O[4]=_e*Pe*Ne-je*Xe,O[5]=Pe*Pe*Ne+ct,O[6]=je*Pe*Ne+_e*Xe,O[7]=0,O[8]=_e*je*Ne+Pe*Xe,O[9]=Pe*je*Ne-_e*Xe,O[10]=je*je*Ne+ct,O[11]=0,O[12]=0,O[13]=0,O[14]=0,O[15]=1,O)}e.fromRotation=j;function Q(O,V,pe){var _e=pe[0],Pe=pe[1],je=pe[2];return O[0]=V[0]*_e,O[1]=V[1]*_e,O[2]=V[2]*_e,O[3]=V[3]*_e,O[4]=V[4]*Pe,O[5]=V[5]*Pe,O[6]=V[6]*Pe,O[7]=V[7]*Pe,O[8]=V[8]*je,O[9]=V[9]*je,O[10]=V[10]*je,O[11]=V[11]*je,O[12]=V[12],O[13]=V[13],O[14]=V[14],O[15]=V[15],O}e.scale=Q;function G(O,V,pe){return O[0]=V[0]*pe,O[1]=V[1]*pe,O[2]=V[2]*pe,O[3]=V[3]*pe,O[4]=V[4]*pe,O[5]=V[5]*pe,O[6]=V[6]*pe,O[7]=V[7]*pe,O[8]=V[8]*pe,O[9]=V[9]*pe,O[10]=V[10]*pe,O[11]=V[11]*pe,O[12]=V[12],O[13]=V[13],O[14]=V[14],O[15]=V[15],O}e.scaleUniformly=G;function W(O,V){return O[0]=V[0],O[1]=0,O[2]=0,O[3]=0,O[4]=0,O[5]=V[1],O[6]=0,O[7]=0,O[8]=0,O[9]=0,O[10]=V[2],O[11]=0,O[12]=0,O[13]=0,O[14]=0,O[15]=1,O}e.fromScaling=W;function q(O,V){return O[0]=V,O[1]=0,O[2]=0,O[3]=0,O[4]=0,O[5]=V,O[6]=0,O[7]=0,O[8]=0,O[9]=0,O[10]=V,O[11]=0,O[12]=0,O[13]=0,O[14]=0,O[15]=1,O}e.fromUniformScaling=q;function ee(O,V){return O[0]=V[0],O[1]=V[1],O[2]=V[2],O[4]=V[3],O[5]=V[4],O[6]=V[5],O[8]=V[6],O[9]=V[7],O[10]=V[8],O}e.fromMat3=ee;function he(O){for(var V="",pe=0;pe<4;pe++){for(var _e=0;_e<4;_e++)V+=O[4*_e+pe].toString(),_e<3&&(V+=" ");pe<3&&(V+=`
`)}return V}e.makeTable=he;function $(O){var V=O[0],pe=O[1],_e=O[2],Pe=O[3],je=O[4],ze=O[5],Xe=O[6],ct=O[7],Ne=O[8],Qe=O[9],it=O[10],ot=O[11],dt=O[12],Re=O[13],Ie=O[14],Ye=O[15],tt=V*ze-pe*je,xt=V*Xe-_e*je,pt=V*ct-Pe*je,ut=pe*Xe-_e*ze,fe=pe*ct-Pe*ze,me=_e*ct-Pe*Xe,we=Ne*Re-Qe*dt,Ke=Ne*Ie-it*dt,gt=Ne*Ye-ot*dt,Pt=Qe*Ie-it*Re,$t=Qe*Ye-ot*Re,lr=it*Ye-ot*Ie;return tt*lr-xt*$t+pt*Pt+ut*gt-fe*Ke+me*we}e.determinant=$;function X(O,V){return U(O,typeof V<"u"?V:vn)}e.isRotationAndTranslation=X;function U(O,V){var pe=O[0],_e=O[1],Pe=O[2],je=O[3],ze=O[4],Xe=O[5],ct=O[6],Ne=O[7],Qe=O[8],it=O[9],ot=O[10],dt=O[11],Re=O[15];if(!hn(Re,1,V)||!hn(je,0,V)||!hn(Ne,0,V)||!hn(dt,0,V))return!1;var Ie=Math.abs(pe*(Xe*ot-ct*it)-_e*(ze*ot-ct*Qe)+Pe*(ze*it-Xe*Qe));return!!hn(Ie,1,V)}function z(O,V){return J(O,typeof V<"u"?V:vn)}e.isTranslationAndUniformScaling=z;function J(O,V){var pe=O[0];return hn(O[1],0,V)&&hn(O[2],0,V)&&hn(O[3],0,V)&&hn(O[4],0,V)&&hn(O[5],pe,V)&&hn(O[6],0,V)&&hn(O[7],0,V)&&hn(O[8],0,V)&&hn(O[9],0,V)&&hn(O[10],pe,V)&&hn(O[11],0,V)&&hn(O[15],1,V)}function Y(O,V){var pe=V[0],_e=V[1],Pe=V[2],je=V[3],ze=pe+pe,Xe=_e+_e,ct=Pe+Pe,Ne=pe*ze,Qe=_e*ze,it=_e*Xe,ot=Pe*ze,dt=Pe*Xe,Re=Pe*ct,Ie=je*ze,Ye=je*Xe,tt=je*ct;return O[0]=1-it-Re,O[1]=Qe+tt,O[2]=ot-Ye,O[3]=0,O[4]=Qe-tt,O[5]=1-Ne-Re,O[6]=dt+Ie,O[7]=0,O[8]=ot+Ye,O[9]=dt-Ie,O[10]=1-Ne-it,O[11]=0,O[12]=0,O[13]=0,O[14]=0,O[15]=1,O}e.fromQuat=Y;function Z(O,V,pe,_e,Pe,je,ze){var Xe=2*je/(pe-V),ct=2*je/(_e-Pe),Ne=(pe+V)/(pe-V),Qe=(_e+Pe)/(_e-Pe),it=-(ze+je)/(ze-je),ot=-2*ze*je/(ze-je);return O[0]=Xe,O[1]=0,O[2]=0,O[3]=0,O[4]=0,O[5]=ct,O[6]=0,O[7]=0,O[8]=Ne,O[9]=Qe,O[10]=it,O[11]=-1,O[12]=0,O[13]=0,O[14]=ot,O[15]=0,O}e.perspective=Z;function te(O,V,pe,_e,Pe,je,ze){var Xe=1/(pe-V),ct=1/(_e-Pe),Ne=1/(ze-je),Qe=(pe+V)*Xe,it=(_e+Pe)*ct,ot=(ze+je)*Ne;return O[0]=2*Xe,O[1]=0,O[2]=0,O[3]=0,O[4]=0,O[5]=2*ct,O[6]=0,O[7]=0,O[8]=0,O[9]=0,O[10]=-2*Ne,O[11]=0,O[12]=-Qe,O[13]=-it,O[14]=-ot,O[15]=1,O}e.ortho=te;function le(O,V,pe,_e){var Pe,je,ze,Xe,ct,Ne,Qe,it,ot,dt,Re=V[0],Ie=V[1],Ye=V[2],tt=_e[0],xt=_e[1],pt=_e[2],ut=pe[0],fe=pe[1],me=pe[2];return Math.abs(Re-ut)<vn&&Math.abs(Ie-fe)<vn&&Math.abs(Ye-me)<vn?n(O):(Qe=Re-ut,it=Ie-fe,ot=Ye-me,dt=1/Math.sqrt(Qe*Qe+it*it+ot*ot),Qe*=dt,it*=dt,ot*=dt,Pe=xt*ot-pt*it,je=pt*Qe-tt*ot,ze=tt*it-xt*Qe,dt=Math.sqrt(Pe*Pe+je*je+ze*ze),dt?(dt=1/dt,Pe*=dt,je*=dt,ze*=dt):(Pe=0,je=0,ze=0),Xe=it*ze-ot*je,ct=ot*Pe-Qe*ze,Ne=Qe*je-it*Pe,dt=Math.sqrt(Xe*Xe+ct*ct+Ne*Ne),dt?(dt=1/dt,Xe*=dt,ct*=dt,Ne*=dt):(Xe=0,ct=0,Ne=0),O[0]=Pe,O[1]=Xe,O[2]=Qe,O[3]=0,O[4]=je,O[5]=ct,O[6]=it,O[7]=0,O[8]=ze,O[9]=Ne,O[10]=ot,O[11]=0,O[12]=-(Pe*Re+je*Ie+ze*Ye),O[13]=-(Xe*Re+ct*Ie+Ne*Ye),O[14]=-(Qe*Re+it*Ie+ot*Ye),O[15]=1,O)}e.lookAt=le;function ye(O,V,pe,_e){var Pe=V[0],je=V[1],ze=V[2],Xe=_e[0],ct=_e[1],Ne=_e[2],Qe=Pe-pe[0],it=je-pe[1],ot=ze-pe[2],dt=Qe*Qe+it*it+ot*ot;dt>0&&(dt=1/Math.sqrt(dt),Qe*=dt,it*=dt,ot*=dt);var Re=ct*ot-Ne*it,Ie=Ne*Qe-Xe*ot,Ye=Xe*it-ct*Qe;return dt=Re*Re+Ie*Ie+Ye*Ye,dt>0&&(dt=1/Math.sqrt(dt),Re*=dt,Ie*=dt,Ye*=dt),O[0]=Re,O[1]=Ie,O[2]=Ye,O[3]=0,O[4]=it*Ye-ot*Ie,O[5]=ot*Re-Qe*Ye,O[6]=Qe*Ie-it*Re,O[7]=0,O[8]=Qe,O[9]=it,O[10]=ot,O[11]=0,O[12]=Pe,O[13]=je,O[14]=ze,O[15]=1,O}e.targetTo=ye;function be(O,V){i(O);for(var pe=0;pe<4;pe++){var _e=V[pe];c(O,pe,_e,1)}return O}e.fromPermutation=be;function Ee(O){var V=O[0]*O[0]+O[1]*O[1]+O[2]*O[2],pe=O[4]*O[4]+O[5]*O[5]+O[6]*O[6],_e=O[8]*O[8]+O[9]*O[9]+O[10]*O[10];return Math.sqrt(Math.max(V,pe,_e))}e.getMaxScaleOnAxis=Ee;var Se=[1,0,0],ie=[0,1,0],oe=[0,0,1];e.rotX90=j(t(),$r(90),Se),e.rotX180=j(t(),$r(180),Se),e.rotY90=j(t(),$r(90),ie),e.rotY180=j(t(),$r(180),ie),e.rotY270=j(t(),$r(270),ie),e.rotZ90=j(t(),$r(90),oe),e.rotZ180=j(t(),$r(180),oe),e.rotXY90=A(t(),e.rotX90,e.rotY90),e.rotZY90=A(t(),e.rotZ90,e.rotY90),e.rotZYZ90=A(t(),e.rotZY90,e.rotZ90),e.rotZ90X180=A(t(),e.rotZ90,e.rotX180),e.rotY90Z180=A(t(),e.rotY90,e.rotZ180),e.id=r()})(ue||(ue={}));function _(){return _.zero()}(function(e){function t(){var fe=[.1,0,0];return fe[0]=0,fe}e.zero=t;function r(fe){var me=t();return me[0]=fe[0],me[1]=fe[1],me[2]=fe[2],me}e.clone=r;function n(fe){return isNaN(fe[0])||isNaN(fe[1])||isNaN(fe[2])}e.hasNaN=n;function i(fe){return fe[0]=NaN,fe[1]=NaN,fe[2]=NaN,fe}e.setNaN=i;function a(fe){return l(fe.x,fe.y,fe.z)}e.fromObj=a;function o(fe){return{x:fe[0],y:fe[1],z:fe[2]}}e.toObj=o;function s(fe,me,we){return fe[0]=me[we+0],fe[1]=me[we+1],fe[2]=me[we+2],fe}e.fromArray=s;function u(fe,me,we){return me[we+0]=fe[0],me[we+1]=fe[1],me[we+2]=fe[2],me}e.toArray=u;function l(fe,me,we){var Ke=t();return Ke[0]=fe,Ke[1]=me,Ke[2]=we,Ke}e.create=l;function c(fe){var me=t();return me[0]=fe[0],me[1]=fe[1],me[2]=fe[2],me}e.ofArray=c;function d(fe,me,we,Ke){return fe[0]=me,fe[1]=we,fe[2]=Ke,fe}e.set=d;function f(fe,me){return fe[0]=me[0],fe[1]=me[1],fe[2]=me[2],fe}e.copy=f;function h(fe,me,we){return fe[0]=me[0]+we[0],fe[1]=me[1]+we[1],fe[2]=me[2]+we[2],fe}e.add=h;function v(fe,me,we){return fe[0]=me[0]-we[0],fe[1]=me[1]-we[1],fe[2]=me[2]-we[2],fe}e.sub=v;function p(fe,me,we){return fe[0]=me[0]*we[0],fe[1]=me[1]*we[1],fe[2]=me[2]*we[2],fe}e.mul=p;function m(fe,me,we){return fe[0]=me[0]/we[0],fe[1]=me[1]/we[1],fe[2]=me[2]/we[2],fe}e.div=m;function g(fe,me,we){return fe[0]=me[0]*we,fe[1]=me[1]*we,fe[2]=me[2]*we,fe}e.scale=g;function y(fe,me,we,Ke){return fe[0]=me[0]+we[0]*Ke,fe[1]=me[1]+we[1]*Ke,fe[2]=me[2]+we[2]*Ke,fe}e.scaleAndAdd=y;function b(fe,me,we,Ke){return fe[0]=me[0]-we[0]*Ke,fe[1]=me[1]-we[1]*Ke,fe[2]=me[2]-we[2]*Ke,fe}e.scaleAndSub=b;function S(fe,me,we){return fe[0]=me[0]+we,fe[1]=me[1]+we,fe[2]=me[2]+we,fe}e.addScalar=S;function x(fe,me,we){return fe[0]=me[0]-we,fe[1]=me[1]-we,fe[2]=me[2]-we,fe}e.subScalar=x;function C(fe,me){return fe[0]=Math.round(me[0]),fe[1]=Math.round(me[1]),fe[2]=Math.round(me[2]),fe}e.round=C;function w(fe,me){return fe[0]=Math.ceil(me[0]),fe[1]=Math.ceil(me[1]),fe[2]=Math.ceil(me[2]),fe}e.ceil=w;function A(fe,me){return fe[0]=Math.floor(me[0]),fe[1]=Math.floor(me[1]),fe[2]=Math.floor(me[2]),fe}e.floor=A;function M(fe,me){return fe[0]=Math.trunc(me[0]),fe[1]=Math.trunc(me[1]),fe[2]=Math.trunc(me[2]),fe}e.trunc=M;function D(fe,me){return fe[0]=Math.abs(me[0]),fe[1]=Math.abs(me[1]),fe[2]=Math.abs(me[2]),fe}e.abs=D;function k(fe,me,we){return fe[0]=Math.min(me[0],we[0]),fe[1]=Math.min(me[1],we[1]),fe[2]=Math.min(me[2],we[2]),fe}e.min=k;function R(fe,me,we){return fe[0]=Math.max(me[0],we[0]),fe[1]=Math.max(me[1],we[1]),fe[2]=Math.max(me[2],we[2]),fe}e.max=R;function L(fe,me){var we=me[0]-fe[0],Ke=me[1]-fe[1],gt=me[2]-fe[2];return Math.sqrt(we*we+Ke*Ke+gt*gt)}e.distance=L;function H(fe,me){var we=me[0]-fe[0],Ke=me[1]-fe[1],gt=me[2]-fe[2];return we*we+Ke*Ke+gt*gt}e.squaredDistance=H;function B(fe){var me=fe[0],we=fe[1],Ke=fe[2];return Math.sqrt(me*me+we*we+Ke*Ke)}e.magnitude=B;function j(fe){var me=fe[0],we=fe[1],Ke=fe[2];return me*me+we*we+Ke*Ke}e.squaredMagnitude=j;function Q(fe,me,we){return g(fe,q(fe,me),we)}e.setMagnitude=Q;function G(fe,me){return fe[0]=-me[0],fe[1]=-me[1],fe[2]=-me[2],fe}e.negate=G;function W(fe,me){return fe[0]=1/me[0],fe[1]=1/me[1],fe[2]=1/me[2],fe}e.inverse=W;function q(fe,me){var we=me[0],Ke=me[1],gt=me[2],Pt=we*we+Ke*Ke+gt*gt;return Pt>0&&(Pt=1/Math.sqrt(Pt),fe[0]=me[0]*Pt,fe[1]=me[1]*Pt,fe[2]=me[2]*Pt),fe}e.normalize=q;function ee(fe,me){return fe[0]*me[0]+fe[1]*me[1]+fe[2]*me[2]}e.dot=ee;function he(fe,me,we){var Ke=me[0],gt=me[1],Pt=me[2],$t=we[0],lr=we[1],Er=we[2];return fe[0]=gt*Er-Pt*lr,fe[1]=Pt*$t-Ke*Er,fe[2]=Ke*lr-gt*$t,fe}e.cross=he;function $(fe,me,we,Ke){var gt=me[0],Pt=me[1],$t=me[2];return fe[0]=gt+Ke*(we[0]-gt),fe[1]=Pt+Ke*(we[1]-Pt),fe[2]=$t+Ke*(we[2]-$t),fe}e.lerp=$;var X=t();function U(fe,me,we,Ke){var gt=Ia(ee(me,we),-1,1),Pt=Math.acos(gt)*Ke;return y(X,we,me,-gt),q(X,X),h(fe,g(fe,me,Math.cos(Pt)),g(X,X,Math.sin(Pt)))}e.slerp=U;function z(fe,me,we,Ke,gt,Pt){var $t=Pt*Pt,lr=$t*(2*Pt-3)+1,Er=$t*(Pt-2)+Pt,Yt=$t*(Pt-1),ei=$t*(3-2*Pt);return fe[0]=me[0]*lr+we[0]*Er+Ke[0]*Yt+gt[0]*ei,fe[1]=me[1]*lr+we[1]*Er+Ke[1]*Yt+gt[1]*ei,fe[2]=me[2]*lr+we[2]*Er+Ke[2]*Yt+gt[2]*ei,fe}e.hermite=z;function J(fe,me,we,Ke,gt,Pt){var $t=1-Pt,lr=$t*$t,Er=Pt*Pt,Yt=lr*$t,ei=3*Pt*lr,$i=3*Er*$t,Xi=Er*Pt;return fe[0]=me[0]*Yt+we[0]*ei+Ke[0]*$i+gt[0]*Xi,fe[1]=me[1]*Yt+we[1]*ei+Ke[1]*$i+gt[1]*Xi,fe[2]=me[2]*Yt+we[2]*ei+Ke[2]*$i+gt[2]*Xi,fe}e.bezier=J;function Y(fe,me,we,Ke,gt){return fe[0]=iP(me[0],we[0],Ke[0],gt),fe[1]=iP(me[1],we[1],Ke[1],gt),fe[2]=iP(me[2],we[2],Ke[2],gt),fe}e.quadraticBezier=Y;function Z(fe,me,we,Ke,gt,Pt,$t){return fe[0]=uS(me[0],we[0],Ke[0],gt[0],Pt,$t),fe[1]=uS(me[1],we[1],Ke[1],gt[1],Pt,$t),fe[2]=uS(me[2],we[2],Ke[2],gt[2],Pt,$t),fe}e.spline=Z;function te(fe,me){var we=Math.random()*2*Math.PI,Ke=Math.random()*2-1,gt=Math.sqrt(1-Ke*Ke)*me;return fe[0]=Math.cos(we)*gt,fe[1]=Math.sin(we)*gt,fe[2]=Ke*me,fe}e.random=te;function le(fe,me,we){var Ke=me[0],gt=me[1],Pt=me[2],$t=1/(we[3]*Ke+we[7]*gt+we[11]*Pt+we[15]||1);return fe[0]=(we[0]*Ke+we[4]*gt+we[8]*Pt+we[12])*$t,fe[1]=(we[1]*Ke+we[5]*gt+we[9]*Pt+we[13])*$t,fe[2]=(we[2]*Ke+we[6]*gt+we[10]*Pt+we[14])*$t,fe}e.transformMat4=le;function ye(fe,me,we,Ke,gt,Pt){var $t=me[0+gt],lr=me[1+gt],Er=me[2+gt],Yt=1/(we[3+Pt]*$t+we[7+Pt]*lr+we[11+Pt]*Er+we[15+Pt]||1);return fe[0+Ke]=(we[0+Pt]*$t+we[4+Pt]*lr+we[8+Pt]*Er+we[12+Pt])*Yt,fe[1+Ke]=(we[1+Pt]*$t+we[5+Pt]*lr+we[9+Pt]*Er+we[13+Pt])*Yt,fe[2+Ke]=(we[2+Pt]*$t+we[6+Pt]*lr+we[10+Pt]*Er+we[14+Pt])*Yt,fe}e.transformMat4Offset=ye;function be(fe,me,we){var Ke=me[0],gt=me[1],Pt=me[2];return fe[0]=Ke*we[0]+gt*we[3]+Pt*we[6],fe[1]=Ke*we[1]+gt*we[4]+Pt*we[7],fe[2]=Ke*we[2]+gt*we[5]+Pt*we[8],fe}e.transformMat3=be;function Ee(fe,me,we){var Ke=me[0],gt=me[1],Pt=me[2],$t=we[0],lr=we[1],Er=we[2],Yt=we[3],ei=Yt*Ke+lr*Pt-Er*gt,$i=Yt*gt+Er*Ke-$t*Pt,Xi=Yt*Pt+$t*gt-lr*Ke,wo=-$t*Ke-lr*gt-Er*Pt;return fe[0]=ei*Yt+wo*-$t+$i*-Er-Xi*-lr,fe[1]=$i*Yt+wo*-lr+Xi*-$t-ei*-Er,fe[2]=Xi*Yt+wo*-Er+ei*-lr-$i*-$t,fe}e.transformQuat=Ee;function Se(fe,me){var we=Math.sqrt(j(fe)*j(me));if(we===0)return Math.PI/2;var Ke=ee(fe,me)/we;return Math.acos(Ia(Ke,-1,1))}e.angle=Se;var ie=t(),oe=t(),O=t(),V=t(),pe=t(),_e=t(),Pe=t();function je(fe,me,we,Ke){v(ie,fe,me),v(oe,we,me),v(O,me,we),v(V,Ke,we),he(pe,ie,oe),he(_e,O,V);var gt=Se(pe,_e);return he(Pe,pe,_e),ee(oe,Pe)>0?gt:-gt}e.dihedralAngle=je;function ze(fe,me){return fe[0]===me[0]&&fe[1]===me[1]&&fe[2]===me[2]}e.exactEquals=ze;function Xe(fe,me){var we=fe[0],Ke=fe[1],gt=fe[2],Pt=me[0],$t=me[1],lr=me[2];return Math.abs(we-Pt)<=vn*Math.max(1,Math.abs(we),Math.abs(Pt))&&Math.abs(Ke-$t)<=vn*Math.max(1,Math.abs(Ke),Math.abs($t))&&Math.abs(gt-lr)<=vn*Math.max(1,Math.abs(gt),Math.abs(lr))}e.equals=Xe;var ct=t();function Ne(fe,me,we){var Ke=Se(me,we);if(Math.abs(Ke)<1e-4)return ue.setIdentity(fe);if(Math.abs(Ke-Math.PI)<vn)return ue.fromScaling(fe,e.negUnit);var gt=he(ct,me,we);return ue.fromRotation(fe,Ke,gt)}e.makeRotation=Ne;function Qe(fe){return fe[0]===0&&fe[1]===0&&fe[2]===0}e.isZero=Qe;function it(fe,me,we,Ke){v(fe,f(fe,me),Ke);var gt=ee(we,fe)/j(we);return h(fe,g(fe,f(fe,we),gt),Ke)}e.projectPointOnVector=it;function ot(fe,me,we){var Ke=ee(we,me)/j(we);return g(fe,we,Ke)}e.projectOnVector=ot;var dt=t();function Re(fe,me,we){return ot(dt,me,we),v(fe,me,dt)}e.projectOnPlane=Re;function Ie(fe,me,we){return q(fe,he(fe,he(fe,me,we),me))}e.orthogonalize=Ie;function Ye(fe,me,we){return ee(me,we)>0?f(fe,me):G(fe,f(fe,me)),fe}e.matchDirection=Ye;var tt=t(),xt=t();function pt(fe,me,we,Ke){return v(tt,we,me),v(xt,Ke,me),q(fe,he(fe,tt,xt))}e.triangleNormal=pt;function ut(fe,me){return"["+fe[0].toPrecision(me)+" "+fe[1].toPrecision(me)+" "+fe[2].toPrecision(me)+"]"}e.toString=ut,e.origin=l(0,0,0),e.unit=l(1,1,1),e.negUnit=l(-1,-1,-1),e.unitX=l(1,0,0),e.unitY=l(0,1,0),e.unitZ=l(0,0,1),e.negUnitX=l(-1,0,0),e.negUnitY=l(0,-1,0),e.negUnitZ=l(0,0,-1)})(_||(_={}));function zn(){return zn.zero()}(function(e){function t(){var $=[.1,0,0,0,0,0,0,0,0];return $[0]=0,$}e.zero=t;function r(){var $=t();return $[0]=1,$[1]=0,$[2]=0,$[3]=0,$[4]=1,$[5]=0,$[6]=0,$[7]=0,$[8]=1,$}e.identity=r;function n($){return $[0]=1,$[1]=0,$[2]=0,$[3]=0,$[4]=1,$[5]=0,$[6]=0,$[7]=0,$[8]=1,$}e.setIdentity=n;function i($,X,U){return X[U+0]=$[0],X[U+1]=$[1],X[U+2]=$[2],X[U+3]=$[3],X[U+4]=$[4],X[U+5]=$[5],X[U+6]=$[6],X[U+7]=$[7],X[U+8]=$[8],X}e.toArray=i;function a($,X,U){return $[0]=X[U+0],$[1]=X[U+1],$[2]=X[U+2],$[3]=X[U+3],$[4]=X[U+4],$[5]=X[U+5],$[6]=X[U+6],$[7]=X[U+7],$[8]=X[U+8],$}e.fromArray=a;function o($,X){return $[0]=X[0],$[1]=X[1],$[2]=X[2],$[3]=X[4],$[4]=X[5],$[5]=X[6],$[6]=X[8],$[7]=X[9],$[8]=X[10],$}e.fromMat4=o;function s($,X,U,z,J,Y,Z,te,le){var ye=t();return ye[0]=$,ye[1]=X,ye[2]=U,ye[3]=z,ye[4]=J,ye[5]=Y,ye[6]=Z,ye[7]=te,ye[8]=le,ye}e.create=s;var u=r();function l($,X){return f($,u,typeof X>"u"?vn:X)}e.isIdentity=l;function c($){for(var X=0;X<9;X++)if(isNaN($[X]))return!0;return!1}e.hasNaN=c;function d($){return p(t(),$)}e.clone=d;function f($,X,U){for(var z=0;z<9;z++)if(Math.abs($[z]-X[z])>U)return!1;return!0}e.areEqual=f;function h($,X,U,z){$[3*U+X]=z}e.setValue=h;function v($,X,U){return $[3*U+X]}e.getValue=v;function p($,X){return $[0]=X[0],$[1]=X[1],$[2]=X[2],$[3]=X[3],$[4]=X[4],$[5]=X[5],$[6]=X[6],$[7]=X[7],$[8]=X[8],$}e.copy=p;function m($,X){if($===X){var U=X[1],z=X[2],J=X[5];$[1]=X[3],$[2]=X[6],$[3]=U,$[5]=X[7],$[6]=z,$[7]=J}else $[0]=X[0],$[1]=X[3],$[2]=X[6],$[3]=X[1],$[4]=X[4],$[5]=X[7],$[6]=X[2],$[7]=X[5],$[8]=X[8];return $}e.transpose=m;function g($,X){var U=X[0],z=X[1],J=X[2],Y=X[3],Z=X[4],te=X[5],le=X[6],ye=X[7],be=X[8],Ee=be*Z-te*ye,Se=-be*Y+te*le,ie=ye*Y-Z*le,oe=U*Ee+z*Se+J*ie;return oe?(oe=1/oe,$[0]=Ee*oe,$[1]=(-be*z+J*ye)*oe,$[2]=(te*z-J*Z)*oe,$[3]=Se*oe,$[4]=(be*U-J*le)*oe,$[5]=(-te*U+J*Y)*oe,$[6]=ie*oe,$[7]=(-ye*U+z*le)*oe,$[8]=(Z*U-z*Y)*oe,$):(console.warn("non-invertible matrix.",X),$)}e.invert=g;function y($,X){return $===X?($[3]=X[1],$[6]=X[2],$[7]=X[5]):($[0]=X[0],$[1]=X[1],$[2]=X[2],$[3]=X[1],$[4]=X[4],$[5]=X[5],$[6]=X[2],$[7]=X[5],$[8]=X[8]),$}e.symmtricFromUpper=y;function b($,X){return $===X?($[1]=X[3],$[2]=X[6],$[5]=X[7]):($[0]=X[0],$[1]=X[3],$[2]=X[6],$[3]=X[3],$[4]=X[4],$[5]=X[7],$[6]=X[6],$[7]=X[7],$[8]=X[8]),$}e.symmtricFromLower=b;function S($){var X=$[0],U=$[1],z=$[2],J=$[3],Y=$[4],Z=$[5],te=$[6],le=$[7],ye=$[8],be=ye*Y-Z*le,Ee=-ye*J+Z*te,Se=le*J-Y*te;return X*be+U*Ee+z*Se}e.determinant=S;function x($){return $[0]+$[4]+$[8]}e.trace=x;function C($,X,U){return $[0]=X[0]-U[0],$[1]=X[1]-U[1],$[2]=X[2]-U[2],$[3]=X[3]-U[3],$[4]=X[4]-U[4],$[5]=X[5]-U[5],$[6]=X[6]-U[6],$[7]=X[7]-U[7],$[8]=X[8]-U[8],$}e.sub=C;function w($,X,U){return $[0]=X[0]+U[0],$[1]=X[1]+U[1],$[2]=X[2]+U[2],$[3]=X[3]+U[3],$[4]=X[4]+U[4],$[5]=X[5]+U[5],$[6]=X[6]+U[6],$[7]=X[7]+U[7],$[8]=X[8]+U[8],$}e.add=w;function A($,X,U){var z=X[0],J=X[1],Y=X[2],Z=X[3],te=X[4],le=X[5],ye=X[6],be=X[7],Ee=X[8],Se=U[0],ie=U[1],oe=U[2],O=U[3],V=U[4],pe=U[5],_e=U[6],Pe=U[7],je=U[8];return $[0]=Se*z+ie*Z+oe*ye,$[1]=Se*J+ie*te+oe*be,$[2]=Se*Y+ie*le+oe*Ee,$[3]=O*z+V*Z+pe*ye,$[4]=O*J+V*te+pe*be,$[5]=O*Y+V*le+pe*Ee,$[6]=_e*z+Pe*Z+je*ye,$[7]=_e*J+Pe*te+je*be,$[8]=_e*Y+Pe*le+je*Ee,$}e.mul=A;function M($,X,U){return $[0]=X[0]-U,$[1]=X[1]-U,$[2]=X[2]-U,$[3]=X[3]-U,$[4]=X[4]-U,$[5]=X[5]-U,$[6]=X[6]-U,$[7]=X[7]-U,$[8]=X[8]-U,$}e.subScalar=M;function D($,X,U){return $[0]=X[0]+U,$[1]=X[1]+U,$[2]=X[2]+U,$[3]=X[3]+U,$[4]=X[4]+U,$[5]=X[5]+U,$[6]=X[6]+U,$[7]=X[7]+U,$[8]=X[8]+U,$}e.addScalar=D;function k($,X,U){return $[0]=X[0]*U,$[1]=X[1]*U,$[2]=X[2]*U,$[3]=X[3]*U,$[4]=X[4]*U,$[5]=X[5]*U,$[6]=X[6]*U,$[7]=X[7]*U,$[8]=X[8]*U,$}e.mulScalar=k;var R=Math.PI/3,L=t();function H($,X){var U=X[1]*X[1]+X[2]*X[2]+X[5]*X[5];if(U===0)$[0]=X[0],$[1]=X[4],$[2]=X[8];else{var z=x(X)/3,J=X[0]-z,Y=X[4]-z,Z=X[8]-z,te=J*J+Y*Y+Z*Z+2*U,le=Math.sqrt(te/6);k(L,e.Identity,z),C(L,X,L),k(L,L,1/le);var ye=S(L)/2,be=ye<=-1?R:ye>=1?0:Math.acos(ye)/3;$[0]=z+2*le*Math.cos(be),$[2]=z+2*le*Math.cos(be+2*R),$[1]=3*z-$[0]-$[2]}return $}e.symmetricEigenvalues=H;var B=[.1,0,0],j=[.1,0,0],Q=[.1,0,0],G=[.1,0,0],W=[.1,0,0],q=[.1,0,0];function ee($,X,U){_.set(B,X[0]-U,X[1],X[2]),_.set(j,X[1],X[4]-U,X[5]),_.set(Q,X[2],X[5],X[8]-U),_.cross(G,B,j),_.cross(W,B,Q),_.cross(q,j,Q);var z=_.dot(G,G),J=_.dot(W,W),Y=_.dot(q,q),Z=z,te=0;return J>Z&&(Z=J,te=1),Y>Z&&(te=2),te===0?_.scale($,G,1/Math.sqrt(z)):te===1?_.scale($,W,1/Math.sqrt(J)):_.scale($,q,1/Math.sqrt(Y)),$}e.eigenvector=ee;function he($,X){return o($,X),g($,$),m($,$),$}e.directionTransform=he,e.Identity=r()})(zn||(zn={}));function He(){return He.zero()}(function(e){function t(){var A=[.1,0];return A[0]=0,A}e.zero=t;function r(A){var M=t();return M[0]=A[0],M[1]=A[1],M}e.clone=r;function n(A,M){var D=t();return D[0]=A,D[1]=M,D}e.create=n;function i(A){return isNaN(A[0])||isNaN(A[1])}e.hasNaN=i;function a(A,M,D){return M[D+0]=A[0],M[D+1]=A[1],M}e.toArray=a;function o(A,M,D){return A[0]=M[D+0],A[1]=M[D+1],A}e.fromArray=o;function s(A,M){return A[0]=M[0],A[1]=M[1],A}e.copy=s;function u(A,M,D){return A[0]=M,A[1]=D,A}e.set=u;function l(A,M,D){return A[0]=M[0]+D[0],A[1]=M[1]+D[1],A}e.add=l;function c(A,M,D){return A[0]=M[0]-D[0],A[1]=M[1]-D[1],A}e.sub=c;function d(A,M,D){return A[0]=M[0]*D[0],A[1]=M[1]*D[1],A}e.mul=d;function f(A,M,D){return A[0]=M[0]/D[0],A[1]=M[1]/D[1],A}e.div=f;function h(A,M,D){return A[0]=M[0]*D,A[1]=M[1]*D,A}e.scale=h;function v(A,M){return A[0]=Math.round(M[0]),A[1]=Math.round(M[1]),A}e.round=v;function p(A,M){return A[0]=Math.ceil(M[0]),A[1]=Math.ceil(M[1]),A}e.ceil=p;function m(A,M){return A[0]=Math.floor(M[0]),A[1]=Math.floor(M[1]),A}e.floor=m;function g(A,M){var D=M[0]-A[0],k=M[1]-A[1];return Math.sqrt(D*D+k*k)}e.distance=g;function y(A,M){var D=M[0]-A[0],k=M[1]-A[1];return D*D+k*k}e.squaredDistance=y;function b(A){var M=A[0],D=A[1];return Math.sqrt(M*M+D*D)}e.magnitude=b;function S(A){var M=A[0],D=A[1];return M*M+D*D}e.squaredMagnitude=S;function x(A,M){return A[0]=1/M[0],A[1]=1/M[1],A}e.inverse=x;function C(A,M){return A[0]===M[0]&&A[1]===M[1]}e.areEqual=C;function w(A,M){return"["+A[0].toPrecision(M)+" "+A[1].toPrecision(M)+"}]"}e.toString=w})(He||(He={}));function _r(){return _r.zero()}(function(e){function t(){var R=[.1,0,0,0];return R[0]=0,R}e.zero=t;function r(R){var L=t();return L[0]=R[0],L[1]=R[1],L[2]=R[2],L[3]=R[3],L}e.clone=r;function n(R,L,H,B){var j=t();return j[0]=R,j[1]=L,j[2]=H,j[3]=B,j}e.create=n;function i(R,L){return R[0]=L.center[0],R[1]=L.center[1],R[2]=L.center[2],R[3]=L.radius,R}e.fromSphere=i;function a(R){return i(t(),R)}e.ofSphere=a;function o(R){return isNaN(R[0])||isNaN(R[1])||isNaN(R[2])||isNaN(R[3])}e.hasNaN=o;function s(R,L,H){return L[H+0]=R[0],L[H+1]=R[1],L[H+2]=R[2],L[H+3]=R[3],L}e.toArray=s;function u(R,L,H){return R[0]=L[H+0],R[1]=L[H+1],R[2]=L[H+2],R[3]=L[H+3],R}e.fromArray=u;function l(R,L,H){L[H+0]=R[0],L[H+1]=R[1],L[H+2]=R[2]}e.toVec3Array=l;function c(R,L,H){return R[0]=L[H+0],R[1]=L[H+1],R[2]=L[H+2],R[3]=0,R}e.fromVec3Array=c;function d(R,L){return R[0]=L[0],R[1]=L[1],R[2]=L[2],R[3]=L[3],R}e.copy=d;function f(R,L,H,B,j){return R[0]=L,R[1]=H,R[2]=B,R[3]=j,R}e.set=f;function h(R,L,H){return R[0]=L[0]+H[0],R[1]=L[1]+H[1],R[2]=L[2]+H[2],R[3]=L[3]+H[3],R}e.add=h;function v(R,L){var H=L[0]-R[0],B=L[1]-R[1],j=L[2]-R[2],Q=L[3]-R[3];return Math.sqrt(H*H+B*B+j*j+Q*Q)}e.distance=v;function p(R,L,H){return R[0]=L[0]*H,R[1]=L[1]*H,R[2]=L[2]*H,R[4]=L[4]*H,R}e.scale=p;function m(R,L){return R[0]=Math.round(L[0]),R[1]=Math.round(L[1]),R[2]=Math.round(L[2]),R[3]=Math.round(L[3]),R}e.round=m;function g(R,L){return R[0]=Math.ceil(L[0]),R[1]=Math.ceil(L[1]),R[2]=Math.ceil(L[2]),R[3]=Math.ceil(L[3]),R}e.ceil=g;function y(R,L){return R[0]=Math.floor(L[0]),R[1]=Math.floor(L[1]),R[2]=Math.floor(L[2]),R[3]=Math.floor(L[3]),R}e.floor=y;function b(R,L){var H=L[0]-R[0],B=L[1]-R[1],j=L[2]-R[2],Q=L[3]-R[3];return H*H+B*B+j*j+Q*Q}e.squaredDistance=b;function S(R){var L=R[0],H=R[1],B=R[2],j=R[3];return Math.sqrt(L*L+H*H+B*B+j*j)}e.norm=S;function x(R){var L=R[0],H=R[1],B=R[2],j=R[3];return L*L+H*H+B*B+j*j}e.squaredNorm=x;function C(R,L,H){var B=L[0],j=L[1],Q=L[2],G=L[3];return R[0]=H[0]*B+H[4]*j+H[8]*Q+H[12]*G,R[1]=H[1]*B+H[5]*j+H[9]*Q+H[13]*G,R[2]=H[2]*B+H[6]*j+H[10]*Q+H[14]*G,R[3]=H[3]*B+H[7]*j+H[11]*Q+H[15]*G,R}e.transformMat4=C;function w(R,L){return R[0]*L[0]+R[1]*L[1]+R[2]*L[2]+R[3]*L[3]}e.dot=w;function A(R,L){return R[0]=1/L[0],R[1]=1/L[1],R[2]=1/L[2],R[3]=1/L[3],R}e.inverse=A;function M(R,L){return R[0]===L[0]&&R[1]===L[1]&&R[2]===L[2]&&R[3]===L[3]}e.exactEquals=M;function D(R,L){var H=R[0],B=R[1],j=R[2],Q=R[3],G=L[0],W=L[1],q=L[2],ee=L[3];return Math.abs(H-G)<=vn*Math.max(1,Math.abs(H),Math.abs(G))&&Math.abs(B-W)<=vn*Math.max(1,Math.abs(B),Math.abs(W))&&Math.abs(j-q)<=vn*Math.max(1,Math.abs(j),Math.abs(q))&&Math.abs(Q-ee)<=vn*Math.max(1,Math.abs(Q),Math.abs(ee))}e.equals=D;function k(R,L){return"["+R[0].toPrecision(L)+" "+R[1].toPrecision(L)+" "+R[2].toPrecision(L)+"  "+R[3].toPrecision(L)+"]"}e.toString=k})(_r||(_r={}));function jn(){return jn.zero()}(function(e){function t(){var q=[.1,0,0,0];return q[0]=0,q}e.zero=t;function r(){var q=t();return q[3]=1,q}e.identity=r;function n(q){q[0]=0,q[1]=0,q[2]=0,q[3]=1}e.setIdentity=n;function i(q){return isNaN(q[0])||isNaN(q[1])||isNaN(q[2])||isNaN(q[3])}e.hasNaN=i;function a(q,ee,he,$){var X=r();return X[0]=q,X[1]=ee,X[2]=he,X[3]=$,X}e.create=a;function o(q,ee,he){he=he*.5;var $=Math.sin(he);return q[0]=$*ee[0],q[1]=$*ee[1],q[2]=$*ee[2],q[3]=Math.cos(he),q}e.setAxisAngle=o;function s(q,ee){var he=Math.acos(ee[3])*2,$=Math.sin(he/2);return $!==0?(q[0]=ee[0]/$,q[1]=ee[1]/$,q[2]=ee[2]/$):(q[0]=1,q[1]=0,q[2]=0),he}e.getAxisAngle=s;function u(q,ee,he){var $=ee[0],X=ee[1],U=ee[2],z=ee[3],J=he[0],Y=he[1],Z=he[2],te=he[3];return q[0]=$*te+z*J+X*Z-U*Y,q[1]=X*te+z*Y+U*J-$*Z,q[2]=U*te+z*Z+$*Y-X*J,q[3]=z*te-$*J-X*Y-U*Z,q}e.multiply=u;function l(q,ee,he){he*=.5;var $=ee[0],X=ee[1],U=ee[2],z=ee[3],J=Math.sin(he),Y=Math.cos(he);return q[0]=$*Y+z*J,q[1]=X*Y+U*J,q[2]=U*Y-X*J,q[3]=z*Y-$*J,q}e.rotateX=l;function c(q,ee,he){he*=.5;var $=ee[0],X=ee[1],U=ee[2],z=ee[3],J=Math.sin(he),Y=Math.cos(he);return q[0]=$*Y-U*J,q[1]=X*Y+z*J,q[2]=U*Y+$*J,q[3]=z*Y-X*J,q}e.rotateY=c;function d(q,ee,he){he*=.5;var $=ee[0],X=ee[1],U=ee[2],z=ee[3],J=Math.sin(he),Y=Math.cos(he);return q[0]=$*Y+X*J,q[1]=X*Y-$*J,q[2]=U*Y+z*J,q[3]=z*Y-U*J,q}e.rotateZ=d;function f(q,ee){var he=ee[0],$=ee[1],X=ee[2];return q[0]=he,q[1]=$,q[2]=X,q[3]=Math.sqrt(Math.abs(1-he*he-$*$-X*X)),q}e.calculateW=f;function h(q,ee,he,$){var X=ee[0],U=ee[1],z=ee[2],J=ee[3],Y=he[0],Z=he[1],te=he[2],le=he[3],ye,be,Ee,Se,ie;return be=X*Y+U*Z+z*te+J*le,be<0&&(be=-be,Y=-Y,Z=-Z,te=-te,le=-le),1-be>1e-6?(ye=Math.acos(be),Ee=Math.sin(ye),Se=Math.sin((1-$)*ye)/Ee,ie=Math.sin($*ye)/Ee):(Se=1-$,ie=$),q[0]=Se*X+ie*Y,q[1]=Se*U+ie*Z,q[2]=Se*z+ie*te,q[3]=Se*J+ie*le,q}e.slerp=h;function v(q,ee){var he=ee[0],$=ee[1],X=ee[2],U=ee[3],z=he*he+$*$+X*X+U*U,J=z?1/z:0;return q[0]=-he*J,q[1]=-$*J,q[2]=-X*J,q[3]=U*J,q}e.invert=v;function p(q,ee){return q[0]=-ee[0],q[1]=-ee[1],q[2]=-ee[2],q[3]=ee[3],q}e.conjugate=p;function m(q,ee){var he=ee[0]+ee[4]+ee[8],$;if(he>0)$=Math.sqrt(he+1),q[3]=.5*$,$=.5/$,q[0]=(ee[5]-ee[7])*$,q[1]=(ee[6]-ee[2])*$,q[2]=(ee[1]-ee[3])*$;else{var X=0;ee[4]>ee[0]&&(X=1),ee[8]>ee[X*3+X]&&(X=2);var U=(X+1)%3,z=(X+2)%3;$=Math.sqrt(ee[X*3+X]-ee[U*3+U]-ee[z*3+z]+1),q[X]=.5*$,$=.5/$,q[3]=(ee[U*3+z]-ee[z*3+U])*$,q[U]=(ee[U*3+X]+ee[X*3+U])*$,q[z]=(ee[z*3+X]+ee[X*3+z])*$}return q}e.fromMat3=m;var g=[0,0,0];function y(q,ee,he){var $=_.dot(ee,he)+1;return $<vn?($=0,Math.abs(ee[0])>Math.abs(ee[2])?_.set(g,-ee[1],ee[0],0):_.set(g,0,-ee[2],ee[1])):_.cross(g,ee,he),q[0]=g[0],q[1]=g[1],q[2]=g[2],q[3]=$,M(q,q),q}e.fromUnitVec3=y;function b(q){var ee=t();return ee[0]=q[0],ee[1]=q[1],ee[2]=q[2],ee[3]=q[3],ee}e.clone=b;function S(q,ee,he){return ee[he+0]=q[0],ee[he+1]=q[1],ee[he+2]=q[2],ee[he+3]=q[3],ee}e.toArray=S;function x(q,ee,he){return q[0]=ee[he+0],q[1]=ee[he+1],q[2]=ee[he+2],q[3]=ee[he+3],q}e.fromArray=x;function C(q,ee){return q[0]=ee[0],q[1]=ee[1],q[2]=ee[2],q[3]=ee[3],q}e.copy=C;function w(q,ee,he,$,X){return q[0]=ee,q[1]=he,q[2]=$,q[3]=X,q}e.set=w;function A(q,ee,he){return q[0]=ee[0]+he[0],q[1]=ee[1]+he[1],q[2]=ee[2]+he[2],q[3]=ee[3]+he[3],q}e.add=A;function M(q,ee){var he=ee[0],$=ee[1],X=ee[2],U=ee[3],z=he*he+$*$+X*X+U*U;return z>0&&(z=1/Math.sqrt(z),q[0]=he*z,q[1]=$*z,q[2]=X*z,q[3]=U*z),q}e.normalize=M;var D=[0,0,0],k=[1,0,0],R=[0,1,0];function L(q,ee,he){var $=_.dot(ee,he);return $<-.999999?(_.cross(D,k,ee),_.magnitude(D)<1e-6&&_.cross(D,R,ee),_.normalize(D,D),o(q,D,Math.PI),q):$>.999999?(q[0]=0,q[1]=0,q[2]=0,q[3]=1,q):(_.cross(D,ee,he),q[0]=D[0],q[1]=D[1],q[2]=D[2],q[3]=1+$,M(q,q))}e.rotationTo=L;var H=t(),B=t();function j(q,ee,he,$,X,U){return h(H,ee,X,U),h(B,he,$,U),h(q,H,B,2*U*(1-U)),q}e.sqlerp=j;var Q=[0,0,0,0,0,0,0,0,0];function G(q,ee,he,$){return Q[0]=he[0],Q[3]=he[1],Q[6]=he[2],Q[1]=$[0],Q[4]=$[1],Q[7]=$[2],Q[2]=-ee[0],Q[5]=-ee[1],Q[8]=-ee[2],M(q,m(q,Q))}e.setAxes=G;function W(q,ee){return"["+q[0].toPrecision(ee)+" "+q[1].toPrecision(ee)+" "+q[2].toPrecision(ee)+"  "+q[3].toPrecision(ee)+"]"}e.toString=W,e.Identity=r()})(jn||(jn={}));var Pr;(function(e){function t(x,C,w){for(var A=[],M=0;M<C.length;M++)A[M]=C[C.length-M-1];for(var D=[1],M=1;M<x.length;M++)D[M]=x[A[M-1]];return{dimensions:x,axisOrderFastToSlow:A,axisOrderSlowToFast:C,accessDimensions:D,defaultCtor:w||Float64Array}}function r(x,C){return{space:x,data:C}}e.create=r;function n(x,C,w){var A=t(x,C,w),M=h(A),D=M.get,k=M.set,R=M.add,L=M.dataOffset,H=M.getCoords;return{rank:x.length,dimensions:x,axisOrderSlowToFast:C,create:v(A),get:D,set:k,add:R,dataOffset:L,getCoords:H}}e.Space=n;function i(x){return x}e.Data1=i;function a(x,C){return n([x],[0],C)}e.Vector=a;function o(x,C,w){return n([x,C],[1,0],w)}e.ColumnMajorMatrix=o;function s(x,C,w){return n([x,C],[0,1],w)}e.RowMajorMatrix=s;function u(x,C,w){if(C.rank!==2)throw new Error("Invalid tensor rank");for(var A=Math.min(4,C.dimensions[0]),M=Math.min(4,C.dimensions[1]),D=0;D<A;D++)for(var k=0;k<M;k++)ue.setValue(x,D,k,C.get(w,D,k));return x}e.toMat4=u;function l(x,C,w){if(C.rank!==2)throw new Error("Invalid tensor rank");for(var A=Math.min(3,C.dimensions[0]),M=Math.min(3,C.dimensions[1]),D=0;D<A;D++)for(var k=0;k<M;k++)zn.setValue(x,D,k,C.get(w,D,k));return x}e.toMat3=l;function c(x,C,w){if(C.rank!==1)throw new Error("Invalid tensor rank");for(var A=Math.min(3,C.dimensions[0]),M=0;M<A;M++)x[M]=w[M];return x}e.toVec3=c;function d(x,C,w){if(C.rank!==1)throw new Error("Invalid tensor rank");for(var A=Math.min(4,C.dimensions[0]),M=0;M<A;M++)x[M]=w[M];return x}e.toVec4=d;function f(x,C){var w=x.length;if(w!==C.length)return!1;for(var A=0;A<w;A++)if(x[A]!==C[A])return!1;return!0}e.areEqualExact=f;function h(x){var C=x.dimensions,w=x.axisOrderFastToSlow;switch(C.length){case 1:return{get:function(Y,Z){return Y[Z]},set:function(Y,Z,te){return Y[Z]=te},add:function(Y,Z,te){return Y[Z]+=te},dataOffset:function(Y){return Y},getCoords:function(Y,Z){return Z[0]=Y,Z}};case 2:{if(w[0]===0&&w[1]===1){var A=C[0];return{get:function(Y,Z,te){return Y[te*A+Z]},set:function(Y,Z,te,le){return Y[te*A+Z]=le},add:function(Y,Z,te,le){return Y[te*A+Z]+=le},dataOffset:function(Y,Z){return Z*A+Y},getCoords:function(Y,Z){return Z[0]=Y%A,Z[1]=Math.floor(Y/A),Z}}}if(w[0]===1&&w[1]===0){var M=C[1];return{get:function(Y,Z,te){return Y[Z*M+te]},set:function(Y,Z,te,le){return Y[Z*M+te]=le},add:function(Y,Z,te,le){return Y[Z*M+te]+=le},dataOffset:function(Y,Z){return Y*M+Z},getCoords:function(Y,Z){return Z[0]=Math.floor(Y/M),Z[1]=Y%M,Z}}}throw new Error("bad axis order")}case 3:{if(w[0]===0&&w[1]===1&&w[2]===2){var D=C[0],k=C[1],R=D*k;return{get:function(Y,Z,te,le){return Y[Z+te*D+le*R]},set:function(Y,Z,te,le,ye){return Y[Z+te*D+le*R]=ye},add:function(Y,Z,te,le,ye){return Y[Z+te*D+le*R]+=ye},dataOffset:function(Y,Z,te){return Y+Z*D+te*R},getCoords:function(Y,Z){var te=Math.floor(Y/D);return Z[0]=Y%D,Z[1]=te%k,Z[2]=Math.floor(te/k),Z}}}if(w[0]===0&&w[1]===2&&w[2]===1){var L=C[0],H=C[2],B=L*H;return{get:function(Y,Z,te,le){return Y[Z+le*L+te*B]},set:function(Y,Z,te,le,ye){return Y[Z+le*L+te*B]=ye},add:function(Y,Z,te,le,ye){return Y[Z+le*L+te*B]+=ye},dataOffset:function(Y,Z,te){return Y+te*L+Z*B},getCoords:function(Y,Z){var te=Math.floor(Y/L);return Z[0]=Y%L,Z[1]=Math.floor(te/H),Z[2]=te%H,Z}}}if(w[0]===1&&w[1]===0&&w[2]===2){var j=C[1],Q=C[0],G=j*Q;return{get:function(Y,Z,te,le){return Y[te+Z*j+le*G]},set:function(Y,Z,te,le,ye){return Y[te+Z*j+le*G]=ye},add:function(Y,Z,te,le,ye){return Y[te+Z*j+le*G]+=ye},dataOffset:function(Y,Z,te){return Z+Y*j+te*G},getCoords:function(Y,Z){var te=Math.floor(Y/j);return Z[0]=te%Q,Z[1]=Y%j,Z[2]=Math.floor(te/Q),Z}}}if(w[0]===1&&w[1]===2&&w[2]===0){var W=C[1],q=C[2],ee=W*q;return{get:function(Y,Z,te,le){return Y[te+le*W+Z*ee]},set:function(Y,Z,te,le,ye){return Y[te+le*W+Z*ee]=ye},add:function(Y,Z,te,le,ye){return Y[te+le*W+Z*ee]+=ye},dataOffset:function(Y,Z,te){return Z+te*W+Y*ee},getCoords:function(Y,Z){var te=Math.floor(Y/W);return Z[0]=Math.floor(te/q),Z[1]=Y%W,Z[2]=te%q,Z}}}if(w[0]===2&&w[1]===0&&w[2]===1){var he=C[2],$=C[0],X=he*$;return{get:function(Y,Z,te,le){return Y[le+Z*he+te*X]},set:function(Y,Z,te,le,ye){return Y[le+Z*he+te*X]=ye},add:function(Y,Z,te,le,ye){return Y[le+Z*he+te*X]+=ye},dataOffset:function(Y,Z,te){return te+Y*he+Z*X},getCoords:function(Y,Z){var te=Math.floor(Y/he);return Z[0]=te%$,Z[1]=Math.floor(te/$),Z[2]=Y%he,Z}}}if(w[0]===2&&w[1]===1&&w[2]===0){var U=C[2],z=C[1],J=U*z;return{get:function(Y,Z,te,le){return Y[le+te*U+Z*J]},set:function(Y,Z,te,le,ye){return Y[le+te*U+Z*J]=ye},add:function(Y,Z,te,le,ye){return Y[le+te*U+Z*J]+=ye},dataOffset:function(Y,Z,te){return te+Z*U+Y*J},getCoords:function(Y,Z){var te=Math.floor(Y/U);return Z[0]=Math.floor(te/z),Z[1]=te%z,Z[2]=Y%U,Z}}}throw new Error("bad axis order")}default:return{get:function(Y){for(var Z=[],te=1;te<arguments.length;te++)Z[te-1]=arguments[te];return Y[p(x,Z)]},set:function(Y){for(var Z=[],te=1;te<arguments.length;te++)Z[te-1]=arguments[te];return Y[p(x,Z)]=Z[Z.length-1]},add:function(Y){for(var Z=[],te=1;te<arguments.length;te++)Z[te-1]=arguments[te];return Y[p(x,Z)]+=Z[Z.length-1]},dataOffset:function(){for(var Y=[],Z=0;Z<arguments.length;Z++)Y[Z]=arguments[Z];return p(x,Y)},getCoords:function(Y,Z){return m(x,Y,Z)}}}}function v(x){for(var C=x.dimensions,w=1,A=0,M=C.length;A<M;A++)w*=C[A];return function(D){return new(D||x.defaultCtor)(w)}}function p(x,C){for(var w=x.accessDimensions,A=x.axisOrderFastToSlow,M=w.length-1,D=w[M]*C[A[M]],k=M-1;k>=0;k--)D=(D+C[A[k]])*w[k];return D}function m(x,C,w){for(var A=x.dimensions,M=x.axisOrderFastToSlow,D=A.length,k=C,R=0;R<D;R++){var L=A[M[R]];w[M[R]]=k%L,k=Math.floor(k/L)}return w[M[D+1]]=k,w}function g(x){for(var C=[],w=0;w<x.length;w++)C[w]=x[x.length-w-1];return C}e.invertAxisOrder=g;function y(x,C){for(var w=[],A=0;A<x.length;A++)w[A]=x[C[A]];return w}function b(x){for(var C=new Int32Array(x.length),w=0;w<x.length;w++)C[x[w]]=w;return function(A){return y(A,C)}}e.convertToCanonicalAxisIndicesFastToSlow=b;function S(x){for(var C=new Int32Array(x.length),w=0;w<x.length;w++)C[x[x.length-w-1]]=w;return function(A){return y(A,C)}}e.convertToCanonicalAxisIndicesSlowToFast=S})(Pr||(Pr={}));function qh(e,t,r){for(;t<r&&e.charCodeAt(t)===32;)t++;return kf(e,t,r)}function kf(e,t,r){var n=t,i=0,a=1;for(e.charCodeAt(n)===45?(a=-1,++n):e.charCodeAt(n)===43&&++n;n<r;n++){var o=e.charCodeAt(n)-48;if(o>9||o<0)return a*i|0;i=10*i+o|0}return a*i}function U8(e,t,r,n){return t.charCodeAt(r)===43&&r++,e*Math.pow(10,kf(t,r,n))}function z_e(e,t,r){for(;t<r&&e.charCodeAt(t)===32;)t++;return gc(e,t,r)}function gc(e,t,r){var n=t,i=1,a=0,o=0,s=1;for(e.charCodeAt(n)===45?(i=-1,++n):e.charCodeAt(n)===43&&++n;n<r;){var u=e.charCodeAt(n)-48;if(u>=0&&u<10)a=a*10+u,++n;else if(u===-2){for(++n;n<r;)if(u=e.charCodeAt(n)-48,u>=0&&u<10)o=10*o+u,s=10*s,++n;else return u===53||u===21?U8(i*(a+o/s),e,n+1,r):i*(a+o/s);return i*(a+o/s)}else{if(u===53||u===21)return U8(i*a,e,n+1,r);break}}return i*a}var ve;(function(e){var t;(function(D){D.str={"@type":"str",T:"",valueType:"str"},D.int={"@type":"int",T:0,valueType:"int"},D.coord={"@type":"coord",T:0,valueType:"float"},D.float={"@type":"float",T:0,valueType:"float"};function k(W){return W===void 0&&(W=""),{"@type":"str",T:W,valueType:"str"}}D.Str=k;function R(W){return W===void 0&&(W=0),{"@type":"int",T:W,valueType:"int"}}D.Int=R;function L(W){return W===void 0&&(W=0),{"@type":"float",T:W,valueType:"float"}}D.Float=L;function H(W,q){return q===void 0&&(q=D.float),{"@type":"tensor",T:W.create(),space:W,valueType:"tensor",baseType:q}}D.Tensor=H;function B(W,q){return q===void 0&&(q=D.float),H(Pr.Vector(W,q["@type"]==="int"?Int32Array:Float64Array),q)}D.Vector=B;function j(W,q,ee){return ee===void 0&&(ee=D.float),H(Pr.ColumnMajorMatrix(W,q,ee["@type"]==="int"?Int32Array:Float64Array),ee)}D.Matrix=j;function Q(W,q){return typeof q<"u"?E(E({},W),{T:q}):W}D.Aliased=Q;function G(W,q,ee){return ee===void 0&&(ee=[]),{"@type":"list",T:ee,separator:W,itemParse:q,valueType:"list"}}D.List=G})(t=e.Schema||(e.Schema={}));function r(D){return!!D&&!!D.schema&&!!D.value}e.is=r;function n(D,k){return j8(k.T,D,k,1)}e.Undefined=n;function i(D,k,R){return j8(D,k,R,0)}e.ofConst=i;function a(D){return N2(D)}e.ofLambda=a;function o(D,k){return a({value:function(R){return R+D},rowCount:Math.max(k-D+1,0),schema:t.int})}e.range=o;function s(D){return Ql(D)}e.ofArray=s;function u(D){return Ql({array:D,schema:t.int})}e.ofIntArray=u;function l(D){return Ql({array:D,schema:t.float})}e.ofFloatArray=l;function c(D){return Ql({array:D,schema:t.str})}e.ofStringArray=c;function d(D){return Ql({array:D,schema:t.Aliased(t.str)})}e.ofStringAliasArray=d;function f(D,k){return k===void 0&&(k=","),Ql({array:D,schema:t.List(k,function(R){return R})})}e.ofStringListArray=f;function h(D){var k=D.count,R=D.data,L=D.indices;return N2({value:function(H){return kf(R,L[2*H],L[2*H+1])||0},rowCount:k,schema:t.int})}e.ofIntTokens=h;function v(D){var k=D.count,R=D.data,L=D.indices;return N2({value:function(H){return gc(R,L[2*H],L[2*H+1])||0},rowCount:k,schema:t.float})}e.ofFloatTokens=v;function p(D){var k=D.count,R=D.data,L=D.indices;return N2({value:function(H){var B=R.substring(L[2*H],L[2*H+1]);return B==="."||B==="?"?"":B},rowCount:k,schema:t.str})}e.ofStringTokens=p;function m(D,k,R){return G_e(D,k,R)}e.window=m;function g(D,k,R){return R===void 0&&(R=!0),X_e(D,k,R)}e.view=g;function y(D){return V_e(D)}e.createFirstIndexMap=y;function b(D){return H_e(D)}e.createIndexer=b;function S(D,k,R){return Q_e(D,k,R||Array)}e.mapToArray=S;function x(D,k){return Z_e(D,k)}e.areEqual=x;function C(D,k){return twe(D,k)}e.indicesOf=C;function w(D,k){return D.__array?D:D.isDefined?Ql({array:D.toArray({array:k}),schema:D.schema,valueKind:D.valueKind}):n(D.rowCount,D.schema)}e.asArrayColumn=w;function A(D,k,R){if(R===void 0&&(R=0),!!D.isDefined){var L=D.__array;if(L)for(var H=0,B=L.length;H<B;H++)k[R+H]=L[H];else for(var H=0,B=D.rowCount;H<B;H++)k[R+H]=D.value(H)}}e.copyToArray=A;function M(D){for(var k=0,R=D.rowCount;k<R;k++)if(k!==D.value(k))return!1;return!0}e.isIdentity=M})(ve||(ve={}));function V_e(e){for(var t=new Map,r=0,n=e.rowCount;r<n;r++){var i=e.value(r);t.has(i)||t.set(e.value(r),r)}return t}function H_e(e){for(var t=new Map,r=0,n=e.rowCount;r<n;r++){var i=e.value(r);t.has(i)||t.set(e.value(r),r)}return function(a){return t.has(a)?t.get(a):-1}}function j8(e,t,r,n){var i=function(a){return e};return{schema:r,__array:void 0,isDefined:n===0,rowCount:t,value:i,valueKind:function(a){return n},toArray:function(a){for(var o=Eb(t,a).array,s=0,u=o.length;s<u;s++)o[s]=e;return o},areValuesEqual:function(a,o){return!0}}}function N2(e){var t=e.value,r=e.valueKind,n=e.areValuesEqual,i=e.rowCount,a=e.schema;return{schema:a,__array:void 0,isDefined:!0,rowCount:i,value:t,valueKind:r||function(o){return 0},toArray:function(o){for(var s=Eb(i,o),u=s.array,l=s.start,c=0,d=u.length;c<d;c++)u[c]=t(c+l);return u},areValuesEqual:n||function(o,s){return t(o)===t(s)}}}function Ql(e){var t=e.array,r=e.schema,n=e.valueKind,i=t.length,a=r.valueType==="str"?function(s){var u=t[s];return typeof u=="string"?u:""+u}:function(s){return t[s]},o=Ok(t);return{schema:r,__array:t,isDefined:!0,rowCount:i,value:a,valueKind:n||function(s){return 0},toArray:r.valueType==="str"?function(s){for(var u=LC(i,s),l=u.start,c=u.end,d=new(s&&typeof s.array<"u"?s.array:t.constructor)(c-l),f=0,h=c-l;f<h;f++){var v=t[l+f];d[f]=typeof v=="string"?v:""+v}return d}:o?function(s){return NC(t,s)}:function(s){var u=LC(i,s),l=u.start,c=u.end;if(l===0&&c===t.length)return t;for(var d=new(s&&typeof s.array<"u"?s.array:t.constructor)(c-l),f=0,h=c-l;f<h;f++)d[f]=t[l+f];return d},areValuesEqual:function(s,u){return t[s]===t[u]}}}function G_e(e,t,r){return e.isDefined?t===0&&r===e.rowCount?e:e.__array&&Ok(e.__array)?q_e(e,t,r):W_e(e,t,r):ve.Undefined(r-t,e.schema)}function q_e(e,t,r){var n=NC(e.__array,{start:t,end:r}),i=e.valueKind;return Ql({array:n,schema:e.schema,valueKind:function(a){return i(t+a)}})}function W_e(e,t,r){var n=e.value,i=e.valueKind,a=e.areValuesEqual,o=t===0?n:function(u){return n(u+t)},s=r-t;return{schema:e.schema,__array:void 0,isDefined:e.isDefined,rowCount:s,value:o,valueKind:t===0?i:function(u){return i(u+t)},toArray:function(u){for(var l=Eb(s,u).array,c=0,d=l.length;c<d;c++)l[c]=n(c+t);return l},areValuesEqual:t===0?a:function(u,l){return a(u+t,l+t)}}}function $_e(e,t){if(e.length!==t)return!1;for(var r=0,n=e.length;r<n;r++)if(e[r]!==r)return!1;return!0}function X_e(e,t,r){return e.rowCount===0||r&&$_e(t,e.rowCount)?e:e.__array&&typeof e.value(0)==typeof e.__array[0]?Y_e(e,t):K_e(e,t)}function Y_e(e,t){for(var r=e.__array,n=new r.constructor(t.length),i=0,a=t.length;i<a;i++)n[i]=r[t[i]];var o=e.valueKind;return Ql({array:n,schema:e.schema,valueKind:function(s){return o(t[s])}})}function K_e(e,t){var r=e.value,n=e.valueKind,i=e.areValuesEqual,a=function(s){return r(t[s])},o=t.length;return{schema:e.schema,__array:void 0,isDefined:e.isDefined,rowCount:o,value:a,valueKind:function(s){return n(t[s])},toArray:function(s){for(var u=Eb(o,s).array,l=0,c=u.length;l<c;l++)u[l]=r(t[l]);return u},areValuesEqual:function(s,u){return i(t[s],t[u])}}}function Q_e(e,t,r){for(var n=new r(e.rowCount),i=0,a=e.rowCount;i<a;i++)n[i]=t(e.value(i));return n}function Z_e(e,t){return e===t?!0:e.rowCount!==t.rowCount||e.isDefined!==t.isDefined||e.schema.valueType!==t.schema.valueType?!1:e.__array&&t.__array?J_e(e,t):ewe(e,t)}function J_e(e,t){for(var r=e.__array,n=t.__array,i=0,a=e.rowCount;i<a;i++)if(r[i]!==n[i])return!1;return!0}function ewe(e,t){for(var r=e.value,n=t.value,i=0,a=e.rowCount;i<a;i++)if(r(i)!==n(i))return!1;return!0}function twe(e,t){for(var r=[],n=e.value,i=0,a=e.rowCount;i<a;i++)t(n(i))&&(r[r.length]=i);return r}var Xr;(function(e){function t(S){return S&&typeof S._rowCount=="number"&&!!S._columns&&!!S._schema}e.is=t;function r(S,x,C){C===void 0&&(C={});var w=Object.create(null),A=Object.keys(S);w._rowCount=x._rowCount,w._columns=A,w._schema=S;for(var M=0,D=A;M<D.length;M++){var k=D[M];if(x[k])w[k]=x[k];else if(C[k])w[k]=C[k];else throw Error("Cannot find column '"+k+"'.")}return w}e.pickColumns=r;function n(S,x){var C=Object.keys(x),w=x[C[0]].rowCount;return E({_rowCount:w,_columns:C,_schema:S},x)}e.ofColumns=n;function i(S,x,C){var w=Object.create(null),A=Object.keys(S);w._rowCount=C,w._columns=A,w._schema=S;for(var M=0,D=A;M<D.length;M++){var k=D[M];k in x?w[k]=x[k]:w[k]=ve.Undefined(C,S[k])}return w}e.ofPartialColumns=i;function a(S,x){var C=Object.create(null),w=Object.keys(S);C._rowCount=x,C._columns=w,C._schema=S;for(var A=0,M=w;A<M.length;A++){var D=M[A];C[D]=ve.Undefined(x,S[D])}return C}e.ofUndefinedColumns=a;function o(S,x){var C=Object.create(null),w=x.length,A=Object.keys(S);C._rowCount=w,C._columns=A,C._schema=S;for(var M=function(L){C[L]=ve.ofLambda({rowCount:w,schema:S[L],value:function(H){return x[H][L]},valueKind:function(H){return typeof x[H][L]>"u"?1:0}})},D=0,k=A;D<k.length;D++){var R=k[D];M(R)}return C}e.ofRows=o;function s(S,x){var C,w=Object.create(null),A=Object.keys(S);w._rowCount=0,w._columns=A,w._schema=S;for(var M=0,D=A;M<D.length;M++){var k=D[M];typeof x[k]<"u"?(w[k]=ve.ofArray({array:x[k],schema:S[k]}),w._rowCount=(C=x[k])===null||C===void 0?void 0:C.length):w[k]=ve.Undefined(w._rowCount,S[k])}return w}e.ofArrays=s;function u(S,x,C){var w=Object.create(null),A=Object.keys(x);w._rowCount=C.length,w._columns=A,w._schema=x;for(var M=0,D=A;M<D.length;M++){var k=D[M];w[k]=ve.view(S[k],C)}return w}e.view=u;function l(S,x,C){for(var w=[],A=0,M=S._rowCount;A<M;++A)C(A)&&w.push(A);return u(S,x,w)}e.pick=l;function c(S,x,C,w){if(C===0&&w===S._rowCount)return S;var A=Object.create(null),M=Object.keys(x);A._rowCount=w-C,A._columns=M,A._schema=x;for(var D=0,k=M;D<k.length;D++){var R=k[D];A[R]=ve.window(S[R],C,w)}return A}e.window=c;function d(S,x){var C=Object.create(null),w=Object.keys(x);C._rowCount=0;for(var A=0,M=S;A<M.length;A++){var D=M[A];C._rowCount+=D._rowCount}for(var k={},R=0,L=w;R<L.length;R++){var H=L[R];k[H]=new Array(C._rowCount)}C._columns=w,C._schema=x;for(var B=0,j=0,Q=S;j<Q.length;j++){for(var D=Q[j],G=0,W=w;G<W.length;G++){var q=W[G];ve.copyToArray(D[q],k[q],B)}B+=D._rowCount}for(var ee=0,he=w;ee<he.length;ee++){var q=he[ee];C[q]=ve.ofArray({array:k[q],schema:x[q]})}return C}e.concat=d;function f(S,x,C){S[x]=ve.asArrayColumn(S[x],C)}e.columnToArray=f;function h(S,x){for(var C=new Int32Array(S._rowCount),w=0,A=C.length;w<A;w++)C[w]=w;gu(C,function(H,B,j){return x(B,j)});for(var M=!0,w=0,A=C.length;w<A;w++)if(C[w]!==w){M=!1;break}if(M)return S;var D=Object.create(null);D._rowCount=S._rowCount,D._columns=S._columns,D._schema=S._schema;for(var k=0,R=S._columns;k<R.length;k++){var L=R[k];D[L]=ve.view(S[L],C,!1)}return D}e.sort=h;function v(S,x){if(S._rowCount!==x._rowCount||S._columns.length!==x._columns.length)return!1;for(var C=0,w=S._columns;C<w.length;C++){var A=w[C];if(!x[A])return!1}for(var M=0,D=S._columns;M<D.length;M++){var A=D[M];if(!ve.areEqual(S[A],x[A]))return!1}return!0}e.areEqual=v;function p(S,x){for(var C=Object.create(null),w=S._columns,A=0;A<w.length;A++){var M=w[A];C[M]=S[M].value(x)}return C}e.getRow=p;function m(S,x){for(var C=0,w=S._rowCount;C<w;++C)if(x(C))return p(S,C)}e.pickRow=m;function g(S){for(var x=[],C=S._rowCount,w=0;w<C;w++)x[w]=p(S,w);return x}e.getRows=g;function y(S){for(var x={},C=S._columns,w=0;w<C.length;w++){var A=C[w];x[A]=S[A].toArray()}return x}e.toArrays=y;function b(S){var x=Rr.create(),C=S._columns,w=S._rowCount,A=1;Rr.write(x,"|");for(var M=0;M<C.length;M++)Rr.write(x,C[M]),Rr.write(x,"|"),A+=C[M].length+1;Rr.newline(x),Rr.write(x,new Array(A+1).join("-")),Rr.newline(x);for(var D=0;D<w;D++){Rr.write(x,"|");for(var M=0;M<C.length;M++){var k=S[C[M]];k.valueKind(D)===0?(Rr.write(x,k.value(D)),Rr.write(x,"|")):Rr.write(x,".|")}Rr.newline(x)}return Rr.getString(x)}e.formatToString=b})(Xr||(Xr={}));var fM;(function(e){function t(n,i,a){var o=Object.keys(a),s=Object.create(null),u=[];s._name=n,s._tableNames=u,s._schema=i;for(var l=0,c=o;l<c.length;l++){var d=c[l];Xr.is(a[d])&&(s[d]=a[d],u[u.length]=d)}return s}e.ofTables=t;function r(n){for(var i={},a=0,o=n._tableNames;a<o.length;a++){var s=o[a];i[s]=Xr.getRows(n[s])}return i}e.getTablesAsRows=r})(fM||(fM={}));function Lk(e,t){for(var r=0,n=e.length;r<n;r++)if(t(e[r]))return e[r]}function Nk(e){if(Array.from)return Array.from(e);for(var t=[];;){var r=e.next(),n=r.done,i=r.value;if(n)break;t[t.length]=i}return t}function hM(e,t,r){for(var n=t-e+1,i=r?new r(n):new Int32Array(n),a=0;a<n;a++)i[a]=a+e;return i}function rwe(e,t){for(var r=new(nwe(e))(t.length),n=0,i=t.length;n<i;n++)r[n]=e[t[n]];return r}function nwe(e){var t=e.constructor;if(!t)throw new Error("data does not define a constructor and it should");return t}var vi;(function(e){e.Zero=0;var t=function(){var p=new ArrayBuffer(8),m=new ArrayBuffer(8);return{_int32:new Int32Array(p),_float64:new Float64Array(p),_int32_1:new Int32Array(m),_float64_1:new Float64Array(m)}}(),r=t._int32,n=t._float64,i=t._int32_1,a=t._float64_1;function o(p){return typeof p=="number"}e.is=o;function s(p,m){return r[0]=p,r[1]=m,n[0]}e.create=s;function u(p){return n[0]=p,r[0]}e.fst=u;function l(p){return n[0]=p,r[1]}e.snd=l;function c(p,m){return n[0]=p,a[0]=m,r[0]===i[0]&&r[1]===i[1]}e.areEqual=c;function d(p,m){n[0]=p,a[0]=m;var g=r[0]-i[0];return g!==0?g:r[1]-i[1]}e.compare=d;function f(p,m,g){n[0]=p[m],a[0]=p[g];var y=r[0]-i[0];return y!==0?y:r[1]-i[1]}e.compareInArray=f;function h(p){return n[0]=p,cv(r[0],r[1])}e.hashCode=h;function v(p){return n[0]=p,"("+r[0]+", "+r[1]+")"}e.toString=v})(vi||(vi={}));var dY=vi.Zero;function z8(e,t){return t<e?vi.create(e,e):vi.create(e,t+1)}function Fk(e,t){return t<=e?vi.create(e,e):vi.create(e,t)}function iwe(e){return e<0?vi.create(0,0):vi.create(0,e)}var awe=vi.is,Dc=vi.fst,Gf=vi.snd,FC=vi.fst;function BC(e){return vi.snd(e)-1}function mp(e){return vi.snd(e)-vi.fst(e)}var owe=vi.hashCode,swe=vi.toString;function uwe(e,t){return vi.fst(e)<=t&&t<vi.snd(e)}function lwe(e,t){var r=Dc(e);return t>=r&&t<Gf(e)?t-r:-1}function cwe(e,t){return vi.fst(e)+t}var dwe=vi.areEqual;function fY(e,t){var r=mp(e),n=mp(t);return r===0&&n===0?!0:r>0&&n>0&&BC(e)>=FC(t)&&FC(e)<=BC(t)}function fwe(e,t){return mp(e)?mp(t)?Dc(e)<=Dc(t)&&Gf(e)>=Gf(t):!0:mp(t)===0}function pM(e,t){var r=Dc(e);if(t<=r)return 0;var n=Gf(e);return t>=n?n-r:t-r}function hwe(e,t,r){var n=Dc(r),i=Dc(e);if(t<=n+i)return n;var a=Gf(r);return t>=a+i?a:t-i}function hY(e,t,r){return Fk(pM(e,t),pM(e,r+1))}function pwe(e,t){return fY(e,t)?Fk(Math.max(Dc(e),Dc(t)),Math.min(Gf(e),Gf(t))):dY}function vwe(e,t){return mp(hY(e,FC(t),BC(t)))}var Te;(function(e){e.Empty=dY,e.ofSingleton=function(t){return z8(t,t)},e.ofRange=z8,e.ofBounds=Fk,e.ofLength=iwe,e.is=awe,e.has=uwe,e.indexOf=lwe,e.getAt=cwe,e.start=Dc,e.end=Gf,e.min=FC,e.max=BC,e.size=mp,e.hashCode=owe,e.toString=swe,e.areEqual=dwe,e.areIntersecting=fY,e.isSubInterval=fwe,e.findPredecessorIndex=pM,e.findPredecessorIndexInInterval=hwe,e.findRange=hY,e.intersectionSize=vwe,e.intersect=pwe})(Te||(Te={}));var B1=[];function mwe(e){return[e]}function gwe(e){return e}function ywe(e){return gu(e),e}function V8(e,t){if(t<e)return[];for(var r=new Int32Array(t-e+1),n=e;n<=t;n++)r[n-e]=n;return r}function bwe(e){return e&&(Array.isArray(e)||!!e.buffer)}function vM(e){return e[0]}function mM(e){return e[e.length-1]+1}function xwe(e){return e[0]}function Swe(e){return e[e.length-1]}function pY(e){return e.length}function Cwe(e){var t=e.length;return t?t>2?U_e(t,e[0],e[t-1],e[t>>1]):B_e(t,e[0],e[t-1]):0}function _we(e){var t=e.length;return t>5?"["+e[0]+", "+e[1]+", ..., "+e[t-1]+"], length "+t:"["+e.join(", ")+"]"}function vY(e,t){var r=e.length;return r===0?-1:e[0]<=t&&t<=e[r-1]?gY(e,t,0,r):-1}function wwe(e,t,r){return mY(e,t,Te.start(r),Te.end(r))}function mY(e,t,r,n){var i=e.length;return i===0||n<=r?-1:e[r]<=t&&t<=e[n-1]?gY(e,t,r,n):-1}function Ewe(e,t){return vY(e,t)>=0}function Awe(e,t){if(e===t)return!0;var r=e.length;if(r!==t.length||e[0]!==t[0]||e[r-1]!==t[r-1])return!1;for(var n=0;n<r;n++)if(e[n]!==t[n])return!1;return!0}function ip(e,t){var r=e.length;return t<=e[0]?0:t>e[r-1]?r:yY(e,t,0,r)}function Pwe(e,t,r){var n=Te.start(r),i=Te.end(r),a=e[n];return t<=a?n:i>n&&t>e[i-1]?i:t-a<=11?Iwe(e,t,n+1,i):yY(e,t,n,i)}function Twe(e,t,r){return Te.ofBounds(ip(e,t),ip(e,r+1))}function gY(e,t,r,n){for(var i=r,a=n-1;i<=a;){if(i+11>a){for(var o=i;o<=a;o++)if(t===e[o])return o;return-1}var s=i+a>>1,u=e[s];if(t<u)a=s-1;else if(t>u)i=s+1;else return s}return-1}function yY(e,t,r,n){for(var i=r,a=n-1;i<a;){if(i+11>a){for(var o=i;o<=a;o++)if(t<=e[o])return o;return a+1}var s=i+a>>1,u=e[s];if(t<u)a=s-1;else if(t>u)i=s+1;else return s}return i>a?a+1:e[i]>=t?i:i+1}function Iwe(e,t,r,n){for(var i=r;i<n;i++)if(t<=e[i])return i;return n}function Mwe(e,t){if(e===t)return!0;for(var r=dv(e,t),n=r.startI,i=r.startJ,a=r.endI,o=r.endJ;n<a&&i<o;){var s=e[n],u=t[i];if(s<u)n++;else if(s>u)i++;else return!0}return!1}function Dwe(e,t){if(e===t)return!0;var r=t.length,n=dv(e,t),i=n.startI,a=n.startJ,o=n.endI,s=n.endJ;if(s-a<r||o-i<r)return!1;for(var u=0;i<o&&a<s;){var l=e[i],c=t[a];l<c?i++:l>c?a++:(i++,a++,u++)}return u===r}function bY(e,t){if(e===t)return e;var r=e.length,n=t.length;if(r===0)return t;if(n===0)return e;if(e[0]>t[0])return bY(t,e);var i=dv(e,t),a=i.startI,o=i.startJ,s=i.endI,u=i.endJ,l=Bk(e,t,a,o,s,u);if(l===r&&l===n||l===n)return e;if(l===r)return t;var c=new Int32Array(r+n-l),d=0,f=0,h=0;for(d=0;d<a;d++)c[h++]=e[d];for(;f<u&&e[a]>t[f];)c[h++]=t[f++];for(;d<s&&f<u;){var v=e[d],p=t[f];v<p?(c[h++]=v,d++):v>p?(c[h++]=p,f++):(c[h++]=v,d++,f++)}for(;d<s;d++)c[h++]=e[d];for(;f<u;f++)c[h++]=t[f];for(;d<r;d++)c[h++]=e[d];for(;f<n;f++)c[h++]=t[f];return c}function Rwe(e,t){if(e===t)return pY(e);var r=dv(e,t),n=r.startI,i=r.startJ,a=r.endI,o=r.endJ;return Bk(e,t,n,i,a,o)}function Bk(e,t,r,n,i,a){for(var o=r,s=n,u=0;o<i&&s<a;){var l=e[o],c=t[s];l<c?o++:l>c?s++:(o++,s++,u++)}return u}function kwe(e,t){if(e===t)return e;var r=dv(e,t),n=r.startI,i=r.startJ,a=r.endI,o=r.endJ,s=Bk(e,t,n,i,a,o),u=e.length,l=t.length;if(!s)return B1;if(s===u&&s===l||s===l)return t;if(s===u)return e;for(var c=new Int32Array(s),d=0,f=n,h=i;f<a&&h<o;){var v=e[f],p=t[h];v<p?f++:(v>p||(c[d++]=v,f++),h++)}return c}function Owe(e,t){if(e===t)return B1;for(var r=e.length,n=dv(e,t),i=n.startI,a=n.startJ,o=n.endI,s=n.endJ,u=i,l=a,c=0;u<o&&l<s;){var d=e[u],f=t[l];d<f?u++:d>f?l++:(u++,l++,c++)}if(!c)return e;if(c>=r)return B1;for(var h=new Int32Array(r-c),v=0,p=0;p<i;p++)h[v++]=e[p];for(u=i,l=a;u<o&&l<s;){var d=e[u],f=t[l];d<f?(h[v++]=d,u++):(d>f||u++,l++)}for(;u<r;u++)h[v++]=e[u];return h}function Lwe(e){if(e.length<2)return e;for(var t=1,r=0,n=e.length-1;r<n;r++)e[r]!==e[r+1]&&t++;if(t===e.length)return e;for(var i=new Int32Array(t),a=0,r=0,n=e.length-1;r<n;r++)e[r]!==e[r+1]&&(i[a++]=e[r]);return i[a]=e[e.length-1],i}function Nwe(e,t){if(e===t)return hM(0,e.length-1);for(var r=dv(e,t),n=r.startI,i=r.startJ,a=r.endI,o=r.endJ,s=n,u=i,l=0;s<a&&u<o;){var c=e[s],d=t[u];c<d?s++:c>d?u++:(s++,u++,l++)}var f=e.length;if(!l)return B1;if(l===f)return hM(0,e.length-1);var h=new Int32Array(l),v=0;for(s=n,u=i;s<a&&u<o;){var c=e[s],d=t[u];c<d?s++:(c>d||(h[v++]=s,s++),u++)}return h}var Nl={startI:0,startJ:0,endI:0,endJ:0};function dv(e,t){var r=e.length,n=t.length,i=r/n;return r>=128||n>=128||i<=.34||i>=2.99?(Nl.startI=ip(e,vM(t)),Nl.startJ=ip(t,vM(e)),Nl.endI=ip(e,mM(t)),Nl.endJ=ip(t,mM(e))):(Nl.startI=0,Nl.startJ=0,Nl.endI=r,Nl.endJ=n),Nl}var Je;(function(e){e.Empty=B1,e.ofUnsortedArray=ywe,e.ofSingleton=mwe,e.ofSortedArray=gwe,e.ofRange=V8,e.ofBounds=function(t,r){return V8(t,r-1)},e.is=bwe,e.has=Ewe,e.indexOf=vY,e.indexOfInInterval=wwe,e.indexOfInRange=mY,e.start=vM,e.end=mM,e.min=xwe,e.max=Swe,e.size=pY,e.hashCode=Cwe,e.toString=_we,e.areEqual=Awe,e.areIntersecting=Mwe,e.isSubset=Dwe,e.union=bY,e.intersect=kwe,e.subtract=Owe,e.findPredecessorIndex=ip,e.findPredecessorIndexInInterval=Pwe,e.findRange=Twe,e.intersectionSize=Rwe,e.deduplicate=Lwe,e.indicesOf=Nwe})(Je||(Je={}));var xl=Te.Empty,Fwe=Te.ofSingleton,Bwe=Te.ofRange,Uwe=Te.ofBounds;function Lu(e){return e.length?e[e.length-1]-e[0]+1===e.length?Te.ofRange(e[0],e[e.length-1]):e:xl}function gp(e){return Te.is(e)?Te.size(e):Je.size(e)}function jwe(e,t){return Te.is(e)?Te.has(e,t):Je.has(e,t)}function zwe(e,t){return Te.is(e)?Te.indexOf(e,t):Je.indexOf(e,t)}function gM(e,t){return Te.is(e)?Te.getAt(e,t):e[t]}function Sg(e){return Te.is(e)?Te.min(e):Je.min(e)}function Cg(e){return Te.is(e)?Te.max(e):Je.max(e)}function Vwe(e){return Te.is(e)?Te.start(e):Je.start(e)}function Hwe(e){return Te.is(e)?Te.end(e):Je.end(e)}function Gwe(e){return Te.is(e)?Te.hashCode(e):Je.hashCode(e)}function qwe(e){return Te.is(e)?Te.toString(e):Je.toString(e)}function Wwe(e,t){return Te.is(e)?Te.is(t)?Te.areEqual(e,t):H8(e,t):Te.is(t)?H8(t,e):Je.areEqual(e,t)}function $we(e,t){return Te.is(e)?Te.is(t)?Te.areIntersecting(e,t):G8(t,e):Te.is(t)?G8(e,t):Je.areIntersecting(e,t)}function Xwe(e,t){return Te.is(e)?Te.is(t)?Te.isSubInterval(e,t):n3e(e,t):Te.is(t)?r3e(e,t):Je.isSubset(e,t)}function Ywe(e,t){return Te.is(e)?Te.findPredecessorIndex(e,t):Je.findPredecessorIndex(e,t)}function Kwe(e,t,r){return Te.is(e)?Te.findPredecessorIndexInInterval(e,t,r):Je.findPredecessorIndexInInterval(e,t,r)}function Qwe(e,t,r){return Te.is(e)?Te.findRange(e,t,r):Je.findRange(e,t,r)}function Zwe(e,t){return Te.is(e)?Te.is(t)?Te.intersectionSize(e,t):W8(t,e):Te.is(t)?W8(e,t):Je.intersectionSize(e,t)}function Jwe(e,t){return Te.is(e)?Te.is(t)?o3e(e,t):q8(t,e):Te.is(t)?q8(e,t):Lu(Je.union(e,t))}function e3e(e,t){return Te.is(e)?Te.is(t)?Te.intersect(e,t):$8(t,e):Te.is(t)?$8(e,t):Lu(Je.intersect(e,t))}function t3e(e,t){return Te.is(e)?Te.is(t)?s3e(e,t):l3e(e,t):Te.is(t)?u3e(e,t):Lu(Je.subtract(e,t))}function H8(e,t){return Te.size(e)===Je.size(t)&&Te.start(e)===Je.start(t)&&Te.end(e)===Je.end(t)}function G8(e,t){return e.length!==0&&Te.size(Je.findRange(e,Te.min(t),Te.max(t)))!==0}function r3e(e,t){var r=Te.min(t),n=Te.max(t);if(n-r+1===0)return!0;var i=Je.min(e),a=Je.max(e);if(r<i||n>a)return!1;var o=Je.findRange(e,r,n);return Te.size(o)===Te.size(t)}function n3e(e,t){var r=Te.min(e),n=Te.max(e);if(n-r+1===0)return!1;var i=Je.min(t),a=Je.max(t);return i>=r&&a<=n}function i3e(e,t){var r=gp(e),n=gp(t);return r===0&&n===0?!0:r>0&&n>0&&Cg(e)>=Sg(t)&&Sg(e)<=Cg(t)}function a3e(e,t){return gp(e)?gp(t)?Sg(e)<=Sg(t)&&Cg(e)>=Cg(t):!0:gp(t)===0}function o3e(e,t){if(Te.areEqual(e,t))return e;var r=Te.size(e),n=Te.size(t);if(!n)return e;if(!r)return t;var i=Te.min(e),a=Te.min(t);if(i3e(e,t))return Te.ofRange(Math.min(i,a),Math.max(Te.max(e),Te.max(t)));var o,s,u,l;i<a?(o=r,s=i,u=n,l=a):(o=n,s=a,u=r,l=i);for(var c=new Int32Array(r+n),d=0;d<o;d++)c[d]=d+s;for(var d=0;d<u;d++)c[d+o]=d+l;return Lu(c)}function q8(e,t){var r=Te.size(t);if(!r)return e;if(a3e(t,e))return t;for(var n=Te.min(t),i=Te.max(t),a=Je.findRange(e,n,i),o=Te.start(a),s=Te.end(a),u=new Int32Array(o+(e.length-s)+r),l=0,c=0;c<o;c++)u[l++]=e[c];for(var c=n;c<=i;c++)u[l++]=c;for(var c=s,d=e.length;c<d;c++)u[l++]=e[c];return Lu(u)}function W8(e,t){if(!Te.size(t))return 0;var r=Je.findRange(e,Te.min(t),Te.max(t));return Te.end(r)-Te.start(r)}function $8(e,t){if(!Te.size(t))return xl;var r=Je.findRange(e,Te.min(t),Te.max(t)),n=Te.start(r),i=Te.end(r),a=i-n;if(!a)return xl;if(a===e.length)return e;for(var o=new Int32Array(a),s=0,u=n;u<i;u++)o[s++]=e[u];return Lu(o)}function s3e(e,t){if(Te.areEqual(e,t))return xl;if(!Te.areIntersecting(e,t))return e;var r=Te.min(e),n=Te.max(e),i=Te.min(t),a=Te.max(t);if(n<r||a<i)return e;if(Te.isSubInterval(t,e))return xl;if(Te.isSubInterval(e,t)){var o=i-r,s=n-a;if(o<=0)return Te.ofRange(a+1,a+s);if(s<=0)return Te.ofRange(r,r+o-1);for(var u=new Int32Array(o+s),l=0,c=0;c<o;c++)u[l++]=r+c;for(var c=1;c<=s;c++)u[l++]=a+c;return Lu(u)}return r<i?Te.ofRange(r,i-1):Te.ofRange(a+1,n)}function u3e(e,t){var r=Te.min(t),n=Te.max(t);if(n<r)return e;var i=Je.findRange(e,r,n),a=Te.start(i),o=Te.end(i),s=e.length-(o-a);if(s<=0)return xl;if(s===e.length)return e;for(var u=new Int32Array(s),l=0,c=0;c<a;c++)u[l++]=e[c];for(var c=o,d=e.length;c<d;c++)u[l++]=e[c];return Lu(u)}function l3e(e,t){var r=Te.min(e),n=Te.max(e);if(n<r)return e;var i=n-r+1,a=Je.findRange(t,r,n),o=Te.start(a),s=Te.end(a),u=s-o;if(u===0)return e;var l=i-u;if(l<=0)return xl;for(var c=new Int32Array(l),d=t.length-1,f=t[Math.min(o,d)],h=t[Math.min(s,d)],v=0,p=r;p<f;p++)c[v++]=p;for(var p=f;p<=h;p++)Je.indexOfInInterval(t,p,a)<0&&(c[v++]=p);for(var p=h+1;p<=n;p++)c[v++]=p;return Lu(c)}function c3e(e,t,r){if(Te.is(e))for(var n=Te.min(e),i=n,a=Te.max(e);i<=a;i++)t(i,i-n,r);else for(var i=0,a=e.length;i<a;i++)t(e[i],i,r);return r}function d3e(e,t,r,n){if(Te.is(e))for(var i=0,a=Te.min(e),o=Te.max(e);a<=o;a++){for(var s=t(a),u=a+1;u<o&&t(u)===s;)u++;a=u-1,r(s,i,n),i++}else for(var i=0,a=0,o=e.length;a<o;a++){for(var s=t(e[a]),u=a+1;u<o&&t(e[u])===s;)u++;a=u-1,r(s,i,n),i++}return n}function f3e(e,t,r){if(t===r)return e;var n=gp(e),i=t.length,a=r.length;if(n===0||i===0||a===0)return xl;for(var o=Je.findPredecessorIndex(r,t[Sg(e)]),s=Je.findPredecessorIndex(r,t[Cg(e)]+1),u=0,l=0,c=0,d=o;c<n&&d<s;){var f=t[gM(e,c)],h=r[d];f<h?c++:(f>h||(u++,c++),d++)}if(u===0)return xl;if(u===i&&u===a)return e;var v=new Int32Array(u);for(l=0,c=0,d=o;c<n&&d<s;){var f=t[gM(e,c)],h=r[d];f<h?c++:(f>h||(v[l++]=d,c++),d++)}return Lu(v)}var Oe;(function(e){e.Empty=xl,e.ofSingleton=Fwe,e.ofRange=Bwe,e.ofBounds=Uwe,e.ofSortedArray=Lu,e.has=jwe,e.indexOf=zwe,e.getAt=gM,e.min=Sg,e.max=Cg,e.start=Vwe,e.end=Hwe,e.size=gp,e.hashCode=Gwe,e.areEqual=Wwe,e.areIntersecting=$we,e.isSubset=Xwe,e.union=Jwe,e.intersect=e3e,e.indexedIntersect=f3e,e.subtract=t3e,e.findPredecessorIndex=Ywe,e.findPredecessorIndexInInterval=Kwe,e.findRange=Qwe,e.intersectionSize=Zwe;function t(s,u,l){return c3e(s,u,l)}e.forEach=t;function r(s,u,l,c){return d3e(s,u,l,c)}e.forEachSegment=r;function n(s){return Te.is(s)}e.isInterval=n;function i(s){return!Te.is(s)}e.isSortedArray=i;function a(s){var u=[];return e.forEach(s,function(l){return u.push(l)}),u}e.toArray=a;function o(s){return qwe(s)}e.toString=o})(Oe||(Oe={}));function xY(e){for(var t=Je.ofSortedArray(e),r=Je.max(t),n=new Int32Array(r),i=0,a=e.length-1;i<a;i++)for(var o=e[i],s=e[i+1];o<s;o++)n[o]=i;return{offsets:t,index:n,count:e.length-1}}function h3e(e,t){for(var r=Te.start(t),n=new Int32Array(e.length+1),i=0,a=e.length;i<a;i++)n[i]=e[i]-r;return n[e.length]=Te.end(t)-r,xY(n)}function p3e(e){var t=e.count;return t}function v3e(e,t){var r=e.index;return r[t]}function m3e(e,t,r){var n=e.offsets,i=Oe.max(n),a=r>=i?-1:Oe.findPredecessorIndex(n,r-1);return Oe.findRange(t,Oe.getAt(n,a),Oe.getAt(n,a+1)-1)}var g3e=function(){function e(t,r,n,i){this.segments=t,this.segmentMap=r,this.set=n,this.segmentMin=0,this.segmentMax=0,this.setRange=Te.Empty,this.value={index:0,start:0,end:0},this.hasNext=!1,this.setRange=i,this.updateSegmentRange()}return e.prototype.move=function(){for(;this.hasNext;)if(this.updateValue()){this.value.index=this.segmentMin++,this.hasNext=this.segmentMax>=this.segmentMin&&Te.size(this.setRange)>0;break}else this.updateSegmentRange();return this.value},e.prototype.updateValue=function(){var t=this.segments[this.segmentMin+1],r=Oe.findPredecessorIndexInInterval(this.set,t,this.setRange);return this.value.start=Te.start(this.setRange),this.value.end=r,this.setRange=Te.ofBounds(r,Te.end(this.setRange)),r>this.value.start},e.prototype.updateSegmentRange=function(){var t=Te.min(this.setRange),r=Te.max(this.setRange);if(r<t){this.hasNext=!1;return}this.segmentMin=this.segmentMap[Oe.getAt(this.set,t)],this.segmentMax=this.segmentMap[Oe.getAt(this.set,r)],this.hasNext=this.segmentMax>=this.segmentMin},e.prototype.setSegment=function(t){this.setRange=Te.ofBounds(t.start,t.end),this.updateSegmentRange()},e}();function y3e(e,t,r){var n=typeof r<"u"?Te.ofBounds(r.start,r.end):Te.ofBounds(0,Oe.size(t));return new g3e(e.offsets,e.index,t,n)}var nr;(function(e){e.create=xY,e.ofOffsets=h3e,e.count=p3e,e.getSegment=v3e,e.projectValue=m3e,e.transientSegments=y3e})(nr||(nr={}));function b3e(e){return new x3e(e)}var x3e=function(){function e(t){this.head=t>0?0:-1,this.prev=new Int32Array(t),this.next=new Int32Array(t);for(var r=0;r<t;r++)this.next[r]=r+1,this.prev[r]=r-1;this.prev[0]=-1,this.next[t-1]=-1}return e.prototype.remove=function(t){var r=this,n=r.prev,i=r.next,a=n[t],o=i[t];a>=0&&(i[a]=o,n[t]=-1),o>=0&&(n[o]=a,i[t]=-1),t===this.head&&(a<0?this.head=o:this.head=a)},e.prototype.has=function(t){return this.prev[t]>=0||this.next[t]>=0||this.head===t},e}(),Ls;(function(e){e.Empty=new Map;function t(o){return Nk(o.keys())}e.keyArray=t;function r(){return new Map}e.Mutable=r;function n(o){return o}e.asImmutable=n;function i(o){for(var s=r(),u=o.keys();;){var l=u.next(),c=l.done,d=l.value;if(c)break;s.set(d,o.get(d))}return s}e.copy=i;function a(o,s){for(var u=s.keys();;){var l=u.next(),c=l.done,d=l.value;if(c)break;o.set(d,s.get(d))}return o}e.addFrom=a})(Ls||(Ls={}));var S3e=function(){function e(t){this.xs=[],this.index=-1,this.length=0,this.hasNext=!1,this.length=t.length,this.hasNext=t.length>0,this.xs=t,this.index=-1,this.lastValue=t.length>0?t[0]:void 0}return e.prototype.move=function(){return++this.index,this.lastValue=this.xs[this.index],this.hasNext=this.index<this.length-1,this.lastValue},e}(),X8=function(){function e(t,r){this.max=r,this.value=0,this.hasNext=!1,this.value=t-1,this.hasNext=r>=t}return e.prototype.move=function(){return++this.value,this.hasNext=this.value<this.max,this.value},e}(),C3e=function(){function e(t){this.value=t,this.hasNext=!0}return e.prototype.move=function(){return this.hasNext=!1,this.value},e}(),_3e=function(){function e(t,r){this.base=t,this.f=r,this.hasNext=!1,this.hasNext=t.hasNext}return e.prototype.move=function(){var t=this.f(this.base.move());return this.hasNext=this.base.hasNext,t},e}(),w3e=function(){function e(t,r){this.base=t,this.p=r,this.hasNext=this.findNext()}return e.prototype.move=function(){var t=this.next;return this.hasNext=this.findNext(),t},e.prototype.findNext=function(){for(;this.base.hasNext;)if(this.next=this.base.move(),this.p(this.next))return!0;return!1},e}(),UC;(function(e){e.Empty=new X8(0,-1);function t(s){return new S3e(s)}e.Array=t;function r(s){return new C3e(s)}e.Value=r;function n(s,u){return new X8(s,u)}e.Range=n;function i(s,u){return new _3e(s,u)}e.map=i;function a(s,u){return new w3e(s,u)}e.filter=a;function o(s,u,l){for(;s.hasNext;){var c=u(s.move(),l);if(c)return l}return l}e.forEach=o})(UC||(UC={}));var E3e={domain:[0,1],reverse:!1,listOrName:"red-yellow-blue",minLabel:"",maxLabel:""},Pu;(function(e){function t(r){var n=E(E({},E3e),r),i=n.domain,a=n.reverse,o=n.listOrName,s=typeof o=="string"?Os(o).list:o,u=a?s.slice().reverse():s,l=u.length-1,c=0,d=0,f=0;function h(C,w){d=C,f=w,c=f-d||1}h(i[0],i[1]);var v=Ei(r.minLabel,d.toString()),p=Ei(r.maxLabel,f.toString()),m,g=u.every(function(C){return Array.isArray(C)});if(g){var y=Ft([],u);y.sort(function(C,w){return C[1]-w[1]});var b=y.map(function(C){return C[0]}),S=Je.ofSortedArray(y.map(function(C){return C[1]})),x=b.length-1;m=function(C){var w=Ia((C-d)/c,0,1),A=Je.findPredecessorIndex(S,w);if(A===0)return b[d];if(A>x)return b[x];var M=S[A-1],D=S[A],k=Ia((w-M)/(D-M),0,1);return at.interpolate(b[A-1],b[A],k)}}else m=function(C){var w=Math.min(u.length-1,Math.max(0,(C-d)/c*l)),A=Math.floor(w),M=u[A],D=u[Math.ceil(w)];return at.interpolate(M,D,w-A)};return{color:m,colorToArray:function(C,w,A){at.toArray(m(C),w,A)},normalizedColorToArray:function(C,w,A){at.toArrayNormalized(m(C),w,A)},setDomain:h,get legend(){return T_e(v,p,u)}}}e.create=t})(Pu||(Pu={}));function nn(e){return e.svg?T.jsx("span",E({className:"msp-icon msp-material-icon"+(e.inline?" msp-icon-inline":""),title:e.title,style:e.style},{children:T.jsx(e.svg,{},void 0)}),void 0):null}var c3=T.jsx("circle",{r:"6px",id:"circle-left",cy:"12px",cx:"8px",strokeWidth:"1px"},void 0),d3=T.jsx("circle",{r:"6px",id:"circle-right",cy:"12px",cx:"16px",strokeWidth:"1px"},void 0),A3e=T.jsxs("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:[T.jsxs("defs",{children:[c3,d3]},void 0),T.jsxs("g",{children:[T.jsx("use",{href:"#circle-left",className:"msp-shape-filled"},void 0),T.jsx("use",{href:"#circle-right",className:"msp-shape-filled"},void 0),T.jsx("use",{href:"#circle-left",className:"msp-shape-empty"},void 0)]},void 0)]}),void 0);function yM(){return A3e}var P3e=T.jsxs("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:[T.jsxs("defs",{children:[c3,d3,T.jsxs("mask",E({id:"mask-left"},{children:[T.jsx("use",{href:"#circle-left",fill:"white",stroke:"white"},void 0),T.jsx("use",{href:"#circle-right",fill:"black",strokeWidth:"0px",stroke:"white"},void 0)]}),void 0)]},void 0),T.jsxs("g",{children:[T.jsx("use",{href:"#circle-left",className:"msp-shape-filled",mask:"url(#mask-left)"},void 0),T.jsx("use",{href:"#circle-right",className:"msp-shape-empty"},void 0)]},void 0)]}),void 0);function bM(){return P3e}var T3e=T.jsxs("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:[T.jsxs("defs",{children:[c3,d3,T.jsx("clipPath",E({id:"clip-left"},{children:T.jsx("use",{href:"#circle-right"},void 0)}),void 0)]},void 0),T.jsxs("g",{children:[T.jsx("use",{href:"#circle-left",className:"msp-shape-filled",clipPath:"url(#clip-left)"},void 0),T.jsx("use",{href:"#circle-left",className:"msp-shape-empty"},void 0),T.jsx("use",{href:"#circle-right",className:"msp-shape-empty"},void 0)]},void 0)]}),void 0);function xM(){return T3e}var I3e=T.jsxs("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:[T.jsxs("defs",{children:[c3,d3]},void 0),T.jsxs("g",{children:[T.jsx("use",{href:"#circle-left",className:"msp-shape-empty"},void 0),T.jsx("use",{href:"#circle-right",className:"msp-shape-filled"},void 0)]},void 0)]}),void 0);function jC(){return I3e}var M3e=T.jsx("svg",E({width:"17px",height:"17px",viewBox:"0 0 299.463 299.463",strokeWidth:"6px"},{children:T.jsx("g",{children:T.jsx("path",{d:"M256.851,173.832v-48.201c22.916-4.918,34.151-30.668,22.556-50.771c-11.547-20.004-39.486-23.251-55.242-5.844 l-41.746-24.106C189.618,22.603,172.861,0,149.734,0c-23.132,0-39.881,22.609-32.685,44.911L75.305,69.016 C59.522,51.586,31.597,54.88,20.061,74.863c-11.63,20.163-0.298,45.862,22.557,50.769v48.2 c-22.821,4.898-34.195,30.591-22.556,50.771c11.529,19.972,39.454,23.285,55.242,5.845l41.746,24.106 c-7.199,22.308,9.559,44.911,32.685,44.911c23.132,0,39.88-22.609,32.685-44.911l41.745-24.106 c15.817,17.469,43.73,14.099,55.242-5.844c0,0,0-0.001,0.001-0.002c4.587-7.953,5.805-17.213,3.431-26.076 C279.392,185.657,269.129,176.461,256.851,173.832z M249.62,72.088c20.568,0,27.428,27.191,10.008,37.239 c-0.003,0.002-0.006,0.003-0.009,0.005c-10.04,5.81-22.85,1.762-27.877-8.475C225.206,87.548,234.938,72.088,249.62,72.088z M149.734,14.4c11.005,0,19.958,8.954,19.958,19.959c0,11.127-9.077,19.958-19.958,19.958c-10.95,0-19.958-8.9-19.958-19.958 C129.776,23.354,138.729,14.4,149.734,14.4z M39.84,109.328c-17.451-10.067-10.534-37.24,10.01-37.24 c15.311,0,24.922,16.653,17.251,29.942C61.681,111.397,49.517,114.925,39.84,109.328z M59.802,224.702 c-9.535,5.503-21.768,2.229-27.268-7.298c-7.639-13.242,1.887-29.945,17.236-29.945c0.013,0,0.027,0,0.04,0 C70.07,187.48,77.49,214.469,59.802,224.702z M149.734,285.062c-11.005,0-19.958-8.954-19.958-19.958 c0-11.127,9.077-19.958,19.958-19.958c10.954,0,19.958,8.903,19.958,19.958C169.693,276.109,160.74,285.062,149.734,285.062z M216.953,217.982l-41.727,24.095c-13.778-15.22-37.459-14.94-50.983,0l-41.728-24.096c6.196-19.289-5.541-39.835-25.498-44.149 V125.63c19.752-4.268,31.762-24.65,25.498-44.149l41.727-24.095c13.629,15.055,37.32,15.093,50.983,0l41.728,24.096 c-6.196,19.29,5.534,39.835,25.498,44.149v48.202C222.61,178.123,210.721,198.581,216.953,217.982z M266.935,217.404 c-5.501,9.528-17.732,12.802-27.261,7.302c-17.682-10.23-10.301-37.247,10.032-37.247 C264.984,187.459,274.602,204.112,266.935,217.404z"},void 0)},void 0)}),void 0);function D3e(){return M3e}var R3e=T.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24",strokeWidth:"0.1px"},{children:T.jsx("path",{d:"M21,16.5C21,16.88 20.79,17.21 20.47,17.38L12.57,21.82C12.41,21.94 12.21,22 12,22C11.79,22 11.59,21.94 11.43,21.82L3.53,17.38C3.21,17.21 3,16.88 3,16.5V7.5C3,7.12 3.21,6.79 3.53,6.62L11.43,2.18C11.59,2.06 11.79,2 12,2C12.21,2 12.41,2.06 12.57,2.18L20.47,6.62C20.79,6.79 21,7.12 21,7.5V16.5M12,4.15L6.04,7.5L12,10.85L17.96,7.5L12,4.15M5,15.91L11,19.29V12.58L5,9.21V15.91M19,15.91V9.21L13,12.58V19.29L19,15.91Z"},void 0)}),void 0);function SM(){return R3e}T.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24",strokeWidth:"0.1px"},{children:T.jsx("path",{d:"M17,22V20H20V17H22V20.5C22,20.89 21.84,21.24 21.54,21.54C21.24,21.84 20.89,22 20.5,22H17M7,22H3.5C3.11,22 2.76,21.84 2.46,21.54C2.16,21.24 2,20.89 2,20.5V17H4V20H7V22M17,2H20.5C20.89,2 21.24,2.16 21.54,2.46C21.84,2.76 22,3.11 22,3.5V7H20V4H17V2M7,2V4H4V7H2V3.5C2,3.11 2.16,2.76 2.46,2.46C2.76,2.16 3.11,2 3.5,2H7M13,17.25L17,14.95V10.36L13,12.66V17.25M12,10.92L16,8.63L12,6.28L8,8.63L12,10.92M7,14.95L11,17.25V12.66L7,10.36V14.95M18.23,7.59C18.73,7.91 19,8.34 19,8.91V15.23C19,15.8 18.73,16.23 18.23,16.55L12.75,19.73C12.25,20.05 11.75,20.05 11.25,19.73L5.77,16.55C5.27,16.23 5,15.8 5,15.23V8.91C5,8.34 5.27,7.91 5.77,7.59L11.25,4.41C11.5,4.28 11.75,4.22 12,4.22C12.25,4.22 12.5,4.28 12.75,4.41L18.23,7.59Z"},void 0)}),void 0);T.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24",strokeWidth:"0.1px"},{children:T.jsx("path",{d:"M16,4L9,8.04V15.96L16,20L23,15.96V8.04M16,6.31L19.8,8.5L16,10.69L12.21,8.5M0,7V9H7V7M11,10.11L15,12.42V17.11L11,14.81M21,10.11V14.81L17,17.11V12.42M2,11V13H7V11M4,15V17H7V15"},void 0)}),void 0);var k3e=T.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:T.jsx("path",{d:"M10.07,14.27C10.57,14.03 11.16,14.25 11.4,14.75L13.7,19.74L15.5,18.89L13.19,13.91C12.95,13.41 13.17,12.81 13.67,12.58L13.95,12.5L16.25,12.05L8,5.12V15.9L9.82,14.43L10.07,14.27M13.64,21.97C13.14,22.21 12.54,22 12.31,21.5L10.13,16.76L7.62,18.78C7.45,18.92 7.24,19 7,19A1,1 0 0,1 6,18V3A1,1 0 0,1 7,2C7.24,2 7.47,2.09 7.64,2.23L7.65,2.22L19.14,11.86C19.57,12.22 19.62,12.85 19.27,13.27C19.12,13.45 18.91,13.57 18.7,13.61L15.54,14.23L17.74,18.96C18,19.46 17.76,20.05 17.26,20.28L13.64,21.97Z"},void 0)}),void 0);function O3e(){return k3e}T.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24",strokeWidth:"0.1px"},{children:T.jsx("path",{fill:"currentColor",d:"M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"},void 0)}),void 0);var L3e=T.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24",strokeWidth:"0.1px"},{children:T.jsx("path",{d:"M3 17.25V21H6.75L17.81 9.93L14.06 6.18L3 17.25M22.61 18.36L18.36 22.61L13.16 17.41L14.93 15.64L15.93 16.64L18.4 14.16L19.82 15.58L18.36 17L19.42 18L20.84 16.6L22.61 18.36M6.61 10.83L1.39 5.64L5.64 1.39L7.4 3.16L4.93 5.64L6 6.7L8.46 4.22L9.88 5.64L8.46 7.05L9.46 8.05L6.61 10.83M20.71 7C21.1 6.61 21.1 6 20.71 5.59L18.37 3.29C18 2.9 17.35 2.9 16.96 3.29L15.12 5.12L18.87 8.87L20.71 7Z"},void 0)}),void 0);function N3e(){return L3e}var F3e=T.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:T.jsx("path",{d:"M22 11V3h-7v3H9V3H2v8h7V8h2v10h4v3h7v-8h-7v3h-2V8h2v3h7zM7 9H4V5h3v4zm10 6h3v4h-3v-4zm0-10h3v4h-3V5z"},void 0)}),void 0);function SY(){return F3e}var B3e=T.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:T.jsx("path",{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"},void 0)}),void 0);function Gg(){return B3e}var U3e=T.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:T.jsx("path",{d:"M20 12l-1.41-1.41L13 16.17V4h-2v12.17l-5.58-5.59L4 12l8 8 8-8z"},void 0)}),void 0);function f3(){return U3e}var j3e=T.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:T.jsx("path",{d:"M7 10l5 5 5-5z"},void 0)}),void 0);function Rc(){return j3e}var z3e=T.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:T.jsx("path",{d:"M10 17l5-5-5-5v10z"},void 0)}),void 0);function kc(){return z3e}var V3e=T.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:T.jsx("path",{d:"M4 12l1.41 1.41L11 7.83V20h2V7.83l5.58 5.59L20 12l-8-8-8 8z"},void 0)}),void 0);function h3(){return V3e}var H3e=T.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:T.jsx("path",{d:"M12 6v3l4-4-4-4v3c-4.42 0-8 3.58-8 8 0 1.57.46 3.03 1.24 4.26L6.7 14.8c-.45-.83-.7-1.79-.7-2.8 0-3.31 2.69-6 6-6zm6.76 1.74L17.3 9.2c.44.84.7 1.79.7 2.8 0 3.31-2.69 6-6 6v-3l-4 4 4 4v-3c4.42 0 8-3.58 8-8 0-1.57-.46-3.03-1.24-4.26z"},void 0)}),void 0);function G3e(){return H3e}var q3e=T.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:T.jsx("path",{d:"M6 13c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1zm0 4c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1zm0-8c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1zm-3 .5c-.28 0-.5.22-.5.5s.22.5.5.5.5-.22.5-.5-.22-.5-.5-.5zM6 5c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1zm15 5.5c.28 0 .5-.22.5-.5s-.22-.5-.5-.5-.5.22-.5.5.22.5.5.5zM14 7c.55 0 1-.45 1-1s-.45-1-1-1-1 .45-1 1 .45 1 1 1zm0-3.5c.28 0 .5-.22.5-.5s-.22-.5-.5-.5-.5.22-.5.5.22.5.5.5zm-11 10c-.28 0-.5.22-.5.5s.22.5.5.5.5-.22.5-.5-.22-.5-.5-.5zm7 7c-.28 0-.5.22-.5.5s.22.5.5.5.5-.22.5-.5-.22-.5-.5-.5zm0-17c.28 0 .5-.22.5-.5s-.22-.5-.5-.5-.5.22-.5.5.22.5.5.5zM10 7c.55 0 1-.45 1-1s-.45-1-1-1-1 .45-1 1 .45 1 1 1zm0 5.5c-.83 0-1.5.67-1.5 1.5s.67 1.5 1.5 1.5 1.5-.67 1.5-1.5-.67-1.5-1.5-1.5zm8 .5c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1zm0 4c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1zm0-8c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1zm0-4c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1zm3 8.5c-.28 0-.5.22-.5.5s.22.5.5.5.5-.22.5-.5-.22-.5-.5-.5zM14 17c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1zm0 3.5c-.28 0-.5.22-.5.5s.22.5.5.5.5-.22.5-.5-.22-.5-.5-.5zm-4-12c-.83 0-1.5.67-1.5 1.5s.67 1.5 1.5 1.5 1.5-.67 1.5-1.5-.67-1.5-1.5-1.5zm0 8.5c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1zm4-4.5c-.83 0-1.5.67-1.5 1.5s.67 1.5 1.5 1.5 1.5-.67 1.5-1.5-.67-1.5-1.5-1.5zm0-4c-.83 0-1.5.67-1.5 1.5s.67 1.5 1.5 1.5 1.5-.67 1.5-1.5-.67-1.5-1.5-1.5z"},void 0)}),void 0);function CY(){return q3e}var W3e=T.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:T.jsx("path",{d:"M15 7v12.97l-4.21-1.81-.79-.34-.79.34L5 19.97V7h10m4-6H8.99C7.89 1 7 1.9 7 3h10c1.1 0 2 .9 2 2v13l2 1V3c0-1.1-.9-2-2-2zm-4 4H5c-1.1 0-2 .9-2 2v16l7-3 7 3V7c0-1.1-.9-2-2-2z"},void 0)}),void 0);function p3(){return W3e}var $3e=T.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:T.jsx("path",{d:"M7 14c-1.66 0-3 1.34-3 3 0 1.31-1.16 2-2 2 .92 1.22 2.49 2 4 2 2.21 0 4-1.79 4-4 0-1.66-1.34-3-3-3zm13.71-9.37l-1.34-1.34a.9959.9959 0 00-1.41 0L9 12.25 11.75 15l8.96-8.96c.39-.39.39-1.02 0-1.41z"},void 0)}),void 0);function CM(){return $3e}var X3e=T.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:T.jsx("path",{d:"M22.61 18.99l-9.08-9.08c.93-2.34.45-5.1-1.44-7C9.79.61 6.21.4 3.66 2.26L7.5 6.11 6.08 7.52 2.25 3.69C.39 6.23.6 9.82 2.9 12.11c1.86 1.86 4.57 2.35 6.89 1.48l9.11 9.11c.39.39 1.02.39 1.41 0l2.3-2.3c.4-.38.4-1.01 0-1.41zm-3 1.6l-9.46-9.46c-.61.45-1.29.72-2 .82-1.36.2-2.79-.21-3.83-1.25C3.37 9.76 2.93 8.5 3 7.26l3.09 3.09 4.24-4.24-3.09-3.09c1.24-.07 2.49.37 3.44 1.31 1.08 1.08 1.49 2.57 1.24 3.96-.12.71-.42 1.37-.88 1.96l9.45 9.45-.88.89z"},void 0)}),void 0);function Y3e(){return X3e}var K3e=T.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:T.jsx("path",{d:"M22.7 19l-9.1-9.1c.9-2.3.4-5-1.5-6.9-2-2-5-2.4-7.4-1.3L9 6 6 9 1.6 4.7C.4 7.1.9 10.1 2.9 12.1c1.9 1.9 4.6 2.4 6.9 1.5l9.1 9.1c.4.4 1 .4 1.4 0l2.3-2.3c.5-.4.5-1.1.1-1.4z"},void 0)}),void 0);function Q3e(){return K3e}var Z3e=T.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:T.jsx("path",{d:"M14.25 2.26l-.08-.04-.01.02C13.46 2.09 12.74 2 12 2 6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10c0-4.75-3.31-8.72-7.75-9.74zM19.41 9h-7.99l2.71-4.7c2.4.66 4.35 2.42 5.28 4.7zM13.1 4.08L10.27 9l-1.15 2L6.4 6.3C7.84 4.88 9.82 4 12 4c.37 0 .74.03 1.1.08zM5.7 7.09L8.54 12l1.15 2H4.26C4.1 13.36 4 12.69 4 12c0-1.85.64-3.55 1.7-4.91zM4.59 15h7.98l-2.71 4.7c-2.4-.67-4.34-2.42-5.27-4.7zm6.31 4.91L14.89 13l2.72 4.7C16.16 19.12 14.18 20 12 20c-.38 0-.74-.04-1.1-.09zm7.4-3l-4-6.91h5.43c.17.64.27 1.31.27 2 0 1.85-.64 3.55-1.7 4.91z"},void 0)}),void 0);function J3e(){return Z3e}var eEe=T.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:T.jsx("path",{d:"M9.4 10.5l4.77-8.26C13.47 2.09 12.75 2 12 2c-2.4 0-4.6.85-6.32 2.25l3.66 6.35.06-.1zM21.54 9c-.92-2.92-3.15-5.26-6-6.34L11.88 9h9.66zm.26 1h-7.49l.29.5 4.76 8.25C21 16.97 22 14.61 22 12c0-.69-.07-1.35-.2-2zM8.54 12l-3.9-6.75C3.01 7.03 2 9.39 2 12c0 .69.07 1.35.2 2h7.49l-1.15-2zm-6.08 3c.92 2.92 3.15 5.26 6 6.34L12.12 15H2.46zm11.27 0l-3.9 6.76c.7.15 1.42.24 2.17.24 2.4 0 4.6-.85 6.32-2.25l-3.66-6.35-.93 1.6z"},void 0)}),void 0);function tEe(){return eEe}var rEe=T.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:T.jsx("path",{d:"M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm3.59-13L12 10.59 8.41 7 7 8.41 10.59 12 7 15.59 8.41 17 12 13.41 15.59 17 17 15.59 13.41 12 17 8.41z"},void 0)}),void 0);function Uk(){return rEe}var nEe=T.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:T.jsx("path",{d:"M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2zm5 13.59L15.59 17 12 13.41 8.41 17 7 15.59 10.59 12 7 8.41 8.41 7 12 10.59 15.59 7 17 8.41 13.41 12 17 15.59z"},void 0)}),void 0);function _Y(){return nEe}var iEe=T.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:T.jsx("path",{d:"M12 8c-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4zm-7 7H3v4c0 1.1.9 2 2 2h4v-2H5v-4zM5 5h4V3H5c-1.1 0-2 .9-2 2v4h2V5zm14-2h-4v2h4v4h2V5c0-1.1-.9-2-2-2zm0 16h-4v2h4c1.1 0 2-.9 2-2v-4h-2v4z"},void 0)}),void 0);function aEe(){return iEe}var oEe=T.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:T.jsx("path",{d:"M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"},void 0)}),void 0);function qg(){return oEe}var sEe=T.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:T.jsx("path",{d:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"},void 0)}),void 0);function wY(){return sEe}var uEe=T.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:T.jsx("path",{d:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"},void 0)}),void 0);function dc(){return uEe}var lEe=T.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:T.jsx("path",{d:"M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96zM14 13v4h-4v-4H7l5-5 5 5h-3z"},void 0)}),void 0);function cEe(){return lEe}var dEe=T.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:T.jsx("path",{d:"M9.4 16.6L4.8 12l4.6-4.6L8 6l-6 6 6 6 1.4-1.4zm5.2 0l4.6-4.6-4.6-4.6L16 6l6 6-6 6-1.4-1.4z"},void 0)}),void 0);function fEe(){return dEe}var hEe=T.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:T.jsx("path",{d:"M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm-1 4H8c-1.1 0-1.99.9-1.99 2L6 21c0 1.1.89 2 1.99 2H19c1.1 0 2-.9 2-2V11l-6-6zM8 21V7h6v5h5v9H8z"},void 0)}),void 0);function pEe(){return hEe}var vEe=T.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:T.jsx("path",{d:"M17 15h2V7c0-1.1-.9-2-2-2H9v2h8v8zM7 17V1H5v4H1v2h4v10c0 1.1.9 2 2 2h10v4h2v-4h4v-2H7z"},void 0)}),void 0);function mEe(){return vEe}var gEe=T.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:T.jsx("path",{d:"M3 5v4h2V5h4V3H5c-1.1 0-2 .9-2 2zm2 10H3v4c0 1.1.9 2 2 2h4v-2H5v-4zm14 4h-4v2h4c1.1 0 2-.9 2-2v-4h-2v4zm0-16h-4v2h4v4h2V5c0-1.1-.9-2-2-2z"},void 0)}),void 0);function yEe(){return gEe}var bEe=T.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:T.jsx("path",{d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V5h14v14zm-5.04-6.71l-2.75 3.54-1.96-2.36L6.5 17h11l-3.54-4.71z"},void 0)}),void 0);function xEe(){return bEe}var SEe=T.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:T.jsx("path",{d:"M16 9v10H8V9h8m-1.5-6h-5l-1 1H5v2h14V4h-3.5l-1-1zM18 7H6v12c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7z"},void 0)}),void 0);function Vs(){return SEe}T.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:T.jsx("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"},void 0)}),void 0);var CEe=T.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:T.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"},void 0)}),void 0);function Y8(){return CEe}T.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:T.jsx("path",{d:"M20.5 11H19V7c0-1.1-.9-2-2-2h-4V3.5C13 2.12 11.88 1 10.5 1S8 2.12 8 3.5V5H4c-1.1 0-1.99.9-1.99 2v3.8H3.5c1.49 0 2.7 1.21 2.7 2.7s-1.21 2.7-2.7 2.7H2V20c0 1.1.9 2 2 2h3.8v-1.5c0-1.49 1.21-2.7 2.7-2.7 1.49 0 2.7 1.21 2.7 2.7V22H17c1.1 0 2-.9 2-2v-4h1.5c1.38 0 2.5-1.12 2.5-2.5S21.88 11 20.5 11z"},void 0)}),void 0);var _Ee=T.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24",strokeWidth:"0.1px"},{children:T.jsx("path",{d:"M3 13h2v-2H3v2zm0 4h2v-2H3v2zm2 4v-2H3c0 1.1.89 2 2 2zM3 9h2V7H3v2zm12 12h2v-2h-2v2zm4-18H9c-1.11 0-2 .9-2 2v10c0 1.1.89 2 2 2h10c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 12H9V5h10v10zm-8 6h2v-2h-2v2zm-4 0h2v-2H7v2z"},void 0)}),void 0);function wEe(){return _Ee}var EEe=T.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:T.jsx("path",{d:"M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z"},void 0)}),void 0);function AEe(){return EEe}var PEe=T.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:T.jsx("path",{d:"M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"},void 0)}),void 0);function _M(){return PEe}var TEe=T.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:T.jsx("path",{d:"M11 18h2v-2h-2v2zm1-16C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm0-14c-2.21 0-4 1.79-4 4h2c0-1.1.9-2 2-2s2 .9 2 2c0 2-3 1.75-3 5h2c0-2.25 3-2.5 3-5 0-2.21-1.79-4-4-4z"},void 0)}),void 0);function Sl(){return TEe}var IEe=T.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:T.jsx("path",{d:"M12 5.69l5 4.5V18h-2v-6H9v6H7v-7.81l5-4.5M12 3L2 12h3v8h6v-6h2v6h6v-8h3L12 3z"},void 0)}),void 0);function wM(){return IEe}T.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:T.jsx("path",{d:"M19 19H5V5h7V3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2v-7h-2v7zM14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3h-7z"},void 0)}),void 0);var MEe=T.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:T.jsx("path",{d:"M19.5 9.5c-1.03 0-1.9.62-2.29 1.5h-2.92c-.39-.88-1.26-1.5-2.29-1.5s-1.9.62-2.29 1.5H6.79c-.39-.88-1.26-1.5-2.29-1.5C3.12 9.5 2 10.62 2 12s1.12 2.5 2.5 2.5c1.03 0 1.9-.62 2.29-1.5h2.92c.39.88 1.26 1.5 2.29 1.5s1.9-.62 2.29-1.5h2.92c.39.88 1.26 1.5 2.29 1.5 1.38 0 2.5-1.12 2.5-2.5s-1.12-2.5-2.5-2.5z"},void 0)}),void 0);function DEe(){return MEe}var REe=T.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:T.jsx("path",{d:"M6 10c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm12 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm-6 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"},void 0)}),void 0);function jp(){return REe}var kEe=T.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:T.jsx("path",{d:"M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"},void 0)}),void 0);function EY(){return kEe}var OEe=T.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:T.jsx("path",{d:"M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"},void 0)}),void 0);function AY(){return OEe}var LEe=T.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:T.jsx("path",{d:"M19 4H5c-1.11 0-2 .9-2 2v12c0 1.1.89 2 2 2h4v-2H5V8h14v10h-4v2h4c1.1 0 2-.9 2-2V6c0-1.1-.89-2-2-2zm-7 6l-4 4h3v6h2v-6h3l-4-4z"},void 0)}),void 0);function NEe(){return LEe}var FEe=T.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:T.jsx("path",{d:"M8 5v14l11-7z"},void 0)}),void 0);function PY(){return FEe}var BEe=T.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:T.jsx("path",{d:"M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"},void 0)}),void 0);function EM(){return BEe}var UEe=T.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:T.jsx("path",{d:"M19 13H5v-2h14v2z"},void 0)}),void 0);function AM(){return UEe}var jEe=T.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:T.jsx("path",{d:"M13 3c-4.97 0-9 4.03-9 9H1l3.89 3.89.07.14L9 12H6c0-3.87 3.13-7 7-7s7 3.13 7 7-3.13 7-7 7c-1.93 0-3.68-.79-4.94-2.06l-1.42 1.42C8.27 19.99 10.51 21 13 21c4.97 0 9-4.03 9-9s-4.03-9-9-9zm-1 5v5l4.28 2.54.72-1.21-3.5-2.08V8H12z"},void 0)}),void 0);function PM(){return jEe}var zEe=T.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24",strokeWidth:"0.1px"},{children:T.jsx("path",{d:"M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7l-4-4zm2 16H5V5h11.17L19 7.83V19zm-7-7c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3zM6 6h9v4H6z"},void 0)}),void 0);function TY(){return zEe}var VEe=T.jsxs("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:[T.jsx("circle",{cx:"7",cy:"14",r:"3"},void 0),T.jsx("circle",{cx:"11",cy:"6",r:"3"},void 0),T.jsx("circle",{cx:"16.6",cy:"17.6",r:"3"},void 0)]}),void 0);function HEe(){return VEe}var GEe=T.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:T.jsx("path",{d:"M6 6h2v12H6zm3.5 6l8.5 6V6z"},void 0)}),void 0);function qEe(){return GEe}var WEe=T.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:T.jsx("path",{d:"M6 6h12v12H6z"},void 0)}),void 0);function IY(){return WEe}var $Ee=T.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:T.jsx("path",{d:"M4 6h16v2H4zm2-4h12v2H6zm14 8H4c-1.1 0-2 .9-2 2v8c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2v-8c0-1.1-.9-2-2-2zm0 10H4v-8h16v8zm-10-7.27v6.53L16 16z"},void 0)}),void 0);function XEe(){return $Ee}var YEe=T.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:T.jsx("path",{d:"M6.99 11L3 15l3.99 4v-3H14v-2H6.99v-3zM21 9l-3.99-4v3H10v2h7.01v3L21 9z"},void 0)}),void 0);function KEe(){return YEe}var QEe=T.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:T.jsx("path",{d:"M3 17v2h6v-2H3zM3 5v2h10V5H3zm10 16v-2h8v-2h-8v-2h-2v6h2zM7 9v2H3v2h4v2h2V9H7zm14 4v-2H11v2h10zm-6-4h2V7h4V5h-4V3h-2v6z"},void 0)}),void 0);function zp(){return QEe}var ZEe=T.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:T.jsx("path",{d:"M12 6c3.79 0 7.17 2.13 8.82 5.5-.59 1.22-1.42 2.27-2.41 3.12l1.41 1.41c1.39-1.23 2.49-2.77 3.18-4.53C21.27 7.11 17 4 12 4c-1.27 0-2.49.2-3.64.57l1.65 1.65C10.66 6.09 11.32 6 12 6zm-1.07 1.14L13 9.21c.57.25 1.03.71 1.28 1.28l2.07 2.07c.08-.34.14-.7.14-1.07C16.5 9.01 14.48 7 12 7c-.37 0-.72.05-1.07.14zM2.01 3.87l2.68 2.68C3.06 7.83 1.77 9.53 1 11.5 2.73 15.89 7 19 12 19c1.52 0 2.98-.29 4.32-.82l3.42 3.42 1.41-1.41L3.42 2.45 2.01 3.87zm7.5 7.5l2.61 2.61c-.04.01-.08.02-.12.02-1.38 0-2.5-1.12-2.5-2.5 0-.05.01-.08.01-.13zm-3.4-3.4l1.75 1.75c-.23.55-.36 1.15-.36 1.78 0 2.48 2.02 4.5 4.5 4.5.63 0 1.23-.13 1.77-.36l.98.98c-.88.24-1.8.38-2.75.38-3.79 0-7.17-2.13-8.82-5.5.7-1.43 1.72-2.61 2.93-3.53z"},void 0)}),void 0);function fv(){return ZEe}var JEe=T.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:T.jsx("path",{d:"M12 6c3.79 0 7.17 2.13 8.82 5.5C19.17 14.87 15.79 17 12 17s-7.17-2.13-8.82-5.5C4.83 8.13 8.21 6 12 6m0-2C7 4 2.73 7.11 1 11.5 2.73 15.89 7 19 12 19s9.27-3.11 11-7.5C21.27 7.11 17 4 12 4zm0 5c1.38 0 2.5 1.12 2.5 2.5S13.38 14 12 14s-2.5-1.12-2.5-2.5S10.62 9 12 9m0-2c-2.48 0-4.5 2.02-4.5 4.5S9.52 16 12 16s4.5-2.02 4.5-4.5S14.48 7 12 7z"},void 0)}),void 0);function hv(){return JEe}var eAe=T.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:T.jsx("path",{d:"M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z"},void 0)}),void 0);function tAe(){return eAe}var rAe=O3e,nAe=HEe,K8=DEe,iAe=wEe,fc=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isExpanded:!!r.props.initialExpanded},r.headerClicked=function(){r.props.onHeaderClick?r.props.onHeaderClick():r.setState({isExpanded:!r.state.isExpanded})},r}return t.prototype.render=function(){var r=this.props.hideOffset?"msp-control-group-children":"msp-control-group-children msp-control-offset";return this.props.childrenClassName&&(r+=" "+this.props.childrenClassName),T.jsxs("div",E({className:"msp-control-group-wrapper",style:{position:"relative",marginTop:this.props.noTopMargin?0:void 0}},{children:[T.jsx("div",E({className:"msp-control-group-header",style:{marginLeft:this.props.headerLeftMargin},title:this.props.title},{children:T.jsxs(hr,E({onClick:this.headerClicked},{children:[!this.props.hideExpander&&T.jsx(nn,{svg:this.state.isExpanded?kc:Rc},void 0),this.props.topRightIcon&&T.jsx(nn,{svg:this.props.topRightIcon,style:{position:"absolute",right:"2px",top:0}},void 0),T.jsx("b",{children:this.props.header},void 0)]}),void 0)}),void 0),this.state.isExpanded&&T.jsx("div",E({className:r,style:{display:this.state.isExpanded?"block":"none",maxHeight:this.props.maxHeight,overflow:"hidden",overflowY:"auto"}},{children:this.props.children}),void 0)]}),void 0)},t}(Ve.Component);function Q8(e){return e}var yc=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.input=Ve.createRef(),r.delayHandle=void 0,r.pendingValue=void 0,r.state={originalValue:"",value:""},r.onBlur=function(){r.setState({value:""+r.state.originalValue}),r.props.onBlur&&r.props.onBlur()},r.raiseOnChange=function(){r.pendingValue!==void 0&&(r.props.onChange(r.pendingValue),r.pendingValue=void 0)},r.onChange=function(n){var i=n.target.value,a=r.props.isValid&&!r.props.isValid(i)||r.props.numeric&&Number.isNaN(+i);if(a){r.clearTimeout(),r.setState({value:i});return}if(r.props.numeric)r.setState({value:i},function(){return r.triggerChanged(i,+i)});else{var o=(r.props.toValue||Q8)(i),s=(r.props.fromValue||Q8)(o);r.setState({value:s},function(){return r.triggerChanged(s,o)})}},r.onKeyUp=function(n){(n.charCode===27||n.keyCode===27||n.key==="Escape")&&r.props.blurOnEscape&&r.input.current&&r.input.current.blur()},r.onKeyPress=function(n){(n.keyCode===13||n.charCode===13||n.key==="Enter")&&(r.isPending&&(r.clearTimeout(),r.raiseOnChange()),r.props.blurOnEnter&&r.input.current&&r.input.current.blur(),r.props.onEnter&&r.props.onEnter()),n.stopPropagation()},r}return Object.defineProperty(t.prototype,"isPending",{get:function(){return typeof this.delayHandle<"u"},enumerable:!1,configurable:!0}),t.prototype.clearTimeout=function(){this.isPending&&(clearTimeout(this.delayHandle),this.delayHandle=void 0)},t.prototype.triggerChanged=function(r,n){this.clearTimeout(),r!==this.state.originalValue&&(this.props.delayMs?(this.pendingValue=n,this.delayHandle=setTimeout(this.raiseOnChange,this.props.delayMs)):this.props.onChange(n))},t.getDerivedStateFromProps=function(r,n){var i=r.fromValue?r.fromValue(r.value):r.value;return i===n.originalValue?null:{originalValue:i,value:i}},t.prototype.render=function(){return T.jsx("input",{type:"text",className:this.props.className,style:this.props.style,ref:this.input,onBlur:this.onBlur,value:this.state.value,placeholder:this.props.placeholder,onChange:this.onChange,onKeyPress:this.props.onEnter||this.props.blurOnEnter||this.props.blurOnEscape?this.onKeyPress:void 0,onKeyDown:this.props.blurOnEscape?this.onKeyUp:void 0,disabled:!!this.props.isDisabled},void 0)},t}(Ve.PureComponent),aAe=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isExpanded:!1},r.toggleExpanded=function(){return r.setState({isExpanded:!r.state.isExpanded})},r}return t.prototype.render=function(){var r=this.props,n=r.label,i=r.pivot,a=r.controls;return T.jsxs(T.Fragment,{children:[T.jsx(Ns,E({label:T.jsxs(T.Fragment,{children:[n,T.jsx("button",E({className:"msp-btn-link msp-btn-icon msp-control-group-expander",onClick:this.toggleExpanded,title:(this.state.isExpanded?"Less":"More")+" options",style:{background:"transparent",textAlign:"left",padding:"0"}},{children:T.jsx(nn,{svg:this.state.isExpanded?AM:Gg,style:{display:"inline-block"}},void 0)}),void 0)]},void 0),control:i},{children:this.props.colorStripe&&T.jsx("div",{className:"msp-expandable-group-color-stripe",style:{backgroundColor:at.toStyle(this.props.colorStripe)}},void 0)}),void 0),this.state.isExpanded&&T.jsx("div",E({className:"msp-control-offset"},{children:a}),void 0)]},void 0)},t}(Ve.Component);function hc(e){return T.jsxs("div",E({className:"msp-section-header"+(e.accent?" msp-transform-header-brand-"+e.accent:"")},{children:[e.icon&&T.jsx(nn,{svg:e.icon},void 0),e.title," ",T.jsx("small",{children:e.desc},void 0)]}),void 0)}function hr(e){var t="msp-btn";e.inline||(t+=" msp-btn-block"),e.noOverflow&&(t+=" msp-no-overflow"),e.flex&&(t+=" msp-flex-item"),(e.commit==="on"||e.commit)&&(t+=" msp-btn-commit msp-btn-commit-on"),e.commit==="off"&&(t+=" msp-btn-commit msp-btn-commit-off"),e.children||(t+=" msp-btn-childless"),e.className&&(t+=" "+e.className);var r=void 0;return e.flex&&(typeof e.flex=="number"?r={flex:"0 0 "+e.flex+"px",padding:0,maxWidth:e.flex+"px"}:typeof e.flex=="string"&&(r={flex:"0 0 "+e.flex,padding:0,maxWidth:e.flex})),e.style&&(r?Object.assign(r,e.style):r=e.style),T.jsxs("button",E({onClick:e.onClick,title:e.title,disabled:e.disabled,style:r,className:t,"data-id":e["data-id"],"data-color":e["data-color"],onContextMenu:e.onContextMenu,onMouseEnter:e.onMouseEnter,onMouseLeave:e.onMouseLeave},{children:[e.icon&&T.jsx(nn,{svg:e.icon},void 0),e.children]}),void 0)}function Ht(e){var t="msp-btn msp-btn-icon"+(e.small?"-small":"")+(e.className?" "+e.className:"");typeof e.toggleState<"u"&&(t+=" msp-btn-link-toggle-"+(e.toggleState?"on":"off")),e.transparent&&(t+=" msp-transparent-bg");var r=void 0;return e.flex&&(typeof e.flex=="boolean"?r={flex:"0 0 32px",padding:0}:typeof e.flex=="number"?r={flex:"0 0 "+e.flex+"px",padding:0,maxWidth:e.flex+"px"}:r={flex:"0 0 "+e.flex,padding:0,maxWidth:e.flex}),e.style&&(r?Object.assign(r,e.style):r=e.style),T.jsxs("button",E({className:t,onClick:e.onClick,title:e.title,disabled:e.disabled,"data-id":e["data-id"],style:r},{children:[e.svg&&T.jsx(nn,{svg:e.svg},void 0),e.extraContent]}),void 0)}var Ai=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.onClick=function(n){n.currentTarget.blur(),r.props.toggle()},r}return t.prototype.render=function(){var r=this.props,n=r.label,i=r.isSelected?(r.className||"")+" msp-control-current":r.className;return T.jsx(hr,E({icon:this.props.icon,onClick:this.onClick,title:this.props.title,inline:this.props.inline,disabled:r.disabled,style:r.style,className:i},{children:n&&this.props.isSelected?T.jsx("b",{children:n},void 0):n}),void 0)},t}(Ve.PureComponent),Tu=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isExpanded:!!r.props.initiallyExpanded},r.toggleExpanded=function(){return r.setState({isExpanded:!r.state.isExpanded})},r}return t.prototype.render=function(){return T.jsxs(T.Fragment,{children:[T.jsx("div",E({className:"msp-control-group-header",style:{marginTop:this.props.marginTop!==void 0?this.props.marginTop:"1px",marginLeft:this.props.headerLeftMargin}},{children:T.jsxs("button",E({className:"msp-btn msp-form-control msp-btn-block",onClick:this.toggleExpanded,style:this.props.headerStyle},{children:[T.jsx(nn,{svg:this.state.isExpanded?Rc:kc},void 0),this.props.header]}),void 0)}),void 0),this.state.isExpanded&&(this.props.noOffset?this.props.children:T.jsx("div",E({className:this.props.accent?"msp-accent-offset":"msp-control-offset"},{children:this.props.children}),void 0))]},void 0)},t}(Ve.PureComponent);function Ns(e){var t="msp-control-row";return e.className&&(t+=" "+e.className),T.jsxs("div",E({className:t},{children:[T.jsx("span",E({className:"msp-control-row-label",title:e.title},{children:e.label}),void 0),T.jsx("div",E({className:"msp-control-row-ctrl"},{children:e.control}),void 0),e.children]}),void 0)}var v3=Ve.createContext(void 0),pr=function(e){Le(t,e);function t(r,n){var i=e.call(this,r)||this;return i.subs=void 0,i.plugin=n,i.init&&i.init(),i}return t.prototype.subscribe=function(r,n){typeof this.subs>"u"&&(this.subs=[]),this.subs.push(r.subscribe(n))},t.prototype.componentWillUnmount=function(){if(this.subs){for(var r=0,n=this.subs;r<n.length;r++){var i=n[r];i.unsubscribe()}this.subs=void 0}},t.contextType=v3,t}(Ve.Component),Gi=function(e){Le(t,e);function t(r,n){var i=e.call(this,r,n)||this;return i.subs=void 0,i.plugin=n,i.init&&i.init(),i}return t.prototype.subscribe=function(r,n){typeof this.subs>"u"&&(this.subs=[]),this.subs.push(r.subscribe(n))},t.prototype.componentWillUnmount=function(){if(this.subs){for(var r=0,n=this.subs;r<n.length;r++){var i=n[r];i.unsubscribe()}this.subs=void 0}},t.contextType=v3,t}(Ve.PureComponent),Wg=function(e){Le(t,e);function t(r,n){var i=e.call(this,r,n)||this;i.toggleCollapsed=function(){i.setState({isCollapsed:!i.state.isCollapsed})};var a=i.defaultState();return r.initiallyCollapsed!==void 0&&(a.isCollapsed=r.initiallyCollapsed),r.header!==void 0&&(a.header=r.header),i.state=a,i}return t.prototype.componentDidUpdate=function(r){this.props.initiallyCollapsed!==void 0&&r.initiallyCollapsed!==this.props.initiallyCollapsed&&this.setState({isCollapsed:this.props.initiallyCollapsed})},t.prototype.render=function(){var r;if(this.state.isHidden)return null;var n=this.state.isCollapsed?"msp-transform-wrapper msp-transform-wrapper-collapsed":"msp-transform-wrapper";return T.jsxs("div",E({className:n},{children:[T.jsx("div",E({className:"msp-transform-header"},{children:T.jsxs(hr,E({icon:this.state.brand?void 0:this.state.isCollapsed?kc:Rc,noOverflow:!0,onClick:this.toggleCollapsed,className:this.state.brand?"msp-transform-header-brand msp-transform-header-brand-"+this.state.brand.accent:void 0,title:"Click to "+(this.state.isCollapsed?"expand":"collapse")},{children:[T.jsx(nn,{svg:(r=this.state.brand)===null||r===void 0?void 0:r.svg,inline:!0},void 0),this.state.header,T.jsx("small",E({style:{margin:"0 6px"}},{children:this.state.isCollapsed?"":this.state.description}),void 0)]}),void 0)}),void 0),!this.state.isCollapsed&&this.renderControls()]}),void 0)},t}(pr),In;(function(e){function t(){return function(i){return r(i)}}e.factory=t;function r(i){var a;return a=function(){function o(s,u){this.data=s,this.id=dn.create22(),this.type=i,this.label=u&&u.label||i.name,this.description=u&&u.description}return o.is=function(s){return!!s&&i===s.type},o}(),a.type=i,a}e.create=r;function n(i,a){if(!i.tags)return!1;for(var o=0,s=i.tags;o<s.length;o++){var u=s[o];if(u===a)return!0}return!1}e.hasTag=n,e.Null={id:dn.create22(),type:{name:"Null",typeClass:"Null"},data:void 0,label:"Null"}})(In||(In={}));var U1;(function(e){function t(n){var i=n;return!!i&&!!i.transform&&!!i.parent&&!!i.status}e.is=t;function r(n,i){var a=typeof i=="string"?i:e.is(i)?i.transform.ref:i.ref;return n.cells.get(a)}e.resolve=r})(U1||(U1={}));var MY=function(){function e(t,r){this.ref=t,this.state=r}return Object.defineProperty(e.prototype,"cell",{get:function(){var t;return(t=this.state)===null||t===void 0?void 0:t.cells.get(this.ref)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"obj",{get:function(){var t,r;return(r=(t=this.state)===null||t===void 0?void 0:t.cells.get(this.ref))===null||r===void 0?void 0:r.obj},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"data",{get:function(){var t;return(t=this.obj)===null||t===void 0?void 0:t.data},enumerable:!1,configurable:!0}),e.prototype.update=function(t,r){if(!this.state)throw new Error("To use update() from StateObjectSelector, 'state' must be defined.");return r||(r=this.state.build()),(r||this.state.build()).to(this).update(t),r},e.prototype.checkValid=function(){if(!this.state)throw new Error("Unassigned State.");var t=this.cell;if(!t)throw new Error("Not created at all. Did you await/then the corresponding state update?");if(t.status==="ok")return!0;throw t.status==="error"?new Error(t.errorText):t.obj===In.Null?new Error("The object is Null."):new Error("Unresolved. Did you await/then the corresponding state update?")},Object.defineProperty(e.prototype,"isOk",{get:function(){var t=this.cell;return t&&t.status==="ok"&&t.obj!==In.Null},enumerable:!1,configurable:!0}),e}(),Ii;(function(e){function t(i){var a;if(i)return typeof i=="string"?i:U1.is(i)?i.transform.ref:(a=i.cell)===null||a===void 0?void 0:a.transform.ref}e.resolveRef=t;function r(i,a){if(a)return U1.is(a)?a:typeof a=="string"?i.cells.get(a):a.cell}e.resolve=r;function n(i,a){var o=r(i,a);if(!(!o||!o.obj||o.status!=="ok"))return o}e.resolveAndCheck=n})(Ii||(Ii={}));var DY={exports:{}};(function(e,t){(function(r,n){e.exports=n()})($h,function(){var r=Array.prototype.slice;function n(P,F){F&&(P.prototype=Object.create(F.prototype)),P.prototype.constructor=P}function i(P){return u(P)?P:be(P)}n(a,i);function a(P){return l(P)?P:Ee(P)}n(o,i);function o(P){return c(P)?P:Se(P)}n(s,i);function s(P){return u(P)&&!d(P)?P:ie(P)}function u(P){return!!(P&&P[h])}function l(P){return!!(P&&P[v])}function c(P){return!!(P&&P[p])}function d(P){return l(P)||c(P)}function f(P){return!!(P&&P[m])}i.isIterable=u,i.isKeyed=l,i.isIndexed=c,i.isAssociative=d,i.isOrdered=f,i.Keyed=a,i.Indexed=o,i.Set=s;var h="@@__IMMUTABLE_ITERABLE__@@",v="@@__IMMUTABLE_KEYED__@@",p="@@__IMMUTABLE_INDEXED__@@",m="@@__IMMUTABLE_ORDERED__@@",g="delete",y=5,b=1<<y,S=b-1,x={},C={value:!1},w={value:!1};function A(P){return P.value=!1,P}function M(P){P&&(P.value=!0)}function D(){}function k(P,F){F=F||0;for(var K=Math.max(0,P.length-F),re=new Array(K),ae=0;ae<K;ae++)re[ae]=P[ae+F];return re}function R(P){return P.size===void 0&&(P.size=P.__iterate(H)),P.size}function L(P,F){if(typeof F!="number"){var K=F>>>0;if(""+K!==F||K===4294967295)return NaN;F=K}return F<0?R(P)+F:F}function H(){return!0}function B(P,F,K){return(P===0||K!==void 0&&P<=-K)&&(F===void 0||K!==void 0&&F>=K)}function j(P,F){return G(P,F,0)}function Q(P,F){return G(P,F,F)}function G(P,F,K){return P===void 0?K:P<0?Math.max(0,F+P):F===void 0?P:Math.min(F,P)}var W=0,q=1,ee=2,he=typeof Symbol=="function"&&Symbol.iterator,$="@@iterator",X=he||$;function U(P){this.next=P}U.prototype.toString=function(){return"[Iterator]"},U.KEYS=W,U.VALUES=q,U.ENTRIES=ee,U.prototype.inspect=U.prototype.toSource=function(){return this.toString()},U.prototype[X]=function(){return this};function z(P,F,K,re){var ae=P===0?F:P===1?K:[F,K];return re?re.value=ae:re={value:ae,done:!1},re}function J(){return{value:void 0,done:!0}}function Y(P){return!!le(P)}function Z(P){return P&&typeof P.next=="function"}function te(P){var F=le(P);return F&&F.call(P)}function le(P){var F=P&&(he&&P[he]||P[$]);if(typeof F=="function")return F}function ye(P){return P&&typeof P.length=="number"}n(be,i);function be(P){return P==null?ze():u(P)?P.toSeq():Ne(P)}be.of=function(){return be(arguments)},be.prototype.toSeq=function(){return this},be.prototype.toString=function(){return this.__toString("Seq {","}")},be.prototype.cacheResult=function(){return!this._cache&&this.__iterateUncached&&(this._cache=this.entrySeq().toArray(),this.size=this._cache.length),this},be.prototype.__iterate=function(P,F){return it(this,P,F,!0)},be.prototype.__iterator=function(P,F){return ot(this,P,F,!0)},n(Ee,be);function Ee(P){return P==null?ze().toKeyedSeq():u(P)?l(P)?P.toSeq():P.fromEntrySeq():Xe(P)}Ee.prototype.toKeyedSeq=function(){return this},n(Se,be);function Se(P){return P==null?ze():u(P)?l(P)?P.entrySeq():P.toIndexedSeq():ct(P)}Se.of=function(){return Se(arguments)},Se.prototype.toIndexedSeq=function(){return this},Se.prototype.toString=function(){return this.__toString("Seq [","]")},Se.prototype.__iterate=function(P,F){return it(this,P,F,!1)},Se.prototype.__iterator=function(P,F){return ot(this,P,F,!1)},n(ie,be);function ie(P){return(P==null?ze():u(P)?l(P)?P.entrySeq():P:ct(P)).toSetSeq()}ie.of=function(){return ie(arguments)},ie.prototype.toSetSeq=function(){return this},be.isSeq=Pe,be.Keyed=Ee,be.Set=ie,be.Indexed=Se;var oe="@@__IMMUTABLE_SEQ__@@";be.prototype[oe]=!0,n(O,Se);function O(P){this._array=P,this.size=P.length}O.prototype.get=function(P,F){return this.has(P)?this._array[L(this,P)]:F},O.prototype.__iterate=function(P,F){for(var K=this._array,re=K.length-1,ae=0;ae<=re;ae++)if(P(K[F?re-ae:ae],ae,this)===!1)return ae+1;return ae},O.prototype.__iterator=function(P,F){var K=this._array,re=K.length-1,ae=0;return new U(function(){return ae>re?J():z(P,ae,K[F?re-ae++:ae++])})},n(V,Ee);function V(P){var F=Object.keys(P);this._object=P,this._keys=F,this.size=F.length}V.prototype.get=function(P,F){return F!==void 0&&!this.has(P)?F:this._object[P]},V.prototype.has=function(P){return this._object.hasOwnProperty(P)},V.prototype.__iterate=function(P,F){for(var K=this._object,re=this._keys,ae=re.length-1,xe=0;xe<=ae;xe++){var Ae=re[F?ae-xe:xe];if(P(K[Ae],Ae,this)===!1)return xe+1}return xe},V.prototype.__iterator=function(P,F){var K=this._object,re=this._keys,ae=re.length-1,xe=0;return new U(function(){var Ae=re[F?ae-xe:xe];return xe++>ae?J():z(P,Ae,K[Ae])})},V.prototype[m]=!0,n(pe,Se);function pe(P){this._iterable=P,this.size=P.length||P.size}pe.prototype.__iterateUncached=function(P,F){if(F)return this.cacheResult().__iterate(P,F);var K=this._iterable,re=te(K),ae=0;if(Z(re))for(var xe;!(xe=re.next()).done&&P(xe.value,ae++,this)!==!1;);return ae},pe.prototype.__iteratorUncached=function(P,F){if(F)return this.cacheResult().__iterator(P,F);var K=this._iterable,re=te(K);if(!Z(re))return new U(J);var ae=0;return new U(function(){var xe=re.next();return xe.done?xe:z(P,ae++,xe.value)})},n(_e,Se);function _e(P){this._iterator=P,this._iteratorCache=[]}_e.prototype.__iterateUncached=function(P,F){if(F)return this.cacheResult().__iterate(P,F);for(var K=this._iterator,re=this._iteratorCache,ae=0;ae<re.length;)if(P(re[ae],ae++,this)===!1)return ae;for(var xe;!(xe=K.next()).done;){var Ae=xe.value;if(re[ae]=Ae,P(Ae,ae++,this)===!1)break}return ae},_e.prototype.__iteratorUncached=function(P,F){if(F)return this.cacheResult().__iterator(P,F);var K=this._iterator,re=this._iteratorCache,ae=0;return new U(function(){if(ae>=re.length){var xe=K.next();if(xe.done)return xe;re[ae]=xe.value}return z(P,ae,re[ae++])})};function Pe(P){return!!(P&&P[oe])}var je;function ze(){return je||(je=new O([]))}function Xe(P){var F=Array.isArray(P)?new O(P).fromEntrySeq():Z(P)?new _e(P).fromEntrySeq():Y(P)?new pe(P).fromEntrySeq():typeof P=="object"?new V(P):void 0;if(!F)throw new TypeError("Expected Array or iterable object of [k, v] entries, or keyed object: "+P);return F}function ct(P){var F=Qe(P);if(!F)throw new TypeError("Expected Array or iterable object of values: "+P);return F}function Ne(P){var F=Qe(P)||typeof P=="object"&&new V(P);if(!F)throw new TypeError("Expected Array or iterable object of values, or keyed object: "+P);return F}function Qe(P){return ye(P)?new O(P):Z(P)?new _e(P):Y(P)?new pe(P):void 0}function it(P,F,K,re){var ae=P._cache;if(ae){for(var xe=ae.length-1,Ae=0;Ae<=xe;Ae++){var Be=ae[K?xe-Ae:Ae];if(F(Be[1],re?Be[0]:Ae,P)===!1)return Ae+1}return Ae}return P.__iterateUncached(F,K)}function ot(P,F,K,re){var ae=P._cache;if(ae){var xe=ae.length-1,Ae=0;return new U(function(){var Be=ae[K?xe-Ae:Ae];return Ae++>xe?J():z(F,re?Be[0]:Ae-1,Be[1])})}return P.__iteratorUncached(F,K)}function dt(P,F){return F?Re(F,P,"",{"":P}):Ie(P)}function Re(P,F,K,re){return Array.isArray(F)?P.call(re,K,Se(F).map(function(ae,xe){return Re(P,ae,xe,F)})):Ye(F)?P.call(re,K,Ee(F).map(function(ae,xe){return Re(P,ae,xe,F)})):F}function Ie(P){return Array.isArray(P)?Se(P).map(Ie).toList():Ye(P)?Ee(P).map(Ie).toMap():P}function Ye(P){return P&&(P.constructor===Object||P.constructor===void 0)}function tt(P,F){if(P===F||P!==P&&F!==F)return!0;if(!P||!F)return!1;if(typeof P.valueOf=="function"&&typeof F.valueOf=="function"){if(P=P.valueOf(),F=F.valueOf(),P===F||P!==P&&F!==F)return!0;if(!P||!F)return!1}return!!(typeof P.equals=="function"&&typeof F.equals=="function"&&P.equals(F))}function xt(P,F){if(P===F)return!0;if(!u(F)||P.size!==void 0&&F.size!==void 0&&P.size!==F.size||P.__hash!==void 0&&F.__hash!==void 0&&P.__hash!==F.__hash||l(P)!==l(F)||c(P)!==c(F)||f(P)!==f(F))return!1;if(P.size===0&&F.size===0)return!0;var K=!d(P);if(f(P)){var re=P.entries();return F.every(function(et,st){var yt=re.next().value;return yt&&tt(yt[1],et)&&(K||tt(yt[0],st))})&&re.next().done}var ae=!1;if(P.size===void 0)if(F.size===void 0)typeof P.cacheResult=="function"&&P.cacheResult();else{ae=!0;var xe=P;P=F,F=xe}var Ae=!0,Be=F.__iterate(function(et,st){if(K?!P.has(et):ae?!tt(et,P.get(st,x)):!tt(P.get(st,x),et))return Ae=!1,!1});return Ae&&P.size===Be}n(pt,Se);function pt(P,F){if(!(this instanceof pt))return new pt(P,F);if(this._value=P,this.size=F===void 0?1/0:Math.max(0,F),this.size===0){if(ut)return ut;ut=this}}pt.prototype.toString=function(){return this.size===0?"Repeat []":"Repeat [ "+this._value+" "+this.size+" times ]"},pt.prototype.get=function(P,F){return this.has(P)?this._value:F},pt.prototype.includes=function(P){return tt(this._value,P)},pt.prototype.slice=function(P,F){var K=this.size;return B(P,F,K)?this:new pt(this._value,Q(F,K)-j(P,K))},pt.prototype.reverse=function(){return this},pt.prototype.indexOf=function(P){return tt(this._value,P)?0:-1},pt.prototype.lastIndexOf=function(P){return tt(this._value,P)?this.size:-1},pt.prototype.__iterate=function(P,F){for(var K=0;K<this.size;K++)if(P(this._value,K,this)===!1)return K+1;return K},pt.prototype.__iterator=function(P,F){var K=this,re=0;return new U(function(){return re<K.size?z(P,re++,K._value):J()})},pt.prototype.equals=function(P){return P instanceof pt?tt(this._value,P._value):xt(P)};var ut;function fe(P,F){if(!P)throw new Error(F)}n(me,Se);function me(P,F,K){if(!(this instanceof me))return new me(P,F,K);if(fe(K!==0,"Cannot step a Range by 0"),P=P||0,F===void 0&&(F=1/0),K=K===void 0?1:Math.abs(K),F<P&&(K=-K),this._start=P,this._end=F,this._step=K,this.size=Math.max(0,Math.ceil((F-P)/K-1)+1),this.size===0){if(we)return we;we=this}}me.prototype.toString=function(){return this.size===0?"Range []":"Range [ "+this._start+"..."+this._end+(this._step!==1?" by "+this._step:"")+" ]"},me.prototype.get=function(P,F){return this.has(P)?this._start+L(this,P)*this._step:F},me.prototype.includes=function(P){var F=(P-this._start)/this._step;return F>=0&&F<this.size&&F===Math.floor(F)},me.prototype.slice=function(P,F){return B(P,F,this.size)?this:(P=j(P,this.size),F=Q(F,this.size),F<=P?new me(0,0):new me(this.get(P,this._end),this.get(F,this._end),this._step))},me.prototype.indexOf=function(P){var F=P-this._start;if(F%this._step===0){var K=F/this._step;if(K>=0&&K<this.size)return K}return-1},me.prototype.lastIndexOf=function(P){return this.indexOf(P)},me.prototype.__iterate=function(P,F){for(var K=this.size-1,re=this._step,ae=F?this._start+K*re:this._start,xe=0;xe<=K;xe++){if(P(ae,xe,this)===!1)return xe+1;ae+=F?-re:re}return xe},me.prototype.__iterator=function(P,F){var K=this.size-1,re=this._step,ae=F?this._start+K*re:this._start,xe=0;return new U(function(){var Ae=ae;return ae+=F?-re:re,xe>K?J():z(P,xe++,Ae)})},me.prototype.equals=function(P){return P instanceof me?this._start===P._start&&this._end===P._end&&this._step===P._step:xt(this,P)};var we;n(Ke,i);function Ke(){throw TypeError("Abstract")}n(gt,Ke);function gt(){}n(Pt,Ke);function Pt(){}n($t,Ke);function $t(){}Ke.Keyed=gt,Ke.Indexed=Pt,Ke.Set=$t;var lr=typeof Math.imul=="function"&&Math.imul(4294967295,2)===-2?Math.imul:function(F,K){F=F|0,K=K|0;var re=F&65535,ae=K&65535;return re*ae+((F>>>16)*ae+re*(K>>>16)<<16>>>0)|0};function Er(P){return P>>>1&1073741824|P&3221225471}function Yt(P){if(P===!1||P===null||P===void 0||typeof P.valueOf=="function"&&(P=P.valueOf(),P===!1||P===null||P===void 0))return 0;if(P===!0)return 1;var F=typeof P;if(F==="number"){if(P!==P||P===1/0)return 0;var K=P|0;for(K!==P&&(K^=P*4294967295);P>4294967295;)P/=4294967295,K^=P;return Er(K)}if(F==="string")return P.length>yd?ei(P):$i(P);if(typeof P.hashCode=="function")return P.hashCode();if(F==="object")return Xi(P);if(typeof P.toString=="function")return $i(P.toString());throw new Error("Value type "+F+" cannot be hashed.")}function ei(P){var F=vh[P];return F===void 0&&(F=$i(P),ph===Yb&&(ph=0,vh={}),ph++,vh[P]=F),F}function $i(P){for(var F=0,K=0;K<P.length;K++)F=31*F+P.charCodeAt(K)|0;return Er(F)}function Xi(P){var F;if(qs&&(F=fh.get(P),F!==void 0)||(F=P[eo],F!==void 0)||!Nu&&(F=P.propertyIsEnumerable&&P.propertyIsEnumerable[eo],F!==void 0||(F=kl(P),F!==void 0)))return F;if(F=++hh,hh&1073741824&&(hh=0),qs)fh.set(P,F);else{if(wo!==void 0&&wo(P)===!1)throw new Error("Non-extensible objects are not allowed as keys.");if(Nu)Object.defineProperty(P,eo,{enumerable:!1,configurable:!1,writable:!1,value:F});else if(P.propertyIsEnumerable!==void 0&&P.propertyIsEnumerable===P.constructor.prototype.propertyIsEnumerable)P.propertyIsEnumerable=function(){return this.constructor.prototype.propertyIsEnumerable.apply(this,arguments)},P.propertyIsEnumerable[eo]=F;else if(P.nodeType!==void 0)P[eo]=F;else throw new Error("Unable to set a non-enumerable property on object.")}return F}var wo=Object.isExtensible,Nu=function(){try{return Object.defineProperty({},"@",{}),!0}catch{return!1}}();function kl(P){if(P&&P.nodeType>0)switch(P.nodeType){case 1:return P.uniqueID;case 9:return P.documentElement&&P.documentElement.uniqueID}}var qs=typeof WeakMap=="function",fh;qs&&(fh=new WeakMap);var hh=0,eo="__immutablehash__";typeof Symbol=="function"&&(eo=Symbol(eo));var yd=16,Yb=255,ph=0,vh={};function Ba(P){fe(P!==1/0,"Cannot perform this action with an infinite size.")}n(Kr,gt);function Kr(P){return P==null?Ws():xE(P)&&!f(P)?P:Ws().withMutations(function(F){var K=a(P);Ba(K.size),K.forEach(function(re,ae){return F.set(ae,re)})})}Kr.of=function(){var P=r.call(arguments,0);return Ws().withMutations(function(F){for(var K=0;K<P.length;K+=2){if(K+1>=P.length)throw new Error("Missing value for key: "+P[K]);F.set(P[K],P[K+1])}})},Kr.prototype.toString=function(){return this.__toString("Map {","}")},Kr.prototype.get=function(P,F){return this._root?this._root.get(0,void 0,P,F):F},Kr.prototype.set=function(P,F){return QL(this,P,F)},Kr.prototype.setIn=function(P,F){return this.updateIn(P,x,function(){return F})},Kr.prototype.remove=function(P){return QL(this,P,x)},Kr.prototype.deleteIn=function(P){return this.updateIn(P,function(){return x})},Kr.prototype.update=function(P,F,K){return arguments.length===1?P(this):this.updateIn([P],F,K)},Kr.prototype.updateIn=function(P,F,K){K||(K=F,F=void 0);var re=r6(this,_6(P),F,K);return re===x?void 0:re},Kr.prototype.clear=function(){return this.size===0?this:this.__ownerID?(this.size=0,this._root=null,this.__hash=void 0,this.__altered=!0,this):Ws()},Kr.prototype.merge=function(){return Kb(this,void 0,arguments)},Kr.prototype.mergeWith=function(P){var F=r.call(arguments,1);return Kb(this,P,F)},Kr.prototype.mergeIn=function(P){var F=r.call(arguments,1);return this.updateIn(P,Ws(),function(K){return typeof K.merge=="function"?K.merge.apply(K,F):F[F.length-1]})},Kr.prototype.mergeDeep=function(){return Kb(this,JL,arguments)},Kr.prototype.mergeDeepWith=function(P){var F=r.call(arguments,1);return Kb(this,e6(P),F)},Kr.prototype.mergeDeepIn=function(P){var F=r.call(arguments,1);return this.updateIn(P,Ws(),function(K){return typeof K.mergeDeep=="function"?K.mergeDeep.apply(K,F):F[F.length-1]})},Kr.prototype.sort=function(P){return mi(Lv(this,P))},Kr.prototype.sortBy=function(P,F){return mi(Lv(this,F,P))},Kr.prototype.withMutations=function(P){var F=this.asMutable();return P(F),F.wasAltered()?F.__ensureOwner(this.__ownerID):this},Kr.prototype.asMutable=function(){return this.__ownerID?this:this.__ensureOwner(new D)},Kr.prototype.asImmutable=function(){return this.__ensureOwner()},Kr.prototype.wasAltered=function(){return this.__altered},Kr.prototype.__iterator=function(P,F){return new SE(this,P,F)},Kr.prototype.__iterate=function(P,F){var K=this,re=0;return this._root&&this._root.iterate(function(ae){return re++,P(ae[1],ae[0],K)},F),re},Kr.prototype.__ensureOwner=function(P){return P===this.__ownerID?this:P?_E(this.size,this._root,P,this.__hash):(this.__ownerID=P,this.__altered=!1,this)};function xE(P){return!!(P&&P[XL])}Kr.isMap=xE;var XL="@@__IMMUTABLE_MAP__@@",Hr=Kr.prototype;Hr[XL]=!0,Hr[g]=Hr.remove,Hr.removeIn=Hr.deleteIn;function l0(P,F){this.ownerID=P,this.entries=F}l0.prototype.get=function(P,F,K,re){for(var ae=this.entries,xe=0,Ae=ae.length;xe<Ae;xe++)if(tt(K,ae[xe][0]))return ae[xe][1];return re},l0.prototype.update=function(P,F,K,re,ae,xe,Ae){for(var Be=ae===x,et=this.entries,st=0,yt=et.length;st<yt&&!tt(re,et[st][0]);st++);var Lt=st<yt;if(Lt?et[st][1]===ae:Be)return this;if(M(Ae),(Be||!Lt)&&M(xe),!(Be&&et.length===1)){if(!Lt&&!Be&&et.length>=cie)return aie(P,et,re,ae);var Gt=P&&P===this.ownerID,xr=Gt?et:k(et);return Lt?Be?st===yt-1?xr.pop():xr[st]=xr.pop():xr[st]=[re,ae]:xr.push([re,ae]),Gt?(this.entries=xr,this):new l0(P,xr)}};function Iv(P,F,K){this.ownerID=P,this.bitmap=F,this.nodes=K}Iv.prototype.get=function(P,F,K,re){F===void 0&&(F=Yt(K));var ae=1<<((P===0?F:F>>>P)&S),xe=this.bitmap;return xe&ae?this.nodes[n6(xe&ae-1)].get(P+y,F,K,re):re},Iv.prototype.update=function(P,F,K,re,ae,xe,Ae){K===void 0&&(K=Yt(re));var Be=(F===0?K:K>>>F)&S,et=1<<Be,st=this.bitmap,yt=(st&et)!==0;if(!yt&&ae===x)return this;var Lt=n6(st&et-1),Gt=this.nodes,xr=yt?Gt[Lt]:void 0,jr=wE(xr,P,F+y,K,re,ae,xe,Ae);if(jr===xr)return this;if(!yt&&jr&&Gt.length>=die)return sie(P,Gt,st,Be,jr);if(yt&&!jr&&Gt.length===2&&ZL(Gt[Lt^1]))return Gt[Lt^1];if(yt&&jr&&Gt.length===1&&ZL(jr))return jr;var qn=P&&P===this.ownerID,$s=yt?jr?st:st^et:st|et,ju=yt?jr?i6(Gt,Lt,jr,qn):lie(Gt,Lt,qn):uie(Gt,Lt,jr,qn);return qn?(this.bitmap=$s,this.nodes=ju,this):new Iv(P,$s,ju)};function c0(P,F,K){this.ownerID=P,this.count=F,this.nodes=K}c0.prototype.get=function(P,F,K,re){F===void 0&&(F=Yt(K));var ae=(P===0?F:F>>>P)&S,xe=this.nodes[ae];return xe?xe.get(P+y,F,K,re):re},c0.prototype.update=function(P,F,K,re,ae,xe,Ae){K===void 0&&(K=Yt(re));var Be=(F===0?K:K>>>F)&S,et=ae===x,st=this.nodes,yt=st[Be];if(et&&!yt)return this;var Lt=wE(yt,P,F+y,K,re,ae,xe,Ae);if(Lt===yt)return this;var Gt=this.count;if(!yt)Gt++;else if(!Lt&&(Gt--,Gt<fie))return oie(P,st,Gt,Be);var xr=P&&P===this.ownerID,jr=i6(st,Be,Lt,xr);return xr?(this.count=Gt,this.nodes=jr,this):new c0(P,Gt,jr)};function Mv(P,F,K){this.ownerID=P,this.keyHash=F,this.entries=K}Mv.prototype.get=function(P,F,K,re){for(var ae=this.entries,xe=0,Ae=ae.length;xe<Ae;xe++)if(tt(K,ae[xe][0]))return ae[xe][1];return re},Mv.prototype.update=function(P,F,K,re,ae,xe,Ae){K===void 0&&(K=Yt(re));var Be=ae===x;if(K!==this.keyHash)return Be?this:(M(Ae),M(xe),EE(this,P,F,K,[re,ae]));for(var et=this.entries,st=0,yt=et.length;st<yt&&!tt(re,et[st][0]);st++);var Lt=st<yt;if(Lt?et[st][1]===ae:Be)return this;if(M(Ae),(Be||!Lt)&&M(xe),Be&&yt===2)return new Ol(P,this.keyHash,et[st^1]);var Gt=P&&P===this.ownerID,xr=Gt?et:k(et);return Lt?Be?st===yt-1?xr.pop():xr[st]=xr.pop():xr[st]=[re,ae]:xr.push([re,ae]),Gt?(this.entries=xr,this):new Mv(P,this.keyHash,xr)};function Ol(P,F,K){this.ownerID=P,this.keyHash=F,this.entry=K}Ol.prototype.get=function(P,F,K,re){return tt(K,this.entry[0])?this.entry[1]:re},Ol.prototype.update=function(P,F,K,re,ae,xe,Ae){var Be=ae===x,et=tt(re,this.entry[0]);if(et?ae===this.entry[1]:Be)return this;if(M(Ae),Be){M(xe);return}return et?P&&P===this.ownerID?(this.entry[1]=ae,this):new Ol(P,this.keyHash,[re,ae]):(M(xe),EE(this,P,F,Yt(re),[re,ae]))},l0.prototype.iterate=Mv.prototype.iterate=function(P,F){for(var K=this.entries,re=0,ae=K.length-1;re<=ae;re++)if(P(K[F?ae-re:re])===!1)return!1},Iv.prototype.iterate=c0.prototype.iterate=function(P,F){for(var K=this.nodes,re=0,ae=K.length-1;re<=ae;re++){var xe=K[F?ae-re:re];if(xe&&xe.iterate(P,F)===!1)return!1}},Ol.prototype.iterate=function(P,F){return P(this.entry)},n(SE,U);function SE(P,F,K){this._type=F,this._reverse=K,this._stack=P._root&&YL(P._root)}SE.prototype.next=function(){for(var P=this._type,F=this._stack;F;){var K=F.node,re=F.index++,ae;if(K.entry){if(re===0)return CE(P,K.entry)}else if(K.entries){if(ae=K.entries.length-1,re<=ae)return CE(P,K.entries[this._reverse?ae-re:re])}else if(ae=K.nodes.length-1,re<=ae){var xe=K.nodes[this._reverse?ae-re:re];if(xe){if(xe.entry)return CE(P,xe.entry);F=this._stack=YL(xe,F)}continue}F=this._stack=this._stack.__prev}return J()};function CE(P,F){return z(P,F[0],F[1])}function YL(P,F){return{node:P,index:0,__prev:F}}function _E(P,F,K,re){var ae=Object.create(Hr);return ae.size=P,ae._root=F,ae.__ownerID=K,ae.__hash=re,ae.__altered=!1,ae}var KL;function Ws(){return KL||(KL=_E(0))}function QL(P,F,K){var re,ae;if(P._root){var xe=A(C),Ae=A(w);if(re=wE(P._root,P.__ownerID,0,void 0,F,K,xe,Ae),!Ae.value)return P;ae=P.size+(xe.value?K===x?-1:1:0)}else{if(K===x)return P;ae=1,re=new l0(P.__ownerID,[[F,K]])}return P.__ownerID?(P.size=ae,P._root=re,P.__hash=void 0,P.__altered=!0,P):re?_E(ae,re):Ws()}function wE(P,F,K,re,ae,xe,Ae,Be){return P?P.update(F,K,re,ae,xe,Ae,Be):xe===x?P:(M(Be),M(Ae),new Ol(F,re,[ae,xe]))}function ZL(P){return P.constructor===Ol||P.constructor===Mv}function EE(P,F,K,re,ae){if(P.keyHash===re)return new Mv(F,re,[P.entry,ae]);var xe=(K===0?P.keyHash:P.keyHash>>>K)&S,Ae=(K===0?re:re>>>K)&S,Be,et=xe===Ae?[EE(P,F,K+y,re,ae)]:(Be=new Ol(F,re,ae),xe<Ae?[P,Be]:[Be,P]);return new Iv(F,1<<xe|1<<Ae,et)}function aie(P,F,K,re){P||(P=new D);for(var ae=new Ol(P,Yt(K),[K,re]),xe=0;xe<F.length;xe++){var Ae=F[xe];ae=ae.update(P,0,void 0,Ae[0],Ae[1])}return ae}function oie(P,F,K,re){for(var ae=0,xe=0,Ae=new Array(K),Be=0,et=1,st=F.length;Be<st;Be++,et<<=1){var yt=F[Be];yt!==void 0&&Be!==re&&(ae|=et,Ae[xe++]=yt)}return new Iv(P,ae,Ae)}function sie(P,F,K,re,ae){for(var xe=0,Ae=new Array(b),Be=0;K!==0;Be++,K>>>=1)Ae[Be]=K&1?F[xe++]:void 0;return Ae[re]=ae,new c0(P,xe+1,Ae)}function Kb(P,F,K){for(var re=[],ae=0;ae<K.length;ae++){var xe=K[ae],Ae=a(xe);u(xe)||(Ae=Ae.map(function(Be){return dt(Be)})),re.push(Ae)}return t6(P,F,re)}function JL(P,F,K){return P&&P.mergeDeep&&u(F)?P.mergeDeep(F):tt(P,F)?P:F}function e6(P){return function(F,K,re){if(F&&F.mergeDeepWith&&u(K))return F.mergeDeepWith(P,K);var ae=P(F,K,re);return tt(F,ae)?F:ae}}function t6(P,F,K){return K=K.filter(function(re){return re.size!==0}),K.length===0?P:P.size===0&&!P.__ownerID&&K.length===1?P.constructor(K[0]):P.withMutations(function(re){for(var ae=F?function(Ae,Be){re.update(Be,x,function(et){return et===x?Ae:F(et,Ae,Be)})}:function(Ae,Be){re.set(Be,Ae)},xe=0;xe<K.length;xe++)K[xe].forEach(ae)})}function r6(P,F,K,re){var ae=P===x,xe=F.next();if(xe.done){var Ae=ae?K:P,Be=re(Ae);return Be===Ae?P:Be}fe(ae||P&&P.set,"invalid keyPath");var et=xe.value,st=ae?x:P.get(et,x),yt=r6(st,F,K,re);return yt===st?P:yt===x?P.remove(et):(ae?Ws():P).set(et,yt)}function n6(P){return P=P-(P>>1&1431655765),P=(P&858993459)+(P>>2&858993459),P=P+(P>>4)&252645135,P=P+(P>>8),P=P+(P>>16),P&127}function i6(P,F,K,re){var ae=re?P:k(P);return ae[F]=K,ae}function uie(P,F,K,re){var ae=P.length+1;if(re&&F+1===ae)return P[F]=K,P;for(var xe=new Array(ae),Ae=0,Be=0;Be<ae;Be++)Be===F?(xe[Be]=K,Ae=-1):xe[Be]=P[Be+Ae];return xe}function lie(P,F,K){var re=P.length-1;if(K&&F===re)return P.pop(),P;for(var ae=new Array(re),xe=0,Ae=0;Ae<re;Ae++)Ae===F&&(xe=1),ae[Ae]=P[Ae+xe];return ae}var cie=b/4,die=b/2,fie=b/4;n(Ln,Pt);function Ln(P){var F=AE();if(P==null)return F;if(a6(P))return P;var K=o(P),re=K.size;return re===0?F:(Ba(re),re>0&&re<b?f0(0,re,y,null,new bd(K.toArray())):F.withMutations(function(ae){ae.setSize(re),K.forEach(function(xe,Ae){return ae.set(Ae,xe)})}))}Ln.of=function(){return this(arguments)},Ln.prototype.toString=function(){return this.__toString("List [","]")},Ln.prototype.get=function(P,F){if(P=L(this,P),P>=0&&P<this.size){P+=this._origin;var K=l6(this,P);return K&&K.array[P&S]}return F},Ln.prototype.set=function(P,F){return hie(this,P,F)},Ln.prototype.remove=function(P){return this.has(P)?P===0?this.shift():P===this.size-1?this.pop():this.splice(P,1):this},Ln.prototype.insert=function(P,F){return this.splice(P,0,F)},Ln.prototype.clear=function(){return this.size===0?this:this.__ownerID?(this.size=this._origin=this._capacity=0,this._level=y,this._root=this._tail=null,this.__hash=void 0,this.__altered=!0,this):AE()},Ln.prototype.push=function(){var P=arguments,F=this.size;return this.withMutations(function(K){xd(K,0,F+P.length);for(var re=0;re<P.length;re++)K.set(F+re,P[re])})},Ln.prototype.pop=function(){return xd(this,0,-1)},Ln.prototype.unshift=function(){var P=arguments;return this.withMutations(function(F){xd(F,-P.length);for(var K=0;K<P.length;K++)F.set(K,P[K])})},Ln.prototype.shift=function(){return xd(this,1)},Ln.prototype.merge=function(){return Qb(this,void 0,arguments)},Ln.prototype.mergeWith=function(P){var F=r.call(arguments,1);return Qb(this,P,F)},Ln.prototype.mergeDeep=function(){return Qb(this,JL,arguments)},Ln.prototype.mergeDeepWith=function(P){var F=r.call(arguments,1);return Qb(this,e6(P),F)},Ln.prototype.setSize=function(P){return xd(this,0,P)},Ln.prototype.slice=function(P,F){var K=this.size;return B(P,F,K)?this:xd(this,j(P,K),Q(F,K))},Ln.prototype.__iterator=function(P,F){var K=0,re=s6(this,F);return new U(function(){var ae=re();return ae===d0?J():z(P,K++,ae)})},Ln.prototype.__iterate=function(P,F){for(var K=0,re=s6(this,F),ae;(ae=re())!==d0&&P(ae,K++,this)!==!1;);return K},Ln.prototype.__ensureOwner=function(P){return P===this.__ownerID?this:P?f0(this._origin,this._capacity,this._level,this._root,this._tail,P,this.__hash):(this.__ownerID=P,this)};function a6(P){return!!(P&&P[o6])}Ln.isList=a6;var o6="@@__IMMUTABLE_LIST__@@",Ua=Ln.prototype;Ua[o6]=!0,Ua[g]=Ua.remove,Ua.setIn=Hr.setIn,Ua.deleteIn=Ua.removeIn=Hr.removeIn,Ua.update=Hr.update,Ua.updateIn=Hr.updateIn,Ua.mergeIn=Hr.mergeIn,Ua.mergeDeepIn=Hr.mergeDeepIn,Ua.withMutations=Hr.withMutations,Ua.asMutable=Hr.asMutable,Ua.asImmutable=Hr.asImmutable,Ua.wasAltered=Hr.wasAltered;function bd(P,F){this.array=P,this.ownerID=F}bd.prototype.removeBefore=function(P,F,K){if(K===F?1<<F:this.array.length===0)return this;var re=K>>>F&S;if(re>=this.array.length)return new bd([],P);var ae=re===0,xe;if(F>0){var Ae=this.array[re];if(xe=Ae&&Ae.removeBefore(P,F-y,K),xe===Ae&&ae)return this}if(ae&&!xe)return this;var Be=Dv(this,P);if(!ae)for(var et=0;et<re;et++)Be.array[et]=void 0;return xe&&(Be.array[re]=xe),Be},bd.prototype.removeAfter=function(P,F,K){if(K===(F?1<<F:0)||this.array.length===0)return this;var re=K-1>>>F&S;if(re>=this.array.length)return this;var ae;if(F>0){var xe=this.array[re];if(ae=xe&&xe.removeAfter(P,F-y,K),ae===xe&&re===this.array.length-1)return this}var Ae=Dv(this,P);return Ae.array.splice(re+1),ae&&(Ae.array[re]=ae),Ae};var d0={};function s6(P,F){var K=P._origin,re=P._capacity,ae=h0(re),xe=P._tail;return Ae(P._root,P._level,0);function Ae(st,yt,Lt){return yt===0?Be(st,Lt):et(st,yt,Lt)}function Be(st,yt){var Lt=yt===ae?xe&&xe.array:st&&st.array,Gt=yt>K?0:K-yt,xr=re-yt;return xr>b&&(xr=b),function(){if(Gt===xr)return d0;var jr=F?--xr:Gt++;return Lt&&Lt[jr]}}function et(st,yt,Lt){var Gt,xr=st&&st.array,jr=Lt>K?0:K-Lt>>yt,qn=(re-Lt>>yt)+1;return qn>b&&(qn=b),function(){do{if(Gt){var $s=Gt();if($s!==d0)return $s;Gt=null}if(jr===qn)return d0;var ju=F?--qn:jr++;Gt=Ae(xr&&xr[ju],yt-y,Lt+(ju<<yt))}while(!0)}}}function f0(P,F,K,re,ae,xe,Ae){var Be=Object.create(Ua);return Be.size=F-P,Be._origin=P,Be._capacity=F,Be._level=K,Be._root=re,Be._tail=ae,Be.__ownerID=xe,Be.__hash=Ae,Be.__altered=!1,Be}var u6;function AE(){return u6||(u6=f0(0,0,y))}function hie(P,F,K){if(F=L(P,F),F!==F)return P;if(F>=P.size||F<0)return P.withMutations(function(Ae){F<0?xd(Ae,F).set(0,K):xd(Ae,0,F+1).set(F,K)});F+=P._origin;var re=P._tail,ae=P._root,xe=A(w);return F>=h0(P._capacity)?re=PE(re,P.__ownerID,0,F,K,xe):ae=PE(ae,P.__ownerID,P._level,F,K,xe),xe.value?P.__ownerID?(P._root=ae,P._tail=re,P.__hash=void 0,P.__altered=!0,P):f0(P._origin,P._capacity,P._level,ae,re):P}function PE(P,F,K,re,ae,xe){var Ae=re>>>K&S,Be=P&&Ae<P.array.length;if(!Be&&ae===void 0)return P;var et;if(K>0){var st=P&&P.array[Ae],yt=PE(st,F,K-y,re,ae,xe);return yt===st?P:(et=Dv(P,F),et.array[Ae]=yt,et)}return Be&&P.array[Ae]===ae?P:(M(xe),et=Dv(P,F),ae===void 0&&Ae===et.array.length-1?et.array.pop():et.array[Ae]=ae,et)}function Dv(P,F){return F&&P&&F===P.ownerID?P:new bd(P?P.array.slice():[],F)}function l6(P,F){if(F>=h0(P._capacity))return P._tail;if(F<1<<P._level+y){for(var K=P._root,re=P._level;K&&re>0;)K=K.array[F>>>re&S],re-=y;return K}}function xd(P,F,K){F!==void 0&&(F=F|0),K!==void 0&&(K=K|0);var re=P.__ownerID||new D,ae=P._origin,xe=P._capacity,Ae=ae+F,Be=K===void 0?xe:K<0?xe+K:ae+K;if(Ae===ae&&Be===xe)return P;if(Ae>=Be)return P.clear();for(var et=P._level,st=P._root,yt=0;Ae+yt<0;)st=new bd(st&&st.array.length?[void 0,st]:[],re),et+=y,yt+=1<<et;yt&&(Ae+=yt,ae+=yt,Be+=yt,xe+=yt);for(var Lt=h0(xe),Gt=h0(Be);Gt>=1<<et+y;)st=new bd(st&&st.array.length?[st]:[],re),et+=y;var xr=P._tail,jr=Gt<Lt?l6(P,Be-1):Gt>Lt?new bd([],re):xr;if(xr&&Gt>Lt&&Ae<xe&&xr.array.length){st=Dv(st,re);for(var qn=st,$s=et;$s>y;$s-=y){var ju=Lt>>>$s&S;qn=qn.array[ju]=Dv(qn.array[ju],re)}qn.array[Lt>>>y&S]=xr}if(Be<xe&&(jr=jr&&jr.removeAfter(re,0,Be)),Ae>=Gt)Ae-=Gt,Be-=Gt,et=y,st=null,jr=jr&&jr.removeBefore(re,0,Ae);else if(Ae>ae||Gt<Lt){for(yt=0;st;){var i2=Ae>>>et&S;if(i2!==Gt>>>et&S)break;i2&&(yt+=(1<<et)*i2),et-=y,st=st.array[i2]}st&&Ae>ae&&(st=st.removeBefore(re,et,Ae-yt)),st&&Gt<Lt&&(st=st.removeAfter(re,et,Gt-yt)),yt&&(Ae-=yt,Be-=yt)}return P.__ownerID?(P.size=Be-Ae,P._origin=Ae,P._capacity=Be,P._level=et,P._root=st,P._tail=jr,P.__hash=void 0,P.__altered=!0,P):f0(Ae,Be,et,st,jr)}function Qb(P,F,K){for(var re=[],ae=0,xe=0;xe<K.length;xe++){var Ae=K[xe],Be=o(Ae);Be.size>ae&&(ae=Be.size),u(Ae)||(Be=Be.map(function(et){return dt(et)})),re.push(Be)}return ae>P.size&&(P=P.setSize(ae)),t6(P,F,re)}function h0(P){return P<b?0:P-1>>>y<<y}n(mi,Kr);function mi(P){return P==null?Zb():c6(P)?P:Zb().withMutations(function(F){var K=a(P);Ba(K.size),K.forEach(function(re,ae){return F.set(ae,re)})})}mi.of=function(){return this(arguments)},mi.prototype.toString=function(){return this.__toString("OrderedMap {","}")},mi.prototype.get=function(P,F){var K=this._map.get(P);return K!==void 0?this._list.get(K)[1]:F},mi.prototype.clear=function(){return this.size===0?this:this.__ownerID?(this.size=0,this._map.clear(),this._list.clear(),this):Zb()},mi.prototype.set=function(P,F){return f6(this,P,F)},mi.prototype.remove=function(P){return f6(this,P,x)},mi.prototype.wasAltered=function(){return this._map.wasAltered()||this._list.wasAltered()},mi.prototype.__iterate=function(P,F){var K=this;return this._list.__iterate(function(re){return re&&P(re[1],re[0],K)},F)},mi.prototype.__iterator=function(P,F){return this._list.fromEntrySeq().__iterator(P,F)},mi.prototype.__ensureOwner=function(P){if(P===this.__ownerID)return this;var F=this._map.__ensureOwner(P),K=this._list.__ensureOwner(P);return P?TE(F,K,P,this.__hash):(this.__ownerID=P,this._map=F,this._list=K,this)};function c6(P){return xE(P)&&f(P)}mi.isOrderedMap=c6,mi.prototype[m]=!0,mi.prototype[g]=mi.prototype.remove;function TE(P,F,K,re){var ae=Object.create(mi.prototype);return ae.size=P?P.size:0,ae._map=P,ae._list=F,ae.__ownerID=K,ae.__hash=re,ae}var d6;function Zb(){return d6||(d6=TE(Ws(),AE()))}function f6(P,F,K){var re=P._map,ae=P._list,xe=re.get(F),Ae=xe!==void 0,Be,et;if(K===x){if(!Ae)return P;ae.size>=b&&ae.size>=re.size*2?(et=ae.filter(function(st,yt){return st!==void 0&&xe!==yt}),Be=et.toKeyedSeq().map(function(st){return st[0]}).flip().toMap(),P.__ownerID&&(Be.__ownerID=et.__ownerID=P.__ownerID)):(Be=re.remove(F),et=xe===ae.size-1?ae.pop():ae.set(xe,void 0))}else if(Ae){if(K===ae.get(xe)[1])return P;Be=re,et=ae.set(xe,[F,K])}else Be=re.set(F,ae.size),et=ae.set(ae.size,[F,K]);return P.__ownerID?(P.size=Be.size,P._map=Be,P._list=et,P.__hash=void 0,P):TE(Be,et)}n(as,Ee);function as(P,F){this._iter=P,this._useKeys=F,this.size=P.size}as.prototype.get=function(P,F){return this._iter.get(P,F)},as.prototype.has=function(P){return this._iter.has(P)},as.prototype.valueSeq=function(){return this._iter.valueSeq()},as.prototype.reverse=function(){var P=this,F=IE(this,!0);return this._useKeys||(F.valueSeq=function(){return P._iter.toSeq().reverse()}),F},as.prototype.map=function(P,F){var K=this,re=p6(this,P,F);return this._useKeys||(re.valueSeq=function(){return K._iter.toSeq().map(P,F)}),re},as.prototype.__iterate=function(P,F){var K=this,re;return this._iter.__iterate(this._useKeys?function(ae,xe){return P(ae,xe,K)}:(re=F?x6(this):0,function(ae){return P(ae,F?--re:re++,K)}),F)},as.prototype.__iterator=function(P,F){if(this._useKeys)return this._iter.__iterator(P,F);var K=this._iter.__iterator(q,F),re=F?x6(this):0;return new U(function(){var ae=K.next();return ae.done?ae:z(P,F?--re:re++,ae.value,ae)})},as.prototype[m]=!0,n(Rv,Se);function Rv(P){this._iter=P,this.size=P.size}Rv.prototype.includes=function(P){return this._iter.includes(P)},Rv.prototype.__iterate=function(P,F){var K=this,re=0;return this._iter.__iterate(function(ae){return P(ae,re++,K)},F)},Rv.prototype.__iterator=function(P,F){var K=this._iter.__iterator(q,F),re=0;return new U(function(){var ae=K.next();return ae.done?ae:z(P,re++,ae.value,ae)})},n(kv,ie);function kv(P){this._iter=P,this.size=P.size}kv.prototype.has=function(P){return this._iter.includes(P)},kv.prototype.__iterate=function(P,F){var K=this;return this._iter.__iterate(function(re){return P(re,re,K)},F)},kv.prototype.__iterator=function(P,F){var K=this._iter.__iterator(q,F);return new U(function(){var re=K.next();return re.done?re:z(P,re.value,re.value,re)})},n(Ov,Ee);function Ov(P){this._iter=P,this.size=P.size}Ov.prototype.entrySeq=function(){return this._iter.toSeq()},Ov.prototype.__iterate=function(P,F){var K=this;return this._iter.__iterate(function(re){if(re){b6(re);var ae=u(re);return P(ae?re.get(1):re[1],ae?re.get(0):re[0],K)}},F)},Ov.prototype.__iterator=function(P,F){var K=this._iter.__iterator(q,F);return new U(function(){for(;;){var re=K.next();if(re.done)return re;var ae=re.value;if(ae){b6(ae);var xe=u(ae);return z(P,xe?ae.get(0):ae[0],xe?ae.get(1):ae[1],re)}}})},Rv.prototype.cacheResult=as.prototype.cacheResult=kv.prototype.cacheResult=Ov.prototype.cacheResult=RE;function h6(P){var F=Fu(P);return F._iter=P,F.size=P.size,F.flip=function(){return P},F.reverse=function(){var K=P.reverse.apply(this);return K.flip=function(){return P.reverse()},K},F.has=function(K){return P.includes(K)},F.includes=function(K){return P.has(K)},F.cacheResult=RE,F.__iterateUncached=function(K,re){var ae=this;return P.__iterate(function(xe,Ae){return K(Ae,xe,ae)!==!1},re)},F.__iteratorUncached=function(K,re){if(K===ee){var ae=P.__iterator(K,re);return new U(function(){var xe=ae.next();if(!xe.done){var Ae=xe.value[0];xe.value[0]=xe.value[1],xe.value[1]=Ae}return xe})}return P.__iterator(K===q?W:q,re)},F}function p6(P,F,K){var re=Fu(P);return re.size=P.size,re.has=function(ae){return P.has(ae)},re.get=function(ae,xe){var Ae=P.get(ae,x);return Ae===x?xe:F.call(K,Ae,ae,P)},re.__iterateUncached=function(ae,xe){var Ae=this;return P.__iterate(function(Be,et,st){return ae(F.call(K,Be,et,st),et,Ae)!==!1},xe)},re.__iteratorUncached=function(ae,xe){var Ae=P.__iterator(ee,xe);return new U(function(){var Be=Ae.next();if(Be.done)return Be;var et=Be.value,st=et[0];return z(ae,st,F.call(K,et[1],st,P),Be)})},re}function IE(P,F){var K=Fu(P);return K._iter=P,K.size=P.size,K.reverse=function(){return P},P.flip&&(K.flip=function(){var re=h6(P);return re.reverse=function(){return P.flip()},re}),K.get=function(re,ae){return P.get(F?re:-1-re,ae)},K.has=function(re){return P.has(F?re:-1-re)},K.includes=function(re){return P.includes(re)},K.cacheResult=RE,K.__iterate=function(re,ae){var xe=this;return P.__iterate(function(Ae,Be){return re(Ae,Be,xe)},!ae)},K.__iterator=function(re,ae){return P.__iterator(re,!ae)},K}function v6(P,F,K,re){var ae=Fu(P);return re&&(ae.has=function(xe){var Ae=P.get(xe,x);return Ae!==x&&!!F.call(K,Ae,xe,P)},ae.get=function(xe,Ae){var Be=P.get(xe,x);return Be!==x&&F.call(K,Be,xe,P)?Be:Ae}),ae.__iterateUncached=function(xe,Ae){var Be=this,et=0;return P.__iterate(function(st,yt,Lt){if(F.call(K,st,yt,Lt))return et++,xe(st,re?yt:et-1,Be)},Ae),et},ae.__iteratorUncached=function(xe,Ae){var Be=P.__iterator(ee,Ae),et=0;return new U(function(){for(;;){var st=Be.next();if(st.done)return st;var yt=st.value,Lt=yt[0],Gt=yt[1];if(F.call(K,Gt,Lt,P))return z(xe,re?Lt:et++,Gt,st)}})},ae}function pie(P,F,K){var re=Kr().asMutable();return P.__iterate(function(ae,xe){re.update(F.call(K,ae,xe,P),0,function(Ae){return Ae+1})}),re.asImmutable()}function vie(P,F,K){var re=l(P),ae=(f(P)?mi():Kr()).asMutable();P.__iterate(function(Ae,Be){ae.update(F.call(K,Ae,Be,P),function(et){return et=et||[],et.push(re?[Be,Ae]:Ae),et})});var xe=S6(P);return ae.map(function(Ae){return An(P,xe(Ae))})}function ME(P,F,K,re){var ae=P.size;if(F!==void 0&&(F=F|0),K!==void 0&&(K===1/0?K=ae:K=K|0),B(F,K,ae))return P;var xe=j(F,ae),Ae=Q(K,ae);if(xe!==xe||Ae!==Ae)return ME(P.toSeq().cacheResult(),F,K,re);var Be=Ae-xe,et;Be===Be&&(et=Be<0?0:Be);var st=Fu(P);return st.size=et===0?et:P.size&&et||void 0,!re&&Pe(P)&&et>=0&&(st.get=function(yt,Lt){return yt=L(this,yt),yt>=0&&yt<et?P.get(yt+xe,Lt):Lt}),st.__iterateUncached=function(yt,Lt){var Gt=this;if(et===0)return 0;if(Lt)return this.cacheResult().__iterate(yt,Lt);var xr=0,jr=!0,qn=0;return P.__iterate(function($s,ju){if(!(jr&&(jr=xr++<xe)))return qn++,yt($s,re?ju:qn-1,Gt)!==!1&&qn!==et}),qn},st.__iteratorUncached=function(yt,Lt){if(et!==0&&Lt)return this.cacheResult().__iterator(yt,Lt);var Gt=et!==0&&P.__iterator(yt,Lt),xr=0,jr=0;return new U(function(){for(;xr++<xe;)Gt.next();if(++jr>et)return J();var qn=Gt.next();return re||yt===q?qn:yt===W?z(yt,jr-1,void 0,qn):z(yt,jr-1,qn.value[1],qn)})},st}function mie(P,F,K){var re=Fu(P);return re.__iterateUncached=function(ae,xe){var Ae=this;if(xe)return this.cacheResult().__iterate(ae,xe);var Be=0;return P.__iterate(function(et,st,yt){return F.call(K,et,st,yt)&&++Be&&ae(et,st,Ae)}),Be},re.__iteratorUncached=function(ae,xe){var Ae=this;if(xe)return this.cacheResult().__iterator(ae,xe);var Be=P.__iterator(ee,xe),et=!0;return new U(function(){if(!et)return J();var st=Be.next();if(st.done)return st;var yt=st.value,Lt=yt[0],Gt=yt[1];return F.call(K,Gt,Lt,Ae)?ae===ee?st:z(ae,Lt,Gt,st):(et=!1,J())})},re}function m6(P,F,K,re){var ae=Fu(P);return ae.__iterateUncached=function(xe,Ae){var Be=this;if(Ae)return this.cacheResult().__iterate(xe,Ae);var et=!0,st=0;return P.__iterate(function(yt,Lt,Gt){if(!(et&&(et=F.call(K,yt,Lt,Gt))))return st++,xe(yt,re?Lt:st-1,Be)}),st},ae.__iteratorUncached=function(xe,Ae){var Be=this;if(Ae)return this.cacheResult().__iterator(xe,Ae);var et=P.__iterator(ee,Ae),st=!0,yt=0;return new U(function(){var Lt,Gt,xr;do{if(Lt=et.next(),Lt.done)return re||xe===q?Lt:xe===W?z(xe,yt++,void 0,Lt):z(xe,yt++,Lt.value[1],Lt);var jr=Lt.value;Gt=jr[0],xr=jr[1],st&&(st=F.call(K,xr,Gt,Be))}while(st);return xe===ee?Lt:z(xe,Gt,xr,Lt)})},ae}function gie(P,F){var K=l(P),re=[P].concat(F).map(function(Ae){return u(Ae)?K&&(Ae=a(Ae)):Ae=K?Xe(Ae):ct(Array.isArray(Ae)?Ae:[Ae]),Ae}).filter(function(Ae){return Ae.size!==0});if(re.length===0)return P;if(re.length===1){var ae=re[0];if(ae===P||K&&l(ae)||c(P)&&c(ae))return ae}var xe=new O(re);return K?xe=xe.toKeyedSeq():c(P)||(xe=xe.toSetSeq()),xe=xe.flatten(!0),xe.size=re.reduce(function(Ae,Be){if(Ae!==void 0){var et=Be.size;if(et!==void 0)return Ae+et}},0),xe}function g6(P,F,K){var re=Fu(P);return re.__iterateUncached=function(ae,xe){var Ae=0,Be=!1;function et(st,yt){var Lt=this;st.__iterate(function(Gt,xr){return(!F||yt<F)&&u(Gt)?et(Gt,yt+1):ae(Gt,K?xr:Ae++,Lt)===!1&&(Be=!0),!Be},xe)}return et(P,0),Ae},re.__iteratorUncached=function(ae,xe){var Ae=P.__iterator(ae,xe),Be=[],et=0;return new U(function(){for(;Ae;){var st=Ae.next();if(st.done!==!1){Ae=Be.pop();continue}var yt=st.value;if(ae===ee&&(yt=yt[1]),(!F||Be.length<F)&&u(yt))Be.push(Ae),Ae=yt.__iterator(ae,xe);else return K?st:z(ae,et++,yt,st)}return J()})},re}function yie(P,F,K){var re=S6(P);return P.toSeq().map(function(ae,xe){return re(F.call(K,ae,xe,P))}).flatten(!0)}function bie(P,F){var K=Fu(P);return K.size=P.size&&P.size*2-1,K.__iterateUncached=function(re,ae){var xe=this,Ae=0;return P.__iterate(function(Be,et){return(!Ae||re(F,Ae++,xe)!==!1)&&re(Be,Ae++,xe)!==!1},ae),Ae},K.__iteratorUncached=function(re,ae){var xe=P.__iterator(q,ae),Ae=0,Be;return new U(function(){return(!Be||Ae%2)&&(Be=xe.next(),Be.done)?Be:Ae%2?z(re,Ae++,F):z(re,Ae++,Be.value,Be)})},K}function Lv(P,F,K){F||(F=C6);var re=l(P),ae=0,xe=P.toSeq().map(function(Ae,Be){return[Be,Ae,ae++,K?K(Ae,Be,P):Ae]}).toArray();return xe.sort(function(Ae,Be){return F(Ae[3],Be[3])||Ae[2]-Be[2]}).forEach(re?function(Ae,Be){xe[Be].length=2}:function(Ae,Be){xe[Be]=Ae[1]}),re?Ee(xe):c(P)?Se(xe):ie(xe)}function Jb(P,F,K){if(F||(F=C6),K){var re=P.toSeq().map(function(ae,xe){return[ae,K(ae,xe,P)]}).reduce(function(ae,xe){return y6(F,ae[1],xe[1])?xe:ae});return re&&re[0]}else return P.reduce(function(ae,xe){return y6(F,ae,xe)?xe:ae})}function y6(P,F,K){var re=P(K,F);return re===0&&K!==F&&(K==null||K!==K)||re>0}function DE(P,F,K){var re=Fu(P);return re.size=new O(K).map(function(ae){return ae.size}).min(),re.__iterate=function(ae,xe){for(var Ae=this.__iterator(q,xe),Be,et=0;!(Be=Ae.next()).done&&ae(Be.value,et++,this)!==!1;);return et},re.__iteratorUncached=function(ae,xe){var Ae=K.map(function(st){return st=i(st),te(xe?st.reverse():st)}),Be=0,et=!1;return new U(function(){var st;return et||(st=Ae.map(function(yt){return yt.next()}),et=st.some(function(yt){return yt.done})),et?J():z(ae,Be++,F.apply(null,st.map(function(yt){return yt.value})))})},re}function An(P,F){return Pe(P)?F:P.constructor(F)}function b6(P){if(P!==Object(P))throw new TypeError("Expected [K, V] tuple: "+P)}function x6(P){return Ba(P.size),R(P)}function S6(P){return l(P)?a:c(P)?o:s}function Fu(P){return Object.create((l(P)?Ee:c(P)?Se:ie).prototype)}function RE(){return this._iter.cacheResult?(this._iter.cacheResult(),this.size=this._iter.size,this):be.prototype.cacheResult.call(this)}function C6(P,F){return P>F?1:P<F?-1:0}function _6(P){var F=te(P);if(!F){if(!ye(P))throw new TypeError("Expected iterable or array-like: "+P);F=te(i(P))}return F}n(Eo,gt);function Eo(P,F){var K,re=function(Ae){if(Ae instanceof re)return Ae;if(!(this instanceof re))return new re(Ae);if(!K){K=!0;var Be=Object.keys(P);xie(ae,Be),ae.size=Be.length,ae._name=F,ae._keys=Be,ae._defaultValues=P}this._map=Kr(Ae)},ae=re.prototype=Object.create(ia);return ae.constructor=re,re}Eo.prototype.toString=function(){return this.__toString(w6(this)+" {","}")},Eo.prototype.has=function(P){return this._defaultValues.hasOwnProperty(P)},Eo.prototype.get=function(P,F){if(!this.has(P))return F;var K=this._defaultValues[P];return this._map?this._map.get(P,K):K},Eo.prototype.clear=function(){if(this.__ownerID)return this._map&&this._map.clear(),this;var P=this.constructor;return P._empty||(P._empty=e2(this,Ws()))},Eo.prototype.set=function(P,F){if(!this.has(P))throw new Error('Cannot set unknown key "'+P+'" on '+w6(this));if(this._map&&!this._map.has(P)){var K=this._defaultValues[P];if(F===K)return this}var re=this._map&&this._map.set(P,F);return this.__ownerID||re===this._map?this:e2(this,re)},Eo.prototype.remove=function(P){if(!this.has(P))return this;var F=this._map&&this._map.remove(P);return this.__ownerID||F===this._map?this:e2(this,F)},Eo.prototype.wasAltered=function(){return this._map.wasAltered()},Eo.prototype.__iterator=function(P,F){var K=this;return a(this._defaultValues).map(function(re,ae){return K.get(ae)}).__iterator(P,F)},Eo.prototype.__iterate=function(P,F){var K=this;return a(this._defaultValues).map(function(re,ae){return K.get(ae)}).__iterate(P,F)},Eo.prototype.__ensureOwner=function(P){if(P===this.__ownerID)return this;var F=this._map&&this._map.__ensureOwner(P);return P?e2(this,F,P):(this.__ownerID=P,this._map=F,this)};var ia=Eo.prototype;ia[g]=ia.remove,ia.deleteIn=ia.removeIn=Hr.removeIn,ia.merge=Hr.merge,ia.mergeWith=Hr.mergeWith,ia.mergeIn=Hr.mergeIn,ia.mergeDeep=Hr.mergeDeep,ia.mergeDeepWith=Hr.mergeDeepWith,ia.mergeDeepIn=Hr.mergeDeepIn,ia.setIn=Hr.setIn,ia.update=Hr.update,ia.updateIn=Hr.updateIn,ia.withMutations=Hr.withMutations,ia.asMutable=Hr.asMutable,ia.asImmutable=Hr.asImmutable;function e2(P,F,K){var re=Object.create(Object.getPrototypeOf(P));return re._map=F,re.__ownerID=K,re}function w6(P){return P._name||P.constructor.name||"Record"}function xie(P,F){try{F.forEach(Sie.bind(void 0,P))}catch{}}function Sie(P,F){Object.defineProperty(P,F,{get:function(){return this.get(F)},set:function(K){fe(this.__ownerID,"Cannot set on an immutable record."),this.set(F,K)}})}n(Gn,$t);function Gn(P){return P==null?LE():kE(P)&&!f(P)?P:LE().withMutations(function(F){var K=s(P);Ba(K.size),K.forEach(function(re){return F.add(re)})})}Gn.of=function(){return this(arguments)},Gn.fromKeys=function(P){return this(a(P).keySeq())},Gn.prototype.toString=function(){return this.__toString("Set {","}")},Gn.prototype.has=function(P){return this._map.has(P)},Gn.prototype.add=function(P){return OE(this,this._map.set(P,!0))},Gn.prototype.remove=function(P){return OE(this,this._map.remove(P))},Gn.prototype.clear=function(){return OE(this,this._map.clear())},Gn.prototype.union=function(){var P=r.call(arguments,0);return P=P.filter(function(F){return F.size!==0}),P.length===0?this:this.size===0&&!this.__ownerID&&P.length===1?this.constructor(P[0]):this.withMutations(function(F){for(var K=0;K<P.length;K++)s(P[K]).forEach(function(re){return F.add(re)})})},Gn.prototype.intersect=function(){var P=r.call(arguments,0);if(P.length===0)return this;P=P.map(function(K){return s(K)});var F=this;return this.withMutations(function(K){F.forEach(function(re){P.every(function(ae){return ae.includes(re)})||K.remove(re)})})},Gn.prototype.subtract=function(){var P=r.call(arguments,0);if(P.length===0)return this;P=P.map(function(K){return s(K)});var F=this;return this.withMutations(function(K){F.forEach(function(re){P.some(function(ae){return ae.includes(re)})&&K.remove(re)})})},Gn.prototype.merge=function(){return this.union.apply(this,arguments)},Gn.prototype.mergeWith=function(P){var F=r.call(arguments,1);return this.union.apply(this,F)},Gn.prototype.sort=function(P){return Bu(Lv(this,P))},Gn.prototype.sortBy=function(P,F){return Bu(Lv(this,F,P))},Gn.prototype.wasAltered=function(){return this._map.wasAltered()},Gn.prototype.__iterate=function(P,F){var K=this;return this._map.__iterate(function(re,ae){return P(ae,ae,K)},F)},Gn.prototype.__iterator=function(P,F){return this._map.map(function(K,re){return re}).__iterator(P,F)},Gn.prototype.__ensureOwner=function(P){if(P===this.__ownerID)return this;var F=this._map.__ensureOwner(P);return P?this.__make(F,P):(this.__ownerID=P,this._map=F,this)};function kE(P){return!!(P&&P[E6])}Gn.isSet=kE;var E6="@@__IMMUTABLE_SET__@@",Ao=Gn.prototype;Ao[E6]=!0,Ao[g]=Ao.remove,Ao.mergeDeep=Ao.merge,Ao.mergeDeepWith=Ao.mergeWith,Ao.withMutations=Hr.withMutations,Ao.asMutable=Hr.asMutable,Ao.asImmutable=Hr.asImmutable,Ao.__empty=LE,Ao.__make=A6;function OE(P,F){return P.__ownerID?(P.size=F.size,P._map=F,P):F===P._map?P:F.size===0?P.__empty():P.__make(F)}function A6(P,F){var K=Object.create(Ao);return K.size=P?P.size:0,K._map=P,K.__ownerID=F,K}var P6;function LE(){return P6||(P6=A6(Ws()))}n(Bu,Gn);function Bu(P){return P==null?NE():T6(P)?P:NE().withMutations(function(F){var K=s(P);Ba(K.size),K.forEach(function(re){return F.add(re)})})}Bu.of=function(){return this(arguments)},Bu.fromKeys=function(P){return this(a(P).keySeq())},Bu.prototype.toString=function(){return this.__toString("OrderedSet {","}")};function T6(P){return kE(P)&&f(P)}Bu.isOrderedSet=T6;var t2=Bu.prototype;t2[m]=!0,t2.__empty=NE,t2.__make=I6;function I6(P,F){var K=Object.create(t2);return K.size=P?P.size:0,K._map=P,K.__ownerID=F,K}var M6;function NE(){return M6||(M6=I6(Zb()))}n(bi,Pt);function bi(P){return P==null?FE():D6(P)?P:FE().unshiftAll(P)}bi.of=function(){return this(arguments)},bi.prototype.toString=function(){return this.__toString("Stack [","]")},bi.prototype.get=function(P,F){var K=this._head;for(P=L(this,P);K&&P--;)K=K.next;return K?K.value:F},bi.prototype.peek=function(){return this._head&&this._head.value},bi.prototype.push=function(){if(arguments.length===0)return this;for(var P=this.size+arguments.length,F=this._head,K=arguments.length-1;K>=0;K--)F={value:arguments[K],next:F};return this.__ownerID?(this.size=P,this._head=F,this.__hash=void 0,this.__altered=!0,this):p0(P,F)},bi.prototype.pushAll=function(P){if(P=o(P),P.size===0)return this;Ba(P.size);var F=this.size,K=this._head;return P.reverse().forEach(function(re){F++,K={value:re,next:K}}),this.__ownerID?(this.size=F,this._head=K,this.__hash=void 0,this.__altered=!0,this):p0(F,K)},bi.prototype.pop=function(){return this.slice(1)},bi.prototype.unshift=function(){return this.push.apply(this,arguments)},bi.prototype.unshiftAll=function(P){return this.pushAll(P)},bi.prototype.shift=function(){return this.pop.apply(this,arguments)},bi.prototype.clear=function(){return this.size===0?this:this.__ownerID?(this.size=0,this._head=void 0,this.__hash=void 0,this.__altered=!0,this):FE()},bi.prototype.slice=function(P,F){if(B(P,F,this.size))return this;var K=j(P,this.size),re=Q(F,this.size);if(re!==this.size)return Pt.prototype.slice.call(this,P,F);for(var ae=this.size-K,xe=this._head;K--;)xe=xe.next;return this.__ownerID?(this.size=ae,this._head=xe,this.__hash=void 0,this.__altered=!0,this):p0(ae,xe)},bi.prototype.__ensureOwner=function(P){return P===this.__ownerID?this:P?p0(this.size,this._head,P,this.__hash):(this.__ownerID=P,this.__altered=!1,this)},bi.prototype.__iterate=function(P,F){if(F)return this.reverse().__iterate(P);for(var K=0,re=this._head;re&&P(re.value,K++,this)!==!1;)re=re.next;return K},bi.prototype.__iterator=function(P,F){if(F)return this.reverse().__iterator(P);var K=0,re=this._head;return new U(function(){if(re){var ae=re.value;return re=re.next,z(P,K++,ae)}return J()})};function D6(P){return!!(P&&P[R6])}bi.isStack=D6;var R6="@@__IMMUTABLE_STACK__@@",Nv=bi.prototype;Nv[R6]=!0,Nv.withMutations=Hr.withMutations,Nv.asMutable=Hr.asMutable,Nv.asImmutable=Hr.asImmutable,Nv.wasAltered=Hr.wasAltered;function p0(P,F,K,re){var ae=Object.create(Nv);return ae.size=P,ae._head=F,ae.__ownerID=K,ae.__hash=re,ae.__altered=!1,ae}var k6;function FE(){return k6||(k6=p0(0))}function Uu(P,F){var K=function(re){P.prototype[re]=F[re]};return Object.keys(F).forEach(K),Object.getOwnPropertySymbols&&Object.getOwnPropertySymbols(F).forEach(K),P}i.Iterator=U,Uu(i,{toArray:function(){Ba(this.size);var P=new Array(this.size||0);return this.valueSeq().__iterate(function(F,K){P[K]=F}),P},toIndexedSeq:function(){return new Rv(this)},toJS:function(){return this.toSeq().map(function(P){return P&&typeof P.toJS=="function"?P.toJS():P}).__toJS()},toJSON:function(){return this.toSeq().map(function(P){return P&&typeof P.toJSON=="function"?P.toJSON():P}).__toJS()},toKeyedSeq:function(){return new as(this,!0)},toMap:function(){return Kr(this.toKeyedSeq())},toObject:function(){Ba(this.size);var P={};return this.__iterate(function(F,K){P[K]=F}),P},toOrderedMap:function(){return mi(this.toKeyedSeq())},toOrderedSet:function(){return Bu(l(this)?this.valueSeq():this)},toSet:function(){return Gn(l(this)?this.valueSeq():this)},toSetSeq:function(){return new kv(this)},toSeq:function(){return c(this)?this.toIndexedSeq():l(this)?this.toKeyedSeq():this.toSetSeq()},toStack:function(){return bi(l(this)?this.valueSeq():this)},toList:function(){return Ln(l(this)?this.valueSeq():this)},toString:function(){return"[Iterable]"},__toString:function(P,F){return this.size===0?P+F:P+" "+this.toSeq().map(this.__toStringMapper).join(", ")+" "+F},concat:function(){var P=r.call(arguments,0);return An(this,gie(this,P))},includes:function(P){return this.some(function(F){return tt(F,P)})},entries:function(){return this.__iterator(ee)},every:function(P,F){Ba(this.size);var K=!0;return this.__iterate(function(re,ae,xe){if(!P.call(F,re,ae,xe))return K=!1,!1}),K},filter:function(P,F){return An(this,v6(this,P,F,!0))},find:function(P,F,K){var re=this.findEntry(P,F);return re?re[1]:K},forEach:function(P,F){return Ba(this.size),this.__iterate(F?P.bind(F):P)},join:function(P){Ba(this.size),P=P!==void 0?""+P:",";var F="",K=!0;return this.__iterate(function(re){K?K=!1:F+=P,F+=re!=null?re.toString():""}),F},keys:function(){return this.__iterator(W)},map:function(P,F){return An(this,p6(this,P,F))},reduce:function(P,F,K){Ba(this.size);var re,ae;return arguments.length<2?ae=!0:re=F,this.__iterate(function(xe,Ae,Be){ae?(ae=!1,re=xe):re=P.call(K,re,xe,Ae,Be)}),re},reduceRight:function(P,F,K){var re=this.toKeyedSeq().reverse();return re.reduce.apply(re,arguments)},reverse:function(){return An(this,IE(this,!0))},slice:function(P,F){return An(this,ME(this,P,F,!0))},some:function(P,F){return!this.every(n2(P),F)},sort:function(P){return An(this,Lv(this,P))},values:function(){return this.__iterator(q)},butLast:function(){return this.slice(0,-1)},isEmpty:function(){return this.size!==void 0?this.size===0:!this.some(function(){return!0})},count:function(P,F){return R(P?this.toSeq().filter(P,F):this)},countBy:function(P,F){return pie(this,P,F)},equals:function(P){return xt(this,P)},entrySeq:function(){var P=this;if(P._cache)return new O(P._cache);var F=P.toSeq().map(_ie).toIndexedSeq();return F.fromEntrySeq=function(){return P.toSeq()},F},filterNot:function(P,F){return this.filter(n2(P),F)},findEntry:function(P,F,K){var re=K;return this.__iterate(function(ae,xe,Ae){if(P.call(F,ae,xe,Ae))return re=[xe,ae],!1}),re},findKey:function(P,F){var K=this.findEntry(P,F);return K&&K[0]},findLast:function(P,F,K){return this.toKeyedSeq().reverse().find(P,F,K)},findLastEntry:function(P,F,K){return this.toKeyedSeq().reverse().findEntry(P,F,K)},findLastKey:function(P,F){return this.toKeyedSeq().reverse().findKey(P,F)},first:function(){return this.find(H)},flatMap:function(P,F){return An(this,yie(this,P,F))},flatten:function(P){return An(this,g6(this,P,!0))},fromEntrySeq:function(){return new Ov(this)},get:function(P,F){return this.find(function(K,re){return tt(re,P)},void 0,F)},getIn:function(P,F){for(var K=this,re=_6(P),ae;!(ae=re.next()).done;){var xe=ae.value;if(K=K&&K.get?K.get(xe,x):x,K===x)return F}return K},groupBy:function(P,F){return vie(this,P,F)},has:function(P){return this.get(P,x)!==x},hasIn:function(P){return this.getIn(P,x)!==x},isSubset:function(P){return P=typeof P.includes=="function"?P:i(P),this.every(function(F){return P.includes(F)})},isSuperset:function(P){return P=typeof P.isSubset=="function"?P:i(P),P.isSubset(this)},keyOf:function(P){return this.findKey(function(F){return tt(F,P)})},keySeq:function(){return this.toSeq().map(Cie).toIndexedSeq()},last:function(){return this.toSeq().reverse().first()},lastKeyOf:function(P){return this.toKeyedSeq().reverse().keyOf(P)},max:function(P){return Jb(this,P)},maxBy:function(P,F){return Jb(this,F,P)},min:function(P){return Jb(this,P?O6(P):N6)},minBy:function(P,F){return Jb(this,F?O6(F):N6,P)},rest:function(){return this.slice(1)},skip:function(P){return this.slice(Math.max(0,P))},skipLast:function(P){return An(this,this.toSeq().reverse().skip(P).reverse())},skipWhile:function(P,F){return An(this,m6(this,P,F,!0))},skipUntil:function(P,F){return this.skipWhile(n2(P),F)},sortBy:function(P,F){return An(this,Lv(this,F,P))},take:function(P){return this.slice(0,Math.max(0,P))},takeLast:function(P){return An(this,this.toSeq().reverse().take(P).reverse())},takeWhile:function(P,F){return An(this,mie(this,P,F))},takeUntil:function(P,F){return this.takeWhile(n2(P),F)},valueSeq:function(){return this.toIndexedSeq()},hashCode:function(){return this.__hash||(this.__hash=Eie(this))}});var ja=i.prototype;ja[h]=!0,ja[X]=ja.values,ja.__toJS=ja.toArray,ja.__toStringMapper=L6,ja.inspect=ja.toSource=function(){return this.toString()},ja.chain=ja.flatMap,ja.contains=ja.includes,Uu(a,{flip:function(){return An(this,h6(this))},mapEntries:function(P,F){var K=this,re=0;return An(this,this.toSeq().map(function(ae,xe){return P.call(F,[xe,ae],re++,K)}).fromEntrySeq())},mapKeys:function(P,F){var K=this;return An(this,this.toSeq().flip().map(function(re,ae){return P.call(F,re,ae,K)}).flip())}});var r2=a.prototype;r2[v]=!0,r2[X]=ja.entries,r2.__toJS=ja.toObject,r2.__toStringMapper=function(P,F){return JSON.stringify(F)+": "+L6(P)},Uu(o,{toKeyedSeq:function(){return new as(this,!1)},filter:function(P,F){return An(this,v6(this,P,F,!1))},findIndex:function(P,F){var K=this.findEntry(P,F);return K?K[0]:-1},indexOf:function(P){var F=this.keyOf(P);return F===void 0?-1:F},lastIndexOf:function(P){var F=this.lastKeyOf(P);return F===void 0?-1:F},reverse:function(){return An(this,IE(this,!1))},slice:function(P,F){return An(this,ME(this,P,F,!1))},splice:function(P,F){var K=arguments.length;if(F=Math.max(F|0,0),K===0||K===2&&!F)return this;P=j(P,P<0?this.count():this.size);var re=this.slice(0,P);return An(this,K===1?re:re.concat(k(arguments,2),this.slice(P+F)))},findLastIndex:function(P,F){var K=this.findLastEntry(P,F);return K?K[0]:-1},first:function(){return this.get(0)},flatten:function(P){return An(this,g6(this,P,!1))},get:function(P,F){return P=L(this,P),P<0||this.size===1/0||this.size!==void 0&&P>this.size?F:this.find(function(K,re){return re===P},void 0,F)},has:function(P){return P=L(this,P),P>=0&&(this.size!==void 0?this.size===1/0||P<this.size:this.indexOf(P)!==-1)},interpose:function(P){return An(this,bie(this,P))},interleave:function(){var P=[this].concat(k(arguments)),F=DE(this.toSeq(),Se.of,P),K=F.flatten(!0);return F.size&&(K.size=F.size*P.length),An(this,K)},keySeq:function(){return me(0,this.size)},last:function(){return this.get(-1)},skipWhile:function(P,F){return An(this,m6(this,P,F,!1))},zip:function(){var P=[this].concat(k(arguments));return An(this,DE(this,wie,P))},zipWith:function(P){var F=k(arguments);return F[0]=this,An(this,DE(this,P,F))}}),o.prototype[p]=!0,o.prototype[m]=!0,Uu(s,{get:function(P,F){return this.has(P)?P:F},includes:function(P){return this.has(P)},keySeq:function(){return this.valueSeq()}}),s.prototype.has=ja.includes,s.prototype.contains=s.prototype.includes,Uu(Ee,a.prototype),Uu(Se,o.prototype),Uu(ie,s.prototype),Uu(gt,a.prototype),Uu(Pt,o.prototype),Uu($t,s.prototype);function Cie(P,F){return F}function _ie(P,F){return[F,P]}function n2(P){return function(){return!P.apply(this,arguments)}}function O6(P){return function(){return-P.apply(this,arguments)}}function L6(P){return typeof P=="string"?JSON.stringify(P):String(P)}function wie(){return k(arguments)}function N6(P,F){return P<F?1:P>F?-1:0}function Eie(P){if(P.size===1/0)return 0;var F=f(P),K=l(P),re=F?1:0,ae=P.__iterate(K?F?function(xe,Ae){re=31*re+F6(Yt(xe),Yt(Ae))|0}:function(xe,Ae){re=re+F6(Yt(xe),Yt(Ae))|0}:F?function(xe){re=31*re+Yt(xe)|0}:function(xe){re=re+Yt(xe)|0});return Aie(ae,re)}function Aie(P,F){return F=lr(F,3432918353),F=lr(F<<15|F>>>-15,461845907),F=lr(F<<13|F>>>-13,5),F=(F+3864292196|0)^P,F=lr(F^F>>>16,2246822507),F=lr(F^F>>>13,3266489909),F=Er(F^F>>>16),F}function F6(P,F){return P^F+2654435769+(P<<6)+(P>>2)|0}var Pie={Iterable:i,Seq:be,Collection:Ke,Map:Kr,OrderedMap:mi,List:Ln,Stack:bi,Set:Gn,OrderedSet:Bu,Record:Eo,Range:me,Repeat:pt,is:tt,fromJS:dt};return Pie})})(DY);var ri=DY.exports,m3=Object.prototype.hasOwnProperty;function oAe(e,t){for(var r=0,n=Object.keys(t);r<n.length;r++){var i=n[r];m3.call(t,i)&&typeof e[i]>"u"&&(e[i]=t[i])}return e}function sAe(e,t){for(var r=!1,n=0,i=Object.keys(t);n<i.length;n++){var a=i[n];if(m3.call(t,a)&&t[a]!==e[a]){r=!0;break}}return r?Object.assign({},e,t):e}function jk(e,t){if(!e)return!t;if(!t)return!1;var r=Object.keys(e);if(Object.keys(t).length!==r.length)return!1;for(var n=0,i=r;n<i.length;n++){var a=i[n];if(!m3.call(e,a)||e[a]!==t[a])return!1}return!0}function uAe(e,t){for(var r=e,n=0;n<t.length;n++)if(t[n]&&(r=sAe(e,t[n]),r!==e)){for(var i=n+1;i<t.length;i++)r=Object.assign(r,t[i]);break}return r}function qf(e){if(e===null||typeof e!="object")return e;if(e instanceof Array){for(var t=[],r=0,n=e.length;r<n;r++)t[r]=qf(e[r]);return t}if(typeof e=="object"&&!("prototype"in e)){var t={};for(var i in e)m3.call(e,i)&&(t[i]=qf(e[i]));return t}throw new Error(`Can't clone, type "`+typeof e+'" unsupported')}function Iu(e,t){if(e)for(var r=0,n=Object.keys(e);r<n.length;r++){var i=n[r];t(e[i],i)}}function lAe(){var e=function(){var p=typeof window<"u"&&window,m=typeof self<"u"&&typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&self,g=typeof e<"u"&&e;return p||g||m}(),t={},r=typeof document<"u"?document:void 0,n=1,i;function a(p){for(var m=[],g=1;g<arguments.length;g++)m[g-1]=arguments[g];typeof p!="function"&&(p=new Function(""+p));var y={callback:p,args:m};return t[n]=y,i(n),n++}function o(p){delete t[p]}function s(p){var m=p.callback,g=p.args;switch(g.length){case 0:m();break;case 1:m(g[0]);break;case 2:m(g[0],g[1]);break;case 3:m(g[0],g[1],g[2]);break;default:m.apply(void 0,g);break}}function u(p){var m=t[p];o(p),s(m)}function l(){i=function(p){process.nextTick(function(){u(p)})}}function c(){if(e&&e.postMessage&&!e.importScripts){var p=!0,m=e.onmessage;return e.onmessage=function(){p=!1},e.postMessage("","*"),e.onmessage=m,p}}function d(){var p="setImmediate$"+Math.random()+"$",m=function(g){g.source===e&&typeof g.data=="string"&&g.data.indexOf(p)===0&&u(+g.data.slice(p.length))};window.addEventListener?window.addEventListener("message",m,!1):window.attachEvent("onmessage",m),i=function(g){window.postMessage(p+g,"*")}}function f(){var p=new MessageChannel;p.port1.onmessage=function(m){var g=m.data;u(g)},i=function(m){p.port2.postMessage(m)}}function h(){var p=r.documentElement;i=function(m){var g=r.createElement("script");g.onreadystatechange=function(){u(m),g.onreadystatechange=null,p.removeChild(g),g=null},p.appendChild(g)}}function v(){i=function(p){setTimeout(u,0,p)}}return typeof process<"u"&&{}.toString.call(process)==="[object process]"?l():c()?d():typeof MessageChannel<"u"?f():r&&"onreadystatechange"in r.createElement("script")?h():v(),{setImmediate:a,clearImmediate:o}}var TM=function(){return typeof setImmediate<"u"?typeof window<"u"?{setImmediate:function(e){for(var t,r=[],n=1;n<arguments.length;n++)r[n-1]=arguments[n];return(t=window).setImmediate.apply(t,Ft([e],r))},clearImmediate:function(e){return window.clearImmediate(e)}}:{setImmediate,clearImmediate}:lAe()}();function cAe(e){TM.setImmediate(e)}var zk={setImmediate:TM.setImmediate,clearImmediate:TM.clearImmediate,immediatePromise:function(){return new Promise(cAe)},delay:function(e,t){return t===void 0&&(t=void 0),new Promise(function(r){return setTimeout(r,e,t)})}},$g=function(){try{return!0}catch{return!1}}(),Mr=function(){try{var t={}.DEBUG;return t==="*"||t==="molstar"}catch{return!1}}(),dAe=typeof performance<"u"&&performance.mark&&performance.measure,oP=dAe&&!$g,zy;(function(e){function t(o){return"startTask"+o.id}function r(o){return"endTask"+o.id}function n(o){oP&&performance.mark(t(o))}e.markStart=n;function i(o){oP&&performance.mark(r(o))}e.markEnd=i;function a(o){oP&&performance.measure("✳️ "+o.name,t(o),r(o))}e.measure=a})(zy||(zy={}));function fAe(e,t,r){r===void 0&&(r=250);var n=OY(e,t,r),i=new jY(n,n.root);return Vk(e,i)}function hAe(e,t,r){r===void 0&&(r=250);var n=OY(e,t,r);return new jY(n,n.root)}function RY(e,t){return Vk(t,e)}function pAe(e,t,r){return e.runChild(t,r)}function kY(e){return{taskId:e.id,taskName:e.name,message:"",startedTime:0,canAbort:!0,isIndeterminate:!0,current:0,max:0}}function OY(e,t,r){var n={abortRequested:!1,treeAborted:!1,reason:""};return{updateRateMs:r,lastNotified:Tn(),observer:t,abortToken:n,taskId:e.id,root:{progress:kY(e),children:[]},tryAbort:vAe(n)}}function vAe(e){return function(t){e.abortRequested=!0,e.reason=t||e.reason}}function LY(e){return{progress:E({},e.progress),children:e.children.map(LY)}}function NY(e){return e.progress.canAbort&&e.children.every(NY)}function mAe(e){return{root:LY(e.root),canAbort:NY(e.root),requestAbort:e.tryAbort}}function Vk(e,t){return ce(this,void 0,void 0,function(){var r,n;return de(this,function(i){switch(i.label){case 0:zy.markStart(e),t.node.progress.startedTime=Tn(),i.label=1;case 1:return i.trys.push([1,3,,7]),[4,e.f(t)];case 2:return r=i.sent(),zy.markEnd(e),zy.measure(e),t.info.abortToken.abortRequested&&FY(t.info),[2,r];case 3:return n=i.sent(),We.isAbort(n)?(t.isAborted=!0,t.node.children.length>0?[4,new Promise(function(a){t.onChildrenFinished=a})]:[3,5]):[3,6];case 4:i.sent(),i.label=5;case 5:e.onAbort&&e.onAbort(),i.label=6;case 6:throw Mr&&console.error(n),n;case 7:return[2]}})})}function FY(e){throw e.abortToken.treeAborted||(e.abortToken.treeAborted=!0,BY(e.root),UY(e,Tn())),We.Aborted(e.abortToken.reason)}function BY(e){var t=e.progress;t.isIndeterminate=!0,t.canAbort=!1,t.message="Aborting...";for(var r=0,n=e.children;r<n.length;r++){var i=n[r];BY(i)}}function UY(e,t){e.lastNotified=t;var r=mAe(e);e.observer(r)}var jY=function(){function e(t,r){this.isSynchronous=!1,this.isExecuting=!0,this.lastUpdatedTime=0,this.onChildrenFinished=void 0,this.node=r,this.info=t}return e.prototype.checkAborted=function(){this.info.abortToken.abortRequested&&(this.isAborted=!0,FY(this.info))},Object.defineProperty(e.prototype,"shouldUpdate",{get:function(){return this.checkAborted(),Tn()-this.lastUpdatedTime>this.info.updateRateMs},enumerable:!1,configurable:!0}),e.prototype.updateProgress=function(t){if(this.checkAborted(),!!t){var r=this.node.progress;typeof t=="string"?(r.message=t,r.isIndeterminate=!0):(typeof t.canAbort<"u"&&(r.canAbort=t.canAbort),typeof t.message<"u"&&(r.message=t.message),typeof t.current<"u"&&(r.current=t.current),typeof t.max<"u"&&(r.max=t.max),r.isIndeterminate=typeof r.current>"u"||typeof r.max>"u",typeof t.isIndeterminate<"u"&&(r.isIndeterminate=t.isIndeterminate))}},e.prototype.update=function(t,r){if(this.lastUpdatedTime=Tn(),this.updateProgress(t),!r)return UY(this.info,this.lastUpdatedTime),this.checkAborted(),zk.immediatePromise()},e.prototype.runChild=function(t,r){return ce(this,void 0,void 0,function(){var n,i,a,o,s,u,l;return de(this,function(c){switch(c.label){case 0:this.updateProgress(r),n={progress:kY(t),children:[]},i=this.node.children,i.push(n),a=new e(this.info,n),c.label=1;case 1:return c.trys.push([1,3,4,5]),[4,Vk(t,a)];case 2:return[2,c.sent()];case 3:if(o=c.sent(),We.isAbort(o)&&this.isAborted)return[2,void 0];throw o;case 4:if(s=i.indexOf(n),s>=0){for(u=s,l=i.length-1;u<l;u++)i[u]=i[u+1];i.pop()}return i.length===0&&this.onChildrenFinished&&this.onChildrenFinished(),[7];case 5:return[2]}})})},e}(),gAe=function(){function e(){this.shouldUpdate=!1,this.isSynchronous=!0}return e.prototype.update=function(t,r){},e}(),lS=new gAe,We;(function(e){var t=function(){function d(f,h,v){this.name=f,this.f=h,this.onAbort=v,this.id=c()}return d.prototype.run=function(f,h){return h===void 0&&(h=250),f?fAe(this,f,h):this.f(lS)},d.prototype.runAsChild=function(f,h){return f.isSynchronous?this.f(lS):pAe(f,this,h)},d.prototype.runInContext=function(f){return f.isSynchronous?this.f(lS):RY(f,this)},d}();function r(d){var f=d;return!!d&&typeof f.id=="number"&&typeof f.name=="string"&&!!f.run}e.is=r;function n(d){return!!d&&!!d.isAborted}e.isAbort=n;function i(d){return{isAborted:!0,reason:d,toString:function(){return"Aborted"+(d?": "+d:"")}}}e.Aborted=i;function a(d,f,h){return new t(d,f,h)}e.create=a;function o(d,f){var h=this;return a(d,function(v){return ce(h,void 0,void 0,function(){return de(this,function(p){return[2,f]})})})}e.constant=o;function s(){var d=this;return a("",function(f){return ce(d,void 0,void 0,function(){return de(this,function(h){return[2]})})})}e.empty=s;function u(d,f){var h=this;return a(d,function(v){return ce(h,void 0,void 0,function(){return de(this,function(p){throw new Error(f)})})})}e.fail=u;function l(d,f){return r(d)?f?d.runInContext(f):d.run():d}e.resolveInContext=l;var c=Fa(0,1073741823)})(We||(We={}));var Z8;(function(e){e.Synchronous=lS})(Z8||(Z8={}));var J8;(function(e){function t(n,i){i===void 0&&(i="");var a=n.progress;if(!n.children.length)return a.isIndeterminate?""+i+a.taskName+": "+a.message:""+i+a.taskName+": ["+a.current+"/"+a.max+"] "+a.message;var o=i+"  |_ ",s=n.children.map(function(u){return t(u,o)});return a.isIndeterminate?""+i+a.taskName+": "+a.message+`
`+s.join(`
`):""+i+a.taskName+": ["+a.current+"/"+a.max+"] "+a.message+`
`+s.join(`
`)}function r(n){return t(n.root)}e.format=r})(J8||(J8={}));function Oc(e,t,r,n,i){return ce(this,void 0,void 0,function(){var a,o,s,u,l,c,d;return de(this,function(f){switch(f.label){case 0:if(a=Math.max(t,0),o=0,s=0,e.isSynchronous)return n(Number.MAX_SAFE_INTEGER,r),[2,r];u=Tn(),l=0,c=0,f.label=1;case 1:return(l=n(a,r))>0?(o+=l,d=Tn()-u,c+=d,s+=d,e.shouldUpdate?[4,i(e,r,o)]:[3,3]):[3,4];case 2:f.sent(),a=Math.round(c*o/s)+1,u=Tn(),c=0,f.label=3;case 3:return[3,1];case 4:return e.shouldUpdate?[4,i(e,r,o)]:[3,6];case 5:f.sent(),f.label=6;case 6:return[2,r]}})})}function yAe(e){return e>>0}function hf(e,t){return e[t]|e[t+1]<<8}function Xh(e,t,r){e[t]=r&255,e[t+1]=r>>8&255}function Yh(e,t){return e[t+3]*(256*256*256)+(e[t+2]<<16|e[t+1]<<8|e[t])}function tc(e,t,r){e[t]=r&255,e[t+1]=r>>8&255,e[t+2]=r>>16&255,e[t+3]=r>>24&255}function bAe(e,t,r){for(var n="",i=0;i<r;i++)n+=String.fromCharCode(e[t+i]);return n}function xAe(e){return e.length<2?"0"+e:e}function SAe(e,t,r){for(var n="",i,a=0;a<r;a++)n+="%"+xAe(e[t+a].toString(16));try{i=decodeURIComponent(n)}catch{return bAe(e,t,r)}return i}function CAe(e,t,r){for(var n=r.length,i=0,a=0;a<n;a++){var o=r.charCodeAt(a);if(!(o&4294967295-(1<<7)+1))e[t+i]=o,i++;else if(!(o&4294967295-(1<<11)+1))e[t+i]=192|o>>6,e[t+i+1]=128|o>>0&63,i+=2;else if(!(o&4294967295-(1<<16)+1))e[t+i]=224|o>>12,e[t+i+1]=128|o>>6&63,e[t+i+2]=128|o>>0&63,i+=3;else if(!(o&4294967295-(1<<21)+1))e[t+i]=240|o>>18,e[t+i+1]=128|o>>12&63,e[t+i+2]=128|o>>6&63,e[t+i+3]=128|o>>0&63,i+=4;else throw"e"}return i}function zY(e){for(var t=e.length,r=0,n=0;n<t;n++){var i=e.charCodeAt(n);if(!(i&4294967295-(1<<7)+1))r++;else if(!(i&4294967295-(1<<11)+1))r+=2;else if(!(i&4294967295-(1<<16)+1))r+=3;else if(!(i&4294967295-(1<<21)+1))r+=4;else throw"e"}return r}var _Ae=function(){for(var e=new Uint32Array(256),t=0;t<256;t++){for(var r=t,n=0;n<8;n++)r&1?r=3988292384^r>>>1:r=r>>>1;e[t]=r}return e}();function wAe(e,t,r,n){for(var i=0;i<n;i++)e=_Ae[(e^t[r+i])&255]^e>>>8;return e}function VY(e,t,r){return wAe(4294967295,e,t,r)^4294967295}var bt=function(){var e=Uint16Array,t=Uint32Array;return{next_code:new e(16),bl_count:new e(16),ordr:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],of0:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],exb:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],ldef:new e(32),df0:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],dxb:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],ddef:new t(32),flmap:new e(512),fltree:[],fdmap:new e(32),fdtree:[],lmap:new e(32768),ltree:[],ttree:[],dmap:new e(32768),dtree:[],imap:new e(512),itree:[],rev15:new e(1<<15),lhst:new t(286),dhst:new t(30),ihst:new t(19),lits:new t(15e3),strt:new e(1<<16),prev:new e(1<<15)}}();(function(){for(var e=32768,t=0;t<e;t++){var r=t;r=(r&2863311530)>>>1|(r&1431655765)<<1,r=(r&3435973836)>>>2|(r&858993459)<<2,r=(r&4042322160)>>>4|(r&252645135)<<4,r=(r&4278255360)>>>8|(r&16711935)<<8,bt.rev15[t]=(r>>>16|r<<16)>>>17}function n(i,a,o){for(;a--!==0;)i.push(0,o)}for(var t=0;t<32;t++)bt.ldef[t]=bt.of0[t]<<3|bt.exb[t],bt.ddef[t]=bt.df0[t]<<4|bt.dxb[t];n(bt.fltree,144,8),n(bt.fltree,255-143,9),n(bt.fltree,279-255,7),n(bt.fltree,287-279,8),Of(bt.fltree,9),Vy(bt.fltree,9,bt.flmap),Hy(bt.fltree,9),n(bt.fdtree,32,5),Of(bt.fdtree,5),Vy(bt.fdtree,5,bt.fdmap),Hy(bt.fdtree,5),n(bt.itree,19,0),n(bt.ltree,286,0),n(bt.dtree,30,0),n(bt.ttree,320,0)})();function Vy(e,t,r){for(var n=e.length,i=bt.rev15,a=0;a<n;a+=2)if(e[a+1]!==0)for(var o=a>>1,s=e[a+1],u=o<<4|s,l=t-s,c=e[a]<<l,d=c+(1<<l);c!==d;){var f=i[c]>>>15-t;r[f]=u,c++}}function Of(e,t){for(var r=e.length,n=bt.bl_count,i=0;i<=t;i++)n[i]=0;for(var i=1;i<r;i+=2)n[e[i]]++;var a=bt.next_code,o=0;n[0]=0;for(var s=1;s<=t;s++)o=o+n[s-1]<<1,a[s]=o;for(var u=0;u<r;u+=2){var l=e[u+1];l!==0&&(e[u]=a[l],a[l]++)}}function Hy(e,t){for(var r=bt.rev15,n=15-t,i=0;i<e.length;i+=2){var a=e[i]<<t-e[i+1];e[i]=r[a]>>>n}}function EAe(e,t){var r=t===void 0;return t===void 0&&(t=new Uint8Array(e.length>>>2<<3)),{data:e,buf:t,noBuf:r,BFINAL:0,off:0,pos:0}}function AAe(e,t){for(var r=e.data,n=e.noBuf,i=e.buf,a=e.BFINAL,o=e.off,s=e.pos,u=0;a===0&&u<t;){var l=void 0,c=void 0,d=0,f=0;a=uP(r,s,1),u+=1;var h=uP(r,s+1,2);if(s+=3,h===0){s&7&&(s+=8-(s&7));var v=(s>>>3)+4,p=r[v-4]|r[v-3]<<8;n&&(i=sP(i,o+p)),i.set(new Uint8Array(r.buffer,r.byteOffset+v,p),o),s=v+p<<3,o+=p;continue}if(n&&(i=sP(i,o+(1<<17))),h===1)l=bt.flmap,c=bt.fdmap,d=(1<<9)-1,f=(1<<5)-1;else if(h===2){var m=tf(r,s,5)+257,g=tf(r,s+5,5)+1,y=tf(r,s+10,4)+4;s+=14;for(var b=0;b<38;b+=2)bt.itree[b]=0,bt.itree[b+1]=0;for(var S=1,b=0;b<y;b++){var x=tf(r,s+b*3,3);bt.itree[(bt.ordr[b]<<1)+1]=x,x>S&&(S=x)}s+=3*y,Of(bt.itree,S),Vy(bt.itree,S,bt.imap),l=bt.lmap,c=bt.dmap,s=TAe(bt.imap,(1<<S)-1,m+g,r,s,bt.ttree);var C=e7(bt.ttree,0,m,bt.ltree);d=(1<<C)-1;var w=e7(bt.ttree,m,g,bt.dtree);f=(1<<w)-1,Of(bt.ltree,C),Vy(bt.ltree,C,l),Of(bt.dtree,w),Vy(bt.dtree,w,c)}else throw new Error("unknown BTYPE "+h);for(;;){var A=l[IM(r,s)&d];s+=A&15;var M=A>>>4;if(!(M>>>8))i[o++]=M;else{if(M===256)break;var D=o+M-254;if(M>264){var k=bt.ldef[M-257];D=o+(k>>>3)+tf(r,s,k&7),s+=k&7}var R=c[IM(r,s)&f];s+=R&15;var L=R>>>4,H=bt.ddef[L],B=(H>>>4)+uP(r,s,H&15);for(s+=H&15,n&&(i=sP(i,o+(1<<17)));o<D;)i[o]=i[o++-B],i[o]=i[o++-B],i[o]=i[o++-B],i[o]=i[o++-B];o=D}}}e.buf=i,e.BFINAL=a,e.off=o,e.pos=s}function PAe(e,t,r){return ce(this,void 0,void 0,function(){var n;return de(this,function(i){switch(i.label){case 0:if(t[0]===3&&t[1]===0)return[2,r||new Uint8Array(0)];n=EAe(t,r),i.label=1;case 1:return n.BFINAL!==0?[3,4]:e.shouldUpdate?[4,e.update({message:"Inflating blocks...",current:n.pos,max:t.length})]:[3,3];case 2:i.sent(),i.label=3;case 3:return AAe(n,100),[3,1];case 4:return[2,n.buf.length===n.off?n.buf:n.buf.slice(0,n.off)]}})})}function sP(e,t){var r=e.length;if(t<=r)return e;var n=new Uint8Array(Math.max(r<<1,t));return n.set(e,0),n}function TAe(e,t,r,n,i,a){for(var o=0;o<r;){var s=e[IM(n,i)&t];i+=s&15;var u=s>>>4;if(u<=15)a[o]=u,o++;else{var l=0,c=0;u===16?(c=3+tf(n,i,2),i+=2,l=a[o-1]):u===17?(c=3+tf(n,i,3),i+=3):u===18&&(c=11+tf(n,i,7),i+=7);for(var d=o+c;o<d;)a[o]=l,o++}}return i}function e7(e,t,r,n){for(var i=0,a=0,o=n.length>>>1;a<r;){var s=e[a+t];n[a<<1]=0,n[(a<<1)+1]=s,s>i&&(i=s),a++}for(;a<o;)n[a<<1]=0,n[(a<<1)+1]=0,a++;return i}function tf(e,t,r){return(e[t>>>3]|e[(t>>>3)+1]<<8)>>>(t&7)&(1<<r)-1}function uP(e,t,r){return(e[t>>>3]|e[(t>>>3)+1]<<8|e[(t>>>3)+2]<<16)>>>(t&7)&(1<<r)-1}function IM(e,t){return(e[t>>>3]|e[(t>>>3)+1]<<8|e[(t>>>3)+2]<<16)>>>(t&7)}function lP(e,t,r){for(var n=[],i=e.length,a=t.length,o=0;o<a;o+=2)t[o]=0,t[o+1]=0;for(var o=0;o<i;o++)e[o]!==0&&n.push({lit:o,f:e[o],d:void 0});var s=n.length,u=n.slice(0);if(s===0)return 0;if(s===1){var l=n[0].lit,c=l===0?1:0;return t[(l<<1)+1]=1,t[(c<<1)+1]=1,1}n.sort(function(g,y){return g.f-y.f});var d=n[0],f=n[1],h=0,v=1,p=2;for(n[0]={lit:-1,f:d.f+f.f,l:d,r:f,d:0};v!==s-1;)h!==v&&(p===s||n[h].f<n[p].f)?d=n[h++]:d=n[p++],h!==v&&(p===s||n[h].f<n[p].f)?f=n[h++]:f=n[p++],n[v++]={lit:-1,f:d.f+f.f,l:d,r:f,d:void 0};var m=MM(n[v-1],0);m>r&&(IAe(u,r,m),m=r);for(var o=0;o<s;o++)t[(u[o].lit<<1)+1]=u[o].d;return m}function MM(e,t){return e.lit!==-1?(e.d=t,t):Math.max(MM(e.l,t+1),MM(e.r,t+1))}function IAe(e,t,r){var n=0,i=1<<r-t,a=0;for(e.sort(function(s,u){return u.d===s.d?s.f-u.f:u.d-s.d}),n=0;n<e.length&&e[n].d>t;n++){var o=e[n].d;e[n].d=t,a+=i-(1<<r-o)}for(a=a>>>r-t;a>0;){var o=e[n].d;o<t?(e[n].d++,a-=1<<t-o-1):n++}for(;n>=0;n--)e[n].d===t&&a<0&&(e[n].d--,a++);a!==0&&console.log("debt left")}function MAe(e,t,r,n){var i=bt.lits,a=bt.strt,o=bt.prev;return{data:e,out:t,opt:RAe[n],i:0,pos:r<<3,cvrd:0,dlen:e.length,li:0,lc:0,bs:0,ebits:0,c:0,nc:0,lits:i,strt:a,prev:o}}function DAe(e,t){for(var r=e.data,n=e.dlen,i=e.out,a=e.opt,o=e.i,s=e.pos,u=e.cvrd,l=e.li,c=e.lc,d=e.bs,f=e.ebits,h=e.c,v=e.nc,p=bt.lits,m=bt.strt,g=bt.prev,y=Math.min(o+t,n);o<y;o++){if(h=v,o+1<n-2){v=Hk(r,o+1);var b=o+1&32767;g[b]=m[v],m[v]=b}if(u<=o){(l>14e3||c>26697)&&n-o>100&&(u<o&&(p[l]=o-u,l+=2,u=o),s=HY(o===n-1||u===n?1:0,p,l,f,r,d,o-d,i,s),l=c=f=0,d=o);var S=0;if(o<n-2&&(S=OAe(r,o,g,h,Math.min(a[2],n-o),a[3])),S!==0){var x=S>>>16,C=S&65535,w=n7(x,bt.of0);bt.lhst[257+w]++;var A=n7(C,bt.df0);bt.dhst[A]++,f+=bt.exb[w]+bt.dxb[A],p[l]=x<<23|o-u,p[l+1]=C<<16|w<<8|A,l+=2,u=o+x}else bt.lhst[r[o]]++;c++}}e.i=o,e.pos=s,e.cvrd=u,e.li=l,e.lc=c,e.bs=d,e.ebits=f,e.c=h,e.nc=v}var RAe=[[0,0,0,0,0],[4,4,8,4,0],[4,5,16,8,0],[4,6,16,16,0],[4,10,16,32,0],[8,16,32,32,0],[8,16,128,128,0],[8,32,128,256,0],[32,128,258,1024,1],[32,258,258,4096,1]];function kAe(e,t,r,n,i){return ce(this,void 0,void 0,function(){var a,o,s,u,l,c,d,f,h,v,p,m;return de(this,function(g){switch(g.label){case 0:if(a=MAe(t,r,n,i),o=a.dlen,i===0){for(s=a.i,u=a.pos;s<o;)l=Math.min(65535,o-s),Kh(r,u,s+l===o?1:0),u=GY(t,s,l,r,u+8),s+=l;return[2,u>>>3]}o>2&&(a.nc=Hk(t,0),a.strt[a.nc]=0),g.label=1;case 1:return a.i<o?e.shouldUpdate?[4,e.update({message:"Deflating...",current:a.i,max:o})]:[3,3]:[3,4];case 2:g.sent(),g.label=3;case 3:return DAe(a,1024*1024),[3,1];case 4:for(c=a.li,d=a.cvrd,f=a.pos,h=a.i,v=a.lits,p=a.bs,m=a.ebits,(p!==h||t.length===0)&&(d<h&&(v[c]=h-d,c+=2,d=h),f=HY(1,v,c,m,t,p,h-p,r,f));f&7;)f++;return[2,f>>>3]}})})}function OAe(e,t,r,n,i,a){var o=t&32767,s=r[o],u=o-s+(1<<15)&32767;if(s===o||n!==Hk(e,t-u))return 0;for(var l=0,c=0,d=Math.min(32767,t);u<=d&&--a!==0&&s!==o;){if(l===0||e[t+l]===e[t+l-u]){var f=LAe(e,t,u);if(f>l){if(l=f,c=u,l>=i)break;u+2<f&&(f=u+2);for(var h=0,v=0;v<f-2;v++){var p=t-u+v+32768&32767,m=r[p],g=p-m+(1<<15)&32767;g>h&&(h=g,s=p)}}}o=s,s=r[o],u+=o-s+(1<<15)&32767}return l<<16|c}function LAe(e,t,r){if(e[t]!==e[t-r]||e[t+1]!==e[t+1-r]||e[t+2]!==e[t+2-r])return 0;var n=t,i=Math.min(e.length,t+258);for(t+=3;t<i&&e[t]===e[t-r];)t++;return t-n}function Hk(e,t){return(e[t]<<8|e[t+1])+(e[t+2]<<4)&65535}function HY(e,t,r,n,i,a,o,s,u){bt.lhst[256]++;var l=NAe(),c=l[0],d=l[1],f=l[2],h=l[3],v=l[4],p=l[5],m=l[6],g=l[7],y=(u+3&7?8-(u+3&7):0)+32+(o<<3),b=n+R0(bt.fltree,bt.lhst)+R0(bt.fdtree,bt.dhst),S=n+R0(bt.ltree,bt.lhst)+R0(bt.dtree,bt.dhst);S+=14+3*p+R0(bt.itree,bt.ihst)+(bt.ihst[16]*2+bt.ihst[17]*3+bt.ihst[18]*7);for(var x=0;x<286;x++)bt.lhst[x]=0;for(var x=0;x<30;x++)bt.dhst[x]=0;for(var x=0;x<19;x++)bt.ihst[x]=0;var C=y<b&&y<S?0:b<S?1:2;if(cS(s,u,e),cS(s,u+1,C),u+=3,C===0){for(;u&7;)u++;u=GY(i,a,o,s,u)}else{var w=void 0,A=void 0;if(C===1)w=bt.fltree,A=bt.fdtree;else if(C===2){Of(bt.ltree,c),Hy(bt.ltree,c),Of(bt.dtree,d),Hy(bt.dtree,d),Of(bt.itree,f),Hy(bt.itree,f),w=bt.ltree,A=bt.dtree,Kh(s,u,h-257),u+=5,Kh(s,u,v-1),u+=5,Kh(s,u,p-4),u+=4;for(var M=0;M<p;M++)Kh(s,u+M*3,bt.itree[(bt.ordr[M]<<1)+1]);u+=3*p,u=t7(m,bt.itree,s,u),u=t7(g,bt.itree,s,u)}else throw new Error("unknown BTYPE "+C);for(var D=a,k=0;k<r;k+=2){for(var R=t[k],L=R>>>23,H=D+(R&(1<<23)-1);D<H;)u=vy(i[D++],w,s,u);if(L!==0){var B=t[k+1],j=B>>16,Q=B>>8&255,G=B&255;u=vy(257+Q,w,s,u),Kh(s,u,L-bt.of0[Q]),u+=bt.exb[Q],u=vy(G,A,s,u),cS(s,u,j-bt.df0[G]),u+=bt.dxb[G],D+=L}}u=vy(256,w,s,u)}return u}function GY(e,t,r,n,i){var a=i>>>3;return n[a]=r,n[a+1]=r>>>8,n[a+2]=255-n[a],n[a+3]=255-n[a+1],a+=4,n.set(new Uint8Array(e.buffer,t,r),a),i+(r+4<<3)}function NAe(){for(var e=lP(bt.lhst,bt.ltree,15),t=lP(bt.dhst,bt.dtree,15),r=[],n=r7(bt.ltree,r),i=[],a=r7(bt.dtree,i),o=0;o<r.length;o+=2)bt.ihst[r[o]]++;for(var o=0;o<i.length;o+=2)bt.ihst[i[o]]++;for(var s=lP(bt.ihst,bt.itree,7),u=19;u>4&&bt.itree[(bt.ordr[u-1]<<1)+1]===0;)u--;return[e,t,s,n,a,u,r,i]}function R0(e,t){for(var r=0,n=0;n<t.length;n++)r+=t[n]*e[(n<<1)+1];return r}function t7(e,t,r,n){for(var i=0;i<e.length;i+=2){var a=e[i],o=e[i+1];n=vy(a,t,r,n);var s=a===16?2:a===17?3:7;a>15&&(Kh(r,n,o),n+=s)}return n}function r7(e,t){for(var r=e.length;r!==2&&e[r-1]===0;)r-=2;for(var n=0;n<r;n+=2){var i=e[n+1],a=n+3<r?e[n+3]:-1,o=n+5<r?e[n+5]:-1,s=n===0?-1:e[n-1];if(i===0&&a===i&&o===i){for(var u=n+5;u+2<r&&e[u+2]===i;)u+=2;var l=Math.min(u+1-n>>>1,138);l<11?t.push(17,l-3):t.push(18,l-11),n+=l*2-2}else if(i===s&&a===i&&o===i){for(var u=n+5;u+2<r&&e[u+2]===i;)u+=2;var l=Math.min(u+1-n>>>1,6);t.push(16,l-3),n+=l*2-2}else t.push(i,0)}return r>>>1}function n7(e,t){var r=0;return t[r|16]<=e&&(r|=16),t[r|8]<=e&&(r|=8),t[r|4]<=e&&(r|=4),t[r|2]<=e&&(r|=2),t[r|1]<=e&&(r|=1),r}function vy(e,t,r,n){return cS(r,n,t[e<<1]),n+t[(e<<1)+1]}function Kh(e,t,r){r=r<<(t&7);var n=t>>>3;e[n]|=r,e[n+1]|=r>>>8}function cS(e,t,r){r=r<<(t&7);var n=t>>>3;e[n]|=r,e[n+1]|=r>>>8,e[n+2]|=r>>>16}function qY(e,t,r){return r===void 0&&(r=!1),ce(this,void 0,void 0,function(){var n,i,a,o,s,u,l,c,d,f,h,v,p;return de(this,function(m){switch(m.label){case 0:for(n=Object.create(null),i=new Uint8Array(t),a=i.length-4;Yh(i,a)!==101010256;)a--;o=a,o+=4,o+=4,s=hf(i,o),o+=2,o+=2,o+=4,u=Yh(i,o),o+=4,o=u,l=0,m.label=1;case 1:return l<s?(o+=4,o+=4,o+=4,o+=4,o+=4,c=Yh(i,o),o+=4,d=Yh(i,o),o+=4,f=hf(i,o),h=hf(i,o+2),v=hf(i,o+4),o+=6,o+=8,p=Yh(i,o),o+=4,o+=f+h+v,[4,FAe(e,i,p,n,c,d,r)]):[3,4];case 2:m.sent(),m.label=3;case 3:return l++,[3,1];case 4:return[2,n]}})})}function FAe(e,t,r,n,i,a,o){return ce(this,void 0,void 0,function(){var s,u,l,c,d,f;return de(this,function(h){switch(h.label){case 0:return r+=4,r+=2,r+=2,s=hf(t,r),r+=2,r+=4,r+=4,r+=8,u=hf(t,r),r+=2,l=hf(t,r),r+=2,c=SAe(t,r,u),r+=u,r+=l,o?(n[c]={size:a,csize:i},[2]):(d=new Uint8Array(t.buffer,r),s!==0?[3,1]:(n[c]=new Uint8Array(d.buffer.slice(r,r+i)),[3,4]));case 1:return s!==8?[3,3]:(f=new Uint8Array(a),[4,WY(e,d,f)]);case 2:return h.sent(),n[c]=f,[3,4];case 3:throw"unknown compression method: "+s;case 4:return[2]}})})}function WY(e,t,r){return ce(this,void 0,void 0,function(){return de(this,function(n){return[2,PAe(e,t,r)]})})}function BAe(e,t,r){return ce(this,void 0,void 0,function(){var n,i,a,o,o,s,u,l,c,d;return de(this,function(f){switch(f.label){case 0:if(n=t[3],i=10,n&4&&(a=hf(t,i),i+=a),n&8){for(o=i;t[o]!==0;)++o;i=o+1}if(n&16){for(o=i;t[o]!==0;)++o;i=o+1}return n&1&&(i+=2),s=yAe(Yh(t,t.length-8)),u=Yh(t,t.length-4),r===void 0&&(r=new Uint8Array(u)),l=new Uint8Array(t.buffer,t.byteOffset+i,t.length-i-8),[4,WY(e,l,r)];case 1:return c=f.sent(),d=VY(c,0,c.length),s!==d&&console.error("ungzip: checksums don't match"),[2,c]}})})}function UAe(e,t,r){return ce(this,void 0,void 0,function(){var n,i;return de(this,function(a){switch(a.label){case 0:return r===void 0&&(r={level:6}),n=new Uint8Array(50+Math.floor(t.length*1.1)),[4,kAe(e,t,n,0,r.level)];case 1:return i=a.sent(),[2,new Uint8Array(n.buffer,0,i)]}})})}function jAe(e,t){return t===void 0&&(t=!1),We.create("Zip",function(r){return zAe(r,e,t)})}function zAe(e,t,r){return r===void 0&&(r=!1),ce(this,void 0,void 0,function(){var n,i,a,o,s,b,u,l,c,d,f,h,b,v,p,m,b,S,g,y,b,S,x,C;return de(this,function(w){switch(w.label){case 0:n=0,i={},a=[];for(o in t)a.push(o);s=0,w.label=1;case 1:return s<a.length?(b=a[s],u=!VAe(b)&&!r,l=t[b],c=VY(l,0,l.length),d=i,f=b,C={cpr:u,usize:l.length,crc:c},u?[4,UAe(e,l)]:[3,3]):[3,6];case 2:return h=w.sent(),[3,4];case 3:h=l,w.label=4;case 4:d[f]=(C.file=h,C),w.label=5;case 5:return s++,[3,1];case 6:for(b in i)n+=i[b].file.length+30+46+2*zY(b);n+=22,v=new Uint8Array(n),p=0,m=[];for(b in i)S=i[b],m.push(p),p=i7(v,p,b,S,0);g=0,y=p;for(b in i)S=i[b],m.push(p),p=i7(v,p,b,S,1,m[g++]);return x=p-y,tc(v,p,101010256),p+=4,p+=4,Xh(v,p,g),p+=2,Xh(v,p,g),p+=2,tc(v,p,x),p+=4,tc(v,p,y),p+=4,p+=2,[2,v.buffer]}})})}function VAe(e){var t=e.split(".").pop().toLowerCase();return"png,jpg,jpeg,zip".indexOf(t)!==-1}function i7(e,t,r,n,i,a){a===void 0&&(a=0);var o=n.file;tc(e,t,i===0?67324752:33639248),t+=4,i===1&&(t+=2),Xh(e,t,20),t+=2,Xh(e,t,0),t+=2,Xh(e,t,n.cpr?8:0),t+=2,tc(e,t,0),t+=4,tc(e,t,n.crc),t+=4,tc(e,t,o.length),t+=4,tc(e,t,n.usize),t+=4,Xh(e,t,zY(r)),t+=2,Xh(e,t,0),t+=2,i===1&&(t+=2,t+=2,t+=6,tc(e,t,a),t+=4);var s=CAe(e,t,r);return t+=s,i===0&&(e.set(o,t),t+=o.length),t}function wm(e,t,r){for(var n=0,i=r.length;n<i;n++){var a=r.charCodeAt(n);if(a<128){e[t++]=a>>>0&127|0;continue}if(a<2048){e[t++]=a>>>6&31|192,e[t++]=a>>>0&63|128;continue}if(a<65536){e[t++]=a>>>12&15|224,e[t++]=a>>>6&63|128,e[t++]=a>>>0&63|128;continue}if(a<1114112){e[t++]=a>>>18&7|240,e[t++]=a>>>12&63|128,e[t++]=a>>>6&63|128,e[t++]=a>>>0&63|128;continue}throw new Error("bad codepoint "+a)}}var HAe=function(){for(var e=[],t=0;t<1024;t++)e[t]=String.fromCharCode(t);return e}();function $Y(e){throw new Error(e)}function GAe(e,t,r){for(var n=HAe,i=void 0,a=[],o=512,s=0,u=t,l=t+r;u<l;u++){var c=e[u];c&128?(c&224)===192?a[s++]=n[(c&15)<<6|e[++u]&63]:(c&240)===224?a[s++]=String.fromCharCode((c&15)<<12|(e[++u]&63)<<6|(e[++u]&63)<<0):(c&248)===240?a[s++]=String.fromCharCode((c&7)<<18|(e[++u]&63)<<12|(e[++u]&63)<<6|(e[++u]&63)<<0):$Y("Invalid byte "+c.toString(16)):a[s++]=n[c],s===o&&(i=i||[],i[i.length]=a.join(""),s=0)}return i?(s>0&&(i[i.length]=a.slice(0,s).join("")),i.join("")):a.slice(0,s).join("")}var a7=typeof TextDecoder<"u"?new TextDecoder:void 0;function Gk(e,t,r){if(a7){var n=t||r!==e.length?e.subarray(t,t+r):e;return a7.decode(n)}else return GAe(e,t,r)}function zC(e){for(var t=0,r=0,n=e.length;r<n;r++){var i=e.charCodeAt(r);if(i<128){t+=1;continue}if(i<2048){t+=2;continue}if(i<65536){t+=3;continue}if(i<1114112){t+=4;continue}$Y("bad codepoint "+i)}return t}var qAe=typeof document>"u"?require("xhr2"):XMLHttpRequest,yu;(function(e){e[e.None=0]="None",e[e.Gzip=1]="Gzip",e[e.Zip=2]="Zip"})(yu||(yu={}));function pf(e,t){return KAe(e,t)}function DM(e){return typeof e=="string"?s7(e,e,"string"):s7(e.title,e.url,e.type||"string",e.body,e.headers)}function WAe(e){if(e instanceof FileReader)return e.readyState===FileReader.DONE;if(e instanceof XMLHttpRequest)return e.readyState===XMLHttpRequest.DONE;throw new Error("unknown data type")}function o7(e){return e?"Failed to download data. Possible reasons: Resource is not available, or CORS is not allowed on the server.":"Failed to open file."}function XY(e,t,r){return new Promise(function(n,i){if(WAe(r)){var a=r.error;a!=null?i(a??o7(r instanceof XMLHttpRequest)):n(r);return}var o=!1;r.onerror=function(s){if(!o){var u=s.target.error;i(u??o7(r instanceof XMLHttpRequest))}},r.onprogress=function(s){if(!(!e.shouldUpdate||o))try{s.lengthComputable?e.update({message:t,isIndeterminate:!1,current:s.loaded,max:s.total}):e.update({message:t+" "+(s.loaded/1024/1024).toFixed(2)+" MB",isIndeterminate:!0})}catch(u){o=!0,i(u)}},r.onload=function(s){n(r)}})}function $Ae(e){return/\.gz$/i.test(e)?yu.Gzip:/\.zip$/i.test(e)?yu.Zip:yu.None}function XAe(e,t,r){return ce(this,void 0,void 0,function(){var n,i,a;return de(this,function(o){switch(o.label){case 0:switch(n=r,n){case yu.None:return[3,1];case yu.Gzip:return[3,2];case yu.Zip:return[3,3]}return[3,5];case 1:return[2,t];case 2:return[2,BAe(e,t)];case 3:return[4,qY(e,t.buffer)];case 4:if(i=o.sent(),a=Object.keys(i),a.length!==1)throw new Error("can only decompress zip files with a single entry");return[2,i[a[0]]];case 5:return[2]}})})}function YAe(e,t,r,n){return ce(this,void 0,void 0,function(){var i,a,o,s;return de(this,function(u){switch(u.label){case 0:if(i=t.result,a=i instanceof ArrayBuffer?new Uint8Array(i):i,a===null)throw new Error("no data given");if(n===yu.None)return[3,4];if(!(a instanceof Uint8Array))throw new Error("need Uint8Array for decompression");return[4,XAe(e,a,n)];case 1:return o=u.sent(),r!=="string"?[3,3]:[4,e.update({message:"Decoding text..."})];case 2:return u.sent(),a=Gk(o,0,o.length),[3,4];case 3:a=o,u.label=4;case 4:return r==="binary"&&a instanceof Uint8Array?[2,a]:[3,5];case 5:return r==="zip"&&a instanceof Uint8Array?[4,qY(e,a.buffer)]:[3,7];case 6:return[2,u.sent()];case 7:if(r==="string"&&typeof a=="string")return[2,a];if(r==="xml"&&typeof a=="string")return s=new DOMParser,[2,s.parseFromString(a,"application/xml")];if(r==="json"&&typeof a=="string")return[2,JSON.parse(a)];u.label=8;case 8:throw new Error("could not get requested response data '"+r+"'")}})})}function KAe(e,t){var r=this,n=void 0;return We.create("Read File",function(i){return ce(r,void 0,void 0,function(){var a,o;return de(this,function(s){switch(s.label){case 0:return s.trys.push([0,,5,6]),n=new FileReader,a=t==="zip"?yu.None:$Ae(e.name),t==="binary"||t==="zip"||a!==yu.None?n.readAsArrayBuffer(e):n.readAsText(e),[4,i.update({message:"Opening file...",canAbort:!0})];case 1:return s.sent(),[4,XY(i,"Reading...",n)];case 2:return o=s.sent(),[4,i.update({message:"Processing file...",canAbort:!1})];case 3:return s.sent(),[4,YAe(i,o,t,a)];case 4:return[2,s.sent()];case 5:return n=void 0,[7];case 6:return[2]}})})},function(){n&&n.abort()})}var RM=function(){function e(){}return e.get=function(){return this.pool.length?this.pool.pop():new qAe},e.emptyFunc=function(){},e.deposit=function(t){this.pool.length<this.poolSize&&(t.onabort=e.emptyFunc,t.onerror=e.emptyFunc,t.onload=e.emptyFunc,t.onprogress=e.emptyFunc,this.pool.push(t))},e.pool=[],e.poolSize=15,e}();function QAe(e,t){if(e.status>=200&&e.status<400){var r=e.response;if(RM.deposit(e),(t==="binary"||t==="zip")&&r instanceof ArrayBuffer)return new Uint8Array(r);if(t==="string"&&typeof r=="string")return r;if(t==="xml"&&r instanceof XMLDocument)return r;if(t==="json"&&typeof r=="object")return r;throw new Error("could not get requested response data '"+t+"'")}else throw RM.deposit(e),new Error("Download failed with status code "+e.status)}function ZAe(e){switch(e){case"json":return"json";case"xml":return"document";case"string":return"text";case"binary":return"arraybuffer";case"zip":return"arraybuffer"}}function s7(e,t,r,n,i){var a=this,o=void 0;return We.create(e||"Download",function(s){return ce(a,void 0,void 0,function(){var u,l,c,d,f,h,v;return de(this,function(p){switch(p.label){case 0:if(o=RM.get(),o.open(n?"post":"get",t,!0),i)for(u=0,l=i;u<l.length;u++)c=l[u],d=c[0],f=c[1],o.setRequestHeader(d,f);return o.responseType=ZAe(r),o.send(n),[4,s.update({message:"Waiting for server...",canAbort:!0})];case 1:return p.sent(),[4,XY(s,"Downloading...",o)];case 2:return h=p.sent(),o=void 0,[4,s.update({message:"Parsing response...",canAbort:!1})];case 3:return p.sent(),v=QAe(h,r),[2,v]}})})},function(){o&&(o.abort(),o=void 0)})}function JAe(e,t,r,n){return ce(this,void 0,void 0,function(){var i,a,o,s,u,l,v,c,d,f,h,v,p;return de(this,function(m){switch(m.label){case 0:return i=r.length,a=new Array(r.length),[4,e.update({message:"Downloading...",current:0,max:i})];case 1:for(m.sent(),o=[],s=[],u=0,l=Math.min(i,n);u<l;u++)v=r[u],o.push(l7(u,v.id,t.resolve(Cn.getUrlAsset(t,v.url),v.isBinary?"binary":"string").runAsChild(e))),s.push(u);c=0,m.label=2;case 2:return o.length>0?[4,Promise.race(o)]:[3,6];case 3:if(d=m.sent(),f=r[d.index],h=s.indexOf(d.index),c++,d.kind==="error"&&!f.canFail)throw new Error(f.url+": "+d.error);return e.shouldUpdate?[4,e.update({message:"Downloading...",current:c,max:i})]:[3,5];case 4:m.sent(),m.label=5;case 5:return a[d.index]=d,o=o.filter(u7,h),s=s.filter(u7,h),u<i&&(v=r[u],p=t.resolve(Cn.getUrlAsset(t,v.url),v.isBinary?"binary":"string").runAsChild(e),o.push(l7(u,v.id,p)),s.push(u),u++),[3,2];case 6:return[2,a]}})})}function u7(e,t){return this!==t}function l7(e,t,r){return ce(this,void 0,void 0,function(){var n,i;return de(this,function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),[4,r];case 1:return n=a.sent(),[2,{kind:"ok",result:n,index:e,id:t}];case 2:return i=a.sent(),[2,{kind:"error",error:i,index:e,id:t}];case 3:return[2]}})})}var Cn;(function(e){function t(u,l){return E({kind:"url",id:dn.create22(),url:u},l)}e.Url=t;function r(u){return{kind:"file",id:dn.create22(),name:u.name,file:u}}e.File=r;function n(u){return(u==null?void 0:u.kind)==="url"}e.isUrl=n;function i(u){return(u==null?void 0:u.kind)==="file"}e.isFile=i;function a(u,l,c){return{data:u,dispose:function(){c.release(l)}}}e.Wrapper=a;function o(u){return typeof u=="string"?u:u.url}e.getUrl=o;function s(u,l,c){if(typeof l=="string"){var d=u.tryFindUrl(l,c);return d||t(l,{body:c})}return l}e.getUrlAsset=s})(Cn||(Cn={}));var ePe=function(){function e(){this._assets=new Map}return Object.defineProperty(e.prototype,"assets",{get:function(){return Nk(this._assets.values())},enumerable:!1,configurable:!0}),e.prototype.tryFindUrl=function(t,r){for(var n=this.assets.values();;){var i=n.next();if(i.done)return;var a=i.value.asset;if(Cn.isUrl(a)&&a.url===t&&(a.body||"")===(r||""))return a}},e.prototype.set=function(t,r){this._assets.set(t.id,{asset:t,file:r,refCount:0})},e.prototype.resolve=function(t,r,n){var i=this;return n===void 0&&(n=!0),Cn.isUrl(t)?We.create("Download "+(t.title||t.url),function(a){return ce(i,void 0,void 0,function(){var o,s,u,l,c,d,f,h,v;return de(this,function(p){switch(p.label){case 0:return this._assets.has(t.id)?(o=this._assets.get(t.id),o.refCount++,u=(s=Cn).Wrapper,[4,pf(o.file,r).runInContext(a)]):[3,2];case 1:return[2,u.apply(s,[p.sent(),t,this])];case 2:return n?[3,4]:(c=(l=Cn).Wrapper,[4,DM(E(E({},t),{type:r})).runInContext(a)]);case 3:return[2,c.apply(l,[p.sent(),t,this])];case 4:return[4,DM(E(E({},t),{type:"binary"})).runInContext(a)];case 5:return d=p.sent(),f=new File([d],"raw-data"),this._assets.set(t.id,{asset:t,file:f,refCount:1}),v=(h=Cn).Wrapper,[4,pf(f,r).runInContext(a)];case 6:return[2,v.apply(h,[p.sent(),t,this])]}})})}):We.create("Read "+t.name,function(a){return ce(i,void 0,void 0,function(){var o,s,u,l,c;return de(this,function(d){switch(d.label){case 0:return this._assets.has(t.id)?(o=this._assets.get(t.id),o.refCount++,u=(s=Cn).Wrapper,[4,pf(o.file,r).runInContext(a)]):[3,2];case 1:return[2,u.apply(s,[d.sent(),t,this])];case 2:if(!(t.file instanceof File))throw new Error("Cannot resolve file asset '"+t.name+"' ("+t.id+")");return n&&this._assets.set(t.id,{asset:t,file:t.file,refCount:1}),c=(l=Cn).Wrapper,[4,pf(t.file,r).runInContext(a)];case 3:return[2,c.apply(l,[d.sent(),t,this])]}})})})},e.prototype.release=function(t){var r=this._assets.get(t.id);r&&(r.refCount--,r.refCount<=0&&this._assets.delete(t.id))},e}(),I;(function(e){e.Essential={isEssential:!0};function t(ie,oe){return oe&&(oe.label&&(ie.label=oe.label),oe.description&&(ie.description=oe.description),oe.legend&&(ie.legend=oe.legend),oe.fieldLabels&&(ie.fieldLabels=oe.fieldLabels),oe.isHidden&&(ie.isHidden=oe.isHidden),oe.shortLabel&&(ie.shortLabel=oe.shortLabel),oe.twoColumns&&(ie.twoColumns=oe.twoColumns),oe.isEssential&&(ie.isEssential=oe.isEssential),oe.category&&(ie.category=oe.category),oe.hideIf&&(ie.hideIf=oe.hideIf),oe.help&&(ie.help=oe.help)),ie}function r(ie){var oe=E({},ie);return oe.isOptional=!0,oe}e.Optional=r;function n(ie,oe){return t({type:"value",defaultValue:ie},oe)}e.Value=n;function i(ie,oe,O){return t({type:"select",defaultValue:Se(ie,oe),options:oe,cycle:O==null?void 0:O.cycle},O)}e.Select=i;function a(ie,oe,O){var V=t({type:"multi-select",defaultValue:ie,options:oe},O);return O!=null&&O.emptyValue&&(V.emptyValue=O.emptyValue),V}e.MultiSelect=a;function o(ie,oe){return t({type:"boolean",defaultValue:ie},oe)}e.Boolean=o;function s(ie,oe){return ie===void 0&&(ie=""),t({type:"text",defaultValue:ie},oe)}e.Text=s;function u(ie,oe){var O=t({type:"color",defaultValue:ie},oe);return oe!=null&&oe.isExpanded&&(O.isExpanded=oe.isExpanded),O}e.Color=u;function l(ie,oe){var O;if(typeof ie=="string"){var V=Os(ie);O={kind:V.type!=="qualitative"?"interpolate":"set",colors:V.list}}else O=ie;return t({type:"color-list",presetKind:(oe==null?void 0:oe.presetKind)||"all",defaultValue:O,offsets:!!(oe!=null&&oe.offsets)},oe)}e.ColorList=l;function c(ie,oe,O){return t(p({type:"vec3",defaultValue:ie},oe),O)}e.Vec3=c;function d(ie,oe){return t({type:"mat4",defaultValue:ie},oe)}e.Mat4=d;function f(ie,oe){var O=typeof ie=="string"?Cn.Url(ie):Cn.Url(ie.url,{body:ie.body}),V=t({type:"url",defaultValue:O},oe);return V}e.Url=f;function h(ie){var oe=t({type:"file",defaultValue:null},ie);return ie!=null&&ie.accept&&(oe.accept=ie.accept),oe}e.File=h;function v(ie){var oe=t({type:"file-list",defaultValue:null},ie);return ie!=null&&ie.accept&&(oe.accept=ie.accept),oe}e.FileList=v;function p(ie,oe){return oe&&(typeof oe.min<"u"&&(ie.min=oe.min),typeof oe.max<"u"&&(ie.max=oe.max),typeof oe.step<"u"&&(ie.step=oe.step)),ie}function m(ie,oe,O){var V=t(p({type:"number",defaultValue:ie},oe),O);return O!=null&&O.immediateUpdate&&(V.immediateUpdate=!0),V}e.Numeric=m;function g(ie,oe,O){return t(p({type:"interval",defaultValue:ie},oe),O)}e.Interval=g;function y(ie,oe){return t({type:"line-graph",defaultValue:ie},oe)}e.LineGraph=y;function b(ie,oe){var O=t({type:"group",defaultValue:(oe==null?void 0:oe.customDefault)||j(ie),params:ie},oe);return oe!=null&&oe.isExpanded&&(O.isExpanded=oe.isExpanded),oe!=null&&oe.isFlat&&(O.isFlat=oe.isFlat),oe!=null&&oe.pivot&&(O.pivot=oe.pivot),O}e.Group=b;function S(ie){return b({},ie)}e.EmptyGroup=S;function x(ie,oe,O,V){var pe=Se(ie,oe);return t({type:"mapped",defaultValue:{name:pe,params:O(pe).defaultValue},select:i(pe,oe,V),map:O},V)}e.Mapped=x;function C(ie,oe,O){var V=O!=null&&O.options?O.options:Object.keys(oe).map(function(_e){return[_e,oe[_e].label||zo(_e)]}),pe=Se(ie,V);return t({type:"mapped",defaultValue:{name:pe,params:oe[pe].defaultValue},select:i(pe,V,O),map:function(_e){return oe[_e]}},O)}e.MappedStatic=C;function w(ie,oe,O){return t({type:"object-list",element:ie,getLabel:oe,ctor:A,defaultValue:(O==null?void 0:O.defaultValue)||[]},O)}e.ObjectList=w;function A(){return j(this.element)}function M(){throw new Error("getValue not set. Fix runtime.")}function D(ie,oe,O){var V;return t({type:"value-ref",defaultValue:{ref:(V=O==null?void 0:O.defaultRef)!==null&&V!==void 0?V:"",getValue:M},getOptions:ie,resolveRef:oe},O)}e.ValueRef=D;function k(ie){var oe;return t({type:"data-ref",defaultValue:{ref:(oe=ie==null?void 0:ie.defaultRef)!==null&&oe!==void 0?oe:"",getValue:M}},ie)}e.DataRef=k;function R(ie,oe,O){return{type:"converted",defaultValue:oe(O.defaultValue),converted:O,fromValue:ie,toValue:oe}}e.Converted=R;function L(ie,oe,O,V,pe){var _e=Object.keys(oe).map(function(Pe){return[Pe,Pe]});return t({type:"conditioned",select:i(O(ie),_e,pe),defaultValue:ie,conditionParams:oe,conditionForValue:O,conditionedValue:V},pe)}e.Conditioned=L;function H(ie,oe){return t({type:"script",defaultValue:ie},oe)}e.Script=H;function B(ie){return 0}e.For=B;function j(ie){for(var oe={},O=0,V=Object.keys(ie);O<V.length;O++){var pe=V[O];ie[pe].isOptional||(oe[pe]=ie[pe].defaultValue)}return oe}e.getDefaultValues=j;function Q(ie,oe){return function(){return ie(oe)}}function G(ie,oe,O){if(oe){if(ie.type==="value-ref"){var V=oe;V.ref?V.getValue=Q(ie.resolveRef,V.ref):V.getValue=function(){throw new Error("Unset ref in ValueRef value.")}}else if(ie.type==="data-ref"){var V=oe;V.ref?V.getValue=Q(O,V.ref):V.getValue=function(){throw new Error("Unset ref in ValueRef value.")}}else if(ie.type==="group")ee(ie.params,oe,O);else if(ie.type==="mapped"){var V=oe,pe=ie.map(V.name);G(pe,V.params,O)}else if(ie.type==="object-list"){if(!q(ie.element))return;for(var _e=0,Pe=oe;_e<Pe.length;_e++){var je=Pe[_e];ee(ie.element,je,O)}}}}function W(ie){if(ie.type==="value-ref"||ie.type==="data-ref")return!0;if(ie.type==="group"){if(q(ie.params))return!0}else if(ie.type==="mapped")for(var oe=0,O=ie.select.options;oe<O.length;oe++){var V=O[oe][0];if(W(ie.map(V)))return!0}else if(ie.type==="object-list")return q(ie.element);return!1}function q(ie){for(var oe=0,O=Object.keys(ie);oe<O.length;oe++){var V=O[oe];if(W(ie[V]))return!0}return!1}function ee(ie,oe,O){for(var V=0,pe=Object.keys(ie);V<pe.length;V++){var _e=pe[V];G(ie[_e],oe==null?void 0:oe[_e],O)}}e.resolveRefs=ee;function he(ie,oe){for(var O=0,V=Object.keys(ie);O<V.length;O++){var pe=V[O];ie[pe].isOptional||(ie[pe].defaultValue=oe[pe])}}e.setDefaultValues=he;function $(ie){return qf(ie)}e.clone=$;function X(ie,oe){}e.validate=X;function U(ie,oe,O){if(oe===O)return!0;if(typeof oe!="object"||typeof O!="object")return!1;for(var V=0,pe=Object.keys(ie);V<pe.length;V++){var _e=pe[V];if(!z(ie[_e],oe[_e],O[_e]))return!1}return!0}e.areEqual=U;function z(ie,oe,O){if(oe===O)return!0;if(ie.type==="group")return U(ie.params,oe,O);if(ie.type==="mapped"){var V=oe,pe=O;if(V.name!==pe.name)return!1;var _e=ie.map(V.name);return z(_e,V.params,pe.params)}else if(ie.type==="multi-select"){var V=oe,pe=O;if(V.length!==pe.length)return!1;if(V.length<10){for(var Pe=0,je=V.length;Pe<je;Pe++)if(V[Pe]!==pe[Pe]&&pe.indexOf(V[Pe])<0)return!1}else for(var ze=new Set(pe),Pe=0,je=V.length;Pe<je;Pe++)if(V[Pe]!==pe[Pe]&&!ze.has(V[Pe]))return!1;return!0}else{if(ie.type==="interval")return oe[0]===O[0]&&oe[1]===O[1];if(ie.type==="line-graph"){var V=oe,pe=O;if(V.length!==pe.length)return!1;for(var Pe=0,je=V.length;Pe<je;Pe++)if(!He.areEqual(V[Pe],pe[Pe]))return!1;return!0}else{if(ie.type==="vec3")return _.equals(oe,O);if(ie.type==="mat4")return ue.areEqual(oe,O,vn);if(ie.type==="script"){var V=oe,pe=O;return V.language===pe.language&&V.expression===pe.expression}else if(ie.type==="object-list"){var V=oe,pe=O,Xe=V.length;if(Xe!==pe.length)return!1;for(var Pe=0;Pe<Xe;Pe++)if(!U(ie.element,V[Pe],pe[Pe]))return!1;return!0}else if(typeof oe=="object"&&typeof O=="object")return xg(oe,O)}}return!1}e.isParamEqual=z;function J(ie,oe,O){if(oe===void 0)return E({},O);if(O===void 0)return E({},oe);for(var V=Object.create(null),pe=0,_e=Object.keys(ie);pe<_e.length;pe++){var Pe=_e[pe];V[Pe]=Y(ie[Pe],oe[Pe],O[Pe])}return V}e.merge=J;function Y(ie,oe,O){if(oe===void 0)return typeof O=="object"&&!Array.isArray(O)?E({},O):O;if(O===void 0)return typeof oe=="object"&&!Array.isArray(oe)?E({},oe):oe;if(ie.type==="group")return J(ie.params,oe,O);if(ie.type==="mapped"){var V=oe,pe=O;if(V.name!==pe.name)return E({},pe);var _e=ie.map(pe.name);return{name:pe.name,params:Y(_e,V.params,pe.params)}}else return ie.type==="value"?O:typeof oe=="object"&&typeof O=="object"?Array.isArray(O)?O:E(E({},oe),O):O}e.mergeParam=Y;function Z(ie,oe){for(var O=0,V=ie.options;O<V.length;O++){var pe=V[O];if(pe[0]===oe)return!0}return!1}function te(ie,oe,O){if(oe==null)return O?ie.defaultValue:void 0;if(ie.type==="value")return oe;if(ie.type==="group"){for(var V=Object.create(null),pe=0,_e=Object.keys(ie.params);pe<_e.length;pe++){var Pe=_e[pe],je=ie.params[Pe];oe[Pe]===void 0?O&&(V[Pe]=je.defaultValue):V[Pe]=te(je,oe[Pe],O)}return V}else if(ie.type==="mapped"){var ze=oe;if(typeof ze.name!="string")return ie.defaultValue;if(typeof ze.params>"u")return O?ie.defaultValue:void 0;if(!Z(ie.select,ze.name))return ie.defaultValue;var je=ie.map(ze.name);return{name:ze.name,params:te(je,ze.params,O)}}else{if(ie.type==="select")return Z(ie,oe)?oe:ie.defaultValue;if(ie.type==="multi-select"){if(!Array.isArray(oe))return ie.defaultValue;var V=oe.filter(function(ct){return Z(this,ct)},ie);return oe.length>0&&V.length===0?ie.defaultValue:V}else if(ie.type==="object-list")return Array.isArray(oe)?oe.map(function(Xe){return le(ie.element,Xe,O?"all":"skip")}):ie.defaultValue}return oe}function le(ie,oe,O){if(typeof oe!="object"||oe===null)return O?j(ie):oe;for(var V=Object.create(null),pe=0,_e=Object.keys(ie);pe<_e.length;pe++){var Pe=_e[pe],je=ie[Pe];oe[Pe]===void 0?O==="all"&&(V[Pe]=je.defaultValue):V[Pe]=te(je,oe[Pe],O!=="skip")}return V}e.normalizeParams=le;function ye(ie,oe){for(var O=[],V=0,pe=Object.keys(ie);V<pe.length;V++){var _e=pe[V];if(!oe)typeof ie[_e]=="string"?O.push([_e,ie[_e]]):O.push([_e,oe===null?_e:zo(_e)]);else{var Pe=oe(_e,ie[_e]);O.push(typeof Pe=="string"?[_e,Pe]:[_e,Pe[0],Pe[1]])}}return O}e.objectToOptions=ye;function be(ie,oe){for(var O=[],V=0,pe=ie;V<pe.length;V++){var _e=pe[V];oe?O.push([_e,oe(_e)]):O.push([_e,oe===null?_e:zo(_e)])}return O}e.arrayToOptions=be;function Ee(ie,oe){for(var O=0,V=ie.options;O<V.length;O++){var pe=V[O];if(pe[0]===oe)return pe[1]}return""}e.optionLabel=Ee;function Se(ie,oe){for(var O=0,V=oe;O<V.length;O++){var pe=V[O];if(pe[0]===ie)return ie}return oe.length>0?oe[0][0]:void 0}})(I||(I={}));var go;(function(e){function t(i){var a={create:function(o){return{action:a,params:o}},id:dn.create22(),definition:i,createDefaultParams:function(o,s){return i.params?I.getDefaultValues(i.params(o,s)):{}}};return a}e.create=t;function r(i){var a=i.definition;return t({from:a.from,display:a.display,params:a.params,isApplicable:i.definition.isApplicable?function(o,s,u){return i.definition.isApplicable(o,u)}:void 0,run:function(o){var s=o.cell,u=o.state,l=o.params,c=u.build().to(s.transform.ref).apply(i,l);return u.updateTree(c)}})}e.fromTransformer=r;var n;(function(i){function a(o){return function(s){return t(E({from:o.from instanceof Array?o.from:o.from?[o.from]:[],display:typeof o.display=="string"?{name:o.display}:o.display?o.display:{name:"Unnamed State Action"},params:typeof o.params=="object"?function(){return o.params}:o.params?o.params:void 0,isApplicable:o.isApplicable},typeof s=="function"?{run:s}:s))}}i.build=function(o){return a(o)}})(n=e.Builder||(e.Builder={})),e.build=n.build})(go||(go={}));var ft;(function(e){function t(p,m,g){return p.definition.params?p.definition.params(m,g):{}}e.getParamDefinition=t;function r(p){return!!p&&typeof p.toAction=="function"&&typeof p.apply=="function"}e.is=r;var n;(function(p){p[p.Unchanged=0]="Unchanged",p[p.Updated=1]="Updated",p[p.Recreate=2]="Recreate",p[p.Null=3]="Null"})(n=e.UpdateResult||(e.UpdateResult={}));var i=new Map,a=new Map;function o(p){for(var m=0,g=p.definition.from;m<g.length;m++){var y=g[m];a.has(y.type)?a.get(y.type).push(p):a.set(y.type,[p])}}function s(){return Array.from(i.values())}e.getAll=s;function u(p){var m=i.get(p);if(!m)throw new Error("A transformer with signature '"+p+"' is not registered.");return m}e.get=u;function l(p){return a.get(p)||[]}e.fromType=l;function c(p,m){var g=m.name,y=p+"."+g;if(i.has(y))throw new Error("A transform with id '"+g+"' is already registered. Please pick a unique identifier for your transforms and/or register them only once. This is to ensure that transforms can be serialized and replayed.");var b={apply:function(S,x,C){return cr.create(S,b,x,C)},toAction:function(){return go.fromTransformer(b)},namespace:p,id:y,definition:m,createDefaultParams:function(S,x){return m.params?I.getDefaultValues(m.params(S,x)):{}}};return i.set(y,b),o(b),b}e.create=c;function d(p){return function(m){return c(p,m)}}e.factory=d;function f(p){return h.build(p)}e.builderFactory=f;var h;(function(p){function m(y,b){return function(S){return c(y,E({name:b.name,from:b.from instanceof Array?b.from:[b.from],to:b.to instanceof Array?b.to:[b.to],display:typeof b.display=="string"?{name:b.display}:b.display?b.display:{name:Hg(b.name.replace(/[-]/g," "))},params:typeof b.params=="object"?function(){return b.params}:b.params?b.params:void 0,isDecorator:b.isDecorator},S))}}function g(y){return function(b){return m(y,b)}}p.build=g})(h=e.Builder||(e.Builder={}));function v(p){return h.build(p)}e.build=v,e.ROOT=c("build-in",{name:"root",from:[],to:[],display:{name:"Root",description:"For internal use."},apply:function(){throw new Error("should never be applied")},update:function(){return n.Unchanged}})})(ft||(ft={}));var cr;(function(e){e.RootRef="-=root=-";function t(m,g){return!!m.isHidden!=!!g.isHidden||!!m.isCollapsed!=!!g.isCollapsed||!!m.isGhost!=!!g.isGhost||!!m.isLocked!=!!g.isLocked}e.areStatesEqual=t;function r(m,g){return g?typeof g.isCollapsed<"u"&&m.isCollapsed!==g.isCollapsed||typeof g.isHidden<"u"&&m.isHidden!==g.isHidden||typeof g.isGhost<"u"&&m.isGhost!==g.isGhost||typeof g.isLocked<"u"&&m.isLocked!==g.isLocked:!1}e.isStateChange=r;function n(m,g){if(!g)return!1;for(var y=!1,b=0,S=Object.keys(g);b<S.length;b++){var x=S[b],C=g[x],w=m[x];!!C!=!!w&&(y=!0,m[x]=C)}return y}e.assignState=n;function i(m,g){if(!g)return!1;for(var y=!1,b=0,S=Object.keys(g);b<S.length;b++){var x=S[b],C=g[x],w=m[x];!!C!=!!w&&(y=!0,m[x]=C)}for(var A=0,M=Object.keys(m);A<M.length;A++){var x=M[A],C=g[x],w=m[x];!!C!=!!w&&(y=!0,m[x]=C)}return y}e.syncState=i;function a(m,g,y,b){var S=b&&b.ref?b.ref:dn.create22(),x=void 0;return b&&b.tags&&(x=typeof b.tags=="string"?[b.tags]:b.tags,x.length===0?x=void 0:x.sort()),{parent:m,transformer:g,state:(b==null?void 0:b.state)||{},tags:x,ref:S,dependsOn:b&&b.dependsOn,params:y,version:dn.create22()}}e.create=a;function o(m,g){return E(E({},m),{params:g,version:dn.create22()})}e.withParams=o;function s(m,g){return g?E(E({},m),{state:E(E({},m.state),g)}):m}e.withState=s;function u(m,g){var y=void 0;return g&&(y=typeof g=="string"?[g]:g,y.length===0?y=void 0:y.sort()),E(E({},m),{tags:y,version:dn.create22()})}e.withTags=u;function l(m,g){return E(E({},m),{parent:g,version:dn.create22()})}e.withParent=l;function c(m){return a(e.RootRef,ft.ROOT,{},{ref:e.RootRef,state:m})}e.createRoot=c;function d(m,g){return m.tags?m.tags.indexOf(g)>=0:!1}e.hasTag=d;function f(m,g){if(!m.tags)return typeof g!="string"&&g.length===0;if(typeof g=="string")return d(m,g);for(var y=0,b=g;y<b.length;y++){var S=b[y];if(m.tags.indexOf(S)<0)return!1}return!0}e.hasTags=f;function h(m){return m}function v(m){for(var g=m.transformer.definition.customSerialization?m.transformer.definition.customSerialization.toJSON:h,y=void 0,b=0,S=Object.keys(m.state);b<S.length;b++){var x=S[b],C=m.state[x];C&&(y||(y={}),y[x]=!0)}return{parent:m.parent,transformer:m.transformer.id,params:m.params?g(m.params):void 0,state:y,tags:m.tags,ref:m.ref,dependsOn:m.dependsOn,version:m.version}}e.toJSON=v;function p(m){var g=ft.get(m.transformer),y=g.definition.customSerialization?g.definition.customSerialization.fromJSON:h;return{parent:m.parent,transformer:g,params:m.params?y(m.params):void 0,state:m.state||{},tags:m.tags,ref:m.ref,dependsOn:m.dependsOn,version:m.version}}e.fromJSON=p})(cr||(cr={}));function Cl(e){for(var t=-1/0,r=0,n=e.length;r<n;++r)e[r]>t&&(t=e[r]);return t}function g3(e){for(var t=1/0,r=0,n=e.length;r<n;++r)e[r]<t&&(t=e[r]);return t}function Mo(e){for(var t=1/0,r=-1/0,n=0,i=e.length;n<i;++n)e[n]<t&&(t=e[n]),e[n]>r&&(r=e[n]);return[t,r]}function Gy(e,t,r){t===void 0&&(t=1),r===void 0&&(r=0);for(var n=e.length,i=0,a=r;a<n;a+=t)i+=e[a];return i}function y3(e,t,r){return t===void 0&&(t=1),r===void 0&&(r=0),Gy(e,t,r)/(e.length/t)}function b3(e){for(var t=e.length,r=0,n=0;n<t;++n){var i=e[n];r+=i*i}return Math.sqrt(r/t)}function Fs(e,t){for(var r=0,n=t?Math.min(t,e.length):e.length;r<n;++r)e[r]=r;return e}function j1(e,t){for(var r=0,n=e.length,i=!1;r<n;r++)if(e[r]===t){i=!0;break}return i?(z1(e,r),!0):!1}function z1(e,t){for(var r=t,n=e.length-1;r<n;r++)e[r]=e[r+1];e.pop()}function Pa(e,t){return e.indexOf(t)>=0?!1:(e.push(t),!0)}function yp(e,t){var r=e.indexOf(t);if(r<0)return!1;for(var n=r,i=e.length-1;n<i;n++)e[n]=e[n+1];return e.pop(),!0}function VC(e,t){for(var r=0,n=0,i=e.length;n<i;++n)t.includes(e[n])&&(r+=1);return r}function qk(e,t){if(!e||e.length===0)return!t||t.length===0;if(!t)return!1;var r=e.length;if(r!==t.length)return!1;for(var n=0;n<r;n++)if(e[n]!==t[n])return!1;return!0}function tPe(e){for(var t=0,r=e.length;t<r;t++)if(e[t]!==t)return!1;return!0}function rPe(e,t,r){for(var n=0,i=e.length;n<i;++n)if(e[n][0]===t){e[n][1]=r;return}e.push([t,r])}var nPe=function(){function e(t){this.tree=t,this.transforms=this.tree.transforms,this.children=this.tree.children,this.dependencies=this.tree.dependencies,this.changedNodes=!1,this.changedChildren=!1,this.changedDependencies=!1,this._childMutations=void 0,this._dependencyMutations=void 0,this._stateUpdates=void 0}return Object.defineProperty(e.prototype,"childMutations",{get:function(){return this._childMutations?this._childMutations:(this._childMutations=new Map,this._childMutations)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"dependencyMutations",{get:function(){return this._dependencyMutations?this._dependencyMutations:(this._dependencyMutations=new Map,this._dependencyMutations)},enumerable:!1,configurable:!0}),e.prototype.changeNodes=function(){this.changedNodes||(this.changedNodes=!0,this.transforms=this.transforms.asMutable())},e.prototype.changeChildren=function(){this.changedChildren||(this.changedChildren=!0,this.children=this.children.asMutable())},e.prototype.changeDependencies=function(){this.changedDependencies||(this.changedDependencies=!0,this.dependencies=this.dependencies.asMutable())},Object.defineProperty(e.prototype,"root",{get:function(){return this.transforms.get(cr.RootRef)},enumerable:!1,configurable:!0}),e.prototype.asTransient=function(){return this.asImmutable().asTransient()},e.prototype.addChild=function(t,r){if(this.changeChildren(),this.childMutations.has(t))this.childMutations.get(t).add(r);else{var n=this.children.get(t).asMutable();n.add(r),this.children.set(t,n),this.childMutations.set(t,n)}},e.prototype.removeChild=function(t,r){if(this.changeChildren(),this.childMutations.has(t))this.childMutations.get(t).remove(r);else{var n=this.children.get(t).asMutable();n.remove(r),this.children.set(t,n),this.childMutations.set(t,n)}},e.prototype.clearRoot=function(){var t=cr.RootRef;if(this.children.get(t).size!==0){this.changeChildren();var r=ri.OrderedSet();this.children.set(t,r),this.childMutations.set(t,r)}},e.prototype.mutateDependency=function(t,r,n){var i=this.dependencyMutations.get(t);if(!i){var a=this.dependencies.get(t);if(!a&&n==="remove")return;this.changeDependencies(),i=a?a.asMutable():ri.OrderedSet().asMutable(),this.dependencyMutations.set(t,i),this.dependencies.set(t,i)}n==="add"?i.add(r):i.remove(r)},e.prototype.changeParent=function(t,r){F2(this.transforms,t);var n=this.transforms.get(t);this.removeChild(n.parent,t),this.addChild(r,t),this.changeNodes(),this.transforms.set(t,cr.withParent(n,r))},e.prototype.add=function(t){var r=t.ref;if(this.transforms.has(t.ref)){var n=this.transforms.get(t.ref);n.parent!==t.parent&&oPe(t.ref)}var i=this.children.get(t.parent);if(i||sPe(t.parent),i.has(t.ref)||this.addChild(t.parent,t.ref),this.children.has(t.ref)||(this.changedChildren||(this.changedChildren=!0,this.children=this.children.asMutable()),this.children.set(t.ref,ri.OrderedSet())),this.changeNodes(),this.transforms.set(r,t),t.dependsOn)for(var a=0,o=t.dependsOn;a<o.length;a++){var s=o[a];this.mutateDependency(s,r,"add")}return this},e.prototype.setParams=function(t,r){F2(this.transforms,t);var n=this.transforms.get(t);return jk(n.params,r)?!1:(this.changedNodes||(this.changedNodes=!0,this.transforms=this.transforms.asMutable()),this.transforms.set(n.ref,cr.withParams(n,r)),!0)},e.prototype.setTags=function(t,r){F2(this.transforms,t);var n=this.transforms.get(t),i=cr.withParams(n,r);return qk(n.tags,i.tags)?!1:(this.changedNodes||(this.changedNodes=!0,this.transforms=this.transforms.asMutable()),this.transforms.set(n.ref,i),!0)},e.prototype.assignState=function(t,r){F2(this.transforms,t);var n=this.transforms.get(t);if(this._stateUpdates&&this._stateUpdates.has(t))return cr.assignState(n.state,r),n;this._stateUpdates||(this._stateUpdates=new Set),this._stateUpdates.add(n.ref),this.changeNodes();var i=cr.withState(n,r);return this.transforms.set(t,i),i},e.prototype.remove=function(t){var r=this.transforms.get(t);if(!r)return[];var n=ii.subtreePostOrder(this,r);if(t===cr.RootRef){if(n.pop(),n.length===0)return n;this.clearRoot()}else{if(n.length===0)return n;this.removeChild(r.parent,r.ref)}this.changeNodes(),this.changeChildren();for(var i=0,a=n;i<a.length;i++){var o=a[i];this.transforms.delete(o.ref),this.children.delete(o.ref),this._childMutations&&this._childMutations.delete(o.ref)}for(var s=[],u=0,l=n;u<l.length;u++){var o=l[u];if(o.dependsOn)for(var c=0,d=o.dependsOn;c<d.length;c++){var f=d[c];this.transforms.has(f)&&this.mutateDependency(f,o.ref,"remove")}if(this.dependencies.has(o.ref)){var h=this.dependencies.get(o.ref).toArray();this.changeDependencies(),this.dependencies.delete(o.ref),this._dependencyMutations&&this._dependencyMutations.delete(o.ref);for(var v=0,p=h;v<p.length;v++){var m=p[v];if(this.transforms.has(m))for(var g=0,y=this.remove(m);g<y.length;g++){var b=y[g];s[s.length]=b}}}}for(var S=0,x=s;S<x.length;S++){var m=x[S];n[n.length]=m}return n},e.prototype.asImmutable=function(){return!this.changedNodes&&!this.changedChildren&&!this._childMutations?this.tree:(this._childMutations&&this._childMutations.forEach(iPe,this.children),this._dependencyMutations&&this._dependencyMutations.forEach(aPe,this.dependencies),ii.create(this.changedNodes?this.transforms.asImmutable():this.transforms,this.changedChildren?this.children.asImmutable():this.children,this.changedDependencies?this.dependencies.asImmutable():this.dependencies))},e}();function iPe(e,t){this.set(t,e.asImmutable())}function aPe(e,t){e.size===0?this.delete(t):this.set(t,e.asImmutable())}function oPe(e){throw new Error("Transform '"+e+"' is already present in the tree.")}function sPe(e){throw new Error("Parent '"+e+"' must be present in the tree.")}function F2(e,t){if(!e.has(t))throw new Error("Node '"+t+"' is not present in the tree.")}var ii;(function(e){var t=function(){function b(S,x,C){this.transforms=S,this.children=x,this.dependencies=C}return Object.defineProperty(b.prototype,"root",{get:function(){return this.transforms.get(cr.RootRef)},enumerable:!1,configurable:!0}),b.prototype.asTransient=function(){return new nPe(this)},b}();function r(b){var S=b||cr.createRoot();return n(ri.Map([[S.ref,S]]),ri.Map([[S.ref,ri.OrderedSet()]]),ri.Map())}e.createEmpty=r;function n(b,S,x){return new t(b,S,x)}e.create=n;function i(b){a(this,this.tree.transforms.get(b))}function a(b,S){var x=b.tree.children.get(S.ref);x&&x.size&&x.forEach(i,b),b.f(S,b.tree,b.state)}function o(b,S,x,C){var w={tree:b,state:x,f:C};return a(w,S),w.state}e.doPostOrder=o;function s(b){u(this,this.tree.transforms.get(b))}function u(b,S){var x=b.f(S,b.tree,b.state);if(!(typeof x=="boolean"&&!x)){var C=b.tree.children.get(S.ref);C&&C.size&&C.forEach(s,b)}}function l(b,S,x,C){var w={tree:b,state:x,f:C};return u(w,S),w.state}e.doPreOrder=l;function c(b,S,x){x.push(b)}function d(b,S){return o(b,S,[],c)}e.subtreePostOrder=d;function f(b,S,x){x.push(cr.toJSON(b))}function h(b){var S=[];return l(b,b.root,S,f),{transforms:S}}e.toJSON=h;function v(b){for(var S=ri.Map().asMutable(),x=ri.Map().asMutable(),C=ri.Map().asMutable(),w=0,A=b.transforms;w<A.length;w++){var M=A[w],D=cr.fromJSON(M);S.set(D.ref,D),x.has(D.ref)||x.set(D.ref,ri.OrderedSet().asMutable()),D.ref!==D.parent&&x.get(D.parent).add(D.ref)}for(var k=new Set,R=0,L=b.transforms;R<L.length;R++){var M=L[R],H=M.ref;if(x.set(H,x.get(H).asImmutable()),!!M.dependsOn)for(var B=0,j=M.dependsOn;B<j.length;B++){var Q=j[B];k.add(Q),C.has(Q)?C.get(Q).add(H):C.set(Q,ri.OrderedSet([H]).asMutable())}}return k.forEach(function(G){C.set(G,C.get(G).asImmutable())}),n(S.asImmutable(),x.asImmutable(),C.asImmutable())}e.fromJSON=v;function p(b){console.log({tr:b.transforms.keySeq().toArray(),tr1:b.transforms.valueSeq().toArray().map(function(S){return S.ref}),ch:b.children.keySeq().toArray()})}e.dump=p;function m(b,S,x){if(S===x)return!0;for(var C=b.children.get(S),w=C.values();;){var A=w.next();if(A.done)return!1;if(m(b,A.value,x))return!0}}function g(b,S,x){return!b.transforms.has(S)||!b.transforms.has(x)?!1:m(b,S,x)}e.subtreeHasRef=g;function y(b,S){var x=b.children.get(S);if(x.size!==1)return S;var C=b.transforms.get(x.first());return C.transformer.definition.isDecorator?y(b,C.ref):S}e.getDecoratorRoot=y})(ii||(ii={}));var ir;(function(e){function t(U,z){return r(U)(z)}e.select=t;function r(U){var z=U||l.root,J;return i(z)?J=z.compile():n(z)?J=l.byValue(z).compile():a(z)?J=z:J=l.byRef(z).compile(),J}e.compile=r;function n(U){return U.transform!==void 0&&U.status!==void 0}function i(U){return U.compile!==void 0}function a(U){return typeof U=="function"}var o={select:function(U){return t(this,U||this.state)}};function s(U,z){o[U]=function(){for(var J=[],Y=0;Y<arguments.length;Y++)J[Y]=arguments[Y];return z.call.apply(z,Ft([void 0,this],J))}}function u(U){return Object.create(o,{compile:{writable:!1,configurable:!1,value:U}})}var l;(function(U){U.root=u(function(){return function(ie){return[ie.cells.get(ie.tree.root.ref)]}});function z(){for(var ie=[],oe=0;oe<arguments.length;oe++)ie[oe]=arguments[oe];return u(function(){return function(O){for(var V=[],pe=0,_e=ie;pe<_e.length;pe++){var Pe=_e[pe],je=O.cells.get(Pe);je&&V.push(je)}return V}})}U.byRef=z;function J(){for(var ie=[],oe=0;oe<arguments.length;oe++)ie[oe]=arguments[oe];return u(function(){return function(O){return ie}})}U.byValue=J;function Y(ie,oe){return oe===void 0&&(oe=cr.RootRef),u(function(){return function(O){var V={roots:[],cells:O.cells,type:ie.type};return ii.doPreOrder(O.tree,O.tree.transforms.get(oe),V,ye),V.roots}})}U.rootsOfType=Y;function Z(ie,oe){return oe===void 0&&(oe=cr.RootRef),u(function(){return function(O){var V={ret:[],cells:O.cells,type:ie.type};return ii.doPreOrder(O.tree,O.tree.transforms.get(oe),V,be),V.ret}})}U.ofType=Z;function te(ie,oe){return oe===void 0&&(oe=cr.RootRef),u(function(){return function(O){var V={ret:[],cells:O.cells,t:ie};return ii.doPreOrder(O.tree,O.tree.transforms.get(oe),V,Ee),V.ret}})}U.ofTransformer=te;function le(ie,oe){return oe===void 0&&(oe=cr.RootRef),u(function(){return function(O){var V={ret:[],cells:O.cells,t:ie};return ii.doPreOrder(O.tree,O.tree.transforms.get(oe),V,Se),V.ret}})}U.ofTransformerWithError=le;function ye(ie,oe,O){var V=O.cells.get(ie.ref);return V&&V.obj&&V.obj.type===O.type?(O.roots.push(V),!1):!0}function be(ie,oe,O){var V=O.cells.get(ie.ref);return V&&V.obj&&V.obj.type===O.type&&O.ret.push(V),!0}function Ee(ie,oe,O){var V=O.cells.get(ie.ref);return V&&V.obj&&V.transform.transformer===O.t&&O.ret.push(V),!0}function Se(ie,oe,O){var V=O.cells.get(ie.ref);return V&&V.status==="error"&&V.transform.transformer===O.t&&O.ret.push(V),!0}})(l=e.Generators||(e.Generators={})),s("flatMap",c);function c(U,z){var J=r(U);return u(function(){return function(Y){for(var Z=[],te=0,le=J(Y);te<le.length;te++)for(var ye=le[te],be=0,Ee=z(ye,Y);be<Ee.length;be++){var Se=Ee[be];Z.push(Se)}return Z}})}e.flatMap=c,s("mapObject",d);function d(U,z){var J=r(U);return u(function(){return function(Y){for(var Z=[],te=0,le=J(Y);te<le.length;te++){var ye=le[te],be=z(ye,Y);be&&Z.push(be)}return Z}})}e.mapObject=d,s("unique",f);function f(U){var z=r(U);return u(function(){return function(J){for(var Y=new Set,Z=[],te=0,le=z(J);te<le.length;te++){var ye=le[te];ye&&(Y.has(ye.transform.ref)||(Y.add(ye.transform.ref),Z.push(ye)))}return Z}})}e.unique=f,s("first",h);function h(U){var z=r(U);return u(function(){return function(J){var Y=z(J);return Y.length?[Y[0]]:[]}})}e.first=h,s("filter",v);function v(U,z){return c(U,function(J){return z(J)?[J]:[]})}e.filter=v,s("withStatus",p);function p(U,z){return v(U,function(J){return J.status===z})}e.withStatus=p,s("withTag",m);function m(U,z){return v(U,function(J){return!!J.transform.tags&&J.transform.tags.indexOf(z)>=0})}e.withTag=m,s("subtree",g);function g(U){return c(U,function(z,J){var Y=[];return ii.doPreOrder(J.tree,J.tree.transforms.get(z.transform.ref),Y,function(Z,te,le){le.push(Z.ref)}),Y.map(function(Z){return J.cells.get(Z)})})}e.subtree=g,s("children",y);function y(U){return c(U,function(z,J){var Y=[];return J.tree.children.get(z.transform.ref).forEach(function(Z){return Y.push(J.cells.get(Z))}),Y})}e.children=y,s("ofType",b);function b(U,z){return v(U,function(J){return J.obj?J.obj.type===z.type:!1})}e.ofType=b,s("ancestor",S);function S(U,z){return f(d(U,function(J,Y){return R(Y.tree,Y.cells,J.transform.ref,z)}))}e.ancestor=S,s("ancestorOfType",x);function x(U,z){return f(d(U,function(J,Y){return B(Y.tree,Y.cells,J.transform.ref,z)}))}e.ancestorOfType=x,s("ancestorWithTransformer",C);function C(U,z){return f(d(U,function(J,Y){return H(Y.tree,Y.cells,J.transform.ref,z)}))}e.ancestorWithTransformer=C,s("withTransformer",w);function w(U,z){return v(U,function(J){return J.transform.transformer===z})}e.withTransformer=w,s("root",A);function A(U,z){return f(d(U,function(J,Y){return L(Y.tree,Y.cells,J.transform.ref,z)}))}e.root=A,s("rootOfType",M);function M(U,z){return f(d(U,function(J,Y){return j(Y.tree,Y.cells,J.transform.ref,z)}))}e.rootOfType=M,s("parent",D);function D(U){return f(d(U,function(z,J){return J.cells.get(J.tree.transforms.get(z.transform.ref).parent)}))}e.parent=D;function k(U,z,J,Y,Z){for(var te=U.transforms.get(J),le=void 0;;){te=U.transforms.get(te.parent);var ye=z.get(te.ref);if(ye.obj&&Y(ye)&&(le=ye,Z)||te.ref===cr.RootRef)return le}}function R(U,z,J,Y){return k(U,z,J,Y,!0)}e.findAncestor=R;function L(U,z,J,Y){return k(U,z,J,Y,!1)}e.findRoot=L;function H(U,z,J,Y){return R(U,z,J,Array.isArray(Y)?function(Z){return Y.indexOf(Z.transform.transformer)>=0}:function(Z){return Z.transform.transformer===Y})}e.findAncestorWithTransformer=H;function B(U,z,J,Y){return R(U,z,J,Q(Y))}e.findAncestorOfType=B;function j(U,z,J,Y){return L(U,z,J,Q(Y))}e.findRootOfType=j;function Q(U){return Array.isArray(U)?function(z){for(var J=0,Y=U;J<Y.length;J++){var Z=Y[J];if(Z.type===z.obj.type)return!0}}:function(z){return z.obj.type===U.type}}function G(U,z,J){return ii.doPreOrder(U,U.transforms.get(z),{refs:{},tags:J},W).refs}e.findUniqueTagsInSubtree=G;function W(U,z,J){if(U.tags)for(var Y=0,Z=U.tags;Y<Z.length;Y++){var te=Z[Y];if(J.tags.has(te)){J.refs[te]=U.ref;break}}return!0}function q(U,z,J){return ii.doPreOrder(U,U.transforms.get(z),{ref:void 0,tag:J},ee).ref}e.findTagInSubtree=q;function ee(U,z,J){return U.tags&&U.tags.indexOf(J.tag)>=0?(J.ref=U.ref,!1):!0}function he(U,z,J){return ii.doPreOrder(U,U.transforms.get(z),{refs:[],tags:J},$).refs}e.findWithAllTags=he;function $(U,z,J){if(U.tags)for(var Y=J.tags.size,Z=0,te=0,le=U.tags;te<le.length;te++){var ye=le[te];if(J.tags.has(ye)&&(Z++,Z===Y)){J.refs.push(U);break}}else J.tags.size===0&&J.refs.push(U)}function X(U,z,J){var Y=U.transforms.get(z);if(Y.transformer===J)return U.cells.get(z);var Z=U.tree.children.get(z);if(Z.size===1){var te=Z.first();if(U.transforms.get(te).transformer.definition.isDecorator)return X(U,te,J)}}e.tryFindDecorator=X})(ir||(ir={}));/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var kM=function(e,t){return kM=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var i in n)n.hasOwnProperty(i)&&(r[i]=n[i])},kM(e,t)};function ha(e,t){kM(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}function OM(e){return typeof e=="function"}var c7=!1,rl={Promise:void 0,set useDeprecatedSynchronousErrorHandling(e){if(e){var t=new Error;""+t.stack}c7=e},get useDeprecatedSynchronousErrorHandling(){return c7}};function Em(e){setTimeout(function(){throw e},0)}var HC={closed:!0,next:function(e){},error:function(e){if(rl.useDeprecatedSynchronousErrorHandling)throw e;Em(e)},complete:function(){}},uPe=function(){return Array.isArray||function(e){return e&&typeof e.length=="number"}}();function YY(e){return e!==null&&typeof e=="object"}var lPe=function(){function e(t){return Error.call(this),this.message=t?t.length+` errors occurred during unsubscription:
`+t.map(function(r,n){return n+1+") "+r.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=t,this}return e.prototype=Object.create(Error.prototype),e}(),dS=lPe,_l=function(){function e(t){this.closed=!1,this._parentOrParents=null,this._subscriptions=null,t&&(this._ctorUnsubscribe=!0,this._unsubscribe=t)}return e.prototype.unsubscribe=function(){var t;if(!this.closed){var r=this,n=r._parentOrParents,i=r._ctorUnsubscribe,a=r._unsubscribe,o=r._subscriptions;if(this.closed=!0,this._parentOrParents=null,this._subscriptions=null,n instanceof e)n.remove(this);else if(n!==null)for(var s=0;s<n.length;++s){var u=n[s];u.remove(this)}if(OM(a)){i&&(this._unsubscribe=void 0);try{a.call(this)}catch(d){t=d instanceof dS?d7(d.errors):[d]}}if(uPe(o))for(var s=-1,l=o.length;++s<l;){var c=o[s];if(YY(c))try{c.unsubscribe()}catch(f){t=t||[],f instanceof dS?t=t.concat(d7(f.errors)):t.push(f)}}if(t)throw new dS(t)}},e.prototype.add=function(t){var r=t;if(!t)return e.EMPTY;switch(typeof t){case"function":r=new e(t);case"object":if(r===this||r.closed||typeof r.unsubscribe!="function")return r;if(this.closed)return r.unsubscribe(),r;if(!(r instanceof e)){var n=r;r=new e,r._subscriptions=[n]}break;default:throw new Error("unrecognized teardown "+t+" added to Subscription.")}var i=r._parentOrParents;if(i===null)r._parentOrParents=this;else if(i instanceof e){if(i===this)return r;r._parentOrParents=[i,this]}else if(i.indexOf(this)===-1)i.push(this);else return r;var a=this._subscriptions;return a===null?this._subscriptions=[r]:a.push(r),r},e.prototype.remove=function(t){var r=this._subscriptions;if(r){var n=r.indexOf(t);n!==-1&&r.splice(n,1)}},e.EMPTY=function(t){return t.closed=!0,t}(new e),e}();function d7(e){return e.reduce(function(t,r){return t.concat(r instanceof dS?r.errors:r)},[])}var GC=function(){return typeof Symbol=="function"?Symbol("rxSubscriber"):"@@rxSubscriber_"+Math.random()}(),Ms=function(e){ha(t,e);function t(r,n,i){var a=e.call(this)||this;switch(a.syncErrorValue=null,a.syncErrorThrown=!1,a.syncErrorThrowable=!1,a.isStopped=!1,arguments.length){case 0:a.destination=HC;break;case 1:if(!r){a.destination=HC;break}if(typeof r=="object"){r instanceof t?(a.syncErrorThrowable=r.syncErrorThrowable,a.destination=r,r.add(a)):(a.syncErrorThrowable=!0,a.destination=new f7(a,r));break}default:a.syncErrorThrowable=!0,a.destination=new f7(a,r,n,i);break}return a}return t.prototype[GC]=function(){return this},t.create=function(r,n,i){var a=new t(r,n,i);return a.syncErrorThrowable=!1,a},t.prototype.next=function(r){this.isStopped||this._next(r)},t.prototype.error=function(r){this.isStopped||(this.isStopped=!0,this._error(r))},t.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this))},t.prototype._next=function(r){this.destination.next(r)},t.prototype._error=function(r){this.destination.error(r),this.unsubscribe()},t.prototype._complete=function(){this.destination.complete(),this.unsubscribe()},t.prototype._unsubscribeAndRecycle=function(){var r=this._parentOrParents;return this._parentOrParents=null,this.unsubscribe(),this.closed=!1,this.isStopped=!1,this._parentOrParents=r,this},t}(_l),f7=function(e){ha(t,e);function t(r,n,i,a){var o=e.call(this)||this;o._parentSubscriber=r;var s,u=o;return OM(n)?s=n:n&&(s=n.next,i=n.error,a=n.complete,n!==HC&&(u=Object.create(n),OM(u.unsubscribe)&&o.add(u.unsubscribe.bind(u)),u.unsubscribe=o.unsubscribe.bind(o))),o._context=u,o._next=s,o._error=i,o._complete=a,o}return t.prototype.next=function(r){if(!this.isStopped&&this._next){var n=this._parentSubscriber;!rl.useDeprecatedSynchronousErrorHandling||!n.syncErrorThrowable?this.__tryOrUnsub(this._next,r):this.__tryOrSetError(n,this._next,r)&&this.unsubscribe()}},t.prototype.error=function(r){if(!this.isStopped){var n=this._parentSubscriber,i=rl.useDeprecatedSynchronousErrorHandling;if(this._error)!i||!n.syncErrorThrowable?(this.__tryOrUnsub(this._error,r),this.unsubscribe()):(this.__tryOrSetError(n,this._error,r),this.unsubscribe());else if(n.syncErrorThrowable)i?(n.syncErrorValue=r,n.syncErrorThrown=!0):Em(r),this.unsubscribe();else{if(this.unsubscribe(),i)throw r;Em(r)}}},t.prototype.complete=function(){var r=this;if(!this.isStopped){var n=this._parentSubscriber;if(this._complete){var i=function(){return r._complete.call(r._context)};!rl.useDeprecatedSynchronousErrorHandling||!n.syncErrorThrowable?(this.__tryOrUnsub(i),this.unsubscribe()):(this.__tryOrSetError(n,i),this.unsubscribe())}else this.unsubscribe()}},t.prototype.__tryOrUnsub=function(r,n){try{r.call(this._context,n)}catch(i){if(this.unsubscribe(),rl.useDeprecatedSynchronousErrorHandling)throw i;Em(i)}},t.prototype.__tryOrSetError=function(r,n,i){if(!rl.useDeprecatedSynchronousErrorHandling)throw new Error("bad call");try{n.call(this._context,i)}catch(a){return rl.useDeprecatedSynchronousErrorHandling?(r.syncErrorValue=a,r.syncErrorThrown=!0,!0):(Em(a),!0)}return!1},t.prototype._unsubscribe=function(){var r=this._parentSubscriber;this._context=null,this._parentSubscriber=null,r.unsubscribe()},t}(Ms);function cPe(e){for(;e;){var t=e,r=t.closed,n=t.destination,i=t.isStopped;if(r||i)return!1;n&&n instanceof Ms?e=n:e=null}return!0}function dPe(e,t,r){if(e){if(e instanceof Ms)return e;if(e[GC])return e[GC]()}return!e&&!t&&!r?new Ms(HC):new Ms(e,t,r)}var Ab=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}();function KY(e){return e}function fPe(e){return e.length===0?KY:e.length===1?e[0]:function(r){return e.reduce(function(n,i){return i(n)},r)}}var $o=function(){function e(t){this._isScalar=!1,t&&(this._subscribe=t)}return e.prototype.lift=function(t){var r=new e;return r.source=this,r.operator=t,r},e.prototype.subscribe=function(t,r,n){var i=this.operator,a=dPe(t,r,n);if(i?a.add(i.call(a,this.source)):a.add(this.source||rl.useDeprecatedSynchronousErrorHandling&&!a.syncErrorThrowable?this._subscribe(a):this._trySubscribe(a)),rl.useDeprecatedSynchronousErrorHandling&&a.syncErrorThrowable&&(a.syncErrorThrowable=!1,a.syncErrorThrown))throw a.syncErrorValue;return a},e.prototype._trySubscribe=function(t){try{return this._subscribe(t)}catch(r){rl.useDeprecatedSynchronousErrorHandling&&(t.syncErrorThrown=!0,t.syncErrorValue=r),cPe(t)?t.error(r):console.warn(r)}},e.prototype.forEach=function(t,r){var n=this;return r=h7(r),new r(function(i,a){var o;o=n.subscribe(function(s){try{t(s)}catch(u){a(u),o&&o.unsubscribe()}},a,i)})},e.prototype._subscribe=function(t){var r=this.source;return r&&r.subscribe(t)},e.prototype[Ab]=function(){return this},e.prototype.pipe=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return t.length===0?this:fPe(t)(this)},e.prototype.toPromise=function(t){var r=this;return t=h7(t),new t(function(n,i){var a;r.subscribe(function(o){return a=o},function(o){return i(o)},function(){return n(a)})})},e.create=function(t){return new e(t)},e}();function h7(e){if(e||(e=Promise),!e)throw new Error("no Promise impl found");return e}var hPe=function(){function e(){return Error.call(this),this.message="object unsubscribed",this.name="ObjectUnsubscribedError",this}return e.prototype=Object.create(Error.prototype),e}(),om=hPe,pPe=function(e){ha(t,e);function t(r,n){var i=e.call(this)||this;return i.subject=r,i.subscriber=n,i.closed=!1,i}return t.prototype.unsubscribe=function(){if(!this.closed){this.closed=!0;var r=this.subject,n=r.observers;if(this.subject=null,!(!n||n.length===0||r.isStopped||r.closed)){var i=n.indexOf(this.subscriber);i!==-1&&n.splice(i,1)}}},t}(_l),vPe=function(e){ha(t,e);function t(r){var n=e.call(this,r)||this;return n.destination=r,n}return t}(Ms),Qn=function(e){ha(t,e);function t(){var r=e.call(this)||this;return r.observers=[],r.closed=!1,r.isStopped=!1,r.hasError=!1,r.thrownError=null,r}return t.prototype[GC]=function(){return new vPe(this)},t.prototype.lift=function(r){var n=new p7(this,this);return n.operator=r,n},t.prototype.next=function(r){if(this.closed)throw new om;if(!this.isStopped)for(var n=this.observers,i=n.length,a=n.slice(),o=0;o<i;o++)a[o].next(r)},t.prototype.error=function(r){if(this.closed)throw new om;this.hasError=!0,this.thrownError=r,this.isStopped=!0;for(var n=this.observers,i=n.length,a=n.slice(),o=0;o<i;o++)a[o].error(r);this.observers.length=0},t.prototype.complete=function(){if(this.closed)throw new om;this.isStopped=!0;for(var r=this.observers,n=r.length,i=r.slice(),a=0;a<n;a++)i[a].complete();this.observers.length=0},t.prototype.unsubscribe=function(){this.isStopped=!0,this.closed=!0,this.observers=null},t.prototype._trySubscribe=function(r){if(this.closed)throw new om;return e.prototype._trySubscribe.call(this,r)},t.prototype._subscribe=function(r){if(this.closed)throw new om;return this.hasError?(r.error(this.thrownError),_l.EMPTY):this.isStopped?(r.complete(),_l.EMPTY):(this.observers.push(r),new pPe(this,r))},t.prototype.asObservable=function(){var r=new $o;return r.source=this,r},t.create=function(r,n){return new p7(r,n)},t}($o),p7=function(e){ha(t,e);function t(r,n){var i=e.call(this)||this;return i.destination=r,i.source=n,i}return t.prototype.next=function(r){var n=this.destination;n&&n.next&&n.next(r)},t.prototype.error=function(r){var n=this.destination;n&&n.error&&this.destination.error(r)},t.prototype.complete=function(){var r=this.destination;r&&r.complete&&this.destination.complete()},t.prototype._subscribe=function(r){var n=this.source;return n?this.source.subscribe(r):_l.EMPTY},t}(Qn),vf=function(e){ha(t,e);function t(r){var n=e.call(this)||this;return n._value=r,n}return Object.defineProperty(t.prototype,"value",{get:function(){return this.getValue()},enumerable:!0,configurable:!0}),t.prototype._subscribe=function(r){var n=e.prototype._subscribe.call(this,r);return n&&!n.closed&&r.next(this._value),n},t.prototype.getValue=function(){if(this.hasError)throw this.thrownError;if(this.closed)throw new om;return this._value},t.prototype.next=function(r){e.prototype.next.call(this,this._value=r)},t}(Qn),mPe=function(e){ha(t,e);function t(r,n){return e.call(this)||this}return t.prototype.schedule=function(r,n){return this},t}(_l),gPe=function(e){ha(t,e);function t(r,n){var i=e.call(this,r,n)||this;return i.scheduler=r,i.work=n,i.pending=!1,i}return t.prototype.schedule=function(r,n){if(n===void 0&&(n=0),this.closed)return this;this.state=r;var i=this.id,a=this.scheduler;return i!=null&&(this.id=this.recycleAsyncId(a,i,n)),this.pending=!0,this.delay=n,this.id=this.id||this.requestAsyncId(a,this.id,n),this},t.prototype.requestAsyncId=function(r,n,i){return i===void 0&&(i=0),setInterval(r.flush.bind(r,this),i)},t.prototype.recycleAsyncId=function(r,n,i){if(i===void 0&&(i=0),i!==null&&this.delay===i&&this.pending===!1)return n;clearInterval(n)},t.prototype.execute=function(r,n){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var i=this._execute(r,n);if(i)return i;this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},t.prototype._execute=function(r,n){var i=!1,a=void 0;try{this.work(r)}catch(o){i=!0,a=!!o&&o||new Error(o)}if(i)return this.unsubscribe(),a},t.prototype._unsubscribe=function(){var r=this.id,n=this.scheduler,i=n.actions,a=i.indexOf(this);this.work=null,this.state=null,this.pending=!1,this.scheduler=null,a!==-1&&i.splice(a,1),r!=null&&(this.id=this.recycleAsyncId(n,r,null)),this.delay=null},t}(mPe),v7=function(){function e(t,r){r===void 0&&(r=e.now),this.SchedulerAction=t,this.now=r}return e.prototype.schedule=function(t,r,n){return r===void 0&&(r=0),new this.SchedulerAction(this,t).schedule(n,r)},e.now=function(){return Date.now()},e}(),yPe=function(e){ha(t,e);function t(r,n){n===void 0&&(n=v7.now);var i=e.call(this,r,function(){return t.delegate&&t.delegate!==i?t.delegate.now():n()})||this;return i.actions=[],i.active=!1,i.scheduled=void 0,i}return t.prototype.schedule=function(r,n,i){return n===void 0&&(n=0),t.delegate&&t.delegate!==this?t.delegate.schedule(r,n,i):e.prototype.schedule.call(this,r,n,i)},t.prototype.flush=function(r){var n=this.actions;if(this.active){n.push(r);return}var i;this.active=!0;do if(i=r.execute(r.state,r.delay))break;while(r=n.shift());if(this.active=!1,i){for(;r=n.shift();)r.unsubscribe();throw i}},t}(v7),bPe=new $o(function(e){return e.complete()});function xPe(e){return e?SPe(e):bPe}function SPe(e){return new $o(function(t){return e.schedule(function(){return t.complete()})})}function CPe(e){return e&&typeof e.schedule=="function"}var QY=function(e){return function(t){for(var r=0,n=e.length;r<n&&!t.closed;r++)t.next(e[r]);t.complete()}};function ZY(e,t){return new $o(function(r){var n=new _l,i=0;return n.add(t.schedule(function(){if(i===e.length){r.complete();return}r.next(e[i++]),r.closed||n.add(this.schedule())})),n})}function _Pe(e,t){return t?ZY(e,t):new $o(QY(e))}var wPe=new yPe(gPe),EPe=wPe,APe=function(){function e(){return Error.call(this),this.message="argument out of range",this.name="ArgumentOutOfRangeError",this}return e.prototype=Object.create(Error.prototype),e}(),PPe=APe;function TPe(e,t){return function(n){if(typeof e!="function")throw new TypeError("argument is not a function. Are you looking for `mapTo()`?");return n.lift(new IPe(e,t))}}var IPe=function(){function e(t,r){this.project=t,this.thisArg=r}return e.prototype.call=function(t,r){return r.subscribe(new MPe(t,this.project,this.thisArg))},e}(),MPe=function(e){ha(t,e);function t(r,n,i){var a=e.call(this,r)||this;return a.project=n,a.count=0,a.thisArg=i||a,a}return t.prototype._next=function(r){var n;try{n=this.project.call(this.thisArg,r,this.count++)}catch(i){this.destination.error(i);return}this.destination.next(n)},t}(Ms),DPe=function(e){return function(t){return e.then(function(r){t.closed||(t.next(r),t.complete())},function(r){return t.error(r)}).then(null,Em),t}};function RPe(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var x3=RPe(),kPe=function(e){return function(t){var r=e[x3]();do{var n=void 0;try{n=r.next()}catch(i){return t.error(i),t}if(n.done){t.complete();break}if(t.next(n.value),t.closed)break}while(!0);return typeof r.return=="function"&&t.add(function(){r.return&&r.return()}),t}},OPe=function(e){return function(t){var r=e[Ab]();if(typeof r.subscribe!="function")throw new TypeError("Provided object does not correctly implement Symbol.observable");return r.subscribe(t)}},JY=function(e){return e&&typeof e.length=="number"&&typeof e!="function"};function eK(e){return!!e&&typeof e.subscribe!="function"&&typeof e.then=="function"}var tK=function(e){if(e&&typeof e[Ab]=="function")return OPe(e);if(JY(e))return QY(e);if(eK(e))return DPe(e);if(e&&typeof e[x3]=="function")return kPe(e);var t=YY(e)?"an invalid object":"'"+e+"'",r="You provided "+t+" where a stream was expected. You can provide an Observable, Promise, Array, or Iterable.";throw new TypeError(r)};function LPe(e,t){return new $o(function(r){var n=new _l;return n.add(t.schedule(function(){var i=e[Ab]();n.add(i.subscribe({next:function(a){n.add(t.schedule(function(){return r.next(a)}))},error:function(a){n.add(t.schedule(function(){return r.error(a)}))},complete:function(){n.add(t.schedule(function(){return r.complete()}))}}))})),n})}function NPe(e,t){return new $o(function(r){var n=new _l;return n.add(t.schedule(function(){return e.then(function(i){n.add(t.schedule(function(){r.next(i),n.add(t.schedule(function(){return r.complete()}))}))},function(i){n.add(t.schedule(function(){return r.error(i)}))})})),n})}function FPe(e,t){if(!e)throw new Error("Iterable cannot be null");return new $o(function(r){var n=new _l,i;return n.add(function(){i&&typeof i.return=="function"&&i.return()}),n.add(t.schedule(function(){i=e[x3](),n.add(t.schedule(function(){if(!r.closed){var a,o;try{var s=i.next();a=s.value,o=s.done}catch(u){r.error(u);return}o?r.complete():(r.next(a),this.schedule())}}))})),n})}function BPe(e){return e&&typeof e[Ab]=="function"}function UPe(e){return e&&typeof e[x3]=="function"}function jPe(e,t){if(e!=null){if(BPe(e))return LPe(e,t);if(eK(e))return NPe(e,t);if(JY(e))return ZY(e,t);if(UPe(e)||typeof e=="string")return FPe(e,t)}throw new TypeError((e!==null&&typeof e||e)+" is not observable")}function zPe(e,t){return t?jPe(e,t):e instanceof $o?e:new $o(tK(e))}var VPe=function(e){ha(t,e);function t(r){var n=e.call(this)||this;return n.parent=r,n}return t.prototype._next=function(r){this.parent.notifyNext(r)},t.prototype._error=function(r){this.parent.notifyError(r),this.unsubscribe()},t.prototype._complete=function(){this.parent.notifyComplete(),this.unsubscribe()},t}(Ms),HPe=function(e){ha(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.notifyNext=function(r){this.destination.next(r)},t.prototype.notifyError=function(r){this.destination.error(r)},t.prototype.notifyComplete=function(){this.destination.complete()},t}(Ms);function GPe(e,t){if(!t.closed){if(e instanceof $o)return e.subscribe(t);var r;try{r=tK(e)(t)}catch(n){t.error(n)}return r}}function rK(e,t,r){return r===void 0&&(r=Number.POSITIVE_INFINITY),typeof t=="function"?function(n){return n.pipe(rK(function(i,a){return zPe(e(i,a)).pipe(TPe(function(o,s){return t(i,o,a,s)}))},r))}:(typeof t=="number"&&(r=t),function(n){return n.lift(new qPe(e,r))})}var qPe=function(){function e(t,r){r===void 0&&(r=Number.POSITIVE_INFINITY),this.project=t,this.concurrent=r}return e.prototype.call=function(t,r){return r.subscribe(new WPe(t,this.project,this.concurrent))},e}(),WPe=function(e){ha(t,e);function t(r,n,i){i===void 0&&(i=Number.POSITIVE_INFINITY);var a=e.call(this,r)||this;return a.project=n,a.concurrent=i,a.hasCompleted=!1,a.buffer=[],a.active=0,a.index=0,a}return t.prototype._next=function(r){this.active<this.concurrent?this._tryNext(r):this.buffer.push(r)},t.prototype._tryNext=function(r){var n,i=this.index++;try{n=this.project(r,i)}catch(a){this.destination.error(a);return}this.active++,this._innerSub(n)},t.prototype._innerSub=function(r){var n=new VPe(this),i=this.destination;i.add(n);var a=GPe(r,n);a!==n&&i.add(a)},t.prototype._complete=function(){this.hasCompleted=!0,this.active===0&&this.buffer.length===0&&this.destination.complete(),this.unsubscribe()},t.prototype.notifyNext=function(r){this.destination.next(r)},t.prototype.notifyComplete=function(){var r=this.buffer;this.active--,r.length>0?this._next(r.shift()):this.active===0&&this.hasCompleted&&this.destination.complete()},t}(HPe);function $Pe(e){return e===void 0&&(e=Number.POSITIVE_INFINITY),rK(KY,e)}function rc(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=Number.POSITIVE_INFINITY,n=null,i=e[e.length-1];return CPe(i)?(n=e.pop(),e.length>1&&typeof e[e.length-1]=="number"&&(r=e.pop())):typeof i=="number"&&(r=e.pop()),n===null&&e.length===1&&e[0]instanceof $o?e[0]:$Pe(r)(_Pe(e,n))}function S3(e,t){return function(n){return n.lift(new XPe(e,t))}}var XPe=function(){function e(t,r){this.predicate=t,this.thisArg=r}return e.prototype.call=function(t,r){return r.subscribe(new YPe(t,this.predicate,this.thisArg))},e}(),YPe=function(e){ha(t,e);function t(r,n,i){var a=e.call(this,r)||this;return a.predicate=n,a.thisArg=i,a.count=0,a}return t.prototype._next=function(r){var n;try{n=this.predicate.call(this.thisArg,r,this.count++)}catch(i){this.destination.error(i);return}n&&this.destination.next(r)},t}(Ms),Lc;(function(e){function t(){var r=new KPe,n=function(){return r.create()};return n.dispose=function(){return r.dispose()},n.behavior=function(i){return r.behavior(i)},n}e.create=t})(Lc||(Lc={}));var KPe=function(){function e(){this._eventList=[],this._disposed=!1}return e.prototype.create=function(){var t=new Qn;return this._eventList.push(t),t},e.prototype.behavior=function(t){var r=new vf(t);return this._eventList.push(r),r},e.prototype.dispose=function(){if(!this._disposed){for(var t=0,r=this._eventList;t<r.length;t++){var n=r[t];n.complete()}this._disposed=!0}},e}();function lu(e){for(var t=arguments.length,r=Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];throw Error("[Immer] minified error nr: "+e+(r.length?" "+r.map(function(i){return"'"+i+"'"}).join(","):"")+". Find the full error at: https://bit.ly/3cXEKWf")}function _g(e){return!!e&&!!e[Xo]}function Vp(e){return!!e&&(function(t){if(!t||typeof t!="object")return!1;var r=Object.getPrototypeOf(t);if(r===null)return!0;var n=Object.hasOwnProperty.call(r,"constructor")&&r.constructor;return typeof n=="function"&&Function.toString.call(n)===iTe}(e)||Array.isArray(e)||!!e[_7]||!!e.constructor[_7]||Wk(e)||$k(e))}function V1(e,t,r){r===void 0&&(r=!1),Xg(e)===0?(r?Object.keys:Zk)(e).forEach(function(n){r&&typeof n=="symbol"||t(n,e[n],e)}):e.forEach(function(n,i){return t(i,n,e)})}function Xg(e){var t=e[Xo];return t?t.i>3?t.i-4:t.i:Array.isArray(e)?1:Wk(e)?2:$k(e)?3:0}function LM(e,t){return Xg(e)===2?e.has(t):Object.prototype.hasOwnProperty.call(e,t)}function QPe(e,t){return Xg(e)===2?e.get(t):e[t]}function nK(e,t,r){var n=Xg(e);n===2?e.set(t,r):n===3?(e.delete(t),e.add(r)):e[t]=r}function ZPe(e,t){return e===t?e!==0||1/e==1/t:e!=e&&t!=t}function Wk(e){return rTe&&e instanceof Map}function $k(e){return nTe&&e instanceof Set}function Wh(e){return e.o||e.t}function Xk(e){if(Array.isArray(e))return Array.prototype.slice.call(e);var t=aTe(e);delete t[Xo];for(var r=Zk(t),n=0;n<r.length;n++){var i=r[n],a=t[i];a.writable===!1&&(a.writable=!0,a.configurable=!0),(a.get||a.set)&&(t[i]={configurable:!0,writable:!0,enumerable:a.enumerable,value:e[i]})}return Object.create(Object.getPrototypeOf(e),t)}function Yk(e,t){return t===void 0&&(t=!1),Kk(e)||_g(e)||!Vp(e)||(Xg(e)>1&&(e.set=e.add=e.clear=e.delete=JPe),Object.freeze(e),t&&V1(e,function(r,n){return Yk(n,!0)},!0)),e}function JPe(){lu(2)}function Kk(e){return e==null||typeof e!="object"||Object.isFrozen(e)}function bc(e){var t=oTe[e];return t||lu(18,e),t}function m7(){return H1}function cP(e,t){t&&(bc("Patches"),e.u=[],e.s=[],e.v=t)}function qC(e){NM(e),e.p.forEach(eTe),e.p=null}function NM(e){e===H1&&(H1=e.l)}function g7(e){return H1={p:[],l:H1,h:e,m:!0,_:0}}function eTe(e){var t=e[Xo];t.i===0||t.i===1?t.j():t.g=!0}function dP(e,t){t._=t.p.length;var r=t.p[0],n=e!==void 0&&e!==r;return t.h.O||bc("ES5").S(t,e,n),n?(r[Xo].P&&(qC(t),lu(4)),Vp(e)&&(e=WC(t,e),t.l||$C(t,e)),t.u&&bc("Patches").M(r[Xo],e,t.u,t.s)):e=WC(t,r,[]),qC(t),t.u&&t.v(t.u,t.s),e!==iK?e:void 0}function WC(e,t,r){if(Kk(t))return t;var n=t[Xo];if(!n)return V1(t,function(a,o){return y7(e,n,t,a,o,r)},!0),t;if(n.A!==e)return t;if(!n.P)return $C(e,n.t,!0),n.t;if(!n.I){n.I=!0,n.A._--;var i=n.i===4||n.i===5?n.o=Xk(n.k):n.o;V1(n.i===3?new Set(i):i,function(a,o){return y7(e,n,i,a,o,r)}),$C(e,i,!1),r&&e.u&&bc("Patches").R(n,r,e.u,e.s)}return n.o}function y7(e,t,r,n,i,a){if(_g(i)){var o=WC(e,i,a&&t&&t.i!==3&&!LM(t.D,n)?a.concat(n):void 0);if(nK(r,n,o),!_g(o))return;e.m=!1}if(Vp(i)&&!Kk(i)){if(!e.h.F&&e._<1)return;WC(e,i),t&&t.A.l||$C(e,i)}}function $C(e,t,r){r===void 0&&(r=!1),e.h.F&&e.m&&Yk(t,r)}function fP(e,t){var r=e[Xo];return(r?Wh(r):e)[t]}function b7(e,t){if(t in e)for(var r=Object.getPrototypeOf(e);r;){var n=Object.getOwnPropertyDescriptor(r,t);if(n)return n;r=Object.getPrototypeOf(r)}}function FM(e){e.P||(e.P=!0,e.l&&FM(e.l))}function hP(e){e.o||(e.o=Xk(e.t))}function BM(e,t,r){var n=Wk(t)?bc("MapSet").N(t,r):$k(t)?bc("MapSet").T(t,r):e.O?function(i,a){var o=Array.isArray(i),s={i:o?1:0,A:a?a.A:m7(),P:!1,I:!1,D:{},l:a,t:i,k:null,o:null,j:null,C:!1},u=s,l=fS;o&&(u=[s],l=hS);var c=Proxy.revocable(u,l),d=c.revoke,f=c.proxy;return s.k=f,s.j=d,f}(t,r):bc("ES5").J(t,r);return(r?r.A:m7()).p.push(n),n}function tTe(e){return _g(e)||lu(22,e),function t(r){if(!Vp(r))return r;var n,i=r[Xo],a=Xg(r);if(i){if(!i.P&&(i.i<4||!bc("ES5").K(i)))return i.t;i.I=!0,n=x7(r,a),i.I=!1}else n=x7(r,a);return V1(n,function(o,s){i&&QPe(i.t,o)===s||nK(n,o,t(s))}),a===3?new Set(n):n}(e)}function x7(e,t){switch(t){case 2:return new Map(e);case 3:return Array.from(e)}return Xk(e)}var S7,H1,Qk=typeof Symbol<"u"&&typeof Symbol("x")=="symbol",rTe=typeof Map<"u",nTe=typeof Set<"u",C7=typeof Proxy<"u"&&Proxy.revocable!==void 0&&typeof Reflect<"u",iK=Qk?Symbol.for("immer-nothing"):((S7={})["immer-nothing"]=!0,S7),_7=Qk?Symbol.for("immer-draftable"):"__$immer_draftable",Xo=Qk?Symbol.for("immer-state"):"__$immer_state",iTe=""+Object.prototype.constructor,Zk=typeof Reflect<"u"&&Reflect.ownKeys?Reflect.ownKeys:Object.getOwnPropertySymbols!==void 0?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:Object.getOwnPropertyNames,aTe=Object.getOwnPropertyDescriptors||function(e){var t={};return Zk(e).forEach(function(r){t[r]=Object.getOwnPropertyDescriptor(e,r)}),t},oTe={},fS={get:function(e,t){if(t===Xo)return e;var r=Wh(e);if(!LM(r,t))return function(i,a,o){var s,u=b7(a,o);return u?"value"in u?u.value:(s=u.get)===null||s===void 0?void 0:s.call(i.k):void 0}(e,r,t);var n=r[t];return e.I||!Vp(n)?n:n===fP(e.t,t)?(hP(e),e.o[t]=BM(e.A.h,n,e)):n},has:function(e,t){return t in Wh(e)},ownKeys:function(e){return Reflect.ownKeys(Wh(e))},set:function(e,t,r){var n=b7(Wh(e),t);if(n!=null&&n.set)return n.set.call(e.k,r),!0;if(!e.P){var i=fP(Wh(e),t),a=i==null?void 0:i[Xo];if(a&&a.t===r)return e.o[t]=r,e.D[t]=!1,!0;if(ZPe(r,i)&&(r!==void 0||LM(e.t,t)))return!0;hP(e),FM(e)}return e.o[t]===r&&typeof r!="number"||(e.o[t]=r,e.D[t]=!0,!0)},deleteProperty:function(e,t){return fP(e.t,t)!==void 0||t in e.t?(e.D[t]=!1,hP(e),FM(e)):delete e.D[t],e.o&&delete e.o[t],!0},getOwnPropertyDescriptor:function(e,t){var r=Wh(e),n=Reflect.getOwnPropertyDescriptor(r,t);return n&&{writable:!0,configurable:e.i!==1||t!=="length",enumerable:n.enumerable,value:r[t]}},defineProperty:function(){lu(11)},getPrototypeOf:function(e){return Object.getPrototypeOf(e.t)},setPrototypeOf:function(){lu(12)}},hS={};V1(fS,function(e,t){hS[e]=function(){return arguments[0]=arguments[0][0],t.apply(this,arguments)}}),hS.deleteProperty=function(e,t){return fS.deleteProperty.call(this,e[0],t)},hS.set=function(e,t,r){return fS.set.call(this,e[0],t,r,e[0])};var sTe=function(){function e(r){var n=this;this.O=C7,this.F=!0,this.produce=function(i,a,o){if(typeof i=="function"&&typeof a!="function"){var s=a;a=i;var u=n;return function(h){var v=this;h===void 0&&(h=s);for(var p=arguments.length,m=Array(p>1?p-1:0),g=1;g<p;g++)m[g-1]=arguments[g];return u.produce(h,function(y){var b;return(b=a).call.apply(b,[v,y].concat(m))})}}var l;if(typeof a!="function"&&lu(6),o!==void 0&&typeof o!="function"&&lu(7),Vp(i)){var c=g7(n),d=BM(n,i,void 0),f=!0;try{l=a(d),f=!1}finally{f?qC(c):NM(c)}return typeof Promise<"u"&&l instanceof Promise?l.then(function(h){return cP(c,o),dP(h,c)},function(h){throw qC(c),h}):(cP(c,o),dP(l,c))}if(!i||typeof i!="object")return(l=a(i))===iK?void 0:(l===void 0&&(l=i),n.F&&Yk(l,!0),l);lu(21,i)},this.produceWithPatches=function(i,a){return typeof i=="function"?function(u){for(var l=arguments.length,c=Array(l>1?l-1:0),d=1;d<l;d++)c[d-1]=arguments[d];return n.produceWithPatches(u,function(f){return i.apply(void 0,[f].concat(c))})}:[n.produce(i,a,function(u,l){o=u,s=l}),o,s];var o,s},typeof(r==null?void 0:r.useProxies)=="boolean"&&this.setUseProxies(r.useProxies),typeof(r==null?void 0:r.autoFreeze)=="boolean"&&this.setAutoFreeze(r.autoFreeze)}var t=e.prototype;return t.createDraft=function(r){Vp(r)||lu(8),_g(r)&&(r=tTe(r));var n=g7(this),i=BM(this,r,void 0);return i[Xo].C=!0,NM(n),i},t.finishDraft=function(r,n){var i=r&&r[Xo],a=i.A;return cP(a,n),dP(void 0,a)},t.setAutoFreeze=function(r){this.F=r},t.setUseProxies=function(r){r&&!C7&&lu(20),this.O=r},t.applyPatches=function(r,n){var i;for(i=n.length-1;i>=0;i--){var a=n[i];if(a.path.length===0&&a.op==="replace"){r=a.value;break}}var o=bc("Patches").$;return _g(r)?o(r,n):this.produce(r,function(s){return o(s,n.slice(i+1))})},e}(),Yo=new sTe,Hp=Yo.produce;Yo.produceWithPatches.bind(Yo);var uTe=Yo.setAutoFreeze.bind(Yo);Yo.setUseProxies.bind(Yo);Yo.applyPatches.bind(Yo);Yo.createDraft.bind(Yo);Yo.finishDraft.bind(Yo);const Jk=Hp;var Qh;(function(e){function t(o){if(!o.state||o.state.tree===o.editInfo.sourceTree)return o.tree.asImmutable();for(var s=o.state.tree.asTransient(),u=0,l=o.actions;u<l.length;u++){var c=l[u];switch(c.kind){case"add":s.add(c.transform);break;case"update":s.setParams(c.ref,c.params);break;case"delete":s.remove(c.ref);break;case"insert":{var d=s.children.get(c.ref).toArray();s.add(c.transform);for(var f=0,h=d;f<h.length;f++){var v=h[f];s.changeParent(v,c.transform.ref)}break}}}return o.editInfo.sourceTree=o.tree,s.asImmutable()}function r(o){return!!o&&typeof o.getTree=="function"}e.is=r;function n(o){return!!o&&typeof o.getTree=="function"&&typeof o.ref=="string"}e.isTo=n;var i=function(){function o(s,u){this.state={state:u,tree:s.asTransient(),actions:[],editInfo:{applied:!1,sourceTree:s,count:0,lastUpdate:void 0}}}return Object.defineProperty(o.prototype,"editInfo",{get:function(){return this.state.editInfo},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"currentTree",{get:function(){return this.state.tree},enumerable:!1,configurable:!0}),o.prototype.to=function(s){var u=typeof s=="string"?s:U1.is(s)?s.transform.ref:s.ref;return new a(this.state,u,this)},o.prototype.toRoot=function(){return new a(this.state,this.state.tree.root.ref,this)},o.prototype.delete=function(s){var u=Ii.resolveRef(s);return!u||!this.state.tree.transforms.has(u)?this:(this.editInfo.count++,this.state.tree.remove(u),this.state.actions.push({kind:"delete",ref:u}),this)},o.prototype.getTree=function(){return t(this.state)},o.prototype.commit=function(s){if(!this.state.state)throw new Error("Cannot commit template tree");return this.state.state.runTask(this.state.state.updateTree(this,s))},o}();e.Root=i;var a=function(){function o(s,u,l){if(this.state=s,this.root=l,this.ref=u,!this.state.tree.transforms.has(u))throw new Error("Could not find node '"+u+"'.")}return Object.defineProperty(o.prototype,"editInfo",{get:function(){return this.state.editInfo},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"selector",{get:function(){return new MY(this.ref,this.state.state)},enumerable:!1,configurable:!0}),o.prototype.getApplyRoot=function(){return ii.getDecoratorRoot(this.state.tree,this.ref)},o.prototype.apply=function(s,u,l){if(s.definition.isDecorator)return this.insert(s,u,l);var c=this.getApplyRoot(),d=s.apply(c,u,l);return this.state.tree.add(d),this.editInfo.count++,this.editInfo.lastUpdate=d.ref,this.state.actions.push({kind:"add",transform:d}),new o(this.state,d.ref,this.root)},o.prototype.applyOrUpdate=function(s,u,l,c){if(this.state.tree.transforms.has(s)){var d=this.to(s);return l&&d.update(l),d}else return this.apply(u,l,E(E({},c),{ref:s}))},o.prototype.applyOrUpdateTagged=function(s,u,l,c){if(u.definition.isDecorator)throw new Error("Can't use applyOrUpdateTagged on decorator transformers.");for(var d=this.getApplyRoot(),f=this.state.tree.children.get(d).values();;){var h=f.next();if(h.done)break;var v=this.state.tree.transforms.get(h.value);if(v&&cr.hasTags(v,s)){var p=this.to(h.value);return p.updateTagged(l,w7(v.tags,s,c&&c.tags)),p}}var m=u.apply(d,l,E(E({},c),{tags:w7(s,c&&c.tags)}));return this.state.tree.add(m),this.editInfo.count++,this.editInfo.lastUpdate=m.ref,this.state.actions.push({kind:"add",transform:m}),new o(this.state,m.ref,this.root)},o.prototype.group=function(s,u,l){return this.apply(s,u,l)},o.prototype.insert=function(s,u,l){var c=this.state.tree.children.get(this.ref).toArray(),d=s.apply(this.ref,u,l);this.state.tree.add(d);for(var f=0,h=c;f<h.length;f++){var v=h[f];this.state.tree.changeParent(v,d.ref)}return this.editInfo.count++,this.editInfo.lastUpdate=d.ref,this.state.actions.push({kind:"insert",ref:this.ref,transform:d}),new o(this.state,d.ref,this.root)},o.prototype.updateTagged=function(s,u){(this.state.tree.setParams(this.ref,s)||this.state.tree.setTags(this.ref,u))&&(this.editInfo.count++,this.editInfo.lastUpdate=this.ref,this.state.actions.push({kind:"update",ref:this.ref,params:s}))},o.prototype.update=function(s,u){var l;if(u){var c=this.state.tree.transforms.get(this.ref);l=Hp(c.params,u)}else l=typeof s=="function"?Hp(this.state.tree.transforms.get(this.ref).params,s):s;return this.state.tree.setParams(this.ref,l)&&(this.editInfo.count++,this.editInfo.lastUpdate=this.ref,this.state.actions.push({kind:"update",ref:this.ref,params:l})),this.root},o.prototype.to=function(s){return this.root.to(s)},o.prototype.toRoot=function(){return this.root.toRoot()},o.prototype.delete=function(s){return this.root.delete(s)},o.prototype.getTree=function(){return t(this.state)},o.prototype.commit=function(s){if(!this.state.state)throw new Error("Cannot commit template tree");return this.state.state.runTask(this.state.state.updateTree(this,s))},o}();e.To=a})(Qh||(Qh={}));function w7(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var r=void 0,n=[],i=0,a=e;i<a.length;i++){var o=a[i];if(o)if(r||(r=new Set),typeof o=="string"){if(r.has(o))continue;r.add(o),n.push(o)}else for(var s=0,u=o;s<u.length;s++){var l=u[s];r.has(l)||(r.add(l),n.push(l))}}return n}var lTe=function(){function e(){this.ev=Lc.create(),this.actions=new Map,this.fromTypeIndex=new Map,this.events={added:this.ev(),removed:this.ev()}}return e.prototype.add=function(t){var r=ft.is(t)?t.toAction():t;if(this.actions.has(r.id))return this;this.actions.set(r.id,r);for(var n=0,i=r.definition.from;n<i.length;n++){var a=i[n];this.fromTypeIndex.has(a.type)?this.fromTypeIndex.get(a.type).push(r):this.fromTypeIndex.set(a.type,[r])}return this.events.added.next(),this},e.prototype.remove=function(t){var r=ft.is(t)?t.toAction().id:dn.is(t)?t:t.id,n=this.actions.get(r);if(!n)return this;this.actions.delete(r);for(var i=0,a=n.definition.from;i<a.length;i++){var o=a[i],s=this.fromTypeIndex.get(o.type);s&&(yp(s,n),s.length===0&&this.fromTypeIndex.delete(o.type))}return this.events.removed.next(),this},e.prototype.fromCell=function(t,r){var n=t.obj;if(!n)return[];var i=this.fromTypeIndex.get(n.type);if(!i)return[];for(var a=!1,o=0,s=i;o<s.length;o++){var u=s[o];if(u.definition.isApplicable){a=!0;break}}if(!a)return i;for(var l=[],c=0,d=i;c<d.length;c++){var u=d[c];u.definition.isApplicable?u.definition.isApplicable(n,t.transform,r)&&l.push(u):l.push(u)}return l},e.prototype.dispose=function(){this.ev.dispose()},e}(),cl;(function(e){function t(a){return{type:"message",timestamp:new Date,message:a}}e.message=t;function r(a){return{type:"error",timestamp:new Date,message:a}}e.error=r;function n(a){return{type:"warning",timestamp:new Date,message:a}}e.warning=n;function i(a){return{type:"info",timestamp:new Date,message:a}}e.info=i})(cl||(cl={}));var G1;(function(e){var t=function(){function i(a){this.cells=a,this._current=void 0}return Object.defineProperty(i.prototype,"current",{get:function(){return this._current},set:function(a){this._current=a},enumerable:!1,configurable:!0}),i.prototype.getAncestorOfType=function(a){if(this._current)for(var o=this._current;;){if(o=this.cells.get(o.transform.parent),!o.obj)return;if(o.obj.type===a.type)return o.obj;if(o.transform.ref===cr.RootRef)return}},i.prototype.getRootOfType=function(a){if(this._current)for(var o=this._current,s=void 0;;){if(!o.obj)return;if(o.obj.type===a.type&&(s=o),o.transform.ref===cr.RootRef)return s?s.obj:void 0;o=this.cells.get(o.transform.parent)}},i}();e.Impl=t;function r(i,a){for(var o=i.cells,s=o.get(a),u=[s];s!=null&&s.transform.transformer.definition.isDecorator;)s=o.get(s.transform.parent),u.push(s);return u}e.getDecoratorChain=r;function n(i,a,o){var s=void 0,u=i.cells.get(o);if(u)for(;;){if(!u.obj)return;if(u.obj.type===a.type&&(s=u),u.transform.ref===cr.RootRef)return s?s.obj:void 0;u=i.cells.get(u.transform.parent)}}e.getRootOfType=n})(G1||(G1={}));var cTe=function(){function e(){this.queue=[],this.signal=new Qn}return Object.defineProperty(e.prototype,"length",{get:function(){return this.queue.length},enumerable:!1,configurable:!0}),e.prototype.enqueue=function(t){return this.queue.push(t),this.queue.length===1?!0:this.waitFor(t)},e.prototype.handled=function(t){j1(this.queue,t),this.queue.length>0&&this.signal.next({v:this.queue[0],stillPresent:!0})},e.prototype.remove=function(t){var r=j1(this.queue,t);return r&&this.signal.next({v:t,stillPresent:!1}),r},e.prototype.waitFor=function(t){var r=this;return new Promise(function(n){var i=r.signal.subscribe(function(a){var o=a.v,s=a.stillPresent;o===t&&(i.unsubscribe(),n(s))})})},e}(),dTe=function(){function e(t,r){this.getHash=t,this.areEqual=r,this.size=0,this.byHash=new Map}return e.prototype.add=function(t){var r=this.getHash(t);if(this.byHash.has(r)){for(var n=this.byHash.get(r),i=0,a=n.length;i<a;i++)if(this.areEqual(t,n[i]))return!1;return n[n.length]=t,this.size++,!0}else return this.byHash.set(r,[t]),this.size++,!0},e.prototype.has=function(t){var r=this.getHash(t);if(!this.byHash.has(r))return!1;for(var n=this.byHash.get(r),i=0,a=n.length;i<a;i++)if(this.areEqual(t,n[i]))return!0;return!1},e}();function eO(e,t){return new dTe(e,t)}function UM(){return new fTe}function E7(e){return{previous:null,next:null,inList:!0,value:e}}var fTe=function(){function e(){this.count=0,this.first=null,this.last=null}return e.prototype.addFirst=function(t){var r=E7(t);return r.inList=!0,this.first&&(this.first.previous=r),r.next=this.first,this.first=r,this.count++,this.last||(this.last=r),r},e.prototype.addLast=function(t){var r=E7(t);return this.last!==null&&(this.last.next=r),r.previous=this.last,this.last=r,this.first===null&&(this.first=r),r.inList=!0,this.count++,r},e.prototype.removeFirst=function(){var t=this.first;if(t)return this.remove(t),t.value},e.prototype.removeLast=function(){var t=this.last;if(t)return this.remove(t),t.value},e.prototype.remove=function(t){t.inList&&(t.inList=!1,t.previous!==null?t.previous.next=t.next:t.previous===null&&(this.first=t.next),t.next!==null?t.next.previous=t.previous:t.next===null&&(this.last=t.previous),t.next=null,t.previous=null,this.count--)},e.prototype.find=function(t){for(var r=this.first;r!==null;){if(r.value===t)return r;r=r.next}},e}(),Zr;(function(e){function t(){return{keys:new Set,array:[]}}e.create=t;function r(i,a,o){var s=i.keys,u=i.array;return s.has(a)?!1:(s.add(a),u[u.length]=o,!0)}e.add=r;function n(i,a){var o=i.keys;return o.has(a)}e.has=n})(Zr||(Zr={}));var Wf=function(){function e(t,r){var n=this;this.errorFree=!0,this.ev=Lc.create(),this.globalContext=void 0,this.events={cell:{stateUpdated:this.ev(),created:this.ev(),removed:this.ev()},object:{updated:this.ev(),created:this.ev(),removed:this.ev()},log:this.ev(),changed:this.ev(),historyUpdated:this.ev()},this.behaviors={currentObject:this.ev.behavior({state:this,ref:cr.RootRef}),isUpdating:this.ev.behavior(!1)},this.actions=new lTe,this.cells=new Map,this.spine=new G1.Impl(this.cells),this.tryGetCellData=function(o){var s,u,l=(u=(s=n.cells.get(o))===null||s===void 0?void 0:s.obj)===null||u===void 0?void 0:u.data;if(!o)throw new Error("Cell '"+o+"' data undefined.");return l},this.historyCapacity=5,this.history=[],this.undoingHistory=!1,this.inTransaction=!1,this.inTransactionError=!1,this._inUpdate=!1,this.reverted=!1,this.updateQueue=new cTe,this._tree=ii.createEmpty(cr.createRoot(r&&r.rootState)).asTransient();var i=this._tree,a=i.root;this.runTask=r.runTask,(r==null?void 0:r.historyCapacity)!==void 0&&(this.historyCapacity=r.historyCapacity),this.cells.set(a.ref,{parent:this,transform:a,sourceRef:void 0,obj:t,status:"ok",state:E({},a.state),errorText:void 0,params:{definition:{},values:{}},paramsNormalizedVersion:a.version,dependencies:{dependentBy:[],dependsOn:[]},cache:{}}),this.globalContext=r&&r.globalContext}return Object.defineProperty(e.prototype,"tree",{get:function(){return this._tree},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"transforms",{get:function(){return this._tree.transforms},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"current",{get:function(){return this.behaviors.currentObject.value.ref},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"root",{get:function(){return this.cells.get(this._tree.root.ref)},enumerable:!1,configurable:!0}),e.prototype.build=function(){return new Qh.Root(this.tree,this)},e.prototype.addHistory=function(t,r){this.historyCapacity!==0&&(this.history.unshift([t,r||"Update"]),this.history.length>this.historyCapacity&&this.history.pop(),this.events.historyUpdated.next({state:this}))},e.prototype.clearHistory=function(){this.history.length!==0&&(this.history=[],this.events.historyUpdated.next({state:this}))},Object.defineProperty(e.prototype,"latestUndoLabel",{get:function(){return this.history.length>0?this.history[0][1]:void 0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"canUndo",{get:function(){return this.history.length>0},enumerable:!1,configurable:!0}),e.prototype.undo=function(){var t=this;return We.create("Undo",function(r){return ce(t,void 0,void 0,function(){var n;return de(this,function(i){switch(i.label){case 0:if(n=this.history.shift(),!n)return[2];this.events.historyUpdated.next({state:this}),this.undoingHistory=!0,i.label=1;case 1:return i.trys.push([1,,3,4]),[4,this.updateTree(n[0],{canUndo:!1}).runInContext(r)];case 2:return i.sent(),[3,4];case 3:return this.undoingHistory=!1,[7];case 4:return[2]}})})})},e.prototype.getSnapshot=function(){return{tree:ii.toJSON(this._tree)}},e.prototype.setSnapshot=function(t){var r=ii.fromJSON(t.tree);return this.updateTree(r)},e.prototype.setCurrent=function(t){this.behaviors.currentObject.next({state:this,ref:t})},e.prototype.updateCellState=function(t,r){var n=this.cells.get(t);if(n){var i=typeof r=="function"?r(n.state):r;cr.assignState(n.state,i)&&(n.transform=this._tree.assignState(n.transform.ref,i),this.events.cell.stateUpdated.next({state:this,ref:t,cell:n}))}},e.prototype.dispose=function(){this.ev.dispose(),this.actions.dispose()},e.prototype.select=function(t){return ir.select(t,this)},e.prototype.selectQ=function(t){return typeof t=="string"?ir.select(t,this):ir.select(t(ir.Generators),this)},e.prototype.applyAction=function(t,r,n){var i=this;return n===void 0&&(n=cr.RootRef),We.create("Apply Action",function(a){var o=i.cells.get(n);if(!o)throw new Error("'"+n+"' does not exist.");if(o.status!=="ok")throw new Error("Action cannot be applied to a cell with status '"+o.status+"'");return tO(t.definition.run({ref:n,cell:o,a:o.obj,params:r,state:i},i.globalContext),a)})},e.prototype.transaction=function(t,r){var n=this;return We.create("State Transaction",function(i){return ce(n,void 0,void 0,function(){var a,o,s,u;return de(this,function(l){switch(l.label){case 0:a=this.inTransaction,o=this._tree.asImmutable(),s=!1,l.label=1;case 1:return l.trys.push([1,5,8,9]),a||this.behaviors.isUpdating.next(!0),this.inTransaction=!0,this.inTransactionError=!1,[4,t(i)];case 2:return l.sent(),this.inTransactionError?(s=!0,[4,this.updateTree(o).runInContext(i)]):[3,4];case 3:l.sent(),l.label=4;case 4:return[3,9];case 5:return u=l.sent(),s?[3,7]:(s=!0,[4,this.updateTree(o).runInContext(i)]);case 6:l.sent(),this.events.log.next(cl.error(""+u)),l.label=7;case 7:if(a)throw this.inTransactionError=!0,u;if(r!=null&&r.rethrowErrors)throw u;return[3,9];case 8:return a||(this.inTransaction=!1,this.events.changed.next({state:this,inTransaction:!1}),this.behaviors.isUpdating.next(!1),s||(r!=null&&r.canUndo?this.addHistory(o,typeof r.canUndo=="string"?r.canUndo:void 0):this.clearHistory())),[7];case 9:return[2]}})})})},Object.defineProperty(e.prototype,"inUpdate",{get:function(){return this._inUpdate},enumerable:!1,configurable:!0}),e.prototype.updateTree=function(t,r){var n=this,i={tree:t,options:r};return We.create("Update Tree",function(a){return ce(n,void 0,void 0,function(){var o,s,u,l,c;return de(this,function(d){switch(d.label){case 0:return[4,this.updateQueue.enqueue(i)];case 1:if(o=d.sent(),!o)return[2];this._inUpdate=!0,s=r!=null&&r.canUndo?this._tree.asImmutable():void 0,u=!1,this.inTransaction||this.behaviors.isUpdating.next(!0),d.label=2;case 2:if(d.trys.push([2,,7,8]),Qh.is(t)){if(t.editInfo.applied)throw new Error("This builder has already been applied. Create a new builder for further state updates");t.editInfo.applied=!0}return this.reverted=!1,r&&(r.revertIfAborted||r.revertOnError)?[4,this._revertibleTreeUpdate(a,i,r)]:[3,4];case 3:return c=d.sent(),[3,6];case 4:return[4,this._updateTree(a,i)];case 5:c=d.sent(),d.label=6;case 6:return l=c,u=this.reverted,l.ctx.hadError&&(this.inTransactionError=!0),l.cell?[2,new MY(l.cell.transform.ref,this)]:[2];case 7:return this._inUpdate=!1,this.updateQueue.handled(i),this.inTransaction||(this.behaviors.isUpdating.next(!1),r!=null&&r.canUndo?u||this.addHistory(s,typeof r.canUndo=="string"?r.canUndo:void 0):this.undoingHistory||this.clearHistory()),[7];case 8:return[2]}})})},function(){n.updateQueue.remove(i)})},e.prototype._revertibleTreeUpdate=function(t,r,n){return ce(this,void 0,void 0,function(){var i,a,o;return de(this,function(s){switch(s.label){case 0:return i=this.tree,[4,this._updateTree(t,r)];case 1:return a=s.sent(),o=(a.ctx.hadError||a.ctx.wasAborted)&&n.revertOnError||a.ctx.wasAborted&&n.revertIfAborted,o?(this.reverted=!0,[4,this._updateTree(t,{tree:i,options:r.options})]):[3,3];case 2:return[2,s.sent()];case 3:return[2,a]}})})},e.prototype._updateTree=function(t,r){return ce(this,void 0,void 0,function(){var n,i,a;return de(this,function(o){switch(o.label){case 0:n=!1,i=this.updateTreeAndCreateCtx(r.tree,t,r.options),o.label=1;case 1:return o.trys.push([1,,3,4]),[4,pTe(i)];case 2:return n=o.sent(),Qh.isTo(r.tree)?(a=this.select(r.tree.ref)[0],[2,{ctx:i,cell:a}]):[2,{ctx:i}];case 3:return this.spine.current=void 0,n&&this.events.changed.next({state:this,inTransaction:this.inTransaction}),[7];case 4:return[2]}})})},e.prototype.updateTreeAndCreateCtx=function(t,r,n){var i=(Qh.is(t)?t.getTree():t).asTransient(),a=this._tree;this._tree=i;var o=this.cells,s={parent:this,editInfo:Qh.is(t)?t.editInfo:void 0,errorFree:this.errorFree,taskCtx:r,oldTree:a,tree:i,cells:this.cells,spine:this.spine,results:[],options:E(E({},hTe),n),changed:!1,hadError:!1,wasAborted:!1,newCurrent:void 0,getCellData:function(u){var l;return(l=o.get(u).obj)===null||l===void 0?void 0:l.data}};return this.errorFree=!0,s},e}();(function(e){function t(r,n){return new e(r,n)}e.create=t,function(r){function n(i,a){return!!a&&i.ref===a.transform.ref&&i.state===a.parent}r.isCell=n}(e.ObjectEvent||(e.ObjectEvent={}))})(Wf||(Wf={}));var hTe={doNotLogTiming:!1,doNotUpdateCurrent:!0,revertIfAborted:!1,revertOnError:!1,canUndo:!1};function pTe(e){return ce(this,void 0,void 0,function(){var t,r,n,i,L,a,o,s,m,u,p,S,l,c,m,S,d,f,h,v,S,p,m,g,y,b,S,x,C,w,A,M,D,k,R,L,H;return de(this,function(B){switch(B.label){case 0:if(t=!!(e.editInfo&&e.editInfo.count===1&&e.editInfo.lastUpdate&&e.editInfo.sourceTree===e.oldTree),n=[],t)r=[],i=[e.editInfo.lastUpdate];else{for(r=yTe(e),L=e.parent.current,a=!1,o=0,s=r;o<s.length;o++)if(m=s[o],m===L){a=!0;break}for(a&&(u=A7(e.oldTree,L,r,e.cells),e.parent.setCurrent(u)),p=r.length-1;p>=0;p--)S=e.cells.get(r[p]),S&&zM(S.transform,S.obj,S==null?void 0:S.transform.params,S.cache,e.parent.globalContext);for(l=0,c=r;l<c.length;l++)m=c[l],S=e.cells.get(m),S&&(S.parent=void 0,_Te(S)),d=S&&S.obj,e.cells.delete(m),n.push(d);i=vTe(e.cells,e.tree)}for(f=ATe(e,i),h=0,v=f.added;h<v.length;h++)S=v[h],e.parent.events.cell.created.next({state:e.parent,ref:S.transform.ref,cell:S});for(p=0;p<r.length;p++)m=r[p],g=e.oldTree.transforms.get(m).parent,e.parent.events.object.removed.next({state:e.parent,ref:m,obj:n[p]}),e.parent.events.cell.removed.next({state:e.parent,ref:m,parent:g});if(n.length&&(n=[]),f.dependent)for(y=0,b=f.dependent;y<b.length;y++)S=b[y],i.push(S.transform.ref);CTe(e,i),x=0,C=i,B.label=1;case 1:return x<C.length?(w=C[x],[4,oK(e,w)]):[3,4];case 2:B.sent(),B.label=3;case 3:return x++,[3,1];case 4:for(e.editInfo||xTe(e),A=e.newCurrent,M=0,D=e.results;M<D.length;M++)k=D[M],k.action==="created"?(e.parent.events.object.created.next({state:e.parent,ref:k.ref,obj:k.obj}),e.newCurrent||(R=e.tree.transforms.get(k.ref),!R.state.isGhost&&k.obj!==In.Null&&(A=k.ref))):k.action==="updated"?e.parent.events.object.updated.next({state:e.parent,ref:k.ref,action:"in-place",obj:k.obj,oldData:k.oldData}):k.action==="replaced"&&e.parent.events.object.updated.next({state:e.parent,ref:k.ref,action:"recreate",obj:k.obj,oldObj:k.oldObj});return A?e.options.doNotUpdateCurrent||e.parent.setCurrent(A):(L=e.parent.current,H=e.cells.get(L),H&&(H.obj===In.Null||H.status==="error"&&H.errorText===PTe)&&(A=A7(e.oldTree,L,[],e.cells),e.parent.setCurrent(A))),[2,r.length>0||i.length>0||e.changed]}})})}function vTe(e,t){var r={roots:[],cells:e};return ii.doPreOrder(t,t.root,r,mTe),r.roots}function mTe(e,t,r){var n=r.cells.get(e.ref);return!n||n.transform.version!==e.version?(r.roots.push(e.ref),!1):!(n.status==="error"||n&&n.obj===In.Null)}function gTe(e,t,r){!r.newTree.transforms.has(e.ref)&&r.cells.has(e.ref)&&r.deletes.push(e.ref)}function yTe(e){var t={newTree:e.tree,cells:e.cells,deletes:[]};return ii.doPostOrder(e.oldTree,e.oldTree.root,t,gTe),t.deletes}function bTe(e,t,r){var n=r.cells.get(e.ref);!n||!cr.syncState(n.state,e.state)||r.parent.events.cell.stateUpdated.next({state:r.parent,ref:e.ref,cell:n})}function xTe(e){ii.doPreOrder(e.tree,e.tree.root,e,bTe)}function XC(e,t,r,n){var i=e.cells.get(t),a=i.status!==r;i.status=r,i.errorText=n,a&&e.parent.events.cell.stateUpdated.next({state:e.parent,ref:t,cell:i})}function STe(e,t,r){r.cells.get(e.ref).transform=e,XC(r,e.ref,"pending")}function CTe(e,t){for(var r=0,n=t;r<n.length;r++){var i=n[r];ii.doPreOrder(e.tree,e.tree.transforms.get(i),e,STe)}}function _Te(e){for(var t=0,r=e.dependencies.dependsOn;t<r.length;t++){var n=r[t];yp(n.dependencies.dependentBy,e)}}function wTe(e,t,r){var n=r.ctx,i=r.added,a=r.visited;if(a.add(e.ref),!n.cells.has(e.ref)){var o={parent:n.parent,transform:e,sourceRef:void 0,status:"pending",state:E({},e.state),errorText:void 0,params:void 0,paramsNormalizedVersion:"",dependencies:{dependentBy:[],dependsOn:[]},cache:void 0};n.cells.set(e.ref,o),i.push(o)}}function ETe(e,t){if(e.transform.dependsOn)for(var r=0,n=e.transform.dependsOn;r<n.length;r++){var i=n[r],a=t.tree.transforms.get(i);if(!a)throw new Error("Cannot depend on a non-existent transform.");var o=t.cells.get(i);Pa(e.dependencies.dependsOn,o),Pa(o.dependencies.dependentBy,e)}}function ATe(e,t){for(var r={ctx:e,visited:new Set,added:[]},n=0,i=t;n<i.length;n++){var a=i[n];ii.doPreOrder(e.tree,e.tree.transforms.get(a),r,wTe)}for(var o=0,s=r.added;o<s.length;o++){var u=s[o];ETe(u,e)}var l;return r.visited.forEach(function(c){for(var d=e.cells.get(c),f=0,h=d.dependencies.dependentBy;f<h.length;f++){var v=h[f];r.visited.has(v.transform.ref)||(l||(l=Zr.create()),Zr.add(l,v.transform.ref,v))}}),{added:r.added,dependent:l?l.array:void 0}}function A7(e,t,r,n){var i=new Set(r);return aK(e,t,i,n)}function aK(e,t,r,n){if(t===cr.RootRef)return t;for(var i=e.transforms.get(t),a=e.children.get(i.parent).values(),o=void 0,s=!1;;){var u=a.next();if(u.done)break;if(!r.has(u.value)){var l=n.get(u.value);if(!(!l||l.status==="error"||l.obj===In.Null)){var c=e.transforms.get(u.value);if(!c.state.isGhost){if(u.value===t){s=!0,r.has(t)||(o=t);continue}if(s)return c.ref;o=c.ref}}}}return o||aK(e,i.parent,r,n)}function jM(e,t,r,n){n||(e.hadError=!0,e.parent.errorFree=!1);var i=e.cells.get(t);if(r){e.wasAborted=e.wasAborted||We.isAbort(r);var a=""+r;XC(e,t,"error",a),n||e.parent.events.log.next({type:"error",timestamp:new Date,message:a})}else i.params=void 0;if(i.obj){var o=i.obj;i.obj=void 0,i.cache=void 0,e.parent.events.object.removed.next({state:e.parent,ref:t,obj:o})}for(var s=e.tree.children.get(t).values();;){var u=s.next();if(u.done)return;jM(e,u.value,void 0,n)}}var PTe="Parent is null";function oK(e,t){return ce(this,void 0,void 0,function(){var r,n,i,a,o,s,u;return de(this,function(l){switch(l.label){case 0:XC(e,t,"processing"),r=!1,l.label=1;case 1:return l.trys.push([1,3,,4]),n=Tn(),[4,ITe(e,t)];case 2:return i=l.sent(),a=Tn()-n,i.action!=="none"&&(e.changed=!0),XC(e,t,"ok"),e.results.push(i),i.action==="created"?(r=i.obj===In.Null,!r&&!e.options.doNotLogTiming&&e.parent.events.log.next(cl.info("Created "+i.obj.label+" in "+sS(a)+"."))):(i.action==="updated"||i.action==="replaced")&&(r=i.obj===In.Null,!r&&!e.options.doNotLogTiming&&e.parent.events.log.next(cl.info("Updated "+i.obj.label+" in "+sS(a)+"."))),[3,4];case 3:return o=l.sent(),e.changed=!0,e.hadError||(e.newCurrent=t),jM(e,t,o,!1),$g||console.error(o),[2];case 4:s=e.tree.children.get(t).values(),l.label=5;case 5:return u=s.next(),u.done?[2]:r?(jM(e,u.value,void 0,!0),[3,8]):[3,6];case 6:return[4,oK(e,u.value)];case 7:l.sent(),l.label=8;case 8:return[3,5];case 9:return[2]}})})}function TTe(e,t,r,n){var i=t.transformer.definition.params,a=i?i(r,e.parent.globalContext):{};if(n.paramsNormalizedVersion!==t.version)t.params=I.normalizeParams(a,t.params,"all"),n.paramsNormalizedVersion=t.version;else{var o=I.getDefaultValues(a);t.params=t.params?oAe(t.params,o):o}return I.resolveRefs(a,t.params,e.getCellData),{definition:a,values:t.params}}function ITe(e,t){var r;return ce(this,void 0,void 0,function(){var n,i,a,o,s,u,l,c,d,f,h,v,p,m,g,y,b;return de(this,function(S){switch(S.label){case 0:if(n=e.oldTree,i=e.tree,a=e.cells.get(t),o=a.transform,a.transform.ref===cr.RootRef)return[2,{action:"none"}];if(s=o.transformer.definition.from.length===0?e.cells.get(a.transform.parent):ir.findAncestorOfType(i,e.cells,t,o.transformer.definition.from),!s)throw new Error("No suitable parent found for '"+t+"'");return e.spine.current=a,u=s.obj,a.sourceRef=s.transform.ref,l=TTe(e,o,u,a),!n.transforms.has(t)||!a.params?(a.params=l,[4,P7(e,a,o.transformer,u,l.values)]):[3,2];case 1:return c=S.sent(),pP(c,o),a.obj=c,[2,{ref:t,action:"created",obj:c}];case 2:return d=a.params.values,f=a.cache,h=(r=a.obj)===null||r===void 0?void 0:r.data,v=l.values,a.params=l,a.obj&&a.obj!==In.Null?[4,MTe(e,a,o.transformer,u,a.obj,d,v)]:[3,4];case 3:return m=S.sent(),[3,5];case 4:m=ft.UpdateResult.Recreate,S.label=5;case 5:switch(p=m,g=p,g){case ft.UpdateResult.Recreate:return[3,6];case ft.UpdateResult.Updated:return[3,8];case ft.UpdateResult.Null:return[3,9]}return[3,10];case 6:return y=a.obj,zM(o,y,d,f,e.parent.globalContext),[4,P7(e,a,o.transformer,u,v)];case 7:return b=S.sent(),pP(b,o),a.obj=b,[2,{ref:t,action:"replaced",oldObj:y,obj:b}];case 8:return pP(a.obj,o),[2,{ref:t,action:"updated",oldData:h,obj:a.obj}];case 9:return zM(o,a.obj,d,f,e.parent.globalContext),a.obj=In.Null,[2,{ref:t,action:"updated",obj:a.obj}];case 10:return[2,{action:"none"}]}})})}function zM(e,t,r,n,i){var a,o;(o=(a=e.transformer.definition).dispose)===null||o===void 0||o.call(a,{b:t!==In.Null?t:void 0,params:r,cache:n},i)}function pP(e,t){!e||e===In.Null||(e.tags=t.tags)}function tO(e,t){return typeof e.runInContext=="function"?e.runInContext(t):e}function sK(e){if(e.dependencies.dependsOn.length!==0){for(var t=Object.create(null),r=0,n=e.dependencies.dependsOn;r<n.length;r++){var i=n[r];if(!i.obj)throw new Error("Unresolved dependency.");t[i.transform.ref]=i.obj}return t}}function P7(e,t,r,n,i){return t.cache||(t.cache=Object.create(null)),tO(r.definition.apply({a:n,params:i,cache:t.cache,spine:e.spine,dependencies:sK(t)},e.parent.globalContext),e.taskCtx)}function MTe(e,t,r,n,i,a,o){return ce(this,void 0,void 0,function(){return de(this,function(s){return r.definition.update?(t.cache||(t.cache=Object.create(null)),[2,tO(r.definition.update({a:n,oldParams:a,b:i,newParams:o,cache:t.cache,spine:e.spine,dependencies:sK(t)},e.parent.globalContext),e.taskCtx)]):[2,ft.UpdateResult.Recreate]})})}var Ko={kind:"null-location"};function uK(e,t,r){return{kind:"data-location",tag:e,data:t,element:r}}function mn(e,t,r,n,i,a){if(i===void 0&&(i=!1),a===void 0&&(a=function(){return!1}),e%r!==0)throw new Error("incompatible groupCount and stride");var o={location:Ko,index:0,groupIndex:0,instanceIndex:0,isSecondary:!1},s=o.groupIndex<e,u=!1,l=0,c=0,d=!1;return{get hasNext(){return s},get isNextNewInstance(){return u},groupCount:e,instanceCount:t,count:e*t,stride:r,nonInstanceable:i,move:function(){return s&&(o.groupIndex=l,o.instanceIndex=c,o.index=c*e+l,o.location=n(l,d?-1:c),o.isSecondary=a(l,d?-1:c),l+=r,l===e?(++c,u=!0,c<t&&(l=0)):u=!1,s=l<e),o},reset:function(){o.location=Ko,o.index=0,o.groupIndex=0,o.instanceIndex=0,o.isSecondary=!1,s=o.groupIndex<e,u=!1,l=0,c=0,d=!1},skipInstance:function(){s&&o.instanceIndex===c&&(++c,l=0,s=c<t)},voidInstances:function(){d=!0}}}function pv(e){return{kind:"position-location",position:e?_.clone(e):_()}}var T7=zn(),DTe=ue();function RTe(e,t){for(var r=0;r<t;r++)if(zn.fromMat4(T7,ue.fromArray(DTe,e,r*16)),zn.determinant(T7)<0)return!0;return!1}function rO(e,t,r){var n=RTe(e,t);if(r){N.update(r.matrix,r.matrix.ref.value),N.update(r.transform,e),N.updateIfChanged(r.uInstanceCount,t),N.updateIfChanged(r.instanceCount,t);var i=r.aTransform.ref.value.length>=t*16?r.aTransform.ref.value:new Float32Array(t*16);i.set(e),N.update(r.aTransform,i);var a=r.extraTransform.ref.value.length>=t*16?r.extraTransform.ref.value:new Float32Array(t*16);N.update(r.extraTransform,YC(a,t));var o=r.aInstance.ref.value.length>=t?r.aInstance.ref.value:new Float32Array(t);return N.update(r.aInstance,Fs(o,t)),N.update(r.hasReflection,n),lK(r),r}else return{aTransform:N.create(new Float32Array(e)),matrix:N.create(ue.identity()),transform:N.create(e),extraTransform:N.create(YC(new Float32Array(t*16),t)),uInstanceCount:N.create(t),instanceCount:N.create(t),aInstance:N.create(Fs(new Float32Array(t))),hasReflection:N.create(n)}}var nO=new Float32Array(16);ue.toArray(ue.identity(),nO,0);function iO(e){return rO(new Float32Array(nO),1,e)}function YC(e,t){for(var r=0;r<t;r++)e.set(nO,r*16);return e}function lK(e){for(var t=e.aTransform.ref.value,r=e.instanceCount.ref.value,n=e.matrix.ref.value,i=e.transform.ref.value,a=e.extraTransform.ref.value,o=0;o<r;o++){var s=o*16;ue.mulOffset(t,a,i,s,s,s),ue.mulOffset(t,n,t,s,0,s)}N.update(e.aTransform,t)}var dr={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflower:6591981,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,laserlemon:16777044,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrod:16448210,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,maroon2:8323072,maroon3:11546720,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,purple2:8323199,purple3:10494192,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};(function(){var e=new Map;return Object.keys(dr).forEach(function(t){e.set(dr[t],t)}),e})();var cK=at(13421772),kTe="Gives everything the same, uniform color.",dK={value:I.Color(cK)};function OTe(e){return dK}function aO(e,t){var r=Ei(t.value,cK);return{factory:aO,granularity:"uniform",color:function(){return r},props:t,description:kTe,legend:uh([["uniform",r]])}}var LTe={name:"uniform",label:"Uniform",category:"Miscellaneous",factory:aO,getParams:OTe,defaultValues:I.getDefaultValues(dK),isApplicable:function(e){return!0}},NTe="Gives everything the same, uniform size.",fK={value:I.Numeric(1,{min:0,max:20,step:.1})};function FTe(e){return fK}function oO(e,t){var r=t.value;return{factory:oO,granularity:"uniform",size:function(){return r},props:t,description:NTe}}var BTe={name:"uniform",label:"Uniform",category:"",factory:oO,getParams:FTe,defaultValues:I.getDefaultValues(fK),isApplicable:function(e){return!0}},UTe={custom:{},auto:{},highest:{},higher:{},high:{},medium:{},low:{},lower:{},lowest:{}},jTe=Object.keys(UTe),sO=I.arrayToOptions(jTe),Et;(function(e){e.Params={alpha:I.Numeric(1,{min:0,max:1,step:.01},{label:"Opacity",isEssential:!0,description:"How opaque/transparent the representation is rendered."}),quality:I.Select("auto",sO,{isEssential:!0,description:"Visual/rendering quality of the representation."})},e.ShadingCategory={category:"Shading"},e.CustomQualityParamInfo={category:"Custom Quality",hideIf:function(o){return typeof o.quality<"u"&&o.quality!=="custom"}};function t(o,s,u){o===void 0&&(o=dr.grey),s===void 0&&(s=1),u||(u=iO());var l=mn(1,u.instanceCount.ref.value,1,function(){return Ko},!1,function(){return!1}),c={color:aO({},{value:o}),size:oO({},{value:s})};return{transform:u,locationIterator:l,theme:c}}e.createSimple=t;function r(o,s){return{alpha:N.create(o.alpha),uAlpha:N.create(o.alpha),uVertexCount:N.create(s.vertexCount),uGroupCount:N.create(s.groupCount),drawCount:N.create(s.drawCount)}}e.createValues=r;function n(o,s){N.updateIfChanged(o.alpha,s.alpha)}e.updateValues=n;function i(o){o===void 0&&(o={});var s=o.alpha===void 0?!0:o.alpha===1;return{disposed:!1,visible:!0,alphaFactor:1,pickable:!0,colorOnly:!1,opaque:s,writeDepth:s,noClip:!1}}e.createRenderableState=i;function a(o,s){o.opaque=s.alpha*o.alphaFactor>=1,o.writeDepth=o.opaque}e.updateRenderableState=a})(Et||(Et={}));function rf(e,t){return{value:e,unit:t}}var q1;(function(e){function t(u,l,c){var d=!!u[0].cell,f=!!u[0].velocities,h=!!u[0].forces;return{id:dn.create22(),frames:u,hasCell:d,hasVelocities:f,hasForces:h,deltaTime:l,timeOffset:c}}e.create=t;function r(u,l,c){var d=u.x,f=u.y,h=u.z;return u.xyzOrdering.frozen?c?u.xyzOrdering.isIdentity?(d=o(d,c),f=o(f,c),h=o(h,c)):Xa(u.xyzOrdering.index,c)||(d=a(d,u.xyzOrdering.index,c),f=a(f,u.xyzOrdering.index,c),h=a(h,u.xyzOrdering.index,c)):u.xyzOrdering.isIdentity||(d=s(d,u.xyzOrdering.index),f=s(f,u.xyzOrdering.index),h=s(h,u.xyzOrdering.index)):c&&(u.xyzOrdering.isIdentity?(u.xyzOrdering.isIdentity=!1,u.xyzOrdering.index=c,i(d,c),i(f,c),i(h,c)):Xa(u.xyzOrdering.index,c)||(d=a(d,u.xyzOrdering.index,c),f=a(f,u.xyzOrdering.index,c),h=a(h,u.xyzOrdering.index,c))),u.xyzOrdering.frozen=!0,{id:dn.create22(),atomId:l,occupancy:ve.ofConst(1,u.elementCount,ve.Schema.int),B_iso_or_equiv:ve.ofConst(0,u.elementCount,ve.Schema.float),xyzDefined:!0,x:d,y:f,z:h}}e.getAtomicConformation=r;var n=[.123];function i(u,l){for(var c=n,d=0,f=u.length;d<f;d++)c[d]=u[l[d]];for(var d=0,f=u.length;d<f;d++)u[d]=c[d]}function a(u,l,c){for(var d=new Float32Array(u.length),f=0,h=u.length;f<h;f++)d[f]=u[l[c[f]]];return d}function o(u,l){for(var c=new Float32Array(u.length),d=0,f=u.length;d<f;d++)c[d]=u[l[d]];return c}function s(u,l){for(var c=new Float32Array(u.length),d=0,f=u.length;d<f;d++)c[l[d]]=u[d];return c}})(q1||(q1={}));var VM;(function(e){function t(r,n,i,a){return{id:dn.create22(),label:r,basic:n,sourceData:a,bonds:i}}e.create=t})(VM||(VM={}));function yo(e){return e}(function(e){function t(r){return r.__key||(r.__key=dn.create22()),r.__key}e.getUUID=t})(yo||(yo={}));var Tl=function(){function e(){this._list=[],this._set=new Set,this._refs=new Map,this._assets=new Map}return Object.defineProperty(e.prototype,"all",{get:function(){return this._list},enumerable:!1,configurable:!0}),e.prototype.add=function(t){this._set.has(t)||(this._list.push(t),this._set.add(t))},e.prototype.reference=function(t,r){var n=this._refs.get(t)||0;n+=r?1:-1,this._refs.set(t,Math.max(n,0))},e.prototype.hasReference=function(t){return(this._refs.get(t)||0)>0},e.prototype.has=function(t){return this._set.has(t)},e.prototype.assets=function(t,r){var n=this._assets.get(t);if(n)for(var i=0,a=n;i<a.length;i++){var o=a[i];o.dispose()}r?this._assets.set(t,r):this._assets.delete(t)},e.prototype.dispose=function(){this._assets.forEach(function(t){for(var r=0,n=t;r<n.length;r++){var i=n[r];i.dispose()}})},e}();function zTe(e,t){var r=[],n=[],i=[];e.x.length&&(r.push.apply(r,Mo(e.x)),n.push.apply(n,Mo(e.y)),i.push.apply(i,Mo(e.z))),t&&(t.spheres.x.length&&(r.push.apply(r,Mo(t.spheres.x)),n.push.apply(n,Mo(t.spheres.y)),i.push.apply(i,Mo(t.spheres.z))),t.gaussians.x.length&&(r.push.apply(r,Mo(t.gaussians.x)),n.push.apply(n,Mo(t.gaussians.y)),i.push.apply(i,Mo(t.gaussians.z))));var a=Mo(r),o=a[0],s=a[1],u=Mo(n),l=u[0],c=u[1],d=Mo(i),f=d[0],h=d[1],v=o+(s-o)/2,p=l+(c-l)/2,m=f+(h-f)/2;return _.create(v,p,m)}function VTe(e){var t=new Set,r=new Set;return e.properties.structAsymMap.forEach(function(n,i){var a=n.auth_id;t.add(a),r.add(i)}),{auth:t.size,label:r.size}}var bo;(function(e){function t(d,f){if(d===f)return!0;if(d.vertexCount!==f.vertexCount||d.edgeCount!==f.edgeCount)return!1;for(var h=d.a,v=d.b,p=d.offset,m=f.a,g=f.b,y=f.offset,b=0,S=d.a.length;b<S;b++)if(h[b]!==m[b])return!1;for(var b=0,S=d.b.length;b<S;b++)if(v[b]!==g[b])return!1;for(var b=0,S=d.offset.length;b<S;b++)if(p[b]!==y[b])return!1;for(var x=0,C=Object.keys(d.edgeProps);x<C.length;x++){var w=C[x],A=d.edgeProps[w],M=f.edgeProps[w];if(!M)return!1;for(var b=0,S=A.length;b<S;b++)if(A[b]!==M[b])return!1}return!0}e.areEqual=t;var r=function(){function d(f,h,v,p,m,g){this.offset=f,this.a=h,this.b=v,this.edgeCount=p,this.props=g,this.vertexCount=f.length-1,this.edgeProps=m||{}}return d.prototype.getEdgeIndex=function(f,h){var v,p;f<h?(v=f,p=h):(v=h,p=f);for(var m=this.offset[v],g=this.offset[v+1];m<g;m++)if(this.b[m]===p)return m;return-1},d.prototype.getDirectedEdgeIndex=function(f,h){for(var v=this.offset[f],p=this.offset[f+1];v<p;v++)if(this.b[v]===h)return v;return-1},d.prototype.getVertexEdgeCount=function(f){return this.offset[f+1]-this.offset[f]},d}();function n(d,f,h,v,p,m){return new r(d,f,h,v,p,m)}e.create=n;var i=function(){function d(f,h,v){this.vertexCount=f,this.xs=h,this.ys=v,this.current=0,this.curA=0,this.curB=0,this.edgeCount=h.length,this.offsets=new Int32Array(this.vertexCount+1),this.bucketFill=new Int32Array(this.vertexCount);for(var p=new Int32Array(this.vertexCount),m=0,g=this.xs.length;m<g;m++)p[this.xs[m]]++;for(var m=0,g=this.ys.length;m<g;m++)p[this.ys[m]]++;for(var y=0,m=0;m<this.vertexCount;m++)this.offsets[m]=y,y+=p[m];this.offsets[this.vertexCount]=y,this.slotCount=y,this.a=new Int32Array(y),this.b=new Int32Array(y)}return d.prototype.createGraph=function(f,h){return n(this.offsets,this.a,this.b,this.edgeCount,f,h)},d.prototype.addNextEdge=function(){var f=this.xs[this.current],h=this.ys[this.current],v=this.offsets[f]+this.bucketFill[f],p=this.offsets[h]+this.bucketFill[h];this.a[v]=f,this.b[v]=h,this.bucketFill[f]++,this.a[p]=h,this.b[p]=f,this.bucketFill[h]++,this.current++,this.curA=v,this.curB=p},d.prototype.addAllEdges=function(){for(var f=0;f<this.edgeCount;f++)this.addNextEdge()},d.prototype.assignProperty=function(f,h){f[this.curA]=h,f[this.curB]=h},d}();e.EdgeBuilder=i;var a=function(){function d(f,h,v){this.vertexCount=f,this.xs=h,this.ys=v,this.current=0,this.curA=0,this.edgeCount=h.length,this.offsets=new Int32Array(this.vertexCount+1),this.bucketFill=new Int32Array(this.vertexCount);for(var p=new Int32Array(this.vertexCount),m=0,g=this.xs.length;m<g;m++)p[this.xs[m]]++;for(var y=0,m=0;m<this.vertexCount;m++)this.offsets[m]=y,y+=p[m];this.offsets[this.vertexCount]=y,this.slotCount=y,this.a=new Int32Array(y),this.b=new Int32Array(y)}return d.prototype.createGraph=function(f){return n(this.offsets,this.a,this.b,this.edgeCount,f)},d.prototype.addNextEdge=function(){var f=this.xs[this.current],h=this.ys[this.current],v=this.offsets[f]+this.bucketFill[f];this.a[v]=f,this.b[v]=h,this.bucketFill[f]++,this.current++,this.curA=v},d.prototype.addAllEdges=function(){for(var f=0;f<this.edgeCount;f++)this.addNextEdge()},d.prototype.assignProperty=function(f,h){f[this.curA]=h},d}();e.DirectedEdgeBuilder=a;var o=function(){function d(f){this.vertexCount=f,this.xs=[],this.ys=[],this.included=new Set}return d.prototype.addEdge=function(f,h){var v=f,p=h;f>h&&(v=h,p=f);var m=Rf(v,p);return this.included.has(m)?!1:(this.included.add(m),this.xs[this.xs.length]=v,this.ys[this.ys.length]=p,!0)},d.prototype.getGraph=function(){return s(this.vertexCount,this.xs,this.ys)},d.prototype.getEdgeBuiler=function(){return new i(this.vertexCount,this.xs,this.ys)},d}();e.UniqueEdgeBuilder=o;function s(d,f,h){var v=new e.EdgeBuilder(d,f,h);return v.addAllEdges(),v.createGraph({})}e.fromVertexPairs=s;function u(d,f){for(var h=d.b,v=d.offset,p=d.vertexCount,m=d.edgeProps,g=new Int32Array(p),y=0,b=f.length;y<b;y++)g[f[y]]=y+1;for(var S=0,y=0;y<p;y++)if(g[y]!==0)for(var x=v[y],C=v[y+1];x<C;x++)h[x]>y&&g[h[x]]!==0&&S++;for(var w=new Int32Array(f.length+1),A=new Int32Array(2*S),M=new Int32Array(2*S),D=new Int32Array(2*S),k=0,R=0,y=0;y<p;y++)if(g[y]!==0){for(var L=g[y]-1,x=v[y],C=v[y+1];x<C;x++){var H=g[h[x]];H!==0&&(M[k]=L,D[k]=H-1,A[k]=x,k++)}w[++R]=k}for(var B={},j=0,Q=Object.keys(m);j<Q.length;j++){var G=Q[j];B[G]=rwe(m[G],A)}return n(w,M,D,S,B)}e.induceByVertices=u;function l(d){var f=d.vertexCount;if(f===0)return{componentCount:0,componentIndex:new Int32Array(0)};if(d.edgeCount===0){for(var h=new Int32Array(f),v=0,p=f;v<p;v++)h[v]=v;return{componentCount:f,componentIndex:h}}for(var m=new Int32Array(f),v=0,p=f;v<p;v++)m[v]=-1;var g=0;m[0]=g;var y=d.offset,b=d.b,S=[0],x=b3e(f);for(x.remove(0);S.length>0;){for(var C=S.pop(),w=m[C],A=y[C],M=y[C+1];A<M;A++){var D=b[A];x.has(D)&&(x.remove(D),S.push(D),m[D]=w)}S.length===0&&x.head>=0&&(S.push(x.head),m[x.head]=++g,x.remove(x.head))}return{componentCount:f,componentIndex:m}}e.connectedComponents=l;function c(d,f,h,v){if(Je.areIntersecting(f,h))return!0;if(v<1)return!1;for(var p=new Set,m=0,g=f.length;m<g;++m)p.add(f[m]);return hK(d,f,h,v,p)}e.areVertexSetsConnected=c})(bo||(bo={}));function hK(e,t,r,n,i){for(var a=e.b,o=e.offset,s=[],u=0,l=t.length;u<l;++u)for(var c=t[u],d=o[c],f=o[c+1];d<f;++d){var h=a[d];if(!i.has(h)){if(Je.has(r,h))return!0;i.add(h),s[s.length]=h}}return n>1?hK(e,s,r,n-1,i):!1}var HTe=function(){function e(){this.map=new Map,this.applicable=new Map}return e.prototype.add=function(t,r,n){this.map.set(t,r),n&&this.applicable.set(t,n)},e.prototype.remove=function(t){this.map.delete(t),this.applicable.delete(t)},e.prototype.get=function(t){return this.map.get(t)},e.prototype.isApplicable=function(t){var r=this.applicable.get(t.sourceData.kind);return r?r(t):!0},e}(),Mu;(function(e){function t(r){var n=r.name,i=new HTe;return{descriptor:r,formatRegistry:i,isApplicable:function(a){return i.isApplicable(a)},get:function(a){if(a._staticPropertyData[n])return a._staticPropertyData[n];if(!a.customProperties.has(r)){var o=i.get(a.sourceData.kind);if(o)return a._staticPropertyData[n]=o(a),a.customProperties.add(r),a._staticPropertyData[n]}},set:function(a,o){a._staticPropertyData[n]=o},delete:function(a){delete a._staticPropertyData[n]}}}e.create=t})(Mu||(Mu={}));function GTe(e,t,r,n){for(var i=new bo.EdgeBuilder(n,e,t),a=new Int8Array(i.slotCount),o=new Array(i.slotCount),s=new Array(i.slotCount),u=0,l=i.edgeCount;u<l;u++)i.addNextEdge(),i.assignProperty(a,r.order?r.order[u]:1),i.assignProperty(o,r.distance?r.distance[u]:-1),i.assignProperty(s,r.flag?r.flag[u]:1);return i.createGraph({order:a,distance:o,flag:s})}var fa;(function(e){e.Descriptor={name:"index_pair_bonds"},e.Provider=Mu.create(e.Descriptor);function t(r){var n=r.pairs,i=r.count,a=n.indexA.toArray(),o=n.indexB.toArray(),s=n.order&&n.order.toArray(),u=n.distance&&n.distance.toArray(),l=n.flag&&n.flag.toArray();return GTe(a,o,{order:s,distance:u,flag:l},i)}e.fromData=t})(fa||(fa={}));var lh=ve.Schema,ne=lh.str,ke=lh.int,sr=lh.float,vP=lh.coord,Mt=lh.Aliased,wd=lh.Matrix,B2=lh.Vector,gh=lh.List,vr={atom_site:{auth_asym_id:ne,auth_atom_id:ne,auth_comp_id:ne,auth_seq_id:ke,B_iso_or_equiv:sr,Cartn_x:vP,Cartn_y:vP,Cartn_z:vP,group_PDB:Mt(ne),id:ke,label_alt_id:ne,label_asym_id:ne,label_atom_id:ne,label_comp_id:ne,label_entity_id:ne,label_seq_id:ke,occupancy:sr,type_symbol:ne,pdbx_PDB_ins_code:ne,pdbx_PDB_model_num:ke,pdbx_formal_charge:ke,ihm_model_id:ke},atom_site_anisotrop:{id:ke,type_symbol:ne,U:wd(3,3),U_esd:wd(3,3),pdbx_auth_seq_id:ne,pdbx_auth_asym_id:ne,pdbx_auth_atom_id:ne,pdbx_auth_comp_id:ne,pdbx_label_seq_id:ke,pdbx_label_alt_id:ne,pdbx_label_asym_id:ne,pdbx_label_atom_id:ne,pdbx_label_comp_id:ne,pdbx_PDB_ins_code:ne},atom_sites:{entry_id:ne,fract_transf_matrix:wd(3,3),fract_transf_vector:B2(3)},audit_author:{name:ne,pdbx_ordinal:ke,identifier_ORCID:ne},audit_conform:{dict_location:ne,dict_name:ne,dict_version:ne},cell:{angle_alpha:sr,angle_beta:sr,angle_gamma:sr,entry_id:ne,length_a:sr,length_b:sr,length_c:sr,Z_PDB:ke,pdbx_unique_axis:ne},chem_comp:{formula:ne,formula_weight:sr,id:ne,mon_nstd_flag:Mt(ne),name:ne,type:Mt(ne),pdbx_synonyms:gh(";",function(e){return e})},chem_comp_bond:{atom_id_1:ne,atom_id_2:ne,comp_id:ne,value_order:Mt(ne),pdbx_ordinal:ke,pdbx_stereo_config:Mt(ne),pdbx_aromatic_flag:Mt(ne)},citation:{book_publisher:ne,country:ne,id:ne,journal_abbrev:ne,journal_id_ASTM:ne,journal_id_CSD:ne,journal_id_ISSN:ne,journal_volume:ne,page_first:ne,page_last:ne,title:ne,year:ke,pdbx_database_id_DOI:ne,pdbx_database_id_PubMed:ke},citation_author:{citation_id:ne,name:ne,ordinal:ke},database_2:{database_id:Mt(ne),database_code:ne},entity:{details:ne,formula_weight:sr,id:ne,src_method:Mt(ne),type:Mt(ne),pdbx_description:gh(",",function(e){return e}),pdbx_number_of_molecules:ke,pdbx_mutation:ne,pdbx_fragment:ne,pdbx_ec:gh(",",function(e){return e})},entity_poly:{entity_id:ne,nstd_linkage:Mt(ne),nstd_monomer:Mt(ne),type:Mt(ne),pdbx_strand_id:gh(",",function(e){return e}),pdbx_seq_one_letter_code:ne,pdbx_seq_one_letter_code_can:ne,pdbx_target_identifier:ne},entity_poly_seq:{entity_id:ne,hetero:Mt(ne),mon_id:ne,num:ke},entry:{id:ne},exptl:{entry_id:ne,method:Mt(ne)},struct:{entry_id:ne,title:ne,pdbx_descriptor:ne},struct_asym:{details:ne,entity_id:ne,id:ne,pdbx_modified:ne,pdbx_blank_PDB_chainid_flag:Mt(ne)},struct_conf:{beg_label_asym_id:ne,beg_label_comp_id:ne,beg_label_seq_id:ke,beg_auth_asym_id:ne,beg_auth_comp_id:ne,beg_auth_seq_id:ke,conf_type_id:Mt(ne),details:ne,end_label_asym_id:ne,end_label_comp_id:ne,end_label_seq_id:ke,end_auth_asym_id:ne,end_auth_comp_id:ne,end_auth_seq_id:ke,id:ne,pdbx_beg_PDB_ins_code:ne,pdbx_end_PDB_ins_code:ne,pdbx_PDB_helix_class:ne,pdbx_PDB_helix_length:ke,pdbx_PDB_helix_id:ne},struct_conn:{conn_type_id:Mt(ne),details:ne,id:ne,ptnr1_label_asym_id:ne,ptnr1_label_atom_id:ne,ptnr1_label_comp_id:ne,ptnr1_label_seq_id:ke,ptnr1_auth_asym_id:ne,ptnr1_auth_comp_id:ne,ptnr1_auth_seq_id:ke,ptnr1_symmetry:ne,ptnr2_label_asym_id:ne,ptnr2_label_atom_id:ne,ptnr2_label_comp_id:ne,ptnr2_label_seq_id:ke,ptnr2_auth_asym_id:ne,ptnr2_auth_comp_id:ne,ptnr2_auth_seq_id:ke,ptnr2_symmetry:ne,pdbx_ptnr1_PDB_ins_code:ne,pdbx_ptnr1_label_alt_id:ne,pdbx_ptnr1_standard_comp_id:ne,pdbx_ptnr2_PDB_ins_code:ne,pdbx_ptnr2_label_alt_id:ne,pdbx_ptnr3_PDB_ins_code:ne,pdbx_ptnr3_label_alt_id:ne,pdbx_ptnr3_label_asym_id:ne,pdbx_ptnr3_label_atom_id:ne,pdbx_ptnr3_label_comp_id:ne,pdbx_ptnr3_label_seq_id:ke,pdbx_PDB_id:ne,pdbx_dist_value:sr,pdbx_value_order:Mt(ne)},struct_conn_type:{criteria:ne,id:Mt(ne),reference:ne},struct_keywords:{entry_id:ne,text:gh(",",function(e){return e}),pdbx_keywords:ne},struct_ncs_oper:{code:Mt(ne),details:ne,id:ke,matrix:wd(3,3),vector:B2(3)},struct_sheet_range:{beg_label_asym_id:ne,beg_label_comp_id:ne,beg_label_seq_id:ke,end_label_asym_id:ne,end_label_comp_id:ne,end_label_seq_id:ke,beg_auth_asym_id:ne,beg_auth_comp_id:ne,beg_auth_seq_id:ke,end_auth_asym_id:ne,end_auth_comp_id:ne,end_auth_seq_id:ke,id:ne,sheet_id:ne,pdbx_beg_PDB_ins_code:ne,pdbx_end_PDB_ins_code:ne},struct_site:{details:ne,id:ne,pdbx_num_residues:ke,pdbx_evidence_code:ne,pdbx_auth_asym_id:ne,pdbx_auth_comp_id:ne,pdbx_auth_seq_id:ne,pdbx_auth_ins_code:ne},struct_site_gen:{details:ne,id:ne,label_alt_id:ne,label_asym_id:ne,label_atom_id:ne,label_comp_id:ne,label_seq_id:ke,auth_asym_id:ne,auth_comp_id:ne,auth_seq_id:ne,site_id:ne,symmetry:ne,pdbx_auth_ins_code:ne,pdbx_num_res:ke},symmetry:{entry_id:ne,cell_setting:Mt(ne),Int_Tables_number:ke,space_group_name_Hall:ne,"space_group_name_H-M":ne},pdbx_database_status:{status_code:Mt(ne),status_code_sf:Mt(ne),status_code_mr:Mt(ne),entry_id:ne,recvd_initial_deposition_date:ne,SG_entry:Mt(ne),deposit_site:Mt(ne),process_site:Mt(ne),status_code_cs:Mt(ne),methods_development_category:Mt(ne),pdb_format_compatible:Mt(ne)},pdbx_nonpoly_scheme:{asym_id:ne,entity_id:ne,mon_id:ne,pdb_strand_id:ne,ndb_seq_num:ne,pdb_seq_num:ne,auth_seq_num:ne,pdb_mon_id:ne,auth_mon_id:ne,pdb_ins_code:ne},pdbx_database_related:{db_name:ne,details:ne,db_id:ne,content_type:Mt(ne)},pdbx_entity_nonpoly:{entity_id:ne,comp_id:ne,name:ne},pdbx_chem_comp_synonyms:{name:ne,comp_id:ne,provenance:Mt(ne)},pdbx_chem_comp_identifier:{comp_id:ne,identifier:ne,type:Mt(ne),program:ne,program_version:ne},pdbx_unobs_or_zero_occ_residues:{id:ke,polymer_flag:Mt(ne),occupancy_flag:Mt(ke),PDB_model_num:ke,auth_asym_id:ne,auth_comp_id:ne,auth_seq_id:ne,PDB_ins_code:ne,label_asym_id:ne,label_comp_id:ne,label_seq_id:ke},pdbx_struct_mod_residue:{id:ke,auth_asym_id:ne,auth_comp_id:ne,auth_seq_id:ke,PDB_ins_code:ne,label_asym_id:ne,label_comp_id:ne,label_seq_id:ke,parent_comp_id:ne,details:ne},pdbx_struct_oper_list:{id:ne,type:Mt(ne),name:ne,symmetry_operation:ne,matrix:wd(3,3),vector:B2(3)},pdbx_struct_assembly:{method_details:ne,oligomeric_details:ne,oligomeric_count:ke,details:ne,id:ne},pdbx_struct_assembly_gen:{asym_id_list:gh(",",function(e){return e}),assembly_id:ne,oper_expression:ne},pdbx_reference_entity_list:{prd_id:ne,ref_entity_id:ne,type:Mt(ne),details:ne,component_id:ke},pdbx_reference_entity_link:{link_id:ke,prd_id:ne,details:ne,ref_entity_id_1:ne,ref_entity_id_2:ne,entity_seq_num_1:ke,entity_seq_num_2:ke,comp_id_1:ne,comp_id_2:ne,atom_id_1:ne,atom_id_2:ne,value_order:Mt(ne),component_1:ke,component_2:ke,link_class:Mt(ne)},pdbx_reference_entity_poly_link:{link_id:ke,prd_id:ne,ref_entity_id:ne,component_id:ke,entity_seq_num_1:ke,entity_seq_num_2:ke,comp_id_1:ne,comp_id_2:ne,atom_id_1:ne,atom_id_2:ne,value_order:Mt(ne)},pdbx_molecule:{prd_id:ne,instance_id:ke,asym_id:ne},pdbx_molecule_features:{prd_id:ne,class:Mt(ne),type:Mt(ne),name:ne,details:ne},entity_src_nat:{entity_id:ne,pdbx_organism_scientific:ne,pdbx_plasmid_name:ne,pdbx_src_id:ke,pdbx_beg_seq_num:ke,pdbx_end_seq_num:ke},entity_src_gen:{entity_id:ne,pdbx_gene_src_gene:gh(",",function(e){return e}),pdbx_gene_src_scientific_name:ne,plasmid_name:ne,pdbx_src_id:ke,pdbx_beg_seq_num:ke,pdbx_end_seq_num:ke},pdbx_entity_src_syn:{organism_scientific:ne,entity_id:ne,pdbx_src_id:ke,pdbx_beg_seq_num:ke,pdbx_end_seq_num:ke},pdbx_entity_branch_descriptor:{entity_id:ne,descriptor:ne,type:Mt(ne),program:ne,program_version:ne,ordinal:ke},pdbx_entity_instance_feature:{details:ne,feature_type:Mt(ne),auth_asym_id:ne,asym_id:ne,auth_seq_num:ne,seq_num:ke,comp_id:ne,auth_comp_id:ne,ordinal:ke},pdbx_entity_branch_list:{entity_id:ne,hetero:Mt(ne),comp_id:ne,num:ke},pdbx_entity_branch_link:{link_id:ke,details:ne,entity_id:ne,entity_branch_list_num_1:ke,entity_branch_list_num_2:ke,comp_id_1:ne,comp_id_2:ne,atom_id_1:ne,leaving_atom_id_1:ne,atom_stereo_config_1:Mt(ne),atom_id_2:ne,leaving_atom_id_2:ne,atom_stereo_config_2:Mt(ne),value_order:Mt(ne)},pdbx_entity_branch:{entity_id:ne,type:Mt(ne)},pdbx_branch_scheme:{entity_id:ne,hetero:Mt(ne),asym_id:ne,mon_id:ne,num:ke,pdb_asym_id:ne,pdb_seq_num:ne,pdb_mon_id:ne,auth_asym_id:ne,auth_seq_num:ne,auth_mon_id:ne},pdbx_chem_comp_related:{comp_id:ne,related_comp_id:ne,relationship_type:Mt(ne),details:ne},ihm_starting_model_details:{starting_model_id:ne,entity_id:ne,entity_description:ne,asym_id:ne,entity_poly_segment_id:ke,starting_model_source:Mt(ne),starting_model_auth_asym_id:ne,starting_model_sequence_offset:ke,dataset_list_id:ke},ihm_starting_comparative_models:{id:ke,starting_model_id:ne,starting_model_auth_asym_id:ne,starting_model_seq_id_begin:ke,starting_model_seq_id_end:ke,template_auth_asym_id:ne,template_seq_id_begin:ke,template_seq_id_end:ke,template_sequence_identity:sr,template_sequence_identity_denominator:Mt(ke),template_dataset_list_id:ke,alignment_file_id:ke},ihm_starting_model_seq_dif:{id:ke,entity_id:ne,asym_id:ne,seq_id:ke,comp_id:ne,starting_model_id:ne,db_asym_id:ne,db_seq_id:ke,db_comp_id:ne,details:ne},ihm_model_representation:{id:ke,name:ne,details:ne},ihm_model_representation_details:{id:ke,representation_id:ke,entity_poly_segment_id:ke,entity_id:ne,entity_description:ne,entity_asym_id:ne,model_object_primitive:Mt(ne),starting_model_id:ne,model_mode:Mt(ne),model_granularity:Mt(ne),model_object_count:ke},ihm_struct_assembly_details:{id:ke,assembly_id:ke,parent_assembly_id:ke,entity_description:ne,entity_id:ne,asym_id:ne,entity_poly_segment_id:ke},ihm_struct_assembly:{id:ke,name:ne,description:ne},ihm_modeling_protocol:{id:ke,num_steps:ke,protocol_name:ne},ihm_modeling_protocol_details:{id:ke,protocol_id:ke,step_id:ke,struct_assembly_id:ke,dataset_group_id:ke,struct_assembly_description:ne,step_name:ne,step_method:ne,num_models_begin:ke,num_models_end:ke,multi_scale_flag:Mt(ne),multi_state_flag:Mt(ne),ordered_flag:Mt(ne),script_file_id:ke,software_id:ke},ihm_multi_state_modeling:{state_id:ke,state_group_id:ke,population_fraction:sr,population_fraction_sd:sr,state_type:ne,state_name:ne,experiment_type:Mt(ne),details:ne},ihm_modeling_post_process:{id:ke,protocol_id:ke,analysis_id:ke,step_id:ke,type:Mt(ne),feature:Mt(ne),num_models_begin:ke,num_models_end:ke},ihm_ensemble_info:{ensemble_id:ke,ensemble_name:ne,post_process_id:ke,model_group_id:ke,ensemble_clustering_method:Mt(ne),ensemble_clustering_feature:Mt(ne),num_ensemble_models:ke,num_ensemble_models_deposited:ke,ensemble_precision_value:sr,ensemble_file_id:ke},ihm_model_list:{model_id:ke,model_name:ne,assembly_id:ke,protocol_id:ke,representation_id:ke},ihm_model_group:{id:ke,name:ne,details:ne},ihm_model_group_link:{model_id:ke,group_id:ke},ihm_model_representative:{id:ke,model_group_id:ke,model_id:ke,selection_criteria:Mt(ne)},ihm_dataset_list:{id:ke,data_type:Mt(ne),database_hosted:Mt(ne)},ihm_dataset_group:{id:ke,name:ne,application:Mt(ne),details:ne},ihm_dataset_group_link:{dataset_list_id:ke,group_id:ke},ihm_related_datasets:{dataset_list_id_derived:ke,dataset_list_id_primary:ke},ihm_dataset_related_db_reference:{id:ke,dataset_list_id:ke,db_name:Mt(ne),accession_code:ne,version:ne,details:ne},ihm_external_reference_info:{reference_id:ke,reference_provider:ne,reference_type:Mt(ne),reference:ne,refers_to:Mt(ne),associated_url:ne},ihm_external_files:{id:ke,reference_id:ke,file_path:ne,content_type:Mt(ne),file_size_bytes:sr,details:ne},ihm_dataset_external_reference:{id:ke,dataset_list_id:ke,file_id:ke},ihm_localization_density_files:{id:ke,file_id:ke,ensemble_id:ke,entity_id:ne,entity_poly_segment_id:ke,asym_id:ne},ihm_predicted_contact_restraint:{id:ke,group_id:ke,entity_id_1:ne,entity_id_2:ne,asym_id_1:ne,asym_id_2:ne,comp_id_1:ne,comp_id_2:ne,seq_id_1:ke,seq_id_2:ke,rep_atom_1:Mt(ne),rep_atom_2:Mt(ne),distance_lower_limit:sr,distance_upper_limit:sr,probability:sr,restraint_type:Mt(ne),model_granularity:Mt(ne),dataset_list_id:ke,software_id:ke},ihm_cross_link_list:{id:ke,group_id:ke,entity_description_1:ne,entity_description_2:ne,entity_id_1:ne,entity_id_2:ne,comp_id_1:ne,comp_id_2:ne,seq_id_1:ke,seq_id_2:ke,linker_type:Mt(ne),dataset_list_id:ke},ihm_cross_link_restraint:{id:ke,group_id:ke,entity_id_1:ne,entity_id_2:ne,asym_id_1:ne,asym_id_2:ne,comp_id_1:ne,comp_id_2:ne,seq_id_1:ke,seq_id_2:ke,atom_id_1:ne,atom_id_2:ne,restraint_type:Mt(ne),conditional_crosslink_flag:Mt(ne),model_granularity:Mt(ne),distance_threshold:sr,psi:sr,sigma_1:sr,sigma_2:sr},ihm_cross_link_result_parameters:{id:ke,restraint_id:ke,model_id:ke,psi:sr,sigma_1:sr,sigma_2:sr},ihm_2dem_class_average_restraint:{id:ke,dataset_list_id:ke,number_raw_micrographs:ke,pixel_size_width:sr,pixel_size_height:sr,image_resolution:sr,image_segment_flag:Mt(ne),number_of_projections:ke,struct_assembly_id:ke,details:ne},ihm_2dem_class_average_fitting:{id:ke,restraint_id:ke,model_id:ke,cross_correlation_coefficient:sr,rot_matrix:wd(3,3),tr_vector:B2(3)},ihm_3dem_restraint:{id:ke,dataset_list_id:ke,model_id:ke,struct_assembly_id:ke,fitting_method:ne,number_of_gaussians:ke,cross_correlation_coefficient:sr},ihm_sas_restraint:{id:ke,dataset_list_id:ke,model_id:ke,struct_assembly_id:ke,profile_segment_flag:Mt(ne),fitting_atom_type:ne,fitting_method:ne,fitting_state:Mt(ne),radius_of_gyration:sr,chi_value:sr,details:ne},ihm_starting_model_coord:{ordinal_id:ke,starting_model_id:ne,group_PDB:Mt(ne),id:ke,type_symbol:ne,entity_id:ne,atom_id:ne,comp_id:ne,seq_id:ke,asym_id:ne,Cartn_x:sr,Cartn_y:sr,Cartn_z:sr,B_iso_or_equiv:sr},ihm_sphere_obj_site:{id:ke,entity_id:ne,seq_id_begin:ke,seq_id_end:ke,asym_id:ne,Cartn_x:sr,Cartn_y:sr,Cartn_z:sr,object_radius:sr,rmsf:sr,model_id:ke},ihm_gaussian_obj_site:{id:ke,entity_id:ne,seq_id_begin:ke,seq_id_end:ke,asym_id:ne,mean_Cartn_x:sr,mean_Cartn_y:sr,mean_Cartn_z:sr,weight:sr,covariance_matrix:wd(3,3),model_id:ke},ihm_gaussian_obj_ensemble:{id:ke,entity_id:ne,seq_id_begin:ke,seq_id_end:ke,asym_id:ne,mean_Cartn_x:sr,mean_Cartn_y:sr,mean_Cartn_z:sr,weight:sr,covariance_matrix:wd(3,3),ensemble_id:ke},ihm_feature_list:{feature_id:ke,feature_type:Mt(ne),entity_type:Mt(ne)},ihm_poly_residue_feature:{ordinal_id:ke,feature_id:ke,entity_id:ne,asym_id:ne,comp_id_begin:ne,comp_id_end:ne,seq_id_begin:ke,seq_id_end:ke},ihm_derived_distance_restraint:{id:ke,group_id:ke,feature_id_1:ke,feature_id_2:ke,group_conditionality:Mt(ne),random_exclusion_fraction:sr,distance_upper_limit:sr,restraint_type:Mt(ne),dataset_list_id:ke}},qTe={type_symbol:ve.Schema.Aliased(vr.atom_site.type_symbol),label_atom_id:vr.atom_site.label_atom_id,auth_atom_id:vr.atom_site.auth_atom_id,label_alt_id:vr.atom_site.label_alt_id,label_comp_id:vr.atom_site.label_comp_id,auth_comp_id:vr.atom_site.auth_comp_id,pdbx_formal_charge:vr.atom_site.pdbx_formal_charge},WTe={group_PDB:vr.atom_site.group_PDB,label_seq_id:vr.atom_site.label_seq_id,auth_seq_id:vr.atom_site.auth_seq_id,pdbx_PDB_ins_code:vr.atom_site.pdbx_PDB_ins_code},$Te={label_asym_id:vr.atom_site.label_asym_id,auth_asym_id:vr.atom_site.auth_asym_id,label_entity_id:vr.atom_site.label_entity_id},HM;(function(e){function t(){return{label_entity_id:"",label_asym_id:"",auth_seq_id:0,pdbx_PDB_ins_code:void 0}}e.EmptyResidueKey=t})(HM||(HM={}));var Gp;(function(e){function t(i,a){return i.residueAtomSegments.index[i.chainAtomSegments.offsets[a]]}e.chainStartResidueIndex=t;function r(i,a){return i.residueAtomSegments.index[i.chainAtomSegments.offsets[a+1]-1]+1}e.chainEndResidueIndexExcl=r;function n(i,a){return r(i,a)-t(i,a)}e.chainResidueCount=n})(Gp||(Gp={}));var C3={H:1,D:1,T:1,HE:2,LI:3,BE:4,B:5,C:6,N:7,O:8,F:9,NE:10,NA:11,MG:12,AL:13,SI:14,P:15,S:16,CL:17,AR:18,K:19,CA:20,SC:21,TI:22,V:23,CR:24,MN:25,FE:26,CO:27,NI:28,CU:29,ZN:30,GA:31,GE:32,AS:33,SE:34,BR:35,KR:36,RB:37,SR:38,Y:39,ZR:40,NB:41,MO:42,TC:43,RU:44,RH:45,PD:46,AG:47,CD:48,IN:49,SN:50,SB:51,TE:52,I:53,XE:54,CS:55,BA:56,LA:57,CE:58,PR:59,ND:60,PM:61,SM:62,EU:63,GD:64,TB:65,DY:66,HO:67,ER:68,TM:69,YB:70,LU:71,HF:72,TA:73,W:74,RE:75,OS:76,IR:77,PT:78,AU:79,HG:80,TL:81,PB:82,BI:83,PO:84,AT:85,RN:86,FR:87,RA:88,AC:89,TH:90,PA:91,U:92,NP:93,PU:94,AM:95,CM:96,BK:97,CF:98,ES:99,FM:100,MD:101,NO:102,LR:103,RF:104,DB:105,SG:106,BH:107,HS:108,MT:109},XTe={1:1.1,2:1.4,3:1.81,4:1.53,5:1.92,6:1.7,7:1.55,8:1.52,9:1.47,10:1.54,11:2.27,12:1.73,13:1.84,14:2.1,15:1.8,16:1.8,17:1.75,18:1.88,19:2.75,20:2.31,21:2.3,22:2.15,23:2.05,24:2.05,25:2.05,26:2.05,27:2,28:2,29:2,30:2.1,31:1.87,32:2.11,33:1.85,34:1.9,35:1.83,36:2.02,37:3.03,38:2.49,39:2.4,40:2.3,41:2.15,42:2.1,43:2.05,44:2.05,45:2,46:2.05,47:2.1,48:2.2,49:2.2,50:1.93,51:2.17,52:2.06,53:1.98,54:2.16,55:3.43,56:2.68,57:2.5,58:2.48,59:2.47,60:2.45,61:2.43,62:2.42,63:2.4,64:2.38,65:2.37,66:2.35,67:2.33,68:2.32,69:2.3,70:2.28,71:2.27,72:2.25,73:2.2,74:2.1,75:2.05,76:2,77:2,78:2.05,79:2.1,80:2.05,81:1.96,82:2.02,83:2.07,84:1.97,85:2.02,86:2.2,87:3.48,88:2.83,89:2,90:2.4,91:2,92:2.3,93:2,94:2,95:2,96:2,97:2,98:2,99:2,100:2,101:2,102:2,103:2,104:2,105:2,106:2,107:2,108:2,109:2},YTe={1:1.008,2:4.0026,3:6.94,4:9.0122,5:10.81,6:10.81,7:14.007,8:15.999,9:18.998,10:20.18,11:22.99,12:24.305,13:26.982,14:28.085,15:30.974,16:32.06,17:35.45,18:39.948,19:39.098,20:40.078,21:44.956,22:47.867,23:50.942,24:51.996,25:54.938,26:55.845,27:58.933,28:58.693,29:63.546,30:65.38,31:69.723,32:72.63,33:74.922,34:78.971,35:79.904,36:83.798,37:85.468,38:87.62,39:88.906,40:91.224,41:92.906,42:95.95,43:96.906,44:101.07,45:102.91,46:106.42,47:107.87,48:112.41,49:114.82,50:118.71,51:121.76,52:127.6,53:127.6,54:131.29,55:132.91,56:137.33,57:138.91,58:140.12,59:140.91,60:144.24,61:144.912,62:150.36,63:151.96,64:157.25,65:158.93,66:162.5,67:164.93,68:167.26,69:168.93,70:173.05,71:174.97,72:178.49,73:180.95,74:183.84,75:186.21,76:190.23,77:192.22,78:195.08,79:196.97,80:200.59,81:204.38,82:207.2,83:208.98,84:1.97,85:2.02,86:2.2,87:3.48,88:2.83,89:2,90:232.04,91:231.04,92:238.03,93:237.048,94:244.064,95:243.061,96:247.07,97:247.07,98:251.079,99:252.083,100:257.095,101:258.098,102:259.101,103:262.11,104:267.122,105:270.131,106:271.134,107:270.133,108:270.134,109:278.156},KTe=1.7,QTe=10.81,ZTe=0;function Pb(e){var t=C3[e];return t===void 0?KTe:XTe[t]}function JTe(e){var t=C3[e];return t===void 0?QTe:YTe[t]}function Tb(e){var t=C3[e];return t===void 0?ZTe:t}function qy(e,t){return t?t.length===1?Rf(t.charCodeAt(0),e):t.length===2?Rf(t.charCodeAt(0),Rf(t.charCodeAt(1),e)):e+" "+t:e}function e4e(e,t,r,n){if(e.has(t)){var i=e.get(t);i.has(r)||i.set(r,n)}else{var i=new Map;e.set(t,i),i.set(r,n)}}function t4e(e){throw new Error("Missing entity entry for entity id '"+e+"'.")}function r4e(e,t,r){return{entities:e,segments:r,label_seq_id:Je.ofSortedArray(t.residues.label_seq_id.toArray({array:Int32Array})),label_atom_id:t.atoms.label_atom_id,auth_atom_id:t.atoms.auth_atom_id,label_alt_id:t.atoms.label_alt_id,chain_index_entity_index:new Int32Array(t.chains._rowCount),entity_index_label_asym_id:new Map,chain_index_label_seq_id:new Map,auth_asym_id_auth_seq_id:new Map,chain_index_auth_seq_id:new Map,label_asym_id:new Map}}var k0=HM.EmptyResidueKey(),n4e=function(){function e(t){this.map=t,this.entityIndex=t.entities.getEntityIndex,this.residueOffsets=this.map.segments.residueAtomSegments.offsets}return e.prototype.getEntityFromChain=function(t){return this.map.chain_index_entity_index[t]},e.prototype.findEntity=function(t){var r=this.map.label_asym_id.get(t);return r!==void 0?r:-1},e.prototype.findChainLabel=function(t){var r=this.entityIndex(t.label_entity_id);if(r<0||!this.map.entity_index_label_asym_id.has(r))return-1;var n=this.map.entity_index_label_asym_id.get(r);return n&&n.has(t.label_asym_id)?n.get(t.label_asym_id):-1},e.prototype.findChainAuth=function(t){if(!this.map.auth_asym_id_auth_seq_id.has(t.auth_asym_id))return-1;var r=this.map.auth_asym_id_auth_seq_id.get(t.auth_asym_id);return r.has(t.auth_seq_id)?r.get(t.auth_seq_id):-1},e.prototype.findResidue=function(t,r,n,i){var a;arguments.length===1?a=t:(k0.label_entity_id=t,k0.label_asym_id=r,k0.auth_seq_id=n,k0.pdbx_PDB_ins_code=i,a=k0);var o=this.findChainLabel(a);if(o<0)return-1;var s=this.map.chain_index_auth_seq_id.get(o),u=qy(a.auth_seq_id,a.pdbx_PDB_ins_code||"");return s.has(u)?s.get(u):-1},e.prototype.findResidueAuth=function(t){var r=this.findChainAuth(t);if(r<0)return-1;var n=this.map.chain_index_auth_seq_id.get(r),i=qy(t.auth_seq_id,t.pdbx_PDB_ins_code||"");return n.has(i)?n.get(i):-1},e.prototype.findResidueInsertion=function(t){var r=this.findChainLabel(t);if(r<0)return-1;var n=this.map.chain_index_label_seq_id.get(r),i=qy(t.label_seq_id,t.pdbx_PDB_ins_code||"");if(n.has(i))return n.get(i);var a=Je.findPredecessorIndex(this.map.label_seq_id,t.label_seq_id),o=Gp.chainStartResidueIndex(this.map.segments,r);if(a<o)return o;var s=Gp.chainEndResidueIndexExcl(this.map.segments,r)-1;return a>=s?s:a},e.prototype.findAtom=function(t){var r=this.findResidue(t);return r<0?-1:typeof t.label_alt_id>"u"?mP(this.residueOffsets[r],this.residueOffsets[r+1],this.map.label_atom_id,t.label_atom_id):gP(this.residueOffsets[r],this.residueOffsets[r+1],this.map.label_atom_id,this.map.label_alt_id,t.label_atom_id,t.label_alt_id)},e.prototype.findAtomAuth=function(t){var r=this.findResidueAuth(t);return r<0?-1:typeof t.label_alt_id>"u"?mP(this.residueOffsets[r],this.residueOffsets[r+1],this.map.auth_atom_id,t.auth_atom_id):gP(this.residueOffsets[r],this.residueOffsets[r+1],this.map.auth_atom_id,this.map.label_alt_id,t.auth_atom_id,t.label_alt_id)},e.prototype.findAtomOnResidue=function(t,r,n){return typeof n>"u"?mP(this.residueOffsets[t],this.residueOffsets[t+1],this.map.label_atom_id,r):gP(this.residueOffsets[t],this.residueOffsets[t+1],this.map.label_atom_id,this.map.label_alt_id,r,n)},e.prototype.findAtomsOnResidue=function(t,r){return i4e(this.residueOffsets[t],this.residueOffsets[t+1],this.map.label_atom_id,r)},e}();function mP(e,t,r,n){for(var i=e;i<t;i++)if(r.value(i)===n)return i;return-1}function i4e(e,t,r,n){for(var i=e;i<t;i++)if(n.has(r.value(i)))return i;return-1}function gP(e,t,r,n,i,a){for(var o=e;o<t;o++)if(r.value(o)===i&&n.value(o)===a)return o;return-1}function a4e(e,t,r){for(var n=r4e(t,e,r),i=e.residues,a=i.label_seq_id,o=i.auth_seq_id,s=i.pdbx_PDB_ins_code,u=e.chains,l=u.label_entity_id,c=u.label_asym_id,d=u.auth_asym_id,f=Te.ofBounds(0,e.atoms._rowCount),h=nr.transientSegments(r.chainAtomSegments,f);h.hasNext;){var v=h.move(),p=v.index,m=t.getEntityIndex(l.value(p));m<0&&t4e(l.value(p)),n.chain_index_entity_index[p]=m;var g=d.value(p),y=n.auth_asym_id_auth_seq_id.get(g);y||(y=new Map,n.auth_asym_id_auth_seq_id.set(g,y));var b=c.value(p);n.label_asym_id.has(b)||n.label_asym_id.set(b,m),e4e(n.entity_index_label_asym_id,m,b,p);var S=new Map,x=new Map;n.chain_index_label_seq_id.set(p,S),n.chain_index_auth_seq_id.set(p,x);for(var C=nr.transientSegments(r.residueAtomSegments,f,v);C.hasNext;){var w=C.move(),A=w.index,M=o.value(A),D=s.value(A);S.set(qy(a.value(A),D),A),x.set(qy(M,D),A),y.set(M,p)}}return new n4e(n)}var to,ro,Dt={Blue:37052,Green:42577,Yellow:16765952,Orange:16021792,Pink:16162465,Purple:10830745,LightBlue:9424105,Brown:10582605,Red:15539236,Secondary:15854817};to={},to[0]="Hexose",to[1]="HexNAc",to[2]="Hexosamine",to[3]="Hexuronate",to[4]="Deoxyhexose",to[5]="DeoxyhexNAc",to[6]="Di-deoxyhexose",to[7]="Pentose",to[8]="Deoxynonulosonate",to[9]="Di-deoxynonulosonate",to[10]="Unknown",to[11]="Assigned";var o4e=(ro={},ro[0]=0,ro[1]=1,ro[2]=2,ro[3]=3,ro[4]=4,ro[5]=5,ro[6]=6,ro[7]=7,ro[8]=8,ro[9]=9,ro[10]=10,ro[11]=11,ro);function s4e(e,t){return e===10?t===4?12:t===5?13:t===6?14:t===7?15:10:o4e[e]}var pK={abbr:"Unk",name:"Unknown",color:Dt.Secondary,type:10},KC=[{abbr:"Glc",name:"Glucose",color:Dt.Blue,type:0},{abbr:"Man",name:"Mannose",color:Dt.Green,type:0},{abbr:"Gal",name:"Galactose",color:Dt.Yellow,type:0},{abbr:"Gul",name:"Gulose",color:Dt.Orange,type:0},{abbr:"Alt",name:"Altrose",color:Dt.Pink,type:0},{abbr:"All",name:"Allose",color:Dt.Purple,type:0},{abbr:"Tal",name:"Talose",color:Dt.LightBlue,type:0},{abbr:"Ido",name:"Idose",color:Dt.Brown,type:0},{abbr:"GlcNAc",name:"N-Acetyl Glucosamine",color:Dt.Blue,type:1},{abbr:"ManNAc",name:"N-Acetyl Mannosamine",color:Dt.Green,type:1},{abbr:"GalNAc",name:"N-Acetyl Galactosamine",color:Dt.Yellow,type:1},{abbr:"GulNAc",name:"N-Acetyl Gulosamine",color:Dt.Orange,type:1},{abbr:"AltNAc",name:"N-Acetyl Altrosamine",color:Dt.Pink,type:1},{abbr:"AllNAc",name:"N-Acetyl Allosamine",color:Dt.Purple,type:1},{abbr:"TalNAc",name:"N-Acetyl Talosamine",color:Dt.LightBlue,type:1},{abbr:"IdoNAc",name:"N-Acetyl Idosamine",color:Dt.Brown,type:1},{abbr:"GlcN",name:"Glucosamine",color:Dt.Blue,type:2},{abbr:"ManN",name:"Mannosamine",color:Dt.Green,type:2},{abbr:"GalN",name:"Galactosamine",color:Dt.Yellow,type:2},{abbr:"GulN",name:"Gulosamine",color:Dt.Orange,type:2},{abbr:"AltN",name:"Altrosamine",color:Dt.Pink,type:2},{abbr:"AllN",name:"Allosamine",color:Dt.Purple,type:2},{abbr:"TalN",name:"Talosamine",color:Dt.LightBlue,type:2},{abbr:"IdoN",name:"Idosamine",color:Dt.Brown,type:2},{abbr:"GlcA",name:"Glucuronic Acid",color:Dt.Blue,type:3},{abbr:"ManA",name:"Mannuronic Acid",color:Dt.Green,type:3},{abbr:"GalA",name:"Galacturonic Acid",color:Dt.Yellow,type:3},{abbr:"GulA",name:"Guluronic Acid",color:Dt.Orange,type:3},{abbr:"AltA",name:"Altruronic Acid",color:Dt.Pink,type:3},{abbr:"AllA",name:"Alluronic Acid",color:Dt.Purple,type:3},{abbr:"TalA",name:"Taluronic Acid",color:Dt.LightBlue,type:3},{abbr:"IdoA",name:"Iduronic Acid",color:Dt.Brown,type:3},{abbr:"Qui",name:"Quinovose",color:Dt.Blue,type:4},{abbr:"Rha",name:"Rhamnose",color:Dt.Green,type:4},{abbr:"6dGul",name:"6-Deoxy Gulose",color:Dt.Orange,type:4},{abbr:"6dAlt",name:"6-Deoxy Altrose",color:Dt.Pink,type:4},{abbr:"6dTal",name:"6-Deoxy Talose",color:Dt.LightBlue,type:4},{abbr:"Fuc",name:"Fucose",color:Dt.Red,type:4},{abbr:"QuiNAc",name:"N-Acetyl Quinovosamine",color:Dt.Blue,type:5},{abbr:"RhaNAc",name:"N-Acetyl Rhamnosamine",color:Dt.Green,type:5},{abbr:"6dAltNAc",name:"N-Acetyl 6-Deoxy Altrosamine",color:Dt.Pink,type:5},{abbr:"6dTalNAc",name:"N-Acetyl 6-Deoxy Talosamine",color:Dt.LightBlue,type:5},{abbr:"FucNAc",name:"N-Acetyl Fucosamine",color:Dt.Red,type:5},{abbr:"Oli",name:"Olivose",color:Dt.Blue,type:6},{abbr:"Tyv",name:"Tyvelose",color:Dt.Green,type:6},{abbr:"Abe",name:"Abequose",color:Dt.Orange,type:6},{abbr:"Par",name:"Paratose",color:Dt.Pink,type:6},{abbr:"Dig",name:"Digitoxose",color:Dt.Purple,type:6},{abbr:"Col",name:"Colitose",color:Dt.LightBlue,type:6},{abbr:"Ara",name:"Arabinose",color:Dt.Green,type:7},{abbr:"Lyx",name:"Lyxose",color:Dt.Yellow,type:7},{abbr:"Xyl",name:"Xylose",color:Dt.Orange,type:7},{abbr:"Rib",name:"Ribose",color:Dt.Pink,type:7},{abbr:"Kdn",name:"Keto-Deoxy Nonulonic Acid",color:Dt.Green,type:8},{abbr:"Neu5Ac",name:"N-Acetyl Neuraminic Acid",color:Dt.Purple,type:8},{abbr:"Neu5Gc",name:"N-Glycolyl Neuraminic Acid",color:Dt.LightBlue,type:8},{abbr:"Neu",name:"Neuraminic Acid",color:Dt.Brown,type:8},{abbr:"Sia",name:"Sialic acid",color:Dt.Red,type:8},{abbr:"Pse",name:"Pseudaminic Acid",color:Dt.Green,type:9},{abbr:"Leg",name:"Legionaminic Acid",color:Dt.Yellow,type:9},{abbr:"Aci",name:"Acinetaminic Acid",color:Dt.Pink,type:9},{abbr:"4eLeg",name:"4-Epilegionaminic Acid",color:Dt.LightBlue,type:9},{abbr:"Bac",name:"Bacillosamine",color:Dt.Blue,type:10},{abbr:"LDmanHep",name:"L-Glycero-D-Manno Heptose",color:Dt.Green,type:10},{abbr:"Kdo",name:"Keto-Deoxy Octulonic Acid",color:Dt.Yellow,type:10},{abbr:"Dha",name:"3-Deoxy Lyxo-Heptulosaric Acid",color:Dt.Orange,type:10},{abbr:"DDmanHep",name:"D-Glycero-D-Manno-Heptose",color:Dt.Pink,type:10},{abbr:"MurNAc",name:"N-Acetyl Muramic Acid",color:Dt.Purple,type:10},{abbr:"MurNGc",name:"N-Glycolyl Muramic Acid",color:Dt.LightBlue,type:10},{abbr:"Mur",name:"Muramic Acid",color:Dt.Brown,type:10},{abbr:"Api",name:"Apicose",color:Dt.Green,type:11},{abbr:"Fru",name:"Fructose",color:Dt.Green,type:11},{abbr:"Tag",name:"Tagatose",color:Dt.Yellow,type:11},{abbr:"Sor",name:"Sorbose",color:Dt.Orange,type:11},{abbr:"Psi",name:"Psicose",color:Dt.Pink,type:11}],u4e=function(){for(var e=new Map,t=0,r=KC.length;t<r;++t){var n=KC[t];e.set(n.abbr,n)}return e}(),l4e=[["Glc-family",Dt.Blue],["Man-family",Dt.Green],["Gal-family",Dt.Yellow],["Gul-family",Dt.Orange],["Alt-family",Dt.Pink],["All-family",Dt.Purple],["Tal-family",Dt.LightBlue],["Ido-family",Dt.Brown],["Fuc-family",Dt.Red],["Generic/Unknown/Secondary",Dt.Secondary]],c4e={Glc:["GLC","BGC","Z8T","TRE","MLR"],Man:["MAN","BMA"],Gal:["GLA","GAL","GZL","GXL","GIV"],Gul:["4GL","GL0","GUP","Z8H"],Alt:["Z6H","3MK","SHD"],All:["AFD","ALL","WOO","Z2D"],Tal:["ZEE","A5C","SDY"],Ido:["ZCD","Z0F","4N2"],GlcNAc:["NDG","NAG","NGZ"],ManNAc:["BM3","BM7"],GalNAc:["A2G","NGA","YYQ"],GulNAc:["LXB"],AltNAc:[],AllNAc:["NAA"],TalNAc:[],IdoNAc:["LXZ","HSQ"],GlcN:["PA1","GCS"],ManN:["95Z"],GalN:["X6X","1GN"],GulN:[],AltN:[],AllN:[],TalN:[],IdoN:[],GlcA:["GCU","BDP"],ManA:["MAV","BEM"],GalA:["ADA","GTR","GTK"],GulA:["LGU"],AltA:[],AllA:[],TalA:["X1X","X0X"],IdoA:["IDR"],Qui:["G6D","YYK"],Rha:["RAM","RM4","XXR"],"6dGul":["66O"],"6dAlt":[],"6dTal":[],Fuc:["FUC","FUL","FCA","FCB","GYE"],QuiNAc:["Z9W"],RhaNAc:[],"6dAltNAc":[],"6dTalNAc":[],FucNAc:["49T"],Oli:["DDA","RAE","Z5J"],Tyv:["TYV"],Abe:["ABE"],Par:["PZU"],Dig:["Z3U"],Col:[],Ara:["64K","ARA","ARB","AHR","FUB","BXY","BXX","SEJ"],Lyx:["LDY","Z4W"],Xyl:["XYS","XYP","XYZ","HSY","LXC"],Rib:["YYM","RIP","RIB","BDR","0MK","Z6J","32O"],Kdn:["KDM","KDN"],Neu5Ac:["SIA","SLB"],Neu5Gc:["NGC","NGE"],Neu:[],Sia:[],Pse:[],Leg:[],Aci:[],"4eLeg":[],Bac:[],LDmanHep:["GMH"],Kdo:["KDO"],Dha:[],DDmanHep:["289"],MurNAc:["MUB","AMU"],MurNGc:[],Mur:["1S4","MUR"],Api:["XXM"],Fru:["BDF","Z9N","FRU","LFR"],Tag:["T6T"],Sor:["SOE","UEA"],Psi:["PSV","SF6","SF9","TTV"]},I7=["NGZ","LAT","PUF","GDA","9WJ"],bp=function(){for(var e=new Map,t=0,r=KC.length;t<r;++t){var n=KC[t],i=c4e[n.abbr];if(i)for(var a=0,o=i.length;a<o;++a)e.set(i[a],n)}for(var t=0,r=I7.length;t<r;++t)e.set(I7[t],pK);return e}(),li;(function(e){function t(h){return Nk(h.values())}e.toArray=t;function r(h,v){var p=!0;return v.forEach(function(m){h.has(m)||(p=!1)}),p}e.isSuperset=r;function n(h){for(var v=[],p=1;p<arguments.length;p++)v[p-1]=arguments[p];for(var m=0;m<v.length;m++)v[m].forEach(function(g){return h.add(g)});return h}e.add=n;function i(h,v){var p=new Set(h);return v.forEach(function(m){return p.add(m)}),p}e.union=i;function a(){for(var h=[],v=0;v<arguments.length;v++)h[v]=arguments[v];if(h.length===0)return new Set;h.length===1&&new Set(h[0]);for(var p=new Set(h[0]),m=1,g=h.length;m<g;m++)h[m].forEach(function(y){return p.add(y)});return p}e.unionMany=a;function o(h){if(h.length===0)return new Set;for(var v=new Set(h[0]),p=1;p<h.length;p++)for(var m=0,g=h[p];m<g.length;m++){var y=g[m];v.add(y)}return v}e.unionManyArrays=o;function s(h,v){var p=new Set;return v.forEach(function(m){h.has(m)&&p.add(m)}),p}e.intersection=s;function u(h,v){var p=!1;return v.forEach(function(m){h.has(m)&&(p=!0)}),p}e.areIntersecting=u;function l(h,v){var p=0;return v.forEach(function(m){h.has(m)&&(p+=1)}),p}e.intersectionSize=l;function c(h,v){var p=new Set(h);return v.forEach(function(m){return p.delete(m)}),p}e.difference=c;function d(h,v){var p=h.size;return h.forEach(function(m){v.has(m)&&(p-=1)}),p}e.differenceSize=d;function f(h,v){if(h.size!==v.size)return!1;var p=!0;return v.forEach(function(m){h.has(m)||(p=!1)}),p}e.areEqual=f})(li||(li={}));var vK=new Set(["DAPC","DBPC","DFPC","DGPC","DIPC","DLPC","DNPC","DOPC","DPPC","DRPC","DTPC","DVPC","DXPC","DYPC","LPPC","PAPC","PEPC","PGPC","PIPC","POPC","PRPC","PUPC","DAPE","DBPE","DFPE","DGPE","DIPE","DLPE","DNPE","DOPE","DPPE","DRPE","DTPE","DUPE","DVPE","DXPE","DYPE","LPPE","PAPE","PGPE","PIPE","POPE","PQPE","PRPE","PUPE","DAPS","DBPS","DFPS","DGPS","DIPS","DLPS","DNPS","DOPS","DPPS","DRPS","DTPS","DUPS","DVPS","DXPS","DYPS","LPPS","PAPS","PGPS","PIPS","POPS","PQPS","PRPS","PUPS","DAPG","DBPG","DFPG","DGPG","DIPG","DLPG","DNPG","DOPG","DPPG","DRPG","DTPG","DVPG","DXPG","DYPG","LPPG","PAPG","PGPG","PIPG","POPG","PRPG","DAPA","DBPA","DFPA","DGPA","DIPA","DLPA","DNPA","DOPA","DPPA","DRPA","DTPA","DVPA","DXPA","DYPA","LPPA","PAPA","PGPA","PIPA","POPA","PRPA","PUPA","DPP","DPPI","PAPI","PIPI","POP","POPI","PUPI","PVP","PVPI","PADG","PIDG","PODG","PUDG","PVDG","APC","CPC","IPC","LPC","OPC","PPC","TPC","UPC","VPC","BNSM","DBSM","DPSM","DXSM","PGSM","PNSM","POSM","PVSM","XNSM","DPCE","DXCE","PNCE","XNCE","DMPC"]),mK=new Set(["118","119","543","1AL","1CU","2FK","2HP","2OF","3CO","3MT","3NI","3OF","3P8","4MO","4PU","4TI","6MO","ACT","AG","AL","ALF","AM","ATH","AU","AU3","AUC","AZI","BA","BCT","BEF","BF4","BO4","BR","BS3","BSY","CA","CAC","CD","CD1","CD3","CD5","CE","CF","CHT","CL","CO","CO3","CO5","CON","CR","CS","CSB","CU","CU1","CU3","CUA","CUZ","CYN","DME","DMI","DSC","DTI","DY","E4N","EDR","EMC","ER3","EU","EU3","F","FE","FE2","FPO","GA","GD3","GEP","HAI","HG","HGC","IN","IOD","IR","IR3","IRI","IUM","K","KO4","LA","LCO","LCP","LI","LU","MAC","MG","MH2","MH3","MLI","MMC","MN","MN3","MN5","MN6","MO1","MO2","MO3","MO4","MO5","MO6","MOO","MOS","MOW","MW1","MW2","MW3","NA","NA2","NA5","NA6","NAO","NAW","NET","NH4","NI","NI1","NI2","NI3","NO2","NO3","NRU","O4M","OAA","OC1","OC2","OC3","OC4","OC5","OC6","OC7","OC8","OCL","OCM","OCN","OCO","OF1","OF2","OF3","OH","OS","OS4","OXL","PB","PBM","PD","PDV","PER","PI","PO3","PO4","PR","PT","PT4","PTN","RB","RH3","RHD","RU","SB","SCN","SE4","SEK","SM","SMO","SO3","SO4","SR","T1A","TB","TBA","TCN","TEA","TH","THE","TL","TMA","TRA","UNX","V","VN3","VO4","W","WO5","Y1","YB","YB2","YH","YT3","ZCM","ZN","ZN2","ZN3","ZNO","ZO3","ZR","NCO","OHX"]),Fl,d4e=function(){for(var e=Object.create(null),t=[],r="A".charCodeAt(0);r<="Z".charCodeAt(0);r++)t[t.length]=String.fromCharCode(r);for(var r="a".charCodeAt(0);r<="z".charCodeAt(0);r++)t[t.length]=String.fromCharCode(r);for(var r="0".charCodeAt(0);r<="9".charCodeAt(0);r++)t[t.length]=String.fromCharCode(r);for(var n=0,i=t;n<i.length;n++){var a=i[n];e[a]=a.toUpperCase();for(var o=0,s=t;o<s.length;o++){var u=s[o];e[a+u]=(a+u).toUpperCase();for(var l=0,c=t;l<c.length;l++){var d=c[l];e[a+u+d]=(a+u+d).toUpperCase()}}}return e}();function Yg(e){return d4e[e]||e.toUpperCase()}var M7=new Map([[1,"H"],[2,"He"],[3,"Li"],[4,"Be"],[5,"B"],[6,"C"],[7,"N"],[8,"O"],[9,"F"],[10,"Ne"],[11,"Na"],[12,"Mg"],[13,"Al"],[14,"Si"],[15,"P"],[16,"S"],[17,"Cl"],[18,"Ar"],[19,"K"],[20,"Ca"],[21,"Sc"],[22,"Ti"],[23,"V"],[24,"Cr"],[25,"Mn"],[26,"Fe"],[27,"Co"],[28,"Ni"],[29,"Cu"],[30,"Zn"],[31,"Ga"],[32,"Ge"],[33,"As"],[34,"Se"],[35,"Br"],[36,"Kr"],[37,"Rb"],[38,"Sr"],[39,"Y"],[40,"Zr"],[41,"Nb"],[42,"Mo"],[43,"Tc"],[44,"Ru"],[45,"Rh"],[46,"Pd"],[47,"Ag"],[48,"Cd"],[49,"In"],[50,"Sn"],[51,"Sb"],[52,"Te"],[53,"I"],[54,"Xe"],[55,"Cs"],[56,"Ba"],[57,"La"],[58,"Ce"],[59,"Pr"],[60,"Nd"],[61,"Pm"],[62,"Sm"],[63,"Eu"],[64,"Gd"],[65,"Tb"],[66,"Dy"],[67,"Ho"],[68,"Er"],[69,"Tm"],[70,"Yb"],[71,"Lu"],[72,"Hf"],[73,"Ta"],[74,"W"],[75,"Re"],[76,"Os"],[77,"Ir"],[78,"Pt"],[79,"Au"],[80,"Hg"],[81,"Tl"],[82,"Pb"],[83,"Bi"],[84,"Po"],[85,"At"],[86,"Rn"],[87,"Fr"],[88,"Ra"],[89,"Ac"],[90,"Th"],[91,"Pa"],[92,"U"],[93,"Np"],[94,"Pu"],[95,"Am"],[96,"Cm"],[97,"Bk"],[98,"Cf"],[99,"Es"],[100,"Fm"],[101,"Md"],[102,"No"],[103,"Lr"],[104,"Rf"],[105,"Db"],[106,"Sg"],[107,"Bh"],[108,"Hs"],[109,"Mt"],[110,"Ds"],[111,"Rg"],[112,"Cn"],[113,"Uut"],[114,"Fl"],[115,"Uup"],[116,"Lv"],[117,"Uus"],[118,"Uuo"]].map(function(e){return[e[0],Yg(e[1])]}));function f4e(e){return M7.has(e)?M7.get(e):Yg("H")}var h4e=(Fl={},Fl[0]={trace:new Set,directionFrom:new Set,directionTo:new Set,backboneStart:new Set,backboneEnd:new Set,coarseBackbone:new Set},Fl[1]={trace:new Set(["CA"]),directionFrom:new Set(["C"]),directionTo:new Set(["O","OC1","O1","OX1","OXT","OT1"]),backboneStart:new Set(["N"]),backboneEnd:new Set(["C"]),coarseBackbone:new Set(["CA","BB","CA1"])},Fl[2]={trace:new Set(["CA"]),directionFrom:new Set(["C"]),directionTo:new Set(["O"]),backboneStart:new Set(["N"]),backboneEnd:new Set(["CD"]),coarseBackbone:new Set(["CA"])},Fl[3]={trace:new Set(["CA"]),directionFrom:new Set(["C"]),directionTo:new Set(["O"]),backboneStart:new Set(["N"]),backboneEnd:new Set(["CG"]),coarseBackbone:new Set(["CA"])},Fl[4]={trace:new Set(["O3'","O3*"]),directionFrom:new Set(["C4'","C4*"]),directionTo:new Set(["C3'","C3*"]),backboneStart:new Set(["P"]),backboneEnd:new Set(["O3'","O3*"]),coarseBackbone:new Set(["P"])},Fl[5]={trace:new Set(["O3'","O3*"]),directionFrom:new Set(["C3'","C3*"]),directionTo:new Set(["C1'","C1*"]),backboneStart:new Set(["P"]),backboneEnd:new Set(["O3'","O3*"]),coarseBackbone:new Set(["P"])},Fl[6]={trace:new Set(["N4'","N4*"]),directionFrom:new Set(["N4'","N4*"]),directionTo:new Set(["C7'","C7*"]),backboneStart:new Set(["N1'","N1*"]),backboneEnd:new Set(["C'","C*"]),coarseBackbone:new Set(["P"])},Fl),Nc=new Set(["CA","C","N","O","O1","O2","OC1","OC2","OT1","OT2","OX1","OXT","H","H1","H2","H3","HA","HN","HXT","BB"]),_3=new Set(["P","OP1","OP2","HOP2","HOP3","O2'","O3'","O4'","O5'","C1'","C2'","C3'","C4'","C5'","H1'","H2'","H2''","HO2'","H3'","H4'","H5'","H5''","HO3'","HO5'","O2*","O3*","O4*","O5*","C1*","C2*","C3*","C4*","C5*"]),gK=new Set(["D-PEPTIDE LINKING","D-PEPTIDE NH3 AMINO TERMINUS","D-PEPTIDE COOH CARBOXY TERMINUS","D-GAMMA-PEPTIDE, C-DELTA LINKING","D-BETA-PEPTIDE, C-GAMMA LINKING"]),yK=new Set(["L-PEPTIDE LINKING","L-PEPTIDE NH3 AMINO TERMINUS","L-PEPTIDE COOH CARBOXY TERMINUS","L-GAMMA-PEPTIDE, C-DELTA LINKING","L-BETA-PEPTIDE, C-GAMMA LINKING"]),p4e=new Set(["D-GAMMA-PEPTIDE, C-DELTA LINKING","L-GAMMA-PEPTIDE, C-DELTA LINKING"]),v4e=new Set(["D-BETA-PEPTIDE, C-GAMMA LINKING","L-BETA-PEPTIDE, C-GAMMA LINKING"]),m4e=new Set(["D-PEPTIDE NH3 AMINO TERMINUS","D-PEPTIDE COOH CARBOXY TERMINUS","L-PEPTIDE NH3 AMINO TERMINUS","L-PEPTIDE COOH CARBOXY TERMINUS"]),bK=new Set(["PEPTIDE LINKING","PEPTIDE-LIKE"]),g4e=li.unionMany(gK,yK,bK),xK=new Set(["DNA LINKING","L-DNA LINKING","DNA OH 5 PRIME TERMINUS","DNA OH 3 PRIME TERMINUS"]),SK=new Set(["RNA LINKING","L-RNA LINKING","RNA OH 5 PRIME TERMINUS","RNA OH 3 PRIME TERMINUS"]),CK=new Set(["D-SACCHARIDE, BETA LINKING","L-SACCHARIDE, BETA LINKING","D-SACCHARIDE, ALPHA LINKING","L-SACCHARIDE, ALPHA LINKING","L-SACCHARIDE","D-SACCHARIDE","SACCHARIDE","D-SACCHARIDE 1,4 AND 1,4 LINKING","L-SACCHARIDE 1,4 AND 1,4 LINKING","D-SACCHARIDE 1,4 AND 1,6 LINKING","L-SACCHARIDE 1,4 AND 1,6 LINKING"]),y4e=new Set(["NON-POLYMER","OTHER"]),b4e=new Set(["ION"]),x4e=new Set(["LIPID"]),w3=new Set(["SOL","WAT","HOH","H2O","W","DOD","D3O","TIP","TIP3","TIP4","SPC"]),uO=new Set(["HIS","ARG","LYS","ILE","PHE","LEU","TRP","ALA","MET","PRO","CYS","ASN","VAL","GLY","SER","GLN","TYR","ASP","GLU","THR","SEC","PYL","UNK","MSE","SEP","TPO","PTR","PCA","HSD","HSE","HSP","LSN","ASPP","GLUP","HID","HIE","HIP","LYN","ASH","GLH"]),_K=new Set(["DAL","DAR","DSG","DAS","DCY","DGL","DGN","DHI","DIL","DLE","DLY","MED","DPN","DPR","DSN","DTH","DTR","DTY","DVA","DNE"]),E3=li.unionMany(uO,_K),A3=new Set(["A","C","T","G","I","U","N"]),P3=new Set(["DA","DC","DT","DG","DI","DU","DN"]),lO=new Set(["APN","CPN","TPN","GPN"]),S4e=new Set(["A","G","I","DA","DG","DI","APN","GPN"]),C4e=new Set(["C","T","U","DC","DT","DU","CPN","TPN"]),T3=li.unionMany(A3,P3,lO),wK=function(e){return S4e.has(e.toUpperCase())},EK=function(e){return C4e.has(e.toUpperCase())},Ib=li.unionMany(E3,T3);function Kg(e,t){return e=e.toUpperCase(),t=t.toUpperCase(),lO.has(t)?8:g4e.has(e)?5:SK.has(e)?6:xK.has(e)?7:CK.has(e)?9:w3.has(t)?2:mK.has(t)?3:vK.has(t)?4:y4e.has(e)?bp.has(t)?9:1:0}function _4e(e,t){return e=e.toUpperCase(),t===5?p4e.has(e)?2:v4e.has(e)?3:m4e.has(e)?0:1:t===6?4:t===7?5:t===8?6:0}function AK(e){return e=e.toUpperCase(),E3.has(e)?"peptide linking":A3.has(e)?"RNA linking":P3.has(e)?"DNA linking":bp.has(e)?"saccharide":"other"}function w4e(e){return{formula:"",formula_weight:0,id:e,name:e,mon_nstd_flag:Ib.has(e)?"y":"n",pdbx_synonyms:[],type:AK(e)}}function E4e(e){return e=e.toUpperCase(),w3.has(e)?"water":Ib.has(e)?"polymer":bp.has(e)?"branched":"non-polymer"}function A4e(e,t){return e=e.toUpperCase(),t=t.toUpperCase(),yK.has(t)?"polypeptide(L)":gK.has(t)?"polypeptide(D)":SK.has(t)?"polyribonucleotide":xK.has(t)?"polydeoxyribonucleotide":CK.has(t)||bp.has(e)?"oligosaccharide":lO.has(e)?"peptide nucleic acid":uO.has(e)?"polypeptide(L)":_K.has(e)?"polypeptide(D)":A3.has(e)?"polyribonucleotide":P3.has(e)?"polydeoxyribonucleotide":b4e.has(t)||mK.has(e)?"ion":x4e.has(t)||vK.has(e)?"lipid":bK.has(t)?"peptide-like":"other"}function cO(e){return Il(e)||PK(e)}function Il(e){return e===7||e===6||e===8}function PK(e){return e===5}var Lr;(function(e){e.is=da.has,e.create=da.create,e.SecondaryStructureMmcif={HELX_LH_27_P:1058,HELX_LH_3T_P:2082,HELX_LH_AL_P:4130,HELX_LH_A_N:524321,HELX_LH_B_N:1048609,HELX_LH_GA_P:8226,HELX_LH_N:33,HELX_LH_OM_P:16418,HELX_LH_OT_N:131105,HELX_LH_OT_P:546,HELX_LH_P:34,HELX_LH_PI_P:32802,HELX_LH_PP_P:65570,HELX_LH_Z_N:262177,HELX_N:1,HELX_OT_N:1,HELX_OT_P:2,HELX_P:2,HELX_RH_27_P:1090,HELX_RH_3T_P:2114,HELX_RH_AL_P:4162,HELX_RH_A_N:524353,HELX_RH_B_N:1048641,HELX_RH_GA_P:8258,HELX_RH_N:65,HELX_RH_OM_P:16450,HELX_RH_OT_N:131137,HELX_RH_OT_P:578,HELX_RH_P:66,HELX_RH_PI_P:32834,HELX_RH_PP_P:65602,HELX_RH_Z_N:262209,STRN:4194308,TURN_OT_P:33554448,TURN_P:16,TURN_TY1P_P:67109136,TURN_TY1_P:67109008,TURN_TY2P_P:134218e3,TURN_TY2_P:134217872,TURN_TY3P_P:268435728,TURN_TY3_P:268435600},e.SecondaryStructurePdb={1:4162,2:16450,3:32834,4:8258,5:2114,6:4130,7:16418,8:8226,9:1026,10:65538},e.SecondaryStructureStride={H:4098,G:2050,I:32770,E:8388612,B:4194308,T:16,C:536870912},e.SecondaryStructureDssp={H:4098,B:4194308,E:8388612,G:2050,I:32770,T:16,S:8}})(Lr||(Lr={}));var Nr;(function(e){e.is=da.has;function t(s){return da.create(s)}e.create=t;function r(s){return(s&1)!==0}e.isCovalent=r;function n(s){return s===Math.pow(2,6)-1}e.isAll=n,e.Names={covalent:1,"metal-coordination":2,"hydrogen-bond":4,disulfide:8,aromatic:16,computed:32};function i(s){return s in e.Names}e.isName=i;function a(s){switch(s){case"covalent":return 1;case"metal-coordination":return 2;case"hydrogen-bond":return 4;case"disulfide":return 8;case"aromatic":return 16;case"computed":return 32}}e.fromName=a;function o(s){for(var u=0,l=0,c=s.length;l<c;++l)u|=a(s[l]);return u}e.fromNames=o})(Nr||(Nr={}));var GM={ALA:[.17,.5,.33],ARG:[.81,1.81,1],ASN:[.42,.85,.43],ASP:[1.23,3.64,2.41],ASH:[-.07,.43,.5],CYS:[-.24,-.02,.22],GLN:[.58,.77,.19],GLU:[2.02,3.63,1.61],GLH:[-.01,.11,.12],GLY:[.01,1.15,1.14],HIS:[.17,.11,-.06],ILE:[-.31,-1.12,-.81],LEU:[-.56,-1.25,-.69],LYS:[.99,2.8,1.81],MET:[-.23,-.67,-.44],PHE:[-1.13,-1.71,-.58],PRO:[.45,.14,-.31],SER:[.13,.46,.33],THR:[.14,.25,.11],TRP:[-1.85,-2.09,-.24],TYR:[-.94,-.71,.23],VAL:[.07,-.46,-.53],HSD:[.17,.11,-.06],HSE:[.17,.11,-.06],HSP:[.96,2.33,1.37],HID:[.17,.11,-.06],HIE:[.17,.11,-.06],HIP:[.96,2.33,1.37]};function P4e(e,t){var r=e.coarseElements.entityKey[t],n=e.model.sequence.byEntityKey[r].sequence,i=e.coarseElements.seq_id_begin.value(t);return n.compId.value(i-1)}function dO(e,t){switch(e.kind){case 0:return e.model.atomicHierarchy.derived.residue.moleculeType[e.residueIndex[t]];case 1:case 2:var r=P4e(e,t),n=e.model.properties.chemicalComponentMap.get(r);if(n)return Kg(n.type,r)}return 0}var T4e=new Set;function mf(e,t){var r=h4e[e];if(r!==void 0){var n=r[t];if(n!==void 0)return n}return T4e}var D7=_.zero();function TK(e,t){for(var r=e.conformation.position,n=new Float32Array(t.length*3),i=e.elements,a=0,o=t.length;a<o;++a)r(i[t[a]],D7),_.toArray(D7,n,a*3);return n}function I4e(e,t,r,n){for(var i=e.atoms,a=i.label_comp_id,o=i.type_symbol,s=i._rowCount,u=e.residues._rowCount,l=t.residueAtomSegments.offsets,c=new Uint8Array(s),d=0;d<s;++d)c[d]=Tb(o.value(d));for(var f=new Int32Array(u),h=new Int32Array(u),v=new Int32Array(u),p=new Uint8Array(u),m=new Uint8Array(u),g=new Map,y=new Map,d=0;d<u;++d){var b=a.value(l[d]),S=n,x=void 0,C=void 0;if(g.has(b))x=g.get(b),C=y.get(b);else{var w=void 0;S.has(b)?w=S.get(b).type:($g||console.info("chemComp not found",b),w=AK(b)),x=Kg(w,b),C=_4e(w,x),g.set(b,x),y.set(b,C)}p[d]=x,m[d]=C;var A=mf(C,"trace"),M=r.findAtomsOnResidue(d,A);if(M===-1){var D=mf(C,"coarseBackbone");M=r.findAtomsOnResidue(d,D)}f[d]=M;var k=mf(C,"directionFrom");h[d]=r.findAtomsOnResidue(d,k);var R=mf(C,"directionTo");v[d]=r.findAtomsOnResidue(d,R)}return{atom:{atomicNumber:c},residue:{traceElementIndex:f,directionFromElementIndex:h,directionToElementIndex:v,moleculeType:p,polymerType:m}}}function Ym(e,t,r){for(var n=new Float32Array(e),i=0;i<n.length;i++)n[i]=t+r*i;return n}var pn;(function(e){e.DefaultName="1_555",e.Default=t(e.DefaultName,ue.identity()),e.RotationTranslationEpsilon=.005;function t(v,p,m){var g=m||{},y=g.assembly,b=g.ncsId,S=g.hkl,x=g.spgrOp,C=S?_.clone(S):_();x=Ei(x,-1),b=b||-1;var w=r(m);if(ue.isIdentity(p))return{name:v,assembly:y,matrix:p,inverse:ue.identity(),isIdentity:!0,hkl:C,spgrOp:x,ncsId:b,suffix:w};if(!ue.isRotationAndTranslation(p,e.RotationTranslationEpsilon))throw new Error("Symmetry operator ("+v+") must be a composition of rotation and translation.");return{name:v,assembly:y,matrix:p,inverse:ue.invert(ue(),p),isIdentity:!1,hkl:C,spgrOp:x,ncsId:b,suffix:w}}e.create=t;function r(v){if(!v)return"";if(v.assembly)return"_"+v.assembly.operId;if(typeof v.spgrOp<"u"&&typeof v.hkl<"u"&&v.spgrOp!==-1){var p=v.hkl,m=p[0],g=p[1],y=p[2];return"-"+(v.spgrOp+1)+"_"+(5+m)+(5+g)+(5+y)}return v.ncsId!==-1?"_"+v.ncsId:""}function n(v,p){for(var m=ue.identity(),g=0;g<3;g++)for(var y=0;y<3;y++)ue.setValue(m,g,y,zn.getValue(v,g,y));return ue.setTranslation(m,p),ue.isRotationAndTranslation(m,e.RotationTranslationEpsilon)}e.checkIfRotationAndTranslation=n;function i(v,p,m,g){for(var y=ue.identity(),b=0;b<3;b++)for(var S=0;S<3;S++)ue.setValue(y,b,S,zn.getValue(p,b,S));return ue.setTranslation(y,m),t(v,y,{ncsId:g})}e.ofRotationAndOffset=i;var a=jn.identity(),o=jn(),s=jn(),u=_();function l(v,p,m){var g=p.inverse;if(p.isIdentity)return ue.copy(v,g);var y=1-m;ue.getRotation(o,g),jn.slerp(o,a,o,y);var b=jn.getAxisAngle(u,o);return ue.fromRotation(v,b,u),ue.setValue(v,0,3,y*ue.getValue(g,0,3)),ue.setValue(v,1,3,y*ue.getValue(g,1,3)),ue.setValue(v,2,3,y*ue.getValue(g,2,3)),v}e.lerpFromIdentity=l;function c(v,p,m,g){if(Math.abs(g)<=1e-5)return ue.copy(v,p);if(Math.abs(g-1)<=1e-5)return ue.copy(v,m);ue.getRotation(o,p),ue.getRotation(s,m),jn.slerp(s,o,s,g);var y=jn.getAxisAngle(u,s);return ue.fromRotation(v,y,u),ue.setValue(v,0,3,Bo(ue.getValue(p,0,3),ue.getValue(m,0,3),g)),ue.setValue(v,1,3,Bo(ue.getValue(p,1,3),ue.getValue(m,1,3),g)),ue.setValue(v,2,3,Bo(ue.getValue(p,2,3),ue.getValue(m,2,3),g)),v}e.slerp=c;function d(v,p){var m=ue.mul(ue(),p.matrix,v.matrix);return t(p.name,m,p)}e.compose=d;function f(v,p,m){var g=e.createCoordinateMapper(e.Default,p),y=v.isIdentity?g:e.createCoordinateMapper(v,p),b=D4e(v,p),S=b.x,x=b.y,C=b.z;return{operator:v,coordinates:p,invariantPosition:g,position:y,x:S,y:x,z:C,r:m||M4e}}e.createMapping=f;function h(v,p){return v.isIdentity?L4e(p):N4e(v,p)}e.createCoordinateMapper=h})(pn||(pn={}));function M4e(e){return 0}function D4e(e,t){return e.isIdentity?{x:yP(t.x),y:yP(t.y),z:yP(t.z)}:{x:R4e(e,t),y:k4e(e,t),z:O4e(e,t)}}function yP(e){return function(r){return e[r]}}function I3(e){return e[3]===0&&e[7]===0&&e[11]===0&&e[15]===1}function R4e(e,t){var r=e.matrix,n=t.x,i=t.y,a=t.z,o=r[0],s=r[4],u=r[8],l=r[12];return I3(r)?function(d){return o*n[d]+s*i[d]+u*a[d]+l}:function(d){var f=n[d],h=i[d],v=a[d],p=r[3]*f+r[7]*h+r[11]*v+r[15]||1;return(o*f+s*h+u*v+l)/p}}function k4e(e,t){var r=e.matrix,n=t.x,i=t.y,a=t.z,o=r[1],s=r[5],u=r[9],l=r[13];return I3(r)?function(d){return o*n[d]+s*i[d]+u*a[d]+l}:function(d){var f=n[d],h=i[d],v=a[d],p=r[3]*f+r[7]*h+r[11]*v+r[15]||1;return(o*f+s*h+u*v+l)/p}}function O4e(e,t){var r=e.matrix,n=t.x,i=t.y,a=t.z,o=r[2],s=r[6],u=r[10],l=r[14];return I3(r)?function(d){return o*n[d]+s*i[d]+u*a[d]+l}:function(d){var f=n[d],h=i[d],v=a[d],p=r[3]*f+r[7]*h+r[11]*v+r[15]||1;return(o*f+s*h+u*v+l)/p}}function L4e(e){var t=e.x,r=e.y,n=e.z;return function(a,o){return o[0]=t[a],o[1]=r[a],o[2]=n[a],o}}function N4e(e,t){var r=e.matrix,n=t.x,i=t.y,a=t.z;return I3(r)?function(s,u){var l=n[s],c=i[s],d=a[s];return u[0]=r[0]*l+r[4]*c+r[8]*d+r[12],u[1]=r[1]*l+r[5]*c+r[9]*d+r[13],u[2]=r[2]*l+r[6]*c+r[10]*d+r[14],u}:function(s,u){return u[0]=n[s],u[1]=i[s],u[2]=a[s],_.transformMat4(u,u,r),u}}var bP=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[-1,0,0,0],[0,-1,0,0],[0,0,-1,0],[0,1,0,.5],[1,0,0,.5],[-1,0,0,.5],[0,0,1,.5],[0,-1,0,.5],[0,0,-1,.5],[1,0,0,.25],[0,-1,0,.25],[0,0,1,.25],[-1,0,0,.25],[0,1,0,.25],[0,-1,0,.75],[0,0,1,.75],[0,1,0,.75],[1,0,0,.75],[-1,0,0,.75],[0,0,-1,.25],[0,0,-1,.75],[1,-1,0,0],[-1,1,0,0],[0,0,1,1/3],[0,0,1,2/3],[1,0,0,2/3],[0,1,0,1/3],[0,-1,0,2/3],[1,-1,0,1/3],[-1,1,0,2/3],[-1,0,0,1/3],[1,0,0,1/3],[0,1,0,2/3],[0,-1,0,1/3],[1,-1,0,2/3],[-1,1,0,1/3],[-1,0,0,2/3],[0,0,-1,1/3],[0,0,-1,2/3],[0,0,1,5/6],[0,0,1,1/6],[0,0,-1,5/6],[0,0,-1,1/6]],F4e=[[0,1,2],[3,4,5],[3,1,5],[3,6,5],[7,6,2],[8,6,5],[0,4,2],[0,4,9],[7,10,2],[7,10,9],[0,10,2],[8,10,5],[3,1,11],[3,6,11],[0,10,9],[8,6,11],[3,4,2],[0,4,5],[3,4,9],[7,10,5],[8,4,9],[8,10,9],[8,10,2],[0,6,9],[3,10,9],[0,10,11],[7,1,9],[8,1,11],[7,4,11],[7,6,9],[7,10,11],[3,10,2],[8,1,5],[0,4,11],[3,1,2],[3,1,9],[7,4,2],[8,1,2],[8,1,9],[3,6,9],[7,4,9],[8,6,2],[8,6,9],[3,6,2],[12,13,14],[15,16,14],[12,17,18],[15,19,18],[20,13,18],[21,16,18],[20,17,14],[21,19,14],[0,1,5],[8,10,11],[7,6,11],[7,6,5],[8,4,2],[7,4,5],[7,1,5],[7,1,11],[0,10,5],[0,1,11],[0,6,11],[0,6,5],[3,10,11],[8,4,11],[15,13,22],[12,16,22],[15,17,23],[12,19,23],[21,13,23],[20,16,23],[21,17,22],[20,19,22],[4,0,2],[1,3,2],[4,0,14],[1,3,18],[4,0,9],[1,3,9],[4,0,18],[1,3,14],[10,7,9],[6,8,9],[4,7,14],[6,3,18],[10,0,18],[1,8,14],[1,3,5],[4,0,5],[6,8,11],[10,7,11],[1,3,11],[4,0,11],[10,7,2],[6,8,2],[3,10,22],[7,1,23],[8,4,23],[0,6,22],[1,0,5],[4,3,5],[1,0,23],[4,3,22],[10,7,14],[6,8,18],[8,6,22],[7,10,23],[4,3,11],[1,0,11],[1,0,22],[4,3,23],[10,7,18],[6,8,14],[8,6,23],[7,10,22],[6,7,11],[10,8,11],[8,1,23],[0,10,22],[3,6,22],[7,4,23],[4,3,2],[1,0,2],[10,8,2],[6,7,2],[4,3,9],[1,0,9],[10,8,9],[6,7,9],[4,8,14],[6,0,18],[10,3,18],[1,7,14],[4,8,18],[6,0,14],[10,3,14],[1,7,18],[6,7,5],[10,8,5],[6,8,5],[10,7,5],[8,1,22],[0,10,23],[3,6,23],[7,4,22],[4,24,2],[25,3,2],[4,24,26],[25,3,27],[4,24,27],[25,3,26],[28,29,26],[30,31,26],[32,33,26],[34,35,27],[36,37,27],[38,39,27],[2,0,1],[1,2,0],[1,25,5],[24,0,5],[39,36,40],[35,38,40],[37,34,40],[33,30,41],[29,32,41],[31,28,41],[5,3,4],[4,5,3],[25,1,5],[0,24,5],[24,4,5],[3,25,5],[4,3,41],[25,1,40],[24,4,41],[3,25,40],[4,3,40],[25,1,41],[24,4,40],[3,25,41],[35,34,40],[37,36,40],[39,38,40],[29,28,41],[31,30,41],[33,32,41],[3,5,4],[5,4,3],[25,1,2],[0,24,2],[24,4,2],[3,25,2],[25,1,9],[0,24,9],[24,4,9],[3,25,9],[30,33,26],[32,29,26],[28,31,26],[36,39,27],[38,35,27],[34,37,27],[0,2,1],[2,1,0],[30,33,42],[32,29,42],[28,31,42],[36,39,43],[38,35,43],[34,37,43],[7,9,6],[9,6,7],[25,1,11],[0,24,11],[24,4,11],[3,25,11],[35,34,44],[37,36,44],[39,38,44],[29,28,45],[31,30,45],[33,32,45],[8,11,10],[11,10,8],[1,25,2],[24,0,2],[1,25,42],[24,0,43],[1,25,43],[24,0,42],[1,25,27],[24,0,26],[1,25,26],[24,0,27],[1,25,9],[24,0,9],[4,24,5],[25,3,5],[4,24,11],[25,3,11],[1,0,40],[4,3,44],[0,24,45],[1,0,41],[4,3,45],[0,24,44],[0,24,40],[0,24,41],[2,3,4],[5,3,1],[5,0,4],[4,2,3],[1,5,3],[4,5,0],[2,7,6],[2,8,10],[5,8,6],[5,7,10],[1,9,7],[4,9,8],[1,11,8],[4,11,7],[9,0,6],[9,3,10],[11,3,6],[11,0,10],[6,2,7],[10,2,8],[6,5,8],[10,5,7],[9,7,1],[9,8,4],[11,8,1],[11,7,4],[6,9,0],[10,9,3],[6,11,3],[10,11,0],[9,7,6],[9,8,10],[11,8,6],[11,7,10],[6,9,7],[10,9,8],[6,11,8],[10,11,7],[2,3,10],[5,8,1],[11,0,4],[10,2,3],[1,5,8],[4,11,0],[5,0,1],[2,0,4],[2,3,1],[1,5,0],[4,2,0],[1,2,3],[11,8,10],[11,7,6],[9,7,10],[9,8,6],[10,11,8],[6,11,7],[10,9,7],[6,9,8],[5,8,10],[5,7,6],[2,7,10],[2,8,6],[4,11,8],[1,11,7],[4,9,7],[1,9,8],[11,3,10],[11,0,6],[9,0,10],[9,3,6],[10,5,8],[6,5,7],[10,2,7],[6,2,8],[11,8,4],[11,7,1],[9,7,4],[9,8,1],[10,11,3],[6,11,0],[10,9,0],[6,9,3],[22,15,13],[22,12,16],[14,12,13],[14,15,16],[13,22,15],[16,22,12],[13,14,12],[16,14,15],[22,21,17],[22,20,19],[14,20,17],[14,21,19],[13,23,21],[16,23,20],[13,18,20],[16,18,21],[23,15,17],[23,12,19],[18,12,17],[18,15,19],[17,22,21],[19,22,20],[17,14,20],[19,14,21],[23,21,13],[23,20,16],[18,20,13],[18,21,16],[17,23,15],[19,23,12],[17,18,12],[19,18,15],[5,0,6],[2,7,4],[9,3,1],[6,5,0],[4,2,7],[1,9,3],[0,2,4],[3,2,1],[0,5,1],[2,1,3],[2,4,0],[5,1,0],[7,9,10],[8,9,6],[7,11,6],[9,6,8],[9,10,7],[11,6,7],[1,7,11],[4,8,11],[1,8,9],[4,7,9],[0,9,10],[3,9,6],[3,11,10],[0,11,6],[2,6,8],[2,10,7],[5,6,7],[5,10,8],[6,0,11],[10,3,11],[6,3,9],[10,0,9],[7,2,10],[8,2,6],[8,5,10],[7,5,6],[9,1,8],[9,4,7],[11,1,7],[11,4,8],[7,9,4],[8,9,1],[8,11,4],[7,11,1],[9,6,3],[9,10,0],[11,6,0],[11,10,3],[19,12,23],[13,15,22],[16,21,18],[17,20,14],[20,14,17],[21,18,16],[15,22,13],[12,23,19],[18,16,21],[14,17,20],[23,19,12],[22,13,15],[19,20,22],[13,21,23],[16,15,14],[17,12,18],[20,18,13],[21,14,19],[15,23,17],[12,22,16],[18,19,15],[14,13,12],[23,16,20],[22,17,21],[16,12,22],[17,15,23],[19,21,14],[13,20,18],[12,14,13],[15,18,19],[21,22,17],[20,23,16],[14,16,15],[18,17,12],[22,19,20],[23,13,21],[16,20,23],[17,21,22],[19,15,18],[13,12,14],[12,18,17],[15,14,16],[21,23,13],[20,22,19],[14,19,21],[18,13,20],[22,16,12],[23,17,15],[19,12,22],[17,21,23],[16,15,18],[13,20,14],[20,14,13],[15,18,16],[21,23,17],[12,22,19],[18,16,15],[14,13,20],[22,19,12],[23,17,21],[3,2,4],[3,5,1],[0,5,4],[2,4,3],[5,1,3],[5,4,0],[1,7,9],[4,8,9],[1,8,11],[4,7,11],[0,9,6],[3,9,10],[3,11,6],[0,11,10],[2,6,7],[2,10,8],[5,6,8],[5,10,7],[6,0,9],[10,3,9],[6,3,11],[10,0,11],[7,2,6],[8,2,10],[8,5,6],[7,5,10],[9,1,7],[9,4,8],[11,1,8],[11,4,7],[7,9,1],[8,9,4],[8,11,1],[7,11,4],[9,6,0],[9,10,3],[11,6,3],[11,10,0],[8,9,10],[8,11,6],[7,11,10],[9,10,8],[11,6,8],[11,10,7],[6,0,2],[10,3,2],[6,3,5],[10,0,5],[7,2,1],[8,2,4],[8,5,1],[7,5,4],[9,1,0],[9,4,3],[11,1,3],[11,4,0],[1,7,2],[4,8,2],[1,8,5],[4,7,5],[0,9,1],[3,9,4],[3,11,1],[0,11,4],[2,6,0],[2,10,3],[5,6,3],[5,10,0],[0,2,6],[3,2,10],[3,5,6],[0,5,10],[2,1,7],[2,4,8],[5,1,8],[5,4,7],[16,12,14],[13,21,18],[19,15,23],[17,20,22],[12,14,16],[21,18,13],[15,23,19],[20,22,17],[14,16,12],[18,13,21],[23,19,15],[22,17,20],[19,20,18],[17,15,14],[16,21,22],[13,12,23],[20,18,19],[15,14,17],[21,22,16],[12,23,13],[18,19,20],[14,17,15],[22,16,21],[23,13,12],[6,0,5],[10,3,5],[6,3,2],[10,0,2],[7,2,4],[8,2,1],[8,5,4],[7,5,1],[9,1,3],[9,4,0],[11,1,0],[11,4,3],[1,7,5],[4,8,5],[1,8,2],[4,7,2],[0,9,4],[3,9,1],[3,11,4],[0,11,1],[2,6,3],[2,10,0],[5,6,0],[5,10,3],[0,2,10],[3,2,6],[3,5,10],[0,5,6],[2,1,8],[2,4,7],[5,1,7],[5,4,8],[21,17,23],[20,16,22],[12,13,18],[15,19,14],[23,21,17],[22,20,16],[18,12,13],[14,15,19],[17,23,21],[16,22,20],[13,18,12],[19,14,15],[21,13,22],[20,19,23],[12,17,14],[15,16,18],[23,15,13],[22,12,19],[18,20,17],[14,21,16],[17,22,15],[16,23,12],[13,14,20],[19,18,21],[15,17,22],[12,16,23],[20,13,14],[21,19,18],[22,21,13],[23,20,19],[14,12,17],[18,15,16],[13,23,15],[19,22,12],[17,18,20],[16,14,21],[15,13,23],[12,19,22],[20,17,18],[21,16,14],[22,15,17],[23,12,16],[14,20,13],[18,21,19],[13,22,21],[19,23,20],[17,14,12],[16,18,15],[6,5,3],[4,9,3],[9,3,4],[5,7,4],[4,5,7],[5,3,6]],B4e=[[0],[0,1],[0,2],[0,3],[0,2,4,5],[0,6],[0,7],[0,6,4,8],[0,7,4,9],[0,6,2,1],[0,3,1,10],[0,6,2,1,4,8,5,11],[0,12,1,7],[0,1,13,14],[0,12,1,7,4,15,11,9],[0,16,2,17],[0,18,12,17],[0,16,5,19],[0,20,13,19],[0,18,12,17,4,21,15,19],[0,16,2,17,4,22,5,19],[0,16,2,17,23,24,13,25,26,20,27,28,4,22,5,19],[0,16,17,2,29,21,30,15],[0,20,13,19,29,31,32,33],[0,16,6,34],[0,18,7,34],[0,16,7,35],[0,16,36,37],[0,18,36,38],[0,16,14,39],[0,20,40,34],[0,16,8,41],[0,18,8,42],[0,16,9,42],[0,16,6,34,4,22,8,41],[0,18,7,34,4,21,9,41],[0,16,7,35,4,22,9,42],[0,16,6,34,23,24,14,39],[0,16,10,43,23,24,7,35],[0,16,36,37,23,24,9,42],[0,16,8,41,23,24,40,38],[0,16,6,34,23,24,14,39,26,20,40,38,4,22,8,41],[0,16,44,45,23,24,46,47,26,20,48,49,4,22,50,51],[0,16,6,34,29,21,9,42],[0,16,8,41,29,21,7,35],[0,16,36,37,29,21,14,39],[0,16,2,17,1,52,6,34],[0,16,2,17,53,54,9,42],[0,16,12,33,1,52,7,35],[0,16,2,17,11,55,8,41],[0,56,2,57,1,58,6,37],[0,56,15,25,1,58,9,39],[0,20,27,17,1,59,40,34],[0,56,12,28,1,58,7,38],[0,16,5,19,1,52,8,41],[0,22,13,28,1,55,14,38],[0,18,13,60,1,61,14,43],[0,16,15,30,1,52,9,42],[0,16,5,19,11,55,6,34],[0,21,12,19,1,54,7,41],[0,20,13,19,1,59,14,41],[0,20,3,30,1,59,10,42],[0,18,12,17,1,61,7,34,4,21,15,19,11,54,9,41],[0,24,13,17,1,62,14,34,4,20,27,19,11,59,40,41],[0,16,2,17,1,52,6,34,4,22,5,19,11,55,8,41],[0,16,12,33,1,52,7,35,4,22,15,30,11,55,9,42],[0,31,3,17,1,63,10,34,4,56,32,19,11,58,36,41],[0,22,2,19,64,59,14,38,4,16,5,17,65,62,40,39],[0,16,2,17,1,52,6,34,23,24,13,25,64,62,14,39,26,20,27,28,65,59,40,38,4,22,5,19,11,55,8,41],[0,16,2,17,66,67,44,45,23,24,13,25,68,69,46,47,26,20,27,28,70,71,48,49,4,22,5,19,72,73,50,51],[0,16,2,17,1,52,6,34,29,21,15,30,53,54,9,42],[0,16,5,19,1,52,8,41,29,21,12,33,53,54,7,35],[0,20,13,19,1,59,14,41,29,31,32,33,53,63,36,35],[0,31,3,17,1,63,10,34,29,20,27,30,53,59,40,42],[0,16,74,75],[0,18,76,77],[0,16,78,79],[0,18,80,81],[0,16,74,75,29,21,82,83],[0,21,84,85,29,16,86,87],[0,16,88,89],[0,16,88,89,29,21,90,91],[0,16,74,75,1,52,88,89],[0,16,78,79,1,52,92,93],[0,16,94,95,11,55,88,89],[0,16,82,83,53,54,88,89],[0,16,74,75,1,52,88,89,29,21,82,83,53,54,90,91],[0,21,84,85,96,97,88,91,29,16,86,87,98,99,90,89],[0,16,74,75,2,17,100,101],[0,16,94,95,5,19,100,101],[0,18,76,77,2,33,102,103],[0,18,104,105,106,107,100,108],[0,16,78,79,2,17,109,108],[0,16,82,83,15,30,100,101],[0,18,80,81,2,33,110,111],[0,18,112,113,114,115,100,108],[0,16,74,75,2,17,100,101,29,21,82,83,15,30,116,117],[0,21,84,85,118,119,116,101,29,16,86,87,120,121,100,117],[0,16,74,75,6,34,122,123],[0,16,74,75,8,41,124,125],[0,16,78,79,7,35,122,123],[0,16,82,83,9,42,122,123],[0,16,74,75,7,35,126,127],[0,16,74,75,9,42,128,129],[0,16,78,79,6,34,126,127],[0,16,78,79,8,41,128,129],[0,16,74,75,6,34,122,123,29,21,82,83,9,42,128,129],[0,16,74,75,7,35,126,127,29,21,82,83,8,41,124,125],[0,21,84,85,6,42,130,131,29,16,86,87,9,34,132,133],[0,21,84,85,7,41,134,135,29,16,86,87,8,35,136,137],[0,16,89,88,2,17,122,123],[0,16,89,88,12,33,126,127],[0,16,89,88,5,19,124,125],[0,16,89,88,15,30,128,129],[0,16,88,89,6,34,100,101],[0,16,89,88,7,35,109,108],[0,16,89,88,8,41,138,139],[0,16,89,88,9,42,116,117],[0,16,89,88,6,34,100,101,29,21,91,90,9,42,116,117],[0,16,89,88,7,35,109,108,29,21,91,90,8,41,138,139],[0,16,89,88,2,17,122,123,29,21,91,90,15,30,128,129],[0,16,89,88,118,121,132,131,29,21,91,90,120,119,130,133],[0,16,74,75,2,17,100,101,1,52,88,89,6,34,122,123],[0,16,74,75,12,33,109,108,1,52,88,89,7,35,126,127],[0,16,74,75,2,17,100,101,11,55,140,141,8,41,124,125],[0,16,74,75,2,17,100,101,53,54,90,91,9,42,128,129],[0,16,74,75,5,19,138,139,1,52,88,89,8,41,124,125],[0,16,74,75,15,30,116,117,1,52,88,89,9,42,128,129],[0,16,94,95,5,19,100,101,11,55,88,89,6,34,124,125],[0,16,94,95,15,30,109,108,11,55,88,89,7,35,128,129],[0,16,78,79,2,17,109,108,1,52,92,93,6,34,126,127],[0,16,78,79,12,33,100,101,1,52,92,93,7,35,122,123],[0,16,82,83,12,33,138,139,53,54,88,89,8,41,126,127],[0,16,82,83,2,17,116,117,53,54,88,89,9,42,122,123],[0,16,78,79,5,19,116,117,1,52,92,93,8,41,128,129],[0,16,82,83,15,30,100,101,1,52,90,91,9,42,122,123],[0,16,82,83,15,30,100,101,53,54,88,89,6,34,128,129],[0,16,82,83,5,19,109,108,53,54,88,89,7,35,124,125],[0,16,74,75,2,17,100,101,1,52,88,89,6,34,122,123,29,21,82,83,15,30,116,117,53,54,90,91,9,42,128,129],[0,16,74,75,12,33,109,108,1,52,88,89,7,35,126,127,29,21,82,83,5,19,138,139,53,54,90,91,8,41,124,125],[0,21,84,85,118,119,116,101,96,97,88,91,9,34,132,133,29,16,86,87,120,121,100,117,98,99,90,89,6,42,130,131],[0,21,84,85,142,143,138,108,96,97,88,91,8,35,136,137,29,16,86,87,144,145,109,139,98,99,90,89,7,41,134,135],[0,146,147],[0,148,149],[0,150,151],[0,146,147,152,153,154,155,156,157],[0,158,159],[0,146,147,1,160,161],[0,146,147,1,160,161,152,153,154,162,163,164,155,156,157,165,166,167],[0,158,159,1,168,169],[0,146,147,101,170,171],[0,146,147,100,172,173],[0,148,149,174,175,171],[0,148,149,100,176,177],[0,150,151,178,179,171],[0,150,151,100,180,181],[0,146,147,100,172,173,152,153,154,182,183,184,155,156,157,185,186,187],[0,158,159,101,188,189],[0,146,147,122,190,191],[0,146,147,123,192,193],[0,146,147,126,194,195],[0,146,147,127,196,197],[0,146,147,122,190,191,152,153,154,198,199,200,155,156,157,201,202,203],[0,158,159,123,204,205],[0,146,147,126,194,195,152,153,154,206,207,208,155,156,157,209,210,211],[0,158,159,129,212,213],[0,146,147,101,170,171,1,160,161,123,192,193],[0,146,147,108,214,215,1,160,161,127,196,197],[0,146,147,100,172,173,1,160,161,122,190,191],[0,146,147,109,216,217,1,160,161,126,194,195],[0,146,147,100,172,173,1,160,161,122,190,191,152,153,154,182,183,184,162,163,164,198,199,200,155,156,157,185,186,187,165,166,167,201,202,203],[0,158,159,101,188,189,1,168,169,123,204,205],[0,146,147,109,216,217,1,160,161,126,194,195,152,153,154,218,219,220,162,163,164,206,207,208,155,156,157,221,222,223,165,166,167,209,210,211],[0,158,159,117,224,225,1,168,169,129,212,213],[0,146,147,16,226,227],[0,148,149,18,228,229],[0,150,151,18,230,231],[0,150,151,16,232,233],[0,148,149,16,234,235],[0,146,147,18,236,237],[0,146,147,52,238,239],[0,146,147,16,226,227,1,160,161,52,238,239],[0,146,147,18,236,237,1,160,161,61,240,241],[0,146,147,16,226,227,100,172,173,101,170,171],[0,148,149,18,228,229,242,172,181,243,214,244],[0,150,151,18,230,231,245,172,177,246,214,247],[0,150,151,16,232,233,245,172,177,174,170,248],[0,148,149,16,234,235,242,172,181,178,170,249],[0,146,147,18,236,237,100,172,173,108,214,215],[0,146,147,16,226,227,122,190,191,123,192,193],[0,146,147,16,226,227,126,194,195,127,196,197],[0,146,147,18,236,237,126,194,195,123,192,193],[0,146,147,18,236,237,122,190,191,127,196,197],[0,146,147,52,238,239,122,190,191,101,170,171],[0,146,147,61,240,241,126,194,195,101,170,171],[0,146,147,52,238,239,100,172,173,123,192,193],[0,146,147,61,240,241,100,172,173,127,196,197],[0,146,147,16,226,227,100,172,173,101,170,171,1,160,161,52,239,238,122,190,191,123,192,193],[0,146,147,16,226,227,109,216,217,108,214,215,1,160,161,52,239,238,126,194,195,127,196,197],[0,146,147,18,236,237,109,216,217,101,170,171,1,160,161,61,241,240,126,194,195,123,192,193],[0,146,147,18,236,237,100,172,173,108,214,215,1,160,161,61,241,240,122,190,191,127,196,197],[0,16,2,17,158,250,251,252,159,253,254,255],[0,16,2,17,158,250,251,252,159,253,254,255,23,24,13,25,256,257,258,259,260,261,262,263,26,20,27,28,264,265,266,267,268,269,270,271,4,22,5,19,272,273,274,275,276,277,278,279],[0,16,2,17,158,250,251,252,159,253,254,255,29,21,15,30,280,281,282,283,284,285,286,287],[0,20,13,19,158,273,266,259,159,261,278,271],[0,20,13,19,158,273,266,259,159,261,278,271,29,31,32,33,280,288,289,290,284,291,292,293],[0,16,2,17,158,250,251,252,159,253,254,255,1,52,6,34,168,294,295,296,169,297,298,299],[0,16,2,17,158,250,251,252,159,253,254,255,53,54,9,42,300,301,302,303,304,305,306,307],[0,16,2,17,158,250,251,252,159,253,254,255,1,52,6,34,168,294,295,296,169,297,298,299,23,24,13,25,256,257,258,259,260,261,262,263,64,62,14,39,308,309,310,311,312,313,314,315,26,20,27,28,264,265,266,267,268,269,270,271,65,59,40,38,316,317,318,319,320,321,322,323,4,22,5,19,272,273,274,275,276,277,278,279,11,55,8,41,324,325,326,327,328,329,330,331],[0,16,2,17,158,250,251,252,159,253,254,255,66,67,44,45,332,333,334,335,336,337,338,339,23,24,13,25,256,257,258,259,260,261,262,263,68,69,46,47,340,341,342,343,344,345,346,347,26,20,27,28,264,265,266,267,268,269,270,271,70,71,48,49,348,349,350,351,352,353,354,355,4,22,5,19,272,273,274,275,276,277,278,279,72,73,50,51,356,357,358,359,360,361,362,363],[0,16,2,17,158,250,251,252,159,253,254,255,1,52,6,34,168,294,295,296,169,297,298,299,29,21,15,30,280,281,282,283,284,285,286,287,53,54,9,42,300,301,302,303,304,305,306,307],[0,20,13,19,158,273,266,259,159,261,278,271,1,59,14,41,168,325,318,311,169,313,330,323],[0,20,13,19,158,273,266,259,159,261,278,271,1,59,14,41,168,325,318,311,169,313,330,323,29,31,32,33,280,288,289,290,284,291,292,293,53,63,36,35,300,364,365,366,304,367,368,369],[0,16,2,17,158,250,251,252,159,253,254,255,100,101,75,74,370,371,188,372,373,374,375,189],[0,16,2,17,158,250,251,252,159,253,254,255,116,117,83,82,376,377,224,378,379,380,381,225],[0,16,2,17,158,250,251,252,159,253,254,255,100,101,75,74,370,371,188,372,373,374,375,189,23,24,13,25,256,257,258,259,260,261,262,263,382,383,384,385,386,387,388,389,390,391,392,393,26,20,27,28,264,265,266,267,268,269,270,271,394,395,396,397,398,399,400,401,402,403,404,405,4,22,5,19,272,273,274,275,276,277,278,279,138,139,95,94,406,407,408,409,410,411,412,413],[0,24,5,28,158,265,258,275,159,277,270,263,414,415,416,417,418,419,420,421,422,423,424,425,23,16,27,19,256,273,251,267,260,269,278,255,426,427,428,429,430,431,432,433,434,435,436,437,26,22,13,17,264,250,274,259,268,261,254,279,438,439,440,441,442,443,444,445,446,447,448,449,4,20,2,25,272,257,266,252,276,253,262,271,450,451,452,453,454,455,456,457,458,459,460,461],[0,16,2,17,158,250,251,252,159,253,254,255,100,101,75,74,370,371,188,372,373,374,375,189,29,21,15,30,280,281,282,283,284,285,286,287,116,117,83,82,376,377,224,378,379,380,381,225],[0,20,13,19,158,273,266,259,159,261,278,271,450,415,440,429,454,431,420,445,458,447,436,425],[0,20,13,19,158,273,266,259,159,261,278,271,462,463,464,465,466,467,468,469,470,471,472,473],[0,20,13,19,158,273,266,259,159,261,278,271,462,463,464,465,466,467,468,469,470,471,472,473,29,31,32,33,280,288,289,290,284,291,292,293,450,415,440,429,454,431,420,445,458,447,436,425],[0,16,2,17,158,250,251,252,159,253,254,255,123,122,88,89,204,474,475,476,205,477,478,479],[0,16,2,17,158,250,251,252,159,253,254,255,123,122,88,89,204,474,475,476,205,477,478,479,23,24,13,25,256,257,258,259,260,261,262,263,480,481,482,483,484,485,486,487,488,489,490,491,26,20,27,28,264,265,266,267,268,269,270,271,492,493,494,495,496,497,498,499,500,501,502,503,4,22,5,19,272,273,274,275,276,277,278,279,125,124,140,141,504,505,506,507,508,509,510,511],[0,16,2,17,158,250,251,252,159,253,254,255,123,122,88,89,204,474,475,476,205,477,478,479,29,21,15,30,280,281,282,283,284,285,286,287,129,128,90,91,212,512,513,514,213,515,516,517],[0,16,2,17,158,250,251,252,159,253,254,255,129,128,90,91,212,512,513,514,213,515,516,517],[0,16,2,17,158,250,251,252,159,253,254,255,129,128,90,91,212,512,513,514,213,515,516,517,23,24,13,25,256,257,258,259,260,261,262,263,518,519,520,521,522,523,524,525,526,527,528,529,26,20,27,28,264,265,266,267,268,269,270,271,530,531,532,533,534,535,536,537,538,539,540,541,4,22,5,19,272,273,274,275,276,277,278,279,127,126,92,93,542,543,544,545,546,547,548,549],[0,20,13,19,158,273,266,259,159,261,278,271,550,551,552,553,554,555,556,557,558,559,560,561,29,31,32,33,280,288,289,290,284,291,292,293,562,563,564,565,566,567,568,569,570,571,572,573],[0,16,2,17,158,250,251,252,159,253,254,255,100,101,75,74,370,371,188,372,373,374,375,189,1,52,6,34,168,294,295,296,169,297,298,299,122,123,89,88,475,476,204,474,479,478,477,205],[0,16,2,17,158,250,251,252,159,253,254,255,100,101,75,74,370,371,188,372,373,374,375,189,53,54,9,42,300,301,302,303,304,305,306,307,128,129,91,90,513,514,212,512,517,516,515,213],[0,16,2,17,158,250,251,252,159,253,254,255,116,117,83,82,376,377,224,378,379,380,381,225,1,52,6,34,168,294,295,296,169,297,298,299,128,129,91,90,513,514,212,512,517,516,515,213],[0,16,2,17,158,250,251,252,159,253,254,255,116,117,83,82,376,377,224,378,379,380,381,225,53,54,9,42,300,301,302,303,304,305,306,307,122,123,89,88,475,476,204,474,479,478,477,205],[0,16,2,17,158,250,251,252,159,253,254,255,100,101,75,74,370,371,188,372,373,374,375,189,1,52,6,34,168,294,295,296,169,297,298,299,122,123,89,88,475,476,204,474,479,478,477,205,23,24,13,25,256,257,258,259,260,261,262,263,382,383,384,385,386,387,388,389,390,391,392,393,64,62,14,39,308,309,310,311,312,313,314,315,481,480,483,482,486,487,484,485,491,490,489,488,26,20,27,28,264,265,266,267,268,269,270,271,394,395,396,397,398,399,400,401,402,403,404,405,65,59,40,38,316,317,318,319,320,321,322,323,493,492,495,494,498,499,496,497,503,502,501,500,4,22,5,19,272,273,274,275,276,277,278,279,138,139,95,94,406,407,408,409,410,411,412,413,11,55,8,41,324,325,326,327,328,329,330,331,124,125,141,140,506,507,504,505,511,510,509,508],[0,16,2,17,158,250,251,252,159,253,254,255,116,117,83,82,376,377,224,378,379,380,381,225,1,52,6,34,168,294,295,296,169,297,298,299,128,129,91,90,513,514,212,512,517,516,515,213,23,24,13,25,256,257,258,259,260,261,262,263,574,575,576,577,578,579,580,581,582,583,584,585,64,62,14,39,308,309,310,311,312,313,314,315,519,518,521,520,524,525,522,523,529,528,527,526,26,20,27,28,264,265,266,267,268,269,270,271,586,587,588,589,590,591,592,593,594,595,596,597,65,59,40,38,316,317,318,319,320,321,322,323,531,530,533,532,536,537,534,535,541,540,539,538,4,22,5,19,272,273,274,275,276,277,278,279,109,108,79,78,598,599,600,601,602,603,604,605,11,55,8,41,324,325,326,327,328,329,330,331,126,127,93,92,544,545,542,543,549,548,547,546],[0,24,5,28,158,265,258,275,159,277,270,263,414,415,416,417,418,419,420,421,422,423,424,425,66,69,50,49,332,349,342,359,336,361,354,347,493,123,483,140,498,507,204,485,503,490,509,205,23,16,27,19,256,273,251,267,260,269,278,255,426,427,428,429,430,431,432,433,434,435,436,437,68,67,48,51,340,357,334,351,344,353,362,339,124,480,89,494,506,499,484,474,511,478,501,488,26,22,13,17,264,250,274,259,268,261,254,279,438,439,440,441,442,443,444,445,446,447,448,449,70,73,46,45,348,333,358,343,352,345,338,363,122,492,141,482,475,487,496,505,479,510,489,500,4,20,2,25,272,257,266,252,276,253,262,271,450,451,452,453,454,455,456,457,458,459,460,461,72,71,44,47,356,341,350,335,360,337,346,355,481,125,495,88,486,476,504,497,491,502,477,508],[0,24,5,28,158,265,258,275,159,277,270,263,414,415,416,417,418,419,420,421,422,423,424,425,606,607,608,609,610,611,612,613,614,615,616,617,531,129,521,92,536,545,212,523,541,528,547,213,23,16,27,19,256,273,251,267,260,269,278,255,426,427,428,429,430,431,432,433,434,435,436,437,618,619,620,621,622,623,624,625,626,627,628,629,126,518,91,532,544,537,522,512,549,516,539,526,26,22,13,17,264,250,274,259,268,261,254,279,438,439,440,441,442,443,444,445,446,447,448,449,630,631,632,633,634,635,636,637,638,639,640,641,128,530,93,520,513,525,534,543,517,548,527,538,4,20,2,25,272,257,266,252,276,253,262,271,450,451,452,453,454,455,456,457,458,459,460,461,642,643,644,645,646,647,648,649,650,651,652,653,519,127,533,90,524,514,542,535,529,540,515,546],[0,16,2,17,158,250,251,252,159,253,254,255,100,101,75,74,370,371,188,372,373,374,375,189,1,52,6,34,168,294,295,296,169,297,298,299,122,123,89,88,475,476,204,474,479,478,477,205,29,21,15,30,280,281,282,283,284,285,286,287,116,117,83,82,376,377,224,378,379,380,381,225,53,54,9,42,300,301,302,303,304,305,306,307,128,129,91,90,513,514,212,512,517,516,515,213],[0,20,13,19,158,273,266,259,159,261,278,271,462,463,464,465,466,467,468,469,470,471,472,473,1,59,14,41,168,325,318,311,169,313,330,323,551,550,553,552,556,557,554,555,561,560,559,558,29,31,32,33,280,288,289,290,284,291,292,293,450,415,440,429,454,431,420,445,458,447,436,425,53,63,36,35,300,364,365,366,304,367,368,369,563,562,565,564,568,569,566,567,573,572,571,570],[0,16],[0,18],[0,16,26,20],[0,2,23,13],[0,3,4,32],[0,2,29,15],[0,3,29,27],[0,52],[0,63],[0,52,26,59],[0,63,26,54],[0,52,16,1],[0,18,1,61],[0,52,16,1,26,59,20,65],[0,31,1,63],[0,1,24,62],[0,15,1,9],[0,5,1,8],[0,31,1,63,26,21,65,54],[0,2,57,56],[0,60,3,16],[0,22,57,3],[0,2,28,20],[0,17,13,24],[0,20,19,13,4,24,17,27],[0,22,57,3,4,16,60,32],[0,22,57,3,23,20,30,12,26,24,33,15,4,16,60,32],[0,22,57,3,29,18,27,25],[0,22,3,57,1,55,10,37],[0,22,385,396,3,57,109,117],[0,22,57,3,159,279,654,655,158,274,656,657,29,18,25,27,284,658,262,269,280,659,257,267]],W1={"P 1":0,"P -1":1,"P 1 2 1":2,"P 1 21 1":3,"C 1 2 1":4,"P 1 m 1":5,"P 1 c 1":6,"C 1 m 1":7,"C 1 c 1":8,"P 1 2/m 1":9,"P 1 21/m 1":10,"C 1 2/m 1":11,"P 1 2/c 1":12,"P 1 21/c 1":13,"C 1 2/c 1":14,"P 2 2 2":15,"P 2 2 21":16,"P 21 21 2":17,"P 21 21 21":18,"C 2 2 21":19,"C 2 2 2":20,"F 2 2 2":21,"I 2 2 2":22,"I 21 21 21":23,"P m m 2":24,"P m c 21":25,"P c c 2":26,"P m a 2":27,"P c a 21":28,"P n c 2":29,"P m n 21":30,"P b a 2":31,"P n a 21":32,"P n n 2":33,"C m m 2":34,"C m c 21":35,"C c c 2":36,"A m m 2":37,"A b m 2":38,"A m a 2":39,"A b a 2":40,"F m m 2":41,"F d d 2":42,"I m m 2":43,"I b a 2":44,"I m a 2":45,"P 2/m 2/m 2/m":46,"P m m m":46,"P 2/n 2/n 2/n":47,"P n n n":47,"P 2/c 2/c 2/m":48,"P c c m":48,"P 2/b 2/a 2/n":49,"P b a n":49,"P 21/m 2/m 2/a":50,"P m m a":50,"P 2/n 21/n 2/a":51,"P n n a":51,"P 2/m 2/n 21/a":52,"P m n a":52,"P 21/c 2/c 2/a":53,"P c c a":53,"P 21/b 21/a 2/m":54,"P b a m":54,"P 21/c 21/c 2/n":55,"P c c n":55,"P 2/b 21/c 21/m":56,"P b c m":56,"P 21/n 21/n 2/m":57,"P n n m":57,"P 21/m 21/m 2/n":58,"P m m n":58,"P 21/b 2/c 21/n":59,"P b c n":59,"P 21/b 21/c 21/a":60,"P b c a":60,"P 21/n 21/m 21/a":61,"P n m a":61,"C 2/m 2/c 21/m":62,"C m c m":62,"C 2/m 2/c 21/a":63,"C m c a":63,"C 2/m 2/m 2/m":64,"C m m m":64,"C 2/c 2/c 2/m":65,"C c c m":65,"C 2/m 2/m 2/a":66,"C m m a":66,"C 2/c 2/c 2/a":67,"C c c a":67,"F 2/m 2/m 2/m":68,"F m m m":68,"F 2/d 2/d 2/d":69,"F d d d":69,"I 2/m 2/m 2/m":70,"I m m m":70,"I 2/b 2/a 2/m":71,"I b a m":71,"I 21/b 21/c 21/a":72,"I b c a":72,"I 21/m 21/m 21/a":73,"I m m a":73,"P 4":74,"P 41":75,"P 42":76,"P 43":77,"I 4":78,"I 41":79,"P -4":80,"I -4":81,"P 4/m":82,"P 42/m":83,"P 4/n":84,"P 42/n":85,"I 4/m":86,"I 41/a":87,"P 4 2 2":88,"P 4 21 2":89,"P 41 2 2":90,"P 41 21 2":91,"P 42 2 2":92,"P 42 21 2":93,"P 43 2 2":94,"P 43 21 2":95,"I 4 2 2":96,"I 41 2 2":97,"P 4 m m":98,"P 4 b m":99,"P 42 c m":100,"P 42 n m":101,"P 4 c c":102,"P 4 n c":103,"P 42 m c":104,"P 42 b c":105,"I 4 m m":106,"I 4 c m":107,"I 41 m d":108,"I 41 c d":109,"P -4 2 m":110,"P -4 2 c":111,"P -4 21 m":112,"P -4 21 c":113,"P -4 m 2":114,"P -4 c 2":115,"P -4 b 2":116,"P -4 n 2":117,"I -4 m 2":118,"I -4 c 2":119,"I -4 2 m":120,"I -4 2 d":121,"P 4/m 2/m 2/m":122,"P4/m m m":122,"P 4/m 2/c 2/c":123,"P4/m c c":123,"P 4/n 2/b 2/m":124,"P4/n b m":124,"P 4/n 2/n 2/c":125,"P4/n n c":125,"P 4/m 21/b 2/m":126,"P4/m b m":126,"P 4/m 21/n 2/c":127,"P4/m n c":127,"P 4/n 21/m 2/m":128,"P4/n m m":128,"P 4/n 2/c 2/c":129,"P4/n c c":129,"P 42/m 2/m 2/c":130,"P42/m m c":130,"P 42/m 2/c 2/m":131,"P42/m c m":131,"P 42/n 2/b 2/c":132,"P42/n b c":132,"P 42/n 2/n 2/m":133,"P42/n n m":133,"P 42/m 21/b 2/c":134,"P42/m b c":134,"P 42/m 21/n 2/m":135,"P42/m n m":135,"P 42/n 21/m 2/c":136,"P42/n m c":136,"P 42/n 21/c 2/m":137,"P42/n c m":137,"I 4/m 2/m 2/m":138,"I4/m m m":138,"I 4/m 2/c 2/m":139,"I4/m c m":139,"I 41/a 2/m 2/d":140,"I41/a m d":140,"I 41/a 2/c 2/d":141,"I41/a c d":141,"P 3":142,"P 31":143,"P 32":144,"H 3":145,"R 3":146,"P -3":147,"H -3":148,"R -3":149,"P 3 1 2":150,"P 3 2 1":151,"P 31 1 2":152,"P 31 2 1":153,"P 32 1 2":154,"P 32 2 1":155,"H 3 2":156,"R 3 2":157,"P 3 m 1":158,"P 3 1 m":159,"P 3 c 1":160,"P 3 1 c":161,"H 3 m":162,"R 3 m":163,"H 3 c":164,"R 3 c":165,"P -3 1 2/m":166,"P -3 1 m":166,"P -3 1 2/c":167,"P -3 1 c":167,"P -3 2/m 1":168,"P -3 m 1":168,"P -3 2/c 1":169,"P -3 c 1":169,"H -3 2/m":170,"H -3 m":170,"R -3 2/m":171,"R -3 m":171,"H -3 2/c":172,"H -3 c":172,"R -3 2/c":173,"R -3 c":173,"P 6":174,"P 61":175,"P 65":176,"P 62":177,"P 64":178,"P 63":179,"P -6":180,"P 6/m":181,"P 63/m":182,"P 6 2 2":183,"P 61 2 2":184,"P 65 2 2":185,"P 62 2 2":186,"P 64 2 2":187,"P 63 2 2":188,"P 6 m m":189,"P 6 c c":190,"P 63 c m":191,"P 63 m c":192,"P -6 m 2":193,"P -6 c 2":194,"P -6 2 m":195,"P -6 2 c":196,"P 6/m 2/m 2/m":197,"P 6/m m m":197,"P 6/m 2/c 2/c":198,"P 6/m c c":198,"P 63/m 2/c 2/m":199,"P 63/m c m":199,"P 63/m 2/m 2/c":200,"P 63/m m c":200,"P 2 3":201,"F 2 3":202,"I 2 3":203,"P 21 3":204,"I 21 3":205,"P 2/m -3":206,"P m -3":206,"P 2/n -3":207,"P n -3":207,"F 2/m -3":208,"F m -3":208,"F 2/d -3":209,"F d -3":209,"I 2/m -3":210,"I m -3":210,"P 21/a -3":211,"P a -3":211,"I 21/a -3":212,"I a -3":212,"P 4 3 2":213,"P 42 3 2":214,"F 4 3 2":215,"F 41 3 2":216,"I 4 3 2":217,"P 43 3 2":218,"P 41 3 2":219,"I 41 3 2":220,"P -4 3 m":221,"F -4 3 m":222,"I -4 3 m":223,"P -4 3 n":224,"F -4 3 c":225,"I -4 3 d":226,"P 4/m -3 2/m":227,"P m -3 m":227,"P 4/n -3 2/n":228,"P n -3 n":228,"P 42/m -3 2/n":229,"P m -3 n":229,"P 42/n -3 2/m":230,"P n -3 m":230,"F 4/m -3 2/m":231,"F m -3 m":231,"F 4/m -3 2/c":232,"F m -3 c":232,"F 41/d -3 2/m":233,"F d -3 m":233,"F 41/d -3 2/c":234,"F d -3 c":234,"I 4/m -3 2/m":235,"I m -3 m":235,"I 41/a -3 2/d":236,"I a -3 d":236,"P 1 1 2":237,"P 1 1 21":238,"B 1 1 2":239,"B 2":239,"A 1 2 1":240,"C 1 21 1":241,"I 1 2 1":242,"I 2":242,"I 1 21 1":243,"P 1 1 m":244,"P 1 1 b":245,"B 1 1 m":246,"B 1 1 b":247,"P 1 1 2/m":248,"P 1 1 21/m":249,"B 1 1 2/m":250,"P 1 1 2/b":251,"P 1 1 21/b":252,"P 1 21/n 1":253,"P 1 21/a 1":254,"B 1 1 2/b":255,"P 21 2 2":256,"P 2 21 2":257,"P 21 21 2 (a)":258,"P 21 2 21":259,"P 2 21 21":260,"C 2 2 21a)":261,"C 2 2 2a":262,"F 2 2 2a":263,"I 2 2 2a":264,"P 21/m 21/m 2/n a":265,"P 42 21 2a":266,"I 2 3a":267};function U4e(e){switch(e){case 1146:return 146;case 1148:return 149;case 1155:return 157;case 1160:return 163;case 1161:return 165;case 1166:return 171;case 1167:return 173;case 1003:return 237;case 1004:return 238;case 1005:return 239;case 2005:return 240;case 3005:return 241;case 4005:return 242;case 5005:return 243;case 1006:return 244;case 1007:return 245;case 1008:return 246;case 1009:return 247;case 1010:return 248;case 1011:return 249;case 1012:return 250;case 1013:return 251;case 1014:return 252;case 2014:return 253;case 3014:return 254;case 1015:return 255;case 1017:return 256;case 2017:return 257;case 1018:return 258;case 2018:return 259;case 3018:return 260;case 1020:return 261;case 1021:return 262;case 1022:return 263;case 1023:return 264;case 1059:return 265;case 1094:return 266;case 1197:return 267}var t=0;return e>146&&++t,e>148&&++t,e>155&&++t,e>160&&++t,e>161&&++t,e>166&&++t,e>167&&++t,e-1+t}function j4e(e){if(e<146)return e+1;if(e===146)return 1146;if(e<149)return e+1-1;if(e===149)return 1148;if(e<157)return e+1-2;if(e===157)return 1155;if(e<163)return e+1-3;if(e===163)return 1160;if(e<165)return e+1-4;if(e===165)return 1161;if(e<171)return e+1-5;if(e===171)return 1166;if(e<173)return e+1-6;if(e===173)return 1167;if(e<237)return e+1-7;if(e===237)return 1003;if(e===238)return 1004;if(e===239)return 1005;if(e===240)return 2005;if(e===241)return 3005;if(e===242)return 4005;if(e===243)return 5005;if(e===244)return 1006;if(e===245)return 1007;if(e===246)return 1008;if(e===247)return 1009;if(e===248)return 1010;if(e===249)return 1011;if(e===250)return 1012;if(e===251)return 1013;if(e===252)return 1014;if(e===253)return 2014;if(e===254)return 3014;if(e===255)return 1015;if(e===256)return 1017;if(e===257)return 2017;if(e===258)return 1018;if(e===259)return 2018;if(e===260)return 3018;if(e===261)return 1020;if(e===262)return 1021;if(e===263)return 1022;if(e===264)return 1023;if(e===265)return 1059;if(e===266)return 1094;if(e===267)return 1197;throw new Error("unknown spacegroup index '"+e+"'")}var IK=function(){for(var e=Object.create(null),t=0,r=Object.keys(W1);t<r.length;t++){var n=r[t];e[W1[n]]=n}return e}(),z4e=function(){for(var e=Object.create(null),t=0,r=Object.keys(W1);t<r.length;t++){var n=r[t],i=W1[n];e[i]=j4e(i)}return e}();function V4e(e){var t=typeof e=="number"?U4e(e):W1[e];return typeof t>"u"||typeof IK[t]>"u"?-1:t}var xo;(function(e){e.Zero=r("P 1",_.create(1,1,1),_.create(Math.PI/2,Math.PI/2,Math.PI/2));function t(n){return n?n.index===0&&n.size[0]===1&&n.size[1]===1&&n.size[1]===1:!0}e.isZero=t;function r(n,i,a){var o=V4e(n);if(o<0)return console.warn("Unknown spacegroup '"+n+"', returning a 'P 1' with cellsize [1, 1, 1]"),e.Zero;var s=i[0]*i[1]*i[2],u=a[0],l=a[1],c=a[2],d=i[0],f=i[1],h=i[2],v=Math.cos(l),p=(Math.cos(u)-Math.cos(l)*Math.cos(c))/Math.sin(c),m=Math.sqrt(1-v*v-p*p),g=[d,0,0],y=[Math.cos(c)*f,Math.sin(c)*f,0],b=[v*h,p*h,m*h],S=ue.ofRows([[g[0],y[0],b[0],0],[0,y[1],b[1],0],[0,0,b[2],0],[0,0,0,1]]),x=ue.invert(ue.zero(),S);return{index:o,size:i,volume:s,anglesInRadians:a,toFractional:x,fromFractional:S}}e.create=r})(xo||(xo={}));var Du;(function(e){e.ZeroP1=t(xo.Zero);function t(m){var g=B4e[m.index].map(function(S){return d(F4e[S])}),y=IK[m.index],b=z4e[m.index];return{name:y,num:b,cell:m,operators:g}}e.create=t;var r=_(),n=ue();function i(m,g,y,b,S,x){return _.set(r,y,b,S),ue.fromTranslation(n,r),ue.mul(x,ue.mul(x,ue.mul(x,m.cell.fromFractional,n),m.operators[g]),m.cell.toFractional)}e.setOperatorMatrix=i;function a(m,g,y,b,S){var x=i(m,g,y,b,S,ue.zero());return pn.create(g+1+"_"+(5+y)+(5+b)+(5+S),x,{hkl:_.create(y,b,S),spgrOp:g})}e.getSymmetryOperator=a;var o=_(),s=_(),u=_(),l=_();function c(m,g,y,b,S,x){var C=ue.zero();_.set(r,y,b,S),_.floor(o,x),ue.copy(C,m.operators[g]),_.floor(s,_.transformMat4(s,x,C)),ue.getTranslation(l,C),_.sub(l,l,s),_.add(l,l,o),_.add(l,l,r),ue.setTranslation(C,l),ue.mul(C,m.cell.fromFractional,C),ue.mul(C,C,m.cell.toFractional),_.sub(u,s,o);var w=y-u[0],A=b-u[1],M=S-u[2];return pn.create(g+1+"_"+(5+w)+(5+A)+(5+M),C,{hkl:_.create(w,A,M),spgrOp:g})}e.getSymmetryOperatorRef=c;function d(m){var g=bP[m[0]],y=bP[m[1]],b=bP[m[2]];return ue.ofRows([g,y,b,[0,0,0,1]])}function f(m){return[p(h(m[0],m[4],m[8]),v(m[12])),p(h(m[1],m[5],m[9]),v(m[13])),p(h(m[2],m[6],m[10]),v(m[14]))].join(",")}e.getOperatorXyz=f;function h(m,g,y){var b=[];if(m>0?b.push("+X"):m<0&&b.push("-X"),g>0?b.push("+Y"):g<0&&b.push("-Y"),y>0?b.push("+Z"):y<0&&b.push("-Z"),b.length===1)return b[0].charAt(0)==="+"?b[0].substr(1):b[0];if(b.length===2){var S=b[0].charAt(0),x=b[1].charAt(0);if(S==="+")return""+b[0].substr(1)+b[1];if(x==="+")return""+b[1].substr(1)+b[0]}throw new Error("unknown rotation '"+b+"', "+m+" "+g+" "+y)}function v(m){switch(m){case 1/2:return"1/2";case 1/4:return"1/4";case 3/4:return"3/4";case 1/3:return"1/3";case 2/3:return"2/3";case 1/6:return"1/6";case 5/6:return"5/6"}return""}function p(m,g){return g===""?m:m.length>2?m+"+"+g:m.charAt(0)==="-"?""+g+m:g+"+"+m}})(Du||(Du={}));var $f;(function(e){function t(a,o,s){a.squaredDistances[a.count]=s,a.indices[a.count++]=o}e.add=t;function r(a){a.count=0}e.reset=r;function n(){return{count:0,indices:[],squaredDistances:[]}}e.create=n;function i(a,o){for(var s=0;s<o.count;++s)a.indices[s]=o.indices[s],a.squaredDistances[s]=o.squaredDistances[s];return a.count=o.count,a}e.copy=i})($f||($f={}));function Fe(){return Fe.zero()}(function(e){function t(k){return k.extrema!==void 0}e.hasExtrema=t;function r(k,R){return{center:k,radius:R}}e.create=r;function n(){return{center:_(),radius:0}}e.zero=n;function i(k){var R=r(_.clone(k.center),k.radius);return t(k)&&(R.extrema=k.extrema.map(function(L){return _.clone(L)})),R}e.clone=i;function a(k,R,L){return _.copy(k.center,R),k.radius=L,k}e.set=a;function o(k,R){return _.copy(k.center,R.center),k.radius=R.radius,t(R)&&s(k,R.extrema.map(function(L){return _.clone(L)})),k}e.copy=o;function s(k,R){var L;return k.extrema!==void 0?(k.extrema.length=0,(L=k.extrema).push.apply(L,R)):k.extrema=R,k}e.setExtrema=s;function u(k){for(var R=k.x,L=k.y,H=k.z,B=k.indices,j=0,Q=0,G=0,W=0,q=Oe.size(B),ee=0;ee<q;ee++){var he=Oe.getAt(B,ee);j+=R[he],Q+=L[he],G+=H[he]}q>0&&(j/=q,Q/=q,G/=q);for(var ee=0;ee<q;ee++){var he=Oe.getAt(B,ee),$=R[he]-j,X=L[he]-Q,U=H[he]-G,z=$*$+X*X+U*U;z>W&&(W=z)}return{center:_.create(j,Q,G),radius:Math.sqrt(W)}}e.computeBounding=u;function l(k,R,L){return _.transformMat4(k.center,R.center,L),k.radius=R.radius*ue.getMaxScaleOnAxis(L),t(R)&&s(k,R.extrema.map(function(H){return _.transformMat4(_(),H,L)})),k}e.transform=l;function c(k,R,L){return _.add(k.center,R.center,L),t(R)&&s(k,R.extrema.map(function(H){return _.add(_(),H,L)})),k}e.translate=c;function d(k,R,L){_.toArray(k.center,R,L),R[L+3]=k.radius}e.toArray=d;function f(k,R,L){return _.fromArray(k.center,R,L),k.radius=R[L+3],k}e.fromArray=f;function h(k,R){return _.scale(k.center,_.add(k.center,R.max,R.min),.5),k.radius=_.distance(k.center,R.max),e.setExtrema(k,[_.create(R.min[0],R.min[1],R.min[2]),_.create(R.max[0],R.max[1],R.max[2]),_.create(R.max[0],R.min[1],R.min[2]),_.create(R.min[0],R.max[1],R.max[2]),_.create(R.min[0],R.min[1],R.max[2]),_.create(R.max[0],R.min[1],R.max[2]),_.create(R.max[0],R.max[1],R.min[2]),_.create(R.min[0],R.max[1],R.min[2])]),k}e.fromBox3D=h;function v(k,R){return _.copy(k.center,R.origin),k.radius=Math.max(_.magnitude(R.dirA),_.magnitude(R.dirB),_.magnitude(R.dirC)),k}e.fromAxes3D=v;var p=_();function m(k,R,L){var H=R[0],B=R[1],j=R[2],Q=_.create(0,0,0);_.transformMat4(Q,Q,L);var G=_.create(H,B,j);_.transformMat4(G,G,L);var W=_.create(H,0,0);_.transformMat4(W,W,L);var q=_.create(0,B,j);_.transformMat4(q,q,L);var ee=_.create(0,0,j);_.transformMat4(ee,ee,L);var he=_.create(H,0,j);_.transformMat4(he,he,L);var $=_.create(H,B,0);_.transformMat4($,$,L);var X=_.create(0,B,0);_.transformMat4(X,X,L),_.add(p,Q,G),_.scale(p,p,.5);var U=Math.max(_.distance(Q,G),_.distance(W,q));return e.set(k,p,U/2),e.setExtrema(k,[Q,G,W,q,ee,he,$,X]),k}e.fromDimensionsAndTransform=m;var g=_();function y(k,R,L){var H=_.distance(R.center,L);return H<R.radius?e.copy(k,R):(_.sub(g,R.center,L),_.sub(g,R.center,g),_.setMagnitude(g,g,R.radius),_.scale(k.center,_.add(g,g,L),.5),k.radius=_.distance(k.center,L),k)}e.addVec3=y;function b(k,R,L){return _.copy(k.center,R.center),k.radius=Math.max(R.radius,_.distance(R.center,L.center)+L.radius),t(R)&&t(L)&&s(k,Ft(Ft([],R.extrema.map(function(H){return _.clone(H)})),L.extrema.map(function(H){return _.clone(H)}))),k}e.expandBySphere=b;var S=_();function x(k,R,L){var H,B;return _.copy(k.center,R.center),k.radius=R.radius+L,R.radius<1e-12||((B=(H=R.extrema)===null||H===void 0?void 0:H.length)!==null&&B!==void 0?B:0)<=1?(k.extrema=void 0,k):(t(R)&&s(k,R.extrema.map(function(j){_.sub(S,j,R.center);var Q=_.distance(R.center,j);return _.normalize(S,S),_.scaleAndAdd(_(),R.center,S,Q+L)})),k)}e.expand=x;function C(k,R){return k.radius===R.radius&&_.exactEquals(k.center,R.center)}e.exactEquals=C;function w(k,R){var L=k.radius,H=R.radius;return Math.abs(L-H)<=vn*Math.max(1,Math.abs(L),Math.abs(H))&&_.equals(k.center,R.center)}e.equals=w;function A(k,R){if(t(R)){for(var L=0,H=R.extrema;L<H.length;L++){var B=H[L];if(_.distance(k.center,B)>k.radius)return!1}return!0}else return _.distance(k.center,R.center)+R.radius<=k.radius}e.includes=A;function M(k,R){return _.distance(k.center,R.center)<=k.radius+R.radius}e.overlaps=M;function D(k,R){return _.distance(k.center,R.center)-k.radius+R.radius}e.distance=D})(Fe||(Fe={}));function Xt(){return Xt.zero()}(function(e){function t(y,b){return{min:y,max:b}}e.create=t;function r(){return{min:_(),max:_()}}e.zero=r;function n(y,b){return _.copy(y.min,b.min),_.copy(y.max,b.max),y}e.copy=n;function i(y){return n(r(),y)}e.clone=i;function a(y,b){if(Fe.hasExtrema(b))return o(y,b.extrema);var S=_.create(b.radius,b.radius,b.radius);return _.sub(y.min,b.center,S),_.add(y.max,b.center,S),y}e.fromSphere3D=a;function o(y,b){e.setEmpty(y);for(var S=0,x=b.length;S<x;S++)e.add(y,b[S]);return y}e.fromVec3Array=o;function s(y){for(var b=_.create(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),S=_.create(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),x=y.x,C=y.y,w=y.z,A=y.indices,M=0,D=Oe.size(A);M<D;M++){var k=Oe.getAt(A,M);b[0]=Math.min(x[k],b[0]),b[1]=Math.min(C[k],b[1]),b[2]=Math.min(w[k],b[2]),S[0]=Math.max(x[k],S[0]),S[1]=Math.max(C[k],S[1]),S[2]=Math.max(w[k],S[2])}return{min:b,max:S}}e.computeBounding=s;function u(y,b){return _.sub(y,b.max,b.min)}e.size=u;var l=_();function c(y){return u(l,y),l[0]*l[1]*l[2]}e.volume=c;function d(y){return _.set(y.min,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),_.set(y.max,-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),y}e.setEmpty=d;function f(y,b){return _.min(y.min,y.min,b),_.max(y.max,y.max,b),y}e.add=f;function h(y,b,S){return _.sub(y.min,b.min,S),_.add(y.max,b.max,S),y}e.expand=h;function v(y,b,S){return _.scale(y.min,b.min,S),_.scale(y.max,b.max,S),y}e.scale=v;var p=_();function m(y,b,S){var x=b.min,C=x[0],w=x[1],A=x[2],M=b.max,D=M[0],k=M[1],R=M[2];return d(y),f(y,_.transformMat4(p,_.set(p,C,w,A),S)),f(y,_.transformMat4(p,_.set(p,C,w,R),S)),f(y,_.transformMat4(p,_.set(p,C,k,A),S)),f(y,_.transformMat4(p,_.set(p,C,k,R),S)),f(y,_.transformMat4(p,_.set(p,D,w,A),S)),f(y,_.transformMat4(p,_.set(p,D,w,R),S)),f(y,_.transformMat4(p,_.set(p,D,k,A),S)),f(y,_.transformMat4(p,_.set(p,D,k,R),S)),y}e.transform=m;function g(y,b){return!(b[0]<y.min[0]||b[0]>y.max[0]||b[1]<y.min[1]||b[1]>y.max[1]||b[2]<y.min[2]||b[2]>y.max[2])}e.containsVec3=g})(Xt||(Xt={}));function qp(e,t,r){return new H4e(e,t,r)}var H4e=function(){function e(t,r,n){var i=q4e(t,r,n);this.ctx=W4e(i),this.boundary={box:i.boundingBox,sphere:i.boundingSphere},this.buckets={offset:i.bucketOffset,count:i.bucketCounts,array:i.bucketArray},this.result=$f.create()}return e.prototype.find=function(t,r,n,i,a){this.ctx.x=t,this.ctx.y=r,this.ctx.z=n,this.ctx.radius=i,this.ctx.isCheck=!1;var o=a??this.result;return R7(this.ctx,o),o},e.prototype.check=function(t,r,n,i){return this.ctx.x=t,this.ctx.y=r,this.ctx.z=n,this.ctx.radius=i,this.ctx.isCheck=!0,R7(this.ctx,this.result)},e}();function G4e(e){for(var t=e.expandedBox,r=e.size,n=r[0],i=r[1],a=r[2],o=e.data,s=o.x,u=o.y,l=o.z,c=o.radius,d=o.indices,f=e.elementCount,h=e.delta,v=n*i*a,p=t.min,m=p[0],g=p[1],y=p[2],b=0,S=0,x=new Uint32Array(v),C=new Int32Array(f),w=0;w<f;w++){var A=Oe.getAt(d,w),M=Math.floor((s[A]-m)/h[0]),D=Math.floor((u[A]-g)/h[1]),k=Math.floor((l[A]-y)/h[2]),R=(M*i+D)*a+k;(x[R]+=1)===1&&(S+=1),C[w]=R}if(c)for(var w=0;w<f;w++){var A=Oe.getAt(d,w);c[A]>b&&(b=c[A])}for(var L=new Int32Array(S),A=0,H=0;A<v;A++){var B=x[A];B>0&&(x[A]=H+1,L[H]=B,H+=1)}for(var j=new Uint32Array(S),A=1;A<S;++A)j[A]+=j[A-1]+L[A-1];for(var Q=new Int32Array(S),G=new Int32Array(f),A=0;A<f;A++){var W=x[C[A]];if(W>0){var q=W-1;G[j[q]+Q[q]]=A,Q[q]+=1}}return{size:e.size,bucketArray:G,bucketCounts:L,bucketOffset:j,grid:x,delta:h,min:e.expandedBox.min,data:e.data,maxRadius:b,expandedBox:e.expandedBox,boundingBox:e.boundingBox,boundingSphere:e.boundingSphere}}function q4e(e,t,r){var n=Xt.expand(Xt(),t.box,_.create(.5,.5,.5)),i=e.indices,a=Xt.size(_.zero(),n),o,s,u=Oe.size(i),l=typeof r=="number"?r:32,c=Array.isArray(r)&&r;if(c)s=[Math.ceil(a[0]/c[0]),Math.ceil(a[1]/c[1]),Math.ceil(a[2]/c[2])],o=c;else if(u>0){var d=Math.ceil(u/l),f=Math.pow(d/(a[0]*a[1]*a[2]),1/3);s=[Math.ceil(a[0]*f),Math.ceil(a[1]*f),Math.ceil(a[2]*f)],o=[a[0]/s[0],a[1]/s[1],a[2]/s[2]]}else o=a,s=[1,1,1];var h={x:e.x,y:e.y,z:e.z,indices:i,radius:e.radius},v={size:s,data:h,expandedBox:n,boundingBox:t.box,boundingSphere:t.sphere,elementCount:u,delta:o};return G4e(v)}function W4e(e){return{grid:e,x:.1,y:.1,z:.1,radius:.1,isCheck:!1}}function R7(e,t){var r=e.grid,n=r.min,i=r.size,a=i[0],o=i[1],s=i[2],u=r.bucketOffset,l=r.bucketCounts,c=r.bucketArray,d=r.grid,f=r.data,h=f.x,v=f.y,p=f.z,m=f.indices,g=f.radius,y=r.delta,b=r.maxRadius,S=e.radius,x=e.isCheck,C=e.x,w=e.y,A=e.z,M=S+b,D=M*M;$f.reset(t);var k=Math.max(0,Math.floor((C-M-n[0])/y[0])),R=Math.max(0,Math.floor((w-M-n[1])/y[1])),L=Math.max(0,Math.floor((A-M-n[2])/y[2])),H=Math.min(a-1,Math.floor((C+M-n[0])/y[0])),B=Math.min(o-1,Math.floor((w+M-n[1])/y[1])),j=Math.min(s-1,Math.floor((A+M-n[2])/y[2]));if(k>H||R>B||L>j)return!1;for(var Q=k;Q<=H;Q++)for(var G=R;G<=B;G++)for(var W=L;W<=j;W++){var q=d[(Q*o+G)*s+W];if(q!==0)for(var ee=q-1,he=u[ee],$=l[ee],X=he+$,U=he;U<X;U++){var z=Oe.getAt(m,c[U]),J=h[z]-C,Y=v[z]-w,Z=p[z]-A,te=J*J+Y*Y+Z*Z;if(te<=D){if(b>0&&Math.sqrt(te)-g[z]>S)continue;if(x)return!0;$f.add(t,c[U],te)}}}return t.count>0}function fu(){return fu.empty()}(function(e){function t(d,f,h,v){return{origin:d,dirA:f,dirB:h,dirC:v}}e.create=t;function r(){return{origin:_(),dirA:_(),dirB:_(),dirC:_()}}e.empty=r;function n(d,f){return _.copy(d.origin,f.origin),_.copy(d.dirA,f.dirA),_.copy(d.dirB,f.dirB),_.copy(d.dirC,f.dirC),d}e.copy=n;function i(d){return n(r(),d)}e.clone=i;function a(d,f){return _.set(d,_.magnitude(f.dirA)*2,_.magnitude(f.dirB)*2,_.magnitude(f.dirC)*2)}e.size=a;var o=_();function s(d){return a(o,d),o[0]*o[1]*o[2]}e.volume=s;function u(d,f){return _.copy(d.origin,f.origin),_.normalize(d.dirA,f.dirA),_.normalize(d.dirB,f.dirB),_.normalize(d.dirC,f.dirC),d}e.normalize=u;var l=zn.zero();function c(d,f,h){_.transformMat4(d.origin,f.origin,h);var v=zn.directionTransform(l,h);return _.transformMat3(d.dirA,f.dirA,v),_.transformMat3(d.dirB,f.dirB,v),_.transformMat3(d.dirC,f.dirC,v),d}e.transform=c})(fu||(fu={}));function qr(e){return function(t){return fO(e,t)}}function fO(e,t){var r=e.data,n=e.indices,i=e.count,a=t.valueType,o=a==="str"?function(s){return r.substring(n[2*s],n[2*s+1])}:a==="int"?function(s){return kf(r,n[2*s],n[2*s+1])||0}:function(s){return gc(r,n[2*s],n[2*s+1])||0};return{schema:t,__array:void 0,isDefined:!0,rowCount:i,value:o,valueKind:function(s){return 0},toArray:function(s){return Qi(i,o,s)},areValuesEqual:MK(e)}}function MK(e){var t=e.data,r=e.indices;return function(n,i){var a=r[2*n],o=r[2*i],s=r[2*n+1]-a;if(s!==r[2*i+1]-o)return!1;for(var u=0;u<s;u++)if(t.charCodeAt(u+a)!==t.charCodeAt(u+o))return!1;return!0}}function DK(e,t){return{name:t,blocks:e}}function hO(e,t,r,n){return n===void 0&&(n=[]),{categoryNames:e,header:r,categories:t,saveFrames:n,getField:function(i){var a=i.split("."),o=a[0],s=a[1];return t[o].getField(s||"")}}}function $4e(e,t,r){return{categoryNames:e,header:r,categories:t}}function sa(e,t,r,n){return{rowCount:t,name:e,fieldNames:Ft([],r),getField:function(i){return n[i]}}}(function(e){function t(i){return{rowCount:0,name:i,fieldNames:[],getField:function(a){}}}e.empty=t;function r(i,a){var o=Object.keys(a);return{rowCount:o.length>0?a[o[0]].rowCount:0,name:i,fieldNames:o,getField:function(s){return a[s]}}}e.ofFields=r;function n(i,a){for(var o={},s=0,u=a._columns;s<u.length;s++){var l=u[s];o[l]=St.ofColumn(a[l])}return r(i,o)}e.ofTable=n})(sa||(sa={}));var St;(function(e){function t(s){return r([s])}e.ofString=t;function r(s){var u=s.length,l=function(h){var v=s[h];return!v||v==="."||v==="?"?"":v},c=function(h){var v=s[h];return kf(v,0,v.length)||0},d=function(h){var v=s[h];return gc(v,0,v.length)||0},f=function(h){var v=s[h],p=v.length;if(p>1)return 0;if(p===0)return 1;var m=v.charCodeAt(0);return m===46?1:m===63?2:0};return{__array:void 0,binaryEncoding:void 0,isDefined:!0,rowCount:u,str:l,int:c,float:d,valueKind:f,areValuesEqual:function(h,v){return s[h]===s[v]},toStringArray:function(h){return h?Qi(u,l,h):s},toIntArray:function(h){return Qi(u,c,h)},toFloatArray:function(h){return Qi(u,d,h)}}}e.ofStrings=r;function n(s){var u=s.length,l=function(h){return""+s[h]},c=function(h){return s[h]},d=function(h){return 0},f=function(h){return!h||h.array&&s instanceof h.array?s:Qi(u,c,h)};return{__array:void 0,binaryEncoding:void 0,isDefined:!0,rowCount:u,str:l,int:c,float:c,valueKind:d,areValuesEqual:function(h,v){return s[h]===s[v]},toStringArray:function(h){return Qi(u,l,h)},toIntArray:f,toFloatArray:f}}e.ofNumbers=n;function i(s){var u=s.data,l=s.indices,c=s.count,d=function(p){var m=u.substring(l[2*p],l[2*p+1]);return m==="."||m==="?"?"":m},f=function(p){return kf(u,l[2*p],l[2*p+1])||0},h=function(p){return gc(u,l[2*p],l[2*p+1])||0},v=function(p){var m=l[2*p],g=l[2*p+1]-m;if(g>1)return 0;if(g===0)return 1;var y=u.charCodeAt(m);return y===46?1:y===63?2:0};return{__array:void 0,binaryEncoding:void 0,isDefined:!0,rowCount:c,str:d,int:f,float:h,valueKind:v,areValuesEqual:MK(s),toStringArray:function(p){return Qi(c,d,p)},toIntArray:function(p){return Qi(c,f,p)},toFloatArray:function(p){return Qi(c,h,p)}}}e.ofTokens=i;function a(s){var u=s.rowCount,l=s.valueKind,c=s.areValuesEqual,d=s.isDefined,f,h,v;switch(s.schema.valueType){case"float":case"int":f=function(m){return""+s.value(m)},h=s.value,v=s.value;break;case"str":f=s.value,h=function(m){var g=s.value(m);return kf(g,0,g.length)||0},v=function(m){var g=s.value(m);return gc(g,0,g.length)||0};break;case"list":var p=s.schema.separator;f=function(m){return s.value(m).join(p)},h=function(m){return NaN},v=function(m){return NaN};break;default:throw new Error("unsupported valueType '"+s.schema.valueType+"'")}return{__array:void 0,binaryEncoding:void 0,isDefined:d,rowCount:u,str:f,int:h,float:v,valueKind:l,areValuesEqual:c,toStringArray:function(m){return Qi(u,f,m)},toIntArray:function(m){return Qi(u,h,m)},toFloatArray:function(m){return Qi(u,v,m)}}}e.ofColumn=a;function o(s,u){return a(ve.Undefined(s,u))}e.ofUndefined=o})(St||(St={}));function X4e(e,t,r,n){var i=r?0:1;switch(t){case 1:return n==="brackets"?function(a){return e+"["+(a+i)+"]"}:function(a){return e+"_"+(a+i)};case 2:return n==="brackets"?function(a,o){return e+"["+(a+i)+"]["+(o+i)+"]"}:function(a,o){return e+"_"+(a+i)+(o+i)};case 3:return n==="brackets"?function(a,o,s){return e+"["+(a+i)+"]["+(o+i)+"]["+(s+i)+"]"}:function(a,o,s){return e+"_"+(a+i)+(o+i)+(s+i)};default:throw new Error("Tensors with rank > 3 or rank 0 are currently not supported.")}}function Y4e(e,t,r,n){var i=t.create();if(t.rank===1)for(var a=t.dimensions[0],o=0;o<a;o++){var s=e.getField(n(o));t.set(i,o,s?s.float(r):0)}else if(t.rank===2)for(var a=t.dimensions[0],u=t.dimensions[1],o=0;o<a;o++)for(var l=0;l<u;l++){var s=e.getField(n(o,l));t.set(i,o,l,s?s.float(r):0)}else if(t.rank===3)for(var c=t.dimensions[0],d=t.dimensions[1],f=t.dimensions[2],o=0;o<c;o++)for(var l=0;l<d;l++)for(var h=0;h<f;h++){var s=e.getField(n(o,l,h));t.set(i,o,l,h,s?s.float(r):0)}else throw new Error("Tensors with rank > 3 or rank 0 are currently not supported.");return i}function It(e){return{data:e,position:0,length:e.length,lineNumber:1,tokenStart:0,tokenEnd:0}}(function(e){function t(y){return y.data.substring(y.tokenStart,y.tokenEnd)}e.getTokenString=t;function r(y){y.position=0,y.lineNumber=1,y.tokenStart=0,y.tokenEnd=0}e.reset=r;function n(y){for(var b=y.data;y.position<y.length;)switch(b.charCodeAt(y.position)){case 10:return y.tokenEnd=y.position,++y.position,++y.lineNumber,!0;case 13:return y.tokenEnd=y.position,++y.position,++y.lineNumber,b.charCodeAt(y.position)===10&&++y.position,!0;default:++y.position;break}return y.tokenEnd=y.position,y.tokenStart!==y.tokenEnd}e.eatLine=n;function i(y){y.tokenStart=y.position}e.markStart=i;function a(y){return y.tokenStart=y.position,n(y)}e.markLine=a;function o(y){return a(y),t(y)}e.readLine=o;function s(y){a(y);var b=y.position;return g(y,y.tokenStart,y.tokenEnd),y.position=b,t(y)}e.readLineTrim=s;function u(y,b,S){for(var x=0,C=0;C<b;C++){if(!a(y))return x;ht.addUnchecked(S,y.tokenStart,y.tokenEnd),x++}return x}function l(y,b){var S=ht.create(y.data,b*2);return u(y,b,S),S}e.markLines=l;function c(y,b){for(var S=[],x=0;x<b;x++)S.push(e.readLine(y));return S}e.readLines=c;function d(y,b,S,x){return x===void 0&&(x=1e5),ce(this,void 0,void 0,function(){var C,w,A;return de(this,function(M){switch(M.label){case 0:return C=y.length,w=ht.create(y.data,b*2),A=0,[4,Oc(S,x,y,function(D,k){var R=Math.min(b-A,D);return u(k,R,w),A+=R,R},function(D,k){return D.update({message:"Parsing...",current:k.position,max:C})})];case 1:return M.sent(),[2,w]}})})}e.readLinesAsync=d;function f(y){for(var b=e(y),S=ht.create(b.data,Math.max(y.length/80,2));a(b);)ht.add(S,b.tokenStart,b.tokenEnd);return S}e.readAllLines=f;function h(y,b,S){for(var x=0,C=0;C<b;C++){if(!a(y))return x;ht.add(S,y.tokenStart,y.tokenEnd),x++}return x}function v(y,b,S){return S===void 0&&(S=1e5),ce(this,void 0,void 0,function(){var x,C;return de(this,function(w){switch(w.label){case 0:return x=e(y),C=ht.create(x.data,Math.max(y.length/80,2)),[4,Oc(b,S,x,function(A,M){return h(M,A,C),M.position<M.length?A:0},function(A,M){return A.update({message:"Parsing...",current:M.position,max:length})})];case 1:return w.sent(),[2,C]}})})}e.readAllLinesAsync=v;function p(y){for(;y.position<y.length;)switch(y.data.charCodeAt(y.position)){case 9:case 10:case 13:case 32:y.tokenEnd=y.position;return;default:++y.position;break}y.tokenEnd=y.position}e.eatValue=p;function m(y){for(var b=-1;y.position<y.length;){var S=y.data.charCodeAt(y.position);switch(S){case 9:case 32:b=S,++y.position;break;case 10:b!==13&&++y.lineNumber,b=S,++y.position;break;case 13:b=S,++y.position,++y.lineNumber;break;default:return b}}return b}e.skipWhitespace=m;function g(y,b,S){for(var x=y.data,C=b,w=S-1,A=x.charCodeAt(C);(A===9||A===32)&&C<=w;)A=x.charCodeAt(++C);for(A=x.charCodeAt(w);(A===9||A===32)&&w>=C;)A=x.charCodeAt(--w);return y.tokenStart=C,y.tokenEnd=w+1,y.position=S,y}e.trim=g})(It||(It={}));function K4e(e,t,r){for(var n=t,i=r-1,a=e.charCodeAt(n);(a===9||a===32)&&n<=i;)a=e.charCodeAt(++n);for(a=e.charCodeAt(i);(a===9||a===32)&&i>=n;)a=e.charCodeAt(--i);return e.substring(n,i+1)}var ht;(function(e){function t(o){var s=new Uint32Array(1.61*o.indices.length|0);s.set(o.indices),o.indices=s,o.indicesLenMinus2=s.length-2|0}function r(o,s,u){var l=o;l.offset>l.indicesLenMinus2&&t(l),l.indices[l.offset++]=s,l.indices[l.offset++]=u,o.count++}e.add=r;function n(o,s){r(o,s.tokenStart,s.tokenEnd)}e.addToken=n;function i(o,s,u){o.indices[o.offset++]=s,o.indices[o.offset++]=u,o.count++}e.addUnchecked=i;function a(o,s){return s=Math.max(10,s),{data:o,indicesLenMinus2:s-2|0,count:0,offset:0,indices:new Uint32Array(s)}}e.create=a})(ht||(ht={}));var wn;(function(e){function t(a,o){return o===void 0&&(o=-1),new n(a,o)}e.error=t;function r(a,o){return o===void 0&&(o=[]),new i(a,o)}e.success=r;var n=function(){function a(o,s){this.message=o,this.line=s,this.isError=!0}return a.prototype.toString=function(){return this.line>=0?"[Line "+this.line+"] "+this.message:this.message},a}();e.Error=n;var i=function(){function a(o,s){this.result=o,this.warnings=s,this.isError=!1}return a}();e.Success=i})(wn||(wn={}));function k7(e){for(;e.position<e.length;)switch(e.data.charCodeAt(e.position)){case 9:case 10:case 13:case 32:e.tokenEnd=e.position;return;default:++e.position;break}e.tokenEnd=e.position}function Q4e(e,t){var r,n;for(++e.position;e.position<e.length;)if(n=e.data.charCodeAt(e.position),n===t)switch(r=e.data.charCodeAt(e.position+1),r){case 9:case 10:case 13:case 32:e.tokenStart++,e.tokenEnd=e.position,e.isEscaped=!0,++e.position;return;default:if(r===void 0){e.tokenStart++,e.tokenEnd=e.position,e.isEscaped=!0,++e.position;return}++e.position;break}else{if(n===10||n===13){e.tokenEnd=e.position;return}++e.position}e.tokenEnd=e.position}function Z4e(e){for(e.position+=3;e.position<e.length;){if(e.data.charCodeAt(e.position)===39&&RK(e)){e.tokenStart+=3,e.tokenEnd=e.position,e.isEscaped=!0,e.position+=3;return}++e.position}e.tokenEnd=e.position}function J4e(e){for(var t=59,r=e.position+1,n;r<e.length;)if(n=e.data.charCodeAt(r),n===59&&(t===10||t===13)){for(e.position=r+1,e.tokenStart++,r--,n=e.data.charCodeAt(r);n===10||n===13;)r--,n=e.data.charCodeAt(r);e.tokenEnd=r+1,e.isEscaped=!0;return}else(n===13||n===10&&t!==13)&&e.lineNumber++,t=n,++r;return e.position=r,t}function eIe(e){for(;e.position<e.length;)switch(e.data.charCodeAt(e.position)){case 93:++e.position,e.tokenEnd=e.position,e.isImportGet=!1;return;default:++e.position;break}}function tIe(e){for(;e.position<e.length;){var t=e.data.charCodeAt(e.position);if(t===10||t===13)return;++e.position}}function rIe(e){for(var t=10;e.position<e.length;){var r=e.data.charCodeAt(e.position);switch(r){case 9:case 32:t=r,++e.position;break;case 10:t!==13&&++e.lineNumber,t=r,++e.position;break;case 13:t=r,++e.position,++e.lineNumber;break;default:return t}}return t}function RK(e){return!(e.length-e.position<2||e.data.charCodeAt(e.position+1)!==39||e.data.charCodeAt(e.position+2)!==39)}function nIe(e){var t=e.data.charCodeAt(e.tokenStart);return!(t!==68&&t!==100||(t=e.data.charCodeAt(e.tokenStart+1),t!==65&&t!==97)||(t=e.data.charCodeAt(e.tokenStart+2),t!==84&&t!==116)||(t=e.data.charCodeAt(e.tokenStart+3),t!==65&&t!==97))}function iIe(e){var t=e.data.charCodeAt(e.tokenStart);return!(t!==83&&t!==115||(t=e.data.charCodeAt(e.tokenStart+1),t!==65&&t!==97)||(t=e.data.charCodeAt(e.tokenStart+2),t!==86&&t!==118)||(t=e.data.charCodeAt(e.tokenStart+3),t!==69&&t!==101))}function aIe(e){if(e.tokenEnd-e.tokenStart!==5)return!1;var t=e.data.charCodeAt(e.tokenStart);return!(t!==76&&t!==108||(t=e.data.charCodeAt(e.tokenStart+1),t!==79&&t!==111)||(t=e.data.charCodeAt(e.tokenStart+2),t!==79&&t!==111)||(t=e.data.charCodeAt(e.tokenStart+3),t!==80&&t!==112))}function oIe(e){return!(e.tokenEnd-e.tokenStart!==11||e.data.charCodeAt(e.tokenStart+1)!==105||e.data.charCodeAt(e.tokenStart+2)!==109||e.data.charCodeAt(e.tokenStart+3)!==112||e.data.charCodeAt(e.tokenStart+4)!==111||e.data.charCodeAt(e.tokenStart+5)!==114||e.data.charCodeAt(e.tokenStart+6)!==116||e.data.charCodeAt(e.tokenStart+7)!==46||e.data.charCodeAt(e.tokenStart+8)!==103||e.data.charCodeAt(e.tokenStart+9)!==101||e.data.charCodeAt(e.tokenStart+10)!==116)}function sIe(e,t,r){var n,i=r-t,a=e.tokenStart-t,o=e.tokenEnd-e.tokenStart;if(o<i)return!1;for(n=t;n<r;++n)if(e.data.charCodeAt(n)!==e.data.charCodeAt(n+a))return!1;return i===o||e.data.charCodeAt(n+a)===46}function kK(e){var t;for(t=e.tokenStart;t<e.tokenEnd;++t)if(e.data.charCodeAt(t)===46)return t;return t}function OK(e,t){return e.data.substring(e.tokenStart,t)}function uIe(e){var t;for(t=e.tokenStart;t<e.tokenEnd;++t)if(e.data.charCodeAt(t)===46)return!1;return!0}function qM(e){return e.data.substring(e.tokenStart,e.tokenEnd)}function O7(e){var t=rIe(e);if(e.position>=e.length){e.tokenType=6;return}e.tokenStart=e.position,e.tokenEnd=e.position,e.isEscaped=!1;var r=e.data.charCodeAt(e.position);switch(r){case 35:tIe(e),e.tokenType=5;break;case 39:if(RK(e)){Z4e(e),e.tokenType=3;break}case 34:Q4e(e,r),e.tokenType=3;break;case 59:t===10||t===13?J4e(e):k7(e),e.tokenType=3;break;default:e.isImportGet?eIe(e):k7(e),e.isEscaped?e.tokenType=3:e.data.charCodeAt(e.tokenStart)===95?(e.inSaveFrame&&oIe(e)&&(e.isImportGet=!0),e.tokenType=4):e.tokenEnd-e.tokenStart>=5&&e.data.charCodeAt(e.tokenStart+4)===95?nIe(e)?e.tokenType=0:iIe(e)?e.tokenType=1:aIe(e)?e.tokenType=2:e.tokenType=3:e.tokenType=3;break}}function Lf(e){for(O7(e);e.tokenType===5;)O7(e)}function lIe(e,t){return{data:e,length:e.length,position:0,tokenStart:0,tokenEnd:0,tokenType:6,lineNumber:1,isEscaped:!1,isImportGet:!1,inSaveFrame:!1,runtimeCtx:t}}function U2(){return{categoryNames:[],categoryData:Object.create(null)}}function pO(e,t){for(var r=Object.create(null),n=0,i=e;n<i.length;n++){var a=i[n],o=t[a];r[a]=sa(o.name,o.rowCount,o.fieldNames,o.fields)}return r}function L7(e,t,r){return hO(e.categoryNames,pO(e.categoryNames,e.categoryData),t,r)}function cIe(e,t){return hO(e.categoryNames,pO(e.categoryNames,e.categoryData),t)}function WM(e,t,r,n,i){var a;if(t in e.categoryData){var o=e.categoryData[t];(a=o.fieldNames).push.apply(a,n),Object.assign(o.fields,i)}else e.categoryData[t]={name:t,rowCount:r,fieldNames:n,fields:i},e.categoryNames.push(t)}function dIe(e,t){for(var r=e.tokenStart,n=kK(e),i=OK(e,n),a=Object.create(null),o=[],s=!0;s;){if(e.tokenType!==4||!sIe(e,r,n)){s=!1;break}var u=qM(e).substring(i.length+1);if(Lf(e),e.tokenType!==3)return{hasError:!0,errorLine:e.lineNumber,errorMessage:"Expected value."};a[u]=St.ofTokens({data:e.data,indices:[e.tokenStart,e.tokenEnd],count:1}),o[o.length]=u,Lf(e)}return WM(t,i.substr(1),1,o,a),{hasError:!1,errorLine:0,errorMessage:""}}function fIe(e,t){for(var r=t.tokenizer,n=t.tokens,i=t.fieldCount,a=t.tokenCount,o=0;r.tokenType===3&&o<e;)ht.add(n[a++%i],r.tokenStart,r.tokenEnd),Lf(r),o++;return t.tokenCount=a,o}function hIe(e,t){return e.update({message:"Parsing...",current:t.tokenizer.position,max:t.tokenizer.data.length})}function pIe(e,t){return ce(this,void 0,void 0,function(){var r,n,i,a,o,s,u,f,l,c,f,d,d,f;return de(this,function(h){switch(h.label){case 0:for(r=e.lineNumber,Lf(e),n=OK(e,kK(e)),i=uIe(e),a=[];e.tokenType===4;)a[a.length]=i?qM(e):qM(e).substring(n.length+1),Lf(e);for(o=n==="_atom_site"?e.data.length/100|0:32,s=[],u=a.length,f=0;f<u;f++)s[f]=ht.create(e.data,o);return l={fieldCount:u,tokenCount:0,tokenizer:e,tokens:s},[4,Oc(e.runtimeCtx,1e6,l,fIe,hIe)];case 1:if(h.sent(),l.tokenCount%u!==0)return[2,{hasError:!0,errorLine:e.lineNumber,errorMessage:"The number of values for loop starting at line "+r+" is not a multiple of the number of columns."}];if(c=l.tokenCount/u|0,i)for(f=0;f<u;f++)d={"":St.ofTokens(s[f])},WM(t,a[f].substr(1),c,[""],d);else{for(d=Object.create(null),f=0;f<u;f++)d[a[f]]=St.ofTokens(s[f]);WM(t,n.substr(1),c,a,d)}return[2,{hasError:!1,errorLine:0,errorMessage:""}]}})})}function zv(e,t){return wn.error(t,e)}function vIe(e){return wn.success(e)}function mIe(e,t){return ce(this,void 0,void 0,function(){var r,n,i,a,o,s,u,l,c,d,d;return de(this,function(f){switch(f.label){case 0:r=[],n=lIe(e,t),i="",a=U2(),o=[],s=U2(),u=$4e(s.categoryNames,pO(s.categoryNames,s.categoryData),""),l="",t.update({message:"Parsing...",current:0,max:e.length}),Lf(n),f.label=1;case 1:return n.tokenType===6?[3,7]:(c=n.tokenType,c!==0?[3,2]:n.inSaveFrame?[2,zv(n.lineNumber,"Unexpected data block inside a save frame.")]:(a.categoryNames.length>0&&r.push(L7(a,i,o)),i=e.substring(n.tokenStart+5,n.tokenEnd),a=U2(),o=[],Lf(n),[3,6]));case 2:if(c!==1)return[3,3];if(n.tokenEnd-n.tokenStart===5)s.categoryNames.length>0&&(o[o.length]=cIe(s,l)),n.inSaveFrame=!1;else{if(n.inSaveFrame)return[2,zv(n.lineNumber,"Save frames cannot be nested.")];n.inSaveFrame=!0,l=e.substring(n.tokenStart+5,n.tokenEnd),s=U2()}return Lf(n),[3,6];case 3:return c!==2?[3,5]:[4,pIe(n,n.inSaveFrame?s:a)];case 4:return d=f.sent(),d.hasError?[2,zv(d.errorLine,d.errorMessage)]:[3,6];case 5:if(c===4){if(d=dIe(n,n.inSaveFrame?s:a),d.hasError)return[2,zv(d.errorLine,d.errorMessage)]}else return console.log(n.tokenType,It.getTokenString(n)),[2,zv(n.lineNumber,"Unexpected token. Expected data_, loop_, or data name.")];f.label=6;case 6:return[3,1];case 7:return n.inSaveFrame?[2,zv(n.lineNumber,"Unfinished save frame ("+u.header+").")]:((a.categoryNames.length>0||o.length>0)&&r.push(L7(a,i,o)),[2,vIe(DK(r))])}})})}function N7(e){var t=this;return We.create("Parse CIF",function(r){return ce(t,void 0,void 0,function(){return de(this,function(n){switch(n.label){case 0:return[4,mIe(e,r)];case 1:return[2,n.sent()]}})})})}var gIe=new Uint16Array(new Uint8Array([18,52]).buffer)[0]===13330;function yIe(e,t){for(var r=new ArrayBuffer(e.length),n=new Uint8Array(r),i=0,a=e.length;i<a;i+=t)for(var o=0;o<t;o++)n[i+t-o-1]=e[i+o];return r}var xP=28672;function bIe(e){if(e.length>xP){for(var t=[],r=0;r<e.length;r+=xP)t.push(String.fromCharCode.apply(null,e.subarray(r,r+xP)));return t.join("")}else return String.fromCharCode.apply(null,e)}function QC(e){for(var t=e.data,r=e.encoding.length-1;r>=0;r--)t=xIe(t,e.encoding[r]);return t}function xIe(e,t){switch(t.kind){case"ByteArray":switch(t.type){case 4:return e;case 1:return SIe(e);case 2:return CIe(e);case 5:return _Ie(e);case 3:return wIe(e);case 6:return EIe(e);case 32:return AIe(e);case 33:return PIe(e);default:throw new Error("Unsupported ByteArray type.")}case"FixedPoint":return TIe(e,t);case"IntervalQuantization":return IIe(e,t);case"RunLength":return MIe(e,t);case"Delta":return DIe(e,t);case"IntegerPacking":return OIe(e,t);case"StringArray":return LIe(e,t)}}function LK(e,t){switch(e){case 1:return new Int8Array(t);case 2:return new Int16Array(t);case 3:return new Int32Array(t);case 4:return new Uint8Array(t);case 5:return new Uint16Array(t);case 6:return new Uint32Array(t);default:throw new Error("Unsupported integer data type.")}}function NK(e,t){switch(e){case 32:return new Float32Array(t);case 33:return new Float64Array(t);default:throw new Error("Unsupported floating data type.")}}function SIe(e){return new Int8Array(e.buffer,e.byteOffset)}function Qg(e,t,r){return gIe?new r(e.buffer):new r(yIe(e,t))}function CIe(e){return Qg(e,2,Int16Array)}function _Ie(e){return Qg(e,2,Uint16Array)}function wIe(e){return Qg(e,4,Int32Array)}function EIe(e){return Qg(e,4,Uint32Array)}function AIe(e){return Qg(e,4,Float32Array)}function PIe(e){return Qg(e,8,Float64Array)}function TIe(e,t){for(var r=e.length,n=NK(t.srcType,r),i=1/t.factor,a=0;a<r;a++)n[a]=i*e[a];return n}function IIe(e,t){for(var r=e.length,n=NK(t.srcType,r),i=(t.max-t.min)/(t.numSteps-1),a=t.min,o=0;o<r;o++)n[o]=a+i*e[o];return n}function MIe(e,t){for(var r=LK(t.srcType,t.srcSize),n=0,i=0,a=e.length;i<a;i+=2)for(var o=e[i],s=e[i+1],u=0;u<s;++u)r[n++]=o;return r}function DIe(e,t){var r=e.length,n=LK(t.srcType,r);if(!r)return e;n[0]=e[0]+(t.origin|0);for(var i=1;i<r;++i)n[i]=e[i]+n[i-1];return n}function RIe(e,t){for(var r=t.byteCount===1?127:32767,n=-r-1,i=e.length,a=new Int32Array(t.srcSize),o=0,s=0;o<i;){for(var u=0,l=e[o];l===r||l===n;)u+=l,o++,l=e[o];u+=l,a[s]=u,o++,s++}return a}function kIe(e,t){for(var r=t.byteCount===1?255:65535,n=e.length,i=new Int32Array(t.srcSize),a=0,o=0;a<n;){for(var s=0,u=e[a];u===r;)s+=u,a++,u=e[a];s+=u,i[o]=s,a++,o++}return i}function OIe(e,t){return e.length===t.srcSize?e:t.isUnsigned?kIe(e,t):RIe(e,t)}function LIe(e,t){var r=QC({encoding:t.offsetEncoding,data:t.offsets}),n=QC({encoding:t.dataEncoding,data:e}),i=t.stringData,a=new Array(r.length);a[0]="";for(var o=1,s=r.length;o<s;o++)a[o]=i.substring(r[o-1],r[o]);for(var u=0,l=new Array(n.length),o=0,s=n.length;o<s;o++)l[u++]=a[n[o]+1];return l}var NIe="0.3.0",Gd;(function(e){function t(n){var i;return n instanceof Int8Array?i=1:n instanceof Int16Array?i=2:n instanceof Int32Array?i=3:n instanceof Uint8Array?i=4:n instanceof Uint16Array?i=5:n instanceof Uint32Array?i=6:n instanceof Float32Array?i=32:n instanceof Float64Array?i=33:i=3,i}e.getDataType=t;function r(n){if(n instanceof Int8Array||n instanceof Int16Array||n instanceof Int32Array)return!0;for(var i=0,a=n.length;i<a;i++)if(i<0)return!1;return!0}e.isSignedIntegerDataType=r})(Gd||(Gd={}));function FIe(e,t,r){var n=1,i;for(i=0;i<t;i++){var a=n*e;if(Math.abs(Math.round(a)-a)<=r)return i;n*=10}return-1}function BIe(e,t){var r=Math.abs(e);return r<t?0:Math.floor(Math.log10(Math.abs(e)))+1}function UIe(e,t,r){for(var n=1,i=0,a=0,o=e.length;a<o;a++){if(n>=0){var s=FIe(e[a],t,r);s<0?n=-1:s>n&&(n=s)}var u=Math.abs(e[a]);if(u>r){var l=Math.floor(Math.log10(Math.abs(u)))+1;l>i&&(i=l)}}return{mantissaDigits:n,integerDigits:i}}function jIe(e){e=e.trim();var t=parseInt(e,10);return isNaN(t)?!1:t.toString()===e}function ZC(e){if(!isFinite(e))return 0;for(var t=1,r=0;Math.round(e*t)/t!==e;)t*=10,++r;return r}function $M(e,t){return parseFloat(e.toPrecision(t))}function XM(e){return $1.classify(e)}function zIe(e){return YM.classify(e)}var $1;(function(e){function t(h,v){return h>=0?Math.ceil((h+1)/v):Math.ceil((h+1)/(-v-1))}function r(h){for(var v=!1,p=0,m=h.length;p<m;p++)if(h[p]<0){v=!0;break}return v?{signed:v,limit8:127,limit16:32767}:{signed:v,limit8:255,limit16:65535}}function n(){return{pack8:0,pack16:0,count:0}}function i(h,v,p){var m=h.limit8,g=h.limit16;v.pack8+=t(p,m),v.pack16+=t(p,g),v.count+=1}function a(h,v){h.pack8+=t(v,127),h.pack16+=t(v,32767),h.count+=1}function o(h){return h.count*4<h.pack16*2?{length:h.count*4,elem:4}:h.pack16*2<h.pack8?{length:h.pack16*2,elem:2}:{length:h.pack8,elem:1}}function s(h,v){for(var p=n(),m=0,g=h.length;m<g;m++)i(v,p,h[m]);return E(E({},o(p)),{kind:"pack"})}function u(h,v){for(var p=n(),m=h[0],g=1,y=h.length;g<y;g++)a(p,h[g]-m),m=h[g];return E(E({},o(p)),{kind:"delta"})}function l(h,v){for(var p=n(),m=1,g=1,y=h.length;g<y;g++)h[g-1]!==h[g]?(i(v,p,h[g-1]),i(v,p,m),m=1):m++;return i(v,p,h[h.length-1]),i(v,p,m),E(E({},o(p)),{kind:"rle"})}function c(h,v){for(var p=n(),m=1,g=0,y=0,b=1,S=h.length;b<S;b++){var x=h[b]-g;y!==x?(a(p,y),a(p,m),m=1):m++,y=x,g=h[b]}return a(p,y),a(p,m),E(E({},o(p)),{kind:"delta-rle"})}function d(h){var v=r(h),p=[s(h,v),l(h,v),u(h),c(h)];return p.sort(function(m,g){return m.length-g.length}),p}e.getSize=d;function f(h){if(h.length<2)return mr.by(mr.byteArray);var v=d(h),p=v[0];switch(p.kind){case"pack":return mr.by(mr.integerPacking);case"rle":return mr.by(mr.runLength).and(mr.integerPacking);case"delta":return mr.by(mr.delta).and(mr.integerPacking);case"delta-rle":return mr.by(mr.delta).and(mr.runLength).and(mr.integerPacking)}throw new Error("should not happen :)")}e.classify=f})($1||($1={}));var YM;(function(e){var t=1e-6;function r(i){var a=4,o=UIe(i,a,t),s=o.mantissaDigits,u=o.integerDigits;if(s<0||s+u>10)return mr.by(mr.byteArray);if(s===0)return $1.classify(i);for(var l=n(s),c=new Int32Array(i.length),d=0,f=i.length;d<f;d++)c[d]=Math.round(l*i[d]);var h=$1.getSize(c),v=h[0],p=mr.by(mr.fixedPoint(l));switch(v.kind){case"pack":return p.and(mr.integerPacking);case"rle":return p.and(mr.runLength).and(mr.integerPacking);case"delta":return p.and(mr.delta).and(mr.integerPacking);case"delta-rle":return p.and(mr.delta).and(mr.runLength).and(mr.integerPacking)}throw new Error("should not happen :)")}e.classify=r;function n(i){for(var a=1,o=0;o<i;o++)a*=10;return a}})(YM||(YM={}));var FK=function(){function e(t){this.providers=t}return e.prototype.and=function(t){return new e(this.providers.concat([t]))},e.prototype.encode=function(t){for(var r=[],n=0,i=this.providers;n<i.length;n++){var a=i[n],o=a(t);if(!o.encodings.length)throw new Error("Encodings must be non-empty.");t=o.data;for(var s=0,u=o.encodings;s<u.length;s++){var l=u[s];r.push(l)}}if(!(t instanceof Uint8Array))throw new Error("The encoding must result in a Uint8Array. Fix your encoding chain.");return{encoding:r,data:t}},e}(),Xf;(function(e){function t(i){return new FK([i])}e.by=t;function r(i){for(var a=t(n(i[0])),o=1;o<i.length;o++)a=a.and(n(i[o]));return a}e.fromEncoding=r;function n(i){switch(i.kind){case"ByteArray":return mr.byteArray;case"FixedPoint":return mr.fixedPoint(i.factor);case"IntervalQuantization":return mr.intervalQuantizaiton(i.min,i.max,i.numSteps);case"RunLength":return mr.runLength;case"Delta":return mr.delta;case"IntegerPacking":return mr.integerPacking;case"StringArray":return mr.stringArray}}})(Xf||(Xf={}));var mr;(function(e){var t,r;function n(x){return new FK([x])}e.by=n;function i(x){return{encodings:[{kind:"ByteArray",type:4}],data:x}}function a(x){return{encodings:[{kind:"ByteArray",type:1}],data:new Uint8Array(x.buffer,x.byteOffset)}}var o=(t={},t[2]=function(x,C,w){x.setInt16(2*C,w,!0)},t[5]=function(x,C,w){x.setUint16(2*C,w,!0)},t[3]=function(x,C,w){x.setInt32(4*C,w,!0)},t[6]=function(x,C,w){x.setUint32(4*C,w,!0)},t[32]=function(x,C,w){x.setFloat32(4*C,w,!0)},t[33]=function(x,C,w){x.setFloat64(8*C,w,!0)},t),s=(r={},r[2]=2,r[5]=2,r[3]=4,r[6]=4,r[32]=4,r[33]=8,r);function u(x){var C=Gd.getDataType(x);if(C===1)return a(x);if(C===4)return i(x);for(var w=new Uint8Array(x.length*s[C]),A=o[C],M=new DataView(w.buffer),D=0,k=x.length;D<k;D++)A(M,D,x[D]);return{encodings:[{kind:"ByteArray",type:C}],data:w}}e.byteArray=u;function l(x,C){for(var w=Gd.getDataType(x),A=new Int32Array(x.length),M=0,D=x.length;M<D;M++)A[M]=Math.round(x[M]*C);return{encodings:[{kind:"FixedPoint",factor:C,srcType:w}],data:A}}function c(x){return function(C){return l(C,x)}}e.fixedPoint=c;function d(x,C,w,A,M){var D=Gd.getDataType(x);if(!x.length)return{encodings:[{kind:"IntervalQuantization",min:C,max:w,numSteps:A,srcType:D}],data:new Int32Array(0)};if(w<C){var k=C;C=w,w=k}for(var R=(w-C)/(A-1),L=new M(x.length),H=0,B=x.length;H<B;H++){var j=x[H];j<=C?L[H]=0:j>=w?L[H]=A-1:L[H]=Math.round((j-C)/R)|0}return{encodings:[{kind:"IntervalQuantization",min:C,max:w,numSteps:A,srcType:D}],data:L}}function f(x,C,w,A){return A===void 0&&(A=Int32Array),function(M){return d(M,x,C,w,A)}}e.intervalQuantizaiton=f;function h(x){var C=Gd.getDataType(x);if(C===void 0&&(x=new Int32Array(x),C=3),!x.length)return{encodings:[{kind:"RunLength",srcType:C,srcSize:0}],data:new Int32Array(0)};for(var w=2,A=1,M=x.length;A<M;A++)x[A-1]!==x[A]&&(w+=2);for(var D=new Int32Array(w),k=0,R=1,A=1,M=x.length;A<M;A++)x[A-1]!==x[A]?(D[k]=x[A-1],D[k+1]=R,R=1,k+=2):++R;return D[k]=x[x.length-1],D[k+1]=R,{encodings:[{kind:"RunLength",srcType:C,srcSize:x.length}],data:D}}e.runLength=h;function v(x){if(!Gd.isSignedIntegerDataType(x))throw new Error("Only signed integer types can be encoded using delta encoding.");var C=Gd.getDataType(x);if(C===void 0&&(x=new Int32Array(x),C=3),!x.length)return{encodings:[{kind:"Delta",origin:0,srcType:C}],data:new x.constructor(0)};var w=new x.constructor(x.length),A=x[0];w[0]=x[0];for(var M=1,D=x.length;M<D;M++)w[M]=x[M]-x[M-1];return w[0]=0,{encodings:[{kind:"Delta",origin:A,srcType:C}],data:w}}e.delta=v;function p(x){for(var C=0,w=x.length;C<w;C++)if(x[C]<0)return!0;return!1}function m(x,C){for(var w=-C-1,A=0,M=0,D=x.length;M<D;M++){var k=x[M];k===0?A+=1:k>0?(A+=Math.ceil(k/C),k%C===0&&(A+=1)):(A+=Math.ceil(k/w),k%w===0&&(A+=1))}return A}function g(x){var C=p(x),w=C?m(x,127):m(x,255),A=C?m(x,32767):m(x,65535);return x.length*4<A*2?{isSigned:C,size:x.length,bytesPerElement:4}:A*2<w?{isSigned:C,size:A,bytesPerElement:2}:{isSigned:C,size:w,bytesPerElement:1}}function y(x,C){for(var w=C.isSigned?C.bytesPerElement===1?127:32767:C.bytesPerElement===1?255:65535,A=-w-1,M=x.length,D=C.isSigned?C.bytesPerElement===1?new Int8Array(C.size):new Int16Array(C.size):C.bytesPerElement===1?new Uint8Array(C.size):new Uint16Array(C.size),k=0,R=0;R<M;R++){var L=x[R];if(L>=0)for(;L>=w;)D[k]=w,++k,L-=w;else for(;L<=A;)D[k]=A,++k,L-=A;D[k]=L,++k}var H=u(D);return{encodings:[{kind:"IntegerPacking",byteCount:C.bytesPerElement,isUnsigned:!C.isSigned,srcSize:M},H.encodings[0]],data:H.data}}function b(x){var C=g(x);return C.bytesPerElement===4?u(x):y(x,C)}e.integerPacking=b;function S(x){var C=Object.create(null),w=[],A=new Int32Array(x.length),M=qe.create(Int32Array,1,Math.min(1024,x.length<32?x.length+1:Math.round(x.length/8)+1));qe.add(M,0);for(var D=0,k=0,R=0,L=x;R<L.length;R++){var H=L[R];if(H==null){A[k++]=-1;continue}var B=C[H];B===void 0&&(D+=H.length,B=w.length,w[B]=H,C[H]=B,qe.add(M,D)),A[k++]=B}var j=qe.compact(M),Q=XM(j),G=Q.encode(j),W=XM(A),q=W.encode(A);return{encodings:[{kind:"StringArray",dataEncoding:q.encoding,stringData:w.join(""),offsetEncoding:G.encoding,offsets:G.data}],data:q.data}}e.stringArray=S})(mr||(mr={}));function VIe(e){var t=e.mask?QC(e.mask):void 0,r=QC(e.data),n=Ok(r),i=n?t?function(l){return t[l]===0?""+r[l]:""}:function(l){return""+r[l]}:t?function(l){return t[l]===0?r[l]:""}:function(l){return r[l]},a=n?function(l){return r[l]}:function(l){var c=r[l];return kf(c,0,c.length)},o=n?function(l){return r[l]}:function(l){var c=r[l];return gc(c,0,c.length)},s=t?function(l){return t[l]}:function(l){return 0},u=r.length;return{__array:r,binaryEncoding:e.data.encoding,isDefined:!0,rowCount:u,str:i,int:a,float:o,valueKind:s,areValuesEqual:function(l,c){return r[l]===r[c]},toStringArray:function(l){return Qi(u,i,l)},toIntArray:n?function(l){return NC(r,l)}:function(l){return Qi(u,a,l)},toFloatArray:n?function(l){return NC(r,l)}:function(l){return Qi(u,o,l)}}}function BK(e){return JC({buffer:e,offset:0,dataView:new DataView(e.buffer)})}function SP(e,t){for(var r={},n=0;n<t;n++){var i=JC(e);r[i]=JC(e)}return r}function CP(e,t){for(var r=new Uint8Array(t),n=e.offset,i=0;i<t;i++)r[i]=e.buffer[i+n];return e.offset+=t,r}function j2(e,t){var r=Gk(e.buffer,e.offset,t);return e.offset+=t,r}function _P(e,t){for(var r=new Array(t),n=0;n<t;n++)r[n]=JC(e);return r}function JC(e){var t=e.buffer[e.offset],r,n;if(!(t&128))return e.offset++,t;if((t&240)===128)return n=t&15,e.offset++,SP(e,n);if((t&240)===144)return n=t&15,e.offset++,_P(e,n);if((t&224)===160)return n=t&31,e.offset++,j2(e,n);if((t&224)===224)return r=e.dataView.getInt8(e.offset),e.offset++,r;switch(t){case 192:return e.offset++,null;case 194:return e.offset++,!1;case 195:return e.offset++,!0;case 196:return n=e.dataView.getUint8(e.offset+1),e.offset+=2,CP(e,n);case 197:return n=e.dataView.getUint16(e.offset+1),e.offset+=3,CP(e,n);case 198:return n=e.dataView.getUint32(e.offset+1),e.offset+=5,CP(e,n);case 202:return r=e.dataView.getFloat32(e.offset+1),e.offset+=5,r;case 203:return r=e.dataView.getFloat64(e.offset+1),e.offset+=9,r;case 204:return r=e.buffer[e.offset+1],e.offset+=2,r;case 205:return r=e.dataView.getUint16(e.offset+1),e.offset+=3,r;case 206:return r=e.dataView.getUint32(e.offset+1),e.offset+=5,r;case 208:return r=e.dataView.getInt8(e.offset+1),e.offset+=2,r;case 209:return r=e.dataView.getInt16(e.offset+1),e.offset+=3,r;case 210:return r=e.dataView.getInt32(e.offset+1),e.offset+=5,r;case 217:return n=e.dataView.getUint8(e.offset+1),e.offset+=2,j2(e,n);case 218:return n=e.dataView.getUint16(e.offset+1),e.offset+=3,j2(e,n);case 219:return n=e.dataView.getUint32(e.offset+1),e.offset+=5,j2(e,n);case 220:return n=e.dataView.getUint16(e.offset+1),e.offset+=3,_P(e,n);case 221:return n=e.dataView.getUint32(e.offset+1),e.offset+=5,_P(e,n);case 222:return n=e.dataView.getUint16(e.offset+1),e.offset+=3,SP(e,n);case 223:return n=e.dataView.getUint32(e.offset+1),e.offset+=5,SP(e,n)}throw new Error("Unknown type 0x"+t.toString(16))}function HIe(e,t){for(var r=0;r<2;r++)if(e[r]>t[r])return!1;return!0}function GIe(e){for(var t=Object.create(null),r=Object.create(null),n=0,i=e.columns;n<i.length;n++){var a=i[n];t[a.name]=a}return{rowCount:e.rowCount,name:e.name.substr(1),fieldNames:e.columns.map(function(o){return o.name}),getField:function(o){var s=t[o];if(s)return r[o]||(r[o]=VIe(s)),r[o]}}}function F7(e){var t=this;return We.create("Parse BinaryCIF",function(r){return ce(t,void 0,void 0,function(){var n,i,a;return de(this,function(o){n=[0,3];try{return i=BK(e),HIe(n,i.version.match(/(\d)\.(\d)\.\d/).slice(1).map(function(s){return+s}))?(a=DK(i.dataBlocks.map(function(s){for(var u=Object.create(null),l=0,c=s.categories;l<c.length;l++){var d=c[l];u[d.name.substr(1)]=GIe(d)}return hO(s.categories.map(function(f){return f.name.substr(1)}),u,s.header)})),[2,wn.success(a)]):[2,wn.error("Unsupported format version. Current "+i.version+", required "+n.join(".")+".")]}catch(s){return[2,wn.error(""+s)]}return[2]})})})}var Km;(function(e){function t(i){return i.replace(".","_").replace(/\[/,"_").replace(/(\[|\])/g,"")}e.canonical=t;function r(i,a){return t(i)===t(a)}e.equal=r;function n(i,a,o){o===void 0&&(o=!1);var s=""+i+(a?"."+a:"");return o?t(s):s}e.create=n})(Km||(Km={}));function qIe(e,t,r){for(var n={},i=0,a=t.blocks;i<a.length;i++){var o=a[i];n[o.header]=Zl(e,o,r)}return n}function Zl(e,t,r){return YIe(e,t,r)}function UK(e,t){return new jK(t,e,!0)}function WIe(e){switch(e.valueType){case"str":return function(t,r,n){return wP(e,t,t.str,t.toStringArray)};case"int":return function(t,r,n){return wP(e,t,t.int,t.toIntArray)};case"float":return function(t,r,n){return wP(e,t,t.float,t.toFloatArray)};case"list":throw new Error("Use createListColumn instead.");case"tensor":throw new Error("Use createTensorColumn instead.")}}function wP(e,t,r,n){return{schema:e,__array:t.__array,isDefined:t.isDefined,rowCount:t.rowCount,value:r,valueKind:t.valueKind,areValuesEqual:t.areValuesEqual,toArray:n}}function $Ie(e,t,r){var n=e.separator,i=e.itemParse,a=t.getField(r),o=a?function(u){return a.str(u).split(n).map(function(l){return i(l.trim())}).filter(function(l){return!!l})}:function(u){return[]},s=function(u){return Qi(t.rowCount,o,u)};return{schema:e,__array:void 0,isDefined:!!a,rowCount:t.rowCount,value:o,valueKind:a?a.valueKind:function(){return 1},areValuesEqual:function(u,l){return Xa(o(u),o(l))},toArray:s}}function XIe(e,t,r){var n=e.space,i=t.fieldNames.includes(r+"[0]")||t.fieldNames.includes(r+"[0][0]")||t.fieldNames.includes(r+"[0][0][0]"),a=i?0:1,o=t.fieldNames.includes(r+"_1")||t.fieldNames.includes(r+"_11")||t.fieldNames.includes(r+"_111")?"underscore":"brackets",s=X4e(r,n.rank,i,o),u=t.getField(s(a,a,a))||ve.Undefined(t.rowCount,e),l=function(d){return Y4e(t,n,d,s)},c=function(d){return Qi(t.rowCount,l,d)};return{schema:e,__array:void 0,isDefined:u.isDefined,rowCount:t.rowCount,value:l,valueKind:u.valueKind,areValuesEqual:function(d,f){return Pr.areEqualExact(l(d),l(f))},toArray:c}}var jK=function(){function e(t,r,n){this._isDefined=n;var i=Object.keys(r);this._rowCount=t.rowCount,this._columns=i,this._schema=r;for(var a=Object.create(null),o=function(d){Object.defineProperty(s,d,{get:function(){if(a[d])return a[d];var f=r[d];if(f.valueType==="list")a[d]=$Ie(f,t,d);else if(f.valueType==="tensor")a[d]=XIe(f,t,d);else{var h=WIe(f),v=t.getField(d);a[d]=v?h(v,t,d):ve.Undefined(t.rowCount,f)}return a[d]},enumerable:!0,configurable:!1})},s=this,u=0,l=i;u<l.length;u++){var c=l[u];o(c)}}return e}();function YIe(e,t,r){for(var n=Object.create(null),i=0,a=Object.keys(e);i<a.length;i++){var o=a[i];n[o]=ZIe(o,e[o],t,r)}return fM.ofTables(t.header,e,n)}function KIe(e){for(var t=Object.create(null),r=0,n=Object.keys(e.categories);r<n.length;r++)for(var i=n[r],a=0,o=e.categories[i].fieldNames;a<o.length;a++){var s=o[a],u=Km.create(i,s,!0);t[u]=e.categories[i].getField(s)}return t}function QIe(e,t,r,n){var i=Km.create(t,e),a=Km.canonical(i);if(a in r)return r[a];if(n&&i in n)for(var o=0,s=n[i];o<s.length;o++){var u=s[o],l=Km.canonical(u);if(l in r)return r[l]}}function ZIe(e,t,r,n){var i=r.categories[e];if(n){for(var a=KIe(r),o=Object.create(null),s=[],u=0,l=0,c=Object.keys(t);l<c.length;l++){var d=c[l],f=QIe(d,e,a,n);f&&(o[d]=f,s.push(d),u=f.rowCount)}i={rowCount:u,name:e,fieldNames:Ft([],s),getField:function(h){return o[h]}}}return new jK(i||sa.empty(e),t,!!i)}var Zg=ve.Schema,Tr=Zg.str,JIe=Zg.float,B7=Zg.List,Po=Zg.Aliased,O0=Zg.int,Vv=Zg.coord,eMe={chem_comp:{formula:Tr,formula_weight:JIe,id:Tr,mon_nstd_parent_comp_id:B7(",",function(e){return e}),name:Tr,one_letter_code:Tr,three_letter_code:Tr,type:Po(Tr),pdbx_synonyms:B7(";",function(e){return e}),pdbx_type:Tr,pdbx_ambiguous_flag:Tr,pdbx_replaced_by:Tr,pdbx_replaces:Tr,pdbx_formal_charge:O0,pdbx_model_coordinates_details:Tr,pdbx_model_coordinates_db_code:Tr,pdbx_ideal_coordinates_details:Tr,pdbx_ideal_coordinates_missing_flag:Po(Tr),pdbx_model_coordinates_missing_flag:Po(Tr),pdbx_initial_date:Tr,pdbx_modified_date:Tr,pdbx_release_status:Po(Tr),pdbx_processing_site:Po(Tr)},chem_comp_atom:{alt_atom_id:Tr,atom_id:Tr,charge:O0,model_Cartn_x:Vv,model_Cartn_y:Vv,model_Cartn_z:Vv,comp_id:Tr,type_symbol:Tr,pdbx_align:O0,pdbx_ordinal:O0,pdbx_model_Cartn_x_ideal:Vv,pdbx_model_Cartn_y_ideal:Vv,pdbx_model_Cartn_z_ideal:Vv,pdbx_stereo_config:Po(Tr),pdbx_aromatic_flag:Po(Tr),pdbx_leaving_atom_flag:Po(Tr)},chem_comp_bond:{atom_id_1:Tr,atom_id_2:Tr,comp_id:Tr,value_order:Po(Tr),pdbx_ordinal:O0,pdbx_stereo_config:Po(Tr),pdbx_aromatic_flag:Po(Tr)},pdbx_chem_comp_descriptor:{comp_id:Tr,descriptor:Tr,type:Po(Tr),program:Tr,program_version:Tr},pdbx_chem_comp_identifier:{comp_id:Tr,identifier:Tr,type:Po(Tr),program:Tr,program_version:Tr}},M3=ve.Schema,jt=M3.str,tMe=M3.float,za=M3.Aliased,os=M3.int,rMe={pdbx_reference_molecule:{prd_id:jt,formula_weight:tMe,formula:jt,type:za(jt),type_evidence_code:jt,class:za(jt),class_evidence_code:jt,name:jt,represent_as:za(jt),chem_comp_id:jt,compound_details:jt,description:jt,representative_PDB_id_code:jt,release_status:za(jt),replaces:jt,replaced_by:jt},pdbx_reference_entity_list:{prd_id:jt,ref_entity_id:jt,type:za(jt),details:jt,component_id:os},pdbx_reference_entity_nonpoly:{prd_id:jt,ref_entity_id:jt,name:jt,chem_comp_id:jt},pdbx_reference_entity_link:{link_id:os,prd_id:jt,details:jt,ref_entity_id_1:jt,ref_entity_id_2:jt,entity_seq_num_1:os,entity_seq_num_2:os,comp_id_1:jt,comp_id_2:jt,atom_id_1:jt,atom_id_2:jt,value_order:za(jt),component_1:os,component_2:os,link_class:za(jt)},pdbx_reference_entity_poly_link:{link_id:os,prd_id:jt,ref_entity_id:jt,component_id:os,entity_seq_num_1:os,entity_seq_num_2:os,comp_id_1:jt,comp_id_2:jt,atom_id_1:jt,atom_id_2:jt,value_order:za(jt)},pdbx_reference_entity_poly:{prd_id:jt,ref_entity_id:jt,type:za(jt),db_code:jt,db_name:jt},pdbx_reference_entity_poly_seq:{prd_id:jt,ref_entity_id:jt,mon_id:jt,parent_mon_id:jt,num:os,observed:za(jt),hetero:za(jt)},pdbx_reference_entity_sequence:{prd_id:jt,ref_entity_id:jt,type:za(jt),NRP_flag:za(jt),one_letter_codes:jt},pdbx_reference_entity_src_nat:{prd_id:jt,ref_entity_id:jt,ordinal:os,organism_scientific:jt,taxid:jt,db_code:jt,db_name:jt},pdbx_prd_audit:{prd_id:jt,date:jt,processing_site:za(jt),action_type:za(jt)}},zK=ve.Schema,pi=zK.str,nMe=zK.float,iMe={id:pi,description:pi},aMe={title:pi,datablock_id:pi,version:pi},oMe={version:pi,update:pi,revision:pi},sMe={id:pi,description:pi},uMe={id:pi,parent_id:pi,description:pi},lMe={code:pi,primitive_code:pi,construct:pi,detail:pi},cMe={code:pi,detail:pi},dMe={from_code:pi,to_code:pi,operator:pi,factor:nMe},fMe={datablock:iMe,dictionary:aMe,dictionary_history:oMe,sub_category:sMe,category_group_list:uMe,item_type_list:lMe,item_units_list:cMe,item_units_conversion:dMe},Mb=ve.Schema,Yu=Mb.str,z2=Mb.int,Bl=Mb.float,V2=Mb.Aliased,qd=Mb.Vector;V2(Yu),V2(Yu),V2(Yu),V2(Yu),qd(3),qd(3);var hMe={volume_data_3d_info:{name:Yu,axis_order:qd(3,z2),origin:qd(3),dimensions:qd(3),sample_rate:z2,sample_count:qd(3,z2),spacegroup_number:z2,spacegroup_cell_size:qd(3),spacegroup_cell_angles:qd(3),mean_source:Bl,mean_sampled:Bl,sigma_source:Bl,sigma_sampled:Bl,min_source:Bl,min_sampled:Bl,max_source:Bl,max_sampled:Bl},volume_data_3d:{values:Bl}},D3=ve.Schema,EP=D3.int,fn=D3.float,ln=D3.str,U7=D3.Matrix,pMe={cell:{formula_units_Z:EP,volume:fn,angle_alpha:fn,angle_beta:fn,angle_gamma:fn,length_a:fn,length_b:fn,length_c:fn},chemical:{melting_point:fn,name_common:ln,name_systematic:ln},chemical_formula:{moiety:ln,sum:ln,weight:fn},space_group:{crystal_system:ln,IT_number:EP,"name_H-M_full":ln},space_group_symop:{operation_xyz:ln},geom_bond:{atom_site_label_1:ln,atom_site_label_2:ln,distance:fn,publ_flag:ln,site_symmetry_1:ln,site_symmetry_2:ln,valence:fn},audit:{block_doi:ln},database_code:{COD:ln,CSD:ln,depnum_ccdc_archive:ln,depnum_ccdc_fiz:ln,ICSD:ln,MDF:ln,NBS:ln},atom_site:{adp_type:ln,calc_flag:ln,disorder_assembly:ln,disorder_group:ln,fract_x:fn,fract_y:fn,fract_z:fn,label:ln,occupancy:fn,refinement_flags:ln,site_symmetry_multiplicity:EP,type_symbol:ln,U_iso_or_equiv:fn},atom_site_aniso:{label:ln,U_11:fn,U:U7(3,3),U_11_su:fn,U_su:U7(3,3),U_12:fn,U_12_su:fn,U_13:fn,U_13_su:fn,U_22:fn,U_22_su:fn,U_23:fn,U_23_su:fn,U_33:fn,U_33_su:fn},atom_type:{description:ln,symbol:ln},atom_type_scat:{dispersion_imag:fn,dispersion_real:fn,source:ln}},vMe={"atom_site_aniso.U":["atom_site_anisotrop_U"],"atom_site_aniso.U_su":["atom_site_aniso_U_esd","atom_site_anisotrop_U_esd"],"space_group.IT_number":["symmetry_Int_Tables_number"],"space_group.name_H-M_full":["symmetry_space_group_name_H-M"],"space_group_symop.operation_xyz":["symmetry_equiv_pos_as_xyz"],"geom_bond.atom_site_label_1":["geom_bond_atom_site_id_1"],"geom_bond.atom_site_label_2":["geom_bond_atom_site_id_2"],"geom_bond.distance":["geom_bond_dist"],"atom_site.adp_type":["atom_site_thermal_displace_type"],"atom_site.label":["atom_site_id"],"atom_site.site_symmetry_multiplicity":["atom_site_symmetry_multiplicity"],"atom_site_aniso.label":["atom_site_anisotrop_id"],"atom_site_aniso.U_11":["atom_site_anisotrop_U_11"],"atom_site_aniso.U_11_su":["atom_site_aniso_U_11_esd","atom_site_anisotrop_U_11_esd"],"atom_site_aniso.U_12":["atom_site_anisotrop_U_12"],"atom_site_aniso.U_12_su":["atom_site_aniso_U_12_esd","atom_site_anisotrop_U_12_esd"],"atom_site_aniso.U_13":["atom_site_anisotrop_U_13"],"atom_site_aniso.U_13_su":["atom_site_aniso_U_13_esd","atom_site_anisotrop_U_13_esd"],"atom_site_aniso.U_22":["atom_site_anisotrop_U_22"],"atom_site_aniso.U_22_su":["atom_site_aniso_U_22_esd","atom_site_anisotrop_U_22_esd"],"atom_site_aniso.U_23":["atom_site_anisotrop_U_23"],"atom_site_aniso.U_23_su":["atom_site_aniso_U_23_esd","atom_site_anisotrop_U_23_esd"],"atom_site_aniso.U_33":["atom_site_anisotrop_U_33"],"atom_site_aniso.U_33_su":["atom_site_aniso_U_33_esd","atom_site_anisotrop_U_33_esd"]},Fc={parse:function(e){return typeof e=="string"?N7(e):F7(e)},parseText:N7,parseBinary:F7,toDatabaseCollection:qIe,toDatabase:Zl,schema:{mmCIF:function(e){return Zl(vr,e)},CCD:function(e){return Zl(eMe,e)},BIRD:function(e){return Zl(rMe,e)},dic:function(e){return Zl(fMe,e)},cifCore:function(e){return Zl(pMe,e,vMe)},densityServer:function(e){return Zl(hMe,e)}}},KM=function(){function e(t,r,n){this.operatorsProvider=n,this.id=t,this.details=r}return Object.defineProperty(e.prototype,"operatorGroups",{get:function(){return this._operators?this._operators:(this._operators=this.operatorsProvider(),this._operators)},enumerable:!1,configurable:!0}),e}();(function(e){function t(r,n,i){return new e(r,n,i)}e.create=t})(KM||(KM={}));var X1;(function(e){e.Default={assemblies:[],spacegroup:Du.ZeroP1,isNonStandardCrystalFrame:!1};function t(n,i){var a=i.toLocaleLowerCase(),o=si.Provider.get(n);return o?Lk(o.assemblies,function(s){return s.id.toLowerCase()===a}):void 0}e.findAssembly=t;function r(n){var i=n.spacegroup,a=i.cell,o=i.name,s=i.num,u=a.size,l=a.anglesInRadians,c=u[0].toFixed(2),d=u[1].toFixed(2),f=u[2].toFixed(2),h=mu(l[0]).toFixed(2),v=mu(l[1]).toFixed(2),p=mu(l[2]).toFixed(2),m=[];return m.push("Unit Cell <b>"+o+"</b> #"+s),m.push(c+"×"+d+"×"+f+" Å"),m.push("α="+h+"° β="+v+"° γ="+p+"°"),m.join(" | ")}e.getUnitcellLabel=r})(X1||(X1={}));function mMe(e,t,r){if(!e._rowCount)return[];for(var n=bMe(r),i=[],a=0;a<e._rowCount;a++)i[i.length]=gMe(e,t,a,n);return i}function gMe(e,t,r,n){for(var i=e.id.value(r),a=e.details.value(r),o=[],s=t.assembly_id,u=t.oper_expression,l=t.asym_id_list,c=0,d=t._rowCount;c<d;c++)s.value(c)===i&&(o[o.length]={assemblyId:i,expression:u.value(c),asymIds:l.value(c)});return KM.create(i,a,yMe(o,n))}function yMe(e,t){return function(){for(var r=[],n=0,i=0;i<e.length;i++){var a=e[i],o=CMe(a.expression),s=xMe(o),u=SMe(t,s,n,a.assemblyId),l=en.generators.atoms({chainTest:en.pred.and(en.pred.eq(function(c){return lt.unit.operator_name(c.element)},pn.DefaultName),en.pred.inSet(function(c){return lt.chain.label_asym_id(c.element)},a.asymIds))});r[r.length]={selector:l,operators:u},n+=u.length}return r}}function bMe(e){for(var t=e.id,r=e.matrix,n=e.vector,i=e._schema,a=new Map,o=0,s=e._rowCount;o<s;o++){var u=Pr.toMat4(ue(),i.matrix.space,r.value(o)),l=Pr.toVec3(_(),i.vector.space,n.value(o));ue.setTranslation(u,l),ue.setValue(u,3,3,1),a.set(t.value(o),u)}return a}function xMe(e){for(var t=[],r=[],n=0;n<e.length;n++)r[n]="";return VK(e,t,e.length-1,r),t}function VK(e,t,r,n){if(r<0){t[t.length]=n.slice(0);return}for(var i=e[r],a=i.length,o=0;o<a;o++)n[r]=i[o],VK(e,t,r-1,n)}function SMe(e,t,r,n){for(var i=[],a=r,o=0,s=t;o<s.length;o++){for(var u=s[o],l=ue.identity(),c=0;c<u.length;c++)ue.mul(l,l,e.get(u[c]));a++,i[i.length]=pn.create("ASM_"+a,l,{assembly:{id:n,operId:a,operList:u}})}return i}function CMe(e){for(var t=/\(?([^\(\)]+)\)?]*/g,r=[],n=[],i;i=t.exec(e);)r[r.length]=i[1];return r.forEach(function(a){var o=[];a.split(",").forEach(function(s){var u=s.indexOf("-");if(u>0)for(var l=parseInt(s.substring(0,u)),c=parseInt(s.substr(u+1)),d=l;d<=c;d++)o[o.length]=d.toString();else o[o.length]=s.trim()}),n[n.length]=o}),n}var si;(function(e){e.Descriptor={name:"model_symmetry"},e.Provider=Mu.create(e.Descriptor);function t(n){var i=mMe(n.pdbx_struct_assembly,n.pdbx_struct_assembly_gen,n.pdbx_struct_oper_list),a=EMe(n.symmetry,n.cell),o=_Me(n.atom_sites);return{assemblies:i,spacegroup:a,isNonStandardCrystalFrame:o,ncsOperators:AMe(n.struct_ncs_oper)}}e.fromData=t;function r(n,i){var a=xo.create("P 1",n,i),o=Du.create(a);return{assemblies:[],spacegroup:o,isNonStandardCrystalFrame:!1}}e.fromCell=r})(si||(si={}));function _Me(e,t){return e._rowCount===0,!1}function wMe(e){var t=e.Int_Tables_number.value(0),r=e["space_group_name_H-M"].value(0);return e.Int_Tables_number.isDefined?e["space_group_name_H-M"].isDefined?r:t:r}function EMe(e,t){if(e._rowCount===0||t._rowCount===0)return Du.ZeroP1;var r=wMe(e),n=xo.create(r,_.create(t.length_a.value(0),t.length_b.value(0),t.length_c.value(0)),_.scale(_.zero(),_.create(t.angle_alpha.value(0),t.angle_beta.value(0),t.angle_gamma.value(0)),Math.PI/180));return Du.create(n)}function AMe(e){if(e._rowCount!==0){for(var t=e.id,r=e.matrix,n=e.vector,i=vr.struct_ncs_oper.matrix.space,a=vr.struct_ncs_oper.vector.space,o=[],s=0;s<e._rowCount;s++){var u=Pr.toMat3(zn(),i,r.value(s)),l=Pr.toVec3(_(),a,n.value(s));if(pn.checkIfRotationAndTranslation(u,l)&&!(e.code.value(s)==="given"&&!zn.isIdentity(u)&&!_.isZero(l))){var c=t.value(s);o[o.length]=pn.ofRotationAndOffset("ncs_"+c,u,l,c)}}return o}}function HK(e,t,r,n){return{type:e,key:t,elements:r,getIndex:n}}var Y1;(function(e){e.Descriptor={name:"model_secondary_structure"},e.Provider=Mu.create(e.Descriptor);function t(r,n,i){var a=new Map,o=[{kind:"none"}],s=PMe(r,n);TMe(r,s,a,o),IMe(n,s,a,r._rowCount,o);var u=i.residues._rowCount,l=function(d){return d},c={type:new Int32Array(u),key:new Int32Array(u),elements:o};return a.size>0&&DMe(i,s,a,c),HK(c.type,c.key,c.elements,l)}e.fromStruct=t})(Y1||(Y1={}));function PMe(e,t){if(e._rowCount>0){if(e.beg_label_seq_id.valueKind(0)!==0||e.end_label_seq_id.valueKind(0)!==0)return"auth"}else if(t&&(t.beg_label_seq_id.valueKind(0)!==0||t.end_label_seq_id.valueKind(0)!==0))return"auth";return"label"}function TMe(e,t,r,n){if(e._rowCount)for(var i=e.beg_label_asym_id,a=e.beg_label_seq_id,o=e.beg_auth_seq_id,s=e.pdbx_beg_PDB_ins_code,u=e.end_label_seq_id,l=e.end_auth_seq_id,c=e.pdbx_end_PDB_ins_code,d=e.pdbx_PDB_helix_class,f=e.conf_type_id,h=e.details,v=t==="label"?a:o,p=t==="label"?u:l,m=0,g=e._rowCount;m<g;m++){var y=Lr.create(d.valueKind(m)===0?Lr.SecondaryStructurePdb[d.value(m)]:f.valueKind(m)===0?Lr.SecondaryStructureMmcif[f.value(m)]:536870912),b={kind:"helix",flags:y,type_id:f.valueKind(m)===0?f.value(m):"HELIX_P",helix_class:d.value(m),details:h.valueKind(m)===0?h.value(m):void 0},S={startSeqId:v.value(m),startInsCode:s.value(m),endSeqId:p.value(m),endInsCode:c.value(m),type:y,key:n.length};n[n.length]=b;var x=i.value(m);if(r.has(x)){var C=r.get(x);C.has(S.startSeqId)?C.get(S.startSeqId).push(S):C.set(S.startSeqId,[S])}else r.set(x,new Map([[S.startSeqId,[S]]]))}}function IMe(e,t,r,n,i){if(e._rowCount)for(var a=e.beg_label_asym_id,o=e.beg_label_seq_id,s=e.beg_auth_seq_id,u=e.pdbx_beg_PDB_ins_code,l=e.end_label_seq_id,c=e.end_auth_seq_id,d=e.pdbx_end_PDB_ins_code,f=e.sheet_id,h=t==="label"?o:s,v=t==="label"?l:c,p=new Map,m=n+1,g=0,y=e._rowCount;g<y;g++){var b=f.value(g),S=void 0;p.has(b)?S=p.get(b):(S=m++,p.set(b,S));var x=Lr.create(8388612),C={kind:"sheet",flags:x,sheet_id:b,symmetry:void 0},w={startSeqId:h.value(g),startInsCode:u.value(g),endSeqId:v.value(g),endInsCode:d.value(g),type:x,key:i.length};i[i.length]=C;var A=a.value(g);if(r.has(A)){var M=r.get(A);M.has(w.startSeqId)?M.get(w.startSeqId).push(w):M.set(w.startSeqId,[w])}else r.set(A,new Map([[w.startSeqId,[w]]]))}}function MMe(e,t,r,n,i,a){for(var o=e.residues,s=o.auth_seq_id,u=o.label_seq_id,l=o.pdbx_PDB_ins_code,c=r.endSeqId,d=r.endInsCode,f=r.key,h=r.type,v=t==="label"?u:s,p=n;p<i;){var m=v.value(p);if(a.type[p]=h,a.key[p]=f,m>c||m===c&&l.value(p)===d)break;p++}}function DMe(e,t,r,n){for(var i=e.chainAtomSegments.count,a=e.chains.label_asym_id,o=e.residues,s=o.auth_seq_id,u=o.label_seq_id,l=o.pdbx_PDB_ins_code,c=t==="label"?u:s,d=0;d<i;d++){var f=Gp.chainStartResidueIndex(e,d),h=Gp.chainEndResidueIndexExcl(e,d),v=a.value(d);if(r.has(v))for(var p=r.get(v),m=f;m<h;m++){var g=c.value(m);if(p.has(g))for(var y=p.get(g),b=0,S=y;b<S.length;b++){var x=S[b],C=l.value(m);x.startInsCode===C&&MMe(e,t,x,m,h,n)}}}}var QM;(function(e){function t(s,u,l){return{name:s,type:0,value:u,valueKind:l&&l.valueKind,defaultFormat:l&&l.encoder?{encoder:l.encoder}:void 0,shouldInclude:l&&l.shouldInclude}}e.str=t;function r(s,u,l){return{name:s,type:1,value:u,valueKind:l&&l.valueKind,defaultFormat:l?{encoder:l.encoder,typedArray:l.typedArray}:void 0,shouldInclude:l&&l.shouldInclude}}e.int=r;function n(s,u,l){return{name:s,type:2,value:u,valueKind:l&&l.valueKind,defaultFormat:l?{encoder:l.encoder,typedArray:l.typedArray,digitCount:typeof l.digitCount<"u"?l.digitCount:void 0}:void 0,shouldInclude:l&&l.shouldInclude}}e.float=n;function i(s){return r(s,function(u,l,c){return c+1},{typedArray:Int32Array,encoder:mr.by(mr.delta).and(mr.runLength).and(mr.integerPacking)})}e.index=i;var a=function(){function s(){this.fields=[]}return s.prototype.index=function(u){return this.fields.push(e.index(u)),this},s.prototype.str=function(u,l,c){return this.fields.push(e.str(u,l,c)),this},s.prototype.int=function(u,l,c){return this.fields.push(e.int(u,l,c)),this},s.prototype.vec=function(u,l,c){for(var d=0;d<l.length;d++)this.fields.push(e.int(u+"["+(d+1)+"]",l[d],c));return this},s.prototype.float=function(u,l,c){return this.fields.push(e.float(u,l,c)),this},s.prototype.many=function(u){for(var l=0;l<u.length;l++)this.fields.push(u[l]);return this},s.prototype.add=function(u){return this.fields.push(u),this},s.prototype.getFields=function(){return this.fields},s}();e.Builder=a;function o(){return new a}e.build=o})(QM||(QM={}));var Uo;(function(e){e.Empty={fields:[],source:[]};function t(n){for(var i=[],a=[],o=[],s=[],u=0,l=n.split(/[\r\n]+/);u<l.length;u++){var c=l[u];if(c=c.trim(),c.length!==0){var d=/^!/.test(c);d&&(c=c.substr(1));var f=c.split(/\./),h=f[1],v=d?h?s:a:h?o:i;v[v.length]=c,h&&!i.includes(f[0])&&(i[i.length]=f[0])}}var p=o.map(function(m){return m.split(".")[0]});return{includeCategory:function(m){return a.includes(m)?!1:i.length<=0||i.indexOf(m)!==-1},includeField:function(m,g){var y=m+"."+g;return s.includes(y)?!1:!p.includes(m)||o.includes(y)}}}e.filterOf=t,e.DefaultFilter={includeCategory:function(n){return!0},includeField:function(n,i){return!0}},e.DefaultFormatter={getFormat:function(n,i){}};function r(n,i){return i?{fields:j7(n._schema),source:[{data:n,rowCount:i.length,keys:function(){return UC.Array(i)}}]}:{fields:j7(n._schema),source:[{data:n,rowCount:n._rowCount}]}}e.ofTable=r})(Uo||(Uo={}));var ZM;(function(e){function t(n,i,a){n.startDataBlock(i);for(var o=function(c){n.writeCategory({name:c,instance:function(){return Uo.ofTable(a[c])}})},s=0,u=a._tableNames;s<u.length;s++){var l=u[s];o(l)}}e.writeDatabase=t;function r(n,i){for(var a=0,o=Object.keys(i);a<o.length;a++){var s=o[a];t(n,s,i[s])}}e.writeDatabaseCollection=r})(ZM||(ZM={}));function AP(e){return function(t,r){return r[e].value(t)}}function RMe(e){return function(t,r){return r[e].value(t).join(r[e].schema.separator)}}function PP(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];return function(n,i){var a;return(a=i[e].schema.space).get.apply(a,Ft([i[e].value(n)],t))}}function my(e){return function(t,r){return r[e].valueKind(t)}}function kMe(e,t){var r=[],n=2,i=my(e);if(t.rank===1)for(var a=t.dimensions[0],o=0;o<a;o++){var s=e+"["+(o+1)+"]";r.push({name:s,type:n,value:PP(e,o),valueKind:i})}else if(t.rank===2)for(var a=t.dimensions[0],u=t.dimensions[1],o=0;o<a;o++)for(var l=0;l<u;l++){var c=e+"["+(o+1)+"]["+(l+1)+"]";r.push({name:c,type:n,value:PP(e,o,l),valueKind:i})}else if(t.rank===3)for(var d=t.dimensions[0],f=t.dimensions[1],h=t.dimensions[2],o=0;o<d;o++)for(var l=0;l<f;l++)for(var v=0;v<h;v++){var p=e+"["+(o+1)+"]["+(l+1)+"]["+(v+1)+"]";r.push({name:p,type:n,value:PP(e,o,l,v),valueKind:i})}else throw new Error("Tensors with rank > 3 or rank 0 are currently not supported.");return r}function j7(e){for(var t=[],r=0,n=Object.keys(e);r<n.length;r++){var i=n[r],a=e[i];if(a.valueType==="int")t.push({name:i,type:1,value:AP(i),valueKind:my(i)});else if(a.valueType==="float")t.push({name:i,type:2,value:AP(i),valueKind:my(i)});else if(a.valueType==="str")t.push({name:i,type:0,value:AP(i),valueKind:my(i)});else if(a.valueType==="list")t.push({name:i,type:0,value:RMe(i),valueKind:my(i)});else if(a.valueType==="tensor")t.push.apply(t,kMe(i,a.space));else throw new Error("Unknown valueType "+a.valueType)}return t}function OMe(e){return e.defaultFormat&&typeof e.defaultFormat.digitCount<"u"?Math.max(0,Math.min(e.defaultFormat.digitCount,16)):6}function vO(e){return e.fields.some(function(t){return!!t.shouldInclude})?e.fields.filter(function(t){return!t.shouldInclude||e.source.some(function(r){return t.shouldInclude(r.data)})}):e.fields}function GK(e,t){var r=e.instance(t),n=r.source.filter(function(o){return o.rowCount>0});if(!n.length)return{instance:r,rowCount:0,source:[]};var i=n.reduce(function(o,s){return o+s.rowCount},0),a=n.map(function(o){return{data:o.data,keys:function(){return o.keys?o.keys():UC.Range(0,o.rowCount-1)},rowCount:o.rowCount}});return{instance:r,rowCount:i,source:a}}var LMe=function(){function e(){this.builder=Rr.create(),this.encoded=!1,this.dataBlockCreated=!1,this.filter=Uo.DefaultFilter,this.formatter=Uo.DefaultFormatter,this.isBinary=!1,this.binaryEncodingProvider=void 0}return e.prototype.setFilter=function(t){this.filter=t||Uo.DefaultFilter},e.prototype.isCategoryIncluded=function(t){return this.filter.includeCategory(t)},e.prototype.setFormatter=function(t){this.formatter=t||Uo.DefaultFormatter},e.prototype.startDataBlock=function(t){this.dataBlockCreated=!0,Rr.write(this.builder,"data_"+(t||"").replace(/[ \n\t]/g,"").toUpperCase()+`
#
`)},e.prototype.writeCategory=function(t,r,n){if(this.encoded)throw new Error("The writer contents have already been encoded, no more writing.");if(!this.dataBlockCreated)throw new Error("No data block created.");if(!(!(n!=null&&n.ignoreFilter)&&!this.filter.includeCategory(t.name))){var i=GK(t,r),a=i.instance,o=i.rowCount,s=i.source;o&&(o===1?NMe(t,a,s,this.builder,this.filter,this.formatter):FMe(t,a,s,this.builder,this.filter,this.formatter))}},e.prototype.encode=function(){this.encoded=!0},e.prototype.writeTo=function(t){for(var r=Rr.getChunks(this.builder),n=0,i=r.length;n<i;n++)t.writeString(r[n])},e.prototype.getSize=function(){return Rr.getSize(this.builder)},e.prototype.getData=function(){return Rr.getString(this.builder)},e}();function qK(e,t,r,n,i,a){var o=n.valueKind,s=o?o(r,t):0;if(s!==0)s===1?zMe(e):VMe(e);else{var u=n.value(r,t,a),l=n.type;if(l===0)return BMe(u)?(pS(e,u),!0):HMe(e,u);l===1?UMe(e,u):jMe(e,u,i)}return!1}function WK(e,t,r){for(var n=[],i=0,a=t;i<a.length;i++){var o=a[i],s=r.getFormat(e,o.name);s&&typeof s.digitCount<"u"?n[n.length]=o.type===2?Math.pow(10,Math.max(0,Math.min(s.digitCount,15))):0:n[n.length]=o.type===2?Math.pow(10,OMe(o)):0}return n}function NMe(e,t,r,n,i,a){var o=vO(t),s=r[0],u=s.data,l=o.reduce(function(m,g){return i.includeField(e.name,g.name)?Math.max(m,g.name.length):0},0);if(l!==0){l+=e.name.length+6;for(var c=s.keys(),d=c.move(),f=WK(e.name,t.fields,a),h=0;h<o.length;h++){var v=o[h];if(i.includeField(e.name,v.name)){Rr.writePadRight(n,"_"+e.name+"."+v.name,l);var p=qK(n,u,d,v,f[h],0);p||Rr.newline(n)}}Rr.write(n,`#
`)}}function FMe(e,t,r,n,i,a){var o=vO(t),s=i===Uo.DefaultFilter?o:o.filter(function(b){return i.includeField(e.name,b.name)}),u=s.length;if(u!==0){var l=WK(e.name,s,a);z7(n,"loop_");for(var c=0;c<u;c++)z7(n,"_"+e.name+"."+s[c].name);for(var d=0,f=0;f<r.length;f++){var h=r[f],v=h.data;if(h.rowCount!==0)for(var p=h.keys();p.hasNext;){for(var m=p.move(),g=!1,y=0;y<u;y++)g=qK(n,v,m,s[y],l[y],d);g||Rr.newline(n),d++}}Rr.write(n,`#
`)}}function BMe(e){return typeof e=="string"&&e.indexOf(`
`)>=0}function z7(e,t){Rr.write(e,t),Rr.newline(e)}function UMe(e,t){Rr.writeInteger(e,t),Rr.whitespace1(e)}function jMe(e,t,r){Rr.writeFloat(e,t,r),Rr.whitespace1(e)}function zMe(e){Rr.writeSafe(e,". ")}function VMe(e){Rr.writeSafe(e,"? ")}function HMe(e,t){if(!t)return Rr.writeSafe(e,". "),!1;for(var r=t.charCodeAt(0),n=!1,i=0,a=!1,o=!1,s=0,u=t.length-1;s<=u;s++){var l=t.charCodeAt(s);switch(l){case 9:n=!0;break;case 10:return pS(e,t),!0;case 32:n=!0;break;case 34:if(s&&s===u)break;if(a)return pS(e,t),!0;o=!0,n=!0,i=0;break;case 39:if(s&&s===u)break;if(o)return pS(e,t),!0;a=!0,n=!0,i=1;break}}return!n&&(r===35||r===36||r===59||r===91||r===93||r===95)&&(n=!0),n?(Rr.writeSafe(e,i?'"':"'"),Rr.writeSafe(e,t),Rr.writeSafe(e,i?'" ':"' ")):(Rr.writeSafe(e,t),Rr.writeSafe(e," ")),!1}function pS(e,t){Rr.writeSafe(e,`
;`+t),Rr.writeSafe(e,`
;
`)}function GMe(e){var t=new ArrayBuffer(vS(e)),r=new DataView(t),n=new Uint8Array(t);return mS(e,r,n,0),n}function vS(e){var t=typeof e;if(t==="string"){var r=zC(e);if(r<32)return 1+r;if(r<256)return 2+r;if(r<65536)return 3+r;if(r<4294967296)return 5+r}if(e instanceof Uint8Array){var n=e.byteLength;if(n<256)return 2+n;if(n<65536)return 3+n;if(n<4294967296)return 5+n}if(t==="number"){if(Math.floor(e)!==e)return 9;if(e>=0){if(e<128)return 1;if(e<256)return 2;if(e<65536)return 3;if(e<4294967296)return 5;throw new Error("Number too big 0x"+e.toString(16))}if(e>=-32)return 1;if(e>=-128)return 2;if(e>=-32768)return 3;if(e>=-2147483648)return 5;throw new Error("Number too small -0x"+e.toString(16).substr(1))}if(t==="boolean"||e===null||e===void 0)return 1;if(t==="object"){var i,a=0;if(Array.isArray(e)){i=e.length;for(var o=0;o<i;o++)a+=vS(e[o])}else{var s=Object.keys(e);i=s.length;for(var o=0;o<i;o++){var u=s[o];a+=vS(u)+vS(e[u])}}if(i<16)return 1+a;if(i<65536)return 3+a;if(i<4294967296)return 5+a;throw new Error("Array or object too long 0x"+i.toString(16))}throw new Error("Unknown type "+t)}function mS(e,t,r,n){var i=typeof e;if(i==="string"){var a=zC(e);if(a<32)return t.setUint8(n,a|160),wm(r,n+1,e),1+a;if(a<256)return t.setUint8(n,217),t.setUint8(n+1,a),wm(r,n+2,e),2+a;if(a<65536)return t.setUint8(n,218),t.setUint16(n+1,a),wm(r,n+3,e),3+a;if(a<4294967296)return t.setUint8(n,219),t.setUint32(n+1,a),wm(r,n+5,e),5+a}if(e instanceof Uint8Array){var o=e.byteLength,s=new Uint8Array(t.buffer);if(o<256)return t.setUint8(n,196),t.setUint8(n+1,o),s.set(e,n+2),2+o;if(o<65536)return t.setUint8(n,197),t.setUint16(n+1,o),s.set(e,n+3),3+o;if(o<4294967296)return t.setUint8(n,198),t.setUint32(n+1,o),s.set(e,n+5),5+o}if(i==="number"){if(!isFinite(e))throw new Error("Number not finite: "+e);if(Math.floor(e)!==e)return t.setUint8(n,203),t.setFloat64(n+1,e),9;if(e>=0){if(e<128)return t.setUint8(n,e),1;if(e<256)return t.setUint8(n,204),t.setUint8(n+1,e),2;if(e<65536)return t.setUint8(n,205),t.setUint16(n+1,e),3;if(e<4294967296)return t.setUint8(n,206),t.setUint32(n+1,e),5;throw new Error("Number too big 0x"+e.toString(16))}if(e>=-32)return t.setInt8(n,e),1;if(e>=-128)return t.setUint8(n,208),t.setInt8(n+1,e),2;if(e>=-32768)return t.setUint8(n,209),t.setInt16(n+1,e),3;if(e>=-2147483648)return t.setUint8(n,210),t.setInt32(n+1,e),5;throw new Error("Number too small -0x"+(-e).toString(16).substr(1))}if(e==null)return t.setUint8(n,192),1;if(i==="boolean")return t.setUint8(n,e?195:194),1;if(i==="object"){var u,l=0,c=Array.isArray(e),d=void 0;if(c?u=e.length:(d=Object.keys(e),u=d.length),u<16?(t.setUint8(n,u|(c?144:128)),l=1):u<65536?(t.setUint8(n,c?220:222),t.setUint16(n+1,u),l=3):u<4294967296&&(t.setUint8(n,c?221:223),t.setUint32(n+1,u),l=5),c)for(var f=0;f<u;f++)l+=mS(e[f],t,r,n+l);else for(var f=0,h=d.length;f<h;f++){var v=d[f];l+=mS(v,t,r,n+l),l+=mS(e[v],t,r,n+l)}return l}throw new Error("Unknown type "+i)}var qMe=function(){function e(t,r,n){this.autoClassify=n,this.dataBlocks=[],this.filter=Uo.DefaultFilter,this.formatter=Uo.DefaultFormatter,this.isBinary=!0,this.binaryEncodingProvider=void 0,this.binaryEncodingProvider=r,this.data={encoder:t,version:NIe,dataBlocks:this.dataBlocks}}return e.prototype.setFilter=function(t){this.filter=t||Uo.DefaultFilter},e.prototype.isCategoryIncluded=function(t){return this.filter.includeCategory(t)},e.prototype.setFormatter=function(t){this.formatter=t||Uo.DefaultFormatter},e.prototype.startDataBlock=function(t){this.dataBlocks.push({header:(t||"").replace(/[ \n\t]/g,"").toUpperCase(),categories:[]})},e.prototype.writeCategory=function(t,r,n){if(!this.data)throw new Error("The writer contents have already been encoded, no more writing.");if(!this.dataBlocks.length)throw new Error("No data block created.");if(!(!(n!=null&&n.ignoreFilter)&&!this.filter.includeCategory(t.name))){var i=GK(t,r),a=i.instance,o=i.rowCount,s=i.source;if(o){for(var u={name:"_"+t.name,columns:[],rowCount:o},l=vO(a),c=0,d=l;c<d.length;c++){var f=d[c];if(this.filter.includeField(t.name,f.name)){var h=this.formatter.getFormat(t.name,f.name);u.columns.push(KMe(t.name,f,s,o,h,this.binaryEncodingProvider,this.autoClassify))}}u.columns.length&&this.dataBlocks[this.dataBlocks.length-1].categories.push(u)}}},e.prototype.encode=function(){this.encodedData||(this.encodedData=GMe(this.data),this.data=null,this.dataBlocks=null)},e.prototype.writeTo=function(t){t.writeBinary(this.encodedData)},e.prototype.getData=function(){return this.encode(),this.encodedData},e.prototype.getSize=function(){return this.encodedData.length},e}();function WMe(e,t){return t&&t.typedArray?t.typedArray:e.defaultFormat&&e.defaultFormat.typedArray?e.defaultFormat.typedArray:e.type===0?Array:e.type===1?Int32Array:Float64Array}function $Me(e){return e===0?Xf.by(mr.stringArray):Xf.by(mr.byteArray)}function XMe(e,t,r,n){return r&&r.encoder?r.encoder:t.defaultFormat&&t.defaultFormat.encoder?t.defaultFormat.encoder:n?n.get(e,t.name):void 0}function YMe(e,t){return e===0?Xf.by(mr.stringArray):e===1?XM(t):zIe(t)}function KMe(e,t,r,n,i,a,o){var s=QMe(t,WMe(t,i),n,r),u=s.array,l=s.allPresent,c=s.mask,d=XMe(e,t,i,a);d||(o?d=YMe(t.type,u):d=$Me(t.type));var f=d.encode(u),h=void 0;if(!l){var v=Xf.by(mr.runLength).and(mr.byteArray).encode(c);v.data.length<c.length?h=v:h=Xf.by(mr.byteArray).encode(c)}return{name:t.name,data:f,mask:h}}function QMe(e,t,r,n){for(var i=e.type===0,a=new t(r),o=new Uint8Array(r),s=e.valueKind,u=e.value,l=!0,c=0,d=0;d<n.length;d++)for(var f=n[d].data,h=n[d].keys();h.hasNext;){var v=h.move(),p=s?s(v,f):0;p!==0?(o[c]=p,i&&(a[c]=""),l=!1):(o[c]=0,a[c]=u(v,f,c)),c++}return{array:a,allPresent:l,mask:o}}var Di;(function(e){e.Encoder=ZM,e.Category=Uo,e.Field=QM,e.Encoding=mr;function t(u){var l=u||{},c=l.binary,d=c===void 0?!1:c,f=l.encoderName,h=f===void 0?"mol*":f;return d?new qMe(h,u?u.binaryEncodingPovider:void 0,u?!!u.binaryAutoClassifyEncoding:!1):new LMe}e.createEncoder=t;function r(){return e.Field.build()}e.fields=r;var n=e.Encoding;e.Encodings={deltaRLE:n.by(n.delta).and(n.runLength).and(n.integerPacking),fixedPoint2:n.by(n.fixedPoint(100)).and(n.delta).and(n.integerPacking),fixedPoint3:n.by(n.fixedPoint(1e3)).and(n.delta).and(n.integerPacking)};function i(u,l){return{fields:u,source:[l]}}e.categoryInstance=i;function a(u){return{get:function(l,c){var d=u.categories[l];if(d){var f=d.getField(c);return f&&f.binaryEncoding?Xf.fromEncoding(f.binaryEncoding):void 0}}}}e.createEncodingProviderFromCifFrame=a;function o(u){return{get:function(l,c){for(var d=0;d<u.length;d++){var f=u[d];if(f.categoryName===l&&f.columnName===c)return s(f)}}}}e.createEncodingProviderFromJsonConfig=o;function s(u){var l=u.precision;if(l!==void 0){var c=Math.pow(10,l),d=n.by(n.fixedPoint(c));switch(u.encoding){case"pack":return d.and(n.integerPacking);case"rle":return d.and(n.runLength).and(n.integerPacking);case"delta":return d.and(n.delta).and(n.integerPacking);case"delta-rle":return d.and(n.delta).and(n.runLength).and(n.integerPacking)}}else switch(u.encoding){case"pack":return n.by(n.integerPacking);case"rle":return n.by(n.runLength).and(n.integerPacking);case"delta":return n.by(n.delta).and(n.integerPacking);case"delta-rle":return n.by(n.delta).and(n.runLength).and(n.integerPacking)}throw new Error("cannot be reached")}})(Di||(Di={}));var ZMe={U:vr.atom_site_anisotrop.U,U_esd:vr.atom_site_anisotrop.U_esd},wl;(function(e){e.Schema=ZMe,e.Descriptor={name:"atom_site_anisotrop",cifExport:{prefix:"",categories:[{name:"atom_site_anisotrop",instance:function(n){var i=e.Provider.get(n.firstModel);return!i||!tn.is(n.firstModel.sourceData)?Di.Category.Empty:Di.Category.ofTable(n.firstModel.sourceData.data.db.atom_site_anisotrop)}}]}},e.Provider=Mu.create(e.Descriptor);function t(n,i){var a=new Int32Array(n.rowCount);a.fill(-1);for(var o=0,s=n.rowCount;o<s;o++)a[n.value(o)]=o;var u=new Int32Array(n.rowCount);u.fill(-1);for(var o=0,s=i.rowCount;o<s;++o){var l=a[i.value(o)];l!==-1&&(u[l]=o)}return u}e.getElementToAnsiotrop=t;function r(n,i){for(var a={},o=0,s=n.rowCount;o<s;o++)a[n.value(o)]=o;var u=new Int32Array(n.rowCount);u.fill(-1);for(var o=0,s=i.rowCount;o<s;++o){var l=a[i.value(o)];l!==void 0&&(u[l]=o)}return u}e.getElementToAnsiotropFromLabel=r})(wl||(wl={}));var K1;(function(e){e.Descriptor={name:"chem_comp_bond",cifExport:{prefix:"",categories:[{name:"chem_comp_bond",instance:function(i){var a=e.Provider.get(i.firstModel);if(!a)return Di.Category.Empty;var o=a.data;if(!o)return Di.Category.Empty;for(var s=i.structures[0].uniqueResidueNames,u=o.comp_id,l=o._rowCount,c=[],d=0;d<l;d++)s.has(u.value(d))&&(c[c.length]=d);return Di.Category.ofTable(o,c)}}]}},e.Provider=Mu.create(e.Descriptor);function t(i,a){return Xr.pick(a,vr.chem_comp_bond,function(o){return i.properties.chemicalComponentMap.has(a.comp_id.value(o))})}e.chemCompBondFromTable=t;function r(i){var a=new Map;function o(C){if(a.has(C))return a.get(C);var w=new n(C);return a.set(C,w),w}for(var s=i.comp_id,u=i.atom_id_1,l=i.atom_id_2,c=i.value_order,d=i.pdbx_aromatic_flag,f=i._rowCount,h=o(s.value(0)),v=0;v<f;v++){var p=s.value(v),m=u.value(v),g=l.value(v),y=c.value(v),b=d.value(v)==="Y";h.id!==p&&(h=o(p));var S=1,x=1;switch(b&&(S|=16),y.toLowerCase()){case"doub":case"delo":x=2;break;case"trip":x=3;break;case"quad":x=4;break}h.add(m,g,x,S)}return a}e.getEntriesFromChemCompBond=r;var n=function(){function i(a){this.id=a,this.map=new Map}return i.prototype.add=function(a,o,s,u,l){l===void 0&&(l=!0);var c=this.map.get(a);if(c!==void 0){var d=c.get(o);d===void 0&&c.set(o,{order:s,flags:u})}else{var f=new Map;f.set(o,{order:s,flags:u}),this.map.set(a,f)}l&&this.add(o,a,s,u,!1)},i}();e.Entry=n})(K1||(K1={}));var JMe=new Map([["HIS|CD2|CG",2],["HIS|CE1|ND1",2],["ARG|CZ|NH2",2],["PHE|CE1|CZ",2],["PHE|CD2|CE2",2],["PHE|CD1|CG",2],["TRP|CD1|CG",2],["TRP|CD2|CE2",2],["TRP|CE3|CZ3",2],["TRP|CH2|CZ2",2],["ASN|CG|OD1",2],["GLN|CD|OE1",2],["TYR|CD1|CG",2],["TYR|CD2|CE2",2],["TYR|CE1|CZ",2],["ASP|CG|OD1",2],["GLU|CD|OE1",2],["G|C8|N7",2],["G|C4|C5",2],["G|C2|N3",2],["G|C6|O6",2],["C|C4|N3",2],["C|C5|C6",2],["C|C2|O2",2],["A|C2|N3",2],["A|C6|N1",2],["A|C4|C5",2],["A|C8|N7",2],["U|C5|C6",2],["U|C2|O2",2],["U|C4|O4",2],["DG|C8|N7",2],["DG|C4|C5",2],["DG|C2|N3",2],["DG|C6|O6",2],["DC|C4|N3",2],["DC|C5|C6",2],["DC|C2|O2",2],["DA|C2|N3",2],["DA|C6|N1",2],["DA|C4|C5",2],["DA|C8|N7",2],["DT|C5|C6",2],["DT|C2|O2",2],["DT|C4|O4",2]]);function e5e(e,t,r){var n;return n=t<r?[t,r]:[r,t],t=n[0],r=n[1],E3.has(e)&&t==="C"&&r==="O"||T3.has(e)&&t==="OP1"&&r==="P"?2:JMe.get(e+"|"+t+"|"+r)||1}var t5e=new Map([["LYS|NZ|RET|C15",2]]);function $K(e,t,r,n){var i,a;return e>r&&(i=[r,e],e=i[0],r=i[1],a=[n,t],t=a[0],n=a[1]),t5e.get(e+"|"+t+"|"+r+"|"+n)||1}var El;(function(e){e.Descriptor={name:"struct_conn",cifExport:{prefix:"",categories:[{name:"struct_conn",instance:function(a){var o=e.Provider.get(a.firstModel);if(!o||o.entries.length===0)return Di.Category.Empty;for(var s=a.structures[0],u=[],l=0,c=o.entries;l<c.length;l++){var d=c[l];r(s,d.partnerA.atomIndex)&&r(s,d.partnerB.atomIndex)&&(u[u.length]=d.rowIndex)}return Di.Category.ofTable(o.data,u)}}]}},e.Provider=Mu.create(e.Descriptor);function t(a){var o=e.Provider.get(a);return!!o&&o.data.id.rowCount/a.atomicConformation.atomId.rowCount>.95}e.isExhaustive=t;function r(a,o){for(var s=a.units,u=0,l=s.length;u<l;u++)if(Je.indexOf(s[u].elements,o)>=0)return!0;return!1}function n(a){for(var o=new Map,s=0,u=a;s<u.length;s++){var l=u[s],c=l.partnerA.atomIndex,d=l.partnerB.atomIndex;o.has(c)?o.get(c).push(l):o.set(c,[l]),o.has(d)?o.get(d).push(l):o.set(d,[l])}return o}e.getAtomIndexFromEntries=n;function i(a,o){for(var s=a.conn_type_id,u=a.pdbx_dist_value,l=a.pdbx_value_order,c={label_asym_id:a.ptnr1_label_asym_id,label_seq_id:a.ptnr1_label_seq_id,auth_seq_id:a.ptnr1_auth_seq_id,label_atom_id:a.ptnr1_label_atom_id,label_alt_id:a.pdbx_ptnr1_label_alt_id,ins_code:a.pdbx_ptnr1_PDB_ins_code,symmetry:a.ptnr1_symmetry},d={label_asym_id:a.ptnr2_label_asym_id,label_seq_id:a.ptnr2_label_seq_id,auth_seq_id:a.ptnr2_auth_seq_id,label_atom_id:a.ptnr2_label_atom_id,label_alt_id:a.pdbx_ptnr2_label_alt_id,ins_code:a.pdbx_ptnr2_PDB_ins_code,symmetry:a.ptnr2_symmetry},f=function(x,C){if(C.label_asym_id.valueKind(x)===0){var w=C.label_asym_id.value(x),A=o.atomicHierarchy.index.findEntity(w);if(!(A<0)){var M=o.atomicHierarchy.index.findResidue(o.entities.data.id.value(A),w,C.auth_seq_id.value(x),C.ins_code.value(x));if(!(M<0)){var D=C.label_atom_id.value(x);if(D){var k=o.atomicHierarchy.index.findAtomOnResidue(M,D,C.label_alt_id.value(x));if(!(k<0))return{residueIndex:M,atomIndex:k,symmetry:C.symmetry.value(x)}}}}}},h=[],v=0;v<a._rowCount;v++){var p=f(v,c),m=f(v,d);if(!(p===void 0||m===void 0)){var g=s.value(v),y=(l.value(v)||"").toLowerCase(),b=0,S=1;switch(y){case"sing":S=1;break;case"doub":S=2;break;case"trip":S=3;break;case"quad":S=4;break;default:S=$K(a.ptnr1_label_comp_id.value(v),a.ptnr1_label_atom_id.value(v),a.ptnr2_label_comp_id.value(v),a.ptnr2_label_atom_id.value(v))}switch(g){case"covale":b=1;break;case"disulf":b=9;break;case"hydrog":b=4;break;case"metalc":b=2;break}h.push({rowIndex:v,flags:b,order:S,distance:u.value(v),partnerA:p,partnerB:m})}}return h}e.getEntriesFromStructConn=i})(El||(El={}));var xp;(function(e){var t,r="molstar_global_model_transform_info";e.Schema=(t={},t[r]={matrix:ve.Schema.Matrix(4,4,ve.Schema.float)},t),e.Descriptor=yo({name:r,cifExport:{categories:[{name:r,instance:function(u){var l=i(u.firstModel);if(!l)return Di.Category.Empty;var c=Xr.ofRows(e.Schema.molstar_global_model_transform_info,[{matrix:l}]);return Di.Category.ofTable(c)}}],prefix:"molstar"}}),e.Provider=Mu.create(e.Descriptor);function n(u,l){u.customProperties.has(e.Descriptor)||u.customProperties.add(e.Descriptor),e.Provider.set(u,l)}e.attach=n;function i(u){return e.Provider.get(u)}e.get=i;function a(u){if(tn.is(u.sourceData)){var l=u.sourceData.data.frame.categories[r];if(l){var c=UK(e.Schema[r],l);if(c._rowCount!==0)return c.matrix.value(0)}}}e.fromMmCif=a;function o(u){if(!tn.is(u.sourceData))return!1;var l=u.sourceData.data.frame.categories[r];return!!l&&l.rowCount>0}e.hasData=o;function s(u,l){u.writeCategory({name:r,instance:function(){var c=Xr.ofRows(e.Schema.molstar_global_model_transform_info,[{matrix:l}]);return Di.Category.ofTable(c)}})}e.writeMmCif=s})(xp||(xp={}));function r5e(e){if(tn.is(e.sourceData))return si.fromData(e.sourceData.data.db)}si.Provider.formatRegistry.add("mmCIF",r5e);function n5e(e){if(tn.is(e.sourceData)){var t=e.sourceData.data.db,r=t.struct_conf,n=t.struct_sheet_range;return Y1.fromStruct(r,n,e.atomicHierarchy)}}Y1.Provider.formatRegistry.add("mmCIF",n5e);function i5e(e){if(tn.is(e.sourceData)){var t=e.sourceData.data.db.atom_site_anisotrop,r=Xr.ofColumns(wl.Schema,t),n=wl.getElementToAnsiotrop(e.atomicConformation.atomId,t.id);return{data:r,elementToAnsiotrop:n}}}function a5e(e){return tn.is(e.sourceData)?e.sourceData.data.db.atom_site_anisotrop.U.isDefined:!1}wl.Provider.formatRegistry.add("mmCIF",i5e,a5e);function o5e(e){if(tn.is(e.sourceData)){var t=e.sourceData.data.db.chem_comp_bond;if(t._rowCount!==0)return{data:t,entries:K1.getEntriesFromChemCompBond(t)}}}K1.Provider.formatRegistry.add("mmCIF",o5e);function s5e(e){if(tn.is(e.sourceData)){var t=e.sourceData.data.db.struct_conn;if(t._rowCount!==0){var r=El.getEntriesFromStructConn(t,e);return{data:t,byAtomIndex:El.getAtomIndexFromEntries(r),entries:r}}}}El.Provider.formatRegistry.add("mmCIF",s5e);xp.Provider.formatRegistry.add("mmCIF",xp.fromMmCif,xp.hasData);var tn;(function(e){function t(n){return(n==null?void 0:n.kind)==="mmCIF"}e.is=t;function r(n,i,a){return i||(i=Fc.schema.mmCIF(n)),{kind:"mmCIF",name:i._name,data:{db:i,frame:n,source:a}}}e.fromFrame=r})(tn||(tn={}));function XK(e){var t=tn.fromFrame(e);return We.create("Create mmCIF Model",function(r){return rd(t.data.db,t,r)})}var Ze;(function(e){function t(f,h,v){return{kind:"element-location",structure:f,unit:h,element:v||0}}e.create=t;function r(f){return t(f.structure,f.unit,f.element)}e.clone=r;function n(f,h,v,p){return h&&(f.structure=h),v&&(f.unit=v),p!==void 0&&(f.element=p),f}e.set=n;function i(f,h){return f.unit=h.unit,f.element=h.element,f}e.copy=i;function a(f){return!!f&&f.kind==="element-location"}e.is=a;function o(f,h){return f.unit===h.unit&&f.element===h.element}e.areEqual=o;var s=_.zero(),u=_.zero();function l(f,h){return f.unit.conformation.position(f.element,s),h.unit.conformation.position(h.element,u),_.distance(s,u)}e.distance=l;function c(f){return f.unit.model.atomicHierarchy.residueAtomSegments.index[f.element]}e.residueIndex=c;function d(f){return f.unit.model.atomicHierarchy.chainAtomSegments.index[f.element]}e.chainIndex=d})(Ze||(Ze={}));var Me;(function(e){function t(s,u,l){return{kind:"variable",name:s,type:u,isConstraint:l}}e.Variable=t;function r(s,u,l){return{kind:"value",namespace:s,name:u,parent:l}}e.Value=r;function n(s,u,l,c){return{kind:"container",namespace:s,name:u,child:l,alias:c}}e.Container=n;function i(s){return{kind:"union",types:s}}e.Union=i;function a(s,u,l,c){for(var d=Object.create(null),f=0,h=c;f<h.length;f++){var v=h[f];d[v]=!0}return{kind:"oneof",namespace:s,name:u,type:l,values:d}}e.OneOf=a,e.Any={kind:"any"},e.AnyValue={kind:"any-value"},e.Num=r("","Number"),e.Str=r("","String"),e.Bool=a("","Bool",e.Str,["true","false"]);function o(s){var u=s.values;return Object.keys(u).sort()}e.oneOfValues=o})(Me||(Me={}));var _i;(function(e){function t(u){return{name:u}}e.Symbol=t;function r(u,l){return l?{head:u,args:l}:{head:u}}e.Apply=r;function n(u){return!!u&&Array.isArray(u)}e.isArgumentsArray=n;function i(u){return!!u&&!Array.isArray(u)}e.isArgumentsMap=i;function a(u){return!o(u)&&!s(u)}e.isLiteral=a;function o(u){return!!u&&!!u.head&&typeof u=="object"}e.isApply=o;function s(u){return!!u&&typeof u.name=="string"}e.isSymbol=s})(_i||(_i={}));function vt(e,t){var r=t||{},n=r.description,i=n===void 0?void 0:n,a=r.isOptional,o=a===void 0?!1:a,s=r.isRest,u=s===void 0?!1:s,l=r.defaultValue,c=l===void 0?void 0:l;return{type:e,isOptional:o,isRest:u,defaultValue:c,description:i}}var Rt;(function(e){e.None=t({});function t(n){return{kind:"dictionary",map:n,"@type":0}}e.Dictionary=t;function r(n,i){var a=(i||{}).nonEmpty,o=a===void 0?!1:a;return{kind:"list",type:n,nonEmpty:o,"@type":0}}e.List=r})(Rt||(Rt={}));function gy(e,t,r,n){var i=function(a){return _i.Apply(_i.Symbol(i.id),a)};return i.info={namespace:"",name:e,description:n},i.id="",i.args=t,i.type=r,i}function V7(e,t,r,n){var i=function(a){return _i.Apply(_i.Symbol(i.id),a)};return i.info={namespace:e,name:t,description:n},i.id=e+"."+t,i.args=Rt.None,i.type=r,i}function e_(e){var t=e;return typeof t=="function"&&!!t.info&&!!t.args&&typeof t.info.namespace=="string"&&!!t.type}function Bt(e,t,r){return gy("",e,t,r)}function YK(e){QK("","",e)}function KK(e){var t=[];return ZK(e,t),t}function H7(e){var t=/([a-z])([A-Z])([a-z]|$)/g;return e.replace(t,function(r,n,i,a){return n+"-"+i.toLocaleLowerCase()+a}).replace(t,function(r,n,i,a){return n+"-"+i.toLocaleLowerCase()+a})}function QK(e,t,r){if(e_(r)){r.info.namespace=e,r.info.name=r.info.name||H7(t),r.id=r.info.namespace+"."+r.info.name;return}for(var n=""+(r["@namespace"]||H7(t)),i=e?e+"."+n:n,a=0,o=Object.keys(r);a<o.length;a++){var s=o[a];typeof r[s]!="object"&&!e_(r[s])||QK(i,s,r[s])}}function ZK(e,t){if(e_(e)){t.push(e);return}for(var r=0,n=Object.keys(e);r<n.length;r++){var i=n[r];typeof e[i]!="object"&&!e_(e[i])||ZK(e[i],t)}}var Cr;(function(e){e.AnyVar=Me.Variable("a",Me.Any),e.AnyValueVar=Me.Variable("a",Me.Any),e.ConstrainedVar=Me.Variable("a",Me.Any,!0),e.Regex=Me.Value("Core","Regex"),e.Set=function(t){return Me.Container("Core","Set",t||e.AnyValueVar)},e.List=function(t){return Me.Container("Core","List",t||e.AnyVar)},e.Fn=function(t,r){return Me.Container("Core","Fn",t||e.AnyVar,r)},e.Flags=function(t,r){return Me.Container("Core","Flags",t,r)},e.BitFlags=e.Flags(Me.Num,"BitFlags")})(Cr||(Cr={}));function ki(e,t){return Bt(Rt.Dictionary({0:vt(e)}),e,t)}function nf(e,t){return Bt(Rt.List(e,{nonEmpty:!0}),e,t)}function nl(e,t,r){return Bt(Rt.Dictionary({0:vt(e),1:vt(e)}),t,r)}Rt.Dictionary({0:vt(Me.Num),1:vt(Me.Num)});vt(Me.Str);var u5e={"@header":"Types",bool:Bt(Rt.Dictionary({0:vt(Me.AnyValue)}),Me.Bool,"Convert a value to boolean."),num:Bt(Rt.Dictionary({0:vt(Me.AnyValue)}),Me.Num,"Convert a value to number."),str:Bt(Rt.Dictionary({0:vt(Me.AnyValue)}),Me.Str,"Convert a value to string."),regex:Bt(Rt.Dictionary({0:vt(Me.Str,{description:"Expression"}),1:vt(Me.Str,{isOptional:!0,description:"Flags, e.g. 'i' for ignore case"})}),Cr.Regex,"Creates a regular expression from a string using the ECMAscript syntax."),list:Bt(Rt.List(Cr.AnyVar),Cr.List()),set:Bt(Rt.List(Cr.AnyValueVar),Cr.Set()),bitflags:Bt(Rt.Dictionary({0:vt(Me.Num)}),Cr.BitFlags,"Interpret a number as bitflags."),compositeKey:Bt(Rt.List(Me.AnyValue),Me.AnyValue)},l5e={"@header":"Logic",not:ki(Me.Bool),and:nf(Me.Bool),or:nf(Me.Bool)},c5e={"@header":"Control",eval:Bt(Rt.Dictionary({0:vt(Cr.Fn(Cr.AnyVar))}),Cr.AnyVar,"Evaluate a function."),fn:Bt(Rt.Dictionary({0:vt(Cr.AnyVar)}),Cr.Fn(Cr.AnyVar),'Wrap an expression to a "lazy" function.'),if:Bt(Rt.Dictionary({0:vt(Me.Bool,{description:"Condition"}),1:vt(Me.Variable("a",Me.Any),{description:"If true"}),2:vt(Me.Variable("b",Me.Any),{description:"If false"})}),Me.Union([Me.Variable("a",Me.Any),Me.Variable("b",Me.Any)])),assoc:Bt(Rt.Dictionary({0:vt(Me.Str,{description:"Name"}),1:vt(Me.Variable("a",Me.Any),{description:"Value to assign"})}),Me.Variable("a",Me.Any))},d5e={"@header":"Relational",eq:nl(Me.Variable("a",Me.AnyValue,!0),Me.Bool),neq:nl(Me.Variable("a",Me.AnyValue,!0),Me.Bool),lt:nl(Me.Num,Me.Bool),lte:nl(Me.Num,Me.Bool),gr:nl(Me.Num,Me.Bool),gre:nl(Me.Num,Me.Bool),inRange:Bt(Rt.Dictionary({0:vt(Me.Num,{description:"Value to test"}),1:vt(Me.Num,{description:"Minimum value"}),2:vt(Me.Num,{description:"Maximum value"})}),Me.Bool,"Check if the value of the 1st argument is >= 2nd and <= 3rd.")},f5e={"@header":"Math",add:nf(Me.Num),sub:nf(Me.Num),mult:nf(Me.Num),div:nl(Me.Num,Me.Num),pow:nl(Me.Num,Me.Num),mod:nl(Me.Num,Me.Num),min:nf(Me.Num),max:nf(Me.Num),floor:ki(Me.Num),ceil:ki(Me.Num),roundInt:ki(Me.Num),abs:ki(Me.Num),sqrt:ki(Me.Num),cbrt:ki(Me.Num),sin:ki(Me.Num),cos:ki(Me.Num),tan:ki(Me.Num),asin:ki(Me.Num),acos:ki(Me.Num),atan:ki(Me.Num),sinh:ki(Me.Num),cosh:ki(Me.Num),tanh:ki(Me.Num),exp:ki(Me.Num),log:ki(Me.Num),log10:ki(Me.Num),atan2:nl(Me.Num,Me.Num)},h5e={"@header":"Strings",concat:nf(Me.Str),match:Bt(Rt.Dictionary({0:vt(Cr.Regex),1:vt(Me.Str)}),Me.Bool)},p5e={"@header":"Lists",getAt:Bt(Rt.Dictionary({0:vt(Cr.List()),1:vt(Me.Num)}),Cr.AnyVar),equal:Bt(Rt.Dictionary({0:vt(Cr.List()),1:vt(Cr.List())}),Me.Bool)},v5e={"@header":"Sets",has:Bt(Rt.Dictionary({0:vt(Cr.Set(Cr.ConstrainedVar)),1:vt(Cr.ConstrainedVar)}),Me.Bool,"Check if the the 1st argument includes the value of the 2nd."),isSubset:Bt(Rt.Dictionary({0:vt(Cr.Set(Cr.ConstrainedVar)),1:vt(Cr.Set(Cr.ConstrainedVar))}),Me.Bool,"Check if the the 1st argument is a subset of the 2nd.")},m5e={"@header":"Flags",hasAny:Bt(Rt.Dictionary({0:vt(Cr.Flags(Cr.ConstrainedVar)),1:vt(Cr.Flags(Cr.ConstrainedVar))}),Me.Bool,"Check if the the 1st argument has at least one of the 2nd one's flags."),hasAll:Bt(Rt.Dictionary({0:vt(Cr.Flags(Cr.ConstrainedVar)),1:vt(Cr.Flags(Cr.ConstrainedVar))}),Me.Bool,"Check if the the 1st argument has all 2nd one's flags.")},mO={"@header":"Language Primitives",type:u5e,logic:l5e,ctrl:c5e,rel:d5e,math:f5e,str:h5e,list:p5e,set:v5e,flags:m5e};YK(mO);var g5e=KK(mO);(function(){for(var e=Object.create(null),t=0,r=g5e;t<r.length;t++){var n=r[t];e[n.id]=n}return e})();var At;(function(e){e.ElementSymbol=Me.Value("Structure","ElementSymbol"),e.AtomName=Me.Value("Structure","AtomName"),e.BondFlag=Me.OneOf("Structure","BondFlag",Me.Str,["covalent","metallic","ion","hydrogen","sulfide","computed","aromatic"]),e.BondFlags=Cr.Flags(e.BondFlag,"BondFlags"),e.SecondaryStructureFlag=Me.OneOf("Structure","SecondaryStructureFlag",Me.Str,["alpha","beta","3-10","pi","sheet","strand","helix","turn","none"]),e.SecondaryStructureFlags=Cr.Flags(e.SecondaryStructureFlag,"SecondaryStructureFlag"),e.RingFingerprint=Me.Value("Structure","RingFingerprint"),e.EntityType=Me.OneOf("Structure","EntityType",Me.Str,["polymer","non-polymer","water","branched"]),e.EntitySubtype=Me.OneOf("Structure","EntitySubtype",Me.Str,["other","polypeptide(D)","polypeptide(L)","polydeoxyribonucleotide","polyribonucleotide","polydeoxyribonucleotide/polyribonucleotide hybrid","cyclic-pseudo-peptide","peptide nucleic acid","oligosaccharide"]),e.ObjectPrimitive=Me.OneOf("Structure","ObjectPrimitive",Me.Str,["atomistic","sphere","gaussian","other"]),e.ResidueId=Me.Value("Structure","ResidueId"),e.ElementSet=Me.Value("Structure","ElementSet"),e.ElementSelection=Me.Value("Structure","ElementSelection"),e.ElementReference=Me.Value("Structure","ElementReference"),e.ElementSelectionQuery=Cr.Fn(e.ElementSelection,"ElementSelectionQuery")})(At||(At={}));var y5e={"@header":"Types",elementSymbol:Bt(Rt.Dictionary({0:vt(Me.Str)}),At.ElementSymbol,"Create element symbol representation from a string value."),atomName:Bt(Rt.Dictionary({0:vt(Me.AnyValue)}),At.AtomName,"Convert a value to an atom name."),entityType:Bt(Rt.Dictionary({0:vt(At.EntityType)}),At.EntityType,"Create normalized representation of entity type: "+Me.oneOfValues(At.EntityType).join(", ")+"."),bondFlags:Bt(Rt.List(At.BondFlag),At.BondFlags,"Create bond flags representation from a list of strings. Allowed flags: "+Me.oneOfValues(At.BondFlag).join(", ")+"."),ringFingerprint:Bt(Rt.List(At.ElementSymbol,{nonEmpty:!0}),At.RingFingerprint,"Create ring fingerprint from the supplied atom element list."),secondaryStructureFlags:Bt(Rt.List(At.SecondaryStructureFlag),At.SecondaryStructureFlags,"Create secondary structure flags representation from a list of strings. Allowed flags: "+Me.oneOfValues(At.SecondaryStructureFlag).join(", ")+"."),authResidueId:Bt(Rt.Dictionary({0:vt(Me.Str,{description:"auth_asym_id"}),1:vt(Me.Num,{description:"auth_seq_id"}),2:vt(Me.Str,{description:"pdbx_PDB_ins_code",isOptional:!0})}),At.ResidueId,'Residue identifier based on "auth_" annotation.'),labelResidueId:Bt(Rt.Dictionary({0:vt(Me.Str,{description:"label_entity_id"}),1:vt(Me.Str,{description:"label_asym_id"}),2:vt(Me.Num,{description:"label_seq_id"}),3:vt(Me.Str,{description:"pdbx_PDB_ins_code",isOptional:!0})}),At.ResidueId,`Residue identifier based on mmCIF's "label_" annotation.`)},b5e={"@header":"Iteration Slots",element:Bt(Rt.None,At.ElementReference,"A reference to the current element."),elementSetReduce:Bt(Rt.None,Me.Variable("a",Me.AnyValue,!0),"Current value of the element set reducer.")},x5e={"@header":"Generators",all:Bt(Rt.None,At.ElementSelectionQuery,"The entire structure."),atomGroups:Bt(Rt.Dictionary({"entity-test":vt(Me.Bool,{isOptional:!0,defaultValue:!0,description:"Test for the 1st atom of every entity"}),"chain-test":vt(Me.Bool,{isOptional:!0,defaultValue:!0,description:"Test for the 1st atom of every chain"}),"residue-test":vt(Me.Bool,{isOptional:!0,defaultValue:!0,description:"Test for the 1st atom every residue"}),"atom-test":vt(Me.Bool,{isOptional:!0,defaultValue:!0}),"group-by":vt(Me.Any,{isOptional:!0,defaultValue:"atom-key",description:"Group atoms to sets based on this property. Default: each atom has its own set"})}),At.ElementSelectionQuery,"Return all atoms for which the tests are satisfied, grouped into sets."),bondedAtomicPairs:Bt(Rt.Dictionary({0:vt(Me.Bool,{isOptional:!0,defaultValue:"true for covalent bonds",description:"Test each bond with this predicate. Each bond is visited twice with swapped atom order."})}),At.ElementSelectionQuery,"Return all pairs of atoms for which the test is satisfied."),rings:Bt(Rt.Dictionary({fingerprint:vt(At.RingFingerprint,{isOptional:!0}),"only-aromatic":vt(Me.Bool,{isOptional:!0,defaultValue:!1})}),At.ElementSelectionQuery,"Return all rings or those with the specified fingerprint and/or only aromatic rings."),queryInSelection:Bt(Rt.Dictionary({0:vt(At.ElementSelectionQuery),query:vt(At.ElementSelectionQuery),"in-complement":vt(Me.Bool,{isOptional:!0,defaultValue:!1})}),At.ElementSelectionQuery,"Executes query only on atoms that are in the source selection."),empty:Bt(Rt.None,At.ElementSelectionQuery,"Nada.")},S5e={"@header":"Selection Modifications",queryEach:Bt(Rt.Dictionary({0:vt(At.ElementSelectionQuery),query:vt(At.ElementSelectionQuery)}),At.ElementSelectionQuery,"Query every atom set in the input selection separately."),intersectBy:Bt(Rt.Dictionary({0:vt(At.ElementSelectionQuery),by:vt(At.ElementSelectionQuery)}),At.ElementSelectionQuery,"Intersect each atom set from the first sequence from atoms in the second one."),exceptBy:Bt(Rt.Dictionary({0:vt(At.ElementSelectionQuery),by:vt(At.ElementSelectionQuery)}),At.ElementSelectionQuery,"Remove all atoms from 'selection' that occur in 'by'."),unionBy:Bt(Rt.Dictionary({0:vt(At.ElementSelectionQuery),by:vt(At.ElementSelectionQuery)}),At.ElementSelectionQuery,"For each atom set A in the orginal sequence, combine all atoms sets in the target selection that intersect with A."),union:Bt(Rt.Dictionary({0:vt(At.ElementSelectionQuery)}),At.ElementSelectionQuery,"Collects all atom sets in the sequence into a single atom set."),cluster:Bt(Rt.Dictionary({0:vt(At.ElementSelectionQuery),"min-distance":vt(Me.Num,{isOptional:!0,defaultValue:0}),"max-distance":vt(Me.Num),"min-size":vt(Me.Num,{description:"Minimal number of sets to merge, must be at least 2",isOptional:!0,defaultValue:2}),"max-size":vt(Me.Num,{description:"Maximal number of sets to merge, if not set, no limit",isOptional:!0})}),At.ElementSelectionQuery,"Combines atom sets that have mutual distance in the interval [min-radius, max-radius]. Minimum/maximum size determines how many atom sets can be combined."),includeSurroundings:Bt(Rt.Dictionary({0:vt(At.ElementSelectionQuery),radius:vt(Me.Num),"atom-radius":vt(Me.Num,{isOptional:!0,defaultValue:0,description:"Value added to each atom before the distance check, for example VDW radius. Using this argument is computationally demanding."}),"as-whole-residues":vt(Me.Bool,{isOptional:!0})}),At.ElementSelectionQuery,"For each atom set in the selection, include all surrouding atoms/residues that are within the specified radius."),surroundingLigands:Bt(Rt.Dictionary({0:vt(At.ElementSelectionQuery),radius:vt(Me.Num),"include-water":vt(Me.Bool,{isOptional:!0,defaultValue:!0})}),At.ElementSelectionQuery,"Find all ligands components around the source query."),includeConnected:Bt(Rt.Dictionary({0:vt(At.ElementSelectionQuery),"bond-test":vt(Me.Bool,{isOptional:!0,defaultValue:"true for covalent bonds"}),"layer-count":vt(Me.Num,{isOptional:!0,defaultValue:1,description:"Number of bonded layers to include."}),"fixed-point":vt(Me.Bool,{isOptional:!0,defaultValue:!1,description:"Continue adding layers as long as new connections exist."}),"as-whole-residues":vt(Me.Bool,{isOptional:!0})}),At.ElementSelectionQuery,"Pick all atom sets that are connected to the target."),wholeResidues:Bt(Rt.Dictionary({0:vt(At.ElementSelectionQuery)}),At.ElementSelectionQuery,"Expand the selection to whole residues."),expandProperty:Bt(Rt.Dictionary({0:vt(At.ElementSelectionQuery),property:vt(Me.AnyValue)}),At.ElementSelectionQuery,"To each atom set in the selection, add all atoms that have the same property value that was already present in the set.")},C5e={"@header":"Selection Filters",pick:Bt(Rt.Dictionary({0:vt(At.ElementSelectionQuery),test:vt(Me.Bool)}),At.ElementSelectionQuery,"Pick all atom sets that satisfy the test."),first:Bt(Rt.Dictionary({0:vt(At.ElementSelectionQuery)}),At.ElementSelectionQuery,"Take the 1st atom set in the sequence."),withSameAtomProperties:Bt(Rt.Dictionary({0:vt(At.ElementSelectionQuery),source:vt(At.ElementSelectionQuery),property:vt(Me.Any)}),At.ElementSelectionQuery,"Pick all atom sets for which the set of given atom properties is a subset of the source properties."),intersectedBy:Bt(Rt.Dictionary({0:vt(At.ElementSelectionQuery),by:vt(At.ElementSelectionQuery)}),At.ElementSelectionQuery,"Pick all atom sets that have non-zero intersection with the target."),within:Bt(Rt.Dictionary({0:vt(At.ElementSelectionQuery),target:vt(At.ElementSelectionQuery),"min-radius":vt(Me.Num,{isOptional:!0,defaultValue:0}),"max-radius":vt(Me.Num),"atom-radius":vt(Me.Num,{isOptional:!0,defaultValue:0,description:"Value added to each atom before the distance check, for example VDW radius. Using this argument is computationally demanding."}),invert:vt(Me.Bool,{isOptional:!0,defaultValue:!1,description:"If true, pick only atom sets that are further than the specified radius."})}),At.ElementSelectionQuery,"Pick all atom sets from selection that have any atom within the radius of any atom from target."),isConnectedTo:Bt(Rt.Dictionary({0:vt(At.ElementSelectionQuery),target:vt(At.ElementSelectionQuery),"bond-test":vt(Me.Bool,{isOptional:!0,defaultValue:"true for covalent bonds"}),disjunct:vt(Me.Bool,{isOptional:!0,defaultValue:!0,description:"If true, there must exist a bond to an atom that lies outside the given atom set to pass test."}),invert:vt(Me.Bool,{isOptional:!0,defaultValue:!1,description:"If true, return atom sets that are not connected."})}),At.ElementSelectionQuery,"Pick all atom sets that are connected to the target.")},_5e={"@header":"Selection Combinators",intersect:Bt(Rt.List(At.ElementSelectionQuery),At.ElementSelectionQuery,"Return all unique atom sets that appear in all of the source selections."),merge:Bt(Rt.List(At.ElementSelectionQuery),At.ElementSelectionQuery,"Merges multiple selections into a single one. Only unique atom sets are kept."),distanceCluster:Bt(Rt.Dictionary({matrix:vt(Cr.List(Cr.List(Me.Num)),{description:"Distance matrix, represented as list of rows (num[][])). Lower triangle is min distance, upper triangle is max distance."}),selections:vt(Cr.List(At.ElementSelectionQuery),{description:"A list of held selections."})}),At.ElementSelectionQuery,"Pick combinations of atom sets from the source sequences that are mutually within distances specified by a matrix.")},w5e={"@header":"Atom Sets",atomCount:Bt(Rt.None,Me.Num),countQuery:Bt(Rt.Dictionary({0:vt(At.ElementSelectionQuery)}),Me.Num,"Counts the number of occurences of a specific query inside the current atom set."),reduce:Bt(Rt.Dictionary({initial:vt(Me.Variable("a",Me.AnyValue,!0),{description:"Initial value assigned to slot.atom-set-reduce. Current atom is set to the 1st atom of the current set for this."}),value:vt(Me.Variable("a",Me.AnyValue,!0),{description:"Expression executed for each atom in the set"})}),Me.Variable("a",Me.AnyValue,!0),"Execute the value expression for each atom in the current atom set and return the result. Works the same way as Array.reduce in JavaScript (``result = value(value(...value(initial)))``)"),propertySet:Bt(Rt.Dictionary({0:vt(Cr.ConstrainedVar)}),Cr.Set(Cr.ConstrainedVar),"Returns a set with all values of the given property in the current atom set.")},E5e={"@header":"Atom Properties",core:{"@header":"Core Properties",elementSymbol:br(At.ElementSymbol),vdw:br(Me.Num,"Van der Waals radius"),mass:br(Me.Num,"Atomic weight"),atomicNumber:br(Me.Num,"Atomic number"),x:br(Me.Num,"Cartesian X coordinate"),y:br(Me.Num,"Cartesian Y coordinate"),z:br(Me.Num,"Cartesian Z coordinate"),atomKey:br(Me.AnyValue,"Unique value for each atom. Main use case is grouping of atoms."),bondCount:Bt(Rt.Dictionary({0:vt(At.ElementReference,{isOptional:!0,defaultValue:"slot.current-atom"}),flags:vt(At.BondFlags,{isOptional:!0,defaultValue:"covalent"})}),Me.Num,"Number of bonds (by default only covalent bonds are counted)."),sourceIndex:br(Me.Num,"Index of the atom/element in the input file."),operatorName:br(Me.Str,"Name of the symmetry operator applied to this element."),modelIndex:br(Me.Num,"Index of the model in the input file."),modelLabel:br(Me.Str,"Label/header of the model in the input file.")},topology:{connectedComponentKey:br(Me.AnyValue,"Unique value for each connected component.")},macromolecular:{"@header":"Macromolecular Properties (derived from the mmCIF format)",authResidueId:br(At.ResidueId,"type.auth-residue-id symbol executed on current atom's residue"),labelResidueId:br(At.ResidueId,"type.label-residue-id symbol executed on current atom's residue"),residueKey:br(Me.AnyValue,"Unique value for each tuple ``(label_entity_id,auth_asym_id, auth_seq_id, pdbx_PDB_ins_code)``, main use case is grouping of atoms"),chainKey:br(Me.AnyValue,"Unique value for each tuple ``(label_entity_id, auth_asym_id)``, main use case is grouping of atoms"),entityKey:br(Me.AnyValue,"Unique value for each tuple ``label_entity_id``, main use case is grouping of atoms"),isHet:br(Me.Bool,"Equivalent to atom_site.group_PDB !== ATOM"),id:br(Me.Num,"_atom_site.id"),label_atom_id:br(At.AtomName),label_alt_id:br(Me.Str),label_comp_id:br(Me.Str),label_asym_id:br(Me.Str),label_entity_id:br(Me.Str),label_seq_id:br(Me.Num),auth_atom_id:br(At.AtomName),auth_comp_id:br(Me.Str),auth_asym_id:br(Me.Str),auth_seq_id:br(Me.Num),pdbx_PDB_ins_code:br(Me.Str),pdbx_formal_charge:br(Me.Num),occupancy:br(Me.Num),B_iso_or_equiv:br(Me.Num),entityType:br(At.EntityType,"Type of the entity as defined in mmCIF (polymer, non-polymer, branched, water)"),entitySubtype:br(At.EntitySubtype,"Subtype of the entity as defined in mmCIF _entity_poly.type and _pdbx_entity_branch.type (other, polypeptide(D), polypeptide(L), polydeoxyribonucleotide, polyribonucleotide, polydeoxyribonucleotide/polyribonucleotide hybrid, cyclic-pseudo-peptide, peptide nucleic acid, oligosaccharide)"),entityPrdId:br(Me.Str,"The PRD ID of the entity."),entityDescription:br(Cr.List(Me.Str)),objectPrimitive:br(At.ObjectPrimitive,"Type of the primitive object used to model this segment as defined in mmCIF/IHM (atomistic, sphere, gaussian, other)"),secondaryStructureKey:br(Me.AnyValue,"Unique value for each secondary structure element."),secondaryStructureFlags:br(At.SecondaryStructureFlags),isModified:br(Me.Bool,"True if the atom belongs to modification of a standard residue."),modifiedParentName:br(Me.Str,"'3-letter' code of the modifed parent residue."),isNonStandard:br(Me.Bool,"True if this is a non-standard residue."),chemCompType:br(Me.Str,"Type of the chemical component as defined in mmCIF.")}},A5e={"@header":"Bond Properties",flags:L0(At.BondFlags),order:L0(Me.Num),length:L0(Me.Num),atomA:L0(At.ElementReference),atomB:L0(At.ElementReference)};function br(e,t){return Bt(Rt.Dictionary({0:vt(At.ElementReference,{isOptional:!0,defaultValue:"slot.current-atom"})}),e,t)}function L0(e,t){return Bt(Rt.None,e,t)}var P5e={"@header":"Structure Queries",type:y5e,slot:b5e,generator:x5e,modifier:S5e,filter:C5e,combinator:_5e,atomSet:w5e,atomProperty:E5e,bondProperty:A5e},T5e={"@header":"Generators",bundleElement:Bt(Rt.Dictionary({groupedUnits:vt(Me.Any),set:vt(Me.Any),ranges:vt(Me.Any)}),Me.Any),bundle:Bt(Rt.Dictionary({elements:vt(Me.Any)}),At.ElementSelectionQuery,"A selection with single structure containing represented by the bundle."),current:Bt(Rt.None,At.ElementSelectionQuery,"Current selection provided by the query context. Avoid using this in State Transforms.")},I5e={"@header":"Internal Queries",generator:T5e},Ce={core:mO,structureQuery:P5e,internal:I5e};YK(Ce);var M5e=KK(Ce);(function(){for(var e=Object.create(null),t=0,r=M5e;t<r.length;t++){var n=r[t];e[n.id]=n}return e})();var se;(function(e){e.core=Ce.core,e.struct=Ce.structureQuery,e.internal=Ce.internal;function t(y){return e.struct.type.atomName([y])}e.atomName=t;function r(y){return e.struct.type.elementSymbol([y])}e.es=r;function n(){for(var y=[],b=0;b<arguments.length;b++)y[b]=arguments[b];return e.core.type.list(y)}e.list=n;function i(){for(var y=[],b=0;b<arguments.length;b++)y[b]=arguments[b];return e.core.type.set(y)}e.set=i;function a(y,b){return e.core.type.regex([y,b])}e.re=a;function o(y){return e.core.ctrl.fn([y])}e.fn=o;function s(y){return e.core.ctrl.eval([y])}e.evaluate=s;var u=e.struct.atomProperty.core,l=e.struct.atomProperty.macromolecular,c=e.struct.atomProperty.topology;function d(y){return u[y]()}e.acp=d;function f(y){return c[y]()}e.atp=f;function h(y){return l[y]()}e.ammp=h;var v=e.struct.atomSet.propertySet;function p(y){return v([d(y)])}e.acpSet=p;function m(y){return v([f(y)])}e.atpSet=m;function g(y){return v([h(y)])}e.ammpSet=g})(se||(se={}));var Bc=function(){function e(){this.count=0,this.center=_(),this.radiusSq=0}return e.prototype.reset=function(){_.set(this.center,0,0,0),this.radiusSq=0,this.count=0},e.prototype.includeStep=function(t){_.add(this.center,this.center,t),this.count++},e.prototype.finishedIncludeStep=function(){this.count!==0&&_.scale(this.center,this.center,1/this.count)},e.prototype.radiusStep=function(t){var r=_.squaredDistance(t,this.center);r>this.radiusSq&&(this.radiusSq=r)},e.prototype.radiusSphereStep=function(t,r){var n=_.distance(t,this.center)+r,i=n*n;i>this.radiusSq&&(this.radiusSq=i)},e.prototype.getSphere=function(t){return t||(t=Fe()),_.copy(t.center,this.center),t.radius=Math.sqrt(this.radiusSq),t},e.prototype.getCount=function(){return this.count},e}();(function(e){var t=new e,r=_(),n=_();function i(s,u){var l=s.x,c=s.y,d=s.z;t.reset();for(var f=l.length,h=0;h<f;h++)_.set(r,l[h],c[h],d[h]),t.includeStep(r);t.finishedIncludeStep();for(var h=0;h<f;h++)_.set(r,l[h],c[h],d[h]),t.radiusStep(r);return _.copy(u.center,t.center),u.radius=Math.sqrt(t.radiusSq),u}e.fromArrays=i;function a(s,u,l){t.reset();for(var c=0;c<s;c++)u(c,r),t.includeStep(r);t.finishedIncludeStep();for(var c=0;c<s;c++)u(c,r),t.radiusStep(r);return _.copy(l.center,t.center),l.radius=Math.sqrt(t.radiusSq),l}e.fromProvider=a;function o(s,u,l){t.reset();for(var c=0;c<s;c++)u(c,r,n),t.includeStep(r),t.includeStep(n);t.finishedIncludeStep();for(var c=0;c<s;c++)u(c,r,n),t.radiusStep(r),t.radiusStep(n);return _.copy(l.center,t.center),l.radius=Math.sqrt(t.radiusSq),l}e.fromPairProvider=o})(Bc||(Bc={}));var Wp=function(){function e(t){this.map=t;var r=0,n=[],i=new Map,a=new Map;this.map.forEach(function(o){o.forEach(function(s){r+=s.edgeCount,s.connectedIndices.forEach(function(u){s.getEdges(u).forEach(function(l){var c=s.unitA,d=s.unitB,f=e.getEdgeKey(u,c,l.indexB,d);i.set(f,n.length);var h=e.getVertexKey(u,c),v=a.get(h);v===void 0?a.set(h,[n.length]):v.push(n.length),n.push(E(E({},l),{indexA:u,unitA:c,unitB:d}))})})})}),this.edgeCount=r,this.edges=n,this.edgeKeyIndex=i,this.vertexKeyIndex=a}return e.prototype.getConnectedUnits=function(t){return this.map.has(t)?this.map.get(t):JK},e.prototype.getEdgeIndex=function(t,r,n,i){var a=e.getEdgeKey(t,r,n,i),o=this.edgeKeyIndex.get(a);return o!==void 0?o:-1},e.prototype.hasEdge=function(t,r,n,i){return this.getEdgeIndex(t,r,n,i)!==-1},e.prototype.getEdge=function(t,r,n,i){var a=this.getEdgeIndex(t,r,n,i);return a!==-1?this.edges[a]:void 0},e.prototype.getEdgeIndices=function(t,r){return this.vertexKeyIndex.get(e.getVertexKey(t,r))||[]},e}();(function(e){var t=function(){function o(s,u,l,c,d){this.unitA=s,this.unitB=u,this.edgeCount=l,this.connectedIndices=c,this.edgeMap=d}return o.prototype.hasEdges=function(s){return this.edgeMap.has(s)},o.prototype.getEdges=function(s){return this.edgeMap.has(s)?this.edgeMap.get(s):JK},Object.defineProperty(o.prototype,"areUnitsOrdered",{get:function(){return this.unitA<this.unitB},enumerable:!1,configurable:!0}),o}();e.UnitPairEdges=t;function r(o,s,u,l){return o+"|"+s+"|"+u+"|"+l}e.getEdgeKey=r;function n(o,s){return o+"|"+s}e.getVertexKey=n;function i(o,s,u){o.has(s)?o.get(s).push(u):o.set(s,[u])}var a=function(){function o(){this.map=new Map}return o.prototype.startUnitPair=function(s,u){this.uA=s,this.uB=u,this.mapAB=new Map,this.mapBA=new Map,this.linkedA=Zr.create(),this.linkedB=Zr.create(),this.linkCount=0},o.prototype.finishUnitPair=function(){this.linkCount!==0&&(i(this.map,this.uA,new t(this.uA,this.uB,this.linkCount,this.linkedA.array,this.mapAB)),i(this.map,this.uB,new t(this.uB,this.uA,this.linkCount,this.linkedB.array,this.mapBA)))},o.prototype.add=function(s,u,l){i(this.mapAB,s,{indexB:u,props:l}),i(this.mapBA,u,{indexB:s,props:l}),Zr.add(this.linkedA,s,s),Zr.add(this.linkedB,u,u),this.linkCount+=1},o.prototype.getMap=function(){return this.map},o}();e.Builder=a})(Wp||(Wp={}));var JK=[],JM;(function(e){e.Empty=bo.create([],[],[],0,{flags:[],order:[]})})(JM||(JM={}));var Wy=function(e){Le(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.getBondFromLocation=function(r){return Ue.isAtomic(r.aUnit)&&Ue.isAtomic(r.bUnit)?this.getEdge(r.aIndex,r.aUnit.id,r.bIndex,r.bUnit.id):void 0},t.prototype.getBondIndexFromLocation=function(r){return Ue.isAtomic(r.aUnit)&&Ue.isAtomic(r.bUnit)?this.getEdgeIndex(r.aIndex,r.aUnit.id,r.bIndex,r.bUnit.id):-1},t}(Wp);(function(e){var t=function(r){Le(n,r);function n(){return r!==null&&r.apply(this,arguments)||this}return n}(Wp.UnitPairEdges);e.UnitPairBonds=t})(Wy||(Wy={}));var eQ={forceCompute:!1,noCompute:!1},gO={H:0,h:0,D:0,d:0,T:0,t:0,He:2,HE:2,he:2,Li:3,LI:3,li:3,Be:4,BE:4,be:4,B:5,b:5,C:6,c:6,N:7,n:7,O:8,o:8,F:9,f:9,Ne:10,NE:10,ne:10,Na:11,NA:11,na:11,Mg:12,MG:12,mg:12,Al:13,AL:13,al:13,Si:14,SI:14,si:14,P:15,p:15,S:16,s:16,Cl:17,CL:17,cl:17,Ar:18,AR:18,ar:18,K:19,k:19,Ca:20,CA:20,ca:20,Sc:21,SC:21,sc:21,Ti:22,TI:22,ti:22,V:23,v:23,Cr:24,CR:24,cr:24,Mn:25,MN:25,mn:25,Fe:26,FE:26,fe:26,Co:27,CO:27,co:27,Ni:28,NI:28,ni:28,Cu:29,CU:29,cu:29,Zn:30,ZN:30,zn:30,Ga:31,GA:31,ga:31,Ge:32,GE:32,ge:32,As:33,AS:33,as:33,Se:34,SE:34,se:34,Br:35,BR:35,br:35,Kr:36,KR:36,kr:36,Rb:37,RB:37,rb:37,Sr:38,SR:38,sr:38,Y:39,y:39,Zr:40,ZR:40,zr:40,Nb:41,NB:41,nb:41,Mo:42,MO:42,mo:42,Tc:43,TC:43,tc:43,Ru:44,RU:44,ru:44,Rh:45,RH:45,rh:45,Pd:46,PD:46,pd:46,Ag:47,AG:47,ag:47,Cd:48,CD:48,cd:48,In:49,IN:49,in:49,Sn:50,SN:50,sn:50,Sb:51,SB:51,sb:51,Te:52,TE:52,te:52,I:53,i:53,Xe:54,XE:54,xe:54,Cs:55,CS:55,cs:55,Ba:56,BA:56,ba:56,La:57,LA:57,la:57,Ce:58,CE:58,ce:58,Pr:59,PR:59,pr:59,Nd:60,ND:60,nd:60,Pm:61,PM:61,pm:61,Sm:62,SM:62,sm:62,Eu:63,EU:63,eu:63,Gd:64,GD:64,gd:64,Tb:65,TB:65,tb:65,Dy:66,DY:66,dy:66,Ho:67,HO:67,ho:67,Er:68,ER:68,er:68,Tm:69,TM:69,tm:69,Yb:70,YB:70,yb:70,Lu:71,LU:71,lu:71,Hf:72,HF:72,hf:72,Ta:73,TA:73,ta:73,W:74,w:74,Re:75,RE:75,re:75,Os:76,OS:76,os:76,Ir:77,IR:77,ir:77,Pt:78,PT:78,pt:78,Au:79,AU:79,au:79,Hg:80,HG:80,hg:80,Tl:81,TL:81,tl:81,Pb:82,PB:82,pb:82,Bi:83,BI:83,bi:83,Po:84,PO:84,po:84,At:85,AT:85,at:85,Rn:86,RN:86,rn:86,Fr:87,FR:87,fr:87,Ra:88,RA:88,ra:88,Ac:89,AC:89,ac:89,Th:90,TH:90,th:90,Pa:91,PA:91,pa:91,U:92,u:92,Np:93,NP:93,np:93,Pu:94,PU:94,pu:94,Am:95,AM:95,am:95,Cm:96,CM:96,cm:96,Bk:97,BK:97,bk:97,Cf:98,CF:98,cf:98,Es:99,ES:99,es:99,Fm:100,FM:100,fm:100,Md:101,MD:101,md:101,No:102,NO:102,no:102,Lr:103,LR:103,lr:103,Rf:104,RF:104,rf:104,Db:105,DB:105,db:105,Sg:106,SG:106,sg:106,Bh:107,BH:107,bh:107,Hs:108,HS:108,hs:108,Mt:109,MT:109,mt:109},D5e={0:1.42,1:1.42,3:2.7,4:2.7,6:1.75,7:1.6,8:1.52,11:2.7,12:2.7,13:2.7,14:1.9,15:2,16:1.9,17:1.8,19:2.7,20:2.7,21:2.7,22:2.7,23:2.7,24:2.7,25:2.7,26:2.7,27:2.7,28:2.7,29:2.7,30:2.7,31:2.7,33:2.68,37:2.7,38:2.7,39:2.7,40:2.7,41:2.7,42:2.7,43:2.7,44:2.7,45:2.7,46:2.7,47:2.7,48:2.7,49:2.7,50:2.7,55:2.7,56:2.7,57:2.7,58:2.7,59:2.7,60:2.7,61:2.7,62:2.7,63:2.7,64:2.7,65:2.7,66:2.7,67:2.7,68:2.7,69:2.7,70:2.7,71:2.7,72:2.7,73:2.7,74:2.7,75:2.7,76:2.7,77:2.7,78:2.7,79:2.7,80:2.7,81:2.7,82:2.7,83:2.7,87:2.7,88:2.7,89:2.7,90:2.7,91:2.7,92:2.7,93:2.7,94:2.7,95:2.7,96:2.7,97:2.7,98:2.7,99:2.7,100:2.7,101:2.7,102:2.7,103:2.7,104:2.7,105:2.7,106:2.7,107:2.7,108:2.7,109:2.88},R5e={0:.8,20:1.31,27:1.2,35:1.15,44:1.1,54:1,60:1.84,72:1.88,84:1.75,85:1.56,86:1.76,98:1.6,99:1.68,100:1.63,112:1.6,113:1.59,114:1.36,129:1.45,135:1.47,144:1.6,152:1.45,170:1.4,180:1.55,202:2.4,222:2.24,224:1.91,225:1.98,243:2.02,269:2,293:1.9,316:1.8,420:2.37,480:2.3,512:2.3,544:2.3,612:2.1,629:1.54,665:1,813:2.6,854:2.27,894:1.93,896:2.1,937:2.05,938:2.06,981:1.62,1258:2.68,1309:2.33,1484:1,1763:2.14,1823:2.48,1882:2.1,1944:1.72,2380:2.34,3367:2.44,3733:2.11,3819:2.6,3821:2.36,4736:2.75,5724:2.73,5959:2.63,6519:2.84,6750:2.87,8991:2.81},G7=2.001,Q1=function(){for(var e=["LI","NA","K","RB","CS","FR","BE","MG","CA","SR","BA","RA","AL","GA","IN","SN","TL","PB","BI","SC","TI","V","CR","MN","FE","CO","NI","CU","ZN","Y","ZR","NB","MO","TC","RU","RH","PD","AG","CD","LA","HF","TA","W","RE","OS","IR","PT","AU","HG","AC","RF","DB","SG","BH","HS","MT","CE","PR","ND","PM","SM","EU","GD","TB","DY","HO","ER","TM","YB","LU","TH","PA","U","NP","PU","AM","CM","BK","CF","ES","FM","MD","NO","LR"],t=new Set,r=0,n=e;r<n.length;r++){var i=n[r];t.add(gO[i])}return t}();function k5e(e,t){return e<t?(e+t)*(e+t+1)/2+t:(e+t)*(e+t+1)/2+e}function wg(e){var t=gO[e];return t===void 0?-1:t}function tQ(e,t){if(e<0||t<0)return-1;var r=R5e[k5e(e,t)];return r===void 0?-1:r}function t_(e){if(e<0)return G7;var t=D5e[e];return t===void 0?G7:t}var O5e=gO.H;function Z1(e){return e===O5e}function rQ(e,t,r,n,i,a){for(var o=new bo.EdgeBuilder(i,e,t),s=new Uint16Array(o.slotCount),u=new Int8Array(o.slotCount),l=0,c=o.edgeCount;l<c;l++)o.addNextEdge(),o.assignProperty(s,n[l]),o.assignProperty(u,r[l]);return o.createGraph({flags:s,order:u},{canRemap:a})}var q7=_(),W7=_();function L5e(e,t,r){return e.conformation.position(t,q7),e.conformation.position(r,W7),_.distance(q7,W7)}var N5e=new Set;function F5e(e){for(var t=fa.Provider.get(e.model),r=e.elements,n=e.model.atomicHierarchy.atoms.type_symbol,i=e.elements.length,a=t.edgeProps,o=e.model.atomicHierarchy.atomSourceIndex,s=Wt.getInvertedAtomSourceIndex(e.model).invertedIndex,u=[],l=[],c=[],d=[],f=0;f<i;f++)for(var h=r[f],v=n.value(h)==="H",p=o.value(h),m=t.offset[p],g=t.offset[p+1];m<g;++m){var y=s[t.b[m]];if(!(h>=y)){var b=Je.indexOf(e.elements,y);if(!(b<0)&&!(v&&n.value(y)==="H")){var S=a.distance[m];(S===-1||S===void 0||hn(L5e(e,h,y),S,.5))&&(u[u.length]=f,l[l.length]=b,d[d.length]=a.order[m],c[c.length]=a.flag[m])}}}return rQ(u,l,d,c,i,!1)}function B5e(e,t){for(var r=4,n=e.model.atomicConformation,i=n.x,a=n.y,o=n.z,s=e.elements.length,u=e.elements,l=e.residueIndex,c=e.chainIndex,d=e.model.atomicHierarchy.atoms,f=d.type_symbol,h=d.label_atom_id,v=d.label_alt_id,p=d.label_comp_id,m=e.model.atomicHierarchy.residues.label_seq_id,g=e.model.atomicHierarchy.index,y=e.model.sequence.byEntityKey,b=e.lookup3d,S=El.Provider.get(e.model),x=K1.Provider.get(e.model),C=El.isExhaustive(e.model),w=[],A=[],M=[],D=[],k=-1,R=void 0,L=!0,H=!0,B=!0,j=N5e,Q=0;Q<s;Q++){var G=u[Q],W=f.value(G);L&&(W!=="H"||W!=="O")&&(L=!1);var q=t.forceCompute?void 0:S&&S.byAtomIndex.get(G),ee=!1;if(q)for(var he=0,$=q;he<$.length;he++){var X=$[he],U=X.partnerA,z=X.partnerB;if(U.symmetry===z.symmetry){var J=U.atomIndex===G?z:U,Y=Je.indexOf(e.elements,J.atomIndex);Y<0||(w[w.length]=Q,A[A.length]=Y,M[M.length]=X.flags,D[D.length]=X.order,ee||j.clear(),ee=!0,j.add(Y))}}if(!C){var Z=l[G],te=m.value(Z),le=p.value(G);if(!t.forceCompute&&Z!==k)if(x&&x.entries.has(le)){var ye=y[g.getEntityFromChain(c[G])];ye&&ye.sequence.microHet.has(te)?R=void 0:R=x.entries.get(le).map}else R=void 0;k=Z;for(var be=wg(W),Ee=h.value(G),Se=R?R.get(Ee):void 0,ie=b.find(i[G],a[G],o[G],r),oe=ie.indices,O=ie.count,V=ie.squaredDistances,pe=Z1(be),_e=t_(be),Pe=v.value(G),je=Q1.has(be),ze=0;ze<O;ze++){var Y=oe[ze];if(!(ee&&j.has(Y))){var Xe=u[Y];if(!(Xe<=G)){var ct=v.value(Xe);if(!(Pe&&ct&&Pe!==ct)){var Ne=wg(f.value(Xe)),Qe=Z1(Ne);if(!(pe&&Qe)){var it=(je||Q1.has(Ne))&&!(pe||Qe),ot=l[Xe];if(Z===ot&&Se){var dt=Se.get(h.value(Xe));if(dt){w[w.length]=Q,A[A.length]=Y,D[D.length]=dt.order;var Re=dt.flags;it&&(Re|1&&(Re^=1),Re|=2),M[M.length]=Re}continue}var Ie=Math.sqrt(V[ze]);if(Ie!==0){var Ye=tQ(be,Ne),tt=Ye>0?Ye:Ne<0?_e:(_e+t_(Ne))/1.95;if(Ie<=tt){w[w.length]=Q,A[A.length]=Y,D[D.length]=e5e(le,Ee,h.value(Xe)),M[M.length]=(it?2:1)|32;var xt=m.value(ot);te===xt&&(H=!1),Math.abs(te-xt)>1&&(B=!1)}}}}}}}}}var pt=L||H&&B;return rQ(w,A,D,M,s,pt)}function U5e(e,t){var r=E(E({},eQ),t);return r.noCompute||Wt.isCoarseGrained(e.model)?JM.Empty:!r.forceCompute&&fa.Provider.get(e.model)?F5e(e):B5e(e,r)}var yy=4,$7=_(),X7=_();function Y7(e,t,r,n){return e.conformation.position(t,$7),r.conformation.position(n,X7),_.distance($7,X7)}var j5e=ue(),yh=_();function z5e(e,t,r,n){var i=e.elements,a=e.residueIndex,o=e.model.atomicConformation,s=o.x,u=o.y,l=o.z,c=t.elements,d=t.residueIndex,f=e.elements.length,h=e.model.atomicHierarchy.atoms,v=h.type_symbol,p=h.label_alt_id,m=h.label_atom_id,g=h.label_comp_id,y=t.model.atomicHierarchy.atoms,b=y.type_symbol,S=y.label_alt_id,x=y.label_atom_id,C=y.label_comp_id,w=e.model.atomicHierarchy.residues.auth_seq_id,A=t.model.atomicHierarchy.residues.auth_seq_id,M=e.model.atomicConformation.occupancy,D=t.model.atomicConformation.occupancy,k=M.isDefined&&D.isDefined,R=e.model===t.model&&El.Provider.get(e.model),L=!r.forceCompute&&e.model===t.model&&fa.Provider.get(e.model),H=e.model.atomicHierarchy.atomSourceIndex,B=(L?Wt.getInvertedAtomSourceIndex(t.model):{invertedIndex:void 0}).invertedIndex,j=e.model===t.model&&El.isExhaustive(e.model),Q=ue.mul(j5e,t.conformation.operator.inverse,e.conformation.operator.matrix),G=!ue.isIdentity(Q),W=t.boundary.sphere,q=W.center,ee=W.radius,he=(ee+yy)*(ee+yy);n.startUnitPair(e.id,t.id);for(var $=0;$<f;$++){var X=i[$];if(_.set(yh,s[X],u[X],l[X]),G&&_.transformMat4(yh,yh,Q),!(_.squaredDistance(yh,q)>he)){if(!r.forceCompute&&L){for(var U=L.edgeProps,z=U.order,J=U.distance,Y=U.flag,Z=H.value(X),te=L.offset[Z],le=L.offset[Z+1];te<le;++te){var ye=B[L.b[te]],be=Je.indexOf(t.elements,ye);if(!(be<0)&&!(v.value(X)==="H"&&b.value(ye)==="H")){var Ee=J[te];Ee!==-1&&hn(Y7(e,X,t,ye),Ee,.5)&&n.add($,be,{order:z[te],flag:Y[te]})}}continue}var Se=r.forceCompute?void 0:R&&R.byAtomIndex.get(X);if(Se&&Se.length){for(var ie=!1,oe=0,O=Se;oe<O.length;oe++){var V=O[oe],pe=V.partnerA,_e=V.partnerB,Pe=pe.atomIndex===X?_e:pe,be=Je.indexOf(t.elements,Pe.atomIndex);be<0||Y7(e,X,t,Pe.atomIndex)>yy||(n.add($,be,{order:V.order,flag:V.flags}),ie=!0)}if(ie)continue}if(!j){var je=M.value(X),ze=t.lookup3d,Xe=ze.find(yh[0],yh[1],yh[2],yy),ct=Xe.indices,Ne=Xe.count,Qe=Xe.squaredDistances;if(Ne!==0)for(var it=wg(v.value(X)),ot=Z1(it),dt=t_(it),Re=p.value(X),Ie=Q1.has(it),Ye=m.value(X),tt=g.value(a[X]),xt=0;xt<Ne;xt++){var be=ct[xt],ye=c[be],pt=S.value(ye);if(!(Re&&pt&&Re!==pt)&&!(k&&D.value(ye)<1&&je<1&&w.value(X)===A.value(ye))){var ut=wg(b.value(ye)),fe=Z1(ut);if(!(ot&&fe)){var me=(Ie||Q1.has(ut))&&!(ot||fe),we=Math.sqrt(Qe[xt]);if(we!==0){var Ke=tQ(it,ut),gt=Ke>0?Ke:ut<0?dt:(dt+t_(ut))/1.95;if(we<=gt){var Pt=x.value(ye),$t=C.value(d[ye]);n.add($,be,{order:$K(tt,$t,Ye,Pt),flag:(me?2:1)|32})}}}}}}}}n.finishUnitPair()}function V5e(e,t){var r=new Wp.Builder;if(t.noCompute||e.isCoarseGrained)return new Wy(r.getMap());var n=e.models.length===1&&fa.Provider.get(e.model);if(n){for(var i=n.edgeProps.distance,a=!1,o=0,s=i.length;o<s;++o)if(i[o]!==-1){a=!0;break}if(!a)return new Wy(r.getMap())}return $e.eachUnitPair(e,function(u,l){z5e(u,l,t,r)},{maxRadius:yy,validUnit:function(u){return Ue.isAtomic(u)},validUnitPair:function(u,l){return t.validUnitPair(e,u,l)}}),new Wy(r.getMap())}function H5e(e,t){return V5e(e,E(E({},eQ),{validUnitPair:t&&t.validUnitPair||function(r,n,i){var a=n.model.atomicHierarchy.derived.residue.moleculeType,o=i.model.atomicHierarchy.derived.residue.moleculeType,s=(!Ue.isAtomic(n)||a[n.residueIndex[n.elements[0]]]!==2)&&(!Ue.isAtomic(i)||o[i.residueIndex[i.elements[0]]]!==2);return $e.validUnitPair(r,n,i)&&s}}))}var Vt;(function(e){function t(p,m,g,y,b,S){return{kind:"bond-location",aStructure:p,aUnit:m,aIndex:g,bStructure:y,bUnit:b,bIndex:S}}e.Location=t;function r(p){return!!p&&p.kind==="bond-location"}e.isLocation=r;function n(p,m){return p.aStructure.label===m.aStructure.label&&p.bStructure.label===m.bStructure.label&&p.aIndex===m.aIndex&&p.bIndex===m.bIndex&&p.aUnit.id===m.aUnit.id&&p.bUnit.id===m.bUnit.id}e.areLocationsEqual=n;function i(p,m){return{kind:"bond-loci",structure:p,bonds:m}}e.Loci=i;function a(p){return!!p&&p.kind==="bond-loci"}e.isLoci=a;function o(p,m){if(p.structure!==m.structure||p.bonds.length!==m.bonds.length)return!1;for(var g=0,y=p.bonds.length;g<y;++g)if(!n(p.bonds[g],m.bonds[g]))return!1;return!0}e.areLociEqual=o;function s(p){return p.bonds.length===0}e.isLociEmpty=s;function u(p,m){if(m===p.structure)return p;var g=[];return p.bonds.forEach(function(y){var b=m.unitMap.get(y.aUnit.id);if(b){var S=m.unitMap.get(y.bUnit.id);if(S){var x=y.aUnit.elements[y.aIndex],C=Je.indexOf(b.elements,x);if(C!==-1){var w=y.bUnit.elements[y.bIndex],A=Je.indexOf(S.elements,w);A!==-1&&g.push(t(p.structure,b,C,p.structure,S,A))}}}}),i(m,g)}e.remapLoci=u;function l(p){for(var m=[],g=new Map,y=0,b=p.bonds;y<b.length;y++){var S=b[y],x=S.aIndex,C=S.aUnit,w=S.bIndex,A=S.bUnit;C===A?g.has(C.id)?g.get(C.id).push(x,w):g.set(C.id,[x,w]):(g.has(C.id)?g.get(C.id).push(x):g.set(C.id,[x]),g.has(A.id)?g.get(A.id).push(w):g.set(A.id,[w]))}return g.forEach(function(M,D){m.push({unit:p.structure.unitMap.get(D),indices:Je.deduplicate(Je.ofUnsortedArray(M))})}),De(p.structure,m)}e.toStructureElementLoci=l;function c(p,m){if(m.aUnit===m.bUnit){var g=m.aUnit.bonds,y=g.getEdgeIndex(m.aIndex,m.bIndex);return y<0?Nr.create(0):Nr.create(g.edgeProps.flags[y])}else{var b=p.interUnitBonds.getBondFromLocation(m);return b?Nr.create(b.props.flag):Nr.create(0)}}e.getType=c;function d(p,m){if(m.aUnit===m.bUnit){var g=m.aUnit.bonds,y=g.getEdgeIndex(m.aIndex,m.bIndex);return y<0?0:g.edgeProps.order[y]}else{var b=p.interUnitBonds.getBondFromLocation(m);return b?b.props.order:0}}e.getOrder=d;function f(p){for(var m=0,g=0,y=p.units.length;g<y;++g){var b=p.units[g];Ue.isAtomic(b)&&(m+=b.bonds.edgeCount)}return m}e.getIntraUnitBondCount=f;var h=function(){function p(){this.current={},this.hasNext=!1}return p.prototype.move=function(){return this.advance(),this.current},p.prototype.setElement=function(m,g,y){this.structure=m,this.unit=g,this.index=y,this.interBondIndices=m.interUnitBonds.getEdgeIndices(y,g.id),this.interBondCount=this.interBondIndices.length,this.interBondIndex=0,this.intraBondEnd=g.bonds.offset[y+1],this.intraBondIndex=g.bonds.offset[y],this.hasNext=this.interBondIndex<this.interBondCount||this.intraBondIndex<this.intraBondEnd},p.prototype.advance=function(){if(this.intraBondIndex<this.intraBondEnd)this.current.otherUnit=this.unit,this.current.otherIndex=this.unit.bonds.b[this.intraBondIndex],this.current.type=this.unit.bonds.edgeProps.flags[this.intraBondIndex],this.current.order=this.unit.bonds.edgeProps.order[this.intraBondIndex],this.intraBondIndex+=1;else if(this.interBondIndex<this.interBondCount){var m=this.structure.interUnitBonds.edges[this.interBondIndex];this.current.otherUnit=this.structure.unitMap.get(m.unitA!==this.unit.id?m.unitA:m.unitB),this.current.otherIndex=m.indexA!==this.index?m.indexA:m.indexB,this.current.type=m.props.flag,this.current.order=m.props.order,this.interBondIndex+=1}else{this.hasNext=!1;return}this.hasNext=this.interBondIndex<this.interBondCount||this.intraBondIndex<this.intraBondEnd},p}();e.ElementBondIterator=h;function v(p,m){return Bc.fromPairProvider(p.bonds.length,function(g,y,b){var S=p.bonds[g],x=S.aUnit,C=S.aIndex,w=S.bUnit,A=S.bIndex;x.conformation.position(x.elements[C],y),w.conformation.position(w.elements[A],b)},m)}e.getBoundingSphere=v})(Vt||(Vt={}));function G5e(e){for(var t=W5e(e),r=q5e(e,t),n=nr.transientSegments(e.model.atomicHierarchy.residueAtomSegments,e.elements);n.hasNext;){var i=n.move();$5e(r,i.start,i.end)}return r.rings}function q5e(e,t){return{startVertex:0,endVertex:0,count:0,visited:new Int32Array(t),queue:new Int32Array(t),pred:new Int32Array(t),left:new Int32Array(4),right:new Int32Array(4),color:new Int32Array(t),currentColor:0,currentAltLoc:"",hasAltLoc:!1,rings:[],currentRings:[],unit:e,bonds:e.bonds,altLoc:e.model.atomicHierarchy.atoms.label_alt_id}}function K7(e){e.count=e.endVertex-e.startVertex;for(var t=e.visited,r=e.pred,n=e.color,i=0;i<e.count;i++)t[i]=-1,r[i]=-1,n[i]=0;e.currentColor=0,e.currentAltLoc="",e.hasAltLoc=!1}function W5e(e){for(var t=nr.transientSegments(e.model.atomicHierarchy.residueAtomSegments,e.elements),r=0;t.hasNext;){var n=t.move();r=Math.max(r,n.end-n.start)}return r}function $5e(e,t,r){var n=e.visited;if(e.startVertex=t,e.endVertex=r,!(e.endVertex-e.startVertex<3)){e.currentRings=[];for(var i=e.unit.elements,a=[],o=e.startVertex;o<e.endVertex;o++){var s=e.altLoc.value(i[o]);Pa(a,s)}if(yp(a,""),a.length===0){K7(e);for(var o=0;o<e.count;o++)n[o]>=0||Q7(e,o)}else for(var u=0;u<a.length;u++){K7(e),e.hasAltLoc=!0,e.currentAltLoc=a[u];for(var o=0;o<e.count;o++)if(!(n[o]>=0)){var s=e.altLoc.value(i[e.startVertex+o]);s&&s!==e.currentAltLoc||Q7(e,o)}}for(var o=0,l=e.currentRings.length;o<l;o++)e.rings.push(e.currentRings[o])}}function X5e(e,t,r){if(!(r<t)){for(var n=e.pred,i=e.color,a=e.left,o=e.right,s=++e.currentColor,u=t,l=0;l<4&&(i[u]=s,u=n[u],!(u<0));l++);var c=0,d=0,f=!1,h=0;u=r;for(var l=0;l<4;l++){if(i[u]===s){h=u,f=!0;break}if(o[d++]=u,u=n[u],u<0)break}if(f){u=t;for(var l=0;l<4&&(a[c++]=u,!(h===u||(u=n[u],u<0)));l++);var v=c+d;if(!(v<3)){for(var p=new Int32Array(v),m=0,l=0;l<c;l++)p[m++]=e.startVertex+a[l];for(var l=d-1;l>=0;l--)p[m++]=e.startVertex+o[l];if(gu(p),e.hasAltLoc)for(var g=0,y=e.currentRings.length;g<y;g++){var b=e.currentRings[g];if(p[0]===b[0]&&p.length===b.length){for(var S=!0,x=0,C=p.length;x<C;x++)if(p[x]!==b[x]){S=!1;break}if(S)return}}e.currentRings.push(Je.ofSortedArray(p))}}}}function Q7(e,t){var r=e.bonds,n=e.startVertex,i=e.endVertex,a=e.visited,o=e.queue,s=e.pred,u=e.unit.elements,l=r.b,c=r.edgeProps.flags,d=r.offset;a[t]=1,o[0]=t;for(var f=0,h=1;f<h;)for(var v=o[f++],p=n+v,m=d[p],g=d[p+1],y=m;y<g;y++){var b=l[y];if(!(b<n||b>=i||!Nr.isCovalent(c[y]))){if(e.hasAltLoc){var S=e.altLoc.value(u[b]);if(S&&e.currentAltLoc!==S)continue}var x=b-n;if(a[x]>0){s[x]!==v&&s[v]!==x&&X5e(e,v,x);continue}a[x]=1,o[h++]=x,s[x]=v}}}function Y5e(e){for(var t=e.length,r=new Array(t),n=0;n<t;n++)r[n]=e[t-n-1];for(var i=Z7(e),a=Z7(r),o=!1,n=0;n<t;n++){var s=e[(n+i)%t],u=r[(n+a)%t];if(s!==u){o=s<u;break}}return o?J7(e,i):J7(r,a)}function Z7(e){for(var t=e.length,r=new Int32Array(t*2),n=0;n<r.length;n++)r[n]=-1;for(var i="",a="",o=0,s=1;s<r.length;s++){for(var n=r[s-o-1];n!==-1&&(i=e[s%t],a=e[(o+n+1)%t],i!==a);)i<a&&(o=s-n-1),n=r[n];n===-1?(i=e[s%t],a=e[(o+n+1)%t],i!==a?(i<a&&(o=s),r[s-o]=-1):r[s-o]=n+1):r[s-o]=n+1}return o}function J7(e,t){var r=e.length,n=[],i;for(i=0;i<r-1;i++)n.push(e[(i+t)%r]),n.push("-");return n.push(e[(i+t)%r]),n.join("")}function K5e(e,t){for(var r=new Map,n=new Map,i=0,a=e.length;i<a;i++)for(var o=e[i],s=0,u=o.length;s<u;s++){var l=o[s];r.has(l)?r.get(l).push(i):r.set(l,[i])}for(var c=0,d=t.length;c<d;c++)for(var i=t[c],o=e[i],s=0,u=o.length;s<u;s++){var l=o[s];n.has(l)?n.get(l).push(i):n.set(l,[i])}for(var f=new bo.UniqueEdgeBuilder(e.length),i=0,a=e.length;i<a;i++)for(var o=e[i],s=0,u=o.length;s<u;s++){var l=o[s],h=r.get(l);if(h.length!==1)for(var v=0,p=h.length;v<p;v++){var m=h[v];i>=m||f.addEdge(i,m)}}for(var g=bo.connectedComponents(f.getGraph()),y=g.componentIndex,b=[],s=0;s<g.componentCount;s++)b[s]=[];for(var i=0,a=e.length;i<a;i++)b[y[i]].push(i);return{elementRingIndices:r,elementAromaticRingIndices:n,ringComponentIndex:y,ringComponents:b}}var Ar;(function(e){function t(f,h,v){v===void 0&&(v=Float32Array);var p=f*h;return{data:new v(p),size:p,cols:f,rows:h}}e.create=t;function r(f,h,v){return f.data[f.rows*v+h]}e.get=r;function n(f,h,v,p){return f.data[f.rows*v+h]=p,f}e.set=n;function i(f,h,v,p){return f.data[f.rows*v+h]+=p,f}e.add=i;function a(f){return f.data.fill(0),f}e.makeZero=a;function o(f){return{data:f.data.slice(),size:f.size,cols:f.cols,rows:f.rows}}e.clone=o;function s(f,h,v){return{data:f,size:h*v,cols:h,rows:v}}e.fromArray=s;function u(f,h){if(f.cols!==h.rows||f.rows!==h.cols)throw new Error("transpose: matrix dimensions incompatible");if(f.data===h.data)throw new Error("transpose: matrices share memory");for(var v=h.rows,p=h.cols,m=h.data,g=f.data,y=0,b=0,S=0;y<v;S+=1,b+=p,++y)for(var x=S,C=0;C<p;x+=v,C++)g[x]=m[b+C];return f}e.transpose=u;function l(f,h,v){for(var p=h.cols,m=h.rows,g=v.rows,y=h.data,b=v.data,S=f.data,x=0,C=0,w=0;x<m;C+=p,x++)for(var A=0,M=0;M<g;w++,M++){for(var D=0,k=C,R=0;R<p;k++,A++,R++)D+=y[k]*b[A];S[w]=D}return f}e.multiplyABt=l;function c(f){for(var h=f.rows,v=f.cols,p=f.data,m=new Array(v),g=0;g<v;++g)m[g]=0;for(var y=0,b=0;y<h;++y)for(var g=0;g<v;++g,++b)m[g]+=p[b];for(var g=0;g<v;++g)m[g]/=h;return m}e.meanRows=c;function d(f,h){for(var v=f.rows,p=f.cols,m=f.data,g=0,y=0;g<v;++g)for(var b=0;b<p;++b,++y)m[y]-=h[b];return f}e.subRows=d})(Ar||(Ar={}));function TP(e,t,r,n){n=e[t],e[t]=e[r],e[r]=n}function Q5e(e,t){return e=Math.abs(e),t=Math.abs(t),e>t?(t/=e,e*Math.sqrt(1+t*t)):t>0?(e/=t,t*Math.sqrt(1+e*e)):0}var Z5e=1192092896e-16,J5e=1e-37;function eDe(e,t,r,n,i,a,o,s){for(var u=Z5e*2,l=J5e,c=0,d=0,f=0,h=0,v=Math.max(a,30),p=0,m=0,g=0,y=0,b=0,S=0,x=0,C=0,w=0,A=0,M=0,D=0,k=0,R=0,L=0,H=0,B=0,j=4660,Q=0,G=0,W=0,q=new Float64Array(o<<3);c<o;c++){for(f=0,M=0;f<a;f++)C=e[c*t+f],M+=C*C;if(q[c]=M,n){for(f=0;f<o;f++)n[c*i+f]=0;n[c*i+c]=1}}for(;h<v;h++){for(b=0,c=0;c<o-1;c++)for(d=c+1;d<o;d++){for(p=c*t|0,m=d*t|0,L=q[c],H=0,B=q[d],f=2,H+=e[p]*e[m],H+=e[p+1]*e[m+1];f<a;f++)H+=e[p+f]*e[m+f];if(!(Math.abs(H)<=u*Math.sqrt(L*B))){for(H*=2,D=L-B,k=Q5e(H,D),D<0?(R=(k-D)*.5,x=Math.sqrt(R/k),S=H/(k*x*2)):(S=Math.sqrt((k+D)/(k*2)),x=H/(k*S*2)),L=0,B=0,f=2,w=S*e[p]+x*e[m],A=-x*e[p]+S*e[m],e[p]=w,e[m]=A,L+=w*w,B+=A*A,w=S*e[p+1]+x*e[m+1],A=-x*e[p+1]+S*e[m+1],e[p+1]=w,e[m+1]=A,L+=w*w,B+=A*A;f<a;f++)w=S*e[p+f]+x*e[m+f],A=-x*e[p+f]+S*e[m+f],e[p+f]=w,e[m+f]=A,L+=w*w,B+=A*A;if(q[c]=L,q[d]=B,b=1,n)for(g=c*i|0,y=d*i|0,f=2,w=S*n[g]+x*n[y],A=-x*n[g]+S*n[y],n[g]=w,n[y]=A,w=S*n[g+1]+x*n[y+1],A=-x*n[g+1]+S*n[y+1],n[g+1]=w,n[y+1]=A;f<o;f++)w=S*n[g+f]+x*n[y+f],A=-x*n[g+f]+S*n[y+f],n[g+f]=w,n[y+f]=A}}if(b===0)break}for(c=0;c<o;c++){for(f=0,M=0;f<a;f++)C=e[c*t+f],M+=C*C;q[c]=Math.sqrt(M)}for(c=0;c<o-1;c++){for(d=c,f=c+1;f<o;f++)q[d]<q[f]&&(d=f);if(c!==d&&(TP(q,c,d,M),n)){for(f=0;f<a;f++)TP(e,c*t+f,d*t+f,C);for(f=0;f<o;f++)TP(n,c*i+f,d*i+f,C)}}for(c=0;c<o;c++)r[c]=q[c];if(n)for(c=0;c<s;c++){for(M=c<o?q[c]:0;M<=l;){for(G=1/a,f=0;f<a;f++)j=j*214013+2531011,Q=j>>16&32767&256?G:-G,e[c*t+f]=Q;for(h=0;h<2;h++)for(d=0;d<c;d++){for(M=0,f=0;f<a;f++)M+=e[c*t+f]*e[d*t+f];for(W=0,f=0;f<a;f++)C=e[c*t+f]-M*e[d*t+f],e[c*t+f]=C,W+=Math.abs(C);for(W=W?1/W:0,f=0;f<a;f++)e[c*t+f]*=W}for(M=0,f=0;f<a;f++)C=e[c*t+f],M+=C*C;M=Math.sqrt(M)}for(x=1/M,f=0;f<a;f++)e[c*t+f]*=x}}function tDe(e,t,r,n){var i=0,a=0,o=e.rows,s=e.cols,u=o,l=s;u<l&&(i=1,a=u,u=l,l=a);var c=Ar.create(u,u),d=Ar.create(1,l),f=Ar.create(l,l);if(i===0)Ar.transpose(c,e);else{for(a=0;a<s*o;a++)c.data[a]=e.data[a];for(;a<l*u;a++)c.data[a]=0}if(eDe(c.data,u,d.data,f.data,l,u,l,u),t){for(a=0;a<l;a++)t.data[a]=d.data[a];for(;a<s;a++)t.data[a]=0}i===0?(r&&Ar.transpose(r,c),n&&Ar.transpose(n,f)):(r&&Ar.transpose(r,f),n&&Ar.transpose(n,c))}var $p;(function(e){function t(u){var l=r(u),c=s(u,l);return{momentsAxes:l,boxAxes:c}}e.ofPositions=t;function r(u){if(u.length===3)return fu.create(_.fromArray(_(),u,0),_.create(1,0,0),_.create(0,1,0),_.create(0,1,0));var l=Ar.fromArray(u,3,u.length/3),c=l.rows,d=c/3,f=Ar.create(3,3),h=Ar.create(1,3),v=Ar.create(3,3),p=Ar.create(3,3),m=Ar.meanRows(l),g=Ar.subRows(Ar.clone(l),m),y=Ar.transpose(Ar.create(c,3),g);Ar.multiplyABt(f,y,y),tDe(f,h,v,p);var b=_.create(m[0],m[1],m[2]),S=_.create(v.data[0],v.data[3],v.data[6]),x=_.create(v.data[1],v.data[4],v.data[7]),C=_.create(v.data[2],v.data[5],v.data[8]);return _.scale(S,S,Math.sqrt(h.data[0]/d)),_.scale(x,x,Math.sqrt(h.data[1]/d)),_.scale(C,C,Math.sqrt(h.data[2]/d)),fu.create(b,S,x,C)}e.calculateMomentsAxes=r;var n=_(),i=_(),a=_(),o=_();function s(u,l){if(u.length===3)return fu.clone(l);for(var c=-1/0,d=-1/0,f=-1/0,h=-1/0,v=-1/0,p=-1/0,m=_(),g=_(),y=l.origin,b=_.normalize(i,l.dirA),S=_.normalize(a,l.dirB),x=_.normalize(o,l.dirC),C=0,w=u.length;C<w;C+=3){_.projectPointOnVector(m,_.fromArray(m,u,C),b,y);var A=_.dot(b,_.normalize(g,_.sub(g,m,y))),M=_.distance(m,y);A>0?M>c&&(c=M):M>d&&(d=M),_.projectPointOnVector(m,_.fromArray(m,u,C),S,y);var D=_.dot(S,_.normalize(g,_.sub(g,m,y))),k=_.distance(m,y);D>0?k>f&&(f=k):k>h&&(h=k),_.projectPointOnVector(m,_.fromArray(m,u,C),x,y);var R=_.dot(x,_.normalize(g,_.sub(g,m,y))),L=_.distance(m,y);R>0?L>v&&(v=L):L>p&&(p=L)}var H=_.setMagnitude(_(),b,(c+d)/2),B=_.setMagnitude(_(),S,(f+h)/2),j=_.setMagnitude(_(),x,(v+p)/2),Q=_(),G=function(W,q,ee){_.copy(n,y),_.scaleAndAdd(n,n,b,W),_.scaleAndAdd(n,n,S,q),_.scaleAndAdd(n,n,x,ee),_.add(Q,Q,n)};return G(c,f,v),G(c,f,-p),G(c,-h,-p),G(c,-h,v),G(-d,-h,-p),G(-d,-h,v),G(-d,f,v),G(-d,f,-p),_.scale(Q,Q,1/8),fu.create(Q,H,B,j)}e.calculateBoxAxes=s})($p||($p={}));var r_=function(){function e(t,r){this.unit=r,this.all=t}return Object.defineProperty(e.prototype,"index",{get:function(){return this._index?this._index:(this._index=K5e(this.all,this.aromaticRings),this._index)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"byFingerprint",{get:function(){return this._byFingerprint?this._byFingerprint:(this._byFingerprint=rDe(this.unit,this.all),this._byFingerprint)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"elementRingIndices",{get:function(){return this.index.elementRingIndices},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"elementAromaticRingIndices",{get:function(){return this.index.elementAromaticRingIndices},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"ringComponentIndex",{get:function(){return this.index.ringComponentIndex},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"ringComponents",{get:function(){return this.index.ringComponents},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"aromaticRings",{get:function(){return this._aromaticRings?this._aromaticRings:(this._aromaticRings=aDe(this.unit,this.all),this._aromaticRings)},enumerable:!1,configurable:!0}),e}(),As;(function(e){function t(s,u){for(var l=s.elements,c=s.model.atomicHierarchy.atoms.type_symbol,d=[],f=0,h=u.length;f<h;f++)d[d.length]=c.value(l[u[f]]);return r(d)}e.fingerprint=t;function r(s){return Y5e(s)}e.elementFingerprint=r;var n=new Set(["B","C","N","O","SI","P","S","GE","AS","SN","SB","BI"]),i=.05;function a(s,u){var l=s.elements,c=s.bonds,d=c.b,f=c.offset,h=c.edgeProps.flags,v=s.model.atomicHierarchy.atoms,p=v.type_symbol,m=v.label_comp_id;if(m.value(s.elements[u[0]])==="PRO")return!1;for(var g=0,y=!1,b=0,S=u.length;b<S;++b){var x=u[b];!y&&n.has(p.value(l[x]))&&(y=!0);for(var C=f[x],w=f[x+1];C<w;++C)Nr.is(16,h[C])&&Je.has(u,d[C])&&(g+=1)}if(g===2*u.length)return!0;if(!y)return!1;var A=$p.calculateMomentsAxes(TK(s,u));return _.magnitude(A.dirC)<i}e.isAromatic=a;function o(s,u){for(var l=s.model.atomicHierarchy.atoms.label_alt_id,c=s.elements,d=0,f=u.length;d<f;++d){var h=c[u[d]],v=l.value(h);if(v)return v}return""}e.getAltId=o})(As||(As={}));(function(e){function t(n){var i=G5e(n);return new e(i,n)}e.create=t;function r(n,i){for(var a=new Map,o=0,s=i.length;o<s;o++){var u=i[o];iDe(n,u,a)}return a}e.byFingerprintAndResidue=r})(r_||(r_={}));function rDe(e,t){for(var r=new Map,n=0,i=0,a=t.length;i<a;i++){var o=t[i],s=As.fingerprint(e,o);r.has(s)?r.get(s).push(n):r.set(s,[n]),n++}return r}function nDe(e,t){for(var r=e.elements,n=e.model.atomicHierarchy.residueAtomSegments.index,i=n[r[t[0]]],a=1,o=t.length;a<o;a++)if(i!==n[r[t[a]]])return-1;return i}function iDe(e,t,r){var n=e.byFingerprint.get(t);if(n)for(var i=0,a=n.length;i<a;i++){var o=n[i],s=nDe(e.unit,e.all[o]);s>=0&&(r.has(s)?r.get(s).push(o):r.set(s,[o]))}}function aDe(e,t){for(var r=[],n=0,i=t.length;n<i;++n)As.isAromatic(e,t[n])&&r.push(n);return r}var Qr;(function(e){function t(S){return Je.ofSortedArray(S)}e.ofSortedRanges=t;function r(S){return S[0]}e.start=r;function n(S){return S[S.length-1]+1}e.end=n;function i(S){return S[0]}e.min=i;function a(S){return S[S.length-1]}e.max=a;function o(S){for(var x=0,C=0,w=S.length;C<w;C+=2)x+=S[C+1]-S[C]+1;return x}e.size=o;function s(S){return S.length/2}e.count=s;function u(S,x){return S[x*2]}e.startAt=u;function l(S,x){return S[x*2+1]+1}e.endAt=l;function c(S,x){return S[x*2]}e.minAt=c;function d(S,x){return S[x*2+1]}e.maxAt=d;function f(S,x){if(S.length!==x.length)return!1;for(var C=0,w=S.length;C<w;++C)if(S[C]!==x[C])return!1;return!0}e.areEqual=f;function h(S,x){for(var C=0,w=0,A=S.length;w<A;w+=2)for(var M=S[w],D=S[w+1];M<=D;++M)x(M,C),++C}e.forEach=h;function v(S,x){return m(S,x)!==-1}e.has=v;function p(S,x,C){return g(S,x,C)!==-1}e.hasFrom=p;function m(S,x){return g(S,x,0)}e.firstIntersectionIndex=m;function g(S,x,C){if(c(S,C)>Oe.max(x)||a(S)<Oe.min(x))return-1;for(var w=C,A=s(S);w<A;++w){var M=Te.ofRange(c(S,w),d(S,w));if(Oe.areIntersecting(M,x))return w}return-1}e.firstIntersectionIndexFrom=g;function y(S,x){return new b(S,x)}e.transientSegments=y;var b=function(){function S(x,C){this.ranges=x,this.set=C,this.value={index:0,start:0,end:0},this.curIndex=0,this.hasNext=!1,this.curIndex=m(x,C),this.hasNext=this.curIndex!==-1}return S.prototype.updateValue=function(){this.value.index=this.curIndex,this.value.start=Oe.findPredecessorIndex(this.set,u(this.ranges,this.curIndex)),this.value.end=Oe.findPredecessorIndex(this.set,l(this.ranges,this.curIndex))},S.prototype.move=function(){return this.hasNext&&(this.updateValue(),this.curIndex=g(this.ranges,this.set,this.curIndex+1),this.hasNext=this.curIndex!==-1),this.value},S}();e.Iterator=b})(Qr||(Qr={}));function oDe(e){for(var t=[],r=e.elements,n=e.model,i=e.model.atomicHierarchy.residueAtomSegments,a=n.atomicHierarchy.derived.residue.traceElementIndex,o=Qr.transientSegments(e.model.atomicRanges.polymerRanges,r),s=nr.transientSegments(i,r);o.hasNext;){var u=o.move();for(s.setSegment(u);s.hasNext;){var l=s.move(),c=l.start,d=l.end,f=l.index;if(Oe.areIntersecting(Te.ofRange(r[c],r[d-1]),r)){var h=a[f];t.push(h===-1?i.offsets[f]:h)}}}return Je.ofSortedArray(t)}function sDe(e){for(var t=[],r=e.elements,n=e.model,i=n.coarseHierarchy,a=i.spheres,o=i.gaussians,s=Ue.isSpheres(e)?a.polymerRanges:o.polymerRanges,u=Qr.transientSegments(s,r);u.hasNext;)for(var l=u.move(),c=l.start,d=l.end,f=c;f<d;++f)t.push(r[f]);return Je.ofSortedArray(t)}function uDe(e){for(var t=[],r=e.elements,n=e.model,i=e.residueIndex,a=e.model.atomicHierarchy.residueAtomSegments,o=n.atomicHierarchy.derived.residue.traceElementIndex,s=Qr.transientSegments(e.model.atomicRanges.gapRanges,e.elements);s.hasNext;){var u=s.move(),l=i[r[u.start]],c=i[r[u.end-1]],d=o[l],f=o[c];t.push(d===-1?a.offsets[l]:d),t.push(f===-1?a.offsets[c]:f)}return Je.ofSortedArray(t)}function lDe(e){for(var t=[],r=e.elements,n=e.model,i=n.coarseHierarchy,a=i.spheres,o=i.gaussians,s=Ue.isSpheres(e)?a.gapRanges:o.gapRanges,u=Qr.transientSegments(s,r);u.hasNext;){var l=u.move(),c=l.start,d=l.end;t.push(r[c],r[d-1])}return Je.ofSortedArray(t)}function cDe(e){for(var t=[],r=e.elements,n=e.model,i=n.atomicHierarchy,a=i.chainAtomSegments,o=i.residueAtomSegments,s=n.atomicHierarchy.derived.residue,u=s.moleculeType,l=s.traceElementIndex,c=nr.transientSegments(a,r),d=nr.transientSegments(o,r);c.hasNext;)for(d.setSegment(c.move());d.hasNext;){var f=d.move().index;if(Il(u[f])){var h=l[f];t.push(h===-1?o.offsets[f]:h)}}return Je.ofSortedArray(t)}function dDe(e){for(var t=[],r=e.elements,n=e.model,i=n.atomicHierarchy,a=i.chainAtomSegments,o=i.residueAtomSegments,s=n.atomicHierarchy.derived.residue,u=s.moleculeType,l=s.traceElementIndex,c=nr.transientSegments(a,r),d=nr.transientSegments(o,r);c.hasNext;)for(d.setSegment(c.move());d.hasNext;){var f=d.move().index;if(PK(u[f])){var h=l[f];t.push(h===-1?o.offsets[f]:h)}}return Je.ofSortedArray(t)}var e9=_.zero();function fDe(e){for(var t=e.conformation.invariantPosition,r=e.elements,n=new Float32Array(r.length*3),i=0,a=r.length;i<a;i++)t(r[i],e9),_.toArray(e9,n,i*3);return n}function t9(e){var t=fDe(e);return $p.ofPositions(t)}var rs=function(){function e(t){this.minDist=[],this.maxDist=[],this.extrema=[],this.centroidHelper=new Bc,this.dir=hDe(t),this.reset()}return e.prototype.computeExtrema=function(t,r){var n=_.dot(this.dir[t],r);n<this.minDist[t]&&(this.minDist[t]=n,_.copy(this.extrema[t*2],r)),n>this.maxDist[t]&&(this.maxDist[t]=n,_.copy(this.extrema[t*2+1],r))},e.prototype.computeSphereExtrema=function(t,r,n){var i=_.dot(this.dir[t],r);i-n<this.minDist[t]&&(this.minDist[t]=i-n,_.scaleAndSub(this.extrema[t*2],r,this.dir[t],n)),i+n>this.maxDist[t]&&(this.maxDist[t]=i+n,_.scaleAndAdd(this.extrema[t*2+1],r,this.dir[t],n))},e.prototype.includeSphere=function(t){if(Fe.hasExtrema(t)&&t.extrema.length>1)for(var r=0,n=t.extrema;r<n.length;r++){var i=n[r];this.includePosition(i)}else this.includePositionRadius(t.center,t.radius)},e.prototype.includePosition=function(t){for(var r=0,n=this.dir.length;r<n;++r)this.computeExtrema(r,t)},e.prototype.includePositionRadius=function(t,r){for(var n=0,i=this.dir.length;n<i;++n)this.computeSphereExtrema(n,t,r)},e.prototype.finishedIncludeStep=function(){for(var t=0;t<this.extrema.length;t++)this.centroidHelper.includeStep(this.extrema[t]);this.centroidHelper.finishedIncludeStep()},e.prototype.radiusSphere=function(t){if(Fe.hasExtrema(t)&&t.extrema.length>1)for(var r=0,n=t.extrema;r<n.length;r++){var i=n[r];this.radiusPosition(i)}else this.radiusPositionRadius(t.center,t.radius)},e.prototype.radiusPosition=function(t){this.centroidHelper.radiusStep(t)},e.prototype.radiusPositionRadius=function(t,r){this.centroidHelper.radiusSphereStep(t,r)},e.prototype.getSphere=function(t){return Fe.setExtrema(this.centroidHelper.getSphere(t),Ft([],this.extrema))},e.prototype.getBox=function(t){return Xt.fromVec3Array(t||Xt(),this.extrema)},e.prototype.reset=function(){for(var t=0,r=this.dir.length;t<r;++t)this.minDist[t]=1/0,this.maxDist[t]=-1/0,this.extrema[t*2]=_(),this.extrema[t*2+1]=_();this.centroidHelper.reset()},e}();function hDe(e){var t;switch(e){case"6":t=Ft([],H2);break;case"14":t=Ft(Ft([],H2),IP);break;case"26":t=Ft(Ft(Ft([],H2),IP),r9);break;case"98":t=Ft(Ft(Ft(Ft(Ft(Ft([],H2),IP),r9),pDe),vDe),mDe);break}return t.map(function(r){var n=_.create(r[0],r[1],r[2]);return _.normalize(n,n)})}var H2=[[1,0,0],[0,1,0],[0,0,1]],IP=[[1,1,1],[-1,1,1],[-1,-1,1],[1,-1,1]],r9=[[1,1,0],[1,-1,0],[1,0,1],[1,0,-1],[0,1,1],[0,1,-1]],pDe=[[0,1,2],[0,2,1],[1,0,2],[2,0,1],[1,2,0],[2,1,0],[0,1,-2],[0,2,-1],[1,0,-2],[2,0,-1],[1,-2,0],[2,-1,0]],vDe=[[1,1,2],[2,1,1],[1,2,1],[1,-1,2],[1,1,-2],[1,-1,-2],[2,-1,1],[2,1,-1],[2,-1,-1],[1,-2,1],[1,2,-1],[1,-2,-1]],mDe=[[2,2,1],[1,2,2],[2,1,2],[2,-2,1],[2,2,-1],[2,-2,-1],[1,-2,2],[1,2,-2],[1,-2,-2],[2,-1,2],[2,1,-2],[2,-1,-2]],n9=_.set,gDe=new rs("14"),yDe=new rs("98");function bDe(e){return e>1e4?gDe:yDe}var G2=_();function Eg(e){var t=e.x,r=e.y,n=e.z,i=e.radius,a=e.indices,o=Oe.size(a);if(o>25e4){var s=Xt.computeBounding(e);return{box:s,sphere:Fe.fromBox3D(Fe(),s)}}var u=bDe(o);u.reset();for(var l=0;l<o;l++){var c=Oe.getAt(a,l);n9(G2,t[c],r[c],n[c]),u.includePositionRadius(G2,i&&i[c]||0)}u.finishedIncludeStep();for(var l=0;l<o;l++){var c=Oe.getAt(a,l);n9(G2,t[c],r[c],n[c]),u.radiusPositionRadius(G2,i&&i[c]||0)}var d=u.getSphere();if(!i&&Fe.hasExtrema(d)&&o<=d.extrema.length){for(var f=[],l=0;l<o;l++){var c=Oe.getAt(a,l);f.push(_.create(t[c],r[c],n[c]))}Fe.setExtrema(d,f)}return{box:u.getBox(),sphere:d}}var xDe=function(){function e(){this.data=new Map}return e.prototype.get=function(t){var r=Je.hashCode(t);if(this.data.has(r))for(var n=0,i=this.data.get(r);n<i.length;n++){var a=i[n],o=a[0],s=a[1];if(Je.areEqual(t,o))return s}},e.prototype.set=function(t,r){var n=Je.hashCode(t);if(this.data.has(n)){for(var i=this.data.get(n),a=0,o=i;a<o.length;a++){var s=o[a];if(Je.areEqual(t,s[0])){s[1]=r;return}}i.push([t,r])}else this.data.set(n,[[t,r]])},e.get=function(t){return t._dynamicPropertyData.ElementSetIntraBondCache||(t._dynamicPropertyData.ElementSetIntraBondCache=new e),t._dynamicPropertyData.ElementSetIntraBondCache},e}(),Ue;(function(e){function t(B){return B.kind===0}e.isAtomic=t;function r(B){return B.kind===1||B.kind===2}e.isCoarse=r;function n(B){return B.kind===1}e.isSpheres=n;function i(B){return B.kind===2}e.isGaussians=i;function a(B,j,Q,G,W,q,ee,he,$){switch(W){case 0:return new v(B,j,Q,G,q,he,pn.createMapping(ee,q.atomicConformation,void 0),$??p());case 1:return x(B,j,Q,G,q,1,he,pn.createMapping(ee,q.coarseConformation.spheres,f(q)),$??y());case 2:return x(B,j,Q,G,q,2,he,pn.createMapping(ee,q.coarseConformation.gaussians,h()),$??y())}}e.create=a;function o(B){for(var j=Ls.Mutable(),Q=0,G=B.length;Q<G;Q++)j.set(B[Q].id,Q);return j}function s(B){for(var j=[],Q=0,G=B.length;Q<G;Q++)j.push(B[Q].id);return La(j)}function u(B){var j={};return{elements:B[0].elements,units:B,get unitIndexMap(){return j.unitIndexMap||(j.unitIndexMap=o(B)),j.unitIndexMap},hashCode:c(B[0]),transformHash:s(B)}}e.SymmetryGroup=u,function(B){function j(G,W){return G.hashCode!==W.hashCode?!1:Je.areEqual(G.elements,W.elements)}B.areInvariantElementsEqual=j;function Q(G){for(var W=Ls.Mutable(),q=0,ee=G.length;q<ee;++q)for(var he=G[q],$=0,X=he.units.length;$<X;++$)W.set(he.units[$].id,q);return W}B.getUnitSymmetryGroupsIndexMap=Q}(u=e.SymmetryGroup||(e.SymmetryGroup={}));function l(B){return e.isAtomic(B)?B.model.atomicConformation.id:B.model.coarseConformation.id}e.conformationId=l;function c(B){return cv(B.invariantId,Je.hashCode(B.elements))}e.hashUnit=c,function(B){B.is=da.has,B.create=da.create}(e.Traits||(e.Traits={}));function d(){return{}}function f(B){var j=B.coarseConformation.spheres.radius;return function(Q){return j[Q]}}function h(B){return function(j){return 0}}var v=function(){function B(j,Q,G,W,q,ee,he,$){this.kind=0,this.objectPrimitive="atomistic",this.id=j,this.invariantId=Q,this.chainGroupId=G,this.traits=W,this.model=q,this.elements=ee,this.conformation=he,this.residueIndex=q.atomicHierarchy.residueAtomSegments.index,this.chainIndex=q.atomicHierarchy.chainAtomSegments.index,this.props=$}return B.prototype.getChild=function(j){return j.length===this.elements.length?this:new B(this.id,this.invariantId,this.chainGroupId,this.traits,this.model,j,this.conformation,p())},B.prototype.applyOperator=function(j,Q,G){G===void 0&&(G=!1);var W=G?Q:pn.compose(this.conformation.operator,Q);return new B(j,this.invariantId,this.chainGroupId,this.traits,this.model,this.elements,pn.createMapping(W,this.model.atomicConformation,this.conformation.r),this.props)},B.prototype.remapModel=function(j,Q){Q||(Q=E(E({},this.props),{bonds:M(this,this.props.bonds,j)}),e.isSameConformation(this,j)||(Q.boundary=void 0,Q.lookup3d=void 0,Q.principalAxes=void 0));var G=this.conformation.operator,W=si.Provider.get(j);if(G.spgrOp!==-1&&W&&W!==si.Provider.get(this.model)){var q=G.hkl,ee=q[0],he=q[1],$=q[2],X=W.spacegroup.cell.toFractional,U=_.transformMat4(_(),Wt.getCenter(j),X);G=Du.getSymmetryOperatorRef(W.spacegroup,G.spgrOp,ee,he,$,U)}var z=this.model.atomicConformation!==j.atomicConformation||G!==this.conformation.operator?pn.createMapping(G,j.atomicConformation):this.conformation;return new B(this.id,this.invariantId,this.chainGroupId,this.traits,j,this.elements,z,Q)},Object.defineProperty(B.prototype,"boundary",{get:function(){if(this.props.boundary)return this.props.boundary;var j=this.model.atomicConformation,Q=j.x,G=j.y,W=j.z;return this.props.boundary=Eg({x:Q,y:G,z:W,indices:this.elements}),this.props.boundary},enumerable:!1,configurable:!0}),Object.defineProperty(B.prototype,"lookup3d",{get:function(){if(this.props.lookup3d)return this.props.lookup3d;var j=this.model.atomicConformation,Q=j.x,G=j.y,W=j.z;return this.props.lookup3d=qp({x:Q,y:G,z:W,indices:this.elements},this.boundary),this.props.lookup3d},enumerable:!1,configurable:!0}),Object.defineProperty(B.prototype,"principalAxes",{get:function(){return this.props.principalAxes?this.props.principalAxes:(this.props.principalAxes=t9(this),this.props.principalAxes)},enumerable:!1,configurable:!0}),Object.defineProperty(B.prototype,"bonds",{get:function(){if(this.props.bonds)return this.props.bonds;var j=xDe.get(this.model),Q=j.get(this.elements);return Q||(Q=U5e(this),j.set(this.elements,Q)),this.props.bonds=Q,this.props.bonds},enumerable:!1,configurable:!0}),Object.defineProperty(B.prototype,"rings",{get:function(){return this.props.rings?this.props.rings:(this.props.rings=r_.create(this),this.props.rings)},enumerable:!1,configurable:!0}),Object.defineProperty(B.prototype,"polymerElements",{get:function(){return this.props.polymerElements?this.props.polymerElements:(this.props.polymerElements=oDe(this),this.props.polymerElements)},enumerable:!1,configurable:!0}),Object.defineProperty(B.prototype,"gapElements",{get:function(){return this.props.gapElements?this.props.gapElements:(this.props.gapElements=uDe(this),this.props.gapElements)},enumerable:!1,configurable:!0}),Object.defineProperty(B.prototype,"nucleotideElements",{get:function(){return this.props.nucleotideElements?this.props.nucleotideElements:(this.props.nucleotideElements=cDe(this),this.props.nucleotideElements)},enumerable:!1,configurable:!0}),Object.defineProperty(B.prototype,"proteinElements",{get:function(){return this.props.proteinElements?this.props.proteinElements:(this.props.proteinElements=dDe(this),this.props.proteinElements)},enumerable:!1,configurable:!0}),Object.defineProperty(B.prototype,"residueCount",{get:function(){if(this.props.residueCount!==void 0)return this.props.residueCount;for(var j=0,Q=nr.transientSegments(this.model.atomicHierarchy.residueAtomSegments,this.elements);Q.hasNext;)Q.move(),j+=1;return this.props.residueCount=j,this.props.residueCount},enumerable:!1,configurable:!0}),B.prototype.getResidueIndex=function(j){return this.residueIndex[this.elements[j]]},B}();e.Atomic=v;function p(){return d()}var m=function(){function B(j,Q,G,W,q,ee,he,$,X){this.kind=ee,this.objectPrimitive=ee===1?"sphere":"gaussian",this.id=j,this.invariantId=Q,this.chainGroupId=G,this.traits=W,this.model=q,this.elements=he,this.conformation=$,this.coarseElements=ee===1?q.coarseHierarchy.spheres:q.coarseHierarchy.gaussians,this.coarseConformation=ee===1?q.coarseConformation.spheres:q.coarseConformation.gaussians,this.props=X}return B.prototype.getChild=function(j){return j.length===this.elements.length?this:x(this.id,this.invariantId,this.chainGroupId,this.traits,this.model,this.kind,j,this.conformation,y())},B.prototype.applyOperator=function(j,Q,G){G===void 0&&(G=!1);var W=G?Q:pn.compose(this.conformation.operator,Q);return x(j,this.invariantId,this.chainGroupId,this.traits,this.model,this.kind,this.elements,pn.createMapping(W,this.getCoarseConformation(),this.conformation.r),this.props)},B.prototype.remapModel=function(j,Q){var G=this.getCoarseConformation(),W=g(this.kind,j);Q||(Q=E({},this.props),e.isSameConformation(this,j)||(Q.boundary=void 0,Q.lookup3d=void 0,Q.principalAxes=void 0));var q=G!==W?pn.createMapping(this.conformation.operator,W):this.conformation;return new B(this.id,this.invariantId,this.chainGroupId,this.traits,j,this.kind,this.elements,q,Q)},Object.defineProperty(B.prototype,"boundary",{get:function(){if(this.props.boundary)return this.props.boundary;var j=this.getCoarseConformation(),Q=j.x,G=j.y,W=j.z;return this.props.boundary=Eg({x:Q,y:G,z:W,indices:this.elements}),this.props.boundary},enumerable:!1,configurable:!0}),Object.defineProperty(B.prototype,"lookup3d",{get:function(){if(this.props.lookup3d)return this.props.lookup3d;var j=this.getCoarseConformation(),Q=j.x,G=j.y,W=j.z;return this.props.lookup3d=qp({x:Q,y:G,z:W,indices:this.elements},this.boundary),this.props.lookup3d},enumerable:!1,configurable:!0}),Object.defineProperty(B.prototype,"principalAxes",{get:function(){return this.props.principalAxes?this.props.principalAxes:(this.props.principalAxes=t9(this),this.props.principalAxes)},enumerable:!1,configurable:!0}),Object.defineProperty(B.prototype,"polymerElements",{get:function(){return this.props.polymerElements?this.props.polymerElements:(this.props.polymerElements=sDe(this),this.props.polymerElements)},enumerable:!1,configurable:!0}),Object.defineProperty(B.prototype,"gapElements",{get:function(){return this.props.gapElements?this.props.gapElements:(this.props.gapElements=lDe(this),this.props.gapElements)},enumerable:!1,configurable:!0}),B.prototype.getCoarseConformation=function(){return g(this.kind,this.model)},B}();function g(B,j){return B===1?j.coarseConformation.spheres:j.coarseConformation.gaussians}function y(){return d()}var b=function(B){Le(j,B);function j(){return B!==null&&B.apply(this,arguments)||this}return j}(m);e.Spheres=b;var S=function(B){Le(j,B);function j(){return B!==null&&B.apply(this,arguments)||this}return j}(m);e.Gaussians=S;function x(B,j,Q,G,W,q,ee,he,$){return new m(B,j,Q,G,W,q,ee,he,$)}function C(B,j){return B.chainGroupId===j.chainGroupId&&B.conformation.operator.name===j.conformation.operator.name}e.areSameChainOperatorGroup=C;function w(B,j){return ue.areEqual(B.conformation.operator.matrix,j.conformation.operator.matrix,1e-6)}e.areOperatorsEqual=w;function A(B,j){return Je.areEqual(B.elements,j.elements)?D(B,j.model):!1}e.areConformationsEqual=A;function M(B,j,Q){var G;if(j){if(B.model.atomicConformation.id===Q.atomicConformation.id)return j;var W=fa.Provider.get(B.model);if(W){var q=fa.Provider.get(Q);return!q||W===q?j:void 0}return!((G=j.props)===null||G===void 0)&&G.canRemap||D(B,Q)?j:void 0}}function D(B,j){var Q=Wt.CoordinatesHistory.get(Wt.getRoot(j));if(Q)return Q.areEqual(B.elements,B.kind,j);for(var G=B.elements,W=B.conformation.coordinates,q=W.x,ee=W.y,he=W.z,$=k(B.kind,j),X=$.x,U=$.y,z=$.z,J=0,Y=G.length;J<Y;J++){var Z=G[J];if(q[Z]!==X[Z]||ee[Z]!==U[Z]||he[Z]!==z[Z])return!1}return!0}e.isSameConformation=D;function k(B,j){return B===0?j.atomicConformation:B===1?j.coarseConformation.spheres:j.coarseConformation.gaussians}e.getModelConformationOfKind=k;function R(B){return k(B.kind,B.model)}e.getConformation=R;function L(B,j){return B===0?j.atomicHierarchy:B===1?j.coarseHierarchy.spheres:j.coarseHierarchy.gaussians}e.getModelHierarchyOfKind=L;function H(B){return L(B.kind,B.model)}e.getHierarchy=H})(Ue||(Ue={}));var n_;(function(e){function t(i,a,o,s){i.indices[i.count]=o,i.units[i.count]=a,i.squaredDistances[i.count]=s,i.count++}e.add=t;function r(){return{count:0,indices:[],units:[],squaredDistances:[]}}e.create=r;function n(i,a){for(var o=0;o<a.count;++o)i.indices[o]=a.indices[o],i.units[o]=a.units[o],i.squaredDistances[o]=a.squaredDistances[o];return i.count=a.count,i}e.copy=n})(n_||(n_={}));function nQ(){return{result:n_.create(),closeUnitsResult:$f.create(),unitGroupResult:$f.create()}}var SDe=function(){function e(t){this.structure=t,this.pivot=_(),this.findContext=nQ();for(var r=t.units,n=t.boundary,i=r.length,a=new Float32Array(i),o=new Float32Array(i),s=new Float32Array(i),u=new Float32Array(i),l=_(),c=0;c<i;c++){var d=r[c],f=d.boundary.sphere;_.transformMat4(l,f.center,d.conformation.operator.matrix),a[c]=l[0],o[c]=l[1],s[c]=l[2],u[c]=f.radius}var h={x:a,y:o,z:s,radius:u,indices:Oe.ofBounds(0,i)};this.unitLookup=qp(h,n)}return e.prototype.findUnitIndices=function(t,r,n,i){return this.unitLookup.find(t,r,n,i)},e.prototype.find=function(t,r,n,i,a){return this._find(t,r,n,i,a??this.findContext)},e.prototype._find=function(t,r,n,i,a){$f.reset(a.result);var o=this.structure.units,s=this.unitLookup.find(t,r,n,i,a.closeUnitsResult);if(s.count===0)return a.result;for(var u=0,l=s.count;u<l;u++){var c=o[s.indices[u]];_.set(this.pivot,t,r,n),c.conformation.operator.isIdentity||_.transformMat4(this.pivot,this.pivot,c.conformation.operator.inverse);for(var d=c.lookup3d,f=d.find(this.pivot[0],this.pivot[1],this.pivot[2],i,a.unitGroupResult),h=0,v=f.count;h<v;h++)n_.add(a.result,c,f.indices[h],f.squaredDistances[h])}return a.result},e.prototype.findIntoBuilder=function(t,r,n,i,a){var o=this.structure.units,s=this.unitLookup.find(t,r,n,i);if(s.count!==0)for(var u=0,l=s.count;u<l;u++){var c=o[s.indices[u]];_.set(this.pivot,t,r,n),c.conformation.operator.isIdentity||_.transformMat4(this.pivot,this.pivot,c.conformation.operator.inverse);var d=c.lookup3d,f=d.find(this.pivot[0],this.pivot[1],this.pivot[2],i);if(f.count!==0){var h=c.elements;a.beginUnit(c.id);for(var v=0,p=f.count;v<p;v++)a.addElement(h[f.indices[v]]);a.commitUnit()}}},e.prototype.findIntoBuilderIf=function(t,r,n,i,a,o){var s=this.structure.units,u=this.unitLookup.find(t,r,n,i);if(u.count!==0)for(var l=Ze.create(this.structure),c=0,d=u.count;c<d;c++){var f=s[u.indices[c]];_.set(this.pivot,t,r,n),f.conformation.operator.isIdentity||_.transformMat4(this.pivot,this.pivot,f.conformation.operator.inverse);var h=f.lookup3d,v=h.find(this.pivot[0],this.pivot[1],this.pivot[2],i);if(v.count!==0){var p=f.elements;l.unit=f,a.beginUnit(f.id);for(var m=0,g=v.count;m<g;m++)l.element=p[v.indices[m]],o(l)&&a.addElement(l.element);a.commitUnit()}}},e.prototype.findIntoBuilderWithRadius=function(t,r,n,i,a,o,s,u){var l=this.structure.units,c=this.unitLookup.find(t,r,n,o);if(c.count!==0)for(var d=Ze.create(this.structure),f=i+a+o,h=0,v=c.count;h<v;h++){var p=l[c.indices[h]];_.set(this.pivot,t,r,n),p.conformation.operator.isIdentity||_.transformMat4(this.pivot,this.pivot,p.conformation.operator.inverse);var m=p.lookup3d,g=m.find(this.pivot[0],this.pivot[1],this.pivot[2],f);if(g.count!==0){var y=p.elements;d.unit=p,u.beginUnit(p.id);for(var b=0,S=g.count;b<S;b++){d.element=y[g.indices[b]];var x=s(d);Math.sqrt(g.squaredDistances[b])-i-x>o||u.addElement(y[g.indices[b]])}u.commitUnit()}}},e.prototype.check=function(t,r,n,i){var a=this.structure.units,o=this.unitLookup.find(t,r,n,i);if(o.count===0)return!1;for(var s=0,u=o.count;s<u;s++){var l=a[o.indices[s]];_.set(this.pivot,t,r,n),l.conformation.operator.isIdentity||_.transformMat4(this.pivot,this.pivot,l.conformation.operator.inverse);var c=l.lookup3d;if(c.check(this.pivot[0],this.pivot[1],this.pivot[2],i))return!0}return!1},Object.defineProperty(e.prototype,"boundary",{get:function(){return this.structure.boundary},enumerable:!1,configurable:!0}),e}();function J1(e,t){if(t.length===0)return $e.Empty;if(t.length===1)return t[0];for(var r=new Map,n=new Set,i=0,a=t;i<a.length;i++)for(var o=a[i].units,s=0,u=o.length;s<u;s++){var l=o[s];if(r.has(l.id)){if(n.has(l.id))continue;var c=Je.union(r.get(l.id),l.elements);r.set(l.id,c),c.length===e.unitMap.get(l.id).elements.length&&n.add(l.id)}else r.set(l.id,l.elements),l.elements.length===e.unitMap.get(l.id).elements.length&&n.add(l.id)}var d=e.subsetBuilder(!0);return r.forEach(CDe,d),d.getStructure()}function CDe(e,t){this.setUnit(t,e)}function _De(e,t){if(e===t)return!0;if(e.units.length!==t.units.length)return!1;for(var r=e.units,n=t.unitMap,i=0,a=r.length;i<a;i++){var o=r[i];if(!n.has(o.id))return!1;var s=n.get(o.id);if(!Je.areEqual(o.elements,s.elements))return!1}return!0}function R3(e,t){if(e===t)return!0;var r,n;e.units.length<t.units.length?(r=e,n=t):(r=t,n=e);for(var i=r.units,a=n.unitMap,o=0,s=i.length;o<s;o++){var u=i[o];if(a.has(u.id)){var l=a.get(u.id);if(Je.areIntersecting(u.elements,l.elements))return!0}}return!1}function iQ(e,t){if(e===t)return e;if(!R3(e,t))return $e.Empty;var r,n;e.units.length<t.units.length?(r=e,n=t):(r=t,n=e);for(var i=r.units,a=n.unitMap,o=[],s=0,u=i.length;s<u;s++){var l=i[s];if(a.has(l.id)){var c=a.get(l.id);if(Je.areIntersecting(l.elements,c.elements)){var d=Je.intersect(l.elements,c.elements);o[o.length]=l.getChild(d)}}}return $e.create(o,{parent:e.parent||t.parent})}function yO(e,t){if(e===t)return $e.Empty;if(!R3(e,t))return e;for(var r=e.units,n=t.unitMap,i=[],a=0,o=r.length;a<o;a++){var s=r[a];if(!n.has(s.id)){i[i.length]=s;continue}var u=n.get(s.id),l=Je.subtract(s.elements,u.elements);l.length>0&&(i[i.length]=s.getChild(l))}return $e.create(i,{parent:e.parent||t.parent})}var mt;(function(e){function t(g,y){return{kind:"singletons",source:g,structure:y}}e.Singletons=t;function r(g,y){return{kind:"sequence",source:g,structures:y}}e.Sequence=r;function n(g){return t(g,$e.Empty)}e.Empty=n;function i(g){return g.kind==="singletons"}e.isSingleton=i;function a(g){return i(g)?g.structure.units.length===0:g.structures.length===0}e.isEmpty=a;function o(g){return i(g)?g.structure.elementCount:g.structures.length}e.structureCount=o;function s(g){return a(g)?$e.Empty:i(g)?g.structure:J1(g.source,g.structures)}e.unionStructure=s;function u(g){for(var y=[],b=g.source.unitMap,S=0,x=s(g).units;S<x.length;S++){var C=x[S];C===b.get(C.id)?y[y.length]={unit:C,indices:Oe.ofBounds(0,C.elements.length)}:y[y.length]={unit:C,indices:Oe.ofSortedArray(Je.indicesOf(b.get(C.id).elements,C.elements))}}return De(g.source,y)}e.toLociWithCurrentUnits=u;function l(g){for(var y=[],b=g.source.unitMap,S=0,x=s(g).units;S<x.length;S++){var C=x[S],w=b.get(C.id);w===C?y[y.length]={unit:w,indices:Oe.ofBounds(0,w.elements.length)}:y[y.length]={unit:w,indices:Oe.ofSortedArray(Je.indicesOf(w.elements,C.elements))}}return De(g.source,y)}e.toLociWithSourceUnits=l;function c(g,y,b){var S=y.length;return S===0?n(g):b?t(g,J1(g,y)):r(g,y)}var d=function(){function g(y){this.source=y,this.structures=[],this.allSingletons=!0}return g.prototype.add=function(y){var b=y.elementCount;b!==0&&(this.structures[this.structures.length]=y,b!==1&&(this.allSingletons=!1))},g.prototype.getSelection=function(){return c(this.source,this.structures,this.allSingletons)},g}(),f=function(){function g(y){this.structure=y,this.structures=[],this.allSingletons=!0,this.uniqueSets=eO($e.hashCode,$e.areUnitIdsAndIndicesEqual)}return g.prototype.add=function(y){var b=y.elementCount;b===0||!this.uniqueSets.add(y)||(this.structures[this.structures.length]=y,b!==1&&(this.allSingletons=!1))},g.prototype.getSelection=function(){return c(this.structure,this.structures,this.allSingletons)},g}();function h(g){return new d(g)}e.LinearBuilder=h;function v(g){return new f(g)}e.UniqueBuilder=v;function p(g,y){var b=0;if(e.isSingleton(g))for(var S=0,x=g.structure.units;S<x.length;S++)for(var C=x[S],w=C.elements,A=0,M=w.length;A<M;A++){var D=$e.create([C.getChild(Je.ofSingleton(w[A]))],{parent:g.source});y(D,b++)}else for(var k=0,R=g.structures;k<R.length;k++){var D=R[k];y(D,b++)}}e.forEach=p;function m(g,y){return i(g)?t(y,g.structure):r(y,g.structures)}e.withInputStructure=m})(mt||(mt={}));var Jr;(function(e){e.Empty={hash:-1,elements:[]};function t(c,d){return n(mt.toLociWithSourceUnits(mt.Singletons(c,d)))}e.fromSubStructure=t;function r(c){return n(mt.toLociWithSourceUnits(c))}e.fromSelection=r;function n(c){for(var d=[],f=0,h=c.elements;f<h.length;f++){var v=h[f],p=v.unit,m=v.indices;if(Oe.size(m)!==0){var g=[],y=[];if(Oe.isInterval(m))Oe.size(m)===1?y.push(Te.min(m)):g.push(Te.min(m),Te.max(m));else for(var b=0,S=m.length;b<S;){var x=b;for(b++;b<S&&m[b-1]+1===m[b];)b++;var C=b;if(C-x>2)g.push(m[x],m[C-1]);else for(var w=x;w<C;w++)y[y.length]=m[w]}d.push({unit:p,set:Je.ofSortedArray(y),ranges:Qr.ofSortedRanges(g)})}}for(var A=new Map,b=0,M=d.length;b<M;++b){var v=d[b],D=cv(La(v.ranges),La(v.set));if(A.has(D)){var k=A.get(D).groupedUnits;k.has(v.unit.invariantId)?k.get(v.unit.invariantId).push(v.unit.id):k.set(v.unit.invariantId,[v.unit.id])}else{var k=new Map;k.set(v.unit.invariantId,[v.unit.id]),A.set(D,{groupedUnits:k,set:v.set,ranges:v.ranges})}}var R=[];return A.forEach(function(L){var H=[];L.groupedUnits.forEach(function(B){return H.push(Je.ofUnsortedArray(B))}),H.sort(function(B,j){return B[0]-j[0]}),R.push({groupedUnits:H,set:L.set,ranges:L.ranges})}),{hash:c.structure.hashCode,elements:R}}e.fromLoci=n;function i(c,d){for(var f=[],h=0,v=c.length;h<v;++h){var p=c[h];d.unitMap.has(p)&&f.push(d.unitMap.get(p))}return f}function a(c,d){c.hash!==-1&&(c.hash,d.hashCode);for(var f=[],h=0,v=c.elements;h<v.length;h++)for(var p=v[h],m=function(S){var x=i(S,d);if(x.length===0)return"continue";var C=void 0;if(p.ranges.length===0)C=p.set;else if(p.set.length===0)if(p.ranges.length===2)C=Te.ofRange(p.ranges[0],p.ranges[1]);else{var w=new Int32Array(Qr.size(p.ranges));Qr.forEach(p.ranges,function(L,H){return w[H]=L}),C=Je.ofSortedArray(w)}else{var A=Qr.size(p.ranges),M=new Int32Array(p.set.length+A);Qr.forEach(p.ranges,function(L,H){return M[H]=L}),M.set(p.set,A),C=Je.ofUnsortedArray(M)}for(var D=0,k=x;D<k.length;D++){var R=k[D];f.push({unit:R,indices:C})}},g=0,y=p.groupedUnits;g<y.length;g++){var b=y[g];m(b)}return De(d,f)}e.toLoci=a;function o(c,d){c.hash!==-1&&(c.hash,d.hashCode);for(var f=[],h=0,v=c.elements;h<v.length;h++)for(var p=v[h],m=function(S){var x=i(S,d);if(x.length===0)return"continue";var C=x[0].elements,w=Qr.size(p.ranges),A=p.set.length,M=new Int32Array(A+w),D=void 0;if(w===0){for(var k=0,R=A;k<R;++k)M[k]=C[p.set[k]];D=Je.ofSortedArray(M)}else if(A===0)Qr.forEach(p.ranges,function(j,Q){return M[Q]=C[j]}),D=Je.ofSortedArray(M);else if(Je.min(p.set)>Qr.max(p.ranges)){Qr.forEach(p.ranges,function(j,Q){return M[Q]=C[j]});for(var k=0,R=A;k<R;++k)M[k+w]=C[p.set[k]];D=Je.ofSortedArray(M)}else if(Qr.min(p.ranges)>Je.max(p.set)){for(var k=0,R=A;k<R;++k)M[k]=C[p.set[k]];Qr.forEach(p.ranges,function(j,Q){return M[Q+A]=C[j]}),D=Je.ofSortedArray(M)}else{Qr.forEach(p.ranges,function(j,Q){return M[Q]=C[j]});for(var k=0,R=A;k<R;++k)M[k+w]=C[p.set[k]];D=Je.ofUnsortedArray(M)}for(var L=0,H=x;L<H.length;L++){var B=H[L];f.push(B.getChild(D))}},g=0,y=p.groupedUnits;g<y.length;g++){var b=y[g];m(b)}return $e.create(f,{parent:d})}e.toStructure=o;function s(c){return se.internal.generator.bundleElement({groupedUnits:se.core.type.list(c.groupedUnits.map(function(d){return se.core.type.list(d)})),ranges:se.core.type.list(c.ranges),set:se.core.type.list(c.set)})}function u(c){return se.internal.generator.bundle({elements:se.core.type.list(c.elements.map(s))})}e.toExpression=u;function l(c,d){if(c.elements.length!==d.elements.length)return!1;for(var f=0,h=c.elements.length;f<h;++f){var v=c.elements[f],p=d.elements[f];if(v.groupedUnits.length!==p.groupedUnits.length)return!1;for(var m=0,g=p.groupedUnits.length;m<g;++m)if(!Je.areEqual(v.groupedUnits[m],p.groupedUnits[m]))return!1;if(!Je.areEqual(v.set,p.set)||!Qr.areEqual(v.ranges,p.ranges))return!1}return!0}e.areEqual=l})(Jr||(Jr={}));function e5(e){return Nr.isCovalent(e.atomicBond.type)}function wDe(){return function(t){for(var r=t.inputStructure,n=Ze.create(r),i=[],a=0,o=r.units;a<o.length;a++){var s=o[a];if(s.kind===0){n.unit=s;var u=s.elements;if(n.element=u[0],lt.entity.type(n)==="polymer"){for(var l=nr.transientSegments(s.model.atomicHierarchy.residueAtomSegments,u),c=0;l.hasNext;)c++,l.move();c<8||i.push(s)}}}return mt.Singletons(r,$e.create(i,{parent:r}))}}function EDe(){return function(t){for(var r=t.inputStructure,n=Ze.create(r),i=[],a=0,o=r.units;a<o.length;a++){var s=o[a];if(s.kind===0){n.unit=s;var u=s.elements;n.element=u[0],lt.entity.type(n)==="water"&&i.push(s)}}return mt.Singletons(r,$e.create(i,{parent:r}))}}function ADe(){return function(t){for(var r=t.inputStructure,n=Ze.create(r),i=[],a=0,o=r.units;a<o.length;a++){var s=o[a];if(s.kind===0){n.unit=s;var u=s.elements;if(n.element=u[0],lt.entity.type(n)!=="water"){if(lt.entity.type(n)==="polymer"){for(var l=nr.transientSegments(s.model.atomicHierarchy.residueAtomSegments,u),c=0;l.hasNext;)c++,l.move();if(c>=8)continue}i.push(s)}}}return mt.Singletons(r,$e.create(i,{parent:r}))}}function PDe(){return function(t){for(var r=t.inputStructure,n=[],i=0,a=r.units;i<a.length;i++){var o=a[i];o.kind===1&&n.push(o)}return mt.Singletons(r,$e.create(n,{parent:r}))}}function aQ(e,t,r){return{groupedUnits:e,ranges:t,set:r}}function oQ(e){return function(r){var n={hash:r.inputStructure.hashCode,elements:e};return mt.Sequence(r.inputStructure,[Jr.toStructure(n,r.inputStructure)])}}const TDe=Object.freeze(Object.defineProperty({__proto__:null,atomicHet:ADe,atomicSequence:wDe,bundleElementImpl:aQ,bundleGenerator:oQ,defaultBondTest:e5,spheres:PDe,water:EDe},Symbol.toStringTag,{value:"Module"}));var Qo=function(){function e(t,r){this.currentElementStack=[],this.currentAtomicBondStack=[],this.currentStructureStack=[],this.inputStructureStack=[],this.timeCreated=Tn(),this.element=Ze.create(void 0),this.currentStructure=void 0,this.atomicBond=new i9,this.currentSelection=void 0,this.inputStructure=t,this.timeoutMs=r&&r.timeoutMs||0,this.currentSelection=r&&r.currentSelection}return e.prototype.pushCurrentElement=function(){return this.currentElementStack[this.currentElementStack.length]=this.element,this.element=Ze.create(void 0),this.element},e.prototype.popCurrentElement=function(){this.element=this.currentElementStack.pop()},e.prototype.pushCurrentBond=function(){return this.atomicBond&&this.currentAtomicBondStack.push(this.atomicBond),this.atomicBond=new i9,this.atomicBond},e.prototype.popCurrentBond=function(){this.currentAtomicBondStack.length>0?this.atomicBond=this.currentAtomicBondStack.pop():this.atomicBond=void 0},e.prototype.pushCurrentStructure=function(){this.currentStructure&&this.currentStructureStack.push(this.currentStructure)},e.prototype.popCurrentStructure=function(){this.currentStructureStack.length?this.currentStructure=this.currentStructureStack.pop():this.currentStructure=void 0},e.prototype.pushInputStructure=function(t){this.inputStructureStack.push(this.inputStructure),this.inputStructure=t},e.prototype.popInputStructure=function(){if(this.inputStructureStack.length===0)throw new Error("Must push before pop.");this.inputStructure=this.inputStructureStack.pop()},e.prototype.throwIfTimedOut=function(){if(this.timeoutMs!==0&&Tn()-this.timeCreated>this.timeoutMs)throw new Error("The query took too long to execute (> "+this.timeoutMs/1e3+"s).")},e.prototype.tryGetCurrentSelection=function(){if(!this.currentSelection)throw new Error("The current selection is not assigned.");return this.currentSelection},e}(),i9=function(){function e(){this.a=Ze.create(void 0),this.aIndex=0,this.b=Ze.create(void 0),this.bIndex=0,this.type=0,this.order=0,this.testFn=e5}return e.prototype.setStructure=function(t){this.a.structure=t,this.b.structure=t},e.prototype.setTestFn=function(t){this.testFn=t||e5},e.prototype.test=function(t,r){return this.testFn(t)?!0:r?(this.swap(),this.testFn(t)):!1},e.prototype.swap=function(){var t=this.aIndex;this.aIndex=this.bIndex,this.bIndex=t;var r=this.a.unit;this.a.unit=this.b.unit,this.b.unit=r;var n=this.a.element;this.a.element=this.b.element,this.b.element=n},Object.defineProperty(e.prototype,"length",{get:function(){return Ze.distance(this.a,this.b)},enumerable:!1,configurable:!0}),e}(),t5;(function(e){function t(r,n,i){return r(new Qo(n,i))}e.run=t})(t5||(t5={}));var r5=function(){function e(t){this.source=t,this.set=eO($e.hashCode,$e.areUnitIdsAndIndicesEqual),this.structures=[],this.allSingletons=!0}return e.prototype.add=function(t){t.elementCount&&(t.elementCount!==1&&(this.allSingletons=!1),this.set.add(t)&&(this.structures[this.structures.length]=t))},e.prototype.getSelection=function(){return this.allSingletons?mt.Singletons(this.source,J1(this.source,this.structures)):mt.Sequence(this.source,this.structures)},e}(),IDe=function(){function e(t){this.source=t,this.builders=[],this.builderMap=new Map}return e.prototype.add=function(t,r,n){var i=this.builderMap.get(t);i||(i=this.source.subsetBuilder(!0),this.builders[this.builders.length]=i,this.builderMap.set(t,i)),i.addToUnit(r,n)},e.prototype.allSingletons=function(){for(var t=0,r=this.builders.length;t<r;t++)if(this.builders[t].elementCount>1)return!1;return!0},e.prototype.singletonSelection=function(){for(var t=this.source.subsetBuilder(!0),r=Ze.create(this.source),n=0,i=this.builders.length;n<i;n++)this.builders[n].setSingletonLocation(r),t.addToUnit(r.unit.id,r.element);return mt.Singletons(this.source,t.getStructure())},e.prototype.fullSelection=function(){for(var t=new Array(this.builders.length),r=0,n=this.builders.length;r<n;r++)t[r]=this.builders[r].getStructure();return mt.Sequence(this.source,t)},e.prototype.getSelection=function(){var t=this.builders.length;return t===0?mt.Empty(this.source):this.allSingletons()?this.singletonSelection():this.fullSelection()},e}(),bO=function(e){return mt.Sequence(e.inputStructure,[])},sQ=function(e){return mt.Singletons(e.inputStructure,e.inputStructure)};function MDe(e){return xO(E(E({},e),{groupBy:function(t){return lt.residue.key(t.element)}}))}function DDe(e){return xO(E(E({},e),{groupBy:function(t){return lt.chain.key(t.element)}}))}function af(e){return!0}function RDe(e){return 0}function xO(e){if(!e||!e.atomTest&&!e.residueTest&&!e.chainTest&&!e.entityTest&&!e.unitTest&&!e.groupBy)return sQ;if(e.atomTest&&!e.residueTest&&!e.chainTest&&!e.entityTest&&!e.unitTest&&!e.groupBy)return kDe(e.atomTest);var t={unitTest:e.unitTest||af,entityTest:e.entityTest||af,chainTest:e.chainTest||af,residueTest:e.residueTest||af,atomTest:e.atomTest||af,groupBy:e.groupBy||RDe};return e.groupBy?LDe(t):ODe(t)}function kDe(e){return function(r){var n=r.inputStructure,i=n.units,a=r.pushCurrentElement(),o=n.subsetBuilder(!0);a.structure=n;for(var s=0,u=i;s<u.length;s++){var l=u[s];a.unit=l;var c=l.elements;o.beginUnit(l.id);for(var d=0,f=c.length;d<f;d++)a.element=c[d],e(r)&&o.addElement(a.element);o.commitUnit(),r.throwIfTimedOut()}return r.popCurrentElement(),mt.Singletons(n,o.getStructure())}}function ODe(e){var t=e.unitTest,r=e.entityTest,n=e.chainTest,i=e.residueTest,a=e.atomTest;return function(s){var u=s.inputStructure,l=u.units,c=s.pushCurrentElement(),d=u.subsetBuilder(!0),f=i===af&&a===af,h=a===af;c.structure=u;for(var v=0,p=l;v<p.length;v++){var m=p[v];if(c.unit=m,!!t(s)){var g=m.elements,y=m.model;if(d.beginUnit(m.id),m.kind===0)for(var b=nr.transientSegments(m.model.atomicHierarchy.chainAtomSegments,g),S=nr.transientSegments(m.model.atomicHierarchy.residueAtomSegments,g);b.hasNext;){var x=b.move();if(c.element=g[x.start],!(!r(s)||!n(s))){if(f){d.addElementRange(g,x.start,x.end);continue}for(S.setSegment(x);S.hasNext;){var C=S.move();if(c.element=g[C.start],!!i(s)){if(h){d.addElementRange(g,C.start,C.end);continue}for(var w=C.start,A=C.end;w<A;w++)c.element=g[w],a(s)&&d.addElement(c.element)}}}}else for(var M=y.coarseHierarchy.spheres.chainElementSegments,b=nr.transientSegments(M,g);b.hasNext;){var x=b.move();if(c.element=g[x.start],!(!r(s)||!n(s))){if(f){d.addElementRange(g,x.start,x.end);continue}for(var w=x.start,A=x.end;w<A;w++)c.element=g[w],i(s)&&d.addElement(c.element)}}d.commitUnit(),s.throwIfTimedOut()}}return s.popCurrentElement(),mt.Singletons(u,d.getStructure())}}function LDe(e){var t=e.unitTest,r=e.entityTest,n=e.chainTest,i=e.residueTest,a=e.atomTest,o=e.groupBy;return function(u){var l=u.inputStructure,c=l.units,d=u.pushCurrentElement(),f=new IDe(l);d.structure=l;for(var h=0,v=c;h<v.length;h++){var p=v[h];if(d.unit=p,!!t(u)){var m=p.elements,g=p.model;if(p.kind===0)for(var y=nr.transientSegments(g.atomicHierarchy.chainAtomSegments,m),b=nr.transientSegments(g.atomicHierarchy.residueAtomSegments,m);y.hasNext;){var S=y.move();if(d.element=m[S.start],!(!r(u)||!n(u)))for(b.setSegment(S);b.hasNext;){var x=b.move();if(d.element=m[x.start],!!i(u))for(var C=x.start,w=x.end;C<w;C++)d.element=m[C],a(u)&&f.add(o(u),p.id,d.element)}}else for(var A=g.coarseHierarchy.spheres.chainElementSegments,y=nr.transientSegments(A,m);y.hasNext;){var S=y.move();if(d.element=m[S.start],!(!r(u)||!n(u)))for(var C=S.start,w=S.end;C<w;C++)d.element=m[C],i(u)&&f.add(o(u),p.id,d.element)}u.throwIfTimedOut()}}return u.popCurrentElement(),f.getSelection()}}function MP(e,t,r){for(var n=new Int32Array(t.length),i=0,a=t.length;i<a;i++)n[i]=e.elements[t[i]];return $e.create([e.getChild(Je.ofSortedArray(n))],{parent:r})}function NDe(e,t){return function(n){var i=n.inputStructure.units,a=mt.LinearBuilder(n.inputStructure);if(!e||e.length===0)for(var o=0,s=i;o<s.length;o++){var u=s[o];if(Ue.isAtomic(u))if(t)for(var l=0,c=u.rings.aromaticRings;l<c.length;l++){var d=c[l];a.add(MP(u,u.rings.all[d],n.inputStructure))}else for(var f=0,h=u.rings.all;f<h.length;f++){var d=h[f];a.add(MP(u,d,n.inputStructure))}}else{for(var v=Zr.create(),p=0;p<e.length;p++)Zr.add(v,e[p],e[p]);for(var m=0,g=i;m<g.length;m++){var u=g[m];if(Ue.isAtomic(u))for(var y=u.rings,b=0,S=v.array;b<S.length;b++){var x=S[b];if(y.byFingerprint.has(x))for(var C=0,w=y.byFingerprint.get(x);C<w.length;C++){var d=w[C];t&&!y.aromaticRings.includes(d)||a.add(MP(u,y.all[d],n.inputStructure))}}}}return a.getSelection()}}function FDe(e,t,r){return r===void 0&&(r=!1),function(i){var a=e(i);if(mt.structureCount(a)===0)return a;var o=r?yO(i.inputStructure,mt.unionStructure(a)):mt.unionStructure(a);if(o.elementCount===0)return mt.Empty(i.inputStructure);i.throwIfTimedOut(),i.pushInputStructure(o);var s=t(i);return i.popInputStructure(),mt.withInputStructure(s,i.inputStructure)}}function BDe(e){return function(r){var n=r.inputStructure,i=n.interUnitBonds,a=mt.UniqueBuilder(r.inputStructure);r.pushCurrentBond();var o=r.atomicBond;o.setTestFn(e),o.setStructure(n);for(var s=0,u=n.units;s<u.length;s++){var l=u[s];if(l.kind===0){var c=l.bonds,d=c.offset,f=c.b,h=c.edgeProps,v=h.flags,p=h.order;o.a.unit=l,o.b.unit=l;for(var m=0,g=l.elements.length;m<g;m++){o.aIndex=m,o.a.element=l.elements[m];for(var y=d[m],b=d[m+1];y<b;y++)if(o.bIndex=f[y],o.b.element=l.elements[f[y]],o.type=v[y],o.order=p[y],o.test(r,!1)){var S=n.subsetBuilder(!1);S.beginUnit(l.id),S.addElement(o.a.element),S.addElement(o.b.element),S.commitUnit(),a.add(S.getStructure())}}}}for(var x=0,C=i.edges;x<C.length;x++){var w=C[x];if(o.a.unit=n.unitMap.get(w.unitA),o.a.element=o.a.unit.elements[w.indexA],o.aIndex=w.indexA,o.b.unit=n.unitMap.get(w.unitA),o.b.element=o.b.unit.elements[w.indexB],o.bIndex=w.indexB,o.order=w.props.order,o.type=w.props.flag,o.test(r,!1)){var S=n.subsetBuilder(!1);S.addToUnit(o.a.unit.id,o.a.element),S.addToUnit(o.b.unit.id,o.b.element),a.add(S.getStructure())}}return r.popCurrentBond(),a.getSelection()}}const UDe=Object.freeze(Object.defineProperty({__proto__:null,all:sQ,atoms:xO,bondedAtomicPairs:BDe,chains:DDe,none:bO,querySelection:FDe,residues:MDe,rings:NDe},Symbol.toStringTag,{value:"Module"}));var k3=function(){function e(t){this.parent=t,this.ids=[],this.unitMap=Ls.Mutable(),this.parentId=-1,this.currentUnit=Zr.create(),this.elementCount=0}return e.prototype.addToUnit=function(t,r){var n=this.unitMap.get(t);if(n)Zr.add(n,r,r)&&this.elementCount++;else{var i=Zr.create();Zr.add(i,r,r),this.unitMap.set(t,i),this.ids[this.ids.length]=t,this.elementCount++}},e.prototype.has=function(t,r){var n=this.unitMap.get(t);return n?Zr.has(n,r):!1},e.prototype.beginUnit=function(t){this.parentId=t,this.unitMap.has(t)?this.currentUnit=this.unitMap.get(t):this.currentUnit=this.currentUnit.array.length>0?Zr.create():this.currentUnit},e.prototype.addElement=function(t){Zr.add(this.currentUnit,t,t)&&this.elementCount++},e.prototype.commitUnit=function(){this.currentUnit.array.length===0||this.unitMap.has(this.parentId)||(this.ids[this.ids.length]=this.parentId,this.unitMap.set(this.parentId,this.currentUnit),this.parentId=-1)},e.prototype.getStructure=function(){if(this.isEmpty)return $e.Empty;var t=[];gu(this.ids);for(var r=dl.UnitEquivalenceBuilder(),n=0,i=this.ids.length;n<i;n++){var a=this.ids[n],o=this.parent.unitMap.get(a),s=this.unitMap.get(a).array,u=s.length;if(s.length===o.elements.length){t[t.length]=o,r.add(o.id,o);continue}u>1&&gu(s);var l=o.getChild(Je.ofSortedArray(s)),c=r.add(l.id,l);l!==c&&(l=c.applyOperator(l.id,l.conformation.operator,!0)),t[t.length]=l}return $e.create(t,{parent:this.parent})},Object.defineProperty(e.prototype,"isEmpty",{get:function(){return this.elementCount===0},enumerable:!1,configurable:!0}),e}();function jDe(e){var t=e.unit,r=e.flags,n=e.proteinInfo,i=t.conformation.position,a=t.model.atomicHierarchy.derived.residue.traceElementIndex,o=n.residueIndices,s=n.nIndices,u=o.length,l=function(k,R){return k===-1?_.setNaN(R):i(k,R)},c=_(),d=_(),f=_(),h=_(),v=_(),p=_(),m=_();e:for(var g=2;g<u-2;g++){for(var y=0;y<4;y++){var b=g+y-2;if(l(a[b],h),l(s[b+1],v),_.squaredDistance(h,v)>6.25)continue e}var S=o[g-2],x=o[g],C=o[g+2],w=a[S],A=a[x],M=a[C];l(w,c),l(A,d),l(M,f),_.sub(p,c,d),_.sub(m,d,f);var D=mu(_.angle(p,m));D&&D>70&&(r[g]|=32)}}var zDe=9,q2=-27.888,VDe=-.5,a9=-9.9;function HDe(e,t,r,n){var i=_.distance(e,n),a=_.distance(t,n),o=_.distance(t,r),s=_.distance(e,r),u=q2/i-q2/a,l=q2/o-q2/s,c=u+l;return c<a9?a9:c}function GDe(e,t,r){for(var n=t.residueIndices,i=t.cIndices,a=t.hIndices,o=t.nIndices,s=t.oIndices,u=e.model.atomicHierarchy.index,l=e.conformation.invariantPosition,c=e.model.atomicHierarchy.derived.residue.traceElementIndex,d=n.length,f=[],h=[],v=[],p=_(),m=_(),g=_(),y=_(),b=_(),S=_(),x=_(),C=0,w=n.length;C<w;++C){var A=C,M=n[C],D=s[A],k=i[A],R=c[M];if(!(D===-1||k===-1)&&u.findAtomOnResidue(M,"OXT")===-1){l(D,p),l(k,m),l(R,g);for(var L=r.find(g[0],g[1],g[2],zDe),H=L.indices,B=L.count,j=0;j<B;++j){var Q=H[j];if(!(Q===A||Q-1===A||Q+1===A)){var G=o[Q];if(G!==-1){l(G,y);var W=a[Q];if(W===-1){if(Q===0)continue;var q=Q-1,ee=s[q],he=i[q];if(ee===-1||he===-1)continue;l(ee,x),l(he,S),_.sub(b,S,x);var $=_.distance(x,S);_.scaleAndAdd(b,y,b,1/$)}else l(W,b);var X=HDe(p,m,y,b);X>VDe||(f[f.length]=A,h[h.length]=Q,v[v.length]=X)}}}}}return qDe(d,f,h,v)}function qDe(e,t,r,n){for(var i=new bo.DirectedEdgeBuilder(e,t,r),a=new Float32Array(i.slotCount),o=0,s=i.edgeCount;o<s;o++)i.addNextEdge(),i.assignProperty(a,n[o]);return i.createGraph({energies:n})}var rr;(function(e){e.is=da.has,e.create=da.create})(rr||(rr={}));var W2=function(){function e(t,r,n){this.partner1=Math.min(t,r),this.partner2=Math.max(t,r),this.type=n}return e}();function WDe(e){for(var t=e.proteinInfo,r=e.hbonds,n=e.flags,i=[1024,2048,4096,128,256,512],a=0;a<3;a++)for(var o=0,s=t.residueIndices.length-1;o<s;++o)if(r.getDirectedEdgeIndex(o,o+a+3)!==-1)if(n[o]|=i[a+3]|i[a],e.params.oldDefinition)for(var u=1;u<a+3;++u)n[o+u]|=i[a+3]|64;else for(var u=0;u<=a+3;++u)n[o+u]|=i[a+3]|64}function $De(e){for(var t=e.proteinInfo,r=e.flags,n=t.residueIndices.length,i=[1024,2048,4096,128,256,512],a=[0,0,0,8,1,16],o=e.params.oldOrdering?[4,3,5]:[3,4,5],s=0;s<o.length;s++)for(var u=o[s],l=1,c=n-u;l<c;l++){var d=rr.create(r[l]),f=rr.create(r[l-1]),h=rr.create(r[l+1]);if(e.params.oldOrdering){if(u===3&&(rr.is(d,1)||rr.is(h,1))||u===5&&(rr.is(d,1)||rr.is(d,8)||rr.is(h,1)||rr.is(h,8)))continue}else if(u===4&&(rr.is(d,8)||rr.is(h,8))||u===5&&(rr.is(d,1)||rr.is(d,8)||rr.is(h,1)||rr.is(h,8)))continue;if(rr.is(d,i[u])&&rr.is(d,i[u-3])&&rr.is(f,i[u])&&rr.is(f,i[u-3]))if(e.params.oldDefinition)for(var v=0;v<u;v++)r[l+v]|=a[u];else for(var v=-1;v<=u;v++)r[l+v]|=a[u]}}function XDe(e,t){if(t.type!==e.type||t.partner1!==e.firstEnd+1)return!1;if(t.type===0){if(t.partner2===e.secondEnd+1)return!0}else if(t.partner2===e.secondStart-1)return!0;return!1}function YDe(e,t){return e.type===t.type&&t.firstStart-e.firstEnd<6&&e.firstStart<t.firstStart&&t.nextLadder===0?e.type===0?o9(e,t):o9(t,e):!1}function o9(e,t){return t.secondStart-e.secondEnd>0&&(t.secondStart-e.secondEnd<6&&t.firstStart-e.firstEnd<3||t.secondStart-e.secondEnd<3)}function KDe(e){for(var t=e.bridges,r=e.ladders,n=0;n<t.length;n++){for(var i=t[n],a=!1,o=0;o<r.length;o++){var s=r[o];XDe(s,i)&&(a=!0,s.firstEnd++,i.type===0?s.secondEnd++:s.secondStart--)}a||(r[r.length]={previousLadder:0,nextLadder:0,firstStart:i.partner1,firstEnd:i.partner1,secondStart:i.partner2,secondEnd:i.partner2,type:i.type})}for(var u=0;u<r.length;u++)for(var l=r[u],c=u;c<r.length;c++){var d=r[c];YDe(l,d)&&(l.nextLadder=c,d.previousLadder=u)}}function QDe(e){for(var t=e.proteinInfo,r=e.hbonds,n=e.flags,i=e.bridges,a=r.offset,o=r.b,s,u,l=0,c=t.residueIndices.length;l<c;++l)for(var d=a[l],f=a[l+1];d<f;d++){var h=o[d];l>h||(s=l+1,u=h,s!==u&&r.getDirectedEdgeIndex(u,s+1)!==-1&&(n[s]|=2,n[u]|=2,i[i.length]=new W2(s,u,0)),s=l,u=h-1,s!==u&&r.getDirectedEdgeIndex(u-1,s)!==-1&&(n[s]|=2,n[u]|=2,i[i.length]=new W2(u,s,0)),s=l,u=h,s!==u&&r.getDirectedEdgeIndex(u,s)!==-1&&(n[s]|=2,n[u]|=2,i[i.length]=new W2(u,s,1)),s=l+1,u=h-1,s!==u&&r.getDirectedEdgeIndex(u-1,s+1)!==-1&&(n[s]|=2,n[u]|=2,i[i.length]=new W2(u,s,1)))}i.sort(function(v,p){return v.partner1>p.partner1?1:v.partner1<p.partner1?-1:0})}function s9(e){return rr.is(e,8)||rr.is(e,1)||rr.is(e,16)}function ZDe(e){for(var t=e.ladders,r=e.flags,n=0;n<t.length;n++){for(var i=t[n],a=i.firstStart;a<=i.firstEnd;a++){var o=i.firstStart-a,s=i.secondStart-o;i.firstStart!==i.firstEnd?(r[a]|=4,r[s]|=4):(!s9(r[a])&&rr.is(r[a],4)&&(r[a]|=2),!s9(r[s])&&rr.is(r[s],4)&&(r[s]|=2))}if(i.nextLadder!==0){for(var u=t[i.nextLadder],a=i.firstStart;a<=u.firstEnd;a++)r[a]|=4;if(i.type===0)for(var a=i.secondStart;a<=u.secondEnd;a++)r[a]|=4;else for(var a=u.secondEnd;a<=i.secondStart;a++)r[a]|=4}}}function JDe(e,t){var r=t.cIndices,n=t.nIndices,i=t.residueIndices,a=e.conformation.position,o=e.model.atomicHierarchy.index,s=e.model.atomicHierarchy.derived.residue.traceElementIndex,u=i.length,l=function(C,w){return C===-1?_.setNaN(w):a(C,w)},c=_(),d=_(),f=_(),h=_(),v=_(),p=_(),m=_(),g=_(),y=_();if(u===0)return{phi:new Float32Array(0),psi:new Float32Array(0)};var b=new Float32Array(u-1),S=new Float32Array(u-1);l(-1,c),l(-1,d),l(-1,f),l(r[0],h),l(s[i[0]],v),l(n[0],p),l(r[1],m),l(s[i[1]],g),l(n[1],y);for(var x=0;x<u-1;++x)o.findAtomOnResidue(i[x],"OXT")===-1&&(b[x]=mu(_.dihedralAngle(c,p,v,h)),S[x]=mu(_.dihedralAngle(p,v,h,y)),c=h,d=v,f=p,h=m,v=g,p=y,l(r[x+1],m),l(s[i[x+1]],g),l(n[x+1],y));return{phi:b,psi:S}}function eRe(e,t){for(var r=e.model.atomicConformation,n=r.x,i=r.y,a=r.z,o=e.model.atomicHierarchy.derived.residue.traceElementIndex,s=new Uint32Array(t.length),u=0,l=t.length;u<l;++u)s[u]=o[t[u]];var c={x:n,y:i,z:a,indices:Je.ofSortedArray(s)};return qp(c,Eg(c))}function tRe(e){for(var t=e.model.atomicHierarchy.index,r=e.proteinElements,n=e.residueIndex,i=r.length,a=new Uint32Array(i),o=new Int32Array(i),s=new Int32Array(i),u=new Int32Array(i),l=new Int32Array(i),c=0;c<i;++c){var d=n[r[c]];a[c]=d,o[c]=t.findAtomOnResidue(d,"C"),s[c]=t.findAtomOnResidue(d,"H"),u[c]=t.findAtomOnResidue(d,"O"),l[c]=t.findAtomOnResidue(d,"N")}return{residueIndices:Je.ofSortedArray(a),cIndices:o,hIndices:s,oIndices:u,nIndices:l}}var rRe={oldDefinition:I.Boolean(!0,{description:"Whether to use the old DSSP convention for the annotation of turns and helices, causes them to be two residues shorter"}),oldOrdering:I.Boolean(!0,{description:"Alpha-helices are preferred over 3-10 helices"})};function nRe(e,t){return ce(this,void 0,void 0,function(){var r,n,i,a,o,s,u,l,c,d,f,h,v,p,m,g,y,b,S,x,C;return de(this,function(w){for(r=tRe(e),n=r.residueIndices,i=eRe(e,n),a=GDe(e,r,i),o=n.length,s=new Uint32Array(o),u=JDe(e,r),l=[],c=[],d=t.oldDefinition?oRe:uRe,f=t.oldOrdering?sRe:lRe,h={params:t,getResidueFlag:d,getFlagName:f,unit:e,proteinInfo:r,flags:s,hbonds:a,torsionAngles:u,ladders:l,bridges:c},WDe(h),$De(h),jDe(h),QDe(h),KDe(h),ZDe(h),v=cRe(s,d),p=new Uint32Array(o),m=[],g=[],y=function(A){return Je.indexOf(n,A)},b=0,S=n.length;b<S;++b)x=v[b],p[b]=x,C=d(s[b]),(g.length===0||C!==g[g.length-1].flags)&&(g[g.length]=iRe(aRe(x),s[b],d)),m[b]=g.length-1;return[2,HK(p,m,g,y)]})})}function iRe(e,t,r){return e==="helix"?{kind:"helix",flags:r(t)}:e==="sheet"?{kind:"sheet",flags:r(t)}:e==="turn"||e==="bend"?{kind:"turn",flags:r(t)}:{kind:"none"}}function aRe(e){return e===Lr.SecondaryStructureDssp.H||e===Lr.SecondaryStructureDssp.G||e===Lr.SecondaryStructureDssp.I?"helix":e===Lr.SecondaryStructureDssp.B||e===Lr.SecondaryStructureDssp.E?"sheet":e===Lr.SecondaryStructureDssp.T?"turn":e===Lr.SecondaryStructureDssp.S?"bend":"none"}function oRe(e){return rr.is(e,1)?Lr.SecondaryStructureDssp.H:rr.is(e,4)?Lr.SecondaryStructureDssp.E:rr.is(e,2)?Lr.SecondaryStructureDssp.B:rr.is(e,8)?Lr.SecondaryStructureDssp.G:rr.is(e,16)?Lr.SecondaryStructureDssp.I:rr.is(e,64)?Lr.SecondaryStructureDssp.T:rr.is(e,32)?Lr.SecondaryStructureDssp.S:0}function sRe(e){return rr.is(e,1)?"H":rr.is(e,4)?"E":rr.is(e,2)?"B":rr.is(e,8)?"G":rr.is(e,16)?"I":rr.is(e,64)?"T":rr.is(e,32)?"S":"-"}function uRe(e){return rr.is(e,16)?Lr.SecondaryStructureDssp.I:rr.is(e,1)?Lr.SecondaryStructureDssp.H:rr.is(e,4)?Lr.SecondaryStructureDssp.E:rr.is(e,2)?Lr.SecondaryStructureDssp.B:rr.is(e,8)?Lr.SecondaryStructureDssp.G:rr.is(e,64)?Lr.SecondaryStructureDssp.T:rr.is(e,32)?Lr.SecondaryStructureDssp.S:0}function lRe(e){return rr.is(e,16)?"I":rr.is(e,1)?"H":rr.is(e,4)?"E":rr.is(e,2)?"B":rr.is(e,8)?"G":rr.is(e,64)?"T":rr.is(e,32)?"S":"-"}function cRe(e,t){for(var r=new Uint32Array(e.length),n=0,i=e.length;n<i;++n){var a=rr.create(e[n]);r[n]=t(a)}return r}var Yf;(function(e){function t(n){var i=this,a=n.descriptor.name,o=n.type==="root"?"inheritedPropertyData":"currentPropertyData",s=function(l){return a in l[o]||(l[o][a]={props:E({},I.getDefaultValues(n.getParams(l))),data:Hf.create(void 0)}),l[o][a]},u=function(l,c,d){var f=s(l);l[o][a]={props:c,data:Hf.withValue(f.data,d)}};return{label:n.label,descriptor:n.descriptor,isHidden:n.isHidden,getParams:function(l){var c=I.clone(n.getParams(l));return I.setDefaultValues(c,s(l).props),c},defaultParams:n.defaultParams,isApplicable:n.isApplicable,attach:function(l,c,d,f){return d===void 0&&(d={}),ce(i,void 0,void 0,function(){var h,v,p,m,g,y;return de(this,function(b){switch(b.label){case 0:return f&&c.customPropertyDescriptors.reference(n.descriptor,!0),n.type==="root"&&(c=c.root),h=s(c.root).props,v=s(c),p=I.merge(n.defaultParams,h,d),v.data.value&&I.areEqual(n.defaultParams,v.props,p)?[2]:[4,n.obtain(l,c,p)];case 1:return m=b.sent(),g=m.value,y=m.assets,c.customPropertyDescriptors.add(n.descriptor),c.customPropertyDescriptors.assets(n.descriptor,y),u(c,p,g),[2]}})})},ref:function(l,c){return l.customPropertyDescriptors.reference(n.descriptor,c)},get:function(l){return s(l).data},set:function(l,c,d){c===void 0&&(c={}),n.type==="root"&&(l=l.root);var f=s(l),h=I.merge(n.defaultParams,f.props,c);I.areEqual(n.defaultParams,f.props,h)||(u(l,h,d),l.customPropertyDescriptors.assets(n.descriptor))},props:function(l){return s(l).props}}}e.createProvider=t;function r(n,i,a){var o=this,s={value:I.Value(a,{isHidden:!0})};return t({label:zo(n),descriptor:yo({name:n}),isHidden:!0,type:i,defaultParams:s,getParams:function(){return{value:I.Value(a,{isHidden:!0})}},isApplicable:function(){return!0},obtain:function(u,l,c){return ce(o,void 0,void 0,function(){return de(this,function(d){return[2,E(E({},I.getDefaultValues(s)),c)]})})}})}e.createSimple=r})(Yf||(Yf={}));function uQ(e){var t="model";if(e){t="dssp";for(var r=0,n=e.models.length;r<n;++r){var i=e.models[r];if(Wt.isFromPdbArchive(i)||Wt.hasSecondaryStructure(i)){t="model";break}}}return{type:I.MappedStatic(t,{model:I.EmptyGroup({label:"Model"}),dssp:I.Group(rRe,{label:"DSSP",isFlat:!0})},{options:[["model","Model"],["dssp","DSSP"]]})}}var u9=uQ(),Al=Yf.createProvider({label:"Secondary Structure",descriptor:yo({name:"molstar_computed_secondary_structure"}),type:"root",defaultParams:u9,getParams:uQ,isApplicable:function(e){return!0},obtain:function(e,t,r){return ce(void 0,void 0,void 0,function(){var n,i,a,o;return de(this,function(s){switch(s.label){case 0:switch(n=E(E({},I.getDefaultValues(u9)),r),i=n.type.name,i){case"dssp":return[3,1];case"model":return[3,3]}return[3,5];case 1:return a={},[4,dRe(t,n.type.params)];case 2:return[2,(a.value=s.sent(),a)];case 3:return o={},[4,fRe(t)];case 4:return[2,(o.value=s.sent(),o)];case 5:return[2]}})})}});function dRe(e,t){return ce(this,void 0,void 0,function(){var r,n,i,a,o;return de(this,function(s){switch(s.label){case 0:r=new Map,n=0,i=e.unitSymmetryGroups.length,s.label=1;case 1:return n<i?(a=e.unitSymmetryGroups[n].units[0],Ue.isAtomic(a)&&!Wt.isCoarseGrained(a.model)?[4,nRe(a,t)]:[3,3]):[3,4];case 2:o=s.sent(),r.set(a.invariantId,o),s.label=3;case 3:return++n,[3,1];case 4:return[2,r]}})})}function fRe(e){return ce(this,void 0,void 0,function(){var t,r,n,i,a;return de(this,function(o){for(t=new Map,r=0,n=e.unitSymmetryGroups.length;r<n;++r)i=e.unitSymmetryGroups[r].units[0],Ue.isAtomic(i)&&(a=Y1.Provider.get(i.model),a&&t.set(i.invariantId,a));return[2,t]})})}var hRe={true:function(e){return!0},false:function(e){return!1},zero:function(e){return 0}};function Dn(){throw"Property only available for atomic models."}function Ed(e){throw e?"Property only available for coarse models ("+e+").":"Property only available for coarse models."}var by={key:function(e){return e.element},x:function(e){return e.unit.conformation.x(e.element)},y:function(e){return e.unit.conformation.y(e.element)},z:function(e){return e.unit.conformation.z(e.element)},id:function(e){return Ue.isAtomic(e.unit)?e.unit.model.atomicConformation.atomId.value(e.element):Dn()},occupancy:function(e){return Ue.isAtomic(e.unit)?e.unit.model.atomicConformation.occupancy.value(e.element):Dn()},B_iso_or_equiv:function(e){return Ue.isAtomic(e.unit)?e.unit.model.atomicConformation.B_iso_or_equiv.value(e.element):Dn()},sourceIndex:function(e){return Ue.isAtomic(e.unit)?e.unit.model.atomicHierarchy.atomSourceIndex.value(e.element):e.element},type_symbol:function(e){return Ue.isAtomic(e.unit)?e.unit.model.atomicHierarchy.atoms.type_symbol.value(e.element):Dn()},label_atom_id:function(e){return Ue.isAtomic(e.unit)?e.unit.model.atomicHierarchy.atoms.label_atom_id.value(e.element):Dn()},auth_atom_id:function(e){return Ue.isAtomic(e.unit)?e.unit.model.atomicHierarchy.atoms.auth_atom_id.value(e.element):Dn()},label_alt_id:function(e){return Ue.isAtomic(e.unit)?e.unit.model.atomicHierarchy.atoms.label_alt_id.value(e.element):Dn()},label_comp_id:i_,auth_comp_id:function(e){return Ue.isAtomic(e.unit)?e.unit.model.atomicHierarchy.atoms.auth_comp_id.value(e.element):Dn()},pdbx_formal_charge:function(e){return Ue.isAtomic(e.unit)?e.unit.model.atomicHierarchy.atoms.pdbx_formal_charge.value(e.element):Dn()},vdw_radius:function(e){return Ue.isAtomic(e.unit)?Pb(e.unit.model.atomicHierarchy.atoms.type_symbol.value(e.element)):Dn()}};function i_(e){return Ue.isAtomic(e.unit)||Dn(),e.unit.model.atomicHierarchy.atoms.label_comp_id.value(e.element)}function SO(e){return Ue.isAtomic(e.unit)?e.unit.model.atomicHierarchy.residues.label_seq_id.value(e.unit.residueIndex[e.element]):Dn()}function pRe(e){Ue.isAtomic(e.unit)||Dn();var t=e.unit.model.sequence.byEntityKey[Va(e)];return t&&t.sequence.microHet.has(SO(e))}function l9(e){Ue.isAtomic(e.unit)||Dn();var t=e.unit.model.sequence.byEntityKey[Va(e)];return t?t.sequence.microHet.get(SO(e))||[i_(e)]:[i_(e)]}var vRe={key:function(e){return Ue.isAtomic(e.unit)?e.unit.residueIndex[e.element]:Dn()},group_PDB:function(e){return Ue.isAtomic(e.unit)?e.unit.model.atomicHierarchy.residues.group_PDB.value(e.unit.residueIndex[e.element]):Dn()},label_seq_id:SO,auth_seq_id:function(e){return Ue.isAtomic(e.unit)?e.unit.model.atomicHierarchy.residues.auth_seq_id.value(e.unit.residueIndex[e.element]):Dn()},pdbx_PDB_ins_code:function(e){return Ue.isAtomic(e.unit)?e.unit.model.atomicHierarchy.residues.pdbx_PDB_ins_code.value(e.unit.residueIndex[e.element]):Dn()},isNonStandard:function(e){return Ue.isAtomic(e.unit)?l9(e).some(function(t){return e.unit.model.properties.chemicalComponentMap.get(t).mon_nstd_flag[0]==="n"}):Dn()},hasMicroheterogeneity:pRe,microheterogeneityCompIds:l9,secondary_structure_type:function(e){var t,r;Ue.isAtomic(e.unit)||Dn();var n=(t=Al.get(e.structure).value)===null||t===void 0?void 0:t.get(e.unit.invariantId);return(r=n==null?void 0:n.type[e.unit.residueIndex[e.element]])!==null&&r!==void 0?r:536870912},secondary_structure_key:function(e){var t,r;Ue.isAtomic(e.unit)||Dn();var n=(t=Al.get(e.structure).value)===null||t===void 0?void 0:t.get(e.unit.invariantId);return(r=n==null?void 0:n.key[e.unit.residueIndex[e.element]])!==null&&r!==void 0?r:-1},chem_comp_type:function(e){return Ue.isAtomic(e.unit)?e.unit.model.properties.chemicalComponentMap.get(i_(e)).type:Dn()}},mRe={key:function(e){return Ue.isAtomic(e.unit)?e.unit.chainIndex[e.element]:Dn()},label_asym_id:function(e){return Ue.isAtomic(e.unit)?e.unit.model.atomicHierarchy.chains.label_asym_id.value(e.unit.chainIndex[e.element]):Dn()},auth_asym_id:function(e){return Ue.isAtomic(e.unit)?e.unit.model.atomicHierarchy.chains.auth_asym_id.value(e.unit.chainIndex[e.element]):Dn()},label_entity_id:function(e){return Ue.isAtomic(e.unit)?e.unit.model.atomicHierarchy.chains.label_entity_id.value(e.unit.chainIndex[e.element]):Dn()}},gRe={key:by.key,entityKey:function(e){return Ue.isCoarse(e.unit)?e.unit.coarseElements.entityKey[e.element]:Ed()},x:by.x,y:by.y,z:by.z,asym_id:function(e){return Ue.isCoarse(e.unit)?e.unit.coarseElements.asym_id.value(e.element):Ed()},seq_id_begin:function(e){return Ue.isCoarse(e.unit)?e.unit.coarseElements.seq_id_begin.value(e.element):Ed()},seq_id_end:function(e){return Ue.isCoarse(e.unit)?e.unit.coarseElements.seq_id_end.value(e.element):Ed()},sphere_radius:function(e){return Ue.isSpheres(e.unit)?e.unit.coarseConformation.radius[e.element]:Ed("spheres")},sphere_rmsf:function(e){return Ue.isSpheres(e.unit)?e.unit.coarseConformation.rmsf[e.element]:Ed("spheres")},gaussian_weight:function(e){return Ue.isGaussians(e.unit)?e.unit.coarseConformation.weight[e.element]:Ed("gaussians")},gaussian_covariance_matrix:function(e){return Ue.isGaussians(e.unit)?e.unit.coarseConformation.covariance_matrix[e.element]:Ed("gaussians")}};function Va(e){switch(e.unit.kind){case 0:return e.unit.model.atomicHierarchy.index.getEntityFromChain(e.unit.chainIndex[e.element]);case 1:return e.unit.model.coarseHierarchy.spheres.entityKey[e.element];case 2:return e.unit.model.coarseHierarchy.gaussians.entityKey[e.element]}}var yRe={key:Va,id:function(e){return e.unit.model.entities.data.id.value(Va(e))},type:function(e){return e.unit.model.entities.data.type.value(Va(e))},src_method:function(e){return e.unit.model.entities.data.src_method.value(Va(e))},pdbx_description:function(e){return e.unit.model.entities.data.pdbx_description.value(Va(e))},formula_weight:function(e){return e.unit.model.entities.data.formula_weight.value(Va(e))},pdbx_number_of_molecules:function(e){return e.unit.model.entities.data.pdbx_number_of_molecules.value(Va(e))},details:function(e){return e.unit.model.entities.data.details.value(Va(e))},pdbx_mutation:function(e){return e.unit.model.entities.data.pdbx_mutation.value(Va(e))},pdbx_fragment:function(e){return e.unit.model.entities.data.pdbx_fragment.value(Va(e))},pdbx_ec:function(e){return e.unit.model.entities.data.pdbx_ec.value(Va(e))},subtype:function(e){return e.unit.model.entities.subtype.value(Va(e))},prd_id:function(e){return e.unit.model.entities.prd_id.value(Va(e))}},bRe=[],xRe={id:function(e){return e.unit.id},chainGroupId:function(e){return e.unit.chainGroupId},multiChain:function(e){return Ue.Traits.is(e.unit.traits,1)},object_primitive:function(e){return e.unit.objectPrimitive},operator_name:function(e){return e.unit.conformation.operator.name},model_index:function(e){return e.unit.model.modelNum},model_label:function(e){return e.unit.model.label},model_entry_id:function(e){return e.unit.model.entryId},hkl:function(e){return e.unit.conformation.operator.hkl},spgrOp:function(e){return e.unit.conformation.operator.spgrOp},model_num:function(e){return e.unit.model.modelNum},pdbx_struct_assembly_id:function(e){var t;return((t=e.unit.conformation.operator.assembly)===null||t===void 0?void 0:t.id)||pn.DefaultName},pdbx_struct_oper_list_ids:function(e){var t;return((t=e.unit.conformation.operator.assembly)===null||t===void 0?void 0:t.operList)||bRe},struct_ncs_oper_id:function(e){return e.unit.conformation.operator.ncsId}},lt={constant:hRe,atom:by,residue:vRe,chain:mRe,entity:yRe,unit:xRe,coarse:gRe},$y=function(){function e(t){var r;this.index=new Map,this.checkOperator=!1,this.checkOperator=(r=t==null?void 0:t.checkOperator)!==null&&r!==void 0?r:!1}return e.prototype.add=function(t){var r=this.index.get(t.label_asym_id);r||(r=new Map,this.index.set(t.label_asym_id,r));var n=r.get(t.label_seq_id);n||(n=[],r.set(t.label_seq_id,n));var i=this._find(t,n);return i?!1:(n.push(t),!0)},e.prototype.hasLabelAsymId=function(t){return this.index.has(t)},e.prototype.has=function(t){var r,n,i=c9(t);if(this.index.has(i)){var a=this.index.get(i),o=d9(t);if(a.has(o))for(var s=a.get(o),u=f9(t),l=h9(t),c=p9(t),d=(r=v9(t))!==null&&r!==void 0?r:"1_555",f=0,h=s;f<h.length;f++){var v=h[f];if(!(v.label_comp_id!==u||v.label_alt_id!==l||v.ins_code!==c)&&!(this.checkOperator&&((n=v.operator_name)!==null&&n!==void 0?n:"1_555")!==d))return v}}},e.getLabel=function(t,r){var n;return r===void 0&&(r=!1),t.label_asym_id+" "+t.label_comp_id+" "+t.label_seq_id+":"+t.ins_code+":"+t.label_alt_id+(r?" "+((n=t.operator_name)!==null&&n!==void 0?n:"1_555"):"")},e.getEntryFromLocation=function(t){var r;return{label_asym_id:c9(t),label_comp_id:f9(t),label_seq_id:d9(t),label_alt_id:h9(t),ins_code:p9(t),operator_name:(r=v9(t))!==null&&r!==void 0?r:"1_555"}},e.prototype._find=function(t,r){for(var n,i,a=0,o=r;a<o.length;a++){var s=o[a];if(!(s.label_comp_id!==t.label_comp_id||s.label_alt_id!==t.label_alt_id||s.ins_code!==t.ins_code)&&!(this.checkOperator&&((n=s.operator_name)!==null&&n!==void 0?n:"1_555")!==((i=t.operator_name)!==null&&i!==void 0?i:"1_555")))return!0}return!1},e}(),c9=lt.chain.label_asym_id,d9=lt.residue.label_seq_id,f9=lt.atom.label_comp_id,h9=lt.atom.label_alt_id,p9=lt.residue.pdbx_PDB_ins_code,v9=lt.unit.operator_name;function Ag(e,t,r){for(var n=t.subsetBuilder(!0),i=0,a=r.units;i<a.length;i++){var o=a[i];if(o.kind!==0){n.setUnit(o.id,o.elements);continue}var s=o.model.atomicHierarchy.residueAtomSegments,u=t.unitMap.get(o.id).elements,l=o.elements;n.beginUnit(o.id);for(var c=nr.transientSegments(s,l);c.hasNext;)for(var d=c.move().index,f=s.offsets[d],h=s.offsets[d+1];f<h;f++)Je.has(u,f)&&n.addElement(f);n.commitUnit(),e.throwIfTimedOut()}return n.getStructure()}function SRe(e){return function(r){var n=e(r);if(mt.isSingleton(n))return mt.Singletons(r.inputStructure,Ag(r,r.inputStructure,n.structure));for(var i=new r5(r.inputStructure),a=0,o=n.structures;a<o.length;a++){var s=o[a];i.add(Ag(r,r.inputStructure,s))}return i.getSelection()}}function n5(e,t,r,n){for(var i=new k3(t),a=t.lookup3d,o=n.radius,s=0,u=r.units;s<u.length;s++){for(var l=u[s],c=l.conformation,d=c.x,f=c.y,h=c.z,v=l.elements,p=0,m=v.length;p<m;p++){var g=v[p];a.findIntoBuilder(d(g),f(g),h(g),o,i)}e.throwIfTimedOut()}return n.wholeResidues?Ag(e,t,i.getStructure()):i.getStructure()}function m9(e,t,r,n){var i=new k3(t),a=t.lookup3d,o=n.elementRadius,s=n.elementRadiusClosure,u=n.sourceMaxRadius,l=n.radius;e.pushCurrentElement(),e.element.structure=r;for(var c=0,d=r.units;c<d.length;c++){var f=d[c];e.element.unit=f;for(var h=f.conformation,v=h.x,p=h.y,m=h.z,g=f.elements,y=0,b=g.length;y<b;y++){var S=g[y];e.element.element=S;var x=o(e);a.findIntoBuilderWithRadius(v(S),p(S),m(S),x,u,l,s,i)}e.throwIfTimedOut()}return e.popCurrentElement(),n.wholeResidues?Ag(e,t,i.getStructure()):i.getStructure()}function CRe(e,t){return function(r){return e.element.structure=r.structure,e.element.unit=r.unit,e.element.element=r.element,t(e)}}function _Re(e,t){var r=0;e.element.structure=e.inputStructure;for(var n=0,i=e.inputStructure.units;n<i.length;n++){var a=i[n];e.element.unit=a;for(var o=a.elements,s=0,u=o.length;s<u;s++){var l=o[s];e.element.element=l;var c=t(e);c>r&&(r=c)}}return e.throwIfTimedOut(),r}function wRe(e,t){return function(n){var i=e(n);if(t.elementRadius){var a=E(E({},t),{elementRadius:t.elementRadius,elementRadiusClosure:CRe(n,t.elementRadius),sourceMaxRadius:_Re(n,t.elementRadius)});if(mt.isSingleton(i)){var o=m9(n,n.inputStructure,i.structure,a),s=mt.Singletons(n.inputStructure,o);return s}else{for(var u=new r5(n.inputStructure),l=0,c=i.structures;l<c.length;l++){var d=c[l];u.add(m9(n,n.inputStructure,d,a))}return u.getSelection()}}if(mt.isSingleton(i)){var o=n5(n,n.inputStructure,i.structure,t),s=mt.Singletons(n.inputStructure,o);return s}else{for(var u=new r5(n.inputStructure),f=0,h=i.structures;f<h.length;f++){var d=h[f];u.add(n5(n,n.inputStructure,d,t))}return u.getSelection()}}}function ERe(e,t){return function(n){var i=e(n);if(mt.structureCount(i)===0)return i;var a=mt.UniqueBuilder(n.inputStructure),o=function(s){return a.add(s)};return mt.forEach(i,function(s,u){n.pushInputStructure(s),mt.forEach(t(n),o),n.popInputStructure(),u%10===0&&n.throwIfTimedOut()}),a.getSelection()}}function ARe(e,t){return function(n){var i=e(n);if(mt.structureCount(i)===0)return i;var a=t(n);if(mt.structureCount(a)===0)return mt.Empty(n.inputStructure);var o=mt.unionStructure(a),s=mt.UniqueBuilder(n.inputStructure);return mt.forEach(i,function(u,l){var c=iQ(o,u);c.elementCount!==0&&s.add(c),l%50===0&&n.throwIfTimedOut()}),s.getSelection()}}function PRe(e,t){return function(n){var i=e(n);if(mt.structureCount(i)===0)return i;var a=t(n);if(mt.structureCount(a)===0)return i;var o=mt.unionStructure(a),s=mt.UniqueBuilder(n.inputStructure);return mt.forEach(i,function(u,l){var c=yO(u,o);c.elementCount!==0&&s.add(c),l%50===0&&n.throwIfTimedOut()}),s.getSelection()}}function TRe(e){return function(r){var n=mt.LinearBuilder(r.inputStructure);return n.add(mt.unionStructure(e(r))),n.getSelection()}}function IRe(e,t){return function(n){var i=e(n),a=new Map,o=[];n.pushCurrentElement(),mt.forEach(i,function(x,C){n.element.structure=x;for(var w=0,A=x.units;w<A.length;w++){var M=A[w];n.element.unit=M;for(var D=M.elements,k=0,R=D.length;k<R;k++){n.element.element=D[k];var L=t(n),H=void 0;a.has(L)?H=a.get(L):(H=Zr.create(),a.set(L,H)),Zr.add(H,C,C)}}o[C]=n.inputStructure.subsetBuilder(!0),C%10===0&&n.throwIfTimedOut()}),n.element.structure=n.inputStructure;for(var s=0,u=n.inputStructure.units;s<u.length;s++){var l=u[s];n.element.unit=l;for(var c=l.elements,d=0,f=c.length;d<f;d++){n.element.element=c[d];var h=t(n);if(a.has(h))for(var v=a.get(h).array,p=0,m=v.length;p<m;p++)o[v[p]].addToUnit(l.id,c[d])}}n.popCurrentElement();for(var g=mt.UniqueBuilder(n.inputStructure),y=0,b=o;y<b.length;y++){var S=b[y];g.add(S.getStructure())}return g.getSelection()}}function MRe(e){var t=e.query,r=e.layerCount,n=e.wholeResidues,i=e.bondTest,a=e.fixedPoint,o=Math.max(r,0);return function(u){var l=mt.UniqueBuilder(u.inputStructure),c=t(u);return u.pushCurrentBond(),u.atomicBond.setTestFn(i),mt.forEach(c,function(d,f){var h=d;if(a)for(;;){var v=h.elementCount;if(h=g9(u,n,h),h.elementCount===v)break}else for(var p=0;p<o;p++)h=g9(u,n,h);l.add(h),f%10===0&&u.throwIfTimedOut()}),u.popCurrentBond(),l.getSelection()}}function g9(e,t,r){var n=DRe(e,r);return t?Ag(e,e.inputStructure,n):n}function DRe(e,t){for(var r=e.inputStructure,n=r.interUnitBonds,i=new k3(r),a=e.atomicBond,o=0,s=t.units;o<s.length;o++){var u=s[o];if(u.kind!==0){i.beginUnit(u.id);for(var l=0,c=u.elements.length;l<c;l++)i.addElement(u.elements[l]);i.commitUnit();continue}var d=r.unitMap.get(u.id),f=d.bonds,h=f.offset,v=f.b,p=f.edgeProps,m=p.flags,g=p.order;a.setStructure(r),a.a.unit=d,a.b.unit=d;for(var l=0,c=u.elements.length;l<c;l++){i.addToUnit(u.id,u.elements[l]);for(var y=Je.indexOf(d.elements,u.elements[l]),b=h[y],S=h[y+1];b<S;b++){var x=v[b],C=d.elements[x];Je.has(u.elements,C)||i.has(u.id,C)||(a.aIndex=y,a.a.element=u.elements[l],a.bIndex=x,a.b.element=C,a.type=m[b],a.order=g[b],a.test(e,!0)&&i.addToUnit(u.id,C))}}for(var w=0,A=n.getConnectedUnits(d.id);w<A.length;w++)for(var M=A[w],D=t.unitMap.get(M.unitB),k=r.unitMap.get(M.unitB),R=0,L=M.connectedIndices;R<L.length;R++){var H=L[R];if(Je.has(u.elements,d.elements[H]))for(var B=0,j=M.getEdges(H);B<j.length;B++){var Q=j[B],C=k.elements[Q.indexB];D&&Je.has(D.elements,C)||i.has(M.unitB,C)||(a.a.unit=d,a.aIndex=H,a.a.element=d.elements[H],a.b.unit=k,a.bIndex=Q.indexB,a.b.element=C,a.type=Q.props.flag,a.order=Q.props.order,a.test(e,!0)&&i.addToUnit(M.unitB,C))}}}return i.getStructure()}function RRe(e){var t=e.query,r=e.radius,n=e.includeWater;return function(a){for(var o=mt.unionStructure(t(a)),s=Ag(a,a.inputStructure,n5(a,a.inputStructure,o,{radius:r})),u=LRe(a.inputStructure),l=NRe(a.inputStructure),c=Ze.create(s),d=new Map,f=new $y({checkOperator:!0}),h=0,v=s.units;h<v.length;h++){var p=v[h];if(p.kind===0){c.unit=p;for(var m=p.elements,g=nr.transientSegments(p.model.atomicHierarchy.chainAtomSegments,m),y=nr.transientSegments(p.model.atomicHierarchy.residueAtomSegments,m);g.hasNext;){var b=g.move();c.element=m[b.start];var S=lt.chain.label_asym_id(c),x=lt.unit.operator_name(c);if(u.has(S)){d.has(S)?Pa(d.get(S),x):d.set(S,[x]);continue}var C=lt.entity.type(c);if(!(C==="water"||C==="polymer"))for(y.setSegment(b);y.hasNext;){var w=y.move();c.element=m[w.start],l.addComponent($y.getEntryFromLocation(c),f)}}a.throwIfTimedOut()}}for(var A=a.inputStructure.subsetBuilder(!0),M=0,D=a.inputStructure.units;M<D.length;M++){var p=D[M];if(p.kind===0){c.unit=p;var m=p.elements,g=nr.transientSegments(p.model.atomicHierarchy.chainAtomSegments,m),y=nr.transientSegments(p.model.atomicHierarchy.residueAtomSegments,m);for(A.beginUnit(p.id);g.hasNext;){var b=g.move();c.element=m[b.start];var S=lt.chain.label_asym_id(c),x=lt.unit.operator_name(c);if(d.has(S)&&d.get(S).indexOf(x)>=0){A.addElementRange(m,b.start,b.end);continue}if(f.hasLabelAsymId(S))for(y.setSegment(b);y.hasNext;){var w=y.move();c.element=m[w.start],f.has(c)&&A.addElementRange(m,w.start,w.end)}}A.commitUnit(),a.throwIfTimedOut()}}var k=J1(a.inputStructure,[A.getStructure(),o]);if(n){for(var R=new k3(a.inputStructure),L=a.inputStructure.lookup3d,H=0,B=k.units;H<B.length;H++){for(var p=B[H],j=p.conformation,Q=j.x,G=j.y,W=j.z,m=p.elements,q=0,ee=m.length;q<ee;q++){var he=m[q];L.findIntoBuilderIf(Q(he),G(he),W(he),r,R,ORe),R.addToUnit(p.id,he)}a.throwIfTimedOut()}return mt.Sequence(a.inputStructure,[R.getStructure()])}else return mt.Sequence(a.inputStructure,[k])}}var kRe=lt.entity.type;function ORe(e){return kRe(e)==="water"}function LRe(e){var t=e.models[0],r=new Set;if(!tn.is(t.sourceData))return r;for(var n=t.sourceData.data.db.pdbx_molecule,i=n._rowCount,a=n.asym_id,o=0;o<i;o++)r.add(a.value(o));return r}function NRe(e){var t,r,n=e.models[0],i=new FRe;if(!tn.is(n.sourceData))return i;for(var a=n.sourceData.data.db.struct_conn,o=a.conn_type_id,s=a.ptnr1_label_asym_id,u=a.ptnr1_label_comp_id,l=a.ptnr1_label_seq_id,c=a.ptnr1_symmetry,d=a.pdbx_ptnr1_label_alt_id,f=a.pdbx_ptnr1_PDB_ins_code,h=a.ptnr2_label_asym_id,v=a.ptnr2_label_comp_id,p=a.ptnr2_label_seq_id,m=a.ptnr2_symmetry,g=a.pdbx_ptnr2_label_alt_id,y=a.pdbx_ptnr2_PDB_ins_code,b=0;b<a._rowCount;b++){var S=o.value(b);if(!(S!=="covale"&&S!=="metalc")){var x={label_asym_id:s.value(b),label_comp_id:u.value(b),label_seq_id:l.value(b),label_alt_id:d.value(b),ins_code:f.value(b),operator_name:(t=c.value(b))!==null&&t!==void 0?t:"1_555"},C={label_asym_id:h.value(b),label_comp_id:v.value(b),label_seq_id:p.value(b),label_alt_id:g.value(b),ins_code:y.value(b),operator_name:(r=m.value(b))!==null&&r!==void 0?r:"1_555"};i.addEdge(x,C)}}return i}var FRe=function(){function e(){this.vertices=new Map,this.edges=new Map}return e.prototype.addVertex=function(t,r){this.vertices.has(r)||(this.vertices.set(r,t),this.edges.set(r,[]))},e.prototype.addEdge=function(t,r){var n=$y.getLabel(t),i=$y.getLabel(r);this.addVertex(t,n),this.addVertex(r,i),Pa(this.edges.get(n),i),Pa(this.edges.get(i),n)},e.prototype.addComponent=function(t,r){var n=$y.getLabel(t);if(!this.vertices.has(n)){r.add(t);return}var i=new Set,a=new Set,o=[n];for(a.add(n),r.add(t);o.length>0;){var s=o.pop();i.add(s);for(var u=this.vertices.get(s),l=0,c=this.edges.get(s);l<c.length;l++){var d=c[l];if(!i.has(d)&&(o.push(d),!a.has(d))){a.add(d);var f=this.vertices.get(d);u.operator_name===f.operator_name?r.add(E(E({},f),{operator_name:t.operator_name})):r.add(f)}}}},e}();const BRe=Object.freeze(Object.defineProperty({__proto__:null,exceptBy:PRe,expandProperty:IRe,includeConnected:MRe,includeSurroundings:wRe,intersectBy:ARe,querySelection:ERe,surroundingLigands:RRe,union:TRe,wholeResidues:SRe},Symbol.toStringTag,{value:"Module"}));function URe(e,t,r,n,i,a){return t.elementCount===0||r.elementCount===0?!0:t.elementCount<=r.elementCount?a_.check(e,t,r,n,i,a):a_.check(e,r,t,n,i,a)}function jRe(e,t,r,n,i){return t.elementCount===0||r.elementCount===0?!0:t.elementCount<=r.elementCount?o_.check(e,t,r,n,i):o_.check(e,r,t,n,i)}var a_;(function(e){var t=_.zero();function r(o,s,u,l,c,d,f){var h=s.elements,v=s.conformation.position,p=t;o.element.unit=s;for(var m=!1,g=0,y=h.length;g<y;g++){var b=h[g];o.element.element=b;var S=Math.max(0,_.distance(u,v(b,p))-l-f(o));if(S<c)return 0;S<d&&(m=!0)}return m?1:2}function n(o,s,u,l,c,d,f){for(var h=s.units,v=!1,p=0,m=h.length;p<m;p++){var g=r(o,h[p],u,l,c,d,f);if(g===0)return 0;g===1&&(v=!0)}return v?1:2}e.toPoint=n;var i=_.zero();function a(o,s,u,l,c,d){if(s.elementCount===0||u.elementCount===0)return 0;var f=s.units,h=!1;o.element.structure=s;for(var v=0,p=f.length;v<p;v++){var m=f[v],g=m.elements,y=m.conformation.position;o.element.unit=m;for(var b=0,S=g.length;b<S;b++){var x=g[b];o.element.element=x;var C=n(o,u,y(x,i),d(o),l,c,d);if(C===0)return 0;C===1&&(h=!0)}}return h}e.check=a})(a_||(a_={}));var o_;(function(e){var t=_.zero();function r(o,s,u,l,c,d){var f=s.elements,h=s.conformation.position,v=t;o.element.unit=s;for(var p=0,m=f.length;p<m;p++){var g=f[p];if(o.element.element=g,Math.max(0,_.distance(u,h(g,v))-l-d(o))<=c)return!0}return!1}function n(o,s,u,l,c,d){for(var f=s.units,h=0,v=f.length;h<v;h++)if(r(o,f[h],u,l,c,d))return!0;return!1}e.toPoint=n;var i=_.zero();function a(o,s,u,l,c){if(s.elementCount===0||u.elementCount===0)return 0;var d=s.units;o.element.structure=s;for(var f=0,h=d.length;f<h;f++){var v=d[f];o.element.unit=v;for(var p=v.elements,m=v.conformation.position,g=0,y=p.length;g<y;g++){var b=p[g];if(o.element.element=b,n(o,u,m(b,i),c(o),l,c))return!0}}return!1}e.check=a})(o_||(o_={}));function zRe(e,t){return function(r){var n=e(r),i=mt.LinearBuilder(r.inputStructure);return r.pushCurrentElement(),mt.forEach(n,function(a,o){r.currentStructure=a,t(r)&&i.add(a),o%100&&r.throwIfTimedOut()}),r.popCurrentStructure(),i.getSelection()}}function VRe(e){return function(t){var r=e(t),n=mt.LinearBuilder(t.inputStructure);if(r.kind==="singletons"){if(r.structure.elementCount>0){var i=r.structure.units[0],a=$e.create([i.getChild(Je.ofSingleton(i.elements[0]))],{parent:t.inputStructure});n.add(a)}}else r.structures.length>0&&n.add(r.structures[0]);return n.getSelection()}}function CO(e,t,r){var n=e.currentStructure.units,i=e.pushCurrentElement();i.structure=e.currentStructure;for(var a=0,o=n;a<o.length;a++){var s=o[a];i.unit=s;var u=s.elements,l=void 0;if(Ue.isAtomic(s)?l=t.atomic:l=t.coarse,!!l){for(var c=0,d=u.length;c<d;c++)i.element=u[c],r.add(l(e));e.throwIfTimedOut()}}return e.popCurrentElement(),r}function HRe(e,t,r){var n=new Set,i=t(e);return e.pushCurrentElement(),mt.forEach(i,function(a,o){e.currentStructure=a,CO(e,r,n),o%10&&e.throwIfTimedOut()}),e.popCurrentElement(),n}function GRe(e,t,r){return function(n){var i=e(n),a=HRe(n,t,r),o=mt.LinearBuilder(n.inputStructure);return n.pushCurrentStructure(),mt.forEach(i,function(s,u){n.currentStructure=s;var l=CO(n,r,new Set);li.isSuperset(l,a)&&o.add(s),u%10&&n.throwIfTimedOut()}),n.popCurrentStructure(),o.getSelection()}}function qRe(e,t){return function(r){var n=mt.unionStructure(t(r)),i=mt.LinearBuilder(r.inputStructure);return mt.forEach(e(r),function(a,o){R3(n,a)&&i.add(a),o%10&&r.throwIfTimedOut()}),i.getSelection()}}function WRe(e){return function(t){var r={queryCtx:t,selection:e.query(t),target:e.target(t),maxRadius:e.maxRadius,minRadius:e.minRadius?Math.max(0,e.minRadius):0,elementRadius:e.elementRadius,invert:!!e.invert};return r.minRadius===0&&typeof e.minRadius>"u"?$Re(r):r.minRadius===0?XRe(r):YRe(r)}}function $Re(e){var t=e.queryCtx,r=e.selection,n=e.target,i=e.maxRadius,a=e.invert,o=mt.unionStructure(n).lookup3d,s=mt.LinearBuilder(t.inputStructure),u=_.zero();return mt.forEach(r,function(l,c){for(var d=l.units,f=!1,h=0,v=d.length;h<v;h++){for(var p=d[h],m=p.elements,g=p.conformation,y=g.position,b=g.r,S=0,x=m.length;S<x;S++){var C=m[S];if(y(C,u),o.check(u[0],u[1],u[2],i+b(C))){f=!0;break}}if(f)break}a&&(f=!f),f&&s.add(l),c%10===0&&t.throwIfTimedOut()}),s.getSelection()}function XRe(e){var t=e.queryCtx,r=e.selection,n=e.target,i=e.maxRadius,a=e.invert,o=e.elementRadius,s=mt.unionStructure(n),u=mt.LinearBuilder(t.inputStructure);return t.pushCurrentElement(),mt.forEach(r,function(l,c){var d=jRe(t,s,l,i,o);a&&(d=!d),d&&u.add(l),c%10===0&&t.throwIfTimedOut()}),t.popCurrentElement(),u.getSelection()}function YRe(e){var t=e.queryCtx,r=e.selection,n=e.target,i=e.minRadius,a=e.maxRadius,o=e.invert,s=e.elementRadius,u=mt.unionStructure(n),l=mt.LinearBuilder(t.inputStructure);return t.pushCurrentElement(),mt.forEach(r,function(c,d){var f=URe(t,u,c,i,a,s);o&&(f=!f),f&&l.add(c),d%10===0&&t.throwIfTimedOut()}),t.popCurrentElement(),l.getSelection()}function KRe(e,t){var r=e.queryCtx,n=e.input,i=e.target,a=e.disjunct,o=r.atomicBond,s=n.interUnitBonds;o.setStructure(n);for(var u=0,l=t.units;u<l.length;u++){var c=l[u];if(Ue.isAtomic(c))for(var d=n.unitMap.get(c.id),f=d.bonds,h=f.offset,v=f.b,p=f.edgeProps,m=p.flags,g=p.order,y=s.getConnectedUnits(c.id),b=y.length,S=c.elements,x=d.elements,C=0,w=S.length;C<w;C++){var A=Je.indexOf(x,S[C]);o.a.unit=d,o.b.unit=d;for(var M=h[A],D=h[A+1];M<D;M++)if(o.b.element=d.elements[v[M]],!(a&&Je.has(c.elements,o.b.element))&&i.hasElement(o.b)&&(o.aIndex=A,o.a.element=S[C],o.bIndex=v[M],o.type=m[M],o.order=g[M],o.test(r,!0)))return!0;for(var k=0;k<b;k++)for(var R=y[k],L=n.unitMap.get(R.unitB),H=L.elements,B=R.getEdges(A),j=0,Q=B.length;j<Q;j++){var G=B[j];if(o.b.unit=L,o.b.element=H[G.indexB],!!i.hasElement(o.b)&&!(a&&t.hasElement(o.b))&&(o.a.unit=d,o.aIndex=A,o.a.element=S[C],o.bIndex=G.indexB,o.type=G.props.flag,o.order=G.props.order,o.test(r,!0)))return!0}}}return!1}function QRe(e){var t=e.query,r=e.target,n=e.disjunct,i=e.invert,a=e.bondTest;return function(o){var s=r(o);if(mt.isEmpty(s))return s;var u=t(o);if(mt.isEmpty(u))return u;var l={queryCtx:o,input:o.inputStructure,disjunct:n,target:mt.unionStructure(s)},c=mt.LinearBuilder(o.inputStructure);return o.pushCurrentBond(),o.atomicBond.setTestFn(a),mt.forEach(u,function(d,f){(KRe(l,d)||i)&&c.add(d),f%5===0&&o.throwIfTimedOut()}),o.popCurrentBond(),c.getSelection()}}const ZRe=Object.freeze(Object.defineProperty({__proto__:null,areIntersectedBy:qRe,first:VRe,getCurrentStructureProperties:CO,isConnectedTo:QRe,pick:zRe,withSameAtomProperties:GRe,within:WRe},Symbol.toStringTag,{value:"Module"}));function JRe(e){return e.length===0?bO:e.length===1?e[0]:function(t){for(var r=mt.UniqueBuilder(t.inputStructure),n=function(a){mt.forEach(e[a](t),function(o,s){r.add(o),a%100&&t.throwIfTimedOut()})},i=0;i<e.length;i++)n(i);return r.getSelection()}}function eke(e){return e.length===0?bO:e.length===1?e[0]:function(t){for(var r=[],n=0;n<e.length;n++)r.push(e[n](t));for(var i=0,a=mt.structureCount(r[0]),n=1;n<r.length;n++){var o=mt.structureCount(r[n]);o<a&&(i=n,a=o)}t.throwIfTimedOut();var s=eO(function(c){return c.hashCode},$e.areUnitIdsAndIndicesEqual);mt.forEach(r[i],function(c){return s.add(c)});for(var u=mt.UniqueBuilder(t.inputStructure),l=0;l<r.length;l++)l!==i&&(mt.forEach(r[l],function(c){s.has(c)&&u.add(c)}),t.throwIfTimedOut());return u.getSelection()}}const tke=Object.freeze(Object.defineProperty({__proto__:null,intersect:eke,merge:JRe},Symbol.toStringTag,{value:"Module"}));var i5;(function(e){function t(f){return!!f&&!!f.has}function r(f,h){return function(v){return f(v)===h}}e.eq=r;function n(f,h){return function(v){return f(v)<h}}e.lt=n;function i(f,h){return function(v){return f(v)<=h}}e.lte=i;function a(f,h){return function(v){return f(v)>h}}e.gt=a;function o(f,h){return function(v){return f(v)>=h}}e.gte=o;function s(f){return!0}function u(f){return!1}function l(f,h){if(t(h))return function(m){return h.has(f(m))};if(h.length===0)return u;for(var v=new Set,p=0;p<h.length;p++)v.add(h[p]);return function(m){return v.has(f(m))}}e.inSet=l;function c(){for(var f=[],h=0;h<arguments.length;h++)f[h]=arguments[h];switch(f.length){case 0:return s;case 1:return f[0];case 2:{var v=f[0],p=f[1];return function(W){return v(W)&&p(W)}}case 3:{var m=f[0],g=f[1],y=f[2];return function(W){return m(W)&&g(W)&&y(W)}}case 4:{var b=f[0],S=f[1],x=f[2],C=f[3];return function(W){return b(W)&&S(W)&&x(W)&&C(W)}}case 5:{var w=f[0],A=f[1],M=f[2],D=f[3],k=f[4];return function(W){return w(W)&&A(W)&&M(W)&&D(W)&&k(W)}}case 6:{var R=f[0],L=f[1],H=f[2],B=f[3],j=f[4],Q=f[5];return function(W){return R(W)&&L(W)&&H(W)&&B(W)&&j(W)&&Q(W)}}default:{var G=f.length;return function(W){for(var q=0;q<G;q++)if(!f[q])return!1;return!0}}}}e.and=c;function d(){for(var f=[],h=0;h<arguments.length;h++)f[h]=arguments[h];switch(f.length){case 0:return u;case 1:return f[0];case 2:{var v=f[0],p=f[1];return function(W){return v(W)||p(W)}}case 3:{var m=f[0],g=f[1],y=f[2];return function(W){return m(W)||g(W)||y(W)}}case 4:{var b=f[0],S=f[1],x=f[2],C=f[3];return function(W){return b(W)||S(W)||x(W)||C(W)}}case 5:{var w=f[0],A=f[1],M=f[2],D=f[3],k=f[4];return function(W){return w(W)||A(W)||M(W)||D(W)||k(W)}}case 6:{var R=f[0],L=f[1],H=f[2],B=f[3],j=f[4],Q=f[5];return function(W){return R(W)||L(W)||H(W)||B(W)||j(W)||Q(W)}}default:{var G=f.length;return function(W){for(var q=0;q<G;q++)if(f[q])return!0;return!1}}}}e.or=d})(i5||(i5={}));var en={generators:UDe,filters:ZRe,modifiers:BRe,combinators:tke,pred:i5,internal:TDe},dl;(function(e){function t(c,d){var f=this;return We.create("Build Assembly",function(h){return ce(f,void 0,void 0,function(){var v,p,m,g,y,b,S,x,C,w,A,M,D,k,R,L;return de(this,function(H){if(v=c.models,v.length!==1)throw new Error("Can only build assemblies from structures based on 1 model.");if(p=X1.findAssembly(v[0],d),!p)throw new Error("Assembly '"+d+"' is not defined.");for(m=pn.create(p.id,ue.identity(),{assembly:{id:p.id,operId:0,operList:[]}}),g=$e.Builder({coordinateSystem:m,label:c.label}),y=new Qo(c),b=0,S=p.operatorGroups;b<S.length;b++)if(x=S[b],C=x.selector(y),mt.structureCount(C)!==0)for(w=mt.unionStructure(C).units,A=0,M=x.operators;A<M.length;A++)for(D=M[A],k=0,R=w;k<R.length;k++)L=R[k],g.addWithOperator(L,D);return[2,g.getStructure()]})})})}e.buildAssembly=t;function r(c,d,f){var h=this;return We.create("Build Symmetry Assembly",function(v){return ce(h,void 0,void 0,function(){var p,m,g,y,b,S,x,C,w,A,M,D,k,R,L,H,B,j,Q,G,W,q,ee,he,$;return de(this,function(X){if(p=c.models,p.length!==1)throw new Error("Can only build symmetry assemblies from structures based on 1 model.");for(m=_(),g=$e.Builder({label:c.label,representativeModel:p[0]}),y=new Qo(c),b=0,S=d;b<S.length;b++)if(x=S[b],C=rke(x.asymIds),w=C(y),mt.structureCount(w)!==0)for(A=mt.unionStructure(w).units,M=0,D=x.operators;M<D.length;M++)for(k=D[M],R=k.index,L=k.shift,H=L[0],B=L[1],j=L[2],Q=lQ(f,R,H,B,j,m),G=0,W=A;G<W.length;G++)for(q=W[G],ee=0,he=Q;ee<he.length;ee++)$=he[ee],g.addWithOperator(q,$);return[2,g.getStructure()]})})})}e.buildSymmetryAssembly=r;function n(c,d){return We.create("Find Symmetry Mates",function(f){return oke(f,c,d)})}e.builderSymmetryMates=n;function i(c,d,f){return We.create("Build Symmetry",function(h){return ake(h,c,d,f)})}e.buildSymmetryRange=i;function a(c){return We.create("Build NCS",function(d){return ike(d,c)})}e.buildNcs=a;function o(c,d){return c.invariantId===d.invariantId&&c.model.id===d.model.id&&Je.areEqual(c.elements,d.elements)}e.areUnitsEquivalent=o;function s(){return F_e(Ue.hashUnit,o)}e.UnitEquivalenceBuilder=s;function u(c){for(var d=s(),f=0,h=c.units;f<h.length;f++){var v=h[f];d.add(v.id,v)}for(var p=[],m=0,g=d.groups;m<g.length;m++){var y=g[m];p.push(Ue.SymmetryGroup(y.map(function(b){return c.unitMap.get(b)})))}return p}e.computeTransformGroups=u;function l(c,d){if(c.length!==d.length)return!1;for(var f=0,h=c.length;f<h;++f){var v=c[f].units,p=d[f].units;if(v.length!==p.length||c[f].hashCode!==d[f].hashCode)return!1;for(var m=0,g=v.length;m<g;m++)if(v[m].conformation!==p[m].conformation)return!1}return!0}e.areTransformGroupsEquivalent=l})(dl||(dl={}));function rke(e){return en.generators.atoms({chainTest:en.pred.and(en.pred.eq(function(t){return lt.unit.operator_name(t.element)},pn.DefaultName),en.pred.inSet(function(t){return lt.chain.label_asym_id(t.element)},e))})}function lQ(e,t,r,n,i,a){var o=e.spacegroup,s=e.ncsOperators,u=[],l=o.cell.toFractional,c=_.transformMat4(_(),a,l),d=Du.getSymmetryOperatorRef(o,t,r,n,i,c);if(s&&s.length)for(var f=0,h=s.length;f<h;++f){var v=s[f],p=ue.mul(ue(),d.matrix,v.matrix),m=pn.create(d.name+" "+v.name,p,{assembly:d.assembly,ncsId:v.ncsId,hkl:d.hkl,spgrOp:d.spgrOp});u.push(m)}else u.push(d);return u}function cQ(e,t,r,n){var i=e.spacegroup,a=e.ncsOperators,o=a&&a.length||0,s=[];!o&&t[0]<=0&&r[0]>=0&&t[1]<=0&&r[1]>=0&&t[2]<=0&&r[2]>=0&&(s[0]=Du.getSymmetryOperator(i,0,0,0,0));for(var u=i.cell.toFractional,l=_.transformMat4(_(),n,u),c=0;c<i.operators.length;c++)for(var d=t[0];d<=r[0];d++)for(var f=t[1];f<=r[1];f++)for(var h=t[2];h<=r[2];h++)!o&&c===0&&d===0&&f===0&&h===0||s.push.apply(s,lQ(e,c,d,f,h,l));return s}function nke(e,t){return e._operators_333&&_.equals(t,e._operators_333.ref)||(e._operators_333={ref:_.clone(t),operators:cQ(e,_.create(-3,-3,-3),_.create(3,3,3),t)}),e._operators_333.operators}function dQ(e,t){for(var r=$e.Builder({label:e.label}),n=e.units,i=0,a=t;i<a.length;i++)for(var o=a[i],s=0,u=n;s<u.length;s++){var l=u[s];r.addWithOperator(l,o)}return r.getStructure()}function ike(e,t){return ce(this,void 0,void 0,function(){var r,n,i;return de(this,function(a){if(r=t.models,r.length!==1)throw new Error("Can only build NCS from structures based on 1 model.");return n=si.Provider.get(r[0]),n?(i=n.ncsOperators,!i||!i.length?[2,t]:[2,dQ(t,i)]):[2,t]})})}function ake(e,t,r,n){return ce(this,void 0,void 0,function(){var i,a,o,s,u;return de(this,function(l){if(i=t.models,i.length!==1)throw new Error("Can only build symmetries from structures based on 1 model.");return a=si.Provider.get(i[0]),a?(o=a.spacegroup,xo.isZero(o.cell)?[2,t]:(s=Wt.getCenter(i[0]),u=cQ(a,r,n,s),[2,dQ(t,u)])):[2,t]})})}function oke(e,t,r){return ce(this,void 0,void 0,function(){function n(D,k){return D.invariantId+"|"+k.name}var i,a,o,s,u,l,c,d,f,h,v,p,m,g,y,b,S,x,C,w,A,M;return de(this,function(D){switch(D.label){case 0:if(i=t.models,i.length!==1)throw new Error("Can only build symmetries from structures based on 1 model.");return a=si.Provider.get(i[0]),a?(o=a.spacegroup,xo.isZero(o.cell)?[2,t]:e.shouldUpdate?[4,e.update("Initialing...")]:[3,2]):[2,t];case 1:D.sent(),D.label=2;case 2:s=Wt.getCenter(i[0]),u=nke(a,s),l=t.lookup3d,c=new Set,d=$e.Builder({label:t.label}),f=t.units,h=_.zero(),v=0,p=u,D.label=3;case 3:if(!(v<p.length))return[3,6];for(m=p[v],g=0,y=f;g<y.length;g++)for(b=y[g],S=b.lookup3d.boundary.sphere,_.transformMat4(h,S.center,m.matrix),x=l.findUnitIndices(h[0],h[1],h[2],S.radius+r),C=0,w=x.count;C<w;C++)A=f[x.indices[C]],A.lookup3d.check(h[0],h[1],h[2],S.radius+r)&&(M=n(b,m),c.has(M)||(d.addWithOperator(b,m),c.add(M)));return e.shouldUpdate?[4,e.update("Building symmetry...")]:[3,5];case 4:D.sent(),D.label=5;case 5:return v++,[3,3];case 6:return[2,d.getStructure()]}})})}var ske=function(){function e(t,r){this.parent=t,this.isSorted=r,this.ids=[],this.unitMap=Ls.Mutable(),this.parentId=-1,this.currentUnit=[],this.elementCount=0}return e.prototype.addToUnit=function(t,r){var n=this.unitMap.get(t);n?n[n.length]=r:(this.unitMap.set(t,[r]),this.ids[this.ids.length]=t),this.elementCount++},e.prototype.beginUnit=function(t){this.parentId=t,this.currentUnit=this.currentUnit.length>0?[]:this.currentUnit},e.prototype.addElement=function(t){this.currentUnit[this.currentUnit.length]=t,this.elementCount++},e.prototype.addElementRange=function(t,r,n){for(var i=r;i<n;i++)this.currentUnit[this.currentUnit.length]=t[i],this.elementCount++},e.prototype.commitUnit=function(){this.currentUnit.length!==0&&(this.ids[this.ids.length]=this.parentId,this.unitMap.set(this.parentId,this.currentUnit),this.parentId=-1)},e.prototype.setUnit=function(t,r){this.ids[this.ids.length]=t,this.unitMap.set(t,r),this.elementCount+=r.length},e.prototype._getStructure=function(t){if(this.isEmpty)return $e.Empty;var r=[];gu(this.ids);for(var n=dl.UnitEquivalenceBuilder(),i=0,a=this.ids.length;i<a;i++){var o=this.ids[i],s=this.parent.unitMap.get(o),u=this.unitMap.get(o),l=!1;t&&(this.isSorted||gu(u),u=Je.deduplicate(Je.ofSortedArray(this.currentUnit)),l=!0);var c=u.length;if(u.length===s.elements.length){r[r.length]=s,n.add(s.id,s);continue}!this.isSorted&&!l&&c>1&&gu(u);var d=s.getChild(Je.ofSortedArray(u)),f=n.add(d.id,d);d!==f&&(d=f.applyOperator(d.id,d.conformation.operator,!0)),r[r.length]=d}return $e.create(r,{parent:this.parent})},e.prototype.getStructure=function(){return this._getStructure(!1)},e.prototype.getStructureDeduplicate=function(){return this._getStructure(!0)},e.prototype.setSingletonLocation=function(t){var r=this.ids[0];t.unit=this.parent.unitMap.get(r),t.element=this.unitMap.get(r)[0]},Object.defineProperty(e.prototype,"isEmpty",{get:function(){return this.elementCount===0},enumerable:!1,configurable:!0}),e}();function y9(e,t){for(var r=1;t--;)r*=e--;return r}function uke(e,t){return t>e?0:y9(e,t)/y9(t,t)}function lke(e){var t=e&-e,r=e+t,n=r&-r,i=(n/t>>1)-1;return r|i}var cke=function(){function e(t,r){this.array=t,this.hasNext=!1,this.index=(1<<r)-1,this.size=uke(t.length,r),this.maxIndex=1<<t.length,this.value=new Array(r),this.hasNext=r>0&&r<=t.length}return e.prototype.move=function(){if(this.hasNext){for(var t=0,r=0,n=this.index;n;n>>>=1,t++)n&1&&(this.value[r++]=this.array[t]);this.index=lke(this.index),this.hasNext=this.index<this.maxIndex}return this.value},e}();function fQ(e,t){for(var r=[],n=new cke(e,t);n.hasNext;)r.push(n.move().slice());return r}var bh=[],dke={links:bh,terminalLinks:bh,elements:bh,partialElements:bh,getElementIndices:function(){return bh},getLinkIndices:function(){return bh},getTerminalLinkIndices:function(){return bh}},Ci=Yg("C"),xy=Yg("O"),fke=[As.elementFingerprint([Ci,Ci,Ci,xy]),As.elementFingerprint([Ci,Ci,Ci,Ci,xy]),As.elementFingerprint([Ci,Ci,Ci,Ci,Ci,xy]),As.elementFingerprint([Ci,Ci,Ci,Ci,Ci,Ci,xy])];function hke(e,t){for(var r=-1,n=-1,i=-1,a=-1,o=e.elements,s=e.model.atomicHierarchy.atoms,u=s.type_symbol,l=s.label_atom_id,c=e.bonds,d=c.b,f=c.offset,h=0,v=t.length;h<v;++h){var p=o[t[h]];if(u.value(p)===Ci){for(var m=0,g=0,y=f[t[h]],b=f[t[h]+1];y<b;++y){var S=o[d[y]],x=u.value(S);x===xy?++m:x===Ci&&++g}if(m===2){r=p;break}else m===1&&g===1?n=p:l.value(p).startsWith("C1")?i=p:a=p}}return r!==-1?r:n!==-1?n:i!==-1?i:a!==-1?a:o[t[0]]}function pke(e,t){var r=e.elements,n=e.model.atomicHierarchy.atoms.label_alt_id;return n.value(r[t])}function vke(e,t,r,n){var i=t.conformation.position;return _.normalize(e,_.sub(e,n,i(r,e))),e}function b9(e,t){var r=e.elements,n=e.model.atomicHierarchy.atoms.label_atom_id;return n.value(r[t])}function mke(e,t){if(!(!t||!t.length)){for(var r=e.unit,n=e.all,i=new Set,a=fQ(Fs(new Array(t.length)),2),o=0,s=a.length;o<s;++o){var u=a[o],l=n[t[u[0]]],c=n[t[u[1]]];Je.areIntersecting(l,c)&&As.getAltId(r,l)===As.getAltId(r,c)&&(i.add(t[u[0]]),i.add(t[u[1]]))}if(i.size){for(var d=[],o=0,s=t.length;o<s;++o)i.has(t[o])||d.push(t[o]);return d}else return t}}function gke(e,t){return t.properties.saccharideComponentMap.get(e)}function yke(e){if(e.models.reduce(function(be,Ee){return be+Ee.properties.saccharideComponentMap.size},0)===0)return dke;var t=[],r=[],n=[],i=[],a=new Map;function o(be,Ee,Se){return be+"|"+Ee+"|"+Se}function s(be,Ee){a.has(be)?a.get(be).push(Ee):a.set(be,[Ee])}function u(be,Ee){_.sub(n[be].geometry.direction,n[Ee].geometry.center,n[be].geometry.center),_.normalize(n[be].geometry.direction,n[be].geometry.direction)}var l=_.zero();function c(be,Ee,Se){var ie=Se.conformation.position,oe=n[be].geometry;_.sub(oe.direction,ie(Se.elements[Ee],l),oe.center),_.normalize(oe.direction,oe.direction)}for(var d=0,f=e.units.length;d<f;++d){var h=e.units[d];if(Ue.isAtomic(h))for(var v=h.model,p=h.rings,m=v.atomicHierarchy,g=m.chainAtomSegments,y=m.residueAtomSegments,b=m.atoms,S=b.label_comp_id,x=nr.transientSegments(g,h.elements),C=nr.transientSegments(y,h.elements),w=void 0;x.hasNext;)for(C.setSegment(x.move());C.hasNext;){var A=C.move().index,M=gke(S.value(y.offsets[A]),v);if(M){w||(w=r_.byFingerprintAndResidue(p,fke));var D=mke(p,w.get(A));if(!D||!D.length){i.push({unit:h,residueIndex:A,component:M});continue}for(var k=[],R=0,L=D.length;R<L;++R){var H=p.all[D[R]],B=hke(h,H),j=$p.calculateMomentsAxes(TK(h,H)),Q=_.copy(_.zero(),j.origin),G=_.copy(_.zero(),j.dirC),W=vke(_.zero(),h,B,Q);_.orthogonalize(W,G,W);var q=As.getAltId(h,H),ee=n.length;k.push(ee),s(o(A,h.id,q),ee),q&&s(o(A,h.id,""),ee),n.push({geometry:{center:Q,normal:G,direction:W},component:M,ringIndex:D[R],altId:q,unit:h,residueIndex:A})}for(var he=fQ(Fs(new Array(D.length)),2),R=0,L=he.length;R<L;++R){var $=he[R],X=p.all[D[$[0]]],U=p.all[D[$[1]]];if(bo.areVertexSetsConnected(h.bonds,X,U,3)){var z=k[$[0]],J=k[$[1]];n[z].altId===n[J].altId&&(u(z,J),u(J,z),t.push({carbohydrateIndexA:z,carbohydrateIndexB:J}),t.push({carbohydrateIndexA:J,carbohydrateIndexB:z}))}}}}}function Y(be,Ee){return a.get(o(be.getResidueIndex(Ee),be.id,pke(be,Ee)))||[]}for(var d=0,f=n.length;d<f;++d)for(var Z=n[d],h=Z.unit,R=d+1;R<f;++R){var te=n[R];if(!(h!==te.unit||Z.residueIndex===te.residueIndex)){var le=h.rings.all[Z.ringIndex],ye=h.rings.all[te.ringIndex];bo.areVertexSetsConnected(h.bonds,le,ye,3)&&(u(d,R),u(R,d),t.push({carbohydrateIndexA:d,carbohydrateIndexB:R}),t.push({carbohydrateIndexA:R,carbohydrateIndexB:d}))}}for(var d=0,f=e.units.length;d<f;++d){var h=e.units[d];Ue.isAtomic(h)&&e.interUnitBonds.getConnectedUnits(h.id).forEach(function(ie){ie.connectedIndices.forEach(function(oe){ie.getEdges(oe).forEach(function(O){var V=O.props,pe=O.indexB;if(Nr.isCovalent(V.flag)){var _e=e.unitMap.get(ie.unitA),Pe=e.unitMap.get(ie.unitB),je=Y(_e,oe),ze=Y(Pe,pe);if(je.length>0&&ze.length>0)for(var Xe=je.length,ct=ze.length,Ne=0,Qe=Math.max(Xe,ct);Ne<Qe;++Ne){var it=je[Math.min(Ne,Xe-1)],ot=ze[Math.min(Ne,ct-1)],dt=b9(_e,oe);(dt.startsWith("O1")||dt.startsWith("C1"))&&u(it,ot),t.push({carbohydrateIndexA:it,carbohydrateIndexB:ot})}else if(ze.length===0)for(var Re=0,Ie=je;Re<Ie.length;Re++){var it=Ie[Re],dt=b9(_e,oe);(dt.startsWith("O1")||dt.startsWith("C1"))&&c(it,pe,Pe),r.push({carbohydrateIndex:it,elementIndex:pe,elementUnit:Pe,fromCarbohydrate:!0})}else if(je.length===0)for(var Ye=0,tt=ze;Ye<tt.length;Ye++){var ot=tt[Ye];r.push({carbohydrateIndex:ot,elementIndex:oe,elementUnit:_e,fromCarbohydrate:!1})}}})})})}return E({links:t,terminalLinks:r,elements:n,partialElements:i},bke(n,t,r))}function bke(e,t,r){function n(L,H){return Rf(L.id,H)}function i(L,H,B){var j=[],Q=L.get(n(H,B));if(Q!==void 0)for(var G=0,W=Q;G<W.length;G++){var q=W[G];Pa(j,q)}return j}for(var a=new Map,o=0,s=e.length;o<s;++o)for(var u=e[o],l=u.unit,c=u.ringIndex,d=l.rings.all[c],f=0,h=d.length;f<h;++f){var v=n(l,l.elements[d[f]]),p=a.get(v);p===void 0?a.set(v,[o]):p.push(o)}function m(L,H){return i(a,L,H)}for(var g=new Map,o=0,s=t.length;o<s;++o)for(var y=t[o],b=e[y.carbohydrateIndexA],l=b.unit,c=b.ringIndex,d=l.rings.all[c],f=0,h=d.length;f<h;++f){var v=n(l,l.elements[d[f]]),p=g.get(v);p===void 0?g.set(v,[o]):p.push(o)}function S(L,H){return i(g,L,H)}for(var x=new Map,o=0,s=r.length;o<s;++o){var C=r[o],w=C.fromCarbohydrate,A=C.carbohydrateIndex,M=C.elementUnit,D=C.elementIndex;if(w)for(var k=e[A],l=k.unit,c=k.ringIndex,d=l.rings.all[c],f=0,h=d.length;f<h;++f){var v=n(l,l.elements[d[f]]),p=x.get(v);p===void 0?x.set(v,[o]):p.push(o)}else{var v=n(M,M.elements[D]),p=x.get(v);p===void 0?x.set(v,[o]):p.push(o)}}function R(L,H){return i(x,L,H)}return{getElementIndices:m,getLinkIndices:S,getTerminalLinkIndices:R}}var $2=Fe(),xke=new rs("14"),Ske=new rs("98");function Cke(e){return e>500?xke:Ske}function _ke(e){var t=e.units,r=Cke(t.length);r.reset();for(var n=0,i=t.length;n<i;n++){var a=t[n],o=a.boundary,s=a.conformation.operator;s.isIdentity?r.includeSphere(o.sphere):(Fe.transform($2,o.sphere,s.matrix),r.includeSphere($2))}r.finishedIncludeStep();for(var n=0,i=t.length;n<i;n++){var a=t[n],o=a.boundary,s=a.conformation.operator;s.isIdentity?r.radiusSphere(o.sphere):(Fe.transform($2,o.sphere,s.matrix),r.radiusSphere($2))}return{box:r.getBox(),sphere:r.getSphere()}}var $e=function(){function e(t,r,n,i,a){this.units=t,this.unitMap=r,this.unitIndexMap=n,this.state=i,this._child=a==null?void 0:a.child,this._target=a==null?void 0:a.target}return e.prototype.subsetBuilder=function(t){return new ske(this,t)},Object.defineProperty(e.prototype,"elementCount",{get:function(){return this.state.elementCount},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"bondCount",{get:function(){return this.state.bondCount===-1&&(this.state.bondCount=this.interUnitBonds.edgeCount+Vt.getIntraUnitBondCount(this)),this.state.bondCount},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasCustomProperties",{get:function(){return!!this.state.customProps&&this.state.customProps.all.length>0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"customPropertyDescriptors",{get:function(){return this.state.customProps||(this.state.customProps=new Tl),this.state.customProps},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"currentPropertyData",{get:function(){return this.state.propertyData||(this.state.propertyData=Object.create(null)),this.state.propertyData},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"inheritedPropertyData",{get:function(){return this.parent?this.parent.currentPropertyData:this.currentPropertyData},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"polymerResidueCount",{get:function(){return this.state.polymerResidueCount===-1&&(this.state.polymerResidueCount=Dke(this)),this.state.polymerResidueCount},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"polymerGapCount",{get:function(){return this.state.polymerGapCount===-1&&(this.state.polymerGapCount=Rke(this)),this.state.polymerGapCount},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"polymerUnitCount",{get:function(){return this.state.polymerUnitCount===-1&&(this.state.polymerUnitCount=kke(this)),this.state.polymerUnitCount},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"uniqueElementCount",{get:function(){return this.state.uniqueElementCount===-1&&(this.state.uniqueElementCount=Mke(this)),this.state.uniqueElementCount},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"atomicResidueCount",{get:function(){return this.state.atomicResidueCount===-1&&(this.state.atomicResidueCount=Oke(this)),this.state.atomicResidueCount},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isCoarseGrained",{get:function(){return this.models.some(function(t){return Wt.isCoarseGrained(t)})},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isEmpty",{get:function(){return this.units.length===0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hashCode",{get:function(){return this.state.hashCode!==-1?this.state.hashCode:this.computeHash()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"transformHash",{get:function(){return this.state.transformHash!==-1?this.state.transformHash:(this.state.transformHash=La(this.units.map(function(t){return t.id})),this.state.transformHash)},enumerable:!1,configurable:!0}),e.prototype.computeHash=function(){for(var t=23,r=0,n=this.units.length;r<n;r++){var i=this.units[r];t=31*t+i.id|0,t=31*t+Je.hashCode(i.elements)|0}return t=31*t+this.elementCount|0,t=cY(t),t===-1&&(t=0),this.state.hashCode=t,t},e.prototype.elementLocations=function(){return new e.ElementLocationIterator(this)},Object.defineProperty(e.prototype,"root",{get:function(){return this.state.parent||this},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){return this.state.parent},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"coordinateSystem",{get:function(){return this.state.coordinateSystem},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"label",{get:function(){return this.state.label},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"boundary",{get:function(){return this.state.boundary?this.state.boundary:(this.state.boundary=_ke(this),this.state.boundary)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"lookup3d",{get:function(){return this.state.lookup3d?this.state.lookup3d:(this.state.lookup3d=new SDe(this),this.state.lookup3d)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"interUnitBonds",{get:function(){return this.state.interUnitBonds?this.state.interUnitBonds:(this.state.interUnitBonds=H5e(this),this.state.interUnitBonds)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"unitSymmetryGroups",{get:function(){return this.state.unitSymmetryGroups?this.state.unitSymmetryGroups:(this.state.unitSymmetryGroups=dl.computeTransformGroups(this),this.state.unitSymmetryGroups)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"unitSymmetryGroupsIndexMap",{get:function(){return this.state.unitSymmetryGroupsIndexMap?this.state.unitSymmetryGroupsIndexMap:(this.state.unitSymmetryGroupsIndexMap=Ue.SymmetryGroup.getUnitSymmetryGroupsIndexMap(this.unitSymmetryGroups),this.state.unitSymmetryGroupsIndexMap)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"carbohydrates",{get:function(){return this.state.carbohydrates?this.state.carbohydrates:(this.state.carbohydrates=yke(this),this.state.carbohydrates)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"models",{get:function(){return this.state.models?this.state.models:(this.state.models=Eke(this),this.state.models)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"uniqueResidueNames",{get:function(){return this.state.uniqueResidueNames||(this.state.uniqueResidueNames=Ake(this))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"uniqueElementSymbols",{get:function(){return this.state.uniqueElementSymbols||(this.state.uniqueElementSymbols=Pke(this))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"entityIndices",{get:function(){return this.state.entityIndices||(this.state.entityIndices=Tke(this))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"uniqueAtomicResidueIndices",{get:function(){return this.state.uniqueAtomicResidueIndices||(this.state.uniqueAtomicResidueIndices=Ike(this))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isAtomic",{get:function(){for(var t=0,r=this.units;t<r.length;t++){var n=r[t];if(!Ue.isAtomic(n))return!1}return!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasAtomic",{get:function(){for(var t=0,r=this.units;t<r.length;t++){var n=r[t];if(Ue.isAtomic(n))return!0}return!1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isCoarse",{get:function(){for(var t=0,r=this.units;t<r.length;t++){var n=r[t];if(!Ue.isCoarse(n))return!1}return!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasCoarse",{get:function(){for(var t=0,r=this.units;t<r.length;t++){var n=r[t];if(Ue.isCoarse(n))return!0}return!1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"serialMapping",{get:function(){return this.state.serialMapping||(this.state.serialMapping=Lke(this))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"model",{get:function(){if(this.state.model)return this.state.model;if(this.state.representativeModel)return this.state.representativeModel;if(this.state.masterModel)return this.state.masterModel;var t=this.models;if(t.length>1)throw new Error("The structure is based on multiple models and has neither a master- nor a representative-model.");return this.state.model=t[0],this.state.model},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"masterModel",{get:function(){return this.state.masterModel},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"representativeModel",{get:function(){return this.state.representativeModel},enumerable:!1,configurable:!0}),e.prototype.hasElement=function(t){return this.unitMap.has(t.unit.id)?Je.has(this.unitMap.get(t.unit.id).elements,t.element):!1},e.prototype.getModelIndex=function(t){return this.models.indexOf(t)},e.prototype.remapModel=function(t){for(var r=[],n=0,i=this.unitSymmetryGroups;n<i.length;n++){var a=i[n],o=a.units[0].remapModel(t);r.push(o);for(var s=1,u=a.units.length;s<u;++s){var l=a.units[s];r.push(l.remapModel(t,o.props))}}return e.create(r,{label:this.label,interUnitBonds:this.state.interUnitBonds})},e.prototype.asParent=function(){return this._proxy?this._proxy:(this._proxy=this.parent?new e(this.parent.units,this.parent.unitMap,this.parent.unitIndexMap,this.parent.state,{child:this,target:this.parent}):this,this._proxy)},Object.defineProperty(e.prototype,"child",{get:function(){return this._child},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"target",{get:function(){var t;return(t=this._target)!==null&&t!==void 0?t:this},enumerable:!1,configurable:!0}),e}();function wke(e,t,r){return e[t].id-e[r].id}function Eke(e){for(var t=e.units,r=Zr.create(),n=0,i=t;n<i.length;n++){var a=i[n];Zr.add(r,a.model.id,a.model)}return r.array}function Ake(e){for(var t=lt.residue.microheterogeneityCompIds,r=new Set,n=Ze.create(e),i=0,a=e.unitSymmetryGroups;i<a.length;i++){var o=a[i],s=o.units[0];if(Ue.isAtomic(s)){var u=nr.transientSegments(s.model.atomicHierarchy.residueAtomSegments,s.elements);for(n.unit=s;u.hasNext;){var l=u.move();n.element=s.elements[l.start];for(var c=t(n),d=0,f=c;d<f.length;d++){var h=f[d];r.add(h)}}}}return r}function Pke(e){for(var t=lt.atom.type_symbol,r=new Set,n=Ze.create(e),i=0,a=e.unitSymmetryGroups;i<a.length;i++){var o=a[i],s=o.units[0];if(Ue.isAtomic(s)){n.unit=s;for(var u=0,l=s.elements.length;u<l;++u)n.element=s.elements[u],r.add(t(n))}}return r}function Tke(e){for(var t=e.units,r=Ze.create(e),n=Zr.create(),i=0,a=t;i<a.length;i++){var o=a[i],s=o.kind===0?lt.entity.key:lt.coarse.entityKey;r.unit=o;for(var u=o.elements,l=nr.transientSegments(o.model.atomicHierarchy.chainAtomSegments,u);l.hasNext;){var c=l.move();r.element=u[c.start];var d=s(r);Zr.add(n,d,d)}}return gu(n.array),n.array}function Ike(e){for(var t=new Map,r=[],n=e.unitSymmetryGroups,i=0,a=n;i<a.length;i++){var o=a[i],s=o.units[0];if(Ue.isAtomic(s)){var u=void 0;t.has(s.model.id)?u=t.get(s.model.id):(u=Zr.create(),r.push(s.model.id),t.set(s.model.id,u));for(var l=nr.transientSegments(s.model.atomicHierarchy.residueAtomSegments,s.elements);l.hasNext;){var c=l.move();Zr.add(u,c.index,c.index)}}}for(var d=new Map,f=0,h=r;f<h.length;f++){var v=h[f],p=t.get(v).array;gu(p),d.set(v,p)}return d}function Mke(e){for(var t=e.unitSymmetryGroups,r=0,n=0,i=t.length;n<i;n++)r+=t[n].elements.length;return r}function Dke(e){for(var t=e.units,r=0,n=0,i=t.length;n<i;n++)r+=t[n].polymerElements.length;return r}function Rke(e){for(var t=e.units,r=0,n=0,i=t.length;n<i;n++)r+=t[n].gapElements.length/2;return r}function kke(e){for(var t=e.units,r=0,n=0,i=t.length;n<i;n++)t[n].polymerElements.length>0&&(r+=1);return r}function Oke(e){for(var t=e.units,r=0,n=0,i=t.length;n<i;n++){var a=t[n];if(Ue.isAtomic(a))for(var o=a.elements,s=a.residueIndex,u=-1,l=-1,c=0,d=o.length;c<d;++c)u=s[o[c]],u!==l&&(r+=1,l=u)}return r}function Lke(e){for(var t=e.units,r=e.elementCount,n=e.unitIndexMap,i=new Uint32Array(t.length),a=new Uint32Array(r),o=new Uint32Array(r),s=0,u=0,l=t.length;s<l;++s){i[s]=u;for(var c=t[s].elements,d=0,f=c.length;d<f;++d){var h=u+d;a[h]=s,o[h]=c[d]}u+=c.length}return{cumulativeUnitElementCount:i,unitIndices:a,elementIndices:o,getSerialIndex:function(v,p){return i[n.get(v.id)]+Oe.indexOf(v.elements,p)}}}(function(e){e.Empty=u([]);function t(U){return{kind:"structure-loci",structure:U}}e.Loci=t;function r(U){for(var z=[],J=0,Y=U.units;J<Y.length;J++){var Z=Y[J];z.push({unit:Z,indices:Te.ofBounds(0,Z.elements.length)})}return De(U,z)}e.toStructureElementLoci=r;function n(U,z){return mt.toLociWithSourceUnits(mt.Singletons(U,z))}e.toSubStructureElementLoci=n;function i(U){return!!U&&U.kind==="structure-loci"}e.isLoci=i;function a(U,z){return U.structure===z.structure}e.areLociEqual=a;function o(U){return U.structure.isEmpty}e.isLociEmpty=o;function s(U,z){return z===U.structure?U:t(z)}e.remapLoci=s;function u(U,z){z===void 0&&(z={});for(var J=Ls.Mutable(),Y=Ls.Mutable(),Z=0,te=!0,le=U.length>0?U[0].id:0,ye=0,be=U.length;ye<be;ye++){var Ee=U[ye];J.set(Ee.id,Ee),Z+=Ee.elements.length,Ee.id<le&&(te=!1),le=Ee.id}te||lY(U,0,U.length,wke,np);for(var ye=0,be=U.length;ye<be;ye++)Y.set(U[ye].id,ye);var Se={hashCode:-1,transformHash:-1,elementCount:Z,bondCount:-1,uniqueElementCount:-1,atomicResidueCount:-1,polymerResidueCount:-1,polymerGapCount:-1,polymerUnitCount:-1,coordinateSystem:pn.Default,label:""};return z.parent&&(Se.parent=z.parent.parent||z.parent),z.interUnitBonds&&(Se.interUnitBonds=z.interUnitBonds),z.coordinateSystem?Se.coordinateSystem=z.coordinateSystem:z.parent&&(Se.coordinateSystem=z.parent.coordinateSystem),z.label?Se.label=z.label:z.parent&&(Se.label=z.parent.label),z.masterModel?Se.masterModel=z.masterModel:z.parent&&(Se.masterModel=z.parent.masterModel),z.representativeModel?Se.representativeModel=z.representativeModel:z.parent&&(Se.representativeModel=z.parent.representativeModel),new e(U,J,Y,Se)}e.create=u;function l(U,z){return ce(this,void 0,void 0,function(){var J,Y,Z,te,le,ye,be,Ee,Se,ie,oe,O,V;return de(this,function(pe){switch(pe.label){case 0:if(U.frameCount===0)return[2,e.Empty];J=[],Y=void 0,Z=0,te=0,le=U.frameCount,pe.label=1;case 1:return te<le?[4,We.resolveInContext(U.getFrameAtIndex(te),z)]:[3,4];case 2:for(ye=pe.sent(),Y||(Y=ye),be=c(ye),Ee=0,Se=be.units.length;Ee<Se;++Ee)ie=be.units[Ee],oe=ie.invariantId+Z,O=ie.chainGroupId+Z,V=Ue.create(J.length,oe,O,ie.traits,ie.kind,ie.model,ie.conformation.operator,ie.elements),J.push(V);Z=J.length,pe.label=3;case 3:return++te,[3,1];case 4:return[2,u(J,{representativeModel:Y,label:Y.label})]}})})}e.ofTrajectory=l;function c(U){for(var z=U.atomicHierarchy.chainAtomSegments,J=U.atomicHierarchy.index,Y=U.atomicHierarchy.chains.auth_asym_id,Z=U.atomicChainOperatorMappinng,te=new v({label:U.label}),le=0;le<z.count;le++){var ye=Z.get(le)||pn.Default,be=z.offsets[le];Gp.chainResidueCount(U.atomicHierarchy,le),z.offsets[le+1]-z.offsets[le];var Ee=!1;if(d(U,le))for(;le+1<z.count&&d(U,le+1);){var Se=Z.get(le),ie=Z.get(le+1);if(Se!==ie)break;Ee=!0,le++}else for(;le+1<z.count&&z.offsets[le+1]-z.offsets[le]===1&&z.offsets[le+2]-z.offsets[le+1]===1;){var oe=J.getEntityFromChain(le),O=J.getEntityFromChain(le+1);if(oe!==O)break;var V=Y.value(le),pe=Y.value(le+1);if(V!==pe)break;var Se=Z.get(le),ie=Z.get(le+1);if(Se!==ie)break;Ee=!0,le++}var _e=Je.ofBounds(be,z.offsets[le+1]);te.addUnit(0,U,ye,_e,Ee?1:0)}var Pe=U.coarseHierarchy;return Pe.isDefined&&(Pe.spheres.count>0&&f(te,U,U.coarseHierarchy.spheres,1),Pe.gaussians.count>0&&f(te,U,U.coarseHierarchy.gaussians,2)),te.getStructure()}e.ofModel=c;function d(U,z){var J=U.atomicHierarchy.index.getEntityFromChain(z);return U.entities.data.type.value(J)==="water"}function f(U,z,J,Y){for(var Z=J.chainElementSegments,te=0;te<Z.count;te++){var le=Je.ofBounds(Z.offsets[te],Z.offsets[te+1]);U.addUnit(Y,z,pn.Default,le,0)}}function h(U,z){if(ue.isIdentity(z))return U;if(!ue.isRotationAndTranslation(z,pn.RotationTranslationEpsilon))throw new Error("Only rotation/translation combination can be applied.");for(var J=[],Y=0,Z=U.units;Y<Z.length;Y++){var te=Z[Y],le=te.conformation.operator,ye=pn.create(le.name,z,le);J.push(te.applyOperator(te.id,ye))}var be=U.coordinateSystem,Ee=pn.compose(pn.create(be.name,z,be),be);return u(J,{parent:U,coordinateSystem:Ee})}e.transform=h;var v=function(){function U(z){z===void 0&&(z={}),this.props=z,this.units=[],this.invariantId=Fa(),this.chainGroupId=-1,this.inChainGroup=!1,this.p=_(),this.singleElementUnits=new Map}return U.prototype.beginChainGroup=function(){this.chainGroupId++,this.inChainGroup=!0},U.prototype.endChainGroup=function(){this.inChainGroup=!1},U.prototype.addUnit=function(z,J,Y,Z,te,le){le===void 0&&(le=this.invariantId());var ye=this.inChainGroup?this.chainGroupId:++this.chainGroupId,be=Ue.create(this.units.length,le,ye,te,z,J,Y,Z);return this.add(be)},U.prototype.add=function(z){if(z.elements.length===1){z.conformation.position(z.elements[0],this.p);var J=[z.invariantId,this.p[0],this.p[1],this.p[2]].join("|");if(this.singleElementUnits.has(J))return this.singleElementUnits.get(J);this.singleElementUnits.set(J,z)}return this.units.push(z),z},U.prototype.addWithOperator=function(z,J,Y){return Y===void 0&&(Y=!1),this.add(z.applyOperator(this.units.length,J,Y))},U.prototype.getStructure=function(){return u(this.units,this.props)},Object.defineProperty(U.prototype,"isEmpty",{get:function(){return this.units.length===0},enumerable:!1,configurable:!0}),U}();e.StructureBuilder=v;function p(U){return U===void 0&&(U={}),new v(U)}e.Builder=p;function m(U){return U.hashCode}e.hashCode=m;function g(U){return kk(U.units.map(function(z){return Ue.conformationId(z)}).join("|"))}e.conformationHash=g;function y(U,z){if(U===z)return!0;if(U.elementCount!==z.elementCount)return!1;var J=U.units.length;if(J!==z.units.length)return!1;for(var Y=0;Y<J;Y++)if(U.units[Y].id!==z.units[Y].id)return!1;return!0}e.areUnitIdsEqual=y;function b(U,z){if(!y(U,z))return!1;for(var J=0,Y=U.units.length;J<Y;J++)if(!Je.areEqual(U.units[J].elements,z.units[J].elements))return!1;return!0}e.areUnitIdsAndIndicesEqual=b;function S(U,z){if(U.hashCode!==z.hashCode)return!1;var J=U.models.length;if(J!==z.models.length)return!1;for(var Y=0;Y<J;Y++)if(!Wt.areHierarchiesEqual(U.models[Y],z.models[Y]))return!1;return!0}e.areHierarchiesEqual=S;function x(U,z){return U===z||U.hashCode===z.hashCode&&dl.areTransformGroupsEquivalent(U.unitSymmetryGroups,z.unitSymmetryGroups)}e.areEquivalent=x;function C(U,z){return x(U.root,z.root)}e.areRootsEquivalent=C;function w(U,z){return U.root===z.root}e.areRootsEqual=w;var A=function(){function U(z){this.structure=z,this.unitIndex=0,this.maxIdx=0,this.idx=-1,this.current=Ze.create(z),this.hasNext=z.elementCount>0,this.hasNext&&(this.elements=z.units[0].elements,this.maxIdx=this.elements.length-1,this.current.unit=z.units[0])}return U.prototype.move=function(){return this.advance(),this.current.element=this.elements[this.idx],this.current},U.prototype.advance=function(){if(this.idx<this.maxIdx){this.idx++,this.idx===this.maxIdx&&(this.hasNext=this.unitIndex+1<this.structure.units.length);return}if(this.idx=0,this.unitIndex++,this.unitIndex>=this.structure.units.length){this.hasNext=!1;return}this.current.unit=this.structure.units[this.unitIndex],this.elements=this.current.unit.elements,this.maxIdx=this.elements.length-1,this.maxIdx===0&&(this.hasNext=this.unitIndex+1<this.structure.units.length)},U}();e.ElementLocationIterator=A;var M=_();function D(U,z,J){for(var Y=U.elements,Z=U.conformation,te=Z.position,le=Z.r,ye=M,be=Number.MAX_VALUE,Ee=0,Se=Y.length;Ee<Se;Ee++){var ie=Y[Ee],oe=_.distance(z,te(ie,ye))-J-le(ie);oe<be&&(be=oe)}return be}function k(U,z,J){for(var Y=U.units,Z=Number.MAX_VALUE,te=0,le=Y.length;te<le;te++){var ye=Y[te],be=D(ye,z,J);be<Z&&(Z=be)}return Z}e.minDistanceToPoint=k;var R=_();function L(U,z){if(U.elementCount===0||z.elementCount===0)return 0;for(var J=U.units,Y=Number.MAX_VALUE,Z=0,te=J.length;Z<te;Z++)for(var le=J[Z],ye=le.elements,be=le.conformation,Ee=be.position,Se=be.r,ie=0,oe=ye.length;ie<oe;ie++){var O=ye[ie],V=k(z,Ee(O,R),Se(O));V<Y&&(Y=V)}return Y}e.distance=L;function H(U){return U.elementCount===1?"1 element":U.elementCount+" elements"}e.elementDescription=H;function B(U,z,J){return U.masterModel?z.model===J.model||z.model===U.masterModel||J.model===U.masterModel:z.model===J.model}e.validUnitPair=B;function j(U,z,J){var Y=J.maxRadius,Z=J.validUnit,te=J.validUnitPair;if(U.units.some(function(pe){return Z(pe)}))for(var le=U.lookup3d,ye=_(),be=0,Ee=U.units;be<Ee.length;be++){var Se=Ee[be];if(Z(Se)){var ie=Se.boundary.sphere;_.transformMat4(ye,ie.center,Se.conformation.operator.matrix);for(var oe=le.findUnitIndices(ye[0],ye[1],ye[2],ie.radius+Y),O=0;O<oe.count;O++){var V=U.units[oe.indices[O]];!Z(V)||Se.id>=V.id||!te(Se,V)||(V.elements.length>=Se.elements.length?z(Se,V):z(V,Se))}}}}e.eachUnitPair=j;function Q(U,z){for(var J=z.chain,Y=z.residue,Z=z.atom,te=Ze.create(U),le=0,ye=U.units;le<ye.length;le++){var be=ye[le];if(be.kind===0){te.unit=be;for(var Ee=be.elements,Se=nr.transientSegments(be.model.atomicHierarchy.chainAtomSegments,Ee),ie=nr.transientSegments(be.model.atomicHierarchy.residueAtomSegments,Ee);Se.hasNext;){var oe=Se.move();if(J&&(te.element=Ee[oe.start],J(te)),!(!Y&&!Z))for(ie.setSegment(oe);ie.hasNext;){var O=ie.move();if(Y&&(te.element=Ee[O.start],Y(te)),!!Z)for(var V=O.start,pe=O.end;V<pe;V++)te.element=Ee[V],Z(te)}}}}}e.eachAtomicHierarchyElement=Q,e.DefaultSizeThresholds={smallResidueCount:10,mediumResidueCount:5e3,largeResidueCount:3e4,highSymmetryUnitCount:10,fiberResidueCount:15};function G(U){return U.unitSymmetryGroups.filter(function(z){return z.units[0].polymerElements.length>0})}function W(U,z){var J=G(U);return J.length===1&&J[0].units.length>2&&J[0].units[0].polymerElements.length<z.fiberResidueCount}function q(U,z){var J=G(U);return J.length>=1&&J[0].units.length>z.highSymmetryUnitCount}var ee;(function(U){U[U.Small=0]="Small",U[U.Medium=1]="Medium",U[U.Large=2]="Large",U[U.Huge=3]="Huge",U[U.Gigantic=4]="Gigantic"})(ee=e.Size||(e.Size={}));function he(U,z,J){z===void 0&&(z={}),J===void 0&&(J=1);var Y=E(E({},e.DefaultSizeThresholds),z);return U.polymerResidueCount>=Y.largeResidueCount*J?q(U,Y)?ee.Huge:ee.Gigantic:W(U,Y)||U.polymerResidueCount<Y.smallResidueCount*J?ee.Small:U.polymerResidueCount<Y.mediumResidueCount*J?ee.Medium:ee.Large}e.getSize=he,e.Index=Yf.createSimple("index","root");var $="__PrincipalAxes__";function X(U){if(U.currentPropertyData[$])return U.currentPropertyData[$];var z=De.getPrincipalAxes(e.toStructureElementLoci(U));return U.currentPropertyData[$]=z,z}e.getPrincipalAxes=X})($e||($e={}));var Nke=Oe.size;function De(e,t){return{kind:"element-loci",structure:e,elements:t}}(function(e){function t(z){return!!z&&z.kind==="element-loci"}e.is=t;function r(z,J){if(z.structure!==J.structure||z.elements.length!==J.elements.length)return!1;for(var Y=0,Z=z.elements.length;Y<Z;++Y){var te=z.elements[Y],le=J.elements[Y];if(te.unit.id!==le.unit.id||!Oe.areEqual(te.indices,le.indices))return!1}return!0}e.areEqual=r;function n(z){return a(z)===0}e.isEmpty=n;function i(z){return a(z)===z.structure.elementCount}e.isWholeStructure=i;function a(z){for(var J=0,Y=0,Z=z.elements;Y<Z.length;Y++){var te=Z[Y];J+=Nke(te.indices)}return J}e.size=a;function o(z){return e(z,z.units.map(function(J){return{unit:J,indices:Oe.ofBounds(0,J.elements.length)}}))}e.all=o;function s(z){return e(z,[])}e.none=s;function u(z,J){if(!n(z)){var Y=z.elements[0].unit,Z=Y.elements[Oe.getAt(z.elements[0].indices,0)];return J?(J.structure=z.structure,J.unit=z.elements[0].unit,J.element=Z,J):Ze.create(z.structure,Y,Z)}}e.getFirstLocation=u;function l(z){return n(z)?z:e(z.structure,[{unit:z.elements[0].unit,indices:Oe.ofSingleton(Oe.start(z.elements[0].indices))}])}e.firstElement=l;function c(z){return n(z)?z:b(l(z))}e.firstResidue=c;function d(z){return n(z)?z:M(l(z))}e.firstChain=d;function f(z){for(var J=[],Y=function(ye){var be=ye.unit,Ee=ye.indices,Se=new Int32Array(Oe.size(Ee));Oe.forEach(Ee,function(ie,oe){return Se[oe]=be.elements[ie]}),J.push(be.getChild(Je.ofSortedArray(Se)))},Z=0,te=z.elements;Z<te.length;Z++){var le=te[Z];Y(le)}return $e.create(J,{parent:z.structure.parent})}e.toStructure=f;function h(z,J){if(J===z.structure)return z;var Y=[];return z.elements.forEach(function(Z){if(J.unitMap.has(Z.unit.id)){var te=J.unitMap.get(Z.unit.id),le=Oe.indexedIntersect(Z.indices,Z.unit.elements,te.elements);Oe.size(le)>0&&Y.push({unit:te,indices:le})}}),e(J,Y)}e.remap=h;function v(z,J){if(z.elements.length>J.elements.length)return v(J,z);if(e.isEmpty(z))return J;for(var Y=new Map,Z=0,te=z.elements;Z<te.length;Z++){var le=te[Z];Y.set(le.unit.id,le.indices)}for(var ye=[],be=0,Ee=J.elements;be<Ee.length;be++){var le=Ee[be];Y.has(le.unit.id)?(ye[ye.length]={unit:le.unit,indices:Oe.union(Y.get(le.unit.id),le.indices)},Y.delete(le.unit.id)):ye[ye.length]=le}return Y.forEach(function(Se,ie){ye[ye.length]={unit:z.structure.unitMap.get(ie),indices:Se}}),e(z.structure,ye)}e.union=v;function p(z,J){for(var Y=new Map,Z=0,te=J.elements;Z<te.length;Z++){var le=te[Z];Y.set(le.unit.id,le.indices)}for(var ye=[],be=0,Ee=z.elements;be<Ee.length;be++){var le=Ee[be];if(Y.has(le.unit.id)){var Se=Oe.subtract(le.indices,Y.get(le.unit.id));if(Oe.size(Se)===0)continue;ye[ye.length]={unit:le.unit,indices:Se}}else ye[ye.length]=le}return e(z.structure,ye)}e.subtract=p;function m(z,J){for(var Y=new Map,Z=0,te=z.elements;Z<te.length;Z++){var le=te[Z];Y.set(le.unit.id,le.indices)}for(var ye=[],be=0,Ee=J.elements;be<Ee.length;be++){var le=Ee[be];if(Y.has(le.unit.id)){var Se=Oe.intersect(Y.get(le.unit.id),le.indices);Oe.size(Se)!==0&&(ye[ye.length]={unit:le.unit,indices:Se})}}return e(z.structure,ye)}e.intersect=m;function g(z,J){if(z.elements.length>J.elements.length)return g(J,z);if(e.isEmpty(z))return e.isEmpty(J);for(var Y=new Map,Z=0,te=z.elements;Z<te.length;Z++){var le=te[Z];Y.set(le.unit.id,le.indices)}for(var ye=0,be=J.elements;ye<be.length;ye++){var le=be[ye];if(Y.has(le.unit.id)&&Oe.areIntersecting(Y.get(le.unit.id),le.indices))return!0}return!1}e.areIntersecting=g;function y(z,J){if(e.isEmpty(z))return e.isEmpty(J);for(var Y=new Map,Z=0,te=z.elements;Z<te.length;Z++){var le=te[Z];Y.set(le.unit.id,le.indices)}for(var ye=!1,be=0,Ee=J.elements;be<Ee.length;be++){var le=Ee[be];if(Y.has(le.unit.id))if(Oe.isSubset(Y.get(le.unit.id),le.indices))ye=!0;else return!1}return ye}e.isSubset=y;function b(z,J){for(var Y=[],Z=new Set,te=0,le=z.elements;te<le.length;te++){var ye=le[te];if(x(ye)){Y[Y.length]=ye;continue}if(ye.unit.kind===0){for(var be=ye.unit.elements,Ee=ye.unit.model.atomicHierarchy,Se=ye.unit.model.atomicHierarchy.atoms.label_alt_id,ie=Ee.residueAtomSegments,oe=ie.index,O=ie.offsets,V=[],pe=ye.indices,_e=Oe.size(pe),Pe=0;Pe<_e;){Z.clear();var je=be[Oe.getAt(pe,Pe)],ze=oe[je];for(Z.add(Se.value(je)),Pe++;Pe<_e;){var Xe=be[Oe.getAt(pe,Pe)];if(oe[Xe]!==ze)break;Z.add(Se.value(Xe)),Pe++}for(var ct=Z.has(""),Ne=O[ze],Qe=O[ze+1];Ne<Qe;Ne++){var it=Oe.indexOf(be,Ne);if(it>=0){var ot=Se.value(Ne);(!J||ct||!ot||Z.has(ot))&&(V[V.length]=it)}}}Y[Y.length]={unit:ye.unit,indices:Je.ofSortedArray(V)}}else Y[Y.length]=ye}return e(z.structure,Y)}e.extendToWholeResidues=b;function S(z){switch(z.kind){case 0:return z.model.atomicHierarchy.chainAtomSegments;case 1:return z.model.coarseHierarchy.spheres.chainElementSegments;case 2:return z.model.coarseHierarchy.gaussians.chainElementSegments}}function x(z){return z.unit.elements.length===Oe.size(z.indices)}function C(z){return z.length>12&&z[z.length-1]-z[0]===z.length-1?Te.ofRange(z[0],z[z.length-1]):Je.ofSortedArray(z)}function w(z,J,Y){for(var Z=S(z).index,te=z.elements,le=0,ye=0,be=te.length;ye<be;ye++){var Ee=te[ye],Se=Z[Ee];J.has(Se)&&le++}if(le===z.elements.length){Y[Y.length]={unit:z,indices:Te.ofBounds(0,le)};return}var ie=new Int32Array(le);le=0;for(var ye=0,be=te.length;ye<be;ye++){var Ee=te[ye],Se=Z[Ee];J.has(Se)&&(ie[le++]=ye)}ie.length>0&&(Y[Y.length]={unit:z,indices:C(ie)})}function A(z,J,Y,Z,te){for(var le=S(z.elements[0].unit).index,ye=new Set,be=J;be<Y;be++)for(var Ee=z.elements[be],Se=Ee.indices,ie=Ee.unit.elements,oe=0,O=Oe.size(Se);oe<O;oe++)ye.add(le[ie[Oe.getAt(Se,oe)]]);if(Z)for(var V=z.elements[0].unit,pe=0,_e=z.structure.units;pe<_e.length;pe++){var Pe=_e[pe];Ue.areSameChainOperatorGroup(Pe,V)&&w(Pe,ye,te)}else for(var be=J;be<Y;be++)w(z.elements[be].unit,ye,te)}function M(z){for(var J=[],Y=0,Z=z.elements.length;Y<Z;Y++){var te=z.elements[Y];if(Ue.Traits.is(te.unit.traits,2)){for(var le=Y;Y<Z&&Ue.areSameChainOperatorGroup(z.elements[Y].unit,te.unit);)Y++;var ye=Y;Y--,A(z,le,ye,!0,J)}else x(te)?J[J.length]=te:A(z,Y,Y+1,!1,J)}return e(z.structure,J)}e.extendToWholeChains=M;function D(z){return z.unit.model.id+"|"+lt.entity.id(z)}function k(z){for(var J=[],Y=Ze.create(z.structure),Z=new Set,te=z.structure.units,le=0,ye=z.elements.length;le<ye;le++){var be=z.elements[le];Y.unit=be.unit,Y.element=be.unit.elements[0],Z.add(D(Y))}for(var le=0,Ee=te.length;le<Ee;++le){var Se=te[le];if(Y.unit=Se,Y.element=Se.elements[0],Z.has(D(Y))){var ie=Oe.ofBounds(0,Se.elements.length);J[J.length]={unit:Se,indices:ie}}}return e(z.structure,J)}e.extendToWholeEntities=k;function R(z){for(var J=[],Y=new Set,Z=z.structure.units,te=0,le=z.elements.length;te<le;te++){var ye=z.elements[te];Y.add(ye.unit.model.id)}for(var te=0,be=Z.length;te<be;++te){var Ee=Z[te];if(Y.has(Ee.model.id)){var Se=Oe.ofBounds(0,Ee.elements.length);J[J.length]={unit:Ee,indices:Se}}}return e(z.structure,J)}e.extendToWholeModels=R;function L(z,J){for(var Y=[],Z=0,te=Oe.size(J);Z<te;++Z)Y.push(z[Oe.getAt(J,Z)]);return Je.ofSortedArray(Y)}function H(z,J){return Je.indicesOf(z,J)}function B(z){for(var J=[],Y=new Map,Z=0,te=z.elements.length;Z<te;Z++){var le=z.elements[Z],ye=le.unit.model,be=L(le.unit.elements,le.indices);Y.has(ye)?Y.set(ye,Je.union(be,Y.get(ye))):Y.set(ye,be)}for(var Z=0,Ee=z.structure.units.length;Z<Ee;++Z){var Se=z.structure.units[Z],be=Y.get(Se.model);if(be){var ie=H(Se.elements,be);J[J.length]={unit:Se,indices:ie}}}return e(z.structure,J)}e.extendToAllInstances=B;function j(z){for(var J=[],Y=new Set,Z=z.structure.units,te=0,le=z.elements.length;te<le;te++){var ye=z.elements[te];Y.add(ye.unit.conformation.operator.name)}for(var te=0,be=Z.length;te<be;++te){var Ee=Z[te];if(Y.has(Ee.conformation.operator.name)){var Se=Oe.ofBounds(0,Ee.elements.length);J[J.length]={unit:Ee,indices:Se}}}return e(z.structure,J)}e.extendToWholeOperators=j;var Q=new rs("98"),G=_();function W(z,J){Q.reset();for(var Y=0,Z=z.elements;Y<Z.length;Y++)for(var te=Z[Y],le=te.indices,ye=te.unit.conformation.position,be=te.unit.conformation.r,Ee=te.unit.elements,Se=0,ie=Oe.size(le);Se<ie;Se++){var oe=Ee[Oe.getAt(le,Se)];ye(oe,G),J&&_.transformMat4(G,G,J),Q.includePositionRadius(G,be(oe))}Q.finishedIncludeStep();for(var O=0,V=z.elements;O<V.length;O++)for(var te=V[O],le=te.indices,ye=te.unit.conformation.position,be=te.unit.conformation.r,Ee=te.unit.elements,Se=0,ie=Oe.size(le);Se<ie;Se++){var oe=Ee[Oe.getAt(le,Se)];ye(oe,G),J&&_.transformMat4(G,G,J),Q.radiusPositionRadius(G,be(oe))}return{box:Q.getBox(),sphere:Q.getSphere()}}e.getBoundary=W;var q=_();function ee(z,J,Y){Y===void 0&&(Y=0);for(var Z=Y,te=0,le=z.elements;te<le.length;te++){for(var ye=le[te],be=ye.indices,Ee=ye.unit.conformation.position,Se=ye.unit.elements,ie=Oe.size(be),oe=0;oe<ie;oe++){var O=Se[Oe.getAt(be,oe)];Ee(O,q),_.toArray(q,J,Z+oe*3)}Z+=ie*3}return J}e.toPositionsArray=ee;function he(z){var J=a(z),Y=ee(z,new Float32Array(3*J));return $p.ofPositions(Y)}e.getPrincipalAxes=he;function $(z,J){return Ue.isAtomic(z)?z.model.atomicHierarchy.atomSourceIndex.value(J):J}function X(z){var J;if(e.isEmpty(z))return se.struct.generator.empty();for(var Y=z.structure.models,Z=new Map,te=0,le=z.elements;te<le.length;te++){var ye=le[te],be=ye.indices,Ee=ye.unit.elements,Se=ye.unit.conformation.operator.name,ie=void 0;Z.has(Se)?ie=Z.get(Se).xs:(ie=Zr.create(),Z.set(Se,{modelLabel:ye.unit.model.label,modelIndex:ye.unit.model.modelNum,xs:ie}));for(var oe=0,O=Oe.size(be);oe<O;oe++){var V=$(ye.unit,Ee[Oe.getAt(be,oe)]);Zr.add(ie,V,V)}}for(var pe=[],_e=Z.keys();;){var Pe=_e.next();if(Pe.done)break;var ye=Z.get(Pe.value);pe.push(U(Pe.value,ye.xs.array,Y.length>1,ye.modelLabel,ye.modelIndex))}for(var je=new Map,oe=0,ze=pe.length;oe<ze;++oe){var Xe=pe[oe],ct=cv(La(Xe.atom.ranges),La(Xe.atom.set)),Se=ct+"|"+(Xe.entity?Xe.entity.modelLabel+Xe.entity.modelIndex:"");je.has(Se)?(J=je.get(Se).chain.opName).push.apply(J,Xe.chain.opName):je.set(Se,Xe)}var Ne=[];return je.forEach(function(Qe){var it=Qe.atom,ot=it.ranges,dt=it.set,Re=Qe.chain.opName,Ie=se.struct.atomProperty.core.operatorName(),Ye=se.struct.atomProperty.core.sourceIndex(),tt=[];dt.length>0&&(tt[tt.length]=se.core.set.has([se.core.type.set(dt),Ye]));for(var xt=0,pt=ot.length/2;xt<pt;xt++)tt[tt.length]=se.core.rel.inRange([Ye,ot[2*xt],ot[2*xt+1]]);if(Qe.entity){var ut=Qe.entity,fe=ut.modelLabel,me=ut.modelIndex;Ne.push(se.struct.generator.atomGroups({"atom-test":tt.length>1?se.core.logic.or(tt):tt[0],"chain-test":Re.length>1?se.core.set.has([se.core.type.set(Re),Ie]):se.core.rel.eq([Ie,Re[0]]),"entity-test":se.core.logic.and([se.core.rel.eq([se.struct.atomProperty.core.modelLabel(),fe]),se.core.rel.eq([se.struct.atomProperty.core.modelIndex(),me])])}))}else Ne.push(se.struct.generator.atomGroups({"atom-test":tt.length>1?se.core.logic.or(tt):tt[0],"chain-test":Re.length>1?se.core.set.has([se.core.type.set(Re),Ie]):se.core.rel.eq([Ie,Re[0]])}))}),se.struct.modifier.union([Ne.length===1?Ne[0]:se.struct.combinator.merge(Ne.map(function(Qe){return se.struct.modifier.union([Qe])}))])}e.toExpression=X;function U(z,J,Y,Z,te){gu(J);for(var le=[],ye=[],be=0,Ee=J.length;be<Ee;){var Se=be;for(be++;be<Ee&&J[be-1]+1===J[be];)be++;var ie=be;if(ie-Se>12)le[le.length]=J[Se],le[le.length]=J[ie-1];else for(var oe=Se;oe<ie;oe++)ye[ye.length]=J[oe]}return Y?{atom:{set:ye,ranges:le},chain:{opName:[z]},entity:{modelLabel:Z,modelIndex:te}}:{atom:{set:ye,ranges:le},chain:{opName:[z]}}}})(De||(De={}));var gf;(function(e){function t(){return{elementCount:0,conformationCount:0,residueCount:0,chainCount:0,unitCount:0,structureCount:0,firstElementLoc:Ze.create(void 0),firstConformationLoc:Ze.create(void 0),firstResidueLoc:Ze.create(void 0),firstChainLoc:Ze.create(void 0),firstUnitLoc:Ze.create(void 0),firstStructureLoc:Ze.create(void 0)}}e.create=t;function r(u,l,c){var d=u.get(l)||0;u.set(l,d+c)}function n(u,l,c){var d=c.indices,f=c.unit,h=f.elements,v=Oe.size(d),p=new Map,m=new Map;if(v>0&&Ze.set(u.firstElementLoc,l,f,h[Oe.start(d)]),v===h.length)u.unitCount+=1,u.unitCount===1&&Ze.set(u.firstUnitLoc,l,f,h[Oe.start(d)]);else if(v===1){if(Ue.Traits.is(f.traits,1))return;u.elementCount+=1,u.elementCount===1&&Ze.set(u.firstElementLoc,l,f,h[Oe.start(d)])}else if(Ue.isAtomic(f))for(var g=f.model.atomicHierarchy.residueAtomSegments,y=g.index,b=g.offsets,S=f.model.atomicHierarchy.atoms.label_alt_id,x=0,C=function(){p.clear();var w=0,A=h[Oe.getAt(d,x)],M=y[A];for(r(p,S.value(A),1),++x,++w;x<v;){var D=h[Oe.getAt(d,x)];if(y[D]!==M)break;r(p,S.value(D),1),++x,++w}if(b[M+1]-b[M]===w)u.residueCount+=1,u.residueCount===1&&Ze.set(u.firstResidueLoc,l,f,b[M]);else{m.clear();for(var k=b[M],R=b[M+1];k<R;++k)r(m,S.value(k),1);m.get("")===p.get("")&&p.forEach(function(L,H){if(m.get(H)===L){if(H!==""&&(u.conformationCount+=1,u.conformationCount===1)){for(var B=b[M],j=b[M+1];B<j;++B)if(H===S.value(B)){Ze.set(u.firstConformationLoc,l,f,B);break}}w-=L}}),u.elementCount+=w}};x<v;)C();else u.elementCount+=v,u.elementCount===1&&Ze.set(u.firstElementLoc,l,f,h[Oe.start(d)])}function i(u,l,c){var d=c.indices,f=c.unit,h=Oe.size(d);if(h!==0){var v=f.elements;if(!Ue.Traits.is(f.traits,1)){h===v.length&&(u.chainCount+=1,u.chainCount===1&&Ze.set(u.firstChainLoc,l,f,v[Oe.start(d)]));return}var p=Ue.isAtomic(f)?f.model.atomicHierarchy.chainAtomSegments:Ue.isSpheres(f)?f.model.coarseHierarchy.spheres.chainElementSegments:Ue.isGaussians(f)?f.model.coarseHierarchy.gaussians.chainElementSegments:void 0;if(!p){console.warn("StructureElement loci stats: unknown unit type");return}for(var m=p.index,g=p.offsets,y=0;y<h;){var b=0,S=v[Oe.getAt(d,y)],x=m[S];for(++y,++b;y<h;){var C=v[Oe.getAt(d,y)];if(m[C]!==x)break;++y,++b}g[x+1]-g[x]===b&&(u.chainCount+=1,u.chainCount===1&&Ze.set(u.firstChainLoc,l,f,g[x]))}}}function a(u,l,c,d,f){var h=c[d],v=Ue.isAtomic(h.unit)?h.unit.model.atomicHierarchy.chainAtomSegments:Ue.isSpheres(h.unit)?h.unit.model.coarseHierarchy.spheres.chainElementSegments:Ue.isGaussians(h.unit)?h.unit.model.coarseHierarchy.gaussians.chainElementSegments:void 0;if(!v){console.warn("StructureElement loci stats: unknown unit type");return}for(var p=v.index,m=v.offsets,g=new Map,y=d;y<f;y++){h=c[y];var b=h.indices,S=h.unit,x=Oe.size(b);if(x!==0){var C=S.elements;if(!Ue.Traits.is(S.traits,1)){var w=C[Oe.start(b)];r(g,p[w],C.length);continue}for(var A=0;A<x;){var M=0,w=C[Oe.getAt(b,A)],D=p[w];for(++A,++M;A<x;){var k=C[Oe.getAt(b,A)];if(p[k]!==D)break;++A,++M}r(g,D,M)}}}var R=-1;if(g.forEach(function(L,H){m[H+1]-m[H]===L&&(u.chainCount+=1,u.chainCount===1&&(R=H))}),!(R<0))for(var y=d;y<f;y++){h=c[y];var b=h.indices,S=h.unit,x=Oe.size(b);if(x!==0)for(var C=S.elements,A=0;A<x;){var w=C[Oe.getAt(b,A)],D=p[w];if(D===R){Ze.set(u.firstChainLoc,l,S,w);return}}}}function o(u){var l=t();if(De.isEmpty(u))return l;var c=!1;if(De.isWholeStructure(u)){if(l.structureCount+=1,l.structureCount===1){var d=u.elements[0],f=d.unit,h=d.indices;Ze.set(l.firstStructureLoc,u.structure,f,f.elements[Oe.min(h)])}}else for(var v=0,p=u.elements;v<p.length;v++){var m=p[v];n(l,u.structure,m),Ue.Traits.is(m.unit.traits,2)?c=!0:i(l,u.structure,m)}if(c)for(var g=0,y=u.elements.length;g<y;g++){var m=u.elements[g];if(Ue.Traits.is(m.unit.traits,2)){for(var b=g;g<y&&Ue.areSameChainOperatorGroup(u.elements[g].unit,m.unit);)g++;var S=g;g--,S-b===1?i(l,u.structure,m):a(l,u.structure,u.elements,b,S)}}return l}e.ofLoci=o;function s(u,l,c){return l.elementCount===1&&c.elementCount===0?Ze.copy(u.firstElementLoc,l.firstElementLoc):l.elementCount===0&&c.elementCount===1&&Ze.copy(u.firstElementLoc,c.firstElementLoc),l.conformationCount===1&&c.conformationCount===0?Ze.copy(u.firstConformationLoc,l.firstConformationLoc):l.conformationCount===0&&c.conformationCount===1&&Ze.copy(u.firstConformationLoc,c.firstConformationLoc),l.residueCount===1&&c.residueCount===0?Ze.copy(u.firstResidueLoc,l.firstResidueLoc):l.residueCount===0&&c.residueCount===1&&Ze.copy(u.firstResidueLoc,c.firstResidueLoc),l.chainCount===1&&c.chainCount===0?Ze.copy(u.firstChainLoc,l.firstChainLoc):l.chainCount===0&&c.chainCount===1&&Ze.copy(u.firstChainLoc,c.firstChainLoc),l.unitCount===1&&c.unitCount===0?Ze.copy(u.firstUnitLoc,l.firstUnitLoc):l.unitCount===0&&c.unitCount===1&&Ze.copy(u.firstUnitLoc,c.firstUnitLoc),l.structureCount===1&&c.structureCount===0?Ze.copy(u.firstStructureLoc,l.firstStructureLoc):l.structureCount===0&&c.structureCount===1&&Ze.copy(u.firstStructureLoc,c.firstStructureLoc),u.elementCount=l.elementCount+c.elementCount,u.conformationCount=l.conformationCount+c.conformationCount,u.residueCount=l.residueCount+c.residueCount,u.chainCount=l.chainCount+c.chainCount,u.unitCount=l.unitCount+c.unitCount,u.structureCount=l.structureCount+c.structureCount,u}e.add=s})(gf||(gf={}));function Fke(e){return Ue.isAtomic(e.unit)?e.unit.residueIndex[e.element]:-1}function Bke(e){return Ue.isAtomic(e.unit)?e.unit.chainIndex[e.element]:-1}function Uke(e){return lt.entity.key(e)}Di.Field;Di.Encodings;Di.Field;Di.Category;Di.Category;Di.Category;var x9;(function(e){function t(r){var n=Array.isArray(r)?r:[r];return{structures:n,firstModel:n[0].model,cache:Object.create(null)}}e.create=t})(x9||(x9={}));var S9;(function(e){e.AtomSitePositionsFieldNames=new Set(["id","Cartn_x","Cartn_y","Cartn_z"])})(S9||(S9={}));var jke={molstar_atom_site_operator_mapping:{label_asym_id:ve.Schema.Str(),auth_asym_id:ve.Schema.Str(),operator_name:ve.Schema.Str(),suffix:ve.Schema.Str(),assembly_id:ve.Schema.Str(),assembly_operator_id:ve.Schema.Int(),symmetry_operator_index:ve.Schema.Int(),symmetry_hkl:ve.Schema.Vector(3),ncs_id:ve.Schema.Int()}},C9=function(e,t){return typeof t[e].operator.assembly>"u"?1:0},DP=function(e,t){return t[e].operator.spgrOp===-1?1:0};Di.fields().str("label_asym_id",function(e,t){return t[e].label_asym_id}).str("auth_asym_id",function(e,t){return t[e].auth_asym_id}).str("operator_name",function(e,t){return t[e].operator.name}).str("suffix",function(e,t){return t[e].operator.suffix}).str("assembly_id",function(e,t){var r;return((r=t[e].operator.assembly)===null||r===void 0?void 0:r.id)||""},{valueKind:C9}).int("assembly_operator_id",function(e,t){var r;return((r=t[e].operator.assembly)===null||r===void 0?void 0:r.operId)||0},{valueKind:C9}).int("symmetry_operator_index",function(e,t){return t[e].operator.spgrOp},{valueKind:DP}).vec("symmetry_hkl",[function(e,t){return t[e].operator.hkl[0]},function(e,t){return t[e].operator.hkl[1]},function(e,t){return t[e].operator.hkl[2]}],{valueKind:DP}).int("ncs_id",function(e,t){return t[e].operator.ncsId},{valueKind:DP}).getFields();function zke(e){if(e._rowCount===0)return{residues:[],chains:[]};for(var t=0,r=e._rowCount,n=[t],i=[t],a=e.label_entity_id,o=e.label_asym_id,s=e.label_seq_id,u=e.auth_seq_id,l=e.pdbx_PDB_ins_code,c=t+1;c<r;c++){var d=!a.areValuesEqual(c-1,c)||!o.areValuesEqual(c-1,c),f=d||!s.areValuesEqual(c-1,c)||!u.areValuesEqual(c-1,c)||!l.areValuesEqual(c-1,c);f&&(n[n.length]=c),d&&(i[i.length]=c)}return{residues:n,chains:i}}function X2(e,t,r){e[t].isDefined||(e[t]=e[r]),e[r].isDefined||(e[r]=e[t])}function Vke(e,t,r){var n=Xr.ofColumns(qTe,{type_symbol:ve.ofArray({array:ve.mapToArray(e.type_symbol,Yg),schema:ve.Schema.Aliased(ve.Schema.str)}),label_atom_id:e.label_atom_id,auth_atom_id:e.auth_atom_id,label_alt_id:e.label_alt_id,label_comp_id:e.label_comp_id,auth_comp_id:e.auth_comp_id,pdbx_formal_charge:e.pdbx_formal_charge}),i=Xr.view(e,WTe,r.residues),a=Xr.view(e,$Te,r.chains);if(!i.label_seq_id.isDefined){for(var o=new Int32Array(i.label_seq_id.rowCount),s=r.residues,u=r.chains,l=0,c=0,d=0,f=o.length;d<f;++d)s[d]>=u[l+1]&&(l+=1,c=0),o[d]=++c;i.label_seq_id=ve.ofIntArray(o)}return Xr.columnToArray(i,"label_seq_id",Int32Array),Xr.columnToArray(i,"auth_seq_id",Int32Array),X2(n,"label_atom_id","auth_atom_id"),X2(n,"label_comp_id","auth_comp_id"),X2(i,"label_seq_id","auth_seq_id"),X2(a,"label_asym_id","auth_asym_id"),{atoms:n,residues:i,chains:a,atomSourceIndex:t}}function Hke(e){return{id:dn.create22(),atomId:e.id,occupancy:e.occupancy,B_iso_or_equiv:e.B_iso_or_equiv,xyzDefined:e.Cartn_x.isDefined&&e.Cartn_y.isDefined&&e.Cartn_z.isDefined,x:e.Cartn_x.toArray({array:Float32Array}),y:e.Cartn_y.toArray({array:Float32Array}),z:e.Cartn_z.toArray({array:Float32Array})}}function Gke(e,t){return Xr.areEqual(e.chains,t.chains)&&Xr.areEqual(e.residues,t.residues)&&Xr.areEqual(e.atoms,t.atoms)}function qke(e,t){var r=new Map;if(!tn.is(t))return r;var n=Zl(jke,t.data.frame).molstar_atom_site_operator_mapping;if(n._rowCount===0)return r;for(var i=new Map,a=new Map,o=0;o<n._rowCount;o++){var s=n.assembly_operator_id.valueKind(o)===0?{id:n.assembly_id.value(o),operList:[],operId:n.assembly_operator_id.value(o)}:void 0,u=pn.create(n.operator_name.value(o),ue.identity(),{assembly:s,spgrOp:n.symmetry_operator_index.valueKind(o)===0?n.symmetry_operator_index.value(o):void 0,hkl:_.ofArray(n.symmetry_hkl.value(o)),ncsId:n.ncs_id.value(o)}),l=n.suffix.value(o),c=n.label_asym_id.value(o);i.set(""+c+l,{name:c,operator:u});var d=n.auth_asym_id.value(o);a.set(""+d+l,d)}for(var f=e.chains,h=f.label_asym_id,v=f.auth_asym_id,p=new Array(h.rowCount),m=new Array(h.rowCount),o=0;o<h.rowCount;o++){var c=h.value(o),d=v.value(o);if(!i.has(c)){p[o]=c,m[o]=d;continue}var g=i.get(c),y=g.name,u=g.operator;r.set(o,u),p[o]=y,m[o]=a.get(d)||d}return e.chains.label_asym_id=ve.ofArray({array:p,valueKind:e.chains.label_asym_id.valueKind,schema:e.chains.label_asym_id.schema}),e.chains.auth_asym_id=ve.ofArray({array:m,valueKind:e.chains.auth_asym_id.valueKind,schema:e.chains.auth_asym_id.schema}),r}function Wke(e,t,r,n,i,a){var o=zke(e),s=Vke(e,t,o),u=qke(s,i);if(a&&Gke(a.atomicHierarchy,s))return{sameAsPrevious:!0,hierarchy:a.atomicHierarchy,chainOperatorMapping:u};var l={residueAtomSegments:nr.ofOffsets(o.residues,Te.ofBounds(0,e._rowCount)),chainAtomSegments:nr.ofOffsets(o.chains,Te.ofBounds(0,e._rowCount))},c=a4e(s,r,l),d=I4e(s,l,c,n),f=E(E(E({},s),l),{index:c,derived:d});return{sameAsPrevious:!1,hierarchy:f,chainOperatorMapping:u}}function hQ(e,t,r,n,i,a){var o=Wke(e,t,r,n,i,a),s=o.sameAsPrevious,u=o.hierarchy,l=o.chainOperatorMapping,c=Hke(e);return{sameAsPrevious:s,hierarchy:u,conformation:c,chainOperatorMapping:l}}var a5;(function(e){e.Empty={isDefined:!1}})(a5||(a5={}));function $ke(e,t,r){if(e.has(t))return e.get(t);var n=r.index++;return e.set(t,n),n}function Xke(e,t){if(e.has(t))return e.get(t);var r=new Map;return e.set(t,r),r}function Yke(e,t,r){var n=e.getEntityIndex,i=function(o,s){var u=n(o);if(u<0)return-1;var l=t.get(u);return l.has(s)?l.get(s):-1},a=function(o,s,u){var l=n(o);if(l<0)return-1;var c=t.get(l);if(c===void 0)return-1;var d=c.get(s);if(d===void 0)return-1;var f=r.get(d),h=f.elementIndices,v=f.seqRanges,p=Qr.firstIntersectionIndex(v,Oe.ofSingleton(u));return p!==-1?h[p]:-1};return{findChainKey:i,findSequenceKey:a}}function Kke(e){throw new Error("Missing entity entry for entity id '"+e+"'.")}function _9(e,t){for(var r=e.entity_id,n=e.asym_id,i=e.seq_id_begin,a=e.seq_id_end,o=e.count,s=e.chainElementSegments,u=new Map,l=new Map,c={index:0},d=new Int32Array(o),f=new Int32Array(o),h=new Int32Array(s.count),v=0;v<o;v++)f[v]=t.getEntityIndex(r.value(v)),f[v]<0&&Kke(r.value(v));for(var p=0;p<s.count;p++){var m=s.offsets[p],g=s.offsets[p+1],y=f[m];h[p]=y;for(var b=Xke(l,y),S=$ke(b,n.value(m),c),v=m;v<g;v++)d[v]=S;for(var x=[],C=[],v=m;v<g;v++){var w=i.value(v),A=a.value(v);x.push(v),C.push(w,A)}var M={elementIndices:x,seqRanges:Qr.ofSortedRanges(C)};u.set(S,M)}var D=Yke(t,l,u),k=D.findChainKey,R=D.findSequenceKey,L=function(H){return h[H]};return{chainKey:d,entityKey:f,findSequenceKey:R,findChainKey:k,getEntityFromChain:L}}function w9(e,t){for(var r=[],n=[],i=nr.transientSegments(e.chainElementSegments,Te.ofBounds(0,e.count)),a=e.seq_id_begin,o=e.seq_id_end;i.hasNext;)for(var s=i.move(),u=s.start,l=s.end,c=-1,d=-1,f=u;f<l;++f){var h=o.value(f);f===u?(c=f,d=o.value(f)):a.value(f)-d>1&&(r.push(c,f-1),n.push(f-1,f),c=f),f===l-1&&r.push(c,f),d=h}return{polymerRanges:Qr.ofSortedRanges(r),gapRanges:Qr.ofSortedRanges(n)}}vr.atom_site.label_comp_id,vr.atom_site.label_seq_id,vr.atom_site.pdbx_PDB_ins_code,vr.atom_site.label_asym_id,vr.atom_site.label_entity_id,vr.atom_site.auth_atom_id,vr.atom_site.auth_seq_id,vr.atom_site.auth_asym_id;E(E({},vr.chem_comp_bond),{molstar_protonation_variant:ve.Schema.Str()});var Qke=E(E({},vr.chem_comp),{type:ve.Schema.Aliased(ve.Schema.str)}),Wa={entry:vr.entry,struct:vr.struct,struct_asym:vr.struct_asym,ihm_model_list:vr.ihm_model_list,ihm_model_group:vr.ihm_model_group,ihm_model_group_link:vr.ihm_model_group_link,entity:vr.entity,entity_poly:vr.entity_poly,entity_poly_seq:vr.entity_poly_seq,pdbx_entity_branch:vr.pdbx_entity_branch,chem_comp:Qke,pdbx_chem_comp_identifier:vr.pdbx_chem_comp_identifier,atom_site:vr.atom_site,ihm_sphere_obj_site:vr.ihm_sphere_obj_site,ihm_gaussian_obj_site:vr.ihm_gaussian_obj_site,pdbx_unobs_or_zero_occ_residues:vr.pdbx_unobs_or_zero_occ_residues,pdbx_molecule:vr.pdbx_molecule};function vv(e){for(var t=Object.create(null),r=0,n=Object.keys(Wa);r<n.length;r++){var i=n[r];i in e?t[i]=e[i]:t[i]=Xr.ofUndefinedColumns(Wa[i],0)}return t}var pQ={hierarchy:a5.Empty,conformation:void 0};function Zke(e,t){var r=e.ihm_sphere_obj_site,n=e.ihm_gaussian_obj_site;if(r._rowCount===0&&n._rowCount===0)return pQ;var i=E9(r),a=Jke(r),o=_9(i,e.entities),s=w9(i,t.chemicalComponentMap),u=E9(n),l=eOe(n),c=_9(u,e.entities),d=w9(u,t.chemicalComponentMap);return{hierarchy:{isDefined:!0,spheres:E(E(E({},i),o),s),gaussians:E(E(E({},u),c),d)},conformation:{id:dn.create22(),spheres:a,gaussians:l}}}function Jke(e){return{x:e.Cartn_x.toArray({array:Float32Array}),y:e.Cartn_y.toArray({array:Float32Array}),z:e.Cartn_z.toArray({array:Float32Array}),radius:e.object_radius.toArray({array:Float32Array}),rmsf:e.rmsf.toArray({array:Float32Array})}}function eOe(e){for(var t=Wa.ihm_gaussian_obj_site.covariance_matrix.space,r=[],n=e.covariance_matrix,i=0,a=n.rowCount;i<a;i++)r[i]=Pr.toMat3(zn(),t,n.value(i));return{x:e.mean_Cartn_x.toArray({array:Float32Array}),y:e.mean_Cartn_y.toArray({array:Float32Array}),z:e.mean_Cartn_z.toArray({array:Float32Array}),weight:e.weight.toArray({array:Float32Array}),covariance_matrix:r}}function tOe(e,t,r){for(var n=[0],i=1,a=e.rowCount;i<a;i++){var o=!e.areValuesEqual(i-1,i);o&&(n[n.length]=i)}return{chainElementSegments:nr.ofOffsets(n,Te.ofBounds(0,e.rowCount))}}function E9(e){var t=e.entity_id,r=e.seq_id_begin,n=e.seq_id_end,i=e.asym_id;return E({count:t.rowCount,entity_id:t,asym_id:i,seq_id_begin:r,seq_id_end:n},tOe(i))}var rOe={HIS:"H",ARG:"R",LYS:"K",ILE:"I",PHE:"F",LEU:"L",TRP:"W",ALA:"A",MET:"M",PRO:"P",CYS:"C",ASN:"N",VAL:"V",GLY:"G",SER:"S",GLN:"Q",TYR:"Y",ASP:"D",GLU:"E",THR:"T",SEC:"U",PYL:"O",HSD:"H",HSE:"H",HSP:"H",LSN:"K",ASPP:"D",GLUP:"E",HID:"H",HIE:"H",HIP:"H",LYN:"K",ASH:"D",GLH:"E"},nOe={DA:"A",DC:"C",DG:"G",DT:"T",DU:"U"},iOe={A:"A",C:"C",G:"G",T:"T",U:"U"};function A9(e){var t=rOe[e];return t||"X"}function P9(e){var t=iOe[e];return t||"X"}function T9(e){var t=nOe[e];return t||"X"}var eb;(function(e){function t(u){var l=u.code.toArray();return(l instanceof Array?l:Array.from(l)).join("")}e.getSequenceString=t;function r(u){for(var l=0,c=Math.min(u.rowCount,10);l<c;l++){var d=u.value(l)||"";if(A9(d)!=="X")return"protein";if(P9(d)!=="X")return"RNA";if(T9(d)!=="X")return"DNA"}return"generic"}function n(u,l){var c;switch(u){case"protein":c=A9;break;case"DNA":c=T9;break;case"RNA":c=P9;break;case"generic":c=function(){return"X"};break;default:throw new Error("unknown kind '"+u+"'")}return l&&l.size>0?function(d){var f=c(d);return f!=="X"||!l.has(d)?f:c(l.get(d))}:c}function i(u,l){if(l.rowCount===0)throw new Error("cannot be empty");var c=r(u);return new a(c,u,l)}e.ofResidueNames=i;var a=function(){function u(l,c,d){this.kind=l,this.microHet=new Map;for(var f=n(l),h=[],v=[],p=[],m=new Map,g=0,y=new Map,b=0,S=d.rowCount;b<S;++b){var x=d.value(b);if(y.has(x))m.has(x)?m.get(x).push(c.value(b)):m.set(x,[v[y.get(x)],c.value(b)]);else{y.set(x,g);var C=c.value(b);v[g]=C,p[g]=x,h[g]=f(C),g+=1}}for(var w=[],b=0,S=g;b<S;++b){var A=m.get(p[b]);if(A){var M=A.map(function(R){var L=f(R);return L==="X"?R:L});w[b]="("+M.join("|")+")"}else w[b]=h[b]==="X"?v[b]:h[b]}this.length=g,this.code=ve.ofStringArray(h),this.compId=ve.ofStringArray(v),this.seqId=ve.ofIntArray(p),this.label=ve.ofStringArray(w),this.microHet=m,this.indexMap=y}return u.prototype.index=function(l){return this.indexMap.get(l)},u}();function o(u,l){var c="generic";return new s(c,u,l)}e.ofSequenceRanges=o;var s=function(){function u(l,c,d){this.kind=l,this.seqIdStart=c,this.seqIdEnd=d,this.microHet=new Map;for(var f=0,h=Number.MAX_SAFE_INTEGER,v=0,p=this.seqIdStart.rowCount;v<p;v++){var m=this.seqIdStart.value(v),g=this.seqIdEnd.value(v);m<h&&(h=m),f<g&&(f=g)}var y=f-h+1;this.code=ve.ofConst("X",y,ve.Schema.str),this.label=ve.ofConst("",y,ve.Schema.str),this.seqId=ve.ofLambda({value:function(b){return b+h+1},rowCount:y,schema:ve.Schema.int}),this.compId=ve.ofConst("",y,ve.Schema.str),this.length=y,this.minSeqId=h}return u.prototype.index=function(l){return l-this.minSeqId},u}()})(eb||(eb={}));var o5;(function(e){var t={byEntityKey:{},sequences:[]};function r(){for(var s=[],u=0;u<arguments.length;u++)s[u]=arguments[u];for(var l=[],c={},d=0,f=s.length;d<f;++d)l.push.apply(l,s[d].sequences),Object.assign(c,s[d].byEntityKey);return{sequences:l,byEntityKey:c}}function n(s,u,l){var c=i(s,u),d=l.isDefined?a(s,l):t;return r(c,d)}e.fromHierarchy=n;function i(s,u){var l=u.atoms.label_comp_id,c=u.residues.label_seq_id,d=u.chainAtomSegments,f=u.residueAtomSegments,h=d.count,v=d.offsets,p={},m=[];if(h===1&&v[0]===0&&v[1]===0)return{byEntityKey:p,sequences:m};for(var g=0,y=u.chains._rowCount;g<y;g++){var b=u.index.getEntityFromChain(g);if(!(p[b]!==void 0||s.data.type.value(b)!=="polymer")){var S=g;for(g++;g<y&&b===u.index.getEntityFromChain(g)&&s.data.type.value(b)!=="polymer";)g++;g--;for(var x=f.index[v[S]],C=f.index[v[g+1]-1]+1,w=ve.window(c,x,C),A=[],M=x;M<C;++M)A.push(l.value(f.offsets[M]));var D=ve.ofStringArray(A);p[b]={entityId:s.data.id.value(b),sequence:eb.ofResidueNames(D,w)},m.push(p[b])}}return{byEntityKey:p,sequences:m}}e.fromAtomicHierarchy=i;function a(s,u){var l=o(s,u.spheres),c=o(s,u.gaussians);return r(l,c)}e.fromCoarseHierarchy=a;function o(s,u){var l=u.chainElementSegments,c=u.seq_id_begin,d=u.seq_id_end,f=l.count,h=l.offsets,v={},p=[];if(f===1&&h[0]===0&&h[1]===0)return{byEntityKey:v,sequences:p};for(var m=0,g=f;m<g;m++){var y=u.getEntityFromChain(m);if(v[y]===void 0){var b=m;for(m++;m<g&&y===u.getEntityFromChain(m);)m++;m--;var S=h[b],x=h[m+1]-1,C=ve.window(c,S,x),w=ve.window(d,S,x);v[y]={entityId:s.data.id.value(y),sequence:eb.ofSequenceRanges(C,w)},p.push(v[y])}}return{byEntityKey:v,sequences:p}}e.fromCoarseElements=o})(o5||(o5={}));function vQ(e,t,r,n){if(!e.entity_poly_seq||!e.entity_poly_seq._rowCount)return o5.fromHierarchy(t,r,n);for(var i=e.entity_poly_seq,a=i.entity_id,o=i.num,s=i.mon_id,u={},l=[],c=a.rowCount,d=0;d<c;){for(var f=d;d<c-1&&a.areValuesEqual(d,d+1);)d++;d++;var h=a.value(f),v=ve.window(s,f,d),p=ve.window(o,f,d),m=t.getEntityIndex(h);u[m]={entityId:h,sequence:eb.ofResidueNames(v,p)},l.push(u[m])}return{byEntityKey:u,sequences:l}}function mQ(e,t,r,n){return ce(this,void 0,void 0,function(){var i,a,o,s,u,l,c,d,f,h,v;return de(this,function(p){switch(p.label){case 0:return i=hM(r,n-1),a=t.label_entity_id,o=t.label_asym_id,s=t.label_seq_id,u=aP(i,a.value),e.shouldUpdate?[4,e.update()]:[3,2];case 1:p.sent(),p.label=2;case 2:l=0,c=u.length-1,p.label=3;case 3:if(!(l<c))return[3,10];d=aP(i,o.value,{start:u[l],end:u[l+1]}),f=0,h=d.length-1,p.label=4;case 4:return f<h?(v=d[f],s.valueKind(v)!==0?[3,6]:(aP(i,s.value,{sort:!0,start:v,end:d[f+1]}),e.shouldUpdate?[4,e.update()]:[3,6])):[3,7];case 5:p.sent(),p.label=6;case 6:return f++,[3,4];case 7:return e.shouldUpdate?[4,e.update()]:[3,9];case 8:p.sent(),p.label=9;case 9:return l++,[3,3];case 10:return tPe(i)&&i.length===t._rowCount?[2,{atom_site:t,sourceIndex:ve.ofIntArray(i)}]:[2,{atom_site:Xr.view(t,t._schema,i),sourceIndex:ve.ofIntArray(i)}]}})})}function I9(e,t,r,n,i){var a=i.residue,o=a.polymerType,s=a.traceElementIndex,u=a.directionFromElementIndex,l=a.directionToElementIndex,c=o[e],d=o[t];if(c===0||d===0||s[e]===-1||s[t]===-1)return!1;var f=n.findAtomsOnResidue(e,mf(c,"backboneStart")),h=n.findAtomsOnResidue(t,mf(d,"backboneEnd"));(f===-1||h===-1)&&(f=n.findAtomsOnResidue(e,mf(c,"coarseBackbone")),h=n.findAtomsOnResidue(t,mf(d,"coarseBackbone")));var v=r.x,p=r.y,m=r.z,g=_.create(v[f],p[f],m[f]),y=_.create(v[h],p[h],m[h]),b=u[e]===-1||l[e]===-1||u[t]===-1||l[t]===-1;return _.distance(g,y)<(b?10:3)}function gQ(e,t,r,n){for(var i=[],a=[],o=new Map,s=nr.transientSegments(e.chainAtomSegments,Te.ofBounds(0,e.atoms._rowCount)),u=nr.transientSegments(e.residueAtomSegments,Te.ofBounds(0,e.atoms._rowCount)),l=e.index,c=e.derived,d=e.residues.label_seq_id,f=e.chains.label_entity_id,h=c.residue,v=h.moleculeType,p=h.traceElementIndex,m,g,y,b;s.hasNext;){var S=s.move();u.setSegment(S),m=-1,g=-1,y=-1,b=-1;var x=t.getEntityIndex(f.value(S.index)),C=n.byEntityKey[x],w=C?C.sequence.seqId.value(C.sequence.seqId.rowCount-1):-1,A=e.residueAtomSegments.index[S.start],M=e.residueAtomSegments.index[S.end-1],D=d.value(A),k=d.value(M);for(D===1&&k===w&&r.xyzDefined&&I9(A,M,r,l,c)&&(o.set(A,M),o.set(M,A));u.hasNext;){var R=u.move(),L=R.index,H=d.value(L);if(cO(v[L])&&p[L]!==-1)if(b!==-1)if(H!==m+1)i.push(b,y-1),a.push(g,R.end-1),b=R.start;else if(!u.hasNext)i.push(b,R.end-1);else{var B=e.residueAtomSegments.index[R.start],j=e.residueAtomSegments.index[y-1];r.xyzDefined&&!I9(B,j,r,e.index,c)&&(i.push(b,y-1),a.push(g,R.end-1),b=R.start)}else b=R.start;else b!==-1&&(i.push(b,y-1),b=-1);g=R.start,y=R.end,m=H}}return{polymerRanges:Qr.ofSortedRanges(i),gapRanges:Qr.ofSortedRanges(a),cyclicPolymerMap:o}}function Kf(e){var t=void 0,r=void 0;return function(){for(var n=[],i=0;i<arguments.length;i++)n[i]=arguments[i];if(!t||t.length!==n.length)return t=n,r=e.apply(void 0,n),r;for(var a=0,o=n.length;a<o;a++)if(n[a]!==t[a])return t=n,r=e.apply(void 0,n),r;return r}}function O3(e){var t=new Map;return function(r){if(t.has(r))return t.get(r);var n=e(r);return t.set(r,n),n}}function aOe(e){for(var t=new Map,r=function(s,u,l){return s+"|"+u+"|"+l},n=e.pdbx_unobs_or_zero_occ_residues,i=0,a=n._rowCount;i<a;++i){var o=r(n.PDB_model_num.value(i),n.label_asym_id.value(i),n.label_seq_id.value(i));t.set(o,{polymer_flag:n.polymer_flag.value(i),occupancy_flag:n.occupancy_flag.value(i)})}return{has:function(s,u,l){return t.has(r(s,u,l))},get:function(s,u,l){return t.get(r(s,u,l))},size:t.size}}function oOe(e){var t=new Map;if(e.chem_comp._rowCount>0)for(var r=e.chem_comp.id,n=0,i=r.rowCount;n<i;++n)t.set(r.value(n),Xr.getRow(e.chem_comp,n));else{var a=yQ(e);a.forEach(function(o){t.set(o,w4e(o))})}return t}function sOe(e){var t=new Map;if(e.pdbx_chem_comp_identifier._rowCount>0){for(var r=e.pdbx_chem_comp_identifier,n=r.comp_id,i=r.type,a=r.identifier,o=0,s=n.rowCount;o<s;++o)if(i.value(o)==="SNFG CARBOHYDRATE SYMBOL"||i.value(o)==="SNFG CARB SYMBOL"){var u=a.value(o),l=u4e.get(u);l?t.set(n.value(o),l):console.warn("Unknown SNFG name '"+u+"'")}}if(e.chem_comp._rowCount>0)for(var c=e.chem_comp,d=c.id,i=c.type,o=0,s=d.rowCount;o<s;++o){var f=d.value(o);if(!t.has(f)){var h=i.value(o);bp.has(f)?t.set(f,bp.get(f)):Kg(h,f)===9&&t.set(f,pK)}}else{var v=yQ(e);bp.forEach(function(p,m){!t.has(m)&&v.has(m)&&t.set(m,p)})}return t}var yQ=O3(function(e){for(var t=new Set,r=e.atom_site,n=r.label_comp_id,i=r.auth_comp_id,a=n.isDefined?n:i,o=0,s=a.rowCount;o<s;++o)t.add(a.value(o));return t});function uOe(e){for(var t=new Map,r=e.atom_site,n=r.label_asym_id,i=r.auth_asym_id,a=r.label_entity_id,o=0,s=n.rowCount;o<s;++o){var u=n.value(o);t.has(u)||t.set(u,{id:u,auth_id:i.value(o),entity_id:a.value(o)})}if(e.struct_asym._rowCount>0)for(var l=e.struct_asym,u=l.id,c=l.entity_id,o=0,s=u.rowCount;o<s;++o){var d=u.value(o);t.has(d)||t.set(d,{id:d,auth_id:"",entity_id:c.value(o)})}return t}function lOe(e){return{missingResidues:aOe(e),chemicalComponentMap:oOe(e),saccharideComponentMap:sOe(e),structAsymMap:uOe(e)}}var cOe=ve.Schema.Aliased(ve.Schema.Str(""));function bQ(e,t){var r,n;if(e.entity.id.isDefined)n=e.entity;else{for(var i=new Set,a=[],o=[],s=e.atom_site,u=s.label_entity_id,l=s.label_comp_id,c=0,d=e.atom_site._rowCount;c<d;c++){var f=u.value(c);i.has(f)||(a.push(f),o.push(E4e(l.value(c))),i.add(f))}for(var h=e.ihm_sphere_obj_site.entity_id,c=0,d=e.ihm_sphere_obj_site._rowCount;c<d;c++){var f=h.value(c);i.has(f)||(a.push(f),o.push("polymer"),i.add(f))}for(var v=e.ihm_gaussian_obj_site.entity_id,c=0,d=e.ihm_gaussian_obj_site._rowCount;c<d;c++){var f=v.value(c);i.has(f)||(a.push(f),o.push("polymer"),i.add(f))}n=Xr.ofPartialColumns(Wa.entity,{id:ve.ofArray({array:a,schema:Wa.entity.id}),type:ve.ofArray({array:o,schema:Wa.entity.type})},a.length)}var p=ve.createIndexer(n.id),m=new Array(n._rowCount);m.fill("other");var g=new Set,y=!1;if(e.entity_poly&&e.entity_poly.type.isDefined)for(var b=e.entity_poly,S=b.entity_id,x=b.type,C=b._rowCount,c=0;c<C;++c){var f=S.value(c);m[p(f)]=x.value(c),g.add(f)}else y=!0;if(e.pdbx_entity_branch&&e.pdbx_entity_branch.entity_id.isDefined)for(var w=e.pdbx_entity_branch,S=w.entity_id,x=w.type,C=w._rowCount,c=0;c<C;++c){var f=S.value(c);m[p(f)]=x.value(c),g.add(f)}else y=!0;if(g.size<m.length&&(y=!0),y){var A=new Map;if(e.chem_comp)for(var M=e.chem_comp,D=M.id,x=M.type,c=0,d=e.chem_comp._rowCount;c<d;c++)A.set(D.value(c),x.value(c));if(e.atom_site)for(var k=e.atom_site,u=k.label_entity_id,l=k.label_comp_id,c=0,d=e.atom_site._rowCount;c<d;c++){var f=u.value(c);if(!g.has(f)){var R=l.value(c),L=A.get(R)||"";m[p(f)]=A4e(R,L),g.add(f)}}}var H=ve.ofArray({array:m,schema:cOe}),B=new Array(n._rowCount);if(B.fill(""),e.pdbx_molecule&&e.pdbx_molecule.prd_id.isDefined)for(var j=e.pdbx_molecule,Q=j.asym_id,G=j.prd_id,C=j._rowCount,c=0;c<C;++c){var W=Q.value(c),f=(r=t.structAsymMap.get(W))===null||r===void 0?void 0:r.entity_id;f!==void 0&&(B[p(f)]=G.value(c))}var q=ve.ofArray({array:B,schema:ve.Schema.str});return{data:n,subtype:H,prd_id:q,getEntityIndex:p}}function dOe(e,t){var r=t.ihm_model_group,n=t.ihm_model_group_link,i=Xr.pickRow(n,function(o){return n.model_id.value(o)===e});if(i){var a=Xr.pickRow(r,function(o){return r.id.value(o)===i.group_id});if(a)return a.name}return""}var Xp=function(){function e(t){this.frames=t,this.frameCount=t.length,this.representative=t[0],this.duration=t.length}return e.prototype.getFrameAtIndex=function(t){return this.frames[t]},e}();function rd(e,t,r){return ce(this,void 0,void 0,function(){var n,i,a,o;return de(this,function(s){switch(s.label){case 0:return n=lOe(e),e.ihm_model_list._rowCount>0?[4,vOe(r,e,n,t)]:[3,2];case 1:return a=s.sent(),[3,4];case 2:return[4,pOe(r,e,n,t)];case 3:a=s.sent(),s.label=4;case 4:for(i=a,o=0;o<i.length;o++)Wt.TrajectoryInfo.set(i[o],{index:o,size:i.length});return[2,new Xp(i)]}})})}function fOe(e,t,r,n,i,a,o){var s=hQ(t,r,n,i.chemicalComponentMap,a,o),u=t.pdbx_PDB_model_num.value(0);if(o&&s.sameAsPrevious)return E(E({},o),{id:dn.create22(),modelNum:u,atomicConformation:s.conformation,_dynamicPropertyData:Object.create(null)});var l=pQ,c=vQ(e,n,s.hierarchy,l.hierarchy),d=gQ(s.hierarchy,n,s.conformation,c),f=e.entry.id.valueKind(0)===0?e.entry.id.value(0):a.name,h=[];return f&&h.push(f),e.struct.title.valueKind(0)===0&&h.push(e.struct.title.value(0)),{id:dn.create22(),entryId:f,label:h.join(" | "),entry:f,sourceData:a,modelNum:u,parent:void 0,entities:n,sequence:c,atomicHierarchy:s.hierarchy,atomicConformation:s.conformation,atomicRanges:d,atomicChainOperatorMappinng:s.chainOperatorMapping,coarseHierarchy:l.hierarchy,coarseConformation:l.conformation,properties:i,customProperties:new Tl,_staticPropertyData:Object.create(null),_dynamicPropertyData:Object.create(null)}}function hOe(e,t,r,n){var i=hQ(t.atom_site,t.atom_site_sourceIndex,t.entities,r.chemicalComponentMap,n),a=Zke(t,r),o=vQ(e,t.entities,i.hierarchy,a.hierarchy),s=gQ(i.hierarchy,t.entities,i.conformation,o),u=e.entry.id.valueKind(0)===0?e.entry.id.value(0):n.name,l=[];return u&&l.push(u),e.struct.title.valueKind(0)===0&&l.push(e.struct.title.value(0)),t.model_name&&l.push(t.model_name),t.model_group_name&&l.push(t.model_group_name),{id:dn.create22(),entryId:u,label:l.join(" | "),entry:u,sourceData:n,modelNum:t.model_id,parent:void 0,entities:t.entities,sequence:o,atomicHierarchy:i.hierarchy,atomicConformation:i.conformation,atomicRanges:s,atomicChainOperatorMappinng:i.chainOperatorMapping,coarseHierarchy:a.hierarchy,coarseConformation:a.conformation,properties:r,customProperties:new Tl,_staticPropertyData:Object.create(null),_dynamicPropertyData:Object.create(null)}}function xQ(e,t){var r=e.rowCount;if(!e.isDefined)return r;for(var n=t+1;n<r&&e.areValuesEqual(t,n);)n++;return n}function pOe(e,t,r,n){return ce(this,void 0,void 0,function(){var i,a,o,s,u,l,c,d,f;return de(this,function(h){switch(h.label){case 0:if(i=[],!t.atom_site)return[3,3];a=t.atom_site.id.rowCount,o=bQ(t,r),s=0,h.label=1;case 1:return s<a?(u=xQ(t.atom_site.pdbx_PDB_model_num,s),[4,mQ(e,t.atom_site,s,u)]):[3,3];case 2:return l=h.sent(),c=l.atom_site,d=l.sourceIndex,f=fOe(t,c,d,o,r,n,i.length>0?i[i.length-1]:void 0),i.push(f),s=u,[3,1];case 3:return[2,i]}})})}function RP(e,t){for(var r=new Map,n=e._rowCount,i=0;i<n;){var a=xQ(t,i),o=t.value(i);r.set(o,{table:Xr.window(e,e._schema,i,a),start:i,end:a}),i=a}return r}function vOe(e,t,r,n){return ce(this,void 0,void 0,function(){var i,a,o,s,u,l,c,d,f,h,v,p,m,g,y,b,S,x,C;return de(this,function(w){switch(w.label){case 0:if(i=bQ(t,r),a=t.atom_site.ihm_model_id.isDefined?t.atom_site.ihm_model_id:t.atom_site.pdbx_PDB_model_num,o=RP(t.atom_site,a),s=RP(t.ihm_sphere_obj_site,t.ihm_sphere_obj_site.model_id),u=RP(t.ihm_gaussian_obj_site,t.ihm_gaussian_obj_site.model_id),l=[],!t.ihm_model_list)return[3,6];c=t.ihm_model_list,d=c.model_id,f=c.model_name,h=0,w.label=1;case 1:return h<t.ihm_model_list._rowCount?(v=d.value(h),p=void 0,m=void 0,o.has(v)?(g=o.get(v),[4,mQ(e,t.atom_site,g.start,g.end)]):[3,3]):[3,6];case 2:return y=w.sent(),b=y.atom_site,S=y.sourceIndex,p=b,m=S,[3,4];case 3:p=Xr.window(t.atom_site,t.atom_site._schema,0,0),m=ve.ofIntArray([]),w.label=4;case 4:x={model_id:v,model_name:f.value(h),model_group_name:dOe(v,t),entities:i,atom_site:p,atom_site_sourceIndex:m,ihm_sphere_obj_site:s.has(v)?s.get(v).table:Xr.window(t.ihm_sphere_obj_site,t.ihm_sphere_obj_site._schema,0,0),ihm_gaussian_obj_site:u.has(v)?u.get(v).table:Xr.window(t.ihm_gaussian_obj_site,t.ihm_gaussian_obj_site._schema,0,0)},C=hOe(t,x,r,n),l.push(C),w.label=5;case 5:return h++,[3,1];case 6:return[2,l]}})})}var Yp;(function(e){function t(n){var i=this,a=n.descriptor.name,o=n.type==="static"?"_staticPropertyData":"_dynamicPropertyData",s=function(l){return a in l[o]||(l[o][a]={props:E({},I.getDefaultValues(n.getParams(l))),data:Hf.create(void 0)}),l[o][a]},u=function(l,c,d){var f=s(l);l[o][a]={props:c,data:Hf.withValue(f.data,d)}};return{label:n.label,descriptor:n.descriptor,isHidden:n.isHidden,getParams:function(l){var c=I.clone(n.getParams(l));return I.setDefaultValues(c,s(l).props),c},defaultParams:n.defaultParams,isApplicable:n.isApplicable,attach:function(l,c,d,f){return d===void 0&&(d={}),ce(i,void 0,void 0,function(){var h,v,p,m,g;return de(this,function(y){switch(y.label){case 0:return f&&c.customProperties.reference(n.descriptor,!0),h=s(c),v=I.merge(n.defaultParams,h.props,d),h.data.value&&I.areEqual(n.defaultParams,h.props,v)?[2]:[4,n.obtain(l,c,v)];case 1:return p=y.sent(),m=p.value,g=p.assets,c.customProperties.add(n.descriptor),c.customProperties.assets(n.descriptor,g),u(c,v,m),[2]}})})},ref:function(l,c){return l.customProperties.reference(n.descriptor,c)},get:function(l){var c;return(c=s(l))===null||c===void 0?void 0:c.data},set:function(l,c){c===void 0&&(c={});var d=s(l),f=I.merge(n.defaultParams,d.props,c);I.areEqual(n.defaultParams,d.props,f)||(u(l,f,void 0),l.customProperties.assets(n.descriptor))},props:function(l){return s(l).props}}}e.createProvider=t;function r(n,i,a){var o=this,s={value:I.Value(a,{isHidden:!0})};return t({label:zo(n),descriptor:yo({name:n}),isHidden:!0,type:i,defaultParams:s,getParams:function(){return{value:I.Value(a,{isHidden:!0})}},isApplicable:function(){return!0},obtain:function(u,l,c){return ce(o,void 0,void 0,function(){var d;return de(this,function(f){return[2,{value:(d=c.value)!==null&&d!==void 0?d:a}]})})}})}e.createSimple=r})(Yp||(Yp={}));var Wt;(function(e){function t(B,j){for(var Q=[],G=j.frames,W=B.atomicHierarchy.atomSourceIndex,q=ve.isIdentity(W),ee=q?void 0:W.toArray({array:Int32Array}),he=0,$=G.length;he<$;++he){var X=G[he],U=E(E({},B),{id:dn.create22(),modelNum:he,atomicConformation:q1.getAtomicConformation(X,B.atomicConformation.atomId,ee),customProperties:new Tl,_staticPropertyData:Object.create(null),_dynamicPropertyData:Object.create(null)});if(X.cell){var z=si.fromCell(X.cell.size,X.cell.anglesInRadians);si.Provider.set(U,z)}e.TrajectoryInfo.set(U,{index:he,size:G.length}),Q.push(U)}return{trajectory:Q,srcIndexArray:ee}}function r(B,j){return new Xp(t(B,j).trajectory)}e.trajectoryFromModelAndCoordinates=r;function n(B,j){var Q=this;return We.create("Create Trajectory",function(G){return ce(Q,void 0,void 0,function(){var W,q,ee,he,$,X,U,z,J;return de(this,function(Y){switch(Y.label){case 0:return[4,rd(B.basic,B.sourceData,G)];case 1:if(W=Y.sent(),W.frameCount===0)throw new Error("found no model");for(q=W.representative,ee=t(q,j).trajectory,he={pairs:B.bonds,count:q.atomicHierarchy.atoms._rowCount},$=fa.fromData(he),X=0,U=0,z=ee;U<z.length;U++)J=z[U],fa.Provider.set(J,$),e.TrajectoryInfo.set(J,{index:X++,size:ee.length});return[2,new Xp(ee)]}})})})}e.trajectoryFromTopologyAndCoordinates=n;var i="__Center__";function a(B){if(B._dynamicPropertyData[i])return B._dynamicPropertyData[i];var j=zTe(B.atomicConformation,B.coarseConformation);return B._dynamicPropertyData[i]=j,j}e.getCenter=a;function o(B){for(var j=new Int32Array(B.rowCount),Q=!1,G=0,W=B.rowCount;G<W;G++){var q=B.value(G);q!==G&&(Q=!1),j[q]=G}return{isIdentity:Q,invertedIndex:j}}var s="__InvertedAtomSrcIndex__";function u(B){if(B._staticPropertyData[s])return B._staticPropertyData[s];var j=o(B.atomicHierarchy.atomSourceIndex);return B._staticPropertyData[s]=j,j}e.getInvertedAtomSourceIndex=u;var l="__TrajectoryInfo__";e.TrajectoryInfo={get:function(B){return B._dynamicPropertyData[l]||{index:0,size:1}},set:function(B,j){return B._dynamicPropertyData[l]=j}};var c="__AsymIdCount__";e.AsymIdCount={get:function(B){if(B._dynamicPropertyData[c])return B._dynamicPropertyData[c];var j=VTe(B);return B._dynamicPropertyData[c]=j,j}},e.AsymIdOffset=Yp.createSimple("asym_id_offset","static"),e.Index=Yp.createSimple("index","static");function d(B){return B.parent||B}e.getRoot=d;function f(B,j){return B.atomicHierarchy===j.atomicHierarchy&&B.coarseHierarchy===j.coarseHierarchy}e.areHierarchiesEqual=f;var h="__CoordinatesHistory__";e.CoordinatesHistory={get:function(B){return B._staticPropertyData[h]},set:function(B,j){return B._staticPropertyData[h]=j}};var v="__CoarseGrained__";function p(B){if(B._staticPropertyData[v]!==void 0)return B._staticPropertyData[v];for(var j=0,Q=B.atomicHierarchy.derived.residue.polymerType,G=0;G<Q.length;++G)Q[G]!==0&&(j+=1);for(var W=!1,q=!1,ee=B.atomicHierarchy.atoms,he=ee.label_atom_id,$=ee._rowCount,G=0;G<$;++G){var X=he.value(G);if(!W&&X==="BB"&&(W=!0),!q&&X==="SC1"&&(q=!0),W&&q)break}var U=W&&q||(j&&$?$/j<3:!1);return B._staticPropertyData[v]=U,U}e.isCoarseGrained=p;function m(B){return B.properties.saccharideComponentMap.size>0}e.hasCarbohydrate=m;function g(B){for(var j=B.entities.subtype,Q=0,G=j.rowCount;Q<G;++Q)if(j.value(Q).startsWith("polypeptide"))return!0;return!1}e.hasProtein=g;function y(B){for(var j=B.entities.subtype,Q=0,G=j.rowCount;Q<G;++Q){var W=j.value(Q);if(W.endsWith("ribonucleotide hybrid")||W.endsWith("ribonucleotide"))return!0}return!1}e.hasNucleic=y;function b(B){if(!tn.is(B.sourceData))return!1;var j=B.sourceData.data.db;return j.database_2.database_id.isDefined||B.entryId.match(/^[1-9][a-z0-9]{3,3}$/i)!==null||B.entryId.match(/^pdb_[0-9]{4,4}[1-9][a-z0-9]{3,3}$/i)!==null}e.isFromPdbArchive=b;function S(B){if(!tn.is(B.sourceData))return!1;var j=B.sourceData.data.db;return j.struct_conf.id.isDefined||j.struct_sheet_range.id.isDefined}e.hasSecondaryStructure=S;var x=_.create(1.5707963,1.5707963,1.5707963),C=_.create(1,1,1);function w(B){var j,Q=(j=si.Provider.get(B))===null||j===void 0?void 0:j.spacegroup;return!!Q&&!(Q.num===1&&_.equals(Q.cell.anglesInRadians,x)&&_.equals(Q.cell.size,C))}e.hasCrystalSymmetry=w;function A(B){if(!tn.is(B.sourceData))return!1;for(var j=B.sourceData.data.db,Q=0;Q<j.exptl.method.rowCount;Q++){var G=j.exptl.method.value(Q).toUpperCase();if(G.indexOf("DIFFRACTION")>=0)return!0}return!1}e.isFromXray=A;function M(B){if(!tn.is(B.sourceData))return!1;for(var j=B.sourceData.data.db,Q=0;Q<j.exptl.method.rowCount;Q++){var G=j.exptl.method.value(Q).toUpperCase();if(G.indexOf("MICROSCOPY")>=0)return!0}return!1}e.isFromEm=M;function D(B){if(!tn.is(B.sourceData))return!1;for(var j=B.sourceData.data.db,Q=0;Q<j.exptl.method.rowCount;Q++){var G=j.exptl.method.value(Q).toUpperCase();if(G.indexOf("NMR")>=0)return!0}return!1}e.isFromNmr=D;function k(B){if(!tn.is(B.sourceData)||!A(B))return!1;var j=B.sourceData.data.db,Q=j.pdbx_database_status.status_code_sf;return Q.isDefined&&Q.value(0)==="REL"}e.hasXrayMap=k;function R(B){if(!tn.is(B.sourceData))return!1;for(var j=B.sourceData.data.db,Q=j.pdbx_database_related,G=Q.db_name,W=Q.content_type,q=0,ee=j.pdbx_database_related._rowCount;q<ee;++q)if(G.value(q).toUpperCase()==="EMDB"&&W.value(q)==="associated EM volume")return!0;return!1}e.hasEmMap=R;function L(B){return tn.is(B.sourceData)?k(B)||R(B):!1}e.hasDensityMap=L;function H(B){if(!tn.is(B.sourceData))return!1;var j=B.sourceData.data.db;return L(B)||b(B)&&(!j.exptl.method.isDefined||A(B)&&(!j.pdbx_database_status.status_code_sf.isDefined||j.pdbx_database_status.status_code_sf.valueKind(0)===2)||M(B)&&!j.pdbx_database_related.db_name.isDefined)}e.probablyHasDensityMap=H})(Wt||(Wt={}));var s5;(function(e){function t(d,f,h){if(!f)return{rowCount:0};if(h&&h[f.id])return h[f.id];var v=f.getElements(d),p={data:v,rowCount:v.elements.length};return h&&(h[f.id]=p),p}e.getCifDataSource=t;function r(d){return new M9(d)}e.fromAtomMap=r;function n(d){return new M9(kP(d))}e.fromAtomArray=n;var i=function(d){return d.atomicHierarchy.residueAtomSegments};function a(d){return new Y2("residue",d,i,0)}e.fromResidueMap=a;function o(d){return new Y2("residue",kP(d),i,0)}e.fromResidueArray=o;var s=function(d){return d.atomicHierarchy.chainAtomSegments};function u(d){return new Y2("chain",d,s,0)}e.fromChainMap=u;function l(d){return new Y2("chain",kP(d),s,0)}e.fromChainArray=l;function c(d){return new mOe(d)}e.fromEntityMap=c})(s5||(s5={}));function kP(e){for(var t=new Map,r=0,n=e.length;r<n;r++)t.set(r,e[r]);return t}var Y2=function(){function e(t,r,n,i){this.level=t,this.map=r,this.segmentGetter=n,this.id=dn.create22(),this.kind=i}return e.prototype.has=function(t){return this.map.has(t)},e.prototype.get=function(t){return this.map.get(t)},e.prototype.getStructureElements=function(t){var r=t.models;if(r.length!==1)throw new Error("Only works on structures with a single model.");for(var n=new Set,i=t.unitSymmetryGroups,a=[],o=this.segmentGetter(r[0]),s=0,u=i;s<u.length;s++){var l=u[s],c=l.units[0];if(c.kind===this.kind)for(var d=nr.transientSegments(o,c.elements);d.hasNext;){var f=d.move();!this.has(f.index)||n.has(f.index)||(n.add(f.index),a[a.length]=Ze.create(t,c,c.elements[f.start]))}}return a.sort(function(h,v){return h.element-v.element}),a},e.prototype.getElements=function(t){var r=this,n=this.segmentGetter(t.model).index,i=this.getStructureElements(t);return{elements:i,property:function(a){return r.get(n[i[a].element])}}},e}(),M9=function(){function e(t){this.map=t,this.id=dn.create22(),this.level="atom",this.kind=0}return e.prototype.has=function(t){return this.map.has(t)},e.prototype.get=function(t){return this.map.get(t)},e.prototype.getStructureElements=function(t){var r=t.models;if(r.length!==1)throw new Error("Only works on structures with a single model.");for(var n=new Set,i=t.unitSymmetryGroups,a=[],o=0,s=i;o<s.length;o++){var u=s[o],l=u.units[0];if(l.kind===this.kind)for(var c=l.elements,d=0,f=c.length;d<f;d++){var h=c[d];!this.has(h)||n.has(h)||(n.add(c[d]),a[a.length]=Ze.create(t,l,h))}}return a.sort(function(v,p){return v.element-p.element}),a},e.prototype.getElements=function(t){var r=this,n=this.getStructureElements(t);return{elements:n,property:function(i){return r.get(n[i].element)}}},e}(),mOe=function(){function e(t){this.map=t,this.id=dn.create22(),this.level="entity",this.kind=0}return e.prototype.has=function(t){return this.map.has(t)},e.prototype.get=function(t){return this.map.get(t)},e.prototype.getStructureElements=function(t){var r=t.models;if(r.length!==1)throw new Error("Only works on structures with a single model.");for(var n=r[0].atomicHierarchy.index,i=new Set,a=t.unitSymmetryGroups,o=[],s=r[0].atomicHierarchy.chainAtomSegments,u=0,l=a;u<l.length;u++){var c=l[u],d=c.units[0];if(d.kind===this.kind)for(var f=nr.transientSegments(s,d.elements);f.hasNext;){var h=f.move(),v=n.getEntityFromChain(h.index);!this.has(v)||i.has(v)||(i.add(v),o[o.length]=Ze.create(t,d,d.elements[h.start]))}}return o.sort(function(p,m){return p.element-m.element}),o},e.prototype.getElements=function(t){var r=this,n=this.getStructureElements(t),i=t.model.atomicHierarchy.chainAtomSegments.index,a=t.model.atomicHierarchy.index;return{elements:n,property:function(o){return r.get(a.getEntityFromChain(i[n[o].element]))}}},e}(),gOe=function(){function e(){this.map=new Map}return e.prototype.removeSymbol=function(t){this.map.delete(t.symbol.id)},e.prototype.addSymbol=function(t){this.map.has(t.symbol.id)&&console.warn("Symbol '"+t.symbol.id+"' already added. Call removeSymbol/removeCustomProps re-adding the symbol."),this.map.set(t.symbol.id,t)},e.prototype.addCustomProp=function(t){if(t.symbols)for(var r=0,n=Object.keys(t.symbols);r<n.length;r++){var i=n[r];this.addSymbol(t.symbols[i])}},e.prototype.removeCustomProp=function(t){if(t.symbols)for(var r=0,n=Object.keys(t.symbols);r<n.length;r++){var i=n[r];this.removeSymbol(t.symbols[i])}},e.prototype.getRuntime=function(t){return this.map.get(t)},e}(),s_=new gOe,yOe=function(){function e(t){this.table=t,this.constQueryContext=new Qo($e.Empty)}return e}(),D9;(function(e){function t(n){return{kind:"const",value:n}}e.Const=t;function r(n){return{kind:"dynamic",runtime:n}}e.Dynamic=r})(D9||(D9={}));var Sp;(function(e){function t(n){return{isConst:!0,fn:function(a){return n}}}e.Const=t;function r(n){return{isConst:!1,fn:n}}e.Dynamic=r})(Sp||(Sp={}));var Xy;(function(e){function t(r,n,i,a){if(typeof r.length=="number")for(var o=0,s=r.length;o<s;o++)i(r[o](n),o,a);else for(var o=0,u=0,l=Object.keys(r);u<l.length;u++){var c=l[u];i(r[c](n),o++,a)}return a}e.forEachEval=t})(Xy||(Xy={}));var Pg;(function(e){function t(n,i){return new R9(n,i,!0)}e.Const=t;function r(n,i){return new R9(n,i,!1)}e.Dynamic=r})(Pg||(Pg={}));var R9=function(){function e(t,r,n){this.symbol=t,this.fn=r,this.isConst=n}return e.prototype.compile=function(t,r){var n,i=!1;if(!r)n=void 0,i=!0;else if(_i.isArgumentsArray(r)){n=[],i=!1;for(var a=0,o=r;a<o.length;a++){var s=o[a],u=u5(t,s);i=i&&u.isConst,n.push(u.fn)}}else{n=Object.create(null),i=!1;for(var l=0,c=Object.keys(r);l<c.length;l++){var d=c[l],u=u5(t,r[d]);i=i&&u.isConst,n[d]=u.fn}}return this.isConst?this.isConst&&i?Sp.Const(this.fn(t.constQueryContext,n)):Sp.Dynamic(k9(this.fn,n)):Sp.Dynamic(k9(this.fn,n))},e}();function k9(e,t){return function(n){return e(n,t)}}function u5(e,t){if(_i.isLiteral(t))return Sp.Const(t);if(_i.isSymbol(t)){var r=e.table.getRuntime(t.name);return r?r.compile(e):Sp.Const(t.name)}if(!_i.isSymbol(t.head))throw new Error("Can only apply symbols.");var n=e.table.getRuntime(t.head.name);if(!n)throw new Error("Symbol '"+t.head.name+"' is not implemented.");return n.compile(e,t.args)}function Kp(e){var t=new yOe(s_);return u5(t,e).fn}var Zt=Pg.Const,Ut=Pg.Dynamic,bOe=[Zt(Ce.core.type.bool,function(t,r){return!!r[0](t)}),Zt(Ce.core.type.num,function(t,r){return+r[0](t)}),Zt(Ce.core.type.str,function(t,r){return""+r[0](t)}),Zt(Ce.core.type.list,function(t,r){return Xy.forEachEval(r,t,function(n,i,a){return a[i]=n},[])}),Zt(Ce.core.type.set,function(t,r){return Xy.forEachEval(r,t,function(i,a,o){return o.add(i)},new Set)}),Zt(Ce.core.type.regex,function(t,r){return new RegExp(r[0](t),r[1]&&r[1](t)||"")}),Zt(Ce.core.type.bitflags,function(t,r){return+r[0](t)}),Zt(Ce.core.type.compositeKey,function(t,r){return Xy.forEachEval(r,t,function(n,i,a){return a[i]=""+n},[]).join("-")}),Zt(Ce.core.logic.not,function(e,t){return!t[0](e)}),Zt(Ce.core.logic.and,function(e,t){if(typeof t.length=="number"){for(var r=0,n=t.length;r<n;r++)if(!t[r](e))return!1}else for(var i=0,a=Object.keys(t);i<a.length;i++){var o=a[i];if(!t[o](e))return!1}return!0}),Zt(Ce.core.logic.or,function(e,t){if(typeof t.length=="number"){for(var r=0,n=t.length;r<n;r++)if(t[r](e))return!0}else for(var i=0,a=Object.keys(t);i<a.length;i++){var o=a[i];if(t[o](e))return!0}return!1}),Zt(Ce.core.rel.eq,function(e,t){return t[0](e)===t[1](e)}),Zt(Ce.core.rel.neq,function(e,t){return t[0](e)!==t[1](e)}),Zt(Ce.core.rel.lt,function(e,t){return t[0](e)<t[1](e)}),Zt(Ce.core.rel.lte,function(e,t){return t[0](e)<=t[1](e)}),Zt(Ce.core.rel.gr,function(e,t){return t[0](e)>t[1](e)}),Zt(Ce.core.rel.gre,function(e,t){return t[0](e)>=t[1](e)}),Zt(Ce.core.rel.inRange,function(e,t){var r=t[0](e);return r>=t[1](e)&&r<=t[2](e)}),Zt(Ce.core.math.add,function(e,t){var r=0;if(typeof t.length=="number")for(var n=0,i=t.length;n<i;n++)r+=t[n](e);else for(var a=0,o=Object.keys(t);a<o.length;a++){var s=o[a];r+=t[s](e)}return r}),Zt(Ce.core.math.sub,function(e,t){var r=0;if(typeof t.length=="number"){if(t.length===1)return-t[0](e);r=t[0](e)||0;for(var n=1,i=t.length;n<i;n++)r-=t[n](e)}else{var a=Object.keys(t);if(a.length===1)return-t[a[0]](e);r=t[a[0]](e)||0;for(var n=1,i=a.length;n<i;n++)r-=t[a[n]](e)}return r}),Zt(Ce.core.math.mult,function(e,t){var r=1;if(typeof t.length=="number")for(var n=0,i=t.length;n<i;n++)r*=t[n](e);else for(var a=0,o=Object.keys(t);a<o.length;a++){var s=o[a];r*=t[s](e)}return r}),Zt(Ce.core.math.div,function(e,t){return t[0](e)/t[1](e)}),Zt(Ce.core.math.pow,function(e,t){return Math.pow(t[0](e),t[1](e))}),Zt(Ce.core.math.mod,function(e,t){return t[0](e)%t[1](e)}),Zt(Ce.core.math.min,function(e,t){var r=Number.POSITIVE_INFINITY;if(typeof t.length=="number")for(var n=0,i=t.length;n<i;n++)r=Math.min(t[n](e),r);else for(var a=0,o=Object.keys(t);a<o.length;a++){var s=o[a];r=Math.min(t[s](e),r)}return r}),Zt(Ce.core.math.max,function(e,t){var r=Number.NEGATIVE_INFINITY;if(typeof t.length=="number")for(var n=0,i=t.length;n<i;n++)r=Math.max(t[n](e),r);else for(var a=0,o=Object.keys(t);a<o.length;a++){var s=o[a];r=Math.max(t[s](e),r)}return r}),Zt(Ce.core.math.floor,function(e,t){return Math.floor(t[0](e))}),Zt(Ce.core.math.ceil,function(e,t){return Math.ceil(t[0](e))}),Zt(Ce.core.math.roundInt,function(e,t){return Math.round(t[0](e))}),Zt(Ce.core.math.abs,function(e,t){return Math.abs(t[0](e))}),Zt(Ce.core.math.sqrt,function(e,t){return Math.sqrt(t[0](e))}),Zt(Ce.core.math.cbrt,function(e,t){return Math.cbrt(t[0](e))}),Zt(Ce.core.math.sin,function(e,t){return Math.sin(t[0](e))}),Zt(Ce.core.math.cos,function(e,t){return Math.cos(t[0](e))}),Zt(Ce.core.math.tan,function(e,t){return Math.tan(t[0](e))}),Zt(Ce.core.math.asin,function(e,t){return Math.asin(t[0](e))}),Zt(Ce.core.math.acos,function(e,t){return Math.acos(t[0](e))}),Zt(Ce.core.math.atan,function(e,t){return Math.atan(t[0](e))}),Zt(Ce.core.math.sinh,function(e,t){return Math.sinh(t[0](e))}),Zt(Ce.core.math.cosh,function(e,t){return Math.cosh(t[0](e))}),Zt(Ce.core.math.tanh,function(e,t){return Math.tanh(t[0](e))}),Zt(Ce.core.math.exp,function(e,t){return Math.exp(t[0](e))}),Zt(Ce.core.math.log,function(e,t){return Math.log(t[0](e))}),Zt(Ce.core.math.log10,function(e,t){return Math.log10(t[0](e))}),Zt(Ce.core.math.atan2,function(e,t){return Math.atan2(t[0](e),t[1](e))}),Zt(Ce.core.str.match,function(e,t){return t[0](e).test(t[1](e))}),Zt(Ce.core.str.concat,function(e,t){var r=[];if(typeof t.length=="number")for(var n=0,i=t.length;n<i;n++)r.push(t[n](e).toString());else for(var a=0,o=Object.keys(t);a<o.length;a++){var s=o[a];r.push(t[s](e).toString())}return r.join("")}),Zt(Ce.core.list.getAt,function(e,t){return t[0](e)[t[1](e)]}),Zt(Ce.core.list.equal,function(e,t){return qk(t[0](e),t[1](e))}),Zt(Ce.core.set.has,function(t,r){return r[0](t).has(r[1](t))}),Zt(Ce.core.set.isSubset,function(t,r){return li.isSuperset(r[1](t),r[0](t))}),Zt(Ce.core.flags.hasAny,function(e,t){var r=t[1](e),n=t[0](e);return r?(n&r)!==0:!!n}),Zt(Ce.core.flags.hasAll,function(e,t){var r=t[1](e),n=t[0](e);return r?(n&r)===r:!n}),Zt(Ce.structureQuery.type.elementSymbol,function(e,t){return Yg(t[0](e))}),Zt(Ce.structureQuery.type.atomName,function(e,t){return S_e(t[0](e))}),Zt(Ce.structureQuery.type.bondFlags,function(e,t){var r=0;if(typeof t.length=="number")for(var n=0,i=t.length;n<i;n++)r=O9(r,t[n](e));else for(var a=0,o=Object.keys(t);a<o.length;a++){var s=o[a];r=O9(r,t[s](e))}return r}),Zt(Ce.structureQuery.type.ringFingerprint,function(e,t){return As.elementFingerprint(xOe(e,t))}),Zt(Ce.structureQuery.type.secondaryStructureFlags,function(e,t){var r=0;if(typeof t.length=="number")for(var n=0,i=t.length;n<i;n++)r=L9(r,t[n](e));else for(var a=0,o=Object.keys(t);a<o.length;a++){var s=o[a];r=L9(r,t[s](e))}return r}),Ut(Ce.structureQuery.filter.pick,function(e,t){return en.filters.pick(t[0],t.test)(e)}),Ut(Ce.structureQuery.filter.first,function(e,t){return en.filters.first(t[0])(e)}),Ut(Ce.structureQuery.filter.withSameAtomProperties,function(e,t){return en.filters.withSameAtomProperties(t[0],t.source,t.property)(e)}),Ut(Ce.structureQuery.filter.intersectedBy,function(e,t){return en.filters.areIntersectedBy(t[0],t.by)(e)}),Ut(Ce.structureQuery.filter.within,function(e,t){return en.filters.within({query:t[0],target:t.target,minRadius:t["min-radius"],maxRadius:t["max-radius"],elementRadius:t["atom-radius"],invert:t.invert})(e)}),Ut(Ce.structureQuery.filter.isConnectedTo,function(e,t){return en.filters.isConnectedTo({query:t[0],target:t.target,disjunct:t.disjunct,invert:t.invert,bondTest:t["bond-test"]})(e)}),Ut(Ce.structureQuery.generator.atomGroups,function(t,r){return en.generators.atoms({entityTest:r["entity-test"],chainTest:r["chain-test"],residueTest:r["residue-test"],atomTest:r["atom-test"],groupBy:r["group-by"]})(t)}),Ut(Ce.structureQuery.generator.all,function(t){return en.generators.all(t)}),Ut(Ce.structureQuery.generator.empty,function(t){return en.generators.none(t)}),Ut(Ce.structureQuery.generator.bondedAtomicPairs,function(t,r){return en.generators.bondedAtomicPairs(r&&r[0])(t)}),Ut(Ce.structureQuery.generator.rings,function(t,r){var n,i;return en.generators.rings((n=r==null?void 0:r.fingerprint)===null||n===void 0?void 0:n.call(r,t),(i=r==null?void 0:r["only-aromatic"])===null||i===void 0?void 0:i.call(r,t))(t)}),Ut(Ce.structureQuery.modifier.includeSurroundings,function(t,r){return en.modifiers.includeSurroundings(r[0],{radius:r.radius(t),wholeResidues:!!(r["as-whole-residues"]&&r["as-whole-residues"](t)),elementRadius:r["atom-radius"]})(t)}),Ut(Ce.structureQuery.modifier.surroundingLigands,function(t,r){return en.modifiers.surroundingLigands({query:r[0],radius:r.radius(t),includeWater:!!(r["include-water"]&&r["include-water"](t))})(t)}),Ut(Ce.structureQuery.modifier.wholeResidues,function(t,r){return en.modifiers.wholeResidues(r[0])(t)}),Ut(Ce.structureQuery.modifier.union,function(t,r){return en.modifiers.union(r[0])(t)}),Ut(Ce.structureQuery.modifier.expandProperty,function(t,r){return en.modifiers.expandProperty(r[0],r.property)(t)}),Ut(Ce.structureQuery.modifier.exceptBy,function(t,r){return en.modifiers.exceptBy(r[0],r.by)(t)}),Ut(Ce.structureQuery.modifier.includeConnected,function(t,r){var n,i;return en.modifiers.includeConnected({query:r[0],bondTest:r["bond-test"],wholeResidues:!!(r["as-whole-residues"]&&r["as-whole-residues"](t)),layerCount:r["layer-count"]&&r["layer-count"](t)||1,fixedPoint:(i=(n=r["fixed-point"])===null||n===void 0?void 0:n.call(r,t))!==null&&i!==void 0?i:!1})(t)}),Ut(Ce.structureQuery.combinator.merge,function(e,t){return en.combinators.merge(t)(e)}),Ut(Ce.structureQuery.atomProperty.core.elementSymbol,on(lt.atom.type_symbol)),Ut(Ce.structureQuery.atomProperty.core.vdw,function(e,t){return Pb(lt.atom.type_symbol(t&&t[0]&&t[0](e)||e.element))}),Ut(Ce.structureQuery.atomProperty.core.mass,function(e,t){return JTe(lt.atom.type_symbol(t&&t[0]&&t[0](e)||e.element))}),Ut(Ce.structureQuery.atomProperty.core.atomicNumber,function(e,t){return Tb(lt.atom.type_symbol(t&&t[0]&&t[0](e)||e.element))}),Ut(Ce.structureQuery.atomProperty.core.x,on(lt.atom.x)),Ut(Ce.structureQuery.atomProperty.core.y,on(lt.atom.y)),Ut(Ce.structureQuery.atomProperty.core.z,on(lt.atom.z)),Ut(Ce.structureQuery.atomProperty.core.sourceIndex,on(lt.atom.sourceIndex)),Ut(Ce.structureQuery.atomProperty.core.operatorName,on(lt.unit.operator_name)),Ut(Ce.structureQuery.atomProperty.core.modelIndex,on(lt.unit.model_index)),Ut(Ce.structureQuery.atomProperty.core.modelLabel,on(lt.unit.model_label)),Ut(Ce.structureQuery.atomProperty.core.atomKey,function(e,t){var r=t&&t[0]&&t[0](e)||e.element;return Rf(r.unit.id,r.element)}),Ut(Ce.structureQuery.atomProperty.macromolecular.residueKey,function(e,t){return Fke(t&&t[0]&&t[0](e)||e.element)}),Ut(Ce.structureQuery.atomProperty.macromolecular.chainKey,function(e,t){return Bke(t&&t[0]&&t[0](e)||e.element)}),Ut(Ce.structureQuery.atomProperty.macromolecular.entityKey,function(e,t){return Uke(t&&t[0]&&t[0](e)||e.element)}),Ut(Ce.structureQuery.atomProperty.macromolecular.id,on(lt.atom.id)),Ut(Ce.structureQuery.atomProperty.macromolecular.isHet,function(e,t){return lt.residue.group_PDB(t&&t[0]&&t[0](e)||e.element)!=="ATOM"}),Ut(Ce.structureQuery.atomProperty.macromolecular.label_atom_id,on(lt.atom.label_atom_id)),Ut(Ce.structureQuery.atomProperty.macromolecular.label_alt_id,on(lt.atom.label_alt_id)),Ut(Ce.structureQuery.atomProperty.macromolecular.label_comp_id,on(lt.atom.label_comp_id)),Ut(Ce.structureQuery.atomProperty.macromolecular.label_seq_id,on(lt.residue.label_seq_id)),Ut(Ce.structureQuery.atomProperty.macromolecular.label_asym_id,on(lt.chain.label_asym_id)),Ut(Ce.structureQuery.atomProperty.macromolecular.label_entity_id,on(lt.entity.id)),Ut(Ce.structureQuery.atomProperty.macromolecular.auth_atom_id,on(lt.atom.auth_atom_id)),Ut(Ce.structureQuery.atomProperty.macromolecular.auth_comp_id,on(lt.atom.auth_comp_id)),Ut(Ce.structureQuery.atomProperty.macromolecular.auth_seq_id,on(lt.residue.auth_seq_id)),Ut(Ce.structureQuery.atomProperty.macromolecular.auth_asym_id,on(lt.chain.auth_asym_id)),Ut(Ce.structureQuery.atomProperty.macromolecular.pdbx_PDB_ins_code,on(lt.residue.pdbx_PDB_ins_code)),Ut(Ce.structureQuery.atomProperty.macromolecular.pdbx_formal_charge,on(lt.atom.pdbx_formal_charge)),Ut(Ce.structureQuery.atomProperty.macromolecular.occupancy,on(lt.atom.occupancy)),Ut(Ce.structureQuery.atomProperty.macromolecular.B_iso_or_equiv,on(lt.atom.B_iso_or_equiv)),Ut(Ce.structureQuery.atomProperty.macromolecular.entityType,on(lt.entity.type)),Ut(Ce.structureQuery.atomProperty.macromolecular.entitySubtype,on(lt.entity.subtype)),Ut(Ce.structureQuery.atomProperty.macromolecular.entityPrdId,on(lt.entity.prd_id)),Ut(Ce.structureQuery.atomProperty.macromolecular.entityDescription,on(lt.entity.pdbx_description)),Ut(Ce.structureQuery.atomProperty.macromolecular.objectPrimitive,on(lt.unit.object_primitive)),Ut(Ce.structureQuery.atomProperty.macromolecular.isNonStandard,on(lt.residue.isNonStandard)),Ut(Ce.structureQuery.atomProperty.macromolecular.secondaryStructureKey,on(lt.residue.secondary_structure_key)),Ut(Ce.structureQuery.atomProperty.macromolecular.secondaryStructureFlags,on(lt.residue.secondary_structure_type)),Ut(Ce.structureQuery.atomProperty.macromolecular.chemCompType,on(lt.residue.chem_comp_type)),Ut(Ce.structureQuery.bondProperty.order,function(e,t){return e.atomicBond.order}),Ut(Ce.structureQuery.bondProperty.flags,function(e,t){return e.atomicBond.type}),Ut(Ce.structureQuery.bondProperty.atomA,function(e,t){return e.atomicBond.a}),Ut(Ce.structureQuery.bondProperty.atomB,function(e,t){return e.atomicBond.b}),Ut(Ce.structureQuery.bondProperty.length,function(e,t){return e.atomicBond.length}),Ut(Ce.internal.generator.bundleElement,function(t,r){return aQ(r.groupedUnits(t),r.ranges(t),r.set(t))}),Ut(Ce.internal.generator.bundle,function(t,r){return oQ(r.elements(t))(t)}),Ut(Ce.internal.generator.current,function(t,r){return t.tryGetCurrentSelection()})];function on(e){return function(t,r){return e(r&&r[0]&&r[0](t)||t.element)}}function O9(e,t){return e|(Nr.isName(t)?Nr.fromName(t):0)}function L9(e,t){switch(t.toLowerCase()){case"helix":return e|2;case"alpha":return e|2|4096;case"pi":return e|2|32768;case"310":return e|2|2048;case"beta":return e|4;case"strand":return e|4|4194304;case"sheet":return e|4|8388608;case"turn":return e|16;case"bend":return e|8;case"coil":return e|536870912;default:return e}}function xOe(e,t){var r=[];if(!t)return r;if(typeof t.length=="number")for(var n=0,i=t.length;n<i;n++)r.push(t[n](e));else for(var a=Object.keys(t),n=1,i=a.length;n<i;n++)r.push(t[a[n]](e));return r}(function(){for(var e=0,t=bOe;e<t.length;e++){var r=t[e];s_.addSymbol(r)}})();var bu;(function(e){function t(s){var u=new DataView(s.buffer);return Object.assign(s.subarray(0),{readInt8:function(l){return u.getInt8(l)},readUInt8:function(l){return u.getUint8(l)},writeInt8:function(l,c){return u.setInt8(c,l)},writeUInt8:function(l,c){return u.setUint8(c,l)},readInt16LE:function(l){return u.getInt16(l,!0)},readInt32LE:function(l){return u.getInt32(l,!0)},readUInt16LE:function(l){return u.getUint16(l,!0)},readUInt32LE:function(l){return u.getUint32(l,!0)},readFloatLE:function(l){return u.getFloat32(l,!0)},readDoubleLE:function(l){return u.getFloat64(l,!0)},writeInt16LE:function(l,c){return u.setInt16(c,l,!0)},writeInt32LE:function(l,c){return u.setInt32(c,l,!0)},writeUInt16LE:function(l,c){return u.setUint16(c,l,!0)},writeUInt32LE:function(l,c){return u.setUint32(c,l,!0)},writeFloatLE:function(l,c){return u.setFloat32(c,l,!0)},writeDoubleLE:function(l,c){return u.setFloat64(c,l,!0)},readInt16BE:function(l){return u.getInt16(l,!1)},readInt32BE:function(l){return u.getInt32(l,!1)},readUInt16BE:function(l){return u.getUint16(l,!1)},readUInt32BE:function(l){return u.getUint32(l,!1)},readFloatBE:function(l){return u.getFloat32(l,!1)},readDoubleBE:function(l){return u.getFloat64(l,!1)},writeInt16BE:function(l,c){return u.setInt16(c,l,!1)},writeInt32BE:function(l,c){return u.setInt32(c,l,!1)},writeUInt16BE:function(l,c){return u.setUint16(c,l,!1)},writeUInt32BE:function(l,c){return u.setUint32(c,l,!1)},writeFloatBE:function(l,c){return u.setFloat32(c,l,!1)},writeDoubleBE:function(l,c){return u.setFloat64(c,l,!1)},copy:function(l,c,d,f){return c=Ei(c,0),d=Ei(d,0),f=Ei(f,s.length),l.set(s.subarray(d,f),c),f-d}})}e.fromUint8Array=t;function r(s){return t(new Uint8Array(s))}e.fromArrayBuffer=r;function n(s){return s}e.fromBuffer=n,e.IsNativeEndianLittle=new Uint16Array(new Uint8Array([18,52]).buffer)[0]===13330;function i(s,u,l,c,d){for(var f=0,h=l;f<h;f+=c)for(var v=0;v<c;v++)u[d+f+c-v-1]=s[d+f+v]}e.flipByteOrder=i;function a(s,u,l){u===void 0&&(u=0);for(var c=new Int16Array(s,u,l),d=0,f=c.length;d<f;++d){var h=c[d];c[d]=(h&255)<<8|h>>8&255}}e.flipByteOrderInPlace2=a;function o(s,u,l,c,d){e.IsNativeEndianLittle||!l||c<=1||i(s,u,l,c,d)}e.ensureLittleEndian=o})(bu||(bu={}));var u_;(function(e){function t(r,n){return{name:n,readBuffer:function(i,a,o,s){var u,l;if(typeof a=="number"){o=Ei(o,a);var c=i,d=Math.min(r.length,c+o);u=d-c,l=bu.fromUint8Array(new Uint8Array(r.buffer,c,d-c))}else{o=Ei(o,a.length);var c=i,d=Math.min(r.length,c+o);a.set(r.subarray(c,d),s),u=d-c,l=a}return o!==u&&console.warn("byteCount "+o+" and bytesRead "+u+" differ"),Promise.resolve({bytesRead:u,buffer:l})},writeBuffer:function(i,a,o){return o=Ei(o,a.length),console.error(".writeBuffer not implemented for FileHandle.fromBuffer"),Promise.resolve(0)},writeBufferSync:function(i,a,o){return o=Ei(o,a.length),console.error(".writeSync not implemented for FileHandle.fromBuffer"),0},close:ef}}e.fromBuffer=t})(u_||(u_={}));var ua;(function(e){e.Float32="float32",e.Int8="int8",e.Int16="int16",e.Uint16="uint16"})(ua||(ua={}));function SQ(e){return e===ua.Float32?4:e===ua.Int16||e===ua.Uint16?2:1}function SOe(e,t,r,n){return r===void 0&&(r=0),e===ua.Float32?new Float32Array(t,r,n):e===ua.Int16?new Int16Array(t,r,n):e===ua.Uint16?new Uint16Array(t,r,n):new Int8Array(t,r,n)}function COe(e,t){var r=SQ(t),n=new ArrayBuffer(r*e),i=bu.fromArrayBuffer(n),a=bu.IsNativeEndianLittle?n:new ArrayBuffer(r*e);return{type:t,elementByteSize:r,readBuffer:i,valuesBuffer:new Uint8Array(a),values:SOe(t,a)}}function _Oe(e,t,r,n,i,a){return ce(this,void 0,void 0,function(){return de(this,function(o){switch(o.label){case 0:return[4,t.readBuffer(r,e.readBuffer,n,i)];case 1:return o.sent(),e.elementByteSize>1&&(a!==void 0&&a!==bu.IsNativeEndianLittle||!bu.IsNativeEndianLittle)&&bu.flipByteOrder(e.readBuffer,e.valuesBuffer,n,e.elementByteSize,i),[2,e.values]}})})}function wOe(e){return ce(this,void 0,void 0,function(){var t,r,n,i,a,o,s,u,l;return de(this,function(c){switch(c.label){case 0:return t=1024,[4,e.readBuffer(0,t)];case 1:if(r=c.sent().buffer,n=String.fromCharCode(r.readUInt8(52*4),r.readUInt8(52*4+1),r.readUInt8(52*4+2),r.readUInt8(52*4+3)),n!=="MAP ")throw new Error('ccp4 format error, missing "MAP " string');return i=[r.readUInt8(53*4),r.readUInt8(53*4+1)],a=!1,i[0]===68&&i[1]===65?a=!0:i[0]===17&&i[1]===17?a=!1:(o=r.readInt32LE(3*4),o<=16&&(a=!0)),s=a?function(d){return r.readInt32LE(d*4)}:function(d){return r.readInt32BE(d*4)},u=a?function(d){return r.readFloatLE(d*4)}:function(d){return r.readFloatBE(d*4)},l={NC:s(0),NR:s(1),NS:s(2),MODE:s(3),NCSTART:s(4),NRSTART:s(5),NSSTART:s(6),NX:s(7),NY:s(8),NZ:s(9),xLength:u(10),yLength:u(11),zLength:u(12),alpha:u(13),beta:u(14),gamma:u(15),MAPC:s(16),MAPR:s(17),MAPS:s(18),AMIN:u(19),AMAX:u(20),AMEAN:u(21),ISPG:s(22),NSYMBT:s(23),LSKFLG:s(24),SKWMAT:[],SKWTRN:[],userFlag1:s(39),userFlag2:s(40),originX:u(49),originY:u(50),originZ:u(51),MAP:n,MACHST:i,ARMS:u(54)},[2,{header:l,littleEndian:a}]}})})}function EOe(e,t,r,n,i,a){return ce(this,void 0,void 0,function(){var o,s,u,l,c,d;return de(this,function(f){switch(f.label){case 0:return _Q(e)?(o=3*i,[4,r.readBuffer(n,t.readBuffer,i,o)]):[3,2];case 1:for(f.sent(),s=new Int8Array(t.valuesBuffer.buffer,o),u=(e.AMAX-e.AMIN)/255,l=.5*(e.AMIN+e.AMAX+u),c=0,d=i;c<d;++c)t.values[c]=u*s[c]+l;return[3,4];case 2:return[4,_Oe(t,r,n,i,0,a)];case 3:f.sent(),f.label=4;case 4:return[2]}})})}function CQ(e){switch(e){case 0:return ua.Int8;case 1:return ua.Int16;case 2:return ua.Float32;case 3:throw new Error("mode 3 unsupported, complex 16-bit integers");case 4:throw new Error("mode 4 unsupported, complex 32-bit reals");case 6:ua.Uint16;case 16:throw new Error("mode 16 unsupported, unsigned char * 3 (for rgb data, non-standard)")}throw new Error("unknown mode '"+e+"'")}function _Q(e){return e.userFlag1===-128&&e.userFlag2===127}function wQ(e){return _Q(e)?ua.Float32:CQ(e.MODE)}function AOe(e){return 256*4+e.NSYMBT}function POe(e,t,r){return ce(this,void 0,void 0,function(){var n,i,a,o,s,u,l,c,d,f,h;return de(this,function(v){switch(v.label){case 0:return[4,r.update({message:"Parsing CCP4/MRC/MAP file..."})];case 1:return v.sent(),[4,wOe(e)];case 2:return n=v.sent(),i=n.header,a=n.littleEndian,o=AOe(i),s=CQ(i.MODE),u=wQ(i),l=i.NC*i.NR*i.NS,c=SQ(s),d=l*c,f=COe(l,u),EOe(i,f,e,o,d,a),h={header:i,values:f.values,name:e.name},[2,h]}})})}function TOe(e,t){var r=this;return We.create("Parse CCP4/MRC/MAP",function(n){return ce(r,void 0,void 0,function(){var i,a,o;return de(this,function(s){switch(s.label){case 0:return s.trys.push([0,2,,3]),a=(i=wn).success,[4,POe(e,t,n)];case 1:return[2,a.apply(i,[s.sent()])];case 2:return o=s.sent(),[2,wn.error(o)];case 3:return[2]}})})})}function IOe(e,t){return TOe(u_.fromBuffer(bu.fromUint8Array(e),t),e.length)}var l5=512;function MOe(e){return{xStart:parseInt(e.substr(10,5)),yStart:parseInt(e.substr(15,5)),zStart:parseInt(e.substr(20,5)),xExtent:parseInt(e.substr(32,5)),yExtent:parseInt(e.substr(38,5)),zExtent:parseInt(e.substr(42,5)),xRate:parseInt(e.substr(52,5)),yRate:parseInt(e.substr(58,5)),zRate:parseInt(e.substr(62,5)),xlen:parseFloat(e.substr(73,10)),ylen:parseFloat(e.substr(83,10)),zlen:parseFloat(e.substr(93,10)),alpha:parseFloat(e.substr(103,10)),beta:parseFloat(e.substr(113,10)),gamma:parseFloat(e.substr(123,10)),divisor:parseFloat(e.substr(138,12)),summand:parseInt(e.substr(155,8)),sigma:parseFloat(e.substr(170,12))}}function DOe(e,t){var r=t?function(i){return e.readInt16LE(i*2)}:function(i){return e.readInt16BE(i*2)},n=1/r(17);return{xStart:r(0),yStart:r(1),zStart:r(2),xExtent:r(3),yExtent:r(4),zExtent:r(5),xRate:r(6),yRate:r(7),zRate:r(8),xlen:r(9)*n,ylen:r(10)*n,zlen:r(11)*n,alpha:r(12)*n,beta:r(13)*n,gamma:r(14)*n,divisor:r(15)/100,summand:r(16),sigma:void 0}}function EQ(e){var t=e.xExtent,r=e.yExtent,n=e.zExtent,i=Math.ceil(t/8),a=Math.ceil(r/8),o=Math.ceil(n/8);return{xBlocks:i,yBlocks:a,zBlocks:o}}function ROe(e){return ce(this,void 0,void 0,function(){var t,r,n,i,a;return de(this,function(o){switch(o.label){case 0:return[4,e.readBuffer(0,l5)];case 1:return t=o.sent().buffer,r=String.fromCharCode.apply(null,t),n=r.startsWith(":-)"),i=n||t.readInt16LE(18*2)===100,a=n?MOe(r):DOe(t,i),[2,{header:a,littleEndian:i}]}})})}function kOe(e,t,r,n){return ce(this,void 0,void 0,function(){var i,a,o,s,u,l,c,d,f,h,v,p,m,g,y,b,S,x,C,w;return de(this,function(A){for(n||bu.flipByteOrderInPlace2(t.buffer),i=e.divisor,a=e.summand,o=e.xExtent,s=e.yExtent,u=e.zExtent,l=EQ(e),c=l.xBlocks,d=l.yBlocks,f=l.zBlocks,h=0,v=0;v<f;++v)for(p=0;p<d;++p)for(m=0;m<c;++m)for(g=0;g<8;++g)for(y=8*v+g,b=0;b<8;++b)for(S=8*p+b,x=0;x<8;++x)if(C=8*m+x,C<o&&S<s&&y<u)w=(C*s+S)*u+y,r[w]=(t[h]-a)/i,++h;else{h+=8-x;break}return[2]})})}function OOe(e){var t=e.xExtent,r=e.yExtent,n=e.zExtent,i=EQ(e),a=i.xBlocks,o=i.yBlocks,s=i.zBlocks,u=t*r*n,l=a*8*o*8*s*8,c=1,d=l*c;return{count:l,byteCount:d,valueCount:u}}function LOe(e,t,r){return ce(this,void 0,void 0,function(){var n,i,a,o,s,u,l;return de(this,function(c){switch(c.label){case 0:return[4,r.update({message:"Parsing DSN6/BRIX file..."})];case 1:return c.sent(),[4,ROe(e)];case 2:return n=c.sent(),i=n.header,a=n.littleEndian,[4,e.readBuffer(l5,t-l5)];case 3:return o=c.sent().buffer,s=OOe(i).valueCount,u=new Float32Array(s),[4,kOe(i,o,u,a)];case 4:return c.sent(),l={header:i,values:u,name:e.name},[2,l]}})})}function NOe(e,t){var r=this;return We.create("Parse DSN6/BRIX",function(n){return ce(r,void 0,void 0,function(){var i,a,o;return de(this,function(s){switch(s.label){case 0:return s.trys.push([0,2,,3]),a=(i=wn).success,[4,LOe(e,t,n)];case 1:return[2,a.apply(i,[s.sent()])];case 2:return o=s.sent(),[2,wn.error(o)];case 3:return[2]}})})})}function FOe(e,t){return NOe(u_.fromBuffer(bu.fromUint8Array(e),t),e.length)}var BOe={char:1,uchar:1,short:2,ushort:2,int:4,uint:4,float:4,double:8,int8:1,uint8:1,int16:2,uint16:2,int32:4,uint32:4,float32:4,float64:8},UOe=new Set(Object.keys(BOe));function OP(e){if(!UOe.has(e))throw new Error("unknown ply type '"+e+"'");return e}function jOe(e,t,r){for(var n=new Map,i=0,a=t.length;i<a;++i)n.set(t[i],e[i]);return{comments:r,elementNames:t,getElement:function(o){return n.get(o)}}}function zOe(e,t){var r=It(e);return{data:e,tokenizer:r,runtimeCtx:t,comments:[],elementSpecs:[],elements:[]}}function VOe(e){var t=e.data.indexOf("end_header",e.position);if(t===-1)throw new Error("no 'end_header' record found");e.tokenStart=e.position,e.tokenEnd=t,e.position=t,It.eatLine(e)}function HOe(e){var t=e.tokenizer,r=e.comments,n=e.elementSpecs;VOe(t);var i=It.getTokenString(t).split(/\r?\n/);if(i[0]!=="ply")throw new Error("data not starting with 'ply'");if(i[1]!=="format ascii 1.0")throw new Error("format not 'ascii 1.0'");var a,o,s;function u(){if(a!==void 0&&o!==void 0&&s!==void 0){for(var h=!1,v=0,p=s.length;v<p;++v){var m=s[v];if(m.kind==="list"){h=!0;break}}h&&s.length,h?n.push({kind:"list",name:a,count:o,property:s[0]}):n.push({kind:"table",name:a,count:o,properties:s})}}for(var l=2,c=i.length;l<c;++l){var d=i[l],f=d.split(" ");if(d.startsWith("comment"))r.push(d.substr(8));else if(d.startsWith("element"))u(),s=[],a=f[1],o=parseInt(f[2]);else if(d.startsWith("property")){if(s===void 0)throw new Error("properties outside of element");f[1]==="list"?s.push({kind:"list",countType:OP(f[2]),dataType:OP(f[3]),name:f[4]}):s.push({kind:"column",type:OP(f[1]),name:f[2]})}else d.startsWith("end_header")?u():console.warn("unknown header line")}}function GOe(e){for(var t=e.elementSpecs,r=0,n=t.length;r<n;++r){var i=t[r];i.kind==="table"?qOe(e,i):i.kind==="list"&&WOe(e,i)}}function AQ(e){switch(e){case"char":case"uchar":case"int8":case"uint8":case"short":case"ushort":case"int16":case"uint16":case"int":case"uint":case"int32":case"uint32":return ve.Schema.int;case"float":case"double":case"float32":case"float64":return ve.Schema.float}}function qOe(e,t){for(var r=e.elements,n=e.tokenizer,i=t.count,a=t.properties,o=a.length,s=[],u=[],l=[],c=new Map,d=0,f=o;d<f;++d){var h=ht.create(n.data,i*2);l.push(h)}for(var d=0,f=i;d<f;++d)for(var v=0,p=o;v<p;++v)It.skipWhitespace(n),It.markStart(n),It.eatValue(n),ht.addUnchecked(l[v],n.tokenStart,n.tokenEnd);for(var d=0,f=o;d<f;++d){var m=a[d],g=m.type,y=m.name,b=fO(l[d],AQ(g));s.push(y),u.push(g),c.set(y,b)}r.push({kind:"table",rowCount:i,propertyNames:s,propertyTypes:u,getProperty:function(S){return c.get(S)}})}function WOe(e,t){for(var r=e.elements,n=e.tokenizer,i=t.count,a=t.property,o=ht.create(n.data,i*2*3),s=new Uint32Array(i+1),u=0,l=0,c=i;l<c;++l){for(It.skipWhitespace(n),It.markStart(n);It.skipWhitespace(n)!==10;)++u,It.markStart(n),It.eatValue(n),ht.addToken(o,n);s[l+1]=u}var d={entries:[],count:0},f=fO(o,AQ(a.dataType));r.push({kind:"list",rowCount:i,name:a.name,type:a.dataType,value:function(h){for(var v=s[h]+1,p=f.value(v-1),m=v,g=v+p;m<g;++m)d.entries[m-v]=f.value(m);return d.count=p,d}})}function $Oe(e,t){return ce(this,void 0,void 0,function(){var r,n,i,a,o,s;return de(this,function(u){return r=zOe(e,t),t.update({message:"Parsing...",current:0,max:e.length}),HOe(r),GOe(r),n=r.elements,i=r.elementSpecs,a=r.comments,o=i.map(function(l){return l.name}),s=jOe(n,o,a),[2,wn.success(s)]})})}function XOe(e){var t=this;return We.create("Parse PLY",function(r){return ce(t,void 0,void 0,function(){return de(this,function(n){switch(n.label){case 0:return[4,$Oe(e,r)];case 1:return[2,n.sent()]}})})})}var l_=It.readLine,PQ=It.skipWhitespace,TQ=It.eatValue,YOe=It.eatLine,c5=It.markStart,gS=/\s+/,KOe=/(^\*|REMARK)*/;function QOe(e,t){return{tokenizer:e,runtimeCtx:t}}function ZOe(e,t){return ce(this,void 0,void 0,function(){var r,n,i,a,o,s,u,l,c,d,f,h,v,p,m;return de(this,function(g){switch(g.label){case 0:return r=e.tokenizer,n=ht.create(r.data,t*2),i=ht.create(r.data,t*2),a=ht.create(r.data,t*2),o=ht.create(r.data,t*2),s=ht.create(r.data,t*2),u=ht.create(r.data,t*2),l=ht.create(r.data,t*2),c=ht.create(r.data,t*2),d=r.position,f=l_(r).trim(),r.position=d,h=f.split(gS).length===7,v=h?6:8,p=r.length,m=0,[4,Oc(e.runtimeCtx,1e5,void 0,function(y){for(var b=Math.min(t-m,y),S=0;S<b;++S){for(var x=0;x<v;++x)if(PQ(r),c5(r),TQ(r),h)switch(x){case 0:ht.addUnchecked(n,r.tokenStart,r.tokenEnd);break;case 1:ht.addUnchecked(a,r.tokenStart,r.tokenEnd);break;case 2:ht.addUnchecked(s,r.tokenStart,r.tokenEnd);break;case 3:ht.addUnchecked(u,r.tokenStart,r.tokenEnd);break;case 4:ht.addUnchecked(l,r.tokenStart,r.tokenEnd);break;case 5:ht.addUnchecked(c,r.tokenStart,r.tokenEnd);break}else switch(x){case 0:ht.addUnchecked(n,r.tokenStart,r.tokenEnd);break;case 1:ht.addUnchecked(i,r.tokenStart,r.tokenEnd);break;case 2:ht.addUnchecked(a,r.tokenStart,r.tokenEnd);break;case 3:ht.addUnchecked(o,r.tokenStart,r.tokenEnd);break;case 4:ht.addUnchecked(s,r.tokenStart,r.tokenEnd);break;case 5:ht.addUnchecked(u,r.tokenStart,r.tokenEnd);break;case 6:ht.addUnchecked(l,r.tokenStart,r.tokenEnd);break;case 7:ht.addUnchecked(c,r.tokenStart,r.tokenEnd);break}YOe(r),c5(r)}return m+=b,b},function(y){return y.update({message:"Parsing...",current:r.position,max:p})})];case 1:return g.sent(),[2,{count:t,atomId:qr(n)(ve.Schema.int),segmentName:h?qr(a)(ve.Schema.str):qr(i)(ve.Schema.str),residueId:qr(a)(ve.Schema.int),residueName:h?qr(a)(ve.Schema.str):qr(o)(ve.Schema.str),atomName:qr(s)(ve.Schema.str),atomType:qr(u)(ve.Schema.str),charge:qr(l)(ve.Schema.float),mass:qr(c)(ve.Schema.float)}]}})})}function JOe(e,t){return ce(this,void 0,void 0,function(){var r,n,i,a,o;return de(this,function(s){switch(s.label){case 0:return r=e.tokenizer,n=ht.create(r.data,t*2),i=ht.create(r.data,t*2),a=r.length,o=0,[4,Oc(e.runtimeCtx,10,void 0,function(u){for(var l=Math.min(t-o,u),c=0;c<l;++c)for(var d=0;d<2;++d)switch(PQ(r),c5(r),TQ(r),d){case 0:ht.addUnchecked(n,r.tokenStart,r.tokenEnd);break;case 1:ht.addUnchecked(i,r.tokenStart,r.tokenEnd);break}return o+=l,l},function(u){return u.update({message:"Parsing...",current:r.position,max:a})})];case 1:return s.sent(),[2,{count:t,atomIdA:qr(n)(ve.Schema.int),atomIdB:qr(i)(ve.Schema.int)}]}})})}function eLe(e,t){for(var r=[],n=0;n<t;++n){var i=l_(e.tokenizer);r.push(i.replace(KOe,"").trim())}return r}function tLe(e,t){return ce(this,void 0,void 0,function(){var r,n,i,a,o,s,u,l,c,d,f;return de(this,function(h){switch(h.label){case 0:r=It(e),n=QOe(r,t),i=void 0,a=void 0,o=void 0,s=l_(n.tokenizer).trim(),h.label=1;case 1:return r.tokenEnd<r.length?(u=l_(n.tokenizer).trim(),u.includes("!NTITLE")?(l=parseInt(u.split(gS)[0]),i=eLe(n,l),[3,7]):[3,2]):[3,8];case 2:return u.includes("!NATOM")?(c=parseInt(u.split(gS)[0]),[4,ZOe(n,c)]):[3,4];case 3:return a=h.sent(),[3,7];case 4:return u.includes("!NBOND")?(d=parseInt(u.split(gS)[0]),[4,JOe(n,d)]):[3,6];case 5:return o=h.sent(),[3,8];case 6:u.includes("!NTHETA")||u.includes("!NPHI")||u.includes("!NIMPHI")||u.includes("!NDON")||u.includes("!NACC")||u.includes("!NNB")||u.includes("!NGRP NST2")||u.includes("!MOLNT")||u.includes("!NUMLP NUMLPH")||u.includes("!NCRTERM"),h.label=7;case 7:return[3,1];case 8:return i===void 0&&(i=[]),a===void 0?[2,wn.error("no atoms data")]:o===void 0?[2,wn.error("no bonds data")]:(f={id:s,title:i,atoms:a,bonds:o},[2,wn.success(f)])}})})}function rLe(e){var t=this;return We.create("Parse PSF",function(r){return ce(t,void 0,void 0,function(){return de(this,function(n){switch(n.label){case 0:return[4,tLe(e,r)];case 1:return[2,n.sent()]}})})})}var ge;(function(e){e.Create=In.factory();function t(s){return!!s&&s.type.typeClass==="Representation3D"}e.isRepresentation3D=t;function r(s){return!!s&&s.type.typeClass==="Behavior"}e.isBehavior=r;function n(s){return e.Create(E(E({},s),{typeClass:"Representation3D"}))}e.CreateRepresentation3D=n;function i(s){return e.Create(E(E({},s),{typeClass:"Behavior"}))}e.CreateBehavior=i;var a=function(s){Le(u,s);function u(){return s!==null&&s.apply(this,arguments)||this}return u}(e.Create({name:"Root",typeClass:"Root"}));e.Root=a;var o=function(s){Le(u,s);function u(){return s!==null&&s.apply(this,arguments)||this}return u}(e.Create({name:"Group",typeClass:"Group"}));e.Group=o,function(s){var u=function(d){Le(f,d);function f(){return d!==null&&d.apply(this,arguments)||this}return f}(e.Create({name:"String Data",typeClass:"Data"}));s.String=u;var l=function(d){Le(f,d);function f(){return d!==null&&d.apply(this,arguments)||this}return f}(e.Create({name:"Binary Data",typeClass:"Data"}));s.Binary=l;var c=function(d){Le(f,d);function f(){return d!==null&&d.apply(this,arguments)||this}return f}(e.Create({name:"Data Blob",typeClass:"Data"}));s.Blob=c}(e.Data||(e.Data={})),function(s){var u=function(g){Le(y,g);function y(){return g!==null&&g.apply(this,arguments)||this}return y}(e.Create({name:"JSON Data",typeClass:"Data"}));s.Json=u;var l=function(g){Le(y,g);function y(){return g!==null&&g.apply(this,arguments)||this}return y}(e.Create({name:"CIF File",typeClass:"Data"}));s.Cif=l;var c=function(g){Le(y,g);function y(){return g!==null&&g.apply(this,arguments)||this}return y}(e.Create({name:"Cube File",typeClass:"Data"}));s.Cube=c;var d=function(g){Le(y,g);function y(){return g!==null&&g.apply(this,arguments)||this}return y}(e.Create({name:"PSF File",typeClass:"Data"}));s.Psf=d;var f=function(g){Le(y,g);function y(){return g!==null&&g.apply(this,arguments)||this}return y}(e.Create({name:"PLY File",typeClass:"Data"}));s.Ply=f;var h=function(g){Le(y,g);function y(){return g!==null&&g.apply(this,arguments)||this}return y}(e.Create({name:"CCP4/MRC/MAP File",typeClass:"Data"}));s.Ccp4=h;var v=function(g){Le(y,g);function y(){return g!==null&&g.apply(this,arguments)||this}return y}(e.Create({name:"DSN6/BRIX File",typeClass:"Data"}));s.Dsn6=v;var p=function(g){Le(y,g);function y(){return g!==null&&g.apply(this,arguments)||this}return y}(e.Create({name:"DX File",typeClass:"Data"}));s.Dx=p;var m=function(g){Le(y,g);function y(){return g!==null&&g.apply(this,arguments)||this}return y}(e.Create({name:"Format Blob",typeClass:"Data"}));s.Blob=m}(e.Format||(e.Format={})),function(s){var u=function(h){Le(v,h);function v(){return h!==null&&h.apply(this,arguments)||this}return v}(e.Create({name:"Coordinates",typeClass:"Object"}));s.Coordinates=u;var l=function(h){Le(v,h);function v(){return h!==null&&h.apply(this,arguments)||this}return v}(e.Create({name:"Topology",typeClass:"Object"}));s.Topology=l;var c=function(h){Le(v,h);function v(){return h!==null&&h.apply(this,arguments)||this}return v}(e.Create({name:"Model",typeClass:"Object"}));s.Model=c;var d=function(h){Le(v,h);function v(){return h!==null&&h.apply(this,arguments)||this}return v}(e.Create({name:"Trajectory",typeClass:"Object"}));s.Trajectory=d;var f=function(h){Le(v,h);function v(){return h!==null&&h.apply(this,arguments)||this}return v}(e.Create({name:"Structure",typeClass:"Object"}));s.Structure=f,function(h){var v=function(g){Le(y,g);function y(){return g!==null&&g.apply(this,arguments)||this}return y}(n({name:"Structure 3D"}));h.Representation3D=v;var p=function(g){Le(y,g);function y(){return g!==null&&g.apply(this,arguments)||this}return y}(e.Create({name:"Structure 3D State",typeClass:"Object"}));h.Representation3DState=p;var m=function(g){Le(y,g);function y(){return g!==null&&g.apply(this,arguments)||this}return y}(e.Create({name:"Selections",typeClass:"Object"}));h.Selections=m}(f=s.Structure||(s.Structure={}))}(e.Molecule||(e.Molecule={})),function(s){var u=function(d){Le(f,d);function f(){return d!==null&&d.apply(this,arguments)||this}return f}(e.Create({name:"Volume",typeClass:"Object"}));s.Data=u;var l=function(d){Le(f,d);function f(){return d!==null&&d.apply(this,arguments)||this}return f}(e.Create({name:"Lazy Volume",typeClass:"Object"}));s.Lazy=l;var c=function(d){Le(f,d);function f(){return d!==null&&d.apply(this,arguments)||this}return f}(n({name:"Volume 3D"}));s.Representation3D=c}(e.Volume||(e.Volume={})),function(s){var u=function(c){Le(d,c);function d(){return c!==null&&c.apply(this,arguments)||this}return d}(e.Create({name:"Shape Provider",typeClass:"Object"}));s.Provider=u;var l=function(c){Le(d,c);function d(){return c!==null&&c.apply(this,arguments)||this}return d}(n({name:"Shape 3D"}));s.Representation3D=l}(e.Shape||(e.Shape={}))})(ge||(ge={}));var kt;(function(e){e.CreateBuiltIn=ft.factory("ms-plugin"),e.BuiltIn=ft.builderFactory("ms-plugin")})(kt||(kt={}));var N9=.529177210859;function nLe(e){var t=It.readLines(e,6),r=function(D,k){var R=+t[D].trim().split(/\s+/g)[k];return Number.isNaN(R)?0:R},n=function(D){var k=r(D+2,0),R=N9;return[Math.abs(k),_.create(r(D+2,1)*R,r(D+2,2)*R,r(D+2,3)*R),k]},i=t[0].trim(),a=t[1].trim(),o=n(0),s=o[0],u=o[1],l=o[2],c=n(1),d=c[0],f=c[1],h=n(2),v=h[0],p=h[1],m=n(3),g=m[0],y=m[1],b=iLe(e,s,N9),S=[];if(l>=0){var x=r(2,4);x===0&&(x=1);for(var C=0;C<x;C++)S.push(C)}else for(var w=It.readLine(e).trim().split(/\s+/g),C=0,A=+w[0];C<A;C++)S.push(+w[C+1]);var M={orbitals:l<0,comment1:i,comment2:a,atomCount:s,origin:u,dim:_.create(d,v,g),basisX:f,basisY:p,basisZ:y,dataSetIds:S};return{header:M,atoms:b}}function iLe(e,t,r){for(var n=new Int32Array(t),i=new Float64Array(t),a=new Float32Array(t),o=new Float32Array(t),s=new Float32Array(t),u=0;u<t;u++){var l=It.readLine(e).trim().split(/\s+/g);n[u]=+l[0],i[u]=+l[1],a[u]=+l[2]*r,o[u]=+l[3]*r,s[u]=+l[4]*r}return{count:t,number:ve.ofArray({array:n,schema:ve.Schema.int}),nuclearCharge:ve.ofArray({array:i,schema:ve.Schema.float}),x:ve.ofArray({array:a,schema:ve.Schema.float}),y:ve.ofArray({array:o,schema:ve.Schema.float}),z:ve.ofArray({array:s,schema:ve.Schema.float})}}function aLe(e,t,r){var n=r.dim[0]*r.dim[1]*r.dim[2]*r.dataSetIds.length,i=100*100*100,a=new Float64Array(n),o=0;return Oc(e,i,a,function(s,u){for(var l=Math.min(n,o+s),c=o;c<l;c++)It.skipWhitespace(t),t.tokenStart=t.position,It.eatValue(t),u[c]=gc(t.data,t.tokenStart,t.tokenEnd);return o=l,l===n?0:i},function(s,u,l){return s.update({current:Math.min(l,n),max:n})})}function oLe(e,t){var r=this;return We.create("Parse Cube",function(n){return ce(r,void 0,void 0,function(){var i,a,o,s,u;return de(this,function(l){switch(l.label){case 0:return[4,n.update("Reading header...")];case 1:return l.sent(),i=It(e),a=nLe(i),o=a.header,s=a.atoms,[4,aLe(n,i,o)];case 2:return u=l.sent(),[2,wn.success({header:o,atoms:s,values:u,name:t})]}})})})}function IQ(e){for(var t={h:_()},r=0,n=0,i=/\s+/g;;){var a=It.readLine(e),o=void 0;if(a.startsWith("object 1"))o=a.split(i),t.dim=_.create(parseInt(o[5]),parseInt(o[6]),parseInt(o[7]));else if(a.startsWith("origin"))o=a.split(i),t.min=_.create(parseFloat(o[1]),parseFloat(o[2]),parseFloat(o[3]));else if(a.startsWith("delta"))o=a.split(i),n===0?t.h[0]=parseFloat(o[1]):n===1?t.h[1]=parseFloat(o[2]):n===2&&(t.h[2]=parseFloat(o[3])),n+=1;else if(a.startsWith("object 3")){r+=a.length+1;break}r+=a.length+1}return{header:t,headerByteCount:r}}function sLe(e,t,r){var n=r.dim[0]*r.dim[1]*r.dim[2],i=100*100*100,a=new Float64Array(n),o=0;return Oc(e,i,a,function(s,u){for(var l=Math.min(n,o+s),c=o;c<l;c++)It.skipWhitespace(t),t.tokenStart=t.position,It.eatValue(t),u[c]=gc(t.data,t.tokenStart,t.tokenEnd);return o=l,l===n?0:i},function(s,u,l){return s.update({current:Math.min(l,n),max:n})})}function uLe(e,t,r){return ce(this,void 0,void 0,function(){var n,i,a;return de(this,function(o){switch(o.label){case 0:return[4,e.update("Reading header...")];case 1:return o.sent(),n=It(t),i=IQ(n).header,[4,e.update("Reading values...")];case 2:return o.sent(),[4,sLe(e,n,i)];case 3:return a=o.sent(),[2,wn.success({header:i,values:a,name:r})]}})})}function lLe(e,t,r){return ce(this,void 0,void 0,function(){var n,i,a,o,s,u,l,c,d;return de(this,function(f){switch(f.label){case 0:return[4,e.update("Reading header...")];case 1:return f.sent(),n=Gk(t,0,1e3),i=It(n),a=IQ(i),o=a.header,s=a.headerByteCount,[4,e.update("Reading values...")];case 2:for(f.sent(),u=o.dim[0]*o.dim[1]*o.dim[2],l=new DataView(t.buffer,t.byteOffset+s),c=new Float64Array(u),d=0;d<u;d++)c[d]=l.getFloat64(d*8,!0);return[2,wn.success({header:o,values:c,name:r})]}})})}function cLe(e,t){return We.create("Parse Cube",function(r){return typeof e=="string"?uLe(r,e,t):lLe(r,e,t)})}var MQ=kt.BuiltIn({name:"download",display:{name:"Download",description:"Download string or binary data from the specified URL"},from:[ge.Root],to:[ge.Data.String,ge.Data.Binary],params:{url:I.Url("https://www.ebi.ac.uk/pdbe/static/entry/1cbs_updated.cif",{description:"Resource URL. Must be the same domain or support CORS."}),label:I.Optional(I.Text("")),isBinary:I.Optional(I.Boolean(!1,{description:"If true, download data as binary (string otherwise)"}))}})({apply:function(e,t){var r=this,n=e.params,i=e.cache;return We.create("Download",function(a){return ce(r,void 0,void 0,function(){var o,s;return de(this,function(u){switch(u.label){case 0:return o=Cn.getUrlAsset(t.managers.asset,n.url),[4,t.managers.asset.resolve(o,n.isBinary?"binary":"string").runInContext(a)];case 1:return s=u.sent(),i.asset=s,[2,n.isBinary?new ge.Data.Binary(s.data,{label:n.label?n.label:o.url}):new ge.Data.String(s.data,{label:n.label?n.label:o.url})]}})})})},dispose:function(e){var t,r,n=e.cache;(r=(t=n)===null||t===void 0?void 0:t.asset)===null||r===void 0||r.dispose()},update:function(e){var t=e.oldParams,r=e.newParams,n=e.b;return t.url!==r.url||t.isBinary!==r.isBinary?ft.UpdateResult.Recreate:t.label!==r.label?(n.label=r.label||(typeof r.url=="string"?r.url:r.url.url),ft.UpdateResult.Updated):ft.UpdateResult.Unchanged}}),DQ=kt.BuiltIn({name:"download-blob",display:{name:"Download Blob",description:"Download multiple string or binary data from the specified URLs."},from:ge.Root,to:ge.Data.Blob,params:{sources:I.ObjectList({id:I.Text("",{label:"Unique ID"}),url:I.Url("https://www.ebi.ac.uk/pdbe/static/entry/1cbs_updated.cif",{description:"Resource URL. Must be the same domain or support CORS."}),isBinary:I.Optional(I.Boolean(!1,{description:"If true, download data as binary (string otherwise)"})),canFail:I.Optional(I.Boolean(!1,{description:"Indicate whether the download can fail and not be included in the blob as a result."}))},function(e){return e.id+": "+e.url}),maxConcurrency:I.Optional(I.Numeric(4,{min:1,max:12,step:1},{description:"The maximum number of concurrent downloads."}))}})({apply:function(e,t){var r=this,n=e.params,i=e.cache;return We.create("Download Blob",function(a){return ce(r,void 0,void 0,function(){var o,s,u,l,c,d;return de(this,function(f){switch(f.label){case 0:return o=[],[4,JAe(a,t.managers.asset,n.sources,n.maxConcurrency||4)];case 1:for(s=f.sent(),u=[],l=0;l<s.length;l++)c=s[l],d=n.sources[l],c.kind==="error"?t.log.warn("Download "+c.id+" ("+d.url+") failed: "+c.error):(u.push(c.result),o.push(d.isBinary?{id:c.id,kind:"binary",data:c.result.data}:{id:c.id,kind:"string",data:c.result.data}));return i.assets=u,[2,new ge.Data.Blob(o,{label:"Data Blob",description:o.length+" "+(o.length===1?"entry":"entries")})]}})})})},dispose:function(e,t){var r,n=e.cache,i=(r=n)===null||r===void 0?void 0:r.assets;if(i)for(var a=0,o=i;a<o.length;a++){var s=o[a];s.dispose()}}}),RQ=kt.BuiltIn({name:"raw-data",display:{name:"Raw Data",description:"Raw data supplied by value."},from:[ge.Root],to:[ge.Data.String,ge.Data.Binary],params:{data:I.Value("",{isHidden:!0}),label:I.Optional(I.Text(""))}})({apply:function(e){var t=this,r=e.params;return We.create("Raw Data",function(){return ce(t,void 0,void 0,function(){return de(this,function(n){if(typeof r.data=="string")return[2,new ge.Data.String(r.data,{label:r.label?r.label:"String"})];if(Array.isArray(r.data))return[2,new ge.Data.Binary(new Uint8Array(r.data),{label:r.label?r.label:"Binary"})];if(r.data instanceof ArrayBuffer)return[2,new ge.Data.Binary(new Uint8Array(r.data),{label:r.label?r.label:"Binary"})];if(r.data instanceof Uint8Array)return[2,new ge.Data.Binary(r.data,{label:r.label?r.label:"Binary"})];throw new Error("Supplied binary data must be a plain array, ArrayBuffer, or Uint8Array.")})})})},update:function(e){var t=e.oldParams,r=e.newParams,n=e.b;return t.data!==r.data?ft.UpdateResult.Recreate:t.label!==r.label?(n.label=r.label||n.label,ft.UpdateResult.Updated):ft.UpdateResult.Unchanged},customSerialization:{toJSON:function(e){if(typeof e.data=="string"||Array.isArray(e.data))return e;if(e.data instanceof ArrayBuffer){for(var t=new Uint8Array(e.data),r=new Array(t.length),n=0,i=t.length;n<i;n++)r[n]=t[n];return{data:r,label:e.label}}else if(e.data instanceof Uint8Array){for(var r=new Array(e.data.length),n=0,i=e.data.length;n<i;n++)r[n]=e.data[n];return{data:r,label:e.label}}},fromJSON:function(e){return e}}}),kQ=kt.BuiltIn({name:"read-file",display:{name:"Read File",description:"Read string or binary data from the specified file"},from:ge.Root,to:[ge.Data.String,ge.Data.Binary],params:{file:I.File(),label:I.Optional(I.Text("")),isBinary:I.Optional(I.Boolean(!1,{description:"If true, open file as as binary (string otherwise)"}))}})({apply:function(e,t){var r=this,n=e.params,i=e.cache;return We.create("Open File",function(a){return ce(r,void 0,void 0,function(){var o,s;return de(this,function(u){switch(u.label){case 0:return n.file===null?(t.log.error("No file(s) selected"),[2,In.Null]):[4,t.managers.asset.resolve(n.file,n.isBinary?"binary":"string").runInContext(a)];case 1:return o=u.sent(),i.asset=o,s=n.isBinary?new ge.Data.Binary(o.data,{label:n.label?n.label:n.file.name}):new ge.Data.String(o.data,{label:n.label?n.label:n.file.name}),[2,s]}})})})},dispose:function(e){var t,r,n=e.cache;(r=(t=n)===null||t===void 0?void 0:t.asset)===null||r===void 0||r.dispose()},update:function(e){var t,r=e.oldParams,n=e.newParams,i=e.b;return r.label!==n.label?(i.label=n.label||((t=r.file)===null||t===void 0?void 0:t.name)||"",ft.UpdateResult.Updated):ft.UpdateResult.Unchanged},isSerializable:function(){return{isSerializable:!1,reason:"Cannot serialize user loaded files."}}}),dLe=kt.BuiltIn({name:"parse-blob",display:{name:"Parse Blob",description:"Parse multiple data enties"},from:ge.Data.Blob,to:ge.Format.Blob,params:{formats:I.ObjectList({id:I.Text("",{label:"Unique ID"}),format:I.Select("cif",[["cif","cif"]])},function(e){return e.id+": "+e.format})}})({apply:function(e,t){var r=this,n=e.a,i=e.params;return We.create("Parse Blob",function(a){return ce(r,void 0,void 0,function(){var o,s,u,l,c,d,f,h,v;return de(this,function(p){switch(p.label){case 0:for(o=new Map,s=0,u=i.formats;s<u.length;s++)l=u[s],o.set(l.id,l.format);c=[],d=0,f=n.data,p.label=1;case 1:return d<f.length?(h=f[d],o.has(h.id)?[4,(h.kind==="string"?Fc.parse(h.data):Fc.parseBinary(h.data)).runInContext(a)]:[3,3]):[3,4];case 2:if(v=p.sent(),v.isError)throw new Error(h.id+": "+v.message);c.push({id:h.id,kind:"cif",data:v.result}),p.label=3;case 3:return d++,[3,1];case 4:return[2,new ge.Format.Blob(c,{label:"Format Blob",description:c.length+" "+(c.length===1?"entry":"entries")})]}})})})}}),fLe=kt.BuiltIn({name:"parse-cif",display:{name:"Parse CIF",description:"Parse CIF from String or Binary data"},from:[ge.Data.String,ge.Data.Binary],to:ge.Format.Cif})({apply:function(e){var t=this,r=e.a;return We.create("Parse CIF",function(n){return ce(t,void 0,void 0,function(){var i;return de(this,function(a){switch(a.label){case 0:return[4,(ge.Data.String.is(r)?Fc.parse(r.data):Fc.parseBinary(r.data)).runInContext(n)];case 1:if(i=a.sent(),i.isError)throw new Error(i.message);return[2,new ge.Format.Cif(i.result)]}})})})}}),hLe=kt.BuiltIn({name:"parse-cube",display:{name:"Parse Cube",description:"Parse Cube from String data"},from:ge.Data.String,to:ge.Format.Cube})({apply:function(e){var t=this,r=e.a;return We.create("Parse Cube",function(n){return ce(t,void 0,void 0,function(){var i;return de(this,function(a){switch(a.label){case 0:return[4,oLe(r.data,r.label).runInContext(n)];case 1:if(i=a.sent(),i.isError)throw new Error(i.message);return[2,new ge.Format.Cube(i.result)]}})})})}}),pLe=kt.BuiltIn({name:"parse-psf",display:{name:"Parse PSF",description:"Parse PSF from String data"},from:[ge.Data.String],to:ge.Format.Psf})({apply:function(e){var t=this,r=e.a;return We.create("Parse PSF",function(n){return ce(t,void 0,void 0,function(){var i;return de(this,function(a){switch(a.label){case 0:return[4,rLe(r.data).runInContext(n)];case 1:if(i=a.sent(),i.isError)throw new Error(i.message);return[2,new ge.Format.Psf(i.result)]}})})})}}),vLe=kt.BuiltIn({name:"parse-ply",display:{name:"Parse PLY",description:"Parse PLY from String data"},from:[ge.Data.String],to:ge.Format.Ply})({apply:function(e){var t=this,r=e.a;return We.create("Parse PLY",function(n){return ce(t,void 0,void 0,function(){var i;return de(this,function(a){switch(a.label){case 0:return[4,XOe(r.data).runInContext(n)];case 1:if(i=a.sent(),i.isError)throw new Error(i.message);return[2,new ge.Format.Ply(i.result,{label:i.result.comments[0]||"PLY Data"})]}})})})}}),mLe=kt.BuiltIn({name:"parse-ccp4",display:{name:"Parse CCP4/MRC/MAP",description:"Parse CCP4/MRC/MAP from Binary data"},from:[ge.Data.Binary],to:ge.Format.Ccp4})({apply:function(e){var t=this,r=e.a;return We.create("Parse CCP4/MRC/MAP",function(n){return ce(t,void 0,void 0,function(){var i;return de(this,function(a){switch(a.label){case 0:return[4,IOe(r.data,r.label).runInContext(n)];case 1:if(i=a.sent(),i.isError)throw new Error(i.message);return[2,new ge.Format.Ccp4(i.result)]}})})})}}),gLe=kt.BuiltIn({name:"parse-dsn6",display:{name:"Parse DSN6/BRIX",description:"Parse CCP4/BRIX from Binary data"},from:[ge.Data.Binary],to:ge.Format.Dsn6})({apply:function(e){var t=this,r=e.a;return We.create("Parse DSN6/BRIX",function(n){return ce(t,void 0,void 0,function(){var i;return de(this,function(a){switch(a.label){case 0:return[4,FOe(r.data,r.label).runInContext(n)];case 1:if(i=a.sent(),i.isError)throw new Error(i.message);return[2,new ge.Format.Dsn6(i.result)]}})})})}}),yLe=kt.BuiltIn({name:"parse-dx",display:{name:"Parse DX",description:"Parse DX from Binary/String data"},from:[ge.Data.Binary,ge.Data.String],to:ge.Format.Dx})({apply:function(e){var t=this,r=e.a;return We.create("Parse DX",function(n){return ce(t,void 0,void 0,function(){var i;return de(this,function(a){switch(a.label){case 0:return[4,cLe(r.data,r.label).runInContext(n)];case 1:if(i=a.sent(),i.isError)throw new Error(i.message);return[2,new ge.Format.Dx(i.result)]}})})})}}),bLe=kt.BuiltIn({name:"import-string",display:{name:"Import String",description:"Import given data as a string"},from:ge.Root,to:ge.Data.String,params:{data:I.Value(""),label:I.Optional(I.Text(""))}})({apply:function(e){var t=e.params,r=t.data,n=t.label;return new ge.Data.String(r,{label:n||""})},update:function(e){var t=e.oldParams,r=e.newParams,n=e.b;return t.data!==r.data?ft.UpdateResult.Recreate:t.label!==r.label?(n.label=r.label||"",ft.UpdateResult.Updated):ft.UpdateResult.Unchanged},isSerializable:function(){return{isSerializable:!1,reason:"Cannot serialize user imported strings."}}}),xLe=kt.BuiltIn({name:"import-json",display:{name:"Import JSON",description:"Import given data as a JSON"},from:ge.Root,to:ge.Format.Json,params:{data:I.Value({}),label:I.Optional(I.Text(""))}})({apply:function(e){var t=e.params,r=t.data,n=t.label;return new ge.Format.Json(r,{label:n||""})},update:function(e){var t=e.oldParams,r=e.newParams,n=e.b;return t.data!==r.data?ft.UpdateResult.Recreate:t.label!==r.label?(n.label=r.label||"",ft.UpdateResult.Updated):ft.UpdateResult.Unchanged},isSerializable:function(){return{isSerializable:!1,reason:"Cannot serialize user imported JSON."}}}),SLe=kt.BuiltIn({name:"parse-json",display:{name:"Parse JSON",description:"Parse JSON from String data"},from:[ge.Data.String],to:ge.Format.Json})({apply:function(e){var t=this,r=e.a;return We.create("Parse JSON",function(n){return ce(t,void 0,void 0,function(){var i;return de(this,function(a){switch(a.label){case 0:return[4,new Response(r.data).json()];case 1:return i=a.sent(),[2,new ge.Format.Json(i)]}})})})}}),CLe=kt.BuiltIn({name:"lazy-volume",display:{name:"Lazy Volume",description:"A placeholder for lazy loaded volume representation"},from:ge.Root,to:ge.Volume.Lazy,params:{url:I.Url(""),isBinary:I.Boolean(!1),format:I.Text("ccp4"),entryId:I.Value("",{isHidden:!0}),isovalues:I.ObjectList({type:I.Text("relative"),value:I.Numeric(0),color:I.Color(dr.black),alpha:I.Numeric(1,{min:0,max:1,step:.01}),volumeIndex:I.Numeric(0)},function(e){return e.type+" "+e.value})}})({apply:function(e){var t=this;e.a;var r=e.params;return We.create("Lazy Volume",function(n){return ce(t,void 0,void 0,function(){var i;return de(this,function(a){return i=Array.isArray(r.entryId)?r.entryId.join(", "):r.entryId,[2,new ge.Volume.Lazy(r,{label:""+(i||r.url),description:"Lazy Volume"})]})})})}});const _Le=Object.freeze(Object.defineProperty({__proto__:null,Download:MQ,DownloadBlob:DQ,ImportJson:xLe,ImportString:bLe,LazyVolume:CLe,ParseBlob:dLe,ParseCcp4:mLe,ParseCif:fLe,ParseCube:hLe,ParseDsn6:gLe,ParseDx:yLe,ParseJson:SLe,ParsePly:vLe,ParsePsf:pLe,RawData:RQ,ReadFile:kQ},Symbol.toStringTag,{value:"Module"}));var wLe=kt.BuiltIn({name:"create-group",display:{name:"Group"},from:[],to:ge.Group,params:{label:I.Text("Group"),description:I.Optional(I.Text(""))}})({apply:function(e){var t=e.params;return new ge.Group({},t)},update:function(e){var t=e.oldParams,r=e.newParams,n=e.b;return xg(t,r)?ft.UpdateResult.Unchanged:(n.label=r.label,n.description=r.description,ft.UpdateResult.Updated)}});const ELe=Object.freeze(Object.defineProperty({__proto__:null,CreateGroup:wLe},Symbol.toStringTag,{value:"Module"}));function ALe(e){var t=new DataView(e.buffer),r=Object.create(null),n=[],i=0,a=new Int32Array(e.buffer,0,23),o=a[0]!==t.getInt32(0);if(a[0]!==84)for(var s=e.byteLength,u=0;u<s;u+=4)t.setFloat32(u,t.getFloat32(u),!0);if(a[0]!==84)throw new Error("dcd bad format, header block start");var l=String.fromCharCode(t.getUint8(4),t.getUint8(5),t.getUint8(6),t.getUint8(7));if(l!=="CORD")throw new Error("dcd bad format, format string");var c=!1,d=!1,f=!1;if(a[22]!==0&&(c=!0,a[12]!==0&&(d=!0),a[13]===1&&(f=!0)),r.NSET=a[2],r.ISTART=a[3],r.NSAVC=a[4],r.NAMNF=a[10],c?r.DELTA=t.getFloat32(44,o):r.DELTA=t.getFloat64(44,o),a[22]!==84)throw new Error("dcd bad format, header block end");i=i+21*4+8;var h=t.getInt32(i,o),v=i+1;if((h-4)%80!==0)throw new Error("dcd bad format, title block start");if(r.TITLE=bIe(e.subarray(v,h)),t.getInt32(v+h+4-1,o)!==h)throw new Error("dcd bad format, title block end");if(i=i+h+8,t.getInt32(i,o)!==4)throw new Error("dcd bad format, natom block start");if(r.NATOM=t.getInt32(i+4,o),t.getInt32(i+8,o)!==4)throw new Error("dcd bad format, natom block end");if(i=i+4+8,r.NAMNF>0)throw new Error("dcd format with fixed atoms unsupported, aborting");for(var p=r.NATOM,m=p*4,u=0,s=r.NSET;u<s;++u){var g=Object.create(null);g.elementCount=p,d&&(i+=4,g.cell=[t.getFloat64(i,o),t.getFloat64(i+1,o),t.getFloat64(i+2*8,o),t.getFloat64(i+3*8,o),t.getFloat64(i+4*8,o),t.getFloat64(i+5*8,o)],i+=48,i+=4);for(var y=0;y<3;++y){if(t.getInt32(i,o)!==m)throw new Error("dcd bad format, coord block start: "+u+", "+y);i+=4;var b=new Float32Array(e.buffer,i,p);if(y===0?g.x=b:y===1?g.y=b:g.z=b,i+=m,t.getInt32(i,o)!==m)throw new Error("dcd bad format, coord block end: "+u+", "+y);i+=4}if(f){var S=t.getInt32(i,o);i+=4+S+4}n.push(g)}return{header:r,frames:n}}function PLe(e){var t=this;return We.create("Parse DCD",function(r){return ce(t,void 0,void 0,function(){var n;return de(this,function(i){try{return n=ALe(e),[2,wn.success(n)]}catch(a){return[2,wn.error(a)]}return[2]})})})}function TLe(e){return function(t,r,n){return ILe(e,t,r,n)}}function ILe(e,t,r,n){var i=e.data,a=e.indices,o=e.count,s=n.valueType,u=s==="str"?function(l){var c=a[2*l]+t,d=a[2*l+1];if(c>=d)return"";var f=c+r;return f>d&&(f=d),K4e(i,c,f)}:s==="int"?function(l){var c=a[2*l]+t;return c>a[2*l+1]?0:qh(i,c,c+r)}:function(l){var c=a[2*l]+t;return c>a[2*l+1]?0:z_e(i,c,c+r)};return{schema:n,__array:void 0,isDefined:!0,rowCount:o,value:u,valueKind:function(l){return 0},toArray:function(l){return Qi(o,u,l)},areValuesEqual:function(l,c){return u(l)===u(c)}}}function MLe(){return{title:"",timeInPs:0,hasVelocities:!1,precision:{position:0,velocity:0},box:[0,0,0]}}function DLe(e,t){return{tokenizer:e,header:MLe(),numberOfAtoms:0,runtimeCtx:t}}function RLe(e){var t=e.tokenizer,r=e.header,n=It.readLine(t);n.trim().length===0&&(n=It.readLine(t));var i=n.lastIndexOf("t=");i>=0?(r.timeInPs=parseFloat(n.substring(i+2)),r.title=n.substring(0,i).trim(),r.title&&r.title[r.title.length-1]===","&&(r.title=r.title.substring(0,r.title.length-1))):r.title=n}function kLe(e){var t=e.tokenizer;It.markLine(t);var r=It.getTokenString(t);e.numberOfAtoms=parseInt(r)}function OLe(e){return ce(this,void 0,void 0,function(){var t,r,n,i,a,o,s,u,l,c,d,f,h;return de(this,function(v){switch(v.label){case 0:return t=e.tokenizer,r=e.numberOfAtoms,[4,It.readLinesAsync(t,r,e.runtimeCtx,1e5)];case 1:return n=v.sent(),i=t.data.substring(n.indices[0],n.indices[1]).substring(20),a=i.match(/\.\d+/g),o=a.length===6,e.header.hasVelocities=o,e.header.precision.position=a[0].length-1,e.header.precision.velocity=o?a[3].length-1:0,s=20,u=e.header.precision.position+5,l=s+3*u,c=e.header.precision.velocity+4,d=TLe(n),f=ve.Undefined(e.numberOfAtoms,ve.Schema.float),h={count:e.numberOfAtoms,residueNumber:d(0,5,ve.Schema.int),residueName:d(5,5,ve.Schema.str),atomName:d(10,5,ve.Schema.str),atomNumber:d(15,5,ve.Schema.int),x:d(s,u,ve.Schema.float),y:d(s+u,u,ve.Schema.float),z:d(s+2*u,u,ve.Schema.float),vx:o?d(l,c,ve.Schema.float):f,vy:o?d(l+c,c,ve.Schema.float):f,vz:o?d(l+2*c,c,ve.Schema.float):f},[2,h]}})})}function LLe(e){var t=e.tokenizer,r=It.readLine(t).trim().split(/\s+/g);e.header.box=[+r[0],+r[1],+r[2]]}function NLe(e,t){return ce(this,void 0,void 0,function(){var r,n,i,a,o;return de(this,function(s){switch(s.label){case 0:return r=It(e),[4,t.update({message:"Parsing...",current:0,max:e.length})];case 1:s.sent(),n=[],s.label=2;case 2:return r.position<e.length?(i=DLe(r,t),RLe(i),kLe(i),[4,OLe(i)]):[3,4];case 3:return a=s.sent(),LLe(i),n.push({header:i.header,atoms:a}),[3,2];case 4:return o={structures:n},[2,wn.success(o)]}})})}function FLe(e){var t=this;return We.create("Parse GRO",function(r){return ce(t,void 0,void 0,function(){return de(this,function(n){switch(n.label){case 0:return[4,NLe(e,r)];case 1:return[2,n.sent()]}})})})}function BLe(e,t,r){var n=this;return r===void 0&&(r=!1),We.create("Parse PDB",function(i){return ce(n,void 0,void 0,function(){var a,o,s;return de(this,function(u){switch(u.label){case 0:return o=(a=wn).success,s={},[4,It.readAllLinesAsync(e,i)];case 1:return[2,o.apply(a,[(s.lines=u.sent(),s.id=t,s.isPdbqt=r,s)])]}})})})}function ULe(e,t){for(var r=0,n=t*3;r<n;r+=3){var i=e[r],a=e[r+1],o=e[r+2],s=1/Math.sqrt(i*i+a*a+o*o);e[r]=i*s,e[r+1]=a*s,e[r+2]=o*s}return e}var co=_();function Qp(e,t,r,n){for(var i=0,a=n*3;i<a;i+=3)_.fromArray(co,t,r+i),_.transformMat4(co,co,e),_.toArray(co,t,r+i)}function jLe(e,t,r,n){for(var i=0,a=n*3;i<a;i+=3)_.fromArray(co,t,r+i),_.transformMat3(co,co,e),_.toArray(co,t,r+i)}function zLe(e,t){for(var r=0,n=e.length;r<n;r+=3)_.fromArray(co,e,r),_.normalize(co,co),_.scale(co,co,t),_.toArray(co,e,r)}var F9=_(),LP=_(),B9=_(),ss=_(),U9=_();function OQ(e,t,r,n,i){for(var a=0,o=i*3;a<o;a+=3){var s=t[a]*3,u=t[a+1]*3,l=t[a+2]*3;_.fromArray(F9,e,s),_.fromArray(LP,e,u),_.fromArray(B9,e,l),_.sub(ss,B9,LP),_.sub(U9,F9,LP),_.cross(ss,ss,U9),r[s]+=ss[0],r[s+1]+=ss[1],r[s+2]+=ss[2],r[u]+=ss[0],r[u+1]+=ss[1],r[u+2]+=ss[2],r[l]+=ss[0],r[l+1]+=ss[1],r[l+2]+=ss[2]}return ULe(r,n)}function Jg(e,t,r){r===void 0&&(r=1);for(var n=Cl(e),i=new Int32Array(n+2),a=new Int32Array(t),o=new Int32Array(t),s=0,u=t*r;s<u;s+=r)++o[e[s]];for(var l=0,s=0;s<t;s++)i[s]=l,l+=o[s];i[t]=l;for(var c=new Int32Array(l),s=0,u=t*r;s<u;s+=r){var d=e[s],f=i[d]+a[d];c[f]=s,++a[d]}return{indices:c,offsets:i}}function VLe(e,t){e=Math.max(e,2);var r=Math.sqrt(e),n=Math.ceil(r);n=n+(t-n%t)%t;var i=n>0?Math.ceil(e/n):0;return{width:n,height:i,length:n*i*t}}function pa(e,t,r,n){var i=VLe(e,t),a=i.length,o=i.width,s=i.height;return n=n&&n.length>=a?n:new r(a),{array:n,width:o,height:s}}var bs=_(),HLe=new rs("14"),GLe=new rs("98");function LQ(e){return e>1e5?HLe:GLe}function Qf(e,t,r){var n=r*3,i=LQ(t);i.reset();for(var a=0,o=t*3;a<o;a+=n)_.fromArray(bs,e,a),i.includePosition(bs);i.finishedIncludeStep();for(var a=0,o=t*3;a<o;a+=n)_.fromArray(bs,e,a),i.radiusPosition(bs);var s=i.getSphere();if(t<=98){for(var u=[],a=0,o=t*3;a<o;a+=n)u.push(_.fromArray(_(),e,a));Fe.setExtrema(s,u)}return s}var NP=ue();function Vi(e,t,r){if(r===1){ue.fromArray(NP,t,0);var n=Fe.clone(e);return ue.isIdentity(NP)?n:Fe.transform(n,n,NP)}var i=LQ(r);i.reset();var a=e.center,o=e.radius,s=e.extrema;if(s&&r<50){for(var u=0,l=r;u<l;++u)for(var c=0,d=s;c<d.length;c++){var f=d[c];_.transformMat4Offset(bs,f,t,0,0,u*16),i.includePosition(bs)}i.finishedIncludeStep();for(var u=0,l=r;u<l;++u)for(var h=0,v=s;h<v.length;h++){var f=v[h];_.transformMat4Offset(bs,f,t,0,0,u*16),i.radiusPosition(bs)}}else{for(var u=0,l=r;u<l;++u)_.transformMat4Offset(bs,a,t,0,0,u*16),i.includePositionRadius(bs,o);i.finishedIncludeStep();for(var u=0,l=r;u<l;++u)_.transformMat4Offset(bs,a,t,0,0,u*16),i.radiusPositionRadius(bs,o)}return i.getSphere()}function Hs(e,t){var r=pa(Math.max(1,e),1,Uint8Array,t&&t.tMarker.ref.value.array);return t?(N.update(t.tMarker,r),N.update(t.uMarkerTexDim,He.create(r.width,r.height)),t):{tMarker:N.create(r),uMarkerTexDim:N.create(He.create(r.width,r.height))}}var NQ=new ArrayBuffer(4),qLe=new Int32Array(NQ),WLe=new Float32Array(NQ);function $Le(e){var t=e<-126?-126:e;return qLe[0]=(1<<23)*(t+126.94269504),WLe[0]}function XLe(e){return $Le(1.44269504*e)}var FQ=new ArrayBuffer(4),YLe=new Int32Array(FQ),KLe=new Float32Array(FQ);function QLe(e){KLe[0]=e;var t=YLe[0]*11920928955078125e-23;return t-126.94269504}function ZLe(e){return .6931471805599453*QLe(e)}var JLe=1e4;ZLe(JLe+1);function Db(e,t,r){return e=Ia(e,0,16777216-1)+1,t[r+2]=e%256,e=Math.floor(e/256),t[r+1]=e%256,e=Math.floor(e/256),t[r]=e%256,t}function _O(e,t,r){return Math.floor(e)*256*256+Math.floor(t)*256+Math.floor(r)-1}var K2=255/256,FP=_.create(256*256*256,256*256,256),e6e=_r.create(K2/FP[0],K2/FP[1],K2/FP[2],K2/1),j9=_r();function t6e(e,t,r,n){return _r.set(j9,e/255,t/255,r/255,n/255),_r.dot(j9,e6e)}function nd(e,t,r){switch(ra.getGranularity(e,t.granularity)){case"uniform":return a6e(e,t.size,r);case"group":return s6e(e,t.size,r);case"groupInstance":return u6e(e,t.size,r);case"instance":return o6e(e,t.size,r)}}var L3=100;function tb(e){var t=e.dSizeType.ref.value;switch(t){case"uniform":return e.uSize.ref.value;case"instance":case"group":case"groupInstance":for(var r=0,n=e.tSize.ref.value.array,i=0,a=n.length;i<a;i+=3){var o=_O(n[i],n[i+1],n[i+2]);r<o&&(r=o)}return r/L3}}var r6e={array:new Uint8Array(3),width:1,height:1};function n6e(){return{tSize:N.create(r6e),uSizeTexDim:N.create(He.create(1,1))}}function i6e(e,t){return t?(N.update(t.uSize,e),N.updateIfChanged(t.dSizeType,"uniform"),t):E(E({uSize:N.create(e)},n6e()),{dSizeType:N.create("uniform")})}function a6e(e,t,r){return i6e(t(Ko),r)}function wO(e,t,r){return r?(N.update(r.tSize,e),N.update(r.uSizeTexDim,He.create(e.width,e.height)),N.updateIfChanged(r.dSizeType,t),r):{uSize:N.create(0),tSize:N.create(e),uSizeTexDim:N.create(He.create(e.width,e.height)),dSizeType:N.create(t)}}function o6e(e,t,r){var n=e.instanceCount,i=pa(Math.max(1,n),3,Uint8Array,r&&r.tSize.ref.value.array);for(e.reset();e.hasNext&&!e.isNextNewInstance;){var a=e.move();Db(t(a.location)*L3,i.array,a.instanceIndex*3),e.skipInstance()}return wO(i,"instance",r)}function s6e(e,t,r){var n=e.groupCount,i=pa(Math.max(1,n),3,Uint8Array,r&&r.tSize.ref.value.array);for(e.reset();e.hasNext&&!e.isNextNewInstance;){var a=e.move();Db(t(a.location)*L3,i.array,a.groupIndex*3)}return wO(i,"group",r)}function u6e(e,t,r){var n=e.groupCount,i=e.instanceCount,a=i*n,o=pa(Math.max(1,a),3,Uint8Array,r&&r.tSize.ref.value.array);for(e.reset();e.hasNext;){var s=e.move();Db(t(s.location)*L3,o.array,s.index*3)}return wO(o,"groupInstance",r)}function l6e(e,t,r,n){for(var i=t;i<r;++i)at.toArray(n,e,i*4),e[i*4+3]=255;return!0}function z9(e,t,r){return e.fill(0,t*4,r*4),!0}function c6e(e,t){var r=pa(Math.max(1,e),4,Uint8Array,t&&t.tOverpaint.ref.value.array);return t?(N.update(t.tOverpaint,r),N.update(t.uOverpaintTexDim,He.create(r.width,r.height)),N.updateIfChanged(t.dOverpaint,e>0),t):{tOverpaint:N.create(r),uOverpaintTexDim:N.create(He.create(r.width,r.height)),dOverpaint:N.create(e>0)}}var V9={array:new Uint8Array(4),width:1,height:1};function id(e){return e?(N.update(e.tOverpaint,V9),N.update(e.uOverpaintTexDim,He.create(1,1)),e):{tOverpaint:N.create(V9),uOverpaintTexDim:N.create(He.create(1,1)),dOverpaint:N.create(!1)}}function d6e(e,t,r,n){for(var i=t;i<r;++i)e[i]=n*255;return!0}function BQ(e,t){for(var r=0,n=0;n<t;++n)r+=e[n];return r/(255*t)}function f6e(e,t,r){e.fill(0,t,r)}function h6e(e,t){var r=pa(Math.max(1,e),1,Uint8Array,t&&t.tTransparency.ref.value.array);return t?(N.update(t.tTransparency,r),N.update(t.uTransparencyTexDim,He.create(r.width,r.height)),N.updateIfChanged(t.dTransparency,e>0),N.updateIfChanged(t.transparencyAverage,BQ(r.array,e)),t):{tTransparency:N.create(r),uTransparencyTexDim:N.create(He.create(r.width,r.height)),dTransparency:N.create(e>0),transparencyAverage:N.create(0)}}var H9={array:new Uint8Array(1),width:1,height:1};function ad(e){return e?(N.update(e.tTransparency,H9),N.update(e.uTransparencyTexDim,He.create(1,1)),e):{tTransparency:N.create(H9),uTransparencyTexDim:N.create(He.create(1,1)),dTransparency:N.create(!1),transparencyAverage:N.create(0)}}function p6e(e,t,r,n){for(var i=t;i<r;++i)e[i]=n;return!0}function v6e(e,t,r){e.fill(0,t,r)}function m6e(e,t){var r=pa(Math.max(1,e),1,Uint8Array,t&&t.tClipping.ref.value.array);return t?(N.update(t.tClipping,r),N.update(t.uClippingTexDim,He.create(r.width,r.height)),N.updateIfChanged(t.dClipping,e>0),t):{dClipObjectCount:N.create(0),dClipVariant:N.create("instance"),tClipping:N.create(r),uClippingTexDim:N.create(He.create(r.width,r.height)),dClipping:N.create(e>0)}}var G9={array:new Uint8Array(1),width:1,height:1};function od(e){return e?(N.update(e.tClipping,G9),N.update(e.uClippingTexDim,He.create(1,1)),e):{dClipObjectCount:N.create(0),dClipVariant:N.create("instance"),tClipping:N.create(G9),uClippingTexDim:N.create(He.create(1,1)),dClipping:N.create(!1)}}var Zp;(function(e){function t(v,p,m,g){return g?a(v,p,m,g):i(v,p,m)}e.create=t;function r(v){var p=v?v.centerBuffer.ref.value:new Float32Array(0),m=v?v.groupBuffer.ref.value:new Float32Array(0);return t(p,m,0,v)}e.createEmpty=r;function n(v){return La([v.pointCount,v.centerBuffer.ref.version,v.groupBuffer.ref.version])}function i(v,p,m){var g=Fe(),y,b=-1,S=-1,x={kind:"points",pointCount:m,centerBuffer:N.create(v),groupBuffer:N.create(p),get boundingSphere(){var C=n(x);if(C!==b){var w=Qf(x.centerBuffer.ref.value,x.pointCount,1);Fe.copy(g,w),b=C}return g},get groupMapping(){return x.groupBuffer.ref.version!==S&&(y=Jg(x.groupBuffer.ref.value,x.pointCount),S=x.groupBuffer.ref.version),y},setBoundingSphere:function(C){Fe.copy(g,C),b=n(x)}};return x}function a(v,p,m,g){return g.pointCount=m,N.update(g.centerBuffer,v),N.update(g.groupBuffer,p),g}function o(v,p){var m=v.centerBuffer.ref.value;Qp(p,m,0,v.pointCount),N.update(v.centerBuffer,m)}e.transform=o,e.Params=E(E({},Et.Params),{sizeFactor:I.Numeric(1.5,{min:0,max:10,step:.1}),pointSizeAttenuation:I.Boolean(!1),pointFilledCircle:I.Boolean(!1),pointEdgeBleach:I.Numeric(.2,{min:0,max:1,step:.05})}),e.Utils={Params:e.Params,createEmpty:r,createValues:u,createValuesSimple:l,updateValues:c,updateBoundingSphere:d,createRenderableState:f,updateRenderableState:h,createPositionIterator:s};function s(v,p){var m=v.pointCount,g=p.instanceCount.ref.value,y=pv(),b=y.position,S=v.centerBuffer.ref.value,x=p.aTransform.ref.value,C=function(w,A){return A<0?_.fromArray(b,S,w*3):_.transformMat4Offset(b,S,x,0,w*3,A*16),y};return mn(m,g,1,C)}function u(v,p,m,g,y){var b=m.instanceCount,S=m.groupCount,x=s(v,p),C=ns(m,x,g.color),w=nd(m,g.size),A=Hs(b*S),M=id(),D=ad(),k=od(),R={drawCount:v.pointCount,vertexCount:v.pointCount,groupCount:S,instanceCount:b},L=Fe.clone(v.boundingSphere),H=Vi(L,p.aTransform.ref.value,b);return E(E(E(E(E(E(E(E(E({aPosition:v.centerBuffer,aGroup:v.groupBuffer,boundingSphere:N.create(H),invariantBoundingSphere:N.create(L),uInvariantBoundingSphere:N.create(_r.ofSphere(L))},C),w),A),M),D),k),p),Et.createValues(y,R)),{uSizeFactor:N.create(y.sizeFactor),dPointSizeAttenuation:N.create(y.pointSizeAttenuation),dPointFilledCircle:N.create(y.pointFilledCircle),uPointEdgeBleach:N.create(y.pointEdgeBleach)})}function l(v,p,m,g,y){var b=Et.createSimple(m,g,y),S=E(E({},I.getDefaultValues(e.Params)),p);return u(v,b.transform,b.locationIterator,b.theme,S)}function c(v,p){Et.updateValues(v,p),N.updateIfChanged(v.uSizeFactor,p.sizeFactor),N.updateIfChanged(v.dPointSizeAttenuation,p.pointSizeAttenuation),N.updateIfChanged(v.dPointFilledCircle,p.pointFilledCircle),N.updateIfChanged(v.uPointEdgeBleach,p.pointEdgeBleach)}function d(v,p){var m=Fe.clone(p.boundingSphere),g=Vi(m,v.aTransform.ref.value,v.instanceCount.ref.value);Fe.equals(g,v.boundingSphere.ref.value)||N.update(v.boundingSphere,g),Fe.equals(m,v.invariantBoundingSphere.ref.value)||(N.update(v.invariantBoundingSphere,m),N.update(v.uInvariantBoundingSphere,_r.fromSphere(v.uInvariantBoundingSphere.ref.value,m)))}function f(v){var p=Et.createRenderableState(v);return h(p,v),p}function h(v,p){Et.updateRenderableState(v,p),v.opaque=v.opaque&&(!p.pointFilledCircle||p.pointFilledCircle&&p.pointEdgeBleach===0),v.writeDepth=v.opaque}})(Zp||(Zp={}));function q9(e,t,r,n,i,a,o){for(var s=0;s<t;s++){for(var u=0;u<r;u++)n[u]=e[u*t+s];W9(n,i,a,o,r);for(var u=0;u<r;u++)e[u*t+s]=i[u]}for(var u=0;u<r;u++){for(var s=0;s<t;s++)n[s]=e[u*t+s];W9(n,i,a,o,t);for(var s=0;s<t;s++)e[u*t+s]=Math.sqrt(i[s])}}function W9(e,t,r,n,i){r[0]=0,n[0]=Number.MIN_SAFE_INTEGER,n[1]=Number.MAX_SAFE_INTEGER;for(var a=1,o=0;a<i;a++){for(var s=(e[a]+a*a-(e[r[o]]+r[o]*r[o]))/(2*a-2*r[o]);s<=n[o];)o--,s=(e[a]+a*a-(e[r[o]]+r[o]*r[o]))/(2*a-2*r[o]);o++,r[o]=a,n[o]=s,n[o+1]=Number.MAX_SAFE_INTEGER}for(var a=0,o=0;a<i;a++){for(;n[o+1]<a;)o++;t[a]=(a-r[o])*(a-r[o])+e[r[o]]}}var BP={};function g6e(e){var t=JSON.stringify(e);return BP[t]===void 0&&(BP[t]=new y6e(e)),BP[t]}var UQ={fontFamily:I.Select("sans-serif",[["sans-serif","Sans Serif"],["monospace","Monospace"],["serif","Serif"],["cursive","Cursive"]]),fontQuality:I.Select(3,[[0,"lower"],[1,"low"],[2,"medium"],[3,"high"],[4,"higher"]]),fontStyle:I.Select("normal",[["normal","Normal"],["italic","Italic"],["oblique","Oblique"]]),fontVariant:I.Select("normal",[["normal","Normal"],["small-caps","Small Caps"]]),fontWeight:I.Select("normal",[["normal","Normal"],["bold","Bold"]])},y6e=function(){function e(t){t===void 0&&(t={}),this.mapped={},this.scratchW=0,this.scratchH=0,this.currentX=0,this.currentY=0,this.cutoff=.5;var r=E(E({},I.getDefaultValues(UQ)),t);this.props=r;var n=32*(r.fontQuality+1);this.buffer=n/8,this.radius=n/3,this.lineHeight=Math.round(n+2*this.buffer+this.radius),this.maxWidth=Math.round(this.lineHeight*.75),this.texture=pa(350*this.lineHeight*this.maxWidth,1,Uint8Array),this.scratchCanvas=document.createElement("canvas"),this.scratchCanvas.width=this.maxWidth,this.scratchCanvas.height=this.lineHeight,this.scratchContext=this.scratchCanvas.getContext("2d"),this.scratchContext.font=r.fontStyle+" "+r.fontVariant+" "+r.fontWeight+" "+n+"px "+r.fontFamily,this.scratchContext.fillStyle="black",this.scratchContext.textBaseline="middle",this.scratchData=new Uint8Array(this.lineHeight*this.maxWidth),this.gridOuter=new Float64Array(this.lineHeight*this.maxWidth),this.gridInner=new Float64Array(this.lineHeight*this.maxWidth),this.f=new Float64Array(Math.max(this.lineHeight,this.maxWidth)),this.d=new Float64Array(Math.max(this.lineHeight,this.maxWidth)),this.z=new Float64Array(Math.max(this.lineHeight,this.maxWidth)+1),this.v=new Int16Array(Math.max(this.lineHeight,this.maxWidth)),this.middle=Math.ceil(this.lineHeight/2),this.placeholder=this.get(String.fromCharCode(65533))}return e.prototype.get=function(t){if(this.mapped[t]===void 0){this.draw(t);var r=this.texture,n=r.array,i=r.width,a=r.height,o=this.scratchData;if(this.currentX+this.scratchW>i&&(this.currentX=0,this.currentY+=this.scratchH),this.currentY+this.scratchH>a)return console.warn("canvas to small"),this.placeholder;this.mapped[t]={x:this.currentX,y:this.currentY,w:this.scratchW,h:this.scratchH,nw:this.scratchW/this.lineHeight,nh:this.scratchH/this.lineHeight};for(var s=0;s<this.scratchH;++s)for(var u=0;u<this.scratchW;++u)n[i*(this.currentY+s)+this.currentX+u]=o[s*this.scratchW+u];this.currentX+=this.scratchW}return this.mapped[t]},e.prototype.draw=function(t){var r=this.lineHeight,n=this.scratchContext,i=this.scratchData,a=n.measureText(t),o=Math.min(this.maxWidth,Math.ceil(a.width+2*this.buffer)),s=o*r;n.clearRect(0,0,o,r),n.fillText(t,this.buffer,this.middle);for(var u=n.getImageData(0,0,o,r),l=0;l<s;l++){var c=u.data[l*4+3]/255;this.gridOuter[l]=c===1?0:c===0?Number.MAX_SAFE_INTEGER:Math.pow(Math.max(0,.5-c),2),this.gridInner[l]=c===1?Number.MAX_SAFE_INTEGER:c===0?0:Math.pow(Math.max(0,c-.5),2)}q9(this.gridOuter,o,r,this.f,this.d,this.v,this.z),q9(this.gridInner,o,r,this.f,this.d,this.v,this.z);for(var l=0;l<s;l++){var d=this.gridOuter[l]-this.gridInner[l];i[l]=Math.max(0,Math.min(255,Math.round(255-255*(d/this.radius+this.cutoff))))}this.scratchW=o,this.scratchH=r},e}(),Bs;(function(e){function t(h,v,p,m,g,y,b,S,x){return x?a(h,v,p,m,g,y,b,S,x):i(h,v,p,m,g,y,b,S)}e.create=t;function r(h){var v=h?h.fontTexture.ref.value:pa(0,1,Uint8Array),p=h?h.centerBuffer.ref.value:new Float32Array(0),m=h?h.mappingBuffer.ref.value:new Float32Array(0),g=h?h.depthBuffer.ref.value:new Float32Array(0),y=h?h.indexBuffer.ref.value:new Uint32Array(0),b=h?h.groupBuffer.ref.value:new Float32Array(0),S=h?h.tcoordBuffer.ref.value:new Float32Array(0);return t(v,p,m,g,y,b,S,0,h)}e.createEmpty=r;function n(h){return La([h.charCount,h.fontTexture.ref.version,h.centerBuffer.ref.version,h.mappingBuffer.ref.version,h.depthBuffer.ref.version,h.indexBuffer.ref.version,h.groupBuffer.ref.version,h.tcoordBuffer.ref.version])}function i(h,v,p,m,g,y,b,S){var x=Fe(),C,w=-1,A=-1,M={kind:"text",charCount:S,fontTexture:N.create(h),centerBuffer:N.create(v),mappingBuffer:N.create(p),depthBuffer:N.create(m),indexBuffer:N.create(g),groupBuffer:N.create(y),tcoordBuffer:N.create(b),get boundingSphere(){var D=n(M);if(D!==w){var k=Qf(M.centerBuffer.ref.value,M.charCount*4,4);Fe.copy(x,k),w=D}return x},get groupMapping(){return M.groupBuffer.ref.version!==A&&(C=Jg(M.groupBuffer.ref.value,M.charCount,4),A=M.groupBuffer.ref.version),C},setBoundingSphere:function(D){Fe.copy(x,D),w=n(M)}};return M}function a(h,v,p,m,g,y,b,S,x){return x.charCount=S,N.update(x.fontTexture,h),N.update(x.centerBuffer,v),N.update(x.mappingBuffer,p),N.update(x.depthBuffer,m),N.update(x.indexBuffer,g),N.update(x.groupBuffer,y),N.update(x.tcoordBuffer,b),x}e.Params=E(E(E({},Et.Params),UQ),{sizeFactor:I.Numeric(1,{min:0,max:10,step:.1}),borderWidth:I.Numeric(0,{min:0,max:.5,step:.01}),borderColor:I.Color(dr.grey),offsetX:I.Numeric(0,{min:0,max:10,step:.1}),offsetY:I.Numeric(0,{min:0,max:10,step:.1}),offsetZ:I.Numeric(0,{min:0,max:10,step:.1}),background:I.Boolean(!1),backgroundMargin:I.Numeric(.2,{min:0,max:1,step:.01}),backgroundColor:I.Color(dr.grey),backgroundOpacity:I.Numeric(1,{min:0,max:1,step:.01}),tether:I.Boolean(!1),tetherLength:I.Numeric(1,{min:0,max:5,step:.1}),tetherBaseWidth:I.Numeric(.3,{min:0,max:1,step:.01}),attachment:I.Select("middle-center",[["bottom-left","bottom-left"],["bottom-center","bottom-center"],["bottom-right","bottom-right"],["middle-left","middle-left"],["middle-center","middle-center"],["middle-right","middle-right"],["top-left","top-left"],["top-center","top-center"],["top-right","top-right"]])}),e.Utils={Params:e.Params,createEmpty:r,createValues:s,createValuesSimple:u,updateValues:l,updateBoundingSphere:c,createRenderableState:d,updateRenderableState:f,createPositionIterator:o};function o(h,v){var p=h.charCount*4,m=v.instanceCount.ref.value,g=pv(),y=g.position,b=h.centerBuffer.ref.value,S=v.aTransform.ref.value,x=function(C,w){return w<0?_.fromArray(y,b,C*3):_.transformMat4Offset(y,b,S,0,C*3,w*16),g};return mn(p,m,4,x)}function s(h,v,p,m,g){var y=p.instanceCount,b=p.groupCount,S=o(h,v),x=ns(p,S,m.color),C=nd(p,m.size),w=Hs(y*b),A=id(),M=ad(),D=od(),k={drawCount:h.charCount*2*3,vertexCount:h.charCount*4,groupCount:b,instanceCount:y},R=$9(h.mappingBuffer.ref.value,h.depthBuffer.ref.value,h.charCount,tb(C)),L=Fe.expand(Fe(),h.boundingSphere,R),H=Vi(L,v.aTransform.ref.value,y);return E(E(E(E(E(E(E(E(E(E({aPosition:h.centerBuffer,aMapping:h.mappingBuffer,aDepth:h.depthBuffer,aGroup:h.groupBuffer,elements:h.indexBuffer,boundingSphere:N.create(H),invariantBoundingSphere:N.create(L),uInvariantBoundingSphere:N.create(_r.ofSphere(L))},x),C),w),A),M),D),v),{aTexCoord:h.tcoordBuffer,tFont:h.fontTexture,padding:N.create(R)}),Et.createValues(g,k)),{uSizeFactor:N.create(g.sizeFactor),uBorderWidth:N.create(Ia(g.borderWidth/2,0,.5)),uBorderColor:N.create(at.toArrayNormalized(g.borderColor,_.zero(),0)),uOffsetX:N.create(g.offsetX),uOffsetY:N.create(g.offsetY),uOffsetZ:N.create(g.offsetZ),uBackgroundColor:N.create(at.toArrayNormalized(g.backgroundColor,_.zero(),0)),uBackgroundOpacity:N.create(g.backgroundOpacity)})}function u(h,v,p,m,g){var y=Et.createSimple(p,m,g),b=E(E({},I.getDefaultValues(e.Params)),v);return s(h,y.transform,y.locationIterator,y.theme,b)}function l(h,v){Et.updateValues(h,v),N.updateIfChanged(h.uSizeFactor,v.sizeFactor),N.updateIfChanged(h.uBorderWidth,v.borderWidth),at.fromNormalizedArray(h.uBorderColor.ref.value,0)!==v.borderColor&&(at.toArrayNormalized(v.borderColor,h.uBorderColor.ref.value,0),N.update(h.uBorderColor,h.uBorderColor.ref.value)),N.updateIfChanged(h.uOffsetX,v.offsetX),N.updateIfChanged(h.uOffsetY,v.offsetY),N.updateIfChanged(h.uOffsetZ,v.offsetZ),at.fromNormalizedArray(h.uBackgroundColor.ref.value,0)!==v.backgroundColor&&(at.toArrayNormalized(v.backgroundColor,h.uBackgroundColor.ref.value,0),N.update(h.uBackgroundColor,h.uBackgroundColor.ref.value)),N.updateIfChanged(h.uBackgroundOpacity,v.backgroundOpacity)}function c(h,v){var p=$9(h.aMapping.ref.value,h.aDepth.ref.value,v.charCount,tb(h)),m=Fe.expand(Fe(),v.boundingSphere,p),g=Vi(m,h.aTransform.ref.value,h.instanceCount.ref.value);Fe.equals(g,h.boundingSphere.ref.value)||N.update(h.boundingSphere,g),Fe.equals(m,h.invariantBoundingSphere.ref.value)||(N.update(h.invariantBoundingSphere,m),N.update(h.uInvariantBoundingSphere,_r.fromSphere(h.uInvariantBoundingSphere.ref.value,m))),N.update(h.padding,p)}function d(h){var v=Et.createRenderableState(h);return f(v,h),v}function f(h,v){Et.updateRenderableState(h,v),h.pickable=!1,h.opaque=!1,h.writeDepth=!0}})(Bs||(Bs={}));function $9(e,t,r,n){for(var i=0,a=0,o=0,s=r*4;o<s;++o){var u=2*o,l=Math.abs(e[u]);l>i&&(i=l);var c=Math.abs(e[u+1]);c>i&&(i=c);var d=Math.abs(t[o]);d>a&&(a=d)}return Math.max(a,n+n*i)}var Vu=_(),Hu=_(),xh=_(),X9=qe.add,Q2=qe.add3,Zo;(function(e){function t(r,n,i){r===void 0&&(r=2048),n===void 0&&(n=1024);var a=qe.create(Float32Array,1,n,i?i.groupBuffer.ref.value:r),o=qe.create(Float32Array,3,n,i?i.startBuffer.ref.value:r),s=qe.create(Float32Array,3,n,i?i.endBuffer.ref.value:r),u=function(d,f,h,v,p,m,g){for(var y=0;y<4;++y)Q2(o,d,f,h),Q2(s,v,p,m),X9(a,g)},l=function(d,f,h){for(var v=0;v<4;++v)Q2(o,d[0],d[1],d[2]),Q2(s,f[0],f[1],f[2]),X9(a,h)},c=function(d,f,h,v){var p=_.distance(d,f),m=Math.floor(h/2),g=1/h;_.sub(xh,f,d);for(var y=0;y<m;++y){var b=g*(y*2+1);_.setMagnitude(xh,xh,p*b),_.add(Vu,d,xh),_.setMagnitude(xh,xh,p*g*((y+1)*2)),_.add(Hu,d,xh),u(Vu[0],Vu[1],Vu[2],Hu[0],Hu[1],Hu[2],v)}};return{add:u,addVec:l,addFixedCountDashes:c,addFixedLengthDashes:function(d,f,h,v){var p=_.distance(d,f);c(d,f,p/h,v)},addCage:function(d,f,h){for(var v=f.vertices,p=f.edges,m=0,g=p.length;m<g;m+=2)_.fromArray(Vu,v,p[m]*3),_.fromArray(Hu,v,p[m+1]*3),_.transformMat4(Vu,Vu,d),_.transformMat4(Hu,Hu,d),u(Vu[0],Vu[1],Vu[2],Hu[0],Hu[1],Hu[2],h)},getLines:function(){var d=a.elementCount/4,f=qe.compact(a,!0),h=qe.compact(o,!0),v=qe.compact(s,!0),p=i&&d<=i.lineCount?i.mappingBuffer.ref.value:new Float32Array(d*8),m=i&&d<=i.lineCount?i.indexBuffer.ref.value:new Uint32Array(d*6);return(!i||d>i.lineCount)&&b6e(d,p,m),bn.create(p,m,f,h,v,d,i)}}}e.create=t})(Zo||(Zo={}));function b6e(e,t,r){for(var n=0;n<e;++n){var i=n*8;t[i]=-1,t[i+1]=-1,t[i+2]=1,t[i+3]=-1,t[i+4]=-1,t[i+5]=1,t[i+6]=1,t[i+7]=1}for(var n=0;n<e;++n){var a=n*4,o=n*6;r[o]=a,r[o+1]=a+1,r[o+2]=a+2,r[o+3]=a+1,r[o+4]=a+3,r[o+5]=a+2}}var bn;(function(e){function t(h,v,p,m,g,y,b){return b?o(h,v,p,m,g,y,b):a(h,v,p,m,g,y)}e.create=t;function r(h){var v=h?h.mappingBuffer.ref.value:new Float32Array(0),p=h?h.indexBuffer.ref.value:new Uint32Array(0),m=h?h.groupBuffer.ref.value:new Float32Array(0),g=h?h.startBuffer.ref.value:new Float32Array(0),y=h?h.endBuffer.ref.value:new Float32Array(0);return t(v,p,m,g,y,0,h)}e.createEmpty=r;function n(h,v){for(var p=h.vertexBuffer.ref.value,m=h.indexBuffer.ref.value,g=h.groupBuffer.ref.value,y=Zo.create(h.triangleCount*3,h.triangleCount/10,v),b=0,S=h.triangleCount*3;b<S;b+=3){var x=m[b],C=m[b+1],w=m[b+2],A=p[x*3],M=p[x*3+1],D=p[x*3+2],k=p[C*3],R=p[C*3+1],L=p[C*3+2],H=p[w*3],B=p[w*3+1],j=p[w*3+2];y.add(A,M,D,k,R,L,g[x]),y.add(A,M,D,H,B,j,g[x]),y.add(k,R,L,H,B,j,g[C])}return y.getLines()}e.fromMesh=n;function i(h){return La([h.lineCount,h.mappingBuffer.ref.version,h.indexBuffer.ref.version,h.groupBuffer.ref.version,h.startBuffer.ref.version,h.endBuffer.ref.version])}function a(h,v,p,m,g,y){var b=Fe(),S,x=-1,C=-1,w={kind:"lines",lineCount:y,mappingBuffer:N.create(h),indexBuffer:N.create(v),groupBuffer:N.create(p),startBuffer:N.create(m),endBuffer:N.create(g),get boundingSphere(){var A=i(w);if(A!==x){var M=Qf(w.startBuffer.ref.value,w.lineCount*4,4),D=Qf(w.endBuffer.ref.value,w.lineCount*4,4);Fe.expandBySphere(b,M,D),x=A}return b},get groupMapping(){return w.groupBuffer.ref.version!==C&&(S=Jg(w.groupBuffer.ref.value,w.lineCount,4),C=w.groupBuffer.ref.version),S},setBoundingSphere:function(A){Fe.copy(b,A),x=i(w)}};return w}function o(h,v,p,m,g,y,b){return y>b.lineCount&&(N.update(b.mappingBuffer,h),N.update(b.indexBuffer,v)),b.lineCount=y,N.update(b.groupBuffer,p),N.update(b.startBuffer,m),N.update(b.endBuffer,g),b}function s(h,v){var p=h.startBuffer.ref.value;Qp(v,p,0,h.lineCount*4),N.update(h.startBuffer,p);var m=h.endBuffer.ref.value;Qp(v,m,0,h.lineCount*4),N.update(h.endBuffer,m)}e.transform=s,e.Params=E(E({},Et.Params),{sizeFactor:I.Numeric(1.5,{min:0,max:10,step:.1}),lineSizeAttenuation:I.Boolean(!1)}),e.Utils={Params:e.Params,createEmpty:r,createValues:l,createValuesSimple:c,updateValues:d,updateBoundingSphere:f,createRenderableState:Et.createRenderableState,updateRenderableState:Et.updateRenderableState,createPositionIterator:u};function u(h,v){var p=h.lineCount*4,m=v.instanceCount.ref.value,g=pv(),y=g.position,b=h.startBuffer.ref.value,S=h.endBuffer.ref.value,x=v.aTransform.ref.value,C=function(w,A){var M=w%4===0?b:S;return A<0?_.fromArray(y,M,w*3):_.transformMat4Offset(y,M,x,0,w*3,A*16),g};return mn(p,m,2,C)}function l(h,v,p,m,g){var y=p.instanceCount,b=p.groupCount,S=u(h,v),x=ns(p,S,m.color),C=nd(p,m.size),w=Hs(y*b),A=id(),M=ad(),D=od(),k={drawCount:h.lineCount*2*3,vertexCount:h.lineCount*4,groupCount:b,instanceCount:y},R=Fe.clone(h.boundingSphere),L=Vi(R,v.aTransform.ref.value,y);return E(E(E(E(E(E(E(E(E({aMapping:h.mappingBuffer,aGroup:h.groupBuffer,aStart:h.startBuffer,aEnd:h.endBuffer,elements:h.indexBuffer,boundingSphere:N.create(L),invariantBoundingSphere:N.create(R),uInvariantBoundingSphere:N.create(_r.ofSphere(R))},x),C),w),A),M),D),v),Et.createValues(g,k)),{uSizeFactor:N.create(g.sizeFactor),dLineSizeAttenuation:N.create(g.lineSizeAttenuation),dDoubleSided:N.create(!0),dFlipSided:N.create(!1)})}function c(h,v,p,m,g){var y=Et.createSimple(p,m,g),b=E(E({},I.getDefaultValues(e.Params)),v);return l(h,y.transform,y.locationIterator,y.theme,b)}function d(h,v){Et.updateValues(h,v),N.updateIfChanged(h.uSizeFactor,v.sizeFactor),N.updateIfChanged(h.dLineSizeAttenuation,v.lineSizeAttenuation)}function f(h,v){var p=Fe.clone(v.boundingSphere),m=Vi(p,h.aTransform.ref.value,h.instanceCount.ref.value);Fe.equals(m,h.boundingSphere.ref.value)||N.update(h.boundingSphere,m),Fe.equals(p,h.invariantBoundingSphere.ref.value)||(N.update(h.invariantBoundingSphere,p),N.update(h.uInvariantBoundingSphere,_r.fromSphere(h.uInvariantBoundingSphere.ref.value,p)))}})(bn||(bn={}));var Y9=_(),K9=_(),Q9=_();function N3(e,t){for(var r=t.length,n=e0(r/3),i=0;i<r;i+=3)_.fromArray(Y9,e,t[i]*3),_.fromArray(K9,e,t[i+1]*3),_.fromArray(Q9,e,t[i+2]*3),n.add(Y9,K9,Q9);return n.getPrimitive()}var Z2=_();function e0(e,t){t===void 0&&(t=e*3);var r=new Float32Array(t*3),n=new Float32Array(t*3),i=new Uint32Array(e*3),a=0,o=0;return{add:function(s,u,l){_.toArray(s,r,a),_.toArray(u,r,a+3),_.toArray(l,r,a+6),_.triangleNormal(Z2,s,u,l);for(var c=0;c<3;++c)_.toArray(Z2,n,a+3*c),i[o+c]=a/3+c;a+=9,o+=3},addQuad:function(s,u,l,c){_.toArray(s,r,a),_.toArray(u,r,a+3),_.toArray(l,r,a+6),_.toArray(c,r,a+9),_.triangleNormal(Z2,s,u,l);for(var d=0;d<4;++d)_.toArray(Z2,n,a+3*d);var f=a/3;i[o]=f,i[o+1]=f+1,i[o+2]=f+2,i[o+3]=f+2,i[o+4]=f+3,i[o+5]=f,a+=12,o+=6},getPrimitive:function(){return{vertices:r,normals:n,indices:i}}}}var Hv=_(),x6e=zn();function EO(e,t){for(var r=e.vertices,n=e.normals,i=zn.directionTransform(x6e,t),a=0,o=r.length;a<o;a+=3)_.transformMat4(Hv,_.fromArray(Hv,r,a),t),_.toArray(Hv,r,a),_.transformMat3(Hv,_.fromArray(Hv,n,a),i),_.toArray(Hv,n,a);return e}function Ml(e,t,r){r===void 0&&(r=-1);for(var n=new Float32Array(e*3),i=r===-1?e<=4?Math.sqrt(2)/2:.6:r,a=t?1:0,o=0,s=e;o<s;++o){var u=(o*2+a)/e*Math.PI;n[o*3]=Math.cos(u)*i,n[o*3+1]=Math.sin(u)*i,n[o*3+2]=0}return n}function AO(e,t){return{vertices:e,edges:t}}function jQ(e){return{vertices:new Float32Array(e.vertices),edges:new Uint32Array(e.edges)}}var UP=_.zero();function zQ(e,t){for(var r=e.vertices,n=0,i=r.length;n<i;n+=3)_.transformMat4(UP,_.fromArray(UP,r,n),t),_.toArray(UP,r,n);return e}var Ul=_(),jl=_(),zl=_(),Gv=_(),Wn=Ml(4,!0);function VQ(e){for(var t=12,r=e?12*3:6*4,n=e0(t,r),i=0;i<4;++i){var a=(i+1)%4;_.set(Ul,Wn[i*3],Wn[i*3+1],-.5),_.set(jl,Wn[a*3],Wn[a*3+1],-.5),_.set(zl,Wn[a*3],Wn[a*3+1],.5),_.set(Gv,Wn[i*3],Wn[i*3+1],.5),e?n.add(Ul,jl,zl):n.addQuad(Ul,jl,zl,Gv)}return _.set(Ul,Wn[0],Wn[1],-.5),_.set(jl,Wn[3],Wn[4],-.5),_.set(zl,Wn[6],Wn[7],-.5),_.set(Gv,Wn[9],Wn[10],-.5),e?n.add(zl,jl,Ul):n.addQuad(Gv,zl,jl,Ul),_.set(Ul,Wn[0],Wn[1],.5),_.set(jl,Wn[3],Wn[4],.5),_.set(zl,Wn[6],Wn[7],.5),_.set(Gv,Wn[9],Wn[10],.5),e?n.add(Ul,jl,zl):n.addQuad(Ul,jl,zl,Gv),n.getPrimitive()}var jP;function PO(){return jP||(jP=VQ(!1)),jP}var zP;function S6e(){return zP||(zP=VQ(!0)),zP}var VP;function HQ(){return VP||(VP=AO([.5,.5,-.5,-.5,.5,-.5,-.5,-.5,-.5,.5,-.5,-.5,.5,.5,.5,-.5,.5,.5,-.5,-.5,.5,.5,-.5,.5],[0,4,1,5,2,6,3,7,0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4])),VP}function Z9(e){return e.map(function(t){return{x:t[0],alpha:t[1]}})}function J9(e,t,r){for(var n=Ft(Ft([{x:0,alpha:0},{x:0,alpha:0}],e),[{x:1,alpha:0},{x:1,alpha:0}]),i=Pu.create({domain:[0,1],listOrName:t}),a=256,o=r?r.ref.value.array:new Uint8Array(a*4),s=0,u,l,c,d,f,h,v=e.length+1,p=0;p<v;++p){u=n[p+1].x,l=n[p+2].x,c=n[p].alpha,d=n[p+1].alpha,f=n[p+2].alpha,h=n[p+3].alpha;for(var m=Math.round((l-u)*a),g=0;g<m;++g){var y=g/m;o[s*4+3]=Math.max(0,uS(c,d,f,h,y,.5)*255),i.colorToArray(s/255,o,s*4),++s}}var b={array:o,width:256,height:1};return r?(N.update(r,b),r):N.create(b)}function C6e(e,t,r){if(r)return eU(e,t,r.min,r.max);var n=Mo(e),i=n[0],a=n[1];return eU(e,t,i,a)}function eU(e,t,r,n){var i=(n-r)/t;i===0&&(i=1);for(var a=new Int32Array(t),o=0,s=e.length;o<s;o++){var u=Math.floor((e[o]-r)/i);u>=t?u=t-1:u<0&&(u=0),a[u]++}return{min:r,max:n,binWidth:i,counts:a}}var _a;(function(e){e.One={transform:{kind:"matrix",matrix:ue.identity()},cells:Pr.create(Pr.Space([1,1,1],[0,1,2]),Pr.Data1([0])),stats:{min:0,max:0,mean:0,sigma:0}};var t=ue.zero(),r=ue.zero();function n(u){if(u.transform.kind==="matrix")return ue.copy(ue(),u.transform.matrix);if(u.transform.kind==="spacegroup"){var l=u.cells.space,c=ue.fromScaling(t,_.div(_.zero(),Xt.size(_.zero(),u.transform.fractionalBox),_.ofArray(l.dimensions))),d=ue.fromTranslation(r,u.transform.fractionalBox.min);return ue.mul3(ue.zero(),u.transform.cell.fromFractional,d,c)}return ue.identity()}e.getGridToCartesianTransform=n;function i(u,l){return u===l}e.areEquivalent=i;function a(u){return u.cells.data.length===0}e.isEmpty=a;function o(u,l){l||(l=Fe());var c=u.cells.space.dimensions,d=e.getGridToCartesianTransform(u);return Fe.fromDimensionsAndTransform(l,c,d)}e.getBoundingSphere=o;function s(u,l){var c=u._historams;return c||(c=u._historams={}),c[l]||(c[l]=C6e(u.cells.data,l,{min:u.stats.min,max:u.stats.max})),c[l]}e.getHistogram=s})(_a||(_a={}));function _6e(e,t){var r=this;return We.create("Create Volume",function(){return ce(r,void 0,void 0,function(){var n,i,a,o,s,u,l,c,d,f,h,v,p,m,g,y,b;return de(this,function(S){if(n=e.header,i=e.values,a=Pr.Space(n.dim,[0,1,2],Float64Array),n.dataSetIds.length===0)o=i;else for(s=n.dim,u=s[0],l=s[1],c=s[2],d=((t==null?void 0:t.dataIndex)||0)+1,f=0,h=0,o=new Float64Array(u*l*c),v=0;v<u;v++)for(p=0;p<l;p++)for(m=0;m<c;m++)o[f++]=i[h],h+=d;return g=Pr.create(a,Pr.Data1(o)),y=ue.fromTranslation(ue(),n.origin),b=ue.fromBasis(ue(),n.basisX,n.basisY,n.basisZ),ue.mul(y,y,b),[2,{label:t==null?void 0:t.label,entryId:t==null?void 0:t.entryId,grid:{transform:{kind:"matrix",matrix:y},cells:g,stats:{min:g3(o),max:Cl(o),mean:y3(o),sigma:b3(o)}},sourceData:c_.create(e),customProperties:new Tl,_propertyData:Object.create(null)}]})})})}var c_;(function(e){function t(n){return(n==null?void 0:n.kind)==="cube"}e.is=t;function r(n){return{kind:"cube",name:n.name,data:n}}e.create=r})(c_||(c_={}));var Ct;(function(e){function t(f){var h,v,p,m;return((m=(p=(v=(h=f==null?void 0:f.grid)===null||h===void 0?void 0:h.cells)===null||v===void 0?void 0:v.space)===null||p===void 0?void 0:p.dimensions)===null||m===void 0?void 0:m.length)&&(f==null?void 0:f.sourceData)&&(f==null?void 0:f.customProperties)&&(f==null?void 0:f._propertyData)}e.is=t,function(f){function h(x,C,w){return hn(y(x,w).absoluteValue,y(C,w).absoluteValue,w.sigma/100)}f.areSame=h;function v(x){return{kind:"absolute",absoluteValue:x}}f.absolute=v;function p(x){return{kind:"relative",relativeValue:x}}f.relative=p;function m(x,C){return C*x.sigma+x.mean}f.calcAbsolute=m;function g(x,C){return x.sigma===0?0:(C-x.mean)/x.sigma}f.calcRelative=g;function y(x,C){return x.kind==="absolute"?x:{kind:"absolute",absoluteValue:f.calcAbsolute(C,x.relativeValue)}}f.toAbsolute=y;function b(x,C){return x.kind==="relative"?x:{kind:"relative",relativeValue:f.calcRelative(C,x.absoluteValue)}}f.toRelative=b;function S(x){return x.kind==="relative"?x.relativeValue.toFixed(2)+" σ":""+x.absoluteValue.toPrecision(4)}f.toString=S}(e.IsoValue||(e.IsoValue={}));var r={min:-1,max:1,mean:0,sigma:.1};function n(f,h){var v=h||r,p=v.min,m=v.max,g=v.mean,y=v.sigma,b=(p-g)/y,S=(m-g)/y,x=f;return f.kind==="absolute"?f.absoluteValue<p?x=e.IsoValue.absolute(p):f.absoluteValue>m&&(x=e.IsoValue.absolute(m)):f.relativeValue<b?x=e.IsoValue.relative(b):f.relativeValue>S&&(x=e.IsoValue.relative(S)),I.Conditioned(x,{absolute:I.Converted(function(C){return e.IsoValue.toAbsolute(C,_a.One.stats).absoluteValue},function(C){return e.IsoValue.absolute(C)},I.Numeric(g,{min:p,max:m,step:$M(y/100,2)})),relative:I.Converted(function(C){return e.IsoValue.toRelative(C,_a.One.stats).relativeValue},function(C){return e.IsoValue.relative(C)},I.Numeric(Math.min(1,S),{min:b,max:S,step:$M(Math.round((m-p)/y)/100,2)}))},function(C){return C.kind==="absolute"?"absolute":"relative"},function(C,w){return w==="absolute"?e.IsoValue.toAbsolute(C,v):e.IsoValue.toRelative(C,v)},{isEssential:!0})}e.createIsoValueParam=n,e.IsoValueParam=n(e.IsoValue.relative(2)),e.One={label:"",grid:_a.One,sourceData:{kind:"",name:"",data:{}},customProperties:new Tl,_propertyData:Object.create(null)};function i(f,h){return _a.areEquivalent(f.grid,h.grid)}e.areEquivalent=i;function a(f){return _a.isEmpty(f.grid)}e.isEmpty=a;function o(f){return c_.is(f.sourceData)?f.sourceData.data.header.orbitals:!1}e.isOrbitals=o;function s(f){return{kind:"volume-loci",volume:f}}e.Loci=s;function u(f){return!!f&&f.kind==="volume-loci"}e.isLoci=u;function l(f,h){return f.volume===h.volume}e.areLociEqual=l;function c(f){return _a.isEmpty(f.volume.grid)}e.isLociEmpty=c;function d(f,h){return _a.getBoundingSphere(f.grid,h)}e.getBoundingSphere=d,function(f){function h(y,b){return{kind:"isosurface-loci",volume:y,isoValue:b}}f.Loci=h;function v(y){return!!y&&y.kind==="isosurface-loci"}f.isLoci=v;function p(y,b){return y.volume===b.volume&&e.IsoValue.areSame(y.isoValue,b.isoValue,y.volume.grid.stats)}f.areLociEqual=p;function m(y){return y.volume.grid.cells.data.length===0}f.isLociEmpty=m;function g(y,b,S){return e.getBoundingSphere(y,S)}f.getBoundingSphere=g}(e.Isosurface||(e.Isosurface={})),function(f){function h(S,x){return{kind:"cell-loci",volume:S,indices:x}}f.Loci=h;function v(S){return!!S&&S.kind==="cell-loci"}f.isLoci=v;function p(S,x){return S.volume===x.volume&&Oe.areEqual(S.indices,x.indices)}f.areLociEqual=p;function m(S){return Oe.size(S.indices)===0}f.isLociEmpty=m;var g=new rs("98"),y=_();function b(S,x,C){g.reset();for(var w=_a.getGridToCartesianTransform(S.grid),A=S.grid.cells.space.getCoords,M=0,D=Oe.size(x);M<D;M++){var k=Oe.getAt(x,M);A(k,y),_.transformMat4(y,y,w),g.includePosition(y)}g.finishedIncludeStep();for(var M=0,D=Oe.size(x);M<D;M++){var k=Oe.getAt(x,M);A(k,y),_.transformMat4(y,y,w),g.radiusPosition(y)}var R=g.getSphere(C);return Fe.expand(R,R,ue.getMaxScaleOnAxis(w)*10)}f.getBoundingSphere=b}(e.Cell||(e.Cell={}))})(Ct||(Ct={}));var HP=PO(),Ya;(function(e){function t(y,b,S,x,C,w,A,M,D){return D?i(y,b,S,x,C,w,A,M,D):n(y,b,S,x,C,w,A,M)}e.create=t;function r(y){return La([y.bboxSize.ref.version,y.gridDimension.ref.version,y.gridTexture.ref.version,y.transform.ref.version,y.gridStats.ref.version])}function n(y,b,S,x,C,w,A,M){var D=Fe(),k=-1,R=w.getWidth(),L=w.getHeight(),H=w.getDepth(),B={kind:"direct-volume",gridDimension:N.create(b),gridTexture:N.create(w),gridTextureDim:N.create(_.create(R,L,H)),gridStats:N.create(_r.create(A.min,A.max,A.mean,A.sigma)),bboxMin:N.create(y.min),bboxMax:N.create(y.max),bboxSize:N.create(_.sub(_(),y.max,y.min)),transform:N.create(S),cellDim:N.create(C),unitToCartn:N.create(x),cartnToUnit:N.create(ue.invert(ue(),x)),get boundingSphere(){var j=r(B);if(j!==k){var Q=w6e(B.gridDimension.ref.value,B.transform.ref.value);Fe.copy(D,Q),k=j}return D},packedGroup:N.create(M),setBoundingSphere:function(j){Fe.copy(D,j),k=r(B)}};return B}function i(y,b,S,x,C,w,A,M,D){var k=w.getWidth(),R=w.getHeight(),L=w.getDepth();return N.update(D.gridDimension,b),N.update(D.gridTexture,w),N.update(D.gridTextureDim,_.set(D.gridTextureDim.ref.value,k,R,L)),N.update(D.gridStats,_r.set(D.gridStats.ref.value,A.min,A.max,A.mean,A.sigma)),N.update(D.bboxMin,y.min),N.update(D.bboxMax,y.max),N.update(D.bboxSize,_.sub(D.bboxSize.ref.value,y.max,y.min)),N.update(D.transform,S),N.update(D.cellDim,C),N.update(D.unitToCartn,x),N.update(D.cartnToUnit,ue.invert(ue(),x)),N.updateIfChanged(D.packedGroup,M),D}function a(y){return{}}e.createEmpty=a;function o(y){var b=y?Ct.createIsoValueParam(Ct.IsoValue.relative(2),y):Ct.IsoValueParam;return I.MappedStatic("volume",{isosurface:I.Group({isoValue:b,singleLayer:I.Boolean(!1,{isEssential:!0})},{isFlat:!0}),volume:I.Group({controlPoints:I.LineGraph([He.create(.19,0),He.create(.2,.05),He.create(.25,.05),He.create(.26,0),He.create(.79,0),He.create(.8,.05),He.create(.85,.05),He.create(.86,0)]),list:I.ColorList({kind:"interpolate",colors:[[dr.white,0],[dr.red,.25],[dr.white,.5],[dr.blue,.75],[dr.white,1]]},{offsets:!0})},{isFlat:!0})},{isEssential:!0})}e.createRenderModeParam=o,e.Params=E(E({},Et.Params),{doubleSided:I.Boolean(!1,Et.CustomQualityParamInfo),flipSided:I.Boolean(!1,Et.ShadingCategory),flatShaded:I.Boolean(!1,Et.ShadingCategory),ignoreLight:I.Boolean(!1,Et.ShadingCategory),xrayShaded:I.Boolean(!1,Et.ShadingCategory),renderMode:o(),stepsPerCell:I.Numeric(5,{min:1,max:20,step:1}),jumpLength:I.Numeric(0,{min:0,max:20,step:.1})}),e.Utils={Params:e.Params,createEmpty:a,createValues:f,createValuesSimple:h,updateValues:v,updateBoundingSphere:p,createRenderableState:m,updateRenderableState:g,createPositionIterator:s};function s(y,b){var S=y.transform.ref.value,x=y.gridDimension.ref.value,C=x[0],w=x[1],A=x[2],M=C*w*A,D=b.instanceCount.ref.value,k=pv(),R=k.position,L=b.aTransform.ref.value,H=function(B,j){var Q=Math.floor(B/A);return R[0]=Math.floor(Q/w),R[1]=Q%w,R[2]=B%A,_.transformMat4(R,R,S),j>=0&&_.transformMat4Offset(R,R,L,0,0,j*16),k};return mn(M,D,1,H)}function u(y,b,S){var x=S[0],C=S[1],w=S[2],A=S[3],M=Ct.IsoValue.toAbsolute(b,{min:x,max:C,mean:w,sigma:A}).absoluteValue;return He.set(y,(M-x)/(C-x),(0-x)/(C-x)),y}function l(y,b){return Math.ceil(_.magnitude(y)*b)}function c(y,b){return Math.min.apply(Math,y)*(1/b)}function d(y){return 1/y}function f(y,b,S,x,C){var w=y.gridTexture,A=y.gridTextureDim,M=y.gridStats,D=y.bboxSize,k=y.bboxMin,R=y.bboxMax,L=y.gridDimension,H=y.transform,B=S.instanceCount,j=S.groupCount,Q=e.Utils.createPositionIterator(y,b),G=ns(S,Q,x.color),W=Hs(B*j),q=id(),ee=ad(),he=od(),$=L.ref.value,X=$[0],U=$[1],z=$[2],J={drawCount:HP.indices.length,vertexCount:X*U*z,groupCount:j,instanceCount:B},Y=Fe.clone(y.boundingSphere),Z=Vi(Y,b.aTransform.ref.value,B),te=C.renderMode.name==="volume"?Z9(C.renderMode.params.controlPoints):[],le=J9(te,C.renderMode.name==="volume"?C.renderMode.params.list.colors:[]),ye=C.renderMode.name==="isosurface"?C.renderMode.params.isoValue:Ct.IsoValue.relative(2),be=C.renderMode.name==="isosurface"?C.renderMode.params.singleLayer:!1;return E(E(E(E(E(E(E(E({},G),W),q),ee),he),b),Et.createValues(C,J)),{aPosition:N.create(HP.vertices),elements:N.create(HP.indices),boundingSphere:N.create(Z),invariantBoundingSphere:N.create(Y),uInvariantBoundingSphere:N.create(_r.ofSphere(Y)),uIsoValue:N.create(u(He(),ye,y.gridStats.ref.value)),uBboxMin:k,uBboxMax:R,uBboxSize:D,uMaxSteps:N.create(l(L.ref.value,C.stepsPerCell)),uStepScale:N.create(c(y.cellDim.ref.value,C.stepsPerCell)),uJumpLength:N.create(C.jumpLength),uTransform:H,uGridDim:L,dRenderMode:N.create(C.renderMode.name),tTransferTex:le,uTransferScale:N.create(d(C.stepsPerCell)),dGridTexType:N.create(w.ref.value.getDepth()>0?"3d":"2d"),uGridTexDim:A,tGridTex:w,uGridStats:M,uCellDim:y.cellDim,uCartnToUnit:y.cartnToUnit,uUnitToCartn:y.unitToCartn,dPackedGroup:y.packedGroup,dSingleLayer:N.create(be),dDoubleSided:N.create(C.doubleSided),dFlatShaded:N.create(C.flatShaded),dFlipSided:N.create(C.flipSided),dIgnoreLight:N.create(C.ignoreLight),dXrayShaded:N.create(C.xrayShaded)})}function h(y,b,S,x,C){var w=Et.createSimple(S,x,C),A=E(E({},I.getDefaultValues(e.Params)),b);return f(y,w.transform,w.locationIterator,w.theme,A)}function v(y,b){if(N.updateIfChanged(y.alpha,b.alpha),N.updateIfChanged(y.uAlpha,b.alpha),N.updateIfChanged(y.dDoubleSided,b.doubleSided),N.updateIfChanged(y.dFlatShaded,b.flatShaded),N.updateIfChanged(y.dFlipSided,b.flipSided),N.updateIfChanged(y.dIgnoreLight,b.ignoreLight),N.updateIfChanged(y.dXrayShaded,b.xrayShaded),N.updateIfChanged(y.dRenderMode,b.renderMode.name),b.renderMode.name==="isosurface")N.updateIfChanged(y.uIsoValue,u(y.uIsoValue.ref.value,b.renderMode.params.isoValue,y.uGridStats.ref.value)),N.updateIfChanged(y.dSingleLayer,b.renderMode.params.singleLayer);else if(b.renderMode.name==="volume"){var S=Z9(b.renderMode.params.controlPoints);J9(S,b.renderMode.params.list.colors,y.tTransferTex)}N.updateIfChanged(y.uMaxSteps,l(y.uGridDim.ref.value,b.stepsPerCell)),N.updateIfChanged(y.uStepScale,c(y.uCellDim.ref.value,b.stepsPerCell)),N.updateIfChanged(y.uTransferScale,d(b.stepsPerCell)),N.updateIfChanged(y.uJumpLength,b.jumpLength)}function p(y,b){var S=Fe.clone(b.boundingSphere),x=Vi(S,y.aTransform.ref.value,y.instanceCount.ref.value);Fe.equals(x,y.boundingSphere.ref.value)||N.update(y.boundingSphere,x),Fe.equals(S,y.invariantBoundingSphere.ref.value)||(N.update(y.invariantBoundingSphere,S),N.update(y.uInvariantBoundingSphere,_r.fromSphere(y.uInvariantBoundingSphere.ref.value,S)))}function m(y){var b=Et.createRenderableState(y);return b.opaque=!1,b.writeDepth=y.renderMode.name==="isosurface",b}function g(y,b){Et.updateRenderableState(y,b),y.opaque=!1,y.writeDepth=b.renderMode.name==="isosurface"}})(Ya||(Ya={}));function w6e(e,t){return Fe.fromDimensionsAndTransform(Fe(),e,t)}var Zf;(function(e){function t(h,v,p,m,g,y){return y?a(h,v,p,m,g,y):i(h,v,p,m,g)}e.create=t;function r(h){var v=h?h.centerBuffer.ref.value:new Float32Array(0),p=h?h.mappingBuffer.ref.value:new Float32Array(0),m=h?h.indexBuffer.ref.value:new Uint32Array(0),g=h?h.groupBuffer.ref.value:new Float32Array(0);return t(v,p,m,g,0,h)}e.createEmpty=r;function n(h){return La([h.sphereCount,h.centerBuffer.ref.version,h.mappingBuffer.ref.version,h.indexBuffer.ref.version,h.groupBuffer.ref.version])}function i(h,v,p,m,g){var y=Fe(),b,S=-1,x=-1,C={kind:"spheres",sphereCount:g,centerBuffer:N.create(h),mappingBuffer:N.create(v),indexBuffer:N.create(p),groupBuffer:N.create(m),get boundingSphere(){var w=n(C);if(w!==S){var A=Qf(C.centerBuffer.ref.value,C.sphereCount*4,4);Fe.copy(y,A),S=w}return y},get groupMapping(){return C.groupBuffer.ref.version!==x&&(b=Jg(C.groupBuffer.ref.value,C.sphereCount,4),x=C.groupBuffer.ref.version),b},setBoundingSphere:function(w){Fe.copy(y,w),S=n(C)}};return C}function a(h,v,p,m,g,y){return g>y.sphereCount&&(N.update(y.mappingBuffer,v),N.update(y.indexBuffer,p)),y.sphereCount=g,N.update(y.centerBuffer,h),N.update(y.groupBuffer,m),y}e.Params=E(E({},Et.Params),{sizeFactor:I.Numeric(1,{min:0,max:10,step:.1}),doubleSided:I.Boolean(!1,Et.CustomQualityParamInfo),ignoreLight:I.Boolean(!1,Et.ShadingCategory),xrayShaded:I.Boolean(!1,Et.ShadingCategory)}),e.Utils={Params:e.Params,createEmpty:r,createValues:s,createValuesSimple:u,updateValues:l,updateBoundingSphere:c,createRenderableState:d,updateRenderableState:f,createPositionIterator:o};function o(h,v){var p=h.sphereCount*4,m=v.instanceCount.ref.value,g=pv(),y=g.position,b=h.centerBuffer.ref.value,S=v.aTransform.ref.value,x=function(C,w){return w<0?_.fromArray(y,b,C*3):_.transformMat4Offset(y,b,S,0,C*3,w*16),g};return mn(p,m,4,x)}function s(h,v,p,m,g){var y=p.instanceCount,b=p.groupCount,S=o(h,v),x=ns(p,S,m.color),C=nd(p,m.size),w=Hs(y*b),A=id(),M=ad(),D=od(),k={drawCount:h.sphereCount*2*3,vertexCount:h.sphereCount*4,groupCount:b,instanceCount:y},R=h.boundingSphere.radius?tb(C)*g.sizeFactor:0,L=Fe.expand(Fe(),h.boundingSphere,R),H=Vi(L,v.aTransform.ref.value,y);return E(E(E(E(E(E(E(E(E(E({aPosition:h.centerBuffer,aMapping:h.mappingBuffer,aGroup:h.groupBuffer,elements:h.indexBuffer,boundingSphere:N.create(H),invariantBoundingSphere:N.create(L),uInvariantBoundingSphere:N.create(_r.ofSphere(L))},x),C),w),A),M),D),v),{padding:N.create(R)}),Et.createValues(g,k)),{uSizeFactor:N.create(g.sizeFactor),dDoubleSided:N.create(g.doubleSided),dIgnoreLight:N.create(g.ignoreLight),dXrayShaded:N.create(g.xrayShaded)})}function u(h,v,p,m,g){var y=Et.createSimple(p,m,g),b=E(E({},I.getDefaultValues(e.Params)),v);return s(h,y.transform,y.locationIterator,y.theme,b)}function l(h,v){Et.updateValues(h,v),N.updateIfChanged(h.uSizeFactor,v.sizeFactor),N.updateIfChanged(h.dDoubleSided,v.doubleSided),N.updateIfChanged(h.dIgnoreLight,v.ignoreLight),N.updateIfChanged(h.dXrayShaded,v.xrayShaded)}function c(h,v){var p=v.boundingSphere.radius?tb(h)*h.uSizeFactor.ref.value:0,m=Fe.expand(Fe(),v.boundingSphere,p),g=Vi(m,h.aTransform.ref.value,h.instanceCount.ref.value);Fe.equals(g,h.boundingSphere.ref.value)||N.update(h.boundingSphere,g),Fe.equals(m,h.invariantBoundingSphere.ref.value)||(N.update(h.invariantBoundingSphere,m),N.update(h.uInvariantBoundingSphere,_r.fromSphere(h.uInvariantBoundingSphere.ref.value,m))),N.update(h.padding,p)}function d(h){var v=Et.createRenderableState(h);return f(v,h),v}function f(h,v){Et.updateRenderableState(h,v),h.opaque=h.opaque&&!v.xrayShaded,h.writeDepth=h.opaque}})(Zf||(Zf={}));var Ru;(function(e){var t=function(){function u(){this.index=0,this.textures=[]}return u.prototype.get=function(){return this.textures[this.index]},u.prototype.set=function(l,c,d){this.textures[this.index]=Object.assign(this.textures[this.index]||{},{vertex:l,group:c,normal:d}),this.index=(this.index+1)%2},u.prototype.destroy=function(){for(var l=0,c=this.textures;l<c.length;l++){var d=c[l];d.vertex.destroy(),d.group.destroy(),d.normal.destroy()}},u}();e.DoubleBuffer=t;function r(u,l,c,d,f,h,v){var p=c.getWidth(),m=c.getHeight();return v?(v.vertexCount=u,v.groupCount=l,N.update(v.geoTextureDim,He.set(v.geoTextureDim.ref.value,p,m)),N.update(v.vertexTexture,c),N.update(v.groupTexture,d),N.update(v.normalTexture,f),v.doubleBuffer.set(c,d,f),Fe.copy(v.boundingSphere,h),v):{kind:"texture-mesh",vertexCount:u,groupCount:l,geoTextureDim:N.create(He.create(p,m)),vertexTexture:N.create(c),groupTexture:N.create(d),normalTexture:N.create(f),doubleBuffer:new t,boundingSphere:Fe.clone(h)}}e.create=r;function n(u){return{}}e.createEmpty=n,e.Params=E(E({},Et.Params),{doubleSided:I.Boolean(!1,Et.CustomQualityParamInfo),flipSided:I.Boolean(!1,Et.ShadingCategory),flatShaded:I.Boolean(!1,Et.ShadingCategory),ignoreLight:I.Boolean(!1,Et.ShadingCategory),xrayShaded:I.Boolean(!1,Et.ShadingCategory)}),e.Utils={Params:e.Params,createEmpty:n,createValues:i,createValuesSimple:a,updateValues:o,updateBoundingSphere:s,createRenderableState:Et.createRenderableState,updateRenderableState:Et.updateRenderableState,createPositionIterator:function(){return mn(1,1,1,function(){return Ko})}};function i(u,l,c,d,f){var h=c.instanceCount,v=c.groupCount,p=e.Utils.createPositionIterator(u,l),m=ns(c,p,d.color),g=Hs(h*v),y=id(),b=ad(),S=od(),x={drawCount:u.vertexCount,vertexCount:u.vertexCount,groupCount:v,instanceCount:h},C=Fe.clone(u.boundingSphere),w=Vi(C,l.aTransform.ref.value,h);return E(E(E(E(E(E(E(E({uGeoTexDim:u.geoTextureDim,tPosition:u.vertexTexture,tGroup:u.groupTexture,tNormal:u.normalTexture,boundingSphere:N.create(w),invariantBoundingSphere:N.create(C),uInvariantBoundingSphere:N.create(_r.ofSphere(C))},m),g),y),b),S),l),Et.createValues(f,x)),{dDoubleSided:N.create(f.doubleSided),dFlatShaded:N.create(f.flatShaded),dFlipSided:N.create(f.flipSided),dIgnoreLight:N.create(f.ignoreLight),dXrayShaded:N.create(f.xrayShaded),dGeoTexture:N.create(!0)})}function a(u,l,c,d,f){var h=Et.createSimple(c,d,f),v=E(E({},I.getDefaultValues(e.Params)),l);return i(u,h.transform,h.locationIterator,h.theme,v)}function o(u,l){Et.updateValues(u,l),N.updateIfChanged(u.dDoubleSided,l.doubleSided),N.updateIfChanged(u.dFlatShaded,l.flatShaded),N.updateIfChanged(u.dFlipSided,l.flipSided),N.updateIfChanged(u.dIgnoreLight,l.ignoreLight),N.updateIfChanged(u.dXrayShaded,l.xrayShaded)}function s(u,l){var c=Fe.clone(l.boundingSphere),d=Vi(c,u.aTransform.ref.value,u.instanceCount.ref.value);Fe.equals(d,u.boundingSphere.ref.value)||N.update(u.boundingSphere,d),Fe.equals(c,u.invariantBoundingSphere.ref.value)||(N.update(u.invariantBoundingSphere,c),N.update(u.uInvariantBoundingSphere,_r.fromSphere(u.uInvariantBoundingSphere.ref.value,c)))}})(Ru||(Ru={}));function E6e(e,t){var r={},n={},i={},a={},o={},s={};return Object.keys(e).forEach(function(u){var l=e[u];l.type==="attribute"&&(r[u]=t[u]),l.type==="define"&&(n[u]=t[u]),l.type==="texture"&&t[u]!==void 0&&(i[u]=t[u]),l.type==="uniform"&&t[u]!==void 0&&(l.variant==="material"?o[u]=t[u]:l.variant==="buffered"?s[u]=t[u]:a[u]=t[u])}),{attributeValues:r,defineValues:n,textureValues:i,uniformValues:a,materialUniformValues:o,bufferedUniformValues:s}}function A6e(e){var t={};return Object.keys(e).forEach(function(r){t[r]=e[r].ref.version}),t}function Vr(e,t,r){return{type:"attribute",kind:e,itemSize:t,divisor:r}}function Ge(e,t){return{type:"uniform",kind:e,variant:t}}function ur(e,t,r,n){return{type:"texture",kind:e,format:t,dataType:r,filter:n}}function mv(e){return{type:"elements",kind:e}}function Qt(e,t){return{type:"define",kind:e,options:t}}function gi(e){return{type:"value",kind:e}}var sd={uModel:Ge("m4"),uView:Ge("m4"),uInvView:Ge("m4"),uModelView:Ge("m4"),uInvModelView:Ge("m4"),uProjection:Ge("m4"),uInvProjection:Ge("m4"),uModelViewProjection:Ge("m4"),uInvModelViewProjection:Ge("m4"),uIsOrtho:Ge("f"),uPixelRatio:Ge("f"),uViewportHeight:Ge("f"),uViewport:Ge("v4"),uViewOffset:Ge("v2"),uDrawingBufferSize:Ge("v2"),uCameraPosition:Ge("v3"),uCameraDir:Ge("v3"),uNear:Ge("f"),uFar:Ge("f"),uFogNear:Ge("f"),uFogFar:Ge("f"),uFogColor:Ge("v3"),uTransparentBackground:Ge("b"),uClipObjectType:Ge("i[]"),uClipObjectInvert:Ge("b[]"),uClipObjectPosition:Ge("v3[]"),uClipObjectRotation:Ge("v4[]"),uClipObjectScale:Ge("v3[]"),uLightIntensity:Ge("f"),uAmbientIntensity:Ge("f"),uMetalness:Ge("f"),uRoughness:Ge("f"),uReflectivity:Ge("f"),uPickingAlphaThreshold:Ge("f"),uInteriorDarkening:Ge("f"),uInteriorColorFlag:Ge("b"),uInteriorColor:Ge("v3"),uHighlightColor:Ge("v3"),uSelectColor:Ge("v3"),uXrayEdgeFalloff:Ge("f"),uRenderWboit:Ge("b")},ud={tDepth:ur("texture","depth","ushort","nearest")},ld={uObjectId:Ge("i")},P6e={uColor:Ge("v3","material"),uColorTexDim:Ge("v2"),uColorGridDim:Ge("v3"),uColorGridTransform:Ge("v4"),tColor:ur("image-uint8","rgb","ubyte","nearest"),tPalette:ur("image-uint8","rgb","ubyte","nearest"),tColorGrid:ur("texture","rgb","ubyte","linear"),dColorType:Qt("string",["uniform","attribute","instance","group","groupInstance","vertex","vertexInstance","volume","volumeInstance"]),dUsePalette:Qt("boolean")},Rb={uSize:Ge("f","material"),uSizeTexDim:Ge("v2"),tSize:ur("image-uint8","rgb","ubyte","nearest"),dSizeType:Qt("string",["uniform","attribute","instance","group","groupInstance"]),uSizeFactor:Ge("f")},T6e={uMarkerTexDim:Ge("v2"),tMarker:ur("image-uint8","alpha","ubyte","nearest")},I6e={uOverpaintTexDim:Ge("v2"),tOverpaint:ur("image-uint8","rgba","ubyte","nearest"),dOverpaint:Qt("boolean")},M6e={uTransparencyTexDim:Ge("v2"),tTransparency:ur("image-uint8","alpha","ubyte","nearest"),dTransparency:Qt("boolean"),transparencyAverage:gi("number")},D6e={dClipObjectCount:Qt("number"),dClipVariant:Qt("string",["instance","pixel"]),uClippingTexDim:Ge("v2"),tClipping:ur("image-uint8","alpha","ubyte","nearest"),dClipping:Qt("boolean")},cd=E(E(E(E(E(E({},P6e),T6e),I6e),M6e),D6e),{aInstance:Vr("float32",1,1),aTransform:Vr("float32",16,1),uAlpha:Ge("f","material"),uVertexCount:Ge("i"),uInstanceCount:Ge("i"),uGroupCount:Ge("i"),uInvariantBoundingSphere:Ge("v4"),drawCount:gi("number"),instanceCount:gi("number"),alpha:gi("number"),matrix:gi("m4"),transform:gi("float32"),extraTransform:gi("float32"),hasReflection:gi("boolean"),boundingSphere:gi("sphere"),invariantBoundingSphere:gi("sphere")}),GQ=new Float32Array([1,1,-1,1,-1,-1,-1,-1,1,-1,1,1]),va={drawCount:gi("number"),instanceCount:gi("number"),aPosition:Vr("float32",2,0),uQuadScale:Ge("v2")},ma={drawCount:N.create(6),instanceCount:N.create(1),aPosition:N.create(GQ),uQuadScale:N.create(He.create(1,1))},tU=new Uint32Array([0,1,2,1,3,2]),R6e=new Float32Array([0,1,0,0,1,1,1,0]),qQ={nearest:"Nearest",catmulrom:"Catmulrom (Cubic)",mitchell:"Mitchell (Cubic)",bspline:"B-Spline (Cubic)"},k6e=Object.keys(qQ),Uc;(function(e){function t(f,h,v,p){return p?i(f,h,v,p):n(f,h,v)}e.create=t;function r(f){return La([f.cornerBuffer.ref.version])}function n(f,h,v){var p=Fe(),m=-1,g=f.width,y=f.height,b={kind:"image",imageTexture:N.create(f),imageTextureDim:N.create(He.create(g,y)),cornerBuffer:N.create(h),groupTexture:N.create(v),get boundingSphere(){var S=r(b);if(S!==m){var x=O6e(b.cornerBuffer.ref.value);Fe.copy(p,x),m=S}return p}};return b}function i(f,h,v,p){var m=f.width,g=f.height;return N.update(p.imageTexture,f),N.update(p.imageTextureDim,He.set(p.imageTextureDim.ref.value,m,g)),N.update(p.cornerBuffer,h),N.update(p.groupTexture,v),p}function a(f){return{}}e.createEmpty=a,e.Params=E(E({},Et.Params),{interpolation:I.Select("bspline",I.objectToOptions(qQ))}),e.Utils={Params:e.Params,createEmpty:a,createValues:o,createValuesSimple:s,updateValues:u,updateBoundingSphere:l,createRenderableState:c,updateRenderableState:d,createPositionIterator:function(){return mn(1,1,1,function(){return Ko})}};function o(f,h,v,p,m){var g=v.instanceCount,y=v.groupCount,b=e.Utils.createPositionIterator(f,h),S=ns(v,b,p.color),x=Hs(g*y),C=id(),w=ad(),A=od(),M={drawCount:tU.length,vertexCount:GQ.length/3,groupCount:y,instanceCount:g},D=Fe.clone(f.boundingSphere),k=Vi(D,h.aTransform.ref.value,g);return E(E(E(E(E(E(E(E({},S),x),C),w),A),h),Et.createValues(m,M)),{aPosition:f.cornerBuffer,aUv:N.create(R6e),elements:N.create(tU),aGroup:N.create(Fs(new Float32Array(4))),boundingSphere:N.create(k),invariantBoundingSphere:N.create(D),uInvariantBoundingSphere:N.create(_r.ofSphere(D)),dInterpolation:N.create(m.interpolation),uImageTexDim:f.imageTextureDim,tImageTex:f.imageTexture,tGroupTex:f.groupTexture})}function s(f,h,v,p,m){var g=Et.createSimple(v,p,m),y=E(E({},I.getDefaultValues(e.Params)),h);return o(f,g.transform,g.locationIterator,g.theme,y)}function u(f,h){Et.updateValues(f,h),N.updateIfChanged(f.dInterpolation,h.interpolation)}function l(f,h){var v=Fe.clone(h.boundingSphere),p=Vi(v,f.aTransform.ref.value,f.instanceCount.ref.value);Fe.equals(p,f.boundingSphere.ref.value)||N.update(f.boundingSphere,p),Fe.equals(v,f.invariantBoundingSphere.ref.value)||(N.update(f.invariantBoundingSphere,v),N.update(f.uInvariantBoundingSphere,_r.fromSphere(f.uInvariantBoundingSphere.ref.value,v)))}function c(f){var h=Et.createRenderableState(f);return h.opaque=!1,h}function d(f,h){Et.updateRenderableState(f,h),f.opaque=!1}})(Uc||(Uc={}));function O6e(e){for(var t=_(),r=[],n=0,i=e.length;n<i;n+=3){var a=_.fromArray(_(),e,n);r.push(a),_.add(t,t,a)}_.scale(t,t,1/(e.length/3));for(var o=0,s=0,u=r;s<u.length;s++){var a=u[s],l=_.distance(t,a);l>o&&(o=l)}var c=Fe.create(t,o);return Fe.setExtrema(c,r),c}var Vo;(function(e){function t(v,p,m,g,y,b,S,x,C){return C?a(v,p,m,g,y,b,S,x,C):i(v,p,m,g,y,b,S,x)}e.create=t;function r(v){var p=v?v.mappingBuffer.ref.value:new Float32Array(0),m=v?v.indexBuffer.ref.value:new Uint32Array(0),g=v?v.groupBuffer.ref.value:new Float32Array(0),y=v?v.startBuffer.ref.value:new Float32Array(0),b=v?v.endBuffer.ref.value:new Float32Array(0),S=v?v.scaleBuffer.ref.value:new Float32Array(0),x=v?v.capBuffer.ref.value:new Float32Array(0);return t(p,m,g,y,b,S,x,0,v)}e.createEmpty=r;function n(v){return La([v.cylinderCount,v.mappingBuffer.ref.version,v.indexBuffer.ref.version,v.groupBuffer.ref.version,v.startBuffer.ref.version,v.endBuffer.ref.version,v.scaleBuffer.ref.version,v.capBuffer.ref.version])}function i(v,p,m,g,y,b,S,x){var C=Fe(),w,A=-1,M=-1,D={kind:"cylinders",cylinderCount:x,mappingBuffer:N.create(v),indexBuffer:N.create(p),groupBuffer:N.create(m),startBuffer:N.create(g),endBuffer:N.create(y),scaleBuffer:N.create(b),capBuffer:N.create(S),get boundingSphere(){var k=n(D);if(k!==A){var R=Qf(D.startBuffer.ref.value,D.cylinderCount*6,6),L=Qf(D.endBuffer.ref.value,D.cylinderCount*6,6);Fe.expandBySphere(C,R,L),A=k}return C},get groupMapping(){return D.groupBuffer.ref.version!==M&&(w=Jg(D.groupBuffer.ref.value,D.cylinderCount,6),M=D.groupBuffer.ref.version),w},setBoundingSphere:function(k){Fe.copy(C,k),A=n(D)}};return D}function a(v,p,m,g,y,b,S,x,C){return x>C.cylinderCount&&(N.update(C.mappingBuffer,v),N.update(C.indexBuffer,p)),C.cylinderCount=x,N.update(C.groupBuffer,m),N.update(C.startBuffer,g),N.update(C.endBuffer,y),N.update(C.scaleBuffer,b),N.update(C.capBuffer,S),C}function o(v,p){var m=v.startBuffer.ref.value;Qp(p,m,0,v.cylinderCount*6),N.update(v.startBuffer,m);var g=v.endBuffer.ref.value;Qp(p,g,0,v.cylinderCount*6),N.update(v.endBuffer,g)}e.transform=o,e.Params=E(E({},Et.Params),{sizeFactor:I.Numeric(1,{min:0,max:10,step:.1}),sizeAspectRatio:I.Numeric(1,{min:0,max:3,step:.01}),doubleSided:I.Boolean(!1,Et.CustomQualityParamInfo),ignoreLight:I.Boolean(!1,Et.ShadingCategory),xrayShaded:I.Boolean(!1,Et.ShadingCategory)}),e.Utils={Params:e.Params,createEmpty:r,createValues:u,createValuesSimple:l,updateValues:c,updateBoundingSphere:d,createRenderableState:f,updateRenderableState:h,createPositionIterator:s};function s(v,p){var m=v.cylinderCount*6,g=p.instanceCount.ref.value,y=pv(),b=y.position,S=v.startBuffer.ref.value,x=v.endBuffer.ref.value,C=p.aTransform.ref.value,w=function(A,M){var D=A%6===0?S:x;return M<0?_.fromArray(b,D,A*3):_.transformMat4Offset(b,D,C,0,A*3,M*16),y};return mn(m,g,2,w)}function u(v,p,m,g,y){var b=m.instanceCount,S=m.groupCount,x=s(v,p),C=ns(m,x,g.color),w=nd(m,g.size),A=Hs(b*S),M=id(),D=ad(),k=od(),R={drawCount:v.cylinderCount*4*3,vertexCount:v.cylinderCount*6,groupCount:S,instanceCount:b},L=tb(w)*y.sizeFactor,H=Fe.clone(v.boundingSphere),B=Vi(H,p.aTransform.ref.value,b);return E(E(E(E(E(E(E(E(E(E({aMapping:v.mappingBuffer,aGroup:v.groupBuffer,aStart:v.startBuffer,aEnd:v.endBuffer,aScale:v.scaleBuffer,aCap:v.capBuffer,elements:v.indexBuffer,boundingSphere:N.create(B),invariantBoundingSphere:N.create(H),uInvariantBoundingSphere:N.create(_r.ofSphere(H))},C),w),A),M),D),k),p),{padding:N.create(L)}),Et.createValues(y,R)),{uSizeFactor:N.create(y.sizeFactor*y.sizeAspectRatio),dDoubleSided:N.create(y.doubleSided),dIgnoreLight:N.create(y.ignoreLight),dXrayShaded:N.create(y.xrayShaded)})}function l(v,p,m,g,y){var b=Et.createSimple(m,g,y),S=E(E({},I.getDefaultValues(e.Params)),p);return u(v,b.transform,b.locationIterator,b.theme,S)}function c(v,p){Et.updateValues(v,p),N.updateIfChanged(v.uSizeFactor,p.sizeFactor*p.sizeAspectRatio),N.updateIfChanged(v.dDoubleSided,p.doubleSided),N.updateIfChanged(v.dIgnoreLight,p.ignoreLight),N.updateIfChanged(v.dXrayShaded,p.xrayShaded)}function d(v,p){var m=Fe.clone(p.boundingSphere),g=Vi(m,v.aTransform.ref.value,v.instanceCount.ref.value);Fe.equals(g,v.boundingSphere.ref.value)||N.update(v.boundingSphere,g),Fe.equals(m,v.invariantBoundingSphere.ref.value)||(N.update(v.invariantBoundingSphere,m),N.update(v.uInvariantBoundingSphere,_r.fromSphere(v.uInvariantBoundingSphere.ref.value,m)))}function f(v){var p=Et.createRenderableState(v);return h(p,v),p}function h(v,p){Et.updateRenderableState(v,p),v.opaque=v.opaque&&!p.xrayShaded,v.writeDepth=v.opaque}})(Vo||(Vo={}));var ra;(function(e){function t(o){switch(o.kind){case"mesh":return o.triangleCount*3;case"points":return o.pointCount;case"spheres":return o.sphereCount*2*3;case"cylinders":return o.cylinderCount*4*3;case"text":return o.charCount*2*3;case"lines":return o.lineCount*2*3;case"direct-volume":return 12*3;case"image":return 2*3;case"texture-mesh":return o.vertexCount}}e.getDrawCount=t;function r(o){switch(o.kind){case"mesh":return o.vertexCount;case"points":return o.pointCount;case"spheres":return o.sphereCount*4;case"cylinders":return o.cylinderCount*6;case"text":return o.charCount*4;case"lines":return o.lineCount*4;case"direct-volume":var s=o.gridDimension.ref.value,u=s[0],l=s[1],c=s[2];return u*l*c;case"image":return 4;case"texture-mesh":return o.vertexCount}}e.getVertexCount=r;function n(o){switch(o.kind){case"mesh":case"points":case"spheres":case"cylinders":case"text":case"lines":return t(o)===0?0:Cl(o.groupBuffer.ref.value)+1;case"direct-volume":return 1;case"image":return Cl(o.groupTexture.ref.value.array)+1;case"texture-mesh":return o.groupCount}}e.getGroupCount=n;function i(o){switch(o.kind){case"mesh":return Nt.Utils;case"points":return Zp.Utils;case"spheres":return Zf.Utils;case"cylinders":return Vo.Utils;case"text":return Bs.Utils;case"lines":return bn.Utils;case"direct-volume":return Ya.Utils;case"image":return Uc.Utils;case"texture-mesh":return Ru.Utils}}e.getUtils=i;function a(o,s){return s==="instance"&&o.nonInstanceable?"group":s}e.getGranularity=a})(ra||(ra={}));var WQ=Fa();function L6e(e,t){switch(t){case e.FRAMEBUFFER_COMPLETE:return"complete";case e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"incomplete attachment";case e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"incomplete missing attachment";case e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"incomplete dimensions";case e.FRAMEBUFFER_UNSUPPORTED:return"unsupported"}if(wr(e))switch(t){case e.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE:return"incomplete multisample";case e.RENDERBUFFER_SAMPLES:return"renderbuffer samples"}return"unknown error"}function TO(e){var t=e.checkFramebufferStatus(e.FRAMEBUFFER);if(t!==e.FRAMEBUFFER_COMPLETE){var r=L6e(e,t);throw new Error("Framebuffer status: "+r)}}function rU(e){var t=e.createFramebuffer();if(t===null)throw new Error("Could not create WebGL framebuffer");return t}function N6e(e){var t=rU(e),r=!1;return{id:WQ(),bind:function(){return e.bindFramebuffer(e.FRAMEBUFFER,t)},reset:function(){t=rU(e)},destroy:function(){r||(e.deleteFramebuffer(t),r=!0)}}}function F6e(){return{id:WQ(),bind:function(){},reset:function(){},destroy:function(){}}}function nU(e){var t=qFe(e);if(t===null)throw new Error('Could not find support for "instanced_arrays"');var r=$Fe(e);if(r===null)throw new Error('Could not find support for "element_index_uint"');var n=WFe(e);Mr&&n===null&&console.log('Could not find support for "standard_derivatives"');var i=YFe(e);Mr&&i===null&&console.log('Could not find support for "texture_float"');var a=KFe(e);Mr&&a===null&&console.log('Could not find support for "texture_float_linear"');var o=QFe(e);Mr&&o===null&&console.log('Could not find support for "texture_half_float"');var s=ZFe(e);Mr&&s===null&&console.log('Could not find support for "texture_half_float_linear"');var u=aBe(e);Mr&&u===null&&console.log('Could not find support for "depth_texture"');var l=JFe(e);Mr&&l===null&&console.log('Could not find support for "blend_minmax"');var c=XFe(e);Mr&&c===null&&console.log('Could not find support for "vertex_array_object"');var d=eBe(e);Mr&&d===null&&console.log('Could not find support for "frag_depth"');var f=tBe(e);Mr&&f===null&&console.log('Could not find support for "color_buffer_float"');var h=rBe(e);Mr&&h===null&&console.log('Could not find support for "color_buffer_half_float"');var v=nBe(e);Mr&&v===null&&console.log('Could not find support for "draw_buffers"');var p=iBe(e);Mr&&p===null&&console.log('Could not find support for "shader_texture_lod"');var m=oBe(e);return Mr&&m===null&&console.log('Could not find support for "sRGB"'),{instancedArrays:t,standardDerivatives:n,textureFloat:i,textureFloatLinear:a,textureHalfFloat:o,textureHalfFloatLinear:s,elementIndexUint:r,depthTexture:u,blendMinMax:l,vertexArrayObject:c,fragDepth:d,colorBufferFloat:f,colorBufferHalfFloat:h,drawBuffers:v,shaderTextureLod:p,sRGB:m}}function B6e(e){var t={},r=e.getParameter(e.FRONT_FACE),n=e.getParameter(e.CULL_FACE_MODE),i=e.getParameter(e.DEPTH_WRITEMASK),a=e.getParameter(e.COLOR_WRITEMASK),o=e.getParameter(e.COLOR_CLEAR_VALUE),s=e.getParameter(e.BLEND_SRC_RGB),u=e.getParameter(e.BLEND_DST_RGB),l=e.getParameter(e.BLEND_SRC_ALPHA),c=e.getParameter(e.BLEND_DST_ALPHA),d=e.getParameter(e.BLEND_EQUATION_RGB),f=e.getParameter(e.BLEND_EQUATION_ALPHA);return{currentProgramId:-1,currentMaterialId:-1,currentRenderItemId:-1,enable:function(h){t[h]!==!0&&(e.enable(h),t[h]=!0)},disable:function(h){t[h]!==!1&&(e.disable(h),t[h]=!1)},frontFace:function(h){h!==r&&(e.frontFace(h),r=h)},cullFace:function(h){h!==n&&(e.cullFace(h),n=h)},depthMask:function(h){h!==i&&(e.depthMask(h),i=h)},colorMask:function(h,v,p,m){(h!==a[0]||v!==a[1]||p!==a[2]||m!==a[3])&&(e.colorMask(h,v,p,m),a[0]=h,a[1]=v,a[2]=p,a[3]=m)},clearColor:function(h,v,p,m){(h!==o[0]||v!==o[1]||p!==o[2]||m!==o[3])&&(e.clearColor(h,v,p,m),o[0]=h,o[1]=v,o[2]=p,o[3]=m)},blendFunc:function(h,v){(h!==s||v!==u||h!==l||v!==c)&&(e.blendFunc(h,v),s=h,u=v,l=h,c=v)},blendFuncSeparate:function(h,v,p,m){(h!==s||v!==u||p!==l||m!==c)&&(e.blendFuncSeparate(h,v,p,m),s=h,u=v,l=p,c=m)},blendEquation:function(h){(h!==d||h!==f)&&(e.blendEquation(h),d=h,f=h)},blendEquationSeparate:function(h,v){(h!==d||v!==f)&&(e.blendEquationSeparate(h,v),d=h,f=v)},reset:function(){t={},r=e.getParameter(e.FRONT_FACE),n=e.getParameter(e.CULL_FACE_MODE),i=e.getParameter(e.DEPTH_WRITEMASK),a=e.getParameter(e.COLOR_WRITEMASK),o=e.getParameter(e.COLOR_CLEAR_VALUE),s=e.getParameter(e.BLEND_SRC_RGB),u=e.getParameter(e.BLEND_DST_RGB),l=e.getParameter(e.BLEND_SRC_ALPHA),c=e.getParameter(e.BLEND_DST_ALPHA),d=e.getParameter(e.BLEND_EQUATION_RGB),f=e.getParameter(e.BLEND_EQUATION_ALPHA)}}}var Cp;(function(e){function t(i,a,o){return{array:i,width:a,height:o}}e.create=t;function r(i){for(var a=i.array,o=i.width,s=i.height,u=o*4,l=0,c=s/2;l<c;++l)for(var d=0,f=u;d<f;++d){var h=l*u+d,v=(s-l-1)*u+d,p=a[h];a[h]=a[v],a[v]=p}return i}e.flipY=r;function n(i){for(var a=i.array,o=0,s=a.length;o<s;o+=4){var u=a[o+3]/255;a[o]/=u,a[o+1]/=u,a[o+2]/=u}return i}e.divideByAlpha=n})(Cp||(Cp={}));var U6e=`
float viewZ = depthToViewZ(uIsOrtho, fragmentDepth, uNear, uFar);
float fogFactor = smoothstep(uFogNear, uFogFar, abs(viewZ));
float fogAlpha = (1.0 - fogFactor) * gl_FragColor.a;
float preFogAlpha = gl_FragColor.a;
if (!uTransparentBackground) {
    if (gl_FragColor.a < 1.0) {
        // transparent objects are blended with background color
        gl_FragColor.a = fogAlpha;
    } else {
        // mix opaque objects with background color
        gl_FragColor.rgb = mix(gl_FragColor.rgb, uFogColor, fogFactor);
    }
} else {
    // pre-multiplied alpha expected for transparent background
    gl_FragColor.rgb *= fogAlpha;
    gl_FragColor.a = fogAlpha;
}
`,j6e=`
if (interior) {
    if (uInteriorColorFlag) {
        gl_FragColor.rgb = uInteriorColor;
    } else {
        gl_FragColor.rgb *= 1.0 - uInteriorDarkening;
    }
}
`,z6e=`
// inputs
// - vec4 material
// - vec3 vViewPosition
// - vec3 normal
// - float uMetalness
// - float uRoughness
// - float uReflectivity
// - float uLightIntensity
// - float uAmbientIntensity

// outputs
// - sets gl_FragColor

vec4 color = material;

ReflectedLight reflectedLight = ReflectedLight(vec3(0.0), vec3(0.0), vec3(0.0));

PhysicalMaterial physicalMaterial;
physicalMaterial.diffuseColor = color.rgb * (1.0 - uMetalness);
physicalMaterial.specularRoughness = clamp(uRoughness, 0.04, 1.0);
physicalMaterial.specularColor = mix(vec3(0.16 * pow2(uReflectivity)), color.rgb, uMetalness);

GeometricContext geometry;
geometry.position = -vViewPosition;
geometry.normal = normal;
geometry.viewDir = normalize(vViewPosition);

IncidentLight directLight;
directLight.direction = vec3(0.0, 0.0, -1.0);
directLight.color = vec3(uLightIntensity);

RE_Direct_Physical(directLight, geometry, physicalMaterial, reflectedLight);

vec3 irradiance = vec3(uAmbientIntensity) * PI;
RE_IndirectDiffuse_Physical(irradiance, geometry, physicalMaterial, reflectedLight);

vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular;

gl_FragColor = vec4(outgoingLight, color.a);

#ifdef dXrayShaded
    gl_FragColor.a *= 1.0 - pow(abs(dot(normal, vec3(0, 0, 1))), uXrayEdgeFalloff);
#endif
`,V6e=`
float marker = floor(vMarker * 255.0 + 0.5); // rounding required to work on some cards on win
if (marker > 0.1) {
    if (intMod(marker, 2.0) > 0.1) {
        gl_FragColor.rgb = mix(uHighlightColor, gl_FragColor.rgb, 0.3);
        gl_FragColor.a = max(0.02, gl_FragColor.a); // for direct-volume rendering
    } else {
        gl_FragColor.rgb = mix(uSelectColor, gl_FragColor.rgb, 0.3);
    }
}
`,H6e=`
#if dClipObjectCount != 0 && defined(dClipping)
    vClipping = readFromTexture(tClipping, aInstance * float(uGroupCount) + group, uClippingTexDim).a;
#endif
`,G6e=`
#if defined(dRenderVariant_color)
    #if defined(dColorType_attribute)
        vColor.rgb = aColor;
    #elif defined(dColorType_instance)
        vColor.rgb = readFromTexture(tColor, aInstance, uColorTexDim).rgb;
    #elif defined(dColorType_group)
        vColor.rgb = readFromTexture(tColor, group, uColorTexDim).rgb;
    #elif defined(dColorType_groupInstance)
        vColor.rgb = readFromTexture(tColor, aInstance * float(uGroupCount) + group, uColorTexDim).rgb;
    #elif defined(dColorType_vertex)
        vColor.rgb = readFromTexture(tColor, VertexID, uColorTexDim).rgb;
    #elif defined(dColorType_vertexInstance)
        vColor.rgb = readFromTexture(tColor, int(aInstance) * uVertexCount + VertexID, uColorTexDim).rgb;
    #elif defined(dColorType_volume)
        vec3 gridPos = (uColorGridTransform.w * (position - uColorGridTransform.xyz)) / uColorGridDim;
        vColor.rgb = texture3dFrom2dLinear(tColorGrid, gridPos, uColorGridDim, uColorTexDim).rgb;
    #elif defined(dColorType_volumeInstance)
        vec3 gridPos = (uColorGridTransform.w * (vModelPosition - uColorGridTransform.xyz)) / uColorGridDim;
        vColor.rgb = texture3dFrom2dLinear(tColorGrid, gridPos, uColorGridDim, uColorTexDim).rgb;
    #endif

    #ifdef dUsePalette
        vPaletteV = ((vColor.r * 256.0 * 256.0 * 255.0 + vColor.g * 256.0 * 255.0 + vColor.b * 255.0) - 1.0) / 16777215.0;
    #endif

    #ifdef dOverpaint
        vOverpaint = readFromTexture(tOverpaint, aInstance * float(uGroupCount) + group, uOverpaintTexDim);
    #endif
#elif defined(dRenderVariant_pick)
    #if defined(dRenderVariant_pickObject)
        vColor = vec4(encodeFloatRGB(float(uObjectId)), 1.0);
    #elif defined(dRenderVariant_pickInstance)
        vColor = vec4(encodeFloatRGB(aInstance), 1.0);
    #elif defined(dRenderVariant_pickGroup)
        vColor = vec4(encodeFloatRGB(group), 1.0);
    #endif
#endif

#ifdef dTransparency
    vGroup = group;
    vTransparency = readFromTexture(tTransparency, aInstance * float(uGroupCount) + group, uTransparencyTexDim).a;
#endif
`,q6e=`
#ifdef dGeoTexture
    float group = decodeFloatRGB(readFromTexture(tGroup, VertexID, uGeoTexDim).rgb);
#else
    float group = aGroup;
#endif
`,W6e=`
vMarker = readFromTexture(tMarker, aInstance * float(uGroupCount) + group, uMarkerTexDim).a;
`,$6e=`
#if defined(dRenderVariant_color)
    #if defined(dUsePalette)
        vec4 material = vec4(texture2D(tPalette, vec2(vPaletteV, 0.5)).rgb, uAlpha);
    #elif defined(dColorType_uniform)
        vec4 material = vec4(uColor, uAlpha);
    #elif defined(dColorType_varying)
        vec4 material = vec4(vColor.rgb, uAlpha);
    #endif

    // mix material with overpaint
    #if defined(dOverpaint)
        material.rgb = mix(material.rgb, vOverpaint.rgb, vOverpaint.a);
    #endif
#elif defined(dRenderVariant_pick)
    vec4 material = vColor;
#elif defined(dRenderVariant_depth)
    #ifdef enabledFragDepth
        vec4 material = packDepthToRGBA(gl_FragDepthEXT);
    #else
        vec4 material = packDepthToRGBA(gl_FragCoord.z);
    #endif
#endif

// apply screendoor transparency
#if defined(dTransparency)
    float ta = 1.0 - vTransparency;

    #if defined(dRenderVariant_pick)
        if (ta < uPickingAlphaThreshold)
            discard; // ignore so the element below can be picked
    #else
        #if defined(dRenderVariant_colorBlended)
            float at = 0.0;

            // shift by view-offset during multi-sample rendering to allow for blending
            vec2 coord = gl_FragCoord.xy + uViewOffset * 0.25;

            const mat4 thresholdMatrix = mat4(
                1.0 / 17.0,  9.0 / 17.0,  3.0 / 17.0, 11.0 / 17.0,
                13.0 / 17.0,  5.0 / 17.0, 15.0 / 17.0,  7.0 / 17.0,
                4.0 / 17.0, 12.0 / 17.0,  2.0 / 17.0, 10.0 / 17.0,
                16.0 / 17.0,  8.0 / 17.0, 14.0 / 17.0,  6.0 / 17.0
            );
            int ci = int(intMod(coord.x, 4.0));
            int ri = int(intMod(coord.y, 4.0));
            #if __VERSION__ == 100
                vec4 i = vec4(float(ci * 4 + ri));
                vec4 v = thresholdMatrix[0] * vec4(equal(i, vec4(0.0, 1.0, 2.0, 3.0))) +
                    thresholdMatrix[1] * vec4(equal(i, vec4(4.0, 5.0, 6.0, 7.0))) +
                    thresholdMatrix[2] * vec4(equal(i, vec4(8.0, 9.0, 10.0, 11.0))) +
                    thresholdMatrix[3] * vec4(equal(i, vec4(12.0, 13.0, 14.0, 15.0)));
                at = v.x + v.y + v.z + v.w;
            #else
                at = thresholdMatrix[ci][ri];
            #endif

            if (ta < 0.99 && (ta < 0.01 || ta < at)) {
                discard;
            }
        #elif defined(dRenderVariant_colorWboit)
            material.a *= ta;
        #endif
    #endif
#endif
`,X6e=`
mat4 model = uModel * aTransform;
mat4 modelView = uView * model;
#ifdef dGeoTexture
    vec3 position = readFromTexture(tPosition, VertexID, uGeoTexDim).xyz;
#else
    vec3 position = aPosition;
#endif
vec4 position4 = vec4(position, 1.0);
// for accessing tColorGrid in vert shader and for clipping in frag shader
vModelPosition = (model * position4).xyz;
vec4 mvPosition = modelView * position4;
vViewPosition = mvPosition.xyz;
gl_Position = uProjection * mvPosition;
`,Y6e=`
#if defined(dSizeType_uniform)
    float size = uSize;
#elif defined(dSizeType_attribute)
    float size = aSize;
#elif defined(dSizeType_instance)
    float size = decodeFloatRGB(readFromTexture(tSize, aInstance, uSizeTexDim).rgb);
#elif defined(dSizeType_group)
    float size = decodeFloatRGB(readFromTexture(tSize, group, uSizeTexDim).rgb);
#elif defined(dSizeType_groupInstance)
    float size = decodeFloatRGB(readFromTexture(tSize, aInstance * float(uGroupCount) + group, uSizeTexDim).rgb);
#endif

#if defined(dSizeType_instance) || defined(dSizeType_group) || defined(dSizeType_groupInstance)
    size /= 100.0; // NOTE factor also set in TypeScript
#endif

size *= uSizeFactor;
`,K6e=`
float viewZ = depthToViewZ(uIsOrtho, fragmentDepth, uNear, uFar);
float fogFactor = smoothstep(uFogNear, uFogFar, abs(viewZ));
float alpha = (1.0 - fogFactor) * uAlpha;
if (uAlpha < uPickingAlphaThreshold || alpha < 0.1)
    discard; // ignore so the element below can be picked
`,Q6e=`
#if defined(dClipVariant_instance) && dClipObjectCount != 0
    int flag = 0;
    #if defined(dClipping)
        flag = int(floor(vClipping * 255.0 + 0.5));
    #endif

    vec4 mCenter = uModel * aTransform * vec4(uInvariantBoundingSphere.xyz, 1.0);
    if (clipTest(vec4(mCenter.xyz, uInvariantBoundingSphere.w), flag))
        // move out of [ -w, +w ] to 'discard' in vert shader
        gl_Position.z = 2.0 * gl_Position.w;
#endif
`,Z6e=`
#if defined(dClipVariant_pixel) && dClipObjectCount != 0
    #if defined(dClipping)
        int clippingFlag = int(floor(vClipping * 255.0 + 0.5));
    #else
        int clippingFlag = 0;
    #endif

    if (clipTest(vec4(vModelPosition, 0.0), clippingFlag))
        discard;
#endif
`,J6e=`
#if defined(dRenderVariant_color)
    #if defined(dColorType_uniform)
        uniform vec3 uColor;
    #elif defined(dColorType_varying)
        varying vec4 vColor;
    #endif

    #ifdef dOverpaint
        varying vec4 vOverpaint;
    #endif
#elif defined(dRenderVariant_pick)
    #if __VERSION__ == 100
        varying vec4 vColor;
    #else
        flat in vec4 vColor;
    #endif
#endif

#ifdef dTransparency
    varying float vGroup;
    varying float vTransparency;
#endif

#ifdef dUsePalette
    uniform sampler2D tPalette;
    varying float vPaletteV;
#endif
`,eNe=`
#if defined(dRenderVariant_color)
    #if defined(dColorType_uniform)
        uniform vec3 uColor;
    #elif defined(dColorType_attribute)
        varying vec4 vColor;
        attribute vec3 aColor;
    #elif defined(dColorType_texture)
        varying vec4 vColor;
        uniform vec2 uColorTexDim;
        uniform sampler2D tColor;
    #elif defined(dColorType_grid)
        varying vec4 vColor;
        uniform vec2 uColorTexDim;
        uniform vec3 uColorGridDim;
        uniform vec4 uColorGridTransform;
        uniform sampler2D tColorGrid;
    #endif

    #ifdef dOverpaint
        varying vec4 vOverpaint;
        uniform vec2 uOverpaintTexDim;
        uniform sampler2D tOverpaint;
    #endif
#elif defined(dRenderVariant_pick)
    #if __VERSION__ == 100
        varying vec4 vColor;
    #else
        flat out vec4 vColor;
    #endif
#endif

#ifdef dTransparency
    varying float vGroup;
    varying float vTransparency;
    uniform vec2 uTransparencyTexDim;
    uniform sampler2D tTransparency;
#endif

#ifdef dUsePalette
    varying float vPaletteV;
#endif
`,tNe=`
#if dClipObjectCount != 0
    vec3 quaternionTransform(vec4 q, vec3 v) {
        vec3 t = 2.0 * cross(q.xyz, v);
        return v + q.w * t + cross(q.xyz, t);
    }

    vec4 computePlane(vec3 normal, vec3 inPoint) {
        return vec4(normalize(normal), -dot(normal, inPoint));
    }

    float planeSD(vec4 plane, vec3 center) {
        return -dot(plane.xyz, center - plane.xyz * -plane.w);
    }

    float sphereSD(vec3 position, vec4 rotation, vec3 size, vec3 center) {
        return (
            length(quaternionTransform(vec4(-rotation.x, -rotation.y, -rotation.z, rotation.w), center - position) / size) - 1.0
        ) * min(min(size.x, size.y), size.z);
    }

    float cubeSD(vec3 position, vec4 rotation, vec3 size, vec3 center) {
        vec3 d = abs(quaternionTransform(vec4(-rotation.x, -rotation.y, -rotation.z, rotation.w), center - position)) - size;
        return min(max(d.x, max(d.y, d.z)), 0.0) + length(max(d, 0.0));
    }

    float cylinderSD(vec3 position, vec4 rotation, vec3 size, vec3 center) {
        vec3 t = quaternionTransform(vec4(-rotation.x, -rotation.y, -rotation.z, rotation.w), center - position);

        vec2 d = abs(vec2(length(t.xz), t.y)) - size.xy;
        return min(max(d.x, d.y), 0.0) + length(max(d, 0.0));
    }

    float infiniteConeSD(vec3 position, vec4 rotation, vec3 size, vec3 center) {
        vec3 t = quaternionTransform(vec4(-rotation.x, -rotation.y, -rotation.z, rotation.w), center - position);

        float q = length(t.xy);
        return dot(size.xy, vec2(q, t.z));
    }

    float getSignedDistance(vec3 center, int type, vec3 position, vec4 rotation, vec3 scale) {
        if (type == 1) {
            vec3 normal = quaternionTransform(rotation, vec3(0.0, 1.0, 0.0));
            vec4 plane = computePlane(normal, position);
            return planeSD(plane, center);
        } else if (type == 2) {
            return sphereSD(position, rotation, scale * 0.5, center);
        } else if (type == 3) {
            return cubeSD(position, rotation, scale * 0.5, center);
        } else if (type == 4) {
            return cylinderSD(position, rotation, scale * 0.5, center);
        } else if (type == 5) {
            return infiniteConeSD(position, rotation, scale * 0.5, center);
        } else {
            return 0.1;
        }
    }

    #if __VERSION__ == 100
        // 8-bit
        int bitwiseAnd(int a, int b) {
            int d = 128;
            int result = 0;
            for (int i = 0; i < 8; ++i) {
                if (d <= 0) break;
                if (a >= d && b >= d) result += d;
                if (a >= d) a -= d;
                if (b >= d) b -= d;
                d /= 2;
            }
            return result;
        }

        bool hasBit(int mask, int bit) {
            return bitwiseAnd(mask, bit) == 0;
        }
    #else
        bool hasBit(int mask, int bit) {
            return (mask & bit) == 0;
        }
    #endif

    // flag is a bit-flag for clip-objects to ignore (note, object ids start at 1 not 0)
    bool clipTest(vec4 sphere, int flag) {
        for (int i = 0; i < dClipObjectCount; ++i) {
            if (flag == 0 || hasBit(flag, i + 1)) {
                // TODO take sphere radius into account?
                bool test = getSignedDistance(sphere.xyz, uClipObjectType[i], uClipObjectPosition[i], uClipObjectRotation[i], uClipObjectScale[i]) <= 0.0;
                if ((!uClipObjectInvert[i] && test) || (uClipObjectInvert[i] && !test)) {
                    return true;
                }
            }
        }
        return false;
    }
#endif
`,rNe=`
uniform int uObjectId;
uniform int uInstanceCount;
uniform int uGroupCount;

#if dClipObjectCount != 0
    uniform int uClipObjectType[dClipObjectCount];
    uniform bool uClipObjectInvert[dClipObjectCount];
    uniform vec3 uClipObjectPosition[dClipObjectCount];
    uniform vec4 uClipObjectRotation[dClipObjectCount];
    uniform vec3 uClipObjectScale[dClipObjectCount];

    #if defined(dClipping)
        #if __VERSION__ == 100
            varying float vClipping;
        #else
            flat in float vClipping;
        #endif
    #endif
#endif

uniform vec3 uHighlightColor;
uniform vec3 uSelectColor;
#if __VERSION__ == 100
    varying float vMarker;
#else
    flat in float vMarker;
#endif

varying vec3 vModelPosition;
varying vec3 vViewPosition;

uniform vec2 uViewOffset;

uniform float uNear;
uniform float uFar;
uniform float uIsOrtho;

uniform float uFogNear;
uniform float uFogFar;
uniform vec3 uFogColor;

uniform float uAlpha;
uniform float uPickingAlphaThreshold;
uniform bool uTransparentBackground;

uniform float uInteriorDarkening;
uniform bool uInteriorColorFlag;
uniform vec3 uInteriorColor;
bool interior;

uniform float uXrayEdgeFalloff;

uniform mat4 uProjection;
`,nNe=`
uniform mat4 uProjection, uModel, uView;
uniform vec3 uCameraPosition;

uniform int uObjectId;
uniform int uVertexCount;
uniform int uInstanceCount;
uniform int uGroupCount;
uniform vec4 uInvariantBoundingSphere;

#if dClipObjectCount != 0
    uniform int uClipObjectType[dClipObjectCount];
    uniform bool uClipObjectInvert[dClipObjectCount];
    uniform vec3 uClipObjectPosition[dClipObjectCount];
    uniform vec4 uClipObjectRotation[dClipObjectCount];
    uniform vec3 uClipObjectScale[dClipObjectCount];

    #if defined(dClipping)
        uniform vec2 uClippingTexDim;
        uniform sampler2D tClipping;
        #if __VERSION__ == 100
            varying float vClipping;
        #else
            flat out float vClipping;
        #endif
    #endif
#endif

uniform vec2 uMarkerTexDim;
uniform sampler2D tMarker;
#if __VERSION__ == 100
    varying float vMarker;
#else
    flat out float vMarker;
#endif

varying vec3 vModelPosition;
varying vec3 vViewPosition;

#if __VERSION__ == 100
    attribute float aVertex;
    #define VertexID int(aVertex)
#else
    // not using gl_VertexID but aVertex to ensure there is an active attribute with divisor 0
    // since FF 85 this is not needed anymore but lets keep it for backwards compatibility
    // https://bugzilla.mozilla.org/show_bug.cgi?id=1679693
    // see also note in src/mol-gl/webgl/render-item.ts
    attribute float aVertex;
    #define VertexID int(aVertex)
    // #define VertexID gl_VertexID
#endif
`,iNe=`
// TODO find a better place for these convenience defines

#if defined(dRenderVariant_colorBlended) || defined(dRenderVariant_colorWboit)
    #define dRenderVariant_color
#endif

#if defined(dRenderVariant_pickObject) || defined(dRenderVariant_pickInstance) || defined(dRenderVariant_pickGroup)
    #define dRenderVariant_pick
#endif

#if defined(dColorType_instance) || defined(dColorType_group) || defined(dColorType_groupInstance) || defined(dColorType_vertex) || defined(dColorType_vertexInstance)
    #define dColorType_texture
#endif

#if defined(dColorType_volume) || defined(dColorType_volumeInstance)
    #define dColorType_grid
#endif

#if defined(dColorType_attribute) || defined(dColorType_texture) || defined(dColorType_grid)
    #define dColorType_varying
#endif

//

#define PI 3.14159265
#define RECIPROCAL_PI 0.31830988618
#define EPSILON 1e-6

#define saturate(a) clamp(a, 0.0, 1.0)

float intDiv(const in float a, const in float b) { return float(int(a) / int(b)); }
vec2 ivec2Div(const in vec2 a, const in vec2 b) { return vec2(ivec2(a) / ivec2(b)); }
float intMod(const in float a, const in float b) { return a - b * float(int(a) / int(b)); }
int imod(const in int a, const in int b) { return a - b * (a / b); }

float pow2(const in float x) { return x * x; }

const float maxFloat = 10000.0; // NOTE constant also set in TypeScript
const float floatLogFactor = 9.210440366976517; // log(maxFloat + 1.0);
float encodeFloatLog(const in float value) { return log(value + 1.0) / floatLogFactor; }
float decodeFloatLog(const in float value) { return exp(value * floatLogFactor) - 1.0; }

vec3 encodeFloatRGB(in float value) {
    value = clamp(value, 0.0, 16777216.0 - 1.0) + 1.0;
    vec3 c = vec3(0.0);
    c.b = mod(value, 256.0);
    value = floor(value / 256.0);
    c.g = mod(value, 256.0);
    value = floor(value / 256.0);
    c.r = mod(value, 256.0);
    return c / 255.0;
}
float decodeFloatRGB(const in vec3 rgb) {
    return (rgb.r * 256.0 * 256.0 * 255.0 + rgb.g * 256.0 * 255.0 + rgb.b * 255.0) - 1.0;
}

vec2 packUnitIntervalToRG(const in float v) {
    vec2 enc;
    enc.xy = vec2(fract(v * 256.0), v);
    enc.y -= enc.x * (1.0 / 256.0);
    enc.xy *=  256.0 / 255.0;

    return enc;
}

float unpackRGToUnitInterval(const in vec2 enc) {
    return dot(enc, vec2(255.0 / (256.0 * 256.0), 255.0 / 256.0));
}

vec3 screenSpaceToViewSpace(const in vec3 ssPos, const in mat4 invProjection) {
    vec4 p = vec4(ssPos * 2.0 - 1.0, 1.0);
    p = invProjection * p;
    return p.xyz / p.w;
}

const float PackUpscale = 256.0 / 255.0; // fraction -> 0..1 (including 1)
const float UnpackDownscale = 255.0 / 256.0; // 0..1 -> fraction (excluding 1)
const vec3 PackFactors = vec3(256.0 * 256.0 * 256.0, 256.0 * 256.0,  256.0);
const vec4 UnpackFactors = UnpackDownscale / vec4(PackFactors, 1.0);
const float ShiftRight8 = 1.0 / 256.0;

vec4 packDepthToRGBA(const in float v) {
    vec4 r = vec4(fract(v * PackFactors), v);
    r.yzw -= r.xyz * ShiftRight8; // tidy overflow
    return r * PackUpscale;
}
float unpackRGBAToDepth(const in vec4 v) {
    return dot(v, UnpackFactors);
}

vec4 sRGBToLinear(const in vec4 c) {
    return vec4(mix(pow(c.rgb * 0.9478672986 + vec3(0.0521327014), vec3(2.4)), c.rgb * 0.0773993808, vec3(lessThanEqual(c.rgb, vec3(0.04045)))), c.a);
}
vec4 linearTosRGB(const in vec4 c) {
    return vec4(mix(pow(c.rgb, vec3(0.41666)) * 1.055 - vec3(0.055), c.rgb * 12.92, vec3(lessThanEqual(c.rgb, vec3(0.0031308)))), c.a);
}

float linearizeDepth(const in float depth, const in float near, const in float far) {
    return (2.0 * near) / (far + near - depth * (far - near));
}

float perspectiveDepthToViewZ(const in float invClipZ, const in float near, const in float far) {
    return (near * far) / ((far - near) * invClipZ - far);
}

float orthographicDepthToViewZ(const in float linearClipZ, const in float near, const in float far) {
    return linearClipZ * (near - far) - near;
}

float depthToViewZ(const in float isOrtho, const in float linearClipZ, const in float near, const in float far) {
    return isOrtho == 1.0 ? orthographicDepthToViewZ(linearClipZ, near, far) : perspectiveDepthToViewZ(linearClipZ, near, far);
}

#if __VERSION__ == 100
    // transpose

    float transpose(const in float m) {
        return m;
    }

    mat2 transpose2(const in mat2 m) {
        return mat2(
            m[0][0], m[1][0],
            m[0][1], m[1][1]
        );
    }

    mat3 transpose3(const in mat3 m) {
        return mat3(
            m[0][0], m[1][0], m[2][0],
            m[0][1], m[1][1], m[2][1],
            m[0][2], m[1][2], m[2][2]
        );
    }

    mat4 transpose4(const in mat4 m) {
        return mat4(
            m[0][0], m[1][0], m[2][0], m[3][0],
            m[0][1], m[1][1], m[2][1], m[3][1],
            m[0][2], m[1][2], m[2][2], m[3][2],
            m[0][3], m[1][3], m[2][3], m[3][3]
        );
    }

    // inverse

    float inverse(const in float m) {
        return 1.0 / m;
    }

    mat2 inverse2(const in mat2 m) {
        return mat2(m[1][1],-m[0][1],
                -m[1][0], m[0][0]) / (m[0][0]*m[1][1] - m[0][1]*m[1][0]);
    }

    mat3 inverse3(const in mat3 m) {
        float a00 = m[0][0], a01 = m[0][1], a02 = m[0][2];
        float a10 = m[1][0], a11 = m[1][1], a12 = m[1][2];
        float a20 = m[2][0], a21 = m[2][1], a22 = m[2][2];

        float b01 = a22 * a11 - a12 * a21;
        float b11 = -a22 * a10 + a12 * a20;
        float b21 = a21 * a10 - a11 * a20;

        float det = a00 * b01 + a01 * b11 + a02 * b21;

        return mat3(b01, (-a22 * a01 + a02 * a21), (a12 * a01 - a02 * a11),
                    b11, (a22 * a00 - a02 * a20), (-a12 * a00 + a02 * a10),
                    b21, (-a21 * a00 + a01 * a20), (a11 * a00 - a01 * a10)) / det;
    }

    mat4 inverse4(const in mat4 m) {
        float
            a00 = m[0][0], a01 = m[0][1], a02 = m[0][2], a03 = m[0][3],
            a10 = m[1][0], a11 = m[1][1], a12 = m[1][2], a13 = m[1][3],
            a20 = m[2][0], a21 = m[2][1], a22 = m[2][2], a23 = m[2][3],
            a30 = m[3][0], a31 = m[3][1], a32 = m[3][2], a33 = m[3][3],

            b00 = a00 * a11 - a01 * a10,
            b01 = a00 * a12 - a02 * a10,
            b02 = a00 * a13 - a03 * a10,
            b03 = a01 * a12 - a02 * a11,
            b04 = a01 * a13 - a03 * a11,
            b05 = a02 * a13 - a03 * a12,
            b06 = a20 * a31 - a21 * a30,
            b07 = a20 * a32 - a22 * a30,
            b08 = a20 * a33 - a23 * a30,
            b09 = a21 * a32 - a22 * a31,
            b10 = a21 * a33 - a23 * a31,
            b11 = a22 * a33 - a23 * a32,

            det = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;

        return mat4(
            a11 * b11 - a12 * b10 + a13 * b09,
            a02 * b10 - a01 * b11 - a03 * b09,
            a31 * b05 - a32 * b04 + a33 * b03,
            a22 * b04 - a21 * b05 - a23 * b03,
            a12 * b08 - a10 * b11 - a13 * b07,
            a00 * b11 - a02 * b08 + a03 * b07,
            a32 * b02 - a30 * b05 - a33 * b01,
            a20 * b05 - a22 * b02 + a23 * b01,
            a10 * b10 - a11 * b08 + a13 * b06,
            a01 * b08 - a00 * b10 - a03 * b06,
            a30 * b04 - a31 * b02 + a33 * b00,
            a21 * b02 - a20 * b04 - a23 * b00,
            a11 * b07 - a10 * b09 - a12 * b06,
            a00 * b09 - a01 * b07 + a02 * b06,
            a31 * b01 - a30 * b03 - a32 * b00,
            a20 * b03 - a21 * b01 + a22 * b00) / det;
    }
#else
    #define transpose2(m) transpose(m)
    #define transpose3(m) transpose(m)
    #define transpose4(m) transpose(m)

    #define inverse2(m) inverse(m)
    #define inverse3(m) inverse(m)
    #define inverse4(m) inverse(m)
#endif
`,aNe=`
    // floatToRgba adapted from https://github.com/equinor/glsl-float-to-rgba
    // MIT License, Copyright (c) 2020 Equinor

    float shiftRight (float v, float amt) {
    v = floor(v) + 0.5;
    return floor(v / exp2(amt));
    }
    float shiftLeft (float v, float amt) {
        return floor(v * exp2(amt) + 0.5);
    }
    float maskLast (float v, float bits) {
        return mod(v, shiftLeft(1.0, bits));
    }
    float extractBits (float num, float from, float to) {
        from = floor(from + 0.5); to = floor(to + 0.5);
        return maskLast(shiftRight(num, from), to - from);
    }

    vec4 floatToRgba(float texelFloat, bool littleEndian) {
        if (texelFloat == 0.0) return vec4(0.0, 0.0, 0.0, 0.0);
        float sign = texelFloat > 0.0 ? 0.0 : 1.0;
        texelFloat = abs(texelFloat);
        float exponent = floor(log2(texelFloat));
        float biased_exponent = exponent + 127.0;
        float fraction = ((texelFloat / exp2(exponent)) - 1.0) * 8388608.0;
        float t = biased_exponent / 2.0;
        float last_bit_of_biased_exponent = fract(t) * 2.0;
        float remaining_bits_of_biased_exponent = floor(t);
        float byte4 = extractBits(fraction, 0.0, 8.0) / 255.0;
        float byte3 = extractBits(fraction, 8.0, 16.0) / 255.0;
        float byte2 = (last_bit_of_biased_exponent * 128.0 + extractBits(fraction, 16.0, 23.0)) / 255.0;
        float byte1 = (sign * 128.0 + remaining_bits_of_biased_exponent) / 255.0;
        return (
            littleEndian
                ? vec4(byte4, byte3, byte2, byte1)
                : vec4(byte1, byte2, byte3, byte4)
        );
    }
`,oNe=`
uniform float uLightIntensity;
uniform float uAmbientIntensity;
uniform float uReflectivity;
uniform float uMetalness;
uniform float uRoughness;

struct PhysicalMaterial {
    vec3 diffuseColor;
    float specularRoughness;
    vec3 specularColor;
};

struct IncidentLight {
    vec3 color;
    vec3 direction;
};

struct ReflectedLight {
    vec3 directDiffuse;
    vec3 directSpecular;
    vec3 indirectDiffuse;
};

struct GeometricContext {
    vec3 position;
    vec3 normal;
    vec3 viewDir;
};

vec3 F_Schlick(const in vec3 specularColor, const in float dotLH) {
    // Original approximation by Christophe Schlick '94
    // float fresnel = pow( 1.0 - dotLH, 5.0 );
    // Optimized variant (presented by Epic at SIGGRAPH '13)
    // https://cdn2.unrealengine.com/Resources/files/2013SiggraphPresentationsNotes-26915738.pdf
    float fresnel = exp2((-5.55473 * dotLH - 6.98316) * dotLH);
    return (1.0 - specularColor) * fresnel + specularColor;
}

// Moving Frostbite to Physically Based Rendering 3.0 - page 12, listing 2
// https://seblagarde.files.wordpress.com/2015/07/course_notes_moving_frostbite_to_pbr_v32.pdf
float G_GGX_SmithCorrelated(const in float alpha, const in float dotNL, const in float dotNV) {
    float a2 = pow2(alpha);
    // dotNL and dotNV are explicitly swapped. This is not a mistake.
    float gv = dotNL * sqrt(a2 + (1.0 - a2) * pow2(dotNV));
    float gl = dotNV * sqrt(a2 + (1.0 - a2) * pow2(dotNL));
    return 0.5 / max(gv + gl, EPSILON);
}

// Microfacet Models for Refraction through Rough Surfaces - equation (33)
// http://graphicrants.blogspot.com/2013/08/specular-brdf-reference.html
// alpha is "roughness squared" in Disney’s reparameterization
float D_GGX(const in float alpha, const in float dotNH) {
    float a2 = pow2(alpha);
    float denom = pow2(dotNH) * (a2 - 1.0) + 1.0; // avoid alpha = 0 with dotNH = 1
    return RECIPROCAL_PI * a2 / pow2(denom);
}

vec3 BRDF_Diffuse_Lambert(const in vec3 diffuseColor) {
    return RECIPROCAL_PI * diffuseColor;
}

// GGX Distribution, Schlick Fresnel, GGX-Smith Visibility
vec3 BRDF_Specular_GGX(const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float roughness) {
    float alpha = pow2(roughness); // UE4's roughness
    vec3 halfDir = normalize(incidentLight.direction + geometry.viewDir);

    float dotNL = saturate(dot(geometry.normal, incidentLight.direction));
    float dotNV = saturate(dot(geometry.normal, geometry.viewDir));
    float dotNH = saturate(dot(geometry.normal, halfDir));
    float dotLH = saturate(dot(incidentLight.direction, halfDir));

    vec3 F = F_Schlick(specularColor, dotLH);
    float G = G_GGX_SmithCorrelated(alpha, dotNL, dotNV);
    float D = D_GGX(alpha, dotNH);
    return F * (G * D);
}

// ref: https://www.unrealengine.com/blog/physically-based-shading-on-mobile - environmentBRDF for GGX on mobile
vec3 BRDF_Specular_GGX_Environment(const in GeometricContext geometry, const in vec3 specularColor, const in float roughness) {
    float dotNV = saturate(dot(geometry.normal, geometry.viewDir));
    const vec4 c0 = vec4(-1, -0.0275, -0.572, 0.022);
    const vec4 c1 = vec4(1, 0.0425, 1.04, -0.04);
    vec4 r = roughness * c0 + c1;
    float a004 = min(r.x * r.x, exp2(-9.28 * dotNV)) * r.x + r.y;
    vec2 AB = vec2(-1.04, 1.04) * a004 + r.zw;
    return specularColor * AB.x + AB.y;
}

void RE_Direct_Physical(const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
    float dotNL = saturate(dot(geometry.normal, directLight.direction));
    vec3 irradiance = dotNL * directLight.color;
    irradiance *= PI; // punctual light

    reflectedLight.directSpecular += irradiance * BRDF_Specular_GGX(directLight, geometry, material.specularColor, material.specularRoughness);
    reflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert(material.diffuseColor);
}

void RE_IndirectDiffuse_Physical(const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
    reflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert(material.diffuseColor);
}
`,sNe=`
float matrixScale(in mat4 m){
    vec4 r = m[0];
    return sqrt(r[0] * r[0] + r[1] * r[1] + r[2] * r[2]);
}
`,uNe=`
varying vec3 vNormal;
`,lNe=`
vec4 readFromTexture(const in sampler2D tex, const in float i, const in vec2 dim) {
    float x = intMod(i, dim.x);
    float y = floor(intDiv(i, dim.x));
    vec2 uv = (vec2(x, y) + 0.5) / dim;
    return texture2D(tex, uv);
}

vec4 readFromTexture(const in sampler2D tex, const in int i, const in vec2 dim) {
    int x = imod(i, int(dim.x));
    int y = i / int(dim.x);
    vec2 uv = (vec2(x, y) + 0.5) / dim;
    return texture2D(tex, uv);
}
`,cNe=`
    // rgbaToFloat adapted from https://github.com/ihmeuw/glsl-rgba-to-float
    // BSD 3-Clause License
    //
    // Copyright (c) 2019, Institute for Health Metrics and Evaluation All rights reserved.
    // Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:
    //  - Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.
    //  - Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.
    //  - Neither the name of the copyright holder nor the names of its contributors may be used to endorse or promote products derived from this software without specific prior written permission.
    //
    // THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES,
    // INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.
    // IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY,
    // OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA,
    // OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
    // OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED
    // OF THE POSSIBILITY OF SUCH DAMAGE.

    ivec4 floatsToBytes(vec4 inputFloats, bool littleEndian) {
        ivec4 bytes = ivec4(inputFloats * 255.0);
        return (
            littleEndian
                ? bytes.abgr
                : bytes
        );
    }

    // Break the four bytes down into an array of 32 bits.
    void bytesToBits(const in ivec4 bytes, out bool bits[32]) {
        for (int channelIndex = 0; channelIndex < 4; ++channelIndex) {
            float acc = float(bytes[channelIndex]);
            for (int indexInByte = 7; indexInByte >= 0; --indexInByte) {
                float powerOfTwo = exp2(float(indexInByte));
                bool bit = acc >= powerOfTwo;
                bits[channelIndex * 8 + (7 - indexInByte)] = bit;
                acc = mod(acc, powerOfTwo);
            }
        }
    }

    // Compute the exponent of the 32-bit float.
    float getExponent(bool bits[32]) {
        const int startIndex = 1;
        const int bitStringLength = 8;
        const int endBeforeIndex = startIndex + bitStringLength;
        float acc = 0.0;
        int pow2 = bitStringLength - 1;
        for (int bitIndex = startIndex; bitIndex < endBeforeIndex; ++bitIndex) {
            acc += float(bits[bitIndex]) * exp2(float(pow2--));
        }
        return acc;
    }

    // Compute the mantissa of the 32-bit float.
    float getMantissa(bool bits[32], bool subnormal) {
        const int startIndex = 9;
        const int bitStringLength = 23;
        const int endBeforeIndex = startIndex + bitStringLength;
        // Leading/implicit/hidden bit convention:
        // If the number is not subnormal (with exponent 0), we add a leading 1 digit.
        float acc = float(!subnormal) * exp2(float(bitStringLength));
        int pow2 = bitStringLength - 1;
        for (int bitIndex = startIndex; bitIndex < endBeforeIndex; ++bitIndex) {
            acc += float(bits[bitIndex]) * exp2(float(pow2--));
        }
        return acc;
    }

    // Parse the float from its 32 bits.
    float bitsToFloat(bool bits[32]) {
        float signBit = float(bits[0]) * -2.0 + 1.0;
        float exponent = getExponent(bits);
        bool subnormal = abs(exponent - 0.0) < 0.01;
        float mantissa = getMantissa(bits, subnormal);
        float exponentBias = 127.0;
        return signBit * mantissa * exp2(exponent - exponentBias - 23.0);
    }

    float rgbaToFloat(vec4 texelRGBA, bool littleEndian) {
        ivec4 rgbaBytes = floatsToBytes(texelRGBA, littleEndian);
        bool bits[32];
        bytesToBits(rgbaBytes, bits);
        return bitsToFloat(bits);
    }
`,dNe=`
#if defined(dSizeType_uniform)
    uniform float uSize;
#elif defined(dSizeType_attribute)
    attribute float aSize;
#elif defined(dSizeType_instance) || defined(dSizeType_group) || defined(dSizeType_groupInstance)
    uniform vec2 uSizeTexDim;
    uniform sampler2D tSize;
#endif

uniform float uSizeFactor;
`,fNe=`
vec4 texture3dFrom1dTrilinear(const in sampler2D tex, const in vec3 pos, const in vec3 gridDim, const in vec2 texDim, const in float offset) {
    float gdYZ = gridDim.z * gridDim.y;
    float gdZ = gridDim.z;
    vec3 p0 = floor(pos * gridDim);
    vec3 p1 = ceil(pos * gridDim);
    vec3 pd = (pos * gridDim - p0) / (p1 - p0);
    vec4 s000 = readFromTexture(tex, offset + p0.z + p0.y * gdZ + p0.x * gdYZ, texDim);
    vec4 s100 = readFromTexture(tex, offset + p0.z + p0.y * gdZ + p1.x * gdYZ, texDim);
    vec4 s001 = readFromTexture(tex, offset + p1.z + p0.y * gdZ + p0.x * gdYZ, texDim);
    vec4 s101 = readFromTexture(tex, offset + p1.z + p0.y * gdZ + p1.x * gdYZ, texDim);
    vec4 s010 = readFromTexture(tex, offset + p0.z + p1.y * gdZ + p0.x * gdYZ, texDim);
    vec4 s110 = readFromTexture(tex, offset + p0.z + p1.y * gdZ + p1.x * gdYZ, texDim);
    vec4 s011 = readFromTexture(tex, offset + p1.z + p1.y * gdZ + p0.x * gdYZ, texDim);
    vec4 s111 = readFromTexture(tex, offset + p1.z + p1.y * gdZ + p1.x * gdYZ, texDim);
    vec4 s00 = mix(s000, s100, pd.x);
    vec4 s01 = mix(s001, s101, pd.x);
    vec4 s10 = mix(s010, s110, pd.x);
    vec4 s11 = mix(s011, s111, pd.x);
    vec4 s0 = mix(s00, s10, pd.y);
    vec4 s1 = mix(s01, s11, pd.y);
    return mix(s0, s1, pd.z);
}
`,hNe=`
vec4 texture3dFrom2dLinear(sampler2D tex, vec3 pos, vec3 gridDim, vec2 texDim) {
    float zSlice0 = floor(pos.z * gridDim.z);
    float column0 = intMod(zSlice0 * gridDim.x, texDim.x) / gridDim.x;
    float row0 = floor(intDiv(zSlice0 * gridDim.x, texDim.x));
    vec2 coord0 = (vec2(column0 * gridDim.x, row0 * gridDim.y) + (pos.xy * gridDim.xy)) / texDim;
    vec4 color0 = texture2D(tex, coord0);

    float zSlice1 = zSlice0 + 1.0;
    float column1 = intMod(zSlice1 * gridDim.x, texDim.x) / gridDim.x;
    float row1 = floor(intDiv(zSlice1 * gridDim.x, texDim.x));
    vec2 coord1 = (vec2(column1 * gridDim.x, row1 * gridDim.y) + (pos.xy * gridDim.xy)) / texDim;
    vec4 color1 = texture2D(tex, coord1);

    float delta0 = abs((pos.z * gridDim.z) - zSlice0);
    return mix(color0, color1, delta0);
}
`,pNe=`
vec4 texture3dFrom2dNearest(sampler2D tex, vec3 pos, vec3 gridDim, vec2 texDim) {
    float zSlice = floor(pos.z * gridDim.z + 0.5); // round to nearest z-slice
    float column = intMod(zSlice * gridDim.x, texDim.x) / gridDim.x;
    float row = floor(intDiv(zSlice * gridDim.x, texDim.x));
    vec2 coord = (vec2(column * gridDim.x, row * gridDim.y) + (pos.xy * gridDim.xy)) / texDim;
    return texture2D(tex, coord);
}
`,vNe=`
#if defined(dRenderVariant_colorWboit)
    #if !defined(dRenderMode_volume) && !defined(dRenderMode_isosurface)
        uniform sampler2D tDepth;
        uniform vec2 uDrawingBufferSize;

        float getDepth(const in vec2 coords) {
            // always packed due to merged depth from primitives and volumes
            return unpackRGBAToDepth(texture2D(tDepth, coords));
        }
    #endif
#endif

uniform bool uRenderWboit;

float calcDepth(const in vec3 pos) {
    vec2 clipZW = pos.z * uProjection[2].zw + uProjection[3].zw;
    return 0.5 + 0.5 * clipZW.x / clipZW.y;
}
`,mNe=`
#if defined(dRenderVariant_colorWboit)
    if (!uRenderWboit) {
        if (preFogAlpha < 1.0) {
            discard;
        }
    } else if (uRenderWboit) {
        // the 'fragmentDepth > 0.99' check is to handle precision issues with packed depth
        if (preFogAlpha != 1.0 && !interior && (fragmentDepth < getDepth(gl_FragCoord.xy / uDrawingBufferSize) || fragmentDepth > 0.99)) {
            float alpha = gl_FragColor.a;
            float wboitWeight = alpha * clamp(pow(1.0 - fragmentDepth, 2.0), 0.01, 1.0);
            gl_FragColor = vec4(gl_FragColor.rgb * alpha * wboitWeight, alpha);
            // extra alpha is to handle pre-multiplied alpha
            #if !defined(dRenderMode_volume) && !defined(dRenderMode_isosurface)
                gl_FragData[1] = vec4((uTransparentBackground ? alpha : 1.0) * alpha * wboitWeight);
            #else
                gl_FragData[1] = vec4(alpha * alpha * wboitWeight);
            #endif
        } else {
            discard;
        }
    }
#endif
`,gNe=`
precision highp float;
precision highp int;

#include common
#include read_from_texture
#include common_vert_params
#include color_vert_params
#include size_vert_params
#include common_clip

uniform float uPixelRatio;
uniform float uViewportHeight;

attribute vec3 aPosition;
attribute mat4 aTransform;
attribute float aInstance;
attribute float aGroup;

void main(){
    #include assign_group
    #include assign_color_varying
    #include assign_marker_varying
    #include assign_clipping_varying
    #include assign_position
    #include assign_size

    #ifdef dPointSizeAttenuation
        gl_PointSize = size * uPixelRatio * ((uViewportHeight / 2.0) / -mvPosition.z) * 5.0;
    #else
        gl_PointSize = size * uPixelRatio;
    #endif

    gl_Position = uProjection * mvPosition;

    #include clip_instance
}
`,yNe=`
precision highp float;
precision highp int;

#include common
#include common_frag_params
#include color_frag_params
#include common_clip
#include wboit_params

#ifdef dPointFilledCircle
    uniform float uPointEdgeBleach;
#endif

const vec2 center = vec2(0.5);
const float radius = 0.5;

void main(){
    #include clip_pixel

    float fragmentDepth = gl_FragCoord.z;
    bool interior = false;
    #include assign_material_color

    #if defined(dRenderVariant_pick)
        #include check_picking_alpha
        gl_FragColor = material;
    #elif defined(dRenderVariant_depth)
        gl_FragColor = material;
    #elif defined(dRenderVariant_color)
        gl_FragColor = material;

        #ifdef dPointFilledCircle
            float dist = distance(gl_PointCoord, center);
            float alpha = 1.0 - smoothstep(radius - uPointEdgeBleach, radius, dist);
            if (alpha < 0.0001) discard;
            gl_FragColor.a *= alpha;
        #endif

        #include apply_marker_color
        #include apply_fog
        #include wboit_write
    #endif
}
`,bNe=`
precision highp float;
precision highp int;

#include common
#include read_from_texture
#include common_vert_params
#include color_vert_params
#include size_vert_params
#include common_clip

uniform mat4 uModelView;
uniform mat4 uInvProjection;

attribute vec3 aPosition;
attribute vec2 aMapping;
attribute mat4 aTransform;
attribute float aInstance;
attribute float aGroup;

varying float vRadius;
varying float vRadiusSq;
varying vec3 vPoint;
varying vec3 vPointViewPosition;

#include matrix_scale

const mat4 D = mat4(
    1.0, 0.0, 0.0, 0.0,
    0.0, 1.0, 0.0, 0.0,
    0.0, 0.0, 1.0, 0.0,
    0.0, 0.0, 0.0, -1.0
);

/**
 * Compute point size and center using the technique described in:
 * "GPU-Based Ray-Casting of Quadratic Surfaces" http://dl.acm.org/citation.cfm?id=2386396
 * by Christian Sigg, Tim Weyrich, Mario Botsch, Markus Gross.
 */
void quadraticProjection(const in float radius, const in vec3 position){
    vec2 xbc, ybc;

    mat4 T = mat4(
        radius, 0.0, 0.0, 0.0,
        0.0, radius, 0.0, 0.0,
        0.0, 0.0, radius, 0.0,
        position.x, position.y, position.z, 1.0
    );

    mat4 R = transpose4(uProjection * uModelView * aTransform * T);
    float A = dot(R[3], D * R[3]);
    float B = -2.0 * dot(R[0], D * R[3]);
    float C = dot(R[0], D * R[0]);
    xbc[0] = (-B - sqrt(B * B - 4.0 * A * C)) / (2.0 * A);
    xbc[1] = (-B + sqrt(B * B - 4.0 * A * C)) / (2.0 * A);
    float sx = abs(xbc[0] - xbc[1]) * 0.5;

    A = dot(R[3], D * R[3]);
    B = -2.0 * dot(R[1], D * R[3]);
    C = dot(R[1], D * R[1]);
    ybc[0] = (-B - sqrt(B * B - 4.0 * A * C)) / (2.0 * A);
    ybc[1] = (-B + sqrt(B * B - 4.0 * A * C)) / (2.0 * A);
    float sy = abs(ybc[0] - ybc[1]) * 0.5;

    gl_Position.xy = vec2(0.5 * (xbc.x + xbc.y), 0.5 * (ybc.x + ybc.y));
    gl_Position.xy -= aMapping * vec2(sx, sy);
    gl_Position.xy *= gl_Position.w;
}


void main(void){
    #include assign_group
    #include assign_color_varying
    #include assign_marker_varying
    #include assign_clipping_varying
    #include assign_size

    vRadius = size * matrixScale(uModelView);

    vec4 position4 = vec4(aPosition, 1.0);
    vec4 mvPosition = uModelView * aTransform * position4;
    mvPosition.z -= vRadius; // avoid clipping, added again in fragment shader

    gl_Position = uProjection * vec4(mvPosition.xyz, 1.0);
    quadraticProjection(size, aPosition);

    vRadiusSq = vRadius * vRadius;
    vec4 vPoint4 = uInvProjection * gl_Position;
    vPoint = vPoint4.xyz / vPoint4.w;
    vPointViewPosition = -mvPosition.xyz / mvPosition.w;

    vModelPosition = (uModel * aTransform * position4).xyz; // for clipping in frag shader

    #include clip_instance
}
`,xNe=`
precision highp float;
precision highp int;

#include common
#include common_frag_params
#include color_frag_params
#include light_frag_params
#include common_clip
#include wboit_params

varying float vRadius;
varying float vRadiusSq;
varying vec3 vPoint;
varying vec3 vPointViewPosition;

vec3 cameraPos;
vec3 cameraNormal;

bool Impostor(out vec3 cameraPos, out vec3 cameraNormal){
    vec3 cameraSpherePos = -vPointViewPosition;
    cameraSpherePos.z += vRadius;

    vec3 rayOrigin = mix(vec3(0.0, 0.0, 0.0), vPoint, uIsOrtho);
    vec3 rayDirection = mix(normalize(vPoint), vec3(0.0, 0.0, 1.0), uIsOrtho);
    vec3 cameraSphereDir = mix(cameraSpherePos, rayOrigin - cameraSpherePos, uIsOrtho);

    float B = dot(rayDirection, cameraSphereDir);
    float det = B * B + vRadiusSq - dot(cameraSphereDir, cameraSphereDir);

    if (det < 0.0){
        discard;
        return false;
    }

    float sqrtDet = sqrt(det);
    float posT = mix(B + sqrtDet, B + sqrtDet, uIsOrtho);
    float negT = mix(B - sqrtDet, sqrtDet - B, uIsOrtho);

    cameraPos = rayDirection * negT + rayOrigin;


    if (calcDepth(cameraPos) <= 0.0) {
        cameraPos = rayDirection * posT + rayOrigin;
        interior = true;
    } else {
        interior = false;
    }

    cameraNormal = normalize(cameraPos - cameraSpherePos);
    cameraNormal *= float(!interior) * 2.0 - 1.0;

    return !interior;
}

void main(void){
    #include clip_pixel

    bool flag = Impostor(cameraPos, cameraNormal);
    #ifndef dDoubleSided
        if (interior)
            discard;
    #endif

    vec3 vViewPosition = cameraPos;
    gl_FragDepthEXT = calcDepth(vViewPosition);
    if (!flag && gl_FragDepthEXT >= 0.0) {
        gl_FragDepthEXT = 0.0 + (0.0000001 / vRadius);
    }

    // bugfix (mac only?)
    if (gl_FragDepthEXT < 0.0) discard;
    if (gl_FragDepthEXT > 1.0) discard;

    float fragmentDepth = gl_FragDepthEXT;
    #include assign_material_color

    #if defined(dRenderVariant_pick)
        #include check_picking_alpha
        gl_FragColor = material;
    #elif defined(dRenderVariant_depth)
        gl_FragColor = material;
    #elif defined(dRenderVariant_color)
        #ifdef dIgnoreLight
            gl_FragColor = material;
        #else
            vec3 normal = -cameraNormal;
            #include apply_light_color
        #endif

        #include apply_interior_color
        #include apply_marker_color
        #include apply_fog
        #include wboit_write
    #endif
}
`,SNe=`
precision highp float;
precision highp int;

#include common
#include read_from_texture
#include common_vert_params
#include color_vert_params
#include size_vert_params
#include common_clip

uniform mat4 uModelView;

attribute mat4 aTransform;
attribute float aInstance;
attribute float aGroup;

attribute vec3 aMapping;
attribute vec3 aStart;
attribute vec3 aEnd;
attribute float aScale;
attribute float aCap;

varying mat4 vTransform;
varying vec3 vStart;
varying vec3 vEnd;
varying float vSize;
varying float vCap;

uniform float uIsOrtho;
uniform vec3 uCameraDir;

void main() {
    #include assign_group
    #include assign_color_varying
    #include assign_marker_varying
    #include assign_clipping_varying
    #include assign_size

    mat4 modelTransform = uModel * aTransform;

    vTransform = aTransform;
    vStart = (modelTransform * vec4(aStart, 1.0)).xyz;
    vEnd = (modelTransform * vec4(aEnd, 1.0)).xyz;
    vSize = size * aScale;
    vCap = aCap;

    vModelPosition = (vStart + vEnd) * 0.5;
    vec3 camDir = -mix(normalize(vModelPosition - uCameraPosition), uCameraDir, uIsOrtho);
    vec3 dir = vEnd - vStart;
    // ensure cylinder 'dir' is pointing towards the camera
    if(dot(camDir, dir) < 0.0) dir = -dir;

    vec3 left = cross(camDir, dir);
    vec3 up = cross(left, dir);
    left = vSize * normalize(left);
    up = vSize * normalize(up);

    // move vertex in object-space from center to corner
    vModelPosition += aMapping.x * dir + aMapping.y * left + aMapping.z * up;

    vec4 mvPosition = uView * vec4(vModelPosition, 1.0);
    vViewPosition = mvPosition.xyz;
    gl_Position = uProjection * mvPosition;

    #include clip_instance
}
`,CNe=`
precision highp float;
precision highp int;

uniform mat4 uView;

varying mat4 vTransform;
varying vec3 vStart;
varying vec3 vEnd;
varying float vSize;
varying float vCap;

uniform vec3 uCameraDir;
uniform vec3 uCameraPosition;

#include common
#include common_frag_params
#include color_frag_params
#include light_frag_params
#include common_clip
#include wboit_params

// adapted from https://www.shadertoy.com/view/4lcSRn
// The MIT License, Copyright 2016 Inigo Quilez
bool CylinderImpostor(
    in vec3 rayOrigin, in vec3 rayDir,
    in vec3 start, in vec3 end, in float radius,
    out vec4 intersection, out bool interior
){
    vec3 ba = end - start;
    vec3 oc = rayOrigin - start;

    float baba = dot(ba, ba);
    float bard = dot(ba, rayDir);
    float baoc = dot(ba, oc);

    float k2 = baba - bard*bard;
    float k1 = baba * dot(oc, rayDir) - baoc * bard;
    float k0 = baba * dot(oc, oc) - baoc * baoc - radius * radius * baba;

    float h = k1 * k1 - k2 * k0;
    if (h < 0.0) return false;

    bool topCap = (vCap > 0.9 && vCap < 1.1) || vCap >= 2.9;
    bool bottomCap = (vCap > 1.9 && vCap < 2.1) || vCap >= 2.9;

    // body outside
    h = sqrt(h);
    float t = (-k1 - h) / k2;
    float y = baoc + t * bard;
    if (y > 0.0 && y < baba) {
        interior = false;
        intersection = vec4(t, (oc + t * rayDir - ba * y / baba) / radius);
        return true;
    }

    if (topCap && y < 0.0) {
        // top cap
        t = -baoc / bard;
        if (abs(k1 + k2 * t) < h) {
            interior = false;
            intersection = vec4(t, ba * sign(y) / baba);
            return true;
        }
    } else if(bottomCap && y >= 0.0) {
        // bottom cap
        t = (baba - baoc) / bard;
        if (abs(k1 + k2 * t) < h) {
            interior = false;
            intersection = vec4(t, ba * sign(y) / baba);
            return true;
        }
    }

    #ifdef dDoubleSided
        // body inside
        h = -h;
        t = (-k1 - h) / k2;
        y = baoc + t * bard;
        if (y > 0.0 && y < baba) {
            interior = true;
            intersection = vec4(t, (oc + t * rayDir - ba * y / baba) / radius);
            return true;
        }

        // TODO: handle inside caps???
    #endif

    return false;
}

void main() {
    #include clip_pixel

    vec3 rayDir = mix(normalize(vModelPosition - uCameraPosition), uCameraDir, uIsOrtho);

    vec4 intersection;
    bool interior;
    bool hit = CylinderImpostor(vModelPosition, rayDir, vStart, vEnd, vSize, intersection, interior);
    if (!hit) discard;

    vec3 vViewPosition = vModelPosition + intersection.x * rayDir;
    vViewPosition = (uView * vec4(vViewPosition, 1.0)).xyz;
    gl_FragDepthEXT = calcDepth(vViewPosition);

    // bugfix (mac only?)
    if (gl_FragDepthEXT < 0.0) discard;
    if (gl_FragDepthEXT > 1.0) discard;

    float fragmentDepth = gl_FragDepthEXT;
    #include assign_material_color

    #if defined(dRenderVariant_pick)
        #include check_picking_alpha
        gl_FragColor = material;
    #elif defined(dRenderVariant_depth)
        gl_FragColor = material;
    #elif defined(dRenderVariant_color)
        #ifdef dIgnoreLight
            gl_FragColor = material;
        #else
            mat3 normalMatrix = transpose3(inverse3(mat3(uView)));
            vec3 normal = normalize(normalMatrix * -normalize(intersection.yzw));
            #include apply_light_color
        #endif

        #include apply_interior_color
        #include apply_marker_color
        #include apply_fog
        #include wboit_write
    #endif
}
`,_Ne=`
precision highp float;
precision highp int;

#include common
#include read_from_texture
#include common_vert_params
#include color_vert_params
#include size_vert_params
#include common_clip

uniform mat4 uModelView;

attribute vec3 aPosition;
attribute vec2 aMapping;
attribute float aDepth;
attribute vec2 aTexCoord;
attribute mat4 aTransform;
attribute float aInstance;
attribute float aGroup;

uniform float uOffsetX;
uniform float uOffsetY;
uniform float uOffsetZ;

// uniform bool ortho;
uniform float uPixelRatio;
uniform float uViewportHeight;

varying vec2 vTexCoord;

#include matrix_scale

void main(void){
    #include assign_group
    #include assign_color_varying
    #include assign_marker_varying
    #include assign_clipping_varying
    #include assign_size

    vTexCoord = aTexCoord;

    float scale = matrixScale(uModelView);

    float offsetX = uOffsetX * scale;
    float offsetY = uOffsetY * scale;
    float offsetZ = (uOffsetZ + aDepth * 0.95) * scale;

    vec4 position4 = vec4(aPosition, 1.0);
    vec4 mvPosition = uModelView * aTransform * position4;

    vModelPosition = (uModel * aTransform * position4).xyz; // for clipping in frag shader

    // TODO
    // #ifdef FIXED_SIZE
    //     if (ortho) {
    //         scale /= pixelRatio * ((uViewportHeight / 2.0) / -uCameraPosition.z) * 0.1;
    //     } else {
    //         scale /= pixelRatio * ((uViewportHeight / 2.0) / -mvPosition.z) * 0.1;
    //     }
    // #endif

    vec4 mvCorner = vec4(mvPosition.xyz, 1.0);

    if (vTexCoord.x == 10.0) { // indicates background plane
        // move a bit to the back, taking distance to camera into account to avoid z-fighting
        offsetZ -= 0.001 * distance(uCameraPosition, (uProjection * mvCorner).xyz);
    }

    mvCorner.xy += aMapping * size * scale;
    mvCorner.x += offsetX;
    mvCorner.y += offsetY;

    // TODO
    // if(ortho){
    //     mvCorner.xyz += normalize(-uCameraPosition) * offsetZ;
    // } else {
    //     mvCorner.xyz += normalize(-mvCorner.xyz) * offsetZ;
    // }
    mvCorner.xyz += normalize(-mvCorner.xyz) * offsetZ;

    gl_Position = uProjection * mvCorner;

    vViewPosition = -mvCorner.xyz;

    #include clip_instance
}
`,wNe=`
precision highp float;
precision highp int;

#include common
#include common_frag_params
#include color_frag_params
#include common_clip
#include wboit_params

uniform sampler2D tFont;

uniform vec3 uBorderColor;
uniform float uBorderWidth;
uniform vec3 uBackgroundColor;
uniform float uBackgroundOpacity;

varying vec2 vTexCoord;

const float smoothness = 32.0;
const float gamma = 2.2;

void main2(){
    gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0);
}

void main(){
    #include clip_pixel

    float fragmentDepth = gl_FragCoord.z;
    bool interior = false;
    #include assign_material_color

    if (vTexCoord.x > 1.0) {
        gl_FragColor = vec4(uBackgroundColor, uBackgroundOpacity * material.a);
    } else {
        // retrieve signed distance
        float sdf = texture2D(tFont, vTexCoord).a + uBorderWidth;

        // perform adaptive anti-aliasing of the edges
        float w = clamp(smoothness * (abs(dFdx(vTexCoord.x)) + abs(dFdy(vTexCoord.y))), 0.0, 0.5);
        float a = smoothstep(0.5 - w, 0.5 + w, sdf);

        // gamma correction for linear attenuation
        a = pow(a, 1.0 / gamma);

        if (a < 0.5) discard;
        material.a *= a;

        // add border
        float t = 0.5 + uBorderWidth;
        if (uBorderWidth > 0.0 && sdf < t) {
            material.xyz = mix(uBorderColor, material.xyz, smoothstep(t - w, t, sdf));
        }

        gl_FragColor = material;
    }

    #if defined(dRenderVariant_pick)
        #include check_picking_alpha
    #elif defined(dRenderVariant_depth)
        gl_FragColor = material;
    #elif defined(dRenderVariant_color)
        #include apply_marker_color
        #include apply_fog
        #include wboit_write
    #endif
}
`,ENe=`
precision highp float;
precision highp int;

#include common
#include read_from_texture
#include common_vert_params
#include color_vert_params
#include size_vert_params
#include common_clip

uniform float uPixelRatio;
uniform float uViewportHeight;

attribute mat4 aTransform;
attribute float aInstance;
attribute float aGroup;

attribute vec2 aMapping;
attribute vec3 aStart;
attribute vec3 aEnd;

void trimSegment(const in vec4 start, inout vec4 end) {
    // trim end segment so it terminates between the camera plane and the near plane
    // conservative estimate of the near plane
    float a = uProjection[2][2];  // 3rd entry in 3rd column
    float b = uProjection[3][2];  // 3rd entry in 4th column
    float nearEstimate = -0.5 * b / a;
    float alpha = (nearEstimate - start.z) / (end.z - start.z);
    end.xyz = mix(start.xyz, end.xyz, alpha);
}

void main(){
    #include assign_group
    #include assign_color_varying
    #include assign_marker_varying
    #include assign_clipping_varying
    #include assign_size

    mat4 modelView = uView * uModel * aTransform;

    // camera space
    vec4 start = modelView * vec4(aStart, 1.0);
    vec4 end = modelView * vec4(aEnd, 1.0);

    // assign position
    vec4 position4 = vec4((aMapping.y < 0.5) ? aStart : aEnd, 1.0);
    vec4 mvPosition = modelView * position4;
    vViewPosition = mvPosition.xyz;

    vModelPosition = (uModel * aTransform * position4).xyz; // for clipping in frag shader

    // special case for perspective projection, and segments that terminate either in, or behind, the camera plane
    // clearly the gpu firmware has a way of addressing this issue when projecting into ndc space
    // but we need to perform ndc-space calculations in the shader, so we must address this issue directly
    // perhaps there is a more elegant solution -- WestLangley
    bool perspective = (uProjection[2][3] == -1.0); // 4th entry in the 3rd column
    if (perspective) {
        if (start.z < 0.0 && end.z >= 0.0) {
            trimSegment(start, end);
        } else if (end.z < 0.0 && start.z >= 0.0) {
            trimSegment(end, start);
        }
    }

    // clip space
    vec4 clipStart = uProjection * start;
    vec4 clipEnd = uProjection * end;

    // ndc space
    vec2 ndcStart = clipStart.xy / clipStart.w;
    vec2 ndcEnd = clipEnd.xy / clipEnd.w;

    // direction
    vec2 dir = ndcEnd - ndcStart;

    // account for clip-space aspect ratio
    dir.x *= uPixelRatio;
    dir = normalize(dir);

    // perpendicular to dir
    vec2 offset = vec2(dir.y, - dir.x);

    // undo aspect ratio adjustment
    dir.x /= uPixelRatio;
    offset.x /= uPixelRatio;

    // sign flip
    if (aMapping.x < 0.0) offset *= -1.0;

    // calculate linewidth
    float linewidth;
    #ifdef dLineSizeAttenuation
        linewidth = size * uPixelRatio * ((uViewportHeight / 2.0) / -start.z) * 5.0;
    #else
        linewidth = size * uPixelRatio;
    #endif

    // adjust for linewidth
    offset *= linewidth;

    // adjust for clip-space to screen-space conversion
    offset /= uViewportHeight;

    // select end
    vec4 clip = (aMapping.y < 0.5) ? clipStart : clipEnd;

    // back to clip space
    offset *= clip.w;
    clip.xy += offset;
    gl_Position = clip;

    #include clip_instance
}
`,ANe=`
precision highp float;
precision highp int;

#include common
#include common_frag_params
#include color_frag_params
#include common_clip
#include wboit_params

void main(){
    #include clip_pixel

    bool interior = false;
    float fragmentDepth = gl_FragCoord.z;
    #include assign_material_color

    #if defined(dRenderVariant_pick)
        #include check_picking_alpha
        gl_FragColor = material;
    #elif defined(dRenderVariant_depth)
        gl_FragColor = material;
    #elif defined(dRenderVariant_color)
        gl_FragColor = material;

        #include apply_marker_color
        #include apply_fog
        #include wboit_write
    #endif
}
`,PNe=`
precision highp float;
precision highp int;
precision highp sampler2D;

#include common
#include read_from_texture
#include common_vert_params
#include color_vert_params
#include common_clip

#if defined(dColorType_grid)
    #include texture3d_from_2d_linear
#endif

#ifdef dGeoTexture
    uniform vec2 uGeoTexDim;
    uniform sampler2D tPosition;
    uniform sampler2D tGroup;
    uniform sampler2D tNormal;
#else
    attribute vec3 aPosition;
    attribute float aGroup;
    attribute vec3 aNormal;
#endif
attribute mat4 aTransform;
attribute float aInstance;

varying vec3 vNormal;

void main(){
    #include assign_group
    #include assign_marker_varying
    #include assign_clipping_varying
    #include assign_position
    #include assign_color_varying
    #include clip_instance

    #ifdef dGeoTexture
        vec3 normal = readFromTexture(tNormal, VertexID, uGeoTexDim).xyz;
    #else
        vec3 normal = aNormal;
    #endif
    mat3 normalMatrix = transpose3(inverse3(mat3(modelView)));
    vec3 transformedNormal = normalize(normalMatrix * normalize(normal));
    #if defined(dFlipSided) && !defined(dDoubleSided) // TODO checking dDoubleSided should not be required, ASR
        transformedNormal = -transformedNormal;
    #endif
    vNormal = transformedNormal;
}
`,TNe=`
precision highp float;
precision highp int;

#include common
#include common_frag_params
#include color_frag_params
#include light_frag_params
#include normal_frag_params
#include common_clip
#include wboit_params

void main() {
    #include clip_pixel

    // Workaround for buggy gl_FrontFacing (e.g. on some integrated Intel GPUs)
    #if defined(enabledStandardDerivatives)
        vec3 fdx = dFdx(vViewPosition);
        vec3 fdy = dFdy(vViewPosition);
        vec3 faceNormal = normalize(cross(fdx,fdy));
        bool frontFacing = dot(vNormal, faceNormal) > 0.0;
    #else
        bool frontFacing = dot(vNormal, vViewPosition) < 0.0;
    #endif

    #if defined(dFlipSided)
        interior = frontFacing;
    #else
        interior = !frontFacing;
    #endif

    float fragmentDepth = gl_FragCoord.z;
    #include assign_material_color

    #if defined(dRenderVariant_pick)
        #include check_picking_alpha
        gl_FragColor = material;
    #elif defined(dRenderVariant_depth)
        gl_FragColor = material;
    #elif defined(dRenderVariant_color)
        #ifdef dIgnoreLight
            gl_FragColor = material;
        #else
            #if defined(dFlatShaded) && defined(enabledStandardDerivatives)
                vec3 normal = -faceNormal;
            #else
                vec3 normal = -normalize(vNormal);
                #ifdef dDoubleSided
                    normal = normal * (float(frontFacing) * 2.0 - 1.0);
                #endif
            #endif
            #include apply_light_color
        #endif

        #include apply_interior_color
        #include apply_marker_color
        #include apply_fog
        #include wboit_write
    #endif
}
`,INe=`
precision highp float;

attribute vec3 aPosition;
attribute mat4 aTransform;
attribute float aInstance;

uniform mat4 uModelView;
uniform mat4 uProjection;
uniform vec4 uInvariantBoundingSphere;

varying vec3 vOrigPos;
varying float vInstance;
varying vec4 vBoundingSphere;
varying mat4 vTransform;

uniform vec3 uBboxSize;
uniform vec3 uBboxMin;
uniform vec3 uBboxMax;
uniform vec3 uGridDim;
uniform mat4 uTransform;

uniform mat4 uUnitToCartn;

void main() {
    vec4 unitCoord = vec4(aPosition + vec3(0.5), 1.0);
    vec4 mvPosition = uModelView * aTransform * uUnitToCartn * unitCoord;

    vOrigPos = (aTransform * uUnitToCartn * unitCoord).xyz;
    vInstance = aInstance;
    vBoundingSphere = vec4(
        (aTransform * vec4(uInvariantBoundingSphere.xyz, 1.0)).xyz,
        uInvariantBoundingSphere.w
    );
    vTransform = aTransform;

    gl_Position = uProjection * mvPosition;

    // move z position to near clip plane (but not too close to get precision issues)
    gl_Position.z = gl_Position.w - 0.01;
}
`,MNe=`
precision highp float;
precision highp int;

#include common
#include light_frag_params

#if dClipObjectCount != 0
    uniform int uClipObjectType[dClipObjectCount];
    uniform bool uClipObjectInvert[dClipObjectCount];
    uniform vec3 uClipObjectPosition[dClipObjectCount];
    uniform vec4 uClipObjectRotation[dClipObjectCount];
    uniform vec3 uClipObjectScale[dClipObjectCount];
#endif
#include common_clip

#include read_from_texture
#include texture3d_from_1d_trilinear
#include texture3d_from_2d_nearest
#include texture3d_from_2d_linear

uniform mat4 uProjection, uTransform, uModelView, uModel, uView;
uniform vec3 uCameraDir;

uniform sampler2D tDepth;
uniform vec2 uDrawingBufferSize;

varying vec3 vOrigPos;
varying float vInstance;
varying vec4 vBoundingSphere;
varying mat4 vTransform;

uniform mat4 uInvView;
uniform vec2 uIsoValue;
uniform vec3 uGridDim;
uniform vec3 uBboxSize;
uniform sampler2D tTransferTex;
uniform float uTransferScale;
uniform float uStepScale;
uniform float uJumpLength;

uniform int uObjectId;
uniform int uVertexCount;
uniform int uInstanceCount;
uniform int uGroupCount;

uniform vec3 uHighlightColor;
uniform vec3 uSelectColor;
uniform vec2 uMarkerTexDim;
uniform sampler2D tMarker;

uniform float uFogNear;
uniform float uFogFar;
uniform vec3 uFogColor;

uniform float uAlpha;
uniform float uPickingAlphaThreshold;
uniform bool uTransparentBackground;

uniform float uInteriorDarkening;
uniform bool uInteriorColorFlag;
uniform vec3 uInteriorColor;
bool interior;

uniform float uNear;
uniform float uFar;
uniform float uIsOrtho;

uniform vec3 uCellDim;
uniform vec3 uCameraPosition;
uniform mat4 uCartnToUnit;

#if __VERSION__ != 100
    // for webgl1 this is given as a 'define'
    uniform int uMaxSteps;
#endif

#if defined(dGridTexType_2d)
    precision highp sampler2D;
    uniform sampler2D tGridTex;
    uniform vec3 uGridTexDim;
#elif defined(dGridTexType_3d)
    precision highp sampler3D;
    uniform sampler3D tGridTex;
#endif

#if defined(dRenderVariant_color)
    #if defined(dColorType_uniform)
        uniform vec3 uColor;
    #elif defined(dColorType_texture)
        uniform vec2 uColorTexDim;
        uniform sampler2D tColor;
    #endif

    #ifdef dOverpaint
        varying vec4 vOverpaint;
        uniform vec2 uOverpaintTexDim;
        uniform sampler2D tOverpaint;
    #endif
#endif

#if defined(dGridTexType_2d)
    vec4 textureVal(vec3 pos) {
        return texture3dFrom2dLinear(tGridTex, pos + (vec3(0.5, 0.5, 0.0) / uGridDim), uGridDim, uGridTexDim.xy);
    }
    vec4 textureGroup(vec3 pos) {
        return texture3dFrom2dNearest(tGridTex, pos + (vec3(0.5, 0.5, 0.0) / uGridDim), uGridDim, uGridTexDim.xy);
    }
#elif defined(dGridTexType_3d)
    vec4 textureVal(vec3 pos) {
        return texture(tGridTex, pos + (vec3(0.5) / uGridDim));
    }
    vec4 textureGroup(vec3 pos) {
        return texelFetch(tGridTex, ivec3(pos * uGridDim), 0);
    }
#endif

#include wboit_params

vec4 transferFunction(float value) {
    return texture2D(tTransferTex, vec2(value, 0.0));
}

float getDepth(const in vec2 coords) {
    #ifdef depthTextureSupport
        if (!uRenderWboit) {
            // in case of opaque volumes (and depth texture support)
            return texture2D(tDepth, coords).r;
        } else {
            return unpackRGBAToDepth(texture2D(tDepth, coords));
        }
    #else
        return unpackRGBAToDepth(texture2D(tDepth, coords));
    #endif
}

const float gradOffset = 0.5;

vec3 v3m4(vec3 p, mat4 m) {
    return (m * vec4(p, 1.0)).xyz;
}

float preFogAlphaBlended = 0.0;

vec4 raymarch(vec3 startLoc, vec3 step, vec3 rayDir) {
    #if defined(dRenderVariant_color) && !defined(dIgnoreLight)
        mat3 normalMatrix = transpose3(inverse3(mat3(uModelView * vTransform)));
    #endif
    mat4 cartnToUnit = uCartnToUnit * inverse4(vTransform);
    #if defined(dClipVariant_pixel) && dClipObjectCount != 0
        mat4 modelTransform = uModel * vTransform * uTransform;
    #endif
    mat4 modelViewTransform = uModelView * vTransform * uTransform;

    vec3 scaleVol = vec3(1.0) / uGridDim;
    vec3 pos = startLoc;
    vec4 cell;
    float prevValue = -1.0;
    float value = 0.0;
    vec4 src = vec4(0.0);
    vec4 dst = vec4(0.0);
    bool hit = false;
    float fragmentDepth;

    vec3 posMin = vec3(0.0);
    vec3 posMax = vec3(1.0) - vec3(1.0) / uGridDim;

    vec3 unitPos;
    vec3 isoPos;

    vec3 nextPos;
    float nextValue;

    vec3 color = vec3(0.45, 0.55, 0.8);
    vec3 gradient = vec3(1.0);
    vec3 dx = vec3(gradOffset * scaleVol.x, 0.0, 0.0);
    vec3 dy = vec3(0.0, gradOffset * scaleVol.y, 0.0);
    vec3 dz = vec3(0.0, 0.0, gradOffset * scaleVol.z);

    float maxDist = min(vBoundingSphere.w * 2.0, uFar - uNear);
    float maxDistSq = maxDist * maxDist;

    for (int i = 0; i < uMaxSteps; ++i) {
        // break when beyond bounding-sphere or far-plane
        vec3 distVec = startLoc - pos;
        if (dot(distVec, distVec) > maxDistSq) break;

        unitPos = v3m4(pos, cartnToUnit);

        // continue when outside of grid
        if (unitPos.x > posMax.x || unitPos.y > posMax.y || unitPos.z > posMax.z ||
            unitPos.x < posMin.x || unitPos.y < posMin.y || unitPos.z < posMin.z
        ) {
            if (hit) break;
            prevValue = value;
            pos += step;
            continue;
        }

        cell = textureVal(unitPos);
        value = cell.a; // current voxel value

        if (uJumpLength > 0.0 && value < 0.01) {
            nextPos = pos + rayDir * uJumpLength;
            nextValue = textureVal(v3m4(nextPos, cartnToUnit)).a;
            if (nextValue < 0.01) {
                prevValue = nextValue;
                pos = nextPos;
                continue;
            }
        }

        #if defined(dRenderMode_isosurface)
            if (prevValue > 0.0 && ( // there was a prev Value
                (prevValue < uIsoValue.x && value > uIsoValue.x) || // entering isosurface
                (prevValue > uIsoValue.x && value < uIsoValue.x) // leaving isosurface
            )) {
                isoPos = v3m4(mix(pos - step, pos, ((prevValue - uIsoValue.x) / ((prevValue - uIsoValue.x) - (value - uIsoValue.x)))), cartnToUnit);

                vec4 mvPosition = modelViewTransform * vec4(isoPos * uGridDim, 1.0);

                #if defined(dClipVariant_pixel) && dClipObjectCount != 0
                    vec3 vModelPosition = v3m4(isoPos * uGridDim, modelTransform);
                    if (clipTest(vec4(vModelPosition, 0.0), 0)) {
                        prevValue = value;
                        pos += step;
                        continue;
                    }
                #endif

                float depth = calcDepth(mvPosition.xyz);
                if (depth > getDepth(gl_FragCoord.xy / uDrawingBufferSize))
                    break;

                #ifdef enabledFragDepth
                    if (!hit) {
                        gl_FragDepthEXT = depth;
                    }
                #endif

                #if defined(dRenderVariant_pickObject)
                    return vec4(encodeFloatRGB(float(uObjectId)), 1.0);
                #elif defined(dRenderVariant_pickInstance)
                    return vec4(encodeFloatRGB(vInstance), 1.0);
                #elif defined(dRenderVariant_pickGroup)
                    #ifdef dPackedGroup
                        return vec4(textureGroup(floor(isoPos * uGridDim + 0.5) / uGridDim).rgb, 1.0);
                    #else
                        vec3 g = floor(isoPos * uGridDim + 0.5);
                        return vec4(encodeFloatRGB(g.z + g.y * uGridDim.z + g.x * uGridDim.z * uGridDim.y), 1.0);
                    #endif
                #elif defined(dRenderVariant_depth)
                    #ifdef enabledFragDepth
                        return packDepthToRGBA(gl_FragDepthEXT);
                    #else
                        return packDepthToRGBA(depth);
                    #endif
                #elif defined(dRenderVariant_color)
                    #ifdef dPackedGroup
                        float group = decodeFloatRGB(textureGroup(floor(isoPos * uGridDim + 0.5) / uGridDim).rgb);
                    #else
                        vec3 g = floor(isoPos * uGridDim + 0.5);
                        float group = g.z + g.y * uGridDim.z + g.x * uGridDim.z * uGridDim.y;
                    #endif

                    #if defined(dColorType_uniform)
                        color = uColor;
                    #elif defined(dColorType_instance)
                        color = readFromTexture(tColor, vInstance, uColorTexDim).rgb;
                    #elif defined(dColorType_group)
                        color = readFromTexture(tColor, group, uColorTexDim).rgb;
                    #elif defined(dColorType_groupInstance)
                        color = readFromTexture(tColor, vInstance * float(uGroupCount) + group, uColorTexDim).rgb;
                    #elif defined(dColorType_vertex)
                        color = texture3dFrom1dTrilinear(tColor, isoPos, uGridDim, uColorTexDim, 0.0).rgb;
                    #elif defined(dColorType_vertexInstance)
                        color = texture3dFrom1dTrilinear(tColor, isoPos, uGridDim, uColorTexDim, vInstance * float(uVertexCount)).rgb;
                    #endif

                    // handle flipping and negative isosurfaces
                    #ifdef dFlipSided
                        bool flipped = value < uIsoValue.y; // flipped
                    #else
                        bool flipped = value > uIsoValue.y;
                    #endif
                    interior = value < uIsoValue.x && flipped;
                    #ifndef dDoubleSided
                        if (interior) {
                            prevValue = value;
                            pos += step;
                            continue;
                        }
                    #endif
                    vec3 vViewPosition = mvPosition.xyz;
                    vec4 material = vec4(color, uAlpha);

                    #ifdef dIgnoreLight
                        gl_FragColor = material;
                    #else
                        #if defined(dFlatShaded)
                            // nearest grid point
                            isoPos = floor(isoPos * uGridDim + 0.5) / uGridDim;
                        #endif
                        #ifdef dPackedGroup
                            // compute gradient by central differences
                            gradient.x = textureVal(isoPos - dx).a - textureVal(isoPos + dx).a;
                            gradient.y = textureVal(isoPos - dy).a - textureVal(isoPos + dy).a;
                            gradient.z = textureVal(isoPos - dz).a - textureVal(isoPos + dz).a;
                        #else
                            gradient = textureVal(isoPos).xyz * 2.0 - 1.0;
                        #endif
                        vec3 normal = -normalize(normalMatrix * normalize(gradient));
                        normal = normal * (float(flipped) * 2.0 - 1.0);
                        normal = normal * -(float(interior) * 2.0 - 1.0);
                        #include apply_light_color
                    #endif

                    float vMarker = readFromTexture(tMarker, vInstance * float(uGroupCount) + group, uMarkerTexDim).a;
                    #include apply_interior_color
                    #include apply_marker_color

                    preFogAlphaBlended = (1.0 - preFogAlphaBlended) * gl_FragColor.a + preFogAlphaBlended;
                    fragmentDepth = depth;
                    #include apply_fog

                    src = gl_FragColor;

                    if (!uTransparentBackground) {
                        // done in 'apply_fog' otherwise
                        src.rgb *= src.a;
                    }
                    dst = (1.0 - dst.a) * src + dst; // standard blending
                #endif

                #ifdef dSingleLayer
                    break;
                #endif

                hit = true;
            }
            prevValue = value;
        #elif defined(dRenderMode_volume)
            vec4 mvPosition = modelViewTransform * vec4(unitPos * uGridDim, 1.0);
            if (calcDepth(mvPosition.xyz) > getDepth(gl_FragCoord.xy / uDrawingBufferSize))
                break;

            #if defined(dClipVariant_pixel) && dClipObjectCount != 0
                vec3 vModelPosition = v3m4(unitPos * uGridDim, modelTransform);
                if (clipTest(vec4(vModelPosition, 0.0), 0)) {
                    prevValue = value;
                    pos += step;
                    continue;
                }
            #endif

            #if defined(dRenderVariant_color)
                vec3 vViewPosition = mvPosition.xyz;
                vec4 material = transferFunction(value);

                #ifdef dIgnoreLight
                    gl_FragColor.rgb = material.rgb;
                #else
                    if (material.a >= 0.01) {
                        #ifdef dPackedGroup
                            // compute gradient by central differences
                            gradient.x = textureVal(unitPos - dx).a - textureVal(unitPos + dx).a;
                            gradient.y = textureVal(unitPos - dy).a - textureVal(unitPos + dy).a;
                            gradient.z = textureVal(unitPos - dz).a - textureVal(unitPos + dz).a;
                        #else
                            gradient = cell.xyz * 2.0 - 1.0;
                        #endif
                        vec3 normal = -normalize(normalMatrix * normalize(gradient));
                        #include apply_light_color
                    } else {
                        gl_FragColor.rgb = material.rgb;
                    }
                #endif

                gl_FragColor.a = material.a * uAlpha * uTransferScale;

                #ifdef dPackedGroup
                    float group = decodeFloatRGB(textureGroup(floor(unitPos * uGridDim + 0.5) / uGridDim).rgb);
                #else
                    vec3 g = floor(unitPos * uGridDim + 0.5);
                    float group = g.z + g.y * uGridDim.z + g.x * uGridDim.z * uGridDim.y;
                #endif

                float vMarker = readFromTexture(tMarker, vInstance * float(uGroupCount) + group, uMarkerTexDim).a;
                #include apply_marker_color

                preFogAlphaBlended = (1.0 - preFogAlphaBlended) * gl_FragColor.a + preFogAlphaBlended;
                fragmentDepth = calcDepth(mvPosition.xyz);
                #include apply_fog

                src = gl_FragColor;

                if (!uTransparentBackground) {
                    // done in 'apply_fog' otherwise
                    src.rgb *= src.a;
                }
                dst = (1.0 - dst.a) * src + dst; // standard blending
            #endif
        #endif

        // break if the color is opaque enough
        if (dst.a > 0.95)
            break;

        pos += step;
    }

    #if defined(dRenderMode_isosurface) && defined(enabledFragDepth)
        // ensure depth is written everywhere
        if (!hit)
            gl_FragDepthEXT = 1.0;
    #endif

    return dst;
}

// TODO: support float texture for higher precision values???
// TODO: support clipping exclusion texture support

void main() {
    if (gl_FrontFacing)
        discard;

    #if defined(dRenderVariant_pick) || defined(dRenderVariant_depth)
        #if defined(dRenderMode_volume)
            // always ignore pick & depth for volume
            discard;
        #elif defined(dRenderMode_isosurface)
            if (uAlpha < uPickingAlphaThreshold)
                discard; // ignore so the element below can be picked
        #endif
    #endif

    vec3 rayDir = mix(normalize(vOrigPos - uCameraPosition), uCameraDir, uIsOrtho);
    vec3 step = rayDir * uStepScale;

    float boundingSphereNear = distance(vBoundingSphere.xyz, uCameraPosition) - vBoundingSphere.w;
    float d = max(uNear, boundingSphereNear) - mix(0.0, distance(vOrigPos, uCameraPosition), uIsOrtho);
    vec3 start = mix(uCameraPosition, vOrigPos, uIsOrtho) + (d * rayDir);
    gl_FragColor = raymarch(start, step, rayDir);

    #if defined(dRenderVariant_pick) || defined(dRenderVariant_depth)
        // discard when nothing was hit
        if (gl_FragColor == vec4(0.0))
            discard;
    #endif

    #if defined(dRenderVariant_color)
        #if defined(dRenderMode_isosurface) && defined(enabledFragDepth)
            float fragmentDepth = gl_FragDepthEXT;
        #else
            float fragmentDepth = calcDepth((uModelView * vec4(start, 1.0)).xyz);
        #endif
        float preFogAlpha = clamp(preFogAlphaBlended, 0.0, 1.0);
        interior = false;
        #include wboit_write
    #endif
}
`,DNe=`
precision highp float;
precision highp int;

#include common
#include common_vert_params

attribute vec3 aPosition;
attribute vec2 aUv;
attribute mat4 aTransform;
attribute float aInstance;

varying vec2 vUv;
varying float vInstance;

void main() {
    #include assign_position

    vUv = aUv;
    vInstance = aInstance;
}
`,RNe=`
precision highp float;
precision highp int;

#include common
#include read_from_texture
#include common_frag_params
#include common_clip
#include wboit_params

uniform vec2 uImageTexDim;
uniform sampler2D tImageTex;
uniform sampler2D tGroupTex;

uniform vec2 uMarkerTexDim;
uniform sampler2D tMarker;

varying vec2 vUv;
varying float vInstance;

#if defined(dInterpolation_catmulrom) || defined(dInterpolation_mitchell) || defined(dInterpolation_bspline)
    #define dInterpolation_cubic
#endif

#if defined(dInterpolation_cubic)
    #if defined(dInterpolation_catmulrom) || defined(dInterpolation_mitchell)
        #if defined(dInterpolation_catmulrom)
            const float B = 0.0;
            const float C = 0.5;
        #elif defined(dInterpolation_mitchell)
            const float B = 0.333;
            const float C = 0.333;
        #endif

        float cubicFilter(float x){
            float f = x;
            if (f < 0.0) {
                f = -f;
            }
            if (f < 1.0) {
                return ((12.0 - 9.0 * B - 6.0 * C) * (f * f * f) +
                    (-18.0 + 12.0 * B + 6.0 * C) * (f * f) +
                    (6.0 - 2.0 * B)) / 6.0;
            }else if (f >= 1.0 && f < 2.0){
                return ((-B - 6.0 * C) * ( f * f * f)
                    + (6.0 * B + 30.0 * C) * (f * f) +
                    (-(12.0 * B) - 48.0 * C) * f +
                    8.0 * B + 24.0 * C) / 6.0;
            }else{
                return 0.0;
            }
        }
    #elif defined(dInterpolation_bspline)
        float cubicFilter(float x) {
            float f = x;
            if (f < 0.0) {
                f = -f;
            }
            if (f >= 0.0 && f <= 1.0){
                return (2.0 / 3.0) + (0.5) * (f * f * f) - (f * f);
            } else if (f > 1.0 && f <= 2.0) {
                return 1.0 / 6.0 * pow((2.0 - f), 3.0);
            }
            return 1.0;
        }
    #endif

    vec4 biCubic(sampler2D tex, vec2 texCoord) {
        vec2 texelSize = 1.0 / uImageTexDim;
        texCoord -= texelSize / 2.0;
        vec4 nSum = vec4(0.0);
        float nDenom = 0.0;
        vec2 cell = fract(texCoord * uImageTexDim);
        for (float m = -1.0; m <= 2.0; ++m) {
            for (float n = -1.0; n <= 2.0; ++n) {
                vec4 vecData = texture2D(tex, texCoord + texelSize * vec2(m, n));
                float c = cubicFilter(m - cell.x) * cubicFilter(-n + cell.y);
                nSum += vecData * c;
                nDenom += c;
            }
        }
        return nSum / nDenom;
    }
#endif

void main() {
    #include clip_pixel

    #if defined(dInterpolation_cubic)
        vec4 imageData = biCubic(tImageTex, vUv);
    #else
        vec4 imageData = texture2D(tImageTex, vUv);
    #endif
    imageData.a = clamp(imageData.a, 0.0, 1.0);
    if (imageData.a > 0.9) imageData.a = 1.0;

    float fragmentDepth = gl_FragCoord.z;
    bool interior = false;

    #if defined(dRenderVariant_pick)
        if (imageData.a < 0.3)
            discard;

        #if defined(dRenderVariant_pickObject)
            gl_FragColor = vec4(encodeFloatRGB(float(uObjectId)), 1.0);
        #elif defined(dRenderVariant_pickInstance)
            gl_FragColor = vec4(encodeFloatRGB(vInstance), 1.0);
        #elif defined(dRenderVariant_pickGroup)
            gl_FragColor = vec4(texture2D(tGroupTex, vUv).rgb, 1.0);
        #endif
    #elif defined(dRenderVariant_depth)
        if (imageData.a < 0.05)
            discard;

        gl_FragColor = packDepthToRGBA(gl_FragCoord.z);
    #elif defined(dRenderVariant_color)
        if (imageData.a < 0.05)
            discard;

        gl_FragColor = imageData;
        gl_FragColor.a *= uAlpha;

        float group = decodeFloatRGB(texture2D(tGroupTex, vUv).rgb);
        float vMarker = readFromTexture(tMarker, vInstance * float(uGroupCount) + group, uMarkerTexDim).a;

        #include apply_marker_color
        #include apply_fog
        #include wboit_write
    #endif
}
`,$Q=Fa(),kNe={apply_fog:U6e,apply_interior_color:j6e,apply_light_color:z6e,apply_marker_color:V6e,assign_clipping_varying:H6e,assign_color_varying:G6e,assign_group:q6e,assign_marker_varying:W6e,assign_material_color:$6e,assign_position:X6e,assign_size:Y6e,check_picking_alpha:K6e,clip_instance:Q6e,clip_pixel:Z6e,color_frag_params:J6e,color_vert_params:eNe,common_clip:tNe,common_frag_params:rNe,common_vert_params:nNe,common:iNe,float_to_rgba:aNe,light_frag_params:oNe,matrix_scale:sNe,normal_frag_params:uNe,read_from_texture:lNe,rgba_to_float:cNe,size_vert_params:dNe,texture3d_from_1d_trilinear:fNe,texture3d_from_2d_linear:hNe,texture3d_from_2d_nearest:pNe,wboit_params:vNe,wboit_write:mNe},ONe=/^(?!\/\/)\s*#include\s+(\S+)/gmi,LNe=/[ \t]*\/\/.*\n/g,NNe=/[ \t]*\/\*[\s\S]*?\*\//g,FNe=/\n{2,}/g;function iU(e){return e.replace(ONe,function(t,r){var n=kNe[r];if(!n)throw new Error("empty chunk, '"+r+"'");return n}).trim().replace(LNe,`
`).replace(NNe,`
`).replace(FNe,`
`)}function Mn(e,t,r,n,i){return n===void 0&&(n={}),i===void 0&&(i={}),{id:$Q(),name:e,vert:iU(t),frag:iU(r),extensions:n,outTypes:i}}var BNe=Mn("points",gNe,yNe,{drawBuffers:"optional"}),UNe=Mn("spheres",bNe,xNe,{fragDepth:"required",drawBuffers:"optional"}),jNe=Mn("cylinders",SNe,CNe,{fragDepth:"required",drawBuffers:"optional"}),zNe=Mn("text",_Ne,wNe,{standardDerivatives:"required",drawBuffers:"optional"}),VNe=Mn("lines",ENe,ANe,{drawBuffers:"optional"}),XQ=Mn("mesh",PNe,TNe,{standardDerivatives:"optional",drawBuffers:"optional"}),HNe=Mn("direct-volume",INe,MNe,{fragDepth:"optional",drawBuffers:"optional"}),GNe=Mn("image",DNe,RNe,{drawBuffers:"optional"});function qNe(e){if(e===void 0)return"";var t=[];for(var r in e){var n=e[r],i=n.ref.value;if(i!==void 0)if(typeof i=="string")t.push("#define "+r+"_"+i);else if(typeof i=="number")t.push("#define "+r+" "+i);else if(typeof i=="boolean")i&&t.push("#define "+r);else throw new Error("unknown define type")}return t.join(`
`)+`
`}function WNe(e,t){var r=[];if(t.standardDerivatives&&(r.push("#extension GL_OES_standard_derivatives : enable"),r.push("#define enabledStandardDerivatives")),t.fragDepth){if(e.fragDepth)r.push("#extension GL_EXT_frag_depth : enable"),r.push("#define enabledFragDepth");else if(t.fragDepth==="required")throw new Error("required 'GL_EXT_frag_depth' extension not available")}if(t.drawBuffers){if(e.drawBuffers)r.push("#extension GL_EXT_draw_buffers : require"),r.push("#define requiredDrawBuffers"),r.push("#define gl_FragColor gl_FragData[0]");else if(t.drawBuffers==="required")throw new Error("required 'GL_EXT_draw_buffers' extension not available")}if(t.shaderTextureLod){if(e.shaderTextureLod)r.push("#extension GL_EXT_shader_texture_lod : enable"),r.push("#define enabledShaderTextureLod");else if(t.shaderTextureLod==="required")throw new Error("required 'GL_EXT_shader_texture_lod' extension not available")}return e.depthTexture&&r.push("#define depthTextureSupport"),r.join(`
`)+`
`}var $Ne=`#version 300 es
#define attribute in
#define varying out
#define texture2D texture
`,XNe=`
#define varying in
#define texture2D texture
#define texture2DLodEXT textureLod

#define gl_FragColor out_FragData0
#define gl_FragDepthEXT gl_FragDepth

#define depthTextureSupport
`;function YNe(e,t,r,n){var i=["#version 300 es","layout(location = 0) out highp "+(n[0]||"vec4")+" out_FragData0;"];if(r.standardDerivatives&&i.push("#define enabledStandardDerivatives"),r.fragDepth&&i.push("#define enabledFragDepth"),r.drawBuffers){i.push("#define requiredDrawBuffers");for(var a=e.getParameter(e.MAX_DRAW_BUFFERS),o=1,s=a;o<s;++o)i.push("layout(location = "+o+") out highp "+(n[o]||"vec4")+" out_FragData"+o+";")}return r.shaderTextureLod&&i.push("#define enabledShaderTextureLod"),i.push(XNe),i.join(`
`)+`
`}function KNe(e){return e.replace(/gl_FragData\[([0-9]+)\]/g,"out_FragData$1")}function QNe(e,t,r,n){var i=qNe(r),a=wr(e)?$Ne:"",o=wr(e)?YNe(e,t,n.extensions,n.outTypes):WNe(t,n.extensions),s=wr(e)?KNe(n.frag):n.frag;return{id:$Q(),name:n.name,vert:""+a+i+n.vert,frag:""+o+i+s,extensions:n.extensions,outTypes:n.outTypes}}function ZNe(e,t){switch(t){case"b":case"b[]":return e.BOOL;case"f":case"f[]":return e.FLOAT;case"i":case"i[]":return e.INT;case"v2":case"v2[]":return e.FLOAT_VEC2;case"v3":case"v3[]":return e.FLOAT_VEC3;case"v4":case"v4[]":return e.FLOAT_VEC4;case"m3":case"m3[]":return e.FLOAT_MAT3;case"m4":case"m4[]":return e.FLOAT_MAT4;default:console.error("unknown uniform kind '"+t+"'")}}function JNe(e,t,r){e.uniform1f(t,r)}function eFe(e,t,r){e.uniform1fv(t,r)}function tFe(e,t,r){e.uniform1i(t,r)}function rFe(e,t,r){e.uniform1iv(t,r)}function nFe(e,t,r){e.uniform2fv(t,r)}function iFe(e,t,r){e.uniform3fv(t,r)}function aFe(e,t,r){e.uniform4fv(t,r)}function oFe(e,t,r){e.uniformMatrix3fv(t,!1,r)}function sFe(e,t,r){e.uniformMatrix4fv(t,!1,r)}function aU(e){switch(e){case"f":return JNe;case"f[]":return eFe;case"i":case"t":case"b":return tFe;case"i[]":case"t[]":case"b[]":return rFe;case"v2":case"v2[]":return nFe;case"v3":case"v3[]":return iFe;case"v4":case"v4[]":return aFe;case"m3":case"m3[]":return oFe;case"m4":case"m4[]":return sFe}}function uFe(e){var t={};return Object.keys(e).forEach(function(r){var n=e[r];n.type==="uniform"?t[r]=aU(n.kind):n.type==="texture"&&(t[r]=aU("t"))}),t}function lFe(e){var t={};return Object.keys(e).forEach(function(r){t[r]=N.create(qf(e[r].ref.value))}),t}var cFe=Fa();function dFe(e,t){switch(t){case"static":return e.STATIC_DRAW;case"dynamic":return e.DYNAMIC_DRAW;case"stream":return e.STREAM_DRAW}}function fFe(e,t){if(t instanceof Uint8Array)return e.UNSIGNED_BYTE;if(t instanceof Int8Array)return e.BYTE;if(t instanceof Uint16Array)return e.UNSIGNED_SHORT;if(t instanceof Int16Array)return e.SHORT;if(t instanceof Uint32Array)return e.UNSIGNED_INT;if(t instanceof Int32Array)return e.INT;if(t instanceof Float32Array)return e.FLOAT;throw new Error("Should nevver happen")}function hFe(e,t){switch(t){case"attribute":return e.ARRAY_BUFFER;case"elements":return e.ELEMENT_ARRAY_BUFFER;case"uniform":return e.UNIFORM_BUFFER}}function oU(e){var t=e.createBuffer();if(t===null)throw new Error("Could not create WebGL buffer");return t}function YQ(e,t,r,n){var i=oU(e),a=dFe(e,r),o=hFe(e,n),s=fFe(e,t),u=t.BYTES_PER_ELEMENT,l=t.length;function c(f){e.bindBuffer(o,i),e.bufferData(o,f,a)}c(t);var d=!1;return{id:cFe(),_usageHint:a,_bufferType:o,_dataType:s,_bpe:u,length:l,getBuffer:function(){return i},updateData:c,updateSubData:function(f,h,v){e.bindBuffer(o,i),v-h===f.length?e.bufferSubData(o,0,f):e.bufferSubData(o,h*u,f.subarray(h,h+v))},reset:function(){i=oU(e),c(t)},destroy:function(){d||(e.deleteBuffer(i),d=!0)}}}function pFe(e,t,r){switch(t){case"int32":switch(r){case 1:return e.INT;case 2:return e.INT_VEC2;case 3:return e.INT_VEC3;case 4:return e.INT_VEC4}break;case"float32":switch(r){case 1:return e.FLOAT;case 2:return e.FLOAT_VEC2;case 3:return e.FLOAT_VEC3;case 4:return e.FLOAT_VEC4;case 16:return e.FLOAT_MAT4}break}throw new Error("unknown attribute type for kind '"+t+"' and itemSize '"+r+"'")}function vFe(e,t,r,n,i,a){a===void 0&&(a="dynamic");var o=t.instancedArrays,s=YQ(e,r,a,"attribute"),u=s._bufferType,l=s._dataType,c=s._bpe;return E(E({},s),{bind:function(d){if(e.bindBuffer(u,s.getBuffer()),n===16)for(var f=0;f<4;++f)e.enableVertexAttribArray(d+f),e.vertexAttribPointer(d+f,4,l,!1,4*4*c,f*4*c),o.vertexAttribDivisor(d+f,i);else e.enableVertexAttribArray(d),e.vertexAttribPointer(d,n,l,!1,0,0),o.vertexAttribDivisor(d,i)}})}function mFe(e,t,r){var n=[];return Object.keys(t).forEach(function(i){var a=t[i];a.type==="attribute"&&(n[n.length]=[i,e.resources.attribute(r[i].ref.value,a.itemSize,a.divisor)])}),n}function gFe(e,t,r){r===void 0&&(r="static");var n=YQ(e,t,r,"elements");return E(E({},n),{bind:function(){e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,n.getBuffer())}})}var yFe=Fa();function bFe(e,t,r){var n={};return Object.keys(r).forEach(function(i){var a=r[i];if(a.type==="attribute"){var o=e.getAttribLocation(t,i);n[i]=o}else if(a.type==="uniform"||a.type==="texture"){var o=e.getUniformLocation(t,i);n[i]=o}}),n}function xFe(e,t,r){for(var n=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES),i=0;i<n;++i){var a=e.getActiveAttrib(t,i);if(a){var o=a.name,s=a.type;if(o.startsWith("__activeAttribute")||o==="gl_InstanceID"||o==="gl_VertexID")continue;var u=r[o];if(u===void 0)throw new Error("missing 'uniform' or 'texture' with name '"+o+"' in schema");if(u.type!=="attribute")throw new Error("'"+o+"' must be of type 'attribute' but is '"+u.type+"'");var l=pFe(e,u.kind,u.itemSize);if(l!==s)throw new Error("unexpected attribute type for "+o)}}}function SFe(e,t,r){for(var n=e.getProgramParameter(t,e.ACTIVE_UNIFORMS),i=0;i<n;++i){var a=e.getActiveUniform(t,i);if(a){var o=a.name,s=a.type;if(o.startsWith("__activeUniform"))continue;var u=o.replace(/[[0-9]+\]$/,""),l=r[u];if(l===void 0)throw new Error("missing 'uniform' or 'texture' with name '"+o+"' in schema");if(l.type==="uniform"){var c=ZNe(e,l.kind);if(c!==s)throw new Error("unexpected uniform type for "+o)}else if(l.type==="texture"){if(l.kind==="image-float32"||l.kind==="image-uint8"){if(s!==e.SAMPLER_2D)throw new Error("unexpected sampler type for '"+o+"'")}else if((l.kind==="volume-float32"||l.kind==="volume-uint8")&&s!==e.SAMPLER_3D)throw new Error("unexpected sampler type for '"+o+"'")}else throw new Error("'"+o+"' must be of type 'uniform' or 'texture' but is '"+l.type+"'")}}}function CFe(e,t){if(!e.getProgramParameter(t,e.LINK_STATUS))throw new Error(`Could not compile WebGL program. 

`+e.getProgramInfoLog(t))}function d5(e){var t=e.createProgram();if(t===null)throw new Error("Could not create WebGL program");return t}function _Fe(e,t,r,n,i){var a=i.defineValues,o=i.shaderCode,s=i.schema,u=d5(e),l=yFe(),c=QNe(e,r,a,o),d=n("vert",c.vert),f=n("frag",c.frag),h,v;function p(){d.attach(u),f.attach(u),e.linkProgram(u),Mr&&CFe(e,u),h=bFe(e,u,s),v=uFe(s),Mr&&(xFe(e,u,s),SFe(e,u,s))}p();var m=!1;return{id:l,use:function(){t.currentProgramId=l,e.useProgram(u)},setUniforms:function(g){for(var y=0,b=g.length;y<b;++y){var S=g[y],x=S[0],C=S[1];if(C){var w=h[x];w!==null&&v[x](e,w,C.ref.value)}}},bindAttributes:function(g){for(var y=0,b=g.length;y<b;++y){var S=g[y],x=S[0],C=S[1],w=h[x];w!==-1&&C.bind(w)}},bindTextures:function(g,y){for(var b=0,S=g.length;b<S;++b){var x=g[b],C=x[0],w=x[1],A=h[C];A!=null&&(w.bind(b+y),v[C](e,A,b+y))}},reset:function(){u=d5(e),p()},destroy:function(){m||(d.destroy(),f.destroy(),e.deleteProgram(u),m=!0)}}}var wFe=Fa();function EFe(e){for(var t=e.split(`
`),r=0;r<t.length;++r)t[r]=r+1+": "+t[r];return t.join(`
`)}function d_(e,t){var r=t.type,n=t.source,i=e.createShader(r==="vert"?e.VERTEX_SHADER:e.FRAGMENT_SHADER);if(i===null)throw new Error("Error creating "+r+" shader");if(e.shaderSource(i,n),e.compileShader(i),Mr&&e.getShaderParameter(i,e.COMPILE_STATUS)===!1)throw console.warn("'"+r+"' shader info log '"+e.getShaderInfoLog(i)+`'
`+EFe(n)),new Error("Error compiling "+r+" shader");return i}function AFe(e,t){var r=d_(e,t);return{id:wFe(),attach:function(n){e.attachShader(n,r)},reset:function(){r=d_(e,t)},destroy:function(){e.deleteShader(r)}}}function PFe(e,t){return t===void 0&&(t=0),{value:e,usageCount:t}}function TFe(e){return{free:function(){e.usageCount-=1},value:e.value}}function sU(e,t,r){var n=new Map;return{get:function(i){var a=e(i),o=n.get(a);return o||(o=PFe(t(i)),n.set(a,o)),o.usageCount+=1,TFe(o)},clear:function(){n.forEach(function(i,a){i.usageCount<=0&&(i.usageCount<0&&console.warn("Reference usageCount below zero."),r(i.value),n.delete(a))})},get count(){return n.size},dispose:function(){n.forEach(function(i){return r(i.value)}),n.clear()}}}var IFe=Fa();function MFe(e,t){switch(t){case"depth16":return e.DEPTH_COMPONENT16;case"stencil8":return e.STENCIL_INDEX8;case"rgba4":return e.RGBA4;case"depth-stencil":return e.DEPTH_STENCIL;case"depth32f":if(wr(e))return e.DEPTH_COMPONENT32F;throw new Error("WebGL2 needed for `depth32f` renderbuffer format")}}function DFe(e,t){switch(t){case"depth":return e.DEPTH_ATTACHMENT;case"stencil":return e.STENCIL_ATTACHMENT;case"depth-stencil":return e.DEPTH_STENCIL_ATTACHMENT;case"color0":return e.COLOR_ATTACHMENT0}}function uU(e){var t=e.createRenderbuffer();if(t===null)throw new Error("Could not create WebGL renderbuffer");return t}function RFe(e,t,r,n,i){var a=uU(e),o=function(){return e.bindRenderbuffer(e.RENDERBUFFER,a)},s=MFe(e,t),u=DFe(e,r);function l(){o(),e.renderbufferStorage(e.RENDERBUFFER,s,n,i)}l();var c=!1;return{id:IFe(),bind:o,attachFramebuffer:function(d){d.bind(),o(),e.framebufferRenderbuffer(e.FRAMEBUFFER,u,e.RENDERBUFFER,a),Mr&&TO(e)},setSize:function(d,f){n=d,i=f,l()},reset:function(){a=uU(e),l()},destroy:function(){c||(e.deleteRenderbuffer(a),c=!0)}}}var kFe=Fa();function lU(e){var t=e.vertexArrayObject;if(!t)throw new Error("VertexArrayObject not supported");var r=t.createVertexArray();if(!r)throw new Error("Could not create WebGL vertex array");return r}function cU(e){var t=e.vertexArrayObject;if(t===null)throw new Error("VertexArrayObject not supported");return t}function OFe(e,t,r,n){var i=kFe(),a=lU(e),o=cU(e);function s(){o.bindVertexArray(a),n&&n.bind(),t.bindAttributes(r),o.bindVertexArray(null)}s();var u=!1;return{id:i,bind:function(){o.bindVertexArray(a)},update:s,reset:function(){a=lU(e),o=cU(e),s()},destroy:function(){u||(o.deleteVertexArray(a),u=!0)}}}function LFe(e){return typeof e=="boolean"?e?1:0:typeof e=="number"?e*1e4:kk(e)}function dU(e){var t=E(E({},e.value),{destroy:function(){e.free()}});return t}function NFe(e,t,r,n){var i={attribute:new Set,elements:new Set,framebuffer:new Set,program:new Set,renderbuffer:new Set,shader:new Set,texture:new Set,vertexArray:new Set};function a(l,c){return i[l].add(c),r.resourceCounts[l]+=1,E(E({},c),{destroy:function(){c.destroy(),i[l].delete(c),r.resourceCounts[l]-=1}})}var o=sU(function(l){return JSON.stringify(l)},function(l){return a("shader",AFe(e,l))},function(l){l.destroy()});function s(l,c){return dU(o.get({type:l,source:c}))}var u=sU(function(l){var c=[l.shaderCode.id];return Object.keys(l.defineValues).forEach(function(d){return c.push(kk(d),LFe(l.defineValues[d].ref.value))}),La(c).toString()},function(l){return a("program",_Fe(e,t,n,s,l))},function(l){l.destroy()});return{attribute:function(l,c,d,f){return a("attribute",vFe(e,n,l,c,d,f))},elements:function(l,c){return a("elements",gFe(e,l,c))},framebuffer:function(){return a("framebuffer",N6e(e))},program:function(l,c,d){return dU(u.get({defineValues:l,shaderCode:c,schema:d}))},renderbuffer:function(l,c,d,f){return a("renderbuffer",RFe(e,l,c,d,f))},shader:s,texture:function(l,c,d,f){return a("texture",h5(e,n,l,c,d,f))},vertexArray:function(l,c,d){return a("vertexArray",OFe(n,l,c,d))},getByteCounts:function(){var l=0;i.texture.forEach(function(f){l+=f.getByteCount()});var c=0;i.attribute.forEach(function(f){c+=f.length*4});var d=0;return i.elements.forEach(function(f){d+=f.length*4}),{texture:l,attribute:c,elements:d}},reset:function(){i.attribute.forEach(function(l){return l.reset()}),i.elements.forEach(function(l){return l.reset()}),i.framebuffer.forEach(function(l){return l.reset()}),i.renderbuffer.forEach(function(l){return l.reset()}),i.shader.forEach(function(l){return l.reset()}),i.program.forEach(function(l){return l.reset()}),i.vertexArray.forEach(function(l){return l.reset()}),i.texture.forEach(function(l){return l.reset()})},destroy:function(){i.attribute.forEach(function(l){return l.destroy()}),i.elements.forEach(function(l){return l.destroy()}),i.framebuffer.forEach(function(l){return l.destroy()}),i.renderbuffer.forEach(function(l){return l.destroy()}),i.shader.forEach(function(l){return l.destroy()}),i.program.forEach(function(l){return l.destroy()}),i.vertexArray.forEach(function(l){return l.destroy()}),i.texture.forEach(function(l){return l.destroy()}),o.clear(),u.clear()}}}var KQ=Fa();function FFe(e,t,r,n,i,a,o){i===void 0&&(i=!0),a===void 0&&(a="uint8"),o===void 0&&(o="nearest");var s=t.framebuffer(),u=a==="fp16"?t.texture("image-float16","rgba","fp16",o):a==="float32"?t.texture("image-float32","rgba","float",o):t.texture("image-uint8","rgba","ubyte",o),l=i?wr(e)?t.renderbuffer("depth32f","depth",r,n):t.renderbuffer("depth16","depth",r,n):null;function c(){u.define(r,n),u.attachFramebuffer(s,"color0"),l&&l.attachFramebuffer(s)}c();var d=!1;return{id:KQ(),texture:u,framebuffer:s,getWidth:function(){return r},getHeight:function(){return n},bind:function(){s.bind()},setSize:function(f,h){r===f&&n===h||(r=f,n=h,u.define(r,n),l&&l.setSize(r,n))},reset:function(){c()},destroy:function(){d||(u.destroy(),s.destroy(),l&&l.destroy(),d=!0)}}}function BFe(e){return{id:KQ(),texture:F3(e),framebuffer:F6e(),getWidth:function(){return 0},getHeight:function(){return 0},bind:function(){e.bindFramebuffer(e.FRAMEBUFFER,null)},setSize:function(){},reset:function(){},destroy:function(){}}}function UFe(e,t){function r(i){try{return e.getContext(i,t)}catch{return null}}var n=r("webgl2")||r("webgl")||r("experimental-webgl");return Mr&&console.log("isWebgl2: "+wr(n)),n}function QQ(e,t){switch(t){case e.NO_ERROR:return"no error";case e.INVALID_ENUM:return"invalid enum";case e.INVALID_VALUE:return"invalid value";case e.INVALID_OPERATION:return"invalid operation";case e.INVALID_FRAMEBUFFER_OPERATION:return"invalid framebuffer operation";case e.OUT_OF_MEMORY:return"out of memory";case e.CONTEXT_LOST_WEBGL:return"context lost"}return"unknown error"}function ZQ(e){var t=e.getError();if(t!==e.NO_ERROR)throw new Error("WebGL error: '"+QQ(e,t)+"'")}function jFe(e){for(var t=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),r=0;r<t;++r)e.activeTexture(e.TEXTURE0+r),e.bindTexture(e.TEXTURE_2D,null),e.bindTexture(e.TEXTURE_CUBE_MAP,null),wr(e)&&(e.bindTexture(e.TEXTURE_2D_ARRAY,null),e.bindTexture(e.TEXTURE_3D,null));var n=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,n);for(var i=e.getParameter(e.MAX_VERTEX_ATTRIBS),r=0;r<i;++r)e.vertexAttribPointer(r,1,e.FLOAT,!1,0,0);e.bindBuffer(e.ARRAY_BUFFER,null),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null),e.bindRenderbuffer(e.RENDERBUFFER,null),f_(e)}function f_(e){e.bindFramebuffer(e.FRAMEBUFFER,null)}var JQ=new Uint8Array(1*4);function eZ(e,t,r){e.getSyncParameter(t,e.SYNC_STATUS)===e.SIGNALED?(e.deleteSync(t),r()):zk.setImmediate(eZ,e,t,r)}function tZ(e,t){var r=e.fenceSync(e.SYNC_GPU_COMMANDS_COMPLETE,0);r?zk.setImmediate(eZ,e,r,t):(console.warn("Could not create a WebGLSync object"),e.readPixels(0,0,1,1,e.RGBA,e.UNSIGNED_BYTE,JQ),t())}var fU=!1;function zFe(e){return new Promise(function(t){wr(e)?tZ(e,t):(fU||(console.info("Sync object not supported in WebGL"),fU=!0),rZ(e),t())})}function rZ(e){e.bindFramebuffer(e.FRAMEBUFFER,null),e.readPixels(0,0,1,1,e.RGBA,e.UNSIGNED_BYTE,JQ)}function f5(e,t,r,n,i,a){if(Mr&&TO(e),a instanceof Uint8Array)e.readPixels(t,r,n,i,e.RGBA,e.UNSIGNED_BYTE,a);else if(a instanceof Float32Array)e.readPixels(t,r,n,i,e.RGBA,e.FLOAT,a);else if(a instanceof Int32Array&&wr(e))e.readPixels(t,r,n,i,e.RGBA_INTEGER,e.INT,a);else throw new Error("unsupported readPixels buffer type");Mr&&ZQ(e)}function VFe(e){var t=e.drawingBufferWidth,r=e.drawingBufferHeight,n=new Uint8Array(t*r*4);return f_(e),e.viewport(0,0,t,r),f5(e,0,0,t,r,n),Cp.flipY(Cp.create(n,t,r))}function HFe(){return{resourceCounts:{attribute:0,elements:0,framebuffer:0,program:0,renderbuffer:0,shader:0,texture:0,vertexArray:0},drawCount:0,instanceCount:0,instancedDrawCount:0}}function GFe(e,t){var r=this;t===void 0&&(t={});var n=nU(e),i=B6e(e),a=HFe(),o=NFe(e,i,a,n),s={maxTextureSize:e.getParameter(e.MAX_TEXTURE_SIZE),max3dTextureSize:wr(e)?e.getParameter(e.MAX_3D_TEXTURE_SIZE):0,maxRenderbufferSize:e.getParameter(e.MAX_RENDERBUFFER_SIZE),maxDrawBuffers:n.drawBuffers?e.getParameter(n.drawBuffers.MAX_DRAW_BUFFERS):0,maxTextureImageUnits:e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),maxVertexTextureImageUnits:e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS)};if(s.maxVertexTextureImageUnits<8)throw new Error('Need "MAX_VERTEX_TEXTURE_IMAGE_UNITS" >= 8');var u=!1,l=new vf(0),c;if(wr(e)){var d=e.createBuffer(),f=void 0,h=void 0,v=!1,p=function(){e.bindBuffer(e.PIXEL_PACK_BUFFER,d),e.getBufferSubData(e.PIXEL_PACK_BUFFER,0,f),e.bindBuffer(e.PIXEL_PACK_BUFFER,null),v=!1,h(),h=void 0,f=void 0};c=function(g,y,b,S,x){return new Promise(function(C,w){if(v){w("Can not call multiple readPixelsAsync at the same time");return}v=!0,e.bindBuffer(e.PIXEL_PACK_BUFFER,d),e.bufferData(e.PIXEL_PACK_BUFFER,b*S*4,e.STREAM_READ),e.readPixels(g,y,b,S,e.RGBA,e.UNSIGNED_BYTE,0),e.bindBuffer(e.PIXEL_PACK_BUFFER,null),h=C,f=x,tZ(e,p)})}}else c=function(g,y,b,S,x){return ce(r,void 0,void 0,function(){return de(this,function(C){return f5(e,g,y,b,S,x),[2]})})};var m=new Set;return{gl:e,isWebGL2:wr(e),get pixelRatio(){var g=typeof window<"u"?window.devicePixelRatio:1;return g*(t.pixelScale||1)},extensions:n,state:i,stats:a,resources:o,get maxTextureSize(){return s.maxTextureSize},get max3dTextureSize(){return s.max3dTextureSize},get maxRenderbufferSize(){return s.maxRenderbufferSize},get maxDrawBuffers(){return s.maxDrawBuffers},get maxTextureImageUnits(){return s.maxTextureImageUnits},namedComputeRenderables:Object.create(null),namedFramebuffers:Object.create(null),namedTextures:Object.create(null),get isContextLost(){return u||e.isContextLost()},contextRestored:l,setContextLost:function(){u=!0},handleContextRestored:function(g){Object.assign(n,nU(e)),i.reset(),i.currentMaterialId=-1,i.currentProgramId=-1,i.currentRenderItemId=-1,o.reset(),m.forEach(function(y){return y.reset()}),g==null||g(),u=!1,l.next(Tn())},createRenderTarget:function(g,y,b,S,x){var C=FFe(e,o,g,y,b,S,x);return m.add(C),E(E({},C),{destroy:function(){C.destroy(),m.delete(C)}})},unbindFramebuffer:function(){return f_(e)},readPixels:function(g,y,b,S,x){f5(e,g,y,b,S,x)},readPixelsAsync:c,waitForGpuCommandsComplete:function(){return zFe(e)},waitForGpuCommandsCompleteSync:function(){return rZ(e)},getDrawingBufferPixelData:function(){return VFe(e)},clear:function(g,y,b,S){f_(e),i.enable(e.SCISSOR_TEST),i.depthMask(!0),i.colorMask(!0,!0,!0,!0),i.clearColor(g,y,b,S),e.viewport(0,0,e.drawingBufferWidth,e.drawingBufferHeight),e.scissor(0,0,e.drawingBufferWidth,e.drawingBufferHeight),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT)},destroy:function(g){var y;o.destroy(),jFe(e),g!=null&&g.doNotForceWebGLContextLoss||(y=e.getExtension("WEBGL_lose_context"))===null||y===void 0||y.loseContext()}}}function wr(e){return typeof WebGL2RenderingContext<"u"&&e instanceof WebGL2RenderingContext}function qFe(e){if(wr(e))return{drawArraysInstanced:e.drawArraysInstanced.bind(e),drawElementsInstanced:e.drawElementsInstanced.bind(e),vertexAttribDivisor:e.vertexAttribDivisor.bind(e),VERTEX_ATTRIB_ARRAY_DIVISOR:e.VERTEX_ATTRIB_ARRAY_DIVISOR};var t=e.getExtension("ANGLE_instanced_arrays");return t===null?null:{drawArraysInstanced:t.drawArraysInstancedANGLE.bind(t),drawElementsInstanced:t.drawElementsInstancedANGLE.bind(t),vertexAttribDivisor:t.vertexAttribDivisorANGLE.bind(t),VERTEX_ATTRIB_ARRAY_DIVISOR:t.VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE}}function WFe(e){if(wr(e))return{FRAGMENT_SHADER_DERIVATIVE_HINT:e.FRAGMENT_SHADER_DERIVATIVE_HINT};var t=e.getExtension("OES_standard_derivatives");return t===null?null:{FRAGMENT_SHADER_DERIVATIVE_HINT:t.FRAGMENT_SHADER_DERIVATIVE_HINT_OES}}function $Fe(e){return wr(e)?{}:e.getExtension("OES_element_index_uint")}function XFe(e){if(wr(e))return{VERTEX_ARRAY_BINDING:e.VERTEX_ARRAY_BINDING,bindVertexArray:e.bindVertexArray.bind(e),createVertexArray:e.createVertexArray.bind(e),deleteVertexArray:e.deleteVertexArray.bind(e),isVertexArray:e.isVertexArray.bind(e)};var t=e.getExtension("OES_vertex_array_object");return t===null?null:{VERTEX_ARRAY_BINDING:t.VERTEX_ARRAY_BINDING_OES,bindVertexArray:t.bindVertexArrayOES.bind(t),createVertexArray:t.createVertexArrayOES.bind(t),deleteVertexArray:t.deleteVertexArrayOES.bind(t),isVertexArray:t.isVertexArrayOES.bind(t)}}function YFe(e){return wr(e)?{}:e.getExtension("OES_texture_float")}function KFe(e){return e.getExtension("OES_texture_float_linear")}function QFe(e){if(wr(e))return{HALF_FLOAT:e.HALF_FLOAT};var t=e.getExtension("OES_texture_half_float");return t===null?null:{HALF_FLOAT:t.HALF_FLOAT_OES}}function ZFe(e){return e.getExtension("OES_texture_half_float_linear")}function JFe(e){if(wr(e))return{MIN:e.MIN,MAX:e.MAX};var t=e.getExtension("EXT_blend_minmax");return t===null?null:{MIN:t.MIN_EXT,MAX:t.MAX_EXT}}function eBe(e){return wr(e)?{}:e.getExtension("EXT_frag_depth")}function tBe(e){if(wr(e))return e.getExtension("EXT_color_buffer_float")===null?null:(e.getExtension("EXT_float_blend"),{RGBA32F:e.RGBA32F});var t=e.getExtension("WEBGL_color_buffer_float");return t===null?(e.getExtension("OES_texture_float"),nZ(e,e.FLOAT)?{RGBA32F:34836}:null):(e.getExtension("EXT_float_blend"),{RGBA32F:t.RGBA32F_EXT})}function rBe(e){if(wr(e))return e.getExtension("EXT_color_buffer_half_float")===null?null:(e.getExtension("EXT_float_blend"),{RGBA16F:e.RGBA16F});var t=e.getExtension("EXT_color_buffer_half_float");return t===null?(e.getExtension("OES_texture_half_float"),nZ(e,36193)?{RGBA16F:34842}:null):(e.getExtension("EXT_float_blend"),{RGBA16F:t.RGBA16F_EXT})}function nBe(e){if(wr(e))return{drawBuffers:e.drawBuffers.bind(e),COLOR_ATTACHMENT0:e.COLOR_ATTACHMENT0,COLOR_ATTACHMENT1:e.COLOR_ATTACHMENT1,COLOR_ATTACHMENT2:e.COLOR_ATTACHMENT2,COLOR_ATTACHMENT3:e.COLOR_ATTACHMENT3,COLOR_ATTACHMENT4:e.COLOR_ATTACHMENT4,COLOR_ATTACHMENT5:e.COLOR_ATTACHMENT5,COLOR_ATTACHMENT6:e.COLOR_ATTACHMENT6,COLOR_ATTACHMENT7:e.COLOR_ATTACHMENT7,DRAW_BUFFER0:e.DRAW_BUFFER0,DRAW_BUFFER1:e.DRAW_BUFFER1,DRAW_BUFFER2:e.DRAW_BUFFER2,DRAW_BUFFER3:e.DRAW_BUFFER3,DRAW_BUFFER4:e.DRAW_BUFFER4,DRAW_BUFFER5:e.DRAW_BUFFER5,DRAW_BUFFER6:e.DRAW_BUFFER6,DRAW_BUFFER7:e.DRAW_BUFFER7,MAX_COLOR_ATTACHMENTS:e.MAX_COLOR_ATTACHMENTS,MAX_DRAW_BUFFERS:e.MAX_DRAW_BUFFERS};var t=e.getExtension("WEBGL_draw_buffers");return t===null?null:{drawBuffers:t.drawBuffersWEBGL.bind(t),COLOR_ATTACHMENT0:t.COLOR_ATTACHMENT0_WEBGL,COLOR_ATTACHMENT1:t.COLOR_ATTACHMENT1_WEBGL,COLOR_ATTACHMENT2:t.COLOR_ATTACHMENT2_WEBGL,COLOR_ATTACHMENT3:t.COLOR_ATTACHMENT3_WEBGL,COLOR_ATTACHMENT4:t.COLOR_ATTACHMENT4_WEBGL,COLOR_ATTACHMENT5:t.COLOR_ATTACHMENT5_WEBGL,COLOR_ATTACHMENT6:t.COLOR_ATTACHMENT6_WEBGL,COLOR_ATTACHMENT7:t.COLOR_ATTACHMENT7_WEBGL,DRAW_BUFFER0:t.DRAW_BUFFER0_WEBGL,DRAW_BUFFER1:t.DRAW_BUFFER1_WEBGL,DRAW_BUFFER2:t.DRAW_BUFFER2_WEBGL,DRAW_BUFFER3:t.DRAW_BUFFER3_WEBGL,DRAW_BUFFER4:t.DRAW_BUFFER4_WEBGL,DRAW_BUFFER5:t.DRAW_BUFFER5_WEBGL,DRAW_BUFFER6:t.DRAW_BUFFER6_WEBGL,DRAW_BUFFER7:t.DRAW_BUFFER7_WEBGL,MAX_COLOR_ATTACHMENTS:t.MAX_COLOR_ATTACHMENTS_WEBGL,MAX_DRAW_BUFFERS:t.MAX_DRAW_BUFFERS_WEBGL}}function iBe(e){return wr(e)?{}:e.getExtension("EXT_shader_texture_lod")}function aBe(e){if(wr(e))return{UNSIGNED_INT_24_8:e.UNSIGNED_INT_24_8};var t=e.getExtension("WEBGL_depth_texture");return t===null?null:{UNSIGNED_INT_24_8:t.UNSIGNED_INT_24_8_WEBGL}}function oBe(e){if(wr(e))return{FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING:e.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING,SRGB8_ALPHA8:e.SRGB8_ALPHA8,SRGB8:e.SRGB8,SRGB:e.SRGB};var t=e.getExtension("EXT_sRGB");return t===null?null:{FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING:t.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING_EXT,SRGB8_ALPHA8:t.SRGB8_ALPHA8_EXT,SRGB8:t.SRGB_ALPHA_EXT,SRGB:t.SRGB_EXT}}var sBe=`
attribute vec4 aPosition;

void main() {
    gl_Position = aPosition;
}`,uBe=`
precision mediump float;
uniform vec4 uColor;
uniform sampler2D uTexture;

void main() {
    gl_FragColor = texture2D(uTexture, vec2(0.5, 0.5)) * uColor;
}`,lBe=new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]);function nZ(e,t){var r=d_(e,{type:"vert",source:sBe}),n=d_(e,{type:"frag",source:uBe});if(!r||!n)return!1;var i=d5(e);e.attachShader(i,r),e.attachShader(i,n),e.linkProgram(i),e.useProgram(i);var a=e.getAttribLocation(i,"aPosition"),o=e.getUniformLocation(i,"uColor");if(!o)return Mr&&console.log("error getting 'uColor' uniform location"),!1;var s=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,s),e.bufferData(e.ARRAY_BUFFER,lBe,e.STATIC_DRAW),e.enableVertexAttribArray(a),e.vertexAttribPointer(a,2,e.FLOAT,!1,0,0);var u=e.createTexture(),l=new Uint8Array([255,255,255,255]);e.bindTexture(e.TEXTURE_2D,u),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,l);var c=e.createTexture();e.bindTexture(e.TEXTURE_2D,c),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,1,1,0,e.RGBA,t,null),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST);var d=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,d),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,c,0);var f=e.checkFramebufferStatus(e.FRAMEBUFFER);if(f!==e.FRAMEBUFFER_COMPLETE)return Mr&&console.log("error creating framebuffer for '"+t+"'"),!1;e.bindTexture(e.TEXTURE_2D,u),e.uniform4fv(o,[0,10,20,1]),e.drawArrays(e.TRIANGLES,0,6),e.bindTexture(e.TEXTURE_2D,c),e.bindFramebuffer(e.FRAMEBUFFER,null),e.clearColor(1,0,0,1),e.clear(e.COLOR_BUFFER_BIT),e.uniform4fv(o,[0,1/10,1/20,1]),e.drawArrays(e.TRIANGLES,0,6);var h=new Uint8Array(4);if(e.readPixels(0,0,1,1,e.RGBA,e.UNSIGNED_BYTE,h),h[0]!==0||h[1]<248||h[2]<248||h[3]<254)return Mr&&console.log("not able to actually render to '"+t+"' texture"),!1;if(t===e.FLOAT){e.bindFramebuffer(e.FRAMEBUFFER,d);var v=new Float32Array(4);e.readPixels(0,0,1,1,e.RGBA,e.FLOAT,v);var p=e.getError();if(p)return Mr&&console.log("error reading float pixels: '"+QQ(e,p)+"'"),!1}return!0}var iZ=Fa();function cBe(e,t){switch(t){case"image-uint8":return e.TEXTURE_2D;case"image-float32":return e.TEXTURE_2D;case"image-float16":return e.TEXTURE_2D;case"image-depth":return e.TEXTURE_2D}if(wr(e))switch(t){case"image-int32":return e.TEXTURE_2D;case"volume-uint8":return e.TEXTURE_3D;case"volume-float32":return e.TEXTURE_3D;case"volume-float16":return e.TEXTURE_3D}throw new Error("unknown texture kind '"+t+"'")}function aZ(e,t,r){switch(t){case"alpha":return wr(e)&&r==="float"?e.RED:wr(e)&&r==="int"?e.RED_INTEGER:e.ALPHA;case"rgb":return wr(e)&&r==="int"?e.RGB_INTEGER:e.RGB;case"rgba":return wr(e)&&r==="int"?e.RGBA_INTEGER:e.RGBA;case"depth":return e.DEPTH_COMPONENT}}function dBe(e,t,r){if(wr(e))switch(t){case"alpha":switch(r){case"ubyte":return e.ALPHA;case"float":return e.R32F;case"fp16":return e.R16F;case"int":return e.R32I}case"rgb":switch(r){case"ubyte":return e.RGB;case"float":return e.RGB32F;case"fp16":return e.RGB16F;case"int":return e.RGB32I}case"rgba":switch(r){case"ubyte":return e.RGBA;case"float":return e.RGBA32F;case"fp16":return e.RGBA16F;case"int":return e.RGBA32I}case"depth":switch(r){case"ushort":return e.DEPTH_COMPONENT16;case"float":return e.DEPTH_COMPONENT32F}}return aZ(e,t,r)}function fBe(e,t,r,n,i){var a=hBe(e)*pBe(t);return a*r*n*(i||1)}function hBe(e){switch(e){case"alpha":return 1;case"rgb":return 3;case"rgba":return 4;case"depth":return 4}}function pBe(e){switch(e){case"ubyte":return 1;case"ushort":return 2;case"float":return 4;case"fp16":return 2;case"int":return 4}}function vBe(e,t,r){switch(r){case"ubyte":return e.UNSIGNED_BYTE;case"ushort":return e.UNSIGNED_SHORT;case"float":return e.FLOAT;case"fp16":if(t.textureHalfFloat)return t.textureHalfFloat.HALF_FLOAT;throw new Error('extension "texture_half_float" unavailable');case"int":if(wr(e))return e.INT;throw new Error('texture type "int" requires webgl2')}}function hU(e,t){switch(t){case"nearest":return e.NEAREST;case"linear":return e.LINEAR}}function J2(e,t,r){switch(r){case"depth":return e.DEPTH_ATTACHMENT;case"stencil":return e.STENCIL_ATTACHMENT;case"color0":case 0:return e.COLOR_ATTACHMENT0}if(t.drawBuffers)switch(r){case"color1":case 1:return t.drawBuffers.COLOR_ATTACHMENT1;case"color2":case 2:return t.drawBuffers.COLOR_ATTACHMENT2;case"color3":case 3:return t.drawBuffers.COLOR_ATTACHMENT3;case"color4":case 4:return t.drawBuffers.COLOR_ATTACHMENT4;case"color5":case 5:return t.drawBuffers.COLOR_ATTACHMENT5;case"color6":case 6:return t.drawBuffers.COLOR_ATTACHMENT6;case"color7":case 7:return t.drawBuffers.COLOR_ATTACHMENT7}throw new Error("unknown texture attachment")}function mBe(e){return typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement}function gBe(e,t,r){return t===r.TEXTURE_2D}function yBe(e,t,r){return t===r.TEXTURE_3D}function pU(e){var t=e.createTexture();if(t===null)throw new Error("Could not create WebGL texture");return t}function h5(e,t,r,n,i,a){var o=iZ(),s=pU(e);if(r.endsWith("float32")&&i!=="float"||r.endsWith("float16")&&i!=="fp16"||r.endsWith("uint8")&&i!=="ubyte"||r.endsWith("int32")&&i!=="int"||r.endsWith("depth")&&i!=="ushort"&&i!=="float")throw new Error("texture kind '"+r+"' and type '"+i+"' are incompatible");var u=cBe(e,r),l=hU(e,a),c=aZ(e,n,i),d=dBe(e,n,i),f=vBe(e,t,i);function h(){e.bindTexture(u,s),e.texParameteri(u,e.TEXTURE_MAG_FILTER,l),e.texParameteri(u,e.TEXTURE_MIN_FILTER,l),e.texParameteri(u,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(u,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.bindTexture(u,null)}h();var v=0,p=0,m=0,g,y=!1;function b(C,w,A){if(!(v===C&&p===w&&m===(A||0)))if(v=C,p=w,m=A||0,e.bindTexture(u,s),u===e.TEXTURE_2D)e.texImage2D(u,0,d,v,p,0,c,f,null);else if(wr(e)&&u===e.TEXTURE_3D&&m!==void 0)e.texImage3D(u,0,d,v,p,m,0,c,f,null);else throw new Error("unknown texture target")}function S(C,w){if(w===void 0&&(w=!1),e.bindTexture(u,s),e.pixelStorei(e.UNPACK_ALIGNMENT,1),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,e.NONE),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),mBe(C))e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!1),e.bindTexture(e.TEXTURE_2D,s),e.texImage2D(e.TEXTURE_2D,0,d,c,f,C);else if(gBe(C,u,e)){var A=C.filter?hU(e,C.filter):l;e.texParameteri(u,e.TEXTURE_MAG_FILTER,A),e.texParameteri(u,e.TEXTURE_MIN_FILTER,A),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!!C.flipY),w?e.texSubImage2D(u,0,0,0,C.width,C.height,c,f,C.array):(v=C.width,p=C.height,e.texImage2D(u,0,d,v,p,0,c,f,C.array))}else if(wr(e)&&yBe(C,u,e))e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!1),w?e.texSubImage3D(u,0,0,0,0,C.width,C.height,C.depth,c,f,C.array):(v=C.width,p=C.height,m=C.depth,e.texImage3D(u,0,d,v,p,m,0,c,f,C.array));else throw new Error("unknown texture target");e.bindTexture(u,null),g=C}function x(C,w,A){if(C.bind(),u===e.TEXTURE_2D)e.framebufferTexture2D(e.FRAMEBUFFER,J2(e,t,w),e.TEXTURE_2D,s,0);else if(wr(e)&&u===e.TEXTURE_3D){if(A===void 0)throw new Error("need `layer` to attach 3D texture");e.framebufferTextureLayer(e.FRAMEBUFFER,J2(e,t,w),s,0,A)}else throw new Error("unknown/unsupported texture target")}return{id:o,target:u,format:c,internalFormat:d,type:f,filter:l,getWidth:function(){return v},getHeight:function(){return p},getDepth:function(){return m},getByteCount:function(){return fBe(n,i,v,p,m)},define:b,load:S,bind:function(C){e.activeTexture(e.TEXTURE0+C),e.bindTexture(u,s)},unbind:function(C){e.activeTexture(e.TEXTURE0+C),e.bindTexture(u,null)},attachFramebuffer:x,detachFramebuffer:function(C,w){if(C.bind(),u===e.TEXTURE_2D)e.framebufferTexture2D(e.FRAMEBUFFER,J2(e,t,w),e.TEXTURE_2D,null,0);else if(wr(e)&&u===e.TEXTURE_3D)e.framebufferTextureLayer(e.FRAMEBUFFER,J2(e,t,w),null,0,0);else throw new Error("unknown texture target")},reset:function(){s=pU(e),h();var C=[v,p,m],w=C[0],A=C[1],M=C[2];v=0,p=0,m=0,b(w,A,M),g&&S(g)},destroy:function(){y||(e.deleteTexture(s),y=!0)}}}function bBe(e,t,r){var n=e.resources,i=[];return Object.keys(t).forEach(function(a){var o=t[a];if(o.type==="texture"){var s=r[a];if(s)if(o.kind==="texture")i[i.length]=[a,s.ref.value];else{var u=n.texture(o.kind,o.format,o.dataType,o.filter);u.load(s.ref.value),i[i.length]=[a,u]}}}),i}function vU(e,t,r){var n=new Image;n.onload=function(){r.load(n),N.update(t,r)},n.src=e}function F3(e){var t,r=(t=e==null?void 0:e.TEXTURE_2D)!==null&&t!==void 0?t:3553;return{id:iZ(),target:r,format:0,internalFormat:0,type:0,filter:0,getWidth:function(){return 0},getHeight:function(){return 0},getDepth:function(){return 0},getByteCount:function(){return 0},define:function(){},load:function(){},bind:function(n){e&&(e.activeTexture(e.TEXTURE0+n),e.bindTexture(r,null))},unbind:function(n){e&&(e.activeTexture(e.TEXTURE0+n),e.bindTexture(r,null))},attachFramebuffer:function(){},detachFramebuffer:function(){},reset:function(){},destroy:function(){}}}function ns(e,t,r,n){var i=xBe(e,t,r,n);return r.palette?(N.updateIfChanged(i.dUsePalette,!0),SBe(r.palette,i.tPalette)):N.updateIfChanged(i.dUsePalette,!1),i}function xBe(e,t,r,n){switch(ra.getGranularity(e,r.granularity)){case"uniform":return _Be(e,r.color,n);case"instance":return wBe(e,r.color,n);case"group":return EBe(e,r.color,n);case"groupInstance":return ABe(e,r.color,n);case"vertex":return PBe(t,r.color,n);case"vertexInstance":return TBe(t,r.color,n);case"volume":return mU(r.grid,"volume",n);case"volumeInstance":return mU(r.grid,"volumeInstance",n)}}function SBe(e,t){var r=!0,n=t.ref.value;if(e.colors.length!==n.width||n.filter!==e.filter)r=!1;else for(var i=n.array,a=0,o=0,s=e.colors;o<s.length;o++){var u=s[o],l=at.toRgb(u),c=l[0],d=l[1],f=l[2];if(i[a++]!==c||i[a++]!==d||i[a++]!==f){r=!1;break}}if(!r){for(var h=new Uint8Array(e.colors.length*3),v=0,p=0,m=e.colors;p<m.length;p++){var u=m[p],g=at.toRgb(u),c=g[0],d=g[1],f=g[2];h[v++]=c,h[v++]=d,h[v++]=f}N.update(t,{array:h,height:1,width:e.colors.length,filter:e.filter})}}function CBe(e,t){return t?(N.update(t.uColor,at.toVec3Normalized(t.uColor.ref.value,e)),N.updateIfChanged(t.dColorType,"uniform"),t):{uColor:N.create(at.toVec3Normalized(_(),e)),tColor:N.create({array:new Uint8Array(3),width:1,height:1}),tColorGrid:N.create(F3()),tPalette:N.create({array:new Uint8Array(3),width:1,height:1}),uColorTexDim:N.create(He.create(1,1)),uColorGridDim:N.create(_.create(1,1,1)),uColorGridTransform:N.create(_r.create(0,0,0,1)),dColorType:N.create("uniform"),dUsePalette:N.create(!1)}}function _Be(e,t,r){return CBe(t(Ko,!1),r)}function kb(e,t,r){return r?(N.update(r.tColor,e),N.update(r.uColorTexDim,He.create(e.width,e.height)),N.updateIfChanged(r.dColorType,t),r):{uColor:N.create(_()),tColor:N.create(e),tColorGrid:N.create(F3()),tPalette:N.create({array:new Uint8Array(3),width:1,height:1}),uColorTexDim:N.create(He.create(e.width,e.height)),uColorGridDim:N.create(_.create(1,1,1)),uColorGridTransform:N.create(_r.create(0,0,0,1)),dColorType:N.create(t),dUsePalette:N.create(!1)}}function wBe(e,t,r){var n=e.instanceCount,i=pa(Math.max(1,n),3,Uint8Array,r&&r.tColor.ref.value.array);for(e.reset();e.hasNext;){var a=e.move(),o=a.location,s=a.isSecondary,u=a.instanceIndex;at.toArray(t(o,s),i.array,u*3),e.skipInstance()}return kb(i,"instance",r)}function EBe(e,t,r){var n=e.groupCount,i=pa(Math.max(1,n),3,Uint8Array,r&&r.tColor.ref.value.array);for(e.reset();e.hasNext&&!e.isNextNewInstance;){var a=e.move(),o=a.location,s=a.isSecondary,u=a.groupIndex;at.toArray(t(o,s),i.array,u*3)}return kb(i,"group",r)}function ABe(e,t,r){var n=e.groupCount,i=e.instanceCount,a=i*n,o=pa(Math.max(1,a),3,Uint8Array,r&&r.tColor.ref.value.array);for(e.reset();e.hasNext;){var s=e.move(),u=s.location,l=s.isSecondary,c=s.index;at.toArray(t(u,l),o.array,c*3)}return kb(o,"groupInstance",r)}function PBe(e,t,r){var n=e.groupCount,i=e.stride,a=pa(Math.max(1,n),3,Uint8Array,r&&r.tColor.ref.value.array);for(e.reset(),e.voidInstances();e.hasNext&&!e.isNextNewInstance;)for(var o=e.move(),s=o.location,u=o.isSecondary,l=o.groupIndex,c=t(s,u),d=0;d<i;++d)at.toArray(c,a.array,(l+d)*3);return kb(a,"vertex",r)}function TBe(e,t,r){var n=e.groupCount,i=e.instanceCount,a=e.stride,o=i*n,s=pa(Math.max(1,o),3,Uint8Array,r&&r.tColor.ref.value.array);for(e.reset();e.hasNext;)for(var u=e.move(),l=u.location,c=u.isSecondary,d=u.index,f=t(l,c),h=0;h<a;++h)at.toArray(f,s.array,(d+h)*3);return kb(s,"vertexInstance",r)}function mU(e,t,r){var n=e.colors,i=e.dimension,a=e.transform,o=n.getWidth(),s=n.getHeight();return r?(N.update(r.tColorGrid,n),N.update(r.uColorTexDim,He.create(o,s)),N.update(r.uColorGridDim,_.clone(i)),N.update(r.uColorGridTransform,_r.clone(a)),N.updateIfChanged(r.dColorType,t),r):{uColor:N.create(_()),tColor:N.create({array:new Uint8Array(3),width:1,height:1}),tColorGrid:N.create(n),tPalette:N.create({array:new Uint8Array(3),width:1,height:1}),uColorTexDim:N.create(He.create(o,s)),uColorGridDim:N.create(_.clone(i)),uColorGridTransform:N.create(_r.clone(a)),dColorType:N.create(t),dUsePalette:N.create(!1)}}var Nt;(function(e){function t(b,S,x,C,w,A,M){return M?a(b,S,x,C,w,A,M):i(b,S,x,C,w,A)}e.create=t;function r(b){var S=b?b.vertexBuffer.ref.value:new Float32Array(0),x=b?b.indexBuffer.ref.value:new Uint32Array(0),C=b?b.normalBuffer.ref.value:new Float32Array(0),w=b?b.groupBuffer.ref.value:new Float32Array(0);return t(S,x,C,w,0,0,b)}e.createEmpty=r;function n(b){return La([b.vertexCount,b.triangleCount,b.vertexBuffer.ref.version,b.indexBuffer.ref.version,b.normalBuffer.ref.version,b.groupBuffer.ref.version])}function i(b,S,x,C,w,A){var M=Fe(),D,k=-1,R=-1,L={kind:"mesh",vertexCount:w,triangleCount:A,vertexBuffer:N.create(b),indexBuffer:N.create(S),normalBuffer:N.create(x),groupBuffer:N.create(C),get boundingSphere(){var H=n(L);if(H!==k){var B=Qf(L.vertexBuffer.ref.value,L.vertexCount,1);Fe.copy(M,B),k=H}return M},get groupMapping(){return L.groupBuffer.ref.version!==R&&(D=Jg(L.groupBuffer.ref.value,L.vertexCount),R=L.groupBuffer.ref.version),D},setBoundingSphere:function(H){Fe.copy(M,H),k=n(L)},meta:{}};return L}function a(b,S,x,C,w,A,M){return M.vertexCount=w,M.triangleCount=A,N.update(M.vertexBuffer,b),N.update(M.indexBuffer,S),N.update(M.normalBuffer,x),N.update(M.groupBuffer,C),M}function o(b){var S=b.vertexCount,x=b.triangleCount,C=b.vertexBuffer.ref.value,w=b.indexBuffer.ref.value,A=b.normalBuffer.ref.value.length>=S*3?b.normalBuffer.ref.value:new Float32Array(S*3);A===b.normalBuffer.ref.value&&A.fill(0,0,S*3),OQ(C,w,A,S,x),N.update(b.normalBuffer,A)}e.computeNormals=o;function s(b,S){S===void 0&&(S=3);for(var x=b.vertexBuffer.ref.value,C=new Map,w=function(H,B){return H[0].toFixed(B)+"|"+H[1].toFixed(B)+"|"+H[2].toFixed(B)},A=0,M=_(),D=0,k=b.vertexCount;D<k;++D){_.fromArray(M,x,D*3);var R=w(M,S),L=C.get(R);L!==void 0?(A+=1,C.set(R,L+1)):C.set(R,1)}return A}e.checkForDuplicateVertices=s;var u=zn();function l(b,S){var x=b.vertexBuffer.ref.value;if(Qp(S,x,0,b.vertexCount),!ue.isTranslationAndUniformScaling(S)){var C=zn.directionTransform(u,S);jLe(C,b.normalBuffer.ref.value,0,b.vertexCount)}N.update(b.vertexBuffer,x)}e.transform=l;function c(b){var S=("kind"in b?b.meta:b.meta.ref.value).originalData;return S}e.getOriginalData=c;function d(b,S){S===void 0&&(S=!0);var x=b.indexBuffer,C=b.vertexBuffer,w=b.groupBuffer,A=b.normalBuffer,M=b.triangleCount,D=b.vertexCount,k=x.ref.value,R=C.ref.value,L=w.ref.value,H=A.ref.value,B=qe.create(Uint32Array,3,1024,M),j=qe.create(Float32Array,3,1024,R);j.currentIndex=D*3,j.elementCount=D;var Q=qe.create(Float32Array,3,1024,H);Q.currentIndex=D*3,Q.elementCount=D;var G=qe.create(Float32Array,1,1024,L);G.currentIndex=D,G.elementCount=D;var W=_(),q=_(),ee=_(),he=_(),$=_(),X=_();function U(Xe){_.fromArray(W,R,Xe*3),_.fromArray(he,H,Xe*3),qe.add3(j,W[0],W[1],W[2]),qe.add3(Q,he[0],he[1],he[2])}function z(Xe,ct){_.fromArray(W,R,Xe*3),_.fromArray(q,R,ct*3),_.scale(W,_.add(W,W,q),.5),_.fromArray(he,H,Xe*3),_.fromArray($,H,ct*3),_.scale(he,_.add(he,he,$),.5),qe.add3(j,W[0],W[1],W[2]),qe.add3(Q,he[0],he[1],he[2])}function J(Xe,ct,Ne){_.fromArray(W,R,Xe*3),_.fromArray(q,R,ct*3),_.fromArray(ee,R,Ne*3),_.scale(W,_.add(W,_.add(W,W,q),ee),1/3),_.fromArray(he,H,Xe*3),_.fromArray($,H,ct*3),_.fromArray(X,H,Ne*3),_.scale(he,_.add(he,_.add(he,he,$),X),1/3),qe.add3(j,W[0],W[1],W[2]),qe.add3(Q,he[0],he[1],he[2])}function Y(Xe,ct,Ne,Qe,it){++te,U(Xe),z(Xe,ct),z(Xe,Ne),qe.add3(B,Z,Z+1,Z+2);for(var ot=0;ot<3;++ot)qe.add(G,Qe);Z+=3,te+=2,U(ct),U(Ne),z(Xe,ct),z(Xe,Ne),qe.add3(B,Z,Z+1,Z+3),qe.add3(B,Z,Z+3,Z+2);for(var ot=0;ot<4;++ot)qe.add(G,it);Z+=4}var Z=D,te=0;if(S)for(var le=0,ye=M;le<ye;++le){var be=k[le*3],Ee=k[le*3+1],Se=k[le*3+2],ie=L[be],oe=L[Ee],O=L[Se];if(ie===oe&&ie===O)++te,qe.add3(B,be,Ee,Se);else if(ie===oe)Y(Se,be,Ee,O,ie);else if(ie===O)Y(Ee,Se,be,oe,O);else if(oe===O)Y(be,Ee,Se,ie,oe);else{te+=2,U(be),z(be,Ee),z(be,Se),J(be,Ee,Se),qe.add3(B,Z,Z+1,Z+3),qe.add3(B,Z,Z+3,Z+2);for(var V=0;V<4;++V)qe.add(G,ie);Z+=4,te+=2,U(Ee),z(Ee,Se),z(Ee,be),J(be,Ee,Se),qe.add3(B,Z,Z+1,Z+3),qe.add3(B,Z,Z+3,Z+2);for(var V=0;V<4;++V)qe.add(G,oe);Z+=4,te+=2,U(Se),z(Se,Ee),z(Se,be),J(be,Ee,Se),qe.add3(B,Z+3,Z+1,Z),qe.add3(B,Z+2,Z+3,Z);for(var V=0;V<4;++V)qe.add(G,O);Z+=4}}else for(var le=0,ye=M;le<ye;++le){var be=k[le*3],Ee=k[le*3+1],Se=k[le*3+2],ie=L[be],oe=L[Ee],O=L[Se];if(ie!==oe||ie!==O){++te,U(be),U(Ee),U(Se),qe.add3(B,Z,Z+1,Z+2);for(var pe=oe===O?oe:ie,V=0;V<3;++V)qe.add(G,pe);Z+=3}else++te,qe.add3(B,be,Ee,Se)}var _e=qe.compact(B),Pe=qe.compact(j),je=qe.compact(Q),ze=qe.compact(G);return b.vertexCount=Z,b.triangleCount=te,N.update(C,Pe),N.update(w,ze),N.update(x,_e),N.update(A,je),b.meta.originalData={indexBuffer:k,vertexCount:D,triangleCount:M},b}e.uniformTriangleGroup=d,e.Params=E(E({},Et.Params),{doubleSided:I.Boolean(!1,Et.CustomQualityParamInfo),flipSided:I.Boolean(!1,Et.ShadingCategory),flatShaded:I.Boolean(!1,Et.ShadingCategory),ignoreLight:I.Boolean(!1,Et.ShadingCategory),xrayShaded:I.Boolean(!1,Et.ShadingCategory)}),e.Utils={Params:e.Params,createEmpty:r,createValues:h,createValuesSimple:v,updateValues:p,updateBoundingSphere:m,createRenderableState:g,updateRenderableState:y,createPositionIterator:f};function f(b,S){var x=b.vertexCount,C=S.instanceCount.ref.value,w=pv(),A=w.position,M=b.vertexBuffer.ref.value,D=S.aTransform.ref.value,k=function(R,L){return L<0?_.fromArray(A,M,R*3):_.transformMat4Offset(A,M,D,0,R*3,L*16),w};return mn(x,C,1,k)}function h(b,S,x,C,w){var A=x.instanceCount,M=x.groupCount,D=f(b,S),k=ns(x,D,C.color),R=Hs(A*M),L=id(),H=ad(),B=od(),j={drawCount:b.triangleCount*3,vertexCount:b.vertexCount,groupCount:M,instanceCount:A},Q=Fe.clone(b.boundingSphere),G=Vi(Q,S.aTransform.ref.value,A);return E(E(E(E(E(E(E(E({aPosition:b.vertexBuffer,aNormal:b.normalBuffer,aGroup:b.groupBuffer,elements:b.indexBuffer,boundingSphere:N.create(G),invariantBoundingSphere:N.create(Q),uInvariantBoundingSphere:N.create(_r.ofSphere(Q))},k),R),L),H),B),S),Et.createValues(w,j)),{dDoubleSided:N.create(w.doubleSided),dFlatShaded:N.create(w.flatShaded),dFlipSided:N.create(w.flipSided),dIgnoreLight:N.create(w.ignoreLight),dXrayShaded:N.create(w.xrayShaded),meta:N.create(b.meta)})}function v(b,S,x,C,w){var A=Et.createSimple(x,C,w),M=E(E({},I.getDefaultValues(e.Params)),S);return h(b,A.transform,A.locationIterator,A.theme,M)}function p(b,S){Et.updateValues(b,S),N.updateIfChanged(b.dDoubleSided,S.doubleSided),N.updateIfChanged(b.dFlatShaded,S.flatShaded),N.updateIfChanged(b.dFlipSided,S.flipSided),N.updateIfChanged(b.dIgnoreLight,S.ignoreLight),N.updateIfChanged(b.dXrayShaded,S.xrayShaded)}function m(b,S){var x=Fe.clone(S.boundingSphere),C=Vi(x,b.aTransform.ref.value,b.instanceCount.ref.value);Fe.equals(C,b.boundingSphere.ref.value)||N.update(b.boundingSphere,C),Fe.equals(x,b.invariantBoundingSphere.ref.value)||(N.update(b.invariantBoundingSphere,x),N.update(b.uInvariantBoundingSphere,_r.fromSphere(b.uInvariantBoundingSphere.ref.value,x)))}function g(b){var S=Et.createRenderableState(b);return y(S,b),S}function y(b,S){Et.updateRenderableState(b,S),b.opaque=b.opaque&&!S.xrayShaded,b.writeDepth=b.opaque}})(Nt||(Nt={}));var IBe={radius:1,detail:0};function MBe(e,t,r){var n=E(E({},IBe),r),i=n.radius,a=n.detail,o=DBe(),s=o.vertices,u=o.indices;c(a),zLe(s,i);var l=new Float32Array(s.length);return OQ(s,u,l,s.length/3,u.length/3),{vertices:new Float32Array(s),normals:new Float32Array(l),indices:new Uint32Array(u)};function c(f){for(var h=_(),v=_(),p=_(),m=0;m<t.length;m+=3)_.fromArray(h,e,t[m+0]*3),_.fromArray(v,e,t[m+1]*3),_.fromArray(p,e,t[m+2]*3),d(h,v,p,f)}function d(f,h,v,p){for(var m=Math.pow(2,p),g=[],y=0;y<=m;++y){g[y]=[];var b=_();_.lerp(b,f,v,y/m);var S=_();_.lerp(S,h,v,y/m);for(var x=m-y,C=0;C<=x;++C)if(C===0&&y===m)g[y][C]=b;else{var w=_();_.lerp(w,b,S,C/x),g[y][C]=w}}for(var y=0;y<m;++y)for(var C=0;C<2*(m-y)-1;++C){var A=Math.floor(C/2);C%2===0?o.add(g[y][A+1],g[y+1][A],g[y][A]):o.add(g[y][A+1],g[y+1][A+1],g[y+1][A])}}}function DBe(){var e=[],t=[],r=new Map;function n(i){var a=i[0].toFixed(5)+"|"+i[1].toFixed(5)+"|"+i[2].toFixed(5),o=r.get(a);return o===void 0&&(o=e.length/3,r.set(a,o),e.push.apply(e,i)),o}return{vertices:e,indices:t,add:function(i,a,o){t.push(n(i),n(a),n(o))}}}var us=(1+Math.sqrt(5))/2,RBe=[-1,us,0,1,us,0,-1,-us,0,1,-us,0,0,-1,us,0,1,us,0,-1,-us,0,1,-us,us,0,-1,us,0,1,-us,0,-1,-us,0,1],kBe=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],GP;function OBe(){return GP||(GP=N3(RBe,kBe)),GP}var oZ=OBe(),LBe=oZ.vertices,NBe=oZ.indices;function B3(e){return 10*Math.pow(Math.pow(2,e),2)+2}function FBe(e){return MBe(LBe,NBe,{detail:e,radius:1})}var gU=new Map,BBe=ue.identity();function UBe(e,t,r){return ue.scaleUniformly(e,ue.fromTranslation(e,t),r)}function sZ(e){var t=gU.get(e);return t===void 0&&(t=FBe(e),gU.set(e,t)),t}function Mi(e,t,r,n){wt.addPrimitive(e,UBe(BBe,t,r),sZ(n))}var Ku={radiusTop:1,radiusBottom:1,height:1,radialSegments:8,heightSegments:1,topCap:!1,bottomCap:!1,thetaStart:0,thetaLength:Math.PI*2};function jBe(e){var t=E(E({},Ku),e),r=t.radiusTop,n=t.radiusBottom,i=t.height,a=t.radialSegments,o=t.heightSegments,s=t.topCap,u=t.bottomCap,l=t.thetaStart,c=t.thetaLength,d=[],f=[],h=[],v=0,p=[],m=i/2;return g(),s&&r>0&&y(!0),u&&n>0&&y(!1),{vertices:new Float32Array(f),normals:new Float32Array(h),indices:new Uint32Array(d)};function g(){for(var b=_.zero(),S=(n-r)/i,x=0;x<=o;++x){for(var C=[],w=x/o,A=w*(n-r)+r,M=0;M<=a;++M){var D=M/a,k=D*c+l,R=Math.sin(k),L=Math.cos(k);f.push(A*R,-w*i+m,A*L),_.normalize(b,_.set(b,R,S,L)),h.push.apply(h,b),C.push(v++)}p.push(C)}for(var M=0;M<a;++M)for(var x=0;x<o;++x){var H=p[x][M],B=p[x+1][M],j=p[x+1][M+1],Q=p[x][M+1];d.push(H,B,Q),d.push(B,j,Q)}}function y(b){for(var S=b===!0?r:n,x=b===!0?1:-1,C=v,w=1;w<=a;++w)f.push(0,m*x,0),h.push(0,x,0),++v;for(var A=v,w=0;w<=a;++w){var M=w/a,D=M*c+l,k=Math.cos(D),R=Math.sin(D);f.push(S*R,m*x,S*k),h.push(0,x,0),++v}for(var w=0;w<a;++w){var L=C+w,H=A+w;b===!0?d.push(H,H+1,L):d.push(H+1,H,L)}}}var yU=_(),bU=_(),no=_(),io=_(),Gu=_(),qv=_(),zBe={height:1,topCap:!0,bottomCap:!0};function t0(e,t){var r=e.length/3;if(r<3)throw new Error("need at least 3 points to build a prism");var n=E(E({},zBe),t),i=n.height,a=n.topCap,o=n.bottomCap,s=r*2,u=r*4,l=(a?1:0)+(o?1:0);r===3?(s+=l,u+=l*3):r===4?(s+=l*2,u+=l*4):(s+=l*r,u+=l*r*3);var c=e0(s,u),d=i*.5;_.set(yU,0,0,-d),_.set(bU,0,0,d);for(var f=0;f<r;++f){var h=(f+1)%r;_.set(no,e[f*3],e[f*3+1],-d),_.set(io,e[h*3],e[h*3+1],-d),_.set(Gu,e[h*3],e[h*3+1],d),_.set(qv,e[f*3],e[f*3+1],d),c.addQuad(no,io,Gu,qv)}if(r===3)a&&(_.set(no,e[0],e[1],-d),_.set(io,e[3],e[4],-d),_.set(Gu,e[6],e[7],-d),c.add(Gu,io,no)),o&&(_.set(no,e[0],e[1],d),_.set(io,e[3],e[4],d),_.set(Gu,e[6],e[7],d),c.add(no,io,Gu));else if(r===4)a&&(_.set(no,e[0],e[1],-d),_.set(io,e[3],e[4],-d),_.set(Gu,e[6],e[7],-d),_.set(qv,e[9],e[10],-d),c.addQuad(qv,Gu,io,no)),o&&(_.set(no,e[0],e[1],d),_.set(io,e[3],e[4],d),_.set(Gu,e[6],e[7],d),_.set(qv,e[9],e[10],d),c.addQuad(no,io,Gu,qv));else for(var f=0;f<r;++f){var h=(f+1)%r;a&&(_.set(no,e[f*3],e[f*3+1],-d),_.set(io,e[h*3],e[h*3+1],-d),c.add(yU,io,no)),o&&(_.set(no,e[f*3],e[f*3+1],d),_.set(io,e[h*3],e[h*3+1],d),c.add(no,io,bU))}return c.getPrimitive()}var qP;function VBe(){return qP||(qP=t0(Ml(4,!1))),qP}var WP;function HBe(){return WP||(WP=t0(Ml(5,!1))),WP}var $P;function GBe(){return $P||($P=t0(Ml(6,!1))),$P}var XP;function qBe(){return XP||(XP=t0(Ml(6,!0))),XP}var YP;function WBe(){return YP||(YP=t0(Ml(7,!1))),YP}var xU=new Map,SU=_.create(0,1,0),sl=_(),ex=_(),CU=_(),yf=ue(),_U=ue(),$Be=_(),wU=ue(),Am=_(),KP=_();function h_(e,t,r,n,i){return _.setMagnitude(ex,r,n/2),_.add(CU,t,ex),i?_.matchDirection(KP,SU,ex):_.copy(KP,SU),ue.fromScaling(wU,_.set($Be,1,n,1)),_.makeRotation(_U,KP,ex),ue.mul(e,_U,wU),ue.setTranslation(e,CU)}var qu=new Int32Array(9);function XBe(e){var t,r,n,i,a,o,s,u,l;return qu[0]=Math.round(1e3*((t=e.radiusTop)!==null&&t!==void 0?t:Ku.radiusTop)),qu[1]=Math.round(1e3*((r=e.radiusBottom)!==null&&r!==void 0?r:Ku.radiusBottom)),qu[2]=Math.round(1e3*((n=e.height)!==null&&n!==void 0?n:Ku.height)),qu[3]=(i=e.radialSegments)!==null&&i!==void 0?i:Ku.radialSegments,qu[4]=(a=e.heightSegments)!==null&&a!==void 0?a:Ku.heightSegments,qu[5]=((o=e.topCap)!==null&&o!==void 0?o:Ku.topCap)?1:0,qu[6]=((s=e.bottomCap)!==null&&s!==void 0?s:Ku.bottomCap)?1:0,qu[7]=Math.round(1e3*((u=e.thetaStart)!==null&&u!==void 0?u:Ku.thetaStart)),qu[8]=Math.round(1e3*((l=e.thetaLength)!==null&&l!==void 0?l:Ku.thetaLength)),La(qu)}function IO(e){var t=XBe(e),r=xU.get(t);if(r===void 0){if(e.radialSegments&&e.radialSegments<=4){var n=Math.max(3,e.radialSegments),i=t0(Ml(n,!0,e.radiusTop),e);r=EO(i,ue.rotX90)}else r=jBe(e);xU.set(t,r)}return r}function Ma(e,t,r,n,i){var a=_.distance(t,r)*n;_.sub(sl,r,t),h_(yf,t,sl,a,!0),wt.addPrimitive(e,yf,IO(i))}function YBe(e,t,r,n,i,a){var o=_.distance(t,r)*n,s=IO(a);_.sub(sl,r,t),_.add(Am,t,i),h_(yf,Am,sl,o,!0),wt.addPrimitive(e,yf,s),_.sub(Am,t,i),h_(yf,Am,sl,o,!0),wt.addPrimitive(e,yf,s)}function Yy(e,t,r,n,i,a){var o=Math.floor(i/2),s=1/i;if(n<1){var u=n/2/i;n+=i%2===1?u:-u}var l=_.distance(t,r)*n,c=IO(a);_.sub(sl,r,t);for(var d=0;d<o;++d){var f=s*(d*2+1);_.setMagnitude(sl,sl,l*f),_.add(Am,t,sl),h_(yf,Am,sl,l*s,!1),wt.addPrimitive(e,yf,c)}}var $n=_(),EU=zn(),Vl=_(),Wu=_(),Sh=_(),tx=_(),To=_.fromArray,KBe=_.triangleNormal,AU=_.copy,rx=_.transformMat4,PU=_.transformMat3,TU=zn.directionTransform,Ys=qe.add3,QP=qe.add,wt;(function(e){function t(c,d,f){return c===void 0&&(c=2048),d===void 0&&(d=1024),{currentGroup:-1,vertices:qe.create(Float32Array,3,d,f?f.vertexBuffer.ref.value:c),normals:qe.create(Float32Array,3,d,f?f.normalBuffer.ref.value:c),indices:qe.create(Uint32Array,3,d*3,f?f.indexBuffer.ref.value:c*3),groups:qe.create(Float32Array,1,d,f?f.groupBuffer.ref.value:c),mesh:f}}e.createState=t;function r(c,d,f,h){var v=c.vertices,p=c.normals,m=c.indices,g=c.groups,y=c.currentGroup,b=v.elementCount;Ys(v,d[0],d[1],d[2]),Ys(v,f[0],f[1],f[2]),Ys(v,h[0],h[1],h[2]),KBe($n,d,f,h);for(var S=0;S<3;++S)Ys(p,$n[0],$n[1],$n[2]),QP(g,y);Ys(m,b,b+1,b+2)}e.addTriangle=r;function n(c,d,f){To(Sh,d,f[0]*3),To(tx,d,f[1]*3);for(var h=2,v=f.length;h<v;h+=2)AU(Vl,Sh),AU(Wu,tx),To(Sh,d,f[h]*3),To(tx,d,f[h+1]*3),r(c,Vl,Wu,Sh),r(c,Wu,tx,Sh)}e.addTriangleStrip=n;function i(c,d,f){To(Vl,d,f[0]*3);for(var h=2,v=f.length;h<v;++h)To(Wu,d,f[h-1]*3),To(Sh,d,f[h]*3),r(c,Vl,Sh,Wu)}e.addTriangleFan=i;function a(c,d,f){for(var h=f.vertices,v=f.normals,p=f.indices,m=c.vertices,g=c.normals,y=c.indices,b=c.groups,S=c.currentGroup,x=m.elementCount,C=TU(EU,d),w=0,A=h.length;w<A;w+=3)rx($n,To($n,h,w),d),Ys(m,$n[0],$n[1],$n[2]),PU($n,To($n,v,w),C),Ys(g,$n[0],$n[1],$n[2]),QP(b,S);for(var w=0,A=p.length;w<A;w+=3)Ys(y,p[w]+x,p[w+1]+x,p[w+2]+x)}e.addPrimitive=a;function o(c,d,f){for(var h=f.vertices,v=f.normals,p=f.indices,m=c.vertices,g=c.normals,y=c.indices,b=c.groups,S=c.currentGroup,x=m.elementCount,C=TU(EU,d),w=0,A=h.length;w<A;w+=3)rx($n,To($n,h,w),d),Ys(m,$n[0],$n[1],$n[2]),PU($n,To($n,v,w),C),Ys(g,-$n[0],-$n[1],-$n[2]),QP(b,S);for(var w=0,A=p.length;w<A;w+=3)Ys(y,p[w+2]+x,p[w+1]+x,p[w]+x)}e.addPrimitiveFlipped=o;function s(c,d,f,h,v,p){for(var m=f.vertices,g=f.edges,y={radiusTop:h,radiusBottom:h,radialSegments:p},b=0,S=g.length;b<S;b+=2)To(Vl,m,g[b]*3),To(Wu,m,g[b+1]*3),rx(Vl,Vl,d),rx(Wu,Wu,d),Mi(c,Vl,h,v),Mi(c,Wu,h,v),Ma(c,Vl,Wu,1,y)}e.addCage=s;function u(c,d,f){a(c,d,{vertices:f.vertexBuffer.ref.value.subarray(0,f.vertexCount*3),normals:f.normalBuffer.ref.value.subarray(0,f.vertexCount*3),indices:f.indexBuffer.ref.value.subarray(0,f.triangleCount*3)})}e.addMesh=u;function l(c){var d=c.vertices,f=c.normals,h=c.indices,v=c.groups,p=c.mesh,m=qe.compact(d,!0),g=qe.compact(h,!0),y=qe.compact(f,!0),b=qe.compact(v,!0);return Nt.create(m,g,y,b,c.vertices.elementCount,c.indices.elementCount,p)}e.getMesh=l})(wt||(wt={}));var QBe=1,ZBe="Assigns sizes as defined by the shape object.",uZ={};function JBe(e){return uZ}function MO(e,t){return{factory:MO,granularity:"groupInstance",size:function(r){return Ga.isLocation(r)?r.shape.getSize(r.group,r.instance):QBe},props:t,description:ZBe}}var e8e={name:"shape-group",label:"Shape Group",category:"",factory:MO,getParams:JBe,defaultValues:I.getDefaultValues(uZ),isApplicable:function(e){return!!e.shape}},t8e=at(13421772),r8e="Assigns colors as defined by the shape object.",lZ={};function n8e(e){return lZ}function DO(e,t){return{factory:DO,granularity:"groupInstance",color:function(r){return Ga.isLocation(r)?r.shape.getColor(r.group,r.instance):t8e},props:t,description:r8e}}var i8e={name:"shape-group",label:"Shape Group",category:"Miscellaneous",factory:DO,getParams:n8e,defaultValues:I.getDefaultValues(lZ),isApplicable:function(e){return!!e.shape}},cZ=Fa();function dd(e,t,r){return{id:cZ(),materialId:e.materialId,values:t,state:r,render:function(n,i){t.uAlpha&&t.alpha&&N.updateIfChanged(t.uAlpha,Ia(t.alpha.ref.value*r.alphaFactor,0,1)),e.render(n,i)},getProgram:function(n){return e.getProgram(n)},update:function(){return e.update()},dispose:function(){return e.destroy()}}}function qi(e,t){return{id:cZ(),values:t,render:function(){return e.render("compute")},update:function(){return e.update()},dispose:function(){return e.destroy()}}}var a8e=Fa();function o8e(e,t){var r=e.gl;switch(t){case"points":return r.POINTS;case"lines":return r.LINES;case"line-strip":return r.LINE_STRIP;case"line-loop":return r.LINE_LOOP;case"triangles":return r.TRIANGLES;case"triangle-strip":return r.TRIANGLE_STRIP;case"triangle-fan":return r.TRIANGLE_FAN}}var s8e={colorBlended:"",colorWboit:"",pickObject:"",pickInstance:"",pickGroup:"",depth:""},u8e=Object.keys(s8e),l8e={compute:""},c8e=Object.keys(l8e);function IU(e,t,r,n,i){return r=E(E({},r),{dRenderVariant:N.create(t)}),i.dRenderVariant===void 0&&Object.defineProperty(i,"dRenderVariant",{value:Qt("string")}),e.resources.program(r,n,i)}function d8e(){return{attributes:!1,defines:!1,elements:!1,textures:!1}}function f8e(e){e.attributes=!1,e.defines=!1,e.elements=!1,e.textures=!1}function fd(e,t,r,n,i,a){return dZ(e,t,r,n,i,a,u8e)}function Wi(e,t,r,n,i,a){return a===void 0&&(a=-1),dZ(e,t,r,n,i,a,c8e)}function dZ(e,t,r,n,i,a,o){var s=a8e(),u=e.stats,l=e.state,c=e.resources,d=e.extensions,f=d.instancedArrays,h=d.vertexArrayObject;if(i.uVertexCount){var v=i.uVertexCount.ref.value;i.aVertex=N.create(Fs(new Float32Array(v))),n.aVertex=Vr("float32",1,0)}for(var p=E6e(n,i),m=p.attributeValues,g=p.defineValues,y=p.textureValues,b=p.uniformValues,S=p.materialUniformValues,x=p.bufferedUniformValues,C=Object.entries(b),w=Object.entries(S),A=Object.entries(x),M=Object.entries(lFe(x)),D=Object.entries(g),k=A6e(i),R=o8e(e,t),L={},H=0,B=o;H<B.length;H++){var j=B[H];L[j]=IU(e,j,g,r,n)}var Q=bBe(e,n,y),G=mFe(e,n,m),W,q=i.elements;q&&q.ref.value&&(W=c.elements(q.ref.value));for(var ee={},he=0,$=o;he<$.length;he++){var j=$[he];ee[j]=h?c.vertexArray(L[j],G,W):null}var X=i.drawCount.ref.value,U=i.instanceCount.ref.value;u.drawCount+=X,u.instanceCount+=U,u.instancedDrawCount+=U*X;var z=d8e(),J=!1,Y=-1;return{id:s,materialId:a,getProgram:function(Z){return L[Z]},render:function(Z,te){if(!(X===0||U===0||e.isContextLost)){var le=L[Z];if(le.id===Y&&l.currentRenderItemId===s)le.setUniforms(C),te&&te.length>0?(le.bindTextures(te,0),le.bindTextures(Q,te.length)):le.bindTextures(Q,0);else{var ye=ee[Z];(le.id!==l.currentProgramId||le.id!==Y||a===-1||a!==l.currentMaterialId)&&(le.id!==l.currentProgramId&&le.use(),le.setUniforms(w),l.currentMaterialId=a,Y=le.id),le.setUniforms(C),le.setUniforms(M),te&&te.length>0?(le.bindTextures(te,0),le.bindTextures(Q,te.length)):le.bindTextures(Q,0),ye?(ye.bind(),W&&W.bind()):(W&&W.bind(),le.bindAttributes(G)),l.currentRenderItemId=s}if(Mr)try{TO(e.gl)}catch(be){throw new Error("Framebuffer error rendering item id "+s+": '"+be+"'")}if(W?f.drawElementsInstanced(R,X,W._dataType,0,U):f.drawArraysInstanced(R,0,X,U),Mr)try{ZQ(e.gl)}catch(be){throw new Error("Draw error rendering item id "+s+": '"+be+"'")}}},update:function(){if(f8e(z),i.aVertex){var Z=i.uVertexCount.ref.value;i.aVertex.ref.value.length<Z&&N.update(i.aVertex,Fs(new Float32Array(Z)))}for(var te=0,le=D.length;te<le;++te){var ye=D[te],be=ye[0],Ee=ye[1];Ee.ref.version!==k[be]&&(z.defines=!0,k[be]=Ee.ref.version)}if(z.defines)for(var Se=0,ie=o;Se<ie.length;Se++){var be=ie[Se];L[be].destroy(),L[be]=IU(e,be,g,r,n)}i.drawCount.ref.version!==k.drawCount&&(u.drawCount+=i.drawCount.ref.value-X,u.instancedDrawCount+=U*i.drawCount.ref.value-U*X,X=i.drawCount.ref.value,k.drawCount=i.drawCount.ref.version),i.instanceCount.ref.version!==k.instanceCount&&(u.instanceCount+=i.instanceCount.ref.value-U,u.instancedDrawCount+=i.instanceCount.ref.value*X-U*X,U=i.instanceCount.ref.value,k.instanceCount=i.instanceCount.ref.version);for(var te=0,le=G.length;te<le;++te){var oe=G[te],be=oe[0],O=oe[1],Ee=m[be];if(Ee.ref.version!==k[be]){if(O.length>=Ee.ref.value.length)O.updateSubData(Ee.ref.value,0,O.length);else{O.destroy();var V=n[be],pe=V.itemSize,_e=V.divisor;G[te][1]=c.attribute(Ee.ref.value,pe,_e),z.attributes=!0}k[be]=Ee.ref.version}}if(W&&i.elements.ref.version!==k.elements&&(W.length>=i.elements.ref.value.length?W.updateSubData(i.elements.ref.value,0,W.length):(W.destroy(),W=c.elements(i.elements.ref.value),z.elements=!0),k.elements=i.elements.ref.version),z.attributes||z.defines||z.elements)for(var Pe=0,je=o;Pe<je.length;Pe++){var be=je[Pe],ze=ee[be];ze&&ze.destroy(),ee[be]=h?c.vertexArray(L[be],G,W):null}for(var te=0,le=Q.length;te<le;++te){var Xe=Q[te],be=Xe[0],ct=Xe[1],Ee=y[be];Ee.ref.version!==k[be]&&(n[be].kind!=="texture"?(ct.load(Ee.ref.value),z.textures=!0):Q[te][1]=Ee.ref.value,k[be]=Ee.ref.version)}for(var te=0,le=A.length;te<le;++te){var Ne=A[te],be=Ne[0],Qe=Ne[1];Qe.ref.version!==k[be]&&(N.update(M[te][1],qf(Qe.ref.value)),k[be]=Qe.ref.version)}return z},destroy:function(){if(!J){for(var Z=0,te=o;Z<te.length;Z++){var le=te[Z];L[le].destroy();var ye=ee[le];ye&&ye.destroy()}Q.forEach(function(be){var Ee=be[0],Se=be[1];n[Ee].kind!=="texture"&&Se.destroy()}),G.forEach(function(be){be[0];var Ee=be[1];return Ee.destroy()}),W&&W.destroy(),u.drawCount-=X,u.instanceCount-=U,u.instancedDrawCount-=U*X,J=!0}}}}var h8e=E(E({},cd),{aPosition:Vr("float32",3,0),elements:mv("uint32"),uColor:Ge("v3"),uColorTexDim:Ge("v2"),tColor:ur("image-uint8","rgb","ubyte","nearest"),dColorType:Qt("string",["uniform","attribute","instance","group","groupInstance","vertex","vertexInstance"]),uIsoValue:Ge("v2"),uBboxMin:Ge("v3"),uBboxMax:Ge("v3"),uBboxSize:Ge("v3"),uMaxSteps:Ge("i"),uStepScale:Ge("f"),uJumpLength:Ge("f"),uTransform:Ge("m4"),uGridDim:Ge("v3"),dRenderMode:Qt("string",["isosurface","volume"]),dSingleLayer:Qt("boolean"),tTransferTex:ur("image-uint8","rgba","ubyte","linear"),uTransferScale:Ge("f"),dGridTexType:Qt("string",["2d","3d"]),uGridTexDim:Ge("v3"),tGridTex:ur("texture","rgba","ubyte","linear"),uGridStats:Ge("v4"),uCellDim:Ge("v3"),uCartnToUnit:Ge("m4"),uUnitToCartn:Ge("m4"),dPackedGroup:Qt("boolean"),dDoubleSided:Qt("boolean"),dFlipSided:Qt("boolean"),dFlatShaded:Qt("boolean"),dIgnoreLight:Qt("boolean"),dXrayShaded:Qt("boolean")});function p8e(e,t,r,n,i){var a=E(E(E(E({},sd),ud),ld),h8e);e.isWebGL2||(a.uMaxSteps=Qt("number"));var o={uObjectId:N.create(t)},s=HNe,u=fd(e,"triangles",s,a,E(E({},r),o),i);return dd(u,r,n)}var v8e=E(E({},cd),{aGroup:Vr("float32",1,0),aPosition:Vr("float32",3,0),aNormal:Vr("float32",3,0),elements:mv("uint32"),dFlatShaded:Qt("boolean"),dDoubleSided:Qt("boolean"),dFlipSided:Qt("boolean"),dIgnoreLight:Qt("boolean"),dXrayShaded:Qt("boolean"),meta:gi("unknown")});function m8e(e,t,r,n,i){var a=E(E(E(E({},sd),ud),ld),v8e),o={uObjectId:N.create(t)},s=XQ,u=fd(e,"triangles",s,a,E(E({},r),o),i);return dd(u,r,n)}var g8e=E(E(E({},cd),Rb),{aGroup:Vr("float32",1,0),aPosition:Vr("float32",3,0),dPointSizeAttenuation:Qt("boolean"),dPointFilledCircle:Qt("boolean"),uPointEdgeBleach:Ge("f")});function y8e(e,t,r,n,i){var a=E(E(E(E({},sd),ud),ld),g8e),o={uObjectId:N.create(t)},s=BNe,u=fd(e,"points",s,a,E(E({},r),o),i);return dd(u,r,n)}var b8e=E(E(E({},cd),Rb),{aGroup:Vr("float32",1,0),aMapping:Vr("float32",2,0),aStart:Vr("float32",3,0),aEnd:Vr("float32",3,0),elements:mv("uint32"),dLineSizeAttenuation:Qt("boolean"),dDoubleSided:Qt("boolean"),dFlipSided:Qt("boolean")});function x8e(e,t,r,n,i){var a=E(E(E(E({},sd),ud),ld),b8e),o={uObjectId:N.create(t)},s=VNe,u=fd(e,"triangles",s,a,E(E({},r),o),i);return dd(u,r,n)}var S8e=E(E(E({},cd),Rb),{aGroup:Vr("float32",1,0),aPosition:Vr("float32",3,0),aMapping:Vr("float32",2,0),elements:mv("uint32"),padding:gi("number"),dDoubleSided:Qt("boolean"),dIgnoreLight:Qt("boolean"),dXrayShaded:Qt("boolean")});function C8e(e,t,r,n,i){var a=E(E(E(E({},sd),ud),ld),S8e),o={uObjectId:N.create(t)},s=UNe,u=fd(e,"triangles",s,a,E(E({},r),o),i);return dd(u,r,n)}var _8e=E(E(E({},cd),Rb),{aGroup:Vr("float32",1,0),aPosition:Vr("float32",3,0),aMapping:Vr("float32",2,0),aDepth:Vr("float32",1,0),elements:mv("uint32"),aTexCoord:Vr("float32",2,0),tFont:ur("image-uint8","alpha","ubyte","linear"),padding:gi("number"),uBorderWidth:Ge("f"),uBorderColor:Ge("v3"),uOffsetX:Ge("f"),uOffsetY:Ge("f"),uOffsetZ:Ge("f"),uBackgroundColor:Ge("v3"),uBackgroundOpacity:Ge("f")});function w8e(e,t,r,n,i){var a=E(E(E(E({},sd),ud),ld),_8e),o={uObjectId:N.create(t)},s=zNe,u=fd(e,"triangles",s,a,E(E({},r),o),i);return dd(u,r,n)}var E8e=E(E({},cd),{uGeoTexDim:Ge("v2","buffered"),tPosition:ur("texture","rgb","float","nearest"),tGroup:ur("texture","alpha","float","nearest"),tNormal:ur("texture","rgb","float","nearest"),dFlatShaded:Qt("boolean"),dDoubleSided:Qt("boolean"),dFlipSided:Qt("boolean"),dIgnoreLight:Qt("boolean"),dXrayShaded:Qt("boolean"),dGeoTexture:Qt("boolean")});function A8e(e,t,r,n,i){var a=E(E(E(E({},sd),ud),ld),E8e),o={uObjectId:N.create(t)},s=XQ,u=fd(e,"triangles",s,a,E(E({},r),o),i);return dd(u,r,n)}var P8e=E(E({},cd),{aGroup:Vr("float32",1,0),aPosition:Vr("float32",3,0),aUv:Vr("float32",2,0),elements:mv("uint32"),uImageTexDim:Ge("v2"),tImageTex:ur("image-uint8","rgba","ubyte","nearest"),tGroupTex:ur("image-uint8","rgba","ubyte","nearest"),dInterpolation:Qt("string",k6e)});function T8e(e,t,r,n,i){var a=E(E(E(E({},sd),ud),ld),P8e),o={uObjectId:N.create(t)},s=GNe,u=fd(e,"triangles",s,a,E(E({},r),o),i);return dd(u,r,n)}var I8e=E(E(E({},cd),Rb),{aGroup:Vr("float32",1,0),aStart:Vr("float32",3,0),aEnd:Vr("float32",3,0),aMapping:Vr("float32",3,0),aScale:Vr("float32",1,0),aCap:Vr("float32",1,0),elements:mv("uint32"),padding:gi("number"),dDoubleSided:Qt("boolean"),dIgnoreLight:Qt("boolean"),dXrayShaded:Qt("boolean")});function M8e(e,t,r,n,i){var a=E(E(E(E({},sd),ud),ld),I8e),o={uObjectId:N.create(t)},s=jNe,u=fd(e,"triangles",s,a,E(E({},r),o),i);return dd(u,r,n)}var D8e=Fa(0,2147483647),hd=Fa(0,2147483647);function r0(e,t,r,n){return{id:D8e(),type:e,values:t,state:r,materialId:n}}function R8e(e,t){switch(t.type){case"mesh":return m8e(e,t.id,t.values,t.state,t.materialId);case"points":return y8e(e,t.id,t.values,t.state,t.materialId);case"spheres":return C8e(e,t.id,t.values,t.state,t.materialId);case"cylinders":return M8e(e,t.id,t.values,t.state,t.materialId);case"text":return w8e(e,t.id,t.values,t.state,t.materialId);case"lines":return x8e(e,t.id,t.values,t.state,t.materialId);case"direct-volume":return p8e(e,t.id,t.values,t.state,t.materialId);case"image":return T8e(e,t.id,t.values,t.state,t.materialId);case"texture-mesh":return A8e(e,t.id,t.values,t.state,t.materialId)}throw new Error("unsupported type")}var kr;(function(e){function t(c,d,f,h,v,p,m){return{id:dn.create22(),name:c,sourceData:d,geometry:f,transforms:m||[ue.identity()],get groupCount(){return ra.getGroupCount(f)},getColor:h,getSize:v,getLabel:p}}e.create=t;function r(c){return{color:DO({shape:c},{}),size:MO({shape:c},{})}}e.getTheme=r;function n(c){var d=c.transforms.length,f=Ga.Location(c),h=function(v,p){return f.group=v,f.instance=p,f};return mn(c.groupCount,d,1,h)}e.groupIterator=n;function i(c,d){for(var f=d&&d.aTransform.ref.value.length>=c.length*16?d.aTransform.ref.value:new Float32Array(c.length*16),h=0,v=c.length;h<v;++h)ue.toArray(c[h],f,h*16);return rO(f,c.length,d)}e.createTransform=i;function a(c,d){var f=e.getTheme(c),h=ra.getUtils(c.geometry),v=hd(),p=n(c),m=e.createTransform(c.transforms),g=h.createValues(c.geometry,m,p,f,d),y=h.createRenderableState(d);return r0(c.geometry.kind,g,y,v)}e.createRenderObject=a;function o(c){return{kind:"shape-loci",shape:c}}e.Loci=o;function s(c){return!!c&&c.kind==="shape-loci"}e.isLoci=s;function u(c,d){return c.shape===d.shape}e.areLociEqual=u;function l(c){return c.shape.groupCount===0}e.isLociEmpty=l})(kr||(kr={}));var Ga;(function(e){function t(h,v,p){return v===void 0&&(v=0),p===void 0&&(p=0),{kind:"group-location",shape:h,group:v,instance:p}}e.Location=t;function r(h){return!!h&&h.kind==="group-location"}e.isLocation=r;function n(h,v){return{kind:"group-loci",shape:h,groups:v}}e.Loci=n;function i(h){return!!h&&h.kind==="group-loci"}e.isLoci=i;function a(h,v){if(h.shape!==v.shape||h.groups.length!==v.groups.length)return!1;for(var p=0,m=h.groups.length;p<m;++p){var g=h.groups[p],y=g.ids,b=g.instance,S=v.groups[p],x=S.ids,C=S.instance;if(b!==C||!Oe.areEqual(y,x))return!1}return!0}e.areLociEqual=a;function o(h){return s(h)===0}e.isLociEmpty=o;function s(h){for(var v=0,p=0,m=h.groups;p<m.length;p++){var g=m[p];v+=Oe.size(g.ids)}return v}e.size=s;var u=new Bc,l=_.zero();function c(h,v,p,m){for(var g=v.indices,y=v.offsets,b=function(M,D){Oe.forEach(M,function(k){for(var R=y[k],L=y[k+1];R<L;++R)_.fromArray(l,p,g[R]*3),_.transformMat4(l,l,m[D]),u.includeStep(l)})},S=0,x=h;S<x.length;S++){var C=x[S],w=C.ids,A=C.instance;b(w,A)}}function d(h,v,p,m){for(var g=v.indices,y=v.offsets,b=function(M,D){Oe.forEach(M,function(k){for(var R=y[k],L=y[k+1];R<L;++R)_.fromArray(l,p,g[R]*3),_.transformMat4(l,l,m[D]),u.radiusStep(l)})},S=0,x=h;S<x.length;S++){var C=x[S],w=C.ids,A=C.instance;b(w,A)}}function f(h,v){v||(v=Fe()),u.reset();var p=0,m=h.shape,g=m.geometry,y=m.transforms;if(g.kind==="mesh"||g.kind==="points"){var b=g.kind==="mesh"?g.vertexBuffer.ref.value:g.centerBuffer.ref.value;c(h.groups,g.groupMapping,b,y),u.finishedIncludeStep(),d(h.groups,g.groupMapping,b,y)}else if(g.kind==="lines"){var S=g.startBuffer.ref.value,x=g.endBuffer.ref.value;c(h.groups,g.groupMapping,S,y),c(h.groups,g.groupMapping,x,y),u.finishedIncludeStep(),d(h.groups,g.groupMapping,S,y),d(h.groups,g.groupMapping,x,y)}else if(g.kind==="spheres"||g.kind==="text"){var b=g.centerBuffer.ref.value;c(h.groups,g.groupMapping,b,y),u.finishedIncludeStep(),d(h.groups,g.groupMapping,b,y);for(var C=function(L,H){Oe.forEach(L,function(B){var j=h.shape.getSize(B,H);p<j&&(p=j)})},w=0,A=h.groups;w<A.length;w++){var M=A[w],D=M.ids,k=M.instance;C(D,k)}}else return Fe.copy(v,g.boundingSphere);return _.copy(v.center,u.center),v.radius=Math.sqrt(u.radiusSq),Fe.expand(v,v,p),v}e.getBoundingSphere=f})(Ga||(Ga={}));function fZ(e){var t=e&&e.getElement("vertex"),r=e&&e.getElement("material"),n={group:"",vRed:"",vGreen:"",vBlue:"",mRed:"",mGreen:"",mBlue:""},i=[["",""]],a=[["",""]];if(t){for(var o=0,s=t.propertyNames.length;o<s;++o){var u=t.propertyNames[o],l=t.propertyTypes[o];(l==="uchar"||l==="uint8"||l==="ushort"||l==="uint16"||l==="uint"||l==="uint32"||l==="int")&&i.push([u,u]),(l==="uchar"||l==="uint8")&&a.push([u,u])}t.propertyNames.includes("atomid")?n.group="atomid":t.propertyNames.includes("material_index")&&(n.group="material_index"),t.propertyNames.includes("red")&&(n.vRed="red"),t.propertyNames.includes("green")&&(n.vGreen="green"),t.propertyNames.includes("blue")&&(n.vBlue="blue")}var c=[["",""]];if(r){for(var o=0,s=r.propertyNames.length;o<s;++o){var d=r.propertyNames[o],l=r.propertyTypes[o];(l==="uchar"||l==="uint8")&&c.push([d,d])}r.propertyNames.includes("red")&&(n.mRed="red"),r.propertyNames.includes("green")&&(n.mGreen="green"),r.propertyNames.includes("blue")&&(n.mBlue="blue")}var f=n.vRed&&n.vGreen&&n.vBlue?"vertex":n.mRed&&n.mGreen&&n.mBlue?"material":"uniform";return E(E({},Nt.Params),{coloring:I.MappedStatic(f,{vertex:I.Group({red:I.Select(n.vRed,a,{label:"Red Property"}),green:I.Select(n.vGreen,a,{label:"Green Property"}),blue:I.Select(n.vBlue,a,{label:"Blue Property"})},{isFlat:!0}),material:I.Group({red:I.Select(n.mRed,c,{label:"Red Property"}),green:I.Select(n.mGreen,c,{label:"Green Property"}),blue:I.Select(n.mBlue,c,{label:"Blue Property"})},{isFlat:!0}),uniform:I.Group({color:I.Color(dr.grey)},{isFlat:!0})}),grouping:I.MappedStatic(n.group?"vertex":"none",{vertex:I.Group({group:I.Select(n.group,i,{label:"Group Property"})},{isFlat:!0}),none:I.Group({})})})}var MU=fZ();function k8e(e,t,r,n,i){var a=r.vertices,o=r.normals,s=r.groups,u=n.getProperty("x"),l=n.getProperty("y"),c=n.getProperty("z");if(!u||!l||!c)throw new Error("missing coordinate properties");for(var d=n.getProperty("nx"),f=n.getProperty("ny"),h=n.getProperty("nz"),v=!!d&&!!f&&!!h,p=e;p<t;++p)qe.add3(a,u.value(p),l.value(p),c.value(p)),v&&qe.add3(o,d.value(p),f.value(p),h.value(p)),qe.add(s,i[p])}function O8e(e,t,r,n){for(var i=r.indices,a=e;a<t;++a){var o=n.value(a),s=o.entries,u=o.count;u===3?qe.add3(i,s[0],s[1],s[2]):u===4&&(qe.add3(i,s[2],s[1],s[0]),qe.add3(i,s[2],s[0],s[3]))}}function L8e(e,t,r,n,i){return ce(this,void 0,void 0,function(){var a,o,s,u,l,c,d,f,h,v,p,v,p,m;return de(this,function(g){switch(g.label){case 0:if(a=wt.createState(t.rowCount,t.rowCount/4,i),o=t.getProperty("x"),s=t.getProperty("y"),u=t.getProperty("z"),!o||!s||!u)throw new Error("missing coordinate properties");l=t.getProperty("nx"),c=t.getProperty("ny"),d=t.getProperty("nz"),f=!!l&&!!c&&!!d,h=1e5,v=0,p=t.rowCount,g.label=1;case 1:return v<p?(k8e(v,Math.min(v+h,p),a,t,n),e.shouldUpdate?[4,e.update({message:"adding ply mesh vertices",current:v,max:p})]:[3,3]):[3,4];case 2:g.sent(),g.label=3;case 3:return v+=h,[3,1];case 4:v=0,p=r.rowCount,g.label=5;case 5:return v<p?(O8e(v,Math.min(v+h,p),a,r),e.shouldUpdate?[4,e.update({message:"adding ply mesh faces",current:v,max:p})]:[3,7]):[3,8];case 6:g.sent(),g.label=7;case 7:return v+=h,[3,5];case 8:return m=wt.getMesh(a),f||Nt.computeNormals(m),[2,m]}})})}var Hl=ve.Schema.int;function N8e(e,t){for(var r=t.grouping,n=e.rowCount,i=r.name==="vertex"?e.getProperty(r.params.group):void 0,a=r.name==="vertex"?zo(r.params.group):"Vertex",o=i?i.toArray({array:Uint32Array}):Fs(new Uint32Array(n)),s=i?Cl(o):n-1,u=new Uint32Array(s+1),l=0,c=o.length;l<c;++l)u[o[l]]=l;return{ids:o,map:u,label:a}}function DU(e,t,r){var n=r.coloring,i=e.rowCount,a,o,s;if(n.name==="vertex")a=e.getProperty(n.params.red)||ve.ofConst(127,i,Hl),o=e.getProperty(n.params.green)||ve.ofConst(127,i,Hl),s=e.getProperty(n.params.blue)||ve.ofConst(127,i,Hl);else if(n.name==="material")a=t&&t.getProperty(n.params.red)||ve.ofConst(127,i,Hl),o=t&&t.getProperty(n.params.green)||ve.ofConst(127,i,Hl),s=t&&t.getProperty(n.params.blue)||ve.ofConst(127,i,Hl);else{var u=at.toRgb(n.params.color),l=u[0],c=u[1],d=u[2];a=ve.ofConst(l,i,Hl),o=ve.ofConst(c,i,Hl),s=ve.ofConst(d,i,Hl)}return{kind:n.name,red:a,green:o,blue:s}}function RU(e,t,r,n){var i=r.kind,a=r.red,o=r.green,s=r.blue,u=n.ids,l=n.map,c=n.label;return kr.create("ply-mesh",e,t,function(d){var f=i==="material"?d:l[d];return at.fromRgb(a.value(f),o.value(f),s.value(f))},function(){return 1},function(d){return c+" "+u[d]})}function F8e(){var e=this,t,r,n,i,a,o,s=function(u,l,c,d){return ce(e,void 0,void 0,function(){var f,h,v,p,m;return de(this,function(g){switch(g.label){case 0:if(f=l.getElement("vertex"),!f)throw new Error("missing vertex element");if(h=l.getElement("face"),!h)throw new Error("missing face element");return v=l.getElement("material"),p=!1,m=!1,(!t||t!==l)&&(p=!0),(!r||!I.isParamEqual(MU.grouping,r.grouping,c.grouping))&&(p=!0),(!r||!I.isParamEqual(MU.coloring,r.coloring,c.coloring))&&(m=!0),p?(a=DU(f,v,c),o=N8e(f,c),[4,L8e(u,f,h,o.ids,d&&d.geometry)]):[3,2];case 1:return i=g.sent(),n=RU(l,i,a,o),[3,3];case 2:m&&(a=DU(f,v,c),n=RU(l,i,a,o)),g.label=3;case 3:return t=l,r=qf(c),[2,n]}})})};return s}function B8e(e,t){var r=this;return We.create("Shape Provider",function(n){return ce(r,void 0,void 0,function(){return de(this,function(i){return[2,{label:"Mesh",data:e,params:fZ(e),getShape:F8e(),geometryUtils:Nt.Utils}]})})})}function _p(){return _p.empty()}(function(e){function t(i,a){return{size:i,anglesInRadians:a}}e.create=t;function r(){return t(_(),_())}e.empty=r;function n(i,a,o){var s=_.magnitude(i),u=_.magnitude(a),l=_.magnitude(o),c=Math.acos(_.dot(a,o)/(u*l)),d=Math.acos(_.dot(i,o)/(s*l)),f=Math.acos(_.dot(i,a)/(s*u));return s<=0||u<=0||l<=0||c>=Math.PI||d>=Math.PI||f>=Math.PI?r():t(_.create(s,u,l),_.create(c,d,f))}e.fromBasis=n})(_p||(_p={}));var U8e=20.45482949774598;function j8e(e){var t=this;return We.create("Parse DCD",function(r){return ce(t,void 0,void 0,function(){var n,i,a,o,s,u,l,c,d;return de(this,function(f){switch(f.label){case 0:return[4,r.update("Converting to coordinates")];case 1:for(f.sent(),n=e.header,i=n.DELTA?rf(n.DELTA*U8e,"ps"):rf(1,"step"),a=n.ISTART>=1?rf((n.ISTART-1)*i.value,i.unit):rf(0,i.unit),o=[],s=0,u=e.frames.length;s<u;++s)l=e.frames[s],c={elementCount:l.elementCount,time:rf(a.value+i.value*s,i.unit),x:l.x,y:l.y,z:l.z,xyzOrdering:{isIdentity:!0}},l.cell&&(d=l.cell,d[1]>=-1&&d[1]<=1&&d[3]>=-1&&d[3]<=1&&d[4]>=-1&&d[4]<=1?c.cell=_p.create(_.create(d[0],d[2],d[5]),_.create($r(90-Math.asin(d[1])*90/jy),$r(90-Math.asin(d[3])*90/jy),$r(90-Math.asin(d[4])*90/jy))):d[0]<0||d[1]<0||d[2]<0||d[3]<0||d[4]<0||d[5]<0||d[3]>180||d[4]>180||d[5]>180?c.cell=_p.fromBasis(_.create(d[0],d[1],d[3]),_.create(d[1],d[2],d[4]),_.create(d[3],d[4],d[5])):c.cell=_p.create(_.create(d[0],d[2],d[5]),_.create($r(hn(d[1],0,vn)?90:d[1]),$r(hn(d[3],0,vn)?90:d[3]),$r(hn(d[4],0,vn)?90:d[4])))),o.push(c);return[2,q1.create(o,i,a)]}})})})}function p_(e,t,r,n){for(var i=r,a=n-1,o=t.charCodeAt(i);(o===32||o>=48&&o<=57)&&i<=a;)o=t.charCodeAt(++i);for(o=t.charCodeAt(a);(o===32||o>=48&&o<=57)&&a>=i;)o=t.charCodeAt(--a);if(++a,i===a||i+1===a)return ht.add(e,i,a);if(o=t.charCodeAt(i),i+2===a){var s=t.charCodeAt(i+1);if((o===78||o===110)&&(s===65||s===97)||(o===67||o===99)&&(s===76||s===108)||(o===70||o===102)&&(s===69||s===101)||(o===83||o===115)&&(s===73||s===105)||(o===66||o===98)&&(s===82||s===114)||(o===65||o===97)&&(s===83||s===115))return ht.add(e,i,i+2)}if(o===67||o===99||o===72||o===104||o===78||o===110||o===79||o===111||o===80||o===112||o===83||o===115)return ht.add(e,i,i+1);ht.add(e,i,i)}var z8e=/^[\s\d]+|[\s\d]+$/g;function U3(e){e=e.replace(z8e,"").toUpperCase();var t=e.length;if(t===0||t===1||t===2&&(e==="NA"||e==="CL"||e==="FE"||e==="SI"||e==="BR"||e==="AS"))return e;if(t===3){if(e==="SOD")return"NA";if(e==="POT")return"K";if(e==="CES")return"CS";if(e==="CAL")return"CA";if(e==="CLA")return"CL"}var r=e[0];return r==="C"||r==="H"||r==="N"||r==="O"||r==="P"||r==="S"?r:""}var V8e=[new Set(["CA"]),new Set(["C"]),new Set(["N"])],H8e=[new Set(["P","O3'","O3*"]),new Set(["C4'","C4*"]),new Set(["O2'","O2*","F2'","F2*"])],G8e=[new Set(["P","O3'","O3*"]),new Set(["C3'","C3*"]),new Set(["O2'","O2*","F2'","F2*"])],q8e=new Set(["FMN","NCN","FNS","FMA"]),kU=function(){var e=new Map,t=[{id:"HIS",name:"HISTIDINE",type:"L-peptide linking"},{id:"ARG",name:"ARGININE",type:"L-peptide linking"},{id:"LYS",name:"LYSINE",type:"L-peptide linking"},{id:"ILE",name:"ISOLEUCINE",type:"L-peptide linking"},{id:"PHE",name:"PHENYLALANINE",type:"L-peptide linking"},{id:"LEU",name:"LEUCINE",type:"L-peptide linking"},{id:"TRP",name:"TRYPTOPHAN",type:"L-peptide linking"},{id:"ALA",name:"ALANINE",type:"L-peptide linking"},{id:"MET",name:"METHIONINE",type:"L-peptide linking"},{id:"CYS",name:"CYSTEINE",type:"L-peptide linking"},{id:"ASN",name:"ASPARAGINE",type:"L-peptide linking"},{id:"VAL",name:"VALINE",type:"L-peptide linking"},{id:"GLY",name:"GLYCINE",type:"peptide linking"},{id:"SER",name:"SERINE",type:"L-peptide linking"},{id:"GLN",name:"GLUTAMINE",type:"L-peptide linking"},{id:"TYR",name:"TYROSINE",type:"L-peptide linking"},{id:"ASP",name:"ASPARTIC ACID",type:"L-peptide linking"},{id:"GLU",name:"GLUTAMIC ACID",type:"L-peptide linking"},{id:"THR",name:"THREONINE",type:"L-peptide linking"},{id:"PRO",name:"PROLINE",type:"L-peptide linking"},{id:"SEC",name:"SELENOCYSTEINE",type:"L-peptide linking"},{id:"PYL",name:"PYRROLYSINE",type:"L-peptide linking"},{id:"MSE",name:"SELENOMETHIONINE",type:"L-peptide linking"},{id:"SEP",name:"PHOSPHOSERINE",type:"L-peptide linking"},{id:"TPO",name:"PHOSPHOTHREONINE",type:"L-peptide linking"},{id:"PTR",name:"O-PHOSPHOTYROSINE",type:"L-peptide linking"},{id:"PCA",name:"PYROGLUTAMIC ACID",type:"L-peptide linking"},{id:"A",name:"ADENOSINE-5'-MONOPHOSPHATE",type:"RNA linking"},{id:"C",name:"CYTIDINE-5'-MONOPHOSPHATE",type:"RNA linking"},{id:"T",name:"THYMIDINE-5'-MONOPHOSPHATE",type:"RNA linking"},{id:"G",name:"GUANOSINE-5'-MONOPHOSPHATE",type:"RNA linking"},{id:"I",name:"INOSINIC ACID",type:"RNA linking"},{id:"U",name:"URIDINE-5'-MONOPHOSPHATE",type:"RNA linking"},{id:"DA",name:"2'-DEOXYADENOSINE-5'-MONOPHOSPHATE",type:"DNA linking"},{id:"DC",name:"2'-DEOXYCYTIDINE-5'-MONOPHOSPHATE",type:"DNA linking"},{id:"DT",name:"THYMIDINE-5'-MONOPHOSPHATE",type:"DNA linking"},{id:"DG",name:"2'-DEOXYGUANOSINE-5'-MONOPHOSPHATE",type:"DNA linking"},{id:"DI",name:"2'-DEOXYINOSINE-5'-MONOPHOSPHATE",type:"DNA linking"},{id:"DU",name:"2'-DEOXYURIDINE-5'-MONOPHOSPHATE",type:"DNA linking"}];return t.forEach(function(r){return e.set(r.id,r)}),e}(),OU=function(){var e=new Map,t=[{id:"ZN2",name:"ZINC ION",type:"Ion"},{id:"SOD",name:"SODIUM ION",type:"Ion"},{id:"CES",name:"CESIUM ION",type:"Ion"},{id:"CLA",name:"CHLORIDE ION",type:"Ion"},{id:"CAL",name:"CALCIUM ION",type:"Ion"},{id:"POT",name:"POTASSIUM ION",type:"Ion"}];return t.forEach(function(r){return e.set(r.id,r)}),e}(),ch=function(){function e(t,r){this.seqId=t,this.atomId=r,this.namesMap=new Map,this.comps=new Map,this.ids=[],this.names=[],this.types=[],this.mon_nstd_flags=[]}return e.prototype.set=function(t){this.comps.set(t.id,t),this.ids.push(t.id),this.names.push(t.name),this.types.push(t.type),this.mon_nstd_flags.push(Ib.has(t.id)?"y":"n")},e.prototype.getAtomIds=function(t){for(var r=new Set,n=this.seqId.value(t);t<this.seqId.rowCount;){var i=this.seqId.value(t);if(i!==n)break;r.add(this.atomId.value(t)),t+=1}return r},e.prototype.hasAtomIds=function(t,r){for(var n=0,i=r.length;n<i;++n)if(!li.areIntersecting(t,r[n]))return!1;return!0},e.prototype.getType=function(t){return this.hasAtomIds(t,V8e)?"peptide linking":this.hasAtomIds(t,H8e)?"RNA linking":this.hasAtomIds(t,G8e)?"DNA linking":"other"},e.prototype.has=function(t){return this.comps.has(t)},e.prototype.get=function(t){return this.comps.get(t)},e.prototype.add=function(t,r){if(!this.has(t))if(kU.has(t))this.set(kU.get(t));else if(w3.has(t))this.set({id:t,name:"WATER",type:"non-polymer"});else if(q8e.has(t))this.set({id:t,name:this.namesMap.get(t)||t,type:"non-polymer"});else{var n=this.getAtomIds(r);if(n.size===1&&OU.has(t))this.set(OU.get(t));else{var i=this.getType(n);this.set({id:t,name:this.namesMap.get(t)||t,type:i})}}return this.get(t)},e.prototype.getChemCompTable=function(){return Xr.ofPartialColumns(Wa.chem_comp,{id:ve.ofStringArray(this.ids),name:ve.ofStringArray(this.names),type:ve.ofStringAliasArray(this.types),mon_nstd_flag:ve.ofStringAliasArray(this.mon_nstd_flags)},this.ids.length)},e.prototype.setNames=function(t){var r=this;t.forEach(function(n){return r.namesMap.set(n[0],n[1])})},e}(),ZP="ABCDEFGHIJKLMNOPQRSTUVWXYZ";function W8e(e){for(var t=ZP.length,r=e,n=0,i=ZP[r%t];r>=t;)r=Math.floor(r/t),i+=ZP[r%t],n+=1;return n>=5&&console.warn("getChainId overflow"),i}var p5=O3(W8e),dh=function(){function e(){this.count=0,this.ids=[],this.types=[],this.descriptions=[],this.compoundsMap=new Map,this.namesMap=new Map,this.heteroMap=new Map,this.chainMap=new Map}return e.prototype.set=function(t,r){this.count+=1,this.ids.push(""+this.count),this.types.push(t),this.descriptions.push([r])},e.prototype.getEntityId=function(t,r,n,i){return r===2?(this.waterId===void 0&&(this.set("water",(i==null?void 0:i.customName)||"Water"),this.waterId=""+this.count),this.waterId):cO(r)?this.compoundsMap.has(n)?this.compoundsMap.get(n):(this.chainMap.has(n)||(this.set("polymer",(i==null?void 0:i.customName)||"Polymer "+(this.chainMap.size+1)),this.chainMap.set(n,""+this.count)),this.chainMap.get(n)):(this.heteroMap.has(t)||(this.set("non-polymer",(i==null?void 0:i.customName)||this.namesMap.get(t)||t),this.heteroMap.set(t,""+this.count)),this.heteroMap.get(t))},e.prototype.getEntityTable=function(){return Xr.ofPartialColumns(Wa.entity,{id:ve.ofStringArray(this.ids),type:ve.ofStringAliasArray(this.types),pdbx_description:ve.ofStringListArray(this.descriptions)},this.count)},e.prototype.setCompounds=function(t){for(var r=0,n=t.length;r<n;++r){var i=t[r],a=i.chains,o=i.description;this.set("polymer",o);for(var s=0,u=a.length;s<u;++s)this.compoundsMap.set(a[s],""+this.count)}},e.prototype.setNames=function(t){var r=this;t.forEach(function(n){return r.namesMap.set(n[0],n[1])})},e}();function $8e(e,t){for(var r=e.atomName,n=e.residueName,i=new Array(e.count),a=new Array(e.count),o=new Uint32Array(e.count),s=new Uint32Array(e.count),u=new dh,l=new ch(e.residueNumber,e.atomName),c="",d=0,f="",h=0,v=0,p=-1,m=0,g=e.count;m<g;++m){var y=e.residueNumber.value(m);if(y!==p){var b=e.residueName.value(m),S=Kg(l.add(b,m).type,b);(S!==v||y!==p+1&&!(p===99999&&y===0))&&(f=p5(d),d+=1,h=0),c=u.getEntityId(b,S,f),h+=1,p=y,v=S}i[m]=c,a[m]=f,o[m]=h,s[m]=m}var x=ve.ofStringArray(a),C=Xr.ofPartialColumns(Wa.atom_site,{auth_asym_id:x,auth_atom_id:r,auth_comp_id:n,auth_seq_id:e.residueNumber,Cartn_x:ve.ofFloatArray(ve.mapToArray(e.x,function(w){return w*10},Float32Array)),Cartn_y:ve.ofFloatArray(ve.mapToArray(e.y,function(w){return w*10},Float32Array)),Cartn_z:ve.ofFloatArray(ve.mapToArray(e.z,function(w){return w*10},Float32Array)),id:ve.ofIntArray(s),label_asym_id:x,label_atom_id:r,label_comp_id:n,label_seq_id:ve.ofIntArray(o),label_entity_id:ve.ofStringArray(i),occupancy:ve.ofConst(1,e.count,ve.Schema.float),type_symbol:ve.ofStringArray(ve.mapToArray(e.atomName,function(w){return U3(w)})),pdbx_PDB_model_num:ve.ofConst(t,e.count,ve.Schema.int)},e.count);return vv({entity:u.getEntityTable(),chem_comp:l.getChemCompTable(),atom_site:C})}var v5;(function(e){function t(n){return(n==null?void 0:n.kind)==="gro"}e.is=t;function r(n){return{kind:"gro",name:n.structures[0].header.title,data:n}}e.fromGro=r})(v5||(v5={}));function X8e(e){var t=this;return We.create("Parse GRO",function(r){return ce(t,void 0,void 0,function(){var n,i,a,o,s,u;return de(this,function(l){switch(l.label){case 0:n=v5.fromGro(e),i=[],a=0,o=e.structures.length,l.label=1;case 1:return a<o?(s=$8e(e.structures[a].atoms,a+1),[4,rd(s,n,r)]):[3,4];case 2:u=l.sent(),u.frameCount===1&&i.push(u.representative),l.label=3;case 3:return++a,[3,1];case 4:return[2,new Xp(i)]}})})})}function Y8e(e,t){var r=function(a,o){return(t.substr(a,o)||"").trim()},n={entry_id:St.ofString(e),length_a:St.ofString(r(6,9)),length_b:St.ofString(r(15,9)),length_c:St.ofString(r(24,9)),angle_alpha:St.ofString(r(33,7)),angle_beta:St.ofString(r(40,7)),angle_gamma:St.ofString(r(47,7)),Z_PDB:St.ofString(r(66,4)),pdbx_unique_axis:St.ofString("?")},i={entry_id:St.ofString(e),"space_group_name_H-M":St.ofString(r(55,11)),Int_Tables_number:St.ofString("?"),cell_setting:St.ofString("?"),space_group_name_Hall:St.ofString("?")};return[sa.ofFields("cell",n),sa.ofFields("symmetry",i)]}function LU(e,t){return{id:e,details:t,groups:[]}}function K8e(e,t,r){for(var n=[],i,a,o,s=1,u=1,l=function(X){return e.data.substring(e.indices[2*X],e.indices[2*X+1])},c=t;c<r;c++){var d=l(c);if(d.substr(11,12)==="BIOMOLECULE:"){var f=d.substr(23).trim(),h="Biomolecule "+f;d=l(c+1),d.substr(11,30)!=="APPLY THE FOLLOWING TO CHAINS:"&&(c++,h=d.substr(11).trim()),i=LU(f,h),n.push(i)}else if(d.substr(13,5)==="BIOMT"){var v=d.split(/\s+/),p=parseInt(d[18])-1;p===0&&(o=ue.identity(),a.operators.push({id:s++,matrix:o})),ue.setValue(o,p,0,parseFloat(v[4])),ue.setValue(o,p,1,parseFloat(v[5])),ue.setValue(o,p,2,parseFloat(v[6])),ue.setValue(o,p,3,parseFloat(v[7]))}else if(d.substr(11,30)==="APPLY THE FOLLOWING TO CHAINS:"||d.substr(11,30)==="                   AND CHAINS:"){d.substr(11,5)==="APPLY"&&(a={chains:[],operators:[]},i.groups.push(a));for(var m=d.substr(41,30).split(","),g=0,y=m.length;g<y;++g){var b=m[g].trim();b&&a.chains.push(b)}}else if(d.substr(11,33)==="APPLYING THE FOLLOWING TO CHAINS:"){i=LU(""+u,"Biomolecule "+u),n.push(i),u+=1,a={chains:[],operators:[]},i.groups.push(a),c++,d=l(c);for(var m=d.substr(11,69).split(","),g=0,y=m.length;g<y;++g){var b=m[g].trim();b&&a.chains.push(b)}}}if(n.length===0)return[];for(var S={id:St.ofStrings(n.map(function(X){return X.id})),details:St.ofStrings(n.map(function(X){return X.details}))},x=[],C=0,w=n;C<w.length;C++)for(var A=w[C],M=0,D=A.groups;M<D.length;M++){var k=D[M];x.push({assembly_id:A.id,oper_expression:k.operators.map(function(X){return X.id}).join(","),asym_id_list:k.chains.join(",")})}for(var R={assembly_id:St.ofStrings(x.map(function(X){return X.assembly_id})),oper_expression:St.ofStrings(x.map(function(X){return X.oper_expression})),asym_id_list:St.ofStrings(x.map(function(X){return X.asym_id_list}))},L=[],H=0,B=n;H<B.length;H++)for(var A=B[H],j=0,Q=A.groups;j<Q.length;j++)for(var G=Q[j],W=0,q=G.operators;W<q.length;W++){for(var ee=q[W],p={id:""+ee.id,type:"?",name:"?",symmetry_operation:"?"},c=0;c<3;c++){for(var g=0;g<3;g++)p["matrix["+(c+1)+"]["+(g+1)+"]"]=""+ue.getValue(ee.matrix,c,g);p["vector["+(c+1)+"]"]=""+ue.getValue(ee.matrix,c,3)}L.push(p)}for(var he={id:St.ofStrings(L.map(function(X){return X.id})),type:St.ofStrings(L.map(function(X){return X.type})),name:St.ofStrings(L.map(function(X){return X.name})),symmetry_operation:St.ofStrings(L.map(function(X){return X.symmetry_operation}))},$=function(X){for(var U=function(Y){var Z="matrix["+(X+1)+"]["+(Y+1)+"]";he[Z]=St.ofStrings(L.map(function(te){return te[Z]}))},z=0;z<3;z++)U(z);var J="vector["+(X+1)+"]";he[J]=St.ofStrings(L.map(function(Y){return Y[J]}))},c=0;c<3;c++)$(c);return[sa.ofFields("pdbx_struct_assembly",S),sa.ofFields("pdbx_struct_assembly_gen",R),sa.ofFields("pdbx_struct_oper_list",he)]}function Q8e(e,t,r){for(var n=[],i,a=function(y){return e.data.substring(e.indices[2*y],e.indices[2*y+1])},o=t;o<r;o++){var s=a(o),u=s.split(/\s+/),l=parseInt(s[5])-1;l===0&&(i=ue.identity(),n.push(i)),ue.setValue(i,l,0,parseFloat(u[2])),ue.setValue(i,l,1,parseFloat(u[3])),ue.setValue(i,l,2,parseFloat(u[4])),ue.setValue(i,l,3,parseFloat(u[5]))}if(n.length===0)return[];for(var c=[],d=1,f=0,h=n;f<h.length;f++){for(var v=h[f],l={id:"ncsop"+d++,code:".",details:"."},o=0;o<3;o++){for(var p=0;p<3;p++)l["matrix["+(o+1)+"]["+(p+1)+"]"]=""+ue.getValue(v,o,p);l["vector["+(o+1)+"]"]=""+ue.getValue(v,o,3)}c.push(l)}for(var m={id:St.ofStrings(c.map(function(y){return y.id})),code:St.ofStrings(c.map(function(y){return y.code})),details:St.ofStrings(c.map(function(y){return y.details}))},g=function(y){for(var b=function(C){var w="matrix["+(y+1)+"]["+(C+1)+"]";m[w]=St.ofStrings(c.map(function(A){return A[w]}))},S=0;S<3;S++)b(S);var x="vector["+(y+1)+"]";m[x]=St.ofStrings(c.map(function(C){return C[x]}))},o=0;o<3;o++)g(o);return[sa.ofFields("struct_ncs_oper",m)]}var Z8e={1:"HELX_RH_AL_P",2:"HELX_RH_OM_P",3:"HELX_RH_PI_P",4:"HELX_RH_GA_P",5:"HELX_RH_3T_P",6:"HELX_LH_AL_P",7:"HELX_LH_OM_P",8:"HELX_LH_GA_P",9:"HELX_RH_27_P",10:"HELX_RH_PP_P"};function J8e(e){return Z8e[e]||"HELX_P"}function e7e(e,t,r){for(var n=[],i=function(f){return e.data.substring(e.indices[2*f],e.indices[2*f+1])},a=t;a<r;a++){var o=i(a);n.push({serNum:o.substr(7,3).trim(),helixID:o.substr(11,3).trim(),initResName:o.substr(15,3).trim(),initChainID:o.substr(19,1).trim(),initSeqNum:o.substr(21,4).trim(),initICode:o.substr(25,1).trim(),endResName:o.substr(27,3).trim(),endChainID:o.substr(31,3).trim(),endSeqNum:o.substr(33,4).trim(),endICode:o.substr(37,1).trim(),helixClass:o.substr(38,2).trim(),comment:o.substr(40,30).trim(),length:o.substr(71,5).trim()})}var s=St.ofStrings(n.map(function(f){return f.initChainID})),u=St.ofStrings(n.map(function(f){return f.initResName})),l=St.ofStrings(n.map(function(f){return f.endChainID})),c=St.ofStrings(n.map(function(f){return f.endResName})),d={beg_label_asym_id:s,beg_label_comp_id:u,beg_label_seq_id:St.ofUndefined(n.length,ve.Schema.int),beg_auth_asym_id:s,beg_auth_comp_id:u,beg_auth_seq_id:St.ofStrings(n.map(function(f){return f.initSeqNum})),conf_type_id:St.ofStrings(n.map(function(f){return J8e(f.helixClass)})),details:St.ofStrings(n.map(function(f){return f.comment})),end_label_asym_id:l,end_label_comp_id:c,end_label_seq_id:St.ofUndefined(n.length,ve.Schema.int),end_auth_asym_id:l,end_auth_comp_id:c,end_auth_seq_id:St.ofStrings(n.map(function(f){return f.endSeqNum})),id:St.ofStrings(n.map(function(f){return f.serNum})),pdbx_beg_PDB_ins_code:St.ofStrings(n.map(function(f){return f.initICode})),pdbx_end_PDB_ins_code:St.ofStrings(n.map(function(f){return f.endICode})),pdbx_PDB_helix_class:St.ofStrings(n.map(function(f){return f.helixClass})),pdbx_PDB_helix_length:St.ofStrings(n.map(function(f){return f.length})),pdbx_PDB_helix_id:St.ofStrings(n.map(function(f){return f.helixID}))};return sa.ofFields("struct_conf",d)}function t7e(e,t,r){for(var n=[],i=function(v){return e.data.substring(e.indices[2*v],e.indices[2*v+1])},a=t;a<r;a++){var o=i(a);n.push({strand:o.substr(7,3).trim(),sheetID:o.substr(11,3).trim(),numStrands:o.substr(14,2).trim(),initResName:o.substr(17,3).trim(),initChainID:o.substr(21,1).trim(),initSeqNum:o.substr(22,4).trim(),initICode:o.substr(26,1).trim(),endResName:o.substr(28,3).trim(),endChainID:o.substr(32,1).trim(),endSeqNum:o.substr(33,4).trim(),endICode:o.substr(37,1).trim(),sense:o.substr(38,2).trim(),curAtom:o.substr(41,4).trim(),curResName:o.substr(45,3).trim(),curChainId:o.substr(49,1).trim(),curResSeq:o.substr(50,4).trim(),curICode:o.substr(54,1).trim(),prevAtom:o.substr(56,4).trim(),prevResName:o.substr(60,3).trim(),prevChainId:o.substr(64,1).trim(),prevResSeq:o.substr(65,4).trim(),prevICode:o.substr(69,1).trim()})}var s=St.ofStrings(n.map(function(v){return v.initChainID})),u=St.ofStrings(n.map(function(v){return v.initResName})),l=St.ofStrings(n.map(function(v){return v.initSeqNum})),c=St.ofStrings(n.map(function(v){return v.endChainID})),d=St.ofStrings(n.map(function(v){return v.endResName})),f=St.ofStrings(n.map(function(v){return v.endSeqNum})),h={beg_label_asym_id:s,beg_label_comp_id:u,beg_label_seq_id:l,beg_auth_asym_id:s,beg_auth_comp_id:u,beg_auth_seq_id:l,end_label_asym_id:c,end_label_comp_id:c,end_label_seq_id:f,end_auth_asym_id:c,end_auth_comp_id:d,end_auth_seq_id:f,id:St.ofStrings(n.map(function(v){return v.strand})),sheet_id:St.ofStrings(n.map(function(v){return v.sheetID})),pdbx_beg_PDB_ins_code:St.ofStrings(n.map(function(v){return v.initICode})),pdbx_end_PDB_ins_code:St.ofStrings(n.map(function(v){return v.endICode}))};return sa.ofFields("struct_sheet_range",h)}var r7e={MOL_ID:"",MOLECULE:"",CHAIN:"",FRAGMENT:"",SYNONYM:"",EC:"",ENGINEERED:"",MUTATION:"",OTHER_DETAILS:""};function n7e(e,t,r){for(var n=function(h){return e.data.substring(e.indices[2*h],e.indices[2*h+1])},i,a={chains:[],description:""},o=[],s=t;s<r;s++){var u=n(s),l=u.substr(10,70).trim(),c=l.indexOf(":"),d=l.substring(0,c),f=void 0;d in r7e?(i=d,f=l.substring(c+2)):f=l,f=f.replace(/;$/,""),i==="MOL_ID"?(a={chains:[],description:""},o.push(a)):i==="MOLECULE"?(a.description&&(a.description+=" "),a.description+=f):i==="CHAIN"&&Array.prototype.push.apply(a.chains,f.split(/\s*,\s*/))}return o}function i7e(e,t,r){for(var n=function(l){return e.data.substring(e.indices[2*l],e.indices[2*l+1])},i=new Map,a=t;a<r;a++){var o=n(a),s=o.substr(11,3).trim(),u=o.substr(15).trim();i.has(s)?i.set(s,i.get(s)+" "+u):i.set(s,u)}return i}function a7e(e,t){var r=function(){return[]},n=function(){return ht.create(e,2*t)};return{index:0,group_PDB:n(),id:r(),auth_atom_id:n(),label_alt_id:n(),auth_comp_id:n(),auth_asym_id:n(),auth_seq_id:n(),pdbx_PDB_ins_code:n(),Cartn_x:n(),Cartn_y:n(),Cartn_z:n(),occupancy:n(),B_iso_or_equiv:n(),type_symbol:n(),pdbx_PDB_model_num:r(),label_entity_id:r(),partial_charge:n()}}function o7e(e){var t=St.ofTokens(e.auth_asym_id),r=St.ofTokens(e.auth_atom_id),n=St.ofTokens(e.auth_comp_id);return{auth_asym_id:t,auth_atom_id:r,auth_comp_id:n,auth_seq_id:St.ofTokens(e.auth_seq_id),B_iso_or_equiv:St.ofTokens(e.B_iso_or_equiv),Cartn_x:St.ofTokens(e.Cartn_x),Cartn_y:St.ofTokens(e.Cartn_y),Cartn_z:St.ofTokens(e.Cartn_z),group_PDB:St.ofTokens(e.group_PDB),id:St.ofStrings(e.id),label_alt_id:St.ofTokens(e.label_alt_id),label_asym_id:t,label_atom_id:r,label_comp_id:n,label_seq_id:St.ofUndefined(e.index,ve.Schema.int),label_entity_id:St.ofStrings(e.label_entity_id),occupancy:St.ofTokens(e.occupancy),type_symbol:St.ofTokens(e.type_symbol),pdbx_PDB_ins_code:St.ofTokens(e.pdbx_PDB_ins_code),pdbx_PDB_model_num:St.ofStrings(e.pdbx_PDB_model_num),partial_charge:St.ofTokens(e.partial_charge)}}function NU(e,t,r,n,i,a){var o=r.data,s=i-n;ht.addToken(e.group_PDB,It.trim(r,n,n+6)),It.trim(r,n+6,n+11),e.id[e.index]=r.data.substring(r.tokenStart,r.tokenEnd),ht.addToken(e.auth_atom_id,It.trim(r,n+12,n+16)),o.charCodeAt(n+16)===32?ht.add(e.label_alt_id,0,0):ht.add(e.label_alt_id,n+16,n+17),ht.addToken(e.auth_comp_id,It.trim(r,n+17,n+20)),ht.add(e.auth_asym_id,n+21,n+22),ht.addToken(e.auth_seq_id,It.trim(r,n+22,n+26)),o.charCodeAt(n+26)===32?ht.add(e.pdbx_PDB_ins_code,0,0):ht.add(e.pdbx_PDB_ins_code,n+26,n+27),ht.addToken(e.Cartn_x,It.trim(r,n+30,n+38)),ht.addToken(e.Cartn_y,It.trim(r,n+38,n+46)),ht.addToken(e.Cartn_z,It.trim(r,n+46,n+54)),ht.addToken(e.occupancy,It.trim(r,n+54,n+60)),s>=66?ht.addToken(e.B_iso_or_equiv,It.trim(r,n+60,n+66)):ht.add(e.B_iso_or_equiv,0,0),a&&ht.addToken(e.partial_charge,It.trim(r,n+70,n+76)),s>=78&&!a?(It.trim(r,n+76,n+78),r.tokenStart<r.tokenEnd?ht.addToken(e.type_symbol,r):p_(e.type_symbol,o,n+12,n+16)):p_(e.type_symbol,o,n+12,n+16),e.pdbx_PDB_model_num[e.index]=t,e.index++}function s7e(e,t){var r=function(){return[]},n=function(){return new Float32Array(t)},i=function(){return ht.create(e,2*t)};return{index:0,count:t,id:r(),type_symbol:i(),pdbx_label_atom_id:i(),pdbx_label_alt_id:i(),pdbx_label_comp_id:i(),pdbx_label_asym_id:i(),pdbx_label_seq_id:i(),pdbx_PDB_ins_code:i(),"U[1][1]":n(),"U[2][2]":n(),"U[3][3]":n(),"U[1][2]":n(),"U[1][3]":n(),"U[2][3]":n(),pdbx_auth_seq_id:i(),pdbx_auth_comp_id:i(),pdbx_auth_asym_id:i(),pdbx_auth_atom_id:i()}}function u7e(e){var t=St.ofTokens(e.pdbx_auth_seq_id),r=St.ofTokens(e.pdbx_auth_comp_id),n=St.ofTokens(e.pdbx_auth_asym_id),i=St.ofTokens(e.pdbx_auth_atom_id),a={id:St.ofStrings(e.id),type_symbol:St.ofTokens(e.type_symbol),pdbx_label_atom_id:i,pdbx_label_alt_id:St.ofTokens(e.pdbx_label_alt_id),pdbx_label_comp_id:r,pdbx_label_asym_id:n,pdbx_label_seq_id:t,pdbx_PDB_ins_code:St.ofTokens(e.pdbx_PDB_ins_code),pdbx_auth_seq_id:t,pdbx_auth_comp_id:r,pdbx_auth_asym_id:n,pdbx_auth_atom_id:i};return a["U[1][1]"]=St.ofNumbers(e["U[1][1]"]),a["U[2][2]"]=St.ofNumbers(e["U[2][2]"]),a["U[3][3]"]=St.ofNumbers(e["U[3][3]"]),a["U[1][2]"]=St.ofNumbers(e["U[1][2]"]),a["U[1][3]"]=St.ofNumbers(e["U[1][3]"]),a["U[2][3]"]=St.ofNumbers(e["U[2][3]"]),a}function l7e(e,t,r,n,i){var a=r.data,o=i-n;It.trim(r,n+6,n+11),e.id[e.index]=a.substring(r.tokenStart,r.tokenEnd),ht.addToken(e.pdbx_auth_atom_id,It.trim(r,n+12,n+16)),a.charCodeAt(n+16)===32?ht.add(e.pdbx_label_alt_id,0,0):ht.add(e.pdbx_label_alt_id,n+16,n+17),ht.addToken(e.pdbx_auth_comp_id,It.trim(r,n+17,n+20)),ht.add(e.pdbx_auth_asym_id,n+21,n+22),ht.addToken(e.pdbx_auth_seq_id,It.trim(r,n+22,n+26)),a.charCodeAt(n+26)===32?ht.add(e.pdbx_PDB_ins_code,0,0):ht.add(e.pdbx_PDB_ins_code,n+26,n+27),e["U[1][1]"][e.index]=qh(a,n+28,n+35)/1e4,e["U[2][2]"][e.index]=qh(a,n+35,n+42)/1e4,e["U[3][3]"][e.index]=qh(a,n+42,n+49)/1e4,e["U[1][2]"][e.index]=qh(a,n+49,n+56)/1e4,e["U[1][3]"][e.index]=qh(a,n+56,n+63)/1e4,e["U[2][3]"][e.index]=qh(a,n+63,n+70)/1e4,o>=78?(It.trim(r,n+76,n+78),r.tokenStart<r.tokenEnd?ht.addToken(e.type_symbol,r):p_(e.type_symbol,a,n+12,n+16)):p_(e.type_symbol,a,n+12,n+16),e.index++}function c7e(e,t,r,n){for(var i={},a=0,o=n.id.rowCount;a<o;++a)i[n.id.str(a)]=a;for(var s=function(k){return e.data.substring(e.indices[2*k],e.indices[2*k+1])},u=[],l=[],c=[],d=[],f=[],h=[],v=[],p=[],m=[],g=[],y=[11,16,21,26],b=1,a=t;a<r;a++){var S=s(a),x=i[parseInt(S.substr(6,5))],C={};if(x!==void 0)for(var w=0;w<4;++w){var A=parseInt(S.substr(y[w],5));if(!Number.isNaN(A)){var M=i[A];M!==void 0&&(x>M||C[M]===void 0&&(u.push("covale"+b),l.push("covale"),c.push(n.label_asym_id.str(x)),f.push(n.auth_seq_id.int(x)),d.push(n.label_seq_id.int(x)),h.push(n.label_atom_id.str(x)),v.push(n.label_asym_id.str(M)),m.push(n.auth_seq_id.int(M)),p.push(n.label_seq_id.int(M)),g.push(n.label_atom_id.str(M)),b+=1))}}}var D={id:St.ofStrings(u),conn_type_id:St.ofStrings(l),ptnr1_label_asym_id:St.ofStrings(c),ptnr1_auth_seq_id:St.ofNumbers(f),ptnr1_label_seq_id:St.ofNumbers(d),ptnr1_label_atom_id:St.ofStrings(h),ptnr2_label_asym_id:St.ofStrings(v),ptnr2_label_seq_id:St.ofNumbers(p),ptnr2_auth_seq_id:St.ofNumbers(m),ptnr2_label_atom_id:St.ofStrings(g)};return sa.ofFields("struct_conn",D)}function d7e(e){return ce(this,void 0,void 0,function(){var t,r,n,i,a,o,s,M,m,g,y,u,l,c,d,f,h,v,p,M,m,g,y,b,b,b,b,b,b,b,S,x,C,w,A,M,D,k,R,L,H,B,j,Q;return de(this,function(G){for(t=e.lines,r=t.data,n=t.indices,i=It(r),a=!!e.isPdbqt,o=0,s=0,M=0,m=t.count;M<m;M++)switch(g=n[2*M],y=n[2*M+1],r[g]){case"A":ci(r,g,y,"ATOM  ")?o++:ci(r,g,y,"ANISOU")&&s++;break;case"H":ci(r,g,y,"HETATM")&&o++;break}for(u=a7e(r,o),l=s7e(r,s),c=new dh,d=[],f=[],h=0,v="",p=void 0,M=0,m=t.count;M<m;M++)switch(g=n[2*M],y=n[2*M+1],r[g]){case"A":ci(r,g,y,"ATOM  ")?(h||(h++,v=""+h),NU(u,v,i,g,y,a)):ci(r,g,y,"ANISOU")&&l7e(l,v,i,g,y);break;case"C":if(ci(r,g,y,"CRYST1"))d.push.apply(d,Y8e(e.id||"?",r.substring(g,y)));else if(ci(r,g,y,"CONECT")){for(b=M+1;g=n[2*b],y=n[2*b+1],!!ci(r,g,y,"CONECT");)b++;p?Mr&&console.log("only single CONECT block allowed, ignoring others"):p=[M,b],M=b-1}else if(ci(r,g,y,"COMPND")){for(b=M+1;g=n[2*b],y=n[2*b+1],!!ci(r,g,y,"COMPND");)b++;c.setCompounds(n7e(t,M,b)),M=b-1}break;case"H":if(ci(r,g,y,"HETATM"))h||(h++,v=""+h),NU(u,v,i,g,y,a);else if(ci(r,g,y,"HELIX")){for(b=M+1;g=n[2*b],y=n[2*b+1],!!ci(r,g,y,"HELIX");)b++;d.push(e7e(t,M,b)),M=b-1}else if(ci(r,g,y,"HETNAM")){for(b=M+1;g=n[2*b],y=n[2*b+1],!!ci(r,g,y,"HETNAM");)b++;f.push.apply(f,Array.from(i7e(t,M,b).entries())),M=b-1}break;case"M":if(ci(r,g,y,"MODEL ")&&(h++,v=""+h),ci(r,g,y,"MTRIX")){for(b=M+1;g=n[2*b],y=n[2*b+1],!!ci(r,g,y,"MTRIX");)b++;d.push.apply(d,Q8e(t,M,b)),M=b-1}break;case"O":break;case"R":if(ci(r,g,y,"REMARK 350")){for(b=M+1;g=n[2*b],y=n[2*b+1],!!ci(r,g,y,"REMARK 350");)b++;d.push.apply(d,K8e(t,M,b)),M=b-1}break;case"S":if(ci(r,g,y,"SHEET")){for(b=M+1;g=n[2*b],y=n[2*b+1],!!ci(r,g,y,"SHEET");)b++;d.push(t7e(t,M,b)),M=b-1}break}for(S=ve.ofIntTokens(u.auth_seq_id),x=ve.ofStringTokens(u.auth_atom_id),C=ve.ofStringTokens(u.auth_comp_id),w=ve.ofStringTokens(u.auth_asym_id),A=new ch(S,x),A.setNames(f),c.setNames(f),M=0,D=C.rowCount;M<D;++M)k=C.value(M),R=Kg(A.add(k,M).type,k),u.label_entity_id[M]=c.getEntityId(k,R,w.value(M));for(L=o7e(u),a||delete L.partial_charge,p&&d.push(c7e(t,p[0],p[1],L)),H={entity:sa.ofTable("entity",c.getEntityTable()),chem_comp:sa.ofTable("chem_comp",A.getChemCompTable()),atom_site:sa.ofFields("atom_site",L),atom_site_anisotrop:sa.ofFields("atom_site_anisotrop",u7e(l))},B=0,j=d;B<j.length;B++)Q=j[B],H[Q.name]=Q;return[2,{header:e.id||"PDB",categoryNames:Object.keys(H),categories:H}]})})}var Tg;(function(e){e.Descriptor={name:"atom_partial_charge"},e.Provider=Mu.create(e.Descriptor)})(Tg||(Tg={}));var m5;(function(e){function t(n){return(n==null?void 0:n.kind)==="pdb"}e.is=t;function r(n){return{kind:"pdb",name:n.id||"",data:n}}e.create=r})(m5||(m5={}));function f7e(e){var t=this;return We.create("Parse PDB",function(r){return ce(t,void 0,void 0,function(){var n,i,a,o,s,u,l,c,d,f,h;return de(this,function(v){switch(v.label){case 0:return[4,r.update("Converting to mmCIF")];case 1:return v.sent(),[4,d7e(e)];case 2:return n=v.sent(),i=tn.fromFrame(n,void 0,m5.create(e)),[4,rd(i.data.db,i,r)];case 3:return a=v.sent(),o=(h=n.categories.atom_site)===null||h===void 0?void 0:h.getField("partial_charge"),o&&a.frameCount===1&&(s=a.representative,u=s.atomicHierarchy.atomSourceIndex,l=ve.isIdentity(u),c=l?void 0:u.toArray({array:Int32Array}),d=o.toFloatArray(),f=c?ve.ofFloatArray(ve.mapToArray(u,function(p){return d[p]},Float32Array)):ve.ofFloatArray(d),Tg.Provider.set(s,{data:f,type:"GASTEIGER"})),[2,a]}})})})}function h7e(e){for(var t=new Array(e.count),r=new Array(e.count),n=new Uint32Array(e.count),i=new Uint32Array(e.count),a=new dh,o=new ch(e.residueId,e.atomName),s="",u=0,l="",c=0,d=e.segmentName.value(0),f=!1,h=0,v=-1,p=0,m=e.count;p<m;++p){var g=e.residueId.value(p),y=e.segmentName.value(p);if(d!==y?(l=p5(u),u+=1,c=0,f=!0,d=y):f=!1,f||g!==v){var b=e.residueName.value(p),S=Kg(o.add(b,p).type,b);!f&&(S!==h||g!==v+1)&&(l=p5(u),u+=1,c=0),s=a.getEntityId(b,S,l),c+=1,v=g,h=S}t[p]=s,r[p]=l,n[p]=c,i[p]=p}var x=Xr.ofPartialColumns(Wa.atom_site,{auth_asym_id:e.segmentName,auth_atom_id:e.atomName,auth_comp_id:e.residueName,auth_seq_id:e.residueId,id:ve.ofIntArray(i),label_asym_id:ve.ofStringArray(r),label_atom_id:e.atomName,label_comp_id:e.residueName,label_seq_id:ve.ofIntArray(n),label_entity_id:ve.ofStringArray(t),occupancy:ve.ofConst(1,e.count,ve.Schema.float),type_symbol:ve.ofStringArray(ve.mapToArray(e.atomName,function(C){return U3(C)})),pdbx_PDB_model_num:ve.ofConst(1,e.count,ve.Schema.int)},e.count);return vv({entity:a.getEntityTable(),chem_comp:o.getChemCompTable(),atom_site:x})}var g5;(function(e){function t(n){return(n==null?void 0:n.kind)==="psf"}e.is=t;function r(n){return{kind:"psf",name:n.id,data:n}}e.fromPsf=r})(g5||(g5={}));function p7e(e){var t=this;return We.create("Parse PSF",function(r){return ce(t,void 0,void 0,function(){var n,i,a,o,s,u;return de(this,function(l){return n=g5.fromPsf(e),i=h7e(e.atoms),a=e.bonds,o=a.atomIdA,s=a.atomIdB,u={indexA:ve.ofLambda({value:function(c){return o.value(c)-1},rowCount:o.rowCount,schema:o.schema}),indexB:ve.ofLambda({value:function(c){return s.value(c)-1},rowCount:s.rowCount,schema:s.schema}),order:ve.ofConst(1,e.bonds.count,ve.Schema.int)},[2,VM.create(e.id,i,u,n)]})})})}function v7e(e){return Object.keys(e).filter(function(t){return!isNaN(t)}).map(function(t){return+t}).sort(function(t,r){return t-r}).map(function(t){return e[t]})}function JP(e,t,r){return e&&e[t]!==void 0?e[t]:r}function nt(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];return{kind:"alias",aliases:t,symbol:e}}function nx(e,t){for(var r=[],n=2;n<arguments.length;n++)r[n-2]=arguments[n];return e.info.namespace="molscript-macro",e.id="molscript-macro."+e.info.name,{kind:"macro",symbol:e,translate:t,aliases:Ft([e.info.name],r)}}function m7e(e){return e.kind==="alias"||e.kind==="macro"}var g7e=[["Core symbols",nt(Ce.core.type.bool,"bool"),nt(Ce.core.type.num,"num"),nt(Ce.core.type.str,"str"),nt(Ce.core.type.regex,"regex"),nt(Ce.core.type.list,"list"),nt(Ce.core.type.set,"set"),nt(Ce.core.type.compositeKey,"composite-key"),nt(Ce.core.logic.not,"not"),nt(Ce.core.logic.and,"and"),nt(Ce.core.logic.or,"or"),nt(Ce.core.ctrl.if,"if"),nt(Ce.core.ctrl.fn,"fn"),nt(Ce.core.ctrl.eval,"eval"),nt(Ce.core.math.add,"add","+"),nt(Ce.core.math.sub,"sub","-"),nt(Ce.core.math.mult,"mult","*"),nt(Ce.core.math.div,"div","/"),nt(Ce.core.math.pow,"pow","**"),nt(Ce.core.math.mod,"mod"),nt(Ce.core.math.min,"min"),nt(Ce.core.math.max,"max"),nt(Ce.core.math.floor,"floor"),nt(Ce.core.math.ceil,"ceil"),nt(Ce.core.math.roundInt,"round"),nt(Ce.core.math.abs,"abs"),nt(Ce.core.math.sqrt,"sqrt"),nt(Ce.core.math.cbrt,"cbrt"),nt(Ce.core.math.sin,"sin"),nt(Ce.core.math.cos,"cos"),nt(Ce.core.math.tan,"tan"),nt(Ce.core.math.asin,"asin"),nt(Ce.core.math.acos,"acos"),nt(Ce.core.math.atan,"atan"),nt(Ce.core.math.sinh,"sinh"),nt(Ce.core.math.cosh,"cosh"),nt(Ce.core.math.tanh,"tanh"),nt(Ce.core.math.exp,"exp"),nt(Ce.core.math.log,"log"),nt(Ce.core.math.log10,"log10"),nt(Ce.core.math.atan2,"atan2"),nt(Ce.core.rel.eq,"eq","="),nt(Ce.core.rel.neq,"neq","!="),nt(Ce.core.rel.lt,"lt","<"),nt(Ce.core.rel.lte,"lte","<="),nt(Ce.core.rel.gr,"gr",">"),nt(Ce.core.rel.gre,"gre",">="),nt(Ce.core.rel.inRange,"in-range"),nt(Ce.core.str.concat,"concat"),nt(Ce.core.str.match,"regex.match"),nt(Ce.core.list.getAt,"list.get"),nt(Ce.core.set.has,"set.has"),nt(Ce.core.set.isSubset,"set.subset")],["Structure",["Types",nt(Ce.structureQuery.type.entityType,"ent-type"),nt(Ce.structureQuery.type.authResidueId,"auth-resid"),nt(Ce.structureQuery.type.labelResidueId,"label-resid"),nt(Ce.structureQuery.type.ringFingerprint,"ringfp"),nt(Ce.structureQuery.type.bondFlags,"bond-flags")],["Slots",nt(Ce.structureQuery.slot.elementSetReduce,"atom.set.reduce.value")],["Generators",nt(Ce.structureQuery.generator.atomGroups,"sel.atom.atom-groups"),nt(Ce.structureQuery.generator.queryInSelection,"sel.atom.query-in-selection"),nt(Ce.structureQuery.generator.rings,"sel.atom.rings"),nt(Ce.structureQuery.generator.empty,"sel.atom.empty"),nt(Ce.structureQuery.generator.all,"sel.atom.all"),nt(Ce.structureQuery.generator.bondedAtomicPairs,"sel.atom.bonded-pairs"),nx(gy("sel.atom.atoms",Rt.Dictionary({0:vt(Me.Bool,{isOptional:!0,defaultValue:!0,description:"Test applied to each atom."})}),At.ElementSelection,"A selection of singleton atom sets."),function(e){return se.struct.generator.atomGroups({"atom-test":JP(e,0,!0)})}),nx(gy("sel.atom.res",Rt.Dictionary({0:vt(Me.Bool,{isOptional:!0,defaultValue:!0,description:"Test applied to the 1st atom of each residue."})}),At.ElementSelection,"A selection of atom sets grouped by residue."),function(e){return se.struct.generator.atomGroups({"residue-test":JP(e,0,!0),"group-by":se.ammp("residueKey")})}),nx(gy("sel.atom.chains",Rt.Dictionary({0:vt(Me.Bool,{isOptional:!0,defaultValue:!0,description:"Test applied to the 1st atom of each chain."})}),At.ElementSelection,"A selection of atom sets grouped by chain."),function(e){return se.struct.generator.atomGroups({"chain-test":JP(e,0,!0),"group-by":se.ammp("chainKey")})})],["Modifiers",nt(Ce.structureQuery.modifier.queryEach,"sel.atom.query-each"),nt(Ce.structureQuery.modifier.intersectBy,"sel.atom.intersect-by"),nt(Ce.structureQuery.modifier.exceptBy,"sel.atom.except-by"),nt(Ce.structureQuery.modifier.unionBy,"sel.atom.union-by"),nt(Ce.structureQuery.modifier.union,"sel.atom.union"),nt(Ce.structureQuery.modifier.cluster,"sel.atom.cluster"),nt(Ce.structureQuery.modifier.includeSurroundings,"sel.atom.include-surroundings"),nt(Ce.structureQuery.modifier.surroundingLigands,"sel.atom.surrounding-ligands"),nt(Ce.structureQuery.modifier.includeConnected,"sel.atom.include-connected"),nt(Ce.structureQuery.modifier.expandProperty,"sel.atom.expand-property")],["Filters",nt(Ce.structureQuery.filter.pick,"sel.atom.pick"),nt(Ce.structureQuery.filter.first,"sel.atom.first"),nt(Ce.structureQuery.filter.withSameAtomProperties,"sel.atom.with-same-atom-properties"),nt(Ce.structureQuery.filter.intersectedBy,"sel.atom.intersected-by"),nt(Ce.structureQuery.filter.within,"sel.atom.within"),nt(Ce.structureQuery.filter.isConnectedTo,"sel.atom.is-connected-to")],["Combinators",nt(Ce.structureQuery.combinator.intersect,"sel.atom.intersect"),nt(Ce.structureQuery.combinator.merge,"sel.atom.merge"),nt(Ce.structureQuery.combinator.distanceCluster,"sel.atom.dist-cluster")],["Atom Set Properties",nt(Ce.structureQuery.atomSet.atomCount,"atom.set.atom-count"),nt(Ce.structureQuery.atomSet.countQuery,"atom.set.count-query"),nt(Ce.structureQuery.atomSet.reduce,"atom.set.reduce"),nt(Ce.structureQuery.atomSet.propertySet,"atom.set.property")],["Atom Properties",nt(Ce.structureQuery.atomProperty.core.elementSymbol,"atom.el"),nt(Ce.structureQuery.atomProperty.core.vdw,"atom.vdw"),nt(Ce.structureQuery.atomProperty.core.mass,"atom.mass"),nt(Ce.structureQuery.atomProperty.core.atomicNumber,"atom.atomic-number"),nt(Ce.structureQuery.atomProperty.core.x,"atom.x"),nt(Ce.structureQuery.atomProperty.core.y,"atom.y"),nt(Ce.structureQuery.atomProperty.core.z,"atom.z"),nt(Ce.structureQuery.atomProperty.core.sourceIndex,"atom.src-index"),nt(Ce.structureQuery.atomProperty.core.operatorName,"atom.op-name"),nt(Ce.structureQuery.atomProperty.core.modelIndex,"atom.model-index"),nt(Ce.structureQuery.atomProperty.core.modelLabel,"atom.model-label"),nt(Ce.structureQuery.atomProperty.core.atomKey,"atom.key"),nt(Ce.structureQuery.atomProperty.core.bondCount,"atom.bond-count"),nt(Ce.structureQuery.atomProperty.topology.connectedComponentKey,"atom.key.molecule"),nt(Ce.structureQuery.atomProperty.macromolecular.authResidueId,"atom.auth-resid"),nt(Ce.structureQuery.atomProperty.macromolecular.labelResidueId,"atom.label-resid"),nt(Ce.structureQuery.atomProperty.macromolecular.residueKey,"atom.key.res"),nt(Ce.structureQuery.atomProperty.macromolecular.chainKey,"atom.key.chain"),nt(Ce.structureQuery.atomProperty.macromolecular.entityKey,"atom.key.entity"),nt(Ce.structureQuery.atomProperty.macromolecular.isHet,"atom.is-het"),nt(Ce.structureQuery.atomProperty.macromolecular.id,"atom.id"),nt(Ce.structureQuery.atomProperty.macromolecular.label_atom_id,"atom.label_atom_id"),nt(Ce.structureQuery.atomProperty.macromolecular.label_alt_id,"atom.label_alt_id","atom.altloc"),nt(Ce.structureQuery.atomProperty.macromolecular.label_comp_id,"atom.label_comp_id"),nt(Ce.structureQuery.atomProperty.macromolecular.label_asym_id,"atom.label_asym_id"),nt(Ce.structureQuery.atomProperty.macromolecular.label_entity_id,"atom.label_entity_id"),nt(Ce.structureQuery.atomProperty.macromolecular.label_seq_id,"atom.label_seq_id"),nt(Ce.structureQuery.atomProperty.macromolecular.auth_atom_id,"atom.auth_atom_id","atom.name"),nt(Ce.structureQuery.atomProperty.macromolecular.auth_comp_id,"atom.auth_comp_id","atom.resname"),nt(Ce.structureQuery.atomProperty.macromolecular.auth_asym_id,"atom.auth_asym_id","atom.chain"),nt(Ce.structureQuery.atomProperty.macromolecular.auth_seq_id,"atom.auth_seq_id","atom.resno"),nt(Ce.structureQuery.atomProperty.macromolecular.pdbx_PDB_ins_code,"atom.pdbx_PDB_ins_code","atom.inscode"),nt(Ce.structureQuery.atomProperty.macromolecular.pdbx_formal_charge,"atom.pdbx_formal_charge"),nt(Ce.structureQuery.atomProperty.macromolecular.occupancy,"atom.occupancy"),nt(Ce.structureQuery.atomProperty.macromolecular.B_iso_or_equiv,"atom.B_iso_or_equiv","atom.bfactor"),nt(Ce.structureQuery.atomProperty.macromolecular.entityType,"atom.entity-type"),nt(Ce.structureQuery.atomProperty.macromolecular.entitySubtype,"atom.entity-subtype"),nt(Ce.structureQuery.atomProperty.macromolecular.entityPrdId,"atom.entity-prd-id"),nt(Ce.structureQuery.atomProperty.macromolecular.entityDescription,"atom.entity-description"),nt(Ce.structureQuery.atomProperty.macromolecular.objectPrimitive,"atom.object-primitive"),nt(Ce.structureQuery.atomProperty.macromolecular.chemCompType,"atom.chem-comp-type"),nt(Ce.structureQuery.atomProperty.macromolecular.secondaryStructureKey,"atom.key.sec-struct"),nt(Ce.structureQuery.atomProperty.macromolecular.isModified,"atom.is-modified"),nt(Ce.structureQuery.atomProperty.macromolecular.modifiedParentName,"atom.modified-parent")],["Bond Properties",nt(Ce.structureQuery.bondProperty.order,"bond.order"),nt(Ce.structureQuery.bondProperty.length,"bond.length"),nt(Ce.structureQuery.bondProperty.atomA,"bond.atom-a"),nt(Ce.structureQuery.bondProperty.atomB,"bond.atom-b"),nx(gy("bond.is",Rt.List(At.BondFlag),Me.Bool,"Test if the current bond has at least one (or all if partial = false) of the specified flags: "+Me.oneOfValues(At.BondFlag).join(", ")),function(e){return se.core.flags.hasAny([se.struct.bondProperty.flags(),se.struct.type.bondFlags(v7e(e))])})]]],hZ=[];function pZ(e){for(var t=0,r=e;t<r.length;t++){var n=r[t];m7e(n)?hZ.push(n):n instanceof Array&&pZ(n)}}pZ(g7e);var y7e=function(){for(var e=[],t=Object.create(null),r=Zr.create(),n=Zr.create(),i=0,a=hZ;i<a.length;i++){for(var o=a[i],s=0,u=o.aliases;s<u.length;s++){var l=u[s];if(e.push([l,o]),t[l])throw new Error("Alias '"+l+"' already in use.");t[l]=o}var c=o.symbol.args;if(c.kind!=="dictionary"){c.type.kind==="oneof"&&Me.oneOfValues(c.type).forEach(function(v){return Zr.add(n,v,v)});continue}for(var d=0,f=Object.keys(c.map);d<f.length;d++){var l=f[d];isNaN(l)&&Zr.add(r,l,l);var h=c.map[l];h.type.kind==="oneof"&&Me.oneOfValues(h.type).forEach(function(p){return Zr.add(n,p,p)})}}return{symbolList:e,symbolMap:t,namedArgs:r.array,constants:n.array}}(),Wv=y7e.symbolMap;function Sy(e){if(_i.isLiteral(e))return e;if(_i.isSymbol(e)){if(!Wv[e.name])return e;var t=Wv[e.name];if(t.kind==="alias")return _i.Symbol(Wv[e.name].symbol.id);throw t.translate([])}var r=_i.isSymbol(e.head)&&!!Wv[e.head.name]&&Wv[e.head.name].kind==="macro",n=r?e.head:Sy(e.head),i=n!==e.head;if(!e.args)return r?Sy(e.head):i?_i.Apply(n):e;var a=!1,o;if(_i.isArgumentsArray(e.args)){o=[];for(var s=0,u=e.args.length;s<u;s++){var l=e.args[s],c=Sy(l);l!==c&&(a=!0),o[o.length]=c}if(a||(o=e.args),!r&&!i&&!a)return e}else{o={};for(var d=0,f=Object.keys(e.args);d<f.length;d++){var h=f[d],l=e.args[h],c=Sy(l);l!==c&&(a=!0),o[h]=c}if(!r&&!i&&!a)return e;a||(o=e.args)}if(r){var v=Wv[e.head.name];if(v.kind!=="macro")return _i.Apply(n,o);var p=v.translate(o);return p}return _i.Apply(n,o)}function b7e(e){return Sy(e)}var ru=function(){function e(t){this._=t}return e.prototype.parse=function(t){var r=this.skip(e.eof)._(t,0);return r.status?{success:!0,value:r.value}:{success:!1,index:vZ(t,r.furthest),expected:r.expected}},e.prototype.tryParse=function(t){var r=this.parse(t);if(r.success)return r.value;var n=C7e(t,r),i=new Error(n);throw i},e.prototype.or=function(t){return e.alt(this,t)},e.prototype.trim=function(t){return this.wrap(t,t)},e.prototype.wrap=function(t,r){return eT(1,typeof t=="string"?e.string(t):t,this,typeof r=="string"?e.string(r):r)},e.prototype.thru=function(t){return t(this)},e.prototype.then=function(t){return eT(1,this,t)},e.prototype.many=function(){var t=this;return new e(function(r,n){for(var i=[],a=void 0;;)if(a=Ss(t._(r,n),a),a.status){if(n===a.index)throw new Error("infinite loop detected in .many() parser --- calling .many() on a parser which can accept zero characters is usually the cause");n=a.index,i.push(a.value)}else return Ss(Sa(n,i),a)})},e.prototype.times=function(t,r){var n=this,i=typeof r>"u"?t:r;return new e(function(a,o){var s=[],u=void 0,l=void 0,c;for(c=0;c<t;c++)if(u=n._(a,o),l=Ss(u,l),u.status)o=u.index,s.push(u.value);else return l;for(;c<i&&(u=n._(a,o),l=Ss(u,l),u.status);c+=1)o=u.index,s.push(u.value);return Ss(Sa(o,s),l)})},e.prototype.result=function(t){return this.map(function(){return t})},e.prototype.atMost=function(t){return this.times(0,t)},e.prototype.atLeast=function(t){return e.seq(this.times(t),this.many()).map(function(r){return Ft(Ft([],r[0]),r[1])})},e.prototype.map=function(t){var r=this;return new e(function(n,i){var a=r._(n,i);return a.status?Ss(Sa(a.index,t(a.value)),a):a})},e.prototype.skip=function(t){return eT(0,this,t)},e.prototype.mark=function(){return e.seq(e.index,this,e.index).map(function(t){return{start:t[0],value:t[1],end:t[2]}})},e.prototype.node=function(t){return e.seq(e.index,this,e.index).map(function(r){return{name:t,start:r[0],value:r[1],end:r[2]}})},e.prototype.sepBy=function(t){return e.sepBy(this,t)},e.prototype.sepBy1=function(t){return e.sepBy1(this,t)},e.prototype.lookahead=function(t){return this.skip(e.lookahead(t))},e.prototype.notFollowedBy=function(t){return this.skip(e.notFollowedBy(t))},e.prototype.desc=function(t){var r=this;return new e(function(n,i){var a=r._(n,i);return a.status||(a.expected=[t]),a})},e.prototype.fallback=function(t){return this.or(e.succeed(t))},e.prototype.ap=function(t){return e.seq(t,this).map(function(r){var n=r[0],i=r[1];return n(i)})},e.prototype.chain=function(t){var r=this;return new e(function(n,i){var a=r._(n,i);if(!a.status)return a;var o=t(a.value);return Ss(o._(n,a.index),a)})},e}();(function(e){function t(){for(var S=[],x=0;x<arguments.length;x++)S[x]=arguments[x];var C=S.length;return new e(function(w,A){for(var M,D=new Array(C),k=A,R=0;R<C;R++){if(M=Ss(S[R]._(w,k),M),!M.status)return M;D[R]=M.value,k=M.index}return Ss(Sa(k,D),M)})}e.seq=t;function r(){for(var S=[],x=0;x<arguments.length;x++)S[x]=arguments[x];var C=S.length;return C===0?c("zero alternates"):new e(function(w,A){for(var M,D=0;D<S.length;D++)if(M=Ss(S[D]._(w,A),M),M.status)return M;return M})}e.alt=r;function n(S,x){return i(S,x).or(l([]))}e.sepBy=n;function i(S,x){var C=x.then(S).many();return t(S,C).map(function(w){return Ft([w[0]],w[1])})}e.sepBy1=i;function a(S){var x="'"+S+"'";if(S.length===1){var C=S.charCodeAt(0);return new e(function(w,A){return w.charCodeAt(A)===C?Sa(A+1,S):Gl(A,x)})}return new e(function(w,A){var M=A+S.length;return w.slice(A,M)===S?Sa(M,S):Gl(A,x)})}e.string=a;function o(S){var x=""+S;return x.slice(x.lastIndexOf("/")+1)}function s(S){return RegExp("^(?:"+S.source+")",o(S))}function u(S,x){x===void 0&&(x=0);var C=s(S),w=""+S;return new e(function(A,M){var D=C.exec(A.slice(M));if(D){if(0<=x&&x<=D.length){var k=D[0],R=D[x];return Sa(M+k.length,R)}var L="invalid match group (0 to "+D.length+") in "+w;return Gl(M,L)}return Gl(M,w)})}e.regexp=u;function l(S){return new e(function(x,C){return Sa(C,S)})}e.succeed=l;function c(S){return new e(function(x,C){return Gl(C,S)})}e.fail=c;function d(S){if(w7e(S))return new e(function(x,C){var w=S._(x,C);return w.status&&(w.index=C,w.value=null),w});if(typeof S=="string")return d(a(S));if(S instanceof RegExp)return d(u(S));throw new Error("not a string, regexp, or parser: "+S)}e.lookahead=d;function f(S){return new e(function(x,C){var w=S._(x,C);return w.status?Gl(C,'not "'+x.slice(C,w.index)+'"'):Sa(C,null)})}e.notFollowedBy=f;function h(S){return new e(function(x,C){var w=x.charAt(C);return C<x.length&&S(w)?Sa(C+1,w):Gl(C,"a character "+S)})}e.test=h;function v(S){return h(function(x){return S.indexOf(x)>=0})}e.oneOf=v;function p(S){return h(function(x){return S.indexOf(x)<0})}e.noneOf=p;function m(S,x){return h(function(C){return S<=C&&C<=x}).desc(S+"-"+x)}e.range=m;function g(S){return new e(function(x,C){for(var w=C;w<x.length&&S(x.charAt(w));)w++;return Sa(w,x.slice(C,w))})}e.takeWhile=g;function y(S){var x=new e(function(C,w){var A=S()._;return x._=A,A(C,w)});return x}e.lazy=y;function b(){return c("empty")}e.empty=b,e.index=new e(function(S,x){return Sa(x,vZ(S,x))}),e.anyChar=new e(function(S,x){return x>=S.length?Gl(x,"any character"):Sa(x+1,S.charAt(x))}),e.all=new e(function(S,x){return Sa(S.length,S.slice(x))}),e.eof=new e(function(S,x){return x<S.length?Gl(x,"EOF"):Sa(x,null)}),e.digit=u(/[0-9]/).desc("a digit"),e.digits=u(/[0-9]*/).desc("optional digits"),e.letter=u(/[a-z]/i).desc("a letter"),e.letters=u(/[a-z]*/i).desc("optional letters"),e.optWhitespace=u(/\s*/).desc("optional whitespace"),e.whitespace=u(/\s+/).desc("whitespace"),e.cr=a("\r"),e.lf=a(`
`),e.crlf=a(`\r
`),e.newline=r(e.crlf,e.lf,e.cr).desc("newline"),e.end=r(e.newline,e.eof)})(ru||(ru={}));function eT(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];var n=t.length;return new ru(function(i,a){for(var o,s,u=a,l=0;l<n;l++){if(o=Ss(t[l]._(i,u),o),!o.status)return o;e===l&&(s=o.value),u=o.index}return Ss(Sa(u,s),o)})}function Sa(e,t){return{status:!0,index:e,value:t}}function Gl(e,t){return{status:!1,furthest:e,expected:[t]}}function Ss(e,t){if(!t||e.status||t.status||e.furthest>t.furthest)return e;var r=e.furthest===t.furthest?_7e(e.expected,t.expected):t.expected;return{status:e.status,furthest:t.furthest,expected:r}}function vZ(e,t){var r=e.slice(0,t).split(`
`),n=r.length,i=r[r.length-1].length+1;return{offset:t,line:n,column:i}}function x7e(e){return e.length===1?e[0]:"one of "+e.join(", ")}function S7e(e,t){var r=t.index,n=r.offset;if(n===e.length)return", got the end of the input";var i=n>0?"'...":"'",a=e.length-n>12?"...'":"'";return" at line "+r.line+" column "+r.column+", got "+i+e.slice(n,n+12)+a}function C7e(e,t){return"expected "+x7e(t.expected)+S7e(e,t)}function _7e(e,t){var r=e.length,n=t.length;if(r===0)return t;if(n===0)return e;for(var i=new Set,a=[],o=0;o<r;o++)i.has(e[o])||(a[a.length]=e[o],i.add(e[o]));for(var o=0;o<n;o++)i.has(t[o])||(a[a.length]=t[o],i.add(t[o]));return a.sort(),a}function w7e(e){return e instanceof ru}function E7e(e){return y5.parse(e)}var y5;(function(e){var t;(function(S){function x(M){return{kind:"string",value:M}}S.str=x;function C(M){return{kind:"symbol",value:M}}S.symb=C;function w(M,D){return{kind:"list",bracket:M,nodes:D}}S.list=w;function A(M){return{kind:"comment",value:M}}S.comment=A})(t||(t={}));var r=ru.regexp(/[\n\r\s]*/),n=ru.lazy(function(){return ru.alt(i,d,a,o).trim(r)}),i=ru.takeWhile(function(S){return S!=="`"}).trim("`").map(t.str),a=ru.regexp(/[^()\[\]{};`,\n\r\s]+/).map(t.symb),o=ru.regexp(/\s*;+([^\n\r]*)\n/,1).map(t.comment),s=n.many(),u=s.wrap("(",")").map(function(S){return t.list("(",S)}),l=s.wrap("[","]").map(function(S){return t.list("[",S)}),c=s.wrap("{","}").map(function(S){return t.list("{",S)}),d=ru.alt(u,l,c),f=n.many();function h(S){return f.tryParse(S)}function v(S){switch(S.kind){case"string":return S.value;case"symbol":{var x=S.value;if(x.length>1){var C=x.charAt(0);switch(C){case".":return se.atomName(x.substr(1));case"_":return se.struct.type.elementSymbol([x.substr(1)])}}return x==="true"?!0:x==="false"?!1:y(x)?+x:_i.Symbol(x)}case"list":{switch(S.bracket){case"[":return se.core.type.list(g(S.nodes).map(v));case"{":return se.core.type.set(g(S.nodes).map(v));case"(":{var w=v(S.nodes[0]);return _i.Apply(w,p(S.nodes))}}return 0}default:throw new Error("should not happen")}}function p(S){if(!(S.length<=1)){if(!m(S)){for(var x=[],C=1,w=S.length;C<w;C++){var A=S[C];A.kind!=="comment"&&(x[x.length]=v(A))}return x}for(var M={},D=!0,k=0,C=1,w=S.length;C<w;C++){var A=S[C];if(A.kind!=="comment")if(A.kind==="symbol"&&A.value.length>1&&A.value.charAt(0)===":"){var R=A.value.substr(1);for(++C;C<w&&S[C].kind==="comment";)C++;if(C>=w)throw new Error("There must be a value foolowed a named arg ':"+R+"'.");M[R]=v(S[C]),isNaN(+R)&&(D=!1)}else M[k++]=v(A)}if(D){for(var L=Object.keys(M).map(function(j){return+j}).sort(function(j,Q){return j-Q}),H=!0,C=0,w=L.length;C<w;C++)if(L[C]!==C){H=!1;break}if(H){for(var B=[],C=0,w=L.length;C<w;C++)B[C]=M[C];return B}}return M}}function m(S){for(var x=1,C=S.length;x<C;x++){var w=S[x];if(w.kind==="symbol"&&w.value.length>1&&w.value.charAt(0)===":")return!0}return!1}function g(S){for(var x=!1,C=0,w=S.length;C<w;C++)if(S[C].kind==="comment"){x=!0;break}return x?S.filter(function(A){return A.kind!=="comment"}):S}function y(S){return/-?(0|[1-9][0-9]*)([.][0-9]+)?([eE][+-]?[0-9]+)?/.test(S)&&!isNaN(+S)}function b(S){for(var x=h(S),C=[],w=0,A=x;w<A.length;w++){var M=A[w];M.kind!=="comment"&&(C[C.length]=v(M))}return C}e.parse=b})(y5||(y5={}));function Li(e,t){return{expression:e,language:t}}(function(e){function t(s){return!!s&&typeof s.expression=="string"&&!!s.language}e.is=t;function r(s,u){return s.language===u.language&&s.expression===u.expression}e.areEqual=r;function n(s){switch(s.language){case"mol-script":var u=E7e(s.expression);if(u.length===0)throw new Error("No query");return b7e(u[0])}throw new Error("unsupported script language")}e.toExpression=n;function i(s){var u=n(s);return Kp(u)}e.toQuery=i;function a(s,u){var l=i(s),c=l(new Qo(u));return mt.toLociWithSourceUnits(c)}e.toLoci=a;function o(s,u,l){var c=typeof s=="function"?s(se):s,d=Kp(c);return d(new Qo(u,l))}e.getStructureSelection=o})(Li||(Li={}));var wp;(function(e){function t(u,l){var c=u&&si.Provider.get(u),d=c?c.assemblies.map(function(S){return[S.id,S.id+": "+zo(S.details)]}):[],f=c?!xo.isZero(c.spacegroup.cell):!0,h=[];if(c)for(var v=c.spacegroup.operators,p=0,m=v.length;p<m;p++)h.push([p,p+1+": "+Du.getOperatorXyz(v[p])]);var g=[];u&&u.properties.structAsymMap.forEach(function(S){var x=S.id===S.auth_id?S.id:S.id+" [auth "+S.auth_id+"]";g.push([S.id,x])});var y={auto:I.EmptyGroup(),model:I.EmptyGroup(),assembly:I.Group({id:I.Optional(u?I.Select(d.length?d[0][0]:"",d,{label:"Asm Id",description:"Assembly Id"}):I.Text("",{label:"Asm Id",description:"Assembly Id (use empty for the 1st assembly)"}))},{isFlat:!0}),"symmetry-mates":I.Group({radius:I.Numeric(5,{min:0,max:50,step:1})},{isFlat:!0}),symmetry:I.Group({ijkMin:I.Vec3(_.create(-1,-1,-1),{step:1},{label:"Min IJK",fieldLabels:{x:"I",y:"J",z:"K"}}),ijkMax:I.Vec3(_.create(1,1,1),{step:1},{label:"Max IJK",fieldLabels:{x:"I",y:"J",z:"K"}})},{isFlat:!0}),"symmetry-assembly":I.Group({generators:I.ObjectList({operators:I.ObjectList({index:I.Select(0,h),shift:I.Vec3(_(),{step:1},{label:"IJK",fieldLabels:{x:"I",y:"J",z:"K"}})},function(S){return S.index+1+"_"+S.shift.map(function(x){return x+5}).join("")},{defaultValue:[]}),asymIds:I.MultiSelect([],g)},function(S){return S.asymIds.length+" asym ids, "+S.operators.length+" operators"},{defaultValue:[]})},{isFlat:!0})},b=[];return l==="auto"&&b.push(["auto","Auto"]),b.push(["model","Model"]),d.length>0&&b.push(["assembly","Assembly"]),f&&(b.push(["symmetry-mates","Symmetry Mates"]),b.push(["symmetry","Symmetry (indices)"]),b.push(["symmetry-assembly","Symmetry (assembly)"])),{type:I.MappedStatic(l||"model",y,{options:b})}}e.getParams=t;function r(u,l){return!(l.name==="symmetry-assembly"||l.name==="symmetry"&&u.name==="symmetry")}e.canAutoUpdate=r;function n(u,l,c,d){return ce(this,void 0,void 0,function(){var f,h,v,p,m,g;return de(this,function(y){switch(y.label){case 0:return f=void 0,h=si.Provider.get(c),!d&&h&&h.assemblies.length!==0&&(d=h.assemblies[0].id),!h||h.assemblies.length===0?u.log.warn("Model '"+c.entryId+"' has no assembly, returning model structure."):(f=X1.findAssembly(c,d||""),f||u.log.warn("Model '"+c.entryId+"' has no assembly called '"+d+"', returning model structure.")),v=$e.ofModel(c),f?(d=f.id,[4,dl.buildAssembly(v,d).runInContext(l)]):(p={label:"Model",description:$e.elementDescription(v)},[2,new ge.Molecule.Structure(v,p)]);case 1:return m=y.sent(),g={label:"Assembly "+d,description:$e.elementDescription(m)},[2,new ge.Molecule.Structure(m,g)]}})})}function i(u,l,c,d){return ce(this,void 0,void 0,function(){var f,h,v;return de(this,function(p){switch(p.label){case 0:return f=$e.ofModel(l),[4,dl.buildSymmetryRange(f,c,d).runInContext(u)];case 1:return h=p.sent(),v={label:"Symmetry ["+c+"] to ["+d+"]",description:$e.elementDescription(h)},[2,new ge.Molecule.Structure(h,v)]}})})}function a(u,l,c){return ce(this,void 0,void 0,function(){var d,f,h;return de(this,function(v){switch(v.label){case 0:return d=$e.ofModel(l),[4,dl.builderSymmetryMates(d,c).runInContext(u)];case 1:return f=v.sent(),h={label:"Symmetry Mates",description:$e.elementDescription(f)},[2,new ge.Molecule.Structure(f,h)]}})})}function o(u,l,c,d){return ce(this,void 0,void 0,function(){var f,h,v;return de(this,function(p){switch(p.label){case 0:return f=$e.ofModel(l),[4,dl.buildSymmetryAssembly(f,c,d).runInContext(u)];case 1:return h=p.sent(),v={label:"Symmetry Assembly",description:$e.elementDescription(h)},[2,new ge.Molecule.Structure(h,v)]}})})}function s(u,l,c,d){return ce(this,void 0,void 0,function(){var f,h,h;return de(this,function(v){if(f=si.Provider.get(c),!f||!d||d.name==="model")return h=$e.ofModel(c),[2,new ge.Molecule.Structure(h,{label:"Model",description:$e.elementDescription(h)})];if(d.name==="auto")return f.assemblies.length===0?(h=$e.ofModel(c),[2,new ge.Molecule.Structure(h,{label:"Model",description:$e.elementDescription(h)})]):[2,n(u,l,c)];if(d.name==="assembly")return[2,n(u,l,c,d.params.id)];if(d.name==="symmetry")return[2,i(l,c,d.params.ijkMin,d.params.ijkMax)];if(d.name==="symmetry-mates")return[2,a(l,c,d.params.radius)];if(d.name==="symmetry-assembly")return[2,o(l,c,d.params.generators,f)];throw new Error("Unknown represetation type: "+d.name)})})}e.create=s})(wp||(wp={}));var Ta;(function(e){function t(s,u,l){return s.currentStructure!==l?!1:Li.is(u)?!!s.script&&Li.areEqual(s.script,u):s.expression===u}e.isUnchanged=t;function r(s,u){var l=Li.is(u)?u:void 0,c=Li.is(u)?Li.toExpression(u):u,d=Kp(c);return{script:l,expression:c,compiled:d,originalStructure:s,currentStructure:s}}e.create=r;function n(s,u){return s.compiled(new Qo(u))}e.run=n;function i(s,u){var l=r(s,u);return{entry:l,selection:n(l,s)}}e.createAndRun=i;function a(s,u){return s.currentStructure=u,s.compiled(new Qo(u))}e.updateStructure=a;function o(s,u,l){var c=mt.unionStructure(u);s.label=""+(l||"Selection"),s.description=$e.elementDescription(c),s.data=c}e.updateStructureObject=o})(Ta||(Ta={}));var A7e=function(){return{type:I.MappedStatic("static",{static:I.Text("polymer"),expression:I.Value(se.struct.generator.all),bundle:I.Value(Jr.Empty),script:I.Script({language:"mol-script",expression:"(sel.atom.all)"})},{isHidden:!0}),nullIfEmpty:I.Optional(I.Boolean(!0,{isHidden:!0})),label:I.Text("",{isHidden:!0})}};function P7e(e,t,r){r.source=e;var n=$e.Empty,i=void 0;switch(t.type.name){case"static":{var a=void 0;switch(t.type.params){case"all":a=di.all.query,i="All";break;case"polymer":a=di.polymer.query,i="Polymer";break;case"protein":a=di.protein.query,i="Protein";break;case"nucleic":a=di.nucleic.query,i="Nucleic";break;case"water":a=en.internal.water(),i="Water";break;case"ion":a=di.ion.query,i="Ion";break;case"lipid":a=di.lipid.query,i="Lipid";break;case"branched":a=di.branchedPlusConnected.query,i="Branched";break;case"ligand":a=di.ligandPlusConnected.query,i="Ligand";break;case"non-standard":a=di.nonStandardPolymer.query,i="Non-standard";break;case"coarse":a=di.coarse.query,i="Coarse";break;default:throw new Error(t.type+" is a not valid complex element.")}var o=a(new Qo(e));n=mt.unionStructure(o);break}case"script":case"expression":{var s=Ta.createAndRun(e,t.type.params),u=s.selection,l=s.entry;r.entry=l,n=mt.unionStructure(u);break}case"bundle":{if(t.type.params.hash!==e.hashCode)break;n=Jr.toStructure(t.type.params,e);break}}if(t.nullIfEmpty&&n.elementCount===0)return In.Null;var c={label:""+(t.label||i||"Component"),description:$e.elementDescription(n)};return new ge.Molecule.Structure(n,c)}function T7e(e,t,r,n,i){if(r.type.name!==n.type.name)return ft.UpdateResult.Recreate;var a=!1;switch(n.type.name){case"static":return r.type.params!==n.type.params||!$e.areEquivalent(e,i.source)?ft.UpdateResult.Recreate:t.data.model===e.model?ft.UpdateResult.Unchanged:Wt.areHierarchiesEqual(e.model,t.data.model)?(t.data=t.data.remapModel(e.model),ft.UpdateResult.Updated):ft.UpdateResult.Recreate;case"script":if(!Li.areEqual(r.type.params,n.type.params))return ft.UpdateResult.Recreate;case"expression":{if(r.type.params!==n.type.params)return ft.UpdateResult.Recreate;if(e===i.source)break;var o=i.entry,s=Ta.updateStructure(o,e);i.source=e,t.data=mt.unionStructure(s),Ta.updateStructureObject(t,s,n.label),a=!0;break}case"bundle":{if(e===i.source&&Jr.areEqual(r.type.params,n.type.params))break;i.source=e,n.type.params.hash!==e.hashCode?(a=t.data.elementCount!==0,t.data=t.data.elementCount===0?t.data:$e.Empty):(a=!0,t.data=Jr.toStructure(n.type.params,e));break}}if(a){if(n.nullIfEmpty&&t.data.elementCount===0)return ft.UpdateResult.Null;t.description=$e.elementDescription(t.data)}return r.label!==n.label&&(a=!0,t.label=""+(n.label||t.label)),a?ft.UpdateResult.Updated:ft.UpdateResult.Unchanged}function mZ(e,t){for(var r=ht.create(e.data,t*2),n=ht.create(e.data,t*2),i=ht.create(e.data,t*2),a=ht.create(e.data,t*2),o=0;o<t;++o){It.markLine(e);var s=e.tokenStart,u=e.position;It.trim(e,s,s+10),ht.addUnchecked(r,e.tokenStart,e.tokenEnd),It.trim(e,s+10,s+20),ht.addUnchecked(n,e.tokenStart,e.tokenEnd),It.trim(e,s+20,s+30),ht.addUnchecked(i,e.tokenStart,e.tokenEnd),It.trim(e,s+31,s+34),ht.addUnchecked(a,e.tokenStart,e.tokenEnd),e.position=u}return{count:t,x:qr(r)(ve.Schema.float),y:qr(n)(ve.Schema.float),z:qr(i)(ve.Schema.float),type_symbol:qr(a)(ve.Schema.str)}}function gZ(e,t){for(var r=ht.create(e.data,t*2),n=ht.create(e.data,t*2),i=ht.create(e.data,t*2),a=0;a<t;++a){It.markLine(e);var o=e.tokenStart,s=e.position;It.trim(e,o,o+3),ht.addUnchecked(r,e.tokenStart,e.tokenEnd),It.trim(e,o+3,o+6),ht.addUnchecked(n,e.tokenStart,e.tokenEnd),It.trim(e,o+6,o+9),ht.addUnchecked(i,e.tokenStart,e.tokenEnd),e.position=s}return{count:t,atomIdxA:qr(r)(ve.Schema.int),atomIdxB:qr(n)(ve.Schema.int),order:qr(i)(ve.Schema.int)}}function I7e(e){var t=It(e),r=It.readLine(t).trim(),n=It.readLine(t).trim(),i=It.readLine(t).trim(),a=It.readLine(t),o=+a.substr(0,3),s=+a.substr(3,3),u=mZ(t,o),l=gZ(t,s),c={title:r,program:n,comment:i,atoms:u,bonds:l};return wn.success(c)}function M7e(e){var t=this;return We.create("Parse Mol",function(){return ce(t,void 0,void 0,function(){return de(this,function(r){return[2,I7e(e)]})})})}function yZ(e,t,r){return ce(this,void 0,void 0,function(){var n,i,a,o,s,u,l,c,d,f,h,v,p,m,g;return de(this,function(y){switch(y.label){case 0:return n=e.atoms,i=e.bonds,a=ve.ofConst("MOL",e.atoms.count,ve.Schema.str),o=ve.ofConst("A",e.atoms.count,ve.Schema.str),s=ve.asArrayColumn(n.type_symbol),u=ve.ofConst(1,n.count,ve.Schema.int),l=Xr.ofPartialColumns(Wa.atom_site,{auth_asym_id:o,auth_atom_id:s,auth_comp_id:a,auth_seq_id:u,Cartn_x:ve.asArrayColumn(n.x,Float32Array),Cartn_y:ve.asArrayColumn(n.y,Float32Array),Cartn_z:ve.asArrayColumn(n.z,Float32Array),id:ve.range(0,n.count-1),label_asym_id:o,label_atom_id:s,label_comp_id:a,label_seq_id:u,label_entity_id:ve.ofConst("1",n.count,ve.Schema.str),occupancy:ve.ofConst(1,n.count,ve.Schema.float),type_symbol:s,pdbx_PDB_model_num:ve.ofConst(1,n.count,ve.Schema.int)},n.count),c=new dh,c.setNames([["MOL","Unknown Entity"]]),c.getEntityId("MOL",0,"A"),d=new ch(u,s),d.setNames([["MOL","Unknown Molecule"]]),d.add("MOL",0),f=vv({entity:c.getEntityTable(),chem_comp:d.getChemCompTable(),atom_site:l}),[4,rd(f,t??b5.create(e),r)];case 1:return h=y.sent(),h.frameCount>0&&(v=ve.ofIntArray(ve.mapToArray(i.atomIdxA,function(b){return b-1},Int32Array)),p=ve.ofIntArray(ve.mapToArray(i.atomIdxB,function(b){return b-1},Int32Array)),m=ve.asArrayColumn(i.order,Int32Array),g=fa.fromData({pairs:{indexA:v,indexB:p,order:m},count:n.count}),fa.Provider.set(h.representative,g)),[2,h]}})})}var b5;(function(e){function t(n){return(n==null?void 0:n.kind)==="mol"}e.is=t;function r(n){return{kind:"mol",name:n.title,data:n}}e.create=r})(b5||(b5={}));function D7e(e){return We.create("Parse MOL",function(t){return yZ(e,void 0,t)})}function R7e(e){var t=e.IT_number.value(0),r=e["name_H-M_full"].value(0);return e.IT_number.isDefined?(e["name_H-M_full"].isDefined,t):r}function k7e(e){var t=e.cell,r=e.space_group,n=R7e(r),i=xo.create(n,_.create(t.length_a.value(0),t.length_b.value(0),t.length_c.value(0)),_.scale(_(),_.create(t.angle_alpha.value(0),t.angle_beta.value(0),t.angle_gamma.value(0)),Math.PI/180));return{spacegroup:Du.create(i),assemblies:[],isNonStandardCrystalFrame:!1,ncsOperators:[]}}function O7e(e,t,r){var n;return ce(this,void 0,void 0,function(){var i,a,o,s,u,l,c,d,f,h,v,p,m,g,Se,y,b,S,x,C,D,w,Se,A,M,D,Se,k,R,L,H,B,j,Q,G,W,q,Se,ee,he,$,X,U,z,J,Y,Z,te,le,ye,be,Ee,Se,ie,oe,O,V;return de(this,function(pe){switch(pe.label){case 0:for(i=e.atom_site._rowCount,a=ve.ofConst("MOL",i,ve.Schema.str),o=ve.ofConst("A",i,ve.Schema.str),s=ve.ofConst(1,i,ve.Schema.int),u=k7e(e),l=u.spacegroup.cell.fromFractional,c=e.atom_site,d=c.fract_x,f=c.fract_y,h=c.fract_z,v=new Float32Array(i),p=new Float32Array(i),m=new Float32Array(i),g=_(),Se=0;Se<i;++Se)_.set(g,d.value(Se),f.value(Se),h.value(Se)),_.transformMat4(g,g,l),v[Se]=g[0],p[Se]=g[1],m[Se]=g[2];if(y=e.atom_site,b=y.type_symbol,S=y.label,b.isDefined){for(D=new Array(i),w=new Int8Array(i),Se=0;Se<i;++Se)A=b.value(Se),M=A.length,A[M-1]==="+"?(D[Se]=A.substring(0,M-2),w[Se]=parseInt(A[M-2])):A[M-2]==="+"?(D[Se]=A.substring(0,M-2),w[Se]=parseInt(A[M-1])):A[M-1]==="-"?(D[Se]=A.substring(0,M-2),w[Se]=-parseInt(A[M-2])):A[M-2]==="-"?(D[Se]=A.substring(0,M-2),w[Se]=-parseInt(A[M-1])):(D[Se]=A,w[Se]=0);x=ve.ofStringArray(D),C=ve.ofIntArray(w)}else{for(D=new Array(i),Se=0;Se<i;++Se)D[Se]=U3(S.value(Se));x=ve.ofStringArray(D),C=ve.Undefined(i,ve.Schema.int)}return k=Xr.ofPartialColumns(Wa.atom_site,{auth_asym_id:o,auth_atom_id:S,auth_comp_id:a,auth_seq_id:s,Cartn_x:ve.ofFloatArray(v),Cartn_y:ve.ofFloatArray(p),Cartn_z:ve.ofFloatArray(m),id:ve.range(0,i-1),label_asym_id:o,label_atom_id:S,label_comp_id:a,label_seq_id:s,label_entity_id:ve.ofConst("1",i,ve.Schema.str),occupancy:e.atom_site.occupancy.isDefined?e.atom_site.occupancy:ve.ofConst(1,i,ve.Schema.float),type_symbol:x,pdbx_formal_charge:C,pdbx_PDB_model_num:ve.ofConst(1,i,ve.Schema.int),B_iso_or_equiv:e.atom_site.U_iso_or_equiv},i),R=e.chemical.name_common.value(0)||e.chemical.name_systematic.value(0)||e.chemical_formula.sum.value(0),L=new dh,L.setNames([["MOL",R||"Unknown Entity"]]),L.getEntityId("MOL",0,"A"),H=new ch(s,e.atom_site.type_symbol),H.setNames([["MOL",R||"Unknown Molecule"]]),H.add("MOL",0),B=vv({entity:L.getEntityTable(),chem_comp:H.getChemCompTable(),atom_site:k}),[4,rd(B,t,r)];case 1:if(j=pe.sent(),j.frameCount>0&&(Q=j.representative,si.Provider.set(Q,u),G=e.geom_bond._rowCount,G>0)){for(W={},q=e.atom_site.label,Se=0,ee=q.rowCount;Se<ee;++Se)W[q.value(Se)]=Se;for(he=(n=t.data.frame.categories.ccdc_geom_bond_type)===null||n===void 0?void 0:n.getField(""),$=[],X=[],U=[],z=[],J=[],Y=new Set,Z=0,te=e.geom_bond,le=te.atom_site_label_1,ye=te.atom_site_label_2,be=te.valence,Ee=te.distance,Se=0;Se<G;++Se)ie=W[le.value(Se)],oe=W[ye.value(Se)],O=ie<oe?Rf(ie,oe):Rf(oe,ie),!Y.has(O)&&(Y.add(O),$[Z]=ie,X[Z]=oe,z[Z]=Ee.value(Se)||-1,he?(V=he.str(Se),V==="D"?(U[Z]=2,J[Z]=1):V==="A"?(U[Z]=1,J[Z]=17):(U[Z]=1,J[Z]=1)):(J[Z]=1,U[Z]=be.isDefined?be.value(Se):1),Z+=1);fa.Provider.set(Q,fa.fromData({pairs:{indexA:ve.ofIntArray($),indexB:ve.ofIntArray(X),order:ve.ofIntArray(U),distance:ve.ofFloatArray(z),flag:ve.ofIntArray(J)},count:i}))}return[2,j]}})})}function L7e(e){if(rb.is(e.sourceData)){var t=e.sourceData.data.db,r=t.atom_site,n=t.atom_site_aniso,i=Xr.ofPartialColumns(wl.Schema,{U:n.U,U_esd:n.U_su},n._rowCount),a=wl.getElementToAnsiotropFromLabel(r.label,n.label);return{data:i,elementToAnsiotrop:a}}}function N7e(e){return rb.is(e.sourceData)?e.sourceData.data.db.atom_site_aniso.U.isDefined:!1}wl.Provider.formatRegistry.add("cifCore",L7e,N7e);var rb;(function(e){function t(n){return(n==null?void 0:n.kind)==="cifCore"}e.is=t;function r(n,i){i||(i=Fc.schema.cifCore(n));var a=i.database_code.depnum_ccdc_archive.value(0)||i.database_code.depnum_ccdc_fiz.value(0)||i.database_code.ICSD.value(0)||i.database_code.MDF.value(0)||i.database_code.NBS.value(0)||i.database_code.CSD.value(0)||i.database_code.COD.value(0)||i._name;return{kind:"cifCore",name:a,data:{db:i,frame:n}}}e.fromFrame=r})(rb||(rb={}));function F7e(e){var t=rb.fromFrame(e);return We.create("Parse CIF Core",function(r){return O7e(t.data.db,t,r)})}function B7e(e,t){return ce(this,void 0,void 0,function(){var r,n,i,a,o,s,u,l,c;return de(this,function(d){switch(d.label){case 0:return r=e.atoms,n=ve.ofConst("MOL",e.atoms.count,ve.Schema.str),i=ve.ofConst("A",e.atoms.count,ve.Schema.str),a=ve.ofArray({array:ve.mapToArray(r.number,function(f){return f4e(f)}),schema:ve.Schema.Aliased(ve.Schema.str)}),o=ve.ofConst(1,r.count,ve.Schema.int),s=Xr.ofPartialColumns(Wa.atom_site,{auth_asym_id:i,auth_atom_id:a,auth_comp_id:n,auth_seq_id:o,Cartn_x:ve.asArrayColumn(r.x,Float32Array),Cartn_y:ve.asArrayColumn(r.y,Float32Array),Cartn_z:ve.asArrayColumn(r.z,Float32Array),id:ve.range(0,r.count-1),label_asym_id:i,label_atom_id:a,label_comp_id:n,label_seq_id:o,label_entity_id:ve.ofConst("1",r.count,ve.Schema.str),occupancy:ve.ofConst(1,r.count,ve.Schema.float),type_symbol:a,pdbx_PDB_model_num:ve.ofConst(1,r.count,ve.Schema.int)},r.count),u=new dh,u.setNames([["MOL","Unknown Entity"]]),u.getEntityId("MOL",0,"A"),l=new ch(o,a),l.setNames([["MOL","Unknown Molecule"]]),l.add("MOL",0),c=vv({entity:u.getEntityTable(),chem_comp:l.getChemCompTable(),atom_site:s}),[4,rd(c,x5.create(e),t)];case 1:return[2,d.sent()]}})})}var x5;(function(e){function t(n){return(n==null?void 0:n.kind)==="cube"}e.is=t;function r(n){return{kind:"cube",name:n.header.comment1,data:n}}e.create=r})(x5||(x5={}));function U7e(e){return We.create("Parse Cube",function(t){return B7e(e,t)})}var RO=It.skipWhitespace,bZ=It.eatValue,Ju=It.markLine,el=It.getTokenString,xZ=It.readLine;function j7e(){return{mol_name:"",num_atoms:0,num_bonds:0,num_subst:0,num_feat:0,num_sets:0,mol_type:"",charge_type:"",status_bits:"",mol_comment:""}}function z7e(e,t){return{tokenizer:e,molecule:j7e(),runtimeCtx:t}}var V7e=/\s+/g;function H7e(e){for(var t=e.tokenizer,r=e.molecule;el(t)!=="@<TRIPOS>MOLECULE"&&t.position<t.data.length;)Ju(t);Ju(t),r.mol_name=el(t),Ju(t);var n=el(t).trim().split(V7e);r.num_atoms=parseInt(n[0]),r.num_bonds=parseInt(n[1]),r.num_subst=parseInt(n[2]),r.num_feat=parseInt(n[3]),r.num_sets=parseInt(n[4]),Ju(t);var i=el(t);if(!i.startsWith("@<TRIPOS>")){r.mol_type=i,Ju(t);var a=el(t);if(!a.startsWith("@<TRIPOS>")){r.charge_type=a,Ju(t);var o=el(t);if(!o.startsWith("@<TRIPOS>")){r.status_bits=o,Ju(t);var s=el(t);s.startsWith("@<TRIPOS>")||(r.mol_comment=s)}}}}function G7e(e){return ce(this,void 0,void 0,function(){var t,r,n,i,a,o,s,u,l,c,d,f,h,v,p,m,g,y,b,S,x,C,w;return de(this,function(A){switch(A.label){case 0:for(t=e.tokenizer,r=e.molecule;el(t)!=="@<TRIPOS>ATOM"&&t.position<t.data.length;)Ju(t);return n=t.position,i=t.lineNumber,a=xZ(t),o=a.trim().split(/\s+/g),s=o.length,u=ht.create(t.data,r.num_atoms*2),l=ht.create(t.data,r.num_atoms*2),c=ht.create(t.data,r.num_atoms*2),d=ht.create(t.data,r.num_atoms*2),f=ht.create(t.data,r.num_atoms*2),h=ht.create(t.data,r.num_atoms*2),v=ht.create(t.data,r.num_atoms*2),p=ht.create(t.data,r.num_atoms*2),m=ht.create(t.data,r.num_atoms*2),g=ht.create(t.data,r.num_atoms*2),y=ve.Undefined(r.num_atoms,ve.Schema.float),b=ve.Undefined(r.num_atoms,ve.Schema.int),S=ve.Undefined(r.num_atoms,ve.Schema.str),t.position=n,t.lineNumber=i,x=t.length,C=0,[4,Oc(e.runtimeCtx,1e5,void 0,function(M){for(var D=Math.min(r.num_atoms-C,M),k=0;k<D;k++)for(var R=0;R<s;R++)switch(RO(t),t.tokenStart=t.position,bZ(t),R){case 0:ht.addUnchecked(u,t.tokenStart,t.tokenEnd);break;case 1:ht.addUnchecked(l,t.tokenStart,t.tokenEnd);break;case 2:ht.addUnchecked(c,t.tokenStart,t.tokenEnd);break;case 3:ht.addUnchecked(d,t.tokenStart,t.tokenEnd);break;case 4:ht.addUnchecked(f,t.tokenStart,t.tokenEnd);break;case 5:ht.addUnchecked(h,t.tokenStart,t.tokenEnd);break;case 6:ht.addUnchecked(v,t.tokenStart,t.tokenEnd);break;case 7:ht.addUnchecked(p,t.tokenStart,t.tokenEnd);break;case 8:ht.addUnchecked(m,t.tokenStart,t.tokenEnd);break;case 9:ht.addUnchecked(g,t.tokenStart,t.tokenEnd);break}return C+=D,D},function(M){return M.update({message:"Parsing...",current:t.position,max:x})})];case 1:return A.sent(),w={count:r.num_atoms,atom_id:qr(u)(ve.Schema.int),atom_name:qr(l)(ve.Schema.str),x:qr(c)(ve.Schema.float),y:qr(d)(ve.Schema.float),z:qr(f)(ve.Schema.float),atom_type:s>5?qr(h)(ve.Schema.str):S,subst_id:s>6?qr(v)(ve.Schema.int):b,subst_name:s>7?qr(p)(ve.Schema.str):S,charge:s>8?qr(m)(ve.Schema.float):y,status_bit:s>9?qr(g)(ve.Schema.str):S},[2,w]}})})}function q7e(e){return ce(this,void 0,void 0,function(){var t,r,n,i,a,o,s,u,l,c,d,f,h,v,p;return de(this,function(m){switch(m.label){case 0:for(t=e.tokenizer,r=e.molecule;el(t)!=="@<TRIPOS>BOND"&&t.position<t.data.length;)Ju(t);return n=t.position,i=t.lineNumber,a=xZ(t),o=a.trim().split(/\s+/g),s=o.length,u=ht.create(t.data,r.num_bonds*2),l=ht.create(t.data,r.num_bonds*2),c=ht.create(t.data,r.num_bonds*2),d=ht.create(t.data,r.num_bonds*2),f=ht.create(t.data,r.num_bonds*2),t.position=n,t.lineNumber=i,h=t.length,v=0,[4,Oc(e.runtimeCtx,1e5,void 0,function(g){for(var y=Math.min(r.num_bonds-v,g),b=0;b<y;b++)for(var S=0;S<s;S++)switch(RO(t),t.tokenStart=t.position,bZ(t),S){case 0:ht.addUnchecked(u,t.tokenStart,t.tokenEnd);break;case 1:ht.addUnchecked(l,t.tokenStart,t.tokenEnd);break;case 2:ht.addUnchecked(c,t.tokenStart,t.tokenEnd);break;case 3:ht.addUnchecked(d,t.tokenStart,t.tokenEnd);break;default:ht.addUnchecked(f,t.tokenStart,t.tokenEnd);break}return v+=y,y},function(g){return g.update({message:"Parsing...",current:t.position,max:h})})];case 1:return m.sent(),p={count:r.num_bonds,bond_id:qr(u)(ve.Schema.int),origin_atom_id:qr(l)(ve.Schema.int),target_atom_id:qr(c)(ve.Schema.int),bond_type:qr(d)(ve.Schema.str),status_bits:s>4?qr(f)(ve.Schema.str):ve.Undefined(r.num_bonds,ve.Schema.str)},[2,p]}})})}function W7e(e,t,r){return ce(this,void 0,void 0,function(){var n,i,a,o,s,u;return de(this,function(l){switch(l.label){case 0:n=It(t),e.update({message:"Parsing...",current:0,max:t.length}),i=[],l.label=1;case 1:return n.position<t.length?(a=z7e(n,e),H7e(a),[4,G7e(a)]):[3,4];case 2:return o=l.sent(),[4,q7e(a)];case 3:for(s=l.sent(),i.push({molecule:a.molecule,atoms:o,bonds:s}),RO(n);el(n)!=="@<TRIPOS>MOLECULE"&&n.position<n.data.length;)Ju(n);return[3,1];case 4:return u={name:r,structures:i},[2,wn.success(u)]}})})}function $7e(e,t){var r=this;return We.create("Parse MOL2",function(n){return ce(r,void 0,void 0,function(){return de(this,function(i){switch(i.label){case 0:return[4,W7e(n,e,t)];case 1:return[2,i.sent()]}})})})}function X7e(e,t){return ce(this,void 0,void 0,function(){var r,n,i,a,o,s,u,l,c,d,f,h,v,p,m,g,y,b,S,x,C,w,A;return de(this,function(M){switch(M.label){case 0:r=[],n=0,i=e.structures.length,M.label=1;case 1:if(!(n<i))return[3,4];for(a=e.structures[n],o=a.atoms,s=a.bonds,u=a.molecule,l=ve.ofConst("A",o.count,ve.Schema.str),c=new Array(o.count),d=0;d<o.count;++d)c[d]=U3(o.atom_name.value(d));for(f=Xr.ofPartialColumns(Wa.atom_site,{auth_asym_id:l,auth_atom_id:ve.asArrayColumn(o.atom_name),auth_comp_id:o.subst_name,auth_seq_id:o.subst_id,Cartn_x:ve.asArrayColumn(o.x,Float32Array),Cartn_y:ve.asArrayColumn(o.y,Float32Array),Cartn_z:ve.asArrayColumn(o.z,Float32Array),id:ve.asArrayColumn(o.atom_id),label_asym_id:l,label_atom_id:ve.asArrayColumn(o.atom_name),label_comp_id:o.subst_name,label_seq_id:o.subst_id,label_entity_id:ve.ofConst("1",o.count,ve.Schema.str),occupancy:ve.ofConst(1,o.count,ve.Schema.float),type_symbol:ve.ofStringArray(c),pdbx_PDB_model_num:ve.ofConst(n,o.count,ve.Schema.int)},o.count),h=new dh,h.setNames([["MOL",u.mol_name||"Unknown Entity"]]),h.getEntityId("MOL",0,"A"),v=new ch(o.subst_id,o.atom_name),p=0,m=o.subst_name.rowCount;p<m;++p)v.add(o.subst_name.value(p),p);return g=vv({entity:h.getEntityTable(),chem_comp:v.getChemCompTable(),atom_site:f}),[4,rd(g,S5.create(e),t)];case 2:y=M.sent(),y.frameCount>0&&(b=ve.ofIntArray(ve.mapToArray(s.origin_atom_id,function(D){return D-1},Int32Array)),S=ve.ofIntArray(ve.mapToArray(s.target_atom_id,function(D){return D-1},Int32Array)),x=ve.ofIntArray(ve.mapToArray(s.bond_type,function(D){switch(D){case"ar":case"am":case"un":return 1;case"du":case"nc":return 0;default:return parseInt(D)}},Int8Array)),C=ve.ofIntArray(ve.mapToArray(s.bond_type,function(D){switch(D){case"ar":return 17;case"du":case"nc":return 0;case"am":case"un":default:return 1}},Int8Array)),w=fa.fromData({pairs:{indexA:b,indexB:S,order:x,flag:C},count:o.count}),A=y.representative,fa.Provider.set(A,w),Tg.Provider.set(A,{data:o.charge,type:u.charge_type}),r.push(A)),M.label=3;case 3:return++n,[3,1];case 4:return[2,new Xp(r)]}})})}var S5;(function(e){function t(n){return(n==null?void 0:n.kind)==="mol2"}e.is=t;function r(n){return{kind:"mol2",name:n.name,data:n}}e.create=r})(S5||(S5={}));function Y7e(e){return We.create("Parse MOL2",function(t){return X7e(e,t)})}var $v=new Uint32Array([0,0,0,0,0,0,0,0,0,8,10,12,16,20,25,32,40,50,64,80,101,128,161,203,256,322,406,512,645,812,1024,1290,1625,2048,2580,3250,4096,5060,6501,8192,10321,13003,16384,20642,26007,32768,41285,52015,65536,82570,104031,131072,165140,208063,262144,330280,416127,524287,660561,832255,1048576,1321122,1664510,2097152,2642245,3329021,4194304,5284491,6658042,8388607,10568983,13316085,16777216]),tT=9,uo;(function(e){function t(c){for(var d=1,f=0;c>=d&&f<32;)f++,d<<=1;return f}e.sizeOfInt=t;var r=new Uint8Array(32);function n(c,d){var f=1,h=0;r[0]=1;for(var v=0;v<c;v++){var p=void 0,m=0;for(p=0;p<f;p++)m+=r[p]*d[v],r[p]=m&255,m>>=8;for(;m!==0;)r[p++]=m&255,m>>=8;f=p}var g=1;for(f--;r[f]>=g;)h++,g*=2;return h+f*8}e.sizeOfInts=n;var i=new ArrayBuffer(8*3);e.buf=new Int32Array(i);var a=new Uint32Array(i);function o(c,d,f){for(var h=f,v=(1<<h)-1,p=a[1],m=a[2],g=e.buf[0],y=0;h>=8;)m=m<<8|c[d+g++],y|=m>>p<<h-8,h-=8;return h>0&&(p<h&&(p+=8,m=m<<8|c[d+g++]),p-=h,y|=m>>p&(1<<h)-1),y&=v,e.buf[0]=g,e.buf[1]=p,e.buf[2]=m,y}e.decodeBits=o;function s(c,d){var f=a[2],h=e.buf[0];return f=f<<8|c[d+h],e.buf[0]=h+1,e.buf[2]=f,f>>a[1]&255}var u=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];function l(c,d,f,h,v){var p=f,m=0;for(u[0]=0,u[1]=0,u[2]=0,u[3]=0;p>8;)u[m++]=s(c,d),p-=8;p>0&&(u[m++]=o(c,d,p));for(var g=2;g>0;g--){for(var y=0,b=h[g],S=m-1;S>=0;S--){y=y<<8|u[S];var x=y/b|0;u[S]=x,y=y-x*b}v[g]=y}v[0]=u[0]|u[1]<<8|u[2]<<16|u[3]<<24}e.decodeInts=l})(uo||(uo={}));function K7e(){throw new Error("(xdrfile error) Undefined error.")}function Q7e(e,t){return ce(this,void 0,void 0,function(){var r,n,i,a,o,s,u,l,c,d,f,h,v,p,m,g,L,L,y,b,S,x,C,w,A,M,D,k,R,L,H,B,j,Q,G;return de(this,function(W){switch(W.label){case 0:r=new DataView(t.buffer,t.byteOffset),n={frames:[],boxes:[],times:[],timeOffset:0,deltaTime:0},i=n.frames,a=n.boxes,o=n.times,s=[0,0,0,0,0,0],u=[0,0,0],l=[0,0,0],c=[0,0,0],d=[.1,.1,.1],f=[.1,.1,.1],h=0,v=uo.buf,W.label=1;case 1:for(p=void 0,m=r.getInt32(h+4),h+=12,o.push(r.getFloat32(h)),h+=4,g=new Float32Array(9),L=0;L<9;++L)g[L]=r.getFloat32(h)*10,h+=4;if(a.push(g),m<=9)for(p={count:m/3,x:new Float32Array(m/3),y:new Float32Array(m/3),z:new Float32Array(m/3)},L=0;L<m/3;++L)p.x[L]=r.getFloat32(h),p.y[L]=r.getFloat32(h),p.z[L]=r.getFloat32(h),h+=4;else{for(v[0]=v[1]=v[2]=0,u[0]=u[1]=u[2]=0,c[0]=c[1]=c[2]=0,l[0]=l[1]=l[2]=0,d[0]=d[1]=d[2]=0,f[0]=f[1]=f[2]=0,p={count:m,x:new Float32Array(m),y:new Float32Array(m),z:new Float32Array(m)},y=0,b=r.getInt32(h),h+=4,S=r.getFloat32(h),h+=4,s[0]=r.getInt32(h),s[1]=r.getInt32(h+4),s[2]=r.getInt32(h+8),s[3]=r.getInt32(h+12),s[4]=r.getInt32(h+16),s[5]=r.getInt32(h+20),u[0]=s[3]-s[0]+1,u[1]=s[4]-s[1]+1,u[2]=s[5]-s[2]+1,h+=24,x=void 0,(u[0]|u[1]|u[2])>16777215?(l[0]=uo.sizeOfInt(u[0]),l[1]=uo.sizeOfInt(u[1]),l[2]=uo.sizeOfInt(u[2]),x=0):x=uo.sizeOfInts(3,u),C=r.getInt32(h),h+=4,w=C-1,w=tT>w?tT:w,A=$v[w]/2|0,M=$v[C]/2|0,c[0]=c[1]=c[2]=$v[C],D=Math.ceil(r.getInt32(h)/4)*4,h+=4,k=1/S,R=0,L=0,d[0]=d[1]=d[2]=0;L<b;){if(x===0?(d[0]=uo.decodeBits(t,h,l[0]),d[1]=uo.decodeBits(t,h,l[1]),d[2]=uo.decodeBits(t,h,l[2])):uo.decodeInts(t,h,x,u,d),L++,d[0]+=s[0],d[1]+=s[1],d[2]+=s[2],f[0]=d[0],f[1]=d[1],f[2]=d[2],H=uo.decodeBits(t,h,1),B=0,H===1&&(R=uo.decodeBits(t,h,5),B=R%3,R-=B,B--),R>0)for(d[0]=d[1]=d[2]=0,j=0;j<R;j+=3)uo.decodeInts(t,h,C,c,d),L++,d[0]+=f[0]-M,d[1]+=f[1]-M,d[2]+=f[2]-M,j===0?(Q=d[0],d[0]=f[0],f[0]=Q,Q=d[1],d[1]=f[1],f[1]=Q,Q=d[2],d[2]=f[2],f[2]=Q,p.x[y]=f[0]*k,p.y[y]=f[1]*k,p.z[y]=f[2]*k,y++):(f[0]=d[0],f[1]=d[1],f[2]=d[2]),p.x[y]=d[0]*k,p.y[y]=d[1]*k,p.z[y]=d[2]*k,y++;else p.x[y]=d[0]*k,p.y[y]=d[1]*k,p.z[y]=d[2]*k,y++;C+=B,B<0?(M=A,C>tT?A=$v[C-1]/2|0:A=0):B>0&&(A=M,M=$v[C]/2|0),c[0]=c[1]=c[2]=$v[C],(c[0]===0||c[1]===0||c[2]===0)&&K7e()}h+=D}for(G=0;G<m;G++)p.x[G]*=10,p.y[G]*=10,p.z[G]*=10;return i.push(p),e.shouldUpdate?[4,e.update({current:h,max:t.length})]:[3,3];case 2:W.sent(),W.label=3;case 3:return h>=t.length?[3,4]:[3,1];case 4:return o.length>=1&&(n.timeOffset=o[0]),o.length>=2&&(n.deltaTime=o[1]-o[0]),[2,n]}})})}function Z7e(e){var t=this;return We.create("Parse XTC",function(r){return ce(t,void 0,void 0,function(){var n,i;return de(this,function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),r.update({canAbort:!0,message:"Parsing trajectory..."}),[4,Q7e(r,e)];case 1:return n=a.sent(),[2,wn.success(n)];case 2:return i=a.sent(),[2,wn.error(""+i)];case 3:return[2]}})})})}function J7e(e){var t=this;return We.create("Parse XTC",function(r){return ce(t,void 0,void 0,function(){var n,i,a,o,s,u,l,c,d;return de(this,function(f){switch(f.label){case 0:return[4,r.update("Converting to coordinates")];case 1:for(f.sent(),n=rf(e.deltaTime,"step"),i=rf(e.timeOffset,n.unit),a=[],o=0,s=e.frames.length;o<s;++o)u=e.boxes[o],l=_.fromArray(_(),u,0),c=_.fromArray(_(),u,3),d=_.fromArray(_(),u,6),a.push({elementCount:e.frames[o].count,cell:_p.fromBasis(l,c,d),x:e.frames[o].x,y:e.frames[o].y,z:e.frames[o].z,xyzOrdering:{isIdentity:!0},time:rf(i.value+n.value*o,n.unit)});return[2,q1.create(a,n,i)]}})})})}function e9e(e){var t=e.position>=e.data.length-1?0:+It.readLine(e);isNaN(t)&&(t=0);for(var r=It.readLine(e),n=new Float64Array(t),i=new Float64Array(t),a=new Float64Array(t),o=new Array(t),s=0;s<t;++s){var u=It.readLineTrim(e),l=u.split(/\s+/g);o[s]=l[0],n[s]=+l[1],i[s]=+l[2],a[s]=+l[3]}return{count:t,comment:r,x:ve.ofFloatArray(n),y:ve.ofFloatArray(i),z:ve.ofFloatArray(a),type_symbol:ve.ofStringArray(o)}}function t9e(e){for(var t=It(e),r=[];;){var n=e9e(t);if(n.count===0)break;r.push(n)}var i={molecules:r};return wn.success(i)}function r9e(e){var t=this;return We.create("Parse Mol",function(){return ce(t,void 0,void 0,function(){return de(this,function(r){return[2,t9e(e)]})})})}function n9e(e,t){for(var r=e.molecules,n=0,i=0,a=r;i<a.length;i++){var o=a[i];n+=o.count}for(var s=new Array(n),u=new Int32Array(n),l=new Float32Array(n),c=new Float32Array(n),d=new Float32Array(n),f=new Int32Array(n),h=0,v=0;v<r.length;v++)for(var o=r[v],p=0;p<o.count;p++)s[h]=o.type_symbol.value(p),l[h]=o.x.value(p),c[h]=o.y.value(p),d[h]=o.z.value(p),u[h]=p,f[h]=v,h++;var m=ve.ofConst("MOL",n,ve.Schema.str),g=ve.ofConst("A",n,ve.Schema.str),y=ve.ofConst(1,n,ve.Schema.int),b=ve.ofStringArray(s),S=Xr.ofPartialColumns(Wa.atom_site,{auth_asym_id:g,auth_atom_id:b,auth_comp_id:m,auth_seq_id:y,Cartn_x:ve.ofFloatArray(l),Cartn_y:ve.ofFloatArray(c),Cartn_z:ve.ofFloatArray(d),id:ve.ofIntArray(u),label_asym_id:g,label_atom_id:b,label_comp_id:m,label_seq_id:y,label_entity_id:ve.ofConst("1",n,ve.Schema.str),occupancy:ve.ofConst(1,n,ve.Schema.float),type_symbol:b,pdbx_PDB_model_num:ve.ofIntArray(f)},n),x=new dh;x.setNames([["MOL","Unknown Entity"]]),x.getEntityId("MOL",0,"A");var C=new ch(y,b);C.setNames([["MOL","Unknown Molecule"]]),C.add("MOL",0);var w=vv({entity:x.getEntityTable(),chem_comp:C.getChemCompTable(),atom_site:S});return rd(w,C5.create(e),t)}var C5;(function(e){function t(n){return(n==null?void 0:n.kind)==="xyz"}e.is=t;function r(n){return{kind:"xyz",name:"xyz",data:n}}e.create=r})(C5||(C5={}));function i9e(e){return We.create("Parse XYZ",function(t){return n9e(e,t)})}var _5="$$$$";function a9e(e){for(var t=ht.create(e.data,32),r=ht.create(e.data,32);e.position<e.length;){var n=It.readLine(e);if(n.startsWith(_5))break;if(n&&n.startsWith("> ")){ht.add(t,e.tokenStart+2,e.tokenEnd),It.markLine(e);for(var i=e.tokenStart,a=e.tokenEnd,o=!1;e.position<e.length;){var s=It.readLine(e);if(!s||s.startsWith(_5)||s.startsWith("> ")){ht.add(r,i,a),o=!0;break}a=e.tokenEnd}o||ht.add(r,i,a)}}return{dataHeader:qr(t)(ve.Schema.str),data:qr(r)(ve.Schema.str)}}function o9e(e){var t=It.readLine(e).trim(),r=It.readLine(e).trim(),n=It.readLine(e).trim(),i=It.readLine(e),a=+i.substr(0,3),o=+i.substr(3,3);if(Number.isNaN(a)||Number.isNaN(o)){for(;e.position<e.length;){var s=It.readLine(e);if(s.startsWith(_5))break}return}var u=mZ(e,a),l=gZ(e,o),c=a9e(e);return{molFile:{title:t,program:r,comment:n,atoms:u,bonds:l},dataItems:c}}function s9e(e){for(var t=It(e),r=[];t.position<t.length;){var n=o9e(t);n&&r.push(n)}return wn.success({compounds:r})}function u9e(e){var t=this;return We.create("Parse Sdf",function(){return ce(t,void 0,void 0,function(){return de(this,function(r){return[2,s9e(e)]})})})}var w5;(function(e){function t(n){return(n==null?void 0:n.kind)==="sdf"}e.is=t;function r(n){return{kind:"sdf",name:n.molFile.title,data:n}}e.create=r})(w5||(w5={}));function l9e(e){return We.create("Parse SDF",function(t){return yZ(e.molFile,w5.create(e),t)})}var c9e=kt.BuiltIn({name:"coordinates-from-dcd",display:{name:"Parse DCD",description:"Parse DCD binary data."},from:[ge.Data.Binary],to:ge.Molecule.Coordinates})({apply:function(e){var t=this,r=e.a;return We.create("Parse DCD",function(n){return ce(t,void 0,void 0,function(){var i,a;return de(this,function(o){switch(o.label){case 0:return[4,PLe(r.data).runInContext(n)];case 1:if(i=o.sent(),i.isError)throw new Error(i.message);return[4,j8e(i.result).runInContext(n)];case 2:return a=o.sent(),[2,new ge.Molecule.Coordinates(a,{label:r.label,description:"Coordinates"})]}})})})}}),d9e=kt.BuiltIn({name:"coordinates-from-xtc",display:{name:"Parse XTC",description:"Parse XTC binary data."},from:[ge.Data.Binary],to:ge.Molecule.Coordinates})({apply:function(e){var t=this,r=e.a;return We.create("Parse XTC",function(n){return ce(t,void 0,void 0,function(){var i,a;return de(this,function(o){switch(o.label){case 0:return[4,Z7e(r.data).runInContext(n)];case 1:if(i=o.sent(),i.isError)throw new Error(i.message);return[4,J7e(i.result).runInContext(n)];case 2:return a=o.sent(),[2,new ge.Molecule.Coordinates(a,{label:r.label,description:"Coordinates"})]}})})})}}),f9e=kt.BuiltIn({name:"topology-from-psf",display:{name:"PSF Topology",description:"Parse PSF string data."},from:[ge.Format.Psf],to:ge.Molecule.Topology})({apply:function(e){var t=this,r=e.a;return We.create("Create Topology",function(n){return ce(t,void 0,void 0,function(){var i;return de(this,function(a){switch(a.label){case 0:return[4,p7e(r.data).runInContext(n)];case 1:return i=a.sent(),[2,new ge.Molecule.Topology(i,{label:i.label||r.label,description:"Topology"})]}})})})}});function h9e(e,t,r){return ce(this,void 0,void 0,function(){var n,i;return de(this,function(a){switch(a.label){case 0:return t.type!==ge.Molecule.Topology.type?[3,2]:(n=t.data,[4,Wt.trajectoryFromTopologyAndCoordinates(n,r).runInContext(e)]);case 1:return[2,a.sent()];case 2:if(t.type===ge.Molecule.Model.type)return i=t.data,[2,Wt.trajectoryFromModelAndCoordinates(i,r)];a.label=3;case 3:throw new Error("no model/topology found")}})})}var SZ=kt.BuiltIn({name:"trajectory-from-model-and-coordinates",display:{name:"Trajectory from Topology & Coordinates",description:"Create a trajectory from existing model/topology and coordinates."},from:ge.Root,to:ge.Molecule.Trajectory,params:{modelRef:I.Text("",{isHidden:!0}),coordinatesRef:I.Text("",{isHidden:!0})}})({apply:function(e){var t=this,r=e.params,n=e.dependencies;return We.create("Create trajectory from model/topology and coordinates",function(i){return ce(t,void 0,void 0,function(){var a,o,s;return de(this,function(u){switch(u.label){case 0:return a=n[r.coordinatesRef].data,[4,h9e(i,n[r.modelRef],a)];case 1:return o=u.sent(),s={label:"Trajectory",description:o.frameCount+" model"+(o.frameCount===1?"":"s")},[2,new ge.Molecule.Trajectory(o,s)]}})})})}}),p9e=kt.BuiltIn({name:"trajectory-from-blob",display:{name:"Parse Blob",description:"Parse format blob into a single trajectory."},from:ge.Format.Blob,to:ge.Molecule.Trajectory})({apply:function(e){var t=this,r=e.a;return We.create("Parse Format Blob",function(n){return ce(t,void 0,void 0,function(){var i,a,o,s,u,l,d,c,d,f;return de(this,function(h){switch(h.label){case 0:i=[],a=0,o=r.data,h.label=1;case 1:return a<o.length?(s=o[a],s.kind!=="cif"?[3,6]:(u=s.data.blocks[0],[4,XK(u).runInContext(n)])):[3,7];case 2:if(l=h.sent(),l.frameCount===0)throw new Error("No models found.");d=0,h.label=3;case 3:return d<l.frameCount?[4,We.resolveInContext(l.getFrameAtIndex(d),n)]:[3,6];case 4:c=h.sent(),i.push(c),h.label=5;case 5:return d++,[3,3];case 6:return a++,[3,1];case 7:for(d=0;d<i.length;d++)Wt.TrajectoryInfo.set(i[d],{index:d,size:i.length});return f={label:"Trajectory",description:i.length+" model"+(i.length===1?"":"s")},[2,new ge.Molecule.Trajectory(new Xp(i),f)]}})})})}});function pd(e){var t=e.representative;return{label:""+t.entry,description:e.frameCount+" model"+(e.frameCount===1?"":"s")}}var v9e=kt.BuiltIn({name:"trajectory-from-mmcif",display:{name:"Trajectory from mmCIF",description:"Identify and create all separate models in the specified CIF data block"},from:ge.Format.Cif,to:ge.Molecule.Trajectory,params:function(e){if(!e)return{blockHeader:I.Optional(I.Text(void 0,{description:"Header of the block to parse. If none is specifed, the 1st data block in the file is used."}))};var t=e.data.blocks;return{blockHeader:I.Optional(I.Select(t[0]&&t[0].header,t.map(function(r){return[r.header,r.header]}),{description:"Header of the block to parse"}))}}})({isApplicable:function(e){return e.data.blocks.length>0},apply:function(e){var t=this,r=e.a,n=e.params;return We.create("Parse mmCIF",function(i){return ce(t,void 0,void 0,function(){var a,o,s,u;return de(this,function(l){switch(l.label){case 0:if(a=n.blockHeader||r.data.blocks[0].header,o=r.data.blocks.find(function(c){return c.header===a}),!o)throw new Error("Data block '"+[a]+"' not found.");return[4,XK(o).runInContext(i)];case 1:if(s=l.sent(),s.frameCount===0)throw new Error("No models found.");return u=pd(s),[2,new ge.Molecule.Trajectory(s,u)]}})})})}}),m9e=kt.BuiltIn({name:"trajectory-from-pdb",display:{name:"Parse PDB",description:"Parse PDB string and create trajectory."},from:[ge.Data.String],to:ge.Molecule.Trajectory,params:{isPdbqt:I.Boolean(!1)}})({apply:function(e){var t=this,r=e.a,n=e.params;return We.create("Parse PDB",function(i){return ce(t,void 0,void 0,function(){var a,o,s;return de(this,function(u){switch(u.label){case 0:return[4,BLe(r.data,r.label,n.isPdbqt).runInContext(i)];case 1:if(a=u.sent(),a.isError)throw new Error(a.message);return[4,f7e(a.result).runInContext(i)];case 2:return o=u.sent(),s=pd(o),[2,new ge.Molecule.Trajectory(o,s)]}})})})}}),g9e=kt.BuiltIn({name:"trajectory-from-gro",display:{name:"Parse GRO",description:"Parse GRO string and create trajectory."},from:[ge.Data.String],to:ge.Molecule.Trajectory})({apply:function(e){var t=this,r=e.a;return We.create("Parse GRO",function(n){return ce(t,void 0,void 0,function(){var i,a,o;return de(this,function(s){switch(s.label){case 0:return[4,FLe(r.data).runInContext(n)];case 1:if(i=s.sent(),i.isError)throw new Error(i.message);return[4,X8e(i.result).runInContext(n)];case 2:return a=s.sent(),o=pd(a),[2,new ge.Molecule.Trajectory(a,o)]}})})})}}),y9e=kt.BuiltIn({name:"trajectory-from-xyz",display:{name:"Parse XYZ",description:"Parse XYZ string and create trajectory."},from:[ge.Data.String],to:ge.Molecule.Trajectory})({apply:function(e){var t=this,r=e.a;return We.create("Parse XYZ",function(n){return ce(t,void 0,void 0,function(){var i,a,o;return de(this,function(s){switch(s.label){case 0:return[4,r9e(r.data).runInContext(n)];case 1:if(i=s.sent(),i.isError)throw new Error(i.message);return[4,i9e(i.result).runInContext(n)];case 2:return a=s.sent(),o=pd(a),[2,new ge.Molecule.Trajectory(a,o)]}})})})}}),b9e=kt.BuiltIn({name:"trajectory-from-mol",display:{name:"Parse MOL",description:"Parse MOL string and create trajectory."},from:[ge.Data.String],to:ge.Molecule.Trajectory})({apply:function(e){var t=this,r=e.a;return We.create("Parse MOL",function(n){return ce(t,void 0,void 0,function(){var i,a,o;return de(this,function(s){switch(s.label){case 0:return[4,M7e(r.data).runInContext(n)];case 1:if(i=s.sent(),i.isError)throw new Error(i.message);return[4,D7e(i.result).runInContext(n)];case 2:return a=s.sent(),o=pd(a),[2,new ge.Molecule.Trajectory(a,o)]}})})})}}),x9e=kt.BuiltIn({name:"trajectory-from-sdf",display:{name:"Parse SDF",description:"Parse SDF string and create trajectory."},from:[ge.Data.String],to:ge.Molecule.Trajectory})({apply:function(e){var t=this,r=e.a;return We.create("Parse SDF",function(n){return ce(t,void 0,void 0,function(){var i,a,o,s,u,l,c,d,f,h,v;return de(this,function(p){switch(p.label){case 0:return[4,u9e(r.data).runInContext(n)];case 1:if(i=p.sent(),i.isError)throw new Error(i.message);a=[],o=0,s=i.result.compounds,p.label=2;case 2:return o<s.length?(u=s[o],[4,l9e(u).runInContext(n)]):[3,8];case 3:l=p.sent(),c=0,p.label=4;case 4:return c<l.frameCount?(f=(d=a).push,[4,We.resolveInContext(l.getFrameAtIndex(c),n)]):[3,7];case 5:f.apply(d,[p.sent()]),p.label=6;case 6:return c++,[3,4];case 7:return o++,[3,2];case 8:return h=new Xp(a),v=pd(h),[2,new ge.Molecule.Trajectory(h,v)]}})})})}}),S9e=kt.BuiltIn({name:"trajectory-from-mol2",display:{name:"Parse MOL2",description:"Parse MOL2 string and create trajectory."},from:[ge.Data.String],to:ge.Molecule.Trajectory})({apply:function(e){var t=this,r=e.a;return We.create("Parse MOL2",function(n){return ce(t,void 0,void 0,function(){var i,a,o;return de(this,function(s){switch(s.label){case 0:return[4,$7e(r.data,r.label).runInContext(n)];case 1:if(i=s.sent(),i.isError)throw new Error(i.message);return[4,Y7e(i.result).runInContext(n)];case 2:return a=s.sent(),o=pd(a),[2,new ge.Molecule.Trajectory(a,o)]}})})})}}),C9e=kt.BuiltIn({name:"trajectory-from-cube",display:{name:"Parse Cube",description:"Parse Cube file to create a trajectory."},from:ge.Format.Cube,to:ge.Molecule.Trajectory})({apply:function(e){var t=this,r=e.a;return We.create("Parse MOL",function(n){return ce(t,void 0,void 0,function(){var i,a;return de(this,function(o){switch(o.label){case 0:return[4,U7e(r.data).runInContext(n)];case 1:return i=o.sent(),a=pd(i),[2,new ge.Molecule.Trajectory(i,a)]}})})})}}),_9e=kt.BuiltIn({name:"trajectory-from-cif-core",display:{name:"Parse CIF Core",description:"Identify and create all separate models in the specified CIF data block"},from:ge.Format.Cif,to:ge.Molecule.Trajectory,params:function(e){if(!e)return{blockHeader:I.Optional(I.Text(void 0,{description:"Header of the block to parse. If none is specifed, the 1st data block in the file is used."}))};var t=e.data.blocks;return{blockHeader:I.Optional(I.Select(t[0]&&t[0].header,t.map(function(r){return[r.header,r.header]}),{description:"Header of the block to parse"}))}}})({apply:function(e){var t=this,r=e.a,n=e.params;return We.create("Parse CIF Core",function(i){return ce(t,void 0,void 0,function(){var a,o,s,u;return de(this,function(l){switch(l.label){case 0:if(a=n.blockHeader||r.data.blocks[0].header,o=r.data.blocks.find(function(c){return c.header===a}),!o)throw new Error("Data block '"+[a]+"' not found.");return[4,F7e(o).runInContext(i)];case 1:if(s=l.sent(),s.frameCount===0)throw new Error("No models found.");return u=pd(s),[2,new ge.Molecule.Trajectory(s,u)]}})})})}}),w9e=function(e){return e+1},E9e=function(e){return e-1},A9e=kt.BuiltIn({name:"model-from-trajectory",display:{name:"Molecular Model",description:"Create a molecular model from specified index in a trajectory."},from:ge.Molecule.Trajectory,to:ge.Molecule.Model,params:function(e){return e?{modelIndex:I.Converted(w9e,E9e,I.Numeric(1,{min:1,max:e.data.frameCount,step:1},{description:"Model Index",immediateUpdate:!0}))}:{modelIndex:I.Numeric(0,{},{description:"Zero-based index of the model",immediateUpdate:!0})}}})({isApplicable:function(e){return e.data.frameCount>0},apply:function(e){var t=this,r=e.a,n=e.params;return We.create("Model from Trajectory",function(i){return ce(t,void 0,void 0,function(){var a,o,s,u;return de(this,function(l){switch(l.label){case 0:return a=n.modelIndex%r.data.frameCount,a<0&&(a+=r.data.frameCount),[4,We.resolveInContext(r.data.getFrameAtIndex(a),i)];case 1:return o=l.sent(),s="Model "+(a+1),u=r.data.frameCount===1?void 0:"of "+r.data.frameCount,[2,new ge.Molecule.Model(o,{label:s,description:u})]}})})})},interpolate:function(e,t,r){var n=r>=1?t.modelIndex:e.modelIndex+Math.floor((t.modelIndex-e.modelIndex+1)*r);return{modelIndex:n}},dispose:function(e){var t=e.b;t==null||t.data.customProperties.dispose()}}),P9e=kt.BuiltIn({name:"structure-from-trajectory",display:{name:"Structure from Trajectory",description:"Create a molecular structure from a trajectory."},from:ge.Molecule.Trajectory,to:ge.Molecule.Structure})({apply:function(e){var t=this,r=e.a;return We.create("Build Structure",function(n){return ce(t,void 0,void 0,function(){var i,a;return de(this,function(o){switch(o.label){case 0:return[4,$e.ofTrajectory(r.data,n)];case 1:return i=o.sent(),a={label:"Ensemble",description:$e.elementDescription(i)},[2,new ge.Molecule.Structure(i,a)]}})})})},dispose:function(e){var t=e.b;t==null||t.data.customPropertyDescriptors.dispose()}}),T9e=kt.BuiltIn({name:"structure-from-model",display:{name:"Structure",description:"Create a molecular structure (model, assembly, or symmetry) from the specified model."},from:ge.Molecule.Model,to:ge.Molecule.Structure,params:function(e){return wp.getParams(e&&e.data)}})({canAutoUpdate:function(e){var t=e.oldParams,r=e.newParams;return wp.canAutoUpdate(t.type,r.type)},apply:function(e,t){var r=this,n=e.a,i=e.params;return We.create("Build Structure",function(a){return ce(r,void 0,void 0,function(){return de(this,function(o){return[2,wp.create(t,a,n.data,i&&i.type)]})})})},update:function(e){var t=e.a,r=e.b,n=e.oldParams,i=e.newParams;return Mc(n,i)?r.data.model===t.data?ft.UpdateResult.Unchanged:Wt.areHierarchiesEqual(t.data,r.data.model)?(r.data=r.data.remapModel(t.data),ft.UpdateResult.Updated):ft.UpdateResult.Recreate:ft.UpdateResult.Recreate},dispose:function(e){var t=e.b;t==null||t.data.customPropertyDescriptors.dispose()}}),FU=_(),BU=ue(),UU=ue(),I9e=kt.BuiltIn({name:"transform-structure-conformation",display:{name:"Transform Conformation"},isDecorator:!0,from:ge.Molecule.Structure,to:ge.Molecule.Structure,params:{transform:I.MappedStatic("components",{components:I.Group({axis:I.Vec3(_.create(1,0,0)),angle:I.Numeric(0,{min:-180,max:180,step:.1}),translation:I.Vec3(_.create(0,0,0))},{isFlat:!0}),matrix:I.Group({data:I.Mat4(ue.identity()),transpose:I.Boolean(!1)},{isFlat:!0})},{label:"Kind"})}})({canAutoUpdate:function(e){var t=e.newParams;return t.transform.name!=="matrix"},apply:function(e){var t=e.a,r=e.params,n=ue();if(r.transform.name==="components"){var i=r.transform.params,a=i.axis,o=i.angle,s=i.translation,u=t.data.boundary.sphere.center;ue.fromTranslation(BU,_.negate(FU,u)),ue.fromTranslation(UU,_.add(FU,u,s));var l=ue.fromRotation(ue(),Math.PI/180*o,_.normalize(_(),a));ue.mul3(n,UU,l,BU)}else r.transform.name==="matrix"&&(ue.copy(n,r.transform.params.data),r.transform.params.transpose&&ue.transpose(n,n));var c=$e.transform(t.data,n);return new ge.Molecule.Structure(c,{label:t.label,description:t.description+" [Transformed]"})},dispose:function(e){var t=e.b;t==null||t.data.customPropertyDescriptors.dispose()}}),M9e=kt.BuiltIn({name:"structure-selection-from-expression",display:{name:"Selection",description:"Create a molecular structure from the specified expression."},from:ge.Molecule.Structure,to:ge.Molecule.Structure,params:function(){return{expression:I.Value(se.struct.generator.all,{isHidden:!0}),label:I.Optional(I.Text("",{isHidden:!0}))}}})({apply:function(e){var t=e.a,r=e.params,n=e.cache,i=Ta.createAndRun(t.data,r.expression),a=i.selection,o=i.entry;if(n.entry=o,mt.isEmpty(a))return In.Null;var s=mt.unionStructure(a),u={label:""+(r.label||"Selection"),description:$e.elementDescription(s)};return new ge.Molecule.Structure(s,u)},update:function(e){var t=e.a,r=e.b,n=e.oldParams,i=e.newParams,a=e.cache;if(n.expression!==i.expression)return ft.UpdateResult.Recreate;var o=a.entry;if(o.currentStructure===t.data)return ft.UpdateResult.Unchanged;var s=Ta.updateStructure(o,t.data);return mt.isEmpty(s)?ft.UpdateResult.Null:(Ta.updateStructureObject(r,s,i.label),ft.UpdateResult.Updated)},dispose:function(e){var t=e.b;t==null||t.data.customPropertyDescriptors.dispose()}}),D9e=kt.BuiltIn({name:"structure-multi-selection-from-expression",display:{name:"Multi-structure Measurement Selection",description:"Create selection object from multiple structures."},from:ge.Root,to:ge.Molecule.Structure.Selections,params:function(){return{selections:I.ObjectList({key:I.Text(void 0,{description:"A unique key."}),ref:I.Text(),groupId:I.Optional(I.Text()),expression:I.Value(se.struct.generator.empty)},function(e){return e.ref},{isHidden:!0}),isTransitive:I.Optional(I.Boolean(!1,{isHidden:!0,description:"Remap the selections from the original structure if structurally equivalent."})),label:I.Optional(I.Text("",{isHidden:!0}))}}})({apply:function(e){for(var t=e.params,r=e.cache,n=e.dependencies,i=new Map,a=[],o=0,s=0,u=t.selections;s<u.length;s++){var l=u[s],c=Ta.createAndRun(n[l.ref].data,l.expression),d=c.selection,f=c.entry;i.set(l.key,f);var h=mt.toLociWithSourceUnits(d);a.push({key:l.key,loci:h,groupId:l.groupId}),o+=De.size(h)}r.entries=i;var v={label:""+(t.label||"Multi-selection"),description:t.selections.length+" source(s), "+o+" element(s) total"};return new ge.Molecule.Structure.Selections(a,v)},update:function(e){var t=e.b,r=e.oldParams,n=e.newParams,i=e.cache,a=e.dependencies;if(!!r.isTransitive!=!!n.isTransitive)return ft.UpdateResult.Recreate;for(var o=i.entries,s=new Map,u=new Map,l=0,c=t.data;l<c.length;l++){var d=c[l];u.set(d.key,d)}for(var f=!1,h=0,v=[],p=0,m=n.selections;p<m.length;p++){var g=m[p],y=a[g.ref].data,b=!1;if(o.has(g.key)){var S=o.get(g.key);if(Ta.isUnchanged(S,g.expression,y)&&u.has(g.key)){var x=u.get(g.key);x.groupId!==g.groupId&&(x.groupId=g.groupId,f=!0),s.set(g.key,S),v.push(x),h+=De.size(x.loci);continue}if(S.expression!==g.expression)b=!0;else{var C=!1;if(n.isTransitive)if($e.areUnitIdsAndIndicesEqual(S.originalStructure,y)){var w=Ta.run(S,S.originalStructure);S.currentStructure=y,s.set(g.key,S);var x=De.remap(mt.toLociWithSourceUnits(w),y);v.push({key:g.key,loci:x,groupId:g.groupId}),h+=De.size(x),f=!0}else C=!0;else C=!0;if(C){f=!0;var w=Ta.updateStructure(S,y);s.set(g.key,S);var x=mt.toLociWithSourceUnits(w);v.push({key:g.key,loci:x,groupId:g.groupId}),h+=De.size(x)}}}else b=!0;if(b){f=!0;var A=Ta.createAndRun(y,g.expression),w=A.selection,S=A.entry;s.set(g.key,S);var x=mt.toLociWithSourceUnits(w);v.push({key:g.key,loci:x}),h+=De.size(x)}}return f?(i.entries=s,t.data=v,t.label=""+(n.label||"Multi-selection"),t.description=v.length+" source(s), "+h+" element(s) total",ft.UpdateResult.Updated):ft.UpdateResult.Unchanged}}),R9e=kt.BuiltIn({name:"structure-selection-from-script",display:{name:"Selection",description:"Create a molecular structure from the specified script."},from:ge.Molecule.Structure,to:ge.Molecule.Structure,params:function(){return{script:I.Script({language:"mol-script",expression:"(sel.atom.atom-groups :residue-test (= atom.resname ALA))"}),label:I.Optional(I.Text(""))}}})({apply:function(e){var t=e.a,r=e.params,n=e.cache,i=Ta.createAndRun(t.data,r.script),a=i.selection,o=i.entry;n.entry=o;var s=mt.unionStructure(a),u={label:""+(r.label||"Selection"),description:$e.elementDescription(s)};return new ge.Molecule.Structure(s,u)},update:function(e){var t=e.a,r=e.b,n=e.oldParams,i=e.newParams,a=e.cache;if(!Li.areEqual(n.script,i.script))return ft.UpdateResult.Recreate;var o=a.entry;if(o.currentStructure===t.data)return ft.UpdateResult.Unchanged;var s=Ta.updateStructure(o,t.data);return Ta.updateStructureObject(r,s,i.label),ft.UpdateResult.Updated},dispose:function(e){var t=e.b;t==null||t.data.customPropertyDescriptors.dispose()}}),k9e=kt.BuiltIn({name:"structure-selection-from-bundle",display:{name:"Selection",description:"Create a molecular structure from the specified structure-element bundle."},from:ge.Molecule.Structure,to:ge.Molecule.Structure,params:function(){return{bundle:I.Value(Jr.Empty,{isHidden:!0}),label:I.Optional(I.Text("",{isHidden:!0}))}}})({apply:function(e){var t=e.a,r=e.params,n=e.cache;if(r.bundle.hash!==t.data.hashCode)return In.Null;n.source=t.data;var i=Jr.toStructure(r.bundle,t.data);if(i.elementCount===0)return In.Null;var a={label:""+(r.label||"Selection"),description:$e.elementDescription(i)};return new ge.Molecule.Structure(i,a)},update:function(e){var t=e.a,r=e.b,n=e.oldParams,i=e.newParams,a=e.cache;if(!Jr.areEqual(n.bundle,i.bundle))return ft.UpdateResult.Recreate;if(i.bundle.hash!==t.data.hashCode)return ft.UpdateResult.Null;if(a.source===t.data)return ft.UpdateResult.Unchanged;a.source=t.data;var o=Jr.toStructure(i.bundle,t.data);return o.elementCount===0?ft.UpdateResult.Null:(r.label=""+(i.label||"Selection"),r.description=$e.elementDescription(o),r.data=o,ft.UpdateResult.Updated)},dispose:function(e){var t=e.b;t==null||t.data.customPropertyDescriptors.dispose()}}),CZ={polymer:"polymer",protein:"protein",nucleic:"nucleic",water:"water",branched:"branched",ligand:"ligand","non-standard":"non-standard",coarse:"coarse","atomic-sequence":"atomic-sequence","atomic-het":"atomic-het",spheres:"spheres"},O9e=I.objectToOptions(CZ),L9e=kt.BuiltIn({name:"structure-complex-element",display:{name:"Complex Element",description:"Create a molecular structure from the specified model."},from:ge.Molecule.Structure,to:ge.Molecule.Structure,params:{type:I.Select("atomic-sequence",O9e,{isHidden:!0})}})({apply:function(e){var t=e.a,r=e.params,n,i;switch(r.type){case"polymer":n=di.polymer.query,i="Polymer";break;case"protein":n=di.protein.query,i="Protein";break;case"nucleic":n=di.nucleic.query,i="Nucleic";break;case"water":n=en.internal.water(),i="Water";break;case"branched":n=di.branchedPlusConnected.query,i="Branched";break;case"ligand":n=di.ligandPlusConnected.query,i="Ligand";break;case"non-standard":n=di.nonStandardPolymer.query,i="Non-standard";break;case"coarse":n=di.coarse.query,i="Coarse";break;case"atomic-sequence":n=en.internal.atomicSequence(),i="Sequence";break;case"atomic-het":n=en.internal.atomicHet(),i="HET Groups/Ligands";break;case"spheres":n=en.internal.spheres(),i="Coarse Spheres";break;default:throw new Error(r.type+" is a not valid complex element.")}var a=n(new Qo(t.data)),o=mt.unionStructure(a);return o.elementCount===0?In.Null:new ge.Molecule.Structure(o,{label:i,description:$e.elementDescription(o)})},dispose:function(e){var t=e.b;t==null||t.data.customPropertyDescriptors.dispose()}}),N9e=kt.BuiltIn({name:"structure-component",display:{name:"Component",description:"A molecular structure component."},from:ge.Molecule.Structure,to:ge.Molecule.Structure,params:A7e})({apply:function(e){var t=e.a,r=e.params,n=e.cache;return P7e(t.data,r,n)},update:function(e){var t=e.a,r=e.b,n=e.oldParams,i=e.newParams,a=e.cache;return T7e(t.data,r,n,i,a)},dispose:function(e){var t=e.b;t==null||t.data.customPropertyDescriptors.dispose()}}),_Z=kt.BuiltIn({name:"custom-model-properties",display:{name:"Custom Model Properties"},isDecorator:!0,from:ge.Molecule.Model,to:ge.Molecule.Model,params:function(e,t){return t.customModelProperties.getParams(e==null?void 0:e.data)}})({apply:function(e,t){var r=this,n=e.a,i=e.params;return We.create("Custom Props",function(a){return ce(r,void 0,void 0,function(){return de(this,function(o){switch(o.label){case 0:return[4,jU(n.data,t,a,i)];case 1:return o.sent(),[2,new ge.Molecule.Model(n.data,{label:n.label,description:n.description})]}})})})},update:function(e,t){var r=this,n=e.a,i=e.b,a=e.oldParams,o=e.newParams;return We.create("Custom Props",function(s){return ce(r,void 0,void 0,function(){var u,l,c,d;return de(this,function(f){switch(f.label){case 0:for(i.data=n.data,i.label=n.label,i.description=n.description,u=0,l=a.autoAttach;u<l.length;u++)c=l[u],d=t.customModelProperties.get(c),d&&n.data.customProperties.reference(d.descriptor,!1);return[4,jU(n.data,t,s,o)];case 1:return f.sent(),[2,ft.UpdateResult.Updated]}})})})},dispose:function(e){var t=e.b;t==null||t.data.customProperties.dispose()}});function jU(e,t,r,n){return ce(this,void 0,void 0,function(){var i,a,o,s,u,l,c,d,f;return de(this,function(h){switch(h.label){case 0:i={runtime:r,assetManager:t.managers.asset},a=n.autoAttach,o=n.properties,s=0,u=Object.keys(o),h.label=1;case 1:if(!(s<u.length))return[3,8];if(l=u[s],c=t.customModelProperties.get(l),d=o[l],!(a.includes(l)||c.isHidden))return[3,6];h.label=2;case 2:return h.trys.push([2,4,,5]),[4,c.attach(i,e,d,!0)];case 3:return h.sent(),[3,5];case 4:return f=h.sent(),t.log.warn("Error attaching model prop '"+l+"': "+f),[3,5];case 5:return[3,7];case 6:c.set(e,d),h.label=7;case 7:return s++,[3,1];case 8:return[2]}})})}var wZ=kt.BuiltIn({name:"custom-structure-properties",display:{name:"Custom Structure Properties"},isDecorator:!0,from:ge.Molecule.Structure,to:ge.Molecule.Structure,params:function(e,t){return t.customStructureProperties.getParams(e==null?void 0:e.data.root)}})({apply:function(e,t){var r=this,n=e.a,i=e.params;return We.create("Custom Props",function(a){return ce(r,void 0,void 0,function(){return de(this,function(o){switch(o.label){case 0:return[4,zU(n.data.root,t,a,i)];case 1:return o.sent(),[2,new ge.Molecule.Structure(n.data,{label:n.label,description:n.description})]}})})})},update:function(e,t){var r=this,n=e.a,i=e.b,a=e.oldParams,o=e.newParams;return n.data!==i.data?ft.UpdateResult.Recreate:We.create("Custom Props",function(s){return ce(r,void 0,void 0,function(){var u,l,c,d;return de(this,function(f){switch(f.label){case 0:for(i.data=n.data,i.label=n.label,i.description=n.description,u=0,l=a.autoAttach;u<l.length;u++)c=l[u],d=t.customStructureProperties.get(c),d&&n.data.customPropertyDescriptors.reference(d.descriptor,!1);return[4,zU(n.data.root,t,s,o)];case 1:return f.sent(),[2,ft.UpdateResult.Updated]}})})})},dispose:function(e){var t=e.b;t==null||t.data.customPropertyDescriptors.dispose()}});function zU(e,t,r,n){return ce(this,void 0,void 0,function(){var i,a,o,s,u,l,c,d,f;return de(this,function(h){switch(h.label){case 0:i={runtime:r,assetManager:t.managers.asset},a=n.autoAttach,o=n.properties,s=0,u=Object.keys(o),h.label=1;case 1:if(!(s<u.length))return[3,8];if(l=u[s],c=t.customStructureProperties.get(l),d=o[l],!(a.includes(l)||c.isHidden))return[3,6];h.label=2;case 2:return h.trys.push([2,4,,5]),[4,c.attach(i,e,d,!0)];case 3:return h.sent(),[3,5];case 4:return f=h.sent(),t.log.warn("Error attaching structure prop '"+l+"': "+f),[3,5];case 5:return[3,7];case 6:c.set(e,d),h.label=7;case 7:return s++,[3,1];case 8:return[2]}})})}var F9e=kt.BuiltIn({name:"shape-from-ply",display:{name:"Shape from PLY",description:"Create Shape from PLY data"},from:ge.Format.Ply,to:ge.Shape.Provider,params:function(e){return{}}})({apply:function(e){var t=this,r=e.a;return e.params,We.create("Create shape from PLY",function(n){return ce(t,void 0,void 0,function(){var i,a;return de(this,function(o){switch(o.label){case 0:return[4,B8e(r.data).runInContext(n)];case 1:return i=o.sent(),a={label:"Shape"},[2,new ge.Shape.Provider(i,a)]}})})})}});const B9e=Object.freeze(Object.defineProperty({__proto__:null,CoordinatesFromDcd:c9e,CoordinatesFromXtc:d9e,CustomModelProperties:_Z,CustomStructureProperties:wZ,ModelFromTrajectory:A9e,MultiStructureSelectionFromExpression:D9e,ShapeFromPly:F9e,StructureComplexElement:L9e,StructureComplexElementTypes:CZ,StructureComponent:N9e,StructureFromModel:T9e,StructureFromTrajectory:P9e,StructureSelectionFromBundle:k9e,StructureSelectionFromExpression:M9e,StructureSelectionFromScript:R9e,TopologyFromPsf:f9e,TrajectoryFromBlob:p9e,TrajectoryFromCifCore:_9e,TrajectoryFromCube:C9e,TrajectoryFromGRO:g9e,TrajectoryFromMOL:b9e,TrajectoryFromMOL2:S9e,TrajectoryFromMmCif:v9e,TrajectoryFromModelAndCoordinates:SZ,TrajectoryFromPDB:m9e,TrajectoryFromSDF:x9e,TrajectoryFromXYZ:y9e,TransformStructureConformation:I9e},Symbol.toStringTag,{value:"Module"}));function U9e(e){return e.originX===0&&e.originY===0&&e.originZ===0?_.create(e.NCSTART,e.NRSTART,e.NSSTART):_.create(e.originX/(e.xLength/e.NX),e.originY/(e.yLength/e.NY),e.originZ/(e.zLength/e.NZ))}function j9e(e){var t=wQ(e);switch(t){case ua.Float32:return Float32Array;case ua.Int8:return Int8Array;case ua.Int16:return Int16Array;case ua.Uint16:return Uint16Array}throw Error(t+" is not a supported value format.")}function z9e(e,t){var r=this;return We.create("Create Volume",function(n){return ce(r,void 0,void 0,function(){var i,a,o,s,u,l,c,d,f,h,v,p,m,g,y,b,S;return de(this,function(x){return i=e.header,a=e.values,o=_.create(i.xLength,i.yLength,i.zLength),t&&t.voxelSize&&_.mul(o,o,t.voxelSize),s=_.create($r(i.alpha),$r(i.beta),$r(i.gamma)),u=i.ISPG>65536?0:i.ISPG,l=xo.create(u||"P 1",o,s),c=_.create(i.MAPC-1,i.MAPR-1,i.MAPS-1),d=Pr.convertToCanonicalAxisIndicesFastToSlow(c),f=[i.NX,i.NY,i.NZ],h=d([i.NC,i.NR,i.NS]),v=U9e(i),t!=null&&t.offset&&_.add(v,v,t.offset),p=d(v),m=_.create(p[0]/f[0],p[1]/f[1],p[2]/f[2]),g=_.create(h[0]/f[0],h[1]/f[1],h[2]/f[2]),y=Pr.Space(h,Pr.invertAxisOrder(c),j9e(i)),b=Pr.create(y,Pr.Data1(a)),S=i.AMIN===0&&i.AMAX===0&&i.AMEAN===0&&i.ARMS===0,[2,{label:t==null?void 0:t.label,entryId:t==null?void 0:t.entryId,grid:{transform:{kind:"spacegroup",cell:l,fractionalBox:Xt.create(m,_.add(_.zero(),m,g))},cells:b,stats:{min:isNaN(i.AMIN)||S?g3(a):i.AMIN,max:isNaN(i.AMAX)||S?Cl(a):i.AMAX,mean:isNaN(i.AMEAN)||S?y3(a):i.AMEAN,sigma:isNaN(i.ARMS)||i.ARMS===0?b3(a):i.ARMS}},sourceData:E5.create(e),customProperties:new Tl,_propertyData:Object.create(null)}]})})})}var E5;(function(e){function t(n){return(n==null?void 0:n.kind)==="ccp4"}e.is=t;function r(n){return{kind:"ccp4",name:n.name,data:n}}e.create=r})(E5||(E5={}));function EZ(e,t){var r=this;return We.create("Create Volume",function(n){return ce(r,void 0,void 0,function(){var i,a,o,s,u,l,c,d,f,h;return de(this,function(v){return i=e.volume_data_3d_info,a=e.volume_data_3d,o=xo.create(i.spacegroup_number.value(0),_.ofArray(i.spacegroup_cell_size.value(0)),_.scale(_.zero(),_.ofArray(i.spacegroup_cell_angles.value(0)),Math.PI/180)),s=i.axis_order.value(0),u=Pr.convertToCanonicalAxisIndicesFastToSlow(s),l=u(i.sample_count.value(0)),c=Pr.Space(l,Pr.invertAxisOrder(s),Float32Array),d=Pr.create(c,Pr.Data1(a.values.toArray({array:Float32Array}))),f=_.ofArray(u(i.origin.value(0))),h=_.ofArray(u(i.dimensions.value(0))),[2,{label:t==null?void 0:t.label,entryId:t==null?void 0:t.entryId,grid:{transform:{kind:"spacegroup",cell:o,fractionalBox:Xt.create(f,_.add(_.zero(),f,h))},cells:d,stats:{min:i.min_sampled.value(0),max:i.max_sampled.value(0),mean:i.mean_sampled.value(0),sigma:i.sigma_sampled.value(0)}},sourceData:v_.create(e),customProperties:new Tl,_propertyData:Object.create(null)}]})})})}var v_;(function(e){function t(n){return(n==null?void 0:n.kind)==="dscif"}e.is=t;function r(n){return{kind:"dscif",name:n._name,data:n}}e.create=r})(v_||(v_={}));function V9e(e,t){var r=this;return We.create("Create Volume",function(n){return ce(r,void 0,void 0,function(){var i,a,o,s,u,l,c,d,f,h,v,p;return de(this,function(m){return i=e.header,a=e.values,o=_.create(i.xlen,i.ylen,i.zlen),t&&t.voxelSize&&_.mul(o,o,t.voxelSize),s=_.create($r(i.alpha),$r(i.beta),$r(i.gamma)),u=xo.create("P 1",o,s),l=[i.xRate,i.yRate,i.zRate],c=[i.xExtent,i.yExtent,i.zExtent],d=[i.xStart,i.yStart,i.zStart],f=_.create(d[0]/l[0],d[1]/l[1],d[2]/l[2]),h=_.create(c[0]/l[0],c[1]/l[1],c[2]/l[2]),v=Pr.Space(c,[0,1,2],Float32Array),p=Pr.create(v,Pr.Data1(a)),[2,{label:t==null?void 0:t.label,entryId:t==null?void 0:t.entryId,grid:{transform:{kind:"spacegroup",cell:u,fractionalBox:Xt.create(f,_.add(_.zero(),f,h))},cells:p,stats:{min:g3(a),max:Cl(a),mean:y3(a),sigma:i.sigma!==void 0?i.sigma:b3(a)}},sourceData:A5.create(e),customProperties:new Tl,_propertyData:Object.create(null)}]})})})}var A5;(function(e){function t(n){return(n==null?void 0:n.kind)==="dsn6"}e.is=t;function r(n){return{kind:"dsn6",name:n.name,data:n}}e.create=r})(A5||(A5={}));function H9e(e,t){var r=this;return We.create("Create Volume",function(){return ce(r,void 0,void 0,function(){var n,i,a,o,s,u;return de(this,function(l){return n=e.header,i=e.values,a=Pr.Space(n.dim,[0,1,2],Float64Array),o=Pr.create(a,Pr.Data1(i)),s=ue.fromTranslation(ue(),n.min),u=ue.fromScaling(ue(),n.h),ue.mul(s,s,u),[2,{label:t==null?void 0:t.label,entryId:t==null?void 0:t.entryId,grid:{transform:{kind:"matrix",matrix:s},cells:o,stats:{min:g3(i),max:Cl(i),mean:y3(i),sigma:b3(i)}},sourceData:P5.create(e),customProperties:new Tl,_propertyData:Object.create(null)}]})})})}var P5;(function(e){function t(n){return(n==null?void 0:n.kind)==="dx"}e.is=t;function r(n){return{kind:"dx",name:n.name,data:n}}e.create=r})(P5||(P5={}));var G9e=kt.BuiltIn({name:"volume-from-ccp4",display:{name:"Volume from CCP4/MRC/MAP",description:"Create Volume from CCP4/MRC/MAP data"},from:ge.Format.Ccp4,to:ge.Volume.Data,params:function(e){return{voxelSize:I.Vec3(_.create(1,1,1)),offset:I.Vec3(_.create(0,0,0)),entryId:I.Text("")}}})({apply:function(e){var t=this,r=e.a,n=e.params;return We.create("Create volume from CCP4/MRC/MAP",function(i){return ce(t,void 0,void 0,function(){var a,o;return de(this,function(s){switch(s.label){case 0:return[4,z9e(r.data,E(E({},n),{label:r.data.name||r.label})).runInContext(i)];case 1:return a=s.sent(),o={label:a.label||"Volume",description:"Volume "+r.data.header.NX+"×"+r.data.header.NX+"×"+r.data.header.NX},[2,new ge.Volume.Data(a,o)]}})})})},dispose:function(e){var t=e.b;t==null||t.data.customProperties.dispose()}}),q9e=kt.BuiltIn({name:"volume-from-dsn6",display:{name:"Volume from DSN6/BRIX",description:"Create Volume from DSN6/BRIX data"},from:ge.Format.Dsn6,to:ge.Volume.Data,params:function(e){return{voxelSize:I.Vec3(_.create(1,1,1)),entryId:I.Text("")}}})({apply:function(e){var t=this,r=e.a,n=e.params;return We.create("Create volume from DSN6/BRIX",function(i){return ce(t,void 0,void 0,function(){var a,o;return de(this,function(s){switch(s.label){case 0:return[4,V9e(r.data,E(E({},n),{label:r.data.name||r.label})).runInContext(i)];case 1:return a=s.sent(),o={label:a.label||"Volume",description:"Volume "+r.data.header.xExtent+"×"+r.data.header.yExtent+"×"+r.data.header.zExtent},[2,new ge.Volume.Data(a,o)]}})})})},dispose:function(e){var t=e.b;t==null||t.data.customProperties.dispose()}}),W9e=kt.BuiltIn({name:"volume-from-cube",display:{name:"Volume from Cube",description:"Create Volume from Cube data"},from:ge.Format.Cube,to:ge.Volume.Data,params:function(e){var t=e?I.Select(0,e.data.header.dataSetIds.map(function(r,n){return[n,""+r]})):I.Numeric(0);return{dataIndex:t,entryId:I.Text("")}}})({apply:function(e){var t=this,r=e.a,n=e.params;return We.create("Create volume from Cube",function(i){return ce(t,void 0,void 0,function(){var a,o;return de(this,function(s){switch(s.label){case 0:return[4,_6e(r.data,E(E({},n),{label:r.data.name||r.label})).runInContext(i)];case 1:return a=s.sent(),o={label:a.label||"Volume",description:"Volume "+r.data.header.dim[0]+"×"+r.data.header.dim[1]+"×"+r.data.header.dim[2]},[2,new ge.Volume.Data(a,o)]}})})})},dispose:function(e){var t=e.b;t==null||t.data.customProperties.dispose()}}),$9e=kt.BuiltIn({name:"volume-from-dx",display:{name:"Parse DX",description:"Create volume from DX data."},from:ge.Format.Dx,to:ge.Volume.Data})({apply:function(e){var t=this,r=e.a;return We.create("Parse DX",function(n){return ce(t,void 0,void 0,function(){var i,a;return de(this,function(o){switch(o.label){case 0:return[4,H9e(r.data,{label:r.data.name||r.label}).runInContext(n)];case 1:return i=o.sent(),a={label:i.label||"Volume",description:"Volume "+r.data.header.dim[0]+"×"+r.data.header.dim[1]+"×"+r.data.header.dim[2]},[2,new ge.Volume.Data(i,a)]}})})})},dispose:function(e){var t=e.b;t==null||t.data.customProperties.dispose()}}),X9e=kt.BuiltIn({name:"volume-from-density-server-cif",display:{name:"Volume from density-server CIF",description:"Identify and create all separate models in the specified CIF data block"},from:ge.Format.Cif,to:ge.Volume.Data,params:function(e){if(!e)return{blockHeader:I.Optional(I.Text(void 0,{description:"Header of the block to parse. If none is specifed, the 1st data block in the file is used."})),entryId:I.Text("")};var t=e.data.blocks.slice(1);return{blockHeader:I.Optional(I.Select(t[0]&&t[0].header,t.map(function(r){return[r.header,r.header]}),{description:"Header of the block to parse"})),entryId:I.Text("")}}})({isApplicable:function(e){return e.data.blocks.length>0},apply:function(e){var t=this,r=e.a,n=e.params;return We.create("Parse density-server CIF",function(i){return ce(t,void 0,void 0,function(){var a,o,s,u,l,c,d,f,h,v;return de(this,function(p){switch(p.label){case 0:if(a=n.blockHeader||r.data.blocks[1].header,o=r.data.blocks.find(function(m){return m.header===a}),!o)throw new Error("Data block '"+[a]+"' not found.");return s=Fc.schema.densityServer(o),[4,EZ(s,{entryId:n.entryId}).runInContext(i)];case 1:return u=p.sent(),l=u.grid.cells.space.dimensions,c=l[0],d=l[1],f=l[2],h={label:(v=n.entryId)!==null&&v!==void 0?v:s.volume_data_3d_info.name.value(0),description:"Volume "+c+"×"+d+"×"+f},[2,new ge.Volume.Data(u,h)]}})})})},dispose:function(e){var t=e.b;t==null||t.data.customProperties.dispose()}}),Y9e=kt.BuiltIn({name:"assign-color-volume",display:{name:"Assign Color Volume",description:"Assigns another volume to be available for coloring."},from:ge.Volume.Data,to:ge.Volume.Data,isDecorator:!0,params:function(e,t){if(!e)return{ref:I.Text()};var r=t.state.data.select(ir.Generators.root.subtree().ofType(ge.Volume.Data).filter(function(n){var i;return!!n.obj&&!(!((i=n.obj)===null||i===void 0)&&i.data.colorVolume)&&n.obj!==e}));return r.length===0?{ref:I.Text("",{isHidden:!0})}:{ref:I.Select(r[0].transform.ref,r.map(function(n){return[n.transform.ref,n.obj.label]}))}}})({apply:function(e){var t=this,r=e.a,n=e.params,i=e.dependencies;return We.create("Assign Color Volume",function(a){return ce(t,void 0,void 0,function(){var o,s,u;return de(this,function(l){if(!i||!i[n.ref])throw new Error("Dependency not available.");return o=i[n.ref].data,s=E(E({},r.data),{colorVolume:o}),u={label:r.label,description:"Volume + Colors"},[2,new ge.Volume.Data(s,u)]})})})}});const K9e=Object.freeze(Object.defineProperty({__proto__:null,AssignColorVolume:Y9e,VolumeFromCcp4:G9e,VolumeFromCube:W9e,VolumeFromDensityServerCif:X9e,VolumeFromDsn6:q9e,VolumeFromDx:$9e},Symbol.toStringTag,{value:"Module"}));var ix=at(13421772),Q9e="Assigns colors according to the Symbol Nomenclature for Glycans (SNFG).",AZ={};function Z9e(e){return AZ}function PZ(e,t){var r;if(e.structure){var n=e.structure.carbohydrates,i=n.elements,a=n.getElementIndices,o=function(s,u){if(!Ue.isAtomic(s))return ix;var l=a(s,u);return l.length>0?i[l[0]].component.color:ix};r=function(s,u){return u?Dt.Secondary:Ze.is(s)?o(s.unit,s.element):Vt.isLocation(s)?o(s.aUnit,s.aUnit.elements[s.aIndex]):ix}}else r=function(){return ix};return{factory:PZ,granularity:"group",color:r,props:t,description:Q9e,legend:uh(l4e)}}var J9e={name:"carbohydrate-symbol",label:"Carbohydrate Symbol",category:"Residue Property",factory:PZ,getParams:Z9e,defaultValues:I.getDefaultValues(AZ),isApplicable:function(e){return!!e.structure&&e.structure.models.some(function(t){return Wt.hasCarbohydrate(t)})}},TZ={hue:I.Interval([1,360],{min:0,max:360,step:1}),chroma:I.Interval([40,70],{min:0,max:100,step:1}),luminance:I.Interval([15,85],{min:0,max:100,step:1}),clusteringStepCount:I.Numeric(50,{min:10,max:200,step:1},{isHidden:!0}),minSampleCount:I.Numeric(800,{min:100,max:5e3,step:100},{isHidden:!0})};function IZ(e,t){return Math.sqrt(Math.pow(Math.abs(e[0]-t[0]),2)+Math.pow(Math.abs(e[1]-t[1]),2)+Math.pow(Math.abs(e[2]-t[2]),2))}var Xv=2,Ch=[0,0,0],_h=[0,0,0];function eUe(e,t){return ea.toHcl(Ch,e),ea.fromColor(_h,ea.toColor(e)),Ch[0]>=t.hue[0]&&Ch[0]<=t.hue[1]&&Ch[1]>=t.chroma[0]&&Ch[1]<=t.chroma[1]&&Ch[2]>=t.luminance[0]&&Ch[2]<=t.luminance[1]&&_h[0]>=e[0]-Xv&&_h[0]<=e[0]+Xv&&_h[1]>=e[1]-Xv&&_h[1]<=e[1]+Xv&&_h[2]>=e[2]-Xv&&_h[2]<=e[2]+Xv}function tUe(e){for(var t=e.slice(0),r=[t.shift()];t.length>0;){for(var n=r[r.length-1],i=0,a=Number.MIN_SAFE_INTEGER,o=0;o<t.length;++o){var s=IZ(n,t[o]);s>a&&(a=s,i=o)}r.push(t.splice(i,1)[0])}return r}function rUe(e,t){for(var r=new Map,n=Math.cbrt(e)*1.001,i=(t.hue[1]-t.hue[0])/n,a=(t.chroma[1]-t.chroma[0])/n,o=(t.luminance[1]-t.luminance[0])/n,s=t.hue[0];s<=t.hue[1];s+=i)for(var u=t.chroma[0];u<=t.chroma[1];u+=a)for(var l=t.luminance[0];l<=t.luminance[1];l+=o){var c=ea.fromHcl(ea(),yl.create(s,u,l));eUe(c,t)&&r.set(c.toString(),c)}return Array.from(r.values())}function nUe(e,t){t===void 0&&(t={});var r=E(E({},I.getDefaultValues(TZ)),t);if(e<=0)return[];var n=rUe(Math.max(r.minSampleCount,e*5),r);if(n.length<e)throw new Error("Not enough samples to generate distinct colors, increase sample count.");for(var i=[],a=[],o=Math.floor(n.length/e),s=0;s<n.length&&(i.push(n[s]),a.push([]),!(i.length>=e));s+=o);for(var u=1;u<=r.clusteringStepCount;++u){for(var l=qf(a),s=0;s<n.length;++s){for(var c=Number.MAX_SAFE_INTEGER,d=0,f=0;f<i.length;f++){var h=IZ(n[s],i[f]);h<c&&(c=h,d=f)}l[d].push(n[s])}for(var v=qf(i),s=0;s<l.length;++s){for(var p=l[s],m=p.length,g=[],y=[],b=[],S=0,x=p;S<x.length;S++){var C=x[S];g.push(C[0]),y.push(C[1]),b.push(C[2])}var w=Gy(g)/m,A=Gy(y)/m,M=Gy(b)/m;i[s]=[w,A,M]}if(Mc(v,i))break}return tUe(i).map(function(D){return ea.toColor(D)})}var MZ={type:"generate",colorList:"red-yellow-blue"};function is(e){e===void 0&&(e={});var t=E(E({},MZ),e);return{palette:I.MappedStatic(t.type,{colors:I.Group({list:I.ColorList(t.colorList)},{isFlat:!0}),generate:I.Group(E(E({},TZ),{maxCount:I.Numeric(75,{min:1,max:250,step:1})}),{isFlat:!0})},{options:[["colors","Color List"],["generate","Generate Distinct"]]})}}I.getDefaultValues(is());var VU={valueLabel:function(e){return""+(e+1)},minLabel:"Start",maxLabel:"End"};function Gs(e,t,r){var n;r===void 0&&(r={});var i,a;if(t.palette.name==="colors"&&t.palette.params.list.kind==="interpolate"){var o=t.palette.params.list,s=[0,e-1],u=E(E({},VU),r),l=u.minLabel,c=u.maxLabel,d=o.colors;d.length===0&&(d=Os(MZ.colorList).list);var f=Pu.create({listOrName:d,domain:s,minLabel:l,maxLabel:c});a=f.legend,i=f.color}else{var h;t.palette.name==="colors"?(h=t.palette.params.list.colors.map(function(b){return Array.isArray(b)?b[0]:b}),h.length===0&&(h=Os("dark-2").list.map(function(b){return Array.isArray(b)?b[0]:b}))):(e=Math.min(e,t.palette.params.maxCount),h=nUe(e,t.palette.params));for(var v=(n=r.valueLabel)!==null&&n!==void 0?n:VU.valueLabel,p=h.length,m=[],g=0;g<e;++g){var y=g%p;m[y]===void 0?m[y]=[v(g),h[y]]:m[y][0]+=", "+v(g)}a=uh(m),i=function(b){return h[b%p]}}return{color:i,legend:a}}var iUe="many-distinct",HU=at(16448250),aUe="Gives every chain a color based on its `asym_id` value.",j3=E({asymId:I.Select("auth",I.arrayToOptions(["auth","label"]))},is({type:"colors",colorList:iUe}));function oUe(e){var t,r=I.clone(j3);return!((t=e.structure)===null||t===void 0)&&t.models.some(function(n){return n.coarseHierarchy.isDefined})&&(r.asymId.defaultValue="label"),r}function sUe(e,t){switch(e.kind){case 0:return t==="auth"?lt.chain.auth_asym_id:lt.chain.label_asym_id;case 1:case 2:return lt.coarse.asym_id}}function GU(e,t){var r=sUe(e.unit,t)(e);return e.structure.root.models.length>1?DZ(e.unit.model,r):r}function DZ(e,t){return t+"|"+((Wt.Index.get(e).value||0)+1)}function uUe(e,t){for(var r=new Map,n=function(s){var u=Wt.AsymIdOffset.get(s).value,l=(t==="auth"?u==null?void 0:u.auth:u==null?void 0:u.label)||0,c=0;s.properties.structAsymMap.forEach(function(d,f){var h=d.auth_id,v=t==="auth"?h:f,p=e.models.length>1?DZ(s,v):v;r.has(p)||(r.set(p,c+l),++c)})},i=0,a=e.models;i<a.length;i++){var o=a[i];n(o)}return r}function z3(e,t){var r,n;if(e.structure){var i=Ze.create(e.structure.root),a=uUe(e.structure.root,t.asymId),o=Array.from(a.keys()),s=function(l){return o[l]},u=Gs(a.size,t,{valueLabel:s});n=u.legend,r=function(l){var c=void 0;if(Ze.is(l)){var d=GU(l,t.asymId);c=a.get(d)}else if(Vt.isLocation(l)){i.unit=l.aUnit,i.element=l.aUnit.elements[l.aIndex];var d=GU(i,t.asymId);c=a.get(d)}return c===void 0?HU:u.color(c)}}else r=function(){return HU};return{factory:z3,granularity:"group",color:r,props:t,description:aUe,legend:n}}var RZ={name:"chain-id",label:"Chain Id",category:"Chain Property",factory:z3,getParams:oUe,defaultValues:I.getDefaultValues(j3),isApplicable:function(e){return!!e.structure}},qU=at(13421772),lUe="Gives every element (atom or coarse sphere/gaussian) a unique color based on the position (index) of the element in the list of elements in the structure.",kZ=E({},is({type:"colors",colorList:"red-yellow-blue"}));function cUe(e){return kZ}function OZ(e,t){var r,n;if(e.structure){for(var i=e.structure.root.units,a=i.length,o=new Map,s=new Map,u=0,l=0;l<a;++l)o.set(l,u),u+=i[l].elements.length,s.set(i[l].id,l);var c=Gs(u,t);n=c.legend,r=function(d){if(Ze.is(d)){var f=s.get(d.unit.id),h=Oe.findPredecessorIndex(i[f].elements,d.element);return c.color(o.get(f)+h)}else if(Vt.isLocation(d)){var f=s.get(d.aUnit.id),h=Oe.findPredecessorIndex(i[f].elements,d.aUnit.elements[d.aIndex]);return c.color(o.get(f)+h)}return qU}}else r=function(){return qU};return{factory:OZ,granularity:"groupInstance",preferSmoothing:!0,color:r,props:t,description:lUe,legend:n}}var dUe={name:"element-index",label:"Element Index",category:"Atom Property",factory:OZ,getParams:cUe,defaultValues:I.getDefaultValues(kZ),isApplicable:function(e){return!!e.structure}},fUe="many-distinct",WU=at(13421772),hUe="Assigns a color based on the operator name of a transformed chain.",kO=E({},is({type:"colors",colorList:fUe}));function pUe(e){var t=I.clone(kO);return t}function vUe(e){for(var t=new Map,r=0,n=e.units.length;r<n;++r){var i=e.units[r].conformation.operator.name;t.has(i)||t.set(i,t.size)}return t}function OO(e,t){var r,n;if(e.structure){var i=vUe(e.structure.root),a=Array.from(i.keys()),o=function(u){return a[u]},s=Gs(i.size,t,{valueLabel:o});n=s.legend,r=function(u){var l=void 0;if(Ze.is(u)){var c=u.unit.conformation.operator.name;l=i.get(c)}else if(Vt.isLocation(u)){var d=u.aUnit.conformation.operator.name;l=i.get(d)}return l===void 0?WU:s.color(l)}}else r=function(){return WU};return{factory:OO,granularity:"instance",color:r,props:t,description:hUe,legend:n}}var LO={name:"operator-name",label:"Operator Name",category:"Symmetry",factory:OO,getParams:pUe,defaultValues:I.getDefaultValues(kO),isApplicable:function(e){return!!e.structure}},rT={H:16777215,D:16777152,T:16777120,HE:14286847,LI:13402367,BE:12779264,B:16758197,C:9474192,N:3166456,O:16715021,F:9494608,NE:11789301,NA:11230450,MG:9109248,AL:12560038,SI:1578e4,P:16744448,S:16777008,CL:2093087,AR:8442339,K:9388244,CA:4062976,SC:15132390,TI:12567239,V:10921643,CR:9083335,MN:10255047,FE:14706227,CO:15765664,NI:5296208,CU:13140019,ZN:8224944,GA:12750735,GE:6721423,AS:12419299,SE:16752896,BR:10889513,KR:6076625,RB:7351984,SR:65280,Y:9764863,ZR:9756896,NB:7586505,MO:5551541,TC:3907230,RU:2396047,RH:687500,PD:27013,AG:12632256,CD:16767375,IN:10909043,SN:6717568,SB:10380213,TE:13924864,I:9699476,XE:9699476,CS:5707663,BA:51456,LA:7394559,CE:16777159,PR:14286791,ND:13107143,PM:10747847,SM:9437127,EU:6422471,GD:4587463,TB:3211207,DY:2097095,HO:65436,ER:58997,TM:54354,YB:48952,LU:43812,HF:5096191,TA:5089023,W:2200790,RE:2522539,OS:2516630,IR:1528967,PT:13684960,AU:16765219,HG:12105936,TL:10900557,PB:5724513,BI:10375093,PO:11230208,AT:7688005,RN:4358806,FR:4325478,RA:32e3,AC:7384058,TH:47871,PA:41471,U:36863,NP:33023,PU:27647,AM:5528818,CM:7888099,BK:9064419,CF:10565332,ES:11739092,FM:11739066,MD:11734438,NO:12389767,LR:13041766,RF:13369433,DB:13697103,SG:14221381,BH:14680120,HS:15073326,MT:15400998,DS:16777215,RG:16777215,CN:16777215,UUT:16777215,FL:16777215,UUP:16777215,LV:16777215,UUH:16777215},LZ=at(16777215),mUe="Assigns a color to every atom according to its chemical element.",NZ={carbonColor:I.MappedStatic("chain-id",{"chain-id":I.Group(E({},j3)),"operator-name":I.Group(E({},kO)),"element-symbol":I.Group({})},{description:"Use chain-id coloring for carbon atoms."}),saturation:I.Numeric(0,{min:-6,max:6,step:.1}),lightness:I.Numeric(.2,{min:-6,max:6,step:.1})};function gUe(e){return NZ}function yUe(e,t){var r=e[t];return r===void 0?LZ:r}function FZ(e,t){var r=l3(rT,t.saturation,t.lightness),n=t.carbonColor.name==="chain-id"?z3(e,t.carbonColor.params).color:t.carbonColor.name==="operator-name"?OO(e,t.carbonColor.params).color:void 0;function i(s,u){return n&&s==="C"?n(u,!1):yUe(r,s)}function a(s){if(Ze.is(s)){if(Ue.isAtomic(s.unit)){var u=s.unit.model.atomicHierarchy.atoms.type_symbol;return i(u.value(s.element),s)}}else if(Vt.isLocation(s)&&Ue.isAtomic(s.aUnit)){var u=s.aUnit.model.atomicHierarchy.atoms.type_symbol,l=u.value(s.aUnit.elements[s.aIndex]);return i(l,s)}return LZ}var o=t.carbonColor.name==="operator-name"?"groupInstance":"group";return{factory:FZ,granularity:o,preferSmoothing:!0,color:a,props:t,description:mUe,legend:uh(Object.keys(rT).map(function(s){return[s,rT[s]]}))}}var bUe={name:"element-symbol",label:"Element Symbol",category:"Atom Property",factory:FZ,getParams:gUe,defaultValues:I.getDefaultValues(NZ),isApplicable:function(e){return!!e.structure}},nT={water:3697840,ion:15729279,protein:12496596,RNA:16629894,DNA:12540695,PNA:4367514,saccharide:8374655},T5=at(16777113),xUe="Assigns a color based on the molecule type of a residue.",BZ={saturation:I.Numeric(0,{min:-6,max:6,step:.1}),lightness:I.Numeric(0,{min:-6,max:6,step:.1})};function SUe(e){return BZ}function $U(e,t,r){var n=dO(t,r);switch(n){case 2:return e.water;case 3:return e.ion;case 5:return e.protein;case 6:return e.RNA;case 7:return e.DNA;case 8:return e.PNA;case 9:return e.saccharide}return T5}function UZ(e,t){var r=l3(nT,t.saturation,t.lightness);function n(i){return Ze.is(i)?$U(r,i.unit,i.element):Vt.isLocation(i)?$U(r,i.aUnit,i.aUnit.elements[i.aIndex]):T5}return{factory:UZ,granularity:"group",color:n,props:t,description:xUe,legend:uh(Object.keys(nT).map(function(i){return[i,nT[i]]}).concat([["Other/unknown",T5]]))}}var CUe={name:"molecule-type",label:"Molecule Type",category:"Residue Property",factory:UZ,getParams:SUe,defaultValues:I.getDefaultValues(BZ),isApplicable:function(e){return!!e.structure}},I5="dark-2",XU=at(16448250),_Ue="Gives every polymer chain a color based on its `asym_id` value.",jZ=E({},is({type:"colors",colorList:I5}));function wUe(e){var t=I.clone(jZ);return e.structure&&zZ(e.structure.root).size>mo[I5].list.length&&(t.palette.defaultValue.name="colors",t.palette.defaultValue.params=E(E({},t.palette.defaultValue.params),{list:{kind:"interpolate",colors:Os(I5).list}})),t}function YU(e){switch(e.kind){case 0:return lt.chain.label_asym_id;case 1:case 2:return lt.coarse.asym_id}}function zZ(e){for(var t=new Map,r=0,n=e.unitSymmetryGroups.length;r<n;++r){var i=e.unitSymmetryGroups[r].units[0],a=i.model;if(Ue.isAtomic(i))for(var o=a.atomicHierarchy,s=o.chainAtomSegments,u=o.chains,l=nr.transientSegments(s,i.elements);l.hasNext;){var c=l.move().index,d=u.label_entity_id.value(c),f=a.entities.getEntityIndex(d);if(a.entities.data.type.value(f)==="polymer"){var h=u.label_asym_id.value(c);t.has(h)||t.set(h,t.size)}}else if(Ue.isCoarse(i))for(var v=Ue.isSpheres(i)?a.coarseHierarchy.spheres:a.coarseHierarchy.gaussians,p=v.chainElementSegments,m=v.asym_id,g=v.entity_id,l=nr.transientSegments(p,i.elements);l.hasNext;){var c=l.move().index,y=p.offsets[c],d=g.value(y),f=a.entities.getEntityIndex(d);if(a.entities.data.type.value(f)==="polymer"){var h=m.value(y);t.has(h)||t.set(h,t.size)}}}return t}function VZ(e,t){var r,n;if(e.structure){var i=Ze.create(e.structure),a=zZ(e.structure.root),o=Array.from(a.keys()),s=function(l){return o[l]},u=Gs(a.size,t,{valueLabel:s});n=u.legend,r=function(l){var c=void 0;if(Ze.is(l)){var d=YU(l.unit);c=a.get(d(l))}else if(Vt.isLocation(l)){var d=YU(l.aUnit);i.unit=l.aUnit,i.element=l.aUnit.elements[l.aIndex],c=a.get(d(i))}return c===void 0?XU:u.color(c)}}else r=function(){return XU};return{factory:VZ,granularity:"group",color:r,props:t,description:_Ue,legend:n}}var EUe={name:"polymer-id",label:"Polymer Chain Id",category:"Chain Property",factory:VZ,getParams:wUe,defaultValues:I.getDefaultValues(jZ),isApplicable:function(e){return!!e.structure}},M5="dark-2",KU=at(13421772),AUe="Gives every polymer chain instance a unique color based on the position (index) of the polymer in the list of polymers in the structure.",HZ=E({},is({type:"colors",colorList:M5}));function PUe(e){var t=I.clone(HZ);return e.structure&&GZ(e.structure.root)>mo[M5].list.length&&(t.palette.defaultValue.name="colors",t.palette.defaultValue.params=E(E({},t.palette.defaultValue.params),{list:{kind:"interpolate",colors:Os(M5).list}})),t}function GZ(e){for(var t=0,r=e.units,n=0,i=r.length;n<i;++n)r[n].polymerElements.length>0&&++t;return t}function qZ(e,t){var r,n;if(e.structure){var i=Gs(GZ(e.structure.root),t);n=i.legend;for(var a=e.structure.root.units,o=new Map,s=0,u=0,l=a.length;s<l;++s)a[s].polymerElements.length>0&&(o.set(a[s].id,i.color(u)),++u);r=function(c){var d;return Ze.is(c)?d=o.get(c.unit.id):Vt.isLocation(c)&&(d=o.get(c.aUnit.id)),d!==void 0?d:KU}}else r=function(){return KU};return{factory:qZ,granularity:"instance",color:r,props:t,description:AUe,legend:n}}var TUe={name:"polymer-index",label:"Polymer Chain Instance",category:"Chain Property",factory:qZ,getParams:PUe,defaultValues:I.getDefaultValues(HZ),isApplicable:function(e){return!!e.structure}},iT={ALA:9240460,ARG:124,ASN:16743536,ASP:10485826,CYS:16777072,GLN:16731212,GLU:6684672,GLY:15658734,HIS:7368959,ILE:19456,LEU:4546117,LYS:4671416,MET:12099650,PHE:5459026,PRO:5395026,SER:16740418,THR:12078080,TRP:5195264,TYR:9203788,VAL:16747775,A:14423100,G:3329330,I:10145074,C:16766720,T:4286945,U:4251856,DA:14423100,DG:3329330,DI:10145074,DC:16766720,DT:4286945,DU:4251856,APN:14423100,GPN:3329330,CPN:16766720,TPN:4286945},D5=at(16711935),IUe="Assigns a color to every residue according to its name.",WZ={saturation:I.Numeric(0,{min:-6,max:6,step:.1}),lightness:I.Numeric(1,{min:-6,max:6,step:.1})};function MUe(e){return WZ}function QU(e,t){return e.model.atomicHierarchy.atoms.label_comp_id.value(t)}function ZU(e,t){var r=e.coarseElements.seq_id_begin.value(t),n=e.coarseElements.seq_id_end.value(t);if(r===n){var i=e.coarseElements.entityKey[t],a=e.model.sequence.byEntityKey[i].sequence;return a.compId.value(r-1)}}function ax(e,t){var r=e[t];return r===void 0?D5:r}function $Z(e,t){var r=l3(iT,t.saturation,t.lightness);function n(i){if(Ze.is(i))if(Ue.isAtomic(i.unit)){var a=QU(i.unit,i.element);return ax(r,a)}else{var a=ZU(i.unit,i.element);if(a)return ax(r,a)}else if(Vt.isLocation(i))if(Ue.isAtomic(i.aUnit)){var a=QU(i.aUnit,i.aUnit.elements[i.aIndex]);return ax(r,a)}else{var a=ZU(i.aUnit,i.aUnit.elements[i.aIndex]);if(a)return ax(r,a)}return D5}return{factory:$Z,granularity:"group",preferSmoothing:!0,color:n,props:t,description:IUe,legend:uh(Object.keys(iT).map(function(i){return[i,iT[i]]}).concat([["Unknown",D5]]))}}var DUe={name:"residue-name",label:"Residue Name",category:"Residue Property",factory:$Z,getParams:MUe,defaultValues:I.getDefaultValues(WZ),isApplicable:function(e){return!!e.structure}},aT={alphaHelix:16711808,threeTenHelix:10485888,piHelix:6291584,betaTurn:6324479,betaStrand:16762880,coil:16777215,bend:6740169,turn:45670,dna:11403518,rna:16580962,carbohydrate:10921722},R5=at(8421504),RUe="Assigns a color based on the type of secondary structure and basic molecule type.",XZ={saturation:I.Numeric(-1,{min:-6,max:6,step:.1}),lightness:I.Numeric(0,{min:-6,max:6,step:.1})};function kUe(e){return XZ}function JU(e,t,r,n){var i=Lr.create(0);if(n&&Ue.isAtomic(t)){var a=n.get(t.invariantId);a&&(i=a.type[a.getIndex(t.residueIndex[r])])}if(Lr.is(i,2))return Lr.is(i,2048)?e.threeTenHelix:Lr.is(i,32768)?e.piHelix:e.alphaHelix;if(Lr.is(i,4))return e.betaStrand;if(Lr.is(i,8))return e.bend;if(Lr.is(i,16))return e.turn;var o=dO(t,r);return o===7?e.dna:o===6?e.rna:o===9?e.carbohydrate:o===5?e.coil:R5}function YZ(e,t){var r=e.structure&&Al.get(e.structure),n=r?cv(r.id,r.version):-1,i=l3(aT,t.saturation,t.lightness);function a(o){return Ze.is(o)?JU(i,o.unit,o.element,r==null?void 0:r.value):Vt.isLocation(o)?JU(i,o.aUnit,o.aUnit.elements[o.aIndex],r==null?void 0:r.value):R5}return{factory:YZ,granularity:"group",preferSmoothing:!0,color:a,props:t,contextHash:n,description:RUe,legend:uh(Object.keys(aT).map(function(o){return[o,aT[o]]}).concat([["Other",R5]]))}}var OUe={name:"secondary-structure",label:"Secondary Structure",category:"Residue Property",factory:YZ,getParams:kUe,defaultValues:I.getDefaultValues(XZ),isApplicable:function(e){return!!e.structure},ensureCustomProperties:{attach:function(e,t){return t.structure?Al.attach(e,t.structure,void 0,!0):Promise.resolve()},detach:function(e){return e.structure&&Al.ref(e.structure,!1)}}},LUe=at(13421772),NUe="Gives every polymer residue a color based on its `seq_id` value.",KZ={list:I.ColorList("turbo",{presetKind:"scale"})};function FUe(e){return KZ}function ej(e,t){var r=e.model;switch(e.kind){case 0:var n=r.atomicHierarchy.residueAtomSegments.index[t];return r.atomicHierarchy.residues.label_seq_id.value(n);case 1:return Math.round((r.coarseHierarchy.spheres.seq_id_begin.value(t)+r.coarseHierarchy.spheres.seq_id_end.value(t))/2);case 2:return Math.round((r.coarseHierarchy.gaussians.seq_id_begin.value(t)+r.coarseHierarchy.gaussians.seq_id_end.value(t))/2)}}function tj(e,t){var r=e.model,n="";switch(e.kind){case 0:var i=r.atomicHierarchy.chainAtomSegments.index[t];n=r.atomicHierarchy.chains.label_entity_id.value(i);break;case 1:n=r.coarseHierarchy.spheres.entity_id.value(t);break;case 2:n=r.coarseHierarchy.gaussians.entity_id.value(t);break}if(n==="")return 0;var a=r.entities.getEntityIndex(n);if(a===-1)return 0;var o=r.sequence.byEntityKey[a];return o===void 0?0:o.sequence.length}function QZ(e,t){var r=Pu.create({listOrName:t.list.colors,minLabel:"Start",maxLabel:"End"}),n=function(i){if(Ze.is(i)){var a=i.unit,o=i.element,s=ej(a,o);if(s>0){var u=tj(a,o);if(u)return r.setDomain(0,u-1),r.color(s)}}else if(Vt.isLocation(i)){var l=i.aUnit,c=i.aIndex,s=ej(l,l.elements[c]);if(s>0){var u=tj(l,l.elements[c]);if(u)return r.setDomain(0,u-1),r.color(s)}}return LUe};return{factory:QZ,granularity:"group",preferSmoothing:!0,color:n,props:t,description:NUe,legend:r?r.legend:void 0}}var BUe={name:"sequence-id",label:"Sequence Id",category:"Residue Property",factory:QZ,getParams:FUe,defaultValues:I.getDefaultValues(KZ),isApplicable:function(e){return!!e.structure}},k5="dark-2",rj=at(13421772),UUe="Gives every chain instance (single chain or collection of single elements) a unique color based on the position (index) of the chain in the list of chains in the structure.",ZZ=E({},is({type:"colors",colorList:k5}));function jUe(e){var t=I.clone(ZZ);return e.structure&&e.structure.root.units.length>mo[k5].list.length&&(t.palette.defaultValue.name="colors",t.palette.defaultValue.params=E(E({},t.palette.defaultValue.params),{list:{kind:"interpolate",colors:Os(k5).list}})),t}function JZ(e,t){var r,n;if(e.structure){var i=e.structure.root.units,a=Gs(i.length,t);n=a.legend;for(var o=new Map,s=0,u=i.length;s<u;++s)o.set(i[s].id,a.color(s));r=function(l){return Ze.is(l)?o.get(l.unit.id):Vt.isLocation(l)?o.get(l.aUnit.id):rj}}else r=function(){return rj};return{factory:JZ,granularity:"instance",color:r,props:t,description:UUe,legend:n}}var zUe={name:"unit-index",label:"Chain Instance",category:"Chain Property",factory:JZ,getParams:jUe,defaultValues:I.getDefaultValues(ZZ),isApplicable:function(e){return!!e.structure}},VUe=at(16777113),HUe="Assigns a color based on the uncertainty or disorder of an element's position, e.g. B-factor or RMSF, depending on the data availability and experimental technique.",eJ={domain:I.Interval([0,100]),list:I.ColorList("red-white-blue",{presetKind:"scale"})};function GUe(e){return eJ}function nj(e,t){return Ue.isAtomic(e)?e.model.atomicConformation.B_iso_or_equiv.value(t):Ue.isSpheres(e)?e.model.coarseConformation.spheres.rmsf[t]:0}function tJ(e,t){var r=Pu.create({reverse:!0,domain:t.domain,listOrName:t.list.colors});function n(i){return Ze.is(i)?r.color(nj(i.unit,i.element)):Vt.isLocation(i)?r.color(nj(i.aUnit,i.aUnit.elements[i.aIndex])):VUe}return{factory:tJ,granularity:"group",preferSmoothing:!0,color:n,props:t,description:HUe,legend:r?r.legend:void 0}}var qUe={name:"uncertainty",label:"Uncertainty/Disorder",category:"Atom Property",factory:tJ,getParams:GUe,defaultValues:I.getDefaultValues(eJ),isApplicable:function(e){return!!e.structure&&e.structure.models.some(function(t){return t.atomicConformation.B_iso_or_equiv.isDefined||t.coarseHierarchy.isDefined})}},O5="dark-2",ox=at(16448250),WUe="Gives ranges of a polymer chain a color based on the entity source it originates from (e.g. gene, plasmid, organism).",rJ=E({},is({type:"colors",colorList:O5}));function $Ue(e){var t=I.clone(rJ);return e.structure&&iJ(e.structure.root.models).srcKeySerialMap.size>mo[O5].list.length&&(t.palette.defaultValue.name="colors",t.palette.defaultValue.params=E(E({},t.palette.defaultValue.params),{list:{kind:"interpolate",colors:Os(O5).list}})),t}function nJ(e,t){return e+"|"+t}function XUe(e,t,r,n,i,a){return e+"|"+t+"|"+r+"|"+(a||i||n)}function oT(e,t,r,n,i,a,o,s){for(var u=i.entity_id,l=i.pdbx_src_id,c=i.pdbx_beg_seq_num,d=i.pdbx_end_seq_num,f=0,h=i._rowCount;f<h;++f){var v=u.value(f),p=nJ(r,v),m=void 0;if(e.has(p))m=e.get(p);else{var g=n.entities.getEntityIndex(v),y=n.sequence.sequences[g].sequence;m=new Int16Array(y.length),e.set(p,m)}var b=o?o.value(f):"",S=s?s.value(f)[0]:"",x=XUe(r,v,a.value(f),l.value(f),b,S),C=c.valueKind(f)===0?c.value(f):1,w=d.valueKind(f)===0?d.value(f):m.length,A=void 0;t.has(x)?A=t.get(x):(A=t.size+1,t.set(x,A));for(var M=C,D=w;M<=D;++M)m[M-1]=A}}function iJ(e){for(var t=new Map,r=new Map,n=0,i=e.length;n<i;++n){var a=e[n];if(tn.is(a.sourceData)){var o=a.sourceData.data.db,s=o.entity_src_gen,u=o.entity_src_nat,l=o.pdbx_entity_src_syn;oT(t,r,n,a,s,s.pdbx_gene_src_scientific_name,s.plasmid_name,s.pdbx_gene_src_gene),oT(t,r,n,a,u,u.pdbx_organism_scientific,u.pdbx_plasmid_name),oT(t,r,n,a,l,l.organism_scientific)}}return{seqToSrcByModelEntity:t,srcKeySerialMap:r}}function YUe(e){var t=0;return Array.from(e.keys()).map(function(r){var n=r.split("|"),i=n[2],a=jIe(n[3])?"Unnamed "+ ++t:n[3];return""+a+(i?" ("+i+")":"")})}function aJ(e,t){var r,n;if(e.structure){var i=Ze.create(e.structure),a=e.structure.root.models,o=iJ(a),s=o.seqToSrcByModelEntity,u=o.srcKeySerialMap,l=YUe(u),c=function(h){return l[h]},d=Gs(u.size,t,{valueLabel:c});n=d.legend;var f=function(h){var v=a.indexOf(h.unit.model),p=lt.entity.id(h),m=nJ(v,p),g=s.get(m);if(g){var y=g[lt.residue.label_seq_id(h)-1]-1;return y===-1?ox:d.color(y)}else return ox};r=function(h){return Ze.is(h)?f(h):Vt.isLocation(h)?(i.unit=h.aUnit,i.element=h.aUnit.elements[h.aIndex],f(i)):ox}}else r=function(){return ox};return{factory:aJ,granularity:"group",color:r,props:t,description:WUe,legend:n}}var KUe={name:"entity-source",label:"Entity Source",category:"Chain Property",factory:aJ,getParams:$Ue,defaultValues:I.getDefaultValues(rJ),isApplicable:function(e){return!!e.structure}},QUe=at(15658734),ZUe="Assigns an illustrative color that gives every chain a unique color with lighter carbons (inspired by David Goodsell's Molecule of the Month style).",oJ=E({},j3);function JUe(e){return oJ}function sJ(e,t){var r=z3(e,t),n=r.color,i=r.legend;function a(s,u){var l=n(s,!1);return u==="C"?at.lighten(l,.8):l}function o(s){if(Ze.is(s)&&Ue.isAtomic(s.unit)){var u=s.unit.model.atomicHierarchy.atoms.type_symbol.value(s.element);return a(s,u)}else if(Vt.isLocation(s)&&Ue.isAtomic(s.aUnit)){var l=s.aUnit.elements[s.aIndex],u=s.aUnit.model.atomicHierarchy.atoms.type_symbol.value(l);return a(s,u)}return QUe}return{factory:sJ,granularity:"group",preferSmoothing:!0,color:o,props:t,description:ZUe,legend:i}}var eje={name:"illustrative",label:"Illustrative",category:"Miscellaneous",factory:sJ,getParams:JUe,defaultValues:I.getDefaultValues(oJ),isApplicable:function(e){return!!e.structure}},tje='Assigns a color to every amino acid according to the "Experimentally determined hydrophobicity scale for proteins at membrane interfaces" by Wimely and White (doi:10.1038/nsb1096-842).',uJ={list:I.ColorList("red-yellow-green",{presetKind:"scale"}),scale:I.Select("DGwif",[["DGwif","DG water-membrane"],["DGwoct","DG water-octanol"],["Oct-IF","DG difference"]])};function rje(e){return uJ}var nje={DGwif:0,DGwoct:1,"Oct-IF":2};function ije(e,t){var r=GM[e];return r===void 0?0:r[t]}function ij(e,t){return e.model.atomicHierarchy.atoms.label_comp_id.value(t)}function aj(e,t){var r=e.coarseElements.seq_id_begin.value(t),n=e.coarseElements.seq_id_end.value(t);if(r===n){var i=e.coarseElements.entityKey[t],a=e.model.sequence.byEntityKey[i].sequence;return a.compId.value(r-1)}}function lJ(e,t){var r=nje[t.scale],n=1/0,i=-1/0;for(var a in GM){var o=GM[a][r];n=Math.min(n,o),i=Math.max(i,o)}var s=Pu.create({listOrName:t.list.colors,domain:[i,n],minLabel:"Hydrophobic",maxLabel:"Hydrophilic"});function u(l){var c;return Ze.is(l)?Ue.isAtomic(l.unit)?c=ij(l.unit,l.element):c=aj(l.unit,l.element):Vt.isLocation(l)&&(Ue.isAtomic(l.aUnit)?c=ij(l.aUnit,l.aUnit.elements[l.aIndex]):c=aj(l.aUnit,l.aUnit.elements[l.aIndex])),s.color(c?ije(c,r):0)}return{factory:lJ,granularity:"group",preferSmoothing:!0,color:u,props:t,description:tje,legend:s?s.legend:void 0}}var aje={name:"hydrophobicity",label:"Hydrophobicity",category:"Residue Property",factory:lJ,getParams:rje,defaultValues:I.getDefaultValues(uJ),isApplicable:function(e){return!!e.structure}},oj=at(13421772),oje="Gives every model a unique color based on the position (index) of the model in the list of models in the structure.",cJ=E({},is({type:"colors",colorList:"purples"}));function sje(e){return cJ}function dJ(e,t){var r,n,i,a;if(e.structure){for(var o=e.structure.root.models,s=0,u=0,l=o;u<l.length;u++){var c=l[u];s=Math.max(s,((r=Wt.TrajectoryInfo.get(c))===null||r===void 0?void 0:r.size)||0)}var d=Gs(s,t);a=d.legend;for(var f=new Map,h=0,v=o.length;h<v;++h){var p=((n=Wt.TrajectoryInfo.get(o[h]))===null||n===void 0?void 0:n.index)||0;f.set(p,d.color(p))}i=function(m){return Ze.is(m)?f.get(Wt.TrajectoryInfo.get(m.unit.model).index):Vt.isLocation(m)?f.get(Wt.TrajectoryInfo.get(m.aUnit.model).index):oj}}else i=function(){return oj};return{factory:dJ,granularity:"instance",color:i,props:t,description:oje,legend:a}}var uje={name:"model-index",label:"Model Index",category:"Chain Property",factory:dJ,getParams:sje,defaultValues:I.getDefaultValues(cJ),isApplicable:function(e){return!!e.structure&&e.structure.elementCount>0&&Wt.TrajectoryInfo.get(e.structure.models[0]).size>1}},lje=at(13421772),cje="Assigns a color based on the occupancy of an atom.",fJ={domain:I.Interval([0,1]),list:I.ColorList("purples",{presetKind:"scale"})};function dje(e){return fJ}function sj(e,t){return Ue.isAtomic(e)?e.model.atomicConformation.occupancy.value(t):0}function hJ(e,t){var r=Pu.create({reverse:!1,domain:t.domain,listOrName:t.list.colors});function n(i){return Ze.is(i)?r.color(sj(i.unit,i.element)):Vt.isLocation(i)?r.color(sj(i.aUnit,i.aUnit.elements[i.aIndex])):lje}return{factory:hJ,granularity:"group",preferSmoothing:!0,color:n,props:t,description:cje,legend:r?r.legend:void 0}}var fje={name:"occupancy",label:"Occupancy",category:"Atom Property",factory:hJ,getParams:dje,defaultValues:I.getDefaultValues(fJ),isApplicable:function(e){return!!e.structure&&e.structure.models.some(function(t){return t.atomicConformation.occupancy.isDefined})}},L5="dark-2",uj=at(13421772),hje="Assigns a color based on the operator HKL value of a transformed chain.",pJ=E({},is({type:"colors",colorList:L5}));function pje(e){var t=I.clone(pJ);return e.structure&&vJ(e.structure.root).map.size>mo[L5].list.length&&(t.palette.defaultValue.name="colors",t.palette.defaultValue.params=E(E({},t.palette.defaultValue.params),{list:{kind:"interpolate",colors:Os(L5).list}})),t}var Cy=1e4;function N5(e){return e.map(function(t){return(""+(t+Cy)).padStart(5,"0")}).join("")}function F5(e){var t=BIe(Cy,0),r=parseInt(e.substr(0,t)),n=parseInt(e.substr(t,t)),i=parseInt(e.substr(t+t,t));return[r-Cy,n-Cy,i-Cy]}function sT(e){return e.map(function(t){return t+5}).join("")}function vJ(e){for(var t=new Map,r=new Set,n=0,i=e.units.length;n<i;++n){var a=N5(e.units[n].conformation.operator.hkl);r.add(a)}var o=Array.from(r.values()).sort();o.forEach(function(l){return t.set(l,t.size)});var s=F5(o[0]),u=F5(o[o.length-1]);return{min:s,max:u,map:t}}function mJ(e,t){var r,n;if(e.structure){var i=vJ(e.structure.root),a=i.min,o=i.max,s=i.map,u=[];s.forEach(function(d,f){var h=d%s.size,v=sT(F5(f));u[h]===void 0?u[h]=v:u[h]+=", "+v});var l={minLabel:sT(a),maxLabel:sT(o),valueLabel:function(d){return u[d]}},c=Gs(s.size,t,l);n=c.legend,r=function(d){var f=void 0;if(Ze.is(d)){var h=N5(d.unit.conformation.operator.hkl);f=s.get(h)}else if(Vt.isLocation(d)){var h=N5(d.aUnit.conformation.operator.hkl);f=s.get(h)}return f===void 0?uj:c.color(f)}}else r=function(){return uj};return{factory:mJ,granularity:"instance",color:r,props:t,description:hje,legend:n}}var vje={name:"operator-hkl",label:"Operator HKL",category:"Symmetry",factory:mJ,getParams:pje,defaultValues:I.getDefaultValues(pJ),isApplicable:function(e){return!!e.structure}},uT=at(16777113),mje="Assigns a color based on the partial charge of an atom.",gJ={domain:I.Interval([-1,1]),list:I.ColorList("red-white-blue",{presetKind:"scale"})};function gje(e){return gJ}function lj(e,t){var r;return(r=Tg.Provider.get(e.model))===null||r===void 0?void 0:r.data.value(t)}function yJ(e,t){var r=Pu.create({domain:t.domain,listOrName:t.list.colors});function n(i){if(Ze.is(i)){var a=lj(i.unit,i.element);return a!==void 0?r.color(a):uT}else if(Vt.isLocation(i)){var a=lj(i.aUnit,i.aUnit.elements[i.aIndex]);return a!==void 0?r.color(a):uT}return uT}return{factory:yJ,granularity:"group",preferSmoothing:!0,color:n,props:t,description:mje,legend:r?r.legend:void 0}}var yje={name:"partial-charge",label:"Partial Charge",category:"Atom Property",factory:yJ,getParams:gje,defaultValues:I.getDefaultValues(gJ),isApplicable:function(e){return!!e.structure&&e.structure.models.some(function(t){return Tg.Provider.get(t)!==void 0})}},bje="many-distinct",cj=at(16448250),xje="Gives every atom a color based on its `label_atom_id` value.",bJ=E({},is({type:"colors",colorList:bje}));function Sje(e){var t=I.clone(bJ);return t}function Cje(e){for(var t=new Map,r=0,n=e.models;r<n.length;r++)for(var i=n[r],a=i.atomicHierarchy.atoms.label_atom_id,o=0,s=a.rowCount;o<s;++o){var u=a.value(o);t.has(u)||t.set(u,t.size)}return t}function xJ(e,t){var r,n;if(e.structure){var i=Ze.create(e.structure.root),a=Cje(e.structure.root),o=Array.from(a.keys()),s=function(l){return o[l]},u=Gs(a.size,t,{valueLabel:s});n=u.legend,r=function(l){var c=void 0;if(Ze.is(l)){var d=lt.atom.label_atom_id(l);c=a.get(d)}else if(Vt.isLocation(l)){i.unit=l.aUnit,i.element=l.aUnit.elements[l.aIndex];var d=lt.atom.label_atom_id(i);c=a.get(d)}return c===void 0?cj:u.color(c)}}else r=function(){return cj};return{factory:xJ,granularity:"group",preferSmoothing:!0,color:r,props:t,description:xje,legend:n}}var _je={name:"atom-id",label:"Atom Id",category:"Atom Property",factory:xJ,getParams:Sje,defaultValues:I.getDefaultValues(bJ),isApplicable:function(e){return!!e.structure}},wje="many-distinct",dj=at(16448250),Eje="Gives every chain a color based on its `label_entity_id` value.",SJ=E({},is({type:"colors",colorList:wje}));function Aje(e){var t=I.clone(SJ);return t}function B5(e,t){return e+"|"+t}function Pje(e){for(var t=new Map,r=0,n=e.models.length;r<n;++r)for(var i=e.models[r].atomicHierarchy.chains.label_entity_id,a=0,o=i.rowCount;a<o;++a){var s=B5(i.value(a),r);t.has(s)||t.set(s,t.size)}return t}function CJ(e,t){var r,n;if(e.structure){var i=Ze.create(e.structure.root),a=Pje(e.structure.root),o=Array.from(a.keys()),s=function(l){return o[l]},u=Gs(a.size,t,{valueLabel:s});n=u.legend,r=function(l){var c=void 0;if(Ze.is(l)){var d=lt.chain.label_entity_id(l),f=l.structure.models.indexOf(l.unit.model),h=B5(d,f);c=a.get(h)}else if(Vt.isLocation(l)){i.unit=l.aUnit,i.element=l.aUnit.elements[l.aIndex];var d=lt.chain.label_entity_id(i),f=i.structure.models.indexOf(i.unit.model),h=B5(d,f);c=a.get(h)}return c===void 0?dj:u.color(c)}}else r=function(){return dj};return{factory:CJ,granularity:"group",color:r,props:t,description:Eje,legend:n}}var Tje={name:"entity-id",label:"Entity Id",category:"Chain Property",factory:CJ,getParams:Aje,defaultValues:I.getDefaultValues(SJ),isApplicable:function(e){return!!e.structure}},jc;(function(e){e.PaletteScale=(1<<24)-1,e.EmptyFactory=function(){return e.Empty};var t=at(13421772);e.Empty={factory:e.EmptyFactory,granularity:"uniform",color:function(){return t},props:{}};function r(i,a){return i.contextHash===a.contextHash&&i.factory===a.factory&&Mc(i.props,a.props)}e.areEqual=r,e.EmptyProvider={name:"",label:"",category:"",factory:e.EmptyFactory,getParams:function(){return{}},defaultValues:{},isApplicable:function(){return!0}};function n(){return new AJ(e.BuiltIn,e.EmptyProvider)}e.createRegistry=n,e.BuiltIn={"atom-id":_je,"carbohydrate-symbol":J9e,"chain-id":RZ,"element-index":dUe,"element-symbol":bUe,"entity-id":Tje,"entity-source":KUe,hydrophobicity:aje,illustrative:eje,"model-index":uje,"molecule-type":CUe,occupancy:fje,"operator-hkl":vje,"operator-name":LO,"partial-charge":yje,"polymer-id":EUe,"polymer-index":TUe,"residue-name":DUe,"secondary-structure":OUe,"sequence-id":BUe,"shape-group":i8e,uncertainty:qUe,"unit-index":zUe,uniform:LTe}})(jc||(jc={}));var Ije=1,Mje="Assigns a physical size, i.e. vdW radius for atoms or given radius for coarse spheres.",_J={scale:I.Numeric(1,{min:.1,max:5,step:.1})};function Dje(e){return _J}function lT(e,t){return Ue.isAtomic(e)?Pb(e.model.atomicHierarchy.atoms.type_symbol.value(t)):Ue.isSpheres(e)?e.model.coarseConformation.spheres.radius[t]:0}function Ob(e,t){var r=t.scale===void 0?1:t.scale;function n(i){var a;return Ze.is(i)?a=r*lT(i.unit,i.element):Vt.isLocation(i)?a=r*Math.min(lT(i.aUnit,i.aUnit.elements[i.aIndex]),lT(i.bUnit,i.bUnit.elements[i.bIndex])):a=r*Ije,a}return{factory:Ob,granularity:"group",size:n,props:t,description:Mje}}var Rje={name:"physical",label:"Physical",category:"",factory:Ob,getParams:Dje,defaultValues:I.getDefaultValues(_J),isApplicable:function(e){return!!e.structure}},kje="Assigns a size reflecting the uncertainty or disorder of an element's position, e.g. B-factor or RMSF, depending on the data availability and experimental technique.",wJ={bfactorFactor:I.Numeric(.1,{min:0,max:1,step:.01}),rmsfFactor:I.Numeric(.05,{min:0,max:1,step:.01}),baseSize:I.Numeric(.2,{min:0,max:2,step:.1})};function Oje(e){return wJ}function fj(e,t,r){return Ue.isAtomic(e)?e.model.atomicConformation.B_iso_or_equiv.value(t)*r.bfactorFactor:Ue.isSpheres(e)?e.model.coarseConformation.spheres.rmsf[t]*r.rmsfFactor:0}function EJ(e,t){function r(n){var i=t.baseSize;return Ze.is(n)?i+=fj(n.unit,n.element,t):Vt.isLocation(n)&&(i+=fj(n.aUnit,n.aUnit.elements[n.aIndex],t)),i}return{factory:EJ,granularity:"group",size:r,props:t,description:kje}}var Lje={name:"uncertainty",label:"Uncertainty/Disorder",category:"",factory:EJ,getParams:Oje,defaultValues:I.getDefaultValues(wJ),isApplicable:function(e){return!!e.structure&&e.structure.models.some(function(t){return t.atomicConformation.B_iso_or_equiv.isDefined||t.coarseHierarchy.isDefined})}},Hi;(function(e){e.EmptyFactory=function(){return e.Empty},e.Empty={factory:e.EmptyFactory,granularity:"uniform",size:function(){return 1},props:{}};function t(n,i){return n.factory===i.factory&&Mc(n.props,i.props)}e.areEqual=t,e.EmptyProvider={name:"",label:"",category:"",factory:e.EmptyFactory,getParams:function(){return{}},defaultValues:{},isApplicable:function(){return!0}};function r(){return new AJ(e.BuiltIn,e.EmptyProvider)}e.createRegistry=r,e.BuiltIn={physical:Rje,"shape-group":e8e,uncertainty:Lje,uniform:BTe}})(Hi||(Hi={}));var hi;(function(e){function t(a,o,s,u){u=u||r();var l=s.colorTheme,c=s.sizeTheme;return u.color=a.colorThemeRegistry.create(l.name,o,l.params),u.size=a.sizeThemeRegistry.create(c.name,o,c.params),u}e.create=t;function r(){return{color:jc.Empty,size:Hi.Empty}}e.createEmpty=r;function n(a,o,s,u){var l,c;return ce(this,void 0,void 0,function(){return de(this,function(d){switch(d.label){case 0:return[4,(l=o.colorThemeRegistry.get(u.colorTheme.name).ensureCustomProperties)===null||l===void 0?void 0:l.attach(a,s)];case 1:return d.sent(),[4,(c=o.sizeThemeRegistry.get(u.sizeTheme.name).ensureCustomProperties)===null||c===void 0?void 0:c.attach(a,s)];case 2:return d.sent(),[2]}})})}e.ensureDependencies=n;function i(a,o,s){var u,l;(u=a.colorThemeRegistry.get(s.colorTheme.name).ensureCustomProperties)===null||u===void 0||u.detach(o),(l=a.sizeThemeRegistry.get(s.sizeTheme.name).ensureCustomProperties)===null||l===void 0||l.detach(o)}e.releaseDependencies=i})(hi||(hi={}));function hj(e){return e.map(function(t){return[t.name,t.provider.label,t.provider.category]})}var AJ=function(){function e(t,r){var n=this;this.emptyProvider=r,this._list=[],this._map=new Map,this._name=new Map,Iu(t,function(i,a){if(i.name!==a)throw new Error("Fix build in themes to have matching names. "+i.name+" "+a);n.add(i)})}return Object.defineProperty(e.prototype,"default",{get:function(){return this._list[0]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"list",{get:function(){return this._list},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"types",{get:function(){return hj(this._list)},enumerable:!1,configurable:!0}),e.prototype.sort=function(){this._list.sort(function(t,r){return t.provider.category===r.provider.category?t.provider.label<r.provider.label?-1:t.provider.label>r.provider.label?1:0:t.provider.category<r.provider.category?-1:1})},e.prototype.add=function(t){if(this._map.has(t.name))throw new Error(t.name+" already registered.");var r=t.name;this._list.push({name:r,provider:t}),this._map.set(r,t),this._name.set(t,r),this.sort()},e.prototype.remove=function(t){this._list.splice(this._list.findIndex(function(n){return n.name===t.name}),1);var r=this._map.get(t.name);r&&(this._map.delete(t.name),this._name.delete(r))},e.prototype.has=function(t){return this._map.has(t.name)},e.prototype.get=function(t){return this._map.get(t)||this.emptyProvider},e.prototype.getName=function(t){if(!this._name.has(t))throw new Error("'"+t.label+"' is not a registered theme provider.");return this._name.get(t)},e.prototype.create=function(t,r,n){n===void 0&&(n={});var i=this.get(t);return i.factory(r,E(E({},I.getDefaultValues(i.getParams(r))),n))},e.prototype.getApplicableList=function(t){return this._list.filter(function(r){return r.provider.isApplicable(t)})},e.prototype.getApplicableTypes=function(t){return hj(this.getApplicableList(t))},e}();function V3(e){return Object.keys(e)}function U5(e){throw new Error("unreachable")}function NO(e){return typeof(e==null?void 0:e.then)=="function"}var tr;(function(e){e[e.None=0]="None",e[e.Highlight=1]="Highlight",e[e.RemoveHighlight=2]="RemoveHighlight",e[e.Select=4]="Select",e[e.Deselect=8]="Deselect",e[e.Toggle=16]="Toggle",e[e.Clear=32]="Clear"})(tr||(tr={}));var So;(function(e){e.is=da.has,e.All=tr.Highlight|tr.RemoveHighlight|tr.Select|tr.Deselect|tr.Toggle|tr.Clear,e.Highlighting=tr.Highlight|tr.RemoveHighlight|tr.Clear,e.Selecting=tr.Select|tr.Deselect|tr.Toggle|tr.Clear})(So||(So={}));function m_(e,t,r){switch(r){case tr.Highlight:e[t]|=1;break;case tr.RemoveHighlight:e[t]&=-2;break;case tr.Select:e[t]|=2;break;case tr.Deselect:e[t]&=-3;break;case tr.Toggle:e[t]^=2;break;case tr.Clear:e[t]=0;break}}function ku(e,t,r){if(r===tr.None)return!1;if(Te.is(t)){var n=Te.start(t),i=Te.end(t),a=new Uint32Array(e.buffer,0,e.buffer.byteLength>>2),o=n+3>>2,s=o+(i-4*o>>2),u=n,l=Math.min(4*o,i),c=Math.max(n,4*s),d=i;switch(r){case tr.Highlight:for(var f=o;f<s;++f)a[f]|=16843009;break;case tr.RemoveHighlight:for(var f=o;f<s;++f)a[f]&=-16843010;break;case tr.Select:for(var f=o;f<s;++f)a[f]|=33686018;break;case tr.Deselect:for(var f=o;f<s;++f)a[f]&=-33686019;break;case tr.Toggle:for(var f=o;f<s;++f)a[f]^=33686018;break;case tr.Clear:for(var f=o;f<s;++f)a[f]=0;break;default:U5()}for(var f=u;f<l;++f)m_(e,f,r);for(var f=c;f<d;++f)m_(e,f,r)}else switch(r){case tr.Highlight:for(var f=0,h=t.length;f<h;++f)e[t[f]]|=1;break;case tr.RemoveHighlight:for(var f=0,h=t.length;f<h;++f)e[t[f]]&=-2;break;case tr.Select:for(var f=0,h=t.length;f<h;++f)e[t[f]]|=2;break;case tr.Deselect:for(var f=0,h=t.length;f<h;++f)e[t[f]]&=-3;break;case tr.Toggle:for(var f=0,h=t.length;f<h;++f)e[t[f]]^=2;break;case tr.Clear:for(var f=0,h=t.length;f<h;++f)e[t[f]]=0;break;default:U5()}return!0}var Nje={kind:"every-loci"};function Ds(e){return!!e&&e.kind==="every-loci"}var Or={kind:"empty-loci"};function xu(e){return!!e&&e.kind==="empty-loci"}function Ky(e){return!!e&&e.kind==="data-loci"}function Fje(e,t){if(!RC(e.data,t.data)||e.tag!==t.tag||e.elements.length!==t.elements.length)return!1;for(var r=0,n=e.elements.length;r<n;++r)if(!RC(e.elements[r],t.elements[r]))return!1;return!0}function Bje(e){return e.elements.length===0}function H3(e,t,r,n,i){return{kind:"data-loci",tag:e,data:t,elements:r,getBoundingSphere:n,getLabel:i}}var ar;(function(e){var t=new rs("98");function r(p){var m=p.loci.map(function(C){return s(C)}).filter(function(C){return!!C});t.reset();for(var g=0,y=m;g<y.length;g++){var b=y[g];t.includePositionRadius(b.center,b.radius)}t.finishedIncludeStep();for(var S=0,x=m;S<x.length;S++){var b=x[S];t.radiusPositionRadius(b.center,b.radius)}return t.getSphere()}e.getBundleBoundingSphere=r;function n(p,m){return Ds(p)&&Ds(m)||xu(p)&&xu(m)?!0:Ky(p)&&Ky(m)?Fje(p,m):$e.isLoci(p)&&$e.isLoci(m)?$e.areLociEqual(p,m):De.is(p)&&De.is(m)?De.areEqual(p,m):Vt.isLoci(p)&&Vt.isLoci(m)?Vt.areLociEqual(p,m):kr.isLoci(p)&&kr.isLoci(m)?kr.areLociEqual(p,m):Ga.isLoci(p)&&Ga.isLoci(m)?Ga.areLociEqual(p,m):Ct.isLoci(p)&&Ct.isLoci(m)?Ct.areLociEqual(p,m):Ct.Isosurface.isLoci(p)&&Ct.Isosurface.isLoci(m)?Ct.Isosurface.areLociEqual(p,m):Ct.Cell.isLoci(p)&&Ct.Cell.isLoci(m)?Ct.Cell.areLociEqual(p,m):!1}e.areEqual=n;function i(p){return!!p&&p.kind==="every-loci"}e.isEvery=i;function a(p){return Ds(p)?!1:xu(p)?!0:Ky(p)?Bje(p):$e.isLoci(p)?$e.isLociEmpty(p):De.is(p)?De.isEmpty(p):Vt.isLoci(p)?Vt.isLociEmpty(p):kr.isLoci(p)?kr.isLociEmpty(p):Ga.isLoci(p)?Ga.isLociEmpty(p):Ct.isLoci(p)?Ct.isLociEmpty(p):Ct.Isosurface.isLoci(p)?Ct.Isosurface.isLociEmpty(p):Ct.Cell.isLoci(p)?Ct.Cell.isLociEmpty(p):!1}e.isEmpty=a;function o(p,m){return m instanceof $e&&(De.is(p)?p=De.remap(p,m):$e.isLoci(p)?p=$e.remapLoci(p,m):Vt.isLoci(p)&&(p=Vt.remapLoci(p,m))),p}e.remap=o;function s(p,m){var g;if(!(p.kind==="every-loci"||p.kind==="empty-loci")){if(m||(m=Fe()),p.kind==="structure-loci")return Fe.copy(m,p.structure.boundary.sphere);if(p.kind==="element-loci")return Fe.copy(m,De.getBoundary(p).sphere);if(p.kind==="bond-loci")return Vt.getBoundingSphere(p,m);if(p.kind==="shape-loci")return Fe.copy(m,p.shape.geometry.boundingSphere);if(p.kind==="group-loci")return Ga.getBoundingSphere(p,m);if(p.kind==="data-loci")return(g=p.getBoundingSphere)===null||g===void 0?void 0:g.call(p,m);if(p.kind==="volume-loci")return Ct.getBoundingSphere(p.volume,m);if(p.kind==="isosurface-loci")return Ct.Isosurface.getBoundingSphere(p.volume,p.isoValue,m);if(p.kind==="cell-loci")return Ct.Cell.getBoundingSphere(p.volume,p.indices,m)}}e.getBoundingSphere=s;var u=Fe.zero();function l(p,m){var g=s(p,u);return g?_.copy(m||_(),g.center):void 0}e.getCenter=l;function c(p){if(!(p.kind==="every-loci"||p.kind==="empty-loci")){if(p.kind==="structure-loci")return De.getPrincipalAxes($e.toStructureElementLoci(p.structure));if(p.kind==="element-loci")return De.getPrincipalAxes(p);if(p.kind==="bond-loci")return;if(p.kind==="shape-loci")return;if(p.kind==="group-loci")return;if(p.kind==="data-loci")return;if(p.kind==="volume-loci")return;if(p.kind==="isosurface-loci")return;if(p.kind==="cell-loci")return}}e.getPrincipalAxes=c;var d={element:function(p){return p},residue:function(p){return De.is(p)?De.extendToWholeResidues(p,!0):p},chain:function(p){return De.is(p)?De.extendToWholeChains(p):p},entity:function(p){return De.is(p)?De.extendToWholeEntities(p):p},model:function(p){return De.is(p)?De.extendToWholeModels(p):p},operator:function(p){return De.is(p)?De.extendToWholeOperators(p):p},structure:function(p){return De.is(p)?$e.toStructureElementLoci(p.structure):Ga.isLoci(p)?kr.Loci(p.shape):p},elementInstances:function(p){return De.is(p)?De.extendToAllInstances(p):p},residueInstances:function(p){return De.is(p)?De.extendToAllInstances(De.extendToWholeResidues(p,!0)):p},chainInstances:function(p){return De.is(p)?De.extendToAllInstances(De.extendToWholeChains(p)):p}};e.GranularityOptions=I.objectToOptions(d,function(p){switch(p){case"element":return"Atom/Coarse Element";case"elementInstances":return["Atom/Coarse Element Instances","With Symmetry"];case"structure":return"Structure/Shape";default:return p.indexOf("Instances")?[zo(p),"With Symmetry"]:zo(p)}});function f(p){return p.replace("Instances","")}e.simpleGranularity=f;function h(p,m){return d[m](p)}e.applyGranularity=h;function v(p,m){return m!=="element"&&Vt.isLoci(p)&&(p=Vt.toStructureElementLoci(p)),$e.isLoci(p)&&(p=$e.toStructureElementLoci(p.structure)),De.is(p)&&(p=De.remap(p,p.structure.root)),m&&(p=h(p,m)),p}e.normalize=v})(ar||(ar={}));function Bi(e){return{layers:e}}(function(e){e.Empty={layers:[]};function t(l,c){if(l.layers.length===0&&c.layers.length===0)return!0;if(l.layers.length!==c.layers.length)return!1;for(var d=0,f=l.layers.length;d<f;++d)if(l.layers[d].clear!==c.layers[d].clear||l.layers[d].color!==c.layers[d].color||!ar.areEqual(l.layers[d].loci,c.layers[d].loci))return!1;return!0}e.areEqual=t;function r(l){return l.layers.length===0}e.isEmpty=r;function n(l,c){for(var d=[],f=0,h=l.layers;f<h.length;f++){var v=h[f],p=v.loci,m=v.color,g=v.clear;p=De.remap(p,c),De.isEmpty(p)||d.push({loci:p,color:m,clear:g})}return{layers:d}}e.remap=n;function i(l){if(r(l))return l;for(var c=l.layers[0].loci.structure,d=new Map,f=De.none(c),h=0,v=l.layers.length;h<v;++h){var p=l.layers[v-h-1],m=p.loci,g=p.color,y=p.clear;if(m=De.subtract(m,f),f=De.union(m,f),!De.isEmpty(m)){var b=y?-1:g;d.has(b)&&(m=De.union(m,d.get(b))),d.set(b,m)}}var S=[];return d.forEach(function(x,C){var w=C===-1,A=C===-1?at(0):C;S.push({loci:x,color:A,clear:w})}),{layers:S}}e.merge=i;function a(l,c){if(r(l))return l;for(var d=l.layers[0].loci.structure,f=[],h=0,v=l.layers;h<v.length;h++){var p=v[h],m=p.loci,g=p.color,y=p.clear,b=De.remap(m,c);m=De.remap(b,d),De.isEmpty(m)||f.push({loci:m,color:g,clear:y})}return{layers:f}}e.filter=a;function o(l,c){for(var d=[],f=0,h=l.length;f<h;++f){var v=l[f],p=v.script,m=v.color,g=v.clear,y=Li.toLoci(p,c);De.isEmpty(y)||d.push({loci:y,color:m,clear:g})}return{layers:d}}e.ofScript=o;function s(l,c){for(var d=[],f=0,h=l.length;f<h;++f){var v=l[f],p=v.bundle,m=v.color,g=v.clear,y=Jr.toLoci(p,c.root);d.push({loci:y,color:m,clear:g})}return{layers:d}}e.ofBundle=s;function u(l){for(var c=[],d=0,f=l.layers.length;d<f;++d){var h=l.layers[d],v=h.loci,p=h.color,m=h.clear,g=Jr.fromLoci(v);c.push({bundle:g,color:p,clear:m})}return{layers:c}}e.toBundle=u})(Bi||(Bi={}));function Ui(e,t){return{kind:e,layers:t}}(function(e){e.Empty={kind:"empty-loci",layers:[]};function t(l,c){if(l.layers.length===0&&c.layers.length===0)return!0;if(l.layers.length!==c.layers.length)return!1;for(var d=0,f=l.layers.length;d<f;++d)if(l.layers[d].value!==c.layers[d].value||!ar.areEqual(l.layers[d].loci,c.layers[d].loci))return!1;return!0}e.areEqual=t;function r(l){return l.layers.length===0}e.isEmpty=r;function n(l,c){if(l.kind==="element-loci"){for(var d=[],f=0,h=l.layers;f<h.length;f++){var v=h[f],p=De.remap(v.loci,c);De.isEmpty(p)||d.push({loci:p,value:v.value})}return{kind:"element-loci",layers:d}}else return l}e.remap=n;function i(l){if(r(l))return l;if(l.kind==="element-loci"){for(var c=l.layers[0].loci.structure,d=new Map,f=De.none(c),h=0,v=l.layers.length;h<v;++h){var p=l.layers[v-h-1],m=p.loci,g=p.value;m=De.subtract(m,f),f=De.union(m,f),De.isEmpty(m)||(d.has(g)&&(m=De.union(m,d.get(g))),d.set(g,m))}var y=[];return d.forEach(function(b,S){y.push({loci:b,value:S})}),{kind:"element-loci",layers:y}}else return l}e.merge=i;function a(l,c){if(r(l))return l;if(l.kind==="element-loci"){for(var d=l.layers[0].loci.structure,f=[],h=0,v=l.layers;h<v.length;h++){var p=v[h],m=p.loci,g=p.value,y=De.remap(m,c);m=De.remap(y,d),De.isEmpty(m)||f.push({loci:m,value:g})}return{kind:"element-loci",layers:f}}else return l}e.filter=a;function o(l,c){for(var d=[],f=0,h=l.length;f<h;++f){var v=l[f],p=v.script,m=v.value,g=Li.toLoci(p,c);De.isEmpty(g)||d.push({loci:g,value:m})}return{kind:"element-loci",layers:d}}e.ofScript=o;function s(l,c){for(var d=[],f=0,h=l.length;f<h;++f){var v=l[f],p=v.bundle,m=v.value,g=Jr.toLoci(p,c.root);d.push({loci:g,value:m})}return{kind:"element-loci",layers:d}}e.ofBundle=s;function u(l){for(var c=[],d=0,f=l.layers.length;d<f;++d){var h=l.layers[d],v=h.loci,p=h.value,m=Jr.fromLoci(v);c.push({bundle:m,value:p})}return{kind:"element-loci",layers:c}}e.toBundle=u})(Ui||(Ui={}));var Pl;(function(e){function t(){return{updateTransform:!1,updateMatrix:!1,updateColor:!1,updateSize:!1,createGeometry:!1,createNew:!1,info:{}}}e.create=t;function r(n){n.updateTransform=!1,n.updateMatrix=!1,n.updateColor=!1,n.updateSize=!1,n.createGeometry=!1,n.createNew=!1}e.reset=r})(Pl||(Pl={}));var Uje={lowestElementCount:1e6,lowerElementCount:5e5,lowElementCount:1e5,mediumElementCount:2e4,highElementCount:2e3,coarseGrainedFactor:10,elementCountFactor:1};function PJ(e,t){t===void 0&&(t={});var r=E(E({},Uje),t),n=e.elementCount*r.elementCountFactor;return e.isCoarseGrained&&(n*=r.coarseGrainedFactor),n>r.lowestElementCount?"lowest":n>r.lowerElementCount?"lower":n>r.lowElementCount?"low":n>r.mediumElementCount?"medium":n>r.highElementCount?"high":"higher"}function jje(e){if(e.root.models.length===1){var t=si.Provider.get(e.root.model);if(t&&t.spacegroup.name==="P 1"&&!xo.isZero(t.spacegroup.cell))return t.spacegroup.cell.volume}return Xt.volume(e.root.boundary.box)}function j5(e,t){var r=Ei(e.quality,"auto"),n=Ei(e.detail,1),i=Ei(e.radialSegments,12),a=Ei(e.linearSegments,8),o=Ei(e.resolution,2),s=Ei(e.probePositions,12),u=Ei(e.doubleSided,!0),l=0;if(r==="auto"){if(t instanceof $e)r=PJ(t.root),l=jje(t);else if(Ct.is(t)){var c=t.grid.cells.space.dimensions,d=c[0],f=c[1],h=c[2];l=d*f*h,r=l<1e7?"medium":"low"}}switch(r){case"highest":n=3,i=36,a=18,o=.1,s=72,u=!0;break;case"higher":n=3,i=28,a=14,o=.3,s=48,u=!0;break;case"high":n=2,i=20,a=10,o=.5,s=36,u=!0;break;case"medium":n=1,i=12,a=8,o=.8,s=24,u=!0;break;case"low":n=0,i=8,a=3,o=1.3,s=24,u=!1;break;case"lower":n=0,i=4,a=2,o=3,s=12,u=!1;break;case"lowest":n=0,i=2,a=1,o=8,s=12,u=!1;break}return o=Math.max(o,l/5e8),o=Math.min(o,20),(e.alpha!==void 0&&e.alpha<1||e.xrayShaded)&&(u=!1),{detail:n,radialSegments:i,linearSegments:a,resolution:o,probePositions:s,doubleSided:u}}var Sr;(function(e){function t(c,d){c&&(c.state.visible=d)}e.setVisibility=t;function r(c,d){c&&(c.state.alphaFactor=d)}e.setAlphaFactor=r;function n(c,d){c&&(c.state.pickable=d)}e.setPickable=n;function i(c,d){c&&(c.state.colorOnly=d)}e.setColorOnly=i;function a(c,d,f,h){if(!c)return!1;var v=c.values,p=v.tMarker,m=v.uGroupCount,g=v.instanceCount,y=m.ref.value*g.ref.value,b=p.ref.value.array,S=!1;return Ds(d)?S=ku(b,Te.ofLength(y),f):xu(d)||(S=h(d,function(x){return ku(b,x,f)},!0)),S&&N.update(p,p.ref.value),S}e.mark=a;function o(c,d,f,h){if(c){var v=c.values,p=v.tOverpaint,m=v.uGroupCount,g=v.instanceCount,y=m.ref.value*g.ref.value;c6e(d.layers.length?y:0,c.values);var b=p.ref.value.array;h&&z9(b,0,y);for(var S=function(w,A){var M=d.layers[w],D=M.loci,k=M.color,R=M.clear,L=function(H){var B=Te.start(H),j=Te.end(H);return R?z9(b,B,j):l6e(b,B,j,k)};f(D,L,!1)},x=0,C=d.layers.length;x<C;++x)S(x);N.update(p,p.ref.value)}}e.setOverpaint=o;function s(c,d,f,h){if(c){var v=c.values,p=v.tTransparency,m=v.transparencyAverage,g=v.uGroupCount,y=v.instanceCount,b=g.ref.value*y.ref.value;h6e(d.layers.length?b:0,c.values);var S=p.ref.value.array;h&&f6e(S,0,b);for(var x=function(A,M){var D=d.layers[A],k=D.loci,R=D.value,L=function(H){var B=Te.start(H),j=Te.end(H);return d6e(S,B,j,R)};f(k,L,!1)},C=0,w=d.layers.length;C<w;++C)x(C);N.update(p,p.ref.value),N.updateIfChanged(m,BQ(S,b))}}e.setTransparency=s;function u(c,d,f,h){if(c){var v=c.values,p=v.tClipping,m=v.uGroupCount,g=v.instanceCount,y=m.ref.value*g.ref.value;m6e(d.layers.length?y:0,c.values);var b=p.ref.value.array;h&&v6e(b,0,y);for(var S=function(w,A){var M=d.layers[w],D=M.loci,k=M.groups,R=function(L){var H=Te.start(L),B=Te.end(L);return p6e(b,H,B,k)};f(D,R,!1)},x=0,C=d.layers.length;x<C;++x)S(x);N.update(p,p.ref.value)}}e.setClipping=u;function l(c,d,f){if(!(!c||!d&&!f)){var h=c.values;d&&(ue.copy(h.matrix.ref.value,d),N.update(h.matrix,h.matrix.ref.value)),f?(h.extraTransform.ref.value.set(f),N.update(h.extraTransform,h.extraTransform.ref.value)):f===null&&(YC(h.extraTransform.ref.value,h.instanceCount.ref.value),N.update(h.extraTransform,h.extraTransform.ref.value)),lK(h);var v=Vi(h.invariantBoundingSphere.ref.value,h.aTransform.ref.value,h.instanceCount.ref.value);N.update(h.boundingSphere,v)}}e.setTransform=l})(Sr||(Sr={}));function rn(e){return{layers:e}}(function(e){e.Empty={layers:[]},function(l){l.is=da.has;function c(p){return da.create(p)}l.create=c,l.Names={one:1,two:2,three:4,four:8,five:16,six:32};function d(p){return p in l.Names}l.isName=d;function f(p){switch(p){case"one":return 1;case"two":return 2;case"three":return 4;case"four":return 8;case"five":return 16;case"six":return 32}}l.fromName=f;function h(p){for(var m=0,g=0,y=p.length;g<y;++g)m|=f(p[g]);return m}l.fromNames=h;function v(p){var m=[];return l.is(p,1)&&m.push("one"),l.is(p,2)&&m.push("two"),l.is(p,4)&&m.push("three"),l.is(p,8)&&m.push("four"),l.is(p,16)&&m.push("five"),l.is(p,32)&&m.push("six"),m}l.toNames=v}(e.Groups||(e.Groups={})),e.Type={none:0,plane:1,sphere:2,cube:3,cylinder:4,infiniteCone:5};function t(l,c){if(l.layers.length===0&&c.layers.length===0)return!0;if(l.layers.length!==c.layers.length)return!1;for(var d=0,f=l.layers.length;d<f;++d)if(l.layers[d].groups!==c.layers[d].groups||!ar.areEqual(l.layers[d].loci,c.layers[d].loci))return!1;return!0}e.areEqual=t;function r(l){return l.layers.length===0}e.isEmpty=r;function n(l,c){for(var d=[],f=0,h=l.layers;f<h.length;f++){var v=h[f],p=v.loci,m=v.groups;p=De.remap(p,c),De.isEmpty(p)||d.push({loci:p,groups:m})}return{layers:d}}e.remap=n;function i(l){if(r(l))return l;for(var c=l.layers[0].loci.structure,d=new Map,f=De.none(c),h=0,v=l.layers.length;h<v;++h){var p=l.layers[v-h-1],m=p.loci,g=p.groups;m=De.subtract(m,f),f=De.union(m,f),De.isEmpty(m)||(d.has(g)&&(m=De.union(m,d.get(g))),d.set(g,m))}var y=[];return d.forEach(function(b,S){y.push({loci:b,groups:S})}),{layers:y}}e.merge=i;function a(l,c){if(r(l))return l;for(var d=l.layers[0].loci.structure,f=[],h=0,v=l.layers;h<v.length;h++){var p=v[h],m=p.loci,g=p.groups,y=De.remap(m,c);m=De.remap(y,d),De.isEmpty(m)||f.push({loci:m,groups:g})}return{layers:f}}e.filter=a;function o(l,c){for(var d=[],f=0,h=l.length;f<h;++f){var v=l[f],p=v.script,m=v.groups,g=Li.toLoci(p,c);De.isEmpty(g)||d.push({loci:g,groups:m})}return{layers:d}}e.ofScript=o;function s(l,c){for(var d=[],f=0,h=l.length;f<h;++f){var v=l[f],p=v.bundle,m=v.groups,g=Jr.toLoci(p,c.root);d.push({loci:g,groups:m})}return{layers:d}}e.ofBundle=s;function u(l){for(var c=[],d=0,f=l.layers.length;d<f;++d){var h=l.layers[d],v=h.loci,p=h.groups,m=Jr.fromLoci(v);c.push({bundle:m,groups:p})}return{layers:c}}e.toBundle=u})(rn||(rn={}));var pj;(function(e){function t(r,n,i){return I.getDefaultValues(r.getParams(n,i))}e.getDetaultParams=t})(pj||(pj={}));var zje={label:"",description:"",factory:function(){return or.Empty},getParams:function(){return{}},defaultValues:{}};function vj(e){return e.map(function(t){return[t.name,t.provider.label]})}var TJ=function(){function e(){this._list=[],this._map=new Map,this._name=new Map}return Object.defineProperty(e.prototype,"default",{get:function(){return this._list[0]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"types",{get:function(){return vj(this._list)},enumerable:!1,configurable:!0}),e.prototype.add=function(t){if(this._map.has(t.name))throw new Error(t.name+" already registered.");this._list.push({name:t.name,provider:t}),this._map.set(t.name,t),this._name.set(t,t.name)},e.prototype.getName=function(t){if(!this._name.has(t))throw new Error("'"+t.label+"' is not a registered represenatation provider.");return this._name.get(t)},e.prototype.remove=function(t){var r=t.name;this._list.splice(this._list.findIndex(function(i){return i.name===r}),1);var n=this._map.get(r);n&&(this._map.delete(r),this._name.delete(n))},e.prototype.get=function(t){return this._map.get(t)||zje},Object.defineProperty(e.prototype,"list",{get:function(){return this._list},enumerable:!1,configurable:!0}),e.prototype.getApplicableList=function(t){return this._list.filter(function(r){return r.provider.isApplicable(t)})},e.prototype.getApplicableTypes=function(t){return vj(this.getApplicableList(t))},e}(),or;(function(e){(function(a){function o(u,l){return u.repr===l.repr&&ar.areEqual(u.loci,l.loci)}a.areEqual=o;function s(u){return ar.isEmpty(u.loci)}a.isEmpty=s,a.Empty={loci:Or}})(e.Loci||(e.Loci={}));function t(){return{visible:!0,alphaFactor:1,pickable:!0,colorOnly:!1,syncManually:!1,transform:ue.identity(),overpaint:Bi.Empty,transparency:Ui.Empty,clipping:rn.Empty,markerActions:So.All}}e.createState=t;function r(a,o){o.visible!==void 0&&(a.visible=o.visible),o.alphaFactor!==void 0&&(a.alphaFactor=o.alphaFactor),o.pickable!==void 0&&(a.pickable=o.pickable),o.colorOnly!==void 0&&(a.colorOnly=o.colorOnly),o.overpaint!==void 0&&(a.overpaint=o.overpaint),o.transparency!==void 0&&(a.transparency=o.transparency),o.clipping!==void 0&&(a.clipping=o.clipping),o.syncManually!==void 0&&(a.syncManually=o.syncManually),o.transform!==void 0&&ue.copy(a.transform,o.transform),o.markerActions!==void 0&&(a.markerActions=o.markerActions)}e.updateState=r,e.StateBuilder={create:t,update:r},e.Empty={label:"",groupCount:0,renderObjects:[],props:{},params:{},updated:new Qn,state:t(),theme:hi.createEmpty(),createOrUpdate:function(){return We.constant("",void 0)},setState:function(){},setTheme:function(){},getLoci:function(){return Or},mark:function(){return!1},destroy:function(){}};function n(a,o,s,u,l){var c=this,d=0,f=new Qn,h=u.create(),v=hi.createEmpty(),p,m,g,y={},b=Object.keys(l).map(function(S,x){y[x]=S;var C=l[S](o,s);return C.setState(h),C});return{label:a,updated:f,get groupCount(){var S=0;if(m)for(var x=m.visuals,C=0,w=b.length;C<w;++C)(!x||x.includes(y[C]))&&(S+=b[C].groupCount);return S},get renderObjects(){var S=[];if(m)for(var x=m.visuals,C=0,w=b.length;C<w;++C)(!x||x.includes(y[C]))&&S.push.apply(S,b[C].renderObjects);return S},get props(){return m},get params(){return p},createOrUpdate:function(S,x){S===void 0&&(S={}),x&&x!==g&&(p=s(o,x),g=x,m||(m=I.getDefaultValues(p)));var C=j5(Object.assign({},m,S),g);Object.assign(m,S,C);var w=m.visuals;return We.create("Creating or updating '"+a+"' representation",function(A){return ce(c,void 0,void 0,function(){var M,D;return de(this,function(k){switch(k.label){case 0:M=0,D=b.length,k.label=1;case 1:return M<D?!w||w.includes(y[M])?[4,b[M].createOrUpdate(m,g).runInContext(A)]:[3,3]:[3,4];case 2:k.sent(),k.label=3;case 3:return++M,[3,1];case 4:return f.next(d++),[2]}})})})},get state(){return h},get theme(){return v},getLoci:function(S){for(var x=m.visuals,C=0,w=b.length;C<w;++C)if(!x||x.includes(y[C])){var A=b[C].getLoci(S);if(!xu(A))return A}return Or},mark:function(S,x){for(var C=!1,w=0,A=b.length;w<A;++w)C=b[w].mark(S,x)||C;return C},setState:function(S){u.update(h,S);for(var x=0,C=b.length;x<C;++x)b[x].setState(h)},setTheme:function(S){for(var x=0,C=b.length;x<C;++x)b[x].setTheme(S)},destroy:function(){for(var S=0,x=b.length;S<x;++S)b[S].destroy()}}}e.createMulti=n;function i(a,o){var s=this,u=0,l=new Qn,c=e.createState(),d=hi.createEmpty(),f=I.clone(Et.Params),h=I.getDefaultValues(Et.Params);return{label:a,updated:l,get groupCount(){return o.values.uGroupCount.ref.value},get renderObjects(){return[o]},get props(){return h},get params(){return f},createOrUpdate:function(v){v===void 0&&(v={});var p=j5(Object.assign({},h,v));return Object.assign(h,v,p),We.create("Updating '"+a+"' representation",function(m){return ce(s,void 0,void 0,function(){return de(this,function(g){return l.next(u++),[2]})})})},get state(){return c},get theme(){return d},getLoci:function(){return Or},mark:function(v,p){return!1},setState:function(v){v.visible!==void 0&&Sr.setVisibility(o,v.visible),v.alphaFactor!==void 0&&Sr.setAlphaFactor(o,v.alphaFactor),v.pickable!==void 0&&Sr.setPickable(o,v.pickable),v.colorOnly!==void 0&&Sr.setColorOnly(o,v.colorOnly),v.overpaint,v.transparency,v.transform!==void 0&&Sr.setTransform(o,v.transform),e.updateState(c,v)},setTheme:function(){},destroy:function(){}}}e.fromRenderObject=i})(or||(or={}));function Pi(e,t,r){r===void 0&&(r={});var n=0,i=new Qn,a=or.createState(),o=hd(),s=[],u,l,c=hi.createEmpty(),d=I.getDefaultValues(t.Params),f,h,v;r.modifyState&&or.updateState(a,r.modifyState(a));var p=Pl.create();function m(b,S){Pl.reset(p),!(!S&&!l)&&(S&&!l?p.createNew=!0:S&&l&&S.id===l.id||(S&&l&&S.id!==l.id?(p.updateTransform=!0,p.createGeometry=!0):S&&console.warn("unexpected state")),p.updateTransform&&(p.updateColor=!0,p.updateSize=!0),p.createGeometry&&(p.updateColor=!0,p.updateSize=!0))}function g(b,S){var x=this;return b===void 0&&(b={}),r.modifyProps&&(b=r.modifyProps(b)),We.create("ShapeRepresentation.create",function(C){return ce(x,void 0,void 0,function(){var w,A,M,D,k,R,L,H;return de(this,function(B){switch(B.label){case 0:return w=Object.assign(d,b),S?[4,e(C,S,w,l)]:[3,2];case 1:return M=B.sent(),[3,3];case 2:M=void 0,B.label=3;case 3:if(A=M,m(b,A),A&&(l=A,Object.assign(c,kr.getTheme(l))),p.createNew)s.length=0,h=kr.groupIterator(l),D=kr.createTransform(l.transforms),k=t.createValues(l.geometry,D,h,c,w),R=t.createRenderableState(w),r.modifyState&&Object.assign(R,r.modifyState(R)),or.updateState(a,R),u=r0(l.geometry.kind,k,R,o),u&&s.push(u),v=t.createPositionIterator(l.geometry,u.values);else{if(!u)throw new Error("expected renderObject to be available");p.updateTransform&&(kr.createTransform(l.transforms,u.values),h=kr.groupIterator(l),L=h.instanceCount,H=h.groupCount,Hs(L*H,u.values)),p.createGeometry&&(N.updateIfChanged(u.values.drawCount,ra.getDrawCount(l.geometry)),N.updateIfChanged(u.values.uVertexCount,ra.getVertexCount(l.geometry))),(p.updateTransform||p.createGeometry)&&(t.updateBoundingSphere(u.values,l.geometry),v=t.createPositionIterator(l.geometry,u.values)),p.updateColor&&ns(h,v,c.color,u.values),p.updateSize&&"uSize"in u.values&&nd(h,c.size,u.values),t.updateValues(u.values,w),t.updateRenderableState(u.state,w)}return d=w,i.next(n++),[2]}})})})}function y(b,S){return Ds(b)||kr.isLoci(b)&&b.shape===l?S(Te.ofBounds(0,l.groupCount*l.transforms.length)):Vje(b,l,S)}return{label:"Shape geometry",get groupCount(){return h?h.count:0},get props(){return d},get params(){return f},get state(){return a},get theme(){return c},renderObjects:s,updated:i,createOrUpdate:g,getLoci:function(b){if(b===void 0)return kr.Loci(l);var S=b.objectId,x=b.groupId,C=b.instanceId;return u&&u.id===S?Ga.Loci(l,[{ids:Oe.ofSingleton(x),instance:C}]):Or},mark:function(b,S){if(!So.is(a.markerActions,S))return!1;if(Ga.isLoci(b)||kr.isLoci(b)){if(b.shape!==l)return!1}else if(!Ds(b))return!1;return Sr.mark(u,b,S,y)},setState:function(b){r.modifyState&&(b=r.modifyState(b)),u&&(b.visible!==void 0&&Sr.setVisibility(u,b.visible),b.alphaFactor!==void 0&&Sr.setAlphaFactor(u,b.alphaFactor),b.pickable!==void 0&&Sr.setPickable(u,b.pickable),b.colorOnly!==void 0&&Sr.setColorOnly(u,b.colorOnly),b.overpaint!==void 0&&Sr.setOverpaint(u,b.overpaint,y,!0),b.transparency!==void 0&&Sr.setTransparency(u,b.transparency,y,!0),b.transform!==void 0&&Sr.setTransform(u,b.transform)),or.updateState(a,b)},setTheme:function(b){Mr&&console.warn("The `ShapeRepresentation` theme is fixed to `ShapeGroupColorTheme` and `ShapeGroupSizeTheme`. Colors are taken from `Shape.getColor` and sizes from `Shape.getSize`")},destroy:function(){s.length=0,u&&(u.state.disposed=!0,u=void 0)}}}function Vje(e,t,r){if(!Ga.isLoci(e)||e.shape!==t)return!1;for(var n=!1,i=t.groupCount,a=e.groups,o=0,s=a;o<s.length;o++){var u=s[o],l=u.ids,c=u.instance;if(Te.is(l)){var d=c*i+Te.start(l),f=c*i+Te.end(l);r(Te.ofBounds(d,f))&&(n=!0)}else for(var h=0,v=l.length;h<v;h++){var p=c*i+l[h];r(Te.ofSingleton(p))&&(n=!0)}}return n}var mj=ue(),Ig=function(){function e(t){this.structure=t,this.groupUnitTransforms=[],this.unitOffsetMap=Ls.Mutable(),this.groupIndexMap=Ls.Mutable(),this._isIdentity=void 0,this.version=0,this.unitTransforms=new Float32Array(t.units.length*16),this.size=t.units.length,this.reset();for(var r=0,n=0,i=t.unitSymmetryGroups.length;n<i;++n){var a=t.unitSymmetryGroups[n];this.groupIndexMap.set(a.hashCode,n);var o=this.unitTransforms.subarray(r,r+a.units.length*16);this.groupUnitTransforms.push(o);for(var s=0,u=a.units.length;s<u;++s)this.unitOffsetMap.set(a.units[s].id,r+s*16);r+=a.units.length*16}}return e.prototype.reset=function(){this.version=0,YC(this.unitTransforms,this.size),this._isIdentity=!0},Object.defineProperty(e.prototype,"isIdentity",{get:function(){if(this._isIdentity===void 0){this._isIdentity=!0;for(var t=0,r=this.size*16;t<r;t+=16)if(ue.fromArray(mj,this.unitTransforms,t),!ue.isIdentity(mj)){this._isIdentity=!1;break}}return this._isIdentity},enumerable:!1,configurable:!0}),e.prototype.setTransform=function(t,r){this.version=(this.version+1)%2147483647,ue.toArray(t,this.unitTransforms,this.unitOffsetMap.get(r.id)),this._isIdentity=void 0},e.prototype.getTransform=function(t,r){return ue.fromArray(t,this.unitTransforms,this.unitOffsetMap.get(r.id))},e.prototype.getSymmetryGroupTransforms=function(t){return this.groupUnitTransforms[this.groupIndexMap.get(t.hashCode)]},e}(),gj=ue.zero();function yj(e,t,r){for(var n=0,i=e.units.length;n<i;n++){var a=e.units[n];pn.lerpFromIdentity(gj,a.conformation.operator,r),t.setTransform(gj,a)}}var bj=_.zero(),Pm=_.zero(),g_=ue.zero();function xj(e,t,r){for(var n=e.boundary.sphere,i=n.radius*r,a=0,o=e.units.length;a<o;a++){var s=e.units[a];_.transformMat4(bj,s.lookup3d.boundary.sphere.center,s.conformation.operator.matrix),_.sub(Pm,bj,n.center),_.setMagnitude(Pm,Pm,i),ue.fromTranslation(g_,Pm),t.setTransform(g_,s)}}var Hje={axis:I.MappedStatic("custom",{structure:I.Group({principalAxis:I.Select("dirA",[["dirA","A"],["dirB","B"],["dirC","C"]])}),custom:I.Group({vector:I.Vec3(_.create(0,0,1))})}),origin:I.MappedStatic("structure",{structure:I.Group({}),custom:I.Group({vector:I.Vec3(_.create(0,0,0))})})};function Sj(e,t){var r,n;if(t.axis.name==="custom")r=t.axis.params.vector;else{var i=$e.getPrincipalAxes(e);r=i.momentsAxes[t.axis.params.principalAxis]}if(t.origin.name==="custom")n=t.origin.params.vector;else{var i=$e.getPrincipalAxes(e);n=i.momentsAxes.origin}return{axis:r,origin:n}}var Cj=ue(),_j=ue(),sx=ue();function wj(e,t,r,n,i){for(var a=0,o=e.units.length;a<o;a++){var s=e.units[a];_.negate(Pm,i),ue.fromTranslation(g_,Pm),ue.fromRotation(Cj,Math.PI*r*2,n),ue.fromTranslation(_j,i),ue.mul(sx,Cj,g_),ue.mul(sx,_j,sx),t.setTransform(sx,s)}}var Gje=ue.fromTranslation(ue(),_.create(.5,.5,.5)),qje=zQ(jQ(HQ()),Gje),Ks=_(),Ej=ue(),Wje={origin:"Origin",model:"Model"},$je={corner:"Corner",center:"Center"},Xje=E(E({},Nt.Params),{cellColor:I.Color(dr.orange),cellScale:I.Numeric(2,{min:.1,max:5,step:.1}),ref:I.Select("model",I.objectToOptions(Wje),{isEssential:!0}),attachment:I.Select("corner",I.objectToOptions($je),{isEssential:!0})}),Yje={mesh:function(e,t){return Pi(Qje,Nt.Utils)}},Aj=E({},Xje);function Kje(e,t,r){var n=wt.createState(256,128,r),i=e.symmetry.spacegroup.cell.fromFractional;_.copy(Ks,e.ref),t.attachment==="center"?(_.trunc(Ks,Ks),_.subScalar(Ks,Ks,.5)):_.floor(Ks,Ks),ue.fromTranslation(Ej,Ks);var a=zQ(jQ(qje),Ej),o=Math.cbrt(e.symmetry.spacegroup.cell.volume)/300*t.cellScale;n.currentGroup=1,wt.addCage(n,i,a,o,2,20);var s=Fe.fromDimensionsAndTransform(Fe(),_.unit,i);_.transformMat4(Ks,Ks,i),Fe.translate(s,s,Ks),Fe.expand(s,s,o);var u=wt.getMesh(n);return u.setBoundingSphere(s),u}function Qje(e,t,r,n){var i=Kje(t,r,n&&n.geometry),a=X1.getUnitcellLabel(t.symmetry);return kr.create(a,t,i,function(){return r.cellColor},function(){return 1},function(){return a})}function Pj(e,t,r){var n=_();return r.ref==="model"&&_.transformMat4(n,Wt.getCenter(e),t.spacegroup.cell.toFractional),{symmetry:t,ref:n}}function Zje(e,t){return or.createMulti("Unit Cell",e,t,or.StateBuilder,Yje)}var ls=new Uint16Array([0,1,2,1,3,2]),wh=qe.add3,Yi=qe.add2,Tj=qe.add,zc;(function(e){function t(r,n,i,a){r===void 0&&(r={}),n===void 0&&(n=2048),i===void 0&&(i=1024),n*=2,i*=2;var o=qe.create(Float32Array,3,i,a?a.centerBuffer.ref.value:n),s=qe.create(Float32Array,2,i,a?a.mappingBuffer.ref.value:n),u=qe.create(Float32Array,1,i,a?a.depthBuffer.ref.value:n),l=qe.create(Uint32Array,3,i,a?a.indexBuffer.ref.value:n),c=qe.create(Float32Array,1,i,a?a.groupBuffer.ref.value:n),d=qe.create(Float32Array,2,i,a?a.tcoordBuffer.ref.value:n),f=E(E({},I.getDefaultValues(Bs.Params)),r),h=f.attachment,v=f.background,p=f.backgroundMargin,m=f.tether,g=f.tetherLength,y=f.tetherBaseWidth,b=g6e(f),S=1/2.5*p,x=b.buffer/b.lineHeight,C=function(w,A,M,D,k){wh(o,w,A,M),Tj(u,D),Tj(c,k)};return{add:function(w,A,M,D,k,R,L){for(var H=0,B=w.length,j=0;j<B;++j){var Q=b.get(w[j]);H+=Q.nw-2*x}var G=1/1.25,W,q;if(h.startsWith("top")?W=G:h.startsWith("middle")?W=G/2:W=0,h.endsWith("right")?q=H:h.endsWith("center")?q=H/2:q=0,m)switch(h){case"bottom-left":q-=g/2+S+.1,W-=g/2+S;break;case"bottom-center":W-=g+S;break;case"bottom-right":q+=g/2+S+.1,W-=g/2+S;break;case"middle-left":q-=g+S+.1;break;case"middle-center":break;case"middle-right":q+=g+S+.1;break;case"top-left":q-=g/2+S+.1,W+=g/2+S;break;case"top-center":W+=g+S;break;case"top-right":q+=g/2+S+.1,W+=g/2+S;break}var ee=(-q-S-.1)*R,he=(H-q+S+.1)*R,$=(G-W+S)*R,X=(-W-S)*R;if(v){Yi(s,ee,$),Yi(s,ee,X),Yi(s,he,$),Yi(s,he,X);for(var U=o.elementCount,z=0;z<4;++z)Yi(d,10,10),C(A,M,D,k,L);wh(l,U+ls[0],U+ls[1],U+ls[2]),wh(l,U+ls[3],U+ls[4],U+ls[5])}if(m){var J=void 0,Y=void 0,Z=void 0,te=void 0,le=void 0,ye=void 0,be=void 0,Ee=void 0,Se=g*R,ie=y*R;switch(h){case"bottom-left":J=ee-Se/2,Z=ee+ie/2,le=ee,be=ee,Y=X-Se/2,te=X,ye=X+ie/2,Ee=X;break;case"bottom-center":J=0,Z=ie/2,le=-ie/2,be=0,Y=X-Se,te=X,ye=X,Ee=X;break;case"bottom-right":J=he+Se/2,Z=he,le=he-ie/2,be=he,Y=X-Se/2,te=X+ie/2,ye=X,Ee=X;break;case"middle-left":J=ee-Se,Z=ee,le=ee,be=ee,Y=0,te=-ie/2,ye=ie/2,Ee=0;break;case"middle-center":J=0,Z=0,le=0,be=0,Y=0,te=0,ye=0,Ee=0;break;case"middle-right":J=he+Se,Z=he,le=he,be=he,Y=0,te=ie/2,ye=-ie/2,Ee=0;break;case"top-left":J=ee-Se/2,Z=ee+ie/2,le=ee,be=ee,Y=$+Se/2,te=$,ye=$-ie/2,Ee=$;break;case"top-center":J=0,Z=ie/2,le=-ie/2,be=0,Y=$+Se,te=$,ye=$,Ee=$;break;case"top-right":J=he+Se/2,Z=he,le=he-ie/2,be=he,Y=$+Se/2,te=$-ie/2,ye=$,Ee=$;break;default:throw new Error("unsupported attachment")}Yi(s,J,Y),Yi(s,Z,te),Yi(s,le,ye),Yi(s,be,Ee);for(var U=o.elementCount,z=0;z<4;++z)Yi(d,10,10),C(A,M,D,k,L);wh(l,U,U+1,U+3),wh(l,U,U+3,U+2)}q+=x,W+=x;for(var oe=0,j=0;j<B;++j){var Q=b.get(w[j]),O=(oe-q)*R,V=(oe+Q.nw-q)*R,pe=(Q.nh-W)*R,_e=-W*R;Yi(s,O,pe),Yi(s,O,_e),Yi(s,V,pe),Yi(s,V,_e);var Pe=b.texture.width,je=b.texture.height;Yi(d,Q.x/Pe,Q.y/je),Yi(d,Q.x/Pe,(Q.y+Q.h)/je),Yi(d,(Q.x+Q.w)/Pe,Q.y/je),Yi(d,(Q.x+Q.w)/Pe,(Q.y+Q.h)/je),oe+=Q.nw-2*x;for(var U=o.elementCount,z=0;z<4;++z)C(A,M,D,k,L);wh(l,U+ls[0],U+ls[1],U+ls[2]),wh(l,U+ls[3],U+ls[4],U+ls[5])}},getText:function(){var w=b.texture,A=qe.compact(o,!0),M=qe.compact(s,!0),D=qe.compact(u,!0),k=qe.compact(l,!0),R=qe.compact(c,!0),L=qe.compact(d,!0);return Bs.create(w,A,M,D,k,R,L,l.elementCount/2,a)}}}e.create=t})(zc||(zc={}));var n0={granularity:"element",condensed:!1,reverse:!1,countsOnly:!1,hidePrefix:!1,htmlStyling:!0};function Jf(e,t){switch(t===void 0&&(t={}),e.kind){case"structure-loci":return e.structure.models.map(function(l){return l.entry}).filter(function(l){return!!l}).join(", ");case"element-loci":return y_(gf.ofLoci(e),t);case"bond-loci":var r=e.bonds[0];return r?FO(r):"";case"shape-loci":return e.shape.name;case"group-loci":var n=e.groups[0];return n?e.shape.getLabel(Oe.start(n.ids),n.instance):"";case"every-loci":return"Everything";case"empty-loci":return"Nothing";case"data-loci":return e.getLabel();case"volume-loci":return e.volume.label||"Volume";case"isosurface-loci":return[""+(e.volume.label||"Volume"),"Isosurface at "+Ct.IsoValue.toString(e.isoValue)].join(" | ");case"cell-loci":var i=Oe.size(e.indices),a=Oe.start(e.indices),o=Ct.IsoValue.absolute(e.volume.grid.cells.data[a]),s=Ct.IsoValue.toRelative(o,e.volume.grid.stats),u=[""+(e.volume.label||"Volume"),i===1?"Cell #"+a:i+" Cells"];return i===1&&u.push(Ct.IsoValue.toString(o)+" ("+Ct.IsoValue.toString(s)+")"),u.join(" | ")}}function sm(e,t){return e===1?"1 "+t:e+" "+t+"s"}function N0(e,t,r,n,i,a){return eu(t,{granularity:r,hidePrefix:n,reverse:i,condensed:a})+" <small>[+ "+sm(e-1,"other "+Hg(r))+"]</small>"}function Jje(e){var t=e.elements,r=e.model,n=r.atomicHierarchy,i=n.chainAtomSegments,a=n.residueAtomSegments,o=i.offsets[i.index[t[0]]],s=i.offsets[i.index[t[t.length-1]]+1]-1;return a.index[s]-a.index[o]+1}function y_(e,t){t===void 0&&(t={});var r=E(E({},n0),t),n=eze(e,r.countsOnly,r.hidePrefix,r.condensed,r.reverse);return r.htmlStyling?n:ff(n)}function eze(e,t,r,n,i){t===void 0&&(t=!1),r===void 0&&(r=!1),n===void 0&&(n=!1),i===void 0&&(i=!1);var a=e.structureCount,o=e.chainCount,s=e.residueCount,u=e.conformationCount,l=e.elementCount;if(!t&&l===1&&s===0&&o===0)return eu(e.firstElementLoc,{hidePrefix:r,condensed:n,granularity:"element",reverse:i});if(!t&&l===0&&s===1&&o===0)return eu(e.firstResidueLoc,{hidePrefix:r,condensed:n,granularity:"residue",reverse:i});if(!t&&l===0&&s===0&&o===1){var c=e.firstChainLoc.unit,d=Ue.isAtomic(c)&&Jje(c)===1||Ue.Traits.is(c.traits,1)?"residue":"chain";return eu(e.firstChainLoc,{hidePrefix:r,condensed:n,granularity:d,reverse:i})}else if(t){var f=[];return a>0&&f.push(sm(a,"Structure")),o>0&&f.push(sm(o,"Chain")),s>0&&f.push(sm(s,"Residue")),u>0&&f.push(sm(u,"Conformation")),l>0&&f.push(sm(l,"Element")),f.join("<small> + </small>")}else{var f=[];return a>0&&f.push(a===1?eu(e.firstStructureLoc,{hidePrefix:r,condensed:n,granularity:"structure",reverse:i}):N0(a,e.firstStructureLoc,"structure",r,i,n)),o>0&&(f.push(o===1?eu(e.firstChainLoc,{condensed:n,granularity:"chain",hidePrefix:r,reverse:i}):N0(o,e.firstChainLoc,"chain",r,i,n)),r=!0),s>0&&(f.push(s===1?eu(e.firstResidueLoc,{condensed:n,granularity:"residue",hidePrefix:r,reverse:i}):N0(s,e.firstResidueLoc,"residue",r,i,n)),r=!0),u>0&&(f.push(u===1?eu(e.firstConformationLoc,{condensed:n,granularity:"conformation",hidePrefix:r,reverse:i}):N0(u,e.firstConformationLoc,"conformation",r,i,n)),r=!0),l>0&&f.push(l===1?eu(e.firstElementLoc,{condensed:n,granularity:"element",hidePrefix:r,reverse:i}):N0(l,e.firstElementLoc,"element",r,i,n)),f.join("<small> + </small>")}}function FO(e,t){return t===void 0&&(t={}),G3({loci:[De(e.aStructure,[{unit:e.aUnit,indices:Oe.ofSingleton(e.aIndex)}]),De(e.bStructure,[{unit:e.bUnit,indices:Oe.ofSingleton(e.bIndex)}])]},t)}function G3(e,t){t===void 0&&(t={});var r=E(E({},n0),t),n=tze(e,r);return r.htmlStyling?n:ff(n)}function tze(e,t){for(var r=t.granularity,n=t.hidePrefix,i=t.reverse,a=t.condensed,o=!0,s=0,u=e.loci;s<u.length;s++){var l=u[s];if(!De.is(l)||De.size(l)!==1){o=!1;break}}if(o){var c=e.loci.map(function(b){var S=b.elements[0],x=S.unit,C=S.indices;return Ze.create(b.structure,x,x.elements[Oe.start(C)])}),d=c.map(function(b){return IJ(b,r,n,i||a)});if(a)return d.map(function(b){return b[0].replace(/\[.*\]/g,"").trim()}).filter(function(b){return!!b}).join(" — ");for(var f=0,h=0,v=Math.min.apply(Math,d.map(function(b){return b.length}))-1;h<v;++h){for(var p=!0,m=1,g=d.length;m<g;++m)if(d[0][h]!==d[m][h]){p=!1;break}if(p)f+=1;else break}if(f>0){for(var y=[d[0].join(" | ")],m=1,g=d.length;m<g;++m)y.push(d[m].slice(f).filter(function(x){return!!x}).join(" | "));return y.join(" — ")}else return d.map(function(b){return b.filter(function(S){return!!S}).join(" | ")}).filter(function(b){return!!b}).join("</br>")}else{var d=e.loci.map(function(S){return Jf(S,t)});return d.filter(function(S){return!!S}).join(a?" — ":"</br>")}}function eu(e,t){var r,n;t===void 0&&(t={});var i=E(E({},n0),t),a=IJ(e,i.granularity,i.hidePrefix,i.reverse||i.condensed),o=i.condensed?(n=(r=a[0])===null||r===void 0?void 0:r.replace(/\[.*\]/g,"").trim())!==null&&n!==void 0?n:"":a.filter(function(s){return!!s}).join(" | ");return i.htmlStyling?o:ff(o)}function IJ(e,t,r,n){t===void 0&&(t="element"),r===void 0&&(r=!1),n===void 0&&(n=!1);var i=[];if(!r){var a=e.unit.model.entry;a.length>30&&(a=a.substr(0,27)+"…"),i.push("<small>"+a+"</small>"),t!=="structure"&&(i.push("<small>Model "+e.unit.model.modelNum+"</small>"),i.push("<small>Instance "+e.unit.conformation.operator.name+"</small>"))}return Ue.isAtomic(e.unit)?i.push.apply(i,rze(e,t,n)):Ue.isCoarse(e.unit)?i.push.apply(i,nze(e,t)):i.push("Unknown"),n?i.reverse():i}function rze(e,t,r){r===void 0&&(r=!1);var n=Ze.residueIndex(e),i=lt.chain.label_asym_id(e),a=lt.chain.auth_asym_id(e),o=e.unit.model.atomicHierarchy.residues.label_seq_id.valueKind(n)===0,s=lt.residue.label_seq_id(e),u=lt.residue.auth_seq_id(e),l=lt.residue.pdbx_PDB_ins_code(e),c=lt.atom.label_comp_id(e),d=lt.atom.label_atom_id(e),f=lt.atom.label_alt_id(e),h=lt.atom.occupancy(e),v=lt.residue.microheterogeneityCompIds(e),p=t==="residue"&&v.length>1?"("+v.join("|")+")":c,m=[];switch(t){case"element":m.push("<b>"+d+"</b>"+(f?"%"+f:""));case"conformation":t==="conformation"&&f&&m.push("<small>Conformation</small> <b>"+f+"</b>");case"residue":var g=s===u||!o?u:s;m.push("<b>"+p+" "+g+"</b>"+(g!==u?" <small>[auth</small> <b>"+u+"</b><small>]</small>":"")+"<b>"+(l||"")+"</b>");case"chain":i===a?m.push("<b>"+i+"</b>"):t==="chain"&&Ue.Traits.is(e.unit.traits,1)?m.push("<small>[auth</small> <b>"+a+"</b><small>]</small>"):m.push("<b>"+i+"</b> <small>[auth</small> <b>"+a+"</b><small>]</small>")}return m.length>0&&h!==1&&!r&&(m[0]=m[0]+" <small>[occupancy</small> <b>"+Math.round(100*h)/100+"</b><small>]</small>"),m.reverse()}function nze(e,t){var r=lt.coarse.asym_id(e),n=lt.coarse.seq_id_begin(e),i=lt.coarse.seq_id_end(e),a=[];switch(t){case"element":case"conformation":case"residue":if(n===i){var o=lt.coarse.entityKey(e),s=e.unit.model.sequence.byEntityKey[o],u=s.sequence.compId.value(n-1);a.push("<b>"+u+" "+n+"</b>")}else a.push("<b>"+n+"-"+i+"</b>");case"chain":a.push("<b>"+r+"</b>")}return a.reverse()}function q3(e,t){t===void 0&&(t={});var r=E(E(E({},n0),{measureOnly:!1,unitLabel:"Å"}),t),n=e.loci.map(function(u){return ar.getCenter(u)}),i=n[0],a=n[1],o=_.distance(i,a).toFixed(2)+" "+r.unitLabel;if(r.measureOnly)return o;var s=G3(e,r);return r.condensed?o+" | "+s:"Distance "+o+"</br>"+s}function W3(e,t){t===void 0&&(t={});var r=E(E(E({},n0),{measureOnly:!1}),t),n=e.loci.map(function(d){return ar.getCenter(d)}),i=n[0],a=n[1],o=n[2],s=_.sub(_(),i,a),u=_.sub(_(),o,a),l=mu(_.angle(s,u)).toFixed(2)+"°";if(r.measureOnly)return l;var c=G3(e,r);return r.condensed?l+" | "+c:"Angle "+l+"</br>"+c}function $3(e,t){t===void 0&&(t={});var r=E(E(E({},n0),{measureOnly:!1}),t),n=e.loci.map(function(c){return ar.getCenter(c)}),i=n[0],a=n[1],o=n[2],s=n[3],u=mu(_.dihedralAngle(i,a,o,s)).toFixed(2)+"°";if(r.measureOnly)return u;var l=G3(e,r);return r.condensed?u+" | "+l:"Dihedral "+u+"</br>"+l}var MJ={customText:I.Text("",{label:"Text",description:"Override the label with custom value."}),textColor:I.Color(dr.black,{isEssential:!0}),textSize:I.Numeric(.5,{min:.1,max:5,step:.1},{isEssential:!0})},X3=E(E(E({},Bs.Params),MJ),{borderWidth:I.Numeric(.2,{min:0,max:.5,step:.01})}),DJ={unitLabel:I.Text("Å",{isEssential:!0})},ize=E(E(E({},bn.Params),DJ),{lineSizeAttenuation:I.Boolean(!0),linesColor:I.Color(dr.lightgreen,{isEssential:!0}),linesSize:I.Numeric(.075,{min:.01,max:5,step:.01}),dashLength:I.Numeric(.2,{min:.01,max:.2,step:.01})}),aze=E(E({},X3),DJ),RJ={lines:function(e,t){return Pi(uze,bn.Utils,{modifyState:function(r){return E(E({},r),{markerActions:So.Highlighting})}})},text:function(e,t){return Pi(cze,Bs.Utils,{modifyState:function(r){return E(E({},r),{markerActions:tr.None})}})}},Ij=E(E(E({},ize),aze),{visuals:I.MultiSelect(["lines","text"],I.objectToOptions(RJ))});function oze(){return{sphereA:Fe(),sphereB:Fe(),center:_(),distance:0}}function kJ(e,t){var r=t.sphereA,n=t.sphereB,i=t.center,a=e.loci,o=a[0],s=a[1];return ar.getBoundingSphere(o,r),ar.getBoundingSphere(s,n),_.add(i,r.center,n.center),_.scale(i,i,.5),t.distance=_.distance(r.center,n.center),t}var of=oze();function OJ(e,t){return e.pairs.length===1?"Distance "+q3(e.pairs[0],{unitLabel:t,measureOnly:!0}):e.pairs.length+" Distances"}function sze(e,t,r){for(var n=Zo.create(128,64,r),i=0,a=e.pairs.length;i<a;++i)kJ(e.pairs[i],of),n.addFixedLengthDashes(of.sphereA.center,of.sphereB.center,t.dashLength,i);return n.getLines()}function uze(e,t,r,n){var i=sze(t,r,n&&n.geometry),a=OJ(t,r.unitLabel),o=function(s){return q3(t.pairs[s],r)};return kr.create(a,t,i,function(){return r.linesColor},function(){return r.linesSize},o)}function lze(e,t,r){for(var n=zc.create(t,128,64,r),i=0,a=e.pairs.length;i<a;++i){kJ(e.pairs[i],of);var o=of.center,s=of.distance,u=of.sphereA,l=of.sphereB,c=t.customText||s.toFixed(2)+" "+t.unitLabel,d=Math.max(2,u.radius,l.radius),f=d/2;n.add(c,o[0],o[1],o[2],1,f,i)}return n.getText()}function cze(e,t,r,n){var i=lze(t,r,n&&n.geometry),a=OJ(t,r.unitLabel),o=function(s){return q3(t.pairs[s],r)};return kr.create(a,t,i,function(){return r.textColor},function(){return r.textSize},o)}function dze(e,t){return or.createMulti("Distance",e,t,or.StateBuilder,RJ)}function Mj(e){var t=e[0].loci,r=e[1].loci;return{pairs:[{loci:[t,r]}]}}function Dj(e){var t=e[0].loci,r=e[1].loci,n=e[2].loci;return{triples:[{loci:[t,r,n]}]}}function Rj(e){var t=e[0].loci,r=e[1].loci,n=e[2].loci,i=e[3].loci;return{quads:[{loci:[t,r,n,i]}]}}function kj(e){var t=e[0].loci;return{infos:[{loci:t}]}}function Oj(e){var t=e[0].loci;return{locis:[t]}}var fze=E(E({},X3),{offsetZ:I.Numeric(2,{min:0,max:10,step:.1})}),LJ={text:function(e,t){return Pi(mze,Bs.Utils,{modifyState:function(r){return E(E({},r),{pickable:!1})}})}},Lj=E(E({},fze),{scaleByRadius:I.Boolean(!0),visuals:I.MultiSelect(["text"],I.objectToOptions(LJ))}),hze=Fe();function BO(e,t){return t===void 0&&(t=!1),e.label||Jf(e.loci,{hidePrefix:!0,htmlStyling:!1,condensed:t})}function pze(e){return e.infos.length===1?BO(e.infos[0]):e.infos.length+" Labels"}function vze(e,t,r){for(var n=zc.create(t,128,64,r),i=t.customText.trim(),a=0,o=e.infos.length;a<o;++a){var s=e.infos[a],u=ar.getBoundingSphere(s.loci,hze);if(u){var l=u.center,c=u.radius,d=i||BO(s,!0);n.add(d,l[0],l[1],l[2],t.scaleByRadius?c/.9:0,t.scaleByRadius?Math.max(1,c):1,a)}}return n.getText()}function mze(e,t,r,n){var i=vze(t,r,n&&n.geometry),a=pze(t),o=r.customText.trim(),s=o?function(u){return o}:function(u){return BO(t.infos[u])};return kr.create(a,t,i,function(){return r.textColor},function(){return r.textSize},s)}function gze(e,t){return or.createMulti("Label",e,t,or.StateBuilder,LJ)}var Eh=_(),yze=ue.identity(),Ah=new Float32Array(6*3),bze=new Uint8Array([0,1,2,3,4,5]);function xze(e,t,r,n,i){var a=t.origin,o=t.dirA,s=t.dirB,u=t.dirC;_.add(Eh,a,o),_.toArray(_.add(Eh,a,o),Ah,0),_.toArray(_.sub(Eh,a,o),Ah,3),_.toArray(_.add(Eh,a,s),Ah,6),_.toArray(_.sub(Eh,a,s),Ah,9),_.toArray(_.add(Eh,a,u),Ah,12),_.toArray(_.sub(Eh,a,u),Ah,15);var l=AO(Ah,bze),c=fu.volume(t),d=Math.cbrt(c)/300*r;wt.addCage(e,yze,l,d,n,i)}_.zero();_.zero();var Ad=_(),Sze=_(),Cze=_(),_ze=_(),wze=ue.identity(),Nj=new Float32Array(8*3),Eze=new Uint8Array([0,1,0,3,0,6,1,2,1,7,2,3,2,4,3,5,4,5,4,7,5,6,6,7]);function Aze(e,t,r,n,i){var a=t.origin,o=t.dirA,s=t.dirB,u=t.dirC,l=_.negate(Sze,o),c=_.negate(Cze,s),d=_.negate(_ze,u),f=0,h=function(g,y,b){_.copy(Ad,a),_.add(Ad,Ad,g),_.add(Ad,Ad,y),_.add(Ad,Ad,b),_.toArray(Ad,Nj,f),f+=3};h(o,s,u),h(o,s,d),h(o,c,d),h(o,c,u),h(l,c,d),h(l,c,u),h(l,s,u),h(l,s,d);var v=AO(Nj,Eze),p=fu.volume(t),m=Math.cbrt(p)/300*r;wt.addCage(e,wze,v,m,n,i)}var Pze=ue.identity(),Fj=_();function Tze(e,t,r,n,i){return _.add(Fj,t,r),ue.targetTo(e,t,Fj,n),ue.setTranslation(e,t),ue.scale(e,e,i)}function UO(e,t,r,n,i,a){wt.addPrimitive(e,Tze(Pze,t,r,n,i),sZ(a))}var jO={color:I.Color(dr.orange),scale:I.Numeric(2,{min:.1,max:10,step:.1})},Ize=E(E({},Nt.Params),jO),Mze=E(E({},Nt.Params),jO);E(E({},Nt.Params),jO);var NJ={axes:function(e,t){return Pi(Rze,Nt.Utils)},box:function(e,t){return Pi(Oze,Nt.Utils)},ellipsoid:function(e,t){return Pi(Nze,Nt.Utils)}},Bj=E(E(E({},Ize),Mze),{visuals:I.MultiSelect(["box"],I.objectToOptions(NJ)),color:I.Color(dr.orange),scale:I.Numeric(2,{min:.1,max:5,step:.1})});function Y3(e){var t=Jf(e,{countsOnly:!0});return"Principal Axes of "+t}function zO(e){return e.locis.length===1?Y3(e.locis[0]):e.locis.length+" Orientations"}function Dze(e,t,r){for(var n=wt.createState(256,128,r),i=0,a=e.locis.length;i<a;++i){var o=ar.getPrincipalAxes(e.locis[i]);o&&(n.currentGroup=i,xze(n,o.momentsAxes,t.scale,2,20))}return wt.getMesh(n)}function Rze(e,t,r,n){var i=Dze(t,r,n&&n.geometry),a=zO(t),o=function(s){return Y3(t.locis[s])};return kr.create(a,t,i,function(){return r.color},function(){return 1},o)}function kze(e,t,r){for(var n=wt.createState(256,128,r),i=0,a=e.locis.length;i<a;++i){var o=ar.getPrincipalAxes(e.locis[i]);o&&(n.currentGroup=i,Aze(n,o.boxAxes,t.scale,2,20))}return wt.getMesh(n)}function Oze(e,t,r,n){var i=kze(t,r,n&&n.geometry),a=zO(t),o=function(s){return Y3(t.locis[s])};return kr.create(a,t,i,function(){return r.color},function(){return 1},o)}function Lze(e,t,r){for(var n=wt.createState(256,128,r),i=0,a=e.locis.length;i<a;++i){var o=ar.getPrincipalAxes(e.locis[i]);if(o){var s=o.boxAxes,u=s.origin,l=s.dirA,c=s.dirB,d=fu.size(_(),s);_.scale(d,d,.5);var f=_.create(d[2],d[1],d[0]);n.currentGroup=i,UO(n,u,l,c,f,2)}}return wt.getMesh(n)}function Nze(e,t,r,n){var i=Lze(t,r,n&&n.geometry),a=zO(t),o=function(s){return Y3(t.locis[s])};return kr.create(a,t,i,function(){return r.color},function(){return 1},o)}function Fze(e,t){var r=or.createMulti("Orientation",e,t,or.StateBuilder,NJ);return r.setState({markerActions:So.Highlighting}),r}var Bze={radius:1,segments:36,thetaStart:0,thetaLength:Math.PI*2};function FJ(e){var t=E(E({},Bze),e),r=t.radius,n=t.segments,i=t.thetaStart,a=t.thetaLength,o=a===Math.PI*2,s=o?n+1:n+2,u=new Float32Array(s*3),l=new Float32Array(s*3),c=new Uint32Array(n*3);u[0]=0,u[1]=0,u[2]=0,l[0]=0,l[1]=1,l[2]=0;for(var d=0,f=3;d<n;++d,f+=3){var h=i+d/n*a;u[f]=r*Math.sin(h),u[f+1]=0,u[f+2]=r*Math.cos(h),l[f]=0,l[f+1]=1,l[f+2]=0}for(var d=1,f=0;d<n;++d,f+=3)c[f]=d,c[f+1]=d+1,c[f+2]=0;if(o){var v=(n-1)*3;c[v]=n,c[v+1]=1,c[v+2]=0}else{var h=i+a,f=(n+1)*3;u[f]=r*Math.sin(h),u[f+1]=0,u[f+2]=r*Math.cos(h),l[f]=0,l[f+1]=1,l[f+2]=0;var v=(n-1)*3;c[v]=n,c[v+1]=n+1,c[v+2]=0}return{vertices:u,normals:l,indices:c}}var BJ={color:I.Color(dr.lightgreen),arcScale:I.Numeric(.7,{min:.01,max:1,step:.01})},UJ=E(E(E({},bn.Params),BJ),{lineSizeAttenuation:I.Boolean(!0),linesSize:I.Numeric(.04,{min:.01,max:5,step:.01}),dashLength:I.Numeric(.04,{min:.01,max:.2,step:.01})}),Uze=E({},UJ),jze=E({},UJ),zze=E(E(E({},Nt.Params),BJ),{ignoreLight:I.Boolean(!0),sectorOpacity:I.Numeric(.75,{min:0,max:1,step:.01})}),jJ={vectors:function(e,t){return Pi(Gze,bn.Utils,{modifyState:function(r){return E(E({},r),{pickable:!1})}})},arc:function(e,t){return Pi(Wze,bn.Utils,{modifyState:function(r){return E(E({},r),{pickable:!1})}})},sector:function(e,t){return Pi(Xze,Nt.Utils,{modifyProps:function(r){return E(E({},r),{alpha:r.sectorOpacity})},modifyState:function(r){return E(E({},r),{markerActions:So.Highlighting})}})},text:function(e,t){return Pi(Kze,Bs.Utils,{modifyState:function(r){return E(E({},r),{markerActions:tr.None})}})}},Uj=E(E(E(E(E({},Uze),jze),zze),X3),{visuals:I.MultiSelect(["vectors","sector","text"],I.objectToOptions(jJ))});function Vze(){return{sphereA:Fe(),sphereB:Fe(),sphereC:Fe(),arcDirA:_(),arcDirC:_(),arcNormal:_(),radius:0,angle:0}}var Pd=_(),F0=ue();function K3(e,t,r){var n=t.sphereA,i=t.sphereB,a=t.sphereC,o=t.arcDirA,s=t.arcDirC,u=t.arcNormal,l=e.loci,c=l[0],d=l[1],f=l[2];ar.getBoundingSphere(c,n),ar.getBoundingSphere(d,i),ar.getBoundingSphere(f,a),_.sub(o,n.center,i.center),_.sub(s,a.center,i.center),_.cross(u,o,s);var h=Math.min(_.magnitude(o),_.magnitude(s)),v=h*r;return t.radius=v,t.angle=_.angle(o,s),t}function zJ(e,t){var r=e.radius,n=e.angle,i=t?aY(n,r)/t:32;ue.targetTo(F0,e.sphereB.center,e.sphereA.center,e.arcNormal),ue.setTranslation(F0,e.sphereB.center),ue.mul(F0,F0,ue.rotY180);var a=FJ({radius:r,thetaLength:n,segments:i});return EO(a,F0)}var Zi=Vze();function Q3(e){return e.triples.length===1?"Angle "+W3(e.triples[0],{measureOnly:!0}):e.triples.length+" Angles"}function Hze(e,t,r){for(var n=Zo.create(128,64,r),i=0,a=e.triples.length;i<a;++i)K3(e.triples[i],Zi,t.arcScale),n.addFixedLengthDashes(Zi.sphereB.center,Zi.sphereA.center,t.dashLength,i),n.addFixedLengthDashes(Zi.sphereB.center,Zi.sphereC.center,t.dashLength,i);return n.getLines()}function Gze(e,t,r,n){var i=Hze(t,r,n&&n.geometry),a=Q3(t);return kr.create(a,t,i,function(){return r.color},function(){return r.linesSize},function(){return""})}function qze(e,t,r){for(var n=Zo.create(128,64,r),i=0,a=e.triples.length;i<a;++i){K3(e.triples[i],Zi,t.arcScale);for(var o=zJ(Zi,t.dashLength),s=o.indices,u=o.vertices,l=0,c=s.length;l<c;l+=3)if(l%2!==1){var d=s[l]*3,f=s[l+1]*3,h=u[d],v=u[d+1],p=u[d+2],m=u[f],g=u[f+1],y=u[f+2];n.add(h,v,p,m,g,y,i)}}return n.getLines()}function Wze(e,t,r,n){var i=qze(t,r,n&&n.geometry),a=Q3(t);return kr.create(a,t,i,function(){return r.color},function(){return r.linesSize},function(){return""})}function $ze(e,t,r){for(var n=wt.createState(128,64,r),i=0,a=e.triples.length;i<a;++i){K3(e.triples[i],Zi,t.arcScale);var o=zJ(Zi);n.currentGroup=i,wt.addPrimitive(n,ue.id,o),wt.addPrimitiveFlipped(n,ue.id,o)}return wt.getMesh(n)}function Xze(e,t,r,n){var i=$ze(t,r,n&&n.geometry),a=Q3(t),o=function(s){return W3(t.triples[s])};return kr.create(a,t,i,function(){return r.color},function(){return 1},o)}function Yze(e,t,r){for(var n=zc.create(t,128,64,r),i=0,a=e.triples.length;i<a;++i){K3(e.triples[i],Zi,t.arcScale),_.add(Pd,Zi.arcDirA,Zi.arcDirC),_.setMagnitude(Pd,Pd,Zi.radius),_.add(Pd,Zi.sphereB.center,Pd);var o=mu(Zi.angle).toFixed(2),s=t.customText||o+"°",u=Math.max(2,Zi.sphereA.radius,Zi.sphereB.radius,Zi.sphereC.radius),l=u/2;n.add(s,Pd[0],Pd[1],Pd[2],.1,l,i)}return n.getText()}function Kze(e,t,r,n){var i=Yze(t,r,n&&n.geometry),a=Q3(t),o=function(s){return W3(t.triples[s])};return kr.create(a,t,i,function(){return r.textColor},function(){return r.textSize},o)}function Qze(e,t){return or.createMulti("Angle",e,t,or.StateBuilder,jJ)}var VJ={color:I.Color(dr.lightgreen),arcScale:I.Numeric(.7,{min:.01,max:1,step:.01})},Z3=E(E(E({},bn.Params),VJ),{lineSizeAttenuation:I.Boolean(!0),linesSize:I.Numeric(.04,{min:.01,max:5,step:.01}),dashLength:I.Numeric(.04,{min:.01,max:.2,step:.01})}),Zze=E({},Z3),Jze=E({},Z3),eVe=E({},Z3),tVe=E({},Z3),rVe=E(E(E({},Nt.Params),VJ),{ignoreLight:I.Boolean(!0),sectorOpacity:I.Numeric(.75,{min:0,max:1,step:.01})}),HJ={vectors:function(e,t){return Pi(aVe,bn.Utils,{modifyState:function(r){return E(E({},r),{pickable:!1})}})},extenders:function(e,t){return Pi(dVe,bn.Utils,{modifyState:function(r){return E(E({},r),{pickable:!1})}})},connector:function(e,t){return Pi(sVe,bn.Utils,{modifyState:function(r){return E(E({},r),{pickable:!1})}})},arms:function(e,t){return Pi(lVe,bn.Utils,{modifyState:function(r){return E(E({},r),{pickable:!1})}})},arc:function(e,t){return Pi(hVe,bn.Utils,{modifyState:function(r){return E(E({},r),{pickable:!1})}})},sector:function(e,t){return Pi(vVe,Nt.Utils,{modifyProps:function(r){return E(E({},r),{alpha:r.sectorOpacity})},modifyState:function(r){return E(E({},r),{markerActions:So.Highlighting})}})},text:function(e,t){return Pi(gVe,Bs.Utils,{modifyState:function(r){return E(E({},r),{markerActions:tr.None})}})}},jj=E(E(E(E(E(E(E({},Zze),Jze),eVe),tVe),rVe),X3),{visuals:I.MultiSelect(["extenders","arms","sector","text"],I.objectToOptions(HJ))});function nVe(){return{sphereA:Fe(),sphereB:Fe(),sphereC:Fe(),sphereD:Fe(),dirBA:_(),dirCD:_(),projA:_(),projD:_(),arcPointA:_(),arcPointD:_(),arcDirA:_(),arcDirD:_(),arcCenter:_(),arcNormal:_(),radius:0,angle:0}}var wa=_(),B0=ue();function gv(e,t,r){var n=t.sphereA,i=t.sphereB,a=t.sphereC,o=t.sphereD,s=t.dirBA,u=t.dirCD,l=t.projA,c=t.projD,d=t.arcPointA,f=t.arcPointD,h=t.arcDirA,v=t.arcDirD,p=t.arcCenter,m=t.arcNormal,g=e.loci,y=g[0],b=g[1],S=g[2],x=g[3];ar.getBoundingSphere(y,n),ar.getBoundingSphere(b,i),ar.getBoundingSphere(S,a),ar.getBoundingSphere(x,o),_.add(p,i.center,a.center),_.scale(p,p,.5),_.sub(s,n.center,i.center),_.sub(u,o.center,a.center),_.add(d,p,s),_.add(f,p,u),_.sub(m,a.center,i.center),_.orthogonalize(h,m,s),_.orthogonalize(v,m,u),_.projectPointOnVector(l,d,h,p),_.projectPointOnVector(c,f,v,p);var C=Math.min(_.distance(l,p),_.distance(c,p)),w=C*r;_.setMagnitude(h,h,w),_.setMagnitude(v,v,w),_.add(d,p,h),_.add(f,p,v),t.radius=w,t.angle=_.dihedralAngle(n.center,i.center,a.center,o.center),_.matchDirection(wa,m,_.sub(wa,d,n.center));var A=_.angle(s,wa),M=w/Math.cos(A-jy);_.add(l,i.center,_.setMagnitude(wa,s,M)),_.matchDirection(wa,m,_.sub(wa,f,o.center));var D=_.angle(u,wa),k=w/Math.cos(D-jy);return _.add(c,a.center,_.setMagnitude(wa,u,k)),t}function GJ(e,t){var r=e.radius,n=e.angle,i=t?aY(n,r)/t:32;ue.targetTo(B0,e.arcCenter,n<0?e.arcPointD:e.arcPointA,e.arcNormal),ue.setTranslation(B0,e.arcCenter),ue.mul(B0,B0,ue.rotY180);var a=FJ({radius:r,thetaLength:Math.abs(n),segments:i});return EO(a,B0)}var un=nVe();function yv(e){return e.quads.length===1?"Dihedral "+$3(e.quads[0],{measureOnly:!0}):e.quads.length+" Dihedrals"}function iVe(e,t,r){for(var n=Zo.create(128,64,r),i=0,a=e.quads.length;i<a;++i)gv(e.quads[i],un,t.arcScale),n.addFixedLengthDashes(un.arcCenter,un.arcPointA,t.dashLength,i),n.addFixedLengthDashes(un.arcCenter,un.arcPointD,t.dashLength,i);return n.getLines()}function aVe(e,t,r,n){var i=iVe(t,r,n&&n.geometry),a=yv(t);return kr.create(a,t,i,function(){return r.color},function(){return r.linesSize},function(){return""})}function oVe(e,t,r){for(var n=Zo.create(128,64,r),i=0,a=e.quads.length;i<a;++i)gv(e.quads[i],un,t.arcScale),n.addFixedLengthDashes(un.sphereB.center,un.sphereC.center,t.dashLength,i);return n.getLines()}function sVe(e,t,r,n){var i=oVe(t,r,n&&n.geometry),a=yv(t);return kr.create(a,t,i,function(){return r.color},function(){return r.linesSize},function(){return""})}function uVe(e,t,r){for(var n=Zo.create(128,64,r),i=0,a=e.quads.length;i<a;++i)gv(e.quads[i],un,t.arcScale),n.addFixedLengthDashes(un.sphereB.center,un.sphereA.center,t.dashLength,i),n.addFixedLengthDashes(un.sphereC.center,un.sphereD.center,t.dashLength,i);return n.getLines()}function lVe(e,t,r,n){var i=uVe(t,r,n&&n.geometry),a=yv(t);return kr.create(a,t,i,function(){return r.color},function(){return r.linesSize},function(){return""})}function cVe(e,t,r){for(var n=Zo.create(128,64,r),i=0,a=e.quads.length;i<a;++i)gv(e.quads[i],un,t.arcScale),n.addFixedLengthDashes(un.arcPointA,un.projA,t.dashLength,i),n.addFixedLengthDashes(un.arcPointD,un.projD,t.dashLength,i);return n.getLines()}function dVe(e,t,r,n){var i=cVe(t,r,n&&n.geometry),a=yv(t);return kr.create(a,t,i,function(){return r.color},function(){return r.linesSize},function(){return""})}function fVe(e,t,r){for(var n=Zo.create(128,64,r),i=0,a=e.quads.length;i<a;++i){gv(e.quads[i],un,t.arcScale);for(var o=GJ(un,t.dashLength),s=o.indices,u=o.vertices,l=0,c=s.length;l<c;l+=3)if(l%2!==1){var d=s[l]*3,f=s[l+1]*3,h=u[d],v=u[d+1],p=u[d+2],m=u[f],g=u[f+1],y=u[f+2];n.add(h,v,p,m,g,y,i)}}return n.getLines()}function hVe(e,t,r,n){var i=fVe(t,r,n&&n.geometry),a=yv(t);return kr.create(a,t,i,function(){return r.color},function(){return r.linesSize},function(){return""})}function pVe(e,t,r){for(var n=wt.createState(128,64,r),i=0,a=e.quads.length;i<a;++i){gv(e.quads[i],un,t.arcScale);var o=GJ(un);n.currentGroup=i,wt.addPrimitive(n,ue.id,o),wt.addPrimitiveFlipped(n,ue.id,o)}return wt.getMesh(n)}function vVe(e,t,r,n){var i=pVe(t,r,n&&n.geometry),a=yv(t),o=function(s){return $3(t.quads[s])};return kr.create(a,t,i,function(){return r.color},function(){return 1},o)}function mVe(e,t,r){for(var n=zc.create(t,128,64,r),i=0,a=e.quads.length;i<a;++i){gv(e.quads[i],un,t.arcScale),_.add(wa,un.arcDirA,un.arcDirD),_.setMagnitude(wa,wa,un.radius),_.add(wa,un.arcCenter,wa);var o=mu(un.angle).toFixed(2);o==="-0.00"&&(o="0.00");var s=t.customText||o+"°",u=Math.max(2,un.sphereA.radius,un.sphereB.radius,un.sphereC.radius,un.sphereD.radius),l=u/2;n.add(s,wa[0],wa[1],wa[2],.1,l,i)}return n.getText()}function gVe(e,t,r,n){var i=mVe(t,r,n&&n.geometry),a=yv(t),o=function(s){return $3(t.quads[s])};return kr.create(a,t,i,function(){return r.textColor},function(){return r.textSize},o)}function yVe(e,t){return or.createMulti("Dihedral",e,t,or.StateBuilder,HJ)}var bVe=kt.BuiltIn({name:"box-shape-3d",display:"Box Shape",from:ge.Root,to:ge.Shape.Provider,params:{bottomLeft:I.Vec3(_()),topRight:I.Vec3(_.create(1,1,1)),radius:I.Numeric(.15,{min:.01,max:4,step:.01}),color:I.Color(dr.red)}})({canAutoUpdate:function(){return!0},apply:function(e){var t=this,r=e.params;return We.create("Shape Representation",function(n){return ce(t,void 0,void 0,function(){return de(this,function(i){return[2,new ge.Shape.Provider({label:"Box",data:r,params:Nt.Params,getShape:function(a,o){var s=VO(Xt.create(r.bottomLeft,r.topRight),r.radius);return kr.create("Box",o,s,function(){return o.color},function(){return 1},function(){return"Box"})},geometryUtils:Nt.Utils},{label:"Box"})]})})})}});function VO(e,t,r){var n=_.sub(_(),e.max,e.min),i=ue.fromTranslation(ue(),_.create(.5,.5,.5)),a=ue.fromScaling(ue(),n),o=ue.fromTranslation(ue(),e.min),s=ue.mul3(ue(),o,a,i),u=wt.createState(256,128,r);u.currentGroup=1,wt.addCage(u,s,HQ(),t,2,20);var l=wt.getMesh(u),c=_.scaleAndAdd(_(),e.min,n,.5),d=_.distance(e.min,c);return l.setBoundingSphere(Fe.create(c,d)),l}const xVe=Object.freeze(Object.defineProperty({__proto__:null,BoxShape3D:bVe,getBoxMesh:VO},Symbol.toStringTag,{value:"Module"}));var b_=kt.BuiltIn({name:"structure-representation-3d",display:"3D Representation",from:ge.Molecule.Structure,to:ge.Molecule.Structure.Representation3D,params:function(e,t){var r=t.representation.structure,n=r.registry,i=r.themes,a=n.get(n.default.name);if(!e){var o={help:function(l){var c=l.name,d=l.params,f=i.colorThemeRegistry.get(c),h=f.factory({},d);return{description:h.description,legend:h.legend}}};return{type:I.Mapped(n.default.name,n.types,function(l){return I.Group(n.get(l).getParams(i,$e.Empty))}),colorTheme:I.Mapped(a.defaultColorTheme.name,i.colorThemeRegistry.types,function(l){return I.Group(i.colorThemeRegistry.get(l).getParams({structure:$e.Empty}))},o),sizeTheme:I.Mapped(a.defaultSizeTheme.name,i.sizeThemeRegistry.types,function(l){return I.Group(i.sizeThemeRegistry.get(l).getParams({structure:$e.Empty}))})}}var s={structure:e.data},u={help:function(l){var c=l.name,d=l.params,f=i.colorThemeRegistry.get(c),h=f.factory(s,d);return{description:h.description,legend:h.legend}}};return{type:I.Mapped(n.default.name,n.getApplicableTypes(e.data),function(l){return I.Group(n.get(l).getParams(i,e.data))}),colorTheme:I.Mapped(a.defaultColorTheme.name,i.colorThemeRegistry.getApplicableTypes(s),function(l){return I.Group(i.colorThemeRegistry.get(l).getParams(s))},u),sizeTheme:I.Mapped(a.defaultSizeTheme.name,i.sizeThemeRegistry.types,function(l){return I.Group(i.sizeThemeRegistry.get(l).getParams(s))})}}})({canAutoUpdate:function(e){var t=e.a,r=e.oldParams,n=e.newParams;return t.data.elementCount<1e4||r.type.name===n.type.name&&n.type.params.quality!=="custom"},apply:function(e,t){var r=this,n=e.a,i=e.params;return e.cache,We.create("Structure Representation",function(a){return ce(r,void 0,void 0,function(){var o,s,u,l,c,d,f;return de(this,function(h){switch(h.label){case 0:return o={runtime:a,assetManager:t.managers.asset},s=t.representation.structure.registry.get(i.type.name),u=((d=s.getData)===null||d===void 0?void 0:d.call(s,n.data,i.type.params))||n.data,s.ensureCustomProperties?[4,s.ensureCustomProperties.attach(o,u)]:[3,2];case 1:h.sent(),h.label=2;case 2:return l=s.factory(E({webgl:(f=t.canvas3d)===null||f===void 0?void 0:f.webgl},t.representation.structure.themes),s.getParams),[4,hi.ensureDependencies(o,t.representation.structure.themes,{structure:u},i)];case 3:return h.sent(),l.setTheme(hi.create(t.representation.structure.themes,{structure:u},i)),c=i.type.params||{},[4,l.createOrUpdate(c,u).runInContext(a)];case 4:return h.sent(),[2,new ge.Molecule.Structure.Representation3D({repr:l,sourceData:n.data},{label:s.label})]}})})})},update:function(e,t){var r=this,n=e.a,i=e.b,a=e.oldParams,o=e.newParams;return e.cache,We.create("Structure Representation",function(s){return ce(r,void 0,void 0,function(){var u,l,c,d,f,h;return de(this,function(v){switch(v.label){case 0:return o.type.name!==a.type.name?[2,ft.UpdateResult.Recreate]:(u=t.representation.structure.registry.get(o.type.name),!((f=u.mustRecreate)===null||f===void 0)&&f.call(u,a.type.params,o.type.params)?[2,ft.UpdateResult.Recreate]:(l=((h=u.getData)===null||h===void 0?void 0:h.call(u,n.data,o.type.params))||n.data,c={runtime:s,assetManager:t.managers.asset},u.ensureCustomProperties?[4,u.ensureCustomProperties.attach(c,l)]:[3,2]));case 1:v.sent(),v.label=2;case 2:return hi.releaseDependencies(t.representation.structure.themes,{structure:i.data.sourceData},a),[4,hi.ensureDependencies(c,t.representation.structure.themes,{structure:l},o)];case 3:return v.sent(),i.data.repr.setTheme(hi.create(t.representation.structure.themes,{structure:l},o)),d=E(E({},i.data.repr.props),o.type.params),[4,i.data.repr.createOrUpdate(d,l).runInContext(s)];case 4:return v.sent(),i.data.sourceData=n.data,[2,ft.UpdateResult.Updated]}})})})},dispose:function(e,t){var r=e.b,n=e.params;if(!(!r||!n)){var i=r.data.sourceData,a=t.representation.structure.registry.get(n.type.name);a.ensureCustomProperties&&a.ensureCustomProperties.detach(i),hi.releaseDependencies(t.representation.structure.themes,{structure:i},n)}},interpolate:function(e,t,r){if(e.colorTheme.name!=="uniform"||t.colorTheme.name!=="uniform")return r<=.5?e:t;var n=e.colorTheme.params.value,i=t.colorTheme.params.value,a=at.interpolate(n,i,r);return{type:r<=.5?e.type:t.type,colorTheme:{name:"uniform",params:{value:a}},sizeTheme:r<=.5?e.sizeTheme:t.sizeTheme}}}),SVe=kt.BuiltIn({name:"unwind-structure-assembly-representation-3d",display:"Unwind Assembly 3D Representation",from:ge.Molecule.Structure.Representation3D,to:ge.Molecule.Structure.Representation3DState,params:{t:I.Numeric(0,{min:0,max:1,step:.01})}})({canAutoUpdate:function(){return!0},apply:function(e){var t=e.a,r=e.params,n=t.data.sourceData,i=new Ig(n);return yj(n,i,r.t),new ge.Molecule.Structure.Representation3DState({state:{unitTransforms:i},initialState:{unitTransforms:new Ig(n)},info:n,repr:t.data.repr},{label:"Unwind T = "+r.t.toFixed(2)})},update:function(e){var t=e.a,r=e.b,n=e.newParams,i=e.oldParams,a=r.data.info;if(t.data.sourceData!==a||t.data.repr!==r.data.repr)return ft.UpdateResult.Recreate;if(i.t===n.t)return ft.UpdateResult.Unchanged;var o=r.data.state.unitTransforms;return yj(a,o,n.t),r.label="Unwind T = "+n.t.toFixed(2),r.data.repr=t.data.repr,ft.UpdateResult.Updated}}),CVe=kt.BuiltIn({name:"explode-structure-representation-3d",display:"Explode 3D Representation",from:ge.Molecule.Structure.Representation3D,to:ge.Molecule.Structure.Representation3DState,params:{t:I.Numeric(0,{min:0,max:1,step:.01})}})({canAutoUpdate:function(){return!0},apply:function(e){var t=e.a,r=e.params,n=t.data.sourceData,i=new Ig(n.root);return xj(n,i,r.t),new ge.Molecule.Structure.Representation3DState({state:{unitTransforms:i},initialState:{unitTransforms:new Ig(n.root)},info:n.root,repr:t.data.repr},{label:"Explode T = "+r.t.toFixed(2)})},update:function(e){var t=e.a,r=e.b,n=e.newParams,i=e.oldParams,a=t.data.sourceData;if(r.data.info!==a.root||t.data.repr!==r.data.repr)return ft.UpdateResult.Recreate;if(i.t===n.t)return ft.UpdateResult.Unchanged;var o=r.data.state.unitTransforms;return xj(a.root,o,n.t),r.label="Explode T = "+n.t.toFixed(2),r.data.repr=t.data.repr,ft.UpdateResult.Updated}}),_Ve=kt.BuiltIn({name:"spin-structure-representation-3d",display:"Spin 3D Representation",from:ge.Molecule.Structure.Representation3D,to:ge.Molecule.Structure.Representation3DState,params:E({t:I.Numeric(0,{min:0,max:1,step:.01})},Hje)})({canAutoUpdate:function(){return!0},apply:function(e){var t=e.a,r=e.params,n=t.data.sourceData,i=new Ig(n.root),a=Sj(n.root,r),o=a.axis,s=a.origin;return wj(n,i,r.t,o,s),new ge.Molecule.Structure.Representation3DState({state:{unitTransforms:i},initialState:{unitTransforms:new Ig(n.root)},info:n.root,repr:t.data.repr},{label:"Spin T = "+r.t.toFixed(2)})},update:function(e){var t=e.a,r=e.b,n=e.newParams,i=e.oldParams,a=t.data.sourceData;if(r.data.info!==a.root||t.data.repr!==r.data.repr)return ft.UpdateResult.Recreate;if(i.t===n.t&&i.axis===n.axis&&i.origin===n.origin)return ft.UpdateResult.Unchanged;var o=r.data.state.unitTransforms,s=Sj(a.root,n),u=s.axis,l=s.origin;return wj(a.root,o,n.t,u,l),r.label="Spin T = "+n.t.toFixed(2),r.data.repr=t.data.repr,ft.UpdateResult.Updated}}),wVe=kt.BuiltIn({name:"overpaint-structure-representation-3d-from-script",display:"Overpaint 3D Representation",from:ge.Molecule.Structure.Representation3D,to:ge.Molecule.Structure.Representation3DState,params:function(){return{layers:I.ObjectList({script:I.Script(Li("(sel.atom.all)","mol-script")),color:I.Color(dr.blueviolet),clear:I.Boolean(!1)},function(e){return""+(e.clear?"Clear":at.toRgbString(e.color))},{defaultValue:[{script:Li("(sel.atom.all)","mol-script"),color:dr.blueviolet,clear:!1}]})}}})({canAutoUpdate:function(){return!0},apply:function(e){var t=e.a,r=e.params,n=t.data.sourceData,i=Bi.ofScript(r.layers,n);return new ge.Molecule.Structure.Representation3DState({state:{overpaint:i},initialState:{overpaint:Bi.Empty},info:n,repr:t.data.repr},{label:"Overpaint ("+i.layers.length+" Layers)"})},update:function(e){var t=e.a,r=e.b,n=e.newParams;e.oldParams;var i=r.data.info,a=t.data.sourceData;if(a!==i||t.data.repr!==r.data.repr)return ft.UpdateResult.Recreate;var o=r.data.state.overpaint,s=Bi.ofScript(n.layers,a);return Bi.areEqual(o,s)?ft.UpdateResult.Unchanged:(r.data.state.overpaint=s,r.data.repr=t.data.repr,r.label="Overpaint ("+s.layers.length+" Layers)",ft.UpdateResult.Updated)}}),EVe=kt.BuiltIn({name:"overpaint-structure-representation-3d-from-bundle",display:"Overpaint 3D Representation",from:ge.Molecule.Structure.Representation3D,to:ge.Molecule.Structure.Representation3DState,params:function(){return{layers:I.ObjectList({bundle:I.Value(Jr.Empty),color:I.Color(dr.blueviolet),clear:I.Boolean(!1)},function(e){return""+(e.clear?"Clear":at.toRgbString(e.color))},{defaultValue:[{bundle:Jr.Empty,color:dr.blueviolet,clear:!1}],isHidden:!0})}}})({canAutoUpdate:function(){return!0},apply:function(e){var t=e.a,r=e.params,n=t.data.sourceData,i=Bi.ofBundle(r.layers,n);return new ge.Molecule.Structure.Representation3DState({state:{overpaint:i},initialState:{overpaint:Bi.Empty},info:n,repr:t.data.repr},{label:"Overpaint ("+i.layers.length+" Layers)"})},update:function(e){var t=e.a,r=e.b,n=e.newParams;e.oldParams;var i=r.data.info,a=t.data.sourceData;if(a!==i||t.data.repr!==r.data.repr)return ft.UpdateResult.Recreate;var o=r.data.state.overpaint,s=Bi.ofBundle(n.layers,a);return Bi.areEqual(o,s)?ft.UpdateResult.Unchanged:(r.data.state.overpaint=s,r.data.repr=t.data.repr,r.label="Overpaint ("+s.layers.length+" Layers)",ft.UpdateResult.Updated)}}),AVe=kt.BuiltIn({name:"transparency-structure-representation-3d-from-script",display:"Transparency 3D Representation",from:ge.Molecule.Structure.Representation3D,to:ge.Molecule.Structure.Representation3DState,params:function(){return{layers:I.ObjectList({script:I.Script(Li("(sel.atom.all)","mol-script")),value:I.Numeric(.5,{min:0,max:1,step:.01},{label:"Transparency"})},function(e){return"Transparency ("+e.value+")"},{defaultValue:[{script:Li("(sel.atom.all)","mol-script"),value:.5}]})}}})({canAutoUpdate:function(){return!0},apply:function(e){var t=e.a,r=e.params,n=t.data.sourceData,i=Ui.ofScript(r.layers,n);return new ge.Molecule.Structure.Representation3DState({state:{transparency:i},initialState:{transparency:Ui.Empty},info:n,repr:t.data.repr},{label:"Transparency ("+i.layers.length+" Layers)"})},update:function(e){var t=e.a,r=e.b,n=e.newParams;e.oldParams;var i=r.data.info;if(t.data.sourceData!==i||t.data.repr!==r.data.repr)return ft.UpdateResult.Recreate;var a=r.data.state.transparency,o=Ui.ofScript(n.layers,i);return Ui.areEqual(a,o)?ft.UpdateResult.Unchanged:(r.data.state.transparency=o,r.data.repr=t.data.repr,r.label="Transparency ("+o.layers.length+" Layers)",ft.UpdateResult.Updated)}}),PVe=kt.BuiltIn({name:"transparency-structure-representation-3d-from-bundle",display:"Transparency 3D Representation",from:ge.Molecule.Structure.Representation3D,to:ge.Molecule.Structure.Representation3DState,params:function(){return{layers:I.ObjectList({bundle:I.Value(Jr.Empty),value:I.Numeric(.5,{min:0,max:1,step:.01},{label:"Transparency"})},function(e){return"Transparency ("+e.value+")"},{defaultValue:[{bundle:Jr.Empty,value:.5}],isHidden:!0})}}})({canAutoUpdate:function(){return!0},apply:function(e){var t=e.a,r=e.params,n=t.data.sourceData,i=Ui.ofBundle(r.layers,n);return new ge.Molecule.Structure.Representation3DState({state:{transparency:i},initialState:{transparency:Ui.Empty},info:n,repr:t.data.repr},{label:"Transparency ("+i.layers.length+" Layers)"})},update:function(e){var t=e.a,r=e.b,n=e.newParams;e.oldParams;var i=r.data.info;if(t.data.sourceData!==i||t.data.repr!==r.data.repr)return ft.UpdateResult.Recreate;var a=r.data.state.transparency,o=Ui.ofBundle(n.layers,i);return Ui.areEqual(a,o)?ft.UpdateResult.Unchanged:(r.data.state.transparency=o,r.data.repr=t.data.repr,r.label="Transparency ("+o.layers.length+" Layers)",ft.UpdateResult.Updated)}}),TVe=kt.BuiltIn({name:"clipping-structure-representation-3d-from-script",display:"Clipping 3D Representation",from:ge.Molecule.Structure.Representation3D,to:ge.Molecule.Structure.Representation3DState,params:function(){return{layers:I.ObjectList({script:I.Script(Li("(sel.atom.all)","mol-script")),groups:I.Converted(function(e){return rn.Groups.toNames(e)},function(e){return rn.Groups.fromNames(e)},I.MultiSelect(V3(rn.Groups.Names),I.objectToOptions(rn.Groups.Names)))},function(e){return rn.Groups.toNames(e.groups).length+" group(s)"},{defaultValue:[{script:Li("(sel.atom.all)","mol-script"),groups:0}]})}}})({canAutoUpdate:function(){return!0},apply:function(e){var t=e.a,r=e.params,n=t.data.sourceData,i=rn.ofScript(r.layers,n);return new ge.Molecule.Structure.Representation3DState({state:{clipping:i},initialState:{clipping:rn.Empty},info:n,repr:t.data.repr},{label:"Clipping ("+i.layers.length+" Layers)"})},update:function(e){var t=e.a,r=e.b,n=e.newParams;e.oldParams;var i=r.data.info;if(t.data.sourceData!==i||t.data.repr!==r.data.repr)return ft.UpdateResult.Recreate;var a=r.data.state.clipping,o=rn.ofScript(n.layers,i);return rn.areEqual(a,o)?ft.UpdateResult.Unchanged:(r.data.state.clipping=o,r.data.repr=t.data.repr,r.label="Clipping ("+o.layers.length+" Layers)",ft.UpdateResult.Updated)}}),IVe=kt.BuiltIn({name:"clipping-structure-representation-3d-from-bundle",display:"Clipping 3D Representation",from:ge.Molecule.Structure.Representation3D,to:ge.Molecule.Structure.Representation3DState,params:function(){return{layers:I.ObjectList({bundle:I.Value(Jr.Empty),groups:I.Converted(function(e){return rn.Groups.toNames(e)},function(e){return rn.Groups.fromNames(e)},I.MultiSelect(V3(rn.Groups.Names),I.objectToOptions(rn.Groups.Names)))},function(e){return rn.Groups.toNames(e.groups).length+" group(s)"},{defaultValue:[{bundle:Jr.Empty,groups:0}],isHidden:!0})}}})({canAutoUpdate:function(){return!0},apply:function(e){var t=e.a,r=e.params,n=t.data.sourceData,i=rn.ofBundle(r.layers,n);return new ge.Molecule.Structure.Representation3DState({state:{clipping:i},initialState:{clipping:rn.Empty},info:n,repr:t.data.repr},{label:"Clipping ("+i.layers.length+" Layers)"})},update:function(e){var t=e.a,r=e.b,n=e.newParams;e.oldParams;var i=r.data.info;if(t.data.sourceData!==i||t.data.repr!==r.data.repr)return ft.UpdateResult.Recreate;var a=r.data.state.clipping,o=rn.ofBundle(n.layers,i);return rn.areEqual(a,o)?ft.UpdateResult.Unchanged:(r.data.state.clipping=o,r.data.repr=t.data.repr,r.label="Clipping ("+o.layers.length+" Layers)",ft.UpdateResult.Updated)}}),xc;(function(e){function t(i,a,o,s){var u=i.representation.volume.registry.get(a),l={volume:o},c=i.representation.volume.themes.colorThemeRegistry.get(u.defaultColorTheme.name).getParams(l),d=i.representation.volume.themes.sizeThemeRegistry.get(u.defaultSizeTheme.name).getParams(l),f=I.getDefaultValues(u.getParams(i.representation.volume.themes,o));return{type:{name:a,params:s?E(E({},f),s):f},colorTheme:{name:u.defaultColorTheme.name,params:I.getDefaultValues(c)},sizeTheme:{name:u.defaultSizeTheme.name,params:I.getDefaultValues(d)}}}e.getDefaultParams=t;function r(i,a,o,s,u,l,c){var d=i.representation.volume.registry.get(a),f=i.representation.volume.themes.colorThemeRegistry.get(s||d.defaultColorTheme.name),h=i.representation.volume.themes.sizeThemeRegistry.get(l||d.defaultSizeTheme.name);return{type:{name:a,params:o?E(E({},d.defaultValues),o):d.defaultValues},colorTheme:{name:d.defaultColorTheme.name,params:u?E(E({},f.defaultValues),u):f.defaultValues},sizeTheme:{name:d.defaultSizeTheme.name,params:c?E(E({},h.defaultValues),c):h.defaultValues}}}e.getDefaultParamsStatic=r;function n(i){var a,o,s,u;if(i.isoValue)return Ct.IsoValue.toString(i.isoValue);if(!((o=(a=i.renderMode)===null||a===void 0?void 0:a.params)===null||o===void 0)&&o.isoValue)return Ct.IsoValue.toString((u=(s=i.renderMode)===null||s===void 0?void 0:s.params)===null||u===void 0?void 0:u.isoValue)}e.getDescription=n})(xc||(xc={}));var MVe=kt.BuiltIn({name:"volume-representation-3d",display:"3D Representation",from:ge.Volume.Data,to:ge.Volume.Representation3D,params:function(e,t){var r=t.representation.volume,n=r.registry,i=r.themes,a=n.get(n.default.name);if(!e)return{type:I.Mapped(n.default.name,n.types,function(s){return I.Group(n.get(s).getParams(i,Ct.One))}),colorTheme:I.Mapped(a.defaultColorTheme.name,i.colorThemeRegistry.types,function(s){return I.Group(i.colorThemeRegistry.get(s).getParams({volume:Ct.One}))}),sizeTheme:I.Mapped(a.defaultSizeTheme.name,i.sizeThemeRegistry.types,function(s){return I.Group(i.sizeThemeRegistry.get(s).getParams({volume:Ct.One}))})};var o={volume:e.data};return{type:I.Mapped(n.default.name,n.types,function(s){return I.Group(n.get(s).getParams(i,e.data))}),colorTheme:I.Mapped(a.defaultColorTheme.name,i.colorThemeRegistry.getApplicableTypes(o),function(s){return I.Group(i.colorThemeRegistry.get(s).getParams(o))}),sizeTheme:I.Mapped(a.defaultSizeTheme.name,i.sizeThemeRegistry.types,function(s){return I.Group(i.sizeThemeRegistry.get(s).getParams(o))})}}})({canAutoUpdate:function(e){var t=e.oldParams,r=e.newParams;return t.type.name===r.type.name},apply:function(e,t){var r=this,n=e.a,i=e.params;return We.create("Volume Representation",function(a){return ce(r,void 0,void 0,function(){var o,s,u,l,c;return de(this,function(d){switch(d.label){case 0:return o={runtime:a,assetManager:t.managers.asset},s=t.representation.volume.registry.get(i.type.name),s.ensureCustomProperties?[4,s.ensureCustomProperties.attach(o,n.data)]:[3,2];case 1:d.sent(),d.label=2;case 2:return u=s.factory(E({webgl:(c=t.canvas3d)===null||c===void 0?void 0:c.webgl},t.representation.volume.themes),s.getParams),u.setTheme(hi.create(t.representation.volume.themes,{volume:n.data},i)),l=i.type.params||{},[4,u.createOrUpdate(l,n.data).runInContext(a)];case 3:return d.sent(),[2,new ge.Volume.Representation3D({repr:u,sourceData:n.data},{label:s.label,description:xc.getDescription(l)})]}})})})},update:function(e,t){var r=this,n=e.a,i=e.b,a=e.oldParams,o=e.newParams;return We.create("Volume Representation",function(s){return ce(r,void 0,void 0,function(){var u,l,c;return de(this,function(d){switch(d.label){case 0:return o.type.name!==a.type.name?(u=t.representation.volume.registry.get(a.type.name),(c=u.ensureCustomProperties)===null||c===void 0||c.detach(n.data),[2,ft.UpdateResult.Recreate]):(l=E(E({},i.data.repr.props),o.type.params),i.data.repr.setTheme(hi.create(t.representation.volume.themes,{volume:n.data},o)),[4,i.data.repr.createOrUpdate(l,n.data).runInContext(s)]);case 1:return d.sent(),i.data.sourceData=n.data,i.description=xc.getDescription(l),[2,ft.UpdateResult.Updated]}})})})}}),DVe=kt.BuiltIn({name:"shape-representation-3d",display:"3D Representation",from:ge.Shape.Provider,to:ge.Shape.Representation3D,params:function(e,t){return e?e.data.params:Et.Params}})({canAutoUpdate:function(){return!0},apply:function(e,t){var r=this,n=e.a,i=e.params;return We.create("Shape Representation",function(a){return ce(r,void 0,void 0,function(){var o,s;return de(this,function(u){switch(u.label){case 0:return o=E(E({},I.getDefaultValues(n.data.params)),i),s=Pi(n.data.getShape,n.data.geometryUtils),[4,s.createOrUpdate(o,n.data.data).runInContext(a)];case 1:return u.sent(),[2,new ge.Shape.Representation3D({repr:s,sourceData:n.data},{label:n.data.label})]}})})})},update:function(e,t){var r=this,n=e.a,i=e.b;e.oldParams;var a=e.newParams;return We.create("Shape Representation",function(o){return ce(r,void 0,void 0,function(){var s;return de(this,function(u){switch(u.label){case 0:return s=E(E({},i.data.repr.props),a),[4,i.data.repr.createOrUpdate(s,n.data.data).runInContext(o)];case 1:return u.sent(),i.data.sourceData=n.data,[2,ft.UpdateResult.Updated]}})})})}}),RVe=kt.BuiltIn({name:"model-unitcell-3d",display:"Model Unit Cell",from:ge.Molecule.Model,to:ge.Shape.Representation3D,params:function(){return E({},Aj)}})({isApplicable:function(e){return!!si.Provider.get(e.data)},canAutoUpdate:function(e){return e.oldParams,e.newParams,!0},apply:function(e,t){var r=this,n=e.a,i=e.params;return We.create("Model Unit Cell",function(a){return ce(r,void 0,void 0,function(){var o,s,u,l;return de(this,function(c){switch(c.label){case 0:return o=si.Provider.get(n.data),o?(s=Pj(n.data,o,i),u=Zje(E({webgl:(l=t.canvas3d)===null||l===void 0?void 0:l.webgl},t.representation.structure.themes),function(){return Aj}),[4,u.createOrUpdate(i,s).runInContext(a)]):[2,In.Null];case 1:return c.sent(),[2,new ge.Shape.Representation3D({repr:u,sourceData:s},{label:"Unit Cell",description:o.spacegroup.name})]}})})})},update:function(e){var t=this,r=e.a,n=e.b,i=e.newParams;return We.create("Model Unit Cell",function(a){return ce(t,void 0,void 0,function(){var o,s,u;return de(this,function(l){switch(l.label){case 0:return o=si.Provider.get(r.data),o?(s=E(E({},n.data.repr.props),i),u=Pj(r.data,o,s),[4,n.data.repr.createOrUpdate(s,u).runInContext(a)]):[2,ft.UpdateResult.Null];case 1:return l.sent(),n.data.sourceData=u,[2,ft.UpdateResult.Updated]}})})})}}),kVe=kt.BuiltIn({name:"structure-bounding-box-3d",display:"Bounding Box",from:ge.Molecule.Structure,to:ge.Shape.Representation3D,params:E({radius:I.Numeric(.05,{min:.01,max:4,step:.01},{isEssential:!0}),color:I.Color(dr.red,{isEssential:!0})},Nt.Params)})({canAutoUpdate:function(){return!0},apply:function(e,t){var r=this,n=e.a,i=e.params;return We.create("Bounding Box",function(a){return ce(r,void 0,void 0,function(){var o;return de(this,function(s){switch(s.label){case 0:return o=Pi(function(u,l,c,d){var f=VO(l.box,l.radius,d==null?void 0:d.geometry);return kr.create("Bouding Box",l,f,function(){return l.color},function(){return 1},function(){return"Bounding Box"})},Nt.Utils),[4,o.createOrUpdate(i,{box:n.data.boundary.box,radius:i.radius,color:i.color}).runInContext(a)];case 1:return s.sent(),[2,new ge.Shape.Representation3D({repr:o,sourceData:n.data},{label:"Bounding Box"})]}})})})},update:function(e,t){var r=this,n=e.a,i=e.b;e.oldParams;var a=e.newParams;return We.create("Bounding Box",function(o){return ce(r,void 0,void 0,function(){return de(this,function(s){switch(s.label){case 0:return[4,i.data.repr.createOrUpdate(a,{box:n.data.boundary.box,radius:a.radius,color:a.color}).runInContext(o)];case 1:return s.sent(),i.data.sourceData=n.data,[2,ft.UpdateResult.Updated]}})})})}}),OVe=kt.BuiltIn({name:"structure-selections-distance-3d",display:"3D Distance",from:ge.Molecule.Structure.Selections,to:ge.Shape.Representation3D,params:function(){return E({},Ij)}})({canAutoUpdate:function(e){return e.oldParams,e.newParams,!0},apply:function(e,t){var r=this,n=e.a,i=e.params;return We.create("Structure Distance",function(a){return ce(r,void 0,void 0,function(){var o,s,u;return de(this,function(l){switch(l.label){case 0:return o=Mj(n.data),s=dze(E({webgl:(u=t.canvas3d)===null||u===void 0?void 0:u.webgl},t.representation.structure.themes),function(){return Ij}),[4,s.createOrUpdate(i,o).runInContext(a)];case 1:return l.sent(),[2,new ge.Shape.Representation3D({repr:s,sourceData:o},{label:"Distance"})]}})})})},update:function(e,t){var r=this,n=e.a,i=e.b;e.oldParams;var a=e.newParams;return We.create("Structure Distance",function(o){return ce(r,void 0,void 0,function(){var s,u;return de(this,function(l){switch(l.label){case 0:return s=E(E({},i.data.repr.props),a),u=Mj(n.data),[4,i.data.repr.createOrUpdate(s,u).runInContext(o)];case 1:return l.sent(),i.data.sourceData=u,[2,ft.UpdateResult.Updated]}})})})}}),LVe=kt.BuiltIn({name:"structure-selections-angle-3d",display:"3D Angle",from:ge.Molecule.Structure.Selections,to:ge.Shape.Representation3D,params:function(){return E({},Uj)}})({canAutoUpdate:function(e){return e.oldParams,e.newParams,!0},apply:function(e,t){var r=this,n=e.a,i=e.params;return We.create("Structure Angle",function(a){return ce(r,void 0,void 0,function(){var o,s,u;return de(this,function(l){switch(l.label){case 0:return o=Dj(n.data),s=Qze(E({webgl:(u=t.canvas3d)===null||u===void 0?void 0:u.webgl},t.representation.structure.themes),function(){return Uj}),[4,s.createOrUpdate(i,o).runInContext(a)];case 1:return l.sent(),[2,new ge.Shape.Representation3D({repr:s,sourceData:o},{label:"Angle"})]}})})})},update:function(e,t){var r=this,n=e.a,i=e.b;e.oldParams;var a=e.newParams;return We.create("Structure Angle",function(o){return ce(r,void 0,void 0,function(){var s,u;return de(this,function(l){switch(l.label){case 0:return s=E(E({},i.data.repr.props),a),u=Dj(n.data),[4,i.data.repr.createOrUpdate(s,u).runInContext(o)];case 1:return l.sent(),i.data.sourceData=u,[2,ft.UpdateResult.Updated]}})})})}}),NVe=kt.BuiltIn({name:"structure-selections-dihedral-3d",display:"3D Dihedral",from:ge.Molecule.Structure.Selections,to:ge.Shape.Representation3D,params:function(){return E({},jj)}})({canAutoUpdate:function(e){return e.oldParams,e.newParams,!0},apply:function(e,t){var r=this,n=e.a,i=e.params;return We.create("Structure Dihedral",function(a){return ce(r,void 0,void 0,function(){var o,s,u;return de(this,function(l){switch(l.label){case 0:return o=Rj(n.data),s=yVe(E({webgl:(u=t.canvas3d)===null||u===void 0?void 0:u.webgl},t.representation.structure.themes),function(){return jj}),[4,s.createOrUpdate(i,o).runInContext(a)];case 1:return l.sent(),[2,new ge.Shape.Representation3D({repr:s,sourceData:o},{label:"Dihedral"})]}})})})},update:function(e,t){var r=this,n=e.a,i=e.b;e.oldParams;var a=e.newParams;return We.create("Structure Dihedral",function(o){return ce(r,void 0,void 0,function(){var s,u;return de(this,function(l){switch(l.label){case 0:return s=E(E({},i.data.repr.props),a),u=Rj(n.data),[4,i.data.repr.createOrUpdate(s,u).runInContext(o)];case 1:return l.sent(),i.data.sourceData=u,[2,ft.UpdateResult.Updated]}})})})}}),FVe=kt.BuiltIn({name:"structure-selections-label-3d",display:"3D Label",from:ge.Molecule.Structure.Selections,to:ge.Shape.Representation3D,params:function(){return E({},Lj)}})({canAutoUpdate:function(e){return e.oldParams,e.newParams,!0},apply:function(e,t){var r=this,n=e.a,i=e.params;return We.create("Structure Label",function(a){return ce(r,void 0,void 0,function(){var o,s,u;return de(this,function(l){switch(l.label){case 0:return o=kj(n.data),s=gze(E({webgl:(u=t.canvas3d)===null||u===void 0?void 0:u.webgl},t.representation.structure.themes),function(){return Lj}),[4,s.createOrUpdate(i,o).runInContext(a)];case 1:return l.sent(),[2,new ge.Shape.Representation3D({repr:s,sourceData:o},{label:"Label"})]}})})})},update:function(e,t){var r=this,n=e.a,i=e.b;e.oldParams;var a=e.newParams;return We.create("Structure Label",function(o){return ce(r,void 0,void 0,function(){var s,u;return de(this,function(l){switch(l.label){case 0:return s=E(E({},i.data.repr.props),a),u=kj(n.data),[4,i.data.repr.createOrUpdate(s,u).runInContext(o)];case 1:return l.sent(),i.data.sourceData=u,[2,ft.UpdateResult.Updated]}})})})}}),BVe=kt.BuiltIn({name:"structure-selections-orientation-3d",display:"3D Orientation",from:ge.Molecule.Structure.Selections,to:ge.Shape.Representation3D,params:function(){return E({},Bj)}})({canAutoUpdate:function(e){return e.oldParams,e.newParams,!0},apply:function(e,t){var r=this,n=e.a,i=e.params;return We.create("Structure Orientation",function(a){return ce(r,void 0,void 0,function(){var o,s,u;return de(this,function(l){switch(l.label){case 0:return o=Oj(n.data),s=Fze(E({webgl:(u=t.canvas3d)===null||u===void 0?void 0:u.webgl},t.representation.structure.themes),function(){return Bj}),[4,s.createOrUpdate(i,o).runInContext(a)];case 1:return l.sent(),[2,new ge.Shape.Representation3D({repr:s,sourceData:o},{label:"Orientation"})]}})})})},update:function(e,t){var r=this,n=e.a,i=e.b;e.oldParams;var a=e.newParams;return We.create("Structure Orientation",function(o){return ce(r,void 0,void 0,function(){var s,u;return de(this,function(l){switch(l.label){case 0:return s=E(E({},i.data.repr.props),a),u=Oj(n.data),[4,i.data.repr.createOrUpdate(s,u).runInContext(o)];case 1:return l.sent(),i.data.sourceData=u,[2,ft.UpdateResult.Updated]}})})})}});const UVe=Object.freeze(Object.defineProperty({__proto__:null,ClippingStructureRepresentation3DFromBundle:IVe,ClippingStructureRepresentation3DFromScript:TVe,ExplodeStructureRepresentation3D:CVe,ModelUnitcell3D:RVe,OverpaintStructureRepresentation3DFromBundle:EVe,OverpaintStructureRepresentation3DFromScript:wVe,ShapeRepresentation3D:DVe,SpinStructureRepresentation3D:_Ve,StructureBoundingBox3D:kVe,StructureRepresentation3D:b_,StructureSelectionsAngle3D:LVe,StructureSelectionsDihedral3D:NVe,StructureSelectionsDistance3D:OVe,StructureSelectionsLabel3D:FVe,StructureSelectionsOrientation3D:BVe,TransparencyStructureRepresentation3DFromBundle:PVe,TransparencyStructureRepresentation3DFromScript:AVe,UnwindStructureAssemblyRepresentation3D:SVe,VolumeRepresentation3D:MVe,get VolumeRepresentation3DHelpers(){return xc}},Symbol.toStringTag,{value:"Module"}));var rt={Data:_Le,Misc:ELe,Model:B9e,Volume:K9e,Representation:UVe,Shape:xVe},jVe={H:"Hydrogen",HE:"Helium",LI:"Lithium",BE:"Beryllium",B:"Boron",C:"Carbon",N:"Nitrogen",O:"Oxygen",F:"Fluorine",NE:"Neon",NA:"Sodium",MG:"Magnesium",AL:"Aluminum",SI:"Silicon",P:"Phosphorus",S:"Sulfur",CL:"Chlorine",AR:"Argon",K:"Potassium",CA:"Calcium",SC:"Scandium",TI:"Titanium",V:"Vanadium",CR:"Chromium",MN:"Manganese",FE:"Iron",CO:"Cobalt",NI:"Nickel",CU:"Copper",ZN:"Zinc",GA:"Gallium",GE:"Germanium",AS:"Arsenic",SE:"Selenium",BR:"Bromine",KR:"Krypton",RB:"Rubidium",SR:"Strontium",Y:"Yttrium",ZR:"Zirconium",NB:"Niobium",MO:"Molybdenum",TC:"Technetium",RU:"Ruthenium",RH:"Rhodium",PD:"Palladium",AG:"Silver",CD:"Cadmium",IN:"Indium",SN:"Tin",SB:"Antimony",TE:"Tellurium",I:"Iodine",XE:"Xenon",CS:"Cesium",BA:"Barium",LA:"Lanthanum",CE:"Cerium",PR:"Praseodymium",ND:"Neodymium",PM:"Promethium",SM:"Samarium",EU:"Europium",GD:"Gadolinium",TB:"Terbium",DY:"Dysprosium",HO:"Holmium",ER:"Erbium",TM:"Thulium",YB:"Ytterbium",LU:"Lutetium",HF:"Hafnium",TA:"Tantalum",W:"Wolfram",RE:"Rhenium",OS:"Osmium",IR:"Iridium",PT:"Platinum",AU:"Gold",HG:"Mercury",TL:"Thallium",PB:"Lead",BI:"Bismuth",PO:"Polonium",AT:"Astatine",RN:"Radon",FR:"Francium",RA:"Radium",AC:"Actinium",TH:"Thorium",PA:"Protactinium",U:"Uranium",NP:"Neptunium",PU:"Plutonium",AM:"Americium",CM:"Curium",BK:"Berkelium",CF:"Californium",ES:"Einsteinium",FM:"Fermium",MD:"Mendelevium",NO:"Nobelium",LR:"Lawrencium",RF:"Rutherfordium",DB:"Dubnium",SG:"Seaborgium",BH:"Bohrium",HS:"Hassium",MT:"Meitnerium",DS:"Darmstadtium",RG:"Roentgenium",CN:"Copernicium",NH:"Nihonium",FL:"Flerovium",MC:"Moscovium",LV:"Livermorium",TS:"Tennessine",OG:"Oganesson"},zVe=new Set(["LI","NA","K","RB","CS","FR"]);function VVe(e){return zVe.has(e)}var HVe=new Set(["BE","MG","CA","SR","BA","RA"]);function GVe(e){return HVe.has(e)}var qVe=new Set(["ZN","GA","CD","IN","SN","HG","TI","PB","BI","PO","CN"]);function WVe(e){return qVe.has(e)}var $Ve=new Set(["F","CL","BR","I","AT"]);function XVe(e){return $Ve.has(e)}function qJ(e){var t=Tb(e);return t>=21&&t<=29||t>=39&&t<=47||t>=72&&t<=79||t>=104&&t<=108}function YVe(e){var t=Tb(e);return t>=57&&t<=71}function KVe(e){var t=Tb(e);return t>=89&&t<=103}function QVe(e){return VVe(e)||GVe(e)||YVe(e)||KVe(e)||qJ(e)||WVe(e)}var Br;(function(e){e.Type="Type",e.Structure="Structure Property",e.Atom="Atom Property",e.Bond="Bond Property",e.Residue="Residue Property",e.AminoAcid="Amino Acid",e.NucleicBase="Nucleic Base",e.Manipulate="Manipulate Selection",e.Validation="Validation",e.Misc="Miscellaneous",e.Internal="Internal"})(Br||(Br={}));function Ur(e,t,r){var n;r===void 0&&(r={});var i;return{label:e,expression:t,description:r.description||"",category:(n=r.category)!==null&&n!==void 0?n:Br.Misc,isHidden:!!r.isHidden,priority:r.priority||0,referencesCurrent:!!r.referencesCurrent,get query(){return i||(i=Kp(t)),i},ensureCustomProperties:r.ensureCustomProperties,getSelection:function(a,o,s){return ce(this,void 0,void 0,function(){var u,l;return de(this,function(c){switch(c.label){case 0:return u=a.managers.structure.selection.getStructure(s),l=u?mt.Sequence(s,[u]):mt.Empty(s),r.ensureCustomProperties?[4,r.ensureCustomProperties({runtime:o,assetManager:a.managers.asset},s)]:[3,2];case 1:c.sent(),c.label=2;case 2:return i||(i=Kp(t)),[2,i(new Qo(s,{currentSelection:l}))]}})})}}}var ZVe=Ur("All",se.struct.generator.all(),{category:"",priority:1e3}),JVe=Ur("Current Selection",se.internal.generator.current(),{category:"",referencesCurrent:!0}),eHe=Ur("Polymer",se.struct.modifier.union([se.struct.generator.atomGroups({"entity-test":se.core.logic.and([se.core.rel.eq([se.ammp("entityType"),"polymer"]),se.core.str.match([se.re("(polypeptide|cyclic-pseudo-peptide|peptide-like|nucleotide|peptide nucleic acid)","i"),se.ammp("entitySubtype")])])})]),{category:Br.Type}),tHe=Ur("Trace",se.struct.modifier.union([se.struct.combinator.merge([se.struct.modifier.union([se.struct.generator.atomGroups({"entity-test":se.core.rel.eq([se.ammp("entityType"),"polymer"]),"chain-test":se.core.set.has([se.set("sphere","gaussian"),se.ammp("objectPrimitive")])})]),se.struct.modifier.union([se.struct.generator.atomGroups({"entity-test":se.core.rel.eq([se.ammp("entityType"),"polymer"]),"chain-test":se.core.rel.eq([se.ammp("objectPrimitive"),"atomistic"]),"atom-test":se.core.set.has([se.set("CA","P"),se.ammp("label_atom_id")])})])])]),{category:Br.Structure}),i0=se.core.logic.and([se.core.rel.eq([se.ammp("entityType"),"polymer"]),se.core.str.match([se.re("(polypeptide|cyclic-pseudo-peptide|peptide-like)","i"),se.ammp("entitySubtype")])]),J3=se.core.logic.and([se.core.rel.eq([se.ammp("entityType"),"polymer"]),se.core.str.match([se.re("(nucleotide|peptide nucleic acid)","i"),se.ammp("entitySubtype")])]),Jp=se.core.str.match([se.re("non-polymer|(amino|carboxy) terminus|peptide-like","i"),se.ammp("chemCompType")]),rHe=Ur("Backbone",se.struct.modifier.union([se.struct.combinator.merge([se.struct.modifier.union([se.struct.generator.atomGroups({"entity-test":i0,"chain-test":se.core.rel.eq([se.ammp("objectPrimitive"),"atomistic"]),"residue-test":se.core.logic.not([Jp]),"atom-test":se.core.set.has([se.set.apply(se,li.toArray(Nc)),se.ammp("label_atom_id")])})]),se.struct.modifier.union([se.struct.generator.atomGroups({"entity-test":J3,"chain-test":se.core.rel.eq([se.ammp("objectPrimitive"),"atomistic"]),"residue-test":se.core.logic.not([Jp]),"atom-test":se.core.set.has([se.set.apply(se,li.toArray(_3)),se.ammp("label_atom_id")])})])])]),{category:Br.Structure}),nHe=Ur("Sidechain",se.struct.modifier.union([se.struct.combinator.merge([se.struct.modifier.union([se.struct.generator.atomGroups({"entity-test":i0,"chain-test":se.core.rel.eq([se.ammp("objectPrimitive"),"atomistic"]),"residue-test":se.core.logic.not([Jp]),"atom-test":se.core.logic.or([se.core.logic.not([se.core.set.has([se.set.apply(se,li.toArray(Nc)),se.ammp("label_atom_id")])])])})]),se.struct.modifier.union([se.struct.generator.atomGroups({"entity-test":J3,"chain-test":se.core.rel.eq([se.ammp("objectPrimitive"),"atomistic"]),"residue-test":se.core.logic.not([Jp]),"atom-test":se.core.logic.or([se.core.logic.not([se.core.set.has([se.set.apply(se,li.toArray(_3)),se.ammp("label_atom_id")])])])})])])]),{category:Br.Structure}),iHe=Ur("Sidechain with Trace",se.struct.modifier.union([se.struct.combinator.merge([se.struct.modifier.union([se.struct.generator.atomGroups({"entity-test":i0,"chain-test":se.core.rel.eq([se.ammp("objectPrimitive"),"atomistic"]),"residue-test":se.core.logic.not([Jp]),"atom-test":se.core.logic.or([se.core.logic.not([se.core.set.has([se.set.apply(se,li.toArray(Nc)),se.ammp("label_atom_id")])]),se.core.rel.eq([se.ammp("label_atom_id"),"CA"]),se.core.logic.and([se.core.rel.eq([se.ammp("auth_comp_id"),"PRO"]),se.core.rel.eq([se.ammp("label_atom_id"),"N"])])])})]),se.struct.modifier.union([se.struct.generator.atomGroups({"entity-test":J3,"chain-test":se.core.rel.eq([se.ammp("objectPrimitive"),"atomistic"]),"residue-test":se.core.logic.not([Jp]),"atom-test":se.core.logic.or([se.core.logic.not([se.core.set.has([se.set.apply(se,li.toArray(_3)),se.ammp("label_atom_id")])]),se.core.rel.eq([se.ammp("label_atom_id"),"P"])])})])])]),{category:Br.Structure}),aHe=Ur("Protein",se.struct.modifier.union([se.struct.generator.atomGroups({"entity-test":i0})]),{category:Br.Type}),oHe=Ur("Nucleic",se.struct.modifier.union([se.struct.generator.atomGroups({"entity-test":J3})]),{category:Br.Type}),sHe=Ur("Helix",se.struct.modifier.union([se.struct.generator.atomGroups({"entity-test":i0,"residue-test":se.core.flags.hasAny([se.ammp("secondaryStructureFlags"),se.core.type.bitflags([2])])})]),{category:Br.Structure}),uHe=Ur("Beta Strand/Sheet",se.struct.modifier.union([se.struct.generator.atomGroups({"entity-test":i0,"residue-test":se.core.flags.hasAny([se.ammp("secondaryStructureFlags"),se.core.type.bitflags([4])])})]),{category:Br.Structure}),lHe=Ur("Water",se.struct.modifier.union([se.struct.generator.atomGroups({"entity-test":se.core.rel.eq([se.ammp("entityType"),"water"])})]),{category:Br.Type}),cHe=Ur("Ion",se.struct.modifier.union([se.struct.generator.atomGroups({"entity-test":se.core.rel.eq([se.ammp("entitySubtype"),"ion"])})]),{category:Br.Type}),dHe=Ur("Lipid",se.struct.modifier.union([se.struct.generator.atomGroups({"entity-test":se.core.rel.eq([se.ammp("entitySubtype"),"lipid"])})]),{category:Br.Type}),eE=Ur("Carbohydrate",se.struct.modifier.union([se.struct.generator.atomGroups({"entity-test":se.core.logic.or([se.core.rel.eq([se.ammp("entityType"),"branched"]),se.core.logic.and([se.core.rel.eq([se.ammp("entityType"),"non-polymer"]),se.core.str.match([se.re("oligosaccharide","i"),se.ammp("entitySubtype")])])])})]),{category:Br.Type}),WJ=Ur("Carbohydrate with Connected",se.struct.modifier.union([se.struct.modifier.includeConnected({0:eE.expression,"layer-count":1,"as-whole-residues":!0})]),{category:Br.Internal,isHidden:!0}),$J=Ur("Connected to Carbohydrate",se.struct.modifier.union([se.struct.modifier.exceptBy({0:WJ.expression,by:eE.expression})]),{category:Br.Internal,isHidden:!0}),HO=Ur("Ligand",se.struct.modifier.union([se.struct.combinator.merge([se.struct.modifier.union([se.struct.generator.atomGroups({"entity-test":se.core.logic.and([se.core.logic.or([se.core.rel.eq([se.ammp("entityType"),"non-polymer"]),se.core.rel.neq([se.ammp("entityPrdId"),""])]),se.core.logic.not([se.core.str.match([se.re("(oligosaccharide|lipid|ion)","i"),se.ammp("entitySubtype")])])]),"chain-test":se.core.rel.eq([se.ammp("objectPrimitive"),"atomistic"]),"residue-test":se.core.logic.not([se.core.str.match([se.re("saccharide","i"),se.ammp("chemCompType")])])})]),se.struct.modifier.union([se.struct.generator.atomGroups({"entity-test":se.core.rel.eq([se.ammp("entityType"),"polymer"]),"chain-test":se.core.rel.eq([se.ammp("objectPrimitive"),"atomistic"]),"residue-test":Jp})])])]),{category:Br.Type}),XJ=Ur("Ligand with Connected",se.struct.modifier.union([se.struct.modifier.exceptBy({0:se.struct.modifier.union([se.struct.modifier.includeConnected({0:HO.expression,"layer-count":1,"as-whole-residues":!0,"bond-test":se.core.flags.hasAny([se.struct.bondProperty.flags(),se.core.type.bitflags([3])])})]),by:eE.expression})]),{category:Br.Internal,isHidden:!0}),YJ=Ur("Connected to Ligand",se.struct.modifier.union([se.struct.modifier.exceptBy({0:XJ.expression,by:HO.expression})]),{category:Br.Internal,isHidden:!0}),fHe=Ur("Connected to Ligand or Carbohydrate",se.struct.modifier.union([se.struct.combinator.merge([$J.expression,YJ.expression])]),{category:Br.Internal,isHidden:!0}),hHe=Ur("Disulfide Bridges",se.struct.modifier.union([se.struct.combinator.merge([se.struct.modifier.union([se.struct.modifier.wholeResidues([se.struct.filter.isConnectedTo({0:se.struct.generator.atomGroups({"residue-test":se.core.set.has([se.set("CYS"),se.ammp("auth_comp_id")]),"atom-test":se.core.set.has([se.set("SG"),se.ammp("label_atom_id")])}),target:se.struct.generator.atomGroups({"residue-test":se.core.set.has([se.set("CYS"),se.ammp("auth_comp_id")]),"atom-test":se.core.set.has([se.set("SG"),se.ammp("label_atom_id")])}),"bond-test":!0})])]),se.struct.modifier.union([se.struct.modifier.wholeResidues([se.struct.modifier.union([se.struct.generator.bondedAtomicPairs({0:se.core.flags.hasAny([se.struct.bondProperty.flags(),se.core.type.bitflags([8])])})])])])])]),{category:Br.Bond}),pHe=Ur("NOS Bridges",se.struct.modifier.union([se.struct.modifier.wholeResidues([se.struct.filter.isConnectedTo({0:se.struct.generator.atomGroups({"residue-test":se.core.set.has([se.set("CSO","LYS"),se.ammp("auth_comp_id")]),"atom-test":se.core.set.has([se.set("OD","NZ"),se.ammp("label_atom_id")])}),target:se.struct.generator.atomGroups({"residue-test":se.core.set.has([se.set("CSO","LYS"),se.ammp("auth_comp_id")]),"atom-test":se.core.set.has([se.set("OD","NZ"),se.ammp("label_atom_id")])}),"bond-test":!0})])]),{category:Br.Bond}),vHe=Ur("Non-standard Residues in Polymers",se.struct.modifier.union([se.struct.generator.atomGroups({"entity-test":se.core.rel.eq([se.ammp("entityType"),"polymer"]),"chain-test":se.core.rel.eq([se.ammp("objectPrimitive"),"atomistic"]),"residue-test":se.ammp("isNonStandard")})]),{category:Br.Residue}),mHe=Ur("Coarse Elements",se.struct.modifier.union([se.struct.generator.atomGroups({"chain-test":se.core.set.has([se.set("sphere","gaussian"),se.ammp("objectPrimitive")])})]),{category:Br.Type}),gHe=Ur("Rings in Residues",se.struct.modifier.union([se.struct.generator.rings()]),{category:Br.Residue}),yHe=Ur("Aromatic Rings in Residues",se.struct.modifier.union([se.struct.generator.rings({"only-aromatic":!0})]),{category:Br.Residue}),bHe=Ur("Surrounding Residues (5 Å) of Selection",se.struct.modifier.union([se.struct.modifier.exceptBy({0:se.struct.modifier.includeSurroundings({0:se.internal.generator.current(),radius:5,"as-whole-residues":!0}),by:se.internal.generator.current()})]),{description:"Select residues within 5 Å of the current selection.",category:Br.Manipulate,referencesCurrent:!0}),xHe=Ur("Surrounding Ligands (5 Å) of Selection",se.struct.modifier.union([se.struct.modifier.surroundingLigands({0:se.internal.generator.current(),radius:5,"include-water":!0})]),{description:"Select ligand components within 5 Å of the current selection.",category:Br.Manipulate,referencesCurrent:!0}),SHe=Ur("Inverse / Complement of Selection",se.struct.modifier.union([se.struct.modifier.exceptBy({0:se.struct.generator.all(),by:se.internal.generator.current()})]),{description:"Select everything not in the current selection.",category:Br.Manipulate,referencesCurrent:!0}),CHe=Ur("Residues Covalently Bonded to Selection",se.struct.modifier.union([se.struct.modifier.includeConnected({0:se.internal.generator.current(),"layer-count":1,"as-whole-residues":!0})]),{description:"Select residues covalently bonded to current selection.",category:Br.Manipulate,referencesCurrent:!0}),_He=Ur("Covalently Bonded Component",se.struct.modifier.union([se.struct.modifier.includeConnected({0:se.internal.generator.current(),"fixed-point":!0})]),{description:"Select covalently bonded component based on current selection.",category:Br.Manipulate,referencesCurrent:!0}),wHe=Ur("Residues with Cov. or Metallic Bond to Selection",se.struct.modifier.union([se.struct.modifier.includeConnected({0:se.internal.generator.current(),"layer-count":1,"as-whole-residues":!0,"bond-test":se.core.flags.hasAny([se.struct.bondProperty.flags(),se.core.type.bitflags([3])])})]),{description:"Select residues with covalent or metallic bond to current selection.",category:Br.Manipulate,referencesCurrent:!0}),EHe=Ur("Whole Residues of Selection",se.struct.modifier.union([se.struct.modifier.wholeResidues({0:se.internal.generator.current()})]),{description:"Expand current selection to whole residues.",category:Br.Manipulate,referencesCurrent:!0}),AHe=[[["HIS"],"Histidine"],[["ARG"],"Arginine"],[["LYS"],"Lysine"],[["ILE"],"Isoleucine"],[["PHE"],"Phenylalanine"],[["LEU"],"Leucine"],[["TRP"],"Tryptophan"],[["ALA"],"Alanine"],[["MET"],"Methionine"],[["PRO"],"Proline"],[["CYS"],"Cysteine"],[["ASN"],"Asparagine"],[["VAL"],"Valine"],[["GLY"],"Glycine"],[["SER"],"Serine"],[["GLN"],"Glutamine"],[["TYR"],"Tyrosine"],[["ASP"],"Aspartic Acid"],[["GLU"],"Glutamic Acid"],[["THR"],"Threonine"],[["SEC"],"Selenocysteine"],[["PYL"],"Pyrrolysine"],[["UNK"],"Unknown"]].sort(function(e,t){return e[1]<t[1]?-1:e[1]>t[1]?1:0}),PHe=[[["A","DA"],"Adenosine"],[["C","DC"],"Cytidine"],[["T","DT"],"Thymidine"],[["G","DG"],"Guanosine"],[["I","DI"],"Inosine"],[["U","DU"],"Uridine"],[["N","DN"],"Unknown"]].sort(function(e,t){return e[1]<t[1]?-1:e[1]>t[1]?1:0});function z5(e,t,r){var n=e[0],i=e[1];r===void 0&&(r=0);var a=n.length===1&&!KJ.has(n[0])?"["+n[0]+"] "+i:i+" ("+n.join(", ")+")";return Ur(a,se.struct.modifier.union([se.struct.generator.atomGroups({"residue-test":se.core.set.has([se.set.apply(se,n),se.ammp("auth_comp_id")])})]),{category:t,priority:r,description:a})}function THe(e,t,r){var n=e[0],i=e[1],a=i+" ("+n.join(", ")+")";return Ur(a,se.struct.modifier.union([se.struct.generator.atomGroups({"atom-test":se.core.set.has([se.set.apply(se,n),se.acp("elementSymbol")])})]),{category:t,priority:r,description:a})}function IHe(e,t,r){var n=e[0],i=e[1],a=""+i;return Ur(""+i,se.struct.modifier.union([se.struct.generator.atomGroups({"entity-test":se.core.list.equal([se.list.apply(se,n),se.ammp("entityDescription")])})]),{category:t,priority:r,description:a})}var KJ=li.unionMany(uO,A3,P3,w3);function MHe(e){for(var t=new Set,r=0,n=e;r<n.length;r++){var i=n[r];i.uniqueElementSymbols.forEach(function(o){return t.add(o)})}var a=[];return t.forEach(function(o){var s=jVe[o]||o;a.push(THe([[o],s],"Element Symbol",0))}),a}function DHe(e){for(var t=new Map,r=new Set,n=0,i=e;n<i.length;n++){var a=i[n];a.uniqueResidueNames.forEach(function(d){return r.add(d)});for(var o=function(d){a.uniqueResidueNames.forEach(function(f){var h=d.properties.chemicalComponentMap.get(f);h&&t.set(f,h.name)})},s=0,u=a.models;s<u.length;s++){var l=u[s];o(l)}}var c=[];return li.difference(r,KJ).forEach(function(d){var f=t.get(d)||d;c.push(z5([[d],f],"Ligand/Non-standard Residue",200))}),c}function RHe(e){for(var t=new Map,r=Ze.create(),n=0,i=e;n<i.length;n++){var a=i[n];r.structure=a;for(var o=0,s=a.unitSymmetryGroups;o<s.length;o++){var u=s[o];r.unit=u.units[0],r.element=u.elements[0];var l=lt.entity.type(r);if(l==="polymer"||l==="branched"){var c=lt.entity.pdbx_description(r);t.set(c.join(", "),c)}}}var d=[];return t.forEach(function(f,h){d.push(IHe([f,h],"Polymer/Carbohydrate Entities",300))}),d}var di={all:ZVe,current:JVe,polymer:eHe,trace:tHe,backbone:rHe,sidechain:nHe,sidechainWithTrace:iHe,protein:aHe,nucleic:oHe,helix:sHe,beta:uHe,water:lHe,ion:cHe,lipid:dHe,branched:eE,branchedPlusConnected:WJ,branchedConnectedOnly:$J,ligand:HO,ligandPlusConnected:XJ,ligandConnectedOnly:YJ,connectedOnly:fHe,disulfideBridges:hHe,nosBridges:pHe,nonStandardPolymer:vHe,coarse:mHe,ring:gHe,aromaticRing:yHe,surroundings:bHe,surroundingLigands:xHe,complement:SHe,covalentlyBonded:CHe,covalentlyOrMetallicBonded:wHe,covalentlyBondedComponent:_He,wholeResidues:EHe},kHe=function(){function e(){var t,r;this.list=[],this.options=[],this.version=1,(t=this.list).push.apply(t,Ft(Ft(Ft([],Object.values(di)),AHe.map(function(n){return z5(n,Br.AminoAcid)})),PHe.map(function(n){return z5(n,Br.NucleicBase)}))),(r=this.options).push.apply(r,this.list.map(function(n){return[n,n.label,n.category]}))}return e.prototype.add=function(t){this.list.push(t),this.options.push([t,t.label,t.category]),this.version+=1},e.prototype.remove=function(t){var r=this.list.indexOf(t);r!==-1&&(this.list.splice(r,1),this.options.splice(r,1),this.version+=1)},e}(),OHe=function(){function e(t,r){this.key=t,this.defaultValue=r}return e.prototype.toString=function(){return this.key},e.prototype.valueOf=function(){return this.key},e}();function ti(e,t){return new OHe(e,t)}var Wr={item:ti,General:{IsBusyTimeoutMs:ti("plugin-config.is-busy-timeout",750),DisableAntialiasing:ti("plugin-config.disable-antialiasing",!1),DisablePreserveDrawingBuffer:ti("plugin-config.disable-preserve-drawing-buffer",!1),PixelScale:ti("plugin-config.pixel-scale",1),PickScale:ti("plugin-config.pick-scale",.25),EnableWboit:ti("plugin-config.enable-wboit",!0)},State:{DefaultServer:ti("plugin-state.server","https://webchem.ncbr.muni.cz/molstar-state"),CurrentServer:ti("plugin-state.server","https://webchem.ncbr.muni.cz/molstar-state"),HistoryCapacity:ti("history-capacity.server",5)},VolumeStreaming:{Enabled:ti("volume-streaming.enabled",!0),DefaultServer:ti("volume-streaming.server","https://ds.litemol.org"),CanStream:ti("volume-streaming.can-stream",function(e,t){return e.models.length===1&&Wt.probablyHasDensityMap(e.models[0])}),EmdbHeaderServer:ti("volume-streaming.emdb-header-server","https://ftp.wwpdb.org/pub/emdb/structures")},Viewport:{ShowExpand:ti("viewer.show-expand-button",!0),ShowControls:ti("viewer.show-controls-button",!0),ShowSettings:ti("viewer.show-settings-button",!0),ShowSelectionMode:ti("viewer.show-selection-model-button",!0),ShowAnimation:ti("viewer.show-animation-button",!0)},Download:{DefaultPdbProvider:ti("download.default-pdb-provider","pdbe"),DefaultEmdbProvider:ti("download.default-emdb-provider","pdbe")},Structure:{SizeThresholds:ti("structure.size-thresholds",$e.DefaultSizeThresholds),DefaultRepresentationPresetParams:ti("structure.default-representation-preset-params",{})}},LHe=function(){function e(t){var r=this;this._config=new Map,t&&t.forEach(function(n){var i=n[0],a=n[1];return r._config.set(i,a)})}return e.prototype.get=function(t){return this._config.has(t)?this._config.get(t):t.defaultValue},e.prototype.set=function(t,r){this._config.set(t,r)},e.prototype.delete=function(t){this._config.delete(t)},e}();function Su(e,t,r,n){var i=0,a=t.webgl,o=new Qn,s=hd(),u=[],l=Ri.create(),c,d,f,h,v=hi.createEmpty();function p(x,C){var w=this;return x===void 0&&(x={}),C&&C!==d&&(f=r(t,C),d=C,h||(h=I.getDefaultValues(f))),h=Object.assign({},h,x),We.create("Creating or updating ComplexRepresentation",function(A){return ce(w,void 0,void 0,function(){var M,D,k;return de(this,function(R){switch(R.label){case 0:return M=!1,c?!((k=c.mustRecreate)===null||k===void 0)&&k.call(c,d,h,a)&&(c.destroy(),c=n(s,d,h,a),M=!0):(c=n(s,d,h,a),M=!0),D=c.createOrUpdate({webgl:a,runtime:A},v,h,C),D?[4,D]:[3,2];case 1:R.sent(),R.label=2;case 2:return M&&y(l),u.length=0,c&&c.renderObject&&u.push(c.renderObject),o.next(i++),[2]}})})})}function m(x){return x===void 0?$e.Loci(d.target):c?c.getLoci(x):Or}function g(x,C){if(!d||!So.is(l.markerActions,C))return!1;if($e.isLoci(x)||De.is(x)||Vt.isLoci(x)){if(!$e.areRootsEquivalent(x.structure,d))return!1;x=ar.remap(x,d)}else if(!Ds(x)&&!Ky(x))return!1;return ar.isEmpty(x)?!1:c?c.mark(x,C):!1}function y(x){if(Ri.update(l,x),x.visible!==void 0&&c&&c.setVisibility(x.visible&&(l.unitTransforms===null||l.unitTransforms.isIdentity)),x.alphaFactor!==void 0&&c&&c.setAlphaFactor(x.alphaFactor),x.pickable!==void 0&&c&&c.setPickable(x.pickable),x.overpaint!==void 0&&c){var C=Bi.remap(x.overpaint,d);c.setOverpaint(C)}if(x.transparency!==void 0&&c){var w=Ui.remap(x.transparency,d);c.setTransparency(w)}if(x.clipping!==void 0&&c){var A=rn.remap(x.clipping,d);c.setClipping(A)}x.transform!==void 0&&c&&c.setTransform(x.transform),x.unitTransforms!==void 0&&c&&c.setVisibility(l.visible&&(x.unitTransforms===null||x.unitTransforms.isIdentity))}function b(x){v=x}function S(){c&&c.destroy()}return{label:e,get groupCount(){return c?c.groupCount:0},get props(){return h},get params(){return f},get state(){return l},get theme(){return v},renderObjects:u,updated:o,createOrUpdate:p,setState:y,setTheme:b,getLoci:m,mark:g,destroy:S}}function QJ(e,t,r){var n=t.elements,i=t.model;if(Oe.indexOf(n,r)!==-1){for(var a=i.atomicHierarchy.residueAtomSegments,o=a.index,s=a.offsets,u=o[r],l=[],c=s[u],d=s[u+1];c<d;++c){var f=Oe.indexOf(n,c);f!==-1&&l.push(f)}var h=Oe.ofSortedArray(Je.ofSortedArray(l));return De(e,[{unit:t,indices:h}])}return Or}function NHe(e,t,r){var n=t.elements,i=t.model,a=i.atomicHierarchy.atoms.label_alt_id,o=a.value(r);if(Oe.indexOf(n,r)!==-1){var s=i.atomicHierarchy.residueAtomSegments.index,u=s[r];return nb(e,t,u,o)}return De(e,[])}function nb(e,t,r,n){for(var i=t.elements,a=t.model,o=a.atomicHierarchy.atoms.label_alt_id,s=a.atomicHierarchy.residueAtomSegments.offsets,u=[],l=s[r],c=s[r+1];l<c;++l){var d=Oe.indexOf(i,l);if(d!==-1){var f=o.value(l);(n===f||f==="")&&u.push(d)}}var h=Oe.ofSortedArray(Je.ofSortedArray(u));return De(e,[{unit:t,indices:h}])}function ZJ(e,t,r){for(var n=e.structure.child,i=t&&n?e.group.units.filter(function(l){return n.unitMap.has(l.id)}):e.group.units,a=i.length,o=a*16,s=r&&r.aTransform.ref.value.length>=o?r.aTransform.ref.value:new Float32Array(o),u=0;u<a;u++)ue.toArray(i[u].conformation.operator.matrix,s,u*16);return rO(s,a,r)}var FHe={atomic:{},spheres:{},gaussians:{}},BHe=I.objectToOptions(FHe);function UHe(e,t){for(var r=0,n=e.length;r<n;++r)if(Ue.isAtomic(t)&&e[r]==="atomic"||Ue.isSpheres(t)&&e[r]==="spheres"||Ue.isGaussians(t)&&e[r]==="gaussians")return!0;return!1}var JJ=5e8;function eee(e,t,r){r===void 0&&(r=JJ);var n=Xt.size(_(),e);_.ceil(n,n),n.sort(function(s,u){return u-s});var i=Math.floor(Math.cbrt(r)*Math.cbrt(r)),a=n[0]*n[1],o=Math.ceil(a/(t*t));return{area:a,areaCells:o,maxAreaCells:i}}function bv(e,t,r){r===void 0&&(r=JJ);var n=eee(e,t.resolution,r),i=n.area,a=n.areaCells,o=n.maxAreaCells,s=a>o?Math.sqrt(i/o):t.resolution;return E(E({},t),{resolution:s})}function jHe(e){switch(e.kind){case 0:return e.model.atomicConformation;case 1:return e.model.coarseConformation.spheres;case 2:return e.model.coarseConformation.gaussians}}var tE={ignoreHydrogens:I.Boolean(!1,{description:"Whether or not to include hydrogen atoms in the surface calculation."}),traceOnly:I.Boolean(!1,{description:"Whether or not to only use trace atoms in the surface calculation."}),includeParent:I.Boolean(!1,{description:"Include elements of the parent structure in surface calculation to get a surface patch of the current structure."})};I.getDefaultValues(tE);var zHe=_();function VHe(e,t,r,n){return _.squaredDistance(_.set(zHe,e,t,r),n)}function HHe(e,t,r){for(var n=0,i=t.length,a=0,o=r.length;a<o;++a){var s=Je.indexOfInRange(t,r[a],n,i);s===-1?e[a]=-2:(e[a]=s,n=s)}}function rE(e,t,r){var n=r.ignoreHydrogens,i=r.traceOnly,a=r.includeParent,o=a?e.root.unitMap.get(t.id):t,s=jHe(o),u=s.x,l=s.y,c=s.z,d=o.elements,f=t.boundary.sphere,h=f.center,v=f.radius,p=(2+1.5)*2,m=(v+p)*(v+p),g,y;if(n||i||a&&o!==t){for(var b=[],S=[],x=0,C=d.length;x<C;++x){var w=d[x];n&&x_(o,w)||i&&!qO(o,w)||a&&VHe(u[w],l[w],c[w],h)>m||(b.push(w),S.push(x))}g=Je.ofSortedArray(b),y=S}else g=d,y=Fs(new Int32Array(g.length));a&&o!==t&&HHe(y,t.elements,g);var A={indices:g,x:u,y:l,z:c,id:y},M=t===o?t.boundary:Eg(A),D=Ze.create(e,o),k=Ob({},{scale:1}),R=function(L){return D.element=L,k.size(D)};return{position:A,boundary:M,radius:R}}function GO(e,t,r){var n=Ze.create(e),i=Ob({},{scale:1}),a,o,s,u,l;if(t||r){for(var c=[],d=[],f=[],h=[],v=[],p=0,m=0,g=e.units.length;p<g;++p){var y=e.units[p],b=y.elements,S=y.conformation,x=S.x,C=S.y,w=S.z;n.unit=y;for(var A=0,M=b.length;A<M;++A){var D=b[A];t&&x_(y,D)||r&&!qO(y,D)||(c.push(x(D)),d.push(C(D)),f.push(w(D)),n.element=D,h.push(i.size(n)),v.push(m+A))}m+=b.length}a=c,o=d,s=f,u=h,l=v}else{for(var k=e.elementCount,c=new Float32Array(k),d=new Float32Array(k),f=new Float32Array(k),h=new Float32Array(k),p=0,m=0,g=e.units.length;p<g;++p){var y=e.units[p],b=y.elements,R=y.conformation,x=R.x,C=R.y,w=R.z;n.unit=y;for(var A=0,M=b.length;A<M;++A){var D=b[A],L=m+A;c[L]=x(D),d[L]=C(D),f[L]=w(D),n.element=D,h[L]=i.size(n)}m+=b.length}a=c,o=d,s=f,u=h,l=Fs(new Uint32Array(k))}var H={indices:Oe.ofRange(0,l.length),x:a,y:o,z:s,id:l},B=function(j){return u[j]};return{position:H,radius:B}}var tee=C3.H;function x_(e,t){return Ue.isCoarse(e)?!1:e.model.atomicHierarchy.derived.atom.atomicNumber[t]===tee}function S_(e,t){return e[t]===tee}function qO(e,t){if(Ue.isCoarse(e))return!0;var r=e.model.atomicHierarchy.atoms.label_atom_id.value(t);return r==="CA"||r==="BB"||r==="P"}function a0(e){if(Ue.isAtomic(e))return 4;for(var t=0,r=e.elements,n=e.conformation.r,i=0,a=r.length;i<a;i++){var o=n(r[i]);o>t&&(t=o)}return t+1}function nE(e){for(var t=0,r=0,n=e.unitSymmetryGroups;r<n.length;r++){var i=n[r],a=a0(i.units[0]);a>t&&(t=a)}return t}function Lb(e){return I.MultiSelect(e,BHe,{description:"For which kinds of units/chains to show the representation visuals."})}var Co={unitKinds:Lb(["atomic","spheres"]),includeParent:I.Boolean(!1,{isHidden:!0})},ree=E({},Nt.Params),GHe=E({},Zf.Params),nee=E({},Vo.Params),qHe=E({},Zp.Params),iee=E({},bn.Params),aee=E({},Bs.Params),oee=E({},Ya.Params),see=E({},Ru.Params);function WHe(e,t,r,n,i,a){var o=ra.getUtils(t),s=o.createValues,u=o.createRenderableState,l=iO(),c=s(t,l,r,n,i),d=u(i);return r0(t.kind,c,d,a)}function o0(e,t){var r=e.defaultProps,n=e.createGeometry,i=e.createLocationIterator,a=e.getLoci,o=e.eachLocation,s=e.setUpdateState,u=e.mustRecreate,l=e.processValues,c=e.dispose,d=e.geometryUtils,f=d.updateValues,h=d.updateBoundingSphere,v=d.updateRenderableState,p=d.createPositionIterator,m=Pl.create(),g,y,b,S,x=Object.assign({},r),C=hi.createEmpty(),w,A,M,D;function k(j,Q,G){if(!G&&!w)throw new Error("missing structure");if(y=Object.assign({},x,Q),b=j,S=G,Pl.reset(m),!g||!w){m.createNew=!0,m.createGeometry=!0;return}s(m,y,x,b,C,S,w),$e.areEquivalent(S,w)||(m.createGeometry=!0),$e.areHierarchiesEqual(S,w)||(m.updateTransform=!0,m.createGeometry=!0),jc.areEqual(j.color,C.color)||(m.updateColor=!0),Mc(y.unitKinds,x.unitKinds)||(m.createGeometry=!0),w.child!==S.child&&(m.createGeometry=!0),m.updateSize&&!("uSize"in g.values)&&(m.createGeometry=!0),m.createGeometry&&(m.updateColor=!0,m.updateSize=!0)}function R(j){if(m.createNew)if(M=i(S),j)g=WHe(S,j,M,b,y,t),D=p(j,g.values);else throw new Error("expected geometry to be given");else{if(!g)throw new Error("expected renderObject to be available");if(m.updateTransform){M=i(S);var Q=M.instanceCount,G=M.groupCount;Hs(Q*G,g.values)}if(m.createGeometry)if(j)N.updateIfChanged(g.values.drawCount,ra.getDrawCount(j)),N.updateIfChanged(g.values.uVertexCount,ra.getVertexCount(j));else throw new Error("expected geometry to be given");(m.updateTransform||m.createGeometry)&&(h(g.values,j||A),D=p(A,g.values)),m.updateSize&&"uSize"in g.values&&nd(M,b.size,g.values),m.updateColor&&ns(M,D,b.color,g.values),f(g.values,y),v(g.state,y)}x=y,C=b,w=S,j&&(A=j)}function L(j){return!!(Ds(j)||$e.isLoci(j)&&$e.areRootsEquivalent(j.structure,w)||De.is(j)&&$e.areRootsEquivalent(j.structure,w)&&De.isWholeStructure(j))}function H(j,Q,G){return L(j)?Q(Te.ofBounds(0,M.groupCount*M.instanceCount)):o(j,w,Q,G)}function B(j){g&&(l==null||l(g.values,A,x,C,j.webgl))}return{get groupCount(){return M?M.count:0},get renderObject(){return M&&M.count?g:void 0},createOrUpdate:function(j,Q,G,W){if(G===void 0&&(G={}),k(Q,G,W||w),m.createGeometry){var q=n(j,S,b,y,A);if(NO(q))return q.then(function(ee){R(ee),B(j)});R(q)}else R();B(j)},getLoci:function(j){return g?a(j,w,g.id):Or},mark:function(j,Q){return Sr.mark(g,j,Q,H)},setVisibility:function(j){Sr.setVisibility(g,j)},setAlphaFactor:function(j){Sr.setAlphaFactor(g,j)},setPickable:function(j){Sr.setPickable(g,j)},setColorOnly:function(j){Sr.setColorOnly(g,j)},setTransform:function(j,Q){Sr.setTransform(g,j,Q)},setOverpaint:function(j){Sr.setOverpaint(g,j,H,!0)},setTransparency:function(j){Sr.setTransparency(g,j,H,!0)},setClipping:function(j){Sr.setClipping(g,j,H,!0)},destroy:function(){c==null||c(A),g&&(g.state.disposed=!0,g=void 0)},mustRecreate:u}}var Nb=E(E({},ree),Co);function xv(e,t){return o0(E(E({},e),{setUpdateState:function(r,n,i,a,o,s,u){e.setUpdateState(r,n,i,a,o,s,u),Hi.areEqual(a.size,o.size)||(r.createGeometry=!0)},geometryUtils:Nt.Utils}),t)}var $He=E(E({},nee),Co);function XHe(e,t){return o0(E(E({},e),{setUpdateState:function(r,n,i,a,o,s,u){e.setUpdateState(r,n,i,a,o,s,u),Hi.areEqual(a.size,o.size)||(r.updateSize=!0)},geometryUtils:Vo.Utils}),t)}var YHe=E(E({},iee),Co);function KHe(e,t){return o0(E(E({},e),{setUpdateState:function(r,n,i,a,o,s,u){e.setUpdateState(r,n,i,a,o,s,u),Hi.areEqual(a.size,o.size)||(r.updateSize=!0)},geometryUtils:bn.Utils}),t)}var QHe=E(E({},aee),Co);function ZHe(e,t){return o0(E(E({},e),{setUpdateState:function(r,n,i,a,o,s,u){e.setUpdateState(r,n,i,a,o,s,u),Hi.areEqual(a.size,o.size)||(r.updateSize=!0),n.background!==i.background&&(r.createGeometry=!0),n.backgroundMargin!==i.backgroundMargin&&(r.createGeometry=!0),n.tether!==i.tether&&(r.createGeometry=!0),n.tetherLength!==i.tetherLength&&(r.createGeometry=!0),n.tetherBaseWidth!==i.tetherBaseWidth&&(r.createGeometry=!0),n.attachment!==i.attachment&&(r.createGeometry=!0),n.fontFamily!==i.fontFamily&&(r.createGeometry=!0),n.fontQuality!==i.fontQuality&&(r.createGeometry=!0),n.fontStyle!==i.fontStyle&&(r.createGeometry=!0),n.fontVariant!==i.fontVariant&&(r.createGeometry=!0),n.fontWeight!==i.fontWeight&&(r.createGeometry=!0)},geometryUtils:Bs.Utils}),t)}var JHe=E(E({},oee),Co);function eGe(e,t){return o0(E(E({},e),{setUpdateState:function(r,n,i,a,o,s,u){e.setUpdateState(r,n,i,a,o,s,u),Hi.areEqual(a.size,o.size)||(r.createGeometry=!0)},geometryUtils:Ya.Utils}),t)}var tGe=E(E({},see),Co);function rGe(e,t){return o0(E(E({},e),{setUpdateState:function(r,n,i,a,o,s,u){e.setUpdateState(r,n,i,a,o,s,u),Hi.areEqual(a.size,o.size)||(r.createGeometry=!0)},geometryUtils:Ru.Utils}),t)}function Jn(e,t,r,n){var i=0,a=t.webgl,o=new Qn,s=hd(),u=[],l=Ri.create(),c=new Map,d,f,h,v,p=hi.createEmpty();function m(w,A){var M=this;return w===void 0&&(w={}),A&&A!==d&&(h=r(t,A),v||(v=I.getDefaultValues(h))),v=Object.assign({},v,w),We.create("Creating or updating UnitsRepresentation",function(D){return ce(M,void 0,void 0,function(){var B,W,G,q,k,B,W,L,G,q,q,R,G,q,B,W,L,G,q,q,H,B,j,Q,G,W,q,q,ee,he,$;return de(this,function(X){switch(X.label){case 0:if(!(!d&&!A))return[3,1];throw new Error("missing structure");case 1:if(!(A&&!d))return[3,8];f=A.unitSymmetryGroups,B=0,X.label=2;case 2:return B<f.length?(W=f[B],G=n(s,A,v,a),q=G.createOrUpdate({webgl:a,runtime:D},p,v,{group:W,structure:A}),q?[4,q]:[3,4]):[3,7];case 3:X.sent(),X.label=4;case 4:return b(G,W,l),c.set(W.hashCode,{visual:G,group:W}),D.shouldUpdate?[4,D.update({message:"Creating or updating UnitsVisual",current:B,max:f.length})]:[3,6];case 5:X.sent(),X.label=6;case 6:return B++,[3,2];case 7:return[3,43];case 8:if(!(A&&(!$e.areUnitIdsAndIndicesEqual(A,d)||A.child!==d.child)))return[3,22];f=A.unitSymmetryGroups,k=c,c=new Map,B=0,X.label=9;case 9:return B<f.length?(W=f[B],L=k.get(W.hashCode),L?(G=L.visual,!((ee=G.mustRecreate)===null||ee===void 0)&&ee.call(G,{group:W,structure:A},v,a)?(G.destroy(),G=n(s,A,v,a),q=G.createOrUpdate({webgl:a,runtime:D},p,v,{group:W,structure:A}),q?[4,q]:[3,11]):[3,12]):[3,15]):[3,21];case 10:X.sent(),X.label=11;case 11:return b(G,W,l),[3,14];case 12:return q=G.createOrUpdate({webgl:a,runtime:D},p,v,{group:W,structure:A}),q?[4,q]:[3,14];case 13:X.sent(),X.label=14;case 14:return c.set(W.hashCode,{visual:G,group:W}),k.delete(W.hashCode),G.renderObject&&(R=G.renderObject.values.tMarker.ref.value.array,ku(R,Te.ofBounds(0,R.length),tr.RemoveHighlight)),[3,18];case 15:return G=n(s,A,v,a),q=G.createOrUpdate({webgl:a,runtime:D},p,v,{group:W,structure:A}),q?[4,q]:[3,17];case 16:X.sent(),X.label=17;case 17:b(G,W,l),c.set(W.hashCode,{visual:G,group:W}),X.label=18;case 18:return D.shouldUpdate?[4,D.update({message:"Creating or updating UnitsVisual",current:B,max:f.length})]:[3,20];case 19:X.sent(),X.label=20;case 20:return B++,[3,9];case 21:return k.forEach(function(U){var z=U.visual;z.destroy()}),[3,43];case 22:if(!(A&&A!==d&&$e.areUnitIdsAndIndicesEqual(A,d)))return[3,34];f=A.unitSymmetryGroups,B=0,X.label=23;case 23:return B<f.length?(W=f[B],L=c.get(W.hashCode),L?(G=L.visual,!((he=G.mustRecreate)===null||he===void 0)&&he.call(G,{group:W,structure:A},v,t.webgl)?(G.destroy(),G=n(s,A,v,t.webgl),L.visual=G,q=G.createOrUpdate({webgl:a,runtime:D},p,v,{group:W,structure:A}),q?[4,q]:[3,25]):[3,26]):[3,29]):[3,33];case 24:X.sent(),X.label=25;case 25:return b(G,W,l),[3,28];case 26:return q=G.createOrUpdate({webgl:a,runtime:D},p,v,{group:W,structure:A}),q?[4,q]:[3,28];case 27:X.sent(),X.label=28;case 28:return L.group=W,[3,30];case 29:throw new Error("expected to find visual for hashCode "+W.hashCode);case 30:return D.shouldUpdate?[4,D.update({message:"Creating or updating UnitsVisual",current:B,max:f.length})]:[3,32];case 31:X.sent(),X.label=32;case 32:return B++,[3,23];case 33:return[3,43];case 34:H=[],c.forEach(function(U){return H.push(U)}),B=0,j=H.length,X.label=35;case 35:return B<j?(Q=H[B],G=Q.visual,W=Q.group,!(($=G.mustRecreate)===null||$===void 0)&&$.call(G,{group:W,structure:d},v,t.webgl)?(G.destroy(),G=n(s,d,v,a),H[B].visual=G,q=G.createOrUpdate({webgl:a,runtime:D},p,v,{group:W,structure:d}),q?[4,q]:[3,37]):[3,38]):[3,43];case 36:X.sent(),X.label=37;case 37:return b(G,W,l),[3,40];case 38:return q=G.createOrUpdate({webgl:a,runtime:D},p,v),q?[4,q]:[3,40];case 39:X.sent(),X.label=40;case 40:return D.shouldUpdate?[4,D.update({message:"Creating or updating UnitsVisual",current:B,max:j})]:[3,42];case 41:X.sent(),X.label=42;case 42:return++B,[3,35];case 43:return u.length=0,c.forEach(function(U){var z=U.visual;z.renderObject&&u.push(z.renderObject)}),A&&(d=A),o.next(i++),[2]}})})})}function g(w){if(w===void 0)return $e.Loci(d.target);var A=Or;return c.forEach(function(M){var D=M.visual,k=D.getLoci(w);xu(k)||(A=k)}),A}function y(w,A){if(!d||!So.is(l.markerActions,A))return!1;if($e.isLoci(w)||De.is(w)||Vt.isLoci(w)){if(!$e.areRootsEquivalent(w.structure,d))return!1;w=ar.remap(w,d)}else if(!Ds(w)&&!Ky(w))return!1;if(ar.isEmpty(w))return!1;var M=!1;return c.forEach(function(D){var k=D.visual;M=k.mark(w,A)||M}),M}function b(w,A,M){var D=M.visible,k=M.alphaFactor,R=M.pickable,L=M.overpaint,H=M.transparency,B=M.clipping,j=M.transform,Q=M.unitTransforms;D!==void 0&&w.setVisibility(D),k!==void 0&&w.setAlphaFactor(k),R!==void 0&&w.setPickable(R),L!==void 0&&w.setOverpaint(L),H!==void 0&&w.setTransparency(H),B!==void 0&&w.setClipping(B),j!==void 0&&w.setTransform(j),Q!==void 0&&(Q?w.setTransform(void 0,Q.getSymmetryGroupTransforms(A)):w.setTransform(void 0,null))}function S(w){var A=w.visible,M=w.alphaFactor,D=w.pickable,k=w.overpaint,R=w.transparency,L=w.clipping,H=w.transform,B=w.unitTransforms,j=w.syncManually,Q=w.markerActions,G={};A!==l.visible&&(G.visible=A),M!==l.alphaFactor&&(G.alphaFactor=M),D!==l.pickable&&(G.pickable=D),k!==void 0&&!Bi.areEqual(k,l.overpaint)&&d&&(G.overpaint=Bi.remap(k,d)),R!==void 0&&!Ui.areEqual(R,l.transparency)&&d&&(G.transparency=Ui.remap(R,d)),L!==void 0&&!rn.areEqual(L,l.clipping)&&d&&(G.clipping=rn.remap(L,d)),H!==void 0&&!ue.areEqual(H,l.transform,vn)&&(G.transform=H),(B!==l.unitTransforms||(B==null?void 0:B.version)!==w.unitTransformsVersion)&&(G.unitTransforms=B,l.unitTransformsVersion=B?B==null?void 0:B.version:-1),j!==l.syncManually&&(G.syncManually=j),Q!==l.markerActions&&(G.markerActions=Q),c.forEach(function(W){var q=W.visual,ee=W.group;return b(q,ee,G)}),Ri.update(l,G)}function x(w){p=w}function C(){c.forEach(function(w){var A=w.visual;return A.destroy()}),c.clear()}return{label:e,get groupCount(){var w=0;return c.forEach(function(A){var M=A.visual;M.renderObject&&(w+=M.groupCount)}),w},get props(){return v},get params(){return h},get state(){return l},get theme(){return p},renderObjects:u,updated:o,createOrUpdate:m,setState:S,setTheme:x,getLoci:g,mark:y,destroy:C}}function nGe(e,t,r,n,i,a){var o=ra.getUtils(t),s=o.createValues,u=o.createRenderableState,l=ZJ(e,i.includeParent),c=s(t,l,r,n,i),d=u(i);return r0(t.kind,c,d,a)}function Sv(e,t){var r=e.defaultProps,n=e.createGeometry,i=e.createLocationIterator,a=e.getLoci,o=e.eachLocation,s=e.setUpdateState,u=e.mustRecreate,l=e.processValues,c=e.dispose,d=e.geometryUtils,f=d.createEmpty,h=d.updateValues,v=d.updateBoundingSphere,p=d.updateRenderableState,m=d.createPositionIterator,g=Pl.create(),y,b=Object.assign({},r),S=hi.createEmpty(),x,C,w,A,M,D,k;function R(G,W,q){if(!q&&!A)throw new Error("missing structureGroup");if(b=W,S=G,x=q,Pl.reset(g),!y||!A){g.createNew=!0,g.createGeometry=!0;return}s(g,b,C,S,w,x,A),$e.areHierarchiesEqual(A.structure,x.structure)||(g.updateTransform=!0,g.updateColor=!0,g.updateSize=!0),jc.areEqual(S.color,w.color)||(g.updateColor=!0),A.structure.child!==x.structure.child&&(g.createGeometry=!0),Mc(b.unitKinds,C.unitKinds)||(g.createGeometry=!0),x.group.transformHash!==A.group.transformHash&&(x.group.units.length!==A.group.units.length||g.updateColor?g.updateTransform=!0:g.updateMatrix=!0);var ee=x.group.units[0],he=A.group.units[0];Ue.areOperatorsEqual(ee,he)||(g.updateTransform=!0),Ue.areConformationsEqual(ee,he)||(g.createGeometry=!0),g.updateTransform&&(g.updateMatrix=!0),g.updateSize&&!("uSize"in y.values)&&(g.createGeometry=!0),(g.createGeometry||g.updateTransform)&&(A.structure.hashCode!==x.structure.hashCode&&(g.updateColor=!0,g.updateSize=!0),(S.color.granularity.startsWith("vertex")||y.values.dColorType.ref.value.startsWith("vertex")||S.color.granularity.startsWith("volume")||y.values.dColorType.ref.value.startsWith("volume"))&&(g.updateColor=!0))}function L(G){if(g.createNew)if(D=i(x),G)y=nGe(x,G,D,S,b,t),k=m(G,y.values);else throw new Error("expected geometry to be given");else{if(!y)throw new Error("expected renderObject to be available");if(g.updateTransform){D=i(x);var W=D.instanceCount,q=D.groupCount;Hs(W*q,y.values)}if(g.updateMatrix&&ZJ(x,b.includeParent,y.values),g.createGeometry)if(G)N.updateIfChanged(y.values.drawCount,ra.getDrawCount(G)),N.updateIfChanged(y.values.uVertexCount,ra.getVertexCount(G));else throw new Error("expected geometry to be given");(g.updateTransform||g.createGeometry)&&(v(y.values,G||M),k=m(G||M,y.values)),g.updateSize&&"uSize"in y.values&&nd(D,S.size,y.values),g.updateColor&&ns(D,k,S.color,y.values),h(y.values,b),p(y.state,b)}C=b,w=S,A=x,G&&(M=G)}function H(G,W,q,ee,he,$){return UHe(he.unitKinds,W)?n(G,W,q,ee,he,$):f($)}function B(G){return!!(Ds(G)||$e.isLoci(G)&&$e.areRootsEquivalent(G.structure,A.structure)||De.is(G)&&$e.areRootsEquivalent(G.structure,A.structure)&&De.isWholeStructure(G))}function j(G,W,q){return B(G)?W(Te.ofBounds(0,D.groupCount*D.instanceCount)):o(G,A,W,q)}function Q(G){y&&(l==null||l(y.values,M,C,w,G.webgl))}return{get groupCount(){return D?D.count:0},get renderObject(){return D&&D.count?y:void 0},createOrUpdate:function(G,W,q,ee){if(R(W,q,ee||A),g.createGeometry){var he=H(G,x.group.units[0],x.structure,S,b,M);if(NO(he))return he.then(function($){L($),Q(G)});L(he)}else L();Q(G)},getLoci:function(G){return y?a(G,A,y.id):Or},mark:function(G,W){return Sr.mark(y,G,W,j)},setVisibility:function(G){Sr.setVisibility(y,G)},setAlphaFactor:function(G){Sr.setAlphaFactor(y,G)},setPickable:function(G){Sr.setPickable(y,G)},setColorOnly:function(G){Sr.setColorOnly(y,G)},setTransform:function(G,W){Sr.setTransform(y,G,W)},setOverpaint:function(G){Sr.setOverpaint(y,G,j,!0)},setTransparency:function(G){Sr.setTransparency(y,G,j,!0)},setClipping:function(G){Sr.setClipping(y,G,j,!0)},destroy:function(){c==null||c(M),y&&(y.state.disposed=!0,y=void 0)},mustRecreate:u}}var ga=E(E({},ree),Co);function Ja(e,t){return Sv(E(E({},e),{setUpdateState:function(r,n,i,a,o,s,u){e.setUpdateState(r,n,i,a,o,s,u),Hi.areEqual(a.size,o.size)||(r.createGeometry=!0)},geometryUtils:Nt.Utils}),t)}var uee=E(E({},GHe),Co);function lee(e,t){return Sv(E(E({},e),{setUpdateState:function(r,n,i,a,o,s,u){e.setUpdateState(r,n,i,a,o,s,u),Hi.areEqual(a.size,o.size)||(r.updateSize=!0)},geometryUtils:Zf.Utils}),t)}var cee=E(E({},nee),Co);function dee(e,t){return Sv(E(E({},e),{setUpdateState:function(r,n,i,a,o,s,u){e.setUpdateState(r,n,i,a,o,s,u),Hi.areEqual(a.size,o.size)||(r.updateSize=!0)},geometryUtils:Vo.Utils}),t)}var iGe=E(E({},qHe),Co);function aGe(e,t){return Sv(E(E({},e),{setUpdateState:function(r,n,i,a,o,s,u){e.setUpdateState(r,n,i,a,o,s,u),Hi.areEqual(a.size,o.size)||(r.updateSize=!0)},geometryUtils:Zp.Utils}),t)}var WO=E(E({},iee),Co);function $O(e,t){return Sv(E(E({},e),{setUpdateState:function(r,n,i,a,o,s,u){e.setUpdateState(r,n,i,a,o,s,u),Hi.areEqual(a.size,o.size)||(r.updateSize=!0)},geometryUtils:bn.Utils}),t)}E(E({},aee),Co);var oGe=E(E({},oee),Co);function sGe(e,t){return Sv(E(E({},e),{setUpdateState:function(r,n,i,a,o,s,u){e.setUpdateState(r,n,i,a,o,s,u),Hi.areEqual(a.size,o.size)||(r.createGeometry=!0)},geometryUtils:Ya.Utils}),t)}var uGe=E(E({},see),Co);function lGe(e,t){return Sv(E(E({},e),{setUpdateState:function(r,n,i,a,o,s,u){e.setUpdateState(r,n,i,a,o,s,u),Hi.areEqual(a.size,o.size)||(r.createGeometry=!0)},geometryUtils:Ru.Utils}),t)}var Ri={create:function(){return E(E({},or.createState()),{unitTransforms:null,unitTransformsVersion:-1})},update:function(e,t){or.updateState(e,t),t.unitTransforms!==void 0&&(e.unitTransforms=t.unitTransforms)}};function Fr(e,t){return e.model.atomicHierarchy.atoms.type_symbol.value(e.elements[t])}function fee(e,t){return e.model.atomicHierarchy.atoms.pdbx_formal_charge.value(e.elements[t])}function ib(e,t){return e.model.atomicHierarchy.atoms.label_atom_id.value(e.elements[t])}function C_(e,t){return e.model.atomicHierarchy.atoms.label_alt_id.value(e.elements[t])}function XO(e,t){return e.model.atomicHierarchy.atoms.label_comp_id.value(e.elements[t])}function cGe(e,t,r){for(var n=0,i=e.interUnitBonds.getEdgeIndices(r,t.id),a=0,o=i.length;a<o;++a){var s=e.interUnitBonds.edges[i[a]];Nr.isCovalent(s.props.flag)&&(n+=1)}return n}function dGe(e,t){for(var r=0,n=e.bonds,i=n.offset,a=n.edgeProps.flags,o=i[t],s=i[t+1];o<s;++o)Nr.isCovalent(a[o])&&(r+=1);return r}function Vc(e,t,r){return cGe(e,t,r)+dGe(t,r)}function $a(e,t,r,n){var i=0;return Us(e,t,r,function(a,o){Fr(a,o)===n&&(i+=1)}),i}function fGe(e,t,r){var n=e.bonds,i=n.offset,a=n.b,o=n.edgeProps.flags;Nr.is;for(var s=i[t],u=i[t+1];s<u;++s)if(a[s]===r&&Nr.isCovalent(o[s]))return!0;return!1}function hGe(e,t,r,n,i){var a=e.interUnitBonds.getEdge(r,t.id,i,n.id);return a&&Nr.isCovalent(a.props.flag)}function pGe(e,t,r,n,i){return t===n?fGe(t,r,i):hGe(e,t,r,n,i)}function vGe(e,t,r,n){for(var i=e.interUnitBonds.getEdgeIndices(r,t.id),a=0,o=i.length;a<o;++a){var s=e.interUnitBonds.edges[i[a]],u=e.unitMap.get(s.unitB);Nr.isCovalent(s.props.flag)&&n(u,s.indexB)}}function mGe(e,t,r){for(var n=e.bonds,i=n.offset,a=n.b,o=n.edgeProps.flags,s=i[t],u=i[t+1];s<u;++s)Nr.isCovalent(o[s])&&r(e,a[s])}function Us(e,t,r,n){vGe(e,t,r,n),mGe(t,r,n)}function gGe(e){switch(e){case 0:return"Spherical";case 1:return"Terminal";case 2:return"Linear";case 3:return"Trigonal";case 4:return"Tetrahedral";case 5:return"Trigonal Bi-Pyramidal";case 6:return"Octahedral";case 7:return"Square Planar";case 8:return"Unknown"}}function Yv(e){switch(e){case 0:return 0;case 1:return 1;case 2:return 2;case 3:return 3;case 4:return 4;default:return 8}}var zj=new Map([[2,$r(180)],[3,$r(120)],[4,$r(109.4721)],[6,$r(90)]]),__=_(),w_=_(),ap=_(),E_=_(),Tm=_();function A_(e,t,r,n,i){var a=[];return t.conformation.position(t.elements[r],ap),n.conformation.position(n.elements[i],E_),_.sub(__,E_,ap),Us(e,t,r,function(o,s){Fr(o,s)!=="H"&&(o.conformation.position(o.elements[s],Tm),_.sub(w_,Tm,ap),a.push(_.angle(__,w_)))}),a}function Vj(e,t,r,n,i){t.conformation.position(t.elements[r],ap),n.conformation.position(n.elements[i],E_),_.sub(__,E_,ap);var a=[_(),_()],o=0,s,u;if(Us(e,t,r,function(l,c){o>1||Fr(l,c)!=="H"&&(s=l,u=c,l.conformation.position(l.elements[c],Tm),_.sub(a[o++],Tm,ap))}),o===1&&s&&u&&Us(e,s,u,function(l,c){o>1||l===t&&c===r||Fr(l,c)!=="H"&&(l.conformation.position(l.elements[c],Tm),_.sub(a[o++],Tm,ap))}),o===2)return _.cross(w_,a[0],a[1]),Math.abs(Math.PI/2-_.angle(w_,__))}var cT=new Vt.ElementBondIterator,dT=new Vt.ElementBondIterator;function yGe(e,t,r){var n=Fr(t,r),i=n==="O"||n==="N";if(i&&Vc(e,t,r)===4)return!1;for(cT.setElement(e,t,r);cT.hasNext;){var a=cT.move();if(a.order>1)return!0;if(i){var o=Fr(a.otherUnit,a.otherIndex);for(dT.setElement(e,a.otherUnit,a.otherIndex);dT.hasNext;){var s=dT.move();if(s.order>1){if((o==="P"||o==="S")&&Fr(s.otherUnit,s.otherIndex)==="O")continue;return!0}}}}return!1}function bGe(e,t,r){for(var n=0,i=t.bonds,a=i.offset,o=i.edgeProps,s=o.flags,u=o.order,l=a[r],c=a[r+1];l<c;++l)Nr.isCovalent(s[l])&&(n+=u[l]);return e.interUnitBonds.getEdgeIndices(r,t.id).forEach(function(d){var f=e.interUnitBonds.edges[d];Nr.isCovalent(f.props.flag)&&(n+=f.props.order)}),n}var Kv=new Vt.ElementBondIterator,fT=new Vt.ElementBondIterator;function xGe(e,t,r,n){var i=$a(e,t,r,"H"),a=Fr(t,r),o=fee(t,r),s=n.assignCharge==="always"||n.assignCharge==="auto"&&o===0,u=n.assignH==="always"||n.assignH==="auto"&&i===0,l=Vc(e,t,r),c=bGe(e,t,r),d=yGe(e,t,r),f=c-l>0,h=0,v=8;switch(a){case"H":s&&(l===0?(o=1,v=0):l===1&&(o=0,v=1));break;case"C":s&&(o=0),u&&(h=Math.max(0,4-c-Math.abs(o))),v=Yv(l+h+Math.max(0,-o));break;case"N":if(s)if(!u)o=c-3;else if(d&&c<4)l-i===1&&c-i===2?o=1:o=0;else for(Kv.setElement(e,t,r);Kv.hasNext;){var p=Kv.move(),m=Fr(p.otherUnit,p.otherIndex);if(m==="S"||QVe(m)){o=0;break}else o=1}u&&(h=Math.max(0,3-c+o)),d&&!f?v=Yv(l+h-o):v=Yv(l+h+1-o);break;case"O":if(s&&(u||(o=c-2),c===1)){Kv.setElement(e,t,r);e:for(;Kv.hasNext;){var g=Kv.move();for(fT.setElement(e,g.otherUnit,g.otherIndex);fT.hasNext;){var y=fT.move();if(!(y.otherUnit===t&&y.otherIndex===r)&&Fr(y.otherUnit,y.otherIndex)==="O"&&y.order===2){o=-1;break e}}}}u&&(h=Math.max(0,2-c+o)),d&&!f?v=Yv(l+h-o+1):v=Yv(l+h-o+2);break;case"S":s&&(u||(c<=3&&$a(e,t,r,"O")===0?o=c-2:o=0)),u&&c<2&&(h=Math.max(0,2-c+o)),c<=3&&(v=Yv(l+h-o+2));break;case"F":case"CL":case"BR":case"I":case"AT":s&&(o=c-1);break;case"LI":case"NA":case"K":case"RB":case"CS":case"FR":s&&(o=1-c);break;case"BE":case"MG":case"CA":case"SR":case"BA":case"RA":s&&(o=2-c);break;default:Mr&&console.warn("Requested charge, protonation for an unhandled element",a)}return[o,h,h+i,v]}function SGe(e,t,r){var n=t.elements.length,i=new Int8Array(n),a=new Int8Array(n),o=new Int8Array(n),s=new Int8Array(n),u=!!e.parent,l;if(u){var c=e.root.unitMap.get(t.id);if(l=Je.indicesOf(c.elements,t.elements),l.length!==t.elements.length)throw new Error("expected to find an index for every element");t=c,e=e.root}for(var d=0;d<n;++d){var f=u?l[d]:d,h=xGe(e,t,f,r),v=h[0],p=h[1],m=h[2],g=h[3];i[d]=v,a[d]=p,o[d]=m,s[d]=g}return{charge:i,implicitH:a,totalH:o,idealGeometry:s}}var hee={assignCharge:I.Select("auto",[["always","always"],["auto","auto"],["never","never"]]),assignH:I.Select("auto",[["always","always"],["auto","auto"],["never","never"]])};function CGe(e,t,r){return ce(this,void 0,void 0,function(){var n,i,a,o,s,u;return de(this,function(l){for(n=E(E({},I.getDefaultValues(hee)),r),i=new Map,a=0,o=t.units.length;a<o;++a)s=t.units[a],Ue.isAtomic(s)&&(u=SGe(t,s,n),i.set(s.id,u));return[2,i]})})}var hT=E({},hee),Fb=Yf.createProvider({label:"Valence Model",descriptor:yo({name:"molstar_computed_valence_model"}),type:"local",defaultParams:hT,getParams:function(e){return hT},isApplicable:function(e){return!0},obtain:function(e,t,r){return ce(void 0,void 0,void 0,function(){var n,i;return de(this,function(a){switch(a.label){case 0:return n=E(E({},I.getDefaultValues(hT)),r),i={},[4,CGe(e.runtime,t,n)];case 1:return[2,(i.value=a.sent(),i)]}})})}}),_n;(function(e){function t(d,f,h,v){return _.set(d,v.x[h],v.y[h],v.z[h]),_.transformMat4(d,d,f.conformation.operator.matrix),d}e.setPosition=t;function r(d,f){for(var h=new Int32Array(f+1),v=new Int32Array(f),p=new Int32Array(f),m=d.members,g=d.count,y=d.offsets,b=0,S=y[g];b<S;++b)++p[m[b]];for(var x=0,b=0;b<f;b++)h[b]=x,x+=p[b];h[f]=x;for(var C=new Int32Array(x),b=0;b<g;++b)for(var w=y[b],A=y[b+1];w<A;++w){var M=m[w],D=h[M]+v[M];C[D]=b,++v[M]}return{indices:C,offsets:h}}e.createElementsIndex=r;function n(d,f){var h,v;return E(E({},f),{get lookup3d(){if(!h){var p={x:f.x,y:f.y,z:f.z,indices:Oe.ofBounds(0,f.count)};h=qp(p,Eg(p))}return h},get elementsIndex(){return v||(v=r(f,d))},subset:function(p){return i(f,p)}})}e.create=n;function i(d,f){for(var h,v=d.count,p=d.types,m=[],g=0;g<v;++g)f.has(p[g])&&m.push(g);var y=Je.ofSortedArray(m);return{indices:y,get lookup3d(){if(!h){var b={x:d.x,y:d.y,z:d.z,indices:y};h=qp(b,Eg(b))}return h}}}e.createSubset=i;function a(d,f,h){var v=Fb.get(d).value;if(!v||!v.has(f.id))throw new Error("valence model required");return{unit:f,types:h.types,feature:-1,x:h.x,y:h.y,z:h.z,members:h.members,offsets:h.offsets,idealGeometry:v.get(f.id).idealGeometry}}e.Info=a;function o(d,f){return _.set(d,f.x[f.feature],f.y[f.feature],f.z[f.feature]),_.transformMat4(d,d,f.unit.conformation.operator.matrix),d}e.position=o;var s=_(),u=_();function l(d,f){var h=d.members[d.offsets[d.feature]],v=f.members[f.offsets[f.feature]];return d.unit.conformation.position(d.unit.elements[h],s),f.unit.conformation.position(f.unit.elements[v],u),_.distance(s,u)}e.distance=l;function c(d,f){return{types:new Set(d),add:f}}e.Provider=c})(_n||(_n={}));var V5;(function(e){function t(r,n,i){r===void 0&&(r=2048),n===void 0&&(n=1024);var a=qe.create(Float32Array,1,n,i?i.x:r),o=qe.create(Float32Array,1,n,i?i.y:r),s=qe.create(Float32Array,1,n,i?i.z:r),u=qe.create(Uint8Array,1,n,i?i.types:r),l=qe.create(Uint8Array,1,n,i?i.groups:r),c=qe.create(Uint32Array,1,n,i?i.offsets:r),d=qe.create(Uint32Array,1,n,i?i.members:r),f={x:0,y:0,z:0,offset:0,count:0};return{startState:function(){f.x=0,f.y=0,f.z=0,f.offset=d.elementCount,f.count=0},pushMember:function(h,v,p,m){qe.add(d,m),f.x+=h,f.y+=v,f.z+=p,f.count+=1},finishState:function(h,v){var p=f.count;p!==0&&(qe.add(u,h),qe.add(l,v),qe.add(a,f.x/p),qe.add(o,f.y/p),qe.add(s,f.z/p),qe.add(c,f.offset))},add:function(h,v,p,m,g,y){qe.add(u,h),qe.add(l,v),qe.add(a,p),qe.add(o,m),qe.add(s,g),qe.add(c,d.elementCount),qe.add(d,y)},getFeatures:function(h){qe.add(c,d.elementCount);var v=qe.compact(a,!0),p=qe.compact(o,!0),m=qe.compact(s,!0),g=a.elementCount;return _n.create(h,{x:v,y:p,z:m,count:g,types:qe.compact(u,!0),groups:qe.compact(l,!0),offsets:qe.compact(c,!0),members:qe.compact(d,!0)})}}}e.create=t})(V5||(V5={}));var H5;(function(e){function t(r,n,i){for(var a=new Int32Array(i+1),o=new Int32Array(i),s=new Int32Array(i),u=n.members,l=n.offsets,c=0,d=r.edgeCount*2;c<d;++c){var f=r.a[c],h=r.b[c];if(!(f>h)){for(var v=l[f],p=l[f+1];v<p;++v)++s[u[v]];for(var v=l[h],p=l[h+1];v<p;++v)++s[u[v]]}}for(var m=0,c=0;c<i;c++)a[c]=m,m+=s[c];a[i]=m;for(var g=new Int32Array(m),c=0,d=r.edgeCount*2;c<d;++c){var f=r.a[c],h=r.b[c];if(!(f>h)){for(var v=l[f],p=l[f+1];v<p;++v){var y=u[v],b=a[y]+o[y];g[b]=c,++o[y]}for(var v=l[h],p=l[h+1];v<p;++v){var y=u[v],b=a[y]+o[y];g[b]=c,++o[y]}}}return{indices:g,offsets:a}}e.createElementsIndex=t})(H5||(H5={}));var _Ge=function(e){Le(t,e);function t(r,n){var i=e.call(this,r)||this,a=0,o=new Map,s=function(u,l){var c=i.getElementKey(u,l),d=o.get(c);d===void 0?o.set(c,[a]):d.push(a)};return i.map.forEach(function(u){u.forEach(function(l){var c=l.unitA,d=l.connectedIndices;d.forEach(function(f){for(var h=n.get(c),v=h.offsets,p=h.members,m=v[f],g=v[f+1];m<g;++m)s(p[m],c);a+=1})})}),i.elementKeyIndex=o,i}return t.prototype.getContactIndicesForElement=function(r,n){return this.elementKeyIndex.get(this.getElementKey(r,n.id))||[]},t.prototype.getElementKey=function(r,n){return r+"|"+n},t}(Wp);function Hj(e){switch(e){case 4:return"Hydrogen Bond";case 6:return"Hydrophobic Contact";case 5:return"Halogen Bond";case 1:return"Ionic Interaction";case 7:return"Metal Coordination";case 2:return"Cation-Pi Interaction";case 3:return"Pi Stacking";case 8:return"Weak Hydrogen Bond";case 0:return"Unknown Interaction"}}function wGe(e){switch(e){case 0:return"None";case 1:return"Positive Charge";case 2:return"Negative Charge";case 3:return"Aromatic Ring";case 4:return"Hydrogen Donor";case 5:return"Hydrogen Acceptor";case 6:return"Halogen Donor";case 7:return"Halogen Acceptor";case 8:return"HydrophobicAtom";case 9:return"Weak Hydrogen Donor";case 10:return"Ionic Type Partner";case 11:return"Dative Bond Partner";case 12:return"Transition Metal";case 13:return"Ionic Type Metal"}}function EGe(e){switch(e){case 0:return"None";case 1:return"Quaternary Amine";case 2:return"Tertiary Amine";case 3:return"Sulfonium";case 4:return"Sulfonic Acid";case 5:return"Sulfate";case 6:return"Phosphate";case 7:return"Halocarbon";case 8:return"Guanidine";case 9:return"Acetamidine";case 10:return"Carboxylate"}}var G5;(function(e){function t(r,n){var i=[],a=[],o=[];return{add:function(s,u,l){i[i.length]=s,a[a.length]=u,o[o.length]=l},getContacts:function(){for(var s=new bo.EdgeBuilder(r.count,i,a),u=new Int8Array(s.slotCount),l=new Int8Array(s.slotCount),c=0,d=s.edgeCount;c<d;c++)s.addNextEdge(),s.assignProperty(u,o[c]);var f=s.createGraph({type:u,flag:l}),h,v=Object.defineProperty(f,"elementsIndex",{get:function(){return h||(h=H5.createElementsIndex(f,r,n))}});return v}}}e.create=t})(G5||(G5={}));var q5;(function(e){function t(){var r=new Wp.Builder;return{startUnitPair:function(n,i){r.startUnitPair(n.id,i.id)},finishUnitPair:function(){r.finishUnitPair()},add:function(n,i,a){r.add(n,i,{type:a,flag:0})},getContacts:function(n){return new _Ge(r.getMap(),n)}}}e.create=t})(q5||(q5={}));var AGe={lineOfSightDistFactor:I.Numeric(1,{min:0,max:3,step:.1})},PGe=3;function pee(e,t,r){var n=t.members[t.offsets[t.feature]],i=r.members[r.offsets[r.feature]];if(n===i&&t.unit===r.unit)return!1;var a=C_(t.unit,n),o=C_(r.unit,i);return!(a&&o&&a!==o||t.unit.residueIndex[t.unit.elements[n]]===r.unit.residueIndex[r.unit.elements[i]]&&t.unit===r.unit||pGe(e,t.unit,n,r.unit,i))}function Gj(e,t,r,n){var i=C_(e,t),a=C_(r,n);return i&&a&&i!==a}function qj(e,t){for(var r=t.feature,n=t.offsets,i=t.members,a=n[r],o=n[r+1];a<o;++a)if(i[a]===e)return!0;return!1}var Td=_(),pT=_(),vT=_(),TGe=nQ();function vee(e,t,r,n){var i=t.feature,a=r.feature,o=t.members[t.offsets[i]],s=r.members[r.offsets[a]];_n.position(pT,t),_n.position(vT,r),_.scale(Td,_.add(Td,pT,vT),.5);var u=n*PGe,l=e.lookup3d.find(Td[0],Td[1],Td[2],u,TGe),c=l.count,d=l.indices,f=l.units,h=l.squaredDistances;if(c===0)return!0;for(var v=0;v<c;++v){var p=d[v],m=f[v];if(Ue.isAtomic(m)){var g=Fr(m,p);if(g!=="H"){var y=Pb(g);if(!(y*y*n*n<=h[v])&&!(Gj(m,p,t.unit,o)||Gj(m,p,r.unit,s))&&!(t.unit===m&&qj(p,t)||r.unit===m&&qj(p,r))&&(m.conformation.position(m.elements[p],Td),!(_.squaredDistance(Td,pT)<1||_.squaredDistance(Td,vT)<1)))return!1}}}return!0}function IGe(e,t,r,n,i,a){for(var o=0,s=i;o<s.length;o++){var u=s[o];MGe(e,t,r,n,u,a)}}function MGe(e,t,r,n,i,a){for(var o=r.x,s=r.y,u=r.z,l=r.subset(i.requiredFeatures),c=l.lookup3d,d=l.indices,f=_n.Info(e,t,r),h=E({},f),v=a.lineOfSightDistFactor,p=0,m=Oe.size(d);p<m;++p){var g=Oe.getAt(d,p),y=c.find(o[g],s[g],u[g],i.maxDistance),b=y.count,S=y.indices,x=y.squaredDistances;if(b!==0){f.feature=g;for(var C=0;C<b;++C){var w=Oe.getAt(d,S[C]);if(!(w<=g)&&(h.feature=w,!!pee(e,f,h))){var A=i.getType(e,f,h,x[C]);A&&vee(e,f,h,v)&&n.add(g,w,A)}}}}}var DGe=ue();function RGe(e,t,r,n,i,a,o,s){var u=r.count,l=r.x,c=r.y,d=r.z,f=i.lookup3d,h=ue.mul(DGe,n.conformation.operator.inverse,t.conformation.operator.matrix),v=!ue.isIdentity(h),p=_(),m=Math.max.apply(Math,o.map(function(q){return q.maxDistance})),g=f.boundary.sphere,y=g.center,b=g.radius,S=(b+m)*(b+m),x=s.lineOfSightDistFactor,C=_n.Info(e,t,r),w=_n.Info(e,n,i);a.startUnitPair(t,n);for(var A=0;A<u;++A)if(_.set(p,l[A],c[A],d[A]),v&&_.transformMat4(p,p,h),!(_.squaredDistance(p,y)>S)){var M=f.find(p[0],p[1],p[2],m),D=M.indices,k=M.count,R=M.squaredDistances;if(k!==0){C.feature=A;for(var L=0;L<k;++L){var H=D[L];if(w.feature=H,!!pee(e,C,w))for(var B=R[L],j=0,Q=o;j<Q.length;j++){var G=Q[j];if(B<G.maxDistance*G.maxDistance){var W=G.getType(e,C,w,B);if(W&&vee(e,C,w,x)){a.add(A,H,W);break}}}}}}a.finishUnitPair()}var kGe={distanceMax:I.Numeric(4,{min:1,max:5,step:.1}),angleMax:I.Numeric(30,{min:0,max:60,step:1})},OGe=["CL","BR","I","AT"];function LGe(e,t,r){for(var n=t.elements,i=t.model.atomicConformation,a=i.x,o=i.y,s=i.z,u=0,l=n.length;u<l;++u){var c=Fr(t,u);OGe.includes(c)&&r.add(6,0,a[n[u]],o[n[u]],s[n[u]],u)}}var NGe=["N","O","S"],FGe=["C","N","P","S"];function BGe(e,t,r){for(var n=t.elements,i=t.model.atomicConformation,a=i.x,o=i.y,s=i.z,u=function(d,f){var h=Fr(t,d);if(NGe.includes(h)){var v=!1;Us(e,t,d,function(p,m){FGe.includes(Fr(p,m))&&(v=!0)}),v&&r.add(7,0,a[n[d]],o[n[d]],s[n[d]],d)}},l=0,c=n.length;l<c;++l)u(l)}function UGe(e,t){return e===7&&t===6||e===6&&t===7}var jGe=$r(180),zGe=$r(120);function VGe(e){return{angleMax:$r(e.angleMax)}}function HGe(e,t,r,n){var i=t.types[t.feature],a=r.types[r.feature];if(UGe(i,a)){var o=i===6?[t,r]:[r,t],s=o[0],u=o[1],l=s.members[s.offsets[s.feature]],c=u.members[u.offsets[u.feature]],d=A_(e,s.unit,l,u.unit,c);if(d.length===1&&!(jGe-d[0]>n.angleMax)){var f=A_(e,u.unit,c,s.unit,l);if(f.length!==0&&!f.some(function(h){return zGe-h>n.angleMax}))return 5}}}var GGe=_n.Provider([6],LGe),qGe=_n.Provider([7],BGe),WGe={name:"halogen-bonds",params:kGe,createTester:function(e){var t=VGe(e);return{maxDistance:e.distanceMax,requiredFeatures:new Set([6,7]),getType:function(r,n,i){return HGe(r,n,i,t)}}}},mee={distanceMax:I.Numeric(3.5,{min:1,max:5,step:.1}),backbone:I.Boolean(!0,{description:"Include backbone-to-backbone hydrogen bonds"}),accAngleDevMax:I.Numeric(45,{min:0,max:180,step:1},{description:"Max deviation from ideal acceptor angle"}),donAngleDevMax:I.Numeric(45,{min:0,max:180,step:1},{description:"Max deviation from ideal donor angle"}),accOutOfPlaneAngleMax:I.Numeric(90,{min:0,max:180,step:1}),donOutOfPlaneAngleMax:I.Numeric(45,{min:0,max:180,step:1})},$Ge=E(E({},mee),{water:I.Boolean(!1,{description:"Include water-to-water hydrogen bonds"}),sulfurDistanceMax:I.Numeric(4.1,{min:1,max:5,step:.1})}),XGe=E({},mee);function YO(e,t){var r=Fb.get(e).value;if(!r)throw Error("expected valence model to be available");var n=r.get(t.id);if(!n)throw Error("expected valence model for unit to be available");return n}function YGe(e,t,r){for(var n=YO(e,t).totalH,i=t.elements,a=t.model.atomicConformation,o=a.x,s=a.y,u=a.z,l=t.rings.elementAromaticRingIndices,c=0,d=i.length;c<d;++c)if(!l.has(c)){var f=Fr(t,c);(gee(t,c)||n[c]>0&&(f==="N"||f==="O"||f==="S"))&&r.add(4,0,o[i[c]],s[i[c]],u[i[c]],c)}}function KGe(e,t,r){for(var n=YO(e,t).totalH,i=t.elements,a=t.model.atomicConformation,o=a.x,s=a.y,u=a.z,l=0,c=i.length;l<c;++l)Fr(t,l)==="C"&&n[l]>0&&($a(e,t,l,"N")>0||$a(e,t,l,"O")>0||QGe(t,l))&&r.add(9,0,o[i[l]],s[i[l]],u[i[l]],l)}function QGe(e,t){var r=e.rings,n=r.elementAromaticRingIndices,i=r.all,a=n.get(t);if(a===void 0)return!1;for(var o=0,s=a.length;o<s;++o)for(var u=i[a[o]],l=0,c=u.length;l<c;++l){var d=Fr(e,u[l]);if(d==="N"||d==="O")return!0}return!1}function ZGe(e,t,r){for(var n=YO(e,t),i=n.charge,a=n.implicitH,o=n.idealGeometry,s=t.elements,u=t.model.atomicConformation,l=u.x,c=u.y,d=u.z,f=t.rings.elementAromaticRingIndices,h=function(S){r.add(5,0,l[s[S]],c[s[S]],d[s[S]],S)},v=0,p=s.length;v<p;++v)if(!f.has(v)){var m=Fr(t,v);if(m==="O")h(v);else if(m==="N"){if(gee(t,v))h(v);else if(i[v]<1){var g=Vc(e,t,v)+a[v],y=o[v];(y===4&&g<4||y===3&&g<3||y===2&&g<2)&&h(v)}}else if(m==="S"){var b=XO(t,v);(b==="CYS"||b==="MET"||fee(t,v)===-1)&&h(v)}}}function Wj(e,t){return e.model.atomicHierarchy.derived.residue.moleculeType[e.residueIndex[e.elements[t]]]===2}function $j(e,t){return Nc.has(ib(e,t))}function JGe(e,t){return e.rings.elementRingIndices.has(t)}function gee(e,t){return XO(e,t)==="HIS"&&Fr(e,t)==="N"&&JGe(e,t)}function eqe(e,t,r,n){return $j(e,t)&&$j(r,n)}function tqe(e,t,r,n){return Wj(e,t)&&Wj(r,n)}function rqe(e,t){return e===5&&t===4||e===4&&t===5}function nqe(e,t){return e===9&&t===5||e===5&&t===9}function yee(e){return{includeBackbone:e.backbone,maxAccAngleDev:$r(e.accAngleDevMax),maxDonAngleDev:$r(e.donAngleDevMax),maxAccOutOfPlaneAngle:$r(e.accOutOfPlaneAngleMax),maxDonOutOfPlaneAngle:$r(e.donOutOfPlaneAngleMax)}}function iqe(e){return E(E({},yee(e)),{includeWater:e.water,maxSulfurDistSq:e.sulfurDistanceMax*e.sulfurDistanceMax,maxDistSq:e.distanceMax*e.distanceMax})}var Xj=$r(120);function bee(e,t,r,n){var i=t.members[t.offsets[t.feature]],a=r.members[r.offsets[r.feature]];if(!(!n.includeBackbone&&eqe(t.unit,i,r.unit,a))){var o=A_(e,t.unit,i,r.unit,a),s=zj.get(t.idealGeometry[i])||Xj;if(!o.some(function(d){return Math.abs(s-d)>n.maxDonAngleDev})){if(t.idealGeometry[i]===3){var u=Vj(e,t.unit,i,r.unit,a);if(u!==void 0&&u>n.maxDonOutOfPlaneAngle)return}var l=A_(e,r.unit,a,t.unit,i),c=zj.get(r.idealGeometry[a])||Xj;if(!l.some(function(d){return c-d>n.maxAccAngleDev})){if(r.idealGeometry[a]===3){var u=Vj(e,r.unit,a,t.unit,i);if(u!==void 0&&u>n.maxAccOutOfPlaneAngle)return}return!0}}}}function aqe(e,t,r,n,i){var a=t.types[t.feature],o=r.types[r.feature];if(rqe(a,o)){var s=o===5?[t,r]:[r,t],u=s[0],l=s[1],c=u.members[u.offsets[u.feature]],d=l.members[l.offsets[l.feature]],f=Fr(u.unit,c)==="S"||Fr(l.unit,d)==="S"?i.maxSulfurDistSq:i.maxDistSq;if(!(n>f)&&!(!i.includeWater&&tqe(u.unit,c,l.unit,d))&&bee(e,u,l,i))return 4}}function oqe(e,t,r,n,i){var a=t.types[t.feature],o=r.types[r.feature];if(nqe(a,o)){var s=o===5?[t,r]:[r,t],u=s[0],l=s[1];if(bee(e,u,l,i))return 8}}var sqe=_n.Provider([4],YGe),uqe=_n.Provider([9],KGe),lqe=_n.Provider([5],ZGe),cqe={name:"hydrogen-bonds",params:$Ge,createTester:function(e){var t=Math.max(e.distanceMax,e.sulfurDistanceMax),r=iqe(e);return{maxDistance:t,requiredFeatures:new Set([4,5]),getType:function(n,i,a,o){return aqe(n,i,a,o,r)}}}},dqe={name:"weak-hydrogen-bonds",params:XGe,createTester:function(e){var t=yee(e);return{maxDistance:e.distanceMax,requiredFeatures:new Set([9,5]),getType:function(r,n,i,a){return oqe(r,n,i,a,t)}}}};function fqe(e,t,r){return Fr(t,r)==="S"&&$a(e,t,r,"O")===3}function hqe(e,t,r){return Fr(t,r)==="S"&&$a(e,t,r,"O")===4}function Yj(e,t,r){return Fr(t,r)==="P"&&$a(e,t,r,"O")===Vc(e,t,r)}function pqe(e,t,r){var n=0;return Fr(t,r)==="C"&&$a(e,t,r,"O")===2&&$a(e,t,r,"C")===1&&Us(e,t,r,function(i,a){Fr(i,a)==="O"&&Vc(e,i,a)-$a(e,i,a,"H")===1&&(n+=1)}),n===2}function vqe(e,t,r){var n=0;return Fr(t,r)==="C"&&Vc(e,t,r)===3&&$a(e,t,r,"N")===3&&Us(e,t,r,function(i,a){Vc(e,i,a)-$a(e,i,a,"H")===1&&(n+=1)}),n===2}function mqe(e,t,r){var n=0;return Fr(t,r)==="C"&&Vc(e,t,r)===3&&$a(e,t,r,"N")===2&&$a(e,t,r,"C")===1&&Us(e,t,r,function(i,a){Vc(e,i,a)-$a(e,i,a,"H")===1&&(n+=1)}),n===2}var gqe={distanceMax:I.Numeric(5,{min:0,max:8,step:.1})},yqe={distanceMax:I.Numeric(5.5,{min:1,max:8,step:.1}),offsetMax:I.Numeric(2,{min:0,max:4,step:.1}),angleDevMax:I.Numeric(30,{min:0,max:180,step:1})},bqe={distanceMax:I.Numeric(6,{min:1,max:8,step:.1}),offsetMax:I.Numeric(2,{min:0,max:4,step:.1})},xqe=["ARG","HIS","LYS"],Sqe=["GLU","ASP"];function xee(e,t){var r=Fb.get(e).value;if(!r)throw Error("expected valence model to be available");var n=r.get(t.id);if(!n)throw Error("expected valence model for unit to be available");return n}function Cqe(e,t,r){for(var n=xee(e,t).charge,i=t.elements,a=t.model.atomicConformation,o=a.x,s=a.y,u=a.z,l=new Set,c=t.model.atomicHierarchy.atoms.label_comp_id,d=nr.transientSegments(t.model.atomicHierarchy.residueAtomSegments,i);d.hasNext;){var f=d.move(),h=f.index,v=f.start,p=f.end,m=c.value(t.model.atomicHierarchy.residueAtomSegments.offsets[h]);if(xqe.includes(m)){r.startState();for(var g=v;g<p;++g)Fr(t,g)==="N"&&!Nc.has(ib(t,g))&&r.pushMember(o[i[g]],s[i[g]],u[i[g]],g);r.finishState(1,0)}else if(!Ib.has(m)){l.clear();for(var g=v;g<p;++g){var y=0;vqe(e,t,g)?y=8:mqe(e,t,g)&&(y=9),y&&(r.startState(),Us(e,t,g,function(S,x){Fr(t,x)==="N"&&(l.add(x),r.pushMember(o[i[x]],s[i[x]],u[i[x]],x))}),r.finishState(1,y))}for(var g=v;g<p;++g)n[g]>0&&!l.has(g)&&r.add(1,0,o[i[g]],s[i[g]],u[i[g]],g)}}}function _qe(e,t,r){for(var n=xee(e,t).charge,i=t.elements,a=t.model.atomicConformation,o=a.x,s=a.y,u=a.z,l=new Set,c=t.model.atomicHierarchy.atoms.label_comp_id,d=nr.transientSegments(t.model.atomicHierarchy.residueAtomSegments,i);d.hasNext;){var f=d.move(),h=f.index,v=f.start,p=f.end,m=c.value(t.model.atomicHierarchy.residueAtomSegments.offsets[h]);if(Sqe.includes(m)){r.startState();for(var g=v;g<p;++g)Fr(t,g)==="O"&&!Nc.has(ib(t,g))&&r.pushMember(o[i[g]],s[i[g]],u[i[g]],g);r.finishState(2,0)}else if(T3.has(m))for(var g=v;g<p;++g)Yj(e,t,g)&&(r.startState(),Us(e,t,g,function(S,x){Fr(t,x)==="O"&&r.pushMember(o[i[x]],s[i[x]],u[i[x]],x)}),r.finishState(2,6));else if(!Ib.has(m)){for(var g=v;g<p;++g){r.startState(),Fr(t,g)==="N"&&!Nc.has(ib(t,g))&&r.pushMember(o[i[g]],s[i[g]],u[i[g]],g),r.finishState(2,0);var y=0;fqe(e,t,g)?y=4:Yj(e,t,g)?y=6:hqe(e,t,g)?y=5:pqe(e,t,g)&&(y=10),y&&(r.startState(),Us(e,t,g,function(S,x){Fr(t,x)==="O"&&(l.add(x),r.pushMember(o[i[x]],s[i[x]],u[i[x]],x))}),r.finishState(2,y))}for(var g=v;g<p;++g)n[g]<0&&!l.has(g)&&r.add(2,0,o[i[g]],s[i[g]],u[i[g]],g)}}}function wqe(e,t,r){for(var n=t.elements,i=t.model.atomicConformation,a=i.x,o=i.y,s=i.z,u=0,l=t.rings.aromaticRings;u<l.length;u++){var c=l[u],d=t.rings.all[c];r.startState();for(var f=0,h=d.length;f<h;++f){var v=d[f];r.pushMember(a[n[v]],o[n[v]],s[n[v]],v)}r.finishState(3,0)}}function Eqe(e,t){return e===2&&t===1||e===1&&t===2}function Aqe(e,t){return e===3&&t===3}function Pqe(e,t){return e===3&&t===1||e===1&&t===3}var Kj=_(),Qj=_();function Tqe(e,t,r){for(var n=e.feature,i=e.offsets,a=e.members,o=t.feature,s=t.offsets,u=t.members,l=i[n],c=i[n+1];l<c;++l){var d=a[l];e.unit.conformation.position(e.unit.elements[d],Kj);for(var f=s[o],h=s[o+1];f<h;++f){var v=u[f];if(t.unit.conformation.position(t.unit.elements[v],Qj),_.squaredDistance(Kj,Qj)<r)return!0}}return!1}var P_=_(),Im=_(),T_=_(),ux=_();function W5(e,t){var r=t.unit,n=t.feature,i=t.offsets,a=t.members,o=r.elements,s=i[n];return t.unit.conformation.position(o[a[s]],P_),t.unit.conformation.position(o[a[s+1]],Im),t.unit.conformation.position(o[a[s+2]],T_),_.triangleNormal(e,P_,Im,T_)}var $5=function(e,t,r){return _n.position(P_,e),_n.position(Im,t),_.sub(T_,P_,Im),_.projectOnPlane(ux,T_,r),_.add(ux,ux,Im),_.distance(ux,Im)};function Iqe(e){return{distanceMaxSq:e.distanceMax*e.distanceMax}}function Mqe(e){return{offsetMax:e.offsetMax,angleDevMax:$r(e.angleDevMax)}}function Dqe(e){return{offsetMax:e.offsetMax}}var Rqe=$r(180),Zj=$r(90),Qy=_(),mT=_();function kqe(e,t,r,n,i){var a=t.types[t.feature],o=r.types[r.feature];if(Eqe(a,o)&&Tqe(t,r,i.distanceMaxSq))return 1}function Oqe(e,t,r,n,i){var a=t.types[t.feature],o=r.types[r.feature];if(Aqe(a,o)){W5(Qy,t),W5(mT,r);var s=_.angle(Qy,mT),u=Math.min($5(t,r,mT),$5(r,t,Qy));if(u<=i.offsetMax){if(s<=i.angleDevMax||s>=Rqe-i.angleDevMax)return 3;if(s<=i.angleDevMax+Zj&&s>=Zj-i.angleDevMax)return 3}}}function Lqe(e,t,r,n,i){var a=t.types[t.feature],o=r.types[r.feature];if(Pqe(a,o)){var s=a===3?[t,r]:[r,t],u=s[0],l=s[1];W5(Qy,u);var c=$5(l,u,Qy);if(c<=i.offsetMax)return 2}}var Nqe=_n.Provider([2],_qe),Fqe=_n.Provider([1],Cqe),Bqe=_n.Provider([3],wqe),Uqe={name:"ionic",params:gqe,createTester:function(e){var t=Iqe(e);return{maxDistance:e.distanceMax,requiredFeatures:new Set([2,1]),getType:function(r,n,i,a){return kqe(r,n,i,a,t)}}}},jqe={name:"pi-stacking",params:yqe,createTester:function(e){var t=Mqe(e);return{maxDistance:e.distanceMax,requiredFeatures:new Set([3]),getType:function(r,n,i,a){return Oqe(r,n,i,a,t)}}}},zqe={name:"cation-pi",params:bqe,createTester:function(e){var t=Dqe(e);return{maxDistance:e.distanceMax,requiredFeatures:new Set([3,1]),getType:function(r,n,i,a){return Lqe(r,n,i,a,t)}}}},Vqe={distanceMax:I.Numeric(4,{min:1,max:5,step:.1})};function Hqe(e,t,r){for(var n=t.elements,i=t.model.atomicConformation,a=i.x,o=i.y,s=i.z,u=function(d,f){var h=Fr(t,d),v=!1;h==="C"?(v=!0,Us(e,t,d,function(p,m){var g=Fr(p,m);g!=="C"&&g!=="H"&&(v=!1)})):h==="F"&&(v=!0),v&&r.add(8,0,a[n[d]],o[n[d]],s[n[d]],d)},l=0,c=n.length;l<c;++l)u(l)}function Gqe(e,t){return e===8&&t===8}function qqe(e,t,r,n){var i=t.types[t.feature],a=r.types[r.feature];if(Gqe(i,a)){var o=t.members[t.offsets[t.feature]],s=r.members[r.offsets[r.feature]];if(!(Fr(t.unit,o)==="F"&&Fr(r.unit,s)==="F"))return 6}}var Wqe=_n.Provider([8],Hqe),$qe={name:"hydrophobic",params:Vqe,createTester:function(e){return{maxDistance:e.distanceMax,requiredFeatures:new Set([8]),getType:function(t,r,n,i){return qqe(t,r,n)}}}},Xqe={distanceMax:I.Numeric(3,{min:1,max:5,step:.1})},Yqe=["LI","NA","K","RB","CS","MG","CA","SR","BA","AL","GA","IN","TL","SC","SN","PB","BI","SB","HG"];function Kqe(e,t,r){for(var n=t.elements,i=t.model.atomicConformation,a=i.x,o=i.y,s=i.z,u=0,l=n.length;u<l;++u){var c=Fr(t,u),d=0;Yqe.includes(c)?d=13:(qJ(c)||c==="ZN"||c==="CD")&&(d=12),d&&r.add(d,0,a[n[u]],o[n[u]],s[n[u]],u)}}function Jj(e){return!Nc.has(e)}function Qqe(e){return Nc.has(e)}function Zqe(e){return _3.has(e)}function Jqe(e,t,r){for(var n=t.elements,i=t.model.atomicConformation,a=i.x,o=i.y,s=i.z,u=0,l=n.length;u<l;++u){var c=Fr(t,u),d=XO(t,u),f=ib(t,u),h=!1,v=!1,p=E3.has(d),m=T3.has(d);!p&&!m?XVe(c)||c==="O"||c==="S"?(h=!0,v=!0):c==="N"&&(h=!0):p?c==="O"?(["ASP","GLU","SER","THR","TYR","ASN","GLN"].includes(d)&&Jj(f)||Qqe(f))&&(h=!0,v=!0):c==="S"&&(d==="CYS"||d==="MET")?(h=!0,v=!0):c==="N"&&d==="HIS"&&Jj(f)&&(h=!0):m&&(c==="O"&&Zqe(f)?(h=!0,v=!0):["N3","N4","N7"].includes(f)?h=!0:["O2","O4","O6"].includes(f)&&(h=!0,v=!0)),h&&r.add(11,0,a[n[u]],o[n[u]],s[n[u]],u),v&&r.add(10,0,a[n[u]],o[n[u]],s[n[u]],u)}}function ez(e,t){if(e===12)return t===11||t===12;if(e===13)return t===10}function eWe(e,t,r,n){var i=t.types[t.feature],a=r.types[r.feature];if(!(!ez(i,a)&&!ez(a,i)))return 7}var tWe=_n.Provider([13,12],Kqe),rWe=_n.Provider([10,11],Jqe),nWe={name:"metal-coordination",params:Xqe,createTester:function(e){return{maxDistance:e.distanceMax,requiredFeatures:new Set([13,12,10,11]),getType:function(t,r,n,i){return eWe(t,r,n)}}}};function iWe(e,t){for(var r=t.contacts,n=t.unitsContacts,i=t.unitsFeatures,a=[aWe(e,t),oWe(e,t),sWe(e,t),uWe(e,t),lWe(e,t)],o=0,s=r.edgeCount;o<s;++o){var u=r.edges[o],l=e.unitMap.get(u.unitA),c=e.unitMap.get(u.unitB),d=_n.Info(e,l,i.get(u.unitA));d.feature=u.indexA;var f=_n.Info(e,c,i.get(u.unitB));f.feature=u.indexB;for(var h=0,v=a;h<v.length;h++){var p=v[h];p.isApplicable(u.props.type)&&p.handleInterContact(o,d,f)}}for(var m=n.keys();;){var g=m.next(),y=g.done,b=g.value;if(y)break;var S=n.get(b),x=i.get(b),C=e.unitMap.get(b);if(Ue.isAtomic(C)){for(var d=_n.Info(e,C,x),f=_n.Info(e,C,x),w=0,A=a;w<A.length;w++){var p=A[w];p.startUnit(C,S,x)}for(var o=0,s=S.edgeCount*2;o<s;++o){d.feature=S.a[o],f.feature=S.b[o];for(var M=0,D=a;M<D.length;M++){var p=D[M];p.isApplicable(S.edgeProps.type[o])&&p.handleIntraContact(o,d,f)}}}}}function aWe(e,t){var r=t.contacts,n=function(l,c,d,f,h){var v=f.get(d)||[1/0,-1],p=v[0],m=v[1];l<p?(m!==-1&&h(m),f.set(d,[l,c])):h(c)};function i(l,c,d,f,h){var v=c.members[c.offsets[c.feature]],p=d.members[d.offsets[d.feature]],m=c.unit.getResidueIndex(v),g=d.unit.getResidueIndex(p),y=v+"|"+c.unit.id+"|"+g+"|"+d.unit.id+"|A",b=p+"|"+d.unit.id+"|"+m+"|"+c.unit.id+"|B",S=_n.distance(c,d);n(S,l,y,f,h),n(S,l,b,f,h)}var a=new Map,o=function(l){return r.edges[l].props.flag=1},s,u;return{isApplicable:function(l){return l===6},handleInterContact:function(l,c,d){i(l,c,d,a,o)},startUnit:function(l,c,d){s=new Map,u=function(f){return c.edgeProps.flag[f]=1}},handleIntraContact:function(l,c,d){i(l,c,d,s,u)}}}function oWe(e,t){var r=t.contacts,n=function(i,a){for(var o=i.types[i.feature]===9?a:i,s=o.members[o.offsets[o.feature]],u=t.unitsContacts.get(o.unit.id),l=u.edgeProps.type,c=u.elementsIndex,d=c.offsets,f=c.indices,h=d[s],v=d[s+1];h<v;++h)if(l[f[h]]===4)return!0;for(var p=r.getEdgeIndices(o.feature,o.unit.id),h=0,v=p.length;h<v;++h)if(r.edges[p[h]].props.type===4)return!0;return!1};return{isApplicable:function(i){return i===8},handleInterContact:function(i,a,o){n(a,o)&&(r.edges[i].props.flag=1)},startUnit:function(){},handleIntraContact:function(i,a,o){if(n(a,o)){var s=t.unitsContacts.get(a.unit.id).edgeProps.flag;s[i]=1}}}}function KO(e,t,r,n,i){for(var a=r.offsets,o=r.feature,s=n.offsets,u=n.feature,l=a[o],c=a[o+1];l<c;++l)for(var d=r.members[l],f=i.getContactIndicesForElement(d,r.unit),h=0,v=f.length;h<v;++h){var p=f[h];if(e.includes(i.edges[p].props.type))for(var m=s[u],g=s[u+1];m<g;++m){var y=n.members[m];if(i.getContactIndicesForElement(y,n.unit).includes(p)){i.edges[t].props.flag=1;return}}}}function QO(e,t,r,n,i){for(var a=i.edgeProps,o=a.type,s=a.flag,u=i.elementsIndex,l=u.offsets,c=u.indices,d=r.offsets,f=r.feature,h=n.offsets,v=n.feature,p=d[f],m=d[f+1];p<m;++p)for(var g=r.members[p],y=l[g],b=l[g+1];y<b;++y){var S=c[y];if(e.includes(o[S])){for(var x=h[v],C=h[v+1];x<C;++x)for(var w=n.members[x],A=l[w],M=l[w+1];A<M;++A)if(S===c[A]){s[t]=1;return}}}}function sWe(e,t){var r=t.contacts;return{isApplicable:function(n){return n===1},handleInterContact:function(n,i,a){KO([4,8],n,i,a,r)},startUnit:function(){},handleIntraContact:function(n,i,a){QO([4,8],n,i,a,t.unitsContacts.get(i.unit.id))}}}function uWe(e,t){var r=t.contacts;return{isApplicable:function(n){return n===6||n===2},handleInterContact:function(n,i,a){KO([3],n,i,a,r)},startUnit:function(){},handleIntraContact:function(n,i,a){QO([3],n,i,a,t.unitsContacts.get(i.unit.id))}}}function lWe(e,t){var r=t.contacts;return{isApplicable:function(n){return n===1},handleInterContact:function(n,i,a){KO([7],n,i,a,r)},startUnit:function(){},handleIntraContact:function(n,i,a){QO([7],n,i,a,t.unitsContacts.get(i.unit.id))}}}var Hc;(function(e){function t(c,d,f,h,v,p){return uK("interactions",{structure:d,interactions:c},{unitA:f,indexA:h,unitB:v,indexB:p})}e.Location=t;function r(c){return!!c&&c.kind==="data-location"&&c.tag==="interactions"}e.isLocation=r;function n(c,d){return c.data.structure===d.data.structure&&c.data.interactions===d.data.interactions&&c.element.indexA===d.element.indexA&&c.element.indexB===d.element.indexB&&c.element.unitA===d.element.unitA&&c.element.unitB===d.element.unitB}e.areLocationsEqual=n;function i(c,d){var f=d.unitA,h=d.indexA,v=d.unitB,p=d.indexB,m=c.contacts,g=c.unitsContacts;if(f===v){var y=g.get(f.id),b=y.getDirectedEdgeIndex(h,p);return Hj(y.edgeProps.type[b])}else{var b=m.getEdgeIndex(h,f.id,p,v.id);return Hj(m.edges[b].props.type)}}function a(c){return i(c.data.interactions,c.element)}e.locationLabel=a;function o(c,d,f){return H3("interactions",{structure:c,interactions:d},f,function(h){return u(d,f,h)},function(){return l(c,d,f)})}e.Loci=o;function s(c){return!!c&&c.kind==="data-loci"&&c.tag==="interactions"}e.isLoci=s;function u(c,d,f){var h=c.unitsFeatures;return Bc.fromPairProvider(d.length,function(v,p,m){var g=d[v];_n.setPosition(p,g.unitA,g.indexA,h.get(g.unitA.id)),_n.setPosition(m,g.unitB,g.indexB,h.get(g.unitB.id))},f)}e.getBoundingSphere=u;function l(c,d,f){var h=f[0];if(h===void 0)return"";var v=h.unitA,p=h.indexA,m=h.unitB,g=h.indexB,y=d.unitsFeatures,b=y.get(v.id),S=b.members,x=b.offsets,C=y.get(m.id),w=C.members,A=C.offsets,M={granularity:"element"};return(x[p+1]-x[p]>1||A[g+1]-A[g]>1)&&(M.granularity="residue"),[i(d,h),FO(Vt.Location(c,v,S[x[p]],c,m,w[A[g]]),M)].join("</br>")}e.getLabel=l})(Hc||(Hc={}));var cWe=[sqe,uqe,lqe,Nqe,Fqe,Bqe,GGe,qGe,Wqe,tWe,rWe],I_={ionic:Uqe,"pi-stacking":jqe,"cation-pi":zqe,"halogen-bonds":WGe,"hydrogen-bonds":cqe,"weak-hydrogen-bonds":dqe,hydrophobic:$qe,"metal-coordination":nWe};function dWe(e){e===void 0&&(e=[]);var t=Object.create(null);return Object.keys(I_).forEach(function(r){t[r]=I.MappedStatic(e.includes(r)?"on":"off",{on:I.Group(I_[r].params),off:I.Group({})},{cycle:!0})}),t}var fWe=dWe(["cation-pi","pi-stacking","hydrogen-bonds","halogen-bonds","metal-coordination"]),See={providers:I.Group(fWe,{isFlat:!0}),contacts:I.Group(AGe,{label:"Advanced Options"})};function hWe(e,t,r){return ce(this,void 0,void 0,function(){var n,i,a,o,s,u,l,c,d,f,h,v,p,m,g,y;return de(this,function(b){switch(b.label){case 0:return n=E(E({},I.getDefaultValues(See)),r),[4,Fb.attach(e,t)];case 1:b.sent(),i=[],V3(I_).forEach(function(S){var x=n.providers[S],C=x.name,w=x.params;C==="on"&&i.push(I_[S].createTester(w))}),a=new Set,i.forEach(function(S){return li.add(a,S.requiredFeatures)}),o=cWe.filter(function(S){return li.areIntersecting(a,S.types)}),s=Ls.Mutable(),u=Ls.Mutable(),l=0,c=t.unitSymmetryGroups.length,b.label=2;case 2:return l<c?(d=t.unitSymmetryGroups[l],e.runtime.shouldUpdate?[4,e.runtime.update({message:"computing interactions",current:l,max:c})]:[3,4]):[3,6];case 3:b.sent(),b.label=4;case 4:for(f=pWe(t,d.units[0],o),h=vWe(t,d.units[0],f,i,n.contacts),v=0,p=d.units.length;v<p;++v)m=d.units[v],s.set(m.id,f),u.set(m.id,h);b.label=5;case 5:return++l,[3,2];case 6:return g=mWe(t,s,i,n.contacts),y={unitsFeatures:s,unitsContacts:u,contacts:g},iWe(t,y),[2,y]}})})}function pWe(e,t,r){var n=t.elements.length,i=V5.create(n,n/2);if(Ue.isAtomic(t))for(var a=0,o=r;a<o.length;a++){var s=o[a];s.add(e,t,i)}return i.getFeatures(n)}function vWe(e,t,r,n,i){var a=G5.create(r,t.elements.length);return Ue.isAtomic(t)&&IGe(e,t,r,a,n,i),a.getContacts()}function mWe(e,t,r,n){var i=q5.create();return $e.eachUnitPair(e,function(a,o){var s=t.get(a.id),u=t.get(o.id);RGe(e,a,s,o,u,i,r,n)},{maxRadius:Math.max.apply(Math,r.map(function(a){return a.maxDistance})),validUnit:function(a){return Ue.isAtomic(a)},validUnitPair:function(a,o){return $e.validUnitPair(e,a,o)}}),i.getContacts(t)}var gT=E({},See),Vn=Yf.createProvider({label:"Interactions",descriptor:yo({name:"molstar_computed_interactions"}),type:"local",defaultParams:gT,getParams:function(e){return gT},isApplicable:function(e){return!e.isCoarseGrained},obtain:function(e,t,r){return ce(void 0,void 0,void 0,function(){var n,i;return de(this,function(a){switch(a.label){case 0:return n=E(E({},I.getDefaultValues(gT)),r),i={},[4,hWe(e,t,n)];case 1:return[2,(i.value=a.sent(),i)]}})})}}),lx=_(),cx=_(),Ph=_(),yT=qe.add,tz=qe.add3,M_;(function(e){function t(r,n,i){r===void 0&&(r=2048),n===void 0&&(n=1024);var a=qe.create(Float32Array,1,n,i?i.groupBuffer.ref.value:r),o=qe.create(Float32Array,3,n,i?i.startBuffer.ref.value:r),s=qe.create(Float32Array,3,n,i?i.endBuffer.ref.value:r),u=qe.create(Float32Array,1,n,i?i.scaleBuffer.ref.value:r),l=qe.create(Float32Array,1,n,i?i.capBuffer.ref.value:r),c=function(f,h,v,p,m,g,y,b,S,x){for(var C=0;C<6;++C)tz(o,f,h,v),tz(s,p,m,g),yT(a,x),yT(u,y),yT(l,(b?1:0)+(S?2:0))},d=function(f,h,v,p,m,g,y){var b=_.distance(f,h),S=Math.floor(v/2),x=1/v;_.sub(Ph,h,f);for(var C=0;C<S;++C){var w=x*(C*2+1);_.setMagnitude(Ph,Ph,b*w),_.add(lx,f,Ph),_.setMagnitude(Ph,Ph,b*x*((C+1)*2)),_.add(cx,f,Ph),c(lx[0],lx[1],lx[2],cx[0],cx[1],cx[2],p,m,g,y)}};return{add:c,addFixedCountDashes:d,addFixedLengthDashes:function(f,h,v,p,m,g,y){var b=_.distance(f,h);d(f,h,b/v,p,m,g,y)},getCylinders:function(){var f=a.elementCount/6,h=qe.compact(a,!0),v=qe.compact(o,!0),p=qe.compact(s,!0),m=qe.compact(u,!0),g=qe.compact(l,!0),y=i&&f<=i.cylinderCount?i.mappingBuffer.ref.value:new Float32Array(f*18),b=i&&f<=i.cylinderCount?i.indexBuffer.ref.value:new Uint32Array(f*12);return(!i||f>i.cylinderCount)&&gWe(f,y,b),Vo.create(y,b,h,v,p,m,g,f,i)}}}e.create=t})(M_||(M_={}));function gWe(e,t,r){for(var n=0;n<e;++n){var i=n*18;t[i]=-1,t[i+1]=1,t[i+2]=-1,t[i+3]=-1,t[i+4]=-1,t[i+5]=-1,t[i+6]=1,t[i+7]=1,t[i+8]=-1,t[i+9]=1,t[i+10]=1,t[i+11]=1,t[i+12]=1,t[i+13]=-1,t[i+14]=-1,t[i+15]=1,t[i+16]=-1,t[i+17]=1}for(var n=0;n<e;++n){var a=n*6,o=n*12;r[o]=a,r[o+1]=a+1,r[o+2]=a+2,r[o+3]=a+1,r[o+4]=a+4,r[o+5]=a+2,r[o+6]=a+2,r[o+7]=a+4,r[o+8]=a+3,r[o+9]=a+4,r[o+10]=a+5,r[o+11]=a+3}}var Cv={linkScale:I.Numeric(.45,{min:0,max:1,step:.01}),linkSpacing:I.Numeric(1,{min:0,max:2,step:.01}),linkCap:I.Boolean(!1),dashCount:I.Numeric(4,{min:2,max:10,step:2}),dashScale:I.Numeric(.8,{min:0,max:2,step:.1}),dashCap:I.Boolean(!0),stubCap:I.Boolean(!0),radialSegments:I.Numeric(16,{min:2,max:56,step:2},Et.CustomQualityParamInfo)};I.getDefaultValues(Cv);var Cee={linkScale:I.Numeric(.5,{min:0,max:1,step:.1}),linkSpacing:I.Numeric(.1,{min:0,max:2,step:.01}),dashCount:I.Numeric(4,{min:2,max:10,step:2})};I.getDefaultValues(Cee);var Rn=_(),Id=_(),cs=_(),yWe=_.create(0,1,0);function ZO(e,t,r,n){_.normalize(Id,_.sub(Id,t,r)),n!==null?_.sub(cs,t,n):_.copy(cs,t),_.normalize(cs,cs);var i=_.dot(Id,cs);return 1-Math.abs(i)<1e-5&&(_.set(cs,1,0,0),i=_.dot(Id,cs),1-Math.abs(i)<1e-5&&(_.set(cs,0,1,0),i=_.dot(Id,cs))),_.setMagnitude(Id,Id,i),_.sub(cs,cs,Id),_.normalize(e,cs)}var cu=_.scale,Lo=_.add,wi=_.sub,Sc=_.setMagnitude,bWe=_.dot;function _v(e,t,r,n){var i=t.linkCount,a=t.referencePosition,o=t.position,s=t.style,u=t.radius,l=t.ignore,c=t.stub;if(!i)return Nt.createEmpty(n);for(var d=r.linkScale,f=r.linkSpacing,h=r.radialSegments,v=r.linkCap,p=r.dashCount,m=r.dashScale,g=r.dashCap,y=r.stubCap,b=h*2*i*2,S=wt.createState(b,b/4,n),x=_(),C=_(),w=_(),A={radiusTop:1,radiusBottom:1,radialSegments:h,topCap:v,bottomCap:v},M=p+1,D=0,k=i;D<k;++D)if(!(l&&l(D))){o(x,C,D),wi(Rn,C,x);var R=u(D),L=s?s(D):0,H=y&&(c?c(D):!1),B=bWe(Rn,yWe)>0?[H,v]:[v,H],j=B[0],Q=B[1];S.currentGroup=D;var G=4.5;if(L===0)A.radiusTop=A.radiusBottom=R,A.topCap=j,A.bottomCap=Q,Ma(S,x,C,.5,A);else if(L===1)A.radiusTop=A.radiusBottom=R*m,A.topCap=A.bottomCap=g,Yy(S,x,C,.5,M,A);else if(L===2||L===3||L===5||L===6){var W=L===2?2:L===3?3:1.5,q=R*(d/(.5*W)),ee=(R-q)*f;ZO(w,x,C,a?a(D):null),A.topCap=j,A.bottomCap=Q,L===5||L===6?(A.radiusTop=A.radiusBottom=R,Ma(S,x,C,.5,A),A.radiusTop=A.radiusBottom=R*d,A.topCap=A.bottomCap=g,Sc(w,w,ee*G),wi(x,x,w),wi(C,C,w),Yy(S,x,C,.5,3,A),L===6&&(Sc(w,w,ee*G*2),Lo(x,x,w),Lo(C,C,w),Yy(S,x,C,.5,3,A))):(Sc(w,w,ee),A.radiusTop=A.radiusBottom=q,W===3&&Ma(S,x,C,.5,A),YBe(S,x,C,.5,w,A))}else L===4&&(cu(Rn,Rn,.475),Lo(x,x,Rn),wi(C,C,Rn),A.radiusTop=A.radiusBottom=R,A.topCap=j,A.bottomCap=Q,Ma(S,x,C,.5,A))}return wt.getMesh(S)}function _ee(e,t,r,n){var i=t.linkCount,a=t.referencePosition,o=t.position,s=t.style,u=t.radius,l=t.ignore,c=t.stub;if(!i)return Vo.createEmpty(n);for(var d=r.linkScale,f=r.linkSpacing,h=r.linkCap,v=r.dashCount,p=r.dashScale,m=r.dashCap,g=r.stubCap,y=i*2,b=M_.create(y,y/4,n),S=_(),x=_(),C=_(),w=_(),A=v%2===1?v:v+1,M=.5-.5/2/A,D=3,k=.5-.5/2/D,R=4.5,L=0,H=i;L<H;++L)if(!(l&&l(L))){o(S,x,L);var B=u(L),j=s?s(L):0,Q=g&&(c?c(L):!1);if(j===0)cu(C,Lo(C,S,x),.5),b.add(S[0],S[1],S[2],C[0],C[1],C[2],1,h,Q,L);else if(j===1)cu(Rn,wi(Rn,x,S),M),wi(x,x,Rn),b.addFixedCountDashes(S,x,A,p,m,m,L);else if(j===2||j===3||j===5||j===6){var G=j===2?2:j===3?3:1.5,W=d/(.5*G),q=(B-W*B)*f;cu(C,Lo(C,S,x),.5),ZO(w,S,x,a?a(L):null),j===5||j===6?(b.add(S[0],S[1],S[2],C[0],C[1],C[2],1,h,Q,L),cu(Rn,wi(Rn,x,S),k),wi(x,x,Rn),Sc(w,w,q*R),wi(S,S,w),wi(x,x,w),b.addFixedCountDashes(S,x,D,d,m,m,L),j===6&&(Sc(w,w,q*R*2),Lo(S,S,w),Lo(x,x,w),b.addFixedCountDashes(S,x,D,d,m,m,L))):(Sc(w,w,q),G===3&&b.add(S[0],S[1],S[2],C[0],C[1],C[2],W,h,!1,L),b.add(S[0]+w[0],S[1]+w[1],S[2]+w[2],C[0]+w[0],C[1]+w[1],C[2]+w[2],W,h,Q,L),b.add(S[0]-w[0],S[1]-w[1],S[2]-w[2],C[0]-w[0],C[1]-w[1],C[2]-w[2],W,h,Q,L))}else j===4&&(cu(Rn,wi(Rn,x,S),.475),Lo(S,S,Rn),wi(x,x,Rn),b.add(S[0],S[1],S[2],x[0],x[1],x[2],1,h,Q,L))}return b.getCylinders()}function wee(e,t,r,n){var i=t.linkCount,a=t.referencePosition,o=t.position,s=t.style,u=t.ignore;if(!i)return bn.createEmpty(n);for(var l=r.linkScale,c=r.linkSpacing,d=r.dashCount,f=i*2,h=Zo.create(f,f/4,n),v=_(),p=_(),m=_(),g=_(),y=d%2===1?d:d+1,b=.5-.5/2/y,S=3,x=.5-.5/2/S,C=4.5,w=0,A=i;w<A;++w)if(!(u&&u(w))){o(v,p,w);var M=s?s(w):0;if(M===0)cu(m,Lo(m,v,p),.5),h.add(v[0],v[1],v[2],m[0],m[1],m[2],w);else if(M===1)cu(Rn,wi(Rn,p,v),b),wi(p,p,Rn),h.addFixedCountDashes(v,p,y,w);else if(M===2||M===3||M===5||M===6){var D=M===2?2:M===3?3:1.5,k=1*(l/(.5*D)),R=(1-k)*c;cu(m,Lo(m,v,p),.5),ZO(g,v,p,a?a(w):null),M===5||M===6?(h.add(v[0],v[1],v[2],m[0],m[1],m[2],w),cu(Rn,wi(Rn,p,v),x),wi(p,p,Rn),Sc(g,g,R*C),wi(v,v,g),wi(p,p,g),h.addFixedCountDashes(v,p,S,w),M===6&&(Sc(g,g,R*C*2),Lo(v,v,g),Lo(p,p,g),h.addFixedCountDashes(v,p,S,w))):(Sc(g,g,R),D===3&&h.add(v[0],v[1],v[2],m[0],m[1],m[2],w),h.add(v[0]+g[0],v[1]+g[1],v[2]+g[2],m[0]+g[0],m[1]+g[1],m[2]+g[2],w),h.add(v[0]-g[0],v[1]-g[1],v[2]-g[2],m[0]-g[0],m[1]-g[1],m[2]-g[2],w))}else M===4&&(cu(Rn,wi(Rn,p,v),.475),Lo(v,v,Rn),wi(p,p,Rn),h.add(v[0],v[1],v[2],p[0],p[1],p[2],w))}return h.getLines()}function xWe(e,t,r,n,i,a){return ce(this,void 0,void 0,function(){var o,s,u,l,c,d,f,h,v,p,m,g,y,b,S,x,C,w,A;return de(this,function(M){return Ue.isAtomic(t)?(o=r.child,s=o==null?void 0:o.unitMap.get(t.id),o&&!s?[2,Nt.createEmpty(a)]:(u=Ze.create(r,t),l=Vn.get(r).value,c=l.unitsFeatures.get(t.id),d=l.unitsContacts.get(t.id),f=c.x,h=c.y,v=c.z,p=c.members,m=c.offsets,g=d.edgeCount,y=d.a,b=d.b,S=d.edgeProps.flag,x=i.sizeFactor,g?(C={linkCount:g*2,position:function(D,k,R){_.set(D,f[y[R]],h[y[R]],v[y[R]]),_.set(k,f[b[R]],h[b[R]],v[b[R]])},style:function(D){return 1},radius:function(D){u.element=t.elements[p[m[y[D]]]];var k=n.size.size(u);u.element=t.elements[p[m[b[D]]]];var R=n.size.size(u);return Math.min(k,R)*x},ignore:function(D){return S[D]===1||!!s&&!Je.has(s.elements,t.elements[p[m[y[D]]]])}},w=_v(e,C,i,a),A=Fe.expand(Fe(),(s??t).boundary.sphere,1*x),w.setBoundingSphere(A),[2,w]):[2,Nt.createEmpty(a)])):[2,Nt.createEmpty(a)]})})}var Eee=E(E(E({},ga),Cv),{sizeFactor:I.Numeric(.3,{min:0,max:10,step:.01}),dashCount:I.Numeric(6,{min:2,max:10,step:2}),dashScale:I.Numeric(.4,{min:0,max:2,step:.1}),includeParent:I.Boolean(!1)});function SWe(e){return Ja({defaultProps:I.getDefaultValues(Eee),createGeometry:xWe,createLocationIterator:wWe,getLoci:CWe,eachLocation:_We,setUpdateState:function(t,r,n,i,a,o,s){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.dashCount!==n.dashCount||r.dashScale!==n.dashScale||r.dashCap!==n.dashCap||r.radialSegments!==n.radialSegments;var u=Vn.get(o.structure).version;t.info.interactionsHash!==u&&(t.createGeometry=!0,t.updateTransform=!0,t.updateColor=!0,t.info.interactionsHash=u)}},e)}function CWe(e,t,r){var n=e.objectId,i=e.instanceId,a=e.groupId;if(r===n){var o=t.structure,s=t.group,u=o.unitMap.get(s.units[i].id),l=Vn.get(o).value,c=l.unitsContacts.get(u.id),d=c.a,f=c.b;return Hc.Loci(o,l,[{unitA:u,indexA:d[a],unitB:u,indexB:f[a]},{unitA:u,indexA:f[a],unitB:u,indexB:d[a]}])}return Or}function _We(e,t,r,n){var i=!1;if(Hc.isLoci(e)){var a=t.structure,o=t.group;if(!$e.areEquivalent(e.data.structure,a))return!1;var s=Vn.get(a).value;if(e.data.interactions!==s)return!1;for(var u=o.units[0],l=s.unitsContacts.get(u.id),c=l.edgeCount*2,d=0,f=e.elements;d<f.length;d++){var h=f[d];if(h.unitA===h.unitB){var v=o.unitIndexMap.get(h.unitA.id);if(v!==void 0){var p=l.getDirectedEdgeIndex(h.indexA,h.indexB);p!==-1&&r(Te.ofSingleton(v*c+p))&&(i=!0)}}}}else if(De.is(e)){var a=t.structure,o=t.group;if(!$e.areEquivalent(e.structure,a))return!1;var s=Vn.get(a).value;if(!s)return!1;for(var u=o.units[0],l=s.unitsContacts.get(u.id),m=s.unitsFeatures.get(u.id),g=l.edgeCount*2,y=l.offset,b=m.elementsIndex,S=b.offsets,x=b.indices,C=function(H){var B=o.unitIndexMap.get(H.unit.id);if(B!==void 0||n&&Oe.size(H.indices)===1)return"continue";Oe.forEach(H.indices,function(j){for(var Q=S[j],G=S[j+1];Q<G;++Q)for(var W=x[Q],q=y[W],ee=y[W+1];q<ee;++q)r(Te.ofSingleton(B*g+q))&&(i=!0)})},w=0,A=e.elements;w<A.length;w++){var h=A[w];C(h)}}return i}function wWe(e){var t=e.structure,r=e.group,n=r.units[0],i=Vn.get(t).value,a=i.unitsContacts.get(n.id),o=a.edgeCount*2,s=r.units.length,u=Hc.Location(i,t),l=u.element,c=function(d,f){var h=r.units[f];return l.unitA=h,l.indexA=a.a[d],l.unitB=h,l.indexB=a.b[d],u};return mn(o,s,1,c)}function EWe(e,t,r,n,i){if(!t.hasAtomic)return Nt.createEmpty(i);var a=Ze.create(t),o=Vn.get(t).value,s=o.contacts,u=o.unitsFeatures,l=s.edgeCount,c=s.edges,d=n.sizeFactor;if(!l)return Nt.createEmpty(i);var f=t.child,h={linkCount:l,position:function(m,g,y){var b=c[y],S=b.unitA,x=b.indexA,C=b.unitB,w=b.indexB,A=u.get(S),M=u.get(C),D=t.unitMap.get(S),k=t.unitMap.get(C);_.set(m,A.x[x],A.y[x],A.z[x]),_.transformMat4(m,m,D.conformation.operator.matrix),_.set(g,M.x[w],M.y[w],M.z[w]),_.transformMat4(g,g,k.conformation.operator.matrix)},style:function(m){return 1},radius:function(m){var g=c[m],y=u.get(g.unitA);a.unit=t.unitMap.get(g.unitA),a.element=a.unit.elements[y.members[y.offsets[g.indexA]]];var b=r.size.size(a),S=u.get(g.unitB);a.unit=t.unitMap.get(g.unitB),a.element=a.unit.elements[S.members[S.offsets[g.indexB]]];var x=r.size.size(a);return Math.min(b,x)*d},ignore:function(m){if(c[m].props.flag===1)return!0;if(f){var g=c[m],y=f.unitMap.get(g.unitA);if(!y)return!0;var b=t.unitMap.get(g.unitA),S=u.get(g.unitA),x=b.elements[S.members[S.offsets[g.indexA]]];if(!Je.has(y.elements,x))return!0}return!1}},v=_v(e,h,n,i),p=Fe.expand(Fe(),(f??t).boundary.sphere,1*d);return v.setBoundingSphere(p),v}var Aee=E(E(E({},Nb),Cv),{sizeFactor:I.Numeric(.3,{min:0,max:10,step:.01}),dashCount:I.Numeric(6,{min:2,max:10,step:2}),dashScale:I.Numeric(.4,{min:0,max:2,step:.1}),includeParent:I.Boolean(!1)});function AWe(e){return xv({defaultProps:I.getDefaultValues(Aee),createGeometry:EWe,createLocationIterator:IWe,getLoci:PWe,eachLocation:TWe,setUpdateState:function(t,r,n,i,a,o,s){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.dashCount!==n.dashCount||r.dashScale!==n.dashScale||r.dashCap!==n.dashCap||r.radialSegments!==n.radialSegments;var u=Vn.get(o).version;t.info.interactionsHash!==u&&(t.createGeometry=!0,t.updateTransform=!0,t.updateColor=!0,t.info.interactionsHash=u)}},e)}function PWe(e,t,r){var n=e.objectId,i=e.groupId;if(r===n){var a=Vn.get(t).value,o=a.contacts.edges[i],s=t.unitMap.get(o.unitA),u=t.unitMap.get(o.unitB);return Hc.Loci(t,a,[{unitA:s,indexA:o.indexA,unitB:u,indexB:o.indexB},{unitA:u,indexA:o.indexB,unitB:s,indexB:o.indexA}])}return Or}function TWe(e,t,r,n){var i,a=!1;if(Hc.isLoci(e)){if(!$e.areEquivalent(e.data.structure,t))return!1;var o=Vn.get(t).value;if(e.data.interactions!==o)return!1;for(var s=o.contacts,u=0,l=e.elements;u<l.length;u++){var c=l[u],d=s.getEdgeIndex(c.indexA,c.unitA.id,c.indexB,c.unitB.id);d!==-1&&r(Te.ofSingleton(d))&&(a=!0)}}else if(De.is(e)){if(!$e.areEquivalent(e.structure,t)||n&&e.elements.length===1)return!1;var f=(i=Vn.get(t).value)===null||i===void 0?void 0:i.contacts;if(!f)return!1;for(var h=function(g){var y=g.unit;if(!Ue.isAtomic(y)||n&&Oe.size(g.indices)===1)return"continue";Oe.forEach(g.indices,function(b){for(var S=0,x=f.getContactIndicesForElement(b,y);S<x.length;S++){var C=x[S];r(Te.ofSingleton(C))&&(a=!0)}})},v=0,p=e.elements;v<p.length;v++){var m=p[v];h(m)}}return a}function IWe(e){var t=Vn.get(e).value,r=t.contacts,n=r.edgeCount,i=1,a=Hc.Location(t,e),o=a.element,s=function(u){var l=r.edges[u];return o.unitA=e.unitMap.get(l.unitA),o.indexA=l.indexA,o.unitB=e.unitMap.get(l.unitB),o.indexB=l.indexB,a};return mn(n,i,1,s,!0)}var Pee={"intra-unit":function(e,t){return Jn("Intra-unit interactions cylinder",e,t,SWe)},"inter-unit":function(e,t){return Su("Inter-unit interactions cylinder",e,t,AWe)}},Tee=E(E(E({},Eee),Aee),{unitKinds:Lb(["atomic"]),sizeFactor:I.Numeric(.2,{min:.01,max:1,step:.01}),visuals:I.MultiSelect(["intra-unit","inter-unit"],I.objectToOptions(Pee))});function MWe(e,t){return I.clone(Tee)}function DWe(e,t){return or.createMulti("Interactions",e,t,Ri,Pee)}var D_={name:"interactions",label:"Non-covalent Interactions",description:"Displays non-covalent interactions as dashed cylinders.",factory:DWe,getParams:MWe,defaultValues:I.getDefaultValues(Tee),defaultColorTheme:{name:"interaction-type"},defaultSizeTheme:{name:"uniform"},isApplicable:function(e){return e.elementCount>0&&Vn.isApplicable(e)},ensureCustomProperties:{attach:function(e,t){return Vn.attach(e,t,void 0,!0)},detach:function(e){return Vn.ref(e,!1)}},getData:function(e,t){return t.includeParent?e.asParent():e},mustRecreate:function(e,t){return e.includeParent!==t.includeParent}},X5=at(13421772),RWe="Assigns colors according the interaction type of a link.",Ea={HydrogenBond:2851770,Hydrophobic:8421504,HalogenBond:4259775,Ionic:15779860,MetalCoordination:9191577,CationPi:16744448,PiStacking:9220966,WeakHydrogenBond:12967404},kWe=[["Hydrogen Bond",Ea.HydrogenBond],["Hydrophobic",Ea.Hydrophobic],["Halogen Bond",Ea.HalogenBond],["Ionic",Ea.Ionic],["Metal Coordination",Ea.MetalCoordination],["Cation Pi",Ea.CationPi],["Pi Stacking",Ea.PiStacking],["Weak HydrogenBond",Ea.WeakHydrogenBond]];function rz(e){switch(e){case 4:return Ea.HydrogenBond;case 6:return Ea.Hydrophobic;case 5:return Ea.HalogenBond;case 1:return Ea.Ionic;case 7:return Ea.MetalCoordination;case 2:return Ea.CationPi;case 3:return Ea.PiStacking;case 8:return Ea.WeakHydrogenBond;case 0:return X5}}var Iee={};function OWe(e){return Iee}function Mee(e,t){var r,n=e.structure?Vn.get(e.structure):void 0,i=n?cv(n.id,n.version):-1;return n&&n.value?r=function(a){if(Hc.isLocation(a)){var o=a.data.interactions,s=o.unitsContacts,u=o.contacts,l=a.element,c=l.unitA,d=l.unitB,f=l.indexA,h=l.indexB;if(c===d){var v=s.get(c.id),p=v.getDirectedEdgeIndex(f,h);return rz(v.edgeProps.type[p])}else{var p=u.getEdgeIndex(f,c.id,h,d.id);return rz(u.edges[p].props.type)}}return X5}:r=function(){return X5},{factory:Mee,granularity:"group",color:r,props:t,contextHash:i,description:RWe,legend:uh(kWe)}}var Y5={name:"interaction-type",label:"Interaction Type",category:"Miscellaneous",factory:Mee,getParams:OWe,defaultValues:I.getDefaultValues(Iee),isApplicable:function(e){return!!e.structure},ensureCustomProperties:{attach:function(e,t){return t.structure?Vn.attach(e,t.structure,void 0,!0):Promise.resolve()},detach:function(e){return e.structure&&Vn.ref(e.structure,!1)}}};function yS(e,t,r){r===void 0&&(r={});var n=r;return typeof n.type=="string"||typeof n.color=="string"||typeof n.size=="string"?NWe(e,t||$e.Empty,r):Dee(e,t||$e.Empty,r)}function LWe(e,t){var r=e.representation.structure.themes;return t?r.colorThemeRegistry.getApplicableTypes({structure:t}):r.colorThemeRegistry.types}function K5(e,t,r,n,i){var a=e.representation.structure,o=a.registry,s=a.themes,u=o.get(r||o.default.name),l=s.colorThemeRegistry.get(n||u.defaultColorTheme.name),c=I.getDefaultValues(l.getParams({structure:t||$e.Empty}));return l.name===u.defaultColorTheme.name&&Object.assign(c,u.defaultColorTheme.props),{name:l.name,params:Object.assign(c,i)}}function nz(e,t,r,n,i){var a=e.representation.structure,o=a.registry,s=a.themes,u=o.get(r||o.default.name),l=s.sizeThemeRegistry.get(n||u.defaultSizeTheme.name),c=I.getDefaultValues(l.getParams({structure:t||$e.Empty}));return l.name===u.defaultSizeTheme.name&&Object.assign(c,u.defaultSizeTheme.props),{name:l.name,params:Object.assign(c,i)}}function NWe(e,t,r){var n=r.type&&e.representation.structure.registry.get(r.type)||e.representation.structure.registry.default.provider,i=r.color&&e.representation.structure.themes.colorThemeRegistry.get(r.color)||e.representation.structure.themes.colorThemeRegistry.get(n.defaultColorTheme.name),a=r.size&&e.representation.structure.themes.sizeThemeRegistry.get(r.size)||e.representation.structure.themes.sizeThemeRegistry.get(n.defaultSizeTheme.name);return Dee(e,t,{type:n,typeParams:r.typeParams,color:i,colorParams:r.colorParams,size:a,sizeParams:r.sizeParams})}function Dee(e,t,r){r===void 0&&(r={});var n=e.representation.structure.themes,i={structure:t},a=r.type||e.representation.structure.registry.default.provider,o=I.getDefaultValues(a.getParams(n,t)),s=Object.assign(o,r.typeParams),u=r.color||n.colorThemeRegistry.get(a.defaultColorTheme.name),l=I.getDefaultValues(u.getParams(i));u.name===a.defaultColorTheme.name&&Object.assign(l,a.defaultColorTheme.props);var c=Object.assign(l,r.colorParams),d=r.size||n.sizeThemeRegistry.get(a.defaultSizeTheme.name),f=I.getDefaultValues(d.getParams(i));d.name===a.defaultSizeTheme.name&&Object.assign(f,a.defaultSizeTheme.props);var h=Object.assign(f,r.sizeParams);return{type:{name:a.name,params:s},colorTheme:{name:u.name,params:c},sizeTheme:{name:d.name,params:h}}}var Dr;(function(e){var t=function(c){Le(d,c);function d(){return c!==null&&c.apply(this,arguments)||this}return d}(ge.Create({name:"Root",typeClass:"Root"}));e.Root=t;var r=function(c){Le(d,c);function d(){return c!==null&&c.apply(this,arguments)||this}return d}(ge.Create({name:"Category",typeClass:"Object"}));e.Category=r;var n=function(c){Le(d,c);function d(){return c!==null&&c.apply(this,arguments)||this}return d}(ge.CreateBehavior({name:"Behavior"}));e.Behavior=n,e.Categories={common:"Common",representation:"Representation",interaction:"Interaction","custom-props":"Custom Properties",misc:"Miscellaneous"},e.CreateCategory=kt.BuiltIn({name:"create-behavior-category",display:{name:"Behavior Category"},from:t,to:r,params:{label:I.Text("",{isHidden:!0})}})({apply:function(c){var d=c.params;return new r({},{label:d.label})}});var i=new Map;function a(c){return i.get(c.id)}e.getCategoryId=a;function o(c){var d=kt.CreateBuiltIn({name:c.name,display:c.display,from:[t],to:[n],params:c.params,apply:function(f,h){var v=f.params,p=c.label?c.label(v):{label:c.display.name,description:c.display.description};return new n(new c.ctor(h,v),p)},update:function(f){var h=this,v=f.b,p=f.newParams;return We.create("Update Behavior",function(){return ce(h,void 0,void 0,function(){var m;return de(this,function(g){switch(g.label){case 0:return v.data.update?[4,v.data.update(p)]:[2,ft.UpdateResult.Unchanged];case 1:return m=g.sent(),[2,m?ft.UpdateResult.Updated:ft.UpdateResult.Unchanged]}})})})},canAutoUpdate:c.canAutoUpdate});return i.set(d.id,c.category),d}e.create=o;function s(c,d){return function(){function f(h){this.ctx=h,this.sub=void 0}return f.prototype.register=function(){var h=this;this.sub=c.subscribe(this.ctx,function(v){return d(v,h.ctx)})},f.prototype.unregister=function(){this.sub&&this.sub.unsubscribe(),this.sub=void 0},f}()}e.simpleCommandHandler=s;var u=function(){function c(d,f){this.ctx=d,this.params=f,this.subs=[]}return c.prototype.subscribeCommand=function(d,f){this.subs.push(d.subscribe(this.ctx,f))},c.prototype.subscribeObservable=function(d,f){this.subs.push(d.subscribe(f))},c.prototype.track=function(d){this.subs.push(d)},c.prototype.unregister=function(){for(var d=0,f=this.subs;d<f.length;d++){var h=f[d];h.unsubscribe()}this.subs=[]},c.prototype.update=function(d){return xg(d,this.params)?!1:(this.params=d,!0)},c}();e.Handler=u;var l=function(){function c(d,f){this.plugin=d,this.params=f,this.subs=[]}return c.prototype.subscribeCommand=function(d,f){this.subs.push(d.subscribe(this.plugin,f))},c.prototype.subscribeObservable=function(d,f){this.subs.push(d.subscribe(f))},c.prototype.unregister=function(){for(var d=0,f=this.subs;d<f.length;d++){var h=f[d];h.unsubscribe()}this.subs=[]},c}();e.WithSubscribers=l})(Dr||(Dr={}));var Bb=function(){function e(){this.subs=void 0}return e.prototype.subscribe=function(t,r){var n=this;typeof this.subs>"u"&&(this.subs=[]);var i=t.subscribe(r);return this.subs.push(i),{unsubscribe:function(){i&&n.subs&&yp(n.subs,i)&&(i.unsubscribe(),i=void 0)}}},Object.defineProperty(e.prototype,"ev",{get:function(){return this._ev||(this._ev=Lc.create())},enumerable:!1,configurable:!0}),e.prototype.dispose=function(){if(this._ev&&this._ev.dispose(),this.subs){for(var t=0,r=this.subs;t<r.length;t++){var n=r[t];n.unsubscribe()}this.subs=void 0}},e}(),vd=function(e){Le(t,e);function t(r){var n=e.call(this)||this;return n._state=r,n}return t.prototype.updateState=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];var i=this.state,a=uAe(i,r);return a!==i?(this._state=a,!0):!1},Object.defineProperty(t.prototype,"state",{get:function(){return this._state},enumerable:!1,configurable:!0}),t}(Bb),Q5="2.2.0",FWe=new Date(typeof __MOLSTAR_DEBUG_TIMESTAMP__<"u"?__MOLSTAR_DEBUG_TIMESTAMP__:1627737258743),R_=function(e){Le(t,e);function t(r){var n=e.call(this,{current:void 0,entries:ri.List(),isPlaying:!1,nextSnapshotDelayInMs:t.DefaultNextSnapshotDelayInMs})||this;return n.plugin=r,n.entryMap=new Map,n.events={changed:n.ev()},n.timeoutHandle=void 0,n.next=function(){return ce(n,void 0,void 0,function(){var i,a,o;return de(this,function(s){switch(s.label){case 0:return this.timeoutHandle=void 0,i=this.getNextId(this.state.current,1),!i||i===this.state.current?(this.stop(),[2]):(a=this.setCurrent(i),[4,this.plugin.state.setSnapshot(a)]);case 1:return s.sent(),o=typeof a.durationInMs<"u"?a.durationInMs:this.state.nextSnapshotDelayInMs,this.state.isPlaying&&(this.timeoutHandle=setTimeout(this.next,o)),[2]}})})},n}return t.prototype.getIndex=function(r){return this.state.entries.indexOf(r)},t.prototype.getEntry=function(r){if(r)return this.entryMap.get(r)},t.prototype.remove=function(r){var n=this.entryMap.get(r);n&&(this.entryMap.delete(r),this.updateState({current:this.state.current===r?void 0:this.state.current,entries:this.state.entries.delete(this.getIndex(n))}),this.events.changed.next())},t.prototype.add=function(r){this.entryMap.set(r.snapshot.id,r),this.updateState({current:r.snapshot.id,entries:this.state.entries.push(r)}),this.events.changed.next()},t.prototype.replace=function(r,n){var i=this.getEntry(r);if(i){var a=this.getIndex(i),o=t.Entry(n,{name:i.name,description:i.description});this.entryMap.set(n.id,o),this.updateState({current:o.snapshot.id,entries:this.state.entries.set(a,o)}),this.events.changed.next()}},t.prototype.move=function(r,n){var i=this.state.entries.size;if(!(i<2)){var a=this.getEntry(r);if(a){var o=this.getIndex(a),s=(o+n)%i;s<0&&(s+=i);var u=this.state.entries.get(s),l=this.state.entries.asMutable();l.set(s,a),l.set(o,u),this.updateState({current:a.snapshot.id,entries:l.asImmutable()}),this.events.changed.next()}}},t.prototype.clear=function(){this.state.entries.size!==0&&(this.entryMap.clear(),this.updateState({current:void 0,entries:ri.List()}),this.events.changed.next())},t.prototype.setCurrent=function(r){var n=this.getEntry(r);return n&&(this.updateState({current:r}),this.events.changed.next()),n&&n.snapshot},t.prototype.getNextId=function(r,n){var i=this.state.entries.size;if(!r){if(i===0)return;var a=n===-1?i-1:0;return this.state.entries.get(a).snapshot.id}var o=this.getEntry(r);if(o){var s=this.getIndex(o);if(!(s<0))return s=(s+n)%i,s<0&&(s+=i),this.state.entries.get(s).snapshot.id}},t.prototype.setStateSnapshot=function(r){return ce(this,void 0,void 0,function(){var n,i,a,o,s,u,l;return de(this,function(c){switch(c.label){case 0:for(r.version,this.clear(),n=ri.List().asMutable(),i=0,a=r.entries;i<a.length;i++)o=a[i],this.entryMap.set(o.snapshot.id,o),n.push(o);return s=r.current?r.current:r.entries.length>0?r.entries[0].snapshot.id:void 0,this.updateState({current:s,entries:n.asImmutable(),isPlaying:!1,nextSnapshotDelayInMs:r.playback?r.playback.nextSnapshotDelayInMs:t.DefaultNextSnapshotDelayInMs}),this.events.changed.next(),s?(u=this.getEntry(s),l=u&&u.snapshot,l?[4,this.plugin.state.setSnapshot(l)]:[2]):[2];case 1:return c.sent(),r.playback&&r.playback.isPlaying&&this.play(!0),[2,l]}})})},t.prototype.syncCurrent=function(r){var n=this.plugin.state.getSnapshot(r==null?void 0:r.params);this.state.entries.size===0||!this.state.current?this.add(t.Entry(n,{name:r==null?void 0:r.name,description:r==null?void 0:r.description})):this.replace(this.state.current,n)},t.prototype.getStateSnapshot=function(r){return this.syncCurrent(r),{timestamp:+new Date,version:Q5,name:r&&r.name,description:r&&r.description,current:this.state.current,playback:{isPlaying:!!(r&&r.playOnLoad),nextSnapshotDelayInMs:this.state.nextSnapshotDelayInMs},entries:this.state.entries.valueSeq().toArray()}},t.prototype.serialize=function(r){return ce(this,void 0,void 0,function(){var n,i,a,o,s,u,l,c,d,f,h,v,p,m,g;return de(this,function(y){switch(y.label){case 0:return n=JSON.stringify(this.getStateSnapshot({params:r==null?void 0:r.params}),null,2),!(r!=null&&r.type)||r.type==="json"||r.type==="molj"?[2,new Blob([n],{type:"application/json;charset=utf-8"})]:[3,1];case 1:i=new Uint8Array(zC(n)),wm(i,0,n),a={"state.json":i},o=[],s=0,u=this.plugin.managers.asset.assets,y.label=2;case 2:return s<u.length?(l=u[s],c=l.asset,d=l.file,o.push([c.id,c]),f=a,h="assets/"+c.id,v=Uint8Array.bind,[4,d.arrayBuffer()]):[3,5];case 3:f[h]=new(v.apply(Uint8Array,[void 0,y.sent()])),y.label=4;case 4:return s++,[3,2];case 5:return o.length>0&&(p=JSON.stringify(o,null,2),m=new Uint8Array(zC(p)),wm(m,0,p),a["assets.json"]=m),[4,this.plugin.runTask(jAe(a))];case 6:return g=y.sent(),[2,new Blob([g],{type:"application/zip"})]}})})},t.prototype.open=function(r){return ce(this,void 0,void 0,function(){var n,i,g,i,a,o,s,u,l,c,d,f,h,v,p,m,g,y;return de(this,function(b){switch(b.label){case 0:return b.trys.push([0,8,,9]),n=r.name.toLowerCase(),n.endsWith("json")||n.endsWith("molj")?[4,this.plugin.runTask(pf(r,"string"))]:[3,2];case 1:return i=b.sent(),g=JSON.parse(i),t.isStateSnapshot(g)?[2,this.setStateSnapshot(g)]:t.isStateSnapshot(g.data)?[2,this.setStateSnapshot(g.data)]:(this.plugin.state.setSnapshot(g),[3,7]);case 2:return[4,this.plugin.runTask(pf(r,"zip"))];case 3:return i=b.sent(),a=Object.create(null),Iu(i,function(S,x){if(!(x==="state.json"||x==="assets.json")){var C=x.substring(x.indexOf("/")+1);a[C]=new File([S],C)}}),o=new File([i["state.json"]],"state.json"),[4,this.plugin.runTask(pf(o,"string"))];case 4:return s=b.sent(),i["assets.json"]?(u=new File([i["assets.json"]],"assets.json"),d=(c=JSON).parse,[4,this.plugin.runTask(pf(u,"string"))]):[3,6];case 5:for(l=d.apply(c,[b.sent()]),f=0,h=l;f<h.length;f++)v=h[f],p=v[0],m=v[1],this.plugin.managers.asset.set(m,a[p]);b.label=6;case 6:return g=JSON.parse(s),[2,this.setStateSnapshot(g)];case 7:return[3,9];case 8:return y=b.sent(),this.plugin.log.error("Reading state: "+y),[3,9];case 9:return[2]}})})},t.prototype.play=function(r){if(r===void 0&&(r=!1),this.updateState({isPlaying:!0}),r){var n=this.getEntry(this.state.current);if(!n){this.next();return}this.events.changed.next();var i=n.snapshot,a=typeof i.durationInMs<"u"?i.durationInMs:this.state.nextSnapshotDelayInMs;this.timeoutHandle=setTimeout(this.next,a)}else this.next()},t.prototype.stop=function(){this.updateState({isPlaying:!1}),typeof this.timeoutHandle<"u"&&clearTimeout(this.timeoutHandle),this.timeoutHandle=void 0,this.events.changed.next()},t.prototype.togglePlay=function(){this.state.isPlaying?(this.stop(),this.plugin.managers.animation.stop()):this.play()},t.DefaultNextSnapshotDelayInMs=1500,t}(vd);(function(e){function t(n,i){return E({timestamp:+new Date,snapshot:n},i)}e.Entry=t;function r(n){var i=n;return!!i&&!!i.timestamp&&!!i.entries}e.isStateSnapshot=r})(R_||(R_={}));function BWe(e){return e.toISOString().replace(/T/," ").replace(/\..+/,"")}function UWe(){var e=new Date,t=e.getFullYear(),r=e.getMonth()+1,n=e.getDate(),i=e.getHours(),a=e.getMinutes(),o=e.getSeconds();return t+"-"+r+"-"+n+"-"+i+"-"+a+"-"+o}function jWe(e){var t=window.open(e,"_blank");t||(window.location.href=e)}function iz(e){try{e.dispatchEvent(new MouseEvent("click"))}catch{var t=document.createEvent("MouseEvents");t.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),e.dispatchEvent(t)}}function Ree(e,t){if(t===void 0&&(t="download"),!!e)if("download"in HTMLAnchorElement.prototype){var r=document.createElement("a");r.download=t,r.rel="noopener",typeof e=="string"?(r.href=e,iz(r)):(r.href=URL.createObjectURL(e),setTimeout(function(){return URL.revokeObjectURL(r.href)},4e4),setTimeout(function(){return iz(r)}))}else if(typeof navigator<"u"&&navigator.msSaveOrOpenBlob)navigator.msSaveOrOpenBlob(e,t);else{var n=window.navigator.userAgent,i=/Safari/i.test(n),a=/CriOS\/[\d]+/.test(n),o=function(l){jWe(a?l:l.replace(/^data:[^;]*;/,"data:attachment/file;"))};if((i||a)&&FileReader)if(e instanceof Blob){var s=new FileReader;s.onloadend=function(){return o(s.result)},s.readAsDataURL(e)}else o(e);else{var u=URL.createObjectURL(e);location.href=u,setTimeout(function(){return URL.revokeObjectURL(u)},4e4)}}}function iE(e,t){return""+e+(e[e.length-1]==="/"||t[0]==="/"?"":"/")+t}function yn(){var e=function(t,r){return t.commands.dispatch(e,r||{})};return e.subscribe=function(t,r){return t.commands.subscribe(e,r)},e.id=dn.create22(),e}var zWe=function(){function e(){this.subs=new Map,this.disposing=!1}return e.prototype.subscribe=function(t,r){var n=this,i=this.subs.get(t.id);return i||(i=[],this.subs.set(t.id,i)),i.push(r),{unsubscribe:function(){var a=n.subs.get(t.id);if(a){var o=a.indexOf(r);if(!(o<0)){for(var s=o+1;s<a.length;s++)a[s-1]=a[s];a.pop()}}}}},e.prototype.dispatch=function(t,r){var n=this;return new Promise(function(i,a){if(n.disposing){a("disposed");return}var o=n.subs.get(t.id);if(!o){i();return}n.resolve({cmd:t,params:r,resolve:i,reject:a})})},e.prototype.dispose=function(){this.subs.clear()},e.prototype.resolve=function(t){return ce(this,void 0,void 0,function(){var r,n,i,a,o;return de(this,function(s){switch(s.label){case 0:if(r=this.subs.get(t.cmd.id),!r)return t.resolve(),[2];s.label=1;case 1:s.trys.push([1,6,,7]),n=0,i=r,s.label=2;case 2:return n<i.length?(a=i[n],[4,a(t.params)]):[3,5];case 3:s.sent(),s.label=4;case 4:return n++,[3,2];case 5:return t.resolve(),[3,7];case 6:return o=s.sent(),t.reject(o),[3,7];case 7:return[2]}})})},e}(),_t={State:{SetCurrentObject:yn(),ApplyAction:yn(),Update:yn(),RemoveObject:yn(),ToggleExpanded:yn(),ToggleVisibility:yn(),Snapshots:{Add:yn(),Replace:yn(),Move:yn(),Remove:yn(),Apply:yn(),Clear:yn(),Upload:yn(),Fetch:yn(),DownloadToFile:yn(),OpenFile:yn(),OpenUrl:yn()}},Interactivity:{Object:{Highlight:yn()},Structure:{Highlight:yn(),Select:yn()},ClearHighlights:yn()},Layout:{Update:yn()},Toast:{Show:yn(),Hide:yn()},Camera:{Reset:yn(),SetSnapshot:yn(),Focus:yn()},Canvas3D:{SetSettings:yn(),ResetSettings:yn()}};function VWe(e){kee(e),Oee(e),Lee(e),Nee(e),Fee(e),Bee(e),Uee(e),jee(e),zee(e),Vee(e)}function kee(e){e.state.events.object.created.subscribe(function(t){ge.isBehavior(t.obj)&&t.obj.data.register(t.ref)}),e.state.events.object.removed.subscribe(function(t){ge.isBehavior(t.obj)&&t.obj.data.unregister()}),e.state.events.object.updated.subscribe(function(t){t.action==="recreate"&&(t.oldObj&&ge.isBehavior(t.oldObj)&&t.oldObj.data.unregister(),t.obj&&ge.isBehavior(t.obj)&&t.obj.data.register(t.ref))})}function Oee(e){_t.State.SetCurrentObject.subscribe(e,function(t){var r=t.state,n=t.ref;return r.setCurrent(n)})}function Lee(e){_t.State.Update.subscribe(e,function(t){var r=t.state,n=t.tree,i=t.options;return e.runTask(r.updateTree(n,i))})}function Nee(e){_t.State.ApplyAction.subscribe(e,function(t){var r=t.state,n=t.action,i=t.ref;return e.runTask(r.applyAction(n.action,n.params,i))})}function Fee(e){function t(r,n){var i=r.build().delete(n);return e.runTask(r.updateTree(i))}_t.State.RemoveObject.subscribe(e,function(r){var n=r.state,i=r.ref,a=r.removeParentGhosts;if(a){var o=n.tree,s=o.transforms.get(i);if(s.parent===i)return t(n,i);for(;;){var u=o.children.get(s.parent);if(s.parent===s.ref||u.size>1)return t(n,s.ref);var l=o.transforms.get(s.parent);if(!l.state.isGhost)return t(n,s.ref);s=l}}else return t(n,i)})}function Bee(e){_t.State.ToggleExpanded.subscribe(e,function(t){var r=t.state,n=t.ref;return r.updateCellState(n,function(i){var a=i.isCollapsed;return{isCollapsed:!a}})})}function Uee(e){_t.State.ToggleVisibility.subscribe(e,function(t){var r=t.state,n=t.ref;return ev(r,n,!r.cells.get(n).state.isHidden)})}function ev(e,t,r){ii.doPreOrder(e.tree,e.transforms.get(t),{state:e,value:r},HWe)}function HWe(e,t,r){r.state.updateCellState(e.ref,{isHidden:r.value})}function jee(e){_t.Interactivity.Object.Highlight.subscribe(e,function(t){var r=t.state,n=t.ref;if(!(!e.canvas3d||e.isBusy)){e.managers.interactivity.lociHighlights.clearHighlights();for(var i=typeof n=="string"?[n]:n,a=0,o=i;a<o.length;a++){var s=o[a],u=r.cells.get(s);if(u){if(ge.Molecule.Structure.is(u.obj))e.managers.interactivity.lociHighlights.highlight({loci:$e.Loci(u.obj.data)},!1);else if(u&&ge.isRepresentation3D(u.obj)){var l=u.obj.data.repr;e.managers.interactivity.lociHighlights.highlight({loci:l.getLoci(),repr:l},!1)}else if(ge.Molecule.Structure.Selections.is(u.obj))for(var c=0,d=u.obj.data;c<d.length;c++){var f=d[c];e.managers.interactivity.lociHighlights.highlight({loci:f.loci},!1)}}}}})}function zee(e){_t.Interactivity.ClearHighlights.subscribe(e,function(){e.managers.interactivity.lociHighlights.clearHighlights()})}function Vee(e){var t=this;e.config.set(Wr.State.CurrentServer,e.config.get(Wr.State.DefaultServer)),_t.State.Snapshots.Clear.subscribe(e,function(){e.managers.snapshot.clear()}),_t.State.Snapshots.Remove.subscribe(e,function(r){var n=r.id;e.managers.snapshot.remove(n)}),_t.State.Snapshots.Add.subscribe(e,function(r){var n=r.name,i=r.description,a=r.params,o=R_.Entry(e.state.getSnapshot(a),{name:n,description:i});e.managers.snapshot.add(o)}),_t.State.Snapshots.Replace.subscribe(e,function(r){var n=r.id,i=r.params;e.managers.snapshot.replace(n,e.state.getSnapshot(i))}),_t.State.Snapshots.Move.subscribe(e,function(r){var n=r.id,i=r.dir;e.managers.snapshot.move(n,i)}),_t.State.Snapshots.Apply.subscribe(e,function(r){var n=r.id,i=e.managers.snapshot.setCurrent(n);if(i)return e.state.setSnapshot(i)}),_t.State.Snapshots.Upload.subscribe(e,function(r){var n=r.name,i=r.description,a=r.playOnLoad,o=r.serverUrl;return r.params,fetch(iE(o,"set?name="+encodeURIComponent(n||"")+"&description="+encodeURIComponent(i||"")),{method:"POST",mode:"cors",referrer:"no-referrer",headers:{"Content-Type":"application/json; charset=utf-8"},body:JSON.stringify(e.managers.snapshot.getStateSnapshot({name:n,description:i,playOnLoad:a}))})}),_t.State.Snapshots.Fetch.subscribe(e,function(r){var n=r.url;return ce(t,void 0,void 0,function(){var i;return de(this,function(a){switch(a.label){case 0:return[4,e.runTask(e.fetch({url:n,type:"json"}))];case 1:return i=a.sent(),[4,e.managers.snapshot.setStateSnapshot(i.data)];case 2:return a.sent(),[2]}})})}),_t.State.Snapshots.DownloadToFile.subscribe(e,function(r){var n=r.name,i=r.type,a=r.params;return ce(t,void 0,void 0,function(){var o,s;return de(this,function(u){switch(u.label){case 0:return o="mol-star_state_"+(n||UWe())+"."+(i==="json"?"molj":"molx"),[4,e.managers.snapshot.serialize({type:i,params:a})];case 1:return s=u.sent(),Ree(s,""+o),[2]}})})}),_t.State.Snapshots.OpenFile.subscribe(e,function(r){var n=r.file;return e.managers.snapshot.open(n)}),_t.State.Snapshots.OpenUrl.subscribe(e,function(r){var n=r.url,i=r.type;return ce(t,void 0,void 0,function(){var a;return de(this,function(o){switch(o.label){case 0:return[4,e.runTask(e.fetch({url:n,type:"binary"}))];case 1:return a=o.sent(),[2,e.managers.snapshot.open(new File([a],"state."+i))]}})})})}const GWe=Object.freeze(Object.defineProperty({__proto__:null,ApplyAction:Nee,ClearHighlights:zee,Highlight:jee,RemoveObject:Fee,SetCurrentObject:Oee,Snapshots:Vee,SyncBehaviors:kee,ToggleExpanded:Bee,ToggleVisibility:Uee,Update:Lee,registerDefault:VWe,setSubtreeVisibility:ev},Symbol.toStringTag,{value:"Module"}));function qWe(e){Hee(e),Gee(e),qee(e)}function Hee(e){var t=e.state.data.events;t.object.created.subscribe(function(r){var n;ge.isRepresentation3D(r.obj)&&(Z5(r.state.cells.get(r.ref),r.obj.data.repr),r.obj.data.repr.setState({syncManually:!0}),(n=e.canvas3d)===null||n===void 0||n.add(r.obj.data.repr))}),t.object.updated.subscribe(function(r){var n,i;r.oldObj&&ge.isRepresentation3D(r.oldObj)&&((n=e.canvas3d)===null||n===void 0||n.remove(r.oldObj.data.repr),r.oldObj.data.repr.destroy()),ge.isRepresentation3D(r.obj)&&(Z5(r.state.cells.get(r.ref),r.obj.data.repr),r.action==="recreate"&&r.obj.data.repr.setState({syncManually:!0}),(i=e.canvas3d)===null||i===void 0||i.add(r.obj.data.repr))}),t.object.removed.subscribe(function(r){var n;ge.isRepresentation3D(r.obj)&&((n=e.canvas3d)===null||n===void 0||n.remove(r.obj.data.repr),r.obj.data.repr.destroy())})}function Gee(e){var t=e.state.data.events;t.object.created.subscribe(function(r){var n;if(ge.Molecule.Structure.Representation3DState.is(r.obj)){var i=r.obj.data;i.repr.setState(i.state),(n=e.canvas3d)===null||n===void 0||n.update(i.repr)}}),t.object.updated.subscribe(function(r){var n;if(ge.Molecule.Structure.Representation3DState.is(r.obj)){var i=r.obj.data;i.repr.setState(i.state),(n=e.canvas3d)===null||n===void 0||n.update(i.repr)}}),t.object.removed.subscribe(function(r){var n;if(ge.Molecule.Structure.Representation3DState.is(r.obj)){var i=r.obj.data;i.repr.setState(i.initialState),(n=e.canvas3d)===null||n===void 0||n.update(i.repr)}})}function qee(e){e.state.data.events.cell.stateUpdated.subscribe(function(t){var r,n=t.state.cells.get(t.ref);ge.isRepresentation3D(n.obj)&&Z5(n,n.obj.data.repr)&&((r=e.canvas3d)===null||r===void 0||r.syncVisibility())})}function Z5(e,t){return t.state.visible===e.state.isHidden?(t.setState({visible:!e.state.isHidden}),!0):!1}const WWe=Object.freeze(Object.defineProperty({__proto__:null,SyncRepresentationToCanvas:Hee,SyncStructureRepresentation3DState:Gee,UpdateRepresentationVisibility:qee,registerDefault:qWe},Symbol.toStringTag,{value:"Module"}));function $We(e){Wee(e),Xee(e),$ee(e)}function Wee(e){_t.Camera.Reset.subscribe(e,function(t){e.managers.camera.reset(t==null?void 0:t.snapshot,t==null?void 0:t.durationMs)})}function $ee(e){_t.Camera.SetSnapshot.subscribe(e,function(t){var r=t.snapshot,n=t.durationMs;e.managers.camera.setSnapshot(r,n)})}function Xee(e){_t.Camera.Focus.subscribe(e,function(t){var r=t.center,n=t.radius,i=t.durationMs;e.managers.camera.focusSphere({center:r,radius:n},{durationMs:i}),e.events.canvas3d.settingsUpdated.next()})}const XWe=Object.freeze(Object.defineProperty({__proto__:null,Focus:Xee,Reset:Wee,SetSnapshot:$ee,registerDefault:$We},Symbol.toStringTag,{value:"Module"}));function op(e){if(typeof e=="object"){if("buttons"in e)return e.buttons;if("which"in e){var t=e.which;if(t===2)return 4;if(t===3)return 2;if(t>0)return 1<<t-1}}return 0}function Mm(e){if(typeof e=="object"&&"button"in e){var t=e.button;if(t===1)return 4;if(t===2)return 2;if(t>=0)return 1<<t}return 0}function dx(e){return{alt:"altKey"in e?e.altKey:!1,shift:"shiftKey"in e?e.shiftKey:!1,control:"ctrlKey"in e?e.ctrlKey:!1,meta:"metaKey"in e?e.metaKey:!1}}var az={noScroll:!0,noMiddleClickScroll:!0,noContextMenu:!0,noPinchZoom:!0,noTextSelect:!0,mask:function(e,t){return!0},pixelScale:1},Cu;(function(e){e.None=n();function t(i,a){return i.shift===a.shift&&i.alt===a.alt&&i.control===a.control&&i.meta===a.meta}e.areEqual=t;function r(i){if(!i)return 0;var a=0;return i.shift&&a++,i.alt&&a++,i.control&&a++,i.meta&&a++,a}e.size=r;function n(i){return i===void 0&&(i={}),{shift:!!i.shift,alt:!!i.alt,control:!!i.control,meta:!!i.meta}}e.create=n})(Cu||(Cu={}));var tv;(function(e){e.has=da.has,e.create=da.create})(tv||(tv={}));function oz(){return{drag:new Qn,interactionEnd:new Qn,click:new Qn,move:new Qn,wheel:new Qn,pinch:new Qn,resize:new Qn,leave:new Qn,enter:new Qn,modifiers:new Qn,key:new Qn}}var YWe=["Backspace","Delete"],J5;(function(e){function t(n){n===void 0&&(n={});var i=E(E({},az),n),a=i.noScroll,o=i.noContextMenu;return E(E({noScroll:a,noContextMenu:o,width:0,height:0,pixelRatio:1},oz()),{dispose:ef})}e.create=t;function r(n,i){i===void 0&&(i={});var a=E(E({},az),i),o=a.noScroll,s=a.noMiddleClickScroll,u=a.noContextMenu,l=a.noPinchZoom,c=a.noTextSelect,d=a.mask,f=a.pixelScale,h=n.clientWidth*C(),v=n.clientHeight*C(),p=0,m=He(),g=He(),y=He(),b=He(),S=He(),x={shift:!1,alt:!1,control:!1,meta:!1};function C(){return window.devicePixelRatio*f}function w(){return E({},x)}var A=0,M=!1,D=tv.create(0),k=0,R=!1,L=oz(),H=L.drag,B=L.interactionEnd,j=L.wheel,Q=L.pinch,G=L.click,W=L.move,q=L.leave,ee=L.enter,he=L.resize,$=L.modifiers,X=L.key;return U(),E(E({get noScroll(){return o},set noScroll(Re){o=Re},get noContextMenu(){return u},set noContextMenu(Re){u=Re},get width(){return h},get height(){return v},get pixelRatio(){return C()}},L),{dispose:z});function U(){n.addEventListener("contextmenu",J,!1),n.addEventListener("wheel",Xe,!1),n.addEventListener("mousedown",O,!1),window.addEventListener("mousemove",V,!1),window.addEventListener("mouseup",pe,!1),n.addEventListener("mouseenter",ct,!1),n.addEventListener("mouseleave",Ne,!1),n.addEventListener("touchstart",Se,!1),n.addEventListener("touchmove",oe,!1),n.addEventListener("touchend",ie,!1),window.addEventListener("blur",Z),window.addEventListener("keyup",le,!1),window.addEventListener("keydown",te,!1),window.addEventListener("keypress",ye,!1),window.addEventListener("resize",Qe,!1)}function z(){M||(M=!0,n.removeEventListener("contextmenu",J,!1),n.removeEventListener("wheel",Xe,!1),n.removeEventListener("mousedown",O,!1),window.removeEventListener("mousemove",V,!1),window.removeEventListener("mouseup",pe,!1),n.removeEventListener("mouseenter",ct,!1),n.removeEventListener("mouseleave",Ne,!1),n.removeEventListener("touchstart",Se,!1),n.removeEventListener("touchmove",oe,!1),n.removeEventListener("touchend",ie,!1),window.removeEventListener("blur",Z),window.removeEventListener("keyup",le,!1),window.removeEventListener("keydown",te,!1),window.removeEventListener("keypress",ye,!1),window.removeEventListener("resize",Qe,!1))}function J(Re){d(Re.clientX,Re.clientY)&&u&&Re.preventDefault()}function Y(Re){x.alt=Re.altKey,x.shift=Re.shiftKey,x.control=Re.ctrlKey,x.meta=Re.metaKey}function Z(){(D||x.shift||x.alt||x.meta||x.control)&&(D=0,x.shift=x.alt=x.control=x.meta=!1)}function te(Re){var Ie=!1;!x.alt&&Re.altKey&&(Ie=!0,x.alt=!0),!x.shift&&Re.shiftKey&&(Ie=!0,x.shift=!0),!x.control&&Re.ctrlKey&&(Ie=!0,x.control=!0),!x.meta&&Re.metaKey&&(Ie=!0,x.meta=!0),Ie&&R&&$.next(w())}function le(Re){var Ie=!1;x.alt&&!Re.altKey&&(Ie=!0,x.alt=!1),x.shift&&!Re.shiftKey&&(Ie=!0,x.shift=!1),x.control&&!Re.ctrlKey&&(Ie=!0,x.control=!1),x.meta&&!Re.metaKey&&(Ie=!0,x.meta=!1),Ie&&R&&$.next(w()),YWe.includes(Re.key)&&ye(Re)}function ye(Re){X.next({key:Re.key,modifiers:w()})}function be(Re){var Ie=Re.touches[0],Ye=Re.touches[1];return{clientX:(Ie.clientX+Ye.clientX)/2,clientY:(Ie.clientY+Ye.clientY)/2,pageX:(Ie.pageX+Ye.pageX)/2,pageY:(Ie.pageY+Ye.pageY)/2}}function Ee(Re){var Ie=Re.touches[0].pageX-Re.touches[1].pageX,Ye=Re.touches[0].pageY-Re.touches[1].pageY;return Math.sqrt(Ie*Ie+Ye*Ye)}function Se(Re){if(Re.touches.length===1)D=k=1,Pe(Re.touches[0]);else if(Re.touches.length===2){D=0,k=2,Pe(be(Re));var Ie=Ee(Re);p=Ie,Q.next({distance:Ie,fraction:1,delta:0,isStart:!0,buttons:D,button:k,modifiers:w()})}else Re.touches.length===3&&(D=k=8,Pe(be(Re)))}function ie(Re){_e()}function oe(Re){if(k=0,l&&(Re.preventDefault(),Re.stopPropagation(),Re.originalEvent&&(Re.originalEvent.preventDefault(),Re.originalEvent.stopPropagation())),Re.touches.length===1)D=1,ze(Re.touches[0]);else if(Re.touches.length===2){var Ie=Ee(Re),Ye=p-Ie;Math.abs(Ye)<4?(D=2,ze(be(Re))):(D=4,Y(Re),Q.next({delta:Ye,fraction:p/Ie,distance:Ie,isStart:!1,buttons:D,button:k,modifiers:w()})),p=Ie}else Re.touches.length===3&&(D=8,ze(be(Re)))}function O(Re){Y(Re),D=op(Re),k=Mm(Re),s&&D===4&&Re.preventDefault,Pe(Re)}function V(Re){Y(Re),D=op(Re),k=0,ze(Re)}function pe(Re){Y(Re),D=op(Re),k=Mm(Re),je(Re),_e()}function _e(){B.next()}function Pe(Re){d(Re.clientX,Re.clientY)&&(dt(g,Re),He.copy(m,g),it(g)&&(A=1))}function je(Re){if(A=0,!!d(Re.clientX,Re.clientY)&&(dt(y,Re),He.distance(y,m)<4)){var Ie=Re.pageX,Ye=Re.pageY,tt=y[0],xt=y[1];G.next({x:tt,y:xt,pageX:Ie,pageY:Ye,buttons:D,button:k,modifiers:w()})}}function ze(Re){var Ie;dt(y,Re);var Ye=Re.pageX,tt=Re.pageY,xt=y[0],pt=y[1],ut=it(y);if(W.next({x:xt,y:pt,pageX:Ye,pageY:tt,buttons:D,button:k,modifiers:w(),inside:ut}),A!==0&&(c&&((Ie=Re.preventDefault)===null||Ie===void 0||Ie.call(Re)),He.div(b,He.sub(b,y,g),ot(S)),!(He.magnitude(b)<vn))){var fe=A===1;if(!(fe&&!d(Re.clientX,Re.clientY))){var me=b[0],we=b[1];H.next({x:xt,y:pt,dx:me,dy:we,pageX:Ye,pageY:tt,buttons:D,button:k,modifiers:w(),isStart:fe}),He.copy(g,y),A=2}}}function Xe(Re){if(d(Re.clientX,Re.clientY)){dt(y,Re);var Ie=Re.pageX,Ye=Re.pageY,tt=y[0],xt=y[1];o&&Re.preventDefault();var pt=1;switch(Re.deltaMode){case 0:pt=1;break;case 1:pt=40;break;case 2:pt=800;break}var ut=(Re.deltaX||0)*pt,fe=(Re.deltaY||0)*pt,me=(Re.deltaZ||0)*pt;D=k=4,(ut||fe||me)&&j.next({x:tt,y:xt,pageX:Ie,pageY:Ye,dx:ut,dy:fe,dz:me,buttons:D,button:k,modifiers:w()})}}function ct(Re){R=!0,ee.next()}function Ne(Re){R=!1,q.next()}function Qe(Re){he.next()}function it(Re){if(n instanceof Window||n instanceof Document||n===document.body)return!0;var Ie=n.getBoundingClientRect();return Re[0]>=0&&Re[1]>=0&&Re[0]<Ie.width&&Re[1]<Ie.height}function ot(Re){return Re[0]=n.clientWidth,Re[1]=n.clientHeight,Re}function dt(Re,Ie){h=n.clientWidth*C(),v=n.clientHeight*C();var Ye=Ie.clientX||0,tt=Ie.clientY||0,xt=n.getBoundingClientRect();return Re[0]=Ye-xt.left,Re[1]=tt-xt.top,Re}}e.fromElement=r})(J5||(J5={}));function zi(){return zi.zero()}(function(e){function t(){return{x:0,y:0,width:0,height:0}}e.zero=t;function r(u,l,c,d){return{x:u,y:l,width:c,height:d}}e.create=r;function n(u){return E({},u)}e.clone=n;function i(u,l){return Object.assign(u,l)}e.copy=i;function a(u,l,c,d,f){return u.x=l,u.y=c,u.width=d,u.height=f,u}e.set=a;function o(u,l){return u[0]=l.x,u[1]=l.y,u[2]=l.width,u[3]=l.height,u}e.toVec4=o;function s(u,l){return u.x===l.x&&u.y===l.y&&u.width===l.width&&u.height===l.height}e.equals=s})(zi||(zi={}));var sz=0,uz=1,$u=_r();function KWe(e,t,r,n){var i=r.x,a=r.y,o=r.width,s=r.height;_r.set($u,t[0],t[1],t[2],1),_r.transformMat4($u,$u,n);var u=$u[3];return u!==0&&($u[0]/=u,$u[1]/=u,$u[2]/=u),e[0]=i+o/2*$u[0]+(0+o/2),e[1]=a+s/2*$u[1]+(0+s/2),e[2]=(uz-sz)/2*$u[2]+(uz+sz)/2,e[3]=u===0?0:1/u,e}function bS(e,t,r,n){var i=r.x,a=r.y,o=r.width,s=r.height,u=t[0]-i,l=s-t[1]-1-a,c=t[2];return e[0]=2*u/o-1,e[1]=2*l/s-1,e[2]=2*c-1,_.transformMat4(e,e,n)}var eD={backgroundColor:I.Color(at(0),{description:"Background color of the 3D canvas"}),pickingAlphaThreshold:I.Numeric(.5,{min:0,max:1,step:.01},{description:"The minimum opacity value needed for an object to be pickable."}),interiorDarkening:I.Numeric(.5,{min:0,max:1,step:.01}),interiorColorFlag:I.Boolean(!0,{label:"Use Interior Color"}),interiorColor:I.Color(at.fromNormalizedRgb(.3,.3,.3)),highlightColor:I.Color(at.fromNormalizedRgb(1,.4,.6)),selectColor:I.Color(at.fromNormalizedRgb(.2,1,.1)),xrayEdgeFalloff:I.Numeric(1,{min:0,max:3,step:.1}),style:I.MappedStatic("matte",{custom:I.Group({lightIntensity:I.Numeric(.6,{min:0,max:1,step:.01}),ambientIntensity:I.Numeric(.4,{min:0,max:1,step:.01}),metalness:I.Numeric(0,{min:0,max:1,step:.01}),roughness:I.Numeric(1,{min:0,max:1,step:.01}),reflectivity:I.Numeric(.5,{min:0,max:1,step:.01})},{isExpanded:!0}),flat:I.Group({}),matte:I.Group({}),glossy:I.Group({}),metallic:I.Group({}),plastic:I.Group({})},{label:"Lighting",description:"Style in which the 3D scene is rendered/lighted"}),clip:I.Group({variant:I.Select("instance",I.arrayToOptions(["instance","pixel"])),objects:I.ObjectList({type:I.Select("plane",I.objectToOptions(rn.Type,function(e){return zo(e)})),invert:I.Boolean(!1),position:I.Vec3(_()),rotation:I.Group({axis:I.Vec3(_.create(1,0,0)),angle:I.Numeric(0,{min:-180,max:180,step:1},{description:"Angle in Degrees"})},{isExpanded:!0}),scale:I.Vec3(_.create(1,1,1))},function(e){return zo(e.type)})})};function lz(e){switch(e.name){case"custom":return e.params;case"flat":return{lightIntensity:0,ambientIntensity:1,metalness:0,roughness:.4,reflectivity:.5};case"matte":return{lightIntensity:.7,ambientIntensity:.3,metalness:0,roughness:1,reflectivity:.5};case"glossy":return{lightIntensity:.7,ambientIntensity:.3,metalness:0,roughness:.4,reflectivity:.5};case"metallic":return{lightIntensity:.7,ambientIntensity:.7,metalness:.6,roughness:.6,reflectivity:.5};case"plastic":return{lightIntensity:.7,ambientIntensity:.3,metalness:0,roughness:.2,reflectivity:.5}}}var QWe=jn();function cz(e,t){for(var r=(t==null?void 0:t.objects)||{type:new Array(5).fill(1),invert:new Array(5).fill(!1),position:new Array(15).fill(0),rotation:new Array(20).fill(0),scale:new Array(15).fill(1)},n=r.type,i=r.invert,a=r.position,o=r.rotation,s=r.scale,u=0,l=e.objects.length;u<l;++u){var c=e.objects[u];n[u]=rn.Type[c.type],i[u]=c.invert,_.toArray(c.position,a,u*3),jn.toArray(jn.setAxisAngle(QWe,c.rotation.axis,$r(c.rotation.angle)),o,u*4),_.toArray(c.scale,s,u*3)}return{variant:e.variant,objects:{count:e.objects.length,type:n,invert:i,position:a,rotation:o,scale:s}}}var tD;(function(e){function t(r,n){n===void 0&&(n={});var i=r.gl,a=r.state,o=r.stats,s=r.extensions.fragDepth,u=I.merge(eD,I.getDefaultValues(eD),n),l=lz(u.style),c=cz(u.clip),d=zi(),f=He.create(i.drawingBufferWidth,i.drawingBufferHeight),h=at.toVec3Normalized(_(),u.backgroundColor),v=!1,p=F3(i),m=[["tDepth",p]],g=ue(),y=ue(),b=ue(),S=ue(),x=ue(),C=ue(),w=ue(),A=_(),M=He(),D={uModel:N.create(ue.identity()),uView:N.create(g),uInvView:N.create(y),uModelView:N.create(b),uInvModelView:N.create(S),uInvProjection:N.create(x),uProjection:N.create(ue()),uModelViewProjection:N.create(C),uInvModelViewProjection:N.create(w),uIsOrtho:N.create(1),uViewOffset:N.create(M),uPixelRatio:N.create(r.pixelRatio),uViewportHeight:N.create(d.height),uViewport:N.create(zi.toVec4(_r(),d)),uDrawingBufferSize:N.create(f),uCameraPosition:N.create(_()),uCameraDir:N.create(A),uNear:N.create(1),uFar:N.create(1e4),uFogNear:N.create(1),uFogFar:N.create(1e4),uFogColor:N.create(h),uRenderWboit:N.create(!1),uTransparentBackground:N.create(!1),uClipObjectType:N.create(c.objects.type),uClipObjectInvert:N.create(c.objects.invert),uClipObjectPosition:N.create(c.objects.position),uClipObjectRotation:N.create(c.objects.rotation),uClipObjectScale:N.create(c.objects.scale),uLightIntensity:N.create(l.lightIntensity),uAmbientIntensity:N.create(l.ambientIntensity),uMetalness:N.create(l.metalness),uRoughness:N.create(l.roughness),uReflectivity:N.create(l.reflectivity),uPickingAlphaThreshold:N.create(u.pickingAlphaThreshold),uInteriorDarkening:N.create(u.interiorDarkening),uInteriorColorFlag:N.create(u.interiorColorFlag),uInteriorColor:N.create(at.toVec3Normalized(_(),u.interiorColor)),uHighlightColor:N.create(at.toVec3Normalized(_(),u.highlightColor)),uSelectColor:N.create(at.toVec3Normalized(_(),u.selectColor)),uXrayEdgeFalloff:N.create(u.xrayEdgeFalloff)},k=Object.entries(D),R=!0,L=function(U,z){if(!(U.state.disposed||!U.state.visible||!U.state.pickable&&z[0]==="p")){var J=!1;U.state.noClip?U.values.dClipObjectCount.ref.value!==0&&(N.update(U.values.dClipObjectCount,0),J=!0):(U.values.dClipObjectCount.ref.value!==c.objects.count&&(N.update(U.values.dClipObjectCount,c.objects.count),J=!0),U.values.dClipVariant.ref.value!==c.variant&&(N.update(U.values.dClipVariant,c.variant),J=!0)),J&&U.update();var Y=U.getProgram(z);a.currentProgramId!==Y.id&&(R=!0,Y.use()),R&&(Y.setUniforms(k),R=!1),U.values.dRenderMode?(a.disable(i.CULL_FACE),a.frontFace(i.CCW),z==="colorBlended"&&(U.values.dRenderMode.ref.value==="volume"||!s?(a.disable(i.DEPTH_TEST),a.depthMask(!1)):(a.enable(i.DEPTH_TEST),a.depthMask(U.values.uAlpha.ref.value===1)))):(U.values.dDoubleSided?U.values.dDoubleSided.ref.value||U.values.hasReflection.ref.value?a.disable(i.CULL_FACE):a.enable(i.CULL_FACE):a.disable(i.CULL_FACE),U.values.dFlipSided&&U.values.dFlipSided.ref.value?(a.frontFace(i.CW),a.cullFace(i.FRONT)):(a.frontFace(i.CCW),a.cullFace(i.BACK))),U.render(z,m)}},H=function(U){N.update(D.uView,U.view),N.update(D.uInvView,ue.invert(y,U.view)),N.update(D.uProjection,U.projection),N.update(D.uInvProjection,ue.invert(x,U.projection)),N.updateIfChanged(D.uIsOrtho,U.state.mode==="orthographic"?1:0),N.update(D.uViewOffset,U.viewOffset.enabled?He.set(M,U.viewOffset.offsetX*16,U.viewOffset.offsetY*16):He.set(M,0,0)),N.update(D.uCameraPosition,U.state.position),N.update(D.uCameraDir,_.normalize(A,_.sub(A,U.state.target,U.state.position))),N.updateIfChanged(D.uFar,U.far),N.updateIfChanged(D.uNear,U.near),N.updateIfChanged(D.uFogFar,U.fogFar),N.updateIfChanged(D.uFogNear,U.fogNear),N.updateIfChanged(D.uTransparentBackground,v)},B=function(U,z,J,Y){rPe(m,"tDepth",J||p),N.update(D.uModel,U.view),N.update(D.uModelView,ue.mul(b,U.view,z.view)),N.update(D.uInvModelView,ue.invert(S,b)),N.update(D.uModelViewProjection,ue.mul(C,b,z.projection)),N.update(D.uInvModelViewProjection,ue.invert(w,C)),N.updateIfChanged(D.uRenderWboit,Y),a.enable(i.SCISSOR_TEST),a.colorMask(!0,!0,!0,!0);var Z=d.x,te=d.y,le=d.width,ye=d.height;i.viewport(Z,te,le,ye),i.scissor(Z,te,le,ye),R=!0,a.currentRenderItemId=-1},j=function(U,z,J,Y){a.disable(i.BLEND),a.enable(i.DEPTH_TEST),a.depthMask(!0),B(U,z,Y,!1);for(var Z=U.renderables,te=0,le=Z.length;te<le;++te)Z[te].state.colorOnly||L(Z[te],J)},Q=function(U,z,J){a.disable(i.BLEND),a.enable(i.DEPTH_TEST),a.depthMask(!0),B(U,z,J,!1);for(var Y=U.renderables,Z=0,te=Y.length;Z<te;++Z)L(Y[Z],"depth")},G=function(U,z,J){W(U,z,J),q(U,z,J)},W=function(U,z,J){a.disable(i.BLEND),a.enable(i.DEPTH_TEST),a.depthMask(!0),B(U,z,J,!1);for(var Y=U.renderables,Z=0,te=Y.length;Z<te;++Z){var le=Y[Z];le.state.opaque&&L(le,"colorBlended")}},q=function(U,z,J){a.enable(i.DEPTH_TEST),B(U,z,J,!1);var Y=U.renderables;v?a.blendFunc(i.ONE,i.ONE_MINUS_SRC_ALPHA):a.blendFuncSeparate(i.SRC_ALPHA,i.ONE_MINUS_SRC_ALPHA,i.ONE,i.ONE_MINUS_SRC_ALPHA),a.enable(i.BLEND),a.depthMask(!0);for(var Z=0,te=Y.length;Z<te;++Z){var le=Y[Z];!le.state.opaque&&le.state.writeDepth&&L(le,"colorBlended")}a.depthMask(!1);for(var Z=0,te=Y.length;Z<te;++Z){var le=Y[Z];!le.state.opaque&&!le.state.writeDepth&&L(le,"colorBlended")}},ee=function(U,z,J){var Y;a.blendFunc(i.ONE,i.ONE_MINUS_SRC_ALPHA),a.enable(i.BLEND),B(U,z,J,!1);for(var Z=U.renderables,te=0,le=Z.length;te<le;++te){var ye=Z[te],be=Ia(ye.values.alpha.ref.value*ye.state.alphaFactor,0,1);be===1&&ye.values.transparencyAverage.ref.value!==1&&!(!((Y=ye.values.dXrayShaded)===null||Y===void 0)&&Y.ref.value)&&L(ye,"colorBlended")}},he=function(U,z,J){var Y;a.blendFunc(i.ONE,i.ONE_MINUS_SRC_ALPHA),a.enable(i.BLEND),B(U,z,J,!1);for(var Z=U.renderables,te=0,le=Z.length;te<le;++te){var ye=Z[te],be=Ia(ye.values.alpha.ref.value*ye.state.alphaFactor,0,1);(be<1||ye.values.transparencyAverage.ref.value>0||!((Y=ye.values.dXrayShaded)===null||Y===void 0)&&Y.ref.value)&&L(ye,"colorBlended")}},$=function(U,z,J){var Y,Z,te;a.disable(i.BLEND),a.enable(i.DEPTH_TEST),a.depthMask(!0),B(U,z,J,!1);for(var le=U.renderables,ye=0,be=le.length;ye<be;++ye){var Ee=le[ye],Se=Ia(Ee.values.alpha.ref.value*Ee.state.alphaFactor,0,1);Se===1&&Ee.values.transparencyAverage.ref.value!==1&&((Y=Ee.values.dRenderMode)===null||Y===void 0?void 0:Y.ref.value)!=="volume"&&!(!((Z=Ee.values.dPointFilledCircle)===null||Z===void 0)&&Z.ref.value)&&!(!((te=Ee.values.dXrayShaded)===null||te===void 0)&&te.ref.value)&&L(Ee,"colorWboit")}},X=function(U,z,J){var Y,Z,te;B(U,z,J,!0);for(var le=U.renderables,ye=0,be=le.length;ye<be;++ye){var Ee=le[ye],Se=Ia(Ee.values.alpha.ref.value*Ee.state.alphaFactor,0,1);(Se<1||Ee.values.transparencyAverage.ref.value>0||((Y=Ee.values.dRenderMode)===null||Y===void 0?void 0:Y.ref.value)==="volume"||!((Z=Ee.values.dPointFilledCircle)===null||Z===void 0)&&Z.ref.value||Ee.values.uBackgroundColor||!((te=Ee.values.dXrayShaded)===null||te===void 0)&&te.ref.value)&&L(Ee,"colorWboit")}};return{clear:function(U){a.enable(i.SCISSOR_TEST),a.enable(i.DEPTH_TEST),a.colorMask(!0,!0,!0,!0),a.depthMask(!0),v?a.clearColor(0,0,0,0):U?a.clearColor(h[0],h[1],h[2],1):a.clearColor(1,1,1,1),i.clear(i.COLOR_BUFFER_BIT|i.DEPTH_BUFFER_BIT)},clearDepth:function(){a.enable(i.SCISSOR_TEST),a.enable(i.DEPTH_TEST),a.depthMask(!0),i.clear(i.DEPTH_BUFFER_BIT)},update:H,renderPick:j,renderDepth:Q,renderBlended:G,renderBlendedOpaque:W,renderBlendedTransparent:q,renderBlendedVolumeOpaque:ee,renderBlendedVolumeTransparent:he,renderWboitOpaque:$,renderWboitTransparent:X,setProps:function(U){U.backgroundColor!==void 0&&U.backgroundColor!==u.backgroundColor&&(u.backgroundColor=U.backgroundColor,at.toVec3Normalized(h,u.backgroundColor),N.update(D.uFogColor,_.copy(D.uFogColor.ref.value,h))),U.pickingAlphaThreshold!==void 0&&U.pickingAlphaThreshold!==u.pickingAlphaThreshold&&(u.pickingAlphaThreshold=U.pickingAlphaThreshold,N.update(D.uPickingAlphaThreshold,u.pickingAlphaThreshold)),U.interiorDarkening!==void 0&&U.interiorDarkening!==u.interiorDarkening&&(u.interiorDarkening=U.interiorDarkening,N.update(D.uInteriorDarkening,u.interiorDarkening)),U.interiorColorFlag!==void 0&&U.interiorColorFlag!==u.interiorColorFlag&&(u.interiorColorFlag=U.interiorColorFlag,N.update(D.uInteriorColorFlag,u.interiorColorFlag)),U.interiorColor!==void 0&&U.interiorColor!==u.interiorColor&&(u.interiorColor=U.interiorColor,N.update(D.uInteriorColor,at.toVec3Normalized(D.uInteriorColor.ref.value,u.interiorColor))),U.highlightColor!==void 0&&U.highlightColor!==u.highlightColor&&(u.highlightColor=U.highlightColor,N.update(D.uHighlightColor,at.toVec3Normalized(D.uHighlightColor.ref.value,u.highlightColor))),U.selectColor!==void 0&&U.selectColor!==u.selectColor&&(u.selectColor=U.selectColor,N.update(D.uSelectColor,at.toVec3Normalized(D.uSelectColor.ref.value,u.selectColor))),U.xrayEdgeFalloff!==void 0&&U.xrayEdgeFalloff!==u.xrayEdgeFalloff&&(u.xrayEdgeFalloff=U.xrayEdgeFalloff,N.update(D.uXrayEdgeFalloff,u.xrayEdgeFalloff)),U.style!==void 0&&(u.style=U.style,Object.assign(l,lz(U.style)),N.updateIfChanged(D.uLightIntensity,l.lightIntensity),N.updateIfChanged(D.uAmbientIntensity,l.ambientIntensity),N.updateIfChanged(D.uMetalness,l.metalness),N.updateIfChanged(D.uRoughness,l.roughness),N.updateIfChanged(D.uReflectivity,l.reflectivity)),U.clip!==void 0&&!Mc(U.clip,u.clip)&&(u.clip=U.clip,Object.assign(c,cz(U.clip,c)),N.update(D.uClipObjectPosition,c.objects.position),N.update(D.uClipObjectRotation,c.objects.rotation),N.update(D.uClipObjectScale,c.objects.scale),N.update(D.uClipObjectType,c.objects.type))},setViewport:function(U,z,J,Y){i.viewport(U,z,J,Y),i.scissor(U,z,J,Y),(U!==d.x||z!==d.y||J!==d.width||Y!==d.height)&&(zi.set(d,U,z,J,Y),N.update(D.uViewportHeight,Y),N.update(D.uViewport,_r.set(D.uViewport.ref.value,U,z,J,Y)))},setTransparentBackground:function(U){v=U},setDrawingBufferSize:function(U,z){(U!==f[0]||z!==f[1])&&N.update(D.uDrawingBufferSize,He.set(f,U,z))},props:u,get stats(){return{programCount:r.stats.resourceCounts.program,shaderCount:r.stats.resourceCounts.shader,attributeCount:r.stats.resourceCounts.attribute,elementsCount:r.stats.resourceCounts.elements,framebufferCount:r.stats.resourceCounts.framebuffer,renderbufferCount:r.stats.resourceCounts.renderbuffer,textureCount:r.stats.resourceCounts.texture,vertexArrayCount:r.stats.resourceCounts.vertexArray,drawCount:o.drawCount,instanceCount:o.instanceCount,instancedDrawCount:o.instancedDrawCount}},dispose:function(){}}}e.create=t})(tD||(tD={}));function fr(e,t,r){return t===void 0&&(t=""),r===void 0&&(r=""),fr.create(e,t,r)}(function(e){function t(s,u,l){return u===void 0&&(u=""),l===void 0&&(l=""),{triggers:s,action:u,description:l}}e.create=t,e.Empty={triggers:[],action:"",description:""};function r(s){return s.triggers.length===0||s.triggers.every(function(u){return u.buttons===void 0&&u.modifiers===void 0})}e.isEmpty=r;function n(s,u,l){return s.triggers.some(function(c){return o.match(c,u,l)})}e.match=n;function i(s){return s.triggers.map(o.format).join(" or ")}e.formatTriggers=i;function a(s,u){u===void 0&&(u="");var l=s.description||zo(u);return w_e(l,{triggers:"<i>"+i(s)+"</i>"})}e.format=a;function o(s,u){return o.create(s,u)}e.Trigger=o,function(s){function u(d,f){return{buttons:d,modifiers:f}}s.create=u,s.Empty={};function l(d,f,h){var v=d.buttons,p=d.modifiers;return v!==void 0&&(v===f||tv.has(v,f))&&(!p||Cu.areEqual(p,h))}s.match=l;function c(d){var f=[],h=ZWe(d.buttons);h&&f.push(h);var v=JWe(d.modifiers);return v&&f.push(v),f.join(" + ")}s.format=c}(o=e.Trigger||(e.Trigger={}))})(fr||(fr={}));var fx=tv;function ZWe(e){var t=[];return e===void 0?t.push("any mouse button"):e===0?t.push("mouse hover"):(fx.has(e,1)&&t.push("left mouse button"),fx.has(e,2)&&t.push("right mouse button"),fx.has(e,4)&&t.push("wheel/middle mouse button"),fx.has(e,8)&&t.push("three fingers")),t.join(" + ")}function JWe(e,t){var r=[];return e?(e.alt&&r.push("alt key"),e.control&&r.push("control key"),e.meta&&r.push("meta/command key"),e.shift&&r.push("shift key"),t&&r.length===0&&r.push("no key")):t&&r.push("any key"),r.join(" + ")}var Md=Cu,Dd=fr.Trigger,e$e={dragRotate:fr([Dd(1,Md.create())],"Rotate","Drag using ${triggers}"),dragRotateZ:fr([Dd(1,Md.create({shift:!0}))],"Rotate around z-axis","Drag using ${triggers}"),dragPan:fr([Dd(2,Md.create()),Dd(1,Md.create({control:!0}))],"Pan","Drag using ${triggers}"),dragZoom:fr.Empty,dragFocus:fr([Dd(8,Md.create())],"Focus","Drag using ${triggers}"),dragFocusZoom:fr([Dd(4,Md.create())],"Focus and zoom","Drag using ${triggers}"),scrollZoom:fr([Dd(4,Md.create())],"Zoom","Scroll using ${triggers}"),scrollFocus:fr([Dd(4,Md.create({shift:!0}))],"Clip","Scroll using ${triggers}"),scrollFocusZoom:fr.Empty},Yee={noScroll:I.Boolean(!0,{isHidden:!0}),rotateSpeed:I.Numeric(5,{min:1,max:10,step:1}),zoomSpeed:I.Numeric(7,{min:1,max:15,step:1}),panSpeed:I.Numeric(1,{min:.1,max:5,step:.1}),spin:I.Boolean(!1,{description:"Spin the 3D scene around the x-axis in view space"}),spinSpeed:I.Numeric(1,{min:-20,max:20,step:1}),staticMoving:I.Boolean(!0,{isHidden:!0}),dynamicDampingFactor:I.Numeric(.2,{},{isHidden:!0}),minDistance:I.Numeric(.01,{},{isHidden:!0}),maxDistance:I.Numeric(1e150,{},{isHidden:!0}),bindings:I.Value(e$e,{isHidden:!0}),autoAdjustMinMaxDistance:I.MappedStatic("on",{off:I.EmptyGroup(),on:I.Group({minDistanceFactor:I.Numeric(0),minDistancePadding:I.Numeric(5),maxDistanceFactor:I.Numeric(10),maxDistanceMin:I.Numeric(20)})},{isHidden:!0})},rD;(function(e){function t(r,n,i){i===void 0&&(i={});var a=E(E({},I.getDefaultValues(Yee)),i),o=zi.clone(n.viewport),s=!1,u=r.drag.subscribe(V),l=r.interactionEnd.subscribe(pe),c=r.wheel.subscribe(_e),d=r.pinch.subscribe(Pe),f=!1,h=_(),v=_(),p=He(),m=He(),g=_(),y=0,b=He(),S=He(),x=0,C=He(),w=He(),A=He(),M=He(),D=He(),k=He(),R=_.clone(n.target),L=_.clone(n.position),H=_.clone(n.up),B=He();function j(Ne,Qe){return He.set(B,(Ne-o.x)/o.width,(Qe-o.y)/o.height)}var Q=He();function G(Ne,Qe){return He.set(Q,(Ne-o.width*.5-o.x)/(o.width*.5),(o.height+2*(o.y-Qe))/o.width)}var W=_(),q=jn(),ee=_(),he=_(),$=_(),X=_();function U(){var Ne=m[0]-p[0],Qe=m[1]-p[1];_.set(X,Ne,Qe,0);var it=r.width/r.height,ot=_.magnitude(X)*a.rotateSpeed*r.pixelRatio*it;ot?(_.sub(v,n.position,n.target),_.normalize(ee,v),_.normalize(he,n.up),_.normalize($,_.cross($,he,ee)),_.setMagnitude(he,he,Qe),_.setMagnitude($,$,Ne),_.add(X,he,$),_.normalize(W,_.cross(W,X,v)),jn.setAxisAngle(q,W,ot),_.transformQuat(v,v,q),_.transformQuat(n.up,n.up,q),_.copy(g,W),y=ot):!a.staticMoving&&y&&(y*=Math.sqrt(1-a.dynamicDampingFactor),_.sub(v,n.position,n.target),jn.setAxisAngle(q,g,y),_.transformQuat(v,v,q),_.transformQuat(n.up,n.up,q)),He.copy(p,m)}var z=jn();function J(){var Ne=S[0]-b[0],Qe=S[1]-b[1],it=a.rotateSpeed*(-Ne+Qe)*-.05;it?(_.sub(v,n.position,n.target),jn.setAxisAngle(z,v,it),_.transformQuat(n.up,n.up,z),x=it):!a.staticMoving&&x&&(x*=Math.sqrt(1-a.dynamicDampingFactor),_.sub(v,n.position,n.target),jn.setAxisAngle(z,v,x),_.transformQuat(n.up,n.up,z)),He.copy(b,S)}function Y(){var Ne=1+(w[1]-C[1])*a.zoomSpeed;Ne!==1&&Ne>0&&_.scale(v,v,Ne),a.staticMoving?He.copy(C,w):C[1]+=(w[1]-C[1])*a.dynamicDampingFactor}function Z(){var Ne=(M[1]-A[1])*a.zoomSpeed;if(Ne!==0){var Qe=Math.max(1,n.state.radius+n.state.radius*Ne);n.setState({radius:Qe})}a.staticMoving?He.copy(A,M):A[1]+=(M[1]-A[1])*a.dynamicDampingFactor}var te=He(),le=_(),ye=_();function be(){if(He.sub(te,He.copy(te,k),D),He.squaredMagnitude(te)){var Ne=r.pixelRatio*a.panSpeed;te[0]*=1/n.zoom*n.viewport.width*Ne,te[1]*=1/n.zoom*n.viewport.height*Ne,_.cross(ye,_.copy(ye,v),n.up),_.setMagnitude(ye,ye,te[0]),_.setMagnitude(le,n.up,te[1]),_.add(ye,ye,le),_.add(n.position,n.position,ye),_.add(n.target,n.target,ye),a.staticMoving?He.copy(D,k):(He.sub(te,k,D),He.scale(te,te,a.dynamicDampingFactor),He.add(D,D,te))}}function Ee(){var Ne=Math.min(Math.max(n.state.radiusMax*1e3,.01),a.maxDistance);_.squaredMagnitude(v)>Ne*Ne&&(_.setMagnitude(v,v,Ne),_.add(n.position,n.target,v),He.copy(C,w),He.copy(A,M)),_.squaredMagnitude(v)<a.minDistance*a.minDistance&&(_.setMagnitude(v,v,a.minDistance),_.add(n.position,n.target,v),He.copy(C,w),He.copy(A,M))}function Se(Ne,Qe){return Ne*=r.pixelRatio,Qe*=r.pixelRatio,Ne>o.x+o.width||r.height-Qe>o.y+o.height||Ne<o.x||r.height-Qe<o.y}var ie=-1;function oe(Ne){ie!==Ne&&(a.spin&&ie>0&&Xe(Ne-ie),_.sub(v,n.position,n.target),U(),J(),Y(),Z(),be(),_.add(n.position,n.target,v),Ee(),_.squaredDistance(h,n.position)>vn&&_.copy(h,n.position),ie=Ne)}function O(){_.copy(n.target,R),_.copy(n.position,L),_.copy(n.up,H),_.sub(v,n.position,n.target),_.copy(h,n.position)}function V(Ne){var Qe=Ne.x,it=Ne.y,ot=Ne.pageX,dt=Ne.pageY,Re=Ne.buttons,Ie=Ne.modifiers,Ye=Ne.isStart,tt=Se(Qe,it);if(!(Ye&&tt)&&!(!Ye&&!f)){f=!0;var xt=fr.match(a.bindings.dragRotate,Re,Ie),pt=fr.match(a.bindings.dragRotateZ,Re,Ie),ut=fr.match(a.bindings.dragPan,Re,Ie),fe=fr.match(a.bindings.dragZoom,Re,Ie),me=fr.match(a.bindings.dragFocus,Re,Ie),we=fr.match(a.bindings.dragFocusZoom,Re,Ie);if(G(ot,dt),j(ot,dt),Ye&&(xt&&(He.copy(m,Q),He.copy(p,m)),pt&&(He.copy(S,Q),He.copy(b,S)),(fe||we)&&(He.copy(C,B),He.copy(w,C)),me&&(He.copy(A,B),He.copy(M,A)),ut&&(He.copy(D,B),He.copy(k,D))),xt&&He.copy(m,Q),pt&&He.copy(S,Q),(fe||we)&&He.copy(w,B),me&&He.copy(M,B),we){var Ke=_.distance(n.state.position,n.state.target);n.setState({radius:Ke/5})}ut&&He.copy(k,B)}}function pe(){f=!1}function _e(Ne){var Qe=Ne.x,it=Ne.y,ot=Ne.dx,dt=Ne.dy,Re=Ne.dz,Ie=Ne.buttons,Ye=Ne.modifiers;if(!Se(Qe,it)){var tt=g_e(ot,dt,Re);fr.match(a.bindings.scrollZoom,Ie,Ye)&&(w[1]+=tt*1e-4),fr.match(a.bindings.scrollFocus,Ie,Ye)&&(M[1]+=tt*1e-4)}}function Pe(Ne){var Qe=Ne.fraction,it=Ne.buttons,ot=Ne.modifiers;fr.match(a.bindings.scrollZoom,it,ot)&&(f=!0,w[1]+=(Qe-1)*.1)}function je(){s||(s=!0,u.unsubscribe(),c.unsubscribe(),d.unsubscribe(),l.unsubscribe())}var ze=He.create(.005,0);function Xe(Ne){if(a.spinSpeed!==0){var Qe=(a.spinSpeed||0)/1e3;ze[0]=60*Math.min(Math.abs(Ne),1e3/8)/1e3*Qe,f||He.add(m,p,ze)}}function ct(Ne){ie=-1,oe(Ne)}return{viewport:o,get props(){return a},setProps:function(Ne){Object.assign(a,Ne)},start:ct,update:oe,reset:O,dispose:je}}e.create=t})(rD||(rD={}));var k_;(function(e){function t(){return{view:ue.identity(),position:_.create(0,0,0),direction:_.create(0,0,-1),up:_.create(0,1,0)}}e.create=t;var r=_.zero();function n(i){_.add(r,i.position,i.direction),ue.lookAt(i.view,i.position,r,i.up)}e.update=n})(k_||(k_={}));var t$e=function(){function e(){this.removeList=UM(),this.removeMap=new Map,this.addList=UM(),this.addMap=new Map}return Object.defineProperty(e.prototype,"isEmpty",{get:function(){return this.removeList.count===0&&this.addList.count===0},enumerable:!1,configurable:!0}),e.prototype.add=function(t){if(this.removeMap.has(t)){var r=this.removeMap.get(t);this.removeMap.delete(t),this.removeList.remove(r)}if(!this.addMap.has(t)){var n=this.addList.addLast(t);this.addMap.set(t,n)}},e.prototype.remove=function(t){if(this.addMap.has(t)){var r=this.addMap.get(t);this.addMap.delete(t),this.addList.remove(r)}if(!this.removeMap.has(t)){var n=this.removeList.addLast(t);this.removeMap.set(t,n)}},e.prototype.tryGetRemove=function(){var t=this.removeList.removeFirst();return t&&this.removeMap.delete(t),t},e.prototype.tryGetAdd=function(){var t=this.addList.removeFirst();return t&&this.addMap.delete(t),t},e}(),U0=new rs("98");function dz(e,t,r){U0.reset();for(var n=0,i=e.length;n<i;++n)if(!(r&&!e[n].state.visible)){var a=e[n].values.boundingSphere.ref.value;a.radius&&U0.includeSphere(a)}U0.finishedIncludeStep();for(var n=0,i=e.length;n<i;++n)if(!(r&&!e[n].state.visible)){var o=e[n].values.boundingSphere.ref.value;o.radius&&U0.radiusSphere(o)}return U0.getSphere(t)}function r$e(e,t){var r=e.getProgram("colorBlended").id,n=t.getProgram("colorBlended").id,i=e.materialId,a=t.materialId;return r!==n?r-n:i!==a?i-a:e.id-t.id}var Mg;(function(e){function t(r){var n=new Map,i=[],a=Fe(),o=Fe(),s=[],u=[],l=!0,c=!0,d=k_.create(),f=d.view,h=d.position,v=d.direction,p=d.up;function m(A){if(n.has(A))return console.warn("RenderObject with id '"+A.id+"' already present"),n.get(A);var M=R8e(r,A);return i.push(M),A.type==="direct-volume"?u.push(M):s.push(M),n.set(A,M),l=!0,c=!0,M}function g(A){var M=n.get(A);M&&(M.dispose(),yp(i,M),yp(s,M),yp(u,M),n.delete(A),l=!0,c=!0)}var y=100;function b(A){for(var M=Tn(),D=0;;){var k=S.tryGetRemove();if(!k)break;if(g(k),++D%y===0&&Tn()-M>A)return!1}for(;;){var k=S.tryGetAdd();if(!k)break;if(m(k),++D%y===0&&Tn()-M>A)return!1}return i.sort(r$e),!0}var S=new t$e,x=-1;function C(){for(var A=23,M=0,D=i.length;M<D;++M)i[M].state.visible&&(A=31*A+i[M].id|0);return A=cY(A),A===-1&&(A=0),A}function w(){var A=C();return A!==x?(c=!0,!0):!1}return{view:f,position:h,direction:v,up:p,renderables:i,primitives:{view:f,position:h,direction:v,up:p,renderables:s},volumes:{view:f,position:h,direction:v,up:p,renderables:u},syncVisibility:w,update:function(A,M){var D;if(k_.update(d),A)for(var k=0,R=A.length;k<R;++k)(D=n.get(A[k]))===null||D===void 0||D.update();else for(var k=0,R=i.length;k<R;++k)i[k].update();M?w():(l=!0,c=!0)},add:function(A){return S.add(A)},remove:function(A){return S.remove(A)},commit:function(A){return A===void 0&&(A=Number.MAX_VALUE),b(A)},get needsCommit(){return!S.isEmpty},has:function(A){return n.has(A)},clear:function(){for(var A=0,M=i.length;A<M;++A)i[A].dispose();i.length=0,n.clear(),l=!0,c=!0},forEach:function(A){n.forEach(A)},get count(){return i.length},get boundingSphere(){return l&&(dz(i,a,!1),l=!1),a},get boundingSphereVisible(){return c&&(dz(i,o,!0),c=!1,x=C()),o}}}e.create=t})(Mg||(Mg={}));var nD=function(){function e(t){this.camera=t,this.t=0,this.func=e.defaultTransition,this.start=0,this.inTransition=!1,this.durationMs=0,this._source=ai.createDefaultSnapshot(),this._target=ai.createDefaultSnapshot(),this._current=ai.createDefaultSnapshot()}return Object.defineProperty(e.prototype,"source",{get:function(){return this._source},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"target",{get:function(){return this._target},enumerable:!1,configurable:!0}),e.prototype.apply=function(t,r,n){if(r===void 0&&(r=0),(!this.inTransition||r>0)&&ai.copySnapshot(this._source,this.camera.state),this.inTransition||ai.copySnapshot(this._target,this.camera.state),ai.copySnapshot(this._target,t),this._target.radius>this._target.radiusMax&&(this._target.radius=this._target.radiusMax),this._target.radius<.01&&(this._target.radius=.01),this._target.radiusMax<.01&&(this._target.radiusMax=.01),!this.inTransition&&r<=0||typeof t.mode<"u"&&t.mode!==this.camera.state.mode){this.finish(this._target);return}this.inTransition=!0,this.func=n||e.defaultTransition,(!this.inTransition||r>0)&&(this.start=this.t,this.durationMs=r)},e.prototype.tick=function(t){this.t=t,this.update()},e.prototype.finish=function(t){ai.copySnapshot(this.camera.state,t),this.inTransition=!1},e.prototype.update=function(){if(this.inTransition){var t=Math.min((this.t-this.start)/this.durationMs,1);if(t===1){this.finish(this._target);return}this.func(this._current,t,this._source,this._target),ai.copySnapshot(this.camera.state,this._current)}},e}();(function(e){var t=jn.identity();function r(n,i,a,o){ai.copySnapshot(n,o),jn.slerp(t,jn.Identity,jn.rotationTo(t,a.up,o.up),i),_.transformQuat(n.up,a.up,t),_.lerp(n.target,a.target,o.target,i),_.lerp(n.position,a.position,o.position,i),n.radius=Bo(a.radius,o.radius,i),n.radiusMax=Bo(a.radiusMax,o.radiusMax,i),n.fov=Bo(a.fov,o.fov,i),n.fog=Bo(a.fog,o.fog,i)}e.defaultTransition=r})(nD||(nD={}));var ai=function(){function e(t,r,n){r===void 0&&(r=zi.create(0,0,128,128)),n===void 0&&(n={}),this.view=ue.identity(),this.projection=ue.identity(),this.projectionView=ue.identity(),this.inverseProjectionView=ue.identity(),this.state=e.createDefaultSnapshot(),this.viewOffset=e.ViewOffset(),this.near=1,this.far=1e4,this.fogNear=5e3,this.fogFar=1e4,this.zoom=1,this.transition=new nD(this),this.stateChanged=new vf(this.state),this.prevProjection=ue.identity(),this.prevView=ue.identity(),this.deltaDirection=_(),this.newPosition=_(),this.viewport=r,this.pixelScale=n.pixelScale||1,e.copySnapshot(this.state,t)}return Object.defineProperty(e.prototype,"pixelRatio",{get:function(){var t=typeof window<"u"?window.devicePixelRatio:1;return t*this.pixelScale},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"position",{get:function(){return this.state.position},set:function(t){_.copy(this.state.position,t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"up",{get:function(){return this.state.up},set:function(t){_.copy(this.state.up,t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"target",{get:function(){return this.state.target},set:function(t){_.copy(this.state.target,t)},enumerable:!1,configurable:!0}),e.prototype.update=function(){var t=this.state;if(t.radiusMax===0)return!1;var r=2*Math.tan(t.fov/2)*_.distance(t.position,t.target);switch(this.zoom=this.viewport.height/r,a$e(this),this.state.mode){case"orthographic":n$e(this);break;case"perspective":i$e(this);break;default:throw new Error("unknown camera mode")}var n=!ue.areEqual(this.projection,this.prevProjection,vn)||!ue.areEqual(this.view,this.prevView,vn);if(n){if(ue.mul(this.projectionView,this.projection,this.view),!ue.tryInvert(this.inverseProjectionView,this.projectionView))return ue.copy(this.view,this.prevView),ue.copy(this.projection,this.prevProjection),ue.mul(this.projectionView,this.projection,this.view),!1;ue.copy(this.prevView,this.view),ue.copy(this.prevProjection,this.projection)}return n},e.prototype.setState=function(t,r){this.transition.apply(t,r),this.stateChanged.next(t)},e.prototype.getSnapshot=function(){return e.copySnapshot(e.createDefaultSnapshot(),this.state)},e.prototype.getTargetDistance=function(t){return e.targetDistance(t,this.state.fov,this.viewport.width,this.viewport.height)},e.prototype.getFocus=function(t,r,n,i){var a=Math.max(r,.01),o=this.getTargetDistance(a);_.sub(this.deltaDirection,this.target,this.position),i&&_.matchDirection(this.deltaDirection,i,this.deltaDirection),_.setMagnitude(this.deltaDirection,this.deltaDirection,o),_.sub(this.newPosition,t,this.deltaDirection);var s=e.copySnapshot(e.createDefaultSnapshot(),this.state);return s.target=_.clone(t),s.radius=a,s.position=_.clone(this.newPosition),n&&_.matchDirection(s.up,n,s.up),s},e.prototype.getInvariantFocus=function(t,r,n,i){var a=Math.max(r,.01),o=this.getTargetDistance(a);_.copy(this.deltaDirection,i),_.setMagnitude(this.deltaDirection,this.deltaDirection,o),_.sub(this.newPosition,t,this.deltaDirection);var s=e.copySnapshot(e.createDefaultSnapshot(),this.state);return s.target=_.clone(t),s.radius=a,s.position=_.clone(this.newPosition),_.copy(s.up,n),s},e.prototype.focus=function(t,r,n,i,a){r>0&&this.setState(this.getFocus(t,r,i,a),n)},e.prototype.project=function(t,r){return KWe(t,r,this.viewport,this.projectionView)},e.prototype.unproject=function(t,r){return bS(t,r,this.viewport,this.inverseProjectionView)},e}();(function(e){function t(){return{enabled:!1,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}}e.ViewOffset=t;function r(u,l,c,d,f,h,v){u.fullWidth=l,u.fullHeight=c,u.offsetX=d,u.offsetY=f,u.width=h,u.height=v}e.setViewOffset=r;function n(u,l){u.enabled=l.enabled,u.fullWidth=l.fullWidth,u.fullHeight=l.fullHeight,u.offsetX=l.offsetX,u.offsetY=l.offsetY,u.width=l.width,u.height=l.height}e.copyViewOffset=n;function i(u,l,c,d){var f=Math.max(u,.01),h=c/d,v=d<c?1:h;return Math.abs(f/v/Math.sin(l/2))}e.targetDistance=i;function a(){return{mode:"perspective",fov:Math.PI/4,position:_.create(0,0,100),up:_.create(0,1,0),target:_.create(0,0,0),radius:0,radiusMax:10,fog:50,clipFar:!0}}e.createDefaultSnapshot=a;function o(u,l){return l&&(typeof l.mode<"u"&&(u.mode=l.mode),typeof l.fov<"u"&&(u.fov=l.fov),typeof l.position<"u"&&_.copy(u.position,l.position),typeof l.up<"u"&&_.copy(u.up,l.up),typeof l.target<"u"&&_.copy(u.target,l.target),typeof l.radius<"u"&&(u.radius=l.radius),typeof l.radiusMax<"u"&&(u.radiusMax=l.radiusMax),typeof l.fog<"u"&&(u.fog=l.fog),typeof l.clipFar<"u"&&(u.clipFar=l.clipFar)),u}e.copySnapshot=o;function s(u,l){return u.mode===l.mode&&u.fov===l.fov&&u.radius===l.radius&&u.radiusMax===l.radiusMax&&u.fog===l.fog&&u.clipFar===l.clipFar&&_.exactEquals(u.position,l.position)&&_.exactEquals(u.up,l.up)&&_.exactEquals(u.target,l.target)}e.areSnapshotsEqual=s})(ai||(ai={}));function n$e(e){var t=e.viewport,r=e.zoom,n=e.near,i=e.far,a=e.viewOffset,o=-t.width/2,s=t.width/2,u=t.height/2,l=-t.height/2,c=(s-o)/(2*r),d=(u-l)/(2*r),f=(s+o)/2,h=(u+l)/2,v=f-c,p=f+c,m=h+d,g=h-d;if(a.enabled){var y=r/(a.width/a.fullWidth),b=r/(a.height/a.fullHeight),S=(s-o)/a.width,x=(u-l)/a.height;v+=S*(a.offsetX/y),p=v+S*(a.width/y),m-=x*(a.offsetY/b),g=m-x*(a.height/b)}ue.ortho(e.projection,v,p,m,g,n,i),ue.lookAt(e.view,e.position,e.target,e.up)}function i$e(e){var t=e.viewport.width/e.viewport.height,r=e.near,n=e.far,i=e.viewOffset,a=r*Math.tan(.5*e.state.fov),o=2*a,s=t*o,u=-.5*s;i.enabled&&(u+=i.offsetX*s/i.fullWidth,a-=i.offsetY*o/i.fullHeight,s*=i.width/i.fullWidth,o*=i.height/i.fullHeight),ue.perspective(e.projection,u,u+s,a,a-o,r,n),ue.lookAt(e.view,e.position,e.target,e.up)}function a$e(e){var t=e.state,r=t.radius,n=t.radiusMax,i=t.mode,a=t.fog,o=t.clipFar;r<.01&&(r=.01);var s=o?r:n,u=_.distance(e.position,e.target),l=u-r,c=u+s,d=-(50-a)/50,f=u-s*d,h=c;l=Math.max(Math.min(n,5),l),c=Math.max(5,c),l===c&&(c=l+.01),e.near=l,e.far=2*c,e.fogNear=f,e.fogFar=h}var JO={sceneBoundingSpheres:I.Boolean(!1,{description:"Show full scene bounding spheres."}),visibleSceneBoundingSpheres:I.Boolean(!1,{description:"Show visible scene bounding spheres."}),objectBoundingSpheres:I.Boolean(!1,{description:"Show bounding spheres of visible render objects."}),instanceBoundingSpheres:I.Boolean(!1,{description:"Show bounding spheres of visible instances."})},o$e=function(){function e(t,r,n){this.objectsData=new Map,this.instancesData=new Map,this.scene=Mg.create(t),this.parent=r,this._props=E(E({},I.getDefaultValues(JO)),n)}return e.prototype.update=function(){var t=this,r=hx(this.scene,this.parent.boundingSphere,this.sceneData,dr.lightgrey,u$e);r&&(this.sceneData=r);var n=hx(this.scene,this.parent.boundingSphereVisible,this.visibleSceneData,dr.black,l$e);n&&(this.visibleSceneData=n),this.parent.forEach(function(i,a){var o=t.objectsData.get(a),s=hx(t.scene,i.values.boundingSphere.ref.value,o,dr.tomato,c$e);s&&t.objectsData.set(a,s);var u=t.instancesData.get(a),l=hx(t.scene,i.values.invariantBoundingSphere.ref.value,u,dr.skyblue,d$e,{aTransform:a.values.aTransform,matrix:a.values.matrix,transform:a.values.transform,extraTransform:a.values.extraTransform,uInstanceCount:a.values.uInstanceCount,instanceCount:a.values.instanceCount,aInstance:a.values.aInstance,hasReflection:a.values.hasReflection});l&&t.instancesData.set(a,l)}),this.objectsData.forEach(function(i,a){t.parent.has(a)||(t.scene.remove(i.renderObject),t.objectsData.delete(a))}),this.instancesData.forEach(function(i,a){t.parent.has(a)||(t.scene.remove(i.renderObject),t.instancesData.delete(a))}),this.scene.update(void 0,!1),this.scene.commit()},e.prototype.syncVisibility=function(){var t=this;this.sceneData&&(this.sceneData.renderObject.state.visible=this._props.sceneBoundingSpheres),this.visibleSceneData&&(this.visibleSceneData.renderObject.state.visible=this._props.visibleSceneBoundingSpheres),this.parent.forEach(function(r,n){var i=t.objectsData.get(n);i&&(i.renderObject.state.visible=n.state.visible&&t._props.objectBoundingSpheres);var a=t.instancesData.get(n);a&&(a.renderObject.state.visible=n.state.visible&&t._props.instanceBoundingSpheres)})},e.prototype.clear=function(){this.sceneData=void 0,this.objectsData.clear(),this.scene.clear()},Object.defineProperty(e.prototype,"isEnabled",{get:function(){return this._props.sceneBoundingSpheres||this._props.visibleSceneBoundingSpheres||this._props.objectBoundingSpheres||this._props.instanceBoundingSpheres},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"props",{get:function(){return this._props},enumerable:!1,configurable:!0}),e.prototype.setProps=function(t){Object.assign(this._props,t),this.isEnabled&&this.update()},e}();function hx(e,t,r,n,i,a){if(!r||!Fe.equals(r.boundingSphere,t)){var o=s$e(t,r&&r.mesh),s=r?r.renderObject:f$e(o,n,i,a);return r?N.updateIfChanged(s.values.drawCount,ra.getDrawCount(o)):e.add(s),{boundingSphere:Fe.clone(t),renderObject:s,mesh:o}}}function s$e(e,t){var r=2,n=B3(r),i=wt.createState(n,n/2,t);if(e.radius&&(Mi(i,e.center,e.radius,r),Fe.hasExtrema(e)))for(var a=0,o=e.extrema;a<o.length;a++){var s=o[a];Mi(i,s,1,0)}return wt.getMesh(i)}var u$e=hd(),l$e=hd(),c$e=hd(),d$e=hd();function f$e(e,t,r,n){var i=Nt.Utils.createValuesSimple(e,{alpha:.1,doubleSided:!1},t,1,n);return r0("mesh",i,{disposed:!1,visible:!0,alphaFactor:1,pickable:!1,colorOnly:!1,opaque:!1,writeDepth:!1,noClip:!1},r)}var h$e=function(){function e(t,r,n,i,a){var o=this;a===void 0&&(a=30),this.canvasIdentify=t,this.getLoci=r,this.input=n,this.camera=i,this.maxFps=a,this.ev=Lc.create(),this.events={hover:this.ev(),drag:this.ev(),click:this.ev()},this.startX=-1,this.startY=-1,this.endX=-1,this.endY=-1,this.id=void 0,this.position=void 0,this.currentIdentifyT=0,this.isInteracting=!1,this.prevLoci=or.Loci.Empty,this.prevT=0,this.inside=!1,this.buttons=tv.create(0),this.button=tv.create(0),this.modifiers=Cu.None,n.drag.subscribe(function(s){var u=s.x,l=s.y,c=s.buttons,d=s.button,f=s.modifiers;o.isInteracting=!0,o.drag(u,l,c,d,f)}),n.move.subscribe(function(s){var u=s.x,l=s.y,c=s.inside,d=s.buttons,f=s.button,h=s.modifiers;!c||o.isInteracting||o.move(u,l,d,f,h)}),n.leave.subscribe(function(){o.leave()}),n.click.subscribe(function(s){var u=s.x,l=s.y,c=s.buttons,d=s.button,f=s.modifiers;o.outsideViewport(u,l)||o.click(u,l,c,d,f)}),n.interactionEnd.subscribe(function(){o.isInteracting=!1}),n.modifiers.subscribe(function(s){o.modify(s)})}return e.prototype.identify=function(t,r){var n=this.startX!==this.endX||this.startY!==this.endY;if(t===2){n&&!or.Loci.isEmpty(this.prevLoci)&&(this.events.drag.next({current:this.prevLoci,buttons:this.buttons,button:this.button,modifiers:this.modifiers,pageStart:He.create(this.startX,this.startY),pageEnd:He.create(this.endX,this.endY)}),this.startX=this.endX,this.startY=this.endY);return}if(n){var i=this.canvasIdentify(this.endX,this.endY);this.id=i==null?void 0:i.id,this.position=i==null?void 0:i.position,this.startX=this.endX,this.startY=this.endY}if(t===1){var a=this.getLoci(this.id);this.events.click.next({current:a,buttons:this.buttons,button:this.button,modifiers:this.modifiers,page:He.create(this.endX,this.endY),position:this.position}),this.prevLoci=a;return}if(!(!this.inside||this.currentIdentifyT!==r||!n||this.outsideViewport(this.endX,this.endY))){var o=this.getLoci(this.id);this.events.hover.next({current:o,buttons:this.buttons,button:this.button,modifiers:this.modifiers,page:He.create(this.endX,this.endY),position:this.position}),this.prevLoci=o}},e.prototype.tick=function(t){this.inside&&t-this.prevT>1e3/this.maxFps&&(this.prevT=t,this.currentIdentifyT=t,this.identify(this.isInteracting?2:0,t))},e.prototype.leave=function(){this.inside=!1,or.Loci.isEmpty(this.prevLoci)||(this.prevLoci=or.Loci.Empty,this.events.hover.next({current:this.prevLoci,buttons:this.buttons,button:this.button,modifiers:this.modifiers}))},e.prototype.move=function(t,r,n,i,a){this.inside=!0,this.buttons=n,this.button=i,this.modifiers=a,this.endX=t,this.endY=r},e.prototype.click=function(t,r,n,i,a){this.endX=t,this.endY=r,this.buttons=n,this.button=i,this.modifiers=a,this.identify(1,0)},e.prototype.drag=function(t,r,n,i,a){this.endX=t,this.endY=r,this.buttons=n,this.button=i,this.modifiers=a,this.identify(2,0)},e.prototype.modify=function(t){Cu.areEqual(t,this.modifiers)||(this.modifiers=t,this.events.hover.next({current:this.prevLoci,buttons:this.buttons,button:this.button,modifiers:this.modifiers,page:He.create(this.endX,this.endY),position:this.position}))},e.prototype.outsideViewport=function(t,r){var n=this,i=n.input,a=n.camera.viewport;return t*=i.pixelRatio,r*=i.pixelRatio,t>a.x+a.width||i.height-r>a.y+a.height||t<a.x||i.height-r<a.y},e.prototype.dispose=function(){this.ev.dispose()},e}(),_o=`
precision highp float;

attribute vec2 aPosition;
uniform vec2 uQuadScale;

void main(void) {
    vec2 position = aPosition * uQuadScale - vec2(1.0, 1.0) + uQuadScale;
    gl_Position = vec4(position, 0.0, 1.0);
}
`,p$e=`
precision highp float;
precision highp int;
precision highp sampler2D;

uniform sampler2D tDepth;
uniform vec2 uTexSize;

uniform float uNear;
uniform float uFar;

uniform float uMaxPossibleViewZDiff;

#include common

float getViewZ(const in float depth) {
    #if dOrthographic == 1
        return orthographicDepthToViewZ(depth, uNear, uFar);
    #else
        return perspectiveDepthToViewZ(depth, uNear, uFar);
    #endif
}

float getDepth(const in vec2 coords) {
    return unpackRGBAToDepth(texture2D(tDepth, coords));
}

bool isBackground(const in float depth) {
    return depth == 1.0;
}

void main(void) {
    float backgroundViewZ = uFar + 3.0 * uMaxPossibleViewZDiff;

    vec2 coords = gl_FragCoord.xy / uTexSize;
    vec2 invTexSize = 1.0 / uTexSize;

    float selfDepth = getDepth(coords);
    float selfViewZ = isBackground(selfDepth) ? backgroundViewZ : getViewZ(getDepth(coords));

    float outline = 1.0;
    float bestDepth = 1.0;

    for (int y = -1; y <= 1; y++) {
        for (int x = -1; x <= 1; x++) {
            vec2 sampleCoords = coords + vec2(float(x), float(y)) * invTexSize;
            float sampleDepth = getDepth(sampleCoords);
            float sampleViewZ = isBackground(sampleDepth) ? backgroundViewZ : getViewZ(sampleDepth);

            if (abs(selfViewZ - sampleViewZ) > uMaxPossibleViewZDiff && selfDepth > sampleDepth && sampleDepth <= bestDepth) {
                outline = 0.0;
                bestDepth = sampleDepth;
            }
        }
    }

    gl_FragColor = vec4(outline, packUnitIntervalToRG(bestDepth), 0.0);
}
`,v$e=`
precision highp float;
precision highp int;
precision highp sampler2D;

#include common

uniform sampler2D tDepth;
uniform vec2 uTexSize;
uniform vec4 uBounds;

uniform vec3 uSamples[dNSamples];

uniform mat4 uProjection;
uniform mat4 uInvProjection;

uniform float uRadius;
uniform float uBias;

float smootherstep(float edge0, float edge1, float x) {
    x = clamp((x - edge0) / (edge1 - edge0), 0.0, 1.0);
    return x * x * x * (x * (x * 6.0 - 15.0) + 10.0);
}

float noise(const in vec2 coords) {
    float a = 12.9898;
    float b = 78.233;
    float c = 43758.5453;
    float dt = dot(coords, vec2(a,b));
    float sn = mod(dt, PI);
    return abs(fract(sin(sn) * c)); // is abs necessary?
}

vec2 getNoiseVec2(const in vec2 coords) {
    return vec2(noise(coords), noise(coords + vec2(PI, 2.71828)));
}

bool isBackground(const in float depth) {
    return depth == 1.0;
}

bool outsideBounds(const in vec2 p) {
    return p.x < uBounds.x || p.y < uBounds.y || p.x > uBounds.z || p.y > uBounds.w;
}

float getDepth(const in vec2 coords) {
    return outsideBounds(coords) ? 1.0 : unpackRGBAToDepth(texture2D(tDepth, coords));
}

vec3 normalFromDepth(const in float depth, const in float depth1, const in float depth2, vec2 offset1, vec2 offset2) {
    vec3 p1 = vec3(offset1, depth1 - depth);
    vec3 p2 = vec3(offset2, depth2 - depth);

    vec3 normal = cross(p1, p2);
    normal.z = -normal.z;

    return normalize(normal);
}

// StarCraft II Ambient Occlusion by [Filion and McNaughton 2008]
void main(void) {
    vec2 invTexSize = 1.0 / uTexSize;
    vec2 selfCoords = gl_FragCoord.xy * invTexSize;

    float selfDepth = getDepth(selfCoords);
    vec2 selfPackedDepth = packUnitIntervalToRG(selfDepth);

    if (isBackground(selfDepth)) {
        gl_FragColor = vec4(packUnitIntervalToRG(0.0), selfPackedDepth);
        return;
    }

    vec2 offset1 = vec2(0.0, invTexSize.y);
    vec2 offset2 = vec2(invTexSize.x, 0.0);

    float selfDepth1 = getDepth(selfCoords + offset1);
    float selfDepth2 = getDepth(selfCoords + offset2);

    vec3 selfViewNormal = normalFromDepth(selfDepth, selfDepth1, selfDepth2, offset1, offset2);
    vec3 selfViewPos = screenSpaceToViewSpace(vec3(selfCoords, selfDepth), uInvProjection);

    vec3 randomVec = normalize(vec3(getNoiseVec2(selfCoords) * 2.0 - 1.0, 0.0));

    vec3 tangent = normalize(randomVec - selfViewNormal * dot(randomVec, selfViewNormal));
    vec3 bitangent = cross(selfViewNormal, tangent);
    mat3 TBN = mat3(tangent, bitangent, selfViewNormal);

    float occlusion = 0.0;
    for(int i = 0; i < dNSamples; i++){
        vec3 sampleViewPos = TBN * uSamples[i];
        sampleViewPos = selfViewPos + sampleViewPos * uRadius;

        vec4 offset = vec4(sampleViewPos, 1.0);
        offset = uProjection * offset;
        offset.xyz = (offset.xyz / offset.w) * 0.5 + 0.5;

        float sampleViewZ = screenSpaceToViewSpace(vec3(offset.xy, getDepth(offset.xy)), uInvProjection).z;

        occlusion += step(sampleViewPos.z + 0.025, sampleViewZ) * smootherstep(0.0, 1.0, uRadius / abs(selfViewPos.z - sampleViewZ));
    }
    occlusion = 1.0 - (uBias * occlusion / float(dNSamples));

    vec2 packedOcclusion = packUnitIntervalToRG(occlusion);

    gl_FragColor = vec4(packedOcclusion, selfPackedDepth);
}
`,m$e=`
precision highp float;
precision highp int;
precision highp sampler2D;

uniform sampler2D tSsaoDepth;
uniform vec2 uTexSize;
uniform vec4 uBounds;

uniform float uKernel[dOcclusionKernelSize];

uniform float uBlurDirectionX;
uniform float uBlurDirectionY;

uniform float uMaxPossibleViewZDiff;

uniform float uNear;
uniform float uFar;

#include common

float getViewZ(const in float depth) {
    #if dOrthographic == 1
        return orthographicDepthToViewZ(depth, uNear, uFar);
    #else
        return perspectiveDepthToViewZ(depth, uNear, uFar);
    #endif
}

bool isBackground(const in float depth) {
    return depth == 1.0;
}

bool outsideBounds(const in vec2 p) {
    return p.x < uBounds.x || p.y < uBounds.y || p.x > uBounds.z || p.y > uBounds.w;
}

void main(void) {
    vec2 coords = gl_FragCoord.xy / uTexSize;

    vec2 packedDepth = texture2D(tSsaoDepth, coords).zw;

    if (outsideBounds(coords)) {
        gl_FragColor = vec4(packUnitIntervalToRG(1.0), packedDepth);
        return;
    }

    float selfDepth = unpackRGToUnitInterval(packedDepth);
    // if background and if second pass
    if (isBackground(selfDepth) && uBlurDirectionY != 0.0) {
        gl_FragColor = vec4(packUnitIntervalToRG(1.0), packedDepth);
        return;
    }

    float selfViewZ = getViewZ(selfDepth);

    vec2 offset = vec2(uBlurDirectionX, uBlurDirectionY) / uTexSize;

    float sum = 0.0;
    float kernelSum = 0.0;
    // only if kernelSize is odd
    for (int i = -dOcclusionKernelSize / 2; i <= dOcclusionKernelSize / 2; i++) {
        vec2 sampleCoords = coords + float(i) * offset;
        if (outsideBounds(sampleCoords)) {
            continue;
        }

        vec4 sampleSsaoDepth = texture2D(tSsaoDepth, sampleCoords);

        float sampleDepth = unpackRGToUnitInterval(sampleSsaoDepth.zw);
        if (isBackground(sampleDepth)) {
            continue;
        }

        if (abs(float(i)) > 1.0) { // abs is not defined for int in webgl1
            float sampleViewZ = getViewZ(sampleDepth);
            if (abs(selfViewZ - sampleViewZ) > uMaxPossibleViewZDiff) {
                continue;
            }
        }

        float kernel = uKernel[int(abs(float(i)))]; // abs is not defined for int in webgl1
        float sampleValue = unpackRGToUnitInterval(sampleSsaoDepth.xy);

        sum += kernel * sampleValue;
        kernelSum += kernel;
    }

    gl_FragColor = vec4(packUnitIntervalToRG(sum / kernelSum), packedDepth);
}
`,g$e=`
precision highp float;
precision highp int;
precision highp sampler2D;

uniform sampler2D tSsaoDepth;
uniform sampler2D tColor;
uniform sampler2D tDepth;
uniform sampler2D tOutlines;
uniform vec2 uTexSize;

uniform float uNear;
uniform float uFar;
uniform float uFogNear;
uniform float uFogFar;
uniform vec3 uFogColor;
uniform bool uTransparentBackground;

uniform float uOcclusionBias;
uniform float uOcclusionRadius;

uniform float uMaxPossibleViewZDiff;

const vec3 occlusionColor = vec3(0.0);

#include common

float getViewZ(const in float depth) {
    #if dOrthographic == 1
        return orthographicDepthToViewZ(depth, uNear, uFar);
    #else
        return perspectiveDepthToViewZ(depth, uNear, uFar);
    #endif
}

float getDepth(const in vec2 coords) {
    return unpackRGBAToDepth(texture2D(tDepth, coords));
}

bool isBackground(const in float depth) {
    return depth == 1.0;
}

float getOutline(const in vec2 coords, out float closestTexel) {
    float backgroundViewZ = uFar + 3.0 * uMaxPossibleViewZDiff;
    vec2 invTexSize = 1.0 / uTexSize;

    float selfDepth = getDepth(coords);
    float selfViewZ = isBackground(selfDepth) ? backgroundViewZ : getViewZ(selfDepth);

    float outline = 1.0;
    closestTexel = 1.0;
    for (int y = -dOutlineScale; y <= dOutlineScale; y++) {
        for (int x = -dOutlineScale; x <= dOutlineScale; x++) {
            if (x * x + y * y > dOutlineScale * dOutlineScale) {
                continue;
            }

            vec2 sampleCoords = coords + vec2(float(x), float(y)) * invTexSize;

            vec4 sampleOutlineCombined = texture2D(tOutlines, sampleCoords);
            float sampleOutline = sampleOutlineCombined.r;
            float sampleOutlineDepth = unpackRGToUnitInterval(sampleOutlineCombined.gb);

            if (sampleOutline == 0.0 && sampleOutlineDepth < closestTexel && abs(selfViewZ - sampleOutlineDepth) > uMaxPossibleViewZDiff) {
                outline = 0.0;
                closestTexel = sampleOutlineDepth;
            }
        }
    }
    return outline;
}

float getSsao(vec2 coords) {
    float rawSsao = unpackRGToUnitInterval(texture2D(tSsaoDepth, coords).xy);
    if (rawSsao > 0.999) {
        return 1.0;
    } else if (rawSsao > 0.001) {
        return rawSsao;
    }
    // treat values close to 0.0 as errors and return no occlusion
    return 1.0;
}

void main(void) {
    vec2 coords = gl_FragCoord.xy / uTexSize;
    vec4 color = texture2D(tColor, coords);

    float viewDist;
    float fogFactor;

    #ifdef dOcclusionEnable
        float depth = getDepth(coords);
        if (!isBackground(depth)) {
            viewDist = abs(getViewZ(depth));
            fogFactor = smoothstep(uFogNear, uFogFar, viewDist);
            float occlusionFactor = getSsao(coords);
            if (!uTransparentBackground) {
                color.rgb = mix(mix(occlusionColor, uFogColor, fogFactor), color.rgb, occlusionFactor);
            } else {
                color.rgb = mix(occlusionColor * (1.0 - fogFactor), color.rgb, occlusionFactor);
            }
        }
    #endif

    // outline needs to be handled after occlusion to keep them clean
    #ifdef dOutlineEnable
        float closestTexel;
        float outline = getOutline(coords, closestTexel);

        if (outline == 0.0) {
            color.rgb *= outline;
            viewDist = abs(getViewZ(closestTexel));
            fogFactor = smoothstep(uFogNear, uFogFar, viewDist);
            if (!uTransparentBackground) {
                color.rgb = mix(color.rgb, uFogColor, fogFactor);
            } else {
                color.a = 1.0 - fogFactor;
            }
        }
    #endif

    gl_FragColor = color;
}
`,y$e=`
precision highp float;
precision highp int;
precision highp sampler2D;

uniform sampler2D tColor;
uniform vec2 uTexSizeInv;

// adapted from https://github.com/kosua20/Rendu
// MIT License Copyright (c) 2017 Simon Rodriguez

#define QUALITY(q) ((q) < 5 ? 1.0 : ((q) > 5 ? ((q) < 10 ? 2.0 : ((q) < 11 ? 4.0 : 8.0)) : 1.5))

float rgb2luma(vec3 rgb){
    return sqrt(dot(rgb, vec3(0.299, 0.587, 0.114)));
}

float sampleLuma(vec2 uv) {
    return rgb2luma(texture2D(tColor, uv).rgb);
}

float sampleLuma(vec2 uv, float uOffset, float vOffset) {
    uv += uTexSizeInv * vec2(uOffset, vOffset);
    return sampleLuma(uv);
}

void main(void) {
    vec2 coords = gl_FragCoord.xy * uTexSizeInv;
    vec2 inverseScreenSize = uTexSizeInv;

    vec4 colorCenter = texture2D(tColor, coords);

    // Luma at the current fragment
    float lumaCenter = rgb2luma(colorCenter.rgb);

    // Luma at the four direct neighbours of the current fragment.
    float lumaDown = sampleLuma(coords, 0.0, -1.0);
    float lumaUp = sampleLuma(coords, 0.0, 1.0);
    float lumaLeft = sampleLuma(coords, -1.0, 0.0);
    float lumaRight = sampleLuma(coords, 1.0, 0.0);

    // Find the maximum and minimum luma around the current fragment.
    float lumaMin = min(lumaCenter, min(min(lumaDown, lumaUp), min(lumaLeft, lumaRight)));
    float lumaMax = max(lumaCenter, max(max(lumaDown, lumaUp), max(lumaLeft, lumaRight)));

    // Compute the delta.
    float lumaRange = lumaMax - lumaMin;

    // If the luma variation is lower that a threshold (or if we are in a really dark area),
    // we are not on an edge, don't perform any AA.
    if (lumaRange < max(dEdgeThresholdMin, lumaMax * dEdgeThresholdMax)) {
        gl_FragColor = colorCenter;
        return;
    }

    // Query the 4 remaining corners lumas.
    float lumaDownLeft = sampleLuma(coords, -1.0, -1.0);
    float lumaUpRight = sampleLuma(coords, 1.0, 1.0);
    float lumaUpLeft = sampleLuma(coords, -1.0, 1.0);
    float lumaDownRight = sampleLuma(coords, 1.0, -1.0);

    // Combine the four edges lumas (using intermediary variables for future computations
    // with the same values).
    float lumaDownUp = lumaDown + lumaUp;
    float lumaLeftRight = lumaLeft + lumaRight;

    // Same for corners
    float lumaLeftCorners = lumaDownLeft + lumaUpLeft;
    float lumaDownCorners = lumaDownLeft + lumaDownRight;
    float lumaRightCorners = lumaDownRight + lumaUpRight;
    float lumaUpCorners = lumaUpRight + lumaUpLeft;

    // Compute an estimation of the gradient along the horizontal and vertical axis.
    float edgeHorizontal = abs(-2.0 * lumaLeft + lumaLeftCorners) + abs(-2.0 * lumaCenter + lumaDownUp) * 2.0 + abs(-2.0 * lumaRight + lumaRightCorners);
    float edgeVertical = abs(-2.0 * lumaUp + lumaUpCorners) + abs(-2.0 * lumaCenter + lumaLeftRight) * 2.0 + abs(-2.0 * lumaDown + lumaDownCorners);

    // Is the local edge horizontal or vertical ?
    bool isHorizontal = (edgeHorizontal >= edgeVertical);

    // Choose the step size (one pixel) accordingly.
    float stepLength = isHorizontal ? inverseScreenSize.y : inverseScreenSize.x;

    // Select the two neighboring texels lumas in the opposite direction to the local edge.
    float luma1 = isHorizontal ? lumaDown : lumaLeft;
    float luma2 = isHorizontal ? lumaUp : lumaRight;
    // Compute gradients in this direction.
    float gradient1 = luma1 - lumaCenter;
    float gradient2 = luma2 - lumaCenter;

    // Which direction is the steepest ?
    bool is1Steepest = abs(gradient1) >= abs(gradient2);

    // Gradient in the corresponding direction, normalized.
    float gradientScaled = 0.25 * max(abs(gradient1), abs(gradient2));

    // Average luma in the correct direction.
    float lumaLocalAverage = 0.0;
    if(is1Steepest){
        // Switch the direction
        stepLength = -stepLength;
        lumaLocalAverage = 0.5 * (luma1 + lumaCenter);
    } else {
        lumaLocalAverage = 0.5 * (luma2 + lumaCenter);
    }

    // Shift UV in the correct direction by half a pixel.
    vec2 currentUv = coords;
    if(isHorizontal){
        currentUv.y += stepLength * 0.5;
    } else {
        currentUv.x += stepLength * 0.5;
    }

    // Compute offset (for each iteration step) in the right direction.
    vec2 offset = isHorizontal ? vec2(inverseScreenSize.x, 0.0) : vec2(0.0, inverseScreenSize.y);
    // Compute UVs to explore on each side of the edge, orthogonally.
    // The QUALITY allows us to step faster.
    vec2 uv1 = currentUv - offset * QUALITY(0);
    vec2 uv2 = currentUv + offset * QUALITY(0);

    // Read the lumas at both current extremities of the exploration segment,
    // and compute the delta wrt to the local average luma.
    float lumaEnd1 = sampleLuma(uv1);
    float lumaEnd2 = sampleLuma(uv2);
    lumaEnd1 -= lumaLocalAverage;
    lumaEnd2 -= lumaLocalAverage;

    // If the luma deltas at the current extremities is larger than the local gradient,
    // we have reached the side of the edge.
    bool reached1 = abs(lumaEnd1) >= gradientScaled;
    bool reached2 = abs(lumaEnd2) >= gradientScaled;
    bool reachedBoth = reached1 && reached2;

    // If the side is not reached, we continue to explore in this direction.
    if(!reached1){
        uv1 -= offset * QUALITY(1);
    }
    if(!reached2){
        uv2 += offset * QUALITY(1);
    }

    // If both sides have not been reached, continue to explore.
    if(!reachedBoth){
        for(int i = 2; i < dIterations; i++){
            // If needed, read luma in 1st direction, compute delta.
            if(!reached1){
                lumaEnd1 = sampleLuma(uv1);
                lumaEnd1 = lumaEnd1 - lumaLocalAverage;
            }
            // If needed, read luma in opposite direction, compute delta.
            if(!reached2){
                lumaEnd2 = sampleLuma(uv2);
                lumaEnd2 = lumaEnd2 - lumaLocalAverage;
            }
            // If the luma deltas at the current extremities is larger than the local gradient,
            // we have reached the side of the edge.
            reached1 = abs(lumaEnd1) >= gradientScaled;
            reached2 = abs(lumaEnd2) >= gradientScaled;
            reachedBoth = reached1 && reached2;

            // If the side is not reached, we continue to explore in this direction,
            // with a variable quality.
            if(!reached1){
                uv1 -= offset * QUALITY(i);
            }
            if(!reached2){
                uv2 += offset * QUALITY(i);
            }

            // If both sides have been reached, stop the exploration.
            if(reachedBoth){
                break;
            }
        }
    }

    // Compute the distances to each side edge of the edge (!).
    float distance1 = isHorizontal ? (coords.x - uv1.x) : (coords.y - uv1.y);
    float distance2 = isHorizontal ? (uv2.x - coords.x) : (uv2.y - coords.y);

    // In which direction is the side of the edge closer ?
    bool isDirection1 = distance1 < distance2;
    float distanceFinal = min(distance1, distance2);

    // Thickness of the edge.
    float edgeThickness = (distance1 + distance2);

    // Is the luma at center smaller than the local average ?
    bool isLumaCenterSmaller = lumaCenter < lumaLocalAverage;

    // If the luma at center is smaller than at its neighbour,
    // the delta luma at each end should be positive (same variation).
    bool correctVariation1 = (lumaEnd1 < 0.0) != isLumaCenterSmaller;
    bool correctVariation2 = (lumaEnd2 < 0.0) != isLumaCenterSmaller;

    // Only keep the result in the direction of the closer side of the edge.
    bool correctVariation = isDirection1 ? correctVariation1 : correctVariation2;

    // UV offset: read in the direction of the closest side of the edge.
    float pixelOffset = - distanceFinal / edgeThickness + 0.5;

    // If the luma variation is incorrect, do not offset.
    float finalOffset = correctVariation ? pixelOffset : 0.0;

    // Sub-pixel shifting
    // Full weighted average of the luma over the 3x3 neighborhood.
    float lumaAverage = (1.0 / 12.0) * (2.0 * (lumaDownUp + lumaLeftRight) + lumaLeftCorners + lumaRightCorners);
    // Ratio of the delta between the global average and the center luma,
    // over the luma range in the 3x3 neighborhood.
    float subPixelOffset1 = clamp(abs(lumaAverage - lumaCenter) / lumaRange, 0.0, 1.0);
    float subPixelOffset2 = (-2.0 * subPixelOffset1 + 3.0) * subPixelOffset1 * subPixelOffset1;
    // Compute a sub-pixel offset based on this delta.
    float subPixelOffsetFinal = subPixelOffset2 * subPixelOffset2 * float(dSubpixelQuality);

    // Pick the biggest of the two offsets.
    finalOffset = max(finalOffset, subPixelOffsetFinal);

    // Compute the final UV coordinates.
    vec2 finalUv = coords;
    if(isHorizontal){
        finalUv.y += finalOffset * stepLength;
    } else {
        finalUv.x += finalOffset * stepLength;
    }

    // Read the color at the new UV coordinates, and use it.
    gl_FragColor = texture2D(tColor, finalUv);
}
`,b$e={edgeThresholdMin:I.Numeric(.0312,{min:.0312,max:.0833,step:1e-4},{description:"Trims the algorithm from processing darks."}),edgeThresholdMax:I.Numeric(.063,{min:.063,max:.333,step:.001},{description:"The minimum amount of local contrast required to apply algorithm."}),iterations:I.Numeric(12,{min:0,max:16,step:1},{description:"Number of edge exploration steps."}),subpixelQuality:I.Numeric(.3,{min:0,max:1,step:.01},{description:"Choose the amount of sub-pixel aliasing removal."})},x$e=function(){function e(t,r){this.webgl=t,this.renderable=_$e(t,r)}return e.prototype.updateState=function(t){var r=this.webgl,n=r.gl,i=r.state;i.enable(n.SCISSOR_TEST),i.disable(n.BLEND),i.disable(n.DEPTH_TEST),i.depthMask(!1);var a=t.x,o=t.y,s=t.width,u=t.height;n.viewport(a,o,s,u),n.scissor(a,o,s,u),i.clearColor(0,0,0,1),n.clear(n.COLOR_BUFFER_BIT)},e.prototype.setSize=function(t,r){N.update(this.renderable.values.uTexSizeInv,He.set(this.renderable.values.uTexSizeInv.ref.value,1/t,1/r))},e.prototype.update=function(t,r){var n=this.renderable.values,i=r.edgeThresholdMin,a=r.edgeThresholdMax,o=r.iterations,s=r.subpixelQuality,u=!1;n.tColor.ref.value!==t&&(N.update(this.renderable.values.tColor,t),u=!0),n.dEdgeThresholdMin.ref.value!==i&&(u=!0),N.updateIfChanged(n.dEdgeThresholdMin,i),n.dEdgeThresholdMax.ref.value!==a&&(u=!0),N.updateIfChanged(n.dEdgeThresholdMax,a),n.dIterations.ref.value!==o&&(u=!0),N.updateIfChanged(n.dIterations,o),n.dSubpixelQuality.ref.value!==s&&(u=!0),N.updateIfChanged(n.dSubpixelQuality,s),u&&this.renderable.update()},e.prototype.render=function(t,r){r?r.bind():this.webgl.unbindFramebuffer(),this.updateState(t),this.renderable.render()},e}(),S$e=E(E({},va),{tColor:ur("texture","rgba","ubyte","linear"),uTexSizeInv:Ge("v2"),dEdgeThresholdMin:Qt("number"),dEdgeThresholdMax:Qt("number"),dIterations:Qt("number"),dSubpixelQuality:Qt("number")}),C$e=Mn("fxaa",_o,y$e);function _$e(e,t){var r=t.getWidth(),n=t.getHeight(),i=E(E({},ma),{tColor:N.create(t),uTexSizeInv:N.create(He.create(1/r,1/n)),dEdgeThresholdMin:N.create(.0312),dEdgeThresholdMax:N.create(.125),dIterations:N.create(12),dSubpixelQuality:N.create(.3)}),a=E({},S$e),o=Wi(e,"triangles",C$e,a,i);return qi(o,i)}var w$e=`
precision highp float;

attribute vec2 aPosition;
uniform vec2 uQuadScale;

uniform vec2 uTexSizeInv;
uniform vec4 uViewport;

varying vec2 vUv;
varying vec4 vOffset[2];

void SMAANeighborhoodBlendingVS(vec2 texCoord) {
    vOffset[0] = texCoord.xyxy + uTexSizeInv.xyxy * vec4(-1.0, 0.0, 0.0, 1.0); // WebGL port note: Changed sign in W component
    vOffset[1] = texCoord.xyxy + uTexSizeInv.xyxy * vec4(1.0, 0.0, 0.0, -1.0); // WebGL port note: Changed sign in W component
}

void main() {
    vec2 scale = uViewport.zw * uTexSizeInv;
    vec2 shift = uViewport.xy * uTexSizeInv;
    vUv = (aPosition + 1.0) * 0.5 * scale + shift;
    SMAANeighborhoodBlendingVS(vUv);
    vec2 position = aPosition * uQuadScale - vec2(1.0, 1.0) + uQuadScale;
    gl_Position = vec4(position, 0.0, 1.0);
}
`,E$e=`
precision highp float;
precision highp int;
precision highp sampler2D;

uniform sampler2D tWeights;
uniform sampler2D tColor;
uniform vec2 uTexSizeInv;

varying vec2 vUv;
varying vec4 vOffset[2];

vec4 SMAANeighborhoodBlendingPS(vec2 texCoord, vec4 offset[2], sampler2D colorTex, sampler2D blendTex) {
    // Fetch the blending weights for current pixel:
    vec4 a;
    a.xz = texture2D(blendTex, texCoord).xz;
    a.y = texture2D(blendTex, offset[1].zw).g;
    a.w = texture2D(blendTex, offset[1].xy).a;

    // Is there any blending weight with a value greater than 0.0?
    if (dot(a, vec4(1.0, 1.0, 1.0, 1.0)) < 1e-5) {
        return texture2D(colorTex, texCoord, 0.0);
    } else {
        // Up to 4 lines can be crossing a pixel (one through each edge). We
        // favor blending by choosing the line with the maximum weight for each
        // direction:
        vec2 offset;
        offset.x = a.a > a.b ? a.a : -a.b; // left vs. right
        offset.y = a.g > a.r ? -a.g : a.r; // top vs. bottom // WebGL port note: Changed signs

        // Then we go in the direction that has the maximum weight:
        if (abs(offset.x) > abs(offset.y)) { // horizontal vs. vertical
            offset.y = 0.0;
        } else {
            offset.x = 0.0;
        }

        // Fetch the opposite color and lerp by hand:
        vec4 C = texture2D(colorTex, texCoord, 0.0);
        texCoord += sign(offset) * uTexSizeInv;
        vec4 Cop = texture2D(colorTex, texCoord, 0.0);
        float s = abs(offset.x) > abs(offset.y) ? abs(offset.x) : abs(offset.y);

        // WebGL port note: Added gamma correction
        C.xyz = pow(C.xyz, vec3(2.2));
        Cop.xyz = pow(Cop.xyz, vec3(2.2));
        vec4 mixed = mix(C, Cop, s);
        mixed.xyz = pow(mixed.xyz, vec3(1.0 / 2.2));

        return mixed;
    }
}

void main() {
    gl_FragColor = SMAANeighborhoodBlendingPS(vUv, vOffset, tColor, tWeights);
}
`,A$e=`
precision highp float;

attribute vec2 aPosition;
uniform vec2 uQuadScale;

uniform vec2 uTexSizeInv;
uniform vec4 uViewport;

varying vec2 vUv;
varying vec4 vOffset[3];
varying vec2 vPixCoord;

void SMAABlendingWeightCalculationVS(vec2 texCoord) {
    vPixCoord = texCoord / uTexSizeInv;

    // We will use these offsets for the searches later on (see @PSEUDO_GATHER4):
    vOffset[0] = texCoord.xyxy + uTexSizeInv.xyxy * vec4(-0.25, 0.125, 1.25, 0.125); // WebGL port note: Changed sign in Y and W components
    vOffset[1] = texCoord.xyxy + uTexSizeInv.xyxy * vec4(-0.125, 0.25, -0.125, -1.25); // WebGL port note: Changed sign in Y and W components

    // And these for the searches, they indicate the ends of the loops:
    vOffset[2] = vec4(vOffset[0].xz, vOffset[1].yw) + vec4(-2.0, 2.0, -2.0, 2.0) * uTexSizeInv.xxyy * float(dMaxSearchSteps);
}

void main() {
    vec2 scale = uViewport.zw * uTexSizeInv;
    vec2 shift = uViewport.xy * uTexSizeInv;
    vUv = (aPosition + 1.0) * 0.5 * scale + shift;
    SMAABlendingWeightCalculationVS(vUv);
    vec2 position = aPosition * uQuadScale - vec2(1.0, 1.0) + uQuadScale;
    gl_Position = vec4(position, 0.0, 1.0);
}
`,P$e=`
precision highp float;
precision highp int;
precision highp sampler2D;

#define SMAASampleLevelZeroOffset(tex, coord, offset) texture2D(tex, coord + float(offset) * uTexSizeInv, 0.0)

#define SMAA_AREATEX_MAX_DISTANCE 16
#define SMAA_AREATEX_PIXEL_SIZE (1.0 / vec2(160.0, 560.0))
#define SMAA_AREATEX_SUBTEX_SIZE (1.0 / 7.0)

uniform sampler2D tEdges;
uniform sampler2D tArea;
uniform sampler2D tSearch;
uniform vec2 uTexSizeInv;

varying vec2 vUv;
varying vec4 vOffset[3];
varying vec2 vPixCoord;

#if __VERSION__ == 100
    vec2 round(vec2 x) {
        return sign(x) * floor(abs(x) + 0.5);
    }
#endif

float SMAASearchLength(sampler2D searchTex, vec2 e, float bias, float scale) {
    // Not required if searchTex accesses are set to point:
    // float2 SEARCH_TEX_PIXEL_SIZE = 1.0 / float2(66.0, 33.0);
    // e = float2(bias, 0.0) + 0.5 * SEARCH_TEX_PIXEL_SIZE +
    //     e * float2(scale, 1.0) * float2(64.0, 32.0) * SEARCH_TEX_PIXEL_SIZE;
    e.r = bias + e.r * scale;
    return 255.0 * texture2D(searchTex, e, 0.0).r;
}

float SMAASearchXLeft(sampler2D edgesTex, sampler2D searchTex, vec2 texCoord, float end) {
    /**
     * @PSEUDO_GATHER4
     * This texCoord has been offset by (-0.25, -0.125) in the vertex shader to
     * sample between edge, thus fetching four edges in a row.
     * Sampling with different offsets in each direction allows to disambiguate
     * which edges are active from the four fetched ones.
     */
    vec2 e = vec2(0.0, 1.0);

    for (int i = 0; i < dMaxSearchSteps; i++) { // WebGL port note: Changed while to for
        e = texture2D( edgesTex, texCoord, 0.0).rg;
        texCoord -= vec2(2.0, 0.0) * uTexSizeInv;
        if (!(texCoord.x > end && e.g > 0.8281 && e.r == 0.0)) break;
    }

    // We correct the previous (-0.25, -0.125) offset we applied:
    texCoord.x += 0.25 * uTexSizeInv.x;

    // The searches are bias by 1, so adjust the coords accordingly:
    texCoord.x += uTexSizeInv.x;

    // Disambiguate the length added by the last step:
    texCoord.x += 2.0 * uTexSizeInv.x; // Undo last step
    texCoord.x -= uTexSizeInv.x * SMAASearchLength(searchTex, e, 0.0, 0.5);

    return texCoord.x;
}

float SMAASearchXRight(sampler2D edgesTex, sampler2D searchTex, vec2 texCoord, float end) {
    vec2 e = vec2( 0.0, 1.0 );

    for (int i = 0; i < dMaxSearchSteps; i++) { // WebGL port note: Changed while to for
        e = texture2D(edgesTex, texCoord, 0.0).rg;
        texCoord += vec2(2.0, 0.0) * uTexSizeInv;
        if (!(texCoord.x < end && e.g > 0.8281 && e.r == 0.0)) break;
    }

    texCoord.x -= 0.25 * uTexSizeInv.x;
    texCoord.x -= uTexSizeInv.x;
    texCoord.x -= 2.0 * uTexSizeInv.x;
    texCoord.x += uTexSizeInv.x * SMAASearchLength( searchTex, e, 0.5, 0.5 );

    return texCoord.x;
}

float SMAASearchYUp(sampler2D edgesTex, sampler2D searchTex, vec2 texCoord, float end) {
    vec2 e = vec2( 1.0, 0.0 );

    for (int i = 0; i < dMaxSearchSteps; i++) { // WebGL port note: Changed while to for
        e = texture2D(edgesTex, texCoord, 0.0).rg;
        texCoord += vec2(0.0, 2.0) * uTexSizeInv; // WebGL port note: Changed sign
        if (!(texCoord.y > end && e.r > 0.8281 && e.g == 0.0)) break;
    }

    texCoord.y -= 0.25 * uTexSizeInv.y; // WebGL port note: Changed sign
    texCoord.y -= uTexSizeInv.y; // WebGL port note: Changed sign
    texCoord.y -= 2.0 * uTexSizeInv.y; // WebGL port note: Changed sign
    texCoord.y += uTexSizeInv.y * SMAASearchLength(searchTex, e.gr, 0.0, 0.5); // WebGL port note: Changed sign

    return texCoord.y;
}

float SMAASearchYDown(sampler2D edgesTex, sampler2D searchTex, vec2 texCoord, float end) {
    vec2 e = vec2( 1.0, 0.0 );

    for (int i = 0; i < dMaxSearchSteps; i++) { // WebGL port note: Changed while to for
        e = texture2D(edgesTex, texCoord, 0.0).rg;
        texCoord -= vec2( 0.0, 2.0 ) * uTexSizeInv; // WebGL port note: Changed sign
        if (!(texCoord.y < end && e.r > 0.8281 && e.g == 0.0)) break;
    }

    texCoord.y += 0.25 * uTexSizeInv.y; // WebGL port note: Changed sign
    texCoord.y += uTexSizeInv.y; // WebGL port note: Changed sign
    texCoord.y += 2.0 * uTexSizeInv.y; // WebGL port note: Changed sign
    texCoord.y -= uTexSizeInv.y * SMAASearchLength(searchTex, e.gr, 0.5, 0.5); // WebGL port note: Changed sign

    return texCoord.y;
}

vec2 SMAAArea(sampler2D areaTex, vec2 dist, float e1, float e2, float offset) {
    // Rounding prevents precision errors of bilinear filtering:
    vec2 texCoord = float(SMAA_AREATEX_MAX_DISTANCE) * round(4.0 * vec2(e1, e2)) + dist;

    // We do a scale and bias for mapping to texel space:
    texCoord = SMAA_AREATEX_PIXEL_SIZE * texCoord + (0.5 * SMAA_AREATEX_PIXEL_SIZE);

    // Move to proper place, according to the subpixel offset:
    texCoord.y += SMAA_AREATEX_SUBTEX_SIZE * offset;

    return texture2D(areaTex, texCoord, 0.0).rg;
}

vec4 SMAABlendingWeightCalculationPS(vec2 texCoord, vec2 pixCoord, vec4 offset[3], sampler2D edgesTex, sampler2D areaTex, sampler2D searchTex, ivec4 subsampleIndices) {
    vec4 weights = vec4(0.0, 0.0, 0.0, 0.0);

    vec2 e = texture2D(edgesTex, texCoord).rg;

    if (e.g > 0.0) { // Edge at north
        vec2 d;

        // Find the distance to the left:
        vec2 coords;
        coords.x = SMAASearchXLeft(edgesTex, searchTex, offset[0].xy, offset[2].x );
        coords.y = offset[1].y; // offset[1].y = texCoord.y - 0.25 * uTexSizeInv.y (@CROSSING_OFFSET)
        d.x = coords.x;

        // Now fetch the left crossing edges, two at a time using bilinear
        // filtering. Sampling at -0.25 (see @CROSSING_OFFSET) enables to
        // discern what value each edge has:
        float e1 = texture2D(edgesTex, coords, 0.0).r;

        // Find the distance to the right:
        coords.x = SMAASearchXRight(edgesTex, searchTex, offset[0].zw, offset[2].y);
        d.y = coords.x;

        // We want the distances to be in pixel units (doing this here allow to
        // better interleave arithmetic and memory accesses):
        d = d / uTexSizeInv.x - pixCoord.x;

        // SMAAArea below needs a sqrt, as the areas texture is compressed
        // quadratically:
        vec2 sqrt_d = sqrt(abs(d));

        // Fetch the right crossing edges:
        coords.y -= 1.0 * uTexSizeInv.y; // WebGL port note: Added
        float e2 = SMAASampleLevelZeroOffset(edgesTex, coords, ivec2(1, 0)).r;

        // Ok, we know how this pattern looks like, now it is time for getting
        // the actual area:
        weights.rg = SMAAArea(areaTex, sqrt_d, e1, e2, float(subsampleIndices.y));
    }

    if (e.r > 0.0) { // Edge at west
        vec2 d;

        // Find the distance to the top:
        vec2 coords;

        coords.y = SMAASearchYUp(edgesTex, searchTex, offset[1].xy, offset[2].z );
        coords.x = offset[0].x; // offset[1].x = texCoord.x - 0.25 * uTexSizeInv.x;
        d.x = coords.y;

        // Fetch the top crossing edges:
        float e1 = texture2D(edgesTex, coords, 0.0).g;

        // Find the distance to the bottom:
        coords.y = SMAASearchYDown(edgesTex, searchTex, offset[1].zw, offset[2].w);
        d.y = coords.y;

        // We want the distances to be in pixel units:
        d = d / uTexSizeInv.y - pixCoord.y;

        // SMAAArea below needs a sqrt, as the areas texture is compressed
        // quadratically:
        vec2 sqrt_d = sqrt(abs(d));

        // Fetch the bottom crossing edges:
        coords.y -= 1.0 * uTexSizeInv.y; // WebGL port note: Added
        float e2 = SMAASampleLevelZeroOffset(edgesTex, coords, ivec2(0, 1)).g;

        // Get the area for this direction:
        weights.ba = SMAAArea(areaTex, sqrt_d, e1, e2, float(subsampleIndices.x));
    }

    return weights;
}

void main() {
    gl_FragColor = SMAABlendingWeightCalculationPS(vUv, vPixCoord, vOffset, tEdges, tArea, tSearch, ivec4(0.0));
}
`,T$e=`
precision highp float;

attribute vec2 aPosition;
uniform vec2 uQuadScale;

uniform vec2 uTexSizeInv;
uniform vec4 uViewport;

varying vec2 vUv;
varying vec4 vOffset[3];

void SMAAEdgeDetectionVS(vec2 texCoord) {
    vOffset[0] = texCoord.xyxy + uTexSizeInv.xyxy * vec4(-1.0, 0.0, 0.0, 1.0); // WebGL port note: Changed sign in W component
    vOffset[1] = texCoord.xyxy + uTexSizeInv.xyxy * vec4(1.0, 0.0, 0.0, -1.0); // WebGL port note: Changed sign in W component
    vOffset[2] = texCoord.xyxy + uTexSizeInv.xyxy * vec4(-2.0, 0.0, 0.0, 2.0); // WebGL port note: Changed sign in W component
}

void main() {
    vec2 scale = uViewport.zw * uTexSizeInv;
    vec2 shift = uViewport.xy * uTexSizeInv;
    vUv = (aPosition + 1.0) * 0.5 * scale + shift;
    SMAAEdgeDetectionVS(vUv);
    vec2 position = aPosition * uQuadScale - vec2(1.0, 1.0) + uQuadScale;
    gl_Position = vec4(position, 0.0, 1.0);
}
`,I$e=`
precision highp float;
precision highp int;
precision highp sampler2D;

uniform sampler2D tColor;
uniform vec2 uTexSizeInv;

varying vec2 vUv;
varying vec4 vOffset[3];

vec4 SMAAColorEdgeDetectionPS(vec2 texcoord, vec4 offset[3], sampler2D colorTex) {
    vec2 threshold = vec2(dEdgeThreshold, dEdgeThreshold);

    // Calculate color deltas:
    vec4 delta;
    vec3 C = texture2D(colorTex, texcoord).rgb;

    vec3 Cleft = texture2D(colorTex, offset[0].xy).rgb;
    vec3 t = abs(C - Cleft);
    delta.x = max(max(t.r, t.g), t.b);

    vec3 Ctop = texture2D(colorTex, offset[0].zw).rgb;
    t = abs(C - Ctop);
    delta.y = max(max(t.r, t.g), t.b);

    // We do the usual threshold:
    vec2 edges = step(threshold, delta.xy);

    // Then discard if there is no edge:
    if (dot(edges, vec2(1.0, 1.0 )) == 0.0)
        discard;

    // Calculate right and bottom deltas:
    vec3 Cright = texture2D(colorTex, offset[1].xy).rgb;
    t = abs( C - Cright );
    delta.z = max(max(t.r, t.g), t.b);

    vec3 Cbottom  = texture2D(colorTex, offset[1].zw).rgb;
    t = abs(C - Cbottom);
    delta.w = max(max(t.r, t.g), t.b);

    // Calculate the maximum delta in the direct neighborhood:
    float maxDelta = max(max(max(delta.x, delta.y), delta.z), delta.w );

    // Calculate left-left and top-top deltas:
    vec3 Cleftleft  = texture2D(colorTex, offset[2].xy).rgb;
    t = abs( C - Cleftleft );
    delta.z = max(max(t.r, t.g), t.b);

    vec3 Ctoptop = texture2D(colorTex, offset[2].zw).rgb;
    t = abs(C - Ctoptop);
    delta.w = max(max(t.r, t.g), t.b);

    // Calculate the final maximum delta:
    maxDelta = max(max(maxDelta, delta.z), delta.w);

    // Local contrast adaptation in action:
    edges.xy *= step(0.5 * maxDelta, delta.xy);

    return vec4(edges, 0.0, 0.0);
}

void main() {
    gl_FragColor = SMAAColorEdgeDetectionPS(vUv, vOffset, tColor);
}
`,M$e={edgeThreshold:I.Numeric(.1,{min:.05,max:.15,step:.01}),maxSearchSteps:I.Numeric(16,{min:0,max:32,step:1})},D$e=function(){function e(t,r){if(this.webgl=t,this._supported=!1,typeof HTMLImageElement>"u"){Mr&&console.log('Missing "HTMLImageElement" required for "SMAA"');return}var n=r.getWidth(),i=r.getHeight();this.edgesTarget=t.createRenderTarget(n,i,!1,"uint8","linear"),this.weightsTarget=t.createRenderTarget(n,i,!1,"uint8","linear"),this.edgesRenderable=O$e(t,r),this.weightsRenderable=F$e(t,this.edgesTarget.texture),this.blendRenderable=j$e(t,r,this.weightsTarget.texture),this._supported=!0}return Object.defineProperty(e.prototype,"supported",{get:function(){return this._supported},enumerable:!1,configurable:!0}),e.prototype.updateState=function(t){var r=this.webgl,n=r.gl,i=r.state;i.enable(n.SCISSOR_TEST),i.disable(n.BLEND),i.disable(n.DEPTH_TEST),i.depthMask(!1);var a=t.x,o=t.y,s=t.width,u=t.height;n.viewport(a,o,s,u),n.scissor(a,o,s,u),i.clearColor(0,0,0,1),n.clear(n.COLOR_BUFFER_BIT),N.update(this.edgesRenderable.values.uViewport,zi.toVec4(this.edgesRenderable.values.uViewport.ref.value,t)),N.update(this.weightsRenderable.values.uViewport,zi.toVec4(this.weightsRenderable.values.uViewport.ref.value,t)),N.update(this.blendRenderable.values.uViewport,zi.toVec4(this.blendRenderable.values.uViewport.ref.value,t))},e.prototype.setSize=function(t,r){var n=this.edgesTarget.getWidth(),i=this.edgesTarget.getHeight();(t!==n||r!==i)&&(this.edgesTarget.setSize(t,r),this.weightsTarget.setSize(t,r),N.update(this.edgesRenderable.values.uTexSizeInv,He.set(this.edgesRenderable.values.uTexSizeInv.ref.value,1/t,1/r)),N.update(this.weightsRenderable.values.uTexSizeInv,He.set(this.weightsRenderable.values.uTexSizeInv.ref.value,1/t,1/r)),N.update(this.blendRenderable.values.uTexSizeInv,He.set(this.blendRenderable.values.uTexSizeInv.ref.value,1/t,1/r)))},e.prototype.update=function(t,r){var n=!1;this.edgesRenderable.values.tColor.ref.value!==t&&(N.update(this.edgesRenderable.values.tColor,t),n=!0),this.edgesRenderable.values.dEdgeThreshold.ref.value!==r.edgeThreshold&&(N.update(this.edgesRenderable.values.dEdgeThreshold,r.edgeThreshold),n=!0),n&&this.edgesRenderable.update(),this.weightsRenderable.values.dMaxSearchSteps.ref.value!==r.maxSearchSteps&&(N.update(this.weightsRenderable.values.dMaxSearchSteps,r.maxSearchSteps),this.weightsRenderable.update()),this.blendRenderable.values.tColor.ref.value!==t&&(N.update(this.blendRenderable.values.tColor,t),this.blendRenderable.update())},e.prototype.render=function(t,r){this.edgesTarget.bind(),this.updateState(t),this.edgesRenderable.render(),this.weightsTarget.bind(),this.updateState(t),this.weightsRenderable.render(),r?r.bind():this.webgl.unbindFramebuffer(),this.updateState(t),this.blendRenderable.render()},e}(),R$e=E(E({},va),{tColor:ur("texture","rgba","ubyte","linear"),uTexSizeInv:Ge("v2"),uViewport:Ge("v4"),dEdgeThreshold:Qt("number")}),k$e=Mn("smaa-edges",T$e,I$e);function O$e(e,t){var r=t.getWidth(),n=t.getHeight(),i=E(E({},ma),{tColor:N.create(t),uTexSizeInv:N.create(He.create(1/r,1/n)),uViewport:N.create(_r()),dEdgeThreshold:N.create(.1)}),a=E({},R$e),o=Wi(e,"triangles",k$e,a,i);return qi(o,i)}var L$e=E(E({},va),{tEdges:ur("texture","rgba","ubyte","linear"),tArea:ur("texture","rgb","ubyte","linear"),tSearch:ur("texture","rgba","ubyte","nearest"),uTexSizeInv:Ge("v2"),uViewport:Ge("v4"),dMaxSearchSteps:Qt("number")}),N$e=Mn("smaa-weights",A$e,P$e);function F$e(e,t){var r=t.getWidth(),n=t.getHeight(),i=h5(e.gl,e.extensions,"image-uint8","rgb","ubyte","linear"),a=h5(e.gl,e.extensions,"image-uint8","rgba","ubyte","nearest"),o=E(E({},ma),{tEdges:N.create(t),tArea:N.create(i),tSearch:N.create(a),uTexSizeInv:N.create(He.create(1/r,1/n)),uViewport:N.create(_r()),dMaxSearchSteps:N.create(8)});vU(z$e(),o.tArea,i),vU(V$e(),o.tSearch,a);var s=E({},L$e),u=Wi(e,"triangles",N$e,s,o);return qi(u,o)}var B$e=E(E({},va),{tColor:ur("texture","rgba","ubyte","linear"),tWeights:ur("texture","rgba","ubyte","linear"),uTexSizeInv:Ge("v2"),uViewport:Ge("v4")}),U$e=Mn("smaa-blend",w$e,E$e);function j$e(e,t,r){var n=t.getWidth(),i=t.getHeight(),a=E(E({},ma),{tColor:N.create(t),tWeights:N.create(r),uTexSizeInv:N.create(He.create(1/n,1/i)),uViewport:N.create(_r())}),o=E({},B$e),s=Wi(e,"triangles",U$e,o,a);return qi(s,a)}function z$e(){return"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAKAAAAIwCAIAAACOVPcQAACBeklEQVR42u39W4xlWXrnh/3WWvuciIzMrKxrV8/0rWbY0+SQFKcb4owIkSIFCjY9AC1BT/LYBozRi+EX+cV+8IMsYAaCwRcBwjzMiw2jAWtgwC8WR5Q8mDFHZLNHTarZGrLJJllt1W2qKrsumZWZcTvn7L3W54e1vrXX3vuciLPPORFR1XE2EomorB0nVuz//r71re/y/1eMvb4Cb3N11xV/PP/2v4UBAwJG/7H8urx6/25/Gf8O5hypMQ0EEEQwAqLfoN/Z+97f/SW+/NvcgQk4sGBJK6H7N4PFVL+K+e0N11yNfkKvwUdwdlUAXPHHL38oa15f/i/46Ih6SuMSPmLAYAwyRKn7dfMGH97jaMFBYCJUgotIC2YAdu+LyW9vvubxAP8kAL8H/koAuOKP3+q6+xGnd5kdYCeECnGIJViwGJMAkQKfDvB3WZxjLKGh8VSCCzhwEWBpMc5/kBbjawT4HnwJfhr+pPBIu7uu+OOTo9vsmtQcniMBGkKFd4jDWMSCRUpLjJYNJkM+IRzQ+PQvIeAMTrBS2LEiaiR9b/5PuT6Ap/AcfAFO4Y3dA3DFH7/VS+M8k4baEAQfMI4QfbVDDGIRg7GKaIY52qAjTAgTvGBAPGIIghOCYAUrGFNgzA7Q3QhgCwfwAnwe5vDejgG44o/fbm1C5ZlYQvQDARPAIQGxCWBM+wWl37ZQESb4gImexGMDouhGLx1Cst0Saa4b4AqO4Hk4gxo+3DHAV/nx27p3JziPM2pVgoiia5MdEzCGULprIN7gEEeQ5IQxEBBBQnxhsDb5auGmAAYcHMA9eAAz8PBol8/xij9+C4Djlim4gJjWcwZBhCBgMIIYxGAVIkH3ZtcBuLdtRFMWsPGoY9rN+HoBji9VBYdwD2ZQg4cnO7OSq/z4rU5KKdwVbFAjNojCQzTlCLPFSxtamwh2jMUcEgg2Wm/6XgErIBhBckQtGN3CzbVacERgCnfgLswhnvqf7QyAq/z4rRZm1YglYE3affGITaZsdIe2FmMIpnOCap25I6jt2kCwCW0D1uAD9sZctNGXcQIHCkINDQgc78aCr+zjtw3BU/ijdpw3zhCwcaONwBvdeS2YZKkJNJsMPf2JKEvC28RXxxI0ASJyzQCjCEQrO4Q7sFArEzjZhaFc4cdv+/JFdKULM4px0DfUBI2hIsy06BqLhGTQEVdbfAIZXYMPesq6VoCHICzUyjwInO4Y411//LYLs6TDa9wvg2CC2rElgAnpTBziThxaL22MYhzfkghz6GAs2VHbbdM91VZu1MEEpupMMwKyVTb5ij9+u4VJG/5EgEMMmFF01cFai3isRbKbzb+YaU/MQbAm2XSMoUPAmvZzbuKYRIFApbtlrfFuUGd6vq2hXNnH78ZLh/iFhsQG3T4D1ib7k5CC6vY0DCbtrohgLEIClXiGtl10zc0CnEGIhhatLBva7NP58Tvw0qE8yWhARLQ8h4+AhQSP+I4F5xoU+VilGRJs6wnS7ruti/4KvAY/CfdgqjsMy4pf8fodQO8/gnuX3f/3xi3om1/h7THr+co3x93PP9+FBUfbNUjcjEmhcrkT+8K7ml7V10Jo05mpIEFy1NmCJWx9SIKKt+EjAL4Ez8EBVOB6havuT/rByPvHXK+9zUcfcbb254+9fydJknYnRr1oGfdaiAgpxu1Rx/Rek8KISftx3L+DfsLWAANn8Hvw0/AFeAGO9DFV3c6D+CcWbL8Dj9e7f+T1k8AZv/d7+PXWM/Z+VvdCrIvuAKO09RpEEQJM0Ci6+B4xhTWr4cZNOvhktabw0ta0rSJmqz3Yw5/AKXwenod7cAhTmBSPKf6JBdvH8IP17h95pXqw50/+BFnj88fev4NchyaK47OPhhtI8RFSvAfDSNh0Ck0p2gLxGkib5NJj/JWCr90EWQJvwBzO4AHcgztwAFN1evHPUVGwfXON+0debT1YeGON9Yy9/63X+OguiwmhIhQhD7l4sMqlG3D86Suc3qWZ4rWjI1X7u0Ytw6x3rIMeIOPDprfe2XzNgyj6PahhBjO4C3e6puDgXrdg+/5l948vF3bqwZetZ+z9Rx9zdIY5pInPK4Nk0t+l52xdK2B45Qd87nM8fsD5EfUhIcJcERw4RdqqH7Yde5V7m1vhNmtedkz6EDzUMF/2jJYWbC+4fzzA/Y+/8PPH3j9dcBAPIRP8JLXd5BpAu03aziOL3VVHZzz3CXWDPWd+SH2AnxIqQoTZpo9Ckc6HIrFbAbzNmlcg8Ag8NFDDAhbJvTBZXbC94P7t68EXfv6o+21gUtPETU7bbkLxvNKRFG2+KXzvtObonPP4rBvsgmaKj404DlshFole1Glfh02fE7bYR7dZ82oTewIBGn1Md6CG6YUF26X376oevOLzx95vhUmgblI6LBZwTCDY7vMq0op5WVXgsObOXJ+1x3qaBl9j1FeLxbhU9w1F+Wiba6s1X/TBz1LnUfuYDi4r2C69f1f14BWfP+p+W2GFKuC9phcELMYRRLur9DEZTUdEH+iEqWdaM7X4WOoPGI+ZYD2+wcQ+y+ioHUZ9dTDbArzxmi/bJI9BND0Ynd6lBdve/butBw8+f/T9D3ABa3AG8W3VPX4hBin+bj8dMMmSpp5pg7fJ6xrBFE2WQQEWnV8Qg3FbAWzYfM1rREEnmvkN2o1+acG2d/9u68GDzx91v3mAjb1zkpqT21OipPKO0b9TO5W0nTdOmAQm0TObts3aBKgwARtoPDiCT0gHgwnbArzxmtcLc08HgF1asN0C4Ms/fvD5I+7PhfqyXE/b7RbbrGyRQRT9ARZcwAUmgdoz0ehJ9Fn7QAhUjhDAQSw0bV3T3WbNa59jzmiP6GsWbGXDX2ytjy8+f9T97fiBPq9YeLdBmyuizZHaqXITnXiMUEEVcJ7K4j3BFPurtB4bixW8wTpweL8DC95szWMOqucFYGsWbGU7p3TxxxefP+r+oTVktxY0v5hbq3KiOKYnY8ddJVSBxuMMVffNbxwIOERShst73HZ78DZrHpmJmH3K6sGz0fe3UUj0eyRrSCGTTc+rjVNoGzNSv05srAxUBh8IhqChiQgVNIIBH3AVPnrsnXQZbLTm8ammv8eVXn/vWpaTem5IXRlt+U/LA21zhSb9cye6jcOfCnOwhIAYXAMVTUNV0QhVha9xjgA27ODJbLbmitt3tRN80lqG6N/khgot4ZVlOyO4WNg3OIMzhIZQpUEHieg2im6F91hB3I2tubql6BYNN9Hj5S7G0G2tahslBWKDnOiIvuAEDzakDQKDNFQT6gbn8E2y4BBubM230YIpBnDbMa+y3dx0n1S0BtuG62lCCXwcY0F72T1VRR3t2ONcsmDjbmzNt9RFs2LO2hQNyb022JisaI8rAWuw4HI3FuAIhZdOGIcdjLJvvObqlpqvWTJnnQbyi/1M9O8UxWhBs//H42I0q1Yb/XPGONzcmm+ri172mHKvZBpHkJaNJz6v9jxqiklDj3U4CA2ugpAaYMWqNXsdXbmJNd9egCnJEsphXNM+MnK3m0FCJ5S1kmJpa3DgPVbnQnPGWIDspW9ozbcO4K/9LkfaQO2KHuqlfFXSbdNzcEcwoqNEFE9zcIXu9/6n/ym/BC/C3aJLzEKPuYVlbFnfhZ8kcWxV3dbv4bKl28566wD+8C53aw49lTABp9PWbsB+knfc/Li3eVizf5vv/xmvnPKg5ihwKEwlrcHqucuVcVOxEv8aH37E3ZqpZypUulrHEtIWKUr+txHg+ojZDGlwnqmkGlzcVi1dLiNSJiHjfbRNOPwKpx9TVdTn3K05DBx4psIk4Ei8aCkJahRgffk4YnEXe07T4H2RR1u27E6wfQsBDofUgjFUFnwC2AiVtA+05J2zpiDK2Oa0c5fmAecN1iJzmpqFZxqYBCYhFTCsUNEmUnIcZ6aEA5rQVhEywG6w7HSW02XfOoBlQmjwulOFQAg66SvJblrTEX1YtJ3uG15T/BH1OfOQeuR8g/c0gdpT5fx2SKbs9EfHTKdM8A1GaJRHLVIwhcGyydZsbifAFVKl5EMKNU2Hryo+06BeTgqnxzYjThVySDikbtJPieco75lYfKAJOMEZBTjoITuWHXXZVhcUDIS2hpiXHV9Ku4u44bN5OYLDOkJo8w+xJSMbhBRHEdEs9JZUCkQrPMAvaHyLkxgkEHxiNkx/x2YB0mGsQ8EUWj/stW5YLhtS5SMu+/YBbNPDCkGTUybN8krRLBGPlZkVOA0j+a1+rkyQKWGaPHPLZOkJhioQYnVZ2hS3zVxMtgC46KuRwbJNd9nV2PHgb36F194ecf/Yeu2vAFe5nm/bRBFrnY4BauE8ERmZRFUn0k8hbftiVYSKMEme2dJCJSCGYAlNqh87bXOPdUkGy24P6d1ll21MBqqx48Fvv8ZHH8HZFY7j/uAq1xMJUFqCSUlJPmNbIiNsmwuMs/q9CMtsZsFO6SprzCS1Z7QL8xCQClEelpjTduDMsmWD8S1PT152BtvmIGvUeDA/yRn83u/x0/4qxoPHjx+PXY9pqX9bgMvh/Nz9kpP4pOe1/fYf3axUiMdHLlPpZCNjgtNFAhcHEDxTumNONhHrBduW+vOyY++70WWnPXj98eA4kOt/mj/5E05l9+O4o8ePx67HFqyC+qSSnyselqjZGaVK2TadbFLPWAQ4NBhHqDCCV7OTpo34AlSSylPtIdd2AJZlyzYQrDJ5lcWGNceD80CunPLGGzsfD+7wRb95NevJI5docQ3tgCyr5bGnyaPRlmwNsFELViOOx9loebGNq2moDOKpHLVP5al2cymWHbkfzGXL7kfRl44H9wZy33tvt+PB/Xnf93e+nh5ZlU18wCiRUa9m7kib9LYuOk+hudQNbxwm0AQqbfloimaB2lM5fChex+ylMwuTbfmXQtmWlenZljbdXTLuOxjI/fDDHY4Hjx8/Hrse0zXfPFxbUN1kKqSCCSk50m0Ajtx3ub9XHBKHXESb8iO6E+qGytF4nO0OG3SXzbJlhxBnKtKyl0NwybjvYCD30aMdjgePHz8eu56SVTBbgxJMliQ3Oauwg0QHxXE2Ez/EIReLdQj42Gzb4CLS0YJD9xUx7bsi0vJi5mUbW1QzL0h0PFk17rtiIPfJk52MB48fPx67npJJwyrBa2RCCQRTbGZSPCxTPOiND4G2pYyOQ4h4jINIJh5wFU1NFZt+IsZ59LSnDqBjZ2awbOku+yInunLcd8VA7rNnOxkPHj9+PGY9B0MWJJNozOJmlglvDMXDEozdhQWbgs/U6oBanGzLrdSNNnZFjOkmbi5bNt1lX7JLLhn3vXAg9/h4y/Hg8ePHI9dzQMEkWCgdRfYykYKnkP7D4rIujsujaKPBsB54vE2TS00ccvFY/Tth7JXeq1hz+qgVy04sAJawTsvOknHfCwdyT062HA8eP348Zj0vdoXF4pilKa2BROed+9fyw9rWRXeTFXESMOanvDZfJuJaSXouQdMdDJZtekZcLLvEeK04d8m474UDuaenW44Hjx8/Xns9YYqZpszGWB3AN/4VHw+k7WSFtJ3Qicuqb/NlVmgXWsxh570xg2UwxUw3WfO6B5nOuO8aA7lnZxuPB48fPx6znm1i4bsfcbaptF3zNT78eFPtwi1OaCNOqp1x3zUGcs/PN++AGD1+fMXrSVm2baTtPhPahbPhA71wIHd2bXzRa69nG+3CraTtPivahV/55tXWg8fyRY/9AdsY8VbSdp8V7cKrrgdfM//z6ILQFtJ2nxHtwmuoB4/kf74+gLeRtvvMaBdeSz34+vifx0YG20jbfTa0C6+tHrwe//NmOG0L8EbSdp8R7cLrrQe/996O+ai3ujQOskpTNULa7jOjXXj99eCd8lHvoFiwsbTdZ0a78PrrwTvlo966pLuRtB2fFe3Cm6oHP9kNH/W2FryxtN1nTLvwRurBO+Kj3pWXHidtx2dFu/Bm68Fb81HvykuPlrb7LGkX3mw9eGs+6h1Y8MbSdjegXcguQLjmevDpTQLMxtJ2N6NdyBZu9AbrwVvwUW+LbteULUpCdqm0HTelXbhNPe8G68Gb8lFvVfYfSNuxvrTdTWoXbozAzdaDZzfkorOj1oxVxlIMlpSIlpLrt8D4hrQL17z+c3h6hU/wv4Q/utps4+bm+6P/hIcf0JwQ5oQGPBL0eKPTYEXTW+eL/2DKn73J9BTXYANG57hz1cEMviVf/4tf5b/6C5pTQkMIWoAq7hTpOJjtAM4pxKu5vg5vXeUrtI09/Mo/5H+4z+Mp5xULh7cEm2QbRP2tFIKR7WM3fPf/jZ3SWCqLM2l4NxID5zB72HQXv3jj/8mLR5xXNA5v8EbFQEz7PpRfl1+MB/hlAN65qgDn3wTgH13hK7T59bmP+NIx1SHHU84nLOITt3iVz8mNO+lPrjGAnBFqmioNn1mTyk1ta47R6d4MrX7tjrnjYUpdUbv2rVr6YpVfsGG58AG8Ah9eyUN8CX4WfgV+G8LVWPDGb+Zd4cU584CtqSbMKxauxTg+dyn/LkVgA+IR8KHtejeFKRtTmLLpxN6mYVLjYxwXf5x2VofiZcp/lwKk4wGOpYDnoIZPdg/AAbwMfx0+ge9dgZvYjuqKe4HnGnykYo5TvJbG0Vj12JagRhwKa44H95ShkZa5RyLGGdfYvG7aw1TsF6iapPAS29mNS3NmsTQZCmgTzFwgL3upCTgtBTRwvGMAKrgLn4evwin8+afJRcff+8izUGUM63GOOuAs3tJkw7J4kyoNreqrpO6cYLQeFUd7TTpr5YOTLc9RUUogUOVJQ1GYJaFLAW0oTmKyYS46ZooP4S4EON3xQ5zC8/CX4CnM4c1PE8ApexpoYuzqlP3d4S3OJP8ZDK7cKWNaTlqmgDiiHwl1YsE41w1zT4iRTm3DBqxvOUsbMKKDa/EHxagtnta072ejc3DOIh5ojvh8l3tk1JF/AV6FU6jh3U8HwEazLgdCLYSQ+MYiAI2ltomkzttUb0gGHdSUUgsIYjTzLG3mObX4FBRaYtpDVNZrih9TgTeYOBxsEnN1gOCTM8Bsw/ieMc75w9kuAT6A+/AiHGvN/+Gn4KRkiuzpNNDYhDGFndWRpE6SVfm8U5bxnSgVV2jrg6JCKmneqey8VMFgq2+AM/i4L4RUbfSi27lNXZ7R7W9RTcq/q9fk4Xw3AMQd4I5ifAZz8FcVtm9SAom/dyN4lczJQW/kC42ZrHgcCoIf1oVMKkVItmMBi9cOeNHGLqOZk+QqQmrbc5YmYgxELUUN35z2iohstgfLIFmcMV7s4CFmI74L9+EFmGsi+tGnAOD4Yk9gIpo01Y4cA43BWGygMdr4YZekG3OBIUXXNukvJS8tqa06e+lSDCtnqqMFu6hWHXCF+WaYt64m9QBmNxi7Ioy7D+fa1yHw+FMAcPt7SysFLtoG4PXAk7JOA3aAxBRqUiAdU9Yp5lK3HLSRFtOim0sa8euEt08xvKjYjzeJ2GU7YawexrnKI9tmobInjFXCewpwriY9+RR4aaezFhMhGCppKwom0ChrgFlKzyPKkGlTW1YQrE9HJqu8hKGgMc6hVi5QRq0PZxNfrYNgE64utmRv6KKHRpxf6VDUaOvNP5jCEx5q185My/7RKz69UQu2im5k4/eownpxZxNLwiZ1AZTO2ZjWjkU9uaB2HFn6Q3u0JcsSx/qV9hTEApRzeBLDJQXxYmTnq7bdLa3+uqFrxLJ5w1TehnNHx5ECvCh2g2c3hHH5YsfdaSKddztfjQ6imKFGSyFwlLzxEGPp6r5IevVjk1AMx3wMqi1NxDVjLBiPs9tbsCkIY5we5/ML22zrCScFxnNtzsr9Wcc3CnD+pYO+4VXXiDE0oc/vQQ/fDK3oPESJMYXNmJa/DuloJZkcTpcYE8lIH8Dz8DJMiynNC86Mb2lNaaqP/+L7f2fcE/yP7/Lde8xfgSOdMxvOixZf/9p3+M4hT1+F+zApxg9XfUvYjc8qX2lfOOpK2gNRtB4flpFu9FTKCp2XJRgXnX6olp1zyYjTKJSkGmLE2NjUr1bxFM4AeAAHBUFIeSLqXR+NvH/M9fOnfHzOD2vCSyQJKzfgsCh+yi/Mmc35F2fUrw7miW33W9hBD1vpuUojFphIyvg7aTeoymDkIkeW3XLHmguMzbIAJejN6B5MDrhipE2y6SoFRO/AK/AcHHZHNIfiWrEe/C6cr3f/yOvrQKB+zMM55/GQdLDsR+ifr5Fiuu+/y+M78LzOE5dsNuXC3PYvYWd8NXvphLSkJIasrlD2/HOqQ+RjcRdjKTGWYhhVUm4yxlyiGPuMsZR7sMCHUBeTuNWA7if+ifXgc/hovftHXs/DV+Fvwe+f8shzMiMcweFgBly3//vwJfg5AN4450fn1Hd1Rm1aBLu22Dy3y3H2+OqMemkbGZ4jozcDjJf6596xOLpC0eMTHbKnxLxH27uZ/bMTGs2jOaMOY4m87CfQwF0dw53oa1k80JRuz/XgS+8fX3N9Af4qPIMfzKgCp4H5TDGe9GGeFPzSsZz80SlPTxXjgwJmC45njzgt2vbQ4b4OAdUK4/vWhO8d8v6EE8fMUsfakXbPpFJeLs2ubM/qdm/la3WP91uWhxXHjoWhyRUq2iJ/+5mA73zwIIo+LoZ/SgvIRjAd1IMvvn98PfgOvAJfhhm8scAKVWDuaRaK8aQ9f7vuPDH6Bj47ZXau7rqYJ66mTDwEDU6lLbCjCK0qTXyl5mnDoeNRxanj3FJbaksTk0faXxHxLrssgPkWB9LnA/MFleXcJozzjwsUvUG0X/QCve51qkMDXp9mtcyOy3rwBfdvVJK7D6/ACSzg3RoruIq5UDeESfEmVclDxnniU82vxMLtceD0hGZWzBNPMM/jSPne2OVatiTKUpY5vY7gc0LdUAWeWM5tH+O2I66AOWw9xT2BuyRVLGdoDHUsVRXOo/c+ZdRXvFfnxWyIV4upFLCl9eAL7h8Zv0QH8Ry8pA2cHzQpGesctVA37ZtklBTgHjyvdSeKY/RZw/kJMk0Y25cSNRWSigQtlULPTw+kzuJPeYEkXjQRpoGZobYsLF79pyd1dMRHInbgFTZqNLhDqiIsTNpoex2WLcy0/X6rHcdMMQvFSd5dWA++4P7xv89deACnmr36uGlL69bRCL6BSZsS6c0TU2TKK5gtWCzgAOOwQcurqk9j8whvziZSMLcq5hbuwBEsYjopUBkqw1yYBGpLA97SRElEmx5MCInBY5vgLk94iKqSWmhIGmkJ4Bi9m4L645J68LyY4wsFYBfUg5feP/6gWWm58IEmKQM89hq7KsZNaKtP5TxxrUZZVkNmMJtjbKrGxLNEbHPJxhqy7lAmbC32ZqeF6lTaknRWcYaFpfLUBh/rwaQycCCJmW15Kstv6jRHyJFry2C1ahkkIW0LO75s61+owxK1y3XqweX9m5YLM2DPFeOjn/iiqCKJ+yKXF8t5Yl/kNsqaSCryxPq5xWTFIaP8KSW0RYxqupaUf0RcTNSSdJZGcKYdYA6kdtrtmyBckfKXwqk0pHpUHlwWaffjNRBYFPUDWa8e3Lt/o0R0CdisKDM89cX0pvRHEfM8ca4t0s2Xx4kgo91MPQJ/0c9MQYq0co8MBh7bz1fio0UUHLR4aAIOvOmoYO6kwlEVODSSTliWtOtH6sPkrtctF9ZtJ9GIerBskvhdVS5cFNv9s1BU0AbdUgdK4FG+dRnjFmDTzniRMdZO1QhzMK355vigbdkpz9P6qjUGE5J2qAcXmwJ20cZUiAD0z+pGMx6xkzJkmEf40Hr4qZfVg2XzF9YOyoV5BjzVkUJngKf8lgNYwKECEHrCNDrWZzMlflS3yBhr/InyoUgBc/lKT4pxVrrC6g1YwcceK3BmNxZcAtz3j5EIpqguh9H6wc011YN75cKDLpFDxuwkrPQmUwW4KTbj9mZTwBwLq4aQMUZbHm1rylJ46dzR0dua2n3RYCWZsiHROeywyJGR7mXKlpryyCiouY56sFkBWEnkEB/raeh/Sw4162KeuAxMQpEkzy5alMY5wamMsWKKrtW2WpEWNnReZWONKWjrdsKZarpFjqCslq773PLmEhM448Pc3+FKr1+94vv/rfw4tEcu+lKTBe4kZSdijBrykwv9vbCMPcLQTygBjzVckSLPRVGslqdunwJ4oegtFOYb4SwxNgWLCmD7T9kVjTv5YDgpo0XBmN34Z/rEHp0sgyz7lngsrm4lvMm2Mr1zNOJYJ5cuxuQxwMGJq/TP5emlb8fsQBZviK4t8hFL+zbhtlpwaRSxQRWfeETjuauPsdGxsBVdO7nmP4xvzSoT29pRl7kGqz+k26B3Oy0YNV+SXbbQas1ctC/GarskRdFpKczVAF1ZXnLcpaMuzVe6lZ2g/1ndcvOVgRG3sdUAY1bKD6achijMPdMxV4muKVorSpiDHituH7rSTs7n/4y5DhRXo4FVBN4vO/zbAcxhENzGbHCzU/98Mcx5e7a31kWjw9FCe/zNeYyQjZsWb1uc7U33pN4Mji6hCLhivqfa9Ss6xLg031AgfesA/l99m9fgvnaF9JoE6bYKmkGNK3aPbHB96w3+DnxFm4hs0drLsk7U8kf/N/CvwQNtllna0rjq61sH8L80HAuvwH1tvBy2ChqWSCaYTaGN19sTvlfzFD6n+iKTbvtayfrfe9ueWh6GJFoxLdr7V72a5ZpvHcCPDzma0wTO4EgbLyedxstO81n57LYBOBzyfsOhUKsW1J1BB5vr/tz8RyqOFylQP9Tvst2JALsC5lsH8PyQ40DV4ANzYa4dedNiKNR1s+x2wwbR7q4/4cTxqEk4LWDebfisuo36JXLiWFjOtLrlNWh3K1rRS4xvHcDNlFnNmWBBAl5SWaL3oPOfnvbr5pdjVnEaeBJSYjuLEkyLLsWhKccadmOphZkOPgVdalj2QpSmfOsADhMWE2ZBu4+EEJI4wKTAuCoC4xwQbWXBltpxbjkXJtKxxabo9e7tyhlgb6gNlSbUpMh+l/FaqzVwewGu8BW1Zx7pTpQDJUjb8tsUTW6+GDXbMn3mLbXlXJiGdggxFAoUrtPS3wE4Nk02UZG2OOzlk7fRs7i95QCLo3E0jtrjnM7SR3uS1p4qtS2nJ5OwtQVHgOvArLBFijZUV9QtSl8dAY5d0E0hM0w3HS2DpIeB6m/A1+HfhJcGUq4sOxH+x3f5+VO+Ds9rYNI7zPXOYWPrtf8bYMx6fuOAX5jzNR0PdsuON+X1f7EERxMJJoU6GkTEWBvVolVlb5lh3tKCg6Wx1IbaMDdJ+9sUCc5KC46hKGCk3IVOS4TCqdBNfUs7Kd4iXf2RjnT/LLysJy3XDcHLh/vde3x8DoGvwgsa67vBk91G5Pe/HbOe7xwym0NXbtiuuDkGO2IJDh9oQvJ4cY4vdoqLDuoH9Zl2F/ofsekn8lkuhIlhQcffUtSjytFyp++p6NiE7Rqx/lodgKVoceEp/CP4FfjrquZaTtj2AvH5K/ywpn7M34K/SsoYDAdIN448I1/0/wveW289T1/lX5xBzc8N5IaHr0XMOQdHsIkDuJFifj20pBm5jzwUv9e2FhwRsvhAbalCIuIw3bhJihY3p6nTFFIZgiSYjfTf3aXuOjmeGn4bPoGvwl+CFzTRczBIuHBEeImHc37/lGfwZR0cXzVDOvaKfNHvwe+suZ771K/y/XcBlsoN996JpBhoE2toYxOznNEOS5TJc6Id5GEXLjrWo+LEWGNpPDU4WAwsIRROu+1vM+0oW37z/MBN9kqHnSArwPfgFJ7Cq/Ai3Ie7g7ncmI09v8sjzw9mzOAEXoIHxURueaAce5V80f/DOuuZwHM8vsMb5wBzOFWM7wymTXPAEvm4vcFpZ2ut0VZRjkiP2MlmLd6DIpbGSiHOjdnUHN90hRYmhTnmvhzp1iKDNj+b7t5hi79lWGwQ+HN9RsfFMy0FXbEwhfuczKgCbyxYwBmcFhhvo/7a44v+i3XWcwDP86PzpGQYdWh7csP5dBvZ1jNzdxC8pBGuxqSW5vw40nBpj5JhMwvOzN0RWqERHMr4Lv1kWX84xLR830G3j6yqZ1a8UstTlW+qJPOZ+sZ7xZPKTJLhiNOAFd6tk+jrTH31ncLOxid8+nzRb128HhUcru/y0Wn6iT254YPC6FtVSIMoW2sk727AhvTtrWKZTvgsmckfXYZWeNRXx/3YQ2OUxLDrbHtN11IwrgXT6c8dATDwLniYwxzO4RzuQqTKSC5gAofMZ1QBK3zQ4JWobFbcvJm87FK+6JXrKahLn54m3p+McXzzYtP8VF/QpJuh1OwieElEoI1pRxPS09FBrkq2tWCU59+HdhNtTIqKm8EBrw2RTOEDpG3IKo2Y7mFdLm3ZeVjYwVw11o/oznceMve4CgMfNym/utA/d/ILMR7gpXzRy9eDsgLcgbs8O2Va1L0zzIdwGGemTBuwROHeoMShkUc7P+ISY3KH5ZZeWqO8mFTxQYeXTNuzvvK5FGPdQfuu00DwYFY9dyhctEt+OJDdnucfpmyhzUJzfsJjr29l8S0bXBfwRS9ZT26tmMIdZucch5ZboMz3Nio3nIOsYHCGoDT4kUA9MiXEp9Xsui1S8th/kbWIrMBxDGLodWUQIWcvnXy+9M23xPiSMOiRPqM+YMXkUN3gXFrZJwXGzUaMpJfyRS9ZT0lPe8TpScuRlbMHeUmlaKDoNuy62iWNTWNFYjoxFzuJs8oR+RhRx7O4SVNSXpa0ZJQ0K1LAHDQ+D9IepkMXpcsq5EVCvClBUIzDhDoyKwDw1Lc59GbTeORivugw1IcuaEOaGWdNm+Ps5fQ7/tm0DjMegq3yM3vb5j12qUId5UZD2oxDSEWOZMSqFl/W+5oynWDa/aI04tJRQ2eTXusg86SQVu/nwSYwpW6wLjlqIzwLuxGIvoAvul0PS+ZNz0/akp/pniO/8JDnGyaCkzbhl6YcqmK/69prxPqtpx2+Km9al9sjL+rwMgHw4jE/C8/HQ3m1vBuL1fldbzd8mOueVJ92syqdEY4KJjSCde3mcRw2TA6szxedn+zwhZMps0XrqEsiUjnC1hw0TELC2Ek7uAAdzcheXv1BYLagspxpzSAoZZUsIzIq35MnFQ9DOrlNB30jq3L4pkhccKUAA8/ocvN1Rzx9QyOtERs4CVsJRK/DF71kPYrxYsGsm6RMh4cps5g1DOmM54Ly1ii0Hd3Y/BMk8VWFgBVmhqrkJCPBHAolwZaWzLR9Vb7bcWdX9NyUYE+uB2BKfuaeBUcjDljbYVY4DdtsVWvzRZdWnyUzDpjNl1Du3aloAjVJTNDpcIOVVhrHFF66lLfJL1zJr9PQ2nFJSBaKoDe+sAvLufZVHVzYh7W0h/c6AAZ+7Tvj6q9j68G/cTCS/3n1vLKHZwNi+P+pS0WkZNMBMUl+LDLuiE4omZy71r3UFMwNJV+VJ/GC5ixVUkBStsT4gGKh0Gm4Oy3qvq7Lbmq24nPdDuDR9deR11XzP4vFu3TYzfnIyiSVmgizUYGqkIXNdKTY9pgb9D2Ix5t0+NHkVzCdU03suWkkVZAoCONCn0T35gAeW38de43mf97sMOpSvj4aa1KYUm58USI7Wxxes03bAZdRzk6UtbzMaCQ6IxO0dy7X+XsjoD16hpsBeGz9dfzHj+R/Hp8nCxZRqkEDTaCKCSywjiaoMJ1TITE9eg7Jqnq8HL6gDwiZb0u0V0Rr/rmvqjxKuaLCX7ZWXTvAY+uvm3z8CP7nzVpngqrJpZKwWnCUjIviYVlirlGOzPLI3SMVyp/elvBUjjDkNhrtufFFErQ8pmdSlbK16toBHlt/HV8uHMX/vEGALkV3RJREiSlopxwdMXOZPLZ+ix+kAHpMKIk8UtE1ygtquttwxNhphrIZ1IBzjGF3IIGxGcBj6q8bHJBG8T9vdsoWrTFEuebEZuVxhhClH6P5Zo89OG9fwHNjtNQTpD0TG9PJLEYqvEY6Rlxy+ZZGfL0Aj62/bnQCXp//eeM4KzfQVJbgMQbUjlMFIm6TpcfWlZje7NBSV6IsEVmumWIbjiloUzQX9OzYdo8L1wjw2PrrpimONfmfNyzKklrgnEkSzT5QWYQW40YShyzqsRmMXbvVxKtGuYyMKaU1ugenLDm5Ily4iT14fP11Mx+xJv+zZ3MvnfdFqxU3a1W/FTB4m3Qfsyc1XUcdVhDeUDZXSFHHLQj/Y5jtC7ZqM0CXGwB4bP11i3LhOvzPGygYtiUBiwQV/4wFO0majijGsafHyRLu0yG6q35cL1rOpVxr2s5cM2jJYMCdc10Aj6q/blRpWJ//+dmm5psMl0KA2+AFRx9jMe2WbC4jQxnikd4DU8TwUjRVacgdlhmr3bpddzuJ9zXqr2xnxJfzP29RexdtjDVZqzkqa6PyvcojGrfkXiJ8SEtml/nYskicv0ivlxbqjemwUjMw5evdg8fUX9nOiC/lf94Q2i7MURk9nW1MSj5j8eAyV6y5CN2S6qbnw3vdA1Iwq+XOSCl663udN3IzLnrt+us25cI1+Z83SXQUldqQq0b5XOT17bGpLd6ssN1VMPf8c+jG8L3NeCnMdF+Ra3fRa9dft39/LuZ/3vwHoHrqGmQFafmiQw6eyzMxS05K4bL9uA+SKUQzCnSDkqOGokXyJvbgJ/BHI+qvY69//4rl20NsmK2ou2dTsyIALv/91/8n3P2Aao71WFGi8KKv1fRC5+J67Q/507/E/SOshqN5TsmYIjVt+kcjAx98iz/4SaojbIV1rexE7/C29HcYD/DX4a0rBOF5VTu7omsb11L/AWcVlcVZHSsqGuXLLp9ha8I//w3Mv+T4Ew7nTBsmgapoCrNFObIcN4pf/Ob/mrvHTGqqgAupL8qWjWPS9m/31jAe4DjA+4+uCoQoT/zOzlrNd3qd4SdphFxsUvYwGWbTWtISc3wNOWH+kHBMfc6kpmpwPgHWwqaSUG2ZWWheYOGQGaHB+eQ/kn6b3pOgLV+ODSn94wDvr8Bvb70/LLuiPPEr8OGVWfDmr45PZyccEmsVXZGe1pRNX9SU5+AVQkNTIVPCHF/jGmyDC9j4R9LfWcQvfiETmgMMUCMN1uNCakkweZsowdYobiMSlnKA93u7NzTXlSfe+SVbfnPQXmg9LpYAQxpwEtONyEyaueWM4FPjjyjG3uOaFmBTWDNgBXGEiQpsaWhnAqIijB07Dlsy3fUGeP989xbWkyf+FF2SNEtT1E0f4DYYVlxFlbaSMPIRMk/3iMU5pME2SIWJvjckciebkQuIRRyhUvkHg/iUljG5kzVog5hV7vIlCuBrmlhvgPfNHQM8lCf+FEGsYbMIBC0qC9a0uuy2wLXVbLBaP5kjHokCRxapkQyzI4QEcwgYHRZBp+XEFTqXFuNVzMtjXLJgX4gAid24Hjwc4N3dtVSe+NNiwTrzH4WVUOlDobUqr1FuAgYllc8pmzoVrELRHSIW8ViPxNy4xwjBpyR55I6J220qQTZYR4guvUICJiSpr9gFFle4RcF/OMB7BRiX8sSfhpNSO3lvEZCQfLUVTKT78Ek1LRLhWN+yLyTnp8qWUZ46b6vxdRGXfHVqx3eI75YaLa4iNNiK4NOW7wPW6lhbSOF9/M9qw8e/aoB3d156qTzxp8pXx5BKAsYSTOIIiPkp68GmTq7sZtvyzBQaRLNxIZ+paozHWoLFeExIhRBrWitHCAHrCF7/thhD8JhYz84wg93QRV88wLuLY8zF8sQ36qF1J455bOlgnELfshKVxYOXKVuKx0jaj22sczTQqPqtV/XDgpswmGTWWMSDw3ssyUunLLrVPGjYRsH5ggHeHSWiV8kT33ycFSfMgkoOK8apCye0J6VW6GOYvffgU9RWsukEi2kUV2nl4dOYUzRik9p7bcA4ggdJ53LxKcEe17B1R8eqAd7dOepV8sTXf5lhejoL85hUdhDdknPtKHFhljOT+bdq0hxbm35p2nc8+Ja1Iw+tJykgp0EWuAAZYwMVwac5KzYMslhvgHdHRrxKnvhTYcfKsxTxtTETkjHO7rr3zjoV25lAQHrqpV7bTiy2aXMmUhTBnKS91jhtR3GEoF0oLnWhWNnYgtcc4N0FxlcgT7yz3TgNIKkscx9jtV1ZKpWW+Ub1tc1eOv5ucdgpx+FJy9pgbLE7xDyXb/f+hLHVGeitHOi6A7ybo3sF8sS7w7cgdk0nJaOn3hLj3uyD0Zp5pazFIUXUpuTTU18d1EPkDoX8SkmWTnVIozEdbTcZjoqxhNHf1JrSS/AcvHjZ/SMHhL/7i5z+POsTUh/8BvNfYMTA8n+yU/MlTZxSJDRStqvEuLQKWwDctMTQogUDyQRoTQG5Kc6oQRE1yV1jCA7ri7jdZyK0sYTRjCR0Hnnd+y7nHxNgTULqw+8wj0mQKxpYvhjm9uSUxg+TTy7s2GtLUGcywhXSKZN275GsqlclX90J6bRI1aouxmgL7Q0Nen5ziM80SqMIo8cSOo+8XplT/5DHNWsSUr/6lLN/QQ3rDyzLruEW5enpf7KqZoShEduuSFOV7DLX7Ye+GmXb6/hnNNqKsVXuMDFpb9Y9eH3C6NGEzuOuI3gpMH/I6e+zDiH1fXi15t3vA1czsLws0TGEtmPEJdiiFPwlwKbgLHAFk4P6ZyPdymYYHGE0dutsChQBl2JcBFlrEkY/N5bQeXQ18gjunuMfMfsBlxJSx3niO485fwO4fGD5T/+3fPQqkneWVdwnw/3bMPkW9Wbqg+iC765Zk+xcT98ibKZc2EdgHcLoF8cSOo/Oc8fS+OyEULF4g4sJqXVcmfMfsc7A8v1/yfGXmL9I6Fn5pRwZhsPv0TxFNlAfZCvG+Oohi82UC5f/2IsJo0cTOm9YrDoKhFPEUr/LBYTUNht9zelHXDqwfPCIw4owp3mOcIQcLttWXFe3VZ/j5H3cIc0G6oPbCR+6Y2xF2EC5cGUm6wKC5tGEzhsWqw5hNidUiKX5gFWE1GXh4/Qplw4sVzOmx9QxU78g3EF6wnZlEN4FzJ1QPSLEZz1KfXC7vd8ssGdIbNUYpVx4UapyFUHzJoTOo1McSkeNn1M5MDQfs4qQuhhX5vQZFw8suwWTcyYTgioISk2YdmkhehG4PkE7w51inyAGGaU+uCXADabGzJR1fn3lwkty0asIo8cROm9Vy1g0yDxxtPvHDAmpu+PKnM8Ix1wwsGw91YJqhteaWgjYBmmQiebmSpwKKzE19hx7jkzSWOm66oPbzZ8Yj6kxVSpYjVAuvLzYMCRo3oTQecOOjjgi3NQ4l9K5/hOGhNTdcWVOTrlgYNkEXINbpCkBRyqhp+LdRB3g0OU6rMfW2HPCFFMV9nSp+uB2woepdbLBuJQyaw/ZFysXrlXwHxI0b0LovEkiOpXGA1Ijagf+KUNC6rKNa9bQnLFqYNkEnMc1uJrg2u64ELPBHpkgWbmwKpJoDhMwNbbGzAp7Yg31wS2T5rGtzit59PrKhesWG550CZpHEzpv2NGRaxlNjbMqpmEIzygJqQfjypycs2pg2cS2RY9r8HUqkqdEgKTWtWTKoRvOBPDYBltja2SO0RGjy9UHtxwRjA11ujbKF+ti5cIR9eCnxUg6owidtyoU5tK4NLji5Q3HCtiyF2IqLGYsHViOXTXOYxucDqG0HyttqYAKqYo3KTY1ekyDXRAm2AWh9JmsVh/ccg9WJ2E8YjG201sPq5ULxxX8n3XLXuMInbft2mk80rRGjCGctJ8/GFdmEQ9Ug4FlE1ll1Y7jtiraqm5Fe04VV8lvSVBL8hiPrfFVd8+7QH3Qbu2ipTVi8cvSGivc9cj8yvH11YMHdNSERtuOslM97feYFOPKzGcsI4zW0YGAbTAOaxCnxdfiYUmVWslxiIblCeAYr9VYR1gM7GmoPrilunSxxeT3DN/2eBQ9H11+nk1adn6VK71+5+Jfct4/el10/7KBZfNryUunWSCPxPECk1rdOv1WVSrQmpC+Tl46YD3ikQYcpunSQgzVB2VHFhxHVGKDgMEY5GLlQnP7FMDzw7IacAWnO6sBr12u+XanW2AO0wQ8pknnFhsL7KYIqhkEPmEXFkwaN5KQphbkUmG72wgw7WSm9RiL9QT925hkjiVIIhphFS9HKI6/8QAjlpXqg9W2C0apyaVDwKQwrwLY3j6ADR13ZyUNByQXHQu6RY09Hu6zMqXRaNZGS/KEJs0cJEe9VH1QdvBSJv9h09eiRmy0V2uJcqHcShcdvbSNg5fxkenkVprXM9rDVnX24/y9MVtncvbKY706anNl3ASll9a43UiacVquXGhvq4s2FP62NGKfQLIQYu9q1WmdMfmUrDGt8eDS0cXozH/fjmUH6Jruvm50hBDSaEU/2Ru2LEN/dl006TSc/g7tfJERxGMsgDUEr104pfWH9lQaN+M4KWQjwZbVc2rZVNHsyHal23wZtIs2JJqtIc/WLXXRFCpJkfE9jvWlfFbsNQ9pP5ZBS0zKh4R0aMFj1IjTcTnvi0Zz2rt7NdvQb2mgbju1plsH8MmbnEk7KbK0b+wC2iy3aX3szW8xeZvDwET6hWZYwqTXSSG+wMETKum0Dq/q+x62gt2ua2ppAo309TRk9TPazfV3qL9H8z7uhGqGqxNVg/FKx0HBl9OVUORn8Q8Jx9gFttGQUDr3tzcXX9xGgN0EpzN9mdZ3GATtPhL+CjxFDmkeEU6x56kqZRusLzALXVqkCN7zMEcqwjmywDQ6OhyUe0Xao1Qpyncrg6wKp9XfWDsaZplElvQ/b3sdweeghorwBDlHzgk1JmMc/wiERICVy2VJFdMjFuLQSp3S0W3+sngt2njwNgLssFGVQdJ0tu0KH4ky1LW4yrbkuaA6Iy9oz/qEMMXMMDWyIHhsAyFZc2peV9hc7kiKvfULxCl9iddfRK1f8kk9qvbdOoBtOg7ZkOZ5MsGrSHsokgLXUp9y88smniwWyuFSIRVmjplga3yD8Uij5QS1ZiM4U3Qw5QlSm2bXjFe6jzzBFtpg+/YBbLAWG7OPynNjlCw65fukGNdkJRf7yM1fOxVzbxOJVocFoYIaGwH22mIQkrvu1E2nGuebxIgW9U9TSiukPGU+Lt++c3DJPKhyhEEbXCQLUpae2exiKy6tMPe9mDRBFCEMTWrtwxN8qvuGnt6MoihKWS5NSyBhbH8StXoAz8PLOrRgLtOT/+4vcu+7vDLnqNvztOq7fmd8sMmY9Xzn1zj8Dq8+XVdu2Nv0IIySgEdQo3xVHps3Q5i3fLFsV4aiqzAiBhbgMDEd1uh8qZZ+lwhjkgokkOIv4xNJmyncdfUUzgB4oFMBtiu71Xumpz/P+cfUP+SlwFExwWW62r7b+LSPxqxn/gvMZ5z9C16t15UbNlq+jbGJtco7p8wbYlL4alSyfWdeuu0j7JA3JFNuVAwtst7F7FhWBbPFNKIUORndWtLraFLmMu7KFVDDOzqkeaiN33YAW/r76wR4XDN/yN1z7hejPau06EddkS/6XThfcz1fI/4K736fO48vlxt2PXJYFaeUkFS8U15XE3428xdtn2kc8GQlf1vkIaNRRnOMvLTWrZbElEHeLWi1o0dlKPAh1MVgbbVquPJ5+Cr8LU5/H/+I2QlHIU2ClXM9G8v7Rr7oc/hozfUUgsPnb3D+I+7WF8kNO92GY0SNvuxiE+2Bt8prVJTkzE64sfOstxuwfxUUoyk8VjcTlsqe2qITSFoSj6Epd4KsT6BZOWmtgE3hBfir8IzZDwgV4ZTZvD8VvPHERo8v+vL1DASHTz/i9OlKueHDjK5Rnx/JB1Vb1ioXdBra16dmt7dgik10yA/FwJSVY6XjA3oy4SqM2frqDPPSRMex9qs3XQtoWxMj7/Er8GWYsXgjaVz4OYumP2+9kbxvny/6kvWsEBw+fcb5bInc8APdhpOSs01tEqIkoiZjbAqKMruLbJYddHuHFRIyJcbdEdbl2sVLaySygunutBg96Y2/JjKRCdyHV+AEFtTvIpbKIXOamknYSiB6KV/0JetZITgcjjk5ZdaskBtWO86UF0ap6ozGXJk2WNiRUlCPFir66lzdm/SLSuK7EUdPz8f1z29Skq6F1fXg8+5UVR6bszncP4Tn4KUkkdJ8UFCY1zR1i8RmL/qQL3rlei4THG7OODlnKko4oI01kd3CaM08Ia18kC3GNoVaO9iDh+hWxSyTXFABXoau7Q6q9OxYg/OVEMw6jdbtSrJ9cBcewGmaZmg+bvkUnUUaGr+ZfnMH45Ivevl61hMcXsxYLFTu1hTm2zViCp7u0o5l+2PSUh9bDj6FgYypufBDhqK2+oXkiuHFHR3zfj+9PtA8oR0xnqX8qn+sx3bFODSbbF0X8EUvWQ8jBIcjo5bRmLOljDNtcqNtOe756h3l0VhKa9hDd2l1eqmsnh0MNMT/Cqnx6BInumhLT8luljzQ53RiJeA/0dxe5NK0o2fA1+GLXr6eNQWHNUOJssQaTRlGpLHKL9fD+IrQzTOMZS9fNQD4AnRNVxvTdjC+fJdcDDWQcyB00B0t9BDwTxXgaAfzDZ/DBXzRnfWMFRwuNqocOmX6OKNkY63h5n/fFcB28McVHqnXZVI27K0i4rDLNE9lDKV/rT+udVbD8dFFu2GGZ8mOt0kAXcoX3ZkIWVtw+MNf5NjR2FbivROHmhV1/pj2egv/fMGIOWTIWrV3Av8N9imV9IWml36H6cUjqEWNv9aNc+veb2sH46PRaHSuMBxvtW+twxctq0z+QsHhux8Q7rCY4Ct8lqsx7c6Sy0dl5T89rIeEuZKoVctIk1hNpfavER6yyH1Vvm3MbsUHy4ab4hWr/OZPcsRBphnaV65/ZcdYPNNwsjN/djlf9NqCw9U5ExCPcdhKxUgLSmfROpLp4WSUr8ojdwbncbvCf+a/YzRaEc6QOvXcGO256TXc5Lab9POvB+AWY7PigWYjzhifbovuunzRawsO24ZqQQAqguBtmpmPB7ysXJfyDDaV/aPGillgz1MdQg4u5MYaEtBNNHFjkRlSpd65lp4hd2AVPTfbV7FGpyIOfmNc/XVsPfg7vzaS/3nkvLL593ANLvMuRMGpQIhiF7kUEW9QDpAUbTWYBcbp4WpacHHY1aacqQyjGZS9HI3yCBT9kUZJhVOD+zUDvEH9ddR11fzPcTDQ5TlgB0KwqdXSavk9BC0pKp0WmcuowSw07VXmXC5guzSa4p0UvRw2lbDiYUx0ExJJRzWzi6Gm8cnEkfXXsdcG/M/jAJa0+bmCgdmQ9CYlNlSYZOKixmRsgiFxkrmW4l3KdFKv1DM8tk6WxPYJZhUUzcd8Kdtgrw/gkfXXDT7+avmfVak32qhtkg6NVdUS5wgkru1YzIkSduTW1FDwVWV3JQVJVuieTc0y4iDpFwc7/BvSalvKdQM8sv662cevz/+8sQVnjVAT0W2wLllw1JiMhJRxgDjCjLQsOzSFSgZqx7lAW1JW0e03yAD3asC+GD3NbQhbe+mN5GXH1F83KDOM4n/e5JIuH4NpdQARrFPBVptUNcjj4cVMcFSRTE2NpR1LEYbYMmfWpXgP9KejaPsLUhuvLCsVXznAG9dfx9SR1ud/3hZdCLHb1GMdPqRJgqDmm76mHbvOXDtiO2QPUcKo/TWkQ0i2JFXpBoo7vij1i1Lp3ADAo+qvG3V0rM//vFnnTE4hxd5Ka/Cor5YEdsLVJyKtDgVoHgtW11pWSjolPNMnrlrVj9Fv2Qn60twMwKPqr+N/wvr8z5tZcDsDrv06tkqyzESM85Ycv6XBWA2birlNCXrI6VbD2lx2L0vQO0QVTVVLH4SE67fgsfVXv8n7sz7/85Z7cMtbE6f088wSaR4kCkCm10s6pKbJhfqiUNGLq+0gLWC6eUAZFPnLjwqtKd8EwGvWX59t7iPW4X/eAN1svgRVSY990YZg06BD1ohLMtyFTI4pKTJsS9xREq9EOaPWiO2gpms7397x6nQJkbh+Fz2q/rqRROX6/M8bJrqlVW4l6JEptKeUFuMYUbtCQ7CIttpGc6MY93x1r1vgAnRXvY5cvwWPqb9uWQm+lP95QxdNMeWhOq1x0Db55C7GcUv2ZUuN6n8iKzsvOxibC//Yfs9Na8r2Rlz02vXXDT57FP/zJi66/EJSmsJKa8QxnoqW3VLQ+jZVUtJwJ8PNX1NQCwfNgdhhHD9on7PdRdrdGPF28rJr1F+3LBdeyv+8yYfLoMYet1vX4upNAjVvwOUWnlNXJXlkzk5Il6kqeoiL0C07qno+/CYBXq/+utlnsz7/Mzvy0tmI4zm4ag23PRN3t/CWryoUVJGm+5+K8RJ0V8Hc88/XHUX/HfiAq7t+BH+x6v8t438enWmdJwFA6ZINriLGKv/95f8lT9/FnyA1NMVEvQyaXuu+gz36f/DD73E4pwqpLcvm/o0Vle78n//+L/NPvoefp1pTJye6e4A/D082FERa5/opeH9zpvh13cNm19/4v/LDe5xMWTi8I0Ta0qKlK27AS/v3/r+/x/2GO9K2c7kVMonDpq7//jc5PKCxeNPpFVzaRr01wF8C4Pu76hXuX18H4LduTr79guuFD3n5BHfI+ZRFhY8w29TYhbbLi/bvBdqKE4fUgg1pBKnV3FEaCWOWyA+m3WpORZr/j+9TKJtW8yBTF2/ZEODI9/QavHkVdGFp/Pjn4Q+u5hXapsP5sOH+OXXA1LiKuqJxiMNbhTkbdJTCy4llEt6NnqRT4dhg1V3nbdrm6dYMecA1yTOL4PWTE9L5VzPFlLBCvlG58AhehnN4uHsAYinyJ+AZ/NkVvELbfOBUuOO5syBIEtiqHU1k9XeISX5bsimrkUUhnGDxourN8SgUsCZVtKyGbyGzHXdjOhsAvOAswSRyIBddRdEZWP6GZhNK/yjwew9ehBo+3jEADu7Ay2n8mDc+TS7awUHg0OMzR0LABhqLD4hJEh/BEGyBdGlSJoXYXtr+3HS4ijzVpgi0paWXtdruGTknXBz+11qT1Q2inxaTzQCO46P3lfLpyS4fou2PH/PupwZgCxNhGlj4IvUuWEsTkqMWm6i4xCSMc9N1RDQoCVcuGItJ/MRWefais+3synowi/dESgJjkilnWnBTGvRWmaw8oR15257t7CHmCf8HOn7cwI8+NQBXMBEmAa8PMRemrNCEhLGEhDQKcGZWS319BX9PFBEwGTbRBhLbDcaV3drFcDqk5kCTd2JF1Wp0HraqBx8U0wwBTnbpCadwBA/gTH/CDrcCs93LV8E0YlmmcyQRQnjBa8JESmGUfIjK/7fkaDJpmD2QptFNVJU1bbtIAjjWQizepOKptRjbzR9Kag6xZmMLLjHOtcLT3Tx9o/0EcTT1XN3E45u24AiwEypDJXihKjQxjLprEwcmRKclaDNZCVqr/V8mYWyFADbusiY5hvgFoU2vio49RgJLn5OsReRFN6tabeetiiy0V7KFHT3HyZLx491u95sn4K1QQSPKM9hNT0wMVvAWbzDSVdrKw4zRjZMyJIHkfq1VAVCDl/bUhNKlGq0zGr05+YAceXVPCttVk0oqjVwMPt+BBefx4yPtGVkUsqY3CHDPiCM5ngupUwCdbkpd8kbPrCWHhkmtIKLEetF2499eS1jZlIPGYnlcPXeM2KD9vLS0bW3ktYNqUllpKLn5ZrsxlIzxvDu5eHxzGLctkZLEY4PgSOg2IUVVcUONzUDBEpRaMoXNmUc0tFZrTZquiLyKxrSm3DvIW9Fil+AkhXu5PhEPx9mUNwqypDvZWdKlhIJQY7vn2OsnmBeOWnYZ0m1iwbbw1U60by5om47iHRV6fOgzjMf/DAZrlP40Z7syxpLK0lJ0gqaAK1c2KQKu7tabTXkLFz0sCftuwX++MyNeNn68k5Buq23YQhUh0SNTJa1ioQ0p4nUG2y0XilF1JqODqdImloPS4Bp111DEWT0jJjVv95uX9BBV7eB3bUWcu0acSVM23YZdd8R8UbQUxJ9wdu3oMuhdt929ME+mh6JXJ8di2RxbTi6TbrDquqV4aUKR2iwT6aZbyOwEXN3DUsWr8Hn4EhwNyHuXHh7/pdaUjtR7vnDh/d8c9xD/s5f501eQ1+CuDiCvGhk1AN/4Tf74RfxPwD3toLarR0zNtsnPzmS64KIRk861dMWCU8ArasG9T9H0ZBpsDGnjtAOM2+/LuIb2iIUGXNgl5ZmKD/Tw8TlaAuihaFP5yrw18v4x1898zIdP+DDAX1bM3GAMvPgRP/cJn3zCW013nrhHkrITyvYuwOUkcHuKlRSW5C6rzIdY4ppnF7J8aAJbQepgbJYBjCY9usGXDKQxq7RZfh9eg5d1UHMVATRaD/4BHK93/1iAgYZ/+jqPn8Dn4UExmWrpa3+ZOK6MvM3bjwfzxNWA2dhs8+51XHSPJiaAhGSpWevEs5xHLXcEGFXYiCONySH3fPWq93JIsBiSWvWyc3CAN+EcXoT7rCSANloPPoa31rt/5PUA/gp8Q/jDD3hyrjzlR8VkanfOvB1XPubt17vzxAfdSVbD1pzAnfgyF3ycadOTOTXhpEUoLC1HZyNGW3dtmjeXgr2r56JNmRwdNNWaQVBddd6rh4MhviEB9EFRD/7RGvePvCbwAL4Mx/D6M541hHO4D3e7g6PafdcZVw689z7NGTwo5om7A8sPhccT6qKcl9NJl9aM/9kX+e59Hh1yPqGuCCZxuITcsmNaJ5F7d0q6J3H48TO1/+M57085q2icdu2U+W36Ldllz9Agiv4YGljoEN908EzvDOrBF98/vtJwCC/BF2AG75xxEmjmMIcjxbjoaxqOK3/4hPOZzhMPBpYPG44CM0dTVm1LjLtUWWVz1Bcf8tEx0zs8O2A2YVHRxKYOiy/aOVoAaMu0i7ubu43njjmd4ibMHU1sIDHaQNKrZND/FZYdk54oCXetjq7E7IVl9eAL7t+oHnwXXtLx44czzoRFHBztYVwtH1d+NOMkupZ5MTM+gUmq90X+Bh9zjRlmaQ+m7YMqUL/veemcecAtOJ0yq1JnVlN27di2E0+Klp1tAJ4KRw1eMI7aJjsO3R8kPSI3fUFXnIOfdQe86sIIVtWDL7h//Ok6vj8vwDk08NEcI8zz7OhBy+WwalzZeZ4+0XniRfst9pAJqQHDGLzVQ2pheZnnv1OWhwO43/AgcvAEXEVVpa4db9sGvNK8wjaENHkfFQ4Ci5i7dqnQlPoLQrHXZDvO3BIXZbJOBrOaEbML6sFL798I4FhKihjHMsPjBUZYCMFr6nvaArxqXPn4lCa+cHfSa2cP27g3Z3ziYTRrcbQNGLQmGF3F3cBdzzzX7AILx0IB9rbwn9kx2G1FW3Inic+ZLIsVvKR8Zwfj0l1fkqo8LWY1M3IX14OX3r9RKTIO+d9XzAI8qRPGPn/4NC2n6o4rN8XJ82TOIvuVA8zLKUHRFgBCetlDZlqR1gLKjS39xoE7Bt8UvA6BxuEDjU3tFsEijgA+615tmZkXKqiEENrh41iLDDZNq4pKTWR3LZfnos81LOuNa15cD956vLMsJd1rqYp51gDUQqMYm2XsxnUhD2jg1DM7SeuJxxgrmpfISSXVIJIS5qJJSvJPEQ49DQTVIbYWJ9QWa/E2+c/oPK1drmC7WSfJRNKBO5Yjvcp7Gc3dmmI/Xh1kDTEuiSnWqQf37h+fTMhGnDf6dsS8SQfQWlqqwXXGlc/PEZ/SC5mtzIV0nAshlQdM/LvUtYutrEZ/Y+EAFtq1k28zQhOwLr1AIeANzhF8t9qzTdZf2qRKO6MWE9ohBYwibbOmrFtNmg3mcS+tB28xv2uKd/agYCvOP+GkSc+0lr7RXzyufL7QbkUpjLjEWFLqOIkAGu2B0tNlO9Eau2W1qcOUvVRgKzypKIQZ5KI3q0MLzqTNRYqiZOqmtqloIRlmkBHVpHmRYV6/HixbO6UC47KOFJnoMrVyr7wYz+SlW6GUaghYbY1I6kkxA2W1fSJokUdSh2LQ1GAimRGm0MT+uu57H5l7QgOWxERpO9moLRPgTtquWCfFlGlIjQaRly9odmzMOWY+IBO5tB4sW/0+VWGUh32qYk79EidWKrjWuiLpiVNGFWFRJVktyeXWmbgBBzVl8anPuXyNJlBJOlKLTgAbi/EYHVHxWiDaVR06GnHQNpJcWcK2jJtiCfG2sEHLzuI66sGrMK47nPIInPnu799935aOK2cvmvubrE38ZzZjrELCmXM2hM7UcpXD2oC3+ECVp7xtIuxptJ0jUr3sBmBS47TVxlvJ1Sqb/E0uLdvLj0lLr29ypdd/eMX3f6lrxGlKwKQxEGvw0qHbkbwrF3uHKwVENbIV2wZ13kNEF6zD+x24aLNMfDTCbDPnEikZFyTNttxWBXDaBuM8KtI2rmaMdUY7cXcUPstqTGvBGSrFWIpNMfbdea990bvAOC1YX0qbc6smDS1mPxSJoW4fwEXvjMmhlijDRq6qale6aJEuFGoppYDoBELQzLBuh/mZNx7jkinv0EtnUp50lO9hbNK57lZaMAWuWR5Yo9/kYwcYI0t4gWM47Umnl3YmpeBPqSyNp3K7s2DSAS/39KRuEN2bS4xvowV3dFRMx/VFcp2Yp8w2nTO9hCXtHG1kF1L4KlrJr2wKfyq77R7MKpFKzWlY9UkhYxyHWW6nBWPaudvEAl3CGcNpSXPZ6R9BbBtIl6cHL3gIBi+42CYXqCx1gfGWe7Ap0h3luyXdt1MKy4YUT9xSF01G16YEdWsouW9mgDHd3veyA97H+Ya47ZmEbqMY72oPztCGvK0onL44AvgC49saZKkWRz4veWljE1FHjbRJaWv6ZKKtl875h4CziFCZhG5rx7tefsl0aRT1bMHZjm8dwL/6u7wCRysaQblQoG5yAQN5zpatMNY/+yf8z+GLcH/Qn0iX2W2oEfXP4GvwQHuIL9AYGnaO3zqAX6946nkgqZNnUhx43DIdQtMFeOPrgy/y3Yd85HlJWwjLFkU3kFwq28xPnuPhMWeS+tDLV9Otllq7pQCf3uXJDN9wFDiUTgefHaiYbdfi3b3u8+iY6TnzhgehI1LTe8lcd7s1wJSzKbahCRxKKztTLXstGAiu3a6rPuQs5pk9TWAan5f0BZmGf7Ylxzzk/A7PAs4QPPPAHeFQ2hbFHszlgZuKZsJcUmbDC40sEU403cEjczstOEypa+YxevL4QBC8oRYqWdK6b7sK25tfE+oDZgtOQ2Jg8T41HGcBE6fTWHn4JtHcu9S7uYgU5KSCkl/mcnq+5/YBXOEr6lCUCwOTOM1taOI8mSxx1NsCXBEmLKbMAg5MkwbLmpBaFOPrNSlO2HnLiEqW3tHEwd8AeiQLmn+2gxjC3k6AxREqvKcJbTEzlpLiw4rNZK6oJdidbMMGX9FULKr0AkW+2qDEPBNNm5QAt2Ik2nftNWHetubosHLo2nG4vQA7GkcVCgVCgaDixHqo9UUn1A6OshapaNR/LPRYFV8siT1cCtJE0k/3WtaNSuUZYKPnsVIW0xXWnMUxq5+En4Kvw/MqQmVXnAXj9Z+9zM98zM/Agy7F/qqj2Nh67b8HjFnPP3iBn/tkpdzwEJX/whIcQUXOaikeliCRGUk7tiwF0rItwMEhjkZ309hikFoRAmLTpEXWuHS6y+am/KB/fM50aLEhGnSMwkpxzOov4H0AvgovwJ1iGzDLtJn/9BU+fAINfwUe6FHSLhu83viV/+/HrOePX+STT2B9uWGbrMHHLldRBlhS/CJQmcRxJFqZica01XixAZsYiH1uolZxLrR/SgxVIJjkpQP4PE9sE59LKLr7kltSBogS5tyszzH8Fvw8/AS8rNOg0xUS9fIaHwb+6et8Q/gyvKRjf5OusOzGx8evA/BP4IP11uN/grca5O0lcsPLJ5YjwI4QkJBOHa0WdMZYGxPbh2W2nR9v3WxEWqgp/G3+6VZbRLSAAZ3BhdhAaUL33VUSw9yjEsvbaQ9u4A/gGXwZXoEHOuU1GSj2chf+Mo+f8IcfcAxfIKVmyunRbYQVnoevwgfw3TXXcw++xNuP4fhyueEUNttEduRVaDttddoP0eSxLe2LENk6itYxlrxBNBYrNNKSQmeaLcm9c8UsaB5WyO6675yyQIAWSDpBVoA/gxmcwEvwoDv0m58UE7gHn+fJOa8/Ywan8EKRfjsopF83eCglX/Sfr7OeaRoQfvt1CGvIDccH5BCvw1sWIzRGC/66t0VTcLZQZtm6PlAasbOJ9iwWtUo7biktTSIPxnR24jxP1ZKaqq+2RcXM9OrBAm/AAs7hDJ5bNmGb+KIfwCs8a3jnjBrOFeMjHSCdbKr+2uOLfnOd9eiA8Hvvwwq54VbP2OqwkB48Ytc4YEOiH2vTXqodabfWEOzso4qxdbqD5L6tbtNPECqbhnA708DZH4QOJUXqScmUlks7Ot6FBuZw3n2mEbaUX7kDzxHOOQk8nKWMzAzu6ZZ8sOFw4RK+6PcuXo9tB4SbMz58ApfKDXf3szjNIIbGpD5TKTRxGkEMLjLl+K3wlWXBsCUxIDU+jbOiysESqAy1MGUJpXgwbTWzNOVEziIXZrJ+VIztl1PUBxTSo0dwn2bOmfDRPD3TRTGlfbCJvO9KvuhL1hMHhB9wPuPRLGHcdOWG2xc0U+5bQtAJT0nRTewXL1pgk2+rZAdeWmz3jxAqfNQQdzTlbF8uJ5ecEIWvTkevAHpwz7w78QujlD/Lr491bD8/1vhM2yrUQRrWXNQY4fGilfctMWYjL72UL/qS9eiA8EmN88nbNdour+PBbbAjOjIa4iBhfFg6rxeKdEGcL6p3EWR1Qq2Qkhs2DrnkRnmN9tG2EAqmgPw6hoL7Oza7B+3SCrR9tRftko+Lsf2F/mkTndN2LmzuMcKTuj/mX2+4Va3ki16+nnJY+S7MefpkidxwnV+4wkXH8TKnX0tsYzYp29DOOoSW1nf7nTh2akYiWmcJOuTidSaqESrTYpwjJJNVGQr+rLI7WsqerHW6Kp/oM2pKuV7T1QY9gjqlZp41/WfKpl56FV/0kvXQFRyeQ83xaTu5E8p5dNP3dUF34ihyI3GSpeCsywSh22ZJdWto9winhqifb7VRvgktxp13vyjrS0EjvrRfZ62uyqddSWaWYlwTPAtJZ2oZ3j/Sgi/mi+6vpzesfAcWNA0n8xVyw90GVFGuZjTXEQy+6GfLGLMLL523f5E0OmxVjDoOuRiH91RKU+vtoCtH7TgmvBLvtFXWLW15H9GTdVw8ow4IlRLeHECN9ym1e9K0I+Cbnhgv4Yu+aD2HaQJ80XDqOzSGAV4+4yCqBxrsJAX6ZTIoX36QnvzhhzzMfFW2dZVLOJfo0zbce5OvwXMFaZ81mOnlTVXpDZsQNuoYWveketKb5+6JOOsgX+NTm7H49fUTlx+WLuWL7qxnOFh4BxpmJx0p2gDzA/BUARuS6phR+pUsY7MMboAHx5xNsSVfVZcYSwqCKrqon7zM+8ecCkeS4nm3rINuaWvVNnMRI1IRpxTqx8PZUZ0Br/UEduo3B3hNvmgZfs9gQPj8vIOxd2kndir3awvJ6BLvoUuOfFWNYB0LR1OQJoUySKb9IlOBx74q1+ADC2G6rOdmFdJcD8BkfualA+BdjOOzP9uUhGUEX/TwhZsUduwRr8wNuXKurCixLBgpQI0mDbJr9dIqUuV+92ngkJZ7xduCk2yZKbfWrH1VBiTg9VdzsgRjW3CVXCvAwDd+c1z9dWw9+B+8MJL/eY15ZQ/HqvTwVdsZn5WQsgRRnMaWaecu3jFvMBEmgg+FJFZsnSl0zjB9OqPYaBD7qmoVyImFvzi41usesV0julaAR9dfR15Xzv9sEruRDyk1nb+QaLU67T885GTls6YgcY+UiMa25M/pwGrbCfzkvR3e0jjtuaFtnwuagHTSb5y7boBH119HXhvwP487jJLsLJ4XnUkHX5sLbS61dpiAXRoZSCrFJ+EjpeU3puVfitngYNo6PJrAigKktmwjyQdZpfq30mmtulaAx9Zfx15Xzv+cyeuiBFUs9zq8Kq+XB9a4PVvph3GV4E3y8HENJrN55H1X2p8VyqSKwVusJDKzXOZzplWdzBUFK9e+B4+uv468xvI/b5xtSAkBHQaPvtqWzllVvEOxPbuiE6+j2pvjcKsbvI7txnRErgfH7LdXqjq0IokKzga14GzQ23SSbCQvO6r+Or7SMIr/efOkkqSdMnj9mBx2DRsiY29Uj6+qK9ZrssCKaptR6HKURdwUYeUWA2kPzVKQO8ku2nU3Anhs/XWkBx3F/7wJtCTTTIKftthue1ty9xvNYLY/zo5KSbIuKbXpbEdSyeRyYdAIwKY2neyoc3+k1XUaufYga3T9daMUx/r8z1s10ITknIO0kuoMt+TB8jK0lpayqqjsJ2qtXAYwBU932zinimgmd6mTRDnQfr88q36NAI+tv24E8Pr8zxtasBqx0+xHH9HhlrwsxxNUfKOHQaZBITNf0uccj8GXiVmXAuPEAKSdN/4GLHhs/XWj92dN/uetNuBMnVR+XWDc25JLjo5Mg5IZIq226tmCsip2zZliL213YrTlL2hcFjpCduyim3M7/eB16q/blQsv5X/esDRbtJeabLIosWy3ycavwLhtxdWzbMmHiBTiVjJo6lCLjXZsi7p9PEPnsq6X6wd4bP11i0rD5fzPm/0A6brrIsllenZs0lCJlU4abakR59enZKrKe3BZihbTxlyZ2zl1+g0wvgmA166/bhwDrcn/7Ddz0eWZuJvfSESug6NzZsox3Z04FIxz0mUjMwVOOVTq1CQ0AhdbBGVdjG/CgsfUX7esJl3K/7ytWHRv683praW/8iDOCqWLLhpljDY1ZpzK75QiaZoOTpLKl60auHS/97oBXrv+umU9+FL+5+NtLFgjqVLCdbmj7pY5zPCPLOHNCwXGOcLquOhi8CmCWvbcuO73XmMUPab+ug3A6/A/78Bwe0bcS2+tgHn4J5pyS2WbOck0F51Vq3LcjhLvZ67p1ABbaL2H67bg78BfjKi/jr3+T/ABV3ilLmNXTI2SpvxWBtt6/Z//D0z/FXaGbSBgylzlsEGp+5//xrd4/ae4d8DUUjlslfIYS3t06HZpvfQtvv0N7AHWqtjP2pW08QD/FLy//da38vo8PNlKHf5y37Dxdfe/oj4kVIgFq3koLReSR76W/bx//n9k8jonZxzWTANVwEniDsg87sOSd/z7//PvMp3jQiptGVWFX2caezzAXwfgtzYUvbr0iozs32c3Uge7varH+CNE6cvEYmzbPZ9hMaYDdjK4V2iecf6EcEbdUDVUARda2KzO/JtCuDbNQB/iTeL0EG1JSO1jbXS+nLxtPMDPw1fh5+EPrgSEKE/8Gry5A73ui87AmxwdatyMEBCPNOCSKUeRZ2P6Myb5MRvgCHmA9ywsMifU+AYXcB6Xa5GibUC5TSyerxyh0j6QgLVpdyhfArRTTLqQjwe4HOD9s92D4Ap54odXAPBWLAwB02igG5Kkc+piN4lvODIFGAZgT+EO4Si1s7fjSR7vcQETUkRm9O+MXyo9OYhfe4xt9STQ2pcZRLayCV90b4D3jR0DYAfyxJ+eywg2IL7NTMXna7S/RpQ63JhWEM8U41ZyQGjwsVS0QBrEKLu8xwZsbi4wLcCT+OGidPIOCe1PiSc9Qt+go+vYqB7cG+B9d8cAD+WJPz0Am2gxXgU9IneOqDpAAXOsOltVuMzpdakJXrdPCzXiNVUpCeOos5cxnpQT39G+XVLhs1osQVvJKPZyNq8HDwd4d7pNDuWJPxVX7MSzqUDU6gfadKiNlUFTzLeFHHDlzO4kpa7aiKhBPGKwOqxsBAmYkOIpipyXcQSPlRTf+Tii0U3EJGaZsDER2qoB3h2hu0qe+NNwUooYU8y5mILbJe6OuX+2FTKy7bieTDAemaQyQ0CPthljSWO+xmFDIYiESjM5xKd6Ik5lvLq5GrQ3aCMLvmCA9wowLuWJb9xF59hVVP6O0CrBi3ZjZSNOvRy+I6klNVRJYRBaEzdN+imiUXQ8iVF8fsp+W4JXw7WISW7fDh7lptWkCwZ4d7QTXyBPfJMYK7SijjFppGnlIVJBJBYj7eUwtiP1IBXGI1XCsjNpbjENVpSAJ2hq2LTywEly3hUYazt31J8w2+aiLx3g3fohXixPfOMYm6zCGs9LVo9MoW3MCJE7R5u/WsOIjrqBoHUO0bJE9vxBpbhsd3+Nb4/vtPCZ4oZYCitNeYuC/8UDvDvy0qvkiW/cgqNqRyzqSZa/s0mqNGjtKOoTm14zZpUauiQgVfqtQiZjq7Q27JNaSK5ExRcrGCXO1FJYh6jR6CFqK7bZdQZ4t8g0rSlPfP1RdBtqaa9diqtzJkQ9duSryi2brQXbxDwbRUpFMBHjRj8+Nt7GDKgvph9okW7LX47gu0SpGnnFQ1S1lYldOsC7hYteR574ZuKs7Ei1lBsfdz7IZoxzzCVmmVqaSySzQbBVAWDek+N4jh9E/4VqZrJjPwiv9BC1XcvOWgO8275CVyBPvAtTVlDJfZkaZGU7NpqBogAj/xEHkeAuJihWYCxGN6e8+9JtSegFXF1TrhhLGP1fak3pebgPz192/8gB4d/6WT7+GdYnpH7hH/DJzzFiYPn/vjW0SgNpTNuPIZoAEZv8tlGw4+RLxy+ZjnKa5NdFoC7UaW0aduoYse6+bXg1DLg6UfRYwmhGEjqPvF75U558SANrElK/+MdpXvmqBpaXOa/MTZaa1DOcSiLaw9j0NNNst3c+63c7EKTpkvKHzu6bPbP0RkuHAVcbRY8ijP46MIbQeeT1mhA+5PV/inyDdQipf8LTvMXbwvoDy7IruDNVZKTfV4CTSRUYdybUCnGU7KUTDxLgCknqUm5aAW6/1p6eMsOYsphLzsHrE0Y/P5bQedx1F/4yPHnMB3/IOoTU9+BL8PhtjuFKBpZXnYNJxTuv+2XqolKR2UQgHhS5novuxVySJhBNRF3SoKK1XZbbXjVwWNyOjlqWJjrWJIy+P5bQedyldNScP+HZ61xKSK3jyrz+NiHG1hcOLL/+P+PDF2gOkekKGiNWKgJ+8Z/x8Iv4DdQHzcpZyF4v19I27w9/yPGDFQvmEpKtqv/TLiWMfn4sofMm9eAH8Ao0zzh7h4sJqYtxZd5/D7hkYPneDzl5idlzNHcIB0jVlQ+8ULzw/nc5/ojzl2juE0apD7LRnJxe04dMz2iOCFNtGFpTuXA5AhcTRo8mdN4kz30nVjEC4YTZQy4gpC7GlTlrePKhGsKKgeXpCYeO0MAd/GH7yKQUlXPLOasOH3FnSphjHuDvEu4gB8g66oNbtr6eMbFIA4fIBJkgayoXriw2XEDQPJrQeROAlY6aeYOcMf+IVYTU3XFlZufMHinGywaW3YLpObVBAsbjF4QJMsVUSayjk4voPsHJOQfPWDhCgDnmDl6XIRerD24HsGtw86RMHOLvVSHrKBdeVE26gKB5NKHzaIwLOmrqBWJYZDLhASG16c0Tn+CdRhWDgWXnqRZUTnPIHuMJTfLVpkoYy5CzylHVTGZMTwkGAo2HBlkQplrJX6U+uF1wZz2uwS1SQ12IqWaPuO4baZaEFBdukksJmkcTOm+YJSvoqPFzxFA/YUhIvWxcmSdPWTWwbAKVp6rxTtPFUZfKIwpzm4IoMfaYQLWgmlG5FME2gdBgm+J7J+rtS/XBbaVLsR7bpPQnpMFlo2doWaVceHk9+MkyguZNCJ1He+kuHTWyQAzNM5YSUg/GlTk9ZunAsg1qELVOhUSAK0LABIJHLKbqaEbHZLL1VA3VgqoiOKXYiS+HRyaEKgsfIqX64HYWbLRXy/qWoylIV9gudL1OWBNgBgTNmxA6b4txDT4gi3Ri7xFSLxtXpmmYnzAcWDZgY8d503LFogz5sbonDgkKcxGsWsE1OI+rcQtlgBBCSOKD1mtqYpIU8cTvBmAT0yZe+zUzeY92fYjTtGipXLhuR0ePoHk0ofNWBX+lo8Z7pAZDk8mEw5L7dVyZZoE/pTewbI6SNbiAL5xeygW4xPRuLCGbhcO4RIeTMFYHEJkYyEO9HmJfXMDEj/LaH781wHHZEtqSQ/69UnGpzH7LKIAZEDSPJnTesJTUa+rwTepI9dLJEawYV+ZkRn9g+QirD8vF8Mq0jFQ29js6kCS3E1+jZIhgPNanHdHFqFvPJLHqFwQqbIA4jhDxcNsOCCQLDomaL/dr5lyJaJU6FxPFjO3JOh3kVMcROo8u+C+jo05GjMF3P3/FuDLn5x2M04xXULPwaS6hBYki+MrMdZJSgPHlcB7nCR5bJ9Kr5ACUn9jk5kivdd8tk95SOGrtqu9lr2IhK65ZtEl7ZKrp7DrqwZfRUSN1el7+7NJxZbywOC8neNKTch5vsTEMNsoCCqHBCqIPRjIPkm0BjvFODGtto99rCl+d3wmHkW0FPdpZtC7MMcVtGFQjJLX5bdQ2+x9ypdc313uj8xlsrfuLgWXz1cRhZvJYX0iNVBRcVcmCXZs6aEf3RQF2WI/TcCbKmGU3IOoDJGDdDub0+hYckt6PlGu2BcxmhbTdj/klhccLGJMcqRjMJP1jW2ETqLSWJ/29MAoORluJ+6LPffBZbi5gqi5h6catQpmOT7/OFf5UorRpLzCqcMltBLhwd1are3kztrSzXO0LUbXRQcdLh/RdSZ+swRm819REDrtqzC4es6Gw4JCKlSnjYVpo0xeq33PrADbFLL3RuCmObVmPN+24kfa+AojDuM4umKe2QwCf6EN906HwjujaitDs5o0s1y+k3lgbT2W2i7FJdnwbLXhJUBq/9liTctSmFC/0OqUinb0QddTWamtjbHRFuWJJ6NpqZ8vO3fZJ37Db+2GkaPYLGHs7XTTdiFQJ68SkVJFVmY6McR5UycflNCsccHFaV9FNbR4NttLxw4pQ7wJd066Z0ohVbzihaxHVExd/ay04oxUKWt+AsdiQ9OUyZ2krzN19IZIwafSTFgIBnMV73ADj7V/K8u1MaY2sJp2HWm0f41tqwajEvdHWOJs510MaAqN4aoSiPCXtN2KSi46dUxHdaMquar82O1x5jqhDGvqmoE9LfxcY3zqA7/x3HA67r9ZG4O6Cuxu12/+TP+eLP+I+HErqDDCDVmBDO4larujNe7x8om2rMug0MX0rL1+IWwdwfR+p1TNTyNmVJ85ljWzbWuGv8/C7HD/izjkHNZNYlhZcUOKVzKFUxsxxN/kax+8zPWPSFKw80rJr9Tizyj3o1gEsdwgWGoxPezDdZ1TSENE1dLdNvuKL+I84nxKesZgxXVA1VA1OcL49dFlpFV5yJMhzyCmNQ+a4BqusPJ2bB+xo8V9u3x48VVIEPS/mc3DvAbXyoYr6VgDfh5do5hhHOCXMqBZUPhWYbWZECwVJljLgMUWOCB4MUuMaxGNUQDVI50TQ+S3kFgIcu2qKkNSHVoM0SHsgoZxP2d5HH8B9woOk4x5bPkKtAHucZsdykjxuIpbUrSILgrT8G7G5oCW+K0990o7E3T6AdW4TilH5kDjds+H64kS0mz24grtwlzDHBJqI8YJQExotPvoC4JBq0lEjjQkyBZ8oH2LnRsQ4Hu1QsgDTJbO8fQDnllitkxuVskoiKbRF9VwzMDvxHAdwB7mD9yCplhHFEyUWHx3WtwCbSMMTCUCcEmSGlg4gTXkHpZXWQ7kpznK3EmCHiXInqndkQjunG5kxTKEeGye7jWz9cyMR2mGiFQ15ENRBTbCp+Gh86vAyASdgmJq2MC6hoADQ3GosP0QHbnMHjyBQvQqfhy/BUbeHd5WY/G/9LK/8Ka8Jd7UFeNWEZvzPb458Dn8DGLOe3/wGL/4xP+HXlRt+M1PE2iLhR8t+lfgxsuh7AfO2AOf+owWhSZRYQbd622hbpKWKuU+XuvNzP0OseRDa+mObgDHJUSc/pKx31QdKffQ5OIJpt8GWjlgTwMc/w5MPCR/yl1XC2a2Yut54SvOtMev55Of45BOat9aWG27p2ZVORRvnEk1hqWMVUmqa7S2YtvlIpspuF1pt0syuZS2NV14mUidCSfzQzg+KqvIYCMljIx2YK2AO34fX4GWdu5xcIAb8MzTw+j/lyWM+Dw/gjs4GD6ehNgA48kX/AI7XXM/XAN4WHr+9ntywqoCakCqmKP0rmQrJJEErG2Upg1JObr01lKQy4jskWalKYfJ/EDLMpjNSHFEUAde2fltaDgmrNaWQ9+AAb8I5vKjz3L1n1LriB/BXkG/wwR9y/oRX4LlioHA4LzP2inzRx/DWmutRweFjeP3tNeSGlaE1Fde0OS11yOpmbIp2u/jF1n2RRZviJM0yBT3IZl2HWImKjQOxIyeU325b/qWyU9Moj1o07tS0G7qJDoGHg5m8yeCxMoEH8GU45tnrNM84D2l297DQ9t1YP7jki/7RmutRweEA77/HWXOh3HCxkRgldDQkAjNTMl2Iloc1qN5JfJeeTlyTRzxURTdn1Ixv2uKjs12AbdEWlBtmVdk2k7FFwj07PCZ9XAwW3dG+8xKzNFr4EnwBZpy9Qzhh3jDXebBpYcpuo4fQ44u+fD1dweEnHzI7v0xuuOALRUV8rXpFyfSTQYkhd7IHm07jpyhlkCmI0ALYqPTpUxXS+z4jgDj1Pflvmz5ecuItpIBxyTHpSTGWd9g1ApfD/bvwUhL4nT1EzqgX7cxfCcNmb3mPL/qi9SwTHJ49oj5ZLjccbTG3pRmlYi6JCG0mQrAt1+i2UXTZ2dv9IlQpN5naMYtviaXlTrFpoMsl3bOAFEa8sqPj2WCMrx3Yjx99qFwO59Aw/wgx+HlqNz8oZvA3exRDvuhL1jMQHPaOJ0+XyA3fp1OfM3qObEVdhxjvynxNMXQV4+GJyvOEFqeQBaIbbO7i63rpxCltdZShPFxkjM2FPVkn3TG+Rp9pO3l2RzFegGfxGDHIAh8SteR0C4HopXzRF61nheDw6TFN05Ebvq8M3VKKpGjjO6r7nhudTEGMtYM92HTDaR1FDMXJ1eThsbKfywyoWwrzRSXkc51flG3vIid62h29bIcFbTGhfV+faaB+ohj7dPN0C2e2lC96+XouFByen9AsunLDJZ9z7NExiUc0OuoYW6UZkIyx2YUR2z6/TiRjyKMx5GbbjLHvHuf7YmtKghf34LJfx63Yg8vrvN2zC7lY0x0tvKezo4HmGYDU+Gab6dFL+KI761lDcNifcjLrrr9LWZJctG1FfU1uwhoQE22ObjdfkSzY63CbU5hzs21WeTddH2BaL11Gi7lVdlxP1nkxqhnKhVY6knS3EPgVGg1JpN5cP/hivujOelhXcPj8HC/LyI6MkteVjlolBdMmF3a3DbsuAYhL44dxzthWSN065xxUd55Lmf0wRbOYOqH09/o9WbO2VtFdaMb4qBgtFJoT1SqoN8wPXMoXLb3p1PUEhxfnnLzGzBI0Ku7FxrKsNJj/8bn/H8fPIVOd3rfrklUB/DOeO+nkghgSPzrlPxluCMtOnDL4Yml6dK1r3vsgMxgtPOrMFUZbEUbTdIzii5beq72G4PD0DKnwjmBULUVFmy8t+k7fZ3pKc0Q4UC6jpVRqS9Umv8bxw35flZVOU1X7qkjnhZlsMbk24qQ6Hz7QcuL6sDC0iHHki96Uh2UdvmgZnjIvExy2TeJdMDZNSbdZyAHe/Yd1xsQhHiKzjh7GxQ4yqMPaywPkjMamvqrYpmO7Knad+ZQC5msCuAPWUoxrxVhrGv7a+KLXFhyONdTMrZ7ke23qiO40ZJUyzgYyX5XyL0mV7NiUzEs9mjtbMN0dERqwyAJpigad0B3/zRV7s4PIfXSu6YV/MK7+OrYe/JvfGMn/PHJe2fyUdtnFrKRNpXV0Y2559aWPt/G4BlvjTMtXlVIWCnNyA3YQBDmYIodFz41PvXPSa6rq9lWZawZ4dP115HXV/M/tnFkkrBOdzg6aP4pID+MZnTJ1SuuB6iZlyiox4HT2y3YBtkUKWooacBQUDTpjwaDt5poBHl1/HXltwP887lKKXxNUEyPqpGTyA699UqY/lt9yGdlUKra0fFWS+36iylVWrAyd7Uw0CZM0z7xKTOduznLIjG2Hx8cDPLb+OvK6Bv7n1DYci4CxUuRxrjBc0bb4vD3rN5Zz36ntLb83eVJIB8LiIzCmn6SMPjlX+yNlTjvIGjs+QzHPf60Aj62/jrzG8j9vYMFtm1VoRWCJdmw7z9N0t+c8cxZpPeK4aTRicS25QhrVtUp7U578chk4q04Wx4YoQSjFryUlpcQ1AbxZ/XVMknIU//OGl7Q6z9Zpxi0+3yFhSkjUDpnCIUhLWVX23KQ+L9vKvFKI0ZWFQgkDLvBoylrHNVmaw10zwCPrr5tlodfnf94EWnQ0lFRWy8pW9LbkLsyUVDc2NSTHGDtnD1uMtchjbCeb1mpxFP0YbcClhzdLu6lfO8Bj6q+bdT2sz/+8SZCV7VIxtt0DUn9L7r4cLYWDSXnseEpOGFuty0qbOVlS7NNzs5FOGJUqQpl2Q64/yBpZf90sxbE+//PGdZ02HSipCbmD6NItmQ4Lk5XUrGpDMkhbMm2ZVheNYV+VbUWTcv99+2NyX1VoafSuC+AN6q9bFIMv5X/eagNWXZxEa9JjlMwNWb00akGUkSoepp1/yRuuqHGbUn3UdBSTxBU6SEVklzWRUkPndVvw2PrrpjvxOvzPmwHc0hpmq82npi7GRro8dXp0KXnUQmhZbRL7NEVp1uuZmO45vuzKsHrktS3GLWXODVjw+vXXLYx4Hf7njRPd0i3aoAGX6W29GnaV5YdyDj9TFkakje7GHYzDoObfddHtOSpoi2SmzJHrB3hM/XUDDEbxP2/oosszcRlehWXUvzHv4TpBVktHqwenFo8uLVmy4DKLa5d3RtLrmrM3aMFr1183E4sewf+85VWeg1c5ag276NZrM9IJVNcmLEvDNaV62aq+14IAOGFsBt973Ra8Xv11YzXwNfmft7Jg2oS+XOyoC8/cwzi66Dhmgk38kUmP1CUiYWOX1bpD2zWXt2FCp7uq8703APAa9dfNdscR/M/bZLIyouVxqJfeWvG9Je+JVckHQ9+CI9NWxz+blX/KYYvO5n2tAP/vrlZ7+8/h9y+9qeB/Hnt967e5mevX10rALDWK//FaAT5MXdBXdP0C/BAes792c40H+AiAp1e1oH8HgH94g/Lttx1gp63op1eyoM/Bvw5/G/7xFbqJPcCXnmBiwDPb/YKO4FX4OjyCb289db2/Noqicw4i7N6TVtoz8tNwDH+8x/i6Ae7lmaQVENzJFb3Di/BFeAwz+Is9SjeQySpPqbLFlNmyz47z5a/AF+AYFvDmHqibSXTEzoT4Gc3OALaqAP4KPFUJ6n+1x+rGAM6Zd78bgJ0a8QN4GU614vxwD9e1Amy6CcskNrczLx1JIp6HE5UZD/DBHrFr2oNlgG4Odv226BodoryjGJ9q2T/AR3vQrsOCS0ctXZi3ruLlhpFDJYl4HmYtjQCP9rhdn4suySLKDt6wLcC52h8xPlcjju1fn+yhuw4LZsAGUuo2b4Fx2UwQu77uqRHXGtg92aN3tQCbFexc0uk93vhTXbct6y7MulLycoUljx8ngDMBg1tvJjAazpEmOtxlzclvj1vQf1Tx7QlPDpGpqgtdSKz/d9/hdy1vTfFHSmC9dGDZbLiezz7Ac801HirGZsWjydfZyPvHXL/Y8Mjzg8BxTZiuwKz4Eb8sBE9zznszmjvFwHKPIWUnwhqfVRcd4Ck0K6ate48m1oOfrX3/yOtvAsJ8zsPAM89sjnddmuLuDPjX9Bu/L7x7xpMzFk6nWtyQfPg278Gn4Aekz2ZgOmU9eJ37R14vwE/BL8G3aibCiWMWWDQ0ZtkPMnlcGeAu/Ag+8ZyecU5BPuy2ILD+sQqyZhAKmn7XZd+jIMTN9eBL7x95xVLSX4On8EcNlXDqmBlqS13jG4LpmGbkF/0CnOi3H8ETOIXzmnmtb0a16Tzxj1sUvQCBiXZGDtmB3KAefPH94xcUa/6vwRn80GOFyjEXFpba4A1e8KQfFF+259tx5XS4egYn8fQsLGrqGrHbztr+uByTahWuL1NUGbDpsnrwBfePPwHHIf9X4RnM4Z2ABWdxUBlqQ2PwhuDxoS0vvqB1JzS0P4h2nA/QgTrsJFn+Y3AOjs9JFC07CGWX1oNX3T/yHOzgDjwPn1PM3g9Jk9lZrMEpxnlPmBbjyo2+KFXRU52TJM/2ALcY57RUzjObbjqxVw++4P6RAOf58pcVsw9Daje3htriYrpDOonre3CudSe6bfkTEgHBHuDiyu5MCsc7BHhYDx7ePxLjqigXZsw+ijMHFhuwBmtoTPtOxOrTvYJDnC75dnUbhfwu/ZW9AgYd+peL68HD+0emKquiXHhWjJg/UrkJYzuiaL3E9aI/ytrCvAd4GcYZMCkSQxfUg3v3j8c4e90j5ZTPdvmJJGHnOCI2nHS8081X013pHuBlV1gB2MX1YNmWLHqqGN/TWmG0y6clJWthxNUl48q38Bi8vtMKyzzpFdSDhxZ5WBA5ZLt8Jv3895DduBlgbPYAj8C4B8hO68FDkoh5lydC4FiWvBOVqjYdqjiLv92t8yPDjrDaiHdUD15qkSURSGmXJwOMSxWAXYwr3zaAufJ66l+94vv3AO+vPcD7aw/w/toDvL/2AO+vPcD7aw/wHuD9tQd4f+0B3l97gPfXHuD9tQd4f+0B3l97gG8LwP8G/AL8O/A5OCq0Ys2KIdv/qOIXG/4mvFAMF16gZD+2Xvu/B8as5+8bfllWyg0zaNO5bfXj6vfhhwD86/Aq3NfRS9t9WPnhfnvCIw/CT8GLcFTMnpntdF/z9V+PWc/vWoIH+FL3Znv57PitcdGP4R/C34avw5fgRVUInCwbsn1yyA8C8zm/BH8NXoXnVE6wVPjdeCI38kX/3+Ct9dbz1pTmHFRu+Hm4O9Ch3clr99negxfwj+ER/DR8EV6B5+DuQOnTgUw5rnkY+FbNU3gNXh0o/JYTuWOvyBf9FvzX663HH/HejO8LwAl8Hl5YLTd8q7sqA3wbjuExfAFegQdwfyDoSkWY8swzEf6o4Qyewefg+cHNbqMQruSL/u/WWc+E5g7vnnEXgDmcDeSGb/F4cBcCgT+GGRzDU3hZYburAt9TEtHgbM6JoxJ+6NMzzTcf6c2bycv2+KK/f+l6LBzw5IwfqZJhA3M472pWT/ajKxnjv4AFnMEpnBTPND6s2J7qHbPAqcMK74T2mZ4VGB9uJA465It+/eL1WKhYOD7xHOkr1ajK7d0C4+ke4Hy9qXZwpgLr+Znm/uNFw8xQOSy8H9IzjUrd9+BIfenYaylf9FsXr8fBAadnPIEDna8IBcwlxnuA0/Wv6GAWPd7dDIKjMdSWueAsBj4M7TOd06qBbwDwKr7oleuxMOEcTuEZTHWvDYUO7aHqAe0Bbq+HEFRzOz7WVoTDQkVds7A4sIIxfCQdCefFRoIOF/NFL1mPab/nvOakSL/Q1aFtNpUb/nFOVX6gzyg/1nISyDfUhsokIzaBR9Kxm80s5mK+6P56il1jXic7nhQxsxSm3OwBHl4fFdLqi64nDQZvqE2at7cWAp/IVvrN6/BFL1mPhYrGMBfOi4PyjuSGf6wBBh7p/FZTghCNWGgMzlBbrNJoPJX2mW5mwZfyRffXo7OFi5pZcS4qZUrlViptrXtw+GQoyhDPS+ANjcGBNRiLCQDPZPMHuiZfdFpPSTcQwwKYdRNqpkjm7AFeeT0pJzALgo7g8YYGrMHS0iocy+YTm2vyRUvvpXCIpQ5pe666TJrcygnScUf/p0NDs/iAI/nqDHC8TmQT8x3NF91l76oDdQGwu61Z6E0ABv7uO1dbf/37Zlv+Zw/Pbh8f1s4Avur6657/+YYBvur6657/+YYBvur6657/+YYBvur6657/+aYBvuL6657/+VMA8FXWX/f8zzcN8BXXX/f8zzcNMFdbf93zP38KLPiK6697/uebtuArrr/u+Z9vGmCusP6653/+1FjwVdZf9/zPN7oHX339dc//fNMu+irrr3v+50+Bi+Zq6697/uebA/jz8Pudf9ht/fWv517J/XUzAP8C/BAeX9WCDrUpZ3/dEMBxgPcfbtTVvsYV5Yn32u03B3Ac4P3b8I+vxNBKeeL9dRMAlwO83959qGO78sT769oB7g3w/vGVYFzKE++v6wV4OMD7F7tckFkmT7y/rhHgpQO8b+4Y46XyxPvrugBeNcB7BRiX8sT767oAvmCA9woAHsoT76+rBJjLBnh3txOvkifeX1dswZcO8G6N7sXyxPvr6i340gHe3TnqVfLE++uKAb50gHcXLnrX8sR7gNdPRqwzwLu7Y/FO5Yn3AK9jXCMGeHdgxDuVJ75VAI8ljP7PAb3/RfjcZfePHBB+79dpfpH1CanN30d+mT1h9GqAxxJGM5LQeeQ1+Tb+EQJrElLb38VHQ94TRq900aMIo8cSOo+8Dp8QfsB8zpqE1NO3OI9Zrj1h9EV78PqE0WMJnUdeU6E+Jjyk/hbrEFIfeWbvId8H9oTRFwdZaxJGvziW0Hn0gqYB/wyZ0PwRlxJST+BOw9m77Amj14ii1yGM/txYQudN0qDzGe4EqfA/5GJCagsHcPaEPWH0esekSwmjRxM6b5JEcZ4ww50ilvAOFxBSx4yLW+A/YU8YvfY5+ALC6NGEzhtmyZoFZoarwBLeZxUhtY4rc3bKnjB6TKJjFUHzJoTOozF2YBpsjcyxDgzhQ1YRUse8+J4wenwmaylB82hC5w0zoRXUNXaRBmSMQUqiWSWkLsaVqc/ZE0aPTFUuJWgeTei8SfLZQeMxNaZSIzbII4aE1Nmr13P2hNHjc9E9guYNCZ032YlNwESMLcZiLQHkE4aE1BFg0yAR4z1h9AiAGRA0jyZ03tyIxWMajMPWBIsxYJCnlITU5ShiHYdZ94TR4wCmSxg9jtB5KyPGYzymAYexWEMwAPIsAdYdV6aObmNPGD0aYLoEzaMJnTc0Ygs+YDw0GAtqxBjkuP38bMRWCHn73xNGjz75P73WenCEJnhwyVe3AEe8TtKdJcYhBl97wuhNAObK66lvD/9J9NS75v17wuitAN5fe4D31x7g/bUHeH/tAd5fe4D3AO+vPcD7aw/w/toDvL/2AO+vPcD7aw/w/toDvAd4f/24ABzZ8o+KLsSLS+Pv/TqTb3P4hKlQrTGh+fbIBT0Axqznnb+L/V2mb3HkN5Mb/nEHeK7d4IcDld6lmDW/iH9E+AH1MdOw/Jlu2T1xNmY98sv4wHnD7D3uNHu54WUuOsBTbQuvBsPT/UfzNxGYzwkP8c+Yz3C+r/i6DcyRL/rZ+utRwWH5PmfvcvYEt9jLDS/bg0/B64DWKrQM8AL8FPwS9beQCe6EMKNZYJol37jBMy35otdaz0Bw2H/C2Smc7+WGB0HWDELBmOByA3r5QONo4V+DpzR/hFS4U8wMW1PXNB4TOqYz9urxRV++ntWCw/U59Ty9ebdWbrgfRS9AYKKN63ZokZVygr8GZ/gfIhZXIXPsAlNjPOLBby5c1eOLvmQ9lwkOy5x6QV1j5TYqpS05JtUgUHUp5toHGsVfn4NX4RnMCe+AxTpwmApTYxqMxwfCeJGjpXzRF61nbcHhUBPqWze9svwcHJ+S6NPscKrEjug78Dx8Lj3T8D4YxGIdxmJcwhi34fzZUr7olevZCw5vkOhoClq5zBPZAnygD/Tl9EzDh6kl3VhsHYcDEb+hCtJSvuiV69kLDm+WycrOTArHmB5/VYyP6jOVjwgGawk2zQOaTcc1L+aLXrKeveDwZqlKrw8U9Y1p66uK8dEzdYwBeUQAY7DbyYNezBfdWQ97weEtAKYQg2xJIkuveAT3dYeLGH+ShrWNwZgN0b2YL7qznr3g8JYAo5bQBziPjx7BPZ0d9RCQp4UZbnFdzBddor4XHN4KYMrB2qHFRIzzcLAHQZ5the5ovui94PCWAPefaYnxIdzRwdHCbuR4B+tbiy96Lzi8E4D7z7S0mEPd+eqO3cT53Z0Y8SV80XvB4Z0ADJi/f7X113f+7p7/+UYBvur6657/+YYBvur6657/+aYBvuL6657/+aYBvuL6657/+aYBvuL6657/+aYBvuL6657/+VMA8FXWX/f8z58OgK+y/rrnf75RgLna+uue//lTA/CV1V/3/M837aKvvv6653++UQvmauuve/7nTwfAV1N/3fM/fzr24Cuuv+75nz8FFnxl9dc9//MOr/8/glixwRuUfM4AAAAASUVORK5CYII="}function V$e(){return"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEIAAAAhCAAAAABIXyLAAAAAOElEQVRIx2NgGAWjYBSMglEwEICREYRgFBZBqDCSLA2MGPUIVQETE9iNUAqLR5gIeoQKRgwXjwAAGn4AtaFeYLEAAAAASUVORK5CYII="}var H$e=E(E({},va),{tDepth:ur("texture","rgba","ubyte","nearest"),uTexSize:Ge("v2"),dOrthographic:Qt("number"),uNear:Ge("f"),uFar:Ge("f"),uMaxPossibleViewZDiff:Ge("f")});function G$e(e,t){var r=E(E({},ma),{tDepth:N.create(t),uTexSize:N.create(He.create(t.getWidth(),t.getHeight())),dOrthographic:N.create(0),uNear:N.create(1),uFar:N.create(1e4),uMaxPossibleViewZDiff:N.create(.5)}),n=E({},H$e),i=Mn("outlines",_o,p$e),a=Wi(e,"triangles",i,n,r);return qi(a,r)}var q$e=E(E({},va),{tDepth:ur("texture","rgba","ubyte","nearest"),uSamples:Ge("v3[]"),dNSamples:Qt("number"),uProjection:Ge("m4"),uInvProjection:Ge("m4"),uBounds:Ge("v4"),uTexSize:Ge("v2"),uRadius:Ge("f"),uBias:Ge("f")});function W$e(e,t){var r=E(E({},ma),{tDepth:N.create(t),uSamples:N.create([0,0,1]),dNSamples:N.create(1),uProjection:N.create(ue.identity()),uInvProjection:N.create(ue.identity()),uBounds:N.create(_r()),uTexSize:N.create(He.create(e.gl.drawingBufferWidth,e.gl.drawingBufferHeight)),uRadius:N.create(8),uBias:N.create(.025)}),n=E({},q$e),i=Mn("ssao",_o,v$e),a=Wi(e,"triangles",i,n,r);return qi(a,r)}var $$e=E(E({},va),{tSsaoDepth:ur("texture","rgba","ubyte","nearest"),uTexSize:Ge("v2"),uKernel:Ge("f[]"),dOcclusionKernelSize:Qt("number"),uBlurDirectionX:Ge("f"),uBlurDirectionY:Ge("f"),uMaxPossibleViewZDiff:Ge("f"),uNear:Ge("f"),uFar:Ge("f"),uBounds:Ge("v4"),dOrthographic:Qt("number")});function fz(e,t,r){var n=E(E({},ma),{tSsaoDepth:N.create(t),uTexSize:N.create(He.create(t.getWidth(),t.getHeight())),uKernel:N.create([0]),dOcclusionKernelSize:N.create(1),uBlurDirectionX:N.create(r==="horizontal"?1:0),uBlurDirectionY:N.create(r==="vertical"?1:0),uMaxPossibleViewZDiff:N.create(.5),uNear:N.create(0),uFar:N.create(1e4),uBounds:N.create(_r()),dOrthographic:N.create(0)}),i=E({},$$e),a=Mn("ssao_blur",_o,m$e),o=Wi(e,"triangles",a,i,n);return qi(o,n)}function X$e(e){for(var t=e/3,r=Math.floor((e+1)/2),n=[],i=0;i<r;i++)n.push(1/(Math.sqrt(2*Math.PI)*t)*Math.exp(-i*i/(2*t*t)));return n}function Y$e(e,t){for(var r=[],n=0;n<t;n++){var i=(n*n+2*n+1)/(t*t);i=.1+i*(1-.1),r.push(e[n][0]*i),r.push(e[n][1]*i),r.push(e[n][2]*i)}return r}var K$e=E(E({},va),{tSsaoDepth:ur("texture","rgba","ubyte","nearest"),tColor:ur("texture","rgba","ubyte","nearest"),tDepth:ur("texture","rgba","ubyte","nearest"),tOutlines:ur("texture","rgba","ubyte","nearest"),uTexSize:Ge("v2"),dOrthographic:Qt("number"),uNear:Ge("f"),uFar:Ge("f"),uFogNear:Ge("f"),uFogFar:Ge("f"),uFogColor:Ge("v3"),uTransparentBackground:Ge("b"),uMaxPossibleViewZDiff:Ge("f"),dOcclusionEnable:Qt("boolean"),dOutlineEnable:Qt("boolean"),dOutlineScale:Qt("number"),uOutlineThreshold:Ge("f")});function Q$e(e,t,r,n,i){var a=E(E({},ma),{tSsaoDepth:N.create(i),tColor:N.create(t),tDepth:N.create(r),tOutlines:N.create(n),uTexSize:N.create(He.create(t.getWidth(),t.getHeight())),dOrthographic:N.create(0),uNear:N.create(1),uFar:N.create(1e4),uFogNear:N.create(1e4),uFogFar:N.create(1e4),uFogColor:N.create(_.create(1,1,1)),uTransparentBackground:N.create(!1),uMaxPossibleViewZDiff:N.create(.5),dOcclusionEnable:N.create(!1),dOutlineEnable:N.create(!1),dOutlineScale:N.create(1),uOutlineThreshold:N.create(.33)}),o=E({},K$e),s=Mn("postprocessing",_o,g$e),u=Wi(e,"triangles",s,o,a);return qi(u,a)}var Kee={occlusion:I.MappedStatic("on",{on:I.Group({samples:I.Numeric(32,{min:1,max:256,step:1}),radius:I.Numeric(5,{min:0,max:10,step:.1},{description:"Final radius is 2^x."}),bias:I.Numeric(.8,{min:0,max:3,step:.1}),blurKernelSize:I.Numeric(15,{min:1,max:25,step:2})}),off:I.Group({})},{cycle:!0,description:"Darken occluded crevices with the ambient occlusion effect"}),outline:I.MappedStatic("off",{on:I.Group({scale:I.Numeric(1,{min:1,max:5,step:1}),threshold:I.Numeric(.33,{min:.01,max:1,step:.01})}),off:I.Group({})},{cycle:!0,description:"Draw outline around 3D objects"}),antialiasing:I.MappedStatic("smaa",{fxaa:I.Group(b$e),smaa:I.Group(M$e),off:I.Group({})},{options:[["fxaa","FXAA"],["smaa","SMAA"],["off","Off"]],description:"Smooth pixel edges"})},Jl=function(){function e(t,r){this.webgl=t,this.ssaoScale=this.calcSsaoScale();var n=r.colorTarget,i=r.depthTexture,a=n.getWidth(),o=n.getHeight();this.nSamples=1,this.blurKernelSize=1,this.target=t.createRenderTarget(a,o,!1,"uint8","linear"),this.outlinesTarget=t.createRenderTarget(a,o,!1),this.outlinesRenderable=G$e(t,i),this.randomHemisphereVector=[];for(var s=0;s<256;s++){var u=_();u[0]=Math.random()*2-1,u[1]=Math.random()*2-1,u[2]=Math.random(),_.normalize(u,u),_.scale(u,u,Math.random()),this.randomHemisphereVector.push(u)}this.ssaoFramebuffer=t.resources.framebuffer(),this.ssaoBlurFirstPassFramebuffer=t.resources.framebuffer(),this.ssaoBlurSecondPassFramebuffer=t.resources.framebuffer();var l=Math.floor(a*this.ssaoScale),c=Math.floor(o*this.ssaoScale);this.ssaoDepthTexture=t.resources.texture("image-uint8","rgba","ubyte","nearest"),this.ssaoDepthTexture.define(l,c),this.ssaoDepthTexture.attachFramebuffer(this.ssaoFramebuffer,"color0"),this.ssaoDepthBlurProxyTexture=t.resources.texture("image-uint8","rgba","ubyte","nearest"),this.ssaoDepthBlurProxyTexture.define(l,c),this.ssaoDepthBlurProxyTexture.attachFramebuffer(this.ssaoBlurFirstPassFramebuffer,"color0"),this.ssaoDepthTexture.attachFramebuffer(this.ssaoBlurSecondPassFramebuffer,"color0"),this.ssaoRenderable=W$e(t,i),this.ssaoBlurFirstPassRenderable=fz(t,this.ssaoDepthTexture,"horizontal"),this.ssaoBlurSecondPassRenderable=fz(t,this.ssaoDepthBlurProxyTexture,"vertical"),this.renderable=Q$e(t,n.texture,i,this.outlinesTarget.texture,this.ssaoDepthTexture)}return e.isEnabled=function(t){return t.occlusion.name==="on"||t.outline.name==="on"},e.prototype.calcSsaoScale=function(){return Math.min(1,1/this.webgl.pixelRatio)},e.prototype.setSize=function(t,r){var n=this.renderable.values.uTexSize.ref.value,i=n[0],a=n[1],o=this.calcSsaoScale();if(t!==i||r!==a||this.ssaoScale!==o){this.ssaoScale=o;var s=Math.floor(t*this.ssaoScale),u=Math.floor(r*this.ssaoScale);this.target.setSize(t,r),this.outlinesTarget.setSize(t,r),this.ssaoDepthTexture.define(s,u),this.ssaoDepthBlurProxyTexture.define(s,u),N.update(this.renderable.values.uTexSize,He.set(this.renderable.values.uTexSize.ref.value,t,r)),N.update(this.outlinesRenderable.values.uTexSize,He.set(this.outlinesRenderable.values.uTexSize.ref.value,t,r)),N.update(this.ssaoRenderable.values.uTexSize,He.set(this.ssaoRenderable.values.uTexSize.ref.value,s,u)),N.update(this.ssaoBlurFirstPassRenderable.values.uTexSize,He.set(this.ssaoBlurFirstPassRenderable.values.uTexSize.ref.value,s,u)),N.update(this.ssaoBlurSecondPassRenderable.values.uTexSize,He.set(this.ssaoBlurSecondPassRenderable.values.uTexSize.ref.value,s,u))}},e.prototype.updateState=function(t,r,n,i){var a=!1,o=!1,s=!1,u=t.state.mode==="orthographic"?1:0,l=i.outline.name==="on",c=i.occlusion.name==="on",d=ue.identity();if(ue.invert(d,t.projection),i.occlusion.name==="on"){N.update(this.ssaoRenderable.values.uProjection,t.projection),N.update(this.ssaoRenderable.values.uInvProjection,d);var f=this.renderable.values.uTexSize.ref.value,h=f[0],v=f[1],p=this.ssaoRenderable.values.uBounds,m=t.viewport,g=this.ssaoScale;if(_r.set(p.ref.value,Math.floor(m.x*g)/(h*g),Math.floor(m.y*g)/(v*g),Math.ceil((m.x+m.width)*g)/(h*g),Math.ceil((m.y+m.height)*g)/(v*g)),N.update(p,p.ref.value),N.update(this.ssaoBlurFirstPassRenderable.values.uBounds,p.ref.value),N.update(this.ssaoBlurSecondPassRenderable.values.uBounds,p.ref.value),N.updateIfChanged(this.ssaoBlurFirstPassRenderable.values.uNear,t.near),N.updateIfChanged(this.ssaoBlurSecondPassRenderable.values.uNear,t.near),N.updateIfChanged(this.ssaoBlurFirstPassRenderable.values.uFar,t.far),N.updateIfChanged(this.ssaoBlurSecondPassRenderable.values.uFar,t.far),this.ssaoBlurFirstPassRenderable.values.dOrthographic.ref.value!==u&&(s=!0),N.updateIfChanged(this.ssaoBlurFirstPassRenderable.values.dOrthographic,u),N.updateIfChanged(this.ssaoBlurSecondPassRenderable.values.dOrthographic,u),this.nSamples!==i.occlusion.params.samples&&(o=!0,this.nSamples=i.occlusion.params.samples,N.update(this.ssaoRenderable.values.uSamples,Y$e(this.randomHemisphereVector,this.nSamples)),N.updateIfChanged(this.ssaoRenderable.values.dNSamples,this.nSamples)),N.updateIfChanged(this.ssaoRenderable.values.uRadius,Math.pow(2,i.occlusion.params.radius)),N.updateIfChanged(this.ssaoRenderable.values.uBias,i.occlusion.params.bias),this.blurKernelSize!==i.occlusion.params.blurKernelSize){s=!0,this.blurKernelSize=i.occlusion.params.blurKernelSize;var y=X$e(this.blurKernelSize);N.update(this.ssaoBlurFirstPassRenderable.values.uKernel,y),N.update(this.ssaoBlurSecondPassRenderable.values.uKernel,y),N.updateIfChanged(this.ssaoBlurFirstPassRenderable.values.dOcclusionKernelSize,this.blurKernelSize),N.updateIfChanged(this.ssaoBlurSecondPassRenderable.values.dOcclusionKernelSize,this.blurKernelSize)}}if(i.outline.name==="on"){var b=i.outline.params.threshold;t.state.mode==="orthographic"&&(b/=5);var S=Math.pow(1e3,b)/1e3,x=S*t.state.radiusMax,C=i.outline.params.scale-1;N.updateIfChanged(this.outlinesRenderable.values.uNear,t.near),N.updateIfChanged(this.outlinesRenderable.values.uFar,t.far),N.updateIfChanged(this.outlinesRenderable.values.uMaxPossibleViewZDiff,x),N.updateIfChanged(this.renderable.values.uMaxPossibleViewZDiff,x),this.renderable.values.dOutlineScale.ref.value!==C&&(a=!0),N.updateIfChanged(this.renderable.values.dOutlineScale,C)}N.updateIfChanged(this.renderable.values.uFar,t.far),N.updateIfChanged(this.renderable.values.uNear,t.near),N.updateIfChanged(this.renderable.values.uFogFar,t.fogFar),N.updateIfChanged(this.renderable.values.uFogNear,t.fogNear),N.update(this.renderable.values.uFogColor,at.toVec3Normalized(this.renderable.values.uFogColor.ref.value,n)),N.updateIfChanged(this.renderable.values.uTransparentBackground,r),this.renderable.values.dOrthographic.ref.value!==u&&(a=!0),N.updateIfChanged(this.renderable.values.dOrthographic,u),this.renderable.values.dOutlineEnable.ref.value!==l&&(a=!0),N.updateIfChanged(this.renderable.values.dOutlineEnable,l),this.renderable.values.dOcclusionEnable.ref.value!==c&&(a=!0),N.updateIfChanged(this.renderable.values.dOcclusionEnable,c),o&&this.ssaoRenderable.update(),s&&(this.ssaoBlurFirstPassRenderable.update(),this.ssaoBlurSecondPassRenderable.update()),a&&this.renderable.update();var w=this.webgl,A=w.gl,M=w.state;M.enable(A.SCISSOR_TEST),M.disable(A.BLEND),M.disable(A.DEPTH_TEST),M.depthMask(!1);var D=t.viewport,k=D.x,R=D.y,L=D.width,H=D.height;A.viewport(k,R,L,H),A.scissor(k,R,L,H)},e.prototype.render=function(t,r,n,i,a){if(this.updateState(t,n,i,a),a.outline.name==="on"&&(this.outlinesTarget.bind(),this.outlinesRenderable.render()),a.occlusion.name==="on"){var o=t.viewport,s=o.x,u=o.y,l=o.width,c=o.height,d=Math.floor(s*this.ssaoScale),f=Math.floor(u*this.ssaoScale),h=Math.ceil(l*this.ssaoScale),v=Math.ceil(c*this.ssaoScale);this.webgl.gl.viewport(d,f,h,v),this.webgl.gl.scissor(d,f,h,v),this.ssaoFramebuffer.bind(),this.ssaoRenderable.render(),this.ssaoBlurFirstPassFramebuffer.bind(),this.ssaoBlurFirstPassRenderable.render(),this.ssaoBlurSecondPassFramebuffer.bind(),this.ssaoBlurSecondPassRenderable.render(),this.webgl.gl.viewport(s,u,l,c),this.webgl.gl.scissor(s,u,l,c)}r?this.webgl.unbindFramebuffer():this.target.bind();var p=this.webgl,m=p.gl,g=p.state;g.clearColor(0,0,0,1),m.clear(m.COLOR_BUFFER_BIT),this.renderable.render()},e}(),bT=function(){function e(t,r){this.drawPass=r;var n=r.colorTarget,i=n.getWidth(),a=n.getHeight();this.target=t.createRenderTarget(i,a,!1),this.fxaa=new x$e(t,this.target.texture),this.smaa=new D$e(t,this.target.texture)}return e.isEnabled=function(t){return t.antialiasing.name!=="off"},e.prototype.setSize=function(t,r){var n=this.target.texture.getWidth(),i=this.target.texture.getHeight();(t!==n||r!==i)&&(this.target.setSize(t,r),this.fxaa.setSize(t,r),this.smaa.supported&&this.smaa.setSize(t,r))},e.prototype._renderFxaa=function(t,r,n){if(n.antialiasing.name==="fxaa"){var i=Jl.isEnabled(n)?this.drawPass.postprocessing.target.texture:this.drawPass.colorTarget.texture;this.fxaa.update(i,n.antialiasing.params),this.fxaa.render(t.viewport,r?void 0:this.target)}},e.prototype._renderSmaa=function(t,r,n){if(n.antialiasing.name==="smaa"){var i=Jl.isEnabled(n)?this.drawPass.postprocessing.target.texture:this.drawPass.colorTarget.texture;this.smaa.update(i,n.antialiasing.params),this.smaa.render(t.viewport,r?void 0:this.target)}},e.prototype.render=function(t,r,n){if(n.antialiasing.name!=="off"){if(n.antialiasing.name==="fxaa")this._renderFxaa(t,r,n);else if(n.antialiasing.name==="smaa"){if(!this.smaa.supported)throw new Error('SMAA not supported, missing "HTMLImageElement"');this._renderSmaa(t,r,n)}}},e}(),Z$e=`
precision highp float;
precision highp sampler2D;

uniform sampler2D tColor;
uniform vec2 uTexSize;
uniform float uWeight;

void main() {
    vec2 coords = gl_FragCoord.xy / uTexSize;
    gl_FragColor = texture2D(tColor, coords) * uWeight;
}
`,J$e=E(E({},va),{tColor:ur("texture","rgba","ubyte","nearest"),uTexSize:Ge("v2"),uWeight:Ge("f")}),eXe=Mn("compose",_o,Z$e);function tXe(e,t){var r=E(E({},ma),{tColor:N.create(t),uTexSize:N.create(He.create(t.getWidth(),t.getHeight())),uWeight:N.create(1)}),n=E({},J$e),i=Wi(e,"triangles",eXe,n,r);return qi(i,r)}var Qee={mode:I.Select("off",[["off","Off"],["on","On"],["temporal","Temporal"]]),sampleLevel:I.Numeric(2,{min:0,max:5,step:1})},O_=function(){function e(t,r){this.webgl=t,this.drawPass=r;var n=t.extensions,i=n.colorBufferFloat,a=n.textureFloat,o=n.colorBufferHalfFloat,s=n.textureHalfFloat,u=r.colorTarget.getWidth(),l=r.colorTarget.getHeight();this.colorTarget=t.createRenderTarget(u,l,!1);var c=o&&s?"fp16":i&&a?"float32":"uint8";this.composeTarget=t.createRenderTarget(u,l,!1,c),this.holdTarget=t.createRenderTarget(u,l,!1),this.compose=tXe(t,r.colorTarget.texture)}return e.isEnabled=function(t){return t.mode!=="off"},e.prototype.syncSize=function(){var t=this.drawPass.colorTarget.getWidth(),r=this.drawPass.colorTarget.getHeight(),n=this.compose.values.uTexSize.ref.value,i=n[0],a=n[1];(t!==i||r!==a)&&(this.colorTarget.setSize(t,r),this.composeTarget.setSize(t,r),this.holdTarget.setSize(t,r),N.update(this.compose.values.uTexSize,He.set(this.compose.values.uTexSize.ref.value,t,r)))},e.prototype.render=function(t,r,n,i,a,o,s,u){return u.multiSample.mode==="temporal"?this.renderTemporalMultiSample(t,r,n,i,a,o,s,u):(this.renderMultiSample(r,n,i,a,o,s,u),t)},e.prototype.bindOutputTarget=function(t){t?this.webgl.unbindFramebuffer():this.colorTarget.bind()},e.prototype.renderMultiSample=function(t,r,n,i,a,o,s){var u=this,l=u.compose,c=u.composeTarget,d=u.drawPass,f=u.webgl,h=f.gl,v=f.state,p=iD[Math.max(0,Math.min(s.multiSample.sampleLevel,5))],m=r.viewport,g=m.x,y=m.y,b=m.width,S=m.height,x=1/p.length,C=1/32;r.viewOffset.enabled=!0,N.update(l.values.tColor,d.getColorTarget(s.postprocessing).texture),l.update();for(var w=0;w<p.length;++w){var A=p[w];ai.setViewOffset(r.viewOffset,b,S,A[0],A[1],b,S),r.update();var M=-.5+(w+.5)/p.length,D=x+C*M;N.update(l.values.uWeight,D),d.render(t,r,n,i,!1,o,s.postprocessing),c.bind(),v.enable(h.BLEND),v.blendEquationSeparate(h.FUNC_ADD,h.FUNC_ADD),v.blendFuncSeparate(h.ONE,h.ONE,h.ONE,h.ONE),v.disable(h.DEPTH_TEST),v.depthMask(!1),h.viewport(g,y,b,S),h.scissor(g,y,b,S),w===0&&(v.clearColor(0,0,0,0),h.clear(h.COLOR_BUFFER_BIT)),l.render()}N.update(l.values.uWeight,1),N.update(l.values.tColor,c.texture),l.update(),this.bindOutputTarget(a),h.viewport(g,y,b,S),h.scissor(g,y,b,S),v.disable(h.BLEND),l.render(),r.viewOffset.enabled=!1,r.update()},e.prototype.renderTemporalMultiSample=function(t,r,n,i,a,o,s,u){var l=this,c=l.compose,d=l.composeTarget,f=l.holdTarget,h=l.drawPass,v=l.webgl,p=v.gl,m=v.state,g=iD[Math.max(0,Math.min(u.multiSample.sampleLevel,5))];if(t===-2||t>=g.length)return-2;var y=n.viewport,b=y.x,S=y.y,x=y.width,C=y.height,w=1/g.length;if(t===-1)h.render(r,n,i,a,!1,s,u.postprocessing),N.update(c.values.uWeight,1),N.update(c.values.tColor,h.getColorTarget(u.postprocessing).texture),c.update(),f.bind(),m.disable(p.BLEND),m.disable(p.DEPTH_TEST),m.depthMask(!1),p.viewport(b,S,x,C),p.scissor(b,S,x,C),c.render(),t+=1;else{n.viewOffset.enabled=!0,N.update(c.values.tColor,h.getColorTarget(u.postprocessing).texture),N.update(c.values.uWeight,w),c.update();for(var A=Math.pow(2,Math.max(0,u.multiSample.sampleLevel-2)),M=0;M<A;++M){var D=g[t];if(ai.setViewOffset(n.viewOffset,x,C,D[0],D[1],x,C),n.update(),h.render(r,n,i,a,!1,s,u.postprocessing),d.bind(),m.enable(p.BLEND),m.blendEquationSeparate(p.FUNC_ADD,p.FUNC_ADD),m.blendFuncSeparate(p.ONE,p.ONE,p.ONE,p.ONE),m.disable(p.DEPTH_TEST),m.depthMask(!1),p.viewport(b,S,x,C),p.scissor(b,S,x,C),t===0&&(m.clearColor(0,0,0,0),p.clear(p.COLOR_BUFFER_BIT)),c.render(),t+=1,t>=g.length)break}}this.bindOutputTarget(o),p.viewport(b,S,x,C),p.scissor(b,S,x,C);var k=t*w;return k>0&&(N.update(c.values.uWeight,1),N.update(c.values.tColor,d.texture),c.update(),m.disable(p.BLEND),c.render()),k<1&&(N.update(c.values.uWeight,1-k),N.update(c.values.tColor,f.texture),c.update(),k===0?m.disable(p.BLEND):m.enable(p.BLEND),c.render()),n.viewOffset.enabled=!1,n.update(),t>=g.length?-2:t},e}(),iD=[[[0,0]],[[4,4],[-4,-4]],[[-2,-6],[6,-2],[-6,2],[2,6]],[[1,-3],[-1,3],[5,1],[-3,-5],[-5,5],[-7,-1],[3,7],[7,-7]],[[1,1],[-1,-3],[-3,2],[4,-1],[-5,-2],[2,5],[5,3],[3,-5],[-2,6],[0,-7],[-4,-6],[-6,4],[-8,0],[7,-4],[6,7],[-7,-8]],[[-4,-7],[-7,-5],[-3,-5],[-5,-4],[-1,-4],[-2,-2],[-6,-1],[-4,0],[-7,1],[-1,2],[-6,3],[-3,3],[-7,6],[-3,6],[-5,7],[-1,7],[5,-7],[1,-6],[6,-5],[4,-4],[2,-3],[7,-2],[1,-1],[4,-1],[2,1],[6,2],[0,4],[4,4],[2,5],[7,5],[5,6],[3,7]]];iD.forEach(function(e){e.forEach(function(t){t[0]*=.0625,t[1]*=.0625})});var Zee=function(){function e(t){this.multiSamplePass=t,this.sampleIndex=-2}return e.prototype.update=function(t,r){return t&&(this.sampleIndex=-1),r.mode==="temporal"?this.sampleIndex!==-2:!1},e.prototype.render=function(t,r,n,i,a,o,s){this.sampleIndex=this.multiSamplePass.render(this.sampleIndex,t,r,n,i,a,o,s)},e}(),Jee={eyeSeparation:I.Numeric(.064,{min:.01,max:.5,step:.001}),focus:I.Numeric(10,{min:1,max:100,step:.01})},rXe=I.getDefaultValues(Jee),Dg=function(){function e(t,r){r===void 0&&(r={}),this.parent=t,this.left=new hz,this.right=new hz,this.props=E(E({},rXe),r)}return Object.defineProperty(e.prototype,"viewport",{get:function(){return this.parent.viewport},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"viewOffset",{get:function(){return this.parent.viewOffset},enumerable:!1,configurable:!0}),e.prototype.setProps=function(t){Object.assign(this.props,t)},e.prototype.update=function(){this.parent.update(),nXe(this.parent,this.props,this.left,this.right)},e}();(function(e){function t(r){return"left"in r&&"right"in r}e.is=t})(Dg||(Dg={}));var hz=function(){function e(){this.viewport=zi.create(0,0,0,0),this.view=ue(),this.projection=ue(),this.projectionView=ue(),this.inverseProjectionView=ue(),this.state=ai.createDefaultSnapshot(),this.viewOffset=ai.ViewOffset(),this.far=0,this.near=0,this.fogFar=0,this.fogNear=0}return e}(),pz=ue.identity(),vz=ue.identity();function nXe(e,t,r,n){zi.copy(r.viewport,e.viewport),ue.copy(r.view,e.view),ue.copy(r.projection,e.projection),ai.copySnapshot(r.state,e.state),ai.copyViewOffset(r.viewOffset,e.viewOffset),r.far=e.far,r.near=e.near,r.fogFar=e.fogFar,r.fogNear=e.fogNear,zi.copy(n.viewport,e.viewport),ue.copy(n.view,e.view),ue.copy(n.projection,e.projection),ai.copySnapshot(n.state,e.state),ai.copyViewOffset(n.viewOffset,e.viewOffset),n.far=e.far,n.near=e.near,n.fogFar=e.fogFar,n.fogNear=e.fogNear;var i=Math.floor(e.viewport.width/2),a=i/e.viewport.height;r.viewport.width=i,n.viewport.x+=i,n.viewport.width-=i;var o=t.eyeSeparation/2,s=o*e.near/t.focus,u=e.near*Math.tan(e.state.fov*.5),l,c;pz[12]=-o,vz[12]=o,l=-u*a+s,c=u*a+s,r.projection[0]=2*e.near/(c-l),r.projection[8]=(c+l)/(c-l),ue.mul(r.view,r.view,pz),ue.mul(r.projectionView,r.projection,r.view),ue.invert(r.inverseProjectionView,r.projectionView),l=-u*a-s,c=u*a-s,n.projection[0]=2*e.near/(c-l),n.projection[8]=(c+l)/(c-l),ue.mul(n.view,n.view,vz),ue.mul(n.projectionView,n.projection,n.view),ue.invert(n.inverseProjectionView,n.projectionView)}var xT=Math.pow(2,24)-2,iXe=function(){function e(t,r,n){this.webgl=t,this.drawPass=r,this.pickBaseScale=n;var i=n/t.pixelRatio;this.pickWidth=Math.ceil(r.colorTarget.getWidth()*i),this.pickHeight=Math.ceil(r.colorTarget.getHeight()*i),this.objectPickTarget=t.createRenderTarget(this.pickWidth,this.pickHeight),this.instancePickTarget=t.createRenderTarget(this.pickWidth,this.pickHeight),this.groupPickTarget=t.createRenderTarget(this.pickWidth,this.pickHeight),this.depthPickTarget=t.createRenderTarget(this.pickWidth,this.pickHeight)}return Object.defineProperty(e.prototype,"drawingBufferHeight",{get:function(){return this.drawPass.colorTarget.getHeight()},enumerable:!1,configurable:!0}),e.prototype.syncSize=function(){var t=this.pickBaseScale/this.webgl.pixelRatio,r=Math.ceil(this.drawPass.colorTarget.getWidth()*t),n=Math.ceil(this.drawPass.colorTarget.getHeight()*t);(r!==this.pickWidth||n!==this.pickHeight)&&(this.pickWidth=r,this.pickHeight=n,this.objectPickTarget.setSize(this.pickWidth,this.pickHeight),this.instancePickTarget.setSize(this.pickWidth,this.pickHeight),this.groupPickTarget.setSize(this.pickWidth,this.pickHeight),this.depthPickTarget.setSize(this.pickWidth,this.pickHeight))},e.prototype.renderVariant=function(t,r,n,i,a){var o=this.drawPass.depthTexturePrimitives;t.clear(!1),t.update(r),t.renderPick(n.primitives,r,a,null),t.renderPick(n.volumes,r,a,o),t.renderPick(i.handle.scene,r,a,null),i.camera.isEnabled&&(i.camera.update(r),t.update(i.camera.camera),t.renderPick(i.camera.scene,i.camera.camera,a,null))},e.prototype.render=function(t,r,n,i){this.objectPickTarget.bind(),this.renderVariant(t,r,n,i,"pickObject"),this.instancePickTarget.bind(),this.renderVariant(t,r,n,i,"pickInstance"),this.groupPickTarget.bind(),this.renderVariant(t,r,n,i,"pickGroup"),this.depthPickTarget.bind(),this.renderVariant(t,r,n,i,"depth")},e}(),aXe=function(){function e(t,r,n,i,a,o){this.webgl=t,this.renderer=r,this.scene=n,this.helper=i,this.pickPass=a,this.dirty=!0,this.viewport=zi(),this.setViewport(o.x,o.y,o.width,o.height)}return e.prototype.setupBuffers=function(){var t=this.pickWidth*this.pickHeight*4;(!this.objectBuffer||this.objectBuffer.length!==t)&&(this.objectBuffer=new Uint8Array(t),this.instanceBuffer=new Uint8Array(t),this.groupBuffer=new Uint8Array(t),this.depthBuffer=new Uint8Array(t))},e.prototype.setViewport=function(t,r,n,i){zi.set(this.viewport,t,r,n,i),this.pickScale=this.pickPass.pickBaseScale/this.webgl.pixelRatio,this.pickX=Math.ceil(t*this.pickScale),this.pickY=Math.ceil(r*this.pickScale);var a=Math.floor(n*this.pickScale),o=Math.floor(i*this.pickScale);(a!==this.pickWidth||o!==this.pickHeight)&&(this.pickWidth=a,this.pickHeight=o,this.halfPickWidth=Math.floor(this.pickWidth/2),this.setupBuffers())},e.prototype.syncBuffers=function(){var t=this,r=t.pickX,n=t.pickY,i=t.pickWidth,a=t.pickHeight;this.pickPass.objectPickTarget.bind(),this.webgl.readPixels(r,n,i,a,this.objectBuffer),this.pickPass.instancePickTarget.bind(),this.webgl.readPixels(r,n,i,a,this.instanceBuffer),this.pickPass.groupPickTarget.bind(),this.webgl.readPixels(r,n,i,a,this.groupBuffer),this.pickPass.depthPickTarget.bind(),this.webgl.readPixels(r,n,i,a,this.depthBuffer)},e.prototype.getBufferIdx=function(t,r){return(r*this.pickWidth+t)*4},e.prototype.getDepth=function(t,r){var n=this.getBufferIdx(t,r),i=this.depthBuffer;return t6e(i[n],i[n+1],i[n+2],i[n+3])},e.prototype.getId=function(t,r,n){var i=this.getBufferIdx(t,r);return _O(n[i],n[i+1],n[i+2])},e.prototype.render=function(t){var r=this,n=r.pickX,i=r.pickY,a=r.pickWidth,o=r.pickHeight,s=r.halfPickWidth,u=this,l=u.renderer,c=u.scene,d=u.helper;l.setTransparentBackground(!1),l.setDrawingBufferSize(this.pickPass.objectPickTarget.getWidth(),this.pickPass.objectPickTarget.getHeight()),Dg.is(t)?(l.setViewport(n,i,s,o),this.pickPass.render(l,t.left,c,d),l.setViewport(n+s,i,a-s,o),this.pickPass.render(l,t.right,c,d)):(l.setViewport(n,i,a,o),this.pickPass.render(l,t,c,d)),this.dirty=!1},e.prototype.identify=function(t,r,n){var i=this,a=i.webgl,o=i.pickScale;if(!a.isContextLost){t*=a.pixelRatio,r*=a.pixelRatio,r=this.pickPass.drawingBufferHeight-r;var s=this.viewport;if(!(t<s.x||r<s.y||t>s.x+s.width||r>s.y+s.height)){this.dirty&&(this.render(n),this.syncBuffers());var u=t-s.x,l=r-s.y,c=Math.floor(u*o),d=Math.floor(l*o),f=this.getId(c,d,this.objectBuffer);if(!(f===-1||f===xT)){var h=this.getId(c,d,this.instanceBuffer);if(!(h===-1||h===xT)){var v=this.getId(c,d,this.groupBuffer);if(!(v===-1||v===xT)){var p=this.getDepth(c,d),m=_.create(t,s.height-r,p);if(Dg.is(n)){var g=Math.floor(s.width/2);t>s.x+g?(m[0]=s.x+(u-g)*2,bS(m,m,s,n.right.inverseProjectionView)):(m[0]=s.x+u*2,bS(m,m,s,n.left.inverseProjectionView))}else bS(m,m,s,n.inverseProjectionView);return{id:{objectId:f,instanceId:h,groupId:v},position:m}}}}}}},e}(),oXe=`
precision highp float;
precision highp sampler2D;

uniform sampler2D tDepthPrimitives;
uniform sampler2D tDepthVolumes;
uniform vec2 uTexSize;

#include common

float getDepth(const in vec2 coords, sampler2D tDepth) {
    #ifdef dPackedDepth
        return unpackRGBAToDepth(texture2D(tDepth, coords));
    #else
        return texture2D(tDepth, coords).r;
    #endif
}

void main() {
    vec2 coords = gl_FragCoord.xy / uTexSize;
    float depth = min(getDepth(coords, tDepthPrimitives), getDepth(coords, tDepthVolumes));
    gl_FragColor = packDepthToRGBA(depth);
}
`,sXe=`
precision highp float;
precision highp sampler2D;

uniform sampler2D tColor;
uniform vec2 uTexSize;

void main() {
    vec2 coords = gl_FragCoord.xy / uTexSize;
    gl_FragColor = texture2D(tColor, coords);
}
`,uXe=`
precision highp float;

uniform sampler2D tWboitA;
uniform sampler2D tWboitB;
uniform vec2 uTexSize;

void main() {
    vec2 coords = gl_FragCoord.xy / uTexSize;

    vec4 accum = texture2D(tWboitA, coords);
    float r = 1.0 - accum.a;

    accum.a = texture2D(tWboitB, coords).r;
    // divisor needs to allow very small values for nice fading
    gl_FragColor = vec4(accum.rgb / clamp(accum.a, 0.00000001, 50000.0), r);
}
`,lXe=E(E({},va),{tWboitA:ur("texture","rgba","float","nearest"),tWboitB:ur("texture","rgba","float","nearest"),uTexSize:Ge("v2")}),cXe=Mn("evaluate-wboit",_o,uXe);function dXe(e,t,r){var n=E(E({},ma),{tWboitA:N.create(t),tWboitB:N.create(r),uTexSize:N.create(He.create(t.getWidth(),t.getHeight()))}),i=E({},lXe),a=Wi(e,"triangles",cXe,i,n);return qi(a,n)}var fXe=function(){function e(t,r,n){if(this.webgl=t,this._supported=!1,!!e.isSupported(t)){var i=t.resources;this.textureA=i.texture("image-float32","rgba","float","nearest"),this.textureA.define(r,n),this.textureB=i.texture("image-float32","rgba","float","nearest"),this.textureB.define(r,n),this.renderable=dXe(t,this.textureA,this.textureB),this.framebuffer=i.framebuffer(),this._supported=!0,this._init()}}return Object.defineProperty(e.prototype,"supported",{get:function(){return this._supported},enumerable:!1,configurable:!0}),e.prototype.bind=function(){var t=this.webgl,r=t.state,n=t.gl;this.framebuffer.bind(),r.clearColor(0,0,0,1),n.clear(n.COLOR_BUFFER_BIT),r.disable(n.DEPTH_TEST),r.blendFuncSeparate(n.ONE,n.ONE,n.ZERO,n.ONE_MINUS_SRC_ALPHA),r.enable(n.BLEND)},e.prototype.render=function(){var t=this.webgl,r=t.state,n=t.gl;r.blendFuncSeparate(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA),r.enable(n.BLEND),this.renderable.update(),this.renderable.render()},e.prototype.setSize=function(t,r){var n=this.renderable.values.uTexSize.ref.value,i=n[0],a=n[1];(t!==i||r!==a)&&(this.textureA.define(t,r),this.textureB.define(t,r),N.update(this.renderable.values.uTexSize,He.set(this.renderable.values.uTexSize.ref.value,t,r)))},e.prototype.reset=function(){this._supported&&this._init()},e.prototype._init=function(){var t=this.webgl.extensions.drawBuffers;this.framebuffer.bind(),t.drawBuffers([t.COLOR_ATTACHMENT0,t.COLOR_ATTACHMENT1]),this.textureA.attachFramebuffer(this.framebuffer,"color0"),this.textureB.attachFramebuffer(this.framebuffer,"color1")},e.isSupported=function(t){var r=t.extensions,n=r.drawBuffers,i=r.textureFloat,a=r.colorBufferFloat,o=r.depthTexture;if(!i||!a||!o||!n){if(Mr){var s=[];i||s.push("textureFloat"),a||s.push("colorBufferFloat"),o||s.push("depthTexture"),n||s.push("drawBuffers"),console.log('Missing "'+s.join('", "')+'" extensions required for "wboit"')}return!1}else return!0},e}(),hXe=E(E({},va),{tDepthPrimitives:ur("texture","depth","ushort","nearest"),tDepthVolumes:ur("texture","depth","ushort","nearest"),uTexSize:Ge("v2"),dPackedDepth:Qt("boolean")}),pXe=Mn("depth-merge",_o,oXe);function vXe(e,t,r,n){var i=E(E({},ma),{tDepthPrimitives:N.create(t),tDepthVolumes:N.create(r),uTexSize:N.create(He.create(t.getWidth(),t.getHeight())),dPackedDepth:N.create(n)}),a=E({},hXe),o=Wi(e,"triangles",pXe,a,i);return qi(o,i)}var mXe=E(E({},va),{tColor:ur("texture","rgba","ubyte","nearest"),uTexSize:Ge("v2")}),gXe=Mn("copy",_o,sXe);function mz(e,t){var r=E(E({},ma),{tColor:N.create(t),uTexSize:N.create(He.create(t.getWidth(),t.getHeight()))}),n=E({},mXe),i=Wi(e,"triangles",gXe,n,r);return qi(i,r)}var ete=function(){function e(t,r,n,i){this.webgl=t;var a=t.extensions,o=t.resources,s=t.isWebGL2;this.drawTarget=BFe(t.gl),this.colorTarget=t.createRenderTarget(r,n,!0,"uint8","linear"),this.packedDepth=!a.depthTexture,this.depthTarget=t.createRenderTarget(r,n),this.depthTexture=this.depthTarget.texture,this.depthTargetPrimitives=this.packedDepth?t.createRenderTarget(r,n):null,this.depthTargetVolumes=this.packedDepth?t.createRenderTarget(r,n):null,this.depthTexturePrimitives=this.depthTargetPrimitives?this.depthTargetPrimitives.texture:o.texture("image-depth","depth",s?"float":"ushort","nearest"),this.depthTextureVolumes=this.depthTargetVolumes?this.depthTargetVolumes.texture:o.texture("image-depth","depth",s?"float":"ushort","nearest"),this.packedDepth||(this.depthTexturePrimitives.define(r,n),this.depthTextureVolumes.define(r,n)),this.depthMerge=vXe(t,this.depthTexturePrimitives,this.depthTextureVolumes,this.packedDepth),this.wboit=i?new fXe(t,r,n):void 0,this.postprocessing=new Jl(t,this),this.antialiasing=new bT(t,this),this.copyFboTarget=mz(t,this.colorTarget.texture),this.copyFboPostprocessing=mz(t,this.postprocessing.target.texture)}return Object.defineProperty(e.prototype,"wboitEnabled",{get:function(){var t;return!!(!((t=this.wboit)===null||t===void 0)&&t.supported)},enumerable:!1,configurable:!0}),e.prototype.reset=function(){var t;(t=this.wboit)===null||t===void 0||t.reset()},e.prototype.setSize=function(t,r){var n,i=this.colorTarget.getWidth(),a=this.colorTarget.getHeight();(t!==i||r!==a)&&(this.colorTarget.setSize(t,r),this.depthTarget.setSize(t,r),this.depthTargetPrimitives?this.depthTargetPrimitives.setSize(t,r):this.depthTexturePrimitives.define(t,r),this.depthTargetVolumes?this.depthTargetVolumes.setSize(t,r):this.depthTextureVolumes.define(t,r),N.update(this.depthMerge.values.uTexSize,He.set(this.depthMerge.values.uTexSize.ref.value,t,r)),N.update(this.copyFboTarget.values.uTexSize,He.set(this.copyFboTarget.values.uTexSize.ref.value,t,r)),N.update(this.copyFboPostprocessing.values.uTexSize,He.set(this.copyFboPostprocessing.values.uTexSize.ref.value,t,r)),!((n=this.wboit)===null||n===void 0)&&n.supported&&this.wboit.setSize(t,r),this.postprocessing.setSize(t,r),this.antialiasing.setSize(t,r))},e.prototype._depthMerge=function(){var t=this.webgl,r=t.state,n=t.gl;this.depthMerge.update(),this.depthTarget.bind(),r.disable(n.BLEND),r.disable(n.DEPTH_TEST),r.disable(n.CULL_FACE),r.depthMask(!1),r.clearColor(1,1,1,1),n.clear(n.COLOR_BUFFER_BIT),this.depthMerge.render()},e.prototype._renderWboit=function(t,r,n,i,a){var o;if(!(!((o=this.wboit)===null||o===void 0)&&o.supported))throw new Error("expected wboit to be supported");this.colorTarget.bind(),t.clear(!0),this.depthTexturePrimitives.attachFramebuffer(this.colorTarget.framebuffer,"depth"),this.colorTarget.bind(),t.clearDepth(),t.renderWboitOpaque(n.primitives,r,null),this.depthTextureVolumes.attachFramebuffer(this.colorTarget.framebuffer,"depth"),this.colorTarget.bind(),t.clearDepth(),t.renderWboitOpaque(n.volumes,r,this.depthTexturePrimitives),this._depthMerge(),Jl.isEnabled(a)&&this.postprocessing.render(r,!1,i,t.props.backgroundColor,a),this.wboit.bind(),t.renderWboitTransparent(n.primitives,r,this.depthTexture),t.renderWboitTransparent(n.volumes,r,this.depthTexture),Jl.isEnabled(a)?(this.depthTexturePrimitives.attachFramebuffer(this.postprocessing.target.framebuffer,"depth"),this.postprocessing.target.bind()):(this.depthTexturePrimitives.attachFramebuffer(this.colorTarget.framebuffer,"depth"),this.colorTarget.bind()),this.wboit.render()},e.prototype._renderBlended=function(t,r,n,i,a,o){if(i?this.drawTarget.bind():(this.colorTarget.bind(),this.packedDepth||this.depthTexturePrimitives.attachFramebuffer(this.colorTarget.framebuffer,"depth")),t.clear(!0),t.renderBlendedOpaque(n.primitives,r,null),!i){this.depthTargetPrimitives&&(this.depthTargetPrimitives.bind(),t.clear(!1),t.renderDepth(n.primitives,r,null),this.colorTarget.bind()),this.packedDepth||(this.depthTextureVolumes.attachFramebuffer(this.colorTarget.framebuffer,"depth"),t.clearDepth()),t.renderBlendedVolumeOpaque(n.volumes,r,this.depthTexturePrimitives),this.depthTargetVolumes&&(this.depthTargetVolumes.bind(),t.clear(!1),t.renderDepth(n.volumes,r,this.depthTexturePrimitives),this.colorTarget.bind()),this._depthMerge(),this.colorTarget.bind(),Jl.isEnabled(o)&&this.postprocessing.render(r,!1,a,t.props.backgroundColor,o),t.renderBlendedVolumeTransparent(n.volumes,r,this.depthTexturePrimitives);var s=Jl.isEnabled(o)?this.postprocessing.target:this.colorTarget;this.packedDepth||this.depthTexturePrimitives.attachFramebuffer(s.framebuffer,"depth"),s.bind()}t.renderBlendedTransparent(n.primitives,r,null)},e.prototype._render=function(t,r,n,i,a,o,s){var u=n.volumes.renderables.length>0,l=Jl.isEnabled(s),c=bT.isEnabled(s),d=r.viewport,f=d.x,h=d.y,v=d.width,p=d.height;t.setViewport(f,h,v,p),t.update(r),o&&!c&&a&&(this.drawTarget.bind(),t.clear(!1)),this.wboitEnabled?this._renderWboit(t,r,n,o,s):this._renderBlended(t,r,n,!u&&!l&&!c&&a,o,s),l?this.postprocessing.target.bind():!a||u||this.wboitEnabled?this.colorTarget.bind():this.drawTarget.bind(),i.debug.isEnabled&&(i.debug.syncVisibility(),t.renderBlended(i.debug.scene,r,null)),i.handle.isEnabled&&t.renderBlended(i.handle.scene,r,null),i.camera.isEnabled&&(i.camera.update(r),t.update(i.camera.camera),t.renderBlended(i.camera.scene,i.camera.camera,null)),c?this.antialiasing.render(r,a,s):a&&(this.drawTarget.bind(),this.webgl.state.disable(this.webgl.gl.DEPTH_TEST),l?this.copyFboPostprocessing.render():(u||this.wboitEnabled)&&this.copyFboTarget.render()),this.webgl.gl.flush()},e.prototype.render=function(t,r,n,i,a,o,s){t.setTransparentBackground(o),t.setDrawingBufferSize(this.colorTarget.getWidth(),this.colorTarget.getHeight()),Dg.is(r)?(this._render(t,r.left,n,i,a,o,s),this._render(t,r.right,n,i,a,o,s)):this._render(t,r,n,i,a,o,s)},e.prototype.getColorTarget=function(t){return bT.isEnabled(t)?this.antialiasing.target:Jl.isEnabled(t)?this.postprocessing.target:this.colorTarget},e}(),yXe=E(E({},Nt.Params),{alpha:E(E({},Nt.Params.alpha),{defaultValue:.51}),ignoreLight:E(E({},Nt.Params.ignoreLight),{defaultValue:!0}),colorX:I.Color(dr.red,{isEssential:!0}),colorY:I.Color(dr.green,{isEssential:!0}),colorZ:I.Color(dr.blue,{isEssential:!0}),scale:I.Numeric(.33,{min:.1,max:2,step:.1},{isEssential:!0})}),aE={axes:I.MappedStatic("on",{on:I.Group(yXe),off:I.Group({})},{cycle:!0,description:"Show camera orientation axes"})},tte=function(){function e(t,r){var n=this;r===void 0&&(r={}),this.webgl=t,this.props={axes:{name:"off",params:{}}},this.eachGroup=function(i,a){if(!n.renderObject||!aD(i))return!1;for(var o=!1,s=n.renderObject.values.uGroupCount.ref.value,u=i.elements,l=0,c=u;l<c.length;l++){var d=c[l],f=d.groupId,h=d.instanceId,v=h*s+f;a(Te.ofSingleton(v))&&(o=!0)}return o},this.scene=Mg.create(t),this.camera=new ai,_.set(this.camera.up,0,1,0),_.set(this.camera.target,0,0,0),this.setProps(r)}return e.prototype.setProps=function(t){var r=this;this.props=Jk(this.props,function(n){if(t.axes!==void 0&&(n.axes.name=t.axes.name,t.axes.name==="on")){r.scene.clear();var i=E(E({},t.axes.params),{scale:t.axes.params.scale*r.webgl.pixelRatio});r.renderObject=wXe(i),r.renderObject.state.noClip=!0,r.scene.add(r.renderObject),r.scene.commit(),_.set(r.camera.position,0,0,i.scale*200),ue.lookAt(r.camera.view,r.camera.position,r.camera.target,r.camera.up),n.axes.params=E({},t.axes.params)}})},Object.defineProperty(e.prototype,"isEnabled",{get:function(){return this.props.axes.name==="on"},enumerable:!1,configurable:!0}),e.prototype.getLoci=function(t){var r=t.objectId,n=t.groupId,i=t.instanceId;return!this.renderObject||r!==this.renderObject.id||n===0?Or:xXe(this,n,i)},e.prototype.mark=function(t,r){return!So.is(So.Highlighting,r)||!aD(t)||t.data!==this?!1:Sr.mark(this.renderObject,t,r,this.eachGroup)},e.prototype.update=function(t){if(this.renderObject){SXe(this.camera,t.viewport,t.viewOffset),ue.extractRotation(this.scene.view,t.view);var r=this.renderObject.values.boundingSphere.ref.value.radius;ue.setTranslation(this.scene.view,_.create(-t.viewport.width/2+r,-t.viewport.height/2+r,0))}},e}();function bXe(e){switch(e){case 1:return"X Axis";case 2:return"Y Axis";case 3:return"Z Axis";case 4:return"XY Plane";case 5:return"XZ Plane";case 6:return"YZ Plane";default:return"Axes"}}function xXe(e,t,r){return H3("camera-axes",e,[{groupId:t,instanceId:r}],void 0,function(){return bXe(t)})}function aD(e){return e.kind==="data-loci"&&e.tag==="camera-axes"}function SXe(e,t,r){var n=e.near,i=e.far,a=-t.width/2,o=t.width/2,s=t.height/2,u=-t.height/2,l=(o-a)/2,c=(s-u)/2,d=(o+a)/2,f=(s+u)/2,h=d-l,v=d+l,p=f+c,m=f-c;if(r.enabled){var g=(o-a)/r.width,y=(s-u)/r.height;h+=g*r.offsetX,v=h+g*r.width,p-=y*r.offsetY,m=p-y*r.height}ue.ortho(e.projection,h,v,p,m,n,i)}function CXe(e,t){var r=wt.createState(512,256,t),n=.075*e,i=_.scale(_(),_.unitX,e),a=_.scale(_(),_.unitY,e),o=_.scale(_(),_.unitZ,e),s={radiusTop:n,radiusBottom:n,radialSegments:32};r.currentGroup=0,Mi(r,_.origin,n,2),r.currentGroup=1,Mi(r,i,n,2),Ma(r,_.origin,i,1,s),r.currentGroup=2,Mi(r,a,n,2),Ma(r,_.origin,a,1,s),r.currentGroup=3,Mi(r,o,n,2),Ma(r,_.origin,o,1,s),_.scale(i,i,.5),_.scale(a,a,.5),_.scale(o,o,.5),r.currentGroup=4,wt.addTriangle(r,_.origin,i,a),wt.addTriangle(r,_.origin,a,i);var u=_.add(_(),i,a);wt.addTriangle(r,u,i,a),wt.addTriangle(r,u,a,i),r.currentGroup=5,wt.addTriangle(r,_.origin,i,o),wt.addTriangle(r,_.origin,o,i);var l=_.add(_(),i,o);wt.addTriangle(r,l,i,o),wt.addTriangle(r,l,o,i),r.currentGroup=6,wt.addTriangle(r,_.origin,a,o),wt.addTriangle(r,_.origin,o,a);var c=_.add(_(),a,o);return wt.addTriangle(r,c,a,o),wt.addTriangle(r,c,o,a),wt.getMesh(r)}function _Xe(e,t){var r=100*e.scale,n=CXe(r,t==null?void 0:t.geometry);n.setBoundingSphere(Fe.create(_.create(r/2,r/2,r/2),r+r/4));var i=function(a){switch(a){case 1:return e.colorX;case 2:return e.colorY;case 3:return e.colorZ;default:return dr.grey}};return kr.create("axes",{},n,i,function(){return 1},function(){return""})}function wXe(e){var t=_Xe(e);return kr.createRenderObject(t,e)}var EXe={transparentBackground:I.Boolean(!1),multiSample:I.Group(Qee),postprocessing:I.Group(Kee),cameraHelper:I.Group(aE)},AXe=function(){function e(t,r,n,i,a,o,s){this.webgl=t,this.renderer=r,this.scene=n,this.camera=i,this._width=0,this._height=0,this._camera=new ai,this.props=E(E({},I.getDefaultValues(EXe)),s),this.drawPass=new ete(t,128,128,o),this.multiSamplePass=new O_(t,this.drawPass),this.multiSampleHelper=new Zee(this.multiSamplePass),this.helper={camera:new tte(t,this.props.cameraHelper),debug:a.debug,handle:a.handle},this.setSize(1024,768)}return Object.defineProperty(e.prototype,"colorTarget",{get:function(){return this._colorTarget},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return this._width},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height},enumerable:!1,configurable:!0}),e.prototype.setSize=function(t,r){t===this._width&&r===this._height||(this._width=t,this._height=r,this.drawPass.setSize(t,r),this.multiSamplePass.syncSize())},e.prototype.setProps=function(t){t===void 0&&(t={}),Object.assign(this.props,t),t.cameraHelper&&this.helper.camera.setProps(t.cameraHelper)},e.prototype.render=function(){ai.copySnapshot(this._camera.state,this.camera.state),zi.set(this._camera.viewport,0,0,this._width,this._height),this._camera.update(),O_.isEnabled(this.props.multiSample)?(this.multiSampleHelper.render(this.renderer,this._camera,this.scene,this.helper,!1,this.props.transparentBackground,this.props),this._colorTarget=this.multiSamplePass.colorTarget):(this.drawPass.render(this.renderer,this._camera,this.scene,this.helper,!1,this.props.transparentBackground,this.props.postprocessing),this._colorTarget=this.drawPass.getColorTarget(this.props.postprocessing))},e.prototype.getImageData=function(t,r,n){var i,a;this.setSize(t,r),this.render(),this.colorTarget.bind();var o=(i=n==null?void 0:n.width)!==null&&i!==void 0?i:t,s=(a=n==null?void 0:n.height)!==null&&a!==void 0?a:r,u=new Uint8Array(o*s*4);n?this.webgl.readPixels(n.x,r-n.y-n.height,o,s,u):this.webgl.readPixels(0,0,o,s,u);var l=Cp.create(u,o,s);return Cp.flipY(l),Cp.divideByAlpha(l),new ImageData(new Uint8ClampedArray(u),o,s)},e}(),PXe=E(E({},Nt.Params),{alpha:E(E({},Nt.Params.alpha),{defaultValue:1}),ignoreLight:E(E({},Nt.Params.ignoreLight),{defaultValue:!0}),colorX:I.Color(dr.red,{isEssential:!0}),colorY:I.Color(dr.green,{isEssential:!0}),colorZ:I.Color(dr.blue,{isEssential:!0}),scale:I.Numeric(.33,{min:.1,max:2,step:.1},{isEssential:!0})}),rte={handle:I.MappedStatic("off",{on:I.Group(PXe),off:I.Group({})},{cycle:!0,description:"Show handle tool"})},TXe=function(){function e(t,r){var n=this;r===void 0&&(r={}),this.webgl=t,this.props={handle:{name:"off",params:{}}},this._transform=ue(),this.eachGroup=function(i,a){if(!n.renderObject||!gz(i))return!1;for(var o=!1,s=n.renderObject.values.uGroupCount.ref.value,u=i.elements,l=0,c=u;l<c.length;l++){var d=c[l],f=d.groupId,h=d.instanceId,v=h*s+f;a(Te.ofSingleton(v))&&(o=!0)}return o},this.scene=Mg.create(t),this.setProps(r)}return e.prototype.getBoundingSphere=function(t,r){return this.renderObject&&(Fe.copy(t,this.renderObject.values.invariantBoundingSphere.ref.value),ue.fromArray(this._transform,this.renderObject.values.aTransform.ref.value,r*16),Fe.transform(t,t,this._transform)),t},e.prototype.setProps=function(t){var r=this;this.props=Jk(this.props,function(n){if(t.handle!==void 0&&(n.handle.name=t.handle.name,t.handle.name==="on")){r.scene.clear();var i=E(E({},t.handle.params),{scale:t.handle.params.scale*r.webgl.pixelRatio});r.renderObject=RXe(i),r.renderObject.state.noClip=!0,r.scene.add(r.renderObject),r.scene.commit(),n.handle.params=E({},t.handle.params)}})},Object.defineProperty(e.prototype,"isEnabled",{get:function(){return this.props.handle.name==="on"},enumerable:!1,configurable:!0}),e.prototype.update=function(t,r,n){this.renderObject&&(ue.setTranslation(this.renderObject.values.aTransform.ref.value,r),ue.fromMat3(this.renderObject.values.aTransform.ref.value,n),N.update(this.renderObject.values.aTransform,this.renderObject.values.aTransform.ref.value),this.scene.update([this.renderObject],!0))},e.prototype.getLoci=function(t){var r=t.objectId,n=t.groupId,i=t.instanceId;return!this.renderObject||r!==this.renderObject.id?Or:MXe(this,n,i)},e.prototype.mark=function(t,r){return!So.is(So.Highlighting,r)||!gz(t)||t.data!==this?!1:Sr.mark(this.renderObject,t,r,this.eachGroup)},e}();function IXe(e,t){var r=wt.createState(512,256,t),n=.05*e,i=_.scale(_(),_.unitX,e),a=_.scale(_(),_.unitY,e),o=_.scale(_(),_.unitZ,e),s={radiusTop:n,radiusBottom:n,radialSegments:32};return r.currentGroup=sp.TranslateScreenXY,Mi(r,_.origin,n*3,2),r.currentGroup=sp.TranslateObjectX,Mi(r,i,n,2),Ma(r,_.origin,i,1,s),r.currentGroup=sp.TranslateObjectY,Mi(r,a,n,2),Ma(r,_.origin,a,1,s),r.currentGroup=sp.TranslateObjectZ,Mi(r,o,n,2),Ma(r,_.origin,o,1,s),wt.getMesh(r)}var sp={None:0,TranslateScreenXY:1,TranslateObjectX:3,TranslateObjectY:4,TranslateObjectZ:5};function MXe(e,t,r){return H3("handle",e,[{groupId:t,instanceId:r}],function(n){return e.getBoundingSphere(n,r)},function(){return"Handle Helper | Group Id "+t+" | Instance Id "+r})}function gz(e){return e.kind==="data-loci"&&e.tag==="handle"}function DXe(e,t){var r=10*e.scale,n=IXe(r,t==null?void 0:t.geometry);n.setBoundingSphere(Fe.create(_.create(r/2,r/2,r/2),r+r/4));var i=function(a){switch(a){case sp.TranslateObjectX:return e.colorX;case sp.TranslateObjectY:return e.colorY;case sp.TranslateObjectZ:return e.colorZ;default:return dr.grey}};return kr.create("handle",{},n,i,function(){return 1},function(){return""})}function RXe(e){var t=DXe(e);return kr.createRenderObject(t,e)}var kXe={debug:I.Group(JO),camera:I.Group({helper:I.Group(aE)}),handle:I.Group(rte)},OXe=I.getDefaultValues(kXe),LXe=function(){function e(t,r,n){n===void 0&&(n={});var i=E(E({},OXe),n);this.debug=new o$e(t,r,i.debug),this.camera=new tte(t,i.camera.helper),this.handle=new TXe(t,i.handle)}return e}(),NXe=function(){function e(t,r){r===void 0&&(r={}),this.webgl=t;var n=t.gl;this.draw=new ete(t,n.drawingBufferWidth,n.drawingBufferHeight,r.enableWboit||!1),this.pick=new iXe(t,this.draw,r.pickScale||.25),this.multiSample=new O_(t,this.draw)}return e.prototype.updateSize=function(){var t=this.webgl.gl;this.draw.setSize(t.drawingBufferWidth,t.drawingBufferHeight),this.pick.syncSize(),this.multiSample.syncSize()},e}(),gs={camera:I.Group({mode:I.Select("perspective",I.arrayToOptions(["perspective","orthographic"]),{label:"Camera"}),helper:I.Group(aE,{isFlat:!0}),stereo:I.MappedStatic("off",{on:I.Group(Jee),off:I.Group({})},{cycle:!0,hideIf:function(e){return(e==null?void 0:e.mode)!=="perspective"}}),manualReset:I.Boolean(!1,{isHidden:!0})},{pivot:"mode"}),cameraFog:I.MappedStatic("on",{on:I.Group({intensity:I.Numeric(15,{min:1,max:100,step:1})}),off:I.Group({})},{cycle:!0,description:"Show fog in the distance"}),cameraClipping:I.Group({radius:I.Numeric(100,{min:0,max:99,step:1},{label:"Clipping",description:"How much of the scene to show."}),far:I.Boolean(!0,{description:"Hide scene in the distance"})},{pivot:"radius"}),viewport:I.MappedStatic("canvas",{canvas:I.Group({}),"static-frame":I.Group({x:I.Numeric(0),y:I.Numeric(0),width:I.Numeric(128),height:I.Numeric(128)}),"relative-frame":I.Group({x:I.Numeric(.33,{min:0,max:1,step:.01}),y:I.Numeric(.33,{min:0,max:1,step:.01}),width:I.Numeric(.5,{min:.01,max:1,step:.01}),height:I.Numeric(.5,{min:.01,max:1,step:.01})})}),cameraResetDurationMs:I.Numeric(250,{min:0,max:1e3,step:1},{description:"The time it takes to reset the camera."}),transparentBackground:I.Boolean(!1),multiSample:I.Group(Qee),postprocessing:I.Group(Kee),renderer:I.Group(eD),trackball:I.Group(Yee),debug:I.Group(JO),handle:I.Group(rte)},eL=I.getDefaultValues(gs),oD;(function(e){e.DefaultAttribs={antialias:!0,preserveDrawingBuffer:!0,pixelScale:1,pickScale:.25,enableWboit:!0};function t(r,n){n===void 0&&(n={});var i=E(E({},e.DefaultAttribs),n),a=i.antialias,o=i.preserveDrawingBuffer,s=i.pixelScale,u=UFe(r,{antialias:a,preserveDrawingBuffer:o,alpha:!0,depth:!0,premultipliedAlpha:!0});if(u===null)throw new Error("Could not create a WebGL rendering context");var l=J5.fromElement(r,{pixelScale:s}),c=GFe(u,{pixelScale:s}),d=new NXe(c,n);if(Mr){var f=u.getExtension("WEBGL_lose_context");f&&r.addEventListener("mousedown",function(m){c.isContextLost||!m.shiftKey||!m.ctrlKey||!m.altKey||(Mr&&console.log("lose context"),f.loseContext(),setTimeout(function(){c.isContextLost&&(Mr&&console.log("restore context"),f.restoreContext())},1e3))},!1)}var h=new vf(0),v=function(m){c.setContextLost(),m.preventDefault(),Mr&&console.log("context lost"),h.next(Tn())},p=function(){c.isContextLost&&(c.handleContextRestored(function(){d.draw.reset()}),Mr&&console.log("context restored"))};return r.addEventListener("webglcontextlost",v,!1),r.addEventListener("webglcontextrestored",p,!1),{canvas:r,webgl:c,input:l,passes:d,attribs:i,contextLost:h,contextRestored:c.contextRestored,dispose:function(m){l.dispose(),r.removeEventListener("webglcontextlost",v,!1),r.removeEventListener("webglcontextrestored",p,!1),c.destroy(m)}}}e.fromCanvas=t})(oD||(oD={}));var FXe=typeof window<"u"?window.requestAnimationFrame:function(e){return setImmediate(function(){return e(Date.now())})},BXe=typeof window<"u"?window.cancelAnimationFrame:function(e){return clearImmediate(e)},sD;(function(e){function t(r,n){var i=r.webgl,a=r.input,o=r.passes,s=r.attribs;n===void 0&&(n={});var u=E(E({},eL),n),l=new Map,c=new Map,d=new vf(0),f=Tn(),h=new vf(0),v=new vf(0),p=i.gl,m=i.contextRestored,g=0,y=0,b=128,S=128;dt();var x=Mg.create(i),C=new ai({position:_.create(0,0,100),mode:u.camera.mode,fog:u.cameraFog.name==="on"?u.cameraFog.params.intensity:0,clipFar:u.cameraClipping.far},{x:g,y,width:b,height:S},{pixelScale:s.pixelScale}),w=new Dg(C,u.camera.stereo.params),A=rD.create(a,C,u.trackball),M=tD.create(i,u.renderer),D=new LXe(i,x,u),k=new aXe(i,M,x,D,o.pick,{x:g,y,width:b,height:S}),R=new h$e(Ee,W,a,C),L=new Zee(o.multiSample),H=!1,B=void 0,j=void 0,Q=!1,G=!0;function W(Ie){var Ye=Or,tt=or.Empty;if(Ie){var xt=D.camera.getLoci(Ie);if(xt!==Or)return{loci:xt,repr:tt};Ye=D.handle.getLoci(Ie),l.forEach(function(pt,ut){var fe=ut.getLoci(Ie);xu(fe)||(xu(Ye)||console.warn("found another loci, this should not happen"),Ye=fe,tt=ut)})}return{loci:Ye,repr:tt}}function q(Ie,Ye){var tt=Ie.repr,xt=Ie.loci,pt=!1;if(tt?pt=tt.mark(xt,Ye):(pt=D.handle.mark(xt,Ye),pt=D.camera.mark(xt,Ye)||pt,l.forEach(function(fe,me){pt=me.mark(xt,Ye)||pt})),pt){x.update(void 0,!0),D.handle.scene.update(void 0,!0),D.camera.scene.update(void 0,!0);var ut=k.dirty;z(!0),k.dirty=ut}}function ee(Ie){if(i.isContextLost)return!1;var Ye=!1;if(Q&&(ot(!1),Q=!1,Ye=!0),g>p.drawingBufferWidth||g+b<0||y>p.drawingBufferHeight||y+S<0)return!1;var tt=!1;A.update(X);var xt=C.update(),pt=Ie||xt||Ye||he;he=!1;var ut=L.update(pt,u.multiSample);if(pt||ut){var fe=C;u.camera.stereo.name==="on"&&(w.update(),fe=w),O_.isEnabled(u.multiSample)?L.render(M,fe,x,D,!0,u.transparentBackground,u):o.draw.render(M,fe,x,D,!0,u.transparentBackground,u.postprocessing),k.dirty=!0,tt=!0}return tt}var he=!1,$=!1,X=0,U=!1;function z(Ie){U||ee(!!Ie)&&G&&h.next(Tn()-f)}function J(Ie){he=he||!!Ie}var Y=0;function Z(Ie,Ye){X=Ie,Se(Ye==null?void 0:Ye.isSynchronous),C.transition.tick(X),!(Ye!=null&&Ye.manualDraw)&&(z(!1),!C.transition.inTransition&&!i.isContextLost&&R.tick(X))}function te(){Z(Tn()),Y=FXe(te)}function le(Ie){f=Ie,A.start(Ie)}function ye(){U=!1,A.start(Tn()),Y===0&&te()}function be(Ie){Ie===void 0&&(Ie=!1),U=Ie,BXe(Y),Y=0}function Ee(Ie,Ye){var tt=u.camera.stereo.name==="on"?w:C;return i.isContextLost?void 0:k.identify(Ie,Ye,tt)}function Se(Ie){Ie===void 0&&(Ie=!1);var Ye=_e(Ie);Ye&&(ie(),$&&(D.debug.isEnabled&&D.debug.update(),z(!0),$=!1),v.next(Tn()))}function ie(){if(H){var Ie=x.boundingSphereVisible,Ye=Ie.center,tt=Ie.radius,xt=A.props.autoAdjustMinMaxDistance;if(xt.name==="on"){var pt=xt.params.minDistanceFactor*tt+xt.params.minDistancePadding,ut=Math.max(xt.params.maxDistanceFactor*tt,xt.params.maxDistanceMin);A.setProps({minDistance:pt,maxDistance:ut})}if(tt>0){var fe=B===void 0?u.cameraResetDurationMs:B,me=C.getFocus(Ye,tt),we=typeof j=="function"?j(x,C):j,Ke=we?E(E({},me),we):me;C.setState(E(E({},Ke),{radiusMax:x.boundingSphere.radius}),fe)}B=void 0,j=void 0,H=!1}}var oe=Fe(),O=Fe();function V(){if(C.state.radiusMax===0)return!0;if(C.transition.inTransition||j)return!1;var Ie=!0;Fe.set(O,C.state.target,C.state.radius);for(var Ye=0,tt=x.renderables;Ye<tt.length;Ye++){var xt=tt[Ye];if(xt.state.visible){var pt=xt.values.boundingSphere.ref.value;if(pt.radius){var ut=_.distance(O.center,pt.center);if((ut>O.radius||ut>pt.radius||pt.radius>C.state.radiusMax)&&!Fe.includes(oe,pt))return!0;Fe.overlaps(O,pt)&&(Ie=!1)}}}return Ie}var pe=250;function _e(Ie){return x.needsCommit?(Fe.copy(oe,x.boundingSphereVisible),x.commit(Ie?void 0:pe)?(D.debug.isEnabled&&D.debug.update(),!u.camera.manualReset&&(d.value===0||V())&&(H=!0),oe.radius===0&&(B=0),C.setState({radiusMax:x.boundingSphere.radius},0),d.next(l.size),Mr&&Pe(),!0):!1):!0}function Pe(){console.table(x.renderables.map(function(pt){return{drawCount:pt.values.drawCount.ref.value,instanceCount:pt.values.instanceCount.ref.value,materialId:pt.materialId,renderItemId:pt.id}})),console.log(i.stats);var Ie=i.resources.getByteCounts(),Ye=Ie.texture,tt=Ie.attribute,xt=Ie.elements;console.log({texture:(Ye/1024/1024).toFixed(3)+" MiB",attribute:(tt/1024/1024).toFixed(3)+" MiB",elements:(xt/1024/1024).toFixed(3)+" MiB"})}function je(Ie){Xe(Ie);var Ye=l.get(Ie),tt=new Set;Ie.renderObjects.forEach(function(xt){return tt.add(xt)}),Ye?li.areEqual(tt,Ye)||(tt.forEach(function(xt){Ye.has(xt)||x.add(xt)}),Ye.forEach(function(xt){tt.has(xt)||x.remove(xt)})):Ie.renderObjects.forEach(function(xt){return x.add(xt)}),l.set(Ie,tt),x.update(Ie.renderObjects,!1),$=!0,Mr&&Pe()}function ze(Ie){ct(Ie);var Ye=l.get(Ie);Ye&&(Ye.forEach(function(tt){return x.remove(tt)}),l.delete(Ie),$=!0,Mr&&Pe())}function Xe(Ie){c.has(Ie)||c.set(Ie,Ie.updated.subscribe(function(Ye){Ie.state.syncManually||je(Ie)}))}function ct(Ie){var Ye=c.get(Ie);Ye&&(Ye.unsubscribe(),c.delete(Ie))}function Ne(){var Ie=x.boundingSphere.radius>0?100-Math.round(C.transition.target.radius/x.boundingSphere.radius*100):0;return{camera:{mode:C.state.mode,helper:E({},D.camera.props),stereo:E({},u.camera.stereo),manualReset:!!u.camera.manualReset},cameraFog:C.state.fog>0?{name:"on",params:{intensity:C.state.fog}}:{name:"off",params:{}},cameraClipping:{far:C.state.clipFar,radius:Ie},cameraResetDurationMs:u.cameraResetDurationMs,transparentBackground:u.transparentBackground,viewport:u.viewport,postprocessing:E({},u.postprocessing),multiSample:E({},u.multiSample),renderer:E({},M.props),trackball:E({},A.props),debug:E({},D.debug.props),handle:E({},D.handle.props)}}var Qe=m.subscribe(function(){k.dirty=!0,z(!0),z(!0)}),it=new vf(0);function ot(Ie){Ie===void 0&&(Ie=!0),o.updateSize(),dt(),Re(),Ie&&J(!0),it.next(+new Date)}return{webgl:i,add:je,remove:ze,commit:Se,update:function(Ie,Ye){if(Ie){if(!l.has(Ie))return;x.update(Ie.renderObjects,!!Ye)}else x.update(void 0,!!Ye);$=!0},clear:function(){c.forEach(function(Ie){return Ie.unsubscribe()}),c.clear(),l.clear(),x.clear(),D.debug.clear(),J(!0),d.next(l.size)},syncVisibility:function(){C.state.radiusMax===0&&(H=!0,B=0),x.syncVisibility()&&D.debug.isEnabled&&D.debug.update(),J(!0)},requestDraw:J,tick:Z,animate:ye,resetTime:le,pause:be,resume:function(){U=!1},identify:Ee,mark:q,getLoci:W,handleResize:ot,requestResize:function(){Q=!0},requestCameraReset:function(Ie){B=Ie==null?void 0:Ie.durationMs,j=Ie==null?void 0:Ie.snapshot,H=!0},camera:C,boundingSphere:x.boundingSphere,boundingSphereVisible:x.boundingSphereVisible,get notifyDidDraw(){return G},set notifyDidDraw(Ie){G=Ie},didDraw:h,commited:v,reprCount:d,resized:it,setProps:function(Ie,Ye){var tt,xt,pt;Ye===void 0&&(Ye=!1);var ut=typeof Ie=="function"?Hp(Ne(),Ie):Ie,fe=Object.create(null);if(ut.camera&&ut.camera.mode!==void 0&&ut.camera.mode!==C.state.mode&&(fe.mode=ut.camera.mode),ut.cameraFog!==void 0&&ut.cameraFog.params){var me=ut.cameraFog.name==="on"?ut.cameraFog.params.intensity:0;me!==C.state.fog&&(fe.fog=me)}if(ut.cameraClipping!==void 0&&(ut.cameraClipping.far!==void 0&&ut.cameraClipping.far!==C.state.clipFar&&(fe.clipFar=ut.cameraClipping.far),ut.cameraClipping.radius!==void 0)){var we=x.boundingSphere.radius/100*(100-ut.cameraClipping.radius);we>0&&we!==fe.radius&&(fe.radius=Math.max(we,.01))}if(Object.keys(fe).length>0&&C.setState(fe),!((tt=ut.camera)===null||tt===void 0)&&tt.helper&&D.camera.setProps(ut.camera.helper),((xt=ut.camera)===null||xt===void 0?void 0:xt.manualReset)!==void 0&&(u.camera.manualReset=ut.camera.manualReset),((pt=ut.camera)===null||pt===void 0?void 0:pt.stereo)!==void 0&&Object.assign(u.camera.stereo,ut.camera.stereo),ut.cameraResetDurationMs!==void 0&&(u.cameraResetDurationMs=ut.cameraResetDurationMs),ut.transparentBackground!==void 0&&(u.transparentBackground=ut.transparentBackground),ut.viewport!==void 0){var Ke=u.viewport===ut.viewport||u.viewport.name===ut.viewport.name&&RC(u.viewport.params,ut.viewport.params);Ke||(u.viewport=ut.viewport,dt(),Re())}ut.postprocessing&&Object.assign(u.postprocessing,ut.postprocessing),ut.multiSample&&Object.assign(u.multiSample,ut.multiSample),ut.renderer&&M.setProps(ut.renderer),ut.trackball&&A.setProps(ut.trackball),ut.debug&&D.debug.setProps(ut.debug),ut.handle&&D.handle.setProps(ut.handle),fe.mode==="orthographic"&&(u.camera.stereo.name="off"),Ye||J(!0)},getImagePass:function(Ie){return Ie===void 0&&(Ie={}),new AXe(i,M,x,C,D,o.draw.wboitEnabled,Ie)},getRenderObjects:function(){var Ie=[];return x.forEach(function(Ye,tt){return Ie.push(tt)}),Ie},get props(){return Ne()},get input(){return a},get stats(){return M.stats},get interaction(){return R.events},dispose:function(){Qe.unsubscribe(),x.clear(),D.debug.clear(),A.dispose(),M.dispose(),R.dispose()}};function dt(){var Ie=g,Ye=y,tt=b,xt=S;u.viewport.name==="canvas"?(g=0,y=0,b=p.drawingBufferWidth,S=p.drawingBufferHeight):u.viewport.name==="static-frame"?(g=u.viewport.params.x*i.pixelRatio,S=u.viewport.params.height*i.pixelRatio,y=p.drawingBufferHeight-S-u.viewport.params.y*i.pixelRatio,b=u.viewport.params.width*i.pixelRatio):u.viewport.name==="relative-frame"&&(g=Math.round(u.viewport.params.x*p.drawingBufferWidth),S=Math.round(u.viewport.params.height*p.drawingBufferHeight),y=Math.round(p.drawingBufferHeight-S-u.viewport.params.y*p.drawingBufferHeight),b=Math.round(u.viewport.params.width*p.drawingBufferWidth)),(Ie!==g||Ye!==y||tt!==b||xt!==S)&&(he=!0)}function Re(){k.setViewport(g,y,b,S),M.setViewport(g,y,b,S),zi.set(C.viewport,g,y,b,S),zi.set(A.viewport,g,y,b,S)}}e.create=t})(sD||(sD={}));function UXe(e){nte(e)}function nte(e){_t.Canvas3D.ResetSettings.subscribe(e,function(){var t;(t=e.canvas3d)===null||t===void 0||t.setProps(eL),e.events.canvas3d.settingsUpdated.next()}),_t.Canvas3D.SetSettings.subscribe(e,function(t){var r;e.canvas3d&&((r=e.canvas3d)===null||r===void 0||r.setProps(t.settings),e.events.canvas3d.settingsUpdated.next())})}const jXe=Object.freeze(Object.defineProperty({__proto__:null,Canvas3DSetSettings:nte,registerDefault:UXe},Symbol.toStringTag,{value:"Module"}));var Nf=Cu,Ep=fr.Trigger,zXe={hoverHighlightOnly:fr([Ep(0)],"Highlight","Hover element using ${triggers}"),hoverHighlightOnlyExtend:fr([Ep(0,Nf.create({shift:!0}))],"Extend highlight","From selected to hovered element along polymer using ${triggers}")},VXe={bindings:I.Value(zXe,{isHidden:!0}),ignore:I.Value([],{isHidden:!0}),mark:I.Boolean(!0)},HXe=Dr.create({name:"representation-highlight-loci",category:"interaction",ctor:function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.lociMarkProvider=function(n,i){!r.ctx.canvas3d||!r.params.mark||r.ctx.canvas3d.mark(n,i)},r}return t.prototype.register=function(){var r=this;this.subscribeObservable(this.ctx.behaviors.interaction.hover,function(n){var i,a=n.current,o=n.buttons,s=n.modifiers;if(!(!r.ctx.canvas3d||r.ctx.isBusy)){if(((i=r.params.ignore)===null||i===void 0?void 0:i.indexOf(a.loci.kind))>=0){r.ctx.managers.interactivity.lociHighlights.highlightOnly({repr:a.repr,loci:Or});return}var u=!1;fr.match(r.params.bindings.hoverHighlightOnly,o,s)&&(r.ctx.managers.interactivity.lociHighlights.highlightOnly({loci:a.loci}),u=!0),fr.match(r.params.bindings.hoverHighlightOnlyExtend,o,s)&&(r.ctx.managers.interactivity.lociHighlights.highlightOnlyExtend({loci:a.loci}),u=!0),u||r.ctx.managers.interactivity.lociHighlights.highlightOnly({repr:a.repr,loci:Or})}}),this.ctx.managers.interactivity.lociHighlights.addProvider(this.lociMarkProvider)},t.prototype.unregister=function(){this.ctx.managers.interactivity.lociHighlights.removeProvider(this.lociMarkProvider)},t}(Dr.Handler),params:function(){return VXe},display:{name:"Highlight Loci on Canvas"}}),GXe={clickSelect:fr.Empty,clickToggleExtend:fr([Ep(1,Nf.create({shift:!0}))],"Toggle extended selection","${triggers} to extend selection along polymer"),clickSelectOnly:fr.Empty,clickToggle:fr([Ep(1,Nf.create())],"Toggle selection","${triggers} on element"),clickDeselect:fr.Empty,clickDeselectAllOnEmpty:fr([Ep(1,Nf.create())],"Deselect all","Click on nothing using ${triggers}")},qXe={bindings:I.Value(GXe,{isHidden:!0}),ignore:I.Value([],{isHidden:!0}),mark:I.Boolean(!0)},ite=Dr.create({name:"representation-select-loci",category:"interaction",ctor:function(e){Le(t,e);function t(r,n){var i=e.call(this,r,n)||this;return i.lociMarkProvider=function(a,o){!i.ctx.canvas3d||!i.params.mark||i.ctx.canvas3d.mark({loci:a.loci},o)},i.spine=new G1.Impl(r.state.data.cells),i}return t.prototype.applySelectMark=function(r,n){var i=this.ctx.state.data.cells.get(r);if(i&&ge.isRepresentation3D(i.obj)){this.spine.current=i;var a=this.spine.getRootOfType(ge.Molecule.Structure);if(a){n&&this.lociMarkProvider({loci:$e.Loci(a.data)},tr.Deselect);var o=this.ctx.managers.structure.selection.getLoci(a.data);this.lociMarkProvider({loci:o},tr.Select)}}},t.prototype.register=function(){var r=this,n=function(o){return ar.isEmpty(o.loci)},i=function(o){return!ar.isEmpty(o.loci)},a=[["clickSelect",function(o){return r.ctx.managers.interactivity.lociSelects.select(o)},i],["clickToggle",function(o){return r.ctx.managers.interactivity.lociSelects.toggle(o)},i],["clickToggleExtend",function(o){return r.ctx.managers.interactivity.lociSelects.toggleExtend(o)},i],["clickSelectOnly",function(o){return r.ctx.managers.interactivity.lociSelects.selectOnly(o)},i],["clickDeselect",function(o){return r.ctx.managers.interactivity.lociSelects.deselect(o)},i],["clickDeselectAllOnEmpty",function(){return r.ctx.managers.interactivity.lociSelects.deselectAll()},n]];a.sort(function(o,s){var u=r.params.bindings[o[0]],l=r.params.bindings[s[0]],c=u.triggers.length===0?0:Cl(u.triggers.map(function(f){return Nf.size(f.modifiers)})),d=l.triggers.length===0?0:Cl(l.triggers.map(function(f){return Nf.size(f.modifiers)}));return d-c}),this.subscribeObservable(this.ctx.behaviors.interaction.click,function(o){var s,u=o.current,l=o.button,c=o.modifiers;if(!(!r.ctx.canvas3d||r.ctx.isBusy||!r.ctx.selectionMode)&&!(((s=r.params.ignore)===null||s===void 0?void 0:s.indexOf(u.loci.kind))>=0))for(var d=0,f=a;d<f.length;d++){var h=f[d],v=h[0],p=h[1],m=h[2];if(fr.match(r.params.bindings[v],l,c)&&(!m||m(u))){p(u);break}}}),this.ctx.managers.interactivity.lociSelects.addProvider(this.lociMarkProvider),this.subscribeObservable(this.ctx.state.events.object.created,function(o){var s=o.ref;return r.applySelectMark(s)}),this.subscribeObservable(this.ctx.state.events.object.updated,function(o){var s=o.ref,u=o.obj,l=o.oldObj,c=o.oldData,d=o.action,f=r.ctx.state.data.cells.get(s);if(f&&ge.Molecule.Structure.is(f.obj)){var h=u.data,v=d==="recreate"?l==null?void 0:l.data:d==="in-place"?c:void 0;if(v&&$e.areEquivalent(h,v)&&$e.areHierarchiesEqual(h,v))return;for(var p=r.ctx.state.data.select(ir.Generators.ofType(ge.Molecule.Structure.Representation3D,s)),m=0,g=p;m<g.length;m++){var y=g[m];r.applySelectMark(y.transform.ref,!0)}}})},t.prototype.unregister=function(){this.ctx.managers.interactivity.lociSelects.removeProvider(this.lociMarkProvider)},t}(Dr.Handler),params:function(){return qXe},display:{name:"Select Loci on Canvas"}}),WXe=Dr.create({name:"default-loci-label-provider",category:"interaction",ctor:function(){function e(t){this.ctx=t,this.f={label:function(r){var n=[];if(De.is(r)&&r.elements.length===1){var i=r.elements[0].unit,a=Ze.create(r.structure,i,i.elements[0]),o=lt.entity.pdbx_description(a).join(", ");n.push(o)}return n.push(Jf(r)),n.filter(function(s){return!!s}).join("</br>")},group:function(r){return r.toString().replace(/Model [0-9]+/g,"Models")},priority:100}}return e.prototype.register=function(){this.ctx.managers.lociLabels.addProvider(this.f)},e.prototype.unregister=function(){this.ctx.managers.lociLabels.removeProvider(this.f)},e}(),display:{name:"Provide Default Loci Label"}}),$Xe={clickFocus:fr([Ep(1,Nf.create())],"Representation Focus","Click element using ${triggers}"),clickFocusAdd:fr([Ep(1,Nf.create({shift:!0}))],"Representation Focus Add","Click element using ${triggers}"),clickFocusSelectMode:fr([],"Representation Focus","Click element using ${triggers}"),clickFocusAddSelectMode:fr([],"Representation Focus Add","Click element using ${triggers}")},XXe={bindings:I.Value($Xe,{isHidden:!0})},oE=Dr.create({name:"representation-focus-loci",category:"interaction",ctor:function(e){Le(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.register=function(){var r=this;this.subscribeObservable(this.ctx.behaviors.interaction.click,function(n){var i,a=n.current,o=n.button,s=n.modifiers,u=r.params.bindings,l=u.clickFocus,c=u.clickFocusAdd,d=u.clickFocusSelectMode,f=u.clickFocusAddSelectMode,h=r.ctx.managers.interactivity.props.granularity;if(!(h!=="residue"&&h!=="element")){var v=r.ctx.selectionMode?d:l,p=fr.match(v,o,s),m=r.ctx.selectionMode?f:c,g=fr.match(m,o,s);if(!(!p&&!g)){var y=ar.normalize(a.loci,"residue"),b=r.ctx.managers.structure.focus.current;if(b&&ar.areEqual(b.loci,y))r.ctx.managers.structure.focus.clear();else if(p)r.ctx.managers.structure.focus.setFromLoci(y);else{r.ctx.managers.structure.focus.addFromLoci(y);var S=(i=r.ctx.managers.structure.focus.current)===null||i===void 0?void 0:i.loci;S&&r.ctx.managers.camera.focusLoci(S)}}}})},t}(Dr.Handler),params:function(){return XXe},display:{name:"Representation Focus Loci on Canvas"}});const YXe=Object.freeze(Object.defineProperty({__proto__:null,DefaultLociLabelProvider:WXe,FocusLoci:oE,HighlightLoci:HXe,SelectLoci:ite},Symbol.toStringTag,{value:"Module"}));var j0=Cu,z0=fr.Trigger,KXe={clickCenterFocus:fr([z0(1,j0.create()),z0(2,j0.create()),z0(1,j0.create({control:!0}))],"Camera center and focus","Click element using ${triggers}"),clickCenterFocusSelectMode:fr([z0(2,j0.create()),z0(1,j0.create({control:!0}))],"Camera center and focus","Click element using ${triggers}")},QXe={minRadius:I.Numeric(8,{min:1,max:50,step:1}),extraRadius:I.Numeric(4,{min:1,max:50,step:1},{description:"Value added to the bounding-sphere radius of the Loci"}),durationMs:I.Numeric(250,{min:0,max:1e3,step:1},{description:"Camera transition duration"}),bindings:I.Value(KXe,{isHidden:!0})},ZXe=Dr.create({name:"camera-focus-loci",category:"interaction",ctor:function(e){Le(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.register=function(){var r=this;this.subscribeObservable(this.ctx.behaviors.interaction.click,function(n){var i=n.current,a=n.button,o=n.modifiers;if(r.ctx.canvas3d){var s=r.ctx.selectionMode?r.params.bindings.clickCenterFocusSelectMode:r.params.bindings.clickCenterFocus;if(fr.match(s,a,o)){if(ar.isEmpty(i.loci)){_t.Camera.Reset(r.ctx,{});return}var u=ar.normalize(i.loci,r.ctx.managers.interactivity.props.granularity);r.ctx.managers.camera.focusLoci(u,r.params)}}})},t}(Dr.Handler),params:function(){return QXe},display:{name:"Camera Focus Loci on Canvas"}}),JXe=Dr.create({name:"camera-axis-helper",category:"interaction",ctor:function(e){Le(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.register=function(){var r=this,n=0,i=0;this.subscribeObservable(this.ctx.behaviors.interaction.click,function(a){var o=a.current;if(!(!r.ctx.canvas3d||!aD(o.loci))){var s=o.loci.elements[0].groupId;if(s===0){n=0,i=0;return}var u=r.ctx.canvas3d.camera,l,c;if(s>=1&&s<=3){n=0,i=0;var d=_.sub(_(),u.target,u.position),f=_.cross(_(),d,u.up);c=_(),c[s-1]=1,l=_.cross(_(),c,f),_.magnitude(l)===0&&(l=d)}else n===s?i=(i+1)%2:(n=s,i=0),s===4?(c=i?_.unitX:_.unitY,l=_.negUnitZ):s===5?(c=i?_.unitX:_.unitZ,l=_.negUnitY):(c=i?_.unitY:_.unitZ,l=_.negUnitX);r.ctx.canvas3d.requestCameraReset({snapshot:function(h,v){return v.getInvariantFocus(h.boundingSphereVisible.center,h.boundingSphereVisible.radius,c,l)}})}})},t}(Dr.Handler),params:function(){return{}},display:{name:"Camera Axis Helper"}});const eYe=Object.freeze(Object.defineProperty({__proto__:null,CameraAxisHelper:JXe,FocusLoci:ZXe},Symbol.toStringTag,{value:"Module"}));var tYe=Dr.create({name:"structure-info-prop",category:"custom-props",display:{name:"Structure Info"},ctor:function(e){Le(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return Object.defineProperty(t.prototype,"maxModelIndex",{get:function(){for(var r,n,i=-1,a=this.ctx.state.data.select(ir.Generators.rootsOfType(ge.Molecule.Model)),o=0,s=a;o<s.length;o++){var u=s[o],l=((r=u.obj)===null||r===void 0?void 0:r.data)&&Wt.Index.get((n=u.obj)===null||n===void 0?void 0:n.data).value;l!==void 0&&l>i&&(i=l)}return i},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"maxStructureIndex",{get:function(){for(var r,n,i=-1,a=this.ctx.state.data.select(ir.Generators.rootsOfType(ge.Molecule.Structure)),o=0,s=a;o<s.length;o++){var u=s[o],l=((r=u.obj)===null||r===void 0?void 0:r.data)&&$e.Index.get((n=u.obj)===null||n===void 0?void 0:n.data).value;l!==void 0&&l>i&&(i=l)}return i},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"asymIdOffset",{get:function(){for(var r,n=0,i=0,a=this.ctx.state.data.select(ir.Generators.rootsOfType(ge.Molecule.Model)),o=0,s=a;o<s.length;o++){var u=s[o],l=(r=u.obj)===null||r===void 0?void 0:r.data;if(l){var c=Wt.AsymIdCount.get(l),d=Wt.AsymIdOffset.get(l).value;c!==void 0&&d!==void 0&&(n=Math.max(n,d.auth+c.auth),i=Math.max(i,d.label+c.label))}}return{auth:n,label:i}},enumerable:!1,configurable:!0}),t.prototype.handleModel=function(r,n){if(Wt.Index.get(r).value===void 0){var i=n&&Wt.Index.get(n).value,a=i??this.maxModelIndex+1;Wt.Index.set(r,{value:a})}if(Wt.AsymIdOffset.get(r).value===void 0){var o=n&&Wt.AsymIdOffset.get(n).value,a=o??E({},this.asymIdOffset);Wt.AsymIdOffset.set(r,{value:a})}},t.prototype.handleStructure=function(r,n){if(r.parent===void 0&&$e.Index.get(r).value===void 0){var i=n&&$e.Index.get(n).value,a=i??this.maxStructureIndex+1;$e.Index.set(r,{value:a})}},t.prototype.handle=function(r,n,i){if(ge.Molecule.Structure.is(n)){var a=this.ctx.state.data.tree.transforms.get(r);!a.transformer.definition.isDecorator&&n.data.parent===void 0&&this.handleStructure(n.data,i==null?void 0:i.data)}else if(ge.Molecule.Model.is(n)){var a=this.ctx.state.data.tree.transforms.get(r);a.transformer.definition.isDecorator||this.handleModel(n.data,i==null?void 0:i.data)}},t.prototype.register=function(){var r=this;this.ctx.customModelProperties.register(Wt.AsymIdOffset,!0),this.ctx.customModelProperties.register(Wt.Index,!0),this.ctx.customStructureProperties.register($e.Index,!0),this.subscribeObservable(this.ctx.state.data.events.object.created,function(n){r.handle(n.ref,n.obj)}),this.subscribeObservable(this.ctx.state.data.events.object.updated,function(n){r.handle(n.ref,n.obj,n.oldObj)})},t.prototype.unregister=function(){this.ctx.customModelProperties.unregister(Wt.AsymIdOffset.descriptor.name),this.ctx.customModelProperties.unregister(Wt.Index.descriptor.name),this.ctx.customStructureProperties.unregister($e.Index.descriptor.name)},t}(Dr.Handler)}),bf=[-1,1.76,1.87,1.65,1.5,1.4,1.85,1.8,1.6,1.4],ate={ALA:121,ARG:265,ASN:187,ASP:187,CYS:148,GLU:214,GLN:214,GLY:97,HIS:216,ILE:195,LEU:191,LYS:230,MET:203,PHE:228,PRO:154,SER:143,THR:163,TRP:264,TYR:255,VAL:165},rYe=121;function nYe(e){var t=lt.residue.key,r=lt.atom,n=r.type_symbol,i=r.label_atom_id,a=r.label_comp_id,o=e.structure,s=e.atomRadiusType,u=e.serialResidueIndex,l=Ze.create(o),c=0,d=0,f=-1;l.structure=o;for(var h=0,v=0,p=o.units.length;h<p;++h){var m=o.units[h],g=m.elements;l.unit=m,c=-1;for(var y=0,b=g.length;y<b;++y){var S=g[y],x=v+y;l.element=S,d=t(l),c!==d&&++f,c=d;var C=n(l),w=wg(C);if(Z1(w)){s[x]=0,u[x]=-1;continue}var A=i(l),M=dO(m,S);if(M===2||!e.nonPolymer&&!cO(M)){s[x]=0,u[x]=-1;continue}var D=a(l);if(e.traceOnly&&(A!=="CA"&&A!=="BB"||!ate[D])){s[x]=0,u[x]=f;continue}Il(M)?s[x]=aYe(A,C):M===5?s[x]=iYe(A,C,D):s[x]=tL(C),u[x]=f}v+=g.length}}function iYe(e,t,r){switch(t){case"O":return 5;case"S":return 6;case"N":return e==="NZ"?4:3;case"C":switch(e){case"C":case"CE1":case"CE2":case"CE3":case"CH2":case"CZ":case"CZ2":case"CZ3":return 1;case"CA":case"CB":case"CE":case"CG1":case"CG2":return 2;default:switch(r){case"PHE":case"TRP":case"TYR":case"HIS":case"ASP":case"ASN":return 1;case"PRO":case"LYS":case"ARG":case"MET":case"ILE":case"LEU":return 2;case"GLU":case"GLN":return e==="CD"?1:2}}}return tL(t)}function aYe(e,t,r){switch(t){case"C":return 7;case"N":return 8;case"P":return 9;case"O":return 5}return tL(t)}function tL(e){var t=Pb(e),r=bf.indexOf(t);return r===-1&&(r=bf.length,bf[r]=t),r}var yz=5e3;function oYe(e,t){return ce(this,void 0,void 0,function(){var r,n;return de(this,function(i){switch(i.label){case 0:r=t.atomRadiusType,n=0,i.label=1;case 1:return n<r.length?e.shouldUpdate?[4,e.update({message:"Computing per residue surface accessibility...",current:n,max:r.length})]:[3,3]:[3,5];case 2:i.sent(),i.label=3;case 3:sYe(t,n,Math.min(n+yz,r.length)),i.label=4;case 4:return n+=yz,[3,1];case 5:return[2]}})})}function sYe(e,t,r){for(var n=e.structure,i=e.atomRadiusType,a=e.serialResidueIndex,o=e.area,s=e.spherePoints,u=e.scalingConstant,l=e.maxLookupRadius,c=e.probeSize,d=n.lookup3d,f=n.serialMapping,h=n.unitIndexMap,v=n.units,p=f.cumulativeUnitElementCount,m=f.elementIndices,g=f.unitIndices,y=t;y<r;++y){var b=bf[i[y]];if(b!==bf[0]){for(var S=v[g[y]],x=m[y],C=S.conformation.x(x),w=S.conformation.y(x),A=S.conformation.z(x),M=d.find(C,w,A,l),D=M.count,k=M.units,R=M.indices,L=M.squaredDistances,H=c+b,B=c+H,j=[],Q=0;Q<D;++Q){var G=k[Q],W=p[h.get(G.id)]+R[Q],q=m[W],ee=bf[i[W]];if(!(S===G&&x===q||ee===bf[0])){var he=c+ee;if(L[Q]<(B+ee)*(B+ee)){var $=m[W];j[j.length]=[L[Q],(L[Q]+H*H-he*he)/(2*H),G.conformation.x($)-C,G.conformation.y($)-w,G.conformation.z($)-A]}}}j.sort(function(oe,O){return oe[0]-O[0]});var X=0;e:for(var U=0;U<s.length;++U){for(var z=s[U],J=z[0],Y=z[1],Z=z[2],te=0;te<j.length;++te){var le=j[te],ye=le[1],be=le[2],Ee=le[3],Se=le[4],ie=J*be+Y*Ee+Z*Se;if(ie>ye)continue e}++X}o[a[y]]+=u*X*H*H}}}var ote={numberOfSpherePoints:I.Numeric(92,{min:12,max:360,step:1},{description:"Number of sphere points to sample per atom: 92 (original paper), 960 (BioJava), 3000 (EPPIC) - see Shrake A, Rupley JA: Environment and exposure to solvent of protein atoms. Lysozyme and insulin. J Mol Biol 1973."}),probeSize:I.Numeric(1.4,{min:.1,max:4,step:.01},{description:"Corresponds to the size of a water molecule: 1.4 (original paper), 1.5 (occassionally used)"}),nonPolymer:I.Boolean(!1,{description:"Include non-polymer atoms as occluders."}),traceOnly:I.Boolean(!1,{description:"Compute only using alpha-carbons, if true increase probeSize accordingly (e.g., 4 A). Considers only canonical amino acids."})},Rg;(function(e){function t(l,c){var d=this;c===void 0&&(c={});var f=E(E({},I.getDefaultValues(ote)),c);return We.create("Compute Accessible Surface Area",function(h){return ce(d,void 0,void 0,function(){return de(this,function(v){switch(v.label){case 0:return[4,r(h,l,f)];case 1:return[2,v.sent()]}})})})}e.compute=t;function r(l,c,d){return ce(this,void 0,void 0,function(){var f,h,v;return de(this,function(p){switch(p.label){case 0:return f=n(c,d),nYe(f),[4,oYe(l,f)];case 1:return p.sent(),h=f.area,v=f.serialResidueIndex,[2,{area:h,serialResidueIndex:v}]}})})}function n(l,c){var d=l.elementCount,f=l.atomicResidueCount,h=c.probeSize,v=c.nonPolymer,p=c.traceOnly,m=c.numberOfSpherePoints;return{structure:l,probeSize:h,nonPolymer:v,traceOnly:p,spherePoints:i(m),scalingConstant:4*Math.PI/m,maxLookupRadius:2*c.probeSize+2*bf[2],atomRadiusType:new Int8Array(d),serialResidueIndex:new Int32Array(d),area:new Float32Array(f)}}function i(l){for(var c=[],d=Math.PI*(3-Math.sqrt(5)),f=2/l,h=0;h<l;++h){var v=h*f-1+f/2,p=Math.sqrt(1-v*v),m=h*d;c[c.length]=_.create(Math.cos(m)*p,v,Math.sin(m)*p)}return c}function a(l,c){var d=ate[l]||rYe;return c/d}e.normalize=a;function o(l,c){var d=c.area,f=c.serialResidueIndex,h=f[Je.indexOf(Je.ofSortedArray(l.structure.root.serialMapping.elementIndices),l.element)];return h===-1?-1:d[h]}e.getValue=o;function s(l,c){var d=o(l,c);return d===-1?-1:a(lt.atom.label_comp_id(l),d)}e.getNormalizedValue=s;function u(l,c){var d=s(l,c);return d===-1?0:d<.16?1:2}e.getFlag=u})(Rg||(Rg={}));var ST=E({},ote),rL={isBuried:Pg.Dynamic(V7("computed","accessible-surface-area.is-buried",Me.Bool),function(e){if(!Ue.isAtomic(e.element.unit))return!1;var t=Ps.get(e.element.structure).value;return t?Rg.getFlag(e.element,t)===1:!1}),isAccessible:Pg.Dynamic(V7("computed","accessible-surface-area.is-accessible",Me.Bool),function(e){if(!Ue.isAtomic(e.element.unit))return!1;var t=Ps.get(e.element.structure).value;return t?Rg.getFlag(e.element,t)===2:!1})},Ps=Yf.createProvider({label:"Accessible Surface Area",descriptor:yo({name:"molstar_accessible_surface_area",symbols:rL}),type:"root",defaultParams:ST,getParams:function(e){return ST},isApplicable:function(e){return!0},obtain:function(e,t,r){return ce(void 0,void 0,void 0,function(){var n,i;return de(this,function(a){switch(a.label){case 0:return n=E(E({},I.getDefaultValues(ST)),r),i={},[4,Rg.compute(t,n).runInContext(e.runtime)];case 1:return[2,(i.value=a.sent(),i)]}})})}}),CT=at(16448250),uYe="Assigns a color based on the relative accessible surface area of a residue.",ste={list:I.ColorList("rainbow",{presetKind:"scale"})};function lYe(e){return ste}function ute(e,t){var r,n=Pu.create({listOrName:t.list.colors,minLabel:"buried",maxLabel:"exposed",domain:[0,1]}),i=e.structure&&Ps.get(e.structure),a=i?cv(i.id,i.version):-1;if(i!=null&&i.value&&e.structure){var o=Ze.create(e.structure),s=i.value,u=function(l){var c=Rg.getNormalizedValue(l,s);return c===-1?CT:n.color(c)};r=function(l){return Ze.is(l)&&Ue.isAtomic(l.unit)?u(l):Vt.isLocation(l)?(o.unit=l.aUnit,o.element=l.aUnit.elements[l.aIndex],u(o)):CT}}else r=function(){return CT};return{factory:ute,granularity:"group",preferSmoothing:!0,color:r,props:t,contextHash:a,description:uYe,legend:n?n.legend:void 0}}var bz={name:"accessible-surface-area",label:"Accessible Surface Area",category:"Residue Property",factory:ute,getParams:lYe,defaultValues:I.getDefaultValues(ste),isApplicable:function(e){return!!e.structure},ensureCustomProperties:{attach:function(e,t){return t.structure?Ps.attach(e,t.structure,void 0,!0):Promise.resolve()},detach:function(e){return e.structure&&Ps.ref(e.structure,!1)}}},cYe=Dr.create({name:"computed-accessible-surface-area-prop",category:"custom-props",display:{name:"Accessible Surface Area"},ctor:function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.provider=Ps,r.labelProvider={label:function(n){if(r.params.showTooltip)return dYe(n)}},r}return t.prototype.update=function(r){var n=this.params.autoAttach!==r.autoAttach||this.params.showTooltip!==r.showTooltip;return this.params.autoAttach=r.autoAttach,this.params.showTooltip=r.showTooltip,this.ctx.customStructureProperties.setDefaultAutoAttach(this.provider.descriptor.name,this.params.autoAttach),n},t.prototype.register=function(){s_.addCustomProp(this.provider.descriptor),this.ctx.customStructureProperties.register(this.provider,this.params.autoAttach),this.ctx.representation.structure.themes.colorThemeRegistry.add(bz),this.ctx.managers.lociLabels.addProvider(this.labelProvider),this.ctx.query.structure.registry.add(xz),this.ctx.query.structure.registry.add(Sz)},t.prototype.unregister=function(){s_.removeCustomProp(this.provider.descriptor),this.ctx.customStructureProperties.unregister(this.provider.descriptor.name),this.ctx.representation.structure.themes.colorThemeRegistry.remove(bz),this.ctx.managers.lociLabels.removeProvider(this.labelProvider),this.ctx.query.structure.registry.remove(xz),this.ctx.query.structure.registry.remove(Sz)},t}(Dr.Handler),params:function(){return{autoAttach:I.Boolean(!1),showTooltip:I.Boolean(!0)}}});function dYe(e){if(e.kind==="element-loci"){if(e.elements.length===0)return;var t=Ps.get(e.structure).value;if(!t||e.structure.customPropertyDescriptors.hasReference(Ps.descriptor))return;for(var r=e.structure.root.serialMapping.getSerialIndex,n=t.area,i=t.serialResidueIndex,a=new Set,o=0,s=function(v,p){var m=p.elements;Oe.forEach(v,function(g){var y=i[r(p,m[g])];y!==-1&&!a.has(y)&&(o+=n[y],a.add(y))})},u=0,l=e.elements;u<l.length;u++){var c=l[u],d=c.indices,f=c.unit;s(d,f)}if(a.size===0)return;var h="<small>("+a.size+" "+(a.size>1?"Residues sum":"Residue")+")</small>";return"Accessible Surface Area "+h+": "+o.toFixed(2)+" Å<sup>2</sup>"}else if(e.kind==="structure-loci"){var t=Ps.get(e.structure).value;return!t||e.structure.customPropertyDescriptors.hasReference(Ps.descriptor)?void 0:"Accessible Surface Area <small>(Whole Structure)</small>: "+Gy(t.area).toFixed(2)+" Å<sup>2</sup>"}}var xz=Ur("Buried Protein Residues",se.struct.modifier.union([se.struct.modifier.wholeResidues([se.struct.modifier.union([se.struct.generator.atomGroups({"chain-test":se.core.rel.eq([se.ammp("objectPrimitive"),"atomistic"]),"residue-test":rL.isBuried.symbol()})])])]),{description:"Select buried protein residues.",category:Br.Residue,ensureCustomProperties:function(e,t){return Ps.attach(e,t)}}),Sz=Ur("Accessible Protein Residues",se.struct.modifier.union([se.struct.modifier.wholeResidues([se.struct.modifier.union([se.struct.generator.atomGroups({"chain-test":se.core.rel.eq([se.ammp("objectPrimitive"),"atomistic"]),"residue-test":rL.isAccessible.symbol()})])])]),{description:"Select accessible protein residues.",category:Br.Residue,ensureCustomProperties:function(e,t){return Ps.attach(e,t)}}),fYe=Dr.create({name:"computed-interactions-prop",category:"custom-props",display:{name:"Interactions"},ctor:function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.provider=Vn,r.labelProvider={label:function(n){if(r.params.showTooltip)switch(n.kind){case"element-loci":if(n.elements.length===0)return;for(var i=[],a=r.getStructures(n.structure),o=0,s=a;o<s.length;o++){var u=s[o],l=r.provider.get(u).value;if(l){var c=De.remap(n,u);if(c.elements.length===1){var d=c.elements[0];if(Oe.size(d.indices)===1){var f=l.unitsFeatures.get(d.unit.id);if(f){for(var h=[],v=[],p=[],m=Oe.start(d.indices),g=f.types,y=f.groups,b=f.elementsIndex,S=b.indices,x=b.offsets,C=x[m],w=x[m+1];C<w;++C){var A=S[C],M=g[A],D=y[A];M&&h.push(wGe(M)),D&&v.push(EGe(D))}h.length&&p.push("<small>Types</small> "+h.join(", ")),v.length&&p.push("<small>Groups</small> "+v.join(", ")),p.length&&i.push("Interaction Feature: "+p.join(" | "))}}}}}return i.length?i.join("<br/>"):void 0;default:return}}},r}return t.prototype.getStructures=function(r){var n=[],i=this.ctx.helpers.substructureParent.get(r);if(i)for(var a=this.ctx.state.data,o=a.select(ir.Generators.ofType(ge.Molecule.Structure,i.transform.ref)),s=0,u=o;s<u.length;s++){var l=u[s];l.obj&&Pa(n,l.obj.data)}return n},t.prototype.update=function(r){var n=this.params.autoAttach!==r.autoAttach||this.params.showTooltip!==r.showTooltip;return this.params.autoAttach=r.autoAttach,this.params.showTooltip=r.showTooltip,this.ctx.customStructureProperties.setDefaultAutoAttach(this.provider.descriptor.name,this.params.autoAttach),n},t.prototype.register=function(){this.ctx.customStructureProperties.register(this.provider,this.params.autoAttach),this.ctx.representation.structure.themes.colorThemeRegistry.add(Y5),this.ctx.managers.lociLabels.addProvider(this.labelProvider),this.ctx.representation.structure.registry.add(D_)},t.prototype.unregister=function(){this.ctx.customStructureProperties.unregister(this.provider.descriptor.name),this.ctx.representation.structure.themes.colorThemeRegistry.remove(Y5),this.ctx.managers.lociLabels.removeProvider(this.labelProvider),this.ctx.representation.structure.registry.remove(D_)},t}(Dr.Handler),params:function(){return{autoAttach:I.Boolean(!1),showTooltip:I.Boolean(!0)}}}),hYe=Dr.create({name:"computed-secondary-structure-prop",category:"custom-props",display:{name:"Secondary Structure"},ctor:function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.provider=Al,r}return t.prototype.update=function(r){var n=this.params.autoAttach!==r.autoAttach;return this.params.autoAttach=r.autoAttach,this.ctx.customStructureProperties.setDefaultAutoAttach(this.provider.descriptor.name,this.params.autoAttach),n},t.prototype.register=function(){this.ctx.customStructureProperties.register(this.provider,this.params.autoAttach)},t.prototype.unregister=function(){this.ctx.customStructureProperties.unregister(this.provider.descriptor.name)},t}(Dr.Handler),params:function(){return{autoAttach:I.Boolean(!1)}}}),pYe=Dr.create({name:"computed-valence-model-prop",category:"custom-props",display:{name:"Valence Model"},ctor:function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.provider=Fb,r.labelProvider={label:function(n){if(r.params.showTooltip)switch(n.kind){case"element-loci":if(n.elements.length===0)return;for(var i=[],a=r.getStructures(n.structure),o=0,s=a;o<s.length;o++){var u=s[o],l=r.provider.get(u).value;if(l){var c=De.remap(n,u);if(c.elements.length===1){var d=c.elements[0];if(Oe.size(d.indices)===1){var f=l.get(d.unit.id);if(f){var h=Oe.start(d.indices),v=f.charge[h],p=f.idealGeometry[h],m=f.implicitH[h],g=f.totalH[h];i.push("Valence Model: <small>Charge</small> "+v+" | <small>Ideal Geometry</small> "+gGe(p)+" | <small>Implicit H</small> "+m+" | <small>Total H</small> "+g)}}}}}return i.length?i.join("<br/>"):void 0;default:return}}},r}return t.prototype.getStructures=function(r){var n=[],i=this.ctx.helpers.substructureParent.get(r);if(i)for(var a=this.ctx.state.data,o=a.select(ir.Generators.ofType(ge.Molecule.Structure,i.transform.ref)),s=0,u=o;s<u.length;s++){var l=u[s];l.obj&&Pa(n,l.obj.data)}return n},t.prototype.update=function(r){var n=this.params.autoAttach!==r.autoAttach||this.params.showTooltip!==r.showTooltip;return this.params.autoAttach=r.autoAttach,this.params.showTooltip=r.showTooltip,this.ctx.customStructureProperties.setDefaultAutoAttach(this.provider.descriptor.name,this.params.autoAttach),n},t.prototype.register=function(){this.ctx.customStructureProperties.register(this.provider,this.params.autoAttach),this.ctx.managers.lociLabels.addProvider(this.labelProvider)},t.prototype.unregister=function(){this.ctx.customStructureProperties.unregister(this.provider.descriptor.name),this.ctx.managers.lociLabels.removeProvider(this.labelProvider)},t}(Dr.Handler),params:function(){return{autoAttach:I.Boolean(!1),showTooltip:I.Boolean(!0)}}}),_u;(function(e){var t=this;e.Provider=Yp.createProvider({label:"Best Database Sequence Mapping",descriptor:yo({name:"molstar_best_database_sequence_mapping"}),type:"static",defaultParams:{},getParams:function(){return{}},isApplicable:function(a){var o,s;return tn.is(a.sourceData)&&((s=(o=a.sourceData.data.frame.categories)===null||o===void 0?void 0:o.atom_site)===null||s===void 0?void 0:s.fieldNames.indexOf("db_name"))>=0},obtain:function(a,o){return ce(t,void 0,void 0,function(){return de(this,function(s){return[2,{value:i(o)}]})})}});function r(a){var o=a.unit.model,s=e.Provider.get(o).value;if(!s)return"";var u=a.unit.elements[a.element],l=o.atomicHierarchy.residueAtomSegments.offsets[u];return s.accession[l]}e.getKey=r;function n(a){var o=a.unit.model,s=e.Provider.get(o).value;if(s){var u=a.unit.elements[a.element],l=o.atomicHierarchy.residueAtomSegments.offsets[u],c=s.dbName[l];if(c)return c+" "+s.accession[l]+" "+s.num[l]+" "+s.residue[l]}}e.getLabel=n;function i(a){if(tn.is(a.sourceData)){var o=a.sourceData.data.frame.categories.atom_site,s=o.getField("db_name"),u=o.getField("db_acc"),l=o.getField("db_num"),c=o.getField("db_res");if(!(!s||!u||!l||!c)){for(var d=a.atomicHierarchy.atomSourceIndex,f=a.atomicHierarchy.residueAtomSegments,h=f.count,v=f.offsets,p=new Array(h),m=new Array(h),g=new Array(h),y=new Array(h),b=0;b<h;b++){var S=d.value(v[b]);if(s.valueKind(S)!==0){p[S]="",m[S]="",g[S]=0,y[S]="";continue}p[S]=s.str(S),m[S]=u.str(S),g[S]=l.int(S),y[S]=c.str(S)}return{dbName:p,accession:m,num:g,residue:y}}}}})(_u||(_u={}));var _T=at(16448250),vYe="Assigns a color based on best dababase sequence mapping.",V0=new Map,lte=E({},is({type:"colors",colorList:"set-1"}));function mYe(e){return lte}function cte(e,t){var r;if(e.structure){for(var n=0,i=e.structure.models;n<i.length;n++){var a=i[n],o=_u.Provider.get(a).value;if(o)for(var s=0,u=o.accession;s<u.length;s++){var l=u[s];!l||V0.has(l)||V0.set(l,V0.size)}}var c=Ze.create(e.structure),d=Gs(V0.size+1,t,{valueLabel:function(v){return""+v}}),f=new Map,h=function(v){var p=_u.getKey(v);if(!p)return _T;if(f.has(p))return f.get(p);var m=d.color(V0.get(p));return f.set(p,m),m};r=function(v){return Ze.is(v)&&Ue.isAtomic(v.unit)?h(v):Vt.isLocation(v)?(c.unit=v.aUnit,c.element=v.aUnit.elements[v.aIndex],h(c)):_T}}else r=function(){return _T};return{factory:cte,granularity:"group",preferSmoothing:!0,color:r,props:t,description:vYe}}var Cz={name:"best-sequence-database-mapping",label:"Best Database Sequence Mapping",category:"Residue Property",factory:cte,getParams:mYe,defaultValues:I.getDefaultValues(lte),isApplicable:function(e){var t;return!!(!((t=e.structure)===null||t===void 0)&&t.models.some(function(r){return _u.Provider.isApplicable(r)}))},ensureCustomProperties:{attach:function(e,t){return ce(void 0,void 0,void 0,function(){var r,n,i;return de(this,function(a){switch(a.label){case 0:if(!t.structure)return[2];r=0,n=t.structure.models,a.label=1;case 1:return r<n.length?(i=n[r],[4,_u.Provider.attach(e,i,void 0,!0)]):[3,4];case 2:a.sent(),a.label=3;case 3:return r++,[3,1];case 4:return[2]}})})},detach:function(e){if(e.structure)for(var t=0,r=e.structure.models;t<r.length;t++){var n=r[t];_u.Provider.ref(n,!1)}}}},gYe=Dr.create({name:"best-sequence-database-mapping-prop",category:"custom-props",display:{name:"Best Database Sequence Mapping"},ctor:function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.provider=_u.Provider,r.labelProvider={label:function(n){if(r.params.showTooltip)return yYe(n)}},r}return t.prototype.update=function(r){var n=this.params.autoAttach!==r.autoAttach||this.params.showTooltip!==r.showTooltip;return this.params.autoAttach=r.autoAttach,this.params.showTooltip=r.showTooltip,this.ctx.customStructureProperties.setDefaultAutoAttach(this.provider.descriptor.name,this.params.autoAttach),n},t.prototype.register=function(){this.ctx.customModelProperties.register(this.provider,this.params.autoAttach),this.ctx.representation.structure.themes.colorThemeRegistry.add(Cz),this.ctx.managers.lociLabels.addProvider(this.labelProvider)},t.prototype.unregister=function(){this.ctx.customModelProperties.unregister(this.provider.descriptor.name),this.ctx.representation.structure.themes.colorThemeRegistry.remove(Cz),this.ctx.managers.lociLabels.removeProvider(this.labelProvider)},t}(Dr.Handler),params:function(){return{autoAttach:I.Boolean(!0),showTooltip:I.Boolean(!0)}}});function yYe(e){if(e.kind==="element-loci"){if(e.elements.length===0)return;var t=e.elements[0],r=t.unit,n=Ze.create(e.structure,r,r.elements[Oe.getAt(t.indices,0)]);return _u.getLabel(n)}}var Gc;(function(e){e.Descriptor={name:"ihm_cross_link_restraint"},e.Provider=Mu.create(e.Descriptor);function t(r,n){var i={entity_id:r.entity_id_1,asym_id:r.asym_id_1,seq_id:r.seq_id_1,atom_id:r.atom_id_1},a={entity_id:r.entity_id_2,asym_id:r.asym_id_2,seq_id:r.seq_id_2,atom_id:r.atom_id_2};function o(v,p,m){var g=v.get(p);g?g.push(m):v.set(p,[m])}function s(v,p){var m=p.entity_id.value(v),g=p.asym_id.value(v),y=p.seq_id.value(v);if(r.model_granularity.value(v)==="by-atom"){var b=n.atomicHierarchy.index.findAtom({auth_seq_id:y,label_asym_id:g,label_atom_id:p.atom_id.value(v),label_entity_id:m});b>=0&&o(l,b,v)}else if(n.coarseHierarchy.isDefined){var S=n.coarseHierarchy.spheres.findSequenceKey(m,g,y);if(S>=0)o(c,S,v);else{var x=n.coarseHierarchy.gaussians.findSequenceKey(m,g,y);x>=0&&o(d,x,v)}}}function u(v){switch(v){case 0:return l;case 1:return c;case 2:return d}}for(var l=new Map,c=new Map,d=new Map,f=[],h=0;h<r._rowCount;++h)s(h,i),s(h,a);return{getIndicesByElement:function(v,p){var m=u(p),g=m.get(v);return g!==void 0?g:f},data:r}}e.fromTable=t})(Gc||(Gc={}));var bYe=[];function _z(e,t,r,n){return e+"|"+t.id+"|"+r+"|"+n.id}var wz=function(){function e(t){this.pairs=t;var r=new Map;this.pairs.forEach(function(n,i){var a=_z(n.indexA,n.unitA,n.indexB,n.unitB),o=r.get(a);o?o.push(i):r.set(a,[i])}),this.count=t.length,this.pairKeyIndices=r}return e.prototype.getPairIndices=function(t,r,n,i){var a=_z(t,r,n,i);return this.pairKeyIndices.get(a)||bYe},e.prototype.getPairs=function(t,r,n,i){var a=this,o=this.getPairIndices(t,r,n,i);return o.map(function(s){return a.pairs[s]})},e}(),qc=Yf.createProvider({label:"Cross Link Restraint",descriptor:yo({name:"integrative-cross-link-restraint"}),type:"local",defaultParams:{},getParams:function(e){return{}},isApplicable:function(e){return e.models.some(function(t){return!!Gc.Provider.get(t)})},obtain:function(e,t,r){return ce(void 0,void 0,void 0,function(){return de(this,function(n){return[2,{value:CYe(t)}]})})}}),wu;(function(e){(function(v){v.CrossLinkRestraint="cross-link-restraint"})(e.Tag||(e.Tag={}));function t(v){return v.models.some(function(p){return!!Gc.Provider.get(p)})}e.isApplicable=t;var r=_(),n=_();function i(v){return v.unitA.conformation.position(v.unitA.elements[v.indexA],r),v.unitB.conformation.position(v.unitB.elements[v.indexB],n),_.distance(r,n)}e.distance=i;function a(v,p,m){return uK("cross-link-restraints",{structure:p,crossLinkRestraints:v},m)}e.Location=a;function o(v){return!!v&&v.kind==="data-location"&&v.tag==="cross-link-restraints"}e.isLocation=o;function s(v,p){return v.data.structure===p.data.structure&&v.data.crossLinkRestraints===p.data.crossLinkRestraints&&v.element===p.element}e.areLocationsEqual=s;function u(v,p){var m=v.pairs[p];return"Cross Link Restraint | Type: "+m.restraintType+" | Threshold: "+m.distanceThreshold+" Å | Psi: "+m.psi+" | Sigma 1: "+m.sigma1+" | Sigma 2: "+m.sigma2+" | Distance: "+i(m).toFixed(2)+" Å"}function l(v){return u(v.data.crossLinkRestraints,v.element)}e.locationLabel=l;function c(v,p,m){return H3("cross-link-restraints",{structure:v,crossLinkRestraints:p},m,function(g){return f(p,m,g)},function(){return h(v,p,m)})}e.Loci=c;function d(v){return!!v&&v.kind==="data-loci"&&v.tag==="interactions"}e.isLoci=d;function f(v,p,m){return Bc.fromPairProvider(p.length,function(g,y,b){var S=v.pairs[p[g]];S.unitA.conformation.position(S.unitA.elements[S.indexA],y),S.unitB.conformation.position(S.unitB.elements[S.indexB],b)},m)}e.getBoundingSphere=f;function h(v,p,m){var g=m[0];if(g===void 0)return"";var y=p.pairs[g];return[u(p,g),FO(Vt.Location(v,y.unitA,y.indexA,v,y.unitB,y.indexB))].join("</br>")}e.getLabel=h})(wu||(wu={}));function Ez(e,t,r){for(var n=t.elements,i=n.length,a=t.kind,o=function(u){var l=n[u];r.getIndicesByElement(l,a).forEach(function(c){return e.set(c,u)})},s=0;s<i;s++)o(s)}function xYe(e,t,r){if(t.model===r.model&&t.model.sourceData.kind==="mmCIF"){var n=Gc.Provider.get(t.model);if(n){var i=new Map,a=new Map;Ez(i,t,n),Ez(a,r,n),i.forEach(function(o,s){var u=a.get(s);u!==void 0&&e.push(L_(t,o,r,u,n,s),L_(r,u,t,o,n,s))})}}}function SYe(e,t){if(t.model.sourceData.kind==="mmCIF"){var r=Gc.Provider.get(t.model);if(r){for(var n=t.elements,i=n.length,a=t.kind,o=new Map,s=function(l){var c=n[l];r.getIndicesByElement(c,a).forEach(function(d){var f=o.get(d);f?f.push(l):o.set(d,[l])})},u=0;u<i;u++)s(u);o.forEach(function(l,c){if(!(l.length<2)){var d=l[0],f=l[1];e.push(L_(t,d,t,f,r,c),L_(t,f,t,d,r,c))}})}}}function L_(e,t,r,n,i,a){return{unitA:e,indexA:t,unitB:r,indexB:n,restraintType:i.data.restraint_type.value(a),distanceThreshold:i.data.distance_threshold.value(a),psi:i.data.psi.value(a),sigma1:i.data.sigma_1.value(a),sigma2:i.data.sigma_2.value(a)}}function CYe(e){var t=[];if(!e.models.some(function(s){return Gc.Provider.get(s)}))return new wz(t);for(var r=e.units.length,n=0;n<r;++n){var i=e.units[n];SYe(t,i);for(var a=n+1;a<r;++a){var o=e.units[a];i.model===o.model&&xYe(t,i,o)}}return new wz(t)}function _Ye(e,t,r,n,i){var a=qc.get(t).value;if(!a.count)return Nt.createEmpty(i);var o=n.sizeFactor,s=Ze.create(t),u={linkCount:a.count,position:function(l,c,d){var f=a.pairs[d],h=f.unitA,v=f.unitB;h.conformation.position(h.elements[f.indexA],l),v.conformation.position(v.elements[f.indexB],c)},radius:function(l){var c=a.pairs[l];return s.unit=c.unitA,s.element=c.unitA.elements[c.indexA],r.size.size(s)*o}};return _v(e,u,n,i)}var dte=E(E(E({},Nb),Cv),{sizeFactor:I.Numeric(.5,{min:0,max:10,step:.1})});function wYe(e){return xv({defaultProps:I.getDefaultValues(dte),createGeometry:_Ye,createLocationIterator:EYe,getLoci:AYe,eachLocation:PYe,setUpdateState:function(t,r,n){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.radialSegments!==n.radialSegments||r.linkCap!==n.linkCap}},e)}function EYe(e){var t=qc.get(e).value,r=t.pairs,n=r.length,i=1,a=wu.Location(t,e),o=function(s){return a.element=s,a};return mn(n,i,1,o,!0)}function AYe(e,t,r){var n=e.objectId,i=e.groupId;if(r===n){var a=qc.get(t).value,o=a.pairs[i];if(o)return wu.Loci(t,a,[i])}return Or}function PYe(e,t,r){var n=!1;if(wu.isLoci(e)){if(!$e.areEquivalent(e.data.structure,t))return!1;var i=qc.get(t).value;if(e.data.crossLinkRestraints!==i)return!1;for(var a=0,o=e.elements;a<o.length;a++){var s=o[a];r(Te.ofSingleton(s))&&(n=!0)}}return n}var TYe={"cross-link-restraint":function(e,t){return Su("Cross-link restraint",e,t,wYe)}},fte=E({},dte);function IYe(e,t){return I.clone(fte)}function MYe(e,t){return or.createMulti("CrossLinkRestraint",e,t,Ri,TYe)}var Az={name:wu.Tag.CrossLinkRestraint,label:"Cross Link Restraint",description:"Displays cross-link restraints.",factory:MYe,getParams:IYe,defaultValues:I.getDefaultValues(fte),defaultColorTheme:{name:wu.Tag.CrossLinkRestraint},defaultSizeTheme:{name:"uniform"},isApplicable:function(e){return wu.isApplicable(e)},ensureCustomProperties:{attach:function(e,t){return qc.attach(e,t,void 0,!0)},detach:function(e){return qc.ref(e,!1)}}},Pz=at(13421772),DYe="Colors cross-links by the deviation of the observed distance versus the modeled distance (e.g. modeled / `ihm_cross_link_restraint.distance_threshold`).",hte={domain:I.Interval([.5,1.5],{step:.01}),list:I.ColorList("red-grey",{presetKind:"scale"})};function RYe(e){return hte}function pte(e,t){var r,n=void 0,i=e.structure&&qc.get(e.structure).value;if(i){n=Pu.create({domain:t.domain,listOrName:t.list.colors});var a=n.color;r=function(o){if(wu.isLocation(o)){var s=i.pairs[o.element];if(s)return a(wu.distance(s)/s.distanceThreshold)}return Pz}}else r=function(){return Pz};return{factory:pte,granularity:"group",color:r,props:t,description:DYe,legend:n?n.legend:void 0}}var Tz={name:"cross-link",label:"Cross Link",category:"Miscellaneous",factory:pte,getParams:RYe,defaultValues:I.getDefaultValues(hte),isApplicable:function(e){return!!e.structure&&wu.isApplicable(e.structure)},ensureCustomProperties:{attach:function(e,t){return t.structure?qc.attach(e,t.structure,void 0,!0):Promise.resolve()},detach:function(e){return e.structure&&qc.ref(e.structure,!1)}}},kYe=Dr.create({name:"integrative-cross-link-restraint",category:"custom-props",display:{name:"Cross Link Restraint"},ctor:function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.provider=Gc.Provider,r}return t.prototype.register=function(){this.provider.formatRegistry.add("mmCIF",OYe),this.ctx.representation.structure.themes.colorThemeRegistry.add(Tz),this.ctx.representation.structure.registry.add(Az)},t.prototype.unregister=function(){this.provider.formatRegistry.remove("mmCIF"),this.ctx.representation.structure.themes.colorThemeRegistry.remove(Tz),this.ctx.representation.structure.registry.remove(Az)},t}(Dr.Handler)});function OYe(e){if(tn.is(e.sourceData)){var t=e.sourceData.data.db.ihm_cross_link_restraint;if(t._rowCount!==0)return Gc.fromTable(t,e)}}const LYe=Object.freeze(Object.defineProperty({__proto__:null,AccessibleSurfaceArea:cYe,BestDatabaseSequenceMapping:gYe,CrossLinkRestraint:kYe,Interactions:fYe,SecondaryStructure:hYe,StructureInfo:tYe,ValenceModel:pYe},Symbol.toStringTag,{value:"Module"}));var px={State:GWe,Representation:WWe,Camera:XWe,Misc:jXe},Io={Representation:YXe,Camera:eYe,CustomProps:LYe},NYe=function(e){var t=rt.Representation.StructureRepresentation3D.definition.params(void 0,e);return{expandRadius:I.Numeric(5,{min:1,max:10,step:1}),targetParams:I.Group(t,{label:"Target",customDefault:yS(e,void 0,{type:"ball-and-stick",size:"physical",typeParams:{sizeFactor:.26,alpha:.51}})}),surroundingsParams:I.Group(t,{label:"Surroundings",customDefault:yS(e,void 0,{type:"ball-and-stick",size:"physical",typeParams:{sizeFactor:.16}})}),nciParams:I.Group(t,{label:"Non-covalent Int.",customDefault:yS(e,void 0,{type:D_,color:Y5,size:Hi.BuiltIn.uniform})}),components:I.MultiSelect(Iz,I.arrayToOptions(Iz)),excludeTargetFromSurroundings:I.Boolean(!1,{label:"Exclude Target",description:'Exclude the focus "target" from the surroudings component.'}),ignoreHydrogens:I.Boolean(!1)}},Iz=["target","surroundings","interactions"],sn;(function(e){e.TargetSel="structure-focus-target-sel",e.TargetRepr="structure-focus-target-repr",e.SurrSel="structure-focus-surr-sel",e.SurrRepr="structure-focus-surr-repr",e.SurrNciRepr="structure-focus-surr-nci-repr"})(sn||(sn={}));var FYe=new Set([sn.TargetSel,sn.TargetRepr,sn.SurrSel,sn.SurrRepr,sn.SurrNciRepr]),BYe=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.currentSource=void 0,r}return Object.defineProperty(t.prototype,"surrLabel",{get:function(){return"[Focus] Surroundings ("+this.params.expandRadius+" Å)"},enumerable:!1,configurable:!0}),t.prototype.getReprParams=function(r){return E(E({},this.params.targetParams),{type:{name:r.type.name,params:E(E({},r.type.params),{ignoreHydrogens:this.params.ignoreHydrogens})}})},t.prototype.ensureShape=function(r){var n,i=this.plugin.state.data,a=i.tree,o=i.build(),s=ir.findUniqueTagsInSubtree(a,r.transform.ref,FYe);s[sn.TargetSel]||(s[sn.TargetSel]=o.to(r).apply(rt.Model.StructureSelectionFromBundle,{bundle:Jr.Empty,label:"[Focus] Target"},{tags:sn.TargetSel}).ref),s[sn.SurrSel]||(s[sn.SurrSel]=o.to(r).apply(rt.Model.StructureSelectionFromExpression,{expression:se.struct.generator.empty(),label:this.surrLabel},{tags:sn.SurrSel}).ref);var u=this.params.components;return u.indexOf("target")>=0&&!s[sn.TargetRepr]&&(s[sn.TargetRepr]=o.to(s[sn.TargetSel]).apply(rt.Representation.StructureRepresentation3D,this.getReprParams(this.params.targetParams),{tags:sn.TargetRepr}).ref),u.indexOf("surroundings")>=0&&!s[sn.SurrRepr]&&(s[sn.SurrRepr]=o.to(s[sn.SurrSel]).apply(rt.Representation.StructureRepresentation3D,this.getReprParams(this.params.surroundingsParams),{tags:sn.SurrRepr}).ref),u.indexOf("interactions")>=0&&!s[sn.SurrNciRepr]&&r.obj&&D_.isApplicable((n=r.obj)===null||n===void 0?void 0:n.data)&&(s[sn.SurrNciRepr]=o.to(s[sn.SurrSel]).apply(rt.Representation.StructureRepresentation3D,this.params.nciParams,{tags:sn.SurrNciRepr}).ref),{state:i,builder:o,refs:s}},t.prototype.clear=function(r){var n=this.plugin.state.data;this.currentSource=void 0;var i=n.select(ir.Generators.byRef(r).subtree().withTag(sn.TargetSel)),a=n.select(ir.Generators.byRef(r).subtree().withTag(sn.SurrSel));if(!(i.length===0&&a.length===0)){for(var o=n.build(),s=Jr.Empty,u=0,l=i;u<l.length;u++){var c=l[u];o.to(c).update(rt.Model.StructureSelectionFromBundle,function(p){return E(E({},p),{bundle:s})})}for(var d=se.struct.generator.empty(),f=0,h=a;f<h.length;f++){var v=h[f];o.to(v).update(rt.Model.StructureSelectionFromExpression,function(p){return E(E({},p),{expression:d})})}return _t.State.Update(this.plugin,{state:n,tree:o,options:{doNotLogTiming:!0,doNotUpdateCurrent:!0}})}},t.prototype.focus=function(r){return ce(this,void 0,void 0,function(){var n,i,a,o,s,u,l,c,d,f,h=this;return de(this,function(v){switch(v.label){case 0:return n=this.plugin.helpers.substructureParent.get(r.structure),!n||!n.obj?[2]:(this.currentSource=r,i=De.remap(r,n.obj.data),a=De.extendToWholeResidues(i),o=Jr.fromLoci(a),s=Jr.toExpression(o),u=se.struct.modifier.includeSurroundings({0:s,radius:this.params.expandRadius,"as-whole-residues":!0}),this.params.excludeTargetFromSurroundings&&(u=se.struct.modifier.exceptBy({0:u,by:s})),l=this.ensureShape(n),c=l.state,d=l.builder,f=l.refs,d.to(f[sn.TargetSel]).update(rt.Model.StructureSelectionFromBundle,function(p){return E(E({},p),{bundle:o})}),d.to(f[sn.SurrSel]).update(rt.Model.StructureSelectionFromExpression,function(p){return E(E({},p),{expression:u,label:h.surrLabel})}),[4,_t.State.Update(this.plugin,{state:c,tree:d,options:{doNotLogTiming:!0,doNotUpdateCurrent:!0}})]);case 1:return v.sent(),[2]}})})},t.prototype.register=function(r){var n=this;this.subscribeObservable(this.plugin.managers.structure.focus.behaviors.current,function(i){i?n.focus(i.loci):n.clear(cr.RootRef)})},t.prototype.update=function(r){return ce(this,void 0,void 0,function(){var n,i,a,o,s,u,l,c,p,d,f,p,h,v,p;return de(this,function(m){switch(m.label){case 0:if(n=this.params,this.params=r,n.excludeTargetFromSurroundings!==r.excludeTargetFromSurroundings)return this.currentSource&&this.focus(this.currentSource),[2,!0];for(i=this.plugin.state.data,a=i.build(),o=ir.Generators.root.subtree(),s=this.params.components,u=s.indexOf("target")>=0,l=0,c=i.select(o.withTag(sn.TargetRepr));l<c.length;l++)p=c[l],u?a.to(p).update(this.getReprParams(this.params.targetParams)):a.delete(p.transform.ref);for(u=s.indexOf("surroundings")>=0,d=0,f=i.select(o.withTag(sn.SurrRepr));d<f.length;d++)p=f[d],u?a.to(p).update(this.getReprParams(this.params.surroundingsParams)):a.delete(p.transform.ref);for(u=s.indexOf("interactions")>=0,h=0,v=i.select(o.withTag(sn.SurrNciRepr));h<v.length;h++)p=v[h],u?a.to(p).update(this.params.nciParams):a.delete(p.transform.ref);return[4,_t.State.Update(this.plugin,{state:i,tree:a,options:{doNotLogTiming:!0,doNotUpdateCurrent:!0}})];case 1:return m.sent(),r.expandRadius!==n.expandRadius?(this.currentSource&&this.focus(this.currentSource),[2,!0]):[2,!0]}})})},t}(Dr.WithSubscribers),nL=Dr.create({name:"create-structure-focus-representation",display:{name:"Structure Focus Representation"},category:"interaction",ctor:BYe,params:function(e,t){return NYe(t)}});function Ka(e){return e}(function(e){e.CommonParams={ignoreHydrogens:I.Optional(I.Boolean(!1)),quality:I.Optional(I.Select("auto",sO)),theme:I.Optional(I.Group({globalName:I.Optional(I.Text("")),carbonColor:I.Optional(I.Select("chain-id",I.arrayToOptions(["chain-id","operator-name","element-symbol"]))),symmetryColor:I.Optional(I.Text("")),focus:I.Optional(I.Group({name:I.Optional(I.Text("")),params:I.Optional(I.Value({}))}))}))};function t(a){return a==="chain-id"?{name:a,params:RZ.defaultValues}:a==="operator-name"?{name:a,params:LO.defaultValues}:{name:a,params:{}}}function r(a){return a.units.some(function(o){return!o.conformation.operator.assembly&&o.conformation.operator.spgrOp>=0})}function n(a,o,s){var u,l,c,d,f,h,v=a.state.data.build(),p=a.builders.structure.representation,m={quality:a.managers.structure.component.state.options.visualQuality,ignoreHydrogens:!a.managers.structure.component.state.options.showHydrogens};o.quality&&o.quality!=="auto"&&(m.quality=o.quality),o.ignoreHydrogens!==void 0&&(m.ignoreHydrogens=!!o.ignoreHydrogens);var g=!((u=o.theme)===null||u===void 0)&&u.globalName?(l=o.theme)===null||l===void 0?void 0:l.globalName:void 0,y=((c=o.theme)===null||c===void 0?void 0:c.carbonColor)!==void 0?{carbonColor:t((d=o.theme)===null||d===void 0?void 0:d.carbonColor)}:{},b=s&&(!((f=o.theme)===null||f===void 0)&&f.symmetryColor)&&r(s)?(h=o.theme)===null||h===void 0?void 0:h.symmetryColor:g;return{update:v,builder:p,color:g,symmetryColor:b,typeParams:m,ballAndStickColor:y}}e.reprBuilder=n;function i(a,o,s,u){return a.state.updateBehavior(nL,function(l){var c=K5(a,o,"ball-and-stick",s||"element-symbol",u);l.surroundingsParams.colorTheme=c,l.targetParams.colorTheme=c})}e.updateFocusRepr=i})(Ka||(Ka={}));var s0=Ka.CommonParams,Ub=Ka.reprBuilder,sE=Ka.updateFocusRepr,UYe=Ka({id:"preset-structure-representation-auto",display:{name:"Automatic",description:"Show representations based on the size of the structure. Smaller structures are shown with more detail than larger ones, ranging from atomistic display to coarse surfaces."},params:function(){return s0},apply:function(e,t,r){var n,i,a=(i=(n=Ii.resolveAndCheck(r.state.data,e))===null||n===void 0?void 0:n.obj)===null||i===void 0?void 0:i.data;if(!a)return{};var o=r.config.get(Wr.Structure.SizeThresholds)||$e.DefaultSizeThresholds,s=$e.getSize(a,o),u=a.polymerResidueCount/a.polymerGapCount;switch(s){case $e.Size.Gigantic:case $e.Size.Huge:return mte.apply(e,t,r);case $e.Size.Large:return gte.apply(e,t,r);case $e.Size.Medium:if(u>3)return vte.apply(e,t,r);case $e.Size.Small:return yte.apply(e,E(E({},t),{showCarbohydrateSymbol:!0}),r);default:U5()}}}),jYe=Ka({id:"preset-structure-representation-empty",display:{name:"Empty",description:"Removes all existing representations."},apply:function(e,t,r){return ce(this,void 0,void 0,function(){return de(this,function(n){return[2,{}]})})}}),jb="Basic",vte=Ka({id:"preset-structure-representation-polymer-and-ligand",display:{name:"Polymer & Ligand",group:jb,description:"Shows polymers as Cartoon, ligands as Ball & Stick, carbohydrates as 3D-SNFG and water molecules semi-transparent."},params:function(){return s0},apply:function(e,t,r){var n,i,a,o,s,u,l,c,d,f;return ce(this,void 0,void 0,function(){var h,v,p,m,g,y,b,S,x,C,w,A,M,D,k;return de(this,function(R){switch(R.label){case 0:return h=Ii.resolveAndCheck(r.state.data,e),h?(k={},[4,Ro(r,h,"polymer")]):[2,{}];case 1:return k.polymer=R.sent(),[4,Ro(r,h,"ligand")];case 2:return k.ligand=R.sent(),[4,Ro(r,h,"non-standard")];case 3:return k.nonStandard=R.sent(),[4,Ro(r,h,"branched",{label:"Carbohydrate"})];case 4:return k.branched=R.sent(),[4,Ro(r,h,"water")];case 5:return k.water=R.sent(),[4,Ro(r,h,"ion")];case 6:return k.ion=R.sent(),[4,Ro(r,h,"lipid")];case 7:return k.lipid=R.sent(),[4,Ro(r,h,"coarse")];case 8:return v=(k.coarse=R.sent(),k),p=h.obj.data,m={sizeFactor:p.isCoarseGrained?.8:.2},g=(((a=(i=(n=v.water)===null||n===void 0?void 0:n.obj)===null||i===void 0?void 0:i.data)===null||a===void 0?void 0:a.elementCount)||0)>5e4?"line":"ball-and-stick",y=(((u=(s=(o=v.lipid)===null||o===void 0?void 0:o.obj)===null||s===void 0?void 0:s.data)===null||u===void 0?void 0:u.elementCount)||0)>2e4?"line":"ball-and-stick",b=Ub(r,t,p),S=b.update,x=b.builder,C=b.typeParams,w=b.color,A=b.symmetryColor,M=b.ballAndStickColor,D={polymer:x.buildRepresentation(S,v.polymer,{type:"cartoon",typeParams:E(E({},C),m),color:A},{tag:"polymer"}),ligand:x.buildRepresentation(S,v.ligand,{type:"ball-and-stick",typeParams:C,color:w,colorParams:M},{tag:"ligand"}),nonStandard:x.buildRepresentation(S,v.nonStandard,{type:"ball-and-stick",typeParams:C,color:w,colorParams:M},{tag:"non-standard"}),branchedBallAndStick:x.buildRepresentation(S,v.branched,{type:"ball-and-stick",typeParams:E(E({},C),{alpha:.3}),color:w,colorParams:M},{tag:"branched-ball-and-stick"}),branchedSnfg3d:x.buildRepresentation(S,v.branched,{type:"carbohydrate",typeParams:C,color:w},{tag:"branched-snfg-3d"}),water:x.buildRepresentation(S,v.water,{type:g,typeParams:E(E({},C),{alpha:.6}),color:w,colorParams:{carbonColor:{name:"element-symbol",params:{}}}},{tag:"water"}),ion:x.buildRepresentation(S,v.ion,{type:"ball-and-stick",typeParams:C,color:w,colorParams:{carbonColor:{name:"element-symbol",params:{}}}},{tag:"ion"}),lipid:x.buildRepresentation(S,v.lipid,{type:y,typeParams:E(E({},C),{alpha:.6}),color:w,colorParams:{carbonColor:{name:"element-symbol",params:{}}}},{tag:"lipid"}),coarse:x.buildRepresentation(S,v.coarse,{type:"spacefill",typeParams:C,color:w||"chain-id"},{tag:"coarse"})},[4,S.commit({revertOnError:!1})];case 9:return R.sent(),[4,sE(r,p,(c=(l=t.theme)===null||l===void 0?void 0:l.focus)===null||c===void 0?void 0:c.name,(f=(d=t.theme)===null||d===void 0?void 0:d.focus)===null||f===void 0?void 0:f.params)];case 10:return R.sent(),[2,{components:v,representations:D}]}})})}}),zYe=Ka({id:"preset-structure-representation-protein-and-nucleic",display:{name:"Protein & Nucleic",group:jb,description:"Shows proteins as Cartoon and RNA/DNA as Gaussian Surface."},params:function(){return s0},apply:function(e,t,r){var n,i,a,o;return ce(this,void 0,void 0,function(){var s,u,l,c,d,f,h,v,p,m,g,y;return de(this,function(b){switch(b.label){case 0:return s=Ii.resolveAndCheck(r.state.data,e),s?(y={},[4,Mz(r,s,"protein")]):[2,{}];case 1:return y.protein=b.sent(),[4,Mz(r,s,"nucleic")];case 2:return u=(y.nucleic=b.sent(),y),l=s.obj.data,c={sizeFactor:l.isCoarseGrained?.8:.2},d={radiusOffset:l.isCoarseGrained?2:0,smoothness:l.isCoarseGrained?1:1.5},f=Ub(r,t,l),h=f.update,v=f.builder,p=f.typeParams,m=f.symmetryColor,g={protein:v.buildRepresentation(h,u.protein,{type:"cartoon",typeParams:E(E({},p),c),color:m},{tag:"protein"}),nucleic:v.buildRepresentation(h,u.nucleic,{type:"gaussian-surface",typeParams:E(E({},p),d),color:m},{tag:"nucleic"})},[4,h.commit({revertOnError:!0})];case 3:return b.sent(),[4,sE(r,l,(i=(n=t.theme)===null||n===void 0?void 0:n.focus)===null||i===void 0?void 0:i.name,(o=(a=t.theme)===null||a===void 0?void 0:a.focus)===null||o===void 0?void 0:o.params)];case 4:return b.sent(),[2,{components:u,representations:g}]}})})}}),mte=Ka({id:"preset-structure-representation-coarse-surface",display:{name:"Coarse Surface",group:jb,description:"Shows polymers and lipids as coarse Gaussian Surface."},params:function(){return s0},apply:function(e,t,r){var n,i,a,o;return ce(this,void 0,void 0,function(){var s,u,l,c,d,f,h,v,p,m,g,y;return de(this,function(b){switch(b.label){case 0:return s=Ii.resolveAndCheck(r.state.data,e),s?(y={},[4,Ro(r,s,"polymer")]):[2,{}];case 1:return y.polymer=b.sent(),[4,Ro(r,s,"lipid")];case 2:return u=(y.lipid=b.sent(),y),l=s.obj.data,c=$e.getSize(l),d=Object.create(null),c===$e.Size.Gigantic?Object.assign(d,{traceOnly:!l.isCoarseGrained,radiusOffset:2,smoothness:1,visuals:["structure-gaussian-surface-mesh"]}):c===$e.Size.Huge?Object.assign(d,{radiusOffset:l.isCoarseGrained?2:0,smoothness:1}):l.isCoarseGrained&&Object.assign(d,{radiusOffset:2,smoothness:1}),f=Ub(r,t,l),h=f.update,v=f.builder,p=f.typeParams,m=f.symmetryColor,g={polymer:v.buildRepresentation(h,u.polymer,{type:"gaussian-surface",typeParams:E(E({},p),d),color:m},{tag:"polymer"}),lipid:v.buildRepresentation(h,u.lipid,{type:"gaussian-surface",typeParams:E(E({},p),d),color:m},{tag:"lipid"})},[4,h.commit({revertOnError:!0})];case 3:return b.sent(),[4,sE(r,l,(i=(n=t.theme)===null||n===void 0?void 0:n.focus)===null||i===void 0?void 0:i.name,(o=(a=t.theme)===null||a===void 0?void 0:a.focus)===null||o===void 0?void 0:o.params)];case 4:return b.sent(),[2,{components:u,representations:g}]}})})}}),gte=Ka({id:"preset-structure-representation-polymer-cartoon",display:{name:"Polymer Cartoon",group:jb,description:"Shows polymers as Cartoon."},params:function(){return s0},apply:function(e,t,r){var n,i,a,o;return ce(this,void 0,void 0,function(){var s,u,l,c,d,f,h,v,p,m,g;return de(this,function(y){switch(y.label){case 0:return s=Ii.resolveAndCheck(r.state.data,e),s?(g={},[4,Ro(r,s,"polymer")]):[2,{}];case 1:return u=(g.polymer=y.sent(),g),l=s.obj.data,c={sizeFactor:l.isCoarseGrained?.8:.2},d=Ub(r,t,l),f=d.update,h=d.builder,v=d.typeParams,p=d.symmetryColor,m={polymer:h.buildRepresentation(f,u.polymer,{type:"cartoon",typeParams:E(E({},v),c),color:p},{tag:"polymer"})},[4,f.commit({revertOnError:!0})];case 2:return y.sent(),[4,sE(r,l,(i=(n=t.theme)===null||n===void 0?void 0:n.focus)===null||i===void 0?void 0:i.name,(o=(a=t.theme)===null||a===void 0?void 0:a.focus)===null||o===void 0?void 0:o.params)];case 3:return y.sent(),[2,{components:u,representations:m}]}})})}}),yte=Ka({id:"preset-structure-representation-atomic-detail",display:{name:"Atomic Detail",group:jb,description:"Shows everything in atomic detail with Ball & Stick."},params:function(){return E(E({},s0),{showCarbohydrateSymbol:I.Boolean(!1)})},apply:function(e,t,r){return ce(this,void 0,void 0,function(){var n,i,a,o,s,u,l,c,d,f,h,v,p,m,g,y,b,S,x,C,w,A;return de(this,function(M){switch(M.label){case 0:return n=Ii.resolveAndCheck(r.state.data,e),n?(w={},[4,Ro(r,n,"all")]):[2,{}];case 1:return i=(w.all=M.sent(),w.branched=void 0,w),a=n.obj.data,o=a.elementCount>1e5,s=a.atomicResidueCount&&a.elementCount>1e3&&a.atomicResidueCount/a.elementCount<3,u=a.models[0],l=!!fa.Provider.get(u)||El.isExhaustive(u),c="ball-and-stick",a.isCoarseGrained?c=a.elementCount>1e6?"point":"spacefill":s&&!l?c="spacefill":o&&(c="line"),d=t.showCarbohydrateSymbol&&!o&&!s,d?(h=(f=Object).assign,v=[i],A={},[4,Ro(r,n,"branched",{label:"Carbohydrate"})]):[3,3];case 2:h.apply(f,v.concat([(A.branched=M.sent(),A)])),M.label=3;case 3:return p=Ub(r,t,a),m=p.update,g=p.builder,y=p.typeParams,b=p.color,S=p.ballAndStickColor,x=s&&!l?{carbonColor:{name:"element-symbol",params:{}}}:S,C={all:g.buildRepresentation(m,i.all,{type:c,typeParams:y,color:b,colorParams:x},{tag:"all"})},d&&Object.assign(C,{snfg3d:g.buildRepresentation(m,i.branched,{type:"carbohydrate",typeParams:E(E({},y),{alpha:.4,visuals:["carbohydrate-symbol"]}),color:b},{tag:"snfg-3d"})}),[4,m.commit({revertOnError:!0})];case 4:return M.sent(),[2,{components:i,representations:C}]}})})}});function Ro(e,t,r,n){return e.builders.structure.tryCreateComponentStatic(t,r,n)}function Mz(e,t,r,n){return e.builders.structure.tryCreateComponentFromSelection(t,di[r],"selection-"+r,n)}var Qm={empty:jYe,auto:UYe,"atomic-detail":yte,"polymer-cartoon":gte,"polymer-and-ligand":vte,"protein-and-nucleic":zYe,"coarse-surface":mte};function iL(e,t){if(e.ext==="bcif")try{if(BK(t).encoder.startsWith("VolumeServer"))return"dscif"}catch{}else if(e.ext==="cif"){var r=t;if(r.startsWith(`data_SERVER
#
_density_server_result`))return"dscif";if(r.includes("atom_site_fract_x")||r.includes("atom_site.fract_x"))return"coreCif"}return-1}var md="Trajectory";function gd(e,t){return e.builders.structure.hierarchy.applyPreset(t.trajectory,"default")}var VYe={label:"mmCIF",description:"mmCIF",category:md,stringExtensions:["cif","mmcif","mcif"],binaryExtensions:["bcif"],isApplicable:function(e,t){return e.ext==="mmcif"||e.ext==="mcif"?!0:e.ext==="cif"||e.ext==="bcif"?iL(e,t)===-1:!1},parse:function(e,t,r){return ce(void 0,void 0,void 0,function(){var n,i,a,o,s;return de(this,function(u){switch(u.label){case 0:return n=e.state.data,i=n.build().to(t).apply(rt.Data.ParseCif,void 0,{state:{isGhost:!0}}),[4,i.apply(rt.Model.TrajectoryFromMmCif,void 0,{tags:r==null?void 0:r.trajectoryTags}).commit({revertOnError:!0})];case 1:return a=u.sent(),(((s=(o=i.selector.cell)===null||o===void 0?void 0:o.obj)===null||s===void 0?void 0:s.data.blocks.length)||0)>1&&e.state.data.updateCellState(i.ref,{isGhost:!1}),[2,{trajectory:a}]}})})},visuals:gd},HYe={label:"cifCore",description:"CIF Core",category:md,stringExtensions:["cif"],isApplicable:function(e,t){return e.ext==="cif"?iL(e,t)==="coreCif":!1},parse:function(e,t,r){return ce(void 0,void 0,void 0,function(){var n,i,a,o,s;return de(this,function(u){switch(u.label){case 0:return n=e.state.data,i=n.build().to(t).apply(rt.Data.ParseCif,void 0,{state:{isGhost:!0}}),[4,i.apply(rt.Model.TrajectoryFromCifCore,void 0,{tags:r==null?void 0:r.trajectoryTags}).commit({revertOnError:!0})];case 1:return a=u.sent(),(((s=(o=i.selector.cell)===null||o===void 0?void 0:o.obj)===null||s===void 0?void 0:s.data.blocks.length)||0)>1&&e.state.data.updateCellState(i.ref,{isGhost:!1}),[2,{trajectory:a}]}})})},visuals:gd};function wv(e,t){var r=this;return function(n,i,a){return ce(r,void 0,void 0,function(){var o,s;return de(this,function(u){switch(u.label){case 0:return o=n.state.data,[4,o.build().to(i).apply(e,t,{tags:a==null?void 0:a.trajectoryTags}).commit({revertOnError:!0})];case 1:return s=u.sent(),[2,{trajectory:s}]}})})}}var GYe={label:"PDB",description:"PDB",category:md,stringExtensions:["pdb","ent"],parse:wv(rt.Model.TrajectoryFromPDB),visuals:gd},qYe={label:"PDBQT",description:"PDBQT",category:md,stringExtensions:["pdbqt"],parse:wv(rt.Model.TrajectoryFromPDB,{isPdbqt:!0}),visuals:gd},WYe={label:"XYZ",description:"XYZ",category:md,stringExtensions:["xyz"],parse:wv(rt.Model.TrajectoryFromXYZ),visuals:gd},$Ye={label:"GRO",description:"GRO",category:md,stringExtensions:["gro"],binaryExtensions:[],parse:wv(rt.Model.TrajectoryFromGRO),visuals:gd},XYe={label:"MOL",description:"MOL",category:md,stringExtensions:["mol"],parse:wv(rt.Model.TrajectoryFromMOL),visuals:gd},YYe={label:"SDF",description:"SDF",category:md,stringExtensions:["sdf","sd"],parse:wv(rt.Model.TrajectoryFromSDF),visuals:gd},KYe={label:"MOL2",description:"MOL2",category:md,stringExtensions:["mol2"],parse:wv(rt.Model.TrajectoryFromMOL2),visuals:gd},bte=[["mmcif",VYe],["cifCore",HYe],["pdb",GYe],["pdbqt",qYe],["gro",$Ye],["xyz",WYe],["mol",XYe],["sdf",YYe],["mol2",KYe]],QYe=function(e){return I.Group({type:wp.getParams(void 0,"auto").type,representation:I.Select(Qm.auto.id,e.builders.structure.representation.getPresets().map(function(t){return[t.id,t.display.name,t.display.group]}),{description:"Which representation preset to use."}),representationParams:I.Group(Ka.CommonParams,{isHidden:!0}),asTrajectory:I.Optional(I.Boolean(!1,{description:"Load all entries into a single trajectory."}))},{isExpanded:!1})},aL={rcsb:I.Group({encoding:I.Select("bcif",[["cif","cif"],["bcif","bcif"]])},{label:"RCSB PDB",isFlat:!0}),pdbe:I.Group({variant:I.Select("updated-bcif",[["updated-bcif","Updated (bcif)"],["updated","Updated"],["archival","Archival"]])},{label:"PDBe",isFlat:!0})},uD=go.build({from:ge.Root,display:{name:"Download Structure",description:"Load a structure from the provided source and create its representation."},params:function(e,t){var r=QYe(t),n=t.config.get(Wr.Download.DefaultPdbProvider)||"pdbe";return{source:I.MappedStatic("pdb",{pdb:I.Group({provider:I.Group({id:I.Text("1tqn",{label:"PDB Id(s)",description:"One or more comma/space separated PDB ids."}),server:I.MappedStatic(n,aL)},{pivot:"id"}),options:r},{isFlat:!0,label:"PDB"}),"pdb-dev":I.Group({provider:I.Group({id:I.Text("PDBDEV_00000001",{label:"PDBDev Id(s)",description:"One or more comma/space separated ids."}),encoding:I.Select("bcif",[["cif","cif"],["bcif","bcif"]])},{pivot:"id"}),options:r},{isFlat:!0,label:"PDBDEV"}),swissmodel:I.Group({id:I.Text("Q9Y2I8",{label:"UniProtKB AC(s)",description:"One or more comma/space separated ACs."}),options:r},{isFlat:!0,label:"SWISS-MODEL",description:"Loads the best homology model or experimental structure"}),pubchem:I.Group({id:I.Text("2244,2245",{label:"PubChem ID",description:"One or more comma/space separated IDs."}),options:r},{isFlat:!0,label:"PubChem",description:"Loads 3D conformer from PubChem."}),url:I.Group({url:I.Url(""),format:I.Select("mmcif",I.arrayToOptions(bte.map(function(i){return i[0]}),function(i){return i})),isBinary:I.Boolean(!1),options:r},{isFlat:!0,label:"URL"})})}}})(function(e,t){var r=e.params,n=e.state;return We.create("Download Structure",function(i){return ce(void 0,void 0,void 0,function(){var a,o,s,u,l,c,d;return de(this,function(f){switch(f.label){case 0:switch(t.behaviors.layout.leftPanelTabName.next("data"),a=r.source,s=!1,u="mmcif",a.name){case"url":o=[{url:a.params.url,isBinary:a.params.isBinary}],u=a.params.format;break;case"pdb":o=a.params.provider.server.name==="pdbe"?a.params.provider.server.params.variant==="updated"?Rd(a.params.provider.id,function(h){return"https://www.ebi.ac.uk/pdbe/static/entry/"+h.toLowerCase()+"_updated.cif"},function(h){return"PDBe: "+h+" (updated cif)"},!1):a.params.provider.server.params.variant==="updated-bcif"?Rd(a.params.provider.id,function(h){return"https://www.ebi.ac.uk/pdbe/entry-files/download/"+h.toLowerCase()+".bcif"},function(h){return"PDBe: "+h+" (updated cif)"},!0):Rd(a.params.provider.id,function(h){return"https://www.ebi.ac.uk/pdbe/static/entry/"+h.toLowerCase()+".cif"},function(h){return"PDBe: "+h+" (cif)"},!1):a.params.provider.server.params.encoding==="cif"?Rd(a.params.provider.id,function(h){return"https://files.rcsb.org/download/"+h.toUpperCase()+".cif"},function(h){return"RCSB: "+h+" (cif)"},!1):Rd(a.params.provider.id,function(h){return"https://models.rcsb.org/"+h.toUpperCase()+".bcif"},function(h){return"RCSB: "+h+" (bcif)"},!0),s=!!a.params.options.asTrajectory;break;case"pdb-dev":o=Rd(a.params.provider.id,function(h){var v=h.toUpperCase().startsWith("PDBDEV_")?h:"PDBDEV_"+h.padStart(8,"0");return a.params.provider.encoding==="bcif"?"https://pdb-dev.wwpdb.org/bcif/"+v.toUpperCase()+".bcif":"https://pdb-dev.wwpdb.org/cif/"+v.toUpperCase()+".cif"},function(h){return h.toUpperCase().startsWith("PDBDEV_")?h:"PDBDEV_"+h.padStart(8,"0")},a.params.provider.encoding==="bcif"),s=!!a.params.options.asTrajectory;break;case"swissmodel":o=Rd(a.params.id,function(h){return"https://swissmodel.expasy.org/repository/uniprot/"+h.toUpperCase()+".pdb"},function(h){return"SWISS-MODEL: "+h},!1),s=!!a.params.options.asTrajectory,u="pdb";break;case"pubchem":o=Rd(a.params.id,function(h){return"https://pubchem.ncbi.nlm.nih.gov/rest/pug/compound/CID/"+h.trim()+"/record/SDF/?record_type=3d"},function(h){return"PubChem: "+h},!1),s=!!a.params.options.asTrajectory,u="mol";break;default:throw new Error(a.name+" not supported.")}return l=r.source.params.options.representation||Qm.auto.id,c=l!==Qm.empty.id,d=a.params.options.type.name==="auto"?void 0:a.params.options.type,[4,n.transaction(function(){return ce(void 0,void 0,void 0,function(){var h,y,v,p,m,g,y;return de(this,function(b){switch(b.label){case 0:return o.length>0&&s?[4,t.builders.data.downloadBlob({sources:o.map(function(S,x){return{id:""+x,url:S.url,isBinary:S.isBinary}}),maxConcurrency:6},{state:{isGhost:!0}})]:[3,4];case 1:return h=b.sent(),[4,t.builders.structure.parseTrajectory(h,{formats:o.map(function(S,x){return{id:""+x,format:"cif"}})})];case 2:return y=b.sent(),[4,t.builders.structure.hierarchy.applyPreset(y,"default",{structure:d,showUnitcell:c,representationPreset:l,representationPresetParams:r.source.params.options.representationParams})];case 3:return b.sent(),[3,10];case 4:v=0,p=o,b.label=5;case 5:return v<p.length?(m=p[v],[4,t.builders.data.download(m,{state:{isGhost:!0}})]):[3,10];case 6:return g=b.sent(),[4,t.builders.structure.parseTrajectory(g,u)];case 7:return y=b.sent(),[4,t.builders.structure.hierarchy.applyPreset(y,"default",{structure:d,showUnitcell:c,representationPreset:l,representationPresetParams:r.source.params.options.representationParams})];case 8:b.sent(),b.label=9;case 9:return v++,[3,5];case 10:return[2]}})})}).runInContext(i)];case 1:return f.sent(),[2]}})})})});function Rd(e,t,r,n){for(var i=e.split(/[,\s]/).map(function(l){return l.trim()}).filter(function(l){return!!l&&(l.length>=4||/^[1-9][0-9]*$/.test(l))}),a=[],o=0,s=i;o<s.length;o++){var u=s[o];a.push({url:Cn.Url(t(u)),isBinary:n,label:r(u)})}return a}var xS=go.build({display:{name:"Update Trajectory"},params:{action:I.Select("advance",[["advance","Advance"],["reset","Reset"]]),by:I.Optional(I.Numeric(1,{min:-1,max:1,step:1}))}})(function(e){var t=e.params,r=e.state,n=r.selectQ(function(d){return d.ofTransformer(rt.Model.ModelFromTrajectory)}),i=r.build();if(t.action==="reset")for(var a=0,o=n;a<o.length;a++){var s=o[a];i.to(s).update({modelIndex:0})}else for(var u=function(d){var f=ir.findAncestorOfType(r.tree,r.cells,d.transform.ref,ge.Molecule.Trajectory);if(!f||!f.obj)return"continue";var h=f.obj;i.to(d).update(function(v){var p=(v.modelIndex+t.by)%h.data.frameCount;return p<0&&(p+=h.data.frameCount),{modelIndex:p}})},l=0,c=n;l<c.length;l++){var s=c[l];u(s)}return r.updateTree(i)}),ZYe=go.build({display:{name:"Custom Model Properties",description:"Enable parameters for custom properties of the model."},from:ge.Molecule.Model,params:function(e,t){return t.customModelProperties.getParams(e==null?void 0:e.data)},isApplicable:function(e,t,r){return t.transformer!==_Z}})(function(e,t){var r=e.ref,n=e.params;return t.builders.structure.insertModelProperties(r,n)}),JYe=go.build({display:{name:"Custom Structure Properties",description:"Enable parameters for custom properties of the structure."},from:ge.Molecule.Structure,params:function(e,t){return t.customStructureProperties.getParams(e==null?void 0:e.data)},isApplicable:function(e,t,r){return t.transformer!==wZ}})(function(e,t){var r=e.ref,n=e.params;return t.builders.structure.insertStructureProperties(r,n)}),eKe=go.build({display:{name:"Add Trajectory",description:"Add trajectory from existing model/topology and coordinates."},from:ge.Root,params:function(e,t){var r=t.state.data,n=Ft(Ft([],r.selectQ(function(s){return s.rootsOfType(ge.Molecule.Model)})),r.selectQ(function(s){return s.rootsOfType(ge.Molecule.Topology)})),i=n.map(function(s){return[s.transform.ref,s.obj.label]}),a=r.selectQ(function(s){return s.rootsOfType(ge.Molecule.Coordinates)}),o=a.map(function(s){return[s.transform.ref,s.obj.label]});return{model:I.Select(i.length?i[0][0]:"",i),coordinates:I.Select(o.length?o[0][0]:"",o)}}})(function(e,t){var r=e.params,n=e.state;return We.create("Add Trajectory",function(i){return n.transaction(function(){return ce(void 0,void 0,void 0,function(){var a,o,s;return de(this,function(u){switch(u.label){case 0:return a=[r.model,r.coordinates],o=n.build().toRoot().apply(SZ,{modelRef:r.model,coordinatesRef:r.coordinates},{dependsOn:a}).apply(rt.Model.ModelFromTrajectory,{modelIndex:0}),[4,n.updateTree(o).runInContext(i)];case 1:return u.sent(),[4,t.builders.structure.createStructure(o.selector)];case 2:return s=u.sent(),[4,t.builders.structure.representation.applyPreset(s,"auto")];case 3:return u.sent(),[2]}})})}).runInContext(i)})});const tKe=Object.freeze(Object.defineProperty({__proto__:null,AddTrajectory:eKe,DownloadStructure:uD,EnableModelCustomProps:ZYe,EnableStructureCustomProps:JYe,PdbDownloadProvider:aL,UpdateTrajectory:xS},Symbol.toStringTag,{value:"Module"}));var er=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.hide=function(){return r.props.onSelect(void 0)},r}return t.prototype.render=function(){var r=this.props,n=T.jsx(rKe,{items:r.items,onSelect:r.onSelect,current:r.current,multiselect:this.props.multiselect,noOffset:this.props.noOffset,noAccent:this.props.noAccent},void 0);return T.jsxs("div",E({className:"msp-action-menu-options"+(r.header?"":" msp-action-menu-options-no-header")},{children:[r.header&&T.jsx(fc,E({header:r.header,title:r.title,initialExpanded:!0,hideExpander:!0,hideOffset:!0,onHeaderClick:this.hide,topRightIcon:dc},{children:n}),void 0),!r.header&&n]}),void 0)},t}(Ve.PureComponent);(function(e){function t(l,c){return c?E({kind:"header",label:l},c):{kind:"header",label:l}}e.Header=t;function r(l,c,d){return E({kind:"item",label:l,value:c},d)}e.Item=r;function n(l,c){for(var d=c||{},f=d.label,h=d.value,v=d.category,p=d.selected,m=d.icon,g=d.addOn,y=d.description,b=void 0,S=[],x=0;x<l.length;x++){var C=l[x];if(!(c!=null&&c.filter&&!c.filter(C))){var w=v==null?void 0:v(C),A=f?f(C):""+C,M=h?h(C):C,D=y?y(C):typeof C=="string"?C:void 0,k=void 0;w?(b||(b=new Map),k=b.get(w),k||(k=[e.Header(w,{description:w})],b.set(w,k),S.push(k))):k=S;var R=g==null?void 0:g(C);k.push({kind:"item",label:A,value:M,icon:m?m(C):void 0,selected:p?p(C):void 0,addOn:R,description:D})}}return S}e.createItems=n;var i={value:function(l){return l[0]},label:function(l){return l[1]},category:function(l){return l[2]}};function a(l,c){return n(l,c?E(E({},i),c):i)}e.createItemsFromSelectOptions=a;function o(l){if(nc(l))return!1;if(Zm(l))return!!l.selected;for(var c=0,d=l;c<d.length;c++){var f=d[c],h=o(f);if(h)return!0}return!1}e.hasSelectedItem=o;function s(l,c){if(!nc(l)){if(Zm(l))return l.value===c?l:void 0;for(var d=0,f=l;d<f.length;d++){var h=f[d],v=s(h,c);if(v)return v}}}e.findItem=s;function u(l){if(!nc(l)){if(Zm(l))return l;for(var c=0,d=l;c<d.length;c++){var f=d[c],h=u(f);if(h)return h}}}e.getFirstItem=u})(er||(er={}));var rKe=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state=t.createState(r.props),r.toggleExpanded=function(n){r.setState({isExpanded:!r.state.isExpanded}),n.currentTarget.blur()},r.selectAll=function(){var n=lD(r.props.items,[]).filter(function(i){return!i.selected});r.props.onSelect(n)},r.selectNone=function(){var n=lD(r.props.items,[]).filter(function(i){return!!i.selected});r.props.onSelect(n)},r}return t.createState=function(r,n){var i=wT(r.items)&&nc(r.items[0])?r.items[0]:void 0,a=i!=null&&i.isIndependent?!1:r.multiselect?er.hasSelectedItem(r.items):!!r.current&&!!er.findItem(r.items,r.current.value)||er.hasSelectedItem(r.items);return{header:i,hasCurrent:a,isExpanded:a||(n??!!(i!=null&&i.initiallyExpanded))}},t.prototype.componentDidUpdate=function(r){if(this.props.items!==r.items||this.props.current!==r.current){var n=wT(this.props.items)&&wT(r.items)&&nc(this.props.items[0])&&nc(r.items[0])&&this.props.items[0].label===r.items[0].label?this.state.isExpanded:void 0;this.setState(t.createState(this.props,n))}},Object.defineProperty(t.prototype,"multiselectHeader",{get:function(){var r=this.state,n=r.header,i=r.hasCurrent;return T.jsxs("div",E({className:"msp-flex-row msp-control-group-header"},{children:[T.jsx(hr,E({icon:this.state.isExpanded?Rc:kc,flex:!0,noOverflow:!0,onClick:this.toggleExpanded,title:"Click to "+(this.state.isExpanded?"collapse":"expand")+"."+(n!=null&&n.description?" "+(n==null?void 0:n.description):"")},{children:i?T.jsx("b",{children:n==null?void 0:n.label},void 0):n==null?void 0:n.label}),void 0),T.jsx(hr,E({icon:qg,flex:!0,onClick:this.selectAll,style:{flex:"0 0 50px",textAlign:"right"}},{children:"All"}),void 0),T.jsx(hr,E({icon:dc,flex:!0,onClick:this.selectNone,style:{flex:"0 0 50px",textAlign:"right"}},{children:"None"}),void 0)]}),void 0)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"basicHeader",{get:function(){var r=this.state,n=r.header,i=r.hasCurrent;return T.jsx("div",E({className:"msp-control-group-header",style:{marginTop:"1px"}},{children:T.jsx(hr,E({noOverflow:!0,icon:this.state.isExpanded?Rc:kc,onClick:this.toggleExpanded,title:"Click to "+(this.state.isExpanded?"collapse":"expand")+". "+(n!=null&&n.description?n==null?void 0:n.description:"")},{children:i?T.jsx("b",{children:n==null?void 0:n.label},void 0):n==null?void 0:n.label}),void 0)}),void 0)},enumerable:!1,configurable:!0}),t.prototype.render=function(){var r=this,n=this.props,i=n.items,a=n.onSelect,o=n.current;if(nc(i))return null;if(Zm(i))return T.jsx(Dz,{item:i,onSelect:a,current:o,multiselect:this.props.multiselect},void 0);var s=this.state.header;return T.jsxs(T.Fragment,{children:[s&&(this.props.multiselect&&this.state.isExpanded?this.multiselectHeader:this.basicHeader),T.jsx("div",E({className:this.props.noOffset?void 0:this.props.noAccent?"msp-control-offset":"msp-accent-offset"},{children:(!s||this.state.isExpanded)&&i.map(function(u,l){return nc(u)?null:Zm(u)?T.jsx(Dz,{item:u,onSelect:a,current:o,multiselect:r.props.multiselect},l):T.jsx(t,{items:u,onSelect:a,current:o,multiselect:r.props.multiselect,noAccent:!0},l)})}),void 0)]},void 0)},t}(Ve.PureComponent),Dz=function(e){var t=e.item,r=e.onSelect,n=e.current,i=e.multiselect,a=n===t,o=t.addOn?{position:"relative"}:void 0;return T.jsxs(hr,E({icon:t.icon,noOverflow:!0,className:"msp-action-menu-button",onClick:function(s){return r(i?[t]:t,s)},disabled:t.disabled,style:o,title:t.description},{children:[a||t.selected?T.jsx("b",{children:t.label},void 0):t.label,t.addOn]}),void 0)};function wT(e){return!!e&&Array.isArray(e)}function Zm(e){var t=e;return t&&t.kind==="item"}function nc(e){var t=e;return t&&t.kind==="header"}function lD(e,t){if(nc(e))return t;if(Zm(e))return t.push(e),t;for(var r=0,n=e;r<n.length;r++){var i=n[r];lD(i,t)}return t}var oL=[["black",0],["gray",8421504],["white",16777215],["red",13840661],["orange",14840576],["yellow",16565248],["green",6863872],["cyan",1484197],["blue",40160],["purple",8086783],["magenta",16394495],["violet",8200583]],nKe=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isExpanded:!!r.props.param.isExpanded,lightness:0},r.toggleExpanded=function(n){r.setState({isExpanded:!r.state.isExpanded}),n.currentTarget.blur()},r.onClickSwatch=function(n){var i=at(+(n.currentTarget.getAttribute("data-color")||"0"));i!==r.props.value&&(r.props.param.isExpanded||r.setState({isExpanded:!1}),r.update(i))},r.onR=function(n){var i=at.toRgb(r.props.value),a=i[1],o=i[2],s=at.fromRgb(n,a,o);s!==r.props.value&&r.update(s)},r.onG=function(n){var i=at.toRgb(r.props.value),a=i[0],o=i[2],s=at.fromRgb(a,n,o);s!==r.props.value&&r.update(s)},r.onB=function(n){var i=at.toRgb(r.props.value),a=i[0],o=i[1],s=at.fromRgb(a,o,n);s!==r.props.value&&r.update(s)},r.onLighten=function(){r.update(at.lighten(r.props.value,.1))},r.onDarken=function(){r.update(at.darken(r.props.value,.1))},r}return t.prototype.update=function(r){this.props.onChange({param:this.props.param,name:this.props.name,value:r})},t.prototype.swatch=function(){var r=this;return T.jsx("div",E({className:"msp-combined-color-swatch"},{children:oL.map(function(n){return T.jsx(hr,{inline:!0,"data-color":n[1],onClick:r.onClickSwatch,style:{background:at.toStyle(n[1])}},n[1])})}),void 0)},t.prototype.render=function(){var r=this.props.param.label||Oa(this.props.name),n=at.toRgb(this.props.value),i=n[0],a=n[1],o=n[2];return T.jsxs(T.Fragment,{children:[T.jsx(Ns,{title:this.props.param.description,label:r,control:T.jsx(hr,{onClick:this.toggleExpanded,inline:!0,className:"msp-combined-color-button",style:{background:at.toStyle(this.props.value)}},void 0)},void 0),this.state.isExpanded&&T.jsxs("div",E({className:"msp-control-offset"},{children:[this.swatch(),T.jsx(Ns,{label:"RGB",className:"msp-control-label-short",control:T.jsxs("div",E({style:{display:"flex",textAlignLast:"center",left:"80px"}},{children:[T.jsx(yc,{onChange:this.onR,numeric:!0,value:i,delayMs:250,style:{order:1,flex:"1 1 auto",minWidth:0},className:"msp-form-control",onEnter:this.props.onEnter,blurOnEnter:!0,blurOnEscape:!0},void 0),T.jsx(yc,{onChange:this.onG,numeric:!0,value:a,delayMs:250,style:{order:2,flex:"1 1 auto",minWidth:0},className:"msp-form-control",onEnter:this.props.onEnter,blurOnEnter:!0,blurOnEscape:!0},void 0),T.jsx(yc,{onChange:this.onB,numeric:!0,value:o,delayMs:250,style:{order:3,flex:"1 1 auto",minWidth:0},className:"msp-form-control",onEnter:this.props.onEnter,blurOnEnter:!0,blurOnEscape:!0},void 0)]}),void 0)},void 0),T.jsxs("div",E({style:{display:"flex",textAlignLast:"center"}},{children:[T.jsx(hr,E({onClick:this.onLighten,style:{order:1,flex:"1 1 auto",minWidth:0},className:"msp-form-control"},{children:"Lighten"}),void 0),T.jsx(hr,E({onClick:this.onDarken,style:{order:1,flex:"1 1 auto",minWidth:0},className:"msp-form-control"},{children:"Darken"}),void 0)]}),void 0)]}),void 0)]},void 0)},t}(Ve.PureComponent),vx=void 0;function iKe(){return vx||(vx=T.jsx(T.Fragment,{children:oL.map(function(e){return T.jsx("option",E({value:e[1],style:{background:""+at.toStyle(e[1])}},{children:zo(e[0])}),e[1])})},void 0),vx)}var aKe=function(){for(var e=new Map,t=0,r=oL;t<r.length;t++){var n=r[t];e.set(n[1],n[0])}return e}();function oKe(e){return aKe.has(e)?null:T.jsx("option",E({value:e,style:{background:""+at.toStyle(e)}},{children:at.toRgbString(e)}),at.toHexString(e))}function sKe(e){switch(e.kind){case"scale-legend":return uKe;case"table-legend":return lKe;default:var t=e;console.warn(t+" has no associated UI component");return}}var uKe=function(e){Le(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.render=function(){var r=this.props.legend,n=r.colors.map(function(i){return Array.isArray(i)?at.toStyle(i[0])+" "+100*i[1]+"%":at.toStyle(i)}).join(", ");return T.jsx("div",E({className:"msp-scale-legend"},{children:T.jsxs("div",E({style:{background:"linear-gradient(to right, "+n+")"}},{children:[T.jsx("span",E({style:{float:"left"}},{children:r.minLabel}),void 0),T.jsx("span",E({style:{float:"right"}},{children:r.maxLabel}),void 0)]}),void 0)}),void 0)},t}(Ve.PureComponent),lKe=function(e){Le(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.render=function(){var r=this.props.legend;return T.jsx("div",E({className:"msp-table-legend"},{children:r.table.map(function(n,i){var a=n[0],o=n[1];return T.jsxs("div",{children:[T.jsx("div",{className:"msp-table-legend-color",style:{backgroundColor:at.toStyle(o)}},void 0),T.jsx("div",E({className:"msp-table-legend-text"},{children:a}),void 0)]},i)})}),void 0)},t}(Ve.PureComponent),cKe=function(e){Le(t,e);function t(r){var n=e.call(this,r)||this;return n.state={show:!1},n.handleHover=n.handleHover.bind(n),n.handleHoverOff=n.handleHoverOff.bind(n),n.deletePoint=n.deletePoint.bind(n),n}return t.prototype.handleHover=function(){this.setState({show:!0});var r=He.create(this.props.nX,this.props.nY);this.props.onmouseover(r)},t.prototype.handleHoverOff=function(){this.setState({show:!1}),this.props.onmouseover(void 0)},t.prototype.deletePoint=function(){this.props.delete(this.props.id)},t.prototype.render=function(){return[T.jsx("circle",{r:"10",id:""+this.props.id,cx:this.props.x,cy:this.props.y,onClick:this.props.onclick,onDoubleClick:this.props.delete(this.props.id),onMouseEnter:this.handleHover,onMouseLeave:this.handleHoverOff,onMouseDown:this.props.onmousedown,fill:"black"},this.props.id+"circle")]},t}(Ve.Component),dKe=function(e){Le(t,e);function t(r){var n=e.call(this,r)||this;n.handleKeyDown=function(s){},n.handleKeyUp=function(s){},n.handleClick=function(s){return function(u){}},n.handleMouseDown=function(s){return function(u){if(!(s===0||s===n.state.points.length-1)&&!n.state.canSelectMultiple){var l=n.normalizePoint(He.create(n.state.points[s][0],n.state.points[s][1]));n.ghostPoints.push(document.createElementNS(n.namespace,"circle")),n.ghostPoints[0].setAttribute("r","10"),n.ghostPoints[0].setAttribute("fill","orange"),n.ghostPoints[0].setAttribute("cx",""+l[0]),n.ghostPoints[0].setAttribute("cy",""+l[1]),n.ghostPoints[0].setAttribute("style","display: none"),n.gElement.appendChild(n.ghostPoints[0]),n.updatedX=l[0],n.updatedY=l[1],n.selected=[s]}}},n.deletePoint=function(s){return function(u){if(!(s===0||s===n.state.points.length-1)){var l=n.state.points.filter(function(c,d){return d!==s});l.sort(function(c,d){return c[0]===d[0]?c[0]===0?c[1]-d[1]:c[1]===1?d[1]-c[1]:c[1]-d[1]:c[0]-d[0]}),n.setState({points:l}),n.change(l),u.stopPropagation()}}},n.myRef=Ve.createRef(),n.state={points:[He.create(0,0),He.create(1,0)],copyPoint:void 0,canSelectMultiple:!1},n.height=400,n.width=600,n.padding=70,n.selected=void 0,n.ghostPoints=[],n.namespace="http://www.w3.org/2000/svg";for(var i=0,a=n.props.data;i<a.length;i++){var o=a[i];n.state.points.push(o)}return n.state.points.sort(function(s,u){return s[0]===u[0]?s[0]===0?s[1]-u[1]:s[1]===1?u[1]-s[1]:s[1]-u[1]:s[0]-u[0]}),n.handleDrag=n.handleDrag.bind(n),n.handleMultipleDrag=n.handleMultipleDrag.bind(n),n.handleDoubleClick=n.handleDoubleClick.bind(n),n.refCallBack=n.refCallBack.bind(n),n.handlePointUpdate=n.handlePointUpdate.bind(n),n.change=n.change.bind(n),n.handleKeyUp=n.handleKeyUp.bind(n),n.handleLeave=n.handleLeave.bind(n),n.handleEnter=n.handleEnter.bind(n),n}return t.prototype.render=function(){var r=this.renderPoints(),n=this.renderLines();return[T.jsx("div",{children:T.jsxs("svg",E({className:"msp-canvas",ref:this.refCallBack,viewBox:"0 0 "+(this.width+this.padding)+" "+(this.height+this.padding),onMouseMove:this.handleDrag,onMouseUp:this.handlePointUpdate,onMouseLeave:this.handleLeave,onMouseEnter:this.handleEnter,tabIndex:0,onKeyDown:this.handleKeyDown,onKeyUp:this.handleKeyUp,onDoubleClick:this.handleDoubleClick},{children:[T.jsxs("g",E({stroke:"black",fill:"black"},{children:[n,r]}),void 0),T.jsx("g",{className:"ghost-points",stroke:"black",fill:"black"},void 0)]}),void 0)},"LineGraph"),T.jsx("div",{id:"modal-root"},"modal")]},t.prototype.componentDidMount=function(){this.gElement=document.getElementsByClassName("ghost-points")[0]},t.prototype.change=function(r){var n=r.slice();n.shift(),n.pop(),this.props.onChange(n)},t.prototype.handleDrag=function(r){if(this.selected!==void 0){var n=this.myRef.createSVGPoint(),i,a=this.padding/2;n.x=r.clientX,n.y=r.clientY;var o=n.matrixTransform(this.myRef.getScreenCTM().inverse());i=He.create(o.x,o.y),(o.x<a||o.x>this.width+a)&&(o.y>this.height+a||o.y<a)?i=He.create(this.updatedX,this.updatedY):o.x<a?i=He.create(a,o.y):o.x>this.width+a?i=He.create(this.width+a,o.y):o.y>this.height+a?i=He.create(o.x,this.height+a):o.y<a?i=He.create(o.x,a):i=He.create(o.x,o.y),this.updatedX=i[0],this.updatedY=i[1];var s=this.unNormalizePoint(i);this.ghostPoints[0].setAttribute("style","display: visible"),this.ghostPoints[0].setAttribute("cx",""+i[0]),this.ghostPoints[0].setAttribute("cy",""+i[1]),this.props.onDrag(s)}},t.prototype.handleMultipleDrag=function(){},t.prototype.handlePointUpdate=function(r){var n=this.selected;if(!this.state.canSelectMultiple){if(n===void 0||n[0]===0||n[0]===this.state.points.length-1){this.setState({copyPoint:void 0});return}this.selected=void 0;var i=this.unNormalizePoint(He.create(this.updatedX,this.updatedY)),a=this.state.points.filter(function(o,s){return s!==n[0]});a.push(i),a.sort(function(o,s){return o[0]===s[0]?o[0]===0?o[1]-s[1]:o[1]===1?s[1]-o[1]:o[1]-s[1]:o[0]-s[0]}),this.setState({points:a}),this.change(a),this.gElement.innerHTML="",this.ghostPoints=[],document.removeEventListener("mousemove",this.handleDrag,!0),document.removeEventListener("mouseup",this.handlePointUpdate,!0)}},t.prototype.handleDoubleClick=function(r){var n,i=this.myRef.createSVGPoint();i.x=r.clientX,i.y=r.clientY;var a=i.matrixTransform(this.myRef.getScreenCTM().inverse()),o=this.state.points,s=this.padding/2;a.x<s||a.x>this.width+s||a.y>this.height+s||a.y<this.padding/2||(n=this.unNormalizePoint(He.create(a.x,a.y)),o.push(n),o.sort(function(u,l){return u[0]===l[0]?u[0]===0?u[1]-l[1]:u[1]===1?l[1]-u[1]:u[1]-l[1]:u[0]-l[0]}),this.setState({points:o}),this.change(o))},t.prototype.handleLeave=function(){this.selected!==void 0&&(document.addEventListener("mousemove",this.handleDrag,!0),document.addEventListener("mouseup",this.handlePointUpdate,!0))},t.prototype.handleEnter=function(){document.removeEventListener("mousemove",this.handleDrag,!0),document.removeEventListener("mouseup",this.handlePointUpdate,!0)},t.prototype.normalizePoint=function(r){var n=this.padding/2,i=this.width+n,a=this.height+n,o=r[0]*(i-n)+n,s=r[1]*(a-n)+n,u=this.height+this.padding-s,l=He.create(o,u);return l},t.prototype.unNormalizePoint=function(r){var n=this.padding/2,i=this.width+n,a=this.height+n,o=(r[0]-n)/(i-n),s=(this.height+this.padding-r[1]-n)/(a-n);return He.create(o,s)},t.prototype.refCallBack=function(r){r&&(this.myRef=r)},t.prototype.renderPoints=function(){for(var r=[],n,i=0;i<this.state.points.length;i++)i!==0&&i!==this.state.points.length-1&&(n=this.normalizePoint(this.state.points[i]),r.push(T.jsx(cKe,{id:i,x:n[0],y:n[1],nX:this.state.points[i][0],nY:this.state.points[i][1],selected:!1,delete:this.deletePoint,onmouseover:this.props.onHover,onmousedown:this.handleMouseDown(i),onclick:this.handleClick(i)},i)));return r},t.prototype.renderLines=function(){for(var r=[],n=[],i,a,o,s,u,l,c=0,d=this.state.points;c<d.length;c++){var f=d[c];i=this.padding/2,a=this.width+i,o=this.height+i,s=f[0]*(a-i)+i,u=f[1]*(o-i)+i,l=this.height+this.padding-u,r.push(He.create(s,l))}for(var h=r,v=h.length,p=0;p<v-1;p++){var m=h[p][0],g=h[p][1],y=h[p+1][0],b=h[p+1][1];n.push(T.jsx("line",{x1:m,x2:y,y1:g,y2:b,stroke:"#cec9ba",strokeWidth:"5"},"lineOf"+p))}return n},t}(Ve.Component),xte=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isChanging:!1,current:0},r.begin=function(){r.setState({isChanging:!0})},r.end=function(n){r.setState({isChanging:!1}),r.props.onChange(n)},r.updateCurrent=function(n){var i,a;r.setState({current:n}),(a=(i=r.props).onChangeImmediate)===null||a===void 0||a.call(i,n)},r.updateManually=function(n){r.setState({isChanging:!0});var i=n;r.props.step===1&&(i=Math.round(i)),i<r.props.min&&(i=r.props.min),i>r.props.max&&(i=r.props.max),r.setState({current:i,isChanging:!0})},r.onManualBlur=function(){r.setState({isChanging:!1}),r.props.onChange(r.state.current)},r}return t.getDerivedStateFromProps=function(r,n){return n.isChanging||r.value===n.current?null:{current:r.value}},t.prototype.render=function(){var r=this.props.step;return r===void 0&&(r=1),T.jsxs("div",E({className:"msp-slider"},{children:[T.jsx("div",{children:T.jsx(Ste,{min:this.props.min,max:this.props.max,step:r,value:this.state.current,disabled:this.props.disabled,onBeforeChange:this.begin,onChange:this.updateCurrent,onAfterChange:this.end},void 0)},void 0),T.jsx("div",{children:T.jsx(yc,{numeric:!0,delayMs:50,value:this.state.current,blurOnEnter:!0,onBlur:this.onManualBlur,isDisabled:this.props.disabled,onChange:this.updateManually},void 0)},void 0)]}),void 0)},t}(Ve.Component),fKe=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isChanging:!1,current:[0,1]},r.begin=function(){r.setState({isChanging:!0})},r.end=function(n){r.setState({isChanging:!1}),r.props.onChange(n)},r.updateCurrent=function(n){r.setState({current:n})},r.updateMax=function(n){var i=n;r.props.step===1&&(i=Math.round(i)),i<r.state.current[0]?i=r.state.current[0]:i<r.props.min&&(i=r.props.min),i>r.props.max&&(i=r.props.max),r.props.onChange([r.state.current[0],i])},r.updateMin=function(n){var i=n;r.props.step===1&&(i=Math.round(i)),i<r.props.min&&(i=r.props.min),i>r.state.current[1]?i=r.state.current[1]:i>r.props.max&&(i=r.props.max),r.props.onChange([i,r.state.current[1]])},r}return t.getDerivedStateFromProps=function(r,n){return n.isChanging||r.value[0]===n.current[0]&&r.value[1]===n.current[1]?null:{current:r.value}},t.prototype.render=function(){var r=this.props.step;return r===void 0&&(r=1),T.jsxs("div",E({className:"msp-slider2"},{children:[T.jsx("div",{children:T.jsx(yc,{numeric:!0,delayMs:50,value:this.state.current[0],onEnter:this.props.onEnter,blurOnEnter:!0,isDisabled:this.props.disabled,onChange:this.updateMin},void 0)},void 0),T.jsx("div",{children:T.jsx(Ste,{min:this.props.min,max:this.props.max,step:r,value:this.state.current,disabled:this.props.disabled,onBeforeChange:this.begin,onChange:this.updateCurrent,onAfterChange:this.end,range:!0,allowCross:!0},void 0)},void 0),T.jsx("div",{children:T.jsx(yc,{numeric:!0,delayMs:50,value:this.state.current[1],onEnter:this.props.onEnter,blurOnEnter:!0,isDisabled:this.props.disabled,onChange:this.updateMax},void 0)},void 0)]}),void 0)},t}(Ve.Component);function cD(e){for(var t=[],r={}.hasOwnProperty,n=0;n<arguments.length;n++){var i=arguments[n];if(i){var a=typeof i;if(a==="string"||a==="number")t.push(i);else if(Array.isArray(i))t.push(cD.apply(null,i));else if(a==="object")for(var o in i)r.call(i,o)&&i[o]&&t.push(o)}}return t.join(" ")}function Rz(e){return e.touches.length>1||e.type.toLowerCase()==="touchend"&&e.touches.length>0}function kz(e,t){return e?t.touches[0].clientY:t.touches[0].pageX}function Oz(e,t){return e?t.clientY:t.pageX}function Lz(e,t){var r=t.getBoundingClientRect();return e?r.top+r.height*.5:r.left+r.width*.5}function ET(e){e.stopPropagation(),e.preventDefault()}var hKe=function(e){Le(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.render=function(){var r=this.props,n=r.className,i=r.tipFormatter,a=r.vertical,o=r.offset,s=r.value,u=r.index,l=a?{bottom:o+"%"}:{left:o+"%"};return T.jsx("div",{className:n,style:l,title:i(s,u)},void 0)},t}(Ve.Component),Ste=function(e){Le(t,e);function t(r){var n=e.call(this,r)||this;n.sliderElement=Ve.createRef(),n.handleElements=[],n.dragOffset=0,n.startPosition=0,n.startValue=0,n._getPointsCache=void 0,n.onMouseDown=function(f){if(f.button===0){var h=Oz(n.props.vertical,f);if(!n.isEventFromHandle(f))n.dragOffset=0;else{var v=Lz(n.props.vertical,f.target);n.dragOffset=h-v,h=v}n.onStart(h),n.addDocumentEvents("mouse"),ET(f)}},n.onTouchMove=function(f){if(Rz(f)){n.end("touch");return}var h=kz(n.props.vertical,f);n.onMove(f,h-n.dragOffset)},n.onTouchStart=function(f){if(!Rz(f)){var h=kz(n.props.vertical,f);if(!n.isEventFromHandle(f))n.dragOffset=0;else{var v=Lz(n.props.vertical,f.target);n.dragOffset=h-v,h=v}n.onStart(h),n.addDocumentEvents("touch"),ET(f)}},n.eventHandlers={touchmove:function(f){return n.onTouchMove(f)},touchend:function(f){return n.end("touch")},mousemove:function(f){return n.onMouseMove(f)},mouseup:function(f){return n.end("mouse")}},n.calcOffset=function(f){var h=n.props,v=h.min,p=h.max,m=(f-v)/(p-v);return m*100};var i=r.range,a=r.min,o=r.max,s=i?Array.apply(null,Array(+i+1)).map(function(){return a}):a,u="defaultValue"in r?r.defaultValue:s,l=r.value!==void 0?r.value:u,c=(i?l:[a,l]).map(function(f){return n.trimAlignValue(f)}),d;return i&&c[0]===c[c.length-1]&&c[0]===o?d=0:d=c.length-1,n.state={handle:null,recent:d,bounds:c},n}return t.prototype.componentDidUpdate=function(r){var n=this;if("value"in this.props||"min"in this.props||"max"in this.props){var i=this.state.bounds;if(r.range){var a=this.props.value||i,o=a.map(function(u){return n.trimAlignValue(u,n.props)});if(o.every(function(u,l){return u===i[l]}))return;this.setState({bounds:o}),i.some(function(u){return n.isValueOutOfBounds(u,n.props)})&&this.props.onChange(o)}else{var a=this.props.value!==void 0?this.props.value:i[1],s=this.trimAlignValue(a,this.props);if(s===i[1]&&i[0]===r.min)return;this.setState({bounds:[r.min,s]}),this.isValueOutOfBounds(i[1],this.props)&&this.props.onChange(s)}}},t.prototype.onChange=function(r){var n=this.props,i=!("value"in n);i?this.setState(r):r.handle!==void 0&&this.setState({handle:r.handle});var a=E(E({},this.state),r),o=n.range?a.bounds:a.bounds[1];n.onChange(o)},t.prototype.onMouseMove=function(r){var n=Oz(this.props.vertical,r);this.onMove(r,n-this.dragOffset)},t.prototype.onMove=function(r,n){ET(r);var i=this.props,a=this.state,o=n-this.startPosition;o=this.props.vertical?-o:o;var s=o/this.getSliderLength()*(i.max-i.min),u=this.trimAlignValue(this.startValue+s),l=a.bounds[a.handle];if(u!==l){var c=Ft([],a.bounds);c[a.handle]=u;var d=a.handle;if(i.pushable){var f=a.bounds[d];this.pushSurroundingHandles(c,d,f)}else i.allowCross&&(c.sort(function(h,v){return h-v}),d=c.indexOf(u));this.onChange({handle:d,bounds:c})}},t.prototype.onStart=function(r){var n=this.props;n.onBeforeChange(this.getValue());var i=this.calcValueByPos(r);this.startValue=i,this.startPosition=r;var a=this.state,o=a.bounds,s=1;if(this.props.range){for(var u=0,l=1;l<o.length-1;++l)i>o[l]&&(u=l);Math.abs(o[u+1]-i)<Math.abs(o[u]-i)&&(u=u+1),s=u;var c=o[u+1]===o[u];c&&(s=a.recent),c&&i!==o[u+1]&&(s=i<o[u+1]?u:u+1)}this.setState({handle:s,recent:s});var d=a.bounds[s];if(i!==d){var f=Ft([],a.bounds);f[s]=i,this.onChange({bounds:f})}},t.prototype.getPoints=function(){var r=this.props,n=r.marks,i=r.step,a=r.min,o=r.max,s=this._getPointsCache;if(!s||s.marks!==n||s.step!==i){var u=E({},n);if(i!==null)for(var l=a;l<=o;l+=i)u[l]=l;var c=Object.keys(u).map(parseFloat);c.sort(function(d,f){return d-f}),this._getPointsCache={marks:n,step:i,points:c}}return this._getPointsCache.points},t.prototype.getPrecision=function(r){var n=r.toString(),i=0;return n.indexOf(".")>=0&&(i=n.length-n.indexOf(".")-1),i},t.prototype.getSliderLength=function(){var r=this.sliderElement.current;return r?this.props.vertical?r.clientHeight:r.clientWidth:0},t.prototype.getSliderStart=function(){var r=this.sliderElement.current,n=r.getBoundingClientRect();return this.props.vertical?n.top:n.left},t.prototype.getValue=function(){var r=this.state.bounds;return this.props.range?r:r[1]},t.prototype.addDocumentEvents=function(r){r==="touch"?(document.addEventListener("touchmove",this.eventHandlers.touchmove),document.addEventListener("touchend",this.eventHandlers.touchend)):r==="mouse"&&(document.addEventListener("mousemove",this.eventHandlers.mousemove),document.addEventListener("mouseup",this.eventHandlers.mouseup))},t.prototype.calcValue=function(r){var n=this.props,i=n.vertical,a=n.min,o=n.max,s=Math.abs(r/this.getSliderLength()),u=i?(1-s)*(o-a)+a:s*(o-a)+a;return u},t.prototype.calcValueByPos=function(r){var n=r-this.getSliderStart(),i=this.trimAlignValue(this.calcValue(n));return i},t.prototype.end=function(r){this.removeEvents(r),this.props.onAfterChange(this.getValue()),this.setState({handle:null})},t.prototype.isEventFromHandle=function(r){for(var n=0,i=this.handleElements;n<i.length;n++){var a=i[n];if(a.current===r.target)return!0}return!1},t.prototype.isValueOutOfBounds=function(r,n){return r<n.min||r>n.max},t.prototype.pushHandle=function(r,n,i,a){for(var o=r[n],s=r[n];i*(s-o)<a;){if(!this.pushHandleOnePoint(r,n,i))return r[n]=o,!1;s=r[n]}return!0},t.prototype.pushHandleOnePoint=function(r,n,i){var a=this.getPoints(),o=a.indexOf(r[n]),s=o+i;if(s>=a.length||s<0)return!1;var u=n+i,l=a[s],c=this.props.pushable,d=i*(r[u]-l);return this.pushHandle(r,u,i,+c-d)?(r[n]=l,!0):!1},t.prototype.pushSurroundingHandles=function(r,n,i){var a=this.props.pushable,o=r[n],s=0;if(r[n+1]-o<a?s=1:o-r[n-1]<a&&(s=-1),s!==0){var u=n+s,l=s*(r[u]-o);this.pushHandle(r,u,s,+a-l)||(r[n]=i)}},t.prototype.removeEvents=function(r){r==="touch"?(document.removeEventListener("touchmove",this.eventHandlers.touchmove),document.removeEventListener("touchend",this.eventHandlers.touchend)):r==="mouse"&&(document.removeEventListener("mousemove",this.eventHandlers.mousemove),document.removeEventListener("mouseup",this.eventHandlers.mouseup))},t.prototype.trimAlignValue=function(r,n){var i=this.state||{},a=i.handle,o=i.bounds,s=E(E({},this.props),n||{}),u=s.marks,l=s.step,c=s.min,d=s.max,f=s.allowCross,h=r;h<=c&&(h=c),h>=d&&(h=d),!f&&a!=null&&a>0&&h<=o[a-1]&&(h=o[a-1]),!f&&a!=null&&a<o.length-1&&h>=o[a+1]&&(h=o[a+1]);var v=Object.keys(u).map(parseFloat);if(l!==null){var p=Math.round((h-c)/l)*l+c;v.push(p)}var m=v.map(function(y){return Math.abs(h-y)}),g=v[m.indexOf(Math.min.apply(Math,m))];return l!==null?parseFloat(g.toFixed(this.getPrecision(l))):g},t.prototype.render=function(){var r,n=this,i=this.state,a=i.handle,o=i.bounds,s=this.props,u=s.className,l=s.prefixCls,c=s.disabled,d=s.vertical,f=s.range,h=s.step,v=s.marks,p=s.tipFormatter,m=this.props.handle,g=o.map(this.calcOffset),y=l+"-handle",b=o.map(function(M,D){var k;return cD((k={},k[y]=!0,k[y+"-"+(D+1)]=!0,k[y+"-lower"]=D===0,k[y+"-upper"]=D===o.length-1,k))}),S=h===null||p===null,x={prefixCls:l,noTip:S,tipFormatter:p,vertical:d};if(this.handleElements.length!==o.length){this.handleElements=[];for(var C=0;C<o.length;C++)this.handleElements.push(Ve.createRef())}var w=o.map(function(M,D){return Ve.cloneElement(m,E(E({},x),{className:b[D],value:M,offset:g[D],dragging:a===D,index:D,key:D,ref:n.handleElements[D]}))});f||w.shift();var A=cD((r={},r[l]=!0,r[l+"-with-marks"]=Object.keys(v).length,r[l+"-disabled"]=c,r[l+"-vertical"]=this.props.vertical,r[u]=!!u,r));return T.jsxs("div",E({ref:this.sliderElement,className:A,onTouchStart:c?ef:this.onTouchStart,onMouseDown:c?ef:this.onMouseDown},{children:[T.jsx("div",{className:l+"-rail"},void 0),w]}),void 0)},t.defaultProps={prefixCls:"msp-slider-base",className:"",min:0,max:100,step:1,marks:{},handle:T.jsx(hKe,{className:"",vertical:!1,offset:0,tipFormatter:function(r){return r},value:0,index:0},void 0),onBeforeChange:ef,onChange:ef,onAfterChange:ef,tipFormatter:function(r,n){return r},disabled:!1,range:!1,vertical:!1,allowCross:!0,pushable:!1},t}(Ve.Component),On=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.onChange=function(n){var i,a,o;if((o=(a=r.props).onChange)===null||o===void 0||o.call(a,n,r.props.values),r.props.onChangeValues){var s=E(E({},r.props.values),(i={},i[n.name]=n.value,i));r.props.onChangeValues(s,r.props.values)}},r.paramGroups=Kf(function(n){return vKe(n)}),r}return t.prototype.renderGroup=function(r){var n;if(r.length===0)return null;for(var i=this.props.values,a=null,o=void 0,s=0,u=r;s<u.length;s++){var l=u[s],c=l[0],d=l[1],f=l[2];!((n=d.hideIf)===null||n===void 0)&&n.call(d,i)||(a||(a=[]),o=d.category,a.push(T.jsx(f,{param:d,onChange:this.onChange,onEnter:this.props.onEnter,isDisabled:this.props.isDisabled,name:c,value:i[c]},c)))}return a?o?[T.jsx(Tu,E({header:o},{children:a}),o)]:a:null},t.prototype.renderPart=function(r){for(var n=null,i=0,a=r;i<a.length;i++){var o=a[i],s=this.renderGroup(o);if(s){n||(n=[]);for(var u=0,l=s;u<l.length;u++){var c=l[u];n.push(c)}}}return n},t.prototype.render=function(){var r=this.paramGroups(this.props.params),n=this.renderPart(r.essentials),i=this.renderPart(r.advanced);return n&&i?T.jsxs(T.Fragment,{children:[n,T.jsx(Tu,E({header:"Advanced Options"},{children:i}),void 0)]},void 0):n||i},t}(Ve.PureComponent),pKe=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.setSettings=function(n,i){var a,o=E(E({},i),(a={},a[n.name]=n.value,a)),s=r.props.mapping.update(o,r.plugin);r.props.mapping.apply(s,r.plugin)},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.events.canvas3d.settingsUpdated,function(){return r.forceUpdate()})},t.prototype.render=function(){var r=this.props.mapping.getTarget(this.plugin),n=this.props.mapping.getValues(r,this.plugin),i=this.props.mapping.params(this.plugin);return T.jsx(On,{params:i,values:n,onChange:this.setSettings},void 0)},t}(pr);function vKe(e){function t(c,d,f){var h=zb(d);if(h)if(!d.category)f.params[0].push([c,d,h]);else{f.map||(f.map=new Map);var v=f.map.get(d.category);v||(v=[],f.map.set(d.category,v),f.params.push(v)),v.push([c,d,h])}}function r(c,d){var f=c[0],h=d[0];return!f||!f[1].category?-1:!h||!h[1].category?1:f[1].category<h[1].category?-1:1}for(var n=Object.keys(e),i={params:[[]],map:void 0},a={params:[[]],map:void 0},o=0,s=n;o<s.length;o++){var u=s[o],l=e[u];l.isHidden||(l.isEssential?t(u,l,i):t(u,l,a))}return i.params.sort(r),a.params.sort(r),{essentials:i.params,advanced:a.params}}function zb(e){switch(e.type){case"value":return;case"boolean":return sL;case"number":return typeof e.min<"u"&&typeof e.max<"u"?bKe:yKe;case"converted":return UKe;case"conditioned":return BKe;case"multi-select":return LKe;case"color":return nKe;case"color-list":return e.offsets?IKe:TKe;case"vec3":return MKe;case"mat4":return DKe;case"url":return RKe;case"file":return kKe;case"file-list":return OKe;case"select":return uL;case"value-ref":return SKe;case"data-ref":return;case"text":return xKe;case"interval":return typeof e.min<"u"&&typeof e.max<"u"?_Ke:CKe;case"group":return _te;case"mapped":return NKe;case"line-graph":return gKe;case"script":return jKe;case"object-list":return cL;default:var t=e;console.warn(t+" has no associated UI component");return}}var mKe=function(e){Le(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.render=function(){var r=this.props,n=r.legend,i=r.description,a=n&&sKe(n);return T.jsx("div",E({className:"msp-help-text"},{children:T.jsxs("div",{children:[T.jsxs("div",E({className:"msp-help-description"},{children:[T.jsx(nn,{svg:Sl,inline:!0},void 0),i]}),void 0),a&&T.jsx("div",E({className:"msp-help-legend"},{children:T.jsx(a,{legend:n},void 0)}),void 0)]},void 0)}),void 0)},t}(Ve.PureComponent);function Ev(e){var t=e.props,r=e.state,n=e.control,i=e.toggleHelp,a=e.addOn,o=[];t.param.shortLabel&&o.push("msp-control-label-short"),t.param.twoColumns&&o.push("msp-control-col-2");var s=o.join(" "),u=t.param.label||Oa(t.name),l=t.param.help?t.param.help(t.value):{description:t.param.description,legend:t.param.legend},c=l.description||l.legend,d=u+(c?". Click for help.":"");return T.jsxs(T.Fragment,{children:[T.jsx(Ns,{className:s,title:d,label:T.jsxs(T.Fragment,{children:[u,c&&T.jsx("button",E({className:"msp-help msp-btn-link msp-btn-icon msp-control-group-expander",onClick:i,title:d||(r.showHelp?"Hide":"Show")+" help",style:{background:"transparent",textAlign:"left",padding:"0"}},{children:T.jsx(nn,{svg:Sl},void 0)}),void 0)]},void 0),control:n},void 0),c&&r.showHelp&&T.jsx("div",E({className:"msp-control-offset"},{children:T.jsx(mKe,{legend:l.legend,description:l.description},void 0)}),void 0),a]},void 0)}var Av=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={showHelp:!1},r.toggleHelp=function(){return r.setState({showHelp:!r.state.showHelp})},r}return t.prototype.update=function(r){this.props.onChange({param:this.props.param,name:this.props.name,value:r})},t.prototype.renderAddOn=function(){return null},t.prototype.render=function(){return Ev({props:this.props,state:this.state,control:this.renderControl(),toggleHelp:this.toggleHelp,addOn:this.renderAddOn()})},t}(Ve.PureComponent),sL=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.onClick=function(n){r.update(!r.props.value),n.currentTarget.blur()},r}return t.prototype.renderControl=function(){return T.jsxs("button",E({onClick:this.onClick,disabled:this.props.isDisabled},{children:[T.jsx(nn,{svg:this.props.value?qg:wY},void 0),this.props.value?"On":"Off"]}),void 0)},t}(Av),gKe=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isExpanded:!1,isOverPoint:!1,message:r.props.param.defaultValue.length+" points"},r.onHover=function(n){if(r.setState({isOverPoint:!r.state.isOverPoint}),n){r.setState({message:"("+n[0].toFixed(2)+", "+n[1].toFixed(2)+")"});return}r.setState({message:r.props.value.length+" points"})},r.onDrag=function(n){r.setState({message:"("+n[0].toFixed(2)+", "+n[1].toFixed(2)+")"})},r.onChange=function(n){r.props.onChange({name:r.props.name,param:r.props.param,value:n})},r.toggleExpanded=function(n){r.setState({isExpanded:!r.state.isExpanded}),n.currentTarget.blur()},r}return t.prototype.render=function(){var r=this.props.param.label||Oa(this.props.name);return T.jsxs(T.Fragment,{children:[T.jsx(Ns,{label:r,control:T.jsx("button",E({onClick:this.toggleExpanded,disabled:this.props.isDisabled},{children:""+this.state.message}),void 0)},void 0),T.jsx("div",E({className:"msp-control-offset",style:{display:this.state.isExpanded?"block":"none"}},{children:T.jsx(dKe,{data:this.props.param.defaultValue,onChange:this.onChange,onHover:this.onHover,onDrag:this.onDrag},void 0)}),void 0)]},void 0)},t}(Ve.PureComponent),yKe=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={value:"0"},r.update=function(n){var i=ZC(r.props.param.step||.01);n=parseFloat(n.toFixed(i)),r.props.onChange({param:r.props.param,name:r.props.name,value:n})},r}return t.prototype.render=function(){var r=this.props.param.label||Oa(this.props.name),n=this.props.param.label||Oa(this.props.name),i=ZC(this.props.param.step||.01);return T.jsx(Ns,{title:this.props.param.description,label:n,control:T.jsx(yc,{numeric:!0,value:parseFloat(this.props.value.toFixed(i)),onEnter:this.props.onEnter,placeholder:r,isDisabled:this.props.isDisabled,onChange:this.update},void 0)},void 0)},t}(Ve.PureComponent),bKe=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.onChange=function(n){r.update(n)},r}return t.prototype.renderControl=function(){var r=typeof this.props.value>"u"?this.props.param.defaultValue:this.props.value;return T.jsx(xte,{value:r,min:this.props.param.min,max:this.props.param.max,step:this.props.param.step,onChange:this.onChange,onChangeImmediate:this.props.param.immediateUpdate?this.onChange:void 0,disabled:this.props.isDisabled,onEnter:this.props.onEnter},void 0)},t}(Av),xKe=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.onChange=function(n){var i=n.target.value;i!==r.props.value&&r.update(i)},r.onKeyPress=function(n){(n.keyCode===13||n.charCode===13||n.key==="Enter")&&r.props.onEnter&&r.props.onEnter(),n.stopPropagation()},r}return t.prototype.renderControl=function(){var r=this.props.param.label||Oa(this.props.name);return T.jsx("input",{type:"text",value:this.props.value||"",placeholder:r,onChange:this.onChange,onKeyPress:this.props.onEnter?this.onKeyPress:void 0,disabled:this.props.isDisabled},void 0)},t}(Av),um=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.onChange=function(n){typeof r.props.param.defaultValue=="number"?r.update(parseInt(n.target.value,10)):r.update(n.target.value)},r}return t.prototype.update=function(r){this.props.onChange({param:this.props.param,name:this.props.name,value:r})},t.prototype.render=function(){var r=this,n=this.props.value!==void 0&&!this.props.param.options.some(function(i){return i[0]===r.props.value});return T.jsxs("select",E({className:"msp-form-control",title:this.props.title,value:this.props.value!==void 0?this.props.value:this.props.param.defaultValue,onChange:this.onChange,disabled:this.props.isDisabled},{children:[n&&T.jsx("option",E({value:this.props.value},{children:"[Invalid] "+this.props.value}),this.props.value),this.props.param.options.map(function(i){var a=i[0],o=i[1];return T.jsx("option",E({value:a},{children:o}),a)})]}),void 0)},t}(Ve.PureComponent),uL=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={showHelp:!1,showOptions:!1},r.onSelect=function(n){!n||n.value===r.props.value?r.setState({showOptions:!1}):r.setState({showOptions:!1},function(){r.props.onChange({param:r.props.param,name:r.props.name,value:n.value})})},r.toggle=function(){return r.setState({showOptions:!r.state.showOptions})},r.cycle=function(){var n=r.props.param.options,i=n.findIndex(function(o){return o[0]===r.props.value}),a=i===n.length-1?0:i+1;r.props.onChange({param:r.props.param,name:r.props.name,value:n[a][0]})},r.items=Kf(function(n){return er.createItemsFromSelectOptions(n.options)}),r.toggleHelp=function(){return r.setState({showHelp:!r.state.showHelp})},r}return t.prototype.renderControl=function(){var r,n=this.items(this.props.param),i=this.props.value!==void 0?er.findItem(n,this.props.value):void 0,a=i?i.label:typeof this.props.value>"u"?(((r=er.getFirstItem(n))===null||r===void 0?void 0:r.label)||"")+" [Default]":"[Invalid] "+this.props.value,o=this.props.param.cycle?this.cycle:this.toggle,s=this.props.param.cycle?"center":"left",u=this.props.param.cycle?this.props.value==="on"?qg:this.props.value==="off"?wY:void 0:void 0;return T.jsx(Ai,{disabled:this.props.isDisabled,style:{textAlign:s,overflow:"hidden",textOverflow:"ellipsis"},label:a,title:a,icon:u,toggle:o,isSelected:this.state.showOptions},void 0)},t.prototype.renderAddOn=function(){if(!this.state.showOptions)return null;var r=this.items(this.props.param),n=er.findItem(r,this.props.value);return T.jsx(er,{items:r,current:n,onSelect:this.onSelect},void 0)},t.prototype.render=function(){return Ev({props:this.props,state:this.state,control:this.renderControl(),toggleHelp:this.toggleHelp,addOn:this.renderAddOn()})},t}(Ve.PureComponent),SKe=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={showHelp:!1,showOptions:!1},r.onSelect=function(n){!n||n.value===r.props.value?r.setState({showOptions:!1}):r.setState({showOptions:!1},function(){r.props.onChange({param:r.props.param,name:r.props.name,value:{ref:n.value}})})},r.toggle=function(){return r.setState({showOptions:!r.state.showOptions})},r.items=Kf(function(n){return er.createItemsFromSelectOptions(n.getOptions())}),r.toggleHelp=function(){return r.setState({showHelp:!r.state.showHelp})},r}return t.prototype.renderControl=function(){var r,n=this.items(this.props.param),i=this.props.value.ref?er.findItem(n,this.props.value.ref):void 0,a=i?i.label:"[Ref] "+((r=this.props.value.ref)!==null&&r!==void 0?r:"");return T.jsx(Ai,{disabled:this.props.isDisabled,style:{textAlign:"left",overflow:"hidden",textOverflow:"ellipsis"},label:a,title:a,toggle:this.toggle,isSelected:this.state.showOptions},void 0)},t.prototype.renderAddOn=function(){if(!this.state.showOptions)return null;var r=this.items(this.props.param),n=er.findItem(r,this.props.value.ref);return T.jsx(er,{items:r,current:n,onSelect:this.onSelect},void 0)},t.prototype.render=function(){return Ev({props:this.props,state:this.state,control:this.renderControl(),toggleHelp:this.toggleHelp,addOn:this.renderAddOn()})},t}(Ve.PureComponent),CKe=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isExpanded:!1},r.components={0:I.Numeric(0,{step:r.props.param.step},{label:"Min"}),1:I.Numeric(0,{step:r.props.param.step},{label:"Max"})},r.componentChange=function(n){var i=n.name,a=n.value,o=Ft([],r.props.value);o[+i]=a,r.change(o)},r.toggleExpanded=function(n){r.setState({isExpanded:!r.state.isExpanded}),n.currentTarget.blur()},r}return t.prototype.change=function(r){this.props.onChange({name:this.props.name,param:this.props.param,value:r})},t.prototype.render=function(){var r=this.props.value,n=this.props.param.label||Oa(this.props.name),i=ZC(this.props.param.step||.01),a="["+r[0].toFixed(i)+", "+r[1].toFixed(i)+"]";return T.jsxs(T.Fragment,{children:[T.jsx(Ns,{label:n,control:T.jsx("button",E({onClick:this.toggleExpanded,disabled:this.props.isDisabled},{children:a}),void 0)},void 0),this.state.isExpanded&&T.jsx("div",E({className:"msp-control-offset"},{children:T.jsx(On,{params:this.components,values:r,onChange:this.componentChange,onEnter:this.props.onEnter},void 0)}),void 0)]},void 0)},t}(Ve.PureComponent),_Ke=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.onChange=function(n){r.update(n)},r}return t.prototype.renderControl=function(){return T.jsx(fKe,{value:this.props.value,min:this.props.param.min,max:this.props.param.max,step:this.props.param.step,onChange:this.onChange,disabled:this.props.isDisabled,onEnter:this.props.onEnter},void 0)},t}(Av);(function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.onChange=function(n){r.update(at(parseInt(n.target.value)))},r}return t.prototype.stripStyle=function(){return{background:at.toStyle(this.props.value),position:"absolute",bottom:"0",height:"4px",right:"0",left:"0"}},t.prototype.renderControl=function(){return T.jsxs("div",E({style:{position:"relative"}},{children:[T.jsxs("select",E({value:this.props.value,onChange:this.onChange},{children:[oKe(this.props.value),iKe()]}),void 0),T.jsx("div",{style:this.stripStyle()},void 0)]}),void 0)},t})(Av);function _y(e,t){return t===void 0&&(t=!1),Array.isArray(e)?t?at.toStyle(e[0])+" "+(100*e[1]).toFixed(2)+"%":at.toStyle(e[0]):at.toStyle(e)}var wKe=O3(function(e){var t=e.map(function(r){return _y(r,!0)});return"linear-gradient(to right, "+t.join(", ")+")"}),EKe=O3(function(e){for(var t=e.length,r=[_y(e[0])+" "+100*(1/t)+"%"],n=1,i=t-1;n<i;++n)r.push(_y(e[n])+" "+100*(n/t)+"%",_y(e[n])+" "+100*((n+1)/t)+"%");return r.push(_y(e[t-1])+" "+100*((t-1)/t)+"%"),"linear-gradient(to right, "+r.join(", ")+")"});function lL(e,t){return t===void 0&&(t="0"),{background:AKe(e.colors,e.kind==="set"),position:"absolute",bottom:"0",height:"4px",right:t,left:"0"}}function AKe(e,t){return t?EKe(e):wKe(e)}function PKe(){var e=function(t){var r=Os(t[0]);return T.jsx("div",{style:lL({kind:r.type!=="qualitative"?"interpolate":"set",colors:r.list})},void 0)};return{ColorPresets:{all:er.createItemsFromSelectOptions(Rk,{addOn:e}),scale:er.createItemsFromSelectOptions(A_e,{addOn:e}),set:er.createItemsFromSelectOptions(P_e,{addOn:e})},ColorsParam:I.ObjectList({color:I.Color(0)},function(t){var r=t.color;return at.toHexString(r).toUpperCase()}),OffsetColorsParam:I.ObjectList({color:I.Color(0),offset:I.Numeric(0,{min:0,max:1,step:.01})},function(t){var r=t.color,n=t.offset;return at.toHexString(r).toUpperCase()+" ["+n.toFixed(2)+"]"}),IsInterpolatedParam:I.Boolean(!1,{label:"Interpolated"})}}var mx;function Cte(){return mx||(mx=PKe(),mx)}var TKe=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={showHelp:!1,show:void 0},r.toggleEdit=function(){return r.setState({show:r.state.show==="edit"?void 0:"edit"})},r.togglePresets=function(){return r.setState({show:r.state.show==="presets"?void 0:"presets"})},r.selectPreset=function(n){if(n){r.setState({show:void 0});var i=Os(n.value);r.update({kind:i.type!=="qualitative"?"interpolate":"set",colors:i.list})}},r.colorsChanged=function(n){var i=n.value;r.update({kind:r.props.value.kind,colors:i.map(function(a){return a.color})})},r.isInterpolatedChanged=function(n){var i=n.value;r.update({kind:i?"interpolate":"set",colors:r.props.value.colors})},r.toggleHelp=function(){return r.setState({showHelp:!r.state.showHelp})},r}return t.prototype.update=function(r){this.props.onChange({param:this.props.param,name:this.props.name,value:r})},t.prototype.renderControl=function(){var r=this.props.value;return T.jsxs(T.Fragment,{children:[T.jsxs("button",E({onClick:this.toggleEdit,style:{position:"relative",paddingRight:"33px"}},{children:[r.colors.length===1?"1 color":r.colors.length+" colors",T.jsx("div",{style:lL(r,"33px")},void 0)]}),void 0),T.jsx(Ht,{svg:p3,onClick:this.togglePresets,toggleState:this.state.show==="presets",title:"Color Presets",style:{padding:0,position:"absolute",right:0,top:0,width:"32px"}},void 0)]},void 0)},t.prototype.renderColors=function(){if(!this.state.show)return null;var r=Cte(),n=r.ColorPresets,i=r.ColorsParam,a=r.IsInterpolatedParam,o=n[this.props.param.presetKind];if(this.state.show==="presets")return T.jsx(er,{items:o,onSelect:this.selectPreset},void 0);var s=this.props.value.colors.map(function(u){return{color:u}});return T.jsxs("div",E({className:"msp-control-offset"},{children:[T.jsx(cL,{name:"colors",param:i,value:s,onChange:this.colorsChanged,isDisabled:this.props.isDisabled,onEnter:this.props.onEnter},void 0),T.jsx(sL,{name:"isInterpolated",param:a,value:this.props.value.kind==="interpolate",onChange:this.isInterpolatedChanged,isDisabled:this.props.isDisabled,onEnter:this.props.onEnter},void 0)]}),void 0)},t.prototype.render=function(){return Ev({props:this.props,state:this.state,control:this.renderControl(),toggleHelp:this.toggleHelp,addOn:this.renderColors()})},t}(Ve.PureComponent),IKe=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={showHelp:!1,show:void 0},r.toggleEdit=function(){return r.setState({show:r.state.show==="edit"?void 0:"edit"})},r.togglePresets=function(){return r.setState({show:r.state.show==="presets"?void 0:"presets"})},r.selectPreset=function(n){if(n){r.setState({show:void 0});var i=Os(n.value);r.update({kind:i.type!=="qualitative"?"interpolate":"set",colors:i.list})}},r.colorsChanged=function(n){var i=n.value,a=i.map(function(o){return[o.color,o.offset]});a.sort(function(o,s){return o[1]-s[1]}),r.update({kind:r.props.value.kind,colors:a})},r.isInterpolatedChanged=function(n){var i=n.value;r.update({kind:i?"interpolate":"set",colors:r.props.value.colors})},r.toggleHelp=function(){return r.setState({showHelp:!r.state.showHelp})},r}return t.prototype.update=function(r){this.props.onChange({param:this.props.param,name:this.props.name,value:r})},t.prototype.renderControl=function(){var r=this.props.value;return T.jsxs(T.Fragment,{children:[T.jsxs("button",E({onClick:this.toggleEdit,style:{position:"relative",paddingRight:"33px"}},{children:[r.colors.length===1?"1 color":r.colors.length+" colors",T.jsx("div",{style:lL(r,"33px")},void 0)]}),void 0),T.jsx(Ht,{svg:p3,onClick:this.togglePresets,toggleState:this.state.show==="presets",title:"Color Presets",style:{padding:0,position:"absolute",right:0,top:0,width:"32px"}},void 0)]},void 0)},t.prototype.renderColors=function(){if(!this.state.show)return null;var r=Cte(),n=r.ColorPresets,i=r.OffsetColorsParam,a=r.IsInterpolatedParam,o=n[this.props.param.presetKind];if(this.state.show==="presets")return T.jsx(er,{items:o,onSelect:this.selectPreset},void 0);var s=this.props.value.colors,u=s.map(function(l,c){return Array.isArray(l)?{color:l[0],offset:l[1]}:{color:l,offset:c/s.length}});return u.sort(function(l,c){return l.offset-c.offset}),T.jsxs("div",E({className:"msp-control-offset"},{children:[T.jsx(cL,{name:"colors",param:i,value:u,onChange:this.colorsChanged,isDisabled:this.props.isDisabled,onEnter:this.props.onEnter},void 0),T.jsx(sL,{name:"isInterpolated",param:a,value:this.props.value.kind==="interpolate",onChange:this.isInterpolatedChanged,isDisabled:this.props.isDisabled,onEnter:this.props.onEnter},void 0)]}),void 0)},t.prototype.render=function(){return Ev({props:this.props,state:this.state,control:this.renderControl(),toggleHelp:this.toggleHelp,addOn:this.renderColors()})},t}(Ve.PureComponent),MKe=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isExpanded:!1},r.components={0:I.Numeric(0,{step:r.props.param.step},{label:r.props.param.fieldLabels&&r.props.param.fieldLabels.x||"X"}),1:I.Numeric(0,{step:r.props.param.step},{label:r.props.param.fieldLabels&&r.props.param.fieldLabels.y||"Y"}),2:I.Numeric(0,{step:r.props.param.step},{label:r.props.param.fieldLabels&&r.props.param.fieldLabels.z||"Z"})},r.componentChange=function(n){var i=n.name,a=n.value,o=_.copy(_.zero(),r.props.value);o[+i]=a,r.change(o)},r.toggleExpanded=function(n){r.setState({isExpanded:!r.state.isExpanded}),n.currentTarget.blur()},r}return t.prototype.change=function(r){this.props.onChange({name:this.props.name,param:this.props.param,value:r})},t.prototype.render=function(){var r=this.props.value,n=this.props.param.label||Oa(this.props.name),i=ZC(this.props.param.step||.01),a="["+r[0].toFixed(i)+", "+r[1].toFixed(i)+", "+r[2].toFixed(i)+"]";return T.jsxs(T.Fragment,{children:[T.jsx(Ns,{label:n,control:T.jsx("button",E({onClick:this.toggleExpanded,disabled:this.props.isDisabled},{children:a}),void 0)},void 0),this.state.isExpanded&&T.jsx("div",E({className:"msp-control-offset"},{children:T.jsx(On,{params:this.components,values:r,onChange:this.componentChange,onEnter:this.props.onEnter},void 0)}),void 0)]},void 0)},t}(Ve.PureComponent),DKe=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isExpanded:!1},r.components={json:I.Text(JSON.stringify(ue()),{description:"JSON array with 4x4 matrix in a column major (j * 4 + i indexing) format"})},r.componentChange=function(n){var i=n.name,a=n.value,o=ue.copy(ue(),r.props.value);i==="json"?ue.copy(o,JSON.parse(a)):o[+i]=a,r.change(o)},r.toggleExpanded=function(n){r.setState({isExpanded:!r.state.isExpanded}),n.currentTarget.blur()},r}return t.prototype.change=function(r){this.props.onChange({name:this.props.name,param:this.props.param,value:r})},t.prototype.changeValue=function(r){var n=this;return function(i){var a=ue.copy(ue(),n.props.value);a[r]=i,n.change(a)}},Object.defineProperty(t.prototype,"grid",{get:function(){for(var r=this.props.value,n=[],i=0;i<4;i++){for(var a=[],o=0;o<4;o++)a.push(T.jsx(yc,{numeric:!0,delayMs:50,value:ue.getValue(r,i,o),onChange:this.changeValue(4*o+i),className:"msp-form-control",blurOnEnter:!0,isDisabled:this.props.isDisabled},o));n.push(T.jsx("div",E({className:"msp-flex-row"},{children:a}),i))}return T.jsx("div",E({className:"msp-parameter-matrix"},{children:n}),void 0)},enumerable:!1,configurable:!0}),t.prototype.render=function(){var r={json:JSON.stringify(this.props.value)},n=this.props.param.label||Oa(this.props.name);return T.jsxs(T.Fragment,{children:[T.jsx(Ns,{label:n,control:T.jsx("button",E({onClick:this.toggleExpanded,disabled:this.props.isDisabled},{children:"4×4 Matrix"}),void 0)},void 0),this.state.isExpanded&&T.jsxs("div",E({className:"msp-control-offset"},{children:[this.grid,T.jsx(On,{params:this.components,values:r,onChange:this.componentChange,onEnter:this.props.onEnter},void 0)]}),void 0)]},void 0)},t}(Ve.PureComponent),RKe=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.onChange=function(n){var i=n.target.value;i!==Cn.getUrl(r.props.value||"")&&r.update(Cn.Url(i))},r.onKeyPress=function(n){(n.keyCode===13||n.charCode===13||n.key==="Enter")&&r.props.onEnter&&r.props.onEnter(),n.stopPropagation()},r}return t.prototype.renderControl=function(){var r=this.props.param.label||Oa(this.props.name);return T.jsx("input",{type:"text",value:Cn.getUrl(this.props.value||""),placeholder:r,onChange:this.onChange,onKeyPress:this.props.onEnter?this.onKeyPress:void 0,disabled:this.props.isDisabled},void 0)},t}(Av),kKe=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={showHelp:!1},r.onChangeFile=function(n){r.change(n.target.files[0])},r.toggleHelp=function(){return r.setState({showHelp:!r.state.showHelp})},r}return t.prototype.change=function(r){this.props.onChange({name:this.props.name,param:this.props.param,value:Cn.File(r)})},t.prototype.renderControl=function(){var r=this.props.value;return T.jsxs("div",E({className:"msp-btn msp-btn-block msp-btn-action msp-loader-msp-btn-file",style:{marginTop:"1px"}},{children:[r?r.name:"Select a file..."," ",T.jsx("input",{disabled:this.props.isDisabled,onChange:this.onChangeFile,type:"file",multiple:!1,accept:this.props.param.accept},void 0)]}),void 0)},t.prototype.render=function(){return this.props.param.label?Ev({props:this.props,state:this.state,control:this.renderControl(),toggleHelp:this.toggleHelp,addOn:null}):this.renderControl()},t}(Ve.PureComponent),OKe=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={showHelp:!1},r.onChangeFileList=function(n){r.change(n.target.files)},r.toggleHelp=function(){return r.setState({showHelp:!r.state.showHelp})},r}return t.prototype.change=function(r){var n=[];if(r)for(var i=0,a=r.length;i<a;++i)n.push(Cn.File(r[i]));this.props.onChange({name:this.props.name,param:this.props.param,value:n})},t.prototype.renderControl=function(){var r=this.props.value,n=[];if(r)for(var i=0,a=r;i<a.length;i++){var o=a[i];n.push(o.name)}var s=n.length===0?"Select files...":n.length===1?n[0]:n.length+" files selected";return T.jsxs("div",E({className:"msp-btn msp-btn-block msp-btn-action msp-loader-msp-btn-file",style:{marginTop:"1px"}},{children:[s," ",T.jsx("input",{disabled:this.props.isDisabled,onChange:this.onChangeFileList,type:"file",multiple:!0,accept:this.props.param.accept},void 0)]}),void 0)},t.prototype.render=function(){return this.props.param.label?Ev({props:this.props,state:this.state,control:this.renderControl(),toggleHelp:this.toggleHelp,addOn:null}):this.renderControl()},t}(Ve.PureComponent),LKe=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isExpanded:!1},r.toggleExpanded=function(n){r.setState({isExpanded:!r.state.isExpanded}),n.currentTarget.blur()},r}return t.prototype.change=function(r){this.props.onChange({name:this.props.name,param:this.props.param,value:r})},t.prototype.toggle=function(r){var n=this;return function(i){n.props.value.indexOf(r)<0?n.change(n.props.value.concat(r)):n.change(n.props.value.filter(function(a){return a!==r})),i.currentTarget.blur()}},t.prototype.render=function(){var r=this,n=this.props.value,i=this.props.param.emptyValue,a=this.props.param.label||Oa(this.props.name);return T.jsxs(T.Fragment,{children:[T.jsx(Ns,{label:a,control:T.jsx("button",E({onClick:this.toggleExpanded,disabled:this.props.isDisabled},{children:n.length===0&&i?i:n.length+" of "+this.props.param.options.length}),void 0)},void 0),this.state.isExpanded&&T.jsx("div",E({className:"msp-control-offset"},{children:this.props.param.options.map(function(o){var s=o[0],u=o[1],l=n.indexOf(s)>=0;return T.jsx(hr,E({onClick:r.toggle(s),disabled:r.props.isDisabled,style:{marginTop:"1px"}},{children:T.jsx("span",E({style:{float:l?"left":"right"}},{children:l?"✓ "+u:u+" ✗"}),void 0)}),s)})}),void 0)]},void 0)},t}(Ve.PureComponent),_te=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isExpanded:!!r.props.param.isExpanded,showHelp:!1},r.onChangeParam=function(n){var i;r.change(E(E({},r.props.value),(i={},i[n.name]=n.value,i)))},r.toggleExpanded=function(){return r.setState({isExpanded:!r.state.isExpanded})},r}return t.prototype.change=function(r){this.props.onChange({name:this.props.name,param:this.props.param,value:r})},t.prototype.pivoted=function(){var r=this.props.param.pivot,n=this.props.param.params,i=n[r],a=zb(i),o=T.jsx(a,{name:r,param:i,value:this.props.value[r],onChange:this.onChangeParam,onEnter:this.props.onEnter,isDisabled:this.props.isDisabled},void 0);if(!this.state.isExpanded)return T.jsxs("div",E({className:"msp-mapped-parameter-group"},{children:[o,T.jsx(Ht,{svg:jp,onClick:this.toggleExpanded,toggleState:this.state.isExpanded,title:"More Options"},void 0)]}),void 0);for(var s=Object.create(null),u=0,l=Object.keys(n);u<l.length;u++){var c=l[u];c!==r&&(s[c]=n[c])}return T.jsxs("div",E({className:"msp-mapped-parameter-group"},{children:[o,T.jsx(Ht,{svg:jp,onClick:this.toggleExpanded,toggleState:this.state.isExpanded,title:"More Options"},void 0),T.jsx("div",E({className:"msp-control-offset"},{children:T.jsx(On,{params:s,onEnter:this.props.onEnter,values:this.props.value,onChange:this.onChangeParam,isDisabled:this.props.isDisabled},void 0)}),void 0)]}),void 0)},t.prototype.render=function(){var r=this.props.param.params;if(Object.keys(r).length===0)return null;if(this.props.param.pivot)return this.pivoted();var n=this.props.param.label||Oa(this.props.name),i=T.jsx(On,{params:r,onChange:this.onChangeParam,values:this.props.value,onEnter:this.props.onEnter,isDisabled:this.props.isDisabled},void 0);return this.props.inMapped?T.jsx("div",E({className:"msp-control-offset"},{children:i}),void 0):this.props.param.isFlat?i:T.jsxs("div",E({className:"msp-control-group-wrapper"},{children:[T.jsx("div",E({className:"msp-control-group-header"},{children:T.jsxs("button",E({className:"msp-btn msp-form-control msp-btn-block",onClick:this.toggleExpanded},{children:[T.jsx(nn,{svg:this.state.isExpanded?Rc:kc},void 0),n]}),void 0)}),void 0),this.state.isExpanded&&T.jsx("div",E({className:"msp-control-offset"},{children:i}),void 0)]}),void 0)},t}(Ve.PureComponent),NKe=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isExpanded:!1},r.valuesCache={},r.onChangeName=function(n){r.change({name:n.value,params:r.getValues(n.value)})},r.onChangeParam=function(n){r.setValues(r.props.value.name,n.value),r.change({name:r.props.value.name,params:n.value})},r.toggleExpanded=function(){return r.setState({isExpanded:!r.state.isExpanded})},r}return t.prototype.setValues=function(r,n){this.valuesCache[r]=n},t.prototype.getValues=function(r){return r in this.valuesCache?this.valuesCache[r]:this.props.param.map(r).defaultValue},t.prototype.change=function(r){this.props.onChange({name:this.props.name,param:this.props.param,value:r})},t.prototype.areParamsEmpty=function(r){for(var n=0,i=Object.keys(r);n<i.length;n++){var a=i[n];if(!r[a].isHidden)return!1}return!0},t.prototype.render=function(){var r=this,n=this.props.value||this.props.param.defaultValue,i=this.props.param.map(n.name),a=this.props.param.label||Oa(this.props.name),o=zb(i),s=this.props.param.help,u=s?E(E({},this.props.param.select),{help:function(c){return s({name:c,params:r.getValues(c)})}}):this.props.param.select,l=T.jsx(uL,{param:u,isDisabled:this.props.isDisabled,onChange:this.onChangeName,onEnter:this.props.onEnter,name:a,value:n.name},void 0);return o?i.type==="group"&&!i.isFlat?this.areParamsEmpty(i.params)?l:T.jsxs("div",E({className:"msp-mapped-parameter-group"},{children:[l,T.jsx(Ht,{svg:jp,onClick:this.toggleExpanded,toggleState:this.state.isExpanded,title:a+" Properties"},void 0),this.state.isExpanded&&T.jsx(_te,{inMapped:!0,param:i,value:n.params,name:n.name,onChange:this.onChangeParam,onEnter:this.props.onEnter,isDisabled:this.props.isDisabled},void 0)]}),void 0):T.jsxs(T.Fragment,{children:[l,T.jsx(o,{param:i,value:n.params,name:n.name,onChange:this.onChangeParam,onEnter:this.props.onEnter,isDisabled:this.props.isDisabled},void 0)]},void 0):l},t}(Ve.PureComponent),wte=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={current:r.props.value},r.onChangeParam=function(n){var i;r.setState({current:E(E({},r.state.current),(i={},i[n.name]=n.value,i))})},r.apply=function(){r.props.apply(r.state.current)},r}return t.prototype.componentDidUpdate=function(r){(this.props.params!==r.params||this.props.value!==r.value)&&this.setState({current:this.props.value})},t.prototype.render=function(){return T.jsxs(T.Fragment,{children:[T.jsx(On,{params:this.props.params,onChange:this.onChangeParam,values:this.state.current,onEnter:this.apply,isDisabled:this.props.isDisabled},void 0),T.jsx("button",E({className:"msp-btn msp-btn-block msp-form-control msp-control-top-offset",onClick:this.apply,disabled:this.props.isDisabled},{children:this.props.isUpdate?"Update":"Add"}),void 0)]},void 0)},t}(Ve.PureComponent),FKe=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isExpanded:!1},r.update=function(n){r.props.actions.update(n,r.props.index)},r.moveUp=function(){r.props.actions.move(r.props.index,-1)},r.moveDown=function(){r.props.actions.move(r.props.index,1)},r.remove=function(){r.setState({isExpanded:!1}),r.props.actions.remove(r.props.index)},r.toggleExpanded=function(n){r.setState({isExpanded:!r.state.isExpanded}),n.currentTarget.blur()},r}return t.prototype.render=function(){return T.jsxs(T.Fragment,{children:[T.jsxs("div",E({className:"msp-param-object-list-item"},{children:[T.jsxs("button",E({className:"msp-btn msp-btn-block msp-form-control",onClick:this.toggleExpanded},{children:[T.jsx("span",{children:this.props.index+1+": "},void 0),this.props.param.getLabel(this.props.value)]}),void 0),T.jsxs("div",{children:[T.jsx(Ht,{svg:f3,title:"Move Up",onClick:this.moveUp,small:!0},void 0),T.jsx(Ht,{svg:h3,title:"Move Down",onClick:this.moveDown,small:!0},void 0),T.jsx(Ht,{svg:Vs,title:"Remove",onClick:this.remove,small:!0},void 0)]},void 0)]}),void 0),this.state.isExpanded&&T.jsx("div",E({className:"msp-control-offset"},{children:T.jsx(wte,{params:this.props.param.element,apply:this.update,value:this.props.value,isUpdate:!0,isDisabled:this.props.isDisabled},void 0)}),void 0)]},void 0)},t}(Ve.PureComponent),cL=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isExpanded:!1},r.add=function(n){r.change(Ft(Ft([],r.props.value),[n]))},r.actions={update:function(n,i){var a=r.props.value.slice(0);a[i]=n,r.change(a)},move:function(n,i){var a=r.props.value;if(a.length!==1){var o=(n+i)%a.length;o<0&&(o+=a.length),a=a.slice(0);var s=a[n];a[n]=a[o],a[o]=s,r.change(a)}},remove:function(n){for(var i=r.props.value,a=[],o=0;o<i.length;o++)n!==o&&a.push(i[o]);r.change(a)}},r.toggleExpanded=function(n){r.setState({isExpanded:!r.state.isExpanded}),n.currentTarget.blur()},r}return t.prototype.change=function(r){this.props.onChange({name:this.props.name,param:this.props.param,value:r})},t.prototype.render=function(){var r=this,n=this.props.value,i=this.props.param.label||Oa(this.props.name),a=n.length+" item"+(n.length!==1?"s":"");return T.jsxs(T.Fragment,{children:[T.jsx(Ns,{label:i,control:T.jsx("button",E({onClick:this.toggleExpanded,disabled:this.props.isDisabled},{children:a}),void 0)},void 0),this.state.isExpanded&&T.jsxs("div",E({className:"msp-control-offset"},{children:[this.props.value.map(function(o,s){return T.jsx(FKe,{param:r.props.param,value:o,index:s,actions:r.actions,isDisabled:r.props.isDisabled},s)}),T.jsx(fc,E({header:"New Item"},{children:T.jsx(wte,{params:this.props.param.element,apply:this.add,value:this.props.param.ctor(),isDisabled:this.props.isDisabled},void 0)}),void 0)]}),void 0)]},void 0)},t}(Ve.PureComponent),BKe=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.onChangeCondition=function(n){r.change(r.props.param.conditionedValue(r.props.value,n.value))},r.onChangeParam=function(n){r.change(n.value)},r}return t.prototype.change=function(r){this.props.onChange({name:this.props.name,param:this.props.param,value:r})},t.prototype.render=function(){var r=this.props.value,n=this.props.param.conditionForValue(r),i=this.props.param.conditionParams[n],a=this.props.param.label||Oa(this.props.name),o=zb(i),s=T.jsx(uL,{param:this.props.param.select,isDisabled:this.props.isDisabled,onChange:this.onChangeCondition,onEnter:this.props.onEnter,name:a+" Kind",value:n},void 0);return o?T.jsxs(T.Fragment,{children:[s,T.jsx(o,{param:i,value:r,name:a,onChange:this.onChangeParam,onEnter:this.props.onEnter,isDisabled:this.props.isDisabled},void 0)]},void 0):s},t}(Ve.PureComponent),UKe=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.onChange=function(n){r.props.onChange({name:r.props.name,param:r.props.param,value:r.props.param.toValue(n.value)})},r}return t.prototype.render=function(){var r=this.props.param.fromValue(this.props.value),n=zb(this.props.param.converted);return n?T.jsx(n,{param:this.props.param.converted,value:r,name:this.props.name,onChange:this.onChange,onEnter:this.props.onEnter,isDisabled:this.props.isDisabled},void 0):null},t}(Ve.PureComponent),jKe=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.onChange=function(n){var i=n.target.value;i!==r.props.value.expression&&r.update({language:r.props.value.language,expression:i})},r.onKeyPress=function(n){(n.keyCode===13||n.charCode===13||n.key==="Enter")&&r.props.onEnter&&r.props.onEnter(),n.stopPropagation()},r}return t.prototype.renderControl=function(){var r=this.props.param.label||Oa(this.props.name);return T.jsx("input",{type:"text",value:this.props.value.expression||"",placeholder:r,onChange:this.onChange,onKeyPress:this.props.onEnter?this.onKeyPress:void 0,disabled:this.props.isDisabled},void 0)},t}(Av),zKe=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.updateParams=function(n){var i;r.plugin.managers.animation.updateParams((i={},i[n.name]=n.value,i))},r.updateCurrentParams=function(n){var i;r.plugin.managers.animation.updateCurrentParams((i={},i[n.name]=n.value,i))},r.startOrStop=function(){var n=r.plugin.managers.animation;n.state.animationState==="playing"?n.stop():(r.props.onStart&&r.props.onStart(),n.start())},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.managers.animation.events.updated,function(){return r.forceUpdate()})},t.prototype.render=function(){var r,n,i=this.plugin.managers.animation;if(i.isEmpty)return null;var a=i.state.animationState==="playing",o=(n=(r=i.current.anim).canApply)===null||n===void 0?void 0:n.call(r,this.plugin);return T.jsxs(T.Fragment,{children:[T.jsx(On,{params:i.getParams(),values:i.state.params,onChange:this.updateParams,isDisabled:a},void 0),T.jsx(On,{params:i.current.params,values:i.current.paramValues,onChange:this.updateCurrentParams,isDisabled:a},void 0),T.jsx("div",E({className:"msp-flex-row"},{children:T.jsx(hr,E({icon:i.state.animationState!=="playing"?void 0:PY,onClick:this.startOrStop,disabled:o!==void 0&&o.canApply===!1},{children:i.state.animationState==="playing"?"Stop":o===void 0||o.canApply?"Start":o.reason||"Start"}),void 0)}),void 0)]},void 0)},t}(pr),Ete="overpaint-controls";function Nz(e,t,r,n,i){return ce(this,void 0,void 0,function(){var a=this;return de(this,function(o){switch(o.label){case 0:return[4,VKe(e,t,function(s,u,l){return ce(a,void 0,void 0,function(){var c,d,f,h,v,v;return de(this,function(p){switch(p.label){case 0:return i&&i.length>0&&!i.includes(u.params.values.type.name)?[2]:(c=u.obj.data.sourceData,[4,n(c.root)]);case 1:return d=p.sent(),ar.isEmpty(d)?[2]:(f={bundle:Jr.fromLoci(d),color:r===-1?at(0):r,clear:r===-1},l?(h=Ft(Ft([],l.params.values.layers),[f]),v=Fz(h,c),s.to(l).update(Bi.toBundle(v))):(v=Fz([f],c),s.to(u.transform.ref).apply(rt.Representation.OverpaintStructureRepresentation3DFromBundle,Bi.toBundle(v),{tags:Ete})),[2])}})})})];case 1:return o.sent(),[2]}})})}function VKe(e,t,r){return ce(this,void 0,void 0,function(){var n,i,a,o,s,u,l,c,d;return de(this,function(f){switch(f.label){case 0:n=e.state.data,i=n.build(),a=0,o=t,f.label=1;case 1:if(!(a<o.length))return[3,6];s=o[a],u=0,l=s.representations,f.label=2;case 2:return u<l.length?(c=l[u],d=n.select(ir.Generators.ofTransformer(rt.Representation.OverpaintStructureRepresentation3DFromBundle,c.cell.transform.ref).withTag(Ete)),[4,r(i,c.cell,d[0])]):[3,5];case 3:f.sent(),f.label=4;case 4:return u++,[3,2];case 5:return a++,[3,1];case 6:return[2,i.commit({doNotUpdateCurrent:!0})]}})})}function Fz(e,t){var r=Bi.ofBundle(e,t.root),n=Bi.merge(r);return Bi.filter(n,t)}var Ate="clipping-controls";function HKe(e,t,r,n,i){return ce(this,void 0,void 0,function(){var a=this;return de(this,function(o){switch(o.label){case 0:return[4,GKe(e,t,function(s,u,l){return ce(a,void 0,void 0,function(){var c,d,f,h,v,v;return de(this,function(p){switch(p.label){case 0:return i&&i.length>0&&!i.includes(u.params.values.type.name)?[2]:(c=u.obj.data.sourceData,[4,n(c.root)]);case 1:return d=p.sent(),ar.isEmpty(d)?[2]:(f={bundle:Jr.fromLoci(d),groups:r},l?(h=Ft(Ft([],l.params.values.layers),[f]),v=Bz(h,c),s.to(l).update(rn.toBundle(v))):(v=Bz([f],c),s.to(u.transform.ref).apply(rt.Representation.ClippingStructureRepresentation3DFromBundle,rn.toBundle(v),{tags:Ate})),[2])}})})})];case 1:return o.sent(),[2]}})})}function GKe(e,t,r){return ce(this,void 0,void 0,function(){var n,i,a,o,s,u,l,c,d;return de(this,function(f){switch(f.label){case 0:n=e.state.data,i=n.build(),a=0,o=t,f.label=1;case 1:if(!(a<o.length))return[3,6];s=o[a],u=0,l=s.representations,f.label=2;case 2:return u<l.length?(c=l[u],d=n.select(ir.Generators.ofTransformer(rt.Representation.ClippingStructureRepresentation3DFromBundle,c.cell.transform.ref).withTag(Ate)),[4,r(i,c.cell,d[0])]):[3,5];case 3:f.sent(),f.label=4;case 4:return u++,[3,2];case 5:return a++,[3,1];case 6:return[2,i.commit({doNotUpdateCurrent:!0})]}})})}function Bz(e,t){var r=rn.ofBundle(e,t.root),n=rn.merge(r);return rn.filter(n,t)}var Pte="transparency-controls";function qKe(e,t,r,n,i){return ce(this,void 0,void 0,function(){var a=this;return de(this,function(o){switch(o.label){case 0:return[4,WKe(e,t,function(s,u,l){return ce(a,void 0,void 0,function(){var c,d,f,h,v,v;return de(this,function(p){switch(p.label){case 0:return i&&i.length>0&&!i.includes(u.params.values.type.name)?[2]:(c=u.obj.data.sourceData,[4,n(c.root)]);case 1:return d=p.sent(),ar.isEmpty(d)?[2]:(f={bundle:Jr.fromLoci(d),value:r},l?(h=Ft(Ft([],l.params.values.layers),[f]),v=Uz(h,c),s.to(l).update(Ui.toBundle(v))):(v=Uz([f],c),s.to(u.transform.ref).apply(rt.Representation.TransparencyStructureRepresentation3DFromBundle,Ui.toBundle(v),{tags:Pte})),[2])}})})})];case 1:return o.sent(),[2]}})})}function WKe(e,t,r){return ce(this,void 0,void 0,function(){var n,i,a,o,s,u,l,c,d;return de(this,function(f){switch(f.label){case 0:n=e.state.data,i=n.build(),a=0,o=t,f.label=1;case 1:if(!(a<o.length))return[3,6];s=o[a],u=0,l=s.representations,f.label=2;case 2:return u<l.length?(c=l[u],d=n.select(ir.Generators.ofTransformer(rt.Representation.TransparencyStructureRepresentation3DFromBundle,c.cell.transform.ref).withTag(Pte)),[4,r(i,c.cell,d[0])]):[3,5];case 3:f.sent(),f.label=4;case 4:return u++,[3,2];case 5:return a++,[3,1];case 6:return[2,i.commit({doNotUpdateCurrent:!0})]}})})}function Uz(e,t){var r=Ui.ofBundle(e,t.root),n=Ui.merge(r);return Ui.filter(n,t)}var rv=function(e){Le(t,e);function t(r){var n=e.call(this,{options:I.getDefaultValues(t.OptionsParams)})||this;return n.plugin=r,n.events={optionsUpdated:n.ev()},n}return Object.defineProperty(t.prototype,"currentStructures",{get:function(){return this.plugin.managers.structure.hierarchy.selection.structures},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"pivotStructure",{get:function(){return this.currentStructures[0]},enumerable:!1,configurable:!0}),t.prototype.setOptions=function(r){return ce(this,void 0,void 0,function(){var n,i,a,o,s,u,l,c,d=this;return de(this,function(f){for(n=r.interactions!==this.state.options.interactions,this.updateState({options:r}),this.events.optionsUpdated.next(),i=this.dataState.build(),a=0,o=this.currentStructures;a<o.length;a++)for(s=o[a],u=0,l=s.components;u<l.length;u++)c=l[u],this.updateReprParams(i,c);return[2,this.plugin.dataTransaction(function(){return ce(d,void 0,void 0,function(){return de(this,function(h){switch(h.label){case 0:return[4,i.commit()];case 1:return h.sent(),[4,this.plugin.state.updateBehavior(nL,function(v){v.ignoreHydrogens=!r.showHydrogens})];case 2:return h.sent(),n?[4,this.updateInterationProps()]:[3,4];case 3:h.sent(),h.label=4;case 4:return[2]}})})})]})})},t.prototype.updateReprParams=function(r,n){for(var i=this.state.options,a=i.showHydrogens,o=i.visualQuality,s=!a,u=0,l=n.representations;u<l.length;u++){var c=l[u];if(c.cell.transform.transformer===b_){var d=c.cell.transform.params;(!!d.type.params.ignoreHydrogens!==s||d.type.params.quality!==o)&&r.to(c.cell).update(function(f){f.type.params.ignoreHydrogens=s,f.type.params.quality=o})}}},t.prototype.updateInterationProps=function(){var r,n,i;return ce(this,void 0,void 0,function(){var a,o,s,u,l,c,d,f=this;return de(this,function(h){switch(h.label){case 0:a=0,o=this.currentStructures,h.label=1;case 1:return a<o.length?(s=o[a],u=Vn.getParams((r=s.cell.obj)===null||r===void 0?void 0:r.data),s.properties?(l=(n=s.properties.cell.transform.params)===null||n===void 0?void 0:n.properties[Vn.descriptor.name],I.areEqual(u,l,this.state.options.interactions)?[3,5]:[4,this.dataState.build().to(s.properties.cell).update(function(v){v.properties[Vn.descriptor.name]=f.state.options.interactions}).commit()]):[3,3]):[3,6];case 2:return h.sent(),[3,5];case 3:return c=this.plugin.customStructureProperties.getParams((i=s.cell.obj)===null||i===void 0?void 0:i.data),d=I.getDefaultValues(c),I.areEqual(u,d.properties[Vn.descriptor.name],this.state.options.interactions)?[3,5]:(d.properties[Vn.descriptor.name]=this.state.options.interactions,[4,this.plugin.builders.structure.insertStructureProperties(s.cell,d)]);case 4:h.sent(),h.label=5;case 5:return a++,[3,1];case 6:return[2]}})})},t.prototype.applyPreset=function(r,n,i){var a=this;return this.plugin.dataTransaction(function(){return ce(a,void 0,void 0,function(){var o,s,u,l;return de(this,function(c){switch(c.label){case 0:o=0,s=r,c.label=1;case 1:return o<s.length?(u=s[o],[4,this.plugin.builders.structure.representation.applyPreset(u.cell,n,i)]):[3,5];case 2:return l=c.sent(),[4,this.syncPreset(u,l)];case 3:c.sent(),c.label=4;case 4:return o++,[3,1];case 5:return[2]}})})},{canUndo:"Preset"})},t.prototype.syncPreset=function(r,n){if(!n||!n.components)return this.clearComponents([r]);var i=new Set;if(Iu(n.components,function(y){y&&i.add(y.ref)}),n.representations&&Iu(n.representations,function(y){y&&i.add(y.ref)}),i.size===0)return this.clearComponents([r]);for(var a=!1,o=this.dataState.build(),s=function(y){i.has(y.cell.transform.ref)||(a=!0,o.delete(y.cell))},u=0,l=r.components;u<l.length;u++){var c=l[u];s(c);for(var d=0,f=c.representations;d<f.length;d++){var h=f[d];s(h)}if(c.genericRepresentations)for(var v=0,p=c.genericRepresentations;v<p.length;v++){var h=p[v];s(h)}}if(r.genericRepresentations)for(var m=0,g=r.genericRepresentations;m<g.length;m++){var h=g[m];s(h)}if(a)return o.commit()},t.prototype.clear=function(r){return this.clearComponents(r)},t.prototype.selectThis=function(r){var n,i=this.plugin.managers.structure.selection;i.clear();for(var a=0,o=r;a<o.length;a++){var s=o[a],u=$e.toSubStructureElementLoci(s.structure.cell.obj.data,(n=s.cell.obj)===null||n===void 0?void 0:n.data);i.fromLoci("set",u)}},t.prototype.canBeModified=function(r){return this.plugin.builders.structure.isComponentTransform(r.cell)},t.prototype.modifyByCurrentSelection=function(r,n){var i=this;return this.plugin.runTask(We.create("Modify Component",function(a){return ce(i,void 0,void 0,function(){var o,s,u,l,c;return de(this,function(d){switch(d.label){case 0:for(o=this.dataState.build(),s=0,u=r;s<u.length;s++)l=u[s],this.canBeModified(l)&&(c=this.plugin.managers.structure.selection.getStructure(l.structure.cell.obj.data),!(!c||c.elementCount===0)&&this.modifyComponent(o,l,c,n));return[4,this.dataState.updateTree(o,{canUndo:"Modify Selection"}).runInContext(a)];case 1:return d.sent(),[2]}})})}))},t.prototype.toggleVisibility=function(r,n){if(r.length!==0)if(n)for(var u=r[0].representations.indexOf(n),i=!n.cell.state.isHidden,l=0,c=r;l<c.length;l++){var s=c[l],d=s.representations[u];d&&ev(this.dataState,d.cell.transform.ref,i)}else for(var i=!r[0].cell.state.isHidden,a=0,o=r;a<o.length;a++){var s=o[a];ev(this.dataState,s.cell.transform.ref,i)}},t.prototype.removeRepresentations=function(r,n){if(r.length!==0){var i=[];if(n){var a=r[0].representations.indexOf(n);if(a<0)return;for(var o=0,s=r;o<s.length;o++){var u=s[o];u.representations[a]&&i.push(u.representations[a])}}else for(var l=0,c=r;l<c.length;l++)for(var u=c[l],d=0,f=u.representations;d<f.length;d++){var h=f[d];i.push(h)}return this.plugin.managers.structure.hierarchy.remove(i,!0)}},t.prototype.updateRepresentations=function(r,n,i){if(r.length===0)return Promise.resolve();var a=r[0].representations.indexOf(n);if(a<0)return Promise.resolve();for(var o=this.dataState.build(),s=0,u=r;s<u.length;s++){var l=u[s],c=l.representations[a];c&&c.cell.transform.transformer===n.cell.transform.transformer&&o.to(c.cell).update(i)}return o.commit({canUndo:"Update Representation"})},t.prototype.updateRepresentationsTheme=function(r,n){var i,a,o,s;if(r.length!==0){for(var u=this.dataState.build(),l=0,c=r;l<c.length;l++)for(var d=c[l],f=function(g){var y=g.cell.transform.params,b=typeof n=="function"?n(d,g):n,S=b.color==="default"?K5(h.plugin,(i=d.structure.cell.obj)===null||i===void 0?void 0:i.data,y==null?void 0:y.type.name):b.color?K5(h.plugin,(a=d.structure.cell.obj)===null||a===void 0?void 0:a.data,y==null?void 0:y.type.name,b.color,b.colorParams):void 0,x=b.size==="default"?nz(h.plugin,(o=d.structure.cell.obj)===null||o===void 0?void 0:o.data,y==null?void 0:y.type.name):b.color?nz(h.plugin,(s=d.structure.cell.obj)===null||s===void 0?void 0:s.data,y==null?void 0:y.type.name,b.size,b.sizeParams):void 0;(S||x)&&u.to(g.cell).update(function(C){S&&(C.colorTheme=S),x&&(C.sizeTheme=x)})},h=this,v=0,p=d.representations;v<p.length;v++){var m=p[v];f(m)}return u.commit({canUndo:"Update Theme"})}},t.prototype.addRepresentation=function(r,n){var i=this;if(r.length!==0){var a=this.state.options,o=a.showHydrogens,s=a.visualQuality,u=!o,l={ignoreHydrogens:u,quality:s};return this.plugin.dataTransaction(function(){return ce(i,void 0,void 0,function(){var c,d,f;return de(this,function(h){switch(h.label){case 0:c=0,d=r,h.label=1;case 1:return c<d.length?(f=d[c],[4,this.plugin.builders.structure.representation.addRepresentation(f.cell,{type:this.plugin.representation.structure.registry.get(n),typeParams:l})]):[3,4];case 2:h.sent(),h.label=3;case 3:return c++,[3,1];case 4:return[2]}})})},{canUndo:"Add Representation"})}},t.prototype.tryFindComponent=function(r,n){var i=this;if(r.components.length!==0)return this.plugin.runTask(We.create("Find Component",function(a){return ce(i,void 0,void 0,function(){var o,s,u,l,c,d,f,h,v,p;return de(this,function(m){switch(m.label){case 0:return o=(v=r.cell.obj)===null||v===void 0?void 0:v.data,o?(l=(u=mt).unionStructure,[4,n.getSelection(this.plugin,a,o)]):[2];case 1:for(s=l.apply(u,[m.sent()]),c=0,d=r.components;c<d.length;c++)if(f=d[c],h=(p=f.cell.obj)===null||p===void 0?void 0:p.data,!(!h||!f.cell.parent)&&_De(s,h))return[2,f.cell];return[2]}})})}))},t.prototype.add=function(r,n){return ce(this,void 0,void 0,function(){var i=this;return de(this,function(a){return[2,this.plugin.dataTransaction(function(){return ce(i,void 0,void 0,function(){var o,s,u,l,c,d,f,h,v,p,m;return de(this,function(g){switch(g.label){case 0:if(o=n||this.currentStructures,o.length===0)return[2];s=this.state.options,u=s.showHydrogens,l=s.visualQuality,c=!u,d={ignoreHydrogens:c,quality:l},f=dn.create22(),h=0,v=o,g.label=1;case 1:return h<v.length?(p=v[h],m=void 0,r.options.checkExisting?[4,this.tryFindComponent(p,r.selection)]:[3,3]):[3,8];case 2:m=g.sent(),g.label=3;case 3:return m?[3,5]:[4,this.plugin.builders.structure.tryCreateComponentFromSelection(p.cell,r.selection,f,{label:r.options.label||(r.selection===di.current?"Custom Selection":"")})];case 4:m=g.sent(),g.label=5;case 5:return r.representation==="none"||!m?[3,7]:[4,this.plugin.builders.structure.representation.addRepresentation(m,{type:this.plugin.representation.structure.registry.get(r.representation),typeParams:d})];case 6:g.sent(),g.label=7;case 7:return h++,[3,1];case 8:return[2]}})})},{canUndo:"Add Selection"})]})})},t.prototype.applyTheme=function(r,n){return ce(this,void 0,void 0,function(){var i=this;return de(this,function(a){return[2,this.plugin.dataTransaction(function(o){return ce(i,void 0,void 0,function(){var s,u,l,c,d,f,f,f,h=this;return de(this,function(v){switch(v.label){case 0:if(s=n||this.currentStructures,s.length===0)return[2];u=function(p){return ce(h,void 0,void 0,function(){var m,g;return de(this,function(y){switch(y.label){case 0:return g=(m=mt).toLociWithSourceUnits,[4,r.selection.getSelection(this.plugin,o,p)];case 1:return[2,g.apply(m,[y.sent()])]}})})},l=0,c=s,v.label=1;case 1:return l<c.length?(d=c[l],r.action.name!=="reset"?[3,3]:[4,Nz(this.plugin,d.components,-1,u,r.representations)]):[3,10];case 2:return v.sent(),[3,9];case 3:return r.action.name!=="color"?[3,5]:(f=r.action.params,[4,Nz(this.plugin,d.components,f.color,u,r.representations)]);case 4:return v.sent(),[3,9];case 5:return r.action.name!=="transparency"?[3,7]:(f=r.action.params,[4,qKe(this.plugin,d.components,f.value,u,r.representations)]);case 6:return v.sent(),[3,9];case 7:return r.action.name!=="clipping"?[3,9]:(f=r.action.params,[4,HKe(this.plugin,d.components,rn.Groups.fromNames(f.excludeGroups),u,r.representations)]);case 8:v.sent(),v.label=9;case 9:return l++,[3,1];case 10:return[2]}})})},{canUndo:"Apply Theme"})]})})},t.prototype.modifyComponent=function(r,n,i,a){var o,s,u,l=(o=n.cell.obj)===null||o===void 0?void 0:o.data;if(l&&!((a==="subtract"||a==="intersect")&&!R3(l,i))){var c=(s=n.structure.cell.obj)===null||s===void 0?void 0:s.data,d=a==="union"?J1(c,[l,i]):a==="intersect"?iQ(l,i):yO(l,i);if(d.elementCount===0)r.delete(n.cell.transform.ref);else{var f=Jr.fromSubStructure(c,d),h={type:{name:"bundle",params:f},nullIfEmpty:!0,label:(u=n.cell.obj)===null||u===void 0?void 0:u.label};r.to(n.cell).update(h)}}},t.prototype.updateLabel=function(r,n){var i,a,o={type:(i=r.cell.params)===null||i===void 0?void 0:i.values.type,nullIfEmpty:(a=r.cell.params)===null||a===void 0?void 0:a.values.nullIfEmpty,label:n};this.dataState.build().to(r.cell).update(o).commit()},Object.defineProperty(t.prototype,"dataState",{get:function(){return this.plugin.state.data},enumerable:!1,configurable:!0}),t.prototype.clearComponents=function(r){for(var n=this.dataState.build(),i=0,a=r;i<a.length;i++)for(var o=a[i],s=0,u=o.components;s<u.length;s++){var l=u[s];n.delete(l.cell.transform.ref)}return n.commit({canUndo:"Clear Selections"})},t}(vd);(function(e){e.OptionsParams={showHydrogens:I.Boolean(!0,{description:"Toggle display of hydrogen atoms in representations"}),visualQuality:I.Select("auto",sO,{description:"Control the visual/rendering quality of representations"}),interactions:I.Group(Vn.defaultParams,{label:"Non-covalent Interactions"})};function t(a,o){var s=a.query.structure.registry.options;return o=E({pivot:a.managers.structure.component.pivotStructure,allowNone:!0,hideSelection:!1,checkExisting:!1},o),{selection:I.Select(s[1][0],s,{isHidden:o==null?void 0:o.hideSelection}),representation:i(a,o==null?void 0:o.pivot,o!=null&&o.allowNone?[["none","< Create Later >"]]:[]),options:I.Group({label:I.Text(""),checkExisting:I.Boolean(!!(o!=null&&o.checkExisting),{help:function(){return{description:"Checks if a selection with the specifield elements already exists to avoid creating duplicate components."}}})})}}e.getAddParams=t;function r(a,o){var s=a.query.structure.registry.options;return{selection:I.Select(s[1][0],s,{isHidden:!1}),action:I.MappedStatic("color",{color:I.Group({color:I.Color(dr.blue,{isExpanded:!0})},{isFlat:!0}),reset:I.EmptyGroup({label:"Reset Color"}),transparency:I.Group({value:I.Numeric(.5,{min:0,max:1,step:.01})},{isFlat:!0}),clipping:I.Group({excludeGroups:I.MultiSelect([],I.objectToOptions(rn.Groups.Names))},{isFlat:!0})}),representations:I.MultiSelect([],n(a,o),{emptyValue:"All"})}}e.getThemeParams=r;function n(a,o){var s,u;return!((s=o==null?void 0:o.cell.obj)===null||s===void 0)&&s.data?a.representation.structure.registry.getApplicableTypes((u=o.cell.obj)===null||u===void 0?void 0:u.data):a.representation.structure.registry.types}e.getRepresentationTypes=n;function i(a,o,s,u){var l=Ft(Ft([],s),n(a,o));return I.Select(l[0][0],l,{label:u})}})(rv||(rv={}));var Zy;(function(e){function t(a,o){return{key:a,data:o}}function r(a){return{entries:UM(),capacity:Math.max(1,a)}}e.create=r;function n(a,o){for(var s=a.entries.first;s;s=s.next)if(s.value.key===o)return a.entries.remove(s),a.entries.addLast(s.value),s.value.data}e.get=n;function i(a,o,s){var u=void 0;if(a.entries.count>=a.capacity){var l=a.entries.first;u=l.value.data,a.entries.remove(l)}return a.entries.addLast(t(o,s)),u}e.set=i})(Zy||(Zy={}));var Da=function(e){Le(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t}(ge.CreateBehavior({name:"Volume Streaming"}));(function(e){e.RootTag="volume-streaming-info";function t(o,s,u,l,c){var d,f,h,v;return c===void 0&&(c={}),I.Group({isoValue:Ct.createIsoValueParam((d=c.isoValue)!==null&&d!==void 0?d:u,l),color:I.Color((f=c.color)!==null&&f!==void 0?f:s),wireframe:I.Boolean((h=c.wireframe)!==null&&h!==void 0?h:!1),opacity:I.Numeric((v=c.opacity)!==null&&v!==void 0?v:.3,{min:0,max:1,step:.01})},{label:o,isExpanded:!0})}var r={byteOffset:0,rate:1,sampleCount:[1,1,1],valuesInfo:[{mean:0,min:-1,max:1,sigma:.1},{mean:0,min:-1,max:1,sigma:.1}]};function n(o){o===void 0&&(o={});var s=o.data,u=o.defaultView,l=o.channelParams,c=new Map;s&&s.entries.forEach(function(h){return c.set(h.dataId,h)});var d=s?s.entries.map(function(h){return[h.dataId,h.dataId]}):[],f=s?s.entries[0].dataId:"";return{entry:I.Mapped(f,d,function(h){return I.Group(i({entryData:c.get(h),defaultView:u,structure:s&&s.structure,channelParams:l}))})}}e.createParams=n;function i(o){var s=o.entryData,u=o.defaultView,l=o.structure,c=o.channelParams,d=c===void 0?{}:c,f=s||{kind:"em",header:{sampling:[r],availablePrecisions:[{precision:0,maxVoxels:0}]},emDefaultContourLevel:Ct.IsoValue.relative(0)},h=l&&l.boundary.box||Xt();return{view:I.MappedStatic(u||(f.kind==="em"?"cell":"selection-box"),{off:I.Group({}),box:I.Group({bottomLeft:I.Vec3(h.min),topRight:I.Vec3(h.max)},{description:"Static box defined by cartesian coords.",isFlat:!0}),"selection-box":I.Group({radius:I.Numeric(5,{min:0,max:50,step:.5},{description:"Radius in Å within which the volume is shown."}),bottomLeft:I.Vec3(_.create(0,0,0),{},{isHidden:!0}),topRight:I.Vec3(_.create(0,0,0),{},{isHidden:!0})},{description:"Box around focused element.",isFlat:!0}),cell:I.Group({}),auto:I.Group({radius:I.Numeric(5,{min:0,max:50,step:.5},{description:"Radius in Å within which the volume is shown."}),selectionDetailLevel:I.Select(Math.min(6,f.header.availablePrecisions.length-1),f.header.availablePrecisions.map(function(v,p){return[p,p+1+" [ "+(Math.pow(v.maxVoxels,1/3)|0)+"^3 cells ]"]}),{label:"Selection Detail",description:"Determines the maximum number of voxels. Depending on the size of the volume options are in the range from 0 (0.52M voxels) to 6 (25.17M voxels)."}),isSelection:I.Boolean(!1,{isHidden:!0}),bottomLeft:I.Vec3(h.min,{},{isHidden:!0}),topRight:I.Vec3(h.max,{},{isHidden:!0})},{description:"Box around focused element.",isFlat:!0})},{options:e.ViewTypeOptions,description:'Controls what of the volume is displayed. "Off" hides the volume alltogether. "Bounded box" shows the volume inside the given box. "Around Interaction" shows the volume around the focused element/atom. "Whole Structure" shows the volume for the whole structure.'}),detailLevel:I.Select(Math.min(3,f.header.availablePrecisions.length-1),f.header.availablePrecisions.map(function(v,p){return[p,p+1+" [ "+(Math.pow(v.maxVoxels,1/3)|0)+"^3 cells ]"]}),{description:"Determines the maximum number of voxels. Depending on the size of the volume options are in the range from 0 (0.52M voxels) to 6 (25.17M voxels)."}),channels:f.kind==="em"?I.Group({em:t("EM",at(6524815),f.emDefaultContourLevel||Ct.IsoValue.relative(1),f.header.sampling[0].valuesInfo[0],d.em)},{isFlat:!0}):I.Group({"2fo-fc":t("2Fo-Fc",at(3367602),Ct.IsoValue.relative(1.5),f.header.sampling[0].valuesInfo[0],d["2fo-fc"]),"fo-fc(+ve)":t("Fo-Fc(+ve)",at(3390259),Ct.IsoValue.relative(3),f.header.sampling[0].valuesInfo[1],d["fo-fc(+ve)"]),"fo-fc(-ve)":t("Fo-Fc(-ve)",at(12268339),Ct.IsoValue.relative(-3),f.header.sampling[0].valuesInfo[1],d["fo-fc(-ve)"])},{isFlat:!0})}}e.createEntryParams=i,e.ViewTypeOptions=[["off","Off"],["box","Bounded Box"],["selection-box","Around Focus"],["cell","Whole Structure"],["auto","Auto"]],e.ChannelTypeOptions=[["em","em"],["2fo-fc","2fo-fc"],["fo-fc(+ve)","fo-fc(+ve)"],["fo-fc(-ve)","fo-fc(-ve)"]];var a=function(o){Le(s,o);function s(u,l){var c=o.call(this,u,{})||this;return c.plugin=u,c.data=l,c.cache=Zy.create(25),c.params={},c.lastLoci=Or,c.ref="",c.channels={},c._invTransform=ue(),c.infoMap=new Map,c.data.entries.forEach(function(d){return c.infoMap.set(d.dataId,d)}),c}return Object.defineProperty(s.prototype,"info",{get:function(){return this.infoMap.get(this.params.entry.name)},enumerable:!1,configurable:!0}),s.prototype.queryData=function(u){return ce(this,void 0,void 0,function(){var l,c,d,f,h,v,p,m,g;return de(this,function(y){switch(y.label){case 0:return l=iE(this.data.serverUrl,this.info.kind+"/"+this.info.dataId.toLowerCase()),u?(c=u.min,d=u.max,l+="/box"+("/"+c.map(function(b){return Math.round(1e3*b)/1e3}).join(","))+("/"+d.map(function(b){return Math.round(1e3*b)/1e3}).join(","))):l+="/cell",f=this.params.entry.params.detailLevel,this.params.entry.params.view.name==="auto"&&this.params.entry.params.view.params.isSelection&&(f=this.params.entry.params.view.params.selectionDetailLevel),l+="?detail="+f,h=Zy.get(this.cache,l),h?[2,h.data]:(v=Cn.getUrlAsset(this.plugin.managers.asset,l),[4,this.plugin.runTask(this.plugin.managers.asset.resolve(v,"binary"))]);case 1:return p=y.sent(),[4,this.parseCif(p.data)];case 2:return m=y.sent(),m?(g=Zy.set(this.cache,l,{data:m,asset:p}),g&&g.asset.dispose(),[2,m]):[2]}})})},s.prototype.parseCif=function(u){return ce(this,void 0,void 0,function(){var l,c,d,f,h,v;return de(this,function(p){switch(p.label){case 0:return[4,this.plugin.runTask(Fc.parseBinary(u))];case 1:if(l=p.sent(),l.isError)return this.plugin.log.error("VolumeStreaming, parsing CIF: "+l.toString()),[2];if(l.result.blocks.length<2)return this.plugin.log.error("VolumeStreaming: Invalid data."),[2];c={},d=1,p.label=2;case 2:return d<l.result.blocks.length?(f=l.result.blocks[d],h=Fc.schema.densityServer(f),[4,this.plugin.runTask(EZ(h))]):[3,5];case 3:v=p.sent(),c[f.header]=v,p.label=4;case 4:return d++,[3,2];case 5:return[2,c]}})})},s.prototype.updateSelectionBoxParams=function(u){if(this.params.entry.params.view.name==="selection-box"){var l=this.plugin.state.data,c=E(E({},this.params),{entry:{name:this.params.entry.name,params:E(E({},this.params.entry.params),{view:{name:"selection-box",params:{radius:this.params.entry.params.view.params.radius,bottomLeft:u.min,topRight:u.max}}})}}),d=l.build().to(this.ref).update(c);_t.State.Update(this.plugin,{state:l,tree:d,options:{doNotUpdateCurrent:!0}})}},s.prototype.updateAutoParams=function(u,l){if(this.params.entry.params.view.name==="auto"){var c=this.plugin.state.data,d=E(E({},this.params),{entry:{name:this.params.entry.name,params:E(E({},this.params.entry.params),{view:{name:"auto",params:{radius:this.params.entry.params.view.params.radius,selectionDetailLevel:this.params.entry.params.view.params.selectionDetailLevel,isSelection:l,bottomLeft:(u==null?void 0:u.min)||_.zero(),topRight:(u==null?void 0:u.max)||_.zero()}}})}}),f=c.build().to(this.ref).update(d);_t.State.Update(this.plugin,{state:c,tree:f,options:{doNotUpdateCurrent:!0}})}},s.prototype.getStructureRoot=function(){return this.plugin.state.data.select(ir.Generators.byRef(this.ref).rootOfType(ge.Molecule.Structure))[0]},s.prototype.register=function(u){var l=this;this.ref=u,this.subscribeObservable(this.plugin.state.events.object.removed,function(c){!ge.Molecule.Structure.is(c.obj)||!De.is(l.lastLoci)||l.lastLoci.structure===c.obj.data&&(l.lastLoci=Or)}),this.subscribeObservable(this.plugin.state.events.object.updated,function(c){!ge.Molecule.Structure.is(c.oldObj)||!De.is(l.lastLoci)||l.lastLoci.structure===c.oldObj.data&&(l.lastLoci=Or)}),this.subscribeObservable(this.plugin.managers.structure.focus.behaviors.current,function(c){if(l.plugin.state.data.tree.children.has(l.ref)){var d=c?c.loci:Or;switch(l.params.entry.params.view.name){case"auto":l.updateAuto(d);break;case"selection-box":l.updateSelectionBox(d);break;default:l.lastLoci=d;break}}})},s.prototype.unregister=function(){for(var u=this.cache.entries.first;u;)u.value.data.asset.dispose(),u=u.next},s.prototype.getBoxFromLoci=function(u){var l,c,d;if(ar.isEmpty(u))return Xt();var f=this.plugin.helpers.substructureParent.get(u.structure,!0);if(!f)return Xt();var h=this.getStructureRoot();if(!h||((l=h.obj)===null||l===void 0?void 0:l.data)!==((c=f.obj)===null||c===void 0?void 0:c.data))return Xt();var v=xp.get((d=h.obj)===null||d===void 0?void 0:d.data.models[0]);v&&ue.invert(this._invTransform,v);var p=De.extendToWholeResidues(u),m=De.getBoundary(p,v&&!Number.isNaN(this._invTransform[0])?this._invTransform:void 0).box;return De.size(p)===1&&Xt.expand(m,m,_.create(1,1,1)),m},s.prototype.updateAuto=function(u){if(this.lastLoci=u,xu(u)){this.updateAutoParams(this.info.kind==="x-ray"?this.data.structure.boundary.box:void 0,!1);return}var l=this.getBoxFromLoci(u);this.updateAutoParams(l,!0)},s.prototype.updateSelectionBox=function(u){if(ar.areEqual(this.lastLoci,u)){this.lastLoci=Or,this.updateSelectionBoxParams(Xt());return}if(this.lastLoci=u,xu(u)){this.updateSelectionBoxParams(Xt());return}var l=this.getBoxFromLoci(u);this.updateSelectionBoxParams(l)},s.prototype.update=function(u){return ce(this,void 0,void 0,function(){var l,c,d,f,f,h,v,p;return de(this,function(m){switch(m.label){case 0:switch(l=u.entry.params.view.name==="selection-box"&&this.params&&this.params.entry&&this.params.entry.params&&this.params.entry.params.view&&this.params.entry.params.view.name!=="selection-box",this.params=u,c=void 0,d=!1,u.entry.params.view.name){case"off":d=!0;break;case"box":c=Xt.create(u.entry.params.view.params.bottomLeft,u.entry.params.view.params.topRight),d=Xt.volume(c)<1e-4;break;case"selection-box":{l?c=this.getBoxFromLoci(this.lastLoci)||Xt():c=Xt.create(_.clone(u.entry.params.view.params.bottomLeft),_.clone(u.entry.params.view.params.topRight)),f=u.entry.params.view.params.radius,d=Xt.volume(c)<1e-4,Xt.expand(c,c,_.create(f,f,f));break}case"cell":c=this.info.kind==="x-ray"?this.data.structure.boundary.box:void 0;break;case"auto":c=u.entry.params.view.params.isSelection||this.info.kind==="x-ray"?Xt.create(_.clone(u.entry.params.view.params.bottomLeft),_.clone(u.entry.params.view.params.topRight)):void 0,c&&(d=Xt.volume(c)<1e-4,u.entry.params.view.params.isSelection&&(f=u.entry.params.view.params.radius,Xt.expand(c,c,_.create(f,f,f))));break}return d?(v={},[3,3]):[3,1];case 1:return[4,this.queryData(c)];case 2:v=m.sent(),m.label=3;case 3:return h=v,h?(p=u.entry.params.channels,this.info.kind==="x-ray"?(this.channels["2fo-fc"]=this.createChannel(h["2FO-FC"]||Ct.One,p["2fo-fc"],this.info.header.sampling[0].valuesInfo[0]),this.channels["fo-fc(+ve)"]=this.createChannel(h["FO-FC"]||Ct.One,p["fo-fc(+ve)"],this.info.header.sampling[0].valuesInfo[1]),this.channels["fo-fc(-ve)"]=this.createChannel(h["FO-FC"]||Ct.One,p["fo-fc(-ve)"],this.info.header.sampling[0].valuesInfo[1])):this.channels.em=this.createChannel(h.EM||Ct.One,p.em,this.info.header.sampling[0].valuesInfo[0]),[2,!0]):[2,!1]}})})},s.prototype.createChannel=function(u,l,c){var d=l;return{data:u,color:d.color,wireframe:d.wireframe,opacity:d.opacity,isoValue:d.isoValue.kind==="relative"?d.isoValue:Ct.IsoValue.toRelative(d.isoValue,c)}},s.prototype.getDescription=function(){return this.params.entry.params.view.name==="selection-box"?"Selection":this.params.entry.params.view.name==="box"?"Static Box":this.params.entry.params.view.name==="cell"?"Cell":""},s}(Dr.WithSubscribers);e.Behavior=a})(Da||(Da={}));function $Ke(e,t){var r=iQe(e,t||dL());return uQe(e.tree,r),t&&t.refs.forEach(oQe,r),{hierarchy:r.hierarchy,added:r.added,changed:r.changed}}function dL(){return{trajectories:[],models:[],structures:[],refs:new Map}}function XKe(e){return{kind:"trajectory",cell:e,version:e.transform.version,models:[]}}function jz(e,t){return{kind:"model",cell:e,version:e.transform.version,trajectory:t,structures:[]}}function YKe(e,t){return{kind:"model-properties",cell:e,version:e.transform.version,model:t}}function KKe(e,t){return{kind:"model-unitcell",cell:e,version:e.transform.version,model:t}}function zz(e,t){return{kind:"structure",cell:e,version:e.transform.version,model:t,components:[]}}function QKe(e,t){return{kind:"structure-properties",cell:e,version:e.transform.version,structure:t}}function ZKe(e,t){return{kind:"structure-transform",cell:e,version:e.transform.version,structure:t}}function JKe(e,t){return{kind:"structure-volume-streaming",cell:e,version:e.transform.version,structure:t}}function eQe(e){return e.transform.tags?Ft([],e.transform.tags).sort().join():e.transform.ref}function tQe(e,t){return{kind:"structure-component",cell:e,version:e.transform.version,structure:t,key:eQe(e),representations:[]}}function rQe(e,t){return{kind:"structure-representation",cell:e,version:e.transform.version,component:t}}function nQe(e,t){return{kind:"generic-representation",cell:e,version:e.transform.version,parent:t}}function iQe(e,t){return{state:e,oldHierarchy:t,hierarchy:dL(),changed:!1,added:new Set}}function Qv(e,t,r,n){for(var i=[],a=4;a<arguments.length;a++)i[a-4]=arguments[a];var o=n.apply(void 0,i);r.push(o),e.hierarchy.refs.set(t.transform.ref,o);var s=e.oldHierarchy.refs.get(t.transform.ref);return s?s.version!==t.transform.version&&(e.changed=!0):(e.added.add(o.cell.transform.ref),e.changed=!0),o}function Th(e,t,r){for(var n=[],i=3;i<arguments.length;i++)n[i-3]=arguments[i];var a=r.apply(void 0,n);e.hierarchy.refs.set(t.transform.ref,a);var o=e.oldHierarchy.refs.get(t.transform.ref);return o?o.version!==t.transform.version&&(e.changed=!0):(e.added.add(a.cell.transform.ref),e.changed=!0),a}function Vz(e){return function(t){return e.is(t.obj)}}function Hz(e,t){return function(r,n){return!t(n)&&e.is(r.obj)}}function gx(e){return function(t){return t.transform.transformer===e}}function Ih(){}var aQe=[[Vz(ge.Molecule.Trajectory),function(e,t){e.currentTrajectory=Qv(e,t,e.hierarchy.trajectories,XKe,t)},function(e){return e.currentTrajectory=void 0}],[Hz(ge.Molecule.Model,function(e){return e.currentModel}),function(e,t){e.currentTrajectory?e.currentModel=Qv(e,t,e.currentTrajectory.models,jz,t,e.currentTrajectory):e.currentModel=Th(e,t,jz,t),e.hierarchy.models.push(e.currentModel)},function(e){return e.currentModel=void 0}],[gx(rt.Model.CustomModelProperties),function(e,t){if(!e.currentModel)return!1;e.currentModel.properties=Th(e,t,YKe,t,e.currentModel)},Ih],[gx(rt.Representation.ModelUnitcell3D),function(e,t){if(!e.currentModel)return!1;e.currentModel.unitcell=Th(e,t,KKe,t,e.currentModel)},Ih],[Hz(ge.Molecule.Structure,function(e){return e.currentStructure}),function(e,t){e.currentModel?e.currentStructure=Qv(e,t,e.currentModel.structures,zz,t,e.currentModel):e.currentStructure=Th(e,t,zz,t),e.hierarchy.structures.push(e.currentStructure)},function(e){return e.currentStructure=void 0}],[gx(rt.Model.CustomStructureProperties),function(e,t){if(!e.currentStructure)return!1;e.currentStructure.properties=Th(e,t,QKe,t,e.currentStructure)},Ih],[gx(rt.Model.TransformStructureConformation),function(e,t){if(!e.currentStructure)return!1;e.currentStructure.transform=Th(e,t,ZKe,t,e.currentStructure)},Ih],[Vz(Da),function(e,t){return e.currentStructure&&(e.currentStructure.volumeStreaming=Th(e,t,JKe,t,e.currentStructure)),!1},Ih],[function(e,t){return t.currentComponent||!t.currentStructure||e.transform.transformer.definition.isDecorator?!1:ge.Molecule.Structure.is(e.obj)},function(e,t){e.currentStructure&&(e.currentComponent=Qv(e,t,e.currentStructure.components,tQe,t,e.currentStructure))},function(e){return e.currentComponent=void 0}],[function(e,t){return!e.state.isGhost&&!!t.currentComponent&&ge.Molecule.Structure.Representation3D.is(e.obj)},function(e,t){return e.currentComponent&&Qv(e,t,e.currentComponent.representations,rQe,t,e.currentComponent),!1},Ih],[function(e){return!e.state.isGhost&&ge.isRepresentation3D(e.obj)},function(e,t){var r=e.currentComponent||e.currentStructure||e.currentModel;r&&(r.genericRepresentations||(r.genericRepresentations=[]),Qv(e,t,r.genericRepresentations,nQe,t,r))},Ih]];function Tte(e){if(!e||!(e!=null&&e.parent)||!e.parent.cells.has(e.transform.ref))return!1;var t=e.obj;return!(!t||t===In.Null||e.status!=="ok"&&e.status!=="error")}function oQe(e){var t=e.cell;Tte(t)||(this.changed=!0)}function sQe(e){Ite(this,this.tree.transforms.get(e))}function Ite(e,t){var r=e.state,n=r.state.cells.get(t.ref);if(Tte(n)){for(var i=void 0,a=!1,o=0,s=aQe;o<s.length;o++){var u=s[o],l=u[0],c=u[1],d=u[2];if(l(n,r)){var f=c(r,n);if(f===!1){a=!0;break}i=d;break}}if(!a){var h=e.tree.children.get(t.ref);h&&h.size&&h.forEach(sQe,e),i&&i(r)}}}function uQe(e,t){var r={tree:e,state:t};return Ite(r,e.root),r.state}var ab=function(e){Le(t,e);function t(r){var n=e.call(this)||this;return n.plugin=r,n.state={syncedTree:n.dataState.tree,notified:!1,hierarchy:dL(),selection:{trajectories:[],models:[],structures:[]}},n.behaviors={selection:n.ev.behavior({hierarchy:n.current,trajectories:n.selection.trajectories,models:n.selection.models,structures:n.selection.structures})},n._currentComponentGroups=void 0,n._currentSelectionSet=void 0,n.subscribe(r.state.data.events.changed,function(i){i.inTransaction||r.behaviors.state.isAnimating.value||n.sync(!0)}),n.subscribe(r.behaviors.state.isAnimating,function(i){!i&&!r.behaviors.state.isUpdating.value&&n.sync(!0)}),n}return Object.defineProperty(t.prototype,"dataState",{get:function(){return this.plugin.state.data},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"currentComponentGroups",{get:function(){return this._currentComponentGroups?this._currentComponentGroups:(this._currentComponentGroups=t.getComponentGroups(this.selection.structures),this._currentComponentGroups)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"seletionSet",{get:function(){if(this._currentSelectionSet)return this._currentSelectionSet;this._currentSelectionSet=new Set;for(var r=0,n=this.selection.trajectories;r<n.length;r++){var i=n[r];this._currentSelectionSet.add(i.cell.transform.ref)}for(var a=0,o=this.selection.models;a<o.length;a++){var i=o[a];this._currentSelectionSet.add(i.cell.transform.ref)}for(var s=0,u=this.selection.structures;s<u.length;s++){var i=u[s];this._currentSelectionSet.add(i.cell.transform.ref)}return this._currentSelectionSet},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"current",{get:function(){return this.sync(!1),this.state.hierarchy},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"selection",{get:function(){return this.sync(!1),this.state.selection},enumerable:!1,configurable:!0}),t.prototype.getStructuresWithSelection=function(){for(var r=this.plugin.managers.structure.hierarchy.current.structures,n=[],i=0,a=r;i<a.length;i++){var o=a[i];this.plugin.managers.structure.selection.structureHasSelection(o)&&n.push(o)}return n},t.prototype.syncCurrent=function(r,n){for(var i=this.seletionSet,a=[],o=0,s=r;o<s.length;o++){var u=s[o],l=u.cell.transform.ref;(i.has(l)||n.has(l))&&a.push(u)}return a.length===0?r.length>0?[r[0]]:[]:a},t.prototype.sync=function(r){if(!(!r&&this.dataState.inUpdate)){if(this.state.syncedTree===this.dataState.tree){r&&!this.state.notified&&(this.state.notified=!0,this.behaviors.selection.next(E({hierarchy:this.state.hierarchy},this.state.selection)));return}this.state.syncedTree=this.dataState.tree;var n=$Ke(this.plugin.state.data,this.current);if(n.changed){var i=n.hierarchy,a=this.syncCurrent(i.trajectories,n.added),o=this.syncCurrent(i.models,n.added),s=this.syncCurrent(i.structures,n.added);this._currentComponentGroups=void 0,this._currentSelectionSet=void 0,this.state.hierarchy=i,this.state.selection.trajectories=a,this.state.selection.models=o,this.state.selection.structures=s,r?(this.state.notified=!0,this.behaviors.selection.next({hierarchy:i,trajectories:a,models:o,structures:s})):this.state.notified=!1}}},t.prototype.updateCurrent=function(r,n){for(var i=this.current,a=n==="add"?li.union(this.seletionSet,new Set(r.map(function(y){return y.cell.transform.ref}))):li.difference(this.seletionSet,new Set(r.map(function(y){return y.cell.transform.ref}))),o=[],s=[],u=[],l=0,c=i.trajectories;l<c.length;l++){var d=c[l];a.has(d.cell.transform.ref)&&o.push(d)}for(var f=0,h=i.models;f<h.length;f++){var v=h[f];a.has(v.cell.transform.ref)&&s.push(v)}for(var p=0,m=i.structures;p<m.length;p++){var g=m[p];a.has(g.cell.transform.ref)&&u.push(g)}this._currentComponentGroups=void 0,this._currentSelectionSet=void 0,this.state.selection.trajectories=o,this.state.selection.models=s,this.state.selection.structures=u,this.behaviors.selection.next({hierarchy:i,trajectories:o,models:s,structures:u})},t.prototype.remove=function(r,n){if(r.length!==0){for(var i=this.plugin.state.data.build(),a=0,o=r;a<o.length;a++){var s=o[a];i.delete(typeof s=="string"?s:s.cell.transform.ref)}return i.commit({canUndo:n?"Remove":!1})}},t.prototype.toggleVisibility=function(r,n){if(r.length!==0)for(var i=n!==void 0?n!=="show":!r[0].cell.state.isHidden,a=0,o=r;a<o.length;a++){var s=o[a];ev(this.dataState,s.cell.transform.ref,i)}},t.prototype.applyPreset=function(r,n,i){var a=this;return this.plugin.dataTransaction(function(){return ce(a,void 0,void 0,function(){var o,s,u;return de(this,function(l){switch(l.label){case 0:o=0,s=r,l.label=1;case 1:return o<s.length?(u=s[o],u.models.length>0?[4,this.clearTrajectory(u)]:[3,3]):[3,6];case 2:l.sent(),l.label=3;case 3:return[4,this.plugin.builders.structure.hierarchy.applyPreset(u.cell,n,i)];case 4:l.sent(),l.label=5;case 5:return o++,[3,1];case 6:return[2]}})})})},t.prototype.updateStructure=function(r,n){return ce(this,void 0,void 0,function(){var i=this;return de(this,function(a){switch(a.label){case 0:return[4,this.plugin.dataTransaction(function(){return ce(i,void 0,void 0,function(){var o,s;return de(this,function(u){switch(u.label){case 0:return o=ii.getDecoratorRoot(this.dataState.tree,r.cell.transform.ref),s=this.dataState.tree.children.get(o).toArray(),[4,this.remove(s,!1)];case 1:return u.sent(),[4,this.plugin.state.updateTransform(this.plugin.state.data,r.cell.transform.ref,n,"Structure Type")];case 2:return u.sent(),[4,this.plugin.builders.structure.representation.applyPreset(r.cell.transform.ref,"auto")];case 3:return u.sent(),[2]}})})},{canUndo:"Structure Type"})];case 1:return a.sent(),_t.Camera.Reset(this.plugin),[2]}})})},t.prototype.clearTrajectory=function(r){for(var n=this.dataState.build(),i=0,a=r.models;i<a.length;i++){var o=a[i];n.delete(o.cell)}return n.commit()},t}(Bb);(function(e){function t(n){if(!n.length)return[];if(n.length===1)return n[0].components.map(function(v){return[v]});for(var i=[],a=new Map,o=0,s=n;o<s.length;o++)for(var u=s[o],l=0,c=u.components;l<c.length;l++){var d=c[l],f=d.key;if(f){var h=a.get(f);h||(h=[],a.set(f,h),i.push(h)),h.push(d)}}return i}e.getComponentGroups=t;function r(n){var i,a,o,s,u,l,c,d,f,h=n.managers.structure.hierarchy.selection.structures;if(h.length===0)return"";if(h.length===1){var v=h[0],p=(i=v.cell.obj)===null||i===void 0?void 0:i.data;if(!p)return((a=v.cell.obj)===null||a===void 0?void 0:a.label)||"Structure";var m=p.models[0]||p.representativeModel||p.masterModel;if(!m)return((o=v.cell.obj)===null||o===void 0?void 0:o.label)||"Structure";var g=m.entryId;return!((u=(s=v.model)===null||s===void 0?void 0:s.trajectory)===null||u===void 0)&&u.models&&v.model.trajectory.models.length===1?g:v.model?((l=v.model.cell.obj)===null||l===void 0?void 0:l.label)+" | "+g:g}for(var y=h[0],b=(c=y==null?void 0:y.model)===null||c===void 0?void 0:c.trajectory,S=!0,x=0,C=h;x<C.length;x++){var v=C[x];if(((d=v==null?void 0:v.model)===null||d===void 0?void 0:d.trajectory)!==b){S=!1;break}}return S&&b?((f=b.cell.obj)===null||f===void 0?void 0:f.label)+" | "+h.length+" structures":h.length+" structures"}e.getSelectedStructuresDescription=r})(ab||(ab={}));var nv=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.onChange=function(n){var i,a=n.name,o=n.value,s=E(E({},r.props.params),(i={},i[a]=o,i));r.props.events.onChange(s,r.areInitial(s),r.validate(s))},r}return t.prototype.validate=function(r){},t.prototype.areInitial=function(r){return I.areEqual(this.props.info.params,r,this.props.info.initialValues)},t.prototype.render=function(){return T.jsx(On,{params:this.props.info.params,values:this.props.params,onChange:this.onChange,onEnter:this.props.events.onEnter,isDisabled:this.props.isDisabled},void 0)},t}(Gi);(function(e){function t(i){for(var a=Object.keys(i),o=0,s=a;o<s.length;o++){var u=s[o];if(!i[u].isHidden)return!1}return!0}function r(i,a,o,s){var u=a.cells.get(s).obj,l=o.definition.params?o.definition.params(u,i):{},c=I.getDefaultValues(l);return{initialValues:c,params:l,isEmpty:t(l)}}e.infoFromAction=r;function n(i,a,o){var s=a.cells.get(o.ref),u=s.params&&s.params.definition||{},l=s.params&&s.params.values||{};return{initialValues:l,params:u,isEmpty:t(u)}}e.infoFromTransform=n})(nv||(nv={}));var Mte=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.busy=new Qn,r.onEnter=function(){r.state.error||r.apply()},r.autoApplyHandle=void 0,r.events={onEnter:r.onEnter,onChange:function(n,i,a){r.clearAutoApply(),r.setState({params:n,isInitial:i,error:a&&a[0]},function(){!i&&!r.state.error&&r.canAutoApply(n)&&(r.clearAutoApply(),r.autoApplyHandle=setTimeout(r.apply,50))})}},r.apply=function(){return ce(r,void 0,void 0,function(){var n,i;return de(this,function(a){switch(a.label){case 0:this.clearAutoApply(),this.setState({busy:!0}),a.label=1;case 1:return a.trys.push([1,3,4,5]),[4,this.applyAction()];case 2:return a.sent(),[3,5];case 3:return a.sent(),[3,5];case 4:return(i=(n=this.props).onApply)===null||i===void 0||i.call(n),this.busy.next(!1),[7];case 5:return[2]}})})},r.refresh=function(){r.setState({params:r.getInfo().initialValues,isInitial:!0,error:void 0})},r.setDefault=function(){var n=r.getInfo(),i=I.getDefaultValues(n.params);r.setState({params:i,isInitial:I.areEqual(n.params,i,n.initialValues),error:void 0})},r.toggleExpanded=function(){r.setState({isCollapsed:!r.state.isCollapsed})},r}return t.prototype.clearAutoApply=function(){this.autoApplyHandle!==void 0&&(clearTimeout(this.autoApplyHandle),this.autoApplyHandle=void 0)},t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.behaviors.state.isBusy,function(n){r.state.busy!==n&&r.busy.next(n)}),this.subscribe(this.busy,function(n){r.state.busy!==n&&r.setState({busy:n})})},t.prototype.renderApply=function(){var r=this.canApply();return this.props.autoHideApply&&(!r||this.canAutoApply(this.state.params))?null:T.jsxs("div",E({className:"msp-transform-apply-wrap"},{children:[T.jsx(Ht,{svg:EM,className:"msp-transform-default-params",onClick:this.setDefault,disabled:this.state.busy,title:"Set default params"},void 0),T.jsx("div",E({className:"msp-transform-apply-wider"},{children:T.jsx(hr,E({icon:r?qg:void 0,className:"msp-btn-commit msp-btn-commit-"+(r?"on":"off"),onClick:this.apply,disabled:!r},{children:this.props.applyLabel||this.applyText()}),void 0)}),void 0)]}),void 0)},t.prototype.renderDefault=function(){var r=this.getInfo(),n=r.isEmpty&&this.isUpdate(),i=this.getHeader(),a=this.getTransformerId(),o=this.plugin.customParamEditors.has(a)?this.plugin.customParamEditors.get(a):nv,s=this.state.isCollapsed?"msp-transform-wrapper msp-transform-wrapper-collapsed":"msp-transform-wrapper",u=null;if(!n&&!this.state.isCollapsed){var l=this.getSourceAndTarget(),c=l.a,d=l.b,f=l.bCell,h=this.renderApply();u=T.jsxs(T.Fragment,{children:[T.jsx(o,{info:r,a:c,b:d,bCell:f,events:this.events,params:this.state.params,isDisabled:this.state.busy},void 0),h]},void 0)}var v=T.jsxs("div",E({className:s,style:{marginBottom:this.props.noMargin?0:void 0}},{children:[i!=="none"&&!this.props.wrapInExpander&&T.jsx("div",E({className:"msp-transform-header"},{children:T.jsxs(hr,E({onClick:this.toggleExpanded,title:i.description},{children:[!n&&T.jsx(nn,{svg:this.state.isCollapsed?kc:Rc},void 0),i.name]}),void 0)}),void 0),u]}),void 0);return n||!this.props.wrapInExpander?v:T.jsx(Tu,E({header:this.isUpdate()?"Update "+(i==="none"?"":i.name):"Apply "+(i==="none"?"":i.name),headerLeftMargin:this.props.expanderHeaderLeftMargin},{children:v}),void 0)},t.prototype.renderSimple=function(){var r,n,i,a=this.getInfo(),o=this.canApply(),s=T.jsxs("div",E({className:"msp-flex-row"},{children:[T.jsx(hr,E({icon:(r=this.props.simpleApply)===null||r===void 0?void 0:r.icon,title:(n=this.props.simpleApply)===null||n===void 0?void 0:n.title,disabled:this.state.busy||!o,onClick:this.apply,className:"msp-btn-apply-simple"},{children:(i=this.props.simpleApply)===null||i===void 0?void 0:i.header}),void 0),!a.isEmpty&&T.jsx(Ai,{icon:zp,label:"",title:"Options",toggle:this.toggleExpanded,isSelected:!this.state.isCollapsed,disabled:this.state.busy,style:{flex:"0 0 40px",padding:0}},void 0)]}),void 0);if(this.state.isCollapsed)return s;var u=this.getTransformerId(),l=this.plugin.customParamEditors.has(u)?this.plugin.customParamEditors.get(u):nv,c=this.getSourceAndTarget(),d=c.a,f=c.b,h=c.bCell;return T.jsxs(T.Fragment,{children:[s,T.jsx(l,{info:a,a:d,b:f,bCell:h,events:this.events,params:this.state.params,isDisabled:this.state.busy},void 0)]},void 0)},t.prototype.render=function(){return this.props.simpleApply?this.renderSimple():this.renderDefault()},t}(Gi),Wc=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r._getInfo=Kf(function(n){return nv.infoFromTransform(r.plugin,r.props.state,n)}),r.state={error:void 0,isInitial:!0,params:r.getInfo().initialValues,busy:!1,isCollapsed:r.props.initiallyCollapsed},r}return t.prototype.applyAction=function(){return this.props.customUpdate?this.props.customUpdate(this.state.params):this.plugin.state.updateTransform(this.props.state,this.props.transform.ref,this.state.params)},t.prototype.getInfo=function(){return this._getInfo(this.props.transform)},t.prototype.getTransformerId=function(){return this.props.transform.transformer.id},t.prototype.getHeader=function(){return this.props.customHeader||this.props.transform.transformer.definition.display},t.prototype.canApply=function(){var r=this.props.state,n=r.cells.get(this.props.transform.ref);if(!n)return!1;if(n.status==="error"){var i=r.cells.get(this.props.transform.parent);return i?i.status==="ok":!1}return!this.state.error&&!this.state.busy&&!this.state.isInitial},t.prototype.applyText=function(){return this.canApply()?"Update":"Nothing to Update"},t.prototype.isUpdate=function(){return!0},t.prototype.getSourceAndTarget=function(){var r=this.props.state.cells.get(this.props.transform.ref);return{a:this.props.state.cells.get(this.props.transform.parent).obj,b:r==null?void 0:r.obj,bCell:r}},t.prototype.canAutoApply=function(r){var n=this.props.transform.transformer.definition.canAutoUpdate;if(!n)return!1;var i=this.props.state,a=i.cells.get(this.props.transform.ref);if(!a||!a.sourceRef||a.status!=="ok")return!1;var o=i.cells.get(a.sourceRef);return n({a:o.obj,b:a.obj,oldParams:this.getInfo().initialValues,newParams:r},this.plugin)},t.prototype.componentDidMount=function(){var r=this;e.prototype.componentDidMount.call(this),this.props.toggleCollapsed&&this.subscribe(this.props.toggleCollapsed,function(){return r.setState({isCollapsed:!r.state.isCollapsed})}),this.subscribe(this.plugin.state.events.object.updated,function(n){var i=n.ref,a=n.state;r.props.transform.ref!==i||r.props.state!==a||r.state.params!==r.props.transform.params&&(r._getInfo=Kf(function(o){return nv.infoFromTransform(r.plugin,r.props.state,o)}),r.setState({params:r.props.transform.params,isInitial:!0}))})},t.prototype.componentDidUpdate=function(r){var n;if(this.props.transform!==r.transform){var i=this.props.state.cells.get(this.props.transform.ref);this.setState({params:((n=i.params)===null||n===void 0?void 0:n.values)||{},isInitial:!0,error:void 0,simpleOnly:this.state.simpleOnly})}},t}(Mte);(function(e){Le(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.state.events.object.updated,function(n){var i=n.ref,a=n.state;r.props.nodeRef!==i||r.plugin.state.data!==a||r.forceUpdate()})},t.prototype.render=function(){var r=this.plugin.state.data,n=this.props.nodeRef,i=r.cells.get(n);if(!i||i.status!=="ok"&&i.status!=="error")return null;var a=i.transform;return T.jsx(Wc,{state:r,transform:a,initiallyCollapsed:this.props.initiallyCollapsed,customHeader:this.props.header},void 0)},t})(pr);var lQe=function(e){Le(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return Object.defineProperty(t.prototype,"current",{get:function(){return this.plugin.managers.structure.hierarchy.behaviors.selection},enumerable:!1,configurable:!0}),t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.current,function(){return r.forceUpdate()})},Object.defineProperty(t.prototype,"unitcell",{get:function(){var r,n=this.plugin.managers.structure.hierarchy.selection;if(n.structures.length===0)return null;for(var i=[],a=0,o=n.structures;a<o.length;a++){var s=o[a],u=s.model;u!=null&&u.unitcell&&(!((r=u.unitcell)===null||r===void 0)&&r.cell.obj)&&i.push(u.unitcell)}return i.length===0?null:T.jsx(Gz,{refs:i,labelMultiple:"Unit Cells"},void 0)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"customControls",{get:function(){var r=this,n=[];return this.plugin.genericRepresentationControls.forEach(function(i,a){var o=i(r.plugin.managers.structure.hierarchy.selection),s=o[0],u=o[1];s.length>0&&n.push(T.jsx("div",{children:T.jsx(Gz,{refs:s,labelMultiple:u},void 0)},a))}),n.length>0?n:null},enumerable:!1,configurable:!0}),t.prototype.render=function(){return T.jsx(T.Fragment,{children:T.jsxs("div",E({style:{marginTop:"6px"}},{children:[this.unitcell,this.customControls]}),void 0)},void 0)},t}(Gi),Gz=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={showOptions:!1},r.toggleVisibility=function(n){n.preventDefault(),r.plugin.managers.structure.hierarchy.toggleVisibility(r.props.refs),n.currentTarget.blur()},r.highlight=function(n){n.preventDefault(),r.pivot.cell.parent&&_t.Interactivity.Object.Highlight(r.plugin,{state:r.pivot.cell.parent,ref:r.props.refs.map(function(i){return i.cell.transform.ref})})},r.clearHighlight=function(n){n.preventDefault(),_t.Interactivity.ClearHighlights(r.plugin)},r.focus=function(n){var i;n.preventDefault();for(var a=!0,o=0,s=r.props.refs;o<s.length;o++){var u=s[o];if(!u.cell.state.isHidden){a=!1;break}}a&&r.plugin.managers.structure.hierarchy.toggleVisibility(r.props.refs,"show");for(var l=[],c=0,d=r.props.refs;c<d.length;c++){var u=d[c];if(!u.cell.state.isHidden){var f=(i=u.cell.obj)===null||i===void 0?void 0:i.data.repr.getLoci();f&&l.push(f)}}r.plugin.managers.camera.focusLoci(l)},r.toggleOptions=function(){return r.setState({showOptions:!r.state.showOptions})},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.state.events.cell.stateUpdated,function(n){var i;Wf.ObjectEvent.isCell(n,(i=r.pivot)===null||i===void 0?void 0:i.cell)&&r.forceUpdate()})},Object.defineProperty(t.prototype,"pivot",{get:function(){return this.props.refs[0]},enumerable:!1,configurable:!0}),t.prototype.render=function(){var r=this.props,n=r.refs,i=r.labelMultiple;if(n.length===0)return null;var a=n[0],o,s;if(n.length===1){var u=a.cell.obj;if(!u)return null;o=u==null?void 0:u.label,s=u==null?void 0:u.description}else o=n.length+" "+(i||"Objects");return T.jsxs(T.Fragment,{children:[T.jsxs("div",E({className:"msp-flex-row"},{children:[T.jsxs("button",E({className:"msp-form-control msp-control-button-label",title:o+". Click to focus.",onClick:this.focus,onMouseEnter:this.highlight,onMouseLeave:this.clearHighlight,style:{textAlign:"left"}},{children:[o," ",T.jsx("small",{children:s},void 0)]}),void 0),T.jsx(Ht,{svg:a.cell.state.isHidden?fv:hv,toggleState:!1,className:"msp-form-control",onClick:this.toggleVisibility,title:a.cell.state.isHidden?"Show":"Hide",small:!0,flex:!0},void 0),n.length===1&&T.jsx(Ht,{svg:jp,className:"msp-form-control",onClick:this.toggleOptions,title:"Options",toggleState:this.state.showOptions,flex:!0},void 0)]}),void 0),n.length===1&&this.state.showOptions&&a.cell.parent&&T.jsx(T.Fragment,{children:T.jsx("div",E({className:"msp-control-offset"},{children:T.jsx(Wc,{state:a.cell.parent,transform:a.cell.transform,customHeader:"none",autoHideApply:!0},void 0)}),void 0)},void 0)]},void 0)},t}(Gi),cQe=function(e){Le(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.defaultState=function(){return{header:"Components",isCollapsed:!1,isDisabled:!1,brand:{accent:"blue",svg:SM}}},t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.managers.structure.hierarchy.behaviors.selection,function(n){return r.setState({description:ab.getSelectedStructuresDescription(r.plugin)})})},t.prototype.renderControls=function(){return T.jsxs(T.Fragment,{children:[T.jsx(dQe,{},void 0),T.jsx(hQe,{},void 0),T.jsx(lQe,{},void 0)]},void 0)},t}(Wg),dQe=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isEmpty:!0,isBusy:!1,canUndo:!1},r.togglePreset=r.toggleAction("preset"),r.toggleAdd=r.toggleAction("add"),r.toggleOptions=r.toggleAction("options"),r.hideAction=function(){return r.setState({action:void 0})},r.applyPreset=function(n){if(r.hideAction(),!!n){var i=r.plugin.managers.structure,a=i.hierarchy.selection.structures;n.value===null?i.component.clear(a):i.component.applyPreset(a,n.value)}},r.undo=function(){var n=r.plugin.state.data.undo();n&&r.plugin.runTask(n)},r}return Object.defineProperty(t.prototype,"isDisabled",{get:function(){return this.state.isBusy||this.state.isEmpty},enumerable:!1,configurable:!0}),t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.managers.structure.hierarchy.behaviors.selection,function(n){return r.setState({action:r.state.action!=="options"||n.structures.length===0?void 0:"options",isEmpty:n.structures.length===0})}),this.subscribe(this.plugin.behaviors.state.isBusy,function(n){r.setState({isBusy:n,action:r.state.action!=="options"?void 0:"options"})}),this.subscribe(this.plugin.state.data.events.historyUpdated,function(n){var i=n.state;r.setState({canUndo:i.canUndo})})},t.prototype.toggleAction=function(r){var n=this;return function(){return n.setState({action:n.state.action===r?void 0:r})}},Object.defineProperty(t.prototype,"presetControls",{get:function(){return T.jsx(er,{items:this.presetActions,onSelect:this.applyPreset},void 0)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"presetActions",{get:function(){var r=this.plugin.managers.structure.component.pivotStructure,n=this.plugin.builders.structure.representation.getPresets(r==null?void 0:r.cell.obj);return er.createItems(n,{label:function(i){return i.display.name},category:function(i){return i.display.group},description:function(i){return i.display.description}})},enumerable:!1,configurable:!0}),t.prototype.render=function(){var r=this.state.canUndo?"Undo "+this.plugin.state.data.latestUndoLabel:"Some mistakes of the past can be undone.";return T.jsxs(T.Fragment,{children:[T.jsxs("div",E({className:"msp-flex-row"},{children:[T.jsx(Ai,{icon:p3,label:"Preset",title:"Apply a representation preset for the current structure(s).",toggle:this.togglePreset,isSelected:this.state.action==="preset",disabled:this.isDisabled},void 0),T.jsx(Ai,{icon:Gg,label:"Add",title:"Add a new representation component for a selection.",toggle:this.toggleAdd,isSelected:this.state.action==="add",disabled:this.isDisabled},void 0),T.jsx(Ai,{icon:zp,label:"",title:"Options that are applied to all applicable representations.",style:{flex:"0 0 40px",padding:0},toggle:this.toggleOptions,isSelected:this.state.action==="options",disabled:this.isDisabled},void 0),T.jsx(Ht,{svg:PM,className:"msp-flex-item",flex:"40px",onClick:this.undo,disabled:!this.state.canUndo||this.isDisabled,title:r},void 0)]}),void 0),this.state.action==="preset"&&this.presetControls,this.state.action==="add"&&T.jsx("div",E({className:"msp-control-offset"},{children:T.jsx(Dte,{onApply:this.hideAction},void 0)}),void 0),this.state.action==="options"&&T.jsx("div",E({className:"msp-control-offset"},{children:T.jsx(fQe,{isDisabled:this.isDisabled},void 0)}),void 0)]},void 0)},t}(Gi),Dte=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state=r.createState(),r.apply=function(){var n=r.props.forSelection?r.currentStructures:r.selectedStructures;r.props.onApply(),r.plugin.managers.structure.component.add(r.state.values,n)},r.paramsChanged=function(n){return r.setState({values:n})},r}return t.prototype.createState=function(){var r=rv.getAddParams(this.plugin);return{params:r,values:I.getDefaultValues(r)}},Object.defineProperty(t.prototype,"selectedStructures",{get:function(){return this.plugin.managers.structure.component.currentStructures},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"currentStructures",{get:function(){return this.plugin.managers.structure.hierarchy.current.structures},enumerable:!1,configurable:!0}),t.prototype.render=function(){return T.jsxs(T.Fragment,{children:[T.jsx(On,{params:this.state.params,values:this.state.values,onChangeValues:this.paramsChanged},void 0),T.jsx(hr,E({icon:Gg,title:"Use Selection and optional Representation to create a new Component.",className:"msp-btn-commit msp-btn-commit-on",onClick:this.apply,style:{marginTop:"1px"}},{children:"Create Component"}),void 0)]},void 0)},t}(Gi),fQe=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.update=function(n){return r.plugin.managers.structure.component.setOptions(n)},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.managers.structure.component.events.optionsUpdated,function(){return r.forceUpdate()})},t.prototype.render=function(){return T.jsx(On,{params:rv.OptionsParams,values:this.plugin.managers.structure.component.state.options,onChangeValues:this.update,isDisabled:this.props.isDisabled},void 0)},t}(Gi),hQe=function(e){Le(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.managers.structure.hierarchy.behaviors.selection,function(){r.forceUpdate()})},t.prototype.render=function(){var r=this.plugin.managers.structure.hierarchy.currentComponentGroups;return r.length===0?null:T.jsx("div",E({style:{marginTop:"6px"}},{children:r.map(function(n){return T.jsx(pQe,{group:n},n[0].cell.transform.ref)})}),void 0)},t}(Gi),pQe=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={action:void 0},r.toggleVisible=function(n){n.preventDefault(),n.currentTarget.blur(),r.plugin.managers.structure.component.toggleVisibility(r.props.group)},r.selectAction=function(n){n&&(r.setState({action:void 0}),(n==null?void 0:n.value)())},r.remove=function(){return r.plugin.managers.structure.hierarchy.remove(r.props.group,!0)},r.toggleAction=function(){return r.setState({action:r.state.action==="action"?void 0:"action"})},r.toggleLabel=function(){return r.setState({action:r.state.action==="label"?void 0:"label"})},r.highlight=function(n){n.preventDefault(),r.props.group[0].cell.parent&&_t.Interactivity.Object.Highlight(r.plugin,{state:r.props.group[0].cell.parent,ref:r.props.group.map(function(i){return i.cell.transform.ref})})},r.clearHighlight=function(n){n.preventDefault(),_t.Interactivity.ClearHighlights(r.plugin)},r.focus=function(){for(var n=!0,i=0,a=r.props.group;i<a.length;i++){var o=a[i];if(!o.cell.state.isHidden){n=!1;break}}n&&r.plugin.managers.structure.hierarchy.toggleVisibility(r.props.group,"show"),r.plugin.managers.camera.focusSpheres(r.props.group,function(s){var u;if(!s.cell.state.isHidden)return(u=s.cell.obj)===null||u===void 0?void 0:u.data.boundary.sphere})},r.updateLabel=function(n){r.plugin.managers.structure.component.updateLabel(r.pivot,n)},r}return Object.defineProperty(t.prototype,"pivot",{get:function(){return this.props.group[0]},enumerable:!1,configurable:!0}),t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.state.events.cell.stateUpdated,function(n){Wf.ObjectEvent.isCell(n,r.pivot.cell)&&r.forceUpdate()})},Object.defineProperty(t.prototype,"colorByActions",{get:function(){var r=this,n,i,a=this.plugin.managers.structure.component,o=this.pivot.representations[0],s=(n=o.cell.transform.params)===null||n===void 0?void 0:n.colorTheme.name,u=LWe(this.plugin,(i=this.pivot.cell.obj)===null||i===void 0?void 0:i.data);return er.createItemsFromSelectOptions(u,{value:function(l){return function(){return a.updateRepresentationsTheme(r.props.group,{color:l[0]})}},selected:function(l){return l[0]===s}})},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"actions",{get:function(){var r=this,n=this.plugin.managers.structure.component,i=[Ft([er.Header("Add Representation")],rv.getRepresentationTypes(this.plugin,this.props.group[0]).map(function(a){return er.Item(a[1],function(){return n.addRepresentation(r.props.group,a[0])})}))];return this.pivot.representations.length>0&&i.push(Ft([er.Header("Set Coloring",{isIndependent:!0})],this.colorByActions)),n.canBeModified(this.props.group[0])&&i.push([er.Header("Modify by Selection"),er.Item("Include",function(){return n.modifyByCurrentSelection(r.props.group,"union")},{icon:yM}),er.Item("Subtract",function(){return n.modifyByCurrentSelection(r.props.group,"subtract")},{icon:bM}),er.Item("Intersect",function(){return n.modifyByCurrentSelection(r.props.group,"intersect")},{icon:xM})]),i.push(er.Item("Select This",function(){return n.selectThis(r.props.group)},{icon:jC})),n.canBeModified(this.props.group[0])&&i.push(er.Item("Edit Label",this.toggleLabel)),i},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"reprLabel",{get:function(){var r,n=this.pivot;return n.representations.length===0?"No repr.":n.representations.length===1?(r=n.representations[0].cell.obj)===null||r===void 0?void 0:r.label:n.representations.length+" reprs"},enumerable:!1,configurable:!0}),t.prototype.render=function(){var r=this,n,i=this.pivot,a=i.cell,o=(n=a.obj)===null||n===void 0?void 0:n.label,s=this.reprLabel;return T.jsxs(T.Fragment,{children:[T.jsxs("div",E({className:"msp-flex-row"},{children:[T.jsxs(hr,E({noOverflow:!0,className:"msp-control-button-label",title:o+". Click to focus.",onClick:this.focus,onMouseEnter:this.highlight,onMouseLeave:this.clearHighlight,style:{textAlign:"left"}},{children:[o,T.jsx("small",E({className:"msp-25-lower-contrast-text",style:{float:"right"}},{children:s}),void 0)]}),void 0),T.jsx(Ht,{svg:a.state.isHidden?fv:hv,toggleState:!1,onClick:this.toggleVisible,title:(a.state.isHidden?"Show":"Hide")+" component",small:!0,className:"msp-form-control",flex:!0},void 0),T.jsx(Ht,{svg:Vs,toggleState:!1,onClick:this.remove,title:"Remove",small:!0,className:"msp-form-control",flex:!0},void 0),T.jsx(Ht,{svg:jp,onClick:this.toggleAction,title:"Actions",toggleState:this.state.action==="action",className:"msp-form-control",flex:!0},void 0)]}),void 0),this.state.action==="label"&&T.jsx("div",E({className:"msp-control-offset",style:{marginBottom:"6px"}},{children:T.jsx(Ns,{label:"Label",control:T.jsxs("div",E({style:{display:"flex",textAlignLast:"center"}},{children:[T.jsx(yc,{onChange:this.updateLabel,value:o,style:{flex:"1 1 auto",minWidth:0},className:"msp-form-control",blurOnEnter:!0,blurOnEscape:!0},void 0),T.jsx(Ht,{svg:qg,onClick:this.toggleLabel,className:"msp-form-control msp-control-button-label",flex:!0},void 0)]}),void 0)},void 0)}),void 0),this.state.action==="action"&&T.jsxs("div",E({className:"msp-accent-offset"},{children:[T.jsx("div",E({style:{marginBottom:"6px"}},{children:T.jsx(er,{items:this.actions,onSelect:this.selectAction,noOffset:!0},void 0)}),void 0),T.jsx("div",E({style:{marginBottom:"6px"}},{children:i.representations.map(function(u){return T.jsx(vQe,{group:r.props.group,representation:u},u.cell.transform.ref)})}),void 0)]}),void 0)]},void 0)},t}(Gi),vQe=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.remove=function(){return r.plugin.managers.structure.component.removeRepresentations(r.props.group,r.props.representation)},r.toggleVisible=function(n){n.preventDefault(),n.currentTarget.blur(),r.plugin.managers.structure.component.toggleVisibility(r.props.group,r.props.representation)},r.update=function(n){return r.plugin.managers.structure.component.updateRepresentations(r.props.group,r.props.representation,n)},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.state.events.cell.stateUpdated,function(n){Wf.ObjectEvent.isCell(n,r.props.representation.cell)&&r.forceUpdate()})},t.prototype.render=function(){var r,n=this.props.representation.cell;return T.jsxs("div",E({className:"msp-representation-entry"},{children:[n.parent&&T.jsx(Tu,E({header:(((r=n.obj)===null||r===void 0?void 0:r.label)||"")+" Representation",noOffset:!0},{children:T.jsx(Wc,{state:n.parent,transform:n.transform,customHeader:"none",customUpdate:this.update,noMargin:!0},void 0)}),void 0),T.jsx(Ht,{svg:Vs,onClick:this.remove,title:"Remove",small:!0,className:"msp-default-bg",toggleState:!1,style:{position:"absolute",top:0,right:"32px",lineHeight:"24px",height:"24px",textAlign:"right",width:"44px",paddingRight:"6px",background:"none"}},void 0),T.jsx(Ht,{svg:this.props.representation.cell.state.isHidden?fv:hv,toggleState:!1,onClick:this.toggleVisible,title:"Toggle Visibility",small:!0,className:"msp-default-bg",style:{position:"absolute",top:0,right:0,lineHeight:"24px",height:"24px",textAlign:"right",width:"32px",paddingRight:"6px",background:"none"}},void 0)]}),void 0)},t}(Gi),AT="measurement-group",Rte={distanceUnitLabel:I.Text("Å",{isEssential:!0}),textColor:MJ.textColor},mQe=I.getDefaultValues(Rte),gQe=function(e){Le(t,e);function t(r){var n=e.call(this,{labels:[],distances:[],angles:[],dihedrals:[],orientations:[],options:mQe})||this;return n.plugin=r,n.behaviors={state:n.ev.behavior(n.state)},n._empty=[],r.state.data.events.changed.subscribe(function(i){i.inTransaction||r.behaviors.state.isAnimating.value||n.sync()}),r.behaviors.state.isAnimating.subscribe(function(i){!i&&!r.behaviors.state.isUpdating.value&&n.sync()}),n}return t.prototype.stateUpdated=function(){this.behaviors.state.next(this.state)},t.prototype.getGroup=function(){var r=this.plugin.state.data,n=ir.findTagInSubtree(r.tree,cr.RootRef,AT),i=this.plugin.state.data.build();return n?i.to(n):i.toRoot().group(rt.Misc.CreateGroup,{label:"Measurements"},{tags:AT})},t.prototype.setOptions=function(r){return ce(this,void 0,void 0,function(){var n,i,a,f,o,s,f,u,l,f,c,d,f;return de(this,function(h){switch(h.label){case 0:for(this.updateState({options:r})&&this.stateUpdated(),n=this.plugin.state.data.build(),i=0,a=this.state.distances;i<a.length;i++)f=a[i],n.to(f).update(function(v){v.unitLabel=r.distanceUnitLabel,v.textColor=r.textColor});for(o=0,s=this.state.labels;o<s.length;o++)f=s[o],n.to(f).update(function(v){v.textColor=r.textColor});for(u=0,l=this.state.angles;u<l.length;u++)f=l[u],n.to(f).update(function(v){v.textColor=r.textColor});for(c=0,d=this.state.dihedrals;c<d.length;c++)f=d[c],n.to(f).update(function(v){v.textColor=r.textColor});return n.editInfo.count===0?[2]:[4,_t.State.Update(this.plugin,{state:this.plugin.state.data,tree:n,options:{doNotLogTiming:!0}})];case 1:return h.sent(),[2]}})})},t.prototype.addDistance=function(r,n,i){return ce(this,void 0,void 0,function(){var a,o,s,u,l;return de(this,function(c){switch(c.label){case 0:return a=this.plugin.helpers.substructureParent.get(r.structure),o=this.plugin.helpers.substructureParent.get(n.structure),!a||!o?[2]:(s=[a.transform.ref],Pa(s,o.transform.ref),u=this.getGroup(),u.apply(rt.Model.MultiStructureSelectionFromExpression,{selections:[{key:"a",groupId:"a",ref:a.transform.ref,expression:De.toExpression(r)},{key:"b",groupId:"b",ref:o.transform.ref,expression:De.toExpression(n)}],isTransitive:!0,label:"Distance"},{dependsOn:s,tags:i==null?void 0:i.selectionTags}).apply(rt.Representation.StructureSelectionsDistance3D,E(E(E({customText:(i==null?void 0:i.customText)||"",unitLabel:this.state.options.distanceUnitLabel,textColor:this.state.options.textColor},i==null?void 0:i.lineParams),i==null?void 0:i.labelParams),i==null?void 0:i.visualParams),{tags:i==null?void 0:i.reprTags}),l=this.plugin.state.data,[4,_t.State.Update(this.plugin,{state:l,tree:u,options:{doNotLogTiming:!0}})]);case 1:return c.sent(),[2]}})})},t.prototype.addAngle=function(r,n,i,a){return ce(this,void 0,void 0,function(){var o,s,u,l,c,d;return de(this,function(f){switch(f.label){case 0:return o=this.plugin.helpers.substructureParent.get(r.structure),s=this.plugin.helpers.substructureParent.get(n.structure),u=this.plugin.helpers.substructureParent.get(i.structure),!o||!s||!u?[2]:(l=[o.transform.ref],Pa(l,s.transform.ref),Pa(l,u.transform.ref),c=this.getGroup(),c.apply(rt.Model.MultiStructureSelectionFromExpression,{selections:[{key:"a",ref:o.transform.ref,expression:De.toExpression(r)},{key:"b",ref:s.transform.ref,expression:De.toExpression(n)},{key:"c",ref:u.transform.ref,expression:De.toExpression(i)}],isTransitive:!0,label:"Angle"},{dependsOn:l,tags:a==null?void 0:a.selectionTags}).apply(rt.Representation.StructureSelectionsAngle3D,E(E(E({customText:(a==null?void 0:a.customText)||"",textColor:this.state.options.textColor},a==null?void 0:a.lineParams),a==null?void 0:a.labelParams),a==null?void 0:a.visualParams),{tags:a==null?void 0:a.reprTags}),d=this.plugin.state.data,[4,_t.State.Update(this.plugin,{state:d,tree:c,options:{doNotLogTiming:!0}})]);case 1:return f.sent(),[2]}})})},t.prototype.addDihedral=function(r,n,i,a,o){return ce(this,void 0,void 0,function(){var s,u,l,c,d,f,h;return de(this,function(v){switch(v.label){case 0:return s=this.plugin.helpers.substructureParent.get(r.structure),u=this.plugin.helpers.substructureParent.get(n.structure),l=this.plugin.helpers.substructureParent.get(i.structure),c=this.plugin.helpers.substructureParent.get(a.structure),!s||!u||!l||!c?[2]:(d=[s.transform.ref],Pa(d,u.transform.ref),Pa(d,l.transform.ref),Pa(d,c.transform.ref),f=this.getGroup(),f.apply(rt.Model.MultiStructureSelectionFromExpression,{selections:[{key:"a",ref:s.transform.ref,expression:De.toExpression(r)},{key:"b",ref:u.transform.ref,expression:De.toExpression(n)},{key:"c",ref:l.transform.ref,expression:De.toExpression(i)},{key:"d",ref:c.transform.ref,expression:De.toExpression(a)}],isTransitive:!0,label:"Dihedral"},{dependsOn:d,tags:o==null?void 0:o.selectionTags}).apply(rt.Representation.StructureSelectionsDihedral3D,E(E(E({customText:(o==null?void 0:o.customText)||"",textColor:this.state.options.textColor},o==null?void 0:o.lineParams),o==null?void 0:o.labelParams),o==null?void 0:o.visualParams),{tags:o==null?void 0:o.reprTags}),h=this.plugin.state.data,[4,_t.State.Update(this.plugin,{state:h,tree:f,options:{doNotLogTiming:!0}})]);case 1:return v.sent(),[2]}})})},t.prototype.addLabel=function(r,n){return ce(this,void 0,void 0,function(){var i,a,o,s;return de(this,function(u){switch(u.label){case 0:return i=this.plugin.helpers.substructureParent.get(r.structure),i?(a=[i.transform.ref],o=this.getGroup(),o.apply(rt.Model.MultiStructureSelectionFromExpression,{selections:[{key:"a",ref:i.transform.ref,expression:De.toExpression(r)}],isTransitive:!0,label:"Label"},{dependsOn:a,tags:n==null?void 0:n.selectionTags}).apply(rt.Representation.StructureSelectionsLabel3D,E(E({textColor:this.state.options.textColor},n==null?void 0:n.labelParams),n==null?void 0:n.visualParams),{tags:n==null?void 0:n.reprTags}),s=this.plugin.state.data,[4,_t.State.Update(this.plugin,{state:s,tree:o,options:{doNotLogTiming:!0}})]):[2];case 1:return u.sent(),[2]}})})},t.prototype.addOrientation=function(r){return ce(this,void 0,void 0,function(){var n,i,a,o;return de(this,function(s){switch(s.label){case 0:return n=this.plugin.helpers.substructureParent.get(r.structure),n?(i=[n.transform.ref],a=this.getGroup(),a.apply(rt.Model.MultiStructureSelectionFromExpression,{selections:[{key:"a",ref:n.transform.ref,expression:De.toExpression(r)}],isTransitive:!0,label:"Orientation"},{dependsOn:i}).apply(rt.Representation.StructureSelectionsOrientation3D),o=this.plugin.state.data,[4,_t.State.Update(this.plugin,{state:o,tree:a,options:{doNotLogTiming:!0}})]):[2];case 1:return s.sent(),[2]}})})},t.prototype.getTransforms=function(r){var n=this.plugin.state.data,i=ir.findTagInSubtree(n.tree,cr.RootRef,AT),a=i?n.select(ir.Generators.ofTransformer(r,i)):this._empty;return a.length===0?this._empty:a},t.prototype.sync=function(){var r=this.updateState({labels:this.getTransforms(rt.Representation.StructureSelectionsLabel3D),distances:this.getTransforms(rt.Representation.StructureSelectionsDistance3D),angles:this.getTransforms(rt.Representation.StructureSelectionsAngle3D),dihedrals:this.getTransforms(rt.Representation.StructureSelectionsDihedral3D),orientations:this.getTransforms(rt.Representation.StructureSelectionsOrientation3D)});r&&this.stateUpdated()},t}(vd),N_=function(e){Le(t,e);function t(r,n){n===void 0&&(n={});var i=e.call(this,{props:E(E({},I.getDefaultValues(t.Params)),n)})||this;return i.plugin=r,i._props=I.getDefaultValues(t.Params),i.events={propsUpdated:i.ev()},i.lociSelects=new t.LociSelectManager(r,i._props),i.lociHighlights=new t.LociHighlightManager(r,i._props),i}return Object.defineProperty(t.prototype,"props",{get:function(){return E({},this.state.props)},enumerable:!1,configurable:!0}),t.prototype.setProps=function(r){var n=this.props,i=E(E({},this.state.props),r);jk(n,i)||(this.updateState({props:i}),this.lociSelects.setProps(i),this.lociHighlights.setProps(i),this.events.propsUpdated.next())},t}(vd);(function(e){e.Params={granularity:I.Select("residue",ar.GranularityOptions,{label:"Picking Level",description:"Controls if selections are expanded upon picking to whole residues, chains, structures, instances, or left as atoms and coarse elements"})};var t=function(){function i(a,o){o===void 0&&(o={}),this.ctx=a,this.providers=[],this.props=I.getDefaultValues(e.Params),this.sel=a.managers.structure.selection,this.setProps(o)}return i.prototype.setProps=function(a){Object.assign(this.props,a)},i.prototype.addProvider=function(a){this.providers.push(a)},i.prototype.removeProvider=function(a){this.providers=this.providers.filter(function(o){return o!==a})},i.prototype.normalizedLoci=function(a,o){o===void 0&&(o=!0);var s=a.loci,u=a.repr,l=o?this.props.granularity:void 0;return{loci:ar.normalize(s,l),repr:u}},i.prototype.mark=function(a,o){if(!ar.isEmpty(a.loci))for(var s=0,u=this.providers;s<u.length;s++){var l=u[s];l(a,o)}},i}();e.LociMarkManager=t;var r=function(i){Le(a,i);function a(){var o=i!==null&&i.apply(this,arguments)||this;return o.prev=[],o.clearHighlights=function(){for(var s=0,u=o.prev;s<u.length;s++){var l=u[s];o.mark(l,tr.RemoveHighlight)}o.prev.length=0},o}return a.prototype.isHighlighted=function(o){for(var s=0,u=this.prev;s<u.length;s++){var l=u[s];if(or.Loci.areEqual(l,o))return!0}return!1},a.prototype.addHighlight=function(o){this.mark(o,tr.Highlight),this.prev.push(o)},a.prototype.highlight=function(o,s){s===void 0&&(s=!0);var u=this.normalizedLoci(o,s);this.isHighlighted(u)||this.addHighlight(u)},a.prototype.highlightOnly=function(o,s){s===void 0&&(s=!0);var u=this.normalizedLoci(o,s);this.isHighlighted(u)||(this.clearHighlights(),this.addHighlight(u))},a.prototype.highlightOnlyExtend=function(o,s){s===void 0&&(s=!0);var u=this.normalizedLoci(o,s);if(De.is(u.loci)){var l={loci:this.sel.tryGetRange(u.loci)||u.loci,repr:u.repr};this.isHighlighted(l)||(this.clearHighlights(),this.addHighlight(l))}},a}(t);e.LociHighlightManager=r;var n=function(i){Le(a,i);function a(){return i!==null&&i.apply(this,arguments)||this}return a.prototype.toggle=function(o,s){if(s===void 0&&(s=!0),!ar.isEmpty(o.loci)){var u=this.normalizedLoci(o,s);De.is(u.loci)?this.toggleSel(u):i.prototype.mark.call(this,u,tr.Toggle)}},a.prototype.toggleExtend=function(o,s){if(s===void 0&&(s=!0),!ar.isEmpty(o.loci)){var u=this.normalizedLoci(o,s);if(De.is(u.loci)){var l=this.sel.tryGetRange(u.loci)||u.loci;this.toggleSel({loci:l,repr:u.repr})}}},a.prototype.select=function(o,s){s===void 0&&(s=!0);var u=this.normalizedLoci(o,s);De.is(u.loci)&&this.sel.modify("add",u.loci),this.mark(u,tr.Select)},a.prototype.selectJoin=function(o,s){s===void 0&&(s=!0);var u=this.normalizedLoci(o,s);De.is(u.loci)&&this.sel.modify("intersect",u.loci),this.mark(u,tr.Select)},a.prototype.selectOnly=function(o,s){s===void 0&&(s=!0);var u=this.normalizedLoci(o,s);De.is(u.loci)&&(this.deselect({loci:$e.toStructureElementLoci(u.loci.structure),repr:u.repr},!1),this.sel.modify("set",u.loci)),this.mark(u,tr.Select)},a.prototype.deselect=function(o,s){s===void 0&&(s=!0);var u=this.normalizedLoci(o,s);De.is(u.loci)&&this.sel.modify("remove",u.loci),this.mark(u,tr.Deselect)},a.prototype.deselectAll=function(){this.sel.clear(),this.mark({loci:Nje},tr.Deselect)},a.prototype.deselectAllOnEmpty=function(o){xu(o.loci)&&this.deselectAll()},a.prototype.mark=function(o,s){var u=o.loci;ar.isEmpty(u)||(De.is(u)?(i.prototype.mark.call(this,{loci:$e.Loci(u.structure)},tr.Deselect),i.prototype.mark.call(this,{loci:this.sel.getLoci(u.structure)},tr.Select)):i.prototype.mark.call(this,o,s))},a.prototype.toggleSel=function(o){this.sel.has(o.loci)?(this.sel.modify("remove",o.loci),this.mark(o,tr.Deselect)):(this.sel.modify("add",o.loci),this.mark(o,tr.Select))},a}(t);e.LociSelectManager=n})(N_||(N_={}));function yQe(e,t){for(var r,n=[],i=t==="auth"?"auth_asym_id":"label_asym_id",a=t==="auth"?"auth_seq_id":"label_seq_id",o=0,s=e;o<s.length;o++){var u=s[o];if(u.kind==="range")n.push(se.struct.generator.atomGroups({"chain-test":se.core.rel.eq([se.ammp(i),u.asym_id]),"residue-test":se.core.rel.inRange([se.ammp(a),u.seq_id_beg,u.seq_id_end])}));else{var l=((r=u.ins_code)!==null&&r!==void 0?r:"").trim();n.push(se.struct.generator.atomGroups({"chain-test":se.core.rel.eq([se.ammp(i),u.asym_id]),"residue-test":se.core.logic.and([se.core.rel.eq([se.ammp(a),u.seq_id]),se.core.rel.eq([se.ammp("pdbx_PDB_ins_code"),l])])}))}}var c=se.struct.combinator.merge(n);return Kp(c)}function bQe(e){for(var t=Zr.create(),r=0,n=e;r<n.length;r++)for(var i=n[r],a=i[0],o=i[1],s=a;s<=o;s++)Zr.add(t,s,s);var u=se.struct.generator.atomGroups({"atom-test":se.core.set.has([se.set.apply(se,t.array),se.ammp("id")])});return Kp(u)}function xQe(e,t,r){if(!(!e||t.length===0||Number.isNaN(+t[0])))return Number.isNaN(r)?{kind:"single",asym_id:e,seq_id:+t[0],ins_code:t[1]}:{kind:"range",asym_id:e,seq_id_beg:+t[0],seq_id_end:r}}function SQe(e){return e?e.split(":"):[]}function CQe(e){return e.split(",").map(function(t){return t.trim().split(/\s+|[-]/g).filter(function(r){return!!r})}).map(function(t){return xQe(t[0],SQe(t[1]),+t[2])}).filter(function(t){return!!t})}function _Qe(e){return e.split(",").map(function(t){return t.trim().split(/\s+|[-]/g).filter(function(r){return!!r})}).filter(function(t){return t.length===1||t.length===2}).map(function(t){return t.length===1?[+t[0],+t[0]]:[+t[0],+t[1]]})}function wQe(e,t){if(t==="atom-id"){var r=_Qe(e);return bQe(r)}else{var r=CQe(e);return yQe(r,t)}}function EQe(e){return Object.keys(e).map(function(t){return[t,e[t]]})}var dD=function(e){Le(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.getBindingComponents=function(){var r=EQe(this.props.bindings);return T.jsx(T.Fragment,{children:r.map(function(n){var i=n[0],a=n[1];return fr.isEmpty(a)?null:T.jsxs("div",E({style:{marginBottom:"6px"}},{children:[T.jsx("b",{children:a.action},void 0),T.jsx("br",{},void 0),T.jsx("span",{dangerouslySetInnerHTML:{__html:fr.format(a,i)}},void 0)]}),i)})},void 0)},t.prototype.render=function(){return T.jsx(tl,{children:this.getBindingComponents()},void 0)},t}(Ve.PureComponent),tl=function(e){Le(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.render=function(){return T.jsx("div",E({className:"msp-help-text"},{children:T.jsx("div",{children:this.props.children},void 0)}),void 0)},t}(Ve.PureComponent),il=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={header:r.props.header,isExpanded:!!r.props.initiallyExpanded},r.toggleExpanded=function(){return r.setState({isExpanded:!r.state.isExpanded})},r}return t.prototype.render=function(){return T.jsxs("div",E({className:"msp-control-group-wrapper"},{children:[T.jsx("div",E({className:"msp-control-group-header"},{children:T.jsxs(hr,E({onClick:this.toggleExpanded},{children:[T.jsx(nn,{svg:this.state.isExpanded?Rc:kc},void 0),this.props.header]}),void 0)}),void 0),this.state.isExpanded&&T.jsx("div",E({className:"msp-control-offset",style:{display:this.state.isExpanded?"block":"none"}},{children:this.props.children}),void 0)]}),void 0)},t}(Ve.PureComponent);function PT(e){return T.jsx("div",E({className:"msp-simple-help-section"},{children:e.header}),void 0)}var fL=function(e){Le(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.events.canvas3d.settingsUpdated,function(){return r.forceUpdate()})},t.prototype.render=function(){var r={};return this.plugin.spec.behaviors.forEach(function(n){var i=n.defaultParams.bindings;i&&Object.assign(r,i)}),T.jsxs(T.Fragment,{children:[!this.props.selectOnly&&this.plugin.canvas3d&&T.jsx(il,E({header:"Moving in 3D"},{children:T.jsx(dD,{bindings:this.plugin.canvas3d.props.trackball.bindings},void 0)}),"trackball"),T.jsx(il,E({header:"Mouse Controls"},{children:T.jsx(dD,{bindings:r},void 0)}),"interactions")]},void 0)},t}(pr),AQe=function(e){Le(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.events.canvas3d.settingsUpdated,function(){return r.forceUpdate()})},t.prototype.formatTriggers=function(r){return r.triggers.map(function(n){return fr.Trigger.format(n)}).join(" or ")},t.prototype.getTriggerFor=function(r,n){var i=this.plugin.state.behaviors,a=i.select(ir.Generators.ofTransformer(r)),o=a.length===1?a[0].params:void 0,s=o?o.values.bindings:{},u=n in s?s[n]:fr.Empty;return this.formatTriggers(u)},t.prototype.render=function(){var r=this.getTriggerFor(ite,"clickSelectToggle"),n=this.getTriggerFor(oE,"clickFocus");return T.jsxs("div",{children:[T.jsx(PT,{header:"Interface Controls"},void 0),T.jsxs(il,E({header:"Inline Help"},{children:[T.jsx(tl,{children:"Many user interface elements show a little questionmark icon when hovered over. Clicking the icon toggles the display of an inline help text."},void 0),T.jsx(tl,{children:"Tooltips may provide additional information on a user interface element and are shown when hovering over it with the mouse."},void 0)]}),void 0),T.jsx(il,E({header:"Selections"},{children:T.jsxs(tl,{children:["The viewer allows changing colors and representations for selections of atoms, residues or chains. Selections can be created by",T.jsxs("ul",E({style:{paddingLeft:"20px"}},{children:[T.jsxs("li",{children:["picking elements on the 3D canvas or the sequence view using the mouse, e.g. toggle selection using ",r," (for more see help section on ",T.jsx("i",{children:"Mouse Controls"},void 0),")"]},void 0),T.jsxs("li",{children:["using the ",T.jsx("i",{children:"Add"},void 0),", ",T.jsx("i",{children:"Remove"},void 0)," and ",T.jsx("i",{children:"Only"},void 0)," dropdown buttons in the ",T.jsx("i",{children:"Manage Selection"},void 0)," panel which allow modifing the current selection by predefined sets"]},void 0)]}),void 0)]},void 0)}),void 0),T.jsx(il,E({header:"Coloring"},{children:T.jsxs(tl,{children:["There are two ways to color structures. Every representation (e.g. cartoon or spacefill) has a color theme which can be changed using the dropdown for each representation in the ",T.jsx("i",{children:"Structure Settings"},void 0)," panel. Additionally any selection atoms, residues or chains can by given a custom color. For that, first select the parts of the structure to be colored (see help section on ",T.jsx("i",{children:"Selections"},void 0),") and, second, choose a color from the color dropdown botton in the ",T.jsx("i",{children:"Selection"},void 0)," row of the ",T.jsx("i",{children:"Change Representation"},void 0)," panel. The theme color can be seen as a base color that is overpainted by the custom color. Custom colors can be removed for a selection with the 'Clear' option in the color dropdown."]},void 0)}),void 0),T.jsx(il,E({header:"Representations"},{children:T.jsxs(tl,{children:["Structures can be shown with many different representations (e.g. cartoon or spacefill). The ",T.jsx("i",{children:"Change Representation"},void 0)," panel offers a collection of predefined styles which can be applied using the ",T.jsx("i",{children:"Preset"},void 0)," dropdown button. Additionally any selection atoms, residues or chains can by shown with a custom representation. For that, first select the parts of the structure to be mofified (see help section on ",T.jsx("i",{children:"Selections"},void 0),") and, second, choose a representation to hide or show from the ",T.jsx("i",{children:"Show"},void 0)," and ",T.jsx("i",{children:"Hide"},void 0)," dropdown bottons in the ",T.jsx("i",{children:"Selection"},void 0)," row of the ",T.jsx("i",{children:"Change Representation"},void 0)," panel. The ",T.jsx("i",{children:"Everything"},void 0)," row applies the action to the whole structure instead of the current selection."]},void 0)}),void 0),T.jsx(il,E({header:"Surroundings"},{children:T.jsxs(tl,{children:["To show the surroundings of a residue or ligand, click it in the 3D scene or in the sequence widget using ",n,"."]},void 0)}),void 0),T.jsx(PT,{header:"How-to Guides"},void 0),T.jsx(il,E({header:"Create an Image"},{children:T.jsxs(tl,{children:[T.jsxs("p",{children:["Use the ",T.jsx(nn,{svg:tEe},void 0)," icon in the viewport to bring up the screenshot controls."]},void 0),T.jsxs("p",{children:["To adjust the size of the image, use the ",T.jsx("i",{children:"Resolution"},void 0)," dropdown."]},void 0)]},void 0)}),void 0),T.jsx(PT,{header:"Mouse Controls"},void 0),T.jsx(fL,{},void 0)]},void 0)},t}(pr),F_=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r._toggleSelMode=function(){r.plugin.selectionMode=!r.plugin.selectionMode},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.events.canvas3d.settingsUpdated,function(){return r.forceUpdate()}),this.subscribe(this.plugin.layout.events.updated,function(){return r.forceUpdate()}),this.subscribe(this.plugin.behaviors.interaction.selectionMode,function(){return r.forceUpdate()})},t.prototype.render=function(){var r=this.props.inline?{background:"transparent",width:"auto",height:"auto",lineHeight:"unset"}:{background:"transparent"};return T.jsx(Ht,{svg:rAe,onClick:this._toggleSelMode,title:"Toggle Selection Mode",style:r,toggleState:this.plugin.selectionMode},void 0)},t}(Gi),PQe={granularity:N_.Params.granularity},Zv=new Map([["add","Add/Union Selection"],["remove","Remove/Subtract Selection"],["intersect","Intersect Selection"],["set","Set Selection"]]),TQe=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={action:void 0,helper:void 0,isEmpty:!0,isBusy:!1,canUndo:!1},r.set=function(n,i){r.plugin.managers.structure.selection.fromSelectionQuery(n,i,!1)},r.selectQuery=function(n,i){if(!n||!r.state.action){r.setState({action:void 0});return}var a=r.state.action;i!=null&&i.shiftKey?r.set(a,n.value):r.setState({action:void 0},function(){r.set(a,n.value)})},r.selectHelper=function(n,i){if(console.log(n),!n||!r.state.action){r.setState({action:void 0,helper:void 0});return}r.setState({helper:n.value.kind})},r.queriesItems=[],r.queriesVersion=-1,r.helpersItems=void 0,r.toggleAdd=r.showAction("add"),r.toggleRemove=r.showAction("remove"),r.toggleIntersect=r.showAction("intersect"),r.toggleSet=r.showAction("set"),r.toggleTheme=r.showAction("theme"),r.toggleAddComponent=r.showAction("add-component"),r.toggleHelp=r.showAction("help"),r.setGranuality=function(n){var i=n.value;r.plugin.managers.interactivity.setProps({granularity:i})},r.turnOff=function(){return r.plugin.selectionMode=!1},r.undo=function(){var n=r.plugin.state.data.undo();n&&r.plugin.runTask(n)},r.subtract=function(){for(var n=r.plugin.managers.structure.hierarchy.getStructuresWithSelection(),i=[],a=0,o=n;a<o.length;a++){var s=o[a];i.push.apply(i,s.components)}i.length!==0&&r.plugin.managers.structure.component.modifyByCurrentSelection(i,"subtract")},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.managers.structure.hierarchy.behaviors.selection,function(n){var i=n.hierarchy.structures.length===0;r.state.isEmpty!==i&&r.setState({isEmpty:i}),r.queriesVersion=-1,r.forceUpdate()}),this.subscribe(this.plugin.behaviors.state.isBusy,function(n){r.setState({isBusy:n,action:void 0})}),this.subscribe(this.plugin.managers.interactivity.events.propsUpdated,function(){r.forceUpdate()}),this.subscribe(this.plugin.state.data.events.historyUpdated,function(n){var i=n.state;r.setState({canUndo:i.canUndo})})},Object.defineProperty(t.prototype,"isDisabled",{get:function(){return this.state.isBusy||this.state.isEmpty},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"structures",{get:function(){for(var r,n=[],i=0,a=this.plugin.managers.structure.hierarchy.selection.structures;i<a.length;i++){var o=a[i],s=(r=o.cell.obj)===null||r===void 0?void 0:r.data;s&&n.push(s)}return n},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"queries",{get:function(){var r=this.plugin.query.structure.registry;if(r.version!==this.queriesVersion){var n=this.structures,i=Ft(Ft(Ft(Ft([],r.list),RHe(n)),DHe(n)),MHe(n)).sort(function(a,o){return o.priority-a.priority});this.queriesItems=er.createItems(i,{filter:function(a){return a!==di.current&&!a.isHidden},label:function(a){return a.label},category:function(a){return a.category},description:function(a){return a.description}}),this.queriesVersion=r.version}return this.queriesItems},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"helpers",{get:function(){if(this.helpersItems)return this.helpersItems;var r=[{kind:"residue-list",category:"Helpers",label:"Atom/Residue Identifier List",description:"Create a selection from a list of atom/residue ranges."}];return this.helpersItems=er.createItems(r,{label:function(n){return n.label},category:function(n){return n.category},description:function(n){return n.description}}),this.helpersItems},enumerable:!1,configurable:!0}),t.prototype.showAction=function(r){var n=this;return function(){return n.setState({action:n.state.action===r?void 0:r,helper:void 0})}},t.prototype.render=function(){var r=this,n=this.plugin.managers.interactivity.props.granularity,i=this.state.canUndo?"Undo "+this.plugin.state.data.latestUndoLabel:"Some mistakes of the past can be undone.",a=void 0;if(this.state.action&&!this.state.helper)a=T.jsxs(T.Fragment,{children:[this.state.action&&this.state.action!=="theme"&&this.state.action!=="add-component"&&this.state.action!=="help"&&T.jsxs("div",E({className:"msp-selection-viewport-controls-actions"},{children:[T.jsx(er,{header:Zv.get(this.state.action),title:"Click to close.",items:this.queries,onSelect:this.selectQuery,noOffset:!0},void 0),T.jsx(er,{items:this.helpers,onSelect:this.selectHelper,noOffset:!0},void 0)]}),void 0),this.state.action==="theme"&&T.jsx("div",E({className:"msp-selection-viewport-controls-actions"},{children:T.jsx(fc,E({header:"Theme",title:"Click to close.",initialExpanded:!0,hideExpander:!0,hideOffset:!0,onHeaderClick:this.toggleTheme,topRightIcon:dc},{children:T.jsx(MQe,{onApply:this.toggleTheme},void 0)}),void 0)}),void 0),this.state.action==="add-component"&&T.jsx("div",E({className:"msp-selection-viewport-controls-actions"},{children:T.jsx(fc,E({header:"Add Component",title:"Click to close.",initialExpanded:!0,hideExpander:!0,hideOffset:!0,onHeaderClick:this.toggleAddComponent,topRightIcon:dc},{children:T.jsx(Dte,{onApply:this.toggleAddComponent,forSelection:!0},void 0)}),void 0)}),void 0),this.state.action==="help"&&T.jsx("div",E({className:"msp-selection-viewport-controls-actions"},{children:T.jsxs(fc,E({header:"Help",title:"Click to close.",initialExpanded:!0,hideExpander:!0,hideOffset:!0,onHeaderClick:this.toggleHelp,topRightIcon:dc,maxHeight:"300px"},{children:[T.jsx(il,E({header:"Selection Operations"},{children:T.jsxs(tl,{children:["Use ",T.jsx(nn,{svg:yM,inline:!0},void 0)," ",T.jsx(nn,{svg:bM,inline:!0},void 0)," ",T.jsx(nn,{svg:xM,inline:!0},void 0)," ",T.jsx(nn,{svg:jC,inline:!0},void 0)," to modify the selection."]},void 0)}),void 0),T.jsx(il,E({header:"Representation Operations"},{children:T.jsxs(tl,{children:["Use ",T.jsx(nn,{svg:CM,inline:!0},void 0)," ",T.jsx(nn,{svg:SM,inline:!0},void 0)," ",T.jsx(nn,{svg:AM,inline:!0},void 0)," ",T.jsx(nn,{svg:PM,inline:!0},void 0)," to color, create components, remove from components, or undo actions."]},void 0)}),void 0),T.jsx(fL,{selectOnly:!0},void 0)]}),void 0)}),void 0)]},void 0);else if(Zv.has(this.state.action)&&this.state.helper==="residue-list"){var o=function(){return r.setState({action:void 0,helper:void 0})};a=T.jsx("div",E({className:"msp-selection-viewport-controls-actions"},{children:T.jsx(fc,E({header:"Atom/Residue Identifier List",title:"Click to close.",initialExpanded:!0,hideExpander:!0,hideOffset:!0,onHeaderClick:o,topRightIcon:dc},{children:T.jsx(RQe,{modifier:this.state.action,plugin:this.plugin,close:o},void 0)}),void 0)}),void 0)}return T.jsxs(T.Fragment,{children:[T.jsxs("div",E({className:"msp-flex-row",style:{background:"none"}},{children:[T.jsx(um,{title:"Picking Level for selecting and highlighting",param:PQe.granularity,name:"granularity",value:n,onChange:this.setGranuality,isDisabled:this.isDisabled},void 0),T.jsx(Ai,{icon:yM,title:Zv.get("add")+". Hold shift key to keep menu open.",toggle:this.toggleAdd,isSelected:this.state.action==="add",disabled:this.isDisabled},void 0),T.jsx(Ai,{icon:bM,title:Zv.get("remove")+". Hold shift key to keep menu open.",toggle:this.toggleRemove,isSelected:this.state.action==="remove",disabled:this.isDisabled},void 0),T.jsx(Ai,{icon:xM,title:Zv.get("intersect")+". Hold shift key to keep menu open.",toggle:this.toggleIntersect,isSelected:this.state.action==="intersect",disabled:this.isDisabled},void 0),T.jsx(Ai,{icon:jC,title:Zv.get("set")+". Hold shift key to keep menu open.",toggle:this.toggleSet,isSelected:this.state.action==="set",disabled:this.isDisabled},void 0),T.jsx(Ai,{icon:CM,title:"Apply Theme to Selection",toggle:this.toggleTheme,isSelected:this.state.action==="theme",disabled:this.isDisabled,style:{marginLeft:"10px"}},void 0),T.jsx(Ai,{icon:SM,title:"Create Component of Selection with Representation",toggle:this.toggleAddComponent,isSelected:this.state.action==="add-component",disabled:this.isDisabled},void 0),T.jsx(Ht,{svg:AM,title:"Remove/subtract Selection from all Components",onClick:this.subtract,disabled:this.isDisabled},void 0),T.jsx(Ht,{svg:PM,onClick:this.undo,disabled:!this.state.canUndo||this.isDisabled,title:i},void 0),T.jsx(Ai,{icon:Sl,title:"Show/hide help",toggle:this.toggleHelp,style:{marginLeft:"10px"},isSelected:this.state.action==="help"},void 0),T.jsx(Ht,{svg:Uk,title:"Turn selection mode off",onClick:this.turnOff},void 0)]}),void 0),a]},void 0)},t}(pr),IQe=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isEmpty:!0,isBusy:!1},r.clear=function(){return r.plugin.managers.interactivity.lociSelects.deselectAll()},r.focus=function(){if(r.plugin.managers.structure.selection.stats.elementCount!==0){var n=r.plugin.managers.structure.selection.getBoundary().sphere;r.plugin.managers.camera.focusSphere(n)}},r.highlight=function(n){r.plugin.managers.interactivity.lociHighlights.clearHighlights(),r.plugin.managers.structure.selection.entries.forEach(function(i){r.plugin.managers.interactivity.lociHighlights.highlight({loci:i.selection},!1)})},r.clearHighlight=function(){r.plugin.managers.interactivity.lociHighlights.clearHighlights()},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.managers.structure.selection.events.changed,function(){r.forceUpdate()}),this.subscribe(this.plugin.managers.structure.hierarchy.behaviors.selection,function(n){var i=n.structures.length===0;r.state.isEmpty!==i&&r.setState({isEmpty:i})}),this.subscribe(this.plugin.behaviors.state.isBusy,function(n){r.setState({isBusy:n})})},Object.defineProperty(t.prototype,"isDisabled",{get:function(){return this.state.isBusy||this.state.isEmpty},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"stats",{get:function(){var r=this.plugin.managers.structure.selection.stats;return r.structureCount===0||r.elementCount===0?"Nothing Selected":ff(r.label)+" Selected"},enumerable:!1,configurable:!0}),t.prototype.render=function(){var r=this.plugin.managers.structure.selection.stats,n=r.structureCount===0||r.elementCount===0;return n&&this.props.hideOnEmpty?null:T.jsx(T.Fragment,{children:T.jsxs("div",E({className:"msp-flex-row"},{children:[T.jsx(hr,E({noOverflow:!0,onClick:this.focus,title:"Click to Focus Selection",disabled:n,onMouseEnter:this.highlight,onMouseLeave:this.clearHighlight,style:{textAlignLast:n?void 0:"left"}},{children:this.stats}),void 0),!n&&T.jsx(Ht,{svg:Uk,onClick:this.clear,title:"Clear",className:"msp-form-control",flex:!0},void 0)]}),void 0)},void 0)},t}(pr),MQe=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r._params=Kf(function(n){return rv.getThemeParams(r.plugin,n)}),r.state={values:I.getDefaultValues(r.params)},r.apply=function(){var n,i;r.plugin.managers.structure.component.applyTheme(r.state.values,r.plugin.managers.structure.hierarchy.current.structures),(i=(n=r.props).onApply)===null||i===void 0||i.call(n)},r.paramsChanged=function(n){return r.setState({values:n})},r}return Object.defineProperty(t.prototype,"params",{get:function(){return this._params(this.plugin.managers.structure.component.pivotStructure)},enumerable:!1,configurable:!0}),t.prototype.render=function(){return T.jsxs(T.Fragment,{children:[T.jsx(On,{params:this.params,values:this.state.values,onChangeValues:this.paramsChanged},void 0),T.jsx(hr,E({icon:CM,className:"msp-btn-commit msp-btn-commit-on",onClick:this.apply,style:{marginTop:"1px"}},{children:"Apply Theme"}),void 0)]},void 0)},t}(Gi),kte={idType:I.Select("auth",I.arrayToOptions(["auth","label","atom-id"])),identifiers:I.Text("",{description:"A comma separated list of atom identifiers (e.g. 10, 15-25) or residue ranges in given chain (e.g. A 10-15, B 25, C 30:i)"})},DQe=I.getDefaultValues(kte);function RQe(e){var t=e.modifier,r=e.plugin,n=e.close,i=Ve.useState(DQe),a=i[0],o=i[1],s=function(){if(a.identifiers.trim().length!==0)try{n();var u=wQe(a.identifiers,a.idType);r.managers.structure.selection.fromCompiledQuery(t,u,!1)}catch(l){r.log.error("Failed to create selection: "+l)}};return T.jsxs(T.Fragment,{children:[T.jsx(On,{params:kte,values:a,onChangeValues:o,onEnter:s},void 0),T.jsxs(hr,E({className:"msp-btn-commit msp-btn-commit-on",disabled:a.identifiers.trim().length===0,onClick:s,style:{marginTop:"1px"}},{children:[Hg(t)," Selection"]}),void 0)]},void 0)}var kQe=function(e){Le(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.defaultState=function(){return{isCollapsed:!1,header:"Measurements",brand:{accent:"gray",svg:N3e}}},t.prototype.renderControls=function(){return T.jsxs(T.Fragment,{children:[T.jsx(LQe,{},void 0),T.jsx(OQe,{},void 0)]},void 0)},t}(Wg),OQe=function(e){Le(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.managers.structure.measurement.behaviors.state,function(){r.forceUpdate()})},t.prototype.renderGroup=function(r,n){for(var i=[],a=0,o=r;a<o.length;a++){var s=o[a];s.obj&&i.push(T.jsx(FQe,{cell:s},s.obj.id))}return i.length?T.jsx(Tu,E({header:n,initiallyExpanded:!0},{children:i}),void 0):null},t.prototype.render=function(){var r=this.plugin.managers.structure.measurement.state;return T.jsxs("div",E({style:{marginTop:"6px"}},{children:[this.renderGroup(r.labels,"Labels"),this.renderGroup(r.distances,"Distances"),this.renderGroup(r.angles,"Angles"),this.renderGroup(r.dihedrals,"Dihedrals")]}),void 0)},t}(Gi),LQe=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isBusy:!1,action:void 0},r.measureDistance=function(){var n=r.plugin.managers.structure.selection.additionsHistory;r.plugin.managers.structure.measurement.addDistance(n[0].loci,n[1].loci)},r.measureAngle=function(){var n=r.plugin.managers.structure.selection.additionsHistory;r.plugin.managers.structure.measurement.addAngle(n[0].loci,n[1].loci,n[2].loci)},r.measureDihedral=function(){var n=r.plugin.managers.structure.selection.additionsHistory;r.plugin.managers.structure.measurement.addDihedral(n[0].loci,n[1].loci,n[2].loci,n[3].loci)},r.addLabel=function(){var n=r.plugin.managers.structure.selection.additionsHistory;r.plugin.managers.structure.measurement.addLabel(n[0].loci)},r.selectAction=function(n){r.toggleAdd(),n&&(n==null?void 0:n.value)()},r.toggleAdd=function(){return r.setState({action:r.state.action==="add"?void 0:"add"})},r.toggleOptions=function(){return r.setState({action:r.state.action==="options"?void 0:"options"})},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.selection.events.additionsHistoryUpdated,function(){r.forceUpdate()}),this.subscribe(this.plugin.behaviors.state.isBusy,function(n){r.setState({isBusy:n})})},Object.defineProperty(t.prototype,"selection",{get:function(){return this.plugin.managers.structure.selection},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"actions",{get:function(){var r=this.selection.additionsHistory,n=[{kind:"item",label:"Label "+(r.length===0?" (1 selection required)":" (1st selection)"),value:this.addLabel,disabled:r.length===0},{kind:"item",label:"Distance "+(r.length<2?" (2 selections required)":" (top 2 selections)"),value:this.measureDistance,disabled:r.length<2},{kind:"item",label:"Angle "+(r.length<3?" (3 selections required)":" (top 3 selections)"),value:this.measureAngle,disabled:r.length<3},{kind:"item",label:"Dihedral "+(r.length<4?" (4 selections required)":" (top 4 selections)"),value:this.measureDihedral,disabled:r.length<4}];return n},enumerable:!1,configurable:!0}),t.prototype.highlight=function(r){this.plugin.managers.interactivity.lociHighlights.highlightOnly({loci:r},!1)},t.prototype.moveHistory=function(r,n){this.plugin.managers.structure.selection.modifyHistory(r,n,4)},t.prototype.focusLoci=function(r){this.plugin.managers.camera.focusLoci(r)},t.prototype.historyEntry=function(r,n){var i=this,a=this.plugin.managers.structure.selection.additionsHistory;return T.jsxs("div",E({className:"msp-flex-row"},{children:[T.jsxs(hr,E({noOverflow:!0,title:"Click to focus. Hover to highlight.",onClick:function(){return i.focusLoci(r.loci)},style:{width:"auto",textAlign:"left"},onMouseEnter:function(){return i.highlight(r.loci)},onMouseLeave:this.plugin.managers.interactivity.lociHighlights.clearHighlights},{children:[n,". ",T.jsx("span",{dangerouslySetInnerHTML:{__html:r.label}},void 0)]}),void 0),a.length>1&&T.jsx(Ht,{svg:h3,small:!0,className:"msp-form-control",onClick:function(){return i.moveHistory(r,"up")},flex:"20px",title:"Move up"},void 0),a.length>1&&T.jsx(Ht,{svg:f3,small:!0,className:"msp-form-control",onClick:function(){return i.moveHistory(r,"down")},flex:"20px",title:"Move down"},void 0),T.jsx(Ht,{svg:Vs,small:!0,className:"msp-form-control",onClick:function(){return i.plugin.managers.structure.selection.modifyHistory(r,"remove")},flex:!0,title:"Remove"},void 0)]}),r.id)},t.prototype.add=function(){for(var r=this.plugin.managers.structure.selection.additionsHistory,n=[],i=0,a=Math.min(r.length,4);i<a;i++)n.push(this.historyEntry(r[i],i+1));return T.jsxs(T.Fragment,{children:[T.jsx(er,{items:this.actions,onSelect:this.selectAction},void 0),n.length>0&&T.jsx("div",E({className:"msp-control-offset"},{children:n}),void 0),n.length===0&&T.jsx("div",E({className:"msp-control-offset msp-help-text"},{children:T.jsxs("div",E({className:"msp-help-description"},{children:[T.jsx(nn,{svg:Sl,inline:!0},void 0),"Add one or more selections (toggle ",T.jsx(F_,{inline:!0},void 0)," mode)"]}),void 0)}),void 0)]},void 0)},t.prototype.render=function(){return T.jsxs(T.Fragment,{children:[T.jsxs("div",E({className:"msp-flex-row"},{children:[T.jsx(Ai,{icon:Gg,label:"Add",toggle:this.toggleAdd,isSelected:this.state.action==="add",disabled:this.state.isBusy,className:"msp-btn-apply-simple"},void 0),T.jsx(Ai,{icon:zp,label:"",title:"Options",toggle:this.toggleOptions,isSelected:this.state.action==="options",disabled:this.state.isBusy,style:{flex:"0 0 40px",padding:0}},void 0)]}),void 0),this.state.action==="add"&&this.add(),this.state.action==="options"&&T.jsx(NQe,{},void 0)]},void 0)},t}(Gi),NQe=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isDisabled:!1},r.changed=function(n){r.plugin.managers.structure.measurement.setOptions(n)},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.managers.structure.measurement.behaviors.state,function(){r.forceUpdate()}),this.subscribe(this.plugin.behaviors.state.isBusy,function(n){r.setState({isDisabled:n})})},t.prototype.render=function(){var r=this.plugin.managers.structure.measurement.state;return T.jsx("div",E({className:"msp-control-offset"},{children:T.jsx(On,{params:Rte,values:r.options,onChangeValues:this.changed,isDisabled:this.state.isDisabled},void 0)}),void 0)},t}(Gi),FQe=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={showUpdate:!1},r.delete=function(){_t.State.RemoveObject(r.plugin,{state:r.props.cell.parent,ref:r.props.cell.transform.parent,removeParentGhosts:!0})},r.toggleVisibility=function(n){n.preventDefault(),_t.State.ToggleVisibility(r.plugin,{state:r.props.cell.parent,ref:r.props.cell.transform.parent}),n.currentTarget.blur()},r.highlight=function(){var n,i=r.selections;if(i){r.plugin.managers.interactivity.lociHighlights.clearHighlights();for(var a=0,o=r.lociArray;a<o.length;a++){var s=o[a];r.plugin.managers.interactivity.lociHighlights.highlight({loci:s},!1)}r.plugin.managers.interactivity.lociHighlights.highlight({loci:(n=r.props.cell.obj)===null||n===void 0?void 0:n.data.repr.getLoci()},!1)}},r.clearHighlight=function(){r.plugin.managers.interactivity.lociHighlights.clearHighlights()},r.toggleUpdate=function(){return r.setState({showUpdate:!r.state.showUpdate})},r.focus=function(){var n=r.selections;if(n){var i=ar.getBundleBoundingSphere({loci:r.lociArray});i&&r.plugin.managers.camera.focusSphere(i)}},r.selectAction=function(n){n&&(r.setState({showUpdate:!1}),(n==null?void 0:n.value)())},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.state.events.cell.stateUpdated,function(n){r.forceUpdate()})},Object.defineProperty(t.prototype,"selections",{get:function(){var r;return(r=this.props.cell.obj)===null||r===void 0?void 0:r.data.sourceData},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"lociArray",{get:function(){var r=this.selections;return r?r.infos?[r.infos[0].loci]:r.pairs?r.pairs[0].loci:r.triples?r.triples[0].loci:r.quads?r.quads[0].loci:[]:[]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"label",{get:function(){var r=this.selections;return r?r.infos?Jf(r.infos[0].loci,{condensed:!0}):r.pairs?q3(r.pairs[0],{condensed:!0,unitLabel:this.plugin.managers.structure.measurement.state.options.distanceUnitLabel}):r.triples?W3(r.triples[0],{condensed:!0}):r.quads?$3(r.quads[0],{condensed:!0}):"<empty>":"<empty>"},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"actions",{get:function(){var r=this;return this.props.cell.sourceRef,[er.Item("Select This",function(){return r.plugin.managers.structure.selection.fromSelections(r.props.cell.sourceRef)},{icon:jC})]},enumerable:!1,configurable:!0}),t.prototype.render=function(){var r=this.props.cell,n=r.obj;return n?T.jsxs(T.Fragment,{children:[T.jsxs("div",E({className:"msp-flex-row",onMouseEnter:this.highlight,onMouseLeave:this.clearHighlight},{children:[T.jsx("button",E({className:"msp-form-control msp-control-button-label msp-no-overflow",title:"Click to focus. Hover to highlight.",onClick:this.focus,style:{width:"auto",textAlign:"left"}},{children:T.jsx("span",{dangerouslySetInnerHTML:{__html:this.label}},void 0)}),void 0),T.jsx(Ht,{svg:r.state.isHidden?fv:hv,toggleState:!1,small:!0,className:"msp-form-control",onClick:this.toggleVisibility,flex:!0,title:r.state.isHidden?"Show":"Hide"},void 0),T.jsx(Ht,{svg:Vs,small:!0,className:"msp-form-control",onClick:this.delete,flex:!0,title:"Delete",toggleState:!1},void 0),T.jsx(Ht,{svg:jp,className:"msp-form-control",onClick:this.toggleUpdate,flex:!0,title:"Actions",toggleState:this.state.showUpdate},void 0)]}),n.id),this.state.showUpdate&&r.parent&&T.jsx(T.Fragment,{children:T.jsxs("div",E({className:"msp-accent-offset"},{children:[T.jsx(er,{items:this.actions,onSelect:this.selectAction,noOffset:!0},void 0),T.jsx(Tu,E({header:"Options",noOffset:!0},{children:T.jsx(Wc,{state:r.parent,transform:r.transform,customHeader:"none",autoHideApply:!0},void 0)}),void 0)]}),void 0)},void 0)]},void 0):null},t}(Gi);function TT(e,t,r,n){for(var i=Je.indexOf(t.unit.elements,t.element),a=De(t.structure,[{unit:t.unit,indices:Oe.ofSingleton(i)}]),o=n==="residue"?De.extendToWholeResidues(a):De.extendToWholeChains(a),s=lt.entity.pdbx_description(t).join(", "),u=0,l=r.units;u<l.length;u++){var c=l[u],d=De(o.structure,[{unit:c,indices:o.elements[0].indices}]),f=Jf(d,{reverse:!0,hidePrefix:!0,htmlStyling:!1,granularity:n});f||(f=Jf(d,{hidePrefix:!1,htmlStyling:!1})),r.units.length>1&&(f+=" | "+d.elements[0].unit.conformation.operator.name);var h={label:f,category:s,loci:d};e.has(s)?e.get(s).push(h):e.set(s,[h])}}function BQe(e){for(var t=new Map,r=Ze.create(e),n=0,i=e.unitSymmetryGroups;n<i.length;n++){var a=i[n];if(Ue.isAtomic(a.units[0])){r.unit=a.units[0],r.element=a.elements[0];var o=Ue.Traits.is(r.unit.traits,1),s=lt.entity.type(r),u=s==="non-polymer",l=s==="branched",c=!!lt.entity.prd_id(r);if(c)TT(t,r,a,"chain");else if(u&&!o)TT(t,r,a,"residue");else if(l||u&&o)for(var d=r.unit,f=d.model.atomicHierarchy.residueAtomSegments.index,h=-1,v=0,p=d.elements.length;v<p;++v){var m=d.elements[v],g=f[m];g!==h&&(r.element=m,TT(t,r,a,"residue"),h=g)}}}var y=[];return t.forEach(function(b,S){b.length===1?y.push({label:S+": "+b[0].label,loci:b[0].loci}):b.length<2e3&&y.push.apply(y,b)}),y}var UQe=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isBusy:!1,showAction:!1},r.getSelectionItems=Kf(function(n){for(var i,a=[],o=0,s=n;o<s.length;o++){var u=s[o],l=(i=u.cell.obj)===null||i===void 0?void 0:i.data;if(l){var c=BQe(l);c.length>0&&a.push(Ft([er.Header(l.label,{description:l.label})],er.createItems(c,{label:function(d){return d.label},category:function(d){return d.category},description:function(d){return d.label}})))}}return a}),r.selectAction=function(n,i){if(!n||!r.state.showAction){r.setState({showAction:!1});return}var a=n.value;i!=null&&i.shiftKey?r.plugin.managers.structure.focus.addFromLoci(a.loci):r.plugin.managers.structure.focus.set(a),r.focusCamera()},r.toggleAction=function(){return r.setState({showAction:!r.state.showAction})},r.focusCamera=function(){var n=r.plugin.managers.structure.focus.current;n&&r.plugin.managers.camera.focusLoci(n.loci)},r.clear=function(){r.plugin.managers.structure.focus.clear(),r.plugin.managers.camera.reset()},r.highlightCurrent=function(){var n=r.plugin.managers.structure.focus.current;n&&r.plugin.managers.interactivity.lociHighlights.highlightOnly({loci:n.loci},!1)},r.clearHighlights=function(){r.plugin.managers.interactivity.lociHighlights.clearHighlights()},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.managers.structure.focus.behaviors.current,function(n){r.getSelectionItems([]),r.forceUpdate()}),this.subscribe(this.plugin.managers.structure.focus.events.historyUpdated,function(n){r.forceUpdate()}),this.subscribe(this.plugin.behaviors.state.isBusy,function(n){r.setState({isBusy:n,showAction:!1})})},Object.defineProperty(t.prototype,"isDisabled",{get:function(){return this.state.isBusy||this.actionItems.length===0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"actionItems",{get:function(){var r=[],n=this.plugin.managers.structure.focus.history;n.length>0&&r.push(Ft([er.Header("History",{description:"Previously focused on items."})],er.createItems(n,{label:function(u){return u.label},description:function(u){return u.category&&u.label!==u.category?u.category+" | "+u.label:u.label}})));var i=this.getSelectionItems(this.plugin.managers.structure.hierarchy.selection.structures);if(i.length===1){var a=i[0],o=a[0];o.initiallyExpanded=!0}var s=[];return i.length>0&&s.push.apply(s,i),r.length>0&&s.push.apply(s,r),s},enumerable:!1,configurable:!0}),t.prototype.getToggleBindingLabel=function(){var r,n=this.plugin.state.behaviors.transforms.get(oE.id);if(!n)return"";var i=(r=n.params)===null||r===void 0?void 0:r.bindings.clickFocus;return!i||fr.isEmpty(i)?"":fr.formatTriggers(i)},t.prototype.render=function(){var r=this.plugin.managers.structure.focus.current,n=(r==null?void 0:r.label)||"Nothing Focused",i="Click to Center Camera";if(!r){i="Select focus using the menu";var a=this.getToggleBindingLabel();a&&(i+=`
or use '`+a+"' on element")}return T.jsxs(T.Fragment,{children:[T.jsxs("div",E({className:"msp-flex-row"},{children:[T.jsx(hr,E({noOverflow:!0,onClick:this.focusCamera,title:i,onMouseEnter:this.highlightCurrent,onMouseLeave:this.clearHighlights,disabled:this.isDisabled||!r,style:{textAlignLast:r?"left":void 0}},{children:n}),void 0),r&&T.jsx(Ht,{svg:Uk,onClick:this.clear,title:"Clear",className:"msp-form-control",flex:!0,disabled:this.isDisabled},void 0),T.jsx(Ai,{icon:aEe,title:"Select a focus target to center on an show its surroundings. Hold shift to focus on multiple targets.",toggle:this.toggleAction,isSelected:this.state.showAction,disabled:this.isDisabled,style:{flex:"0 0 40px",padding:0}},void 0)]}),void 0),this.state.showAction&&T.jsx(er,{items:this.actionItems,onSelect:this.selectAction},void 0)]},void 0)},t}(pr),jQe=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.item=function(n){var i,a,o,s,u,l,c,d,f,h=r.plugin.managers.structure.hierarchy.seletionSet,v;switch(n.kind){case"model":{var p=(i=n.cell.obj)===null||i===void 0?void 0:i.data;p&&Wt.TrajectoryInfo.get(p).size>1&&(v=((a=n.cell.obj)===null||a===void 0?void 0:a.data.entryId)+" | Model "+(Wt.TrajectoryInfo.get(p).index+1)+" of "+Wt.TrajectoryInfo.get(p).size),v=((o=n.cell.obj)===null||o===void 0?void 0:o.data.entryId)+" | "+((s=n.cell.obj)===null||s===void 0?void 0:s.label);break}case"structure":{var p=(u=n.cell.obj)===null||u===void 0?void 0:u.data.models[0];if(p&&Wt.TrajectoryInfo.get(p).size>1){v=p.entryId+" | "+((l=n.cell.obj)===null||l===void 0?void 0:l.label)+" (Model "+(Wt.TrajectoryInfo.get(p).index+1)+" of "+Wt.TrajectoryInfo.get(p).size+")";break}else if(p){v=p.entryId+" | "+((c=n.cell.obj)===null||c===void 0?void 0:c.label);break}else{v=""+((d=n.cell.obj)===null||d===void 0?void 0:d.label);break}}default:v=(f=n.cell.obj)===null||f===void 0?void 0:f.label;break}var m={kind:"item",label:v||n.kind,selected:h.has(n.cell.transform.ref),value:[n]};return m},r.getTrajectoryItems=function(n){var i;return n.models.length===0?r.item(n):Ft([er.Header((i=n.cell.obj)===null||i===void 0?void 0:i.label)],n.models.map(r.getModelItems))},r.getModelItems=function(n){var i,a,o;if(n.structures.length===0)return r.item(n);if(n.structures.length===1){var s=r.plugin.managers.structure.hierarchy.seletionSet,u=n.structures[0];return{label:((i=n.cell.obj)===null||i===void 0?void 0:i.label)+" | "+((a=u.cell.obj)===null||a===void 0?void 0:a.label),selected:s.has(u.cell.transform.ref),value:[n,u]}}return Ft([er.Header((o=n.cell.obj)===null||o===void 0?void 0:o.label)],n.structures.map(r.item))},r.selectHierarchy=function(n){if(!(!n||n.length===0)){for(var i=[],a=0,o=n;a<o.length;a++)for(var s=o[a],u=0,l=s.value;u<l.length;u++){var c=l[u];i.push(c)}r.plugin.managers.structure.hierarchy.updateCurrent(i,n[0].selected?"remove":"add")}},r.toggleHierarchy=function(){return r.setState({show:r.state.show!=="hierarchy"?"hierarchy":void 0})},r.togglePreset=function(){return r.setState({show:r.state.show!=="presets"?"presets":void 0})},r.applyPreset=function(n){if(r.setState({show:void 0}),!!n){var i=r.plugin.managers.structure,a=i.hierarchy.selection.trajectories;i.hierarchy.applyPreset(a,n.value)}},r.updateModelQueueParams=void 0,r.isUpdatingModel=!1,r.updateStructureModel=function(n){r.updateModelQueueParams=n,r._updateStructureModel()},r.updateStructure=function(n){var i=r.plugin.managers.structure.hierarchy.selection,a=i.structures[0];return r.plugin.managers.structure.hierarchy.updateStructure(a,n)},r}return t.prototype.defaultState=function(){return{header:"Structure",isCollapsed:!1,isBusy:!1,brand:{accent:"purple",svg:D3e}}},t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.managers.structure.hierarchy.behaviors.selection,function(){return r.forceUpdate()}),this.subscribe(this.plugin.behaviors.state.isBusy,function(n){r.setState({isBusy:n})})},Object.defineProperty(t.prototype,"hierarchyItems",{get:function(){var r=this.plugin.managers.structure.hierarchy,n=r.current,i=[];return n.trajectories.length>1&&i.push(Ft([er.Header("Trajectories")],n.trajectories.map(this.item))),(n.models.length>1||n.trajectories.length>1)&&i.push(Ft([er.Header("Models")],n.models.map(this.item))),n.trajectories.length===1&&n.models.length===1?i.push.apply(i,n.structures.map(this.item)):n.structures.length>0&&i.push(Ft([er.Header("Structures")],n.structures.map(this.item))),i},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isEmpty",{get:function(){var r=this.plugin.managers.structure.hierarchy.current,n=r.structures,i=r.models,a=r.trajectories;return a.length===0&&i.length===0&&n.length===0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"label",{get:function(){var r,n,i,a,o,s,u,l,c,d,f,h,v,p,m=this.plugin.managers.structure.hierarchy.selection,g=m.structures,y=m.models,b=m.trajectories;if(g.length===1){var S=g[0];return!((n=(r=S.model)===null||r===void 0?void 0:r.trajectory)===null||n===void 0)&&n.models&&S.model.trajectory.models.length===1?(i=S.cell.obj)===null||i===void 0?void 0:i.data.label:S.model?((a=S.model.cell.obj)===null||a===void 0?void 0:a.label)+" | "+((o=S.cell.obj)===null||o===void 0?void 0:o.data.label):(s=S.cell.obj)===null||s===void 0?void 0:s.data.label}if(g.length>1){for(var x=g[0],C=(u=x==null?void 0:x.model)===null||u===void 0?void 0:u.trajectory,w=!0,A=0,M=g;A<M.length;A++){var S=M[A];if(((l=S==null?void 0:S.model)===null||l===void 0?void 0:l.trajectory)!==C){w=!1;break}}return w&&C?((c=C.cell.obj)===null||c===void 0?void 0:c.label)+" | "+g.length+" structures":g.length+" structures"}if(y.length>0){var C=y[0].trajectory;if(y.length===1){var D=(d=y[0].cell.obj)===null||d===void 0?void 0:d.data;return D&&Wt.TrajectoryInfo.get(D).size>1?((f=C==null?void 0:C.cell.obj)===null||f===void 0?void 0:f.label)+" | Model "+(Wt.TrajectoryInfo.get(D).index+1)+" of "+Wt.TrajectoryInfo.get(D).size:((h=C==null?void 0:C.cell.obj)===null||h===void 0?void 0:h.label)+" | Model"}for(var w=!0,k=0,R=y;k<R.length;k++){var L=R[k];if(L.trajectory!==C){w=!1;break}}return w?((v=C==null?void 0:C.cell.obj)===null||v===void 0?void 0:v.label)+" | "+y.length+" models":y.length+" models"}return b.length>0?b.length===1?((p=b[0].cell.obj)===null||p===void 0?void 0:p.label)+" trajectory":b.length+" trajectories":b.length===0&&y.length===0&&g.length===0?"Nothing Loaded":"Nothing Selected"},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"presetActions",{get:function(){var r=[],n=this.plugin.managers.structure.hierarchy.selection.trajectories;if(n.length===0)return r;var i=this.plugin.builders.structure.hierarchy.getPresets(n[0].cell.obj);if(n.length>1){for(var a=new Set(i),o=1;o<n.length;o++)for(var s=this.plugin.builders.structure.hierarchy.getPresets(n[o].cell.obj),u=new Set(s),l=0,c=s;l<c.length;l++){var d=c[l];u.has(d)||a.delete(d)}i=i.filter(function(v){return a.has(v)})}for(var f=0,h=i;f<h.length;f++){var d=h[f];r.push(er.Item(d.display.name,d,{description:d.display.description}))}return r},enumerable:!1,configurable:!0}),t.prototype._updateStructureModel=function(){return ce(this,void 0,void 0,function(){var r,n,i;return de(this,function(a){switch(a.label){case 0:if(!this.updateModelQueueParams||this.isUpdatingModel)return[2];r=this.updateModelQueueParams,this.updateModelQueueParams=void 0,a.label=1;case 1:return a.trys.push([1,,3,4]),this.isUpdatingModel=!0,n=this.plugin.managers.structure.hierarchy.selection,i=n.structures[0].model,[4,this.plugin.state.updateTransform(this.plugin.state.data,i.cell.transform.ref,r,"Model Index")];case 2:return a.sent(),[3,4];case 3:return this.isUpdatingModel=!1,this._updateStructureModel(),[7];case 4:return[2]}})})},Object.defineProperty(t.prototype,"modelIndex",{get:function(){var r,n,i=this.plugin.managers.structure.hierarchy.selection;if(i.structures.length!==1)return null;var a=i.structures[0].model;if(!a||a.cell.transform.transformer!==rt.Model.ModelFromTrajectory||!a.cell.obj||Wt.TrajectoryInfo.get(a.cell.obj.data).size<=1)return null;var o=(r=a.cell.params)===null||r===void 0?void 0:r.definition;return o?T.jsx(On,{params:o,values:(n=a.cell.params)===null||n===void 0?void 0:n.values,onChangeValues:this.updateStructureModel,isDisabled:this.state.isBusy},void 0):null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"structureType",{get:function(){var r,n=this.plugin.managers.structure.hierarchy.selection;if(n.structures.length!==1)return null;var i=n.structures[0],a=(r=i.cell.params)===null||r===void 0?void 0:r.definition;return!a||!i.cell.parent?null:T.jsx(Wc,{state:i.cell.parent,transform:i.cell.transform,customHeader:"none",customUpdate:this.updateStructure,noMargin:!0,autoHideApply:!0},void 0)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"transform",{get:function(){var r=this.plugin.managers.structure.hierarchy.selection;if(r.structures.length!==1)return null;var n=r.structures[0];if(!n.cell.parent)return null;var i=ir.tryFindDecorator(this.plugin.state.data,n.cell.transform.ref,rt.Model.TransformStructureConformation);if(i)return T.jsx(Tu,E({header:"Conformation Transform"},{children:T.jsx(Wc,{state:i.parent,transform:i.transform,customHeader:"none",noMargin:!0,autoHideApply:!0},void 0)}),void 0)},enumerable:!1,configurable:!0}),t.prototype.renderControls=function(){var r=this.state.isBusy||this.isEmpty,n=this.presetActions,i=this.label;return T.jsxs(T.Fragment,{children:[T.jsxs("div",E({className:"msp-flex-row",style:{marginTop:"1px"}},{children:[T.jsx(hr,E({noOverflow:!0,flex:!0,onClick:this.toggleHierarchy,disabled:r,title:i},{children:i}),void 0),n.length>0&&T.jsx(Ht,{svg:p3,className:"msp-form-control",flex:"40px",onClick:this.togglePreset,title:"Apply a structure presets to the current hierarchy.",toggleState:this.state.show==="presets",disabled:r},void 0)]}),void 0),this.state.show==="hierarchy"&&T.jsx(er,{items:this.hierarchyItems,onSelect:this.selectHierarchy,multiselect:!0},void 0),this.state.show==="presets"&&T.jsx(er,{items:n,onSelect:this.applyPreset},void 0),this.modelIndex,this.structureType,this.transform,T.jsxs("div",E({style:{marginTop:"6px"}},{children:[T.jsx(UQe,{},void 0),T.jsx(IQe,{hideOnEmpty:!0},void 0)]}),void 0)]},void 0)},t}(Wg);function zQe(e,t){var r=qQe(e,t||hL());return KQe(e.tree,r),t&&t.refs.forEach(XQe,r),{hierarchy:r.hierarchy,added:r.added,changed:r.changed}}function hL(){return{volumes:[],lazyVolumes:[],refs:new Map}}function VQe(e){return{kind:"volume",cell:e,version:e.transform.version,representations:[]}}function HQe(e){return{kind:"lazy-volume",cell:e,version:e.transform.version}}function GQe(e,t){return{kind:"volume-representation",cell:e,version:e.transform.version,volume:t}}function qQe(e,t){return{state:e,oldHierarchy:t,hierarchy:hL(),changed:!1,added:new Set}}function IT(e,t,r,n){for(var i=[],a=4;a<arguments.length;a++)i[a-4]=arguments[a];var o=n.apply(void 0,i);r.push(o),e.hierarchy.refs.set(t.transform.ref,o);var s=e.oldHierarchy.refs.get(t.transform.ref);return s?s.version!==t.transform.version&&(e.changed=!0):(e.added.add(o.cell.transform.ref),e.changed=!0),o}function WQe(e,t){return function(r,n){return!t(n)&&e.is(r.obj)}}function qz(){}var $Qe=[[WQe(ge.Volume.Data,function(e){return e.currentVolume}),function(e,t){e.currentVolume=IT(e,t,e.hierarchy.volumes,VQe,t)},function(e){return e.currentVolume=void 0}],[function(e){return ge.Volume.Lazy.is(e.obj)},function(e,t){IT(e,t,e.hierarchy.lazyVolumes,HQe,t)},qz],[function(e,t){return!e.state.isGhost&&!!t.currentVolume&&ge.Volume.Representation3D.is(e.obj)},function(e,t){return e.currentVolume&&IT(e,t,e.currentVolume.representations,GQe,t,e.currentVolume),!1},qz]];function Ote(e){if(!e||!(e!=null&&e.parent)||!e.parent.cells.has(e.transform.ref))return!1;var t=e.obj;return!(!t||t===In.Null||e.status!=="ok"&&e.status!=="error")}function XQe(e){var t=e.cell;Ote(t)||(this.changed=!0)}function YQe(e){Lte(this,this.tree.transforms.get(e))}function Lte(e,t){var r=e.state,n=r.state.cells.get(t.ref);if(Ote(n)){for(var i=void 0,a=!1,o=0,s=$Qe;o<s.length;o++){var u=s[o],l=u[0],c=u[1],d=u[2];if(l(n,r)){var f=c(r,n);if(f===!1){a=!0;break}i=d;break}}if(!a){var h=e.tree.children.get(t.ref);h&&h.size&&h.forEach(YQe,e),i&&i(r)}}}function KQe(e,t){var r={tree:e,state:t};return Lte(r,e.root),r.state}function Jm(e,t,r){r===void 0&&(r={});var n=r;return typeof n.type=="string"||typeof n.color=="string"||typeof n.size=="string"?QQe(e,t||Ct.One,r):Nte(e,t||Ct.One,r)}function QQe(e,t,r){var n=r.type&&e.representation.volume.registry.get(r.type)||e.representation.volume.registry.default.provider,i=r.color&&e.representation.volume.themes.colorThemeRegistry.get(r.color)||e.representation.volume.themes.colorThemeRegistry.get(n.defaultColorTheme.name),a=r.size&&e.representation.volume.themes.sizeThemeRegistry.get(r.size)||e.representation.volume.themes.sizeThemeRegistry.get(n.defaultSizeTheme.name);return Nte(e,t,{type:n,typeParams:r.typeParams,color:i,colorParams:r.colorParams,size:a,sizeParams:r.sizeParams})}function Nte(e,t,r){r===void 0&&(r={});var n=e.representation.volume.themes,i={volume:t},a=r.type||e.representation.volume.registry.default.provider,o=I.getDefaultValues(a.getParams(n,t)),s=Object.assign(o,r.typeParams),u=r.color||n.colorThemeRegistry.get(a.defaultColorTheme.name),l=I.getDefaultValues(u.getParams(i));u.name===a.defaultColorTheme.name&&Object.assign(l,a.defaultColorTheme.props);var c=Object.assign(l,r.colorParams),d=r.size||n.sizeThemeRegistry.get(a.defaultSizeTheme.name),f=I.getDefaultValues(d.getParams(i));d.name===a.defaultSizeTheme.name&&Object.assign(f,a.defaultSizeTheme.props);var h=Object.assign(f,r.sizeParams);return{type:{name:a.name,params:s},colorTheme:{name:u.name,params:c},sizeTheme:{name:d.name,params:h}}}var B_=function(e){Le(t,e);function t(r){var n=e.call(this)||this;return n.plugin=r,n.state={syncedTree:n.dataState.tree,notified:!1,hierarchy:hL(),selection:void 0},n.behaviors={selection:n.ev.behavior({hierarchy:n.current,volume:n.selection})},n.subscribe(r.state.data.events.changed,function(i){i.inTransaction||r.behaviors.state.isAnimating.value||n.sync(!0)}),n.subscribe(r.behaviors.state.isAnimating,function(i){!i&&!r.behaviors.state.isUpdating.value&&n.sync(!0)}),n}return Object.defineProperty(t.prototype,"dataState",{get:function(){return this.plugin.state.data},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"current",{get:function(){return this.sync(!1),this.state.hierarchy},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"selection",{get:function(){return this.sync(!1),this.state.selection},enumerable:!1,configurable:!0}),t.prototype.sync=function(r){if(!(!r&&this.dataState.inUpdate)){if(this.state.syncedTree===this.dataState.tree){r&&!this.state.notified&&(this.state.notified=!0,this.behaviors.selection.next({hierarchy:this.state.hierarchy,volume:this.state.selection}));return}this.state.syncedTree=this.dataState.tree;var n=zQe(this.plugin.state.data,this.current);if(n.changed){var i=n.hierarchy;this.state.hierarchy=i,this.state.selection?this.state.selection=i.refs.has(this.state.selection.cell.transform.ref)?i.refs.get(this.state.selection.cell.transform.ref):i.volumes[0]:this.state.selection=i.volumes[0],r?(this.state.notified=!0,this.behaviors.selection.next({hierarchy:i,volume:this.state.selection})):this.state.notified=!1}}},t.prototype.setCurrent=function(r){this.state.selection=r||this.state.hierarchy.volumes[0],this.behaviors.selection.next({hierarchy:this.state.hierarchy,volume:r||this.state.hierarchy.volumes[0]})},t.prototype.remove=function(r,n){if(r.length!==0){for(var i=this.plugin.state.data.build(),a=0,o=r;a<o.length;a++){var s=o[a];i.delete(typeof s=="string"?s:s.cell.transform.ref)}return i.commit({canUndo:n?"Remove":!1})}},t.prototype.toggleVisibility=function(r,n){if(r.length!==0)for(var i=n!==void 0?n!=="show":!r[0].cell.state.isHidden,a=0,o=r;a<o.length;a++){var s=o[a];ev(this.dataState,s.cell.transform.ref,i)}},t.prototype.addRepresentation=function(r,n){var i,a=this.dataState.build().to(r.cell).apply(rt.Representation.VolumeRepresentation3D,Jm(this.plugin,(i=r.cell.obj)===null||i===void 0?void 0:i.data,{type:n}));return a.commit({canUndo:"Add Representation"})},t}(Bb);(function(e){function t(r,n){var i,a;return!((i=n==null?void 0:n.cell.obj)===null||i===void 0)&&i.data?r.representation.volume.registry.getApplicableTypes((a=n.cell.obj)===null||a===void 0?void 0:a.data):r.representation.volume.registry.types}e.getRepresentationTypes=t})(B_||(B_={}));var fD=function(e){Le(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t}(ge.Create({name:"Volume Streaming",typeClass:"Object"})),Wz;(function(e){(function(t){t.Float32="float32",t.Int8="int8"})(e.ValueType||(e.ValueType={}))})(Wz||(Wz={}));function ZQe(e,t){if(t===void 0&&(t="x-ray"),!e)return t;var r=e.models[0];return tn.is(r.sourceData)?Wt.hasEmMap(r)?"em":Wt.hasXrayMap(r)?"x-ray":Wt.isFromEm(r)?"em":Wt.isFromXray(r)?"x-ray":t:t}function JQe(e){var t=[];if(!tn.is(e.sourceData))return[e.entryId];var r=e.sourceData.data.db.pdbx_database_related,n=r.db_id,i=r.db_name,a=r.content_type;if(!i.isDefined)return[e.entryId];for(var o=0,s=i.rowCount;o<s;++o)i.value(o).toUpperCase()==="EMDB"&&a.value(o)==="associated EM volume"&&t.push(n.value(o));return t}function eZe(e){return[e.entryId]}function tZe(e,t){if(!t||!t.models.length)return[];var r=t.models[0];switch(e){case"em":return JQe(r);case"x-ray":return eZe(r)}}function $z(e,t,r,n){return ce(this,void 0,void 0,function(){return de(this,function(i){switch(e){case"emdb":return[2,Fte(t,r,n)];case"pdbe":return[2,rZe(t,r,n)]}return[2]})})}function Fte(e,t,r){return ce(this,void 0,void 0,function(){var n,i,a,o;return de(this,function(s){switch(s.label){case 0:return n=e.config.get(Wr.VolumeStreaming.EmdbHeaderServer),[4,e.fetch({url:n+"/"+r.toUpperCase()+"/header/"+r.toLowerCase()+".xml",type:"xml"}).runInContext(t)];case 1:return i=s.sent(),a=i.getElementsByTagName("map")[0],o=parseFloat(a.getElementsByTagName("contourLevel")[0].textContent),[2,o]}})})}function rZe(e,t,r){var n,i,a,o;return ce(this,void 0,void 0,function(){var s,u;return de(this,function(l){switch(l.label){case 0:return r=r.toUpperCase(),[4,e.fetch({url:"https://www.ebi.ac.uk/emdb/api/entry/map/"+r,type:"json"}).runInContext(t)];case 1:return s=l.sent(),u=(i=(n=s==null?void 0:s.map)===null||n===void 0?void 0:n.contour_list)===null||i===void 0?void 0:i.contour,!u||u.length===0?[2,nZe(e,t,r)]:[2,(o=(a=u.find(function(c){return c.primary}))===null||a===void 0?void 0:a.level)!==null&&o!==void 0?o:u[0].level]}})})}function nZe(e,t,r){var n,i,a;return ce(this,void 0,void 0,function(){var o,s,u;return de(this,function(l){switch(l.label){case 0:return r=r.toUpperCase(),[4,e.fetch({url:"https://www.ebi.ac.uk/pdbe/api/emdb/entry/map/"+r,type:"json"}).runInContext(t)];case 1:return o=l.sent(),s=o==null?void 0:o[r],u=void 0,((a=(i=(n=s==null?void 0:s[0])===null||n===void 0?void 0:n.map)===null||i===void 0?void 0:i.contour_level)===null||a===void 0?void 0:a.value)!==void 0&&(u=+s[0].map.contour_level.value),[2,u]}})})}function iZe(e,t,r){var n;return ce(this,void 0,void 0,function(){var i,a,o,s;return de(this,function(u){switch(u.label){case 0:return[4,e.fetch({url:"https://www.ebi.ac.uk/pdbe/api/pdb/entry/summary/"+r,type:"json"}).runInContext(t)];case 1:if(i=u.sent(),a=i==null?void 0:i[r],o=[],!((n=a==null?void 0:a[0])===null||n===void 0)&&n.related_structures){if(s=a[0].related_structures.filter(function(l){return l.resource==="EMDB"&&l.relationship==="associated EM volume"}),!s.length)throw new Error("No related EMDB entry found for '"+r+"'.");o.push.apply(o,s.map(function(l){return l.accession}))}else throw new Error("No related EMDB entry found for '"+r+"'.");return[2,o]}})})}function kd(e,t,r){return{i:e,j:t,k:r}}function ds(e,t){return{a:e,b:t}}var Xn=[kd(0,0,0),kd(1,0,0),kd(1,1,0),kd(0,1,0),kd(0,0,1),kd(1,0,1),kd(1,1,1),kd(0,1,1)],aZe=[ds(Xn[0],Xn[1]),ds(Xn[1],Xn[2]),ds(Xn[2],Xn[3]),ds(Xn[3],Xn[0]),ds(Xn[4],Xn[5]),ds(Xn[5],Xn[6]),ds(Xn[6],Xn[7]),ds(Xn[7],Xn[4]),ds(Xn[0],Xn[4]),ds(Xn[1],Xn[5]),ds(Xn[2],Xn[6]),ds(Xn[3],Xn[7])],oZe=[{i:0,j:0,k:0,e:0},{i:1,j:0,k:0,e:1},{i:0,j:1,k:0,e:0},{i:0,j:0,k:0,e:1},{i:0,j:0,k:1,e:0},{i:1,j:0,k:1,e:1},{i:0,j:1,k:1,e:0},{i:0,j:0,k:1,e:1},{i:0,j:0,k:0,e:2},{i:1,j:0,k:0,e:2},{i:1,j:1,k:0,e:2},{i:0,j:1,k:0,e:2}],sZe=[0,265,515,778,1030,1295,1541,1804,2060,2309,2575,2822,3082,3331,3593,3840,400,153,915,666,1430,1183,1941,1692,2460,2197,2975,2710,3482,3219,3993,3728,560,825,51,314,1590,1855,1077,1340,2620,2869,2111,2358,3642,3891,3129,3376,928,681,419,170,1958,1711,1445,1196,2988,2725,2479,2214,4010,3747,3497,3232,1120,1385,1635,1898,102,367,613,876,3180,3429,3695,3942,2154,2403,2665,2912,1520,1273,2035,1786,502,255,1013,764,3580,3317,4095,3830,2554,2291,3065,2800,1616,1881,1107,1370,598,863,85,348,3676,3925,3167,3414,2650,2899,2137,2384,1984,1737,1475,1226,966,719,453,204,4044,3781,3535,3270,3018,2755,2505,2240,2240,2505,2755,3018,3270,3535,3781,4044,204,453,719,966,1226,1475,1737,1984,2384,2137,2899,2650,3414,3167,3925,3676,348,85,863,598,1370,1107,1881,1616,2800,3065,2291,2554,3830,4095,3317,3580,764,1013,255,502,1786,2035,1273,1520,2912,2665,2403,2154,3942,3695,3429,3180,876,613,367,102,1898,1635,1385,1120,3232,3497,3747,4010,2214,2479,2725,2988,1196,1445,1711,1958,170,419,681,928,3376,3129,3891,3642,2358,2111,2869,2620,1340,1077,1855,1590,314,51,825,560,3728,3993,3219,3482,2710,2975,2197,2460,1692,1941,1183,1430,666,915,153,400,3840,3593,3331,3082,2822,2575,2309,2060,1804,1541,1295,1030,778,515,265,0],eg=[[],[0,8,3],[0,1,9],[1,8,3,9,8,1],[1,2,10],[0,8,3,1,2,10],[9,2,10,0,2,9],[2,8,3,2,10,8,10,9,8],[3,11,2],[0,11,2,8,11,0],[1,9,0,2,3,11],[1,11,2,1,9,11,9,8,11],[3,10,1,11,10,3],[0,10,1,0,8,10,8,11,10],[3,9,0,3,11,9,11,10,9],[9,8,10,10,8,11],[4,7,8],[4,3,0,7,3,4],[0,1,9,8,4,7],[4,1,9,4,7,1,7,3,1],[1,2,10,8,4,7],[3,4,7,3,0,4,1,2,10],[9,2,10,9,0,2,8,4,7],[2,10,9,2,9,7,2,7,3,7,9,4],[8,4,7,3,11,2],[11,4,7,11,2,4,2,0,4],[9,0,1,8,4,7,2,3,11],[4,7,11,9,4,11,9,11,2,9,2,1],[3,10,1,3,11,10,7,8,4],[1,11,10,1,4,11,1,0,4,7,11,4],[4,7,8,9,0,11,9,11,10,11,0,3],[4,7,11,4,11,9,9,11,10],[9,5,4],[9,5,4,0,8,3],[0,5,4,1,5,0],[8,5,4,8,3,5,3,1,5],[1,2,10,9,5,4],[3,0,8,1,2,10,4,9,5],[5,2,10,5,4,2,4,0,2],[2,10,5,3,2,5,3,5,4,3,4,8],[9,5,4,2,3,11],[0,11,2,0,8,11,4,9,5],[0,5,4,0,1,5,2,3,11],[2,1,5,2,5,8,2,8,11,4,8,5],[10,3,11,10,1,3,9,5,4],[4,9,5,0,8,1,8,10,1,8,11,10],[5,4,0,5,0,11,5,11,10,11,0,3],[5,4,8,5,8,10,10,8,11],[9,7,8,5,7,9],[9,3,0,9,5,3,5,7,3],[0,7,8,0,1,7,1,5,7],[1,5,3,3,5,7],[9,7,8,9,5,7,10,1,2],[10,1,2,9,5,0,5,3,0,5,7,3],[8,0,2,8,2,5,8,5,7,10,5,2],[2,10,5,2,5,3,3,5,7],[7,9,5,7,8,9,3,11,2],[9,5,7,9,7,2,9,2,0,2,7,11],[2,3,11,0,1,8,1,7,8,1,5,7],[11,2,1,11,1,7,7,1,5],[9,5,8,8,5,7,10,1,3,10,3,11],[5,7,0,5,0,9,7,11,0,1,0,10,11,10,0],[11,10,0,11,0,3,10,5,0,8,0,7,5,7,0],[11,10,5,7,11,5],[10,6,5],[0,8,3,5,10,6],[9,0,1,5,10,6],[1,8,3,1,9,8,5,10,6],[1,6,5,2,6,1],[1,6,5,1,2,6,3,0,8],[9,6,5,9,0,6,0,2,6],[5,9,8,5,8,2,5,2,6,3,2,8],[2,3,11,10,6,5],[11,0,8,11,2,0,10,6,5],[0,1,9,2,3,11,5,10,6],[5,10,6,1,9,2,9,11,2,9,8,11],[6,3,11,6,5,3,5,1,3],[0,8,11,0,11,5,0,5,1,5,11,6],[3,11,6,0,3,6,0,6,5,0,5,9],[6,5,9,6,9,11,11,9,8],[5,10,6,4,7,8],[4,3,0,4,7,3,6,5,10],[1,9,0,5,10,6,8,4,7],[10,6,5,1,9,7,1,7,3,7,9,4],[6,1,2,6,5,1,4,7,8],[1,2,5,5,2,6,3,0,4,3,4,7],[8,4,7,9,0,5,0,6,5,0,2,6],[7,3,9,7,9,4,3,2,9,5,9,6,2,6,9],[3,11,2,7,8,4,10,6,5],[5,10,6,4,7,2,4,2,0,2,7,11],[0,1,9,4,7,8,2,3,11,5,10,6],[9,2,1,9,11,2,9,4,11,7,11,4,5,10,6],[8,4,7,3,11,5,3,5,1,5,11,6],[5,1,11,5,11,6,1,0,11,7,11,4,0,4,11],[0,5,9,0,6,5,0,3,6,11,6,3,8,4,7],[6,5,9,6,9,11,4,7,9,7,11,9],[10,4,9,6,4,10],[4,10,6,4,9,10,0,8,3],[10,0,1,10,6,0,6,4,0],[8,3,1,8,1,6,8,6,4,6,1,10],[1,4,9,1,2,4,2,6,4],[3,0,8,1,2,9,2,4,9,2,6,4],[0,2,4,4,2,6],[8,3,2,8,2,4,4,2,6],[10,4,9,10,6,4,11,2,3],[0,8,2,2,8,11,4,9,10,4,10,6],[3,11,2,0,1,6,0,6,4,6,1,10],[6,4,1,6,1,10,4,8,1,2,1,11,8,11,1],[9,6,4,9,3,6,9,1,3,11,6,3],[8,11,1,8,1,0,11,6,1,9,1,4,6,4,1],[3,11,6,3,6,0,0,6,4],[6,4,8,11,6,8],[7,10,6,7,8,10,8,9,10],[0,7,3,0,10,7,0,9,10,6,7,10],[10,6,7,1,10,7,1,7,8,1,8,0],[10,6,7,10,7,1,1,7,3],[1,2,6,1,6,8,1,8,9,8,6,7],[2,6,9,2,9,1,6,7,9,0,9,3,7,3,9],[7,8,0,7,0,6,6,0,2],[7,3,2,6,7,2],[2,3,11,10,6,8,10,8,9,8,6,7],[2,0,7,2,7,11,0,9,7,6,7,10,9,10,7],[1,8,0,1,7,8,1,10,7,6,7,10,2,3,11],[11,2,1,11,1,7,10,6,1,6,7,1],[8,9,6,8,6,7,9,1,6,11,6,3,1,3,6],[0,9,1,11,6,7],[7,8,0,7,0,6,3,11,0,11,6,0],[7,11,6],[7,6,11],[3,0,8,11,7,6],[0,1,9,11,7,6],[8,1,9,8,3,1,11,7,6],[10,1,2,6,11,7],[1,2,10,3,0,8,6,11,7],[2,9,0,2,10,9,6,11,7],[6,11,7,2,10,3,10,8,3,10,9,8],[7,2,3,6,2,7],[7,0,8,7,6,0,6,2,0],[2,7,6,2,3,7,0,1,9],[1,6,2,1,8,6,1,9,8,8,7,6],[10,7,6,10,1,7,1,3,7],[10,7,6,1,7,10,1,8,7,1,0,8],[0,3,7,0,7,10,0,10,9,6,10,7],[7,6,10,7,10,8,8,10,9],[6,8,4,11,8,6],[3,6,11,3,0,6,0,4,6],[8,6,11,8,4,6,9,0,1],[9,4,6,9,6,3,9,3,1,11,3,6],[6,8,4,6,11,8,2,10,1],[1,2,10,3,0,11,0,6,11,0,4,6],[4,11,8,4,6,11,0,2,9,2,10,9],[10,9,3,10,3,2,9,4,3,11,3,6,4,6,3],[8,2,3,8,4,2,4,6,2],[0,4,2,4,6,2],[1,9,0,2,3,4,2,4,6,4,3,8],[1,9,4,1,4,2,2,4,6],[8,1,3,8,6,1,8,4,6,6,10,1],[10,1,0,10,0,6,6,0,4],[4,6,3,4,3,8,6,10,3,0,3,9,10,9,3],[10,9,4,6,10,4],[4,9,5,7,6,11],[0,8,3,4,9,5,11,7,6],[5,0,1,5,4,0,7,6,11],[11,7,6,8,3,4,3,5,4,3,1,5],[9,5,4,10,1,2,7,6,11],[6,11,7,1,2,10,0,8,3,4,9,5],[7,6,11,5,4,10,4,2,10,4,0,2],[3,4,8,3,5,4,3,2,5,10,5,2,11,7,6],[7,2,3,7,6,2,5,4,9],[9,5,4,0,8,6,0,6,2,6,8,7],[3,6,2,3,7,6,1,5,0,5,4,0],[6,2,8,6,8,7,2,1,8,4,8,5,1,5,8],[9,5,4,10,1,6,1,7,6,1,3,7],[1,6,10,1,7,6,1,0,7,8,7,0,9,5,4],[4,0,10,4,10,5,0,3,10,6,10,7,3,7,10],[7,6,10,7,10,8,5,4,10,4,8,10],[6,9,5,6,11,9,11,8,9],[3,6,11,0,6,3,0,5,6,0,9,5],[0,11,8,0,5,11,0,1,5,5,6,11],[6,11,3,6,3,5,5,3,1],[1,2,10,9,5,11,9,11,8,11,5,6],[0,11,3,0,6,11,0,9,6,5,6,9,1,2,10],[11,8,5,11,5,6,8,0,5,10,5,2,0,2,5],[6,11,3,6,3,5,2,10,3,10,5,3],[5,8,9,5,2,8,5,6,2,3,8,2],[9,5,6,9,6,0,0,6,2],[1,5,8,1,8,0,5,6,8,3,8,2,6,2,8],[1,5,6,2,1,6],[1,3,6,1,6,10,3,8,6,5,6,9,8,9,6],[10,1,0,10,0,6,9,5,0,5,6,0],[0,3,8,5,6,10],[10,5,6],[11,5,10,7,5,11],[11,5,10,11,7,5,8,3,0],[5,11,7,5,10,11,1,9,0],[10,7,5,10,11,7,9,8,1,8,3,1],[11,1,2,11,7,1,7,5,1],[0,8,3,1,2,7,1,7,5,7,2,11],[9,7,5,9,2,7,9,0,2,2,11,7],[7,5,2,7,2,11,5,9,2,3,2,8,9,8,2],[2,5,10,2,3,5,3,7,5],[8,2,0,8,5,2,8,7,5,10,2,5],[9,0,1,5,10,3,5,3,7,3,10,2],[9,8,2,9,2,1,8,7,2,10,2,5,7,5,2],[1,3,5,3,7,5],[0,8,7,0,7,1,1,7,5],[9,0,3,9,3,5,5,3,7],[9,8,7,5,9,7],[5,8,4,5,10,8,10,11,8],[5,0,4,5,11,0,5,10,11,11,3,0],[0,1,9,8,4,10,8,10,11,10,4,5],[10,11,4,10,4,5,11,3,4,9,4,1,3,1,4],[2,5,1,2,8,5,2,11,8,4,5,8],[0,4,11,0,11,3,4,5,11,2,11,1,5,1,11],[0,2,5,0,5,9,2,11,5,4,5,8,11,8,5],[9,4,5,2,11,3],[2,5,10,3,5,2,3,4,5,3,8,4],[5,10,2,5,2,4,4,2,0],[3,10,2,3,5,10,3,8,5,4,5,8,0,1,9],[5,10,2,5,2,4,1,9,2,9,4,2],[8,4,5,8,5,3,3,5,1],[0,4,5,1,0,5],[8,4,5,8,5,3,9,0,5,0,3,5],[9,4,5],[4,11,7,4,9,11,9,10,11],[0,8,3,4,9,7,9,11,7,9,10,11],[1,10,11,1,11,4,1,4,0,7,4,11],[3,1,4,3,4,8,1,10,4,7,4,11,10,11,4],[4,11,7,9,11,4,9,2,11,9,1,2],[9,7,4,9,11,7,9,1,11,2,11,1,0,8,3],[11,7,4,11,4,2,2,4,0],[11,7,4,11,4,2,8,3,4,3,2,4],[2,9,10,2,7,9,2,3,7,7,4,9],[9,10,7,9,7,4,10,2,7,8,7,0,2,0,7],[3,7,10,3,10,2,7,4,10,1,10,0,4,0,10],[1,10,2,8,7,4],[4,9,1,4,1,7,7,1,3],[4,9,1,4,1,7,0,8,1,8,7,1],[4,0,3,7,4,3],[4,8,7],[9,10,8,10,11,8],[3,0,9,3,9,11,11,9,10],[0,1,10,0,10,8,8,10,11],[3,1,10,11,3,10],[1,2,11,1,11,9,9,11,8],[3,0,9,3,9,11,1,2,9,2,11,9],[0,2,11,8,0,11],[3,2,11],[2,3,8,2,8,10,10,8,9],[9,10,2,0,9,2],[2,3,8,2,8,10,0,1,8,1,10,8],[1,10,2],[1,3,8,9,1,8],[0,9,1],[0,3,8],[]],MT=[[0,4,4,4,2,0,0,0,2,2,0,0],[4,0,4,4,0,8,0,0,0,8,8,0],[4,4,0,4,0,0,8,0,0,0,8,8],[4,4,4,0,0,0,0,1,1,0,0,1],[2,0,0,0,0,8,8,8,2,2,0,0],[0,8,0,0,8,0,8,8,0,8,8,0],[0,0,8,0,8,8,0,8,0,0,8,8],[0,0,0,1,8,8,8,0,1,0,0,1],[2,0,0,1,2,0,0,1,0,2,0,1],[2,8,0,0,2,8,0,0,2,0,8,0],[0,8,8,0,0,8,8,0,0,8,0,8],[0,0,8,1,0,0,8,1,1,0,8,0]];function uZe(e,t){var r=Math.min(65536,e*4),n=qe.create(Float32Array,3,e,t&&t.vertexBuffer.ref.value),i=qe.create(Float32Array,3,e,t&&t.normalBuffer.ref.value),a=qe.create(Float32Array,1,e,t&&t.groupBuffer.ref.value),o=qe.create(Uint32Array,3,r,t&&t.indexBuffer.ref.value),s=0,u=0;return{addVertex:function(l,c,d){return++s,qe.add3(n,l,c,d)},addNormal:function(l,c,d){qe.add3(i,l,c,d)},addGroup:function(l){qe.add(a,l)},addTriangle:function(l,c,d,f){var h=l[c],v=l[d],p=l[f];h>=0&&v>=0&&p>=0&&(++u,qe.add3(o,h,v,p))},get:function(){var l=qe.compact(n,!0),c=qe.compact(i,!0),d=qe.compact(o,!0),f=qe.compact(a,!0);return Nt.create(l,d,c,f,s,u,t)}}}function lZe(e,t){var r=qe.create(Float32Array,3,e),n=qe.create(Float32Array,1,e),i=qe.create(Float32Array,2,e),a=0;return{addVertex:function(o,s,u){return qe.add3(r,o,s,u)},addNormal:function(){return ef},addGroup:function(o){qe.add(n,o)},addTriangle:function(o,s,u,l,c){var d=o[s],f=o[u],h=o[l];d>=0&&f>=0&&h>=0&&(MT[s][u]&c&&(++a,qe.add2(i,o[s],o[u])),MT[u][l]&c&&(++a,qe.add2(i,o[u],o[l])),MT[s][l]&c&&(++a,qe.add2(i,o[s],o[l])))},get:function(){for(var o=qe.compact(r,!0),s=qe.compact(i,!0),u=qe.compact(n,!0),l=Zo.create(a,a/10,t),c=0;c<a;++c){var d=s[c*2],f=s[c*2+1];l.add(o[d*3],o[d*3+1],o[d*3+2],o[f*3],o[f*3+1],o[f*3+2],u[d])}return l.getLines()}}}function Bte(e){return E(E({},e),{bottomLeft:Ei(e.bottomLeft,[0,0,0]),topRight:Ei(e.topRight,e.scalarField.space.dimensions)})}function Ute(e){return{dX:e.topRight[0]-e.bottomLeft[0],dY:e.topRight[1]-e.bottomLeft[1],dZ:e.topRight[2]-e.bottomLeft[2]}}function uE(e,t){var r=this;return We.create("Marching Cubes Mesh",function(n){return ce(r,void 0,void 0,function(){var i,a,o,s,u,l,c;return de(this,function(d){switch(d.label){case 0:return i=Bte(e),a=Ute(i),o=a.dX,s=a.dY,u=a.dZ,l=Math.min(262144,Math.max(o*s*u/32,1024)),c=uZe(l,t),[4,new jte(n,c,i).run()];case 1:return d.sent(),[2,c.get()]}})})})}function pL(e,t){var r=this;return We.create("Marching Cubes Lines",function(n){return ce(r,void 0,void 0,function(){var i,a,o,s,u,l,c;return de(this,function(d){switch(d.label){case 0:return i=Bte(e),a=Ute(i),o=a.dX,s=a.dY,u=a.dZ,l=Math.min(262144,Math.max(o*s*u/32,1024)),c=lZe(l,t),[4,new jte(n,c,i).run()];case 1:return d.sent(),[2,c.get()]}})})})}var jte=function(){function e(t,r,n){this.ctx=t,this.minX=0,this.minY=0,this.minZ=0,this.maxX=0,this.maxY=0,this.maxZ=0,this.state=new cZe(r,n),this.minX=n.bottomLeft[0],this.minY=n.bottomLeft[1],this.minZ=n.bottomLeft[2],this.maxX=n.topRight[0]-1,this.maxY=n.topRight[1]-1,this.maxZ=n.topRight[2]-1,this.size=(this.maxX-this.minX)*(this.maxY-this.minY)*(this.maxZ-this.minZ),this.sliceSize=(this.maxX-this.minX)*(this.maxY-this.minY)}return e.prototype.doSlices=function(){return ce(this,void 0,void 0,function(){var t,r;return de(this,function(n){switch(n.label){case 0:t=0,this.edgeFilter=15,r=this.minZ,n.label=1;case 1:return r<this.maxZ?(this.slice(r),t+=this.sliceSize,this.ctx.shouldUpdate?[4,this.ctx.update({message:"Computing surface...",current:t,max:this.size})]:[3,3]):[3,4];case 2:n.sent(),n.label=3;case 3:return r++,this.edgeFilter&=-5,[3,1];case 4:return[2]}})})},e.prototype.slice=function(t){this.edgeFilter|=2;for(var r=this.minY;r<this.maxY;r++,this.edgeFilter&=-3){this.edgeFilter|=1;for(var n=this.minX;n<this.maxX;n++,this.edgeFilter&=-2)this.state.processCell(n,r,t,this.edgeFilter)}this.state.clearEdgeVertexIndexSlice(t)},e.prototype.run=function(){return ce(this,void 0,void 0,function(){return de(this,function(t){switch(t.label){case 0:return[4,this.doSlices()];case 1:return t.sent(),[2]}})})},e}(),cZe=function(){function e(t,r){this.builder=t,this.vertList=[0,0,0,0,0,0,0,0,0,0,0,0],this.i=0,this.j=0,this.k=0;var n=r.scalarField.space.dimensions;this.nX=n[0],this.nY=n[1],this.nZ=n[2],this.isoLevel=r.isoLevel,this.scalarFieldGet=r.scalarField.space.get,this.scalarField=r.scalarField.data,r.idField&&(this.idField=r.idField.data,this.idFieldGet=r.idField.space.get),this.verticesOnEdges=new Int32Array(3*this.nX*this.nY*2)}return e.prototype.get3dOffsetFromEdgeInfo=function(t){return this.nX*((this.k+t.k)%2*this.nY+this.j+t.j)+this.i+t.i},e.prototype.clearEdgeVertexIndexSlice=function(t){var r=t%2===0?0:3*this.nX*this.nY,n=t%2===0?3*this.nX*this.nY:this.verticesOnEdges.length;this.verticesOnEdges.fill(0,r,n)},e.prototype.interpolate=function(t){var r=oZe[t],n=3*this.get3dOffsetFromEdgeInfo(r)+r.e,i=this.verticesOnEdges[n];if(i>0)return i-1;var a=this.scalarField,o=this.scalarFieldGet,s=aZe[t],u=s.a,l=s.b,c=u.i+this.i,d=u.j+this.j,f=u.k+this.k,h=l.i+this.i,v=l.j+this.j,p=l.k+this.k,m=o(a,c,d,f),g=o(a,h,v,p),y=(this.isoLevel-m)/(m-g);if(this.idField){var b=this.idFieldGet(this.idField,c,d,f),S=this.idFieldGet(this.idField,h,v,p),x=y<.5?b:S;if(x===-1&&(x=y<.5?S:b),x===-2)return-1;this.builder.addGroup(x)}else this.builder.addGroup(0);var C=this.builder.addVertex(c+y*(c-h),d+y*(d-v),f+y*(f-p));this.verticesOnEdges[n]=C+1;var w=o(a,Math.max(0,c-1),d,f)-o(a,Math.min(this.nX-1,c+1),d,f),A=o(a,c,Math.max(0,d-1),f)-o(a,c,Math.min(this.nY-1,d+1),f),M=o(a,c,d,Math.max(0,f-1))-o(a,c,d,Math.min(this.nZ,f+1)),D=o(a,Math.max(0,h-1),v,p)-o(a,Math.min(this.nX-1,h+1),v,p),k=o(a,h,Math.max(0,v-1),p)-o(a,h,Math.min(this.nY-1,v+1),p),R=o(a,h,v,Math.max(0,p-1))-o(a,h,v,Math.min(this.nZ-1,p+1)),L=w+y*(w-D),H=A+y*(A-k),B=M+y*(M-R);return this.isoLevel>=0?this.builder.addNormal(L,H,B):this.builder.addNormal(-L,-H,-B),C},e.prototype.get=function(t,r,n){return this.scalarFieldGet(this.scalarField,t,r,n)},e.prototype.processCell=function(t,r,n,i){var a=0;if(this.get(t,r,n)<this.isoLevel&&(a|=1),this.get(t+1,r,n)<this.isoLevel&&(a|=2),this.get(t+1,r+1,n)<this.isoLevel&&(a|=4),this.get(t,r+1,n)<this.isoLevel&&(a|=8),this.get(t,r,n+1)<this.isoLevel&&(a|=16),this.get(t+1,r,n+1)<this.isoLevel&&(a|=32),this.get(t+1,r+1,n+1)<this.isoLevel&&(a|=64),this.get(t,r+1,n+1)<this.isoLevel&&(a|=128),!(a===0||a===255)){this.i=t,this.j=r,this.k=n;var o=sZe[a];(o&1)>0&&(this.vertList[0]=this.interpolate(0)),(o&2)>0&&(this.vertList[1]=this.interpolate(1)),(o&4)>0&&(this.vertList[2]=this.interpolate(2)),(o&8)>0&&(this.vertList[3]=this.interpolate(3)),(o&16)>0&&(this.vertList[4]=this.interpolate(4)),(o&32)>0&&(this.vertList[5]=this.interpolate(5)),(o&64)>0&&(this.vertList[6]=this.interpolate(6)),(o&128)>0&&(this.vertList[7]=this.interpolate(7)),(o&256)>0&&(this.vertList[8]=this.interpolate(8)),(o&512)>0&&(this.vertList[9]=this.interpolate(9)),(o&1024)>0&&(this.vertList[10]=this.interpolate(10)),(o&2048)>0&&(this.vertList[11]=this.interpolate(11));for(var s=eg[a],u=0;u<s.length;u+=3){var l=s[u],c=s[u+1],d=s[u+2];this.isoLevel>=0?this.builder.addTriangle(this.vertList,l,c,d,i):this.builder.addTriangle(this.vertList,d,c,l,i)}}},e}();function dZe(e,t,r,n,i,a){var o=ra.getUtils(t),s=o.createValues,u=o.createRenderableState,l=iO(),c=s(t,l,r,n,i),d=u(i);return r0(t.kind,c,d,a)}function Vb(e,t){var r=e.defaultProps,n=e.createGeometry,i=e.createLocationIterator,a=e.getLoci,o=e.eachLocation,s=e.setUpdateState,u=e.mustRecreate,l=e.dispose,c=e.geometryUtils,d=c.updateValues,f=c.updateBoundingSphere,h=c.updateRenderableState,v=c.createPositionIterator,p=Pl.create(),m,g,y,b,S=Object.assign({},r),x=hi.createEmpty(),C,w,A,M;function D(L,H,B){if(!B&&!C)throw new Error("missing volume");if(g=Object.assign({},S,H),y=L,b=B,Pl.reset(p),m?(!C||!Ct.areEquivalent(b,C))&&(p.createNew=!0):p.createNew=!0,p.createNew){p.createGeometry=!0;return}s(p,B,g,S,y,x),jc.areEqual(L.color,x.color)||(p.updateColor=!0),p.createGeometry&&(p.updateColor=!0)}function k(L){if(p.createNew)if(A=i(b),L)m=dZe(b,L,A,y,g,t),M=v(L,m.values);else throw new Error("expected geometry to be given");else{if(!m)throw new Error("expected renderObject to be available");if(A.reset(),p.createGeometry)if(L)N.updateIfChanged(m.values.drawCount,ra.getDrawCount(L)),N.updateIfChanged(m.values.uVertexCount,ra.getVertexCount(L));else throw new Error("expected geometry to be given");(p.updateTransform||p.createGeometry)&&(f(m.values,L||w),M=v(L||w,m.values)),p.updateSize&&"uSize"in m.values&&nd(A,y.size,m.values),p.updateColor&&ns(A,M,y.color,m.values),d(m.values,g),h(m.state,g)}S=g,x=y,C=b,L&&(w=L)}function R(L,H){return Ds(L)?H(Te.ofBounds(0,A.groupCount*A.instanceCount)):o(L,C,S,H)}return{get groupCount(){return A?A.count:0},get renderObject(){return m},createOrUpdate:function(L,H,B,j){return B===void 0&&(B={}),ce(this,void 0,void 0,function(){var Q;return de(this,function(G){return D(H,B,j||C),p.createGeometry?(Q=n(L,b,y,g,w),[2,NO(Q)?Q.then(k):k(Q)]):(k(),[2])})})},getLoci:function(L){return m?a(L,C,S,m.id):Or},mark:function(L,H){return Sr.mark(m,L,H,R)},setVisibility:function(L){Sr.setVisibility(m,L)},setAlphaFactor:function(L){Sr.setAlphaFactor(m,L)},setPickable:function(L){Sr.setPickable(m,L)},setColorOnly:function(L){Sr.setColorOnly(m,L)},setTransform:function(L,H){Sr.setTransform(m,L,H)},setOverpaint:function(L){return Sr.setOverpaint(m,L,R,!0)},setTransparency:function(L){return Sr.setTransparency(m,L,R,!0)},setClipping:function(L){return Sr.setClipping(m,L,R,!0)},destroy:function(){l==null||l(w),m&&(m.state.disposed=!0,m=void 0)},mustRecreate:u}}E({},Et.Params);function U_(e,t,r,n,i){var a=0,o=t.webgl,s=new Qn,u=hd(),l=[],c=or.createState(),d,f,h,v,p=hi.createEmpty();function m(x,C){var w=this;x===void 0&&(x={}),C&&C!==f&&(h=r(t,C),f=C,v||(v=I.getDefaultValues(h)));var A=j5(Object.assign({},v,x),f);return Object.assign(v,x,A),We.create("Creating or updating VolumeRepresentation",function(M){return ce(w,void 0,void 0,function(){var D,k;return de(this,function(R){switch(R.label){case 0:return d?!((k=d.mustRecreate)===null||k===void 0)&&k.call(d,f,v,o)&&(d.destroy(),d=n(u,f,v,o)):d=n(u,f,v,o),D=d.createOrUpdate({webgl:o,runtime:M},p,v,C),D?[4,D]:[3,2];case 1:R.sent(),R.label=2;case 2:return l.length=0,d&&d.renderObject&&l.push(d.renderObject),s.next(a++),[2]}})})})}function g(x,C){return d?d.mark(x,C):!1}function y(x){x.visible!==void 0&&d&&d.setVisibility(x.visible),x.alphaFactor!==void 0&&d&&d.setAlphaFactor(x.alphaFactor),x.pickable!==void 0&&d&&d.setPickable(x.pickable),x.overpaint!==void 0&&d&&d.setOverpaint(x.overpaint),x.transparency!==void 0&&d&&d.setTransparency(x.transparency),x.transform!==void 0&&d&&d.setTransform(x.transform),or.updateState(c,x)}function b(x){p=x}function S(){d&&d.destroy()}return{label:e,get groupCount(){return d?d.groupCount:0},get props(){return v},get params(){return h},get state(){return c},get theme(){return p},renderObjects:l,updated:s,createOrUpdate:m,setState:y,setTheme:b,getLoci:function(x){return x===void 0?i(f,v):d?d.getLoci(x):Or},mark:g,destroy:S}}var j_=_.set,zte=_.normalize,Vte=_.sub,Hte=_.addScalar,z_=_.scale,Gte=_.toArray;function vL(e,t,r,n){var i=!1;if(Ct.isLoci(e)){if(!Ct.areEquivalent(e.volume,t))return!1;n(Te.ofLength(t.grid.cells.data.length))&&(i=!0)}else if(Ct.Isosurface.isLoci(e)){if(!Ct.areEquivalent(e.volume,t))return!1;if(r){if(!Ct.IsoValue.areSame(e.isoValue,r,t.grid.stats))return!1;n(Te.ofLength(t.grid.cells.data.length))&&(i=!0)}else for(var a=t.grid,o=a.stats,s=a.cells.data,u=o.sigma,l=Ct.IsoValue.toAbsolute(e.isoValue,o).absoluteValue,c=0,d=s.length;c<d;++c)hn(l,s[c],u)&&n(Te.ofSingleton(c))&&(i=!0)}else if(Ct.Cell.isLoci(e)){if(!Ct.areEquivalent(e.volume,t))return!1;Te.is(e.indices)?n(e.indices)&&(i=!0):Oe.forEach(e.indices,function(f){n(Te.ofSingleton(f))&&(i=!0)})}return i}function Hb(e,t){t===void 0&&(t=0);var r=e[0]*e[1]*e[2],n=Math.sqrt(r),i=Math.pow(2,Math.ceil(Math.log(n)/Math.log(2))),a=e[0]+t,o=e[1]+t,s=1,u=a;return i<a*e[2]?(u=Math.floor(i/a),s=Math.ceil(e[2]/u),a*=u,o*=s):a*=e[2],{width:a,height:o,columns:u,rows:s,powerOfTwoSize:o<i?i:i*2}}function qte(e,t,r){r===void 0&&(r=0);for(var n=e.grid,i=n.cells,a=i.space,o=i.data,s=n.stats,u=s.max,l=s.min,c=a.dimensions,d=a.dataOffset,f=Hb(c,r),h=f.width,v=f.height,p=t==="data"?1:4,m=new Uint8Array(h*v*p),g={array:m,width:h,height:v},y=u-l,b=c[0],S=c[1],x=c[2],C=b+r,w=S+r,A=_(),M=_(),D=b-1,k=S-1,R=x-1,L=0;L<x;++L)for(var H=0;H<S;++H)for(var B=0;B<b;++B){var j=Math.floor(L*C%h/C),Q=Math.floor(L*C/h),G=j*C+B,W=p*(Q*w*h+H*h+G),q=d(B,H,L);t==="data"?m[W]=Math.round((o[q]-l)/y*255):(t==="groups"?Db(q,m,W):(j_(A,o[d(Math.max(0,B-1),H,L)],o[d(B,Math.max(0,H-1),L)],o[d(B,H,Math.max(0,L-1))]),j_(M,o[d(Math.min(D,B+1),H,L)],o[d(B,Math.min(k,H+1),L)],o[d(B,H,Math.min(R,L+1))]),zte(A,Vte(A,A,M)),Hte(A,z_(A,A,.5),.5),Gte(z_(A,A,255),m,W)),m[W+3]=Math.round((o[q]-l)/y*255))}return g}function fZe(e){for(var t=e.grid,r=t.cells,n=r.space,i=r.data,a=t.stats,o=a.max,s=a.min,u=n.dimensions,l=u[0],c=u[1],d=u[2],f=n.dataOffset,h=new Uint8Array(l*c*d*4),v={array:h,width:l,height:c,depth:d},p=o-s,m=_(),g=_(),y=l-1,b=c-1,S=d-1,x=0,C=0;C<d;++C)for(var w=0;w<c;++w)for(var A=0;A<l;++A){var M=f(A,w,C);j_(m,i[f(Math.max(0,A-1),w,C)],i[f(A,Math.max(0,w-1),C)],i[f(A,w,Math.max(0,C-1))]),j_(g,i[f(Math.min(y,A+1),w,C)],i[f(A,Math.min(b,w+1),C)],i[f(A,w,Math.min(S,C+1))]),zte(m,Vte(m,m,g)),Hte(m,z_(m,m,.5),.5),Gte(z_(m,m,255),h,x),h[x+3]=Math.round((i[M]-s)/p*255),x+=4}return v}var hZe=`
precision highp float;
precision highp int;

#if __VERSION__ == 100
    precision highp sampler2D;
    uniform sampler2D tTexture;
#else
    precision highp isampler2D;
    uniform isampler2D tTexture;
#endif

void main(void) {
    #if __VERSION__ == 100
        gl_FragColor = texture2D(tTexture, vec2(0.5));
    #else
        gl_FragColor = ivec4(texture2D(tTexture, vec2(0.5)).r);
    #endif
}
`,pZe=E(E({},va),{tTexture:ur("texture","rgba","float","nearest")}),Cs="histopyramid-sum";function vZe(e,t){if(e.namedComputeRenderables[Cs]){var r=e.namedComputeRenderables[Cs].values;N.update(r.tTexture,t),e.namedComputeRenderables[Cs].update()}else e.namedComputeRenderables[Cs]=mZe(e,t);return e.namedComputeRenderables[Cs]}function mZe(e,t){var r=E(E({},ma),{tTexture:N.create(t)}),n=E({},pZe),i=Mn("sum",_o,hZe,{},{0:"ivec4"}),a=Wi(e,"triangles",i,n,r);return qi(a,r)}function gZe(e){var t=e.gl,r=e.state;r.disable(t.CULL_FACE),r.disable(t.BLEND),r.disable(t.DEPTH_TEST),r.disable(t.SCISSOR_TEST),r.depthMask(!1),r.colorMask(!0,!0,!0,!0),r.clearColor(0,0,0,0)}var yx=new Uint8Array(4),Xz=new Int32Array(4);function yZe(e,t){var r=e.gl,n=e.resources,i=vZe(e,t);e.state.currentRenderItemId=-1,e.namedFramebuffers[Cs]||(e.namedFramebuffers[Cs]=n.framebuffer());var a=e.namedFramebuffers[Cs];e.namedTextures[Cs]||(e.namedTextures[Cs]=wr(r)?n.texture("image-int32","rgba","int","nearest"):n.texture("image-uint8","rgba","ubyte","nearest"),e.namedTextures[Cs].define(1,1));var o=e.namedTextures[Cs];return o.attachFramebuffer(a,0),gZe(e),r.viewport(0,0,1,1),i.render(),r.finish(),e.readPixels(0,0,1,1,wr(r)?Xz:yx),e.unbindFramebuffer(),wr(r)?Xz[0]:_O(yx[0],yx[1],yx[2])}var bZe=`
precision highp float;
precision highp int;
precision highp sampler2D;

uniform sampler2D tInputLevel;

// previous level used to evaluate the new level
#if __VERSION__ == 100
    uniform sampler2D tPreviousLevel;
#else
    precision highp isampler2D;
    uniform isampler2D tPreviousLevel;
#endif

// inverted size of the previous level texture.
uniform float uSize;
uniform float uTexSize;
uniform bool uFirst;

#include common

void main(void) {
    float k = 0.5 * uSize;
    vec2 position = floor((gl_FragCoord.xy / uTexSize) / uSize) * uSize;

    #if __VERSION__ == 100
        float a, b, c, d;

        if (uFirst) {
            a = texture2D(tInputLevel, position).r * 255.0;
            b = texture2D(tInputLevel, position + vec2(k, 0.0)).r * 255.0;
            c = texture2D(tInputLevel, position + vec2(0.0, k)).r * 255.0;
            d = texture2D(tInputLevel, position + vec2(k, k)).r * 255.0;
        } else {
            a = decodeFloatRGB(texture2D(tPreviousLevel, position).rgb);
            b = decodeFloatRGB(texture2D(tPreviousLevel, position + vec2(k, 0.0)).rgb);
            c = decodeFloatRGB(texture2D(tPreviousLevel, position + vec2(0.0, k)).rgb);
            d = decodeFloatRGB(texture2D(tPreviousLevel, position + vec2(k, k)).rgb);
        }
        gl_FragColor = vec4(encodeFloatRGB(a + b + c + d), 1.0);
    #else
        int a, b, c, d;

        if (uFirst) {
            a = int(texture2D(tInputLevel, position).r * 255.0);
            b = int(texture2D(tInputLevel, position + vec2(k, 0.0)).r * 255.0);
            c = int(texture2D(tInputLevel, position + vec2(0.0, k)).r * 255.0);
            d = int(texture2D(tInputLevel, position + vec2(k, k)).r * 255.0);
        } else {
            a = texture2D(tPreviousLevel, position).r;
            b = texture2D(tPreviousLevel, position + vec2(k, 0.0)).r;
            c = texture2D(tPreviousLevel, position + vec2(0.0, k)).r;
            d = texture2D(tPreviousLevel, position + vec2(k, k)).r;
        }
        gl_FragColor = ivec4(a + b + c + d);
    #endif
}
`,xZe=E(E({},va),{tInputLevel:ur("texture","rgba","float","nearest"),tPreviousLevel:ur("texture","rgba","float","nearest"),uSize:Ge("f"),uTexSize:Ge("f"),uFirst:Ge("b")}),Zh="histogram-pyramid";function SZe(e,t,r){if(e.namedComputeRenderables[Zh]){var n=e.namedComputeRenderables[Zh].values;N.update(n.tInputLevel,t),N.update(n.tPreviousLevel,r),e.namedComputeRenderables[Zh].update()}else e.namedComputeRenderables[Zh]=CZe(e,t,r);return e.namedComputeRenderables[Zh]}function CZe(e,t,r){var n=E(E({},ma),{tInputLevel:N.create(t),tPreviousLevel:N.create(r),uSize:N.create(0),uTexSize:N.create(0),uFirst:N.create(!0)}),i=E({},xZe),a=Mn("reduction",_o,bZe,{},{0:"ivec4"}),o=Wi(e,"triangles",a,i,n);return qi(o,n)}var Yz=[];function _Ze(e,t){var r=Yz[t],n=Math.pow(2,t);if(r===void 0){var i=e.isWebGL2?V_("level"+t,e,"image-int32","alpha","int","nearest"):V_("level"+t,e,"image-uint8","rgba","ubyte","nearest");i.define(n,n);var a=Wte("level"+t,e);i.attachFramebuffer(a,0),r={texture:i,framebuffer:a},Yz[t]=r}return r}function wZe(e){var t=e.gl,r=e.state;r.disable(t.CULL_FACE),r.disable(t.BLEND),r.disable(t.DEPTH_TEST),r.enable(t.SCISSOR_TEST),r.depthMask(!1),r.colorMask(!0,!0,!0,!0),r.clearColor(0,0,0,0)}function Wte(e,t){var r=Zh+"-"+e;return t.namedFramebuffers[r]||(t.namedFramebuffers[r]=t.resources.framebuffer()),t.namedFramebuffers[r]}function V_(e,t,r,n,i,a){var o=Zh+"-"+e;return t.namedTextures[o]||(t.namedTextures[o]=t.resources.texture(r,n,i,a)),t.namedTextures[o]}function EZe(e,t,r,n){var i=e.gl,a=t.getWidth(),o=t.getHeight();if(a!==o||!m_e(a))throw new Error("inputTexture must be of square power-of-two size");var s=Math.ceil(Math.log(a)/Math.log(2)),u=Math.pow(2,s),l=Math.pow(2,s),c=Math.pow(2,s-1),d=e.isWebGL2?V_("pyramid",e,"image-int32","alpha","int","nearest"):V_("pyramid",e,"image-uint8","rgba","ubyte","nearest");d.define(l,c);var f=Wte("pyramid",e);d.attachFramebuffer(f,0),i.viewport(0,0,l,c),wr(i)?i.clearBufferiv(i.COLOR,0,[0,0,0,0]):i.clear(i.COLOR_BUFFER_BIT);for(var h=[],v=0;v<s;++v)h.push(_Ze(e,v));var p=SZe(e,t,h[0].texture);e.state.currentRenderItemId=-1,wZe(e);for(var m=0,v=0;v<s;v++){var g=s-1-v,y=h[g];y.framebuffer.bind();var b=Math.pow(2,g);N.update(p.values.uSize,Math.pow(2,v+1)/u),N.update(p.values.uTexSize,b),N.updateIfChanged(p.values.uFirst,v===0),v>0&&(N.update(p.values.tPreviousLevel,h[s-v].texture),p.update()),e.state.currentRenderItemId=-1,i.viewport(0,0,b,b),i.scissor(0,0,b,b),wr(i)?i.clearBufferiv(i.COLOR,0,[0,0,0,0]):i.clear(i.COLOR_BUFFER_BIT),i.scissor(0,0,n[0],n[1]),p.render(),d.bind(0),i.copyTexSubImage2D(i.TEXTURE_2D,0,m,0,0,0,b,b),d.unbind(0),m+=b}i.finish();var S=Math.max(1,yZe(e,h[0].texture)),x=Math.ceil(S/Math.pow(2,s));return{pyramidTex:d,count:S,height:x,levels:s,scale:r}}var H0;function AZe(){if(H0!==void 0)return H0;H0=pa(16*16,1,Uint8Array);for(var e=H0.array,t=0,r=eg.length;t<r;++t)e[t]=eg[t].length/3;return H0}var G0;function PZe(){if(G0!==void 0)return G0;G0=pa(64*64,1,Uint8Array);for(var e=G0.array,t=0,r=eg.length;t<r;++t)for(var n=0;n<16;++n)n<eg[t].length?e[t*16+n]=eg[t][n]:e[t*16+n]=255;return G0}var TZe=`
precision highp float;
precision highp int;
precision highp sampler2D;

#if __VERSION__ == 100
    uniform sampler2D tActiveVoxelsPyramid;
#else
    precision highp isampler2D;
    uniform isampler2D tActiveVoxelsPyramid;
#endif

uniform sampler2D tActiveVoxelsBase;
uniform sampler2D tVolumeData;
uniform sampler2D tTriIndices;

uniform float uIsoValue;
uniform float uLevels;
uniform float uSize;
uniform float uCount;
uniform bool uInvert;

uniform vec3 uGridDim;
uniform vec3 uGridTexDim;
uniform mat4 uGridTransform;

// scale to volume data coord
uniform vec2 uScale;

#include common

// cube corners (excluding origin)
const vec3 c1 = vec3(1., 0., 0.);
const vec3 c2 = vec3(1., 1., 0.);
const vec3 c3 = vec3(0., 1., 0.);
const vec3 c4 = vec3(0., 0., 1.);
const vec3 c5 = vec3(1., 0., 1.);
const vec3 c6 = vec3(1., 1., 1.);
const vec3 c7 = vec3(0., 1., 1.);

vec3 index3dFrom2d(vec2 coord) {
    vec2 gridTexPos = coord * uGridTexDim.xy;
    vec2 columnRow = ivec2Div(gridTexPos, uGridDim.xy);
    vec2 posXY = gridTexPos - columnRow * uGridDim.xy;
    float posZ = columnRow.y * intDiv(uGridTexDim.x, uGridDim.x) + columnRow.x;
    return vec3(posXY, posZ);
}

vec4 texture3dFrom2dNearest(sampler2D tex, vec3 pos, vec3 gridDim, vec2 texDim) {
    float zSlice = floor(pos.z * gridDim.z + 0.5); // round to nearest z-slice
    float column = intDiv(intMod(zSlice * gridDim.x, texDim.x), gridDim.x);
    float row = intDiv(zSlice * gridDim.x, texDim.x);
    vec2 coord = (vec2(column * gridDim.x, row * gridDim.y) + (pos.xy * gridDim.xy)) / (texDim / uScale);
    return texture2D(tex, coord + 0.5 / (texDim / uScale));
}

vec4 voxel(vec3 pos) {
    pos = min(max(vec3(0.0), pos), uGridDim - vec3(1.0));
    return texture3dFrom2dNearest(tVolumeData, pos / uGridDim, uGridDim, uGridTexDim.xy);
}

vec4 voxelPadded(vec3 pos) {
    pos = min(max(vec3(0.0), pos), uGridDim - vec3(vec2(2.0), 1.0)); // remove xy padding
    return texture3dFrom2dNearest(tVolumeData, pos / uGridDim, uGridDim, uGridTexDim.xy);
}

int idot2(const in ivec2 a, const in ivec2 b) {
    return a.x * b.x + a.y * b.y;
}

int idot4(const in ivec4 a, const in ivec4 b) {
    return a.x * b.x + a.y * b.y + a.z * b.z + a.w * b.w;
}

#if __VERSION__ == 100
    int pyramidVoxel(vec2 pos) {
        return int(decodeFloatRGB(texture2D(tActiveVoxelsPyramid, pos / (vec2(1.0, 0.5) * uSize)).rgb));
    }
#else
    int pyramidVoxel(vec2 pos) {
        return texture2D(tActiveVoxelsPyramid, pos / (vec2(1.0, 0.5) * uSize)).r;
    }
#endif

vec4 baseVoxel(vec2 pos) {
    return texture2D(tActiveVoxelsBase, pos / uSize);
}

void main(void) {
    // get 1D index
    int vI = int(gl_FragCoord.x) + int(gl_FragCoord.y) * int(uSize);

    // ignore 1D indices outside of the grid
    if(vI >= int(uCount)) discard;

    ivec2 offset = ivec2(int(uSize) - 2, 0);

    int start = 0;
    ivec4 starts = ivec4(0);
    ivec4 ends = ivec4(0);
    int diff = 2;
    ivec4 m = ivec4(0);
    ivec2 position = ivec2(0);
    ivec4 vI4 = ivec4(vI);

    ivec2 relativePosition = ivec2(0);
    int end = 0;
    ivec2 pos1 = ivec2(0);
    ivec2 pos2 = ivec2(0);
    ivec2 pos3 = ivec2(0);
    ivec2 pos4 = ivec2(0);
    ivec3 vI3 = ivec3(vI);
    ivec3 mask = ivec3(0);

    // traverse the different levels of the pyramid
    for(int i = 1; i < 14; i++) {
        if(float(i) >= uLevels) break;

        offset.x -= diff;
        diff *= 2;
        relativePosition = position + offset;

        end = start + pyramidVoxel(vec2(relativePosition));
        pos1 = ivec2(relativePosition);
        starts.x = start;
        ends.x = end;
        pos2 = ivec2(relativePosition + ivec2(1, 0));
        starts.y = ends.x;
        ends.y = ends.x + pyramidVoxel(vec2(pos2));
        pos3 = relativePosition + ivec2(0, 1);
        starts.z = ends.y;
        ends.z = ends.y + pyramidVoxel(vec2(pos3));
        pos4 = relativePosition + ivec2(1, 1);
        starts.w = ends.z;
        mask = ivec3(greaterThanEqual(vI3, starts.rgb)) * ivec3(lessThan(vI3, ends.rgb));
        m = ivec4(mask, 1 - int(any(bvec3(mask))));

        relativePosition = m.x * pos1 + m.y * pos2 + m.z * pos3 + m.w * pos4;
        start = idot4(m, starts);
        position = 2 * (relativePosition - offset);
    }

    end = start + int(baseVoxel(vec2(position)).r * 255.0);
    pos1 = position;
    starts.x = start;
    ends.x = end;
    pos2 = position + ivec2(1, 0);
    starts.y = ends.x;
    ends.y = ends.x + int(baseVoxel(vec2(pos2)).r * 255.0);
    pos3 = position + ivec2(0, 1);
    starts.z = ends.y;
    ends.z = ends.y + int(baseVoxel(vec2(pos3)).r * 255.0);
    pos4 = position + ivec2(1, 1);
    starts.w = ends.z;
    mask = ivec3(greaterThanEqual(vI3, starts.rgb)) * ivec3(lessThan(vI3, ends.rgb));
    m = ivec4(mask, 1 - int(any(bvec3(mask))));
    position = m.x * pos1 + m.y * pos2 + m.z * pos3 + m.w * pos4;

    vec2 coord2d = (vec2(position) / uSize) / uScale;
    vec3 coord3d = floor(index3dFrom2d(coord2d) + 0.5);

    float edgeIndex = floor(baseVoxel(vec2(position)).a * 255.0 + 0.5);

    // current vertex for the up to 15 MC cases
    int currentVertex = vI - idot4(m, starts);

    // ensure winding-order is the same for negative and positive iso-levels
    if (uInvert) {
        int v = imod(currentVertex + 1, 3);
        if (v == 1) currentVertex += 2;
        else if (v == 0) currentVertex -= 2;
    }

    // get index into triIndices table
    int mcIndex = 16 * int(edgeIndex) + currentVertex;
    vec4 mcData = texture2D(tTriIndices, vec2(imod(mcIndex, 64), mcIndex / 64) / 64.);

    // bit mask to avoid conditionals (see comment below) for getting MC case corner
    vec4 m0 = vec4(floor(mcData.a * 255.0 + 0.5));

    // get edge value masks
    vec4 m1 = vec4(equal(m0, vec4(0., 1., 2., 3.)));
    vec4 m2 = vec4(equal(m0, vec4(4., 5., 6., 7.)));
    vec4 m3 = vec4(equal(m0, vec4(8., 9., 10., 11.)));

    // apply bit masks
    vec3 b0 = coord3d +
                m1.y * c1 +
                m1.z * c2 +
                m1.w * c3 +
                m2.x * c4 +
                m2.y * c5 +
                m2.z * c6 +
                m2.w * c7 +
                m3.y * c1 +
                m3.z * c2 +
                m3.w * c3;
    vec3 b1 = coord3d +
                m1.x * c1 +
                m1.y * c2 +
                m1.z * c3 +
                m2.x * c5 +
                m2.y * c6 +
                m2.z * c7 +
                m2.w * c4 +
                m3.x * c4 +
                m3.y * c5 +
                m3.z * c6 +
                m3.w * c7;

    // the conditionals that are avoided by above bitmasks
    // vec3 b0 = coord3d;
    // vec3 b1 = coord3d;
    // if (mcIndex == 0.0) {
    //     b1 += c1;
    // } else if (mcIndex == 1.0) {
    //     b0 += c1; b1 += c2;
    // } else if (mcIndex == 2.0) {
    //     b0 += c2; b1 += c3;
    // } else if (mcIndex == 3.0) {
    //     b0 += c3;
    // } else if (mcIndex == 4.0) {
    //     b0 += c4; b1 += c5;
    // } else if (mcIndex == 5.0) {
    //     b0 += c5; b1 += c6;
    // } else if (mcIndex == 6.0) {
    //     b0 += c6; b1 += c7;
    // } else if (mcIndex == 7.0) {
    //     b0 += c7; b1 += c4;
    // } else if (mcIndex == 8.0) {
    //     b1 += c4;
    // } else if (mcIndex == 9.0) {
    //     b0 += c1; b1 += c5;
    // } else if (mcIndex == 10.0) {
    //     b0 += c2; b1 += c6;
    // } else if (mcIndex == 11.0) {
    //     b0 += c3; b1 += c7;
    // }
    // b0 = floor(b0 + 0.5);
    // b1 = floor(b1 + 0.5);

    vec4 d0 = voxel(b0);
    vec4 d1 = voxel(b1);

    float v0 = d0.a;
    float v1 = d1.a;

    float t = (uIsoValue - v0) / (v0 - v1);
    gl_FragData[0].xyz = (uGridTransform * vec4(b0 + t * (b0 - b1), 1.0)).xyz;

    // group id
    #if __VERSION__ == 100
        // webgl1 does not support 'flat' interpolation (i.e. no interpolation)
        // so we ensure a constant group id per triangle here
        #ifdef dPackedGroup
            gl_FragData[1] = vec4(voxel(coord3d).rgb, 1.0);
        #else
            vec3 gridDim = uGridDim - vec3(1.0, 1.0, 0.0); // remove xy padding
            float group = coord3d.z + coord3d.y * gridDim.z + coord3d.x * gridDim.z * gridDim.y;
            gl_FragData[1] = vec4(group > 16777215.5 ? vec3(1.0) : encodeFloatRGB(group), 1.0);
        #endif
    #else
        #ifdef dPackedGroup
            gl_FragData[1] = vec4(t < 0.5 ? d0.rgb : d1.rgb, 1.0);
        #else
            vec3 b = t < 0.5 ? b0 : b1;
            vec3 gridDim = uGridDim - vec3(1.0, 1.0, 0.0); // remove xy padding
            float group = b.z + b.y * gridDim.z + b.x * gridDim.z * gridDim.y;
            gl_FragData[1] = vec4(group > 16777215.5 ? vec3(1.0) : encodeFloatRGB(group), 1.0);
        #endif
    #endif

    // normals from gradients
    vec3 n0 = -normalize(vec3(
        voxelPadded(b0 - c1).a - voxelPadded(b0 + c1).a,
        voxelPadded(b0 - c3).a - voxelPadded(b0 + c3).a,
        voxelPadded(b0 - c4).a - voxelPadded(b0 + c4).a
    ));
    vec3 n1 = -normalize(vec3(
        voxelPadded(b1 - c1).a - voxelPadded(b1 + c1).a,
        voxelPadded(b1 - c3).a - voxelPadded(b1 + c3).a,
        voxelPadded(b1 - c4).a - voxelPadded(b1 + c4).a
    ));
    gl_FragData[2].xyz = -vec3(
        n0.x + t * (n0.x - n1.x),
        n0.y + t * (n0.y - n1.y),
        n0.z + t * (n0.z - n1.z)
    );

    // ensure normal-direction is the same for negative and positive iso-levels
    if (uInvert) {
        gl_FragData[2].xyz *= -1.0;
    }

    // apply normal matrix
    gl_FragData[2].xyz *= transpose3(inverse3(mat3(uGridTransform)));
}
`,IZe=`
precision highp float;
precision highp int;
precision highp sampler2D;

uniform sampler2D tTriCount;
uniform sampler2D tVolumeData;

uniform float uIsoValue;
uniform vec3 uGridDim;
uniform vec3 uGridTexDim;
uniform vec2 uScale;

#include common

// cube corners (excluding origin)
const vec3 c1 = vec3(1., 0., 0.);
const vec3 c2 = vec3(1., 1., 0.);
const vec3 c3 = vec3(0., 1., 0.);
const vec3 c4 = vec3(0., 0., 1.);
const vec3 c5 = vec3(1., 0., 1.);
const vec3 c6 = vec3(1., 1., 1.);
const vec3 c7 = vec3(0., 1., 1.);

vec3 index3dFrom2d(vec2 coord) {
    vec2 gridTexPos = coord * uGridTexDim.xy;
    vec2 columnRow = ivec2Div(gridTexPos, uGridDim.xy);
    vec2 posXY = gridTexPos - columnRow * uGridDim.xy;
    float posZ = columnRow.y * intDiv(uGridTexDim.x, uGridDim.x) + columnRow.x;
    return vec3(posXY, posZ);
}

vec4 texture3dFrom2dNearest(sampler2D tex, vec3 pos, vec3 gridDim, vec2 texDim) {
    float zSlice = floor(pos.z * gridDim.z + 0.5); // round to nearest z-slice
    float column = intDiv(intMod(zSlice * gridDim.x, texDim.x), gridDim.x);
    float row = intDiv(zSlice * gridDim.x, texDim.x);
    vec2 coord = (vec2(column * gridDim.x, row * gridDim.y) + (pos.xy * gridDim.xy)) / (texDim / uScale);
    return texture2D(tex, coord);
}

vec4 voxel(vec3 pos) {
    pos = min(max(vec3(0.0), pos), uGridDim - vec3(1.0));
    return texture3dFrom2dNearest(tVolumeData, pos / uGridDim, uGridDim, uGridTexDim.xy);
}

void main(void) {
    vec2 uv = gl_FragCoord.xy / uGridTexDim.xy;
    vec3 posXYZ = index3dFrom2d(uv);

    // get MC case as the sum of corners that are below the given iso level
    float c = step(voxel(posXYZ).a, uIsoValue)
        + 2. * step(voxel(posXYZ + c1).a, uIsoValue)
        + 4. * step(voxel(posXYZ + c2).a, uIsoValue)
        + 8. * step(voxel(posXYZ + c3).a, uIsoValue)
        + 16. * step(voxel(posXYZ + c4).a, uIsoValue)
        + 32. * step(voxel(posXYZ + c5).a, uIsoValue)
        + 64. * step(voxel(posXYZ + c6).a, uIsoValue)
        + 128. * step(voxel(posXYZ + c7).a, uIsoValue);
    c *= step(c, 254.);

    // handle out of bounds positions
    posXYZ += 1.0;
    posXYZ.xy += 1.0; // pixel padding (usually ok even if the texture has no padding)
    if (posXYZ.x >= uGridDim.x || posXYZ.y >= uGridDim.y || posXYZ.z >= uGridDim.z)
        c = 0.0;

    // get total triangles to generate for calculated MC case from triCount texture
    float totalTrianglesToGenerate = texture2D(tTriCount, vec2(intMod(c, 16.), floor(c / 16.)) / 16.).a;
    gl_FragColor = vec4(vec3(totalTrianglesToGenerate * 3.0), c / 255.0);
}
`,MZe=E(E({},va),{tTriCount:ur("image-uint8","alpha","ubyte","nearest"),tVolumeData:ur("texture","rgba","ubyte","nearest"),uIsoValue:Ge("f"),uGridDim:Ge("v3"),uGridTexDim:Ge("v3"),uScale:Ge("v2")}),au="active-voxels";function DZe(e,t,r,n,i,a){if(e.namedComputeRenderables[au]){var o=e.namedComputeRenderables[au].values;N.update(o.uQuadScale,a),N.update(o.tVolumeData,t),N.updateIfChanged(o.uIsoValue,i),N.update(o.uGridDim,r),N.update(o.uGridTexDim,n),N.update(o.uScale,a),e.namedComputeRenderables[au].update()}else e.namedComputeRenderables[au]=RZe(e,t,r,n,i,a);return e.namedComputeRenderables[au]}function RZe(e,t,r,n,i,a){var o=E(E({},ma),{tTriCount:N.create(AZe()),uQuadScale:N.create(a),tVolumeData:N.create(t),uIsoValue:N.create(i),uGridDim:N.create(r),uGridTexDim:N.create(n),uScale:N.create(a)}),s=E({},MZe),u=Mn("active-voxels",_o,IZe),l=Wi(e,"triangles",u,s,o);return qi(l,o)}function kZe(e){var t=e.gl,r=e.state;r.disable(t.CULL_FACE),r.disable(t.BLEND),r.disable(t.DEPTH_TEST),r.enable(t.SCISSOR_TEST),r.depthMask(!1),r.colorMask(!0,!0,!0,!0),r.clearColor(0,0,0,0)}function OZe(e,t,r,n,i,a){var o=e.gl,s=e.resources,u=t.getWidth(),l=t.getHeight();e.namedFramebuffers[au]||(e.namedFramebuffers[au]=s.framebuffer());var c=e.namedFramebuffers[au];c.bind(),e.namedTextures[au]||(e.namedTextures[au]=s.texture("image-uint8","rgba","ubyte","nearest"));var d=e.namedTextures[au];d.define(u,l);var f=DZe(e,t,r,n,i,a);return e.state.currentRenderItemId=-1,d.attachFramebuffer(c,0),kZe(e),o.viewport(0,0,u,l),o.scissor(0,0,u,l),o.clear(o.COLOR_BUFFER_BIT),o.scissor(0,0,n[0],n[1]),f.render(),o.finish(),d}var LZe=E(E({},va),{tTriIndices:ur("image-uint8","alpha","ubyte","nearest"),tActiveVoxelsPyramid:ur("texture","rgba","float","nearest"),tActiveVoxelsBase:ur("texture","rgba","float","nearest"),tVolumeData:ur("texture","rgba","ubyte","nearest"),uIsoValue:Ge("f"),uSize:Ge("f"),uLevels:Ge("f"),uCount:Ge("f"),uInvert:Ge("b"),uGridDim:Ge("v3"),uGridTexDim:Ge("v3"),uGridTransform:Ge("m4"),uScale:Ge("v2"),dPackedGroup:Qt("boolean")}),sf="isosurface";function NZe(e,t,r,n,i,a,o,s,u,l,c,d,f){if(e.namedComputeRenderables[sf]){var h=e.namedComputeRenderables[sf].values;N.update(h.tActiveVoxelsPyramid,t),N.update(h.tActiveVoxelsBase,r),N.update(h.tVolumeData,n),N.updateIfChanged(h.uIsoValue,s),N.updateIfChanged(h.uSize,Math.pow(2,u)),N.updateIfChanged(h.uLevels,u),N.updateIfChanged(h.uCount,c),N.updateIfChanged(h.uInvert,d),N.update(h.uGridDim,i),N.update(h.uGridTexDim,a),N.update(h.uGridTransform,o),N.update(h.uScale,l),N.update(h.dPackedGroup,f),e.namedComputeRenderables[sf].update()}else e.namedComputeRenderables[sf]=FZe(e,t,r,n,i,a,o,s,u,l,c,d,f);return e.namedComputeRenderables[sf]}function FZe(e,t,r,n,i,a,o,s,u,l,c,d,f){var h=E(E({},ma),{tTriIndices:N.create(PZe()),tActiveVoxelsPyramid:N.create(t),tActiveVoxelsBase:N.create(r),tVolumeData:N.create(n),uIsoValue:N.create(s),uSize:N.create(Math.pow(2,u)),uLevels:N.create(u),uCount:N.create(c),uInvert:N.create(d),uGridDim:N.create(i),uGridTexDim:N.create(a),uGridTransform:N.create(o),uScale:N.create(l),dPackedGroup:N.create(f)}),v=E({},LZe),p=Mn("isosurface",_o,TZe,{drawBuffers:"required"}),m=Wi(e,"triangles",p,v,h);return qi(m,h)}function BZe(e){var t=e.gl,r=e.state;r.disable(t.CULL_FACE),r.disable(t.BLEND),r.disable(t.DEPTH_TEST),r.disable(t.SCISSOR_TEST),r.depthMask(!1),r.colorMask(!0,!0,!0,!0),r.clearColor(0,0,0,0)}function UZe(e,t,r,n,i,a,o,s,u,l,c,d,f){var h=e.gl,v=e.resources,p=e.extensions,m=n.pyramidTex,g=n.height,y=n.levels,b=n.scale,S=n.count,x=m.getWidth();e.namedFramebuffers[sf]||(e.namedFramebuffers[sf]=v.framebuffer());var C=e.namedFramebuffers[sf];wr(h)?(c||(c=p.colorBufferHalfFloat&&p.textureHalfFloat?v.texture("image-float16","rgba","fp16","nearest"):v.texture("image-float32","rgba","float","nearest")),d||(d=v.texture("image-uint8","rgba","ubyte","nearest")),f||(f=p.colorBufferHalfFloat&&p.textureHalfFloat?v.texture("image-float16","rgba","fp16","nearest"):v.texture("image-float32","rgba","float","nearest"))):(c||(c=v.texture("image-float32","rgba","float","nearest")),d||(d=v.texture("image-float32","rgba","float","nearest")),f||(f=v.texture("image-float32","rgba","float","nearest"))),c.define(x,g),d.define(x,g),f.define(x,g),c.attachFramebuffer(C,0),d.attachFramebuffer(C,1),f.attachFramebuffer(C,2);var w=NZe(e,m,t,r,i,a,o,s,y,b,S,u,l);e.state.currentRenderItemId=-1;var A=e.extensions.drawBuffers;if(!A)throw new Error("need WebGL draw buffers");return C.bind(),A.drawBuffers([A.COLOR_ATTACHMENT0,A.COLOR_ATTACHMENT1,A.COLOR_ATTACHMENT2]),BZe(e),h.viewport(0,0,x,g),h.clear(h.COLOR_BUFFER_BIT),w.render(),h.finish(),{vertexTexture:c,groupTexture:d,normalTexture:f,vertexCount:S}}function mL(e,t,r,n,i,a,o,s,u,l,c,d){var f=OZe(e,t,r,n,o,i),h=EZe(e,f,i,n),v=UZe(e,f,t,h,r,n,a,o,s,u,l,c,d);return v}var $te={isoValue:Ct.IsoValueParam};function jZe(e){return e.extensions.colorBufferFloat&&e.extensions.textureFloat&&e.extensions.drawBuffers}var wy=1;function gL(e,t){var r=e.grid.cells.space.dimensions,n=Hb(r,wy).powerOfTwoSize;return n<=t.maxTextureSize/2}function zZe(e,t,r,n){return r.tryUseGpu&&n&&jZe(n)&&gL(t,n)?qZe(e):HZe(e)}function Kz(e,t){return Ct.Isosurface.Loci(e,t.isoValue)}function yL(e,t,r,n){var i=e.objectId,a=e.groupId;return n===i?Ct.Cell.Loci(t,Te.ofSingleton(a)):Or}function bL(e,t,r,n){return vL(e,t,r.isoValue,n)}function VZe(e,t,r,n,i){return ce(this,void 0,void 0,function(){var a,o,s;return de(this,function(u){switch(u.label){case 0:return e.runtime.update({message:"Marching cubes..."}),a=Fs(new Int32Array(t.grid.cells.data.length)),[4,uE({isoLevel:Ct.IsoValue.toAbsolute(n.isoValue,t.grid.stats).absoluteValue,scalarField:t.grid.cells,idField:Pr.create(t.grid.cells.space,Pr.Data1(a))},i).runAsChild(e.runtime)];case 1:return o=u.sent(),s=_a.getGridToCartesianTransform(t.grid),Nt.transform(o,s),e.webgl&&!e.webgl.isWebGL2&&Nt.uniformTriangleGroup(o,!1),o.setBoundingSphere(Ct.getBoundingSphere(t)),[2,o]}})})}var xL=E(E(E(E({},Nt.Params),Ru.Params),$te),{quality:E(E({},Nt.Params.quality),{isEssential:!1}),tryUseGpu:I.Boolean(!0)});function HZe(e){return Vb({defaultProps:I.getDefaultValues(xL),createGeometry:VZe,createLocationIterator:function(t){return mn(t.grid.cells.data.length,1,1,function(){return Ko})},getLoci:yL,eachLocation:bL,setUpdateState:function(t,r,n,i){Ct.IsoValue.areSame(n.isoValue,i.isoValue,r.grid.stats)||(t.createGeometry=!0)},geometryUtils:Nt.Utils,mustRecreate:function(t,r,n){return r.tryUseGpu&&!!n&&gL(t,n)}},e)}var hD;(function(e){var t="volume-isosurface-texture";e.descriptor=yo({name:t});function r(n,i){var a=i.resources,o=_a.getGridToCartesianTransform(n.grid),s=_.clone(n.grid.cells.space.dimensions),u=Hb(s,wy),l=u.width,c=u.height,d=u.powerOfTwoSize,f=_.create(l,c,0),h=He.create(l/d,c/d);if(d>i.maxTextureSize/2)throw new Error("volume too large for gpu isosurface extraction");if(!n._propertyData[t]){n._propertyData[t]=a.texture("image-uint8","alpha","ubyte","linear");var v=n._propertyData[t];v.define(d,d),v.load(qte(n,"data",wy),!0),n.customProperties.add(e.descriptor),n.customProperties.assets(e.descriptor,[{dispose:function(){return v.destroy()}}])}return s[0]+=wy,s[1]+=wy,{texture:n._propertyData[t],transform:o,gridDimension:s,gridTexDim:f,gridTexScale:h}}e.get=r})(hD||(hD={}));function GZe(e,t,r,n,i){return ce(this,void 0,void 0,function(){var a,o,s,u,l,c,d,f,h,v,p,m,g,y,b;return de(this,function(S){if(!e.webgl)throw new Error("webgl context required to create volume isosurface texture-mesh");return a=t.grid.stats,o=a.max,s=a.min,u=o-s,l=Ct.IsoValue.toAbsolute(n.isoValue,t.grid.stats).absoluteValue,c=(l-s)/u,d=hD.get(t,e.webgl),f=d.texture,h=d.gridDimension,v=d.gridTexDim,p=d.gridTexScale,m=d.transform,g=i==null?void 0:i.doubleBuffer.get(),y=mL(e.webgl,f,h,v,p,m,c,l<0,!1,g==null?void 0:g.vertex,g==null?void 0:g.group,g==null?void 0:g.normal),b=Ru.create(y.vertexCount,1,y.vertexTexture,y.groupTexture,y.normalTexture,Ct.getBoundingSphere(t),i),[2,b]})})}function qZe(e){return Vb({defaultProps:I.getDefaultValues(xL),createGeometry:GZe,createLocationIterator:function(t){return mn(t.grid.cells.data.length,1,1,function(){return Ko})},getLoci:yL,eachLocation:bL,setUpdateState:function(t,r,n,i){Ct.IsoValue.areSame(n.isoValue,i.isoValue,r.grid.stats)||(t.createGeometry=!0)},geometryUtils:Ru.Utils,mustRecreate:function(t,r,n){return!r.tryUseGpu||!n||!gL(t,n)},dispose:function(t){t.vertexTexture.ref.value.destroy(),t.groupTexture.ref.value.destroy(),t.normalTexture.ref.value.destroy(),t.doubleBuffer.destroy()}},e)}function WZe(e,t,r,n,i){return ce(this,void 0,void 0,function(){var a,o,s;return de(this,function(u){switch(u.label){case 0:return e.runtime.update({message:"Marching cubes..."}),a=Fs(new Int32Array(t.grid.cells.data.length)),[4,pL({isoLevel:Ct.IsoValue.toAbsolute(n.isoValue,t.grid.stats).absoluteValue,scalarField:t.grid.cells,idField:Pr.create(t.grid.cells.space,Pr.Data1(a))},i).runAsChild(e.runtime)];case 1:return o=u.sent(),s=_a.getGridToCartesianTransform(t.grid),bn.transform(o,s),o.setBoundingSphere(Ct.getBoundingSphere(t)),[2,o]}})})}var Xte=E(E(E({},bn.Params),$te),{quality:E(E({},bn.Params.quality),{isEssential:!1}),sizeFactor:I.Numeric(3,{min:0,max:10,step:.1})});function $Ze(e){return Vb({defaultProps:I.getDefaultValues(Xte),createGeometry:WZe,createLocationIterator:function(t){return mn(t.grid.cells.data.length,1,1,function(){return Ko})},getLoci:yL,eachLocation:bL,setUpdateState:function(t,r,n,i){Ct.IsoValue.areSame(n.isoValue,i.isoValue,r.grid.stats)||(t.createGeometry=!0)},geometryUtils:bn.Utils},e)}var Yte={solid:function(e,t){return U_("Isosurface mesh",e,t,zZe,Kz)},wireframe:function(e,t){return U_("Isosurface wireframe",e,t,$Ze,Kz)}},Kte=E(E(E({},xL),Xte),{visuals:I.MultiSelect(["solid"],I.objectToOptions(Yte))});function XZe(e,t){var r=I.clone(Kte);return r.isoValue=Ct.createIsoValueParam(Ct.IsoValue.relative(2),t.grid.stats),r}function YZe(e,t){return or.createMulti("Isosurface",e,t,or.StateBuilder,Yte)}var KZe={name:"isosurface",label:"Isosurface",description:"Displays a triangulated isosurface of volumetric data.",factory:YZe,getParams:XZe,defaultValues:I.getDefaultValues(Kte),defaultColorTheme:{name:"uniform"},defaultSizeTheme:{name:"uniform"},isApplicable:function(e){return!Ct.isEmpty(e)}};function QZe(e,t,r,n,i){return ce(this,void 0,void 0,function(){var a,o,s,u,l,c,d,f,h,v,p,m,g,y,b,S,x,C,w,A,M,D,k,R,L,H,B,j,Q,G,W,q,ee,he,$,X,U,z;return de(this,function(J){for(a=n.dimension.name,o=n.isoValue,s=t.grid.cells,u=s.space,l=s.data,c=t.grid.stats,d=c.min,f=c.max,h=Ct.IsoValue.toAbsolute(o,t.grid.stats).absoluteValue,v=r.color.color(Ko,!1),p=at.toRgbNormalized(v),m=p[0],g=p[1],y=p[2],b=SL(t.grid,n),S=b.width,x=b.height,C=b.x,w=b.y,A=b.z,M=b.x0,D=b.y0,k=b.z0,R=b.nx,L=b.ny,H=b.nz,B=new Float32Array(a==="x"?[C,0,0,C,w,0,C,0,A,C,w,A]:a==="y"?[0,w,0,C,w,0,0,w,A,C,w,A]:[0,0,A,0,w,A,C,0,A,C,w,A]),j=new Uint8Array(S*x*4),Q=ZZe(t.grid,n),G=0,W=D;W<L;++W)for(q=M;q<R;++q)for(ee=k;ee<H;++ee)he=u.get(l,q,W,ee),$=(he-d)/(f-d),j[G]=m*$*2*255,j[G+1]=g*$*2*255,j[G+2]=y*$*2*255,j[G+3]=he>=h?255:0,G+=4;return X={width:S,height:x,array:j,flipY:!0},U={width:S,height:x,array:Q,flipY:!0},z=_a.getGridToCartesianTransform(t.grid),Qp(z,B,0,4),[2,Uc.create(X,B,U,i)]})})}function SL(e,t){var r=t.dimension,n=r.name,i=r.params,a=e.cells.space,o,s,u,l,c,d=0,f=0,h=0,v=a.dimensions,p=v[0],m=v[1],g=v[2];return n==="x"?(u=i,l=m-1,c=g-1,o=g,s=m,d=u,p=d+1):n==="y"?(u=p-1,l=i,c=g-1,o=g,s=p,f=l,m=f+1):(u=p-1,l=m-1,c=i,o=p,s=m,h=c,g=h+1),{width:o,height:s,x:u,y:l,z:c,x0:d,y0:f,z0:h,nx:p,ny:m,nz:g}}function ZZe(e,t){for(var r=e.cells.space,n=SL(e,t),i=n.width,a=n.height,o=n.x0,s=n.y0,u=n.z0,l=n.nx,c=n.ny,d=n.nz,f=new Uint8Array(i*a*4),h=0,v=s;v<c;++v)for(var p=o;p<l;++p)for(var m=u;m<d;++m)Db(r.dataOffset(p,v,m),f,h),h+=4;return f}function JZe(e,t){for(var r=e.cells.space,n=SL(e,t),i=n.width,a=n.height,o=n.x0,s=n.y0,u=n.z0,l=n.nx,c=n.ny,d=n.nz,f=new Uint32Array(i*a),h=0,v=s;v<c;++v)for(var p=o;p<l;++p)for(var m=u;m<d;++m)f[h]=r.dataOffset(p,v,m),h+=1;return f}function eJe(e,t){var r=JZe(e.grid,t);return Ct.Cell.Loci(e,Je.ofUnsortedArray(r))}function tJe(e,t,r,n){var i=e.objectId,a=e.groupId;return n===i?Ct.Cell.Loci(t,Te.ofSingleton(a)):Or}function rJe(e,t,r,n){return vL(e,t,void 0,n)}var CL=E(E({},Uc.Params),{quality:E(E({},Uc.Params.quality),{isEssential:!1}),dimension:I.MappedStatic("x",{x:I.Numeric(0,{min:0,max:0,step:1}),y:I.Numeric(0,{min:0,max:0,step:1}),z:I.Numeric(0,{min:0,max:0,step:1})},{isEssential:!0}),isoValue:Ct.IsoValueParam});function nJe(e,t){var r=I.clone(CL),n=t.grid.cells.space.dimensions;return r.dimension=I.MappedStatic("x",{x:I.Numeric(0,{min:0,max:n[0]-1,step:1}),y:I.Numeric(0,{min:0,max:n[1]-1,step:1}),z:I.Numeric(0,{min:0,max:n[2]-1,step:1})},{isEssential:!0}),r.isoValue=Ct.createIsoValueParam(Ct.IsoValue.absolute(t.grid.stats.min),t.grid.stats),r}function iJe(e){return Vb({defaultProps:I.getDefaultValues(CL),createGeometry:QZe,createLocationIterator:function(t){return mn(t.grid.cells.data.length,1,1,function(){return Ko})},getLoci:tJe,eachLocation:rJe,setUpdateState:function(t,r,n,i,a,o){t.createGeometry=n.dimension.name!==i.dimension.name||n.dimension.params!==i.dimension.params||!Ct.IsoValue.areSame(n.isoValue,i.isoValue,r.grid.stats)||!jc.areEqual(a.color,o.color)},geometryUtils:E(E({},Uc.Utils),{createRenderableState:function(t){var r=Uc.Utils.createRenderableState(t);return Qz(r,t),r},updateRenderableState:Qz})},e)}function Qz(e,t){Uc.Utils.updateRenderableState(e,t),e.opaque=!1,e.writeDepth=!0}function aJe(e,t){return U_("Slice",e,t,iJe,eJe)}var oJe={name:"slice",label:"Slice",description:"Slice of volume rendered as image with interpolation.",factory:aJe,getParams:nJe,defaultValues:I.getDefaultValues(CL),defaultColorTheme:{name:"uniform"},defaultSizeTheme:{name:"uniform"},isApplicable:function(e){return!Ct.isEmpty(e)}};function Qte(e,t){var r=Xt();return Xt.add(r,e),Xt.transform(r,r,t),r}function sJe(e,t,r,n){var i=r.grid.cells.space.dimensions,a=Hb(i),o=a.width,s=a.height;if(Math.max(o,s)>t.maxTextureSize/2)throw new Error("volume too large for direct-volume rendering");var u=qte(r,"normals"),l=_a.getGridToCartesianTransform(r.grid),c=Qte(i,l),d=n?n.gridTexture.ref.value:t.resources.texture("image-uint8","rgba","ubyte","linear");d.load(u);var f=Zte(r.grid),h=f.unitToCartn,v=f.cellDim;return Ya.create(c,i,l,h,v,d,r.grid.stats,!1,n)}function Zte(e){if(e.transform.kind==="matrix")return{unitToCartn:ue.mul(ue(),e.transform.matrix,ue.fromScaling(ue(),e.cells.space.dimensions)),cellDim:ue.getScaling(_(),e.transform.matrix)};var t=e.transform.fractionalBox,r=Xt.size(_(),t);return{unitToCartn:ue.mul3(ue(),e.transform.cell.fromFractional,ue.fromTranslation(ue(),t.min),ue.fromScaling(ue(),r)),cellDim:_.div(_(),e.transform.cell.size,e.cells.space.dimensions)}}function uJe(e,t,r,n){var i=r.grid.cells.space.dimensions;if(Math.max.apply(Math,i)>t.max3dTextureSize/2)throw new Error("volume too large for direct-volume rendering");var a=fZe(r),o=_a.getGridToCartesianTransform(r.grid),s=Qte(i,o),u=n?n.gridTexture.ref.value:t.resources.texture("volume-uint8","rgba","ubyte","linear");u.load(a);var l=Zte(r.grid),c=l.unitToCartn,d=l.cellDim;return Ya.create(s,i,o,c,d,u,r.grid.stats,!1,n)}function lJe(e,t,r,n,i){return ce(this,void 0,void 0,function(){var a,o;return de(this,function(s){if(a=e.runtime,o=e.webgl,o===void 0)throw new Error("DirectVolumeVisual requires `webgl` in props");return[2,o.isWebGL2?uJe(a,o,t,i):sJe(a,o,t,i)]})})}function cJe(e,t){return t.renderMode.name==="isosurface"?Ct.Isosurface.Loci(e,t.renderMode.params.isoValue):Ct.Loci(e)}function dJe(e,t,r,n){var i=e.objectId,a=e.groupId;return n===i?Ct.Cell.Loci(t,Te.ofSingleton(a)):Or}function fJe(e,t,r,n){var i=r.renderMode.name==="isosurface"?r.renderMode.params.isoValue:void 0;return vL(e,t,i,n)}var _L=E(E({},Ya.Params),{quality:E(E({},Ya.Params.quality),{isEssential:!1})});function hJe(e,t){var r=I.clone(_L);return r.renderMode=Ya.createRenderModeParam(t.grid.stats),r}function pJe(e){return Vb({defaultProps:I.getDefaultValues(_L),createGeometry:lJe,createLocationIterator:function(t){return mn(t.grid.cells.data.length,1,1,function(){return Ko})},getLoci:dJe,eachLocation:fJe,setUpdateState:function(t,r,n,i){},geometryUtils:Ya.Utils,dispose:function(t){t.gridTexture.ref.value.destroy()}},e)}function vJe(e,t){return U_("Direct Volume",e,t,pJe,cJe)}var mJe={name:"direct-volume",label:"Direct Volume",description:"Direct rendering of volumetric data.",factory:vJe,getParams:hJe,defaultValues:I.getDefaultValues(_L),defaultColorTheme:{name:"uniform"},defaultSizeTheme:{name:"uniform"},isApplicable:function(e){return!Ct.isEmpty(e)}},H_=function(e){Le(t,e);function t(){var r=e.call(this)||this;return Iu(t.BuiltIn,function(n,i){if(n.name!==i)throw new Error("Fix BuiltInVolumeRepresentations to have matching names. "+n.name+" "+i);r.add(n)}),r}return t}(TJ);(function(e){e.BuiltIn={isosurface:KZe,slice:oJe,"direct-volume":mJe}})(H_||(H_={}));function Zz(e,t,r,n){e.push({source:t==="em"?{name:"em",params:{isoValue:Ct.IsoValue.absolute(n||0)}}:{name:"x-ray",params:{}},dataId:r})}var pD=go.build({display:{name:"Volume Streaming"},from:ge.Molecule.Structure,params:function(e,t){var r=ZQe(e&&e.data),n=tZe(r,e&&e.data);return{method:I.Select(r,[["em","EM"],["x-ray","X-Ray"]]),entries:I.ObjectList({id:I.Text(n[0]||"")},function(i){var a=i.id;return a},{defaultValue:n.map(function(i){return{id:i}})}),defaultView:I.Select(r==="em"?"cell":"selection-box",Da.ViewTypeOptions),options:I.Group({serverUrl:I.Text(t.config.get(Wr.VolumeStreaming.DefaultServer)||"https://ds.litemol.org"),behaviorRef:I.Text("",{isHidden:!0}),emContourProvider:I.Select("emdb",[["emdb","EMDB"],["pdbe","PDBe"]],{isHidden:!0}),channelParams:I.Value({},{isHidden:!0})})}},isApplicable:function(e,t,r){var n=r.config.get(Wr.VolumeStreaming.CanStream);return n?n(e.data,r):e.data.models.length===1&&Wt.probablyHasDensityMap(e.data.models[0])}})(function(e,t){var r=e.ref,n=e.state,i=e.params;return We.create("Volume Streaming",function(a){return ce(void 0,void 0,void 0,function(){var o,s,u,l,c,d,f,h,v,p,m,g,y,b,S,x,C;return de(this,function(w){switch(w.label){case 0:o=[],s=0,u=i.entries.length,w.label=1;case 1:return s<u?(l=i.entries[s].id.toLowerCase(),c=void 0,i.method!=="em"?[3,14]:l.toUpperCase().startsWith("EMD")?[3,11]:[4,a.update("Getting EMDB info...")]):[3,16];case 2:return w.sent(),[4,iZe(t,a,l)];case 3:d=w.sent(),f=0,h=d.length,w.label=4;case 4:if(!(f<h))return[3,10];v=d[f],p=void 0,w.label=5;case 5:return w.trys.push([5,7,,8]),[4,$z(i.options.emContourProvider,t,a,v)];case 6:return p=w.sent(),[3,8];case 7:return m=w.sent(),console.info("Could not get map info for "+v+": "+m),[3,9];case 8:Zz(o,i.method,v,p||0),w.label=9;case 9:return++f,[3,4];case 10:return[3,15];case 11:return w.trys.push([11,13,,14]),[4,$z(i.options.emContourProvider,t,a,l)];case 12:return c=w.sent(),[3,14];case 13:return g=w.sent(),console.info("Could not get map info for "+l+": "+g),[3,15];case 14:Zz(o,i.method,l,c||0),w.label=15;case 15:return++s,[3,1];case 16:return y=n.build().to(r).applyOrUpdateTagged(Da.RootTag,bJe,{serverUrl:i.options.serverUrl,entries:o}),[4,y.commit()];case 17:return w.sent(),b=y.selector,b.isOk?(S=n.tree.children.get(b.ref),(S==null?void 0:S.size)>0?[4,t.managers.structure.hierarchy.remove(S==null?void 0:S.toArray())]:[3,19]):[2];case 18:w.sent(),w.label=19;case 19:return x=b.cell.obj,C=n.build().to(y.ref).apply(wL,I.getDefaultValues(Da.createParams({data:x.data,defaultView:i.defaultView,channelParams:i.options.channelParams})),{ref:i.options.behaviorRef?i.options.behaviorRef:void 0}),i.method==="em"?C.apply(bx,{channel:"em"},{state:{isGhost:!0},tags:"em"}):(C.apply(bx,{channel:"2fo-fc"},{state:{isGhost:!0},tags:"2fo-fc"}),C.apply(bx,{channel:"fo-fc(+ve)"},{state:{isGhost:!0},tags:"fo-fc(+ve)"}),C.apply(bx,{channel:"fo-fc(-ve)"},{state:{isGhost:!0},tags:"fo-fc(-ve)"})),[4,n.updateTree(C).runInContext(a)];case 20:return w.sent(),[2]}})})})}),gJe=go.build({display:{name:"Boxify Volume Streaming",description:"Make the current box permanent."},from:Da,isApplicable:function(e){return e.data.params.entry.params.view.name==="selection-box"}})(function(e,t){var r=e.a,n=e.ref,i=e.state,a=r.data.params;if(a.entry.params.view.name==="selection-box"){var o=Xt.create(_.clone(a.entry.params.view.params.bottomLeft),_.clone(a.entry.params.view.params.topRight)),s=a.entry.params.view.params.radius;Xt.expand(o,o,_.create(s,s,s));var u=E(E({},a),{entry:{name:a.entry.name,params:E(E({},a.entry.params),{view:{name:"box",params:{bottomLeft:o.min,topRight:o.max}}})}});return i.updateTree(i.build().to(n).update(u))}}),yJe={dataId:I.Text(""),source:I.MappedStatic("x-ray",{em:I.Group({isoValue:Ct.createIsoValueParam(Ct.IsoValue.relative(1))}),"x-ray":I.Group({})})},bJe=kt.BuiltIn({name:"create-volume-streaming-info",display:{name:"Volume Streaming Info"},from:ge.Molecule.Structure,to:fD,params:function(e){return{serverUrl:I.Text("https://ds.litemol.org"),entries:I.ObjectList(yJe,function(t){var r=t.dataId;return r},{defaultValue:[{dataId:"",source:{name:"x-ray",params:{}}}]})}}})({apply:function(e,t){var r=e.a,n=e.params;return We.create("",function(i){return ce(void 0,void 0,void 0,function(){var a,o,s,u,l,c,d,f;return de(this,function(h){switch(h.label){case 0:a=[],o=0,s=n.entries.length,h.label=1;case 1:return o<s?(u=n.entries[o],l=u.dataId,c=u.source.name==="em"?u.source.params.isoValue:Ct.IsoValue.relative(1),[4,i.update("Getting server header...")]):[3,5];case 2:return h.sent(),[4,t.fetch({url:iE(n.serverUrl,u.source.name+"/"+l.toLocaleLowerCase()),type:"json"}).runInContext(i)];case 3:d=h.sent(),a.push({dataId:l,kind:u.source.name,header:d,emDefaultContourLevel:c}),h.label=4;case 4:return++o,[3,1];case 5:return f={serverUrl:n.serverUrl,entries:a,structure:r.data},[2,new fD(f,{label:"Volume Server",description:""+a.map(function(v){return v.dataId}).join(", ")})]}})})})}}),wL=kt.BuiltIn({name:"create-volume-streaming-behavior",display:{name:"Volume Streaming Behavior"},from:fD,to:Da,params:function(e){return Da.createParams({data:e&&e.data})}})({canAutoUpdate:function(e){var t=e.oldParams,r=e.newParams;return t.entry.params.view===r.entry.params.view||r.entry.params.view.name==="selection-box"||r.entry.params.view.name==="off"},apply:function(e,t){var r=e.a,n=e.params;return We.create("Volume streaming",function(i){return ce(void 0,void 0,void 0,function(){var a;return de(this,function(o){switch(o.label){case 0:return a=new Da.Behavior(t,r.data),[4,a.update(n)];case 1:return o.sent(),[2,new Da(a,{label:"Volume Streaming",description:a.getDescription()})]}})})})},update:function(e){var t=this;e.a;var r=e.b,n=e.oldParams,i=e.newParams;return We.create("Update Volume Streaming",function(a){return ce(t,void 0,void 0,function(){var o,s;return de(this,function(u){switch(u.label){case 0:return n.entry.name!==i.entry.name&&"em"in i.entry.params.channels&&(o=r.data.infoMap.get(i.entry.name).emDefaultContourLevel,o&&(i.entry.params.channels.em.isoValue=o)),[4,r.data.update(i)];case 1:return s=u.sent()?ft.UpdateResult.Updated:ft.UpdateResult.Unchanged,r.description=r.data.getDescription(),[2,s]}})})})}}),bx=kt.BuiltIn({name:"create-volume-streaming-visual",display:{name:"Volume Streaming Visual"},from:Da,to:ge.Volume.Representation3D,params:{channel:I.Select("em",Da.ChannelTypeOptions,{isHidden:!0})}})({apply:function(e,t){var r=e.a,n=e.params,i=e.spine;return We.create("Volume Representation",function(a){return ce(void 0,void 0,void 0,function(){var o,s,u,l,c,d,f,h,v;return de(this,function(p){switch(p.label){case 0:return o=r.data.channels[n.channel],o?(s=Jz(r.data,n.channel),u=H_.BuiltIn.isosurface,l=s.type.params||{},c=u.factory(E({webgl:(h=t.canvas3d)===null||h===void 0?void 0:h.webgl},t.representation.volume.themes),u.getParams),c.setTheme(hi.create(t.representation.volume.themes,{volume:o.data},s)),d=(v=i.getAncestorOfType(ge.Molecule.Structure))===null||v===void 0?void 0:v.data,f=(d==null?void 0:d.models.length)===0?void 0:xp.get(d==null?void 0:d.models[0]),[4,c.createOrUpdate(l,o.data).runInContext(a)]):[2,In.Null];case 1:return p.sent(),f&&c.setState({transform:f}),[2,new ge.Volume.Representation3D({repr:c,sourceData:o.data},{label:Math.round(o.isoValue.relativeValue*100)/100+" σ ["+n.channel+"]"})]}})})})},update:function(e,t){var r=e.a,n=e.b,i=e.newParams;return e.spine,We.create("Volume Representation",function(a){return ce(void 0,void 0,void 0,function(){var o,s,u,l;return de(this,function(c){switch(c.label){case 0:return o=r.data.channels[i.channel],o?(s=n.data.repr.state.visible,u=Jz(r.data,i.channel),l=E(E({},n.data.repr.props),u.type.params),n.data.repr.setTheme(hi.create(t.representation.volume.themes,{volume:o.data},u)),[4,n.data.repr.createOrUpdate(l,o.data).runInContext(a)]):[2,ft.UpdateResult.Unchanged];case 1:return c.sent(),n.data.repr.setState({visible:s}),n.data.sourceData=o.data,[2,ft.UpdateResult.Updated]}})})})}});function Jz(e,t){var r=e.channels[t];return xc.getDefaultParamsStatic(e.plugin,"isosurface",{isoValue:r.isoValue,alpha:r.opacity,visuals:r.wireframe?["wireframe"]:["solid"]},"uniform",{value:r.color})}var EL=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r._getInfo=Kf(function(n,i){return nv.infoFromAction(r.plugin,r.props.state,r.props.action,r.props.nodeRef)}),r.state={plugin:r.plugin,ref:r.props.nodeRef,version:r.props.state.transforms.get(r.props.nodeRef).version,error:void 0,isInitial:!0,params:r.getInfo().initialValues,busy:!1,isCollapsed:r.props.initiallyCollapsed},r}return t.prototype.applyAction=function(){return _t.State.ApplyAction(this.plugin,{state:this.props.state,action:this.props.action.create(this.state.params),ref:this.props.nodeRef})},t.prototype.getInfo=function(){return this._getInfo(this.props.nodeRef,this.props.state.transforms.get(this.props.nodeRef).version)},t.prototype.getTransformerId=function(){return this.props.state.transforms.get(this.props.nodeRef).transformer.id},t.prototype.getHeader=function(){return this.props.hideHeader?"none":this.props.action.definition.display},t.prototype.canApply=function(){return!this.state.error&&!this.state.busy},t.prototype.canAutoApply=function(){return!1},t.prototype.applyText=function(){return"Apply"},t.prototype.isUpdate=function(){return!1},t.prototype.getSourceAndTarget=function(){return{a:this.props.state.cells.get(this.props.nodeRef).obj}},t.getDerivedStateFromProps=function(r,n){var i=r.state.transforms.get(r.nodeRef).version;if(r.nodeRef===n.ref&&i===n.version)return null;var a=r.state.cells.get(r.nodeRef).obj,o=r.action.definition.params?I.getDefaultValues(r.action.definition.params(a,n.plugin)):{},s={plugin:n.plugin,ref:r.nodeRef,version:i,params:o,isInitial:!0,error:void 0};return s},t}(Mte),xJe=function(e){Le(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.defaultState=function(){return{header:"Volume Streaming",isCollapsed:!1,isBusy:!1,isHidden:!0,brand:{accent:"cyan",svg:CY}}},t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.managers.structure.hierarchy.behaviors.selection,function(){r.setState({isHidden:!r.canEnable(),description:ab.getSelectedStructuresDescription(r.plugin)})}),this.subscribe(this.plugin.state.events.cell.stateUpdated,function(n){cr.hasTag(n.cell.transform,Da.RootTag)&&r.forceUpdate()}),this.subscribe(this.plugin.behaviors.state.isBusy,function(n){r.setState({isBusy:n})})},Object.defineProperty(t.prototype,"pivot",{get:function(){return this.plugin.managers.structure.hierarchy.selection.structures[0]},enumerable:!1,configurable:!0}),t.prototype.canEnable=function(){var r,n,i=this.plugin.managers.structure.hierarchy.selection;if(i.structures.length!==1)return!1;var a=this.pivot.cell;return a.obj?!!(!((n=(r=pD.definition).isApplicable)===null||n===void 0)&&n.call(r,a.obj,a.transform,this.plugin)):!1},t.prototype.renderEnable=function(){var r,n=this.pivot;if(!n.cell.parent)return null;var i=ir.findTagInSubtree(n.cell.parent.tree,this.pivot.cell.transform.ref,Da.RootTag),a=i&&n.cell.parent.cells.get(i),o=a&&a.status==="error"?{header:"Error enabling",icon:Y8,title:a.errorText}:a&&((r=a.obj)===null||r===void 0?void 0:r.data.entries.length)===0?{header:"Error enabling",icon:Y8,title:"No entry for streaming found"}:{header:"Enable",icon:qg,title:"Enable"};return T.jsx(EL,{state:n.cell.parent,action:pD,initiallyCollapsed:!0,nodeRef:n.cell.transform.ref,simpleApply:o},void 0)},t.prototype.renderParams=function(){var r,n,i,a,o,s=this.pivot;if(!s.cell.parent)return null;var u=((n=(r=s.volumeStreaming)===null||r===void 0?void 0:r.cell.transform.params)===null||n===void 0?void 0:n.entry.params.view.name)==="selection-box"&&((o=(a=(i=this.plugin.state.behaviors.cells.get(oE.id))===null||i===void 0?void 0:i.params)===null||a===void 0?void 0:a.values)===null||o===void 0?void 0:o.bindings);return T.jsxs(T.Fragment,{children:[T.jsx(Wc,{state:s.cell.parent,transform:s.volumeStreaming.cell.transform,customHeader:"none",noMargin:!0},void 0),u&&T.jsx(Tu,E({header:"Controls Help"},{children:T.jsx(dD,{bindings:u},void 0)}),void 0)]},void 0)},t.prototype.renderControls=function(){var r=this.pivot;return r?r.volumeStreaming?this.renderParams():this.renderEnable():null},t}(Wg),SJe=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.item=function(n){var i,a=r.plugin.managers.volume.hierarchy.selection,o=((i=n.cell.obj)===null||i===void 0?void 0:i.label)||"Volume",s={kind:"item",label:(n.kind==="lazy-volume"?"Load ":"")+(o||n.kind),selected:a===n,value:n};return s},r.selectCurrent=function(n){if(r.toggleHierarchy(),!!n){var i=n.value;i.kind==="volume"?r.plugin.managers.volume.hierarchy.setCurrent(i):r.lazyLoad(i.cell)}},r.selectAdd=function(n){n&&(r.setState({show:void 0}),n.value())},r.toggleHierarchy=function(){return r.setState({show:r.state.show!=="hierarchy"?"hierarchy":void 0})},r.toggleAddRepr=function(){return r.setState({show:r.state.show!=="add-repr"?"add-repr":void 0})},r}return t.prototype.defaultState=function(){return{header:"Volume",isCollapsed:!1,isBusy:!1,isHidden:!0,brand:{accent:"purple",svg:CY}}},t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.managers.volume.hierarchy.behaviors.selection,function(n){r.setState({isHidden:n.hierarchy.volumes.length===0&&n.hierarchy.lazyVolumes.length===0})}),this.subscribe(this.plugin.behaviors.state.isBusy,function(n){r.setState({isBusy:n})})},Object.defineProperty(t.prototype,"hierarchyItems",{get:function(){for(var r=this.plugin.managers.volume.hierarchy,n=r.current,i=[],a=0,o=n.volumes;a<o.length;a++){var s=o[a];i.push(this.item(s))}for(var u=0,l=n.lazyVolumes;u<l.length;u++){var s=l[u];i.push(this.item(s))}return i},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"addActions",{get:function(){var r=this.plugin.managers.volume.hierarchy,n=r.selection,i=Ft([],B_.getRepresentationTypes(this.plugin,n).map(function(a){return er.Item(a[1],function(){return r.addRepresentation(n,a[0])})}));return i},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isEmpty",{get:function(){var r=this.plugin.managers.volume.hierarchy.current,n=r.volumes,i=r.lazyVolumes;return n.length===0&&i.length===0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"label",{get:function(){var r;if(this.state.loadingLabel)return"Loading "+this.state.loadingLabel+"...";var n=this.plugin.managers.volume.hierarchy.selection;return n?((r=n==null?void 0:n.cell.obj)===null||r===void 0?void 0:r.label)||"Volume":"Nothing Selected"},enumerable:!1,configurable:!0}),t.prototype.lazyLoad=function(r){return ce(this,void 0,void 0,function(){var n,i,a,o,s,u,l,c=this;return de(this,function(d){switch(d.label){case 0:n=r.obj.data,i=n.url,a=n.isBinary,o=n.format,s=n.entryId,u=n.isovalues,this.setState({isBusy:!0,loadingLabel:r.obj.label}),d.label=1;case 1:return d.trys.push([1,,3,4]),l=this.plugin,[4,l.dataTransaction(function(){return ce(c,void 0,void 0,function(){var f,h,v,p,m,g,y,b,S,x,C;return de(this,function(w){switch(w.label){case 0:return[4,l.builders.data.download({url:i,isBinary:a},{state:{isGhost:!0}})];case 1:return f=w.sent(),[4,l.dataFormats.get(o).parse(l,f,{entryId:s})];case 2:if(h=w.sent(),v=h.volume||h.volumes[0],!(v!=null&&v.isOk))throw new Error("Failed to parse any volume.");for(p=l.build(),m=0,g=u;m<g.length;m++)y=g[m],p.to((x=(b=h.volumes)===null||b===void 0?void 0:b[(S=y.volumeIndex)!==null&&S!==void 0?S:0])!==null&&x!==void 0?x:h.volume).apply(rt.Representation.VolumeRepresentation3D,Jm(this.plugin,v.data,{type:"isosurface",typeParams:{alpha:(C=y.alpha)!==null&&C!==void 0?C:1,isoValue:y.type==="absolute"?{kind:"absolute",absoluteValue:y.value}:{kind:"relative",relativeValue:y.value}},color:"uniform",colorParams:{value:y.color}}));return[4,p.commit()];case 3:return w.sent(),[4,l.build().delete(r).commit()];case 4:return w.sent(),[2]}})})})];case 2:return d.sent(),[3,4];case 3:return this.setState({isBusy:!1,loadingLabel:void 0}),[7];case 4:return[2]}})})},t.prototype.renderControls=function(){var r=this.state.isBusy||this.isEmpty,n=this.label,i=this.plugin.managers.volume.hierarchy.selection;return T.jsxs(T.Fragment,{children:[T.jsxs("div",E({className:"msp-flex-row",style:{marginTop:"1px"}},{children:[T.jsx(hr,E({noOverflow:!0,flex:!0,onClick:this.toggleHierarchy,disabled:r,title:n},{children:n}),void 0),!this.isEmpty&&i&&T.jsx(Ht,{svg:Gg,onClick:this.toggleAddRepr,title:"Apply a structure presets to the current hierarchy.",toggleState:this.state.show==="add-repr",disabled:r},void 0)]}),void 0),this.state.show==="hierarchy"&&T.jsx(er,{items:this.hierarchyItems,onSelect:this.selectCurrent},void 0),this.state.show==="add-repr"&&T.jsx(er,{items:this.addActions,onSelect:this.selectAdd},void 0),i&&i.representations.length>0&&T.jsx("div",E({style:{marginTop:"6px"}},{children:i.representations.map(function(a){return T.jsx(CJe,{representation:a},a.cell.transform.ref)})}),void 0)]},void 0)},t}(Wg),CJe=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={action:void 0},r.remove=function(){return r.plugin.managers.volume.hierarchy.remove([r.props.representation],!0)},r.toggleVisible=function(n){n.preventDefault(),n.currentTarget.blur(),r.plugin.managers.volume.hierarchy.toggleVisibility([r.props.representation])},r.toggleUpdate=function(){return r.setState({action:r.state.action==="update"?void 0:"update"})},r.highlight=function(n){n.preventDefault(),r.props.representation.cell.parent&&_t.Interactivity.Object.Highlight(r.plugin,{state:r.props.representation.cell.parent,ref:r.props.representation.cell.transform.ref})},r.clearHighlight=function(n){n.preventDefault(),_t.Interactivity.ClearHighlights(r.plugin)},r.focus=function(){var n,i=r.props.representation,a=(n=r.props.representation.cell.obj)===null||n===void 0?void 0:n.data.repr.renderObjects;i.cell.state.isHidden&&r.plugin.managers.volume.hierarchy.toggleVisibility([r.props.representation],"show"),r.plugin.managers.camera.focusRenderObjects(a,{extraRadius:1})},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.state.events.cell.stateUpdated,function(n){Wf.ObjectEvent.isCell(n,r.props.representation.cell)&&r.forceUpdate()})},t.prototype.render=function(){var r,n,i,a=this.props.representation.cell;return T.jsxs(T.Fragment,{children:[T.jsxs("div",E({className:"msp-flex-row"},{children:[T.jsxs(hr,E({noOverflow:!0,className:"msp-control-button-label",title:((r=a.obj)===null||r===void 0?void 0:r.label)+". Click to focus.",onClick:this.focus,onMouseEnter:this.highlight,onMouseLeave:this.clearHighlight,style:{textAlign:"left"}},{children:[(n=a.obj)===null||n===void 0?void 0:n.label,T.jsx("small",E({className:"msp-25-lower-contrast-text",style:{float:"right"}},{children:(i=a.obj)===null||i===void 0?void 0:i.description}),void 0)]}),void 0),T.jsx(Ht,{svg:a.state.isHidden?fv:hv,toggleState:!1,onClick:this.toggleVisible,title:(a.state.isHidden?"Show":"Hide")+" component",small:!0,className:"msp-form-control",flex:!0},void 0),T.jsx(Ht,{svg:Vs,onClick:this.remove,title:"Remove",small:!0},void 0),T.jsx(Ht,{svg:jp,onClick:this.toggleUpdate,title:"Actions",toggleState:this.state.action==="update"},void 0)]}),void 0),this.state.action==="update"&&!!a.parent&&T.jsx("div",E({style:{marginBottom:"6px"},className:"msp-accent-offset"},{children:T.jsx(Wc,{state:a.parent,transform:a.transform,customHeader:"none",noMargin:!0},void 0)}),void 0)]},void 0)},t}(Gi),G_;(function(e){function t(n){return{size:n,matrix:Ar.create(n,n),eigenValues:new Float64Array(n),D:new Float64Array(n),E:new Float64Array(n)}}e.createCache=t;function r(n){_Je(n.size,n.matrix.data,n.eigenValues,n.D,n.E)}e.compute=r})(G_||(G_={}));function _Je(e,t,r,n,i){for(var a=0;a<e;a++)i[a]=0;for(var o=e-1,a=0;a<e;a++)n[a]=t[a*e+o];wJe(t,n,i,e),EJe(t,n,i,e);for(var a=0;a<e;a++)r[a]=n[a]}function wJe(e,t,r,n){for(var i=n-1;i>0;i--){for(var a=0,o=0,s=0;s<i;s++)a=a+Math.abs(t[s]);if(a===0){r[i]=t[i-1];for(var u=0;u<i;u++)t[u]=e[u*n+i-1],e[u*n+i]=0,e[i*n+u]=0}else{for(var s=0;s<i;s++)t[s]/=a,o+=t[s]*t[s];var l=t[i-1],c=Math.sqrt(o);l>0&&(c=-c),r[i]=a*c,o=o-l*c,t[i-1]=l-c;for(var u=0;u<i;u++)r[u]=0;for(var u=0;u<i;u++){l=t[u],e[i*n+u]=l,c=r[u]+e[u*n+u]*l;for(var s=u+1;s<=i-1;s++)c+=e[u*n+s]*t[s],r[s]+=e[u*n+s]*l;r[u]=c}l=0;for(var u=0;u<i;u++)r[u]/=o,l+=r[u]*t[u];for(var d=l/(o+o),u=0;u<i;u++)r[u]-=d*t[u];for(var u=0;u<i;u++){l=t[u],c=r[u];for(var s=u;s<=i-1;s++)e[u*n+s]-=l*r[s]+c*t[s];t[u]=e[u*n+i-1],e[u*n+i]=0}}t[i]=o}for(var i=0;i<n-1;i++){e[i*n+n-1]=e[i*n+i],e[i*n+i]=1;var o=t[i+1];if(o!==0){for(var s=0;s<=i;s++)t[s]=e[(i+1)*n+s]/o;for(var u=0;u<=i;u++){for(var c=0,s=0;s<=i;s++)c+=e[(i+1)*n+s]*e[u*n+s];for(var s=0;s<=i;s++)e[u*n+s]-=c*t[s]}}for(var s=0;s<=i;s++)e[(i+1)*n+s]=0}for(var u=0;u<n;u++)t[u]=e[u*n+n-1],e[u*n+n-1]=0;e[n*n-1]=1,r[0]=0}function EJe(e,t,r,n){for(var i=1e3,a=1;a<n;a++)r[a-1]=r[a];r[n-1]=0;for(var o=0,s=0,u=Math.pow(2,-53),l=0;l<n;l++){s=Math.max(s,Math.abs(t[l])+Math.abs(r[l]));for(var c=l;c<n&&!(Math.abs(r[c])<=u*s);)c++;if(c>l){var d=0;do{d=d+1;var f=t[l],h=(t[l+1]-f)/(2*r[l]),v=eV(h,1);h<0&&(v=-v),t[l]=r[l]/(h+v),t[l+1]=r[l]*(h+v);for(var p=t[l+1],m=f-t[l],a=l+2;a<n;a++)t[a]-=m;o=o+m,h=t[c];for(var g=1,y=g,b=g,S=r[l+1],x=0,C=0,a=c-1;a>=l;a--){b=y,y=g,C=x,f=g*r[a],m=g*h,v=eV(h,r[a]),r[a+1]=x*v,x=r[a]/v,g=h/v,h=g*t[a]-x*f,t[a+1]=m+x*(g*f+x*t[a]);for(var w=0;w<n;w++)m=e[(a+1)*n+w],e[(a+1)*n+w]=x*e[a*n+w]+g*m,e[a*n+w]=g*e[a*n+w]-x*m}if(h=-x*C*b*S*r[l]/p,r[l]=x*h,t[l]=g*h,d>=i)throw"SVD: Not converging."}while(Math.abs(r[l])>u*s)}t[l]=t[l]+o,r[l]=0}for(var a=0;a<n-1;a++){for(var w=a,h=t[a],A=a+1;A<n;A++)t[A]<h&&(w=A,h=t[A]);if(w!==a){t[w]=t[a],t[a]=h;for(var A=0;A<n;A++)h=e[a*n+A],e[a*n+A]=e[w*n+A],e[w*n+A]=h}}}function eV(e,t){if(Math.abs(e)>Math.abs(t)){var r=t/e;return Math.abs(e)*Math.sqrt(1+r*r)}if(t!==0){var r=e/t;return Math.abs(t)*Math.sqrt(1+r*r)}return 0}var $c;(function(e){(function(r){function n(i){return{x:new Float64Array(i),y:new Float64Array(i),z:new Float64Array(i)}}r.empty=n})(e.Positions||(e.Positions={}));function t(r,n){return typeof n>"u"&&(n={bTransform:ue.zero(),rmsd:0}),IJe(new AJe(r,n)),n}e.compute=t})($c||($c={}));var AJe=function(){function e(t,r){this.evdCache=G_.createCache(4),this.translateB=ue.identity(),this.rotateB=ue.identity(),this.tempMatrix=ue.identity(),this.a=t.a,this.b=t.b,t.centerA?this.centerA=t.centerA:this.centerA=t.centerA=Bc.fromArrays(t.a,Fe()).center,t.centerB?this.centerB=t.centerB:this.centerB=t.centerB=Bc.fromArrays(t.b,Fe()).center,this.result=r}return e}();function PJe(e){var t=e.evdCache.matrix;Ar.makeZero(t);for(var r=e.a.x,n=e.a.y,i=e.a.z,a=e.b.x,o=e.b.y,s=e.b.z,u=e.centerA,l=e.centerB,c=0,d=0,f=e.a.x.length;d<f;d++){var h=r[d]-u[0],v=n[d]-u[1],p=i[d]-u[2],m=a[d]-l[0],g=o[d]-l[1],y=s[d]-l[2];c+=h*h+v*v+p*p+m*m+g*g+y*y,Ar.add(t,0,0,h*m+v*g+p*y),Ar.add(t,0,1,-(p*g)+v*y),Ar.add(t,0,2,p*m-h*y),Ar.add(t,0,3,-(v*m)+h*g),Ar.add(t,1,0,-(p*g)+v*y),Ar.add(t,1,1,h*m-v*g-p*y),Ar.add(t,1,2,v*m+h*g),Ar.add(t,1,3,p*m+h*y),Ar.add(t,2,0,p*m-h*y),Ar.add(t,2,1,v*m+h*g),Ar.add(t,2,2,-(h*m)+v*g-p*y),Ar.add(t,2,3,p*g+v*y),Ar.add(t,3,0,-(v*m)+h*g),Ar.add(t,3,1,p*m+h*y),Ar.add(t,3,2,p*g+v*y),Ar.add(t,3,3,-(h*m)-v*g+p*y)}return c}function TJe(e){var t=e.evdCache.matrix,r=Ar.get(t,1,3),n=Ar.get(t,2,3),i=Ar.get(t,3,3),a=Ar.get(t,0,3),o=2*n*n,s=2*i*i,u=2*r*r,l=2*r*n,c=2*a*i,d=2*r*i,f=2*a*n,h=2*n*i,v=2*a*r,p=e.translateB;ue.setValue(p,0,3,-e.centerB[0]),ue.setValue(p,1,3,-e.centerB[1]),ue.setValue(p,2,3,-e.centerB[2]),p=e.rotateB,ue.setValue(p,0,0,1-o-s),ue.setValue(p,0,1,l+c),ue.setValue(p,0,2,d-f),ue.setValue(p,1,0,l-c),ue.setValue(p,1,1,1-u-s),ue.setValue(p,1,2,h+v),ue.setValue(p,2,0,d+f),ue.setValue(p,2,1,h-v),ue.setValue(p,2,2,1-u-o),ue.setValue(p,3,3,1),ue.mul(e.tempMatrix,e.rotateB,e.translateB),p=e.translateB,ue.setValue(p,0,3,e.centerA[0]),ue.setValue(p,1,3,e.centerA[1]),ue.setValue(p,2,3,e.centerA[2]),ue.mul(e.result.bTransform,e.translateB,e.tempMatrix)}function IJe(e){var t=PJe(e);G_.compute(e.evdCache);var r=t-2*e.evdCache.eigenValues[3];r=r<0?0:Math.sqrt(r/e.a.x.length),TJe(e),e.result.rmsd=r}var MJe="ACDEFGHIKLMNPQRSTVWY",DJe="ARNDCQEGHILKMFPSTWYVBZX",RJe=[[4,0,-2,-1,-2,0,-2,-1,-1,-1,-1,-2,-1,-1,-1,1,0,0,-3,-2],[0,9,-3,-4,-2,-3,-3,-1,-3,-1,-1,-3,-3,-3,-3,-1,-1,-1,-2,-2],[-2,-3,6,2,-3,-1,-1,-3,-1,-4,-3,1,-1,0,-2,0,-1,-3,-4,-3],[-1,-4,2,5,-3,-2,0,-3,1,-3,-2,0,-1,2,0,0,-1,-2,-3,-2],[-2,-2,-3,-3,6,-3,-1,0,-3,0,0,-3,-4,-3,-3,-2,-2,-1,1,3],[0,-3,-1,-2,-3,6,-2,-4,-2,-4,-3,0,-2,-2,-2,0,-2,-3,-2,-3],[-2,-3,-1,0,-1,-2,8,-3,-1,-3,-2,1,-2,0,0,-1,-2,-3,-2,2],[-1,-1,-3,-3,0,-4,-3,4,-3,2,1,-3,-3,-3,-3,-2,-1,3,-3,-1],[-1,-3,-1,1,-3,-2,-1,-3,5,-2,-1,0,-1,1,2,0,-1,-2,-3,-2],[-1,-1,-4,-3,0,-4,-3,2,-2,4,2,-3,-3,-2,-2,-2,-1,1,-2,-1],[-1,-1,-3,-2,0,-3,-2,1,-1,2,5,-2,-2,0,-1,-1,-1,1,-1,-1],[-2,-3,1,0,-3,0,1,-3,0,-3,-2,6,-2,0,0,1,0,-3,-4,-2],[-1,-3,-1,-1,-4,-2,-2,-3,-1,-3,-2,-2,7,-1,-2,-1,-1,-2,-4,-3],[-1,-3,0,2,-3,-2,0,-3,1,-2,0,0,-1,5,1,0,-1,-2,-2,-1],[-1,-3,-2,0,-3,-2,0,-3,2,-2,-1,0,-2,1,5,-1,-1,-3,-3,-2],[1,-1,0,0,-2,0,-1,-2,0,-2,-1,1,-1,0,-1,4,1,-2,-3,-2],[0,-1,-1,-1,-2,-2,-2,-1,-1,-1,-1,0,-1,-1,-1,1,5,0,-2,-2],[0,-1,-3,-2,-1,-3,-3,3,-2,1,1,-3,-2,-2,-3,-2,0,4,-3,-1],[-3,-2,-4,-3,1,-2,-2,-3,-3,-2,-1,-4,-4,-2,-3,-3,-2,-3,11,2],[-2,-2,-3,-2,3,-3,2,-1,-2,-1,-1,-2,-3,-1,-2,-2,-2,-1,2,7]],kJe=[[4,-1,-2,-2,0,-1,-1,0,-2,-1,-1,-1,-1,-2,-1,1,0,-3,-2,0,-2,-1,0],[-1,5,0,-2,-3,1,0,-2,0,-3,-2,2,-1,-3,-2,-1,-1,-3,-2,-3,-1,0,-1],[-2,0,6,1,-3,0,0,0,1,-3,-3,0,-2,-3,-2,1,0,-4,-2,-3,3,0,-1],[-2,-2,1,6,-3,0,2,-1,-1,-3,-4,-1,-3,-3,-1,0,-1,-4,-3,-3,4,1,-1],[0,-3,-3,-3,9,-3,-4,-3,-3,-1,-1,-3,-1,-2,-3,-1,-1,-2,-2,-1,-3,-3,-2],[-1,1,0,0,-3,5,2,-2,0,-3,-2,1,0,-3,-1,0,-1,-2,-1,-2,0,3,-1],[-1,0,0,2,-4,2,5,-2,0,-3,-3,1,-2,-3,-1,0,-1,-3,-2,-2,1,4,-1],[0,-2,0,-1,-3,-2,-2,6,-2,-4,-4,-2,-3,-3,-2,0,-2,-2,-3,-3,-1,-2,-1],[-2,0,1,-1,-3,0,0,-2,8,-3,-3,-1,-2,-1,-2,-1,-2,-2,2,-3,0,0,-1],[-1,-3,-3,-3,-1,-3,-3,-4,-3,4,2,-3,1,0,-3,-2,-1,-3,-1,3,-3,-3,-1],[-1,-2,-3,-4,-1,-2,-3,-4,-3,2,4,-2,2,0,-3,-2,-1,-2,-1,1,-4,-3,-1],[-1,2,0,-1,-3,1,1,-2,-1,-3,-2,5,-1,-3,-1,0,-1,-3,-2,-2,0,1,-1],[-1,-1,-2,-3,-1,0,-2,-3,-2,1,2,-1,5,0,-2,-1,-1,-1,-1,1,-3,-1,-1],[-2,-3,-3,-3,-2,-3,-3,-3,-1,0,0,-3,0,6,-4,-2,-2,1,3,-1,-3,-3,-1],[-1,-2,-2,-1,-3,-1,-1,-2,-2,-3,-3,-1,-2,-4,7,-1,-1,-4,-3,-2,-2,-1,-2],[1,-1,1,0,-1,0,0,0,-1,-2,-2,0,-1,-2,-1,4,1,-3,-2,-2,0,0,0],[0,-1,0,-1,-1,-1,-1,-2,-2,-1,-1,-1,-1,-2,-1,1,5,-2,-2,0,-1,-1,0],[-3,-3,-4,-4,-2,-2,-3,-2,-2,-3,-2,-3,-1,1,-4,-3,-2,11,2,-3,-4,-3,-2],[-2,-2,-2,-3,-2,-1,-2,-3,2,-1,-1,-2,-1,3,-3,-2,-2,2,7,-1,-3,-2,-1],[0,-3,-3,-3,-1,-2,-2,-3,-3,3,1,-2,1,-1,-2,-2,0,-3,-1,4,-3,-2,-1],[-2,-1,3,4,-3,0,1,-1,0,-3,-4,0,-3,-3,-2,0,-1,-4,-3,-3,4,1,-1],[-1,0,0,1,-3,3,4,-2,0,-3,-3,1,-1,-3,-1,0,-1,-3,-2,-2,1,4,-1],[0,-1,-1,-1,-2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-2,0,0,-2,-1,-1,-1,-1,-1]];function tV(e,t){var r,n=0,i={};return t.forEach(function(a){r=0;var o={};a.forEach(function(s){return o[e[r++]]=s}),i[e[n++]]=o}),i}var OJe=function(){return{blosum62:tV(DJe,kJe),blosum62x:tV(MJe,RJe)}}(),LJe={gapPenalty:-11,gapExtensionPenalty:-1,substMatrix:"default"};function NJe(e,t,r){r===void 0&&(r={});var n=E(E({},LJe),r),i=new FJe(e,t,n);return i.calculate(),i.trace()}var FJe=function(){function e(t,r,n){this.seqA=t,this.seqB=r,this.S=[],this.V=[],this.H=[],this.gapPenalty=n.gapPenalty,this.gapExtensionPenalty=n.gapExtensionPenalty,this.substMatrix=n.substMatrix==="default"?void 0:OJe[n.substMatrix],this.n=this.seqA.length,this.m=this.seqB.length}return e.prototype.initMatrices=function(){for(var t=this,r=t.n,n=t.m,i=t.gapPenalty,a=t.S,o=t.V,s=t.H,u=0;u<=r;++u){a[u]=[],o[u]=[],s[u]=[];for(var l=0;l<=n;++l)a[u][l]=0,o[u][l]=0,s[u][l]=0}for(var u=0;u<=r;++u)a[u][0]=i,s[u][0]=-1/0;for(var l=0;l<=n;++l)a[0][l]=i,o[0][l]=-1/0;a[0][0]=0},e.prototype.makeScoreFn=function(){var t=this,r=t.seqA,n=t.seqB,i=t.substMatrix;return i?function(o,s){var u,l,c=r[o],d=n[s];return(l=(u=i[c])===null||u===void 0?void 0:u[d])!==null&&l!==void 0?l:-4}:function(o,s){var u=r[o],l=n[s];return u===l?5:-3}},e.prototype.calculate=function(){this.initMatrices();for(var t=this.makeScoreFn(),r=this,n=r.V,i=r.H,a=r.S,o=r.n,s=r.m,u=r.gapExtensionPenalty,l=r.gapPenalty,c,d,f,h,v,p=1;p<=o;++p){d=a[p-1],c=n[p-1],f=n[p],h=i[p],v=a[p];for(var m=1;m<=s;++m)f[m]=Math.max(d[m]+l,c[m]+u),h[m]=Math.max(v[m-1]+l,h[m-1]+u),v[m]=Math.max(d[m-1]+t(p-1,m-1),f[m],h[m])}},e.prototype.trace=function(){var t=this.makeScoreFn(),r=this,n=r.V,i=r.H,a=r.S,o=r.seqA,s=r.seqB,u=r.gapExtensionPenalty,l=r.gapPenalty,c=this.n,d=this.m,f,h,v="",p="";for(a[c][d]>=n[c][d]?(f="S",h=a[c][d]):n[c][d]>=i[c][d]?(f="V",h=n[c][d]):(f="H",h=i[c][d]);c>0&&d>0;)f==="S"?a[c][d]===a[c-1][d-1]+t(c-1,d-1)?(v=o[c-1]+v,p=s[d-1]+p,--c,--d,f="S"):a[c][d]===n[c][d]?f="V":a[c][d]===i[c][d]?f="H":(--c,--d):f==="V"?n[c][d]===n[c-1][d]+u?(v=o[c-1]+v,p="-"+p,--c,f="V"):n[c][d]===a[c-1][d]+l?(v=o[c-1]+v,p="-"+p,--c,f="S"):--c:f==="H"&&(i[c][d]===i[c][d-1]+u?(v="-"+v,p=s[d-1]+p,--d,f="H"):i[c][d]===a[c][d-1]+l?(v="-"+v,p=s[d-1]+p,--d,f="S"):--d);for(;c>0;)v=o[c-1]+v,p="-"+p,--c;for(;d>0;)v="-"+v,p=s[d-1]+p,--d;return{aliA:v,aliB:p,score:h}},e}(),vD;(function(e){function t(n){var i=new Map;if(Ue.isAtomic(n.unit))for(var a=n.unit.model.atomicHierarchy.residues.label_seq_id,o=n.unit.residueIndex,s=0,u=Oe.size(n.indices);s<u;++s){var l=Oe.getAt(n.indices,s),c=n.unit.elements[l],d=a.value(o[c]);i.has(d)?i.get(d).push(l):i.set(d,[l])}else if(Ue.isCoarse(n.unit))for(var f=(Ue.isSpheres(n.unit)?n.unit.model.coarseHierarchy.spheres:n.unit.model.coarseHierarchy.gaussians).seq_id_begin,s=0,u=Oe.size(n.indices);s<u;++s){var l=Oe.getAt(n.indices,s),c=n.unit.elements[l],d=f.value(c);i.set(d,[l])}return i}function r(n,i){i===void 0&&(i={});for(var a=rV(n.a.unit),o=rV(n.b.unit),s=t(n.a),u=t(n.b),l=[],c=[],d=NJe(a.code.toArray(),o.code.toArray(),i),f=d.aliA,h=d.aliB,v=d.score,p=0,m=0,g=0,y=f.length;g<y;++g){if(f[g]==="-"||h[g]==="-"){f[g]!=="-"&&(p+=1),h[g]!=="-"&&(m+=1);continue}var b=a.seqId.value(p),S=o.seqId.value(m);if(s.has(b)&&u.has(S))for(var x=s.get(b),C=u.get(S),w=0,A=Math.min(x.length,C.length);w<A;++w)l.push(x[w]),c.push(C[w]);p+=1,m+=1}var M=Oe.intersect(Oe.ofSortedArray(l),n.a.indices),D=Oe.intersect(Oe.ofSortedArray(c),n.b.indices);return{a:{unit:n.a.unit,indices:M},b:{unit:n.b.unit,indices:D},score:v}}e.compute=r})(vD||(vD={}));function BJe(e){switch(e.kind){case 0:return e.model.atomicHierarchy.index.getEntityFromChain(e.chainIndex[e.elements[0]]);case 1:return e.model.coarseHierarchy.spheres.entityKey[e.elements[0]];case 2:return e.model.coarseHierarchy.gaussians.entityKey[e.elements[0]]}}function rV(e){return e.model.sequence.byEntityKey[BJe(e)].sequence}function nV(e){var t=[];if(e.length<=0)return t;var r=zJe(e),n={a:Jy(e[0],r),b:Jy(e[1],r)};t[0]=$c.compute(n);for(var i=2;i<e.length;i++)n.b=Jy(e[i],r),n.centerB=void 0,t.push($c.compute(n));return t}var UJe=/(polypeptide|cyclic-pseudo-peptide)/i;function jJe(e){var t=[];if(e.length<=0)return t;for(var r=De.getFirstLocation(e[0]),n=lt.entity.subtype(r),i=n.match(UJe)?"blosum62":"default",a=1;a<e.length;a++){var o=vD.compute({a:e[0].elements[0],b:e[a].elements[0]},{substMatrix:i}),s=o.a,u=o.b,l=o.score,c=De(e[0].structure,[s]),d=De(e[a].structure,[u]),f=Oe.size(s.indices);t.push(E(E({},$c.compute({a:Jy(c,f),b:Jy(d,f)})),{alignmentScore:l}))}return t}function Jy(e,t){for(var r=$c.Positions.empty(t),n=0,i=0,a=e.elements;i<a.length;i++){for(var o=a[i],s=o.unit,u=o.indices,l=s.elements,c=s.conformation,d=c.x,f=c.y,h=c.z,v=0,p=Oe.size(u);v<p;v++){var m=l[Oe.getAt(u,v)];if(r.x[n]=d(m),r.y[n]=f(m),r.z[n]=h(m),n++,n>=t)break}if(n>=t)break}return r}function zJe(e){if(e.length===0)return 0;for(var t=De.size(e[0]),r=1;r<e.length;r++){var n=De.size(e[r]);n<t&&(t=n)}return t}function VJe(e){for(var t=new Map,r=0;r<e.length;r++)qJe(e[r],t,r);for(var n=Array.from(t.values()),i=GJe(e.length,n),a=[],o=0,s=i;o<s.length;o++){var u=s[o],l=HJe(n,u.i,u.j,u.count),c=l[0],d=l[1],f=$c.compute({a:c,b:d});a.push({transform:f,pivot:u.i,other:u.j})}return a}function HJe(e,t,r,n){for(var i=$c.Positions.empty(n),a=$c.Positions.empty(n),o=0,s=0,u=e;s<u.length;s++){var l=u[s].pivots,c=l[t],d=l[r];if(!(!c||!d))for(var f=Math.min(c[2]-c[1],d[2]-d[1]),h=0;h<f;h++){var v=c[1]+h;i.x[o]=c[0].conformation.x(v),i.y[o]=c[0].conformation.y(v),i.z[o]=c[0].conformation.z(v),v=d[1]+h,a.x[o]=d[0].conformation.x(v),a.y[o]=d[0].conformation.y(v),a.z[o]=d[0].conformation.z(v),o++}}return[i,a]}function GJe(e,t){for(var r=[],n=0;n<e;n++){r[n]=[];for(var i=0;i<e;i++)r[n][i]=0}for(var a=0,o=t;a<o.length;a++)for(var s=o[a].pivots,n=0;n<e;n++)if(s[n]){for(var u=s[n][2]-s[n][1],i=n+1;i<e;i++)if(s[i]){var l=s[i][2]-s[i][1];r[n][i]=r[n][i]+Math.min(u,l)}}for(var c=[],i=1;i<e;i++)c[i-1]={i:0,j:i,count:r[0][i]};return c}function qJe(e,t,r){for(var n,i=0,a=e.units;i<a.length;i++){var o=a[i];if(o.kind===0){var s=o.elements,u=o.model,l=u.atomicHierarchy.residueAtomSegments.offsets,c=_u.Provider.get(u).value;if(!c)return;for(var d=c.dbName,f=c.accession,h=c.num,v=nr.transientSegments(o.model.atomicHierarchy.chainAtomSegments,s),p=nr.transientSegments(o.model.atomicHierarchy.residueAtomSegments,s);v.hasNext;){var m=v.move();for(p.setSegment(m);p.hasNext;){var g=p.move(),y=s[g.start],b=l[y];if(d[b]){var S=d[b]+"-"+f[b]+"-"+h[b];if(!t.has(S))t.set(S,{key:S,pivots:(n={},n[r]=[o,y,s[g.end]],n)});else{var x=t.get(S);x.pivots[r]||(x.pivots[r]=[o,y,s[g.end]])}}}}}}}var WJe=function(e){Le(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.defaultState=function(){return{isCollapsed:!1,header:"Superposition",brand:{accent:"gray",svg:iAe},isHidden:!0}},t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.managers.structure.hierarchy.behaviors.selection,function(n){r.setState({isHidden:n.structures.length<2})})},t.prototype.renderControls=function(){return T.jsx(T.Fragment,{children:T.jsx(XJe,{},void 0)},void 0)},t}(Wg),Jte={alignSequences:I.Boolean(!0,{isEssential:!0,description:"Perform a sequence alignment and use the aligned residue pairs to guide the 3D superposition."})},$Je=I.getDefaultValues(Jte),iV="SuperpositionTransform",XJe=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isBusy:!1,canUseDb:!1,action:void 0,options:$Je},r.superposeChains=function(){return ce(r,void 0,void 0,function(){var n,i,a,o,s,u,l,c,d,f,h,v,p,m=this;return de(this,function(g){switch(g.label){case 0:n=di.trace.query,i=this.chainEntries,a=i.map(function(y,b){var S=De.toStructure(y.loci),x=mt.toLociWithSourceUnits(n(new Qo(S)));return De.remap(x,b===0?m.plugin.helpers.substructureParent.get(y.loci.structure.root).obj.data:x.structure.root)}),o=this.state.options.alignSequences?jJe(a):nV(a),s=i[0],u=1,l=a.length,g.label=1;case 1:return u<l?(c=i[u],d=o[u-1],f=d.bTransform,h=d.rmsd,[4,this.transform(c.cell,f)]):[3,4];case 2:g.sent(),v=ff(s.label),p=ff(c.label),this.plugin.log.info("Superposed ["+v+"] and ["+p+"] with RMSD "+h.toFixed(2)+"."),g.label=3;case 3:return++u,[3,1];case 4:return[2]}})})},r.superposeAtoms=function(){return ce(r,void 0,void 0,function(){var n,i,a,o,s,u,l,c,d,f,h,v,p,m=this;return de(this,function(g){switch(g.label){case 0:n=this.atomEntries,i=n.map(function(y,b){return De.remap(y.loci,b===0?m.plugin.helpers.substructureParent.get(y.loci.structure.root).obj.data:y.loci.structure.root)}),a=nV(i),o=n[0],s=1,u=i.length,g.label=1;case 1:return s<u?(l=n[s],c=a[s-1],d=c.bTransform,f=c.rmsd,[4,this.transform(l.cell,d)]):[3,4];case 2:g.sent(),h=ff(o.label),v=ff(l.label),p=n[s].atoms.length,this.plugin.log.info("Superposed "+p+" "+(p===1?"atom":"atoms")+" of ["+h+"] and ["+v+"] with RMSD "+f.toFixed(2)+"."),g.label=3;case 3:return++s,[3,1];case 4:return[2]}})})},r.superposeDb=function(){return ce(r,void 0,void 0,function(){var n,i,a,o,s,u;return de(this,function(l){switch(l.label){case 0:n=this.plugin.managers.structure.hierarchy.behaviors.selection.value.structures,i=VJe(n.map(function(c){var d;return(d=c.cell.obj)===null||d===void 0?void 0:d.data})),a=0,o=0,s=i,l.label=1;case 1:return o<s.length?(u=s[o],[4,this.transform(n[u.other].cell,u.transform.bTransform)]):[3,4];case 2:l.sent(),a+=u.transform.rmsd,l.label=3;case 3:return o++,[3,1];case 4:return a/=i.length-1,this.plugin.log.info("Superposed "+n.length+" structures with avg. RMSD "+a.toFixed(2)+"."),[4,new Promise(function(c){return requestAnimationFrame(c)})];case 5:return l.sent(),_t.Camera.Reset(this.plugin),[2]}})})},r.toggleByChains=function(){return r.setState({action:r.state.action==="byChains"?void 0:"byChains"})},r.toggleByAtoms=function(){return r.setState({action:r.state.action==="byAtoms"?void 0:"byAtoms"})},r.toggleOptions=function(){return r.setState({action:r.state.action==="options"?void 0:"options"})},r.setOptions=function(n){r.setState({options:n})},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.selection.events.changed,function(){r.forceUpdate()}),this.subscribe(this.selection.events.additionsHistoryUpdated,function(){r.forceUpdate()}),this.subscribe(this.plugin.behaviors.state.isBusy,function(n){r.setState({isBusy:n})}),this.subscribe(this.plugin.managers.structure.hierarchy.behaviors.selection,function(n){r.setState({canUseDb:n.structures.every(function(i){var a;return!!(!((a=i.cell.obj)===null||a===void 0)&&a.data)&&i.cell.obj.data.models.some(function(o){return _u.Provider.isApplicable(o)})})})})},Object.defineProperty(t.prototype,"selection",{get:function(){return this.plugin.managers.structure.selection},enumerable:!1,configurable:!0}),t.prototype.transform=function(r,n){return ce(this,void 0,void 0,function(){var i,a,o,s;return de(this,function(u){switch(u.label){case 0:return i=Ii.resolveAndCheck(this.plugin.state.data,r),i?(a=ir.findTagInSubtree(this.plugin.state.data.tree,i.transform.ref,iV),o={transform:{name:"matrix",params:{data:n,transpose:!1}}},s=a?this.plugin.state.data.build().to(a).update(o):this.plugin.state.data.build().to(r).insert(rt.Model.TransformStructureConformation,o,{tags:iV}),[4,this.plugin.runTask(this.plugin.state.data.updateTree(s))]):[2];case 1:return u.sent(),[2]}})})},t.prototype.highlight=function(r){this.plugin.managers.interactivity.lociHighlights.highlightOnly({loci:r},!1)},t.prototype.moveHistory=function(r,n){this.plugin.managers.structure.selection.modifyHistory(r,n,void 0,!0)},t.prototype.focusLoci=function(r){this.plugin.managers.camera.focusLoci(r)},t.prototype.lociEntry=function(r,n){var i=this;return T.jsx("div",E({className:"msp-flex-row"},{children:T.jsx(hr,E({noOverflow:!0,title:"Click to focus. Hover to highlight.",onClick:function(){return i.focusLoci(r.loci)},style:{width:"auto",textAlign:"left"},onMouseEnter:function(){return i.highlight(r.loci)},onMouseLeave:this.plugin.managers.interactivity.lociHighlights.clearHighlights},{children:T.jsx("span",{dangerouslySetInnerHTML:{__html:r.label}},void 0)}),void 0)}),n)},t.prototype.historyEntry=function(r,n){var i=this,a=this.plugin.managers.structure.selection.additionsHistory;return T.jsxs("div",E({className:"msp-flex-row"},{children:[T.jsxs(hr,E({noOverflow:!0,title:"Click to focus. Hover to highlight.",onClick:function(){return i.focusLoci(r.loci)},style:{width:"auto",textAlign:"left"},onMouseEnter:function(){return i.highlight(r.loci)},onMouseLeave:this.plugin.managers.interactivity.lociHighlights.clearHighlights},{children:[n,". ",T.jsx("span",{dangerouslySetInnerHTML:{__html:r.label}},void 0)]}),void 0),a.length>1&&T.jsx(Ht,{svg:h3,small:!0,className:"msp-form-control",onClick:function(){return i.moveHistory(r,"up")},flex:"20px",title:"Move up"},void 0),a.length>1&&T.jsx(Ht,{svg:f3,small:!0,className:"msp-form-control",onClick:function(){return i.moveHistory(r,"down")},flex:"20px",title:"Move down"},void 0),T.jsx(Ht,{svg:Vs,small:!0,className:"msp-form-control",onClick:function(){return i.plugin.managers.structure.selection.modifyHistory(r,"remove")},flex:!0,title:"Remove"},void 0)]}),r.id)},t.prototype.atomsLociEntry=function(r,n){var i=this;return T.jsxs("div",{children:[T.jsx("div",E({className:"msp-control-group-header"},{children:T.jsx("div",E({className:"msp-no-overflow",title:r.label},{children:r.label}),void 0)}),void 0),T.jsx("div",E({className:"msp-control-offset"},{children:r.atoms.map(function(a,o){return i.historyEntry(a,o)})}),void 0)]},n)},Object.defineProperty(t.prototype,"chainEntries",{get:function(){var r=this,n=Ze.create(),i=[];return this.plugin.managers.structure.selection.entries.forEach(function(a,o){var s=a.selection,u=Ii.resolveAndCheck(r.plugin.state.data,o);if(!(!u||De.isEmpty(s))){var l=De.getFirstLocation(s,n);if(!(s.elements.length>1||lt.entity.type(l)!=="polymer")){var c=gf.ofLoci(s),d=y_(c,{countsOnly:!0}),f=eu(l,{reverse:!0,granularity:"chain"}).split("|"),h=d+" | "+f[0]+" | "+f[f.length-1];i.push({loci:s,label:h,cell:u})}}}),i},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"atomEntries",{get:function(){for(var r=this,n=new Map,i=this.plugin.managers.structure.selection.additionsHistory,a=0,o=i.length;a<o;++a){var s=i[a];if(De.size(s.loci)===1){var u=s.loci.structure;n.has(u)?n.get(u).push(s):n.set(u,[s])}}var l=[];return n.forEach(function(c,d){for(var f=r.plugin.helpers.substructureParent.get(d),h=[],v=0,p=c.length;v<p;++v)h.push(c[v].loci.elements[0]);var m=De(c[0].loci.structure,h),g=m.structure.label.split(" | ")[0];l.push({loci:m,label:g,cell:f,atoms:c})}),l},enumerable:!1,configurable:!0}),t.prototype.addByChains=function(){var r=this,n=this.chainEntries;return T.jsxs(T.Fragment,{children:[n.length>0&&T.jsx("div",E({className:"msp-control-offset"},{children:n.map(function(i,a){return r.lociEntry(i,a)})}),void 0),n.length<2&&T.jsx("div",E({className:"msp-control-offset msp-help-text"},{children:T.jsxs("div",E({className:"msp-help-description"},{children:[T.jsx(nn,{svg:Sl,inline:!0},void 0),"Add 2 or more selections (toggle ",T.jsx(F_,{inline:!0},void 0)," mode) from separate structures. Selections must be limited to single polymer chains or residues therein."]}),void 0)}),void 0),n.length>1&&T.jsx(hr,E({title:"Superpose structures by selected chains.",className:"msp-btn-commit msp-btn-commit-on",onClick:this.superposeChains,style:{marginTop:"1px"}},{children:"Superpose"}),void 0)]},void 0)},t.prototype.addByAtoms=function(){var r=this,n=this.atomEntries;return T.jsxs(T.Fragment,{children:[n.length>0&&T.jsx("div",E({className:"msp-control-offset"},{children:n.map(function(i,a){return r.atomsLociEntry(i,a)})}),void 0),n.length<2&&T.jsx("div",E({className:"msp-control-offset msp-help-text"},{children:T.jsxs("div",E({className:"msp-help-description"},{children:[T.jsx(nn,{svg:Sl,inline:!0},void 0),"Add 1 or more selections (toggle ",T.jsx(F_,{inline:!0},void 0)," mode) from separate structures. Selections must be limited to single atoms."]}),void 0)}),void 0),n.length>1&&T.jsx(hr,E({title:"Superpose structures by selected atoms.",className:"msp-btn-commit msp-btn-commit-on",onClick:this.superposeAtoms,style:{marginTop:"1px"}},{children:"Superpose"}),void 0)]},void 0)},t.prototype.superposeByDbMapping=function(){return T.jsx(T.Fragment,{children:T.jsx(hr,E({icon:K8,title:"Superpose structures using database mapping.",className:"msp-btn msp-btn-block",onClick:this.superposeDb,style:{marginTop:"1px"},disabled:this.state.isBusy},{children:"DB"}),void 0)},void 0)},t.prototype.render=function(){return T.jsxs(T.Fragment,{children:[T.jsxs("div",E({className:"msp-flex-row"},{children:[T.jsx(Ai,{icon:K8,label:"Chains",toggle:this.toggleByChains,isSelected:this.state.action==="byChains",disabled:this.state.isBusy},void 0),T.jsx(Ai,{icon:nAe,label:"Atoms",toggle:this.toggleByAtoms,isSelected:this.state.action==="byAtoms",disabled:this.state.isBusy},void 0),this.state.canUseDb&&this.superposeByDbMapping(),T.jsx(Ai,{icon:zp,label:"",title:"Options",toggle:this.toggleOptions,isSelected:this.state.action==="options",disabled:this.state.isBusy,style:{flex:"0 0 40px",padding:0}},void 0)]}),void 0),this.state.action==="byChains"&&this.addByChains(),this.state.action==="byAtoms"&&this.addByAtoms(),this.state.action==="options"&&T.jsx("div",E({className:"msp-control-offset"},{children:T.jsx(On,{params:Jte,values:this.state.options,onChangeValues:this.setOptions,isDisabled:this.state.isBusy},void 0)}),void 0)]},void 0)},t}(Gi),YJe=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={show:!1,label:""},r.update=function(){var n=r.plugin.state.data,i=n.selectQ(function(h){return h.ofTransformer(rt.Model.ModelFromTrajectory)});if(i.length===0){r.setState({show:!1});return}for(var a="",o=0,s=new Set,u=0,l=i;u<l.length;u++){var c=l[u];if(c.sourceRef){var d=n.cells.get(c.sourceRef).obj;if(d&&d.data.frameCount>1){if(s.has(c.sourceRef)){r.setState({show:!1});return}if(s.add(c.sourceRef),o++,!a){var f=c.transform.params.modelIndex;a="Model "+(f+1)+" / "+d.data.frameCount}}}}o>1&&(a=""),r.setState({show:o>0,label:a})},r.reset=function(){return _t.State.ApplyAction(r.plugin,{state:r.plugin.state.data,action:xS.create({action:"reset"})})},r.prev=function(){return _t.State.ApplyAction(r.plugin,{state:r.plugin.state.data,action:xS.create({action:"advance",by:-1})})},r.next=function(){return _t.State.ApplyAction(r.plugin,{state:r.plugin.state.data,action:xS.create({action:"advance",by:1})})},r}return t.prototype.componentDidMount=function(){this.subscribe(this.plugin.state.data.events.changed,this.update),this.subscribe(this.plugin.behaviors.state.isAnimating,this.update)},t.prototype.render=function(){var r=this.plugin.behaviors.state.isAnimating.value;return!this.state.show||r&&!this.state.label?null:T.jsxs("div",E({className:"msp-traj-controls"},{children:[!r&&T.jsx(Ht,{svg:qEe,title:"First Model",onClick:this.reset,disabled:r},void 0),!r&&T.jsx(Ht,{svg:EY,title:"Previous Model",onClick:this.prev,disabled:r},void 0),!r&&T.jsx(Ht,{svg:AY,title:"Next Model",onClick:this.next,disabled:r},void 0),!!this.state.label&&T.jsx("span",{children:this.state.label},void 0)]}),void 0)},t}(pr),KJe=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isBusy:!1,show:!0},r.keyUp=function(n){if(!(!n.ctrlKey||r.state.isBusy||n.target!==document.body)){var i=r.plugin.managers.snapshot;if(n.keyCode===37||n.key==="ArrowLeft")i.state.isPlaying&&i.stop(),r.prev();else if(n.keyCode===38||n.key==="ArrowUp"){if(i.state.isPlaying&&i.stop(),i.state.entries.size===0)return;var a=i.state.entries.get(0);r.update(a.snapshot.id)}else if(n.keyCode===39||n.key==="ArrowRight")i.state.isPlaying&&i.stop(),r.next();else if(n.keyCode===40||n.key==="ArrowDown"){if(i.state.isPlaying&&i.stop(),i.state.entries.size===0)return;var o=i.state.entries.get(i.state.entries.size-1);r.update(o.snapshot.id)}}},r.change=function(n){n.target.value!=="none"&&r.update(n.target.value)},r.prev=function(){var n=r.plugin.managers.snapshot,i=n.getNextId(n.state.current,-1);i&&r.update(i)},r.next=function(){var n=r.plugin.managers.snapshot,i=n.getNextId(n.state.current,1);i&&r.update(i)},r.togglePlay=function(){r.plugin.managers.snapshot.togglePlay()},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.managers.snapshot.events.changed,function(){return r.forceUpdate()}),this.subscribe(this.plugin.behaviors.state.isBusy,function(n){return r.setState({isBusy:n})}),this.subscribe(this.plugin.behaviors.state.isAnimating,function(n){return r.setState({isBusy:n})}),window.addEventListener("keyup",this.keyUp,!1)},t.prototype.componentWillUnmount=function(){e.prototype.componentWillUnmount.call(this),window.removeEventListener("keyup",this.keyUp,!1)},t.prototype.update=function(r){return ce(this,void 0,void 0,function(){return de(this,function(n){switch(n.label){case 0:return this.setState({isBusy:!0}),[4,_t.State.Snapshots.Apply(this.plugin,{id:r})];case 1:return n.sent(),this.setState({isBusy:!1}),[2]}})})},t.prototype.render=function(){var r=this.plugin.managers.snapshot,n=r.state.entries.size;if(n<2||!this.state.show)return null;var i=r.state.current,a=r.state.isPlaying;return T.jsxs("div",E({className:"msp-state-snapshot-viewport-controls"},{children:[T.jsxs("select",E({className:"msp-form-control",value:i||"none",onChange:this.change,disabled:this.state.isBusy||a},{children:[!i&&T.jsx("option",{value:"none"},"none"),r.state.entries.valueSeq().map(function(o,s){return T.jsxs("option",E({value:o.snapshot.id},{children:["["+(s+1)+"/"+n+"]"," ",o.name||new Date(o.timestamp).toLocaleString()]}),o.snapshot.id)})]}),void 0),T.jsx(Ht,{svg:a?IY:PY,title:a?"Pause":"Cycle States",onClick:this.togglePlay,disabled:a?!1:this.state.isBusy},void 0),!a&&T.jsxs(T.Fragment,{children:[T.jsx(Ht,{svg:EY,title:"Previous State",onClick:this.prev,disabled:this.state.isBusy||a},void 0),T.jsx(Ht,{svg:AY,title:"Next State",onClick:this.next,disabled:this.state.isBusy||a},void 0)]},void 0)]}),void 0)},t}(pr),QJe=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isEmpty:!0,isExpanded:!1,isBusy:!1,isAnimating:!1,isPlaying:!1},r.toggleExpanded=function(){return r.setState({isExpanded:!r.state.isExpanded})},r.stop=function(){r.plugin.managers.animation.stop(),r.plugin.managers.snapshot.stop()},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.managers.snapshot.events.changed,function(){r.plugin.managers.snapshot.state.isPlaying?r.setState({isPlaying:!0,isExpanded:!1}):r.setState({isPlaying:!1})}),this.subscribe(this.plugin.behaviors.state.isBusy,function(n){n?r.setState({isBusy:!0,isExpanded:!1,isEmpty:r.plugin.state.data.tree.transforms.size<2}):r.setState({isBusy:!1,isEmpty:r.plugin.state.data.tree.transforms.size<2})}),this.subscribe(this.plugin.behaviors.state.isAnimating,function(n){n?r.setState({isAnimating:!0,isExpanded:!1}):r.setState({isAnimating:!1})})},t.prototype.render=function(){var r=this.plugin.managers.snapshot.state.isPlaying;if(r||this.state.isEmpty||this.plugin.managers.animation.isEmpty||!this.plugin.config.get(Wr.Viewport.ShowAnimation))return null;var n=this.state.isAnimating;return T.jsxs("div",E({className:"msp-animation-viewport-controls"},{children:[T.jsxs("div",{children:[T.jsx("div",{className:"msp-semi-transparent-background"},void 0),T.jsx(Ht,{svg:n||r?IY:XEe,transparent:!0,title:n?"Stop":"Select Animation",onClick:n||r?this.stop:this.toggleExpanded,toggleState:this.state.isExpanded,disabled:n||r?!1:this.state.isBusy||this.state.isPlaying||this.state.isEmpty},void 0)]},void 0),this.state.isExpanded&&!this.state.isBusy&&T.jsx("div",E({className:"msp-animation-viewport-controls-select"},{children:T.jsx(zKe,{onStart:this.toggleExpanded},void 0)}),void 0)]}),void 0)},t}(pr),ZJe=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.onMouseMove=function(n){n.buttons===0&&n.stopPropagation()},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.behaviors.interaction.selectionMode,function(){return r.forceUpdate()})},t.prototype.render=function(){return this.plugin.selectionMode?T.jsx("div",E({className:"msp-selection-viewport-controls",onMouseMove:this.onMouseMove},{children:T.jsx(TQe,{},void 0)}),void 0):null},t}(pr),JJe=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={labels:[]},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.behaviors.labels.highlight,function(n){return r.setState({labels:n.labels})})},t.prototype.render=function(){return this.state.labels.length===0?null:T.jsx("div",E({className:"msp-highlight-info"},{children:this.state.labels.map(function(r,n){return T.jsx("div",{dangerouslySetInnerHTML:{__html:r}},""+n)})}),void 0)},t}(pr),eet=function(e){Le(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.state.behaviors.events.changed,function(){return r.forceUpdate()})},t.prototype.render=function(){var r=this,n=[];return this.plugin.customStructureControls.forEach(function(i,a){n.push(T.jsx(i,{initiallyCollapsed:r.props.initiallyCollapsed},a))}),n.length>0?T.jsx(T.Fragment,{children:n},void 0):null},t}(pr),tet=function(e){Le(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.render=function(){return T.jsxs(T.Fragment,{children:[T.jsxs("div",E({className:"msp-section-header"},{children:[T.jsx(nn,{svg:Q3e},void 0),"Structure Tools"]}),void 0),T.jsx(jQe,{},void 0),T.jsx(kQe,{},void 0),T.jsx(WJe,{},void 0),T.jsx(cQe,{},void 0),this.plugin.config.get(Wr.VolumeStreaming.Enabled)&&T.jsx(xJe,{},void 0),T.jsx(SJe,{},void 0),T.jsx(eet,{},void 0)]},void 0)},t}(pr),ret=function(e){Le(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return Object.defineProperty(t.prototype,"current",{get:function(){return this.props.state.behaviors.currentObject.value},enumerable:!1,configurable:!0}),t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.state.events.object.updated,function(n){var i=n.ref,a=n.state,o=r.current;o.ref!==i||o.state!==a||r.forceUpdate()}),this.subscribe(this.plugin.state.data.actions.events.added,function(){return r.forceUpdate()}),this.subscribe(this.plugin.state.data.actions.events.removed,function(){return r.forceUpdate()})},t.prototype.render=function(){var r=this,n=this.props,i=n.state,a=n.nodeRef,o=i.cells.get(a),s=i.actions.fromCell(o,this.plugin);if(s.length===0)return null;var u=o.transform.transformer.definition,l=o.obj?o.obj.label:u.display&&u.display.name||u.name;return T.jsxs("div",E({className:"msp-state-actions"},{children:[!this.props.hideHeader&&T.jsxs("div",E({className:"msp-section-header"},{children:[T.jsx(nn,{svg:fEe},void 0)," ","Actions ("+l+")"]}),void 0),s.map(function(c,d){return T.jsx(EL,{state:i,action:c,nodeRef:a,initiallyCollapsed:d===0?!r.props.alwaysExpandFirst&&r.props.initiallyCollapsed:r.props.initiallyCollapsed},""+c.id)})]}),void 0)},t}(pr),q_=function(e){Le(t,e);function t(r){var n=e.call(this)||this;return n.plugin=r,n.data=Wf.create(new ge.Root({}),{runTask:n.plugin.runTask,globalContext:n.plugin,historyCapacity:n.plugin.config.get(Wr.State.HistoryCapacity)}),n.behaviors=Wf.create(new Dr.Root({}),{runTask:n.plugin.runTask,globalContext:n.plugin,rootState:{isLocked:!0}}),n.events={cell:{stateUpdated:rc(n.data.events.cell.stateUpdated,n.behaviors.events.cell.stateUpdated),created:rc(n.data.events.cell.created,n.behaviors.events.cell.created),removed:rc(n.data.events.cell.removed,n.behaviors.events.cell.removed)},object:{created:rc(n.data.events.object.created,n.behaviors.events.object.created),removed:rc(n.data.events.object.removed,n.behaviors.events.object.removed),updated:rc(n.data.events.object.updated,n.behaviors.events.object.updated)}},n.snapshotParams=n.ev.behavior(t.DefaultSnapshotParams),n.setSnapshotParams=function(i){n.snapshotParams.next(E(E({},t.DefaultSnapshotParams),i))},n}return Object.defineProperty(t.prototype,"animation",{get:function(){return this.plugin.managers.animation},enumerable:!1,configurable:!0}),t.prototype.getSnapshot=function(r){var n,i,a=E(E({},this.snapshotParams.value),r);return{id:dn.create22(),data:a.data?this.data.getSnapshot():void 0,behaviour:a.behavior?this.behaviors.getSnapshot():void 0,animation:a.animation?this.animation.getSnapshot():void 0,startAnimation:a.startAnimation?!!a.startAnimation:void 0,camera:a.camera?{current:this.plugin.canvas3d.camera.getSnapshot(),transitionStyle:a.cameraTransition.name,transitionDurationInMs:((n=a==null?void 0:a.cameraTransition)===null||n===void 0?void 0:n.name)==="animate"?a.cameraTransition.params.durationInMs:void 0}:void 0,canvas3d:a.canvas3d?{props:(i=this.plugin.canvas3d)===null||i===void 0?void 0:i.props}:void 0,interactivity:a.interactivity?{props:this.plugin.managers.interactivity.props}:void 0,structureFocus:this.plugin.managers.structure.focus.getSnapshot(),durationInMs:a==null?void 0:a.durationInMs}},t.prototype.setSnapshot=function(r){var n;return ce(this,void 0,void 0,function(){var i;return de(this,function(a){switch(a.label){case 0:return[4,this.animation.stop()];case 1:return a.sent(),r.behaviour?[4,this.plugin.runTask(this.behaviors.setSnapshot(r.behaviour))]:[3,3];case 2:a.sent(),a.label=3;case 3:return r.data?[4,this.plugin.runTask(this.data.setSnapshot(r.data))]:[3,5];case 4:a.sent(),a.label=5;case 5:return!((n=r.canvas3d)===null||n===void 0)&&n.props?(i=I.normalizeParams(gs,r.canvas3d.props,"children"),[4,_t.Canvas3D.SetSettings(this.plugin,{settings:i})]):[3,7];case 6:a.sent(),a.label=7;case 7:return r.interactivity&&r.interactivity.props&&this.plugin.managers.interactivity.setProps(r.interactivity.props),r.structureFocus&&this.plugin.managers.structure.focus.setSnapshot(r.structureFocus),r.animation&&this.animation.setSnapshot(r.animation),r.camera&&_t.Camera.Reset(this.plugin,{snapshot:r.camera.current,durationMs:r.camera.transitionStyle==="animate"?r.camera.transitionDurationInMs:void 0}),r.startAnimation&&this.animation.start(),[2]}})})},t.prototype.updateTransform=function(r,n,i,a){var o=r.build().to(n).update(i);return _t.State.Update(this.plugin,{state:r,tree:o,options:{canUndo:a}})},t.prototype.updateBehavior=function(r,n){var i=this.behaviors.build();if(this.behaviors.tree.transforms.has(r.id))i.to(r.id).update(n);else{var a=r.createDefaultParams(void 0,this.plugin);i.to(Dr.getCategoryId(r)).apply(r,Hp(a,n),{ref:r.id})}return this.plugin.runTask(this.behaviors.updateTree(i))},t.prototype.dispose=function(){this.behaviors.cells.forEach(function(r){Dr.Behavior.is(r.obj)&&r.obj.data.unregister()}),e.prototype.dispose.call(this),this.data.dispose(),this.behaviors.dispose(),this.animation.dispose()},t}(Bb);(function(e){e.SnapshotParams={durationInMs:I.Numeric(1500,{min:100,max:15e3,step:100},{label:"Duration in ms"}),data:I.Boolean(!0),behavior:I.Boolean(!1),animation:I.Boolean(!0),startAnimation:I.Boolean(!1),canvas3d:I.Boolean(!0),interactivity:I.Boolean(!0),camera:I.Boolean(!0),cameraTransition:I.MappedStatic("animate",{animate:I.Group({durationInMs:I.Numeric(250,{min:100,max:5e3,step:500},{label:"Duration in ms"})}),instant:I.Group({})},{options:[["animate","Animate"],["instant","Instant"]]})},e.DefaultSnapshotParams=I.getDefaultValues(e.SnapshotParams)})(q_||(q_={}));var net=function(e){Le(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.render=function(){var r;return T.jsxs("div",{children:[T.jsx(hc,{icon:TY,title:"Plugin State"},void 0),T.jsx("div",E({style:{marginBottom:"10px"}},{children:T.jsx(Tu,E({header:"Save Options",initiallyExpanded:!1},{children:T.jsx(tre,{},void 0)}),void 0)}),void 0),T.jsx(iet,{},void 0),T.jsx(aet,{},void 0),T.jsx(hc,{title:"Save as File",accent:"blue"},void 0),T.jsx(ere,{},void 0),((r=this.plugin.spec.components)===null||r===void 0?void 0:r.remoteState)!=="none"&&T.jsx(rre,{},void 0)]},void 0)},t}(pr),ere=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.downloadToFileJson=function(){var n,i;(i=(n=r.props).onAction)===null||i===void 0||i.call(n),_t.State.Snapshots.DownloadToFile(r.plugin,{type:"json"})},r.downloadToFileZip=function(){var n,i;(i=(n=r.props).onAction)===null||i===void 0||i.call(n),_t.State.Snapshots.DownloadToFile(r.plugin,{type:"zip"})},r.open=function(n){var i,a;if(!n.target.files||!n.target.files[0]){r.plugin.log.error("No state file selected");return}(a=(i=r.props).onAction)===null||a===void 0||a.call(i),_t.State.Snapshots.OpenFile(r.plugin,{file:n.target.files[0]})},r}return t.prototype.render=function(){return T.jsxs(T.Fragment,{children:[T.jsxs("div",E({className:"msp-flex-row"},{children:[T.jsx(hr,E({icon:_M,onClick:this.downloadToFileJson,title:"Save the state description. Input data are loaded using the provided sources. Does not work if local files are used as input."},{children:"State"}),void 0),T.jsx(hr,E({icon:_M,onClick:this.downloadToFileZip,title:"Save the state including the input data."},{children:"Session"}),void 0),T.jsxs("div",E({className:"msp-btn msp-btn-block msp-btn-action msp-loader-msp-btn-file"},{children:[T.jsx(nn,{svg:NEe,inline:!0},void 0)," Open ",T.jsx("input",{onChange:this.open,type:"file",multiple:!1,accept:".molx,.molj"},void 0)]}),void 0)]}),void 0),T.jsxs("div",E({className:"msp-help-text",style:{padding:"10px"}},{children:[T.jsx(nn,{svg:tAe},void 0)," This is an experimental feature and stored states/sessions might not be openable in a future version."]}),void 0)]},void 0)},t}(pr),tre=function(e){Le(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.state.snapshotParams,function(){return r.forceUpdate()})},t.prototype.render=function(){return T.jsx(On,{params:q_.SnapshotParams,values:this.plugin.state.snapshotParams.value,onChangeValues:this.plugin.state.setSnapshotParams},void 0)},t}(pr),iet=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={params:I.getDefaultValues(t.Params)},r.add=function(){_t.State.Snapshots.Add(r.plugin,{name:r.state.params.name,description:r.state.params.description})},r.updateParams=function(n){return r.setState({params:n})},r.clear=function(){_t.State.Snapshots.Clear(r.plugin,{})},r}return t.prototype.shouldComponentUpdate=function(r,n){return!xg(this.props,r)||!xg(this.state,n)},t.prototype.render=function(){return T.jsxs("div",{children:[T.jsx(On,{params:t.Params,values:this.state.params,onEnter:this.add,onChangeValues:this.updateParams},void 0),T.jsxs("div",E({className:"msp-flex-row"},{children:[T.jsx(Ht,{onClick:this.clear,svg:Vs,title:"Remove All"},void 0),T.jsx(hr,E({onClick:this.add,icon:Gg,style:{textAlign:"right"},commit:!0},{children:"Add"}),void 0)]}),void 0)]},void 0)},t.Params={name:I.Text(),description:I.Text()},t}(pr),aet=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.apply=function(n){var i=n.currentTarget.getAttribute("data-id");i&&_t.State.Snapshots.Apply(r.plugin,{id:i})},r.remove=function(n){var i=n.currentTarget.getAttribute("data-id");i&&_t.State.Snapshots.Remove(r.plugin,{id:i})},r.moveUp=function(n){var i=n.currentTarget.getAttribute("data-id");i&&_t.State.Snapshots.Move(r.plugin,{id:i,dir:-1})},r.moveDown=function(n){var i=n.currentTarget.getAttribute("data-id");i&&_t.State.Snapshots.Move(r.plugin,{id:i,dir:1})},r.replace=function(n){var i=n.currentTarget.getAttribute("data-id");i&&_t.State.Snapshots.Replace(r.plugin,{id:i})},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.managers.snapshot.events.changed,function(){return r.forceUpdate()})},t.prototype.render=function(){var r=this,n=this.plugin.managers.snapshot.state.current;return T.jsx("ul",E({style:{listStyle:"none",marginTop:"10px"},className:"msp-state-list"},{children:this.plugin.managers.snapshot.state.entries.map(function(i){return T.jsxs("li",E({className:"msp-flex-row"},{children:[T.jsxs(hr,E({"data-id":i.snapshot.id,onClick:r.apply,className:"msp-no-overflow"},{children:[T.jsx("span",E({style:{fontWeight:i.snapshot.id===n?"bold":void 0}},{children:i.name||new Date(i.timestamp).toLocaleString()}),void 0)," ",T.jsx("small",{children:(i.snapshot.durationInMs?sS(i.snapshot.durationInMs,!1)+(i.description?", ":""):"")+(i.description?i.description:"")},void 0)]}),void 0),T.jsx(Ht,{svg:h3,"data-id":i.snapshot.id,title:"Move Up",onClick:r.moveUp,flex:"20px"},void 0),T.jsx(Ht,{svg:f3,"data-id":i.snapshot.id,title:"Move Down",onClick:r.moveDown,flex:"20px"},void 0),T.jsx(Ht,{svg:KEe,"data-id":i.snapshot.id,title:"Replace",onClick:r.replace,flex:"20px"},void 0),T.jsx(Ht,{svg:Vs,"data-id":i.snapshot.id,title:"Remove",onClick:r.remove,flex:"20px"},void 0)]}),i.snapshot.id)})}),void 0)},t}(pr),rre=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.Params={name:I.Text(),options:I.Group({description:I.Text(),playOnLoad:I.Boolean(!1),serverUrl:I.Text(r.plugin.config.get(Wr.State.CurrentServer))})},r.state={params:I.getDefaultValues(r.Params),entries:ri.OrderedMap(),isBusy:!1},r.ListOnlyParams={options:I.Group({serverUrl:I.Text(r.plugin.config.get(Wr.State.CurrentServer))},{isFlat:!0})},r._mounted=!1,r.refresh=function(){return ce(r,void 0,void 0,function(){var n,i,a,o,s,u;return de(this,function(l){switch(l.label){case 0:return l.trys.push([0,2,,3]),this.setState({isBusy:!0}),this.plugin.config.set(Wr.State.CurrentServer,this.state.params.options.serverUrl),[4,this.plugin.runTask(this.plugin.fetch({url:this.serverUrl("list"),type:"json"}))];case 1:for(n=l.sent()||[],n.sort(function(c,d){return c.isSticky===d.isSticky?c.timestamp-d.timestamp:c.isSticky?-1:1}),i=ri.OrderedMap().asMutable(),a=0,o=n;a<o.length;a++)s=o[a],i.set(s.id,E(E({},s),{url:this.serverUrl("get/"+s.id),removeUrl:this.serverUrl("remove/"+s.id)}));return this._mounted&&this.setState({entries:i.asImmutable(),isBusy:!1}),[3,3];case 2:return u=l.sent(),this.plugin.log.error("Fetching Remote Snapshots: "+u),this._mounted&&this.setState({entries:ri.OrderedMap(),isBusy:!1}),[3,3];case 3:return[2]}})})},r.upload=function(){return ce(r,void 0,void 0,function(){return de(this,function(n){switch(n.label){case 0:return this.setState({isBusy:!0}),this.plugin.config.set(Wr.State.CurrentServer,this.state.params.options.serverUrl),[4,_t.State.Snapshots.Upload(this.plugin,{name:this.state.params.name,description:this.state.params.options.description,playOnLoad:this.state.params.options.playOnLoad,serverUrl:this.state.params.options.serverUrl})];case 1:return n.sent(),this.plugin.log.message("Snapshot uploaded."),this._mounted&&(this.setState({isBusy:!1}),this.refresh()),[2]}})})},r.fetch=function(n){return ce(r,void 0,void 0,function(){var i,a;return de(this,function(o){switch(o.label){case 0:if(i=n.currentTarget.getAttribute("data-id"),!i)return[2];if(a=this.state.entries.get(i),!a)return[2];this.setState({isBusy:!0}),o.label=1;case 1:return o.trys.push([1,,3,4]),[4,_t.State.Snapshots.Fetch(this.plugin,{url:a.url})];case 2:return o.sent(),[3,4];case 3:return this._mounted&&this.setState({isBusy:!1}),[7];case 4:return[2]}})})},r.remove=function(n){return ce(r,void 0,void 0,function(){var i,a;return de(this,function(o){switch(o.label){case 0:if(i=n.currentTarget.getAttribute("data-id"),!i)return[2];if(a=this.state.entries.get(i),!a)return[2];this.setState({entries:this.state.entries.remove(i)}),o.label=1;case 1:return o.trys.push([1,3,,4]),[4,fetch(a.removeUrl)];case 2:return o.sent(),[3,4];case 3:return o.sent(),[3,4];case 4:return[2]}})})},r}return t.prototype.componentDidMount=function(){this.refresh(),this._mounted=!0},t.prototype.componentWillUnmount=function(){this._mounted=!1},t.prototype.serverUrl=function(r){return r?iE(this.state.params.options.serverUrl,r):this.state.params.options.serverUrl},t.prototype.render=function(){var r=this;return T.jsxs(T.Fragment,{children:[T.jsx(hc,{title:"Remote States",accent:"blue"},void 0),!this.props.listOnly&&T.jsxs(T.Fragment,{children:[T.jsx(On,{params:this.Params,values:this.state.params,onEnter:this.upload,onChange:function(n){var i;r.setState({params:E(E({},r.state.params),(i={},i[n.name]=n.value,i))})},isDisabled:this.state.isBusy},void 0),T.jsxs("div",E({className:"msp-flex-row"},{children:[T.jsx(Ht,{onClick:this.refresh,disabled:this.state.isBusy,svg:EM},void 0),T.jsx(hr,E({icon:cEe,onClick:this.upload,disabled:this.state.isBusy,commit:!0},{children:"Upload"}),void 0)]}),void 0)]},void 0),T.jsx(oet,{entries:this.state.entries,isBusy:this.state.isBusy,serverUrl:this.state.params.options.serverUrl,fetch:this.fetch,remove:this.props.listOnly?void 0:this.remove},void 0),this.props.listOnly&&T.jsxs("div",E({style:{marginTop:"10px"}},{children:[T.jsx(On,{params:this.ListOnlyParams,values:this.state.params,onEnter:this.upload,onChange:function(n){var i;r.setState({params:E(E({},r.state.params),(i={},i[n.name]=n.value,i))})},isDisabled:this.state.isBusy},void 0),T.jsx("div",E({className:"msp-flex-row"},{children:T.jsx(hr,E({onClick:this.refresh,disabled:this.state.isBusy,icon:EM},{children:"Refresh"}),void 0)}),void 0)]}),void 0)]},void 0)},t}(pr),oet=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.open=function(n){return ce(r,void 0,void 0,function(){var i,a,o,s;return de(this,function(u){return i=n.currentTarget.getAttribute("data-id"),i?(a=this.props.entries.get(i),a?(n.preventDefault(),o=""+window.location,s=o.indexOf("?"),s>0&&(o=o.substr(0,s)),window.open(o+"?snapshot-url="+encodeURIComponent(a.url),"_blank"),[2]):[2]):[2]})})},r}return t.prototype.render=function(){var r=this;return T.jsx("ul",E({style:{listStyle:"none",marginTop:"10px"},className:"msp-state-list"},{children:this.props.entries.valueSeq().map(function(n){return T.jsxs("li",E({className:"msp-flex-row"},{children:[T.jsxs(hr,E({"data-id":n.id,onClick:r.props.fetch,disabled:r.props.isBusy,onContextMenu:r.open,title:"Click to download, right-click to open in a new tab."},{children:[n.name||new Date(n.timestamp).toLocaleString()," ",T.jsx("small",{children:n.description},void 0)]}),void 0),!n.isSticky&&r.props.remove&&T.jsx(Ht,{svg:Vs,"data-id":n.id,title:"Remove",onClick:r.props.remove,disabled:r.props.isBusy,small:!0},void 0)]}),n.id)})}),void 0)},t}(Gi);function nre(e,t){return t===void 0&&(t=EPe),function(r){return r.lift(new set(e,t))}}var set=function(){function e(t,r){this.dueTime=t,this.scheduler=r}return e.prototype.call=function(t,r){return r.subscribe(new uet(t,this.dueTime,this.scheduler))},e}(),uet=function(e){ha(t,e);function t(r,n,i){var a=e.call(this,r)||this;return a.dueTime=n,a.scheduler=i,a.debouncedSubscription=null,a.lastValue=null,a.hasValue=!1,a}return t.prototype._next=function(r){this.clearDebounce(),this.lastValue=r,this.hasValue=!0,this.add(this.debouncedSubscription=this.scheduler.schedule(cet,this.dueTime,this))},t.prototype._complete=function(){this.debouncedNext(),this.destination.complete()},t.prototype.debouncedNext=function(){if(this.clearDebounce(),this.hasValue){var r=this.lastValue;this.lastValue=null,this.hasValue=!1,this.destination.next(r)}},t.prototype.clearDebounce=function(){var r=this.debouncedSubscription;r!==null&&(this.remove(r),r.unsubscribe(),this.debouncedSubscription=null)},t}(Ms);function cet(e){e.debouncedNext()}function det(e){return function(t){return e===0?xPe():t.lift(new fet(e))}}var fet=function(){function e(t){if(this.total=t,this.total<0)throw new PPe}return e.prototype.call=function(t,r){return r.subscribe(new het(t,this.total))},e}(),het=function(e){ha(t,e);function t(r,n){var i=e.call(this,r)||this;return i.total=n,i.count=0,i}return t.prototype._next=function(r){var n=this.total,i=++this.count;i<=n&&(this.destination.next(r),i===n&&(this.destination.complete(),this.unsubscribe()))},t}(Ms),ire=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={showActions:!0},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.state.events.cell.created,function(n){n.cell.transform.parent===cr.RootRef&&r.forceUpdate()}),this.subscribe(this.plugin.state.events.cell.removed,function(n){n.parent===cr.RootRef&&r.forceUpdate()})},t.getDerivedStateFromProps=function(r,n){var i=r.state.tree.root.ref,a=r.state.tree.children.get(i),o=a.size===0;return n.showActions===o?null:{showActions:o}},t.prototype.render=function(){var r=this.props.state.tree.root.ref;return this.state.showActions?T.jsxs("div",E({style:{margin:"10px",cursor:"default"}},{children:[T.jsx("p",{children:"Nothing to see here yet."},void 0),T.jsxs("p",{children:["Structures and Volumes can be loaded from the ",T.jsx(nn,{svg:wM},void 0)," tab."]},void 0)]}),void 0):T.jsx(pet,{cell:this.props.state.cells.get(r),depth:0},void 0)},t}(pr),pet=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isCollapsed:!!r.props.cell.state.isCollapsed,isNull:t.isNull(r.props.cell),showLabel:t.showLabel(r.props.cell)},r}return t.prototype.is=function(r){return r.ref===this.ref&&r.state===this.props.cell.parent},Object.defineProperty(t.prototype,"ref",{get:function(){return this.props.cell.transform.ref},enumerable:!1,configurable:!0}),t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.state.events.cell.stateUpdated,function(n){r.props.cell===n.cell&&r.is(n)&&n.state.cells.has(r.ref)&&(r.state.isCollapsed!==!!n.cell.state.isCollapsed||r.state.isNull!==t.isNull(n.cell)||r.state.showLabel!==t.showLabel(n.cell))&&r.forceUpdate()}),this.subscribe(this.plugin.state.events.cell.created,function(n){r.props.cell.parent===n.state&&r.ref===n.cell.transform.parent&&r.forceUpdate()}),this.subscribe(this.plugin.state.events.cell.removed,function(n){r.props.cell.parent===n.state&&r.ref===n.parent&&r.forceUpdate()})},t.getDerivedStateFromProps=function(r,n){var i=t.isNull(r.cell),a=t.showLabel(r.cell);return!!r.cell.state.isCollapsed===n.isCollapsed&&n.isNull===i&&n.showLabel===a?null:{isCollapsed:!!r.cell.state.isCollapsed,isNull:i,showLabel:a}},t.hasDecorator=function(r){var n,i=r.parent.tree.children.get(r.transform.ref);return i.size!==1?!1:!!(!((n=r.parent)===null||n===void 0)&&n.tree.transforms.get(i.first()).transformer.definition.isDecorator)},t.isNull=function(r){return!r||!r.parent||r.obj===In.Null||!r.parent.tree.transforms.has(r.transform.ref)},t.showLabel=function(r){return r.transform.ref!==cr.RootRef&&(r.status!=="ok"||!r.state.isGhost&&!t.hasDecorator(r))},t.prototype.render=function(){var r=this;if(this.state.isNull)return null;var n=this.props.cell,i=n.parent.tree.children.get(this.ref);if(!this.state.showLabel)return i.size===0?null:T.jsx(T.Fragment,{children:i.map(function(o){return T.jsx(t,{cell:n.parent.cells.get(o),depth:r.props.depth},o)})},void 0);var a=this.props.depth+1;return T.jsxs(T.Fragment,{children:[T.jsx(vet,{cell:n,depth:this.props.depth},void 0),i.size===0?void 0:T.jsx("div",E({style:{display:this.state.isCollapsed?"none":"block"}},{children:i.map(function(o){return T.jsx(t,{cell:n.parent.cells.get(o),depth:a},o)})}),void 0)]},void 0)},t}(pr),vet=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isCurrent:r.props.cell.parent.current===r.ref,isCollapsed:!!r.props.cell.state.isCollapsed,action:void 0,currentAction:void 0},r.setCurrent=function(n){n==null||n.preventDefault(),n==null||n.currentTarget.blur(),_t.State.SetCurrentObject(r.plugin,{state:r.props.cell.parent,ref:r.ref})},r.setCurrentRoot=function(n){n==null||n.preventDefault(),n==null||n.currentTarget.blur(),_t.State.SetCurrentObject(r.plugin,{state:r.props.cell.parent,ref:cr.RootRef})},r.remove=function(n){n==null||n.preventDefault(),_t.State.RemoveObject(r.plugin,{state:r.props.cell.parent,ref:r.ref,removeParentGhosts:!0})},r.toggleVisible=function(n){n.preventDefault(),_t.State.ToggleVisibility(r.plugin,{state:r.props.cell.parent,ref:r.ref}),n.currentTarget.blur()},r.toggleExpanded=function(n){n.preventDefault(),_t.State.ToggleExpanded(r.plugin,{state:r.props.cell.parent,ref:r.ref}),n.currentTarget.blur()},r.highlight=function(n){n.preventDefault(),_t.Interactivity.Object.Highlight(r.plugin,{state:r.props.cell.parent,ref:r.ref}),n.currentTarget.blur()},r.clearHighlight=function(n){n.preventDefault(),_t.Interactivity.ClearHighlights(r.plugin),n.currentTarget.blur()},r.hideApply=function(){r.setCurrentRoot()},r.selectAction=function(n){n&&(n==null?void 0:n.value)()},r}return t.prototype.is=function(r){return r.ref===this.ref&&r.state===this.props.cell.parent},Object.defineProperty(t.prototype,"ref",{get:function(){return this.props.cell.transform.ref},enumerable:!1,configurable:!0}),t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.state.events.cell.stateUpdated.pipe(S3(function(n){return r.is(n)}),nre(33)),function(n){r.forceUpdate()}),this.subscribe(this.props.cell.parent.behaviors.currentObject,function(n){if(!r.is(n)){r.state.isCurrent&&n.state.transforms.has(r.ref)&&r._setCurrent(r.props.cell.parent.current===r.ref,r.state.isCollapsed);return}n.state.transforms.has(r.ref)&&r._setCurrent(r.props.cell.parent.current===r.ref,!!r.props.cell.state.isCollapsed)})},t.prototype._setCurrent=function(r,n){r?this.setState({isCurrent:r,action:"options",currentAction:void 0,isCollapsed:n}):this.setState({isCurrent:r,action:void 0,currentAction:void 0,isCollapsed:n})},t.getDerivedStateFromProps=function(r,n){var i=r.cell.parent.current===r.cell.transform.ref,a=!!r.cell.state.isCollapsed;return n.isCollapsed===a&&n.isCurrent===i?null:{isCurrent:i,isCollapsed:a,action:void 0,currentAction:void 0}},Object.defineProperty(t.prototype,"actions",{get:function(){var r=this,n=this.props.cell,i=Ft([],n.parent.actions.fromCell(n,this.plugin));if(i.length!==0)return i.sort(function(a,o){return a.definition.display.name<o.definition.display.name?-1:a.definition.display.name===o.definition.display.name?0:1}),Ft([er.Header("Apply Action")],i.map(function(a){return er.Item(a.definition.display.name,function(){return r.setState({action:"apply",currentAction:a})})}))},enumerable:!1,configurable:!0}),t.prototype.updates=function(r){for(var n=this.props.cell,i=G1.getDecoratorChain(n.parent,n.transform.ref),a=[],o=i.length-1;o>=0;o--){var s=i[o];a.push(T.jsx(Wc,{state:n.parent,transform:s.transform,noMargin:!0,wrapInExpander:!0,expanderHeaderLeftMargin:r},s.transform.transformer.id+"-"+o))}return T.jsx("div",E({className:"msp-tree-updates-wrapper"},{children:a}),void 0)},t.prototype.render=function(){var r=this.props.cell,n=r.transform;if(!r)return null;var i=this.is(r.parent.behaviors.currentObject.value),a=r.status!=="error"&&r.status!=="ok",o;if(r.status==="error"||!r.obj){var s=r.status==="error"?r.errorText:n.transformer.definition.display.name;o=T.jsxs(hr,E({className:"msp-btn-tree-label msp-no-hover-outline",noOverflow:!0,title:s,onClick:this.state.isCurrent?this.setCurrentRoot:this.setCurrent,disabled:a},{children:[r.status==="error"&&T.jsxs("b",{children:["[",r.status,"]"]},void 0)," ",T.jsx("span",{children:s},void 0)]}),void 0)}else{var u=r.obj,l=u.label+" "+(u.description?u.description:"");o=T.jsxs(hr,E({className:"msp-btn-tree-label msp-type-class-"+u.type.typeClass,noOverflow:!0,disabled:a,title:l,onClick:this.state.isCurrent?this.setCurrentRoot:this.setCurrent},{children:[T.jsx("span",{children:u.label},void 0)," ",u.description?T.jsx("small",{children:u.description},void 0):void 0]}),void 0)}var c=r.parent.tree.children.get(this.ref),d=r.state,f=T.jsx(Ht,{svg:d.isCollapsed?kc:Rc,flex:"20px",disabled:a,onClick:this.toggleExpanded,transparent:!0,className:"msp-no-hover-outline",style:{visibility:c.size>0?"visible":"hidden"}},void 0),h=r.state.isLocked?void 0:T.jsx(Ht,{svg:Vs,onClick:this.remove,disabled:a,small:!0,toggleState:!1},void 0),v=T.jsx(Ht,{svg:d.isHidden?fv:hv,toggleState:!1,disabled:a,small:!0,onClick:this.toggleVisible},void 0),p={marginLeft:this.props.depth*8+"px"},m=T.jsxs("div",E({className:"msp-flex-row msp-tree-row"+(i?" msp-tree-row-current":""),onMouseEnter:this.highlight,onMouseLeave:this.clearHighlight,style:p},{children:[f,o,h,v]}),void 0);if(!i)return m;if(this.state.action==="apply"&&this.state.currentAction)return T.jsxs("div",E({style:{marginBottom:"1px"}},{children:[m,T.jsx(fc,E({header:"Apply "+this.state.currentAction.definition.display.name,initialExpanded:!0,hideExpander:!0,hideOffset:!1,onHeaderClick:this.hideApply,topRightIcon:dc,headerLeftMargin:this.props.depth*8+21+"px"},{children:T.jsx(EL,{onApply:this.hideApply,state:this.props.cell.parent,action:this.state.currentAction,nodeRef:this.props.cell.transform.ref,hideHeader:!0,noMargin:!0},void 0)}),void 0)]}),void 0);if(this.state.action==="options"){var g=this.actions,y=this.updates(this.props.depth*8+21+"px");return T.jsxs("div",E({style:{marginBottom:"1px"}},{children:[m,y,g&&T.jsx("div",E({style:{marginLeft:this.props.depth*8+21+"px",marginTop:"-1px"}},{children:T.jsx(er,{items:g,onSelect:this.selectAction},void 0)}),void 0)]}),void 0)}return m},t}(pr),met=function(e){Le(t,e);function t(){var r,n=e.apply(this,arguments)||this;return n.state={tab:n.plugin.behaviors.layout.leftPanelTabName.value},n.set=function(i){if(n.state.tab===i){n.setState({tab:"none"},function(){return n.plugin.behaviors.layout.leftPanelTabName.next("none")}),_t.Layout.Update(n.plugin,{state:{regionState:E(E({},n.plugin.layout.state.regionState),{left:"collapsed"})}});return}n.setState({tab:i},function(){return n.plugin.behaviors.layout.leftPanelTabName.next(i)}),n.plugin.layout.state.regionState.left!=="full"&&_t.Layout.Update(n.plugin,{state:{regionState:E(E({},n.plugin.layout.state.regionState),{left:"full"})}})},n.tabs={none:T.jsx(T.Fragment,{},void 0),root:T.jsxs(T.Fragment,{children:[T.jsx(hc,{icon:wM,title:"Home"},void 0),T.jsx(ret,{state:n.plugin.state.data,nodeRef:cr.RootRef,hideHeader:!0,initiallyCollapsed:!0,alwaysExpandFirst:!0},void 0),((r=n.plugin.spec.components)===null||r===void 0?void 0:r.remoteState)!=="none"&&T.jsx(rre,{listOnly:!0},void 0)]},void 0),data:T.jsxs(T.Fragment,{children:[T.jsx(hc,{icon:SY,title:T.jsxs(T.Fragment,{children:[T.jsx(bet,{},void 0)," State Tree"]},void 0)},void 0),T.jsx(ire,{state:n.plugin.state.data},void 0)]},void 0),states:T.jsx(net,{},void 0),settings:T.jsxs(T.Fragment,{children:[T.jsx(hc,{icon:zp,title:"Plugin Settings"},void 0),T.jsx(yet,{},void 0)]},void 0),help:T.jsxs(T.Fragment,{children:[T.jsx(hc,{icon:Sl,title:"Help"},void 0),T.jsx(AQe,{},void 0)]},void 0)},n}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.behaviors.layout.leftPanelTabName,function(n){r.state.tab!==n&&r.setState({tab:n}),n==="none"&&r.plugin.layout.state.regionState.left!=="collapsed"&&_t.Layout.Update(r.plugin,{state:{regionState:E(E({},r.plugin.layout.state.regionState),{left:"collapsed"})}})}),this.subscribe(this.plugin.state.data.events.changed,function(n){var i=n.state;r.state.tab==="data"&&i.cells.size===1&&r.set("root")})},t.prototype.render=function(){var r=this,n=this.state.tab;return T.jsxs("div",E({className:"msp-left-panel-controls"},{children:[T.jsxs("div",E({className:"msp-left-panel-controls-buttons"},{children:[T.jsx(Ht,{svg:wM,toggleState:n==="root",transparent:!0,onClick:function(){return r.set("root")},title:"Home"},void 0),T.jsx(get,{set:this.set},void 0),T.jsx(Ht,{svg:TY,toggleState:n==="states",transparent:!0,onClick:function(){return r.set("states")},title:"Plugin State"},void 0),T.jsx(Ht,{svg:Sl,toggleState:n==="help",transparent:!0,onClick:function(){return r.set("help")},title:"Help"},void 0),T.jsx("div",E({className:"msp-left-panel-controls-buttons-bottom"},{children:T.jsx(Ht,{svg:zp,toggleState:n==="settings",transparent:!0,onClick:function(){return r.set("settings")},title:"Settings"},void 0)}),void 0)]}),void 0),T.jsx("div",E({className:"msp-scrollable-container"},{children:this.tabs[n]}),void 0)]}),void 0)},t}(pr),get=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={changed:!1},r}return Object.defineProperty(t.prototype,"tab",{get:function(){return this.plugin.behaviors.layout.leftPanelTabName.value},enumerable:!1,configurable:!0}),t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.behaviors.layout.leftPanelTabName,function(n){r.tab==="data"?r.setState({changed:!1}):r.forceUpdate()}),this.subscribe(this.plugin.state.data.events.changed,function(n){r.tab!=="data"&&r.setState({changed:!0})})},t.prototype.render=function(){var r=this;return T.jsx(Ht,{svg:SY,toggleState:this.tab==="data",transparent:!0,onClick:function(){return r.props.set("data")},title:"State Tree",style:{position:"relative"},extraContent:this.state.changed?T.jsx("div",{className:"msp-left-panel-controls-button-data-dirty"},void 0):void 0},void 0)},t}(pr),yet=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.setSettings=function(n){var i;_t.Canvas3D.SetSettings(r.plugin,{settings:(i={},i[n.name]=n.value,i)})},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.events.canvas3d.settingsUpdated,function(){return r.forceUpdate()}),this.subscribe(this.plugin.layout.events.updated,function(){return r.forceUpdate()}),this.subscribe(this.plugin.canvas3d.camera.stateChanged,function(n){(n.radiusMax!==void 0||n.radius!==void 0)&&r.forceUpdate()})},t.prototype.render=function(){return T.jsxs(T.Fragment,{children:[this.plugin.canvas3d&&T.jsxs(T.Fragment,{children:[T.jsx(hc,{title:"Viewport"},void 0),T.jsx(On,{params:gs,values:this.plugin.canvas3d.props,onChange:this.setSettings},void 0)]},void 0),T.jsx(hc,{title:"Behavior"},void 0),T.jsx(ire,{state:this.plugin.state.behaviors},void 0)]},void 0)},t}(pr),bet=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.remove=function(n){n.preventDefault(),_t.State.RemoveObject(r.plugin,{state:r.plugin.state.data,ref:cr.RootRef})},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.state.events.cell.created,function(n){n.cell.transform.parent===cr.RootRef&&r.forceUpdate()}),this.subscribe(this.plugin.state.events.cell.removed,function(n){n.parent===cr.RootRef&&r.forceUpdate()})},t.prototype.render=function(){var r=this.plugin.state.data.tree.children.get(cr.RootRef).size;return r===0?null:T.jsx(Ht,{svg:Vs,onClick:this.remove,title:"Remove All",style:{display:"inline-block"},small:!0,className:"msp-no-hover-outline",transparent:!0},void 0)},t}(pr),aV=5,xet=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.parentDiv=Ve.createRef(),r.lastMouseOverSeqIdx=-1,r.highlightQueue=new Qn,r.lociHighlightProvider=function(n,i){var a=r.props.sequenceWrapper.markResidue(n.loci,i);a&&r.updateMarker()},r.lociSelectionProvider=function(n,i){var a=r.props.sequenceWrapper.markResidue(n.loci,i);a&&r.updateMarker()},r.contextMenu=function(n){n.preventDefault()},r.mouseDownLoci=void 0,r.mouseDown=function(n){n.stopPropagation();var i=r.getSeqIdx(n),a=r.getLoci(i),o=op(n.nativeEvent),s=Mm(n.nativeEvent),u=dx(n.nativeEvent);r.click(a,o,s,u),r.mouseDownLoci=a},r.mouseUp=function(n){if(n.stopPropagation(),r.mouseDownLoci!==void 0){var i=r.getSeqIdx(n),a=r.getLoci(i);if(a&&!De.areEqual(r.mouseDownLoci,a)){var o=op(n.nativeEvent),s=Mm(n.nativeEvent),u=dx(n.nativeEvent),l=r.mouseDownLoci.elements[0],c=a.elements[0],d=Math.min(Oe.min(l.indices),Oe.min(c.indices)),f=Math.max(Oe.max(l.indices),Oe.max(c.indices)),h=De(a.structure,[{unit:l.unit,indices:Oe.ofRange(d,f)}]);r.click(De.subtract(h,r.mouseDownLoci),o,s,u)}r.mouseDownLoci=void 0}},r.location=Ze.create(void 0),r.mouseMove=function(n){n.stopPropagation();var i=op(n.nativeEvent),a=Mm(n.nativeEvent),o=dx(n.nativeEvent),s=n.target;if(!s||!s.getAttribute){if(r.lastMouseOverSeqIdx===-1)return;r.lastMouseOverSeqIdx=-1,r.highlightQueue.next({seqIdx:-1,buttons:i,button:a,modifiers:o});return}var u=s.hasAttribute("data-seqid")?+s.getAttribute("data-seqid"):-1;if(r.lastMouseOverSeqIdx!==u)if(r.lastMouseOverSeqIdx=u,r.mouseDownLoci!==void 0){var l=r.getLoci(u);r.hover(l,0,0,E(E({},o),{shift:!0}))}else r.highlightQueue.next({seqIdx:u,buttons:i,button:a,modifiers:o})},r.mouseLeave=function(n){if(n.stopPropagation(),r.mouseDownLoci=void 0,r.lastMouseOverSeqIdx!==-1){r.lastMouseOverSeqIdx=-1;var i=op(n.nativeEvent),a=Mm(n.nativeEvent),o=dx(n.nativeEvent);r.highlightQueue.next({seqIdx:-1,buttons:i,button:a,modifiers:o})}},r}return Object.defineProperty(t.prototype,"sequenceNumberPeriod",{get:function(){if(this.props.sequenceNumberPeriod!==void 0)return this.props.sequenceNumberPeriod;if(this.props.sequenceWrapper.length>10)return 10;var r=this.getSequenceNumber(this.props.sequenceWrapper.length-1);return r.length>1?5:1},enumerable:!1,configurable:!0}),t.prototype.componentDidMount=function(){var r=this;this.plugin.managers.interactivity.lociHighlights.addProvider(this.lociHighlightProvider),this.plugin.managers.interactivity.lociSelects.addProvider(this.lociSelectionProvider),this.subscribe(nre(15)(this.highlightQueue),function(n){var i=r.getLoci(n.seqIdx<0?void 0:n.seqIdx);r.hover(i,n.buttons,n.button,n.modifiers)})},t.prototype.componentWillUnmount=function(){e.prototype.componentWillUnmount.call(this),this.plugin.managers.interactivity.lociHighlights.removeProvider(this.lociHighlightProvider),this.plugin.managers.interactivity.lociSelects.removeProvider(this.lociSelectionProvider)},t.prototype.getLoci=function(r){if(r!==void 0){var n=this.props.sequenceWrapper.getLoci(r);if(!De.isEmpty(n))return n}},t.prototype.getSeqIdx=function(r){var n=void 0,i=r.target;return i&&i.getAttribute&&(n=i.hasAttribute("data-seqid")?+i.getAttribute("data-seqid"):void 0),n},t.prototype.hover=function(r,n,i,a){var o={current:or.Loci.Empty,buttons:n,button:i,modifiers:a};r!==void 0&&!De.isEmpty(r)&&(o.current={loci:r}),this.plugin.behaviors.interaction.hover.next(o)},t.prototype.click=function(r,n,i,a){var o={current:or.Loci.Empty,buttons:n,button:i,modifiers:a};r!==void 0&&!De.isEmpty(r)&&(o.current={loci:r}),this.plugin.behaviors.interaction.click.next(o)},t.prototype.getBackgroundColor=function(r){return typeof r>"u"&&console.error("unexpected marker value"),r===0?"":r%2===0?"rgb(51, 255, 25)":"rgb(255, 102, 153)"},t.prototype.getResidueClass=function(r,n){return n.length>1?this.props.sequenceWrapper.residueClass(r)+(r===0?" msp-sequence-residue-long-begin":" msp-sequence-residue-long"):this.props.sequenceWrapper.residueClass(r)},t.prototype.residue=function(r,n,i){return T.jsx("span",E({"data-seqid":r,style:{backgroundColor:this.getBackgroundColor(i)},className:this.getResidueClass(r,n)},{children:"​"+n+"​"}),r)},t.prototype.getSequenceNumberClass=function(r,n,i){var a=["msp-sequence-number"];return n.startsWith("-")?i.length>1&&r>0?a.push("msp-sequence-number-long-negative"):a.push("msp-sequence-number-negative"):i.length>1&&r>0&&a.push("msp-sequence-number-long"),a.join(" ")},t.prototype.getSequenceNumber=function(r){var n="",i=this.props.sequenceWrapper.getLoci(r),a=De.getFirstLocation(i,this.location);if(a)if(Ue.isAtomic(a.unit)){var o=lt.residue.auth_seq_id(a),s=lt.residue.pdbx_PDB_ins_code(a);n=""+o+(s||"")}else Ue.isCoarse(a.unit)&&(n=""+(r+1));return n},t.prototype.padSeqNum=function(r){return r.length<aV?r+new Array(aV-r.length+1).join(" "):r},t.prototype.getSequenceNumberSpan=function(r,n){var i=this.getSequenceNumber(r);return T.jsx("span",E({className:this.getSequenceNumberClass(r,i,n)},{children:this.padSeqNum(i)}),"marker-"+r)},t.prototype.updateMarker=function(){if(this.parentDiv.current)for(var r=this.parentDiv.current.children,n=this.props.sequenceWrapper.markerArray,i=!this.props.hideSequenceNumbers,a=this.sequenceNumberPeriod,o=0,s=0,u=n.length;s<u;s++){i&&s%a===0&&s<u&&o++;var l=r[o];if(!l)return;o++;var c=this.getBackgroundColor(n[s]);l.style.backgroundColor!==c&&(l.style.backgroundColor=c)}},t.prototype.render=function(){for(var r=this.props.sequenceWrapper,n=[],i=!this.props.hideSequenceNumbers,a=this.sequenceNumberPeriod,o=0,s=r.length;o<s;++o){var u=r.residueLabel(o);i&&o%a===0&&o<s&&(n[n.length]=this.getSequenceNumberSpan(o,u)),n[n.length]=this.residue(o,u,r.markerArray[o])}return this.updateMarker(),T.jsx("div",E({className:"msp-sequence-wrapper",onContextMenu:this.contextMenu,onMouseDown:this.mouseDown,onMouseUp:this.mouseUp,onMouseMove:this.mouseMove,onMouseLeave:this.mouseLeave,ref:this.parentDiv},{children:n}),void 0)},t}(pr),lE=function(){function e(t,r,n){this.data=t,this.markerArray=r,this.length=n}return e.prototype.markResidue=function(t,r){return Ds(t)?ku(this.markerArray,Te.ofLength(this.length),r):this.mark(t,r)},e}(),Cet=function(e){Le(t,e);function t(r){var n=this,i=Ze.create(r.structure,r.units[0],r.units[0].elements[0]),a=r.units[0].model.sequence.byEntityKey[lt.entity.key(i)],o=a.sequence.length,s=new Uint8Array(o);n=e.call(this,r,s,o)||this,n.unitMap=new Map;for(var u=0,l=r.units;u<l.length;u++){var c=l[u];n.unitMap.set(c.id,c)}n.sequence=a.sequence,n.missing=r.units[0].model.properties.missingResidues,n.modelNum=r.units[0].model.modelNum,n.asymId=Ue.isAtomic(r.units[0])?lt.chain.label_asym_id(i):lt.coarse.asym_id(i);for(var d=[],f=0;f<o;++f)n.missing.has(n.modelNum,n.asymId,n.seqId(f))&&d.push(f);return n.observed=Oe.subtract(Te.ofBounds(0,o),Je.ofSortedArray(d)),n}return t.prototype.seqId=function(r){return this.sequence.seqId.value(r)},t.prototype.residueLabel=function(r){return this.sequence.label.value(r)||this.sequence.code.value(r)},t.prototype.residueColor=function(r){return this.missing.has(this.modelNum,this.asymId,this.seqId(r))?dr.grey:dr.black},t.prototype.residueClass=function(r){return this.missing.has(this.modelNum,this.asymId,this.seqId(r))?"msp-sequence-missing":"msp-sequence-present"},t.prototype.mark=function(r,n){var i=this,a=!1,o=this.data.structure,s=function(d){return i.sequence.index(d)};if(De.is(r)){if(!$e.areRootsEquivalent(r.structure,o))return!1;r=De.remap(r,o);for(var u=0,l=r.elements;u<l.length;u++){var c=l[u];this.unitMap.has(c.unit.id)&&(Ue.isAtomic(c.unit)?a=wet(c,n,this.markerArray,s):a=Eet(c,n,this.markerArray,s))}}else if($e.isLoci(r)){if(!$e.areRootsEquivalent(r.structure,o))return!1;ku(this.markerArray,this.observed,n)&&(a=!0)}return a},t.prototype.getLoci=function(r){var n=_et(this.data.units[0].chainGroupId,this.data.units[0].conformation.operator.name,this.seqId(r));return mt.toLociWithSourceUnits(t5.run(n,this.data.structure))},t}(lE);function _et(e,t,r){return en.generators.atoms({unitTest:function(n){return lt.unit.chainGroupId(n.element)===e&&lt.unit.operator_name(n.element)===t},residueTest:function(n){return n.element.unit.kind===0?lt.residue.label_seq_id(n.element)===r:lt.coarse.seq_id_begin(n.element)<=r&&lt.coarse.seq_id_end(n.element)>=r}})}function wet(e,t,r,n){var i=e.unit,a=i.model,o=i.elements,s=a.atomicHierarchy.residueAtomSegments.index,u=a.atomicHierarchy.residues.label_seq_id;return Oe.forEachSegment(e.indices,function(l){return s[o[l]]},function(l){var c=u.value(l);m_(r,n(c),t)}),!0}function Eet(e,t,r,n){var i=e.unit,a=i.model,o=i.elements,s=Ue.isSpheres(e.unit)?a.coarseHierarchy.spheres.seq_id_begin:a.coarseHierarchy.gaussians.seq_id_begin,u=Ue.isSpheres(e.unit)?a.coarseHierarchy.spheres.seq_id_end:a.coarseHierarchy.gaussians.seq_id_end;return Oe.forEach(e.indices,function(l){for(var c=o[l],d=n(s.value(c)),f=n(u.value(c));d<=f;d++)m_(r,d,t)}),!0}var Aet=function(e){Le(t,e);function t(r){for(var n=this,i=[],a=new Map,o=new Map,s=new Map,u=0,l=r.units.length;u<l;++u)for(var c=r.units[u],d=c.model.atomicHierarchy,f=d.residueAtomSegments,h=d.atoms,v=nr.transientSegments(f,c.elements);v.hasNext;){var p=v.move().index;a.set(p,i.length),o.set(i.length,p),s.set(i.length,c),i.push(h.label_comp_id.value(f.offsets[p]))}var m=i.length,g=new Uint8Array(m);n=e.call(this,r,g,m)||this,n.unitMap=new Map;for(var y=0,b=r.units;y<b.length;y++){var c=b[y];n.unitMap.set(c.id,c)}return n.sequence=i,n.sequenceIndices=a,n.residueIndices=o,n.seqToUnit=s,n}return t.prototype.residueLabel=function(r){return this.sequence[r]},t.prototype.residueColor=function(r){return dr.black},t.prototype.residueClass=function(r){return"msp-sequence-present"},t.prototype.mark=function(r,n){var i=this,a=!1,o=this.data.structure;if(De.is(r)){if(!$e.areRootsEquivalent(r.structure,o))return!1;r=De.remap(r,o);for(var s=function(f){var h=u.unitMap.get(f.unit.id);if(h){var v=f.unit.model.atomicHierarchy.residueAtomSegments.index;Oe.forEach(f.indices,function(p){var m=i.sequenceIndices.get(v[h.elements[p]]);m!==void 0&&ku(i.markerArray,Te.ofSingleton(m),n)&&(a=!0)})}},u=this,l=0,c=r.elements;l<c.length;l++){var d=c[l];s(d)}}else if($e.isLoci(r)){if(!$e.areRootsEquivalent(r.structure,o))return!1;ku(this.markerArray,Te.ofBounds(0,this.length),n)&&(a=!0)}return a},t.prototype.getLoci=function(r){var n=[],i=this.residueIndices.get(r);if(i!==void 0){var a=this.seqToUnit.get(r),o=a.model.atomicHierarchy.residueAtomSegments.offsets,s=Je.findPredecessorIndex(a.elements,o[i]),u=Je.findPredecessorIndex(a.elements,o[i+1]);n.push({unit:a,indices:Te.ofBounds(s,u)})}return De(this.data.structure,n)},t}(lE),DT=function(e){Le(t,e);function t(r){for(var n=this,i=0,a=0,o=[],s=Ze.create(r.structure),u=new Map,l=[],c=0,d=r.units.length;c<d;++c){var f=r.units[c];Ze.set(s,r.structure,f,f.elements[0]);var h=f.model.sequence.byEntityKey[lt.entity.key(s)];h&&(i+=h.sequence.length),a+=f.elements.length;var v=Te.ofBounds(0,f.elements.length);u.set(f.id,v),l.push({unit:f,indices:v})}i>0&&o.push(i+" residues"),o.push(a+" elements");var p=1,m=new Uint8Array(p);return n=e.call(this,r,m,p)||this,n.label="Whole Chain ("+o.join(", ")+")",n.unitIndices=u,n.loci=De(n.data.structure,l),n}return t.prototype.residueLabel=function(r){return this.label},t.prototype.residueColor=function(r){return dr.black},t.prototype.residueClass=function(r){return"msp-sequence-present"},t.prototype.mark=function(r,n){var i=!1,a=this.data.structure;if(De.is(r)){if(!$e.areRootsEquivalent(r.structure,a))return!1;r=De.remap(r,a);for(var o=0,s=r.elements;o<s.length;o++){var u=s[o],l=this.unitIndices.get(u.unit.id);l&&Oe.isSubset(l,u.indices)&&ku(this.markerArray,Te.ofSingleton(0),n)&&(i=!0)}}else if($e.isLoci(r)){if(!$e.areRootsEquivalent(r.structure,a))return!1;ku(this.markerArray,Te.ofSingleton(0),n)&&(i=!0)}return i},t.prototype.getLoci=function(r){return this.loci},t}(lE),Pet=function(e){Le(t,e);function t(r){for(var n=this,i=0,a=new Map,o=0,s=r.units.length;o<s;++o){var u=r.units[o];i+=u.elements.length;var l=Te.ofBounds(0,u.elements.length);a.set(u.id,l)}var c=new Uint8Array(i);return n=e.call(this,r,c,i)||this,n.unitIndices=a,n}return t.prototype.residueLabel=function(r){return"X"},t.prototype.residueColor=function(r){return dr.black},t.prototype.residueClass=function(r){return"msp-sequence-present"},t.prototype.mark=function(r,n){var i=!1,a=this.data,o=a.structure,s=a.units;if(De.is(r)){if(!$e.areRootsEquivalent(r.structure,o))return!1;r=De.remap(r,o);for(var u=0,l=r.elements;u<l.length;u++){var c=l[u],d=this.unitIndices.get(c.unit.id);d&&Oe.isSubset(d,c.indices)&&ku(this.markerArray,c.indices,n)&&(i=!0)}}else if($e.isLoci(r)){if(!$e.areRootsEquivalent(r.structure,o))return!1;for(var f=0,h=s.length;f<h;++f){var d=this.unitIndices.get(s[f].id);ku(this.markerArray,d,n)&&(i=!0)}}return i},t.prototype.getLoci=function(r){for(var n=this.data.units,i=[],a=0,o=0,s=n.length;o<s;++o){var u=n[o];if(r<a+u.elements.length){i.push({unit:u,indices:Te.ofSingleton(r-a)});break}a+=u.elements.length}return De(this.data.structure,i)},t}(lE),RT=5e3;function are(e){var t=lt.unit.pdbx_struct_oper_list_ids(e),r=lt.unit.struct_ncs_oper_id(e),n=lt.unit.hkl(e),i=lt.unit.spgrOp(e);return t.sort().join(",")+"|"+r+"|"+n+"|"+i}function AL(e){var t=e.split("|"),r=t[0],n=t[1];return[parseInt(r),n]}function oV(e,t){for(var r=e.structure,n=e.modelEntityId,i=e.chainGroupId,a=e.operatorKey,o=Ze.create(r),s=AL(n),u=s[0],l=s[1],c=[],d=0,f=r.units;d<f.length;d++){var h=f[d];Ze.set(o,r,h,h.elements[0]),r.getModelIndex(h.model)===u&&lt.entity.id(o)===l&&h.chainGroupId===i&&are(o)===a&&c.push(h)}if(c.length>0){var v={structure:r,units:c},h=c[0],p=void 0;if(h.polymerElements.length){var m=Ze.create(r,h,h.elements[0]),g=h.model.sequence.byEntityKey[lt.entity.key(m)];if(g&&g.sequence.length<=RT)p=new Cet(v);else{var y=c.reduce(function(x,C){return x+C.polymerElements.length},0);Ue.isAtomic(h)||y>RT?p=new DT(v):p=new Pet(v)}}else if(Ue.isAtomic(h)){var b=c.reduce(function(x,C){return x+C.residueCount},0);b>RT?p=new DT(v):p=new Aet(v)}else console.warn("should not happen, expecting coarse units to be polymeric"),p=new DT(v);return p.markResidue(t.getLoci(r),tr.Select),p}else return"No sequence available"}function xx(e,t){t===void 0&&(t=!1);for(var r=[],n=Ze.create(e),i=new Set,a=0,o=e.units;a<o.length;a++){var s=o[a];Ze.set(n,e,s,s.elements[0]);var u=lt.entity.id(n),l=e.getModelIndex(s.model),c=l+"|"+u;if(!i.has(c)&&!(t&&lt.entity.type(n)!=="polymer")){var d=lt.entity.pdbx_description(n).join(", ");e.models.length&&(e.representativeModel?d+=" (Model "+e.models[l].modelNum+")":d.startsWith("Polymer ")&&(d+=" ("+e.models[l].entry+")"));var f=u+": "+d;r.push([c,f]),i.add(c)}}return r.length===0&&r.push(["","No entities"]),r}function q0(e,t){for(var r=[],n=Ze.create(e),i=new Set,a=AL(t),o=a[0],s=a[1],u=0,l=e.units;u<l.length;u++){var c=l[u];if(Ze.set(n,e,c,c.elements[0]),e.getModelIndex(c.model)===o&&lt.entity.id(n)===s){var d=c.chainGroupId;if(!i.has(d)){var f=eu(n,{granularity:"chain",hidePrefix:!0,htmlStyling:!1});r.push([d,f]),i.add(d)}}}return r.length===0&&r.push([-1,"No units"]),r}function Jv(e,t,r){for(var n=[],i=Ze.create(e),a=new Set,o=AL(t),s=o[0],u=o[1],l=0,c=e.units;l<c.length;l++){var d=c[l];if(Ze.set(i,e,d,d.elements[0]),e.getModelIndex(d.model)===s&&lt.entity.id(i)===u&&d.chainGroupId===r){var f=are(i);if(!a.has(f)){var h=d.conformation.operator.name;n.push([f,h]),a.add(f)}}}return n.length===0&&n.push(["","No operators"]),n}function sV(e){for(var t,r=[],n=[],i=e.select(ir.Generators.rootsOfType(ge.Molecule.Structure)),a=0,o=i;a<o.length;a++){var s=o[a];!((t=s.obj)===null||t===void 0)&&t.data&&(n.push(s.obj.data),r.push([s.transform.ref,s.obj.data.label]))}return r.length===0&&r.push(["","No structure"]),{options:r,all:n}}var uV=I.Select("single",[["single","Chain"],["polymers","Polymers"],["all","Everything"]]),Tet=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={structureOptions:{options:[],all:[]},structure:$e.Empty,structureRef:"",modelEntityId:"",chainGroupId:-1,operatorKey:"",mode:"single"},r.setParamProps=function(n){var i=E({},r.state);switch(n.name){case"mode":if(i.mode=n.value,r.state.mode===i.mode)return;if(i.mode==="all"||i.mode==="polymers")break;case"structure":n.name==="structure"&&(i.structureRef=n.value),i.structure=r.getStructure(i.structureRef),i.modelEntityId=xx(i.structure)[0][0],i.chainGroupId=q0(i.structure,i.modelEntityId)[0][0],i.operatorKey=Jv(i.structure,i.modelEntityId,i.chainGroupId)[0][0];break;case"entity":i.modelEntityId=n.value,i.chainGroupId=q0(i.structure,i.modelEntityId)[0][0],i.operatorKey=Jv(i.structure,i.modelEntityId,i.chainGroupId)[0][0];break;case"chain":i.chainGroupId=n.value,i.operatorKey=Jv(i.structure,i.modelEntityId,i.chainGroupId)[0][0];break;case"operator":i.operatorKey=n.value;break}r.setState(i)},r}return t.prototype.componentDidMount=function(){var r=this;this.plugin.state.data.select(ir.Generators.rootsOfType(ge.Molecule.Structure)).length>0&&this.setState(this.getInitialState()),this.subscribe(this.plugin.state.events.object.updated,function(n){var i=n.ref,a=n.obj;i===r.state.structureRef&&a&&a.type===ge.Molecule.Structure.type&&a.data!==r.state.structure&&r.sync()}),this.subscribe(this.plugin.state.events.object.created,function(n){var i=n.obj;i&&i.type===ge.Molecule.Structure.type&&r.sync()}),this.subscribe(this.plugin.state.events.object.removed,function(n){var i=n.obj;i&&i.type===ge.Molecule.Structure.type&&i.data===r.state.structure&&r.sync()})},t.prototype.sync=function(){var r=sV(this.plugin.state.data);qk(r.all,this.state.structureOptions.all)||this.setState(this.getInitialState())},t.prototype.getStructure=function(r){var n=this.plugin.state.data,i=n.select(r)[0];return!r||!i||!i.obj?$e.Empty:i.obj.data},t.prototype.getSequenceWrapper=function(r){return{wrapper:oV(this.state,this.plugin.managers.structure.selection),label:I.optionLabel(r.chain,this.state.chainGroupId)+" | "+I.optionLabel(r.entity,this.state.modelEntityId)}},t.prototype.getSequenceWrappers=function(r){if(this.state.mode==="single")return[this.getSequenceWrapper(r)];for(var n=this.getStructure(this.state.structureRef),i=[],a=0,o=xx(n,this.state.mode==="polymers");a<o.length;a++)for(var s=o[a],u=s[0],l=s[1],c=0,d=q0(n,u);c<d.length;c++)for(var f=d[c],h=f[0],v=f[1],p=0,m=Jv(n,u,h);p<m.length;p++){var g=m[p][0];i.push({wrapper:oV({structure:n,modelEntityId:u,chainGroupId:h,operatorKey:g},this.plugin.managers.structure.selection),label:v+" | "+l})}return i},t.prototype.getInitialState=function(){var r,n=sV(this.plugin.state.data),i=n.options[0][0],a=this.getStructure(i),o=xx(a)[0][0],s=q0(a,o)[0][0],u=Jv(a,o,s)[0][0];return this.state.structure&&this.state.structure===a&&(o=this.state.modelEntityId,s=this.state.chainGroupId,u=this.state.operatorKey),{structureOptions:n,structure:a,structureRef:i,modelEntityId:o,chainGroupId:s,operatorKey:u,mode:(r=this.props.defaultMode)!==null&&r!==void 0?r:"single"}},Object.defineProperty(t.prototype,"params",{get:function(){var r=this.state,n=r.structureOptions,i=r.structure,a=r.modelEntityId,o=r.chainGroupId,s=xx(i),u=q0(i,a),l=Jv(i,a,o);return{structure:I.Select(n.options[0][0],n.options,{shortLabel:!0}),entity:I.Select(s[0][0],s,{shortLabel:!0}),chain:I.Select(u[0][0],u,{shortLabel:!0,twoColumns:!0,label:"Chain"}),operator:I.Select(l[0][0],l,{shortLabel:!0,twoColumns:!0}),mode:uV}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"values",{get:function(){return{structure:this.state.structureRef,entity:this.state.modelEntityId,chain:this.state.chainGroupId,operator:this.state.operatorKey,mode:this.state.mode}},enumerable:!1,configurable:!0}),t.prototype.render=function(){if(this.getStructure(this.state.structureRef)===$e.Empty)return T.jsx("div",E({className:"msp-sequence"},{children:T.jsxs("div",E({className:"msp-sequence-select"},{children:[T.jsx(nn,{svg:Sl,style:{cursor:"help",position:"absolute",right:0,top:0},title:"Shows a sequence of one or more chains. Use the controls to alter selection."},void 0),T.jsx("span",{children:"Sequence"},void 0),T.jsx("span",E({style:{fontWeight:"normal"}},{children:"No structure available"}),void 0)]}),void 0)}),void 0);var r=this.params,n=this.values,i=this.getSequenceWrappers(r);return T.jsxs("div",E({className:"msp-sequence"},{children:[T.jsxs("div",E({className:"msp-sequence-select"},{children:[T.jsx(nn,{svg:Sl,style:{cursor:"help",position:"absolute",right:0,top:0},title:"This shows a single sequence. Use the controls to show a different sequence."},void 0),T.jsx("span",{children:"Sequence of"},void 0),T.jsx(um,{title:"[Structure] "+I.optionLabel(r.structure,n.structure),param:r.structure,name:"structure",value:n.structure,onChange:this.setParamProps},void 0),T.jsx(um,{title:"[Mode]",param:uV,name:"mode",value:n.mode,onChange:this.setParamProps},void 0),n.mode==="single"&&T.jsx(um,{title:"[Entity] "+I.optionLabel(r.entity,n.entity),param:r.entity,name:"entity",value:n.entity,onChange:this.setParamProps},void 0),n.mode==="single"&&T.jsx(um,{title:"[Chain] "+I.optionLabel(r.chain,n.chain),param:r.chain,name:"chain",value:n.chain,onChange:this.setParamProps},void 0),r.operator.options.length>1&&T.jsx(T.Fragment,{children:T.jsx(um,{title:"[Instance] "+I.optionLabel(r.operator,n.operator),param:r.operator,name:"operator",value:n.operator,onChange:this.setParamProps},void 0)},void 0)]}),void 0),T.jsx(Iet,{children:i.map(function(a,o){var s=typeof a.wrapper=="string"?T.jsx("div",E({className:"msp-sequence-wrapper"},{children:a.wrapper}),o):T.jsx(xet,{sequenceWrapper:a.wrapper},o);return n.mode==="single"?s:T.jsxs(Ve.Fragment,{children:[T.jsx("div",E({className:"msp-sequence-chain-label"},{children:a.label}),void 0),s]},o)})},void 0)]}),void 0)},t}(pr);function Iet(e){var t=e.children;return T.jsx("div",E({className:"msp-sequence-wrapper-non-empty"},{children:t}),void 0)}var Met=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={tracked:ri.OrderedMap()},r}return t.prototype.componentDidMount=function(){var r=this,n,i=!!(!((n=this.plugin.spec.components)===null||n===void 0)&&n.hideTaskOverlay);this.subscribe(this.plugin.events.task.progress.pipe(S3(function(a){return a.level==="background"&&(i||!a.useOverlay)})),function(a){r.setState({tracked:r.state.tracked.set(a.id,a)})}),this.subscribe(this.plugin.events.task.finished,function(a){var o=a.id;r.setState({tracked:r.state.tracked.delete(o)})})},t.prototype.render=function(){return T.jsx("div",E({className:"msp-background-tasks"},{children:this.state.tracked.valueSeq().map(function(r){return T.jsx(ore,{event:r},r.id)})}),void 0)},t}(pr),ore=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.abort=function(){r.plugin.managers.task.requestAbort(r.props.event.progress.root.progress.taskId,"User Request")},r}return t.prototype.render=function(){var r=this.props.event.progress.root,n=sre(this.props.event.progress.root)-1,i=r.progress.isIndeterminate?void 0:T.jsxs(T.Fragment,{children:["[",r.progress.current,"/",r.progress.max,"]"]},void 0),a=n>0?T.jsxs(T.Fragment,{children:["[",n," subtask(s)]"]},void 0):void 0;return T.jsx("div",E({className:"msp-task-state"},{children:T.jsxs("div",{children:[r.progress.canAbort&&T.jsx(Ht,{svg:_Y,onClick:this.abort,title:"Abort"},void 0),T.jsxs("div",{children:[r.progress.message," ",i," ",a]},void 0)]},void 0)}),void 0)},t}(pr);function sre(e){if(e.children.length===0)return 1;for(var t=0,r=0,n=e.children;r<n.length;r++){var i=n[r];t+=sre(i)}return t}var Det=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={tracked:ri.OrderedMap()},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.events.task.progress.pipe(S3(function(n){return!!n.useOverlay})),function(n){r.setState({tracked:r.state.tracked.set(n.id,n)})}),this.subscribe(this.plugin.events.task.finished,function(n){var i=n.id;r.setState({tracked:r.state.tracked.delete(i)})})},t.prototype.render=function(){return this.state.tracked.size===0?null:T.jsx("div",E({className:"msp-overlay-tasks"},{children:this.state.tracked.valueSeq().map(function(r){return T.jsx(ore,{event:r},r.id)})}),void 0)},t}(pr),Ret=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.hide=function(){var n=r.props.entry;(n.hide||function(){}).call(null)},r}return t.prototype.render=function(){var r=this,n=this.props.entry,i=typeof n.message=="string"?T.jsx("div",{dangerouslySetInnerHTML:{__html:n.message}},void 0):T.jsx("div",{children:T.jsx(n.message,{},void 0)},void 0);return T.jsxs("div",E({className:"msp-toast-entry"},{children:[T.jsx("div",E({className:"msp-toast-title",onClick:function(){return r.hide()}},{children:n.title}),void 0),T.jsx("div",E({className:"msp-toast-message"},{children:i}),void 0),T.jsx("div",{className:"msp-toast-clear"},void 0),T.jsx("div",E({className:"msp-toast-hide"},{children:T.jsx(Ht,{svg:_Y,onClick:this.hide,title:"Hide",className:"msp-no-hover-outline"},void 0)}),void 0)]}),void 0)},t}(pr),ket=function(e){Le(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.managers.toast.events.changed,function(){return r.forceUpdate()})},t.prototype.render=function(){var r=this.plugin.managers.toast.state;if(!r.entries.count())return null;var n=[];return r.entries.forEach(function(i,a){return n.push(i)}),n.sort(function(i,a){return i.serialNumber-a.serialNumber}),T.jsx("div",E({className:"msp-toast-container"},{children:n.map(function(i){return T.jsx(Ret,{entry:i},i.serialNumber)})}),void 0)},t}(pr),Oet=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.container=Ve.createRef(),r.canvas=Ve.createRef(),r.state={noWebGl:!1,showLogo:!0},r.handleLogo=function(){var n;r.setState({showLogo:!(!((n=r.plugin.canvas3d)===null||n===void 0)&&n.reprCount.value)})},r}return t.prototype.componentDidMount=function(){if(!this.canvas.current||!this.container.current||!this.plugin.initViewer(this.canvas.current,this.container.current)){this.setState({noWebGl:!0});return}this.handleLogo(),this.subscribe(this.plugin.canvas3d.reprCount,this.handleLogo)},t.prototype.componentWillUnmount=function(){e.prototype.componentWillUnmount.call(this)},t.prototype.renderMissing=function(){if(this.props.noWebGl){var r=this.props.noWebGl;return T.jsx(r,{},void 0)}return T.jsx("div",E({className:"msp-no-webgl"},{children:T.jsxs("div",{children:[T.jsx("p",{children:T.jsx("b",{children:"WebGL does not seem to be available."},void 0)},void 0),T.jsx("p",{children:"This can be caused by an outdated browser, graphics card driver issue, or bad weather. Sometimes, just restarting the browser helps."},void 0),T.jsxs("p",{children:["For a list of supported browsers, refer to ",T.jsx("a",E({href:"http://caniuse.com/#feat=webgl",target:"_blank"},{children:"http://caniuse.com/#feat=webgl"}),void 0),"."]},void 0)]},void 0)}),void 0)},t.prototype.render=function(){if(this.state.noWebGl)return this.renderMissing();var r=this.props.logo;return T.jsxs("div",E({className:this.props.parentClassName||"msp-viewport",style:this.props.parentStyle},{children:[T.jsx("div",E({className:this.props.hostClassName||"msp-viewport-host3d",style:this.props.hostStyle,ref:this.container},{children:T.jsx("canvas",{ref:this.canvas},void 0)}),void 0),this.state.showLogo&&r&&T.jsx(r,{},void 0)]}),void 0)},t}(pr);function up(e){var t=Ve.useState(e==null?void 0:e.value),r=t[0],n=t[1];return Ve.useEffect(function(){if(!e){r!==void 0&&n(void 0);return}var i=!0,a=e.subscribe(function(o){i?(i=!1,o!==r&&n(o)):n(o)});return function(){a.unsubscribe()}},[e]),r}var Let=function(e){var t=e.plugin,r=e.cropFrameColor,n=t.helpers.viewportScreenshot,i=Ve.useState(null),a=i[0],o=i[1],s=Ve.useRef(null),u=Ve.useRef(e);return Ve.useEffect(function(){u.current=e},Object.values(e)),Ve.useEffect(function(){a!==s.current&&o(s.current)}),Ve.useEffect(function(){var l,c=!1,d=[];function f(g,y){g&&d.push(g.subscribe(y))}function h(){var g=u.current;!g.suspend&&s.current&&lV(n,s.current,g.customBackground,g.borderColor,g.borderWidth),s.current||(c=!0)}var v=setInterval(function(){c&&(c=!1,h())},1e3/8);f(t.events.canvas3d.settingsUpdated,function(){return c=!0}),f((l=t.canvas3d)===null||l===void 0?void 0:l.didDraw,function(){return c=!0}),f(t.state.data.behaviors.isUpdating,function(g){g||(c=!0)}),f(n.behaviors.values,function(){return c=!0}),f(n.behaviors.cropParams,function(){return c=!0});var p=void 0;typeof ResizeObserver<"u"&&(p=new ResizeObserver(function(){return c=!0}));var m=s.current;return p==null||p.observe(m),h(),function(){clearInterval(v),d.forEach(function(g){return g.unsubscribe()}),p==null||p.unobserve(m)}},[n]),Ve.useLayoutEffect(function(){s.current&&lV(n,s.current,e.customBackground,e.borderColor,e.borderWidth)},Ft([],Object.values(e))),T.jsx(T.Fragment,{children:T.jsxs("div",E({style:{position:"relative",width:"100%",height:"100%"}},{children:[T.jsx("canvas",{ref:s,onContextMenu:function(l){l.preventDefault(),l.stopPropagation()},style:{display:"block",width:"100%",height:"100%"}},void 0),T.jsx(Fet,{plugin:t,canvas:a,color:r},void 0)]}),void 0)},void 0)},Net=Ve.memo(Let,function(e,t){return jk(e,t)});function lV(e,t,r,n,i){var a=e.getPreview(),o=a.canvas,s=a.width,u=a.height,l=t.getContext("2d");if(l){var c=t.clientWidth,d=t.clientHeight;t.width=c,t.height=d,l.clearRect(0,0,c,d);var f=ure(s,u,c,d);if(r)l.fillStyle=r,l.fillRect(f.x,f.y,f.width,f.height);else if(e.values.transparent)for(var h=13,v=0;v<f.width;v+=h)for(var p=0;p<f.height;p+=h){l.fillStyle=(v+p)%2?"#ffffff":"#bfbfbf";var m=f.x+v,g=f.y+p,y=v+h>f.width?f.width-v:h,b=p+h>f.height?f.height-p:h;l.fillRect(m,g,y,b)}if(l.drawImage(o,f.x,f.y,f.width,f.height),n&&i){var S=i;l.rect(f.x,f.y,f.width,f.height),l.rect(f.x+S,f.y+S,f.width-2*S,f.height-2*S),l.fillStyle=n,l.fill("evenodd")}}}function Fet(e){var t,r=e.plugin,n=e.canvas,i=e.color,a=i===void 0?"rgba(255, 87, 45, 0.75)":i,o=r.helpers.viewportScreenshot,s=up(o==null?void 0:o.behaviors.values),u=up(o==null?void 0:o.behaviors.cropParams),l=up(o==null?void 0:o.behaviors.relativeCrop),c=Ve.useRef({x:0,y:0,width:0,height:0});up((s==null?void 0:s.resolution.name)==="viewport"?(t=r.canvas3d)===null||t===void 0?void 0:t.resized:void 0);var d=Ve.useState(""),f=d[0],h=d[1],v=Ve.useState([0,0]),p=v[0],m=v[1],g=Ve.useState([0,0]),y=g[0],b=g[1];if(!o||!n)return null;var S=o.getSizeAndViewport(),x=S.width,C=S.height,w=ure(x,C,n.clientWidth,n.clientHeight),A={x:w.x+Math.floor(w.width*l.x),y:w.y+Math.floor(w.height*l.y),width:Math.ceil(w.width*l.width),height:Math.ceil(w.height*l.height)},M=cV(A),D=cV(w);if(f==="move"?(M.l+=y[0]-p[0],M.r+=y[0]-p[0],M.t+=y[1]-p[1],M.b+=y[1]-p[1]):f&&(f.indexOf("left")>=0?M.l+=y[0]-p[0]:f.indexOf("right")>=0&&(M.r+=y[0]-p[0]),f.indexOf("top")>=0?M.t+=y[1]-p[1]:f.indexOf("bottom")>=0&&(M.b+=y[1]-p[1])),M.l>M.r){var k=M.l;M.l=M.r,M.r=k}if(M.t>M.b){var k=M.t;M.t=M.b,M.b=k}var R=40;M.l=Math.min(D.r-R,Math.max(D.l,M.l)),M.r=Math.max(D.l+R,Math.min(D.r,M.r)),M.t=Math.min(D.b-R,Math.max(D.t,M.t)),M.b=Math.max(D.t+R,Math.min(D.b,M.b)),A.x=M.l,A.y=M.t,A.width=M.r-M.l+1,A.height=M.b-M.t+1,c.current=A;var L=function(X){X.preventDefault(),b([X.pageX,X.pageY])},H=function(X){X.preventDefault();var U=X.touches[0];b([U.pageX,U.pageY])},B=function(X){X.preventDefault(),h(X.currentTarget.getAttribute("data-drag"));var U=X.touches[0],z=[U.pageX,U.pageY];m(z),b(z),window.addEventListener("touchend",G),window.addEventListener("touchmove",H)},j=function(X){X.preventDefault(),h(X.currentTarget.getAttribute("data-drag"));var U=[X.pageX,X.pageY];m(U),b(U),window.addEventListener("mouseup",Q),window.addEventListener("mousemove",L)},Q=function(){window.removeEventListener("mouseup",Q),window.removeEventListener("mousemove",L),W()},G=function(){window.removeEventListener("touchend",G),window.removeEventListener("touchmove",H),W()};function W(){var X=c.current;u.auto&&(o==null||o.behaviors.cropParams.next(E(E({},u),{auto:!1}))),o==null||o.behaviors.relativeCrop.next({x:(X.x-w.x)/w.width,y:(X.y-w.y)/w.height,width:X.width/w.width,height:X.height/w.height}),h("");var U=[0,0];m(U),b(U)}var q=function(X){X.preventDefault(),X.stopPropagation()},ee=4,he="3px solid "+a,$="transparent";return T.jsxs(T.Fragment,{children:[T.jsx("div",{"data-drag":"move",style:{position:"absolute",left:A.x,top:A.y,width:A.width,height:A.height,border:he,cursor:"move"},onMouseDown:j,onTouchStart:B,draggable:!1,onContextMenu:q},void 0),T.jsx("div",{"data-drag":"left",style:{position:"absolute",left:A.x-ee,top:A.y+ee,width:4*ee,height:A.height-ee,background:$,cursor:"w-resize"},onMouseDown:j,onTouchStart:B,draggable:!1,onContextMenu:q},void 0),T.jsx("div",{"data-drag":"right",style:{position:"absolute",left:M.r-2*ee,top:A.y,width:4*ee,height:A.height-ee,background:$,cursor:"w-resize"},onMouseDown:j,onTouchStart:B,draggable:!1,onContextMenu:q},void 0),T.jsx("div",{"data-drag":"top",style:{position:"absolute",left:A.x-ee,top:A.y-ee,width:A.width+2*ee,height:4*ee,background:$,cursor:"n-resize"},onMouseDown:j,onTouchStart:B,draggable:!1,onContextMenu:q},void 0),T.jsx("div",{"data-drag":"bottom",style:{position:"absolute",left:A.x-ee,top:M.b-2*ee,width:A.width+2*ee,height:4*ee,background:$,cursor:"n-resize"},onMouseDown:j,onTouchStart:B,draggable:!1,onContextMenu:q},void 0),T.jsx("div",{"data-drag":"top, left",style:{position:"absolute",left:M.l-ee,top:M.t-ee,width:4*ee,height:4*ee,background:$,cursor:"nw-resize"},onMouseDown:j,onTouchStart:B,draggable:!1,onContextMenu:q},void 0),T.jsx("div",{"data-drag":"bottom, right",style:{position:"absolute",left:M.r-2*ee,top:M.b-2*ee,width:4*ee,height:4*ee,background:$,cursor:"nw-resize"},onMouseDown:j,onTouchStart:B,draggable:!1,onContextMenu:q},void 0),T.jsx("div",{"data-drag":"top, right",style:{position:"absolute",left:M.r-2*ee,top:M.t-ee,width:4*ee,height:4*ee,background:$,cursor:"ne-resize"},onMouseDown:j,onTouchStart:B,draggable:!1,onContextMenu:q},void 0),T.jsx("div",{"data-drag":"bottom, left",style:{position:"absolute",left:M.l-ee,top:M.b-2*ee,width:4*ee,height:4*ee,background:$,cursor:"ne-resize"},onMouseDown:j,onTouchStart:B,draggable:!1,onContextMenu:q},void 0)]},void 0)}function cV(e){return{l:e.x,t:e.y,r:e.x+e.width-1,b:e.y+e.height-1}}function ure(e,t,r,n){var i=e/t,a=r/n;if(i<=a){var o=n*i;return{x:Math.round((r-o)/2),y:0,width:Math.round(o),height:n}}else{var o=r/i;return{x:0,y:Math.round((n-o)/2),width:r,height:Math.round(o)}}}var Bet=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={showPreview:!0,isDisabled:!1},r.download=function(){var n;(n=r.plugin.helpers.viewportScreenshot)===null||n===void 0||n.download(),r.props.close()},r.copy=function(){return ce(r,void 0,void 0,function(){var n;return de(this,function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,(n=this.plugin.helpers.viewportScreenshot)===null||n===void 0?void 0:n.copyToClipboard()];case 1:return i.sent(),_t.Toast.Show(this.plugin,{message:"Copied to clipboard.",title:"Screenshot",timeoutMs:1500}),[3,3];case 2:return i.sent(),[2,this.copyImg()];case 3:return[2]}})})},r.copyImg=function(){return ce(r,void 0,void 0,function(){var n,i;return de(this,function(a){switch(a.label){case 0:return[4,(i=this.plugin.helpers.viewportScreenshot)===null||i===void 0?void 0:i.getImageDataUri()];case 1:return n=a.sent(),this.setState({imageData:n}),[2]}})})},r.open=function(n){!n.target.files||!n.target.files[0]||_t.State.Snapshots.OpenFile(r.plugin,{file:n.target.files[0]})},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.state.data.behaviors.isUpdating,function(n){r.setState({isDisabled:n})})},t.prototype.componentWillUnmount=function(){this.setState({imageData:void 0})},t.prototype.render=function(){var r=this,n,i=!!(!((n=navigator.clipboard)===null||n===void 0)&&n.write);return T.jsxs("div",{children:[this.state.showPreview&&T.jsxs("div",E({className:"msp-image-preview"},{children:[T.jsx(Net,{plugin:this.plugin},void 0),T.jsx(jet,{plugin:this.plugin},void 0)]}),void 0),T.jsxs("div",E({className:"msp-flex-row"},{children:[!this.state.imageData&&T.jsx(hr,E({icon:pEe,onClick:i?this.copy:this.copyImg,disabled:this.state.isDisabled},{children:"Copy"}),void 0),this.state.imageData&&T.jsx(hr,E({onClick:function(){return r.setState({imageData:void 0})},disabled:this.state.isDisabled},{children:"Clear"}),void 0),T.jsx(hr,E({icon:_M,onClick:this.download,disabled:this.state.isDisabled},{children:"Download"}),void 0)]}),void 0),this.state.imageData&&T.jsxs("div",E({className:"msp-row msp-copy-image-wrapper"},{children:[T.jsx("div",{children:"Right click below + Copy Image"},void 0),T.jsx("img",{src:this.state.imageData,style:{width:"100%",height:32,display:"block"}},void 0)]}),void 0),T.jsx(Uet,{plugin:this.plugin,isDisabled:this.state.isDisabled},void 0),T.jsxs(Tu,E({header:"State"},{children:[T.jsx(ere,{onAction:this.props.close},void 0),T.jsx(Tu,E({header:"Save Options",initiallyExpanded:!1,noOffset:!0},{children:T.jsx(tre,{},void 0)}),void 0)]}),void 0)]},void 0)},t}(pr);function Uet(e){var t=e.plugin,r=e.isDisabled,n=t.helpers.viewportScreenshot,i=up(n.behaviors.values);return T.jsx(On,{params:n.params,values:i,onChangeValues:function(a){return n.behaviors.values.next(a)},isDisabled:r},void 0)}function jet(e){var t=e.plugin,r=t.helpers.viewportScreenshot,n=up(r==null?void 0:r.behaviors.cropParams);return up(r==null?void 0:r.behaviors.relativeCrop),r?T.jsxs("div",E({style:{width:"100%",height:"24px",marginTop:"8px"}},{children:[T.jsx(Ai,{icon:xEe,title:"Auto-crop",inline:!0,isSelected:n.auto,style:{background:"transparent",float:"left",width:"auto",height:"24px",lineHeight:"24px"},toggle:function(){return r.toggleAutocrop()},label:"Auto-crop "+(n.auto?"On":"Off")},void 0),!n.auto&&T.jsx(hr,{icon:mEe,title:"Crop",style:{background:"transparent",float:"right",height:"24px",lineHeight:"24px",width:"24px",padding:"0"},onClick:function(){return r.autocrop()}},void 0),!n.auto&&!r.isFullFrame&&T.jsx(hr,{icon:yEe,title:"Reset Crop",style:{background:"transparent",float:"right",height:"24px",lineHeight:"24px",width:"24px",padding:"0"},onClick:function(){return r.resetCrop()}},void 0)]}),void 0):null}function zet(e){return function(t){var r=t.values,n=t.update,i=t.apply;return{params:typeof e.params=="function"?e.params:function(a){return e.params},getTarget:e.target,getValues:r,update:function(a,o){var s=e.target(o);return Hp(s,function(u){return n(a,u,o)})},apply:i||function(){}}}}var Vet=function(e){Le(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.events.canvas3d.settingsUpdated,function(){return r.forceUpdate()}),this.subscribe(this.plugin.canvas3d.camera.stateChanged,function(n){(n.radiusMax!==void 0||n.radius!==void 0)&&r.forceUpdate()})},t.prototype.render=function(){return this.plugin.canvas3d?T.jsxs(T.Fragment,{children:[T.jsx(pKe,{mapping:Get},void 0),T.jsx(fL,{},void 0)]},void 0):null},t}(pr),SS={sequence:"Sequence",log:"Log",left:"Left Panel"},Het={spin:I.Group({spin:gs.trackball.params.spin,speed:gs.trackball.params.spinSpeed},{pivot:"spin"}),camera:gs.camera,background:I.Group({color:I.Color(at(16579577),{label:"Background",description:"Custom background color"}),transparent:I.Boolean(!1)},{pivot:"color"}),lighting:I.Group({renderStyle:gs.renderer.params.style,occlusion:gs.postprocessing.params.occlusion,outline:gs.postprocessing.params.outline,fog:gs.cameraFog},{pivot:"renderStyle"}),clipping:I.Group(E(E({},gs.cameraClipping.params),gs.renderer.params.clip.params),{pivot:"radius"}),layout:I.MultiSelect([],I.objectToOptions(SS))},Get=zet({params:function(e){var t,r=I.clone(Het),n=(t=e.spec.components)===null||t===void 0?void 0:t.controls;if(n){var i=[];n.top!=="none"&&i.push(["sequence",SS.sequence]),n.bottom!=="none"&&i.push(["log",SS.log]),n.left!=="none"&&i.push(["left",SS.left]),r.layout.options=i}return r},target:function(e){var t,r,n=(t=e.spec.components)===null||t===void 0?void 0:t.controls,i=e.layout.state.regionState,a=[];return i.top!=="hidden"&&(!n||n.top!=="none")&&a.push("sequence"),i.bottom!=="hidden"&&(!n||n.bottom!=="none")&&a.push("log"),i.left!=="hidden"&&(!n||n.left!=="none")&&a.push("left"),{canvas:(r=e.canvas3d)===null||r===void 0?void 0:r.props,layout:a}}})({values:function(e,t){var r=e.canvas,n=r.renderer;return{layout:e.layout,spin:{spin:!!r.trackball.spin,speed:r.trackball.spinSpeed},camera:r.camera,background:{color:n.backgroundColor,transparent:r.transparentBackground},lighting:{renderStyle:n.style,occlusion:r.postprocessing.occlusion,outline:r.postprocessing.outline,fog:r.cameraFog},clipping:E(E({},r.cameraClipping),r.renderer.clip)}},update:function(e,t){var r=t.canvas;r.trackball.spin=e.spin.spin,r.trackball.spinSpeed=e.spin.speed,r.camera=e.camera,r.transparentBackground=e.background.transparent,r.renderer.backgroundColor=e.background.color,r.renderer.style=e.lighting.renderStyle,r.postprocessing.occlusion=e.lighting.occlusion,r.postprocessing.outline=e.lighting.outline,r.cameraFog=e.lighting.fog,r.cameraClipping={radius:e.clipping.radius,far:e.clipping.far},r.renderer.clip={variant:e.clipping.variant,objects:e.clipping.objects},t.layout=e.layout},apply:function(e,t){return ce(this,void 0,void 0,function(){var r,n;return de(this,function(i){switch(i.label){case 0:return[4,_t.Canvas3D.SetSettings(t,{settings:e.canvas})];case 1:return i.sent(),r=e.layout.indexOf("left")<0,n=Hp(t.layout.state,function(a){a.regionState.top=e.layout.indexOf("sequence")>=0?"full":"hidden",a.regionState.bottom=e.layout.indexOf("log")>=0?"full":"hidden",a.regionState.left=r?"hidden":t.behaviors.layout.leftPanelTabName.value==="none"?"collapsed":"full"}),[4,_t.Layout.Update(t,{state:n})];case 2:return i.sent(),r&&_t.State.SetCurrentObject(t,{state:t.state.data,ref:cr.RootRef}),[2]}})})}}),qet=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.allCollapsedState={isSettingsExpanded:!1,isScreenshotExpanded:!1},r.state=E({},r.allCollapsedState),r.resetCamera=function(){_t.Camera.Reset(r.plugin,{})},r.toggleSettingsExpanded=r.toggle("isSettingsExpanded"),r.toggleScreenshotExpanded=r.toggle("isScreenshotExpanded"),r.toggleControls=function(){_t.Layout.Update(r.plugin,{state:{showControls:!r.plugin.layout.state.showControls}})},r.toggleExpanded=function(){_t.Layout.Update(r.plugin,{state:{isExpanded:!r.plugin.layout.state.isExpanded}})},r.setSettings=function(n){var i;_t.Canvas3D.SetSettings(r.plugin,{settings:(i={},i[n.name]=n.value,i)})},r.setLayout=function(n){var i;_t.Layout.Update(r.plugin,{state:(i={},i[n.name]=n.value,i)})},r.screenshot=function(){var n;(n=r.plugin.helpers.viewportScreenshot)===null||n===void 0||n.download()},r.onMouseMove=function(n){n.buttons===0&&n.stopPropagation()},r}return t.prototype.toggle=function(r){var n=this;return function(i){var a;n.setState(E(E({},n.allCollapsedState),(a={},a[r]=!n.state[r],a))),i==null||i.currentTarget.blur()}},t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.events.canvas3d.settingsUpdated,function(){return r.forceUpdate()}),this.subscribe(this.plugin.layout.events.updated,function(){return r.forceUpdate()})},t.prototype.icon=function(r,n,i,a){return a===void 0&&(a=!0),T.jsx(Ht,{svg:r,toggleState:a,onClick:n,title:i,style:{background:"transparent"}},void 0)},t.prototype.render=function(){return T.jsxs("div",E({className:"msp-viewport-controls",onMouseMove:this.onMouseMove},{children:[T.jsxs("div",E({className:"msp-viewport-controls-buttons"},{children:[T.jsxs("div",{children:[T.jsx("div",{className:"msp-semi-transparent-background"},void 0),this.icon(G3e,this.resetCamera,"Reset Camera")]},void 0),T.jsxs("div",{children:[T.jsx("div",{className:"msp-semi-transparent-background"},void 0),this.icon(J3e,this.toggleScreenshotExpanded,"Screenshot / State Snapshot",this.state.isScreenshotExpanded)]},void 0),T.jsxs("div",{children:[T.jsx("div",{className:"msp-semi-transparent-background"},void 0),this.plugin.config.get(Wr.Viewport.ShowControls)&&this.icon(Y3e,this.toggleControls,"Toggle Controls Panel",this.plugin.layout.state.showControls),this.plugin.config.get(Wr.Viewport.ShowExpand)&&this.icon(AEe,this.toggleExpanded,"Toggle Expanded Viewport",this.plugin.layout.state.isExpanded),this.plugin.config.get(Wr.Viewport.ShowSettings)&&this.icon(zp,this.toggleSettingsExpanded,"Settings / Controls Info",this.state.isSettingsExpanded)]},void 0),this.plugin.config.get(Wr.Viewport.ShowSelectionMode)&&T.jsxs("div",{children:[T.jsx("div",{className:"msp-semi-transparent-background"},void 0),T.jsx(F_,{},void 0)]},void 0)]}),void 0),this.state.isScreenshotExpanded&&T.jsx("div",E({className:"msp-viewport-controls-panel"},{children:T.jsx(fc,E({header:"Screenshot / State",title:"Click to close.",initialExpanded:!0,hideExpander:!0,hideOffset:!0,onHeaderClick:this.toggleScreenshotExpanded,topRightIcon:dc,noTopMargin:!0,childrenClassName:"msp-viewport-controls-panel-controls"},{children:T.jsx(Bet,{close:this.toggleScreenshotExpanded},void 0)}),void 0)}),void 0),this.state.isSettingsExpanded&&T.jsx("div",E({className:"msp-viewport-controls-panel"},{children:T.jsx(fc,E({header:"Settings / Controls Info",title:"Click to close.",initialExpanded:!0,hideExpander:!0,hideOffset:!0,onHeaderClick:this.toggleSettingsExpanded,topRightIcon:dc,noTopMargin:!0,childrenClassName:"msp-viewport-controls-panel-controls"},{children:T.jsx(Vet,{},void 0)}),void 0)}),void 0)]}),void 0)},t}(pr),Wet=function(){return T.jsx("a",{className:"msp-logo",href:"https://molstar.org",target:"_blank"},void 0)},$et=function(){return T.jsx(Oet,{logo:Wet},void 0)},Xet=function(e){Le(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.region=function(r,n){return T.jsx("div",E({className:"msp-layout-region msp-layout-"+r},{children:T.jsx("div",E({className:"msp-layout-static"},{children:n}),void 0)}),void 0)},t.prototype.render=function(){return T.jsx(v3.Provider,E({value:this.props.plugin},{children:T.jsx(Yet,{},void 0)}),void 0)},t}(Ve.Component);(function(e){Le(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.render=function(){return T.jsx(v3.Provider,E({value:this.props.plugin},{children:T.jsx("div",E({className:"msp-plugin"},{children:this.props.children}),void 0)}),void 0)},t})(Ve.Component);var Yet=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.onDrop=function(n){n.preventDefault();var i;if(n.dataTransfer.items){for(var a=0;a<n.dataTransfer.items.length;a++)if(n.dataTransfer.items[a].kind==="file"){i=n.dataTransfer.items[a].getAsFile();break}}else i=n.dataTransfer.files[0];if(i){var o=(i==null?void 0:i.name.toLowerCase())||"";(o.endsWith("molx")||o.endsWith("molj"))&&_t.State.Snapshots.OpenFile(r.plugin,{file:i})}},r.onDragOver=function(n){n.preventDefault()},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.layout.events.updated,function(){return r.forceUpdate()})},t.prototype.region=function(r,n){return T.jsx("div",E({className:"msp-layout-region msp-layout-"+r},{children:T.jsx("div",E({className:"msp-layout-static"},{children:n?T.jsx(n,{},void 0):null}),void 0)}),void 0)},Object.defineProperty(t.prototype,"layoutVisibilityClassName",{get:function(){var r,n,i=this.plugin.layout.state,a=(n=(r=this.plugin.spec.components)===null||r===void 0?void 0:r.controls)!==null&&n!==void 0?n:{},o=[];return(a.top==="none"||!i.showControls||i.regionState.top==="hidden")&&o.push("msp-layout-hide-top"),a.left==="none"||!i.showControls||i.regionState.left==="hidden"?o.push("msp-layout-hide-left"):i.regionState.left==="collapsed"&&o.push("msp-layout-collapse-left"),(a.right==="none"||!i.showControls||i.regionState.right==="hidden")&&o.push("msp-layout-hide-right"),(a.bottom==="none"||!i.showControls||i.regionState.bottom==="hidden")&&o.push("msp-layout-hide-bottom"),o.join(" ")},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"layoutClassName",{get:function(){var r=this.plugin.layout.state,n=["msp-plugin-content"];return r.isExpanded?n.push("msp-layout-expanded"):n.push("msp-layout-standard","msp-layout-standard-"+r.controlsDisplay),n.join(" ")},enumerable:!1,configurable:!0}),t.prototype.render=function(){var r,n,i,a,o=this.plugin.layout.state,s=((r=this.plugin.spec.components)===null||r===void 0?void 0:r.controls)||{},u=((i=(n=this.plugin.spec.components)===null||n===void 0?void 0:n.viewport)===null||i===void 0?void 0:i.view)||Qet;return T.jsx("div",E({className:"msp-plugin",onDrop:this.onDrop,onDragOver:this.onDragOver},{children:T.jsxs("div",E({className:this.layoutClassName},{children:[T.jsxs("div",E({className:this.layoutVisibilityClassName},{children:[this.region("main",u),o.showControls&&s.top!=="none"&&this.region("top",s.top||Tet),o.showControls&&s.left!=="none"&&this.region("left",s.left||met),o.showControls&&s.right!=="none"&&this.region("right",s.right||Ket),o.showControls&&s.bottom!=="none"&&this.region("bottom",s.bottom||Zet)]}),void 0),!(!((a=this.plugin.spec.components)===null||a===void 0)&&a.hideTaskOverlay)&&T.jsx(Det,{},void 0)]}),void 0)}),void 0)},t}(pr),Ket=function(e){Le(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.render=function(){var r,n=((r=this.plugin.spec.components)===null||r===void 0?void 0:r.structureTools)||tet;return T.jsx("div",E({className:"msp-scrollable-container"},{children:T.jsx(n,{},void 0)}),void 0)},t}(pr),Qet=function(e){Le(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.render=function(){var r,n,i=((n=(r=this.plugin.spec.components)===null||r===void 0?void 0:r.viewport)===null||n===void 0?void 0:n.controls)||qet;return T.jsxs(T.Fragment,{children:[T.jsx($et,{},void 0),T.jsxs("div",E({className:"msp-viewport-top-left-controls"},{children:[T.jsx(QJe,{},void 0),T.jsx(YJe,{},void 0),T.jsx(KJe,{},void 0)]}),void 0),T.jsx(ZJe,{},void 0),T.jsx(i,{},void 0),T.jsx(Met,{},void 0),T.jsxs("div",E({className:"msp-highlight-toast-wrapper"},{children:[T.jsx(JJe,{},void 0),T.jsx(ket,{},void 0)]}),void 0)]},void 0)},t}(pr),Zet=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.wrapper=Ve.createRef(),r.state={entries:r.plugin.log.entries},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.events.log,function(){return r.setState({entries:r.plugin.log.entries})})},t.prototype.componentDidUpdate=function(){this.scrollToBottom()},t.prototype.scrollToBottom=function(){var r=this.wrapper.current;r&&(r.scrollTop=r.scrollHeight-r.clientHeight-1)},t.prototype.render=function(){for(var r=10,n=this.state.entries,i=n.size,a=[],o=Math.max(0,i-r),s=0;o<i;o++){var u=n.get(o);a.push(T.jsxs("li",{children:[T.jsx("div",{className:"msp-log-entry-badge msp-log-entry-"+u.type},void 0),T.jsx("div",E({className:"msp-log-timestamp"},{children:v_e(u.timestamp)}),void 0),T.jsx("div",E({className:"msp-log-entry"},{children:u.message}),void 0)]},s++))}return T.jsx("div",E({ref:this.wrapper,className:"msp-log",style:{position:"absolute",top:"0",right:"0",bottom:"0",left:"0",overflowY:"auto"}},{children:T.jsx("ul",E({className:"msp-list-unstyled"},{children:a}),void 0)}),void 0)},t}(pr);function Jet(e,t,r,n){n===void 0&&(n=1),e.width=Math.round(window.devicePixelRatio*n*t),e.height=Math.round(window.devicePixelRatio*n*r),Object.assign(e.style,{width:t+"px",height:r+"px"})}function ett(e,t,r){r===void 0&&(r=1);var n=window.innerWidth,i=window.innerHeight;t!==document.body&&(n=t.offsetWidth,i=t.offsetHeight),Jet(e,n,i,r)}function ttt(e,t,r,n){for(var i=atob(e.toDataURL(r,n).split(",")[1]),a=i.length,o=a>>2,s=new Uint8Array(a),u=new Uint32Array(s.buffer,0,o),l=0,c=0;c<o;++c)u[c]=i.charCodeAt(l++)|i.charCodeAt(l++)<<8|i.charCodeAt(l++)<<16|i.charCodeAt(l++)<<24;for(var d=a&3;d--;)s[l]=i.charCodeAt(l++);t(new Blob([s],{type:r||"image/png"}))}function dV(e,t,r){return ce(this,void 0,void 0,function(){return de(this,function(n){return[2,new Promise(function(i,a){var o=function(s){s?i(s):a("no blob returned")};HTMLCanvasElement.prototype.toBlob?e.toBlob(o,t,r):ttt(e,o,t,r)})]})})}var W_;(function(e){var t=function(){function r(){this.providers=ri.OrderedMap().asMutable(),this.defaultAutoAttachValues=new Map}return r.prototype.getParams=function(n){var i={},a=[],o=[];if(n)for(var s=this.providers.values();;){var u=s.next();if(u.done)break;var l=u.value;l.isApplicable(n)&&(l.isHidden||(a.push([l.descriptor.name,l.label]),this.defaultAutoAttachValues.get(l.descriptor.name)&&o.push(l.descriptor.name)),i[l.descriptor.name]=I.Group(E({},l.getParams(n)),{label:l.label,isHidden:l.isHidden}))}return{autoAttach:I.MultiSelect(o,a),properties:I.Group(i,{isFlat:!0})}},r.prototype.setDefaultAutoAttach=function(n,i){this.defaultAutoAttachValues.set(n,i)},r.prototype.get=function(n){var i=this.providers.get(n);if(!i)throw new Error("Custom property '"+n+"' is not registered.");return this.providers.get(n)},r.prototype.register=function(n,i){this.providers.set(n.descriptor.name,n),this.defaultAutoAttachValues.set(n.descriptor.name,i)},r.prototype.unregister=function(n){this.providers.delete(n),this.defaultAutoAttachValues.delete(n)},r}();e.Registry=t})(W_||(W_={}));var rtt=["gz","zip"],ntt=["bcif","ccp4","dcd"];function PL(e){var t,r,n="";e instanceof File?t=e.name:e instanceof Blob?t="":t=e;var i=t.lastIndexOf("?"),a=i!==-1?t.substring(i):"";t=t.substring(0,i===-1?t.length:i);var o=t.replace(/^.*[\\/]/,""),s=o.substring(0,o.lastIndexOf(".")),u=o.split("."),l=u.length>1?(u.pop()||"").toLowerCase():"",c=t.match(/^(.+):\/\/(.+)$/);c&&(n=c[1].toLowerCase(),t=c[2]||"");var d=t.substring(0,t.lastIndexOf("/")+1);if(rtt.includes(l)){r=l;var f=t.length-l.length-1;l=(t.substr(0,f).split(".").pop()||"").toLowerCase();var h=s.length-l.length-1;s=s.substr(0,h)}else r=!1;var v=ntt.includes(l);return{path:t,name:o,ext:l,base:s,dir:d,compressed:r,binary:v,protocol:n,query:a,src:e}}var itt=function(){function e(t){this.plugin=t}return Object.defineProperty(e.prototype,"dataState",{get:function(){return this.plugin.state.data},enumerable:!1,configurable:!0}),e.prototype.rawData=function(t,r){var n=this.dataState.build().toRoot().apply(RQ,t,r);return n.commit({revertOnError:!0})},e.prototype.download=function(t,r){var n=this.dataState.build().toRoot().apply(MQ,t,r);return n.commit({revertOnError:!0})},e.prototype.downloadBlob=function(t,r){var n=this.dataState.build().toRoot().apply(DQ,t,r);return n.commit({revertOnError:!0})},e.prototype.readFile=function(t,r){var n;return ce(this,void 0,void 0,function(){var i,a;return de(this,function(o){switch(o.label){case 0:return[4,this.dataState.build().toRoot().apply(kQ,t,r).commit({revertOnError:!0})];case 1:return i=o.sent(),a=PL(((n=t.file)===null||n===void 0?void 0:n.file)||""),[2,{data:i,fileInfo:a}]}})})},e}(),att=function(){function e(t){var r=this;this.plugin=t,this._providers=[],this.providerMap=new Map,this.defaultProvider=Qm.auto,Iu(Qm,function(n){return r.registerPreset(n)})}return Object.defineProperty(e.prototype,"dataState",{get:function(){return this.plugin.state.data},enumerable:!1,configurable:!0}),e.prototype.resolveProvider=function(t){var r;return typeof t=="string"?(r=Qm[t])!==null&&r!==void 0?r:Lk(this._providers,function(n){return n.id===t}):t},e.prototype.hasPreset=function(t){for(var r=0,n=this._providers;r<n.length;r++){var i=n[r];if(!i.isApplicable||i.isApplicable(t,this.plugin))return!0}return!1},Object.defineProperty(e.prototype,"providers",{get:function(){return this._providers},enumerable:!1,configurable:!0}),e.prototype.getPresets=function(t){if(!t)return this.providers;for(var r=[],n=0,i=this._providers;n<i.length;n++){var a=i[n];a.isApplicable&&!a.isApplicable(t,this.plugin)||r.push(a)}return r},e.prototype.getPresetSelect=function(t){for(var r=[],n=0,i=this._providers;n<i.length;n++){var a=i[n];t&&a.isApplicable&&!a.isApplicable(t,this.plugin)||r.push([a.id,a.display.name,a.display.group])}return I.Select("auto",r)},e.prototype.getPresetsWithOptions=function(t){for(var r=[],n=Object.create(null),i=0,a=this._providers;i<a.length;i++){var o=a[i];o.isApplicable&&!o.isApplicable(t,this.plugin)||(r.push([o.id,o.display.name]),n[o.id]=o.params?I.Group(o.params(t,this.plugin)):I.EmptyGroup())}return r.length===0?I.MappedStatic("",{"":I.EmptyGroup()}):I.MappedStatic(r[0][0],n,{options:r})},e.prototype.registerPreset=function(t){if(this.providerMap.has(t.id))throw new Error("Representation provider with id '"+t.id+"' already registered.");this._providers.push(t),this.providerMap.set(t.id,t)},e.prototype.unregisterPreset=function(t){this.providerMap.delete(t.id),j1(this._providers,t)},e.prototype.applyPreset=function(t,r,n){var i=this,a,o=this.resolveProvider(r);if(o){var s=this.plugin.state.data,u=Ii.resolveAndCheck(s,t);if(!u){$g||console.warn("Applying structure repr. provider to bad cell.");return}var l=((a=o.params)===null||a===void 0?void 0:a.call(o,u.obj,this.plugin))||{},c=n||(o.params?I.getDefaultValues(l):{}),d=this.plugin.config.get(Wr.Structure.DefaultRepresentationPresetParams);c=I.merge(l,d,c);var f=We.create(""+o.display.name,function(){return o.apply(u,c,i.plugin)});return this.plugin.runTask(f)}},e.prototype.addRepresentation=function(t,r,n){return ce(this,void 0,void 0,function(){var i,a;return de(this,function(o){switch(o.label){case 0:return i=this.dataState.build(),a=this.buildRepresentation(i,t,r,n),a?[4,i.commit()]:[2];case 1:return o.sent(),[2,a]}})})},e.prototype.buildRepresentation=function(t,r,n,i){var a,o;if(r){var s=(o=(a=Ii.resolveAndCheck(this.dataState,r))===null||a===void 0?void 0:a.obj)===null||o===void 0?void 0:o.data;if(s){var u=yS(this.plugin,s,n);return i!=null&&i.tag?t.to(r).applyOrUpdateTagged(i.tag,b_,u,{state:i==null?void 0:i.initialState}).selector:t.to(r).apply(b_,u,{state:i==null?void 0:i.initialState}).selector}}},e}();function eh(e){return e}(function(e){e.CommonParams=function(t,r){return{modelProperties:I.Optional(I.Group(ft.getParamDefinition(rt.Model.CustomModelProperties,void 0,r))),structureProperties:I.Optional(I.Group(ft.getParamDefinition(rt.Model.CustomStructureProperties,void 0,r))),representationPreset:I.Optional(I.Text("auto"))}}})(eh||(eh={}));var cE=eh.CommonParams,ott=function(e,t){return E({model:I.Optional(I.Group(ft.getParamDefinition(rt.Model.ModelFromTrajectory,e,t))),showUnitcell:I.Optional(I.Boolean(!1)),structure:I.Optional(wp.getParams(void 0,"assembly").type),representationPresetParams:I.Optional(I.Group(Ka.CommonParams))},cE(e,t))},lre=eh({id:"preset-trajectory-default",display:{name:"Default (Assembly)",group:"Preset",description:"Shows the first assembly or, if that is unavailable, the first model."},isApplicable:function(e){return!0},params:ott,apply:function(e,t,r){return ce(this,void 0,void 0,function(){var n,i,a,o,s,u,l,c;return de(this,function(d){switch(d.label){case 0:return n=r.builders.structure,[4,n.createModel(e,t.model)];case 1:return i=d.sent(),[4,n.insertModelProperties(i,t.modelProperties)];case 2:return a=d.sent(),[4,n.createStructure(a||i,t.structure)];case 3:return o=d.sent(),[4,n.insertStructureProperties(o,t.structureProperties)];case 4:return s=d.sent(),t.showUnitcell===void 0||t.showUnitcell?[4,n.tryCreateUnitcell(a,void 0,{isHidden:!0})]:[3,6];case 5:return l=d.sent(),[3,7];case 6:l=void 0,d.label=7;case 7:return u=l,[4,r.builders.structure.representation.applyPreset(s,t.representationPreset||"auto",t.representationPresetParams)];case 8:return c=d.sent(),[2,{model:i,modelProperties:a,unitcell:u,structure:o,structureProperties:s,representation:c}]}})})}}),stt=function(e,t){return E({useDefaultIfSingleModel:I.Optional(I.Boolean(!1)),representationPresetParams:I.Optional(I.Group(Ka.CommonParams))},cE(e,t))},utt=eh({id:"preset-trajectory-all-models",display:{name:"All Models",group:"Preset",description:"Shows all models; colored by model-index."},isApplicable:function(e){return e.data.frameCount>1},params:stt,apply:function(e,t,r){var n,i;return ce(this,void 0,void 0,function(){var a,o,s,u,l,c,d,f,h,v;return de(this,function(p){switch(p.label){case 0:if(a=(i=(n=Ii.resolveAndCheck(r.state.data,e))===null||n===void 0?void 0:n.obj)===null||i===void 0?void 0:i.data,!a)return[2,{}];if(a.frameCount===1&&t.useDefaultIfSingleModel)return[2,lre.apply(e,t,r)];o=r.builders.structure,s=[],u=[],l=0,p.label=1;case 1:return l<a.frameCount?[4,o.createModel(e,{modelIndex:l})]:[3,8];case 2:return c=p.sent(),[4,o.insertModelProperties(c,t.modelProperties,{isCollapsed:!0})];case 3:return d=p.sent(),[4,o.createStructure(d||c,{name:"model",params:{}})];case 4:return f=p.sent(),[4,o.insertStructureProperties(f,t.structureProperties)];case 5:return h=p.sent(),s.push(c),u.push(f),v=f.obj?PJ(f.obj.data,{elementCountFactor:a.frameCount}):"medium",[4,o.representation.applyPreset(h,t.representationPreset||"auto",{theme:{globalName:"model-index"},quality:v})];case 6:p.sent(),p.label=7;case 7:return l++,[3,1];case 8:return[2,{models:s,structures:u}]}})})}}),cre=function(e,t){return E({model:I.Optional(I.Group(ft.getParamDefinition(rt.Model.ModelFromTrajectory,e,t)))},cE(e,t))};function dre(e,t,r,n){return ce(this,void 0,void 0,function(){var i,a,o,s,u,l,c;return de(this,function(d){switch(d.label){case 0:return i=n.builders.structure,[4,i.createModel(t,r.model)];case 1:return a=d.sent(),[4,i.insertModelProperties(a,r.modelProperties)];case 2:return o=d.sent(),[4,i.createStructure(o||a,{name:"symmetry",params:e})];case 3:return s=d.sent(),[4,i.insertStructureProperties(s,r.structureProperties)];case 4:return u=d.sent(),[4,i.tryCreateUnitcell(o,void 0,{isHidden:!1})];case 5:return l=d.sent(),[4,n.builders.structure.representation.applyPreset(u,r.representationPreset||"auto",{theme:{globalName:e.theme}})];case 6:return c=d.sent(),[2,{model:a,modelProperties:o,unitcell:l,structure:s,structureProperties:u,representation:c}]}})})}var ltt=eh({id:"preset-trajectory-unitcell",display:{name:"Unit Cell",group:"Preset",description:"Shows the fully populated unit cell."},isApplicable:function(e){return Wt.hasCrystalSymmetry(e.data.representative)},params:cre,apply:function(e,t,r){return ce(this,void 0,void 0,function(){return de(this,function(n){switch(n.label){case 0:return[4,dre({ijkMin:_.create(0,0,0),ijkMax:_.create(0,0,0)},e,t,r)];case 1:return[2,n.sent()]}})})}}),ctt=eh({id:"preset-trajectory-supercell",display:{name:"Super Cell",group:"Preset",description:"Shows the super cell, i.e. the central unit cell and all adjacent unit cells."},isApplicable:function(e){return Wt.hasCrystalSymmetry(e.data.representative)},params:cre,apply:function(e,t,r){return ce(this,void 0,void 0,function(){return de(this,function(n){switch(n.label){case 0:return[4,dre({ijkMin:_.create(-1,-1,-1),ijkMax:_.create(1,1,1),theme:"operator-hkl"},e,t,r)];case 1:return[2,n.sent()]}})})}}),dtt=function(e,t){return E({model:I.Optional(I.Group(ft.getParamDefinition(rt.Model.ModelFromTrajectory,e,t)))},cE(e,t))},ftt=eh({id:"preset-trajectory-crystal-contacts",display:{name:"Crystal Contacts",group:"Preset",description:"Showsasymetric unit and chains from neighbours within 5 Å, i.e., symmetry mates."},isApplicable:function(e){return Wt.hasCrystalSymmetry(e.data.representative)},params:dtt,apply:function(e,t,r){return ce(this,void 0,void 0,function(){var n,i,a,o,s,u,l;return de(this,function(c){switch(c.label){case 0:return n=r.builders.structure,[4,n.createModel(e,t.model)];case 1:return i=c.sent(),[4,n.insertModelProperties(i,t.modelProperties)];case 2:return a=c.sent(),[4,n.createStructure(a||i,{name:"symmetry-mates",params:{radius:5}})];case 3:return o=c.sent(),[4,n.insertStructureProperties(o,t.structureProperties)];case 4:return s=c.sent(),[4,n.tryCreateUnitcell(a,void 0,{isHidden:!0})];case 5:return u=c.sent(),[4,r.builders.structure.representation.applyPreset(s,t.representationPreset||"auto",{theme:{globalName:"operator-name",carbonColor:"operator-name",focus:{name:"element-symbol",params:{carbonColor:{name:"operator-name",params:LO.defaultValues}}}}})];case 6:return l=c.sent(),[2,{model:i,modelProperties:a,unitcell:u,structure:o,structureProperties:s,representation:l}]}})})}}),kT={default:lre,"all-models":utt,unitcell:ltt,supercell:ctt,crystalContacts:ftt},htt=function(){function e(t){var r=this;this.plugin=t,this._providers=[],this.providerMap=new Map,this.defaultProvider=kT.default,Iu(kT,function(n){return r.registerPreset(n)})}return e.prototype.resolveProvider=function(t){var r;return typeof t=="string"?(r=kT[t])!==null&&r!==void 0?r:Lk(this._providers,function(n){return n.id===t}):t},e.prototype.hasPreset=function(t){for(var r=0,n=this._providers;r<n.length;r++){var i=n[r];if(!i.isApplicable||i.isApplicable(t,this.plugin))return!0}return!1},Object.defineProperty(e.prototype,"providers",{get:function(){return this._providers},enumerable:!1,configurable:!0}),e.prototype.getPresets=function(t){if(!t)return this.providers;for(var r=[],n=0,i=this._providers;n<i.length;n++){var a=i[n];a.isApplicable&&!a.isApplicable(t,this.plugin)||r.push(a)}return r},e.prototype.getPresetSelect=function(t){for(var r=[],n=0,i=this._providers;n<i.length;n++){var a=i[n];t&&a.isApplicable&&!a.isApplicable(t,this.plugin)||r.push([a.id,a.display.name])}return I.Select("auto",r)},e.prototype.getPresetsWithOptions=function(t){for(var r=[],n=Object.create(null),i=0,a=this._providers;i<a.length;i++){var o=a[i];o.isApplicable&&!o.isApplicable(t,this.plugin)||(r.push([o.id,o.display.name]),n[o.id]=o.params?I.Group(o.params(t,this.plugin)):I.EmptyGroup())}return r.length===0?I.MappedStatic("",{"":I.EmptyGroup()}):I.MappedStatic(r[0][0],n,{options:r})},e.prototype.registerPreset=function(t){if(this.providerMap.has(t.id))throw new Error("Hierarchy provider with id '"+t.id+"' already registered.");this._providers.push(t),this.providerMap.set(t.id,t)},e.prototype.unregisterPreset=function(t){this.providerMap.delete(t.id),j1(this._providers,t)},e.prototype.applyPreset=function(t,r,n){var i=this,a=this.resolveProvider(r);if(a){var o=this.plugin.state.data,s=Ii.resolveAndCheck(o,t);if(!s){$g||console.warn("Applying hierarchy preset provider to bad cell.");return}var u=n||(a.params?I.getDefaultValues(a.params(s.obj,this.plugin)):{}),l=We.create(""+a.display.name,function(){return a.apply(s,u,i.plugin)});return this.plugin.runTask(l)}},e}(),ptt=function(){function e(t){this.plugin=t,this.hierarchy=new htt(this.plugin),this.representation=new att(this.plugin)}return Object.defineProperty(e.prototype,"dataState",{get:function(){return this.plugin.state.data},enumerable:!1,configurable:!0}),e.prototype.parseTrajectoryData=function(t,r){return ce(this,void 0,void 0,function(){var n,i;return de(this,function(a){switch(a.label){case 0:if(n=typeof r=="string"?this.plugin.dataFormats.get(r):r,!n)throw new Error("'"+r+"' is not a supported data format.");return[4,n.parse(this.plugin,t)];case 1:return i=a.sent().trajectory,[2,i]}})})},e.prototype.parseTrajectoryBlob=function(t,r){var n=this.dataState,i=n.build().to(t).apply(rt.Data.ParseBlob,r,{state:{isGhost:!0}}).apply(rt.Model.TrajectoryFromBlob,void 0);return i.commit({revertOnError:!0})},e.prototype.parseTrajectory=function(t,r){var n=Ii.resolveAndCheck(this.dataState,t);if(!n)throw new Error("Invalid data cell.");return ge.Data.Blob.is(n.obj)?this.parseTrajectoryBlob(t,r):this.parseTrajectoryData(t,r)},e.prototype.createModel=function(t,r,n){var i=this.dataState,a=i.build().to(t).apply(rt.Model.ModelFromTrajectory,r||{modelIndex:0},{state:n});return a.commit({revertOnError:!0})},e.prototype.insertModelProperties=function(t,r,n){var i=this.dataState,a=i.build().to(t).apply(rt.Model.CustomModelProperties,r,{state:n});return a.commit({revertOnError:!0})},e.prototype.tryCreateUnitcell=function(t,r,n){var i,a,o,s=this.dataState,u=(a=(i=Ii.resolveAndCheck(s,t))===null||i===void 0?void 0:i.obj)===null||a===void 0?void 0:a.data;if(u){var l=(o=si.Provider.get(u))===null||o===void 0?void 0:o.spacegroup.cell;if(!xo.isZero(l)){var c=s.build().to(t).apply(rt.Representation.ModelUnitcell3D,r,{state:n});return c.commit({revertOnError:!0})}}},e.prototype.createStructure=function(t,r,n){var i,a=this.dataState;if(!r){var o=Ii.resolveAndCheck(a,t);if(o){var s=si.Provider.get((i=o.obj)===null||i===void 0?void 0:i.data);(!s||(s==null?void 0:s.assemblies.length)===0)&&(r={name:"model",params:{}})}}var u=a.build().to(t).apply(rt.Model.StructureFromModel,{type:r||{name:"assembly",params:{}}},{state:n});return u.commit({revertOnError:!0})},e.prototype.insertStructureProperties=function(t,r){var n=this.dataState,i=n.build().to(t).apply(rt.Model.CustomStructureProperties,r);return i.commit({revertOnError:!0})},e.prototype.isComponentTransform=function(t){return t.transform.transformer===rt.Model.StructureComponent},e.prototype.tryCreateComponent=function(t,r,n,i){var a,o;return ce(this,void 0,void 0,function(){var s,u,l,c,d;return de(this,function(f){switch(f.label){case 0:return s=this.dataState,u=s.build().to(t),l="structure-component-"+n,c=u.applyOrUpdateTagged(l,rt.Model.StructureComponent,r,{tags:i?Ft(Ft([],i),[l]):[l]}),[4,c.commit()];case 1:return f.sent(),d=c.selector,!d.isOk||((o=(a=d.cell)===null||a===void 0?void 0:a.obj)===null||o===void 0?void 0:o.data.elementCount)===0?[4,s.build().delete(d.ref).commit()]:[3,3];case 2:return f.sent(),[2];case 3:return[2,d]}})})},e.prototype.tryCreateComponentFromExpression=function(t,r,n,i){return this.tryCreateComponent(t,{type:{name:"expression",params:r},nullIfEmpty:!0,label:((i==null?void 0:i.label)||"").trim()},n,i==null?void 0:i.tags)},e.prototype.tryCreateComponentStatic=function(t,r,n){return this.tryCreateComponent(t,{type:{name:"static",params:r},nullIfEmpty:!0,label:((n==null?void 0:n.label)||"").trim()},"static-"+r,n==null?void 0:n.tags)},e.prototype.tryCreateComponentFromSelection=function(t,r,n,i){var a=this;return this.plugin.runTask(We.create("Query Component",function(o){return ce(a,void 0,void 0,function(){var s,u,l,c,d,f,h,v,p,m,g,y;return de(this,function(b){switch(b.label){case 0:return s=i||{},u=s.label,l=s.tags,u=(u||"").trim(),c=(y=(g=Ii.resolveAndCheck(this.dataState,t))===null||g===void 0?void 0:g.obj)===null||y===void 0?void 0:y.data,c?r.referencesCurrent?(p={},m={name:"bundle"},v=(h=Jr).fromSelection,[4,r.getSelection(this.plugin,o,c)]):[3,2]:[2];case 1:return f=(p.type=(m.params=v.apply(h,[b.sent()]),m),p.nullIfEmpty=!0,p.label=u||r.label,p),[3,3];case 2:f={type:{name:"expression",params:r.expression},nullIfEmpty:!0,label:u||r.label},b.label=3;case 3:return d=f,r.ensureCustomProperties?[4,r.ensureCustomProperties({runtime:o,assetManager:this.plugin.managers.asset},c)]:[3,5];case 4:b.sent(),b.label=5;case 5:return[2,this.tryCreateComponent(t,d,n,l)]}})})}))},e}(),mD;(function(e){function t(r){var n=r.name;return{descriptor:r,get:function(i){return i._propertyData[n]},set:function(i,a){i.customProperties.add(r),i._propertyData[n]=a}}}e.create=t})(mD||(mD={}));var $_;(function(e){e.Descriptor={name:"recommended_iso_value"},e.Provider=mD.create(e.Descriptor)})($_||($_={}));var Gb="Volume";function qb(e,t){return ce(this,void 0,void 0,function(){var r,n=this;return de(this,function(i){return t?(r=t.entryId,!r||!r.toLowerCase().startsWith("emd")?[2]:[2,e.runTask(We.create("Try Set Recommended IsoValue",function(a){return ce(n,void 0,void 0,function(){var o;return de(this,function(s){switch(s.label){case 0:return s.trys.push([0,2,,3]),[4,Fte(e,a,r)];case 1:return o=s.sent(),$_.Provider.set(t,Ct.IsoValue.absolute(o)),[3,3];case 2:return s.sent(),[3,3];case 3:return[2]}})})}))]):[2]})})}function fre(e){var t=$_.Provider.get(e);if(t){if(t.kind==="relative")return t;var r=e.grid.stats;return v_.is(e.sourceData)&&(r={min:e.sourceData.data.volume_data_3d_info.min_source.value(0),max:e.sourceData.data.volume_data_3d_info.max_source.value(0),mean:e.sourceData.data.volume_data_3d_info.mean_source.value(0),sigma:e.sourceData.data.volume_data_3d_info.sigma_source.value(0)}),Ct.IsoValue.toRelative(t,r)}}function TL(e,t){return ce(this,void 0,void 0,function(){var r,n,i;return de(this,function(a){switch(a.label){case 0:return r={},n=t.volume.data&&fre(t.volume.data),n&&(r.isoValue=n),i=e.build().to(t.volume).apply(rt.Representation.VolumeRepresentation3D,Jm(e,t.volume.data,{type:"isosurface",typeParams:r})),[4,i.commit()];case 1:return[2,[a.sent()]]}})})}var vtt={label:"CCP4/MRC/MAP",description:"CCP4/MRC/MAP",category:Gb,binaryExtensions:["ccp4","mrc","map"],parse:function(e,t,r){return ce(void 0,void 0,void 0,function(){var n,i;return de(this,function(a){switch(a.label){case 0:return n=e.build().to(t).apply(rt.Data.ParseCcp4,{},{state:{isGhost:!0}}),i=n.apply(rt.Volume.VolumeFromCcp4,{entryId:r==null?void 0:r.entryId}),[4,n.commit({revertOnError:!0})];case 1:return a.sent(),[4,qb(e,i.selector.data)];case 2:return a.sent(),[2,{format:n.selector,volume:i.selector}]}})})},visuals:TL},mtt={label:"DSN6/BRIX",description:"DSN6/BRIX",category:Gb,binaryExtensions:["dsn6","brix"],parse:function(e,t,r){return ce(void 0,void 0,void 0,function(){var n,i;return de(this,function(a){switch(a.label){case 0:return n=e.build().to(t).apply(rt.Data.ParseDsn6,{},{state:{isGhost:!0}}),i=n.apply(rt.Volume.VolumeFromDsn6,{entryId:r==null?void 0:r.entryId}),[4,n.commit({revertOnError:!0})];case 1:return a.sent(),[4,qb(e,i.selector.data)];case 2:return a.sent(),[2,{format:n.selector,volume:i.selector}]}})})},visuals:TL},gtt={label:"DX",description:"DX",category:Gb,stringExtensions:["dx"],binaryExtensions:["dxbin"],parse:function(e,t,r){return ce(void 0,void 0,void 0,function(){var n,i;return de(this,function(a){switch(a.label){case 0:return n=e.build().to(t).apply(rt.Data.ParseDx,{},{state:{isGhost:!0}}),i=n.apply(rt.Volume.VolumeFromDx,{entryId:r==null?void 0:r.entryId}),[4,i.commit({revertOnError:!0})];case 1:return a.sent(),[4,qb(e,i.selector.data)];case 2:return a.sent(),[2,{volume:i.selector}]}})})},visuals:TL},ytt={label:"Cube",description:"Cube",category:Gb,stringExtensions:["cub","cube"],parse:function(e,t,r){return ce(void 0,void 0,void 0,function(){var n,i,a;return de(this,function(o){switch(o.label){case 0:return n=e.build().to(t).apply(rt.Data.ParseCube,{},{state:{isGhost:!0}}),i=n.apply(rt.Volume.VolumeFromCube,{entryId:r==null?void 0:r.entryId}),a=n.apply(rt.Model.TrajectoryFromCube,void 0,{state:{isGhost:!0}}).apply(rt.Model.ModelFromTrajectory).apply(rt.Model.StructureFromModel),[4,n.commit({revertOnError:!0})];case 1:return o.sent(),[4,qb(e,i.selector.data)];case 2:return o.sent(),[2,{format:n.selector,volume:i.selector,structure:a.selector}]}})})},visuals:function(e,t){return ce(void 0,void 0,void 0,function(){var r,n,i,a,o,s,u,l,c,d;return de(this,function(f){switch(f.label){case 0:return r=e.build(),n=[],i=(d=(c=t.volume.cell)===null||c===void 0?void 0:c.obj)===null||d===void 0?void 0:d.data,i&&Ct.isOrbitals(i)?(a=r.to(t.volume).apply(rt.Representation.VolumeRepresentation3D,Jm(e,i,{type:"isosurface",typeParams:{isoValue:Ct.IsoValue.relative(1),alpha:.4},color:"uniform",colorParams:{value:dr.blue}})),o=r.to(t.volume).apply(rt.Representation.VolumeRepresentation3D,Jm(e,i,{type:"isosurface",typeParams:{isoValue:Ct.IsoValue.relative(-1),alpha:.4},color:"uniform",colorParams:{value:dr.red}})),n.push(a.selector,o.selector)):(s=r.to(t.volume).apply(rt.Representation.VolumeRepresentation3D,Jm(e,i,{type:"isosurface",typeParams:{isoValue:Ct.IsoValue.relative(2),alpha:.4},color:"uniform",colorParams:{value:dr.grey}})),n.push(s.selector)),[4,e.builders.structure.representation.applyPreset(t.structure,"auto")];case 1:return u=f.sent(),[4,r.commit()];case 2:return f.sent(),l=[],Iu(u==null?void 0:u.representations,function(h){h&&l.push(h)}),[2,Ft(Ft([],n),l)]}})})}},btt={label:"DensityServer CIF",description:"DensityServer CIF",category:Gb,stringExtensions:["cif"],binaryExtensions:["bcif"],isApplicable:function(e,t){return iL(e,t)==="dscif"},parse:function(e,t,r){return ce(void 0,void 0,void 0,function(){var n,i,a,o,s,u,l,c,d,f,h,v;return de(this,function(p){switch(p.label){case 0:return[4,e.build().to(t).apply(rt.Data.ParseCif).commit()];case 1:if(n=p.sent(),i=e.build().to(n),a=n.obj.data.blocks.slice(1),a.length!==1&&a.length!==2)throw new Error("unknown number of blocks");for(o=[],s=0,u=0,l=a;u<l.length;u++)c=l[u],d=Array.isArray(r==null?void 0:r.entryId)?r==null?void 0:r.entryId[s]:r==null?void 0:r.entryId,o.push(i.apply(rt.Volume.VolumeFromDensityServerCif,{blockHeader:c.header,entryId:d}).selector),s++;return[4,i.commit()];case 2:p.sent(),f=0,h=o,p.label=3;case 3:return f<h.length?(v=h[f],[4,qb(e,v.data)]):[3,6];case 4:p.sent(),p.label=5;case 5:return f++,[3,3];case 6:return[2,{volumes:o}]}})})},visuals:function(e,t){return ce(void 0,void 0,void 0,function(){var r,n,i,a,o,s;return de(this,function(u){switch(u.label){case 0:return r=t.volumes,n=e.build(),i=[],r.length>0&&(a=r[0].data&&fre(r[0].data)||Ct.IsoValue.relative(1.5),i[0]=n.to(r[0]).apply(rt.Representation.VolumeRepresentation3D,xc.getDefaultParamsStatic(e,"isosurface",{isoValue:a,alpha:1},"uniform",{value:dr.teal})).selector),r.length>1&&(o=xc.getDefaultParamsStatic(e,"isosurface",{isoValue:Ct.IsoValue.relative(3),alpha:.3},"uniform",{value:dr.green}),s=xc.getDefaultParamsStatic(e,"isosurface",{isoValue:Ct.IsoValue.relative(-3),alpha:.3},"uniform",{value:dr.red}),i[i.length]=n.to(r[1]).apply(rt.Representation.VolumeRepresentation3D,o).selector,i[i.length]=n.to(r[1]).apply(rt.Representation.VolumeRepresentation3D,s).selector),[4,n.commit()];case 1:return u.sent(),[2,i]}})})}},xtt=[["ccp4",vtt],["dsn6",mtt],["cube",ytt],["dx",gtt],["dscif",btt]],Stt="Shape",Ctt={label:"PLY",description:"PLY",category:Stt,stringExtensions:["ply"],parse:function(e,t){return ce(void 0,void 0,void 0,function(){var r,n;return de(this,function(i){switch(i.label){case 0:return r=e.state.data.build().to(t).apply(rt.Data.ParsePly,{},{state:{isGhost:!0}}),n=r.apply(rt.Model.ShapeFromPly),[4,r.commit()];case 1:return i.sent(),[2,{format:r.selector,shape:n.selector}]}})})},visuals:function(e,t){var r=e.state.data.build().to(t.shape).apply(rt.Representation.ShapeRepresentation3D);return r.commit()}},_tt=[["ply",Ctt]],IL="Structure",wtt={label:"PSF",description:"PSF",category:IL,stringExtensions:["psf"],parse:function(e,t){return ce(void 0,void 0,void 0,function(){var r,n;return de(this,function(i){switch(i.label){case 0:return r=e.state.data.build().to(t).apply(rt.Data.ParsePsf,{},{state:{isGhost:!0}}),n=r.apply(rt.Model.TopologyFromPsf),[4,r.commit()];case 1:return i.sent(),[2,{format:r.selector,topology:n.selector}]}})})}},Ett={label:"DCD",description:"DCD",category:IL,binaryExtensions:["dcd"],parse:function(e,t){var r=e.state.data.build().to(t).apply(rt.Model.CoordinatesFromDcd);return r.commit()}},Att={label:"XTC",description:"XTC",category:IL,binaryExtensions:["xtc"],parse:function(e,t){var r=e.state.data.build().to(t).apply(rt.Model.CoordinatesFromXtc);return r.commit()}},Ptt=[["psf",wtt],["dcd",Ett],["xtc",Att]],Ttt=function(){function e(){this._list=[],this._map=new Map,this._extensions=void 0,this._binaryExtensions=void 0,this._options=void 0;for(var t=0,r=xtt;t<r.length;t++){var n=r[t],i=n[0],a=n[1];this.add(i,a)}for(var o=0,s=Ptt;o<s.length;o++){var u=s[o],i=u[0],a=u[1];this.add(i,a)}for(var l=0,c=_tt;l<c.length;l++){var d=c[l],i=d[0],a=d[1];this.add(i,a)}for(var f=0,h=bte;f<h.length;f++){var v=h[f],i=v[0],a=v[1];this.add(i,a)}}return Object.defineProperty(e.prototype,"types",{get:function(){return this._list.map(function(t){return[t.name,t.provider.label]})},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"extensions",{get:function(){if(this._extensions)return this._extensions;var t=new Set;return this._list.forEach(function(r){var n,i,a=r.provider;(n=a.stringExtensions)===null||n===void 0||n.forEach(function(o){return t.add(o)}),(i=a.binaryExtensions)===null||i===void 0||i.forEach(function(o){return t.add(o)})}),this._extensions=t,t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"binaryExtensions",{get:function(){if(this._binaryExtensions)return this._binaryExtensions;var t=new Set;return this._list.forEach(function(r){var n,i=r.provider;return(n=i.binaryExtensions)===null||n===void 0?void 0:n.forEach(function(a){return t.add(a)})}),this._binaryExtensions=t,t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"options",{get:function(){if(this._options)return this._options;var t=[];return this._list.forEach(function(r){var n=r.name,i=r.provider;return t.push([n,i.label,i.category||""])}),this._options=t,t},enumerable:!1,configurable:!0}),e.prototype._clear=function(){this._extensions=void 0,this._binaryExtensions=void 0,this._options=void 0},e.prototype.add=function(t,r){this._clear(),this._list.push({name:t,provider:r}),this._map.set(t,r)},e.prototype.remove=function(t){this._clear(),this._list.splice(this._list.findIndex(function(r){return r.name===t}),1),this._map.delete(t)},e.prototype.auto=function(t,r){for(var n=0,i=this.list.length;n<i;++n){var a=this._list[n].provider,o=!1;if((a.binaryExtensions&&a.binaryExtensions.indexOf(t.ext)>=0||a.stringExtensions&&a.stringExtensions.indexOf(t.ext)>=0)&&(o=!0),o&&(!a.isApplicable||a.isApplicable(t,r.data)))return a}},e.prototype.get=function(t){if(this._map.has(t))return this._map.get(t);throw new Error("unknown data format name '"+t+"'")},Object.defineProperty(e.prototype,"list",{get:function(){return this._list},enumerable:!1,configurable:!0}),e}(),Itt=function(e){Le(t,e);function t(r){var n=e.call(this,{params:{current:""},animationState:"stopped"})||this;return n.context=r,n.map=new Map,n._animations=[],n.currentTime=0,n._params=void 0,n.events={updated:n.ev(),applied:n.ev()},n.isStopped=!0,n.isApplying=!1,n}return Object.defineProperty(t.prototype,"isEmpty",{get:function(){return this._animations.length===0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"current",{get:function(){return this._current},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"animations",{get:function(){return this._animations},enumerable:!1,configurable:!0}),t.prototype.triggerUpdate=function(){this.events.updated.next()},t.prototype.triggerApply=function(){this.events.applied.next()},t.prototype.getParams=function(){return this._params||(this._params={current:I.Select(this._animations[0]&&this._animations[0].name,this._animations.map(function(r){return[r.name,r.display.name]}),{label:"Animation"})}),this._params},t.prototype.updateParams=function(r){if(!this.isEmpty){this.updateState({params:E(E({},this.state.params),r)});var n=this.map.get(this.state.params.current),i=n.params(this.context);this._current={anim:n,params:i,paramValues:I.getDefaultValues(i),state:{},startedTime:-1,lastTime:0},this.triggerUpdate()}},t.prototype.updateCurrentParams=function(r){this.isEmpty||(this._current.paramValues=E(E({},this._current.paramValues),r),this.triggerUpdate())},t.prototype.register=function(r){if(this.map.has(r.name)){this.context.log.error("Animation '"+r.name+"' is already registered.");return}this._params=void 0,this.map.set(r.name,r),this._animations.push(r),this._animations.length===1?this.updateParams({current:r.name}):this.triggerUpdate()},t.prototype.play=function(r,n){return ce(this,void 0,void 0,function(){return de(this,function(i){switch(i.label){case 0:return[4,this.stop()];case 1:return i.sent(),this.map.has(r.name)||this.register(r),this.updateParams({current:r.name}),this.updateCurrentParams(n),[4,this.start()];case 2:return i.sent(),[2]}})})},t.prototype.tick=function(r,n){return ce(this,void 0,void 0,function(){return de(this,function(i){switch(i.label){case 0:return this.currentTime=r,this.isStopped?[2]:n?[4,this.applyFrame()]:[3,2];case 1:return i.sent(),[3,3];case 2:this.applyAsync(),i.label=3;case 3:return[2]}})})},t.prototype.start=function(){return ce(this,void 0,void 0,function(){var r,n,i;return de(this,function(a){switch(a.label){case 0:return this.updateState({animationState:"playing"}),this.context.behaviors.state.isAnimating.value||this.context.behaviors.state.isAnimating.next(!0),this.triggerUpdate(),r=this._current.anim,n=this._current.anim.initialState(this._current.paramValues,this.context),r.setup?[4,r.setup(this._current.paramValues,n,this.context)]:[3,2];case 1:i=a.sent(),i&&(n=i),a.label=2;case 2:return this._current.lastTime=0,this._current.startedTime=-1,this._current.state=n,this.isStopped=!1,[2]}})})},t.prototype.stop=function(){return ce(this,void 0,void 0,function(){var r;return de(this,function(n){switch(n.label){case 0:return this.isStopped=!0,this.state.animationState==="stopped"?[3,3]:(r=this._current.anim,r.teardown?[4,r.teardown(this._current.paramValues,this._current.state,this.context)]:[3,2]);case 1:n.sent(),n.label=2;case 2:this.updateState({animationState:"stopped"}),this.triggerUpdate(),n.label=3;case 3:return this.context.behaviors.state.isAnimating.value&&this.context.behaviors.state.isAnimating.next(!1),[2]}})})},Object.defineProperty(t.prototype,"isAnimating",{get:function(){return this.state.animationState==="playing"},enumerable:!1,configurable:!0}),t.prototype.applyAsync=function(){return ce(this,void 0,void 0,function(){return de(this,function(r){switch(r.label){case 0:if(this.isApplying)return[2];this.isApplying=!0,r.label=1;case 1:return r.trys.push([1,,3,4]),[4,this.applyFrame()];case 2:return r.sent(),[3,4];case 3:return this.isApplying=!1,[7];case 4:return[2]}})})},t.prototype.applyFrame=function(){return ce(this,void 0,void 0,function(){var r,n;return de(this,function(i){switch(i.label){case 0:return r=this.currentTime,this._current.startedTime<0&&(this._current.startedTime=r),[4,this._current.anim.apply(this._current.state,{lastApplied:this._current.lastTime,current:r-this._current.startedTime},{params:this._current.paramValues,plugin:this.context})];case 1:return n=i.sent(),n.kind==="finished"?this.stop():n.kind==="next"&&(this._current.state=n.state,this._current.lastTime=r-this._current.startedTime),this.triggerApply(),[2]}})})},t.prototype.getSnapshot=function(){return this.current?{state:this.state,current:{paramValues:this._current.paramValues,state:this._current.anim.stateSerialization?this._current.anim.stateSerialization.toJSON(this._current.state):this._current.state}}:{state:this.state}},t.prototype.setSnapshot=function(r){this.isEmpty||(this.updateState({animationState:r.state.animationState}),this.updateParams(r.state.params),r.current&&(this.current.paramValues=r.current.paramValues,this.current.state=this._current.anim.stateSerialization?this._current.anim.stateSerialization.fromJSON(r.current.state):r.current.state,this.triggerUpdate(),this.state.animationState==="playing"&&this.resume()))},t.prototype.resume=function(){return ce(this,void 0,void 0,function(){var r;return de(this,function(n){switch(n.label){case 0:return this._current.lastTime=0,this._current.startedTime=-1,r=this._current.anim,this.context.behaviors.state.isAnimating.value||this.context.behaviors.state.isAnimating.next(!0),r.setup?[4,r.setup(this._current.paramValues,this._current.state,this.context)]:[3,2];case 1:n.sent(),n.label=2;case 2:return this.isStopped=!1,[2]}})})},t}(vd),Mtt={minRadius:5,extraRadius:4,durationMs:250},Dtt=function(){function e(t){this.plugin=t,this.boundaryHelper=new rs("98")}return e.prototype.transformedLoci=function(t){var r,n;if(De.is(t)){var i=(n=(r=this.plugin.helpers.substructureParent.get(t.structure))===null||r===void 0?void 0:r.obj)===null||n===void 0?void 0:n.data;i&&(t=De.remap(t,i))}return t},e.prototype.focusRenderObjects=function(t,r){if(t){for(var n=[],i=0,a=t;i<a.length;i++){var o=a[i],s=o.values.boundingSphere.ref.value;s.radius!==0&&n.push(s)}this.focusSpheres(n,function(u){return u},r)}},e.prototype.focusLoci=function(t,r){var n;if(Array.isArray(t)&&t.length>1){for(var i=[],a=0,o=t;a<o.length;a++){var s=o[a],u=ar.getBoundingSphere(this.transformedLoci(s));u&&i.push(u)}if(i.length===0)return;this.boundaryHelper.reset();for(var l=0,c=i;l<c.length;l++){var u=c[l];this.boundaryHelper.includeSphere(u)}this.boundaryHelper.finishedIncludeStep();for(var d=0,f=i;d<f.length;d++){var u=f[d];this.boundaryHelper.radiusSphere(u)}n=this.boundaryHelper.getSphere()}else if(Array.isArray(t)){if(t.length===0)return;n=ar.getBoundingSphere(this.transformedLoci(t[0]))}else n=ar.getBoundingSphere(this.transformedLoci(t));n&&this.focusSphere(n,r)},e.prototype.focusSpheres=function(t,r,n){for(var i=[],a=0,o=t;a<o.length;a++){var s=o[a],u=r(s);u&&i.push(u)}if(i.length!==0){if(i.length===1)return this.focusSphere(i[0],n);this.boundaryHelper.reset();for(var l=0,c=i;l<c.length;l++){var u=c[l];this.boundaryHelper.includeSphere(u)}this.boundaryHelper.finishedIncludeStep();for(var d=0,f=i;d<f.length;d++){var u=f[d];this.boundaryHelper.radiusSphere(u)}this.focusSphere(this.boundaryHelper.getSphere(),n)}},e.prototype.focusSphere=function(t,r){var n,i,a,o,s=E(E({},Mtt),r),u=s.extraRadius,l=s.minRadius,c=s.durationMs,d=Math.max(t.radius+u,l);if(r!=null&&r.principalAxes){var f=r==null?void 0:r.principalAxes.boxAxes,h=f.origin,v=f.dirA,p=f.dirC,m=(n=this.plugin.canvas3d)===null||n===void 0?void 0:n.camera.getFocus(h,d,v,p);(i=this.plugin.canvas3d)===null||i===void 0||i.requestCameraReset({durationMs:c,snapshot:m})}else{var m=(a=this.plugin.canvas3d)===null||a===void 0?void 0:a.camera.getFocus(t.center,d);(o=this.plugin.canvas3d)===null||o===void 0||o.requestCameraReset({durationMs:c,snapshot:m})}},e.prototype.setSnapshot=function(t,r){var n;(n=this.plugin.canvas3d)===null||n===void 0||n.requestCameraReset({snapshot:t,durationMs:r})},e.prototype.reset=function(t,r){var n;(n=this.plugin.canvas3d)===null||n===void 0||n.requestCameraReset({snapshot:t,durationMs:r})},e}(),Rtt=function(){function e(t){var r=this;this.ctx=t,this.providers=[],this.locis=[],this.isDirty=!1,this.labels=[],this.groupedLabels=new Map,t.managers.interactivity.lociHighlights.addProvider(function(n,i){r.mark(n,i),r.showLabels()})}return e.prototype.clearProviders=function(){this.providers=[],this.isDirty=!0,this.showLabels()},e.prototype.addProvider=function(t){this.providers.push(t),this.providers.sort(function(r,n){return(n.priority||0)-(r.priority||0)}),this.isDirty=!0,this.showLabels()},e.prototype.removeProvider=function(t){this.providers=this.providers.filter(function(r){return r!==t}),this.isDirty=!0,this.showLabels()},e.prototype.mark=function(t,r){var n=this.locis.findIndex(function(i){return or.Loci.areEqual(t,i)});n===-1&&r===tr.Highlight?(this.locis.push(t),this.isDirty=!0):n!==-1&&r===tr.RemoveHighlight&&(z1(this.locis,n),this.isDirty=!0)},e.prototype.showLabels=function(){this.ctx.behaviors.labels.highlight.next({labels:this.getLabels()})},e.prototype.getLabels=function(){var t=this;if(this.isDirty){this.groupedLabels.clear(),this.labels.length=0;for(var r=0,n=this.providers;r<n.length;r++)for(var i=n[r],a=0,o=this.locis;a<o.length;a++){var s=o[a];if(!ar.isEmpty(s.loci)){var u=i.label(s.loci,s.repr);if(u){var l=i.group?i.group(u):u.toString(),c=this.groupedLabels.get(l);c?c.push(u):this.groupedLabels.set(l,[u])}}}this.labels.length=0,this.groupedLabels.forEach(function(d,f){var h=d.length,v=h>1&&d[0]!==d[1]?f:d[0];t.labels.push(h===1?v:v+" <small>|| × "+h+"</small>")}),this.isDirty=!1}return this.labels},e}(),ktt=8,Ott=function(e){Le(t,e);function t(r){var n=e.call(this,{history:[]})||this;n.plugin=r,n.events={historyUpdated:n.ev()},n.behaviors={current:n.ev.behavior(void 0)},r.state.data.events.object.removed.subscribe(function(a){var o,s,u=a.obj;if(ge.Molecule.Structure.is(u)){((s=n.current)===null||s===void 0?void 0:s.loci.structure)===u.data&&n.clear();for(var l=[],c=0,d=n.history;c<d.length;c++){var f=d[c];f.loci.structure===u.data&&l.push(f)}l.length!==n.history.length&&(n.history.length=0,(o=n.history).push.apply(o,l),n.events.historyUpdated.next())}});var i=Fe();return r.state.data.events.object.updated.subscribe(function(a){var o,s=a.oldData,u=a.obj,l=a.action;if(ge.Molecule.Structure.is(u)&&s!==u.data&&l==="in-place"){var c=n.state.current,d=u.data;if(c&&c.loci.structure===s){var f=De.remap(c.loci,d);n.state.current=E(E({},c),{loci:f}),n.behaviors.current.next(n.state.current),ar.getBoundingSphere(f,i);var h=(o=n.plugin.canvas3d)===null||o===void 0?void 0:o.camera,v=h.getTargetDistance(i.radius+4);(_.distance(h.target,i.center)>i.radius||v>h.viewport.height/h.zoom)&&n.plugin.managers.camera.focusSphere(i,{durationMs:0})}}}),n}return Object.defineProperty(t.prototype,"current",{get:function(){return this.state.current},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"history",{get:function(){return this.state.history},enumerable:!1,configurable:!0}),t.prototype.tryAddHistory=function(r){if(!De.isEmpty(r.loci)){for(var n=0,i=void 0,a=0,o=this.state.history;a<o.length;a++){var s=o[a];if(De.areEqual(s.loci,r.loci)){i=s;break}n++}if(i){z1(this.state.history,n),this.state.history.unshift(r),this.events.historyUpdated.next();return}this.state.history.unshift(r),this.state.history.length>ktt&&this.state.history.pop(),this.events.historyUpdated.next()}},t.prototype.set=function(r){this.tryAddHistory(r),(!this.state.current||!De.areEqual(this.state.current.loci,r.loci))&&(this.state.current=r,this.behaviors.current.next(r))},t.prototype.setFromLoci=function(r){var n=ar.normalize(r);if(!De.is(n)||De.isEmpty(n)){this.clear();return}this.set({loci:n,label:Jf(n,{reverse:!0,hidePrefix:!0,htmlStyling:!1})})},t.prototype.addFromLoci=function(r){var n=this.state.current&&De.is(r)&&r.structure===this.state.current.loci.structure?De.union(r,this.state.current.loci):r;this.setFromLoci(n)},t.prototype.clear=function(){this.state.current&&(this.state.current=void 0,this.behaviors.current.next(void 0))},t.prototype.getSnapshot=function(){if(!this.current)return{};var r=this.plugin.helpers.substructureParent.get(this.current.loci.structure),n=r==null?void 0:r.transform.ref;return n?{current:{label:this.current.label,ref:n,bundle:Jr.fromLoci(this.current.loci),category:this.current.category}}:{}},t.prototype.setSnapshot=function(r){var n,i;if(!r.current){this.clear();return}var a=r.current,o=a.label,s=a.ref,u=a.bundle,l=a.category,c=(i=(n=this.plugin.state.data.select(ir.Generators.byRef(s))[0])===null||n===void 0?void 0:n.obj)===null||i===void 0?void 0:i.data;if(c){var d=Jr.toLoci(u,c);this.set({label:o,loci:d,category:l})}},t}(vd),W0=new rs("98"),Ltt=24,Ntt=function(e){Le(t,e);function t(r){var n=e.call(this,{entries:new Map,additionsHistory:[],stats:Ftt()})||this;return n.plugin=r,n.events={changed:n.ev(),additionsHistoryUpdated:n.ev(),loci:{add:n.ev(),remove:n.ev(),clear:n.ev()}},r.helpers.substructureParent.events.removed.subscribe(function(i){return n.onRemove(i.ref,i.obj)}),r.helpers.substructureParent.events.updated.subscribe(function(i){return n.onUpdate(i.ref,i.oldObj,i.obj)}),n}return Object.defineProperty(t.prototype,"entries",{get:function(){return this.state.entries},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"additionsHistory",{get:function(){return this.state.additionsHistory},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"stats",{get:function(){return this.state.stats?this.state.stats:(this.state.stats=this.calcStats(),this.state.stats)},enumerable:!1,configurable:!0}),t.prototype.getEntry=function(r){var n=this.plugin.helpers.substructureParent.get(r,!0);if(n){var i=n.transform.ref;if(!this.entries.has(i)){var a=new gD(De(r,[]));return this.entries.set(i,a),a}return this.entries.get(i)}},t.prototype.calcStats=function(){var r=0,n=0,i=gf.create();this.entries.forEach(function(o){var s=o.selection.elements;if(s.length){r+=1;for(var u=0,l=s.length;u<l;++u)n+=Oe.size(s[u].indices);gf.add(i,i,gf.ofLoci(o.selection))}});var a=y_(i,{countsOnly:!0});return{structureCount:r,elementCount:n,label:a}},t.prototype.add=function(r){if(!De.is(r))return!1;var n=this.getEntry(r.structure);if(!n)return!1;var i=n.selection;return n.selection=De.union(n.selection,r),this.tryAddHistory(r),this.referenceLoci=r,this.events.loci.add.next(r),!De.areEqual(i,n.selection)},t.prototype.remove=function(r){if(!De.is(r))return!1;var n=this.getEntry(r.structure);if(!n)return!1;var i=n.selection;return n.selection=De.subtract(n.selection,r),this.referenceLoci=r,this.events.loci.remove.next(r),!De.areEqual(i,n.selection)},t.prototype.intersect=function(r){if(!De.is(r))return!1;var n=this.getEntry(r.structure);if(!n)return!1;var i=n.selection;return n.selection=De.intersect(n.selection,r),this.referenceLoci=r,!De.areEqual(i,n.selection)},t.prototype.set=function(r){if(!De.is(r))return!1;var n=this.getEntry(r.structure);if(!n)return!1;var i=n.selection;return n.selection=r,this.tryAddHistory(r),this.referenceLoci=void 0,!De.areEqual(i,n.selection)},t.prototype.modifyHistory=function(r,n,i,a){a===void 0&&(a=!1);var o=this.additionsHistory,s=o.indexOf(r);if(!(s<0)){var u=void 0;switch(n){case"remove":z1(o,s);break;case"up":u=s-1;break;case"down":u=s+1;break}if(u!==void 0)for(var l=i?Math.min(o.length,i):o.length;;)if(u=u%l,u<0&&(u+=l),!a||o[s].loci.structure===o[u].loci.structure){var c=o[s];o[s]=o[u],o[u]=c;break}else u+=n==="up"?-1:1;this.events.additionsHistoryUpdated.next()}},t.prototype.tryAddHistory=function(r){if(!ar.isEmpty(r)){for(var n=0,i=void 0,a=0,o=this.additionsHistory;a<o.length;a++){var s=o[a];if(ar.areEqual(s.loci,r)){i=s;break}n++}if(i){z1(this.additionsHistory,n),this.additionsHistory.unshift(i),this.events.additionsHistoryUpdated.next();return}var u=gf.ofLoci(r),l=y_(u,{reverse:!0});this.additionsHistory.unshift({id:dn.create22(),loci:r,label:l}),this.additionsHistory.length>Ltt&&this.additionsHistory.pop(),this.events.additionsHistoryUpdated.next()}},t.prototype.clearHistory=function(){this.state.additionsHistory.length!==0&&(this.state.additionsHistory=[],this.events.additionsHistoryUpdated.next())},t.prototype.clearHistoryForStructure=function(r){for(var n=[],i=0,a=this.state.additionsHistory;i<a.length;i++){var o=a[i];o.loci.structure.root===r.root&&n.push(o)}for(var s=0,u=n;s<u.length;s++){var o=u[s];this.modifyHistory(o,"remove")}n.length!==0&&this.events.additionsHistoryUpdated.next()},t.prototype.onRemove=function(r,n){var i;this.entries.has(r)&&(this.entries.delete(r),n!=null&&n.data&&this.clearHistoryForStructure(n.data),((i=this.referenceLoci)===null||i===void 0?void 0:i.structure)===(n==null?void 0:n.data)&&(this.referenceLoci=void 0),this.state.stats=void 0,this.events.changed.next())},t.prototype.onUpdate=function(r,n,i){var a,o,s,u;if(!(n===i||(n==null?void 0:n.data)===i.data)){var l=this.plugin.helpers.substructureParent.get(i.data,!0);if(l&&(r=l.transform.ref,!!this.entries.has(r))){var c=(o=(a=this.plugin.helpers.substructureParent.get(i.data))===null||a===void 0?void 0:a.obj)===null||o===void 0?void 0:o.data;if(c)if(!(n!=null&&n.data)||$e.areUnitIdsAndIndicesEqual(n.data,i.data)){this.entries.set(r,Btt(this.entries.get(r),c)),((s=this.referenceLoci)===null||s===void 0?void 0:s.structure.root)===c.root&&(this.referenceLoci=De.remap(this.referenceLoci,c));for(var d=!1,f=0,h=this.state.additionsHistory;f<h.length;f++){var v=h[f];v.loci.structure.root===c.root&&(v.loci=De.remap(v.loci,c),d=!0)}d&&this.events.additionsHistoryUpdated.next()}else this.entries.set(r,new gD(De(c,[]))),((u=this.referenceLoci)===null||u===void 0?void 0:u.structure.root)===c.root&&(this.referenceLoci=void 0),this.clearHistoryForStructure(c),this.state.stats=void 0,this.events.changed.next()}}},t.prototype.clear=function(){for(var r=this.entries.keys(),n=[];;){var i=r.next();if(i.done)break;var a=this.entries.get(i.value);De.isEmpty(a.selection)||n.push(a.selection),a.selection=De(a.selection.structure,[])}return this.referenceLoci=void 0,this.state.stats=void 0,this.events.changed.next(),this.events.loci.clear.next(),this.clearHistory(),n},t.prototype.getLoci=function(r){var n=this.getEntry(r);return n?n.selection:Or},t.prototype.getStructure=function(r){var n=this.getEntry(r);if(n)return n.structure},t.prototype.structureHasSelection=function(r){var n,i,a=(i=(n=r.cell)===null||n===void 0?void 0:n.obj)===null||i===void 0?void 0:i.data;if(!a)return!1;var o=this.getEntry(a);return!!o&&!De.isEmpty(o.selection)},t.prototype.has=function(r){if(De.is(r)){var n=this.getEntry(r.structure);if(n)return De.isSubset(n.selection,r)}return!1},t.prototype.tryGetRange=function(r){if(De.is(r)&&r.elements.length===1){var n=this.getEntry(r.structure);if(n){var i=r.elements[0];if(i){var a=this.referenceLoci;if(!(!a||!De.is(a)||a.structure!==r.structure)){for(var o,s=0,u=a.elements;s<u.length;s++){var l=u[s];if(i.unit===l.unit){o=l;break}}if(o&&i.unit===o.unit)return Utt(r.structure,o,i)}}}}},t.prototype.elementCount=function(){var r=0;return this.entries.forEach(function(n){r+=De.size(n.selection)}),r},t.prototype.getBoundary=function(){var r=_.create(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),n=_.create(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);W0.reset();var i=[];this.entries.forEach(function(c){var d=c.selection;De.isEmpty(d)||i.push(De.getBoundary(d))});for(var a=0,o=i.length;a<o;++a){var s=i[a],u=s.box,l=s.sphere;_.min(r,r,u.min),_.max(n,n,u.max),W0.includePositionRadius(l.center,l.radius)}W0.finishedIncludeStep();for(var a=0,o=i.length;a<o;++a){var l=i[a].sphere;W0.radiusPositionRadius(l.center,l.radius)}return{box:{min:r,max:n},sphere:W0.getSphere()}},t.prototype.getPrincipalAxes=function(){var r=this.elementCount(),n=new Float32Array(3*r),i=0;return this.entries.forEach(function(a){De.toPositionsArray(a.selection,n,i),i+=De.size(a.selection)*3}),$p.ofPositions(n)},t.prototype.modify=function(r,n){var i=!1;switch(r){case"add":i=this.add(n);break;case"remove":i=this.remove(n);break;case"intersect":i=this.intersect(n);break;case"set":i=this.set(n);break}i&&(this.state.stats=void 0,this.events.changed.next())},Object.defineProperty(t.prototype,"applicableStructures",{get:function(){return this.plugin.managers.structure.hierarchy.selection.structures.filter(function(r){return!!r.cell.obj}).map(function(r){return r.cell.obj.data})},enumerable:!1,configurable:!0}),t.prototype.triggerInteraction=function(r,n,i){switch(i===void 0&&(i=!0),r){case"add":this.plugin.managers.interactivity.lociSelects.select({loci:n},i);break;case"remove":this.plugin.managers.interactivity.lociSelects.deselect({loci:n},i);break;case"intersect":this.plugin.managers.interactivity.lociSelects.selectJoin({loci:n},i);break;case"set":this.plugin.managers.interactivity.lociSelects.selectOnly({loci:n},i);break}},t.prototype.fromLoci=function(r,n,i){i===void 0&&(i=!0),this.triggerInteraction(r,n,i)},t.prototype.fromCompiledQuery=function(r,n,i){i===void 0&&(i=!0);for(var a=0,o=this.applicableStructures;a<o.length;a++){var s=o[a],u=n(new Qo(s));this.triggerInteraction(r,mt.toLociWithSourceUnits(u),i)}},t.prototype.fromSelectionQuery=function(r,n,i){var a=this;i===void 0&&(i=!0),this.plugin.runTask(We.create("Structure Selection",function(o){return ce(a,void 0,void 0,function(){var s,u,l,c;return de(this,function(d){switch(d.label){case 0:s=0,u=this.applicableStructures,d.label=1;case 1:return s<u.length?(l=u[s],[4,n.getSelection(this.plugin,o,l)]):[3,4];case 2:c=d.sent(),this.triggerInteraction(r,mt.toLociWithSourceUnits(c),i),d.label=3;case 3:return s++,[3,1];case 4:return[2]}})})}))},t.prototype.fromSelections=function(r){var n,i=Ii.resolveAndCheck(this.plugin.state.data,r);if(!(!i||!i.obj)){if(!ge.Molecule.Structure.Selections.is(i.obj)){console.warn("fromSelections applied to wrong object type.",i.obj);return}this.clear();for(var a=0,o=(n=i.obj)===null||n===void 0?void 0:n.data;a<o.length;a++){var s=o[a];this.fromLoci("set",s.loci)}}},t}(vd);function Ftt(){return{structureCount:0,elementCount:0,label:"Nothing Selected"}}var gD=function(){function e(t){this._structure=void 0,this._selection=t}return Object.defineProperty(e.prototype,"selection",{get:function(){return this._selection},set:function(t){this._selection=t,this._structure=void 0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"structure",{get:function(){return this._structure?this._structure:(ar.isEmpty(this._selection)?this._structure=void 0:this._structure=De.toStructure(this._selection),this._structure)},enumerable:!1,configurable:!0}),e}();function Btt(e,t){return new gD(De.remap(e.selection,t))}function Utt(e,t,r){var n=Math.min(Oe.min(t.indices),Oe.min(r.indices)),i=Math.max(Oe.max(t.indices),Oe.max(r.indices));return De(e,[{unit:t.unit,indices:Oe.ofRange(n,i)}])}var jtt=[["full","Full"],["collapsed","Collapsed"],["hidden","Hidden"]],OT=[["full","Full"],["hidden","Hidden"]],ztt={isExpanded:I.Boolean(!1),showControls:I.Boolean(!0),regionState:I.Group({left:I.Select("full",jtt),top:I.Select("full",OT),right:I.Select("full",OT),bottom:I.Select("full",OT)}),controlsDisplay:I.Value("outside",{isHidden:!0})},Vtt=function(e){Le(t,e);function t(r){var n=e.call(this,E(E({},I.getDefaultValues(ztt)),r.spec.layout&&r.spec.layout.initial))||this;return n.context=r,n.events={updated:n.ev()},n.rootState=void 0,_t.Layout.Update.subscribe(r,function(i){return n.updateProps(i.state)}),typeof document<"u"&&(n.expandedViewport=document.createElement("meta"),n.expandedViewport.name="viewport",n.expandedViewport.content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"),n}return t.prototype.updateProps=function(r){var n=!!this.state.isExpanded;this.updateState(r),this.root&&typeof r.isExpanded=="boolean"&&r.isExpanded!==n&&this.handleExpand(),this.events.updated.next()},t.prototype.setProps=function(r){this.updateState(r)},t.prototype.setRoot=function(r){this.root=r,this.state.isExpanded&&this.handleExpand()},t.prototype.getScrollElement=function(){return document.scrollingElement?document.scrollingElement:document.documentElement?document.documentElement:document.body},t.prototype.handleExpand=function(){try{var r=document.getElementsByTagName("body")[0],n=document.getElementsByTagName("head")[0];if(!r||!n||!this.root)return;if(this.state.isExpanded){for(var i=n.children,a=[],o=!1,s=0;s<i.length;s++)i[s]===this.expandedViewport?o=!0:(i[s].name||"").toLowerCase()==="viewport"&&a.push(i[s]);for(var u=0,l=a;u<l.length;u++){var c=l[u];n.removeChild(c)}o||n.appendChild(this.expandedViewport);var d=r.style,f=this.getScrollElement(),h=f.scrollLeft,v=f.scrollTop;this.rootState={top:d.top,bottom:d.bottom,right:d.right,left:d.left,scrollTop:v,scrollLeft:h,position:d.position,overflow:d.overflow,viewports:a,zIndex:this.root.style.zIndex,width:d.width,height:d.height,maxWidth:d.maxWidth,maxHeight:d.maxHeight,margin:d.margin,marginLeft:d.marginLeft,marginRight:d.marginRight,marginTop:d.marginTop,marginBottom:d.marginBottom},d.overflow="hidden",d.position="fixed",d.top="0",d.bottom="0",d.right="0",d.left="0",d.width="100%",d.height="100%",d.maxWidth="100%",d.maxHeight="100%",d.margin="0",d.marginLeft="0",d.marginRight="0",d.marginTop="0",d.marginBottom="0"}else{for(var i=n.children,s=0;s<i.length;s++)if(i[s]===this.expandedViewport){n.removeChild(this.expandedViewport);break}if(this.rootState){for(var p=this.rootState,m=0,g=p.viewports;m<g.length;m++){var c=g[m];n.appendChild(c)}var d=r.style;d.top=p.top,d.bottom=p.bottom,d.left=p.left,d.right=p.right,d.width=p.width,d.height=p.height,d.maxWidth=p.maxWidth,d.maxHeight=p.maxHeight,d.margin=p.margin,d.marginLeft=p.marginLeft,d.marginRight=p.marginRight,d.marginTop=p.marginTop,d.marginBottom=p.marginBottom,d.position=p.position,d.overflow=p.overflow||"";var f=this.getScrollElement();f.scrollTop=p.scrollTop,f.scrollLeft=p.scrollLeft,this.rootState=void 0,this.root.style.zIndex=p.zIndex}}}catch(b){var y="Layout change error, you might have to reload the page.";this.context.log.error(y),console.error(y,b)}},t}(vd),ML={includeTypes:I.MultiSelect(V3(Nr.Names),I.objectToOptions(Nr.Names)),excludeTypes:I.MultiSelect([],I.objectToOptions(Nr.Names)),ignoreHydrogens:I.Boolean(!1),aromaticBonds:I.Boolean(!1,{description:"Display aromatic bonds with dashes"})};I.getDefaultValues(ML);var DL=E(E(E({},Cv),ML),{adjustCylinderLength:I.Boolean(!0,{description:"Shorten cylinders to reduce overlap with spheres."})});I.getDefaultValues(DL);var RL=E(E({},Cee),ML);I.getDefaultValues(RL);function hre(e,t,r){return!Nr.is(e,r)||Nr.is(t,r)}function pre(e,t,r){var n=t.elements,i=t.model.atomicHierarchy.derived.atom.atomicNumber,a=t.bonds,o=a.a,s=a.b,u=a.edgeProps,l=u.flags,c=r.ignoreHydrogens,d=r.includeTypes,f=r.excludeTypes,h=Nr.fromNames(d),v=Nr.fromNames(f),p=Nr.isAll(h)&&v===0,m=e.child,g=m==null?void 0:m.unitMap.get(t.id);if(m&&!g)throw new Error("expected childUnit to exist if child exists");if(!(p&&!c&&!m))return function(y){return!!g&&!Je.has(g.elements,n[o[y]])||c&&(S_(i,n[o[y]])||S_(i,n[s[y]]))||!p&&hre(h,v,l[y])}}function vre(e,t){var r=e.interUnitBonds,n=r.edges,i=t.ignoreHydrogens,a=t.includeTypes,o=t.excludeTypes,s=Nr.fromNames(a),u=Nr.fromNames(o),l=Nr.isAll(s)&&u===0,c=e.child;if(!(l&&!i&&!c))return function(d){if(c){var f=n[d],h=c.unitMap.get(f.unitA);if(!h)return!0;var v=e.unitMap.get(f.unitA),p=v.elements[f.indexA];if(!Je.has(h.elements,p))return!0}if(i){var f=n[d],m=e.unitMap.get(f.unitA),g=e.unitMap.get(f.unitB);if(x_(m,m.elements[f.indexA])||x_(g,g.elements[f.indexB]))return!0}return!!(!l&&hre(s,u,n[d].props.flag))}}var th;(function(e){function t(n){var i=n.group,a=n.structure,o=i.units[0],s=Ue.isAtomic(o)?o.bonds.edgeCount*2:0,u=i.units.length,l=Vt.Location(a,void 0,void 0,a,void 0,void 0),c=function(d,f){var h=i.units[f];return l.aUnit=h,l.bUnit=h,l.aIndex=h.bonds.a[d],l.bIndex=h.bonds.b[d],l};return mn(s,u,1,c)}e.fromGroup=t;function r(n){var i=n.interUnitBonds.edgeCount,a=1,o=Vt.Location(n,void 0,void 0,n,void 0,void 0),s=function(u){var l=n.interUnitBonds.edges[u];return o.aUnit=n.unitMap.get(l.unitA),o.aIndex=l.indexA,o.bUnit=n.unitMap.get(l.unitB),o.bIndex=l.indexB,o};return mn(i,a,1,s,!0)}e.fromStructure=r})(th||(th={}));function kL(e,t,r){var n=e.objectId,i=e.instanceId,a=e.groupId;if(r===n){var o=t.structure,s=t.group,u=s.units[i];if(Ue.isAtomic(u)){var l=o.target,c=u.bonds.a[a],d=u.bonds.b[a];return Vt.Loci(l,[Vt.Location(l,u,c,l,u,d),Vt.Location(l,u,d,l,u,c)])}}return Or}function OL(e,t,r,n){var i=!1;if(Vt.isLoci(e)){var a=t.structure,o=t.group;if(!$e.areEquivalent(e.structure,a))return!1;var s=o.units[0];if(!Ue.isAtomic(s))return!1;for(var u=s.bonds.edgeCount*2,l=0,c=e.bonds;l<c.length;l++){var d=c[l];if(d.aUnit===d.bUnit){var f=o.unitIndexMap.get(d.aUnit.id);if(f!==void 0){var h=s.bonds.getDirectedEdgeIndex(d.aIndex,d.bIndex);h!==-1&&r(Te.ofSingleton(f*u+h))&&(i=!0)}}}}else if(De.is(e)){var a=t.structure,o=t.group;if(!$e.areEquivalent(e.structure,a))return!1;var s=o.units[0];if(!Ue.isAtomic(s))return!1;for(var v=s.bonds.edgeCount*2,p=function(C){var w=o.unitIndexMap.get(C.unit.id);if(w!==void 0){var A=s.bonds,M=A.offset,D=A.b;Oe.forEach(C.indices,function(k){for(var R=M[k],L=M[k+1];R<L;R++)(!n||Oe.has(C.indices,D[R]))&&r(Te.ofSingleton(w*v+R))&&(i=!0)})}},m=0,g=e.elements;m<g.length;m++){var y=g[m];p(y)}}return i}function LL(e,t,r){var n=e.objectId,i=e.groupId;if(r===n){var a=t.target,o=t.interUnitBonds.edges[i],s=t.unitMap.get(o.unitA),u=t.unitMap.get(o.unitB);return Vt.Loci(a,[Vt.Location(a,s,o.indexA,a,u,o.indexB),Vt.Location(a,u,o.indexB,a,s,o.indexA)])}return Or}function NL(e,t,r,n){var i=!1;if(Vt.isLoci(e)){if(!$e.areEquivalent(e.structure,t))return!1;for(var a=0,o=e.bonds;a<o.length;a++){var s=o[a],u=t.interUnitBonds.getBondIndexFromLocation(s);u!==-1&&r(Te.ofSingleton(u))&&(i=!0)}}else if(De.is(e)){if(!$e.areEquivalent(e.structure,t)||n&&e.elements.length===1)return!1;for(var l=new Map,c=0,d=e.elements;c<d.length;c++){var f=d[c];l.set(f.unit.id,f.indices)}for(var h=function(m){var g=m.unit;if(!Ue.isAtomic(g))return"continue";t.interUnitBonds.getConnectedUnits(g.id).forEach(function(y){var b=l.get(y.unitB);(!n||b)&&Oe.forEach(m.indices,function(S){y.connectedIndices.includes(S)&&y.getEdges(S).forEach(function(x){if(!n||b&&Oe.has(b,x.indexB)){var C=t.interUnitBonds.getEdgeIndex(S,g.id,x.indexB,y.unitB);r(Te.ofSingleton(C))&&(i=!0)}})})})},v=0,p=e.elements;v<p.length;v++){var f=p[v];h(f)}}return i}var LT=Nr.is;function mre(e,t,r,n){var i=e.elements,a=e.bonds,o=a.edgeCount,s=a.a,u=a.b,l=a.edgeProps,c=a.offset,d=l.order,f=l.flags,h=n.sizeFactor,v=n.sizeAspectRatio,p=n.adjustCylinderLength,m=n.aromaticBonds,g=_(),y=_(),b=e.conformation.invariantPosition,S,x=Ze.create(t,e),C=Vt.Location(t,e,void 0,t,e,void 0),w=t.child;if(n.includeParent&&w){var A=w.unitMap.get(e.id);if(!A)throw new Error("expected childUnit to exist");S=function(B){var j=i[s[B]],Q=i[u[B]];return Je.has(A.elements,j)&&!Je.has(A.elements,Q)}}var M=function(B){return C.aIndex=s[B],C.bIndex=u[B],r.size.size(C)*h},D=function(B){return x.element=i[s[B]],r.size.size(x)*h},k=function(B){return x.element=i[u[B]],r.size.size(x)*h},R=e.rings,L=R.elementRingIndices,H=R.elementAromaticRingIndices;return{linkCount:o*2,referencePosition:function(B){var j,Q,G=s[B],W=u[B];G>W&&(j=[W,G],G=j[0],W=j[1]),c[G+1]-c[G]===1&&(Q=[W,G],G=Q[0],W=Q[1]);for(var q=L.get(G),ee=0,he=c[G],$=c[G+1];he<$;++he){var X=u[he];if(X!==W&&X!==G)if(q){var U=L.get(X);if(!U)continue;var z=VC(q,U);z>ee&&(ee=z,b(i[X],g))}else return b(i[X],g)}return ee>0?g:null},position:function(B,j,Q){if(b(i[s[Q]],B),b(i[u[Q]],j),p){var G=D(Q),W=k(Q),q=Math.min(G,W)*v,ee=Math.sqrt(Math.max(0,G*G-q*q))-.05,he=Math.sqrt(Math.max(0,W*W-q*q))-.05;if(ee<=.01&&he<=.01)return;_.normalize(y,_.sub(y,j,B)),_.scaleAndAdd(B,B,y,ee),_.scaleAndAdd(j,j,y,-he)}},style:function(B){var j=d[B],Q=f[B];if(LT(Q,2)||LT(Q,4))return 1;if(j===3)return 3;if(m){var G=s[B],W=u[B],q=H.get(G),ee=H.get(W),he=q&&ee?VC(q,ee):0;if(he||LT(Q,16))return he===2?6:5}return j===2?2:0},radius:function(B){return M(B)*v},ignore:pre(t,e,n),stub:S}}function Htt(e,t,r,n,i,a){if(!Ue.isAtomic(t)||!t.bonds.edgeCount)return Vo.createEmpty(a);var o=r.child,s=o==null?void 0:o.unitMap.get(t.id);if(o&&!s)return Vo.createEmpty(a);var u=mre(t,r,n,i),l=_ee(e,u,i,a),c=Fe.expand(Fe(),(s??t).boundary.sphere,1*i.sizeFactor);return l.setBoundingSphere(c),l}function Gtt(e,t,r,n,i,a){if(!Ue.isAtomic(t)||!t.bonds.edgeCount)return Nt.createEmpty(a);var o=r.child,s=o==null?void 0:o.unitMap.get(t.id);if(o&&!s)return Nt.createEmpty(a);var u=mre(t,r,n,i),l=_v(e,u,i,a),c=Fe.expand(Fe(),(s??t).boundary.sphere,1*i.sizeFactor);return l.setBoundingSphere(c),l}var dE=E(E(E(E({},ga),cee),DL),{sizeFactor:I.Numeric(.3,{min:0,max:10,step:.01}),sizeAspectRatio:I.Numeric(2/3,{min:0,max:3,step:.01}),tryUseImpostor:I.Boolean(!0),includeParent:I.Boolean(!1)});function gre(e,t,r,n){return r.tryUseImpostor&&n&&n.extensions.fragDepth?qtt(e):Wtt(e)}function qtt(e){return dee({defaultProps:I.getDefaultValues(dE),createGeometry:Htt,createLocationIterator:th.fromGroup,getLoci:kL,eachLocation:OL,setUpdateState:function(t,r,n,i,a,o,s){t.createGeometry=r.sizeAspectRatio!==n.sizeAspectRatio||r.linkScale!==n.linkScale||r.linkSpacing!==n.linkSpacing||r.ignoreHydrogens!==n.ignoreHydrogens||r.linkCap!==n.linkCap||r.dashCount!==n.dashCount||r.dashScale!==n.dashScale||r.dashCap!==n.dashCap||r.stubCap!==n.stubCap||!Xa(r.includeTypes,n.includeTypes)||!Xa(r.excludeTypes,n.excludeTypes)||r.adjustCylinderLength!==n.adjustCylinderLength||r.aromaticBonds!==n.aromaticBonds;var u=o.group.units[0],l=s.group.units[0];Ue.isAtomic(u)&&Ue.isAtomic(l)&&(bo.areEqual(u.bonds,l.bonds)||(t.createGeometry=!0,t.updateTransform=!0,t.updateColor=!0,t.updateSize=!0))},mustRecreate:function(t,r,n){return!r.tryUseImpostor||!n}},e)}function Wtt(e){return Ja({defaultProps:I.getDefaultValues(dE),createGeometry:Gtt,createLocationIterator:th.fromGroup,getLoci:kL,eachLocation:OL,setUpdateState:function(t,r,n,i,a,o,s){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.sizeAspectRatio!==n.sizeAspectRatio||r.radialSegments!==n.radialSegments||r.linkScale!==n.linkScale||r.linkSpacing!==n.linkSpacing||r.ignoreHydrogens!==n.ignoreHydrogens||r.linkCap!==n.linkCap||r.dashCount!==n.dashCount||r.dashScale!==n.dashScale||r.dashCap!==n.dashCap||r.stubCap!==n.stubCap||!Xa(r.includeTypes,n.includeTypes)||!Xa(r.excludeTypes,n.excludeTypes)||r.adjustCylinderLength!==n.adjustCylinderLength||r.aromaticBonds!==n.aromaticBonds;var u=o.group.units[0],l=s.group.units[0];Ue.isAtomic(u)&&Ue.isAtomic(l)&&(bo.areEqual(u.bonds,l.bonds)||(t.createGeometry=!0,t.updateTransform=!0,t.updateColor=!0,t.updateSize=!0))},mustRecreate:function(t,r,n){return r.tryUseImpostor&&!!n}},e)}var NT=new Vt.ElementBondIterator;function fV(e,t,r,n){for(NT.setElement(t,r,n);NT.hasNext;){var i=NT.move();return i.otherUnit.conformation.position(i.otherUnit.elements[i.otherIndex],e),e}return null}var hV=_();function yre(e,t,r){var n=Ze.create(e),i=Vt.Location(e,void 0,void 0,e,void 0,void 0),a=e.interUnitBonds,o=a.edgeCount,s=a.edges,u=r.sizeFactor,l=r.sizeAspectRatio,c=r.adjustCylinderLength,d=r.aromaticBonds,f=_(),h,v=e.child;r.includeParent&&v&&(h=function(y){var b=s[y],S=v.unitMap.get(b.unitA),x=v.unitMap.get(b.unitB),C=e.unitMap.get(b.unitA),w=C.elements[b.indexA],A=e.unitMap.get(b.unitB),M=A.elements[b.indexB];return S&&Je.has(S.elements,w)&&(!x||!Je.has(x.elements,M))});var p=function(y){var b=s[y];return i.aUnit=e.unitMap.get(b.unitA),i.aIndex=b.indexA,i.bUnit=e.unitMap.get(b.unitB),i.bIndex=b.indexB,t.size.size(i)*u},m=function(y){var b=s[y];return n.unit=e.unitMap.get(b.unitA),n.element=n.unit.elements[b.indexA],t.size.size(n)*u},g=function(y){var b=s[y];return n.unit=e.unitMap.get(b.unitB),n.element=n.unit.elements[b.indexB],t.size.size(n)*u};return{linkCount:o,referencePosition:function(y){var b=s[y],S,x,C,w;if(b.unitA<b.unitB)S=e.unitMap.get(b.unitA),x=e.unitMap.get(b.unitB),C=b.indexA,w=b.indexB;else if(b.unitA>b.unitB)S=e.unitMap.get(b.unitB),x=e.unitMap.get(b.unitA),C=b.indexB,w=b.indexA;else throw new Error("same units in createInterUnitBondCylinderMesh");return fV(hV,e,S,C)||fV(hV,e,x,w)},position:function(y,b,S){var x=s[S],C=e.unitMap.get(x.unitA),w=e.unitMap.get(x.unitB);if(C.conformation.position(C.elements[x.indexA],y),w.conformation.position(w.elements[x.indexB],b),c){var A=m(S),M=g(S),D=Math.min(A,M)*l,k=Math.sqrt(Math.max(0,A*A-D*D))-.05,R=Math.sqrt(Math.max(0,M*M-D*D))-.05;if(k<=.01&&R<=.01)return;_.normalize(f,_.sub(f,b,y)),_.scaleAndAdd(y,y,f,k),_.scaleAndAdd(b,b,f,-R)}},style:function(y){var b=s[y].props.order,S=da.create(s[y].props.flag);return Nr.is(S,2)||Nr.is(S,4)?1:b===3?3:d&&Nr.is(S,16)?5:b===2?2:0},radius:function(y){return p(y)*l},ignore:vre(e,r),stub:h}}function $tt(e,t,r,n,i){if(!t.interUnitBonds.edgeCount)return Vo.createEmpty(i);var a=yre(t,r,n),o=_ee(e,a,n,i),s=t.child,u=Fe.expand(Fe(),(s??t).boundary.sphere,1*n.sizeFactor);return o.setBoundingSphere(u),o}function Xtt(e,t,r,n,i){if(!t.interUnitBonds.edgeCount)return Nt.createEmpty(i);var a=yre(t,r,n),o=_v(e,a,n,i),s=t.child,u=Fe.expand(Fe(),(s??t).boundary.sphere,1*n.sizeFactor);return o.setBoundingSphere(u),o}var fE=E(E(E(E({},Nb),$He),DL),{sizeFactor:I.Numeric(.3,{min:0,max:10,step:.01}),sizeAspectRatio:I.Numeric(2/3,{min:0,max:3,step:.01}),tryUseImpostor:I.Boolean(!0),includeParent:I.Boolean(!1)});function bre(e,t,r,n){return r.tryUseImpostor&&n&&n.extensions.fragDepth?Ytt(e):Ktt(e)}function Ytt(e){return XHe({defaultProps:I.getDefaultValues(fE),createGeometry:$tt,createLocationIterator:th.fromStructure,getLoci:LL,eachLocation:NL,setUpdateState:function(t,r,n){t.createGeometry=r.sizeAspectRatio!==n.sizeAspectRatio||r.linkScale!==n.linkScale||r.linkSpacing!==n.linkSpacing||r.ignoreHydrogens!==n.ignoreHydrogens||r.linkCap!==n.linkCap||r.dashCount!==n.dashCount||r.dashScale!==n.dashScale||r.dashCap!==n.dashCap||r.stubCap!==n.stubCap||!Xa(r.includeTypes,n.includeTypes)||!Xa(r.excludeTypes,n.excludeTypes)||r.adjustCylinderLength!==n.adjustCylinderLength},mustRecreate:function(t,r,n){return!r.tryUseImpostor||!n}},e)}function Ktt(e){return xv({defaultProps:I.getDefaultValues(fE),createGeometry:Xtt,createLocationIterator:th.fromStructure,getLoci:LL,eachLocation:NL,setUpdateState:function(t,r,n){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.sizeAspectRatio!==n.sizeAspectRatio||r.radialSegments!==n.radialSegments||r.linkScale!==n.linkScale||r.linkSpacing!==n.linkSpacing||r.ignoreHydrogens!==n.ignoreHydrogens||r.linkCap!==n.linkCap||r.dashCount!==n.dashCount||r.dashScale!==n.dashScale||r.dashCap!==n.dashCap||r.stubCap!==n.stubCap||!Xa(r.includeTypes,n.includeTypes)||!Xa(r.excludeTypes,n.excludeTypes)||r.adjustCylinderLength!==n.adjustCylinderLength},mustRecreate:function(t,r,n){return r.tryUseImpostor&&!!n}},e)}var pV=new Float32Array([-1,1,-1,-1,1,1,1,-1]),em=new Uint16Array([0,1,2,1,3,2]),FT=qe.add3,Qtt=qe.add2,Ztt=qe.add,X_;(function(e){function t(r,n,i){r===void 0&&(r=2048),n===void 0&&(n=1024),r*=4,n*=4;var a=qe.create(Float32Array,3,n,i?i.centerBuffer.ref.value:r),o=qe.create(Float32Array,2,n,i?i.mappingBuffer.ref.value:r),s=qe.create(Uint32Array,3,n/2,i?i.indexBuffer.ref.value:r/2),u=qe.create(Float32Array,1,n,i?i.groupBuffer.ref.value:r);return{add:function(l,c,d,f){for(var h=a.elementCount,v=0;v<4;++v)FT(a,l,c,d),Qtt(o,pV[v*2],pV[v*2+1]),Ztt(u,f);FT(s,h+em[0],h+em[1],h+em[2]),FT(s,h+em[3],h+em[4],h+em[5])},getSpheres:function(){var l=qe.compact(a,!0),c=qe.compact(o,!0),d=qe.compact(s,!0),f=qe.compact(u,!0);return Zf.create(l,c,d,f,a.elementCount/4,i)}}}e.create=t})(X_||(X_={}));var xre=_.add;function FL(e,t,r){var n=r.ignoreHydrogens,i=r.traceOnly,a=t.model.atomicHierarchy.derived.atom.atomicNumber,o=Ue.isCoarse(t),s=e.child,u=s==null?void 0:s.unitMap.get(t.id);if(s&&!u)throw new Error("expected childUnit to exist if child exists");if(!(!s&&!n&&!i))return function(l){return!!u&&!Je.has(u.elements,l)||!o&&n&&S_(a,l)||i&&!qO(t,l)}}function Jtt(e,t,r,n,i,a){var o=r.child,s=o==null?void 0:o.unitMap.get(t.id);if(o&&!s)return Nt.createEmpty(a);for(var u=i.detail,l=i.sizeFactor,c=t.elements,d=c.length,f=d*B3(u),h=wt.createState(f,f/2,a),v=_(),p=t.conformation.invariantPosition,m=FL(r,t,i),g=Ze.create(r,t),y=n.size.size,b=_(),S=0,x=0,C=0;C<d;C++)if(!(m&&m(c[C]))){g.element=c[C],p(c[C],v),xre(b,b,v),x+=1,h.currentGroup=C;var w=y(g);w>S&&(S=w),Mi(h,v,w*l,u)}var A;_.scale(b,b,1/x),a&&_.distance(b,a.boundingSphere.center)/a.boundingSphere.radius<1?A=Fe.clone(a.boundingSphere):A=Fe.expand(Fe(),(s??t).boundary.sphere,S*l+.05);var M=wt.getMesh(h);return M.setBoundingSphere(A),M}function ert(e,t,r,n,i,a){var o=r.child,s=o==null?void 0:o.unitMap.get(t.id);if(o&&!s)return Zf.createEmpty(a);for(var u=t.elements,l=u.length,c=X_.create(l,l/2,a),d=_(),f=t.conformation.invariantPosition,h=FL(r,t,i),v=Ze.create(r,t),p=n.size.size,m=_(),g=0,y=0,b=0;b<l;b++)if(!(h!=null&&h(u[b]))){f(u[b],d),c.add(d[0],d[1],d[2],b),xre(m,m,d),y+=1,v.element=u[b];var S=p(v);S>g&&(g=S)}var x;_.scale(m,m,1/y),a&&_.distance(m,a.boundingSphere.center)/a.boundingSphere.radius<1?x=Fe.clone(a.boundingSphere):x=Fe.expand(Fe(),(s??t).boundary.sphere,g*i.sizeFactor+.05);var C=c.getSpheres();return C.setBoundingSphere(x),C}function Dl(e,t,r){var n=!1;if(!De.is(e))return!1;var i=t.structure,a=t.group;if(!$e.areEquivalent(e.structure,i))return!1;for(var o=a.elements.length,s=0,u=e.elements;s<u.length;s++){var l=u[s],c=a.unitIndexMap.get(l.unit.id);if(c!==void 0){var d=c*o;if(Te.is(l.indices)){var f=d+Te.start(l.indices),h=d+Te.end(l.indices);r(Te.ofBounds(f,h))&&(n=!0)}else for(var v=0,p=l.indices.length;v<p;v++){for(var f=l.indices[v],m=v+1;m<p&&l.indices[m]===f;)m++;v=m-1;var h=l.indices[v];n=r(Te.ofRange(d+f,d+h))||n}}}return n}function Rl(e,t,r){var n=e.objectId,i=e.instanceId,a=e.groupId;if(r===n){var o=t.structure,s=t.group,u=s.units[i],l=Oe.ofSingleton(a);return De(o.target,[{unit:u,indices:l}])}return Or}function hE(e,t,r){var n=!1;if(!De.is(e)||!$e.areEquivalent(e.structure,t))return!1;for(var i=t.serialMapping.cumulativeUnitElementCount,a=0,o=e.elements;a<o.length;a++){var s=o[a],u=t.unitIndexMap.get(s.unit.id);if(u!==void 0)if(Te.is(s.indices)){var l=i[u]+Te.start(s.indices),c=i[u]+Te.end(s.indices);r(Te.ofBounds(l,c))&&(n=!0)}else for(var d=0,f=s.indices.length;d<f;d++){var h=i[u]+s.indices[d];r(Te.ofSingleton(h))&&(n=!0)}}return n}function pE(e,t,r){var n=e.objectId,i=e.groupId;if(r===n){var a=t.serialMapping,o=a.unitIndices,s=a.cumulativeUnitElementCount,u=o[i],l=t.units[u],c=i-s[u],d=Oe.ofSingleton(c);return De(t,[{unit:l,indices:d}])}return Or}var Na;(function(e){function t(n){var i=n.group,a=n.structure,o=i.elements.length,s=i.units.length,u=Ze.create(a),l=function(c,d){var f=i.units[d];return u.unit=f,u.element=f.elements[c],u};return mn(o,s,1,l)}e.fromGroup=t;function r(n){var i=n.units,a=n.elementCount,o=a,s=1,u=n.serialMapping,l=u.unitIndices,c=u.elementIndices,d=Ze.create(n),f=function(h){return d.unit=i[l[h]],d.element=c[h],d};return mn(o,s,1,f,!0)}e.fromStructure=r})(Na||(Na={}));var vE=E(E(E({},ga),uee),{sizeFactor:I.Numeric(1,{min:0,max:10,step:.1}),detail:I.Numeric(0,{min:0,max:3,step:1},Et.CustomQualityParamInfo),ignoreHydrogens:I.Boolean(!1),traceOnly:I.Boolean(!1),tryUseImpostor:I.Boolean(!0)});function Sre(e,t,r,n){return r.tryUseImpostor&&n&&n.extensions.fragDepth?trt(e):rrt(e)}function trt(e){return lee({defaultProps:I.getDefaultValues(vE),createGeometry:ert,createLocationIterator:Na.fromGroup,getLoci:Rl,eachLocation:Dl,setUpdateState:function(t,r,n){t.createGeometry=r.ignoreHydrogens!==n.ignoreHydrogens||r.traceOnly!==n.traceOnly},mustRecreate:function(t,r,n){return!r.tryUseImpostor||!n}},e)}function rrt(e){return Ja({defaultProps:I.getDefaultValues(vE),createGeometry:Jtt,createLocationIterator:Na.fromGroup,getLoci:Rl,eachLocation:Dl,setUpdateState:function(t,r,n){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.detail!==n.detail||r.ignoreHydrogens!==n.ignoreHydrogens||r.traceOnly!==n.traceOnly},mustRecreate:function(t,r,n){return r.tryUseImpostor&&!!n}},e)}var Cre={"element-sphere":function(e,t){return Jn("Element sphere",e,t,Sre)},"intra-bond":function(e,t){return Jn("Intra-unit bond cylinder",e,t,gre)},"inter-bond":function(e,t){return Su("Inter-unit bond cylinder",e,t,bre)}},_re=E(E(E(E(E({},vE),{traceOnly:I.Boolean(!1,{isHidden:!0})}),dE),fE),{includeParent:I.Boolean(!1),unitKinds:Lb(["atomic"]),sizeFactor:I.Numeric(.15,{min:.01,max:10,step:.01}),sizeAspectRatio:I.Numeric(2/3,{min:.01,max:3,step:.01}),visuals:I.MultiSelect(["element-sphere","intra-bond","inter-bond"],I.objectToOptions(Cre))});function nrt(e,t){return I.clone(_re)}function irt(e,t){return or.createMulti("Ball & Stick",e,t,Ri,Cre)}var art={name:"ball-and-stick",label:"Ball & Stick",description:"Displays atoms as spheres and bonds as cylinders.",factory:irt,getParams:nrt,defaultValues:I.getDefaultValues(_re),defaultColorTheme:{name:"element-symbol"},defaultSizeTheme:{name:"physical"},isApplicable:function(e){return e.elementCount>0},getData:function(e,t){return t.includeParent?e.asParent():e},mustRecreate:function(e,t){return e.includeParent!==t.includeParent}};function ort(e,t,r,n,i){var a=t.carbohydrates,o=a.links,s=a.elements,u=n.linkSizeFactor,l=Ze.create(t),c={linkCount:o.length,position:function(d,f,h){var v=o[h];_.copy(d,s[v.carbohydrateIndexA].geometry.center),_.copy(f,s[v.carbohydrateIndexB].geometry.center)},radius:function(d){var f=o[d],h=s[f.carbohydrateIndexA],v=h.unit.rings.all[h.ringIndex];return l.unit=h.unit,l.element=h.unit.elements[v[0]],r.size.size(l)*u}};return _v(e,c,n,i)}var wre=E(E(E({},ga),Cv),{linkSizeFactor:I.Numeric(.3,{min:0,max:3,step:.01})});function srt(e){return xv({defaultProps:I.getDefaultValues(wre),createGeometry:ort,createLocationIterator:urt,getLoci:lrt,eachLocation:crt,setUpdateState:function(t,r,n){t.createGeometry=r.linkSizeFactor!==n.linkSizeFactor||r.radialSegments!==n.radialSegments||r.linkCap!==n.linkCap}},e)}function urt(e){var t=e.carbohydrates,r=t.elements,n=t.links,i=n.length,a=1,o=Ze.create(e),s=function(u){var l=n[u],c=r[l.carbohydrateIndexA],d=c.unit.rings.all[c.ringIndex];return o.unit=c.unit,o.element=c.unit.elements[d[0]],o};return mn(i,a,1,s,!0)}function lrt(e,t,r){var n=e.objectId,i=e.groupId;if(r===n){var a=t.carbohydrates,o=a.links,s=a.elements,u=o[i],l=s[u.carbohydrateIndexA],c=s[u.carbohydrateIndexB];return De.union(nb(t,l.unit,l.residueIndex,l.altId),nb(t,c.unit,c.residueIndex,c.altId))}return Or}function crt(e,t,r){var n=!1;if(!De.is(e)||!$e.areEquivalent(e.structure,t))return!1;for(var i=t.carbohydrates.getLinkIndices,a=function(d,f){if(!Ue.isAtomic(d))return"continue";Oe.forEach(f,function(h){for(var v=i(d,d.elements[h]),p=0,m=v.length;p<m;++p)r(Te.ofSingleton(v[p]))&&(n=!0)})},o=0,s=e.elements;o<s.length;o++){var u=s[o],l=u.unit,c=u.indices;a(l,c)}return n}var drt=_.create(0,0,-.5),frt=_.create(0,0,.5),Od=_(),Ld=_(),Sx=_(),vV=_();function hrt(e){for(var t=e.length/3,r=t===3?1:t===4?2:t,n=r+t,i=t===4?t*3+4:n*3,a=e0(n,i),o=0;o<t;++o){var s=(o+1)%t;_.set(Od,e[o*3],e[o*3+1],-.5),_.set(Ld,e[s*3],e[s*3+1],-.5),a.add(Od,Ld,frt)}if(t===3)_.set(Od,e[0],e[1],-.5),_.set(Ld,e[3],e[4],-.5),_.set(Sx,e[6],e[7],-.5),a.add(Sx,Ld,Od);else if(t===4)_.set(Od,e[0],e[1],-.5),_.set(Ld,e[3],e[4],-.5),_.set(Sx,e[6],e[7],-.5),_.set(vV,e[9],e[10],-.5),a.addQuad(vV,Sx,Ld,Od);else for(var o=0;o<t;++o){var s=(o+1)%t;_.set(Od,e[o*3],e[o*3+1],-.5),_.set(Ld,e[s*3],e[s*3+1],-.5),a.add(drt,Ld,Od)}return a.getPrimitive()}var BT;function prt(){return BT||(BT=hrt(Ml(8,!0))),BT}var UT;function vrt(){if(!UT){for(var e=Ml(8,!0),t=new Float32Array(8*3+6),r=0;r<8;++r)t[r*3]=e[r*3],t[r*3+1]=e[r*3+1],t[r*3+2]=-.5;t[8*3]=0,t[8*3+1]=0,t[8*3+2]=-.5,t[8*3+3]=0,t[8*3+4]=0,t[8*3+5]=.5;var n=[0,1,8,1,2,8,4,5,8,5,6,8,2,3,9,3,4,9,6,7,9,7,0,9];UT=N3(t,n)}return UT}var mrt={pointCount:5,outerRadius:1,innerRadius:.5,thickness:.3},jT=_.zero(),zT=_.zero(),VT=_.zero(),$0=_.zero(),HT=_.zero();function grt(e){for(var t=E(E({},mrt),e),r=t.outerRadius,n=t.innerRadius,i=t.thickness,a=t.pointCount,o=a*2*2,s=e0(o),u=new Float32Array(a*2),l=new Float32Array(a*2),c=0;c<a;++c){var d=c*2,f=c*2+1,h=(d+1)/a*Math.PI,v=(f+1)/a*Math.PI;l[d]=Math.cos(h)*r,l[f]=Math.sin(h)*r,u[d]=Math.cos(v)*n,u[f]=Math.sin(v)*n}_.set(jT,0,0,i/2),_.set(zT,0,0,-i/2);for(var c=0;c<a;++c){var p=(c+1)%a;_.set(VT,l[c*2],l[c*2+1],0),_.set($0,u[c*2],u[c*2+1],0),_.set(HT,l[p*2],l[p*2+1],0),s.add(jT,VT,$0),s.add($0,VT,zT),s.add(jT,$0,HT),s.add(HT,$0,zT)}return s.getPrimitive()}var Ere=[.5,0,0,-.5,0,0,0,.5,0,0,-.5,0,0,0,.5,0,0,-.5],yrt=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],brt=[0,2,4,0,4,3,1,2,5,1,5,3],GT;function xrt(){return GT||(GT=N3(Ere,yrt)),GT}var qT;function Srt(){return qT||(qT=N3(Ere,brt)),qT}var Ot=ue.identity(),ql=_.zero(),mV=_.zero(),Crt=2*.806,gV=PO(),yV=S6e(),_rt=prt(),bV=vrt(),wrt=grt({outerRadius:1,innerRadius:.5,thickness:.5,pointCount:5}),Ert=xrt(),xV=Srt(),SV=VBe(),Art=HBe(),Prt=GBe(),Trt=qBe(),Irt=WBe();function Mrt(e,t,r,n,i){for(var a=wt.createState(256,128,i),o=n.detail,s=n.sizeFactor,u=t.carbohydrates,l=u.elements.length,c=Ze.create(t),d=0;d<l;++d){var f=u.elements[d],h=f.unit.rings.all[f.ringIndex],v=s4e(f.component.type,h.length);c.unit=f.unit,c.element=f.unit.elements[h[0]];var p=r.size.size(c),m=p*s,g=p*s*Crt,y=f.geometry,b=y.center,S=y.normal,x=y.direction;switch(_.add(mV,b,x),ue.targetTo(Ot,b,mV,S),ue.setTranslation(Ot,b),a.currentGroup=d*2,v){case 0:Mi(a,b,m,o);break;case 1:ue.scaleUniformly(Ot,Ot,g),wt.addPrimitive(a,Ot,gV);break;case 2:ue.scaleUniformly(Ot,Ot,g),wt.addPrimitive(a,Ot,yV),ue.mul(Ot,Ot,ue.rotZ90X180),a.currentGroup+=1,wt.addPrimitive(a,Ot,yV);break;case 4:ue.scaleUniformly(Ot,Ot,g*1.2),wt.addPrimitive(a,Ot,_rt);break;case 5:ue.scaleUniformly(Ot,Ot,g*1.2),wt.addPrimitive(a,Ot,bV),ue.mul(Ot,Ot,ue.rotZ90),a.currentGroup+=1,wt.addPrimitive(a,Ot,bV);break;case 6:ue.mul(Ot,Ot,ue.rotZY90),ue.scale(Ot,Ot,_.set(ql,g,g,g/2)),wt.addPrimitive(a,Ot,gV);break;case 7:ue.scaleUniformly(Ot,Ot,g),ue.mul(Ot,Ot,ue.rotZY90),wt.addPrimitive(a,Ot,wrt);break;case 8:ue.mul(Ot,Ot,ue.rotZY90),ue.scale(Ot,Ot,_.set(ql,g*1.4,g*1.4,g*1.4)),wt.addPrimitive(a,Ot,Ert);break;case 3:ue.mul(Ot,Ot,ue.rotZY90),ue.scale(Ot,Ot,_.set(ql,g*1.4,g*1.4,g*1.4)),wt.addPrimitive(a,Ot,xV),ue.mul(Ot,Ot,ue.rotY90),a.currentGroup+=1,wt.addPrimitive(a,Ot,xV);break;case 9:ue.mul(Ot,Ot,ue.rotZY90),ue.scale(Ot,Ot,_.set(ql,g,g/2,g/2)),wt.addPrimitive(a,Ot,SV);break;case 12:ue.mul(Ot,Ot,ue.rotZY90),ue.scale(Ot,Ot,_.set(ql,g,g,g/2)),wt.addPrimitive(a,Ot,SV);break;case 13:case 11:ue.mul(Ot,Ot,ue.rotZY90),ue.scale(Ot,Ot,_.set(ql,g,g,g/2)),wt.addPrimitive(a,Ot,Art);break;case 14:ue.mul(Ot,Ot,ue.rotZY90),ue.scale(Ot,Ot,_.set(ql,g,g,g/2)),wt.addPrimitive(a,Ot,Prt);break;case 15:ue.mul(Ot,Ot,ue.rotZY90),ue.scale(Ot,Ot,_.set(ql,g,g,g/2)),wt.addPrimitive(a,Ot,Irt);break;case 10:default:ue.mul(Ot,Ot,ue.rotZYZ90),ue.scale(Ot,Ot,_.set(ql,g/1.5,g,g/2)),wt.addPrimitive(a,Ot,Trt);break}}return wt.getMesh(a)}var Are=E(E({},Nb),{detail:I.Numeric(0,{min:0,max:3,step:1},Et.CustomQualityParamInfo),sizeFactor:I.Numeric(1.75,{min:0,max:10,step:.01})});function Drt(e){return xv({defaultProps:I.getDefaultValues(Are),createGeometry:Mrt,createLocationIterator:Rrt,getLoci:krt,eachLocation:Ort,setUpdateState:function(t,r,n){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.detail!==n.detail}},e)}function Rrt(e){var t=e.carbohydrates.elements,r=t.length*2,n=1,i=Ze.create(e);function a(s,u){var l=t[Math.floor(s/2)],c=l.unit.rings.all[l.ringIndex];return i.unit=l.unit,i.element=l.unit.elements[c[0]],i}function o(s,u){return s%2===1}return mn(r,n,1,a,!0,o)}function krt(e,t,r){var n=e.objectId,i=e.groupId;if(r===n){var a=t.carbohydrates.elements[Math.floor(i/2)];return nb(t,a.unit,a.residueIndex,a.altId)}return Or}function Ort(e,t,r){var n=t.carbohydrates.getElementIndices,i=!1;if(!De.is(e)||!$e.areEquivalent(e.structure,t))return!1;for(var a=function(d,f){if(!Ue.isAtomic(d))return"continue";Oe.forEach(f,function(h){for(var v=n(d,d.elements[h]),p=0,m=v.length;p<m;++p)r(Te.ofSingleton(v[p]*2))&&(i=!0)})},o=0,s=e.elements;o<s.length;o++){var u=s[o],l=u.unit,c=u.indices;a(l,c)}return i}function Lrt(e,t,r,n,i){var a=t.carbohydrates,o=a.terminalLinks,s=a.elements,u=n.terminalLinkSizeFactor,l=Ze.create(t),c={linkCount:o.length,position:function(d,f,h){var v=o[h];v.fromCarbohydrate?(_.copy(d,s[v.carbohydrateIndex].geometry.center),v.elementUnit.conformation.position(v.elementUnit.elements[v.elementIndex],f)):(v.elementUnit.conformation.position(v.elementUnit.elements[v.elementIndex],d),_.copy(f,s[v.carbohydrateIndex].geometry.center))},radius:function(d){var f=o[d];if(f.fromCarbohydrate){var h=s[f.carbohydrateIndex],v=h.unit.rings.all[h.ringIndex];l.unit=h.unit,l.element=h.unit.elements[v[0]]}else l.unit=f.elementUnit,l.element=f.elementUnit.elements[f.elementIndex];return r.size.size(l)*u},style:function(d){var f=o[d],h=f.elementUnit.elements[f.elementIndex],v=wg(f.elementUnit.model.atomicHierarchy.atoms.type_symbol.value(h));return Q1.has(v)?1:0}};return _v(e,c,n,i)}var Pre=E(E(E({},ga),Cv),{terminalLinkSizeFactor:I.Numeric(.2,{min:0,max:3,step:.01})});function Nrt(e){return xv({defaultProps:I.getDefaultValues(Pre),createGeometry:Lrt,createLocationIterator:Frt,getLoci:Brt,eachLocation:Urt,setUpdateState:function(t,r,n){t.createGeometry=r.terminalLinkSizeFactor!==n.terminalLinkSizeFactor||r.radialSegments!==n.radialSegments||r.linkCap!==n.linkCap}},e)}function Frt(e){var t=e.carbohydrates,r=t.elements,n=t.terminalLinks,i=n.length,a=1,o=Ze.create(e),s=function(u){var l=n[u];if(l.fromCarbohydrate){var c=r[l.carbohydrateIndex],d=c.unit.rings.all[c.ringIndex];o.unit=c.unit,o.element=c.unit.elements[d[0]]}else o.unit=l.elementUnit,o.element=l.elementUnit.elements[l.elementIndex];return o};return mn(i,a,1,s,!0)}function Brt(e,t,r){var n=e.objectId,i=e.groupId;if(r===n){var a=t.carbohydrates,o=a.terminalLinks,s=a.elements,u=o[i],l=s[u.carbohydrateIndex];return De.union(nb(t,l.unit,l.residueIndex,l.altId),NHe(t,u.elementUnit,u.elementUnit.elements[u.elementIndex]))}return Or}function Urt(e,t,r){var n=!1;if(!De.is(e)||!$e.areEquivalent(e.structure,t))return!1;for(var i=t.carbohydrates.getTerminalLinkIndices,a=function(d,f){if(!Ue.isAtomic(d))return"continue";Oe.forEach(f,function(h){for(var v=i(d,d.elements[h]),p=0,m=v.length;p<m;++p)r(Te.ofSingleton(v[p]))&&(n=!0)})},o=0,s=e.elements;o<s.length;o++){var u=s[o],l=u.unit,c=u.indices;a(l,c)}return n}var Tre={"carbohydrate-symbol":function(e,t){return Su("Carbohydrate symbol mesh",e,t,Drt)},"carbohydrate-link":function(e,t){return Su("Carbohydrate link cylinder",e,t,srt)},"carbohydrate-terminal-link":function(e,t){return Su("Carbohydrate terminal link cylinder",e,t,Nrt)}},Ire=E(E(E(E({},Are),wre),Pre),{visuals:I.MultiSelect(["carbohydrate-symbol","carbohydrate-link","carbohydrate-terminal-link"],I.objectToOptions(Tre))});function jrt(e,t){return I.clone(Ire)}function zrt(e,t){return or.createMulti("Carbohydrate",e,t,Ri,Tre)}var Vrt={name:"carbohydrate",label:"Carbohydrate",description:"Displays carbohydrate symbols (3D SNFG).",factory:zrt,getParams:jrt,defaultValues:I.getDefaultValues(Ire),defaultColorTheme:{name:"carbohydrate-symbol"},defaultSizeTheme:{name:"uniform"},isApplicable:function(e){return e.models.some(function(t){return Wt.hasCarbohydrate(t)})}};function Mre(e,t){switch(e.kind){case 0:return Hrt(e,t);case 1:case 2:return Grt(e,t)}}function Hrt(e,t){for(var r=e.model.atomicRanges.cyclicPolymerMap,n=Qr.transientSegments(Wb(e),e.elements),i=nr.transientSegments(e.model.atomicHierarchy.residueAtomSegments,e.elements),a=e.model.atomicHierarchy.derived.residue.traceElementIndex,o=e.model.atomicHierarchy.derived.residue.moleculeType,s=-1,u=-1,l=!0,c=-1,d=0;n.hasNext;){for(l=!0,c=d,i.setSegment(n.move());i.hasNext;){if(l){var f=i.move().index;if(++d,!i.hasNext)continue;l=!1,u=f}var h=i.move().index;s=u,u=h,t(a[s],a[u],d-1,d,o[s]),++d}r.has(u)&&(s=u,u=r.get(s),t(a[s],a[u],d-1,c,o[s]))}}function Grt(e,t){for(var r=Qr.transientSegments(Wb(e),e.elements),n=e.elements,i=!0,a=0;r.hasNext;){i=!0;for(var o=r.move(),s=o.start,u=o.end,l=s,c=u;l<c;++l){if(i){if(++l,++a,l>c)continue;i=!1}t(n[l-1],n[l],a-1,a,0),++a}}}function Dre(e,t){switch(e.kind){case 0:return qrt(e,t);case 1:case 2:return Wrt(e,t)}}function qrt(e,t){for(var r=Qr.transientSegments(Wb(e),e.elements),n=nr.transientSegments(e.model.atomicHierarchy.residueAtomSegments,e.elements),i=e.model.atomicHierarchy.derived.residue.traceElementIndex,a=0;r.hasNext;)for(n.setSegment(r.move());n.hasNext;){var o=n.move().index;t(i[o],a),++a}}function Wrt(e,t){for(var r=Qr.transientSegments(Wb(e),e.elements),n=e.elements,i=0;r.hasNext;)for(var a=r.move(),o=a.start,s=a.end,u=o,l=s;u<l;++u)t(n[u],i),++i}function $rt(e,t){switch(t.kind){case 0:return new Xrt(e,t);case 1:case 2:return new Yrt(e,t)}}function Rre(e,t){return{centerA:Ze.create(e,t),centerB:Ze.create(e,t)}}var Xrt=function(){function e(t,r){this.unit=r,this.hasNext=!1,this.traceElementIndex=r.model.atomicHierarchy.derived.residue.traceElementIndex,this.gapIt=Qr.transientSegments(Lre(r),r.elements),this.value=Rre(t,r),this.hasNext=this.gapIt.hasNext}return e.prototype.move=function(){var t=this.unit,r=t.elements,n=t.residueIndex,i=this.gapIt.move();return this.value.centerA.element=this.traceElementIndex[n[r[i.start]]],this.value.centerB.element=this.traceElementIndex[n[r[i.end-1]]],this.hasNext=this.gapIt.hasNext,this.value},e}(),Yrt=function(){function e(t,r){this.unit=r,this.hasNext=!1,this.gapIt=Qr.transientSegments(Lre(r),r.elements),this.value=Rre(t,r),this.hasNext=this.gapIt.hasNext}return e.prototype.move=function(){var t=this.gapIt.move();return this.value.centerA.element=this.unit.elements[t.start],this.value.centerB.element=this.unit.elements[t.end-1],this.hasNext=this.gapIt.hasNext,this.value},e}();function Krt(e){for(var t=e.atomicConformation,r=t.x,n=t.y,i=t.z,a=e.atomicHierarchy.derived.residue,o=a.polymerType,s=a.traceElementIndex,u=o.length,l=Oe.ofBounds(0,e.atomicConformation.atomId.rowCount),c=Qr.transientSegments(e.atomicRanges.polymerRanges,l),d=nr.transientSegments(e.atomicHierarchy.residueAtomSegments,l),f=new Float32Array(u*3),h=new Float32Array(u*3),v=0,p=-1,m=-1,g=_(),y=_(),b=_(),S=_(),x=_(),C=_(),w=_(),A=_(),M=_(),D=_(),k=_(),R=_(),L=_(),H=_();c.hasNext;){var B=c.move();for(d.setSegment(B),v=-1,m=-1;d.hasNext;){v+=1;var j=d.move().index;v===0&&(m=j),p=j-2;var Q=p*3;_.copy(g,y),_.copy(y,b),_.copy(b,S);var G=s[j];if(_.set(S,r[G],n[G],i[G]),!(v<3)){_.sub(x,y,g),_.sub(C,b,y),_.sub(w,S,b),_.sub(k,x,C),_.sub(R,C,w),_.cross(L,k,R),_.normalize(L,L),_.toArray(L,h,Q);var W=Math.cos(_.angle(k,R)),q=_.magnitude(k),ee=_.magnitude(R),he=Math.sqrt(ee*q)/Math.max(2,2*(1-W));_.scale(A,k,he/q),_.sub(A,y,A),_.toArray(A,f,Q),_.scale(M,R,he/ee),_.sub(M,b,M),_.toArray(M,f,Q+3),_.copy(H,L)}}var $=m*3;_.fromArray(A,f,$+3),_.fromArray(M,f,$+6),_.normalize(L,_.sub(L,A,M));var X=s[m];_.set(g,r[X],n[X],i[X]),_.copy(D,g),_.projectPointOnVector(D,D,L,A),_.toArray(D,f,$);var U=p+2,z=U*3;_.fromArray(A,f,z-3),_.fromArray(M,f,z-6),_.normalize(L,_.sub(L,A,M));var J=s[U];_.set(g,r[J],n[J],i[J]),_.copy(D,g),_.projectPointOnVector(D,D,L,A),_.toArray(D,f,z)}return{centers:f}}var yD=Yp.createProvider({label:"Helix Orientation",descriptor:yo({name:"molstar_helix_orientation"}),type:"dynamic",defaultParams:{},getParams:function(){return{}},isApplicable:function(e){return!0},obtain:function(e,t){return ce(void 0,void 0,void 0,function(){return de(this,function(r){return[2,{value:Krt(t)}]})})}});function Qs(e){return Lr.is(e,2)}function Qrt(e){return Lr.is(e,4)}function BL(e,t,r){switch(r===void 0&&(r={}),e.kind){case 0:return new Zrt(e,t,r);case 1:case 2:return new Jrt(e,t)}}var CS=Lr.create(536870912);function kre(e,t){return{center:Ze.create(e,t),centerPrev:Ze.create(e,t),centerNext:Ze.create(e,t),first:!1,last:!1,initial:!1,final:!1,secStrucFirst:!1,secStrucLast:!1,secStrucType:CS,moleculeType:0,coarseBackboneFirst:!1,coarseBackboneLast:!1,isCoarseBackbone:!1,p0:_(),p1:_(),p2:_(),p3:_(),p4:_(),d12:_(),d23:_()}}var Kt=_(),Cx=_(),_x=_(),Zrt=function(){function e(t,r,n){n===void 0&&(n={});var i;if(this.unit=t,this.state=0,this.p0=_(),this.p1=_(),this.p2=_(),this.p3=_(),this.p4=_(),this.p5=_(),this.p6=_(),this.d01=_(),this.d12=_(),this.d23=_(),this.d34=_(),this.hasNext=!1,this.atomicConformation=t.model.atomicConformation,this.residueAtomSegments=t.model.atomicHierarchy.residueAtomSegments,this.polymerRanges=t.model.atomicRanges.polymerRanges,this.traceElementIndex=t.model.atomicHierarchy.derived.residue.traceElementIndex,this.directionFromElementIndex=t.model.atomicHierarchy.derived.residue.directionFromElementIndex,this.directionToElementIndex=t.model.atomicHierarchy.derived.residue.directionToElementIndex,this.moleculeType=t.model.atomicHierarchy.derived.residue.moleculeType,this.cyclicPolymerMap=t.model.atomicRanges.cyclicPolymerMap,this.polymerIt=Qr.transientSegments(this.polymerRanges,t.elements),this.residueIt=nr.transientSegments(this.residueAtomSegments,t.elements),this.value=kre(r,t),this.hasNext=this.residueIt.hasNext&&this.polymerIt.hasNext,n.ignoreSecondaryStructure||(this.secondaryStructure=(i=Al.get(r).value)===null||i===void 0?void 0:i.get(t.invariantId)),n.useHelixOrientation){var a=yD.get(t.model).value;if(!a)throw new Error("missing helix-orientation");this.helixOrientationCenters=a.centers}}return e.prototype.atomicPos=function(t,r){r!==-1&&(t[0]=this.atomicConformation.x[r],t[1]=this.atomicConformation.y[r],t[2]=this.atomicConformation.z[r])},e.prototype.pos=function(t,r,n){var i=this.traceElementIndex[r];this.helixOrientationCenters&&Qs(n)?_.fromArray(t,this.helixOrientationCenters,r*3):this.atomicPos(t,i)},e.prototype.updateResidueSegmentRange=function(t){var r=this.residueAtomSegments.index;this.residueSegmentMin=r[this.polymerRanges[t.index*2]],this.residueSegmentMax=r[this.polymerRanges[t.index*2+1]]},e.prototype.getResidueIndex=function(t){if(t<this.residueSegmentMin){var r=this.cyclicPolymerMap.get(this.residueSegmentMin);r!==void 0?t=r-(this.residueSegmentMin-t-1):t=this.residueSegmentMin}else if(t>this.residueSegmentMax){var r=this.cyclicPolymerMap.get(this.residueSegmentMax);r!==void 0?t=r+(t-this.residueSegmentMax-1):t=this.residueSegmentMax}return t},e.prototype.getSecStruc=function(t){if(this.secondaryStructure){var r=this.secondaryStructure,n=r.type,i=r.getIndex,a=n[i(t)];return Qs(a)?2:a}else return CS},e.prototype.setControlPoint=function(t,r,n,i,a){Qrt(a)||this.helixOrientationCenters&&Qs(a)?_.scale(t,_.add(t,r,_.add(t,i,_.add(t,n,n))),1/4):_.copy(t,n)},e.prototype.setFromToVector=function(t,r,n){this.value.isCoarseBackbone||this.helixOrientationCenters&&Qs(n)?_.set(t,1,0,0):(this.atomicPos(Cx,this.directionFromElementIndex[r]),this.atomicPos(_x,this.directionToElementIndex[r]),_.sub(t,_x,Cx))},e.prototype.setDirection=function(t,r,n,i){_.matchDirection(Cx,r,n),_.matchDirection(_x,i,n),_.scale(t,_.add(t,Cx,_.add(t,_x,_.add(t,n,n))),1/4)},e.prototype.move=function(){var t=this,r=t.residueIt,n=t.polymerIt,i=t.value;if(this.state===0){for(;n.hasNext;)if(this.polymerSegment=n.move(),r.setSegment(this.polymerSegment),this.updateResidueSegmentRange(this.polymerSegment),r.hasNext){this.state=1;var a=this.residueAtomSegments.index[this.unit.elements[this.polymerSegment.start]],o=this.getResidueIndex(a-1);this.currSecStrucType=a===o?CS:this.getSecStruc(o),this.nextSecStrucType=this.getSecStruc(a),this.currCoarseBackbone=this.directionFromElementIndex[o]===-1||this.directionToElementIndex[o]===-1,this.nextCoarseBackbone=this.directionFromElementIndex[a]===-1||this.directionToElementIndex[a]===-1;break}}if(this.state===1){var s=r.move().index,u=this.getResidueIndex(s-3),l=this.getResidueIndex(s-2),c=this.getResidueIndex(s-1),d=this.getResidueIndex(s+1),f=this.getResidueIndex(s+2),h=this.getResidueIndex(s+3);this.prevSecStrucType=this.currSecStrucType,this.currSecStrucType=this.nextSecStrucType,this.nextSecStrucType=s===d?CS:this.getSecStruc(d),this.prevCoarseBackbone=this.currCoarseBackbone,this.currCoarseBackbone=this.nextCoarseBackbone,this.nextCoarseBackbone=this.directionFromElementIndex[d]===-1||this.directionToElementIndex[d]===-1,i.secStrucType=this.currSecStrucType,i.secStrucFirst=this.prevSecStrucType!==this.currSecStrucType,i.secStrucLast=this.currSecStrucType!==this.nextSecStrucType,i.isCoarseBackbone=this.currCoarseBackbone,i.coarseBackboneFirst=this.prevCoarseBackbone!==this.currCoarseBackbone,i.coarseBackboneLast=this.currCoarseBackbone!==this.nextCoarseBackbone,i.first=s===this.residueSegmentMin,i.last=s===this.residueSegmentMax,i.moleculeType=this.moleculeType[s],i.initial=s===c,i.final=s===d,i.centerPrev.element=this.traceElementIndex[c],i.center.element=this.traceElementIndex[s],i.centerNext.element=this.traceElementIndex[d];var v=this.getSecStruc(u),p=this.getSecStruc(l),m=this.getSecStruc(c),g=this.getSecStruc(s),y=this.getSecStruc(d),b=this.getSecStruc(f),S=this.getSecStruc(h);this.pos(this.p0,u,v),this.pos(this.p1,l,p),this.pos(this.p2,c,m),this.pos(this.p3,s,g),this.pos(this.p4,d,y),this.pos(this.p5,f,b),this.pos(this.p6,h,S);var x=Qs(v),C=Qs(p),w=Qs(m),A=Qs(g),M=Qs(y),D=Qs(b),k=Qs(S);this.helixOrientationCenters&&(A!==w?A?(_.copy(this.p0,this.p3),_.copy(this.p1,this.p3),_.copy(this.p2,this.p3)):w&&(_.scale(Kt,_.sub(Kt,this.p2,this.p3),2),_.add(this.p2,this.p3,Kt),_.add(this.p1,this.p2,Kt),_.add(this.p0,this.p1,Kt)):A!==C?A?(_.copy(this.p0,this.p2),_.copy(this.p1,this.p2)):C&&(_.scale(Kt,_.sub(Kt,this.p1,this.p2),2),_.add(this.p1,this.p2,Kt),_.add(this.p0,this.p1,Kt)):A!==x&&(A?_.copy(this.p0,this.p1):x&&(_.scale(Kt,_.sub(Kt,this.p0,this.p1),2),_.add(this.p0,this.p1,Kt))),A!==M?A?(_.copy(this.p4,this.p3),_.copy(this.p5,this.p3),_.copy(this.p6,this.p3)):M&&(_.scale(Kt,_.sub(Kt,this.p4,this.p3),2),_.add(this.p4,this.p3,Kt),_.add(this.p5,this.p4,Kt),_.add(this.p6,this.p5,Kt)):A!==D?A?(_.copy(this.p5,this.p4),_.copy(this.p6,this.p4)):D&&(_.scale(Kt,_.sub(Kt,this.p5,this.p4),2),_.add(this.p5,this.p4,Kt),_.add(this.p6,this.p5,Kt)):A!==k&&(A?_.copy(this.p6,this.p5):k&&(_.scale(Kt,_.sub(Kt,this.p6,this.p5),2),_.add(this.p6,this.p5,Kt)))),this.setFromToVector(this.d01,c,m),this.setFromToVector(this.d12,s,g),this.setFromToVector(this.d23,d,y),this.setFromToVector(this.d34,f,b);var R=A&&this.helixOrientationCenters,L=1.5;s===c||g!==m&&R?(_.setMagnitude(Kt,_.sub(Kt,this.p3,this.p4),L),_.add(this.p2,this.p3,Kt),_.add(this.p1,this.p2,Kt),_.add(this.p0,this.p1,Kt)):c===l||g!==p&&R?(_.setMagnitude(Kt,_.sub(Kt,this.p2,this.p3),L),_.add(this.p1,this.p2,Kt),_.add(this.p0,this.p1,Kt)):(l===u||g!==v&&R)&&(_.setMagnitude(Kt,_.sub(Kt,this.p1,this.p2),L),_.add(this.p0,this.p1,Kt)),s===d||g!==y&&R?(_.setMagnitude(Kt,_.sub(Kt,this.p3,this.p2),L),_.add(this.p4,this.p3,Kt),_.add(this.p5,this.p4,Kt),_.add(this.p6,this.p5,Kt)):d===f||g!==b&&R?(_.setMagnitude(Kt,_.sub(Kt,this.p4,this.p3),L),_.add(this.p5,this.p4,Kt),_.add(this.p6,this.p5,Kt)):(f===h||g!==S&&R)&&(_.setMagnitude(Kt,_.sub(Kt,this.p5,this.p4),L),_.add(this.p6,this.p5,Kt)),this.setControlPoint(i.p0,this.p0,this.p1,this.p2,p),this.setControlPoint(i.p1,this.p1,this.p2,this.p3,m),this.setControlPoint(i.p2,this.p2,this.p3,this.p4,g),this.setControlPoint(i.p3,this.p3,this.p4,this.p5,y),this.setControlPoint(i.p4,this.p4,this.p5,this.p6,b),this.setDirection(i.d12,this.d01,this.d12,this.d23),this.setDirection(i.d23,this.d12,this.d23,this.d34),r.hasNext||(this.state=0)}return this.hasNext=r.hasNext||n.hasNext,this.value},e}(),Jrt=function(){function e(t,r){switch(this.unit=t,this.state=0,this.hasNext=!1,this.polymerIt=Qr.transientSegments(Wb(t),t.elements),this.value=kre(r,t),_.set(this.value.d12,1,0,0),_.set(this.value.d23,1,0,0),t.kind){case 1:this.conformation=t.model.coarseConformation.spheres;break;case 2:this.conformation=t.model.coarseConformation.gaussians;break}this.hasNext=this.polymerIt.hasNext}return e.prototype.getElementIndex=function(t){return Math.min(Math.max(this.polymerSegment.start,t),this.polymerSegment.end-1)},e.prototype.pos=function(t,r){var n=this.unit.elements[r];t[0]=this.conformation.x[n],t[1]=this.conformation.y[n],t[2]=this.conformation.z[n]},e.prototype.move=function(){if(this.state===0){for(;this.polymerIt.hasNext;)if(this.polymerSegment=this.polymerIt.move(),this.elementIndex=this.polymerSegment.start,this.elementIndex<this.polymerSegment.end){this.state=1;break}}if(this.state===1){var t=this.getElementIndex(this.elementIndex-2),r=this.getElementIndex(this.elementIndex-1),n=this.getElementIndex(this.elementIndex+1),i=this.getElementIndex(this.elementIndex+2);this.value.centerPrev.element=this.value.center.unit.elements[r],this.value.center.element=this.value.center.unit.elements[this.elementIndex],this.value.centerNext.element=this.value.center.unit.elements[n],this.pos(this.value.p0,t),this.pos(this.value.p1,r),this.pos(this.value.p2,this.elementIndex),this.pos(this.value.p3,n),this.pos(this.value.p4,i);var a=.5;this.elementIndex===r?(_.scale(Kt,_.sub(Kt,this.value.p2,this.value.p3),a),_.add(this.value.p1,this.value.p2,Kt),_.add(this.value.p0,this.value.p1,Kt)):r===t&&(_.scale(Kt,_.sub(Kt,this.value.p1,this.value.p2),a),_.add(this.value.p0,this.value.p1,Kt)),this.elementIndex===n?(_.scale(Kt,_.sub(Kt,this.value.p2,this.value.p1),a),_.add(this.value.p3,this.value.p2,Kt),_.add(this.value.p4,this.value.p3,Kt)):n===i&&(_.scale(Kt,_.sub(Kt,this.value.p3,this.value.p2),a),_.add(this.value.p4,this.value.p3,Kt)),this.value.first=this.elementIndex===this.polymerSegment.start,this.value.last=this.elementIndex===this.polymerSegment.end-1,this.elementIndex+1>=this.polymerSegment.end&&(this.state=0)}return this.hasNext=this.elementIndex+1<this.polymerSegment.end||this.polymerIt.hasNext,this.elementIndex+=1,this.value},e}(),Mh=_.fromArray,Dm=_.toArray,bD=_.normalize,ent=_.sub,tm=_.spline,tnt=_.slerp,CV=_.copy,_V=_.cross,WT=_.orthogonalize,rnt=_.matchDirection,nnt=_.scale,wV=_.add;function UL(e){var t=e+1,r=t*3;return{curvePoints:new Float32Array(r),tangentVectors:new Float32Array(r),normalVectors:new Float32Array(r),binormalVectors:new Float32Array(r),widthValues:new Float32Array(t),heightValues:new Float32Array(t),linearSegments:e}}function jL(e,t,r,n){int(e,t,r,n),ont(e,t)}var $T=_(),XT=_(),YT=_();function int(e,t,r,n){for(var i=e.curvePoints,a=e.tangentVectors,o=e.linearSegments,s=t.p0,u=t.p1,l=t.p2,c=t.p3,d=t.p4,f=t.secStrucFirst,h=t.secStrucLast,v=1-n,p=f?.5:r,m=h?.5:r,g=0;g<=o;++g){var y=g*1/o;if(y<v){var b=Bo(p,r,y);tm(YT,s,u,l,c,y+n,b),tm($T,s,u,l,c,y+n+.01,p),tm(XT,s,u,l,c,y+n-.01,p)}else{var b=Bo(r,m,y);tm(YT,u,l,c,d,y-v,b),tm($T,u,l,c,d,y-v+.01,b),tm(XT,u,l,c,d,y-v-.01,b)}Dm(YT,i,g*3),bD(uf,ent(uf,$T,XT)),Dm(uf,a,g*3)}}var ant=_(),uf=_(),Zs=_(),rm=_(),X0=_(),EV=_(),AV=_(),PV=_(),KT=_(),wx=_();function ont(e,t){var r=e.curvePoints,n=e.tangentVectors,i=e.normalVectors,a=e.binormalVectors,o=t.d12,s=t.d23,u=r.length/3;Mh(AV,n,0),Mh(PV,n,(u-1)*3),WT(KT,AV,o),WT(wx,PV,s),rnt(wx,wx,KT),CV(X0,KT);for(var l=u-1,c=0;c<u;++c){var d=oY(0,l,c)*l,f=c===0?0:1/(u-d);Mh(uf,n,c*3),WT(Zs,uf,tnt(ant,X0,wx,f)),Dm(Zs,i,c*3),CV(X0,Zs),bD(rm,_V(rm,uf,Zs)),Dm(rm,a,c*3)}for(var c=1;c<l;++c)Mh(X0,i,(c-1)*3),Mh(Zs,i,c*3),Mh(EV,i,(c+1)*3),nnt(Zs,wV(Zs,X0,wV(Zs,EV,Zs)),1/3),Dm(Zs,i,c*3),Mh(uf,n,c*3),bD(rm,_V(rm,uf,Zs)),Dm(rm,a,c*3)}function xD(e,t,r,n,i,a,o,s){for(var u=e.widthValues,l=e.heightValues,c=e.linearSegments,d=1-s,f=0;f<=c;++f){var h=f*1/c;h<d?(u[f]=Bo(t,r,h+s),l[f]=Bo(i,a,h+s)):(u[f]=Bo(r,n,h-d),l[f]=Bo(a,o,h-d))}}var Ore=.5,snt=.9,mE=.5,gE=.3,Y_=2;function Wb(e){switch(e.kind){case 0:return e.model.atomicRanges.polymerRanges;case 1:return e.model.coarseHierarchy.spheres.polymerRanges;case 2:return e.model.coarseHierarchy.gaussians.polymerRanges}}function Lre(e){switch(e.kind){case 0:return e.model.atomicRanges.gapRanges;case 1:return e.model.coarseHierarchy.spheres.gapRanges;case 2:return e.model.coarseHierarchy.gaussians.gapRanges}}var Xc;(function(e){function t(r){var n=r.group,i=r.structure,a=n.units[0].polymerElements,o=a.length,s=n.units.length,u=Ze.create(i),l=function(c,d){var f=n.units[d];return u.unit=f,u.element=a[c],u};return mn(o,s,1,l)}e.fromGroup=t})(Xc||(Xc={}));var SD;(function(e){function t(r){var n=r.group,i=r.structure,a=n.units[0].gapElements,o=a.length,s=n.units.length,u=Ze.create(i),l=function(c,d){var f=n.units[d];return u.unit=f,u.element=a[c],u};return mn(o,s,1,l)}e.fromGroup=t})(SD||(SD={}));function Pv(e,t,r){var n=e.objectId,i=e.instanceId,a=e.groupId;if(r===n){var o=t.structure,s=t.group,u=s.units[i];if(Ue.isAtomic(u))return QJ(o,u,u.polymerElements[a]);var l=u.elements,c=u.polymerElements[a],d=Oe.indexOf(l,c);if(d!==-1){var f=Oe.ofSingleton(d);return De(o,[{unit:u,indices:f}])}}return Or}function TV(e,t,r,n,i,a){for(var o=-1,s=-1,u=i;u<=a;u++){var l=r[u];if(!(l<0)&&(o=Oe.indexOf(t,l),o>=0)){s=u;break}}if(o<0)return!1;for(var c=o,u=a;u>s;u--){var l=r[u];if(!(l<0)){var d=Oe.indexOf(t,l);if(d>=0){c=d;break}}}return n(Te.ofRange(e+o,e+c))}function Nre(e,t,r,n,i){var a=!1,o=i.unit.elements,s=i.unit.model.atomicHierarchy.derived.residue.traceElementIndex,u=i.unit.model.atomicHierarchy.residueAtomSegments.index,l=r(i.unit);if(Te.is(i.indices))if(Te.start(i.indices)===0&&Te.end(i.indices)===i.unit.elements.length)a=n(Te.ofBounds(e,e+t))||a;else{var c=u[o[Te.min(i.indices)]],d=u[o[Te.max(i.indices)]];a=TV(e,l,s,n,c,d)||a}else for(var f=i.indices,h=0,v=f.length;h<v;h++){for(var c=u[o[f[h]]],d=c,p=h+1;p<v;){var m=u[o[f[p]]];if(m-d>1)break;d=m,p++}h=p-1,a=TV(e,l,s,n,c,d)||a}return a}function unt(e){return e.polymerElements}function Tv(e,t,r){var n=!1;if(!De.is(e))return!1;var i=t.structure,a=t.group;if(!$e.areEquivalent(e.structure,i))return!1;for(var o=a.units[0].polymerElements.length,s=0,u=e.elements;s<u.length;s++){var l=u[s];if(a.unitIndexMap.has(l.unit.id)){var c=a.unitIndexMap.get(l.unit.id)*o;if(Ue.isAtomic(l.unit))n=Nre(c,o,unt,r,l)||n;else if(Te.is(l.indices)){var d=c+Te.start(l.indices),f=c+Te.end(l.indices);n=r(Te.ofBounds(d,f))||n}else for(var h=0,v=l.indices.length;h<v;h++){for(var d=l.indices[h],p=h+1;p<v&&l.indices[p]===d;)p++;h=p-1;var f=l.indices[h];n=r(Te.ofRange(c+d,c+f))||n}}}return n}function lnt(e,t,r){var n=e.objectId,i=e.instanceId,a=e.groupId;if(r===n){var o=t.structure,s=t.group,u=s.units[i],l=Oe.indexOf(u.elements,u.gapElements[a]),c=Oe.indexOf(u.elements,u.gapElements[a%2?a-1:a+1]);if(l!==-1&&c!==-1)return Vt.Loci(o,[Vt.Location(o,u,l,o,u,c),Vt.Location(o,u,c,o,u,l)])}return Or}function cnt(e,t,r){var n=!1;if(Vt.isLoci(e)){var i=t.structure,a=t.group;if(!$e.areRootsEquivalent(e.structure,i))return!1;e=Vt.remapLoci(e,i);for(var o=a.units[0].gapElements.length,s=0,u=e.bonds;s<u.length;s++){var l=u[s],c=a.unitIndexMap.get(l.aUnit.id);if(c!==void 0){var d=Oe.indexOf(l.aUnit.gapElements,l.aUnit.elements[l.aIndex]),f=Oe.indexOf(l.bUnit.gapElements,l.bUnit.elements[l.bIndex]);d!==-1&&f!==-1&&r(Te.ofSingleton(c*o+d))&&(n=!0)}}}else if(De.is(e)){var i=t.structure,a=t.group;if(!$e.areRootsEquivalent(e.structure,i))return!1;e=De.remap(e,i);for(var h=a.units[0].gapElements.length,v=function(S){var x=a.unitIndexMap.get(S.unit.id);x!==void 0&&Oe.forEach(S.indices,function(C){var w=Oe.indexOf(S.unit.gapElements,S.unit.elements[C]);w!==-1&&r(Te.ofSingleton(x*h+w))&&(n=!0)})},p=0,m=e.elements;p<m.length;p++){var g=m[p];v(g)}}return n}var K_;(function(e){function t(r){var n=r.group,i=r.structure,a=n.units[0],o=Ue.isAtomic(a)?a.nucleotideElements:[],s=o.length,u=n.units.length,l=Ze.create(i),c=function(d,f){var h=n.units[f];return l.unit=h,l.element=o[d],l};return mn(s,u,1,c)}e.fromGroup=t})(K_||(K_={}));function Fre(e,t,r){var n=e.objectId,i=e.instanceId,a=e.groupId;if(r===n){var o=t.structure,s=t.group,u=s.units[i];if(Ue.isAtomic(u))return QJ(o,u,u.nucleotideElements[a])}return Or}function dnt(e){return e.nucleotideElements}function Bre(e,t,r){var n=!1;if(!De.is(e))return!1;var i=t.structure,a=t.group;if(!$e.areEquivalent(e.structure,i))return!1;var o=a.units[0];if(!Ue.isAtomic(o))return!1;for(var s=o.nucleotideElements,u=s.length,l=0,c=e.elements;l<c.length;l++){var d=c[l];if(Ue.isAtomic(d.unit)&&a.unitIndexMap.has(d.unit.id)){var f=a.unitIndexMap.get(d.unit.id)*u;Ue.isAtomic(d.unit)&&(n=Nre(f,u,dnt,r,d)||n)}}return n}var Y0=_.zero(),Ex=_.zero(),IV=_.zero(),MV=_.zero(),DV=_.zero(),RV=_.zero(),Ax=_.zero(),QT=_.zero(),ZT=_.zero(),kV=_.zero(),K0=ue.identity(),fnt=_.zero(),OV=PO(),Ure={sizeFactor:I.Numeric(.2,{min:0,max:10,step:.01}),radialSegments:I.Numeric(16,{min:2,max:56,step:2},Et.CustomQualityParamInfo)};I.getDefaultValues(Ure);function hnt(e,t,r,n,i,a){if(!Ue.isAtomic(t))return Nt.createEmpty(a);var o=t.nucleotideElements.length;if(!o)return Nt.createEmpty(a);for(var s=i.sizeFactor,u=i.radialSegments,l=o*(OV.vertices.length/3+u*2),c=wt.createState(l,l/4,a),d=t.elements,f=t.model,h=f.atomicHierarchy,v=h.chainAtomSegments,p=h.residueAtomSegments,m=h.atoms,g=h.index,y=f.atomicHierarchy.derived.residue,b=y.moleculeType,S=y.traceElementIndex,x=m.label_comp_id,C=t.conformation.invariantPosition,w=nr.transientSegments(v,d),A=nr.transientSegments(p,d),M={radiusTop:1*s,radiusBottom:1*s,radialSegments:u,bottomCap:!0},D=0;w.hasNext;)for(A.setSegment(w.move());A.hasNext;){var k=A.move().index;if(Il(b[k])){var R=x.value(p.offsets[k]),L=-1,H=-1,B=-1,j=-1,Q=-1,G=-1,W=4.5,q=4.5,ee=2.5*s,he=wK(R),$=EK(R);if(!he&&!$){var X=g.findAtomOnResidue(k,"C4"),U=g.findAtomOnResidue(k,"N9");X!==-1&&U!==-1&&_.distance(C(X,Y0),C(U,Ex))<1.6?he=!0:$=!0}he?(q=4.5,L=g.findAtomOnResidue(k,"N1"),H=g.findAtomOnResidue(k,"C4"),B=g.findAtomOnResidue(k,"C6"),j=g.findAtomOnResidue(k,"C2"),Q=g.findAtomOnResidue(k,"N9"),G=S[k]):$&&(q=3,L=g.findAtomOnResidue(k,"N3"),H=g.findAtomOnResidue(k,"C6"),B=g.findAtomOnResidue(k,"C4"),j=g.findAtomOnResidue(k,"C2"),Q=g.findAtomOnResidue(k,"N1"),Q===-1&&(Q=g.findAtomOnResidue(k,"C1")),G=S[k]),Q!==-1&&G!==-1&&(C(Q,DV),C(G,RV),c.currentGroup=D,Ma(c,DV,RV,1,M),L!==-1&&H!==-1&&B!==-1&&j!==-1&&(C(L,Y0),C(H,Ex),C(B,IV),C(j,MV),_.normalize(Ax,_.sub(Ax,Ex,Y0)),_.normalize(QT,_.sub(QT,MV,IV)),_.normalize(ZT,_.cross(ZT,Ax,QT)),ue.targetTo(K0,Y0,Ex,ZT),_.scaleAndAdd(kV,Y0,Ax,q/2-.2),ue.scale(K0,K0,_.set(fnt,W,ee,q)),ue.setTranslation(K0,kV),wt.addPrimitive(c,K0,OV))),++D}}var z=wt.getMesh(c),J=Fe.expand(Fe(),t.boundary.sphere,1*i.sizeFactor);return z.setBoundingSphere(J),z}var jre=E(E({},ga),Ure);function pnt(e){return Ja({defaultProps:I.getDefaultValues(jre),createGeometry:hnt,createLocationIterator:K_.fromGroup,getLoci:Fre,eachLocation:Bre,setUpdateState:function(t,r,n){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.radialSegments!==n.radialSegments}},e)}var Px=_.zero(),Nd=_.zero(),Tx=_.zero(),Ix=_.zero(),Dh=_.zero(),nm=_.zero(),Mx=_.zero(),LV=_.zero(),NV=_.zero(),Q0=_.zero(),Fd=_.zero(),zre={sizeFactor:I.Numeric(.2,{min:0,max:10,step:.01}),radialSegments:I.Numeric(16,{min:2,max:56,step:2},Et.CustomQualityParamInfo),detail:I.Numeric(0,{min:0,max:3,step:1},Et.CustomQualityParamInfo)};I.getDefaultValues(zre);var Dx=new Float32Array(2*9*3),vnt=new Uint32Array([0,1,2,3,4,5,6,7,16,17,14,15,12,13,8,9,10,11,0,1]),mnt=new Uint32Array([8,12,14,16,6,4,2,0,10]),gnt=new Uint32Array([9,11,1,3,5,7,17,15,13]),Rx=new Float32Array(2*6*3),ynt=new Uint32Array([0,1,2,3,4,5,6,7,8,9,10,11,0,1]),bnt=new Uint32Array([0,10,8,6,4,2]),xnt=new Uint32Array([1,3,5,7,9,11]),FV=_.zero();function BV(e,t){for(var r=[],n=2;n<arguments.length;n++)r[n-2]=arguments[n];for(var i=0,a=r.length;i<a;++i){var o=r[i];_.toArray(_.add(FV,o,t),e,i*2*3),_.toArray(_.sub(FV,o,t),e,(i*2+1)*3)}}function Snt(e,t,r,n,i,a){if(!Ue.isAtomic(t))return Nt.createEmpty(a);var o=t.nucleotideElements.length;if(!o)return Nt.createEmpty(a);for(var s=i.sizeFactor,u=i.radialSegments,l=i.detail,c=o*(26+u*2),d=wt.createState(c,c/4,a),f=t.elements,h=t.model,v=h.atomicHierarchy,p=v.chainAtomSegments,m=v.residueAtomSegments,g=v.atoms,y=v.index,b=h.atomicHierarchy.derived.residue,S=b.moleculeType,x=b.traceElementIndex,C=g.label_comp_id,w=t.conformation.invariantPosition,A=nr.transientSegments(p,f),M=nr.transientSegments(m,f),D=1*s,k=1.25*s,R={radiusTop:1*s,radiusBottom:1*s,radialSegments:u},L=0;A.hasNext;)for(M.setSegment(A.move());M.hasNext;){var H=M.move().index;if(Il(S[H])){var B=C.value(m.offsets[H]),j=-1,Q=-1,G=-1,W=-1,q=-1,ee=-1,he=-1,$=-1,X=-1,U=-1;d.currentGroup=L;var z=wK(B),J=EK(B);if(!z&&!J){var Y=y.findAtomOnResidue(H,"C4"),Z=y.findAtomOnResidue(H,"N9");Y!==-1&&Z!==-1&&_.distance(w(Y,Dh),w(Z,Q0))<1.6?z=!0:J=!0}z?(j=x[H],Q=y.findAtomOnResidue(H,"N1"),G=y.findAtomOnResidue(H,"C2"),W=y.findAtomOnResidue(H,"N3"),q=y.findAtomOnResidue(H,"C4"),ee=y.findAtomOnResidue(H,"C5"),ee===-1&&(ee=y.findAtomOnResidue(H,"N5")),he=y.findAtomOnResidue(H,"C6"),$=y.findAtomOnResidue(H,"N7"),$===-1&&($=y.findAtomOnResidue(H,"C7")),X=y.findAtomOnResidue(H,"C8"),U=y.findAtomOnResidue(H,"N9"),U!==-1&&j!==-1&&(w(U,Q0),w(j,Px),d.currentGroup=L,Ma(d,Q0,Px,1,R),Mi(d,Q0,D,l)),Q!==-1&&G!==-1&&W!==-1&&q!==-1&&ee!==-1&&he!==-1&&$!==-1&&X!==-1&&U!==-1&&(w(Q,Nd),w(G,Tx),w(W,Ix),w(q,Dh),w(ee,nm),w(he,Mx),w($,LV),w(X,NV),_.triangleNormal(Fd,Nd,Dh,nm),_.scale(Fd,Fd,k),BV(Dx,Fd,Nd,Tx,Ix,Dh,nm,Mx,LV,NV,Q0),wt.addTriangleStrip(d,Dx,vnt),wt.addTriangleFan(d,Dx,mnt),wt.addTriangleFan(d,Dx,gnt))):J&&(j=x[H],Q=y.findAtomOnResidue(H,"N1"),Q===-1&&(Q=y.findAtomOnResidue(H,"C1")),G=y.findAtomOnResidue(H,"C2"),W=y.findAtomOnResidue(H,"N3"),q=y.findAtomOnResidue(H,"C4"),ee=y.findAtomOnResidue(H,"C5"),he=y.findAtomOnResidue(H,"C6"),Q!==-1&&j!==-1&&(w(Q,Nd),w(j,Px),d.currentGroup=L,Ma(d,Nd,Px,1,R),Mi(d,Nd,D,l)),Q!==-1&&G!==-1&&W!==-1&&q!==-1&&ee!==-1&&he!==-1&&(w(G,Tx),w(W,Ix),w(q,Dh),w(ee,nm),w(he,Mx),_.triangleNormal(Fd,Nd,Dh,nm),_.scale(Fd,Fd,k),BV(Rx,Fd,Nd,Tx,Ix,Dh,nm,Mx),wt.addTriangleStrip(d,Rx,ynt),wt.addTriangleFan(d,Rx,bnt),wt.addTriangleFan(d,Rx,xnt))),++L}}var te=wt.getMesh(d),le=Fe.expand(Fe(),t.boundary.sphere,1*i.sizeFactor);return te.setBoundingSphere(le),te}var Vre=E(E({},ga),zre);function Cnt(e){return Ja({defaultProps:I.getDefaultValues(Vre),createGeometry:Snt,createLocationIterator:K_.fromGroup,getLoci:Fre,eachLocation:Bre,setUpdateState:function(t,r,n){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.radialSegments!==n.radialSegments}},e)}var Rh=_.zero(),im=_.zero(),kh=_.zero(),UV=_.zero(),xi=Ml(3,!1);function _nt(){for(var e=e0(8),t=0;t<3;++t){var r=(t+1)%3;_.set(Rh,xi[t*3],xi[t*3+1],-.5),_.set(im,xi[r*3],xi[r*3+1],-.5),_.set(kh,xi[r*3],xi[r*3+1],.5),_.set(UV,xi[t*3],xi[t*3+1],.5),e.add(Rh,im,kh),e.add(kh,UV,Rh)}return _.set(Rh,xi[0],xi[1],-.5),_.set(im,xi[3],xi[4],-.5),_.set(kh,xi[6],xi[7],-.5),e.add(kh,im,Rh),_.set(Rh,xi[0],xi[1],.5),_.set(im,xi[3],xi[4],.5),_.set(kh,xi[6],xi[7],.5),e.add(Rh,im,kh),e.getPrimitive()}var JT;function wnt(){return JT||(JT=_nt()),JT}var Oh=ue.identity(),Ent=_.zero(),jV=_.zero(),zV=_.zero(),e4=_.zero(),Ant=4,Pnt=4,Tnt=6,Int=wnt(),Hre={sizeFactor:I.Numeric(.2,{min:0,max:10,step:.01})};I.getDefaultValues(Hre);function Mnt(e,t,r,n,i,a){var o=t.polymerElements.length;if(!o)return Nt.createEmpty(a);for(var s=i.sizeFactor,u=o*24,l=wt.createState(u,u/10,a),c=1,d=UL(c),f=d.normalVectors,h=d.binormalVectors,v=0,p=BL(t,r);p.hasNext;){var m=p.move();l.currentGroup=v;var g=Il(m.moleculeType),y=Lr.is(m.secStrucType,4),b=g||y?.5:.9,S=g?.3:.5;if(jL(d,m,b,S),y&&!m.secStrucLast||!y){var x=n.size.size(m.center)*s,C=Ant*x,w=Pnt*x,A=Tnt*x,M=g?h:f;_.fromArray(jV,M,0),_.fromArray(zV,M,3),_.normalize(e4,_.add(e4,jV,zV)),ue.targetTo(Oh,m.p3,m.p1,e4),ue.mul(Oh,Oh,ue.rotY90Z180),ue.scale(Oh,Oh,_.set(Ent,A,w,C)),ue.setTranslation(Oh,m.p2),wt.addPrimitive(l,Oh,Int)}++v}var D=wt.getMesh(l),k=Fe.expand(Fe(),t.boundary.sphere,1*i.sizeFactor);return D.setBoundingSphere(k),D}var Gre=E(E({},ga),Hre);function Dnt(e){return Ja({defaultProps:I.getDefaultValues(Gre),createGeometry:Mnt,createLocationIterator:Xc.fromGroup,getLoci:Pv,eachLocation:Tv,setUpdateState:function(t,r,n){t.createGeometry=r.sizeFactor!==n.sizeFactor}},e)}var t4=10,qre={sizeFactor:I.Numeric(.2,{min:0,max:10,step:.01}),radialSegments:I.Numeric(16,{min:2,max:56,step:2},Et.CustomQualityParamInfo)};I.getDefaultValues(qre);function Rnt(e,t,r,n,i,a){var o=t.gapElements.length;if(!o)return Nt.createEmpty(a);for(var s=i.sizeFactor,u=i.radialSegments,l=t4*u*2*o*2,c=wt.createState(l,l/10,a),d=t.conformation.invariantPosition,f=_.zero(),h=_.zero(),v={radiusTop:1,radiusBottom:1,topCap:!0,bottomCap:!0,radialSegments:u},p=0,m=$rt(r,t);m.hasNext;){var g=m.move(),y=g.centerA,b=g.centerB;y.element===b.element||(d(y.element,f),d(b.element,h),v.radiusTop=v.radiusBottom=n.size.size(y)*s,c.currentGroup=p,Yy(c,f,h,.5,t4,v),v.radiusTop=v.radiusBottom=n.size.size(b)*s,c.currentGroup=p+1,Yy(c,h,f,.5,t4,v)),p+=2}var S=wt.getMesh(c),x=Fe.expand(Fe(),t.boundary.sphere,1*i.sizeFactor);return S.setBoundingSphere(x),S}var yE=E(E({},ga),qre);function zL(e){return Ja({defaultProps:I.getDefaultValues(yE),createGeometry:Rnt,createLocationIterator:SD.fromGroup,getLoci:lnt,eachLocation:cnt,setUpdateState:function(t,r,n){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.radialSegments!==n.radialSegments}},e)}var Ir=_(),Gr=_(),knt=_(),ko=_(),Zu=_(),kx=_(),Ox=_(),Z0=_(),ou=_(),lp=_(),r4=_(),Bd=_(),Ud=_(),jd=_(),zd=_(),ys=_.fromArray,tg=_.scale,xs=_.add,ic=_.sub,Ont=_.magnitude,VV=_.negate,CD=_.copy,Wre=_.cross,Lnt=_.set,cn=qe.add3,Nnt=qe.add;function Lx(e,t,r,n,i,a,o,s){var u=t.vertices,l=t.normals,c=t.indices,d=u.elementCount;ys(Ir,n,e),tg(Ox,Ir,o),tg(kx,Ir,s),ys(Gr,i,e),tg(ko,Gr,a),Wre(lp,Gr,Ir),ys(ou,r,e),xs(Bd,xs(Bd,ou,ko),kx),ic(Ud,xs(Ud,ou,ko),Ox),ic(jd,ic(jd,ou,ko),Ox),xs(zd,ic(zd,ou,ko),kx),o<s?(cn(u,zd[0],zd[1],zd[2]),cn(u,jd[0],jd[1],jd[2]),cn(u,Ud[0],Ud[1],Ud[2]),cn(u,Bd[0],Bd[1],Bd[2]),CD(Zu,kx)):(cn(u,Bd[0],Bd[1],Bd[2]),cn(u,Ud[0],Ud[1],Ud[2]),cn(u,jd[0],jd[1],jd[2]),cn(u,zd[0],zd[1],zd[2]),CD(Zu,Ox));for(var f=0;f<4;++f)cn(l,lp[0],lp[1],lp[2]);cn(c,d+2,d+1,d),cn(c,d,d+3,d+2)}function _D(e,t,r,n,i,a,o,s,u,l){var c=e.currentGroup,d=e.vertices,f=e.normals,h=e.indices,v=e.groups,p=d.elementCount,m=0;s>0?(ys(Ir,t,0),ys(Gr,t,i*3),m=s/Ont(ic(knt,Gr,Ir))):Lnt(Z0,0,0,0);for(var g=0;g<=i;++g){var y=a[g],b=o[g],S=s===0?b:s*(1-g/i),x=g*3;ys(Zu,r,x),tg(Zu,Zu,S),ys(ko,n,x),tg(ko,ko,y),s>0&&(ys(Ir,r,x),ys(Gr,n,x),tg(Z0,Wre(Z0,Ir,Gr),m)),ys(ou,t,x),ys(lp,r,x),ys(r4,n,x),xs(Ir,xs(Ir,ou,ko),Zu),xs(Gr,lp,Z0),cn(d,Ir[0],Ir[1],Ir[2]),cn(f,Gr[0],Gr[1],Gr[2]),xs(Ir,ic(Ir,ou,ko),Zu),cn(d,Ir[0],Ir[1],Ir[2]),cn(f,Gr[0],Gr[1],Gr[2]),VV(Gr,r4),cn(d,Ir[0],Ir[1],Ir[2]),cn(f,Gr[0],Gr[1],Gr[2]),ic(Ir,ic(Ir,ou,ko),Zu),cn(d,Ir[0],Ir[1],Ir[2]),cn(f,Gr[0],Gr[1],Gr[2]),xs(Gr,VV(Gr,lp),Z0),cn(d,Ir[0],Ir[1],Ir[2]),cn(f,Gr[0],Gr[1],Gr[2]),ic(Ir,xs(Ir,ou,ko),Zu),cn(d,Ir[0],Ir[1],Ir[2]),cn(f,Gr[0],Gr[1],Gr[2]),CD(Gr,r4),cn(d,Ir[0],Ir[1],Ir[2]),cn(f,Gr[0],Gr[1],Gr[2]),xs(Ir,xs(Ir,ou,ko),Zu),cn(d,Ir[0],Ir[1],Ir[2]),cn(f,Gr[0],Gr[1],Gr[2])}for(var g=0;g<i;++g){for(var C=0;C<2;C++)cn(h,p+g*8+2*C,p+(g+1)*8+2*C+1,p+g*8+2*C+1),cn(h,p+g*8+2*C,p+(g+1)*8+2*C,p+(g+1)*8+2*C+1);for(var C=2;C<4;C++)cn(h,p+g*8+2*C,p+(g+1)*8+2*C,p+g*8+2*C+1),cn(h,p+(g+1)*8+2*C,p+(g+1)*8+2*C+1,p+g*8+2*C+1)}if(u){var y=a[0],b=o[0],w=s===0?b:s;Lx(0,e,t,r,n,y,w,w)}else if(s>0){var y=a[0],b=o[0];Lx(0,e,t,r,n,y,s,-b),Lx(0,e,t,r,n,y,-s,b)}if(l&&s===0){var y=a[i],b=o[i];Lx(i*3,e,t,r,n,y,-b,-b)}for(var A=(i+1)*8+(u?4:s>0?8:0)+(l&&s===0?4:0),g=0,M=A;g<M;++g)Nnt(v,c)}var Nn=_(),fs=_(),hs=_(),Wl=_(),Xu=_();function Fnt(e,t,r,n,i){e[0]=t[0]*n+r[0]*i,e[1]=t[1]*n+r[1]*i,e[2]=t[2]*n+r[2]*i}function n4(e,t,r,n,i,a){e[0]=t[0]*i+r[0]*a+n[0],e[1]=t[1]*i+r[1]*a+n[1],e[2]=t[2]*i+r[2]*a+n[2]}var $l=_.fromArray,HV=_.normalize,Bnt=_.negate,Unt=_.copy,GV=_.cross,ao=qe.add3,i4=new Map;function jnt(e){if(!i4.has(e)){for(var t=[],r=[],n=0;n<e;++n){var i=2*Math.PI*n/e;t[n]=Math.cos(i),r[n]=Math.sin(i)}i4.set(e,{cos:t,sin:r})}return i4.get(e)}function $re(e,t,r,n,i,a,o,s,u,l){for(var c=e.currentGroup,d=e.vertices,f=e.normals,h=e.indices,v=e.groups,p=d.elementCount,m=jnt(a),g=m.cos,y=m.sin,b=0;b<=i;++b){var S=b*3;$l(Wl,r,S),$l(Xu,n,S),$l(hs,t,S);for(var x=o[b],C=s[b],w=0;w<a;++w)n4(fs,Wl,Xu,hs,C*g[w],x*y[w]),a===2?(Unt(Nn,Xu),HV(Nn,Nn),(w!==0||b%2===0)&&Bnt(Nn,Nn)):Fnt(Nn,Wl,Xu,x*g[w],C*y[w]),HV(Nn,Nn),ao(d,fs[0],fs[1],fs[2]),ao(f,Nn[0],Nn[1],Nn[2])}for(var b=0;b<i;++b)for(var w=0;w<a;++w)ao(h,p+b*a+(w+1)%a,p+(b+1)*a+(w+1)%a,p+b*a+w),ao(h,p+(b+1)*a+(w+1)%a,p+(b+1)*a+w,p+b*a+w);if(u){var A=0,M=d.elementCount;$l(Wl,r,A),$l(Xu,n,A),$l(hs,t,A),GV(Nn,Xu,Wl),ao(d,hs[0],hs[1],hs[2]),ao(f,Nn[0],Nn[1],Nn[2]);var x=o[0],C=s[0];p=d.elementCount;for(var b=0;b<a;++b)n4(fs,Wl,Xu,hs,C*g[b],x*y[b]),ao(d,fs[0],fs[1],fs[2]),ao(f,Nn[0],Nn[1],Nn[2]),ao(h,p+(b+1)%a,p+b,M)}if(l){var A=i*3,M=d.elementCount;$l(Wl,r,A),$l(Xu,n,A),$l(hs,t,A),GV(Nn,Wl,Xu),ao(d,hs[0],hs[1],hs[2]),ao(f,Nn[0],Nn[1],Nn[2]);var x=o[i],C=s[i];p=d.elementCount;for(var b=0;b<a;++b)n4(fs,Wl,Xu,hs,C*g[b],x*y[b]),ao(d,fs[0],fs[1],fs[2]),ao(f,Nn[0],Nn[1],Nn[2]),ao(h,p+b,p+(b+1)%a,M)}var D=(i+1)*a+(u?a+1:0)+(l?a+1:0);qe.addRepeat(v,D,c)}var Xl=_.fromArray,znt=_.magnitude,a4=_.sub,qV=_.add,o4=_.scale,Vnt=_.negate,Hnt=_.copy,Gnt=_.cross,ps=qe.add3,qnt=qe.add,Si=_(),Ki=_(),Wnt=_(),s4=_(),Lh=_(),WV=_(),J0=_(),$nt=_(),u4=_();function _S(e,t,r,n,i,a,o,s){var u=e.currentGroup,l=e.vertices,c=e.normals,d=e.indices,f=e.groups,h=l.elementCount,v=0;s>0&&(Xl(Si,t,0),Xl(Ki,t,i*3),v=s/znt(a4(Wnt,Ki,Si)));for(var p=0;p<=i;++p){var m=a[p],g=o[p],y=s===0?g:s*(1-p/i),b=p*3;Xl(Lh,r,b),o4(Lh,Lh,y),Xl(s4,n,b),o4(s4,s4,m),s>0&&(Xl(Si,r,b),Xl(Ki,n,b),o4(WV,Gnt(WV,Si,Ki),v)),Xl(J0,t,b),Xl($nt,r,b),Xl(u4,n,b),qV(Si,J0,Lh),Vnt(Ki,u4),ps(l,Si[0],Si[1],Si[2]),ps(c,Ki[0],Ki[1],Ki[2]),a4(Si,J0,Lh),ps(l,Si[0],Si[1],Si[2]),ps(c,Ki[0],Ki[1],Ki[2]),qV(Si,J0,Lh),Hnt(Ki,u4),ps(l,Si[0],Si[1],Si[2]),ps(c,Ki[0],Ki[1],Ki[2]),a4(Si,J0,Lh),ps(l,Si[0],Si[1],Si[2]),ps(c,Ki[0],Ki[1],Ki[2])}for(var p=0;p<i;++p)ps(d,h+p*4,h+(p+1)*4+1,h+p*4+1),ps(d,h+p*4,h+(p+1)*4,h+(p+1)*4+1),ps(d,h+p*4+2+1,h+(p+1)*4+2+1,h+p*4+2),ps(d,h+p*4+2,h+(p+1)*4+2+1,h+(p+1)*4+2);for(var S=(i+1)*4,p=0,x=S;p<x;++p)qnt(f,u)}var Xre={sizeFactor:I.Numeric(.2,{min:0,max:10,step:.01}),aspectRatio:I.Numeric(5,{min:.1,max:10,step:.1}),arrowFactor:I.Numeric(1.5,{min:0,max:3,step:.1}),tubularHelices:I.Boolean(!1),detail:I.Numeric(0,{min:0,max:3,step:1},Et.CustomQualityParamInfo),linearSegments:I.Numeric(8,{min:1,max:48,step:1},Et.CustomQualityParamInfo),radialSegments:I.Numeric(16,{min:2,max:56,step:2},Et.CustomQualityParamInfo)};I.getDefaultValues(Xre);var oo=_();function Xnt(e,t,r,n,i,a){var o,s,u,l=t.polymerElements.length;if(!l)return Nt.createEmpty(a);for(var c=i.sizeFactor,d=i.detail,f=i.linearSegments,h=i.radialSegments,v=i.aspectRatio,p=i.arrowFactor,m=i.tubularHelices,g=f*h*l+(h+1)*l*2,y=wt.createState(g,g/10,a),b=Ue.isCoarse(t),S=UL(f),x=S.curvePoints,C=S.normalVectors,w=S.binormalVectors,A=S.widthValues,M=S.heightValues,D=0,k=BL(t,r,{ignoreSecondaryStructure:!1,useHelixOrientation:m});k.hasNext;){var R=k.move();y.currentGroup=D;var L=Il(R.moleculeType),H=Lr.is(R.secStrucType,4),B=Lr.is(R.secStrucType,2),j=B&&!m?snt:Ore,Q=L?gE:mE;jL(S,R,j,Q);var G=n.size.size(R.centerPrev)*c,W=n.size.size(R.center)*c,q=n.size.size(R.centerNext)*c;b&&(G*=v/2,W*=v/2,q*=v/2);var ee=R.secStrucFirst||R.coarseBackboneFirst||R.first,he=R.secStrucLast||R.coarseBackboneLast||R.last,$=f;if(R.initial){$=Math.max(Math.round(f*Q),1);var X=f-$;x.copyWithin(0,X*3),w.copyWithin(0,X*3),C.copyWithin(0,X*3),_.fromArray(oo,x,3),_.normalize(oo,_.sub(oo,R.p2,oo)),_.scaleAndAdd(oo,R.p2,oo,W*Y_),_.toArray(oo,x,0)}else R.final&&($=Math.max(Math.round(f*(1-Q)),1),_.fromArray(oo,x,$*3-3),_.normalize(oo,_.sub(oo,R.p2,oo)),_.scaleAndAdd(oo,R.p2,oo,W*Y_),_.toArray(oo,x,$*3));if(R.initial===!0&&R.final===!0)Mi(y,R.p2,W*2,d);else if(H){var U=G*v,z=W*v,J=q*v,Y=R.secStrucLast?z*p:0;xD(S,G,W,q,U,z,J,Q),h===2?_S(y,x,C,w,$,A,M,Y):_D(y,x,C,w,$,A,M,Y,ee,he)}else{var U=void 0,z=void 0,J=void 0;if(B&&!R.isCoarseBackbone?m?(G*=v*1.5,W*=v*1.5,q*=v*1.5,U=G,z=W,J=q):(U=G*v,z=W*v,J=q*v):L&&!R.isCoarseBackbone?(U=G*v,z=W*v,J=q*v,o=[U,G],G=o[0],U=o[1],s=[z,W],W=s[0],z=s[1],u=[J,q],q=u[0],J=u[1]):(U=G,z=W,J=q),xD(S,G,W,q,U,z,J,Q),h===2)if(L&&!R.isCoarseBackbone){for(var Z=0,te=w.length;Z<te;Z++)w[Z]*=-1;_S(y,x,w,C,$,M,A,0)}else _S(y,x,C,w,$,A,M,0);else h===4?_D(y,x,C,w,$,A,M,0,ee,he):$re(y,x,C,w,$,h,A,M,ee,he)}++D}var le=wt.getMesh(y),ye=Fe.expand(Fe(),t.boundary.sphere,1*i.sizeFactor);return le.setBoundingSphere(ye),le}var Yre=E(E({},ga),Xre);function Ynt(e){return Ja({defaultProps:I.getDefaultValues(Yre),createGeometry:Xnt,createLocationIterator:Xc.fromGroup,getLoci:Pv,eachLocation:Tv,setUpdateState:function(t,r,n,i,a,o,s){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.tubularHelices!==n.tubularHelices||r.detail!==n.detail||r.linearSegments!==n.linearSegments||r.radialSegments!==n.radialSegments||r.aspectRatio!==n.aspectRatio||r.arrowFactor!==n.arrowFactor;var u=Al.get(o.structure).version;t.info.secondaryStructureHash!==u&&(t.createGeometry=!0,t.info.secondaryStructureHash=u)}},e)}var Kre={"polymer-trace":function(e,t){return Jn("Polymer trace mesh",e,t,Ynt)},"polymer-gap":function(e,t){return Jn("Polymer gap cylinder",e,t,zL)},"nucleotide-block":function(e,t){return Jn("Nucleotide block mesh",e,t,pnt)},"nucleotide-ring":function(e,t){return Jn("Nucleotide ring mesh",e,t,Cnt)},"direction-wedge":function(e,t){return Jn("Polymer direction wedge",e,t,Dnt)}},Qre=E(E(E(E(E(E({},Yre),yE),jre),Vre),Gre),{sizeFactor:I.Numeric(.2,{min:0,max:10,step:.01}),visuals:I.MultiSelect(["polymer-trace","polymer-gap","nucleotide-block"],I.objectToOptions(Kre))});function Knt(e,t){var r=I.clone(Qre),n=!1,i=!1;return t.units.forEach(function(a){!n&&Ue.isAtomic(a)&&a.nucleotideElements.length&&(n=!0),!i&&a.gapElements.length&&(i=!0)}),r.visuals.defaultValue=["polymer-trace"],n&&r.visuals.defaultValue.push("nucleotide-block"),i&&r.visuals.defaultValue.push("polymer-gap"),r}function Qnt(e,t){return or.createMulti("Cartoon",e,t,Ri,Kre)}var Znt={name:"cartoon",label:"Cartoon",description:"Displays ribbons, planks, tubes smoothly following the trace atoms of polymers.",factory:Qnt,getParams:Knt,defaultValues:I.getDefaultValues(Qre),defaultColorTheme:{name:"chain-id"},defaultSizeTheme:{name:"uniform"},isApplicable:function(e){return e.polymerResidueCount>0},ensureCustomProperties:{attach:function(e,t){return ce(void 0,void 0,void 0,function(){var r,n,i;return de(this,function(a){switch(a.label){case 0:return[4,Al.attach(e,t,void 0,!0)];case 1:a.sent(),r=0,n=t.models,a.label=2;case 2:return r<n.length?(i=n[r],[4,yD.attach(e,i,void 0,!0)]):[3,5];case 3:a.sent(),a.label=4;case 4:return r++,[3,2];case 5:return[2]}})})},detach:function(e){Al.ref(e,!1);for(var t=0,r=e.models;t<r.length;t++){var n=r[t];yD.ref(n,!1)}}}},Zre=E(E({},ga),{sizeFactor:I.Numeric(1,{min:0,max:10,step:.1}),detail:I.Numeric(0,{min:0,max:3,step:1},Et.CustomQualityParamInfo),ignoreHydrogens:I.Boolean(!1)});function Jnt(e){return Ja({defaultProps:I.getDefaultValues(Zre),createGeometry:eit,createLocationIterator:Na.fromGroup,getLoci:Rl,eachLocation:Dl,setUpdateState:function(t,r,n){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.detail!==n.detail||r.ignoreHydrogens!==n.ignoreHydrogens}},e)}function eit(e,t,r,n,i,a){var o=r.child,s=o==null?void 0:o.unitMap.get(t.id);if(o&&!s)return Nt.createEmpty(a);var u=i.detail,l=i.sizeFactor,c=i.ignoreHydrogens,d=t.elements,f=t.model,h=t.model.atomicHierarchy.derived.atom.atomicNumber,v=d.length,p=v*B3(u),m=wt.createState(p,p/2,a),g=wl.Provider.get(f);if(!g)return Nt.createEmpty(a);var y=_(),b=zn(),S=_(),x=_(),C=_(),w=g.elementToAnsiotrop,A=g.data,M=A.U,D=A._schema.U.space,k=t.conformation.invariantPosition,R=Ze.create(r);R.unit=t;for(var L=0;L<v;L++){var H=d[L],B=w[H];if(B!==-1&&!(s&&!Je.has(s.elements,H)||c&&S_(h,H))){R.element=H,k(H,y),m.currentGroup=L,Pr.toMat3(b,D,M.value(B)),zn.symmtricFromLower(b,b),zn.symmetricEigenvalues(S,b),zn.eigenvector(x,b,S[1]),zn.eigenvector(C,b,S[2]);for(var j=0;j<3;++j)S[j]=l*1.5958*Math.sqrt(Math.abs(S[j]));hn(S[0],S[1],vn)&&hn(S[1],S[2],vn)?Mi(m,y,S[0],u):UO(m,y,C,x,S,u)}}var Q=wt.getMesh(m),G=Fe.expand(Fe(),(s||t).boundary.sphere,1*l);return Q.setBoundingSphere(G),Q}var Jre={"ellipsoid-mesh":function(e,t){return Jn("Ellipsoid Mesh",e,t,Jnt)},"intra-bond":function(e,t){return Jn("Intra-unit bond cylinder",e,t,gre)},"inter-bond":function(e,t){return Su("Inter-unit bond cylinder",e,t,bre)}},ene=E(E(E(E({},Zre),dE),fE),{includeParent:I.Boolean(!1),adjustCylinderLength:I.Boolean(!1,{isHidden:!0}),unitKinds:Lb(["atomic"]),sizeFactor:I.Numeric(1,{min:.01,max:10,step:.01}),sizeAspectRatio:I.Numeric(.1,{min:.01,max:3,step:.01}),linkCap:I.Boolean(!0),visuals:I.MultiSelect(["ellipsoid-mesh","intra-bond","inter-bond"],I.objectToOptions(Jre))});function tit(e,t){return I.clone(ene)}function rit(e,t){return or.createMulti("Ellipsoid",e,t,Ri,Jre)}var nit={name:"ellipsoid",label:"Ellipsoid",description:"Displays anisotropic displacement ellipsoids of atomic elements plus bonds as cylinders.",factory:rit,getParams:tit,defaultValues:I.getDefaultValues(ene),defaultColorTheme:{name:"element-symbol"},defaultSizeTheme:{name:"uniform"},isApplicable:function(e){return e.elementCount>0&&e.models.some(function(t){return wl.Provider.isApplicable(t)})},getData:function(e,t){return t.includeParent?e.asParent():e},mustRecreate:function(e,t){return e.includeParent!==t.includeParent}},iit=`
precision highp float;

attribute vec3 aPosition;
attribute float aRadius;

varying vec3 vPosition;
varying float vRadiusSqInv;

#if defined(dCalcType_groupId)
    attribute float aGroup;
    varying float vGroup;
#endif

uniform vec3 uBboxSize;
uniform vec3 uBboxMin;
uniform float uResolution;

void main() {
    vRadiusSqInv = 1.0 / (aRadius * aRadius);
    #if defined(dCalcType_groupId)
        vGroup = aGroup;
    #endif
    gl_PointSize = ceil(((aRadius * 3.0) / uResolution) + uResolution);
    vPosition = (aPosition - uBboxMin) / uResolution;
    gl_Position = vec4(((aPosition - uBboxMin) / uBboxSize) * 2.0 - 1.0, 1.0);
}
`,ait=`
precision highp float;

varying vec3 vPosition;
varying float vRadiusSqInv;
#if defined(dCalcType_groupId)
    #if defined(dGridTexType_2d)
        precision highp sampler2D;
        uniform sampler2D tMinDistanceTex;
        uniform vec3 uGridTexDim;
    #elif defined(dGridTexType_3d)
        precision highp sampler3D;
        uniform sampler3D tMinDistanceTex;
    #endif
    varying float vGroup;
#endif

#include common

uniform vec3 uGridDim;
uniform vec2 uGridTexScale;
uniform float uCurrentSlice;
uniform float uCurrentX;
uniform float uCurrentY;
uniform float uAlpha;
uniform float uResolution;
uniform float uRadiusFactorInv;

void main() {
    vec2 v = gl_FragCoord.xy - vec2(uCurrentX, uCurrentY) - 0.5;
    vec3 fragPos = vec3(v.x, v.y, uCurrentSlice);
    float dist = distance(fragPos, vPosition) * uResolution;

    #if defined(dCalcType_density)
        float density = exp(-uAlpha * ((dist * dist) * vRadiusSqInv));
        gl_FragColor.a = density * uRadiusFactorInv;
    #elif defined(dCalcType_minDistance)
        gl_FragColor.a = 1.0 - dist * uRadiusFactorInv;
    #elif defined(dCalcType_groupId)
        #if defined(dGridTexType_2d)
            float minDistance = 1.0 - texture2D(tMinDistanceTex, (gl_FragCoord.xy) / (uGridTexDim.xy / uGridTexScale)).a;
        #elif defined(dGridTexType_3d)
            float minDistance = 1.0 - texelFetch(tMinDistanceTex, ivec3(gl_FragCoord.xy, uCurrentSlice), 0).a;
        #endif
        if (dist * uRadiusFactorInv > minDistance + uResolution * 0.05)
            discard;
        gl_FragColor.rgb = encodeFloatRGB(vGroup);
    #endif
}
`,oit={drawCount:gi("number"),instanceCount:gi("number"),aRadius:Vr("float32",1,0),aPosition:Vr("float32",3,0),aGroup:Vr("float32",1,0),uCurrentSlice:Ge("f"),uCurrentX:Ge("f"),uCurrentY:Ge("f"),uBboxMin:Ge("v3","material"),uBboxSize:Ge("v3","material"),uGridDim:Ge("v3","material"),uGridTexDim:Ge("v3","material"),uGridTexScale:Ge("v2","material"),uAlpha:Ge("f","material"),uResolution:Ge("f","material"),uRadiusFactorInv:Ge("f","material"),tMinDistanceTex:ur("texture","rgba","float","nearest"),dGridTexType:Qt("string",["2d","3d"]),dCalcType:Qt("string",["density","minDistance","groupId"])},ul="gaussian-density";function tne(e){return e.namedFramebuffers[ul]||(e.namedFramebuffers[ul]=e.resources.framebuffer()),e.namedFramebuffers[ul]}function rne(e,t,r,n,i,a){var o=ul+"-"+e;return t.namedTextures[o]||(t.namedTextures[o]=t.resources.texture(r,n,i,a)),t.namedTextures[o]}function nne(e,t,r,n,i,a){return e.isWebGL2?sit(e,t,r,n,i,a):VL(e,t,r,n,!1,i,a)}function VL(e,t,r,n,i,a,o){return ine(lit(e,t,r,n,i,a,o))}function sit(e,t,r,n,i,a){return ine(cit(e,t,r,n,i,a))}function ine(e){var t=e.texture,r=e.scale,n=e.bbox,i=e.gridDim,a=e.gridTexDim,o=e.gridTexScale,s=e.radiusFactor,u=e.resolution;return{transform:uit(r,n),texture:t,bbox:n,gridDim:i,gridTexDim:a,gridTexScale:o,radiusFactor:s,resolution:u}}function uit(e,t){var r=ue.identity();return ue.fromScaling(r,e),ue.setTranslation(r,t.min),r}function lit(e,t,r,n,i,a,o){var s=e.gl,u=e.resources,l=e.state,c=e.extensions,d=c.colorBufferFloat,f=c.textureFloat,h=c.colorBufferHalfFloat,v=c.textureHalfFloat,p=c.blendMinMax,m=a.smoothness,g=a.resolution,y=ane(t,r,n,a),b=y.drawCount,S=y.positions,x=y.radii,C=y.groups,w=y.scale,A=y.expandedBox,M=y.dim,D=y.maxRadius,k=M[0],R=M[1],L=M[2],H=fit(M),B=H.texDimX,j=H.texDimY,Q=H.texCols,G=H.powerOfTwoSize,W=_.create(B,j,0),q=He.create(B/G,j/G),ee=D*2,he=i?G:B,$=i?G:j,X=rne("min-dist-2d",e,"image-uint8","rgba","ubyte","nearest");X.define(he,$);var U=one(e,b,S,x,C,X,A,M,W,q,m,g,ee),z=U.values,J=z.uCurrentSlice,Y=z.uCurrentX,Z=z.uCurrentY,te=tne(e);te.bind(),sne(e),o||(o=h&&v?u.texture("image-float16","rgba","fp16","linear"):d&&f?u.texture("image-float32","rgba","float","linear"):u.texture("image-uint8","rgba","ubyte","linear")),o.define(he,$);function le(ye,be){l.currentRenderItemId=-1,ye.attachFramebuffer(te,0),be&&(s.viewport(0,0,he,$),s.scissor(0,0,he,$),s.clear(s.COLOR_BUFFER_BIT)),N.update(Z,0);for(var Ee=0,Se=0,ie=0,oe=0;oe<L;++oe)Ee>=Q&&(Ee-=Q,Se+=R,ie=0,N.update(Z,Se)),N.update(Y,ie),N.update(J,oe),s.viewport(ie,Se,k,R),s.scissor(ie,Se,k,R),U.render(),++Ee,ie+=k;s.flush()}return lne(e,U),le(o,!0),p&&(une(e,U),le(X,!0),cne(e,U),le(o,!1)),{texture:o,scale:w,bbox:A,gridDim:M,gridTexDim:W,gridTexScale:q,radiusFactor:ee,resolution:g}}function cit(e,t,r,n,i,a){var o=e.gl,s=e.resources,u=e.state,l=e.extensions,c=l.colorBufferFloat,d=l.textureFloat,f=l.colorBufferHalfFloat,h=l.textureHalfFloat,v=i.smoothness,p=i.resolution,m=ane(t,r,n,i),g=m.drawCount,y=m.positions,b=m.radii,S=m.groups,x=m.scale,C=m.expandedBox,w=m.dim,A=m.maxRadius,M=w[0],D=w[1],k=w[2],R=rne("min-dist-3d",e,"volume-uint8","rgba","ubyte","nearest");R.define(M,D,k);var L=He.create(1,1),H=A*2,B=one(e,g,y,b,S,R,C,w,w,L,v,p,H),j=B.values.uCurrentSlice,Q=tne(e);Q.bind(),sne(e),o.viewport(0,0,M,D),o.scissor(0,0,M,D),a||(a=f&&h?s.texture("volume-float16","rgba","fp16","linear"):c&&d?s.texture("volume-float32","rgba","float","linear"):s.texture("volume-uint8","rgba","ubyte","linear")),a.define(M,D,k);function G(W,q){u.currentRenderItemId=-1;for(var ee=0;ee<k;++ee)N.update(j,ee),W.attachFramebuffer(Q,0,ee),q&&o.clear(o.COLOR_BUFFER_BIT),B.render();o.flush()}return lne(e,B),G(a,!0),une(e,B),G(R,!0),cne(e,B),G(a,!1),{texture:a,scale:x,bbox:C,gridDim:w,gridTexDim:w,gridTexScale:L,radiusFactor:H,resolution:p}}function ane(e,t,r,n){for(var i=n.resolution,a=n.radiusOffset,o=1/i,s=e.indices,u=e.x,l=e.y,c=e.z,d=e.id,f=Oe.size(s),h=new Float32Array(f*3),v=new Float32Array(f),p=new Float32Array(f),m=0,g=0;g<f;++g){var y=Oe.getAt(s,g);h[g*3]=u[y],h[g*3+1]=l[y],h[g*3+2]=c[y];var b=r(y)+a;m<b&&(m=b),v[g]=b,p[g]=d?d[g]:g}var S=m*2+i*4,x=Xt.expand(Xt(),t,_.create(S,S,S)),C=Xt.scale(Xt(),x,o),w=Xt.size(_(),C);_.ceil(w,w);var A=_.create(i,i,i);return{drawCount:f,positions:h,radii:v,groups:p,scale:A,expandedBox:x,dim:w,maxRadius:m}}function one(e,t,r,n,i,a,o,s,u,l,c,d,f){if(e.namedComputeRenderables[ul]){var h=_.sub(_(),o.max,o.min),v=e.namedComputeRenderables[ul].values;N.updateIfChanged(v.drawCount,t),N.updateIfChanged(v.instanceCount,1),N.update(v.aRadius,n),N.update(v.aPosition,r),N.update(v.aGroup,i),N.updateIfChanged(v.uCurrentSlice,0),N.updateIfChanged(v.uCurrentX,0),N.updateIfChanged(v.uCurrentY,0),N.update(v.uBboxMin,o.min),N.update(v.uBboxSize,h),N.update(v.uGridDim,s),N.update(v.uGridTexDim,u),N.update(v.uGridTexScale,l),N.updateIfChanged(v.uAlpha,c),N.updateIfChanged(v.uResolution,d),N.updateIfChanged(v.uRadiusFactorInv,1/f),N.update(v.tMinDistanceTex,a),N.updateIfChanged(v.dGridTexType,a.getDepth()>0?"3d":"2d"),N.updateIfChanged(v.dCalcType,"density"),e.namedComputeRenderables[ul].update()}else e.namedComputeRenderables[ul]=dit(e,t,r,n,i,a,o,s,u,l,c,d,f);return e.namedComputeRenderables[ul]}function dit(e,t,r,n,i,a,o,s,u,l,c,d,f){var h=_.sub(_(),o.max,o.min),v={drawCount:N.create(t),instanceCount:N.create(1),aRadius:N.create(n),aPosition:N.create(r),aGroup:N.create(i),uCurrentSlice:N.create(0),uCurrentX:N.create(0),uCurrentY:N.create(0),uBboxMin:N.create(o.min),uBboxSize:N.create(h),uGridDim:N.create(s),uGridTexDim:N.create(u),uGridTexScale:N.create(l),uAlpha:N.create(c),uResolution:N.create(d),uRadiusFactorInv:N.create(1/f),tMinDistanceTex:N.create(a),dGridTexType:N.create(a.getDepth()>0?"3d":"2d"),dCalcType:N.create("density")},p=E({},oit),m=Mn(ul,iit,ait),g=Wi(e,"points",m,p,v);return qi(g,v)}function sne(e){var t=e.gl,r=e.state;r.disable(t.CULL_FACE),r.enable(t.BLEND),r.disable(t.DEPTH_TEST),r.enable(t.SCISSOR_TEST),r.depthMask(!1),r.clearColor(0,0,0,0)}function une(e,t){var r=e.gl,n=e.state;if(N.update(t.values.dCalcType,"minDistance"),t.update(),n.colorMask(!1,!1,!1,!0),n.blendFunc(r.ONE,r.ONE),!e.extensions.blendMinMax)throw new Error("GPU gaussian surface calculation requires EXT_blend_minmax");n.blendEquation(e.extensions.blendMinMax.MAX)}function lne(e,t){var r=e.gl,n=e.state;N.update(t.values.dCalcType,"density"),t.update(),n.colorMask(!1,!1,!1,!0),n.blendFunc(r.ONE,r.ONE),n.blendEquation(r.FUNC_ADD)}function cne(e,t){var r=e.gl,n=e.state;N.update(t.values.dCalcType,"groupId"),t.update(),n.colorMask(!0,!0,!0,!1),n.blendFunc(r.ONE,r.ZERO),n.blendEquation(r.FUNC_ADD)}function fit(e){var t=e[0]*e[1]*e[2],r=Math.sqrt(t),n=Math.pow(2,Math.ceil(Math.log(r)/Math.log(2))),i=0,a=e[1],o=1,s=e[2];return n<e[0]*e[2]?(s=Math.floor(n/e[0]),o=Math.ceil(e[2]/s),i=s*e[0],a*=o):i=e[0]*e[2],{texDimX:i,texDimY:a,texRows:o,texCols:s,powerOfTwoSize:a<n?n:n*2}}function dne(e,t,r,n,i){return ce(this,void 0,void 0,function(){function a(Y,Z){for(var te=Y;te<Z;++te)for(var le=Oe.getAt(d,te),ye=f[le],be=h[le],Ee=v[le],Se=g[te],ie=Se*Se,oe=1/ie,O=Se*2,V=O*O,pe=Math.ceil(O*c),_e=Math.floor(c*(ye-w[0])),Pe=Math.floor(c*(be-w[1])),je=Math.floor(c*(Ee-w[2])),ze=Math.max(0,_e-pe),Xe=Math.max(0,Pe-pe),ct=Math.max(0,je-pe),Ne=Math.min(B,_e+pe+2),Qe=Math.min(j,Pe+pe+2),it=Math.min(Q,je+pe+2),ot=ze;ot<Ne;++ot)for(var dt=ee[ot]-ye,Re=ot*q,Ie=Xe;Ie<Qe;++Ie)for(var Ye=he[Ie]-be,tt=dt*dt+Ye*Ye,xt=Ie*G+Re,pt=ct;pt<it;++pt){var ut=$[pt]-Ee,fe=tt+ut*ut;if(fe<=V){var me=XLe(-U*(fe*oe)),we=pt+xt;k[we]+=me,me>X[we]&&(X[we]=me,L[we]=p?p[te]:te)}}}function o(){return ce(this,void 0,void 0,function(){var Y;return de(this,function(Z){switch(Z.label){case 0:Y=0,Z.label=1;case 1:return Y<m?(a(Y,Math.min(Y+z,m)),e.shouldUpdate?[4,e.update({message:"filling density grid",current:Y,max:m})]:[3,3]):[3,4];case 2:Z.sent(),Z.label=3;case 3:return Y+=z,[3,1];case 4:return[2]}})})}var s,u,l,c,d,f,h,v,p,m,g,y,b,S,x,C,w,A,M,D,k,R,L,H,B,j,Q,G,W,q,ee,he,$,X,U,z,J;return de(this,function(Y){switch(Y.label){case 0:for(s=i.resolution,u=i.radiusOffset,l=i.smoothness,c=1/s,d=t.indices,f=t.x,h=t.y,v=t.z,p=t.id,m=Oe.size(d),g=new Float32Array(m),y=0,b=0;b<m;++b)S=n(Oe.getAt(d,b))+u,y<S&&(y=S),g[b]=S;return x=y*2+s,C=Xt.expand(Xt(),r,_.create(x,x,x)),w=C.min,A=Xt.scale(Xt(),C,c),M=Xt.size(_(),A),_.ceil(M,M),D=Pr.Space(M,[0,1,2],Float32Array),k=D.create(),R=Pr.create(D,k),L=D.create(),L.fill(-1),H=Pr.create(D,L),B=M[0],j=M[1],Q=M[2],G=Q,W=j,q=G*W,ee=Ym(M[0],w[0],s),he=Ym(M[1],w[1],s),$=Ym(M[2],w[2],s),X=D.create(),U=l,z=Math.ceil(1e5/(Math.pow(Math.pow(y,3),3)*c)),[4,o()];case 1:return Y.sent(),J=ue.identity(),ue.fromScaling(J,_.create(s,s,s)),ue.setTranslation(J,C.min),[2,{field:R,idField:H,transform:J,radiusFactor:1,resolution:s}]}})})}var $b=E({resolution:I.Numeric(1,{min:.1,max:20,step:.1},E({description:"Grid resolution/cell spacing."},Et.CustomQualityParamInfo)),radiusOffset:I.Numeric(0,{min:0,max:10,step:.1},{description:"Extra/offset radius added to the atoms/coarse elements for gaussian calculation. Useful to create coarse, low resolution surfaces."}),smoothness:I.Numeric(1.5,{min:.5,max:2.5,step:.1},{description:"Smoothness of the gausian surface, lower is smoother."})},tE);I.getDefaultValues($b);function bE(e,t){var r=e.maxTextureSize/3;return r*r/Math.max(1,t?t.units.length/16:1)}function fne(e,t,r){var n=this,i=t.lookup3d.boundary.box,a=bv(i,r),o=rE(e,t,a),s=o.position,u=o.radius;return We.create("Gaussian Density",function(l){return ce(n,void 0,void 0,function(){return de(this,function(c){switch(c.label){case 0:return[4,dne(l,s,i,u,a)];case 1:return[2,c.sent()]}})})})}function hit(e,t,r,n,i){var a=this,o=t.lookup3d.boundary.box,s=bv(o,r,bE(n,e)),u=rE(e,t,s),l=u.position,c=u.radius;return We.create("Gaussian Density",function(d){return ce(a,void 0,void 0,function(){return de(this,function(f){return[2,nne(n,l,o,c,s,i)]})})})}function pit(e,t,r,n,i,a){var o=this,s=t.lookup3d.boundary.box,u=bv(s,n,bE(i,e)),l=rE(e,t,u),c=l.position,d=l.radius;return We.create("Gaussian Density",function(f){return ce(o,void 0,void 0,function(){return de(this,function(h){return[2,VL(i,c,s,d,r,u,a)]})})})}function vit(e,t){var r=this,n=e.lookup3d.boundary.box,i=bv(n,t),a=GO(e,t.ignoreHydrogens,t.traceOnly),o=a.position,s=a.radius;return We.create("Gaussian Density",function(u){return ce(r,void 0,void 0,function(){return de(this,function(l){switch(l.label){case 0:return[4,dne(u,o,n,s,i)];case 1:return[2,l.sent()]}})})})}function mit(e,t,r,n){var i=this,a=e.lookup3d.boundary.box,o=bv(a,t,bE(r)),s=GO(e,t.ignoreHydrogens,t.traceOnly),u=s.position,l=s.radius;return We.create("Gaussian Density",function(c){return ce(i,void 0,void 0,function(){return de(this,function(d){return[2,nne(r,u,a,l,o,n)]})})})}function git(e,t,r,n,i){var a=this,o=e.lookup3d.boundary.box,s=bv(o,r,bE(n)),u=GO(e,r.ignoreHydrogens,r.traceOnly),l=u.position,c=u.radius;return We.create("Gaussian Density",function(d){return ce(a,void 0,void 0,function(){return de(this,function(f){return[2,VL(n,l,o,c,t,s,i)]})})})}function yit(e,t,r,n,i){var a=e.colorType,o=e.vertexCount,s=e.groupCount,u=e.positionBuffer,l=e.transformBuffer,c=e.groupBuffer,d=a.endsWith("Instance"),f=Xt.fromSphere3D(Xt(),d?e.boundingSphere:e.invariantBoundingSphere),h=1/t,v=Xt.scale(Xt(),f,h),p=Xt.size(_(),v);_.ceil(p,p),_.add(p,p,_.create(2,2,2));var m=f.min,g=p[0],y=p[1],b=Hb(p),S=b.width,x=b.height,C=3,w=new Float32Array(S*x*C),A=new Float32Array(S*x),M=new Uint8Array(S*x*C),D={array:M,width:S,height:x,filter:"linear"},k=d?e.instanceCount:1,R=e.colorData.array;function L(Ie,Ye,tt){var xt=Math.floor(tt*g%S/g),pt=Math.floor(tt*g/S),ut=xt*g+Ie;return C*(pt*y*S+Ye*S+ut)}for(var H=2,B=p[0],j=p[1],Q=p[2],G=_(),W=0;W<k;++W)for(var q=0;q<o;q+=r){_.fromArray(G,u,q*3),d&&_.transformMat4Offset(G,G,l,0,0,W*16),_.sub(G,G,m),_.scale(G,G,h);for(var ee=G[0],he=G[1],$=G[2],X=Math.floor(ee),U=Math.floor(he),z=Math.floor($),J=W*s+c[q],Y=R[J*3],Z=R[J*3+1],te=R[J*3+2],le=Math.max(0,X-H),ye=Math.max(0,U-H),be=Math.max(0,z-H),Ee=Math.min(B,X+H+2),Se=Math.min(j,U+H+2),ie=Math.min(Q,z+H+2),oe=le;oe<Ee;++oe)for(var O=oe-ee,V=ye;V<Se;++V)for(var pe=V-he,_e=be;_e<ie;++_e){var Pe=_e-$,je=Math.sqrt(O*O+pe*pe+Pe*Pe);if(!(je>H)){var ze=H-je,Xe=L(oe,V,_e);w[Xe]+=Y*ze,w[Xe+1]+=Z*ze,w[Xe+2]+=te*ze,A[Xe/3]+=ze}}}for(var W=0,ct=A.length;W<ct;++W){var Ne=W*3,Qe=A[W];M[Ne]=Math.round(w[Ne]/Qe),M[Ne+1]=Math.round(w[Ne+1]/Qe),M[Ne+2]=Math.round(w[Ne+2]/Qe)}var it=He.create(S,x),ot=_r.create(m[0],m[1],m[2],h),dt=d?"volumeInstance":"volume";if(n)return i||(i=n.resources.texture("image-uint8","rgb","ubyte","linear")),i.load(D),{kind:"volume",texture:i,gridTexDim:it,gridDim:p,gridTransform:ot,type:dt};var Re=bit({vertexCount:o,instanceCount:k,transformBuffer:l,positionBuffer:u,colorType:dt,grid:M,gridDim:p,gridTexDim:it,gridTransform:ot,vertexStride:3,colorStride:3});return{kind:"vertex",texture:Re,texDim:He.create(Re.width,Re.height),type:d?"vertexInstance":"vertex"}}function bit(e){var t=e.vertexCount,r=e.positionBuffer,n=e.transformBuffer,i=e.grid,a=e.gridDim,o=e.gridTexDim,s=e.gridTransform,u=e.vertexStride,l=e.colorStride,c=e.colorType.endsWith("Instance"),d=c?e.instanceCount:1,f=pa(Math.max(1,d*t),3,Uint8Array),h=f.array,v=a[0],p=a[1],m=o[0],g=_.fromArray(_(),s,0),y=s[3];function b(be,Ee,Se){var ie=Math.floor(Se*v%m/v),oe=Math.floor(Se*v/m),O=ie*v+be;return l*(oe*p*m+Ee*m+O)}for(var S=_(),x=_(),C=_(),w=_(),A=0;A<d;++A)for(var M=0;M<t;++M){_.fromArray(S,r,M*u),c&&_.transformMat4Offset(S,S,n,0,0,A*16),_.sub(S,S,g),_.scale(S,S,y),_.floor(x,S),_.ceil(C,S),_.sub(w,S,x),_.sub(S,C,x),_.div(w,w,S);var D=x[0],k=x[1],R=x[2],L=C[0],H=C[1],B=C[2],j=w[0],Q=w[1],G=w[2],W=at.fromArray(i,b(D,k,R)),q=at.fromArray(i,b(L,k,R)),ee=at.fromArray(i,b(D,k,B)),he=at.fromArray(i,b(L,k,B)),$=at.fromArray(i,b(D,H,R)),X=at.fromArray(i,b(L,H,R)),U=at.fromArray(i,b(D,H,B)),z=at.fromArray(i,b(L,H,B)),J=at.interpolate(W,q,j),Y=at.interpolate(ee,he,j),Z=at.interpolate($,X,j),te=at.interpolate(U,z,j),le=at.interpolate(J,Z,Q),ye=at.interpolate(Y,te,Q);at.toArray(at.interpolate(le,ye,G),h,(A*t+M)*3)}return f}var xit=`
precision highp float;
precision highp sampler2D;

uniform sampler2D tColor;
uniform vec2 uTexSize;

void main(void) {
    vec2 coords = gl_FragCoord.xy / uTexSize;
    vec4 color = texture2D(tColor, coords);

    gl_FragColor.rgb = color.rgb / color.a;
}
`,Sit=`
precision highp float;

varying vec3 vPosition;
varying vec3 vColor;

uniform float uCurrentSlice;
uniform float uCurrentX;
uniform float uCurrentY;
uniform float uResolution;

const float p = 2.0;

void main() {
    vec2 v = gl_FragCoord.xy - vec2(uCurrentX, uCurrentY) - 0.5;
    vec3 fragPos = vec3(v.x, v.y, uCurrentSlice);
    float dist = distance(fragPos, vPosition);
    if (dist > p) discard;

    gl_FragColor = vec4(vColor, 1.0) * (p - dist);
}
`,Cit=`
precision highp float;

#include common
#include read_from_texture

uniform int uTotalCount;
uniform int uGroupCount;

attribute float aSample;
#define SampleID int(aSample)

attribute mat4 aTransform;
attribute float aInstance;

uniform vec2 uGeoTexDim;
uniform sampler2D tPosition;
uniform sampler2D tGroup;

uniform vec2 uColorTexDim;
uniform sampler2D tColor;

varying vec3 vPosition;
varying vec3 vColor;

uniform vec3 uBboxSize;
uniform vec3 uBboxMin;
uniform float uResolution;

void main() {
    vec3 position = readFromTexture(tPosition, SampleID, uGeoTexDim).xyz;
    float group = decodeFloatRGB(readFromTexture(tGroup, SampleID, uGeoTexDim).rgb);

    position = (aTransform * vec4(position, 1.0)).xyz;
    gl_PointSize = 7.0;
    vPosition = (position - uBboxMin) / uResolution;
    gl_Position = vec4(((position - uBboxMin) / uBboxSize) * 2.0 - 1.0, 1.0);

    #if defined(dColorType_group)
        vColor = readFromTexture(tColor, group, uColorTexDim).rgb;
    #elif defined(dColorType_groupInstance)
        vColor = readFromTexture(tColor, aInstance * float(uGroupCount) + group, uColorTexDim).rgb;
    #endif
}
`,_it={drawCount:gi("number"),instanceCount:gi("number"),stride:gi("number"),uTotalCount:Ge("i"),uInstanceCount:Ge("i"),uGroupCount:Ge("i"),aTransform:Vr("float32",16,1),aInstance:Vr("float32",1,1),aSample:Vr("float32",1,0),uGeoTexDim:Ge("v2","buffered"),tPosition:ur("texture","rgba","float","nearest"),tGroup:ur("texture","rgba","float","nearest"),uColorTexDim:Ge("v2"),tColor:ur("image-uint8","rgb","ubyte","nearest"),dColorType:Qt("string",["group","groupInstance","vertex","vertexInstance"]),uCurrentSlice:Ge("f"),uCurrentX:Ge("f"),uCurrentY:Ge("f"),uBboxMin:Ge("v3","material"),uBboxSize:Ge("v3","material"),uResolution:Ge("f","material")},su="color-accumulate";function hne(e,t){for(var r=new Float32Array(e),n=0;n<e;++n)r[n]=n*t;return r}function wit(e,t,r,n,i){if(e.namedComputeRenderables[su]){var a=_.sub(_(),r.max,r.min),o=e.namedComputeRenderables[su].values,s=Math.round(t.vertexCount/i);(s>o.drawCount.ref.value||i!==o.stride.ref.value)&&N.update(o.aSample,hne(s,i)),N.updateIfChanged(o.drawCount,s),N.updateIfChanged(o.instanceCount,t.instanceCount),N.updateIfChanged(o.stride,i),N.updateIfChanged(o.uTotalCount,t.vertexCount),N.updateIfChanged(o.uInstanceCount,t.instanceCount),N.updateIfChanged(o.uGroupCount,t.groupCount),N.update(o.aTransform,t.transformBuffer),N.update(o.aInstance,t.instanceBuffer),N.update(o.uGeoTexDim,He.set(o.uGeoTexDim.ref.value,t.positionTexture.getWidth(),t.positionTexture.getHeight())),N.update(o.tPosition,t.positionTexture),N.update(o.tGroup,t.groupTexture),N.update(o.uColorTexDim,He.set(o.uColorTexDim.ref.value,t.colorData.width,t.colorData.height)),N.update(o.tColor,t.colorData),N.updateIfChanged(o.dColorType,t.colorType),N.updateIfChanged(o.uCurrentSlice,0),N.updateIfChanged(o.uCurrentX,0),N.updateIfChanged(o.uCurrentY,0),N.update(o.uBboxMin,r.min),N.update(o.uBboxSize,a),N.updateIfChanged(o.uResolution,n),e.namedComputeRenderables[su].update()}else e.namedComputeRenderables[su]=Eit(e,t,r,n,i);return e.namedComputeRenderables[su]}function Eit(e,t,r,n,i){var a=_.sub(_(),r.max,r.min),o=Math.round(t.vertexCount/i),s={drawCount:N.create(o),instanceCount:N.create(t.instanceCount),stride:N.create(i),uTotalCount:N.create(t.vertexCount),uInstanceCount:N.create(t.instanceCount),uGroupCount:N.create(t.groupCount),aTransform:N.create(t.transformBuffer),aInstance:N.create(t.instanceBuffer),aSample:N.create(hne(o,i)),uGeoTexDim:N.create(He.create(t.positionTexture.getWidth(),t.positionTexture.getHeight())),tPosition:N.create(t.positionTexture),tGroup:N.create(t.groupTexture),uColorTexDim:N.create(He.create(t.colorData.width,t.colorData.height)),tColor:N.create(t.colorData),dColorType:N.create(t.colorType),uCurrentSlice:N.create(0),uCurrentX:N.create(0),uCurrentY:N.create(0),uBboxMin:N.create(r.min),uBboxSize:N.create(a),uResolution:N.create(n)},u=E({},_it),l=Mn("accumulate",Cit,Sit),c=Wi(e,"points",l,u,s);return qi(c,s)}function Ait(e){var t=e.gl,r=e.state;r.disable(t.CULL_FACE),r.enable(t.BLEND),r.disable(t.DEPTH_TEST),r.enable(t.SCISSOR_TEST),r.depthMask(!1),r.clearColor(0,0,0,0),r.blendFunc(t.ONE,t.ONE),r.blendEquation(t.FUNC_ADD)}var Pit=E(E({},va),{tColor:ur("texture","rgba","float","nearest"),uTexSize:Ge("v2")}),ey="color-normalize";function Tit(e,t){if(e.namedComputeRenderables[ey]){var r=e.namedComputeRenderables[ey].values;N.update(r.tColor,t),N.update(r.uTexSize,He.set(r.uTexSize.ref.value,t.getWidth(),t.getHeight())),e.namedComputeRenderables[ey].update()}else e.namedComputeRenderables[ey]=Iit(e,t);return e.namedComputeRenderables[ey]}function Iit(e,t){var r=E(E({},ma),{tColor:N.create(t),uTexSize:N.create(He.create(t.getWidth(),t.getHeight()))}),n=E({},Pit),i=Mn("normalize",_o,xit),a=Wi(e,"triangles",i,n,r);return qi(a,r)}function Mit(e){var t=e.gl,r=e.state;r.disable(t.CULL_FACE),r.enable(t.BLEND),r.disable(t.DEPTH_TEST),r.enable(t.SCISSOR_TEST),r.depthMask(!1),r.clearColor(0,0,0,0),r.blendFunc(t.ONE,t.ONE),r.blendEquation(t.FUNC_ADD)}function Dit(e){var t=e[0]*e[1]*e[2],r=Math.sqrt(t),n=Math.pow(2,Math.ceil(Math.log(r)/Math.log(2))),i=0,a=e[1],o=1,s=e[2];return n<e[0]*e[2]?(s=Math.floor(n/e[0]),o=Math.ceil(e[2]/s),i=s*e[0],a*=o):i=e[0]*e[2],{texDimX:i,texDimY:a,texRows:o,texCols:s,powerOfTwoSize:a<n?n:n*2}}function Rit(e,t,r,n,i){var a=n.gl,o=n.resources,s=n.state,u=n.extensions,l=u.colorBufferHalfFloat,c=u.textureHalfFloat,d=e.colorType.endsWith("Instance"),f=Xt.fromSphere3D(Xt(),d?e.boundingSphere:e.invariantBoundingSphere),h=1/t,v=Xt.scale(Xt(),f,h),p=Xt.size(_(),v);_.ceil(p,p),_.add(p,p,_.create(2,2,2));var m=f.min,g=p[0],y=p[1],b=p[2],S=Dit(p),x=S.texDimX,C=S.texDimY,w=S.texCols;n.namedTextures[su]||(n.namedTextures[su]=l&&c?o.texture("image-float16","rgba","fp16","nearest"):o.texture("image-float32","rgba","float","nearest"));var A=n.namedTextures[su];A.define(x,C);var M=wit(n,e,f,t,r),D=M.values,k=D.uCurrentSlice,R=D.uCurrentX,L=D.uCurrentY;n.namedFramebuffers[su]||(n.namedFramebuffers[su]=n.resources.framebuffer());var H=n.namedFramebuffers[su];H.bind(),Ait(n),s.currentRenderItemId=-1,A.attachFramebuffer(H,0),a.viewport(0,0,x,C),a.scissor(0,0,x,C),a.clear(a.COLOR_BUFFER_BIT),N.update(L,0);for(var B=0,j=0,Q=0,G=0;G<b;++G)B>=w&&(B-=w,j+=y,Q=0,N.update(L,j)),N.update(R,Q),N.update(k,G),a.viewport(Q,j,g,y),a.scissor(Q,j,g,y),M.render(),++B,Q+=g;i||(i=o.texture("image-uint8","rgb","ubyte","linear")),i.define(x,C);var W=Tit(n,A);Mit(n),s.currentRenderItemId=-1,i.attachFramebuffer(H,0),a.viewport(0,0,x,C),a.scissor(0,0,x,C),a.clear(a.COLOR_BUFFER_BIT),W.render();var q=_r.create(m[0],m[1],m[2],h),ee=d?"volumeInstance":"volume";return{texture:i,gridDim:p,gridTexDim:He.create(x,C),gridTransform:q,type:ee}}var pne={smoothColors:I.MappedStatic("auto",{auto:I.Group({}),on:I.Group({resolutionFactor:I.Numeric(2,{min:.5,max:6,step:.1}),sampleStride:I.Numeric(3,{min:1,max:12,step:1})}),off:I.Group({})})};function Xb(e,t,r,n){if((e.smoothColors.name==="on"||e.smoothColors.name==="auto"&&t.color.preferSmoothing)&&r&&r<3&&n){var i=3;return e.smoothColors.name==="on"?(r*=e.smoothColors.params.resolutionFactor,i=e.smoothColors.params.sampleStride):(r*=2-oY(0,1.1,r),r=Math.max(.5,r),r>1.2&&(i=2)),{resolution:r,stride:i,webgl:n}}}function vne(e){return e==="group"||e==="groupInstance"}function HL(e,t,r,n,i){if(vne(e.dColorType.ref.value)){var a=yit({vertexCount:e.uVertexCount.ref.value,instanceCount:e.uInstanceCount.ref.value,groupCount:e.uGroupCount.ref.value,transformBuffer:e.aTransform.ref.value,instanceBuffer:e.aInstance.ref.value,positionBuffer:e.aPosition.ref.value,groupBuffer:e.aGroup.ref.value,colorData:e.tColor.ref.value,colorType:e.dColorType.ref.value,boundingSphere:e.boundingSphere.ref.value,invariantBoundingSphere:e.invariantBoundingSphere.ref.value},t,r,n,i);a.kind==="volume"?(N.updateIfChanged(e.dColorType,a.type),N.update(e.tColorGrid,a.texture),N.update(e.uColorTexDim,a.gridTexDim),N.update(e.uColorGridDim,a.gridDim),N.update(e.uColorGridTransform,a.gridTransform)):a.kind==="vertex"&&(N.updateIfChanged(e.dColorType,a.type),N.update(e.tColor,a.texture),N.update(e.uColorTexDim,a.texDim))}}function mne(e,t,r,n,i){if(vne(e.dColorType.ref.value)){r*=3;var a=Rit({vertexCount:e.uVertexCount.ref.value,instanceCount:e.uInstanceCount.ref.value,groupCount:e.uGroupCount.ref.value,transformBuffer:e.aTransform.ref.value,instanceBuffer:e.aInstance.ref.value,positionTexture:e.tPosition.ref.value,groupTexture:e.tGroup.ref.value,colorData:e.tColor.ref.value,colorType:e.dColorType.ref.value,boundingSphere:e.boundingSphere.ref.value,invariantBoundingSphere:e.invariantBoundingSphere.ref.value},t,r,n,i);N.updateIfChanged(e.dColorType,a.type),N.update(e.tColorGrid,a.texture),N.update(e.uColorTexDim,a.gridTexDim),N.update(e.uColorGridDim,a.gridDim),N.update(e.uColorGridTransform,a.gridTransform)}}var gne=E(E(E({},$b),pne),{ignoreHydrogens:I.Boolean(!1),tryUseGpu:I.Boolean(!0)}),GL=E(E(E({},ga),uGe),gne),yne=E(E(E({},Nb),tGe),gne);function bne(e){return e.extensions.colorBufferFloat&&e.extensions.textureFloat&&e.extensions.blendMinMax&&e.extensions.drawBuffers}function u0(e,t,r){if(t.resolution>1)return!1;var n=r.maxTextureSize/3,i=eee(e.boundary.box,t.resolution,n*n),a=i.areaCells,o=i.maxAreaCells;return a<o}function kit(e,t,r,n){return r.tryUseGpu&&n&&bne(n)&&u0(t,r,n)?jit(e):Nit(e)}function Oit(e,t,r,n){return r.tryUseGpu&&n&&bne(n)&&u0(t,r,n)?Vit(e):Bit(e)}function Lit(e,t,r,n,i,a){return ce(this,void 0,void 0,function(){var o,s,u,l,c,d,f,h,v,p;return de(this,function(m){switch(m.label){case 0:return o=i.smoothness,[4,fne(r,t,i).runInContext(e.runtime)];case 1:return s=m.sent(),u=s.transform,l=s.field,c=s.idField,d=s.radiusFactor,f=s.resolution,h={isoLevel:Math.exp(-o)/d,scalarField:l,idField:c},[4,uE(h,a).runAsChild(e.runtime)];case 2:return v=m.sent(),v.meta.resolution=f,Nt.transform(v,u),e.webgl&&!e.webgl.isWebGL2&&Nt.uniformTriangleGroup(v),p=Fe.expand(Fe(),t.boundary.sphere,i.radiusOffset+a0(t)),v.setBoundingSphere(p),[2,v]}})})}function Nit(e){return Ja({defaultProps:I.getDefaultValues(GL),createGeometry:Lit,createLocationIterator:Na.fromGroup,getLoci:Rl,eachLocation:Dl,setUpdateState:function(t,r,n){r.resolution!==n.resolution&&(t.createGeometry=!0),r.radiusOffset!==n.radiusOffset&&(t.createGeometry=!0),r.smoothness!==n.smoothness&&(t.createGeometry=!0),r.ignoreHydrogens!==n.ignoreHydrogens&&(t.createGeometry=!0),r.traceOnly!==n.traceOnly&&(t.createGeometry=!0),r.includeParent!==n.includeParent&&(t.createGeometry=!0),r.smoothColors.name!==n.smoothColors.name?t.updateColor=!0:r.smoothColors.name==="on"&&n.smoothColors.name==="on"&&(r.smoothColors.params.resolutionFactor!==n.smoothColors.params.resolutionFactor&&(t.updateColor=!0),r.smoothColors.params.sampleStride!==n.smoothColors.params.sampleStride&&(t.updateColor=!0))},mustRecreate:function(t,r,n){return r.tryUseGpu&&!!n&&u0(t.structure,r,n)},processValues:function(t,r,n,i,a){var o=r.meta,s=o.resolution,u=o.colorTexture,l=Xb(n,i,s,a);l&&(HL(t,l.resolution,l.stride,l.webgl,u),r.meta.colorTexture=t.tColorGrid.ref.value)},dispose:function(t){var r;(r=t.meta.colorTexture)===null||r===void 0||r.destroy()}},e)}function Fit(e,t,r,n,i){return ce(this,void 0,void 0,function(){var a,o,s,u,l,c,d,f,h,v;return de(this,function(p){switch(p.label){case 0:return a=n.smoothness,[4,vit(t,n).runInContext(e.runtime)];case 1:return o=p.sent(),s=o.transform,u=o.field,l=o.idField,c=o.radiusFactor,d=o.resolution,f={isoLevel:Math.exp(-a)/c,scalarField:u,idField:l},[4,uE(f,i).runAsChild(e.runtime)];case 2:return h=p.sent(),h.meta.resolution=d,Nt.transform(h,s),e.webgl&&!e.webgl.isWebGL2&&Nt.uniformTriangleGroup(h),v=Fe.expand(Fe(),t.boundary.sphere,n.radiusOffset+nE(t)),h.setBoundingSphere(v),[2,h]}})})}function Bit(e){return xv({defaultProps:I.getDefaultValues(yne),createGeometry:Fit,createLocationIterator:Na.fromStructure,getLoci:pE,eachLocation:hE,setUpdateState:function(t,r,n){r.resolution!==n.resolution&&(t.createGeometry=!0),r.radiusOffset!==n.radiusOffset&&(t.createGeometry=!0),r.smoothness!==n.smoothness&&(t.createGeometry=!0),r.ignoreHydrogens!==n.ignoreHydrogens&&(t.createGeometry=!0),r.traceOnly!==n.traceOnly&&(t.createGeometry=!0),r.smoothColors.name!==n.smoothColors.name?t.updateColor=!0:r.smoothColors.name==="on"&&n.smoothColors.name==="on"&&(r.smoothColors.params.resolutionFactor!==n.smoothColors.params.resolutionFactor&&(t.updateColor=!0),r.smoothColors.params.sampleStride!==n.smoothColors.params.sampleStride&&(t.updateColor=!0))},mustRecreate:function(t,r,n){return r.tryUseGpu&&!!n&&u0(t,r,n)},processValues:function(t,r,n,i,a){var o=r.meta,s=o.resolution,u=o.colorTexture,l=Xb(n,i,s,a);l&&(HL(t,l.resolution,l.stride,l.webgl,u),r.meta.colorTexture=t.tColorGrid.ref.value)},dispose:function(t){var r;(r=t.meta.colorTexture)===null||r===void 0||r.destroy()}},e)}var rg="gaussian-surface";function Uit(e,t,r,n,i,a){return ce(this,void 0,void 0,function(){var o,s,u,l,c,d,f,h,v,p,m,g,y,b;return de(this,function(S){switch(S.label){case 0:if(!e.webgl)throw new Error("webgl context required to create gaussian surface texture-mesh");return o=e.webgl,s=o.namedTextures,u=o.resources,l=o.extensions,c=l.colorBufferFloat,d=l.textureFloat,f=l.colorBufferHalfFloat,h=l.textureHalfFloat,s[rg]||(s[rg]=f&&h?u.texture("image-float16","rgba","fp16","linear"):c&&d?u.texture("image-float32","rgba","float","linear"):u.texture("image-uint8","rgba","ubyte","linear")),[4,pit(r,t,!0,i,e.webgl,s[rg]).runInContext(e.runtime)];case 1:return v=S.sent(),p=Math.exp(-i.smoothness)/v.radiusFactor,m=a==null?void 0:a.doubleBuffer.get(),g=mL(e.webgl,v.texture,v.gridDim,v.gridTexDim,v.gridTexScale,v.transform,p,!1,!0,m==null?void 0:m.vertex,m==null?void 0:m.group,m==null?void 0:m.normal),y=Fe.expand(Fe(),t.boundary.sphere,i.radiusOffset+nE(r)),b=Ru.create(g.vertexCount,1,g.vertexTexture,g.groupTexture,g.normalTexture,y,a),b.meta={resolution:v.resolution},[2,b]}})})}function jit(e){return lGe({defaultProps:I.getDefaultValues(GL),createGeometry:Uit,createLocationIterator:Na.fromGroup,getLoci:Rl,eachLocation:Dl,setUpdateState:function(t,r,n){r.resolution!==n.resolution&&(t.createGeometry=!0),r.radiusOffset!==n.radiusOffset&&(t.createGeometry=!0),r.smoothness!==n.smoothness&&(t.createGeometry=!0),r.ignoreHydrogens!==n.ignoreHydrogens&&(t.createGeometry=!0),r.traceOnly!==n.traceOnly&&(t.createGeometry=!0),r.includeParent!==n.includeParent&&(t.createGeometry=!0),r.smoothColors.name!==n.smoothColors.name?t.updateColor=!0:r.smoothColors.name==="on"&&n.smoothColors.name==="on"&&(r.smoothColors.params.resolutionFactor!==n.smoothColors.params.resolutionFactor&&(t.updateColor=!0),r.smoothColors.params.sampleStride!==n.smoothColors.params.sampleStride&&(t.updateColor=!0))},mustRecreate:function(t,r,n){return!r.tryUseGpu||!n||!u0(t.structure,r,n)},processValues:function(t,r,n,i,a){var o=r.meta,s=o.resolution,u=o.colorTexture,l=Xb(n,i,s,a);l&&(mne(t,l.resolution,l.stride,l.webgl,u),r.meta.colorTexture=t.tColorGrid.ref.value)},dispose:function(t){var r;t.vertexTexture.ref.value.destroy(),t.groupTexture.ref.value.destroy(),t.normalTexture.ref.value.destroy(),t.doubleBuffer.destroy(),(r=t.meta.colorTexture)===null||r===void 0||r.destroy()}},e)}function zit(e,t,r,n,i){return ce(this,void 0,void 0,function(){var a,o,s,u,l,c,d,f,h,v,p,m,g,y;return de(this,function(b){switch(b.label){case 0:if(!e.webgl)throw new Error("webgl context required to create structure gaussian surface texture-mesh");return a=e.webgl,o=a.namedTextures,s=a.resources,u=a.extensions,l=u.colorBufferFloat,c=u.textureFloat,d=u.colorBufferHalfFloat,f=u.textureHalfFloat,o[rg]||(o[rg]=d&&f?s.texture("image-float16","rgba","fp16","linear"):l&&c?s.texture("image-float32","rgba","float","linear"):s.texture("image-uint8","rgba","ubyte","linear")),[4,git(t,!0,n,e.webgl,o[rg]).runInContext(e.runtime)];case 1:return h=b.sent(),v=Math.exp(-n.smoothness)/h.radiusFactor,p=i==null?void 0:i.doubleBuffer.get(),m=mL(e.webgl,h.texture,h.gridDim,h.gridTexDim,h.gridTexScale,h.transform,v,!1,!0,p==null?void 0:p.vertex,p==null?void 0:p.group,p==null?void 0:p.normal),g=Fe.expand(Fe(),t.boundary.sphere,n.radiusOffset+nE(t)),y=Ru.create(m.vertexCount,1,m.vertexTexture,m.groupTexture,m.normalTexture,g,i),y.meta={resolution:h.resolution},[2,y]}})})}function Vit(e){return rGe({defaultProps:I.getDefaultValues(yne),createGeometry:zit,createLocationIterator:Na.fromStructure,getLoci:pE,eachLocation:hE,setUpdateState:function(t,r,n){r.resolution!==n.resolution&&(t.createGeometry=!0),r.radiusOffset!==n.radiusOffset&&(t.createGeometry=!0),r.smoothness!==n.smoothness&&(t.createGeometry=!0),r.ignoreHydrogens!==n.ignoreHydrogens&&(t.createGeometry=!0),r.traceOnly!==n.traceOnly&&(t.createGeometry=!0),r.includeParent!==n.includeParent&&(t.createGeometry=!0),r.smoothColors.name!==n.smoothColors.name?t.updateColor=!0:r.smoothColors.name==="on"&&n.smoothColors.name==="on"&&(r.smoothColors.params.resolutionFactor!==n.smoothColors.params.resolutionFactor&&(t.updateColor=!0),r.smoothColors.params.sampleStride!==n.smoothColors.params.sampleStride&&(t.updateColor=!0))},mustRecreate:function(t,r,n){return!r.tryUseGpu||!n||!u0(t,r,n)},processValues:function(t,r,n,i,a){var o=r.meta,s=o.resolution,u=o.colorTexture,l=Xb(n,i,s,a);l&&(mne(t,l.resolution,l.stride,l.webgl,u),r.meta.colorTexture=t.tColorGrid.ref.value)},dispose:function(t){var r;t.vertexTexture.ref.value.destroy(),t.groupTexture.ref.value.destroy(),t.normalTexture.ref.value.destroy(),t.doubleBuffer.destroy(),(r=t.meta.colorTexture)===null||r===void 0||r.destroy()}},e)}function Hit(e,t,r,n,i,a){return ce(this,void 0,void 0,function(){var o,s,u,l,c,d,f,h;return de(this,function(v){switch(v.label){case 0:return o=i.smoothness,[4,fne(r,t,i).runInContext(e.runtime)];case 1:return s=v.sent(),u=s.transform,l=s.field,c=s.idField,d={isoLevel:Math.exp(-o),scalarField:l,idField:c},[4,pL(d,a).runAsChild(e.runtime)];case 2:return f=v.sent(),bn.transform(f,u),h=Fe.expand(Fe(),t.boundary.sphere,i.radiusOffset+a0(t)),f.setBoundingSphere(h),[2,f]}})})}var xne=E(E(E({},WO),$b),{sizeFactor:I.Numeric(3,{min:0,max:10,step:.1}),lineSizeAttenuation:I.Boolean(!1),ignoreHydrogens:I.Boolean(!1)});function Git(e){return $O({defaultProps:I.getDefaultValues(xne),createGeometry:Hit,createLocationIterator:Na.fromGroup,getLoci:Rl,eachLocation:Dl,setUpdateState:function(t,r,n){r.resolution!==n.resolution&&(t.createGeometry=!0),r.radiusOffset!==n.radiusOffset&&(t.createGeometry=!0),r.smoothness!==n.smoothness&&(t.createGeometry=!0),r.ignoreHydrogens!==n.ignoreHydrogens&&(t.createGeometry=!0),r.traceOnly!==n.traceOnly&&(t.createGeometry=!0),r.includeParent!==n.includeParent&&(t.createGeometry=!0)}},e)}var Sne={"gaussian-surface-mesh":function(e,t){return Jn("Gaussian surface mesh",e,t,kit)},"structure-gaussian-surface-mesh":function(e,t){return Su("Structure-Gaussian surface mesh",e,t,Oit)},"gaussian-surface-wireframe":function(e,t){return Jn("Gaussian surface wireframe",e,t,Git)}},Cne=E(E(E({},GL),xne),{visuals:I.MultiSelect(["gaussian-surface-mesh"],I.objectToOptions(Sne))});function qit(e,t){return I.clone(Cne)}function Wit(e,t){return or.createMulti("Gaussian Surface",e,t,Ri,Sne)}var $it={name:"gaussian-surface",label:"Gaussian Surface",description:"Displays a gaussian molecular surface.",factory:Wit,getParams:qit,defaultValues:I.getDefaultValues(Cne),defaultColorTheme:{name:"chain-id"},defaultSizeTheme:{name:"uniform"},isApplicable:function(e){return e.elementCount>0}},_ne=E(E({},QHe),{background:I.Boolean(!0),backgroundMargin:I.Numeric(0,{min:0,max:1,step:.01}),backgroundColor:I.Color(dr.black),backgroundOpacity:I.Numeric(.5,{min:0,max:1,step:.01}),level:I.Select("residue",[["chain","Chain"],["residue","Residue"],["element","Element"]]),chainScale:I.Numeric(10,{min:0,max:20,step:.1}),residueScale:I.Numeric(1,{min:0,max:20,step:.1}),elementScale:I.Numeric(.5,{min:0,max:20,step:.1})});function Xit(e){return ZHe({defaultProps:I.getDefaultValues(_ne),createGeometry:Yit,createLocationIterator:Na.fromStructure,getLoci:pE,eachLocation:hE,setUpdateState:function(t,r,n){t.createGeometry=r.level!==n.level||r.level==="chain"&&r.chainScale!==n.chainScale||r.level==="residue"&&r.residueScale!==n.residueScale||r.level==="element"&&r.elementScale!==n.elementScale}},e)}function Yit(e,t,r,n,i){switch(n.level){case"chain":return Kit(e,t,r,n,i);case"residue":return Qit(e,t,r,n,i);case"element":return Zit(e,t,r,n,i)}}var Ts=_(),ty=new rs("98");function Kit(e,t,r,n,i){for(var a=Ze.create(t),o=t.units,s=t.serialMapping,u=lt.chain,l=u.auth_asym_id,c=u.label_asym_id,d=s.cumulativeUnitElementCount,f=o.length,h=n.chainScale,v=zc.create(n,f,f/2,i),p=0,m=o.length;p<m;++p){var g=o[p];a.unit=g,a.element=g.elements[0];var y=g.lookup3d.boundary.sphere,b=y.center,S=y.radius;_.transformMat4(Ts,b,g.conformation.operator.matrix);var x=l(a),C=c(a),w=x===C?C:C+" ["+x+"]";v.add(w,Ts[0],Ts[1],Ts[2],S,h,d[p])}return v.getText()}function Qit(e,t,r,n,i){for(var a=Ze.create(t),o=t.units,s=t.serialMapping,u=lt.atom.label_comp_id,l=lt.residue.auth_seq_id,c=s.cumulativeUnitElementCount,d=t.polymerResidueCount*2,f=n.residueScale,h=zc.create(n,d,d/2,i),v=0,p=o.length;v<p;++v){var m=o[v],g=m.conformation.position,y=m.elements;a.unit=m,a.element=m.elements[0];for(var b=m.model.atomicHierarchy.residueAtomSegments.index,S=c[v],x=0,C=y.length;x<C;){var w=x,A=b[y[x]];for(x++;x<C&&b[y[x]]===A;)x++;ty.reset();for(var M=w;M<x;M++)g(y[M],Ts),ty.includePosition(Ts);ty.finishedIncludeStep();for(var M=w;M<x;M++)g(y[M],Ts),ty.radiusPosition(Ts);a.element=y[w];var D=ty.getSphere(),k=D.center,R=D.radius,L=l(a),H=u(a),B=H+" "+L;h.add(B,k[0],k[1],k[2],R,f,S+w)}}return h.getText()}function Zit(e,t,r,n,i){for(var a=Ze.create(t),o=t.units,s=t.serialMapping,u=lt.atom,l=u.label_atom_id,c=u.label_alt_id,d=s.cumulativeUnitElementCount,f=Ob({},{scale:1}),h=t.elementCount,v=n.elementScale,p=zc.create(n,h,h/2,i),m=0,g=o.length;m<g;++m){var y=o[m],b=y.conformation.position,S=y.elements;a.unit=y;for(var x=d[m],C=0,w=S.length;C<w;C++){a.element=S[C],b(a.element,Ts);var A=l(a),M=c(a),D=M?A+"%"+M:A;p.add(D,Ts[0],Ts[1],Ts[2],f.size(a),v,x+C)}}return p.getText()}var wne={"label-text":function(e,t){return Su("Label text",e,t,Xit)}},Ene=E(E({},_ne),{visuals:I.MultiSelect(["label-text"],I.objectToOptions(wne))});function Jit(e,t){return I.clone(Ene)}function eat(e,t){var r=or.createMulti("Label",e,t,Ri,wne);return r.setState({pickable:!1,markerActions:tr.None}),r}var tat={name:"label",label:"Label",description:"Displays labels.",factory:eat,getParams:Jit,defaultValues:I.getDefaultValues(Ene),defaultColorTheme:{name:"uniform"},defaultSizeTheme:{name:"uniform"},isApplicable:function(e){return e.elementCount>0}};function rat(e,t){return e[0]=e[1]=e[2]=1,t[0]!==0?e[0]=(t[1]+t[2])/-t[0]:t[1]!==0?e[1]=(t[0]+t[2])/-t[1]:t[2]!==0&&(e[2]=(t[0]+t[1])/-t[2]),e}function nat(e){for(var t=0,r=2*Math.PI/e,n=new Float32Array(e),i=new Float32Array(e),a=0;a<e;a++)n[a]=Math.cos(t),i[a]=Math.sin(t),t+=r;return{cosTable:n,sinTable:i}}var qL={probeRadius:I.Numeric(1.4,{min:0,max:10,step:.1},{description:"Radius of the probe tracing the molecular surface."}),resolution:I.Numeric(.5,{min:.01,max:20,step:.01},E({description:"Grid resolution/cell spacing."},Et.CustomQualityParamInfo)),probePositions:I.Numeric(36,{min:12,max:90,step:1},E({description:"Number of positions tested for probe target intersection."},Et.CustomQualityParamInfo))};I.getDefaultValues(qL);function iat(e,t,r,n,i,a){return ce(this,void 0,void 0,function(){function o(ze,Xe,ct,Ne,Qe){if(h!==-1){var it=h;if(it!==Ne&&it!==Qe&&s(it,ze,Xe,ct))return it;h=-1}for(var ot=0,dt=M.count;ot<dt;++ot){var it=Oe.getAt(D,M.indices[ot]);if(it!==Ne&&it!==Qe&&s(it,ze,Xe,ct))return h=it,it}return-1}function s(ze,Xe,ct,Ne){var Qe=B[ze],it=k[ze]-Xe,ot=R[ze]-ct,dt=L[ze]-Ne,Re=it*it+ot*ot+dt*dt;return Re<Qe*Qe}function u(ze,Xe){for(var ct=ze;ct<Xe;++ct){var Ne=Oe.getAt(D,ct),Qe=k[Ne],it=R[Ne],ot=L[Ne],dt=B[Ne],Re=dt*dt;A.find(Qe,it,ot,dt);for(var Ie=Math.ceil(dt*x),Ye=Math.floor(x*(Qe-q)),tt=Math.floor(x*(it-ee)),xt=Math.floor(x*(ot-he)),pt=Math.max(0,Ye-Ie),ut=Math.max(0,tt-Ie),fe=Math.max(0,xt-Ie),me=Math.min(U,Ye+Ie+2),we=Math.min(z,tt+Ie+2),Ke=Math.min(J,xt+Ie+2),gt=pt;gt<me;++gt)for(var Pt=oe[gt]-Qe,$t=gt*te,lr=ut;lr<we;++lr)for(var Er=O[lr]-it,Yt=Pt*Pt+Er*Er,ei=lr*Y+$t,$i=fe;$i<Ke;++$i){var Xi=V[$i]-ot,wo=Yt+Xi*Xi;if(wo<Re){var Nu=$i+ei;Se[Nu]<0&&(Se[Nu]*=-1);var kl=Math.sqrt(wo),qs=dt/kl,fh=Pt*qs+Qe,hh=Er*qs+it,eo=Xi*qs+ot;if(o(fh,hh,eo,Ne,-1)===-1){var yd=dt-kl;yd<Se[Nu]&&(Se[Nu]=yd,ie[Nu]=H[ct])}}}}}function l(){return ce(this,void 0,void 0,function(){var ze;return de(this,function(Xe){switch(Xe.label){case 0:ze=0,Xe.label=1;case 1:return ze<j?(u(ze,Math.min(ze+pe,j)),e.shouldUpdate?[4,e.update({message:"projecting points",current:ze,max:j})]:[3,3]):[3,4];case 2:Xe.sent(),Xe.label=3;case 3:return ze+=pe,[3,1];case 4:return[2]}})})}function c(ze,Xe){var ct=B[ze],Ne=B[Xe],Qe=v[0]=k[Xe]-k[ze],it=v[1]=R[Xe]-R[ze],ot=v[2]=L[Xe]-L[ze],dt=Qe*Qe+it*it+ot*ot,Re=Math.sqrt(dt),Ie=(ct*ct+Re*Re-Ne*Ne)/(2*ct*Re),Ye=ct*Ie;_.normalize(v,v),rat(m,v),_.normalize(m,m),_.cross(g,v,m),_.normalize(g,g);var tt=Math.sqrt(ct*ct-Ye*Ye);_.scale(m,m,tt),_.scale(g,g,tt),_.scale(v,v,Ye),p[0]=v[0]+k[ze],p[1]=v[1]+R[ze],p[2]=v[2]+L[ze],h=-1;for(var xt=0;xt<S;++xt){var pt=ye[xt],ut=be[xt],fe=p[0]+pt*m[0]+ut*g[0],me=p[1]+pt*m[1]+ut*g[1],we=p[2]+pt*m[2]+ut*g[2];if(o(fe,me,we,ze,Xe)===-1)for(var Ke=Math.floor(x*(fe-q)),gt=Math.floor(x*(me-ee)),Pt=Math.floor(x*(we-he)),$t=Math.max(0,Ke-C),lr=Math.max(0,gt-C),Er=Math.max(0,Pt-C),Yt=Math.min(U,Ke+C+2),ei=Math.min(z,gt+C+2),$i=Math.min(J,Pt+C+2),Xi=$t;Xi<Yt;++Xi)for(var wo=fe-oe[Xi],Nu=Xi*te,kl=lr;kl<ei;++kl)for(var qs=me-O[kl],fh=wo*wo+qs*qs,hh=kl*Y+Nu,eo=Er;eo<$i;++eo){var yd=we-V[eo],Yb=fh+yd*yd,ph=eo+hh,vh=Se[ph];if(vh>0&&Yb<vh*vh){Se[ph]=Math.sqrt(Yb);var Ba=wo*v[0]+qs*v[1]+yd*v[2];ie[ph]=H[Oe.indexOf(D,Ba<0?Xe:ze)]}}}}function d(ze,Xe){for(var ct=ze;ct<Xe;++ct){var Ne=Oe.getAt(D,ct);A.find(k[Ne],R[Ne],L[Ne],B[Ne]);for(var Qe=0,it=M.count;Qe<it;++Qe){var ot=Oe.getAt(D,M.indices[Qe]);Ne<ot&&c(Ne,ot)}}}function f(){return ce(this,void 0,void 0,function(){var ze;return de(this,function(Xe){switch(Xe.label){case 0:ze=0,Xe.label=1;case 1:return ze<j?(d(ze,Math.min(ze+pe,j)),e.shouldUpdate?[4,e.update({message:"projecting torii",current:ze,max:j})]:[3,3]):[3,4];case 2:Xe.sent(),Xe.label=3;case 3:return ze+=pe,[3,1];case 4:return[2]}})})}var h,v,p,m,g,y,b,S,x,C,w,A,M,D,k,R,L,H,B,j,Q,G,W,q,ee,he,$,X,U,z,J,Y,Z,te,le,ye,be,Ee,Se,ie,oe,O,V,pe,_e,Pe,je;return de(this,function(ze){switch(ze.label){case 0:return h=-1,v=_(),p=_(),m=_(),g=_(),y=a.resolution,b=a.probeRadius,S=a.probePositions,x=1/y,C=Math.max(5,2+Math.floor(b*x)),w=_.create(n,n,n),_.scale(w,w,2),A=qp(t,r,w),M=A.result,i===null&&(i=A.boundary.box),D=t.indices,k=t.x,R=t.y,L=t.z,H=t.id,B=t.radius,j=Oe.size(D),Q=n+y,G=Xt.expand(Xt(),i,_.create(Q,Q,Q)),W=G.min,q=W[0],ee=W[1],he=W[2],$=Xt.scale(Xt(),G,x),X=Xt.size(_(),$),_.ceil(X,X),U=X[0],z=X[1],J=X[2],Y=J,Z=z,te=Y*Z,le=nat(S),ye=le.cosTable,be=le.sinTable,Ee=Pr.Space(X,[0,1,2],Float32Array),Se=Ee.create(),ie=Ee.create(),Se.fill(-1001),ie.fill(-1),oe=Ym(U,q,y),O=Ym(z,ee,y),V=Ym(J,he,y),pe=Math.ceil(1e5/(Math.pow(Math.pow(n,3),3)*x)),[4,l()];case 1:return ze.sent(),[4,f()];case 2:return ze.sent(),_e=Pr.create(Ee,Se),Pe=Pr.create(Ee,ie),je=ue.identity(),ue.fromScaling(je,_.create(y,y,y)),ue.setTranslation(je,G.min),[2,{field:_e,idField:Pe,transform:je,resolution:y}]}})})}function aat(e,t,r){for(var n=r.probeRadius,i=rE(e,t,r),a=i.position,o=i.boundary,s=i.radius,u=a.indices,l=Oe.size(u),c=new Float32Array(Oe.end(u)),d=0,f=0;f<l;++f){var h=Oe.getAt(u,f),v=s(h);d<v&&(d=v),c[h]=v+n}return{position:E(E({},a),{radius:c}),boundary:o,maxRadius:d}}function Ane(e,t,r){var n=this,i=t.lookup3d.boundary.box,a=bv(i,r),o=aat(e,t,a),s=o.position,u=o.boundary,l=o.maxRadius;return We.create("Molecular Surface",function(c){return ce(n,void 0,void 0,function(){return de(this,function(d){switch(d.label){case 0:return[4,oat(c,s,u,l,i,a)];case 1:return[2,d.sent()]}})})})}function oat(e,t,r,n,i,a){return ce(this,void 0,void 0,function(){return de(this,function(o){return[2,iat(e,t,r,n,i,a)]})})}var Pne=E(E(E(E({},ga),qL),tE),pne);function sat(e,t,r,n,i,a){return ce(this,void 0,void 0,function(){var o,s,u,l,c,d,f,h;return de(this,function(v){switch(v.label){case 0:return[4,Ane(r,t,i).runInContext(e.runtime)];case 1:return o=v.sent(),s=o.transform,u=o.field,l=o.idField,c=o.resolution,d={isoLevel:i.probeRadius,scalarField:u,idField:l},[4,uE(d,a).runAsChild(e.runtime)];case 2:return f=v.sent(),Nt.transform(f,s),e.webgl&&!e.webgl.isWebGL2&&Nt.uniformTriangleGroup(f),h=Fe.expand(Fe(),t.boundary.sphere,i.probeRadius+a0(t)),f.setBoundingSphere(h),f.meta.resolution=c,[2,f]}})})}function uat(e){return Ja({defaultProps:I.getDefaultValues(Pne),createGeometry:sat,createLocationIterator:Na.fromGroup,getLoci:Rl,eachLocation:Dl,setUpdateState:function(t,r,n){r.resolution!==n.resolution&&(t.createGeometry=!0),r.probeRadius!==n.probeRadius&&(t.createGeometry=!0),r.probePositions!==n.probePositions&&(t.createGeometry=!0),r.ignoreHydrogens!==n.ignoreHydrogens&&(t.createGeometry=!0),r.traceOnly!==n.traceOnly&&(t.createGeometry=!0),r.includeParent!==n.includeParent&&(t.createGeometry=!0),r.smoothColors.name!==n.smoothColors.name?t.updateColor=!0:r.smoothColors.name==="on"&&n.smoothColors.name==="on"&&(r.smoothColors.params.resolutionFactor!==n.smoothColors.params.resolutionFactor&&(t.updateColor=!0),r.smoothColors.params.sampleStride!==n.smoothColors.params.sampleStride&&(t.updateColor=!0))},processValues:function(t,r,n,i,a){var o=r.meta,s=o.resolution,u=o.colorTexture,l=Xb(n,i,s,a);l&&(HL(t,l.resolution,l.stride,l.webgl,u),r.meta.colorTexture=t.tColorGrid.ref.value)},dispose:function(t){var r;(r=t.meta.colorTexture)===null||r===void 0||r.destroy()}},e)}var Tne=E(E(E(E({},WO),qL),tE),{sizeFactor:I.Numeric(1.5,{min:0,max:10,step:.1})});function lat(e,t,r,n,i,a){return ce(this,void 0,void 0,function(){var o,s,u,l,c,d,f;return de(this,function(h){switch(h.label){case 0:return[4,Ane(r,t,i).runInContext(e.runtime)];case 1:return o=h.sent(),s=o.transform,u=o.field,l=o.idField,c={isoLevel:i.probeRadius,scalarField:u,idField:l},[4,pL(c,a).runAsChild(e.runtime)];case 2:return d=h.sent(),bn.transform(d,s),f=Fe.expand(Fe(),t.boundary.sphere,i.probeRadius+a0(t)),d.setBoundingSphere(f),[2,d]}})})}function cat(e){return $O({defaultProps:I.getDefaultValues(Tne),createGeometry:lat,createLocationIterator:Na.fromGroup,getLoci:Rl,eachLocation:Dl,setUpdateState:function(t,r,n){r.resolution!==n.resolution&&(t.createGeometry=!0),r.probeRadius!==n.probeRadius&&(t.createGeometry=!0),r.probePositions!==n.probePositions&&(t.createGeometry=!0),r.ignoreHydrogens!==n.ignoreHydrogens&&(t.createGeometry=!0),r.includeParent!==n.includeParent&&(t.createGeometry=!0)}},e)}var Ine={"molecular-surface-mesh":function(e,t){return Jn("Molecular surface mesh",e,t,uat)},"molecular-surface-wireframe":function(e,t){return Jn("Molecular surface wireframe",e,t,cat)}},Mne=E(E(E({},Pne),Tne),{visuals:I.MultiSelect(["molecular-surface-mesh"],I.objectToOptions(Ine))});function dat(e,t){return I.clone(Mne)}function fat(e,t){return or.createMulti("Molecular Surface",e,t,Ri,Ine)}var hat={name:"molecular-surface",label:"Molecular Surface",description:"Displays a molecular surface.",factory:fat,getParams:dat,defaultValues:I.getDefaultValues(Mne),defaultColorTheme:{name:"chain-id"},defaultSizeTheme:{name:"uniform"},isApplicable:function(e){return e.elementCount>0}},Dne=E(E({},ga),{sizeFactor:I.Numeric(1,{min:0,max:2,step:.1}),detail:I.Numeric(0,{min:0,max:3,step:1},Et.CustomQualityParamInfo)});function pat(e){return Ja({defaultProps:I.getDefaultValues(Dne),createGeometry:mat,createLocationIterator:gat,getLoci:yat,eachLocation:bat,setUpdateState:function(t,r,n){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.detail!==n.detail}},e)}function vat(e){if(Ue.Traits.is(e.traits,1)||Ue.Traits.is(e.traits,2))return!1;if(Ue.isCoarse(e))return!0;if(e.elements.length===0)return!1;e.model.atomicHierarchy.derived.residue.moleculeType;var t=e.residueIndex[e.elements[0]],r=e.model.atomicHierarchy.derived.residue.moleculeType[t];return!(r===3||r===2)}function mat(e,t,r,n,i,a){if(!vat(t))return Nt.createEmpty(a);var o=i.detail,s=i.sizeFactor,u=256,l=wt.createState(u,u/2,a),c=t.principalAxes.boxAxes,d=c.origin,f=c.dirA,h=c.dirB,v=fu.size(_(),c);_.scale(v,v,s/2);var p=_.create(v[2],v[1],v[0]);l.currentGroup=0,UO(l,d,f,h,p,o+1);var m=wt.getMesh(l),g=Fe.expand(Fe(),t.boundary.sphere,1*i.sizeFactor);return m.setBoundingSphere(g),m}function gat(e){var t=e.group,r=e.structure,n=1,i=t.units.length,a=Ze.create(r),o=function(s,u){var l=t.units[u];return a.unit=l,a.element=l.elements[s],a};return mn(n,i,1,o)}function yat(e,t,r){var n=e.objectId,i=e.instanceId;if(r===n){var a=t.structure,o=t.group,s=o.units[i],u=Oe.ofBounds(0,s.elements.length);return De(a,[{unit:s,indices:u}])}return Or}function bat(e,t,r){var n=!1;if(!De.is(e))return!1;var i=t.structure,a=t.group;if(!$e.areEquivalent(e.structure,i))return!1;for(var o=a.elements.length,s=0,u=e.elements;s<u.length;s++){var l=u[s],c=a.unitIndexMap.get(l.unit.id);c!==void 0&&Oe.size(l.indices)===o&&r(Te.ofSingleton(c))&&(n=!0)}return n}var Rne={"orientation-ellipsoid-mesh":function(e,t){return Jn("Orientation ellipsoid mesh",e,t,pat)}},kne=E(E({},Dne),{visuals:I.MultiSelect(["orientation-ellipsoid-mesh"],I.objectToOptions(Rne))});function xat(e,t){return I.clone(kne)}function Sat(e,t){return or.createMulti("Orientation",e,t,Ri,Rne)}var Cat={name:"orientation",label:"Orientation",description:"Displays orientation ellipsoids for polymer chains.",factory:Sat,getParams:xat,defaultValues:I.getDefaultValues(kne),defaultColorTheme:{name:"chain-id"},defaultSizeTheme:{name:"uniform"},isApplicable:function(e){return e.elementCount>0}},_at=qe.add3,wat=qe.add,wD;(function(e){function t(r,n,i){r===void 0&&(r=2048),n===void 0&&(n=1024);var a=qe.create(Float32Array,3,n,i?i.centerBuffer.ref.value:r),o=qe.create(Float32Array,1,n,i?i.groupBuffer.ref.value:r);return{add:function(s,u,l,c){_at(a,s,u,l),wat(o,c)},getPoints:function(){var s=qe.compact(a,!0),u=qe.compact(o,!0);return Zp.create(s,u,a.elementCount,i)}}}e.create=t})(wD||(wD={}));var One=E(E({},iGe),{pointSizeAttenuation:I.Boolean(!0),ignoreHydrogens:I.Boolean(!1),traceOnly:I.Boolean(!1)});function Eat(e,t,r,n,i,a){var o=r.child;if(o&&!o.unitMap.get(t.id))return Zp.createEmpty(a);var s=t.elements,u=s.length,l=wD.create(u,u/10,a),c=_(),d=t.conformation.invariantPosition,f=FL(r,t,i);if(f)for(var h=0;h<u;++h)f(s[h])||(d(s[h],c),l.add(c[0],c[1],c[2],h));else for(var h=0;h<u;++h)d(s[h],c),l.add(c[0],c[1],c[2],h);var v=l.getPoints(),p=Fe.expand(Fe(),t.boundary.sphere,1*i.sizeFactor);return v.setBoundingSphere(p),v}function Aat(e){return aGe({defaultProps:I.getDefaultValues(One),createGeometry:Eat,createLocationIterator:Na.fromGroup,getLoci:Rl,eachLocation:Dl,setUpdateState:function(t,r,n){t.createGeometry=r.ignoreHydrogens!==n.ignoreHydrogens||r.traceOnly!==n.traceOnly}},e)}var Pat={"element-point":function(e,t){return Jn("Points",e,t,Aat)}},Lne=E({},One);function Tat(e,t){return I.clone(Lne)}function Iat(e,t){return or.createMulti("Point",e,t,Ri,Pat)}var Mat={name:"point",label:"Point",description:"Displays elements (atoms, coarse spheres) as spheres.",factory:Iat,getParams:Tat,defaultValues:I.getDefaultValues(Lne),defaultColorTheme:{name:"element-symbol"},defaultSizeTheme:{name:"physical"},isApplicable:function(e){return e.elementCount>0}},Nne={sizeFactor:I.Numeric(.2,{min:0,max:10,step:.01}),detail:I.Numeric(0,{min:0,max:3,step:1},Et.CustomQualityParamInfo),linearSegments:I.Numeric(8,{min:1,max:48,step:1},Et.CustomQualityParamInfo),radialSegments:I.Numeric(16,{min:2,max:56,step:2},Et.CustomQualityParamInfo)};I.getDefaultValues(Nne);var so=_();function Dat(e,t,r,n,i,a){var o=t.polymerElements.length;if(!o)return Nt.createEmpty(a);for(var s=i.sizeFactor,u=i.detail,l=i.linearSegments,c=i.radialSegments,d=l*c*o+(c+1)*o*2,f=wt.createState(d,d/10,a),h=UL(l),v=h.curvePoints,p=h.normalVectors,m=h.binormalVectors,g=h.widthValues,y=h.heightValues,b=0,S=BL(t,r,{ignoreSecondaryStructure:!0});S.hasNext;){var x=S.move();f.currentGroup=b;var C=Il(x.moleculeType),w=C?gE:mE;jL(h,x,Ore,w);var A=x.coarseBackboneFirst||x.first,M=x.coarseBackboneLast||x.last,D=n.size.size(x.centerPrev)*s,k=n.size.size(x.center)*s,R=n.size.size(x.centerNext)*s;xD(h,D,k,R,D,k,R,w);var L=l;if(x.initial){L=Math.max(Math.round(l*w),1);var H=l-L;v.copyWithin(0,H*3),m.copyWithin(0,H*3),p.copyWithin(0,H*3),g.copyWithin(0,H*3),y.copyWithin(0,H*3),_.fromArray(so,v,3),_.normalize(so,_.sub(so,x.p2,so)),_.scaleAndAdd(so,x.p2,so,k*Y_),_.toArray(so,v,0)}else x.final&&(L=Math.max(Math.round(l*(1-w)),1),_.fromArray(so,v,L*3-3),_.normalize(so,_.sub(so,x.p2,so)),_.scaleAndAdd(so,x.p2,so,k*Y_),_.toArray(so,v,L*3));x.initial===!0&&x.final===!0?Mi(f,x.p2,k*2,u):c===2?_S(f,v,p,m,L,g,y,0):c===4?_D(f,v,p,m,L,g,y,0,A,M):$re(f,v,p,m,L,c,g,y,A,M),++b}var B=wt.getMesh(f),j=Fe.expand(Fe(),t.boundary.sphere,1*i.sizeFactor);return B.setBoundingSphere(j),B}var Fne=E(E({},ga),Nne);function Rat(e){return Ja({defaultProps:I.getDefaultValues(Fne),createGeometry:Dat,createLocationIterator:Xc.fromGroup,getLoci:Pv,eachLocation:Tv,setUpdateState:function(t,r,n){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.detail!==n.detail||r.linearSegments!==n.linearSegments||r.radialSegments!==n.radialSegments}},e)}var Bne={"polymer-tube":function(e,t){return Jn("Polymer tube mesh",e,t,Rat)},"polymer-gap":function(e,t){return Jn("Polymer gap cylinder",e,t,zL)}},Une=E(E(E({},Fne),yE),{sizeFactor:I.Numeric(.2,{min:0,max:10,step:.01}),visuals:I.MultiSelect(["polymer-tube","polymer-gap"],I.objectToOptions(Bne))});function kat(e,t){var r=I.clone(Une),n=!1,i=!1;return t.units.forEach(function(a){!n&&Ue.isAtomic(a)&&a.nucleotideElements.length&&(n=!0),!i&&a.gapElements.length&&(i=!0)}),r.visuals.defaultValue=["polymer-tube"],i&&r.visuals.defaultValue.push("polymer-gap"),r}function Oat(e,t){return or.createMulti("Putty",e,t,Ri,Bne)}var Lat={name:"putty",label:"Putty",description:"Displays a tube smoothly following the trace atoms of polymers.",factory:Oat,getParams:kat,defaultValues:I.getDefaultValues(Une),defaultColorTheme:{name:"chain-id"},defaultSizeTheme:{name:"uncertainty"},isApplicable:function(e){return e.polymerResidueCount>0}},Nat={"element-sphere":function(e,t){return Jn("Sphere mesh",e,t,Sre)}},jne=E({},vE);function Fat(e,t){var r=I.clone(jne);return t.isCoarseGrained&&(r.sizeFactor.defaultValue=2),r}function Bat(e,t){return or.createMulti("Spacefill",e,t,Ri,Nat)}var Uat={name:"spacefill",label:"Spacefill",description:"Displays atomic/coarse elements as spheres.",factory:Bat,getParams:Fat,defaultValues:I.getDefaultValues(jne),defaultColorTheme:{name:"element-symbol"},defaultSizeTheme:{name:"physical"},isApplicable:function(e){return e.elementCount>0}},l4=Nr.is;function jat(e,t,r,n,i,a){if(!Ue.isAtomic(t))return bn.createEmpty(a);var o=r.child,s=o==null?void 0:o.unitMap.get(t.id);if(o&&!s)return bn.createEmpty(a);var u=Ze.create(r,t),l=t.elements,c=t.bonds,d=c.edgeCount,f=c.a,h=c.b,v=c.edgeProps,p=c.offset,m=v.order,g=v.flags,y=i.sizeFactor,b=i.aromaticBonds;if(!d)return bn.createEmpty(a);var S=_(),x=t.conformation.invariantPosition,C=t.rings,w=C.elementRingIndices,A=C.elementAromaticRingIndices,M={linkCount:d*2,referencePosition:function(R){var L,H,B=f[R],j=h[R];B>j&&(L=[j,B],B=L[0],j=L[1]),p[B+1]-p[B]===1&&(H=[j,B],B=H[0],j=H[1]);for(var Q=w.get(B),G=0,W=p[B],q=p[B+1];W<q;++W){var ee=h[W];if(ee!==j&&ee!==B)if(Q){var he=w.get(ee);if(!he)continue;var $=VC(Q,he);$>G&&(G=$,x(l[ee],S))}else return x(l[ee],S)}return G>0?S:null},position:function(R,L,H){x(l[f[H]],R),x(l[h[H]],L)},style:function(R){var L=m[R],H=g[R];if(l4(H,2)||l4(H,4))return 1;if(L===3)return 3;if(b){var B=f[R],j=h[R],Q=A.get(B),G=A.get(j),W=Q&&G?VC(Q,G):0;if(W||l4(H,16))return W===2?6:5}return L===2?2:0},radius:function(R){u.element=l[f[R]];var L=n.size.size(u);u.element=l[h[R]];var H=n.size.size(u);return Math.min(L,H)*y},ignore:pre(r,t,i)},D=wee(e,M,i,a),k=Fe.expand(Fe(),(s??t).boundary.sphere,1*y);return D.setBoundingSphere(k),D}var zne=E(E(E({},WO),RL),{includeParent:I.Boolean(!1)});function zat(e){return $O({defaultProps:I.getDefaultValues(zne),createGeometry:jat,createLocationIterator:th.fromGroup,getLoci:kL,eachLocation:OL,setUpdateState:function(t,r,n,i,a,o,s){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.linkScale!==n.linkScale||r.linkSpacing!==n.linkSpacing||r.dashCount!==n.dashCount||r.ignoreHydrogens!==n.ignoreHydrogens||!Xa(r.includeTypes,n.includeTypes)||!Xa(r.excludeTypes,n.excludeTypes)||r.aromaticBonds!==n.aromaticBonds;var u=o.group.units[0],l=s.group.units[0];Ue.isAtomic(u)&&Ue.isAtomic(l)&&(bo.areEqual(u.bonds,l.bonds)||(t.createGeometry=!0,t.updateTransform=!0,t.updateColor=!0,t.updateSize=!0))}},e)}var c4=new Vt.ElementBondIterator;function $V(e,t,r,n){for(c4.setElement(t,r,n);c4.hasNext;){var i=c4.move();return i.otherUnit.conformation.position(i.otherUnit.elements[i.otherIndex],e),e}return null}function Vat(e,t,r,n,i){var a=t.interUnitBonds,o=a.edgeCount,s=a.edges,u=n.sizeFactor,l=n.aromaticBonds;if(!o)return bn.createEmpty(i);var c=_(),d=Ze.create(),f={linkCount:o,referencePosition:function(m){var g=s[m],y,b,S,x;if(g.unitA<g.unitB)y=t.unitMap.get(g.unitA),b=t.unitMap.get(g.unitB),S=g.indexA,x=g.indexB;else if(g.unitA>g.unitB)y=t.unitMap.get(g.unitB),b=t.unitMap.get(g.unitA),S=g.indexB,x=g.indexA;else throw new Error("same units in createInterUnitBondLines");return $V(c,t,y,S)||$V(c,t,b,x)},position:function(m,g,y){var b=s[y],S=t.unitMap.get(b.unitA),x=t.unitMap.get(b.unitB);S.conformation.position(S.elements[b.indexA],m),x.conformation.position(x.elements[b.indexB],g)},style:function(m){var g=s[m].props.order,y=da.create(s[m].props.flag);return Nr.is(y,2)||Nr.is(y,4)?1:g===3?3:l&&Nr.is(y,16)?5:g===2?2:0},radius:function(m){var g=s[m];d.structure=t,d.unit=t.unitMap.get(g.unitA),d.element=d.unit.elements[g.indexA];var y=r.size.size(d);d.unit=t.unitMap.get(g.unitB),d.element=d.unit.elements[g.indexB];var b=r.size.size(d);return Math.min(y,b)*u},ignore:vre(t,n)},h=wee(e,f,n,i),v=t.child,p=Fe.expand(Fe(),(v??t).boundary.sphere,1*n.sizeFactor);return h.setBoundingSphere(p),h}var Vne=E(E(E({},YHe),RL),{includeParent:I.Boolean(!1)});function Hat(e){return KHe({defaultProps:I.getDefaultValues(Vne),createGeometry:Vat,createLocationIterator:th.fromStructure,getLoci:LL,eachLocation:NL,setUpdateState:function(t,r,n){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.linkScale!==n.linkScale||r.linkSpacing!==n.linkSpacing||r.dashCount!==n.dashCount||r.ignoreHydrogens!==n.ignoreHydrogens||!Xa(r.includeTypes,n.includeTypes)||!Xa(r.excludeTypes,n.excludeTypes)}},e)}var Hne={"intra-bond":function(e,t){return Jn("Intra-unit bond line",e,t,zat)},"inter-bond":function(e,t){return Su("Inter-unit bond line",e,t,Hat)}},Gne=E(E(E({},zne),Vne),{includeParent:I.Boolean(!1),sizeFactor:I.Numeric(1.5,{min:.01,max:10,step:.01}),unitKinds:Lb(["atomic"]),visuals:I.MultiSelect(["intra-bond","inter-bond"],I.objectToOptions(Hne))});function Gat(e,t){return I.clone(Gne)}function qat(e,t){return or.createMulti("Line",e,t,Ri,Hne)}var Wat={name:"line",label:"Line",description:"Displays bonds as lines.",factory:qat,getParams:Gat,defaultValues:I.getDefaultValues(Gne),defaultColorTheme:{name:"element-symbol"},defaultSizeTheme:{name:"uniform"},isApplicable:function(e){return e.elementCount>0},getData:function(e,t){return t.includeParent?e.asParent():e},mustRecreate:function(e,t){return e.includeParent!==t.includeParent}};function $at(e,t,r,n,i){return ce(this,void 0,void 0,function(){var a,o,s,u,l,c,d,f,h,v,p,m,g;return de(this,function(y){switch(y.label){case 0:if(a=e.runtime,o=e.webgl,!o||!o.extensions.blendMinMax)throw new Error("GaussianDensityVolume requires `webgl` and `blendMinMax` extension");return s=i?i.gridTexture.ref.value:void 0,[4,mit(t,n,o,s).runInContext(a)];case 1:return u=y.sent(),l=u.transform,c=u.texture,d=u.bbox,f=u.gridDim,h={min:0,max:1,mean:.04,sigma:.01},v=ue.mul(ue(),l,ue.fromScaling(ue(),f)),p=ue.getScaling(_(),l),m=Ya.create(d,f,l,v,p,c,h,!0,i),g=Fe.expand(Fe(),t.boundary.sphere,n.radiusOffset+nE(t)),m.setBoundingSphere(g),[2,m]}})})}var qne=E(E(E({},JHe),$b),{ignoreHydrogens:I.Boolean(!1)});function Xat(e){return eGe({defaultProps:I.getDefaultValues(qne),createGeometry:$at,createLocationIterator:Na.fromStructure,getLoci:pE,eachLocation:hE,setUpdateState:function(t,r,n){r.resolution!==n.resolution&&(t.createGeometry=!0),r.radiusOffset!==n.radiusOffset&&(t.createGeometry=!0),r.smoothness!==n.smoothness&&(t.createGeometry=!0),r.ignoreHydrogens!==n.ignoreHydrogens&&(t.createGeometry=!0),r.traceOnly!==n.traceOnly&&(t.createGeometry=!0),r.includeParent!==n.includeParent&&(t.createGeometry=!0)},dispose:function(t){t.gridTexture.ref.value.destroy()}},e)}function Yat(e,t,r,n,i,a){return ce(this,void 0,void 0,function(){var o,s,u,l,c,d,f,h,v,p,m,g,y;return de(this,function(b){switch(b.label){case 0:if(o=e.runtime,s=e.webgl,!s)throw new Error("GaussianDensityVolume requires `webgl`");return u=a?a.gridTexture.ref.value:void 0,[4,hit(r,t,i,s,u).runInContext(o)];case 1:return l=b.sent(),c=l.transform,d=l.texture,f=l.bbox,h=l.gridDim,v={min:0,max:1,mean:.04,sigma:.01},p=ue.mul(ue(),c,ue.fromScaling(ue(),h)),m=ue.getScaling(_(),c),g=Ya.create(f,h,c,p,m,d,v,!0,a),y=Fe.expand(Fe(),t.boundary.sphere,i.radiusOffset+a0(t)),g.setBoundingSphere(y),[2,g]}})})}var Kat=E(E(E({},oGe),$b),{ignoreHydrogens:I.Boolean(!1)});function Qat(e){return sGe({defaultProps:I.getDefaultValues(Kat),createGeometry:Yat,createLocationIterator:Na.fromGroup,getLoci:Rl,eachLocation:Dl,setUpdateState:function(t,r,n){r.resolution!==n.resolution&&(t.createGeometry=!0),r.radiusOffset!==n.radiusOffset&&(t.createGeometry=!0),r.smoothness!==n.smoothness&&(t.createGeometry=!0),r.ignoreHydrogens!==n.ignoreHydrogens&&(t.createGeometry=!0),r.traceOnly!==n.traceOnly&&(t.createGeometry=!0),r.includeParent!==n.includeParent&&(t.createGeometry=!0)},dispose:function(t){t.gridTexture.ref.value.destroy()}},e)}var Wne={"gaussian-volume":function(e,t){return Su("Gaussian volume",e,t,Xat)},"units-gaussian-volume":function(e,t){return Jn("Units-Gaussian volume",e,t,Qat)}},$ne=E(E({},qne),{visuals:I.MultiSelect(["gaussian-volume"],I.objectToOptions(Wne))});function Zat(e,t){var r=I.clone($ne);return r.renderMode=Ya.createRenderModeParam({min:0,max:1,mean:.04,sigma:.01}),r.jumpLength=I.Numeric(4,{min:0,max:20,step:.1}),r}function Jat(e,t){return or.createMulti("Gaussian Volume",e,t,Ri,Wne)}var eot={name:"gaussian-volume",label:"Gaussian Volume",description:"Displays a gaussian molecular density using direct volume rendering.",factory:Jat,getParams:Zat,defaultValues:I.getDefaultValues($ne),defaultColorTheme:{name:"chain-id"},defaultSizeTheme:{name:"uniform"},isApplicable:function(e){return e.elementCount>0}},tot=_.scale,rot=_.add,not=_.sub,WL=E(E(E({},ga),cee),{sizeFactor:I.Numeric(.3,{min:0,max:10,step:.01}),radialSegments:I.Numeric(16,{min:2,max:56,step:2},Et.CustomQualityParamInfo),tryUseImpostor:I.Boolean(!0)});function iot(e,t,r,n){return r.tryUseImpostor&&n&&n.extensions.fragDepth?oot(e):uot(e)}function aot(e,t,r,n,i,a){var o=t.polymerElements.length;if(!o)return Vo.createEmpty(a);var s=o*2,u=M_.create(s,s/4,a),l=t.conformation.invariantPosition,c=_(),d=_(),f=_(),h=function(m,g,y,b,S){l(m,c),l(g,d);var x=Il(S),C=x?gE:mE;rot(f,c,tot(f,not(f,d,c),C)),u.add(c[0],c[1],c[2],f[0],f[1],f[2],1,!1,!1,y),u.add(f[0],f[1],f[2],d[0],d[1],d[2],1,!1,!1,b)};Mre(t,h);var v=u.getCylinders(),p=Fe.expand(Fe(),t.boundary.sphere,1*i.sizeFactor);return v.setBoundingSphere(p),v}function oot(e){return dee({defaultProps:I.getDefaultValues(WL),createGeometry:aot,createLocationIterator:Xc.fromGroup,getLoci:Pv,eachLocation:Tv,setUpdateState:function(t,r,n){},mustRecreate:function(t,r,n){return!r.tryUseImpostor||!n}},e)}function sot(e,t,r,n,i,a){var o=t.polymerElements.length;if(!o)return Nt.createEmpty(a);var s=i.radialSegments,u=i.sizeFactor,l=s*2*o*2,c=wt.createState(l,l/10,a),d=t.conformation.invariantPosition,f=_(),h=_(),v={radiusTop:1,radiusBottom:1,radialSegments:s},p=Ze.create(r,t),m=Ze.create(r,t),g=function(S,x,C,w,A){p.element=S,m.element=x,d(p.element,f),d(m.element,h);var M=Il(A),D=M?gE:mE;v.radiusTop=v.radiusBottom=n.size.size(p)*u,c.currentGroup=C,Ma(c,f,h,D,v),v.radiusTop=v.radiusBottom=n.size.size(m)*u,c.currentGroup=w,Ma(c,h,f,1-D,v)};Mre(t,g);var y=wt.getMesh(c),b=Fe.expand(Fe(),t.boundary.sphere,1*i.sizeFactor);return y.setBoundingSphere(b),y}function uot(e){return Ja({defaultProps:I.getDefaultValues(WL),createGeometry:sot,createLocationIterator:Xc.fromGroup,getLoci:Pv,eachLocation:Tv,setUpdateState:function(t,r,n){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.radialSegments!==n.radialSegments},mustRecreate:function(t,r,n){return r.tryUseImpostor&&!!n}},e)}var $L=E(E(E({},ga),uee),{sizeFactor:I.Numeric(.3,{min:0,max:10,step:.01}),detail:I.Numeric(0,{min:0,max:3,step:1},Et.CustomQualityParamInfo),tryUseImpostor:I.Boolean(!0)});function lot(e,t,r,n){return r.tryUseImpostor&&n&&n.extensions.fragDepth?dot(e):hot(e)}function cot(e,t,r,n,i,a){var o=t.polymerElements.length;if(!o)return Zf.createEmpty(a);var s=X_.create(o,o/2,a),u=t.conformation.invariantPosition,l=_(),c=function(h,v){u(h,l),s.add(l[0],l[1],l[2],v)};Dre(t,c);var d=s.getSpheres(),f=Fe.expand(Fe(),t.boundary.sphere,1*i.sizeFactor);return d.setBoundingSphere(f),d}function dot(e){return lee({defaultProps:I.getDefaultValues($L),createGeometry:cot,createLocationIterator:Xc.fromGroup,getLoci:Pv,eachLocation:Tv,setUpdateState:function(t,r,n){},mustRecreate:function(t,r,n){return!r.tryUseImpostor||!n}},e)}function fot(e,t,r,n,i,a){var o=t.polymerElements.length;if(!o)return Nt.createEmpty(a);var s=i.detail,u=i.sizeFactor,l=o*B3(s),c=wt.createState(l,l/2,a),d=t.conformation.invariantPosition,f=_(),h=Ze.create(r,t),v=function(g,y){h.element=g,d(h.element,f),c.currentGroup=y,Mi(c,f,n.size.size(h)*u,s)};Dre(t,v);var p=wt.getMesh(c),m=Fe.expand(Fe(),t.boundary.sphere,1*i.sizeFactor);return p.setBoundingSphere(m),p}function hot(e){return Ja({defaultProps:I.getDefaultValues($L),createGeometry:fot,createLocationIterator:Xc.fromGroup,getLoci:Pv,eachLocation:Tv,setUpdateState:function(t,r,n){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.detail!==n.detail},mustRecreate:function(t,r,n){return r.tryUseImpostor&&!!n}},e)}var Xne={"polymer-backbone-cylinder":function(e,t){return Jn("Polymer backbone cylinder",e,t,iot)},"polymer-backbone-sphere":function(e,t){return Jn("Polymer backbone sphere",e,t,lot)},"polymer-gap":function(e,t){return Jn("Polymer gap cylinder",e,t,zL)}},Yne=E(E(E(E({},$L),WL),yE),{sizeAspectRatio:I.Numeric(1,{min:.1,max:3,step:.1}),visuals:I.MultiSelect(["polymer-backbone-cylinder","polymer-backbone-sphere","polymer-gap"],I.objectToOptions(Xne))});function pot(e,t){var r=I.clone(Yne),n=!1;return t.units.forEach(function(i){!n&&i.gapElements.length&&(n=!0)}),r.visuals.defaultValue=["polymer-backbone-cylinder","polymer-backbone-sphere"],n&&r.visuals.defaultValue.push("polymer-gap"),r}function vot(e,t){return or.createMulti("Backbone",e,t,Ri,Xne)}var mot={name:"backbone",label:"Backbone",description:"Displays polymer backbone with cylinders and spheres.",factory:vot,getParams:pot,defaultValues:I.getDefaultValues(Yne),defaultColorTheme:{name:"chain-id"},defaultSizeTheme:{name:"uniform"},isApplicable:function(e){return e.polymerResidueCount>0}},ED=function(e){Le(t,e);function t(){var r=e.call(this)||this;return Iu(t.BuiltIn,function(n,i){if(n.name!==i)throw new Error("Fix BuiltInStructureRepresentations to have matching names. "+n.name+" "+i);r.add(n)}),r}return t}(TJ);(function(e){e.BuiltIn={cartoon:Znt,backbone:mot,"ball-and-stick":art,carbohydrate:Vrt,ellipsoid:nit,"gaussian-surface":$it,"gaussian-volume":eot,label:tat,line:Wat,"molecular-surface":hat,orientation:Cat,point:Mat,putty:Lat,spacefill:Uat}})(ED||(ED={}));var got=function(){function e(t){var r=this;this.plugin=t,this.currentFrame=void 0,this._isAnimating=!1,this.frame=function(){r.tick(Tn()),r._isAnimating&&(r.currentFrame=requestAnimationFrame(r.frame))}}return Object.defineProperty(e.prototype,"isAnimating",{get:function(){return this._isAnimating},enumerable:!1,configurable:!0}),e.prototype.tick=function(t,r){var n;return ce(this,void 0,void 0,function(){return de(this,function(i){switch(i.label){case 0:return[4,this.plugin.managers.animation.tick(t,r==null?void 0:r.isSynchronous)];case 1:return i.sent(),(n=this.plugin.canvas3d)===null||n===void 0||n.tick(t,r),[2]}})})},e.prototype.resetTime=function(t){var r;t===void 0&&(t=Tn()),(r=this.plugin.canvas3d)===null||r===void 0||r.resetTime(t)},e.prototype.start=function(t){var r;(r=this.plugin.canvas3d)===null||r===void 0||r.resume(),this._isAnimating=!0,this.resetTime(),t!=null&&t.immediate?this.frame():this.currentFrame=requestAnimationFrame(this.frame)},e.prototype.stop=function(t){var r;this._isAnimating=!1,this.currentFrame!==void 0&&(cancelAnimationFrame(this.currentFrame),this.currentFrame=void 0),t!=null&&t.noDraw&&((r=this.plugin.canvas3d)===null||r===void 0||r.pause(t==null?void 0:t.noDraw))},e}(),yot=function(){function e(t){var r=this;this.plugin=t,this.ev=Lc.create(),this.events={updated:this.ev(),removed:this.ev()},this.root=new Map,this.tracked=new Map,t.state.data.events.object.created.subscribe(function(n){r.addMapping(n.state,n.ref,n.obj)}),t.state.data.events.object.removed.subscribe(function(n){r.removeMapping(n.ref)&&r.events.removed.next({ref:n.ref,obj:n.obj})}),t.state.data.events.object.updated.subscribe(function(n){r.updateMapping(n.state,n.ref,n.oldObj,n.obj)&&r.events.updated.next({ref:n.ref,oldObj:n.oldObj,obj:n.obj})})}return e.prototype.getDecorator=function(t){var r=this.plugin.state.data.tree,n=r.children.get(t);if(n.size!==1)return t;var i=n.first();return r.transforms.get(i).transformer.definition.isDecorator?this.getDecorator(i):t},e.prototype.get=function(t,r){r===void 0&&(r=!1);var n=this.root.get(t);if(n)return r?this.plugin.state.data.cells.get(n.ref):this.plugin.state.data.cells.get(this.getDecorator(n.ref))},e.prototype.addMapping=function(t,r,n){if(!ge.Molecule.Structure.is(n))return!1;if(this.tracked.set(r,n.data),this.root.has(n.data)){var i=this.root.get(n.data);i.count++}else{var a=t.select(ir.Generators.byRef(r).rootOfType([ge.Molecule.Structure]))[0];a?this.root.set(n.data,{ref:a.transform.ref,count:1}):this.root.set(n.data,{ref:r,count:1})}return!0},e.prototype.removeMapping=function(t){if(!this.tracked.has(t))return!1;var r=this.tracked.get(t);this.tracked.delete(t);var n=this.root.get(r);return n.count>1?n.count--:this.root.delete(r),!0},e.prototype.updateMapping=function(t,r,n,i){return ge.Molecule.Structure.is(i)?(this.removeMapping(r),this.addMapping(t,r,i),!0):!1},e.prototype.dispose=function(){this.ev.dispose()},e}(),AD=function(){function e(){this.ev=Lc.create(),this.id=0,this.runningTasks=new Set,this.abortRequests=new Map,this.options=new Map,this.currentContext=[],this.events={progress:this.ev(),finished:this.ev()}}return e.prototype.tryGetAbortTaskId=function(t){if(this.abortRequests.has(t.progress.taskId))return t.progress.taskId;for(var r=0,n=t.children;r<n.length;r++){var i=n[r],a=this.tryGetAbortTaskId(i);if(a!==void 0)return a}},e.prototype.track=function(t,r){var n=this;return function(i){var a;if(i.canAbort&&i.requestAbort){var o=n.tryGetAbortTaskId(i.root);o!==void 0&&i.requestAbort(n.abortRequests.get(o))}var s=Tn()-i.root.progress.startedTime;n.events.progress.next({id:t,useOverlay:(a=n.options.get(r))===null||a===void 0?void 0:a.useOverlay,level:s<250?"none":"background",progress:i})}},e.prototype.run=function(t,r){return ce(this,void 0,void 0,function(){var n,i,a;return de(this,function(o){switch(o.label){case 0:n=this.id++,r!=null&&r.createNewContext||this.currentContext.length===0?i={ctx:hAe(t,this.track(n,t.id),100),refCount:1}:(i=this.currentContext[this.currentContext.length-1],i.refCount++),o.label=1;case 1:return o.trys.push([1,,3,4]),this.options.set(t.id,{useOverlay:!!(r!=null&&r.useOverlay)}),this.runningTasks.add(t.id),[4,RY(i.ctx,t)];case 2:return a=o.sent(),[2,a];case 3:return this.options.delete(t.id),this.runningTasks.delete(t.id),this.events.finished.next({id:n}),this.abortRequests.delete(t.id),i.refCount--,i.refCount===0&&j1(this.currentContext,i),[7];case 4:return[2]}})})},e.prototype.requestAbortAll=function(t){var r=this;this.runningTasks.forEach(function(n){return r.abortRequests.set(n,t)})},e.prototype.requestAbort=function(t,r){var n=typeof t=="number"?t:t.root.progress.taskId;this.abortRequests.set(n,r)},e.prototype.dispose=function(){this.ev.dispose()},e}();(function(e){function t(n){return new Promise(function(i){return setTimeout(i,n)})}function r(n){var i=this;return We.create("Test",function(a){return ce(i,void 0,void 0,function(){var o;return de(this,function(s){switch(s.label){case 0:o=0,s.label=1;case 1:return o<n?[4,t(100+Math.random()*200)]:[3,5];case 2:return s.sent(),a.shouldUpdate?[4,a.update({message:"Step "+o,current:o,max:n,isIndeterminate:!1})]:[3,4];case 3:s.sent(),s.label=4;case 4:return o++,[3,1];case 5:return[2]}})})})}e.testTask=r})(AD||(AD={}));var bot=function(e){Le(t,e);function t(r){var n=e.call(this,{entries:ri.OrderedMap()})||this;return n.events={changed:n.ev()},n.serialNumber=0,n.serialId=0,_t.Toast.Show.subscribe(r,function(i){return n.show(i)}),_t.Toast.Hide.subscribe(r,function(i){return n.hide(n.findByKey(i.key))}),n}return t.prototype.findByKey=function(r){return this.state.entries.find(function(n){return!!n&&n.key===r})},t.prototype.show=function(r){var n=this,i=this.state.entries,a=void 0,o=++this.serialId,s;r.key&&(a=this.findByKey(r.key))?(a.timeout!==void 0&&clearTimeout(a.timeout),s=a.serialNumber,i=i.remove(a.id)):s=++this.serialNumber,a={id:o,serialNumber:s,key:r.key,title:r.title,message:r.message,timeout:this.timeout(o,r.timeoutMs),hide:function(){return n.hideId(o)}},this.updateState({entries:i.set(o,a)})&&this.events.changed.next()},t.prototype.timeout=function(r,n){var i=this;if(n!==void 0)return n<0&&(n=500),setTimeout(function(){var a=i.state.entries.get(r);a.timeout=void 0,i.hide(a)},n)},t.prototype.hideId=function(r){this.hide(this.state.entries.get(r))},t.prototype.hide=function(r){r&&(r.timeout!==void 0&&clearTimeout(r.timeout),r.hide=void 0,this.updateState({entries:this.state.entries.delete(r.id)})&&this.events.changed.next())},t}(vd),xot=function(e){Le(t,e);function t(r){var n=e.call(this)||this;return n.plugin=r,n._params=void 0,n.behaviors={values:n.ev.behavior({transparent:n.params.transparent.defaultValue,axes:{name:"off",params:{}},resolution:n.params.resolution.defaultValue}),cropParams:n.ev.behavior({auto:!0,relativePadding:.1}),relativeCrop:n.ev.behavior({x:0,y:0,width:1,height:1})},n.events={previewed:n.ev()},n.canvas=function(){var i=document.createElement("canvas");return i}(),n.previewCanvas=function(){var i=document.createElement("canvas");return i}(),n.previewData={image:{data:new Uint8ClampedArray(1),width:1,height:0},background:at(0),transparent:!1},n}return t.prototype.createParams=function(){var r=Math.min(this.plugin.canvas3d?this.plugin.canvas3d.webgl.maxRenderbufferSize:4096,4096);return{resolution:I.MappedStatic("viewport",{viewport:I.Group({}),hd:I.Group({}),"full-hd":I.Group({}),"ultra-hd":I.Group({}),custom:I.Group({width:I.Numeric(1920,{min:128,max:r,step:1}),height:I.Numeric(1080,{min:128,max:r,step:1})},{isFlat:!0})},{options:[["viewport","Viewport"],["hd","HD (1280 x 720)"],["full-hd","Full HD (1920 x 1080)"],["ultra-hd","Ultra HD (3840 x 2160)"],["custom","Custom"]]}),transparent:I.Boolean(!1),axes:aE.axes}},Object.defineProperty(t.prototype,"params",{get:function(){return this._params?this._params:this._params=this.createParams()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"values",{get:function(){return this.behaviors.values.value},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cropParams",{get:function(){return this.behaviors.cropParams.value},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"relativeCrop",{get:function(){return this.behaviors.relativeCrop.value},enumerable:!1,configurable:!0}),t.prototype.getCanvasSize=function(){var r,n;return{width:((r=this.plugin.canvas3d)===null||r===void 0?void 0:r.webgl.gl.drawingBufferWidth)||0,height:((n=this.plugin.canvas3d)===null||n===void 0?void 0:n.webgl.gl.drawingBufferHeight)||0}},t.prototype.getSize=function(){var r=this.values;switch(r.resolution.name){case"viewport":return this.getCanvasSize();case"hd":return{width:1280,height:720};case"full-hd":return{width:1920,height:1080};case"ultra-hd":return{width:3840,height:2160};default:return{width:r.resolution.params.width,height:r.resolution.params.height}}},t.prototype.createPass=function(r){var n=this.plugin.canvas3d,i=n.webgl.extensions,a=i.colorBufferFloat,o=i.textureFloat,s=this.plugin.canvas3d.props.postprocessing.occlusion;return this.plugin.canvas3d.getImagePass({transparentBackground:this.values.transparent,cameraHelper:{axes:this.values.axes},multiSample:{mode:r?"on":"off",sampleLevel:a&&o?4:2},postprocessing:E(E({},n.props.postprocessing),{occlusion:s.name==="on"?{name:"on",params:E(E({},s.params),{samples:128})}:s})})},Object.defineProperty(t.prototype,"previewPass",{get:function(){return this._previewPass||(this._previewPass=this.createPass(!1))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"imagePass",{get:function(){if(this._imagePass){var r=this.plugin.canvas3d.props.postprocessing.occlusion;return this._imagePass.setProps({cameraHelper:{axes:this.values.axes},transparentBackground:this.values.transparent,postprocessing:E(E({},this.plugin.canvas3d.props.postprocessing),{occlusion:r.name==="on"?{name:"on",params:E(E({},r.params),{samples:128})}:r})}),this._imagePass}return this._imagePass=this.createPass(!0)},enumerable:!1,configurable:!0}),t.prototype.getFilename=function(r){r===void 0&&(r=".png");var n=this.plugin.state.data.select(ir.Generators.rootsOfType(ge.Molecule.Model)).map(function(o){return o.obj.data}),i=new Set;n.forEach(function(o){return i.add(o.entryId.toUpperCase())});var a=li.toArray(i).join("-");return""+(a||"molstar-image")+r},t.prototype.resetCrop=function(){this.behaviors.relativeCrop.next({x:0,y:0,width:1,height:1})},t.prototype.toggleAutocrop=function(){this.cropParams.auto?(this.behaviors.cropParams.next(E(E({},this.cropParams),{auto:!1})),this.resetCrop()):this.behaviors.cropParams.next(E(E({},this.cropParams),{auto:!0}))},Object.defineProperty(t.prototype,"isFullFrame",{get:function(){var r=this.relativeCrop;return hn(r.x,0,1e-5)&&hn(r.y,0,1e-5)&&hn(r.width,1,1e-5)&&hn(r.height,1,1e-5)},enumerable:!1,configurable:!0}),t.prototype.autocrop=function(r){r===void 0&&(r=this.cropParams.relativePadding);for(var n=this.previewData.image,i=n.data,a=n.width,o=n.height,s=this.previewData.transparent,u=s?this.previewData.background:4278190080|this.previewData.background,l=a,c=0,d=o,f=0,h=0;h<o;h++)for(var v=h*a,p=0;p<a;p++){var m=4*(v+p);if(s){if(i[m+3]===0)continue}else{var g=i[m]<<16|i[m+1]<<8|i[m+2]|i[m+3]<<24;if(g===u)continue}p<l&&(l=p),p>c&&(c=p),h<d&&(d=h),h>f&&(f=h)}if(l>c){var y=l;l=c,c=y}if(d>f){var y=d;d=f,f=y}var b=c-l+1,S=f-d+1;l-=r*b,c+=r*b,d-=r*S,f+=r*S;var x={x:Math.max(0,l/a),y:Math.max(0,d/o),width:Math.min(1,(c-l+1)/a),height:Math.min(1,(f-d+1)/o)};this.behaviors.relativeCrop.next(x)},t.prototype.getPreview=function(r){r===void 0&&(r=320);var n=this.getSize(),i=n.width,a=n.height;if(!(i<=0||a<=0)){var o=i/a,s=0,u=0;o>1?(s=r,u=Math.round(r/o)):(u=r,s=Math.round(r*o));var l=this.plugin.canvas3d.props;this.previewPass.setProps({cameraHelper:{axes:this.values.axes},transparentBackground:this.values.transparent,postprocessing:l.postprocessing});var c=this.previewPass.getImageData(s,u),d=this.previewCanvas;d.width=c.width,d.height=c.height,this.previewData.image=c,this.previewData.background=l.renderer.backgroundColor,this.previewData.transparent=this.values.transparent;var f=d.getContext("2d");if(!f)throw new Error("Could not create canvas 2d context");return f.putImageData(c,0,0),this.cropParams.auto&&this.autocrop(),this.events.previewed.next(),{canvas:d,width:s,height:u}}},t.prototype.getSizeAndViewport=function(){var r=this.getSize(),n=r.width,i=r.height,a=this.relativeCrop,o={x:Math.floor(a.x*n),y:Math.floor(a.y*i),width:Math.ceil(a.width*n),height:Math.ceil(a.height*i)};return o.width+o.x>n&&(o.width=n-o.x),o.height+o.y>i&&(o.height=i-o.y),{width:n,height:i,viewport:o}},t.prototype.draw=function(r){return ce(this,void 0,void 0,function(){var n,i,a,o,s,u,l;return de(this,function(c){switch(c.label){case 0:return n=this.getSizeAndViewport(),i=n.width,a=n.height,o=n.viewport,i<=0||a<=0?[2]:[4,r.update("Rendering image...")];case 1:return c.sent(),s=this.imagePass.getImageData(i,a,o),[4,r.update("Encoding image...")];case 2:if(c.sent(),u=this.canvas,u.width=s.width,u.height=s.height,l=u.getContext("2d"),!l)throw new Error("Could not create canvas 2d context");return l.putImageData(s,0,0),[2]}})})},t.prototype.copyToClipboardTask=function(){var r=this,n=navigator.clipboard;if(!(n!=null&&n.write)){this.plugin.log.error("clipboard.write not supported!");return}return We.create("Copy Image",function(i){return ce(r,void 0,void 0,function(){var a,o;return de(this,function(s){switch(s.label){case 0:return[4,this.draw(i)];case 1:return s.sent(),[4,i.update("Converting image...")];case 2:return s.sent(),[4,dV(this.canvas,"png")];case 3:return a=s.sent(),o=new ClipboardItem({"image/png":a}),[4,n.write([o])];case 4:return s.sent(),this.plugin.log.message("Image copied to clipboard."),[2]}})})})},t.prototype.getImageDataUri=function(){var r=this;return this.plugin.runTask(We.create("Generate Image",function(n){return ce(r,void 0,void 0,function(){return de(this,function(i){switch(i.label){case 0:return[4,this.draw(n)];case 1:return i.sent(),[4,n.update("Converting image...")];case 2:return i.sent(),[2,this.canvas.toDataURL("png")]}})})}))},t.prototype.copyToClipboard=function(){var r=this.copyToClipboardTask();if(r)return this.plugin.runTask(r)},t.prototype.downloadTask=function(r){var n=this;return We.create("Download Image",function(i){return ce(n,void 0,void 0,function(){var a;return de(this,function(o){switch(o.label){case 0:return[4,this.draw(i)];case 1:return o.sent(),[4,i.update("Downloading image...")];case 2:return o.sent(),[4,dV(this.canvas,"png")];case 3:return a=o.sent(),Ree(a,r??this.getFilename()),[2]}})})})},t.prototype.download=function(r){this.plugin.runTask(this.downloadTask(r))},t}(Bb),Sot=function(){function e(t){var r=this;this.spec=t,this.runTask=function(n,i){return r.managers.task.run(n,i)},this.resolveTask=function(n){if(n)return We.is(n)?r.runTask(n):n},this.subs=[],this.disposed=!1,this.ev=Lc.create(),this.config=new LHe(this.spec.config),this.state=new q_(this),this.commands=new zWe,this.canvas3dInit=this.ev.behavior(!1),this.behaviors={state:{isAnimating:this.ev.behavior(!1),isUpdating:this.ev.behavior(!1),isBusy:this.ev.behavior(!1)},interaction:{hover:this.ev.behavior({current:or.Loci.Empty,modifiers:Cu.None,buttons:0,button:0}),click:this.ev.behavior({current:or.Loci.Empty,modifiers:Cu.None,buttons:0,button:0}),drag:this.ev.behavior({current:or.Loci.Empty,modifiers:Cu.None,buttons:0,button:0,pageStart:He(),pageEnd:He()}),selectionMode:this.ev.behavior(!1)},labels:{highlight:this.ev.behavior({labels:[]})},layout:{leftPanelTabName:this.ev.behavior("root")},canvas3d:{initialized:this.canvas3dInit.pipe(S3(function(n){return!!n}),det(1))}},this.layout=new Vtt(this),this.animationLoop=new got(this),this.representation={structure:{registry:new ED,themes:{colorThemeRegistry:jc.createRegistry(),sizeThemeRegistry:Hi.createRegistry()}},volume:{registry:new H_,themes:{colorThemeRegistry:jc.createRegistry(),sizeThemeRegistry:Hi.createRegistry()}}},this.query={structure:{registry:new kHe}},this.dataFormats=new Ttt,this.builders={data:new itt(this),structure:void 0},this.helpers={substructureParent:new yot(this),viewportScreenshot:void 0},this.managers={structure:{hierarchy:new ab(this),component:new rv(this),measurement:new gQe(this),selection:new Ntt(this),focus:new Ott(this)},volume:{hierarchy:new B_(this)},interactivity:void 0,camera:new Dtt(this),animation:new Itt(this),snapshot:new R_(this),lociLabels:void 0,toast:new bot(this),asset:new ePe,task:new AD},this.events={log:this.ev(),task:this.managers.task.events,canvas3d:{settingsUpdated:this.ev()}},this.customModelProperties=new W_.Registry,this.customStructureProperties=new W_.Registry,this.customStructureControls=new Map,this.genericRepresentationControls=new Map,this.customState=Object.create(null),this.log={entries:ri.List(),entry:function(n){return r.events.log.next(n)},error:function(n){return r.events.log.next(cl.error(n))},message:function(n){return r.events.log.next(cl.message(n))},info:function(n){return r.events.log.next(cl.info(n))},warn:function(n){return r.events.log.next(cl.warning(n))}},this.fetch=DM,uTe(!1)}return e.prototype.build=function(){return this.state.data.build()},e.prototype.initViewer=function(t,r,n){var i=this,a,o,s,u,l;try{if(this.layout.setRoot(r),this.spec.layout&&this.spec.layout.initial&&this.layout.setProps(this.spec.layout.initial),n)this.canvas3dContext=n;else{var c=!((a=this.config.get(Wr.General.DisableAntialiasing))!==null&&a!==void 0&&a),d=!((o=this.config.get(Wr.General.DisablePreserveDrawingBuffer))!==null&&o!==void 0&&o),f=this.config.get(Wr.General.PixelScale)||1,h=this.config.get(Wr.General.PickScale)||.25,v=this.config.get(Wr.General.EnableWboit)||!1;this.canvas3dContext=oD.fromCanvas(t,{antialias:c,preserveDrawingBuffer:d,pixelScale:f,pickScale:h,enableWboit:v})}this.canvas3d=sD.create(this.canvas3dContext),this.canvas3dInit.next(!0);var p=this.spec.canvas3d,m=at(16579577);return p?(((u=p.renderer)===null||u===void 0?void 0:u.backgroundColor)===void 0&&(p=Jk(p,function(g){g.renderer?g.renderer.backgroundColor=m:g.renderer={backgroundColor:m}})),(l=this.canvas3d)===null||l===void 0||l.setProps(p)):(s=this.canvas3d)===null||s===void 0||s.setProps({renderer:{backgroundColor:m}}),this.animationLoop.start(),this.helpers.viewportScreenshot=new xot(this),this.subs.push(this.canvas3d.interaction.click.subscribe(function(g){return i.behaviors.interaction.click.next(g)})),this.subs.push(this.canvas3d.interaction.drag.subscribe(function(g){return i.behaviors.interaction.drag.next(g)})),this.subs.push(this.canvas3d.interaction.hover.subscribe(function(g){return i.behaviors.interaction.hover.next(g)})),this.subs.push(this.canvas3d.input.resize.subscribe(function(){return i.handleResize()})),this.subs.push(this.layout.events.updated.subscribe(function(){return requestAnimationFrame(function(){return i.handleResize()})})),this.handleResize(),!0}catch(g){return this.log.error(""+g),console.error(g),!1}},e.prototype.handleResize=function(){var t,r,n=(t=this.canvas3dContext)===null||t===void 0?void 0:t.canvas,i=this.layout.root;if(i&&n){var a=this.config.get(Wr.General.PixelScale)||1;ett(n,i,a),(r=this.canvas3d)===null||r===void 0||r.requestResize()}},Object.defineProperty(e.prototype,"isBusy",{get:function(){return this.behaviors.state.isAnimating.value||this.behaviors.state.isUpdating.value},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"selectionMode",{get:function(){return this.behaviors.interaction.selectionMode.value},set:function(t){this.behaviors.interaction.selectionMode.next(t)},enumerable:!1,configurable:!0}),e.prototype.dataTransaction=function(t,r){return this.runTask(this.state.data.transaction(t,r))},e.prototype.clear=function(t){var r;return t===void 0&&(t=!1),t&&((r=this.canvas3d)===null||r===void 0||r.setProps(eL)),_t.State.RemoveObject(this,{state:this.state.data,ref:cr.RootRef})},e.prototype.dispose=function(t){var r,n;if(!this.disposed){for(var i=0,a=this.subs;i<a.length;i++){var o=a[i];o.unsubscribe()}this.subs=[],this.commands.dispose(),(r=this.canvas3d)===null||r===void 0||r.dispose(),(n=this.canvas3dContext)===null||n===void 0||n.dispose(t),this.ev.dispose(),this.state.dispose(),this.managers.task.dispose(),this.helpers.substructureParent.dispose(),Iu(this.managers,function(s){var u,l;return(l=(u=s)===null||u===void 0?void 0:u.dispose)===null||l===void 0?void 0:l.call(u)}),Iu(this.managers.structure,function(s){var u,l;return(l=(u=s)===null||u===void 0?void 0:u.dispose)===null||l===void 0?void 0:l.call(u)}),this.disposed=!0}},e.prototype.initBehaviorEvents=function(){var t=this;this.subs.push(rc(this.state.data.behaviors.isUpdating,this.state.behaviors.behaviors.isUpdating).subscribe(function(s){t.behaviors.state.isUpdating.value!==s&&t.behaviors.state.isUpdating.next(s)}));var r=this.config.get(Wr.General.IsBusyTimeoutMs)||750,n=this.behaviors.state.isBusy,i=void 0,a=function(){n.value||n.next(!0)},o=function(){i!==void 0&&clearTimeout(i),i=void 0};this.subs.push(rc(this.behaviors.state.isUpdating,this.behaviors.state.isAnimating).subscribe(function(s){var u=t.behaviors.state.isUpdating.value,l=t.behaviors.state.isAnimating.value;u||l?n.value||(o(),i=setTimeout(a,r)):(o(),n.next(!1))})),this.subs.push(this.behaviors.interaction.selectionMode.subscribe(function(s){var u;s||(u=t.managers.interactivity)===null||u===void 0||u.lociSelects.deselectAll()}))},e.prototype.initBuiltInBehavior=function(){var t=this;px.State.registerDefault(this),px.Representation.registerDefault(this),px.Camera.registerDefault(this),px.Misc.registerDefault(this),this.subs.push(rc(this.state.data.events.log,this.state.behaviors.events.log).subscribe(function(r){return t.events.log.next(r)}))},e.prototype.initBehaviors=function(){return ce(this,void 0,void 0,function(){var t,r,n,l,i,a,u,l,o,s,u,l;return de(this,function(c){switch(c.label){case 0:for(t=this.state.behaviors.build(),r=0,n=Object.keys(Dr.Categories);r<n.length;r++)l=n[r],t.toRoot().apply(Dr.CreateCategory,{label:Dr.Categories[l]},{ref:l,state:{isLocked:!0}});for(i=0,a=this.spec.behaviors;i<a.length;i++)u=a[i],l=Dr.getCategoryId(u.transformer),l==="custom-props"&&t.to(Dr.getCategoryId(u.transformer)).apply(u.transformer,u.defaultParams,{ref:u.transformer.id});return[4,this.runTask(this.state.behaviors.updateTree(t,{doNotUpdateCurrent:!0,doNotLogTiming:!0}))];case 1:for(c.sent(),t=this.state.behaviors.build(),o=0,s=this.spec.behaviors;o<s.length;o++)u=s[o],l=Dr.getCategoryId(u.transformer),l!=="custom-props"&&t.to(Dr.getCategoryId(u.transformer)).apply(u.transformer,u.defaultParams,{ref:u.transformer.id});return[4,this.runTask(this.state.behaviors.updateTree(t,{doNotUpdateCurrent:!0,doNotLogTiming:!0}))];case 2:return c.sent(),[2]}})})},e.prototype.initCustomFormats=function(){if(this.spec.customFormats)for(var t=0,r=this.spec.customFormats;t<r.length;t++){var n=r[t];this.dataFormats.add(n[0],n[1])}},e.prototype.initAnimations=function(){if(this.spec.animations)for(var t=0,r=this.spec.animations;t<r.length;t++){var n=r[t];this.managers.animation.register(n)}},e.prototype.initDataActions=function(){if(this.spec.actions)for(var t=0,r=this.spec.actions;t<r.length;t++){var n=r[t];this.state.data.actions.add(n.action)}},e.prototype.init=function(){return ce(this,void 0,void 0,function(){var t=this;return de(this,function(r){switch(r.label){case 0:return this.subs.push(this.events.log.subscribe(function(n){return t.log.entries=t.log.entries.push(n)})),this.initCustomFormats(),this.initBehaviorEvents(),this.initBuiltInBehavior(),this.managers.interactivity=new N_(this),this.managers.lociLabels=new Rtt(this),this.builders.structure=new ptt(this),this.initAnimations(),this.initDataActions(),[4,this.initBehaviors()];case 1:return r.sent(),this.log.message("Mol* Plugin "+Q5+" ["+FWe.toLocaleString()+"]"),$g||this.log.message("Development mode enabled"),Mr&&this.log.message("Debug mode enabled"),[2]}})})},e}(),Cot=function(e){Le(t,e);function t(r){var n=e.call(this,r)||this;return n.spec=r,n.customParamEditors=new Map,n.initCustomParamEditors(),n}return t.prototype.initCustomParamEditors=function(){if(this.spec.customParamEditors)for(var r=0,n=this.spec.customParamEditors;r<n.length;r++){var i=n[r],a=i[0],o=i[1];this.customParamEditors.set(a.id,o)}},t.prototype.dispose=function(r){e.prototype.dispose.call(this,r),this.layout.dispose()},t}(Sot),rh;(function(e){function t(n){return n}e.create=t;function r(n,i){var a,o;if(i.customDurationMs)return i.customDurationMs;var s=(o=(a=i.definition).getDuration)===null||o===void 0?void 0:o.call(a,i.params,n);if((s==null?void 0:s.kind)==="fixed")return s.durationMs}e.getDuration=r})(rh||(rh={}));var _ot=rh.create({name:"built-in.animate-assembly-unwind",display:{name:"Unwind Assembly"},isExportable:!0,params:function(e){for(var t=[["all","All"]],r=e.state.data.select(ir.Generators.rootsOfType(ge.Molecule.Structure)),n=0,i=r;n<i.length;n++){var a=i[n];t.push([a.transform.ref,a.obj.data.models[0].label])}return{durationInMs:I.Numeric(3e3,{min:100,max:1e4,step:100}),playOnce:I.Boolean(!1),target:I.Select(t[0][0],t)}},canApply:function(e){var t=e.state.data,r=cr.RootRef,n=t.select(ir.Generators.ofType(ge.Molecule.Structure.Representation3D,r));return{canApply:n.length>0}},getDuration:function(e){return{kind:"fixed",durationMs:e.durationInMs}},initialState:function(){return{t:0}},setup:function(e,t,r){for(var n=r.state.data,i=!e.target||e.target==="all"?cr.RootRef:e.target,a=n.select(ir.Generators.ofType(ge.Molecule.Structure.Representation3D,i)),o=n.build(),s=!1,u=0,l=a;u<l.length;u++){var c=l[u],d=n.select(ir.Generators.ofTransformer(rt.Representation.UnwindStructureAssemblyRepresentation3D,c.transform.ref));d.length>0||(s=!0,o.to(c).apply(rt.Representation.UnwindStructureAssemblyRepresentation3D,{t:0},{tags:"animate-assembly-unwind"}))}if(s)return o.commit({doNotUpdateCurrent:!0})},teardown:function(e,t,r){var n=r.state.data,i=n.select(ir.Generators.ofType(ge.Molecule.Structure.Representation3DState).withTag("animate-assembly-unwind"));if(i.length!==0){for(var a=n.build(),o=0,s=i;o<s.length;o++){var u=s[o];a.delete(u.transform.ref)}return a.commit()}},apply:function(e,t,r){return ce(this,void 0,void 0,function(){var n,i,a,o,s,u,l,c,d,f;return de(this,function(h){switch(h.label){case 0:if(n=r.plugin.state.data,i=!r.params.target||r.params.target==="all"?cr.RootRef:r.params.target,a=n.select(ir.Generators.ofTransformer(rt.Representation.UnwindStructureAssemblyRepresentation3D,i)),a.length===0)return[2,{kind:"finished"}];for(o=n.build(),s=(t.current-t.lastApplied)/r.params.durationInMs,u=e.t+s,l=!1,r.params.playOnce&&u>=1?(l=!0,u=1):u=u%1,c=0,d=a;c<d.length;c++)f=d[c],o.to(f).update({t:u});return[4,_t.State.Update(r.plugin,{state:n,tree:o,options:{doNotLogTiming:!0}})];case 1:return h.sent(),l?[2,{kind:"finished"}]:[2,{kind:"next",state:{t:u}}]}})})}}),Nx=_(),XV=_(),YV=jn(),wot=rh.create({name:"built-in.animate-camera-spin",display:{name:"Camera Spin"},isExportable:!0,params:function(){return{durationInMs:I.Numeric(4e3,{min:100,max:2e4,step:100}),speed:I.Numeric(1,{min:1,max:10,step:1},{description:"How many times to spin in the specified dutation."}),direction:I.Select("cw",[["cw","Clockwise"],["ccw","Counter Clockwise"]],{cycle:!0})}},initialState:function(e,t){var r;return{snapshot:(r=t.canvas3d)===null||r===void 0?void 0:r.camera.getSnapshot()}},getDuration:function(e){return{kind:"fixed",durationMs:e.durationInMs}},teardown:function(e,t,r){var n;(n=r.canvas3d)===null||n===void 0||n.requestCameraReset({snapshot:t.snapshot,durationMs:0})},apply:function(e,t,r){var n,i;return ce(this,void 0,void 0,function(){var a,o,s,u;return de(this,function(l){return t.current===0?[2,{kind:"next",state:e}]:(a=e.snapshot,a.radiusMax<1e-4?[2,{kind:"finished"}]:(o=Ia(t.current/r.params.durationInMs,0,1),o>=.99999?((n=r.plugin.canvas3d)===null||n===void 0||n.requestCameraReset({snapshot:a,durationMs:0}),[2,{kind:"finished"}]):(s=2*Math.PI*o*r.params.speed*(r.params.direction==="ccw"?-1:1),_.sub(Nx,a.position,a.target),_.normalize(XV,a.up),jn.setAxisAngle(YV,XV,s),_.transformQuat(Nx,Nx,YV),u=_.add(_(),a.target,Nx),(i=r.plugin.canvas3d)===null||i===void 0||i.requestCameraReset({snapshot:E(E({},a),{position:u}),durationMs:0}),[2,{kind:"next",state:e}])))})})}}),Eot=rh.create({name:"built-in.animate-model-index",display:{name:"Animate Trajectory"},isExportable:!0,params:function(){return{mode:I.MappedStatic("loop",{palindrome:I.Group({}),loop:I.Group({direction:I.Select("forward",[["forward","Forward"],["backward","Backward"]])}),once:I.Group({direction:I.Select("forward",[["forward","Forward"],["backward","Backward"]])},{isFlat:!0})},{options:[["palindrome","Palindrome"],["loop","Loop"],["once","Once"]]}),duration:I.MappedStatic("fixed",{fixed:I.Group({durationInS:I.Numeric(5,{min:1,max:120,step:.1},{description:"Duration in seconds"})},{isFlat:!0}),computed:I.Group({targetFps:I.Numeric(30,{min:5,max:250,step:1},{label:"Target FPS"})},{isFlat:!0}),sequential:I.Group({maxFps:I.Numeric(30,{min:5,max:60,step:1})},{isFlat:!0})})}},canApply:function(e){for(var t=e.state.data,r=t.select(ir.Generators.ofTransformer(rt.Model.ModelFromTrajectory)),n=0,i=r;n<i.length;n++){var a=i[n],o=ir.findAncestorOfType(t.tree,t.cells,a.transform.ref,ge.Molecule.Trajectory);if(o&&o.obj&&o.obj.data.frameCount>1)return{canApply:!0}}return{canApply:!1,reason:"No trajectory to animate"}},getDuration:function(e,t){var r;if(((r=e.duration)===null||r===void 0?void 0:r.name)==="fixed")return{kind:"fixed",durationMs:e.duration.params.durationInS*1e3};if(e.duration.name==="computed"){for(var n=t.state.data,i=n.select(ir.Generators.ofTransformer(rt.Model.ModelFromTrajectory)),a=0,o=0,s=i;o<s.length;o++){var u=s[o],l=ir.findAncestorOfType(n.tree,n.cells,u.transform.ref,ge.Molecule.Trajectory);if(!(!l||!l.obj)){var c=l.obj;a=Math.max(Math.ceil(1e3*c.data.frameCount/e.duration.params.targetFps),a)}}return{kind:"fixed",durationMs:a}}return{kind:"unknown"}},initialState:function(){return{}},apply:function(e,t,r){return ce(this,void 0,void 0,function(){var n,i,a,o,s,u,l,c,d,f,h;return de(this,function(v){switch(v.label){case 0:if(r.params.duration.name==="sequential"&&t.current>0&&t.current-t.lastApplied<1e3/r.params.duration.params.maxFps)return[2,{kind:"skip"}];if(n=r.plugin.state.data,i=n.select(ir.Generators.ofTransformer(rt.Model.ModelFromTrajectory)),i.length===0)return[2,{kind:"finished"}];for(a=n.build(),o=r.params,s=e.palindromeDirections||{},u=!1,l=!0,c=function(p){var m=ir.findAncestorOfType(n.tree,n.cells,p.transform.ref,ge.Molecule.Trajectory);if(!m||!m.obj)return"continue";var g=m.obj;if(g.data.frameCount<=1)return"continue";a.to(p).update(function(y){var b=g.data.frameCount;if(b!==1)l=!1;else return y;if(o.duration.name==="sequential"){var S=1;if(o.mode.name==="once"){if(S=o.mode.params.direction==="backward"?-1:1,S===-1&&y.modelIndex===0||S===1&&y.modelIndex===b-1)return u=!0,y}else o.mode.name==="palindrome"&&(y.modelIndex===0?S=1:y.modelIndex===b-1?S=-1:S=s[p.transform.ref]||1);s[p.transform.ref]=S;var x=(y.modelIndex+S)%b;return x<0&&(x+=b),u=u||S===-1&&x===0||S===1&&x===b-1,{modelIndex:x}}else{var C=o.duration.name==="fixed"?o.duration.params.durationInS*1e3:Math.ceil(1e3*g.data.frameCount/o.duration.params.targetFps),w=t.current%C/C;o.mode.name==="loop"&&o.mode.params.direction==="backward"&&(w=1-w),o.mode.name==="palindrome"&&(w=2*w,w>1&&(w=2-w));var x=Math.min(Math.floor(g.data.frameCount*w),g.data.frameCount-1);return u=u||x===g.data.frameCount-1,{modelIndex:x}}})},d=0,f=i;d<f.length;d++)h=f[d],c(h);return l?[3,2]:[4,_t.State.Update(r.plugin,{state:n,tree:a,options:{doNotLogTiming:!0}})];case 1:v.sent(),v.label=2;case 2:return l||o.mode.name==="once"&&u?[2,{kind:"finished"}]:o.mode.name==="palindrome"?[2,{kind:"next",state:{palindromeDirections:s}}]:[2,{kind:"next",state:{}}]}})})}});function KV(e,t,r){var n;return r===void 0&&(r=!1),ce(this,void 0,void 0,function(){return de(this,function(i){switch(i.label){case 0:return t.snapshot.data?[4,e.runTask(e.state.data.setSnapshot(t.snapshot.data))]:[3,2];case 1:i.sent(),i.label=2;case 2:return t.snapshot.camera&&((n=e.canvas3d)===null||n===void 0||n.requestCameraReset({snapshot:t.snapshot.camera.current,durationMs:r||t.snapshot.camera.transitionStyle==="instant"?0:t.snapshot.camera.transitionDurationInMs})),[2]}})})}var Aot=rh.create({name:"built-in.animate-state-snapshots",display:{name:"State Snapshots"},isExportable:!0,params:function(){return{}},canApply:function(e){var t=e.managers.snapshot.state.entries;return t.size<2?{canApply:!1,reason:"At least 2 states required."}:t.some(function(r){return!!(r!=null&&r.snapshot.startAnimation)})?{canApply:!1,reason:"Nested animations not supported."}:{canApply:e.managers.snapshot.state.entries.size>1}},setup:function(e,t,r){var n=r.managers.snapshot.state.entries.get(0);KV(r,n,!0)},getDuration:function(e,t){return{kind:"fixed",durationMs:t.managers.snapshot.state.entries.toArray().reduce(function(r,n){var i;return r+((i=n.snapshot.durationInMs)!==null&&i!==void 0?i:0)},0)}},initialState:function(e,t){var r=t.managers.snapshot.state.entries.toArray();return{totalDuration:r.reduce(function(n,i){var a;return n+((a=i.snapshot.durationInMs)!==null&&a!==void 0?a:0)},0),snapshots:r,currentIndex:0}},apply:function(e,t,r){var n;return ce(this,void 0,void 0,function(){var i,a,o,s,u;return de(this,function(l){if(t.current>=e.totalDuration)return[2,{kind:"finished"}];for(i=0,a=0,o=0,s=e.snapshots;o<s.length&&(u=s[o],i+=(n=u.snapshot.durationInMs)!==null&&n!==void 0?n:0,!(t.current<i));o++)a++;return a>=e.snapshots.length?[2,{kind:"finished"}]:a===e.currentIndex?[2,{kind:"skip"}]:(KV(r.plugin,e.snapshots[a]),[2,{kind:"next",state:E(E({},e),{currentIndex:a})}])})})}}),Pot=go.build({from:ge.Root,display:{name:"Download Density",description:"Load a density from the provided source and create its default visual."},params:function(e,t){var r=t.dataFormats.options;return{source:I.MappedStatic("pdb-xray",{"pdb-xray":I.Group({provider:I.Group({id:I.Text("1tqn",{label:"Id"}),server:I.Select("rcsb",[["pdbe","PDBe"],["rcsb","RCSB PDB"]])},{pivot:"id"}),type:I.Select("2fofc",[["2fofc","2Fo-Fc"],["fofc","Fo-Fc"]])},{isFlat:!0}),"pdb-xray-ds":I.Group({provider:I.Group({id:I.Text("1tqn",{label:"Id"}),server:I.Select("pdbe",[["pdbe","PDBe"],["rcsb","RCSB PDB"]])},{pivot:"id"}),detail:I.Numeric(3,{min:0,max:6,step:1},{label:"Detail"})},{isFlat:!0}),"pdb-emd-ds":I.Group({provider:I.Group({id:I.Text("emd-8004",{label:"Id"}),server:I.Select("pdbe",[["pdbe","PDBe"],["rcsb","RCSB PDB"]])},{pivot:"id"}),detail:I.Numeric(3,{min:0,max:6,step:1},{label:"Detail"})},{isFlat:!0}),url:I.Group({url:I.Url(""),isBinary:I.Boolean(!1),format:I.Select("auto",r)},{isFlat:!0})},{options:[["pdb-xray","PDB X-ray maps"],["pdb-emd-ds","PDB EMD Density Server"],["pdb-xray-ds","PDB X-ray Density Server"],["url","URL"]]})}}})(function(e,t){var r=e.params;return We.create("Download Density",function(n){return ce(void 0,void 0,void 0,function(){var i,a,o,s,u,l,c,d;return de(this,function(f){switch(f.label){case 0:switch(i=r.source,i.name){case"url":a=i.params;break;case"pdb-xray":a=i.params.provider.server==="pdbe"?{url:Cn.Url(i.params.type==="2fofc"?"http://www.ebi.ac.uk/pdbe/coordinates/files/"+i.params.provider.id.toLowerCase()+".ccp4":"http://www.ebi.ac.uk/pdbe/coordinates/files/"+i.params.provider.id.toLowerCase()+"_diff.ccp4"),isBinary:!0,label:"PDBe X-ray map: "+i.params.provider.id}:{url:Cn.Url(i.params.type==="2fofc"?"https://edmaps.rcsb.org/maps/"+i.params.provider.id.toLowerCase()+"_2fofc.dsn6":"https://edmaps.rcsb.org/maps/"+i.params.provider.id.toLowerCase()+"_fofc.dsn6"),isBinary:!0,label:"RCSB X-ray map: "+i.params.provider.id};break;case"pdb-emd-ds":a=i.params.provider.server==="pdbe"?{url:Cn.Url("https://www.ebi.ac.uk/pdbe/densities/emd/"+i.params.provider.id.toLowerCase()+"/cell?detail="+i.params.detail),isBinary:!0,label:"PDBe EMD Density Server: "+i.params.provider.id}:{url:Cn.Url("https://maps.rcsb.org/em/"+i.params.provider.id.toLowerCase()+"/cell?detail="+i.params.detail),isBinary:!0,label:"RCSB PDB EMD Density Server: "+i.params.provider.id};break;case"pdb-xray-ds":a=i.params.provider.server==="pdbe"?{url:Cn.Url("https://www.ebi.ac.uk/pdbe/densities/x-ray/"+i.params.provider.id.toLowerCase()+"/cell?detail="+i.params.detail),isBinary:!0,label:"PDBe X-ray Density Server: "+i.params.provider.id}:{url:Cn.Url("https://maps.rcsb.org/x-ray/"+i.params.provider.id.toLowerCase()+"/cell?detail="+i.params.detail),isBinary:!0,label:"RCSB PDB X-ray Density Server: "+i.params.provider.id};break;default:throw new Error(i.name+" not supported.")}return[4,t.builders.data.download(a)];case 1:switch(s=f.sent(),u=void 0,i.name){case"url":a=i.params,o=i.params.format==="auto"?t.dataFormats.auto(PL(Cn.getUrl(a.url)),(c=s.cell)===null||c===void 0?void 0:c.obj):t.dataFormats.get(i.params.format);break;case"pdb-xray":u=i.params.provider.id,o=i.params.provider.server==="pdbe"?t.dataFormats.get("ccp4"):t.dataFormats.get("dsn6");break;case"pdb-emd-ds":case"pdb-xray-ds":u=i.params.provider.id,o=t.dataFormats.get("dscif");break;default:throw new Error(i.name+" not supported.")}return o?[4,o.parse(t,s,{entryId:u})]:(t.log.warn("DownloadDensity: Format provider not found."),[2]);case 2:return l=f.sent(),[4,(d=o.visuals)===null||d===void 0?void 0:d.call(o,t,l)];case 3:return f.sent(),[2]}})})})}),Kne=go.build({display:{name:"Assign Volume Colors",description:"Assigns another volume to be available for coloring."},from:ge.Volume.Data,isApplicable:function(e){return!e.data.colorVolume},params:function(e,t){var r=t.state.data.select(ir.Generators.root.subtree().ofType(ge.Volume.Data).filter(function(n){var i;return!!n.obj&&!(!((i=n.obj)===null||i===void 0)&&i.data.colorVolume)&&n.obj!==e}));return r.length===0?{ref:I.Text("",{isHidden:!0,label:"Volume"})}:{ref:I.Select(r[0].transform.ref,r.map(function(n){return[n.transform.ref,n.obj.label]}),{label:"Volume"})}}})(function(e,t){var r=e.ref,n=e.params;return e.state,t.build().to(r).apply(rt.Volume.AssignColorVolume,{ref:n.ref},{dependsOn:[n.ref]}).commit()});const Tot=Object.freeze(Object.defineProperty({__proto__:null,AssignColorVolume:Kne,DownloadDensity:Pot},Symbol.toStringTag,{value:"Module"}));var Iot=go.build({display:{name:"Open Files",description:"Load one or more files and optionally create default visuals"},from:ge.Root,params:function(e,t){var r=t.dataFormats,n=r.extensions,i=r.options;return{files:I.FileList({accept:Array.from(n.values()).map(function(a){return"."+a}).join(",")+",.gz,.zip",multiple:!0}),format:I.MappedStatic("auto",{auto:I.EmptyGroup(),specific:I.Select(i[0][0],i)}),visuals:I.Boolean(!0,{description:"Add default visuals"})}}})(function(e,t){var r=e.params,n=e.state;return We.create("Open Files",function(i){return ce(void 0,void 0,void 0,function(){return de(this,function(a){switch(a.label){case 0:return t.behaviors.layout.leftPanelTabName.next("data"),[4,n.transaction(function(){return ce(void 0,void 0,void 0,function(){var o,s,u,l,c,d,f,h,v,p,m;return de(this,function(g){switch(g.label){case 0:if(r.files===null)return t.log.error("No file(s) selected"),[2];o=0,s=r.files,g.label=1;case 1:if(!(o<s.length))return[3,9];u=s[o],g.label=2;case 2:return g.trys.push([2,7,,8]),l=PL(u.file),c=t.dataFormats.binaryExtensions.has(l.ext),[4,t.builders.data.readFile({file:u,isBinary:c})];case 3:return d=g.sent().data,f=r.format.name==="auto"?t.dataFormats.auto(l,(p=d.cell)===null||p===void 0?void 0:p.obj):t.dataFormats.get(r.format.params),f?[4,f.parse(t,d)]:(t.log.warn("OpenFiles: could not find data provider for '"+l.name+"."+l.ext+"'"),[3,8]);case 4:return h=g.sent(),r.visuals?[4,(m=f.visuals)===null||m===void 0?void 0:m.call(f,t,h)]:[3,6];case 5:g.sent(),g.label=6;case 6:return[3,8];case 7:return v=g.sent(),t.log.error(v),[3,8];case 8:return o++,[3,1];case 9:return[2]}})})}).runInContext(i)];case 1:return a.sent(),[2]}})})})}),Mot=go.build({display:{name:"Download File",description:"Load one or more file from an URL"},from:ge.Root,params:function(e,t){var r=t.dataFormats.options;return{url:I.Url(""),format:I.Select(r[0][0],r),isBinary:I.Boolean(!1),visuals:I.Boolean(!0,{description:"Add default visuals"})}}})(function(e,t){var r=e.params,n=e.state;return We.create("Open Files",function(i){return ce(void 0,void 0,void 0,function(){return de(this,function(a){switch(a.label){case 0:return t.behaviors.layout.leftPanelTabName.next("data"),[4,n.transaction(function(){return ce(void 0,void 0,void 0,function(){var o,s,u,l,c;return de(this,function(d){switch(d.label){case 0:return d.trys.push([0,5,,6]),o=t.dataFormats.get(r.format),o?[4,t.builders.data.download({url:r.url,isBinary:r.isBinary})]:(t.log.warn("DownloadFile: could not find data provider for '"+r.format+"'"),[2]);case 1:return s=d.sent(),[4,o.parse(t,s)];case 2:return u=d.sent(),r.visuals?[4,(c=o.visuals)===null||c===void 0?void 0:c.call(o,t,u)]:[3,4];case 3:d.sent(),d.label=4;case 4:return[3,6];case 5:return l=d.sent(),t.log.error(l),[3,6];case 6:return[2]}})})}).runInContext(i)];case 1:return a.sent(),[2]}})})})});const Dot=Object.freeze(Object.defineProperty({__proto__:null,DownloadFile:Mot,OpenFiles:Iot},Symbol.toStringTag,{value:"Module"}));var Nh={Structure:tKe,Volume:Tot,DataFormat:Dot},Rot=rh.create({name:"built-in.animate-state-interpolation",display:{name:"Animate State (experimental)"},params:function(){return{transtionDurationInMs:I.Numeric(2e3,{min:100,max:3e4,step:10})}},canApply:function(e){return{canApply:e.managers.snapshot.state.entries.size>1}},initialState:function(){return{}},apply:function(e,t,r){return ce(this,void 0,void 0,function(){var n,i,a,o,s,u,l,c,d,f,h,v,p,m,g,y,b,S,x,C;return de(this,function(w){switch(w.label){case 0:if(n=r.plugin.managers.snapshot.state.entries,n.size<2)return[2,{kind:"finished"}];if(i=t.current%r.params.transtionDurationInMs/r.params.transtionDurationInMs,a=Math.floor(t.current/r.params.transtionDurationInMs)%n.size,o=Math.ceil(t.current/r.params.transtionDurationInMs),o===a&&o++,o=o%n.size,s=n.get(a).snapshot,u=n.get(o).snapshot,!s.data||!u.data)return[2,{kind:"skip"}];for(l=s.data.tree.transforms,c=u.data.tree.transforms,d=r.plugin.state.data,f=d.build(),h=0,v=l;h<v.length;h++)for(p=v[h],m=0,g=c;m<g.length;m++)y=g[m],y.ref===p.ref&&y.version!==p.version&&(b=cr.fromJSON(p),S=cr.fromJSON(y),x=d.cells.get(p.ref),x&&(C=void 0,b.transformer.definition.interpolate?C=b.transformer.definition.interpolate(b.params,S.params,i,r.plugin):C=i<=.5?b.params:S.params,RC(x,C)||f.to(p.ref).update(C)));return[4,_t.State.Update(r.plugin,{state:d,tree:f,options:{doNotLogTiming:!0}})];case 1:return w.sent(),[2,{kind:"next",state:{}}]}})})}}),kot=rh.create({name:"built-in.animate-structure-spin",display:{name:"Spin Structure"},isExportable:!0,params:function(){return{durationInMs:I.Numeric(3e3,{min:100,max:1e4,step:100})}},initialState:function(){return{t:0}},getDuration:function(e){return{kind:"fixed",durationMs:e.durationInMs}},setup:function(e,t,r){return ce(this,void 0,void 0,function(){var n,i,a,o,s,u,l,c;return de(this,function(d){for(n=r.state.data,i=n.select(ir.Generators.ofType(ge.Molecule.Structure.Representation3D)),a=n.build(),o=!1,s=0,u=i;s<u.length;s++)l=u[s],c=n.select(ir.Generators.ofTransformer(rt.Representation.SpinStructureRepresentation3D,l.transform.ref)),!(c.length>0)&&(o=!0,a.to(l.transform.ref).apply(rt.Representation.SpinStructureRepresentation3D,{t:0},{tags:"animate-structure-spin"}));return o?[2,a.commit({doNotUpdateCurrent:!0})]:[2]})})},teardown:function(e,t,r){var n=r.state.data,i=n.select(ir.Generators.ofType(ge.Molecule.Structure.Representation3DState).withTag("animate-structure-spin"));if(i.length!==0){for(var a=n.build(),o=0,s=i;o<s.length;o++){var u=s[o];a.delete(u.transform.ref)}return a.commit()}},apply:function(e,t,r){var n;return ce(this,void 0,void 0,function(){var i,a,o,s,u,l,c,d;return de(this,function(f){switch(f.label){case 0:if(i=r.plugin.state.data,a=i.select(ir.Generators.ofTransformer(rt.Representation.SpinStructureRepresentation3D)),a.length===0)return[2,{kind:"finished"}];for(o=i.build(),s=(t.current-t.lastApplied)/r.params.durationInMs,u=(e.t+s)%1,l=0,c=a;l<c.length;l++)d=c[l],o.to(d).update(E(E({},(n=d.params)===null||n===void 0?void 0:n.values),{t:u}));return[4,_t.State.Update(r.plugin,{state:i,tree:o,options:{doNotLogTiming:!0}})];case 1:return f.sent(),[2,{kind:"next",state:{t:u}}]}})})}}),Jt;(function(e){function t(n,i){return{action:n,customControl:i&&i.customControl,autoUpdate:i&&i.autoUpdate}}e.Action=t;function r(n,i){return i===void 0&&(i={}),{transformer:n,defaultParams:i}}e.Behavior=r})(Jt||(Jt={}));var Oot=function(){return{actions:[Jt.Action(Nh.Structure.DownloadStructure),Jt.Action(Nh.Structure.AddTrajectory),Jt.Action(Nh.Volume.DownloadDensity),Jt.Action(Nh.DataFormat.DownloadFile),Jt.Action(Nh.DataFormat.OpenFiles),Jt.Action(Nh.Structure.EnableModelCustomProps),Jt.Action(Nh.Structure.EnableStructureCustomProps),Jt.Action(pD),Jt.Action(gJe),Jt.Action(wL),Jt.Action(rt.Data.Download),Jt.Action(rt.Data.ParseCif),Jt.Action(rt.Data.ParseCcp4),Jt.Action(rt.Data.ParseDsn6),Jt.Action(rt.Model.TrajectoryFromMmCif),Jt.Action(rt.Model.TrajectoryFromCifCore),Jt.Action(rt.Model.TrajectoryFromPDB),Jt.Action(rt.Model.TransformStructureConformation),Jt.Action(rt.Model.StructureFromModel),Jt.Action(rt.Model.StructureFromTrajectory),Jt.Action(rt.Model.ModelFromTrajectory),Jt.Action(rt.Model.StructureSelectionFromScript),Jt.Action(rt.Representation.StructureRepresentation3D),Jt.Action(rt.Representation.StructureSelectionsDistance3D),Jt.Action(rt.Representation.StructureSelectionsAngle3D),Jt.Action(rt.Representation.StructureSelectionsDihedral3D),Jt.Action(rt.Representation.StructureSelectionsLabel3D),Jt.Action(rt.Representation.StructureSelectionsOrientation3D),Jt.Action(rt.Representation.ModelUnitcell3D),Jt.Action(rt.Representation.StructureBoundingBox3D),Jt.Action(rt.Representation.ExplodeStructureRepresentation3D),Jt.Action(rt.Representation.SpinStructureRepresentation3D),Jt.Action(rt.Representation.UnwindStructureAssemblyRepresentation3D),Jt.Action(rt.Representation.OverpaintStructureRepresentation3DFromScript),Jt.Action(rt.Representation.TransparencyStructureRepresentation3DFromScript),Jt.Action(Kne),Jt.Action(rt.Volume.VolumeFromCcp4),Jt.Action(rt.Volume.VolumeFromDsn6),Jt.Action(rt.Volume.VolumeFromCube),Jt.Action(rt.Volume.VolumeFromDx),Jt.Action(rt.Representation.VolumeRepresentation3D)],behaviors:[Jt.Behavior(Io.Representation.HighlightLoci),Jt.Behavior(Io.Representation.SelectLoci),Jt.Behavior(Io.Representation.DefaultLociLabelProvider),Jt.Behavior(Io.Representation.FocusLoci),Jt.Behavior(Io.Camera.FocusLoci),Jt.Behavior(Io.Camera.CameraAxisHelper),Jt.Behavior(nL),Jt.Behavior(Io.CustomProps.StructureInfo),Jt.Behavior(Io.CustomProps.AccessibleSurfaceArea),Jt.Behavior(Io.CustomProps.BestDatabaseSequenceMapping),Jt.Behavior(Io.CustomProps.Interactions),Jt.Behavior(Io.CustomProps.SecondaryStructure),Jt.Behavior(Io.CustomProps.ValenceModel),Jt.Behavior(Io.CustomProps.CrossLinkRestraint)],animations:[Eot,wot,Aot,_ot,kot,Rot]}},Lot={color:I.Color(dr.black,{description:"Display color of the volume."}),wireframe:I.Boolean(!1,{description:"Control display of the volume as a wireframe."}),opacity:I.Numeric(.3,{min:0,max:1,step:.01},{description:"Opacity of the volume."})},Not=new Map([["em",[-5,5]],["2fo-fc",[0,3]],["fo-fc(+ve)",[1,5]],["fo-fc(-ve)",[-5,-1]]]),Fx=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.ref=ir.findTagInSubtree(r.plugin.state.data.tree,r.props.bCell.transform.ref,r.props.name),r.getVisible=function(){var n=r.plugin.state.data,i=r.ref;return i?!n.cells.get(i).state.isHidden:!1},r.toggleVisible=function(){var n=r.plugin.state.data,i=r.ref;i&&ev(n,i,!n.cells.get(i).state.isHidden)},r}return t.prototype.componentDidUpdate=function(){this.ref=ir.findTagInSubtree(this.plugin.state.data.tree,this.props.bCell.transform.ref,this.props.name)},t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.state.data.events.cell.stateUpdated,function(n){r.ref===n.ref&&r.forceUpdate()})},t.prototype.render=function(){var r=this.props,n=r.isRelative,i=r.stats,a=r.channels[r.name],o=i.min,s=i.max,u=i.mean,l=i.sigma,c=Math.round(100*(a.isoValue.kind==="relative"?a.isoValue.relativeValue:a.isoValue.absoluteValue))/100,d=(o-u)/l,f=(s-u)/l;if(!this.props.isUnbounded){var h=Not.get(this.props.name);this.props.name==="em"?(d=Math.max(h[0],d),f=Math.min(h[1],f)):(d=h[0],f=h[1])}var v=u+l*d,p=u+l*f,m=$M(n?Math.round((p-v)/l)/100:l/100,2),g=n?d:v,y=n?f:p;return T.jsx(aAe,{label:r.label+(r.isRelative?" σ":""),colorStripe:a.color,pivot:T.jsxs("div",E({className:"msp-volume-channel-inline-controls"},{children:[T.jsx(xte,{value:c,min:g,max:y,step:m,onChange:function(b){return r.changeIso(r.name,b,n)},disabled:r.params.isDisabled,onEnter:r.params.events.onEnter},void 0),T.jsx(Ht,{svg:this.getVisible()?hv:fv,onClick:this.toggleVisible,toggleState:!1,disabled:r.params.isDisabled},void 0)]}),void 0),controls:T.jsx(On,{onChange:function(b){var S=b.name,x=b.value;return r.changeParams(r.name,S,x)},params:Lot,values:a,onEnter:r.params.events.onEnter,isDisabled:r.params.isDisabled},void 0)},void 0)},t}(pr),Fot=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.changeIso=function(n,i,a){var o,s=r.props.params;r.newParams(E(E({},s),{entry:{name:s.entry.name,params:E(E({},s.entry.params),{channels:E(E({},s.entry.params.channels),(o={},o[n]=E(E({},s.entry.params.channels[n]),{isoValue:a?Ct.IsoValue.relative(i):Ct.IsoValue.absolute(i)}),o))})}}))},r.changeParams=function(n,i,a){var o,s,u=r.props.params;r.newParams(E(E({},u),{entry:{name:u.entry.name,params:E(E({},u.entry.params),{channels:E(E({},u.entry.params.channels),(o={},o[n]=E(E({},u.entry.params.channels[n]),(s={},s[i]=a,s)),o))})}}))},r.changeOption=function(n){var i=n.name,a=n.value,o=r.props.params;if(i==="entry")r.newParams(E(E({},o),{entry:{name:a,params:o.entry.params}}));else{var s=r.props.b.data,u=s.info.kind==="em",l=a.params.isRelative,c=s.info.header.sampling[0],d=o.entry.params.channels,f=o.entry.params.view.name===a.name?o.entry.params.view.params:r.props.info.params.entry.map(o.entry.name).params.view.map(a.name).defaultValue,h=E({},f);a.name==="selection-box"?h.radius=a.params.radius:a.name==="box"?(h.bottomLeft=a.params.bottomLeft,h.topRight=a.params.topRight):a.name==="auto"&&(h.radius=a.params.radius,h.selectionDetailLevel=a.params.selectionDetailLevel),h.isUnbounded=!!a.params.isUnbounded,r.newParams(E(E({},o),{entry:{name:o.entry.name,params:E(E({},o.entry.params),{view:{name:a.name,params:h},detailLevel:a.params.detailLevel,channels:u?{em:r.convert(d.em,c.valuesInfo[0],l)}:{"2fo-fc":r.convert(d["2fo-fc"],c.valuesInfo[0],l),"fo-fc(+ve)":r.convert(d["fo-fc(+ve)"],c.valuesInfo[1],l),"fo-fc(-ve)":r.convert(d["fo-fc(-ve)"],c.valuesInfo[1],l)}})}}))}},r}return t.prototype.areInitial=function(r){return I.areEqual(this.props.info.params,r,this.props.info.initialValues)},t.prototype.newParams=function(r){this.props.events.onChange(r,this.areInitial(r))},t.prototype.convert=function(r,n,i){return E(E({},r),{isoValue:i?Ct.IsoValue.toRelative(r.isoValue,n):Ct.IsoValue.toAbsolute(r.isoValue,n)})},t.prototype.render=function(){if(!this.props.b)return null;var r=this.props.b.data,n=r.info.kind==="em",i=n?"em":"2fo-fc",a=this.props.params,o=this.props.info.params.entry.map(a.entry.name),s=o.params.detailLevel,u=a.entry.params.channels[i].isoValue.kind==="relative",l=r.info.header.sampling[0],c=I.Boolean(u,{description:"Use normalized or absolute isocontour scale.",label:"Normalized"}),d=!!a.entry.params.view.params.isUnbounded,f=I.Boolean(d,{description:"Show full/limited range of iso-values for more fine-grained control.",label:"Unbounded"}),h=a.entry.params.view.name==="off",v={entry:I.Select(a.entry.name,r.data.entries.map(function(m){return[m.dataId,m.dataId]}),{isHidden:h,description:"Which entry with volume data to display."}),view:I.MappedStatic(a.entry.params.view.name,{off:I.Group({isRelative:I.Boolean(u,{isHidden:!0}),isUnbounded:I.Boolean(d,{isHidden:!0})},{description:"Display off."}),box:I.Group({bottomLeft:I.Vec3(_.zero()),topRight:I.Vec3(_.zero()),detailLevel:s,isRelative:c,isUnbounded:f},{description:"Static box defined by cartesian coords."}),"selection-box":I.Group({radius:I.Numeric(5,{min:0,max:50,step:.5},{description:"Radius in Å within which the volume is shown."}),detailLevel:s,isRelative:c,isUnbounded:f},{description:"Box around focused element."}),cell:I.Group({detailLevel:s,isRelative:c,isUnbounded:f},{description:"Box around the structure's bounding box."}),auto:I.Group({radius:I.Numeric(5,{min:0,max:50,step:.5},{description:"Radius in Å within which the volume is shown."}),detailLevel:s,selectionDetailLevel:E(E({},s),{label:"Selection Detail"}),isRelative:c,isUnbounded:f},{description:"Box around focused element."})},{options:Da.ViewTypeOptions,description:'Controls what of the volume is displayed. "Off" hides the volume alltogether. "Bounded box" shows the volume inside the given box. "Around Focus" shows the volume around the element/atom last interacted with. "Whole Structure" shows the volume for the whole structure.'})},p={entry:a.entry.name,view:{name:a.entry.params.view.name,params:{detailLevel:a.entry.params.detailLevel,radius:a.entry.params.view.params.radius,bottomLeft:a.entry.params.view.params.bottomLeft,topRight:a.entry.params.view.params.topRight,selectionDetailLevel:a.entry.params.view.params.selectionDetailLevel,isRelative:u,isUnbounded:d}}};return h?T.jsx(On,{onChange:this.changeOption,params:v,values:p,onEnter:this.props.events.onEnter,isDisabled:this.props.isDisabled},void 0):T.jsxs(T.Fragment,{children:[!n&&T.jsx(Fx,{label:"2Fo-Fc",name:"2fo-fc",bCell:this.props.bCell,channels:a.entry.params.channels,changeIso:this.changeIso,changeParams:this.changeParams,isRelative:u,params:this.props,stats:l.valuesInfo[0],isUnbounded:d},void 0),!n&&T.jsx(Fx,{label:"Fo-Fc(+ve)",name:"fo-fc(+ve)",bCell:this.props.bCell,channels:a.entry.params.channels,changeIso:this.changeIso,changeParams:this.changeParams,isRelative:u,params:this.props,stats:l.valuesInfo[1],isUnbounded:d},void 0),!n&&T.jsx(Fx,{label:"Fo-Fc(-ve)",name:"fo-fc(-ve)",bCell:this.props.bCell,channels:a.entry.params.channels,changeIso:this.changeIso,changeParams:this.changeParams,isRelative:u,params:this.props,stats:l.valuesInfo[1],isUnbounded:d},void 0),n&&T.jsx(Fx,{label:"EM",name:"em",bCell:this.props.bCell,channels:a.entry.params.channels,changeIso:this.changeIso,changeParams:this.changeParams,isRelative:u,params:this.props,stats:l.valuesInfo[0],isUnbounded:d},void 0),T.jsx(On,{onChange:this.changeOption,params:v,values:p,onEnter:this.props.events.onEnter,isDisabled:this.props.isDisabled},void 0)]},void 0)},t}(pr),Qne=function(){return E(E({},Oot()),{customParamEditors:[[wL,Fot]]})};function Bot(e,t){var r=new Cot(t||Qne());return r.init(),ER.render(Ve.createElement(Xet,{plugin:r}),e),r}var Zne=globalThis&&globalThis.__awaiter||function(e,t,r,n){function i(a){return a instanceof r?a:new r(function(o){o(a)})}return new(r||(r=Promise))(function(a,o){function s(c){try{l(n.next(c))}catch(d){o(d)}}function u(c){try{l(n.throw(c))}catch(d){o(d)}}function l(c){c.done?a(c.value):i(c.value).then(s,u)}l((n=n.apply(e,t||[])).next())})};const Uot="",Jne=e=>!!e&&Wt.isFromPdbArchive(e),jot={local_metric_values:{label_asym_id:ve.Schema.str,label_comp_id:ve.Schema.str,label_seq_id:ve.Schema.int,metric_id:ve.Schema.int,metric_value:ve.Schema.float,model_id:ve.Schema.int,ordinal_id:ve.Schema.int}},zot=(e,t)=>{if(!tn.is(t.sourceData)||!t.sourceData.data.frame.categoryNames.includes(e))return;const r=t.sourceData.data.frame.categories[e].getField("metric_value");if(!(!r||r.rowCount===0))return{timestamp_utc:r.str(0)||BWe(new Date)}},Vot=(e,t)=>{const r=zot("ma_qa_metric_local",t);if(!r)return;const n=qot(t),i=Wot(t,n.residues);return{info:r,data:i}};function Hot(e,t,r){return Zne(this,void 0,void 0,function*(){return{value:Vot(e,t)}})}function PD(e){if(!Ue.isAtomic(e.unit))return[-1,"No Score"];const t=Ff.get(e.unit.model).value;if(!t||!t.data)return[-1,"No Score"];const r=e.unit.residueIndex[e.element];return t.data.score.has(r)?t.data.score.get(r):[-1,"No Score"]}const QV=[];function Got(e){if(!e)return QV;const t=Ff.get(e.models[0]).value;return!t||!t.data?QV:t.data.category}function qot(e){if(!tn.is(e.sourceData))throw new Error("Data format must be mmCIF.");return{residues:UK(jot.local_metric_values,e.sourceData.data.frame.categories.ma_qa_metric_local)}}const d4={serverUrl:I.Text(Uot,{description:"JSON API Server URL"})},Ff=Yp.createProvider({label:"AF Confidence Score",descriptor:yo({name:"af_confidence_score"}),type:"static",defaultParams:d4,getParams:e=>d4,isApplicable:e=>Jne(e),obtain:(e,t,r)=>Zne(void 0,void 0,void 0,function*(){return Object.assign(Object.assign({},I.getDefaultValues(d4)),r),yield Hot(e,t)})});function Wot(e,t){const r=new Map,{label_asym_id:n,label_seq_id:i,metric_value:a,_rowCount:o}=t,s=[];for(let u=0;u<o;u++){const l=a.value(u),c=e.atomicHierarchy.index.findResidue("1",n.value(u),i.value(u),"");let d="Very low";l>50&&l<=70?d="Low":l>70&&l<=90?d="Medium":l>90&&(d="High"),r.set(c,[l,d]),Pa(s,d)}return{score:s5.fromResidueMap(r),category:s}}const am={"No Score":at.fromRgb(170,170,170),"Very low":at.fromRgb(255,125,69),Low:at.fromRgb(255,219,19),Medium:at.fromRgb(101,203,243),High:at.fromRgb(0,83,214)},$ot={type:I.MappedStatic("score",{score:I.Group({}),category:I.Group({kind:I.Text()})})};function eie(e,t){let r;if(e.structure&&!e.structure.isEmpty&&e.structure.models[0].customProperties.has(Ff.descriptor))if(t.type.name==="score")r=n=>{if(Ze.is(n)){const i=PD(n);return am[i[1]]}return am["No Score"]};else{const n=t.type.params.kind;r=i=>{if(Ze.is(i)){const a=PD(i);return a[1]===n?am[a[1]]:am["No Score"]}return am["No Score"]}}else r=()=>am["No Score"];return{factory:eie,granularity:"group",color:r,props:t,description:"Assigns residue colors according to the AF Confidence score"}}const ZV={name:"af-confidence",label:"AF Confidence",category:"Validation",factory:eie,getParams:e=>{const t=Got(e.structure);return t.length===0?{type:I.MappedStatic("score",{score:I.Group({})})}:{type:I.MappedStatic("score",{score:I.Group({}),category:I.Group({kind:I.Select(t[0],I.arrayToOptions(t))},{isFlat:!0})})}},defaultValues:I.getDefaultValues($ot),isApplicable:e=>{var t;return Jne((t=e.structure)===null||t===void 0?void 0:t.models[0])},ensureCustomProperties:{attach:(e,t)=>t.structure?Ff.attach(e,t.structure.models[0],void 0,!0):Promise.resolve(),detach:e=>e.structure&&e.structure.models[0].customProperties.reference(Ff.descriptor,!1)}},Xot=Dr.create({name:"af-confidence-prop",category:"custom-props",display:{name:"AlphaFold Confidence Score",description:"AlphaFold Confidence Score."},ctor:class extends Dr.Handler{constructor(){super(...arguments),this.provider=Ff,this.labelAfConfScore={label:e=>{if(this.params.showTooltip&&e.kind==="element-loci"&&e.elements.length!==0){const t=e.elements[0],r=t.unit;if(!r.model.customProperties.hasReference(Ff.descriptor))return;const n=Ze.create(e.structure,r,r.elements[Oe.getAt(t.indices,0)]),i=PD(n);return i&&i[0]>0?`Confidence score: ${i[0]} <small>( ${i[1]} )</small>`:""}}}}register(){this.ctx.customModelProperties.register(this.provider,this.params.autoAttach),this.ctx.managers.lociLabels.addProvider(this.labelAfConfScore),this.ctx.representation.structure.themes.colorThemeRegistry.add(ZV)}update(e){const t=this.params.autoAttach!==e.autoAttach;return this.params.autoAttach=e.autoAttach,this.params.showTooltip=e.showTooltip,this.ctx.customModelProperties.setDefaultAutoAttach(this.provider.descriptor.name,this.params.autoAttach),t}unregister(){this.ctx.customModelProperties.unregister(Ff.descriptor.name),this.ctx.managers.lociLabels.removeProvider(this.labelAfConfScore),this.ctx.representation.structure.themes.colorThemeRegistry.remove(ZV)}},params:()=>({autoAttach:I.Boolean(!1),showTooltip:I.Boolean(!0)})});var Yot=globalThis&&globalThis.__awaiter||function(e,t,r,n){function i(a){return a instanceof r?a:new r(function(o){o(a)})}return new(r||(r=Promise))(function(a,o){function s(c){try{l(n.next(c))}catch(d){o(d)}}function u(c){try{l(n.throw(c))}catch(d){o(d)}}function l(c){c.done?a(c.value):i(c.value).then(s,u)}l((n=n.apply(e,t||[])).next())})};const Yl={layoutIsExpanded:!1,layoutShowControls:!1,layoutShowRemoteState:!1,layoutControlsDisplay:"reactive",layoutShowSequence:!1,layoutShowLog:!1,layoutShowLeftPanel:!1,disableAntialiasing:!1,pixelScale:1,enableWboit:!1,viewportShowExpand:!0,viewportShowSelectionMode:!1,viewportShowAnimation:!1,pdbProvider:"pdbe",viewportShowControls:Wr.Viewport.ShowControls.defaultValue,viewportShowSettings:Wr.Viewport.ShowSettings.defaultValue};class Kot{constructor(t,r,n){const i=Qne(),a={actions:i.actions,behaviors:[...i.behaviors,Jt.Behavior(Xot,{autoAttach:!0,showTooltip:!0})],layout:{initial:{isExpanded:Yl.layoutIsExpanded,showControls:Yl.layoutShowControls,controlsDisplay:Yl.layoutControlsDisplay}},config:[[Wr.General.DisableAntialiasing,Yl.disableAntialiasing],[Wr.General.PixelScale,Yl.pixelScale],[Wr.General.EnableWboit,Yl.enableWboit],[Wr.Viewport.ShowExpand,Yl.viewportShowExpand],[Wr.Viewport.ShowSelectionMode,Yl.viewportShowSelectionMode],[Wr.Download.DefaultPdbProvider,Yl.pdbProvider],[Wr.Structure.DefaultRepresentationPresetParams,{theme:{globalName:"af-confidence",carbonByChainId:!1,focus:{name:"element-symbol",params:{carbonByChainId:!1}}}}]]},o=typeof t=="string"?document.getElementById(t):t;if(!o)throw new Error(`Could not get element with id '${t}'`);this.plugin=Bot(o,a),this.plugin.behaviors.interaction.click.subscribe(s=>{if(De.is(s.current.loci)){const u=Ze.create();De.getFirstLocation(s.current.loci,u);const l=lt.residue.label_seq_id(u),c=lt.chain.auth_asym_id(u);r([{position:l,chain:c}])}}),_t.Canvas3D.SetSettings(this.plugin,{settings:s=>{s.renderer.backgroundColor=at(16777215)}}),n&&(_t.Canvas3D.SetSettings(this.plugin,{settings:s=>{s.trackball.bindings.scrollZoom.triggers[0].modifiers.control=!0}}),this.plugin.canvas3dContext.input.noScroll=!1,o.addEventListener("wheel",s=>{s.ctrlKey&&s.preventDefault()},!1))}clear(t){this.plugin.clear(),t&&this.showMessage("Loading",t)}loadPdb(t,r){const n=uD.createDefaultParams(this.plugin.state.data.root.obj,this.plugin),i=this.plugin.config.get(Wr.Download.DefaultPdbProvider);return this.plugin.runTask(this.plugin.state.data.applyAction(uD,{source:{name:"pdb",params:{provider:{id:t,server:{name:i,params:aL[i].defaultValue}},options:Object.assign(Object.assign({},n.source.params.options),{representationParams:r==null?void 0:r.representationParams})}}})).then(()=>{this.clearMessages()})}loadCifUrl(t,r){return Yot(this,void 0,void 0,function*(){const{plugin:n}=this,i=yield n.builders.data.download({url:r,isBinary:!1},{state:{isGhost:!0}}),a=yield n.builders.structure.parseTrajectory(i,"mmcif");return this.plugin.builders.structure.hierarchy.applyPreset(a,"all-models",{useDefaultIfSingleModel:!0}).then(()=>this.clearMessages())})}highlight(t){var r,n;const i=(n=(r=this.plugin.managers.structure.hierarchy.current.structures[0])===null||r===void 0?void 0:r.cell.obj)===null||n===void 0?void 0:n.data;if(!i)return;const a=Li.getStructureSelection(s=>s.struct.generator.atomGroups({"residue-test":s.core.logic.or(t.map(({start:u,end:l,chain:c})=>s.core.logic.and([s.core.rel.inRange([s.struct.atomProperty.macromolecular.label_seq_id(),u,l]),s.core.rel.eq([s.struct.atomProperty.macromolecular.auth_asym_id(),c])])))}),i),o=mt.toLociWithSourceUnits(a);this.plugin.managers.camera.focusLoci(o),this.plugin.managers.interactivity.lociSelects.selectOnly({loci:o})}clearHighlight(){this.plugin.managers.interactivity.lociSelects.deselectAll(),_t.Camera.Reset(this.plugin,{})}showMessage(t,r,n){this.clearMessages(),_t.Toast.Show(this.plugin,{title:t,message:r,timeoutMs:n})}clearMessages(){_t.Toast.Hide(this.plugin)}handleResize(){this.plugin.layout.events.updated.next()}}class e1 extends Error{}const JV=(e,t,r,n)=>{if(!r)return[];if(!e||!t||Number.isNaN(e)||Number.isNaN(t))throw new e1("Invalid start, end coordinates");const i=Object.entries(yg(r,a=>a.chain_id)).map(([a,o])=>{let s=null,u=null;for(const c of o){if(c.unp_end-c.unp_start!==c.end.residue_number-c.start.residue_number)throw new e1("Mismatch between protein sequence and structure residues");const d=n==="UP_PDB"?c.unp_start:c.start.residue_number,f=n==="UP_PDB"?c.unp_end:c.end.residue_number;e>=d&&e<=f&&(s=c),t>=d&&t<=f&&(u=c)}if(s===null||u===null)return null;const l=n==="UP_PDB"?1:-1;return{entity:s.entity_id,chain:s.chain_id,start:e+l*(s.start.residue_number-s.unp_start),end:t+l*(u.start.residue_number-u.unp_start)}}).filter(Boolean);if(!i.length)throw new e1("Start or end coordinate outside of mapping range");return i};var f4=globalThis&&globalThis.__awaiter||function(e,t,r,n){function i(a){return a instanceof r?a:new r(function(o){o(a)})}return new(r||(r=Promise))(function(a,o){function s(c){try{l(n.next(c))}catch(d){o(d)}}function u(c){try{l(n.throw(c))}catch(d){o(d)}}function l(c){c.done?a(c.value):i(c.value).then(s,u)}l((n=n.apply(e,t||[])).next())})};const eH=(e,t)=>{const{ga:r}=window;r&&r("send","event","protvista-structure",e,t)};class Q_ extends HTMLElement{constructor(){super(),this._uniProtMappingUrl="https://www.ebi.ac.uk/pdbe/api/mappings/uniprot/",this._alphaFoldMappingUrl="https://alphafold.ebi.ac.uk/api/prediction/",this._planHighlight=this._planHighlight.bind(this),this.propagateHighlight=this.propagateHighlight.bind(this)}static get is(){return"protvista-structure"}get css(){return`
    protvista-structure h4 {
      display: inline;
      margin-right: 1em;
    }
      
    .structure-viewer-container {
      position: relative;
      height: ${this._height};
    }
    `}get accession(){return this._accession}set accession(t){this.setAttribute("accession",t)}get structureId(){return this._structureId}set structureId(t){this.setAttribute("structureid",t),this._structureId=t}get height(){return this.getAttribute("height")}set height(t){this.setAttribute("height",t),this._height=t}updateUrls(){this._uniProtMappingUrl=this.getAttribute("uniprot-mapping-url")||this._uniProtMappingUrl,this._alphaFoldMappingUrl=this.getAttribute("alphafold-mapping-url")||this._alphaFoldMappingUrl,this._customDownloadUrl=this.getAttribute("custom-download-url")}connectedCallback(){this.innerHTML="";const t=this.closest("protvista-manager");t&&"register"in t&&"unregister"in t&&(this.manager=t,this.manager.register(this)),this._structureId=this.getAttribute("structureid"),this._accession=this.getAttribute("accession"),this._height=this.getAttribute("height")||"480px",this._highlight=this.getAttribute("highlight")&&Q_._parseHighlight(this.getAttribute("highlight")),this.updateUrls();const r=document.createElement("style");r.innerHTML=this.css,this.appendChild(r);const n=document.createElement("div");n.className="structure-viewer-container",n.id="structure-viewer-instance",this.appendChild(n),this._structureViewer=new Kot(n,this.propagateHighlight,this.hasAttribute("use-ctrl-to-zoom"))}disconnectedCallback(){this.manager&&this.manager.unregister(this)}static get observedAttributes(){return["highlight","structureid","accession","height"]}static _parseHighlight(t){return t?t.split(",").map(n=>{const[i,a]=n.split(":");return{start:Number(i),end:Number(a)}}):[]}attributeChangedCallback(t,r,n){if(r!==n){switch(t){case"structureid":n!==null&&(this._structureId=n),this.selectMolecule();break;case"accession":this._accession=n,this.selectMolecule();break;case"highlight":this._highlight=Q_._parseHighlight(this.getAttribute("highlight"));break;case"height":this._height=n;break}this._planHighlight()}}_planHighlight(){this._plannedRender||(this._plannedRender=!0,requestAnimationFrame(()=>{this._plannedRender=!1,this._selectedMolecule&&this.highlightChain()}))}loadPDBEntry(t){var r;return f4(this,void 0,void 0,function*(){(r=this._structureViewer)===null||r===void 0||r.clear(t);try{eH("load-PDBe",t);const{payload:n}=yield L8(`${this._uniProtMappingUrl}${t}`);return n}catch(n){throw this._structureViewer.showMessage("Error","Couldn't load PDB entry"),n}})}loadAFEntry(t){var r;return f4(this,void 0,void 0,function*(){(r=this._structureViewer)===null||r===void 0||r.clear(t);try{const{payload:n}=yield L8(`${this._alphaFoldMappingUrl}${t}`);return eH("load-AF",t),n}catch(n){throw this._structureViewer.showMessage("Error","Couldn't load AF entry"),n}})}isAF(){return this._structureId.startsWith("AF-")}selectMolecule(){var t;return f4(this,void 0,void 0,function*(){if(!this._structureId||!this._accession)return;this.updateUrls();let r;if(this.isAF()){const i=(yield this.loadAFEntry(this._accession)).find(a=>a.entryId===this._structureId);yield this._structureViewer.loadCifUrl(this._structureId,i.cifUrl)}else{const n=yield this.loadPDBEntry(this._structureId);r=(t=Object.values(n)[0].UniProt[this._accession])===null||t===void 0?void 0:t.mappings,this._customDownloadUrl?yield this._structureViewer.loadCifUrl(this._structureId,`${this._customDownloadUrl}${this._structureId.toLowerCase()}.cif`):yield this._structureViewer.loadPdb(this._structureId.toLowerCase())}this._selectedMolecule={id:this._structureId,mappings:r},this._planHighlight()})}propagateHighlight(t){if(!(t!=null&&t.length)||t.some(a=>!Number.isInteger(a.position)))return;let r;try{r=N8(t,a=>JV(a.position,a.position,this._selectedMolecule.mappings,"PDB_UP").filter(o=>o.chain===a.chain)).filter(Boolean)}catch(a){if(a instanceof e1){this._structureViewer.showMessage("Error",a.message);return}throw a}if(!r.length){this._structureViewer.showMessage("Error","Residue outside of sequence range");return}const n=r.map(a=>`${a.start}:${a.end}`);this.setAttribute("highlight",n.join(","));const i=new CustomEvent("change",{detail:{highlight:n},bubbles:!0,cancelable:!0});this.dispatchEvent(i)}highlightChain(){if(!this._highlight||typeof this._highlight=="string")return;let t;try{t=N8(this._highlight,({start:r,end:n})=>this.isAF()?{start:r,end:n,chain:"A"}:JV(r,n,this._selectedMolecule.mappings,"UP_PDB")).filter(Boolean)}catch(r){if(r instanceof e1){this._structureViewer.clearHighlight(),this._structureViewer.showMessage("Error",r.message);return}throw r}if(!(t!=null&&t.length)){this._structureViewer.clearHighlight();return}this._structureViewer.highlight(t),this._structureViewer.clearMessages()}}const Qot=e=>{const t=new Map;return e.forEach(r=>{r.dataset.filter&&t.set(r.dataset.filter,new Set)}),t},Zot=(e,t,r,n)=>!r&&t===n||!n&&e===r||e<=r&&t>=n,Jot=(e,t,r,n)=>e>n||t<r,TD=zs`pd-group-trigger__expanded`,Z_=zs`active`,t1=zs`transparent`,ID=zs`overlapped`,MD=zs`hidden`,est=zs`
  protvista-datatable table {
    width: 100%;
    padding: 0;
    margin: 0;
    border-spacing: 0;
  }

  protvista-datatable table th {
    position: sticky;
    position: -webkit-sticky;
    position: -moz-sticky;
    position: -ms-sticky;
    position: -o-sticky;
    text-align: left;
    vertical-align: top;
    background-color: var(--protvista-datable__header-background, #fff);
    color: var(--protvista-datable__header-text, #393b42);
    text-overflow: ellipsis;
    top: 0;
    text-transform: uppercase;
    z-index: 400;
  }

  protvista-datatable table th .filter-wrap {
    display: flex;
    flex-direction: column;
  }

  protvista-datatable table th .filter-wrap select {
    width: fit-content;
  }

  protvista-datatable table td,
  protvista-datatable table th {
    padding: 0.2rem;
    border-bottom: 1px solid #c2c4c4;
  }

  protvista-datatable table tr:hover:not(.${Z_}):not(.${t1}) {
    background-color: var(--protvista-datatable__hover, #f1f1f1);
  }

  protvista-datatable table td {
    cursor: pointer;
  }

  protvista-datatable table .pd-group-trigger {
    width: 1rem;
  }

  protvista-datatable table .pd-group-trigger button {
    background: none;
    border: none;
    padding: 0.2rem; // increase click area
    position: relative;
    text-decoration: none;
    cursor: pointer;
    transition: background 250ms ease-in-out, transform 150ms ease;
    -webkit-appearance: none;
    -moz-appearance: none;
  }

  protvista-datatable table .pd-group-trigger button:before {
    display: inline-block;
    content: " ";
    border-style: solid;
    border-width: 0.4rem 0 0.4rem 0.6rem;
    border-color: transparent transparent transparent #161d39;
    transition-duration: 0.3s;
    transition-property: transform;
  }

  protvista-datatable table .pd-group-trigger button.${TD}:before {
    transform: rotate(90deg);
  }

  protvista-datatable table td:nth-child(1) {
    border-left: 0.5rem solid transparent;
  }

  protvista-datatable table .${ID} td:nth-child(1) {
    border-left: 0.5rem solid
      var(--protvista-datatable__overlapped, rgba(255, 0, 0, 0.8));
  }

  protvista-datatable table .${Z_} {
    background-color: var(
      --protvista-datatable__active,
      rgba(255, 235, 59, 0.3)
    ) !important;
  }

  protvista-datatable table .${t1} {
    opacity: 0.2;
  }
  protvista-datatable table .${t1} td:hover {
    cursor: default;
    background-color: inherit;
  }

  protvista-datatable table .${MD} {
    display: none;
  }

  protvista-datatable table tr[data-group-for] td {
    padding-left: 1.7rem;
    padding-bottom: 0.7rem;
  }

  protvista-datatable table .odd {
    background-color: var(--protvista-datatable__odd, #e4e8eb);
  }

  protvista-datatable table .even {
    background-color: var(--protvista-datatable__even, #fff);
  }
`;class tst extends sh{constructor(){super(),this.height="25rem",this.visibleChildren=[],this.noScrollToRow=!1,this.noDeselect=!1,this.expandTable=!1,this.scrollFilter=new bX(this),this.wheelListener=t=>this.scrollFilter.wheel(t),this.eventHandler=this.eventHandler.bind(this)}static get is(){return"protvista-datatable"}connectedCallback(){super.connectedCallback();const t=this.querySelector("table tbody");if(!t)return;this.mutationObserver=new MutationObserver(()=>{this.init()}),this.mutationObserver.observe(t,{characterData:!0,childList:!0,subtree:!0});const r=document.createElement("style");r.innerHTML=est.toString(),document.querySelector("head").appendChild(r),this.closest("protvista-manager")&&(this.manager=this.closest("protvista-manager"),this.manager.register(this)),this.noDeselect||document.addEventListener("click",this.eventHandler),this.classList.add("feature"),this.hasAttribute("filter-scroll")&&document.addEventListener("wheel",this.wheelListener),this.init()}disconnectedCallback(){super.disconnectedCallback(),this.manager&&this.manager.unregister(this),document.removeEventListener("click",this.eventHandler),document.removeEventListener("wheel",this.wheelListener),this.mutationObserver.disconnect()}init(){if(this.columns=this.querySelectorAll("table thead th"),!this.querySelector(".pd-group-column-header")){const t=document.createElement("th");t.classList.add("pd-group-column-header");const r=this.querySelector("table thead tr");r.insertBefore(t,r.firstChild)}this.rows=this.querySelectorAll("table tbody tr"),this.rows.forEach(t=>{if(!t.dataset.groupFor&&!t.querySelector(".pd-group-trigger")){const r=t.insertCell(0);if(r.classList.add("pd-group-trigger"),this.querySelector("[data-group-for]")){const n=document.createElement("button");n.dataset.triggerId=t.dataset.id,r.appendChild(n),n.addEventListener("click",i=>this.handleGroupToggle(i))}}t.addEventListener("click",r=>this.handleClick(r,t))}),this.updateRowStyling(),this.selectedFilters=new Map,this.filterMap=this.parseDataForFilters(),this.addFilterOptions()}parseDataForFilters(){const t=Qot(this.columns);return this.rows.forEach(r=>{r.childNodes.forEach(i=>{var a;!((a=i.dataset)===null||a===void 0)&&a.filter&&t.get(i.dataset.filter).add(i.dataset.filterValue)})}),t}addFilterOptions(){this.columns.forEach(t=>{if(t.dataset.filter){let r,n;t.querySelector(".filter-wrap")?(r=t.querySelector("select"),n=t.querySelector(".filter-wrap")):(n=document.createElement("span"),n.className="filter-wrap",n.innerHTML=t.innerHTML,r=document.createElement("select"),r.dataset.testid="select",r.onchange=i=>this.handleFilterChange(i,t.dataset.filter)),r.innerHTML="<option  selected value>-- Select --</option>",this.filterMap.get(t.dataset.filter).forEach(i=>{const a=document.createElement("option");a.value=i,a.label=i,a.dataset.testid="select-option",r.appendChild(a)}),t.innerHTML="",n.appendChild(r),t.appendChild(n)}})}eventHandler(t){const r=t.target;!r.closest("protvista-datatable")&&!r.closest(".feature")&&(this.selectedid=null,this.highlight=null)}static get properties(){return{highlight:{converter:t=>{if(t&&t!=="null")try{const r=t.split(":").map(n=>Number(n));if(r.length!==2)throw new Error("Highlight should be only 2 values separated by ':'.");return[r[0],r[1]]}catch(r){console.error("Invalid highlight coordinates:",r)}return null}},height:{type:String},displayStart:{type:Number},displayEnd:{type:Number},visibleChildren:{type:Array},selectedid:{type:String},noScrollToRow:{type:Boolean},noDeselect:{type:Boolean},expandTable:{type:Boolean}}}static get styles(){return zs`
      :host {
        display: block;
      }

      .protvista-datatable-container {
        overflow-y: auto;
        // Note: overflow-x was set to 'hidden' but changing
        // to 'auto' doesn't seem to be an issue.
        overflow-x: auto;
        scrollbar-gutter: stable;
      }

      :host([scrollable="true"]) .protvista-datatable-container {
        overflow-y: auto;
      }

      :host([scrollable="false"]) .protvista-datatable-container {
        overflow-y: hidden;
      }
    `}handleGroupToggle(t){const{triggerId:r}=t.target.dataset;this.visibleChildren.includes(r)?(this.visibleChildren=this.visibleChildren.filter(n=>n!==r),t.target.classList.remove(TD.cssText)):(this.visibleChildren=[...this.visibleChildren,r],t.target.classList.add(TD.cssText))}handleClick(t,r){if(r.classList.contains("transparent"))return;const{id:n,start:i,end:a}=r.dataset;this.selectedid=n;const o={};i&&a&&(o.highlight=`${i}:${a}`),this.selectedid&&(o.selectedid=this.selectedid),this.dispatchEvent(new CustomEvent("change",{detail:o,bubbles:!0,cancelable:!0}))}handleFilterChange(t,r){const{selectedOptions:n}=t.target,{value:i}=n.item(0);i?this.selectedFilters.set(r,i):this.selectedFilters.delete(r),this.updateRowStyling()}isRowVisible(t){const r=!t.dataset.groupFor||t.dataset.groupFor&&this.visibleChildren.includes(t.dataset.groupFor);if(!this.selectedFilters||this.selectedFilters.size===0)return r;for(const[n,i]of this.selectedFilters){let a;if(t.dataset.groupFor?a=this.querySelector(`[data-id="${t.dataset.groupFor}"]`).querySelector(`[data-filter="${n}"]`):a=t.querySelector(`[data-filter="${n}"]`),a&&a.dataset.filterValue!==i)return!1}return r}updateRowStyling(){var t;let r=0;(t=this.rows)===null||t===void 0||t.forEach(n=>{this.isRowVisible(n)?n.classList.remove(MD.cssText):n.classList.add(MD.cssText),n.dataset.groupFor||r++;const{start:a,end:o}=n.dataset;if(n.classList.add(r%2===0?"even":"odd"),this.selectedid&&(this.selectedid===n.dataset.id||n.dataset.groupFor===this.selectedid)?n.classList.add(Z_.cssText):n.classList.remove(Z_.cssText),Jot(this.displayStart,this.displayEnd,Number(a),Number(o))?n.classList.add(t1.cssText):n.classList.remove(t1.cssText),this.highlight&&Zot(this.highlight[0],this.highlight[1],Number(a),Number(o))?n.classList.add(ID.cssText):n.classList.remove(ID.cssText),n.dataset.groupFor){const s=this.columns.length+1;n.cells[0].colSpan=s-n.cells.length+1}})}scrollIntoView(){if(!this.selectedid)return;const t=this.querySelector(`[data-id="${this.selectedid}"]`);t==null||t.scrollIntoView({behavior:"smooth",block:"center"})}render(){const t=this.expandTable||this.hasAttribute("expand-table")?"height: auto":`max-height:${this.height}`;return zr`
      <div class="protvista-datatable-container" style=${t}>
        <slot></slot>
      </div>
    `}updated(){this.updateRowStyling(),this.noScrollToRow||this.scrollIntoView()}}const ms=function(e,t){customElements.get(e)||customElements.define(e,t)},tie=""+new URL("spinner-374aaf14.svg",import.meta.url).href,rst=""+new URL("download-325e4c97.svg",import.meta.url).href,rie=zs`
  .protvista-loader {
    display: flex;
    justify-content: center;
    padding: 4rem 0;
  }
  .protvista-loader svg {
    height: 100px;
  }

  .protvista-no-results {
    background-color: #e4e8eb;
    display: flex;
    justify-content: center;
    padding: 1rem;
    font-size: 0.8rem;
  }
`,nst=[{name:"PDBe",link:"https://www.ebi.ac.uk/pdbe-srv/view/entry/"},{name:"RCSB-PDB",link:"https://www.rcsb.org/structure/"},{name:"PDBj",link:"https://pdbj.org/mine/summary/"},{name:"PDBsum",link:"https://www.ebi.ac.uk/pdbsum/"}],ist="https://alphafold.ebi.ac.uk/entry/",ast=e=>e.dbReferences.filter(t=>t.type==="PDB").sort((t,r)=>t.id.localeCompare(r.id)).map(({id:t,properties:r})=>{if(!r)return;const{chains:n,resolution:i,method:a}=r;let o,s;if(n){const l=n.split("=");l.length===2&&([o,s]=l)}return{id:t,source:"PDB",method:a,resolution:!i||i==="-"?void 0:i,downloadLink:`https://www.ebi.ac.uk/pdbe/entry-files/download/pdb${t.toLowerCase()}.ent`,chain:o,positions:s,protvistaFeatureId:t}}).filter(t=>t!==void 0),ost=e=>e.map(t=>({id:t.entryId,source:"AlphaFold",method:"Predicted",positions:`${t.uniprotStart}-${t.uniprotEnd}`,protvistaFeatureId:t.entryId,downloadLink:t.pdbUrl})),sst=zr`
  <strong>Model Confidence:</strong>
  <ul class="no-bullet">
    <li>
      <span class="af-legend" style="background-color: rgb(0, 83, 214)"></span>
      Very high (pLDDT > 90)
    </li>
    <li>
      <span
        class="af-legend"
        style="background-color: rgb(101, 203, 243)"
      ></span>
      Confident (90 > pLDDT > 70)
    </li>
    <li>
      <span class="af-legend" style="background-color:rgb(255, 219, 19)"></span>
      Low (70 > pLDDT > 50)
    </li>
    <li>
      <span class="af-legend" style="background-color:rgb(255, 125, 69)"></span>
      Very low (pLDDT < 50)
    </li>
  </ul>
  <p class="small">
    AlphaFold produces a per-residue confidence score (pLDDT) between 0 and 100.
    Some regions with low pLDDT may be unstructured in isolation.
  </p>
`,h4="protvista-styles";class ust extends sh{constructor(){super(),ms("protvista-structure",Q_),ms("protvista-datatable",tst),this.loading=!0,this.onTableRowClick=this.onTableRowClick.bind(this),this.addStyles()}static get properties(){return{accession:{type:String},structureId:{type:String},data:{type:Object},loading:{type:Boolean}}}async connectedCallback(){if(super.connectedCallback(),!this.accession)return;const t=`https://www.ebi.ac.uk/proteins/api/proteins/${this.accession}`,r=`https://alphafold.ebi.ac.uk/api/prediction/${this.accession}`,n=[];await Promise.all([t,r].map(s=>ZX(s).then(u=>n[s]=u.payload,u=>console.warn(u)))),this.loading=!1;const i=ast(n[t]||[]),a=ost(n[r]||[]),o=[...i,...a];!o||!o.length||(this.data=o)}disconnectedCallback(){this.removeStyles()}updated(){var t;const r=this.querySelector("protvista-datatable");!(r!=null&&r.selectedid)&&(!((t=this.data)===null||t===void 0)&&t[0])&&(this.onTableRowClick({id:this.data[0].id}),r.selectedid=this.structureId)}addStyles(){var t;if(!document.getElementById(h4)){const r=document.createElement("style");r.id=h4,r.innerHTML=`
      ${rie.toString()}
      ${this.cssStyle}
      `,(t=document.querySelector("head"))===null||t===void 0||t.append(r)}}removeStyles(){const t=document.getElementById(h4);t&&t.remove()}onTableRowClick({id:t}){this.structureId=t,this.structureId.startsWith("AF-")?this.metaInfo=sst:this.metaInfo=void 0}get cssStyle(){return zs`
      .protvista-uniprot-structure__structure {
        display: flex;
      }
      .protvista-uniprot-structure__meta {
        flex: 1;
        padding: 1rem;
      }
      .protvista-uniprot-structure__structure protvista-structure {
        z-index: 40000;
        width: 100%;
        flex: 4;
      }
      .protvista-uniprot-structure__meta .small {
        font-size: 0.75rem;
      }
      .protvista-uniprot-structure__meta .no-bullet {
        list-style: none;
        padding: 0;
        margin: 0;
      }
      .protvista-uniprot-structure__meta .no-bullet li {
        padding: 0;
        margin: 0.5rem 0;
      }
      .protvista-uniprot-structure__meta .af-legend::before {
        content: '';
        margin: 0;
        display: inline-block;
        width: 20px;
        height: 16px;
      }
      .download-link svg {
        width: 1rem;
      }
    `}createRenderRoot(){return this}render(){var t;return zr`
      <div class="protvista-uniprot-structure">
        <div class="protvista-uniprot-structure__structure">
          ${this.metaInfo?zr`<div class="protvista-uniprot-structure__meta">
                ${this.metaInfo}
              </div>`:zr``}
          ${this.structureId?zr`<protvista-structure
                structureid=${this.structureId}
                accession=${this.accession}
              ></protvista-structure>`:zr``}
        </div>
        <div class="class="protvista-uniprot-structure__table">
        ${this.data&&this.data.length?zr`<protvista-datatable noScrollToRow noDeselect filter-scroll>
              <table>
                <thead>
                  <tr>
                    <th data-filter="source">Source</th>
                    <th>Identifier</th>
                    <th data-filter="method">Method</th>
                    <th>Resolution</th>
                    <th>Chain</th>
                    <th>Positions</th>
                    <th>Links</th>
                    <th><!--Download--></th>
                  </tr>
                </thead>
                <tbody>
                  ${(t=this.data)===null||t===void 0?void 0:t.map(({source:r,id:n,method:i,resolution:a,chain:o,positions:s,downloadLink:u})=>zr`<tr
                      data-id="${n}"
                      @click="${()=>this.onTableRowClick({id:n})}"
                    >
                      <td data-filter="source" data-filter-value="${r}">
                        <strong>${r}</strong>
                      </td>
                      <td>${n}</td>
                      <td data-filter="method" data-filter-value="${i}">
                        ${i}
                      </td>
                      <td>${a?a.replace("A","Å"):""}</td>
                      <td>${o||""}</td>
                      <td>${s||""}</td>
                      <td>
                        ${r==="PDB"?zr`
                              ${nst.map(l=>zr`
                                  <a href="${l.link}${n}"
                                    >${l.name}</a
                                  >
                                `).reduce((l,c)=>zr` ${l} · ${c} `)}
                            `:zr`<a href="${ist}${this.accession}"
                              >AlphaFold</a
                            >`}
                      </td>
                      <td>
                        ${u?zr`<a href="${u}" class="download-link"
                              >${RI`${NI(rst)}`}</a
                            >`:""}
                      </td>
                    </tr>`)}
                </tbody>
              </table>
            </protvista-datatable>`:zr``}
        ${this.loading?zr`<div class="protvista-loader">
              ${RI`${NI(tie)}`}
            </div>`:zr``}
        ${!this.data&&!this.loading?zr`<div class="protvista-no-results">
              No structure information available for ${this.accession}
            </div>`:zr``}
      </div>
    `}}var lst={exports:{}};(function(e){(function(t,r,n){e.exports?e.exports=n():r[t]=n()})("urljoin",$h,function(){function t(r){var n=[];if(r.length===0)return"";if(typeof r[0]!="string")throw new TypeError("Url must be a string. Received "+r[0]);if(r[0].match(/^[^/:]+:\/*$/)&&r.length>1){var i=r.shift();r[0]=i+r[0]}r[0].match(/^file:\/\/\//)?r[0]=r[0].replace(/^([^/:]+):\/*/,"$1:///"):r[0]=r[0].replace(/^([^/:]+):\/*/,"$1://");for(var a=0;a<r.length;a++){var o=r[a];if(typeof o!="string")throw new TypeError("Url must be a string. Received "+o);o!==""&&(a>0&&(o=o.replace(/^[\/]+/,"")),a<r.length-1?o=o.replace(/[\/]+$/,""):o=o.replace(/[\/]+$/,"/"),n.push(o))}var s=n.join("/");s=s.replace(/\/(\?|&|#[^!])/g,"$1");var u=s.split("?");return s=u.shift()+(u.length>0?"?":"")+u.join("&"),s}return function(){var r;return typeof arguments[0]=="object"?r=arguments[0]:r=[].slice.call(arguments),t(r)}})})(lst);var cst={exports:{}};(function(e,t){(function(r,n){n()})($h,function(){function r(l,c){return typeof c>"u"?c={autoBom:!1}:typeof c!="object"&&(console.warn("Deprecated: Expected third argument to be a object"),c={autoBom:!c}),c.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(l.type)?new Blob(["\uFEFF",l],{type:l.type}):l}function n(l,c,d){var f=new XMLHttpRequest;f.open("GET",l),f.responseType="blob",f.onload=function(){u(f.response,c,d)},f.onerror=function(){console.error("could not download file")},f.send()}function i(l){var c=new XMLHttpRequest;c.open("HEAD",l,!1);try{c.send()}catch{}return 200<=c.status&&299>=c.status}function a(l){try{l.dispatchEvent(new MouseEvent("click"))}catch{var c=document.createEvent("MouseEvents");c.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),l.dispatchEvent(c)}}var o=typeof window=="object"&&window.window===window?window:typeof self=="object"&&self.self===self?self:typeof $h=="object"&&$h.global===$h?$h:void 0,s=o.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),u=o.saveAs||(typeof window!="object"||window!==o?function(){}:"download"in HTMLAnchorElement.prototype&&!s?function(l,c,d){var f=o.URL||o.webkitURL,h=document.createElement("a");c=c||l.name||"download",h.download=c,h.rel="noopener",typeof l=="string"?(h.href=l,h.origin===location.origin?a(h):i(h.href)?n(l,c,d):a(h,h.target="_blank")):(h.href=f.createObjectURL(l),setTimeout(function(){f.revokeObjectURL(h.href)},4e4),setTimeout(function(){a(h)},0))}:"msSaveOrOpenBlob"in navigator?function(l,c,d){if(c=c||l.name||"download",typeof l!="string")navigator.msSaveOrOpenBlob(r(l,d),c);else if(i(l))n(l,c,d);else{var f=document.createElement("a");f.href=l,f.target="_blank",setTimeout(function(){a(f)})}}:function(l,c,d,f){if(f=f||open("","_blank"),f&&(f.document.title=f.document.body.innerText="downloading..."),typeof l=="string")return n(l,c,d);var h=l.type==="application/octet-stream",v=/constructor/i.test(o.HTMLElement)||o.safari,p=/CriOS\/[\d]+/.test(navigator.userAgent);if((p||h&&v||s)&&typeof FileReader<"u"){var m=new FileReader;m.onloadend=function(){var b=m.result;b=p?b:b.replace(/^data:[^;]*;/,"data:attachment/file;"),f?f.location.href=b:location=b,f=null},m.readAsDataURL(l)}else{var g=o.URL||o.webkitURL,y=g.createObjectURL(l);f?f.location=y:location.href=y,f=null,setTimeout(function(){g.revokeObjectURL(y)},4e4)}});o.saveAs=u.saveAs=u,e.exports=u})})(cst);const ac={UPDiseaseColor:"#990000",UPNonDiseaseColor:"#99cc00",predictedColor:"#4c8acd",othersColor:"#009e73"},dst={uncertain:[/uncertain/i,/conflicting/i,/unclassified/i,/risk factor/i]},fst=(e,t)=>e.some(({type:r})=>t.some(n=>n.test(r))),Fh=(e,t)=>e.map(r=>{const n=r.variants.filter(i=>t(i));return{...r,variants:[...n]}}),nie=[{name:"disease",type:{name:"consequence",text:"Filter Consequence"},options:{labels:["Likely disease"],colors:[ac.UPDiseaseColor]},filterData:e=>Fh(e,t=>{var r;return(r=t.association)===null||r===void 0?void 0:r.some(n=>n.disease)})},{name:"predicted",type:{name:"consequence",text:"Filter Consequence"},options:{labels:["Predicted consequence"],colors:[ac.predictedColor]},filterData:e=>Fh(e,t=>t.hasPredictions)},{name:"nonDisease",type:{name:"consequence",text:"Filter Consequence"},options:{labels:["Likely benign"],colors:[ac.UPNonDiseaseColor]},filterData:e=>Fh(e,t=>{var r;return(r=t.association)===null||r===void 0?void 0:r.some(n=>n.disease===!1)})},{name:"uncertain",type:{name:"consequence",text:"Filter Consequence"},options:{labels:["Uncertain"],colors:[ac.othersColor]},filterData:e=>Fh(e,t=>typeof t.clinicalSignificances>"u"&&!t.hasPredictions||t.clinicalSignificances&&fst(t.clinicalSignificances,dst.uncertain))},{name:"UniProt",type:{name:"provenance",text:"Filter Provenance"},options:{labels:["UniProt reviewed"],colors:["#9f9f9f"]},filterData:e=>Fh(e,t=>t.xrefNames&&(t.xrefNames.includes("uniprot")||t.xrefNames.includes("UniProt")))},{name:"ClinVar",type:{name:"provenance",text:"Filter Provenance"},options:{labels:["ClinVar reviewed"],colors:["#9f9f9f"]},filterData:e=>Fh(e,t=>t.xrefNames&&(t.xrefNames.includes("ClinVar")||t.xrefNames.includes("clinvar")))},{name:"LSS",type:{name:"provenance",text:"Filter Provenance"},options:{labels:["Large scale studies"],colors:["#9f9f9f"]},filterData:e=>Fh(e,t=>t.sourceType==="large_scale_study"||t.sourceType==="mixed")}],Bx=(e,t)=>{const r=[{variants:[t]}],n=nie.find(i=>i.name===e);return n?n.filterData(r)[0].variants.length>0:!1},hst=e=>Bx("disease",e)?ac.UPDiseaseColor:Bx("nonDisease",e)?ac.UPNonDiseaseColor:Bx("uncertain",e)?ac.othersColor:Bx("predicted",e)?ac.predictedColor:ac.othersColor,pst=zs`
  protvista-tooltip a {
    text-decoration: underline;
    color: #fff;
  }
  .track-content {
    width: 80vw;
  }

  .nav-container,
  .category__track {
    display: flex;
    margin-bottom: 0.1rem;
  }

  .category {
    display: none;
    margin-bottom: 0.1rem;
  }

  .category-label,
  .track-label,
  .action-buttons,
  .credits {
    width: 20vw;
    padding: 0.5em;
  }

  .action-buttons {
    display: flex;
    justify-content: flex-end;
    align-items: flex-end;
  }

  .category-label {
    background-color: #b2f5ff;
    cursor: pointer;
  }

  .category-label::before {
    content: ' ';
    display: inline-block;
    width: 0;
    height: 0;
    border-top: 5px solid transparent;
    border-bottom: 5px solid transparent;
    border-left: 5px solid #333;
    margin-right: 5px;
    -webkit-transition: all 0.1s;
    /* Safari */
    -o-transition: all 0.1s;
    transition: all 0.1s;
  }

  .category-label.open::before {
    content: ' ';
    display: inline-block;
    width: 0;
    height: 0;
    border-left: 5px solid transparent;
    border-right: 5px solid transparent;
    border-top: 5px solid #333;
    margin-right: 5px;
  }

  .track-label {
    background-color: #d9faff;
  }

  protvista-track {
    border-top: 1px solid #d9faff;
  }

  .feature {
    cursor: pointer;
  }
`,vst=LCe,mst=NCe,gst=WCe,yst=e_e,bst=t_e,xst=i_e,tH=nie,rH=hst,Sst={"protvista-feature-adapter":vst,"protvista-interpro-adapter":bst,"protvista-proteomics-adapter":mst,"protvista-structure-adapter":gst,"protvista-variation-adapter":yst,"protvista-proteomics-ptm-adapter":xst};class Cst extends sh{constructor(){super(),this.displayCoordinates={},this.openCategories=[],this.notooltip=!1,this.nostructure=!1,this.hasData=!1,this.loading=!0,this.data={},this.rawData={},this.displayCoordinates={},this.addStyles()}static get properties(){return{suspend:{type:Boolean,reflect:!0},accession:{type:String,reflect:!0},sequence:{type:String},data:{type:Object},openCategories:{type:Array},config:{type:Object},notooltip:{type:Boolean,reflect:!0},nostructure:{type:Boolean,reflect:!0}}}addStyles(){var t;const r=document.createElement("style");r.innerHTML=`${pst.toString()} ${rie.toString()}`,(t=document.querySelector("head"))===null||t===void 0||t.append(r)}registerWebComponents(){ms("protvista-navigation",v1e),ms("protvista-tooltip",m1e),ms("protvista-track",Up),ms("protvista-interpro-track",By),ms("protvista-sequence",yCe),ms("protvista-variation",Dk),ms("protvista-variation-graph",CCe),ms("protvista-filter",_Ce),ms("protvista-manager",DC),ms("protvista-uniprot-structure",ust)}async _loadData(){const t=this.accession;if(t&&this.config){const r=this.config.categories.map(({tracks:i})=>i.map(({data:a})=>a[0].url)).flat(),n=[...new Set(r)];await Promise.all(n.map(i=>ZX(i.replace("{accession}",t)).then(a=>{var o,s;this.rawData[i]=a.payload,!this.hasData&&(!((s=(o=a.payload)===null||o===void 0?void 0:o.features)===null||s===void 0)&&s.length)&&(this.hasData=!0)},a=>console.warn(a)).catch(a=>{console.log(a)}))),this.config.categories.map(({name:i,tracks:a,trackType:o})=>{const s=a.map(({data:u,name:l,filter:c})=>{const{url:d,adapter:f}=u[0],h=this.rawData[d]||[];if(!h||f==="protvista-variation-adapter"&&h.length===0)return;const v=f?Sst[f](h):h,p=Array.isArray(v)&&c?v.filter(({type:m})=>m===c):v;if(p)return this.data[`${i}-${l}`]=p,p});this.data[i]=o==="protvista-variation-graph"?s[0]:s.flat()})}this.loading=!1,this.requestUpdate()}async _loadDataInComponents(){await Ove(),Object.entries(this.data).forEach(([t,r])=>{var n,i;const a=document.getElementById(`track-${t}`);a&&a.data!==r&&(a.data=r);const o=(n=this.config)===null||n===void 0?void 0:n.categories.find(({name:s})=>s===t);if(o&&o.tracks&&r&&(r.length>0||!((i=r.variants)===null||i===void 0)&&i.length)){const s=document.getElementById(`category_${o.name}`);s&&(s.style.display="flex");for(const u of o.tracks){const l=document.getElementById(`track-${t}-${u.name}`);l&&(l.data=this.data[`${t}-${u.name}`])}}})}updated(t){super.updated(t);const r=this.querySelector("protvista-filter");r&&r.filters!==tH&&(r.filters=tH);const n=this.querySelector("protvista-variation");if(n&&n.colorConfig!==rH&&(n.colorConfig=rH),t.has("suspend")){if(this.suspend)return;this._init()}this._loadDataInComponents()}_init(){this.config||(this.config=s_e),this.accession&&(this.loadEntry(this.accession).then(t=>{var r;this.sequence=t.sequence.sequence,this.displayCoordinates={start:1,end:(r=this.sequence)===null||r===void 0?void 0:r.length}}),this._loadData())}connectedCallback(){super.connectedCallback(),this.registerWebComponents(),this.suspend||this._init(),this.addEventListener("change",t=>{var r,n,i;!((r=t.detail)===null||r===void 0)&&r.displaystart&&(this.displayCoordinates.start=t.detail.displaystart),!((n=t.detail)===null||n===void 0)&&n.displayend&&(this.displayCoordinates.end=t.detail.displayend),this.notooltip||(!((i=t.detail)===null||i===void 0)&&i.eventtype?t.detail.eventtype==="click"&&this.updateTooltip(t):this._resetTooltip())}),this.notooltip||(this.addEventListener("click",t=>{const r=t.target;if(!r.closest(".feature")&&!r.closest("protvista-tooltip")){const n=this.querySelector("protvista-tooltip");n&&(n.visible=!1)}}),document.addEventListener("click",this._resetTooltip)),this.addEventListener("load",()=>{this.hasData||(this.dispatchEvent(new CustomEvent("protvista-event",{detail:{hasData:!0},bubbles:!0})),this.hasData=!0)})}disconnectedCallback(){this.notooltip||document.removeEventListener("click",this._resetTooltip)}_resetTooltip(t){var r;if(this&&(!t||!(!((r=t.target)===null||r===void 0)&&r.closest("protvista-uniprot")))){const n=this.querySelector("protvista-tooltip");n&&(n.visible=!1)}}async loadEntry(t){try{return await(await fetch(`https://www.ebi.ac.uk/proteins/api/proteins/${t}`)).json()}catch(r){console.error("Couldn't load UniProt entry",r)}}createRenderRoot(){return this}render(){var t,r;return!this.sequence||!this.config||this.suspend?zr``:this.loading?zr`<div class="protvista-loader">
        ${RI`${NI(tie)}`}
      </div>`:this.hasData?zr`
      <protvista-manager
        attributes="length displaystart displayend highlight activefilters filters"
        additionalsubscribers="protvista-structure"
      >
        <div class="nav-container">
          <div class="action-buttons">
            <download-panel
              accession="${this.accession}"
              config="${JSON.stringify(this.config.download)}"
            />
          </div>
          <div class="track-content">
            <protvista-navigation
              length="${this.sequence.length}"
            ></protvista-navigation>
            <protvista-sequence
              length="${this.sequence.length}"
              sequence="${this.sequence}"
              displaystart=${(t=this.displayCoordinates)===null||t===void 0?void 0:t.start}
              displayend="${(r=this.displayCoordinates)===null||r===void 0?void 0:r.end}"
            ></protvista-sequence>
          </div>
        </div>
        ${this.config.categories.map(n=>this.data[n.name]&&zr`
              <div class="category" id="category_${n.name}">
                <div
                  class="category-label"
                  data-category-toggle="${n.name}"
                  @click="${this.handleCategoryClick}"
                >
                  ${n.label}
                </div>

                <div
                  data-id="category_${n.name}"
                  class="aggregate-track-content track-content"
                  .style="${this.openCategories.includes(n.name)?"opacity:0":"opacity:1"}"
                >
                  ${this.data[n.name]&&this.getTrack(n.trackType,"non-overlapping",n.color,n.shape,n.name)}
                </div>
              </div>

              <!-- Expanded Categories -->
              ${n.tracks&&n.tracks.map(i=>{if(this.openCategories.includes(n.name)){const a=this.data[`${n.name}-${i.name}`];return a&&(Array.isArray(a)&&a.length||Object.keys(a).length)?zr`
                        <div class="category__track" id="track_${i.name}">
                          <div class="track-label" title="${i.tooltip}">
                            ${i.filterComponent?this.getFilterComponent(`${n.name}-${i.name}`):i.label}
                          </div>
                          <div
                            class="track-content"
                            data-id="track_${i.name}"
                          >
                            ${this.getTrack(i.trackType,"non-overlapping",i.color||n.color,i.shape||n.shape,`${n.name}-${i.name}`)}
                          </div>
                        </div>
                      `:""}})}
              ${n.tracks?"":this.data[n.name].map(i=>{if(this.openCategories.includes(n.name))return!i||!i.accession?"":zr`
                          <div
                            class="category__track"
                            id="track_${i.accession}"
                          >
                            <div class="track-label" title="${i.accession}">
                              ${i.accession}
                            </div>
                            <div
                              class="track-content"
                              data-id="track_${i.accession}"
                            >
                              ${this.getTrack(n.trackType,"non-overlapping",n.color,n.shape,`${n.name}-${i.accession}`)}
                            </div>
                          </div>
                        `})}
            `)}
        <div class="nav-container">
          <div class="credits"></div>
          <div class="track-content">
            <protvista-sequence
              length="${this.sequence.length}"
              sequence="${this.sequence}"
              displaystart=${this.displayCoordinates.start}
              displayend="${this.displayCoordinates.end}"
            ></protvista-sequence>
          </div>
        </div>
        ${this.nostructure?"":zr`
              <protvista-uniprot-structure
                accession="${this.accession||""}"
              ></protvista-uniprot-structure>
            `}
        <protvista-tooltip />
      </protvista-manager>
    `:zr`<div class="protvista-no-results">
        No feature data available for ${this.accession}
      </div>`}async updateTooltip(t){var r,n;const i=(r=t.detail)===null||r===void 0?void 0:r.feature;if(!i.tooltipContent)return;const a=this.querySelector("protvista-tooltip");if(a&&(a.title=`${i.type} ${i.start}-${i.end}`,a.innerHTML=i.tooltipContent,a.visible=!0,!((n=t.detail)===null||n===void 0)&&n.coords)){const[o,s]=t.detail.coords;a.x=o,a.y=s}}handleCategoryClick(t){const r=t.target,n=r.getAttribute("data-category-toggle");n&&!r.classList.contains("open")?(r.classList.add("open"),this.openCategories=[...this.openCategories,n]):(r.classList.remove("open"),this.openCategories=[...this.openCategories].filter(i=>i!==n))}getCategoryTypesAsString(t){return t.map(r=>r.filter).join(",")}getFilterComponent(t){return zr`
      <protvista-filter
        style="minWidth: 20%"
        for="track-${t}"
      ></protvista-filter>
    `}getTrack(t,r="",n="",i="",a=""){var o,s,u,l,c,d,f,h,v,p,m,g;switch(t){case"protvista-track":return zr`
          <protvista-track
            length="${(o=this.sequence)===null||o===void 0?void 0:o.length}"
            layout="${r}"
            color="${n}"
            shape="${i}"
            displaystart="${(s=this.displayCoordinates)===null||s===void 0?void 0:s.start}"
            displayend="${(u=this.displayCoordinates)===null||u===void 0?void 0:u.end}"
            id="track-${a}"
          >
          </protvista-track>
        `;case"protvista-interpro-track":return zr`
          <protvista-interpro-track
            length="${(l=this.sequence)===null||l===void 0?void 0:l.length}"
            color="${n}"
            shape="${i}"
            displaystart="${(c=this.displayCoordinates)===null||c===void 0?void 0:c.start}"
            displayend="${(d=this.displayCoordinates)===null||d===void 0?void 0:d.end}"
            id="track-${a}"
          >
          </protvista-interpro-track>
        `;case"protvista-variation":return zr`
          <protvista-variation
            length="${(f=this.sequence)===null||f===void 0?void 0:f.length}"
            displaystart="${(h=this.displayCoordinates)===null||h===void 0?void 0:h.start}"
            displayend="${(v=this.displayCoordinates)===null||v===void 0?void 0:v.end}"
            id="track-${a}"
          >
          </protvista-variation>
        `;case"protvista-variation-graph":return zr`
          <protvista-variation-graph
            length="${(p=this.sequence)===null||p===void 0?void 0:p.length}"
            displaystart="${(m=this.displayCoordinates)===null||m===void 0?void 0:m.start}"
            displayend="${(g=this.displayCoordinates)===null||g===void 0?void 0:g.end}"
            id="track-${a}"
          >
          </protvista-variation-graph>
        `;default:console.warn("No Matching ProtvistaTrack Found.");break}}}const _st=({proteinData:e})=>{const t=Ve.useRef(null);return Ve.useEffect(()=>{if(typeof window<"u"&&window.document&&(window.customElements.get("protvista-uniprot")||window.customElements.define("protvista-uniprot",Cst),t.current)){const r=document.createElement("protvista-uniprot");r.setAttribute("accession",e.id),t.current.appendChild(r)}},[e.id]),T.jsx("div",{ref:t,className:"protein-feature-viewer-wrapper"})};var wS=(e=>(e[e.PUBMED=0]="PUBMED",e[e.EUROPEPMC=1]="EUROPEPMC",e[e.DOI=2]="DOI",e))(wS||{});const p4=e=>{if(!e.id&&e.type!=2)return T.jsx(T.Fragment,{});let t;switch(e.type){case 0:t=`${vp.PUBMED_HOST}${e.id}`;break;case 1:t=`${vp.PMC_HOST}${e.id}`;break;case 2:t=`${vp.DOI_HOST}${e.id}`;break}const r=n=>T.jsxs("div",{className:"protein-publications-link-content",children:[n,T.jsx("svg",{width:"14",height:"14",viewBox:"0 0 14 14",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:T.jsx("path",{d:"M8.55556 1.55556C8.34928 1.55556 8.15145 1.47361 8.00558 1.32775C7.85972 1.18189 7.77778 0.984057 7.77778 0.777778C7.77778 0.571498 7.85972 0.373667 8.00558 0.227806C8.15145 0.0819442 8.34928 0 8.55556 0H13.2222C13.4285 0 13.6263 0.0819442 13.7722 0.227806C13.9181 0.373667 14 0.571498 14 0.777778V5.44444C14 5.65072 13.9181 5.84855 13.7722 5.99442C13.6263 6.14028 13.4285 6.22222 13.2222 6.22222C13.0159 6.22222 12.8181 6.14028 12.6722 5.99442C12.5264 5.84855 12.4444 5.65072 12.4444 5.44444V2.65533L5.21656 9.88322C5.06986 10.0249 4.8734 10.1033 4.66947 10.1015C4.46554 10.0998 4.27046 10.018 4.12625 9.87375C3.98205 9.72954 3.90025 9.53446 3.89848 9.33053C3.8967 9.1266 3.9751 8.93014 4.11678 8.78344L11.3447 1.55556H8.55556ZM0 3.11111C0 2.69855 0.163888 2.30289 0.455612 2.01117C0.747335 1.71944 1.143 1.55556 1.55556 1.55556H5.44444C5.65072 1.55556 5.84855 1.6375 5.99442 1.78336C6.14028 1.92922 6.22222 2.12705 6.22222 2.33333C6.22222 2.53961 6.14028 2.73744 5.99442 2.88331C5.84855 3.02917 5.65072 3.11111 5.44444 3.11111H1.55556V12.4444H10.8889V8.55556C10.8889 8.34928 10.9708 8.15145 11.1167 8.00558C11.2626 7.85972 11.4604 7.77778 11.6667 7.77778C11.8729 7.77778 12.0708 7.85972 12.2166 8.00558C12.3625 8.15145 12.4444 8.34928 12.4444 8.55556V12.4444C12.4444 12.857 12.2806 13.2527 11.9888 13.5444C11.6971 13.8361 11.3014 14 10.8889 14H1.55556C1.143 14 0.747335 13.8361 0.455612 13.5444C0.163888 13.2527 0 12.857 0 12.4444V3.11111Z"})})]});return e.type!=2||e.id?T.jsx("a",{href:t,target:"_blank",rel:"noopener noreferrer",className:"protein-publications-link protein-publications-link-enabled",children:r(e.title)}):T.jsx("div",{className:"protein-publications-link protein-publications-link-disabled",children:r(e.title)})},wst=({proteinid:e})=>{const t=qw(),[r,n]=Ve.useState(!1),i=hg(s=>s.appState.proteinCache),a=Ve.useMemo(()=>i[e].publications,[i,e]);Ve.useEffect(()=>{(!a||a.length==0)&&(n(!0),t(Jpe(e)).finally(()=>{n(!1)}))},[a,t]);const o=()=>r?T.jsx(Ww,{}):a?T.jsx(T.Fragment,{children:a.map(s=>{var u,l,c,d,f,h,v;return T.jsxs("div",{className:"protein-publications-publication",children:[T.jsx("div",{className:"protein-publications-publication-title",children:s.title}),T.jsx("div",{className:"protein-publications-publication-authors",children:Array.isArray(s.authors)&&((u=s.authors)==null?void 0:u.map((p,m)=>T.jsxs("span",{children:[m>0?", ":"",T.jsx("span",{className:"protein-publication-author",children:p})]},s.id+p+m)))}),T.jsxs("div",{className:"protein-publications-publication-prop",children:[T.jsx("span",{className:"protein-publications-publication-prop-key",children:"Categories: "}),T.jsx("span",{className:"protein-publications-publication-prop-value",children:Array.isArray(s.references)&&Array.isArray((l=s.references[0])==null?void 0:l.categories)&&((d=(c=s.references[0])==null?void 0:c.categories)==null?void 0:d.map((p,m)=>T.jsxs("span",{children:[m>0?", ":"",p]},s.id+p)))})]}),T.jsxs("div",{className:"protein-publications-publication-prop",children:[T.jsx("span",{className:"protein-publications-publication-prop-key",children:"Cited for: "}),T.jsx("span",{className:"protein-publications-publication-prop-value",children:Array.isArray(s.references)&&Array.isArray(s.references[0].positions)&&((h=(f=s.references[0])==null?void 0:f.positions)==null?void 0:h.map((p,m)=>T.jsxs("span",{children:[m>0?", ":"",p]},s.id+p)))})]}),T.jsxs("div",{className:"protein-publications-publication-prop",children:[T.jsx("span",{className:"protein-publications-publication-prop-key",children:"Source: "}),T.jsx("span",{className:"protein-publications-publication-prop-value",children:(Array.isArray(s.references)&&((v=s.references[0])==null?void 0:v.source))??""})]}),T.jsxs("div",{className:"protein-publications-publication-links",children:[T.jsx(p4,{id:s.id,title:"PubMed",type:wS.PUBMED},"pm_"+s.id),T.jsx(p4,{id:s.id,title:"Europe PMC",type:wS.EUROPEPMC},"ep_"+s.id),T.jsx(p4,{id:s.doiId,title:`${s.journal} ${s.volume}:${s.firstPage} ${s.lastPage} (${s.publicationDate})`,type:wS.DOI},"doi_"+s.doiId)]})]},s.id)})}):T.jsx("div",{className:"protein-publications-no-data",children:"No Publications found"});return T.jsx("div",{className:"protein-publications-wrapper",children:o()})},Est=()=>{const{id:e}=pde(),t=qw(),[r,n]=Ve.useState(!1),[i,a]=Ve.useState("tab1"),o=hg(d=>d.appState.proteinCache),s=Ve.useMemo(()=>o[e],[o,e]);Ve.useEffect(()=>{e&&(s||(n(!0),t(Zpe(e)).finally(()=>{n(!1)})))},[e,t]);const u=d=>{a(d)},l=()=>r?T.jsx(Ww,{}):s?T.jsxs(T.Fragment,{children:[T.jsx(ive,{proteinData:s}),T.jsxs("div",{className:"protein-page-tab-buttons",children:[T.jsx("div",{className:`protein-page-tab-button ${i==="tab1"?"protein-page-tab-button-active":""}`,onClick:()=>u("tab1"),children:"Details"}),T.jsx("div",{className:`protein-page-tab-button ${i==="tab2"?"protein-page-tab-button-active":""}`,onClick:()=>u("tab2"),children:"Feature Viewer"}),T.jsx("div",{className:`protein-page-tab-button ${i==="tab3"?"protein-page-tab-button-active":""}`,onClick:()=>u("tab3"),children:"Publications"})]})]}):T.jsx("div",{className:"protein-no-data",children:"Protein ID is not found"}),c=()=>{if(!s)return null;switch(i){case"tab1":return T.jsx(WF,{proteinData:s});case"tab2":return T.jsx(_st,{proteinData:s});case"tab3":return T.jsx(wst,{proteinid:s.id});default:return T.jsx(WF,{proteinData:s})}};return T.jsxs(T.Fragment,{children:[T.jsx(zR,{}),T.jsx("div",{className:"protein-page-wrapper-scroll",children:T.jsxs("div",{className:"protein-page-wrapper",children:[l(),T.jsx("div",{className:"protein-page-tab",children:c()})]})})]})};const iie=new RegExp("[^@s]+@[^@s]+.[^@s]+$"),Ast=new RegExp("[a-z]"),Pst=new RegExp("[A-Z]"),Tst=new RegExp("[0-9]"),Ist=()=>{const[e,t]=du.useState(""),[r,n]=du.useState(""),[i,a]=du.useState(""),[o,s]=du.useState(""),u=()=>e.length===0?(s(""),!0):r!==i?(s("Passwords do not match!"),!0):e.length>0&&!iie.test(e)?(s("Login must be a valid e-mail!"),!0):r.length===0&&i.length===0?(s(""),!0):(r.length>0||i.length>0)&&(r.length<6||!Ast.test(r)||!Pst.test(r)||!Tst.test(r))?(s("Password must be at least 6 symbols, contain uppercase, lowercase letter and a number."),!0):(s(""),!1),l=Ve.useMemo(()=>u(),[e,r,i]),c=async()=>{try{const f=(await yle(Op,e,r)).user;console.info("User created: "+f)}catch(d){const f=d,h=f.code,v=f.message;s("Sign Up Error: "+v+" code: "+h)}};return T.jsxs(T.Fragment,{children:[T.jsx("h3",{className:"form-h3",children:"Sign Up"}),T.jsx("label",{className:"form-label",htmlFor:"login-input",children:"Email"}),T.jsx("input",{className:"form-input form-text-input",id:"login-input",type:"email",value:e,onChange:d=>t(d.target.value),name:"login-input",placeholder:"Enter your email"}),T.jsx("label",{className:"form-label",htmlFor:"password-input",children:"Password"}),T.jsx("input",{className:"form-input form-text-input",id:"password-input",type:"password",value:r,onChange:d=>n(d.target.value),name:"password-input",placeholder:"Enter your password"}),T.jsx("label",{className:"form-label",htmlFor:"password-input-repeat",children:"Repeat Password"}),T.jsx("input",{className:"form-input form-text-input",id:"password-input-repeat",type:"password",value:i,onChange:d=>a(d.target.value),name:"password-input-repeat",placeholder:"Enter your password again"}),T.jsx("div",{className:"error-message",children:o}),T.jsx("button",{className:"form-button",onClick:c,disabled:l,children:"Create Account"})]})},Mst=()=>{const e=Qc(),[t,r]=du.useState(""),[n,i]=du.useState(""),[a,o]=du.useState(""),s=()=>t.length===0?(o(""),!0):iie.test(t)?n.length===0?(o(""),!0):n.length<6?(o("Password must be at least 6 symbols!"),!0):(o(""),!1):(o("Login must be a valid e-mail!"),!0),u=Ve.useMemo(()=>s(),[t,n]),l=async()=>{ble(Op,t,n).then(c=>{const d=c.user;console.log("User signed in: "+d.email),e("/search")}).catch(c=>{const d=c.code,f=c.message;o("Login Error: "+f+" code: "+d)})};return T.jsxs(T.Fragment,{children:[T.jsx("h3",{className:"form-h3",children:"Login"}),T.jsx("label",{className:"form-label",htmlFor:"login-input",children:"Email"}),T.jsx("input",{className:"form-input form-text-input",id:"login-input",autoComplete:"current-login",type:"email",value:t,onChange:c=>r(c.target.value),name:"login-input",placeholder:"Enter your email"}),T.jsx("label",{className:"form-label",htmlFor:"password-input",children:"Password"}),T.jsx("input",{className:"form-input form-text-input",id:"password-input",type:"password",autoComplete:"current-password",value:n,onChange:c=>i(c.target.value),name:"password-input",placeholder:"Enter your password"}),T.jsx("div",{className:"error-message",children:a}),T.jsx("button",{className:"form-button",disabled:u,onClick:l,children:"Login"})]})};const Dst=()=>{const e=Qc(),[t,r]=Ve.useState(!0);return Ve.useEffect(()=>{const n=LR(Op,i=>{i&&e("/search")});return()=>n()},[]),T.jsx("div",{className:"auth-wrapper",children:T.jsxs("div",{className:"auth-form-container",children:[t?T.jsx(Mst,{}):T.jsx(Ist,{}),T.jsxs("div",{className:"auth-form-text-small",children:[t?"Don't have an account? ":"Already have an account? ",T.jsx("span",{className:"auth-form-link",onClick:()=>r(!t),children:t?"Sign Up":"Login"}),"!"]})]})})};const Rst=()=>{const e=Qc(),t=()=>{e("/search")};return T.jsxs(T.Fragment,{children:[T.jsx(zR,{}),T.jsxs("div",{className:"notfound-content",children:[T.jsx("span",{className:"notfound-header",children:"404"}),T.jsx("span",{className:"notfound-description",children:"Page not found"}),T.jsx("button",{className:"notfound-button",onClick:t,children:"Back to Search"})]})]})},kst=()=>{const e=Qc();return Ve.useEffect(()=>{e("/not-found")},[]),null},Ost=()=>T.jsx(Mde,{children:T.jsxs(Tde,{children:[T.jsx(zh,{path:"/",element:T.jsx(Rde,{})}),T.jsx(zh,{path:"/search",element:T.jsx(nve,{})}),T.jsx(zh,{path:"/protein/:id",element:T.jsx(Est,{})}),T.jsx(zh,{path:"/auth",element:T.jsx(Dst,{})}),T.jsx(zh,{path:"/not-found",element:T.jsx(Rst,{})}),T.jsx(zh,{path:"*",element:T.jsx(kst,{})})]})});v4.createRoot(document.querySelector("#root")).render(T.jsx(du.StrictMode,{children:T.jsx(Bce,{children:T.jsx(vhe,{store:o$,children:T.jsx(Ost,{})})})}));
