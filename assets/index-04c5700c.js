var Nse=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var vmt=Nse((Hc,Gc)=>{function Bse(e,t){for(var r=0;r<t.length;r++){const n=t[r];if(typeof n!="string"&&!Array.isArray(n)){for(const i in n)if(i!=="default"&&!(i in e)){const a=Object.getOwnPropertyDescriptor(n,i);a&&Object.defineProperty(e,i,a.get?a:{enumerable:!0,get:()=>n[i]})}}}return Object.freeze(Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}))}(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const a of i)if(a.type==="childList")for(const o of a.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function r(i){const a={};return i.integrity&&(a.integrity=i.integrity),i.referrerPolicy&&(a.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?a.credentials="include":i.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function n(i){if(i.ep)return;i.ep=!0;const a=r(i);fetch(i.href,a)}})();var Dp=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function xq(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function Use(e){if(e.__esModule)return e;var t=e.default;if(typeof t=="function"){var r=function n(){return this instanceof n?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};r.prototype=t.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(e).forEach(function(n){var i=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(r,n,i.get?i:{enumerable:!0,get:function(){return e[n]}})}),r}var Sq={exports:{}},p3={},Cq={exports:{}},tn={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var a2=Symbol.for("react.element"),jse=Symbol.for("react.portal"),zse=Symbol.for("react.fragment"),Vse=Symbol.for("react.strict_mode"),Hse=Symbol.for("react.profiler"),Gse=Symbol.for("react.provider"),qse=Symbol.for("react.context"),$se=Symbol.for("react.forward_ref"),Wse=Symbol.for("react.suspense"),Xse=Symbol.for("react.memo"),Yse=Symbol.for("react.lazy"),AN=Symbol.iterator;function Kse(e){return e===null||typeof e!="object"?null:(e=AN&&e[AN]||e["@@iterator"],typeof e=="function"?e:null)}var _q={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},wq=Object.assign,Eq={};function _0(e,t,r){this.props=e,this.context=t,this.refs=Eq,this.updater=r||_q}_0.prototype.isReactComponent={};_0.prototype.setState=function(e,t){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")};_0.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function Aq(){}Aq.prototype=_0.prototype;function hk(e,t,r){this.props=e,this.context=t,this.refs=Eq,this.updater=r||_q}var pk=hk.prototype=new Aq;pk.constructor=hk;wq(pk,_0.prototype);pk.isPureReactComponent=!0;var PN=Array.isArray,Pq=Object.prototype.hasOwnProperty,vk={current:null},Tq={key:!0,ref:!0,__self:!0,__source:!0};function Iq(e,t,r){var n,i={},a=null,o=null;if(t!=null)for(n in t.ref!==void 0&&(o=t.ref),t.key!==void 0&&(a=""+t.key),t)Pq.call(t,n)&&!Tq.hasOwnProperty(n)&&(i[n]=t[n]);var s=arguments.length-2;if(s===1)i.children=r;else if(1<s){for(var u=Array(s),l=0;l<s;l++)u[l]=arguments[l+2];i.children=u}if(e&&e.defaultProps)for(n in s=e.defaultProps,s)i[n]===void 0&&(i[n]=s[n]);return{$$typeof:a2,type:e,key:a,ref:o,props:i,_owner:vk.current}}function Qse(e,t){return{$$typeof:a2,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}function mk(e){return typeof e=="object"&&e!==null&&e.$$typeof===a2}function Zse(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(r){return t[r]})}var TN=/\/+/g;function i4(e,t){return typeof e=="object"&&e!==null&&e.key!=null?Zse(""+e.key):t.toString(36)}function HS(e,t,r,n,i){var a=typeof e;(a==="undefined"||a==="boolean")&&(e=null);var o=!1;if(e===null)o=!0;else switch(a){case"string":case"number":o=!0;break;case"object":switch(e.$$typeof){case a2:case jse:o=!0}}if(o)return o=e,i=i(o),e=n===""?"."+i4(o,0):n,PN(i)?(r="",e!=null&&(r=e.replace(TN,"$&/")+"/"),HS(i,t,r,"",function(l){return l})):i!=null&&(mk(i)&&(i=Qse(i,r+(!i.key||o&&o.key===i.key?"":(""+i.key).replace(TN,"$&/")+"/")+e)),t.push(i)),1;if(o=0,n=n===""?".":n+":",PN(e))for(var s=0;s<e.length;s++){a=e[s];var u=n+i4(a,s);o+=HS(a,t,r,u,i)}else if(u=Kse(e),typeof u=="function")for(e=u.call(e),s=0;!(a=e.next()).done;)a=a.value,u=n+i4(a,s++),o+=HS(a,t,r,u,i);else if(a==="object")throw t=String(e),Error("Objects are not valid as a React child (found: "+(t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return o}function ix(e,t,r){if(e==null)return e;var n=[],i=0;return HS(e,n,"","",function(a){return t.call(r,a,i++)}),n}function Jse(e){if(e._status===-1){var t=e._result;t=t(),t.then(function(r){(e._status===0||e._status===-1)&&(e._status=1,e._result=r)},function(r){(e._status===0||e._status===-1)&&(e._status=2,e._result=r)}),e._status===-1&&(e._status=0,e._result=t)}if(e._status===1)return e._result.default;throw e._result}var co={current:null},GS={transition:null},eue={ReactCurrentDispatcher:co,ReactCurrentBatchConfig:GS,ReactCurrentOwner:vk};tn.Children={map:ix,forEach:function(e,t,r){ix(e,function(){t.apply(this,arguments)},r)},count:function(e){var t=0;return ix(e,function(){t++}),t},toArray:function(e){return ix(e,function(t){return t})||[]},only:function(e){if(!mk(e))throw Error("React.Children.only expected to receive a single React element child.");return e}};tn.Component=_0;tn.Fragment=zse;tn.Profiler=Hse;tn.PureComponent=hk;tn.StrictMode=Vse;tn.Suspense=Wse;tn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=eue;tn.cloneElement=function(e,t,r){if(e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var n=wq({},e.props),i=e.key,a=e.ref,o=e._owner;if(t!=null){if(t.ref!==void 0&&(a=t.ref,o=vk.current),t.key!==void 0&&(i=""+t.key),e.type&&e.type.defaultProps)var s=e.type.defaultProps;for(u in t)Pq.call(t,u)&&!Tq.hasOwnProperty(u)&&(n[u]=t[u]===void 0&&s!==void 0?s[u]:t[u])}var u=arguments.length-2;if(u===1)n.children=r;else if(1<u){s=Array(u);for(var l=0;l<u;l++)s[l]=arguments[l+2];n.children=s}return{$$typeof:a2,type:e.type,key:i,ref:a,props:n,_owner:o}};tn.createContext=function(e){return e={$$typeof:qse,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},e.Provider={$$typeof:Gse,_context:e},e.Consumer=e};tn.createElement=Iq;tn.createFactory=function(e){var t=Iq.bind(null,e);return t.type=e,t};tn.createRef=function(){return{current:null}};tn.forwardRef=function(e){return{$$typeof:$se,render:e}};tn.isValidElement=mk;tn.lazy=function(e){return{$$typeof:Yse,_payload:{_status:-1,_result:e},_init:Jse}};tn.memo=function(e,t){return{$$typeof:Xse,type:e,compare:t===void 0?null:t}};tn.startTransition=function(e){var t=GS.transition;GS.transition={};try{e()}finally{GS.transition=t}};tn.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")};tn.useCallback=function(e,t){return co.current.useCallback(e,t)};tn.useContext=function(e){return co.current.useContext(e)};tn.useDebugValue=function(){};tn.useDeferredValue=function(e){return co.current.useDeferredValue(e)};tn.useEffect=function(e,t){return co.current.useEffect(e,t)};tn.useId=function(){return co.current.useId()};tn.useImperativeHandle=function(e,t,r){return co.current.useImperativeHandle(e,t,r)};tn.useInsertionEffect=function(e,t){return co.current.useInsertionEffect(e,t)};tn.useLayoutEffect=function(e,t){return co.current.useLayoutEffect(e,t)};tn.useMemo=function(e,t){return co.current.useMemo(e,t)};tn.useReducer=function(e,t,r){return co.current.useReducer(e,t,r)};tn.useRef=function(e){return co.current.useRef(e)};tn.useState=function(e){return co.current.useState(e)};tn.useSyncExternalStore=function(e,t,r){return co.current.useSyncExternalStore(e,t,r)};tn.useTransition=function(){return co.current.useTransition()};tn.version="18.2.0";Cq.exports=tn;var _e=Cq.exports;const Eo=xq(_e),IN=Bse({__proto__:null,default:Eo},[_e]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var tue=_e,rue=Symbol.for("react.element"),nue=Symbol.for("react.fragment"),iue=Object.prototype.hasOwnProperty,aue=tue.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,oue={key:!0,ref:!0,__self:!0,__source:!0};function Mq(e,t,r){var n,i={},a=null,o=null;r!==void 0&&(a=""+r),t.key!==void 0&&(a=""+t.key),t.ref!==void 0&&(o=t.ref);for(n in t)iue.call(t,n)&&!oue.hasOwnProperty(n)&&(i[n]=t[n]);if(e&&e.defaultProps)for(n in t=e.defaultProps,t)i[n]===void 0&&(i[n]=t[n]);return{$$typeof:rue,type:e,key:a,ref:o,props:i,_owner:aue.current}}p3.Fragment=nue;p3.jsx=Mq;p3.jsxs=Mq;Sq.exports=p3;var P=Sq.exports,HI={},Dq={exports:{}},ms={},Rq={exports:{}},kq={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function t(G,$){var q=G.length;G.push($);e:for(;0<q;){var ee=q-1>>>1,fe=G[ee];if(0<i(fe,$))G[ee]=$,G[q]=fe,q=ee;else break e}}function r(G){return G.length===0?null:G[0]}function n(G){if(G.length===0)return null;var $=G[0],q=G.pop();if(q!==$){G[0]=q;e:for(var ee=0,fe=G.length,W=fe>>>1;ee<W;){var X=2*(ee+1)-1,U=G[X],z=X+1,J=G[z];if(0>i(U,q))z<fe&&0>i(J,U)?(G[ee]=J,G[z]=q,ee=z):(G[ee]=U,G[X]=q,ee=X);else if(z<fe&&0>i(J,q))G[ee]=J,G[z]=q,ee=z;else break e}}return $}function i(G,$){var q=G.sortIndex-$.sortIndex;return q!==0?q:G.id-$.id}if(typeof performance=="object"&&typeof performance.now=="function"){var a=performance;e.unstable_now=function(){return a.now()}}else{var o=Date,s=o.now();e.unstable_now=function(){return o.now()-s}}var u=[],l=[],c=1,d=null,f=3,h=!1,v=!1,p=!1,m=typeof setTimeout=="function"?setTimeout:null,g=typeof clearTimeout=="function"?clearTimeout:null,y=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function b(G){for(var $=r(l);$!==null;){if($.callback===null)n(l);else if($.startTime<=G)n(l),$.sortIndex=$.expirationTime,t(u,$);else break;$=r(l)}}function S(G){if(p=!1,b(G),!v)if(r(u)!==null)v=!0,j(x);else{var $=r(l);$!==null&&Y(S,$.startTime-G)}}function x(G,$){v=!1,p&&(p=!1,g(A),A=-1),h=!0;var q=f;try{for(b($),d=r(u);d!==null&&(!(d.expirationTime>$)||G&&!k());){var ee=d.callback;if(typeof ee=="function"){d.callback=null,f=d.priorityLevel;var fe=ee(d.expirationTime<=$);$=e.unstable_now(),typeof fe=="function"?d.callback=fe:d===r(u)&&n(u),b($)}else n(u);d=r(u)}if(d!==null)var W=!0;else{var X=r(l);X!==null&&Y(S,X.startTime-$),W=!1}return W}finally{d=null,f=q,h=!1}}var C=!1,w=null,A=-1,M=5,D=-1;function k(){return!(e.unstable_now()-D<M)}function R(){if(w!==null){var G=e.unstable_now();D=G;var $=!0;try{$=w(!0,G)}finally{$?O():(C=!1,w=null)}}else C=!1}var O;if(typeof y=="function")O=function(){y(R)};else if(typeof MessageChannel<"u"){var H=new MessageChannel,B=H.port2;H.port1.onmessage=R,O=function(){B.postMessage(null)}}else O=function(){m(R,0)};function j(G){w=G,C||(C=!0,O())}function Y(G,$){A=m(function(){G(e.unstable_now())},$)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(G){G.callback=null},e.unstable_continueExecution=function(){v||h||(v=!0,j(x))},e.unstable_forceFrameRate=function(G){0>G||125<G?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):M=0<G?Math.floor(1e3/G):5},e.unstable_getCurrentPriorityLevel=function(){return f},e.unstable_getFirstCallbackNode=function(){return r(u)},e.unstable_next=function(G){switch(f){case 1:case 2:case 3:var $=3;break;default:$=f}var q=f;f=$;try{return G()}finally{f=q}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(G,$){switch(G){case 1:case 2:case 3:case 4:case 5:break;default:G=3}var q=f;f=G;try{return $()}finally{f=q}},e.unstable_scheduleCallback=function(G,$,q){var ee=e.unstable_now();switch(typeof q=="object"&&q!==null?(q=q.delay,q=typeof q=="number"&&0<q?ee+q:ee):q=ee,G){case 1:var fe=-1;break;case 2:fe=250;break;case 5:fe=1073741823;break;case 4:fe=1e4;break;default:fe=5e3}return fe=q+fe,G={id:c++,callback:$,priorityLevel:G,startTime:q,expirationTime:fe,sortIndex:-1},q>ee?(G.sortIndex=q,t(l,G),r(u)===null&&G===r(l)&&(p?(g(A),A=-1):p=!0,Y(S,q-ee))):(G.sortIndex=fe,t(u,G),v||h||(v=!0,j(x))),G},e.unstable_shouldYield=k,e.unstable_wrapCallback=function(G){var $=f;return function(){var q=f;f=$;try{return G.apply(this,arguments)}finally{f=q}}}})(kq);Rq.exports=kq;var sue=Rq.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Oq=_e,os=sue;function Tt(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,r=1;r<arguments.length;r++)t+="&args[]="+encodeURIComponent(arguments[r]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var Fq=new Set,J1={};function Gv(e,t){Wg(e,t),Wg(e+"Capture",t)}function Wg(e,t){for(J1[e]=t,e=0;e<t.length;e++)Fq.add(t[e])}var ed=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),GI=Object.prototype.hasOwnProperty,uue=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,MN={},DN={};function lue(e){return GI.call(DN,e)?!0:GI.call(MN,e)?!1:uue.test(e)?DN[e]=!0:(MN[e]=!0,!1)}function cue(e,t,r,n){if(r!==null&&r.type===0)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return n?!1:r!==null?!r.acceptsBooleans:(e=e.toLowerCase().slice(0,5),e!=="data-"&&e!=="aria-");default:return!1}}function due(e,t,r,n){if(t===null||typeof t>"u"||cue(e,t,r,n))return!0;if(n)return!1;if(r!==null)switch(r.type){case 3:return!t;case 4:return t===!1;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}function fo(e,t,r,n,i,a,o){this.acceptsBooleans=t===2||t===3||t===4,this.attributeName=n,this.attributeNamespace=i,this.mustUseProperty=r,this.propertyName=e,this.type=t,this.sanitizeURL=a,this.removeEmptyString=o}var Ca={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){Ca[e]=new fo(e,0,!1,e,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];Ca[t]=new fo(t,1,!1,e[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(e){Ca[e]=new fo(e,2,!1,e.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){Ca[e]=new fo(e,2,!1,e,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){Ca[e]=new fo(e,3,!1,e.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(e){Ca[e]=new fo(e,3,!0,e,null,!1,!1)});["capture","download"].forEach(function(e){Ca[e]=new fo(e,4,!1,e,null,!1,!1)});["cols","rows","size","span"].forEach(function(e){Ca[e]=new fo(e,6,!1,e,null,!1,!1)});["rowSpan","start"].forEach(function(e){Ca[e]=new fo(e,5,!1,e.toLowerCase(),null,!1,!1)});var gk=/[\-:]([a-z])/g;function yk(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(gk,yk);Ca[t]=new fo(t,1,!1,e,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(gk,yk);Ca[t]=new fo(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(gk,yk);Ca[t]=new fo(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(e){Ca[e]=new fo(e,1,!1,e.toLowerCase(),null,!1,!1)});Ca.xlinkHref=new fo("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(e){Ca[e]=new fo(e,1,!1,e.toLowerCase(),null,!0,!0)});function bk(e,t,r,n){var i=Ca.hasOwnProperty(t)?Ca[t]:null;(i!==null?i.type!==0:n||!(2<t.length)||t[0]!=="o"&&t[0]!=="O"||t[1]!=="n"&&t[1]!=="N")&&(due(t,r,i,n)&&(r=null),n||i===null?lue(t)&&(r===null?e.removeAttribute(t):e.setAttribute(t,""+r)):i.mustUseProperty?e[i.propertyName]=r===null?i.type===3?!1:"":r:(t=i.attributeName,n=i.attributeNamespace,r===null?e.removeAttribute(t):(i=i.type,r=i===3||i===4&&r===!0?"":""+r,n?e.setAttributeNS(n,t,r):e.setAttribute(t,r))))}var Pd=Oq.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,ax=Symbol.for("react.element"),Zm=Symbol.for("react.portal"),Jm=Symbol.for("react.fragment"),xk=Symbol.for("react.strict_mode"),qI=Symbol.for("react.profiler"),Lq=Symbol.for("react.provider"),Nq=Symbol.for("react.context"),Sk=Symbol.for("react.forward_ref"),$I=Symbol.for("react.suspense"),WI=Symbol.for("react.suspense_list"),Ck=Symbol.for("react.memo"),wf=Symbol.for("react.lazy"),Bq=Symbol.for("react.offscreen"),RN=Symbol.iterator;function uy(e){return e===null||typeof e!="object"?null:(e=RN&&e[RN]||e["@@iterator"],typeof e=="function"?e:null)}var mi=Object.assign,a4;function Qy(e){if(a4===void 0)try{throw Error()}catch(r){var t=r.stack.trim().match(/\n( *(at )?)/);a4=t&&t[1]||""}return`
`+a4+e}var o4=!1;function s4(e,t){if(!e||o4)return"";o4=!0;var r=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(t,[])}catch(l){var n=l}Reflect.construct(e,[],t)}else{try{t.call()}catch(l){n=l}e.call(t.prototype)}else{try{throw Error()}catch(l){n=l}e()}}catch(l){if(l&&n&&typeof l.stack=="string"){for(var i=l.stack.split(`
`),a=n.stack.split(`
`),o=i.length-1,s=a.length-1;1<=o&&0<=s&&i[o]!==a[s];)s--;for(;1<=o&&0<=s;o--,s--)if(i[o]!==a[s]){if(o!==1||s!==1)do if(o--,s--,0>s||i[o]!==a[s]){var u=`
`+i[o].replace(" at new "," at ");return e.displayName&&u.includes("<anonymous>")&&(u=u.replace("<anonymous>",e.displayName)),u}while(1<=o&&0<=s);break}}}finally{o4=!1,Error.prepareStackTrace=r}return(e=e?e.displayName||e.name:"")?Qy(e):""}function fue(e){switch(e.tag){case 5:return Qy(e.type);case 16:return Qy("Lazy");case 13:return Qy("Suspense");case 19:return Qy("SuspenseList");case 0:case 2:case 15:return e=s4(e.type,!1),e;case 11:return e=s4(e.type.render,!1),e;case 1:return e=s4(e.type,!0),e;default:return""}}function XI(e){if(e==null)return null;if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case Jm:return"Fragment";case Zm:return"Portal";case qI:return"Profiler";case xk:return"StrictMode";case $I:return"Suspense";case WI:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case Nq:return(e.displayName||"Context")+".Consumer";case Lq:return(e._context.displayName||"Context")+".Provider";case Sk:var t=e.render;return e=e.displayName,e||(e=t.displayName||t.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case Ck:return t=e.displayName||null,t!==null?t:XI(e.type)||"Memo";case wf:t=e._payload,e=e._init;try{return XI(e(t))}catch{}}return null}function hue(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=t.render,e=e.displayName||e.name||"",t.displayName||(e!==""?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return XI(t);case 8:return t===xk?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t}return null}function xh(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function Uq(e){var t=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(t==="checkbox"||t==="radio")}function pue(e){var t=Uq(e)?"checked":"value",r=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),n=""+e[t];if(!e.hasOwnProperty(t)&&typeof r<"u"&&typeof r.get=="function"&&typeof r.set=="function"){var i=r.get,a=r.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return i.call(this)},set:function(o){n=""+o,a.call(this,o)}}),Object.defineProperty(e,t,{enumerable:r.enumerable}),{getValue:function(){return n},setValue:function(o){n=""+o},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}function ox(e){e._valueTracker||(e._valueTracker=pue(e))}function jq(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var r=t.getValue(),n="";return e&&(n=Uq(e)?e.checked?"true":"false":e.value),e=n,e!==r?(t.setValue(e),!0):!1}function OC(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}function YI(e,t){var r=t.checked;return mi({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:r??e._wrapperState.initialChecked})}function kN(e,t){var r=t.defaultValue==null?"":t.defaultValue,n=t.checked!=null?t.checked:t.defaultChecked;r=xh(t.value!=null?t.value:r),e._wrapperState={initialChecked:n,initialValue:r,controlled:t.type==="checkbox"||t.type==="radio"?t.checked!=null:t.value!=null}}function zq(e,t){t=t.checked,t!=null&&bk(e,"checked",t,!1)}function KI(e,t){zq(e,t);var r=xh(t.value),n=t.type;if(r!=null)n==="number"?(r===0&&e.value===""||e.value!=r)&&(e.value=""+r):e.value!==""+r&&(e.value=""+r);else if(n==="submit"||n==="reset"){e.removeAttribute("value");return}t.hasOwnProperty("value")?QI(e,t.type,r):t.hasOwnProperty("defaultValue")&&QI(e,t.type,xh(t.defaultValue)),t.checked==null&&t.defaultChecked!=null&&(e.defaultChecked=!!t.defaultChecked)}function ON(e,t,r){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var n=t.type;if(!(n!=="submit"&&n!=="reset"||t.value!==void 0&&t.value!==null))return;t=""+e._wrapperState.initialValue,r||t===e.value||(e.value=t),e.defaultValue=t}r=e.name,r!==""&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,r!==""&&(e.name=r)}function QI(e,t,r){(t!=="number"||OC(e.ownerDocument)!==e)&&(r==null?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+r&&(e.defaultValue=""+r))}var Zy=Array.isArray;function Sg(e,t,r,n){if(e=e.options,t){t={};for(var i=0;i<r.length;i++)t["$"+r[i]]=!0;for(r=0;r<e.length;r++)i=t.hasOwnProperty("$"+e[r].value),e[r].selected!==i&&(e[r].selected=i),i&&n&&(e[r].defaultSelected=!0)}else{for(r=""+xh(r),t=null,i=0;i<e.length;i++){if(e[i].value===r){e[i].selected=!0,n&&(e[i].defaultSelected=!0);return}t!==null||e[i].disabled||(t=e[i])}t!==null&&(t.selected=!0)}}function ZI(e,t){if(t.dangerouslySetInnerHTML!=null)throw Error(Tt(91));return mi({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function FN(e,t){var r=t.value;if(r==null){if(r=t.children,t=t.defaultValue,r!=null){if(t!=null)throw Error(Tt(92));if(Zy(r)){if(1<r.length)throw Error(Tt(93));r=r[0]}t=r}t==null&&(t=""),r=t}e._wrapperState={initialValue:xh(r)}}function Vq(e,t){var r=xh(t.value),n=xh(t.defaultValue);r!=null&&(r=""+r,r!==e.value&&(e.value=r),t.defaultValue==null&&e.defaultValue!==r&&(e.defaultValue=r)),n!=null&&(e.defaultValue=""+n)}function LN(e){var t=e.textContent;t===e._wrapperState.initialValue&&t!==""&&t!==null&&(e.value=t)}function Hq(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function JI(e,t){return e==null||e==="http://www.w3.org/1999/xhtml"?Hq(t):e==="http://www.w3.org/2000/svg"&&t==="foreignObject"?"http://www.w3.org/1999/xhtml":e}var sx,Gq=function(e){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(t,r,n,i){MSApp.execUnsafeLocalFunction(function(){return e(t,r,n,i)})}:e}(function(e,t){if(e.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in e)e.innerHTML=t;else{for(sx=sx||document.createElement("div"),sx.innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=sx.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}});function eb(e,t){if(t){var r=e.firstChild;if(r&&r===e.lastChild&&r.nodeType===3){r.nodeValue=t;return}}e.textContent=t}var C1={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},vue=["Webkit","ms","Moz","O"];Object.keys(C1).forEach(function(e){vue.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),C1[t]=C1[e]})});function qq(e,t,r){return t==null||typeof t=="boolean"||t===""?"":r||typeof t!="number"||t===0||C1.hasOwnProperty(e)&&C1[e]?(""+t).trim():t+"px"}function $q(e,t){e=e.style;for(var r in t)if(t.hasOwnProperty(r)){var n=r.indexOf("--")===0,i=qq(r,t[r],n);r==="float"&&(r="cssFloat"),n?e.setProperty(r,i):e[r]=i}}var mue=mi({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function eM(e,t){if(t){if(mue[e]&&(t.children!=null||t.dangerouslySetInnerHTML!=null))throw Error(Tt(137,e));if(t.dangerouslySetInnerHTML!=null){if(t.children!=null)throw Error(Tt(60));if(typeof t.dangerouslySetInnerHTML!="object"||!("__html"in t.dangerouslySetInnerHTML))throw Error(Tt(61))}if(t.style!=null&&typeof t.style!="object")throw Error(Tt(62))}}function tM(e,t){if(e.indexOf("-")===-1)return typeof t.is=="string";switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var rM=null;function _k(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var nM=null,Cg=null,_g=null;function NN(e){if(e=u2(e)){if(typeof nM!="function")throw Error(Tt(280));var t=e.stateNode;t&&(t=b3(t),nM(e.stateNode,e.type,t))}}function Wq(e){Cg?_g?_g.push(e):_g=[e]:Cg=e}function Xq(){if(Cg){var e=Cg,t=_g;if(_g=Cg=null,NN(e),t)for(e=0;e<t.length;e++)NN(t[e])}}function Yq(e,t){return e(t)}function Kq(){}var u4=!1;function Qq(e,t,r){if(u4)return e(t,r);u4=!0;try{return Yq(e,t,r)}finally{u4=!1,(Cg!==null||_g!==null)&&(Kq(),Xq())}}function tb(e,t){var r=e.stateNode;if(r===null)return null;var n=b3(r);if(n===null)return null;r=n[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(n=!n.disabled)||(e=e.type,n=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!n;break e;default:e=!1}if(e)return null;if(r&&typeof r!="function")throw Error(Tt(231,t,typeof r));return r}var iM=!1;if(ed)try{var ly={};Object.defineProperty(ly,"passive",{get:function(){iM=!0}}),window.addEventListener("test",ly,ly),window.removeEventListener("test",ly,ly)}catch{iM=!1}function gue(e,t,r,n,i,a,o,s,u){var l=Array.prototype.slice.call(arguments,3);try{t.apply(r,l)}catch(c){this.onError(c)}}var _1=!1,FC=null,LC=!1,aM=null,yue={onError:function(e){_1=!0,FC=e}};function bue(e,t,r,n,i,a,o,s,u){_1=!1,FC=null,gue.apply(yue,arguments)}function xue(e,t,r,n,i,a,o,s,u){if(bue.apply(this,arguments),_1){if(_1){var l=FC;_1=!1,FC=null}else throw Error(Tt(198));LC||(LC=!0,aM=l)}}function qv(e){var t=e,r=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do t=e,t.flags&4098&&(r=t.return),e=t.return;while(e)}return t.tag===3?r:null}function Zq(e){if(e.tag===13){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function BN(e){if(qv(e)!==e)throw Error(Tt(188))}function Sue(e){var t=e.alternate;if(!t){if(t=qv(e),t===null)throw Error(Tt(188));return t!==e?null:e}for(var r=e,n=t;;){var i=r.return;if(i===null)break;var a=i.alternate;if(a===null){if(n=i.return,n!==null){r=n;continue}break}if(i.child===a.child){for(a=i.child;a;){if(a===r)return BN(i),e;if(a===n)return BN(i),t;a=a.sibling}throw Error(Tt(188))}if(r.return!==n.return)r=i,n=a;else{for(var o=!1,s=i.child;s;){if(s===r){o=!0,r=i,n=a;break}if(s===n){o=!0,n=i,r=a;break}s=s.sibling}if(!o){for(s=a.child;s;){if(s===r){o=!0,r=a,n=i;break}if(s===n){o=!0,n=a,r=i;break}s=s.sibling}if(!o)throw Error(Tt(189))}}if(r.alternate!==n)throw Error(Tt(190))}if(r.tag!==3)throw Error(Tt(188));return r.stateNode.current===r?e:t}function Jq(e){return e=Sue(e),e!==null?e$(e):null}function e$(e){if(e.tag===5||e.tag===6)return e;for(e=e.child;e!==null;){var t=e$(e);if(t!==null)return t;e=e.sibling}return null}var t$=os.unstable_scheduleCallback,UN=os.unstable_cancelCallback,Cue=os.unstable_shouldYield,_ue=os.unstable_requestPaint,Pi=os.unstable_now,wue=os.unstable_getCurrentPriorityLevel,wk=os.unstable_ImmediatePriority,r$=os.unstable_UserBlockingPriority,NC=os.unstable_NormalPriority,Eue=os.unstable_LowPriority,n$=os.unstable_IdlePriority,v3=null,Ul=null;function Aue(e){if(Ul&&typeof Ul.onCommitFiberRoot=="function")try{Ul.onCommitFiberRoot(v3,e,void 0,(e.current.flags&128)===128)}catch{}}var Mu=Math.clz32?Math.clz32:Iue,Pue=Math.log,Tue=Math.LN2;function Iue(e){return e>>>=0,e===0?32:31-(Pue(e)/Tue|0)|0}var ux=64,lx=4194304;function Jy(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return e&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function BC(e,t){var r=e.pendingLanes;if(r===0)return 0;var n=0,i=e.suspendedLanes,a=e.pingedLanes,o=r&268435455;if(o!==0){var s=o&~i;s!==0?n=Jy(s):(a&=o,a!==0&&(n=Jy(a)))}else o=r&~i,o!==0?n=Jy(o):a!==0&&(n=Jy(a));if(n===0)return 0;if(t!==0&&t!==n&&!(t&i)&&(i=n&-n,a=t&-t,i>=a||i===16&&(a&4194240)!==0))return t;if(n&4&&(n|=r&16),t=e.entangledLanes,t!==0)for(e=e.entanglements,t&=n;0<t;)r=31-Mu(t),i=1<<r,n|=e[r],t&=~i;return n}function Mue(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Due(e,t){for(var r=e.suspendedLanes,n=e.pingedLanes,i=e.expirationTimes,a=e.pendingLanes;0<a;){var o=31-Mu(a),s=1<<o,u=i[o];u===-1?(!(s&r)||s&n)&&(i[o]=Mue(s,t)):u<=t&&(e.expiredLanes|=s),a&=~s}}function oM(e){return e=e.pendingLanes&-1073741825,e!==0?e:e&1073741824?1073741824:0}function i$(){var e=ux;return ux<<=1,!(ux&4194240)&&(ux=64),e}function l4(e){for(var t=[],r=0;31>r;r++)t.push(e);return t}function o2(e,t,r){e.pendingLanes|=t,t!==536870912&&(e.suspendedLanes=0,e.pingedLanes=0),e=e.eventTimes,t=31-Mu(t),e[t]=r}function Rue(e,t){var r=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var n=e.eventTimes;for(e=e.expirationTimes;0<r;){var i=31-Mu(r),a=1<<i;t[i]=0,n[i]=-1,e[i]=-1,r&=~a}}function Ek(e,t){var r=e.entangledLanes|=t;for(e=e.entanglements;r;){var n=31-Mu(r),i=1<<n;i&t|e[n]&t&&(e[n]|=t),r&=~i}}var Tn=0;function a$(e){return e&=-e,1<e?4<e?e&268435455?16:536870912:4:1}var o$,Ak,s$,u$,l$,sM=!1,cx=[],th=null,rh=null,nh=null,rb=new Map,nb=new Map,Tf=[],kue="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function jN(e,t){switch(e){case"focusin":case"focusout":th=null;break;case"dragenter":case"dragleave":rh=null;break;case"mouseover":case"mouseout":nh=null;break;case"pointerover":case"pointerout":rb.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":nb.delete(t.pointerId)}}function cy(e,t,r,n,i,a){return e===null||e.nativeEvent!==a?(e={blockedOn:t,domEventName:r,eventSystemFlags:n,nativeEvent:a,targetContainers:[i]},t!==null&&(t=u2(t),t!==null&&Ak(t)),e):(e.eventSystemFlags|=n,t=e.targetContainers,i!==null&&t.indexOf(i)===-1&&t.push(i),e)}function Oue(e,t,r,n,i){switch(t){case"focusin":return th=cy(th,e,t,r,n,i),!0;case"dragenter":return rh=cy(rh,e,t,r,n,i),!0;case"mouseover":return nh=cy(nh,e,t,r,n,i),!0;case"pointerover":var a=i.pointerId;return rb.set(a,cy(rb.get(a)||null,e,t,r,n,i)),!0;case"gotpointercapture":return a=i.pointerId,nb.set(a,cy(nb.get(a)||null,e,t,r,n,i)),!0}return!1}function c$(e){var t=Np(e.target);if(t!==null){var r=qv(t);if(r!==null){if(t=r.tag,t===13){if(t=Zq(r),t!==null){e.blockedOn=t,l$(e.priority,function(){s$(r)});return}}else if(t===3&&r.stateNode.current.memoizedState.isDehydrated){e.blockedOn=r.tag===3?r.stateNode.containerInfo:null;return}}}e.blockedOn=null}function qS(e){if(e.blockedOn!==null)return!1;for(var t=e.targetContainers;0<t.length;){var r=uM(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(r===null){r=e.nativeEvent;var n=new r.constructor(r.type,r);rM=n,r.target.dispatchEvent(n),rM=null}else return t=u2(r),t!==null&&Ak(t),e.blockedOn=r,!1;t.shift()}return!0}function zN(e,t,r){qS(e)&&r.delete(t)}function Fue(){sM=!1,th!==null&&qS(th)&&(th=null),rh!==null&&qS(rh)&&(rh=null),nh!==null&&qS(nh)&&(nh=null),rb.forEach(zN),nb.forEach(zN)}function dy(e,t){e.blockedOn===t&&(e.blockedOn=null,sM||(sM=!0,os.unstable_scheduleCallback(os.unstable_NormalPriority,Fue)))}function ib(e){function t(i){return dy(i,e)}if(0<cx.length){dy(cx[0],e);for(var r=1;r<cx.length;r++){var n=cx[r];n.blockedOn===e&&(n.blockedOn=null)}}for(th!==null&&dy(th,e),rh!==null&&dy(rh,e),nh!==null&&dy(nh,e),rb.forEach(t),nb.forEach(t),r=0;r<Tf.length;r++)n=Tf[r],n.blockedOn===e&&(n.blockedOn=null);for(;0<Tf.length&&(r=Tf[0],r.blockedOn===null);)c$(r),r.blockedOn===null&&Tf.shift()}var wg=Pd.ReactCurrentBatchConfig,UC=!0;function Lue(e,t,r,n){var i=Tn,a=wg.transition;wg.transition=null;try{Tn=1,Pk(e,t,r,n)}finally{Tn=i,wg.transition=a}}function Nue(e,t,r,n){var i=Tn,a=wg.transition;wg.transition=null;try{Tn=4,Pk(e,t,r,n)}finally{Tn=i,wg.transition=a}}function Pk(e,t,r,n){if(UC){var i=uM(e,t,r,n);if(i===null)b4(e,t,n,jC,r),jN(e,n);else if(Oue(i,e,t,r,n))n.stopPropagation();else if(jN(e,n),t&4&&-1<kue.indexOf(e)){for(;i!==null;){var a=u2(i);if(a!==null&&o$(a),a=uM(e,t,r,n),a===null&&b4(e,t,n,jC,r),a===i)break;i=a}i!==null&&n.stopPropagation()}else b4(e,t,n,null,r)}}var jC=null;function uM(e,t,r,n){if(jC=null,e=_k(n),e=Np(e),e!==null)if(t=qv(e),t===null)e=null;else if(r=t.tag,r===13){if(e=Zq(t),e!==null)return e;e=null}else if(r===3){if(t.stateNode.current.memoizedState.isDehydrated)return t.tag===3?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return jC=e,null}function d$(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(wue()){case wk:return 1;case r$:return 4;case NC:case Eue:return 16;case n$:return 536870912;default:return 16}default:return 16}}var Gf=null,Tk=null,$S=null;function f$(){if($S)return $S;var e,t=Tk,r=t.length,n,i="value"in Gf?Gf.value:Gf.textContent,a=i.length;for(e=0;e<r&&t[e]===i[e];e++);var o=r-e;for(n=1;n<=o&&t[r-n]===i[a-n];n++);return $S=i.slice(e,1<n?1-n:void 0)}function WS(e){var t=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&t===13&&(e=13)):e=t,e===10&&(e=13),32<=e||e===13?e:0}function dx(){return!0}function VN(){return!1}function gs(e){function t(r,n,i,a,o){this._reactName=r,this._targetInst=i,this.type=n,this.nativeEvent=a,this.target=o,this.currentTarget=null;for(var s in e)e.hasOwnProperty(s)&&(r=e[s],this[s]=r?r(a):a[s]);return this.isDefaultPrevented=(a.defaultPrevented!=null?a.defaultPrevented:a.returnValue===!1)?dx:VN,this.isPropagationStopped=VN,this}return mi(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var r=this.nativeEvent;r&&(r.preventDefault?r.preventDefault():typeof r.returnValue!="unknown"&&(r.returnValue=!1),this.isDefaultPrevented=dx)},stopPropagation:function(){var r=this.nativeEvent;r&&(r.stopPropagation?r.stopPropagation():typeof r.cancelBubble!="unknown"&&(r.cancelBubble=!0),this.isPropagationStopped=dx)},persist:function(){},isPersistent:dx}),t}var w0={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Ik=gs(w0),s2=mi({},w0,{view:0,detail:0}),Bue=gs(s2),c4,d4,fy,m3=mi({},s2,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Mk,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==fy&&(fy&&e.type==="mousemove"?(c4=e.screenX-fy.screenX,d4=e.screenY-fy.screenY):d4=c4=0,fy=e),c4)},movementY:function(e){return"movementY"in e?e.movementY:d4}}),HN=gs(m3),Uue=mi({},m3,{dataTransfer:0}),jue=gs(Uue),zue=mi({},s2,{relatedTarget:0}),f4=gs(zue),Vue=mi({},w0,{animationName:0,elapsedTime:0,pseudoElement:0}),Hue=gs(Vue),Gue=mi({},w0,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),que=gs(Gue),$ue=mi({},w0,{data:0}),GN=gs($ue),Wue={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Xue={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Yue={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Kue(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):(e=Yue[e])?!!t[e]:!1}function Mk(){return Kue}var Que=mi({},s2,{key:function(e){if(e.key){var t=Wue[e.key]||e.key;if(t!=="Unidentified")return t}return e.type==="keypress"?(e=WS(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?Xue[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Mk,charCode:function(e){return e.type==="keypress"?WS(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?WS(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),Zue=gs(Que),Jue=mi({},m3,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),qN=gs(Jue),ele=mi({},s2,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Mk}),tle=gs(ele),rle=mi({},w0,{propertyName:0,elapsedTime:0,pseudoElement:0}),nle=gs(rle),ile=mi({},m3,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),ale=gs(ile),ole=[9,13,27,32],Dk=ed&&"CompositionEvent"in window,w1=null;ed&&"documentMode"in document&&(w1=document.documentMode);var sle=ed&&"TextEvent"in window&&!w1,h$=ed&&(!Dk||w1&&8<w1&&11>=w1),$N=String.fromCharCode(32),WN=!1;function p$(e,t){switch(e){case"keyup":return ole.indexOf(t.keyCode)!==-1;case"keydown":return t.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function v$(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var eg=!1;function ule(e,t){switch(e){case"compositionend":return v$(t);case"keypress":return t.which!==32?null:(WN=!0,$N);case"textInput":return e=t.data,e===$N&&WN?null:e;default:return null}}function lle(e,t){if(eg)return e==="compositionend"||!Dk&&p$(e,t)?(e=f$(),$S=Tk=Gf=null,eg=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return h$&&t.locale!=="ko"?null:t.data;default:return null}}var cle={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function XN(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t==="input"?!!cle[e.type]:t==="textarea"}function m$(e,t,r,n){Wq(n),t=zC(t,"onChange"),0<t.length&&(r=new Ik("onChange","change",null,r,n),e.push({event:r,listeners:t}))}var E1=null,ab=null;function dle(e){P$(e,0)}function g3(e){var t=ng(e);if(jq(t))return e}function fle(e,t){if(e==="change")return t}var g$=!1;if(ed){var h4;if(ed){var p4="oninput"in document;if(!p4){var YN=document.createElement("div");YN.setAttribute("oninput","return;"),p4=typeof YN.oninput=="function"}h4=p4}else h4=!1;g$=h4&&(!document.documentMode||9<document.documentMode)}function KN(){E1&&(E1.detachEvent("onpropertychange",y$),ab=E1=null)}function y$(e){if(e.propertyName==="value"&&g3(ab)){var t=[];m$(t,ab,e,_k(e)),Qq(dle,t)}}function hle(e,t,r){e==="focusin"?(KN(),E1=t,ab=r,E1.attachEvent("onpropertychange",y$)):e==="focusout"&&KN()}function ple(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return g3(ab)}function vle(e,t){if(e==="click")return g3(t)}function mle(e,t){if(e==="input"||e==="change")return g3(t)}function gle(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var Vu=typeof Object.is=="function"?Object.is:gle;function ob(e,t){if(Vu(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;var r=Object.keys(e),n=Object.keys(t);if(r.length!==n.length)return!1;for(n=0;n<r.length;n++){var i=r[n];if(!GI.call(t,i)||!Vu(e[i],t[i]))return!1}return!0}function QN(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function ZN(e,t){var r=QN(e);e=0;for(var n;r;){if(r.nodeType===3){if(n=e+r.textContent.length,e<=t&&n>=t)return{node:r,offset:t-e};e=n}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=QN(r)}}function b$(e,t){return e&&t?e===t?!0:e&&e.nodeType===3?!1:t&&t.nodeType===3?b$(e,t.parentNode):"contains"in e?e.contains(t):e.compareDocumentPosition?!!(e.compareDocumentPosition(t)&16):!1:!1}function x$(){for(var e=window,t=OC();t instanceof e.HTMLIFrameElement;){try{var r=typeof t.contentWindow.location.href=="string"}catch{r=!1}if(r)e=t.contentWindow;else break;t=OC(e.document)}return t}function Rk(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&(t==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||t==="textarea"||e.contentEditable==="true")}function yle(e){var t=x$(),r=e.focusedElem,n=e.selectionRange;if(t!==r&&r&&r.ownerDocument&&b$(r.ownerDocument.documentElement,r)){if(n!==null&&Rk(r)){if(t=n.start,e=n.end,e===void 0&&(e=t),"selectionStart"in r)r.selectionStart=t,r.selectionEnd=Math.min(e,r.value.length);else if(e=(t=r.ownerDocument||document)&&t.defaultView||window,e.getSelection){e=e.getSelection();var i=r.textContent.length,a=Math.min(n.start,i);n=n.end===void 0?a:Math.min(n.end,i),!e.extend&&a>n&&(i=n,n=a,a=i),i=ZN(r,a);var o=ZN(r,n);i&&o&&(e.rangeCount!==1||e.anchorNode!==i.node||e.anchorOffset!==i.offset||e.focusNode!==o.node||e.focusOffset!==o.offset)&&(t=t.createRange(),t.setStart(i.node,i.offset),e.removeAllRanges(),a>n?(e.addRange(t),e.extend(o.node,o.offset)):(t.setEnd(o.node,o.offset),e.addRange(t)))}}for(t=[],e=r;e=e.parentNode;)e.nodeType===1&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for(typeof r.focus=="function"&&r.focus(),r=0;r<t.length;r++)e=t[r],e.element.scrollLeft=e.left,e.element.scrollTop=e.top}}var ble=ed&&"documentMode"in document&&11>=document.documentMode,tg=null,lM=null,A1=null,cM=!1;function JN(e,t,r){var n=r.window===r?r.document:r.nodeType===9?r:r.ownerDocument;cM||tg==null||tg!==OC(n)||(n=tg,"selectionStart"in n&&Rk(n)?n={start:n.selectionStart,end:n.selectionEnd}:(n=(n.ownerDocument&&n.ownerDocument.defaultView||window).getSelection(),n={anchorNode:n.anchorNode,anchorOffset:n.anchorOffset,focusNode:n.focusNode,focusOffset:n.focusOffset}),A1&&ob(A1,n)||(A1=n,n=zC(lM,"onSelect"),0<n.length&&(t=new Ik("onSelect","select",null,t,r),e.push({event:t,listeners:n}),t.target=tg)))}function fx(e,t){var r={};return r[e.toLowerCase()]=t.toLowerCase(),r["Webkit"+e]="webkit"+t,r["Moz"+e]="moz"+t,r}var rg={animationend:fx("Animation","AnimationEnd"),animationiteration:fx("Animation","AnimationIteration"),animationstart:fx("Animation","AnimationStart"),transitionend:fx("Transition","TransitionEnd")},v4={},S$={};ed&&(S$=document.createElement("div").style,"AnimationEvent"in window||(delete rg.animationend.animation,delete rg.animationiteration.animation,delete rg.animationstart.animation),"TransitionEvent"in window||delete rg.transitionend.transition);function y3(e){if(v4[e])return v4[e];if(!rg[e])return e;var t=rg[e],r;for(r in t)if(t.hasOwnProperty(r)&&r in S$)return v4[e]=t[r];return e}var C$=y3("animationend"),_$=y3("animationiteration"),w$=y3("animationstart"),E$=y3("transitionend"),A$=new Map,e8="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Uh(e,t){A$.set(e,t),Gv(t,[e])}for(var m4=0;m4<e8.length;m4++){var g4=e8[m4],xle=g4.toLowerCase(),Sle=g4[0].toUpperCase()+g4.slice(1);Uh(xle,"on"+Sle)}Uh(C$,"onAnimationEnd");Uh(_$,"onAnimationIteration");Uh(w$,"onAnimationStart");Uh("dblclick","onDoubleClick");Uh("focusin","onFocus");Uh("focusout","onBlur");Uh(E$,"onTransitionEnd");Wg("onMouseEnter",["mouseout","mouseover"]);Wg("onMouseLeave",["mouseout","mouseover"]);Wg("onPointerEnter",["pointerout","pointerover"]);Wg("onPointerLeave",["pointerout","pointerover"]);Gv("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Gv("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Gv("onBeforeInput",["compositionend","keypress","textInput","paste"]);Gv("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Gv("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Gv("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var e1="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Cle=new Set("cancel close invalid load scroll toggle".split(" ").concat(e1));function t8(e,t,r){var n=e.type||"unknown-event";e.currentTarget=r,xue(n,t,void 0,e),e.currentTarget=null}function P$(e,t){t=(t&4)!==0;for(var r=0;r<e.length;r++){var n=e[r],i=n.event;n=n.listeners;e:{var a=void 0;if(t)for(var o=n.length-1;0<=o;o--){var s=n[o],u=s.instance,l=s.currentTarget;if(s=s.listener,u!==a&&i.isPropagationStopped())break e;t8(i,s,l),a=u}else for(o=0;o<n.length;o++){if(s=n[o],u=s.instance,l=s.currentTarget,s=s.listener,u!==a&&i.isPropagationStopped())break e;t8(i,s,l),a=u}}}if(LC)throw e=aM,LC=!1,aM=null,e}function qn(e,t){var r=t[vM];r===void 0&&(r=t[vM]=new Set);var n=e+"__bubble";r.has(n)||(T$(t,e,2,!1),r.add(n))}function y4(e,t,r){var n=0;t&&(n|=4),T$(r,e,n,t)}var hx="_reactListening"+Math.random().toString(36).slice(2);function sb(e){if(!e[hx]){e[hx]=!0,Fq.forEach(function(r){r!=="selectionchange"&&(Cle.has(r)||y4(r,!1,e),y4(r,!0,e))});var t=e.nodeType===9?e:e.ownerDocument;t===null||t[hx]||(t[hx]=!0,y4("selectionchange",!1,t))}}function T$(e,t,r,n){switch(d$(t)){case 1:var i=Lue;break;case 4:i=Nue;break;default:i=Pk}r=i.bind(null,t,r,e),i=void 0,!iM||t!=="touchstart"&&t!=="touchmove"&&t!=="wheel"||(i=!0),n?i!==void 0?e.addEventListener(t,r,{capture:!0,passive:i}):e.addEventListener(t,r,!0):i!==void 0?e.addEventListener(t,r,{passive:i}):e.addEventListener(t,r,!1)}function b4(e,t,r,n,i){var a=n;if(!(t&1)&&!(t&2)&&n!==null)e:for(;;){if(n===null)return;var o=n.tag;if(o===3||o===4){var s=n.stateNode.containerInfo;if(s===i||s.nodeType===8&&s.parentNode===i)break;if(o===4)for(o=n.return;o!==null;){var u=o.tag;if((u===3||u===4)&&(u=o.stateNode.containerInfo,u===i||u.nodeType===8&&u.parentNode===i))return;o=o.return}for(;s!==null;){if(o=Np(s),o===null)return;if(u=o.tag,u===5||u===6){n=a=o;continue e}s=s.parentNode}}n=n.return}Qq(function(){var l=a,c=_k(r),d=[];e:{var f=A$.get(e);if(f!==void 0){var h=Ik,v=e;switch(e){case"keypress":if(WS(r)===0)break e;case"keydown":case"keyup":h=Zue;break;case"focusin":v="focus",h=f4;break;case"focusout":v="blur",h=f4;break;case"beforeblur":case"afterblur":h=f4;break;case"click":if(r.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":h=HN;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":h=jue;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":h=tle;break;case C$:case _$:case w$:h=Hue;break;case E$:h=nle;break;case"scroll":h=Bue;break;case"wheel":h=ale;break;case"copy":case"cut":case"paste":h=que;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":h=qN}var p=(t&4)!==0,m=!p&&e==="scroll",g=p?f!==null?f+"Capture":null:f;p=[];for(var y=l,b;y!==null;){b=y;var S=b.stateNode;if(b.tag===5&&S!==null&&(b=S,g!==null&&(S=tb(y,g),S!=null&&p.push(ub(y,S,b)))),m)break;y=y.return}0<p.length&&(f=new h(f,v,null,r,c),d.push({event:f,listeners:p}))}}if(!(t&7)){e:{if(f=e==="mouseover"||e==="pointerover",h=e==="mouseout"||e==="pointerout",f&&r!==rM&&(v=r.relatedTarget||r.fromElement)&&(Np(v)||v[td]))break e;if((h||f)&&(f=c.window===c?c:(f=c.ownerDocument)?f.defaultView||f.parentWindow:window,h?(v=r.relatedTarget||r.toElement,h=l,v=v?Np(v):null,v!==null&&(m=qv(v),v!==m||v.tag!==5&&v.tag!==6)&&(v=null)):(h=null,v=l),h!==v)){if(p=HN,S="onMouseLeave",g="onMouseEnter",y="mouse",(e==="pointerout"||e==="pointerover")&&(p=qN,S="onPointerLeave",g="onPointerEnter",y="pointer"),m=h==null?f:ng(h),b=v==null?f:ng(v),f=new p(S,y+"leave",h,r,c),f.target=m,f.relatedTarget=b,S=null,Np(c)===l&&(p=new p(g,y+"enter",v,r,c),p.target=b,p.relatedTarget=m,S=p),m=S,h&&v)t:{for(p=h,g=v,y=0,b=p;b;b=_m(b))y++;for(b=0,S=g;S;S=_m(S))b++;for(;0<y-b;)p=_m(p),y--;for(;0<b-y;)g=_m(g),b--;for(;y--;){if(p===g||g!==null&&p===g.alternate)break t;p=_m(p),g=_m(g)}p=null}else p=null;h!==null&&r8(d,f,h,p,!1),v!==null&&m!==null&&r8(d,m,v,p,!0)}}e:{if(f=l?ng(l):window,h=f.nodeName&&f.nodeName.toLowerCase(),h==="select"||h==="input"&&f.type==="file")var x=fle;else if(XN(f))if(g$)x=mle;else{x=ple;var C=hle}else(h=f.nodeName)&&h.toLowerCase()==="input"&&(f.type==="checkbox"||f.type==="radio")&&(x=vle);if(x&&(x=x(e,l))){m$(d,x,r,c);break e}C&&C(e,f,l),e==="focusout"&&(C=f._wrapperState)&&C.controlled&&f.type==="number"&&QI(f,"number",f.value)}switch(C=l?ng(l):window,e){case"focusin":(XN(C)||C.contentEditable==="true")&&(tg=C,lM=l,A1=null);break;case"focusout":A1=lM=tg=null;break;case"mousedown":cM=!0;break;case"contextmenu":case"mouseup":case"dragend":cM=!1,JN(d,r,c);break;case"selectionchange":if(ble)break;case"keydown":case"keyup":JN(d,r,c)}var w;if(Dk)e:{switch(e){case"compositionstart":var A="onCompositionStart";break e;case"compositionend":A="onCompositionEnd";break e;case"compositionupdate":A="onCompositionUpdate";break e}A=void 0}else eg?p$(e,r)&&(A="onCompositionEnd"):e==="keydown"&&r.keyCode===229&&(A="onCompositionStart");A&&(h$&&r.locale!=="ko"&&(eg||A!=="onCompositionStart"?A==="onCompositionEnd"&&eg&&(w=f$()):(Gf=c,Tk="value"in Gf?Gf.value:Gf.textContent,eg=!0)),C=zC(l,A),0<C.length&&(A=new GN(A,e,null,r,c),d.push({event:A,listeners:C}),w?A.data=w:(w=v$(r),w!==null&&(A.data=w)))),(w=sle?ule(e,r):lle(e,r))&&(l=zC(l,"onBeforeInput"),0<l.length&&(c=new GN("onBeforeInput","beforeinput",null,r,c),d.push({event:c,listeners:l}),c.data=w))}P$(d,t)})}function ub(e,t,r){return{instance:e,listener:t,currentTarget:r}}function zC(e,t){for(var r=t+"Capture",n=[];e!==null;){var i=e,a=i.stateNode;i.tag===5&&a!==null&&(i=a,a=tb(e,r),a!=null&&n.unshift(ub(e,a,i)),a=tb(e,t),a!=null&&n.push(ub(e,a,i))),e=e.return}return n}function _m(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5);return e||null}function r8(e,t,r,n,i){for(var a=t._reactName,o=[];r!==null&&r!==n;){var s=r,u=s.alternate,l=s.stateNode;if(u!==null&&u===n)break;s.tag===5&&l!==null&&(s=l,i?(u=tb(r,a),u!=null&&o.unshift(ub(r,u,s))):i||(u=tb(r,a),u!=null&&o.push(ub(r,u,s)))),r=r.return}o.length!==0&&e.push({event:t,listeners:o})}var _le=/\r\n?/g,wle=/\u0000|\uFFFD/g;function n8(e){return(typeof e=="string"?e:""+e).replace(_le,`
`).replace(wle,"")}function px(e,t,r){if(t=n8(t),n8(e)!==t&&r)throw Error(Tt(425))}function VC(){}var dM=null,fM=null;function hM(e,t){return e==="textarea"||e==="noscript"||typeof t.children=="string"||typeof t.children=="number"||typeof t.dangerouslySetInnerHTML=="object"&&t.dangerouslySetInnerHTML!==null&&t.dangerouslySetInnerHTML.__html!=null}var pM=typeof setTimeout=="function"?setTimeout:void 0,Ele=typeof clearTimeout=="function"?clearTimeout:void 0,i8=typeof Promise=="function"?Promise:void 0,Ale=typeof queueMicrotask=="function"?queueMicrotask:typeof i8<"u"?function(e){return i8.resolve(null).then(e).catch(Ple)}:pM;function Ple(e){setTimeout(function(){throw e})}function x4(e,t){var r=t,n=0;do{var i=r.nextSibling;if(e.removeChild(r),i&&i.nodeType===8)if(r=i.data,r==="/$"){if(n===0){e.removeChild(i),ib(t);return}n--}else r!=="$"&&r!=="$?"&&r!=="$!"||n++;r=i}while(r);ib(t)}function ih(e){for(;e!=null;e=e.nextSibling){var t=e.nodeType;if(t===1||t===3)break;if(t===8){if(t=e.data,t==="$"||t==="$!"||t==="$?")break;if(t==="/$")return null}}return e}function a8(e){e=e.previousSibling;for(var t=0;e;){if(e.nodeType===8){var r=e.data;if(r==="$"||r==="$!"||r==="$?"){if(t===0)return e;t--}else r==="/$"&&t++}e=e.previousSibling}return null}var E0=Math.random().toString(36).slice(2),Rl="__reactFiber$"+E0,lb="__reactProps$"+E0,td="__reactContainer$"+E0,vM="__reactEvents$"+E0,Tle="__reactListeners$"+E0,Ile="__reactHandles$"+E0;function Np(e){var t=e[Rl];if(t)return t;for(var r=e.parentNode;r;){if(t=r[td]||r[Rl]){if(r=t.alternate,t.child!==null||r!==null&&r.child!==null)for(e=a8(e);e!==null;){if(r=e[Rl])return r;e=a8(e)}return t}e=r,r=e.parentNode}return null}function u2(e){return e=e[Rl]||e[td],!e||e.tag!==5&&e.tag!==6&&e.tag!==13&&e.tag!==3?null:e}function ng(e){if(e.tag===5||e.tag===6)return e.stateNode;throw Error(Tt(33))}function b3(e){return e[lb]||null}var mM=[],ig=-1;function jh(e){return{current:e}}function Qn(e){0>ig||(e.current=mM[ig],mM[ig]=null,ig--)}function zn(e,t){ig++,mM[ig]=e.current,e.current=t}var Sh={},qa=jh(Sh),Po=jh(!1),cv=Sh;function Xg(e,t){var r=e.type.contextTypes;if(!r)return Sh;var n=e.stateNode;if(n&&n.__reactInternalMemoizedUnmaskedChildContext===t)return n.__reactInternalMemoizedMaskedChildContext;var i={},a;for(a in r)i[a]=t[a];return n&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=i),i}function To(e){return e=e.childContextTypes,e!=null}function HC(){Qn(Po),Qn(qa)}function o8(e,t,r){if(qa.current!==Sh)throw Error(Tt(168));zn(qa,t),zn(Po,r)}function I$(e,t,r){var n=e.stateNode;if(t=t.childContextTypes,typeof n.getChildContext!="function")return r;n=n.getChildContext();for(var i in n)if(!(i in t))throw Error(Tt(108,hue(e)||"Unknown",i));return mi({},r,n)}function GC(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Sh,cv=qa.current,zn(qa,e),zn(Po,Po.current),!0}function s8(e,t,r){var n=e.stateNode;if(!n)throw Error(Tt(169));r?(e=I$(e,t,cv),n.__reactInternalMemoizedMergedChildContext=e,Qn(Po),Qn(qa),zn(qa,e)):Qn(Po),zn(Po,r)}var Ic=null,x3=!1,S4=!1;function M$(e){Ic===null?Ic=[e]:Ic.push(e)}function Mle(e){x3=!0,M$(e)}function zh(){if(!S4&&Ic!==null){S4=!0;var e=0,t=Tn;try{var r=Ic;for(Tn=1;e<r.length;e++){var n=r[e];do n=n(!0);while(n!==null)}Ic=null,x3=!1}catch(i){throw Ic!==null&&(Ic=Ic.slice(e+1)),t$(wk,zh),i}finally{Tn=t,S4=!1}}return null}var ag=[],og=0,qC=null,$C=0,Us=[],js=0,dv=null,Fc=1,Lc="";function xp(e,t){ag[og++]=$C,ag[og++]=qC,qC=e,$C=t}function D$(e,t,r){Us[js++]=Fc,Us[js++]=Lc,Us[js++]=dv,dv=e;var n=Fc;e=Lc;var i=32-Mu(n)-1;n&=~(1<<i),r+=1;var a=32-Mu(t)+i;if(30<a){var o=i-i%5;a=(n&(1<<o)-1).toString(32),n>>=o,i-=o,Fc=1<<32-Mu(t)+i|r<<i|n,Lc=a+e}else Fc=1<<a|r<<i|n,Lc=e}function kk(e){e.return!==null&&(xp(e,1),D$(e,1,0))}function Ok(e){for(;e===qC;)qC=ag[--og],ag[og]=null,$C=ag[--og],ag[og]=null;for(;e===dv;)dv=Us[--js],Us[js]=null,Lc=Us[--js],Us[js]=null,Fc=Us[--js],Us[js]=null}var rs=null,Zo=null,oi=!1,Su=null;function R$(e,t){var r=zs(5,null,null,0);r.elementType="DELETED",r.stateNode=t,r.return=e,t=e.deletions,t===null?(e.deletions=[r],e.flags|=16):t.push(r)}function u8(e,t){switch(e.tag){case 5:var r=e.type;return t=t.nodeType!==1||r.toLowerCase()!==t.nodeName.toLowerCase()?null:t,t!==null?(e.stateNode=t,rs=e,Zo=ih(t.firstChild),!0):!1;case 6:return t=e.pendingProps===""||t.nodeType!==3?null:t,t!==null?(e.stateNode=t,rs=e,Zo=null,!0):!1;case 13:return t=t.nodeType!==8?null:t,t!==null?(r=dv!==null?{id:Fc,overflow:Lc}:null,e.memoizedState={dehydrated:t,treeContext:r,retryLane:1073741824},r=zs(18,null,null,0),r.stateNode=t,r.return=e,e.child=r,rs=e,Zo=null,!0):!1;default:return!1}}function gM(e){return(e.mode&1)!==0&&(e.flags&128)===0}function yM(e){if(oi){var t=Zo;if(t){var r=t;if(!u8(e,t)){if(gM(e))throw Error(Tt(418));t=ih(r.nextSibling);var n=rs;t&&u8(e,t)?R$(n,r):(e.flags=e.flags&-4097|2,oi=!1,rs=e)}}else{if(gM(e))throw Error(Tt(418));e.flags=e.flags&-4097|2,oi=!1,rs=e}}}function l8(e){for(e=e.return;e!==null&&e.tag!==5&&e.tag!==3&&e.tag!==13;)e=e.return;rs=e}function vx(e){if(e!==rs)return!1;if(!oi)return l8(e),oi=!0,!1;var t;if((t=e.tag!==3)&&!(t=e.tag!==5)&&(t=e.type,t=t!=="head"&&t!=="body"&&!hM(e.type,e.memoizedProps)),t&&(t=Zo)){if(gM(e))throw k$(),Error(Tt(418));for(;t;)R$(e,t),t=ih(t.nextSibling)}if(l8(e),e.tag===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(Tt(317));e:{for(e=e.nextSibling,t=0;e;){if(e.nodeType===8){var r=e.data;if(r==="/$"){if(t===0){Zo=ih(e.nextSibling);break e}t--}else r!=="$"&&r!=="$!"&&r!=="$?"||t++}e=e.nextSibling}Zo=null}}else Zo=rs?ih(e.stateNode.nextSibling):null;return!0}function k$(){for(var e=Zo;e;)e=ih(e.nextSibling)}function Yg(){Zo=rs=null,oi=!1}function Fk(e){Su===null?Su=[e]:Su.push(e)}var Dle=Pd.ReactCurrentBatchConfig;function gu(e,t){if(e&&e.defaultProps){t=mi({},t),e=e.defaultProps;for(var r in e)t[r]===void 0&&(t[r]=e[r]);return t}return t}var WC=jh(null),XC=null,sg=null,Lk=null;function Nk(){Lk=sg=XC=null}function Bk(e){var t=WC.current;Qn(WC),e._currentValue=t}function bM(e,t,r){for(;e!==null;){var n=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,n!==null&&(n.childLanes|=t)):n!==null&&(n.childLanes&t)!==t&&(n.childLanes|=t),e===r)break;e=e.return}}function Eg(e,t){XC=e,Lk=sg=null,e=e.dependencies,e!==null&&e.firstContext!==null&&(e.lanes&t&&(Ao=!0),e.firstContext=null)}function Xs(e){var t=e._currentValue;if(Lk!==e)if(e={context:e,memoizedValue:t,next:null},sg===null){if(XC===null)throw Error(Tt(308));sg=e,XC.dependencies={lanes:0,firstContext:e}}else sg=sg.next=e;return t}var Bp=null;function Uk(e){Bp===null?Bp=[e]:Bp.push(e)}function O$(e,t,r,n){var i=t.interleaved;return i===null?(r.next=r,Uk(t)):(r.next=i.next,i.next=r),t.interleaved=r,rd(e,n)}function rd(e,t){e.lanes|=t;var r=e.alternate;for(r!==null&&(r.lanes|=t),r=e,e=e.return;e!==null;)e.childLanes|=t,r=e.alternate,r!==null&&(r.childLanes|=t),r=e,e=e.return;return r.tag===3?r.stateNode:null}var Ef=!1;function jk(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function F$(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function qc(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function ah(e,t,r){var n=e.updateQueue;if(n===null)return null;if(n=n.shared,dn&2){var i=n.pending;return i===null?t.next=t:(t.next=i.next,i.next=t),n.pending=t,rd(e,r)}return i=n.interleaved,i===null?(t.next=t,Uk(n)):(t.next=i.next,i.next=t),n.interleaved=t,rd(e,r)}function XS(e,t,r){if(t=t.updateQueue,t!==null&&(t=t.shared,(r&4194240)!==0)){var n=t.lanes;n&=e.pendingLanes,r|=n,t.lanes=r,Ek(e,r)}}function c8(e,t){var r=e.updateQueue,n=e.alternate;if(n!==null&&(n=n.updateQueue,r===n)){var i=null,a=null;if(r=r.firstBaseUpdate,r!==null){do{var o={eventTime:r.eventTime,lane:r.lane,tag:r.tag,payload:r.payload,callback:r.callback,next:null};a===null?i=a=o:a=a.next=o,r=r.next}while(r!==null);a===null?i=a=t:a=a.next=t}else i=a=t;r={baseState:n.baseState,firstBaseUpdate:i,lastBaseUpdate:a,shared:n.shared,effects:n.effects},e.updateQueue=r;return}e=r.lastBaseUpdate,e===null?r.firstBaseUpdate=t:e.next=t,r.lastBaseUpdate=t}function YC(e,t,r,n){var i=e.updateQueue;Ef=!1;var a=i.firstBaseUpdate,o=i.lastBaseUpdate,s=i.shared.pending;if(s!==null){i.shared.pending=null;var u=s,l=u.next;u.next=null,o===null?a=l:o.next=l,o=u;var c=e.alternate;c!==null&&(c=c.updateQueue,s=c.lastBaseUpdate,s!==o&&(s===null?c.firstBaseUpdate=l:s.next=l,c.lastBaseUpdate=u))}if(a!==null){var d=i.baseState;o=0,c=l=u=null,s=a;do{var f=s.lane,h=s.eventTime;if((n&f)===f){c!==null&&(c=c.next={eventTime:h,lane:0,tag:s.tag,payload:s.payload,callback:s.callback,next:null});e:{var v=e,p=s;switch(f=t,h=r,p.tag){case 1:if(v=p.payload,typeof v=="function"){d=v.call(h,d,f);break e}d=v;break e;case 3:v.flags=v.flags&-65537|128;case 0:if(v=p.payload,f=typeof v=="function"?v.call(h,d,f):v,f==null)break e;d=mi({},d,f);break e;case 2:Ef=!0}}s.callback!==null&&s.lane!==0&&(e.flags|=64,f=i.effects,f===null?i.effects=[s]:f.push(s))}else h={eventTime:h,lane:f,tag:s.tag,payload:s.payload,callback:s.callback,next:null},c===null?(l=c=h,u=d):c=c.next=h,o|=f;if(s=s.next,s===null){if(s=i.shared.pending,s===null)break;f=s,s=f.next,f.next=null,i.lastBaseUpdate=f,i.shared.pending=null}}while(1);if(c===null&&(u=d),i.baseState=u,i.firstBaseUpdate=l,i.lastBaseUpdate=c,t=i.shared.interleaved,t!==null){i=t;do o|=i.lane,i=i.next;while(i!==t)}else a===null&&(i.shared.lanes=0);hv|=o,e.lanes=o,e.memoizedState=d}}function d8(e,t,r){if(e=t.effects,t.effects=null,e!==null)for(t=0;t<e.length;t++){var n=e[t],i=n.callback;if(i!==null){if(n.callback=null,n=r,typeof i!="function")throw Error(Tt(191,i));i.call(n)}}}var L$=new Oq.Component().refs;function xM(e,t,r,n){t=e.memoizedState,r=r(n,t),r=r==null?t:mi({},t,r),e.memoizedState=r,e.lanes===0&&(e.updateQueue.baseState=r)}var S3={isMounted:function(e){return(e=e._reactInternals)?qv(e)===e:!1},enqueueSetState:function(e,t,r){e=e._reactInternals;var n=io(),i=sh(e),a=qc(n,i);a.payload=t,r!=null&&(a.callback=r),t=ah(e,a,i),t!==null&&(Du(t,e,i,n),XS(t,e,i))},enqueueReplaceState:function(e,t,r){e=e._reactInternals;var n=io(),i=sh(e),a=qc(n,i);a.tag=1,a.payload=t,r!=null&&(a.callback=r),t=ah(e,a,i),t!==null&&(Du(t,e,i,n),XS(t,e,i))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var r=io(),n=sh(e),i=qc(r,n);i.tag=2,t!=null&&(i.callback=t),t=ah(e,i,n),t!==null&&(Du(t,e,n,r),XS(t,e,n))}};function f8(e,t,r,n,i,a,o){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(n,a,o):t.prototype&&t.prototype.isPureReactComponent?!ob(r,n)||!ob(i,a):!0}function N$(e,t,r){var n=!1,i=Sh,a=t.contextType;return typeof a=="object"&&a!==null?a=Xs(a):(i=To(t)?cv:qa.current,n=t.contextTypes,a=(n=n!=null)?Xg(e,i):Sh),t=new t(r,a),e.memoizedState=t.state!==null&&t.state!==void 0?t.state:null,t.updater=S3,e.stateNode=t,t._reactInternals=e,n&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=i,e.__reactInternalMemoizedMaskedChildContext=a),t}function h8(e,t,r,n){e=t.state,typeof t.componentWillReceiveProps=="function"&&t.componentWillReceiveProps(r,n),typeof t.UNSAFE_componentWillReceiveProps=="function"&&t.UNSAFE_componentWillReceiveProps(r,n),t.state!==e&&S3.enqueueReplaceState(t,t.state,null)}function SM(e,t,r,n){var i=e.stateNode;i.props=r,i.state=e.memoizedState,i.refs=L$,jk(e);var a=t.contextType;typeof a=="object"&&a!==null?i.context=Xs(a):(a=To(t)?cv:qa.current,i.context=Xg(e,a)),i.state=e.memoizedState,a=t.getDerivedStateFromProps,typeof a=="function"&&(xM(e,t,a,r),i.state=e.memoizedState),typeof t.getDerivedStateFromProps=="function"||typeof i.getSnapshotBeforeUpdate=="function"||typeof i.UNSAFE_componentWillMount!="function"&&typeof i.componentWillMount!="function"||(t=i.state,typeof i.componentWillMount=="function"&&i.componentWillMount(),typeof i.UNSAFE_componentWillMount=="function"&&i.UNSAFE_componentWillMount(),t!==i.state&&S3.enqueueReplaceState(i,i.state,null),YC(e,r,i,n),i.state=e.memoizedState),typeof i.componentDidMount=="function"&&(e.flags|=4194308)}function hy(e,t,r){if(e=r.ref,e!==null&&typeof e!="function"&&typeof e!="object"){if(r._owner){if(r=r._owner,r){if(r.tag!==1)throw Error(Tt(309));var n=r.stateNode}if(!n)throw Error(Tt(147,e));var i=n,a=""+e;return t!==null&&t.ref!==null&&typeof t.ref=="function"&&t.ref._stringRef===a?t.ref:(t=function(o){var s=i.refs;s===L$&&(s=i.refs={}),o===null?delete s[a]:s[a]=o},t._stringRef=a,t)}if(typeof e!="string")throw Error(Tt(284));if(!r._owner)throw Error(Tt(290,e))}return e}function mx(e,t){throw e=Object.prototype.toString.call(t),Error(Tt(31,e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function p8(e){var t=e._init;return t(e._payload)}function B$(e){function t(g,y){if(e){var b=g.deletions;b===null?(g.deletions=[y],g.flags|=16):b.push(y)}}function r(g,y){if(!e)return null;for(;y!==null;)t(g,y),y=y.sibling;return null}function n(g,y){for(g=new Map;y!==null;)y.key!==null?g.set(y.key,y):g.set(y.index,y),y=y.sibling;return g}function i(g,y){return g=uh(g,y),g.index=0,g.sibling=null,g}function a(g,y,b){return g.index=b,e?(b=g.alternate,b!==null?(b=b.index,b<y?(g.flags|=2,y):b):(g.flags|=2,y)):(g.flags|=1048576,y)}function o(g){return e&&g.alternate===null&&(g.flags|=2),g}function s(g,y,b,S){return y===null||y.tag!==6?(y=T4(b,g.mode,S),y.return=g,y):(y=i(y,b),y.return=g,y)}function u(g,y,b,S){var x=b.type;return x===Jm?c(g,y,b.props.children,S,b.key):y!==null&&(y.elementType===x||typeof x=="object"&&x!==null&&x.$$typeof===wf&&p8(x)===y.type)?(S=i(y,b.props),S.ref=hy(g,y,b),S.return=g,S):(S=eC(b.type,b.key,b.props,null,g.mode,S),S.ref=hy(g,y,b),S.return=g,S)}function l(g,y,b,S){return y===null||y.tag!==4||y.stateNode.containerInfo!==b.containerInfo||y.stateNode.implementation!==b.implementation?(y=I4(b,g.mode,S),y.return=g,y):(y=i(y,b.children||[]),y.return=g,y)}function c(g,y,b,S,x){return y===null||y.tag!==7?(y=Kp(b,g.mode,S,x),y.return=g,y):(y=i(y,b),y.return=g,y)}function d(g,y,b){if(typeof y=="string"&&y!==""||typeof y=="number")return y=T4(""+y,g.mode,b),y.return=g,y;if(typeof y=="object"&&y!==null){switch(y.$$typeof){case ax:return b=eC(y.type,y.key,y.props,null,g.mode,b),b.ref=hy(g,null,y),b.return=g,b;case Zm:return y=I4(y,g.mode,b),y.return=g,y;case wf:var S=y._init;return d(g,S(y._payload),b)}if(Zy(y)||uy(y))return y=Kp(y,g.mode,b,null),y.return=g,y;mx(g,y)}return null}function f(g,y,b,S){var x=y!==null?y.key:null;if(typeof b=="string"&&b!==""||typeof b=="number")return x!==null?null:s(g,y,""+b,S);if(typeof b=="object"&&b!==null){switch(b.$$typeof){case ax:return b.key===x?u(g,y,b,S):null;case Zm:return b.key===x?l(g,y,b,S):null;case wf:return x=b._init,f(g,y,x(b._payload),S)}if(Zy(b)||uy(b))return x!==null?null:c(g,y,b,S,null);mx(g,b)}return null}function h(g,y,b,S,x){if(typeof S=="string"&&S!==""||typeof S=="number")return g=g.get(b)||null,s(y,g,""+S,x);if(typeof S=="object"&&S!==null){switch(S.$$typeof){case ax:return g=g.get(S.key===null?b:S.key)||null,u(y,g,S,x);case Zm:return g=g.get(S.key===null?b:S.key)||null,l(y,g,S,x);case wf:var C=S._init;return h(g,y,b,C(S._payload),x)}if(Zy(S)||uy(S))return g=g.get(b)||null,c(y,g,S,x,null);mx(y,S)}return null}function v(g,y,b,S){for(var x=null,C=null,w=y,A=y=0,M=null;w!==null&&A<b.length;A++){w.index>A?(M=w,w=null):M=w.sibling;var D=f(g,w,b[A],S);if(D===null){w===null&&(w=M);break}e&&w&&D.alternate===null&&t(g,w),y=a(D,y,A),C===null?x=D:C.sibling=D,C=D,w=M}if(A===b.length)return r(g,w),oi&&xp(g,A),x;if(w===null){for(;A<b.length;A++)w=d(g,b[A],S),w!==null&&(y=a(w,y,A),C===null?x=w:C.sibling=w,C=w);return oi&&xp(g,A),x}for(w=n(g,w);A<b.length;A++)M=h(w,g,A,b[A],S),M!==null&&(e&&M.alternate!==null&&w.delete(M.key===null?A:M.key),y=a(M,y,A),C===null?x=M:C.sibling=M,C=M);return e&&w.forEach(function(k){return t(g,k)}),oi&&xp(g,A),x}function p(g,y,b,S){var x=uy(b);if(typeof x!="function")throw Error(Tt(150));if(b=x.call(b),b==null)throw Error(Tt(151));for(var C=x=null,w=y,A=y=0,M=null,D=b.next();w!==null&&!D.done;A++,D=b.next()){w.index>A?(M=w,w=null):M=w.sibling;var k=f(g,w,D.value,S);if(k===null){w===null&&(w=M);break}e&&w&&k.alternate===null&&t(g,w),y=a(k,y,A),C===null?x=k:C.sibling=k,C=k,w=M}if(D.done)return r(g,w),oi&&xp(g,A),x;if(w===null){for(;!D.done;A++,D=b.next())D=d(g,D.value,S),D!==null&&(y=a(D,y,A),C===null?x=D:C.sibling=D,C=D);return oi&&xp(g,A),x}for(w=n(g,w);!D.done;A++,D=b.next())D=h(w,g,A,D.value,S),D!==null&&(e&&D.alternate!==null&&w.delete(D.key===null?A:D.key),y=a(D,y,A),C===null?x=D:C.sibling=D,C=D);return e&&w.forEach(function(R){return t(g,R)}),oi&&xp(g,A),x}function m(g,y,b,S){if(typeof b=="object"&&b!==null&&b.type===Jm&&b.key===null&&(b=b.props.children),typeof b=="object"&&b!==null){switch(b.$$typeof){case ax:e:{for(var x=b.key,C=y;C!==null;){if(C.key===x){if(x=b.type,x===Jm){if(C.tag===7){r(g,C.sibling),y=i(C,b.props.children),y.return=g,g=y;break e}}else if(C.elementType===x||typeof x=="object"&&x!==null&&x.$$typeof===wf&&p8(x)===C.type){r(g,C.sibling),y=i(C,b.props),y.ref=hy(g,C,b),y.return=g,g=y;break e}r(g,C);break}else t(g,C);C=C.sibling}b.type===Jm?(y=Kp(b.props.children,g.mode,S,b.key),y.return=g,g=y):(S=eC(b.type,b.key,b.props,null,g.mode,S),S.ref=hy(g,y,b),S.return=g,g=S)}return o(g);case Zm:e:{for(C=b.key;y!==null;){if(y.key===C)if(y.tag===4&&y.stateNode.containerInfo===b.containerInfo&&y.stateNode.implementation===b.implementation){r(g,y.sibling),y=i(y,b.children||[]),y.return=g,g=y;break e}else{r(g,y);break}else t(g,y);y=y.sibling}y=I4(b,g.mode,S),y.return=g,g=y}return o(g);case wf:return C=b._init,m(g,y,C(b._payload),S)}if(Zy(b))return v(g,y,b,S);if(uy(b))return p(g,y,b,S);mx(g,b)}return typeof b=="string"&&b!==""||typeof b=="number"?(b=""+b,y!==null&&y.tag===6?(r(g,y.sibling),y=i(y,b),y.return=g,g=y):(r(g,y),y=T4(b,g.mode,S),y.return=g,g=y),o(g)):r(g,y)}return m}var Kg=B$(!0),U$=B$(!1),l2={},jl=jh(l2),cb=jh(l2),db=jh(l2);function Up(e){if(e===l2)throw Error(Tt(174));return e}function zk(e,t){switch(zn(db,t),zn(cb,e),zn(jl,l2),e=t.nodeType,e){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:JI(null,"");break;default:e=e===8?t.parentNode:t,t=e.namespaceURI||null,e=e.tagName,t=JI(t,e)}Qn(jl),zn(jl,t)}function Qg(){Qn(jl),Qn(cb),Qn(db)}function j$(e){Up(db.current);var t=Up(jl.current),r=JI(t,e.type);t!==r&&(zn(cb,e),zn(jl,r))}function Vk(e){cb.current===e&&(Qn(jl),Qn(cb))}var di=jh(0);function KC(e){for(var t=e;t!==null;){if(t.tag===13){var r=t.memoizedState;if(r!==null&&(r=r.dehydrated,r===null||r.data==="$?"||r.data==="$!"))return t}else if(t.tag===19&&t.memoizedProps.revealOrder!==void 0){if(t.flags&128)return t}else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var C4=[];function Hk(){for(var e=0;e<C4.length;e++)C4[e]._workInProgressVersionPrimary=null;C4.length=0}var YS=Pd.ReactCurrentDispatcher,_4=Pd.ReactCurrentBatchConfig,fv=0,pi=null,qi=null,ca=null,QC=!1,P1=!1,fb=0,Rle=0;function Ma(){throw Error(Tt(321))}function Gk(e,t){if(t===null)return!1;for(var r=0;r<t.length&&r<e.length;r++)if(!Vu(e[r],t[r]))return!1;return!0}function qk(e,t,r,n,i,a){if(fv=a,pi=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,YS.current=e===null||e.memoizedState===null?Lle:Nle,e=r(n,i),P1){a=0;do{if(P1=!1,fb=0,25<=a)throw Error(Tt(301));a+=1,ca=qi=null,t.updateQueue=null,YS.current=Ble,e=r(n,i)}while(P1)}if(YS.current=ZC,t=qi!==null&&qi.next!==null,fv=0,ca=qi=pi=null,QC=!1,t)throw Error(Tt(300));return e}function $k(){var e=fb!==0;return fb=0,e}function Cl(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return ca===null?pi.memoizedState=ca=e:ca=ca.next=e,ca}function Ys(){if(qi===null){var e=pi.alternate;e=e!==null?e.memoizedState:null}else e=qi.next;var t=ca===null?pi.memoizedState:ca.next;if(t!==null)ca=t,qi=e;else{if(e===null)throw Error(Tt(310));qi=e,e={memoizedState:qi.memoizedState,baseState:qi.baseState,baseQueue:qi.baseQueue,queue:qi.queue,next:null},ca===null?pi.memoizedState=ca=e:ca=ca.next=e}return ca}function hb(e,t){return typeof t=="function"?t(e):t}function w4(e){var t=Ys(),r=t.queue;if(r===null)throw Error(Tt(311));r.lastRenderedReducer=e;var n=qi,i=n.baseQueue,a=r.pending;if(a!==null){if(i!==null){var o=i.next;i.next=a.next,a.next=o}n.baseQueue=i=a,r.pending=null}if(i!==null){a=i.next,n=n.baseState;var s=o=null,u=null,l=a;do{var c=l.lane;if((fv&c)===c)u!==null&&(u=u.next={lane:0,action:l.action,hasEagerState:l.hasEagerState,eagerState:l.eagerState,next:null}),n=l.hasEagerState?l.eagerState:e(n,l.action);else{var d={lane:c,action:l.action,hasEagerState:l.hasEagerState,eagerState:l.eagerState,next:null};u===null?(s=u=d,o=n):u=u.next=d,pi.lanes|=c,hv|=c}l=l.next}while(l!==null&&l!==a);u===null?o=n:u.next=s,Vu(n,t.memoizedState)||(Ao=!0),t.memoizedState=n,t.baseState=o,t.baseQueue=u,r.lastRenderedState=n}if(e=r.interleaved,e!==null){i=e;do a=i.lane,pi.lanes|=a,hv|=a,i=i.next;while(i!==e)}else i===null&&(r.lanes=0);return[t.memoizedState,r.dispatch]}function E4(e){var t=Ys(),r=t.queue;if(r===null)throw Error(Tt(311));r.lastRenderedReducer=e;var n=r.dispatch,i=r.pending,a=t.memoizedState;if(i!==null){r.pending=null;var o=i=i.next;do a=e(a,o.action),o=o.next;while(o!==i);Vu(a,t.memoizedState)||(Ao=!0),t.memoizedState=a,t.baseQueue===null&&(t.baseState=a),r.lastRenderedState=a}return[a,n]}function z$(){}function V$(e,t){var r=pi,n=Ys(),i=t(),a=!Vu(n.memoizedState,i);if(a&&(n.memoizedState=i,Ao=!0),n=n.queue,Wk(q$.bind(null,r,n,e),[e]),n.getSnapshot!==t||a||ca!==null&&ca.memoizedState.tag&1){if(r.flags|=2048,pb(9,G$.bind(null,r,n,i,t),void 0,null),fa===null)throw Error(Tt(349));fv&30||H$(r,t,i)}return i}function H$(e,t,r){e.flags|=16384,e={getSnapshot:t,value:r},t=pi.updateQueue,t===null?(t={lastEffect:null,stores:null},pi.updateQueue=t,t.stores=[e]):(r=t.stores,r===null?t.stores=[e]:r.push(e))}function G$(e,t,r,n){t.value=r,t.getSnapshot=n,$$(t)&&W$(e)}function q$(e,t,r){return r(function(){$$(t)&&W$(e)})}function $$(e){var t=e.getSnapshot;e=e.value;try{var r=t();return!Vu(e,r)}catch{return!0}}function W$(e){var t=rd(e,1);t!==null&&Du(t,e,1,-1)}function v8(e){var t=Cl();return typeof e=="function"&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:hb,lastRenderedState:e},t.queue=e,e=e.dispatch=Fle.bind(null,pi,e),[t.memoizedState,e]}function pb(e,t,r,n){return e={tag:e,create:t,destroy:r,deps:n,next:null},t=pi.updateQueue,t===null?(t={lastEffect:null,stores:null},pi.updateQueue=t,t.lastEffect=e.next=e):(r=t.lastEffect,r===null?t.lastEffect=e.next=e:(n=r.next,r.next=e,e.next=n,t.lastEffect=e)),e}function X$(){return Ys().memoizedState}function KS(e,t,r,n){var i=Cl();pi.flags|=e,i.memoizedState=pb(1|t,r,void 0,n===void 0?null:n)}function C3(e,t,r,n){var i=Ys();n=n===void 0?null:n;var a=void 0;if(qi!==null){var o=qi.memoizedState;if(a=o.destroy,n!==null&&Gk(n,o.deps)){i.memoizedState=pb(t,r,a,n);return}}pi.flags|=e,i.memoizedState=pb(1|t,r,a,n)}function m8(e,t){return KS(8390656,8,e,t)}function Wk(e,t){return C3(2048,8,e,t)}function Y$(e,t){return C3(4,2,e,t)}function K$(e,t){return C3(4,4,e,t)}function Q$(e,t){if(typeof t=="function")return e=e(),t(e),function(){t(null)};if(t!=null)return e=e(),t.current=e,function(){t.current=null}}function Z$(e,t,r){return r=r!=null?r.concat([e]):null,C3(4,4,Q$.bind(null,t,e),r)}function Xk(){}function J$(e,t){var r=Ys();t=t===void 0?null:t;var n=r.memoizedState;return n!==null&&t!==null&&Gk(t,n[1])?n[0]:(r.memoizedState=[e,t],e)}function eW(e,t){var r=Ys();t=t===void 0?null:t;var n=r.memoizedState;return n!==null&&t!==null&&Gk(t,n[1])?n[0]:(e=e(),r.memoizedState=[e,t],e)}function tW(e,t,r){return fv&21?(Vu(r,t)||(r=i$(),pi.lanes|=r,hv|=r,e.baseState=!0),t):(e.baseState&&(e.baseState=!1,Ao=!0),e.memoizedState=r)}function kle(e,t){var r=Tn;Tn=r!==0&&4>r?r:4,e(!0);var n=_4.transition;_4.transition={};try{e(!1),t()}finally{Tn=r,_4.transition=n}}function rW(){return Ys().memoizedState}function Ole(e,t,r){var n=sh(e);if(r={lane:n,action:r,hasEagerState:!1,eagerState:null,next:null},nW(e))iW(t,r);else if(r=O$(e,t,r,n),r!==null){var i=io();Du(r,e,n,i),aW(r,t,n)}}function Fle(e,t,r){var n=sh(e),i={lane:n,action:r,hasEagerState:!1,eagerState:null,next:null};if(nW(e))iW(t,i);else{var a=e.alternate;if(e.lanes===0&&(a===null||a.lanes===0)&&(a=t.lastRenderedReducer,a!==null))try{var o=t.lastRenderedState,s=a(o,r);if(i.hasEagerState=!0,i.eagerState=s,Vu(s,o)){var u=t.interleaved;u===null?(i.next=i,Uk(t)):(i.next=u.next,u.next=i),t.interleaved=i;return}}catch{}finally{}r=O$(e,t,i,n),r!==null&&(i=io(),Du(r,e,n,i),aW(r,t,n))}}function nW(e){var t=e.alternate;return e===pi||t!==null&&t===pi}function iW(e,t){P1=QC=!0;var r=e.pending;r===null?t.next=t:(t.next=r.next,r.next=t),e.pending=t}function aW(e,t,r){if(r&4194240){var n=t.lanes;n&=e.pendingLanes,r|=n,t.lanes=r,Ek(e,r)}}var ZC={readContext:Xs,useCallback:Ma,useContext:Ma,useEffect:Ma,useImperativeHandle:Ma,useInsertionEffect:Ma,useLayoutEffect:Ma,useMemo:Ma,useReducer:Ma,useRef:Ma,useState:Ma,useDebugValue:Ma,useDeferredValue:Ma,useTransition:Ma,useMutableSource:Ma,useSyncExternalStore:Ma,useId:Ma,unstable_isNewReconciler:!1},Lle={readContext:Xs,useCallback:function(e,t){return Cl().memoizedState=[e,t===void 0?null:t],e},useContext:Xs,useEffect:m8,useImperativeHandle:function(e,t,r){return r=r!=null?r.concat([e]):null,KS(4194308,4,Q$.bind(null,t,e),r)},useLayoutEffect:function(e,t){return KS(4194308,4,e,t)},useInsertionEffect:function(e,t){return KS(4,2,e,t)},useMemo:function(e,t){var r=Cl();return t=t===void 0?null:t,e=e(),r.memoizedState=[e,t],e},useReducer:function(e,t,r){var n=Cl();return t=r!==void 0?r(t):t,n.memoizedState=n.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},n.queue=e,e=e.dispatch=Ole.bind(null,pi,e),[n.memoizedState,e]},useRef:function(e){var t=Cl();return e={current:e},t.memoizedState=e},useState:v8,useDebugValue:Xk,useDeferredValue:function(e){return Cl().memoizedState=e},useTransition:function(){var e=v8(!1),t=e[0];return e=kle.bind(null,e[1]),Cl().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,r){var n=pi,i=Cl();if(oi){if(r===void 0)throw Error(Tt(407));r=r()}else{if(r=t(),fa===null)throw Error(Tt(349));fv&30||H$(n,t,r)}i.memoizedState=r;var a={value:r,getSnapshot:t};return i.queue=a,m8(q$.bind(null,n,a,e),[e]),n.flags|=2048,pb(9,G$.bind(null,n,a,r,t),void 0,null),r},useId:function(){var e=Cl(),t=fa.identifierPrefix;if(oi){var r=Lc,n=Fc;r=(n&~(1<<32-Mu(n)-1)).toString(32)+r,t=":"+t+"R"+r,r=fb++,0<r&&(t+="H"+r.toString(32)),t+=":"}else r=Rle++,t=":"+t+"r"+r.toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},Nle={readContext:Xs,useCallback:J$,useContext:Xs,useEffect:Wk,useImperativeHandle:Z$,useInsertionEffect:Y$,useLayoutEffect:K$,useMemo:eW,useReducer:w4,useRef:X$,useState:function(){return w4(hb)},useDebugValue:Xk,useDeferredValue:function(e){var t=Ys();return tW(t,qi.memoizedState,e)},useTransition:function(){var e=w4(hb)[0],t=Ys().memoizedState;return[e,t]},useMutableSource:z$,useSyncExternalStore:V$,useId:rW,unstable_isNewReconciler:!1},Ble={readContext:Xs,useCallback:J$,useContext:Xs,useEffect:Wk,useImperativeHandle:Z$,useInsertionEffect:Y$,useLayoutEffect:K$,useMemo:eW,useReducer:E4,useRef:X$,useState:function(){return E4(hb)},useDebugValue:Xk,useDeferredValue:function(e){var t=Ys();return qi===null?t.memoizedState=e:tW(t,qi.memoizedState,e)},useTransition:function(){var e=E4(hb)[0],t=Ys().memoizedState;return[e,t]},useMutableSource:z$,useSyncExternalStore:V$,useId:rW,unstable_isNewReconciler:!1};function Zg(e,t){try{var r="",n=t;do r+=fue(n),n=n.return;while(n);var i=r}catch(a){i=`
Error generating stack: `+a.message+`
`+a.stack}return{value:e,source:t,stack:i,digest:null}}function A4(e,t,r){return{value:e,source:null,stack:r??null,digest:t??null}}function CM(e,t){try{console.error(t.value)}catch(r){setTimeout(function(){throw r})}}var Ule=typeof WeakMap=="function"?WeakMap:Map;function oW(e,t,r){r=qc(-1,r),r.tag=3,r.payload={element:null};var n=t.value;return r.callback=function(){e_||(e_=!0,RM=n),CM(e,t)},r}function sW(e,t,r){r=qc(-1,r),r.tag=3;var n=e.type.getDerivedStateFromError;if(typeof n=="function"){var i=t.value;r.payload=function(){return n(i)},r.callback=function(){CM(e,t)}}var a=e.stateNode;return a!==null&&typeof a.componentDidCatch=="function"&&(r.callback=function(){CM(e,t),typeof n!="function"&&(oh===null?oh=new Set([this]):oh.add(this));var o=t.stack;this.componentDidCatch(t.value,{componentStack:o!==null?o:""})}),r}function g8(e,t,r){var n=e.pingCache;if(n===null){n=e.pingCache=new Ule;var i=new Set;n.set(t,i)}else i=n.get(t),i===void 0&&(i=new Set,n.set(t,i));i.has(r)||(i.add(r),e=Jle.bind(null,e,t,r),t.then(e,e))}function y8(e){do{var t;if((t=e.tag===13)&&(t=e.memoizedState,t=t!==null?t.dehydrated!==null:!0),t)return e;e=e.return}while(e!==null);return null}function b8(e,t,r,n,i){return e.mode&1?(e.flags|=65536,e.lanes=i,e):(e===t?e.flags|=65536:(e.flags|=128,r.flags|=131072,r.flags&=-52805,r.tag===1&&(r.alternate===null?r.tag=17:(t=qc(-1,1),t.tag=2,ah(r,t,1))),r.lanes|=1),e)}var jle=Pd.ReactCurrentOwner,Ao=!1;function ro(e,t,r,n){t.child=e===null?U$(t,null,r,n):Kg(t,e.child,r,n)}function x8(e,t,r,n,i){r=r.render;var a=t.ref;return Eg(t,i),n=qk(e,t,r,n,a,i),r=$k(),e!==null&&!Ao?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~i,nd(e,t,i)):(oi&&r&&kk(t),t.flags|=1,ro(e,t,n,i),t.child)}function S8(e,t,r,n,i){if(e===null){var a=r.type;return typeof a=="function"&&!rO(a)&&a.defaultProps===void 0&&r.compare===null&&r.defaultProps===void 0?(t.tag=15,t.type=a,uW(e,t,a,n,i)):(e=eC(r.type,null,n,t,t.mode,i),e.ref=t.ref,e.return=t,t.child=e)}if(a=e.child,!(e.lanes&i)){var o=a.memoizedProps;if(r=r.compare,r=r!==null?r:ob,r(o,n)&&e.ref===t.ref)return nd(e,t,i)}return t.flags|=1,e=uh(a,n),e.ref=t.ref,e.return=t,t.child=e}function uW(e,t,r,n,i){if(e!==null){var a=e.memoizedProps;if(ob(a,n)&&e.ref===t.ref)if(Ao=!1,t.pendingProps=n=a,(e.lanes&i)!==0)e.flags&131072&&(Ao=!0);else return t.lanes=e.lanes,nd(e,t,i)}return _M(e,t,r,n,i)}function lW(e,t,r){var n=t.pendingProps,i=n.children,a=e!==null?e.memoizedState:null;if(n.mode==="hidden")if(!(t.mode&1))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},zn(lg,Wo),Wo|=r;else{if(!(r&1073741824))return e=a!==null?a.baseLanes|r:r,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,zn(lg,Wo),Wo|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},n=a!==null?a.baseLanes:r,zn(lg,Wo),Wo|=n}else a!==null?(n=a.baseLanes|r,t.memoizedState=null):n=r,zn(lg,Wo),Wo|=n;return ro(e,t,i,r),t.child}function cW(e,t){var r=t.ref;(e===null&&r!==null||e!==null&&e.ref!==r)&&(t.flags|=512,t.flags|=2097152)}function _M(e,t,r,n,i){var a=To(r)?cv:qa.current;return a=Xg(t,a),Eg(t,i),r=qk(e,t,r,n,a,i),n=$k(),e!==null&&!Ao?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~i,nd(e,t,i)):(oi&&n&&kk(t),t.flags|=1,ro(e,t,r,i),t.child)}function C8(e,t,r,n,i){if(To(r)){var a=!0;GC(t)}else a=!1;if(Eg(t,i),t.stateNode===null)QS(e,t),N$(t,r,n),SM(t,r,n,i),n=!0;else if(e===null){var o=t.stateNode,s=t.memoizedProps;o.props=s;var u=o.context,l=r.contextType;typeof l=="object"&&l!==null?l=Xs(l):(l=To(r)?cv:qa.current,l=Xg(t,l));var c=r.getDerivedStateFromProps,d=typeof c=="function"||typeof o.getSnapshotBeforeUpdate=="function";d||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(s!==n||u!==l)&&h8(t,o,n,l),Ef=!1;var f=t.memoizedState;o.state=f,YC(t,n,o,i),u=t.memoizedState,s!==n||f!==u||Po.current||Ef?(typeof c=="function"&&(xM(t,r,c,n),u=t.memoizedState),(s=Ef||f8(t,r,s,n,f,u,l))?(d||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(t.flags|=4194308)):(typeof o.componentDidMount=="function"&&(t.flags|=4194308),t.memoizedProps=n,t.memoizedState=u),o.props=n,o.state=u,o.context=l,n=s):(typeof o.componentDidMount=="function"&&(t.flags|=4194308),n=!1)}else{o=t.stateNode,F$(e,t),s=t.memoizedProps,l=t.type===t.elementType?s:gu(t.type,s),o.props=l,d=t.pendingProps,f=o.context,u=r.contextType,typeof u=="object"&&u!==null?u=Xs(u):(u=To(r)?cv:qa.current,u=Xg(t,u));var h=r.getDerivedStateFromProps;(c=typeof h=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(s!==d||f!==u)&&h8(t,o,n,u),Ef=!1,f=t.memoizedState,o.state=f,YC(t,n,o,i);var v=t.memoizedState;s!==d||f!==v||Po.current||Ef?(typeof h=="function"&&(xM(t,r,h,n),v=t.memoizedState),(l=Ef||f8(t,r,l,n,f,v,u)||!1)?(c||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(n,v,u),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(n,v,u)),typeof o.componentDidUpdate=="function"&&(t.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(t.flags|=1024)):(typeof o.componentDidUpdate!="function"||s===e.memoizedProps&&f===e.memoizedState||(t.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||s===e.memoizedProps&&f===e.memoizedState||(t.flags|=1024),t.memoizedProps=n,t.memoizedState=v),o.props=n,o.state=v,o.context=u,n=l):(typeof o.componentDidUpdate!="function"||s===e.memoizedProps&&f===e.memoizedState||(t.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||s===e.memoizedProps&&f===e.memoizedState||(t.flags|=1024),n=!1)}return wM(e,t,r,n,a,i)}function wM(e,t,r,n,i,a){cW(e,t);var o=(t.flags&128)!==0;if(!n&&!o)return i&&s8(t,r,!1),nd(e,t,a);n=t.stateNode,jle.current=t;var s=o&&typeof r.getDerivedStateFromError!="function"?null:n.render();return t.flags|=1,e!==null&&o?(t.child=Kg(t,e.child,null,a),t.child=Kg(t,null,s,a)):ro(e,t,s,a),t.memoizedState=n.state,i&&s8(t,r,!0),t.child}function dW(e){var t=e.stateNode;t.pendingContext?o8(e,t.pendingContext,t.pendingContext!==t.context):t.context&&o8(e,t.context,!1),zk(e,t.containerInfo)}function _8(e,t,r,n,i){return Yg(),Fk(i),t.flags|=256,ro(e,t,r,n),t.child}var EM={dehydrated:null,treeContext:null,retryLane:0};function AM(e){return{baseLanes:e,cachePool:null,transitions:null}}function fW(e,t,r){var n=t.pendingProps,i=di.current,a=!1,o=(t.flags&128)!==0,s;if((s=o)||(s=e!==null&&e.memoizedState===null?!1:(i&2)!==0),s?(a=!0,t.flags&=-129):(e===null||e.memoizedState!==null)&&(i|=1),zn(di,i&1),e===null)return yM(t),e=t.memoizedState,e!==null&&(e=e.dehydrated,e!==null)?(t.mode&1?e.data==="$!"?t.lanes=8:t.lanes=1073741824:t.lanes=1,null):(o=n.children,e=n.fallback,a?(n=t.mode,a=t.child,o={mode:"hidden",children:o},!(n&1)&&a!==null?(a.childLanes=0,a.pendingProps=o):a=E3(o,n,0,null),e=Kp(e,n,r,null),a.return=t,e.return=t,a.sibling=e,t.child=a,t.child.memoizedState=AM(r),t.memoizedState=EM,e):Yk(t,o));if(i=e.memoizedState,i!==null&&(s=i.dehydrated,s!==null))return zle(e,t,o,n,s,i,r);if(a){a=n.fallback,o=t.mode,i=e.child,s=i.sibling;var u={mode:"hidden",children:n.children};return!(o&1)&&t.child!==i?(n=t.child,n.childLanes=0,n.pendingProps=u,t.deletions=null):(n=uh(i,u),n.subtreeFlags=i.subtreeFlags&14680064),s!==null?a=uh(s,a):(a=Kp(a,o,r,null),a.flags|=2),a.return=t,n.return=t,n.sibling=a,t.child=n,n=a,a=t.child,o=e.child.memoizedState,o=o===null?AM(r):{baseLanes:o.baseLanes|r,cachePool:null,transitions:o.transitions},a.memoizedState=o,a.childLanes=e.childLanes&~r,t.memoizedState=EM,n}return a=e.child,e=a.sibling,n=uh(a,{mode:"visible",children:n.children}),!(t.mode&1)&&(n.lanes=r),n.return=t,n.sibling=null,e!==null&&(r=t.deletions,r===null?(t.deletions=[e],t.flags|=16):r.push(e)),t.child=n,t.memoizedState=null,n}function Yk(e,t){return t=E3({mode:"visible",children:t},e.mode,0,null),t.return=e,e.child=t}function gx(e,t,r,n){return n!==null&&Fk(n),Kg(t,e.child,null,r),e=Yk(t,t.pendingProps.children),e.flags|=2,t.memoizedState=null,e}function zle(e,t,r,n,i,a,o){if(r)return t.flags&256?(t.flags&=-257,n=A4(Error(Tt(422))),gx(e,t,o,n)):t.memoizedState!==null?(t.child=e.child,t.flags|=128,null):(a=n.fallback,i=t.mode,n=E3({mode:"visible",children:n.children},i,0,null),a=Kp(a,i,o,null),a.flags|=2,n.return=t,a.return=t,n.sibling=a,t.child=n,t.mode&1&&Kg(t,e.child,null,o),t.child.memoizedState=AM(o),t.memoizedState=EM,a);if(!(t.mode&1))return gx(e,t,o,null);if(i.data==="$!"){if(n=i.nextSibling&&i.nextSibling.dataset,n)var s=n.dgst;return n=s,a=Error(Tt(419)),n=A4(a,n,void 0),gx(e,t,o,n)}if(s=(o&e.childLanes)!==0,Ao||s){if(n=fa,n!==null){switch(o&-o){case 4:i=2;break;case 16:i=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:i=32;break;case 536870912:i=268435456;break;default:i=0}i=i&(n.suspendedLanes|o)?0:i,i!==0&&i!==a.retryLane&&(a.retryLane=i,rd(e,i),Du(n,e,i,-1))}return tO(),n=A4(Error(Tt(421))),gx(e,t,o,n)}return i.data==="$?"?(t.flags|=128,t.child=e.child,t=ece.bind(null,e),i._reactRetry=t,null):(e=a.treeContext,Zo=ih(i.nextSibling),rs=t,oi=!0,Su=null,e!==null&&(Us[js++]=Fc,Us[js++]=Lc,Us[js++]=dv,Fc=e.id,Lc=e.overflow,dv=t),t=Yk(t,n.children),t.flags|=4096,t)}function w8(e,t,r){e.lanes|=t;var n=e.alternate;n!==null&&(n.lanes|=t),bM(e.return,t,r)}function P4(e,t,r,n,i){var a=e.memoizedState;a===null?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:n,tail:r,tailMode:i}:(a.isBackwards=t,a.rendering=null,a.renderingStartTime=0,a.last=n,a.tail=r,a.tailMode=i)}function hW(e,t,r){var n=t.pendingProps,i=n.revealOrder,a=n.tail;if(ro(e,t,n.children,r),n=di.current,n&2)n=n&1|2,t.flags|=128;else{if(e!==null&&e.flags&128)e:for(e=t.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&w8(e,r,t);else if(e.tag===19)w8(e,r,t);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;e.sibling===null;){if(e.return===null||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}n&=1}if(zn(di,n),!(t.mode&1))t.memoizedState=null;else switch(i){case"forwards":for(r=t.child,i=null;r!==null;)e=r.alternate,e!==null&&KC(e)===null&&(i=r),r=r.sibling;r=i,r===null?(i=t.child,t.child=null):(i=r.sibling,r.sibling=null),P4(t,!1,i,r,a);break;case"backwards":for(r=null,i=t.child,t.child=null;i!==null;){if(e=i.alternate,e!==null&&KC(e)===null){t.child=i;break}e=i.sibling,i.sibling=r,r=i,i=e}P4(t,!0,r,null,a);break;case"together":P4(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function QS(e,t){!(t.mode&1)&&e!==null&&(e.alternate=null,t.alternate=null,t.flags|=2)}function nd(e,t,r){if(e!==null&&(t.dependencies=e.dependencies),hv|=t.lanes,!(r&t.childLanes))return null;if(e!==null&&t.child!==e.child)throw Error(Tt(153));if(t.child!==null){for(e=t.child,r=uh(e,e.pendingProps),t.child=r,r.return=t;e.sibling!==null;)e=e.sibling,r=r.sibling=uh(e,e.pendingProps),r.return=t;r.sibling=null}return t.child}function Vle(e,t,r){switch(t.tag){case 3:dW(t),Yg();break;case 5:j$(t);break;case 1:To(t.type)&&GC(t);break;case 4:zk(t,t.stateNode.containerInfo);break;case 10:var n=t.type._context,i=t.memoizedProps.value;zn(WC,n._currentValue),n._currentValue=i;break;case 13:if(n=t.memoizedState,n!==null)return n.dehydrated!==null?(zn(di,di.current&1),t.flags|=128,null):r&t.child.childLanes?fW(e,t,r):(zn(di,di.current&1),e=nd(e,t,r),e!==null?e.sibling:null);zn(di,di.current&1);break;case 19:if(n=(r&t.childLanes)!==0,e.flags&128){if(n)return hW(e,t,r);t.flags|=128}if(i=t.memoizedState,i!==null&&(i.rendering=null,i.tail=null,i.lastEffect=null),zn(di,di.current),n)break;return null;case 22:case 23:return t.lanes=0,lW(e,t,r)}return nd(e,t,r)}var pW,PM,vW,mW;pW=function(e,t){for(var r=t.child;r!==null;){if(r.tag===5||r.tag===6)e.appendChild(r.stateNode);else if(r.tag!==4&&r.child!==null){r.child.return=r,r=r.child;continue}if(r===t)break;for(;r.sibling===null;){if(r.return===null||r.return===t)return;r=r.return}r.sibling.return=r.return,r=r.sibling}};PM=function(){};vW=function(e,t,r,n){var i=e.memoizedProps;if(i!==n){e=t.stateNode,Up(jl.current);var a=null;switch(r){case"input":i=YI(e,i),n=YI(e,n),a=[];break;case"select":i=mi({},i,{value:void 0}),n=mi({},n,{value:void 0}),a=[];break;case"textarea":i=ZI(e,i),n=ZI(e,n),a=[];break;default:typeof i.onClick!="function"&&typeof n.onClick=="function"&&(e.onclick=VC)}eM(r,n);var o;r=null;for(l in i)if(!n.hasOwnProperty(l)&&i.hasOwnProperty(l)&&i[l]!=null)if(l==="style"){var s=i[l];for(o in s)s.hasOwnProperty(o)&&(r||(r={}),r[o]="")}else l!=="dangerouslySetInnerHTML"&&l!=="children"&&l!=="suppressContentEditableWarning"&&l!=="suppressHydrationWarning"&&l!=="autoFocus"&&(J1.hasOwnProperty(l)?a||(a=[]):(a=a||[]).push(l,null));for(l in n){var u=n[l];if(s=i!=null?i[l]:void 0,n.hasOwnProperty(l)&&u!==s&&(u!=null||s!=null))if(l==="style")if(s){for(o in s)!s.hasOwnProperty(o)||u&&u.hasOwnProperty(o)||(r||(r={}),r[o]="");for(o in u)u.hasOwnProperty(o)&&s[o]!==u[o]&&(r||(r={}),r[o]=u[o])}else r||(a||(a=[]),a.push(l,r)),r=u;else l==="dangerouslySetInnerHTML"?(u=u?u.__html:void 0,s=s?s.__html:void 0,u!=null&&s!==u&&(a=a||[]).push(l,u)):l==="children"?typeof u!="string"&&typeof u!="number"||(a=a||[]).push(l,""+u):l!=="suppressContentEditableWarning"&&l!=="suppressHydrationWarning"&&(J1.hasOwnProperty(l)?(u!=null&&l==="onScroll"&&qn("scroll",e),a||s===u||(a=[])):(a=a||[]).push(l,u))}r&&(a=a||[]).push("style",r);var l=a;(t.updateQueue=l)&&(t.flags|=4)}};mW=function(e,t,r,n){r!==n&&(t.flags|=4)};function py(e,t){if(!oi)switch(e.tailMode){case"hidden":t=e.tail;for(var r=null;t!==null;)t.alternate!==null&&(r=t),t=t.sibling;r===null?e.tail=null:r.sibling=null;break;case"collapsed":r=e.tail;for(var n=null;r!==null;)r.alternate!==null&&(n=r),r=r.sibling;n===null?t||e.tail===null?e.tail=null:e.tail.sibling=null:n.sibling=null}}function Da(e){var t=e.alternate!==null&&e.alternate.child===e.child,r=0,n=0;if(t)for(var i=e.child;i!==null;)r|=i.lanes|i.childLanes,n|=i.subtreeFlags&14680064,n|=i.flags&14680064,i.return=e,i=i.sibling;else for(i=e.child;i!==null;)r|=i.lanes|i.childLanes,n|=i.subtreeFlags,n|=i.flags,i.return=e,i=i.sibling;return e.subtreeFlags|=n,e.childLanes=r,t}function Hle(e,t,r){var n=t.pendingProps;switch(Ok(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Da(t),null;case 1:return To(t.type)&&HC(),Da(t),null;case 3:return n=t.stateNode,Qg(),Qn(Po),Qn(qa),Hk(),n.pendingContext&&(n.context=n.pendingContext,n.pendingContext=null),(e===null||e.child===null)&&(vx(t)?t.flags|=4:e===null||e.memoizedState.isDehydrated&&!(t.flags&256)||(t.flags|=1024,Su!==null&&(FM(Su),Su=null))),PM(e,t),Da(t),null;case 5:Vk(t);var i=Up(db.current);if(r=t.type,e!==null&&t.stateNode!=null)vW(e,t,r,n,i),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!n){if(t.stateNode===null)throw Error(Tt(166));return Da(t),null}if(e=Up(jl.current),vx(t)){n=t.stateNode,r=t.type;var a=t.memoizedProps;switch(n[Rl]=t,n[lb]=a,e=(t.mode&1)!==0,r){case"dialog":qn("cancel",n),qn("close",n);break;case"iframe":case"object":case"embed":qn("load",n);break;case"video":case"audio":for(i=0;i<e1.length;i++)qn(e1[i],n);break;case"source":qn("error",n);break;case"img":case"image":case"link":qn("error",n),qn("load",n);break;case"details":qn("toggle",n);break;case"input":kN(n,a),qn("invalid",n);break;case"select":n._wrapperState={wasMultiple:!!a.multiple},qn("invalid",n);break;case"textarea":FN(n,a),qn("invalid",n)}eM(r,a),i=null;for(var o in a)if(a.hasOwnProperty(o)){var s=a[o];o==="children"?typeof s=="string"?n.textContent!==s&&(a.suppressHydrationWarning!==!0&&px(n.textContent,s,e),i=["children",s]):typeof s=="number"&&n.textContent!==""+s&&(a.suppressHydrationWarning!==!0&&px(n.textContent,s,e),i=["children",""+s]):J1.hasOwnProperty(o)&&s!=null&&o==="onScroll"&&qn("scroll",n)}switch(r){case"input":ox(n),ON(n,a,!0);break;case"textarea":ox(n),LN(n);break;case"select":case"option":break;default:typeof a.onClick=="function"&&(n.onclick=VC)}n=i,t.updateQueue=n,n!==null&&(t.flags|=4)}else{o=i.nodeType===9?i:i.ownerDocument,e==="http://www.w3.org/1999/xhtml"&&(e=Hq(r)),e==="http://www.w3.org/1999/xhtml"?r==="script"?(e=o.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):typeof n.is=="string"?e=o.createElement(r,{is:n.is}):(e=o.createElement(r),r==="select"&&(o=e,n.multiple?o.multiple=!0:n.size&&(o.size=n.size))):e=o.createElementNS(e,r),e[Rl]=t,e[lb]=n,pW(e,t,!1,!1),t.stateNode=e;e:{switch(o=tM(r,n),r){case"dialog":qn("cancel",e),qn("close",e),i=n;break;case"iframe":case"object":case"embed":qn("load",e),i=n;break;case"video":case"audio":for(i=0;i<e1.length;i++)qn(e1[i],e);i=n;break;case"source":qn("error",e),i=n;break;case"img":case"image":case"link":qn("error",e),qn("load",e),i=n;break;case"details":qn("toggle",e),i=n;break;case"input":kN(e,n),i=YI(e,n),qn("invalid",e);break;case"option":i=n;break;case"select":e._wrapperState={wasMultiple:!!n.multiple},i=mi({},n,{value:void 0}),qn("invalid",e);break;case"textarea":FN(e,n),i=ZI(e,n),qn("invalid",e);break;default:i=n}eM(r,i),s=i;for(a in s)if(s.hasOwnProperty(a)){var u=s[a];a==="style"?$q(e,u):a==="dangerouslySetInnerHTML"?(u=u?u.__html:void 0,u!=null&&Gq(e,u)):a==="children"?typeof u=="string"?(r!=="textarea"||u!=="")&&eb(e,u):typeof u=="number"&&eb(e,""+u):a!=="suppressContentEditableWarning"&&a!=="suppressHydrationWarning"&&a!=="autoFocus"&&(J1.hasOwnProperty(a)?u!=null&&a==="onScroll"&&qn("scroll",e):u!=null&&bk(e,a,u,o))}switch(r){case"input":ox(e),ON(e,n,!1);break;case"textarea":ox(e),LN(e);break;case"option":n.value!=null&&e.setAttribute("value",""+xh(n.value));break;case"select":e.multiple=!!n.multiple,a=n.value,a!=null?Sg(e,!!n.multiple,a,!1):n.defaultValue!=null&&Sg(e,!!n.multiple,n.defaultValue,!0);break;default:typeof i.onClick=="function"&&(e.onclick=VC)}switch(r){case"button":case"input":case"select":case"textarea":n=!!n.autoFocus;break e;case"img":n=!0;break e;default:n=!1}}n&&(t.flags|=4)}t.ref!==null&&(t.flags|=512,t.flags|=2097152)}return Da(t),null;case 6:if(e&&t.stateNode!=null)mW(e,t,e.memoizedProps,n);else{if(typeof n!="string"&&t.stateNode===null)throw Error(Tt(166));if(r=Up(db.current),Up(jl.current),vx(t)){if(n=t.stateNode,r=t.memoizedProps,n[Rl]=t,(a=n.nodeValue!==r)&&(e=rs,e!==null))switch(e.tag){case 3:px(n.nodeValue,r,(e.mode&1)!==0);break;case 5:e.memoizedProps.suppressHydrationWarning!==!0&&px(n.nodeValue,r,(e.mode&1)!==0)}a&&(t.flags|=4)}else n=(r.nodeType===9?r:r.ownerDocument).createTextNode(n),n[Rl]=t,t.stateNode=n}return Da(t),null;case 13:if(Qn(di),n=t.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(oi&&Zo!==null&&t.mode&1&&!(t.flags&128))k$(),Yg(),t.flags|=98560,a=!1;else if(a=vx(t),n!==null&&n.dehydrated!==null){if(e===null){if(!a)throw Error(Tt(318));if(a=t.memoizedState,a=a!==null?a.dehydrated:null,!a)throw Error(Tt(317));a[Rl]=t}else Yg(),!(t.flags&128)&&(t.memoizedState=null),t.flags|=4;Da(t),a=!1}else Su!==null&&(FM(Su),Su=null),a=!0;if(!a)return t.flags&65536?t:null}return t.flags&128?(t.lanes=r,t):(n=n!==null,n!==(e!==null&&e.memoizedState!==null)&&n&&(t.child.flags|=8192,t.mode&1&&(e===null||di.current&1?Wi===0&&(Wi=3):tO())),t.updateQueue!==null&&(t.flags|=4),Da(t),null);case 4:return Qg(),PM(e,t),e===null&&sb(t.stateNode.containerInfo),Da(t),null;case 10:return Bk(t.type._context),Da(t),null;case 17:return To(t.type)&&HC(),Da(t),null;case 19:if(Qn(di),a=t.memoizedState,a===null)return Da(t),null;if(n=(t.flags&128)!==0,o=a.rendering,o===null)if(n)py(a,!1);else{if(Wi!==0||e!==null&&e.flags&128)for(e=t.child;e!==null;){if(o=KC(e),o!==null){for(t.flags|=128,py(a,!1),n=o.updateQueue,n!==null&&(t.updateQueue=n,t.flags|=4),t.subtreeFlags=0,n=r,r=t.child;r!==null;)a=r,e=n,a.flags&=14680066,o=a.alternate,o===null?(a.childLanes=0,a.lanes=e,a.child=null,a.subtreeFlags=0,a.memoizedProps=null,a.memoizedState=null,a.updateQueue=null,a.dependencies=null,a.stateNode=null):(a.childLanes=o.childLanes,a.lanes=o.lanes,a.child=o.child,a.subtreeFlags=0,a.deletions=null,a.memoizedProps=o.memoizedProps,a.memoizedState=o.memoizedState,a.updateQueue=o.updateQueue,a.type=o.type,e=o.dependencies,a.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext}),r=r.sibling;return zn(di,di.current&1|2),t.child}e=e.sibling}a.tail!==null&&Pi()>Jg&&(t.flags|=128,n=!0,py(a,!1),t.lanes=4194304)}else{if(!n)if(e=KC(o),e!==null){if(t.flags|=128,n=!0,r=e.updateQueue,r!==null&&(t.updateQueue=r,t.flags|=4),py(a,!0),a.tail===null&&a.tailMode==="hidden"&&!o.alternate&&!oi)return Da(t),null}else 2*Pi()-a.renderingStartTime>Jg&&r!==1073741824&&(t.flags|=128,n=!0,py(a,!1),t.lanes=4194304);a.isBackwards?(o.sibling=t.child,t.child=o):(r=a.last,r!==null?r.sibling=o:t.child=o,a.last=o)}return a.tail!==null?(t=a.tail,a.rendering=t,a.tail=t.sibling,a.renderingStartTime=Pi(),t.sibling=null,r=di.current,zn(di,n?r&1|2:r&1),t):(Da(t),null);case 22:case 23:return eO(),n=t.memoizedState!==null,e!==null&&e.memoizedState!==null!==n&&(t.flags|=8192),n&&t.mode&1?Wo&1073741824&&(Da(t),t.subtreeFlags&6&&(t.flags|=8192)):Da(t),null;case 24:return null;case 25:return null}throw Error(Tt(156,t.tag))}function Gle(e,t){switch(Ok(t),t.tag){case 1:return To(t.type)&&HC(),e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 3:return Qg(),Qn(Po),Qn(qa),Hk(),e=t.flags,e&65536&&!(e&128)?(t.flags=e&-65537|128,t):null;case 5:return Vk(t),null;case 13:if(Qn(di),e=t.memoizedState,e!==null&&e.dehydrated!==null){if(t.alternate===null)throw Error(Tt(340));Yg()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 19:return Qn(di),null;case 4:return Qg(),null;case 10:return Bk(t.type._context),null;case 22:case 23:return eO(),null;case 24:return null;default:return null}}var yx=!1,Ua=!1,qle=typeof WeakSet=="function"?WeakSet:Set,Vt=null;function ug(e,t){var r=e.ref;if(r!==null)if(typeof r=="function")try{r(null)}catch(n){xi(e,t,n)}else r.current=null}function TM(e,t,r){try{r()}catch(n){xi(e,t,n)}}var E8=!1;function $le(e,t){if(dM=UC,e=x$(),Rk(e)){if("selectionStart"in e)var r={start:e.selectionStart,end:e.selectionEnd};else e:{r=(r=e.ownerDocument)&&r.defaultView||window;var n=r.getSelection&&r.getSelection();if(n&&n.rangeCount!==0){r=n.anchorNode;var i=n.anchorOffset,a=n.focusNode;n=n.focusOffset;try{r.nodeType,a.nodeType}catch{r=null;break e}var o=0,s=-1,u=-1,l=0,c=0,d=e,f=null;t:for(;;){for(var h;d!==r||i!==0&&d.nodeType!==3||(s=o+i),d!==a||n!==0&&d.nodeType!==3||(u=o+n),d.nodeType===3&&(o+=d.nodeValue.length),(h=d.firstChild)!==null;)f=d,d=h;for(;;){if(d===e)break t;if(f===r&&++l===i&&(s=o),f===a&&++c===n&&(u=o),(h=d.nextSibling)!==null)break;d=f,f=d.parentNode}d=h}r=s===-1||u===-1?null:{start:s,end:u}}else r=null}r=r||{start:0,end:0}}else r=null;for(fM={focusedElem:e,selectionRange:r},UC=!1,Vt=t;Vt!==null;)if(t=Vt,e=t.child,(t.subtreeFlags&1028)!==0&&e!==null)e.return=t,Vt=e;else for(;Vt!==null;){t=Vt;try{var v=t.alternate;if(t.flags&1024)switch(t.tag){case 0:case 11:case 15:break;case 1:if(v!==null){var p=v.memoizedProps,m=v.memoizedState,g=t.stateNode,y=g.getSnapshotBeforeUpdate(t.elementType===t.type?p:gu(t.type,p),m);g.__reactInternalSnapshotBeforeUpdate=y}break;case 3:var b=t.stateNode.containerInfo;b.nodeType===1?b.textContent="":b.nodeType===9&&b.documentElement&&b.removeChild(b.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(Tt(163))}}catch(S){xi(t,t.return,S)}if(e=t.sibling,e!==null){e.return=t.return,Vt=e;break}Vt=t.return}return v=E8,E8=!1,v}function T1(e,t,r){var n=t.updateQueue;if(n=n!==null?n.lastEffect:null,n!==null){var i=n=n.next;do{if((i.tag&e)===e){var a=i.destroy;i.destroy=void 0,a!==void 0&&TM(t,r,a)}i=i.next}while(i!==n)}}function _3(e,t){if(t=t.updateQueue,t=t!==null?t.lastEffect:null,t!==null){var r=t=t.next;do{if((r.tag&e)===e){var n=r.create;r.destroy=n()}r=r.next}while(r!==t)}}function IM(e){var t=e.ref;if(t!==null){var r=e.stateNode;switch(e.tag){case 5:e=r;break;default:e=r}typeof t=="function"?t(e):t.current=e}}function gW(e){var t=e.alternate;t!==null&&(e.alternate=null,gW(t)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(t=e.stateNode,t!==null&&(delete t[Rl],delete t[lb],delete t[vM],delete t[Tle],delete t[Ile])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function yW(e){return e.tag===5||e.tag===3||e.tag===4}function A8(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||yW(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function MM(e,t,r){var n=e.tag;if(n===5||n===6)e=e.stateNode,t?r.nodeType===8?r.parentNode.insertBefore(e,t):r.insertBefore(e,t):(r.nodeType===8?(t=r.parentNode,t.insertBefore(e,r)):(t=r,t.appendChild(e)),r=r._reactRootContainer,r!=null||t.onclick!==null||(t.onclick=VC));else if(n!==4&&(e=e.child,e!==null))for(MM(e,t,r),e=e.sibling;e!==null;)MM(e,t,r),e=e.sibling}function DM(e,t,r){var n=e.tag;if(n===5||n===6)e=e.stateNode,t?r.insertBefore(e,t):r.appendChild(e);else if(n!==4&&(e=e.child,e!==null))for(DM(e,t,r),e=e.sibling;e!==null;)DM(e,t,r),e=e.sibling}var ga=null,bu=!1;function Jd(e,t,r){for(r=r.child;r!==null;)bW(e,t,r),r=r.sibling}function bW(e,t,r){if(Ul&&typeof Ul.onCommitFiberUnmount=="function")try{Ul.onCommitFiberUnmount(v3,r)}catch{}switch(r.tag){case 5:Ua||ug(r,t);case 6:var n=ga,i=bu;ga=null,Jd(e,t,r),ga=n,bu=i,ga!==null&&(bu?(e=ga,r=r.stateNode,e.nodeType===8?e.parentNode.removeChild(r):e.removeChild(r)):ga.removeChild(r.stateNode));break;case 18:ga!==null&&(bu?(e=ga,r=r.stateNode,e.nodeType===8?x4(e.parentNode,r):e.nodeType===1&&x4(e,r),ib(e)):x4(ga,r.stateNode));break;case 4:n=ga,i=bu,ga=r.stateNode.containerInfo,bu=!0,Jd(e,t,r),ga=n,bu=i;break;case 0:case 11:case 14:case 15:if(!Ua&&(n=r.updateQueue,n!==null&&(n=n.lastEffect,n!==null))){i=n=n.next;do{var a=i,o=a.destroy;a=a.tag,o!==void 0&&(a&2||a&4)&&TM(r,t,o),i=i.next}while(i!==n)}Jd(e,t,r);break;case 1:if(!Ua&&(ug(r,t),n=r.stateNode,typeof n.componentWillUnmount=="function"))try{n.props=r.memoizedProps,n.state=r.memoizedState,n.componentWillUnmount()}catch(s){xi(r,t,s)}Jd(e,t,r);break;case 21:Jd(e,t,r);break;case 22:r.mode&1?(Ua=(n=Ua)||r.memoizedState!==null,Jd(e,t,r),Ua=n):Jd(e,t,r);break;default:Jd(e,t,r)}}function P8(e){var t=e.updateQueue;if(t!==null){e.updateQueue=null;var r=e.stateNode;r===null&&(r=e.stateNode=new qle),t.forEach(function(n){var i=tce.bind(null,e,n);r.has(n)||(r.add(n),n.then(i,i))})}}function cu(e,t){var r=t.deletions;if(r!==null)for(var n=0;n<r.length;n++){var i=r[n];try{var a=e,o=t,s=o;e:for(;s!==null;){switch(s.tag){case 5:ga=s.stateNode,bu=!1;break e;case 3:ga=s.stateNode.containerInfo,bu=!0;break e;case 4:ga=s.stateNode.containerInfo,bu=!0;break e}s=s.return}if(ga===null)throw Error(Tt(160));bW(a,o,i),ga=null,bu=!1;var u=i.alternate;u!==null&&(u.return=null),i.return=null}catch(l){xi(i,t,l)}}if(t.subtreeFlags&12854)for(t=t.child;t!==null;)xW(t,e),t=t.sibling}function xW(e,t){var r=e.alternate,n=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(cu(t,e),il(e),n&4){try{T1(3,e,e.return),_3(3,e)}catch(p){xi(e,e.return,p)}try{T1(5,e,e.return)}catch(p){xi(e,e.return,p)}}break;case 1:cu(t,e),il(e),n&512&&r!==null&&ug(r,r.return);break;case 5:if(cu(t,e),il(e),n&512&&r!==null&&ug(r,r.return),e.flags&32){var i=e.stateNode;try{eb(i,"")}catch(p){xi(e,e.return,p)}}if(n&4&&(i=e.stateNode,i!=null)){var a=e.memoizedProps,o=r!==null?r.memoizedProps:a,s=e.type,u=e.updateQueue;if(e.updateQueue=null,u!==null)try{s==="input"&&a.type==="radio"&&a.name!=null&&zq(i,a),tM(s,o);var l=tM(s,a);for(o=0;o<u.length;o+=2){var c=u[o],d=u[o+1];c==="style"?$q(i,d):c==="dangerouslySetInnerHTML"?Gq(i,d):c==="children"?eb(i,d):bk(i,c,d,l)}switch(s){case"input":KI(i,a);break;case"textarea":Vq(i,a);break;case"select":var f=i._wrapperState.wasMultiple;i._wrapperState.wasMultiple=!!a.multiple;var h=a.value;h!=null?Sg(i,!!a.multiple,h,!1):f!==!!a.multiple&&(a.defaultValue!=null?Sg(i,!!a.multiple,a.defaultValue,!0):Sg(i,!!a.multiple,a.multiple?[]:"",!1))}i[lb]=a}catch(p){xi(e,e.return,p)}}break;case 6:if(cu(t,e),il(e),n&4){if(e.stateNode===null)throw Error(Tt(162));i=e.stateNode,a=e.memoizedProps;try{i.nodeValue=a}catch(p){xi(e,e.return,p)}}break;case 3:if(cu(t,e),il(e),n&4&&r!==null&&r.memoizedState.isDehydrated)try{ib(t.containerInfo)}catch(p){xi(e,e.return,p)}break;case 4:cu(t,e),il(e);break;case 13:cu(t,e),il(e),i=e.child,i.flags&8192&&(a=i.memoizedState!==null,i.stateNode.isHidden=a,!a||i.alternate!==null&&i.alternate.memoizedState!==null||(Zk=Pi())),n&4&&P8(e);break;case 22:if(c=r!==null&&r.memoizedState!==null,e.mode&1?(Ua=(l=Ua)||c,cu(t,e),Ua=l):cu(t,e),il(e),n&8192){if(l=e.memoizedState!==null,(e.stateNode.isHidden=l)&&!c&&e.mode&1)for(Vt=e,c=e.child;c!==null;){for(d=Vt=c;Vt!==null;){switch(f=Vt,h=f.child,f.tag){case 0:case 11:case 14:case 15:T1(4,f,f.return);break;case 1:ug(f,f.return);var v=f.stateNode;if(typeof v.componentWillUnmount=="function"){n=f,r=f.return;try{t=n,v.props=t.memoizedProps,v.state=t.memoizedState,v.componentWillUnmount()}catch(p){xi(n,r,p)}}break;case 5:ug(f,f.return);break;case 22:if(f.memoizedState!==null){I8(d);continue}}h!==null?(h.return=f,Vt=h):I8(d)}c=c.sibling}e:for(c=null,d=e;;){if(d.tag===5){if(c===null){c=d;try{i=d.stateNode,l?(a=i.style,typeof a.setProperty=="function"?a.setProperty("display","none","important"):a.display="none"):(s=d.stateNode,u=d.memoizedProps.style,o=u!=null&&u.hasOwnProperty("display")?u.display:null,s.style.display=qq("display",o))}catch(p){xi(e,e.return,p)}}}else if(d.tag===6){if(c===null)try{d.stateNode.nodeValue=l?"":d.memoizedProps}catch(p){xi(e,e.return,p)}}else if((d.tag!==22&&d.tag!==23||d.memoizedState===null||d===e)&&d.child!==null){d.child.return=d,d=d.child;continue}if(d===e)break e;for(;d.sibling===null;){if(d.return===null||d.return===e)break e;c===d&&(c=null),d=d.return}c===d&&(c=null),d.sibling.return=d.return,d=d.sibling}}break;case 19:cu(t,e),il(e),n&4&&P8(e);break;case 21:break;default:cu(t,e),il(e)}}function il(e){var t=e.flags;if(t&2){try{e:{for(var r=e.return;r!==null;){if(yW(r)){var n=r;break e}r=r.return}throw Error(Tt(160))}switch(n.tag){case 5:var i=n.stateNode;n.flags&32&&(eb(i,""),n.flags&=-33);var a=A8(e);DM(e,a,i);break;case 3:case 4:var o=n.stateNode.containerInfo,s=A8(e);MM(e,s,o);break;default:throw Error(Tt(161))}}catch(u){xi(e,e.return,u)}e.flags&=-3}t&4096&&(e.flags&=-4097)}function Wle(e,t,r){Vt=e,SW(e)}function SW(e,t,r){for(var n=(e.mode&1)!==0;Vt!==null;){var i=Vt,a=i.child;if(i.tag===22&&n){var o=i.memoizedState!==null||yx;if(!o){var s=i.alternate,u=s!==null&&s.memoizedState!==null||Ua;s=yx;var l=Ua;if(yx=o,(Ua=u)&&!l)for(Vt=i;Vt!==null;)o=Vt,u=o.child,o.tag===22&&o.memoizedState!==null?M8(i):u!==null?(u.return=o,Vt=u):M8(i);for(;a!==null;)Vt=a,SW(a),a=a.sibling;Vt=i,yx=s,Ua=l}T8(e)}else i.subtreeFlags&8772&&a!==null?(a.return=i,Vt=a):T8(e)}}function T8(e){for(;Vt!==null;){var t=Vt;if(t.flags&8772){var r=t.alternate;try{if(t.flags&8772)switch(t.tag){case 0:case 11:case 15:Ua||_3(5,t);break;case 1:var n=t.stateNode;if(t.flags&4&&!Ua)if(r===null)n.componentDidMount();else{var i=t.elementType===t.type?r.memoizedProps:gu(t.type,r.memoizedProps);n.componentDidUpdate(i,r.memoizedState,n.__reactInternalSnapshotBeforeUpdate)}var a=t.updateQueue;a!==null&&d8(t,a,n);break;case 3:var o=t.updateQueue;if(o!==null){if(r=null,t.child!==null)switch(t.child.tag){case 5:r=t.child.stateNode;break;case 1:r=t.child.stateNode}d8(t,o,r)}break;case 5:var s=t.stateNode;if(r===null&&t.flags&4){r=s;var u=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":u.autoFocus&&r.focus();break;case"img":u.src&&(r.src=u.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(t.memoizedState===null){var l=t.alternate;if(l!==null){var c=l.memoizedState;if(c!==null){var d=c.dehydrated;d!==null&&ib(d)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(Tt(163))}Ua||t.flags&512&&IM(t)}catch(f){xi(t,t.return,f)}}if(t===e){Vt=null;break}if(r=t.sibling,r!==null){r.return=t.return,Vt=r;break}Vt=t.return}}function I8(e){for(;Vt!==null;){var t=Vt;if(t===e){Vt=null;break}var r=t.sibling;if(r!==null){r.return=t.return,Vt=r;break}Vt=t.return}}function M8(e){for(;Vt!==null;){var t=Vt;try{switch(t.tag){case 0:case 11:case 15:var r=t.return;try{_3(4,t)}catch(u){xi(t,r,u)}break;case 1:var n=t.stateNode;if(typeof n.componentDidMount=="function"){var i=t.return;try{n.componentDidMount()}catch(u){xi(t,i,u)}}var a=t.return;try{IM(t)}catch(u){xi(t,a,u)}break;case 5:var o=t.return;try{IM(t)}catch(u){xi(t,o,u)}}}catch(u){xi(t,t.return,u)}if(t===e){Vt=null;break}var s=t.sibling;if(s!==null){s.return=t.return,Vt=s;break}Vt=t.return}}var Xle=Math.ceil,JC=Pd.ReactCurrentDispatcher,Kk=Pd.ReactCurrentOwner,qs=Pd.ReactCurrentBatchConfig,dn=0,fa=null,Bi=null,Sa=0,Wo=0,lg=jh(0),Wi=0,vb=null,hv=0,w3=0,Qk=0,I1=null,_o=null,Zk=0,Jg=1/0,Ec=null,e_=!1,RM=null,oh=null,bx=!1,qf=null,t_=0,M1=0,kM=null,ZS=-1,JS=0;function io(){return dn&6?Pi():ZS!==-1?ZS:ZS=Pi()}function sh(e){return e.mode&1?dn&2&&Sa!==0?Sa&-Sa:Dle.transition!==null?(JS===0&&(JS=i$()),JS):(e=Tn,e!==0||(e=window.event,e=e===void 0?16:d$(e.type)),e):1}function Du(e,t,r,n){if(50<M1)throw M1=0,kM=null,Error(Tt(185));o2(e,r,n),(!(dn&2)||e!==fa)&&(e===fa&&(!(dn&2)&&(w3|=r),Wi===4&&If(e,Sa)),Io(e,n),r===1&&dn===0&&!(t.mode&1)&&(Jg=Pi()+500,x3&&zh()))}function Io(e,t){var r=e.callbackNode;Due(e,t);var n=BC(e,e===fa?Sa:0);if(n===0)r!==null&&UN(r),e.callbackNode=null,e.callbackPriority=0;else if(t=n&-n,e.callbackPriority!==t){if(r!=null&&UN(r),t===1)e.tag===0?Mle(D8.bind(null,e)):M$(D8.bind(null,e)),Ale(function(){!(dn&6)&&zh()}),r=null;else{switch(a$(n)){case 1:r=wk;break;case 4:r=r$;break;case 16:r=NC;break;case 536870912:r=n$;break;default:r=NC}r=IW(r,CW.bind(null,e))}e.callbackPriority=t,e.callbackNode=r}}function CW(e,t){if(ZS=-1,JS=0,dn&6)throw Error(Tt(327));var r=e.callbackNode;if(Ag()&&e.callbackNode!==r)return null;var n=BC(e,e===fa?Sa:0);if(n===0)return null;if(n&30||n&e.expiredLanes||t)t=r_(e,n);else{t=n;var i=dn;dn|=2;var a=wW();(fa!==e||Sa!==t)&&(Ec=null,Jg=Pi()+500,Yp(e,t));do try{Qle();break}catch(s){_W(e,s)}while(1);Nk(),JC.current=a,dn=i,Bi!==null?t=0:(fa=null,Sa=0,t=Wi)}if(t!==0){if(t===2&&(i=oM(e),i!==0&&(n=i,t=OM(e,i))),t===1)throw r=vb,Yp(e,0),If(e,n),Io(e,Pi()),r;if(t===6)If(e,n);else{if(i=e.current.alternate,!(n&30)&&!Yle(i)&&(t=r_(e,n),t===2&&(a=oM(e),a!==0&&(n=a,t=OM(e,a))),t===1))throw r=vb,Yp(e,0),If(e,n),Io(e,Pi()),r;switch(e.finishedWork=i,e.finishedLanes=n,t){case 0:case 1:throw Error(Tt(345));case 2:Sp(e,_o,Ec);break;case 3:if(If(e,n),(n&130023424)===n&&(t=Zk+500-Pi(),10<t)){if(BC(e,0)!==0)break;if(i=e.suspendedLanes,(i&n)!==n){io(),e.pingedLanes|=e.suspendedLanes&i;break}e.timeoutHandle=pM(Sp.bind(null,e,_o,Ec),t);break}Sp(e,_o,Ec);break;case 4:if(If(e,n),(n&4194240)===n)break;for(t=e.eventTimes,i=-1;0<n;){var o=31-Mu(n);a=1<<o,o=t[o],o>i&&(i=o),n&=~a}if(n=i,n=Pi()-n,n=(120>n?120:480>n?480:1080>n?1080:1920>n?1920:3e3>n?3e3:4320>n?4320:1960*Xle(n/1960))-n,10<n){e.timeoutHandle=pM(Sp.bind(null,e,_o,Ec),n);break}Sp(e,_o,Ec);break;case 5:Sp(e,_o,Ec);break;default:throw Error(Tt(329))}}}return Io(e,Pi()),e.callbackNode===r?CW.bind(null,e):null}function OM(e,t){var r=I1;return e.current.memoizedState.isDehydrated&&(Yp(e,t).flags|=256),e=r_(e,t),e!==2&&(t=_o,_o=r,t!==null&&FM(t)),e}function FM(e){_o===null?_o=e:_o.push.apply(_o,e)}function Yle(e){for(var t=e;;){if(t.flags&16384){var r=t.updateQueue;if(r!==null&&(r=r.stores,r!==null))for(var n=0;n<r.length;n++){var i=r[n],a=i.getSnapshot;i=i.value;try{if(!Vu(a(),i))return!1}catch{return!1}}}if(r=t.child,t.subtreeFlags&16384&&r!==null)r.return=t,t=r;else{if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function If(e,t){for(t&=~Qk,t&=~w3,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var r=31-Mu(t),n=1<<r;e[r]=-1,t&=~n}}function D8(e){if(dn&6)throw Error(Tt(327));Ag();var t=BC(e,0);if(!(t&1))return Io(e,Pi()),null;var r=r_(e,t);if(e.tag!==0&&r===2){var n=oM(e);n!==0&&(t=n,r=OM(e,n))}if(r===1)throw r=vb,Yp(e,0),If(e,t),Io(e,Pi()),r;if(r===6)throw Error(Tt(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,Sp(e,_o,Ec),Io(e,Pi()),null}function Jk(e,t){var r=dn;dn|=1;try{return e(t)}finally{dn=r,dn===0&&(Jg=Pi()+500,x3&&zh())}}function pv(e){qf!==null&&qf.tag===0&&!(dn&6)&&Ag();var t=dn;dn|=1;var r=qs.transition,n=Tn;try{if(qs.transition=null,Tn=1,e)return e()}finally{Tn=n,qs.transition=r,dn=t,!(dn&6)&&zh()}}function eO(){Wo=lg.current,Qn(lg)}function Yp(e,t){e.finishedWork=null,e.finishedLanes=0;var r=e.timeoutHandle;if(r!==-1&&(e.timeoutHandle=-1,Ele(r)),Bi!==null)for(r=Bi.return;r!==null;){var n=r;switch(Ok(n),n.tag){case 1:n=n.type.childContextTypes,n!=null&&HC();break;case 3:Qg(),Qn(Po),Qn(qa),Hk();break;case 5:Vk(n);break;case 4:Qg();break;case 13:Qn(di);break;case 19:Qn(di);break;case 10:Bk(n.type._context);break;case 22:case 23:eO()}r=r.return}if(fa=e,Bi=e=uh(e.current,null),Sa=Wo=t,Wi=0,vb=null,Qk=w3=hv=0,_o=I1=null,Bp!==null){for(t=0;t<Bp.length;t++)if(r=Bp[t],n=r.interleaved,n!==null){r.interleaved=null;var i=n.next,a=r.pending;if(a!==null){var o=a.next;a.next=i,n.next=o}r.pending=n}Bp=null}return e}function _W(e,t){do{var r=Bi;try{if(Nk(),YS.current=ZC,QC){for(var n=pi.memoizedState;n!==null;){var i=n.queue;i!==null&&(i.pending=null),n=n.next}QC=!1}if(fv=0,ca=qi=pi=null,P1=!1,fb=0,Kk.current=null,r===null||r.return===null){Wi=1,vb=t,Bi=null;break}e:{var a=e,o=r.return,s=r,u=t;if(t=Sa,s.flags|=32768,u!==null&&typeof u=="object"&&typeof u.then=="function"){var l=u,c=s,d=c.tag;if(!(c.mode&1)&&(d===0||d===11||d===15)){var f=c.alternate;f?(c.updateQueue=f.updateQueue,c.memoizedState=f.memoizedState,c.lanes=f.lanes):(c.updateQueue=null,c.memoizedState=null)}var h=y8(o);if(h!==null){h.flags&=-257,b8(h,o,s,a,t),h.mode&1&&g8(a,l,t),t=h,u=l;var v=t.updateQueue;if(v===null){var p=new Set;p.add(u),t.updateQueue=p}else v.add(u);break e}else{if(!(t&1)){g8(a,l,t),tO();break e}u=Error(Tt(426))}}else if(oi&&s.mode&1){var m=y8(o);if(m!==null){!(m.flags&65536)&&(m.flags|=256),b8(m,o,s,a,t),Fk(Zg(u,s));break e}}a=u=Zg(u,s),Wi!==4&&(Wi=2),I1===null?I1=[a]:I1.push(a),a=o;do{switch(a.tag){case 3:a.flags|=65536,t&=-t,a.lanes|=t;var g=oW(a,u,t);c8(a,g);break e;case 1:s=u;var y=a.type,b=a.stateNode;if(!(a.flags&128)&&(typeof y.getDerivedStateFromError=="function"||b!==null&&typeof b.componentDidCatch=="function"&&(oh===null||!oh.has(b)))){a.flags|=65536,t&=-t,a.lanes|=t;var S=sW(a,s,t);c8(a,S);break e}}a=a.return}while(a!==null)}AW(r)}catch(x){t=x,Bi===r&&r!==null&&(Bi=r=r.return);continue}break}while(1)}function wW(){var e=JC.current;return JC.current=ZC,e===null?ZC:e}function tO(){(Wi===0||Wi===3||Wi===2)&&(Wi=4),fa===null||!(hv&268435455)&&!(w3&268435455)||If(fa,Sa)}function r_(e,t){var r=dn;dn|=2;var n=wW();(fa!==e||Sa!==t)&&(Ec=null,Yp(e,t));do try{Kle();break}catch(i){_W(e,i)}while(1);if(Nk(),dn=r,JC.current=n,Bi!==null)throw Error(Tt(261));return fa=null,Sa=0,Wi}function Kle(){for(;Bi!==null;)EW(Bi)}function Qle(){for(;Bi!==null&&!Cue();)EW(Bi)}function EW(e){var t=TW(e.alternate,e,Wo);e.memoizedProps=e.pendingProps,t===null?AW(e):Bi=t,Kk.current=null}function AW(e){var t=e;do{var r=t.alternate;if(e=t.return,t.flags&32768){if(r=Gle(r,t),r!==null){r.flags&=32767,Bi=r;return}if(e!==null)e.flags|=32768,e.subtreeFlags=0,e.deletions=null;else{Wi=6,Bi=null;return}}else if(r=Hle(r,t,Wo),r!==null){Bi=r;return}if(t=t.sibling,t!==null){Bi=t;return}Bi=t=e}while(t!==null);Wi===0&&(Wi=5)}function Sp(e,t,r){var n=Tn,i=qs.transition;try{qs.transition=null,Tn=1,Zle(e,t,r,n)}finally{qs.transition=i,Tn=n}return null}function Zle(e,t,r,n){do Ag();while(qf!==null);if(dn&6)throw Error(Tt(327));r=e.finishedWork;var i=e.finishedLanes;if(r===null)return null;if(e.finishedWork=null,e.finishedLanes=0,r===e.current)throw Error(Tt(177));e.callbackNode=null,e.callbackPriority=0;var a=r.lanes|r.childLanes;if(Rue(e,a),e===fa&&(Bi=fa=null,Sa=0),!(r.subtreeFlags&2064)&&!(r.flags&2064)||bx||(bx=!0,IW(NC,function(){return Ag(),null})),a=(r.flags&15990)!==0,r.subtreeFlags&15990||a){a=qs.transition,qs.transition=null;var o=Tn;Tn=1;var s=dn;dn|=4,Kk.current=null,$le(e,r),xW(r,e),yle(fM),UC=!!dM,fM=dM=null,e.current=r,Wle(r),_ue(),dn=s,Tn=o,qs.transition=a}else e.current=r;if(bx&&(bx=!1,qf=e,t_=i),a=e.pendingLanes,a===0&&(oh=null),Aue(r.stateNode),Io(e,Pi()),t!==null)for(n=e.onRecoverableError,r=0;r<t.length;r++)i=t[r],n(i.value,{componentStack:i.stack,digest:i.digest});if(e_)throw e_=!1,e=RM,RM=null,e;return t_&1&&e.tag!==0&&Ag(),a=e.pendingLanes,a&1?e===kM?M1++:(M1=0,kM=e):M1=0,zh(),null}function Ag(){if(qf!==null){var e=a$(t_),t=qs.transition,r=Tn;try{if(qs.transition=null,Tn=16>e?16:e,qf===null)var n=!1;else{if(e=qf,qf=null,t_=0,dn&6)throw Error(Tt(331));var i=dn;for(dn|=4,Vt=e.current;Vt!==null;){var a=Vt,o=a.child;if(Vt.flags&16){var s=a.deletions;if(s!==null){for(var u=0;u<s.length;u++){var l=s[u];for(Vt=l;Vt!==null;){var c=Vt;switch(c.tag){case 0:case 11:case 15:T1(8,c,a)}var d=c.child;if(d!==null)d.return=c,Vt=d;else for(;Vt!==null;){c=Vt;var f=c.sibling,h=c.return;if(gW(c),c===l){Vt=null;break}if(f!==null){f.return=h,Vt=f;break}Vt=h}}}var v=a.alternate;if(v!==null){var p=v.child;if(p!==null){v.child=null;do{var m=p.sibling;p.sibling=null,p=m}while(p!==null)}}Vt=a}}if(a.subtreeFlags&2064&&o!==null)o.return=a,Vt=o;else e:for(;Vt!==null;){if(a=Vt,a.flags&2048)switch(a.tag){case 0:case 11:case 15:T1(9,a,a.return)}var g=a.sibling;if(g!==null){g.return=a.return,Vt=g;break e}Vt=a.return}}var y=e.current;for(Vt=y;Vt!==null;){o=Vt;var b=o.child;if(o.subtreeFlags&2064&&b!==null)b.return=o,Vt=b;else e:for(o=y;Vt!==null;){if(s=Vt,s.flags&2048)try{switch(s.tag){case 0:case 11:case 15:_3(9,s)}}catch(x){xi(s,s.return,x)}if(s===o){Vt=null;break e}var S=s.sibling;if(S!==null){S.return=s.return,Vt=S;break e}Vt=s.return}}if(dn=i,zh(),Ul&&typeof Ul.onPostCommitFiberRoot=="function")try{Ul.onPostCommitFiberRoot(v3,e)}catch{}n=!0}return n}finally{Tn=r,qs.transition=t}}return!1}function R8(e,t,r){t=Zg(r,t),t=oW(e,t,1),e=ah(e,t,1),t=io(),e!==null&&(o2(e,1,t),Io(e,t))}function xi(e,t,r){if(e.tag===3)R8(e,e,r);else for(;t!==null;){if(t.tag===3){R8(t,e,r);break}else if(t.tag===1){var n=t.stateNode;if(typeof t.type.getDerivedStateFromError=="function"||typeof n.componentDidCatch=="function"&&(oh===null||!oh.has(n))){e=Zg(r,e),e=sW(t,e,1),t=ah(t,e,1),e=io(),t!==null&&(o2(t,1,e),Io(t,e));break}}t=t.return}}function Jle(e,t,r){var n=e.pingCache;n!==null&&n.delete(t),t=io(),e.pingedLanes|=e.suspendedLanes&r,fa===e&&(Sa&r)===r&&(Wi===4||Wi===3&&(Sa&130023424)===Sa&&500>Pi()-Zk?Yp(e,0):Qk|=r),Io(e,t)}function PW(e,t){t===0&&(e.mode&1?(t=lx,lx<<=1,!(lx&130023424)&&(lx=4194304)):t=1);var r=io();e=rd(e,t),e!==null&&(o2(e,t,r),Io(e,r))}function ece(e){var t=e.memoizedState,r=0;t!==null&&(r=t.retryLane),PW(e,r)}function tce(e,t){var r=0;switch(e.tag){case 13:var n=e.stateNode,i=e.memoizedState;i!==null&&(r=i.retryLane);break;case 19:n=e.stateNode;break;default:throw Error(Tt(314))}n!==null&&n.delete(t),PW(e,r)}var TW;TW=function(e,t,r){if(e!==null)if(e.memoizedProps!==t.pendingProps||Po.current)Ao=!0;else{if(!(e.lanes&r)&&!(t.flags&128))return Ao=!1,Vle(e,t,r);Ao=!!(e.flags&131072)}else Ao=!1,oi&&t.flags&1048576&&D$(t,$C,t.index);switch(t.lanes=0,t.tag){case 2:var n=t.type;QS(e,t),e=t.pendingProps;var i=Xg(t,qa.current);Eg(t,r),i=qk(null,t,n,e,i,r);var a=$k();return t.flags|=1,typeof i=="object"&&i!==null&&typeof i.render=="function"&&i.$$typeof===void 0?(t.tag=1,t.memoizedState=null,t.updateQueue=null,To(n)?(a=!0,GC(t)):a=!1,t.memoizedState=i.state!==null&&i.state!==void 0?i.state:null,jk(t),i.updater=S3,t.stateNode=i,i._reactInternals=t,SM(t,n,e,r),t=wM(null,t,n,!0,a,r)):(t.tag=0,oi&&a&&kk(t),ro(null,t,i,r),t=t.child),t;case 16:n=t.elementType;e:{switch(QS(e,t),e=t.pendingProps,i=n._init,n=i(n._payload),t.type=n,i=t.tag=nce(n),e=gu(n,e),i){case 0:t=_M(null,t,n,e,r);break e;case 1:t=C8(null,t,n,e,r);break e;case 11:t=x8(null,t,n,e,r);break e;case 14:t=S8(null,t,n,gu(n.type,e),r);break e}throw Error(Tt(306,n,""))}return t;case 0:return n=t.type,i=t.pendingProps,i=t.elementType===n?i:gu(n,i),_M(e,t,n,i,r);case 1:return n=t.type,i=t.pendingProps,i=t.elementType===n?i:gu(n,i),C8(e,t,n,i,r);case 3:e:{if(dW(t),e===null)throw Error(Tt(387));n=t.pendingProps,a=t.memoizedState,i=a.element,F$(e,t),YC(t,n,null,r);var o=t.memoizedState;if(n=o.element,a.isDehydrated)if(a={element:n,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},t.updateQueue.baseState=a,t.memoizedState=a,t.flags&256){i=Zg(Error(Tt(423)),t),t=_8(e,t,n,r,i);break e}else if(n!==i){i=Zg(Error(Tt(424)),t),t=_8(e,t,n,r,i);break e}else for(Zo=ih(t.stateNode.containerInfo.firstChild),rs=t,oi=!0,Su=null,r=U$(t,null,n,r),t.child=r;r;)r.flags=r.flags&-3|4096,r=r.sibling;else{if(Yg(),n===i){t=nd(e,t,r);break e}ro(e,t,n,r)}t=t.child}return t;case 5:return j$(t),e===null&&yM(t),n=t.type,i=t.pendingProps,a=e!==null?e.memoizedProps:null,o=i.children,hM(n,i)?o=null:a!==null&&hM(n,a)&&(t.flags|=32),cW(e,t),ro(e,t,o,r),t.child;case 6:return e===null&&yM(t),null;case 13:return fW(e,t,r);case 4:return zk(t,t.stateNode.containerInfo),n=t.pendingProps,e===null?t.child=Kg(t,null,n,r):ro(e,t,n,r),t.child;case 11:return n=t.type,i=t.pendingProps,i=t.elementType===n?i:gu(n,i),x8(e,t,n,i,r);case 7:return ro(e,t,t.pendingProps,r),t.child;case 8:return ro(e,t,t.pendingProps.children,r),t.child;case 12:return ro(e,t,t.pendingProps.children,r),t.child;case 10:e:{if(n=t.type._context,i=t.pendingProps,a=t.memoizedProps,o=i.value,zn(WC,n._currentValue),n._currentValue=o,a!==null)if(Vu(a.value,o)){if(a.children===i.children&&!Po.current){t=nd(e,t,r);break e}}else for(a=t.child,a!==null&&(a.return=t);a!==null;){var s=a.dependencies;if(s!==null){o=a.child;for(var u=s.firstContext;u!==null;){if(u.context===n){if(a.tag===1){u=qc(-1,r&-r),u.tag=2;var l=a.updateQueue;if(l!==null){l=l.shared;var c=l.pending;c===null?u.next=u:(u.next=c.next,c.next=u),l.pending=u}}a.lanes|=r,u=a.alternate,u!==null&&(u.lanes|=r),bM(a.return,r,t),s.lanes|=r;break}u=u.next}}else if(a.tag===10)o=a.type===t.type?null:a.child;else if(a.tag===18){if(o=a.return,o===null)throw Error(Tt(341));o.lanes|=r,s=o.alternate,s!==null&&(s.lanes|=r),bM(o,r,t),o=a.sibling}else o=a.child;if(o!==null)o.return=a;else for(o=a;o!==null;){if(o===t){o=null;break}if(a=o.sibling,a!==null){a.return=o.return,o=a;break}o=o.return}a=o}ro(e,t,i.children,r),t=t.child}return t;case 9:return i=t.type,n=t.pendingProps.children,Eg(t,r),i=Xs(i),n=n(i),t.flags|=1,ro(e,t,n,r),t.child;case 14:return n=t.type,i=gu(n,t.pendingProps),i=gu(n.type,i),S8(e,t,n,i,r);case 15:return uW(e,t,t.type,t.pendingProps,r);case 17:return n=t.type,i=t.pendingProps,i=t.elementType===n?i:gu(n,i),QS(e,t),t.tag=1,To(n)?(e=!0,GC(t)):e=!1,Eg(t,r),N$(t,n,i),SM(t,n,i,r),wM(null,t,n,!0,e,r);case 19:return hW(e,t,r);case 22:return lW(e,t,r)}throw Error(Tt(156,t.tag))};function IW(e,t){return t$(e,t)}function rce(e,t,r,n){this.tag=e,this.key=r,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=n,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function zs(e,t,r,n){return new rce(e,t,r,n)}function rO(e){return e=e.prototype,!(!e||!e.isReactComponent)}function nce(e){if(typeof e=="function")return rO(e)?1:0;if(e!=null){if(e=e.$$typeof,e===Sk)return 11;if(e===Ck)return 14}return 2}function uh(e,t){var r=e.alternate;return r===null?(r=zs(e.tag,t,e.key,e.mode),r.elementType=e.elementType,r.type=e.type,r.stateNode=e.stateNode,r.alternate=e,e.alternate=r):(r.pendingProps=t,r.type=e.type,r.flags=0,r.subtreeFlags=0,r.deletions=null),r.flags=e.flags&14680064,r.childLanes=e.childLanes,r.lanes=e.lanes,r.child=e.child,r.memoizedProps=e.memoizedProps,r.memoizedState=e.memoizedState,r.updateQueue=e.updateQueue,t=e.dependencies,r.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext},r.sibling=e.sibling,r.index=e.index,r.ref=e.ref,r}function eC(e,t,r,n,i,a){var o=2;if(n=e,typeof e=="function")rO(e)&&(o=1);else if(typeof e=="string")o=5;else e:switch(e){case Jm:return Kp(r.children,i,a,t);case xk:o=8,i|=8;break;case qI:return e=zs(12,r,t,i|2),e.elementType=qI,e.lanes=a,e;case $I:return e=zs(13,r,t,i),e.elementType=$I,e.lanes=a,e;case WI:return e=zs(19,r,t,i),e.elementType=WI,e.lanes=a,e;case Bq:return E3(r,i,a,t);default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case Lq:o=10;break e;case Nq:o=9;break e;case Sk:o=11;break e;case Ck:o=14;break e;case wf:o=16,n=null;break e}throw Error(Tt(130,e==null?e:typeof e,""))}return t=zs(o,r,t,i),t.elementType=e,t.type=n,t.lanes=a,t}function Kp(e,t,r,n){return e=zs(7,e,n,t),e.lanes=r,e}function E3(e,t,r,n){return e=zs(22,e,n,t),e.elementType=Bq,e.lanes=r,e.stateNode={isHidden:!1},e}function T4(e,t,r){return e=zs(6,e,null,t),e.lanes=r,e}function I4(e,t,r){return t=zs(4,e.children!==null?e.children:[],e.key,t),t.lanes=r,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function ice(e,t,r,n,i){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=l4(0),this.expirationTimes=l4(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=l4(0),this.identifierPrefix=n,this.onRecoverableError=i,this.mutableSourceEagerHydrationData=null}function nO(e,t,r,n,i,a,o,s,u){return e=new ice(e,t,r,s,u),t===1?(t=1,a===!0&&(t|=8)):t=0,a=zs(3,null,null,t),e.current=a,a.stateNode=e,a.memoizedState={element:n,isDehydrated:r,cache:null,transitions:null,pendingSuspenseBoundaries:null},jk(a),e}function ace(e,t,r){var n=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Zm,key:n==null?null:""+n,children:e,containerInfo:t,implementation:r}}function MW(e){if(!e)return Sh;e=e._reactInternals;e:{if(qv(e)!==e||e.tag!==1)throw Error(Tt(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(To(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(t!==null);throw Error(Tt(171))}if(e.tag===1){var r=e.type;if(To(r))return I$(e,r,t)}return t}function DW(e,t,r,n,i,a,o,s,u){return e=nO(r,n,!0,e,i,a,o,s,u),e.context=MW(null),r=e.current,n=io(),i=sh(r),a=qc(n,i),a.callback=t??null,ah(r,a,i),e.current.lanes=i,o2(e,i,n),Io(e,n),e}function A3(e,t,r,n){var i=t.current,a=io(),o=sh(i);return r=MW(r),t.context===null?t.context=r:t.pendingContext=r,t=qc(a,o),t.payload={element:e},n=n===void 0?null:n,n!==null&&(t.callback=n),e=ah(i,t,o),e!==null&&(Du(e,i,o,a),XS(e,i,o)),o}function n_(e){if(e=e.current,!e.child)return null;switch(e.child.tag){case 5:return e.child.stateNode;default:return e.child.stateNode}}function k8(e,t){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var r=e.retryLane;e.retryLane=r!==0&&r<t?r:t}}function iO(e,t){k8(e,t),(e=e.alternate)&&k8(e,t)}function oce(){return null}var RW=typeof reportError=="function"?reportError:function(e){console.error(e)};function aO(e){this._internalRoot=e}P3.prototype.render=aO.prototype.render=function(e){var t=this._internalRoot;if(t===null)throw Error(Tt(409));A3(e,t,null,null)};P3.prototype.unmount=aO.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var t=e.containerInfo;pv(function(){A3(null,e,null,null)}),t[td]=null}};function P3(e){this._internalRoot=e}P3.prototype.unstable_scheduleHydration=function(e){if(e){var t=u$();e={blockedOn:null,target:e,priority:t};for(var r=0;r<Tf.length&&t!==0&&t<Tf[r].priority;r++);Tf.splice(r,0,e),r===0&&c$(e)}};function oO(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function T3(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11&&(e.nodeType!==8||e.nodeValue!==" react-mount-point-unstable "))}function O8(){}function sce(e,t,r,n,i){if(i){if(typeof n=="function"){var a=n;n=function(){var l=n_(o);a.call(l)}}var o=DW(t,n,e,0,null,!1,!1,"",O8);return e._reactRootContainer=o,e[td]=o.current,sb(e.nodeType===8?e.parentNode:e),pv(),o}for(;i=e.lastChild;)e.removeChild(i);if(typeof n=="function"){var s=n;n=function(){var l=n_(u);s.call(l)}}var u=nO(e,0,!1,null,null,!1,!1,"",O8);return e._reactRootContainer=u,e[td]=u.current,sb(e.nodeType===8?e.parentNode:e),pv(function(){A3(t,u,r,n)}),u}function I3(e,t,r,n,i){var a=r._reactRootContainer;if(a){var o=a;if(typeof i=="function"){var s=i;i=function(){var u=n_(o);s.call(u)}}A3(t,o,e,i)}else o=sce(r,t,e,i,n);return n_(o)}o$=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var r=Jy(t.pendingLanes);r!==0&&(Ek(t,r|1),Io(t,Pi()),!(dn&6)&&(Jg=Pi()+500,zh()))}break;case 13:pv(function(){var n=rd(e,1);if(n!==null){var i=io();Du(n,e,1,i)}}),iO(e,1)}};Ak=function(e){if(e.tag===13){var t=rd(e,134217728);if(t!==null){var r=io();Du(t,e,134217728,r)}iO(e,134217728)}};s$=function(e){if(e.tag===13){var t=sh(e),r=rd(e,t);if(r!==null){var n=io();Du(r,e,t,n)}iO(e,t)}};u$=function(){return Tn};l$=function(e,t){var r=Tn;try{return Tn=e,t()}finally{Tn=r}};nM=function(e,t,r){switch(t){case"input":if(KI(e,r),t=r.name,r.type==="radio"&&t!=null){for(r=e;r.parentNode;)r=r.parentNode;for(r=r.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<r.length;t++){var n=r[t];if(n!==e&&n.form===e.form){var i=b3(n);if(!i)throw Error(Tt(90));jq(n),KI(n,i)}}}break;case"textarea":Vq(e,r);break;case"select":t=r.value,t!=null&&Sg(e,!!r.multiple,t,!1)}};Yq=Jk;Kq=pv;var uce={usingClientEntryPoint:!1,Events:[u2,ng,b3,Wq,Xq,Jk]},vy={findFiberByHostInstance:Np,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},lce={bundleType:vy.bundleType,version:vy.version,rendererPackageName:vy.rendererPackageName,rendererConfig:vy.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Pd.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return e=Jq(e),e===null?null:e.stateNode},findFiberByHostInstance:vy.findFiberByHostInstance||oce,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var xx=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!xx.isDisabled&&xx.supportsFiber)try{v3=xx.inject(lce),Ul=xx}catch{}}ms.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=uce;ms.createPortal=function(e,t){var r=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!oO(t))throw Error(Tt(200));return ace(e,t,null,r)};ms.createRoot=function(e,t){if(!oO(e))throw Error(Tt(299));var r=!1,n="",i=RW;return t!=null&&(t.unstable_strictMode===!0&&(r=!0),t.identifierPrefix!==void 0&&(n=t.identifierPrefix),t.onRecoverableError!==void 0&&(i=t.onRecoverableError)),t=nO(e,1,!1,null,null,r,!1,n,i),e[td]=t.current,sb(e.nodeType===8?e.parentNode:e),new aO(t)};ms.findDOMNode=function(e){if(e==null)return null;if(e.nodeType===1)return e;var t=e._reactInternals;if(t===void 0)throw typeof e.render=="function"?Error(Tt(188)):(e=Object.keys(e).join(","),Error(Tt(268,e)));return e=Jq(t),e=e===null?null:e.stateNode,e};ms.flushSync=function(e){return pv(e)};ms.hydrate=function(e,t,r){if(!T3(t))throw Error(Tt(200));return I3(null,e,t,!0,r)};ms.hydrateRoot=function(e,t,r){if(!oO(e))throw Error(Tt(405));var n=r!=null&&r.hydratedSources||null,i=!1,a="",o=RW;if(r!=null&&(r.unstable_strictMode===!0&&(i=!0),r.identifierPrefix!==void 0&&(a=r.identifierPrefix),r.onRecoverableError!==void 0&&(o=r.onRecoverableError)),t=DW(t,null,e,1,r??null,i,!1,a,o),e[td]=t.current,sb(e),n)for(e=0;e<n.length;e++)r=n[e],i=r._getVersion,i=i(r._source),t.mutableSourceEagerHydrationData==null?t.mutableSourceEagerHydrationData=[r,i]:t.mutableSourceEagerHydrationData.push(r,i);return new P3(t)};ms.render=function(e,t,r){if(!T3(t))throw Error(Tt(200));return I3(null,e,t,!1,r)};ms.unmountComponentAtNode=function(e){if(!T3(e))throw Error(Tt(40));return e._reactRootContainer?(pv(function(){I3(null,null,e,!1,function(){e._reactRootContainer=null,e[td]=null})}),!0):!1};ms.unstable_batchedUpdates=Jk;ms.unstable_renderSubtreeIntoContainer=function(e,t,r,n){if(!T3(r))throw Error(Tt(200));if(e==null||e._reactInternals===void 0)throw Error(Tt(38));return I3(e,t,r,!1,n)};ms.version="18.2.0-next-9e3b772b8-20220608";function kW(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(kW)}catch(e){console.error(e)}}kW(),Dq.exports=ms;var M3=Dq.exports,F8=M3;HI.createRoot=F8.createRoot,HI.hydrateRoot=F8.hydrateRoot;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const OW=function(e){const t=[];let r=0;for(let n=0;n<e.length;n++){let i=e.charCodeAt(n);i<128?t[r++]=i:i<2048?(t[r++]=i>>6|192,t[r++]=i&63|128):(i&64512)===55296&&n+1<e.length&&(e.charCodeAt(n+1)&64512)===56320?(i=65536+((i&1023)<<10)+(e.charCodeAt(++n)&1023),t[r++]=i>>18|240,t[r++]=i>>12&63|128,t[r++]=i>>6&63|128,t[r++]=i&63|128):(t[r++]=i>>12|224,t[r++]=i>>6&63|128,t[r++]=i&63|128)}return t},cce=function(e){const t=[];let r=0,n=0;for(;r<e.length;){const i=e[r++];if(i<128)t[n++]=String.fromCharCode(i);else if(i>191&&i<224){const a=e[r++];t[n++]=String.fromCharCode((i&31)<<6|a&63)}else if(i>239&&i<365){const a=e[r++],o=e[r++],s=e[r++],u=((i&7)<<18|(a&63)<<12|(o&63)<<6|s&63)-65536;t[n++]=String.fromCharCode(55296+(u>>10)),t[n++]=String.fromCharCode(56320+(u&1023))}else{const a=e[r++],o=e[r++];t[n++]=String.fromCharCode((i&15)<<12|(a&63)<<6|o&63)}}return t.join("")},FW={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();const r=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,n=[];for(let i=0;i<e.length;i+=3){const a=e[i],o=i+1<e.length,s=o?e[i+1]:0,u=i+2<e.length,l=u?e[i+2]:0,c=a>>2,d=(a&3)<<4|s>>4;let f=(s&15)<<2|l>>6,h=l&63;u||(h=64,o||(f=64)),n.push(r[c],r[d],r[f],r[h])}return n.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(OW(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):cce(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();const r=t?this.charToByteMapWebSafe_:this.charToByteMap_,n=[];for(let i=0;i<e.length;){const a=r[e.charAt(i++)],s=i<e.length?r[e.charAt(i)]:0;++i;const l=i<e.length?r[e.charAt(i)]:64;++i;const d=i<e.length?r[e.charAt(i)]:64;if(++i,a==null||s==null||l==null||d==null)throw new dce;const f=a<<2|s>>4;if(n.push(f),l!==64){const h=s<<4&240|l>>2;if(n.push(h),d!==64){const v=l<<6&192|d;n.push(v)}}}return n},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class dce extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const fce=function(e){const t=OW(e);return FW.encodeByteArray(t,!0)},LW=function(e){return fce(e).replace(/\./g,"")},NW=function(e){try{return FW.decodeString(e,!0)}catch(t){console.error("base64Decode failed: ",t)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hce(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pce=()=>hce().__FIREBASE_DEFAULTS__,vce=()=>{if(typeof process>"u"||typeof process.env>"u")return;const e={}.__FIREBASE_DEFAULTS__;if(e)return JSON.parse(e)},mce=()=>{if(typeof document>"u")return;let e;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const t=e&&NW(e[1]);return t&&JSON.parse(t)},sO=()=>{try{return pce()||vce()||mce()}catch(e){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`);return}},gce=e=>{var t,r;return(r=(t=sO())===null||t===void 0?void 0:t.emulatorHosts)===null||r===void 0?void 0:r[e]},BW=()=>{var e;return(e=sO())===null||e===void 0?void 0:e.config},UW=e=>{var t;return(t=sO())===null||t===void 0?void 0:t[`_${e}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yce{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((t,r)=>{this.resolve=t,this.reject=r})}wrapCallback(t){return(r,n)=>{r?this.reject(r):this.resolve(n),typeof t=="function"&&(this.promise.catch(()=>{}),t.length===1?t(r):t(r,n))}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $a(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function bce(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test($a())}function xce(){const e=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof e=="object"&&e.id!==void 0}function Sce(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function Cce(){const e=$a();return e.indexOf("MSIE ")>=0||e.indexOf("Trident/")>=0}function _ce(){try{return typeof indexedDB=="object"}catch{return!1}}function wce(){return new Promise((e,t)=>{try{let r=!0;const n="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(n);i.onsuccess=()=>{i.result.close(),r||self.indexedDB.deleteDatabase(n),e(!0)},i.onupgradeneeded=()=>{r=!1},i.onerror=()=>{var a;t(((a=i.error)===null||a===void 0?void 0:a.message)||"")}}catch(r){t(r)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ece="FirebaseError";class Vh extends Error{constructor(t,r,n){super(r),this.code=t,this.customData=n,this.name=Ece,Object.setPrototypeOf(this,Vh.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,c2.prototype.create)}}class c2{constructor(t,r,n){this.service=t,this.serviceName=r,this.errors=n}create(t,...r){const n=r[0]||{},i=`${this.service}/${t}`,a=this.errors[t],o=a?Ace(a,n):"Error",s=`${this.serviceName}: ${o} (${i}).`;return new Vh(i,s,n)}}function Ace(e,t){return e.replace(Pce,(r,n)=>{const i=t[n];return i!=null?String(i):`<${n}?>`})}const Pce=/\{\$([^}]+)}/g;function Tce(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}function i_(e,t){if(e===t)return!0;const r=Object.keys(e),n=Object.keys(t);for(const i of r){if(!n.includes(i))return!1;const a=e[i],o=t[i];if(L8(a)&&L8(o)){if(!i_(a,o))return!1}else if(a!==o)return!1}for(const i of n)if(!r.includes(i))return!1;return!0}function L8(e){return e!==null&&typeof e=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function d2(e){const t=[];for(const[r,n]of Object.entries(e))Array.isArray(n)?n.forEach(i=>{t.push(encodeURIComponent(r)+"="+encodeURIComponent(i))}):t.push(encodeURIComponent(r)+"="+encodeURIComponent(n));return t.length?"&"+t.join("&"):""}function t1(e){const t={};return e.replace(/^\?/,"").split("&").forEach(n=>{if(n){const[i,a]=n.split("=");t[decodeURIComponent(i)]=decodeURIComponent(a)}}),t}function r1(e){const t=e.indexOf("?");if(!t)return"";const r=e.indexOf("#",t);return e.substring(t,r>0?r:void 0)}function Ice(e,t){const r=new Mce(e,t);return r.subscribe.bind(r)}class Mce{constructor(t,r){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=r,this.task.then(()=>{t(this)}).catch(n=>{this.error(n)})}next(t){this.forEachObserver(r=>{r.next(t)})}error(t){this.forEachObserver(r=>{r.error(t)}),this.close(t)}complete(){this.forEachObserver(t=>{t.complete()}),this.close()}subscribe(t,r,n){let i;if(t===void 0&&r===void 0&&n===void 0)throw new Error("Missing Observer.");Dce(t,["next","error","complete"])?i=t:i={next:t,error:r,complete:n},i.next===void 0&&(i.next=M4),i.error===void 0&&(i.error=M4),i.complete===void 0&&(i.complete=M4);const a=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?i.error(this.finalError):i.complete()}catch{}}),this.observers.push(i),a}unsubscribeOne(t){this.observers===void 0||this.observers[t]===void 0||(delete this.observers[t],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(t){if(!this.finalized)for(let r=0;r<this.observers.length;r++)this.sendOne(r,t)}sendOne(t,r){this.task.then(()=>{if(this.observers!==void 0&&this.observers[t]!==void 0)try{r(this.observers[t])}catch(n){typeof console<"u"&&console.error&&console.error(n)}})}close(t){this.finalized||(this.finalized=!0,t!==void 0&&(this.finalError=t),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function Dce(e,t){if(typeof e!="object"||e===null)return!1;for(const r of t)if(r in e&&typeof e[r]=="function")return!0;return!1}function M4(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Td(e){return e&&e._delegate?e._delegate:e}class e0{constructor(t,r,n){this.name=t,this.instanceFactory=r,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(t){return this.instantiationMode=t,this}setMultipleInstances(t){return this.multipleInstances=t,this}setServiceProps(t){return this.serviceProps=t,this}setInstanceCreatedCallback(t){return this.onInstanceCreated=t,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Cp="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Rce=class{constructor(t,r){this.name=t,this.container=r,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(t){const r=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(r)){const n=new yce;if(this.instancesDeferred.set(r,n),this.isInitialized(r)||this.shouldAutoInitialize())try{const i=this.getOrInitializeService({instanceIdentifier:r});i&&n.resolve(i)}catch{}}return this.instancesDeferred.get(r).promise}getImmediate(t){var r;const n=this.normalizeInstanceIdentifier(t==null?void 0:t.identifier),i=(r=t==null?void 0:t.optional)!==null&&r!==void 0?r:!1;if(this.isInitialized(n)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:n})}catch(a){if(i)return null;throw a}else{if(i)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(t){if(t.name!==this.name)throw Error(`Mismatching Component ${t.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=t,!!this.shouldAutoInitialize()){if(Oce(t))try{this.getOrInitializeService({instanceIdentifier:Cp})}catch{}for(const[r,n]of this.instancesDeferred.entries()){const i=this.normalizeInstanceIdentifier(r);try{const a=this.getOrInitializeService({instanceIdentifier:i});n.resolve(a)}catch{}}}}clearInstance(t=Cp){this.instancesDeferred.delete(t),this.instancesOptions.delete(t),this.instances.delete(t)}async delete(){const t=Array.from(this.instances.values());await Promise.all([...t.filter(r=>"INTERNAL"in r).map(r=>r.INTERNAL.delete()),...t.filter(r=>"_delete"in r).map(r=>r._delete())])}isComponentSet(){return this.component!=null}isInitialized(t=Cp){return this.instances.has(t)}getOptions(t=Cp){return this.instancesOptions.get(t)||{}}initialize(t={}){const{options:r={}}=t,n=this.normalizeInstanceIdentifier(t.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const i=this.getOrInitializeService({instanceIdentifier:n,options:r});for(const[a,o]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(a);n===s&&o.resolve(i)}return i}onInit(t,r){var n;const i=this.normalizeInstanceIdentifier(r),a=(n=this.onInitCallbacks.get(i))!==null&&n!==void 0?n:new Set;a.add(t),this.onInitCallbacks.set(i,a);const o=this.instances.get(i);return o&&t(o,i),()=>{a.delete(t)}}invokeOnInitCallbacks(t,r){const n=this.onInitCallbacks.get(r);if(n)for(const i of n)try{i(t,r)}catch{}}getOrInitializeService({instanceIdentifier:t,options:r={}}){let n=this.instances.get(t);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:kce(t),options:r}),this.instances.set(t,n),this.instancesOptions.set(t,r),this.invokeOnInitCallbacks(n,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,n)}catch{}return n||null}normalizeInstanceIdentifier(t=Cp){return this.component?this.component.multipleInstances?t:Cp:t}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}};function kce(e){return e===Cp?void 0:e}function Oce(e){return e.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fce{constructor(t){this.name=t,this.providers=new Map}addComponent(t){const r=this.getProvider(t.name);if(r.isComponentSet())throw new Error(`Component ${t.name} has already been registered with ${this.name}`);r.setComponent(t)}addOrOverwriteComponent(t){this.getProvider(t.name).isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)}getProvider(t){if(this.providers.has(t))return this.providers.get(t);const r=new Rce(t,this);return this.providers.set(t,r),r}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Fn;(function(e){e[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"})(Fn||(Fn={}));const Lce={debug:Fn.DEBUG,verbose:Fn.VERBOSE,info:Fn.INFO,warn:Fn.WARN,error:Fn.ERROR,silent:Fn.SILENT},Nce=Fn.INFO,Bce={[Fn.DEBUG]:"log",[Fn.VERBOSE]:"log",[Fn.INFO]:"info",[Fn.WARN]:"warn",[Fn.ERROR]:"error"},Uce=(e,t,...r)=>{if(t<e.logLevel)return;const n=new Date().toISOString(),i=Bce[t];if(i)console[i](`[${n}]  ${e.name}:`,...r);else throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`)};class jW{constructor(t){this.name=t,this._logLevel=Nce,this._logHandler=Uce,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(t){if(!(t in Fn))throw new TypeError(`Invalid value "${t}" assigned to \`logLevel\``);this._logLevel=t}setLogLevel(t){this._logLevel=typeof t=="string"?Lce[t]:t}get logHandler(){return this._logHandler}set logHandler(t){if(typeof t!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t}get userLogHandler(){return this._userLogHandler}set userLogHandler(t){this._userLogHandler=t}debug(...t){this._userLogHandler&&this._userLogHandler(this,Fn.DEBUG,...t),this._logHandler(this,Fn.DEBUG,...t)}log(...t){this._userLogHandler&&this._userLogHandler(this,Fn.VERBOSE,...t),this._logHandler(this,Fn.VERBOSE,...t)}info(...t){this._userLogHandler&&this._userLogHandler(this,Fn.INFO,...t),this._logHandler(this,Fn.INFO,...t)}warn(...t){this._userLogHandler&&this._userLogHandler(this,Fn.WARN,...t),this._logHandler(this,Fn.WARN,...t)}error(...t){this._userLogHandler&&this._userLogHandler(this,Fn.ERROR,...t),this._logHandler(this,Fn.ERROR,...t)}}const jce=(e,t)=>t.some(r=>e instanceof r);let N8,B8;function zce(){return N8||(N8=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Vce(){return B8||(B8=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const zW=new WeakMap,LM=new WeakMap,VW=new WeakMap,D4=new WeakMap,uO=new WeakMap;function Hce(e){const t=new Promise((r,n)=>{const i=()=>{e.removeEventListener("success",a),e.removeEventListener("error",o)},a=()=>{r(lh(e.result)),i()},o=()=>{n(e.error),i()};e.addEventListener("success",a),e.addEventListener("error",o)});return t.then(r=>{r instanceof IDBCursor&&zW.set(r,e)}).catch(()=>{}),uO.set(t,e),t}function Gce(e){if(LM.has(e))return;const t=new Promise((r,n)=>{const i=()=>{e.removeEventListener("complete",a),e.removeEventListener("error",o),e.removeEventListener("abort",o)},a=()=>{r(),i()},o=()=>{n(e.error||new DOMException("AbortError","AbortError")),i()};e.addEventListener("complete",a),e.addEventListener("error",o),e.addEventListener("abort",o)});LM.set(e,t)}let NM={get(e,t,r){if(e instanceof IDBTransaction){if(t==="done")return LM.get(e);if(t==="objectStoreNames")return e.objectStoreNames||VW.get(e);if(t==="store")return r.objectStoreNames[1]?void 0:r.objectStore(r.objectStoreNames[0])}return lh(e[t])},set(e,t,r){return e[t]=r,!0},has(e,t){return e instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in e}};function qce(e){NM=e(NM)}function $ce(e){return e===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(t,...r){const n=e.call(R4(this),t,...r);return VW.set(n,t.sort?t.sort():[t]),lh(n)}:Vce().includes(e)?function(...t){return e.apply(R4(this),t),lh(zW.get(this))}:function(...t){return lh(e.apply(R4(this),t))}}function Wce(e){return typeof e=="function"?$ce(e):(e instanceof IDBTransaction&&Gce(e),jce(e,zce())?new Proxy(e,NM):e)}function lh(e){if(e instanceof IDBRequest)return Hce(e);if(D4.has(e))return D4.get(e);const t=Wce(e);return t!==e&&(D4.set(e,t),uO.set(t,e)),t}const R4=e=>uO.get(e);function Xce(e,t,{blocked:r,upgrade:n,blocking:i,terminated:a}={}){const o=indexedDB.open(e,t),s=lh(o);return n&&o.addEventListener("upgradeneeded",u=>{n(lh(o.result),u.oldVersion,u.newVersion,lh(o.transaction),u)}),r&&o.addEventListener("blocked",u=>r(u.oldVersion,u.newVersion,u)),s.then(u=>{a&&u.addEventListener("close",()=>a()),i&&u.addEventListener("versionchange",l=>i(l.oldVersion,l.newVersion,l))}).catch(()=>{}),s}const Yce=["get","getKey","getAll","getAllKeys","count"],Kce=["put","add","delete","clear"],k4=new Map;function U8(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&typeof t=="string"))return;if(k4.get(t))return k4.get(t);const r=t.replace(/FromIndex$/,""),n=t!==r,i=Kce.includes(r);if(!(r in(n?IDBIndex:IDBObjectStore).prototype)||!(i||Yce.includes(r)))return;const a=async function(o,...s){const u=this.transaction(o,i?"readwrite":"readonly");let l=u.store;return n&&(l=l.index(s.shift())),(await Promise.all([l[r](...s),i&&u.done]))[0]};return k4.set(t,a),a}qce(e=>({...e,get:(t,r,n)=>U8(t,r)||e.get(t,r,n),has:(t,r)=>!!U8(t,r)||e.has(t,r)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qce{constructor(t){this.container=t}getPlatformInfoString(){return this.container.getProviders().map(r=>{if(Zce(r)){const n=r.getImmediate();return`${n.library}/${n.version}`}else return null}).filter(r=>r).join(" ")}}function Zce(e){const t=e.getComponent();return(t==null?void 0:t.type)==="VERSION"}const BM="@firebase/app",j8="0.9.10";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vv=new jW("@firebase/app"),Jce="@firebase/app-compat",ede="@firebase/analytics-compat",tde="@firebase/analytics",rde="@firebase/app-check-compat",nde="@firebase/app-check",ide="@firebase/auth",ade="@firebase/auth-compat",ode="@firebase/database",sde="@firebase/database-compat",ude="@firebase/functions",lde="@firebase/functions-compat",cde="@firebase/installations",dde="@firebase/installations-compat",fde="@firebase/messaging",hde="@firebase/messaging-compat",pde="@firebase/performance",vde="@firebase/performance-compat",mde="@firebase/remote-config",gde="@firebase/remote-config-compat",yde="@firebase/storage",bde="@firebase/storage-compat",xde="@firebase/firestore",Sde="@firebase/firestore-compat",Cde="firebase",_de="9.22.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const UM="[DEFAULT]",wde={[BM]:"fire-core",[Jce]:"fire-core-compat",[tde]:"fire-analytics",[ede]:"fire-analytics-compat",[nde]:"fire-app-check",[rde]:"fire-app-check-compat",[ide]:"fire-auth",[ade]:"fire-auth-compat",[ode]:"fire-rtdb",[sde]:"fire-rtdb-compat",[ude]:"fire-fn",[lde]:"fire-fn-compat",[cde]:"fire-iid",[dde]:"fire-iid-compat",[fde]:"fire-fcm",[hde]:"fire-fcm-compat",[pde]:"fire-perf",[vde]:"fire-perf-compat",[mde]:"fire-rc",[gde]:"fire-rc-compat",[yde]:"fire-gcs",[bde]:"fire-gcs-compat",[xde]:"fire-fst",[Sde]:"fire-fst-compat","fire-js":"fire-js",[Cde]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const a_=new Map,jM=new Map;function Ede(e,t){try{e.container.addComponent(t)}catch(r){vv.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,r)}}function mb(e){const t=e.name;if(jM.has(t))return vv.debug(`There were multiple attempts to register component ${t}.`),!1;jM.set(t,e);for(const r of a_.values())Ede(r,e);return!0}function HW(e,t){const r=e.container.getProvider("heartbeat").getImmediate({optional:!0});return r&&r.triggerHeartbeat(),e.container.getProvider(t)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ade={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}."},ch=new c2("app","Firebase",Ade);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pde{constructor(t,r,n){this._isDeleted=!1,this._options=Object.assign({},t),this._config=Object.assign({},r),this._name=r.name,this._automaticDataCollectionEnabled=r.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new e0("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(t){this.checkDestroyed(),this._automaticDataCollectionEnabled=t}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(t){this._isDeleted=t}checkDestroyed(){if(this.isDeleted)throw ch.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const f2=_de;function GW(e,t={}){let r=e;typeof t!="object"&&(t={name:t});const n=Object.assign({name:UM,automaticDataCollectionEnabled:!1},t),i=n.name;if(typeof i!="string"||!i)throw ch.create("bad-app-name",{appName:String(i)});if(r||(r=BW()),!r)throw ch.create("no-options");const a=a_.get(i);if(a){if(i_(r,a.options)&&i_(n,a.config))return a;throw ch.create("duplicate-app",{appName:i})}const o=new Fce(i);for(const u of jM.values())o.addComponent(u);const s=new Pde(r,n,o);return a_.set(i,s),s}function Tde(e=UM){const t=a_.get(e);if(!t&&e===UM&&BW())return GW();if(!t)throw ch.create("no-app",{appName:e});return t}function Pg(e,t,r){var n;let i=(n=wde[e])!==null&&n!==void 0?n:e;r&&(i+=`-${r}`);const a=i.match(/\s|\//),o=t.match(/\s|\//);if(a||o){const s=[`Unable to register library "${i}" with version "${t}":`];a&&s.push(`library name "${i}" contains illegal characters (whitespace or "/")`),a&&o&&s.push("and"),o&&s.push(`version name "${t}" contains illegal characters (whitespace or "/")`),vv.warn(s.join(" "));return}mb(new e0(`${i}-version`,()=>({library:i,version:t}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ide="firebase-heartbeat-database",Mde=1,gb="firebase-heartbeat-store";let O4=null;function qW(){return O4||(O4=Xce(Ide,Mde,{upgrade:(e,t)=>{switch(t){case 0:e.createObjectStore(gb)}}}).catch(e=>{throw ch.create("idb-open",{originalErrorMessage:e.message})})),O4}async function Dde(e){try{return await(await qW()).transaction(gb).objectStore(gb).get($W(e))}catch(t){if(t instanceof Vh)vv.warn(t.message);else{const r=ch.create("idb-get",{originalErrorMessage:t==null?void 0:t.message});vv.warn(r.message)}}}async function z8(e,t){try{const n=(await qW()).transaction(gb,"readwrite");await n.objectStore(gb).put(t,$W(e)),await n.done}catch(r){if(r instanceof Vh)vv.warn(r.message);else{const n=ch.create("idb-set",{originalErrorMessage:r==null?void 0:r.message});vv.warn(n.message)}}}function $W(e){return`${e.name}!${e.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Rde=1024,kde=30*24*60*60*1e3;class Ode{constructor(t){this.container=t,this._heartbeatsCache=null;const r=this.container.getProvider("app").getImmediate();this._storage=new Lde(r),this._heartbeatsCachePromise=this._storage.read().then(n=>(this._heartbeatsCache=n,n))}async triggerHeartbeat(){const r=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),n=V8();if(this._heartbeatsCache===null&&(this._heartbeatsCache=await this._heartbeatsCachePromise),!(this._heartbeatsCache.lastSentHeartbeatDate===n||this._heartbeatsCache.heartbeats.some(i=>i.date===n)))return this._heartbeatsCache.heartbeats.push({date:n,agent:r}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(i=>{const a=new Date(i.date).valueOf();return Date.now()-a<=kde}),this._storage.overwrite(this._heartbeatsCache)}async getHeartbeatsHeader(){if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,this._heartbeatsCache===null||this._heartbeatsCache.heartbeats.length===0)return"";const t=V8(),{heartbeatsToSend:r,unsentEntries:n}=Fde(this._heartbeatsCache.heartbeats),i=LW(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=t,n.length>0?(this._heartbeatsCache.heartbeats=n,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}}function V8(){return new Date().toISOString().substring(0,10)}function Fde(e,t=Rde){const r=[];let n=e.slice();for(const i of e){const a=r.find(o=>o.agent===i.agent);if(a){if(a.dates.push(i.date),H8(r)>t){a.dates.pop();break}}else if(r.push({agent:i.agent,dates:[i.date]}),H8(r)>t){r.pop();break}n=n.slice(1)}return{heartbeatsToSend:r,unsentEntries:n}}class Lde{constructor(t){this.app=t,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return _ce()?wce().then(()=>!0).catch(()=>!1):!1}async read(){return await this._canUseIndexedDBPromise?await Dde(this.app)||{heartbeats:[]}:{heartbeats:[]}}async overwrite(t){var r;if(await this._canUseIndexedDBPromise){const i=await this.read();return z8(this.app,{lastSentHeartbeatDate:(r=t.lastSentHeartbeatDate)!==null&&r!==void 0?r:i.lastSentHeartbeatDate,heartbeats:t.heartbeats})}else return}async add(t){var r;if(await this._canUseIndexedDBPromise){const i=await this.read();return z8(this.app,{lastSentHeartbeatDate:(r=t.lastSentHeartbeatDate)!==null&&r!==void 0?r:i.lastSentHeartbeatDate,heartbeats:[...i.heartbeats,...t.heartbeats]})}else return}}function H8(e){return LW(JSON.stringify({version:2,heartbeats:e})).length}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Nde(e){mb(new e0("platform-logger",t=>new Qce(t),"PRIVATE")),mb(new e0("heartbeat",t=>new Ode(t),"PRIVATE")),Pg(BM,j8,e),Pg(BM,j8,"esm2017"),Pg("fire-js","")}Nde("");var Bde="firebase",Ude="9.22.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Pg(Bde,Ude,"app");function lO(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]]);return r}function WW(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const jde=WW,XW=new c2("auth","Firebase",WW());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const o_=new jW("@firebase/auth");function zde(e,...t){o_.logLevel<=Fn.WARN&&o_.warn(`Auth (${f2}): ${e}`,...t)}function tC(e,...t){o_.logLevel<=Fn.ERROR&&o_.error(`Auth (${f2}): ${e}`,...t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Hu(e,...t){throw cO(e,...t)}function zl(e,...t){return cO(e,...t)}function Vde(e,t,r){const n=Object.assign(Object.assign({},jde()),{[t]:r});return new c2("auth","Firebase",n).create(t,{appName:e.name})}function cO(e,...t){if(typeof e!="string"){const r=t[0],n=[...t.slice(1)];return n[0]&&(n[0].appName=e.name),e._errorFactory.create(r,...n)}return XW.create(e,...t)}function _r(e,t,...r){if(!e)throw cO(t,...r)}function Nc(e){const t="INTERNAL ASSERTION FAILED: "+e;throw tC(t),new Error(t)}function id(e,t){e||Nc(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zM(){var e;return typeof self<"u"&&((e=self.location)===null||e===void 0?void 0:e.href)||""}function Hde(){return G8()==="http:"||G8()==="https:"}function G8(){var e;return typeof self<"u"&&((e=self.location)===null||e===void 0?void 0:e.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Gde(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(Hde()||xce()||"connection"in navigator)?navigator.onLine:!0}function qde(){if(typeof navigator>"u")return null;const e=navigator;return e.languages&&e.languages[0]||e.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class h2{constructor(t,r){this.shortDelay=t,this.longDelay=r,id(r>t,"Short delay should be less than long delay!"),this.isMobile=bce()||Sce()}get(){return Gde()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dO(e,t){id(e.emulator,"Emulator should always be set here");const{url:r}=e.emulator;return t?`${r}${t.startsWith("/")?t.slice(1):t}`:r}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class YW{static initialize(t,r,n){this.fetchImpl=t,r&&(this.headersImpl=r),n&&(this.responseImpl=n)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;Nc("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;Nc("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;Nc("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $de={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Wde=new h2(3e4,6e4);function A0(e,t){return e.tenantId&&!t.tenantId?Object.assign(Object.assign({},t),{tenantId:e.tenantId}):t}async function P0(e,t,r,n,i={}){return KW(e,i,async()=>{let a={},o={};n&&(t==="GET"?o=n:a={body:JSON.stringify(n)});const s=d2(Object.assign({key:e.config.apiKey},o)).slice(1),u=await e._getAdditionalHeaders();return u["Content-Type"]="application/json",e.languageCode&&(u["X-Firebase-Locale"]=e.languageCode),YW.fetch()(QW(e,e.config.apiHost,r,s),Object.assign({method:t,headers:u,referrerPolicy:"no-referrer"},a))})}async function KW(e,t,r){e._canInitEmulator=!1;const n=Object.assign(Object.assign({},$de),t);try{const i=new Xde(e),a=await Promise.race([r(),i.promise]);i.clearNetworkTimeout();const o=await a.json();if("needConfirmation"in o)throw Sx(e,"account-exists-with-different-credential",o);if(a.ok&&!("errorMessage"in o))return o;{const s=a.ok?o.errorMessage:o.error.message,[u,l]=s.split(" : ");if(u==="FEDERATED_USER_ID_ALREADY_LINKED")throw Sx(e,"credential-already-in-use",o);if(u==="EMAIL_EXISTS")throw Sx(e,"email-already-in-use",o);if(u==="USER_DISABLED")throw Sx(e,"user-disabled",o);const c=n[u]||u.toLowerCase().replace(/[_\s]+/g,"-");if(l)throw Vde(e,c,l);Hu(e,c)}}catch(i){if(i instanceof Vh)throw i;Hu(e,"network-request-failed",{message:String(i)})}}async function p2(e,t,r,n,i={}){const a=await P0(e,t,r,n,i);return"mfaPendingCredential"in a&&Hu(e,"multi-factor-auth-required",{_serverResponse:a}),a}function QW(e,t,r,n){const i=`${t}${r}?${n}`;return e.config.emulator?dO(e.config,i):`${e.config.apiScheme}://${i}`}class Xde{constructor(t){this.auth=t,this.timer=null,this.promise=new Promise((r,n)=>{this.timer=setTimeout(()=>n(zl(this.auth,"network-request-failed")),Wde.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function Sx(e,t,r){const n={appName:e.name};r.email&&(n.email=r.email),r.phoneNumber&&(n.phoneNumber=r.phoneNumber);const i=zl(e,t,n);return i.customData._tokenResponse=r,i}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Yde(e,t){return P0(e,"POST","/v1/accounts:delete",t)}async function Kde(e,t){return P0(e,"POST","/v1/accounts:lookup",t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function D1(e){if(e)try{const t=new Date(Number(e));if(!isNaN(t.getTime()))return t.toUTCString()}catch{}}async function Qde(e,t=!1){const r=Td(e),n=await r.getIdToken(t),i=fO(n);_r(i&&i.exp&&i.auth_time&&i.iat,r.auth,"internal-error");const a=typeof i.firebase=="object"?i.firebase:void 0,o=a==null?void 0:a.sign_in_provider;return{claims:i,token:n,authTime:D1(F4(i.auth_time)),issuedAtTime:D1(F4(i.iat)),expirationTime:D1(F4(i.exp)),signInProvider:o||null,signInSecondFactor:(a==null?void 0:a.sign_in_second_factor)||null}}function F4(e){return Number(e)*1e3}function fO(e){const[t,r,n]=e.split(".");if(t===void 0||r===void 0||n===void 0)return tC("JWT malformed, contained fewer than 3 sections"),null;try{const i=NW(r);return i?JSON.parse(i):(tC("Failed to decode base64 JWT payload"),null)}catch(i){return tC("Caught error parsing JWT payload as JSON",i==null?void 0:i.toString()),null}}function Zde(e){const t=fO(e);return _r(t,"internal-error"),_r(typeof t.exp<"u","internal-error"),_r(typeof t.iat<"u","internal-error"),Number(t.exp)-Number(t.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function yb(e,t,r=!1){if(r)return t;try{return await t}catch(n){throw n instanceof Vh&&Jde(n)&&e.auth.currentUser===e&&await e.auth.signOut(),n}}function Jde({code:e}){return e==="auth/user-disabled"||e==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class efe{constructor(t){this.user=t,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(t){var r;if(t){const n=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),n}else{this.errorBackoff=3e4;const i=((r=this.user.stsTokenManager.expirationTime)!==null&&r!==void 0?r:0)-Date.now()-3e5;return Math.max(0,i)}}schedule(t=!1){if(!this.isRunning)return;const r=this.getInterval(t);this.timerId=setTimeout(async()=>{await this.iteration()},r)}async iteration(){try{await this.user.getIdToken(!0)}catch(t){(t==null?void 0:t.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZW{constructor(t,r){this.createdAt=t,this.lastLoginAt=r,this._initializeTime()}_initializeTime(){this.lastSignInTime=D1(this.lastLoginAt),this.creationTime=D1(this.createdAt)}_copy(t){this.createdAt=t.createdAt,this.lastLoginAt=t.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function s_(e){var t;const r=e.auth,n=await e.getIdToken(),i=await yb(e,Kde(r,{idToken:n}));_r(i==null?void 0:i.users.length,r,"internal-error");const a=i.users[0];e._notifyReloadListener(a);const o=!((t=a.providerUserInfo)===null||t===void 0)&&t.length?nfe(a.providerUserInfo):[],s=rfe(e.providerData,o),u=e.isAnonymous,l=!(e.email&&a.passwordHash)&&!(s!=null&&s.length),c=u?l:!1,d={uid:a.localId,displayName:a.displayName||null,photoURL:a.photoUrl||null,email:a.email||null,emailVerified:a.emailVerified||!1,phoneNumber:a.phoneNumber||null,tenantId:a.tenantId||null,providerData:s,metadata:new ZW(a.createdAt,a.lastLoginAt),isAnonymous:c};Object.assign(e,d)}async function tfe(e){const t=Td(e);await s_(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}function rfe(e,t){return[...e.filter(n=>!t.some(i=>i.providerId===n.providerId)),...t]}function nfe(e){return e.map(t=>{var{providerId:r}=t,n=lO(t,["providerId"]);return{providerId:r,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ife(e,t){const r=await KW(e,{},async()=>{const n=d2({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:i,apiKey:a}=e.config,o=QW(e,i,"/v1/token",`key=${a}`),s=await e._getAdditionalHeaders();return s["Content-Type"]="application/x-www-form-urlencoded",YW.fetch()(o,{method:"POST",headers:s,body:n})});return{accessToken:r.access_token,expiresIn:r.expires_in,refreshToken:r.refresh_token}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bb{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(t){_r(t.idToken,"internal-error"),_r(typeof t.idToken<"u","internal-error"),_r(typeof t.refreshToken<"u","internal-error");const r="expiresIn"in t&&typeof t.expiresIn<"u"?Number(t.expiresIn):Zde(t.idToken);this.updateTokensAndExpiration(t.idToken,t.refreshToken,r)}async getToken(t,r=!1){return _r(!this.accessToken||this.refreshToken,t,"user-token-expired"),!r&&this.accessToken&&!this.isExpired?this.accessToken:this.refreshToken?(await this.refresh(t,this.refreshToken),this.accessToken):null}clearRefreshToken(){this.refreshToken=null}async refresh(t,r){const{accessToken:n,refreshToken:i,expiresIn:a}=await ife(t,r);this.updateTokensAndExpiration(n,i,Number(a))}updateTokensAndExpiration(t,r,n){this.refreshToken=r||null,this.accessToken=t||null,this.expirationTime=Date.now()+n*1e3}static fromJSON(t,r){const{refreshToken:n,accessToken:i,expirationTime:a}=r,o=new bb;return n&&(_r(typeof n=="string","internal-error",{appName:t}),o.refreshToken=n),i&&(_r(typeof i=="string","internal-error",{appName:t}),o.accessToken=i),a&&(_r(typeof a=="number","internal-error",{appName:t}),o.expirationTime=a),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(t){this.accessToken=t.accessToken,this.refreshToken=t.refreshToken,this.expirationTime=t.expirationTime}_clone(){return Object.assign(new bb,this.toJSON())}_performRefresh(){return Nc("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ef(e,t){_r(typeof e=="string"||typeof e>"u","internal-error",{appName:t})}class Qp{constructor(t){var{uid:r,auth:n,stsTokenManager:i}=t,a=lO(t,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new efe(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=r,this.auth=n,this.stsTokenManager=i,this.accessToken=i.accessToken,this.displayName=a.displayName||null,this.email=a.email||null,this.emailVerified=a.emailVerified||!1,this.phoneNumber=a.phoneNumber||null,this.photoURL=a.photoURL||null,this.isAnonymous=a.isAnonymous||!1,this.tenantId=a.tenantId||null,this.providerData=a.providerData?[...a.providerData]:[],this.metadata=new ZW(a.createdAt||void 0,a.lastLoginAt||void 0)}async getIdToken(t){const r=await yb(this,this.stsTokenManager.getToken(this.auth,t));return _r(r,this.auth,"internal-error"),this.accessToken!==r&&(this.accessToken=r,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),r}getIdTokenResult(t){return Qde(this,t)}reload(){return tfe(this)}_assign(t){this!==t&&(_r(this.uid===t.uid,this.auth,"internal-error"),this.displayName=t.displayName,this.photoURL=t.photoURL,this.email=t.email,this.emailVerified=t.emailVerified,this.phoneNumber=t.phoneNumber,this.isAnonymous=t.isAnonymous,this.tenantId=t.tenantId,this.providerData=t.providerData.map(r=>Object.assign({},r)),this.metadata._copy(t.metadata),this.stsTokenManager._assign(t.stsTokenManager))}_clone(t){const r=new Qp(Object.assign(Object.assign({},this),{auth:t,stsTokenManager:this.stsTokenManager._clone()}));return r.metadata._copy(this.metadata),r}_onReload(t){_r(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=t,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(t){this.reloadListener?this.reloadListener(t):this.reloadUserInfo=t}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(t,r=!1){let n=!1;t.idToken&&t.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(t),n=!0),r&&await s_(this),await this.auth._persistUserIfCurrent(this),n&&this.auth._notifyListenersIfCurrent(this)}async delete(){const t=await this.getIdToken();return await yb(this,Yde(this.auth,{idToken:t})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(t=>Object.assign({},t)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(t,r){var n,i,a,o,s,u,l,c;const d=(n=r.displayName)!==null&&n!==void 0?n:void 0,f=(i=r.email)!==null&&i!==void 0?i:void 0,h=(a=r.phoneNumber)!==null&&a!==void 0?a:void 0,v=(o=r.photoURL)!==null&&o!==void 0?o:void 0,p=(s=r.tenantId)!==null&&s!==void 0?s:void 0,m=(u=r._redirectEventId)!==null&&u!==void 0?u:void 0,g=(l=r.createdAt)!==null&&l!==void 0?l:void 0,y=(c=r.lastLoginAt)!==null&&c!==void 0?c:void 0,{uid:b,emailVerified:S,isAnonymous:x,providerData:C,stsTokenManager:w}=r;_r(b&&w,t,"internal-error");const A=bb.fromJSON(this.name,w);_r(typeof b=="string",t,"internal-error"),ef(d,t.name),ef(f,t.name),_r(typeof S=="boolean",t,"internal-error"),_r(typeof x=="boolean",t,"internal-error"),ef(h,t.name),ef(v,t.name),ef(p,t.name),ef(m,t.name),ef(g,t.name),ef(y,t.name);const M=new Qp({uid:b,auth:t,email:f,emailVerified:S,displayName:d,isAnonymous:x,photoURL:v,phoneNumber:h,tenantId:p,stsTokenManager:A,createdAt:g,lastLoginAt:y});return C&&Array.isArray(C)&&(M.providerData=C.map(D=>Object.assign({},D))),m&&(M._redirectEventId=m),M}static async _fromIdTokenResponse(t,r,n=!1){const i=new bb;i.updateFromServerResponse(r);const a=new Qp({uid:r.localId,auth:t,stsTokenManager:i,isAnonymous:n});return await s_(a),a}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const q8=new Map;function Bc(e){id(e instanceof Function,"Expected a class definition");let t=q8.get(e);return t?(id(t instanceof e,"Instance stored in cache mismatched with class"),t):(t=new e,q8.set(e,t),t)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class JW{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(t,r){this.storage[t]=r}async _get(t){const r=this.storage[t];return r===void 0?null:r}async _remove(t){delete this.storage[t]}_addListener(t,r){}_removeListener(t,r){}}JW.type="NONE";const $8=JW;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rC(e,t,r){return`firebase:${e}:${t}:${r}`}class Tg{constructor(t,r,n){this.persistence=t,this.auth=r,this.userKey=n;const{config:i,name:a}=this.auth;this.fullUserKey=rC(this.userKey,i.apiKey,a),this.fullPersistenceKey=rC("persistence",i.apiKey,a),this.boundEventHandler=r._onStorageEvent.bind(r),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(t){return this.persistence._set(this.fullUserKey,t.toJSON())}async getCurrentUser(){const t=await this.persistence._get(this.fullUserKey);return t?Qp._fromJSON(this.auth,t):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(t){if(this.persistence===t)return;const r=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=t,r)return this.setCurrentUser(r)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(t,r,n="authUser"){if(!r.length)return new Tg(Bc($8),t,n);const i=(await Promise.all(r.map(async l=>{if(await l._isAvailable())return l}))).filter(l=>l);let a=i[0]||Bc($8);const o=rC(n,t.config.apiKey,t.name);let s=null;for(const l of r)try{const c=await l._get(o);if(c){const d=Qp._fromJSON(t,c);l!==a&&(s=d),a=l;break}}catch{}const u=i.filter(l=>l._shouldAllowMigration);return!a._shouldAllowMigration||!u.length?new Tg(a,t,n):(a=u[0],s&&await a._set(o,s.toJSON()),await Promise.all(r.map(async l=>{if(l!==a)try{await l._remove(o)}catch{}})),new Tg(a,t,n))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function W8(e){const t=e.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";if(rX(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(eX(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(iX(t))return"Blackberry";if(aX(t))return"Webos";if(hO(t))return"Safari";if((t.includes("chrome/")||tX(t))&&!t.includes("edge/"))return"Chrome";if(nX(t))return"Android";{const r=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,n=e.match(r);if((n==null?void 0:n.length)===2)return n[1]}return"Other"}function eX(e=$a()){return/firefox\//i.test(e)}function hO(e=$a()){const t=e.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function tX(e=$a()){return/crios\//i.test(e)}function rX(e=$a()){return/iemobile/i.test(e)}function nX(e=$a()){return/android/i.test(e)}function iX(e=$a()){return/blackberry/i.test(e)}function aX(e=$a()){return/webos/i.test(e)}function D3(e=$a()){return/iphone|ipad|ipod/i.test(e)||/macintosh/i.test(e)&&/mobile/i.test(e)}function afe(e=$a()){var t;return D3(e)&&!!(!((t=window.navigator)===null||t===void 0)&&t.standalone)}function ofe(){return Cce()&&document.documentMode===10}function oX(e=$a()){return D3(e)||nX(e)||aX(e)||iX(e)||/windows phone/i.test(e)||rX(e)}function sfe(){try{return!!(window&&window!==window.top)}catch{return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sX(e,t=[]){let r;switch(e){case"Browser":r=W8($a());break;case"Worker":r=`${W8($a())}-${e}`;break;default:r=e}const n=t.length?t.join(","):"FirebaseCore-web";return`${r}/JsCore/${f2}/${n}`}async function uX(e,t){return P0(e,"GET","/v2/recaptchaConfig",A0(e,t))}function X8(e){return e!==void 0&&e.enterprise!==void 0}class lX{constructor(t){if(this.siteKey="",this.emailPasswordEnabled=!1,t.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=t.recaptchaKey.split("/")[3],this.emailPasswordEnabled=t.recaptchaEnforcementState.some(r=>r.provider==="EMAIL_PASSWORD_PROVIDER"&&r.enforcementState!=="OFF")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ufe(){var e,t;return(t=(e=document.getElementsByTagName("head"))===null||e===void 0?void 0:e[0])!==null&&t!==void 0?t:document}function cX(e){return new Promise((t,r)=>{const n=document.createElement("script");n.setAttribute("src",e),n.onload=t,n.onerror=i=>{const a=zl("internal-error");a.customData=i,r(a)},n.type="text/javascript",n.charset="UTF-8",ufe().appendChild(n)})}function lfe(e){return`__${e}${Math.floor(Math.random()*1e6)}`}const cfe="https://www.google.com/recaptcha/enterprise.js?render=",dfe="recaptcha-enterprise",ffe="NO_RECAPTCHA";class dX{constructor(t){this.type=dfe,this.auth=T0(t)}async verify(t="verify",r=!1){async function n(a){if(!r){if(a.tenantId==null&&a._agentRecaptchaConfig!=null)return a._agentRecaptchaConfig.siteKey;if(a.tenantId!=null&&a._tenantRecaptchaConfigs[a.tenantId]!==void 0)return a._tenantRecaptchaConfigs[a.tenantId].siteKey}return new Promise(async(o,s)=>{uX(a,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(u=>{if(u.recaptchaKey===void 0)s(new Error("recaptcha Enterprise site key undefined"));else{const l=new lX(u);return a.tenantId==null?a._agentRecaptchaConfig=l:a._tenantRecaptchaConfigs[a.tenantId]=l,o(l.siteKey)}}).catch(u=>{s(u)})})}function i(a,o,s){const u=window.grecaptcha;X8(u)?u.enterprise.ready(()=>{u.enterprise.execute(a,{action:t}).then(l=>{o(l)}).catch(()=>{o(ffe)})}):s(Error("No reCAPTCHA enterprise script loaded."))}return new Promise((a,o)=>{n(this.auth).then(s=>{if(!r&&X8(window.grecaptcha))i(s,a,o);else{if(typeof window>"u"){o(new Error("RecaptchaVerifier is only supported in browser"));return}cX(cfe+s).then(()=>{i(s,a,o)}).catch(u=>{o(u)})}}).catch(s=>{o(s)})})}}async function u_(e,t,r,n=!1){const i=new dX(e);let a;try{a=await i.verify(r)}catch{a=await i.verify(r,!0)}const o=Object.assign({},t);return n?Object.assign(o,{captchaResp:a}):Object.assign(o,{captchaResponse:a}),Object.assign(o,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(o,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),o}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hfe{constructor(t){this.auth=t,this.queue=[]}pushCallback(t,r){const n=a=>new Promise((o,s)=>{try{const u=t(a);o(u)}catch(u){s(u)}});n.onAbort=r,this.queue.push(n);const i=this.queue.length-1;return()=>{this.queue[i]=()=>Promise.resolve()}}async runMiddleware(t){if(this.auth.currentUser===t)return;const r=[];try{for(const n of this.queue)await n(t),n.onAbort&&r.push(n.onAbort)}catch(n){r.reverse();for(const i of r)try{i()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:n==null?void 0:n.message})}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pfe{constructor(t,r,n,i){this.app=t,this.heartbeatServiceProvider=r,this.appCheckServiceProvider=n,this.config=i,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Y8(this),this.idTokenSubscription=new Y8(this),this.beforeStateQueue=new hfe(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=XW,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=t.name,this.clientVersion=i.sdkClientVersion}_initializeWithPersistence(t,r){return r&&(this._popupRedirectResolver=Bc(r)),this._initializationPromise=this.queue(async()=>{var n,i;if(!this._deleted&&(this.persistenceManager=await Tg.create(this,t),!this._deleted)){if(!((n=this._popupRedirectResolver)===null||n===void 0)&&n._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(r),this.lastNotifiedUid=((i=this.currentUser)===null||i===void 0?void 0:i.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const t=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!t)){if(this.currentUser&&t&&this.currentUser.uid===t.uid){this._currentUser._assign(t),await this.currentUser.getIdToken();return}await this._updateCurrentUser(t,!0)}}async initializeCurrentUser(t){var r;const n=await this.assertedPersistence.getCurrentUser();let i=n,a=!1;if(t&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const o=(r=this.redirectUser)===null||r===void 0?void 0:r._redirectEventId,s=i==null?void 0:i._redirectEventId,u=await this.tryRedirectSignIn(t);(!o||o===s)&&(u!=null&&u.user)&&(i=u.user,a=!0)}if(!i)return this.directlySetCurrentUser(null);if(!i._redirectEventId){if(a)try{await this.beforeStateQueue.runMiddleware(i)}catch(o){i=n,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return i?this.reloadAndSetCurrentUserOrClear(i):this.directlySetCurrentUser(null)}return _r(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===i._redirectEventId?this.directlySetCurrentUser(i):this.reloadAndSetCurrentUserOrClear(i)}async tryRedirectSignIn(t){let r=null;try{r=await this._popupRedirectResolver._completeRedirectFn(this,t,!0)}catch{await this._setRedirectUser(null)}return r}async reloadAndSetCurrentUserOrClear(t){try{await s_(t)}catch(r){if((r==null?void 0:r.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(t)}useDeviceLanguage(){this.languageCode=qde()}async _delete(){this._deleted=!0}async updateCurrentUser(t){const r=t?Td(t):null;return r&&_r(r.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(r&&r._clone(this))}async _updateCurrentUser(t,r=!1){if(!this._deleted)return t&&_r(this.tenantId===t.tenantId,this,"tenant-id-mismatch"),r||await this.beforeStateQueue.runMiddleware(t),this.queue(async()=>{await this.directlySetCurrentUser(t),this.notifyAuthListeners()})}async signOut(){return await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0)}setPersistence(t){return this.queue(async()=>{await this.assertedPersistence.setPersistence(Bc(t))})}async initializeRecaptchaConfig(){const t=await uX(this,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}),r=new lX(t);this.tenantId==null?this._agentRecaptchaConfig=r:this._tenantRecaptchaConfigs[this.tenantId]=r,r.emailPasswordEnabled&&new dX(this).verify()}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(t){this._errorFactory=new c2("auth","Firebase",t())}onAuthStateChanged(t,r,n){return this.registerStateListener(this.authStateSubscription,t,r,n)}beforeAuthStateChanged(t,r){return this.beforeStateQueue.pushCallback(t,r)}onIdTokenChanged(t,r,n){return this.registerStateListener(this.idTokenSubscription,t,r,n)}toJSON(){var t;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(t=this._currentUser)===null||t===void 0?void 0:t.toJSON()}}async _setRedirectUser(t,r){const n=await this.getOrInitRedirectPersistenceManager(r);return t===null?n.removeCurrentUser():n.setCurrentUser(t)}async getOrInitRedirectPersistenceManager(t){if(!this.redirectPersistenceManager){const r=t&&Bc(t)||this._popupRedirectResolver;_r(r,this,"argument-error"),this.redirectPersistenceManager=await Tg.create(this,[Bc(r._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(t){var r,n;return this._isInitialized&&await this.queue(async()=>{}),((r=this._currentUser)===null||r===void 0?void 0:r._redirectEventId)===t?this._currentUser:((n=this.redirectUser)===null||n===void 0?void 0:n._redirectEventId)===t?this.redirectUser:null}async _persistUserIfCurrent(t){if(t===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(t))}_notifyListenersIfCurrent(t){t===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var t,r;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const n=(r=(t=this.currentUser)===null||t===void 0?void 0:t.uid)!==null&&r!==void 0?r:null;this.lastNotifiedUid!==n&&(this.lastNotifiedUid=n,this.authStateSubscription.next(this.currentUser))}registerStateListener(t,r,n,i){if(this._deleted)return()=>{};const a=typeof r=="function"?r:r.next.bind(r),o=this._isInitialized?Promise.resolve():this._initializationPromise;return _r(o,this,"internal-error"),o.then(()=>a(this.currentUser)),typeof r=="function"?t.addObserver(r,n,i):t.addObserver(r)}async directlySetCurrentUser(t){this.currentUser&&this.currentUser!==t&&this._currentUser._stopProactiveRefresh(),t&&this.isProactiveRefreshEnabled&&t._startProactiveRefresh(),this.currentUser=t,t?await this.assertedPersistence.setCurrentUser(t):await this.assertedPersistence.removeCurrentUser()}queue(t){return this.operations=this.operations.then(t,t),this.operations}get assertedPersistence(){return _r(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(t){!t||this.frameworks.includes(t)||(this.frameworks.push(t),this.frameworks.sort(),this.clientVersion=sX(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var t;const r={"X-Client-Version":this.clientVersion};this.app.options.appId&&(r["X-Firebase-gmpid"]=this.app.options.appId);const n=await((t=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||t===void 0?void 0:t.getHeartbeatsHeader());n&&(r["X-Firebase-Client"]=n);const i=await this._getAppCheckToken();return i&&(r["X-Firebase-AppCheck"]=i),r}async _getAppCheckToken(){var t;const r=await((t=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||t===void 0?void 0:t.getToken());return r!=null&&r.error&&zde(`Error while retrieving App Check token: ${r.error}`),r==null?void 0:r.token}}function T0(e){return Td(e)}let Y8=class{constructor(t){this.auth=t,this.observer=null,this.addObserver=Ice(r=>this.observer=r)}get next(){return _r(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vfe(e,t){const r=HW(e,"auth");if(r.isInitialized()){const i=r.getImmediate(),a=r.getOptions();if(i_(a,t??{}))return i;Hu(i,"already-initialized")}return r.initialize({options:t})}function mfe(e,t){const r=(t==null?void 0:t.persistence)||[],n=(Array.isArray(r)?r:[r]).map(Bc);t!=null&&t.errorMap&&e._updateErrorMap(t.errorMap),e._initializeWithPersistence(n,t==null?void 0:t.popupRedirectResolver)}function gfe(e,t,r){const n=T0(e);_r(n._canInitEmulator,n,"emulator-config-failed"),_r(/^https?:\/\//.test(t),n,"invalid-emulator-scheme");const i=!!(r!=null&&r.disableWarnings),a=fX(t),{host:o,port:s}=yfe(t),u=s===null?"":`:${s}`;n.config.emulator={url:`${a}//${o}${u}/`},n.settings.appVerificationDisabledForTesting=!0,n.emulatorConfig=Object.freeze({host:o,port:s,protocol:a.replace(":",""),options:Object.freeze({disableWarnings:i})}),i||bfe()}function fX(e){const t=e.indexOf(":");return t<0?"":e.substr(0,t+1)}function yfe(e){const t=fX(e),r=/(\/\/)?([^?#/]+)/.exec(e.substr(t.length));if(!r)return{host:"",port:null};const n=r[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(n);if(i){const a=i[1];return{host:a,port:K8(n.substr(a.length+1))}}else{const[a,o]=n.split(":");return{host:a,port:K8(o)}}}function K8(e){if(!e)return null;const t=Number(e);return isNaN(t)?null:t}function bfe(){function e(){const t=document.createElement("p"),r=t.style;t.innerText="Running in emulator mode. Do not use with production credentials.",r.position="fixed",r.width="100%",r.backgroundColor="#ffffff",r.border=".1em solid #000000",r.color="#b50000",r.bottom="0px",r.left="0px",r.margin="0px",r.zIndex="10000",r.textAlign="center",t.classList.add("firebase-emulator-warning"),document.body.appendChild(t)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",e):e())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pO{constructor(t,r){this.providerId=t,this.signInMethod=r}toJSON(){return Nc("not implemented")}_getIdTokenResponse(t){return Nc("not implemented")}_linkToIdToken(t,r){return Nc("not implemented")}_getReauthenticationResolver(t){return Nc("not implemented")}}async function xfe(e,t){return P0(e,"POST","/v1/accounts:update",t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function L4(e,t){return p2(e,"POST","/v1/accounts:signInWithPassword",A0(e,t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Sfe(e,t){return p2(e,"POST","/v1/accounts:signInWithEmailLink",A0(e,t))}async function Cfe(e,t){return p2(e,"POST","/v1/accounts:signInWithEmailLink",A0(e,t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xb extends pO{constructor(t,r,n,i=null){super("password",n),this._email=t,this._password=r,this._tenantId=i}static _fromEmailAndPassword(t,r){return new xb(t,r,"password")}static _fromEmailAndCode(t,r,n=null){return new xb(t,r,"emailLink",n)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(t){const r=typeof t=="string"?JSON.parse(t):t;if(r!=null&&r.email&&(r!=null&&r.password)){if(r.signInMethod==="password")return this._fromEmailAndPassword(r.email,r.password);if(r.signInMethod==="emailLink")return this._fromEmailAndCode(r.email,r.password,r.tenantId)}return null}async _getIdTokenResponse(t){var r;switch(this.signInMethod){case"password":const n={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};if(!((r=t._getRecaptchaConfig())===null||r===void 0)&&r.emailPasswordEnabled){const i=await u_(t,n,"signInWithPassword");return L4(t,i)}else return L4(t,n).catch(async i=>{if(i.code==="auth/missing-recaptcha-token"){console.log("Sign-in with email address and password is protected by reCAPTCHA for this project. Automatically triggering the reCAPTCHA flow and restarting the sign-in flow.");const a=await u_(t,n,"signInWithPassword");return L4(t,a)}else return Promise.reject(i)});case"emailLink":return Sfe(t,{email:this._email,oobCode:this._password});default:Hu(t,"internal-error")}}async _linkToIdToken(t,r){switch(this.signInMethod){case"password":return xfe(t,{idToken:r,returnSecureToken:!0,email:this._email,password:this._password});case"emailLink":return Cfe(t,{idToken:r,email:this._email,oobCode:this._password});default:Hu(t,"internal-error")}}_getReauthenticationResolver(t){return this._getIdTokenResponse(t)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ig(e,t){return p2(e,"POST","/v1/accounts:signInWithIdp",A0(e,t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _fe="http://localhost";class mv extends pO{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(t){const r=new mv(t.providerId,t.signInMethod);return t.idToken||t.accessToken?(t.idToken&&(r.idToken=t.idToken),t.accessToken&&(r.accessToken=t.accessToken),t.nonce&&!t.pendingToken&&(r.nonce=t.nonce),t.pendingToken&&(r.pendingToken=t.pendingToken)):t.oauthToken&&t.oauthTokenSecret?(r.accessToken=t.oauthToken,r.secret=t.oauthTokenSecret):Hu("argument-error"),r}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(t){const r=typeof t=="string"?JSON.parse(t):t,{providerId:n,signInMethod:i}=r,a=lO(r,["providerId","signInMethod"]);if(!n||!i)return null;const o=new mv(n,i);return o.idToken=a.idToken||void 0,o.accessToken=a.accessToken||void 0,o.secret=a.secret,o.nonce=a.nonce,o.pendingToken=a.pendingToken||null,o}_getIdTokenResponse(t){const r=this.buildRequest();return Ig(t,r)}_linkToIdToken(t,r){const n=this.buildRequest();return n.idToken=r,Ig(t,n)}_getReauthenticationResolver(t){const r=this.buildRequest();return r.autoCreate=!1,Ig(t,r)}buildRequest(){const t={requestUri:_fe,returnSecureToken:!0};if(this.pendingToken)t.pendingToken=this.pendingToken;else{const r={};this.idToken&&(r.id_token=this.idToken),this.accessToken&&(r.access_token=this.accessToken),this.secret&&(r.oauth_token_secret=this.secret),r.providerId=this.providerId,this.nonce&&!this.pendingToken&&(r.nonce=this.nonce),t.postBody=d2(r)}return t}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wfe(e){switch(e){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function Efe(e){const t=t1(r1(e)).link,r=t?t1(r1(t)).deep_link_id:null,n=t1(r1(e)).deep_link_id;return(n?t1(r1(n)).link:null)||n||r||t||e}class vO{constructor(t){var r,n,i,a,o,s;const u=t1(r1(t)),l=(r=u.apiKey)!==null&&r!==void 0?r:null,c=(n=u.oobCode)!==null&&n!==void 0?n:null,d=wfe((i=u.mode)!==null&&i!==void 0?i:null);_r(l&&c&&d,"argument-error"),this.apiKey=l,this.operation=d,this.code=c,this.continueUrl=(a=u.continueUrl)!==null&&a!==void 0?a:null,this.languageCode=(o=u.languageCode)!==null&&o!==void 0?o:null,this.tenantId=(s=u.tenantId)!==null&&s!==void 0?s:null}static parseLink(t){const r=Efe(t);try{return new vO(r)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class I0{constructor(){this.providerId=I0.PROVIDER_ID}static credential(t,r){return xb._fromEmailAndPassword(t,r)}static credentialWithLink(t,r){const n=vO.parseLink(r);return _r(n,"argument-error"),xb._fromEmailAndCode(t,n.code,n.tenantId)}}I0.PROVIDER_ID="password";I0.EMAIL_PASSWORD_SIGN_IN_METHOD="password";I0.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hX{constructor(t){this.providerId=t,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(t){this.defaultLanguageCode=t}setCustomParameters(t){return this.customParameters=t,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class v2 extends hX{constructor(){super(...arguments),this.scopes=[]}addScope(t){return this.scopes.includes(t)||this.scopes.push(t),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mf extends v2{constructor(){super("facebook.com")}static credential(t){return mv._fromParams({providerId:Mf.PROVIDER_ID,signInMethod:Mf.FACEBOOK_SIGN_IN_METHOD,accessToken:t})}static credentialFromResult(t){return Mf.credentialFromTaggedObject(t)}static credentialFromError(t){return Mf.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t||!("oauthAccessToken"in t)||!t.oauthAccessToken)return null;try{return Mf.credential(t.oauthAccessToken)}catch{return null}}}Mf.FACEBOOK_SIGN_IN_METHOD="facebook.com";Mf.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Df extends v2{constructor(){super("google.com"),this.addScope("profile")}static credential(t,r){return mv._fromParams({providerId:Df.PROVIDER_ID,signInMethod:Df.GOOGLE_SIGN_IN_METHOD,idToken:t,accessToken:r})}static credentialFromResult(t){return Df.credentialFromTaggedObject(t)}static credentialFromError(t){return Df.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t)return null;const{oauthIdToken:r,oauthAccessToken:n}=t;if(!r&&!n)return null;try{return Df.credential(r,n)}catch{return null}}}Df.GOOGLE_SIGN_IN_METHOD="google.com";Df.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rf extends v2{constructor(){super("github.com")}static credential(t){return mv._fromParams({providerId:Rf.PROVIDER_ID,signInMethod:Rf.GITHUB_SIGN_IN_METHOD,accessToken:t})}static credentialFromResult(t){return Rf.credentialFromTaggedObject(t)}static credentialFromError(t){return Rf.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t||!("oauthAccessToken"in t)||!t.oauthAccessToken)return null;try{return Rf.credential(t.oauthAccessToken)}catch{return null}}}Rf.GITHUB_SIGN_IN_METHOD="github.com";Rf.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kf extends v2{constructor(){super("twitter.com")}static credential(t,r){return mv._fromParams({providerId:kf.PROVIDER_ID,signInMethod:kf.TWITTER_SIGN_IN_METHOD,oauthToken:t,oauthTokenSecret:r})}static credentialFromResult(t){return kf.credentialFromTaggedObject(t)}static credentialFromError(t){return kf.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t)return null;const{oauthAccessToken:r,oauthTokenSecret:n}=t;if(!r||!n)return null;try{return kf.credential(r,n)}catch{return null}}}kf.TWITTER_SIGN_IN_METHOD="twitter.com";kf.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function N4(e,t){return p2(e,"POST","/v1/accounts:signUp",A0(e,t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gv{constructor(t){this.user=t.user,this.providerId=t.providerId,this._tokenResponse=t._tokenResponse,this.operationType=t.operationType}static async _fromIdTokenResponse(t,r,n,i=!1){const a=await Qp._fromIdTokenResponse(t,n,i),o=Q8(n);return new gv({user:a,providerId:o,_tokenResponse:n,operationType:r})}static async _forOperation(t,r,n){await t._updateTokensIfNecessary(n,!0);const i=Q8(n);return new gv({user:t,providerId:i,_tokenResponse:n,operationType:r})}}function Q8(e){return e.providerId?e.providerId:"phoneNumber"in e?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class l_ extends Vh{constructor(t,r,n,i){var a;super(r.code,r.message),this.operationType=n,this.user=i,Object.setPrototypeOf(this,l_.prototype),this.customData={appName:t.name,tenantId:(a=t.tenantId)!==null&&a!==void 0?a:void 0,_serverResponse:r.customData._serverResponse,operationType:n}}static _fromErrorAndOperation(t,r,n,i){return new l_(t,r,n,i)}}function pX(e,t,r,n){return(t==="reauthenticate"?r._getReauthenticationResolver(e):r._getIdTokenResponse(e)).catch(a=>{throw a.code==="auth/multi-factor-auth-required"?l_._fromErrorAndOperation(e,a,t,n):a})}async function Afe(e,t,r=!1){const n=await yb(e,t._linkToIdToken(e.auth,await e.getIdToken()),r);return gv._forOperation(e,"link",n)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Pfe(e,t,r=!1){const{auth:n}=e,i="reauthenticate";try{const a=await yb(e,pX(n,i,t,e),r);_r(a.idToken,n,"internal-error");const o=fO(a.idToken);_r(o,n,"internal-error");const{sub:s}=o;return _r(e.uid===s,n,"user-mismatch"),gv._forOperation(e,i,a)}catch(a){throw(a==null?void 0:a.code)==="auth/user-not-found"&&Hu(n,"user-mismatch"),a}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function vX(e,t,r=!1){const n="signIn",i=await pX(e,n,t),a=await gv._fromIdTokenResponse(e,n,i);return r||await e._updateCurrentUser(a.user),a}async function Tfe(e,t){return vX(T0(e),t)}async function Ife(e,t,r){var n;const i=T0(e),a={returnSecureToken:!0,email:t,password:r,clientType:"CLIENT_TYPE_WEB"};let o;if(!((n=i._getRecaptchaConfig())===null||n===void 0)&&n.emailPasswordEnabled){const l=await u_(i,a,"signUpPassword");o=N4(i,l)}else o=N4(i,a).catch(async l=>{if(l.code==="auth/missing-recaptcha-token"){console.log("Sign-up is protected by reCAPTCHA for this project. Automatically triggering the reCAPTCHA flow and restarting the sign-up flow.");const c=await u_(i,a,"signUpPassword");return N4(i,c)}else return Promise.reject(l)});const s=await o.catch(l=>Promise.reject(l)),u=await gv._fromIdTokenResponse(i,"signIn",s);return await i._updateCurrentUser(u.user),u}function Mfe(e,t,r){return Tfe(Td(e),I0.credential(t,r))}function Dfe(e,t,r,n){return Td(e).onIdTokenChanged(t,r,n)}function Rfe(e,t,r){return Td(e).beforeAuthStateChanged(t,r)}function mO(e,t,r,n){return Td(e).onAuthStateChanged(t,r,n)}function kfe(e){return Td(e).signOut()}const c_="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mX{constructor(t,r){this.storageRetriever=t,this.type=r}_isAvailable(){try{return this.storage?(this.storage.setItem(c_,"1"),this.storage.removeItem(c_),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(t,r){return this.storage.setItem(t,JSON.stringify(r)),Promise.resolve()}_get(t){const r=this.storage.getItem(t);return Promise.resolve(r?JSON.parse(r):null)}_remove(t){return this.storage.removeItem(t),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ofe(){const e=$a();return hO(e)||D3(e)}const Ffe=1e3,Lfe=10;class gX extends mX{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(t,r)=>this.onStorageEvent(t,r),this.listeners={},this.localCache={},this.pollTimer=null,this.safariLocalStorageNotSynced=Ofe()&&sfe(),this.fallbackToPolling=oX(),this._shouldAllowMigration=!0}forAllChangedKeys(t){for(const r of Object.keys(this.listeners)){const n=this.storage.getItem(r),i=this.localCache[r];n!==i&&t(r,i,n)}}onStorageEvent(t,r=!1){if(!t.key){this.forAllChangedKeys((o,s,u)=>{this.notifyListeners(o,u)});return}const n=t.key;if(r?this.detachListener():this.stopPolling(),this.safariLocalStorageNotSynced){const o=this.storage.getItem(n);if(t.newValue!==o)t.newValue!==null?this.storage.setItem(n,t.newValue):this.storage.removeItem(n);else if(this.localCache[n]===t.newValue&&!r)return}const i=()=>{const o=this.storage.getItem(n);!r&&this.localCache[n]===o||this.notifyListeners(n,o)},a=this.storage.getItem(n);ofe()&&a!==t.newValue&&t.newValue!==t.oldValue?setTimeout(i,Lfe):i()}notifyListeners(t,r){this.localCache[t]=r;const n=this.listeners[t];if(n)for(const i of Array.from(n))i(r&&JSON.parse(r))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((t,r,n)=>{this.onStorageEvent(new StorageEvent("storage",{key:t,oldValue:r,newValue:n}),!0)})},Ffe)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(t,r){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[t]||(this.listeners[t]=new Set,this.localCache[t]=this.storage.getItem(t)),this.listeners[t].add(r)}_removeListener(t,r){this.listeners[t]&&(this.listeners[t].delete(r),this.listeners[t].size===0&&delete this.listeners[t]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(t,r){await super._set(t,r),this.localCache[t]=JSON.stringify(r)}async _get(t){const r=await super._get(t);return this.localCache[t]=JSON.stringify(r),r}async _remove(t){await super._remove(t),delete this.localCache[t]}}gX.type="LOCAL";const Nfe=gX;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yX extends mX{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(t,r){}_removeListener(t,r){}}yX.type="SESSION";const bX=yX;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Bfe(e){return Promise.all(e.map(async t=>{try{return{fulfilled:!0,value:await t}}catch(r){return{fulfilled:!1,reason:r}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class R3{constructor(t){this.eventTarget=t,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(t){const r=this.receivers.find(i=>i.isListeningto(t));if(r)return r;const n=new R3(t);return this.receivers.push(n),n}isListeningto(t){return this.eventTarget===t}async handleEvent(t){const r=t,{eventId:n,eventType:i,data:a}=r.data,o=this.handlersMap[i];if(!(o!=null&&o.size))return;r.ports[0].postMessage({status:"ack",eventId:n,eventType:i});const s=Array.from(o).map(async l=>l(r.origin,a)),u=await Bfe(s);r.ports[0].postMessage({status:"done",eventId:n,eventType:i,response:u})}_subscribe(t,r){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[t]||(this.handlersMap[t]=new Set),this.handlersMap[t].add(r)}_unsubscribe(t,r){this.handlersMap[t]&&r&&this.handlersMap[t].delete(r),(!r||this.handlersMap[t].size===0)&&delete this.handlersMap[t],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}R3.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gO(e="",t=10){let r="";for(let n=0;n<t;n++)r+=Math.floor(Math.random()*10);return e+r}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ufe{constructor(t){this.target=t,this.handlers=new Set}removeMessageHandler(t){t.messageChannel&&(t.messageChannel.port1.removeEventListener("message",t.onMessage),t.messageChannel.port1.close()),this.handlers.delete(t)}async _send(t,r,n=50){const i=typeof MessageChannel<"u"?new MessageChannel:null;if(!i)throw new Error("connection_unavailable");let a,o;return new Promise((s,u)=>{const l=gO("",20);i.port1.start();const c=setTimeout(()=>{u(new Error("unsupported_event"))},n);o={messageChannel:i,onMessage(d){const f=d;if(f.data.eventId===l)switch(f.data.status){case"ack":clearTimeout(c),a=setTimeout(()=>{u(new Error("timeout"))},3e3);break;case"done":clearTimeout(a),s(f.data.response);break;default:clearTimeout(c),clearTimeout(a),u(new Error("invalid_response"));break}}},this.handlers.add(o),i.port1.addEventListener("message",o.onMessage),this.target.postMessage({eventType:t,eventId:l,data:r},[i.port2])}).finally(()=>{o&&this.removeMessageHandler(o)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Vl(){return window}function jfe(e){Vl().location.href=e}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xX(){return typeof Vl().WorkerGlobalScope<"u"&&typeof Vl().importScripts=="function"}async function zfe(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function Vfe(){var e;return((e=navigator==null?void 0:navigator.serviceWorker)===null||e===void 0?void 0:e.controller)||null}function Hfe(){return xX()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const SX="firebaseLocalStorageDb",Gfe=1,d_="firebaseLocalStorage",CX="fbase_key";class m2{constructor(t){this.request=t}toPromise(){return new Promise((t,r)=>{this.request.addEventListener("success",()=>{t(this.request.result)}),this.request.addEventListener("error",()=>{r(this.request.error)})})}}function k3(e,t){return e.transaction([d_],t?"readwrite":"readonly").objectStore(d_)}function qfe(){const e=indexedDB.deleteDatabase(SX);return new m2(e).toPromise()}function VM(){const e=indexedDB.open(SX,Gfe);return new Promise((t,r)=>{e.addEventListener("error",()=>{r(e.error)}),e.addEventListener("upgradeneeded",()=>{const n=e.result;try{n.createObjectStore(d_,{keyPath:CX})}catch(i){r(i)}}),e.addEventListener("success",async()=>{const n=e.result;n.objectStoreNames.contains(d_)?t(n):(n.close(),await qfe(),t(await VM()))})})}async function Z8(e,t,r){const n=k3(e,!0).put({[CX]:t,value:r});return new m2(n).toPromise()}async function $fe(e,t){const r=k3(e,!1).get(t),n=await new m2(r).toPromise();return n===void 0?null:n.value}function J8(e,t){const r=k3(e,!0).delete(t);return new m2(r).toPromise()}const Wfe=800,Xfe=3;class _X{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await VM(),this.db)}async _withRetries(t){let r=0;for(;;)try{const n=await this._openDb();return await t(n)}catch(n){if(r++>Xfe)throw n;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return xX()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=R3._getInstance(Hfe()),this.receiver._subscribe("keyChanged",async(t,r)=>({keyProcessed:(await this._poll()).includes(r.key)})),this.receiver._subscribe("ping",async(t,r)=>["keyChanged"])}async initializeSender(){var t,r;if(this.activeServiceWorker=await zfe(),!this.activeServiceWorker)return;this.sender=new Ufe(this.activeServiceWorker);const n=await this.sender._send("ping",{},800);n&&!((t=n[0])===null||t===void 0)&&t.fulfilled&&!((r=n[0])===null||r===void 0)&&r.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(t){if(!(!this.sender||!this.activeServiceWorker||Vfe()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:t},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const t=await VM();return await Z8(t,c_,"1"),await J8(t,c_),!0}catch{}return!1}async _withPendingWrite(t){this.pendingWrites++;try{await t()}finally{this.pendingWrites--}}async _set(t,r){return this._withPendingWrite(async()=>(await this._withRetries(n=>Z8(n,t,r)),this.localCache[t]=r,this.notifyServiceWorker(t)))}async _get(t){const r=await this._withRetries(n=>$fe(n,t));return this.localCache[t]=r,r}async _remove(t){return this._withPendingWrite(async()=>(await this._withRetries(r=>J8(r,t)),delete this.localCache[t],this.notifyServiceWorker(t)))}async _poll(){const t=await this._withRetries(i=>{const a=k3(i,!1).getAll();return new m2(a).toPromise()});if(!t)return[];if(this.pendingWrites!==0)return[];const r=[],n=new Set;for(const{fbase_key:i,value:a}of t)n.add(i),JSON.stringify(this.localCache[i])!==JSON.stringify(a)&&(this.notifyListeners(i,a),r.push(i));for(const i of Object.keys(this.localCache))this.localCache[i]&&!n.has(i)&&(this.notifyListeners(i,null),r.push(i));return r}notifyListeners(t,r){this.localCache[t]=r;const n=this.listeners[t];if(n)for(const i of Array.from(n))i(r)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),Wfe)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(t,r){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[t]||(this.listeners[t]=new Set,this._get(t)),this.listeners[t].add(r)}_removeListener(t,r){this.listeners[t]&&(this.listeners[t].delete(r),this.listeners[t].size===0&&delete this.listeners[t]),Object.keys(this.listeners).length===0&&this.stopPolling()}}_X.type="LOCAL";const Yfe=_X;new h2(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Kfe(e,t){return t?Bc(t):(_r(e._popupRedirectResolver,e,"argument-error"),e._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yO extends pO{constructor(t){super("custom","custom"),this.params=t}_getIdTokenResponse(t){return Ig(t,this._buildIdpRequest())}_linkToIdToken(t,r){return Ig(t,this._buildIdpRequest(r))}_getReauthenticationResolver(t){return Ig(t,this._buildIdpRequest())}_buildIdpRequest(t){const r={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return t&&(r.idToken=t),r}}function Qfe(e){return vX(e.auth,new yO(e),e.bypassAuthState)}function Zfe(e){const{auth:t,user:r}=e;return _r(r,t,"internal-error"),Pfe(r,new yO(e),e.bypassAuthState)}async function Jfe(e){const{auth:t,user:r}=e;return _r(r,t,"internal-error"),Afe(r,new yO(e),e.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wX{constructor(t,r,n,i,a=!1){this.auth=t,this.resolver=n,this.user=i,this.bypassAuthState=a,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(r)?r:[r]}execute(){return new Promise(async(t,r)=>{this.pendingPromise={resolve:t,reject:r};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(n){this.reject(n)}})}async onAuthEvent(t){const{urlResponse:r,sessionId:n,postBody:i,tenantId:a,error:o,type:s}=t;if(o){this.reject(o);return}const u={auth:this.auth,requestUri:r,sessionId:n,tenantId:a||void 0,postBody:i||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(s)(u))}catch(l){this.reject(l)}}onError(t){this.reject(t)}getIdpTask(t){switch(t){case"signInViaPopup":case"signInViaRedirect":return Qfe;case"linkViaPopup":case"linkViaRedirect":return Jfe;case"reauthViaPopup":case"reauthViaRedirect":return Zfe;default:Hu(this.auth,"internal-error")}}resolve(t){id(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(t),this.unregisterAndCleanUp()}reject(t){id(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(t),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ehe=new h2(2e3,1e4);class cg extends wX{constructor(t,r,n,i,a){super(t,r,i,a),this.provider=n,this.authWindow=null,this.pollId=null,cg.currentPopupAction&&cg.currentPopupAction.cancel(),cg.currentPopupAction=this}async executeNotNull(){const t=await this.execute();return _r(t,this.auth,"internal-error"),t}async onExecution(){id(this.filter.length===1,"Popup operations only handle one event");const t=gO();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],t),this.authWindow.associatedEvent=t,this.resolver._originValidation(this.auth).catch(r=>{this.reject(r)}),this.resolver._isIframeWebStorageSupported(this.auth,r=>{r||this.reject(zl(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var t;return((t=this.authWindow)===null||t===void 0?void 0:t.associatedEvent)||null}cancel(){this.reject(zl(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,cg.currentPopupAction=null}pollUserCancellation(){const t=()=>{var r,n;if(!((n=(r=this.authWindow)===null||r===void 0?void 0:r.window)===null||n===void 0)&&n.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(zl(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(t,ehe.get())};t()}}cg.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const the="pendingRedirect",nC=new Map;class rhe extends wX{constructor(t,r,n=!1){super(t,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],r,void 0,n),this.eventId=null}async execute(){let t=nC.get(this.auth._key());if(!t){try{const n=await nhe(this.resolver,this.auth)?await super.execute():null;t=()=>Promise.resolve(n)}catch(r){t=()=>Promise.reject(r)}nC.set(this.auth._key(),t)}return this.bypassAuthState||nC.set(this.auth._key(),()=>Promise.resolve(null)),t()}async onAuthEvent(t){if(t.type==="signInViaRedirect")return super.onAuthEvent(t);if(t.type==="unknown"){this.resolve(null);return}if(t.eventId){const r=await this.auth._redirectUserForId(t.eventId);if(r)return this.user=r,super.onAuthEvent(t);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function nhe(e,t){const r=ohe(t),n=ahe(e);if(!await n._isAvailable())return!1;const i=await n._get(r)==="true";return await n._remove(r),i}function ihe(e,t){nC.set(e._key(),t)}function ahe(e){return Bc(e._redirectPersistence)}function ohe(e){return rC(the,e.config.apiKey,e.name)}async function she(e,t,r=!1){const n=T0(e),i=Kfe(n,t),o=await new rhe(n,i,r).execute();return o&&!r&&(delete o.user._redirectEventId,await n._persistUserIfCurrent(o.user),await n._setRedirectUser(null,t)),o}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uhe=10*60*1e3;class lhe{constructor(t){this.auth=t,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(t){this.consumers.add(t),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,t)&&(this.sendToConsumer(this.queuedRedirectEvent,t),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(t){this.consumers.delete(t)}onEvent(t){if(this.hasEventBeenHandled(t))return!1;let r=!1;return this.consumers.forEach(n=>{this.isEventForConsumer(t,n)&&(r=!0,this.sendToConsumer(t,n),this.saveEventToCache(t))}),this.hasHandledPotentialRedirect||!che(t)||(this.hasHandledPotentialRedirect=!0,r||(this.queuedRedirectEvent=t,r=!0)),r}sendToConsumer(t,r){var n;if(t.error&&!EX(t)){const i=((n=t.error.code)===null||n===void 0?void 0:n.split("auth/")[1])||"internal-error";r.onError(zl(this.auth,i))}else r.onAuthEvent(t)}isEventForConsumer(t,r){const n=r.eventId===null||!!t.eventId&&t.eventId===r.eventId;return r.filter.includes(t.type)&&n}hasEventBeenHandled(t){return Date.now()-this.lastProcessedEventTime>=uhe&&this.cachedEventUids.clear(),this.cachedEventUids.has(eB(t))}saveEventToCache(t){this.cachedEventUids.add(eB(t)),this.lastProcessedEventTime=Date.now()}}function eB(e){return[e.type,e.eventId,e.sessionId,e.tenantId].filter(t=>t).join("-")}function EX({type:e,error:t}){return e==="unknown"&&(t==null?void 0:t.code)==="auth/no-auth-event"}function che(e){switch(e.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return EX(e);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function dhe(e,t={}){return P0(e,"GET","/v1/projects",t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fhe=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,hhe=/^https?/;async function phe(e){if(e.config.emulator)return;const{authorizedDomains:t}=await dhe(e);for(const r of t)try{if(vhe(r))return}catch{}Hu(e,"unauthorized-domain")}function vhe(e){const t=zM(),{protocol:r,hostname:n}=new URL(t);if(e.startsWith("chrome-extension://")){const o=new URL(e);return o.hostname===""&&n===""?r==="chrome-extension:"&&e.replace("chrome-extension://","")===t.replace("chrome-extension://",""):r==="chrome-extension:"&&o.hostname===n}if(!hhe.test(r))return!1;if(fhe.test(e))return n===e;const i=e.replace(/\./g,"\\.");return new RegExp("^(.+\\."+i+"|"+i+")$","i").test(n)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mhe=new h2(3e4,6e4);function tB(){const e=Vl().___jsl;if(e!=null&&e.H){for(const t of Object.keys(e.H))if(e.H[t].r=e.H[t].r||[],e.H[t].L=e.H[t].L||[],e.H[t].r=[...e.H[t].L],e.CP)for(let r=0;r<e.CP.length;r++)e.CP[r]=null}}function ghe(e){return new Promise((t,r)=>{var n,i,a;function o(){tB(),gapi.load("gapi.iframes",{callback:()=>{t(gapi.iframes.getContext())},ontimeout:()=>{tB(),r(zl(e,"network-request-failed"))},timeout:mhe.get()})}if(!((i=(n=Vl().gapi)===null||n===void 0?void 0:n.iframes)===null||i===void 0)&&i.Iframe)t(gapi.iframes.getContext());else if(!((a=Vl().gapi)===null||a===void 0)&&a.load)o();else{const s=lfe("iframefcb");return Vl()[s]=()=>{gapi.load?o():r(zl(e,"network-request-failed"))},cX(`https://apis.google.com/js/api.js?onload=${s}`).catch(u=>r(u))}}).catch(t=>{throw iC=null,t})}let iC=null;function yhe(e){return iC=iC||ghe(e),iC}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bhe=new h2(5e3,15e3),xhe="__/auth/iframe",She="emulator/auth/iframe",Che={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},_he=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function whe(e){const t=e.config;_r(t.authDomain,e,"auth-domain-config-required");const r=t.emulator?dO(t,She):`https://${e.config.authDomain}/${xhe}`,n={apiKey:t.apiKey,appName:e.name,v:f2},i=_he.get(e.config.apiHost);i&&(n.eid=i);const a=e._getFrameworks();return a.length&&(n.fw=a.join(",")),`${r}?${d2(n).slice(1)}`}async function Ehe(e){const t=await yhe(e),r=Vl().gapi;return _r(r,e,"internal-error"),t.open({where:document.body,url:whe(e),messageHandlersFilter:r.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:Che,dontclear:!0},n=>new Promise(async(i,a)=>{await n.restyle({setHideOnLeave:!1});const o=zl(e,"network-request-failed"),s=Vl().setTimeout(()=>{a(o)},bhe.get());function u(){Vl().clearTimeout(s),i(n)}n.ping(u).then(u,()=>{a(o)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ahe={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},Phe=500,The=600,Ihe="_blank",Mhe="http://localhost";class rB{constructor(t){this.window=t,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function Dhe(e,t,r,n=Phe,i=The){const a=Math.max((window.screen.availHeight-i)/2,0).toString(),o=Math.max((window.screen.availWidth-n)/2,0).toString();let s="";const u=Object.assign(Object.assign({},Ahe),{width:n.toString(),height:i.toString(),top:a,left:o}),l=$a().toLowerCase();r&&(s=tX(l)?Ihe:r),eX(l)&&(t=t||Mhe,u.scrollbars="yes");const c=Object.entries(u).reduce((f,[h,v])=>`${f}${h}=${v},`,"");if(afe(l)&&s!=="_self")return Rhe(t||"",s),new rB(null);const d=window.open(t||"",s,c);_r(d,e,"popup-blocked");try{d.focus()}catch{}return new rB(d)}function Rhe(e,t){const r=document.createElement("a");r.href=e,r.target=t;const n=document.createEvent("MouseEvent");n.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),r.dispatchEvent(n)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const khe="__/auth/handler",Ohe="emulator/auth/handler",Fhe=encodeURIComponent("fac");async function nB(e,t,r,n,i,a){_r(e.config.authDomain,e,"auth-domain-config-required"),_r(e.config.apiKey,e,"invalid-api-key");const o={apiKey:e.config.apiKey,appName:e.name,authType:r,redirectUrl:n,v:f2,eventId:i};if(t instanceof hX){t.setDefaultLanguage(e.languageCode),o.providerId=t.providerId||"",Tce(t.getCustomParameters())||(o.customParameters=JSON.stringify(t.getCustomParameters()));for(const[c,d]of Object.entries(a||{}))o[c]=d}if(t instanceof v2){const c=t.getScopes().filter(d=>d!=="");c.length>0&&(o.scopes=c.join(","))}e.tenantId&&(o.tid=e.tenantId);const s=o;for(const c of Object.keys(s))s[c]===void 0&&delete s[c];const u=await e._getAppCheckToken(),l=u?`#${Fhe}=${encodeURIComponent(u)}`:"";return`${Lhe(e)}?${d2(s).slice(1)}${l}`}function Lhe({config:e}){return e.emulator?dO(e,Ohe):`https://${e.authDomain}/${khe}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const B4="webStorageSupport";class Nhe{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=bX,this._completeRedirectFn=she,this._overrideRedirectResult=ihe}async _openPopup(t,r,n,i){var a;id((a=this.eventManagers[t._key()])===null||a===void 0?void 0:a.manager,"_initialize() not called before _openPopup()");const o=await nB(t,r,n,zM(),i);return Dhe(t,o,gO())}async _openRedirect(t,r,n,i){await this._originValidation(t);const a=await nB(t,r,n,zM(),i);return jfe(a),new Promise(()=>{})}_initialize(t){const r=t._key();if(this.eventManagers[r]){const{manager:i,promise:a}=this.eventManagers[r];return i?Promise.resolve(i):(id(a,"If manager is not set, promise should be"),a)}const n=this.initAndGetManager(t);return this.eventManagers[r]={promise:n},n.catch(()=>{delete this.eventManagers[r]}),n}async initAndGetManager(t){const r=await Ehe(t),n=new lhe(t);return r.register("authEvent",i=>(_r(i==null?void 0:i.authEvent,t,"invalid-auth-event"),{status:n.onEvent(i.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[t._key()]={manager:n},this.iframes[t._key()]=r,n}_isIframeWebStorageSupported(t,r){this.iframes[t._key()].send(B4,{type:B4},i=>{var a;const o=(a=i==null?void 0:i[0])===null||a===void 0?void 0:a[B4];o!==void 0&&r(!!o),Hu(t,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(t){const r=t._key();return this.originValidationPromises[r]||(this.originValidationPromises[r]=phe(t)),this.originValidationPromises[r]}get _shouldInitProactively(){return oX()||hO()||D3()}}const Bhe=Nhe;var iB="@firebase/auth",aB="0.23.2";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Uhe{constructor(t){this.auth=t,this.internalListeners=new Map}getUid(){var t;return this.assertAuthConfigured(),((t=this.auth.currentUser)===null||t===void 0?void 0:t.uid)||null}async getToken(t){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(t)}:null}addAuthTokenListener(t){if(this.assertAuthConfigured(),this.internalListeners.has(t))return;const r=this.auth.onIdTokenChanged(n=>{t((n==null?void 0:n.stsTokenManager.accessToken)||null)});this.internalListeners.set(t,r),this.updateProactiveRefresh()}removeAuthTokenListener(t){this.assertAuthConfigured();const r=this.internalListeners.get(t);r&&(this.internalListeners.delete(t),r(),this.updateProactiveRefresh())}assertAuthConfigured(){_r(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jhe(e){switch(e){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";default:return}}function zhe(e){mb(new e0("auth",(t,{options:r})=>{const n=t.getProvider("app").getImmediate(),i=t.getProvider("heartbeat"),a=t.getProvider("app-check-internal"),{apiKey:o,authDomain:s}=n.options;_r(o&&!o.includes(":"),"invalid-api-key",{appName:n.name});const u={apiKey:o,authDomain:s,clientPlatform:e,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:sX(e)},l=new pfe(n,i,a,u);return mfe(l,r),l},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((t,r,n)=>{t.getProvider("auth-internal").initialize()})),mb(new e0("auth-internal",t=>{const r=T0(t.getProvider("auth").getImmediate());return(n=>new Uhe(n))(r)},"PRIVATE").setInstantiationMode("EXPLICIT")),Pg(iB,aB,jhe(e)),Pg(iB,aB,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Vhe=5*60,Hhe=UW("authIdTokenMaxAge")||Vhe;let oB=null;const Ghe=e=>async t=>{const r=t&&await t.getIdTokenResult(),n=r&&(new Date().getTime()-Date.parse(r.issuedAtTime))/1e3;if(n&&n>Hhe)return;const i=r==null?void 0:r.token;oB!==i&&(oB=i,await fetch(e,{method:i?"POST":"DELETE",headers:i?{Authorization:`Bearer ${i}`}:{}}))};function qhe(e=Tde()){const t=HW(e,"auth");if(t.isInitialized())return t.getImmediate();const r=vfe(e,{popupRedirectResolver:Bhe,persistence:[Yfe,Nfe,bX]}),n=UW("authTokenSyncURL");if(n){const a=Ghe(n);Rfe(r,a,()=>a(r.currentUser)),Dfe(r,o=>a(o))}const i=gce("auth");return i&&gfe(r,`http://${i}`),r}zhe("Browser");const $he={apiKey:"AIzaSyAgwFmiZzi7wejk8yhpOXQ9T9ST58NEba8",authDomain:"ksprotauth.firebaseapp.com",projectId:"ksprotauth",storageBucket:"ksprotauth.appspot.com",messagingSenderId:"430140733022",appId:"1:430140733022:web:c83ed9c239dc6bdacbe6cf",measurementId:"G-VFEEYCG3H1"},Whe=GW($he),yv=qhe(Whe),Xhe=Eo.createContext({user:null}),Yhe=({children:e})=>{const[t,r]=_e.useState(null);return _e.useEffect(()=>yv.onAuthStateChanged(i=>{r(i)}),[]),P.jsx(Xhe.Provider,{value:{user:t},children:e})};/**
 * @remix-run/router v1.6.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Sb(){return Sb=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Sb.apply(this,arguments)}var $f;(function(e){e.Pop="POP",e.Push="PUSH",e.Replace="REPLACE"})($f||($f={}));const sB="popstate";function Khe(e){e===void 0&&(e={});function t(n,i){let{pathname:a,search:o,hash:s}=n.location;return HM("",{pathname:a,search:o,hash:s},i.state&&i.state.usr||null,i.state&&i.state.key||"default")}function r(n,i){return typeof i=="string"?i:AX(i)}return Zhe(t,r,null,e)}function Ki(e,t){if(e===!1||e===null||typeof e>"u")throw new Error(t)}function bO(e,t){if(!e){typeof console<"u"&&console.warn(t);try{throw new Error(t)}catch{}}}function Qhe(){return Math.random().toString(36).substr(2,8)}function uB(e,t){return{usr:e.state,key:e.key,idx:t}}function HM(e,t,r,n){return r===void 0&&(r=null),Sb({pathname:typeof e=="string"?e:e.pathname,search:"",hash:""},typeof t=="string"?M0(t):t,{state:r,key:t&&t.key||n||Qhe()})}function AX(e){let{pathname:t="/",search:r="",hash:n=""}=e;return r&&r!=="?"&&(t+=r.charAt(0)==="?"?r:"?"+r),n&&n!=="#"&&(t+=n.charAt(0)==="#"?n:"#"+n),t}function M0(e){let t={};if(e){let r=e.indexOf("#");r>=0&&(t.hash=e.substr(r),e=e.substr(0,r));let n=e.indexOf("?");n>=0&&(t.search=e.substr(n),e=e.substr(0,n)),e&&(t.pathname=e)}return t}function Zhe(e,t,r,n){n===void 0&&(n={});let{window:i=document.defaultView,v5Compat:a=!1}=n,o=i.history,s=$f.Pop,u=null,l=c();l==null&&(l=0,o.replaceState(Sb({},o.state,{idx:l}),""));function c(){return(o.state||{idx:null}).idx}function d(){s=$f.Pop;let m=c(),g=m==null?null:m-l;l=m,u&&u({action:s,location:p.location,delta:g})}function f(m,g){s=$f.Push;let y=HM(p.location,m,g);r&&r(y,m),l=c()+1;let b=uB(y,l),S=p.createHref(y);try{o.pushState(b,"",S)}catch{i.location.assign(S)}a&&u&&u({action:s,location:p.location,delta:1})}function h(m,g){s=$f.Replace;let y=HM(p.location,m,g);r&&r(y,m),l=c();let b=uB(y,l),S=p.createHref(y);o.replaceState(b,"",S),a&&u&&u({action:s,location:p.location,delta:0})}function v(m){let g=i.location.origin!=="null"?i.location.origin:i.location.href,y=typeof m=="string"?m:AX(m);return Ki(g,"No window.location.(origin|href) available to create URL for href: "+y),new URL(y,g)}let p={get action(){return s},get location(){return e(i,o)},listen(m){if(u)throw new Error("A history only accepts one active listener");return i.addEventListener(sB,d),u=m,()=>{i.removeEventListener(sB,d),u=null}},createHref(m){return t(i,m)},createURL:v,encodeLocation(m){let g=v(m);return{pathname:g.pathname,search:g.search,hash:g.hash}},push:f,replace:h,go(m){return o.go(m)}};return p}var lB;(function(e){e.data="data",e.deferred="deferred",e.redirect="redirect",e.error="error"})(lB||(lB={}));function Jhe(e,t,r){r===void 0&&(r="/");let n=typeof t=="string"?M0(t):t,i=IX(n.pathname||"/",r);if(i==null)return null;let a=PX(e);epe(a);let o=null;for(let s=0;o==null&&s<a.length;++s)o=lpe(a[s],fpe(i));return o}function PX(e,t,r,n){t===void 0&&(t=[]),r===void 0&&(r=[]),n===void 0&&(n="");let i=(a,o,s)=>{let u={relativePath:s===void 0?a.path||"":s,caseSensitive:a.caseSensitive===!0,childrenIndex:o,route:a};u.relativePath.startsWith("/")&&(Ki(u.relativePath.startsWith(n),'Absolute route path "'+u.relativePath+'" nested under path '+('"'+n+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),u.relativePath=u.relativePath.slice(n.length));let l=Zp([n,u.relativePath]),c=r.concat(u);a.children&&a.children.length>0&&(Ki(a.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+l+'".')),PX(a.children,t,c,l)),!(a.path==null&&!a.index)&&t.push({path:l,score:spe(l,a.index),routesMeta:c})};return e.forEach((a,o)=>{var s;if(a.path===""||!((s=a.path)!=null&&s.includes("?")))i(a,o);else for(let u of TX(a.path))i(a,o,u)}),t}function TX(e){let t=e.split("/");if(t.length===0)return[];let[r,...n]=t,i=r.endsWith("?"),a=r.replace(/\?$/,"");if(n.length===0)return i?[a,""]:[a];let o=TX(n.join("/")),s=[];return s.push(...o.map(u=>u===""?a:[a,u].join("/"))),i&&s.push(...o),s.map(u=>e.startsWith("/")&&u===""?"/":u)}function epe(e){e.sort((t,r)=>t.score!==r.score?r.score-t.score:upe(t.routesMeta.map(n=>n.childrenIndex),r.routesMeta.map(n=>n.childrenIndex)))}const tpe=/^:\w+$/,rpe=3,npe=2,ipe=1,ape=10,ope=-2,cB=e=>e==="*";function spe(e,t){let r=e.split("/"),n=r.length;return r.some(cB)&&(n+=ope),t&&(n+=npe),r.filter(i=>!cB(i)).reduce((i,a)=>i+(tpe.test(a)?rpe:a===""?ipe:ape),n)}function upe(e,t){return e.length===t.length&&e.slice(0,-1).every((n,i)=>n===t[i])?e[e.length-1]-t[t.length-1]:0}function lpe(e,t){let{routesMeta:r}=e,n={},i="/",a=[];for(let o=0;o<r.length;++o){let s=r[o],u=o===r.length-1,l=i==="/"?t:t.slice(i.length)||"/",c=cpe({path:s.relativePath,caseSensitive:s.caseSensitive,end:u},l);if(!c)return null;Object.assign(n,c.params);let d=s.route;a.push({params:n,pathname:Zp([i,c.pathname]),pathnameBase:ype(Zp([i,c.pathnameBase])),route:d}),c.pathnameBase!=="/"&&(i=Zp([i,c.pathnameBase]))}return a}function cpe(e,t){typeof e=="string"&&(e={path:e,caseSensitive:!1,end:!0});let[r,n]=dpe(e.path,e.caseSensitive,e.end),i=t.match(r);if(!i)return null;let a=i[0],o=a.replace(/(.)\/+$/,"$1"),s=i.slice(1);return{params:n.reduce((l,c,d)=>{if(c==="*"){let f=s[d]||"";o=a.slice(0,a.length-f.length).replace(/(.)\/+$/,"$1")}return l[c]=hpe(s[d]||"",c),l},{}),pathname:a,pathnameBase:o,pattern:e}}function dpe(e,t,r){t===void 0&&(t=!1),r===void 0&&(r=!0),bO(e==="*"||!e.endsWith("*")||e.endsWith("/*"),'Route path "'+e+'" will be treated as if it were '+('"'+e.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+e.replace(/\*$/,"/*")+'".'));let n=[],i="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^$?{}|()[\]]/g,"\\$&").replace(/\/:(\w+)/g,(o,s)=>(n.push(s),"/([^\\/]+)"));return e.endsWith("*")?(n.push("*"),i+=e==="*"||e==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):r?i+="\\/*$":e!==""&&e!=="/"&&(i+="(?:(?=\\/|$))"),[new RegExp(i,t?void 0:"i"),n]}function fpe(e){try{return decodeURI(e)}catch(t){return bO(!1,'The URL path "'+e+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+t+").")),e}}function hpe(e,t){try{return decodeURIComponent(e)}catch(r){return bO(!1,'The value for the URL param "'+t+'" will not be decoded because'+(' the string "'+e+'" is a malformed URL segment. This is probably')+(" due to a bad percent encoding ("+r+").")),e}}function IX(e,t){if(t==="/")return e;if(!e.toLowerCase().startsWith(t.toLowerCase()))return null;let r=t.endsWith("/")?t.length-1:t.length,n=e.charAt(r);return n&&n!=="/"?null:e.slice(r)||"/"}function ppe(e,t){t===void 0&&(t="/");let{pathname:r,search:n="",hash:i=""}=typeof e=="string"?M0(e):e;return{pathname:r?r.startsWith("/")?r:vpe(r,t):t,search:bpe(n),hash:xpe(i)}}function vpe(e,t){let r=t.replace(/\/+$/,"").split("/");return e.split("/").forEach(i=>{i===".."?r.length>1&&r.pop():i!=="."&&r.push(i)}),r.length>1?r.join("/"):"/"}function U4(e,t,r,n){return"Cannot include a '"+e+"' character in a manually specified "+("`to."+t+"` field ["+JSON.stringify(n)+"].  Please separate it out to the ")+("`to."+r+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function mpe(e){return e.filter((t,r)=>r===0||t.route.path&&t.route.path.length>0)}function gpe(e,t,r,n){n===void 0&&(n=!1);let i;typeof e=="string"?i=M0(e):(i=Sb({},e),Ki(!i.pathname||!i.pathname.includes("?"),U4("?","pathname","search",i)),Ki(!i.pathname||!i.pathname.includes("#"),U4("#","pathname","hash",i)),Ki(!i.search||!i.search.includes("#"),U4("#","search","hash",i)));let a=e===""||i.pathname==="",o=a?"/":i.pathname,s;if(n||o==null)s=r;else{let d=t.length-1;if(o.startsWith("..")){let f=o.split("/");for(;f[0]==="..";)f.shift(),d-=1;i.pathname=f.join("/")}s=d>=0?t[d]:"/"}let u=ppe(i,s),l=o&&o!=="/"&&o.endsWith("/"),c=(a||o===".")&&r.endsWith("/");return!u.pathname.endsWith("/")&&(l||c)&&(u.pathname+="/"),u}const Zp=e=>e.join("/").replace(/\/\/+/g,"/"),ype=e=>e.replace(/\/+$/,"").replace(/^\/*/,"/"),bpe=e=>!e||e==="?"?"":e.startsWith("?")?e:"?"+e,xpe=e=>!e||e==="#"?"":e.startsWith("#")?e:"#"+e;function Spe(e){return e!=null&&typeof e.status=="number"&&typeof e.statusText=="string"&&typeof e.internal=="boolean"&&"data"in e}const MX=["post","put","patch","delete"];new Set(MX);const Cpe=["get",...MX];new Set(Cpe);/**
 * React Router v6.11.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function f_(){return f_=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},f_.apply(this,arguments)}const xO=_e.createContext(null),_pe=_e.createContext(null),O3=_e.createContext(null),F3=_e.createContext(null),$v=_e.createContext({outlet:null,matches:[],isDataRoute:!1}),DX=_e.createContext(null);function L3(){return _e.useContext(F3)!=null}function SO(){return L3()||Ki(!1),_e.useContext(F3).location}function RX(e){_e.useContext(O3).static||_e.useLayoutEffect(e)}function Id(){let{isDataRoute:e}=_e.useContext($v);return e?Npe():wpe()}function wpe(){L3()||Ki(!1);let e=_e.useContext(xO),{basename:t,navigator:r}=_e.useContext(O3),{matches:n}=_e.useContext($v),{pathname:i}=SO(),a=JSON.stringify(mpe(n).map(u=>u.pathnameBase)),o=_e.useRef(!1);return RX(()=>{o.current=!0}),_e.useCallback(function(u,l){if(l===void 0&&(l={}),!o.current)return;if(typeof u=="number"){r.go(u);return}let c=gpe(u,JSON.parse(a),i,l.relative==="path");e==null&&t!=="/"&&(c.pathname=c.pathname==="/"?t:Zp([t,c.pathname])),(l.replace?r.replace:r.push)(c,l.state,l)},[t,r,a,i,e])}function Epe(){let{matches:e}=_e.useContext($v),t=e[e.length-1];return t?t.params:{}}function Ape(e,t){return Ppe(e,t)}function Ppe(e,t,r){L3()||Ki(!1);let{navigator:n}=_e.useContext(O3),{matches:i}=_e.useContext($v),a=i[i.length-1],o=a?a.params:{};a&&a.pathname;let s=a?a.pathnameBase:"/";a&&a.route;let u=SO(),l;if(t){var c;let p=typeof t=="string"?M0(t):t;s==="/"||(c=p.pathname)!=null&&c.startsWith(s)||Ki(!1),l=p}else l=u;let d=l.pathname||"/",f=s==="/"?d:d.slice(s.length)||"/",h=Jhe(e,{pathname:f}),v=Rpe(h&&h.map(p=>Object.assign({},p,{params:Object.assign({},o,p.params),pathname:Zp([s,n.encodeLocation?n.encodeLocation(p.pathname).pathname:p.pathname]),pathnameBase:p.pathnameBase==="/"?s:Zp([s,n.encodeLocation?n.encodeLocation(p.pathnameBase).pathname:p.pathnameBase])})),i,r);return t&&v?_e.createElement(F3.Provider,{value:{location:f_({pathname:"/",search:"",hash:"",state:null,key:"default"},l),navigationType:$f.Pop}},v):v}function Tpe(){let e=Lpe(),t=Spe(e)?e.status+" "+e.statusText:e instanceof Error?e.message:JSON.stringify(e),r=e instanceof Error?e.stack:null,i={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"},a=null;return _e.createElement(_e.Fragment,null,_e.createElement("h2",null,"Unexpected Application Error!"),_e.createElement("h3",{style:{fontStyle:"italic"}},t),r?_e.createElement("pre",{style:i},r):null,a)}const Ipe=_e.createElement(Tpe,null);class Mpe extends _e.Component{constructor(t){super(t),this.state={location:t.location,revalidation:t.revalidation,error:t.error}}static getDerivedStateFromError(t){return{error:t}}static getDerivedStateFromProps(t,r){return r.location!==t.location||r.revalidation!=="idle"&&t.revalidation==="idle"?{error:t.error,location:t.location,revalidation:t.revalidation}:{error:t.error||r.error,location:r.location,revalidation:t.revalidation||r.revalidation}}componentDidCatch(t,r){console.error("React Router caught the following error during render",t,r)}render(){return this.state.error?_e.createElement($v.Provider,{value:this.props.routeContext},_e.createElement(DX.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function Dpe(e){let{routeContext:t,match:r,children:n}=e,i=_e.useContext(xO);return i&&i.static&&i.staticContext&&(r.route.errorElement||r.route.ErrorBoundary)&&(i.staticContext._deepestRenderedBoundaryId=r.route.id),_e.createElement($v.Provider,{value:t},n)}function Rpe(e,t,r){var n;if(t===void 0&&(t=[]),r===void 0&&(r=null),e==null){var i;if((i=r)!=null&&i.errors)e=r.matches;else return null}let a=e,o=(n=r)==null?void 0:n.errors;if(o!=null){let s=a.findIndex(u=>u.route.id&&(o==null?void 0:o[u.route.id]));s>=0||Ki(!1),a=a.slice(0,Math.min(a.length,s+1))}return a.reduceRight((s,u,l)=>{let c=u.route.id?o==null?void 0:o[u.route.id]:null,d=null;r&&(d=u.route.errorElement||Ipe);let f=t.concat(a.slice(0,l+1)),h=()=>{let v;return c?v=d:u.route.Component?v=_e.createElement(u.route.Component,null):u.route.element?v=u.route.element:v=s,_e.createElement(Dpe,{match:u,routeContext:{outlet:s,matches:f,isDataRoute:r!=null},children:v})};return r&&(u.route.ErrorBoundary||u.route.errorElement||l===0)?_e.createElement(Mpe,{location:r.location,revalidation:r.revalidation,component:d,error:c,children:h(),routeContext:{outlet:null,matches:f,isDataRoute:!0}}):h()},null)}var GM;(function(e){e.UseBlocker="useBlocker",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate"})(GM||(GM={}));var Cb;(function(e){e.UseBlocker="useBlocker",e.UseLoaderData="useLoaderData",e.UseActionData="useActionData",e.UseRouteError="useRouteError",e.UseNavigation="useNavigation",e.UseRouteLoaderData="useRouteLoaderData",e.UseMatches="useMatches",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e.UseRouteId="useRouteId"})(Cb||(Cb={}));function kpe(e){let t=_e.useContext(xO);return t||Ki(!1),t}function Ope(e){let t=_e.useContext(_pe);return t||Ki(!1),t}function Fpe(e){let t=_e.useContext($v);return t||Ki(!1),t}function kX(e){let t=Fpe(),r=t.matches[t.matches.length-1];return r.route.id||Ki(!1),r.route.id}function Lpe(){var e;let t=_e.useContext(DX),r=Ope(Cb.UseRouteError),n=kX(Cb.UseRouteError);return t||((e=r.errors)==null?void 0:e[n])}function Npe(){let{router:e}=kpe(GM.UseNavigateStable),t=kX(Cb.UseNavigateStable),r=_e.useRef(!1);return RX(()=>{r.current=!0}),_e.useCallback(function(i,a){a===void 0&&(a={}),r.current&&(typeof i=="number"?e.navigate(i):e.navigate(i,f_({fromRouteId:t},a)))},[e,t])}function _p(e){Ki(!1)}function Bpe(e){let{basename:t="/",children:r=null,location:n,navigationType:i=$f.Pop,navigator:a,static:o=!1}=e;L3()&&Ki(!1);let s=t.replace(/^\/*/,"/"),u=_e.useMemo(()=>({basename:s,navigator:a,static:o}),[s,a,o]);typeof n=="string"&&(n=M0(n));let{pathname:l="/",search:c="",hash:d="",state:f=null,key:h="default"}=n,v=_e.useMemo(()=>{let p=IX(l,s);return p==null?null:{location:{pathname:p,search:c,hash:d,state:f,key:h},navigationType:i}},[s,l,c,d,f,h,i]);return v==null?null:_e.createElement(O3.Provider,{value:u},_e.createElement(F3.Provider,{children:r,value:v}))}function Upe(e){let{children:t,location:r}=e;return Ape(qM(t),r)}var dB;(function(e){e[e.pending=0]="pending",e[e.success=1]="success",e[e.error=2]="error"})(dB||(dB={}));new Promise(()=>{});function qM(e,t){t===void 0&&(t=[]);let r=[];return _e.Children.forEach(e,(n,i)=>{if(!_e.isValidElement(n))return;let a=[...t,i];if(n.type===_e.Fragment){r.push.apply(r,qM(n.props.children,a));return}n.type!==_p&&Ki(!1),!n.props.index||!n.props.children||Ki(!1);let o={id:n.props.id||a.join("-"),caseSensitive:n.props.caseSensitive,element:n.props.element,Component:n.props.Component,index:n.props.index,path:n.props.path,loader:n.props.loader,action:n.props.action,errorElement:n.props.errorElement,ErrorBoundary:n.props.ErrorBoundary,hasErrorBoundary:n.props.ErrorBoundary!=null||n.props.errorElement!=null,shouldRevalidate:n.props.shouldRevalidate,handle:n.props.handle,lazy:n.props.lazy};n.props.children&&(o.children=qM(n.props.children,a)),r.push(o)}),r}/**
 * React Router DOM v6.11.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function $M(e){return e===void 0&&(e=""),new URLSearchParams(typeof e=="string"||Array.isArray(e)||e instanceof URLSearchParams?e:Object.keys(e).reduce((t,r)=>{let n=e[r];return t.concat(Array.isArray(n)?n.map(i=>[r,i]):[[r,n]])},[]))}function jpe(e,t){let r=$M(e);if(t)for(let n of t.keys())r.has(n)||t.getAll(n).forEach(i=>{r.append(n,i)});return r}function zpe(e){let{basename:t,children:r,window:n}=e,i=_e.useRef();i.current==null&&(i.current=Khe({window:n,v5Compat:!0}));let a=i.current,[o,s]=_e.useState({action:a.action,location:a.location});return _e.useLayoutEffect(()=>a.listen(s),[a]),_e.createElement(Bpe,{basename:t,children:r,location:o.location,navigationType:o.action,navigator:a})}var fB;(function(e){e.UseScrollRestoration="useScrollRestoration",e.UseSubmitImpl="useSubmitImpl",e.UseFetcher="useFetcher"})(fB||(fB={}));var hB;(function(e){e.UseFetchers="useFetchers",e.UseScrollRestoration="useScrollRestoration"})(hB||(hB={}));function Vpe(e){let t=_e.useRef($M(e)),r=_e.useRef(!1),n=SO(),i=_e.useMemo(()=>jpe(n.search,r.current?null:t.current),[n.search]),a=Id(),o=_e.useCallback((s,u)=>{const l=$M(typeof s=="function"?s(i):s);r.current=!0,a("?"+l,u)},[a,i]);return[i,o]}const Hpe=()=>{const e=Id(),t=()=>{e("/auth")};return _e.useEffect(()=>{const r=mO(yv,n=>{n&&e("/search")});return()=>r()},[]),P.jsx("div",{className:"app-main-wrapper",children:P.jsxs("div",{className:"app-main",children:[P.jsx("span",{className:"app-title",children:"Q-1 Search"}),P.jsx("span",{className:"app-description",children:"Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt u"}),P.jsx("button",{className:"app-login",onClick:t,children:"Login"})]})})},CO=()=>{const e=Id(),[t,r]=Eo.useState("");Eo.useEffect(()=>{const i=mO(yv,a=>{a?r(a.email?a.email:""):e("/")});return()=>i()},[]);const n=()=>{kfe(yv).then(()=>{e("/"),console.log("Signed out successfully")}).catch(i=>{console.error("Sign out error: "+i)})};return P.jsxs("div",{className:"app-header",children:[P.jsx("div",{className:"app-header-login",children:t}),P.jsx("button",{className:"app-header-button",onClick:n,children:"Log Out"})]})};function Au(e){for(var t=arguments.length,r=Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];throw Error("[Immer] minified error nr: "+e+(r.length?" "+r.map(function(i){return"'"+i+"'"}).join(","):"")+". Find the full error at: https://bit.ly/3cXEKWf")}function Ch(e){return!!e&&!!e[ii]}function ad(e){var t;return!!e&&(function(r){if(!r||typeof r!="object")return!1;var n=Object.getPrototypeOf(r);if(n===null)return!0;var i=Object.hasOwnProperty.call(n,"constructor")&&n.constructor;return i===Object||typeof i=="function"&&Function.toString.call(i)===Zpe}(e)||Array.isArray(e)||!!e[xB]||!!(!((t=e.constructor)===null||t===void 0)&&t[xB])||_O(e)||wO(e))}function bv(e,t,r){r===void 0&&(r=!1),D0(e)===0?(r?Object.keys:Dg)(e).forEach(function(n){r&&typeof n=="symbol"||t(n,e[n],e)}):e.forEach(function(n,i){return t(i,n,e)})}function D0(e){var t=e[ii];return t?t.i>3?t.i-4:t.i:Array.isArray(e)?1:_O(e)?2:wO(e)?3:0}function Mg(e,t){return D0(e)===2?e.has(t):Object.prototype.hasOwnProperty.call(e,t)}function Gpe(e,t){return D0(e)===2?e.get(t):e[t]}function OX(e,t,r){var n=D0(e);n===2?e.set(t,r):n===3?e.add(r):e[t]=r}function FX(e,t){return e===t?e!==0||1/e==1/t:e!=e&&t!=t}function _O(e){return Kpe&&e instanceof Map}function wO(e){return Qpe&&e instanceof Set}function wp(e){return e.o||e.t}function EO(e){if(Array.isArray(e))return Array.prototype.slice.call(e);var t=NX(e);delete t[ii];for(var r=Dg(t),n=0;n<r.length;n++){var i=r[n],a=t[i];a.writable===!1&&(a.writable=!0,a.configurable=!0),(a.get||a.set)&&(t[i]={configurable:!0,writable:!0,enumerable:a.enumerable,value:e[i]})}return Object.create(Object.getPrototypeOf(e),t)}function AO(e,t){return t===void 0&&(t=!1),PO(e)||Ch(e)||!ad(e)||(D0(e)>1&&(e.set=e.add=e.clear=e.delete=qpe),Object.freeze(e),t&&bv(e,function(r,n){return AO(n,!0)},!0)),e}function qpe(){Au(2)}function PO(e){return e==null||typeof e!="object"||Object.isFrozen(e)}function Hl(e){var t=KM[e];return t||Au(18,e),t}function $pe(e,t){KM[e]||(KM[e]=t)}function WM(){return _b}function j4(e,t){t&&(Hl("Patches"),e.u=[],e.s=[],e.v=t)}function h_(e){XM(e),e.p.forEach(Wpe),e.p=null}function XM(e){e===_b&&(_b=e.l)}function pB(e){return _b={p:[],l:_b,h:e,m:!0,_:0}}function Wpe(e){var t=e[ii];t.i===0||t.i===1?t.j():t.g=!0}function z4(e,t){t._=t.p.length;var r=t.p[0],n=e!==void 0&&e!==r;return t.h.O||Hl("ES5").S(t,e,n),n?(r[ii].P&&(h_(t),Au(4)),ad(e)&&(e=p_(t,e),t.l||v_(t,e)),t.u&&Hl("Patches").M(r[ii].t,e,t.u,t.s)):e=p_(t,r,[]),h_(t),t.u&&t.v(t.u,t.s),e!==LX?e:void 0}function p_(e,t,r){if(PO(t))return t;var n=t[ii];if(!n)return bv(t,function(s,u){return vB(e,n,t,s,u,r)},!0),t;if(n.A!==e)return t;if(!n.P)return v_(e,n.t,!0),n.t;if(!n.I){n.I=!0,n.A._--;var i=n.i===4||n.i===5?n.o=EO(n.k):n.o,a=i,o=!1;n.i===3&&(a=new Set(i),i.clear(),o=!0),bv(a,function(s,u){return vB(e,n,i,s,u,r,o)}),v_(e,i,!1),r&&e.u&&Hl("Patches").N(n,r,e.u,e.s)}return n.o}function vB(e,t,r,n,i,a,o){if(Ch(i)){var s=p_(e,i,a&&t&&t.i!==3&&!Mg(t.R,n)?a.concat(n):void 0);if(OX(r,n,s),!Ch(s))return;e.m=!1}else o&&r.add(i);if(ad(i)&&!PO(i)){if(!e.h.D&&e._<1)return;p_(e,i),t&&t.A.l||v_(e,i)}}function v_(e,t,r){r===void 0&&(r=!1),!e.l&&e.h.D&&e.m&&AO(t,r)}function V4(e,t){var r=e[ii];return(r?wp(r):e)[t]}function mB(e,t){if(t in e)for(var r=Object.getPrototypeOf(e);r;){var n=Object.getOwnPropertyDescriptor(r,t);if(n)return n;r=Object.getPrototypeOf(r)}}function Of(e){e.P||(e.P=!0,e.l&&Of(e.l))}function H4(e){e.o||(e.o=EO(e.t))}function YM(e,t,r){var n=_O(t)?Hl("MapSet").F(t,r):wO(t)?Hl("MapSet").T(t,r):e.O?function(i,a){var o=Array.isArray(i),s={i:o?1:0,A:a?a.A:WM(),P:!1,I:!1,R:{},l:a,t:i,k:null,o:null,j:null,C:!1},u=s,l=wb;o&&(u=[s],l=n1);var c=Proxy.revocable(u,l),d=c.revoke,f=c.proxy;return s.k=f,s.j=d,f}(t,r):Hl("ES5").J(t,r);return(r?r.A:WM()).p.push(n),n}function Xpe(e){return Ch(e)||Au(22,e),function t(r){if(!ad(r))return r;var n,i=r[ii],a=D0(r);if(i){if(!i.P&&(i.i<4||!Hl("ES5").K(i)))return i.t;i.I=!0,n=gB(r,a),i.I=!1}else n=gB(r,a);return bv(n,function(o,s){i&&Gpe(i.t,o)===s||OX(n,o,t(s))}),a===3?new Set(n):n}(e)}function gB(e,t){switch(t){case 2:return new Map(e);case 3:return Array.from(e)}return EO(e)}function Ype(){function e(a,o){var s=i[a];return s?s.enumerable=o:i[a]=s={configurable:!0,enumerable:o,get:function(){var u=this[ii];return wb.get(u,a)},set:function(u){var l=this[ii];wb.set(l,a,u)}},s}function t(a){for(var o=a.length-1;o>=0;o--){var s=a[o][ii];if(!s.P)switch(s.i){case 5:n(s)&&Of(s);break;case 4:r(s)&&Of(s)}}}function r(a){for(var o=a.t,s=a.k,u=Dg(s),l=u.length-1;l>=0;l--){var c=u[l];if(c!==ii){var d=o[c];if(d===void 0&&!Mg(o,c))return!0;var f=s[c],h=f&&f[ii];if(h?h.t!==d:!FX(f,d))return!0}}var v=!!o[ii];return u.length!==Dg(o).length+(v?0:1)}function n(a){var o=a.k;if(o.length!==a.t.length)return!0;var s=Object.getOwnPropertyDescriptor(o,o.length-1);if(s&&!s.get)return!0;for(var u=0;u<o.length;u++)if(!o.hasOwnProperty(u))return!0;return!1}var i={};$pe("ES5",{J:function(a,o){var s=Array.isArray(a),u=function(c,d){if(c){for(var f=Array(d.length),h=0;h<d.length;h++)Object.defineProperty(f,""+h,e(h,!0));return f}var v=NX(d);delete v[ii];for(var p=Dg(v),m=0;m<p.length;m++){var g=p[m];v[g]=e(g,c||!!v[g].enumerable)}return Object.create(Object.getPrototypeOf(d),v)}(s,a),l={i:s?5:4,A:o?o.A:WM(),P:!1,I:!1,R:{},l:o,t:a,k:u,o:null,g:!1,C:!1};return Object.defineProperty(u,ii,{value:l,writable:!0}),u},S:function(a,o,s){s?Ch(o)&&o[ii].A===a&&t(a.p):(a.u&&function u(l){if(l&&typeof l=="object"){var c=l[ii];if(c){var d=c.t,f=c.k,h=c.R,v=c.i;if(v===4)bv(f,function(b){b!==ii&&(d[b]!==void 0||Mg(d,b)?h[b]||u(f[b]):(h[b]=!0,Of(c)))}),bv(d,function(b){f[b]!==void 0||Mg(f,b)||(h[b]=!1,Of(c))});else if(v===5){if(n(c)&&(Of(c),h.length=!0),f.length<d.length)for(var p=f.length;p<d.length;p++)h[p]=!1;else for(var m=d.length;m<f.length;m++)h[m]=!0;for(var g=Math.min(f.length,d.length),y=0;y<g;y++)f.hasOwnProperty(y)||(h[y]=!0),h[y]===void 0&&u(f[y])}}}}(a.p[0]),t(a.p))},K:function(a){return a.i===4?r(a):n(a)}})}var yB,_b,TO=typeof Symbol<"u"&&typeof Symbol("x")=="symbol",Kpe=typeof Map<"u",Qpe=typeof Set<"u",bB=typeof Proxy<"u"&&Proxy.revocable!==void 0&&typeof Reflect<"u",LX=TO?Symbol.for("immer-nothing"):((yB={})["immer-nothing"]=!0,yB),xB=TO?Symbol.for("immer-draftable"):"__$immer_draftable",ii=TO?Symbol.for("immer-state"):"__$immer_state",Zpe=""+Object.prototype.constructor,Dg=typeof Reflect<"u"&&Reflect.ownKeys?Reflect.ownKeys:Object.getOwnPropertySymbols!==void 0?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:Object.getOwnPropertyNames,NX=Object.getOwnPropertyDescriptors||function(e){var t={};return Dg(e).forEach(function(r){t[r]=Object.getOwnPropertyDescriptor(e,r)}),t},KM={},wb={get:function(e,t){if(t===ii)return e;var r=wp(e);if(!Mg(r,t))return function(i,a,o){var s,u=mB(a,o);return u?"value"in u?u.value:(s=u.get)===null||s===void 0?void 0:s.call(i.k):void 0}(e,r,t);var n=r[t];return e.I||!ad(n)?n:n===V4(e.t,t)?(H4(e),e.o[t]=YM(e.A.h,n,e)):n},has:function(e,t){return t in wp(e)},ownKeys:function(e){return Reflect.ownKeys(wp(e))},set:function(e,t,r){var n=mB(wp(e),t);if(n!=null&&n.set)return n.set.call(e.k,r),!0;if(!e.P){var i=V4(wp(e),t),a=i==null?void 0:i[ii];if(a&&a.t===r)return e.o[t]=r,e.R[t]=!1,!0;if(FX(r,i)&&(r!==void 0||Mg(e.t,t)))return!0;H4(e),Of(e)}return e.o[t]===r&&(r!==void 0||t in e.o)||Number.isNaN(r)&&Number.isNaN(e.o[t])||(e.o[t]=r,e.R[t]=!0),!0},deleteProperty:function(e,t){return V4(e.t,t)!==void 0||t in e.t?(e.R[t]=!1,H4(e),Of(e)):delete e.R[t],e.o&&delete e.o[t],!0},getOwnPropertyDescriptor:function(e,t){var r=wp(e),n=Reflect.getOwnPropertyDescriptor(r,t);return n&&{writable:!0,configurable:e.i!==1||t!=="length",enumerable:n.enumerable,value:r[t]}},defineProperty:function(){Au(11)},getPrototypeOf:function(e){return Object.getPrototypeOf(e.t)},setPrototypeOf:function(){Au(12)}},n1={};bv(wb,function(e,t){n1[e]=function(){return arguments[0]=arguments[0][0],t.apply(this,arguments)}}),n1.deleteProperty=function(e,t){return n1.set.call(this,e,t,void 0)},n1.set=function(e,t,r){return wb.set.call(this,e[0],t,r,e[0])};var Jpe=function(){function e(r){var n=this;this.O=bB,this.D=!0,this.produce=function(i,a,o){if(typeof i=="function"&&typeof a!="function"){var s=a;a=i;var u=n;return function(p){var m=this;p===void 0&&(p=s);for(var g=arguments.length,y=Array(g>1?g-1:0),b=1;b<g;b++)y[b-1]=arguments[b];return u.produce(p,function(S){var x;return(x=a).call.apply(x,[m,S].concat(y))})}}var l;if(typeof a!="function"&&Au(6),o!==void 0&&typeof o!="function"&&Au(7),ad(i)){var c=pB(n),d=YM(n,i,void 0),f=!0;try{l=a(d),f=!1}finally{f?h_(c):XM(c)}return typeof Promise<"u"&&l instanceof Promise?l.then(function(p){return j4(c,o),z4(p,c)},function(p){throw h_(c),p}):(j4(c,o),z4(l,c))}if(!i||typeof i!="object"){if((l=a(i))===void 0&&(l=i),l===LX&&(l=void 0),n.D&&AO(l,!0),o){var h=[],v=[];Hl("Patches").M(i,l,h,v),o(h,v)}return l}Au(21,i)},this.produceWithPatches=function(i,a){if(typeof i=="function")return function(l){for(var c=arguments.length,d=Array(c>1?c-1:0),f=1;f<c;f++)d[f-1]=arguments[f];return n.produceWithPatches(l,function(h){return i.apply(void 0,[h].concat(d))})};var o,s,u=n.produce(i,a,function(l,c){o=l,s=c});return typeof Promise<"u"&&u instanceof Promise?u.then(function(l){return[l,o,s]}):[u,o,s]},typeof(r==null?void 0:r.useProxies)=="boolean"&&this.setUseProxies(r.useProxies),typeof(r==null?void 0:r.autoFreeze)=="boolean"&&this.setAutoFreeze(r.autoFreeze)}var t=e.prototype;return t.createDraft=function(r){ad(r)||Au(8),Ch(r)&&(r=Xpe(r));var n=pB(this),i=YM(this,r,void 0);return i[ii].C=!0,XM(n),i},t.finishDraft=function(r,n){var i=r&&r[ii],a=i.A;return j4(a,n),z4(void 0,a)},t.setAutoFreeze=function(r){this.D=r},t.setUseProxies=function(r){r&&!bB&&Au(20),this.O=r},t.applyPatches=function(r,n){var i;for(i=n.length-1;i>=0;i--){var a=n[i];if(a.path.length===0&&a.op==="replace"){r=a.value;break}}i>-1&&(n=n.slice(i+1));var o=Hl("Patches").$;return Ch(r)?o(r,n):this.produce(r,function(s){return o(s,n)})},e}(),ss=new Jpe,BX=ss.produce;ss.produceWithPatches.bind(ss);ss.setAutoFreeze.bind(ss);ss.setUseProxies.bind(ss);ss.applyPatches.bind(ss);ss.createDraft.bind(ss);ss.finishDraft.bind(ss);function xv(e){"@babel/helpers - typeof";return xv=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},xv(e)}function eve(e,t){if(xv(e)!=="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(xv(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function UX(e){var t=eve(e,"string");return xv(t)==="symbol"?t:String(t)}function i1(e,t,r){return t=UX(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function SB(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function gr(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?SB(Object(r),!0).forEach(function(n){i1(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):SB(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function ka(e){return"Minified Redux error #"+e+"; visit https://redux.js.org/Errors?code="+e+" for the full message or use the non-minified dev environment for full errors. "}var CB=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}(),G4=function(){return Math.random().toString(36).substring(7).split("").join(".")},m_={INIT:"@@redux/INIT"+G4(),REPLACE:"@@redux/REPLACE"+G4(),PROBE_UNKNOWN_ACTION:function(){return"@@redux/PROBE_UNKNOWN_ACTION"+G4()}};function tve(e){if(typeof e!="object"||e===null)return!1;for(var t=e;Object.getPrototypeOf(t)!==null;)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}function jX(e,t,r){var n;if(typeof t=="function"&&typeof r=="function"||typeof r=="function"&&typeof arguments[3]=="function")throw new Error(ka(0));if(typeof t=="function"&&typeof r>"u"&&(r=t,t=void 0),typeof r<"u"){if(typeof r!="function")throw new Error(ka(1));return r(jX)(e,t)}if(typeof e!="function")throw new Error(ka(2));var i=e,a=t,o=[],s=o,u=!1;function l(){s===o&&(s=o.slice())}function c(){if(u)throw new Error(ka(3));return a}function d(p){if(typeof p!="function")throw new Error(ka(4));if(u)throw new Error(ka(5));var m=!0;return l(),s.push(p),function(){if(m){if(u)throw new Error(ka(6));m=!1,l();var y=s.indexOf(p);s.splice(y,1),o=null}}}function f(p){if(!tve(p))throw new Error(ka(7));if(typeof p.type>"u")throw new Error(ka(8));if(u)throw new Error(ka(9));try{u=!0,a=i(a,p)}finally{u=!1}for(var m=o=s,g=0;g<m.length;g++){var y=m[g];y()}return p}function h(p){if(typeof p!="function")throw new Error(ka(10));i=p,f({type:m_.REPLACE})}function v(){var p,m=d;return p={subscribe:function(y){if(typeof y!="object"||y===null)throw new Error(ka(11));function b(){y.next&&y.next(c())}b();var S=m(b);return{unsubscribe:S}}},p[CB]=function(){return this},p}return f({type:m_.INIT}),n={dispatch:f,subscribe:d,getState:c,replaceReducer:h},n[CB]=v,n}function rve(e){Object.keys(e).forEach(function(t){var r=e[t],n=r(void 0,{type:m_.INIT});if(typeof n>"u")throw new Error(ka(12));if(typeof r(void 0,{type:m_.PROBE_UNKNOWN_ACTION()})>"u")throw new Error(ka(13))})}function nve(e){for(var t=Object.keys(e),r={},n=0;n<t.length;n++){var i=t[n];typeof e[i]=="function"&&(r[i]=e[i])}var a=Object.keys(r),o;try{rve(r)}catch(s){o=s}return function(u,l){if(u===void 0&&(u={}),o)throw o;for(var c=!1,d={},f=0;f<a.length;f++){var h=a[f],v=r[h],p=u[h],m=v(p,l);if(typeof m>"u")throw l&&l.type,new Error(ka(14));d[h]=m,c=c||m!==p}return c=c||a.length!==Object.keys(u).length,c?d:u}}function g_(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return t.length===0?function(n){return n}:t.length===1?t[0]:t.reduce(function(n,i){return function(){return n(i.apply(void 0,arguments))}})}function ive(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return function(n){return function(){var i=n.apply(void 0,arguments),a=function(){throw new Error(ka(15))},o={getState:i.getState,dispatch:function(){return a.apply(void 0,arguments)}},s=t.map(function(u){return u(o)});return a=g_.apply(void 0,s)(i.dispatch),gr(gr({},i),{},{dispatch:a})}}}function zX(e){var t=function(n){var i=n.dispatch,a=n.getState;return function(o){return function(s){return typeof s=="function"?s(i,a,e):o(s)}}};return t}var VX=zX();VX.withExtraArgument=zX;const QM=VX;var HX=globalThis&&globalThis.__extends||function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(n[a]=i[a])},e(t,r)};return function(t,r){if(typeof r!="function"&&r!==null)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");e(t,r);function n(){this.constructor=t}t.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}}(),ave=globalThis&&globalThis.__generator||function(e,t){var r={label:0,sent:function(){if(a[0]&1)throw a[1];return a[1]},trys:[],ops:[]},n,i,a,o;return o={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function s(l){return function(c){return u([l,c])}}function u(l){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,i&&(a=l[0]&2?i.return:l[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,l[1])).done)return a;switch(i=0,a&&(l=[l[0]&2,a.value]),l[0]){case 0:case 1:a=l;break;case 4:return r.label++,{value:l[1],done:!1};case 5:r.label++,i=l[1],l=[0];continue;case 7:l=r.ops.pop(),r.trys.pop();continue;default:if(a=r.trys,!(a=a.length>0&&a[a.length-1])&&(l[0]===6||l[0]===2)){r=0;continue}if(l[0]===3&&(!a||l[1]>a[0]&&l[1]<a[3])){r.label=l[1];break}if(l[0]===6&&r.label<a[1]){r.label=a[1],a=l;break}if(a&&r.label<a[2]){r.label=a[2],r.ops.push(l);break}a[2]&&r.ops.pop(),r.trys.pop();continue}l=t.call(e,r)}catch(c){l=[6,c],i=0}finally{n=a=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}},t0=globalThis&&globalThis.__spreadArray||function(e,t){for(var r=0,n=t.length,i=e.length;r<n;r++,i++)e[i]=t[r];return e},ove=Object.defineProperty,sve=Object.defineProperties,uve=Object.getOwnPropertyDescriptors,_B=Object.getOwnPropertySymbols,lve=Object.prototype.hasOwnProperty,cve=Object.prototype.propertyIsEnumerable,wB=function(e,t,r){return t in e?ove(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r},dh=function(e,t){for(var r in t||(t={}))lve.call(t,r)&&wB(e,r,t[r]);if(_B)for(var n=0,i=_B(t);n<i.length;n++){var r=i[n];cve.call(t,r)&&wB(e,r,t[r])}return e},q4=function(e,t){return sve(e,uve(t))},dve=function(e,t,r){return new Promise(function(n,i){var a=function(u){try{s(r.next(u))}catch(l){i(l)}},o=function(u){try{s(r.throw(u))}catch(l){i(l)}},s=function(u){return u.done?n(u.value):Promise.resolve(u.value).then(a,o)};s((r=r.apply(e,t)).next())})},fve=typeof window<"u"&&window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__?window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__:function(){if(arguments.length!==0)return typeof arguments[0]=="object"?g_:g_.apply(null,arguments)};function hve(e){if(typeof e!="object"||e===null)return!1;var t=Object.getPrototypeOf(e);if(t===null)return!0;for(var r=t;Object.getPrototypeOf(r)!==null;)r=Object.getPrototypeOf(r);return t===r}var pve=function(e){HX(t,e);function t(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];var i=e.apply(this,r)||this;return Object.setPrototypeOf(i,t.prototype),i}return Object.defineProperty(t,Symbol.species,{get:function(){return t},enumerable:!1,configurable:!0}),t.prototype.concat=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];return e.prototype.concat.apply(this,r)},t.prototype.prepend=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];return r.length===1&&Array.isArray(r[0])?new(t.bind.apply(t,t0([void 0],r[0].concat(this)))):new(t.bind.apply(t,t0([void 0],r.concat(this))))},t}(Array),vve=function(e){HX(t,e);function t(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];var i=e.apply(this,r)||this;return Object.setPrototypeOf(i,t.prototype),i}return Object.defineProperty(t,Symbol.species,{get:function(){return t},enumerable:!1,configurable:!0}),t.prototype.concat=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];return e.prototype.concat.apply(this,r)},t.prototype.prepend=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];return r.length===1&&Array.isArray(r[0])?new(t.bind.apply(t,t0([void 0],r[0].concat(this)))):new(t.bind.apply(t,t0([void 0],r.concat(this))))},t}(Array);function ZM(e){return ad(e)?BX(e,function(){}):e}function mve(e){return typeof e=="boolean"}function gve(){return function(t){return yve(t)}}function yve(e){e===void 0&&(e={});var t=e.thunk,r=t===void 0?!0:t;e.immutableCheck,e.serializableCheck;var n=new pve;return r&&(mve(r)?n.push(QM):n.push(QM.withExtraArgument(r.extraArgument))),n}var bve=!0;function xve(e){var t=gve(),r=e||{},n=r.reducer,i=n===void 0?void 0:n,a=r.middleware,o=a===void 0?t():a,s=r.devTools,u=s===void 0?!0:s,l=r.preloadedState,c=l===void 0?void 0:l,d=r.enhancers,f=d===void 0?void 0:d,h;if(typeof i=="function")h=i;else if(hve(i))h=nve(i);else throw new Error('"reducer" is a required argument, and must be a function or an object of functions that can be passed to combineReducers');var v=o;typeof v=="function"&&(v=v(t));var p=ive.apply(void 0,v),m=g_;u&&(m=fve(dh({trace:!bve},typeof u=="object"&&u)));var g=new vve(p),y=g;Array.isArray(f)?y=t0([p],f):typeof f=="function"&&(y=f(g));var b=m.apply(void 0,y);return jX(h,c,b)}function fh(e,t){function r(){for(var n=[],i=0;i<arguments.length;i++)n[i]=arguments[i];if(t){var a=t.apply(void 0,n);if(!a)throw new Error("prepareAction did not return an object");return dh(dh({type:e,payload:a.payload},"meta"in a&&{meta:a.meta}),"error"in a&&{error:a.error})}return{type:e,payload:n[0]}}return r.toString=function(){return""+e},r.type=e,r.match=function(n){return n.type===e},r}function GX(e){var t={},r=[],n,i={addCase:function(a,o){var s=typeof a=="string"?a:a.type;if(s in t)throw new Error("addCase cannot be called with two reducers for the same action type");return t[s]=o,i},addMatcher:function(a,o){return r.push({matcher:a,reducer:o}),i},addDefaultCase:function(a){return n=a,i}};return e(i),[t,r,n]}function Sve(e){return typeof e=="function"}function Cve(e,t,r,n){r===void 0&&(r=[]);var i=typeof t=="function"?GX(t):[t,r,n],a=i[0],o=i[1],s=i[2],u;if(Sve(e))u=function(){return ZM(e())};else{var l=ZM(e);u=function(){return l}}function c(d,f){d===void 0&&(d=u());var h=t0([a[f.type]],o.filter(function(v){var p=v.matcher;return p(f)}).map(function(v){var p=v.reducer;return p}));return h.filter(function(v){return!!v}).length===0&&(h=[s]),h.reduce(function(v,p){if(p)if(Ch(v)){var m=v,g=p(m,f);return g===void 0?v:g}else{if(ad(v))return BX(v,function(y){return p(y,f)});var g=p(v,f);if(g===void 0){if(v===null)return v;throw Error("A case reducer on a non-draftable value must not return undefined")}return g}return v},d)}return c.getInitialState=u,c}function _ve(e,t){return e+"/"+t}function wve(e){var t=e.name;if(!t)throw new Error("`name` is a required option for createSlice");typeof process<"u";var r=typeof e.initialState=="function"?e.initialState:ZM(e.initialState),n=e.reducers||{},i=Object.keys(n),a={},o={},s={};i.forEach(function(c){var d=n[c],f=_ve(t,c),h,v;"reducer"in d?(h=d.reducer,v=d.prepare):h=d,a[c]=h,o[f]=h,s[c]=v?fh(f,v):fh(f)});function u(){var c=typeof e.extraReducers=="function"?GX(e.extraReducers):[e.extraReducers],d=c[0],f=d===void 0?{}:d,h=c[1],v=h===void 0?[]:h,p=c[2],m=p===void 0?void 0:p,g=dh(dh({},f),o);return Cve(r,function(y){for(var b in g)y.addCase(b,g[b]);for(var S=0,x=v;S<x.length;S++){var C=x[S];y.addMatcher(C.matcher,C.reducer)}m&&y.addDefaultCase(m)})}var l;return{name:t,reducer:function(c,d){return l||(l=u()),l(c,d)},actions:s,caseReducers:a,getInitialState:function(){return l||(l=u()),l.getInitialState()}}}var Eve="ModuleSymbhasOwnPr-0123456789ABCDEFGHNRVfgctiUvz_KqYTJkLxpZXIjQW",Ave=function(e){e===void 0&&(e=21);for(var t="",r=e;r--;)t+=Eve[Math.random()*64|0];return t},Pve=["name","message","stack","code"],$4=function(){function e(t,r){this.payload=t,this.meta=r}return e}(),EB=function(){function e(t,r){this.payload=t,this.meta=r}return e}(),Tve=function(e){if(typeof e=="object"&&e!==null){for(var t={},r=0,n=Pve;r<n.length;r++){var i=n[r];typeof e[i]=="string"&&(t[i]=e[i])}return t}return{message:String(e)}};(function(){function e(t,r,n){var i=fh(t+"/fulfilled",function(l,c,d,f){return{payload:l,meta:q4(dh({},f||{}),{arg:d,requestId:c,requestStatus:"fulfilled"})}}),a=fh(t+"/pending",function(l,c,d){return{payload:void 0,meta:q4(dh({},d||{}),{arg:c,requestId:l,requestStatus:"pending"})}}),o=fh(t+"/rejected",function(l,c,d,f,h){return{payload:f,error:(n&&n.serializeError||Tve)(l||"Rejected"),meta:q4(dh({},h||{}),{arg:d,requestId:c,rejectedWithValue:!!f,requestStatus:"rejected",aborted:(l==null?void 0:l.name)==="AbortError",condition:(l==null?void 0:l.name)==="ConditionError"})}}),s=typeof AbortController<"u"?AbortController:function(){function l(){this.signal={aborted:!1,addEventListener:function(){},dispatchEvent:function(){return!1},onabort:function(){},removeEventListener:function(){},reason:void 0,throwIfAborted:function(){}}}return l.prototype.abort=function(){},l}();function u(l){return function(c,d,f){var h=n!=null&&n.idGenerator?n.idGenerator(l):Ave(),v=new s,p;function m(y){p=y,v.abort()}var g=function(){return dve(this,null,function(){var y,b,S,x,C,w,A;return ave(this,function(M){switch(M.label){case 0:return M.trys.push([0,4,,5]),x=(y=n==null?void 0:n.condition)==null?void 0:y.call(n,l,{getState:d,extra:f}),Mve(x)?[4,x]:[3,2];case 1:x=M.sent(),M.label=2;case 2:if(x===!1||v.signal.aborted)throw{name:"ConditionError",message:"Aborted due to condition callback returning false."};return C=new Promise(function(D,k){return v.signal.addEventListener("abort",function(){return k({name:"AbortError",message:p||"Aborted"})})}),c(a(h,l,(b=n==null?void 0:n.getPendingMeta)==null?void 0:b.call(n,{requestId:h,arg:l},{getState:d,extra:f}))),[4,Promise.race([C,Promise.resolve(r(l,{dispatch:c,getState:d,extra:f,requestId:h,signal:v.signal,abort:m,rejectWithValue:function(D,k){return new $4(D,k)},fulfillWithValue:function(D,k){return new EB(D,k)}})).then(function(D){if(D instanceof $4)throw D;return D instanceof EB?i(D.payload,h,l,D.meta):i(D,h,l)})])];case 3:return S=M.sent(),[3,5];case 4:return w=M.sent(),S=w instanceof $4?o(null,h,l,w.payload,w.meta):o(w,h,l),[3,5];case 5:return A=n&&!n.dispatchConditionRejection&&o.match(S)&&S.meta.condition,A||c(S),[2,S]}})})}();return Object.assign(g,{abort:m,requestId:h,arg:l,unwrap:function(){return g.then(Ive)}})}}return Object.assign(u,{pending:a,rejected:o,fulfilled:i,typePrefix:t})}return e.withTypes=function(){return e},e})();function Ive(e){if(e.meta&&e.meta.rejectedWithValue)throw e.payload;if(e.error)throw e.error;return e.payload}function Mve(e){return e!==null&&typeof e=="object"&&typeof e.then=="function"}var IO="listenerMiddleware";fh(IO+"/add");fh(IO+"/removeAll");fh(IO+"/remove");var AB;typeof queueMicrotask=="function"&&queueMicrotask.bind(typeof window<"u"?window:typeof global<"u"?global:globalThis);Ype();const Dve={searchString:"",searchFilters:{geneName:"",organism:[],sequenceLengthMin:"",sequenceLengthMax:"",annotationScore:"",proteinWith:[]},searchResults:{searchString:"",nextLink:"",totalResults:-1,items:[]},searchFacets:{organisms:[],proteinsWith:[]},proteinCache:{}},qX=wve({name:"items",initialState:Dve,reducers:{fetchItems:(e,t)=>(e.searchResults=t.payload,e),fetchFacets:(e,t)=>(e.searchFacets=t.payload,e),appendItems:(e,t)=>(e.searchResults.nextLink=t.payload.nextLink,e.searchResults.items.push(...t.payload.items),e),setSearchFilters:(e,t)=>(e.searchFilters=t.payload,e),fetchProtein:(e,t)=>(e.proteinCache={...e.proteinCache,[t.payload.id]:t.payload},e),fetchProteinPublications:(e,t)=>(t.payload.proteinId in e.proteinCache&&(e.proteinCache[t.payload.proteinId].publications=t.payload.publications),e)}}),{fetchItems:Rve,fetchFacets:kve,appendItems:Ove,setSearchFilters:Fve,fetchProtein:Lve,fetchProteinPublications:Nve}=qX.actions,Bve=qX.reducer;var $X={exports:{}},WX={};/**
 * @license React
 * use-sync-external-store-shim.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var r0=_e;function Uve(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var jve=typeof Object.is=="function"?Object.is:Uve,zve=r0.useState,Vve=r0.useEffect,Hve=r0.useLayoutEffect,Gve=r0.useDebugValue;function qve(e,t){var r=t(),n=zve({inst:{value:r,getSnapshot:t}}),i=n[0].inst,a=n[1];return Hve(function(){i.value=r,i.getSnapshot=t,W4(i)&&a({inst:i})},[e,r,t]),Vve(function(){return W4(i)&&a({inst:i}),e(function(){W4(i)&&a({inst:i})})},[e]),Gve(r),r}function W4(e){var t=e.getSnapshot;e=e.value;try{var r=t();return!jve(e,r)}catch{return!0}}function $ve(e,t){return t()}var Wve=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?$ve:qve;WX.useSyncExternalStore=r0.useSyncExternalStore!==void 0?r0.useSyncExternalStore:Wve;$X.exports=WX;var Xve=$X.exports,XX={exports:{}},YX={};/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var N3=_e,Yve=Xve;function Kve(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var Qve=typeof Object.is=="function"?Object.is:Kve,Zve=Yve.useSyncExternalStore,Jve=N3.useRef,eme=N3.useEffect,tme=N3.useMemo,rme=N3.useDebugValue;YX.useSyncExternalStoreWithSelector=function(e,t,r,n,i){var a=Jve(null);if(a.current===null){var o={hasValue:!1,value:null};a.current=o}else o=a.current;a=tme(function(){function u(h){if(!l){if(l=!0,c=h,h=n(h),i!==void 0&&o.hasValue){var v=o.value;if(i(v,h))return d=v}return d=h}if(v=d,Qve(c,h))return v;var p=n(h);return i!==void 0&&i(v,p)?v:(c=h,d=p)}var l=!1,c,d,f=r===void 0?null:r;return[function(){return u(t())},f===null?void 0:function(){return u(f())}]},[t,r,n,i]);var s=Zve(e,a[0],a[1]);return eme(function(){o.hasValue=!0,o.value=s},[s]),rme(s),s};XX.exports=YX;var nme=XX.exports;function ime(e){e()}let KX=ime;const ame=e=>KX=e,ome=()=>KX,_h=_e.createContext(null);function QX(){return _e.useContext(_h)}const sme=()=>{throw new Error("uSES not initialized!")};let ZX=sme;const ume=e=>{ZX=e},lme=(e,t)=>e===t;function cme(e=_h){const t=e===_h?QX:()=>_e.useContext(e);return function(n,i=lme){const{store:a,subscription:o,getServerState:s}=t(),u=ZX(o.addNestedSub,a.getState,s||a.getState,n,i);return _e.useDebugValue(u),u}}const Sv=cme();function vr(){return vr=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},vr.apply(this,arguments)}function dme(e,t){if(e==null)return{};var r={},n=Object.keys(e),i,a;for(a=0;a<n.length;a++)i=n[a],!(t.indexOf(i)>=0)&&(r[i]=e[i]);return r}var JX={exports:{}},In={};/** @license React v16.13.1
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var pa=typeof Symbol=="function"&&Symbol.for,MO=pa?Symbol.for("react.element"):60103,DO=pa?Symbol.for("react.portal"):60106,B3=pa?Symbol.for("react.fragment"):60107,U3=pa?Symbol.for("react.strict_mode"):60108,j3=pa?Symbol.for("react.profiler"):60114,z3=pa?Symbol.for("react.provider"):60109,V3=pa?Symbol.for("react.context"):60110,RO=pa?Symbol.for("react.async_mode"):60111,H3=pa?Symbol.for("react.concurrent_mode"):60111,G3=pa?Symbol.for("react.forward_ref"):60112,q3=pa?Symbol.for("react.suspense"):60113,fme=pa?Symbol.for("react.suspense_list"):60120,$3=pa?Symbol.for("react.memo"):60115,W3=pa?Symbol.for("react.lazy"):60116,hme=pa?Symbol.for("react.block"):60121,pme=pa?Symbol.for("react.fundamental"):60117,vme=pa?Symbol.for("react.responder"):60118,mme=pa?Symbol.for("react.scope"):60119;function ys(e){if(typeof e=="object"&&e!==null){var t=e.$$typeof;switch(t){case MO:switch(e=e.type,e){case RO:case H3:case B3:case j3:case U3:case q3:return e;default:switch(e=e&&e.$$typeof,e){case V3:case G3:case W3:case $3:case z3:return e;default:return t}}case DO:return t}}}function eY(e){return ys(e)===H3}In.AsyncMode=RO;In.ConcurrentMode=H3;In.ContextConsumer=V3;In.ContextProvider=z3;In.Element=MO;In.ForwardRef=G3;In.Fragment=B3;In.Lazy=W3;In.Memo=$3;In.Portal=DO;In.Profiler=j3;In.StrictMode=U3;In.Suspense=q3;In.isAsyncMode=function(e){return eY(e)||ys(e)===RO};In.isConcurrentMode=eY;In.isContextConsumer=function(e){return ys(e)===V3};In.isContextProvider=function(e){return ys(e)===z3};In.isElement=function(e){return typeof e=="object"&&e!==null&&e.$$typeof===MO};In.isForwardRef=function(e){return ys(e)===G3};In.isFragment=function(e){return ys(e)===B3};In.isLazy=function(e){return ys(e)===W3};In.isMemo=function(e){return ys(e)===$3};In.isPortal=function(e){return ys(e)===DO};In.isProfiler=function(e){return ys(e)===j3};In.isStrictMode=function(e){return ys(e)===U3};In.isSuspense=function(e){return ys(e)===q3};In.isValidElementType=function(e){return typeof e=="string"||typeof e=="function"||e===B3||e===H3||e===j3||e===U3||e===q3||e===fme||typeof e=="object"&&e!==null&&(e.$$typeof===W3||e.$$typeof===$3||e.$$typeof===z3||e.$$typeof===V3||e.$$typeof===G3||e.$$typeof===pme||e.$$typeof===vme||e.$$typeof===mme||e.$$typeof===hme)};In.typeOf=ys;JX.exports=In;var gme=JX.exports,tY=gme,yme={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},bme={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},rY={};rY[tY.ForwardRef]=yme;rY[tY.Memo]=bme;var kn={};/**
 * @license React
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var kO=Symbol.for("react.element"),OO=Symbol.for("react.portal"),X3=Symbol.for("react.fragment"),Y3=Symbol.for("react.strict_mode"),K3=Symbol.for("react.profiler"),Q3=Symbol.for("react.provider"),Z3=Symbol.for("react.context"),xme=Symbol.for("react.server_context"),J3=Symbol.for("react.forward_ref"),eE=Symbol.for("react.suspense"),tE=Symbol.for("react.suspense_list"),rE=Symbol.for("react.memo"),nE=Symbol.for("react.lazy"),Sme=Symbol.for("react.offscreen"),nY;nY=Symbol.for("react.module.reference");function ru(e){if(typeof e=="object"&&e!==null){var t=e.$$typeof;switch(t){case kO:switch(e=e.type,e){case X3:case K3:case Y3:case eE:case tE:return e;default:switch(e=e&&e.$$typeof,e){case xme:case Z3:case J3:case nE:case rE:case Q3:return e;default:return t}}case OO:return t}}}kn.ContextConsumer=Z3;kn.ContextProvider=Q3;kn.Element=kO;kn.ForwardRef=J3;kn.Fragment=X3;kn.Lazy=nE;kn.Memo=rE;kn.Portal=OO;kn.Profiler=K3;kn.StrictMode=Y3;kn.Suspense=eE;kn.SuspenseList=tE;kn.isAsyncMode=function(){return!1};kn.isConcurrentMode=function(){return!1};kn.isContextConsumer=function(e){return ru(e)===Z3};kn.isContextProvider=function(e){return ru(e)===Q3};kn.isElement=function(e){return typeof e=="object"&&e!==null&&e.$$typeof===kO};kn.isForwardRef=function(e){return ru(e)===J3};kn.isFragment=function(e){return ru(e)===X3};kn.isLazy=function(e){return ru(e)===nE};kn.isMemo=function(e){return ru(e)===rE};kn.isPortal=function(e){return ru(e)===OO};kn.isProfiler=function(e){return ru(e)===K3};kn.isStrictMode=function(e){return ru(e)===Y3};kn.isSuspense=function(e){return ru(e)===eE};kn.isSuspenseList=function(e){return ru(e)===tE};kn.isValidElementType=function(e){return typeof e=="string"||typeof e=="function"||e===X3||e===K3||e===Y3||e===eE||e===tE||e===Sme||typeof e=="object"&&e!==null&&(e.$$typeof===nE||e.$$typeof===rE||e.$$typeof===Q3||e.$$typeof===Z3||e.$$typeof===J3||e.$$typeof===nY||e.getModuleId!==void 0)};kn.typeOf=ru;function Cme(){const e=ome();let t=null,r=null;return{clear(){t=null,r=null},notify(){e(()=>{let n=t;for(;n;)n.callback(),n=n.next})},get(){let n=[],i=t;for(;i;)n.push(i),i=i.next;return n},subscribe(n){let i=!0,a=r={callback:n,next:null,prev:r};return a.prev?a.prev.next=a:t=a,function(){!i||t===null||(i=!1,a.next?a.next.prev=a.prev:r=a.prev,a.prev?a.prev.next=a.next:t=a.next)}}}}const PB={notify(){},get:()=>[]};function _me(e,t){let r,n=PB;function i(d){return u(),n.subscribe(d)}function a(){n.notify()}function o(){c.onStateChange&&c.onStateChange()}function s(){return!!r}function u(){r||(r=t?t.addNestedSub(o):e.subscribe(o),n=Cme())}function l(){r&&(r(),r=void 0,n.clear(),n=PB)}const c={addNestedSub:i,notifyNestedSubs:a,handleChangeWrapper:o,isSubscribed:s,trySubscribe:u,tryUnsubscribe:l,getListeners:()=>n};return c}const wme=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",Eme=wme?_e.useLayoutEffect:_e.useEffect;function Ame({store:e,context:t,children:r,serverState:n}){const i=_e.useMemo(()=>{const s=_me(e);return{store:e,subscription:s,getServerState:n?()=>n:void 0}},[e,n]),a=_e.useMemo(()=>e.getState(),[e]);Eme(()=>{const{subscription:s}=i;return s.onStateChange=s.notifyNestedSubs,s.trySubscribe(),a!==e.getState()&&s.notifyNestedSubs(),()=>{s.tryUnsubscribe(),s.onStateChange=void 0}},[i,a]);const o=t||_h;return Eo.createElement(o.Provider,{value:i},r)}function iY(e=_h){const t=e===_h?QX:()=>_e.useContext(e);return function(){const{store:n}=t();return n}}const Pme=iY();function Tme(e=_h){const t=e===_h?Pme:iY(e);return function(){return t().dispatch}}const Ime=Tme();ume(nme.useSyncExternalStoreWithSelector);ame(M3.unstable_batchedUpdates);var Wn={};function Mme(e){return!!(e&&typeof e.then=="function")}function y_(e){return e||(e=0),new Promise(function(t){return setTimeout(t,e)})}function Dme(e,t){return Math.floor(Math.random()*(t-e+1)+e)}function iE(){return Math.random().toString(36).substring(2)}var TB=0,X4=0;function aE(){var e=new Date().getTime();return e===TB?(X4++,e*1e3+X4):(TB=e,X4=0,e*1e3)}var g2=Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]",Rme=aE,kme="native";function Ome(e){var t={messagesCallback:null,bc:new BroadcastChannel(e),subFns:[]};return t.bc.onmessage=function(r){t.messagesCallback&&t.messagesCallback(r.data)},t}function Fme(e){e.bc.close(),e.subFns=[]}function Lme(e,t){try{return e.bc.postMessage(t,!1),Promise.resolve()}catch(r){return Promise.reject(r)}}function Nme(e,t){e.messagesCallback=t}function Bme(){if(g2&&typeof window>"u")return!1;if(typeof BroadcastChannel=="function"){if(BroadcastChannel._pubkey)throw new Error("BroadcastChannel: Do not overwrite window.BroadcastChannel with this module, this is not a polyfill");return!0}else return!1}function Ume(){return 150}const jme={create:Ome,close:Fme,onMessage:Nme,postMessage:Lme,canBeUsed:Bme,type:kme,averageResponseTime:Ume,microSeconds:Rme};var aY=function(){function e(t){this.ttl=t,this.set=new Set,this.timeMap=new Map}return e.prototype.has=function(t){return this.set.has(t)},e.prototype.add=function(t){var r=this;this.timeMap.set(t,oY()),this.set.add(t),setTimeout(function(){zme(r)},0)},e.prototype.clear=function(){this.set.clear(),this.timeMap.clear()},e}();function zme(e){for(var t=oY()-e.ttl,r=e.set[Symbol.iterator]();;){var n=r.next().value;if(!n)return;var i=e.timeMap.get(n);if(i<t)e.timeMap.delete(n),e.set.delete(n);else return}}function oY(){return new Date().getTime()}function oE(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=JSON.parse(JSON.stringify(e));return typeof t.webWorkerSupport>"u"&&(t.webWorkerSupport=!0),t.idb||(t.idb={}),t.idb.ttl||(t.idb.ttl=1e3*45),t.idb.fallbackInterval||(t.idb.fallbackInterval=150),e.idb&&typeof e.idb.onclose=="function"&&(t.idb.onclose=e.idb.onclose),t.localstorage||(t.localstorage={}),t.localstorage.removeTimeout||(t.localstorage.removeTimeout=1e3*60),e.methods&&(t.methods=e.methods),t.node||(t.node={}),t.node.ttl||(t.node.ttl=1e3*60*2),typeof t.node.useFastPath>"u"&&(t.node.useFastPath=!0),t}var Vme=aE,Hme="pubkey.broadcast-channel-0-",od="messages",Gme="idb";function sY(){if(typeof indexedDB<"u")return indexedDB;if(typeof window<"u"){if(typeof window.mozIndexedDB<"u")return window.mozIndexedDB;if(typeof window.webkitIndexedDB<"u")return window.webkitIndexedDB;if(typeof window.msIndexedDB<"u")return window.msIndexedDB}return!1}function qme(e){var t=sY(),r=Hme+e,n=t.open(r,1);n.onupgradeneeded=function(a){var o=a.target.result;o.createObjectStore(od,{keyPath:"id",autoIncrement:!0})};var i=new Promise(function(a,o){n.onerror=function(s){return o(s)},n.onsuccess=function(){a(n.result)}});return i}function $me(e,t,r){var n=new Date().getTime(),i={uuid:t,time:n,data:r},a=e.transaction([od],"readwrite");return new Promise(function(o,s){a.oncomplete=function(){return o()},a.onerror=function(l){return s(l)};var u=a.objectStore(od);u.add(i)})}function Wme(e,t){var r=e.transaction(od).objectStore(od),n=[];function i(){try{var a=IDBKeyRange.bound(t+1,1/0);return r.openCursor(a)}catch{return r.openCursor()}}return new Promise(function(a){i().onsuccess=function(o){var s=o.target.result;s?s.value.id<t+1?s.continue(t+1):(n.push(s.value),s.continue()):a(n)}})}function Xme(e,t){var r=e.transaction([od],"readwrite").objectStore(od).delete(t);return new Promise(function(n){r.onsuccess=function(){return n()}})}function Yme(e,t){var r=new Date().getTime()-t,n=e.transaction(od).objectStore(od),i=[];return new Promise(function(a){n.openCursor().onsuccess=function(o){var s=o.target.result;if(s){var u=s.value;if(u.time<r)i.push(u),s.continue();else{a(i);return}}else a(i)}})}function Kme(e,t){return Yme(e,t).then(function(r){return Promise.all(r.map(function(n){return Xme(e,n.id)}))})}function Qme(e,t){return t=oE(t),qme(e).then(function(r){var n={closed:!1,lastCursorId:0,channelName:e,options:t,uuid:iE(),eMIs:new aY(t.idb.ttl*2),writeBlockPromise:Promise.resolve(),messagesCallback:null,readQueuePromises:[],db:r};return r.onclose=function(){n.closed=!0,t.idb.onclose&&t.idb.onclose()},uY(n),n})}function uY(e){e.closed||lY(e).then(function(){return y_(e.options.idb.fallbackInterval)}).then(function(){return uY(e)})}function Zme(e,t){return!(e.uuid===t.uuid||t.eMIs.has(e.id)||e.data.time<t.messagesCallbackTime)}function lY(e){return e.closed||!e.messagesCallback?Promise.resolve():Wme(e.db,e.lastCursorId).then(function(t){var r=t.filter(function(n){return!!n}).map(function(n){return n.id>e.lastCursorId&&(e.lastCursorId=n.id),n}).filter(function(n){return Zme(n,e)}).sort(function(n,i){return n.time-i.time});return r.forEach(function(n){e.messagesCallback&&(e.eMIs.add(n.id),e.messagesCallback(n.data))}),Promise.resolve()})}function Jme(e){e.closed=!0,e.db.close()}function ege(e,t){return e.writeBlockPromise=e.writeBlockPromise.then(function(){return $me(e.db,e.uuid,t)}).then(function(){Dme(0,10)===0&&Kme(e.db,e.options.idb.ttl)}),e.writeBlockPromise}function tge(e,t,r){e.messagesCallbackTime=r,e.messagesCallback=t,lY(e)}function rge(){if(g2)return!1;var e=sY();return!!e}function nge(e){return e.idb.fallbackInterval*2}const ige={create:Qme,close:Jme,onMessage:tge,postMessage:ege,canBeUsed:rge,type:Gme,averageResponseTime:nge,microSeconds:Vme};var age=aE,oge="pubkey.broadcastChannel-",sge="localstorage";function cY(){var e;if(typeof window>"u")return null;try{e=window.localStorage,e=window["ie8-eventlistener/storage"]||window.localStorage}catch{}return e}function dY(e){return oge+e}function uge(e,t){return new Promise(function(r){y_().then(function(){var n=dY(e.channelName),i={token:iE(),time:new Date().getTime(),data:t,uuid:e.uuid},a=JSON.stringify(i);cY().setItem(n,a);var o=document.createEvent("Event");o.initEvent("storage",!0,!0),o.key=n,o.newValue=a,window.dispatchEvent(o),r()})})}function lge(e,t){var r=dY(e),n=function(a){a.key===r&&t(JSON.parse(a.newValue))};return window.addEventListener("storage",n),n}function cge(e){window.removeEventListener("storage",e)}function dge(e,t){if(t=oE(t),!fY())throw new Error("BroadcastChannel: localstorage cannot be used");var r=iE(),n=new aY(t.localstorage.removeTimeout),i={channelName:e,uuid:r,eMIs:n};return i.listener=lge(e,function(a){i.messagesCallback&&a.uuid!==r&&(!a.token||n.has(a.token)||a.data.time&&a.data.time<i.messagesCallbackTime||(n.add(a.token),i.messagesCallback(a.data)))}),i}function fge(e){cge(e.listener)}function hge(e,t,r){e.messagesCallbackTime=r,e.messagesCallback=t}function fY(){if(g2)return!1;var e=cY();if(!e)return!1;try{var t="__broadcastchannel_check";e.setItem(t,"works"),e.removeItem(t)}catch{return!1}return!0}function pge(){var e=120,t=navigator.userAgent.toLowerCase();return t.includes("safari")&&!t.includes("chrome")?e*2:e}const vge={create:dge,close:fge,onMessage:hge,postMessage:uge,canBeUsed:fY,type:sge,averageResponseTime:pge,microSeconds:age};var mge=aE,gge="simulate",FO=new Set;function yge(e){var t={name:e,messagesCallback:null};return FO.add(t),t}function bge(e){FO.delete(e)}function xge(e,t){return new Promise(function(r){return setTimeout(function(){var n=Array.from(FO);n.filter(function(i){return i.name===e.name}).filter(function(i){return i!==e}).filter(function(i){return!!i.messagesCallback}).forEach(function(i){return i.messagesCallback(t)}),r()},5)})}function Sge(e,t){e.messagesCallback=t}function Cge(){return!0}function _ge(){return 5}const wge={create:yge,close:bge,onMessage:Sge,postMessage:xge,canBeUsed:Cge,type:gge,averageResponseTime:_ge,microSeconds:mge};var JM=[jme,ige,vge];if(g2){var IB=require("../../src/methods/node.js");typeof IB.canBeUsed=="function"&&JM.push(IB)}function hY(e){var t=[].concat(e.methods,JM).filter(Boolean);if(e.type){if(e.type==="simulate")return wge;var r=t.find(function(i){return i.type===e.type});if(r)return r;throw new Error("method-type "+e.type+" not found")}!e.webWorkerSupport&&!g2&&(t=t.filter(function(i){return i.type!=="idb"}));var n=t.find(function(i){return i.canBeUsed()});if(n)return n;throw new Error("No useable methode found:"+JSON.stringify(JM.map(function(i){return i.type})))}var LO=function(t,r){this.name=t,e5&&(r=e5),this.options=oE(r),this.method=hY(this.options),this._iL=!1,this._onML=null,this._addEL={message:[],internal:[]},this._uMP=new Set,this._befC=[],this._prepP=null,Pge(this)};LO._pubkey=!0;function Ege(e){e=oE(e);var t=hY(e);return t.type==="node"?t.clearNodeFolder().then(function(){return!0}):Promise.resolve(!1)}var e5;function Age(e){e5=e}LO.prototype={postMessage:function(t){if(this.closed)throw new Error("BroadcastChannel.postMessage(): Cannot post message after channel has closed");return MB(this,"message",t)},postInternal:function(t){return MB(this,"internal",t)},set onmessage(e){var t=this.method.microSeconds(),r={time:t,fn:e};RB(this,"message",this._onML),e&&typeof e=="function"?(this._onML=r,DB(this,"message",r)):this._onML=null},addEventListener:function(t,r){var n=this.method.microSeconds(),i={time:n,fn:r};DB(this,t,i)},removeEventListener:function(t,r){var n=this._addEL[t].find(function(i){return i.fn===r});RB(this,t,n)},close:function(){var t=this;if(!this.closed){this.closed=!0;var r=this._prepP?this._prepP:Promise.resolve();return this._onML=null,this._addEL.message=[],r.then(function(){return Promise.all(Array.from(t._uMP))}).then(function(){return Promise.all(t._befC.map(function(n){return n()}))}).then(function(){return t.method.close(t._state)})}},get type(){return this.method.type},get isClosed(){return this.closed}};function MB(e,t,r){var n=e.method.microSeconds(),i={time:n,type:t,data:r},a=e._prepP?e._prepP:Promise.resolve();return a.then(function(){var o=e.method.postMessage(e._state,i);return e._uMP.add(o),o.catch().then(function(){return e._uMP.delete(o)}),o})}function Pge(e){var t=e.method.create(e.name,e.options);Mme(t)?(e._prepP=t,t.then(function(r){e._state=r})):e._state=t}function pY(e){return e._addEL.message.length>0||e._addEL.internal.length>0}function DB(e,t,r){e._addEL[t].push(r),Tge(e)}function RB(e,t,r){e._addEL[t]=e._addEL[t].filter(function(n){return n!==r}),Ige(e)}function Tge(e){if(!e._iL&&pY(e)){var t=function(i){e._addEL[i.type].forEach(function(a){i.time>=a.time&&a.fn(i.data)})},r=e.method.microSeconds();e._prepP?e._prepP.then(function(){e._iL=!0,e.method.onMessage(e._state,t,r)}):(e._iL=!0,e.method.onMessage(e._state,t,r))}}function Ige(e){if(e._iL&&!pY(e)){e._iL=!1;var t=e.method.microSeconds();e.method.onMessage(e._state,null,t)}}const Mge=Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]";function Dge(e){if(!(typeof WorkerGlobalScope=="function"&&self instanceof WorkerGlobalScope)){if(typeof window.addEventListener!="function")return;window.addEventListener("beforeunload",function(){e()},!0),window.addEventListener("unload",function(){e()},!0)}}const Rge={add:Dge},kge={};var Oge=Mge?kge:Rge,Jp=new Set,kB=!1;function Fge(){kB||(kB=!0,Oge.add(vY))}function Lge(e){if(Fge(),typeof e!="function")throw new Error("Listener is no function");Jp.add(e);var t={remove:function(){return Jp.delete(e)},run:function(){return Jp.delete(e),e()}};return t}function vY(){var e=[];return Jp.forEach(function(t){e.push(t()),Jp.delete(t)}),Promise.all(e)}function Nge(){Jp.clear()}function Bge(){return Jp.size}const Uge={add:Lge,runAll:vY,removeAll:Nge,getSize:Bge};var mY=function(t,r){this._channel=t,this._options=r,this.isLeader=!1,this.isDead=!1,this.token=iE(),this._isApl=!1,this._reApply=!1,this._unl=[],this._lstns=[],this._invs=[],this._dpL=function(){},this._dpLC=!1};mY.prototype={applyOnce:function(){var t=this;if(this.isLeader||this.isDead)return Promise.resolve(!1);if(this._isApl)return this._reApply=!0,Promise.resolve(!1);this._isApl=!0;var r=!1,n=function(o){o.context==="leader"&&o.token!=t.token&&(o.action==="apply"&&o.token>t.token&&(r=!0),o.action==="tell"&&(r=!0))};this._channel.addEventListener("internal",n);var i=jp(this,"apply").then(function(){return y_(t._options.responseTime)}).then(function(){return r?Promise.reject(new Error):jp(t,"apply")}).then(function(){return y_(t._options.responseTime)}).then(function(){return r?Promise.reject(new Error):jp(t)}).then(function(){return gY(t)}).then(function(){return!0}).catch(function(){return!1}).then(function(a){return t._channel.removeEventListener("internal",n),t._isApl=!1,!a&&t._reApply?(t._reApply=!1,t.applyOnce()):a});return i},awaitLeadership:function(){return this._aLP||(this._aLP=jge(this)),this._aLP},set onduplicate(e){this._dpL=e},die:function(){var t=this;if(!this.isDead)return this.isDead=!0,this._lstns.forEach(function(r){return t._channel.removeEventListener("internal",r)}),this._invs.forEach(function(r){return clearInterval(r)}),this._unl.forEach(function(r){r.remove()}),jp(this,"death")}};function jge(e){return e.isLeader?Promise.resolve():new Promise(function(t){var r=!1;function n(){r||(r=!0,clearInterval(i),e._channel.removeEventListener("internal",a),t(!0))}e.applyOnce().then(function(){e.isLeader&&n()});var i=setInterval(function(){e.applyOnce().then(function(){e.isLeader&&n()})},e._options.fallbackInterval);e._invs.push(i);var a=function(s){s.context==="leader"&&s.action==="death"&&e.applyOnce().then(function(){e.isLeader&&n()})};e._channel.addEventListener("internal",a),e._lstns.push(a)})}function jp(e,t){var r={context:"leader",action:t,token:e.token};return e._channel.postInternal(r)}function gY(e){e.isLeader=!0;var t=Uge.add(function(){return e.die()});e._unl.push(t);var r=function(i){i.context==="leader"&&i.action==="apply"&&jp(e,"tell"),i.context==="leader"&&i.action==="tell"&&!e._dpLC&&(e._dpLC=!0,e._dpL(),jp(e,"tell"))};return e._channel.addEventListener("internal",r),e._lstns.push(r),jp(e,"tell")}function zge(e,t){return e||(e={}),e=JSON.parse(JSON.stringify(e)),e.fallbackInterval||(e.fallbackInterval=3e3),e.responseTime||(e.responseTime=t.method.averageResponseTime(t.options)),e}function Vge(e,t){if(e._leaderElector)throw new Error("BroadcastChannel already has a leader-elector");t=zge(t,e);var r=new mY(e,t);return e._befC.push(function(){return r.die()}),e._leaderElector=r,r}const Hge=Object.freeze(Object.defineProperty({__proto__:null,BroadcastChannel:LO,beLeader:gY,clearNodeFolder:Ege,createLeaderElection:Vge,enforceOptions:Age},Symbol.toStringTag,{value:"Module"})),Gge=Use(Hge);var NO;Object.defineProperty(Wn,"__esModule",{value:!0});var yY=Wn.initMessageListener=Wn.initStateWithPrevTab=Wn.withReduxStateSync=Wn.createReduxStateSync=NO=Wn.createStateSyncMiddleware=Wn.WINDOW_STATE_SYNC_ID=Wn.INIT_MESSAGE_LISTENER=Wn.RECEIVE_INIT_STATE=Wn.SEND_INIT_STATE=Wn.GET_INIT_STATE=void 0;Wn.generateUuidForAction=SY;Wn.isActionAllowed=CY;Wn.isActionSynced=Qge;Wn.MessageListener=_Y;var qge=Gge,t5=0,BO=Wn.GET_INIT_STATE="&_GET_INIT_STATE",UO=Wn.SEND_INIT_STATE="&_SEND_INIT_STATE",jO=Wn.RECEIVE_INIT_STATE="&_RECEIVE_INIT_STATE",$ge=Wn.INIT_MESSAGE_LISTENER="&_INIT_MESSAGE_LISTENER",r5={channel:"redux_state_sync",predicate:null,blacklist:[],whitelist:[],broadcastChannelOption:void 0,prepareState:function(t){return t},receiveState:function(t,r){return r}},Wge=function(){return{type:BO}},Xge=function(){return{type:UO}},Yge=function(t){return{type:jO,payload:t}},Kge=function(){return{type:$ge}};function tf(){return Math.floor((1+Math.random())*65536).toString(16).substring(1)}function bY(){return""+tf()+tf()+"-"+tf()+"-"+tf()+"-"+tf()+"-"+tf()+tf()+tf()}var xY=Wn.WINDOW_STATE_SYNC_ID=bY();function SY(e){var t=e;return t.$uuid=bY(),t.$wuid=xY,t}function CY(e){var t=e.predicate,r=e.blacklist,n=e.whitelist,i=function(){return!0};return t&&typeof t=="function"?i=t:Array.isArray(r)?i=function(o){return r.indexOf(o.type)<0}:Array.isArray(n)&&(i=function(o){return n.indexOf(o.type)>=0}),i}function Qge(e){return!!e.$isSync}function _Y(e){var t=e.channel,r=e.dispatch,n=e.allowed,i=!1,a={};this.handleOnMessage=function(o){o.$wuid!==xY&&o.type!==jO&&o.$uuid&&o.$uuid!==t5&&(o.type===BO&&!a[o.$wuid]?(a[o.$wuid]=!0,r(Xge())):o.type===UO&&!a[o.$wuid]?i||(i=!0,r(Yge(o.payload))):n(o)&&(t5=o.$uuid,r(Object.assign(o,{$isSync:!0}))))},this.messageChannel=t,this.messageChannel.onmessage=this.handleOnMessage}NO=Wn.createStateSyncMiddleware=function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:r5,r=CY(t),n=new qge.BroadcastChannel(t.channel,t.broadcastChannelOption),i=t.prepareState||r5.prepareState,a=null;return function(o){var s=o.getState,u=o.dispatch;return function(l){return function(c){if(a||(a=new _Y({channel:n,dispatch:u,allowed:r})),c&&!c.$uuid){var d=SY(c);t5=d.$uuid;try{if(c.type===UO)return s()&&(d.payload=i(s()),n.postMessage(d)),l(c);(r(d)||c.type===BO)&&n.postMessage(d)}catch{console.error("Your browser doesn't support cross tab communication")}}return l(Object.assign(c,{$isSync:typeof c.$isSync>"u"?!1:c.$isSync}))}}}};var Zge=Wn.createReduxStateSync=function(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:r5.receiveState;return function(n,i){var a=n;return i.type===jO&&(a=r(n,i.payload)),t(a,i)}};Wn.withReduxStateSync=Zge;Wn.initStateWithPrevTab=function(t){var r=t.dispatch;r(Wge())};yY=Wn.initMessageListener=function(t){var r=t.dispatch;r(Kge())};const Jge={},wY=xve({reducer:{appState:Bve},middleware:e=>e().concat(QM).concat(NO(Jge))});yY(wY);const sE=Ime;function e0e(e){var s,u,l,c,d;let t="",r;e.comments&&Array.isArray(e.comments)&&(r=e.comments.find(f=>f.commentType==="SUBCELLULAR LOCATION")),r&&r.subcellularLocations&&Array.isArray(r.subcellularLocations)&&((s=r.subcellularLocations)==null?void 0:s.length)>0&&(t=((l=(u=r.subcellularLocations[0])==null?void 0:u.location)==null?void 0:l.value)??"");let n=[],i=[],a={name:"",synonyms:[]};return e.genes&&Array.isArray(e.genes)&&(n=e.genes[0].synonyms||[],i=n?n.map(f=>f.value):[],a={name:((d=(c=e==null?void 0:e.genes[0])==null?void 0:c.geneName)==null?void 0:d.value)??"",synonyms:i}),{primaryAccession:e.primaryAccession,id:e.uniProtkbId,organism_name:e.organism.scientificName,gene_names:a,cc_subcellular_location:t,length:e.sequence.length}}function t0e(e){var r,n,i,a,o,s,u,l,c,d;return{id:(e==null?void 0:e.primaryAccession)??"",uniProtkbId:(e==null?void 0:e.uniProtkbId)??"",organism:((r=e==null?void 0:e.organism)==null?void 0:r.scientificName)??"",description:((a=(i=(n=e==null?void 0:e.proteinDescription)==null?void 0:n.recommendedName)==null?void 0:i.fullName)==null?void 0:a.value)??"",gene:((o=e==null?void 0:e.genes[0])==null?void 0:o.geneName.value)??"",length:((s=e==null?void 0:e.sequence)==null?void 0:s.length)??"",sequence:((u=e==null?void 0:e.sequence)==null?void 0:u.value)??"",lastUpdated:((l=e==null?void 0:e.entryAudit)==null?void 0:l.lastSequenceUpdateDate)??"",molWeight:((c=e==null?void 0:e.sequence)==null?void 0:c.molWeight)??"",checksum:((d=e==null?void 0:e.sequence)==null?void 0:d.crc64)??"",publications:[]}}const hh={API_HOST:"https://rest.uniprot.org/uniprotkb/",API_ITEMS_PER_PAGE:25,PUBMED_HOST:"https://pubmed.ncbi.nlm.nih.gov/",PMC_HOST:"https://europepmc.org/article/MED/",DOI_HOST:"https://dx.doi.org/"};function r0e(e){var a,o,s,u,l,c,d,f,h,v;let t;try{e.citation&&e.citation.citationCrossReferences&&(t=((a=e.citation.citationCrossReferences.find(p=>p.database==="PubMed"))==null?void 0:a.id)??"")}catch(p){console.error(p)}let r;try{e.citation&&e.citation.citationCrossReferences&&(r=((o=e.citation.citationCrossReferences.find(p=>p.database==="DOI"))==null?void 0:o.id)??"")}catch(p){console.error(p)}let n;n=e.references.map(p=>{var m;return{id:p.citationId??"",source:((m=p.source)==null?void 0:m.name)??"",categories:p.sourceCategories??"",positions:p.referencePositions??""}});let i;return i={id:((s=e.citation)==null?void 0:s.id)??"",authors:((u=e.citation)==null?void 0:u.authors)??"",title:((l=e.citation)==null?void 0:l.title)??"",journal:((c=e.citation)==null?void 0:c.journal)??"",volume:((d=e.citation)==null?void 0:d.volume)??"",firstPage:((f=e.citation)==null?void 0:f.firstPage)??"",lastPage:((h=e.citation)==null?void 0:h.lastPage)??"",publicationDate:((v=e.citation)==null?void 0:v.publicationDate)??"",references:n,pubMedId:t,doiId:r},i}const n0e=async e=>{var r,n;const t=new URL(`${hh.API_HOST}search?facets=model_organism,proteins_with,annotation_score&query=(${e})`);try{const i=await fetch(t,{method:"GET"});if(!i.ok)throw new Error(`Error retrieving data from fetchFacetsAPI: ${i.statusText}
Status: ${i.status}
Target URL: ${t}`);const a=await i.json();let o=[];a.facets&&Array.isArray(a.facets)&&(o=(r=a.facets.find(l=>(l==null?void 0:l.name)==="model_organism"))==null?void 0:r.values);let s=[];return a.facets&&Array.isArray(a.facets)&&(s=(n=a.facets.find(l=>(l==null?void 0:l.name)==="proteins_with"))==null?void 0:n.values),{organisms:o,proteinsWith:s}}catch(i){throw i}},i0e=async e=>{const t=new URL(`${hh.API_HOST}/${e}`);try{const r=await fetch(t,{method:"GET"});if(!r.ok)throw new Error(`Error retrieving data from fetchProteinAPI: ${r.statusText}
Status: ${r.status}
Target URL: ${t}`);const n=await r.json();return t0e(n)}catch(r){throw r}},a0e=async e=>{const t=new URL(`${hh.API_HOST}/${e}/publications`);try{const r=await fetch(t,{method:"GET"});if(!r.ok)throw new Error(`Error retrieving data from fetchProteinPublicationsAPI: ${r.statusText}
Status: ${r.status}
Target URL: ${t}`);return(await r.json()).results.map(r0e)}catch(r){throw r}},EY=async(e,t)=>{var r,n;try{const i=await fetch(e,{method:"GET"});if(!i.ok)throw new Error(`Error retrieving data from fetchProteinItemsCommonAPI: ${i.statusText}
Status: ${i.status}
Target URL: ${e}`);let a=((r=i==null?void 0:i.headers)==null?void 0:r.get("Link"))??"";a=a.split("; ")[0].replace(/^<|>$/g,"");let o=parseInt(((n=i==null?void 0:i.headers)==null?void 0:n.get("X-Total-Results"))??"");Number.isNaN(o)&&(o=-1);const u=(await i.json()).results.map(e0e);return{searchString:t,totalResults:o,nextLink:a,items:u}}catch(i){throw i}},o0e=async(e,t)=>{let r="";if(t.geneName&&(r+=` AND (gene:${t.geneName})`),t.sequenceLengthMin&&t.sequenceLengthMax&&(r+=" AND "+encodeURIComponent(`length:[${t.sequenceLengthMin} TO ${t.sequenceLengthMax}]`).replace(/%20/g,"+")),t.annotationScore&&(r+=` AND annotation_score:${t.annotationScore}`),t.organism&&Array.isArray(t.organism)&&t.organism.length>0){const i=t.organism.map((a,o)=>o>0?` OR organism_id:${a}`:`organism_id:${a}`).join("");r+=` AND (${encodeURIComponent(i)})`}if(t.proteinWith&&Array.isArray(t.proteinWith)&&t.proteinWith.length>0){const i=t.proteinWith.map((a,o)=>o>0?` OR proteins_with:${a}`:`proteins_with:${a}`).join("");r+=` AND (${encodeURIComponent(i)})`}const n=new URL(`${hh.API_HOST}search?fields=accession,id,gene_names,organism_name,length,cc_subcellular_location&query=(${e}${r})&size=${hh.API_ITEMS_PER_PAGE}`);return EY(n,e)},s0e=async(e,t)=>EY(e,t),u0e=(e,t)=>async r=>{try{const n=await o0e(e,t),i=await n0e(e);r(Fve(t)),r(Rve(n)),r(kve(i))}catch(n){n instanceof Error?console.error(`Error retrieving data: ${n.message}`):console.error("Unexpected error occurred:",n)}},l0e=(e,t)=>async r=>{try{const n=await s0e(e,t);r(Ove(n))}catch(n){n instanceof Error?console.error(`Error retrieving data: ${n.message}`):console.error("Unexpected error occurred:",n)}},c0e=e=>async t=>{try{const r=await i0e(e);t(Lve(r))}catch(r){r instanceof Error?console.error(`Error retrieving protein data: ${r.message}`):console.error("Unexpected error occurred while obtaining protein data:",r)}},d0e=e=>async t=>{try{const r=await a0e(e);t(Nve({proteinId:e,publications:r}))}catch(r){r instanceof Error?console.error(`Error retrieving data: ${r.message}`):console.error("Unexpected error occurred:",r)}},uE=()=>P.jsx("div",{className:"loading-wrapper",children:P.jsx("div",{className:"loading"})}),f0e=()=>{const e=Id(),t=sE(),r=Sv(s=>s.appState.searchResults),[n,i]=Eo.useState(!1),a=s=>{if(!s)return;const u=`/protein/${s}`;e(u)},o=s=>{if(s.currentTarget.scrollHeight-s.currentTarget.scrollTop<s.currentTarget.clientHeight+100&&!n&&r.items.length<r.totalResults){i(!0);const l=new URL(r.nextLink);t(l0e(l,r.searchString)).finally(()=>{i(!1)})}};return P.jsx("div",{className:"protein-table-wrapper",onScroll:o,children:P.jsxs("table",{className:"protein-table",children:[P.jsx("thead",{className:"protein-table-header",children:P.jsxs("tr",{className:"protein-table-header-row",children:[P.jsx("th",{className:"protein-table-header-column",children:"#"}),P.jsx("th",{className:"protein-table-header-column",children:"Primary Accession"}),P.jsx("th",{className:"protein-table-header-column",children:"ID"}),P.jsx("th",{className:"protein-table-header-column",children:"Organism Name"}),P.jsx("th",{className:"protein-table-header-column",children:"Gene Names"}),P.jsx("th",{className:"protein-table-header-column",children:"Subcellular Location"}),P.jsx("th",{className:"protein-table-header-column",children:"Length"})]})}),P.jsxs("tbody",{children:[r.items.map((s,u)=>P.jsxs("tr",{children:[P.jsx("td",{className:"protein-table-content protein-table-column-generic",children:u+1}),P.jsx("td",{className:"protein-table-content protein-table-column-entry",children:P.jsx("span",{className:"protein-table-entry",onClick:()=>{a(s.primaryAccession)},children:s.primaryAccession})}),P.jsx("td",{className:"protein-table-content protein-table-column-generic",children:s.id}),P.jsx("td",{className:"protein-table-content",children:P.jsx("div",{"data-organism":s.organism_name,children:s.organism_name})}),P.jsxs("td",{className:"protein-table-content protein-table-column-generic",children:[P.jsx("span",{className:"protein-table-gene-main",children:s.gene_names.name}),s.gene_names.synonyms.length>0?", ":"",s.gene_names.synonyms.join(", ")]}),P.jsx("td",{className:"protein-table-content protein-table-column-generic",children:s.cc_subcellular_location}),P.jsx("td",{className:"protein-table-content protein-table-column-generic",children:s.length})]},s.primaryAccession)),n&&P.jsx("tr",{className:"protein-table-content-loading",children:P.jsx("td",{colSpan:7,children:P.jsx(uE,{})})})]})]})})};function h0e(e){if(Array.isArray(e))return e}function p0e(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,i,a,o,s=[],u=!0,l=!1;try{if(a=(r=r.call(e)).next,t===0){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=a.call(r)).done)&&(s.push(n.value),s.length!==t);u=!0);}catch(c){l=!0,i=c}finally{try{if(!u&&r.return!=null&&(o=r.return(),Object(o)!==o))return}finally{if(l)throw i}}return s}}function n5(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function AY(e,t){if(e){if(typeof e=="string")return n5(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return n5(e,t)}}function v0e(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function $c(e,t){return h0e(e)||p0e(e,t)||AY(e,t)||v0e()}function R0(e,t){if(e==null)return{};var r=dme(e,t),n,i;if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(i=0;i<a.length;i++)n=a[i],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var m0e=["defaultInputValue","defaultMenuIsOpen","defaultValue","inputValue","menuIsOpen","onChange","onInputChange","onMenuClose","onMenuOpen","value"];function g0e(e){var t=e.defaultInputValue,r=t===void 0?"":t,n=e.defaultMenuIsOpen,i=n===void 0?!1:n,a=e.defaultValue,o=a===void 0?null:a,s=e.inputValue,u=e.menuIsOpen,l=e.onChange,c=e.onInputChange,d=e.onMenuClose,f=e.onMenuOpen,h=e.value,v=R0(e,m0e),p=_e.useState(s!==void 0?s:r),m=$c(p,2),g=m[0],y=m[1],b=_e.useState(u!==void 0?u:i),S=$c(b,2),x=S[0],C=S[1],w=_e.useState(h!==void 0?h:o),A=$c(w,2),M=A[0],D=A[1],k=_e.useCallback(function(G,$){typeof l=="function"&&l(G,$),D(G)},[l]),R=_e.useCallback(function(G,$){var q;typeof c=="function"&&(q=c(G,$)),y(q!==void 0?q:G)},[c]),O=_e.useCallback(function(){typeof f=="function"&&f(),C(!0)},[f]),H=_e.useCallback(function(){typeof d=="function"&&d(),C(!1)},[d]),B=s!==void 0?s:g,j=u!==void 0?u:x,Y=h!==void 0?h:M;return gr(gr({},v),{},{inputValue:B,menuIsOpen:j,onChange:k,onInputChange:R,onMenuClose:H,onMenuOpen:O,value:Y})}function y0e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function OB(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,UX(n.key),n)}}function b0e(e,t,r){return t&&OB(e.prototype,t),r&&OB(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function i5(e,t){return i5=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,i){return n.__proto__=i,n},i5(e,t)}function x0e(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&i5(e,t)}function b_(e){return b_=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},b_(e)}function S0e(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function C0e(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _0e(e,t){if(t&&(xv(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return C0e(e)}function w0e(e){var t=S0e();return function(){var n=b_(e),i;if(t){var a=b_(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return _0e(this,i)}}function E0e(e){if(Array.isArray(e))return n5(e)}function A0e(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function P0e(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function PY(e){return E0e(e)||A0e(e)||AY(e)||P0e()}function T0e(e){if(e.sheet)return e.sheet;for(var t=0;t<document.styleSheets.length;t++)if(document.styleSheets[t].ownerNode===e)return document.styleSheets[t]}function I0e(e){var t=document.createElement("style");return t.setAttribute("data-emotion",e.key),e.nonce!==void 0&&t.setAttribute("nonce",e.nonce),t.appendChild(document.createTextNode("")),t.setAttribute("data-s",""),t}var M0e=function(){function e(r){var n=this;this._insertTag=function(i){var a;n.tags.length===0?n.insertionPoint?a=n.insertionPoint.nextSibling:n.prepend?a=n.container.firstChild:a=n.before:a=n.tags[n.tags.length-1].nextSibling,n.container.insertBefore(i,a),n.tags.push(i)},this.isSpeedy=r.speedy===void 0?!0:r.speedy,this.tags=[],this.ctr=0,this.nonce=r.nonce,this.key=r.key,this.container=r.container,this.prepend=r.prepend,this.insertionPoint=r.insertionPoint,this.before=null}var t=e.prototype;return t.hydrate=function(n){n.forEach(this._insertTag)},t.insert=function(n){this.ctr%(this.isSpeedy?65e3:1)===0&&this._insertTag(I0e(this));var i=this.tags[this.tags.length-1];if(this.isSpeedy){var a=T0e(i);try{a.insertRule(n,a.cssRules.length)}catch{}}else i.appendChild(document.createTextNode(n));this.ctr++},t.flush=function(){this.tags.forEach(function(n){return n.parentNode&&n.parentNode.removeChild(n)}),this.tags=[],this.ctr=0},e}(),Ra="-ms-",x_="-moz-",mn="-webkit-",TY="comm",zO="rule",VO="decl",D0e="@import",IY="@keyframes",R0e="@layer",k0e=Math.abs,lE=String.fromCharCode,O0e=Object.assign;function F0e(e,t){return ya(e,0)^45?(((t<<2^ya(e,0))<<2^ya(e,1))<<2^ya(e,2))<<2^ya(e,3):0}function MY(e){return e.trim()}function L0e(e,t){return(e=t.exec(e))?e[0]:e}function gn(e,t,r){return e.replace(t,r)}function a5(e,t){return e.indexOf(t)}function ya(e,t){return e.charCodeAt(t)|0}function Eb(e,t,r){return e.slice(t,r)}function Pl(e){return e.length}function HO(e){return e.length}function Cx(e,t){return t.push(e),e}function N0e(e,t){return e.map(t).join("")}var cE=1,n0=1,DY=0,Do=0,Ni=0,k0="";function dE(e,t,r,n,i,a,o){return{value:e,root:t,parent:r,type:n,props:i,children:a,line:cE,column:n0,length:o,return:""}}function my(e,t){return O0e(dE("",null,null,"",null,null,0),e,{length:-e.length},t)}function B0e(){return Ni}function U0e(){return Ni=Do>0?ya(k0,--Do):0,n0--,Ni===10&&(n0=1,cE--),Ni}function ns(){return Ni=Do<DY?ya(k0,Do++):0,n0++,Ni===10&&(n0=1,cE++),Ni}function Gl(){return ya(k0,Do)}function aC(){return Do}function y2(e,t){return Eb(k0,e,t)}function Ab(e){switch(e){case 0:case 9:case 10:case 13:case 32:return 5;case 33:case 43:case 44:case 47:case 62:case 64:case 126:case 59:case 123:case 125:return 4;case 58:return 3;case 34:case 39:case 40:case 91:return 2;case 41:case 93:return 1}return 0}function RY(e){return cE=n0=1,DY=Pl(k0=e),Do=0,[]}function kY(e){return k0="",e}function oC(e){return MY(y2(Do-1,o5(e===91?e+2:e===40?e+1:e)))}function j0e(e){for(;(Ni=Gl())&&Ni<33;)ns();return Ab(e)>2||Ab(Ni)>3?"":" "}function z0e(e,t){for(;--t&&ns()&&!(Ni<48||Ni>102||Ni>57&&Ni<65||Ni>70&&Ni<97););return y2(e,aC()+(t<6&&Gl()==32&&ns()==32))}function o5(e){for(;ns();)switch(Ni){case e:return Do;case 34:case 39:e!==34&&e!==39&&o5(Ni);break;case 40:e===41&&o5(e);break;case 92:ns();break}return Do}function V0e(e,t){for(;ns()&&e+Ni!==47+10;)if(e+Ni===42+42&&Gl()===47)break;return"/*"+y2(t,Do-1)+"*"+lE(e===47?e:ns())}function H0e(e){for(;!Ab(Gl());)ns();return y2(e,Do)}function G0e(e){return kY(sC("",null,null,null,[""],e=RY(e),0,[0],e))}function sC(e,t,r,n,i,a,o,s,u){for(var l=0,c=0,d=o,f=0,h=0,v=0,p=1,m=1,g=1,y=0,b="",S=i,x=a,C=n,w=b;m;)switch(v=y,y=ns()){case 40:if(v!=108&&ya(w,d-1)==58){a5(w+=gn(oC(y),"&","&\f"),"&\f")!=-1&&(g=-1);break}case 34:case 39:case 91:w+=oC(y);break;case 9:case 10:case 13:case 32:w+=j0e(v);break;case 92:w+=z0e(aC()-1,7);continue;case 47:switch(Gl()){case 42:case 47:Cx(q0e(V0e(ns(),aC()),t,r),u);break;default:w+="/"}break;case 123*p:s[l++]=Pl(w)*g;case 125*p:case 59:case 0:switch(y){case 0:case 125:m=0;case 59+c:g==-1&&(w=gn(w,/\f/g,"")),h>0&&Pl(w)-d&&Cx(h>32?LB(w+";",n,r,d-1):LB(gn(w," ","")+";",n,r,d-2),u);break;case 59:w+=";";default:if(Cx(C=FB(w,t,r,l,c,i,s,b,S=[],x=[],d),a),y===123)if(c===0)sC(w,t,C,C,S,a,d,s,x);else switch(f===99&&ya(w,3)===110?100:f){case 100:case 108:case 109:case 115:sC(e,C,C,n&&Cx(FB(e,C,C,0,0,i,s,b,i,S=[],d),x),i,x,d,s,n?S:x);break;default:sC(w,C,C,C,[""],x,0,s,x)}}l=c=h=0,p=g=1,b=w="",d=o;break;case 58:d=1+Pl(w),h=v;default:if(p<1){if(y==123)--p;else if(y==125&&p++==0&&U0e()==125)continue}switch(w+=lE(y),y*p){case 38:g=c>0?1:(w+="\f",-1);break;case 44:s[l++]=(Pl(w)-1)*g,g=1;break;case 64:Gl()===45&&(w+=oC(ns())),f=Gl(),c=d=Pl(b=w+=H0e(aC())),y++;break;case 45:v===45&&Pl(w)==2&&(p=0)}}return a}function FB(e,t,r,n,i,a,o,s,u,l,c){for(var d=i-1,f=i===0?a:[""],h=HO(f),v=0,p=0,m=0;v<n;++v)for(var g=0,y=Eb(e,d+1,d=k0e(p=o[v])),b=e;g<h;++g)(b=MY(p>0?f[g]+" "+y:gn(y,/&\f/g,f[g])))&&(u[m++]=b);return dE(e,t,r,i===0?zO:s,u,l,c)}function q0e(e,t,r){return dE(e,t,r,TY,lE(B0e()),Eb(e,2,-2),0)}function LB(e,t,r,n){return dE(e,t,r,VO,Eb(e,0,n),Eb(e,n+1,-1),n)}function Rg(e,t){for(var r="",n=HO(e),i=0;i<n;i++)r+=t(e[i],i,e,t)||"";return r}function $0e(e,t,r,n){switch(e.type){case R0e:if(e.children.length)break;case D0e:case VO:return e.return=e.return||e.value;case TY:return"";case IY:return e.return=e.value+"{"+Rg(e.children,n)+"}";case zO:e.value=e.props.join(",")}return Pl(r=Rg(e.children,n))?e.return=e.value+"{"+r+"}":""}function W0e(e){var t=HO(e);return function(r,n,i,a){for(var o="",s=0;s<t;s++)o+=e[s](r,n,i,a)||"";return o}}function X0e(e){return function(t){t.root||(t=t.return)&&e(t)}}function Y0e(e){var t=Object.create(null);return function(r){return t[r]===void 0&&(t[r]=e(r)),t[r]}}var K0e=function(t,r,n){for(var i=0,a=0;i=a,a=Gl(),i===38&&a===12&&(r[n]=1),!Ab(a);)ns();return y2(t,Do)},Q0e=function(t,r){var n=-1,i=44;do switch(Ab(i)){case 0:i===38&&Gl()===12&&(r[n]=1),t[n]+=K0e(Do-1,r,n);break;case 2:t[n]+=oC(i);break;case 4:if(i===44){t[++n]=Gl()===58?"&\f":"",r[n]=t[n].length;break}default:t[n]+=lE(i)}while(i=ns());return t},Z0e=function(t,r){return kY(Q0e(RY(t),r))},NB=new WeakMap,J0e=function(t){if(!(t.type!=="rule"||!t.parent||t.length<1)){for(var r=t.value,n=t.parent,i=t.column===n.column&&t.line===n.line;n.type!=="rule";)if(n=n.parent,!n)return;if(!(t.props.length===1&&r.charCodeAt(0)!==58&&!NB.get(n))&&!i){NB.set(t,!0);for(var a=[],o=Z0e(r,a),s=n.props,u=0,l=0;u<o.length;u++)for(var c=0;c<s.length;c++,l++)t.props[l]=a[u]?o[u].replace(/&\f/g,s[c]):s[c]+" "+o[u]}}},eye=function(t){if(t.type==="decl"){var r=t.value;r.charCodeAt(0)===108&&r.charCodeAt(2)===98&&(t.return="",t.value="")}};function OY(e,t){switch(F0e(e,t)){case 5103:return mn+"print-"+e+e;case 5737:case 4201:case 3177:case 3433:case 1641:case 4457:case 2921:case 5572:case 6356:case 5844:case 3191:case 6645:case 3005:case 6391:case 5879:case 5623:case 6135:case 4599:case 4855:case 4215:case 6389:case 5109:case 5365:case 5621:case 3829:return mn+e+e;case 5349:case 4246:case 4810:case 6968:case 2756:return mn+e+x_+e+Ra+e+e;case 6828:case 4268:return mn+e+Ra+e+e;case 6165:return mn+e+Ra+"flex-"+e+e;case 5187:return mn+e+gn(e,/(\w+).+(:[^]+)/,mn+"box-$1$2"+Ra+"flex-$1$2")+e;case 5443:return mn+e+Ra+"flex-item-"+gn(e,/flex-|-self/,"")+e;case 4675:return mn+e+Ra+"flex-line-pack"+gn(e,/align-content|flex-|-self/,"")+e;case 5548:return mn+e+Ra+gn(e,"shrink","negative")+e;case 5292:return mn+e+Ra+gn(e,"basis","preferred-size")+e;case 6060:return mn+"box-"+gn(e,"-grow","")+mn+e+Ra+gn(e,"grow","positive")+e;case 4554:return mn+gn(e,/([^-])(transform)/g,"$1"+mn+"$2")+e;case 6187:return gn(gn(gn(e,/(zoom-|grab)/,mn+"$1"),/(image-set)/,mn+"$1"),e,"")+e;case 5495:case 3959:return gn(e,/(image-set\([^]*)/,mn+"$1$`$1");case 4968:return gn(gn(e,/(.+:)(flex-)?(.*)/,mn+"box-pack:$3"+Ra+"flex-pack:$3"),/s.+-b[^;]+/,"justify")+mn+e+e;case 4095:case 3583:case 4068:case 2532:return gn(e,/(.+)-inline(.+)/,mn+"$1$2")+e;case 8116:case 7059:case 5753:case 5535:case 5445:case 5701:case 4933:case 4677:case 5533:case 5789:case 5021:case 4765:if(Pl(e)-1-t>6)switch(ya(e,t+1)){case 109:if(ya(e,t+4)!==45)break;case 102:return gn(e,/(.+:)(.+)-([^]+)/,"$1"+mn+"$2-$3$1"+x_+(ya(e,t+3)==108?"$3":"$2-$3"))+e;case 115:return~a5(e,"stretch")?OY(gn(e,"stretch","fill-available"),t)+e:e}break;case 4949:if(ya(e,t+1)!==115)break;case 6444:switch(ya(e,Pl(e)-3-(~a5(e,"!important")&&10))){case 107:return gn(e,":",":"+mn)+e;case 101:return gn(e,/(.+:)([^;!]+)(;|!.+)?/,"$1"+mn+(ya(e,14)===45?"inline-":"")+"box$3$1"+mn+"$2$3$1"+Ra+"$2box$3")+e}break;case 5936:switch(ya(e,t+11)){case 114:return mn+e+Ra+gn(e,/[svh]\w+-[tblr]{2}/,"tb")+e;case 108:return mn+e+Ra+gn(e,/[svh]\w+-[tblr]{2}/,"tb-rl")+e;case 45:return mn+e+Ra+gn(e,/[svh]\w+-[tblr]{2}/,"lr")+e}return mn+e+Ra+e+e}return e}var tye=function(t,r,n,i){if(t.length>-1&&!t.return)switch(t.type){case VO:t.return=OY(t.value,t.length);break;case IY:return Rg([my(t,{value:gn(t.value,"@","@"+mn)})],i);case zO:if(t.length)return N0e(t.props,function(a){switch(L0e(a,/(::plac\w+|:read-\w+)/)){case":read-only":case":read-write":return Rg([my(t,{props:[gn(a,/:(read-\w+)/,":"+x_+"$1")]})],i);case"::placeholder":return Rg([my(t,{props:[gn(a,/:(plac\w+)/,":"+mn+"input-$1")]}),my(t,{props:[gn(a,/:(plac\w+)/,":"+x_+"$1")]}),my(t,{props:[gn(a,/:(plac\w+)/,Ra+"input-$1")]})],i)}return""})}},rye=[tye],nye=function(t){var r=t.key;if(r==="css"){var n=document.querySelectorAll("style[data-emotion]:not([data-s])");Array.prototype.forEach.call(n,function(p){var m=p.getAttribute("data-emotion");m.indexOf(" ")!==-1&&(document.head.appendChild(p),p.setAttribute("data-s",""))})}var i=t.stylisPlugins||rye,a={},o,s=[];o=t.container||document.head,Array.prototype.forEach.call(document.querySelectorAll('style[data-emotion^="'+r+' "]'),function(p){for(var m=p.getAttribute("data-emotion").split(" "),g=1;g<m.length;g++)a[m[g]]=!0;s.push(p)});var u,l=[J0e,eye];{var c,d=[$0e,X0e(function(p){c.insert(p)})],f=W0e(l.concat(i,d)),h=function(m){return Rg(G0e(m),f)};u=function(m,g,y,b){c=y,h(m?m+"{"+g.styles+"}":g.styles),b&&(v.inserted[g.name]=!0)}}var v={key:r,sheet:new M0e({key:r,container:o,nonce:t.nonce,speedy:t.speedy,prepend:t.prepend,insertionPoint:t.insertionPoint}),nonce:t.nonce,inserted:a,registered:{},insert:u};return v.sheet.hydrate(s),v},iye=!0;function aye(e,t,r){var n="";return r.split(" ").forEach(function(i){e[i]!==void 0?t.push(e[i]+";"):n+=i+" "}),n}var FY=function(t,r,n){var i=t.key+"-"+r.name;(n===!1||iye===!1)&&t.registered[i]===void 0&&(t.registered[i]=r.styles)},oye=function(t,r,n){FY(t,r,n);var i=t.key+"-"+r.name;if(t.inserted[r.name]===void 0){var a=r;do t.insert(r===a?"."+i:"",a,t.sheet,!0),a=a.next;while(a!==void 0)}};function sye(e){for(var t=0,r,n=0,i=e.length;i>=4;++n,i-=4)r=e.charCodeAt(n)&255|(e.charCodeAt(++n)&255)<<8|(e.charCodeAt(++n)&255)<<16|(e.charCodeAt(++n)&255)<<24,r=(r&65535)*1540483477+((r>>>16)*59797<<16),r^=r>>>24,t=(r&65535)*1540483477+((r>>>16)*59797<<16)^(t&65535)*1540483477+((t>>>16)*59797<<16);switch(i){case 3:t^=(e.charCodeAt(n+2)&255)<<16;case 2:t^=(e.charCodeAt(n+1)&255)<<8;case 1:t^=e.charCodeAt(n)&255,t=(t&65535)*1540483477+((t>>>16)*59797<<16)}return t^=t>>>13,t=(t&65535)*1540483477+((t>>>16)*59797<<16),((t^t>>>15)>>>0).toString(36)}var uye={animationIterationCount:1,aspectRatio:1,borderImageOutset:1,borderImageSlice:1,borderImageWidth:1,boxFlex:1,boxFlexGroup:1,boxOrdinalGroup:1,columnCount:1,columns:1,flex:1,flexGrow:1,flexPositive:1,flexShrink:1,flexNegative:1,flexOrder:1,gridRow:1,gridRowEnd:1,gridRowSpan:1,gridRowStart:1,gridColumn:1,gridColumnEnd:1,gridColumnSpan:1,gridColumnStart:1,msGridRow:1,msGridRowSpan:1,msGridColumn:1,msGridColumnSpan:1,fontWeight:1,lineHeight:1,opacity:1,order:1,orphans:1,tabSize:1,widows:1,zIndex:1,zoom:1,WebkitLineClamp:1,fillOpacity:1,floodOpacity:1,stopOpacity:1,strokeDasharray:1,strokeDashoffset:1,strokeMiterlimit:1,strokeOpacity:1,strokeWidth:1},lye=/[A-Z]|^ms/g,cye=/_EMO_([^_]+?)_([^]*?)_EMO_/g,LY=function(t){return t.charCodeAt(1)===45},BB=function(t){return t!=null&&typeof t!="boolean"},Y4=Y0e(function(e){return LY(e)?e:e.replace(lye,"-$&").toLowerCase()}),UB=function(t,r){switch(t){case"animation":case"animationName":if(typeof r=="string")return r.replace(cye,function(n,i,a){return Tl={name:i,styles:a,next:Tl},i})}return uye[t]!==1&&!LY(t)&&typeof r=="number"&&r!==0?r+"px":r};function Pb(e,t,r){if(r==null)return"";if(r.__emotion_styles!==void 0)return r;switch(typeof r){case"boolean":return"";case"object":{if(r.anim===1)return Tl={name:r.name,styles:r.styles,next:Tl},r.name;if(r.styles!==void 0){var n=r.next;if(n!==void 0)for(;n!==void 0;)Tl={name:n.name,styles:n.styles,next:Tl},n=n.next;var i=r.styles+";";return i}return dye(e,t,r)}case"function":{if(e!==void 0){var a=Tl,o=r(e);return Tl=a,Pb(e,t,o)}break}}if(t==null)return r;var s=t[r];return s!==void 0?s:r}function dye(e,t,r){var n="";if(Array.isArray(r))for(var i=0;i<r.length;i++)n+=Pb(e,t,r[i])+";";else for(var a in r){var o=r[a];if(typeof o!="object")t!=null&&t[o]!==void 0?n+=a+"{"+t[o]+"}":BB(o)&&(n+=Y4(a)+":"+UB(a,o)+";");else if(Array.isArray(o)&&typeof o[0]=="string"&&(t==null||t[o[0]]===void 0))for(var s=0;s<o.length;s++)BB(o[s])&&(n+=Y4(a)+":"+UB(a,o[s])+";");else{var u=Pb(e,t,o);switch(a){case"animation":case"animationName":{n+=Y4(a)+":"+u+";";break}default:n+=a+"{"+u+"}"}}}return n}var jB=/label:\s*([^\s;\n{]+)\s*(;|$)/g,Tl,NY=function(t,r,n){if(t.length===1&&typeof t[0]=="object"&&t[0]!==null&&t[0].styles!==void 0)return t[0];var i=!0,a="";Tl=void 0;var o=t[0];o==null||o.raw===void 0?(i=!1,a+=Pb(n,r,o)):a+=o[0];for(var s=1;s<t.length;s++)a+=Pb(n,r,t[s]),i&&(a+=o[s]);jB.lastIndex=0;for(var u="",l;(l=jB.exec(a))!==null;)u+="-"+l[1];var c=sye(a)+u;return{name:c,styles:a,next:Tl}},fye=function(t){return t()},hye=IN["useInsertionEffect"]?IN["useInsertionEffect"]:!1,pye=hye||fye,GO={}.hasOwnProperty,BY=_e.createContext(typeof HTMLElement<"u"?nye({key:"css"}):null);BY.Provider;var vye=function(t){return _e.forwardRef(function(r,n){var i=_e.useContext(BY);return t(r,i,n)})},mye=_e.createContext({}),s5="__EMOTION_TYPE_PLEASE_DO_NOT_USE__",gye=function(t,r){var n={};for(var i in r)GO.call(r,i)&&(n[i]=r[i]);return n[s5]=t,n},yye=function(t){var r=t.cache,n=t.serialized,i=t.isStringTag;return FY(r,n,i),pye(function(){return oye(r,n,i)}),null},bye=vye(function(e,t,r){var n=e.css;typeof n=="string"&&t.registered[n]!==void 0&&(n=t.registered[n]);var i=e[s5],a=[n],o="";typeof e.className=="string"?o=aye(t.registered,a,e.className):e.className!=null&&(o=e.className+" ");var s=NY(a,void 0,_e.useContext(mye));o+=t.key+"-"+s.name;var u={};for(var l in e)GO.call(e,l)&&l!=="css"&&l!==s5&&(u[l]=e[l]);return u.ref=r,u.className=o,_e.createElement(_e.Fragment,null,_e.createElement(yye,{cache:t,serialized:s,isStringTag:typeof i=="string"}),_e.createElement(i,u))}),xye=bye,hr=function(t,r){var n=arguments;if(r==null||!GO.call(r,"css"))return _e.createElement.apply(void 0,n);var i=n.length,a=new Array(i);a[0]=xye,a[1]=gye(t,r);for(var o=2;o<i;o++)a[o]=n[o];return _e.createElement.apply(null,a)};function qO(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return NY(t)}var Sye=function(){var t=qO.apply(void 0,arguments),r="animation-"+t.name;return{name:r,styles:"@keyframes "+r+"{"+t.styles+"}",anim:1,toString:function(){return"_EMO_"+this.name+"_"+this.styles+"_EMO_"}}};function Cye(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}function _ye(e){return{...e,top:e.y,left:e.x,right:e.x+e.width,bottom:e.y+e.height}}const wye=["top","right","bottom","left"];wye.reduce((e,t)=>e.concat(t,t+"-start",t+"-end"),[]);function ql(e){var t;return((t=e.ownerDocument)==null?void 0:t.defaultView)||window}function UY(e){return ql(e).getComputedStyle(e)}function jY(e){return e instanceof ql(e).Node}function zY(e){return jY(e)?(e.nodeName||"").toLowerCase():""}function $O(e){return e instanceof ql(e).HTMLElement}function zp(e){return e instanceof ql(e).Element}function zB(e){return typeof ShadowRoot>"u"?!1:e instanceof ql(e).ShadowRoot||e instanceof ShadowRoot}function VY(e){const{overflow:t,overflowX:r,overflowY:n,display:i}=UY(e);return/auto|scroll|overlay|hidden|clip/.test(t+n+r)&&!["inline","contents"].includes(i)}function Eye(){return!(typeof CSS>"u"||!CSS.supports)&&CSS.supports("-webkit-backdrop-filter","none")}function Aye(e){return["html","body","#document"].includes(zY(e))}const S_=Math.round;function Pye(e){const t=UY(e);let r=parseFloat(t.width)||0,n=parseFloat(t.height)||0;const i=$O(e),a=i?e.offsetWidth:r,o=i?e.offsetHeight:n,s=S_(r)!==a||S_(n)!==o;return s&&(r=a,n=o),{width:r,height:n,fallback:s}}function HY(e){return zp(e)?e:e.contextElement}const GY={x:1,y:1};function K4(e){const t=HY(e);if(!$O(t))return GY;const r=t.getBoundingClientRect(),{width:n,height:i,fallback:a}=Pye(t);let o=(a?S_(r.width):r.width)/n,s=(a?S_(r.height):r.height)/i;return o&&Number.isFinite(o)||(o=1),s&&Number.isFinite(s)||(s=1),{x:o,y:s}}const VB={x:0,y:0};function Tye(e,t,r){var n,i;if(t===void 0&&(t=!0),!Eye())return VB;const a=e?ql(e):window;return!r||t&&r!==a?VB:{x:((n=a.visualViewport)==null?void 0:n.offsetLeft)||0,y:((i=a.visualViewport)==null?void 0:i.offsetTop)||0}}function HB(e,t,r,n){t===void 0&&(t=!1),r===void 0&&(r=!1);const i=e.getBoundingClientRect(),a=HY(e);let o=GY;t&&(n?zp(n)&&(o=K4(n)):o=K4(e));const s=Tye(a,r,n);let u=(i.left+s.x)/o.x,l=(i.top+s.y)/o.y,c=i.width/o.x,d=i.height/o.y;if(a){const f=ql(a),h=n&&zp(n)?ql(n):n;let v=f.frameElement;for(;v&&n&&h!==f;){const p=K4(v),m=v.getBoundingClientRect(),g=getComputedStyle(v);m.x+=(v.clientLeft+parseFloat(g.paddingLeft))*p.x,m.y+=(v.clientTop+parseFloat(g.paddingTop))*p.y,u*=p.x,l*=p.y,c*=p.x,d*=p.y,u+=m.x,l+=m.y,v=ql(v).frameElement}}return _ye({width:c,height:d,x:u,y:l})}function Iye(e){return((jY(e)?e.ownerDocument:e.document)||window.document).documentElement}function Mye(e){if(zY(e)==="html")return e;const t=e.assignedSlot||e.parentNode||zB(e)&&e.host||Iye(e);return zB(t)?t.host:t}function qY(e){const t=Mye(e);return Aye(t)?t.ownerDocument.body:$O(t)&&VY(t)?t:qY(t)}function uC(e,t){var r;t===void 0&&(t=[]);const n=qY(e),i=n===((r=e.ownerDocument)==null?void 0:r.body),a=ql(n);return i?t.concat(a,a.visualViewport||[],VY(n)?n:[]):t.concat(n,uC(n))}function Dye(e,t,r,n){n===void 0&&(n={});const{ancestorScroll:i=!0,ancestorResize:a=!0,elementResize:o=!0,animationFrame:s=!1}=n,u=i||a?[...zp(e)?uC(e):e.contextElement?uC(e.contextElement):[],...uC(t)]:[];u.forEach(f=>{const h=!zp(f)&&f.toString().includes("V");!i||s&&!h||f.addEventListener("scroll",r,{passive:!0}),a&&f.addEventListener("resize",r)});let l,c=null;o&&(c=new ResizeObserver(()=>{r()}),zp(e)&&!s&&c.observe(e),zp(e)||!e.contextElement||s||c.observe(e.contextElement),c.observe(t));let d=s?HB(e):null;return s&&function f(){const h=HB(e);!d||h.x===d.x&&h.y===d.y&&h.width===d.width&&h.height===d.height||r(),d=h,l=requestAnimationFrame(f)}(),r(),()=>{var f;u.forEach(h=>{i&&h.removeEventListener("scroll",r),a&&h.removeEventListener("resize",r)}),(f=c)==null||f.disconnect(),c=null,s&&cancelAnimationFrame(l)}}var u5=_e.useLayoutEffect,Rye=["className","clearValue","cx","getStyles","getClassNames","getValue","hasValue","isMulti","isRtl","options","selectOption","selectProps","setValue","theme"],C_=function(){};function kye(e,t){return t?t[0]==="-"?e+t:e+"__"+t:e}function Oye(e,t){for(var r=arguments.length,n=new Array(r>2?r-2:0),i=2;i<r;i++)n[i-2]=arguments[i];var a=[].concat(n);if(t&&e)for(var o in t)t.hasOwnProperty(o)&&t[o]&&a.push("".concat(kye(e,o)));return a.filter(function(s){return s}).map(function(s){return String(s).trim()}).join(" ")}var GB=function(t){return Hye(t)?t.filter(Boolean):xv(t)==="object"&&t!==null?[t]:[]},$Y=function(t){t.className,t.clearValue,t.cx,t.getStyles,t.getClassNames,t.getValue,t.hasValue,t.isMulti,t.isRtl,t.options,t.selectOption,t.selectProps,t.setValue,t.theme;var r=R0(t,Rye);return gr({},r)},_i=function(t,r,n){var i=t.cx,a=t.getStyles,o=t.getClassNames,s=t.className;return{css:a(r,t),className:i(n??{},o(r,t),s)}};function fE(e){return[document.documentElement,document.body,window].indexOf(e)>-1}function Fye(e){return fE(e)?window.innerHeight:e.clientHeight}function WY(e){return fE(e)?window.pageYOffset:e.scrollTop}function __(e,t){if(fE(e)){window.scrollTo(0,t);return}e.scrollTop=t}function Lye(e){var t=getComputedStyle(e),r=t.position==="absolute",n=/(auto|scroll)/;if(t.position==="fixed")return document.documentElement;for(var i=e;i=i.parentElement;)if(t=getComputedStyle(i),!(r&&t.position==="static")&&n.test(t.overflow+t.overflowY+t.overflowX))return i;return document.documentElement}function Nye(e,t,r,n){return r*((e=e/n-1)*e*e+1)+t}function _x(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:200,n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:C_,i=WY(e),a=t-i,o=10,s=0;function u(){s+=o;var l=Nye(s,i,a,r);__(e,l),s<r?window.requestAnimationFrame(u):n(e)}u()}function qB(e,t){var r=e.getBoundingClientRect(),n=t.getBoundingClientRect(),i=t.offsetHeight/3;n.bottom+i>r.bottom?__(e,Math.min(t.offsetTop+t.clientHeight-e.offsetHeight+i,e.scrollHeight)):n.top-i<r.top&&__(e,Math.max(t.offsetTop-i,0))}function Bye(e){var t=e.getBoundingClientRect();return{bottom:t.bottom,height:t.height,left:t.left,right:t.right,top:t.top,width:t.width}}function $B(){try{return document.createEvent("TouchEvent"),!0}catch{return!1}}function Uye(){try{return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)}catch{return!1}}var XY=!1,jye={get passive(){return XY=!0}},wx=typeof window<"u"?window:{};wx.addEventListener&&wx.removeEventListener&&(wx.addEventListener("p",C_,jye),wx.removeEventListener("p",C_,!1));var zye=XY;function Vye(e){return e!=null}function Hye(e){return Array.isArray(e)}function Ex(e,t,r){return e?t:r}var Gye=function(t){for(var r=arguments.length,n=new Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];var a=Object.entries(t).filter(function(o){var s=$c(o,1),u=s[0];return!n.includes(u)});return a.reduce(function(o,s){var u=$c(s,2),l=u[0],c=u[1];return o[l]=c,o},{})};function qye(e){var t=e.maxHeight,r=e.menuEl,n=e.minHeight,i=e.placement,a=e.shouldScroll,o=e.isFixedPosition,s=e.controlHeight,u=Lye(r),l={placement:"bottom",maxHeight:t};if(!r||!r.offsetParent)return l;var c=u.getBoundingClientRect(),d=c.height,f=r.getBoundingClientRect(),h=f.bottom,v=f.height,p=f.top,m=r.offsetParent.getBoundingClientRect(),g=m.top,y=o?window.innerHeight:Fye(u),b=WY(u),S=parseInt(getComputedStyle(r).marginBottom,10),x=parseInt(getComputedStyle(r).marginTop,10),C=g-x,w=y-p,A=C+b,M=d-b-p,D=h-y+b+S,k=b+p-x,R=160;switch(i){case"auto":case"bottom":if(w>=v)return{placement:"bottom",maxHeight:t};if(M>=v&&!o)return a&&_x(u,D,R),{placement:"bottom",maxHeight:t};if(!o&&M>=n||o&&w>=n){a&&_x(u,D,R);var O=o?w-S:M-S;return{placement:"bottom",maxHeight:O}}if(i==="auto"||o){var H=t,B=o?C:A;return B>=n&&(H=Math.min(B-S-s,t)),{placement:"top",maxHeight:H}}if(i==="bottom")return a&&__(u,D),{placement:"bottom",maxHeight:t};break;case"top":if(C>=v)return{placement:"top",maxHeight:t};if(A>=v&&!o)return a&&_x(u,k,R),{placement:"top",maxHeight:t};if(!o&&A>=n||o&&C>=n){var j=t;return(!o&&A>=n||o&&C>=n)&&(j=o?C-x:A-x),a&&_x(u,k,R),{placement:"top",maxHeight:j}}return{placement:"bottom",maxHeight:t};default:throw new Error('Invalid placement provided "'.concat(i,'".'))}return l}function $ye(e){var t={bottom:"top",top:"bottom"};return e?t[e]:"bottom"}var YY=function(t){return t==="auto"?"bottom":t},Wye=function(t,r){var n,i=t.placement,a=t.theme,o=a.borderRadius,s=a.spacing,u=a.colors;return gr((n={label:"menu"},i1(n,$ye(i),"100%"),i1(n,"position","absolute"),i1(n,"width","100%"),i1(n,"zIndex",1),n),r?{}:{backgroundColor:u.neutral0,borderRadius:o,boxShadow:"0 0 0 1px hsla(0, 0%, 0%, 0.1), 0 4px 11px hsla(0, 0%, 0%, 0.1)",marginBottom:s.menuGutter,marginTop:s.menuGutter})},KY=_e.createContext(null),Xye=function(t){var r=t.children,n=t.minMenuHeight,i=t.maxMenuHeight,a=t.menuPlacement,o=t.menuPosition,s=t.menuShouldScrollIntoView,u=t.theme,l=_e.useContext(KY)||{},c=l.setPortalPlacement,d=_e.useRef(null),f=_e.useState(i),h=$c(f,2),v=h[0],p=h[1],m=_e.useState(null),g=$c(m,2),y=g[0],b=g[1],S=u.spacing.controlHeight;return u5(function(){var x=d.current;if(x){var C=o==="fixed",w=s&&!C,A=qye({maxHeight:i,menuEl:x,minHeight:n,placement:a,shouldScroll:w,isFixedPosition:C,controlHeight:S});p(A.maxHeight),b(A.placement),c==null||c(A.placement)}},[i,a,o,s,n,c,S]),r({ref:d,placerProps:gr(gr({},t),{},{placement:y||YY(a),maxHeight:v})})},Yye=function(t){var r=t.children,n=t.innerRef,i=t.innerProps;return hr("div",vr({},_i(t,"menu",{menu:!0}),{ref:n},i),r)},Kye=Yye,Qye=function(t,r){var n=t.maxHeight,i=t.theme.spacing.baseUnit;return gr({maxHeight:n,overflowY:"auto",position:"relative",WebkitOverflowScrolling:"touch"},r?{}:{paddingBottom:i,paddingTop:i})},Zye=function(t){var r=t.children,n=t.innerProps,i=t.innerRef,a=t.isMulti;return hr("div",vr({},_i(t,"menuList",{"menu-list":!0,"menu-list--is-multi":a}),{ref:i},n),r)},QY=function(t,r){var n=t.theme,i=n.spacing.baseUnit,a=n.colors;return gr({textAlign:"center"},r?{}:{color:a.neutral40,padding:"".concat(i*2,"px ").concat(i*3,"px")})},Jye=QY,e1e=QY,ZY=function(t){var r=t.children,n=t.innerProps;return hr("div",vr({},_i(t,"noOptionsMessage",{"menu-notice":!0,"menu-notice--no-options":!0}),n),r)};ZY.defaultProps={children:"No options"};var JY=function(t){var r=t.children,n=t.innerProps;return hr("div",vr({},_i(t,"loadingMessage",{"menu-notice":!0,"menu-notice--loading":!0}),n),r)};JY.defaultProps={children:"Loading..."};var t1e=function(t){var r=t.rect,n=t.offset,i=t.position;return{left:r.left,position:i,top:n,width:r.width,zIndex:1}},r1e=function(t){var r=t.appendTo,n=t.children,i=t.controlElement,a=t.innerProps,o=t.menuPlacement,s=t.menuPosition,u=_e.useRef(null),l=_e.useRef(null),c=_e.useState(YY(o)),d=$c(c,2),f=d[0],h=d[1],v=_e.useMemo(function(){return{setPortalPlacement:h}},[]),p=_e.useState(null),m=$c(p,2),g=m[0],y=m[1],b=_e.useCallback(function(){if(i){var w=Bye(i),A=s==="fixed"?0:window.pageYOffset,M=w[f]+A;(M!==(g==null?void 0:g.offset)||w.left!==(g==null?void 0:g.rect.left)||w.width!==(g==null?void 0:g.rect.width))&&y({offset:M,rect:w})}},[i,s,f,g==null?void 0:g.offset,g==null?void 0:g.rect.left,g==null?void 0:g.rect.width]);u5(function(){b()},[b]);var S=_e.useCallback(function(){typeof l.current=="function"&&(l.current(),l.current=null),i&&u.current&&(l.current=Dye(i,u.current,b,{elementResize:"ResizeObserver"in window}))},[i,b]);u5(function(){S()},[S]);var x=_e.useCallback(function(w){u.current=w,S()},[S]);if(!r&&s!=="fixed"||!g)return null;var C=hr("div",vr({ref:x},_i(gr(gr({},t),{},{offset:g.offset,position:s,rect:g.rect}),"menuPortal",{"menu-portal":!0}),a),n);return hr(KY.Provider,{value:v},r?M3.createPortal(C,r):C)},n1e=function(t){var r=t.isDisabled,n=t.isRtl;return{label:"container",direction:n?"rtl":void 0,pointerEvents:r?"none":void 0,position:"relative"}},i1e=function(t){var r=t.children,n=t.innerProps,i=t.isDisabled,a=t.isRtl;return hr("div",vr({},_i(t,"container",{"--is-disabled":i,"--is-rtl":a}),n),r)},a1e=function(t,r){var n=t.theme.spacing,i=t.isMulti,a=t.hasValue,o=t.selectProps.controlShouldRenderValue;return gr({alignItems:"center",display:i&&a&&o?"flex":"grid",flex:1,flexWrap:"wrap",WebkitOverflowScrolling:"touch",position:"relative",overflow:"hidden"},r?{}:{padding:"".concat(n.baseUnit/2,"px ").concat(n.baseUnit*2,"px")})},o1e=function(t){var r=t.children,n=t.innerProps,i=t.isMulti,a=t.hasValue;return hr("div",vr({},_i(t,"valueContainer",{"value-container":!0,"value-container--is-multi":i,"value-container--has-value":a}),n),r)},s1e=function(){return{alignItems:"center",alignSelf:"stretch",display:"flex",flexShrink:0}},u1e=function(t){var r=t.children,n=t.innerProps;return hr("div",vr({},_i(t,"indicatorsContainer",{indicators:!0}),n),r)},WB,l1e=["size"],c1e={name:"8mmkcg",styles:"display:inline-block;fill:currentColor;line-height:1;stroke:currentColor;stroke-width:0"},eK=function(t){var r=t.size,n=R0(t,l1e);return hr("svg",vr({height:r,width:r,viewBox:"0 0 20 20","aria-hidden":"true",focusable:"false",css:c1e},n))},WO=function(t){return hr(eK,vr({size:20},t),hr("path",{d:"M14.348 14.849c-0.469 0.469-1.229 0.469-1.697 0l-2.651-3.030-2.651 3.029c-0.469 0.469-1.229 0.469-1.697 0-0.469-0.469-0.469-1.229 0-1.697l2.758-3.15-2.759-3.152c-0.469-0.469-0.469-1.228 0-1.697s1.228-0.469 1.697 0l2.652 3.031 2.651-3.031c0.469-0.469 1.228-0.469 1.697 0s0.469 1.229 0 1.697l-2.758 3.152 2.758 3.15c0.469 0.469 0.469 1.229 0 1.698z"}))},tK=function(t){return hr(eK,vr({size:20},t),hr("path",{d:"M4.516 7.548c0.436-0.446 1.043-0.481 1.576 0l3.908 3.747 3.908-3.747c0.533-0.481 1.141-0.446 1.574 0 0.436 0.445 0.408 1.197 0 1.615-0.406 0.418-4.695 4.502-4.695 4.502-0.217 0.223-0.502 0.335-0.787 0.335s-0.57-0.112-0.789-0.335c0 0-4.287-4.084-4.695-4.502s-0.436-1.17 0-1.615z"}))},rK=function(t,r){var n=t.isFocused,i=t.theme,a=i.spacing.baseUnit,o=i.colors;return gr({label:"indicatorContainer",display:"flex",transition:"color 150ms"},r?{}:{color:n?o.neutral60:o.neutral20,padding:a*2,":hover":{color:n?o.neutral80:o.neutral40}})},d1e=rK,f1e=function(t){var r=t.children,n=t.innerProps;return hr("div",vr({},_i(t,"dropdownIndicator",{indicator:!0,"dropdown-indicator":!0}),n),r||hr(tK,null))},h1e=rK,p1e=function(t){var r=t.children,n=t.innerProps;return hr("div",vr({},_i(t,"clearIndicator",{indicator:!0,"clear-indicator":!0}),n),r||hr(WO,null))},v1e=function(t,r){var n=t.isDisabled,i=t.theme,a=i.spacing.baseUnit,o=i.colors;return gr({label:"indicatorSeparator",alignSelf:"stretch",width:1},r?{}:{backgroundColor:n?o.neutral10:o.neutral20,marginBottom:a*2,marginTop:a*2})},m1e=function(t){var r=t.innerProps;return hr("span",vr({},r,_i(t,"indicatorSeparator",{"indicator-separator":!0})))},g1e=Sye(WB||(WB=Cye([`
  0%, 80%, 100% { opacity: 0; }
  40% { opacity: 1; }
`]))),y1e=function(t,r){var n=t.isFocused,i=t.size,a=t.theme,o=a.colors,s=a.spacing.baseUnit;return gr({label:"loadingIndicator",display:"flex",transition:"color 150ms",alignSelf:"center",fontSize:i,lineHeight:1,marginRight:i,textAlign:"center",verticalAlign:"middle"},r?{}:{color:n?o.neutral60:o.neutral20,padding:s*2})},Q4=function(t){var r=t.delay,n=t.offset;return hr("span",{css:qO({animation:"".concat(g1e," 1s ease-in-out ").concat(r,"ms infinite;"),backgroundColor:"currentColor",borderRadius:"1em",display:"inline-block",marginLeft:n?"1em":void 0,height:"1em",verticalAlign:"top",width:"1em"},"","")})},nK=function(t){var r=t.innerProps,n=t.isRtl;return hr("div",vr({},_i(t,"loadingIndicator",{indicator:!0,"loading-indicator":!0}),r),hr(Q4,{delay:0,offset:n}),hr(Q4,{delay:160,offset:!0}),hr(Q4,{delay:320,offset:!n}))};nK.defaultProps={size:4};var b1e=function(t,r){var n=t.isDisabled,i=t.isFocused,a=t.theme,o=a.colors,s=a.borderRadius,u=a.spacing;return gr({label:"control",alignItems:"center",cursor:"default",display:"flex",flexWrap:"wrap",justifyContent:"space-between",minHeight:u.controlHeight,outline:"0 !important",position:"relative",transition:"all 100ms"},r?{}:{backgroundColor:n?o.neutral5:o.neutral0,borderColor:n?o.neutral10:i?o.primary:o.neutral20,borderRadius:s,borderStyle:"solid",borderWidth:1,boxShadow:i?"0 0 0 1px ".concat(o.primary):void 0,"&:hover":{borderColor:i?o.primary:o.neutral30}})},x1e=function(t){var r=t.children,n=t.isDisabled,i=t.isFocused,a=t.innerRef,o=t.innerProps,s=t.menuIsOpen;return hr("div",vr({ref:a},_i(t,"control",{control:!0,"control--is-disabled":n,"control--is-focused":i,"control--menu-is-open":s}),o),r)},S1e=x1e,C1e=["data"],_1e=function(t,r){var n=t.theme.spacing;return r?{}:{paddingBottom:n.baseUnit*2,paddingTop:n.baseUnit*2}},w1e=function(t){var r=t.children,n=t.cx,i=t.getStyles,a=t.getClassNames,o=t.Heading,s=t.headingProps,u=t.innerProps,l=t.label,c=t.theme,d=t.selectProps;return hr("div",vr({},_i(t,"group",{group:!0}),u),hr(o,vr({},s,{selectProps:d,theme:c,getStyles:i,getClassNames:a,cx:n}),l),hr("div",null,r))},E1e=function(t,r){var n=t.theme,i=n.colors,a=n.spacing;return gr({label:"group",cursor:"default",display:"block"},r?{}:{color:i.neutral40,fontSize:"75%",fontWeight:500,marginBottom:"0.25em",paddingLeft:a.baseUnit*3,paddingRight:a.baseUnit*3,textTransform:"uppercase"})},A1e=function(t){var r=$Y(t);r.data;var n=R0(r,C1e);return hr("div",vr({},_i(t,"groupHeading",{"group-heading":!0}),n))},P1e=w1e,T1e=["innerRef","isDisabled","isHidden","inputClassName"],I1e=function(t,r){var n=t.isDisabled,i=t.value,a=t.theme,o=a.spacing,s=a.colors;return gr(gr({visibility:n?"hidden":"visible",transform:i?"translateZ(0)":""},M1e),r?{}:{margin:o.baseUnit/2,paddingBottom:o.baseUnit/2,paddingTop:o.baseUnit/2,color:s.neutral80})},iK={gridArea:"1 / 2",font:"inherit",minWidth:"2px",border:0,margin:0,outline:0,padding:0},M1e={flex:"1 1 auto",display:"inline-grid",gridArea:"1 / 1 / 2 / 3",gridTemplateColumns:"0 min-content","&:after":gr({content:'attr(data-value) " "',visibility:"hidden",whiteSpace:"pre"},iK)},D1e=function(t){return gr({label:"input",color:"inherit",background:0,opacity:t?0:1,width:"100%"},iK)},R1e=function(t){var r=t.cx,n=t.value,i=$Y(t),a=i.innerRef,o=i.isDisabled,s=i.isHidden,u=i.inputClassName,l=R0(i,T1e);return hr("div",vr({},_i(t,"input",{"input-container":!0}),{"data-value":n||""}),hr("input",vr({className:r({input:!0},u),ref:a,style:D1e(s),disabled:o},l)))},k1e=R1e,O1e=function(t,r){var n=t.theme,i=n.spacing,a=n.borderRadius,o=n.colors;return gr({label:"multiValue",display:"flex",minWidth:0},r?{}:{backgroundColor:o.neutral10,borderRadius:a/2,margin:i.baseUnit/2})},F1e=function(t,r){var n=t.theme,i=n.borderRadius,a=n.colors,o=t.cropWithEllipsis;return gr({overflow:"hidden",textOverflow:o||o===void 0?"ellipsis":void 0,whiteSpace:"nowrap"},r?{}:{borderRadius:i/2,color:a.neutral80,fontSize:"85%",padding:3,paddingLeft:6})},L1e=function(t,r){var n=t.theme,i=n.spacing,a=n.borderRadius,o=n.colors,s=t.isFocused;return gr({alignItems:"center",display:"flex"},r?{}:{borderRadius:a/2,backgroundColor:s?o.dangerLight:void 0,paddingLeft:i.baseUnit,paddingRight:i.baseUnit,":hover":{backgroundColor:o.dangerLight,color:o.danger}})},aK=function(t){var r=t.children,n=t.innerProps;return hr("div",n,r)},N1e=aK,B1e=aK;function U1e(e){var t=e.children,r=e.innerProps;return hr("div",vr({role:"button"},r),t||hr(WO,{size:14}))}var j1e=function(t){var r=t.children,n=t.components,i=t.data,a=t.innerProps,o=t.isDisabled,s=t.removeProps,u=t.selectProps,l=n.Container,c=n.Label,d=n.Remove;return hr(l,{data:i,innerProps:gr(gr({},_i(t,"multiValue",{"multi-value":!0,"multi-value--is-disabled":o})),a),selectProps:u},hr(c,{data:i,innerProps:gr({},_i(t,"multiValueLabel",{"multi-value__label":!0})),selectProps:u},r),hr(d,{data:i,innerProps:gr(gr({},_i(t,"multiValueRemove",{"multi-value__remove":!0})),{},{"aria-label":"Remove ".concat(r||"option")},s),selectProps:u}))},z1e=j1e,V1e=function(t,r){var n=t.isDisabled,i=t.isFocused,a=t.isSelected,o=t.theme,s=o.spacing,u=o.colors;return gr({label:"option",cursor:"default",display:"block",fontSize:"inherit",width:"100%",userSelect:"none",WebkitTapHighlightColor:"rgba(0, 0, 0, 0)"},r?{}:{backgroundColor:a?u.primary:i?u.primary25:"transparent",color:n?u.neutral20:a?u.neutral0:"inherit",padding:"".concat(s.baseUnit*2,"px ").concat(s.baseUnit*3,"px"),":active":{backgroundColor:n?void 0:a?u.primary:u.primary50}})},H1e=function(t){var r=t.children,n=t.isDisabled,i=t.isFocused,a=t.isSelected,o=t.innerRef,s=t.innerProps;return hr("div",vr({},_i(t,"option",{option:!0,"option--is-disabled":n,"option--is-focused":i,"option--is-selected":a}),{ref:o,"aria-disabled":n},s),r)},G1e=H1e,q1e=function(t,r){var n=t.theme,i=n.spacing,a=n.colors;return gr({label:"placeholder",gridArea:"1 / 1 / 2 / 3"},r?{}:{color:a.neutral50,marginLeft:i.baseUnit/2,marginRight:i.baseUnit/2})},$1e=function(t){var r=t.children,n=t.innerProps;return hr("div",vr({},_i(t,"placeholder",{placeholder:!0}),n),r)},W1e=$1e,X1e=function(t,r){var n=t.isDisabled,i=t.theme,a=i.spacing,o=i.colors;return gr({label:"singleValue",gridArea:"1 / 1 / 2 / 3",maxWidth:"100%",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},r?{}:{color:n?o.neutral40:o.neutral80,marginLeft:a.baseUnit/2,marginRight:a.baseUnit/2})},Y1e=function(t){var r=t.children,n=t.isDisabled,i=t.innerProps;return hr("div",vr({},_i(t,"singleValue",{"single-value":!0,"single-value--is-disabled":n}),i),r)},K1e=Y1e,Q1e={ClearIndicator:p1e,Control:S1e,DropdownIndicator:f1e,DownChevron:tK,CrossIcon:WO,Group:P1e,GroupHeading:A1e,IndicatorsContainer:u1e,IndicatorSeparator:m1e,Input:k1e,LoadingIndicator:nK,Menu:Kye,MenuList:Zye,MenuPortal:r1e,LoadingMessage:JY,NoOptionsMessage:ZY,MultiValue:z1e,MultiValueContainer:N1e,MultiValueLabel:B1e,MultiValueRemove:U1e,Option:G1e,Placeholder:W1e,SelectContainer:i1e,SingleValue:K1e,ValueContainer:o1e},Z1e=function(t){return gr(gr({},Q1e),t.components)},XB=Number.isNaN||function(t){return typeof t=="number"&&t!==t};function J1e(e,t){return!!(e===t||XB(e)&&XB(t))}function ebe(e,t){if(e.length!==t.length)return!1;for(var r=0;r<e.length;r++)if(!J1e(e[r],t[r]))return!1;return!0}function tbe(e,t){t===void 0&&(t=ebe);var r=null;function n(){for(var i=[],a=0;a<arguments.length;a++)i[a]=arguments[a];if(r&&r.lastThis===this&&t(i,r.lastArgs))return r.lastResult;var o=e.apply(this,i);return r={lastResult:o,lastArgs:i,lastThis:this},o}return n.clear=function(){r=null},n}var rbe={name:"7pg0cj-a11yText",styles:"label:a11yText;z-index:9999;border:0;clip:rect(1px, 1px, 1px, 1px);height:1px;width:1px;position:absolute;overflow:hidden;padding:0;white-space:nowrap"},nbe=function(t){return hr("span",vr({css:rbe},t))},YB=nbe,ibe={guidance:function(t){var r=t.isSearchable,n=t.isMulti,i=t.isDisabled,a=t.tabSelectsValue,o=t.context;switch(o){case"menu":return"Use Up and Down to choose options".concat(i?"":", press Enter to select the currently focused option",", press Escape to exit the menu").concat(a?", press Tab to select the option and exit the menu":"",".");case"input":return"".concat(t["aria-label"]||"Select"," is focused ").concat(r?",type to refine list":"",", press Down to open the menu, ").concat(n?" press left to focus selected values":"");case"value":return"Use left and right to toggle between focused values, press Backspace to remove the currently focused value";default:return""}},onChange:function(t){var r=t.action,n=t.label,i=n===void 0?"":n,a=t.labels,o=t.isDisabled;switch(r){case"deselect-option":case"pop-value":case"remove-value":return"option ".concat(i,", deselected.");case"clear":return"All selected options have been cleared.";case"initial-input-focus":return"option".concat(a.length>1?"s":""," ").concat(a.join(","),", selected.");case"select-option":return o?"option ".concat(i," is disabled. Select another option."):"option ".concat(i,", selected.");default:return""}},onFocus:function(t){var r=t.context,n=t.focused,i=t.options,a=t.label,o=a===void 0?"":a,s=t.selectValue,u=t.isDisabled,l=t.isSelected,c=function(v,p){return v&&v.length?"".concat(v.indexOf(p)+1," of ").concat(v.length):""};if(r==="value"&&s)return"value ".concat(o," focused, ").concat(c(s,n),".");if(r==="menu"){var d=u?" disabled":"",f="".concat(l?"selected":"focused").concat(d);return"option ".concat(o," ").concat(f,", ").concat(c(i,n),".")}return""},onFilter:function(t){var r=t.inputValue,n=t.resultsMessage;return"".concat(n).concat(r?" for search term "+r:"",".")}},abe=function(t){var r=t.ariaSelection,n=t.focusedOption,i=t.focusedValue,a=t.focusableOptions,o=t.isFocused,s=t.selectValue,u=t.selectProps,l=t.id,c=u.ariaLiveMessages,d=u.getOptionLabel,f=u.inputValue,h=u.isMulti,v=u.isOptionDisabled,p=u.isSearchable,m=u.menuIsOpen,g=u.options,y=u.screenReaderStatus,b=u.tabSelectsValue,S=u["aria-label"],x=u["aria-live"],C=_e.useMemo(function(){return gr(gr({},ibe),c||{})},[c]),w=_e.useMemo(function(){var H="";if(r&&C.onChange){var B=r.option,j=r.options,Y=r.removedValue,G=r.removedValues,$=r.value,q=function(J){return Array.isArray(J)?null:J},ee=Y||B||q($),fe=ee?d(ee):"",W=j||G||void 0,X=W?W.map(d):[],U=gr({isDisabled:ee&&v(ee,s),label:fe,labels:X},r);H=C.onChange(U)}return H},[r,C,v,s,d]),A=_e.useMemo(function(){var H="",B=n||i,j=!!(n&&s&&s.includes(n));if(B&&C.onFocus){var Y={focused:B,label:d(B),isDisabled:v(B,s),isSelected:j,options:a,context:B===n?"menu":"value",selectValue:s};H=C.onFocus(Y)}return H},[n,i,d,v,C,a,s]),M=_e.useMemo(function(){var H="";if(m&&g.length&&C.onFilter){var B=y({count:a.length});H=C.onFilter({inputValue:f,resultsMessage:B})}return H},[a,f,m,C,g,y]),D=_e.useMemo(function(){var H="";if(C.guidance){var B=i?"value":m?"menu":"input";H=C.guidance({"aria-label":S,context:B,isDisabled:n&&v(n,s),isMulti:h,isSearchable:p,tabSelectsValue:b})}return H},[S,n,i,h,v,p,m,C,s,b]),k="".concat(A," ").concat(M," ").concat(D),R=hr(_e.Fragment,null,hr("span",{id:"aria-selection"},w),hr("span",{id:"aria-context"},k)),O=(r==null?void 0:r.action)==="initial-input-focus";return hr(_e.Fragment,null,hr(YB,{id:l},O&&R),hr(YB,{"aria-live":x,"aria-atomic":"false","aria-relevant":"additions text"},o&&!O&&R))},obe=abe,l5=[{base:"A",letters:"A"},{base:"AA",letters:""},{base:"AE",letters:""},{base:"AO",letters:""},{base:"AU",letters:""},{base:"AV",letters:""},{base:"AY",letters:""},{base:"B",letters:"B"},{base:"C",letters:"C"},{base:"D",letters:"D"},{base:"DZ",letters:""},{base:"Dz",letters:""},{base:"E",letters:"E"},{base:"F",letters:"F"},{base:"G",letters:"G"},{base:"H",letters:"H"},{base:"I",letters:"I"},{base:"J",letters:"J"},{base:"K",letters:"K"},{base:"L",letters:"L"},{base:"LJ",letters:""},{base:"Lj",letters:""},{base:"M",letters:"M"},{base:"N",letters:"N"},{base:"NJ",letters:""},{base:"Nj",letters:""},{base:"O",letters:"O"},{base:"OI",letters:""},{base:"OO",letters:""},{base:"OU",letters:""},{base:"P",letters:"P"},{base:"Q",letters:"Q"},{base:"R",letters:"R"},{base:"S",letters:"S"},{base:"T",letters:"T"},{base:"TZ",letters:""},{base:"U",letters:"U"},{base:"V",letters:"V"},{base:"VY",letters:""},{base:"W",letters:"W"},{base:"X",letters:"X"},{base:"Y",letters:"Y"},{base:"Z",letters:"Z"},{base:"a",letters:"a"},{base:"aa",letters:""},{base:"ae",letters:""},{base:"ao",letters:""},{base:"au",letters:""},{base:"av",letters:""},{base:"ay",letters:""},{base:"b",letters:"b"},{base:"c",letters:"c"},{base:"d",letters:"d"},{base:"dz",letters:""},{base:"e",letters:"e"},{base:"f",letters:"f"},{base:"g",letters:"g"},{base:"h",letters:"h"},{base:"hv",letters:""},{base:"i",letters:"i"},{base:"j",letters:"j"},{base:"k",letters:"k"},{base:"l",letters:"l"},{base:"lj",letters:""},{base:"m",letters:"m"},{base:"n",letters:"n"},{base:"nj",letters:""},{base:"o",letters:"o"},{base:"oi",letters:""},{base:"ou",letters:""},{base:"oo",letters:""},{base:"p",letters:"p"},{base:"q",letters:"q"},{base:"r",letters:"r"},{base:"s",letters:"s"},{base:"t",letters:"t"},{base:"tz",letters:""},{base:"u",letters:"u"},{base:"v",letters:"v"},{base:"vy",letters:""},{base:"w",letters:"w"},{base:"x",letters:"x"},{base:"y",letters:"y"},{base:"z",letters:"z"}],sbe=new RegExp("["+l5.map(function(e){return e.letters}).join("")+"]","g"),oK={};for(var Z4=0;Z4<l5.length;Z4++)for(var J4=l5[Z4],eP=0;eP<J4.letters.length;eP++)oK[J4.letters[eP]]=J4.base;var sK=function(t){return t.replace(sbe,function(r){return oK[r]})},ube=tbe(sK),KB=function(t){return t.replace(/^\s+|\s+$/g,"")},lbe=function(t){return"".concat(t.label," ").concat(t.value)},cbe=function(t){return function(r,n){if(r.data.__isNew__)return!0;var i=gr({ignoreCase:!0,ignoreAccents:!0,stringify:lbe,trim:!0,matchFrom:"any"},t),a=i.ignoreCase,o=i.ignoreAccents,s=i.stringify,u=i.trim,l=i.matchFrom,c=u?KB(n):n,d=u?KB(s(r)):s(r);return a&&(c=c.toLowerCase(),d=d.toLowerCase()),o&&(c=ube(c),d=sK(d)),l==="start"?d.substr(0,c.length)===c:d.indexOf(c)>-1}},dbe=["innerRef"];function fbe(e){var t=e.innerRef,r=R0(e,dbe),n=Gye(r,"onExited","in","enter","exit","appear");return hr("input",vr({ref:t},n,{css:qO({label:"dummyInput",background:0,border:0,caretColor:"transparent",fontSize:"inherit",gridArea:"1 / 1 / 2 / 3",outline:0,padding:0,width:1,color:"transparent",left:-100,opacity:0,position:"relative",transform:"scale(.01)"},"","")}))}var hbe=function(t){t.preventDefault(),t.stopPropagation()};function pbe(e){var t=e.isEnabled,r=e.onBottomArrive,n=e.onBottomLeave,i=e.onTopArrive,a=e.onTopLeave,o=_e.useRef(!1),s=_e.useRef(!1),u=_e.useRef(0),l=_e.useRef(null),c=_e.useCallback(function(m,g){if(l.current!==null){var y=l.current,b=y.scrollTop,S=y.scrollHeight,x=y.clientHeight,C=l.current,w=g>0,A=S-x-b,M=!1;A>g&&o.current&&(n&&n(m),o.current=!1),w&&s.current&&(a&&a(m),s.current=!1),w&&g>A?(r&&!o.current&&r(m),C.scrollTop=S,M=!0,o.current=!0):!w&&-g>b&&(i&&!s.current&&i(m),C.scrollTop=0,M=!0,s.current=!0),M&&hbe(m)}},[r,n,i,a]),d=_e.useCallback(function(m){c(m,m.deltaY)},[c]),f=_e.useCallback(function(m){u.current=m.changedTouches[0].clientY},[]),h=_e.useCallback(function(m){var g=u.current-m.changedTouches[0].clientY;c(m,g)},[c]),v=_e.useCallback(function(m){if(m){var g=zye?{passive:!1}:!1;m.addEventListener("wheel",d,g),m.addEventListener("touchstart",f,g),m.addEventListener("touchmove",h,g)}},[h,f,d]),p=_e.useCallback(function(m){m&&(m.removeEventListener("wheel",d,!1),m.removeEventListener("touchstart",f,!1),m.removeEventListener("touchmove",h,!1))},[h,f,d]);return _e.useEffect(function(){if(t){var m=l.current;return v(m),function(){p(m)}}},[t,v,p]),function(m){l.current=m}}var QB=["boxSizing","height","overflow","paddingRight","position"],ZB={boxSizing:"border-box",overflow:"hidden",position:"relative",height:"100%"};function JB(e){e.preventDefault()}function e7(e){e.stopPropagation()}function t7(){var e=this.scrollTop,t=this.scrollHeight,r=e+this.offsetHeight;e===0?this.scrollTop=1:r===t&&(this.scrollTop=e-1)}function r7(){return"ontouchstart"in window||navigator.maxTouchPoints}var n7=!!(typeof window<"u"&&window.document&&window.document.createElement),gy=0,wm={capture:!1,passive:!1};function vbe(e){var t=e.isEnabled,r=e.accountForScrollbars,n=r===void 0?!0:r,i=_e.useRef({}),a=_e.useRef(null),o=_e.useCallback(function(u){if(n7){var l=document.body,c=l&&l.style;if(n&&QB.forEach(function(v){var p=c&&c[v];i.current[v]=p}),n&&gy<1){var d=parseInt(i.current.paddingRight,10)||0,f=document.body?document.body.clientWidth:0,h=window.innerWidth-f+d||0;Object.keys(ZB).forEach(function(v){var p=ZB[v];c&&(c[v]=p)}),c&&(c.paddingRight="".concat(h,"px"))}l&&r7()&&(l.addEventListener("touchmove",JB,wm),u&&(u.addEventListener("touchstart",t7,wm),u.addEventListener("touchmove",e7,wm))),gy+=1}},[n]),s=_e.useCallback(function(u){if(n7){var l=document.body,c=l&&l.style;gy=Math.max(gy-1,0),n&&gy<1&&QB.forEach(function(d){var f=i.current[d];c&&(c[d]=f)}),l&&r7()&&(l.removeEventListener("touchmove",JB,wm),u&&(u.removeEventListener("touchstart",t7,wm),u.removeEventListener("touchmove",e7,wm)))}},[n]);return _e.useEffect(function(){if(t){var u=a.current;return o(u),function(){s(u)}}},[t,o,s]),function(u){a.current=u}}var mbe=function(){return document.activeElement&&document.activeElement.blur()},gbe={name:"1kfdb0e",styles:"position:fixed;left:0;bottom:0;right:0;top:0"};function ybe(e){var t=e.children,r=e.lockEnabled,n=e.captureEnabled,i=n===void 0?!0:n,a=e.onBottomArrive,o=e.onBottomLeave,s=e.onTopArrive,u=e.onTopLeave,l=pbe({isEnabled:i,onBottomArrive:a,onBottomLeave:o,onTopArrive:s,onTopLeave:u}),c=vbe({isEnabled:r}),d=function(h){l(h),c(h)};return hr(_e.Fragment,null,r&&hr("div",{onClick:mbe,css:gbe}),t(d))}var bbe={name:"1a0ro4n-requiredInput",styles:"label:requiredInput;opacity:0;pointer-events:none;position:absolute;bottom:0;left:0;right:0;width:100%"},xbe=function(t){var r=t.name,n=t.onFocus;return hr("input",{required:!0,name:r,tabIndex:-1,"aria-hidden":"true",onFocus:n,css:bbe,value:"",onChange:function(){}})},Sbe=xbe,Cbe=function(t){return t.label},_be=function(t){return t.label},wbe=function(t){return t.value},Ebe=function(t){return!!t.isDisabled},Abe={clearIndicator:h1e,container:n1e,control:b1e,dropdownIndicator:d1e,group:_1e,groupHeading:E1e,indicatorsContainer:s1e,indicatorSeparator:v1e,input:I1e,loadingIndicator:y1e,loadingMessage:e1e,menu:Wye,menuList:Qye,menuPortal:t1e,multiValue:O1e,multiValueLabel:F1e,multiValueRemove:L1e,noOptionsMessage:Jye,option:V1e,placeholder:q1e,singleValue:X1e,valueContainer:a1e},Pbe={primary:"#2684FF",primary75:"#4C9AFF",primary50:"#B2D4FF",primary25:"#DEEBFF",danger:"#DE350B",dangerLight:"#FFBDAD",neutral0:"hsl(0, 0%, 100%)",neutral5:"hsl(0, 0%, 95%)",neutral10:"hsl(0, 0%, 90%)",neutral20:"hsl(0, 0%, 80%)",neutral30:"hsl(0, 0%, 70%)",neutral40:"hsl(0, 0%, 60%)",neutral50:"hsl(0, 0%, 50%)",neutral60:"hsl(0, 0%, 40%)",neutral70:"hsl(0, 0%, 30%)",neutral80:"hsl(0, 0%, 20%)",neutral90:"hsl(0, 0%, 10%)"},Tbe=4,uK=4,Ibe=38,Mbe=uK*2,Dbe={baseUnit:uK,controlHeight:Ibe,menuGutter:Mbe},tP={borderRadius:Tbe,colors:Pbe,spacing:Dbe},Rbe={"aria-live":"polite",backspaceRemovesValue:!0,blurInputOnSelect:$B(),captureMenuScroll:!$B(),classNames:{},closeMenuOnSelect:!0,closeMenuOnScroll:!1,components:{},controlShouldRenderValue:!0,escapeClearsValue:!1,filterOption:cbe(),formatGroupLabel:Cbe,getOptionLabel:_be,getOptionValue:wbe,isDisabled:!1,isLoading:!1,isMulti:!1,isRtl:!1,isSearchable:!0,isOptionDisabled:Ebe,loadingMessage:function(){return"Loading..."},maxMenuHeight:300,minMenuHeight:140,menuIsOpen:!1,menuPlacement:"bottom",menuPosition:"absolute",menuShouldBlockScroll:!1,menuShouldScrollIntoView:!Uye(),noOptionsMessage:function(){return"No options"},openMenuOnFocus:!1,openMenuOnClick:!0,options:[],pageSize:5,placeholder:"Select...",screenReaderStatus:function(t){var r=t.count;return"".concat(r," result").concat(r!==1?"s":""," available")},styles:{},tabIndex:0,tabSelectsValue:!0,unstyled:!1};function i7(e,t,r,n){var i=fK(e,t,r),a=hK(e,t,r),o=dK(e,t),s=w_(e,t);return{type:"option",data:t,isDisabled:i,isSelected:a,label:o,value:s,index:n}}function lK(e,t){return e.options.map(function(r,n){if("options"in r){var i=r.options.map(function(o,s){return i7(e,o,t,s)}).filter(function(o){return a7(e,o)});return i.length>0?{type:"group",data:r,options:i,index:n}:void 0}var a=i7(e,r,t,n);return a7(e,a)?a:void 0}).filter(Vye)}function cK(e){return e.reduce(function(t,r){return r.type==="group"?t.push.apply(t,PY(r.options.map(function(n){return n.data}))):t.push(r.data),t},[])}function kbe(e,t){return cK(lK(e,t))}function a7(e,t){var r=e.inputValue,n=r===void 0?"":r,i=t.data,a=t.isSelected,o=t.label,s=t.value;return(!vK(e)||!a)&&pK(e,{label:o,value:s,data:i},n)}function Obe(e,t){var r=e.focusedValue,n=e.selectValue,i=n.indexOf(r);if(i>-1){var a=t.indexOf(r);if(a>-1)return r;if(i<t.length)return t[i]}return null}function Fbe(e,t){var r=e.focusedOption;return r&&t.indexOf(r)>-1?r:t[0]}var dK=function(t,r){return t.getOptionLabel(r)},w_=function(t,r){return t.getOptionValue(r)};function fK(e,t,r){return typeof e.isOptionDisabled=="function"?e.isOptionDisabled(t,r):!1}function hK(e,t,r){if(r.indexOf(t)>-1)return!0;if(typeof e.isOptionSelected=="function")return e.isOptionSelected(t,r);var n=w_(e,t);return r.some(function(i){return w_(e,i)===n})}function pK(e,t,r){return e.filterOption?e.filterOption(t,r):!0}var vK=function(t){var r=t.hideSelectedOptions,n=t.isMulti;return r===void 0?n:r},Lbe=1,mK=function(e){x0e(r,e);var t=w0e(r);function r(n){var i;if(y0e(this,r),i=t.call(this,n),i.state={ariaSelection:null,focusedOption:null,focusedValue:null,inputIsHidden:!1,isFocused:!1,selectValue:[],clearFocusValueOnUpdate:!1,prevWasFocused:!1,inputIsHiddenAfterUpdate:void 0,prevProps:void 0},i.blockOptionHover=!1,i.isComposing=!1,i.commonProps=void 0,i.initialTouchX=0,i.initialTouchY=0,i.instancePrefix="",i.openAfterFocus=!1,i.scrollToFocusedOptionOnUpdate=!1,i.userIsDragging=void 0,i.controlRef=null,i.getControlRef=function(s){i.controlRef=s},i.focusedOptionRef=null,i.getFocusedOptionRef=function(s){i.focusedOptionRef=s},i.menuListRef=null,i.getMenuListRef=function(s){i.menuListRef=s},i.inputRef=null,i.getInputRef=function(s){i.inputRef=s},i.focus=i.focusInput,i.blur=i.blurInput,i.onChange=function(s,u){var l=i.props,c=l.onChange,d=l.name;u.name=d,i.ariaOnChange(s,u),c(s,u)},i.setValue=function(s,u,l){var c=i.props,d=c.closeMenuOnSelect,f=c.isMulti,h=c.inputValue;i.onInputChange("",{action:"set-value",prevInputValue:h}),d&&(i.setState({inputIsHiddenAfterUpdate:!f}),i.onMenuClose()),i.setState({clearFocusValueOnUpdate:!0}),i.onChange(s,{action:u,option:l})},i.selectOption=function(s){var u=i.props,l=u.blurInputOnSelect,c=u.isMulti,d=u.name,f=i.state.selectValue,h=c&&i.isOptionSelected(s,f),v=i.isOptionDisabled(s,f);if(h){var p=i.getOptionValue(s);i.setValue(f.filter(function(m){return i.getOptionValue(m)!==p}),"deselect-option",s)}else if(!v)c?i.setValue([].concat(PY(f),[s]),"select-option",s):i.setValue(s,"select-option");else{i.ariaOnChange(s,{action:"select-option",option:s,name:d});return}l&&i.blurInput()},i.removeValue=function(s){var u=i.props.isMulti,l=i.state.selectValue,c=i.getOptionValue(s),d=l.filter(function(h){return i.getOptionValue(h)!==c}),f=Ex(u,d,d[0]||null);i.onChange(f,{action:"remove-value",removedValue:s}),i.focusInput()},i.clearValue=function(){var s=i.state.selectValue;i.onChange(Ex(i.props.isMulti,[],null),{action:"clear",removedValues:s})},i.popValue=function(){var s=i.props.isMulti,u=i.state.selectValue,l=u[u.length-1],c=u.slice(0,u.length-1),d=Ex(s,c,c[0]||null);i.onChange(d,{action:"pop-value",removedValue:l})},i.getValue=function(){return i.state.selectValue},i.cx=function(){for(var s=arguments.length,u=new Array(s),l=0;l<s;l++)u[l]=arguments[l];return Oye.apply(void 0,[i.props.classNamePrefix].concat(u))},i.getOptionLabel=function(s){return dK(i.props,s)},i.getOptionValue=function(s){return w_(i.props,s)},i.getStyles=function(s,u){var l=i.props.unstyled,c=Abe[s](u,l);c.boxSizing="border-box";var d=i.props.styles[s];return d?d(c,u):c},i.getClassNames=function(s,u){var l,c;return(l=(c=i.props.classNames)[s])===null||l===void 0?void 0:l.call(c,u)},i.getElementId=function(s){return"".concat(i.instancePrefix,"-").concat(s)},i.getComponents=function(){return Z1e(i.props)},i.buildCategorizedOptions=function(){return lK(i.props,i.state.selectValue)},i.getCategorizedOptions=function(){return i.props.menuIsOpen?i.buildCategorizedOptions():[]},i.buildFocusableOptions=function(){return cK(i.buildCategorizedOptions())},i.getFocusableOptions=function(){return i.props.menuIsOpen?i.buildFocusableOptions():[]},i.ariaOnChange=function(s,u){i.setState({ariaSelection:gr({value:s},u)})},i.onMenuMouseDown=function(s){s.button===0&&(s.stopPropagation(),s.preventDefault(),i.focusInput())},i.onMenuMouseMove=function(s){i.blockOptionHover=!1},i.onControlMouseDown=function(s){if(!s.defaultPrevented){var u=i.props.openMenuOnClick;i.state.isFocused?i.props.menuIsOpen?s.target.tagName!=="INPUT"&&s.target.tagName!=="TEXTAREA"&&i.onMenuClose():u&&i.openMenu("first"):(u&&(i.openAfterFocus=!0),i.focusInput()),s.target.tagName!=="INPUT"&&s.target.tagName!=="TEXTAREA"&&s.preventDefault()}},i.onDropdownIndicatorMouseDown=function(s){if(!(s&&s.type==="mousedown"&&s.button!==0)&&!i.props.isDisabled){var u=i.props,l=u.isMulti,c=u.menuIsOpen;i.focusInput(),c?(i.setState({inputIsHiddenAfterUpdate:!l}),i.onMenuClose()):i.openMenu("first"),s.preventDefault()}},i.onClearIndicatorMouseDown=function(s){s&&s.type==="mousedown"&&s.button!==0||(i.clearValue(),s.preventDefault(),i.openAfterFocus=!1,s.type==="touchend"?i.focusInput():setTimeout(function(){return i.focusInput()}))},i.onScroll=function(s){typeof i.props.closeMenuOnScroll=="boolean"?s.target instanceof HTMLElement&&fE(s.target)&&i.props.onMenuClose():typeof i.props.closeMenuOnScroll=="function"&&i.props.closeMenuOnScroll(s)&&i.props.onMenuClose()},i.onCompositionStart=function(){i.isComposing=!0},i.onCompositionEnd=function(){i.isComposing=!1},i.onTouchStart=function(s){var u=s.touches,l=u&&u.item(0);l&&(i.initialTouchX=l.clientX,i.initialTouchY=l.clientY,i.userIsDragging=!1)},i.onTouchMove=function(s){var u=s.touches,l=u&&u.item(0);if(l){var c=Math.abs(l.clientX-i.initialTouchX),d=Math.abs(l.clientY-i.initialTouchY),f=5;i.userIsDragging=c>f||d>f}},i.onTouchEnd=function(s){i.userIsDragging||(i.controlRef&&!i.controlRef.contains(s.target)&&i.menuListRef&&!i.menuListRef.contains(s.target)&&i.blurInput(),i.initialTouchX=0,i.initialTouchY=0)},i.onControlTouchEnd=function(s){i.userIsDragging||i.onControlMouseDown(s)},i.onClearIndicatorTouchEnd=function(s){i.userIsDragging||i.onClearIndicatorMouseDown(s)},i.onDropdownIndicatorTouchEnd=function(s){i.userIsDragging||i.onDropdownIndicatorMouseDown(s)},i.handleInputChange=function(s){var u=i.props.inputValue,l=s.currentTarget.value;i.setState({inputIsHiddenAfterUpdate:!1}),i.onInputChange(l,{action:"input-change",prevInputValue:u}),i.props.menuIsOpen||i.onMenuOpen()},i.onInputFocus=function(s){i.props.onFocus&&i.props.onFocus(s),i.setState({inputIsHiddenAfterUpdate:!1,isFocused:!0}),(i.openAfterFocus||i.props.openMenuOnFocus)&&i.openMenu("first"),i.openAfterFocus=!1},i.onInputBlur=function(s){var u=i.props.inputValue;if(i.menuListRef&&i.menuListRef.contains(document.activeElement)){i.inputRef.focus();return}i.props.onBlur&&i.props.onBlur(s),i.onInputChange("",{action:"input-blur",prevInputValue:u}),i.onMenuClose(),i.setState({focusedValue:null,isFocused:!1})},i.onOptionHover=function(s){i.blockOptionHover||i.state.focusedOption===s||i.setState({focusedOption:s})},i.shouldHideSelectedOptions=function(){return vK(i.props)},i.onValueInputFocus=function(s){s.preventDefault(),s.stopPropagation(),i.focus()},i.onKeyDown=function(s){var u=i.props,l=u.isMulti,c=u.backspaceRemovesValue,d=u.escapeClearsValue,f=u.inputValue,h=u.isClearable,v=u.isDisabled,p=u.menuIsOpen,m=u.onKeyDown,g=u.tabSelectsValue,y=u.openMenuOnFocus,b=i.state,S=b.focusedOption,x=b.focusedValue,C=b.selectValue;if(!v&&!(typeof m=="function"&&(m(s),s.defaultPrevented))){switch(i.blockOptionHover=!0,s.key){case"ArrowLeft":if(!l||f)return;i.focusValue("previous");break;case"ArrowRight":if(!l||f)return;i.focusValue("next");break;case"Delete":case"Backspace":if(f)return;if(x)i.removeValue(x);else{if(!c)return;l?i.popValue():h&&i.clearValue()}break;case"Tab":if(i.isComposing||s.shiftKey||!p||!g||!S||y&&i.isOptionSelected(S,C))return;i.selectOption(S);break;case"Enter":if(s.keyCode===229)break;if(p){if(!S||i.isComposing)return;i.selectOption(S);break}return;case"Escape":p?(i.setState({inputIsHiddenAfterUpdate:!1}),i.onInputChange("",{action:"menu-close",prevInputValue:f}),i.onMenuClose()):h&&d&&i.clearValue();break;case" ":if(f)return;if(!p){i.openMenu("first");break}if(!S)return;i.selectOption(S);break;case"ArrowUp":p?i.focusOption("up"):i.openMenu("last");break;case"ArrowDown":p?i.focusOption("down"):i.openMenu("first");break;case"PageUp":if(!p)return;i.focusOption("pageup");break;case"PageDown":if(!p)return;i.focusOption("pagedown");break;case"Home":if(!p)return;i.focusOption("first");break;case"End":if(!p)return;i.focusOption("last");break;default:return}s.preventDefault()}},i.instancePrefix="react-select-"+(i.props.instanceId||++Lbe),i.state.selectValue=GB(n.value),n.menuIsOpen&&i.state.selectValue.length){var a=i.buildFocusableOptions(),o=a.indexOf(i.state.selectValue[0]);i.state.focusedOption=a[o]}return i}return b0e(r,[{key:"componentDidMount",value:function(){this.startListeningComposition(),this.startListeningToTouch(),this.props.closeMenuOnScroll&&document&&document.addEventListener&&document.addEventListener("scroll",this.onScroll,!0),this.props.autoFocus&&this.focusInput(),this.props.menuIsOpen&&this.state.focusedOption&&this.menuListRef&&this.focusedOptionRef&&qB(this.menuListRef,this.focusedOptionRef)}},{key:"componentDidUpdate",value:function(i){var a=this.props,o=a.isDisabled,s=a.menuIsOpen,u=this.state.isFocused;(u&&!o&&i.isDisabled||u&&s&&!i.menuIsOpen)&&this.focusInput(),u&&o&&!i.isDisabled?this.setState({isFocused:!1},this.onMenuClose):!u&&!o&&i.isDisabled&&this.inputRef===document.activeElement&&this.setState({isFocused:!0}),this.menuListRef&&this.focusedOptionRef&&this.scrollToFocusedOptionOnUpdate&&(qB(this.menuListRef,this.focusedOptionRef),this.scrollToFocusedOptionOnUpdate=!1)}},{key:"componentWillUnmount",value:function(){this.stopListeningComposition(),this.stopListeningToTouch(),document.removeEventListener("scroll",this.onScroll,!0)}},{key:"onMenuOpen",value:function(){this.props.onMenuOpen()}},{key:"onMenuClose",value:function(){this.onInputChange("",{action:"menu-close",prevInputValue:this.props.inputValue}),this.props.onMenuClose()}},{key:"onInputChange",value:function(i,a){this.props.onInputChange(i,a)}},{key:"focusInput",value:function(){this.inputRef&&this.inputRef.focus()}},{key:"blurInput",value:function(){this.inputRef&&this.inputRef.blur()}},{key:"openMenu",value:function(i){var a=this,o=this.state,s=o.selectValue,u=o.isFocused,l=this.buildFocusableOptions(),c=i==="first"?0:l.length-1;if(!this.props.isMulti){var d=l.indexOf(s[0]);d>-1&&(c=d)}this.scrollToFocusedOptionOnUpdate=!(u&&this.menuListRef),this.setState({inputIsHiddenAfterUpdate:!1,focusedValue:null,focusedOption:l[c]},function(){return a.onMenuOpen()})}},{key:"focusValue",value:function(i){var a=this.state,o=a.selectValue,s=a.focusedValue;if(this.props.isMulti){this.setState({focusedOption:null});var u=o.indexOf(s);s||(u=-1);var l=o.length-1,c=-1;if(o.length){switch(i){case"previous":u===0?c=0:u===-1?c=l:c=u-1;break;case"next":u>-1&&u<l&&(c=u+1);break}this.setState({inputIsHidden:c!==-1,focusedValue:o[c]})}}}},{key:"focusOption",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"first",a=this.props.pageSize,o=this.state.focusedOption,s=this.getFocusableOptions();if(s.length){var u=0,l=s.indexOf(o);o||(l=-1),i==="up"?u=l>0?l-1:s.length-1:i==="down"?u=(l+1)%s.length:i==="pageup"?(u=l-a,u<0&&(u=0)):i==="pagedown"?(u=l+a,u>s.length-1&&(u=s.length-1)):i==="last"&&(u=s.length-1),this.scrollToFocusedOptionOnUpdate=!0,this.setState({focusedOption:s[u],focusedValue:null})}}},{key:"getTheme",value:function(){return this.props.theme?typeof this.props.theme=="function"?this.props.theme(tP):gr(gr({},tP),this.props.theme):tP}},{key:"getCommonProps",value:function(){var i=this.clearValue,a=this.cx,o=this.getStyles,s=this.getClassNames,u=this.getValue,l=this.selectOption,c=this.setValue,d=this.props,f=d.isMulti,h=d.isRtl,v=d.options,p=this.hasValue();return{clearValue:i,cx:a,getStyles:o,getClassNames:s,getValue:u,hasValue:p,isMulti:f,isRtl:h,options:v,selectOption:l,selectProps:d,setValue:c,theme:this.getTheme()}}},{key:"hasValue",value:function(){var i=this.state.selectValue;return i.length>0}},{key:"hasOptions",value:function(){return!!this.getFocusableOptions().length}},{key:"isClearable",value:function(){var i=this.props,a=i.isClearable,o=i.isMulti;return a===void 0?o:a}},{key:"isOptionDisabled",value:function(i,a){return fK(this.props,i,a)}},{key:"isOptionSelected",value:function(i,a){return hK(this.props,i,a)}},{key:"filterOption",value:function(i,a){return pK(this.props,i,a)}},{key:"formatOptionLabel",value:function(i,a){if(typeof this.props.formatOptionLabel=="function"){var o=this.props.inputValue,s=this.state.selectValue;return this.props.formatOptionLabel(i,{context:a,inputValue:o,selectValue:s})}else return this.getOptionLabel(i)}},{key:"formatGroupLabel",value:function(i){return this.props.formatGroupLabel(i)}},{key:"startListeningComposition",value:function(){document&&document.addEventListener&&(document.addEventListener("compositionstart",this.onCompositionStart,!1),document.addEventListener("compositionend",this.onCompositionEnd,!1))}},{key:"stopListeningComposition",value:function(){document&&document.removeEventListener&&(document.removeEventListener("compositionstart",this.onCompositionStart),document.removeEventListener("compositionend",this.onCompositionEnd))}},{key:"startListeningToTouch",value:function(){document&&document.addEventListener&&(document.addEventListener("touchstart",this.onTouchStart,!1),document.addEventListener("touchmove",this.onTouchMove,!1),document.addEventListener("touchend",this.onTouchEnd,!1))}},{key:"stopListeningToTouch",value:function(){document&&document.removeEventListener&&(document.removeEventListener("touchstart",this.onTouchStart),document.removeEventListener("touchmove",this.onTouchMove),document.removeEventListener("touchend",this.onTouchEnd))}},{key:"renderInput",value:function(){var i=this.props,a=i.isDisabled,o=i.isSearchable,s=i.inputId,u=i.inputValue,l=i.tabIndex,c=i.form,d=i.menuIsOpen,f=i.required,h=this.getComponents(),v=h.Input,p=this.state,m=p.inputIsHidden,g=p.ariaSelection,y=this.commonProps,b=s||this.getElementId("input"),S=gr(gr(gr({"aria-autocomplete":"list","aria-expanded":d,"aria-haspopup":!0,"aria-errormessage":this.props["aria-errormessage"],"aria-invalid":this.props["aria-invalid"],"aria-label":this.props["aria-label"],"aria-labelledby":this.props["aria-labelledby"],"aria-required":f,role:"combobox"},d&&{"aria-controls":this.getElementId("listbox"),"aria-owns":this.getElementId("listbox")}),!o&&{"aria-readonly":!0}),this.hasValue()?(g==null?void 0:g.action)==="initial-input-focus"&&{"aria-describedby":this.getElementId("live-region")}:{"aria-describedby":this.getElementId("placeholder")});return o?_e.createElement(v,vr({},y,{autoCapitalize:"none",autoComplete:"off",autoCorrect:"off",id:b,innerRef:this.getInputRef,isDisabled:a,isHidden:m,onBlur:this.onInputBlur,onChange:this.handleInputChange,onFocus:this.onInputFocus,spellCheck:"false",tabIndex:l,form:c,type:"text",value:u},S)):_e.createElement(fbe,vr({id:b,innerRef:this.getInputRef,onBlur:this.onInputBlur,onChange:C_,onFocus:this.onInputFocus,disabled:a,tabIndex:l,inputMode:"none",form:c,value:""},S))}},{key:"renderPlaceholderOrValue",value:function(){var i=this,a=this.getComponents(),o=a.MultiValue,s=a.MultiValueContainer,u=a.MultiValueLabel,l=a.MultiValueRemove,c=a.SingleValue,d=a.Placeholder,f=this.commonProps,h=this.props,v=h.controlShouldRenderValue,p=h.isDisabled,m=h.isMulti,g=h.inputValue,y=h.placeholder,b=this.state,S=b.selectValue,x=b.focusedValue,C=b.isFocused;if(!this.hasValue()||!v)return g?null:_e.createElement(d,vr({},f,{key:"placeholder",isDisabled:p,isFocused:C,innerProps:{id:this.getElementId("placeholder")}}),y);if(m)return S.map(function(A,M){var D=A===x,k="".concat(i.getOptionLabel(A),"-").concat(i.getOptionValue(A));return _e.createElement(o,vr({},f,{components:{Container:s,Label:u,Remove:l},isFocused:D,isDisabled:p,key:k,index:M,removeProps:{onClick:function(){return i.removeValue(A)},onTouchEnd:function(){return i.removeValue(A)},onMouseDown:function(O){O.preventDefault()}},data:A}),i.formatOptionLabel(A,"value"))});if(g)return null;var w=S[0];return _e.createElement(c,vr({},f,{data:w,isDisabled:p}),this.formatOptionLabel(w,"value"))}},{key:"renderClearIndicator",value:function(){var i=this.getComponents(),a=i.ClearIndicator,o=this.commonProps,s=this.props,u=s.isDisabled,l=s.isLoading,c=this.state.isFocused;if(!this.isClearable()||!a||u||!this.hasValue()||l)return null;var d={onMouseDown:this.onClearIndicatorMouseDown,onTouchEnd:this.onClearIndicatorTouchEnd,"aria-hidden":"true"};return _e.createElement(a,vr({},o,{innerProps:d,isFocused:c}))}},{key:"renderLoadingIndicator",value:function(){var i=this.getComponents(),a=i.LoadingIndicator,o=this.commonProps,s=this.props,u=s.isDisabled,l=s.isLoading,c=this.state.isFocused;if(!a||!l)return null;var d={"aria-hidden":"true"};return _e.createElement(a,vr({},o,{innerProps:d,isDisabled:u,isFocused:c}))}},{key:"renderIndicatorSeparator",value:function(){var i=this.getComponents(),a=i.DropdownIndicator,o=i.IndicatorSeparator;if(!a||!o)return null;var s=this.commonProps,u=this.props.isDisabled,l=this.state.isFocused;return _e.createElement(o,vr({},s,{isDisabled:u,isFocused:l}))}},{key:"renderDropdownIndicator",value:function(){var i=this.getComponents(),a=i.DropdownIndicator;if(!a)return null;var o=this.commonProps,s=this.props.isDisabled,u=this.state.isFocused,l={onMouseDown:this.onDropdownIndicatorMouseDown,onTouchEnd:this.onDropdownIndicatorTouchEnd,"aria-hidden":"true"};return _e.createElement(a,vr({},o,{innerProps:l,isDisabled:s,isFocused:u}))}},{key:"renderMenu",value:function(){var i=this,a=this.getComponents(),o=a.Group,s=a.GroupHeading,u=a.Menu,l=a.MenuList,c=a.MenuPortal,d=a.LoadingMessage,f=a.NoOptionsMessage,h=a.Option,v=this.commonProps,p=this.state.focusedOption,m=this.props,g=m.captureMenuScroll,y=m.inputValue,b=m.isLoading,S=m.loadingMessage,x=m.minMenuHeight,C=m.maxMenuHeight,w=m.menuIsOpen,A=m.menuPlacement,M=m.menuPosition,D=m.menuPortalTarget,k=m.menuShouldBlockScroll,R=m.menuShouldScrollIntoView,O=m.noOptionsMessage,H=m.onMenuScrollToTop,B=m.onMenuScrollToBottom;if(!w)return null;var j=function(W,X){var U=W.type,z=W.data,J=W.isDisabled,K=W.isSelected,Z=W.label,te=W.value,le=p===z,ye=J?void 0:function(){return i.onOptionHover(z)},be=J?void 0:function(){return i.selectOption(z)},Ae="".concat(i.getElementId("option"),"-").concat(X),Se={id:Ae,onClick:be,onMouseMove:ye,onMouseOver:ye,tabIndex:-1};return _e.createElement(h,vr({},v,{innerProps:Se,data:z,isDisabled:J,isSelected:K,key:Ae,label:Z,type:U,value:te,isFocused:le,innerRef:le?i.getFocusedOptionRef:void 0}),i.formatOptionLabel(W.data,"menu"))},Y;if(this.hasOptions())Y=this.getCategorizedOptions().map(function(fe){if(fe.type==="group"){var W=fe.data,X=fe.options,U=fe.index,z="".concat(i.getElementId("group"),"-").concat(U),J="".concat(z,"-heading");return _e.createElement(o,vr({},v,{key:z,data:W,options:X,Heading:s,headingProps:{id:J,data:fe.data},label:i.formatGroupLabel(fe.data)}),fe.options.map(function(K){return j(K,"".concat(U,"-").concat(K.index))}))}else if(fe.type==="option")return j(fe,"".concat(fe.index))});else if(b){var G=S({inputValue:y});if(G===null)return null;Y=_e.createElement(d,v,G)}else{var $=O({inputValue:y});if($===null)return null;Y=_e.createElement(f,v,$)}var q={minMenuHeight:x,maxMenuHeight:C,menuPlacement:A,menuPosition:M,menuShouldScrollIntoView:R},ee=_e.createElement(Xye,vr({},v,q),function(fe){var W=fe.ref,X=fe.placerProps,U=X.placement,z=X.maxHeight;return _e.createElement(u,vr({},v,q,{innerRef:W,innerProps:{onMouseDown:i.onMenuMouseDown,onMouseMove:i.onMenuMouseMove,id:i.getElementId("listbox")},isLoading:b,placement:U}),_e.createElement(ybe,{captureEnabled:g,onTopArrive:H,onBottomArrive:B,lockEnabled:k},function(J){return _e.createElement(l,vr({},v,{innerRef:function(Z){i.getMenuListRef(Z),J(Z)},isLoading:b,maxHeight:z,focusedOption:p}),Y)}))});return D||M==="fixed"?_e.createElement(c,vr({},v,{appendTo:D,controlElement:this.controlRef,menuPlacement:A,menuPosition:M}),ee):ee}},{key:"renderFormField",value:function(){var i=this,a=this.props,o=a.delimiter,s=a.isDisabled,u=a.isMulti,l=a.name,c=a.required,d=this.state.selectValue;if(c&&!this.hasValue()&&!s)return _e.createElement(Sbe,{name:l,onFocus:this.onValueInputFocus});if(!(!l||s))if(u)if(o){var f=d.map(function(p){return i.getOptionValue(p)}).join(o);return _e.createElement("input",{name:l,type:"hidden",value:f})}else{var h=d.length>0?d.map(function(p,m){return _e.createElement("input",{key:"i-".concat(m),name:l,type:"hidden",value:i.getOptionValue(p)})}):_e.createElement("input",{name:l,type:"hidden",value:""});return _e.createElement("div",null,h)}else{var v=d[0]?this.getOptionValue(d[0]):"";return _e.createElement("input",{name:l,type:"hidden",value:v})}}},{key:"renderLiveRegion",value:function(){var i=this.commonProps,a=this.state,o=a.ariaSelection,s=a.focusedOption,u=a.focusedValue,l=a.isFocused,c=a.selectValue,d=this.getFocusableOptions();return _e.createElement(obe,vr({},i,{id:this.getElementId("live-region"),ariaSelection:o,focusedOption:s,focusedValue:u,isFocused:l,selectValue:c,focusableOptions:d}))}},{key:"render",value:function(){var i=this.getComponents(),a=i.Control,o=i.IndicatorsContainer,s=i.SelectContainer,u=i.ValueContainer,l=this.props,c=l.className,d=l.id,f=l.isDisabled,h=l.menuIsOpen,v=this.state.isFocused,p=this.commonProps=this.getCommonProps();return _e.createElement(s,vr({},p,{className:c,innerProps:{id:d,onKeyDown:this.onKeyDown},isDisabled:f,isFocused:v}),this.renderLiveRegion(),_e.createElement(a,vr({},p,{innerRef:this.getControlRef,innerProps:{onMouseDown:this.onControlMouseDown,onTouchEnd:this.onControlTouchEnd},isDisabled:f,isFocused:v,menuIsOpen:h}),_e.createElement(u,vr({},p,{isDisabled:f}),this.renderPlaceholderOrValue(),this.renderInput()),_e.createElement(o,vr({},p,{isDisabled:f}),this.renderClearIndicator(),this.renderLoadingIndicator(),this.renderIndicatorSeparator(),this.renderDropdownIndicator())),this.renderMenu(),this.renderFormField())}}],[{key:"getDerivedStateFromProps",value:function(i,a){var o=a.prevProps,s=a.clearFocusValueOnUpdate,u=a.inputIsHiddenAfterUpdate,l=a.ariaSelection,c=a.isFocused,d=a.prevWasFocused,f=i.options,h=i.value,v=i.menuIsOpen,p=i.inputValue,m=i.isMulti,g=GB(h),y={};if(o&&(h!==o.value||f!==o.options||v!==o.menuIsOpen||p!==o.inputValue)){var b=v?kbe(i,g):[],S=s?Obe(a,g):null,x=Fbe(a,b);y={selectValue:g,focusedOption:x,focusedValue:S,clearFocusValueOnUpdate:!1}}var C=u!=null&&i!==o?{inputIsHidden:u,inputIsHiddenAfterUpdate:void 0}:{},w=l,A=c&&d;return c&&!A&&(w={value:Ex(m,g,g[0]||null),options:g,action:"initial-input-focus"},A=!d),(l==null?void 0:l.action)==="initial-input-focus"&&(w=null),gr(gr(gr({},y),C),{},{prevProps:i,ariaSelection:w,prevWasFocused:A})}}]),r}(_e.Component);mK.defaultProps=Rbe;var Nbe=_e.forwardRef(function(e,t){var r=g0e(e);return _e.createElement(mK,vr({ref:t},r))}),o7=Nbe;const Bbe=({onApply:e,onClose:t})=>{const r=Sv(p=>p.appState.searchFilters),n=Sv(p=>p.appState.searchFacets),[i,a]=_e.useState(r),[o,s]=_e.useState(""),u=()=>{if(i.sequenceLengthMin){const p=Number(i.sequenceLengthMin);if(!Number.isInteger(p)||p<0)return s("Sequence length must be positive integer value"),!0}if(i.sequenceLengthMax){const p=Number(i.sequenceLengthMax);if(!Number.isInteger(p)||p<0)return s("Sequence length must be positive integer value"),!0}if(i.sequenceLengthMin&&i.sequenceLengthMax){const p=Number(i.sequenceLengthMin);if(Number(i.sequenceLengthMax)<p)return s("Sequence length maximum value must be larger than minimum value"),!0}return i.sequenceLengthMin&&!i.sequenceLengthMax||!i.sequenceLengthMin&&i.sequenceLengthMax?(s("Both or none of min and max sequence length values must be populated"),!0):(s(""),!1)},l=_e.useMemo(()=>u(),[i]),c={geneName:"",organism:[],sequenceLengthMin:"",sequenceLengthMax:"",annotationScore:"",proteinWith:[]},d=()=>{a(c),e(c),t()},f=()=>{e(i),t()},h=(p,m)=>{const g=p.map(y=>y.value);a({...i,organism:g})},v=(p,m)=>{const g=p.map(y=>y.value);a({...i,proteinWith:g})};return P.jsxs("div",{className:"search-filters-wrapper",children:[P.jsx("div",{className:"search-filters-title",children:"Filters"}),P.jsxs("div",{className:"search-filter-input-wrapper",children:[P.jsx("label",{htmlFor:"gene-name",className:"search-filters-label",children:"Gene Name"}),P.jsx("input",{type:"text",className:"search-filter-input",name:"gene-name",id:"gene-name",placeholder:"Enter Gene Name",value:i.geneName,onChange:p=>{a({...i,geneName:p.target.value})}})]}),P.jsxs("div",{className:"search-filter-input-wrapper",children:[P.jsx("label",{htmlFor:"organism",className:"search-filters-label",children:"Organisms"}),P.jsx(o7,{name:"organism",className:"search-filter-input-wrapper",isMulti:!0,options:n.organisms,defaultValue:n.organisms.filter(p=>i.organism.some(m=>m===p.value)),classNamePrefix:"search-filter-react-select",onChange:h,styles:{control:p=>({...p,backgroundColor:"#f5f5f5",textAlign:"left",fontWeight:400,fontSize:"14px",color:"#6c6c6c"})}})]}),P.jsxs("div",{className:"search-filter-input-wrapper",children:[P.jsx("label",{htmlFor:"sequence-min",className:"search-filters-label",children:"Sequence Length"}),P.jsxs("div",{className:"search-filter-input-row-wrapper",children:[P.jsx("input",{type:"text",className:"search-filter-input",name:"sequence-min",id:"sequence-min",placeholder:"From",value:i.sequenceLengthMin,onChange:p=>{a({...i,sequenceLengthMin:p.target.value})}}),P.jsx("span",{className:"search-filter-dash",children:""}),P.jsx("input",{type:"text",className:"search-filter-input",name:"sequence-max",id:"sequence-max",placeholder:"To",value:i.sequenceLengthMax,onChange:p=>{a({...i,sequenceLengthMax:p.target.value})}})]})]}),P.jsxs("div",{className:"search-filter-input-wrapper",children:[P.jsx("label",{htmlFor:"annotation-score",className:"search-filters-label",children:"Annotation Score"}),P.jsxs("select",{className:"search-filter-input",name:"annotation-score",id:"annotation-score",placeholder:"Select an option",value:i.annotationScore,onChange:p=>{a({...i,annotationScore:p.target.value})},children:[P.jsx("option",{value:""}),P.jsx("option",{value:"5",children:"5"}),P.jsx("option",{value:"4",children:"4"}),P.jsx("option",{value:"3",children:"3"}),P.jsx("option",{value:"2",children:"2"}),P.jsx("option",{value:"1",children:"1"})]})]}),P.jsxs("div",{className:"search-filter-input-wrapper",children:[P.jsx("label",{htmlFor:"protein-with",className:"search-filters-label",children:"Proteins With"}),P.jsx(o7,{name:"protein-with",className:"search-filter-input-wrapper",isMulti:!0,options:n.proteinsWith,defaultValue:n.proteinsWith.filter(p=>i.proteinWith.some(m=>m===p.value)),classNamePrefix:"search-filter-react-select",onChange:v,styles:{control:p=>({...p,backgroundColor:"#f5f5f5",textAlign:"left",fontWeight:400,fontSize:"14px",color:"#6c6c6c"})}})]}),P.jsx("div",{className:"search-filter-error-message",children:o}),P.jsxs("div",{className:"search-filter-input-row-wrapper",children:[P.jsx("button",{className:"form-button",onClick:d,children:"Clear"}),P.jsx("button",{className:"form-button",disabled:l,onClick:f,children:"Apply Filters"})]})]})},Ube=()=>P.jsx("div",{className:"search-results-wrapper",children:P.jsxs("div",{className:"search-results-nodata-wrapper",children:[P.jsx("span",{className:"search-results-text",children:"No data to display"}),P.jsx("span",{className:"search-results-text",children:"Please start search to display results"})]})}),jbe=()=>{const e=Id(),t=sE(),r=Sv(y=>y.appState.searchResults),n=Sv(y=>y.appState.searchFilters),[i,a]=_e.useState(""),[o,s]=_e.useState(!1),[u]=Vpe(),[l,c]=_e.useState(!1);_e.useEffect(()=>{var S,x;const y=u.get("query"),b={geneName:u.get("geneName")||"",organism:((S=u.get("organism"))==null?void 0:S.split(","))||[],sequenceLengthMin:u.get("sequenceLengthMin")||"",sequenceLengthMax:u.get("sequenceLengthMax")||"",annotationScore:u.get("annotationScore")||"",proteinWith:((x=u.get("proteinWith"))==null?void 0:x.split(","))||[]};y&&(s(!0),a(decodeURIComponent(y)),t(u0e(y,b)).finally(()=>{s(!1)}))},[u,t]);const d=y=>{const b=new URLSearchParams,S="/search";i?b.append("query",encodeURIComponent(i)):b.append("query",encodeURIComponent("*"));let x=`${S}?${b.toString()}`;y&&(x=`${x}&${y}`),e(x)},f=()=>{m(n)},h=y=>{y.key==="Enter"&&m(n)},v=()=>o?P.jsx(uE,{}):r.items.length===0?P.jsx(Ube,{}):P.jsxs(P.Fragment,{children:[P.jsxs("div",{className:"search-results-count",children:[r.totalResults,` Search Results for "${decodeURIComponent(r.searchString)}"`]}),P.jsx(f0e,{})]}),p=()=>{c(!l)},m=y=>{const b=Object.entries(y).filter(([S,x])=>Array.isArray(x)?x.length>0:S&&x).map(([S,x])=>Array.isArray(x)?`${encodeURIComponent(S)}=${encodeURIComponent(x.join(","))}`:`${encodeURIComponent(S)}=${encodeURIComponent(x)}`).join("&");d(b)},g=y=>Object.values(y).some(b=>Array.isArray(b)?b.length>0:b!=="");return P.jsxs(P.Fragment,{children:[P.jsx(CO,{}),P.jsxs("div",{className:"search-wrapper",children:[P.jsx("input",{type:"text",className:"search-input form-text-input",placeholder:"Enter search value",value:i,onChange:y=>a(y.target.value),onKeyDown:h}),P.jsx("button",{className:"search-button-search search-button",onClick:f,children:"Search"}),P.jsxs("button",{className:"search-button-filters search-button"+(l?" search-filters-popup-opened":""),onClick:p,children:[P.jsx("svg",{width:"22px",height:"18px",viewBox:"0 0 22 18",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:P.jsx("path",{d:"M7.2 10.8C8.87744 10.8 10.2869 11.9473 10.6866 13.5H20.7C21.197 13.5 21.6 13.903 21.6 14.4C21.6 14.8419 21.2816 15.2093 20.8618 15.2854L20.7 15.3L10.6861 15.3018C10.2858 16.8536 8.87679 18 7.2 18C5.52321 18 4.11417 16.8536 3.71389 15.3018L0.9 15.3C0.402948 15.3 0 14.897 0 14.4C0 13.9581 0.318384 13.5907 0.738216 13.5146L0.9 13.5H3.71342C4.11307 11.9473 5.52256 10.8 7.2 10.8ZM7.2 12.6C6.2059 12.6 5.4 13.4059 5.4 14.4C5.4 15.3941 6.2059 16.2 7.2 16.2C8.1941 16.2 9 15.3941 9 14.4C9 13.4059 8.1941 12.6 7.2 12.6ZM14.4 0C16.0774 0 17.487 1.14728 17.8866 2.69996L20.7 2.7C21.197 2.7 21.6 3.10295 21.6 3.6C21.6 4.04183 21.2816 4.4093 20.8618 4.48549L20.7 4.5L17.8861 4.50184C17.4859 6.05362 16.0769 7.2 14.4 7.2C12.7232 7.2 11.3142 6.05362 10.9139 4.50184L0.9 4.5C0.402948 4.5 0 4.09705 0 3.6C0 3.15817 0.318384 2.7907 0.738216 2.71451L0.9 2.7L10.9134 2.69996C11.3131 1.14728 12.7226 0 14.4 0ZM14.4 1.8C13.4059 1.8 12.6 2.6059 12.6 3.6C12.6 4.5941 13.4059 5.4 14.4 5.4C15.3941 5.4 16.2 4.5941 16.2 3.6C16.2 2.6059 15.3941 1.8 14.4 1.8Z"})}),g(n)&&P.jsx("div",{className:"search-filter-alert"})]})]}),l&&P.jsx("div",{className:"search-filters-popup",children:P.jsx(Bbe,{onClose:p,onApply:m})}),v()]})},zbe=({proteinData:e})=>P.jsxs("div",{className:"protein-common-wrapper",children:[P.jsxs("div",{className:"protein-header-wrapper",children:[P.jsxs("div",{className:"protein-header",children:[e.id," / ",e.uniProtkbId]}),P.jsx("div",{className:"protein-organism","data-organism":e.organism,children:e.organism})]}),P.jsxs("div",{className:"protein-property",children:[P.jsx("div",{className:"protein-title",children:"Protein"}),P.jsx("div",{className:"protein-text",children:e.description})]}),P.jsxs("div",{className:"protein-property",children:[P.jsx("div",{className:"protein-title",children:"Gene"}),P.jsx("div",{className:"protein-text",children:e.gene})]})]});/*! clipboard-copy. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */var Vbe=qbe;function XO(){return new DOMException("The request is not allowed","NotAllowedError")}async function Hbe(e){if(!navigator.clipboard)throw XO();return navigator.clipboard.writeText(e)}async function Gbe(e){const t=document.createElement("span");t.textContent=e,t.style.whiteSpace="pre",t.style.webkitUserSelect="auto",t.style.userSelect="all",document.body.appendChild(t);const r=window.getSelection(),n=window.document.createRange();r.removeAllRanges(),n.selectNode(t),r.addRange(n);let i=!1;try{i=window.document.execCommand("copy")}finally{r.removeAllRanges(),window.document.body.removeChild(t)}if(!i)throw XO()}async function qbe(e){try{await Hbe(e)}catch(t){try{await Gbe(e)}catch(r){throw r||t||XO()}}}const $be=xq(Vbe),s7=({proteinData:e})=>{const[t,r]=_e.useState(" Copy"),n=()=>{$be(e.sequence),r(" Copied!"),setTimeout(()=>r(" Copy"),2e3)};return P.jsxs("div",{className:"protein-details-wrapper",children:[P.jsx("div",{className:"protein-details-title",children:"Sequence"}),P.jsx("table",{className:"protein-property-table",children:P.jsxs("tbody",{children:[P.jsxs("tr",{children:[P.jsx("td",{children:P.jsxs("div",{className:"protein-property",children:[P.jsx("div",{className:"protein-title",children:"Length"}),P.jsx("div",{className:"protein-text",children:e.length})]})}),P.jsx("td",{children:P.jsxs("div",{className:"protein-property",children:[P.jsx("div",{className:"protein-title",children:"Last Updated"}),P.jsx("div",{className:"protein-text",children:e.lastUpdated})]})})]}),P.jsxs("tr",{children:[P.jsx("td",{children:P.jsxs("div",{className:"protein-property",children:[P.jsx("div",{className:"protein-title",children:"Mass (Da)"}),P.jsx("div",{className:"protein-text",children:e.molWeight})]})}),P.jsx("td",{children:P.jsxs("div",{className:"protein-property",children:[P.jsx("div",{className:"protein-title",children:"Checksum"}),P.jsx("div",{className:"protein-text",children:e.checksum})]})})]})]})}),P.jsx("div",{className:"protein-sequence-button-copy",children:P.jsxs("div",{className:"protein-sequence-button-copy-clickable",onClick:n,children:[P.jsx("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:P.jsx("path",{d:"M0 1.6C0 1.17565 0.168571 0.768687 0.468629 0.468629C0.768687 0.168571 1.17565 0 1.6 0H9.6C10.0243 0 10.4313 0.168571 10.7314 0.468629C11.0314 0.768687 11.2 1.17565 11.2 1.6V4.8H14.4C14.8243 4.8 15.2313 4.96857 15.5314 5.26863C15.8314 5.56869 16 5.97565 16 6.4V14.4C16 14.8243 15.8314 15.2313 15.5314 15.5314C15.2313 15.8314 14.8243 16 14.4 16H6.4C5.97565 16 5.56869 15.8314 5.26863 15.5314C4.96857 15.2313 4.8 14.8243 4.8 14.4V11.2H1.6C1.17565 11.2 0.768687 11.0314 0.468629 10.7314C0.168571 10.4313 0 10.0243 0 9.6V1.6ZM6.4 11.2V14.4H14.4V6.4H11.2V9.6C11.2 10.0243 11.0314 10.4313 10.7314 10.7314C10.4313 11.0314 10.0243 11.2 9.6 11.2H6.4ZM9.6 9.6V1.6H1.6V9.6H9.6Z",fill:"#0D0D0D"})}),t]})}),P.jsx("div",{className:"protein-sequence",children:e.sequence})]})};/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */const u7=typeof window<"u"&&window.customElements!=null&&window.customElements.polyfillWrapFlushCallback!==void 0,Wbe=(e,t,r=null,n=null)=>{for(;t!==r;){const i=t.nextSibling;e.insertBefore(t,n),t=i}},YO=(e,t,r=null)=>{for(;t!==r;){const n=t.nextSibling;e.removeChild(t),t=n}};/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */const Wc=`{{lit-${String(Math.random()).slice(2)}}}`,gK=`<!--${Wc}-->`,l7=new RegExp(`${Wc}|${gK}`),a1="$lit$";class yK{constructor(t,r){this.parts=[],this.element=r;const n=[],i=[],a=document.createTreeWalker(r.content,133,null,!1);let o=0,s=-1,u=0;const{strings:l,values:{length:c}}=t;for(;u<c;){const d=a.nextNode();if(d===null){a.currentNode=i.pop();continue}if(s++,d.nodeType===1){if(d.hasAttributes()){const f=d.attributes,{length:h}=f;let v=0;for(let p=0;p<h;p++)c7(f[p].name,a1)&&v++;for(;v-- >0;){const p=l[u],m=c5.exec(p)[2],g=m.toLowerCase()+a1,y=d.getAttribute(g);d.removeAttribute(g);const b=y.split(l7);this.parts.push({type:"attribute",index:s,name:m,strings:b}),u+=b.length-1}}d.tagName==="TEMPLATE"&&(i.push(d),a.currentNode=d.content)}else if(d.nodeType===3){const f=d.data;if(f.indexOf(Wc)>=0){const h=d.parentNode,v=f.split(l7),p=v.length-1;for(let m=0;m<p;m++){let g,y=v[m];if(y==="")g=Ff();else{const b=c5.exec(y);b!==null&&c7(b[2],a1)&&(y=y.slice(0,b.index)+b[1]+b[2].slice(0,-a1.length)+b[3]),g=document.createTextNode(y)}h.insertBefore(g,d),this.parts.push({type:"node",index:++s})}v[p]===""?(h.insertBefore(Ff(),d),n.push(d)):d.data=v[p],u+=p}}else if(d.nodeType===8)if(d.data===Wc){const f=d.parentNode;(d.previousSibling===null||s===o)&&(s++,f.insertBefore(Ff(),d)),o=s,this.parts.push({type:"node",index:s}),d.nextSibling===null?d.data="":(n.push(d),s--),u++}else{let f=-1;for(;(f=d.data.indexOf(Wc,f+1))!==-1;)this.parts.push({type:"node",index:-1}),u++}}for(const d of n)d.parentNode.removeChild(d)}}const c7=(e,t)=>{const r=e.length-t.length;return r>=0&&e.slice(r)===t},bK=e=>e.index!==-1,Ff=()=>document.createComment(""),c5=/([ \x09\x0a\x0c\x0d])([^\0-\x1F\x7F-\x9F "'>=/]+)([ \x09\x0a\x0c\x0d]*=[ \x09\x0a\x0c\x0d]*(?:[^ \x09\x0a\x0c\x0d"'`<>=]*|"[^"]*|'[^']*))$/;/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */const KO=133;function xK(e,t){const{element:{content:r},parts:n}=e,i=document.createTreeWalker(r,KO,null,!1);let a=R1(n),o=n[a],s=-1,u=0;const l=[];let c=null;for(;i.nextNode();){s++;const d=i.currentNode;for(d.previousSibling===c&&(c=null),t.has(d)&&(l.push(d),c===null&&(c=d)),c!==null&&u++;o!==void 0&&o.index===s;)o.index=c!==null?-1:o.index-u,a=R1(n,a),o=n[a]}l.forEach(d=>d.parentNode.removeChild(d))}const Xbe=e=>{let t=e.nodeType===11?0:1;const r=document.createTreeWalker(e,KO,null,!1);for(;r.nextNode();)t++;return t},R1=(e,t=-1)=>{for(let r=t+1;r<e.length;r++){const n=e[r];if(bK(n))return r}return-1};function Ybe(e,t,r=null){const{element:{content:n},parts:i}=e;if(r==null){n.appendChild(t);return}const a=document.createTreeWalker(n,KO,null,!1);let o=R1(i),s=0,u=-1;for(;a.nextNode();)for(u++,a.currentNode===r&&(s=Xbe(t),r.parentNode.insertBefore(t,r));o!==-1&&i[o].index===u;){if(s>0){for(;o!==-1;)i[o].index+=s,o=R1(i,o);return}o=R1(i,o)}}/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */const SK=new WeakMap,Kbe=e=>(...t)=>{const r=e(...t);return SK.set(r,!0),r},Tb=e=>typeof e=="function"&&SK.has(e);/**
 * @license
 * Copyright (c) 2018 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */const Ru={},d7={};/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class d5{constructor(t,r,n){this.__parts=[],this.template=t,this.processor=r,this.options=n}update(t){let r=0;for(const n of this.__parts)n!==void 0&&n.setValue(t[r]),r++;for(const n of this.__parts)n!==void 0&&n.commit()}_clone(){const t=u7?this.template.element.content.cloneNode(!0):document.importNode(this.template.element.content,!0),r=[],n=this.template.parts,i=document.createTreeWalker(t,133,null,!1);let a=0,o=0,s,u=i.nextNode();for(;a<n.length;){if(s=n[a],!bK(s)){this.__parts.push(void 0),a++;continue}for(;o<s.index;)o++,u.nodeName==="TEMPLATE"&&(r.push(u),i.currentNode=u.content),(u=i.nextNode())===null&&(i.currentNode=r.pop(),u=i.nextNode());if(s.type==="node"){const l=this.processor.handleTextExpression(this.options);l.insertAfterNode(u.previousSibling),this.__parts.push(l)}else this.__parts.push(...this.processor.handleAttributeExpressions(u,s.name,s.strings,this.options));a++}return u7&&(document.adoptNode(t),customElements.upgrade(t)),t}}/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */const f7=window.trustedTypes&&trustedTypes.createPolicy("lit-html",{createHTML:e=>e}),Qbe=` ${Wc} `;class QO{constructor(t,r,n,i){this.strings=t,this.values=r,this.type=n,this.processor=i}getHTML(){const t=this.strings.length-1;let r="",n=!1;for(let i=0;i<t;i++){const a=this.strings[i],o=a.lastIndexOf("<!--");n=(o>-1||n)&&a.indexOf("-->",o+1)===-1;const s=c5.exec(a);s===null?r+=a+(n?Qbe:gK):r+=a.substr(0,s.index)+s[1]+s[2]+a1+s[3]+Wc}return r+=this.strings[t],r}getTemplateElement(){const t=document.createElement("template");let r=this.getHTML();return f7!==void 0&&(r=f7.createHTML(r)),t.innerHTML=r,t}}class Zbe extends QO{getHTML(){return`<svg>${super.getHTML()}</svg>`}getTemplateElement(){const t=super.getTemplateElement(),r=t.content,n=r.firstChild;return r.removeChild(n),Wbe(r,n.firstChild),t}}/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */const hE=e=>e===null||!(typeof e=="object"||typeof e=="function"),f5=e=>Array.isArray(e)||!!(e&&e[Symbol.iterator]);class CK{constructor(t,r,n){this.dirty=!0,this.element=t,this.name=r,this.strings=n,this.parts=[];for(let i=0;i<n.length-1;i++)this.parts[i]=this._createPart()}_createPart(){return new _K(this)}_getValue(){const t=this.strings,r=t.length-1,n=this.parts;if(r===1&&t[0]===""&&t[1]===""){const a=n[0].value;if(typeof a=="symbol")return String(a);if(typeof a=="string"||!f5(a))return a}let i="";for(let a=0;a<r;a++){i+=t[a];const o=n[a];if(o!==void 0){const s=o.value;if(hE(s)||!f5(s))i+=typeof s=="string"?s:String(s);else for(const u of s)i+=typeof u=="string"?u:String(u)}}return i+=t[r],i}commit(){this.dirty&&(this.dirty=!1,this.element.setAttribute(this.name,this._getValue()))}}class _K{constructor(t){this.value=void 0,this.committer=t}setValue(t){t!==Ru&&(!hE(t)||t!==this.value)&&(this.value=t,Tb(t)||(this.committer.dirty=!0))}commit(){for(;Tb(this.value);){const t=this.value;this.value=Ru,t(this)}this.value!==Ru&&this.committer.commit()}}class b2{constructor(t){this.value=void 0,this.__pendingValue=void 0,this.options=t}appendInto(t){this.startNode=t.appendChild(Ff()),this.endNode=t.appendChild(Ff())}insertAfterNode(t){this.startNode=t,this.endNode=t.nextSibling}appendIntoPart(t){t.__insert(this.startNode=Ff()),t.__insert(this.endNode=Ff())}insertAfterPart(t){t.__insert(this.startNode=Ff()),this.endNode=t.endNode,t.endNode=this.startNode}setValue(t){this.__pendingValue=t}commit(){if(this.startNode.parentNode===null)return;for(;Tb(this.__pendingValue);){const r=this.__pendingValue;this.__pendingValue=Ru,r(this)}const t=this.__pendingValue;t!==Ru&&(hE(t)?t!==this.value&&this.__commitText(t):t instanceof QO?this.__commitTemplateResult(t):t instanceof Node?this.__commitNode(t):f5(t)?this.__commitIterable(t):t===d7?(this.value=d7,this.clear()):this.__commitText(t))}__insert(t){this.endNode.parentNode.insertBefore(t,this.endNode)}__commitNode(t){this.value!==t&&(this.clear(),this.__insert(t),this.value=t)}__commitText(t){const r=this.startNode.nextSibling;t=t??"";const n=typeof t=="string"?t:String(t);r===this.endNode.previousSibling&&r.nodeType===3?r.data=n:this.__commitNode(document.createTextNode(n)),this.value=t}__commitTemplateResult(t){const r=this.options.templateFactory(t);if(this.value instanceof d5&&this.value.template===r)this.value.update(t.values);else{const n=new d5(r,t.processor,this.options),i=n._clone();n.update(t.values),this.__commitNode(i),this.value=n}}__commitIterable(t){Array.isArray(this.value)||(this.value=[],this.clear());const r=this.value;let n=0,i;for(const a of t)i=r[n],i===void 0&&(i=new b2(this.options),r.push(i),n===0?i.appendIntoPart(this):i.insertAfterPart(r[n-1])),i.setValue(a),i.commit(),n++;n<r.length&&(r.length=n,this.clear(i&&i.endNode))}clear(t=this.startNode){YO(this.startNode.parentNode,t.nextSibling,this.endNode)}}class Jbe{constructor(t,r,n){if(this.value=void 0,this.__pendingValue=void 0,n.length!==2||n[0]!==""||n[1]!=="")throw new Error("Boolean attributes can only contain a single expression");this.element=t,this.name=r,this.strings=n}setValue(t){this.__pendingValue=t}commit(){for(;Tb(this.__pendingValue);){const r=this.__pendingValue;this.__pendingValue=Ru,r(this)}if(this.__pendingValue===Ru)return;const t=!!this.__pendingValue;this.value!==t&&(t?this.element.setAttribute(this.name,""):this.element.removeAttribute(this.name),this.value=t),this.__pendingValue=Ru}}class e2e extends CK{constructor(t,r,n){super(t,r,n),this.single=n.length===2&&n[0]===""&&n[1]===""}_createPart(){return new t2e(this)}_getValue(){return this.single?this.parts[0].value:super._getValue()}commit(){this.dirty&&(this.dirty=!1,this.element[this.name]=this._getValue())}}class t2e extends _K{}let wK=!1;(()=>{try{const e={get capture(){return wK=!0,!1}};window.addEventListener("test",e,e),window.removeEventListener("test",e,e)}catch{}})();class r2e{constructor(t,r,n){this.value=void 0,this.__pendingValue=void 0,this.element=t,this.eventName=r,this.eventContext=n,this.__boundHandleEvent=i=>this.handleEvent(i)}setValue(t){this.__pendingValue=t}commit(){for(;Tb(this.__pendingValue);){const a=this.__pendingValue;this.__pendingValue=Ru,a(this)}if(this.__pendingValue===Ru)return;const t=this.__pendingValue,r=this.value,n=t==null||r!=null&&(t.capture!==r.capture||t.once!==r.once||t.passive!==r.passive),i=t!=null&&(r==null||n);n&&this.element.removeEventListener(this.eventName,this.__boundHandleEvent,this.__options),i&&(this.__options=n2e(t),this.element.addEventListener(this.eventName,this.__boundHandleEvent,this.__options)),this.value=t,this.__pendingValue=Ru}handleEvent(t){typeof this.value=="function"?this.value.call(this.eventContext||this.element,t):this.value.handleEvent(t)}}const n2e=e=>e&&(wK?{capture:e.capture,passive:e.passive,once:e.once}:e.capture);/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */function i2e(e){let t=Ib.get(e.type);t===void 0&&(t={stringsArray:new WeakMap,keyString:new Map},Ib.set(e.type,t));let r=t.stringsArray.get(e.strings);if(r!==void 0)return r;const n=e.strings.join(Wc);return r=t.keyString.get(n),r===void 0&&(r=new yK(e,e.getTemplateElement()),t.keyString.set(n,r)),t.stringsArray.set(e.strings,r),r}const Ib=new Map;/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */const dg=new WeakMap,a2e=(e,t,r)=>{let n=dg.get(t);n===void 0&&(YO(t,t.firstChild),dg.set(t,n=new b2(Object.assign({templateFactory:i2e},r))),n.appendInto(t)),n.setValue(e),n.commit()};/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */class o2e{handleAttributeExpressions(t,r,n,i){const a=r[0];return a==="."?new e2e(t,r.slice(1),n).parts:a==="@"?[new r2e(t,r.slice(1),i.eventContext)]:a==="?"?[new Jbe(t,r.slice(1),n)]:new CK(t,r,n).parts}handleTextExpression(t){return new b2(t)}}const EK=new o2e;/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */typeof window<"u"&&(window.litHtmlVersions||(window.litHtmlVersions=[])).push("1.4.1");const zr=(e,...t)=>new QO(e,t,"html",EK),h5=(e,...t)=>new Zbe(e,t,"svg",EK);/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */const AK=(e,t)=>`${e}--${t}`;let E_=!0;typeof window.ShadyCSS>"u"?E_=!1:typeof window.ShadyCSS.prepareTemplateDom>"u"&&(console.warn("Incompatible ShadyCSS version detected. Please update to at least @webcomponents/webcomponentsjs@2.0.2 and @webcomponents/shadycss@1.3.1."),E_=!1);const s2e=e=>t=>{const r=AK(t.type,e);let n=Ib.get(r);n===void 0&&(n={stringsArray:new WeakMap,keyString:new Map},Ib.set(r,n));let i=n.stringsArray.get(t.strings);if(i!==void 0)return i;const a=t.strings.join(Wc);if(i=n.keyString.get(a),i===void 0){const o=t.getTemplateElement();E_&&window.ShadyCSS.prepareTemplateDom(o,e),i=new yK(t,o),n.keyString.set(a,i)}return n.stringsArray.set(t.strings,i),i},u2e=["html","svg"],l2e=e=>{u2e.forEach(t=>{const r=Ib.get(AK(t,e));r!==void 0&&r.keyString.forEach(n=>{const{element:{content:i}}=n,a=new Set;Array.from(i.querySelectorAll("style")).forEach(o=>{a.add(o)}),xK(n,a)})})},PK=new Set,c2e=(e,t,r)=>{PK.add(e);const n=r?r.element:document.createElement("template"),i=t.querySelectorAll("style"),{length:a}=i;if(a===0){window.ShadyCSS.prepareTemplateStyles(n,e);return}const o=document.createElement("style");for(let l=0;l<a;l++){const c=i[l];c.parentNode.removeChild(c),o.textContent+=c.textContent}l2e(e);const s=n.content;r?Ybe(r,o,s.firstChild):s.insertBefore(o,s.firstChild),window.ShadyCSS.prepareTemplateStyles(n,e);const u=s.querySelector("style");if(window.ShadyCSS.nativeShadow&&u!==null)t.insertBefore(u.cloneNode(!0),t.firstChild);else if(r){s.insertBefore(o,s.firstChild);const l=new Set;l.add(o),xK(r,l)}},d2e=(e,t,r)=>{if(!r||typeof r!="object"||!r.scopeName)throw new Error("The `scopeName` option is required.");const n=r.scopeName,i=dg.has(t),a=E_&&t.nodeType===11&&!!t.host,o=a&&!PK.has(n),s=o?document.createDocumentFragment():t;if(a2e(e,s,Object.assign({templateFactory:s2e(n)},r)),o){const u=dg.get(s);dg.delete(s);const l=u.value instanceof d5?u.value.template:void 0;c2e(n,s,l),YO(t,t.firstChild),t.appendChild(s),dg.set(t,u)}!i&&a&&window.ShadyCSS.styleElement(t.host)};/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */var TK;window.JSCompiler_renameProperty=(e,t)=>e;const p5={toAttribute(e,t){switch(t){case Boolean:return e?"":null;case Object:case Array:return e==null?e:JSON.stringify(e)}return e},fromAttribute(e,t){switch(t){case Boolean:return e!==null;case Number:return e===null?null:Number(e);case Object:case Array:return JSON.parse(e)}return e}},IK=(e,t)=>t!==e&&(t===t||e===e),rP={attribute:!0,type:String,converter:p5,reflect:!1,hasChanged:IK},nP=1,iP=4,aP=8,oP=16,v5="finalized";class MK extends HTMLElement{constructor(){super(),this.initialize()}static get observedAttributes(){this.finalize();const t=[];return this._classProperties.forEach((r,n)=>{const i=this._attributeNameForProperty(n,r);i!==void 0&&(this._attributeToPropertyMap.set(i,n),t.push(i))}),t}static _ensureClassProperties(){if(!this.hasOwnProperty(JSCompiler_renameProperty("_classProperties",this))){this._classProperties=new Map;const t=Object.getPrototypeOf(this)._classProperties;t!==void 0&&t.forEach((r,n)=>this._classProperties.set(n,r))}}static createProperty(t,r=rP){if(this._ensureClassProperties(),this._classProperties.set(t,r),r.noAccessor||this.prototype.hasOwnProperty(t))return;const n=typeof t=="symbol"?Symbol():`__${t}`,i=this.getPropertyDescriptor(t,n,r);i!==void 0&&Object.defineProperty(this.prototype,t,i)}static getPropertyDescriptor(t,r,n){return{get(){return this[r]},set(i){const a=this[t];this[r]=i,this.requestUpdateInternal(t,a,n)},configurable:!0,enumerable:!0}}static getPropertyOptions(t){return this._classProperties&&this._classProperties.get(t)||rP}static finalize(){const t=Object.getPrototypeOf(this);if(t.hasOwnProperty(v5)||t.finalize(),this[v5]=!0,this._ensureClassProperties(),this._attributeToPropertyMap=new Map,this.hasOwnProperty(JSCompiler_renameProperty("properties",this))){const r=this.properties,n=[...Object.getOwnPropertyNames(r),...typeof Object.getOwnPropertySymbols=="function"?Object.getOwnPropertySymbols(r):[]];for(const i of n)this.createProperty(i,r[i])}}static _attributeNameForProperty(t,r){const n=r.attribute;return n===!1?void 0:typeof n=="string"?n:typeof t=="string"?t.toLowerCase():void 0}static _valueHasChanged(t,r,n=IK){return n(t,r)}static _propertyValueFromAttribute(t,r){const n=r.type,i=r.converter||p5,a=typeof i=="function"?i:i.fromAttribute;return a?a(t,n):t}static _propertyValueToAttribute(t,r){if(r.reflect===void 0)return;const n=r.type,i=r.converter;return(i&&i.toAttribute||p5.toAttribute)(t,n)}initialize(){this._updateState=0,this._updatePromise=new Promise(t=>this._enableUpdatingResolver=t),this._changedProperties=new Map,this._saveInstanceProperties(),this.requestUpdateInternal()}_saveInstanceProperties(){this.constructor._classProperties.forEach((t,r)=>{if(this.hasOwnProperty(r)){const n=this[r];delete this[r],this._instanceProperties||(this._instanceProperties=new Map),this._instanceProperties.set(r,n)}})}_applyInstanceProperties(){this._instanceProperties.forEach((t,r)=>this[r]=t),this._instanceProperties=void 0}connectedCallback(){this.enableUpdating()}enableUpdating(){this._enableUpdatingResolver!==void 0&&(this._enableUpdatingResolver(),this._enableUpdatingResolver=void 0)}disconnectedCallback(){}attributeChangedCallback(t,r,n){r!==n&&this._attributeToProperty(t,n)}_propertyToAttribute(t,r,n=rP){const i=this.constructor,a=i._attributeNameForProperty(t,n);if(a!==void 0){const o=i._propertyValueToAttribute(r,n);if(o===void 0)return;this._updateState=this._updateState|aP,o==null?this.removeAttribute(a):this.setAttribute(a,o),this._updateState=this._updateState&~aP}}_attributeToProperty(t,r){if(this._updateState&aP)return;const n=this.constructor,i=n._attributeToPropertyMap.get(t);if(i!==void 0){const a=n.getPropertyOptions(i);this._updateState=this._updateState|oP,this[i]=n._propertyValueFromAttribute(r,a),this._updateState=this._updateState&~oP}}requestUpdateInternal(t,r,n){let i=!0;if(t!==void 0){const a=this.constructor;n=n||a.getPropertyOptions(t),a._valueHasChanged(this[t],r,n.hasChanged)?(this._changedProperties.has(t)||this._changedProperties.set(t,r),n.reflect===!0&&!(this._updateState&oP)&&(this._reflectingProperties===void 0&&(this._reflectingProperties=new Map),this._reflectingProperties.set(t,n))):i=!1}!this._hasRequestedUpdate&&i&&(this._updatePromise=this._enqueueUpdate())}requestUpdate(t,r){return this.requestUpdateInternal(t,r),this.updateComplete}async _enqueueUpdate(){this._updateState=this._updateState|iP;try{await this._updatePromise}catch{}const t=this.performUpdate();return t!=null&&await t,!this._hasRequestedUpdate}get _hasRequestedUpdate(){return this._updateState&iP}get hasUpdated(){return this._updateState&nP}performUpdate(){if(!this._hasRequestedUpdate)return;this._instanceProperties&&this._applyInstanceProperties();let t=!1;const r=this._changedProperties;try{t=this.shouldUpdate(r),t?this.update(r):this._markUpdated()}catch(n){throw t=!1,this._markUpdated(),n}t&&(this._updateState&nP||(this._updateState=this._updateState|nP,this.firstUpdated(r)),this.updated(r))}_markUpdated(){this._changedProperties=new Map,this._updateState=this._updateState&~iP}get updateComplete(){return this._getUpdateComplete()}_getUpdateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._updatePromise}shouldUpdate(t){return!0}update(t){this._reflectingProperties!==void 0&&this._reflectingProperties.size>0&&(this._reflectingProperties.forEach((r,n)=>this._propertyToAttribute(n,this[n],r)),this._reflectingProperties=void 0),this._markUpdated()}updated(t){}firstUpdated(t){}}TK=v5;MK[TK]=!0;/**
@license
Copyright (c) 2019 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at
http://polymer.github.io/LICENSE.txt The complete set of authors may be found at
http://polymer.github.io/AUTHORS.txt The complete set of contributors may be
found at http://polymer.github.io/CONTRIBUTORS.txt Code distributed by Google as
part of the polymer project is also subject to an additional IP rights grant
found at http://polymer.github.io/PATENTS.txt
*/const m5=window.ShadowRoot&&(window.ShadyCSS===void 0||window.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,ZO=Symbol();class JO{constructor(t,r){if(r!==ZO)throw new Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=t}get styleSheet(){return this._styleSheet===void 0&&(m5?(this._styleSheet=new CSSStyleSheet,this._styleSheet.replaceSync(this.cssText)):this._styleSheet=null),this._styleSheet}toString(){return this.cssText}}const f2e=e=>new JO(String(e),ZO),h2e=e=>{if(e instanceof JO)return e.cssText;if(typeof e=="number")return e;throw new Error(`Value passed to 'css' function must be a 'css' function result: ${e}. Use 'unsafeCSS' to pass non-literal values, but
            take care to ensure page security.`)},nu=(e,...t)=>{const r=t.reduce((n,i,a)=>n+h2e(i)+e[a+1],e[0]);return new JO(r,ZO)};/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */(window.litElementVersions||(window.litElementVersions=[])).push("2.5.1");const h7={};class Hh extends MK{static getStyles(){return this.styles}static _getUniqueStyles(){if(this.hasOwnProperty(JSCompiler_renameProperty("_styles",this)))return;const t=this.getStyles();if(Array.isArray(t)){const r=(a,o)=>a.reduceRight((s,u)=>Array.isArray(u)?r(u,s):(s.add(u),s),o),n=r(t,new Set),i=[];n.forEach(a=>i.unshift(a)),this._styles=i}else this._styles=t===void 0?[]:[t];this._styles=this._styles.map(r=>{if(r instanceof CSSStyleSheet&&!m5){const n=Array.prototype.slice.call(r.cssRules).reduce((i,a)=>i+a.cssText,"");return f2e(n)}return r})}initialize(){super.initialize(),this.constructor._getUniqueStyles(),this.renderRoot=this.createRenderRoot(),window.ShadowRoot&&this.renderRoot instanceof window.ShadowRoot&&this.adoptStyles()}createRenderRoot(){return this.attachShadow(this.constructor.shadowRootOptions)}adoptStyles(){const t=this.constructor._styles;t.length!==0&&(window.ShadyCSS!==void 0&&!window.ShadyCSS.nativeShadow?window.ShadyCSS.ScopingShim.prepareAdoptedCssText(t.map(r=>r.cssText),this.localName):m5?this.renderRoot.adoptedStyleSheets=t.map(r=>r instanceof CSSStyleSheet?r:r.styleSheet):this._needsShimAdoptedStyleSheets=!0)}connectedCallback(){super.connectedCallback(),this.hasUpdated&&window.ShadyCSS!==void 0&&window.ShadyCSS.styleElement(this)}update(t){const r=this.render();super.update(t),r!==h7&&this.constructor.render(r,this.renderRoot,{scopeName:this.localName,eventContext:this}),this._needsShimAdoptedStyleSheets&&(this._needsShimAdoptedStyleSheets=!1,this.constructor._styles.forEach(n=>{const i=document.createElement("style");i.textContent=n.cssText,this.renderRoot.appendChild(i)}))}render(){return h7}}Hh.finalized=!0;Hh.render=d2e;Hh.shadowRootOptions={mode:"open"};/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */const p7=new WeakMap,g5=Kbe(e=>t=>{if(!(t instanceof b2))throw new Error("unsafeHTML can only be used in text bindings");const r=p7.get(t);if(r!==void 0&&hE(e)&&e===r.value&&t.value===r.fragment)return;const n=document.createElement("template");n.innerHTML=e;const i=document.importNode(n.content,!0);t.setValue(i),p7.set(t,{value:e,fragment:i})});var p2e=function(e){return new Promise(function(t){return setTimeout(function(){return t()},e)})},y5="node";typeof importScripts<"u"?y5="worker":typeof window<"u"&&(y5="browser");var v2e=y5,DK=function(){return p2e(0)};v2e==="browser"&&"requestAnimationFrame"in window&&(DK=function(){return new Promise(function(e){return window.requestAnimationFrame(function(){return e()})})});var m2e=DK,g2e=m2e;function RK(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function y2e(e){return e.length===1&&(e=b2e(e)),{left:function(t,r,n,i){for(n==null&&(n=0),i==null&&(i=t.length);n<i;){var a=n+i>>>1;e(t[a],r)<0?n=a+1:i=a}return n},right:function(t,r,n,i){for(n==null&&(n=0),i==null&&(i=t.length);n<i;){var a=n+i>>>1;e(t[a],r)>0?i=a:n=a+1}return n}}}function b2e(e){return function(t,r){return RK(e(t),r)}}var x2e=y2e(RK),S2e=x2e.right;function C2e(e,t,r){e=+e,t=+t,r=(i=arguments.length)<2?(t=e,e=0,1):i<3?1:+r;for(var n=-1,i=Math.max(0,Math.ceil((t-e)/r))|0,a=new Array(i);++n<i;)a[n]=e+n*r;return a}var b5=Math.sqrt(50),x5=Math.sqrt(10),S5=Math.sqrt(2);function _2e(e,t,r){var n,i=-1,a,o,s;if(t=+t,e=+e,r=+r,e===t&&r>0)return[e];if((n=t<e)&&(a=e,e=t,t=a),(s=lC(e,t,r))===0||!isFinite(s))return[];if(s>0)for(e=Math.ceil(e/s),t=Math.floor(t/s),o=new Array(a=Math.ceil(t-e+1));++i<a;)o[i]=(e+i)*s;else for(e=Math.floor(e*s),t=Math.ceil(t*s),o=new Array(a=Math.ceil(e-t+1));++i<a;)o[i]=(e-i)/s;return n&&o.reverse(),o}function lC(e,t,r){var n=(t-e)/Math.max(0,r),i=Math.floor(Math.log(n)/Math.LN10),a=n/Math.pow(10,i);return i>=0?(a>=b5?10:a>=x5?5:a>=S5?2:1)*Math.pow(10,i):-Math.pow(10,-i)/(a>=b5?10:a>=x5?5:a>=S5?2:1)}function w2e(e,t,r){var n=Math.abs(t-e)/Math.max(0,r),i=Math.pow(10,Math.floor(Math.log(n)/Math.LN10)),a=n/i;return a>=b5?i*=10:a>=x5?i*=5:a>=S5&&(i*=2),t<e?-i:i}function v7(e,t){var r=e.length,n=-1,i,a;if(t==null){for(;++n<r;)if((i=e[n])!=null&&i>=i)for(a=i;++n<r;)(i=e[n])!=null&&i>a&&(a=i)}else for(;++n<r;)if((i=t(e[n],n,e))!=null&&i>=i)for(a=i;++n<r;)(i=t(e[n],n,e))!=null&&i>a&&(a=i);return a}var sP=Array.prototype.slice;function E2e(e){return e}var uP=1,cC=2,C5=3,o1=4,m7=1e-6;function A2e(e){return"translate("+(e+.5)+",0)"}function P2e(e){return"translate(0,"+(e+.5)+")"}function T2e(e){return function(t){return+e(t)}}function I2e(e){var t=Math.max(0,e.bandwidth()-1)/2;return e.round()&&(t=Math.round(t)),function(r){return+e(r)+t}}function M2e(){return!this.__axis}function e6(e,t){var r=[],n=null,i=null,a=6,o=6,s=3,u=e===uP||e===o1?-1:1,l=e===o1||e===cC?"x":"y",c=e===uP||e===C5?A2e:P2e;function d(f){var h=n??(t.ticks?t.ticks.apply(t,r):t.domain()),v=i??(t.tickFormat?t.tickFormat.apply(t,r):E2e),p=Math.max(a,0)+s,m=t.range(),g=+m[0]+.5,y=+m[m.length-1]+.5,b=(t.bandwidth?I2e:T2e)(t.copy()),S=f.selection?f.selection():f,x=S.selectAll(".domain").data([null]),C=S.selectAll(".tick").data(h,t).order(),w=C.exit(),A=C.enter().append("g").attr("class","tick"),M=C.select("line"),D=C.select("text");x=x.merge(x.enter().insert("path",".tick").attr("class","domain").attr("stroke","currentColor")),C=C.merge(A),M=M.merge(A.append("line").attr("stroke","currentColor").attr(l+"2",u*a)),D=D.merge(A.append("text").attr("fill","currentColor").attr(l,u*p).attr("dy",e===uP?"0em":e===C5?"0.71em":"0.32em")),f!==S&&(x=x.transition(f),C=C.transition(f),M=M.transition(f),D=D.transition(f),w=w.transition(f).attr("opacity",m7).attr("transform",function(k){return isFinite(k=b(k))?c(k):this.getAttribute("transform")}),A.attr("opacity",m7).attr("transform",function(k){var R=this.parentNode.__axis;return c(R&&isFinite(R=R(k))?R:b(k))})),w.remove(),x.attr("d",e===o1||e==cC?o?"M"+u*o+","+g+"H0.5V"+y+"H"+u*o:"M0.5,"+g+"V"+y:o?"M"+g+","+u*o+"V0.5H"+y+"V"+u*o:"M"+g+",0.5H"+y),C.attr("opacity",1).attr("transform",function(k){return c(b(k))}),M.attr(l+"2",u*a),D.attr(l,u*p).text(v),S.filter(M2e).attr("fill","none").attr("font-size",10).attr("font-family","sans-serif").attr("text-anchor",e===cC?"start":e===o1?"end":"middle"),S.each(function(){this.__axis=b})}return d.scale=function(f){return arguments.length?(t=f,d):t},d.ticks=function(){return r=sP.call(arguments),d},d.tickArguments=function(f){return arguments.length?(r=f==null?[]:sP.call(f),d):r.slice()},d.tickValues=function(f){return arguments.length?(n=f==null?null:sP.call(f),d):n&&n.slice()},d.tickFormat=function(f){return arguments.length?(i=f,d):i},d.tickSize=function(f){return arguments.length?(a=o=+f,d):a},d.tickSizeInner=function(f){return arguments.length?(a=+f,d):a},d.tickSizeOuter=function(f){return arguments.length?(o=+f,d):o},d.tickPadding=function(f){return arguments.length?(s=+f,d):s},d}function D2e(e){return e6(cC,e)}function kK(e){return e6(C5,e)}function R2e(e){return e6(o1,e)}var k2e={value:function(){}};function pE(){for(var e=0,t=arguments.length,r={},n;e<t;++e){if(!(n=arguments[e]+"")||n in r||/[\s.]/.test(n))throw new Error("illegal type: "+n);r[n]=[]}return new dC(r)}function dC(e){this._=e}function O2e(e,t){return e.trim().split(/^|\s+/).map(function(r){var n="",i=r.indexOf(".");if(i>=0&&(n=r.slice(i+1),r=r.slice(0,i)),r&&!t.hasOwnProperty(r))throw new Error("unknown type: "+r);return{type:r,name:n}})}dC.prototype=pE.prototype={constructor:dC,on:function(e,t){var r=this._,n=O2e(e+"",r),i,a=-1,o=n.length;if(arguments.length<2){for(;++a<o;)if((i=(e=n[a]).type)&&(i=F2e(r[i],e.name)))return i;return}if(t!=null&&typeof t!="function")throw new Error("invalid callback: "+t);for(;++a<o;)if(i=(e=n[a]).type)r[i]=g7(r[i],e.name,t);else if(t==null)for(i in r)r[i]=g7(r[i],e.name,null);return this},copy:function(){var e={},t=this._;for(var r in t)e[r]=t[r].slice();return new dC(e)},call:function(e,t){if((i=arguments.length-2)>0)for(var r=new Array(i),n=0,i,a;n<i;++n)r[n]=arguments[n+2];if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(a=this._[e],n=0,i=a.length;n<i;++n)a[n].value.apply(t,r)},apply:function(e,t,r){if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(var n=this._[e],i=0,a=n.length;i<a;++i)n[i].value.apply(t,r)}};function F2e(e,t){for(var r=0,n=e.length,i;r<n;++r)if((i=e[r]).name===t)return i.value}function g7(e,t,r){for(var n=0,i=e.length;n<i;++n)if(e[n].name===t){e[n]=k2e,e=e.slice(0,n).concat(e.slice(n+1));break}return r!=null&&e.push({name:t,value:r}),e}var _5="http://www.w3.org/1999/xhtml";const y7={svg:"http://www.w3.org/2000/svg",xhtml:_5,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function vE(e){var t=e+="",r=t.indexOf(":");return r>=0&&(t=e.slice(0,r))!=="xmlns"&&(e=e.slice(r+1)),y7.hasOwnProperty(t)?{space:y7[t],local:e}:e}function L2e(e){return function(){var t=this.ownerDocument,r=this.namespaceURI;return r===_5&&t.documentElement.namespaceURI===_5?t.createElement(e):t.createElementNS(r,e)}}function N2e(e){return function(){return this.ownerDocument.createElementNS(e.space,e.local)}}function OK(e){var t=vE(e);return(t.local?N2e:L2e)(t)}function B2e(){}function t6(e){return e==null?B2e:function(){return this.querySelector(e)}}function U2e(e){typeof e!="function"&&(e=t6(e));for(var t=this._groups,r=t.length,n=new Array(r),i=0;i<r;++i)for(var a=t[i],o=a.length,s=n[i]=new Array(o),u,l,c=0;c<o;++c)(u=a[c])&&(l=e.call(u,u.__data__,c,a))&&("__data__"in u&&(l.__data__=u.__data__),s[c]=l);return new us(n,this._parents)}function j2e(){return[]}function FK(e){return e==null?j2e:function(){return this.querySelectorAll(e)}}function z2e(e){typeof e!="function"&&(e=FK(e));for(var t=this._groups,r=t.length,n=[],i=[],a=0;a<r;++a)for(var o=t[a],s=o.length,u,l=0;l<s;++l)(u=o[l])&&(n.push(e.call(u,u.__data__,l,o)),i.push(u));return new us(n,i)}function LK(e){return function(){return this.matches(e)}}function V2e(e){typeof e!="function"&&(e=LK(e));for(var t=this._groups,r=t.length,n=new Array(r),i=0;i<r;++i)for(var a=t[i],o=a.length,s=n[i]=[],u,l=0;l<o;++l)(u=a[l])&&e.call(u,u.__data__,l,a)&&s.push(u);return new us(n,this._parents)}function NK(e){return new Array(e.length)}function H2e(){return new us(this._enter||this._groups.map(NK),this._parents)}function A_(e,t){this.ownerDocument=e.ownerDocument,this.namespaceURI=e.namespaceURI,this._next=null,this._parent=e,this.__data__=t}A_.prototype={constructor:A_,appendChild:function(e){return this._parent.insertBefore(e,this._next)},insertBefore:function(e,t){return this._parent.insertBefore(e,t)},querySelector:function(e){return this._parent.querySelector(e)},querySelectorAll:function(e){return this._parent.querySelectorAll(e)}};function G2e(e){return function(){return e}}var b7="$";function q2e(e,t,r,n,i,a){for(var o=0,s,u=t.length,l=a.length;o<l;++o)(s=t[o])?(s.__data__=a[o],n[o]=s):r[o]=new A_(e,a[o]);for(;o<u;++o)(s=t[o])&&(i[o]=s)}function $2e(e,t,r,n,i,a,o){var s,u,l={},c=t.length,d=a.length,f=new Array(c),h;for(s=0;s<c;++s)(u=t[s])&&(f[s]=h=b7+o.call(u,u.__data__,s,t),h in l?i[s]=u:l[h]=u);for(s=0;s<d;++s)h=b7+o.call(e,a[s],s,a),(u=l[h])?(n[s]=u,u.__data__=a[s],l[h]=null):r[s]=new A_(e,a[s]);for(s=0;s<c;++s)(u=t[s])&&l[f[s]]===u&&(i[s]=u)}function W2e(e,t){if(!e)return h=new Array(this.size()),l=-1,this.each(function(C){h[++l]=C}),h;var r=t?$2e:q2e,n=this._parents,i=this._groups;typeof e!="function"&&(e=G2e(e));for(var a=i.length,o=new Array(a),s=new Array(a),u=new Array(a),l=0;l<a;++l){var c=n[l],d=i[l],f=d.length,h=e.call(c,c&&c.__data__,l,n),v=h.length,p=s[l]=new Array(v),m=o[l]=new Array(v),g=u[l]=new Array(f);r(c,d,p,m,g,h,t);for(var y=0,b=0,S,x;y<v;++y)if(S=p[y]){for(y>=b&&(b=y+1);!(x=m[b])&&++b<v;);S._next=x||null}}return o=new us(o,n),o._enter=s,o._exit=u,o}function X2e(){return new us(this._exit||this._groups.map(NK),this._parents)}function Y2e(e,t,r){var n=this.enter(),i=this,a=this.exit();return n=typeof e=="function"?e(n):n.append(e+""),t!=null&&(i=t(i)),r==null?a.remove():r(a),n&&i?n.merge(i).order():i}function K2e(e){for(var t=this._groups,r=e._groups,n=t.length,i=r.length,a=Math.min(n,i),o=new Array(n),s=0;s<a;++s)for(var u=t[s],l=r[s],c=u.length,d=o[s]=new Array(c),f,h=0;h<c;++h)(f=u[h]||l[h])&&(d[h]=f);for(;s<n;++s)o[s]=t[s];return new us(o,this._parents)}function Q2e(){for(var e=this._groups,t=-1,r=e.length;++t<r;)for(var n=e[t],i=n.length-1,a=n[i],o;--i>=0;)(o=n[i])&&(a&&o.compareDocumentPosition(a)^4&&a.parentNode.insertBefore(o,a),a=o);return this}function Z2e(e){e||(e=J2e);function t(d,f){return d&&f?e(d.__data__,f.__data__):!d-!f}for(var r=this._groups,n=r.length,i=new Array(n),a=0;a<n;++a){for(var o=r[a],s=o.length,u=i[a]=new Array(s),l,c=0;c<s;++c)(l=o[c])&&(u[c]=l);u.sort(t)}return new us(i,this._parents).order()}function J2e(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function exe(){var e=arguments[0];return arguments[0]=this,e.apply(null,arguments),this}function txe(){var e=new Array(this.size()),t=-1;return this.each(function(){e[++t]=this}),e}function rxe(){for(var e=this._groups,t=0,r=e.length;t<r;++t)for(var n=e[t],i=0,a=n.length;i<a;++i){var o=n[i];if(o)return o}return null}function nxe(){var e=0;return this.each(function(){++e}),e}function ixe(){return!this.node()}function axe(e){for(var t=this._groups,r=0,n=t.length;r<n;++r)for(var i=t[r],a=0,o=i.length,s;a<o;++a)(s=i[a])&&e.call(s,s.__data__,a,i);return this}function oxe(e){return function(){this.removeAttribute(e)}}function sxe(e){return function(){this.removeAttributeNS(e.space,e.local)}}function uxe(e,t){return function(){this.setAttribute(e,t)}}function lxe(e,t){return function(){this.setAttributeNS(e.space,e.local,t)}}function cxe(e,t){return function(){var r=t.apply(this,arguments);r==null?this.removeAttribute(e):this.setAttribute(e,r)}}function dxe(e,t){return function(){var r=t.apply(this,arguments);r==null?this.removeAttributeNS(e.space,e.local):this.setAttributeNS(e.space,e.local,r)}}function fxe(e,t){var r=vE(e);if(arguments.length<2){var n=this.node();return r.local?n.getAttributeNS(r.space,r.local):n.getAttribute(r)}return this.each((t==null?r.local?sxe:oxe:typeof t=="function"?r.local?dxe:cxe:r.local?lxe:uxe)(r,t))}function BK(e){return e.ownerDocument&&e.ownerDocument.defaultView||e.document&&e||e.defaultView}function hxe(e){return function(){this.style.removeProperty(e)}}function pxe(e,t,r){return function(){this.style.setProperty(e,t,r)}}function vxe(e,t,r){return function(){var n=t.apply(this,arguments);n==null?this.style.removeProperty(e):this.style.setProperty(e,n,r)}}function mxe(e,t,r){return arguments.length>1?this.each((t==null?hxe:typeof t=="function"?vxe:pxe)(e,t,r??"")):i0(this.node(),e)}function i0(e,t){return e.style.getPropertyValue(t)||BK(e).getComputedStyle(e,null).getPropertyValue(t)}function gxe(e){return function(){delete this[e]}}function yxe(e,t){return function(){this[e]=t}}function bxe(e,t){return function(){var r=t.apply(this,arguments);r==null?delete this[e]:this[e]=r}}function xxe(e,t){return arguments.length>1?this.each((t==null?gxe:typeof t=="function"?bxe:yxe)(e,t)):this.node()[e]}function UK(e){return e.trim().split(/^|\s+/)}function r6(e){return e.classList||new jK(e)}function jK(e){this._node=e,this._names=UK(e.getAttribute("class")||"")}jK.prototype={add:function(e){var t=this._names.indexOf(e);t<0&&(this._names.push(e),this._node.setAttribute("class",this._names.join(" ")))},remove:function(e){var t=this._names.indexOf(e);t>=0&&(this._names.splice(t,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(e){return this._names.indexOf(e)>=0}};function zK(e,t){for(var r=r6(e),n=-1,i=t.length;++n<i;)r.add(t[n])}function VK(e,t){for(var r=r6(e),n=-1,i=t.length;++n<i;)r.remove(t[n])}function Sxe(e){return function(){zK(this,e)}}function Cxe(e){return function(){VK(this,e)}}function _xe(e,t){return function(){(t.apply(this,arguments)?zK:VK)(this,e)}}function wxe(e,t){var r=UK(e+"");if(arguments.length<2){for(var n=r6(this.node()),i=-1,a=r.length;++i<a;)if(!n.contains(r[i]))return!1;return!0}return this.each((typeof t=="function"?_xe:t?Sxe:Cxe)(r,t))}function Exe(){this.textContent=""}function Axe(e){return function(){this.textContent=e}}function Pxe(e){return function(){var t=e.apply(this,arguments);this.textContent=t??""}}function Txe(e){return arguments.length?this.each(e==null?Exe:(typeof e=="function"?Pxe:Axe)(e)):this.node().textContent}function Ixe(){this.innerHTML=""}function Mxe(e){return function(){this.innerHTML=e}}function Dxe(e){return function(){var t=e.apply(this,arguments);this.innerHTML=t??""}}function Rxe(e){return arguments.length?this.each(e==null?Ixe:(typeof e=="function"?Dxe:Mxe)(e)):this.node().innerHTML}function kxe(){this.nextSibling&&this.parentNode.appendChild(this)}function Oxe(){return this.each(kxe)}function Fxe(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function Lxe(){return this.each(Fxe)}function Nxe(e){var t=typeof e=="function"?e:OK(e);return this.select(function(){return this.appendChild(t.apply(this,arguments))})}function Bxe(){return null}function Uxe(e,t){var r=typeof e=="function"?e:OK(e),n=t==null?Bxe:typeof t=="function"?t:t6(t);return this.select(function(){return this.insertBefore(r.apply(this,arguments),n.apply(this,arguments)||null)})}function jxe(){var e=this.parentNode;e&&e.removeChild(this)}function zxe(){return this.each(jxe)}function Vxe(){var e=this.cloneNode(!1),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function Hxe(){var e=this.cloneNode(!0),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function Gxe(e){return this.select(e?Hxe:Vxe)}function qxe(e){return arguments.length?this.property("__data__",e):this.node().__data__}var HK={},Wt=null;if(typeof document<"u"){var $xe=document.documentElement;"onmouseenter"in $xe||(HK={mouseenter:"mouseover",mouseleave:"mouseout"})}function Wxe(e,t,r){return e=GK(e,t,r),function(n){var i=n.relatedTarget;(!i||i!==this&&!(i.compareDocumentPosition(this)&8))&&e.call(this,n)}}function GK(e,t,r){return function(n){var i=Wt;Wt=n;try{e.call(this,this.__data__,t,r)}finally{Wt=i}}}function Xxe(e){return e.trim().split(/^|\s+/).map(function(t){var r="",n=t.indexOf(".");return n>=0&&(r=t.slice(n+1),t=t.slice(0,n)),{type:t,name:r}})}function Yxe(e){return function(){var t=this.__on;if(t){for(var r=0,n=-1,i=t.length,a;r<i;++r)a=t[r],(!e.type||a.type===e.type)&&a.name===e.name?this.removeEventListener(a.type,a.listener,a.capture):t[++n]=a;++n?t.length=n:delete this.__on}}}function Kxe(e,t,r){var n=HK.hasOwnProperty(e.type)?Wxe:GK;return function(i,a,o){var s=this.__on,u,l=n(t,a,o);if(s){for(var c=0,d=s.length;c<d;++c)if((u=s[c]).type===e.type&&u.name===e.name){this.removeEventListener(u.type,u.listener,u.capture),this.addEventListener(u.type,u.listener=l,u.capture=r),u.value=t;return}}this.addEventListener(e.type,l,r),u={type:e.type,name:e.name,value:t,listener:l,capture:r},s?s.push(u):this.__on=[u]}}function Qxe(e,t,r){var n=Xxe(e+""),i,a=n.length,o;if(arguments.length<2){var s=this.node().__on;if(s){for(var u=0,l=s.length,c;u<l;++u)for(i=0,c=s[u];i<a;++i)if((o=n[i]).type===c.type&&o.name===c.name)return c.value}return}for(s=t?Kxe:Yxe,r==null&&(r=!1),i=0;i<a;++i)this.each(s(n[i],t,r));return this}function qK(e,t,r,n){var i=Wt;e.sourceEvent=Wt,Wt=e;try{return t.apply(r,n)}finally{Wt=i}}function $K(e,t,r){var n=BK(e),i=n.CustomEvent;typeof i=="function"?i=new i(t,r):(i=n.document.createEvent("Event"),r?(i.initEvent(t,r.bubbles,r.cancelable),i.detail=r.detail):i.initEvent(t,!1,!1)),e.dispatchEvent(i)}function Zxe(e,t){return function(){return $K(this,e,t)}}function Jxe(e,t){return function(){return $K(this,e,t.apply(this,arguments))}}function eSe(e,t){return this.each((typeof t=="function"?Jxe:Zxe)(e,t))}var WK=[null];function us(e,t){this._groups=e,this._parents=t}function x2(){return new us([[document.documentElement]],WK)}us.prototype=x2.prototype={constructor:us,select:U2e,selectAll:z2e,filter:V2e,data:W2e,enter:H2e,exit:X2e,join:Y2e,merge:K2e,order:Q2e,sort:Z2e,call:exe,nodes:txe,node:rxe,size:nxe,empty:ixe,each:axe,attr:fxe,style:mxe,property:xxe,classed:wxe,text:Txe,html:Rxe,raise:Oxe,lower:Lxe,append:Nxe,insert:Uxe,remove:zxe,clone:Gxe,datum:qxe,on:Qxe,dispatch:eSe};function Ui(e){return typeof e=="string"?new us([[document.querySelector(e)]],[document.documentElement]):new us([[e]],WK)}function XK(){for(var e=Wt,t;t=e.sourceEvent;)e=t;return e}function YK(e,t){var r=e.ownerSVGElement||e;if(r.createSVGPoint){var n=r.createSVGPoint();return n.x=t.clientX,n.y=t.clientY,n=n.matrixTransform(e.getScreenCTM().inverse()),[n.x,n.y]}var i=e.getBoundingClientRect();return[t.clientX-i.left-e.clientLeft,t.clientY-i.top-e.clientTop]}function s1(e){var t=XK();return t.changedTouches&&(t=t.changedTouches[0]),YK(e,t)}function w5(e,t,r){arguments.length<3&&(r=t,t=XK().changedTouches);for(var n=0,i=t?t.length:0,a;n<i;++n)if((a=t[n]).identifier===r)return YK(e,a);return null}function E5(){Wt.preventDefault(),Wt.stopImmediatePropagation()}function KK(e){var t=e.document.documentElement,r=Ui(e).on("dragstart.drag",E5,!0);"onselectstart"in t?r.on("selectstart.drag",E5,!0):(t.__noselect=t.style.MozUserSelect,t.style.MozUserSelect="none")}function QK(e,t){var r=e.document.documentElement,n=Ui(e).on("dragstart.drag",null);t&&(n.on("click.drag",E5,!0),setTimeout(function(){n.on("click.drag",null)},0)),"onselectstart"in r?n.on("selectstart.drag",null):(r.style.MozUserSelect=r.__noselect,delete r.__noselect)}function n6(e,t,r){e.prototype=t.prototype=r,r.constructor=e}function ZK(e,t){var r=Object.create(e.prototype);for(var n in t)r[n]=t[n];return r}function S2(){}var Mb=.7,P_=1/Mb,kg="\\s*([+-]?\\d+)\\s*",Db="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",$l="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",tSe=/^#([0-9a-f]{3,8})$/,rSe=new RegExp("^rgb\\("+[kg,kg,kg]+"\\)$"),nSe=new RegExp("^rgb\\("+[$l,$l,$l]+"\\)$"),iSe=new RegExp("^rgba\\("+[kg,kg,kg,Db]+"\\)$"),aSe=new RegExp("^rgba\\("+[$l,$l,$l,Db]+"\\)$"),oSe=new RegExp("^hsl\\("+[Db,$l,$l]+"\\)$"),sSe=new RegExp("^hsla\\("+[Db,$l,$l,Db]+"\\)$"),x7={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};n6(S2,Cv,{copy:function(e){return Object.assign(new this.constructor,this,e)},displayable:function(){return this.rgb().displayable()},hex:S7,formatHex:S7,formatHsl:uSe,formatRgb:C7,toString:C7});function S7(){return this.rgb().formatHex()}function uSe(){return JK(this).formatHsl()}function C7(){return this.rgb().formatRgb()}function Cv(e){var t,r;return e=(e+"").trim().toLowerCase(),(t=tSe.exec(e))?(r=t[1].length,t=parseInt(t[1],16),r===6?_7(t):r===3?new Jo(t>>8&15|t>>4&240,t>>4&15|t&240,(t&15)<<4|t&15,1):r===8?Ax(t>>24&255,t>>16&255,t>>8&255,(t&255)/255):r===4?Ax(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|t&240,((t&15)<<4|t&15)/255):null):(t=rSe.exec(e))?new Jo(t[1],t[2],t[3],1):(t=nSe.exec(e))?new Jo(t[1]*255/100,t[2]*255/100,t[3]*255/100,1):(t=iSe.exec(e))?Ax(t[1],t[2],t[3],t[4]):(t=aSe.exec(e))?Ax(t[1]*255/100,t[2]*255/100,t[3]*255/100,t[4]):(t=oSe.exec(e))?A7(t[1],t[2]/100,t[3]/100,1):(t=sSe.exec(e))?A7(t[1],t[2]/100,t[3]/100,t[4]):x7.hasOwnProperty(e)?_7(x7[e]):e==="transparent"?new Jo(NaN,NaN,NaN,0):null}function _7(e){return new Jo(e>>16&255,e>>8&255,e&255,1)}function Ax(e,t,r,n){return n<=0&&(e=t=r=NaN),new Jo(e,t,r,n)}function lSe(e){return e instanceof S2||(e=Cv(e)),e?(e=e.rgb(),new Jo(e.r,e.g,e.b,e.opacity)):new Jo}function A5(e,t,r,n){return arguments.length===1?lSe(e):new Jo(e,t,r,n??1)}function Jo(e,t,r,n){this.r=+e,this.g=+t,this.b=+r,this.opacity=+n}n6(Jo,A5,ZK(S2,{brighter:function(e){return e=e==null?P_:Math.pow(P_,e),new Jo(this.r*e,this.g*e,this.b*e,this.opacity)},darker:function(e){return e=e==null?Mb:Math.pow(Mb,e),new Jo(this.r*e,this.g*e,this.b*e,this.opacity)},rgb:function(){return this},displayable:function(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:w7,formatHex:w7,formatRgb:E7,toString:E7}));function w7(){return"#"+lP(this.r)+lP(this.g)+lP(this.b)}function E7(){var e=this.opacity;return e=isNaN(e)?1:Math.max(0,Math.min(1,e)),(e===1?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(e===1?")":", "+e+")")}function lP(e){return e=Math.max(0,Math.min(255,Math.round(e)||0)),(e<16?"0":"")+e.toString(16)}function A7(e,t,r,n){return n<=0?e=t=r=NaN:r<=0||r>=1?e=t=NaN:t<=0&&(e=NaN),new kl(e,t,r,n)}function JK(e){if(e instanceof kl)return new kl(e.h,e.s,e.l,e.opacity);if(e instanceof S2||(e=Cv(e)),!e)return new kl;if(e instanceof kl)return e;e=e.rgb();var t=e.r/255,r=e.g/255,n=e.b/255,i=Math.min(t,r,n),a=Math.max(t,r,n),o=NaN,s=a-i,u=(a+i)/2;return s?(t===a?o=(r-n)/s+(r<n)*6:r===a?o=(n-t)/s+2:o=(t-r)/s+4,s/=u<.5?a+i:2-a-i,o*=60):s=u>0&&u<1?0:o,new kl(o,s,u,e.opacity)}function cSe(e,t,r,n){return arguments.length===1?JK(e):new kl(e,t,r,n??1)}function kl(e,t,r,n){this.h=+e,this.s=+t,this.l=+r,this.opacity=+n}n6(kl,cSe,ZK(S2,{brighter:function(e){return e=e==null?P_:Math.pow(P_,e),new kl(this.h,this.s,this.l*e,this.opacity)},darker:function(e){return e=e==null?Mb:Math.pow(Mb,e),new kl(this.h,this.s,this.l*e,this.opacity)},rgb:function(){var e=this.h%360+(this.h<0)*360,t=isNaN(e)||isNaN(this.s)?0:this.s,r=this.l,n=r+(r<.5?r:1-r)*t,i=2*r-n;return new Jo(cP(e>=240?e-240:e+120,i,n),cP(e,i,n),cP(e<120?e+240:e-120,i,n),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl:function(){var e=this.opacity;return e=isNaN(e)?1:Math.max(0,Math.min(1,e)),(e===1?"hsl(":"hsla(")+(this.h||0)+", "+(this.s||0)*100+"%, "+(this.l||0)*100+"%"+(e===1?")":", "+e+")")}}));function cP(e,t,r){return(e<60?t+(r-t)*e/60:e<180?r:e<240?t+(r-t)*(240-e)/60:t)*255}function i6(e){return function(){return e}}function dSe(e,t){return function(r){return e+r*t}}function fSe(e,t,r){return e=Math.pow(e,r),t=Math.pow(t,r)-e,r=1/r,function(n){return Math.pow(e+n*t,r)}}function hSe(e){return(e=+e)==1?eQ:function(t,r){return r-t?fSe(t,r,e):i6(isNaN(t)?r:t)}}function eQ(e,t){var r=t-e;return r?dSe(e,r):i6(isNaN(e)?t:e)}const T_=function e(t){var r=hSe(t);function n(i,a){var o=r((i=A5(i)).r,(a=A5(a)).r),s=r(i.g,a.g),u=r(i.b,a.b),l=eQ(i.opacity,a.opacity);return function(c){return i.r=o(c),i.g=s(c),i.b=u(c),i.opacity=l(c),i+""}}return n.gamma=e,n}(1);function pSe(e,t){t||(t=[]);var r=e?Math.min(t.length,e.length):0,n=t.slice(),i;return function(a){for(i=0;i<r;++i)n[i]=e[i]*(1-a)+t[i]*a;return n}}function vSe(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function mSe(e,t){var r=t?t.length:0,n=e?Math.min(r,e.length):0,i=new Array(n),a=new Array(r),o;for(o=0;o<n;++o)i[o]=mE(e[o],t[o]);for(;o<r;++o)a[o]=t[o];return function(s){for(o=0;o<n;++o)a[o]=i[o](s);return a}}function gSe(e,t){var r=new Date;return e=+e,t=+t,function(n){return r.setTime(e*(1-n)+t*n),r}}function Cu(e,t){return e=+e,t=+t,function(r){return e*(1-r)+t*r}}function ySe(e,t){var r={},n={},i;(e===null||typeof e!="object")&&(e={}),(t===null||typeof t!="object")&&(t={});for(i in t)i in e?r[i]=mE(e[i],t[i]):n[i]=t[i];return function(a){for(i in r)n[i]=r[i](a);return n}}var P5=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,dP=new RegExp(P5.source,"g");function bSe(e){return function(){return e}}function xSe(e){return function(t){return e(t)+""}}function tQ(e,t){var r=P5.lastIndex=dP.lastIndex=0,n,i,a,o=-1,s=[],u=[];for(e=e+"",t=t+"";(n=P5.exec(e))&&(i=dP.exec(t));)(a=i.index)>r&&(a=t.slice(r,a),s[o]?s[o]+=a:s[++o]=a),(n=n[0])===(i=i[0])?s[o]?s[o]+=i:s[++o]=i:(s[++o]=null,u.push({i:o,x:Cu(n,i)})),r=dP.lastIndex;return r<t.length&&(a=t.slice(r),s[o]?s[o]+=a:s[++o]=a),s.length<2?u[0]?xSe(u[0].x):bSe(t):(t=u.length,function(l){for(var c=0,d;c<t;++c)s[(d=u[c]).i]=d.x(l);return s.join("")})}function mE(e,t){var r=typeof t,n;return t==null||r==="boolean"?i6(t):(r==="number"?Cu:r==="string"?(n=Cv(t))?(t=n,T_):tQ:t instanceof Cv?T_:t instanceof Date?gSe:vSe(t)?pSe:Array.isArray(t)?mSe:typeof t.valueOf!="function"&&typeof t.toString!="function"||isNaN(t)?ySe:Cu)(e,t)}function SSe(e,t){return e=+e,t=+t,function(r){return Math.round(e*(1-r)+t*r)}}var P7=180/Math.PI,T5={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function rQ(e,t,r,n,i,a){var o,s,u;return(o=Math.sqrt(e*e+t*t))&&(e/=o,t/=o),(u=e*r+t*n)&&(r-=e*u,n-=t*u),(s=Math.sqrt(r*r+n*n))&&(r/=s,n/=s,u/=s),e*n<t*r&&(e=-e,t=-t,u=-u,o=-o),{translateX:i,translateY:a,rotate:Math.atan2(t,e)*P7,skewX:Math.atan(u)*P7,scaleX:o,scaleY:s}}var yy,fP,T7,Px;function CSe(e){return e==="none"?T5:(yy||(yy=document.createElement("DIV"),fP=document.documentElement,T7=document.defaultView),yy.style.transform=e,e=T7.getComputedStyle(fP.appendChild(yy),null).getPropertyValue("transform"),fP.removeChild(yy),e=e.slice(7,-1).split(","),rQ(+e[0],+e[1],+e[2],+e[3],+e[4],+e[5]))}function _Se(e){return e==null||(Px||(Px=document.createElementNS("http://www.w3.org/2000/svg","g")),Px.setAttribute("transform",e),!(e=Px.transform.baseVal.consolidate()))?T5:(e=e.matrix,rQ(e.a,e.b,e.c,e.d,e.e,e.f))}function nQ(e,t,r,n){function i(l){return l.length?l.pop()+" ":""}function a(l,c,d,f,h,v){if(l!==d||c!==f){var p=h.push("translate(",null,t,null,r);v.push({i:p-4,x:Cu(l,d)},{i:p-2,x:Cu(c,f)})}else(d||f)&&h.push("translate("+d+t+f+r)}function o(l,c,d,f){l!==c?(l-c>180?c+=360:c-l>180&&(l+=360),f.push({i:d.push(i(d)+"rotate(",null,n)-2,x:Cu(l,c)})):c&&d.push(i(d)+"rotate("+c+n)}function s(l,c,d,f){l!==c?f.push({i:d.push(i(d)+"skewX(",null,n)-2,x:Cu(l,c)}):c&&d.push(i(d)+"skewX("+c+n)}function u(l,c,d,f,h,v){if(l!==d||c!==f){var p=h.push(i(h)+"scale(",null,",",null,")");v.push({i:p-4,x:Cu(l,d)},{i:p-2,x:Cu(c,f)})}else(d!==1||f!==1)&&h.push(i(h)+"scale("+d+","+f+")")}return function(l,c){var d=[],f=[];return l=e(l),c=e(c),a(l.translateX,l.translateY,c.translateX,c.translateY,d,f),o(l.rotate,c.rotate,d,f),s(l.skewX,c.skewX,d,f),u(l.scaleX,l.scaleY,c.scaleX,c.scaleY,d,f),l=c=null,function(h){for(var v=-1,p=f.length,m;++v<p;)d[(m=f[v]).i]=m.x(h);return d.join("")}}}var wSe=nQ(CSe,"px, ","px)","deg)"),ESe=nQ(_Se,", ",")",")"),by=Math.SQRT2,hP=2,I7=4,ASe=1e-12;function M7(e){return((e=Math.exp(e))+1/e)/2}function PSe(e){return((e=Math.exp(e))-1/e)/2}function TSe(e){return((e=Math.exp(2*e))-1)/(e+1)}function ISe(e,t){var r=e[0],n=e[1],i=e[2],a=t[0],o=t[1],s=t[2],u=a-r,l=o-n,c=u*u+l*l,d,f;if(c<ASe)f=Math.log(s/i)/by,d=function(y){return[r+y*u,n+y*l,i*Math.exp(by*y*f)]};else{var h=Math.sqrt(c),v=(s*s-i*i+I7*c)/(2*i*hP*h),p=(s*s-i*i-I7*c)/(2*s*hP*h),m=Math.log(Math.sqrt(v*v+1)-v),g=Math.log(Math.sqrt(p*p+1)-p);f=(g-m)/by,d=function(y){var b=y*f,S=M7(m),x=i/(hP*h)*(S*TSe(by*b+m)-PSe(m));return[r+x*u,n+x*l,i*S/M7(by*b+m)]}}return d.duration=f*1e3,d}var a0=0,u1=0,xy=0,iQ=1e3,I_,l1,M_=0,_v=0,gE=0,Rb=typeof performance=="object"&&performance.now?performance:Date,aQ=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(e){setTimeout(e,17)};function yE(){return _v||(aQ(MSe),_v=Rb.now()+gE)}function MSe(){_v=0}function D_(){this._call=this._time=this._next=null}D_.prototype=oQ.prototype={constructor:D_,restart:function(e,t,r){if(typeof e!="function")throw new TypeError("callback is not a function");r=(r==null?yE():+r)+(t==null?0:+t),!this._next&&l1!==this&&(l1?l1._next=this:I_=this,l1=this),this._call=e,this._time=r,I5()},stop:function(){this._call&&(this._call=null,this._time=1/0,I5())}};function oQ(e,t,r){var n=new D_;return n.restart(e,t,r),n}function DSe(){yE(),++a0;for(var e=I_,t;e;)(t=_v-e._time)>=0&&e._call.call(null,t),e=e._next;--a0}function D7(){_v=(M_=Rb.now())+gE,a0=u1=0;try{DSe()}finally{a0=0,kSe(),_v=0}}function RSe(){var e=Rb.now(),t=e-M_;t>iQ&&(gE-=t,M_=e)}function kSe(){for(var e,t=I_,r,n=1/0;t;)t._call?(n>t._time&&(n=t._time),e=t,t=t._next):(r=t._next,t._next=null,t=e?e._next=r:I_=r);l1=e,I5(n)}function I5(e){if(!a0){u1&&(u1=clearTimeout(u1));var t=e-_v;t>24?(e<1/0&&(u1=setTimeout(D7,e-Rb.now()-gE)),xy&&(xy=clearInterval(xy))):(xy||(M_=Rb.now(),xy=setInterval(RSe,iQ)),a0=1,aQ(D7))}}function R7(e,t,r){var n=new D_;return t=t==null?0:+t,n.restart(function(i){n.stop(),e(i+t)},t,r),n}var OSe=pE("start","end","cancel","interrupt"),FSe=[],sQ=0,k7=1,M5=2,fC=3,O7=4,D5=5,hC=6;function bE(e,t,r,n,i,a){var o=e.__transition;if(!o)e.__transition={};else if(r in o)return;LSe(e,r,{name:t,index:n,group:i,on:OSe,tween:FSe,time:a.time,delay:a.delay,duration:a.duration,ease:a.ease,timer:null,state:sQ})}function a6(e,t){var r=Qu(e,t);if(r.state>sQ)throw new Error("too late; already scheduled");return r}function Md(e,t){var r=Qu(e,t);if(r.state>fC)throw new Error("too late; already running");return r}function Qu(e,t){var r=e.__transition;if(!r||!(r=r[t]))throw new Error("transition not found");return r}function LSe(e,t,r){var n=e.__transition,i;n[t]=r,r.timer=oQ(a,0,r.time);function a(l){r.state=k7,r.timer.restart(o,r.delay,r.time),r.delay<=l&&o(l-r.delay)}function o(l){var c,d,f,h;if(r.state!==k7)return u();for(c in n)if(h=n[c],h.name===r.name){if(h.state===fC)return R7(o);h.state===O7?(h.state=hC,h.timer.stop(),h.on.call("interrupt",e,e.__data__,h.index,h.group),delete n[c]):+c<t&&(h.state=hC,h.timer.stop(),h.on.call("cancel",e,e.__data__,h.index,h.group),delete n[c])}if(R7(function(){r.state===fC&&(r.state=O7,r.timer.restart(s,r.delay,r.time),s(l))}),r.state=M5,r.on.call("start",e,e.__data__,r.index,r.group),r.state===M5){for(r.state=fC,i=new Array(f=r.tween.length),c=0,d=-1;c<f;++c)(h=r.tween[c].value.call(e,e.__data__,r.index,r.group))&&(i[++d]=h);i.length=d+1}}function s(l){for(var c=l<r.duration?r.ease.call(null,l/r.duration):(r.timer.restart(u),r.state=D5,1),d=-1,f=i.length;++d<f;)i[d].call(e,c);r.state===D5&&(r.on.call("end",e,e.__data__,r.index,r.group),u())}function u(){r.state=hC,r.timer.stop(),delete n[t];for(var l in n)return;delete e.__transition}}function Og(e,t){var r=e.__transition,n,i,a=!0,o;if(r){t=t==null?null:t+"";for(o in r){if((n=r[o]).name!==t){a=!1;continue}i=n.state>M5&&n.state<D5,n.state=hC,n.timer.stop(),n.on.call(i?"interrupt":"cancel",e,e.__data__,n.index,n.group),delete r[o]}a&&delete e.__transition}}function NSe(e){return this.each(function(){Og(this,e)})}function BSe(e,t){var r,n;return function(){var i=Md(this,e),a=i.tween;if(a!==r){n=r=a;for(var o=0,s=n.length;o<s;++o)if(n[o].name===t){n=n.slice(),n.splice(o,1);break}}i.tween=n}}function USe(e,t,r){var n,i;if(typeof r!="function")throw new Error;return function(){var a=Md(this,e),o=a.tween;if(o!==n){i=(n=o).slice();for(var s={name:t,value:r},u=0,l=i.length;u<l;++u)if(i[u].name===t){i[u]=s;break}u===l&&i.push(s)}a.tween=i}}function jSe(e,t){var r=this._id;if(e+="",arguments.length<2){for(var n=Qu(this.node(),r).tween,i=0,a=n.length,o;i<a;++i)if((o=n[i]).name===e)return o.value;return null}return this.each((t==null?BSe:USe)(r,e,t))}function o6(e,t,r){var n=e._id;return e.each(function(){var i=Md(this,n);(i.value||(i.value={}))[t]=r.apply(this,arguments)}),function(i){return Qu(i,n).value[t]}}function uQ(e,t){var r;return(typeof t=="number"?Cu:t instanceof Cv?T_:(r=Cv(t))?(t=r,T_):tQ)(e,t)}function zSe(e){return function(){this.removeAttribute(e)}}function VSe(e){return function(){this.removeAttributeNS(e.space,e.local)}}function HSe(e,t,r){var n,i=r+"",a;return function(){var o=this.getAttribute(e);return o===i?null:o===n?a:a=t(n=o,r)}}function GSe(e,t,r){var n,i=r+"",a;return function(){var o=this.getAttributeNS(e.space,e.local);return o===i?null:o===n?a:a=t(n=o,r)}}function qSe(e,t,r){var n,i,a;return function(){var o,s=r(this),u;return s==null?void this.removeAttribute(e):(o=this.getAttribute(e),u=s+"",o===u?null:o===n&&u===i?a:(i=u,a=t(n=o,s)))}}function $Se(e,t,r){var n,i,a;return function(){var o,s=r(this),u;return s==null?void this.removeAttributeNS(e.space,e.local):(o=this.getAttributeNS(e.space,e.local),u=s+"",o===u?null:o===n&&u===i?a:(i=u,a=t(n=o,s)))}}function WSe(e,t){var r=vE(e),n=r==="transform"?ESe:uQ;return this.attrTween(e,typeof t=="function"?(r.local?$Se:qSe)(r,n,o6(this,"attr."+e,t)):t==null?(r.local?VSe:zSe)(r):(r.local?GSe:HSe)(r,n,t))}function XSe(e,t){return function(r){this.setAttribute(e,t.call(this,r))}}function YSe(e,t){return function(r){this.setAttributeNS(e.space,e.local,t.call(this,r))}}function KSe(e,t){var r,n;function i(){var a=t.apply(this,arguments);return a!==n&&(r=(n=a)&&YSe(e,a)),r}return i._value=t,i}function QSe(e,t){var r,n;function i(){var a=t.apply(this,arguments);return a!==n&&(r=(n=a)&&XSe(e,a)),r}return i._value=t,i}function ZSe(e,t){var r="attr."+e;if(arguments.length<2)return(r=this.tween(r))&&r._value;if(t==null)return this.tween(r,null);if(typeof t!="function")throw new Error;var n=vE(e);return this.tween(r,(n.local?KSe:QSe)(n,t))}function JSe(e,t){return function(){a6(this,e).delay=+t.apply(this,arguments)}}function eCe(e,t){return t=+t,function(){a6(this,e).delay=t}}function tCe(e){var t=this._id;return arguments.length?this.each((typeof e=="function"?JSe:eCe)(t,e)):Qu(this.node(),t).delay}function rCe(e,t){return function(){Md(this,e).duration=+t.apply(this,arguments)}}function nCe(e,t){return t=+t,function(){Md(this,e).duration=t}}function iCe(e){var t=this._id;return arguments.length?this.each((typeof e=="function"?rCe:nCe)(t,e)):Qu(this.node(),t).duration}function aCe(e,t){if(typeof t!="function")throw new Error;return function(){Md(this,e).ease=t}}function oCe(e){var t=this._id;return arguments.length?this.each(aCe(t,e)):Qu(this.node(),t).ease}function sCe(e){typeof e!="function"&&(e=LK(e));for(var t=this._groups,r=t.length,n=new Array(r),i=0;i<r;++i)for(var a=t[i],o=a.length,s=n[i]=[],u,l=0;l<o;++l)(u=a[l])&&e.call(u,u.__data__,l,a)&&s.push(u);return new sd(n,this._parents,this._name,this._id)}function uCe(e){if(e._id!==this._id)throw new Error;for(var t=this._groups,r=e._groups,n=t.length,i=r.length,a=Math.min(n,i),o=new Array(n),s=0;s<a;++s)for(var u=t[s],l=r[s],c=u.length,d=o[s]=new Array(c),f,h=0;h<c;++h)(f=u[h]||l[h])&&(d[h]=f);for(;s<n;++s)o[s]=t[s];return new sd(o,this._parents,this._name,this._id)}function lCe(e){return(e+"").trim().split(/^|\s+/).every(function(t){var r=t.indexOf(".");return r>=0&&(t=t.slice(0,r)),!t||t==="start"})}function cCe(e,t,r){var n,i,a=lCe(t)?a6:Md;return function(){var o=a(this,e),s=o.on;s!==n&&(i=(n=s).copy()).on(t,r),o.on=i}}function dCe(e,t){var r=this._id;return arguments.length<2?Qu(this.node(),r).on.on(e):this.each(cCe(r,e,t))}function fCe(e){return function(){var t=this.parentNode;for(var r in this.__transition)if(+r!==e)return;t&&t.removeChild(this)}}function hCe(){return this.on("end.remove",fCe(this._id))}function pCe(e){var t=this._name,r=this._id;typeof e!="function"&&(e=t6(e));for(var n=this._groups,i=n.length,a=new Array(i),o=0;o<i;++o)for(var s=n[o],u=s.length,l=a[o]=new Array(u),c,d,f=0;f<u;++f)(c=s[f])&&(d=e.call(c,c.__data__,f,s))&&("__data__"in c&&(d.__data__=c.__data__),l[f]=d,bE(l[f],t,r,f,l,Qu(c,r)));return new sd(a,this._parents,t,r)}function vCe(e){var t=this._name,r=this._id;typeof e!="function"&&(e=FK(e));for(var n=this._groups,i=n.length,a=[],o=[],s=0;s<i;++s)for(var u=n[s],l=u.length,c,d=0;d<l;++d)if(c=u[d]){for(var f=e.call(c,c.__data__,d,u),h,v=Qu(c,r),p=0,m=f.length;p<m;++p)(h=f[p])&&bE(h,t,r,p,f,v);a.push(f),o.push(c)}return new sd(a,o,t,r)}var mCe=x2.prototype.constructor;function gCe(){return new mCe(this._groups,this._parents)}function yCe(e,t){var r,n,i;return function(){var a=i0(this,e),o=(this.style.removeProperty(e),i0(this,e));return a===o?null:a===r&&o===n?i:i=t(r=a,n=o)}}function lQ(e){return function(){this.style.removeProperty(e)}}function bCe(e,t,r){var n,i=r+"",a;return function(){var o=i0(this,e);return o===i?null:o===n?a:a=t(n=o,r)}}function xCe(e,t,r){var n,i,a;return function(){var o=i0(this,e),s=r(this),u=s+"";return s==null&&(u=s=(this.style.removeProperty(e),i0(this,e))),o===u?null:o===n&&u===i?a:(i=u,a=t(n=o,s))}}function SCe(e,t){var r,n,i,a="style."+t,o="end."+a,s;return function(){var u=Md(this,e),l=u.on,c=u.value[a]==null?s||(s=lQ(t)):void 0;(l!==r||i!==c)&&(n=(r=l).copy()).on(o,i=c),u.on=n}}function CCe(e,t,r){var n=(e+="")=="transform"?wSe:uQ;return t==null?this.styleTween(e,yCe(e,n)).on("end.style."+e,lQ(e)):typeof t=="function"?this.styleTween(e,xCe(e,n,o6(this,"style."+e,t))).each(SCe(this._id,e)):this.styleTween(e,bCe(e,n,t),r).on("end.style."+e,null)}function _Ce(e,t,r){return function(n){this.style.setProperty(e,t.call(this,n),r)}}function wCe(e,t,r){var n,i;function a(){var o=t.apply(this,arguments);return o!==i&&(n=(i=o)&&_Ce(e,o,r)),n}return a._value=t,a}function ECe(e,t,r){var n="style."+(e+="");if(arguments.length<2)return(n=this.tween(n))&&n._value;if(t==null)return this.tween(n,null);if(typeof t!="function")throw new Error;return this.tween(n,wCe(e,t,r??""))}function ACe(e){return function(){this.textContent=e}}function PCe(e){return function(){var t=e(this);this.textContent=t??""}}function TCe(e){return this.tween("text",typeof e=="function"?PCe(o6(this,"text",e)):ACe(e==null?"":e+""))}function ICe(e){return function(t){this.textContent=e.call(this,t)}}function MCe(e){var t,r;function n(){var i=e.apply(this,arguments);return i!==r&&(t=(r=i)&&ICe(i)),t}return n._value=e,n}function DCe(e){var t="text";if(arguments.length<1)return(t=this.tween(t))&&t._value;if(e==null)return this.tween(t,null);if(typeof e!="function")throw new Error;return this.tween(t,MCe(e))}function RCe(){for(var e=this._name,t=this._id,r=cQ(),n=this._groups,i=n.length,a=0;a<i;++a)for(var o=n[a],s=o.length,u,l=0;l<s;++l)if(u=o[l]){var c=Qu(u,t);bE(u,e,r,l,o,{time:c.time+c.delay+c.duration,delay:0,duration:c.duration,ease:c.ease})}return new sd(n,this._parents,e,r)}function kCe(){var e,t,r=this,n=r._id,i=r.size();return new Promise(function(a,o){var s={value:o},u={value:function(){--i===0&&a()}};r.each(function(){var l=Md(this,n),c=l.on;c!==e&&(t=(e=c).copy(),t._.cancel.push(s),t._.interrupt.push(s),t._.end.push(u)),l.on=t})})}var OCe=0;function sd(e,t,r,n){this._groups=e,this._parents=t,this._name=r,this._id=n}function cQ(){return++OCe}var Em=x2.prototype;sd.prototype={constructor:sd,select:pCe,selectAll:vCe,filter:sCe,merge:uCe,selection:gCe,transition:RCe,call:Em.call,nodes:Em.nodes,node:Em.node,size:Em.size,empty:Em.empty,each:Em.each,on:dCe,attr:WSe,attrTween:ZSe,style:CCe,styleTween:ECe,text:TCe,textTween:DCe,remove:hCe,tween:jSe,delay:tCe,duration:iCe,ease:oCe,end:kCe};function FCe(e){return((e*=2)<=1?e*e*e:(e-=2)*e*e+2)/2}var R5={time:null,delay:0,duration:250,ease:FCe};function LCe(e,t){for(var r;!(r=e.__transition)||!(r=r[t]);)if(!(e=e.parentNode))return R5.time=yE(),R5;return r}function NCe(e){var t,r;e instanceof sd?(t=e._id,e=e._name):(t=cQ(),(r=R5).time=yE(),e=e==null?null:e+"");for(var n=this._groups,i=n.length,a=0;a<i;++a)for(var o=n[a],s=o.length,u,l=0;l<s;++l)(u=o[l])&&bE(u,e,t,l,o,r||LCe(u,t));return new sd(n,this._parents,e,t)}x2.prototype.interrupt=NSe;x2.prototype.transition=NCe;function pP(e){return function(){return e}}function BCe(e,t,r){this.target=e,this.type=t,this.selection=r}function F7(){Wt.stopImmediatePropagation()}function vP(){Wt.preventDefault(),Wt.stopImmediatePropagation()}var L7={name:"drag"},mP={name:"space"},Am={name:"handle"},Pm={name:"center"};function N7(e){return[+e[0],+e[1]]}function B7(e){return[N7(e[0]),N7(e[1])]}function UCe(e){return function(t){return w5(t,Wt.touches,e)}}var pC={name:"x",handles:["w","e"].map(R_),input:function(e,t){return e==null?null:[[+e[0],t[0][1]],[+e[1],t[1][1]]]},output:function(e){return e&&[e[0][0],e[1][0]]}},gP={name:"y",handles:["n","s"].map(R_),input:function(e,t){return e==null?null:[[t[0][0],+e[0]],[t[1][0],+e[1]]]},output:function(e){return e&&[e[0][1],e[1][1]]}},cc={overlay:"crosshair",selection:"move",n:"ns-resize",e:"ew-resize",s:"ns-resize",w:"ew-resize",nw:"nwse-resize",ne:"nesw-resize",se:"nwse-resize",sw:"nesw-resize"},U7={e:"w",w:"e",nw:"ne",ne:"nw",se:"sw",sw:"se"},j7={n:"s",s:"n",nw:"sw",ne:"se",se:"ne",sw:"nw"},jCe={overlay:1,selection:1,n:null,e:1,s:null,w:-1,nw:-1,ne:1,se:1,sw:-1},zCe={overlay:1,selection:1,n:-1,e:null,s:1,w:null,nw:-1,ne:-1,se:1,sw:1};function R_(e){return{type:e}}function VCe(){return!Wt.ctrlKey&&!Wt.button}function HCe(){var e=this.ownerSVGElement||this;return e.hasAttribute("viewBox")?(e=e.viewBox.baseVal,[[e.x,e.y],[e.x+e.width,e.y+e.height]]):[[0,0],[e.width.baseVal.value,e.height.baseVal.value]]}function GCe(){return navigator.maxTouchPoints||"ontouchstart"in this}function yP(e){for(;!e.__brush;)if(!(e=e.parentNode))return;return e.__brush}function qCe(e){return e[0][0]===e[1][0]||e[0][1]===e[1][1]}function $Ce(){return WCe(pC)}function WCe(e){var t=HCe,r=VCe,n=GCe,i=!0,a=pE("start","brush","end"),o=6,s;function u(m){var g=m.property("__brush",p).selectAll(".overlay").data([R_("overlay")]);g.enter().append("rect").attr("class","overlay").attr("pointer-events","all").attr("cursor",cc.overlay).merge(g).each(function(){var b=yP(this).extent;Ui(this).attr("x",b[0][0]).attr("y",b[0][1]).attr("width",b[1][0]-b[0][0]).attr("height",b[1][1]-b[0][1])}),m.selectAll(".selection").data([R_("selection")]).enter().append("rect").attr("class","selection").attr("cursor",cc.selection).attr("fill","#777").attr("fill-opacity",.3).attr("stroke","#fff").attr("shape-rendering","crispEdges");var y=m.selectAll(".handle").data(e.handles,function(b){return b.type});y.exit().remove(),y.enter().append("rect").attr("class",function(b){return"handle handle--"+b.type}).attr("cursor",function(b){return cc[b.type]}),m.each(l).attr("fill","none").attr("pointer-events","all").on("mousedown.brush",f).filter(n).on("touchstart.brush",f).on("touchmove.brush",h).on("touchend.brush touchcancel.brush",v).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}u.move=function(m,g){m.selection?m.on("start.brush",function(){c(this,arguments).beforestart().start()}).on("interrupt.brush end.brush",function(){c(this,arguments).end()}).tween("brush",function(){var y=this,b=y.__brush,S=c(y,arguments),x=b.selection,C=e.input(typeof g=="function"?g.apply(this,arguments):g,b.extent),w=mE(x,C);function A(M){b.selection=M===1&&C===null?null:w(M),l.call(y),S.brush()}return x!==null&&C!==null?A:A(1)}):m.each(function(){var y=this,b=arguments,S=y.__brush,x=e.input(typeof g=="function"?g.apply(y,b):g,S.extent),C=c(y,b).beforestart();Og(y),S.selection=x===null?null:x,l.call(y),C.start().brush().end()})},u.clear=function(m){u.move(m,null)};function l(){var m=Ui(this),g=yP(this).selection;g?(m.selectAll(".selection").style("display",null).attr("x",g[0][0]).attr("y",g[0][1]).attr("width",g[1][0]-g[0][0]).attr("height",g[1][1]-g[0][1]),m.selectAll(".handle").style("display",null).attr("x",function(y){return y.type[y.type.length-1]==="e"?g[1][0]-o/2:g[0][0]-o/2}).attr("y",function(y){return y.type[0]==="s"?g[1][1]-o/2:g[0][1]-o/2}).attr("width",function(y){return y.type==="n"||y.type==="s"?g[1][0]-g[0][0]+o:o}).attr("height",function(y){return y.type==="e"||y.type==="w"?g[1][1]-g[0][1]+o:o})):m.selectAll(".selection,.handle").style("display","none").attr("x",null).attr("y",null).attr("width",null).attr("height",null)}function c(m,g,y){var b=m.__brush.emitter;return b&&(!y||!b.clean)?b:new d(m,g,y)}function d(m,g,y){this.that=m,this.args=g,this.state=m.__brush,this.active=0,this.clean=y}d.prototype={beforestart:function(){return++this.active===1&&(this.state.emitter=this,this.starting=!0),this},start:function(){return this.starting?(this.starting=!1,this.emit("start")):this.emit("brush"),this},brush:function(){return this.emit("brush"),this},end:function(){return--this.active===0&&(delete this.state.emitter,this.emit("end")),this},emit:function(m){qK(new BCe(u,m,e.output(this.state.selection)),a.apply,a,[m,this.that,this.args])}};function f(){if(s&&!Wt.touches||!r.apply(this,arguments))return;var m=this,g=Wt.target.__data__.type,y=(i&&Wt.metaKey?g="overlay":g)==="selection"?L7:i&&Wt.altKey?Pm:Am,b=e===gP?null:jCe[g],S=e===pC?null:zCe[g],x=yP(m),C=x.extent,w=x.selection,A=C[0][0],M,D,k=C[0][1],R,O,H=C[1][0],B,j,Y=C[1][1],G,$,q=0,ee=0,fe,W=b&&S&&i&&Wt.shiftKey,X,U,z=Wt.touches?UCe(Wt.changedTouches[0].identifier):s1,J=z(m),K=J,Z=c(m,arguments,!0).beforestart();g==="overlay"?(w&&(fe=!0),x.selection=w=[[M=e===gP?A:J[0],R=e===pC?k:J[1]],[B=e===gP?H:M,G=e===pC?Y:R]]):(M=w[0][0],R=w[0][1],B=w[1][0],G=w[1][1]),D=M,O=R,j=B,$=G;var te=Ui(m).attr("pointer-events","none"),le=te.selectAll(".overlay").attr("cursor",cc[g]);if(Wt.touches)Z.moved=be,Z.ended=Se;else{var ye=Ui(Wt.view).on("mousemove.brush",be,!0).on("mouseup.brush",Se,!0);i&&ye.on("keydown.brush",ie,!0).on("keyup.brush",oe,!0),KK(Wt.view)}F7(),Og(m),l.call(m),Z.start();function be(){var F=z(m);W&&!X&&!U&&(Math.abs(F[0]-K[0])>Math.abs(F[1]-K[1])?U=!0:X=!0),K=F,fe=!0,vP(),Ae()}function Ae(){var F;switch(q=K[0]-J[0],ee=K[1]-J[1],y){case mP:case L7:{b&&(q=Math.max(A-M,Math.min(H-B,q)),D=M+q,j=B+q),S&&(ee=Math.max(k-R,Math.min(Y-G,ee)),O=R+ee,$=G+ee);break}case Am:{b<0?(q=Math.max(A-M,Math.min(H-M,q)),D=M+q,j=B):b>0&&(q=Math.max(A-B,Math.min(H-B,q)),D=M,j=B+q),S<0?(ee=Math.max(k-R,Math.min(Y-R,ee)),O=R+ee,$=G):S>0&&(ee=Math.max(k-G,Math.min(Y-G,ee)),O=R,$=G+ee);break}case Pm:{b&&(D=Math.max(A,Math.min(H,M-q*b)),j=Math.max(A,Math.min(H,B+q*b))),S&&(O=Math.max(k,Math.min(Y,R-ee*S)),$=Math.max(k,Math.min(Y,G+ee*S)));break}}j<D&&(b*=-1,F=M,M=B,B=F,F=D,D=j,j=F,g in U7&&le.attr("cursor",cc[g=U7[g]])),$<O&&(S*=-1,F=R,R=G,G=F,F=O,O=$,$=F,g in j7&&le.attr("cursor",cc[g=j7[g]])),x.selection&&(w=x.selection),X&&(D=w[0][0],j=w[1][0]),U&&(O=w[0][1],$=w[1][1]),(w[0][0]!==D||w[0][1]!==O||w[1][0]!==j||w[1][1]!==$)&&(x.selection=[[D,O],[j,$]],l.call(m),Z.brush())}function Se(){if(F7(),Wt.touches){if(Wt.touches.length)return;s&&clearTimeout(s),s=setTimeout(function(){s=null},500)}else QK(Wt.view,fe),ye.on("keydown.brush keyup.brush mousemove.brush mouseup.brush",null);te.attr("pointer-events","all"),le.attr("cursor",cc.overlay),x.selection&&(w=x.selection),qCe(w)&&(x.selection=null,l.call(m)),Z.end()}function ie(){switch(Wt.keyCode){case 16:{W=b&&S;break}case 18:{y===Am&&(b&&(B=j-q*b,M=D+q*b),S&&(G=$-ee*S,R=O+ee*S),y=Pm,Ae());break}case 32:{(y===Am||y===Pm)&&(b<0?B=j-q:b>0&&(M=D-q),S<0?G=$-ee:S>0&&(R=O-ee),y=mP,le.attr("cursor",cc.selection),Ae());break}default:return}vP()}function oe(){switch(Wt.keyCode){case 16:{W&&(X=U=W=!1,Ae());break}case 18:{y===Pm&&(b<0?B=j:b>0&&(M=D),S<0?G=$:S>0&&(R=O),y=Am,Ae());break}case 32:{y===mP&&(Wt.altKey?(b&&(B=j-q*b,M=D+q*b),S&&(G=$-ee*S,R=O+ee*S),y=Pm):(b<0?B=j:b>0&&(M=D),S<0?G=$:S>0&&(R=O),y=Am),le.attr("cursor",cc[g]),Ae());break}default:return}vP()}}function h(){c(this,arguments).moved()}function v(){c(this,arguments).ended()}function p(){var m=this.__brush||{selection:null};return m.extent=B7(t.apply(this,arguments)),m.dim=e,m}return u.extent=function(m){return arguments.length?(t=typeof m=="function"?m:pP(B7(m)),u):t},u.filter=function(m){return arguments.length?(r=typeof m=="function"?m:pP(!!m),u):r},u.touchable=function(m){return arguments.length?(n=typeof m=="function"?m:pP(!!m),u):n},u.handleSize=function(m){return arguments.length?(o=+m,u):o},u.keyModifiers=function(m){return arguments.length?(i=!!m,u):i},u.on=function(){var m=a.on.apply(a,arguments);return m===a?u:m},u}var k5=Math.PI,O5=2*k5,Ep=1e-6,XCe=O5-Ep;function F5(){this._x0=this._y0=this._x1=this._y1=null,this._=""}function dQ(){return new F5}F5.prototype=dQ.prototype={constructor:F5,moveTo:function(e,t){this._+="M"+(this._x0=this._x1=+e)+","+(this._y0=this._y1=+t)},closePath:function(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")},lineTo:function(e,t){this._+="L"+(this._x1=+e)+","+(this._y1=+t)},quadraticCurveTo:function(e,t,r,n){this._+="Q"+ +e+","+ +t+","+(this._x1=+r)+","+(this._y1=+n)},bezierCurveTo:function(e,t,r,n,i,a){this._+="C"+ +e+","+ +t+","+ +r+","+ +n+","+(this._x1=+i)+","+(this._y1=+a)},arcTo:function(e,t,r,n,i){e=+e,t=+t,r=+r,n=+n,i=+i;var a=this._x1,o=this._y1,s=r-e,u=n-t,l=a-e,c=o-t,d=l*l+c*c;if(i<0)throw new Error("negative radius: "+i);if(this._x1===null)this._+="M"+(this._x1=e)+","+(this._y1=t);else if(d>Ep)if(!(Math.abs(c*s-u*l)>Ep)||!i)this._+="L"+(this._x1=e)+","+(this._y1=t);else{var f=r-a,h=n-o,v=s*s+u*u,p=f*f+h*h,m=Math.sqrt(v),g=Math.sqrt(d),y=i*Math.tan((k5-Math.acos((v+d-p)/(2*m*g)))/2),b=y/g,S=y/m;Math.abs(b-1)>Ep&&(this._+="L"+(e+b*l)+","+(t+b*c)),this._+="A"+i+","+i+",0,0,"+ +(c*f>l*h)+","+(this._x1=e+S*s)+","+(this._y1=t+S*u)}},arc:function(e,t,r,n,i,a){e=+e,t=+t,r=+r,a=!!a;var o=r*Math.cos(n),s=r*Math.sin(n),u=e+o,l=t+s,c=1^a,d=a?n-i:i-n;if(r<0)throw new Error("negative radius: "+r);this._x1===null?this._+="M"+u+","+l:(Math.abs(this._x1-u)>Ep||Math.abs(this._y1-l)>Ep)&&(this._+="L"+u+","+l),r&&(d<0&&(d=d%O5+O5),d>XCe?this._+="A"+r+","+r+",0,1,"+c+","+(e-o)+","+(t-s)+"A"+r+","+r+",0,1,"+c+","+(this._x1=u)+","+(this._y1=l):d>Ep&&(this._+="A"+r+","+r+",0,"+ +(d>=k5)+","+c+","+(this._x1=e+r*Math.cos(i))+","+(this._y1=t+r*Math.sin(i))))},rect:function(e,t,r,n){this._+="M"+(this._x0=this._x1=+e)+","+(this._y0=this._y1=+t)+"h"+ +r+"v"+ +n+"h"+-r+"Z"},toString:function(){return this._}};var Rs="$";function k_(){}k_.prototype=O_.prototype={constructor:k_,has:function(e){return Rs+e in this},get:function(e){return this[Rs+e]},set:function(e,t){return this[Rs+e]=t,this},remove:function(e){var t=Rs+e;return t in this&&delete this[t]},clear:function(){for(var e in this)e[0]===Rs&&delete this[e]},keys:function(){var e=[];for(var t in this)t[0]===Rs&&e.push(t.slice(1));return e},values:function(){var e=[];for(var t in this)t[0]===Rs&&e.push(this[t]);return e},entries:function(){var e=[];for(var t in this)t[0]===Rs&&e.push({key:t.slice(1),value:this[t]});return e},size:function(){var e=0;for(var t in this)t[0]===Rs&&++e;return e},empty:function(){for(var e in this)if(e[0]===Rs)return!1;return!0},each:function(e){for(var t in this)t[0]===Rs&&e(this[t],t.slice(1),this)}};function O_(e,t){var r=new k_;if(e instanceof k_)e.each(function(s,u){r.set(u,s)});else if(Array.isArray(e)){var n=-1,i=e.length,a;if(t==null)for(;++n<i;)r.set(n,e[n]);else for(;++n<i;)r.set(t(a=e[n],n,e),a)}else if(e)for(var o in e)r.set(o,e[o]);return r}function z7(){}var Zh=O_.prototype;z7.prototype={constructor:z7,has:Zh.has,add:function(e){return e+="",this[Rs+e]=e,this},remove:Zh.remove,clear:Zh.clear,values:Zh.keys,size:Zh.size,empty:Zh.empty,each:Zh.each};function YCe(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)}function F_(e,t){if((r=(e=t?e.toExponential(t-1):e.toExponential()).indexOf("e"))<0)return null;var r,n=e.slice(0,r);return[n.length>1?n[0]+n.slice(2):n,+e.slice(r+1)]}function o0(e){return e=F_(Math.abs(e)),e?e[1]:NaN}function KCe(e,t){return function(r,n){for(var i=r.length,a=[],o=0,s=e[0],u=0;i>0&&s>0&&(u+s+1>n&&(s=Math.max(1,n-u)),a.push(r.substring(i-=s,i+s)),!((u+=s+1)>n));)s=e[o=(o+1)%e.length];return a.reverse().join(t)}}function QCe(e){return function(t){return t.replace(/[0-9]/g,function(r){return e[+r]})}}var ZCe=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function L_(e){if(!(t=ZCe.exec(e)))throw new Error("invalid format: "+e);var t;return new s6({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}L_.prototype=s6.prototype;function s6(e){this.fill=e.fill===void 0?" ":e.fill+"",this.align=e.align===void 0?">":e.align+"",this.sign=e.sign===void 0?"-":e.sign+"",this.symbol=e.symbol===void 0?"":e.symbol+"",this.zero=!!e.zero,this.width=e.width===void 0?void 0:+e.width,this.comma=!!e.comma,this.precision=e.precision===void 0?void 0:+e.precision,this.trim=!!e.trim,this.type=e.type===void 0?"":e.type+""}s6.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function JCe(e){e:for(var t=e.length,r=1,n=-1,i;r<t;++r)switch(e[r]){case".":n=i=r;break;case"0":n===0&&(n=r),i=r;break;default:if(!+e[r])break e;n>0&&(n=0);break}return n>0?e.slice(0,n)+e.slice(i+1):e}var fQ;function e_e(e,t){var r=F_(e,t);if(!r)return e+"";var n=r[0],i=r[1],a=i-(fQ=Math.max(-8,Math.min(8,Math.floor(i/3)))*3)+1,o=n.length;return a===o?n:a>o?n+new Array(a-o+1).join("0"):a>0?n.slice(0,a)+"."+n.slice(a):"0."+new Array(1-a).join("0")+F_(e,Math.max(0,t+a-1))[0]}function V7(e,t){var r=F_(e,t);if(!r)return e+"";var n=r[0],i=r[1];return i<0?"0."+new Array(-i).join("0")+n:n.length>i+1?n.slice(0,i+1)+"."+n.slice(i+1):n+new Array(i-n.length+2).join("0")}const H7={"%":function(e,t){return(e*100).toFixed(t)},b:function(e){return Math.round(e).toString(2)},c:function(e){return e+""},d:YCe,e:function(e,t){return e.toExponential(t)},f:function(e,t){return e.toFixed(t)},g:function(e,t){return e.toPrecision(t)},o:function(e){return Math.round(e).toString(8)},p:function(e,t){return V7(e*100,t)},r:V7,s:e_e,X:function(e){return Math.round(e).toString(16).toUpperCase()},x:function(e){return Math.round(e).toString(16)}};function G7(e){return e}var q7=Array.prototype.map,$7=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"];function t_e(e){var t=e.grouping===void 0||e.thousands===void 0?G7:KCe(q7.call(e.grouping,Number),e.thousands+""),r=e.currency===void 0?"":e.currency[0]+"",n=e.currency===void 0?"":e.currency[1]+"",i=e.decimal===void 0?".":e.decimal+"",a=e.numerals===void 0?G7:QCe(q7.call(e.numerals,String)),o=e.percent===void 0?"%":e.percent+"",s=e.minus===void 0?"-":e.minus+"",u=e.nan===void 0?"NaN":e.nan+"";function l(d){d=L_(d);var f=d.fill,h=d.align,v=d.sign,p=d.symbol,m=d.zero,g=d.width,y=d.comma,b=d.precision,S=d.trim,x=d.type;x==="n"?(y=!0,x="g"):H7[x]||(b===void 0&&(b=12),S=!0,x="g"),(m||f==="0"&&h==="=")&&(m=!0,f="0",h="=");var C=p==="$"?r:p==="#"&&/[boxX]/.test(x)?"0"+x.toLowerCase():"",w=p==="$"?n:/[%p]/.test(x)?o:"",A=H7[x],M=/[defgprs%]/.test(x);b=b===void 0?6:/[gprs]/.test(x)?Math.max(1,Math.min(21,b)):Math.max(0,Math.min(20,b));function D(k){var R=C,O=w,H,B,j;if(x==="c")O=A(k)+O,k="";else{k=+k;var Y=k<0||1/k<0;if(k=isNaN(k)?u:A(Math.abs(k),b),S&&(k=JCe(k)),Y&&+k==0&&v!=="+"&&(Y=!1),R=(Y?v==="("?v:s:v==="-"||v==="("?"":v)+R,O=(x==="s"?$7[8+fQ/3]:"")+O+(Y&&v==="("?")":""),M){for(H=-1,B=k.length;++H<B;)if(j=k.charCodeAt(H),48>j||j>57){O=(j===46?i+k.slice(H+1):k.slice(H))+O,k=k.slice(0,H);break}}}y&&!m&&(k=t(k,1/0));var G=R.length+k.length+O.length,$=G<g?new Array(g-G+1).join(f):"";switch(y&&m&&(k=t($+k,$.length?g-O.length:1/0),$=""),h){case"<":k=R+k+O+$;break;case"=":k=R+$+k+O;break;case"^":k=$.slice(0,G=$.length>>1)+R+k+O+$.slice(G);break;default:k=$+R+k+O;break}return a(k)}return D.toString=function(){return d+""},D}function c(d,f){var h=l((d=L_(d),d.type="f",d)),v=Math.max(-8,Math.min(8,Math.floor(o0(f)/3)))*3,p=Math.pow(10,-v),m=$7[8+v/3];return function(g){return h(p*g)+m}}return{format:l,formatPrefix:c}}var Tx,N_,hQ;r_e({decimal:".",thousands:",",grouping:[3],currency:["$",""],minus:"-"});function r_e(e){return Tx=t_e(e),N_=Tx.format,hQ=Tx.formatPrefix,Tx}function n_e(e){return Math.max(0,-o0(Math.abs(e)))}function i_e(e,t){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(o0(t)/3)))*3-o0(Math.abs(e)))}function a_e(e,t){return e=Math.abs(e),t=Math.abs(t)-e,Math.max(0,o0(t)-o0(e))+1}function O0(){return Math.random()}(function e(t){function r(n,i){return n=n==null?0:+n,i=i==null?1:+i,arguments.length===1?(i=n,n=0):i-=n,function(){return t()*i+n}}return r.source=e,r})(O0);const o_e=function e(t){function r(n,i){var a,o;return n=n==null?0:+n,i=i==null?1:+i,function(){var s;if(a!=null)s=a,a=null;else do a=t()*2-1,s=t()*2-1,o=a*a+s*s;while(!o||o>1);return n+i*s*Math.sqrt(-2*Math.log(o)/o)}}return r.source=e,r}(O0);(function e(t){function r(){var n=o_e.source(t).apply(this,arguments);return function(){return Math.exp(n())}}return r.source=e,r})(O0);const s_e=function e(t){function r(n){return function(){for(var i=0,a=0;a<n;++a)i+=t();return i}}return r.source=e,r}(O0);(function e(t){function r(n){var i=s_e.source(t)(n);return function(){return i()/n}}return r.source=e,r})(O0);(function e(t){function r(n){return function(){return-Math.log(1-t())/n}}return r.source=e,r})(O0);function xE(e,t){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(t).domain(e);break}return this}var pQ=Array.prototype,u_e=pQ.map,L5=pQ.slice,W7={name:"implicit"};function vQ(){var e=O_(),t=[],r=[],n=W7;function i(a){var o=a+"",s=e.get(o);if(!s){if(n!==W7)return n;e.set(o,s=t.push(a))}return r[(s-1)%r.length]}return i.domain=function(a){if(!arguments.length)return t.slice();t=[],e=O_();for(var o=-1,s=a.length,u,l;++o<s;)e.has(l=(u=a[o])+"")||e.set(l,t.push(u));return i},i.range=function(a){return arguments.length?(r=L5.call(a),i):r.slice()},i.unknown=function(a){return arguments.length?(n=a,i):n},i.copy=function(){return vQ(t,r).unknown(n)},xE.apply(i,arguments),i}function mQ(){var e=vQ().unknown(void 0),t=e.domain,r=e.range,n=[0,1],i,a,o=!1,s=0,u=0,l=.5;delete e.unknown;function c(){var d=t().length,f=n[1]<n[0],h=n[f-0],v=n[1-f];i=(v-h)/Math.max(1,d-s+u*2),o&&(i=Math.floor(i)),h+=(v-h-i*(d-s))*l,a=i*(1-s),o&&(h=Math.round(h),a=Math.round(a));var p=C2e(d).map(function(m){return h+i*m});return r(f?p.reverse():p)}return e.domain=function(d){return arguments.length?(t(d),c()):t()},e.range=function(d){return arguments.length?(n=[+d[0],+d[1]],c()):n.slice()},e.rangeRound=function(d){return n=[+d[0],+d[1]],o=!0,c()},e.bandwidth=function(){return a},e.step=function(){return i},e.round=function(d){return arguments.length?(o=!!d,c()):o},e.padding=function(d){return arguments.length?(s=Math.min(1,u=+d),c()):s},e.paddingInner=function(d){return arguments.length?(s=Math.min(1,d),c()):s},e.paddingOuter=function(d){return arguments.length?(u=+d,c()):u},e.align=function(d){return arguments.length?(l=Math.max(0,Math.min(1,d)),c()):l},e.copy=function(){return mQ(t(),n).round(o).paddingInner(s).paddingOuter(u).align(l)},xE.apply(c(),arguments)}function gQ(e){var t=e.copy;return e.padding=e.paddingOuter,delete e.paddingInner,delete e.paddingOuter,e.copy=function(){return gQ(t())},e}function l_e(){return gQ(mQ.apply(null,arguments).paddingInner(1))}function c_e(e){return function(){return e}}function d_e(e){return+e}var X7=[0,1];function Ll(e){return e}function N5(e,t){return(t-=e=+e)?function(r){return(r-e)/t}:c_e(isNaN(t)?NaN:.5)}function Y7(e){var t=e[0],r=e[e.length-1],n;return t>r&&(n=t,t=r,r=n),function(i){return Math.max(t,Math.min(r,i))}}function f_e(e,t,r){var n=e[0],i=e[1],a=t[0],o=t[1];return i<n?(n=N5(i,n),a=r(o,a)):(n=N5(n,i),a=r(a,o)),function(s){return a(n(s))}}function h_e(e,t,r){var n=Math.min(e.length,t.length)-1,i=new Array(n),a=new Array(n),o=-1;for(e[n]<e[0]&&(e=e.slice().reverse(),t=t.slice().reverse());++o<n;)i[o]=N5(e[o],e[o+1]),a[o]=r(t[o],t[o+1]);return function(s){var u=S2e(e,s,1,n)-1;return a[u](i[u](s))}}function yQ(e,t){return t.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function bQ(){var e=X7,t=X7,r=mE,n,i,a,o=Ll,s,u,l;function c(){return s=Math.min(e.length,t.length)>2?h_e:f_e,u=l=null,d}function d(f){return isNaN(f=+f)?a:(u||(u=s(e.map(n),t,r)))(n(o(f)))}return d.invert=function(f){return o(i((l||(l=s(t,e.map(n),Cu)))(f)))},d.domain=function(f){return arguments.length?(e=u_e.call(f,d_e),o===Ll||(o=Y7(e)),c()):e.slice()},d.range=function(f){return arguments.length?(t=L5.call(f),c()):t.slice()},d.rangeRound=function(f){return t=L5.call(f),r=SSe,c()},d.clamp=function(f){return arguments.length?(o=f?Y7(e):Ll,d):o!==Ll},d.interpolate=function(f){return arguments.length?(r=f,c()):r},d.unknown=function(f){return arguments.length?(a=f,d):a},function(f,h){return n=f,i=h,c()}}function p_e(e,t){return bQ()(e,t)}function v_e(e,t,r,n){var i=w2e(e,t,r),a;switch(n=L_(n??",f"),n.type){case"s":{var o=Math.max(Math.abs(e),Math.abs(t));return n.precision==null&&!isNaN(a=i_e(i,o))&&(n.precision=a),hQ(n,o)}case"":case"e":case"g":case"p":case"r":{n.precision==null&&!isNaN(a=a_e(i,Math.max(Math.abs(e),Math.abs(t))))&&(n.precision=a-(n.type==="e"));break}case"f":case"%":{n.precision==null&&!isNaN(a=n_e(i))&&(n.precision=a-(n.type==="%")*2);break}}return N_(n)}function xQ(e){var t=e.domain;return e.ticks=function(r){var n=t();return _2e(n[0],n[n.length-1],r??10)},e.tickFormat=function(r,n){var i=t();return v_e(i[0],i[i.length-1],r??10,n)},e.nice=function(r){r==null&&(r=10);var n=t(),i=0,a=n.length-1,o=n[i],s=n[a],u;return s<o&&(u=o,o=s,s=u,u=i,i=a,a=u),u=lC(o,s,r),u>0?(o=Math.floor(o/u)*u,s=Math.ceil(s/u)*u,u=lC(o,s,r)):u<0&&(o=Math.ceil(o*u)/u,s=Math.floor(s*u)/u,u=lC(o,s,r)),u>0?(n[i]=Math.floor(o/u)*u,n[a]=Math.ceil(s/u)*u,t(n)):u<0&&(n[i]=Math.ceil(o*u)/u,n[a]=Math.floor(s*u)/u,t(n)),e},e}function F0(){var e=p_e(Ll,Ll);return e.copy=function(){return yQ(e,F0())},xE.apply(e,arguments),xQ(e)}function K7(e){return function(t){return t<0?-Math.pow(-t,e):Math.pow(t,e)}}function m_e(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function g_e(e){return e<0?-e*e:e*e}function y_e(e){var t=e(Ll,Ll),r=1;function n(){return r===1?e(Ll,Ll):r===.5?e(m_e,g_e):e(K7(r),K7(1/r))}return t.exponent=function(i){return arguments.length?(r=+i,n()):r},xQ(t)}function SQ(){var e=y_e(bQ());return e.copy=function(){return yQ(e,SQ()).exponent(e.exponent())},xE.apply(e,arguments),e}function Ix(e){return function(){return e}}function CQ(e){this._context=e}CQ.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:this._context.lineTo(e,t);break}}};function b_e(e){return new CQ(e)}function x_e(e){return e[0]}function S_e(e){return e[1]}function C_e(){var e=x_e,t=S_e,r=Ix(!0),n=null,i=b_e,a=null;function o(s){var u,l=s.length,c,d=!1,f;for(n==null&&(a=i(f=dQ())),u=0;u<=l;++u)!(u<l&&r(c=s[u],u,s))===d&&((d=!d)?a.lineStart():a.lineEnd()),d&&a.point(+e(c,u,s),+t(c,u,s));if(f)return a=null,f+""||null}return o.x=function(s){return arguments.length?(e=typeof s=="function"?s:Ix(+s),o):e},o.y=function(s){return arguments.length?(t=typeof s=="function"?s:Ix(+s),o):t},o.defined=function(s){return arguments.length?(r=typeof s=="function"?s:Ix(!!s),o):r},o.curve=function(s){return arguments.length?(i=s,n!=null&&(a=i(n)),o):i},o.context=function(s){return arguments.length?(s==null?n=a=null:a=i(n=s),o):n},o}function B_(){this._=null}function SE(e){e.U=e.C=e.L=e.R=e.P=e.N=null}B_.prototype={constructor:B_,insert:function(e,t){var r,n,i;if(e){if(t.P=e,t.N=e.N,e.N&&(e.N.P=t),e.N=t,e.R){for(e=e.R;e.L;)e=e.L;e.L=t}else e.R=t;r=e}else this._?(e=Q7(this._),t.P=null,t.N=e,e.P=e.L=t,r=e):(t.P=t.N=null,this._=t,r=null);for(t.L=t.R=null,t.U=r,t.C=!0,e=t;r&&r.C;)n=r.U,r===n.L?(i=n.R,i&&i.C?(r.C=i.C=!1,n.C=!0,e=n):(e===r.R&&(Sy(this,r),e=r,r=e.U),r.C=!1,n.C=!0,Cy(this,n))):(i=n.L,i&&i.C?(r.C=i.C=!1,n.C=!0,e=n):(e===r.L&&(Cy(this,r),e=r,r=e.U),r.C=!1,n.C=!0,Sy(this,n))),r=e.U;this._.C=!1},remove:function(e){e.N&&(e.N.P=e.P),e.P&&(e.P.N=e.N),e.N=e.P=null;var t=e.U,r,n=e.L,i=e.R,a,o;if(n?i?a=Q7(i):a=n:a=i,t?t.L===e?t.L=a:t.R=a:this._=a,n&&i?(o=a.C,a.C=e.C,a.L=n,n.U=a,a!==i?(t=a.U,a.U=e.U,e=a.R,t.L=e,a.R=i,i.U=a):(a.U=t,t=a,e=a.R)):(o=e.C,e=a),e&&(e.U=t),!o){if(e&&e.C){e.C=!1;return}do{if(e===this._)break;if(e===t.L){if(r=t.R,r.C&&(r.C=!1,t.C=!0,Sy(this,t),r=t.R),r.L&&r.L.C||r.R&&r.R.C){(!r.R||!r.R.C)&&(r.L.C=!1,r.C=!0,Cy(this,r),r=t.R),r.C=t.C,t.C=r.R.C=!1,Sy(this,t),e=this._;break}}else if(r=t.L,r.C&&(r.C=!1,t.C=!0,Cy(this,t),r=t.L),r.L&&r.L.C||r.R&&r.R.C){(!r.L||!r.L.C)&&(r.R.C=!1,r.C=!0,Sy(this,r),r=t.L),r.C=t.C,t.C=r.L.C=!1,Cy(this,t),e=this._;break}r.C=!0,e=t,t=t.U}while(!e.C);e&&(e.C=!1)}}};function Sy(e,t){var r=t,n=t.R,i=r.U;i?i.L===r?i.L=n:i.R=n:e._=n,n.U=i,r.U=n,r.R=n.L,r.R&&(r.R.U=r),n.L=r}function Cy(e,t){var r=t,n=t.L,i=r.U;i?i.L===r?i.L=n:i.R=n:e._=n,n.U=i,r.U=n,r.L=n.R,r.L&&(r.L.U=r),n.R=r}function Q7(e){for(;e.L;)e=e.L;return e}function c1(e,t,r,n){var i=[null,null],a=Fa.push(i)-1;return i.left=e,i.right=t,r&&U_(i,e,t,r),n&&U_(i,t,e,n),Ko[e.index].halfedges.push(a),Ko[t.index].halfedges.push(a),i}function _y(e,t,r){var n=[t,r];return n.left=e,n}function U_(e,t,r,n){!e[0]&&!e[1]?(e[0]=n,e.left=t,e.right=r):e.left===r?e[1]=n:e[0]=n}function __e(e,t,r,n,i){var a=e[0],o=e[1],s=a[0],u=a[1],l=o[0],c=o[1],d=0,f=1,h=l-s,v=c-u,p;if(p=t-s,!(!h&&p>0)){if(p/=h,h<0){if(p<d)return;p<f&&(f=p)}else if(h>0){if(p>f)return;p>d&&(d=p)}if(p=n-s,!(!h&&p<0)){if(p/=h,h<0){if(p>f)return;p>d&&(d=p)}else if(h>0){if(p<d)return;p<f&&(f=p)}if(p=r-u,!(!v&&p>0)){if(p/=v,v<0){if(p<d)return;p<f&&(f=p)}else if(v>0){if(p>f)return;p>d&&(d=p)}if(p=i-u,!(!v&&p<0)){if(p/=v,v<0){if(p>f)return;p>d&&(d=p)}else if(v>0){if(p<d)return;p<f&&(f=p)}return!(d>0)&&!(f<1)||(d>0&&(e[0]=[s+d*h,u+d*v]),f<1&&(e[1]=[s+f*h,u+f*v])),!0}}}}}function w_e(e,t,r,n,i){var a=e[1];if(a)return!0;var o=e[0],s=e.left,u=e.right,l=s[0],c=s[1],d=u[0],f=u[1],h=(l+d)/2,v=(c+f)/2,p,m;if(f===c){if(h<t||h>=n)return;if(l>d){if(!o)o=[h,r];else if(o[1]>=i)return;a=[h,i]}else{if(!o)o=[h,i];else if(o[1]<r)return;a=[h,r]}}else if(p=(l-d)/(f-c),m=v-p*h,p<-1||p>1)if(l>d){if(!o)o=[(r-m)/p,r];else if(o[1]>=i)return;a=[(i-m)/p,i]}else{if(!o)o=[(i-m)/p,i];else if(o[1]<r)return;a=[(r-m)/p,r]}else if(c<f){if(!o)o=[t,p*t+m];else if(o[0]>=n)return;a=[n,p*n+m]}else{if(!o)o=[n,p*n+m];else if(o[0]<t)return;a=[t,p*t+m]}return e[0]=o,e[1]=a,!0}function E_e(e,t,r,n){for(var i=Fa.length,a;i--;)(!w_e(a=Fa[i],e,t,r,n)||!__e(a,e,t,r,n)||!(Math.abs(a[0][0]-a[1][0])>ni||Math.abs(a[0][1]-a[1][1])>ni))&&delete Fa[i]}function A_e(e){return Ko[e.index]={site:e,halfedges:[]}}function P_e(e,t){var r=e.site,n=t.left,i=t.right;return r===i&&(i=n,n=r),i?Math.atan2(i[1]-n[1],i[0]-n[0]):(r===n?(n=t[1],i=t[0]):(n=t[0],i=t[1]),Math.atan2(n[0]-i[0],i[1]-n[1]))}function _Q(e,t){return t[+(t.left!==e.site)]}function T_e(e,t){return t[+(t.left===e.site)]}function I_e(){for(var e=0,t=Ko.length,r,n,i,a;e<t;++e)if((r=Ko[e])&&(a=(n=r.halfedges).length)){var o=new Array(a),s=new Array(a);for(i=0;i<a;++i)o[i]=i,s[i]=P_e(r,Fa[n[i]]);for(o.sort(function(u,l){return s[l]-s[u]}),i=0;i<a;++i)s[i]=n[o[i]];for(i=0;i<a;++i)n[i]=s[i]}}function M_e(e,t,r,n){var i=Ko.length,a,o,s,u,l,c,d,f,h,v,p,m,g=!0;for(a=0;a<i;++a)if(o=Ko[a]){for(s=o.site,l=o.halfedges,u=l.length;u--;)Fa[l[u]]||l.splice(u,1);for(u=0,c=l.length;u<c;)v=T_e(o,Fa[l[u]]),p=v[0],m=v[1],d=_Q(o,Fa[l[++u%c]]),f=d[0],h=d[1],(Math.abs(p-f)>ni||Math.abs(m-h)>ni)&&(l.splice(u,0,Fa.push(_y(s,v,Math.abs(p-e)<ni&&n-m>ni?[e,Math.abs(f-e)<ni?h:n]:Math.abs(m-n)<ni&&r-p>ni?[Math.abs(h-n)<ni?f:r,n]:Math.abs(p-r)<ni&&m-t>ni?[r,Math.abs(f-r)<ni?h:t]:Math.abs(m-t)<ni&&p-e>ni?[Math.abs(h-t)<ni?f:e,t]:null))-1),++c);c&&(g=!1)}if(g){var y,b,S,x=1/0;for(a=0,g=null;a<i;++a)(o=Ko[a])&&(s=o.site,y=s[0]-e,b=s[1]-t,S=y*y+b*b,S<x&&(x=S,g=o));if(g){var C=[e,t],w=[e,n],A=[r,n],M=[r,t];g.halfedges.push(Fa.push(_y(s=g.site,C,w))-1,Fa.push(_y(s,w,A))-1,Fa.push(_y(s,A,M))-1,Fa.push(_y(s,M,C))-1)}}for(a=0;a<i;++a)(o=Ko[a])&&(o.halfedges.length||delete Ko[a])}var wQ=[],u6;function D_e(){SE(this),this.x=this.y=this.arc=this.site=this.cy=null}function fg(e){var t=e.P,r=e.N;if(!(!t||!r)){var n=t.site,i=e.site,a=r.site;if(n!==a){var o=i[0],s=i[1],u=n[0]-o,l=n[1]-s,c=a[0]-o,d=a[1]-s,f=2*(u*d-l*c);if(!(f>=-L_e)){var h=u*u+l*l,v=c*c+d*d,p=(d*h-l*v)/f,m=(u*v-c*h)/f,g=wQ.pop()||new D_e;g.arc=e,g.site=i,g.x=p+o,g.y=(g.cy=m+s)+Math.sqrt(p*p+m*m),e.circle=g;for(var y=null,b=kb._;b;)if(g.y<b.y||g.y===b.y&&g.x<=b.x)if(b.L)b=b.L;else{y=b.P;break}else if(b.R)b=b.R;else{y=b;break}kb.insert(y,g),y||(u6=g)}}}}function Fg(e){var t=e.circle;t&&(t.P||(u6=t.N),kb.remove(t),wQ.push(t),SE(t),e.circle=null)}var EQ=[];function R_e(){SE(this),this.edge=this.site=this.circle=null}function Z7(e){var t=EQ.pop()||new R_e;return t.site=e,t}function bP(e){Fg(e),Lg.remove(e),EQ.push(e),SE(e)}function k_e(e){var t=e.circle,r=t.x,n=t.cy,i=[r,n],a=e.P,o=e.N,s=[e];bP(e);for(var u=a;u.circle&&Math.abs(r-u.circle.x)<ni&&Math.abs(n-u.circle.cy)<ni;)a=u.P,s.unshift(u),bP(u),u=a;s.unshift(u),Fg(u);for(var l=o;l.circle&&Math.abs(r-l.circle.x)<ni&&Math.abs(n-l.circle.cy)<ni;)o=l.N,s.push(l),bP(l),l=o;s.push(l),Fg(l);var c=s.length,d;for(d=1;d<c;++d)l=s[d],u=s[d-1],U_(l.edge,u.site,l.site,i);u=s[0],l=s[c-1],l.edge=c1(u.site,l.site,null,i),fg(u),fg(l)}function O_e(e){for(var t=e[0],r=e[1],n,i,a,o,s=Lg._;s;)if(a=AQ(s,r)-t,a>ni)s=s.L;else if(o=t-F_e(s,r),o>ni){if(!s.R){n=s;break}s=s.R}else{a>-ni?(n=s.P,i=s):o>-ni?(n=s,i=s.N):n=i=s;break}A_e(e);var u=Z7(e);if(Lg.insert(n,u),!(!n&&!i)){if(n===i){Fg(n),i=Z7(n.site),Lg.insert(u,i),u.edge=i.edge=c1(n.site,u.site),fg(n),fg(i);return}if(!i){u.edge=c1(n.site,u.site);return}Fg(n),Fg(i);var l=n.site,c=l[0],d=l[1],f=e[0]-c,h=e[1]-d,v=i.site,p=v[0]-c,m=v[1]-d,g=2*(f*m-h*p),y=f*f+h*h,b=p*p+m*m,S=[(m*y-h*b)/g+c,(f*b-p*y)/g+d];U_(i.edge,l,v,S),u.edge=c1(l,e,null,S),i.edge=c1(e,v,null,S),fg(n),fg(i)}}function AQ(e,t){var r=e.site,n=r[0],i=r[1],a=i-t;if(!a)return n;var o=e.P;if(!o)return-1/0;r=o.site;var s=r[0],u=r[1],l=u-t;if(!l)return s;var c=s-n,d=1/a-1/l,f=c/l;return d?(-f+Math.sqrt(f*f-2*d*(c*c/(-2*l)-u+l/2+i-a/2)))/d+n:(n+s)/2}function F_e(e,t){var r=e.N;if(r)return AQ(r,t);var n=e.site;return n[1]===t?n[0]:1/0}var ni=1e-6,L_e=1e-12,Lg,Ko,kb,Fa;function N_e(e,t,r){return(e[0]-r[0])*(t[1]-e[1])-(e[0]-t[0])*(r[1]-e[1])}function B_e(e,t){return t[1]-e[1]||t[0]-e[0]}function J7(e,t){var r=e.sort(B_e).pop(),n,i,a;for(Fa=[],Ko=new Array(e.length),Lg=new B_,kb=new B_;;)if(a=u6,r&&(!a||r[1]<a.y||r[1]===a.y&&r[0]<a.x))(r[0]!==n||r[1]!==i)&&(O_e(r),n=r[0],i=r[1]),r=e.pop();else if(a)k_e(a.arc);else break;if(I_e(),t){var o=+t[0][0],s=+t[0][1],u=+t[1][0],l=+t[1][1];E_e(o,s,u,l),M_e(o,s,u,l)}this.edges=Fa,this.cells=Ko,Lg=kb=Fa=Ko=null}J7.prototype={constructor:J7,polygons:function(){var e=this.edges;return this.cells.map(function(t){var r=t.halfedges.map(function(n){return _Q(t,e[n])});return r.data=t.site.data,r})},triangles:function(){var e=[],t=this.edges;return this.cells.forEach(function(r,n){if(s=(a=r.halfedges).length)for(var i=r.site,a,o=-1,s,u,l=t[a[s-1]],c=l.left===i?l.right:l.left;++o<s;)u=c,l=t[a[o]],c=l.left===i?l.right:l.left,u&&c&&n<u.index&&n<c.index&&N_e(i,u,c)<0&&e.push([i.data,u.data,c.data])}),e},links:function(){return this.edges.filter(function(e){return e.right}).map(function(e){return{source:e.left.data,target:e.right.data}})},find:function(e,t,r){for(var n=this,i,a=n._found||0,o=n.cells.length,s;!(s=n.cells[a]);)if(++a>=o)return null;var u=e-s.site[0],l=t-s.site[1],c=u*u+l*l;do s=n.cells[i=a],a=null,s.halfedges.forEach(function(d){var f=n.edges[d],h=f.left;if(!((h===s.site||!h)&&!(h=f.right))){var v=e-h[0],p=t-h[1],m=v*v+p*p;m<c&&(c=m,a=h.index)}});while(a!==null);return n._found=i,r==null||c<=r*r?s.site:null}};function Mx(e){return function(){return e}}function U_e(e,t,r){this.target=e,this.type=t,this.transform=r}function Uc(e,t,r){this.k=e,this.x=t,this.y=r}Uc.prototype={constructor:Uc,scale:function(e){return e===1?this:new Uc(this.k*e,this.x,this.y)},translate:function(e,t){return e===0&t===0?this:new Uc(this.k,this.x+this.k*e,this.y+this.k*t)},apply:function(e){return[e[0]*this.k+this.x,e[1]*this.k+this.y]},applyX:function(e){return e*this.k+this.x},applyY:function(e){return e*this.k+this.y},invert:function(e){return[(e[0]-this.x)/this.k,(e[1]-this.y)/this.k]},invertX:function(e){return(e-this.x)/this.k},invertY:function(e){return(e-this.y)/this.k},rescaleX:function(e){return e.copy().domain(e.range().map(this.invertX,this).map(e.invert,e))},rescaleY:function(e){return e.copy().domain(e.range().map(this.invertY,this).map(e.invert,e))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var l6=new Uc(1,0,0);Uc.prototype;function xP(){Wt.stopImmediatePropagation()}function wy(){Wt.preventDefault(),Wt.stopImmediatePropagation()}function j_e(){return!Wt.ctrlKey&&!Wt.button}function z_e(){var e=this;return e instanceof SVGElement?(e=e.ownerSVGElement||e,e.hasAttribute("viewBox")?(e=e.viewBox.baseVal,[[e.x,e.y],[e.x+e.width,e.y+e.height]]):[[0,0],[e.width.baseVal.value,e.height.baseVal.value]]):[[0,0],[e.clientWidth,e.clientHeight]]}function e9(){return this.__zoom||l6}function V_e(){return-Wt.deltaY*(Wt.deltaMode===1?.05:Wt.deltaMode?1:.002)}function H_e(){return navigator.maxTouchPoints||"ontouchstart"in this}function G_e(e,t,r){var n=e.invertX(t[0][0])-r[0][0],i=e.invertX(t[1][0])-r[1][0],a=e.invertY(t[0][1])-r[0][1],o=e.invertY(t[1][1])-r[1][1];return e.translate(i>n?(n+i)/2:Math.min(0,n)||Math.max(0,i),o>a?(a+o)/2:Math.min(0,a)||Math.max(0,o))}function q_e(){var e=j_e,t=z_e,r=G_e,n=V_e,i=H_e,a=[0,1/0],o=[[-1/0,-1/0],[1/0,1/0]],s=250,u=ISe,l=pE("start","zoom","end"),c,d,f=500,h=150,v=0;function p(R){R.property("__zoom",e9).on("wheel.zoom",C).on("mousedown.zoom",w).on("dblclick.zoom",A).filter(i).on("touchstart.zoom",M).on("touchmove.zoom",D).on("touchend.zoom touchcancel.zoom",k).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}p.transform=function(R,O,H){var B=R.selection?R.selection():R;B.property("__zoom",e9),R!==B?b(R,O,H):B.interrupt().each(function(){S(this,arguments).start().zoom(null,typeof O=="function"?O.apply(this,arguments):O).end()})},p.scaleBy=function(R,O,H){p.scaleTo(R,function(){var B=this.__zoom.k,j=typeof O=="function"?O.apply(this,arguments):O;return B*j},H)},p.scaleTo=function(R,O,H){p.transform(R,function(){var B=t.apply(this,arguments),j=this.__zoom,Y=H==null?y(B):typeof H=="function"?H.apply(this,arguments):H,G=j.invert(Y),$=typeof O=="function"?O.apply(this,arguments):O;return r(g(m(j,$),Y,G),B,o)},H)},p.translateBy=function(R,O,H){p.transform(R,function(){return r(this.__zoom.translate(typeof O=="function"?O.apply(this,arguments):O,typeof H=="function"?H.apply(this,arguments):H),t.apply(this,arguments),o)})},p.translateTo=function(R,O,H,B){p.transform(R,function(){var j=t.apply(this,arguments),Y=this.__zoom,G=B==null?y(j):typeof B=="function"?B.apply(this,arguments):B;return r(l6.translate(G[0],G[1]).scale(Y.k).translate(typeof O=="function"?-O.apply(this,arguments):-O,typeof H=="function"?-H.apply(this,arguments):-H),j,o)},B)};function m(R,O){return O=Math.max(a[0],Math.min(a[1],O)),O===R.k?R:new Uc(O,R.x,R.y)}function g(R,O,H){var B=O[0]-H[0]*R.k,j=O[1]-H[1]*R.k;return B===R.x&&j===R.y?R:new Uc(R.k,B,j)}function y(R){return[(+R[0][0]+ +R[1][0])/2,(+R[0][1]+ +R[1][1])/2]}function b(R,O,H){R.on("start.zoom",function(){S(this,arguments).start()}).on("interrupt.zoom end.zoom",function(){S(this,arguments).end()}).tween("zoom",function(){var B=this,j=arguments,Y=S(B,j),G=t.apply(B,j),$=H==null?y(G):typeof H=="function"?H.apply(B,j):H,q=Math.max(G[1][0]-G[0][0],G[1][1]-G[0][1]),ee=B.__zoom,fe=typeof O=="function"?O.apply(B,j):O,W=u(ee.invert($).concat(q/ee.k),fe.invert($).concat(q/fe.k));return function(X){if(X===1)X=fe;else{var U=W(X),z=q/U[2];X=new Uc(z,$[0]-U[0]*z,$[1]-U[1]*z)}Y.zoom(null,X)}})}function S(R,O,H){return!H&&R.__zooming||new x(R,O)}function x(R,O){this.that=R,this.args=O,this.active=0,this.extent=t.apply(R,O),this.taps=0}x.prototype={start:function(){return++this.active===1&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(R,O){return this.mouse&&R!=="mouse"&&(this.mouse[1]=O.invert(this.mouse[0])),this.touch0&&R!=="touch"&&(this.touch0[1]=O.invert(this.touch0[0])),this.touch1&&R!=="touch"&&(this.touch1[1]=O.invert(this.touch1[0])),this.that.__zoom=O,this.emit("zoom"),this},end:function(){return--this.active===0&&(delete this.that.__zooming,this.emit("end")),this},emit:function(R){qK(new U_e(p,R,this.that.__zoom),l.apply,l,[R,this.that,this.args])}};function C(){if(!e.apply(this,arguments))return;var R=S(this,arguments),O=this.__zoom,H=Math.max(a[0],Math.min(a[1],O.k*Math.pow(2,n.apply(this,arguments)))),B=s1(this);if(R.wheel)(R.mouse[0][0]!==B[0]||R.mouse[0][1]!==B[1])&&(R.mouse[1]=O.invert(R.mouse[0]=B)),clearTimeout(R.wheel);else{if(O.k===H)return;R.mouse=[B,O.invert(B)],Og(this),R.start()}wy(),R.wheel=setTimeout(j,h),R.zoom("mouse",r(g(m(O,H),R.mouse[0],R.mouse[1]),R.extent,o));function j(){R.wheel=null,R.end()}}function w(){if(d||!e.apply(this,arguments))return;var R=S(this,arguments,!0),O=Ui(Wt.view).on("mousemove.zoom",Y,!0).on("mouseup.zoom",G,!0),H=s1(this),B=Wt.clientX,j=Wt.clientY;KK(Wt.view),xP(),R.mouse=[H,this.__zoom.invert(H)],Og(this),R.start();function Y(){if(wy(),!R.moved){var $=Wt.clientX-B,q=Wt.clientY-j;R.moved=$*$+q*q>v}R.zoom("mouse",r(g(R.that.__zoom,R.mouse[0]=s1(R.that),R.mouse[1]),R.extent,o))}function G(){O.on("mousemove.zoom mouseup.zoom",null),QK(Wt.view,R.moved),wy(),R.end()}}function A(){if(e.apply(this,arguments)){var R=this.__zoom,O=s1(this),H=R.invert(O),B=R.k*(Wt.shiftKey?.5:2),j=r(g(m(R,B),O,H),t.apply(this,arguments),o);wy(),s>0?Ui(this).transition().duration(s).call(b,j,O):Ui(this).call(p.transform,j)}}function M(){if(e.apply(this,arguments)){var R=Wt.touches,O=R.length,H=S(this,arguments,Wt.changedTouches.length===O),B,j,Y,G;for(xP(),j=0;j<O;++j)Y=R[j],G=w5(this,R,Y.identifier),G=[G,this.__zoom.invert(G),Y.identifier],H.touch0?!H.touch1&&H.touch0[2]!==G[2]&&(H.touch1=G,H.taps=0):(H.touch0=G,B=!0,H.taps=1+!!c);c&&(c=clearTimeout(c)),B&&(H.taps<2&&(c=setTimeout(function(){c=null},f)),Og(this),H.start())}}function D(){if(this.__zooming){var R=S(this,arguments),O=Wt.changedTouches,H=O.length,B,j,Y,G;for(wy(),c&&(c=clearTimeout(c)),R.taps=0,B=0;B<H;++B)j=O[B],Y=w5(this,O,j.identifier),R.touch0&&R.touch0[2]===j.identifier?R.touch0[0]=Y:R.touch1&&R.touch1[2]===j.identifier&&(R.touch1[0]=Y);if(j=R.that.__zoom,R.touch1){var $=R.touch0[0],q=R.touch0[1],ee=R.touch1[0],fe=R.touch1[1],W=(W=ee[0]-$[0])*W+(W=ee[1]-$[1])*W,X=(X=fe[0]-q[0])*X+(X=fe[1]-q[1])*X;j=m(j,Math.sqrt(W/X)),Y=[($[0]+ee[0])/2,($[1]+ee[1])/2],G=[(q[0]+fe[0])/2,(q[1]+fe[1])/2]}else if(R.touch0)Y=R.touch0[0],G=R.touch0[1];else return;R.zoom("touch",r(g(j,Y,G),R.extent,o))}}function k(){if(this.__zooming){var R=S(this,arguments),O=Wt.changedTouches,H=O.length,B,j;for(xP(),d&&clearTimeout(d),d=setTimeout(function(){d=null},f),B=0;B<H;++B)j=O[B],R.touch0&&R.touch0[2]===j.identifier?delete R.touch0:R.touch1&&R.touch1[2]===j.identifier&&delete R.touch1;if(R.touch1&&!R.touch0&&(R.touch0=R.touch1,delete R.touch1),R.touch0)R.touch0[1]=this.__zoom.invert(R.touch0[0]);else if(R.end(),R.taps===2){var Y=Ui(this).on("dblclick.zoom");Y&&Y.apply(this,arguments)}}}return p.wheelDelta=function(R){return arguments.length?(n=typeof R=="function"?R:Mx(+R),p):n},p.filter=function(R){return arguments.length?(e=typeof R=="function"?R:Mx(!!R),p):e},p.touchable=function(R){return arguments.length?(i=typeof R=="function"?R:Mx(!!R),p):i},p.extent=function(R){return arguments.length?(t=typeof R=="function"?R:Mx([[+R[0][0],+R[0][1]],[+R[1][0],+R[1][1]]]),p):t},p.scaleExtent=function(R){return arguments.length?(a[0]=+R[0],a[1]=+R[1],p):[a[0],a[1]]},p.translateExtent=function(R){return arguments.length?(o[0][0]=+R[0][0],o[1][0]=+R[1][0],o[0][1]=+R[0][1],o[1][1]=+R[1][1],p):[[o[0][0],o[0][1]],[o[1][0],o[1][1]]]},p.constrain=function(R){return arguments.length?(r=R,p):r},p.duration=function(R){return arguments.length?(s=+R,p):s},p.interpolate=function(R){return arguments.length?(u=R,p):u},p.on=function(){var R=l.on.apply(l,arguments);return R===l?p:R},p.clickDistance=function(R){return arguments.length?(v=(R=+R)*R,p):Math.sqrt(v)},p}class $_e{constructor({min:t=-1/0,max:r=1/0}={}){this.segments=[],this.max=r,this.min=t,this.regionString=null}encode(t=!1){return this.segments.map(({start:r,end:n,color:i})=>{if(t)return`${r}:${n}${i?`:${i}`:""}`;const a=r===this.min?"":r,o=n===this.max?"":n;return`${a}:${o}${i?`:${i}`:""}`}).join(",")}decode(t){if(typeof t<"u"&&(this.regionString=t),!this.regionString){this.segments=[];return}this.segments=this.regionString.split(",").map(r=>{const[n,i,a,o]=r.split(":");if(typeof o<"u")throw new Error(`there should be at most 2 ':' per region. Region: ${r}`);let s=n?Number(n):this.min,u=i?Number(i):this.max;const l=a!==""?a:void 0;if(s>u&&([s,u]=[u,s]),s<this.min&&(s=this.min),u>this.max&&(u=this.max),Number.isNaN(s))throw new Error(`The parsed value of ${n} is NaN. Region: ${r}`);if(Number.isNaN(u))throw new Error(`The parsed value of ${i} is NaN. Region: ${r}`);if(l&&!l.match(/^#[0-9a-f]{6,8}$/i))throw new Error(`The parsed value of ${a} is not a color in hex format. Region: ${r}`);return{start:s,end:u,color:l}})}}const t9="#FFEB3B66",SP=(e,t)=>e?t?`${e},${t}`:e:t;let W_e=class{constructor({element:t,min:r,max:n}){this.element=t,this.element._highlightcolor=t9,this.region=new $_e({min:r,max:n}),this.fixedHighlight=null}set max(t){this.region.max=t}setAttributesInElement(){this.region.decode(this.element.getAttribute("highlight")),this.region.segments.length===0&&(this.element._highlightstart=Number(this.element.getAttribute("highlightstart")),this.element._highlightend=Number(this.element.getAttribute("highlightend")),this.element._highlightcolor=this.element.getAttribute("highlightcolor")||t9,this.element._highlightstart!==null&&this.element._highlightend!==null&&typeof this.element._highlightstart=="number"&&typeof this.element._highlightend=="number"&&(this.element._highlight=`${this.element._highlightstart}:${this.element._highlightend}`,this.region.decode(SP(this.fixedHighlight,this.element._highlight))))}setFloatAttribute(t,r){const n=parseFloat(r);this.element[`_${t}`]=Number.isNaN(n)?r:n}changedCallBack(t,r){switch(t){case"highlightstart":case"highlightend":this.setFloatAttribute(t,r),this.element._highlight=Number.isNaN(this.element._highlightstart)||Number.isNaN(this.element._highlightend)||this.element._highlightstart===void 0||this.element._highlightend===void 0||this.element._highlightstart===null||this.element._highlightend===null?"":`${Math.max(this.region.min,this.element._highlightstart)}:${Math.min(this.region.max,this.element._highlightend)}`;break;default:this.element._highlight=r}this.region.decode(SP(this.fixedHighlight,this.element._highlight)),this.element.refresh()}setFixedHighlight(t){this.fixedHighlight=t,this.region.decode(SP(t,this.element._highlight)),this.element.refresh()}appendHighlightTo(t){this.highlighted=t.append("g").attr("class","highlighted")}updateHighlight(){const t=this.highlighted.selectAll("rect").data(this.region.segments);t.enter().append("rect").style("pointer-events","none").merge(t).attr("fill",r=>r.color?r.color:this.element._highlightcolor).attr("height",this.element._height).attr("x",r=>this.element.getXFromSeqPosition(r.start)).attr("width",r=>this.element.getSingleBaseWidth()*(r.end-r.start+1)),t.exit().remove()}};function X_e(e){const t=document.createElement("div");return t.style.borderColor="",t.style.borderColor=e,t.style.borderColor!==""}const Y_e=(e=null)=>{let t=[],r=[];if(e!==null&&typeof e!="string")throw new Error("The attribute text has to be of type string");if(e&&e.trim()!==""){const n=e.split(",").map(i=>i.split(":"));if(n.length<2)throw new Error("There should be at least 2 points to create a scale");t=n.map(i=>{const a=i[0].trim().toUpperCase();if(!X_e(a))throw new Error(`The color '${a} is not valid'`);return a}),r=n.map((i,a)=>{const o=parseFloat(i[1]);if(Number.isNaN(o))throw new Error(`The second part of every point should be a number. Error in point ${a}: ${i}`);return o})}return{range:t,domain:r}},r9=e=>e,K_e=(e=null,{keyFormatter:t=r9,valueFormatter:r=r9}={})=>{if(e!==null&&typeof e!="string")throw new Error("The attribute text has to be of type string");if(e&&e.trim()!==""){const n=e.split(",").map(a=>a.split(":")),i={};return n.forEach(a=>{if(a.length!==2)throw new Error(`Bad block: ${a.join(":")}
 The blocks of the string should follow the format KEY:VALUE`);i[t(a[0])]=r(a[1])}),i}return{}};let Q_e=class{constructor(t,r=400){this.element=t,this.timeStampWheelOutside=0,this.resetScrollableTimeout=null,this.scrollDelay=r}setElementScrollable(t){this.element.setAttribute("scrollable",t)}startResetScrollableTimer(){this.resetScrollableTimeout&&clearTimeout(this.resetScrollableTimeout),this.resetScrollableTimeout=setTimeout(()=>{this.setElementScrollable(!0),this.resetScrollableTimeout=null},this.scrollDelay)}blockScroll(t){this.timeStampWheelOutside=t,this.setElementScrollable(!1),this.startResetScrollableTimer()}wheel({target:t,timeStamp:r}){this.element.contains(t)?r<this.timeStampWheelOutside+this.scrollDelay?this.blockScroll(r):this.setElementScrollable(!0):this.blockScroll(r)}};const PQ=["left","right","top","bottom"],n9=PQ.map(e=>`margin${e}`),Z_e=(e,t={initialValue:{top:0,bottom:0,left:0,right:0}})=>{class r extends e{constructor(){super(),this.margin=t.initialValue}static get observedAttributes(){return[...super.observedAttributes,...n9]}attributeChangedCallback(i,a,o){a!==o&&n9.includes(i)&&(this[i]=o),super.attributeChangedCallback(i,a,o)}}for(const n of PQ)Object.defineProperty(r.prototype,`margin${n}`,{get(){return this.margin[n]||0},set(i){this.margin[n]=+i}});return r},J_e=W_e,ewe=Y_e,twe=K_e,TQ=Q_e,IQ=Z_e;class rwe extends HTMLElement{constructor(){super(),this._x=null,this._padding=0,this.height=40,this.dontDispatch=!1}_refreshWidth(){this.style.display="block",this.style.width="100%",this.width=this.offsetWidth-this.margin.left-this.margin.right,this.width>0&&(this._padding=10)}connectedCallback(){this._refreshWidth(),this.closest("protvista-manager")&&(this.manager=this.closest("protvista-manager"),this.manager.register(this)),this._length=parseFloat(this.getAttribute("length")),this._displaystart=parseFloat(this.getAttribute("displaystart"))||1,this._displayend=parseFloat(this.getAttribute("displayend"))||this._length,this._highlightStart=parseFloat(this.getAttribute("highlightStart")),this._highlightEnd=parseFloat(this.getAttribute("highlightEnd")),this._rulerstart=parseFloat(this.getAttribute("rulerStart"))||1,this._onResize=this._onResize.bind(this),this._createNavRuler()}disconnectedCallback(){this.manager&&this.manager.unregister(this),this._ro&&this._ro.unobserve(this),window.removeEventListener("resize",this._onResize)}static get observedAttributes(){return["length","displaystart","displayend","highlightStart","highlightEnd","width","rulerstart"]}attributeChangedCallback(t,r,n){r!==n&&(this[`_${t}`]=parseFloat(n),this._updateNavRuler())}get width(){return this._width}set width(t){this._width=t}_createNavRuler(){this._x=F0().range([this._padding,this.width-this._padding]),this._x.domain([this._rulerstart,this._rulerstart+this._length-1]),Ui(this).selectAll("div").remove(),this._container=Ui(this).append("div").attr("class","container"),this._svg=this._container.append("svg").attr("id","").attr("width",this.width).attr("height",this.height),this._xAxis=kK(this._x),this._displaystartLabel=this._svg.append("text").attr("class","start-label").attr("x",0).attr("y",this.height-this._padding),this._displayendLabel=this._svg.append("text").attr("class","end-label").attr("x",this.width).attr("y",this.height-this._padding).attr("text-anchor","end"),this._axis=this._svg.append("g").attr("class","x axis").call(this._xAxis),this._viewport=$Ce().extent([[this._padding,0],[this.width-this._padding,this.height*.51]]).on("brush",()=>{Wt.selection&&(this._displaystart=N_("d")(this._x.invert(Wt.selection[0])),this._displayend=N_("d")(this._x.invert(Wt.selection[1])),this.dontDispatch||this.dispatchEvent(new CustomEvent("change",{detail:{displayend:this._displayend,displaystart:this._displaystart,extra:{transform:Wt.transform}},bubbles:!0,cancelable:!0})),this._updateLabels(),this._updatePolygon())}),this._brushG=this._svg.append("g").attr("class","brush").call(this._viewport),this._brushG.call(this._viewport.move,[this._x(this._displaystart),this._x(this._displayend)]),this.polygon=this._svg.append("polygon").attr("class","zoom-polygon").attr("fill","#777").attr("fill-opacity","0.3"),this._updateNavRuler(),"ResizeObserver"in window&&(this._ro=new ResizeObserver(this._onResize),this._ro.observe(this)),window.addEventListener("resize",this._onResize)}_onResize(){this._refreshWidth(),this._x=this._x.range([this._padding,this.width-this._padding]),this._svg.attr("width",this.width),this._viewport.extent([[this._padding,0],[this.width-this._padding,this.height*.51]]),this._brushG.call(this._viewport),this._updateNavRuler()}_updateNavRuler(){this._x&&(this._container.style("padding-left",`${this.margin.left}px`).style("padding-right",`${this.margin.right}px`).style("padding-top",`${this.margin.top}px`).style("padding-bottom",`${this.margin.bottom}px`),this._x.domain([this._rulerstart,this._rulerstart+this._length-1]),this._axis.call(this._xAxis),this._updatePolygon(),this._updateLabels(),this._brushG&&(this.dontDispatch=!0,this._brushG.call(this._viewport.move,[this._x(this._displaystart),this._x(this._displayend)]),this.dontDispatch=!1))}_updateLabels(){this._displaystartLabel&&this._displaystartLabel.text(this._displaystart),this._displayendLabel&&this._displayendLabel.attr("x",this.width).text(this._displayend)}_updatePolygon(){this.polygon&&this.polygon.attr("points",`${this._x(this._displaystart)},${this.height/2}
        ${this._x(this._displayend)},${this.height/2}
        ${this.width},${this.height}
        0,${this.height}`)}}const nwe=IQ(rwe),i9=16,a9=10,o9=10,s9=5,Dx=(e,t=0)=>{const r=(e||"").match(/(\d+\.?\d*)px/);return r?+r[1]:t};class iwe extends Hh{static get properties(){return{title:{type:String,reflect:!0},x:{type:Number,reflect:!0},y:{type:Number,reflect:!0},visible:{type:Boolean,reflect:!0},container:{type:String,reflect:!0}}}constructor(){super(),this.title="",this.x=0,this.y=0,this.visible=!1,this.container="html",this._changeHandler=()=>this.requestUpdate(),this._observer=new MutationObserver(this._changeHandler)}connectedCallback(){super.connectedCallback(),this._observer.observe(this,{subtree:!0,characterData:!0,childList:!0}),window.addEventListener("resize",this._changeHandler)}disconnectedCallback(){super.disconnectedCallback(),this._observer.disconnect(),window.removeEventListener("resize",this._changeHandler)}static get styles(){return nu`
      :host {
        --z-index: 50000;
        --title-color: black;
        --text-color: white;
        --body-color: #616161;
        --triangle-width: ${i9}px;
        --triangle-height: ${a9}px;
        --triangle-margin: ${o9}px;
        --vertical-distance: ${s9}px;
      }

      h1,
      h2,
      h3,
      h4,
      h5,
      h6 {
        margin: 0;
      }

      h1 {
        background-color: var(--title-color);
        line-height: 2em;
        padding: 0 1ch;
      }

      .tooltip {
        font-family: Roboto, Arial, sans-serif;
        font-size: 0.9rem;
        top: 0;
        left: 0;
        display: block;
        position: absolute;
        min-width: 220px;
        max-width: 50vw;

        /* user overridable through custom properties */
        z-index: var(--z-index);
        color: var(--text-color);

        /* will change those */
        opacity: 0;
        pointer-events: none;
        transform: translate(0, 0);
      }

      .tooltip.visible {
        opacity: 0.9;
        pointer-events: auto;
      }

      .tooltip::before {
        content: "";
        position: absolute;
        pointer-events: none;
        border-style: solid;
        border-color: transparent;
        border-width: 0 calc(var(--triangle-width) / 2);
      }

      .tooltip.arrow-left::before {
        left: var(--triangle-margin);
      }

      .tooltip.arrow-right::before {
        right: var(--triangle-margin);
      }

      .tooltip.arrow-up::before {
        top: calc(-1 * var(--triangle-height));
        border-bottom-color: var(--title-color);
        border-bottom-width: var(--triangle-height);
      }

      .tooltip.arrow-down::before {
        bottom: calc(-1 * var(--triangle-height));
        border-top-color: var(--body-color);
        border-top-width: var(--triangle-height);
      }

      :host a,
      :host a:link,
      :host a:active,
      :host a:hover,
      ::slotted(a),
      ::slotted(a:link),
      ::slotted(a:active),
      ::slotted(a:hover) {
        color: #fff;
      }

      .tooltip-body {
        padding: 1em;
        background: var(--body-color);
        font-weight: normal;
        overflow-y: auto;
        max-height: 40vh;
      }

      ::slotted(h4) {
        font-size: 1.2rem !important;
        margin: 0 0 0.5rem 0 !important;
        font-weight: 600 !important;
        color: #fff !important;
      }

      ::slotted(h5) {
        font-size: 1rem !important;
        margin: 0 !important;
        font-weight: 500 !important;
        color: #fff !important;
      }

      ::slotted(h6) {
        font-size: 1rem !important;
        margin: 0 !important;
        font-weight: 300 !important;
        color: #fff !important;
      }

      ::slotted(p) {
        margin: 0.25rem 0 1rem 0 !important;
      }

      ::slotted(ul) {
        list-style: none !important;
        margin: 0.25rem 0 1rem 0 !important;
        padding: 0 !important;
      }
    `}_getPosition(){if(!this.shadowRoot.firstElementChild)return{};const r=document.querySelector(this.container||"html").getBoundingClientRect(),n=this.shadowRoot.firstElementChild.getBoundingClientRect(),i=getComputedStyle(this),a=Dx(i.getPropertyValue("--triangle-width"),i9),o=Dx(i.getPropertyValue("--triangle-height"),a9),s=Dx(i.getPropertyValue("--triangle-margin"),o9),u=Dx(i.getPropertyValue("--vertical-distance"),s9);let l=this.x-a/2-s,c="left";l+n.width<=r.right||(c="right",l=this.x-n.width+a/2+s);let f=this.y+o+u,h="up";return f+n.height<=r.height||(h="down",f=this.y-n.height-o-u),{x:l,y:f,horizontal:c,vertical:h}}firstUpdated(){this.requestUpdate()}render(){let t=this.title&&this.visible;const r=t?this._getPosition():{};t=r.x&&t;const n=t&&`transform: translate(${r.x}px, ${r.y}px);`;return zr`
      <section
        class="tooltip arrow-${r.horizontal||"left"} arrow-${r.vertical||"up"} ${t?"visible":""}"
        style="${n}"
      >
        <h1>${this.title}</h1>
        <div class="tooltip-body"><slot></slot></div>
      </section>
    `}}function awe(e,t,r,n){for(var i=e.length,a=r+(n?1:-1);n?a--:++a<i;)if(t(e[a],a,e))return a;return-1}function owe(e){return e!==e}function swe(e,t,r){for(var n=r-1,i=e.length;++n<i;)if(e[n]===t)return n;return-1}function MQ(e,t,r){return t===t?swe(e,t,r):awe(e,owe,r)}var uwe=typeof global=="object"&&global&&global.Object===Object&&global;const DQ=uwe;var lwe=typeof self=="object"&&self&&self.Object===Object&&self,cwe=DQ||lwe||Function("return this")();const Dd=cwe;var dwe=Dd.Symbol;const Xl=dwe;var RQ=Object.prototype,fwe=RQ.hasOwnProperty,hwe=RQ.toString,Ey=Xl?Xl.toStringTag:void 0;function pwe(e){var t=fwe.call(e,Ey),r=e[Ey];try{e[Ey]=void 0;var n=!0}catch{}var i=hwe.call(e);return n&&(t?e[Ey]=r:delete e[Ey]),i}var vwe=Object.prototype,mwe=vwe.toString;function gwe(e){return mwe.call(e)}var ywe="[object Null]",bwe="[object Undefined]",u9=Xl?Xl.toStringTag:void 0;function Wv(e){return e==null?e===void 0?bwe:ywe:u9&&u9 in Object(e)?pwe(e):gwe(e)}function Ob(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}var xwe="[object AsyncFunction]",Swe="[object Function]",Cwe="[object GeneratorFunction]",_we="[object Proxy]";function kQ(e){if(!Ob(e))return!1;var t=Wv(e);return t==Swe||t==Cwe||t==xwe||t==_we}var wwe=9007199254740991;function c6(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=wwe}function C2(e){return e!=null&&c6(e.length)&&!kQ(e)}var Ewe=Array.isArray;const ls=Ewe;function wh(e){return e!=null&&typeof e=="object"}var Awe="[object String]";function Pwe(e){return typeof e=="string"||!ls(e)&&wh(e)&&Wv(e)==Awe}var Twe=/\s/;function Iwe(e){for(var t=e.length;t--&&Twe.test(e.charAt(t)););return t}var Mwe=/^\s+/;function Dwe(e){return e&&e.slice(0,Iwe(e)+1).replace(Mwe,"")}var Rwe="[object Symbol]";function CE(e){return typeof e=="symbol"||wh(e)&&Wv(e)==Rwe}var l9=0/0,kwe=/^[-+]0x[0-9a-f]+$/i,Owe=/^0b[01]+$/i,Fwe=/^0o[0-7]+$/i,Lwe=parseInt;function Nwe(e){if(typeof e=="number")return e;if(CE(e))return l9;if(Ob(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=Ob(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=Dwe(e);var r=Owe.test(e);return r||Fwe.test(e)?Lwe(e.slice(2),r?2:8):kwe.test(e)?l9:+e}var c9=1/0,Bwe=17976931348623157e292;function Uwe(e){if(!e)return e===0?e:0;if(e=Nwe(e),e===c9||e===-c9){var t=e<0?-1:1;return t*Bwe}return e===e?e:0}function jwe(e){var t=Uwe(e),r=t%1;return t===t?r?t-r:t:0}function _2(e,t){for(var r=-1,n=e==null?0:e.length,i=Array(n);++r<n;)i[r]=t(e[r],r,e);return i}function zwe(e,t){return _2(t,function(r){return e[r]})}function Vwe(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n}var Hwe="[object Arguments]";function d9(e){return wh(e)&&Wv(e)==Hwe}var OQ=Object.prototype,Gwe=OQ.hasOwnProperty,qwe=OQ.propertyIsEnumerable,$we=d9(function(){return arguments}())?d9:function(e){return wh(e)&&Gwe.call(e,"callee")&&!qwe.call(e,"callee")};const d6=$we;function Wwe(){return!1}var FQ=typeof Hc=="object"&&Hc&&!Hc.nodeType&&Hc,f9=FQ&&typeof Gc=="object"&&Gc&&!Gc.nodeType&&Gc,Xwe=f9&&f9.exports===FQ,h9=Xwe?Dd.Buffer:void 0,Ywe=h9?h9.isBuffer:void 0,Kwe=Ywe||Wwe;const B5=Kwe;var Qwe=9007199254740991,Zwe=/^(?:0|[1-9]\d*)$/;function LQ(e,t){var r=typeof e;return t=t??Qwe,!!t&&(r=="number"||r!="symbol"&&Zwe.test(e))&&e>-1&&e%1==0&&e<t}var Jwe="[object Arguments]",e3e="[object Array]",t3e="[object Boolean]",r3e="[object Date]",n3e="[object Error]",i3e="[object Function]",a3e="[object Map]",o3e="[object Number]",s3e="[object Object]",u3e="[object RegExp]",l3e="[object Set]",c3e="[object String]",d3e="[object WeakMap]",f3e="[object ArrayBuffer]",h3e="[object DataView]",p3e="[object Float32Array]",v3e="[object Float64Array]",m3e="[object Int8Array]",g3e="[object Int16Array]",y3e="[object Int32Array]",b3e="[object Uint8Array]",x3e="[object Uint8ClampedArray]",S3e="[object Uint16Array]",C3e="[object Uint32Array]",$n={};$n[p3e]=$n[v3e]=$n[m3e]=$n[g3e]=$n[y3e]=$n[b3e]=$n[x3e]=$n[S3e]=$n[C3e]=!0;$n[Jwe]=$n[e3e]=$n[f3e]=$n[t3e]=$n[h3e]=$n[r3e]=$n[n3e]=$n[i3e]=$n[a3e]=$n[o3e]=$n[s3e]=$n[u3e]=$n[l3e]=$n[c3e]=$n[d3e]=!1;function _3e(e){return wh(e)&&c6(e.length)&&!!$n[Wv(e)]}function NQ(e){return function(t){return e(t)}}var BQ=typeof Hc=="object"&&Hc&&!Hc.nodeType&&Hc,k1=BQ&&typeof Gc=="object"&&Gc&&!Gc.nodeType&&Gc,w3e=k1&&k1.exports===BQ,CP=w3e&&DQ.process,E3e=function(){try{var e=k1&&k1.require&&k1.require("util").types;return e||CP&&CP.binding&&CP.binding("util")}catch{}}();const p9=E3e;var v9=p9&&p9.isTypedArray,A3e=v9?NQ(v9):_3e;const UQ=A3e;var P3e=Object.prototype,T3e=P3e.hasOwnProperty;function I3e(e,t){var r=ls(e),n=!r&&d6(e),i=!r&&!n&&B5(e),a=!r&&!n&&!i&&UQ(e),o=r||n||i||a,s=o?Vwe(e.length,String):[],u=s.length;for(var l in e)(t||T3e.call(e,l))&&!(o&&(l=="length"||i&&(l=="offset"||l=="parent")||a&&(l=="buffer"||l=="byteLength"||l=="byteOffset")||LQ(l,u)))&&s.push(l);return s}var M3e=Object.prototype;function D3e(e){var t=e&&e.constructor,r=typeof t=="function"&&t.prototype||M3e;return e===r}function R3e(e,t){return function(r){return e(t(r))}}var k3e=R3e(Object.keys,Object);const O3e=k3e;var F3e=Object.prototype,L3e=F3e.hasOwnProperty;function N3e(e){if(!D3e(e))return O3e(e);var t=[];for(var r in Object(e))L3e.call(e,r)&&r!="constructor"&&t.push(r);return t}function _E(e){return C2(e)?I3e(e):N3e(e)}function B3e(e){return e==null?[]:zwe(e,_E(e))}var U3e=Math.max;function j3e(e,t,r,n){e=C2(e)?e:B3e(e),r=r&&!n?jwe(r):0;var i=e.length;return r<0&&(r=U3e(i+r,0)),Pwe(e)?r<=i&&e.indexOf(t,r)>-1:!!i&&MQ(e,t,r)>-1}var z3e=Dd["__core-js_shared__"];const _P=z3e;var m9=function(){var e=/[^.]+$/.exec(_P&&_P.keys&&_P.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}();function V3e(e){return!!m9&&m9 in e}var H3e=Function.prototype,G3e=H3e.toString;function Xv(e){if(e!=null){try{return G3e.call(e)}catch{}try{return e+""}catch{}}return""}var q3e=/[\\^$.*+?()[\]{}|]/g,$3e=/^\[object .+?Constructor\]$/,W3e=Function.prototype,X3e=Object.prototype,Y3e=W3e.toString,K3e=X3e.hasOwnProperty,Q3e=RegExp("^"+Y3e.call(K3e).replace(q3e,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function Z3e(e){if(!Ob(e)||V3e(e))return!1;var t=kQ(e)?Q3e:$3e;return t.test(Xv(e))}function J3e(e,t){return e==null?void 0:e[t]}function Yv(e,t){var r=J3e(e,t);return Z3e(r)?r:void 0}var eEe=function(){try{var e=Yv(Object,"defineProperty");return e({},"",{}),e}catch{}}();const j_=eEe;function tEe(e,t,r){t=="__proto__"&&j_?j_(e,t,{configurable:!0,enumerable:!0,value:r,writable:!0}):e[t]=r}function rEe(e,t,r,n){for(var i=-1,a=e==null?0:e.length;++i<a;){var o=e[i];t(n,o,r(o),e)}return n}function nEe(e){return function(t,r,n){for(var i=-1,a=Object(t),o=n(t),s=o.length;s--;){var u=o[e?s:++i];if(r(a[u],u,a)===!1)break}return t}}var iEe=nEe();const aEe=iEe;function oEe(e,t){return e&&aEe(e,t,_E)}function sEe(e,t){return function(r,n){if(r==null)return r;if(!C2(r))return e(r,n);for(var i=r.length,a=t?i:-1,o=Object(r);(t?a--:++a<i)&&n(o[a],a,o)!==!1;);return r}}var uEe=sEe(oEe);const jQ=uEe;function lEe(e,t,r,n){return jQ(e,function(i,a,o){t(n,i,r(i),o)}),n}function cEe(){this.__data__=[],this.size=0}function zQ(e,t){return e===t||e!==e&&t!==t}function wE(e,t){for(var r=e.length;r--;)if(zQ(e[r][0],t))return r;return-1}var dEe=Array.prototype,fEe=dEe.splice;function hEe(e){var t=this.__data__,r=wE(t,e);if(r<0)return!1;var n=t.length-1;return r==n?t.pop():fEe.call(t,r,1),--this.size,!0}function pEe(e){var t=this.__data__,r=wE(t,e);return r<0?void 0:t[r][1]}function vEe(e){return wE(this.__data__,e)>-1}function mEe(e,t){var r=this.__data__,n=wE(r,e);return n<0?(++this.size,r.push([e,t])):r[n][1]=t,this}function Rd(e){var t=-1,r=e==null?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}Rd.prototype.clear=cEe;Rd.prototype.delete=hEe;Rd.prototype.get=pEe;Rd.prototype.has=vEe;Rd.prototype.set=mEe;function gEe(){this.__data__=new Rd,this.size=0}function yEe(e){var t=this.__data__,r=t.delete(e);return this.size=t.size,r}function bEe(e){return this.__data__.get(e)}function xEe(e){return this.__data__.has(e)}var SEe=Yv(Dd,"Map");const Fb=SEe;var CEe=Yv(Object,"create");const Lb=CEe;function _Ee(){this.__data__=Lb?Lb(null):{},this.size=0}function wEe(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}var EEe="__lodash_hash_undefined__",AEe=Object.prototype,PEe=AEe.hasOwnProperty;function TEe(e){var t=this.__data__;if(Lb){var r=t[e];return r===EEe?void 0:r}return PEe.call(t,e)?t[e]:void 0}var IEe=Object.prototype,MEe=IEe.hasOwnProperty;function DEe(e){var t=this.__data__;return Lb?t[e]!==void 0:MEe.call(t,e)}var REe="__lodash_hash_undefined__";function kEe(e,t){var r=this.__data__;return this.size+=this.has(e)?0:1,r[e]=Lb&&t===void 0?REe:t,this}function wv(e){var t=-1,r=e==null?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}wv.prototype.clear=_Ee;wv.prototype.delete=wEe;wv.prototype.get=TEe;wv.prototype.has=DEe;wv.prototype.set=kEe;function OEe(){this.size=0,this.__data__={hash:new wv,map:new(Fb||Rd),string:new wv}}function FEe(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null}function EE(e,t){var r=e.__data__;return FEe(t)?r[typeof t=="string"?"string":"hash"]:r.map}function LEe(e){var t=EE(this,e).delete(e);return this.size-=t?1:0,t}function NEe(e){return EE(this,e).get(e)}function BEe(e){return EE(this,e).has(e)}function UEe(e,t){var r=EE(this,e),n=r.size;return r.set(e,t),this.size+=r.size==n?0:1,this}function kd(e){var t=-1,r=e==null?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}kd.prototype.clear=OEe;kd.prototype.delete=LEe;kd.prototype.get=NEe;kd.prototype.has=BEe;kd.prototype.set=UEe;var jEe=200;function zEe(e,t){var r=this.__data__;if(r instanceof Rd){var n=r.__data__;if(!Fb||n.length<jEe-1)return n.push([e,t]),this.size=++r.size,this;r=this.__data__=new kd(n)}return r.set(e,t),this.size=r.size,this}function Xc(e){var t=this.__data__=new Rd(e);this.size=t.size}Xc.prototype.clear=gEe;Xc.prototype.delete=yEe;Xc.prototype.get=bEe;Xc.prototype.has=xEe;Xc.prototype.set=zEe;var VEe="__lodash_hash_undefined__";function HEe(e){return this.__data__.set(e,VEe),this}function GEe(e){return this.__data__.has(e)}function s0(e){var t=-1,r=e==null?0:e.length;for(this.__data__=new kd;++t<r;)this.add(e[t])}s0.prototype.add=s0.prototype.push=HEe;s0.prototype.has=GEe;function qEe(e,t){for(var r=-1,n=e==null?0:e.length;++r<n;)if(t(e[r],r,e))return!0;return!1}function z_(e,t){return e.has(t)}var $Ee=1,WEe=2;function VQ(e,t,r,n,i,a){var o=r&$Ee,s=e.length,u=t.length;if(s!=u&&!(o&&u>s))return!1;var l=a.get(e),c=a.get(t);if(l&&c)return l==t&&c==e;var d=-1,f=!0,h=r&WEe?new s0:void 0;for(a.set(e,t),a.set(t,e);++d<s;){var v=e[d],p=t[d];if(n)var m=o?n(p,v,d,t,e,a):n(v,p,d,e,t,a);if(m!==void 0){if(m)continue;f=!1;break}if(h){if(!qEe(t,function(g,y){if(!z_(h,y)&&(v===g||i(v,g,r,n,a)))return h.push(y)})){f=!1;break}}else if(!(v===p||i(v,p,r,n,a))){f=!1;break}}return a.delete(e),a.delete(t),f}var XEe=Dd.Uint8Array;const g9=XEe;function YEe(e){var t=-1,r=Array(e.size);return e.forEach(function(n,i){r[++t]=[i,n]}),r}function f6(e){var t=-1,r=Array(e.size);return e.forEach(function(n){r[++t]=n}),r}var KEe=1,QEe=2,ZEe="[object Boolean]",JEe="[object Date]",eAe="[object Error]",tAe="[object Map]",rAe="[object Number]",nAe="[object RegExp]",iAe="[object Set]",aAe="[object String]",oAe="[object Symbol]",sAe="[object ArrayBuffer]",uAe="[object DataView]",y9=Xl?Xl.prototype:void 0,wP=y9?y9.valueOf:void 0;function lAe(e,t,r,n,i,a,o){switch(r){case uAe:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case sAe:return!(e.byteLength!=t.byteLength||!a(new g9(e),new g9(t)));case ZEe:case JEe:case rAe:return zQ(+e,+t);case eAe:return e.name==t.name&&e.message==t.message;case nAe:case aAe:return e==t+"";case tAe:var s=YEe;case iAe:var u=n&KEe;if(s||(s=f6),e.size!=t.size&&!u)return!1;var l=o.get(e);if(l)return l==t;n|=QEe,o.set(e,t);var c=VQ(s(e),s(t),n,i,a,o);return o.delete(e),c;case oAe:if(wP)return wP.call(e)==wP.call(t)}return!1}function HQ(e,t){for(var r=-1,n=t.length,i=e.length;++r<n;)e[i+r]=t[r];return e}function cAe(e,t,r){var n=t(e);return ls(e)?n:HQ(n,r(e))}function dAe(e,t){for(var r=-1,n=e==null?0:e.length,i=0,a=[];++r<n;){var o=e[r];t(o,r,e)&&(a[i++]=o)}return a}function fAe(){return[]}var hAe=Object.prototype,pAe=hAe.propertyIsEnumerable,b9=Object.getOwnPropertySymbols,vAe=b9?function(e){return e==null?[]:(e=Object(e),dAe(b9(e),function(t){return pAe.call(e,t)}))}:fAe;const mAe=vAe;function x9(e){return cAe(e,_E,mAe)}var gAe=1,yAe=Object.prototype,bAe=yAe.hasOwnProperty;function xAe(e,t,r,n,i,a){var o=r&gAe,s=x9(e),u=s.length,l=x9(t),c=l.length;if(u!=c&&!o)return!1;for(var d=u;d--;){var f=s[d];if(!(o?f in t:bAe.call(t,f)))return!1}var h=a.get(e),v=a.get(t);if(h&&v)return h==t&&v==e;var p=!0;a.set(e,t),a.set(t,e);for(var m=o;++d<u;){f=s[d];var g=e[f],y=t[f];if(n)var b=o?n(y,g,f,t,e,a):n(g,y,f,e,t,a);if(!(b===void 0?g===y||i(g,y,r,n,a):b)){p=!1;break}m||(m=f=="constructor")}if(p&&!m){var S=e.constructor,x=t.constructor;S!=x&&"constructor"in e&&"constructor"in t&&!(typeof S=="function"&&S instanceof S&&typeof x=="function"&&x instanceof x)&&(p=!1)}return a.delete(e),a.delete(t),p}var SAe=Yv(Dd,"DataView");const U5=SAe;var CAe=Yv(Dd,"Promise");const j5=CAe;var _Ae=Yv(Dd,"Set");const Ng=_Ae;var wAe=Yv(Dd,"WeakMap");const z5=wAe;var S9="[object Map]",EAe="[object Object]",C9="[object Promise]",_9="[object Set]",w9="[object WeakMap]",E9="[object DataView]",AAe=Xv(U5),PAe=Xv(Fb),TAe=Xv(j5),IAe=Xv(Ng),MAe=Xv(z5),Ap=Wv;(U5&&Ap(new U5(new ArrayBuffer(1)))!=E9||Fb&&Ap(new Fb)!=S9||j5&&Ap(j5.resolve())!=C9||Ng&&Ap(new Ng)!=_9||z5&&Ap(new z5)!=w9)&&(Ap=function(e){var t=Wv(e),r=t==EAe?e.constructor:void 0,n=r?Xv(r):"";if(n)switch(n){case AAe:return E9;case PAe:return S9;case TAe:return C9;case IAe:return _9;case MAe:return w9}return t});const A9=Ap;var DAe=1,P9="[object Arguments]",T9="[object Array]",Rx="[object Object]",RAe=Object.prototype,I9=RAe.hasOwnProperty;function kAe(e,t,r,n,i,a){var o=ls(e),s=ls(t),u=o?T9:A9(e),l=s?T9:A9(t);u=u==P9?Rx:u,l=l==P9?Rx:l;var c=u==Rx,d=l==Rx,f=u==l;if(f&&B5(e)){if(!B5(t))return!1;o=!0,c=!1}if(f&&!c)return a||(a=new Xc),o||UQ(e)?VQ(e,t,r,n,i,a):lAe(e,t,u,r,n,i,a);if(!(r&DAe)){var h=c&&I9.call(e,"__wrapped__"),v=d&&I9.call(t,"__wrapped__");if(h||v){var p=h?e.value():e,m=v?t.value():t;return a||(a=new Xc),i(p,m,r,n,a)}}return f?(a||(a=new Xc),xAe(e,t,r,n,i,a)):!1}function h6(e,t,r,n,i){return e===t?!0:e==null||t==null||!wh(e)&&!wh(t)?e!==e&&t!==t:kAe(e,t,r,n,h6,i)}var OAe=1,FAe=2;function LAe(e,t,r,n){var i=r.length,a=i,o=!n;if(e==null)return!a;for(e=Object(e);i--;){var s=r[i];if(o&&s[2]?s[1]!==e[s[0]]:!(s[0]in e))return!1}for(;++i<a;){s=r[i];var u=s[0],l=e[u],c=s[1];if(o&&s[2]){if(l===void 0&&!(u in e))return!1}else{var d=new Xc;if(n)var f=n(l,c,u,e,t,d);if(!(f===void 0?h6(c,l,OAe|FAe,n,d):f))return!1}}return!0}function GQ(e){return e===e&&!Ob(e)}function NAe(e){for(var t=_E(e),r=t.length;r--;){var n=t[r],i=e[n];t[r]=[n,i,GQ(i)]}return t}function qQ(e,t){return function(r){return r==null?!1:r[e]===t&&(t!==void 0||e in Object(r))}}function BAe(e){var t=NAe(e);return t.length==1&&t[0][2]?qQ(t[0][0],t[0][1]):function(r){return r===e||LAe(r,e,t)}}var UAe=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,jAe=/^\w*$/;function p6(e,t){if(ls(e))return!1;var r=typeof e;return r=="number"||r=="symbol"||r=="boolean"||e==null||CE(e)?!0:jAe.test(e)||!UAe.test(e)||t!=null&&e in Object(t)}var zAe="Expected a function";function v6(e,t){if(typeof e!="function"||t!=null&&typeof t!="function")throw new TypeError(zAe);var r=function(){var n=arguments,i=t?t.apply(this,n):n[0],a=r.cache;if(a.has(i))return a.get(i);var o=e.apply(this,n);return r.cache=a.set(i,o)||a,o};return r.cache=new(v6.Cache||kd),r}v6.Cache=kd;var VAe=500;function HAe(e){var t=v6(e,function(n){return r.size===VAe&&r.clear(),n}),r=t.cache;return t}var GAe=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,qAe=/\\(\\)?/g,$Ae=HAe(function(e){var t=[];return e.charCodeAt(0)===46&&t.push(""),e.replace(GAe,function(r,n,i,a){t.push(i?a.replace(qAe,"$1"):n||r)}),t});const WAe=$Ae;var XAe=1/0,M9=Xl?Xl.prototype:void 0,D9=M9?M9.toString:void 0;function $Q(e){if(typeof e=="string")return e;if(ls(e))return _2(e,$Q)+"";if(CE(e))return D9?D9.call(e):"";var t=e+"";return t=="0"&&1/e==-XAe?"-0":t}function YAe(e){return e==null?"":$Q(e)}function WQ(e,t){return ls(e)?e:p6(e,t)?[e]:WAe(YAe(e))}var KAe=1/0;function AE(e){if(typeof e=="string"||CE(e))return e;var t=e+"";return t=="0"&&1/e==-KAe?"-0":t}function XQ(e,t){t=WQ(t,e);for(var r=0,n=t.length;e!=null&&r<n;)e=e[AE(t[r++])];return r&&r==n?e:void 0}function QAe(e,t,r){var n=e==null?void 0:XQ(e,t);return n===void 0?r:n}function ZAe(e,t){return e!=null&&t in Object(e)}function JAe(e,t,r){t=WQ(t,e);for(var n=-1,i=t.length,a=!1;++n<i;){var o=AE(t[n]);if(!(a=e!=null&&r(e,o)))break;e=e[o]}return a||++n!=i?a:(i=e==null?0:e.length,!!i&&c6(i)&&LQ(o,i)&&(ls(e)||d6(e)))}function e4e(e,t){return e!=null&&JAe(e,t,ZAe)}var t4e=1,r4e=2;function n4e(e,t){return p6(e)&&GQ(t)?qQ(AE(e),t):function(r){var n=QAe(r,e);return n===void 0&&n===t?e4e(r,e):h6(t,n,t4e|r4e)}}function m6(e){return e}function i4e(e){return function(t){return t==null?void 0:t[e]}}function a4e(e){return function(t){return XQ(t,e)}}function o4e(e){return p6(e)?i4e(AE(e)):a4e(e)}function YQ(e){return typeof e=="function"?e:e==null?m6:typeof e=="object"?ls(e)?n4e(e[0],e[1]):BAe(e):o4e(e)}function s4e(e,t){return function(r,n){var i=ls(r)?rEe:lEe,a=t?t():{};return i(r,e,YQ(n),a)}}var u4e=Object.prototype,l4e=u4e.hasOwnProperty,c4e=s4e(function(e,t,r){l4e.call(e,r)?e[r].push(t):tEe(e,r,[t])});const u0=c4e;var R9=Xl?Xl.isConcatSpreadable:void 0;function d4e(e){return ls(e)||d6(e)||!!(R9&&e&&e[R9])}function g6(e,t,r,n,i){var a=-1,o=e.length;for(r||(r=d4e),i||(i=[]);++a<o;){var s=e[a];t>0&&r(s)?t>1?g6(s,t-1,r,n,i):HQ(i,s):n||(i[i.length]=s)}return i}function f4e(e,t,r){switch(r.length){case 0:return e.call(t);case 1:return e.call(t,r[0]);case 2:return e.call(t,r[0],r[1]);case 3:return e.call(t,r[0],r[1],r[2])}return e.apply(t,r)}var k9=Math.max;function h4e(e,t,r){return t=k9(t===void 0?e.length-1:t,0),function(){for(var n=arguments,i=-1,a=k9(n.length-t,0),o=Array(a);++i<a;)o[i]=n[t+i];i=-1;for(var s=Array(t+1);++i<t;)s[i]=n[i];return s[t]=r(o),f4e(e,this,s)}}function p4e(e){return function(){return e}}var v4e=j_?function(e,t){return j_(e,"toString",{configurable:!0,enumerable:!1,value:p4e(t),writable:!0})}:m6;const m4e=v4e;var g4e=800,y4e=16,b4e=Date.now;function x4e(e){var t=0,r=0;return function(){var n=b4e(),i=y4e-(n-r);if(r=n,i>0){if(++t>=g4e)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}var S4e=x4e(m4e);const C4e=S4e;function KQ(e,t){return C4e(h4e(e,t,m6),e+"")}function QQ(e,t){var r=e==null?0:e.length;return!!r&&MQ(e,t,0)>-1}function ZQ(e,t,r){for(var n=-1,i=e==null?0:e.length;++n<i;)if(r(t,e[n]))return!0;return!1}function _4e(){}var w4e=1/0,E4e=Ng&&1/f6(new Ng([,-0]))[1]==w4e?function(e){return new Ng(e)}:_4e;const A4e=E4e;var P4e=200;function T4e(e,t,r){var n=-1,i=QQ,a=e.length,o=!0,s=[],u=s;if(r)o=!1,i=ZQ;else if(a>=P4e){var l=t?null:A4e(e);if(l)return f6(l);o=!1,i=z_,u=new s0}else u=t?[]:s;e:for(;++n<a;){var c=e[n],d=t?t(c):c;if(c=r||c!==0?c:0,o&&d===d){for(var f=u.length;f--;)if(u[f]===d)continue e;t&&u.push(d),s.push(c)}else i(u,d,r)||(u!==s&&u.push(d),s.push(c))}return s}function JQ(e){return wh(e)&&C2(e)}var I4e=KQ(function(e){return T4e(g6(e,1,JQ,!0))});const eZ=I4e;var M4e=Math.min;function D4e(e,t,r){for(var n=r?ZQ:QQ,i=e[0].length,a=e.length,o=a,s=Array(a),u=1/0,l=[];o--;){var c=e[o];o&&t&&(c=_2(c,NQ(t))),u=M4e(c.length,u),s[o]=!r&&(t||i>=120&&c.length>=120)?new s0(o&&c):void 0}c=e[0];var d=-1,f=s[0];e:for(;++d<i&&l.length<u;){var h=c[d],v=t?t(h):h;if(h=r||h!==0?h:0,!(f?z_(f,v):n(l,v,r))){for(o=a;--o;){var p=s[o];if(!(p?z_(p,v):n(e[o],v,r)))continue e}f&&f.push(v),l.push(h)}}return l}function R4e(e){return JQ(e)?e:[]}var k4e=KQ(function(e){var t=_2(e,R4e);return t.length&&t[0]===e[0]?D4e(t):[]});const tZ=k4e;var rZ=function(){if(typeof Map<"u")return Map;function e(t,r){var n=-1;return t.some(function(i,a){return i[0]===r?(n=a,!0):!1}),n}return function(){function t(){this.__entries__=[]}return Object.defineProperty(t.prototype,"size",{get:function(){return this.__entries__.length},enumerable:!0,configurable:!0}),t.prototype.get=function(r){var n=e(this.__entries__,r),i=this.__entries__[n];return i&&i[1]},t.prototype.set=function(r,n){var i=e(this.__entries__,r);~i?this.__entries__[i][1]=n:this.__entries__.push([r,n])},t.prototype.delete=function(r){var n=this.__entries__,i=e(n,r);~i&&n.splice(i,1)},t.prototype.has=function(r){return!!~e(this.__entries__,r)},t.prototype.clear=function(){this.__entries__.splice(0)},t.prototype.forEach=function(r,n){n===void 0&&(n=null);for(var i=0,a=this.__entries__;i<a.length;i++){var o=a[i];r.call(n,o[1],o[0])}},t}()}(),V5=typeof window<"u"&&typeof document<"u"&&window.document===document,V_=function(){return typeof global<"u"&&global.Math===Math?global:typeof self<"u"&&self.Math===Math?self:typeof window<"u"&&window.Math===Math?window:Function("return this")()}(),O4e=function(){return typeof requestAnimationFrame=="function"?requestAnimationFrame.bind(V_):function(e){return setTimeout(function(){return e(Date.now())},1e3/60)}}(),F4e=2;function L4e(e,t){var r=!1,n=!1,i=0;function a(){r&&(r=!1,e()),n&&s()}function o(){O4e(a)}function s(){var u=Date.now();if(r){if(u-i<F4e)return;n=!0}else r=!0,n=!1,setTimeout(o,t);i=u}return s}var N4e=20,B4e=["top","right","bottom","left","width","height","size","weight"],U4e=typeof MutationObserver<"u",j4e=function(){function e(){this.connected_=!1,this.mutationEventsAdded_=!1,this.mutationsObserver_=null,this.observers_=[],this.onTransitionEnd_=this.onTransitionEnd_.bind(this),this.refresh=L4e(this.refresh.bind(this),N4e)}return e.prototype.addObserver=function(t){~this.observers_.indexOf(t)||this.observers_.push(t),this.connected_||this.connect_()},e.prototype.removeObserver=function(t){var r=this.observers_,n=r.indexOf(t);~n&&r.splice(n,1),!r.length&&this.connected_&&this.disconnect_()},e.prototype.refresh=function(){var t=this.updateObservers_();t&&this.refresh()},e.prototype.updateObservers_=function(){var t=this.observers_.filter(function(r){return r.gatherActive(),r.hasActive()});return t.forEach(function(r){return r.broadcastActive()}),t.length>0},e.prototype.connect_=function(){!V5||this.connected_||(document.addEventListener("transitionend",this.onTransitionEnd_),window.addEventListener("resize",this.refresh),U4e?(this.mutationsObserver_=new MutationObserver(this.refresh),this.mutationsObserver_.observe(document,{attributes:!0,childList:!0,characterData:!0,subtree:!0})):(document.addEventListener("DOMSubtreeModified",this.refresh),this.mutationEventsAdded_=!0),this.connected_=!0)},e.prototype.disconnect_=function(){!V5||!this.connected_||(document.removeEventListener("transitionend",this.onTransitionEnd_),window.removeEventListener("resize",this.refresh),this.mutationsObserver_&&this.mutationsObserver_.disconnect(),this.mutationEventsAdded_&&document.removeEventListener("DOMSubtreeModified",this.refresh),this.mutationsObserver_=null,this.mutationEventsAdded_=!1,this.connected_=!1)},e.prototype.onTransitionEnd_=function(t){var r=t.propertyName,n=r===void 0?"":r,i=B4e.some(function(a){return!!~n.indexOf(a)});i&&this.refresh()},e.getInstance=function(){return this.instance_||(this.instance_=new e),this.instance_},e.instance_=null,e}(),nZ=function(e,t){for(var r=0,n=Object.keys(t);r<n.length;r++){var i=n[r];Object.defineProperty(e,i,{value:t[i],enumerable:!1,writable:!1,configurable:!0})}return e},l0=function(e){var t=e&&e.ownerDocument&&e.ownerDocument.defaultView;return t||V_},iZ=PE(0,0,0,0);function H_(e){return parseFloat(e)||0}function O9(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];return t.reduce(function(n,i){var a=e["border-"+i+"-width"];return n+H_(a)},0)}function z4e(e){for(var t=["top","right","bottom","left"],r={},n=0,i=t;n<i.length;n++){var a=i[n],o=e["padding-"+a];r[a]=H_(o)}return r}function V4e(e){var t=e.getBBox();return PE(0,0,t.width,t.height)}function H4e(e){var t=e.clientWidth,r=e.clientHeight;if(!t&&!r)return iZ;var n=l0(e).getComputedStyle(e),i=z4e(n),a=i.left+i.right,o=i.top+i.bottom,s=H_(n.width),u=H_(n.height);if(n.boxSizing==="border-box"&&(Math.round(s+a)!==t&&(s-=O9(n,"left","right")+a),Math.round(u+o)!==r&&(u-=O9(n,"top","bottom")+o)),!q4e(e)){var l=Math.round(s+a)-t,c=Math.round(u+o)-r;Math.abs(l)!==1&&(s-=l),Math.abs(c)!==1&&(u-=c)}return PE(i.left,i.top,s,u)}var G4e=function(){return typeof SVGGraphicsElement<"u"?function(e){return e instanceof l0(e).SVGGraphicsElement}:function(e){return e instanceof l0(e).SVGElement&&typeof e.getBBox=="function"}}();function q4e(e){return e===l0(e).document.documentElement}function $4e(e){return V5?G4e(e)?V4e(e):H4e(e):iZ}function W4e(e){var t=e.x,r=e.y,n=e.width,i=e.height,a=typeof DOMRectReadOnly<"u"?DOMRectReadOnly:Object,o=Object.create(a.prototype);return nZ(o,{x:t,y:r,width:n,height:i,top:r,right:t+n,bottom:i+r,left:t}),o}function PE(e,t,r,n){return{x:e,y:t,width:r,height:n}}var X4e=function(){function e(t){this.broadcastWidth=0,this.broadcastHeight=0,this.contentRect_=PE(0,0,0,0),this.target=t}return e.prototype.isActive=function(){var t=$4e(this.target);return this.contentRect_=t,t.width!==this.broadcastWidth||t.height!==this.broadcastHeight},e.prototype.broadcastRect=function(){var t=this.contentRect_;return this.broadcastWidth=t.width,this.broadcastHeight=t.height,t},e}(),Y4e=function(){function e(t,r){var n=W4e(r);nZ(this,{target:t,contentRect:n})}return e}(),K4e=function(){function e(t,r,n){if(this.activeObservations_=[],this.observations_=new rZ,typeof t!="function")throw new TypeError("The callback provided as parameter 1 is not a function.");this.callback_=t,this.controller_=r,this.callbackCtx_=n}return e.prototype.observe=function(t){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if(!(typeof Element>"u"||!(Element instanceof Object))){if(!(t instanceof l0(t).Element))throw new TypeError('parameter 1 is not of type "Element".');var r=this.observations_;r.has(t)||(r.set(t,new X4e(t)),this.controller_.addObserver(this),this.controller_.refresh())}},e.prototype.unobserve=function(t){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if(!(typeof Element>"u"||!(Element instanceof Object))){if(!(t instanceof l0(t).Element))throw new TypeError('parameter 1 is not of type "Element".');var r=this.observations_;r.has(t)&&(r.delete(t),r.size||this.controller_.removeObserver(this))}},e.prototype.disconnect=function(){this.clearActive(),this.observations_.clear(),this.controller_.removeObserver(this)},e.prototype.gatherActive=function(){var t=this;this.clearActive(),this.observations_.forEach(function(r){r.isActive()&&t.activeObservations_.push(r)})},e.prototype.broadcastActive=function(){if(this.hasActive()){var t=this.callbackCtx_,r=this.activeObservations_.map(function(n){return new Y4e(n.target,n.broadcastRect())});this.callback_.call(t,r,t),this.clearActive()}},e.prototype.clearActive=function(){this.activeObservations_.splice(0)},e.prototype.hasActive=function(){return this.activeObservations_.length>0},e}(),aZ=typeof WeakMap<"u"?new WeakMap:new rZ,oZ=function(){function e(t){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function.");if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");var r=j4e.getInstance(),n=new K4e(t,r,this);aZ.set(this,n)}return e}();["observe","unobserve","disconnect"].forEach(function(e){oZ.prototype[e]=function(){var t;return(t=aZ.get(this))[e].apply(t,arguments)}});var Q4e=function(){return typeof V_.ResizeObserver<"u"?V_.ResizeObserver:oZ}();class G_ extends HTMLElement{constructor(){super(),G_._polyfillElementClosest(),this._updateScaleDomain=this._updateScaleDomain.bind(this),this._initZoom=this._initZoom.bind(this),this.zoomed=this.zoomed.bind(this),this._applyZoomTranslation=this.applyZoomTranslation.bind(this),this._resetEventHandler=this._resetEventHandler.bind(this);let t=!1;this.applyZoomTranslation=()=>{t||(t=!0,requestAnimationFrame(()=>{t=!1,this._applyZoomTranslation()}))},this._onResize=this._onResize.bind(this),this._listenForResize=this._listenForResize.bind(this),this.trackHighlighter=new J_e({element:this,min:1}),this.scrollFilter=new TQ(this),this.wheelListener=r=>this.scrollFilter.wheel(r)}connectedCallback(){this.style.display="block",this.style.width="100%",this.width=this.offsetWidth,this.closest("protvista-manager")&&(this.manager=this.closest("protvista-manager"),this.manager.register(this)),this._length=this.getAttribute("length")?parseFloat(this.getAttribute("length")):0,this._displaystart=this.getAttribute("displaystart")?parseFloat(this.getAttribute("displaystart")):1,this._displayend=this.getAttribute("displayend")?parseFloat(this.getAttribute("displayend")):this.length,this._height=this.getAttribute("height")?Number(this.getAttribute("height")):44,this._highlightEvent=this.getAttribute("highlight-event")?this.getAttribute("highlight-event"):"onclick",this.trackHighlighter.setAttributesInElement(this),this._updateScaleDomain(),this._originXScale=this.xScale.copy(),this._initZoom(),this._listenForResize(),this.addEventListener("error",t=>{console.error(t)}),this._highlightEvent!=="none"&&this.addEventListener("click",this._resetEventHandler),this.hasAttribute("filter-scroll")&&document.addEventListener("wheel",this.wheelListener,{capture:!0})}disconnectedCallback(){this.manager&&this.manager.unregister(this),this._ro?this._ro.unobserve(this):window.removeEventListener("resize",this._onResize),this._highlightEvent!=="none"&&this.removeEventListener("click",this._resetEventHandler),document.removeEventListener("wheel",this.wheelListener)}get width(){return this._width}set width(t){this._width=t}set height(t){this._height=t}get height(){return this._height}set length(t){this._length=t,this.trackHighlighter.max=t}get length(){return this._length}get xScale(){return this._xScale}set xScale(t){this._xScale=t}get zoom(){return this._zoom}set svg(t){this._svg=t,t.call(this._zoom),this.applyZoomTranslation()}get svg(){return this._svg}set fixedHighlight(t){this.trackHighlighter.setFixedHighlight(t)}getWidthWithMargins(){return this.width?this.width-this.margin.left-this.margin.right:0}_updateScaleDomain(){this.xScale=F0().domain([1,this._length+1]).range([0,this.getWidthWithMargins()])}_initZoom(){this._zoom=q_e().scaleExtent([1,1/0]).translateExtent([[0,0],[this.getWidthWithMargins(),0]]).extent([[0,0],[this.getWidthWithMargins(),0]]).filter(()=>{if(!(Wt instanceof WheelEvent))return!0;if(this.hasAttribute("no-scroll"))return!1;if(this.hasAttribute("filter-scroll")){const t=this.getAttribute("scrollable");if(t)return t==="true"}return!this.hasAttribute("use-ctrl-to-zoom")||Wt.ctrlKey}).on("zoom",this.zoomed)}static get observedAttributes(){return["displaystart","displayend","length","highlight"]}setFloatAttribute(t,r){const n=parseFloat(r);this[`_${t}`]=Number.isNaN(n)?r:n}attributeChangedCallback(t,r,n){if(n==="null"&&(n=null),r!==n){if(t.startsWith("highlight")){this.trackHighlighter.changedCallBack(t,n);return}this.setFloatAttribute(t,n),t==="length"&&(this._updateScaleDomain(),this._originXScale=this.xScale.copy()),this.applyZoomTranslation()}}zoomed(){if(this.xScale=Wt.transform.rescaleX(this._originXScale),this.dontDispatch)return;const[t,r]=this.xScale.domain();this.dispatchEvent(new CustomEvent("change",{detail:{displaystart:Math.max(1,t),displayend:Math.min(this.length,Math.max(r-1,t+1))},bubbles:!0,cancelable:!0}))}applyZoomTranslation(){if(!this.svg||!this._originXScale)return;const t=Math.max(1,this.length/(1+this._displayend-this._displaystart)),r=-this._originXScale(this._displaystart);this.dontDispatch=!0,this.svg.call(this.zoom.transform,l6.scale(t).translate(r,0)),this.dontDispatch=!1,this.refresh()}_onResize(){this.width=this.offsetWidth,this._updateScaleDomain(),this._originXScale=this.xScale.copy(),this.svg&&this.svg.attr("width",this.width),this._zoom.scaleExtent([1,1/0]).translateExtent([[0,0],[this.getWidthWithMargins(),0]]),this.applyZoomTranslation()}_listenForResize(){this._ro=new Q4e(this._onResize),this._ro.observe(this)}_resetEventHandler(t){t.target.closest(".feature")||this.dispatchEvent(this.createEvent("reset",null,!0))}getXFromSeqPosition(t){return this.margin.left+this.xScale(t)}getSingleBaseWidth(){return this.xScale(2)-this.xScale(1)}static _getClickCoords(){return Wt?[Wt.pageX,Wt.pageY]:null}static _polyfillElementClosest(){Element.prototype.matches||(Element.prototype.matches=Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector),Element.prototype.closest||(Element.prototype.closest=t=>{let r=this;do{if(r.matches(t))return r;r=r.parentElement||r.parentNode}while(r!==null&&r.nodeType===1);return null})}createEvent(t,r=null,n=!1,i=!1,a,o,s){r&&(r=r.feature?r.feature:r);const u={eventtype:t,coords:G_._getClickCoords(),feature:r,target:s};return n&&(r&&r.fragments?u.highlight=r.fragments.map(l=>`${l.start}:${l.end}`).join(","):Wt&&Wt.shiftKey&&this._highlight?u.highlight=`${this._highlight},${a}:${o}`:u.highlight=a&&o?`${a}:${o}`:null),i&&(u.selectedid=r&&r.protvistaFeatureId),new CustomEvent("change",{detail:u,bubbles:!0,cancelable:!0})}bindEvents(t,r){t.on("mouseover",(n,i,a)=>{r.dispatchEvent(r.createEvent("mouseover",n,r._highlightEvent==="onmouseover",!1,n.start,n.end,a[i]))}).on("mouseout",()=>{r.dispatchEvent(r.createEvent("mouseout",null,r._highlightEvent==="onmouseover"))}).on("click",(n,i,a)=>{r.dispatchEvent(r.createEvent("click",n,r._highlightEvent==="onclick",!0,n.start,n.end,a[i]))})}}const q_=IQ(G_,{initialValue:{top:10,right:10,bottom:10,left:10}}),En=10;class Z4e{getFeatureShape(t,r,n,i){return i=i||"rectangle",this._ftLength=n,this._ftHeight=r,this._ftWidth=t*n,typeof this["_"+i]!="function"&&(i="rectangle"),this["_"+i]()}static isContinuous(t){return t=t.toLowerCase(),t!=="bridge"}_rectangle(){return"M0,0L"+this._ftWidth+",0L"+this._ftWidth+","+this._ftHeight+"L0,"+this._ftHeight+"Z"}_roundRectangle(){return"M6,0h"+(this._ftWidth-2*6)+",0a6,6 0 0 1 6,6v"+(this._ftHeight-2*6)+"a6,6 0 0 1 -6,6h"+(2*6-this._ftWidth)+"a6,6 0 0 1 -6,-6v"+(2*6-this._ftHeight)+"a6,6 0 0 1 6,-6Z"}_line(){return`M0,${this._ftHeight/2} L${this._ftWidth},${this._ftHeight/2}`}_bridge(){return this._ftLength!==1?"M0,"+this._ftHeight+"L0,0L"+this._ftWidth+",0L"+this._ftWidth+","+this._ftHeight+"L"+this._ftWidth+",2L0,2Z":"M0,"+this._ftHeight+"L0,"+this._ftHeight/2+"L"+this._ftWidth/2+","+this._ftHeight/2+"L"+this._ftWidth/2+",0L"+this._ftWidth/2+","+this._ftHeight/2+"L"+this._ftWidth+","+this._ftHeight/2+"L"+this._ftWidth+","+this._ftHeight+"Z"}_getMiddleLine(t){return"M0,"+t+"L"+this._ftWidth+","+t+"Z"}_diamond(){const t=En/2,r=this._ftWidth/2,n="M"+r+",0L"+(r+t)+","+t+"L"+r+","+En+"L"+(r-t)+","+t;return this._ftLength!==1?n+this._getMiddleLine(t,this._ftWidth):n+"Z"}_chevron(){const t=this._ftWidth/2,r=En/2,n="M"+t+","+r+"L"+(r+t)+",0L"+(r+t)+","+r+"L"+t+","+En+"L"+(-r+t)+","+r+"L"+(-r+t)+",0";return this._ftLength!==1?n+"L"+t+","+r+this._getMiddleLine(r,this._ftWidth)+"Z":n+"Z"}_catFace(){const t=En/2,r=En/10,n=this._ftWidth/2,i="M"+(-t+n)+",0L"+(-t+n)+","+6*r+"L"+(-2*r+n)+","+En+"L"+(2*r+n)+","+En+"L"+(t+n)+","+6*r+"L"+(t+n)+",0L"+(2*r+n)+","+4*r+"L"+(-2*r+n)+","+4*r;return this._ftLength!==1?i+"M"+n+",0"+this._getMiddleLine(t,this._ftWidth)+"Z":i+"Z"}_triangle(){const t=En/2,r=this._ftWidth/2,n="M"+r+",0L"+(t+r)+","+En+"L"+(-t+r)+","+En;return this._ftLength!==1?n+"L"+r+",0"+this._getMiddleLine(t,this._ftWidth)+"Z":n+"Z"}_wave(){const t=En/4,r=En/2,n=this._ftWidth/2,i="M"+(-En/2+n)+","+r+"A"+t+","+r+" 0 1,1 "+n+","+r+"A"+t+","+r+" 0 1,0 "+(En/2+n)+","+r;return this._ftLength!==1?i+this._getMiddleLine(r,this._ftWidth)+"Z":i+"Z"}_getPolygon(t){const r=En/2;let n="M ";const i=this._ftWidth/2;for(let a=0;a<t;a++)n+=r*Math.cos(2*Math.PI*a/t)+i+","+(r*Math.sin(2*Math.PI*a/t)+r)+" ";return this._ftLength!==1?n+" "+(r*Math.cos(0)+i)+","+(r*Math.sin(0)+r)+" "+this._getMiddleLine(r,this._ftWidth)+"Z":n+"Z"}_hexagon(){return this._getPolygon(6)}_pentagon(){return this._getPolygon(5)}_circle(){const t=this._ftWidth/2,r=Math.sqrt(En/Math.PI),n="M"+t+",0A"+r+","+r+" 0 1,1 "+t+","+En+"A"+r+","+r+" 0 1,1 "+t+",0";return this._ftLength!==1?n+this._getMiddleLine(En/2,this._ftWidth)+"Z":n+"Z"}_arrow(){const t=En/10,r=this._ftWidth/2,n="M"+r+",0L"+(-t+r)+",0L"+(-5*t+r)+","+4*t+"L"+(-t+r)+","+this._ftHeight+"L"+r+","+this._ftHeight+"L"+(4*t+r)+","+4*t;return this._ftLength!==1?n+"L"+r+",0"+this._getMiddleLine(En/2,this._ftWidth)+"Z":n+"Z"}_doubleBar(){const t=this._ftWidth/2,r=En/2,n="M"+t+",0L"+(-r+t)+","+En+"L"+t+","+En+"L"+(r+t)+",0";return this._ftLength!==1?n+"L"+t+",0"+this._getMiddleLine(En/2,this._ftWidth)+"Z":n+"Z"}_getBrokenEnd(){const t=this._ftHeight/4;return"L"+(this._ftWidth-t)+","+t+"L"+this._ftWidth+","+2*t+"L"+(this._ftWidth-t)+","+3*t+"L"+this._ftWidth+","+this._ftHeight}_getBrokenStart(){const t=this._ftHeight/4;return"L"+t+","+3*t+"L0,"+2*t+"L"+t+","+t}_discontinuosStart(){return"M0,0L"+this._ftWidth+",0L"+this._ftWidth+","+this._ftHeight+"L0,"+this._ftHeight+this._getBrokenStart()+"Z"}_discontinuos(){return"M0,0L"+this._ftWidth+",0"+this._getBrokenEnd()+"L0,"+this._ftHeight+this._getBrokenStart()+"Z"}_discontinuosEnd(){return"M0,0L"+this._ftWidth+",0"+this._getBrokenEnd()+"L0,"+this._ftHeight+"Z"}_helix(){const t=En/2,r=En/4;let n=t/2;const i=Math.round(this._ftWidth/t);let a="";for(let o=0;o<i;o++){const s="M"+(-(t/2)+n)+","+this._ftHeight+" C"+(n+r)+","+3*r+" "+(t/2+n)+","+r+" "+n+", 0 C"+(n-r)+","+r+" "+n+","+3*r+" "+(t/2+n)+","+this._ftHeight;a+=s,n+=t}return a}_strand(){let t=0;this._ftWidth>En/2&&(t=this._ftWidth-En/2);const r=this._ftHeight/4,n="M0,"+r+"L"+t+","+r+"L"+t+","+3*r+"L0,"+3*r+"L0,"+r,i="M"+t+",0L"+this._ftWidth+","+2*r+"L"+t+","+this._ftHeight+"Z";return n+i}}class y6{constructor({layoutHeight:t,padding:r=1,minHeight:n=17}){this._padding=r,this._minHeight=n,this._layoutHeight=t}init(t){this._features=t}getFeatureYPos(){const t=this.getFeatureHeight();return this._layoutHeight/2-t/2}getFeatureHeight(){return Math.min(this._layoutHeight,this._minHeight)-this._padding}}const J4e=(e,t)=>!(Number(t.start)>Number(e.end)||Number(t.end)<Number(e.start)),ePe=(e,t)=>t.some(r=>J4e(e,r));class tPe extends y6{constructor(t){super(t),this.featuresMap=new Map,this._rowHeight=0,this._rows=[],this._minHeight=15}init(t){t.forEach(r=>{const n=this._rows.findIndex(i=>!ePe(r,i));n>=0?(this._rows[n].push(r),this.featuresMap.set(r,n)):(this._rows.push([r]),this.featuresMap.set(r,this._rows.length-1))}),this._rowHeight=Math.min(this._layoutHeight/this._rows.length,this._minHeight)}getOffset(){return this._rows.length*this._rowHeight<this._layoutHeight?this._layoutHeight/2-this._rows.length*this._rowHeight/2:0}getFeatureYPos(t){const r=this.featuresMap.get(t);return this.getOffset()+this._rowHeight*r+2*this._padding}getFeatureHeight(){return this._rowHeight-2*this._padding}}const Bg={CHAIN:{name:"chain",label:"Chain",tooltip:"(aka mature region). This describes the extent of a polypeptide chain in the mature protein following processing",shape:"rectangle",color:"#CC9933"},TRANSIT:{name:"transit peptide",label:"Transit peptide",tooltip:"This describes the extent of a transit peptide",shape:"rectangle",color:"#009966"},INIT_MET:{name:"initiator methionine",label:"Initiator methionine",tooltip:"This indicates that the initiator methionine is cleaved from the mature protein",shape:"arrow",color:"#996633"},PROPEP:{name:"propeptide",label:"Propeptide",tooltip:"Part of a protein that is cleaved during maturation or activation",shape:"rectangle",color:"#99CCCC"},PEPTIDE:{name:"peptide",label:"Peptide",tooltip:"The position and length of an active peptide in the mature protein",shape:"rectangle",color:"#006699"},SIGNAL:{name:"signal peptide",label:"Signal peptide",tooltip:"N-terminal signal peptide",shape:"rectangle",color:"#CC0033"},HELIX:{name:"helix",label:"Helix",tooltip:"The positions of experimentally determined helical regions",shape:"rectangle",color:"#FF0066"},STRAND:{name:"strand",label:"Beta strand",tooltip:"The positions of experimentally determined beta strands",shape:"rectangle",color:"#FFCC00"},TURN:{name:"turn",label:"Turn",tooltip:"The positions of experimentally determined hydrogen-bonded turns",shape:"rectangle",color:"#0571AF"},DISULFID:{name:"disulfide bond",label:"Disulfide bond",tooltip:"The positions of cysteine residues participating in disulphide bonds",shape:"bridge",color:"#23B14D"},CROSSLNK:{name:"cross-link",label:"Cross-link",tooltip:"Covalent linkages of various types formed between two proteins or between two parts of the same protein",shape:"bridge",color:"#FF6600"},REGION:{name:"region of interest",label:"Region of interest",tooltip:"Regions in multifunctional enzymes or fusion proteins, or characteristics of a region, e.g., protein-protein interactions mediation",shape:"rectangle",color:"#B33E00"},COILED:{name:"coiled-coil region",label:"Coiled-coil region",tooltip:"Coiled coils are built by two or more alpha-helices that wind around each other to form a supercoil",shape:"rectangle",color:"#006699"},MOTIF:{name:"short sequence motif",label:"Short sequence motif",tooltip:"Short conserved sequence motif of biological significance",shape:"rectangle",color:"#402060"},REPEAT:{name:"repeat",label:"Repeat",tooltip:"Repeated sequence motifs or repeated domains within the protein",shape:"rectangle",color:"#9900FF"},CA_BIND:{name:"calcium-binding region",label:"Calcium-binding region",tooltip:"Calcium-binding regions, such as the EF-hand motif",shape:"rectangle",color:"#FF3399"},DNA_BIND:{name:"DNA-binding region",label:"DNA binding",tooltip:"DNA-binding domains such as AP2/ERF domain, the ETS domain, the Fork-Head domain, the HMG box and the Myb domain",shape:"rectangle",color:"#009933"},DOMAIN:{name:"other domain of interest",label:"Other domain of interest",tooltip:"Specific combination of secondary structures organized into a characteristic three-dimensional structure or fold",shape:"rectangle",color:"#9999FF"},ZN_FING:{name:"zinc finger region",label:"Zinc finger",tooltip:"Small, functional, independently folded domain that coordinates one or more zinc ions",shape:"rectangle",color:"#990066"},NP_BIND:{name:"nucleotide-binding region",label:"Nucleotide-binding region",tooltip:"(aka flavin-binding). Region in the protein which binds nucleotide phosphates",shape:"rectangle",color:"#FF9900"},METAL:{name:"metal ion-binding site",label:"Metal ion-binding site",tooltip:"Binding site for a metal ion",shape:"diamond",color:"#009900"},SITE:{name:"other site of interest",label:"Other site of interest",tooltip:"Any interesting single amino acid site on the sequence",shape:"chevron",color:"#660033"},BINDING:{name:"other binding site",label:"Other binding site",tooltip:"Binding site for any chemical group (co-enzyme, prosthetic group, etc.)",shape:"rectangle",color:"#catFace"},ACT_SITE:{name:"active site",label:"Active site",tooltip:"Amino acid(s) directly involved in the activity of an enzyme",shape:"circle",color:"#FF6666"},MOD_RES:{name:"Post-translationally modified residue",label:"Modified residue",tooltip:"Modified residues such as phosphorylation, acetylation, acylation, methylation",shape:"triangle",color:"#000066"},LIPID:{name:"lipid moiety-binding region",label:"Lipidation",tooltip:"Covalently attached lipid group(s)",shape:"wave",color:"#99CC33"},CARBOHYD:{name:"glycosylation site",label:"Glycosylation",tooltip:"Covalently attached glycan group(s)",shape:"hexagon",color:"#CC3366"},COMPBIAS:{name:"compositionally biased region",label:"Compositionally biased region",tooltip:"Position of regions of compositional bias within the protein and the particular amino acids that are over-represented within those regions",shape:"rectangle",color:"#FF3366"},CONFLICT:{name:"sequence conflict",label:"Sequence conflict",tooltip:"Sequence discrepancies of unknown origin",shape:"rectangle",color:"#6633CC"},NON_CONS:{name:"non-consecutive residues",label:"Non-adjacent residues",tooltip:"Indicates that two residues in a sequence are not consecutive and that there is an undetermined number of unsequenced residues between them",shape:"doubleBar",color:"#FF0033"},NON_TER:{name:"non-terminal residue",label:"Non-terminal residue",tooltip:"The sequence is incomplete. The residue is not the terminal residue of the complete protein",shape:"doubleBar",color:"#339933"},UNSURE:{name:"unsure residue",label:"Sequence uncertainty",tooltip:"Regions of a sequence for which the authors are unsure about the sequence assignment",shape:"rectangle",color:"#33FF00"},NON_STD:{name:"non-standard amino acid",label:"Non-standard residue",tooltip:"Non-standard amino acids (selenocysteine and pyrrolysine)",shape:"pentagon",color:"#330066"},MUTAGEN:{name:"mutagenesis site",label:"Mutagenesis",tooltip:"Site which has been experimentally altered by mutagenesis",shape:"rectangle",color:"#FF9900"},TOPO_DOM:{name:"topological domain",label:"Topological domain",tooltip:"Location of non-membrane regions of membrane-spanning proteins",shape:"rectangle",color:"#CC0000"},TRANSMEM:{name:"transmembrane region",label:"Transmembrane",tooltip:"Extent of a membrane-spanning region",shape:"rectangle",color:"#CC00CC"},INTRAMEM:{name:"intramembrane region",label:"Intramembrane",tooltip:"Extent of a region located in a membrane without crossing it",shape:"rectangle",color:"#0000CC"},VAR_SEQ:{name:"splice variant",label:"Splice variant",tooltip:"",shape:"rectangle",color:"#CC11CC"},VARIANT:{name:"sequence variant",label:"Natural variant",tooltip:"Natural variant of the protein, including polymorphisms, variations between strains, isolates or cultivars, disease-associated mutations and RNA editing events",shape:"circle",color:"black"},UNIQUE:{name:"unique",label:"Unique peptide",tooltip:"",shape:"rectangle",color:"#fc3133"},NON_UNIQUE:{name:"non-unique",label:"Non-unique peptide",tooltip:"",shape:"rectangle",color:"#8585fc"},ANTIGEN:{name:"antigen",label:"Antibody binding sequences",tooltip:"",shape:"rectangle",color:"#996699"},PDBE_COVER:{name:"pdbe coverage",label:"PDBe 3D structure coverage",tooltip:"",shape:"rectangle",color:"#669966"}},F9=e=>{if(Bg[e.toUpperCase()])return Bg[e.toUpperCase()].shape;const t=Object.values(Bg).find(r=>r.name.toUpperCase()===e.toUpperCase());return t?t.shape:"rectangle"},L9=e=>{if(Bg[e.toUpperCase()])return Bg[e.toUpperCase()].color;const t=Object.values(Bg).find(r=>r.name.toUpperCase()===e.toUpperCase());return t||console.log(e),t?t.color:"black"};class Ev extends q_{getLayout(){return String(this.getAttribute("layout")).toLowerCase()==="non-overlapping"?new tPe({layoutHeight:this._height}):new y6({layoutHeight:this._height})}connectedCallback(){super.connectedCallback(),this._color=this.getAttribute("color"),this._shape=this.getAttribute("shape"),this._featureShape=new Z4e,this._layoutObj=this.getLayout(),this._data&&this._createTrack(),this.addEventListener("load",t=>{j3e(this.children,t.target)&&(this.data=t.detail.payload)})}static normalizeLocations(t){return t.map(r=>{const{locations:n,start:i,end:a}=r;return n?r:Object.assign(r,{locations:[{fragments:[{start:i,end:a}]}]})})}processData(t){this._originalData=Ev.normalizeLocations(t)}set data(t){this.processData(t),this._applyFilters(),this._layoutObj=this.getLayout(),this._createTrack()}set filters(t){this._filters=t,this._applyFilters(),this._createTrack()}static get observedAttributes(){return q_.observedAttributes.concat(["highlight","color","shape","filters"])}_getFeatureColor(t){return t.color?t.color:t.feature&&t.feature.color?t.feature.color:this._color?this._color:t.type?L9(t.type):t.feature&&t.feature.type?L9(t.feature.type):"black"}_getFeatureFillColor(t){return t.fill?t.fill:t.feature&&t.feature.fill?t.feature.fill:this._getFeatureColor(t)}_getShape(t){return t.shape?t.shape:t.feature&&t.feature.shape?t.feature.shape:this._shape?this._shape:t.type?F9(t.type):t.feature&&t.feature.type?F9(t.feature.type):"rectangle"}_createTrack(){this._layoutObj.init(this._data),Ui(this).selectAll("div").remove(),this.svg=Ui(this).append("div").style("line-height",0).append("svg").attr("width",this.width).attr("height",this._height),this.trackHighlighter.appendHighlightTo(this.svg),this.seq_g=this.svg.append("g").attr("class","sequence-features"),this._createFeatures()}_createFeatures(){this.featuresG=this.seq_g.selectAll("g.feature-group").data(this._data),this.locations=this.featuresG.enter().append("g").attr("class","feature-group").attr("id",n=>`g_${n.accession}`).selectAll("g.location-group").data(n=>n.locations.map(i=>Object.assign({},i,{feature:n}))).enter().append("g").attr("class","location-group");const t=this.locations.selectAll("g.fragment-group").data(n=>n.fragments.map(i=>Object.assign({},i,{feature:n.feature}))).enter().append("g").attr("class","fragment-group");t.append("path").attr("class",n=>`${this._getShape(n)} feature`).attr("d",n=>this._featureShape.getFeatureShape(this.getSingleBaseWidth(),this._layoutObj.getFeatureHeight(n),n.end?n.end-n.start+1:1,this._getShape(n))).attr("transform",n=>`translate(${this.getXFromSeqPosition(n.start)},${this._layoutObj.getFeatureYPos(n.feature)})`).attr("fill",n=>this._getFeatureFillColor(n)).attr("stroke",n=>this._getFeatureColor(n)).style("fill-opacity",({feature:n})=>n.opacity?n.opacity:.9).style("stroke-opacity",({feature:n})=>n.opacity?n.opacity:.9);const r=t.selectAll("g.residue-group").data(n=>{var i;return n.feature.ptms?[(i=n.feature.ptms)==null?void 0:i.map(a=>Object.assign({},a,{feature:n.feature,position:a.position}))]:[]}).enter().append("g").attr("class","residue-group");t.append("rect").attr("class","outer-rectangle feature").attr("width",n=>this.getSingleBaseWidth()*(n.end?n.end-n.start+1:1)).attr("height",n=>this._layoutObj.getFeatureHeight(n)).attr("transform",n=>`translate(${this.getXFromSeqPosition(n.start)},${this._layoutObj.getFeatureYPos(n.feature)})`).attr("fill","transparent").attr("stroke","transparent").call(this.bindEvents,this),r.selectAll("g.residue").data(n=>n).enter().append("path").attr("class",n=>`${this._getShape(n)} residue`).attr("d",n=>{let i=1;return this.length>500&&(i=this.getSingleBaseWidth()<4?4:1),this._featureShape.getFeatureShape(this.getSingleBaseWidth()/2,this._layoutObj.getFeatureHeight(),i,this._getShape(n))}).attr("transform",n=>`translate(${this.getXFromSeqPosition(Number(n.feature.start)+Number(n.position)-1)+this.getSingleBaseWidth()/4},
          ${this._layoutObj.getFeatureYPos(n.feature)})`).attr("fill","#06038D").style("fill-opacity",({feature:n})=>n.opacity?n.opacity:.9).style("stroke-opacity",({feature:n})=>n.opacity?n.opacity:.9).call(this.bindEvents,this)}_applyFilters(){if(!this._filters||this._filters.length<=0){this._data=this._originalData;return}const t=u0(this._filters,"category"),r=Object.values(t).map(i=>{const a=i.map(o=>o.filterFn(this._originalData));return eZ(...a)}),n=tZ(...r);this._data=n}refresh(){if(this.xScale&&this.seq_g){const t=this.seq_g.selectAll("g.fragment-group").data(this._data.reduce((n,i)=>n.concat(i.locations.reduce((a,o)=>a.concat(o.fragments.map(s=>Object.assign({},s,{feature:i}))),[])),[])),r=this.seq_g.selectAll("g.residue-group").data(this._data.reduce((n,i)=>{var a;return n.concat([(a=i.ptms)==null?void 0:a.reduce(o=>o.concat(s=>Object.assign({},s,{feature:i,position:s.position})),[])])},[]));t.selectAll("path.feature").attr("d",n=>this._featureShape.getFeatureShape(this.getSingleBaseWidth(),this._layoutObj.getFeatureHeight(n),n.end?n.end-n.start+1:1,this._getShape(n))).attr("transform",n=>`translate(${this.getXFromSeqPosition(n.start)},${this._layoutObj.getFeatureYPos(n.feature)})`),r.selectAll("path.residue").attr("d",n=>{let i=1;return this.length>500&&(i=this.getSingleBaseWidth()<4?4:1),this._featureShape.getFeatureShape(this.getSingleBaseWidth()/2,this._layoutObj.getFeatureHeight(n),i,this._getShape(n))}).attr("transform",n=>`translate(${this.getXFromSeqPosition(Number(n.feature.start)+Number(n.position)-1)+this.getSingleBaseWidth()/4},${this._layoutObj.getFeatureYPos(n.feature)})`),t.selectAll("rect.outer-rectangle").attr("width",n=>this.getSingleBaseWidth()*(n.end?n.end-n.start+1:1)).attr("height",n=>this._layoutObj.getFeatureHeight(n)).attr("transform",n=>`translate(${this.getXFromSeqPosition(n.start)},${this._layoutObj.getFeatureYPos(n.feature)})`),this._updateHighlight()}}_updateHighlight(){this.trackHighlighter.updateHighlight()}}const rPe=3;class H5 extends q_{connectedCallback(){super.connectedCallback(),this.sequence=this.getAttribute("sequence");const t=this.getAttribute("numberofticks");this.numberOfTicks=Number.isInteger(parseInt(t,10))?t:rPe,this.sequence&&this._createSequence(),this.addEventListener("load",r=>{this.data=r.detail.payload})}static get observedAttributes(){return q_.observedAttributes.concat("highlightstart","highlightend")}get data(){return this.sequence}set data(t){typeof t=="string"?this.sequence=t:"sequence"in t&&(this.sequence=t.sequence),this.sequence&&!super.svg?this._createSequence():this.refresh()}_getCharSize(){if(!this.seq_g)return;const t=.8,r=1.6,n=this.seq_g.select("text.base").node();if(n)this.chWidth=n.getBBox().width*t,this.chHeight=n.getBBox().height*r;else{const i=this.seq_g.append("text").attr("class","base").text("T");this.chWidth=i.node().getBBox().width*t,this.chHeight=i.node().getBBox().height*r,i.remove()}}_createSequence(){Ui(this).selectAll("div").remove(),super.svg=Ui(this).append("div").attr("class","").append("svg").attr("id","").attr("width",this.width).attr("height",this._height),this.seq_bg=super.svg.append("g").attr("class","background"),this.axis=super.svg.append("g").attr("class","x axis"),this.seq_g=super.svg.append("g").attr("class","sequence").attr("transform",`translate(0,${.75*this._height})`),this.trackHighlighter.appendHighlightTo(this.svg),this.refresh()}refresh(){if(this._getCharSize(),this.axis){const t=this.getSingleBaseWidth(),r=t-this.chWidth,n=t/2,i=Math.round(Math.max(0,this._displaystart-2)),a=Math.round(Math.min(this.sequence.length,this._displayend+1)),o=r<0?[]:this.sequence.slice(i,a).split("").map((s,u)=>({start:1+i+u,end:1+i+u,aa:s}));this.height>this.chHeight&&(this.xAxis=kK(this.xScale).tickFormat(s=>Number.isInteger(s)?s:"").ticks(this.numberOfTicks,"s"),this.axis.call(this.xAxis)),this.axis.attr("transform",`translate(${this.margin.left+n},0)`),this.axis.select(".domain").remove(),this.axis.selectAll(".tick line").remove(),this.bases=this.seq_g.selectAll("text.base").data(o,s=>s.start),this.bases.enter().append("text").attr("class","base").attr("text-anchor","middle").attr("x",s=>this.getXFromSeqPosition(s.start)+n).text(s=>s.aa).style("pointer-events","none").style("font-family","monospace"),this.bases.exit().remove(),this.bases.attr("x",s=>this.getXFromSeqPosition(s.start)+n),this.background=this.seq_bg.selectAll("rect.base_bg").data(o,s=>s.start),this.background.enter().append("rect").attr("class","base_bg feature").attr("height",this._height).merge(this.background).attr("width",t).attr("fill",s=>Math.round(s.start)%2?"#ccc":"#eee").attr("x",s=>this.getXFromSeqPosition(s.start)).call(this.bindEvents,this),this.background.exit().remove(),this.seq_g.style("opacity",Math.min(1,r)),this.background.style("opacity",Math.min(1,r)),this._updateHighlight()}}_updateHighlight(){this.trackHighlighter.updateHighlight()}}const nPe=-.31,iPe=-.56,aPe=-1.13,oPe=.07,sPe=-.23,uPe=.45,lPe=-1.85,cPe=.17,dPe=.14,fPe=-.01,hPe=.58,pPe=-.24,vPe=-.94,mPe=.17,gPe=.13,yPe=.42,bPe=-.07,xPe=.81,SPe=.01,CPe=.99,_Pe={I:nPe,L:iPe,F:aPe,V:oPe,M:sPe,P:uPe,W:lPe,H:cPe,T:dPe,E:fPe,Q:hPe,C:pPe,Y:vPe,A:mPe,S:gPe,N:yPe,D:bPe,R:xPe,G:SPe,K:CPe},wPe=-1.12,EPe=-1.25,APe=-1.71,PPe=-.46,TPe=-.67,IPe=.14,MPe=-2.09,DPe=.11,RPe=.25,kPe=.11,OPe=.77,FPe=-.02,LPe=-.71,NPe=.5,BPe=.46,UPe=.85,jPe=.43,zPe=1.15,VPe=3.63,HPe=3.64,GPe={I:wPe,L:EPe,F:APe,V:PPe,M:TPe,P:IPe,W:MPe,H:DPe,T:RPe,E:kPe,Q:OPe,C:FPe,Y:LPe,A:NPe,S:BPe,N:UPe,D:jPe,R:zPe,G:VPe,K:HPe},qPe=-.81,$Pe=-.69,WPe=-.58,XPe=-.53,YPe=-.44,KPe=-.31,QPe=-.24,ZPe=-.06,JPe=.11,eTe=1.61,tTe=.19,rTe=.22,nTe=.23,iTe=.33,aTe=.33,oTe=.43,sTe=2.41,uTe=1,lTe=1.14,cTe=1.81,dTe={I:qPe,L:$Pe,F:WPe,V:XPe,M:YPe,P:KPe,W:QPe,H:ZPe,T:JPe,E:eTe,Q:tTe,C:rTe,Y:nTe,A:iTe,S:aTe,N:oTe,D:sTe,R:uTe,G:lTe,K:cTe},fTe=6.04,hTe=6.04,pTe=5.91,vTe=6.02,mTe=5.74,gTe=6.3,yTe=5.88,bTe=7.64,xTe=5.6,STe=3.08,CTe=5.65,_Te=5.02,wTe=5.63,ETe=6.11,ATe=5.68,PTe=5.41,TTe=2.87,ITe=10.76,MTe=6.06,DTe=9.47,RTe={I:fTe,L:hTe,F:pTe,V:vTe,M:mTe,P:gTe,W:yTe,H:bTe,T:xTe,E:STe,Q:CTe,C:_Te,Y:wTe,A:ETe,S:ATe,N:PTe,D:TTe,R:ITe,G:MTe,K:DTe},kTe=["hydrophobicity-interface-scale","hydrophobicity-octanol-scale","hydrophobicity-scale","isoelectric-point-scale"],OTe={domain:[-2,2],range:["#ffdd00","#0000FF"]},EP=8;class FTe extends H5{static get observedAttributes(){return H5.observedAttributes.concat("scale","color_range")}_createSequence(){this.svg=Ui(this).append("div").attr("class","").append("svg").attr("id","").attr("width",this.width).attr("height",this._height),this.uniqueID=Math.random().toString(36).substring(7),this.gradient=this.svg.append("defs").append("linearGradient").attr("id",`scale-gradient-${this.uniqueID}`),this.seq_g=this.svg.append("g").attr("class","background"),this.seq_greadient=this.svg.append("rect").attr("class","seq-gradient").style("pointer-events","none"),this._getCharSize(),this.trackHighlighter.appendHighlightTo(this.svg),this.refresh()}getScaleFromAttribute(){let t=null;if(kTe.indexOf(this._scale)>=0)switch(this._scale){case"hydrophobicity-scale":return dTe;case"hydrophobicity-interface-scale":return _Pe;case"isoelectric-point-scale":return RTe;case"hydrophobicity-octanol-scale":return GPe;default:return null}if(/([ILFVMPWHTEQCYASNDRGK]:-?\d+\.?\d*)(,[ILFVMPWHTEQCYASNDRGK]:-?\d+\.?\d*)*/.test(this._scale))try{t=twe(this._scale,{keyFormatter:r=>r.toUpperCase(),valueFormatter:r=>parseFloat(r)})}catch(r){console.error(`Couldn't parse the given scale ${this._scale}`,r)}return t}refresh(){if(this.seq_g){const t=this.getScaleFromAttribute();if(t===null){console.error("The attribute scale is not valid.");return}const r=F0();this.colorScale=OTe,this._color_range&&(this.colorScale=ewe(this._color_range)),r.domain(this.colorScale.domain).range(this.colorScale.range);const n=this.getSingleBaseWidth(),i=Math.round(Math.max(0,this._displaystart-2)),a=Math.round(Math.min(this.sequence.length,this._displayend+1)),o=this.sequence.slice(i,a).split("").map((u,l)=>{const c=u.toUpperCase()in t?t[u.toUpperCase()]:0;return{start:1+i+l,end:1+i+l,aa:u,value:c,colour:r(c)}});this.residues=this.seq_g.selectAll("rect.base_bg").data(n<EP?[]:o,u=>u.start),this.residues.enter().append("rect").attr("class","base_bg feature").attr("data-base",({aa:u})=>u).attr("data-pos",({start:u})=>u).attr("height",this._height).merge(this.residues).attr("width",n).attr("fill",({colour:u})=>u).attr("x",({start:u})=>this.getXFromSeqPosition(u)).call(this.bindEvents,this),this.residues.exit().remove();const s=this.gradient.selectAll("stop").data(this.sequence.split(""));s.enter().append("stop").merge(s).attr("offset",(u,l)=>(l+.5)/this.sequence.length).attr("stop-color",u=>r(u.toUpperCase()in t?t[u.toUpperCase()]:0)),this.gradient.exit().remove(),this.seq_greadient.attr("x",this.getXFromSeqPosition(1)).attr("y",0).attr("height",this._height).attr("width",this.getXFromSeqPosition(this.sequence.length)-this.getXFromSeqPosition(0)).style("opacity",n<EP?1:EP/n).attr("fill",`url(#scale-gradient-${this.uniqueID})`),this._updateHighlight()}}}const N9=16,LTe=14,kx=10;class O1 extends y6{init(t,r){let n=0;if(this.height={},this.yPos={},this.maxYPos=0,!t)return;this.innerPadding=(N9-kx)/2;const i={};for(let a=0;a<t.length;a++){const o=t[a];this.height[o.accession]=this.expanded?LTe:N9,this.yPos[o.accession]=this._padding,n=this.height[o.accession]+2*this._padding,this.maxYPos=Math.max(this.maxYPos,n),o.accession in i||(i[o.accession]={}),o.residues&&(n=this._initResidues(o.residues,o.accession,o.locations,this.expanded?n:this.yPos[o.accession],a,i,this.expanded))}if(r)for(let a=0;a<r.length;a++){const o=r[a];o.accession in this.height||(this.height[o.accession]=kx,this.yPos[o.accession]=(this.expanded?this.maxYPos:this.innerPadding)+this._padding,n+=2*this._padding+(this.expanded?this.height[o.accession]:0),this.maxYPos=Math.max(this.maxYPos,n)),o.accession in i||(i[o.accession]={}),o.residues&&(n=this._initResidues(o.residues,o.accession,o.locations,o.expanded?n:this.yPos[o.accession],a,i,o.expanded))}this.maxYPos+=this._padding}_initResidues(t,r,n,i,a,o={},s=!0){for(let u=0;u<t.length;u++){const l=t[u];O1._filterOutResidueFragmentsOutOfLocation(l,n),l.accession in o[r]||(o[r][l.accession]={});for(let c=0;c<l.locations.length;c++){const d=l.locations[c].description;d in o[r][l.accession]||(o[r][l.accession][d]={height:s?kx:this.height[r]-2*this.innerPadding,yPos:s?this.maxYPos+this._padding:i+this.innerPadding},i=s?this.maxYPos+2*this._padding+kx:i),this.height[`${l.accession}_${a}_${u}_${c}`]=o[r][l.accession][d].height,this.yPos[`${l.accession}_${a}_${u}_${c}`]=o[r][l.accession][d].yPos,this.maxYPos=Math.max(this.maxYPos,i)}}return s?i:this.maxYPos+2*this._padding}static _filterOutResidueFragmentsOutOfLocation(t,r){t.locations.forEach(n=>n.fragments=n.fragments.filter(i=>r.some(a=>a.fragments.some(o=>i.start>=o.start&&i.end<=o.end)))),t.locations=t.locations.filter(n=>n.fragments.length)}static _getAccFromFeature(t){let r="";return typeof t=="string"?r=t:t.accession&&(r=t.accession),r}getFeatureYPos(t){const r=O1._getAccFromFeature(t);return r in this.yPos?this.yPos[r]:0}getFeatureHeight(t){const r=O1._getAccFromFeature(t);return r in this.height?this.height[r]:0}}const B9=(e,t)=>{let r={value:1,...e};const n=[];for(const i of t)r?r.end<i.start?(n.push(r),r=null,n.push(i)):r.start<i.start&&r.end>=i.end?(n.push({start:r.start,end:i.start-1,value:r.value}),n.push({start:i.start,end:i.end,value:i.value+r.value}),r=i.end===r.end?null:{start:i.end+1,end:r.end,value:r.value}):i.start<r.start&&i.end>r.end?(n.push({start:i.start,end:r.start-1,value:i.value}),n.push({start:r.start,end:r.end,value:i.value+r.value}),n.push({start:r.end+1,end:i.end,value:i.value}),r=null):i.end>=r.start&&i.end<=r.end?(i.start<r.start&&n.push({start:i.start,end:r.start-1,value:i.value}),n.push({start:r.start,end:i.end,value:i.value+r.value}),r=i.end<r.end?{start:i.end+1,end:r.end,value:r.value}:null):r.end>=i.start&&r.end<i.end?(n.push({start:r.start,end:i.start-1,value:r.value}),n.push({start:i.start,end:r.end,value:i.value+r.value}),n.push({start:r.end+1,end:i.end,value:i.value}),r=null):n.push(i):n.push(i);return r&&n.push(r),n},NTe=(e,t=100,r=!0)=>{let n=[];return r&&(n=B9({start:1,end:t,value:0},n)),e.forEach(i=>i.locations.forEach(a=>a.fragments.forEach(o=>{n=B9(o,n)}))),n},Ay={top:2,right:10,bottom:2,left:10},U9=.8,j9=.3,BTe=e=>(e+j9)/(1+j9);class F1 extends Ev{_createTrack(){this._layoutObj.expanded=this._expanded,super._createTrack(),this.children_g=null}connectedCallback(){super.connectedCallback(),this._expanded=this.hasAttribute("expanded"),this._haveCreatedFeatures=!1}attributeChangedCallback(t,r,n){if(t==="expanded"&&r!==n&&this._contributors)for(const i of this._contributors)i.expanded=!r;super.attributeChangedCallback(t,r,n)}set contributors(t){this._contributors=F1.normalizeLocations(t),this._coverage=NTe(this._contributors,this._length),this._data&&this._createTrack()}getLayout(){return new O1({layoutHeight:this._height,expanded:this._expanded,padding:2})}static get observedAttributes(){return Ev.observedAttributes.concat(["expanded","color"])}set color(t){this._color!==t&&(this._color=t,this.refresh())}static _createResidueGroup(t){return t.selectAll("g.residues-group").data(r=>r.residues?r.residues.map((n,i)=>({...n,feature:r,i})):[]).enter().append("g").attr("class","residues-group").selectAll("g.residues-locations").data(r=>r.locations.map((n,i)=>({...n,accession:r.accession,feature:r.feature,location:n,i:r.i,j:i}))).enter().append("g").attr("class","residues-locations")}_createResiduePaths(t){return t.selectAll("g.residue").data(r=>r.fragments.map(n=>({...n,accession:r.accession,feature:{...r.feature,currentResidue:{...n,description:r.location.description}},location:r.location,k:r.feature.k,i:r.i,j:r.j}))).enter().append("path").attr("class","feature rectangle residue").attr("d",r=>this._featureShape.getFeatureShape(this.getSingleBaseWidth(),this._layoutObj.getFeatureHeight(`${r.accession}_${r.k}_${r.i}_${r.j}`),r.end?r.end-r.start+1:1,"rectangle")).attr("transform",r=>`translate(${this.getXFromSeqPosition(r.start)},${Ay.top+this._layoutObj.getFeatureYPos(`${r.accession}_${r.k}_${r.i}_${r.j}`)})`).attr("fill",r=>this._getFeatureColor(r)).attr("stroke","transparent").call(this.bindEvents,this)}_refreshResiduePaths(t,r){const n=new Set(t.data().map(i=>`${i.feature.accession}-${i.location.description}`)).size;t.attr("d",i=>this._featureShape.getFeatureShape(this.getSingleBaseWidth(),this._layoutObj.getFeatureHeight(`${i.accession}_${i.k}_${i.i}_${i.j}`),i.end?i.end-i.start+1:1,"rectangle")).attr("transform",i=>`translate(${this.getXFromSeqPosition(i.start)},${Ay.top+this._layoutObj.getFeatureYPos(`${i.accession}_${i.k}_${i.i}_${i.j}`)})`).style("pointer-events",i=>r||i.feature&&i.feature.expanded?"auto":"none").style("stroke",()=>r?null:"none").style("opacity",()=>r?null:U9/n).attr("fill",i=>r||i.feature&&i.feature.expanded?this._getFeatureColor(i):"white")}_createFeatures(){if(this._layoutObj.init(this._data,this._contributors),this._data.forEach((t,r)=>t.k=r),this.featuresG=this.seq_g.selectAll("g.feature-group").data(this._data).enter().append("g").attr("class","feature-group").attr("id",t=>`g_${t.accession}`),this.locations=this.featuresG.selectAll("g.location-group").data(t=>t.locations.map(r=>({...r,feature:t}))).enter().append("g").attr("class","location-group"),this.coverLines=this.locations.selectAll("line.cover").data(t=>[t.fragments.reduce((r,n)=>({start:Math.min(r.start,n.start),end:Math.max(r.end,n.end),feature:t.feature}),{start:1/0,end:-1/0})]).enter().append("line").attr("class","cover"),this.features=this.locations.selectAll("path.feature").data(t=>t.fragments.map(r=>({...r,feature:t.feature,fragments:t.fragments}))).enter().append("path").attr("class",t=>`${this._getShape(t)} feature`).on("click.expanded",()=>{this._expanded?this.removeAttribute("expanded"):this.setAttribute("expanded","expanded")}).call(this.bindEvents,this),this.residues_g=F1._createResidueGroup(this.featuresG),this.residues_loc=this._createResiduePaths(this.residues_g),this._contributors){this._contributors.forEach((r,n)=>r.k=n),this.children_g||(this.children_g=this.svg.append("g").attr("class","children-features")),this.childrenGroup=this.children_g.append("g").attr("class","children-group"),this.childGroup=this.childrenGroup.selectAll("g.child-group").data(this._contributors).enter().append("g").attr("class","child-group");const t=this.childGroup.selectAll("g.child-location-group").data(r=>(r.expanded=this._expanded,r.locations.map(n=>({...n,feature:r})))).enter().append("g").attr("class",(r,n)=>`child-location-group clg-${n}`);this.coverLinesChildren=t.selectAll("line.cover").data(r=>[r.fragments.reduce((n,i)=>({start:Math.min(n.start,i.start),end:Math.max(n.end,i.end),feature:r.feature}),{start:1/0,end:-1/0})]).enter().append("line").attr("class","cover"),this.featureChildren=t.selectAll("path.child-fragment").data(r=>r.fragments.map(n=>({...n,feature:r.feature,fragments:r.fragments}))).enter().append("path").attr("class",r=>`${this._getShape(r)} child-fragment feature`).call(this.bindEvents,this).on("click.expanded",r=>{r.feature.expanded=!r.feature.expanded,this.refresh()}),this.child_residues_g=F1._createResidueGroup(this.childGroup),this.child_residues_loc=this._createResiduePaths(this.child_residues_g),this._coverage&&this._coverage.length&&this._createCoverage()}this.svg.attr("height",this._layoutObj.maxYPos),this._haveCreatedFeatures=!0}_createCoverage(){this._accession=this._data&&this._data[0]&&this._data[0].accession||"_",this.coverage_mask=this.svg.append("defs").append("mask").attr("id",`mask-${this._accession}`),this.coverageMaskFragment=this.coverage_mask.selectAll("rect").data(this._coverage).enter().append("rect").attr("y",0).attr("height",this._height)}_refreshCoverage(){this.featuresG.attr("mask",this._expanded?null:`url(#mask-${this._accession})`),this.coverageMaskFragment.attr("x",t=>this.getXFromSeqPosition(t.start)).attr("width",t=>this.getSingleBaseWidth()*(t.end-t.start+1)).attr("fill","white").attr("opacity",t=>BTe(t.value/this._contributors.length))}_refreshFeatures(t,r=!0){const n=new Set(t.data().map(i=>i.feature.accession)).size;t.attr("d",i=>this._featureShape.getFeatureShape(this.getSingleBaseWidth(),this._layoutObj.getFeatureHeight(i.feature),i.end?i.end-i.start+1:1,r?this._getShape(i.shape?i:i.feature):"rectangle")).attr("fill",i=>r?this._getFeatureColor(i.feature):"white").attr("opacity",r?1:U9/n).style("stroke",i=>r?this._getFeatureColor(i.feature):"none").attr("transform",i=>`translate(${this.getXFromSeqPosition(i.start)},${Ay.top+this._layoutObj.getFeatureYPos(i.feature)})`).style("pointer-events",r?"auto":"none")}_refreshCoverLine(t,r=!0){t.attr("x1",n=>this.getXFromSeqPosition(n.start)).attr("x2",n=>this.getXFromSeqPosition(n.end+1)).attr("y1",n=>Ay.top+this._layoutObj.getFeatureYPos(n.feature)+this._layoutObj.getFeatureHeight(n.feature)/2).attr("y2",n=>Ay.top+this._layoutObj.getFeatureYPos(n.feature)+this._layoutObj.getFeatureHeight(n.feature)/2).attr("stroke",n=>this._getFeatureColor(n.feature)).attr("visibility",r?"visible":"hidden")}refresh(){this._haveCreatedFeatures&&(this._layoutObj.expanded=this._expanded,this._layoutObj.init(this._data,this._contributors),this.height=this._layoutObj.maxYPos,this._refreshCoverLine(this.coverLines),this._refreshFeatures(this.features),this._refreshResiduePaths(this.residues_loc,this._expanded),this._contributors&&(this.childrenGroup.attr("visibility",this._expanded?"visible":"hidden"),this._refreshCoverLine(this.coverLinesChildren,this._expanded),this._refreshFeatures(this.featureChildren,this._expanded),this.child_residues_g.attr("visibility",()=>this._expanded?"visible":"hidden"),this._refreshResiduePaths(this.child_residues_loc),this._coverage&&this._coverage.length&&this._refreshCoverage()),this._updateHighlight(),this.svg.attr("height",this._layoutObj.maxYPos))}}function UTe(e){const{variants:t,sequence:r}=e;if(!r||!t)return null;const i=r.split("").map((a,o)=>({type:"VARIANT",normal:a,pos:o+1,variants:[]}));return t.forEach(a=>{i[a.start-1]&&i[a.start-1].variants.push(a)}),i}class jTe{constructor(){this._frequency=SQ().exponent(.001).domain([0,1]).range([5,10]),this.drawVariationPlot=this.drawVariationPlot.bind(this)}drawVariationPlot(t,r){const i=r.getSingleBaseWidth()/2;t.each((a,o,s)=>{const u=Ui(s[o]),l=a.filter(f=>f.variants.length!==0),c=u.selectAll("g").data(l,f=>f.pos);c.exit().remove();const d=c.enter().append("g").merge(c).selectAll("circle").data(f=>f.variants);d.exit().remove(),d.enter().append("circle").merge(d).attr("class","feature").attr("title",f=>f.start).attr("r",f=>f.size?f.size:5).attr("cx",f=>r.getXFromSeqPosition(f.start)+i).attr("cy",f=>r._yScale(f.variant.charAt(0))).attr("name",f=>{const h=f.alternativeSequence==="*"?"STOP":f.alternativeSequence;return f.internalId=`var_${f.wildType}${f.start}${h}`,f.internalId}).attr("fill",f=>f.color?f.color:r._colorConfig(f)).call(r.bindEvents,r)})}}const zTe=["G","A","V","L","I","S","T","C","M","D","N","E","Q","R","K","H","F","Y","W","P","d","*"],z9=(e,t)=>{if(!e||e.length<=0)return null;const r=e[0];return r.forEach((n,i)=>{const a=e.map(o=>o[i].variants);n.variants=t(...a)}),r};class b6 extends Ev{connectedCallback(){super.connectedCallback();const t=document.createElement("style");t.innerHTML=b6.css,this.appendChild(t),this._height=Number(this.getAttribute("height"))?Number(this.getAttribute("height")):430,this._width=this._width?this._width:0,this._yScale=F0(),this._yScale=l_e().domain(zTe).range([0,this._height-this.margin.top-this.margin.bottom])}processData(t){this._originalData=UTe(t)}static get css(){return`
    <style>
    protvista-variation {
      display: flex;
      width: 100%;
    }
    
    protvista-variation svg {
      background-color: #fff;
    }
    
    protvista-variation circle {
      opacity: 0.6;
    }
    protvista-variation circle:hover {
      opacity: 0.9;
    }
    protvista-variation .tick line,
    protvista-variation .axis path {
      opacity: 0.1;
    }
    
    .protvista-highlight {
      fill: #ffe999;
    }
    
    protvista-variation .variation-y-right line,
    protvista-variation .axis path {
      fill: none;
      stroke: none;
    }
    
    </style>
    `}_createFeatures(){this._variationPlot=new jTe;const t=super.svg.select("g.sequence-features"),r=t.attr("transform",`translate(0, ${this.margin.top})`).append("g");this._series=r.datum(this._data),this._axisLeft=t.append("g"),this._axisRight=t.append("g"),this.updateScale()}set filters(t){super.filters=t,this.updateData(this._data),this.refresh()}_applyFilters(){if(!this._filters||this._filters.length<=0){this._data=this._originalData;return}const t=u0(this._filters,"category"),r=Object.values(t).map(n=>{const i=n.map(a=>a.filterFn(this._originalData));return z9(i,eZ)});this._data=z9(r,tZ)}set colorConfig(t){this._colorConfig=t}get colorConfig(){return this._colorConfig}refresh(){this._series&&(this.updateScale(),this._series.call(this._variationPlot.drawVariationPlot,this),this._updateHighlight())}updateScale(){this._yAxisLScale=R2e().scale(this._yScale).tickSize(-this.getWidthWithMargins()),this._yAxisRScale=D2e().scale(this._yScale),this._axisLeft.attr("class","variation-y-left axis").attr("transform",`translate(${this.margin.left},0)`).call(this._yAxisLScale),this._axisRight.attr("transform",`translate(${this.getWidthWithMargins()-this.margin.right+2}, 0)`).attr("class","variation-y-right axis").call(this._yAxisRScale)}updateData(t){this._series&&this._series.datum(t)}}class VTe extends Ev{constructor(){super(),this._line=C_e().x((t,r)=>this.getXFromSeqPosition(r+1)-this.getSingleBaseWidth()/2).y(t=>this._yScale(t))}init(){this._totalsArray={total:null,diseaseTotal:null}}connectedCallback(){super.connectedCallback(),this._data=void 0,this._height=Number(this.getAttribute("height"))||40,this._yScale=F0(),this.init()}set data(t){if(this.init(),!(!t.sequence||t.variants.length<=0)){this._totalsArray.total=new Uint8ClampedArray(t.sequence.length),this._totalsArray.diseaseTotal=new Uint8ClampedArray(t.sequence.length);for(const{start:r,association:n}of t.variants){const i=+r;if(i<1||i>t.sequence.length||(this._totalsArray.total[i]++,!n))continue;n.find(o=>o.disease===!0)&&this._totalsArray.diseaseTotal[i]++}this._createTrack()}}_createTrack(){Ui(this).selectAll("svg").remove(),this.svg=Ui(this).append("svg").attr("width",this.width).attr("height",this._height),this.trackHighlighter.appendHighlightTo(this.svg),this._initYScale(),this.refresh()}_initYScale(){this._yScale.domain([0,Math.max(v7(this._totalsArray.total),v7(this._totalsArray.diseaseTotal))]).range([this._height,0])}refresh(){this.svg&&(this.svg.selectAll("path").remove(),this.svg.append("path").attr("d",this._line(this._totalsArray.diseaseTotal)).attr("fill","none").attr("stroke","red").attr("transform","translate(0,0)"),this.svg.append("path").attr("d",this._line(this._totalsArray.total)).attr("fill","none").attr("stroke","darkgrey").attr("transform","translate(0,0)"),this._updateHighlight())}}class HTe extends Hh{static get properties(){return{filters:{type:Array},selectedFilters:{type:Set},for:{type:String}}}constructor(){super(),this.filters=[],this.selectedFilters=new Set}connectedCallback(){super.connectedCallback(),this.addEventListener("filterChange",this._onFilterChange),this.closest("protvista-manager")&&(this.manager=this.closest("protvista-manager"),this.manager.register(this))}disconnectedCallback(){super.disconnectedCallback(),this.manager&&this.manager.unregister(this),this.removeEventListener("filterChange",this._onFilterChange)}static get styles(){return nu`
      :host {
        font-size: 0.8rem;
      }

      :host[disabled] {
        opacity: 0.5;
      }

      .protvista_checkbox {
        position: relative;
        cursor: pointer;
        box-sizing: border-box;
        display: flex;
        align-items: center;
        margin-top: 10px;
        line-height: 24px;
        outline: none;
      }

      .protvista_checkbox_input {
        position: absolute;
        opacity: 0;
        cursor: pointer;
        height: 0;
        width: 0;
      }

      .checkmark {
        opacity: 0.4;
        height: 25px;
        width: 25px;
        background-color: #eee;
        border-radius: 4px;
        box-sizing: border-box;
        border: 1px solid #bdc3c7;
      }

      .protvista_checkbox_input:checked ~ .checkmark {
        opacity: 1;
      }

      .protvista_checkbox_label {
        margin-left: 0.2rem;
        line-height: 1rem;
      }
    `}render(){const t=u0(this.filters,r=>r.type.text);return zr`
      ${Object.keys(t).map(r=>zr`
            <h4>${r}</h4>
            <div>
              ${t[r].map(n=>zr`
                    ${this.getCheckBox(n)}
                  `)}
            </div>
          `)}
    `}getCheckBox(t){const{name:r,options:n}=t,{labels:i}=n;n.colors.length==null&&(n.colors=[n.colors]);const a=n.colors.length>1;return zr`
      <label
        class="protvista_checkbox ${a?"compound":""}"
        tabindex="0"
      >
        <input
          type="checkbox"
          class="protvista_checkbox_input"
          ?checked="true"
          .value="${r}"
          @change="${()=>this.toggleFilter(r)}"
        />
        <span
          class="checkmark"
          style=${`background: ${a?`
            linear-gradient(${n.colors[0]},
            ${n.colors[1]})
          `:n.colors[0]};`}
        ></span>
        <span class="protvista_checkbox_label">
          ${i.join("/")}
        </span>
      </label>
    `}toggleFilter(t){this.selectedFilters.has(t)?this.selectedFilters.delete(t):this.selectedFilters.add(t),this.dispatchEvent(new CustomEvent("change",{bubbles:!0,composed:!0,detail:{type:"filters",handler:"property",for:this.for,value:this.filters.filter(r=>this.selectedFilters.has(r.name)).map(r=>({category:r.type.name,filterFn:r.filterData}))}}))}}const Ox="length",Fx="displaystart",Lx="displayend",Nx="highlight";class $_ extends HTMLElement{constructor(){super(),this.protvistaElements=new Set,this.attributeValues=new Map,this.propertyValues=new Map,this.mouseOver=!1}static get observedAttributes(){return["attributes",Ox,Fx,Lx,Nx]}set length(t){this.attributeValues.set(Ox,t)}get length(){return this.attributeValues.get(Ox)}set displaystart(t){this.attributeValues.set(Fx,t)}get displaystart(){return this.attributeValues.get(Fx)}set displayend(t){this.attributeValues.set(Lx,t)}get displayend(){return this.attributeValues.get(Lx)}set highlight(t){this.attributeValues.set(Nx,t)}get highlight(){return this.attributeValues.get(Nx)}attributeChangedCallback(t,r,n){if(r!==n){if(t==="attributes"){if(this._attributes=n.split(" "),this._attributes.indexOf("type")!==-1)throw new Error("'type' can't be used as a protvista attribute");if(this._attributes.indexOf("value")!==-1)throw new Error("'value' can't be used as a protvista attribute");this.attributeValues=new Map(this._attributes.filter(i=>!$_.observedAttributes.includes(i)).map(i=>[i,null]))}else t===Ox&&(this.length=n),t===Fx&&(this.displaystart=n),t===Lx&&(this.displayend=n),t===Nx&&(this.highlight=n);this.applyAttributes()}}register(t){this.protvistaElements.add(t),this.applyAttributes()}unregister(t){this.protvistaElements.delete(t)}_polyfillElementClosest(){Element.prototype.matches||(Element.prototype.matches=Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector),Element.prototype.closest||(Element.prototype.closest=t=>{let r=this;do{if(r.matches(t))return r;r=r.parentElement||r.parentNode}while(r!==null&&r.nodeType===1);return null})}applyAttributes(){this.protvistaElements.forEach(t=>{this.attributeValues.forEach((r,n)=>{r===!1||r===null||r===void 0?t.removeAttribute(n):t.setAttribute(n,typeof r=="boolean"?"":r)})})}applyProperties(t){if(t){const r=this.querySelector(`#${t}`);this.propertyValues.forEach((n,i)=>{r[i]=n})}else this.protvistaElements.forEach(r=>{this.propertyValues.forEach((n,i)=>{r[i]=n})})}isRegisteredAttribute(t){return[...this.attributeValues.keys()].includes(t)||$_.observedAttributes.includes(t)}_changeListener(t){if(t.detail)switch(t.detail.handler){case"property":this.propertyValues.set(t.detail.type,t.detail.value),this.applyProperties(t.detail.for);break;default:this.isRegisteredAttribute(t.detail.type)&&this.attributeValues.set(t.detail.type,t.detail.value),Object.keys(t.detail).forEach(r=>{this.isRegisteredAttribute(r)&&this.attributeValues.set(r,t.detail[r])}),this.applyAttributes()}}connectedCallback(){this.addEventListener("change",this._changeListener)}}var GTe=globalThis&&globalThis.__awaiter||function(e,t,r,n){function i(a){return a instanceof r?a:new r(function(o){o(a)})}return new(r||(r=Promise))(function(a,o){function s(c){try{l(n.next(c))}catch(d){o(d)}}function u(c){try{l(n.throw(c))}catch(d){o(d)}}function l(c){c.done?a(c.value):i(c.value).then(s,u)}l((n=n.apply(e,t||[])).next())})};const AP=new Map,sZ=(e,t=new Headers({accept:"application/json"}))=>{const r=AP.get(e);if(r)return r;const n=(()=>GTe(void 0,void 0,void 0,function*(){const i=yield window.fetch(e,{headers:t});if(!i.ok)throw new Error(`Request Failed: Status = ${i.status}; URI = ${e}; Time = ${new Date}`);return i.status===204?{payload:null,headers:i.headers}:{payload:yield i.json(),headers:i.headers}}))();return AP.set(e,n),n.catch(()=>AP.delete(e)),n};var Bx,qTe=new Uint8Array(16);function $Te(){if(!Bx&&(Bx=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto<"u"&&typeof msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto),!Bx))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Bx(qTe)}const WTe=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function XTe(e){return typeof e=="string"&&WTe.test(e)}var ma=[];for(var PP=0;PP<256;++PP)ma.push((PP+256).toString(16).substr(1));function YTe(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=(ma[e[t+0]]+ma[e[t+1]]+ma[e[t+2]]+ma[e[t+3]]+"-"+ma[e[t+4]]+ma[e[t+5]]+"-"+ma[e[t+6]]+ma[e[t+7]]+"-"+ma[e[t+8]]+ma[e[t+9]]+"-"+ma[e[t+10]]+ma[e[t+11]]+ma[e[t+12]]+ma[e[t+13]]+ma[e[t+14]]+ma[e[t+15]]).toLowerCase();if(!XTe(r))throw TypeError("Stringified UUID is invalid");return r}var V9,TP,IP=0,MP=0;function TE(e,t,r){var n=t&&r||0,i=t||new Array(16);e=e||{};var a=e.node||V9,o=e.clockseq!==void 0?e.clockseq:TP;if(a==null||o==null){var s=e.random||(e.rng||$Te)();a==null&&(a=V9=[s[0]|1,s[1],s[2],s[3],s[4],s[5]]),o==null&&(o=TP=(s[6]<<8|s[7])&16383)}var u=e.msecs!==void 0?e.msecs:Date.now(),l=e.nsecs!==void 0?e.nsecs:MP+1,c=u-IP+(l-MP)/1e4;if(c<0&&e.clockseq===void 0&&(o=o+1&16383),(c<0||u>IP)&&e.nsecs===void 0&&(l=0),l>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");IP=u,MP=l,TP=o,u+=122192928e5;var d=((u&268435455)*1e4+l)%4294967296;i[n++]=d>>>24&255,i[n++]=d>>>16&255,i[n++]=d>>>8&255,i[n++]=d&255;var f=u/4294967296*1e4&268435455;i[n++]=f>>>8&255,i[n++]=f&255,i[n++]=f>>>24&15|16,i[n++]=f>>>16&255,i[n++]=o>>>8|128,i[n++]=o&255;for(var h=0;h<6;++h)i[n+h]=a[h];return t||YTe(i)}const KTe=[{name:"ECO:0000269",description:"Manual assertion based on experiment",shortDescription:"Publication",acronym:"EXP",isManual:!0},{name:"ECO:0000303",description:"Manual assertion based on opinion",shortDescription:"Publication",acronym:"NAS",isManual:!0},{name:"ECO:0000305",description:"Manual assertion inferred by curator",shortDescription:"Curated",acronym:"IC",isManual:!0},{name:"ECO:0000250",description:"Manual assertion inferred from sequence similarity",shortDescription:"By similarity",acronym:"ISS",isManual:!0},{name:"ECO:0000255",description:"Manual assertion according to rules",shortDescription:"Sequence Analysis",acronym:"ISM",isManual:!0},{name:"ECO:0007744",description:"Manual assertion inferred from combination of experimental and computational evidence",shortDescription:"Combined sources",acronym:"MIXM",isManual:!0},{name:"ECO:0000312",description:"Manual assertion inferred from database entries",shortDescription:"Imported",acronym:"MI",isManual:!0},{name:"ECO:0000256",description:"Automatic assertion according to rules",shortDescription:"Automatic annotation",acronym:"AA"},{name:"ECO:0000259",description:"Automatic assertion inferred from signature match",shortDescription:"Automatic annotation",acronym:"AA"},{name:"ECO:0007829",description:"Automatic assertion inferred from combination of experimental and computational evidence",shortDescription:"Combined sources",acronym:"MIXA"},{name:"ECO:0000213",description:"Automatic assertion inferred from combination of experimental and computational evidence",shortDescription:"Combined sources",acronym:"MIXA"},{name:"ECO:0000244",description:"Manual assertion inferred from combination of experimental and computational evidence",shortDescription:"Combined sources",acronym:"MIXM",isManual:!0},{name:"ECO:0000313",description:"Automatic assertion inferred from database entries",shortDescription:"Imported",acronym:"AI"},{name:"ECO:0000260",description:"Manual assertion inferred from signature match",shortDescription:"InterPro annotation",acronym:"SGNM",isManual:!0}],uZ=e=>e.map(t=>{const r={};return t.begin&&(r.start=t.begin),{...t,...r}}),QTe=e=>{var t;return((t=e.name)==null?void 0:t.toLowerCase())==="PubMed".toLowerCase()?`${e.id}&nbsp;(<a href='${e.url}' style="color:#FFF" target='_blank'>${e.name}</a>&nbsp;<a href='${e.alternativeUrl}' style="color:#FFF" target='_blank'>EuropePMC</a>)`:`&nbsp;<a href='${e.url}' style="color:#FFF" target='_blank'>${e.id}</a>&nbsp;${e.name?`(${e.name})`:""}`},lZ=e=>e?`
      <ul>${e.map(t=>{const r=KTe.find(n=>n.name===t.code);return r?`<li title='${r.description}' style="padding: .25rem 0">${r.shortDescription}:&nbsp;${t.source?QTe(t.source):""}</li>`:""}).join("")}</ul>
    `:"",cZ=e=>`<ul>${e.map(t=>`<li style="padding: .25rem 0">${t.name} ${t.url?`<a href="${t.url}" style="color:#FFF" target="_blank">${t.id}</a>`:`${t.name} ${t.id}`}</li>`).join("")}</ul>`,ZTe=e=>{if(!e)return"";const t=e.flatMap(({dbReferences:i})=>i.map(a=>a.id)),r=[...new Set(t.flat())],n="https://www.ebi.ac.uk/pride/archive/projects/";return`
  <ul>${r.map(i=>{const a=i==="Glue project"?"PXD012174":i;return`<li title='${a}' style="padding: .25rem 0">${a}&nbsp;(<a href="${n}${a}" style="color:#FFF" target="_blank">PRIDE</a>
      ${i==="Glue project"?')</li><li title="publication" style="padding: .25rem 0">Publication:&nbsp;31819260&nbsp;(<a href="https://pubmed.ncbi.nlm.nih.gov/31819260" style="color:#FFF" target="_blank">PubMed</a>)</li>':'&nbsp;<a href="http://www.peptideatlas.org/builds/rice/phospho/" style="color:#FFF" target="_blank">PeptideAtlas</a>)</li>'}`}).join("")}</ul>
`},JTe=(e,t)=>{if(!t)return"";const r=t.map(a=>({name:a.name,position:a.position}));let n="",i=0;return r.forEach(a=>{n=`${n}${e.slice(i,a.position)}[${a.name}]`,i=a.position}),n=`${n}${e.slice(i)}`,`<p>${n}</p>`},eIe={A:"alanine",S:"serine",T:"threonine",Y:"tyrosine"},H9=(e,t)=>{const{peptide:r,begin:n}=e,i=Number(n)+t.position-1,a=r.charAt(t.position-1);return`${i} phospho${eIe[a]}`},dZ=e=>{const t=e.type==="PROTEOMICS_PTM"?ZTe(e.ptms):lZ(e.evidences),r=e.type==="PROTEOMICS_PTM"&&e.ptms.map(a=>H9(e,a)),n=e.type==="PROTEOMICS_PTM"&&e.ptms.flatMap(({dbReferences:a})=>a.map(o=>o.id));let{description:i}=e;if(e.type==="BINDING"||e.type==="Binding site"){let a="";e.ligandPart&&(a+=`${e.ligandPart.name} of `),e.ligand&&(a+=e.ligand.name),e.description&&(a+=`; ${e.description}`),i=a}try{return`
      ${i?`<h5>Description</h5><p>${i}</p>`:""}
      ${e.matchScore?`<h5>Match score</h5><p>${e.matchScore}%</p>`:""}
      ${e.ftId?`<h5>Feature ID</h5><p>${e.ftId}</p>`:""}
      ${e.alternativeSequence?`<h5>Alternative sequence</h5><p>${e.alternativeSequence}</p>`:""}
      ${r?`<h5 data-article-id="ptm_processing_section">PTMs</h5><ul>${r.map(a=>`<li>${a}</li>`).join("")}</ul>
            `:""}
      ${e.peptide&&e.type==="PROTEOMICS_PTM"?`<h5 data-article-id="mod_res_large_scale#what-is-the-goldsilverbronze-criterion">Peptidoform</h5><p>${JTe(e.peptide,e.ptms)}</p>`:""}
      ${e.peptide&&e.type!=="PROTEOMICS_PTM"?`<h5>Peptide</h5><p>${e.peptide}</p>`:""} 
      ${e.xrefs?`<h5>Cross-references</h5>${cZ(e.xrefs)}`:""}
      ${t?`<h5>Evidence</h5>${t}`:""}
      ${e.ptms&&n&&!n.includes("Glue project")?`<hr /><h5 data-article-id="mod_res_large_scale#what-is-the-goldsilverbronze-criterion">PTM statistical attributes</h5><ul>${e.ptms.map(a=>a.dbReferences.map(o=>`<li><b>${o.id}</b></li>
                      <li style="text-indent: 1em"><b>${H9(e,a)}</b></li>
                      <li style="text-indent: 2em">PubMed ID: <a href="https://europepmc.org/article/MED/${o.properties["Pubmed ID"]}" style="color:#FFF" target="_blank">
                      ${o.properties["Pubmed ID"]}</a>
                      </li>
                      <li style="text-indent: 2em"><span data-article-id="mod_res_large_scale#confidence-score">Confidence score</span>: ${o.properties["Confidence score"]}</li>
                      <li style="text-indent: 2em">Universal Spectrum Id: 
                      <a href="http://proteomecentral.proteomexchange.org/usi/?usi=${o.properties["Universal Spectrum Id"]}" style="color:#FFF" target="_blank">View on ProteomeXchange</a>
                      </li>
                      <li style="text-indent: 2em">PSM Count (0.05 gFLR): ${o.properties["PSM Count (0.05 gFLR)"]}</li>
                      <li style="text-indent: 2em">Final site probability: ${o.properties["Final site probability"]}</li>
                      `).join("")).join("")}</ul>`:""}
        `}catch(a){return console.error(a),""}},tIe=e=>{let t=[];const{features:r}=e;return r&&r.length>0&&(t=r.map(n=>({...n,tooltipContent:dZ(n),protvistaFeatureId:TE()})),t=uZ(t)),t},G9=e=>({category:"PROTEOMICS",type:e.unique?"unique":"non_unique",tooltipContent:dZ(e),protvistaFeatureId:TE()}),rIe=e=>{let t=[];if(e&&e.length!==0){const r={};e.features.forEach(n=>{let i=`${n.begin}-${n.end}`;n.ptms&&(n.ptms.forEach(a=>{i+=`-${a.position}`}),r[i]=i in r?[...r[i],n]:[n])}),Object.keys(r).length?t=Object.values(r).map(n=>{const i=[];n.forEach(o=>{o.ptms.forEach(s=>{s.dbReferences.forEach(u=>{i.push(u)})})});const a={type:n[0].type,begin:n[0].begin,end:n[0].end,xrefs:n[0].xrefs,evidences:n[0].evidences,peptide:n[0].peptide,unique:n[0].unique,ptms:n[0].ptms.map(o=>({name:o.name,position:o.position,sources:o.sources,dbReferences:i}))};return Object.assign(a,G9(a))},[]):t=e.features.map(n=>Object.assign(n,G9(n))),t=uZ(t)}return t},nIe="PDBE_COVER",iIe="STRUCTURE_COVERAGE",aIe=e=>e.charAt(0).toUpperCase()+e.slice(1),oIe=e=>Object.keys(e).reduce((t,r)=>`${t}${aIe(r)}: ${e[r]}. `,""),sIe=e=>{const t=e.indexOf("="),r=e.indexOf("-");return t===-1||r===-1?{start:0,end:0}:{start:+e.slice(t+1,r),end:+e.slice(r+1)}},uIe=e=>e.dbReferences.filter(t=>t.type==="PDB").map(t=>{const r=t.properties.chains?sIe(t.properties.chains):{start:0,end:0};return{type:nIe,category:iIe,structures:[{description:oIe(t.properties),start:r.start,end:r.end,source:{id:t.id,url:`http://www.ebi.ac.uk/pdbe-srv/view/entry/${t.id}`}}],start:r.start,end:r.end}}),lIe=e=>{if(!e||e.length<=0)return[];const t=e.sort((n,i)=>n.start-i.start),r=[];return t.forEach(n=>{const i=r[r.length-1];!i||i.end<n.start?r.push(n):(i.end<n.end&&(i.end=n.end),i.structures.push(n.structures[0]))}),r},cIe=e=>`<ul>
            ${e.map(t=>`<li style="margin: 0.25rem 0"><a style="color:#FFF" href='${t.source.url}' target='_blank'>
            ${t.source.id}
        </a> (${t.start}-${t.end})</li>`).join("")}
        </ul>`,dIe=e=>{const t=cIe(e.structures);return`${t?`<h5>Structures</h5>${t}`:""}`},fIe=e=>{let t=[];if(e&&e.length!==0){const r=uIe(e);t=lIe(r),t.forEach(n=>{n.tooltipContent=dIe(n),n.protvistaFeatureId=TE()})}return t},hIe=e=>e==null?void 0:e.map(t=>`
              <h4>Disease association</h4><p>${t.name}</p>
              ${t.description?`<>${t.description}</p>`:""}
              ${t.dbReferences?`<h5>Cross-references</h5>${cZ(t.dbReferences)}`:""}
              ${lZ(t.evidences)}
          `).join(""),pIe=e=>`<hr/><h5>Description</h5>${e.map(t=>`<p>${t.value}</p>`).join("")}
  `,vIe=e=>`<hr/><h5>Population frequencies</h5>${e.map(t=>`<p>${t.frequency} - ${t.populationName} (${t.source})</p>`).join("")}`,mIe=e=>{if(e.locations.some(r=>r.source==="EnsemblViruses")){const r=e.xrefs.find(n=>n.name==="ENA");return r.id?`<h5>Ensembl COVID-19</h5>
          <p>
          <a href="https://covid-19.ensembl.org/Sars_cov_2/Variation/Explore?v=${r.id}" target="_blank" rel="noopener noreferrer">${r.id}</a>
        </p>`:""}return""},gIe=e=>{const t=u0(e,"predAlgorithmNameType");return Object.keys(t).map(n=>{const i=u0(t[n],"predictionValType");return{algorithm:n,values:Object.keys(i).map(a=>({name:a,count:i[a].length}))}}).map(n=>`<h6>${n.algorithm}</h6><ul class="no-bullet">${n.values.map(i=>`<li>${i.name}</li>`).join("")}</ul>`).join("")},yIe=e=>{var t;return`
                <h5>Variant</h5><p>${e.wildType} > ${e.alternativeSequence||""}</p>
                ${e.populationFrequencies?vIe(e.populationFrequencies):""}
                ${e.consequenceType?`<h5>Consequence</h5><p>${e.consequenceType}</p>`:""}
                ${e.somaticStatus?`<h5>Somatic</h5><p>${e.somaticStatus===0?"No":"Yes"}</p>`:""}
                ${!((t=e.genomicLocation)===null||t===void 0)&&t.length?`<h5>Location</h5><p>${e.genomicLocation.join(", ")}</p>`:""}
                ${e.ftId?`<h5>Feature ID</h5><p>${e.ftId}</p>`:""}
                ${e.descriptions?pIe(e.descriptions):""}
                ${e.association?hIe(e.association):""}
                ${e.predictions?gIe(e.predictions):""}
                ${mIe(e)}
                
        `};var G5;(function(e){e.A="A",e.C="C",e.D="D",e.E="E",e.Empty="*",e.F="F",e.G="G",e.H="H",e.I="I",e.K="K",e.L="L",e.M="M",e.N="N",e.Nl="NL",e.P="P",e.Q="Q",e.R="R",e.S="S",e.T="T",e.V="V",e.W="W",e.Y="Y"})(G5||(G5={}));var q9;(function(e){e.CLINVAR="ClinVar",e.ESP="ESP",e.EXAC="ExAC",e.GENOMES1K="1000Genomes",e.BOVINE_SNP50="BovineSNP50",e.BOVINE_LD="BovineLD",e.BOVINE_HD="BovineHD",e.EQUINE_SNP50="EquineSNP50",e.CHICKEN_600K="Chicken600K",e.KG_HQ="1kg_hq",e.COSMIC="cosmic curated",e.REVIEWED="reviewed",e.UNIPROT="UniProt",e.DBSNP="dbSNP",e.ENSEMBL="Ensembl",e.ENSEMBL_PLANTS="EnsemblPlants",e.VECTORBASE="VectorBase",e.REFSEQ="RefSeq",e.DBGAP="dbGaP",e.DDD="DDD",e.PHARMCOGKB="PharmGKB",e.ENSEMBL_FUNGI="EnsemblFungi",e.ENSEMBL_METAZOA="EnsemblMetazoa",e.GNOMAD_V2="gnomAD_v2.0",e.GNOMAD_V3="gnomAD_v3.0",e.TCGA="NCI-TCGA",e.TCGA_COSMIC="NCI-TCGA Cosmic",e.DECIPHER="ddG2P",e.TOPMED="TOPMed",e.GNOMAD="gnomAD",e.PHARMGKB="pharmgkb",e.SGRP="SGRP",e.SGD="SGD",e.JEFFARES_SNPS="Jeffares_SNPs",e.JEFFARES_INDELS="Jeffares_Indels",e.ENSEMBL_VIRUSES="EnsemblViruses"})(q9||(q9={}));var $9;(function(e){e.Benign="Benign",e.Disease="Disease",e.LikelyBenign="Likely benign",e.LikelyPathogenic="Likely pathogenic",e.Pathogenic="Pathogenic",e.Protective="Protective",e.VariantOfUncertainSignificance="Variant of uncertain significance"})($9||($9={}));var W9;(function(e){e.Empty="-",e.Frameshift="frameshift",e.InframeDeletion="inframe deletion",e.Insertion="insertion",e.Missense="missense",e.StopGained="stop gained"})(W9||(W9={}));var X9;(function(e){e.PolyPhen="PolyPhen",e.Sift="SIFT"})(X9||(X9={}));var Y9;(function(e){e.Benign="benign",e.Deleterious="deleterious",e.DeleteriousLowConfidence="deleterious - low confidence",e.PossiblyDamaging="possibly damaging",e.ProbablyDamaging="probably damaging",e.Tolerated="tolerated",e.ToleratedLowConfidence="tolerated - low confidence",e.Unknown="unknown"})(Y9||(Y9={}));var K9;(function(e){e.LargeScaleStudy="large_scale_study",e.Mixed="mixed",e.UniProt="uniprot"})(K9||(K9={}));const bIe=(e,t)=>{const r=e?e.map(n=>n.name):[];return(t==="uniprot"||t==="mixed")&&r.push("uniprot"),r},xIe=e=>{const{sequence:t,features:r}=e,n=r.map(i=>{var a;return Object.assign(Object.assign({},i),{accession:(a=i.genomicLocation)===null||a===void 0?void 0:a.join(", "),variant:i.alternativeSequence?i.alternativeSequence:G5.Empty,start:i.begin,xrefNames:bIe(i.xrefs,i.sourceType),hasPredictions:i.predictions&&i.predictions.length>0,tooltipContent:yIe(i),protvistaFeatureId:TE()})});return n?{sequence:t,variants:n}:null};var xr=globalThis&&globalThis.__classPrivateFieldSet||function(e,t,r){if(!t.has(e))throw new TypeError("attempted to set private field on non-instance");return t.set(e,r),r},Ut=globalThis&&globalThis.__classPrivateFieldGet||function(e,t){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return t.get(e)},Sf,Pp,mu,Wm,d1,fl,hl,pl,vl,ml,gl,yl,bl,Tp,Xm,Cf,vC,_f;const SIe=function(e){var t=131,r=137,n=0;e+="x";var i=Math.floor(9007199254740991/r);for(let a=0;a<e.length;a++)n>i&&(n=Math.floor(n/r)),n=n*t+e.charCodeAt(a);return n},$t="0123456789abcdef".split(""),CIe=[-2147483648,8388608,32768,128],du=[24,16,8,0],Ux=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],aa=[];class _Ie{constructor(t=!1,r=!1){Sf.set(this,void 0),Pp.set(this,void 0),mu.set(this,void 0),Wm.set(this,void 0),d1.set(this,void 0),fl.set(this,void 0),hl.set(this,void 0),pl.set(this,void 0),vl.set(this,void 0),ml.set(this,void 0),gl.set(this,void 0),yl.set(this,void 0),bl.set(this,void 0),Tp.set(this,void 0),Xm.set(this,void 0),Cf.set(this,void 0),vC.set(this,0),_f.set(this,void 0),this.init(t,r)}init(t,r){r?(aa[0]=aa[16]=aa[1]=aa[2]=aa[3]=aa[4]=aa[5]=aa[6]=aa[7]=aa[8]=aa[9]=aa[10]=aa[11]=aa[12]=aa[13]=aa[14]=aa[15]=0,xr(this,Pp,aa)):xr(this,Pp,[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),t?(xr(this,fl,3238371032),xr(this,hl,914150663),xr(this,pl,812702999),xr(this,vl,4144912697),xr(this,ml,4290775857),xr(this,gl,1750603025),xr(this,yl,1694076839),xr(this,bl,3204075428)):(xr(this,fl,1779033703),xr(this,hl,3144134277),xr(this,pl,1013904242),xr(this,vl,2773480762),xr(this,ml,1359893119),xr(this,gl,2600822924),xr(this,yl,528734635),xr(this,bl,1541459225)),xr(this,Sf,xr(this,_f,xr(this,mu,xr(this,Xm,0)))),xr(this,Wm,xr(this,Tp,!1)),xr(this,d1,!0),xr(this,Cf,t)}update(t){if(Ut(this,Wm))return this;let r;t instanceof ArrayBuffer?r=new Uint8Array(t):r=t;let n=0;const i=r.length,a=Ut(this,Pp);for(;n<i;){let o;if(Ut(this,Tp)&&(xr(this,Tp,!1),a[0]=Ut(this,Sf),a[16]=a[1]=a[2]=a[3]=a[4]=a[5]=a[6]=a[7]=a[8]=a[9]=a[10]=a[11]=a[12]=a[13]=a[14]=a[15]=0),typeof r!="string")for(o=Ut(this,_f);n<i&&o<64;++n)a[o>>2]|=r[n]<<du[o++&3];else for(o=Ut(this,_f);n<i&&o<64;++n){let s=r.charCodeAt(n);s<128?a[o>>2]|=s<<du[o++&3]:s<2048?(a[o>>2]|=(192|s>>6)<<du[o++&3],a[o>>2]|=(128|s&63)<<du[o++&3]):s<55296||s>=57344?(a[o>>2]|=(224|s>>12)<<du[o++&3],a[o>>2]|=(128|s>>6&63)<<du[o++&3],a[o>>2]|=(128|s&63)<<du[o++&3]):(s=65536+((s&1023)<<10|r.charCodeAt(++n)&1023),a[o>>2]|=(240|s>>18)<<du[o++&3],a[o>>2]|=(128|s>>12&63)<<du[o++&3],a[o>>2]|=(128|s>>6&63)<<du[o++&3],a[o>>2]|=(128|s&63)<<du[o++&3])}xr(this,vC,o),xr(this,mu,Ut(this,mu)+(o-Ut(this,_f))),o>=64?(xr(this,Sf,a[16]),xr(this,_f,o-64),this.hash(),xr(this,Tp,!0)):xr(this,_f,o)}return Ut(this,mu)>4294967295&&(xr(this,Xm,Ut(this,Xm)+(Ut(this,mu)/4294967296<<0)),xr(this,mu,Ut(this,mu)%4294967296)),this}finalize(){if(Ut(this,Wm))return;xr(this,Wm,!0);const t=Ut(this,Pp),r=Ut(this,vC);t[16]=Ut(this,Sf),t[r>>2]|=CIe[r&3],xr(this,Sf,t[16]),r>=56&&(Ut(this,Tp)||this.hash(),t[0]=Ut(this,Sf),t[16]=t[1]=t[2]=t[3]=t[4]=t[5]=t[6]=t[7]=t[8]=t[9]=t[10]=t[11]=t[12]=t[13]=t[14]=t[15]=0),t[14]=Ut(this,Xm)<<3|Ut(this,mu)>>>29,t[15]=Ut(this,mu)<<3,this.hash()}hash(){let t=Ut(this,fl),r=Ut(this,hl),n=Ut(this,pl),i=Ut(this,vl),a=Ut(this,ml),o=Ut(this,gl),s=Ut(this,yl),u=Ut(this,bl);const l=Ut(this,Pp);let c,d,f,h,v,p,m,g,y,b;for(let S=16;S<64;++S)h=l[S-15],c=(h>>>7|h<<25)^(h>>>18|h<<14)^h>>>3,h=l[S-2],d=(h>>>17|h<<15)^(h>>>19|h<<13)^h>>>10,l[S]=l[S-16]+c+l[S-7]+d<<0;b=r&n;for(let S=0;S<64;S+=4)Ut(this,d1)?(Ut(this,Cf)?(m=300032,h=l[0]-1413257819,u=h-150054599<<0,i=h+24177077<<0):(m=704751109,h=l[0]-210244248,u=h-1521486534<<0,i=h+143694565<<0),xr(this,d1,!1)):(c=(t>>>2|t<<30)^(t>>>13|t<<19)^(t>>>22|t<<10),d=(a>>>6|a<<26)^(a>>>11|a<<21)^(a>>>25|a<<7),m=t&r,f=m^t&n^b,p=a&o^~a&s,h=u+d+p+Ux[S]+l[S],v=c+f,u=i+h<<0,i=h+v<<0),c=(i>>>2|i<<30)^(i>>>13|i<<19)^(i>>>22|i<<10),d=(u>>>6|u<<26)^(u>>>11|u<<21)^(u>>>25|u<<7),g=i&t,f=g^i&r^m,p=u&a^~u&o,h=s+d+p+Ux[S+1]+l[S+1],v=c+f,s=n+h<<0,n=h+v<<0,c=(n>>>2|n<<30)^(n>>>13|n<<19)^(n>>>22|n<<10),d=(s>>>6|s<<26)^(s>>>11|s<<21)^(s>>>25|s<<7),y=n&i,f=y^n&t^g,p=s&u^~s&a,h=o+d+p+Ux[S+2]+l[S+2],v=c+f,o=r+h<<0,r=h+v<<0,c=(r>>>2|r<<30)^(r>>>13|r<<19)^(r>>>22|r<<10),d=(o>>>6|o<<26)^(o>>>11|o<<21)^(o>>>25|o<<7),b=r&n,f=b^r&i^y,p=o&s^~o&u,h=a+d+p+Ux[S+3]+l[S+3],v=c+f,a=t+h<<0,t=h+v<<0;xr(this,fl,Ut(this,fl)+t<<0),xr(this,hl,Ut(this,hl)+r<<0),xr(this,pl,Ut(this,pl)+n<<0),xr(this,vl,Ut(this,vl)+i<<0),xr(this,ml,Ut(this,ml)+a<<0),xr(this,gl,Ut(this,gl)+o<<0),xr(this,yl,Ut(this,yl)+s<<0),xr(this,bl,Ut(this,bl)+u<<0)}hex(){this.finalize();const t=Ut(this,fl),r=Ut(this,hl),n=Ut(this,pl),i=Ut(this,vl),a=Ut(this,ml),o=Ut(this,gl),s=Ut(this,yl),u=Ut(this,bl);let l=$t[t>>28&15]+$t[t>>24&15]+$t[t>>20&15]+$t[t>>16&15]+$t[t>>12&15]+$t[t>>8&15]+$t[t>>4&15]+$t[t&15]+$t[r>>28&15]+$t[r>>24&15]+$t[r>>20&15]+$t[r>>16&15]+$t[r>>12&15]+$t[r>>8&15]+$t[r>>4&15]+$t[r&15]+$t[n>>28&15]+$t[n>>24&15]+$t[n>>20&15]+$t[n>>16&15]+$t[n>>12&15]+$t[n>>8&15]+$t[n>>4&15]+$t[n&15]+$t[i>>28&15]+$t[i>>24&15]+$t[i>>20&15]+$t[i>>16&15]+$t[i>>12&15]+$t[i>>8&15]+$t[i>>4&15]+$t[i&15]+$t[a>>28&15]+$t[a>>24&15]+$t[a>>20&15]+$t[a>>16&15]+$t[a>>12&15]+$t[a>>8&15]+$t[a>>4&15]+$t[a&15]+$t[o>>28&15]+$t[o>>24&15]+$t[o>>20&15]+$t[o>>16&15]+$t[o>>12&15]+$t[o>>8&15]+$t[o>>4&15]+$t[o&15]+$t[s>>28&15]+$t[s>>24&15]+$t[s>>20&15]+$t[s>>16&15]+$t[s>>12&15]+$t[s>>8&15]+$t[s>>4&15]+$t[s&15];return Ut(this,Cf)||(l+=$t[u>>28&15]+$t[u>>24&15]+$t[u>>20&15]+$t[u>>16&15]+$t[u>>12&15]+$t[u>>8&15]+$t[u>>4&15]+$t[u&15]),l}toString(){return this.hex()}digest(){this.finalize();const t=Ut(this,fl),r=Ut(this,hl),n=Ut(this,pl),i=Ut(this,vl),a=Ut(this,ml),o=Ut(this,gl),s=Ut(this,yl),u=Ut(this,bl),l=[t>>24&255,t>>16&255,t>>8&255,t&255,r>>24&255,r>>16&255,r>>8&255,r&255,n>>24&255,n>>16&255,n>>8&255,n&255,i>>24&255,i>>16&255,i>>8&255,i&255,a>>24&255,a>>16&255,a>>8&255,a&255,o>>24&255,o>>16&255,o>>8&255,o&255,s>>24&255,s>>16&255,s>>8&255,s&255];return Ut(this,Cf)||l.push(u>>24&255,u>>16&255,u>>8&255,u&255),l}array(){return this.digest()}arrayBuffer(){this.finalize();const t=new ArrayBuffer(Ut(this,Cf)?28:32),r=new DataView(t);return r.setUint32(0,Ut(this,fl)),r.setUint32(4,Ut(this,hl)),r.setUint32(8,Ut(this,pl)),r.setUint32(12,Ut(this,vl)),r.setUint32(16,Ut(this,ml)),r.setUint32(20,Ut(this,gl)),r.setUint32(24,Ut(this,yl)),Ut(this,Cf)||r.setUint32(28,Ut(this,bl)),t}}Sf=new WeakMap,Pp=new WeakMap,mu=new WeakMap,Wm=new WeakMap,d1=new WeakMap,fl=new WeakMap,hl=new WeakMap,pl=new WeakMap,vl=new WeakMap,ml=new WeakMap,gl=new WeakMap,yl=new WeakMap,bl=new WeakMap,Tp=new WeakMap,Xm=new WeakMap,Cf=new WeakMap,vC=new WeakMap,_f=new WeakMap;function wIe(e){const t=new _Ie;return t.update(e),parseInt(t.hex().substring(0,8),16)}const EIe=function(e){var t="#";return e.forEach(function(r){r<16&&(t+=0),t+=r.toString(16)}),t},AIe=function(e,t,r){e/=360;var n=r<.5?r*(1+t):r+t-r*t,i=2*r-n;return[e+1/3,e,e-1/3].map(function(a){return a<0&&a++,a>1&&a--,a<1/6?a=i+(n-i)*6*a:a<.5?a=n:a<2/3?a=i+(n-i)*6*(2/3-a):a=i,Math.round(a*255)})};class PIe{constructor(t={}){const[r,n]=[t.lightness,t.saturation].map(function(i){return i=i!==void 0?i:[.35,.5,.65],Array.isArray(i)?i.concat():[i]});this.L=r,this.S=n,typeof t.hue=="number"&&(t.hue={min:t.hue,max:t.hue}),typeof t.hue=="object"&&!Array.isArray(t.hue)&&(t.hue=[t.hue]),typeof t.hue>"u"&&(t.hue=[]),this.hueRanges=t.hue.map(function(i){return{min:typeof i.min>"u"?0:i.min,max:typeof i.max>"u"?360:i.max}}),this.hash=wIe,typeof t.hash=="function"&&(this.hash=t.hash),t.hash==="bkdr"&&(this.hash=SIe)}hsl(t){var r,n,i,a=this.hash(t),o=727;if(this.hueRanges.length){const s=this.hueRanges[a%this.hueRanges.length];r=a/this.hueRanges.length%o*(s.max-s.min)/o+s.min}else r=a%359;return a=Math.ceil(a/360),n=this.S[a%this.S.length],a=Math.ceil(a/this.S.length),i=this.L[a%this.L.length],[r,n,i]}rgb(t){var r=this.hsl(t);return AIe.apply(this,r)}hex(t){var r=this.rgb(t);return EIe(r)}}const TIe=new PIe({hash:"bkdr",saturation:[.65,.35,.5],lightness:[.65,.35,.5]}),IIe=e=>{var t;try{return(t=e==null?void 0:e.results)==null?void 0:t.map(({metadata:r,proteins:n})=>{var i;return{...r,locations:n[0].entry_protein_locations,start:n[0].entry_protein_locations?Math.min(...n[0].entry_protein_locations.map(a=>Math.min(...a.fragments.map(o=>o.start)))):"",end:n[0].entry_protein_locations?Math.max(...(i=n[0].entry_protein_locations)==null?void 0:i.map(a=>Math.max(...a.fragments.map(o=>o.end)))):"",color:TIe.hex(r.accession.toLowerCase().split("").reverse().join("")),tooltipContent:`
        <h5>Accession</h5>
        <p>
        <a
          target="_blank"
          rel="noopener"
          href="https://www.ebi.ac.uk/interpro/entry/${r.source_database}/${r.accession}/"
        >
        ${r.accession}
        </a>
        </p>
        <h5>Name</h5>
        <p>${r.name}</p>
        ${r.integrated?`<h5>Integrated into </h5>
        <p>
        <a
          target="_blank"
          rel="noopener"
          href="https://www.ebi.ac.uk/interpro/entry/InterPro/${r.integrated}/"
        >
          ${r.integrated}
        </a>
        </p>`:""}
      `,length:n[0].protein_length}})}catch{throw new Error("Failed transforming the data")}};var q5;(function(e){e.Gold="#c39b00",e.Silver="#8194a1",e.Bronze="#a65708"})(q5||(q5={}));const Q9={R:"Phosphoarginine",C:"Phosphocysteine",H:"Phosphohistidine",S:"Phosphoserine",T:"Phosphothreonine",Y:"Phosphotyrosine"},MIe=e=>{const t=e.toUpperCase();return t in Q9?Q9[t]:(console.error(`${t} not a valid amino acid for phosphorylation`),"")},DIe=(e,t,r)=>{const n=[...e.flatMap(({dbReferences:s})=>s==null?void 0:s.flatMap(({id:u})=>[u]))],i=new Set(e.flatMap(({dbReferences:s})=>s==null?void 0:s.map(({properties:u})=>u["Confidence score"])));let a;i.size?i.size>1?console.error(`PTM has a mixture of confidence scores: ${Array.from(i)}`):[a]=i:console.log("PTM has no confidence score");const o=`
  <h5>Description</h5><p>${MIe(t)}</p>
  ${a?`<h5 data-article-id="mod_res_large_scale#confidence-score">Confidence Score</h5><p>${a}</p>`:""}
  ${n?`<h5>Evidence</h5><ul>${n.map(s=>{const u=s==="Glue project"?"PXD012174":s;return`<li title='${u}' style="padding: .25rem 0">${u}&nbsp;
              (<a href="https://www.ebi.ac.uk/pride/archive/projects/${s}" style="color:#FFF" target="_blank">PRIDE</a>)
              </li>
              ${s==="Glue project"?'<li title="publication" style="padding: .25rem 0">Publication:&nbsp;31819260&nbsp;(<a href="https://pubmed.ncbi.nlm.nih.gov/31819260" style="color:#FFF" target="_blank">PubMed</a>)</li>':""}
              `}).join("")}</ul>`:""}
  `;return{source:"PTMeXchange",type:"MOD_RES_LS",start:r,end:r,shape:"triangle",tooltipContent:o,color:q5[a]||"black"}},RIe=e=>{if(e){const{features:t}=e,r={};if(t){for(const n of t)for(const i of n.ptms){const a=+n.begin+i.position-1;if(!Number.isFinite(a)){console.error(`Encountered infinite number: +feature.begin + ptm.position - 1 = ${+n.begin} + ${i.position} - 1`);continue}const o=n.peptide[i.position-1];a in r?r[a].aa!==o?console.error(`One PTM has different amino acid values: [${r[a].aa}, ${o}]`):r[a].ptms.push(i):r[a]={ptms:[i],aa:o}}return Object.entries(r).map(([n,{ptms:i,aa:a}])=>DIe(i,a,+n))}}return[]},kIe=e=>{var t;const r=(t=e==null?void 0:e[0])===null||t===void 0?void 0:t.cifUrl;return r!=null&&r.length?r.replace("-model","-confidence").replace(".cif",".json"):null},OIe=async e=>{try{return(await fetch(e)).json()}catch(t){console.error("Couldn't load AlphaFold confidence",t)}},FIe=async e=>{const t=kIe(e);return(await OIe(t)).confidenceCategory.join("")},LIe=[{name:"MOLECULE_PROCESSING",label:"Molecule processing",trackType:"protvista-track",tracks:[{name:"signal",label:"Signal peptide",filter:"SIGNAL",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"N-terminal signal peptide"},{name:"chain",label:"Chain",filter:"CHAIN",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"(aka mature region). This describes the extent of a polypeptide chain in the mature protein following processing"},{name:"transit",label:"Transit peptide",filter:"TRANSIT",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"This describes the extent of a transit peptide"},{name:"init_met",label:"Initiator methionine",filter:"INIT_MET",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"This indicates that the initiator methionine is cleaved from the mature protein"},{name:"propep",label:"Propeptide",filter:"PROPEP",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"Part of a protein that is cleaved during maturation or activation"},{name:"peptide",label:"Peptide",filter:"PEPTIDE",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"The position and length of an active peptide in the mature protein"}]},{name:"SEQUENCE_INFORMATION",label:"Sequence information",trackType:"protvista-track",tracks:[{name:"compbias",label:"Compositional bias",filter:"COMPBIAS",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"Position of regions of compositional bias within the protein and the particular amino acids that are over-represented within those regions"},{name:"conflict",label:"Sequence conflict",filter:"CONFLICT",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"Sequence discrepancies of unknown origin"},{name:"non_cons",filter:"NON_CONS",trackType:"protvista-track",label:"Non-adjacent residues",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"Indicates that two residues in a sequence are not consecutive and that there is an undetermined number of unsequenced residues between them"},{name:"non_ter",filter:"NON_TER",trackType:"protvista-track",label:"Non-terminal residue",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"The sequence is incomplete. The residue is not the terminal residue of the complete protein"},{name:"unsure",filter:"UNSURE",trackType:"protvista-track",label:"Sequence uncertainty",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"Regions of a sequence for which the authors are unsure about the sequence assignment"},{name:"non_std",filter:"NON_STD",trackType:"protvista-track",label:"Non-standard residue",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"Non-standard amino acids (selenocysteine and pyrrolysine)"}]},{name:"TOPOLOGY",label:"Topology",trackType:"protvista-track",tracks:[{name:"topo_dom",label:"Topological domain",filter:"TOPO_DOM",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"Location of non-membrane regions of membrane-spanning proteins"},{name:"transmem",label:"Transmembrane",filter:"TRANSMEM",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"Extent of a membrane-spanning region"},{name:"intramem",label:"Intramembrane",filter:"INTRAMEM",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"Extent of a region located in a membrane without crossing it"}]},{name:"DOMAINS",label:"Domains",trackType:"protvista-track",tracks:[{name:"domain",label:"Domain",filter:"DOMAIN",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"Specific combination of secondary structures organized into a characteristic three-dimensional structure or fold"},{name:"InterPro representative domain",label:"InterPro Representative Domain",trackType:"protvista-track",data:[{adapter:"protvista-interpro-adapter",url:"https://www.ebi.ac.uk/interpro/api/entry/all/protein/uniprot/{accession}?type=domain&page_size=100"}],tooltip:"InterPro representative domains"},{name:"region",label:"Region",filter:"REGION",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"Regions in multifunctional enzymes or fusion proteins, or characteristics of a region, e.g., protein-protein interactions mediation"},{name:"repeat",label:"Repeat",filter:"REPEAT",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"Repeated sequence motifs or repeated domains within the protein"},{name:"motif",label:"Motif",filter:"MOTIF",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"Short conserved sequence motif of biological significance"}]},{name:"SITES",label:"Sites",trackType:"protvista-track",tracks:[{name:"metal",label:"Metal binding",filter:"METAL",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"Binding site for a metal ion"},{name:"site",label:"Site",filter:"SITE",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"Any interesting single amino acid site on the sequence"},{name:"ca_bind",label:"Calcium binding",filter:"CA_BIND",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"Calcium-binding regions, such as the EF-hand motif"},{name:"dna_bind",label:"DNA binding",filter:"DNA_BIND",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"DNA-binding domains such as AP2/ERF domain, the ETS domain, the Fork-Head domain, the HMG box and the Myb domain"},{name:"zn_fing",label:"Zinc finger",filter:"ZN_FING",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"Small, functional, independently folded domain that coordinates one or more zinc ions"},{name:"np_bind",label:"Nucleotide binding",filter:"NP_BIND",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"(aka flavin-binding). Region in the protein which binds nucleotide phosphates"},{name:"binding",label:"Binding site",filter:"BINDING",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"Binding site for any chemical group (co-enzyme, prosthetic group, etc.)"},{name:"act_site",label:"Active site",filter:"ACT_SITE",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"Amino acid(s) directly involved in the activity of an enzyme"}]},{name:"PTM",label:"PTM",trackType:"protvista-track",tracks:[{name:"mod_res",label:"Modified residue",filter:"MOD_RES",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"Modified residues such as phosphorylation, acetylation, acylation, methylation"},{name:"mod_res_ls",label:"Modified residue (large scale data)",filter:"MOD_RES_LS",trackType:"protvista-track",data:[{adapter:"protvista-proteomics-ptm-adapter",url:"https://www.ebi.ac.uk/proteins/api/proteomics-ptm/{accession}"}],tooltip:"Modified residues from Large scale studies"},{name:"carbohyd",label:"Glycosylation",filter:"CARBOHYD",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"Covalently attached glycan group(s)"},{name:"disulfid",label:"Disulfide bond",filter:"DISULFID",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"The positions of cysteine residues participating in disulphide bonds"},{name:"crosslnk",label:"Cross-link",filter:"CROSSLNK",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"Covalent linkages of various types formed between two proteins or between two parts of the same protein"},{name:"lipid",label:"Lipidation",filter:"LIPID",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"Covalently attached lipid group(s)"}]},{name:"ANTIGEN",label:"Antigenic sequences",trackType:"protvista-track",tracks:[{name:"antigen",label:"Antibody binding sequences",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/antigen/{accession}"}],tooltip:""}]},{name:"MUTAGENESIS",label:"Mutagenesis",trackType:"protvista-track",tracks:[{name:"mutagen",label:"Mutagenesis",filter:"MUTAGEN",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"Site which has been experimentally altered by mutagenesis"},{name:"othermutagen",label:"Mutagenesis (large scale data)",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/mutagenesis/{accession}"}],tooltip:"Site which has been experimentally altered by mutagenesis"}]},{name:"VARIATION",label:"Variants",trackType:"protvista-variation-graph",tracks:[{name:"variation",filterComponent:"protvista-filter",trackType:"protvista-variation",data:[{adapter:"protvista-variation-adapter",url:"https://www.ebi.ac.uk/proteins/api/variation/{accession}"}],tooltip:"Natural variant of the protein, including polymorphisms, variations between strains, isolates or cultivars, disease-associated mutations and RNA editing events"}]},{name:"PROTEOMICS",label:"Proteomics",trackType:"protvista-track",adapter:"protvista-proteomics-adapter",urls:["https://www.ebi.ac.uk/proteins/api/proteomics/{accession}","https://www.ebi.ac.uk/proteins/api/proteomics-ptm/{accession}"],tracks:[{name:"unique",label:"Unique peptide",filter:"unique",trackType:"protvista-track",data:[{adapter:"protvista-proteomics-adapter",url:"https://www.ebi.ac.uk/proteins/api/proteomics/{accession}"}],tooltip:""},{name:"non_unique",label:"Non-unique peptide",filter:"non_unique",trackType:"protvista-track",data:[{adapter:"protvista-proteomics-adapter",url:"https://www.ebi.ac.uk/proteins/api/proteomics/{accession}"}],tooltip:""},{name:"proteomics-ptm",label:"PTM-containing peptide",trackType:"protvista-track",data:[{adapter:"protvista-proteomics-adapter",url:"https://www.ebi.ac.uk/proteins/api/proteomics-ptm/{accession}"}],tooltip:""}]},{name:"STRUCTURE_COVERAGE",label:"PDBe 3D structure coverage",trackType:"protvista-track",tracks:[{name:"pdbe_cover",label:"PDBe coverage",trackType:"protvista-track",tooltip:"PDBe 3D structure coverage",data:[{adapter:"protvista-structure-adapter",url:"https://www.ebi.ac.uk/proteins/api/proteins/{accession}"}]}]},{name:"ALPHAFOLD_CONFIDENCE",label:"AlphaFold",trackType:"protvista-coloured-sequence",scale:"H:90,M:70,L:50,D:0","color-range":"#ff7d45:0,#ffdb13:50,#65cbf3:70,#0053d6:90,#0053d6:100",tracks:[{name:"alphafold_confidence",label:"AlphaFold Confidence",labelUrl:"https://alphafold.ebi.ac.uk/entry/{accession}",trackType:"protvista-coloured-sequence",data:[{adapter:"protvista-alphafold-confidence-adapter",url:"https://alphafold.ebi.ac.uk/api/prediction/{accession}"}],tooltip:"AlphaFold prediction confidence"}]},{name:"STRUCTURAL",label:"Structural features",trackType:"protvista-track",tracks:[{name:"helix",label:"Helix",filter:"HELIX",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"The positions of experimentally determined helical regions"},{name:"strand",label:"Beta strand",filter:"STRAND",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"The positions of experimentally determined beta strands"},{name:"turn",label:"Turn",filter:"TURN",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"The positions of experimentally determined hydrogen-bonded turns"},{name:"coiled",label:"Coiled coil",filter:"COILED",trackType:"protvista-track",data:[{adapter:"protvista-feature-adapter",url:"https://www.ebi.ac.uk/proteins/api/features/{accession}"}],tooltip:"Coiled coils are built by two or more alpha-helices that wind around each other to form a supercoil"}]}],NIe=[{type:"features",url:"https://www.ebi.ac.uk/proteins/api/features/"},{type:"variants",url:"https://www.ebi.ac.uk/proteins/api/variation/"},{type:"antigens",url:"https://www.ebi.ac.uk/proteins/api/antigen/"},{type:"proteomics",url:"https://www.ebi.ac.uk/proteins/api/proteomics/"}],BIe={categories:LIe,download:NIe};var UIe=globalThis&&globalThis.__awaiter||function(e,t,r,n){function i(a){return a instanceof r?a:new r(function(o){o(a)})}return new(r||(r=Promise))(function(a,o){function s(c){try{l(n.next(c))}catch(d){o(d)}}function u(c){try{l(n.throw(c))}catch(d){o(d)}}function l(c){c.done?a(c.value):i(c.value).then(s,u)}l((n=n.apply(e,t||[])).next())})};const DP=new Map,Z9=(e,t=new Headers({accept:"application/json"}))=>{const r=DP.get(e);if(r)return r;const n=(()=>UIe(void 0,void 0,void 0,function*(){const i=yield window.fetch(e,{headers:t});if(!i.ok)throw new Error(`Request Failed: Status = ${i.status}; URI = ${e}; Time = ${new Date}`);return i.status===204?{payload:null,headers:i.headers}:{payload:yield i.json(),headers:i.headers}}))();return DP.set(e,n),n.catch(()=>DP.delete(e)),n};function jIe(e,t){var r=-1,n=C2(e)?Array(e.length):[];return jQ(e,function(i,a,o){n[++r]=t(i,a,o)}),n}function zIe(e,t){var r=ls(e)?_2:jIe;return r(e,YQ(t))}function J9(e,t){return g6(zIe(e,t),1)}typeof window<"u"&&function(){window.console=window.console||{};for(var e=window.console,t,r,n={},i=function(){},a="memory".split(","),o="assert,clear,count,debug,dir,dirxml,error,exception,group,groupCollapsed,groupEnd,info,log,markTimeline,profile,profiles,profileEnd,show,table,time,timeEnd,timeline,timelineEnd,timeStamp,trace,warn".split(",");t=a.pop();)e[t]||(e[t]=n);for(;r=o.pop();)e[r]||(e[r]=i)}();typeof window.HTMLCanvasElement<"u"&&!window.HTMLCanvasElement.prototype.toBlob&&Object.defineProperty(window.HTMLCanvasElement.prototype,"toBlob",{value:function(e,t,r){for(var n=window.atob(this.toDataURL(t,r).split(",")[1]),i=n.length,a=i>>2,o=new Uint8Array(i),s=new Uint32Array(o.buffer,0,a),u=0,l=0;l<a;l++)s[l]=n.charCodeAt(u++)|n.charCodeAt(u++)<<8|n.charCodeAt(u++)<<16|n.charCodeAt(u++)<<24;for(var c=i&3;c--;)o[u]=n.charCodeAt(u++);e(new window.Blob([o],{type:t||"image/png"}))}});Math.cbrt=Math.cbrt||function(e){var t=Math.pow(Math.abs(e),.3333333333333333);return e<0?-t:t};Math.sign||(Math.sign=function(e){return e=+e,e===0||isNaN(e)?Number(e):e>0?1:-1});Number.isInteger||(Number.isInteger=function(t){return typeof t=="number"&&isFinite(t)&&t>-9007199254740992&&t<9007199254740992&&Math.floor(t)===t});Number.isNaN||(Number.isNaN=function(t){return t!==t});Object.assign||Object.defineProperty(Object,"assign",{enumerable:!1,configurable:!0,writable:!0,value:function(e){if(e==null)throw new TypeError("Cannot convert first argument to object");for(var t=Object(e),r=!1,n,i=1;i<arguments.length;i++){var a=arguments[i];if(a!=null){for(var o=Object.keys(Object(a)),s=0,u=o.length;s<u;s++){var l=o[s];try{var c=Object.getOwnPropertyDescriptor(a,l);c!==void 0&&c.enumerable&&(t[l]=a[l])}catch(d){r||(r=!0,n=d)}}if(r)throw n}}return t}});String.prototype.startsWith||function(){var e=function(){var n;try{var i={},a=Object.defineProperty;n=a(i,i,i)&&a}catch{}return n}(),t={}.toString,r=function(n){if(this===null)throw TypeError();var i=String(this);if(n&&t.call(n)==="[object RegExp]")throw TypeError();var a=i.length,o=String(n),s=o.length,u=arguments.length>1?arguments[1]:void 0,l=u?Number(u):0;Number.isNaN(l)&&(l=0);var c=Math.min(Math.max(l,0),a);if(s+c>a)return!1;for(var d=-1;++d<s;)if(i.charCodeAt(c+d)!==o.charCodeAt(d))return!1;return!0};e?e(String.prototype,"startsWith",{value:r,configurable:!0,writable:!0}):String.prototype.startsWith=r}();String.prototype.endsWith||(String.prototype.endsWith=function(e,t){var r=this.toString();(typeof t!="number"||!isFinite(t)||Math.floor(t)!==t||t>r.length)&&(t=r.length),t-=e.length;var n=r.indexOf(e,t);return n!==-1&&n===t});String.prototype.repeat||(String.prototype.repeat=function(e){if(this===null)throw new TypeError("can't convert "+this+" to object");var t=""+this;if(e=+e,Number.isNaN(e)&&(e=0),e<0)throw new RangeError("repeat count must be non-negative");if(e===1/0)throw new RangeError("repeat count must be less than infinity");if(e=Math.floor(e),t.length===0||e===0)return"";if(t.length*e>=1<<28)throw new RangeError("repeat count must not overflow maximum string size");for(var r="";(e&1)===1&&(r+=t),e>>>=1,e!==0;)t+=t;return r});String.prototype.includes||(String.prototype.includes=function(e,t){return typeof t!="number"&&(t=0),t+e.length>this.length?!1:this.indexOf(e,t)!==-1});Array.prototype.includes||(Array.prototype.includes=function(e){if(this==null)throw new TypeError("Array.prototype.includes called on null or undefined");var t=Object(this),r=parseInt(t.length,10)||0;if(r===0)return!1;var n=parseInt(arguments[1],10)||0,i;n>=0?i=n:(i=r+n,i<0&&(i=0));for(var a;i<r;){if(a=t[i],e===a||Number.isNaN(e)&&Number.isNaN(a))return!0;i++}return!1});Array.from||(Array.from=function(){var e=Object.prototype.toString,t=function(a){return typeof a=="function"||e.call(a)==="[object Function]"},r=function(a){var o=Number(a);return isNaN(o)?0:o===0||!isFinite(o)?o:(o>0?1:-1)*Math.floor(Math.abs(o))},n=Math.pow(2,53)-1,i=function(a){var o=r(a);return Math.min(Math.max(o,0),n)};return function(o){var s=this,u=Object(o);if(o==null)throw new TypeError("Array.from requires an array-like object - not null or undefined");var l=arguments.length>1?arguments[1]:void 0,c;if(typeof l<"u"){if(!t(l))throw new TypeError("Array.from: when provided, the second argument must be a function");arguments.length>2&&(c=arguments[2])}for(var d=i(u.length),f=t(s)?Object(new s(d)):new Array(d),h=0,v;h<d;)v=u[h],l?f[h]=typeof c>"u"?l(v,h):l.call(c,v,h):f[h]=v,h+=1;return f.length=d,f}}());typeof window<"u"&&function(){for(var e=0,t=["ms","moz","webkit","o"],r=0;r<t.length&&!window.requestAnimationFrame;++r)window.requestAnimationFrame=window[t[r]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[t[r]+"CancelAnimationFrame"]||window[t[r]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(n){var i=new Date().getTime(),a=Math.max(0,16-(i-e)),o=window.setTimeout(function(){var s=i+a;n(s)},a);return e=i+a,o}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(n){clearTimeout(n)})}();Function.prototype.name===void 0&&Object.defineProperty!==void 0&&Object.defineProperty(Function.prototype,"name",{get:function(){return this.toString().match(/^\s*function\s*(\S*)\s*\(/)[1]}});typeof window<"u"&&(window.performance===void 0&&(window.performance={}),window.performance.now===void 0&&function(){var e=Date.now();window.performance.now=function(){return Date.now()-e}}());Object.defineProperty!==void 0&&(Number.MAX_SAFE_INTEGER===void 0&&Object.defineProperty(Number,"MAX_SAFE_INTEGER",{enumerable:!1,configurable:!1,writable:!1,value:Math.pow(2,53)-1}),Number.MIN_SAFE_INTEGER===void 0&&Object.defineProperty(Number,"MIN_SAFE_INTEGER",{enumerable:!1,configurable:!1,writable:!1,value:-(Math.pow(2,53)-1)}));Object.entries||(Object.entries=function(e){for(var t=Object.keys(e),r=t.length,n=new Array(r);r--;)n[r]=[t[r],e[t[r]]];return n});Array.prototype.find||Object.defineProperty(Array.prototype,"find",{value:function(e){if(this==null)throw TypeError('"this" is null or not defined');var t=Object(this),r=t.length>>>0;if(typeof e!="function")throw TypeError("predicate must be a function");for(var n=arguments[1],i=0;i<r;){var a=t[i];if(e.call(n,a,i,t))return a;i++}},configurable:!0,writable:!0});Array.prototype.fill||Object.defineProperty(Array.prototype,"fill",{value:function(e){if(this==null)throw new TypeError("this is null or not defined");for(var t=Object(this),r=t.length>>>0,n=arguments[1],i=n>>0,a=i<0?Math.max(r+i,0):Math.min(i,r),o=arguments[2],s=o===void 0?r:o>>0,u=s<0?Math.max(r+s,0):Math.min(s,r);a<u;)t[a]=e,a++;return t}});Array.prototype.copyWithin||Object.defineProperty(Array.prototype,"copyWithin",{value:function(e,t){if(this==null)throw new TypeError("this is null or not defined");var r=Object(this),n=r.length>>>0,i=e>>0,a=i<0?Math.max(n+i,0):Math.min(i,n),o=t>>0,s=o<0?Math.max(n+o,0):Math.min(o,n),u=arguments[2],l=u===void 0?n:u>>0,c=l<0?Math.max(n+l,0):Math.min(l,n),d=Math.min(c-s,n-a),f=1;for(s<a&&a<s+d&&(f=-1,s+=d-1,a+=d-1);d>0;)s in r?r[a]=r[s]:delete r[a],s+=f,a+=f,d--;return r},configurable:!0,writable:!0});Int8Array.prototype.copyWithin||Object.defineProperty(Int8Array.prototype,"copyWithin",{value:Array.prototype.copyWithin});Int16Array.prototype.copyWithin||Object.defineProperty(Int16Array.prototype,"copyWithin",{value:Array.prototype.copyWithin});Int32Array.prototype.copyWithin||Object.defineProperty(Int32Array.prototype,"copyWithin",{value:Array.prototype.copyWithin});Uint8Array.prototype.copyWithin||Object.defineProperty(Uint8Array.prototype,"copyWithin",{value:Array.prototype.copyWithin});Uint16Array.prototype.copyWithin||Object.defineProperty(Uint16Array.prototype,"copyWithin",{value:Array.prototype.copyWithin});Uint32Array.prototype.copyWithin||Object.defineProperty(Uint32Array.prototype,"copyWithin",{value:Array.prototype.copyWithin});Float32Array.prototype.copyWithin||Object.defineProperty(Float32Array.prototype,"copyWithin",{value:Array.prototype.copyWithin});Float64Array.prototype.copyWithin||Object.defineProperty(Float64Array.prototype,"copyWithin",{value:Array.prototype.copyWithin});var $5=function(e,t){return $5=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(r[i]=n[i])},$5(e,t)};function Le(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");$5(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}var E=function(){return E=Object.assign||function(t){for(var r,n=1,i=arguments.length;n<i;n++){r=arguments[n];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(t[a]=r[a])}return t},E.apply(this,arguments)};function ce(e,t,r,n){function i(a){return a instanceof r?a:new r(function(o){o(a)})}return new(r||(r=Promise))(function(a,o){function s(c){try{l(n.next(c))}catch(d){o(d)}}function u(c){try{l(n.throw(c))}catch(d){o(d)}}function l(c){c.done?a(c.value):i(c.value).then(s,u)}l((n=n.apply(e,t||[])).next())})}function de(e,t){var r={label:0,sent:function(){if(a[0]&1)throw a[1];return a[1]},trys:[],ops:[]},n,i,a,o;return o={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function s(l){return function(c){return u([l,c])}}function u(l){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,l[0]&&(r=0)),r;)try{if(n=1,i&&(a=l[0]&2?i.return:l[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,l[1])).done)return a;switch(i=0,a&&(l=[l[0]&2,a.value]),l[0]){case 0:case 1:a=l;break;case 4:return r.label++,{value:l[1],done:!1};case 5:r.label++,i=l[1],l=[0];continue;case 7:l=r.ops.pop(),r.trys.pop();continue;default:if(a=r.trys,!(a=a.length>0&&a[a.length-1])&&(l[0]===6||l[0]===2)){r=0;continue}if(l[0]===3&&(!a||l[1]>a[0]&&l[1]<a[3])){r.label=l[1];break}if(l[0]===6&&r.label<a[1]){r.label=a[1],a=l;break}if(a&&r.label<a[2]){r.label=a[2],r.ops.push(l);break}a[2]&&r.ops.pop(),r.trys.pop();continue}l=t.call(e,r)}catch(c){l=[6,c],i=0}finally{n=a=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}function Nt(e,t,r){if(r||arguments.length===2)for(var n=0,i=t.length,a;n<i;n++)(a||!(n in t))&&(a||(a=Array.prototype.slice.call(t,0,n)),a[n]=t[n]);return e.concat(a||Array.prototype.slice.call(t))}var _a;(function(e){function t(i){return i}e.create=t;function r(i,a){return(i&a)!==0}e.has=r;function n(i,a){return!!a&&(i&a)===a}e.hasAll=n})(_a||(_a={}));var Br;(function(e){function t(S){return S===void 0&&(S=512),{current:[],offset:0,capacity:S,chunks:[]}}e.create=t;function r(S){return S.chunks.length?(S.offset>0&&(S.chunks[S.chunks.length]=S.current.length===S.offset?S.current.join(""):S.current.slice(0,S.offset).join("")),S.chunks.join("")):S.current.length===S.offset?S.current.join(""):S.current.splice(0,S.offset).join("")}e.getString=r;function n(S){for(var x=0,C=0,w=S.chunks;C<w.length;C++){var A=w[C];x+=A.length}for(var M=0;M<S.offset;M++)x+=S.current[M].length;return x}e.getSize=n;function i(S){return S.offset>0&&(S.current.length===S.offset?S.chunks[S.chunks.length]=S.current.join(""):S.chunks[S.chunks.length]=S.current.slice(0,S.offset).join(""),S.offset=0),S.chunks}e.getChunks=i;var a=[];(function(){for(var S="",x=0;x<512;x++)a[x]=S,S=S+" "})();function o(S){c(S,`
`)}e.newline=o;function s(S,x){x>0&&c(S,a[x])}e.whitespace=s;function u(S){c(S," ")}e.whitespace1=u;function l(S,x){x&&(S.offset===S.capacity&&(S.chunks[S.chunks.length]=S.current.join(""),S.offset=0),S.current[S.offset++]=x)}e.write=l;function c(S,x){S.offset===S.capacity&&(S.chunks[S.chunks.length]=S.current.join(""),S.offset=0),S.current[S.offset++]=x}e.writeSafe=c;function d(S,x,C){if(!x){s(S,C);return}var w=C-x.length;s(S,w),c(S,x)}e.writePadLeft=d;function f(S,x,C){if(!x){s(S,C);return}var w=C-x.length;c(S,x),s(S,w)}e.writePadRight=f;function h(S,x){c(S,""+x)}e.writeInteger=h;function v(S,x){c(S,""+x+" ")}e.writeIntegerAndSpace=v;function p(S,x,C){var w=""+x,A=C-w.length;s(S,A),c(S,w)}e.writeIntegerPadLeft=p;function m(S,x,C){var w=""+x,A=C-w.length;c(S,w),s(S,A)}e.writeIntegerPadRight=m;function g(S,x,C){c(S,""+Math.round(C*x)/C)}e.writeFloat=g;function y(S,x,C,w){var A=""+Math.round(C*x)/C,M=w-A.length;s(S,M),c(S,A)}e.writeFloatPadLeft=y;function b(S,x,C,w){var A=""+Math.round(C*x)/C,M=w-A.length;c(S,A),s(S,M)}e.writeFloatPadRight=b})(Br||(Br={}));var Ln=function(){if(typeof window<"u"&&window.performance){var e=window.performance;return function(){return e.now()}}else return typeof process<"u"&&process.hrtime!=="undefined"&&typeof process.hrtime=="function"?function(){var t=process.hrtime();return t[0]*1e3+t[1]/1e6}:Date.now?function(){return Date.now()}:function(){return+new Date}}();function mC(e,t){if(t===void 0&&(t=!0),isNaN(e))return"n/a";for(var r=Math.floor(e/(60*60*1e3)),n=Math.floor(e/(60*1e3)%60),i=Math.floor(e/1e3%60),a=Math.floor(e%1e3).toString();a.length<3;)a="0"+a;for(;!t&&a.length>1&&a[a.length-1]==="0";)a=a.substr(0,a.length-1);return r>0?r+"h"+n+"m"+i+"."+a+"s":n>0?n+"m"+i+"."+a+"s":i>0?i+"."+a+"s":e.toFixed(0)+"ms"}var bn;(function(e){var t=typeof btoa<"u"?btoa:function(o){return Buffer.from(o).toString("base64")},r=[];function n(){for(var o=+new Date+Ln(),s=0;s<16;s++)r[s]=String.fromCharCode((o+Math.random()*255)%255|0),o=Math.floor(o/255);return t(r.join("")).replace(/\+/g,"-").replace(/\//g,"_").substr(0,22)}e.create22=n;function i(){var o=+new Date+Ln(),s="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(u){var l=(o+Math.random()*16)%16|0;return o=Math.floor(o/16),(u==="x"?l:l&3|8).toString(16)});return s}e.createv4=i;function a(o){return typeof o=="string"}e.is=a})(bn||(bn={}));function VIe(e,t){return e-t}function HIe(e){return Array.prototype.sort.call(e,VIe),e}var eU;(function(e){var t=function(){function h(){this.size=0}return h.prototype.has=function(v){return!1},h.prototype.forEach=function(v,p){return p},h}(),r=function(){function h(v){this.idx=v,this.size=1}return h.prototype.has=function(v){return v===this.idx},h.prototype.forEach=function(v,p){return v(this.idx,p),p},h}(),n=function(){function h(v,p){this.mask=v,this.size=p,this.length=v.length}return h.prototype.has=function(v){return v<this.length&&!!this.mask[v]},h.prototype._forEach=function(v,p){for(var m=0;m<this.length;m++)this.mask[m]&&v(m,p)},h.prototype.forEach=function(v,p){return this._forEach(v,p),p},h}(),i=function(){function h(v){this.size=v}return h.prototype.has=function(v){return!0},h.prototype._forEach=function(v,p){for(var m=0;m<this.size;m++)v(m,p)},h.prototype.forEach=function(v,p){return this._forEach(v,p),p},h}(),a=function(){function h(v){this.set=v,this._flat=void 0,this.size=v.size}return h.prototype.has=function(v){return this.set.has(v)},h.prototype._forEach=function(v,p){for(var m=0,g=this.flatten();m<g.length;m++){var y=g[m];v(y,p)}},h.prototype.flatten=function(){if(this._flat)return this._flat;var v=new Int32Array(this.size),p=0;return this.set.forEach(function(m){return v[p++]=m}),HIe(v),this._flat=v,this._flat},h.prototype.forEach=function(v,p){return this._forEach(v,p),p},h}();function o(h){return new i(h)}e.always=o,e.never=new t;function s(h){return new a(h)}e.ofSet=s;function u(h){return new r(h)}e.singleton=u;function l(h){var v=h.length;if(v===0)return new t;if(v===1)return new r(h[0]);for(var p=0,m=0,g=h;m<g.length;m++){var y=g[m];y>p&&(p=y)}if(v===p)return new i(v);var b=v/p;if(b<1/12){for(var S=new Set,x=0,C=h;x<C.length;x++){var y=C[x];S.add(y)}return new a(S)}for(var w=new Int8Array(p+1),A=0,M=h;A<M.length;A++){var y=M[A];w[y]=1}return new n(w,h.length)}e.ofUniqueIndices=l;function c(h,v){return new n(h,v)}e.ofMask=c;function d(h,v){for(var p=0,m=v;p<m.length;p++){var g=m[p];if(h.has(g))return!0}return!1}e.hasAny=d;function f(h,v){var p=0,m=0;if(v.forEach(function(b){h.has(b)||(p++,b>m&&(m=b))}),p/m<1/12){var g=new Set;return v.forEach(function(b){h.has(b)||g.add(b)}),s(g)}else{var y=new Uint8Array(m+1);return v.forEach(function(b){h.has(b)||(y[b]=1)}),c(y,p)}}e.complement=f})(eU||(eU={}));function Ka(e,t){e===void 0&&(e=0),t===void 0&&(t=Number.MAX_SAFE_INTEGER);var r=e;return function(){var n=r;return r=(r+1)%t,n}}var L1;(function(e){function t(n){return{ref:n}}e.create=t;function r(n,i){return n.ref=i,n}e.set=r})(L1||(L1={}));var GIe=Ka(0,2147483647),Eh;(function(e){function t(n,i){return{id:GIe(),version:0,value:n,metadata:i}}e.create=t;function r(n,i){return{id:n.id,version:n.version+1,value:i,metadata:n.metadata}}e.withValue=r})(Eh||(Eh={}));var L;(function(e){function t(a,o){return L1.create(Eh.create(a,o))}e.create=t;function r(a,o){return L1.set(a,Eh.withValue(a.ref,o))}e.update=r;function n(a,o){return L1.set(a,o)}e.set=n;function i(a,o){return a.ref.value!==o?r(a,o):a}e.updateIfChanged=i})(L||(L={}));var Lf=function(){};function so(e,t){var r=e.length;if(r!==t.length)return!1;for(var n=0;n<r;n++)if(e[n]!==t[n])return!1;return!0}var fZ=Object.prototype.hasOwnProperty;function ud(e,t){if(e===t)return!0;var r=Array.isArray(e),n=Array.isArray(t);if(r&&n){if(e.length!==t.length)return!1;for(var i=0;i<e.length;i++)if(!ud(e[i],t[i]))return!1;return!0}if(r!==n)return!1;if(e&&t&&typeof e=="object"&&typeof t=="object"){var a=Object.keys(e);if(a.length!==Object.keys(t).length)return!1;var o=e instanceof Date,s=t instanceof Date;if(o&&s)return e.getTime()===t.getTime();if(o!==s)return!1;var u=e instanceof RegExp,l=t instanceof RegExp;if(u&&l)return e.toString()===t.toString();if(u!==l)return!1;for(var i=0;i<a.length;i++)if(!fZ.call(t,a[i]))return!1;for(var i=0;i<a.length;i++)if(!ud(e[a[i]],t[a[i]]))return!1;return!0}return!1}function W_(e,t){if(e===t)return!0;var r=Array.isArray(e),n=Array.isArray(t);return r&&n?qIe(e,t):r!==n?!1:e&&t&&typeof e=="object"&&typeof t=="object"?c0(e,t):!1}function c0(e,t){if(e===t)return!0;if(!e||!t)return!1;var r=Object.keys(e);if(Object.keys(t).length!==r.length)return!1;for(var n=0,i=r;n<i.length;n++){var a=i[n];if(!fZ.call(e,a)||e[a]!==t[a])return!1}return!0}function qIe(e,t){if(e===t)return!0;if(!e||!t||e.length!==t.length)return!1;for(var r=0,n=e.length;r<n;++r)if(e[r]!==t[r])return!1;return!0}function Oi(e,t){return e!==void 0?e:t}function tU(e){return(e<10?"0":"")+e}function $Ie(e){var t=e.getHours(),r=e.getMinutes(),n=e.getSeconds();return t+":"+tU(r)+":"+tU(n)}var N1=Math.PI/2,hZ=Math.PI/180;function Jr(e){return e*hZ}function ku(e){return e/hZ}function WIe(e){return e!==0&&(e&e-1)===0}function XIe(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var r=0,n=0,i=0,a=e.length;i<a;++i){var o=e[i],s=Math.abs(o);s>n&&(r=o,n=s)}return r}function pZ(e,t){return e*t}function YIe(e,t,r){return(e-t)/(r-t)}function Va(e,t,r){return Math.max(t,Math.min(r,e))}function KIe(e){return Va(e,0,1)}function es(e,t,r){return e+(t-e)*r}function gC(e,t,r,n,i,a){var o=(r-e)*a,s=(n-t)*a,u=i*i,l=i*u;return(2*t-2*r+o+s)*l+(-3*t+3*r-2*o-s)*u+o*i+t}function RP(e,t,r,n){var i=1-n;return i*i*e+2*i*n*t+n*n*r}function vZ(e,t,r){return r=KIe(YIe(r,e,t)),r*r*(3-2*r)}function da(){return da.zero()}(function(e){function t(){var D=[.1,0,0];return D[0]=0,D}e.zero=t;function r(D,k,R){var O=t();return O[0]=D,O[1]=k,O[2]=R,O}e.create=r;function n(D,k){var R=at.toRgb(k),O=R[0],H=R[1],B=R[2],j=M(O,H,B),Y=j[0],G=j[1],$=j[2],q=116*G-16;return D[0]=q<0?0:q,D[1]=500*(Y-G),D[2]=200*(G-$),D}e.fromColor=n;function i(D,k){return Wl.toLab(D,k)}e.fromHcl=i;function a(D){var k=(D[0]+16)/116,R=isNaN(D[1])?k:k+D[1]/500,O=isNaN(D[2])?k:k-D[2]/200;k=p*C(k),R=v*C(R),O=m*C(O);var H=x(3.2404542*R-1.5371385*k-.4985314*O),B=x(-.969266*R+1.8760108*k+.041556*O),j=x(.0556434*R-.2040259*k+1.0572252*O);return at.fromRgb(Math.round(Va(H,0,255)),Math.round(Va(B,0,255)),Math.round(Va(j,0,255)))}e.toColor=a;function o(D,k){var R=k[0],O=k[1],H=k[2],B=Math.sqrt(O*O+H*H),j=(ku(Math.atan2(H,O))+360)%360;return Math.round(B*1e4)===0&&(j=Number.NaN),D[0]=j,D[1]=B,D[2]=R,D}e.toHcl=o;function s(D,k){return D[0]=k[0],D[1]=k[1],D[2]=k[2],D}e.copy=s;function u(D,k,R){return D[0]=k[0]-h*R,D[1]=k[1],D[2]=k[2],D}e.darken=u;function l(D,k,R){return u(D,k,-R)}e.lighten=l;var c=[0,0,0];function d(D,k,R){return o(c,k),Wl.toLab(D,Wl.saturate(c,c,R))}e.saturate=d;function f(D,k,R){return d(D,k,-R)}e.desaturate=f;var h=18,v=.95047,p=1,m=1.08883,g=.137931034,y=.206896552,b=.12841855,S=.008856452;function x(D){return 255*(D<=.00304?12.92*D:1.055*Math.pow(D,1/2.4)-.055)}function C(D){return D>y?D*D*D:b*(D-g)}function w(D){return(D/=255)<=.04045?D/12.92:Math.pow((D+.055)/1.055,2.4)}function A(D){return D>S?Math.pow(D,1/3):D/b+g}function M(D,k,R){D=w(D),k=w(k),R=w(R);var O=A((.4124564*D+.3575761*k+.1804375*R)/v),H=A((.2126729*D+.7151522*k+.072175*R)/p),B=A((.0193339*D+.119192*k+.9503041*R)/m);return[O,H,B]}})(da||(da={}));function Wl(){return Wl.zero()}(function(e){function t(){var m=[.1,0,0];return m[0]=0,m}e.zero=t;function r(m,g,y){var b=t();return b[0]=m,b[1]=g,b[2]=y,b}e.create=r;var n=[0,0,0];function i(m,g){return da.toHcl(m,da.fromColor(n,g))}e.fromColor=i;function a(m,g){return da.toHcl(m,g)}e.fromLab=a;var o=[0,0,0];function s(m){return da.toColor(u(o,m))}e.toColor=s;function u(m,g){var y=g[0],b=g[1],S=g[2];return isNaN(y)&&(y=0),y=Jr(y),m[0]=S,m[1]=Math.cos(y)*b,m[2]=Math.sin(y)*b,m}e.toLab=u;function l(m,g){return m[0]=g[0],m[1]=g[1],m[2]=g[2],m}e.copy=l;function c(m,g,y){return m[0]=g[0],m[1]=Math.max(0,g[1]+p*y),m[2]=g[2],m}e.saturate=c;function d(m,g,y){return c(m,g,-y)}e.desaturate=d;var f=[0,0,0];function h(m,g,y){return u(f,g),da.toHcl(m,da.darken(f,f,y))}e.darken=h;function v(m,g,y){return h(m,g,-y)}e.lighten=v;var p=18})(Wl||(Wl={}));function at(e){return e}(function(e){function t(M){return"rgb("+(M>>16&255)+", "+(M>>8&255)+", "+(M&255)+")"}e.toStyle=t;function r(M){return"0x"+("000000"+M.toString(16)).slice(-6)}e.toHexString=r;function n(M){return"RGB: "+e.toRgb(M).join(", ")}e.toRgbString=n;function i(M){return[M>>16&255,M>>8&255,M&255]}e.toRgb=i;function a(M){return[(M>>16&255)/255,(M>>8&255)/255,(M&255)/255]}e.toRgbNormalized=a;function o(M,D,k){return M<<16|D<<8|k}e.fromRgb=o;function s(M,D,k){return M*255<<16|D*255<<8|k*255}e.fromNormalizedRgb=s;function u(M,D){return o(M[D],M[D+1],M[D+2])}e.fromArray=u;function l(M,D){return s(M[D],M[D+1],M[D+2])}e.fromNormalizedArray=l;function c(M,D,k){return D[k]=M>>16&255,D[k+1]=M>>8&255,D[k+2]=M&255,D}e.toArray=c;function d(M,D,k){return D[k]=(M>>16&255)/255,D[k+1]=(M>>8&255)/255,D[k+2]=(M&255)/255,D}e.toArrayNormalized=d;function f(M,D){return M[0]=D>>16&255,M[1]=D>>8&255,M[2]=D&255,M}e.toVec3=f;function h(M,D){return M[0]=(D>>16&255)/255,M[1]=(D>>8&255)/255,M[2]=(D&255)/255,M}e.toVec3Normalized=h;function v(M,D,k){var R=M>>16&255,O=M>>8&255,H=M&255,B=D>>16&255,j=D>>8&255,Y=D&255,G=R+(B-R)*k,$=O+(j-O)*k,q=H+(Y-H)*k;return G<<16|$<<8|q}e.interpolate=v;var p=[0,0,0];function m(M,D){return Wl.fromColor(p,M),Wl.toColor(Wl.saturate(p,p,D))}e.saturate=m;function g(M,D){return m(M,-D)}e.desaturate=g;var y=[0,0,0];function b(M,D){return da.fromColor(y,M),da.toColor(da.darken(y,y,D))}e.darken=b;function S(M,D){return b(M,-D)}e.lighten=S;function x(M){return M<.04045?M*.0773993808:Math.pow(M*.9478672986+.0521327014,2.4)}function C(M){return s(x((M>>16&255)/255),x((M>>8&255)/255),x((M&255)/255))}e.sRGBToLinear=C;function w(M){return M<.0031308?M*12.92:1.055*Math.pow(M,.41666)-.055}function A(M){return s(w((M>>16&255)/255),w((M>>8&255)/255),w((M&255)/255))}e.linearToSRGB=A})(at||(at={}));function wr(e,t,r,n){return{label:e,description:r,list:n,type:t}}function IE(e,t,r){var n={};for(var i in e){var a=e[i];a=at.saturate(a,t),a=at.darken(a,-r),n[i]=a}return n}function mZ(e,t){return t===void 0&&(t=" "),e.replace(/([a-z\xE0-\xFF])([A-Z\xC0\xDF])/g,"$1"+t+"$2")}function Wa(e){return L0(mZ(e))}var QIe=function(e){return e.toUpperCase()};function ZIe(e){return e?typeof e=="string"?e.toUpperCase():(""+e).toUpperCase():""}function L0(e){return e.toLowerCase().replace(/^\w|\s\w/g,QIe)}function JIe(e){return e.replace(/_/g," ")}function eMe(e){return e.replace(/-/g," ")}function is(e){return L0(mZ(JIe(eMe(e))))}function yi(e,t,r,n){var i=n.length;if(i>r-t)return!1;for(var a=0;a<i;a++)if(e.charCodeAt(t+a)!==n.charCodeAt(a))return!1;return!0}function tMe(e,t){var r=Object.keys(t),n=Object.values(t);return new(Function.bind.apply(Function,Nt(Nt([void 0],r),["return `"+e+"`;"])))().apply(void 0,n)}function Wf(e){return e.replace(/<\/?[^>]+>/g,"")}var Mo={"orange-red":wr("Orange-Red","sequential","Orange-Red, sequential color scheme from ColorBrewer 2.0",[16775148,16705736,16635038,16628612,16551257,15689032,14102559,11730944,8323072]),"purple-blue":wr("Purple-Blue","sequential","Purple-Blue, sequential color scheme from ColorBrewer 2.0",[16775163,15525874,13685222,10927579,7645647,3576e3,356528,285325,145496]),"blue-purple":wr("Blue-Purple","sequential","Blue-Purple, sequential color scheme from ColorBrewer 2.0",[16252157,14740724,12571622,10403034,9213638,9202609,8929693,8458108,5046347]),oranges:wr("Oranges","sequential","",[16774635,16705230,16634018,16625259,16616764,15821075,14239745,10892803,8333060]),"blue-green":wr("Blue-Green","sequential","",[16252157,15070713,13429990,10082505,6734500,4304502,2329413,27948,17435]),"yellow-orange-brown":wr("Yellow-Orange-Brown","sequential","",[16777189,16775100,16704401,16696399,16685353,15495188,13388802,10040324,6694150]),"yellow-green":wr("Yellow-Green","sequential","",[16777189,16252089,14282915,11394446,7915129,4303709,2327619,26679,17705]),reds:wr("Reds","sequential","",[16774640,16703698,16563105,16552562,16476746,15678252,13309981,10817301,6750221]),"red-purple":wr("Red-Purple","sequential","",[16775155,16638173,16565696,16424885,16214177,14496919,11403646,7995767,4784234]),greens:wr("Greens","sequential","",[16252149,15070688,13101504,10607003,7652470,4303709,2329413,27948,17435]),"yellow-green-blue":wr("Yellow-Green-Blue","sequential","",[16777177,15595697,13101492,8375739,4306628,1937856,2252456,2438292,531800]),purples:wr("Purples","sequential","",[16579581,15724021,14342891,12369372,10394312,8420794,6967715,5515151,4128893]),"green-blue":wr("Green-Blue","sequential","",[16252144,14742491,13429701,11066805,8113348,5157843,2854078,551084,540801]),greys:wr("Greys","sequential","",[16777215,15790320,14277081,12434877,9868950,7566195,5395026,2434341,0]),"yellow-orange-red":wr("Yellow-Orange-Red","sequential","",[16777164,16772512,16701814,16691788,16616764,16535082,14883356,12386342,8388646]),"purple-red":wr("Purple-Red","sequential","",[16250105,15196655,13941210,13210823,14640560,15149450,13505110,9961539,6750239]),blues:wr("Blues","sequential","",[16251903,14609399,13032431,10406625,7057110,4362950,2191797,545180,536683]),"purple-blue-green":wr("Purple-Blue-Green","sequential","",[16775163,15524592,13685222,10927579,6793679,3576e3,164234,93273,83510]),spectral:wr("Spectral","diverging","",[10355010,13975119,16018755,16625249,16703627,16777151,15136152,11263396,6734501,3311805,6180770]),"red-yellow-green":wr("Red-Yellow-Green","diverging","",[10813478,14102567,16018755,16625249,16703627,16777151,14282635,10934634,6733155,1742928,26679]),"red-blue":wr("Red-Blue","diverging","",[6750239,11671595,14049357,16033154,16636871,16250871,13755888,9618910,4428739,2188972,340065]),"pink-yellow-green":wr("Pink-Yellow-Green","diverging","",[9306450,12917629,14579630,15840986,16638191,16250871,15136208,12116358,8371265,5083681,2581529]),"purple-green":wr("Purple-Green","diverging","",[4194379,7744131,10055851,12756431,15193320,16250871,14282963,10935200,5942881,1800247,17435]),"red-yellow-blue":wr("Red-Yellow-Blue","diverging","Red-Yellow-Blue, diverging color scheme from ColorBrewer 2.0",[10813478,14102567,16018755,16625249,16703632,16777151,14742520,11262441,7646673,4552116,3225237]),"brown-white-green":wr("Brown-White-Green","diverging","",[5517317,9195786,12550445,14664317,16181443,16119285,13101797,8441281,3512207,91742,15408]),"red-grey":wr("Red-Grey","diverging","",[6750239,11671595,14049357,16033154,16636871,16777215,14737632,12237498,8882055,5066061,1710618]),"orange-purple":wr("Orange-Purple","diverging","",[8338184,11753478,14713364,16627811,16703670,16250871,14211819,11709394,8418220,5515144,2949195]),"set-2":wr("Set-2","qualitative","",[6734501,16551266,9281739,15174339,10934356,16767279,15058068,11776947]),accent:wr("Accent","qualitative","",[8374655,12496596,16629894,16777113,3697840,15729279,12540695,6710886]),"set-1":wr("Set-1","qualitative","",[14948892,3636920,5091146,9981603,16744192,16777011,10901032,16220607,10066329]),"set-3":wr("Set-3","qualitative","",[9294791,16777139,12499674,16482418,8434131,16626786,11787881,16567781,14277081,12353725,13429701,16772463]),"dark-2":wr("Dark-2","qualitative","",[1810039,14245634,7696563,15149450,6727198,15117058,10909213,6710886]),paired:wr("Paired","qualitative","",[10931939,2062516,11722634,3383340,16489113,14883356,16629615,16744192,13284054,6962586,16777113,11622696]),"pastel-2":wr("Pastel-2","qualitative","",[11789005,16633260,13358568,16042724,15136201,16773806,15852236,13421772]),"pastel-1":wr("Pastel-1","qualitative","",[16495790,11783651,13429701,14601188,16701862,16777164,15063229,16636652,15921906]),"many-distinct":wr("Many-Distinct","qualitative","",[1810039,14245634,7696563,15149450,6727198,15117058,10909213,6710886,14948892,3636920,5091146,9981603,16744192,16777011,10901032,16220607,10066329,6734501,16551266,9281739,15174339,10934356,16767279,15058068,11776947]),magma:wr("Magma","sequential","Perceptually uniform shades of black-red-white",[4329332,4853881,5378684,5903742,6363263,6888576,7413633,7938689,8463745,8988801,9513600,10038655,10563454,11088508,11613562,12138360,12728949,13254258,13714030,14239338,14699366,15094114,15489119,15753309,16017499,16216411,16350045,16483424,16551523,16619368,16621934,16689780,16692091,16694402,16696969,16633746,16636058,16638371,16575148,16577461,16514239]),inferno:wr("Inferno","sequential","Perceptually uniform shades of black-red-yellow",[4721514,5246316,5771373,6296430,6821486,7346542,7871597,8396651,8921450,9446504,9971557,10496610,10956127,11481435,12006486,12466258,12926285,13386056,13780802,14241085,14570295,14965297,15229227,15558693,15757342,15956248,16154897,16288267,16421638,16489734,16492043,16494612,16496926,16368426,16305463,16111429,15982678,15853928,15856253,16119953,16580260]),plasma:wr("Plasma","sequential","Perceptually uniform shades of blue-red-yellow",[1771148,2426257,3081365,3671193,4195228,4784799,5308834,5833124,6357158,6815911,7340200,7864744,8324007,8783782,9309348,9769377,10164126,10624154,11018902,11413393,11808141,12137352,12466307,12795519,13124730,13453685,13717361,14046573,14309992,14573668,14837344,15035483,15299159,15497299,15695438,15893834,16091974,16224833,16357693,16425017,16557877,16625457,16627245,16629289,16631334,16567845,16438820,16310052,16115494,15921190,15726625]),viridis:wr("Viridis","sequential","Perceptually uniform shades of blue-green-yellow",[4524123,4656994,4658793,4726127,4727668,4663929,4599933,4535937,4406404,4276870,4081800,3952010,3822475,3627148,3497356,3302029,3172237,3042446,2912654,2782862,2652814,2523022,2393229,2328973,2198924,2069132,2004874,2005897,2007175,2139525,2337154,2666111,3060348,3520376,4045684,4570991,5227369,5883748,6605661,7392854,8180303,8967495,9819967,10672695,11525166,12443174,13295646,14148121,15000344,15852828,16639780]),cividis:wr("Cividis","sequential","Perceptually uniform shades of blue-green-yellow, should look effectively identical to colorblind and non-colorblind users",[11367,12400,537456,1455727,2046574,2571629,3031404,3425388,3754092,4148075,4476779,4805227,5133932,5396844,5725549,5988462,6317166,6580079,6843249,7171698,7434867,7697781,7960951,8289656,8618104,8881272,9209976,9538679,9867127,10195830,10524533,10853235,11181938,11510640,11839343,12168045,12497002,12891240,13219941,13548642,13943134,14271834,14666326,14995025,15389516,15718470,16112703,16507190,16639799]),twilight:wr("Twilight","sequential","Perceptually uniform shades of white-blue-black-red-white, cyclic",[14670305,14211037,13554648,12766675,11847630,10993866,10139847,9351365,8628419,8036290,7509952,7048895,6718653,6519739,6386105,6252470,6184114,6181293,6112935,6044831,5976470,5777291,5447293,5052270,4592479,4067665,3674181,3281211,3150646,3543352,4067644,4657728,5379141,6166345,6953549,7741007,8463184,9120336,9777743,10304079,10830671,11291984,11687762,12083541,12348505,12613471,12878439,13077872,13211771,13411209,13545111,13809830,14074293,14338756,14537169,14735067,14801121]),turbo:wr("Turbo","sequential","Improved (smooth) rainbow colormap for visualization",[4866485,4872413,4354034,3770361,3120629,2667241,2475736,2611140,3073454,3928216,5109892,6487408,8126047,9829201,11531332,13167162,14605618,15780908,16693543,16753699,16748063,16741916,16146200,15026195,13644558,12198408,10818563,9833728]),rainbow:wr("Rainbow","sequential","",[3367393,3516485,16383744,15501073,12526114]),"red-white-blue":wr("Red-White-Blue","diverging","",[12526114,16777215,3367393])},rMe=Object.keys(Mo),x6=rMe.map(function(e){return[e,Mo[e].label,L0(Mo[e].type)]}),nMe=x6.filter(function(e){return Mo[e[0]].type==="diverging"||Mo[e[0]].type==="sequential"}),iMe=x6.filter(function(e){return Mo[e[0]].type==="qualitative"});function Ks(e){return e in Mo?Mo[e]:(console.warn("unknown color list named '"+e+"'"),Mo["red-yellow-blue"])}function Gh(e){return{kind:"table-legend",table:e}}function aMe(e,t,r){return{kind:"scale-legend",minLabel:e,maxLabel:t,colors:r}}var qe;(function(e){function t(f){return f.creator&&f.chunkSize}e.is=t;function r(f){var h=f.growBy*f.elementSize;f.currentSize=h,f.currentIndex=0,f.currentChunk=new f.ctor(h),f.allocatedSize+=h,f.chunks[f.chunks.length]=f.currentChunk}function n(f,h,v,p,m){f.currentIndex>=f.currentSize&&r(f);var g=f.currentChunk,y=f.currentIndex;return g[y]=h,g[y+1]=v,g[y+2]=p,g[y+3]=m,f.currentIndex+=4,f.elementCount++}e.add4=n;function i(f,h,v,p){f.currentIndex>=f.currentSize&&r(f);var m=f.currentChunk,g=f.currentIndex;return m[g]=h,m[g+1]=v,m[g+2]=p,f.currentIndex+=3,f.elementCount++}e.add3=i;function a(f,h,v){f.currentIndex>=f.currentSize&&r(f);var p=f.currentChunk,m=f.currentIndex;return p[m]=h,p[m+1]=v,f.currentIndex+=2,f.elementCount++}e.add2=a;function o(f,h){return f.currentIndex>=f.currentSize&&r(f),f.currentChunk[f.currentIndex]=h,f.currentIndex+=1,f.elementCount++}e.add=o;function s(f,h,v){for(var p=0;p<h;p++)f.currentIndex>=f.currentSize&&r(f),f.currentChunk[f.currentIndex++]=v,f.elementCount++;return f.elementCount}e.addRepeat=s;function u(f,h){for(var v=f.elementSize,p=0,m=h.length;p<m;p+=v){f.currentIndex>=f.currentSize&&r(f);for(var g=f.currentChunk,y=0;y<v;y++)g[f.currentIndex++]=h[p+y];f.elementCount++}return f.elementCount}e.addMany=u;function l(f,h){return h===void 0&&(h=!1),c(f,h)}e.compact=l;function c(f,h){var v=f.ctor,p=f.chunks,m=f.currentIndex;if(!p.length)return new v(0);if(p.length===1&&(h||m===f.allocatedSize))return p[0];for(var g=0,y=0,b=p.length-1;y<b;y++)g+=p[y].length;g+=f.currentIndex;var S=new v(g),x=0;if(S.buffer)for(var y=0,b=p.length-1;y<b;y++)S.set(p[y],x),x+=p[y].length;else for(var y=0,b=p.length-1;y<b;y++){for(var C=p[y],w=0,A=C.length;w<A;w++)S[x+w]=C[w];x+=C.length}var M=p[p.length-1];if(S.buffer&&m>=f.currentSize)S.set(M,x);else for(var w=0,A=M.length;w<A;w++)S[x+w]=M[w];return S}e._compact=c;function d(f,h,v,p){var m={ctor:f,elementSize:h,growBy:Math.max(1,Math.ceil(v)),allocatedSize:0,elementCount:0,currentSize:0,currentChunk:void 0,currentIndex:0,chunks:[]};if(typeof p>"u")return m;if(typeof p=="number")return m.currentChunk=new f(p*h),m.allocatedSize=p*h,m.currentSize=m.currentChunk.length,m.chunks[0]=m.currentChunk,m;var g=p;if(g.length%h!==0)throw new Error("initialChunk length must be a multiple of the element size.");return m.currentChunk=g,m.allocatedSize=g.length,m.currentSize=g.length,m.chunks[0]=g,m}e.create=d})(qe||(qe={}));function X_(e,t,r){return e[t]-e[r]}function Vp(e,t,r){var n=e[t];e[t]=e[r],e[r]=n}function gZ(e,t,r,n){var i=r+n>>1;return t(e,r,n)>0?t(e,r,i)>0?t(e,i,n)>0?i:n:r:t(e,n,i)>0?t(e,i,r)>0?i:r:n}function oMe(e,t,r){var n=e.cmp,i=e.swap,a=e.data,o=e.parts,s=t+1,u=r;for(i(a,t,gZ(a,n,t,r));n(a,u,t)>0;)--u;for(var l=t+1;l<=u;l++){var c=n(a,l,t);if(c>0){for(i(a,l,u),--u;n(a,u,t)>0;)--u;l--}else c===0&&(i(a,l,s),s++)}for(var l=t;l<s;l++)i(a,l,t+u-l);o[0]=u-s+t+1,o[1]=u}function sMe(e,t,r){for(var n=e.data,i=e.cmp,a=e.swap,o=t+1;o<=r;o++)for(var s=o-1;s>=t&&i(n,s,s+1)>0;)a(n,s,s+1),s=s-1}function Y_(e,t,r){for(var n=e.parts;t<r;){if(r-t<16){sMe(e,t,r);return}oMe(e,t,r);var i=n[0],a=n[1];i-t<r-a?(Y_(e,t,i-1),t=a+1):(Y_(e,a+1,r),r=i-1)}}function uMe(e,t,r,n){var i=r+1,a=n;Vp(e,r,gZ(e,X_,r,n));for(var o=e[r];e[a]>o;)--a;for(var s=r+1;s<=a;s++){var u=e[s];if(u>o){for(Vp(e,s,a),--a;e[a]>o;)--a;s--}else u===o&&(Vp(e,s,i),++i)}for(var s=r;s<i;s++)Vp(e,s,r+a-s);t[0]=a-i+r+1,t[1]=a}function lMe(e,t,r){for(var n=t+1;n<=r;n++){for(var i=e[n],a=n-1;a>=t&&e[a]>i;)e[a+1]=e[a],a=a-1;e[a+1]=i}}function W5(e,t,r,n){for(;r<n;){if(n-r<16){lMe(e,r,n);return}uMe(e,t,r,n);var i=t[0],a=t[1];i-r<n-a?(W5(e,t,r,i-1),r=a+1):(W5(e,t,a+1,n),n=i-1)}}function Ou(e,t){return t===void 0&&(t=X_),cMe(e,0,e.length,t)}function cMe(e,t,r,n){return n===void 0&&(n=X_),n===X_?W5(e,[0,0],t,r-1):Y_({data:e,cmp:n,swap:Vp,parts:[0,0]},t,r-1),e}function yZ(e,t,r,n,i){var a={data:e,cmp:n,swap:i,parts:[0,0]};return Y_(a,t,r-1),e}function dMe(e,t,r){return e[t].key<e[r].key?-1:1}function fMe(e,t,r,n,i){for(var a=new Map,o=[],s=t(e[0]),u=!0,l=n;l<i;l++){var c=t(e[l]);if(a.has(c))a.get(c).count++,s!==c&&(u=!1);else{var d={key:c,count:1,offset:l};a.set(c,d),o[o.length]=d}s=c}var f=new Int32Array(o.length+1);f[o.length]=i;var h=!0;if(r){for(var l=1,v=o.length;l<v;l++)if(o[l-1].key>o[l].key){h=!1;break}}if(u&&h){for(var l=0;l<o.length;l++)f[l]=o[l].offset;return f}r&&!h&&yZ(o,0,o.length,dMe,Vp);for(var p=0,l=0;l<o.length;l++){var m=o[l];m.offset=p,p+=m.count}for(var g=new Int32Array(i-n),l=n;l<i;l++){var c=t(e[l]),d=a.get(c);g[d.offset++]=e[l]}for(var l=0,v=g.length;l<v;l++)e[l+n]=g[l];f[0]=n;for(var l=1;l<o.length;l++)f[l]=o[l-1].offset+n;return f}function kP(e,t,r){var n=r&&r.start||0,i=r&&r.end||e.length;if(i-n<=0)throw new Error("Can only bucket non-empty collections.");return fMe(e,t,!!(r&&r.sort),n,i)}var hMe=function(){function e(t,r){this.getHash=t,this.areEqual=r,this.id=0,this.byHash=new Map,this.groups=[]}return e.prototype.createGroup=function(t,r){var n=this.id++,i=[t];return this.groups[n]=i,{id:n,keys:i,value:r}},e.prototype.add=function(t,r){var n=this.getHash(r);if(this.byHash.has(n)){for(var i=this.byHash.get(n),a=0,o=i.length;a<o;a++){var s=i[a];if(this.areEqual(r,s.value))return s.keys[s.keys.length]=t,s.value}var u=this.createGroup(t,r);return i[i.length]=u,u.value}else{var u=this.createGroup(t,r);return this.byHash.set(n,[u]),u.value}},e}();function pMe(e,t){return new hMe(e,t)}function bZ(e){var t=e^e>>4;return t=(t^3735928559)+(t<<5),t=t^t>>11,t}function Kv(e,t){var r=23;return r=31*r+e|0,r=31*r+t|0,r=r^r>>4,r=(r^3735928559)+(r<<5),r=r^r>>11,r}function vMe(e,t,r){var n=23;return n=31*n+e|0,n=31*n+t|0,n=31*n+r|0,n=n^n>>4,n=(n^3735928559)+(n<<5),n=n^n>>11,n}function mMe(e,t,r,n){var i=23;return i=31*i+e|0,i=31*i+t|0,i=31*i+r|0,i=31*i+n|0,i=i^i>>4,i=(i^3735928559)+(i<<5),i=i^i>>11,i}function S6(e){for(var t=0,r=0,n=e.length;r<n;r++)t=(t<<5)-t+e.charCodeAt(r++)|0;return t}function ph(e,t){return(e+t)*(e+t+1)/2+t}function Xa(e){for(var t=2166136261,r=0,n=e.length;r<n;++r)t^=e[r],t+=(t<<1)+(t<<4)+(t<<7)+(t<<8)+(t<<24);return t>>>0}function K_(e,t){var r=t&&typeof t.start<"u"?Math.max(Math.min(t.start,e-1),0):0,n=t&&typeof t.end<"u"?Math.min(t.end,e):e;return{start:r,end:n}}function w2(e,t){var r=t&&typeof t.array<"u"?t.array:Array,n=K_(e,t),i=n.start,a=n.end;return{array:new r(a-i),start:i,end:a}}function gMe(e,t,r){for(var n=0,i=t.length;n<i;n++)t[n]=e(r+n);return t}function ua(e,t,r){var n=w2(e,r),i=n.array,a=n.start;return gMe(t,i,a)}function C6(e){return!!e.buffer&&typeof e.byteLength=="number"&&typeof e.BYTES_PER_ELEMENT=="number"}function Q_(e,t){var r=e.constructor,n=e.buffer,i=e.length,a=e.byteOffset,o=e.BYTES_PER_ELEMENT,s=K_(i,t),u=s.start,l=s.end;return u===0&&l===i?e:new r(n,a+o*u,Math.min(i,l-u))}var _n=1e-6;function Sn(e,t,r){return Math.abs(e-t)<=r}function ue(){return ue.zero()}(function(e){function t(){var F=[.1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];return F[0]=0,F}e.zero=t;function r(){var F=t();return F[0]=1,F[1]=0,F[2]=0,F[3]=0,F[4]=0,F[5]=1,F[6]=0,F[7]=0,F[8]=0,F[9]=0,F[10]=1,F[11]=0,F[12]=0,F[13]=0,F[14]=0,F[15]=1,F}e.identity=r;function n(F){return F[0]=1,F[1]=0,F[2]=0,F[3]=0,F[4]=0,F[5]=1,F[6]=0,F[7]=0,F[8]=0,F[9]=0,F[10]=1,F[11]=0,F[12]=0,F[13]=0,F[14]=0,F[15]=1,F}e.setIdentity=n;function i(F){for(var V=0;V<16;V++)F[V]=0;return F}e.setZero=i;function a(F){for(var V=t(),pe=0;pe<4;pe++)for(var we=F[pe],Te=0;Te<4;Te++)V[4*Te+pe]=we[Te];return V}e.ofRows=a;var o=r();function s(F,V){return l(F,o,typeof V>"u"?_n:V)}e.isIdentity=s;function u(F){for(var V=0;V<16;V++)if(isNaN(F[V]))return!0;return!1}e.hasNaN=u;function l(F,V,pe){for(var we=0;we<16;we++)if(Math.abs(F[we]-V[we])>pe)return!1;return!0}e.areEqual=l;function c(F,V,pe,we){F[4*pe+V]=we}e.setValue=c;function d(F,V,pe){return F[4*pe+V]}e.getValue=d;function f(F,V,pe){return V[pe+0]=F[0],V[pe+1]=F[1],V[pe+2]=F[2],V[pe+3]=F[3],V[pe+4]=F[4],V[pe+5]=F[5],V[pe+6]=F[6],V[pe+7]=F[7],V[pe+8]=F[8],V[pe+9]=F[9],V[pe+10]=F[10],V[pe+11]=F[11],V[pe+12]=F[12],V[pe+13]=F[13],V[pe+14]=F[14],V[pe+15]=F[15],V}e.toArray=f;function h(F,V,pe){return F[0]=V[pe+0],F[1]=V[pe+1],F[2]=V[pe+2],F[3]=V[pe+3],F[4]=V[pe+4],F[5]=V[pe+5],F[6]=V[pe+6],F[7]=V[pe+7],F[8]=V[pe+8],F[9]=V[pe+9],F[10]=V[pe+10],F[11]=V[pe+11],F[12]=V[pe+12],F[13]=V[pe+13],F[14]=V[pe+14],F[15]=V[pe+15],F}e.fromArray=h;function v(F,V,pe,we){return i(F),c(F,0,0,V[0]),c(F,1,0,V[1]),c(F,2,0,V[2]),c(F,0,1,pe[0]),c(F,1,1,pe[1]),c(F,2,1,pe[2]),c(F,0,2,we[0]),c(F,1,2,we[1]),c(F,2,2,we[2]),c(F,3,3,1),F}e.fromBasis=v;function p(F,V){return F[0]=V[0],F[1]=V[1],F[2]=V[2],F[3]=V[3],F[4]=V[4],F[5]=V[5],F[6]=V[6],F[7]=V[7],F[8]=V[8],F[9]=V[9],F[10]=V[10],F[11]=V[11],F[12]=V[12],F[13]=V[13],F[14]=V[14],F[15]=V[15],F}e.copy=p;function m(F){return p(t(),F)}e.clone=m;function g(F,V){return F[0]=V[12],F[1]=V[13],F[2]=V[14],F}e.getTranslation=g;function y(F,V){var pe=V[0],we=V[1],Te=V[2],ze=V[4],Ve=V[5],Xe=V[6],ct=V[8],Ne=V[9],Qe=V[10];return F[0]=Math.sqrt(pe*pe+we*we+Te*Te),F[1]=Math.sqrt(ze*ze+Ve*Ve+Xe*Xe),F[2]=Math.sqrt(ct*ct+Ne*Ne+Qe*Qe),F}e.getScaling=y;function b(F,V){var pe=V[0]+V[5]+V[10],we=0;return pe>0?(we=Math.sqrt(pe+1)*2,F[3]=.25*we,F[0]=(V[6]-V[9])/we,F[1]=(V[8]-V[2])/we,F[2]=(V[1]-V[4])/we):V[0]>V[5]&&V[0]>V[10]?(we=Math.sqrt(1+V[0]-V[5]-V[10])*2,F[3]=(V[6]-V[9])/we,F[0]=.25*we,F[1]=(V[1]+V[4])/we,F[2]=(V[8]+V[2])/we):V[5]>V[10]?(we=Math.sqrt(1+V[5]-V[0]-V[10])*2,F[3]=(V[8]-V[2])/we,F[0]=(V[1]+V[4])/we,F[1]=.25*we,F[2]=(V[6]+V[9])/we):(we=Math.sqrt(1+V[10]-V[0]-V[5])*2,F[3]=(V[1]-V[4])/we,F[0]=(V[8]+V[2])/we,F[1]=(V[6]+V[9])/we,F[2]=.25*we),F}e.getRotation=b;function S(F,V){var pe=1/Math.sqrt(V[0]*V[0]+V[1]*V[1]+V[2]*V[2]),we=1/Math.sqrt(V[4]*V[4]+V[5]*V[5]+V[6]*V[6]),Te=1/Math.sqrt(V[8]*V[8]+V[9]*V[9]+V[10]*V[10]);return F[0]=V[0]*pe,F[1]=V[1]*pe,F[2]=V[2]*pe,F[3]=0,F[4]=V[4]*we,F[5]=V[5]*we,F[6]=V[6]*we,F[7]=0,F[8]=V[8]*Te,F[9]=V[9]*Te,F[10]=V[10]*Te,F[11]=0,F[12]=0,F[13]=0,F[14]=0,F[15]=1,F}e.extractRotation=S;function x(F,V){if(F===V){var pe=V[1],we=V[2],Te=V[3],ze=V[6],Ve=V[7],Xe=V[11];F[1]=V[4],F[2]=V[8],F[3]=V[12],F[4]=pe,F[6]=V[9],F[7]=V[13],F[8]=we,F[9]=ze,F[11]=V[14],F[12]=Te,F[13]=Ve,F[14]=Xe}else F[0]=V[0],F[1]=V[4],F[2]=V[8],F[3]=V[12],F[4]=V[1],F[5]=V[5],F[6]=V[9],F[7]=V[13],F[8]=V[2],F[9]=V[6],F[10]=V[10],F[11]=V[14],F[12]=V[3],F[13]=V[7],F[14]=V[11],F[15]=V[15];return F}e.transpose=x;function C(F,V){var pe=V[0],we=V[1],Te=V[2],ze=V[3],Ve=V[4],Xe=V[5],ct=V[6],Ne=V[7],Qe=V[8],it=V[9],ot=V[10],dt=V[11],ke=V[12],Me=V[13],Ye=V[14],tt=V[15],xt=pe*Xe-we*Ve,pt=pe*ct-Te*Ve,ut=pe*Ne-ze*Ve,he=we*ct-Te*Xe,me=we*Ne-ze*Xe,Ee=Te*Ne-ze*ct,Ke=Qe*Me-it*ke,gt=Qe*Ye-ot*ke,Pt=Qe*tt-dt*ke,Yt=it*Ye-ot*Me,dr=it*tt-dt*Me,Dr=ot*tt-dt*Ye,Qt=xt*Dr-pt*dr+ut*Yt+he*Pt-me*gt+Ee*Ke;return Qt?(Qt=1/Qt,F[0]=(Xe*Dr-ct*dr+Ne*Yt)*Qt,F[1]=(Te*dr-we*Dr-ze*Yt)*Qt,F[2]=(Me*Ee-Ye*me+tt*he)*Qt,F[3]=(ot*me-it*Ee-dt*he)*Qt,F[4]=(ct*Pt-Ve*Dr-Ne*gt)*Qt,F[5]=(pe*Dr-Te*Pt+ze*gt)*Qt,F[6]=(Ye*ut-ke*Ee-tt*pt)*Qt,F[7]=(Qe*Ee-ot*ut+dt*pt)*Qt,F[8]=(Ve*dr-Xe*Pt+Ne*Ke)*Qt,F[9]=(we*Pt-pe*dr-ze*Ke)*Qt,F[10]=(ke*me-Me*ut+tt*xt)*Qt,F[11]=(it*ut-Qe*me-dt*xt)*Qt,F[12]=(Xe*gt-Ve*Yt-ct*Ke)*Qt,F[13]=(pe*Yt-we*gt+Te*Ke)*Qt,F[14]=(Me*pt-ke*he-Ye*xt)*Qt,F[15]=(Qe*he-it*pt+ot*xt)*Qt,!0):!1}e.tryInvert=C;function w(F,V){return C(F,V)||console.warn("non-invertible matrix.",V),F}e.invert=w;function A(F,V,pe){var we=V[0],Te=V[1],ze=V[2],Ve=V[3],Xe=V[4],ct=V[5],Ne=V[6],Qe=V[7],it=V[8],ot=V[9],dt=V[10],ke=V[11],Me=V[12],Ye=V[13],tt=V[14],xt=V[15],pt=pe[0],ut=pe[1],he=pe[2],me=pe[3];return F[0]=pt*we+ut*Xe+he*it+me*Me,F[1]=pt*Te+ut*ct+he*ot+me*Ye,F[2]=pt*ze+ut*Ne+he*dt+me*tt,F[3]=pt*Ve+ut*Qe+he*ke+me*xt,pt=pe[4],ut=pe[5],he=pe[6],me=pe[7],F[4]=pt*we+ut*Xe+he*it+me*Me,F[5]=pt*Te+ut*ct+he*ot+me*Ye,F[6]=pt*ze+ut*Ne+he*dt+me*tt,F[7]=pt*Ve+ut*Qe+he*ke+me*xt,pt=pe[8],ut=pe[9],he=pe[10],me=pe[11],F[8]=pt*we+ut*Xe+he*it+me*Me,F[9]=pt*Te+ut*ct+he*ot+me*Ye,F[10]=pt*ze+ut*Ne+he*dt+me*tt,F[11]=pt*Ve+ut*Qe+he*ke+me*xt,pt=pe[12],ut=pe[13],he=pe[14],me=pe[15],F[12]=pt*we+ut*Xe+he*it+me*Me,F[13]=pt*Te+ut*ct+he*ot+me*Ye,F[14]=pt*ze+ut*Ne+he*dt+me*tt,F[15]=pt*Ve+ut*Qe+he*ke+me*xt,F}e.mul=A;function M(F,V,pe,we,Te,ze){var Ve=V[0+Te],Xe=V[1+Te],ct=V[2+Te],Ne=V[3+Te],Qe=V[4+Te],it=V[5+Te],ot=V[6+Te],dt=V[7+Te],ke=V[8+Te],Me=V[9+Te],Ye=V[10+Te],tt=V[11+Te],xt=V[12+Te],pt=V[13+Te],ut=V[14+Te],he=V[15+Te],me=pe[0+ze],Ee=pe[1+ze],Ke=pe[2+ze],gt=pe[3+ze];return F[0+we]=me*Ve+Ee*Qe+Ke*ke+gt*xt,F[1+we]=me*Xe+Ee*it+Ke*Me+gt*pt,F[2+we]=me*ct+Ee*ot+Ke*Ye+gt*ut,F[3+we]=me*Ne+Ee*dt+Ke*tt+gt*he,me=pe[4+ze],Ee=pe[5+ze],Ke=pe[6+ze],gt=pe[7+ze],F[4+we]=me*Ve+Ee*Qe+Ke*ke+gt*xt,F[5+we]=me*Xe+Ee*it+Ke*Me+gt*pt,F[6+we]=me*ct+Ee*ot+Ke*Ye+gt*ut,F[7+we]=me*Ne+Ee*dt+Ke*tt+gt*he,me=pe[8+ze],Ee=pe[9+ze],Ke=pe[10+ze],gt=pe[11+ze],F[8+we]=me*Ve+Ee*Qe+Ke*ke+gt*xt,F[9+we]=me*Xe+Ee*it+Ke*Me+gt*pt,F[10+we]=me*ct+Ee*ot+Ke*Ye+gt*ut,F[11+we]=me*Ne+Ee*dt+Ke*tt+gt*he,me=pe[12+ze],Ee=pe[13+ze],Ke=pe[14+ze],gt=pe[15+ze],F[12+we]=me*Ve+Ee*Qe+Ke*ke+gt*xt,F[13+we]=me*Xe+Ee*it+Ke*Me+gt*pt,F[14+we]=me*ct+Ee*ot+Ke*Ye+gt*ut,F[15+we]=me*Ne+Ee*dt+Ke*tt+gt*he,F}e.mulOffset=M;function D(F,V,pe,we){return A(F,A(F,V,pe),we)}e.mul3=D;function k(F,V,pe){var we=pe[0],Te=pe[1],ze=pe[2],Ve,Xe,ct,Ne,Qe,it,ot,dt,ke,Me,Ye,tt;return V===F?(F[12]=V[0]*we+V[4]*Te+V[8]*ze+V[12],F[13]=V[1]*we+V[5]*Te+V[9]*ze+V[13],F[14]=V[2]*we+V[6]*Te+V[10]*ze+V[14],F[15]=V[3]*we+V[7]*Te+V[11]*ze+V[15]):(Ve=V[0],Xe=V[1],ct=V[2],Ne=V[3],Qe=V[4],it=V[5],ot=V[6],dt=V[7],ke=V[8],Me=V[9],Ye=V[10],tt=V[11],F[0]=Ve,F[1]=Xe,F[2]=ct,F[3]=Ne,F[4]=Qe,F[5]=it,F[6]=ot,F[7]=dt,F[8]=ke,F[9]=Me,F[10]=Ye,F[11]=tt,F[12]=Ve*we+Qe*Te+ke*ze+V[12],F[13]=Xe*we+it*Te+Me*ze+V[13],F[14]=ct*we+ot*Te+Ye*ze+V[14],F[15]=Ne*we+dt*Te+tt*ze+V[15]),F}e.translate=k;function R(F,V){return F[0]=1,F[1]=0,F[2]=0,F[3]=0,F[4]=0,F[5]=1,F[6]=0,F[7]=0,F[8]=0,F[9]=0,F[10]=1,F[11]=0,F[12]=V[0],F[13]=V[1],F[14]=V[2],F[15]=1,F}e.fromTranslation=R;function O(F,V){return F[12]=V[0],F[13]=V[1],F[14]=V[2],F}e.setTranslation=O;function H(F,V,pe,we){return F[0]=pe[0],F[4]=pe[1],F[8]=pe[2],F[1]=we[0],F[5]=we[1],F[9]=we[2],F[2]=V[0],F[6]=V[1],F[10]=V[2],F}e.setAxes=H;function B(F,V,pe,we){var Te=we[0],ze=we[1],Ve=we[2],Xe=Math.sqrt(Te*Te+ze*ze+Ve*Ve),ct,Ne,Qe,it,ot,dt,ke,Me,Ye,tt,xt,pt,ut,he,me,Ee,Ke,gt,Pt,Yt,dr,Dr,Qt,ui;return Math.abs(Xe)<_n?r():(Xe=1/Xe,Te*=Xe,ze*=Xe,Ve*=Xe,ct=Math.sin(pe),Ne=Math.cos(pe),Qe=1-Ne,it=V[0],ot=V[1],dt=V[2],ke=V[3],Me=V[4],Ye=V[5],tt=V[6],xt=V[7],pt=V[8],ut=V[9],he=V[10],me=V[11],Ee=Te*Te*Qe+Ne,Ke=ze*Te*Qe+Ve*ct,gt=Ve*Te*Qe-ze*ct,Pt=Te*ze*Qe-Ve*ct,Yt=ze*ze*Qe+Ne,dr=Ve*ze*Qe+Te*ct,Dr=Te*Ve*Qe+ze*ct,Qt=ze*Ve*Qe-Te*ct,ui=Ve*Ve*Qe+Ne,F[0]=it*Ee+Me*Ke+pt*gt,F[1]=ot*Ee+Ye*Ke+ut*gt,F[2]=dt*Ee+tt*Ke+he*gt,F[3]=ke*Ee+xt*Ke+me*gt,F[4]=it*Pt+Me*Yt+pt*dr,F[5]=ot*Pt+Ye*Yt+ut*dr,F[6]=dt*Pt+tt*Yt+he*dr,F[7]=ke*Pt+xt*Yt+me*dr,F[8]=it*Dr+Me*Qt+pt*ui,F[9]=ot*Dr+Ye*Qt+ut*ui,F[10]=dt*Dr+tt*Qt+he*ui,F[11]=ke*Dr+xt*Qt+me*ui,V!==F&&(F[12]=V[12],F[13]=V[13],F[14]=V[14],F[15]=V[15]),F)}e.rotate=B;function j(F,V,pe){var we=pe[0],Te=pe[1],ze=pe[2],Ve=Math.sqrt(we*we+Te*Te+ze*ze),Xe,ct,Ne;return Math.abs(Ve)<_n?n(F):(Ve=1/Ve,we*=Ve,Te*=Ve,ze*=Ve,Xe=Math.sin(V),ct=Math.cos(V),Ne=1-ct,F[0]=we*we*Ne+ct,F[1]=Te*we*Ne+ze*Xe,F[2]=ze*we*Ne-Te*Xe,F[3]=0,F[4]=we*Te*Ne-ze*Xe,F[5]=Te*Te*Ne+ct,F[6]=ze*Te*Ne+we*Xe,F[7]=0,F[8]=we*ze*Ne+Te*Xe,F[9]=Te*ze*Ne-we*Xe,F[10]=ze*ze*Ne+ct,F[11]=0,F[12]=0,F[13]=0,F[14]=0,F[15]=1,F)}e.fromRotation=j;function Y(F,V,pe){var we=pe[0],Te=pe[1],ze=pe[2];return F[0]=V[0]*we,F[1]=V[1]*we,F[2]=V[2]*we,F[3]=V[3]*we,F[4]=V[4]*Te,F[5]=V[5]*Te,F[6]=V[6]*Te,F[7]=V[7]*Te,F[8]=V[8]*ze,F[9]=V[9]*ze,F[10]=V[10]*ze,F[11]=V[11]*ze,F[12]=V[12],F[13]=V[13],F[14]=V[14],F[15]=V[15],F}e.scale=Y;function G(F,V,pe){return F[0]=V[0]*pe,F[1]=V[1]*pe,F[2]=V[2]*pe,F[3]=V[3]*pe,F[4]=V[4]*pe,F[5]=V[5]*pe,F[6]=V[6]*pe,F[7]=V[7]*pe,F[8]=V[8]*pe,F[9]=V[9]*pe,F[10]=V[10]*pe,F[11]=V[11]*pe,F[12]=V[12],F[13]=V[13],F[14]=V[14],F[15]=V[15],F}e.scaleUniformly=G;function $(F,V){return F[0]=V[0],F[1]=0,F[2]=0,F[3]=0,F[4]=0,F[5]=V[1],F[6]=0,F[7]=0,F[8]=0,F[9]=0,F[10]=V[2],F[11]=0,F[12]=0,F[13]=0,F[14]=0,F[15]=1,F}e.fromScaling=$;function q(F,V){return F[0]=V,F[1]=0,F[2]=0,F[3]=0,F[4]=0,F[5]=V,F[6]=0,F[7]=0,F[8]=0,F[9]=0,F[10]=V,F[11]=0,F[12]=0,F[13]=0,F[14]=0,F[15]=1,F}e.fromUniformScaling=q;function ee(F,V){return F[0]=V[0],F[1]=V[1],F[2]=V[2],F[4]=V[3],F[5]=V[4],F[6]=V[5],F[8]=V[6],F[9]=V[7],F[10]=V[8],F}e.fromMat3=ee;function fe(F){for(var V="",pe=0;pe<4;pe++){for(var we=0;we<4;we++)V+=F[4*we+pe].toString(),we<3&&(V+=" ");pe<3&&(V+=`
`)}return V}e.makeTable=fe;function W(F){var V=F[0],pe=F[1],we=F[2],Te=F[3],ze=F[4],Ve=F[5],Xe=F[6],ct=F[7],Ne=F[8],Qe=F[9],it=F[10],ot=F[11],dt=F[12],ke=F[13],Me=F[14],Ye=F[15],tt=V*Ve-pe*ze,xt=V*Xe-we*ze,pt=V*ct-Te*ze,ut=pe*Xe-we*Ve,he=pe*ct-Te*Ve,me=we*ct-Te*Xe,Ee=Ne*ke-Qe*dt,Ke=Ne*Me-it*dt,gt=Ne*Ye-ot*dt,Pt=Qe*Me-it*ke,Yt=Qe*Ye-ot*ke,dr=it*Ye-ot*Me;return tt*dr-xt*Yt+pt*Pt+ut*gt-he*Ke+me*Ee}e.determinant=W;function X(F,V){return U(F,typeof V<"u"?V:_n)}e.isRotationAndTranslation=X;function U(F,V){var pe=F[0],we=F[1],Te=F[2],ze=F[3],Ve=F[4],Xe=F[5],ct=F[6],Ne=F[7],Qe=F[8],it=F[9],ot=F[10],dt=F[11],ke=F[15];if(!Sn(ke,1,V)||!Sn(ze,0,V)||!Sn(Ne,0,V)||!Sn(dt,0,V))return!1;var Me=Math.abs(pe*(Xe*ot-ct*it)-we*(Ve*ot-ct*Qe)+Te*(Ve*it-Xe*Qe));return!!Sn(Me,1,V)}function z(F,V){return J(F,typeof V<"u"?V:_n)}e.isTranslationAndUniformScaling=z;function J(F,V){var pe=F[0];return Sn(F[1],0,V)&&Sn(F[2],0,V)&&Sn(F[3],0,V)&&Sn(F[4],0,V)&&Sn(F[5],pe,V)&&Sn(F[6],0,V)&&Sn(F[7],0,V)&&Sn(F[8],0,V)&&Sn(F[9],0,V)&&Sn(F[10],pe,V)&&Sn(F[11],0,V)&&Sn(F[15],1,V)}function K(F,V){var pe=V[0],we=V[1],Te=V[2],ze=V[3],Ve=pe+pe,Xe=we+we,ct=Te+Te,Ne=pe*Ve,Qe=we*Ve,it=we*Xe,ot=Te*Ve,dt=Te*Xe,ke=Te*ct,Me=ze*Ve,Ye=ze*Xe,tt=ze*ct;return F[0]=1-it-ke,F[1]=Qe+tt,F[2]=ot-Ye,F[3]=0,F[4]=Qe-tt,F[5]=1-Ne-ke,F[6]=dt+Me,F[7]=0,F[8]=ot+Ye,F[9]=dt-Me,F[10]=1-Ne-it,F[11]=0,F[12]=0,F[13]=0,F[14]=0,F[15]=1,F}e.fromQuat=K;function Z(F,V,pe,we,Te,ze,Ve){var Xe=2*ze/(pe-V),ct=2*ze/(we-Te),Ne=(pe+V)/(pe-V),Qe=(we+Te)/(we-Te),it=-(Ve+ze)/(Ve-ze),ot=-2*Ve*ze/(Ve-ze);return F[0]=Xe,F[1]=0,F[2]=0,F[3]=0,F[4]=0,F[5]=ct,F[6]=0,F[7]=0,F[8]=Ne,F[9]=Qe,F[10]=it,F[11]=-1,F[12]=0,F[13]=0,F[14]=ot,F[15]=0,F}e.perspective=Z;function te(F,V,pe,we,Te,ze,Ve){var Xe=1/(pe-V),ct=1/(we-Te),Ne=1/(Ve-ze),Qe=(pe+V)*Xe,it=(we+Te)*ct,ot=(Ve+ze)*Ne;return F[0]=2*Xe,F[1]=0,F[2]=0,F[3]=0,F[4]=0,F[5]=2*ct,F[6]=0,F[7]=0,F[8]=0,F[9]=0,F[10]=-2*Ne,F[11]=0,F[12]=-Qe,F[13]=-it,F[14]=-ot,F[15]=1,F}e.ortho=te;function le(F,V,pe,we){var Te,ze,Ve,Xe,ct,Ne,Qe,it,ot,dt,ke=V[0],Me=V[1],Ye=V[2],tt=we[0],xt=we[1],pt=we[2],ut=pe[0],he=pe[1],me=pe[2];return Math.abs(ke-ut)<_n&&Math.abs(Me-he)<_n&&Math.abs(Ye-me)<_n?n(F):(Qe=ke-ut,it=Me-he,ot=Ye-me,dt=1/Math.sqrt(Qe*Qe+it*it+ot*ot),Qe*=dt,it*=dt,ot*=dt,Te=xt*ot-pt*it,ze=pt*Qe-tt*ot,Ve=tt*it-xt*Qe,dt=Math.sqrt(Te*Te+ze*ze+Ve*Ve),dt?(dt=1/dt,Te*=dt,ze*=dt,Ve*=dt):(Te=0,ze=0,Ve=0),Xe=it*Ve-ot*ze,ct=ot*Te-Qe*Ve,Ne=Qe*ze-it*Te,dt=Math.sqrt(Xe*Xe+ct*ct+Ne*Ne),dt?(dt=1/dt,Xe*=dt,ct*=dt,Ne*=dt):(Xe=0,ct=0,Ne=0),F[0]=Te,F[1]=Xe,F[2]=Qe,F[3]=0,F[4]=ze,F[5]=ct,F[6]=it,F[7]=0,F[8]=Ve,F[9]=Ne,F[10]=ot,F[11]=0,F[12]=-(Te*ke+ze*Me+Ve*Ye),F[13]=-(Xe*ke+ct*Me+Ne*Ye),F[14]=-(Qe*ke+it*Me+ot*Ye),F[15]=1,F)}e.lookAt=le;function ye(F,V,pe,we){var Te=V[0],ze=V[1],Ve=V[2],Xe=we[0],ct=we[1],Ne=we[2],Qe=Te-pe[0],it=ze-pe[1],ot=Ve-pe[2],dt=Qe*Qe+it*it+ot*ot;dt>0&&(dt=1/Math.sqrt(dt),Qe*=dt,it*=dt,ot*=dt);var ke=ct*ot-Ne*it,Me=Ne*Qe-Xe*ot,Ye=Xe*it-ct*Qe;return dt=ke*ke+Me*Me+Ye*Ye,dt>0&&(dt=1/Math.sqrt(dt),ke*=dt,Me*=dt,Ye*=dt),F[0]=ke,F[1]=Me,F[2]=Ye,F[3]=0,F[4]=it*Ye-ot*Me,F[5]=ot*ke-Qe*Ye,F[6]=Qe*Me-it*ke,F[7]=0,F[8]=Qe,F[9]=it,F[10]=ot,F[11]=0,F[12]=Te,F[13]=ze,F[14]=Ve,F[15]=1,F}e.targetTo=ye;function be(F,V){i(F);for(var pe=0;pe<4;pe++){var we=V[pe];c(F,pe,we,1)}return F}e.fromPermutation=be;function Ae(F){var V=F[0]*F[0]+F[1]*F[1]+F[2]*F[2],pe=F[4]*F[4]+F[5]*F[5]+F[6]*F[6],we=F[8]*F[8]+F[9]*F[9]+F[10]*F[10];return Math.sqrt(Math.max(V,pe,we))}e.getMaxScaleOnAxis=Ae;var Se=[1,0,0],ie=[0,1,0],oe=[0,0,1];e.rotX90=j(t(),Jr(90),Se),e.rotX180=j(t(),Jr(180),Se),e.rotY90=j(t(),Jr(90),ie),e.rotY180=j(t(),Jr(180),ie),e.rotY270=j(t(),Jr(270),ie),e.rotZ90=j(t(),Jr(90),oe),e.rotZ180=j(t(),Jr(180),oe),e.rotXY90=A(t(),e.rotX90,e.rotY90),e.rotZY90=A(t(),e.rotZ90,e.rotY90),e.rotZYZ90=A(t(),e.rotZY90,e.rotZ90),e.rotZ90X180=A(t(),e.rotZ90,e.rotX180),e.rotY90Z180=A(t(),e.rotY90,e.rotZ180),e.id=r()})(ue||(ue={}));function _(){return _.zero()}(function(e){function t(){var he=[.1,0,0];return he[0]=0,he}e.zero=t;function r(he){var me=t();return me[0]=he[0],me[1]=he[1],me[2]=he[2],me}e.clone=r;function n(he){return isNaN(he[0])||isNaN(he[1])||isNaN(he[2])}e.hasNaN=n;function i(he){return he[0]=NaN,he[1]=NaN,he[2]=NaN,he}e.setNaN=i;function a(he){return l(he.x,he.y,he.z)}e.fromObj=a;function o(he){return{x:he[0],y:he[1],z:he[2]}}e.toObj=o;function s(he,me,Ee){return he[0]=me[Ee+0],he[1]=me[Ee+1],he[2]=me[Ee+2],he}e.fromArray=s;function u(he,me,Ee){return me[Ee+0]=he[0],me[Ee+1]=he[1],me[Ee+2]=he[2],me}e.toArray=u;function l(he,me,Ee){var Ke=t();return Ke[0]=he,Ke[1]=me,Ke[2]=Ee,Ke}e.create=l;function c(he){var me=t();return me[0]=he[0],me[1]=he[1],me[2]=he[2],me}e.ofArray=c;function d(he,me,Ee,Ke){return he[0]=me,he[1]=Ee,he[2]=Ke,he}e.set=d;function f(he,me){return he[0]=me[0],he[1]=me[1],he[2]=me[2],he}e.copy=f;function h(he,me,Ee){return he[0]=me[0]+Ee[0],he[1]=me[1]+Ee[1],he[2]=me[2]+Ee[2],he}e.add=h;function v(he,me,Ee){return he[0]=me[0]-Ee[0],he[1]=me[1]-Ee[1],he[2]=me[2]-Ee[2],he}e.sub=v;function p(he,me,Ee){return he[0]=me[0]*Ee[0],he[1]=me[1]*Ee[1],he[2]=me[2]*Ee[2],he}e.mul=p;function m(he,me,Ee){return he[0]=me[0]/Ee[0],he[1]=me[1]/Ee[1],he[2]=me[2]/Ee[2],he}e.div=m;function g(he,me,Ee){return he[0]=me[0]*Ee,he[1]=me[1]*Ee,he[2]=me[2]*Ee,he}e.scale=g;function y(he,me,Ee,Ke){return he[0]=me[0]+Ee[0]*Ke,he[1]=me[1]+Ee[1]*Ke,he[2]=me[2]+Ee[2]*Ke,he}e.scaleAndAdd=y;function b(he,me,Ee,Ke){return he[0]=me[0]-Ee[0]*Ke,he[1]=me[1]-Ee[1]*Ke,he[2]=me[2]-Ee[2]*Ke,he}e.scaleAndSub=b;function S(he,me,Ee){return he[0]=me[0]+Ee,he[1]=me[1]+Ee,he[2]=me[2]+Ee,he}e.addScalar=S;function x(he,me,Ee){return he[0]=me[0]-Ee,he[1]=me[1]-Ee,he[2]=me[2]-Ee,he}e.subScalar=x;function C(he,me){return he[0]=Math.round(me[0]),he[1]=Math.round(me[1]),he[2]=Math.round(me[2]),he}e.round=C;function w(he,me){return he[0]=Math.ceil(me[0]),he[1]=Math.ceil(me[1]),he[2]=Math.ceil(me[2]),he}e.ceil=w;function A(he,me){return he[0]=Math.floor(me[0]),he[1]=Math.floor(me[1]),he[2]=Math.floor(me[2]),he}e.floor=A;function M(he,me){return he[0]=Math.trunc(me[0]),he[1]=Math.trunc(me[1]),he[2]=Math.trunc(me[2]),he}e.trunc=M;function D(he,me){return he[0]=Math.abs(me[0]),he[1]=Math.abs(me[1]),he[2]=Math.abs(me[2]),he}e.abs=D;function k(he,me,Ee){return he[0]=Math.min(me[0],Ee[0]),he[1]=Math.min(me[1],Ee[1]),he[2]=Math.min(me[2],Ee[2]),he}e.min=k;function R(he,me,Ee){return he[0]=Math.max(me[0],Ee[0]),he[1]=Math.max(me[1],Ee[1]),he[2]=Math.max(me[2],Ee[2]),he}e.max=R;function O(he,me){var Ee=me[0]-he[0],Ke=me[1]-he[1],gt=me[2]-he[2];return Math.sqrt(Ee*Ee+Ke*Ke+gt*gt)}e.distance=O;function H(he,me){var Ee=me[0]-he[0],Ke=me[1]-he[1],gt=me[2]-he[2];return Ee*Ee+Ke*Ke+gt*gt}e.squaredDistance=H;function B(he){var me=he[0],Ee=he[1],Ke=he[2];return Math.sqrt(me*me+Ee*Ee+Ke*Ke)}e.magnitude=B;function j(he){var me=he[0],Ee=he[1],Ke=he[2];return me*me+Ee*Ee+Ke*Ke}e.squaredMagnitude=j;function Y(he,me,Ee){return g(he,q(he,me),Ee)}e.setMagnitude=Y;function G(he,me){return he[0]=-me[0],he[1]=-me[1],he[2]=-me[2],he}e.negate=G;function $(he,me){return he[0]=1/me[0],he[1]=1/me[1],he[2]=1/me[2],he}e.inverse=$;function q(he,me){var Ee=me[0],Ke=me[1],gt=me[2],Pt=Ee*Ee+Ke*Ke+gt*gt;return Pt>0&&(Pt=1/Math.sqrt(Pt),he[0]=me[0]*Pt,he[1]=me[1]*Pt,he[2]=me[2]*Pt),he}e.normalize=q;function ee(he,me){return he[0]*me[0]+he[1]*me[1]+he[2]*me[2]}e.dot=ee;function fe(he,me,Ee){var Ke=me[0],gt=me[1],Pt=me[2],Yt=Ee[0],dr=Ee[1],Dr=Ee[2];return he[0]=gt*Dr-Pt*dr,he[1]=Pt*Yt-Ke*Dr,he[2]=Ke*dr-gt*Yt,he}e.cross=fe;function W(he,me,Ee,Ke){var gt=me[0],Pt=me[1],Yt=me[2];return he[0]=gt+Ke*(Ee[0]-gt),he[1]=Pt+Ke*(Ee[1]-Pt),he[2]=Yt+Ke*(Ee[2]-Yt),he}e.lerp=W;var X=t();function U(he,me,Ee,Ke){var gt=Va(ee(me,Ee),-1,1),Pt=Math.acos(gt)*Ke;return y(X,Ee,me,-gt),q(X,X),h(he,g(he,me,Math.cos(Pt)),g(X,X,Math.sin(Pt)))}e.slerp=U;function z(he,me,Ee,Ke,gt,Pt){var Yt=Pt*Pt,dr=Yt*(2*Pt-3)+1,Dr=Yt*(Pt-2)+Pt,Qt=Yt*(Pt-1),ui=Yt*(3-2*Pt);return he[0]=me[0]*dr+Ee[0]*Dr+Ke[0]*Qt+gt[0]*ui,he[1]=me[1]*dr+Ee[1]*Dr+Ke[1]*Qt+gt[1]*ui,he[2]=me[2]*dr+Ee[2]*Dr+Ke[2]*Qt+gt[2]*ui,he}e.hermite=z;function J(he,me,Ee,Ke,gt,Pt){var Yt=1-Pt,dr=Yt*Yt,Dr=Pt*Pt,Qt=dr*Yt,ui=3*Pt*dr,na=3*Dr*Yt,ia=Dr*Pt;return he[0]=me[0]*Qt+Ee[0]*ui+Ke[0]*na+gt[0]*ia,he[1]=me[1]*Qt+Ee[1]*ui+Ke[1]*na+gt[1]*ia,he[2]=me[2]*Qt+Ee[2]*ui+Ke[2]*na+gt[2]*ia,he}e.bezier=J;function K(he,me,Ee,Ke,gt){return he[0]=RP(me[0],Ee[0],Ke[0],gt),he[1]=RP(me[1],Ee[1],Ke[1],gt),he[2]=RP(me[2],Ee[2],Ke[2],gt),he}e.quadraticBezier=K;function Z(he,me,Ee,Ke,gt,Pt,Yt){return he[0]=gC(me[0],Ee[0],Ke[0],gt[0],Pt,Yt),he[1]=gC(me[1],Ee[1],Ke[1],gt[1],Pt,Yt),he[2]=gC(me[2],Ee[2],Ke[2],gt[2],Pt,Yt),he}e.spline=Z;function te(he,me){var Ee=Math.random()*2*Math.PI,Ke=Math.random()*2-1,gt=Math.sqrt(1-Ke*Ke)*me;return he[0]=Math.cos(Ee)*gt,he[1]=Math.sin(Ee)*gt,he[2]=Ke*me,he}e.random=te;function le(he,me,Ee){var Ke=me[0],gt=me[1],Pt=me[2],Yt=1/(Ee[3]*Ke+Ee[7]*gt+Ee[11]*Pt+Ee[15]||1);return he[0]=(Ee[0]*Ke+Ee[4]*gt+Ee[8]*Pt+Ee[12])*Yt,he[1]=(Ee[1]*Ke+Ee[5]*gt+Ee[9]*Pt+Ee[13])*Yt,he[2]=(Ee[2]*Ke+Ee[6]*gt+Ee[10]*Pt+Ee[14])*Yt,he}e.transformMat4=le;function ye(he,me,Ee,Ke,gt,Pt){var Yt=me[0+gt],dr=me[1+gt],Dr=me[2+gt],Qt=1/(Ee[3+Pt]*Yt+Ee[7+Pt]*dr+Ee[11+Pt]*Dr+Ee[15+Pt]||1);return he[0+Ke]=(Ee[0+Pt]*Yt+Ee[4+Pt]*dr+Ee[8+Pt]*Dr+Ee[12+Pt])*Qt,he[1+Ke]=(Ee[1+Pt]*Yt+Ee[5+Pt]*dr+Ee[9+Pt]*Dr+Ee[13+Pt])*Qt,he[2+Ke]=(Ee[2+Pt]*Yt+Ee[6+Pt]*dr+Ee[10+Pt]*Dr+Ee[14+Pt])*Qt,he}e.transformMat4Offset=ye;function be(he,me,Ee){var Ke=me[0],gt=me[1],Pt=me[2];return he[0]=Ke*Ee[0]+gt*Ee[3]+Pt*Ee[6],he[1]=Ke*Ee[1]+gt*Ee[4]+Pt*Ee[7],he[2]=Ke*Ee[2]+gt*Ee[5]+Pt*Ee[8],he}e.transformMat3=be;function Ae(he,me,Ee){var Ke=me[0],gt=me[1],Pt=me[2],Yt=Ee[0],dr=Ee[1],Dr=Ee[2],Qt=Ee[3],ui=Qt*Ke+dr*Pt-Dr*gt,na=Qt*gt+Dr*Ke-Yt*Pt,ia=Qt*Pt+Yt*gt-dr*Ke,Uo=-Yt*Ke-dr*gt-Dr*Pt;return he[0]=ui*Qt+Uo*-Yt+na*-Dr-ia*-dr,he[1]=na*Qt+Uo*-dr+ia*-Yt-ui*-Dr,he[2]=ia*Qt+Uo*-Dr+ui*-dr-na*-Yt,he}e.transformQuat=Ae;function Se(he,me){var Ee=Math.sqrt(j(he)*j(me));if(Ee===0)return Math.PI/2;var Ke=ee(he,me)/Ee;return Math.acos(Va(Ke,-1,1))}e.angle=Se;var ie=t(),oe=t(),F=t(),V=t(),pe=t(),we=t(),Te=t();function ze(he,me,Ee,Ke){v(ie,he,me),v(oe,Ee,me),v(F,me,Ee),v(V,Ke,Ee),fe(pe,ie,oe),fe(we,F,V);var gt=Se(pe,we);return fe(Te,pe,we),ee(oe,Te)>0?gt:-gt}e.dihedralAngle=ze;function Ve(he,me){return he[0]===me[0]&&he[1]===me[1]&&he[2]===me[2]}e.exactEquals=Ve;function Xe(he,me){var Ee=he[0],Ke=he[1],gt=he[2],Pt=me[0],Yt=me[1],dr=me[2];return Math.abs(Ee-Pt)<=_n*Math.max(1,Math.abs(Ee),Math.abs(Pt))&&Math.abs(Ke-Yt)<=_n*Math.max(1,Math.abs(Ke),Math.abs(Yt))&&Math.abs(gt-dr)<=_n*Math.max(1,Math.abs(gt),Math.abs(dr))}e.equals=Xe;var ct=t();function Ne(he,me,Ee){var Ke=Se(me,Ee);if(Math.abs(Ke)<1e-4)return ue.setIdentity(he);if(Math.abs(Ke-Math.PI)<_n)return ue.fromScaling(he,e.negUnit);var gt=fe(ct,me,Ee);return ue.fromRotation(he,Ke,gt)}e.makeRotation=Ne;function Qe(he){return he[0]===0&&he[1]===0&&he[2]===0}e.isZero=Qe;function it(he,me,Ee,Ke){v(he,f(he,me),Ke);var gt=ee(Ee,he)/j(Ee);return h(he,g(he,f(he,Ee),gt),Ke)}e.projectPointOnVector=it;function ot(he,me,Ee){var Ke=ee(Ee,me)/j(Ee);return g(he,Ee,Ke)}e.projectOnVector=ot;var dt=t();function ke(he,me,Ee){return ot(dt,me,Ee),v(he,me,dt)}e.projectOnPlane=ke;function Me(he,me,Ee){return q(he,fe(he,fe(he,me,Ee),me))}e.orthogonalize=Me;function Ye(he,me,Ee){return ee(me,Ee)>0?f(he,me):G(he,f(he,me)),he}e.matchDirection=Ye;var tt=t(),xt=t();function pt(he,me,Ee,Ke){return v(tt,Ee,me),v(xt,Ke,me),q(he,fe(he,tt,xt))}e.triangleNormal=pt;function ut(he,me){return"["+he[0].toPrecision(me)+" "+he[1].toPrecision(me)+" "+he[2].toPrecision(me)+"]"}e.toString=ut,e.origin=l(0,0,0),e.unit=l(1,1,1),e.negUnit=l(-1,-1,-1),e.unitX=l(1,0,0),e.unitY=l(0,1,0),e.unitZ=l(0,0,1),e.negUnitX=l(-1,0,0),e.negUnitY=l(0,-1,0),e.negUnitZ=l(0,0,-1)})(_||(_={}));function Yn(){return Yn.zero()}(function(e){function t(){var W=[.1,0,0,0,0,0,0,0,0];return W[0]=0,W}e.zero=t;function r(){var W=t();return W[0]=1,W[1]=0,W[2]=0,W[3]=0,W[4]=1,W[5]=0,W[6]=0,W[7]=0,W[8]=1,W}e.identity=r;function n(W){return W[0]=1,W[1]=0,W[2]=0,W[3]=0,W[4]=1,W[5]=0,W[6]=0,W[7]=0,W[8]=1,W}e.setIdentity=n;function i(W,X,U){return X[U+0]=W[0],X[U+1]=W[1],X[U+2]=W[2],X[U+3]=W[3],X[U+4]=W[4],X[U+5]=W[5],X[U+6]=W[6],X[U+7]=W[7],X[U+8]=W[8],X}e.toArray=i;function a(W,X,U){return W[0]=X[U+0],W[1]=X[U+1],W[2]=X[U+2],W[3]=X[U+3],W[4]=X[U+4],W[5]=X[U+5],W[6]=X[U+6],W[7]=X[U+7],W[8]=X[U+8],W}e.fromArray=a;function o(W,X){return W[0]=X[0],W[1]=X[1],W[2]=X[2],W[3]=X[4],W[4]=X[5],W[5]=X[6],W[6]=X[8],W[7]=X[9],W[8]=X[10],W}e.fromMat4=o;function s(W,X,U,z,J,K,Z,te,le){var ye=t();return ye[0]=W,ye[1]=X,ye[2]=U,ye[3]=z,ye[4]=J,ye[5]=K,ye[6]=Z,ye[7]=te,ye[8]=le,ye}e.create=s;var u=r();function l(W,X){return f(W,u,typeof X>"u"?_n:X)}e.isIdentity=l;function c(W){for(var X=0;X<9;X++)if(isNaN(W[X]))return!0;return!1}e.hasNaN=c;function d(W){return p(t(),W)}e.clone=d;function f(W,X,U){for(var z=0;z<9;z++)if(Math.abs(W[z]-X[z])>U)return!1;return!0}e.areEqual=f;function h(W,X,U,z){W[3*U+X]=z}e.setValue=h;function v(W,X,U){return W[3*U+X]}e.getValue=v;function p(W,X){return W[0]=X[0],W[1]=X[1],W[2]=X[2],W[3]=X[3],W[4]=X[4],W[5]=X[5],W[6]=X[6],W[7]=X[7],W[8]=X[8],W}e.copy=p;function m(W,X){if(W===X){var U=X[1],z=X[2],J=X[5];W[1]=X[3],W[2]=X[6],W[3]=U,W[5]=X[7],W[6]=z,W[7]=J}else W[0]=X[0],W[1]=X[3],W[2]=X[6],W[3]=X[1],W[4]=X[4],W[5]=X[7],W[6]=X[2],W[7]=X[5],W[8]=X[8];return W}e.transpose=m;function g(W,X){var U=X[0],z=X[1],J=X[2],K=X[3],Z=X[4],te=X[5],le=X[6],ye=X[7],be=X[8],Ae=be*Z-te*ye,Se=-be*K+te*le,ie=ye*K-Z*le,oe=U*Ae+z*Se+J*ie;return oe?(oe=1/oe,W[0]=Ae*oe,W[1]=(-be*z+J*ye)*oe,W[2]=(te*z-J*Z)*oe,W[3]=Se*oe,W[4]=(be*U-J*le)*oe,W[5]=(-te*U+J*K)*oe,W[6]=ie*oe,W[7]=(-ye*U+z*le)*oe,W[8]=(Z*U-z*K)*oe,W):(console.warn("non-invertible matrix.",X),W)}e.invert=g;function y(W,X){return W===X?(W[3]=X[1],W[6]=X[2],W[7]=X[5]):(W[0]=X[0],W[1]=X[1],W[2]=X[2],W[3]=X[1],W[4]=X[4],W[5]=X[5],W[6]=X[2],W[7]=X[5],W[8]=X[8]),W}e.symmtricFromUpper=y;function b(W,X){return W===X?(W[1]=X[3],W[2]=X[6],W[5]=X[7]):(W[0]=X[0],W[1]=X[3],W[2]=X[6],W[3]=X[3],W[4]=X[4],W[5]=X[7],W[6]=X[6],W[7]=X[7],W[8]=X[8]),W}e.symmtricFromLower=b;function S(W){var X=W[0],U=W[1],z=W[2],J=W[3],K=W[4],Z=W[5],te=W[6],le=W[7],ye=W[8],be=ye*K-Z*le,Ae=-ye*J+Z*te,Se=le*J-K*te;return X*be+U*Ae+z*Se}e.determinant=S;function x(W){return W[0]+W[4]+W[8]}e.trace=x;function C(W,X,U){return W[0]=X[0]-U[0],W[1]=X[1]-U[1],W[2]=X[2]-U[2],W[3]=X[3]-U[3],W[4]=X[4]-U[4],W[5]=X[5]-U[5],W[6]=X[6]-U[6],W[7]=X[7]-U[7],W[8]=X[8]-U[8],W}e.sub=C;function w(W,X,U){return W[0]=X[0]+U[0],W[1]=X[1]+U[1],W[2]=X[2]+U[2],W[3]=X[3]+U[3],W[4]=X[4]+U[4],W[5]=X[5]+U[5],W[6]=X[6]+U[6],W[7]=X[7]+U[7],W[8]=X[8]+U[8],W}e.add=w;function A(W,X,U){var z=X[0],J=X[1],K=X[2],Z=X[3],te=X[4],le=X[5],ye=X[6],be=X[7],Ae=X[8],Se=U[0],ie=U[1],oe=U[2],F=U[3],V=U[4],pe=U[5],we=U[6],Te=U[7],ze=U[8];return W[0]=Se*z+ie*Z+oe*ye,W[1]=Se*J+ie*te+oe*be,W[2]=Se*K+ie*le+oe*Ae,W[3]=F*z+V*Z+pe*ye,W[4]=F*J+V*te+pe*be,W[5]=F*K+V*le+pe*Ae,W[6]=we*z+Te*Z+ze*ye,W[7]=we*J+Te*te+ze*be,W[8]=we*K+Te*le+ze*Ae,W}e.mul=A;function M(W,X,U){return W[0]=X[0]-U,W[1]=X[1]-U,W[2]=X[2]-U,W[3]=X[3]-U,W[4]=X[4]-U,W[5]=X[5]-U,W[6]=X[6]-U,W[7]=X[7]-U,W[8]=X[8]-U,W}e.subScalar=M;function D(W,X,U){return W[0]=X[0]+U,W[1]=X[1]+U,W[2]=X[2]+U,W[3]=X[3]+U,W[4]=X[4]+U,W[5]=X[5]+U,W[6]=X[6]+U,W[7]=X[7]+U,W[8]=X[8]+U,W}e.addScalar=D;function k(W,X,U){return W[0]=X[0]*U,W[1]=X[1]*U,W[2]=X[2]*U,W[3]=X[3]*U,W[4]=X[4]*U,W[5]=X[5]*U,W[6]=X[6]*U,W[7]=X[7]*U,W[8]=X[8]*U,W}e.mulScalar=k;var R=Math.PI/3,O=t();function H(W,X){var U=X[1]*X[1]+X[2]*X[2]+X[5]*X[5];if(U===0)W[0]=X[0],W[1]=X[4],W[2]=X[8];else{var z=x(X)/3,J=X[0]-z,K=X[4]-z,Z=X[8]-z,te=J*J+K*K+Z*Z+2*U,le=Math.sqrt(te/6);k(O,e.Identity,z),C(O,X,O),k(O,O,1/le);var ye=S(O)/2,be=ye<=-1?R:ye>=1?0:Math.acos(ye)/3;W[0]=z+2*le*Math.cos(be),W[2]=z+2*le*Math.cos(be+2*R),W[1]=3*z-W[0]-W[2]}return W}e.symmetricEigenvalues=H;var B=[.1,0,0],j=[.1,0,0],Y=[.1,0,0],G=[.1,0,0],$=[.1,0,0],q=[.1,0,0];function ee(W,X,U){_.set(B,X[0]-U,X[1],X[2]),_.set(j,X[1],X[4]-U,X[5]),_.set(Y,X[2],X[5],X[8]-U),_.cross(G,B,j),_.cross($,B,Y),_.cross(q,j,Y);var z=_.dot(G,G),J=_.dot($,$),K=_.dot(q,q),Z=z,te=0;return J>Z&&(Z=J,te=1),K>Z&&(te=2),te===0?_.scale(W,G,1/Math.sqrt(z)):te===1?_.scale(W,$,1/Math.sqrt(J)):_.scale(W,q,1/Math.sqrt(K)),W}e.eigenvector=ee;function fe(W,X){return o(W,X),g(W,W),m(W,W),W}e.directionTransform=fe,e.Identity=r()})(Yn||(Yn={}));function He(){return He.zero()}(function(e){function t(){var A=[.1,0];return A[0]=0,A}e.zero=t;function r(A){var M=t();return M[0]=A[0],M[1]=A[1],M}e.clone=r;function n(A,M){var D=t();return D[0]=A,D[1]=M,D}e.create=n;function i(A){return isNaN(A[0])||isNaN(A[1])}e.hasNaN=i;function a(A,M,D){return M[D+0]=A[0],M[D+1]=A[1],M}e.toArray=a;function o(A,M,D){return A[0]=M[D+0],A[1]=M[D+1],A}e.fromArray=o;function s(A,M){return A[0]=M[0],A[1]=M[1],A}e.copy=s;function u(A,M,D){return A[0]=M,A[1]=D,A}e.set=u;function l(A,M,D){return A[0]=M[0]+D[0],A[1]=M[1]+D[1],A}e.add=l;function c(A,M,D){return A[0]=M[0]-D[0],A[1]=M[1]-D[1],A}e.sub=c;function d(A,M,D){return A[0]=M[0]*D[0],A[1]=M[1]*D[1],A}e.mul=d;function f(A,M,D){return A[0]=M[0]/D[0],A[1]=M[1]/D[1],A}e.div=f;function h(A,M,D){return A[0]=M[0]*D,A[1]=M[1]*D,A}e.scale=h;function v(A,M){return A[0]=Math.round(M[0]),A[1]=Math.round(M[1]),A}e.round=v;function p(A,M){return A[0]=Math.ceil(M[0]),A[1]=Math.ceil(M[1]),A}e.ceil=p;function m(A,M){return A[0]=Math.floor(M[0]),A[1]=Math.floor(M[1]),A}e.floor=m;function g(A,M){var D=M[0]-A[0],k=M[1]-A[1];return Math.sqrt(D*D+k*k)}e.distance=g;function y(A,M){var D=M[0]-A[0],k=M[1]-A[1];return D*D+k*k}e.squaredDistance=y;function b(A){var M=A[0],D=A[1];return Math.sqrt(M*M+D*D)}e.magnitude=b;function S(A){var M=A[0],D=A[1];return M*M+D*D}e.squaredMagnitude=S;function x(A,M){return A[0]=1/M[0],A[1]=1/M[1],A}e.inverse=x;function C(A,M){return A[0]===M[0]&&A[1]===M[1]}e.areEqual=C;function w(A,M){return"["+A[0].toPrecision(M)+" "+A[1].toPrecision(M)+"}]"}e.toString=w})(He||(He={}));function Ir(){return Ir.zero()}(function(e){function t(){var R=[.1,0,0,0];return R[0]=0,R}e.zero=t;function r(R){var O=t();return O[0]=R[0],O[1]=R[1],O[2]=R[2],O[3]=R[3],O}e.clone=r;function n(R,O,H,B){var j=t();return j[0]=R,j[1]=O,j[2]=H,j[3]=B,j}e.create=n;function i(R,O){return R[0]=O.center[0],R[1]=O.center[1],R[2]=O.center[2],R[3]=O.radius,R}e.fromSphere=i;function a(R){return i(t(),R)}e.ofSphere=a;function o(R){return isNaN(R[0])||isNaN(R[1])||isNaN(R[2])||isNaN(R[3])}e.hasNaN=o;function s(R,O,H){return O[H+0]=R[0],O[H+1]=R[1],O[H+2]=R[2],O[H+3]=R[3],O}e.toArray=s;function u(R,O,H){return R[0]=O[H+0],R[1]=O[H+1],R[2]=O[H+2],R[3]=O[H+3],R}e.fromArray=u;function l(R,O,H){O[H+0]=R[0],O[H+1]=R[1],O[H+2]=R[2]}e.toVec3Array=l;function c(R,O,H){return R[0]=O[H+0],R[1]=O[H+1],R[2]=O[H+2],R[3]=0,R}e.fromVec3Array=c;function d(R,O){return R[0]=O[0],R[1]=O[1],R[2]=O[2],R[3]=O[3],R}e.copy=d;function f(R,O,H,B,j){return R[0]=O,R[1]=H,R[2]=B,R[3]=j,R}e.set=f;function h(R,O,H){return R[0]=O[0]+H[0],R[1]=O[1]+H[1],R[2]=O[2]+H[2],R[3]=O[3]+H[3],R}e.add=h;function v(R,O){var H=O[0]-R[0],B=O[1]-R[1],j=O[2]-R[2],Y=O[3]-R[3];return Math.sqrt(H*H+B*B+j*j+Y*Y)}e.distance=v;function p(R,O,H){return R[0]=O[0]*H,R[1]=O[1]*H,R[2]=O[2]*H,R[4]=O[4]*H,R}e.scale=p;function m(R,O){return R[0]=Math.round(O[0]),R[1]=Math.round(O[1]),R[2]=Math.round(O[2]),R[3]=Math.round(O[3]),R}e.round=m;function g(R,O){return R[0]=Math.ceil(O[0]),R[1]=Math.ceil(O[1]),R[2]=Math.ceil(O[2]),R[3]=Math.ceil(O[3]),R}e.ceil=g;function y(R,O){return R[0]=Math.floor(O[0]),R[1]=Math.floor(O[1]),R[2]=Math.floor(O[2]),R[3]=Math.floor(O[3]),R}e.floor=y;function b(R,O){var H=O[0]-R[0],B=O[1]-R[1],j=O[2]-R[2],Y=O[3]-R[3];return H*H+B*B+j*j+Y*Y}e.squaredDistance=b;function S(R){var O=R[0],H=R[1],B=R[2],j=R[3];return Math.sqrt(O*O+H*H+B*B+j*j)}e.norm=S;function x(R){var O=R[0],H=R[1],B=R[2],j=R[3];return O*O+H*H+B*B+j*j}e.squaredNorm=x;function C(R,O,H){var B=O[0],j=O[1],Y=O[2],G=O[3];return R[0]=H[0]*B+H[4]*j+H[8]*Y+H[12]*G,R[1]=H[1]*B+H[5]*j+H[9]*Y+H[13]*G,R[2]=H[2]*B+H[6]*j+H[10]*Y+H[14]*G,R[3]=H[3]*B+H[7]*j+H[11]*Y+H[15]*G,R}e.transformMat4=C;function w(R,O){return R[0]*O[0]+R[1]*O[1]+R[2]*O[2]+R[3]*O[3]}e.dot=w;function A(R,O){return R[0]=1/O[0],R[1]=1/O[1],R[2]=1/O[2],R[3]=1/O[3],R}e.inverse=A;function M(R,O){return R[0]===O[0]&&R[1]===O[1]&&R[2]===O[2]&&R[3]===O[3]}e.exactEquals=M;function D(R,O){var H=R[0],B=R[1],j=R[2],Y=R[3],G=O[0],$=O[1],q=O[2],ee=O[3];return Math.abs(H-G)<=_n*Math.max(1,Math.abs(H),Math.abs(G))&&Math.abs(B-$)<=_n*Math.max(1,Math.abs(B),Math.abs($))&&Math.abs(j-q)<=_n*Math.max(1,Math.abs(j),Math.abs(q))&&Math.abs(Y-ee)<=_n*Math.max(1,Math.abs(Y),Math.abs(ee))}e.equals=D;function k(R,O){return"["+R[0].toPrecision(O)+" "+R[1].toPrecision(O)+" "+R[2].toPrecision(O)+"  "+R[3].toPrecision(O)+"]"}e.toString=k})(Ir||(Ir={}));function Xn(){return Xn.zero()}(function(e){function t(){var q=[.1,0,0,0];return q[0]=0,q}e.zero=t;function r(){var q=t();return q[3]=1,q}e.identity=r;function n(q){q[0]=0,q[1]=0,q[2]=0,q[3]=1}e.setIdentity=n;function i(q){return isNaN(q[0])||isNaN(q[1])||isNaN(q[2])||isNaN(q[3])}e.hasNaN=i;function a(q,ee,fe,W){var X=r();return X[0]=q,X[1]=ee,X[2]=fe,X[3]=W,X}e.create=a;function o(q,ee,fe){fe=fe*.5;var W=Math.sin(fe);return q[0]=W*ee[0],q[1]=W*ee[1],q[2]=W*ee[2],q[3]=Math.cos(fe),q}e.setAxisAngle=o;function s(q,ee){var fe=Math.acos(ee[3])*2,W=Math.sin(fe/2);return W!==0?(q[0]=ee[0]/W,q[1]=ee[1]/W,q[2]=ee[2]/W):(q[0]=1,q[1]=0,q[2]=0),fe}e.getAxisAngle=s;function u(q,ee,fe){var W=ee[0],X=ee[1],U=ee[2],z=ee[3],J=fe[0],K=fe[1],Z=fe[2],te=fe[3];return q[0]=W*te+z*J+X*Z-U*K,q[1]=X*te+z*K+U*J-W*Z,q[2]=U*te+z*Z+W*K-X*J,q[3]=z*te-W*J-X*K-U*Z,q}e.multiply=u;function l(q,ee,fe){fe*=.5;var W=ee[0],X=ee[1],U=ee[2],z=ee[3],J=Math.sin(fe),K=Math.cos(fe);return q[0]=W*K+z*J,q[1]=X*K+U*J,q[2]=U*K-X*J,q[3]=z*K-W*J,q}e.rotateX=l;function c(q,ee,fe){fe*=.5;var W=ee[0],X=ee[1],U=ee[2],z=ee[3],J=Math.sin(fe),K=Math.cos(fe);return q[0]=W*K-U*J,q[1]=X*K+z*J,q[2]=U*K+W*J,q[3]=z*K-X*J,q}e.rotateY=c;function d(q,ee,fe){fe*=.5;var W=ee[0],X=ee[1],U=ee[2],z=ee[3],J=Math.sin(fe),K=Math.cos(fe);return q[0]=W*K+X*J,q[1]=X*K-W*J,q[2]=U*K+z*J,q[3]=z*K-U*J,q}e.rotateZ=d;function f(q,ee){var fe=ee[0],W=ee[1],X=ee[2];return q[0]=fe,q[1]=W,q[2]=X,q[3]=Math.sqrt(Math.abs(1-fe*fe-W*W-X*X)),q}e.calculateW=f;function h(q,ee,fe,W){var X=ee[0],U=ee[1],z=ee[2],J=ee[3],K=fe[0],Z=fe[1],te=fe[2],le=fe[3],ye,be,Ae,Se,ie;return be=X*K+U*Z+z*te+J*le,be<0&&(be=-be,K=-K,Z=-Z,te=-te,le=-le),1-be>1e-6?(ye=Math.acos(be),Ae=Math.sin(ye),Se=Math.sin((1-W)*ye)/Ae,ie=Math.sin(W*ye)/Ae):(Se=1-W,ie=W),q[0]=Se*X+ie*K,q[1]=Se*U+ie*Z,q[2]=Se*z+ie*te,q[3]=Se*J+ie*le,q}e.slerp=h;function v(q,ee){var fe=ee[0],W=ee[1],X=ee[2],U=ee[3],z=fe*fe+W*W+X*X+U*U,J=z?1/z:0;return q[0]=-fe*J,q[1]=-W*J,q[2]=-X*J,q[3]=U*J,q}e.invert=v;function p(q,ee){return q[0]=-ee[0],q[1]=-ee[1],q[2]=-ee[2],q[3]=ee[3],q}e.conjugate=p;function m(q,ee){var fe=ee[0]+ee[4]+ee[8],W;if(fe>0)W=Math.sqrt(fe+1),q[3]=.5*W,W=.5/W,q[0]=(ee[5]-ee[7])*W,q[1]=(ee[6]-ee[2])*W,q[2]=(ee[1]-ee[3])*W;else{var X=0;ee[4]>ee[0]&&(X=1),ee[8]>ee[X*3+X]&&(X=2);var U=(X+1)%3,z=(X+2)%3;W=Math.sqrt(ee[X*3+X]-ee[U*3+U]-ee[z*3+z]+1),q[X]=.5*W,W=.5/W,q[3]=(ee[U*3+z]-ee[z*3+U])*W,q[U]=(ee[U*3+X]+ee[X*3+U])*W,q[z]=(ee[z*3+X]+ee[X*3+z])*W}return q}e.fromMat3=m;var g=[0,0,0];function y(q,ee,fe){var W=_.dot(ee,fe)+1;return W<_n?(W=0,Math.abs(ee[0])>Math.abs(ee[2])?_.set(g,-ee[1],ee[0],0):_.set(g,0,-ee[2],ee[1])):_.cross(g,ee,fe),q[0]=g[0],q[1]=g[1],q[2]=g[2],q[3]=W,M(q,q),q}e.fromUnitVec3=y;function b(q){var ee=t();return ee[0]=q[0],ee[1]=q[1],ee[2]=q[2],ee[3]=q[3],ee}e.clone=b;function S(q,ee,fe){return ee[fe+0]=q[0],ee[fe+1]=q[1],ee[fe+2]=q[2],ee[fe+3]=q[3],ee}e.toArray=S;function x(q,ee,fe){return q[0]=ee[fe+0],q[1]=ee[fe+1],q[2]=ee[fe+2],q[3]=ee[fe+3],q}e.fromArray=x;function C(q,ee){return q[0]=ee[0],q[1]=ee[1],q[2]=ee[2],q[3]=ee[3],q}e.copy=C;function w(q,ee,fe,W,X){return q[0]=ee,q[1]=fe,q[2]=W,q[3]=X,q}e.set=w;function A(q,ee,fe){return q[0]=ee[0]+fe[0],q[1]=ee[1]+fe[1],q[2]=ee[2]+fe[2],q[3]=ee[3]+fe[3],q}e.add=A;function M(q,ee){var fe=ee[0],W=ee[1],X=ee[2],U=ee[3],z=fe*fe+W*W+X*X+U*U;return z>0&&(z=1/Math.sqrt(z),q[0]=fe*z,q[1]=W*z,q[2]=X*z,q[3]=U*z),q}e.normalize=M;var D=[0,0,0],k=[1,0,0],R=[0,1,0];function O(q,ee,fe){var W=_.dot(ee,fe);return W<-.999999?(_.cross(D,k,ee),_.magnitude(D)<1e-6&&_.cross(D,R,ee),_.normalize(D,D),o(q,D,Math.PI),q):W>.999999?(q[0]=0,q[1]=0,q[2]=0,q[3]=1,q):(_.cross(D,ee,fe),q[0]=D[0],q[1]=D[1],q[2]=D[2],q[3]=1+W,M(q,q))}e.rotationTo=O;var H=t(),B=t();function j(q,ee,fe,W,X,U){return h(H,ee,X,U),h(B,fe,W,U),h(q,H,B,2*U*(1-U)),q}e.sqlerp=j;var Y=[0,0,0,0,0,0,0,0,0];function G(q,ee,fe,W){return Y[0]=fe[0],Y[3]=fe[1],Y[6]=fe[2],Y[1]=W[0],Y[4]=W[1],Y[7]=W[2],Y[2]=-ee[0],Y[5]=-ee[1],Y[8]=-ee[2],M(q,m(q,Y))}e.setAxes=G;function $(q,ee){return"["+q[0].toPrecision(ee)+" "+q[1].toPrecision(ee)+" "+q[2].toPrecision(ee)+"  "+q[3].toPrecision(ee)+"]"}e.toString=$,e.Identity=r()})(Xn||(Xn={}));var kr;(function(e){function t(x,C,w){for(var A=[],M=0;M<C.length;M++)A[M]=C[C.length-M-1];for(var D=[1],M=1;M<x.length;M++)D[M]=x[A[M-1]];return{dimensions:x,axisOrderFastToSlow:A,axisOrderSlowToFast:C,accessDimensions:D,defaultCtor:w||Float64Array}}function r(x,C){return{space:x,data:C}}e.create=r;function n(x,C,w){var A=t(x,C,w),M=h(A),D=M.get,k=M.set,R=M.add,O=M.dataOffset,H=M.getCoords;return{rank:x.length,dimensions:x,axisOrderSlowToFast:C,create:v(A),get:D,set:k,add:R,dataOffset:O,getCoords:H}}e.Space=n;function i(x){return x}e.Data1=i;function a(x,C){return n([x],[0],C)}e.Vector=a;function o(x,C,w){return n([x,C],[1,0],w)}e.ColumnMajorMatrix=o;function s(x,C,w){return n([x,C],[0,1],w)}e.RowMajorMatrix=s;function u(x,C,w){if(C.rank!==2)throw new Error("Invalid tensor rank");for(var A=Math.min(4,C.dimensions[0]),M=Math.min(4,C.dimensions[1]),D=0;D<A;D++)for(var k=0;k<M;k++)ue.setValue(x,D,k,C.get(w,D,k));return x}e.toMat4=u;function l(x,C,w){if(C.rank!==2)throw new Error("Invalid tensor rank");for(var A=Math.min(3,C.dimensions[0]),M=Math.min(3,C.dimensions[1]),D=0;D<A;D++)for(var k=0;k<M;k++)Yn.setValue(x,D,k,C.get(w,D,k));return x}e.toMat3=l;function c(x,C,w){if(C.rank!==1)throw new Error("Invalid tensor rank");for(var A=Math.min(3,C.dimensions[0]),M=0;M<A;M++)x[M]=w[M];return x}e.toVec3=c;function d(x,C,w){if(C.rank!==1)throw new Error("Invalid tensor rank");for(var A=Math.min(4,C.dimensions[0]),M=0;M<A;M++)x[M]=w[M];return x}e.toVec4=d;function f(x,C){var w=x.length;if(w!==C.length)return!1;for(var A=0;A<w;A++)if(x[A]!==C[A])return!1;return!0}e.areEqualExact=f;function h(x){var C=x.dimensions,w=x.axisOrderFastToSlow;switch(C.length){case 1:return{get:function(K,Z){return K[Z]},set:function(K,Z,te){return K[Z]=te},add:function(K,Z,te){return K[Z]+=te},dataOffset:function(K){return K},getCoords:function(K,Z){return Z[0]=K,Z}};case 2:{if(w[0]===0&&w[1]===1){var A=C[0];return{get:function(K,Z,te){return K[te*A+Z]},set:function(K,Z,te,le){return K[te*A+Z]=le},add:function(K,Z,te,le){return K[te*A+Z]+=le},dataOffset:function(K,Z){return Z*A+K},getCoords:function(K,Z){return Z[0]=K%A,Z[1]=Math.floor(K/A),Z}}}if(w[0]===1&&w[1]===0){var M=C[1];return{get:function(K,Z,te){return K[Z*M+te]},set:function(K,Z,te,le){return K[Z*M+te]=le},add:function(K,Z,te,le){return K[Z*M+te]+=le},dataOffset:function(K,Z){return K*M+Z},getCoords:function(K,Z){return Z[0]=Math.floor(K/M),Z[1]=K%M,Z}}}throw new Error("bad axis order")}case 3:{if(w[0]===0&&w[1]===1&&w[2]===2){var D=C[0],k=C[1],R=D*k;return{get:function(K,Z,te,le){return K[Z+te*D+le*R]},set:function(K,Z,te,le,ye){return K[Z+te*D+le*R]=ye},add:function(K,Z,te,le,ye){return K[Z+te*D+le*R]+=ye},dataOffset:function(K,Z,te){return K+Z*D+te*R},getCoords:function(K,Z){var te=Math.floor(K/D);return Z[0]=K%D,Z[1]=te%k,Z[2]=Math.floor(te/k),Z}}}if(w[0]===0&&w[1]===2&&w[2]===1){var O=C[0],H=C[2],B=O*H;return{get:function(K,Z,te,le){return K[Z+le*O+te*B]},set:function(K,Z,te,le,ye){return K[Z+le*O+te*B]=ye},add:function(K,Z,te,le,ye){return K[Z+le*O+te*B]+=ye},dataOffset:function(K,Z,te){return K+te*O+Z*B},getCoords:function(K,Z){var te=Math.floor(K/O);return Z[0]=K%O,Z[1]=Math.floor(te/H),Z[2]=te%H,Z}}}if(w[0]===1&&w[1]===0&&w[2]===2){var j=C[1],Y=C[0],G=j*Y;return{get:function(K,Z,te,le){return K[te+Z*j+le*G]},set:function(K,Z,te,le,ye){return K[te+Z*j+le*G]=ye},add:function(K,Z,te,le,ye){return K[te+Z*j+le*G]+=ye},dataOffset:function(K,Z,te){return Z+K*j+te*G},getCoords:function(K,Z){var te=Math.floor(K/j);return Z[0]=te%Y,Z[1]=K%j,Z[2]=Math.floor(te/Y),Z}}}if(w[0]===1&&w[1]===2&&w[2]===0){var $=C[1],q=C[2],ee=$*q;return{get:function(K,Z,te,le){return K[te+le*$+Z*ee]},set:function(K,Z,te,le,ye){return K[te+le*$+Z*ee]=ye},add:function(K,Z,te,le,ye){return K[te+le*$+Z*ee]+=ye},dataOffset:function(K,Z,te){return Z+te*$+K*ee},getCoords:function(K,Z){var te=Math.floor(K/$);return Z[0]=Math.floor(te/q),Z[1]=K%$,Z[2]=te%q,Z}}}if(w[0]===2&&w[1]===0&&w[2]===1){var fe=C[2],W=C[0],X=fe*W;return{get:function(K,Z,te,le){return K[le+Z*fe+te*X]},set:function(K,Z,te,le,ye){return K[le+Z*fe+te*X]=ye},add:function(K,Z,te,le,ye){return K[le+Z*fe+te*X]+=ye},dataOffset:function(K,Z,te){return te+K*fe+Z*X},getCoords:function(K,Z){var te=Math.floor(K/fe);return Z[0]=te%W,Z[1]=Math.floor(te/W),Z[2]=K%fe,Z}}}if(w[0]===2&&w[1]===1&&w[2]===0){var U=C[2],z=C[1],J=U*z;return{get:function(K,Z,te,le){return K[le+te*U+Z*J]},set:function(K,Z,te,le,ye){return K[le+te*U+Z*J]=ye},add:function(K,Z,te,le,ye){return K[le+te*U+Z*J]+=ye},dataOffset:function(K,Z,te){return te+Z*U+K*J},getCoords:function(K,Z){var te=Math.floor(K/U);return Z[0]=Math.floor(te/z),Z[1]=te%z,Z[2]=K%U,Z}}}throw new Error("bad axis order")}default:return{get:function(K){for(var Z=[],te=1;te<arguments.length;te++)Z[te-1]=arguments[te];return K[p(x,Z)]},set:function(K){for(var Z=[],te=1;te<arguments.length;te++)Z[te-1]=arguments[te];return K[p(x,Z)]=Z[Z.length-1]},add:function(K){for(var Z=[],te=1;te<arguments.length;te++)Z[te-1]=arguments[te];return K[p(x,Z)]+=Z[Z.length-1]},dataOffset:function(){for(var K=[],Z=0;Z<arguments.length;Z++)K[Z]=arguments[Z];return p(x,K)},getCoords:function(K,Z){return m(x,K,Z)}}}}function v(x){for(var C=x.dimensions,w=1,A=0,M=C.length;A<M;A++)w*=C[A];return function(D){return new(D||x.defaultCtor)(w)}}function p(x,C){for(var w=x.accessDimensions,A=x.axisOrderFastToSlow,M=w.length-1,D=w[M]*C[A[M]],k=M-1;k>=0;k--)D=(D+C[A[k]])*w[k];return D}function m(x,C,w){for(var A=x.dimensions,M=x.axisOrderFastToSlow,D=A.length,k=C,R=0;R<D;R++){var O=A[M[R]];w[M[R]]=k%O,k=Math.floor(k/O)}return w[M[D+1]]=k,w}function g(x){for(var C=[],w=0;w<x.length;w++)C[w]=x[x.length-w-1];return C}e.invertAxisOrder=g;function y(x,C){for(var w=[],A=0;A<x.length;A++)w[A]=x[C[A]];return w}function b(x){for(var C=new Int32Array(x.length),w=0;w<x.length;w++)C[x[w]]=w;return function(A){return y(A,C)}}e.convertToCanonicalAxisIndicesFastToSlow=b;function S(x){for(var C=new Int32Array(x.length),w=0;w<x.length;w++)C[x[x.length-w-1]]=w;return function(A){return y(A,C)}}e.convertToCanonicalAxisIndicesSlowToFast=S})(kr||(kr={}));function Ip(e,t,r){for(;t<r&&e.charCodeAt(t)===32;)t++;return vh(e,t,r)}function vh(e,t,r){var n=t,i=0,a=1;for(e.charCodeAt(n)===45?(a=-1,++n):e.charCodeAt(n)===43&&++n;n<r;n++){var o=e.charCodeAt(n)-48;if(o>9||o<0)return a*i|0;i=10*i+o|0}return a*i}function rU(e,t,r,n){return t.charCodeAt(r)===43&&r++,e*Math.pow(10,vh(t,r,n))}function yMe(e,t,r){for(;t<r&&e.charCodeAt(t)===32;)t++;return Yc(e,t,r)}function Yc(e,t,r){var n=t,i=1,a=0,o=0,s=1;for(e.charCodeAt(n)===45?(i=-1,++n):e.charCodeAt(n)===43&&++n;n<r;){var u=e.charCodeAt(n)-48;if(u>=0&&u<10)a=a*10+u,++n;else if(u===-2){for(++n;n<r;)if(u=e.charCodeAt(n)-48,u>=0&&u<10)o=10*o+u,s=10*s,++n;else return u===53||u===21?rU(i*(a+o/s),e,n+1,r):i*(a+o/s);return i*(a+o/s)}else{if(u===53||u===21)return rU(i*a,e,n+1,r);break}}return i*a}var ve;(function(e){var t;(function(D){D.str={"@type":"str",T:"",valueType:"str"},D.int={"@type":"int",T:0,valueType:"int"},D.coord={"@type":"coord",T:0,valueType:"float"},D.float={"@type":"float",T:0,valueType:"float"};function k($){return $===void 0&&($=""),{"@type":"str",T:$,valueType:"str"}}D.Str=k;function R($){return $===void 0&&($=0),{"@type":"int",T:$,valueType:"int"}}D.Int=R;function O($){return $===void 0&&($=0),{"@type":"float",T:$,valueType:"float"}}D.Float=O;function H($,q){return q===void 0&&(q=D.float),{"@type":"tensor",T:$.create(),space:$,valueType:"tensor",baseType:q}}D.Tensor=H;function B($,q){return q===void 0&&(q=D.float),H(kr.Vector($,q["@type"]==="int"?Int32Array:Float64Array),q)}D.Vector=B;function j($,q,ee){return ee===void 0&&(ee=D.float),H(kr.ColumnMajorMatrix($,q,ee["@type"]==="int"?Int32Array:Float64Array),ee)}D.Matrix=j;function Y($,q){return typeof q<"u"?E(E({},$),{T:q}):$}D.Aliased=Y;function G($,q,ee){return ee===void 0&&(ee=[]),{"@type":"list",T:ee,separator:$,itemParse:q,valueType:"list"}}D.List=G})(t=e.Schema||(e.Schema={}));function r(D){return!!D&&!!D.schema&&!!D.value}e.is=r;function n(D,k){return nU(k.T,D,k,1)}e.Undefined=n;function i(D,k,R){return nU(D,k,R,0)}e.ofConst=i;function a(D){return jx(D)}e.ofLambda=a;function o(D,k){return a({value:function(R){return R+D},rowCount:Math.max(k-D+1,0),schema:t.int})}e.range=o;function s(D){return Ac(D)}e.ofArray=s;function u(D){return Ac({array:D,schema:t.int})}e.ofIntArray=u;function l(D){return Ac({array:D,schema:t.float})}e.ofFloatArray=l;function c(D){return Ac({array:D,schema:t.str})}e.ofStringArray=c;function d(D){return Ac({array:D,schema:t.Aliased(t.str)})}e.ofStringAliasArray=d;function f(D,k){return k===void 0&&(k=","),Ac({array:D,schema:t.List(k,function(R){return R})})}e.ofStringListArray=f;function h(D){var k=D.count,R=D.data,O=D.indices;return jx({value:function(H){return vh(R,O[2*H],O[2*H+1])||0},rowCount:k,schema:t.int})}e.ofIntTokens=h;function v(D){var k=D.count,R=D.data,O=D.indices;return jx({value:function(H){return Yc(R,O[2*H],O[2*H+1])||0},rowCount:k,schema:t.float})}e.ofFloatTokens=v;function p(D){var k=D.count,R=D.data,O=D.indices;return jx({value:function(H){var B=R.substring(O[2*H],O[2*H+1]);return B==="."||B==="?"?"":B},rowCount:k,schema:t.str})}e.ofStringTokens=p;function m(D,k,R){return SMe(D,k,R)}e.window=m;function g(D,k,R){return R===void 0&&(R=!0),EMe(D,k,R)}e.view=g;function y(D){return bMe(D)}e.createFirstIndexMap=y;function b(D){return xMe(D)}e.createIndexer=b;function S(D,k,R){return TMe(D,k,R||Array)}e.mapToArray=S;function x(D,k){return IMe(D,k)}e.areEqual=x;function C(D,k){return RMe(D,k)}e.indicesOf=C;function w(D,k){return D.__array?D:D.isDefined?Ac({array:D.toArray({array:k}),schema:D.schema,valueKind:D.valueKind}):n(D.rowCount,D.schema)}e.asArrayColumn=w;function A(D,k,R){if(R===void 0&&(R=0),!!D.isDefined){var O=D.__array;if(O)for(var H=0,B=O.length;H<B;H++)k[R+H]=O[H];else for(var H=0,B=D.rowCount;H<B;H++)k[R+H]=D.value(H)}}e.copyToArray=A;function M(D){for(var k=0,R=D.rowCount;k<R;k++)if(k!==D.value(k))return!1;return!0}e.isIdentity=M})(ve||(ve={}));function bMe(e){for(var t=new Map,r=0,n=e.rowCount;r<n;r++){var i=e.value(r);t.has(i)||t.set(e.value(r),r)}return t}function xMe(e){for(var t=new Map,r=0,n=e.rowCount;r<n;r++){var i=e.value(r);t.has(i)||t.set(e.value(r),r)}return function(a){return t.has(a)?t.get(a):-1}}function nU(e,t,r,n){var i=function(a){return e};return{schema:r,__array:void 0,isDefined:n===0,rowCount:t,value:i,valueKind:function(a){return n},toArray:function(a){for(var o=w2(t,a).array,s=0,u=o.length;s<u;s++)o[s]=e;return o},areValuesEqual:function(a,o){return!0}}}function jx(e){var t=e.value,r=e.valueKind,n=e.areValuesEqual,i=e.rowCount,a=e.schema;return{schema:a,__array:void 0,isDefined:!0,rowCount:i,value:t,valueKind:r||function(o){return 0},toArray:function(o){for(var s=w2(i,o),u=s.array,l=s.start,c=0,d=u.length;c<d;c++)u[c]=t(c+l);return u},areValuesEqual:n||function(o,s){return t(o)===t(s)}}}function Ac(e){var t=e.array,r=e.schema,n=e.valueKind,i=t.length,a=r.valueType==="str"?function(s){var u=t[s];return typeof u=="string"?u:""+u}:function(s){return t[s]},o=C6(t);return{schema:r,__array:t,isDefined:!0,rowCount:i,value:a,valueKind:n||function(s){return 0},toArray:r.valueType==="str"?function(s){for(var u=K_(i,s),l=u.start,c=u.end,d=new(s&&typeof s.array<"u"?s.array:t.constructor)(c-l),f=0,h=c-l;f<h;f++){var v=t[l+f];d[f]=typeof v=="string"?v:""+v}return d}:o?function(s){return Q_(t,s)}:function(s){var u=K_(i,s),l=u.start,c=u.end;if(l===0&&c===t.length)return t;for(var d=new(s&&typeof s.array<"u"?s.array:t.constructor)(c-l),f=0,h=c-l;f<h;f++)d[f]=t[l+f];return d},areValuesEqual:function(s,u){return t[s]===t[u]}}}function SMe(e,t,r){return e.isDefined?t===0&&r===e.rowCount?e:e.__array&&C6(e.__array)?CMe(e,t,r):_Me(e,t,r):ve.Undefined(r-t,e.schema)}function CMe(e,t,r){var n=Q_(e.__array,{start:t,end:r}),i=e.valueKind;return Ac({array:n,schema:e.schema,valueKind:function(a){return i(t+a)}})}function _Me(e,t,r){var n=e.value,i=e.valueKind,a=e.areValuesEqual,o=t===0?n:function(u){return n(u+t)},s=r-t;return{schema:e.schema,__array:void 0,isDefined:e.isDefined,rowCount:s,value:o,valueKind:t===0?i:function(u){return i(u+t)},toArray:function(u){for(var l=w2(s,u).array,c=0,d=l.length;c<d;c++)l[c]=n(c+t);return l},areValuesEqual:t===0?a:function(u,l){return a(u+t,l+t)}}}function wMe(e,t){if(e.length!==t)return!1;for(var r=0,n=e.length;r<n;r++)if(e[r]!==r)return!1;return!0}function EMe(e,t,r){return e.rowCount===0||r&&wMe(t,e.rowCount)?e:e.__array&&typeof e.value(0)==typeof e.__array[0]?AMe(e,t):PMe(e,t)}function AMe(e,t){for(var r=e.__array,n=new r.constructor(t.length),i=0,a=t.length;i<a;i++)n[i]=r[t[i]];var o=e.valueKind;return Ac({array:n,schema:e.schema,valueKind:function(s){return o(t[s])}})}function PMe(e,t){var r=e.value,n=e.valueKind,i=e.areValuesEqual,a=function(s){return r(t[s])},o=t.length;return{schema:e.schema,__array:void 0,isDefined:e.isDefined,rowCount:o,value:a,valueKind:function(s){return n(t[s])},toArray:function(s){for(var u=w2(o,s).array,l=0,c=u.length;l<c;l++)u[l]=r(t[l]);return u},areValuesEqual:function(s,u){return i(t[s],t[u])}}}function TMe(e,t,r){for(var n=new r(e.rowCount),i=0,a=e.rowCount;i<a;i++)n[i]=t(e.value(i));return n}function IMe(e,t){return e===t?!0:e.rowCount!==t.rowCount||e.isDefined!==t.isDefined||e.schema.valueType!==t.schema.valueType?!1:e.__array&&t.__array?MMe(e,t):DMe(e,t)}function MMe(e,t){for(var r=e.__array,n=t.__array,i=0,a=e.rowCount;i<a;i++)if(r[i]!==n[i])return!1;return!0}function DMe(e,t){for(var r=e.value,n=t.value,i=0,a=e.rowCount;i<a;i++)if(r(i)!==n(i))return!1;return!0}function RMe(e,t){for(var r=[],n=e.value,i=0,a=e.rowCount;i<a;i++)t(n(i))&&(r[r.length]=i);return r}var en;(function(e){function t(S){return S&&typeof S._rowCount=="number"&&!!S._columns&&!!S._schema}e.is=t;function r(S,x,C){C===void 0&&(C={});var w=Object.create(null),A=Object.keys(S);w._rowCount=x._rowCount,w._columns=A,w._schema=S;for(var M=0,D=A;M<D.length;M++){var k=D[M];if(x[k])w[k]=x[k];else if(C[k])w[k]=C[k];else throw Error("Cannot find column '"+k+"'.")}return w}e.pickColumns=r;function n(S,x){var C=Object.keys(x),w=x[C[0]].rowCount;return E({_rowCount:w,_columns:C,_schema:S},x)}e.ofColumns=n;function i(S,x,C){var w=Object.create(null),A=Object.keys(S);w._rowCount=C,w._columns=A,w._schema=S;for(var M=0,D=A;M<D.length;M++){var k=D[M];k in x?w[k]=x[k]:w[k]=ve.Undefined(C,S[k])}return w}e.ofPartialColumns=i;function a(S,x){var C=Object.create(null),w=Object.keys(S);C._rowCount=x,C._columns=w,C._schema=S;for(var A=0,M=w;A<M.length;A++){var D=M[A];C[D]=ve.Undefined(x,S[D])}return C}e.ofUndefinedColumns=a;function o(S,x){var C=Object.create(null),w=x.length,A=Object.keys(S);C._rowCount=w,C._columns=A,C._schema=S;for(var M=function(O){C[O]=ve.ofLambda({rowCount:w,schema:S[O],value:function(H){return x[H][O]},valueKind:function(H){return typeof x[H][O]>"u"?1:0}})},D=0,k=A;D<k.length;D++){var R=k[D];M(R)}return C}e.ofRows=o;function s(S,x){var C,w=Object.create(null),A=Object.keys(S);w._rowCount=0,w._columns=A,w._schema=S;for(var M=0,D=A;M<D.length;M++){var k=D[M];typeof x[k]<"u"?(w[k]=ve.ofArray({array:x[k],schema:S[k]}),w._rowCount=(C=x[k])===null||C===void 0?void 0:C.length):w[k]=ve.Undefined(w._rowCount,S[k])}return w}e.ofArrays=s;function u(S,x,C){var w=Object.create(null),A=Object.keys(x);w._rowCount=C.length,w._columns=A,w._schema=x;for(var M=0,D=A;M<D.length;M++){var k=D[M];w[k]=ve.view(S[k],C)}return w}e.view=u;function l(S,x,C){for(var w=[],A=0,M=S._rowCount;A<M;++A)C(A)&&w.push(A);return u(S,x,w)}e.pick=l;function c(S,x,C,w){if(C===0&&w===S._rowCount)return S;var A=Object.create(null),M=Object.keys(x);A._rowCount=w-C,A._columns=M,A._schema=x;for(var D=0,k=M;D<k.length;D++){var R=k[D];A[R]=ve.window(S[R],C,w)}return A}e.window=c;function d(S,x){var C=Object.create(null),w=Object.keys(x);C._rowCount=0;for(var A=0,M=S;A<M.length;A++){var D=M[A];C._rowCount+=D._rowCount}for(var k={},R=0,O=w;R<O.length;R++){var H=O[R];k[H]=new Array(C._rowCount)}C._columns=w,C._schema=x;for(var B=0,j=0,Y=S;j<Y.length;j++){for(var D=Y[j],G=0,$=w;G<$.length;G++){var q=$[G];ve.copyToArray(D[q],k[q],B)}B+=D._rowCount}for(var ee=0,fe=w;ee<fe.length;ee++){var q=fe[ee];C[q]=ve.ofArray({array:k[q],schema:x[q]})}return C}e.concat=d;function f(S,x,C){S[x]=ve.asArrayColumn(S[x],C)}e.columnToArray=f;function h(S,x){for(var C=new Int32Array(S._rowCount),w=0,A=C.length;w<A;w++)C[w]=w;Ou(C,function(H,B,j){return x(B,j)});for(var M=!0,w=0,A=C.length;w<A;w++)if(C[w]!==w){M=!1;break}if(M)return S;var D=Object.create(null);D._rowCount=S._rowCount,D._columns=S._columns,D._schema=S._schema;for(var k=0,R=S._columns;k<R.length;k++){var O=R[k];D[O]=ve.view(S[O],C,!1)}return D}e.sort=h;function v(S,x){if(S._rowCount!==x._rowCount||S._columns.length!==x._columns.length)return!1;for(var C=0,w=S._columns;C<w.length;C++){var A=w[C];if(!x[A])return!1}for(var M=0,D=S._columns;M<D.length;M++){var A=D[M];if(!ve.areEqual(S[A],x[A]))return!1}return!0}e.areEqual=v;function p(S,x){for(var C=Object.create(null),w=S._columns,A=0;A<w.length;A++){var M=w[A];C[M]=S[M].value(x)}return C}e.getRow=p;function m(S,x){for(var C=0,w=S._rowCount;C<w;++C)if(x(C))return p(S,C)}e.pickRow=m;function g(S){for(var x=[],C=S._rowCount,w=0;w<C;w++)x[w]=p(S,w);return x}e.getRows=g;function y(S){for(var x={},C=S._columns,w=0;w<C.length;w++){var A=C[w];x[A]=S[A].toArray()}return x}e.toArrays=y;function b(S){var x=Br.create(),C=S._columns,w=S._rowCount,A=1;Br.write(x,"|");for(var M=0;M<C.length;M++)Br.write(x,C[M]),Br.write(x,"|"),A+=C[M].length+1;Br.newline(x),Br.write(x,new Array(A+1).join("-")),Br.newline(x);for(var D=0;D<w;D++){Br.write(x,"|");for(var M=0;M<C.length;M++){var k=S[C[M]];k.valueKind(D)===0?(Br.write(x,k.value(D)),Br.write(x,"|")):Br.write(x,".|")}Br.newline(x)}return Br.getString(x)}e.formatToString=b})(en||(en={}));var X5;(function(e){function t(n,i,a){var o=Object.keys(a),s=Object.create(null),u=[];s._name=n,s._tableNames=u,s._schema=i;for(var l=0,c=o;l<c.length;l++){var d=c[l];en.is(a[d])&&(s[d]=a[d],u[u.length]=d)}return s}e.ofTables=t;function r(n){for(var i={},a=0,o=n._tableNames;a<o.length;a++){var s=o[a];i[s]=en.getRows(n[s])}return i}e.getTablesAsRows=r})(X5||(X5={}));function _6(e,t){for(var r=0,n=e.length;r<n;r++)if(t(e[r]))return e[r]}function w6(e){if(Array.from)return Array.from(e);for(var t=[];;){var r=e.next(),n=r.done,i=r.value;if(n)break;t[t.length]=i}return t}function Y5(e,t,r){for(var n=t-e+1,i=r?new r(n):new Int32Array(n),a=0;a<n;a++)i[a]=a+e;return i}function kMe(e,t){for(var r=new(OMe(e))(t.length),n=0,i=t.length;n<i;n++)r[n]=e[t[n]];return r}function OMe(e){var t=e.constructor;if(!t)throw new Error("data does not define a constructor and it should");return t}var wi;(function(e){e.Zero=0;var t=function(){var p=new ArrayBuffer(8),m=new ArrayBuffer(8);return{_int32:new Int32Array(p),_float64:new Float64Array(p),_int32_1:new Int32Array(m),_float64_1:new Float64Array(m)}}(),r=t._int32,n=t._float64,i=t._int32_1,a=t._float64_1;function o(p){return typeof p=="number"}e.is=o;function s(p,m){return r[0]=p,r[1]=m,n[0]}e.create=s;function u(p){return n[0]=p,r[0]}e.fst=u;function l(p){return n[0]=p,r[1]}e.snd=l;function c(p,m){return n[0]=p,a[0]=m,r[0]===i[0]&&r[1]===i[1]}e.areEqual=c;function d(p,m){n[0]=p,a[0]=m;var g=r[0]-i[0];return g!==0?g:r[1]-i[1]}e.compare=d;function f(p,m,g){n[0]=p[m],a[0]=p[g];var y=r[0]-i[0];return y!==0?y:r[1]-i[1]}e.compareInArray=f;function h(p){return n[0]=p,Kv(r[0],r[1])}e.hashCode=h;function v(p){return n[0]=p,"("+r[0]+", "+r[1]+")"}e.toString=v})(wi||(wi={}));var xZ=wi.Zero;function iU(e,t){return t<e?wi.create(e,e):wi.create(e,t+1)}function E6(e,t){return t<=e?wi.create(e,e):wi.create(e,t)}function FMe(e){return e<0?wi.create(0,0):wi.create(0,e)}var LMe=wi.is,ld=wi.fst,Ah=wi.snd,Z_=wi.fst;function J_(e){return wi.snd(e)-1}function ev(e){return wi.snd(e)-wi.fst(e)}var NMe=wi.hashCode,BMe=wi.toString;function UMe(e,t){return wi.fst(e)<=t&&t<wi.snd(e)}function jMe(e,t){var r=ld(e);return t>=r&&t<Ah(e)?t-r:-1}function zMe(e,t){return wi.fst(e)+t}var VMe=wi.areEqual;function SZ(e,t){var r=ev(e),n=ev(t);return r===0&&n===0?!0:r>0&&n>0&&J_(e)>=Z_(t)&&Z_(e)<=J_(t)}function HMe(e,t){return ev(e)?ev(t)?ld(e)<=ld(t)&&Ah(e)>=Ah(t):!0:ev(t)===0}function K5(e,t){var r=ld(e);if(t<=r)return 0;var n=Ah(e);return t>=n?n-r:t-r}function GMe(e,t,r){var n=ld(r),i=ld(e);if(t<=n+i)return n;var a=Ah(r);return t>=a+i?a:t-i}function CZ(e,t,r){return E6(K5(e,t),K5(e,r+1))}function qMe(e,t){return SZ(e,t)?E6(Math.max(ld(e),ld(t)),Math.min(Ah(e),Ah(t))):xZ}function $Me(e,t){return ev(CZ(e,Z_(t),J_(t)))}var Ie;(function(e){e.Empty=xZ,e.ofSingleton=function(t){return iU(t,t)},e.ofRange=iU,e.ofBounds=E6,e.ofLength=FMe,e.is=LMe,e.has=UMe,e.indexOf=jMe,e.getAt=zMe,e.start=ld,e.end=Ah,e.min=Z_,e.max=J_,e.size=ev,e.hashCode=NMe,e.toString=BMe,e.areEqual=VMe,e.areIntersecting=SZ,e.isSubInterval=HMe,e.findPredecessorIndex=K5,e.findPredecessorIndexInInterval=GMe,e.findRange=CZ,e.intersectionSize=$Me,e.intersect=qMe})(Ie||(Ie={}));var Nb=[];function WMe(e){return[e]}function XMe(e){return e}function YMe(e){return Ou(e),e}function aU(e,t){if(t<e)return[];for(var r=new Int32Array(t-e+1),n=e;n<=t;n++)r[n-e]=n;return r}function KMe(e){return e&&(Array.isArray(e)||!!e.buffer)}function Q5(e){return e[0]}function Z5(e){return e[e.length-1]+1}function QMe(e){return e[0]}function ZMe(e){return e[e.length-1]}function _Z(e){return e.length}function JMe(e){var t=e.length;return t?t>2?mMe(t,e[0],e[t-1],e[t>>1]):vMe(t,e[0],e[t-1]):0}function e5e(e){var t=e.length;return t>5?"["+e[0]+", "+e[1]+", ..., "+e[t-1]+"], length "+t:"["+e.join(", ")+"]"}function wZ(e,t){var r=e.length;return r===0?-1:e[0]<=t&&t<=e[r-1]?AZ(e,t,0,r):-1}function t5e(e,t,r){return EZ(e,t,Ie.start(r),Ie.end(r))}function EZ(e,t,r,n){var i=e.length;return i===0||n<=r?-1:e[r]<=t&&t<=e[n-1]?AZ(e,t,r,n):-1}function r5e(e,t){return wZ(e,t)>=0}function n5e(e,t){if(e===t)return!0;var r=e.length;if(r!==t.length||e[0]!==t[0]||e[r-1]!==t[r-1])return!1;for(var n=0;n<r;n++)if(e[n]!==t[n])return!1;return!0}function Hp(e,t){var r=e.length;return t<=e[0]?0:t>e[r-1]?r:PZ(e,t,0,r)}function i5e(e,t,r){var n=Ie.start(r),i=Ie.end(r),a=e[n];return t<=a?n:i>n&&t>e[i-1]?i:t-a<=11?o5e(e,t,n+1,i):PZ(e,t,n,i)}function a5e(e,t,r){return Ie.ofBounds(Hp(e,t),Hp(e,r+1))}function AZ(e,t,r,n){for(var i=r,a=n-1;i<=a;){if(i+11>a){for(var o=i;o<=a;o++)if(t===e[o])return o;return-1}var s=i+a>>1,u=e[s];if(t<u)a=s-1;else if(t>u)i=s+1;else return s}return-1}function PZ(e,t,r,n){for(var i=r,a=n-1;i<a;){if(i+11>a){for(var o=i;o<=a;o++)if(t<=e[o])return o;return a+1}var s=i+a>>1,u=e[s];if(t<u)a=s-1;else if(t>u)i=s+1;else return s}return i>a?a+1:e[i]>=t?i:i+1}function o5e(e,t,r,n){for(var i=r;i<n;i++)if(t<=e[i])return i;return n}function s5e(e,t){if(e===t)return!0;for(var r=Qv(e,t),n=r.startI,i=r.startJ,a=r.endI,o=r.endJ;n<a&&i<o;){var s=e[n],u=t[i];if(s<u)n++;else if(s>u)i++;else return!0}return!1}function u5e(e,t){if(e===t)return!0;var r=t.length,n=Qv(e,t),i=n.startI,a=n.startJ,o=n.endI,s=n.endJ;if(s-a<r||o-i<r)return!1;for(var u=0;i<o&&a<s;){var l=e[i],c=t[a];l<c?i++:l>c?a++:(i++,a++,u++)}return u===r}function TZ(e,t){if(e===t)return e;var r=e.length,n=t.length;if(r===0)return t;if(n===0)return e;if(e[0]>t[0])return TZ(t,e);var i=Qv(e,t),a=i.startI,o=i.startJ,s=i.endI,u=i.endJ,l=A6(e,t,a,o,s,u);if(l===r&&l===n||l===n)return e;if(l===r)return t;var c=new Int32Array(r+n-l),d=0,f=0,h=0;for(d=0;d<a;d++)c[h++]=e[d];for(;f<u&&e[a]>t[f];)c[h++]=t[f++];for(;d<s&&f<u;){var v=e[d],p=t[f];v<p?(c[h++]=v,d++):v>p?(c[h++]=p,f++):(c[h++]=v,d++,f++)}for(;d<s;d++)c[h++]=e[d];for(;f<u;f++)c[h++]=t[f];for(;d<r;d++)c[h++]=e[d];for(;f<n;f++)c[h++]=t[f];return c}function l5e(e,t){if(e===t)return _Z(e);var r=Qv(e,t),n=r.startI,i=r.startJ,a=r.endI,o=r.endJ;return A6(e,t,n,i,a,o)}function A6(e,t,r,n,i,a){for(var o=r,s=n,u=0;o<i&&s<a;){var l=e[o],c=t[s];l<c?o++:l>c?s++:(o++,s++,u++)}return u}function c5e(e,t){if(e===t)return e;var r=Qv(e,t),n=r.startI,i=r.startJ,a=r.endI,o=r.endJ,s=A6(e,t,n,i,a,o),u=e.length,l=t.length;if(!s)return Nb;if(s===u&&s===l||s===l)return t;if(s===u)return e;for(var c=new Int32Array(s),d=0,f=n,h=i;f<a&&h<o;){var v=e[f],p=t[h];v<p?f++:(v>p||(c[d++]=v,f++),h++)}return c}function d5e(e,t){if(e===t)return Nb;for(var r=e.length,n=Qv(e,t),i=n.startI,a=n.startJ,o=n.endI,s=n.endJ,u=i,l=a,c=0;u<o&&l<s;){var d=e[u],f=t[l];d<f?u++:d>f?l++:(u++,l++,c++)}if(!c)return e;if(c>=r)return Nb;for(var h=new Int32Array(r-c),v=0,p=0;p<i;p++)h[v++]=e[p];for(u=i,l=a;u<o&&l<s;){var d=e[u],f=t[l];d<f?(h[v++]=d,u++):(d>f||u++,l++)}for(;u<r;u++)h[v++]=e[u];return h}function f5e(e){if(e.length<2)return e;for(var t=1,r=0,n=e.length-1;r<n;r++)e[r]!==e[r+1]&&t++;if(t===e.length)return e;for(var i=new Int32Array(t),a=0,r=0,n=e.length-1;r<n;r++)e[r]!==e[r+1]&&(i[a++]=e[r]);return i[a]=e[e.length-1],i}function h5e(e,t){if(e===t)return Y5(0,e.length-1);for(var r=Qv(e,t),n=r.startI,i=r.startJ,a=r.endI,o=r.endJ,s=n,u=i,l=0;s<a&&u<o;){var c=e[s],d=t[u];c<d?s++:c>d?u++:(s++,u++,l++)}var f=e.length;if(!l)return Nb;if(l===f)return Y5(0,e.length-1);var h=new Int32Array(l),v=0;for(s=n,u=i;s<a&&u<o;){var c=e[s],d=t[u];c<d?s++:(c>d||(h[v++]=s,s++),u++)}return h}var dc={startI:0,startJ:0,endI:0,endJ:0};function Qv(e,t){var r=e.length,n=t.length,i=r/n;return r>=128||n>=128||i<=.34||i>=2.99?(dc.startI=Hp(e,Q5(t)),dc.startJ=Hp(t,Q5(e)),dc.endI=Hp(e,Z5(t)),dc.endJ=Hp(t,Z5(e))):(dc.startI=0,dc.startJ=0,dc.endI=r,dc.endJ=n),dc}var Je;(function(e){e.Empty=Nb,e.ofUnsortedArray=YMe,e.ofSingleton=WMe,e.ofSortedArray=XMe,e.ofRange=aU,e.ofBounds=function(t,r){return aU(t,r-1)},e.is=KMe,e.has=r5e,e.indexOf=wZ,e.indexOfInInterval=t5e,e.indexOfInRange=EZ,e.start=Q5,e.end=Z5,e.min=QMe,e.max=ZMe,e.size=_Z,e.hashCode=JMe,e.toString=e5e,e.areEqual=n5e,e.areIntersecting=s5e,e.isSubset=u5e,e.union=TZ,e.intersect=c5e,e.subtract=d5e,e.findPredecessorIndex=Hp,e.findPredecessorIndexInInterval=i5e,e.findRange=a5e,e.intersectionSize=l5e,e.deduplicate=f5e,e.indicesOf=h5e})(Je||(Je={}));var Yl=Ie.Empty,p5e=Ie.ofSingleton,v5e=Ie.ofRange,m5e=Ie.ofBounds;function Zu(e){return e.length?e[e.length-1]-e[0]+1===e.length?Ie.ofRange(e[0],e[e.length-1]):e:Yl}function tv(e){return Ie.is(e)?Ie.size(e):Je.size(e)}function g5e(e,t){return Ie.is(e)?Ie.has(e,t):Je.has(e,t)}function y5e(e,t){return Ie.is(e)?Ie.indexOf(e,t):Je.indexOf(e,t)}function J5(e,t){return Ie.is(e)?Ie.getAt(e,t):e[t]}function d0(e){return Ie.is(e)?Ie.min(e):Je.min(e)}function f0(e){return Ie.is(e)?Ie.max(e):Je.max(e)}function b5e(e){return Ie.is(e)?Ie.start(e):Je.start(e)}function x5e(e){return Ie.is(e)?Ie.end(e):Je.end(e)}function S5e(e){return Ie.is(e)?Ie.hashCode(e):Je.hashCode(e)}function C5e(e){return Ie.is(e)?Ie.toString(e):Je.toString(e)}function _5e(e,t){return Ie.is(e)?Ie.is(t)?Ie.areEqual(e,t):oU(e,t):Ie.is(t)?oU(t,e):Je.areEqual(e,t)}function w5e(e,t){return Ie.is(e)?Ie.is(t)?Ie.areIntersecting(e,t):sU(t,e):Ie.is(t)?sU(e,t):Je.areIntersecting(e,t)}function E5e(e,t){return Ie.is(e)?Ie.is(t)?Ie.isSubInterval(e,t):O5e(e,t):Ie.is(t)?k5e(e,t):Je.isSubset(e,t)}function A5e(e,t){return Ie.is(e)?Ie.findPredecessorIndex(e,t):Je.findPredecessorIndex(e,t)}function P5e(e,t,r){return Ie.is(e)?Ie.findPredecessorIndexInInterval(e,t,r):Je.findPredecessorIndexInInterval(e,t,r)}function T5e(e,t,r){return Ie.is(e)?Ie.findRange(e,t,r):Je.findRange(e,t,r)}function I5e(e,t){return Ie.is(e)?Ie.is(t)?Ie.intersectionSize(e,t):lU(t,e):Ie.is(t)?lU(e,t):Je.intersectionSize(e,t)}function M5e(e,t){return Ie.is(e)?Ie.is(t)?N5e(e,t):uU(t,e):Ie.is(t)?uU(e,t):Zu(Je.union(e,t))}function D5e(e,t){return Ie.is(e)?Ie.is(t)?Ie.intersect(e,t):cU(t,e):Ie.is(t)?cU(e,t):Zu(Je.intersect(e,t))}function R5e(e,t){return Ie.is(e)?Ie.is(t)?B5e(e,t):j5e(e,t):Ie.is(t)?U5e(e,t):Zu(Je.subtract(e,t))}function oU(e,t){return Ie.size(e)===Je.size(t)&&Ie.start(e)===Je.start(t)&&Ie.end(e)===Je.end(t)}function sU(e,t){return e.length!==0&&Ie.size(Je.findRange(e,Ie.min(t),Ie.max(t)))!==0}function k5e(e,t){var r=Ie.min(t),n=Ie.max(t);if(n-r+1===0)return!0;var i=Je.min(e),a=Je.max(e);if(r<i||n>a)return!1;var o=Je.findRange(e,r,n);return Ie.size(o)===Ie.size(t)}function O5e(e,t){var r=Ie.min(e),n=Ie.max(e);if(n-r+1===0)return!1;var i=Je.min(t),a=Je.max(t);return i>=r&&a<=n}function F5e(e,t){var r=tv(e),n=tv(t);return r===0&&n===0?!0:r>0&&n>0&&f0(e)>=d0(t)&&d0(e)<=f0(t)}function L5e(e,t){return tv(e)?tv(t)?d0(e)<=d0(t)&&f0(e)>=f0(t):!0:tv(t)===0}function N5e(e,t){if(Ie.areEqual(e,t))return e;var r=Ie.size(e),n=Ie.size(t);if(!n)return e;if(!r)return t;var i=Ie.min(e),a=Ie.min(t);if(F5e(e,t))return Ie.ofRange(Math.min(i,a),Math.max(Ie.max(e),Ie.max(t)));var o,s,u,l;i<a?(o=r,s=i,u=n,l=a):(o=n,s=a,u=r,l=i);for(var c=new Int32Array(r+n),d=0;d<o;d++)c[d]=d+s;for(var d=0;d<u;d++)c[d+o]=d+l;return Zu(c)}function uU(e,t){var r=Ie.size(t);if(!r)return e;if(L5e(t,e))return t;for(var n=Ie.min(t),i=Ie.max(t),a=Je.findRange(e,n,i),o=Ie.start(a),s=Ie.end(a),u=new Int32Array(o+(e.length-s)+r),l=0,c=0;c<o;c++)u[l++]=e[c];for(var c=n;c<=i;c++)u[l++]=c;for(var c=s,d=e.length;c<d;c++)u[l++]=e[c];return Zu(u)}function lU(e,t){if(!Ie.size(t))return 0;var r=Je.findRange(e,Ie.min(t),Ie.max(t));return Ie.end(r)-Ie.start(r)}function cU(e,t){if(!Ie.size(t))return Yl;var r=Je.findRange(e,Ie.min(t),Ie.max(t)),n=Ie.start(r),i=Ie.end(r),a=i-n;if(!a)return Yl;if(a===e.length)return e;for(var o=new Int32Array(a),s=0,u=n;u<i;u++)o[s++]=e[u];return Zu(o)}function B5e(e,t){if(Ie.areEqual(e,t))return Yl;if(!Ie.areIntersecting(e,t))return e;var r=Ie.min(e),n=Ie.max(e),i=Ie.min(t),a=Ie.max(t);if(n<r||a<i)return e;if(Ie.isSubInterval(t,e))return Yl;if(Ie.isSubInterval(e,t)){var o=i-r,s=n-a;if(o<=0)return Ie.ofRange(a+1,a+s);if(s<=0)return Ie.ofRange(r,r+o-1);for(var u=new Int32Array(o+s),l=0,c=0;c<o;c++)u[l++]=r+c;for(var c=1;c<=s;c++)u[l++]=a+c;return Zu(u)}return r<i?Ie.ofRange(r,i-1):Ie.ofRange(a+1,n)}function U5e(e,t){var r=Ie.min(t),n=Ie.max(t);if(n<r)return e;var i=Je.findRange(e,r,n),a=Ie.start(i),o=Ie.end(i),s=e.length-(o-a);if(s<=0)return Yl;if(s===e.length)return e;for(var u=new Int32Array(s),l=0,c=0;c<a;c++)u[l++]=e[c];for(var c=o,d=e.length;c<d;c++)u[l++]=e[c];return Zu(u)}function j5e(e,t){var r=Ie.min(e),n=Ie.max(e);if(n<r)return e;var i=n-r+1,a=Je.findRange(t,r,n),o=Ie.start(a),s=Ie.end(a),u=s-o;if(u===0)return e;var l=i-u;if(l<=0)return Yl;for(var c=new Int32Array(l),d=t.length-1,f=t[Math.min(o,d)],h=t[Math.min(s,d)],v=0,p=r;p<f;p++)c[v++]=p;for(var p=f;p<=h;p++)Je.indexOfInInterval(t,p,a)<0&&(c[v++]=p);for(var p=h+1;p<=n;p++)c[v++]=p;return Zu(c)}function z5e(e,t,r){if(Ie.is(e))for(var n=Ie.min(e),i=n,a=Ie.max(e);i<=a;i++)t(i,i-n,r);else for(var i=0,a=e.length;i<a;i++)t(e[i],i,r);return r}function V5e(e,t,r,n){if(Ie.is(e))for(var i=0,a=Ie.min(e),o=Ie.max(e);a<=o;a++){for(var s=t(a),u=a+1;u<o&&t(u)===s;)u++;a=u-1,r(s,i,n),i++}else for(var i=0,a=0,o=e.length;a<o;a++){for(var s=t(e[a]),u=a+1;u<o&&t(e[u])===s;)u++;a=u-1,r(s,i,n),i++}return n}function H5e(e,t,r){if(t===r)return e;var n=tv(e),i=t.length,a=r.length;if(n===0||i===0||a===0)return Yl;for(var o=Je.findPredecessorIndex(r,t[d0(e)]),s=Je.findPredecessorIndex(r,t[f0(e)]+1),u=0,l=0,c=0,d=o;c<n&&d<s;){var f=t[J5(e,c)],h=r[d];f<h?c++:(f>h||(u++,c++),d++)}if(u===0)return Yl;if(u===i&&u===a)return e;var v=new Int32Array(u);for(l=0,c=0,d=o;c<n&&d<s;){var f=t[J5(e,c)],h=r[d];f<h?c++:(f>h||(v[l++]=d,c++),d++)}return Zu(v)}var Fe;(function(e){e.Empty=Yl,e.ofSingleton=p5e,e.ofRange=v5e,e.ofBounds=m5e,e.ofSortedArray=Zu,e.has=g5e,e.indexOf=y5e,e.getAt=J5,e.min=d0,e.max=f0,e.start=b5e,e.end=x5e,e.size=tv,e.hashCode=S5e,e.areEqual=_5e,e.areIntersecting=w5e,e.isSubset=E5e,e.union=M5e,e.intersect=D5e,e.indexedIntersect=H5e,e.subtract=R5e,e.findPredecessorIndex=A5e,e.findPredecessorIndexInInterval=P5e,e.findRange=T5e,e.intersectionSize=I5e;function t(s,u,l){return z5e(s,u,l)}e.forEach=t;function r(s,u,l,c){return V5e(s,u,l,c)}e.forEachSegment=r;function n(s){return Ie.is(s)}e.isInterval=n;function i(s){return!Ie.is(s)}e.isSortedArray=i;function a(s){var u=[];return e.forEach(s,function(l){return u.push(l)}),u}e.toArray=a;function o(s){return C5e(s)}e.toString=o})(Fe||(Fe={}));function IZ(e){for(var t=Je.ofSortedArray(e),r=Je.max(t),n=new Int32Array(r),i=0,a=e.length-1;i<a;i++)for(var o=e[i],s=e[i+1];o<s;o++)n[o]=i;return{offsets:t,index:n,count:e.length-1}}function G5e(e,t){for(var r=Ie.start(t),n=new Int32Array(e.length+1),i=0,a=e.length;i<a;i++)n[i]=e[i]-r;return n[e.length]=Ie.end(t)-r,IZ(n)}function q5e(e){var t=e.count;return t}function $5e(e,t){var r=e.index;return r[t]}function W5e(e,t,r){var n=e.offsets,i=Fe.max(n),a=r>=i?-1:Fe.findPredecessorIndex(n,r-1);return Fe.findRange(t,Fe.getAt(n,a),Fe.getAt(n,a+1)-1)}var X5e=function(){function e(t,r,n,i){this.segments=t,this.segmentMap=r,this.set=n,this.segmentMin=0,this.segmentMax=0,this.setRange=Ie.Empty,this.value={index:0,start:0,end:0},this.hasNext=!1,this.setRange=i,this.updateSegmentRange()}return e.prototype.move=function(){for(;this.hasNext;)if(this.updateValue()){this.value.index=this.segmentMin++,this.hasNext=this.segmentMax>=this.segmentMin&&Ie.size(this.setRange)>0;break}else this.updateSegmentRange();return this.value},e.prototype.updateValue=function(){var t=this.segments[this.segmentMin+1],r=Fe.findPredecessorIndexInInterval(this.set,t,this.setRange);return this.value.start=Ie.start(this.setRange),this.value.end=r,this.setRange=Ie.ofBounds(r,Ie.end(this.setRange)),r>this.value.start},e.prototype.updateSegmentRange=function(){var t=Ie.min(this.setRange),r=Ie.max(this.setRange);if(r<t){this.hasNext=!1;return}this.segmentMin=this.segmentMap[Fe.getAt(this.set,t)],this.segmentMax=this.segmentMap[Fe.getAt(this.set,r)],this.hasNext=this.segmentMax>=this.segmentMin},e.prototype.setSegment=function(t){this.setRange=Ie.ofBounds(t.start,t.end),this.updateSegmentRange()},e}();function Y5e(e,t,r){var n=typeof r<"u"?Ie.ofBounds(r.start,r.end):Ie.ofBounds(0,Fe.size(t));return new X5e(e.offsets,e.index,t,n)}var ar;(function(e){e.create=IZ,e.ofOffsets=G5e,e.count=q5e,e.getSegment=$5e,e.projectValue=W5e,e.transientSegments=Y5e})(ar||(ar={}));function K5e(e){return new Q5e(e)}var Q5e=function(){function e(t){this.head=t>0?0:-1,this.prev=new Int32Array(t),this.next=new Int32Array(t);for(var r=0;r<t;r++)this.next[r]=r+1,this.prev[r]=r-1;this.prev[0]=-1,this.next[t-1]=-1}return e.prototype.remove=function(t){var r=this,n=r.prev,i=r.next,a=n[t],o=i[t];a>=0&&(i[a]=o,n[t]=-1),o>=0&&(n[o]=a,i[t]=-1),t===this.head&&(a<0?this.head=o:this.head=a)},e.prototype.has=function(t){return this.prev[t]>=0||this.next[t]>=0||this.head===t},e}(),Qs;(function(e){e.Empty=new Map;function t(o){return w6(o.keys())}e.keyArray=t;function r(){return new Map}e.Mutable=r;function n(o){return o}e.asImmutable=n;function i(o){for(var s=r(),u=o.keys();;){var l=u.next(),c=l.done,d=l.value;if(c)break;s.set(d,o.get(d))}return s}e.copy=i;function a(o,s){for(var u=s.keys();;){var l=u.next(),c=l.done,d=l.value;if(c)break;o.set(d,s.get(d))}return o}e.addFrom=a})(Qs||(Qs={}));var Z5e=function(){function e(t){this.xs=[],this.index=-1,this.length=0,this.hasNext=!1,this.length=t.length,this.hasNext=t.length>0,this.xs=t,this.index=-1,this.lastValue=t.length>0?t[0]:void 0}return e.prototype.move=function(){return++this.index,this.lastValue=this.xs[this.index],this.hasNext=this.index<this.length-1,this.lastValue},e}(),dU=function(){function e(t,r){this.max=r,this.value=0,this.hasNext=!1,this.value=t-1,this.hasNext=r>=t}return e.prototype.move=function(){return++this.value,this.hasNext=this.value<this.max,this.value},e}(),J5e=function(){function e(t){this.value=t,this.hasNext=!0}return e.prototype.move=function(){return this.hasNext=!1,this.value},e}(),eDe=function(){function e(t,r){this.base=t,this.f=r,this.hasNext=!1,this.hasNext=t.hasNext}return e.prototype.move=function(){var t=this.f(this.base.move());return this.hasNext=this.base.hasNext,t},e}(),tDe=function(){function e(t,r){this.base=t,this.p=r,this.hasNext=this.findNext()}return e.prototype.move=function(){var t=this.next;return this.hasNext=this.findNext(),t},e.prototype.findNext=function(){for(;this.base.hasNext;)if(this.next=this.base.move(),this.p(this.next))return!0;return!1},e}(),ew;(function(e){e.Empty=new dU(0,-1);function t(s){return new Z5e(s)}e.Array=t;function r(s){return new J5e(s)}e.Value=r;function n(s,u){return new dU(s,u)}e.Range=n;function i(s,u){return new eDe(s,u)}e.map=i;function a(s,u){return new tDe(s,u)}e.filter=a;function o(s,u,l){for(;s.hasNext;){var c=u(s.move(),l);if(c)return l}return l}e.forEach=o})(ew||(ew={}));var rDe={domain:[0,1],reverse:!1,listOrName:"red-yellow-blue",minLabel:"",maxLabel:""},Gu;(function(e){function t(r){var n=E(E({},rDe),r),i=n.domain,a=n.reverse,o=n.listOrName,s=typeof o=="string"?Ks(o).list:o,u=a?s.slice().reverse():s,l=u.length-1,c=0,d=0,f=0;function h(C,w){d=C,f=w,c=f-d||1}h(i[0],i[1]);var v=Oi(r.minLabel,d.toString()),p=Oi(r.maxLabel,f.toString()),m,g=u.every(function(C){return Array.isArray(C)});if(g){var y=Nt([],u);y.sort(function(C,w){return C[1]-w[1]});var b=y.map(function(C){return C[0]}),S=Je.ofSortedArray(y.map(function(C){return C[1]})),x=b.length-1;m=function(C){var w=Va((C-d)/c,0,1),A=Je.findPredecessorIndex(S,w);if(A===0)return b[d];if(A>x)return b[x];var M=S[A-1],D=S[A],k=Va((w-M)/(D-M),0,1);return at.interpolate(b[A-1],b[A],k)}}else m=function(C){var w=Math.min(u.length-1,Math.max(0,(C-d)/c*l)),A=Math.floor(w),M=u[A],D=u[Math.ceil(w)];return at.interpolate(M,D,w-A)};return{color:m,colorToArray:function(C,w,A){at.toArray(m(C),w,A)},normalizedColorToArray:function(C,w,A){at.toArrayNormalized(m(C),w,A)},setDomain:h,get legend(){return aMe(v,p,u)}}}e.create=t})(Gu||(Gu={}));function cn(e){return e.svg?P.jsx("span",E({className:"msp-icon msp-material-icon"+(e.inline?" msp-icon-inline":""),title:e.title,style:e.style},{children:P.jsx(e.svg,{},void 0)}),void 0):null}var ME=P.jsx("circle",{r:"6px",id:"circle-left",cy:"12px",cx:"8px",strokeWidth:"1px"},void 0),DE=P.jsx("circle",{r:"6px",id:"circle-right",cy:"12px",cx:"16px",strokeWidth:"1px"},void 0),nDe=P.jsxs("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:[P.jsxs("defs",{children:[ME,DE]},void 0),P.jsxs("g",{children:[P.jsx("use",{href:"#circle-left",className:"msp-shape-filled"},void 0),P.jsx("use",{href:"#circle-right",className:"msp-shape-filled"},void 0),P.jsx("use",{href:"#circle-left",className:"msp-shape-empty"},void 0)]},void 0)]}),void 0);function eD(){return nDe}var iDe=P.jsxs("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:[P.jsxs("defs",{children:[ME,DE,P.jsxs("mask",E({id:"mask-left"},{children:[P.jsx("use",{href:"#circle-left",fill:"white",stroke:"white"},void 0),P.jsx("use",{href:"#circle-right",fill:"black",strokeWidth:"0px",stroke:"white"},void 0)]}),void 0)]},void 0),P.jsxs("g",{children:[P.jsx("use",{href:"#circle-left",className:"msp-shape-filled",mask:"url(#mask-left)"},void 0),P.jsx("use",{href:"#circle-right",className:"msp-shape-empty"},void 0)]},void 0)]}),void 0);function tD(){return iDe}var aDe=P.jsxs("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:[P.jsxs("defs",{children:[ME,DE,P.jsx("clipPath",E({id:"clip-left"},{children:P.jsx("use",{href:"#circle-right"},void 0)}),void 0)]},void 0),P.jsxs("g",{children:[P.jsx("use",{href:"#circle-left",className:"msp-shape-filled",clipPath:"url(#clip-left)"},void 0),P.jsx("use",{href:"#circle-left",className:"msp-shape-empty"},void 0),P.jsx("use",{href:"#circle-right",className:"msp-shape-empty"},void 0)]},void 0)]}),void 0);function rD(){return aDe}var oDe=P.jsxs("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:[P.jsxs("defs",{children:[ME,DE]},void 0),P.jsxs("g",{children:[P.jsx("use",{href:"#circle-left",className:"msp-shape-empty"},void 0),P.jsx("use",{href:"#circle-right",className:"msp-shape-filled"},void 0)]},void 0)]}),void 0);function tw(){return oDe}var sDe=P.jsx("svg",E({width:"17px",height:"17px",viewBox:"0 0 299.463 299.463",strokeWidth:"6px"},{children:P.jsx("g",{children:P.jsx("path",{d:"M256.851,173.832v-48.201c22.916-4.918,34.151-30.668,22.556-50.771c-11.547-20.004-39.486-23.251-55.242-5.844 l-41.746-24.106C189.618,22.603,172.861,0,149.734,0c-23.132,0-39.881,22.609-32.685,44.911L75.305,69.016 C59.522,51.586,31.597,54.88,20.061,74.863c-11.63,20.163-0.298,45.862,22.557,50.769v48.2 c-22.821,4.898-34.195,30.591-22.556,50.771c11.529,19.972,39.454,23.285,55.242,5.845l41.746,24.106 c-7.199,22.308,9.559,44.911,32.685,44.911c23.132,0,39.88-22.609,32.685-44.911l41.745-24.106 c15.817,17.469,43.73,14.099,55.242-5.844c0,0,0-0.001,0.001-0.002c4.587-7.953,5.805-17.213,3.431-26.076 C279.392,185.657,269.129,176.461,256.851,173.832z M249.62,72.088c20.568,0,27.428,27.191,10.008,37.239 c-0.003,0.002-0.006,0.003-0.009,0.005c-10.04,5.81-22.85,1.762-27.877-8.475C225.206,87.548,234.938,72.088,249.62,72.088z M149.734,14.4c11.005,0,19.958,8.954,19.958,19.959c0,11.127-9.077,19.958-19.958,19.958c-10.95,0-19.958-8.9-19.958-19.958 C129.776,23.354,138.729,14.4,149.734,14.4z M39.84,109.328c-17.451-10.067-10.534-37.24,10.01-37.24 c15.311,0,24.922,16.653,17.251,29.942C61.681,111.397,49.517,114.925,39.84,109.328z M59.802,224.702 c-9.535,5.503-21.768,2.229-27.268-7.298c-7.639-13.242,1.887-29.945,17.236-29.945c0.013,0,0.027,0,0.04,0 C70.07,187.48,77.49,214.469,59.802,224.702z M149.734,285.062c-11.005,0-19.958-8.954-19.958-19.958 c0-11.127,9.077-19.958,19.958-19.958c10.954,0,19.958,8.903,19.958,19.958C169.693,276.109,160.74,285.062,149.734,285.062z M216.953,217.982l-41.727,24.095c-13.778-15.22-37.459-14.94-50.983,0l-41.728-24.096c6.196-19.289-5.541-39.835-25.498-44.149 V125.63c19.752-4.268,31.762-24.65,25.498-44.149l41.727-24.095c13.629,15.055,37.32,15.093,50.983,0l41.728,24.096 c-6.196,19.29,5.534,39.835,25.498,44.149v48.202C222.61,178.123,210.721,198.581,216.953,217.982z M266.935,217.404 c-5.501,9.528-17.732,12.802-27.261,7.302c-17.682-10.23-10.301-37.247,10.032-37.247 C264.984,187.459,274.602,204.112,266.935,217.404z"},void 0)},void 0)}),void 0);function uDe(){return sDe}var lDe=P.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24",strokeWidth:"0.1px"},{children:P.jsx("path",{d:"M21,16.5C21,16.88 20.79,17.21 20.47,17.38L12.57,21.82C12.41,21.94 12.21,22 12,22C11.79,22 11.59,21.94 11.43,21.82L3.53,17.38C3.21,17.21 3,16.88 3,16.5V7.5C3,7.12 3.21,6.79 3.53,6.62L11.43,2.18C11.59,2.06 11.79,2 12,2C12.21,2 12.41,2.06 12.57,2.18L20.47,6.62C20.79,6.79 21,7.12 21,7.5V16.5M12,4.15L6.04,7.5L12,10.85L17.96,7.5L12,4.15M5,15.91L11,19.29V12.58L5,9.21V15.91M19,15.91V9.21L13,12.58V19.29L19,15.91Z"},void 0)}),void 0);function nD(){return lDe}P.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24",strokeWidth:"0.1px"},{children:P.jsx("path",{d:"M17,22V20H20V17H22V20.5C22,20.89 21.84,21.24 21.54,21.54C21.24,21.84 20.89,22 20.5,22H17M7,22H3.5C3.11,22 2.76,21.84 2.46,21.54C2.16,21.24 2,20.89 2,20.5V17H4V20H7V22M17,2H20.5C20.89,2 21.24,2.16 21.54,2.46C21.84,2.76 22,3.11 22,3.5V7H20V4H17V2M7,2V4H4V7H2V3.5C2,3.11 2.16,2.76 2.46,2.46C2.76,2.16 3.11,2 3.5,2H7M13,17.25L17,14.95V10.36L13,12.66V17.25M12,10.92L16,8.63L12,6.28L8,8.63L12,10.92M7,14.95L11,17.25V12.66L7,10.36V14.95M18.23,7.59C18.73,7.91 19,8.34 19,8.91V15.23C19,15.8 18.73,16.23 18.23,16.55L12.75,19.73C12.25,20.05 11.75,20.05 11.25,19.73L5.77,16.55C5.27,16.23 5,15.8 5,15.23V8.91C5,8.34 5.27,7.91 5.77,7.59L11.25,4.41C11.5,4.28 11.75,4.22 12,4.22C12.25,4.22 12.5,4.28 12.75,4.41L18.23,7.59Z"},void 0)}),void 0);P.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24",strokeWidth:"0.1px"},{children:P.jsx("path",{d:"M16,4L9,8.04V15.96L16,20L23,15.96V8.04M16,6.31L19.8,8.5L16,10.69L12.21,8.5M0,7V9H7V7M11,10.11L15,12.42V17.11L11,14.81M21,10.11V14.81L17,17.11V12.42M2,11V13H7V11M4,15V17H7V15"},void 0)}),void 0);var cDe=P.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:P.jsx("path",{d:"M10.07,14.27C10.57,14.03 11.16,14.25 11.4,14.75L13.7,19.74L15.5,18.89L13.19,13.91C12.95,13.41 13.17,12.81 13.67,12.58L13.95,12.5L16.25,12.05L8,5.12V15.9L9.82,14.43L10.07,14.27M13.64,21.97C13.14,22.21 12.54,22 12.31,21.5L10.13,16.76L7.62,18.78C7.45,18.92 7.24,19 7,19A1,1 0 0,1 6,18V3A1,1 0 0,1 7,2C7.24,2 7.47,2.09 7.64,2.23L7.65,2.22L19.14,11.86C19.57,12.22 19.62,12.85 19.27,13.27C19.12,13.45 18.91,13.57 18.7,13.61L15.54,14.23L17.74,18.96C18,19.46 17.76,20.05 17.26,20.28L13.64,21.97Z"},void 0)}),void 0);function dDe(){return cDe}P.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24",strokeWidth:"0.1px"},{children:P.jsx("path",{fill:"currentColor",d:"M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"},void 0)}),void 0);var fDe=P.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24",strokeWidth:"0.1px"},{children:P.jsx("path",{d:"M3 17.25V21H6.75L17.81 9.93L14.06 6.18L3 17.25M22.61 18.36L18.36 22.61L13.16 17.41L14.93 15.64L15.93 16.64L18.4 14.16L19.82 15.58L18.36 17L19.42 18L20.84 16.6L22.61 18.36M6.61 10.83L1.39 5.64L5.64 1.39L7.4 3.16L4.93 5.64L6 6.7L8.46 4.22L9.88 5.64L8.46 7.05L9.46 8.05L6.61 10.83M20.71 7C21.1 6.61 21.1 6 20.71 5.59L18.37 3.29C18 2.9 17.35 2.9 16.96 3.29L15.12 5.12L18.87 8.87L20.71 7Z"},void 0)}),void 0);function hDe(){return fDe}var pDe=P.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:P.jsx("path",{d:"M22 11V3h-7v3H9V3H2v8h7V8h2v10h4v3h7v-8h-7v3h-2V8h2v3h7zM7 9H4V5h3v4zm10 6h3v4h-3v-4zm0-10h3v4h-3V5z"},void 0)}),void 0);function MZ(){return pDe}var vDe=P.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:P.jsx("path",{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"},void 0)}),void 0);function N0(){return vDe}var mDe=P.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:P.jsx("path",{d:"M20 12l-1.41-1.41L13 16.17V4h-2v12.17l-5.58-5.59L4 12l8 8 8-8z"},void 0)}),void 0);function RE(){return mDe}var gDe=P.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:P.jsx("path",{d:"M7 10l5 5 5-5z"},void 0)}),void 0);function cd(){return gDe}var yDe=P.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:P.jsx("path",{d:"M10 17l5-5-5-5v10z"},void 0)}),void 0);function dd(){return yDe}var bDe=P.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:P.jsx("path",{d:"M4 12l1.41 1.41L11 7.83V20h2V7.83l5.58 5.59L20 12l-8-8-8 8z"},void 0)}),void 0);function kE(){return bDe}var xDe=P.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:P.jsx("path",{d:"M12 6v3l4-4-4-4v3c-4.42 0-8 3.58-8 8 0 1.57.46 3.03 1.24 4.26L6.7 14.8c-.45-.83-.7-1.79-.7-2.8 0-3.31 2.69-6 6-6zm6.76 1.74L17.3 9.2c.44.84.7 1.79.7 2.8 0 3.31-2.69 6-6 6v-3l-4 4 4 4v-3c4.42 0 8-3.58 8-8 0-1.57-.46-3.03-1.24-4.26z"},void 0)}),void 0);function SDe(){return xDe}var CDe=P.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:P.jsx("path",{d:"M6 13c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1zm0 4c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1zm0-8c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1zm-3 .5c-.28 0-.5.22-.5.5s.22.5.5.5.5-.22.5-.5-.22-.5-.5-.5zM6 5c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1zm15 5.5c.28 0 .5-.22.5-.5s-.22-.5-.5-.5-.5.22-.5.5.22.5.5.5zM14 7c.55 0 1-.45 1-1s-.45-1-1-1-1 .45-1 1 .45 1 1 1zm0-3.5c.28 0 .5-.22.5-.5s-.22-.5-.5-.5-.5.22-.5.5.22.5.5.5zm-11 10c-.28 0-.5.22-.5.5s.22.5.5.5.5-.22.5-.5-.22-.5-.5-.5zm7 7c-.28 0-.5.22-.5.5s.22.5.5.5.5-.22.5-.5-.22-.5-.5-.5zm0-17c.28 0 .5-.22.5-.5s-.22-.5-.5-.5-.5.22-.5.5.22.5.5.5zM10 7c.55 0 1-.45 1-1s-.45-1-1-1-1 .45-1 1 .45 1 1 1zm0 5.5c-.83 0-1.5.67-1.5 1.5s.67 1.5 1.5 1.5 1.5-.67 1.5-1.5-.67-1.5-1.5-1.5zm8 .5c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1zm0 4c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1zm0-8c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1zm0-4c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1zm3 8.5c-.28 0-.5.22-.5.5s.22.5.5.5.5-.22.5-.5-.22-.5-.5-.5zM14 17c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1zm0 3.5c-.28 0-.5.22-.5.5s.22.5.5.5.5-.22.5-.5-.22-.5-.5-.5zm-4-12c-.83 0-1.5.67-1.5 1.5s.67 1.5 1.5 1.5 1.5-.67 1.5-1.5-.67-1.5-1.5-1.5zm0 8.5c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1zm4-4.5c-.83 0-1.5.67-1.5 1.5s.67 1.5 1.5 1.5 1.5-.67 1.5-1.5-.67-1.5-1.5-1.5zm0-4c-.83 0-1.5.67-1.5 1.5s.67 1.5 1.5 1.5 1.5-.67 1.5-1.5-.67-1.5-1.5-1.5z"},void 0)}),void 0);function DZ(){return CDe}var _De=P.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:P.jsx("path",{d:"M15 7v12.97l-4.21-1.81-.79-.34-.79.34L5 19.97V7h10m4-6H8.99C7.89 1 7 1.9 7 3h10c1.1 0 2 .9 2 2v13l2 1V3c0-1.1-.9-2-2-2zm-4 4H5c-1.1 0-2 .9-2 2v16l7-3 7 3V7c0-1.1-.9-2-2-2z"},void 0)}),void 0);function OE(){return _De}var wDe=P.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:P.jsx("path",{d:"M7 14c-1.66 0-3 1.34-3 3 0 1.31-1.16 2-2 2 .92 1.22 2.49 2 4 2 2.21 0 4-1.79 4-4 0-1.66-1.34-3-3-3zm13.71-9.37l-1.34-1.34a.9959.9959 0 00-1.41 0L9 12.25 11.75 15l8.96-8.96c.39-.39.39-1.02 0-1.41z"},void 0)}),void 0);function iD(){return wDe}var EDe=P.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:P.jsx("path",{d:"M22.61 18.99l-9.08-9.08c.93-2.34.45-5.1-1.44-7C9.79.61 6.21.4 3.66 2.26L7.5 6.11 6.08 7.52 2.25 3.69C.39 6.23.6 9.82 2.9 12.11c1.86 1.86 4.57 2.35 6.89 1.48l9.11 9.11c.39.39 1.02.39 1.41 0l2.3-2.3c.4-.38.4-1.01 0-1.41zm-3 1.6l-9.46-9.46c-.61.45-1.29.72-2 .82-1.36.2-2.79-.21-3.83-1.25C3.37 9.76 2.93 8.5 3 7.26l3.09 3.09 4.24-4.24-3.09-3.09c1.24-.07 2.49.37 3.44 1.31 1.08 1.08 1.49 2.57 1.24 3.96-.12.71-.42 1.37-.88 1.96l9.45 9.45-.88.89z"},void 0)}),void 0);function ADe(){return EDe}var PDe=P.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:P.jsx("path",{d:"M22.7 19l-9.1-9.1c.9-2.3.4-5-1.5-6.9-2-2-5-2.4-7.4-1.3L9 6 6 9 1.6 4.7C.4 7.1.9 10.1 2.9 12.1c1.9 1.9 4.6 2.4 6.9 1.5l9.1 9.1c.4.4 1 .4 1.4 0l2.3-2.3c.5-.4.5-1.1.1-1.4z"},void 0)}),void 0);function TDe(){return PDe}var IDe=P.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:P.jsx("path",{d:"M14.25 2.26l-.08-.04-.01.02C13.46 2.09 12.74 2 12 2 6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10c0-4.75-3.31-8.72-7.75-9.74zM19.41 9h-7.99l2.71-4.7c2.4.66 4.35 2.42 5.28 4.7zM13.1 4.08L10.27 9l-1.15 2L6.4 6.3C7.84 4.88 9.82 4 12 4c.37 0 .74.03 1.1.08zM5.7 7.09L8.54 12l1.15 2H4.26C4.1 13.36 4 12.69 4 12c0-1.85.64-3.55 1.7-4.91zM4.59 15h7.98l-2.71 4.7c-2.4-.67-4.34-2.42-5.27-4.7zm6.31 4.91L14.89 13l2.72 4.7C16.16 19.12 14.18 20 12 20c-.38 0-.74-.04-1.1-.09zm7.4-3l-4-6.91h5.43c.17.64.27 1.31.27 2 0 1.85-.64 3.55-1.7 4.91z"},void 0)}),void 0);function MDe(){return IDe}var DDe=P.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:P.jsx("path",{d:"M9.4 10.5l4.77-8.26C13.47 2.09 12.75 2 12 2c-2.4 0-4.6.85-6.32 2.25l3.66 6.35.06-.1zM21.54 9c-.92-2.92-3.15-5.26-6-6.34L11.88 9h9.66zm.26 1h-7.49l.29.5 4.76 8.25C21 16.97 22 14.61 22 12c0-.69-.07-1.35-.2-2zM8.54 12l-3.9-6.75C3.01 7.03 2 9.39 2 12c0 .69.07 1.35.2 2h7.49l-1.15-2zm-6.08 3c.92 2.92 3.15 5.26 6 6.34L12.12 15H2.46zm11.27 0l-3.9 6.76c.7.15 1.42.24 2.17.24 2.4 0 4.6-.85 6.32-2.25l-3.66-6.35-.93 1.6z"},void 0)}),void 0);function RDe(){return DDe}var kDe=P.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:P.jsx("path",{d:"M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm3.59-13L12 10.59 8.41 7 7 8.41 10.59 12 7 15.59 8.41 17 12 13.41 15.59 17 17 15.59 13.41 12 17 8.41z"},void 0)}),void 0);function P6(){return kDe}var ODe=P.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:P.jsx("path",{d:"M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2zm5 13.59L15.59 17 12 13.41 8.41 17 7 15.59 10.59 12 7 8.41 8.41 7 12 10.59 15.59 7 17 8.41 13.41 12 17 15.59z"},void 0)}),void 0);function RZ(){return ODe}var FDe=P.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:P.jsx("path",{d:"M12 8c-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4zm-7 7H3v4c0 1.1.9 2 2 2h4v-2H5v-4zM5 5h4V3H5c-1.1 0-2 .9-2 2v4h2V5zm14-2h-4v2h4v4h2V5c0-1.1-.9-2-2-2zm0 16h-4v2h4c1.1 0 2-.9 2-2v-4h-2v4z"},void 0)}),void 0);function LDe(){return FDe}var NDe=P.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:P.jsx("path",{d:"M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"},void 0)}),void 0);function B0(){return NDe}var BDe=P.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:P.jsx("path",{d:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"},void 0)}),void 0);function kZ(){return BDe}var UDe=P.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:P.jsx("path",{d:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"},void 0)}),void 0);function jc(){return UDe}var jDe=P.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:P.jsx("path",{d:"M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96zM14 13v4h-4v-4H7l5-5 5 5h-3z"},void 0)}),void 0);function zDe(){return jDe}var VDe=P.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:P.jsx("path",{d:"M9.4 16.6L4.8 12l4.6-4.6L8 6l-6 6 6 6 1.4-1.4zm5.2 0l4.6-4.6-4.6-4.6L16 6l6 6-6 6-1.4-1.4z"},void 0)}),void 0);function HDe(){return VDe}var GDe=P.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:P.jsx("path",{d:"M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm-1 4H8c-1.1 0-1.99.9-1.99 2L6 21c0 1.1.89 2 1.99 2H19c1.1 0 2-.9 2-2V11l-6-6zM8 21V7h6v5h5v9H8z"},void 0)}),void 0);function qDe(){return GDe}var $De=P.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:P.jsx("path",{d:"M17 15h2V7c0-1.1-.9-2-2-2H9v2h8v8zM7 17V1H5v4H1v2h4v10c0 1.1.9 2 2 2h10v4h2v-4h4v-2H7z"},void 0)}),void 0);function WDe(){return $De}var XDe=P.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:P.jsx("path",{d:"M3 5v4h2V5h4V3H5c-1.1 0-2 .9-2 2zm2 10H3v4c0 1.1.9 2 2 2h4v-2H5v-4zm14 4h-4v2h4c1.1 0 2-.9 2-2v-4h-2v4zm0-16h-4v2h4v4h2V5c0-1.1-.9-2-2-2z"},void 0)}),void 0);function YDe(){return XDe}var KDe=P.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:P.jsx("path",{d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V5h14v14zm-5.04-6.71l-2.75 3.54-1.96-2.36L6.5 17h11l-3.54-4.71z"},void 0)}),void 0);function QDe(){return KDe}var ZDe=P.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:P.jsx("path",{d:"M16 9v10H8V9h8m-1.5-6h-5l-1 1H5v2h14V4h-3.5l-1-1zM18 7H6v12c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7z"},void 0)}),void 0);function iu(){return ZDe}P.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:P.jsx("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"},void 0)}),void 0);var JDe=P.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:P.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"},void 0)}),void 0);function fU(){return JDe}P.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:P.jsx("path",{d:"M20.5 11H19V7c0-1.1-.9-2-2-2h-4V3.5C13 2.12 11.88 1 10.5 1S8 2.12 8 3.5V5H4c-1.1 0-1.99.9-1.99 2v3.8H3.5c1.49 0 2.7 1.21 2.7 2.7s-1.21 2.7-2.7 2.7H2V20c0 1.1.9 2 2 2h3.8v-1.5c0-1.49 1.21-2.7 2.7-2.7 1.49 0 2.7 1.21 2.7 2.7V22H17c1.1 0 2-.9 2-2v-4h1.5c1.38 0 2.5-1.12 2.5-2.5S21.88 11 20.5 11z"},void 0)}),void 0);var eRe=P.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24",strokeWidth:"0.1px"},{children:P.jsx("path",{d:"M3 13h2v-2H3v2zm0 4h2v-2H3v2zm2 4v-2H3c0 1.1.89 2 2 2zM3 9h2V7H3v2zm12 12h2v-2h-2v2zm4-18H9c-1.11 0-2 .9-2 2v10c0 1.1.89 2 2 2h10c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 12H9V5h10v10zm-8 6h2v-2h-2v2zm-4 0h2v-2H7v2z"},void 0)}),void 0);function tRe(){return eRe}var rRe=P.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:P.jsx("path",{d:"M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z"},void 0)}),void 0);function nRe(){return rRe}var iRe=P.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:P.jsx("path",{d:"M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"},void 0)}),void 0);function aD(){return iRe}var aRe=P.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:P.jsx("path",{d:"M11 18h2v-2h-2v2zm1-16C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm0-14c-2.21 0-4 1.79-4 4h2c0-1.1.9-2 2-2s2 .9 2 2c0 2-3 1.75-3 5h2c0-2.25 3-2.5 3-5 0-2.21-1.79-4-4-4z"},void 0)}),void 0);function Kl(){return aRe}var oRe=P.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:P.jsx("path",{d:"M12 5.69l5 4.5V18h-2v-6H9v6H7v-7.81l5-4.5M12 3L2 12h3v8h6v-6h2v6h6v-8h3L12 3z"},void 0)}),void 0);function oD(){return oRe}P.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:P.jsx("path",{d:"M19 19H5V5h7V3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2v-7h-2v7zM14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3h-7z"},void 0)}),void 0);var sRe=P.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:P.jsx("path",{d:"M19.5 9.5c-1.03 0-1.9.62-2.29 1.5h-2.92c-.39-.88-1.26-1.5-2.29-1.5s-1.9.62-2.29 1.5H6.79c-.39-.88-1.26-1.5-2.29-1.5C3.12 9.5 2 10.62 2 12s1.12 2.5 2.5 2.5c1.03 0 1.9-.62 2.29-1.5h2.92c.39.88 1.26 1.5 2.29 1.5s1.9-.62 2.29-1.5h2.92c.39.88 1.26 1.5 2.29 1.5 1.38 0 2.5-1.12 2.5-2.5s-1.12-2.5-2.5-2.5z"},void 0)}),void 0);function uRe(){return sRe}var lRe=P.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:P.jsx("path",{d:"M6 10c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm12 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm-6 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"},void 0)}),void 0);function Av(){return lRe}var cRe=P.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:P.jsx("path",{d:"M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"},void 0)}),void 0);function OZ(){return cRe}var dRe=P.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:P.jsx("path",{d:"M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"},void 0)}),void 0);function FZ(){return dRe}var fRe=P.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:P.jsx("path",{d:"M19 4H5c-1.11 0-2 .9-2 2v12c0 1.1.89 2 2 2h4v-2H5V8h14v10h-4v2h4c1.1 0 2-.9 2-2V6c0-1.1-.89-2-2-2zm-7 6l-4 4h3v6h2v-6h3l-4-4z"},void 0)}),void 0);function hRe(){return fRe}var pRe=P.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:P.jsx("path",{d:"M8 5v14l11-7z"},void 0)}),void 0);function LZ(){return pRe}var vRe=P.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:P.jsx("path",{d:"M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"},void 0)}),void 0);function sD(){return vRe}var mRe=P.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:P.jsx("path",{d:"M19 13H5v-2h14v2z"},void 0)}),void 0);function uD(){return mRe}var gRe=P.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:P.jsx("path",{d:"M13 3c-4.97 0-9 4.03-9 9H1l3.89 3.89.07.14L9 12H6c0-3.87 3.13-7 7-7s7 3.13 7 7-3.13 7-7 7c-1.93 0-3.68-.79-4.94-2.06l-1.42 1.42C8.27 19.99 10.51 21 13 21c4.97 0 9-4.03 9-9s-4.03-9-9-9zm-1 5v5l4.28 2.54.72-1.21-3.5-2.08V8H12z"},void 0)}),void 0);function lD(){return gRe}var yRe=P.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24",strokeWidth:"0.1px"},{children:P.jsx("path",{d:"M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7l-4-4zm2 16H5V5h11.17L19 7.83V19zm-7-7c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3zM6 6h9v4H6z"},void 0)}),void 0);function NZ(){return yRe}var bRe=P.jsxs("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:[P.jsx("circle",{cx:"7",cy:"14",r:"3"},void 0),P.jsx("circle",{cx:"11",cy:"6",r:"3"},void 0),P.jsx("circle",{cx:"16.6",cy:"17.6",r:"3"},void 0)]}),void 0);function xRe(){return bRe}var SRe=P.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:P.jsx("path",{d:"M6 6h2v12H6zm3.5 6l8.5 6V6z"},void 0)}),void 0);function CRe(){return SRe}var _Re=P.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:P.jsx("path",{d:"M6 6h12v12H6z"},void 0)}),void 0);function BZ(){return _Re}var wRe=P.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:P.jsx("path",{d:"M4 6h16v2H4zm2-4h12v2H6zm14 8H4c-1.1 0-2 .9-2 2v8c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2v-8c0-1.1-.9-2-2-2zm0 10H4v-8h16v8zm-10-7.27v6.53L16 16z"},void 0)}),void 0);function ERe(){return wRe}var ARe=P.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:P.jsx("path",{d:"M6.99 11L3 15l3.99 4v-3H14v-2H6.99v-3zM21 9l-3.99-4v3H10v2h7.01v3L21 9z"},void 0)}),void 0);function PRe(){return ARe}var TRe=P.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:P.jsx("path",{d:"M3 17v2h6v-2H3zM3 5v2h10V5H3zm10 16v-2h8v-2h-8v-2h-2v6h2zM7 9v2H3v2h4v2h2V9H7zm14 4v-2H11v2h10zm-6-4h2V7h4V5h-4V3h-2v6z"},void 0)}),void 0);function Pv(){return TRe}var IRe=P.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:P.jsx("path",{d:"M12 6c3.79 0 7.17 2.13 8.82 5.5-.59 1.22-1.42 2.27-2.41 3.12l1.41 1.41c1.39-1.23 2.49-2.77 3.18-4.53C21.27 7.11 17 4 12 4c-1.27 0-2.49.2-3.64.57l1.65 1.65C10.66 6.09 11.32 6 12 6zm-1.07 1.14L13 9.21c.57.25 1.03.71 1.28 1.28l2.07 2.07c.08-.34.14-.7.14-1.07C16.5 9.01 14.48 7 12 7c-.37 0-.72.05-1.07.14zM2.01 3.87l2.68 2.68C3.06 7.83 1.77 9.53 1 11.5 2.73 15.89 7 19 12 19c1.52 0 2.98-.29 4.32-.82l3.42 3.42 1.41-1.41L3.42 2.45 2.01 3.87zm7.5 7.5l2.61 2.61c-.04.01-.08.02-.12.02-1.38 0-2.5-1.12-2.5-2.5 0-.05.01-.08.01-.13zm-3.4-3.4l1.75 1.75c-.23.55-.36 1.15-.36 1.78 0 2.48 2.02 4.5 4.5 4.5.63 0 1.23-.13 1.77-.36l.98.98c-.88.24-1.8.38-2.75.38-3.79 0-7.17-2.13-8.82-5.5.7-1.43 1.72-2.61 2.93-3.53z"},void 0)}),void 0);function Zv(){return IRe}var MRe=P.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:P.jsx("path",{d:"M12 6c3.79 0 7.17 2.13 8.82 5.5C19.17 14.87 15.79 17 12 17s-7.17-2.13-8.82-5.5C4.83 8.13 8.21 6 12 6m0-2C7 4 2.73 7.11 1 11.5 2.73 15.89 7 19 12 19s9.27-3.11 11-7.5C21.27 7.11 17 4 12 4zm0 5c1.38 0 2.5 1.12 2.5 2.5S13.38 14 12 14s-2.5-1.12-2.5-2.5S10.62 9 12 9m0-2c-2.48 0-4.5 2.02-4.5 4.5S9.52 16 12 16s4.5-2.02 4.5-4.5S14.48 7 12 7z"},void 0)}),void 0);function Jv(){return MRe}var DRe=P.jsx("svg",E({width:"24px",height:"24px",viewBox:"0 0 24 24"},{children:P.jsx("path",{d:"M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z"},void 0)}),void 0);function RRe(){return DRe}var kRe=dDe,ORe=xRe,hU=uRe,FRe=tRe,zc=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isExpanded:!!r.props.initialExpanded},r.headerClicked=function(){r.props.onHeaderClick?r.props.onHeaderClick():r.setState({isExpanded:!r.state.isExpanded})},r}return t.prototype.render=function(){var r=this.props.hideOffset?"msp-control-group-children":"msp-control-group-children msp-control-offset";return this.props.childrenClassName&&(r+=" "+this.props.childrenClassName),P.jsxs("div",E({className:"msp-control-group-wrapper",style:{position:"relative",marginTop:this.props.noTopMargin?0:void 0}},{children:[P.jsx("div",E({className:"msp-control-group-header",style:{marginLeft:this.props.headerLeftMargin},title:this.props.title},{children:P.jsxs(yr,E({onClick:this.headerClicked},{children:[!this.props.hideExpander&&P.jsx(cn,{svg:this.state.isExpanded?dd:cd},void 0),this.props.topRightIcon&&P.jsx(cn,{svg:this.props.topRightIcon,style:{position:"absolute",right:"2px",top:0}},void 0),P.jsx("b",{children:this.props.header},void 0)]}),void 0)}),void 0),this.state.isExpanded&&P.jsx("div",E({className:r,style:{display:this.state.isExpanded?"block":"none",maxHeight:this.props.maxHeight,overflow:"hidden",overflowY:"auto"}},{children:this.props.children}),void 0)]}),void 0)},t}(_e.Component);function pU(e){return e}var Kc=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.input=_e.createRef(),r.delayHandle=void 0,r.pendingValue=void 0,r.state={originalValue:"",value:""},r.onBlur=function(){r.setState({value:""+r.state.originalValue}),r.props.onBlur&&r.props.onBlur()},r.raiseOnChange=function(){r.pendingValue!==void 0&&(r.props.onChange(r.pendingValue),r.pendingValue=void 0)},r.onChange=function(n){var i=n.target.value,a=r.props.isValid&&!r.props.isValid(i)||r.props.numeric&&Number.isNaN(+i);if(a){r.clearTimeout(),r.setState({value:i});return}if(r.props.numeric)r.setState({value:i},function(){return r.triggerChanged(i,+i)});else{var o=(r.props.toValue||pU)(i),s=(r.props.fromValue||pU)(o);r.setState({value:s},function(){return r.triggerChanged(s,o)})}},r.onKeyUp=function(n){(n.charCode===27||n.keyCode===27||n.key==="Escape")&&r.props.blurOnEscape&&r.input.current&&r.input.current.blur()},r.onKeyPress=function(n){(n.keyCode===13||n.charCode===13||n.key==="Enter")&&(r.isPending&&(r.clearTimeout(),r.raiseOnChange()),r.props.blurOnEnter&&r.input.current&&r.input.current.blur(),r.props.onEnter&&r.props.onEnter()),n.stopPropagation()},r}return Object.defineProperty(t.prototype,"isPending",{get:function(){return typeof this.delayHandle<"u"},enumerable:!1,configurable:!0}),t.prototype.clearTimeout=function(){this.isPending&&(clearTimeout(this.delayHandle),this.delayHandle=void 0)},t.prototype.triggerChanged=function(r,n){this.clearTimeout(),r!==this.state.originalValue&&(this.props.delayMs?(this.pendingValue=n,this.delayHandle=setTimeout(this.raiseOnChange,this.props.delayMs)):this.props.onChange(n))},t.getDerivedStateFromProps=function(r,n){var i=r.fromValue?r.fromValue(r.value):r.value;return i===n.originalValue?null:{originalValue:i,value:i}},t.prototype.render=function(){return P.jsx("input",{type:"text",className:this.props.className,style:this.props.style,ref:this.input,onBlur:this.onBlur,value:this.state.value,placeholder:this.props.placeholder,onChange:this.onChange,onKeyPress:this.props.onEnter||this.props.blurOnEnter||this.props.blurOnEscape?this.onKeyPress:void 0,onKeyDown:this.props.blurOnEscape?this.onKeyUp:void 0,disabled:!!this.props.isDisabled},void 0)},t}(_e.PureComponent),LRe=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isExpanded:!1},r.toggleExpanded=function(){return r.setState({isExpanded:!r.state.isExpanded})},r}return t.prototype.render=function(){var r=this.props,n=r.label,i=r.pivot,a=r.controls;return P.jsxs(P.Fragment,{children:[P.jsx(Zs,E({label:P.jsxs(P.Fragment,{children:[n,P.jsx("button",E({className:"msp-btn-link msp-btn-icon msp-control-group-expander",onClick:this.toggleExpanded,title:(this.state.isExpanded?"Less":"More")+" options",style:{background:"transparent",textAlign:"left",padding:"0"}},{children:P.jsx(cn,{svg:this.state.isExpanded?uD:N0,style:{display:"inline-block"}},void 0)}),void 0)]},void 0),control:i},{children:this.props.colorStripe&&P.jsx("div",{className:"msp-expandable-group-color-stripe",style:{backgroundColor:at.toStyle(this.props.colorStripe)}},void 0)}),void 0),this.state.isExpanded&&P.jsx("div",E({className:"msp-control-offset"},{children:a}),void 0)]},void 0)},t}(_e.Component);function Vc(e){return P.jsxs("div",E({className:"msp-section-header"+(e.accent?" msp-transform-header-brand-"+e.accent:"")},{children:[e.icon&&P.jsx(cn,{svg:e.icon},void 0),e.title," ",P.jsx("small",{children:e.desc},void 0)]}),void 0)}function yr(e){var t="msp-btn";e.inline||(t+=" msp-btn-block"),e.noOverflow&&(t+=" msp-no-overflow"),e.flex&&(t+=" msp-flex-item"),(e.commit==="on"||e.commit)&&(t+=" msp-btn-commit msp-btn-commit-on"),e.commit==="off"&&(t+=" msp-btn-commit msp-btn-commit-off"),e.children||(t+=" msp-btn-childless"),e.className&&(t+=" "+e.className);var r=void 0;return e.flex&&(typeof e.flex=="number"?r={flex:"0 0 "+e.flex+"px",padding:0,maxWidth:e.flex+"px"}:typeof e.flex=="string"&&(r={flex:"0 0 "+e.flex,padding:0,maxWidth:e.flex})),e.style&&(r?Object.assign(r,e.style):r=e.style),P.jsxs("button",E({onClick:e.onClick,title:e.title,disabled:e.disabled,style:r,className:t,"data-id":e["data-id"],"data-color":e["data-color"],onContextMenu:e.onContextMenu,onMouseEnter:e.onMouseEnter,onMouseLeave:e.onMouseLeave},{children:[e.icon&&P.jsx(cn,{svg:e.icon},void 0),e.children]}),void 0)}function Gt(e){var t="msp-btn msp-btn-icon"+(e.small?"-small":"")+(e.className?" "+e.className:"");typeof e.toggleState<"u"&&(t+=" msp-btn-link-toggle-"+(e.toggleState?"on":"off")),e.transparent&&(t+=" msp-transparent-bg");var r=void 0;return e.flex&&(typeof e.flex=="boolean"?r={flex:"0 0 32px",padding:0}:typeof e.flex=="number"?r={flex:"0 0 "+e.flex+"px",padding:0,maxWidth:e.flex+"px"}:r={flex:"0 0 "+e.flex,padding:0,maxWidth:e.flex}),e.style&&(r?Object.assign(r,e.style):r=e.style),P.jsxs("button",E({className:t,onClick:e.onClick,title:e.title,disabled:e.disabled,"data-id":e["data-id"],style:r},{children:[e.svg&&P.jsx(cn,{svg:e.svg},void 0),e.extraContent]}),void 0)}var Fi=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.onClick=function(n){n.currentTarget.blur(),r.props.toggle()},r}return t.prototype.render=function(){var r=this.props,n=r.label,i=r.isSelected?(r.className||"")+" msp-control-current":r.className;return P.jsx(yr,E({icon:this.props.icon,onClick:this.onClick,title:this.props.title,inline:this.props.inline,disabled:r.disabled,style:r.style,className:i},{children:n&&this.props.isSelected?P.jsx("b",{children:n},void 0):n}),void 0)},t}(_e.PureComponent),qu=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isExpanded:!!r.props.initiallyExpanded},r.toggleExpanded=function(){return r.setState({isExpanded:!r.state.isExpanded})},r}return t.prototype.render=function(){return P.jsxs(P.Fragment,{children:[P.jsx("div",E({className:"msp-control-group-header",style:{marginTop:this.props.marginTop!==void 0?this.props.marginTop:"1px",marginLeft:this.props.headerLeftMargin}},{children:P.jsxs("button",E({className:"msp-btn msp-form-control msp-btn-block",onClick:this.toggleExpanded,style:this.props.headerStyle},{children:[P.jsx(cn,{svg:this.state.isExpanded?cd:dd},void 0),this.props.header]}),void 0)}),void 0),this.state.isExpanded&&(this.props.noOffset?this.props.children:P.jsx("div",E({className:this.props.accent?"msp-accent-offset":"msp-control-offset"},{children:this.props.children}),void 0))]},void 0)},t}(_e.PureComponent);function Zs(e){var t="msp-control-row";return e.className&&(t+=" "+e.className),P.jsxs("div",E({className:t},{children:[P.jsx("span",E({className:"msp-control-row-label",title:e.title},{children:e.label}),void 0),P.jsx("div",E({className:"msp-control-row-ctrl"},{children:e.control}),void 0),e.children]}),void 0)}var FE=_e.createContext(void 0),br=function(e){Le(t,e);function t(r,n){var i=e.call(this,r)||this;return i.subs=void 0,i.plugin=n,i.init&&i.init(),i}return t.prototype.subscribe=function(r,n){typeof this.subs>"u"&&(this.subs=[]),this.subs.push(r.subscribe(n))},t.prototype.componentWillUnmount=function(){if(this.subs){for(var r=0,n=this.subs;r<n.length;r++){var i=n[r];i.unsubscribe()}this.subs=void 0}},t.contextType=FE,t}(_e.Component),ea=function(e){Le(t,e);function t(r,n){var i=e.call(this,r,n)||this;return i.subs=void 0,i.plugin=n,i.init&&i.init(),i}return t.prototype.subscribe=function(r,n){typeof this.subs>"u"&&(this.subs=[]),this.subs.push(r.subscribe(n))},t.prototype.componentWillUnmount=function(){if(this.subs){for(var r=0,n=this.subs;r<n.length;r++){var i=n[r];i.unsubscribe()}this.subs=void 0}},t.contextType=FE,t}(_e.PureComponent),U0=function(e){Le(t,e);function t(r,n){var i=e.call(this,r,n)||this;i.toggleCollapsed=function(){i.setState({isCollapsed:!i.state.isCollapsed})};var a=i.defaultState();return r.initiallyCollapsed!==void 0&&(a.isCollapsed=r.initiallyCollapsed),r.header!==void 0&&(a.header=r.header),i.state=a,i}return t.prototype.componentDidUpdate=function(r){this.props.initiallyCollapsed!==void 0&&r.initiallyCollapsed!==this.props.initiallyCollapsed&&this.setState({isCollapsed:this.props.initiallyCollapsed})},t.prototype.render=function(){var r;if(this.state.isHidden)return null;var n=this.state.isCollapsed?"msp-transform-wrapper msp-transform-wrapper-collapsed":"msp-transform-wrapper";return P.jsxs("div",E({className:n},{children:[P.jsx("div",E({className:"msp-transform-header"},{children:P.jsxs(yr,E({icon:this.state.brand?void 0:this.state.isCollapsed?dd:cd,noOverflow:!0,onClick:this.toggleCollapsed,className:this.state.brand?"msp-transform-header-brand msp-transform-header-brand-"+this.state.brand.accent:void 0,title:"Click to "+(this.state.isCollapsed?"expand":"collapse")},{children:[P.jsx(cn,{svg:(r=this.state.brand)===null||r===void 0?void 0:r.svg,inline:!0},void 0),this.state.header,P.jsx("small",E({style:{margin:"0 6px"}},{children:this.state.isCollapsed?"":this.state.description}),void 0)]}),void 0)}),void 0),!this.state.isCollapsed&&this.renderControls()]}),void 0)},t}(br),Nn;(function(e){function t(){return function(i){return r(i)}}e.factory=t;function r(i){var a;return a=function(){function o(s,u){this.data=s,this.id=bn.create22(),this.type=i,this.label=u&&u.label||i.name,this.description=u&&u.description}return o.is=function(s){return!!s&&i===s.type},o}(),a.type=i,a}e.create=r;function n(i,a){if(!i.tags)return!1;for(var o=0,s=i.tags;o<s.length;o++){var u=s[o];if(u===a)return!0}return!1}e.hasTag=n,e.Null={id:bn.create22(),type:{name:"Null",typeClass:"Null"},data:void 0,label:"Null"}})(Nn||(Nn={}));var Bb;(function(e){function t(n){var i=n;return!!i&&!!i.transform&&!!i.parent&&!!i.status}e.is=t;function r(n,i){var a=typeof i=="string"?i:e.is(i)?i.transform.ref:i.ref;return n.cells.get(a)}e.resolve=r})(Bb||(Bb={}));var UZ=function(){function e(t,r){this.ref=t,this.state=r}return Object.defineProperty(e.prototype,"cell",{get:function(){var t;return(t=this.state)===null||t===void 0?void 0:t.cells.get(this.ref)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"obj",{get:function(){var t,r;return(r=(t=this.state)===null||t===void 0?void 0:t.cells.get(this.ref))===null||r===void 0?void 0:r.obj},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"data",{get:function(){var t;return(t=this.obj)===null||t===void 0?void 0:t.data},enumerable:!1,configurable:!0}),e.prototype.update=function(t,r){if(!this.state)throw new Error("To use update() from StateObjectSelector, 'state' must be defined.");return r||(r=this.state.build()),(r||this.state.build()).to(this).update(t),r},e.prototype.checkValid=function(){if(!this.state)throw new Error("Unassigned State.");var t=this.cell;if(!t)throw new Error("Not created at all. Did you await/then the corresponding state update?");if(t.status==="ok")return!0;throw t.status==="error"?new Error(t.errorText):t.obj===Nn.Null?new Error("The object is Null."):new Error("Unresolved. Did you await/then the corresponding state update?")},Object.defineProperty(e.prototype,"isOk",{get:function(){var t=this.cell;return t&&t.status==="ok"&&t.obj!==Nn.Null},enumerable:!1,configurable:!0}),e}(),ji;(function(e){function t(i){var a;if(i)return typeof i=="string"?i:Bb.is(i)?i.transform.ref:(a=i.cell)===null||a===void 0?void 0:a.transform.ref}e.resolveRef=t;function r(i,a){if(a)return Bb.is(a)?a:typeof a=="string"?i.cells.get(a):a.cell}e.resolve=r;function n(i,a){var o=r(i,a);if(!(!o||!o.obj||o.status!=="ok"))return o}e.resolveAndCheck=n})(ji||(ji={}));var jZ={exports:{}};(function(e,t){(function(r,n){e.exports=n()})(Dp,function(){var r=Array.prototype.slice;function n(T,N){N&&(T.prototype=Object.create(N.prototype)),T.prototype.constructor=T}function i(T){return u(T)?T:be(T)}n(a,i);function a(T){return l(T)?T:Ae(T)}n(o,i);function o(T){return c(T)?T:Se(T)}n(s,i);function s(T){return u(T)&&!d(T)?T:ie(T)}function u(T){return!!(T&&T[h])}function l(T){return!!(T&&T[v])}function c(T){return!!(T&&T[p])}function d(T){return l(T)||c(T)}function f(T){return!!(T&&T[m])}i.isIterable=u,i.isKeyed=l,i.isIndexed=c,i.isAssociative=d,i.isOrdered=f,i.Keyed=a,i.Indexed=o,i.Set=s;var h="@@__IMMUTABLE_ITERABLE__@@",v="@@__IMMUTABLE_KEYED__@@",p="@@__IMMUTABLE_INDEXED__@@",m="@@__IMMUTABLE_ORDERED__@@",g="delete",y=5,b=1<<y,S=b-1,x={},C={value:!1},w={value:!1};function A(T){return T.value=!1,T}function M(T){T&&(T.value=!0)}function D(){}function k(T,N){N=N||0;for(var Q=Math.max(0,T.length-N),re=new Array(Q),ae=0;ae<Q;ae++)re[ae]=T[ae+N];return re}function R(T){return T.size===void 0&&(T.size=T.__iterate(H)),T.size}function O(T,N){if(typeof N!="number"){var Q=N>>>0;if(""+Q!==N||Q===4294967295)return NaN;N=Q}return N<0?R(T)+N:N}function H(){return!0}function B(T,N,Q){return(T===0||Q!==void 0&&T<=-Q)&&(N===void 0||Q!==void 0&&N>=Q)}function j(T,N){return G(T,N,0)}function Y(T,N){return G(T,N,N)}function G(T,N,Q){return T===void 0?Q:T<0?Math.max(0,N+T):N===void 0?T:Math.min(N,T)}var $=0,q=1,ee=2,fe=typeof Symbol=="function"&&Symbol.iterator,W="@@iterator",X=fe||W;function U(T){this.next=T}U.prototype.toString=function(){return"[Iterator]"},U.KEYS=$,U.VALUES=q,U.ENTRIES=ee,U.prototype.inspect=U.prototype.toSource=function(){return this.toString()},U.prototype[X]=function(){return this};function z(T,N,Q,re){var ae=T===0?N:T===1?Q:[N,Q];return re?re.value=ae:re={value:ae,done:!1},re}function J(){return{value:void 0,done:!0}}function K(T){return!!le(T)}function Z(T){return T&&typeof T.next=="function"}function te(T){var N=le(T);return N&&N.call(T)}function le(T){var N=T&&(fe&&T[fe]||T[W]);if(typeof N=="function")return N}function ye(T){return T&&typeof T.length=="number"}n(be,i);function be(T){return T==null?Ve():u(T)?T.toSeq():Ne(T)}be.of=function(){return be(arguments)},be.prototype.toSeq=function(){return this},be.prototype.toString=function(){return this.__toString("Seq {","}")},be.prototype.cacheResult=function(){return!this._cache&&this.__iterateUncached&&(this._cache=this.entrySeq().toArray(),this.size=this._cache.length),this},be.prototype.__iterate=function(T,N){return it(this,T,N,!0)},be.prototype.__iterator=function(T,N){return ot(this,T,N,!0)},n(Ae,be);function Ae(T){return T==null?Ve().toKeyedSeq():u(T)?l(T)?T.toSeq():T.fromEntrySeq():Xe(T)}Ae.prototype.toKeyedSeq=function(){return this},n(Se,be);function Se(T){return T==null?Ve():u(T)?l(T)?T.entrySeq():T.toIndexedSeq():ct(T)}Se.of=function(){return Se(arguments)},Se.prototype.toIndexedSeq=function(){return this},Se.prototype.toString=function(){return this.__toString("Seq [","]")},Se.prototype.__iterate=function(T,N){return it(this,T,N,!1)},Se.prototype.__iterator=function(T,N){return ot(this,T,N,!1)},n(ie,be);function ie(T){return(T==null?Ve():u(T)?l(T)?T.entrySeq():T:ct(T)).toSetSeq()}ie.of=function(){return ie(arguments)},ie.prototype.toSetSeq=function(){return this},be.isSeq=Te,be.Keyed=Ae,be.Set=ie,be.Indexed=Se;var oe="@@__IMMUTABLE_SEQ__@@";be.prototype[oe]=!0,n(F,Se);function F(T){this._array=T,this.size=T.length}F.prototype.get=function(T,N){return this.has(T)?this._array[O(this,T)]:N},F.prototype.__iterate=function(T,N){for(var Q=this._array,re=Q.length-1,ae=0;ae<=re;ae++)if(T(Q[N?re-ae:ae],ae,this)===!1)return ae+1;return ae},F.prototype.__iterator=function(T,N){var Q=this._array,re=Q.length-1,ae=0;return new U(function(){return ae>re?J():z(T,ae,Q[N?re-ae++:ae++])})},n(V,Ae);function V(T){var N=Object.keys(T);this._object=T,this._keys=N,this.size=N.length}V.prototype.get=function(T,N){return N!==void 0&&!this.has(T)?N:this._object[T]},V.prototype.has=function(T){return this._object.hasOwnProperty(T)},V.prototype.__iterate=function(T,N){for(var Q=this._object,re=this._keys,ae=re.length-1,xe=0;xe<=ae;xe++){var Pe=re[N?ae-xe:xe];if(T(Q[Pe],Pe,this)===!1)return xe+1}return xe},V.prototype.__iterator=function(T,N){var Q=this._object,re=this._keys,ae=re.length-1,xe=0;return new U(function(){var Pe=re[N?ae-xe:xe];return xe++>ae?J():z(T,Pe,Q[Pe])})},V.prototype[m]=!0,n(pe,Se);function pe(T){this._iterable=T,this.size=T.length||T.size}pe.prototype.__iterateUncached=function(T,N){if(N)return this.cacheResult().__iterate(T,N);var Q=this._iterable,re=te(Q),ae=0;if(Z(re))for(var xe;!(xe=re.next()).done&&T(xe.value,ae++,this)!==!1;);return ae},pe.prototype.__iteratorUncached=function(T,N){if(N)return this.cacheResult().__iterator(T,N);var Q=this._iterable,re=te(Q);if(!Z(re))return new U(J);var ae=0;return new U(function(){var xe=re.next();return xe.done?xe:z(T,ae++,xe.value)})},n(we,Se);function we(T){this._iterator=T,this._iteratorCache=[]}we.prototype.__iterateUncached=function(T,N){if(N)return this.cacheResult().__iterate(T,N);for(var Q=this._iterator,re=this._iteratorCache,ae=0;ae<re.length;)if(T(re[ae],ae++,this)===!1)return ae;for(var xe;!(xe=Q.next()).done;){var Pe=xe.value;if(re[ae]=Pe,T(Pe,ae++,this)===!1)break}return ae},we.prototype.__iteratorUncached=function(T,N){if(N)return this.cacheResult().__iterator(T,N);var Q=this._iterator,re=this._iteratorCache,ae=0;return new U(function(){if(ae>=re.length){var xe=Q.next();if(xe.done)return xe;re[ae]=xe.value}return z(T,ae,re[ae++])})};function Te(T){return!!(T&&T[oe])}var ze;function Ve(){return ze||(ze=new F([]))}function Xe(T){var N=Array.isArray(T)?new F(T).fromEntrySeq():Z(T)?new we(T).fromEntrySeq():K(T)?new pe(T).fromEntrySeq():typeof T=="object"?new V(T):void 0;if(!N)throw new TypeError("Expected Array or iterable object of [k, v] entries, or keyed object: "+T);return N}function ct(T){var N=Qe(T);if(!N)throw new TypeError("Expected Array or iterable object of values: "+T);return N}function Ne(T){var N=Qe(T)||typeof T=="object"&&new V(T);if(!N)throw new TypeError("Expected Array or iterable object of values, or keyed object: "+T);return N}function Qe(T){return ye(T)?new F(T):Z(T)?new we(T):K(T)?new pe(T):void 0}function it(T,N,Q,re){var ae=T._cache;if(ae){for(var xe=ae.length-1,Pe=0;Pe<=xe;Pe++){var Ue=ae[Q?xe-Pe:Pe];if(N(Ue[1],re?Ue[0]:Pe,T)===!1)return Pe+1}return Pe}return T.__iterateUncached(N,Q)}function ot(T,N,Q,re){var ae=T._cache;if(ae){var xe=ae.length-1,Pe=0;return new U(function(){var Ue=ae[Q?xe-Pe:Pe];return Pe++>xe?J():z(N,re?Ue[0]:Pe-1,Ue[1])})}return T.__iteratorUncached(N,Q)}function dt(T,N){return N?ke(N,T,"",{"":T}):Me(T)}function ke(T,N,Q,re){return Array.isArray(N)?T.call(re,Q,Se(N).map(function(ae,xe){return ke(T,ae,xe,N)})):Ye(N)?T.call(re,Q,Ae(N).map(function(ae,xe){return ke(T,ae,xe,N)})):N}function Me(T){return Array.isArray(T)?Se(T).map(Me).toList():Ye(T)?Ae(T).map(Me).toMap():T}function Ye(T){return T&&(T.constructor===Object||T.constructor===void 0)}function tt(T,N){if(T===N||T!==T&&N!==N)return!0;if(!T||!N)return!1;if(typeof T.valueOf=="function"&&typeof N.valueOf=="function"){if(T=T.valueOf(),N=N.valueOf(),T===N||T!==T&&N!==N)return!0;if(!T||!N)return!1}return!!(typeof T.equals=="function"&&typeof N.equals=="function"&&T.equals(N))}function xt(T,N){if(T===N)return!0;if(!u(N)||T.size!==void 0&&N.size!==void 0&&T.size!==N.size||T.__hash!==void 0&&N.__hash!==void 0&&T.__hash!==N.__hash||l(T)!==l(N)||c(T)!==c(N)||f(T)!==f(N))return!1;if(T.size===0&&N.size===0)return!0;var Q=!d(T);if(f(T)){var re=T.entries();return N.every(function(et,st){var yt=re.next().value;return yt&&tt(yt[1],et)&&(Q||tt(yt[0],st))})&&re.next().done}var ae=!1;if(T.size===void 0)if(N.size===void 0)typeof T.cacheResult=="function"&&T.cacheResult();else{ae=!0;var xe=T;T=N,N=xe}var Pe=!0,Ue=N.__iterate(function(et,st){if(Q?!T.has(et):ae?!tt(et,T.get(st,x)):!tt(T.get(st,x),et))return Pe=!1,!1});return Pe&&T.size===Ue}n(pt,Se);function pt(T,N){if(!(this instanceof pt))return new pt(T,N);if(this._value=T,this.size=N===void 0?1/0:Math.max(0,N),this.size===0){if(ut)return ut;ut=this}}pt.prototype.toString=function(){return this.size===0?"Repeat []":"Repeat [ "+this._value+" "+this.size+" times ]"},pt.prototype.get=function(T,N){return this.has(T)?this._value:N},pt.prototype.includes=function(T){return tt(this._value,T)},pt.prototype.slice=function(T,N){var Q=this.size;return B(T,N,Q)?this:new pt(this._value,Y(N,Q)-j(T,Q))},pt.prototype.reverse=function(){return this},pt.prototype.indexOf=function(T){return tt(this._value,T)?0:-1},pt.prototype.lastIndexOf=function(T){return tt(this._value,T)?this.size:-1},pt.prototype.__iterate=function(T,N){for(var Q=0;Q<this.size;Q++)if(T(this._value,Q,this)===!1)return Q+1;return Q},pt.prototype.__iterator=function(T,N){var Q=this,re=0;return new U(function(){return re<Q.size?z(T,re++,Q._value):J()})},pt.prototype.equals=function(T){return T instanceof pt?tt(this._value,T._value):xt(T)};var ut;function he(T,N){if(!T)throw new Error(N)}n(me,Se);function me(T,N,Q){if(!(this instanceof me))return new me(T,N,Q);if(he(Q!==0,"Cannot step a Range by 0"),T=T||0,N===void 0&&(N=1/0),Q=Q===void 0?1:Math.abs(Q),N<T&&(Q=-Q),this._start=T,this._end=N,this._step=Q,this.size=Math.max(0,Math.ceil((N-T)/Q-1)+1),this.size===0){if(Ee)return Ee;Ee=this}}me.prototype.toString=function(){return this.size===0?"Range []":"Range [ "+this._start+"..."+this._end+(this._step!==1?" by "+this._step:"")+" ]"},me.prototype.get=function(T,N){return this.has(T)?this._start+O(this,T)*this._step:N},me.prototype.includes=function(T){var N=(T-this._start)/this._step;return N>=0&&N<this.size&&N===Math.floor(N)},me.prototype.slice=function(T,N){return B(T,N,this.size)?this:(T=j(T,this.size),N=Y(N,this.size),N<=T?new me(0,0):new me(this.get(T,this._end),this.get(N,this._end),this._step))},me.prototype.indexOf=function(T){var N=T-this._start;if(N%this._step===0){var Q=N/this._step;if(Q>=0&&Q<this.size)return Q}return-1},me.prototype.lastIndexOf=function(T){return this.indexOf(T)},me.prototype.__iterate=function(T,N){for(var Q=this.size-1,re=this._step,ae=N?this._start+Q*re:this._start,xe=0;xe<=Q;xe++){if(T(ae,xe,this)===!1)return xe+1;ae+=N?-re:re}return xe},me.prototype.__iterator=function(T,N){var Q=this.size-1,re=this._step,ae=N?this._start+Q*re:this._start,xe=0;return new U(function(){var Pe=ae;return ae+=N?-re:re,xe>Q?J():z(T,xe++,Pe)})},me.prototype.equals=function(T){return T instanceof me?this._start===T._start&&this._end===T._end&&this._step===T._step:xt(this,T)};var Ee;n(Ke,i);function Ke(){throw TypeError("Abstract")}n(gt,Ke);function gt(){}n(Pt,Ke);function Pt(){}n(Yt,Ke);function Yt(){}Ke.Keyed=gt,Ke.Indexed=Pt,Ke.Set=Yt;var dr=typeof Math.imul=="function"&&Math.imul(4294967295,2)===-2?Math.imul:function(N,Q){N=N|0,Q=Q|0;var re=N&65535,ae=Q&65535;return re*ae+((N>>>16)*ae+re*(Q>>>16)<<16>>>0)|0};function Dr(T){return T>>>1&1073741824|T&3221225471}function Qt(T){if(T===!1||T===null||T===void 0||typeof T.valueOf=="function"&&(T=T.valueOf(),T===!1||T===null||T===void 0))return 0;if(T===!0)return 1;var N=typeof T;if(N==="number"){if(T!==T||T===1/0)return 0;var Q=T|0;for(Q!==T&&(Q^=T*4294967295);T>4294967295;)T/=4294967295,Q^=T;return Dr(Q)}if(N==="string")return T.length>Kd?ui(T):na(T);if(typeof T.hashCode=="function")return T.hashCode();if(N==="object")return ia(T);if(typeof T.toString=="function")return na(T.toString());throw new Error("Value type "+N+" cannot be hashed.")}function ui(T){var N=Qh[T];return N===void 0&&(N=na(T),Kh===X2&&(Kh=0,Qh={}),Kh++,Qh[T]=N),N}function na(T){for(var N=0,Q=0;Q<T.length;Q++)N=31*N+T.charCodeAt(Q)|0;return Dr(N)}function ia(T){var N;if(su&&(N=Xh.get(T),N!==void 0)||(N=T[po],N!==void 0)||!Ju&&(N=T.propertyIsEnumerable&&T.propertyIsEnumerable[po],N!==void 0||(N=uc(T),N!==void 0)))return N;if(N=++Yh,Yh&1073741824&&(Yh=0),su)Xh.set(T,N);else{if(Uo!==void 0&&Uo(T)===!1)throw new Error("Non-extensible objects are not allowed as keys.");if(Ju)Object.defineProperty(T,po,{enumerable:!1,configurable:!1,writable:!1,value:N});else if(T.propertyIsEnumerable!==void 0&&T.propertyIsEnumerable===T.constructor.prototype.propertyIsEnumerable)T.propertyIsEnumerable=function(){return this.constructor.prototype.propertyIsEnumerable.apply(this,arguments)},T.propertyIsEnumerable[po]=N;else if(T.nodeType!==void 0)T[po]=N;else throw new Error("Unable to set a non-enumerable property on object.")}return N}var Uo=Object.isExtensible,Ju=function(){try{return Object.defineProperty({},"@",{}),!0}catch{return!1}}();function uc(T){if(T&&T.nodeType>0)switch(T.nodeType){case 1:return T.uniqueID;case 9:return T.documentElement&&T.documentElement.uniqueID}}var su=typeof WeakMap=="function",Xh;su&&(Xh=new WeakMap);var Yh=0,po="__immutablehash__";typeof Symbol=="function"&&(po=Symbol(po));var Kd=16,X2=255,Kh=0,Qh={};function Qa(T){he(T!==1/0,"Cannot perform this action with an infinite size.")}n(rn,gt);function rn(T){return T==null?uu():jA(T)&&!f(T)?T:uu().withMutations(function(N){var Q=a(T);Qa(Q.size),Q.forEach(function(re,ae){return N.set(ae,re)})})}rn.of=function(){var T=r.call(arguments,0);return uu().withMutations(function(N){for(var Q=0;Q<T.length;Q+=2){if(Q+1>=T.length)throw new Error("Missing value for key: "+T[Q]);N.set(T[Q],T[Q+1])}})},rn.prototype.toString=function(){return this.__toString("Map {","}")},rn.prototype.get=function(T,N){return this._root?this._root.get(0,void 0,T,N):N},rn.prototype.set=function(T,N){return UL(this,T,N)},rn.prototype.setIn=function(T,N){return this.updateIn(T,x,function(){return N})},rn.prototype.remove=function(T){return UL(this,T,x)},rn.prototype.deleteIn=function(T){return this.updateIn(T,function(){return x})},rn.prototype.update=function(T,N,Q){return arguments.length===1?T(this):this.updateIn([T],N,Q)},rn.prototype.updateIn=function(T,N,Q){Q||(Q=N,N=void 0);var re=GL(this,dN(T),N,Q);return re===x?void 0:re},rn.prototype.clear=function(){return this.size===0?this:this.__ownerID?(this.size=0,this._root=null,this.__hash=void 0,this.__altered=!0,this):uu()},rn.prototype.merge=function(){return Y2(this,void 0,arguments)},rn.prototype.mergeWith=function(T){var N=r.call(arguments,1);return Y2(this,T,N)},rn.prototype.mergeIn=function(T){var N=r.call(arguments,1);return this.updateIn(T,uu(),function(Q){return typeof Q.merge=="function"?Q.merge.apply(Q,N):N[N.length-1]})},rn.prototype.mergeDeep=function(){return Y2(this,zL,arguments)},rn.prototype.mergeDeepWith=function(T){var N=r.call(arguments,1);return Y2(this,VL(T),N)},rn.prototype.mergeDeepIn=function(T){var N=r.call(arguments,1);return this.updateIn(T,uu(),function(Q){return typeof Q.mergeDeep=="function"?Q.mergeDeep.apply(Q,N):N[N.length-1]})},rn.prototype.sort=function(T){return Ei(Sm(this,T))},rn.prototype.sortBy=function(T,N){return Ei(Sm(this,N,T))},rn.prototype.withMutations=function(T){var N=this.asMutable();return T(N),N.wasAltered()?N.__ensureOwner(this.__ownerID):this},rn.prototype.asMutable=function(){return this.__ownerID?this:this.__ensureOwner(new D)},rn.prototype.asImmutable=function(){return this.__ensureOwner()},rn.prototype.wasAltered=function(){return this.__altered},rn.prototype.__iterator=function(T,N){return new zA(this,T,N)},rn.prototype.__iterate=function(T,N){var Q=this,re=0;return this._root&&this._root.iterate(function(ae){return re++,T(ae[1],ae[0],Q)},N),re},rn.prototype.__ensureOwner=function(T){return T===this.__ownerID?this:T?HA(this.size,this._root,T,this.__hash):(this.__ownerID=T,this.__altered=!1,this)};function jA(T){return!!(T&&T[LL])}rn.isMap=jA;var LL="@@__IMMUTABLE_MAP__@@",Yr=rn.prototype;Yr[LL]=!0,Yr[g]=Yr.remove,Yr.removeIn=Yr.deleteIn;function ry(T,N){this.ownerID=T,this.entries=N}ry.prototype.get=function(T,N,Q,re){for(var ae=this.entries,xe=0,Pe=ae.length;xe<Pe;xe++)if(tt(Q,ae[xe][0]))return ae[xe][1];return re},ry.prototype.update=function(T,N,Q,re,ae,xe,Pe){for(var Ue=ae===x,et=this.entries,st=0,yt=et.length;st<yt&&!tt(re,et[st][0]);st++);var Ft=st<yt;if(Ft?et[st][1]===ae:Ue)return this;if(M(Pe),(Ue||!Ft)&&M(xe),!(Ue&&et.length===1)){if(!Ft&&!Ue&&et.length>=bse)return pse(T,et,re,ae);var qt=T&&T===this.ownerID,Ar=qt?et:k(et);return Ft?Ue?st===yt-1?Ar.pop():Ar[st]=Ar.pop():Ar[st]=[re,ae]:Ar.push([re,ae]),qt?(this.entries=Ar,this):new ry(T,Ar)}};function vm(T,N,Q){this.ownerID=T,this.bitmap=N,this.nodes=Q}vm.prototype.get=function(T,N,Q,re){N===void 0&&(N=Qt(Q));var ae=1<<((T===0?N:N>>>T)&S),xe=this.bitmap;return xe&ae?this.nodes[qL(xe&ae-1)].get(T+y,N,Q,re):re},vm.prototype.update=function(T,N,Q,re,ae,xe,Pe){Q===void 0&&(Q=Qt(re));var Ue=(N===0?Q:Q>>>N)&S,et=1<<Ue,st=this.bitmap,yt=(st&et)!==0;if(!yt&&ae===x)return this;var Ft=qL(st&et-1),qt=this.nodes,Ar=yt?qt[Ft]:void 0,Wr=GA(Ar,T,N+y,Q,re,ae,xe,Pe);if(Wr===Ar)return this;if(!yt&&Wr&&qt.length>=xse)return mse(T,qt,st,Ue,Wr);if(yt&&!Wr&&qt.length===2&&jL(qt[Ft^1]))return qt[Ft^1];if(yt&&Wr&&qt.length===1&&jL(Wr))return Wr;var Jn=T&&T===this.ownerID,lu=yt?Wr?st:st^et:st|et,nl=yt?Wr?$L(qt,Ft,Wr,Jn):yse(qt,Ft,Jn):gse(qt,Ft,Wr,Jn);return Jn?(this.bitmap=lu,this.nodes=nl,this):new vm(T,lu,nl)};function ny(T,N,Q){this.ownerID=T,this.count=N,this.nodes=Q}ny.prototype.get=function(T,N,Q,re){N===void 0&&(N=Qt(Q));var ae=(T===0?N:N>>>T)&S,xe=this.nodes[ae];return xe?xe.get(T+y,N,Q,re):re},ny.prototype.update=function(T,N,Q,re,ae,xe,Pe){Q===void 0&&(Q=Qt(re));var Ue=(N===0?Q:Q>>>N)&S,et=ae===x,st=this.nodes,yt=st[Ue];if(et&&!yt)return this;var Ft=GA(yt,T,N+y,Q,re,ae,xe,Pe);if(Ft===yt)return this;var qt=this.count;if(!yt)qt++;else if(!Ft&&(qt--,qt<Sse))return vse(T,st,qt,Ue);var Ar=T&&T===this.ownerID,Wr=$L(st,Ue,Ft,Ar);return Ar?(this.count=qt,this.nodes=Wr,this):new ny(T,qt,Wr)};function mm(T,N,Q){this.ownerID=T,this.keyHash=N,this.entries=Q}mm.prototype.get=function(T,N,Q,re){for(var ae=this.entries,xe=0,Pe=ae.length;xe<Pe;xe++)if(tt(Q,ae[xe][0]))return ae[xe][1];return re},mm.prototype.update=function(T,N,Q,re,ae,xe,Pe){Q===void 0&&(Q=Qt(re));var Ue=ae===x;if(Q!==this.keyHash)return Ue?this:(M(Pe),M(xe),qA(this,T,N,Q,[re,ae]));for(var et=this.entries,st=0,yt=et.length;st<yt&&!tt(re,et[st][0]);st++);var Ft=st<yt;if(Ft?et[st][1]===ae:Ue)return this;if(M(Pe),(Ue||!Ft)&&M(xe),Ue&&yt===2)return new lc(T,this.keyHash,et[st^1]);var qt=T&&T===this.ownerID,Ar=qt?et:k(et);return Ft?Ue?st===yt-1?Ar.pop():Ar[st]=Ar.pop():Ar[st]=[re,ae]:Ar.push([re,ae]),qt?(this.entries=Ar,this):new mm(T,this.keyHash,Ar)};function lc(T,N,Q){this.ownerID=T,this.keyHash=N,this.entry=Q}lc.prototype.get=function(T,N,Q,re){return tt(Q,this.entry[0])?this.entry[1]:re},lc.prototype.update=function(T,N,Q,re,ae,xe,Pe){var Ue=ae===x,et=tt(re,this.entry[0]);if(et?ae===this.entry[1]:Ue)return this;if(M(Pe),Ue){M(xe);return}return et?T&&T===this.ownerID?(this.entry[1]=ae,this):new lc(T,this.keyHash,[re,ae]):(M(xe),qA(this,T,N,Qt(re),[re,ae]))},ry.prototype.iterate=mm.prototype.iterate=function(T,N){for(var Q=this.entries,re=0,ae=Q.length-1;re<=ae;re++)if(T(Q[N?ae-re:re])===!1)return!1},vm.prototype.iterate=ny.prototype.iterate=function(T,N){for(var Q=this.nodes,re=0,ae=Q.length-1;re<=ae;re++){var xe=Q[N?ae-re:re];if(xe&&xe.iterate(T,N)===!1)return!1}},lc.prototype.iterate=function(T,N){return T(this.entry)},n(zA,U);function zA(T,N,Q){this._type=N,this._reverse=Q,this._stack=T._root&&NL(T._root)}zA.prototype.next=function(){for(var T=this._type,N=this._stack;N;){var Q=N.node,re=N.index++,ae;if(Q.entry){if(re===0)return VA(T,Q.entry)}else if(Q.entries){if(ae=Q.entries.length-1,re<=ae)return VA(T,Q.entries[this._reverse?ae-re:re])}else if(ae=Q.nodes.length-1,re<=ae){var xe=Q.nodes[this._reverse?ae-re:re];if(xe){if(xe.entry)return VA(T,xe.entry);N=this._stack=NL(xe,N)}continue}N=this._stack=this._stack.__prev}return J()};function VA(T,N){return z(T,N[0],N[1])}function NL(T,N){return{node:T,index:0,__prev:N}}function HA(T,N,Q,re){var ae=Object.create(Yr);return ae.size=T,ae._root=N,ae.__ownerID=Q,ae.__hash=re,ae.__altered=!1,ae}var BL;function uu(){return BL||(BL=HA(0))}function UL(T,N,Q){var re,ae;if(T._root){var xe=A(C),Pe=A(w);if(re=GA(T._root,T.__ownerID,0,void 0,N,Q,xe,Pe),!Pe.value)return T;ae=T.size+(xe.value?Q===x?-1:1:0)}else{if(Q===x)return T;ae=1,re=new ry(T.__ownerID,[[N,Q]])}return T.__ownerID?(T.size=ae,T._root=re,T.__hash=void 0,T.__altered=!0,T):re?HA(ae,re):uu()}function GA(T,N,Q,re,ae,xe,Pe,Ue){return T?T.update(N,Q,re,ae,xe,Pe,Ue):xe===x?T:(M(Ue),M(Pe),new lc(N,re,[ae,xe]))}function jL(T){return T.constructor===lc||T.constructor===mm}function qA(T,N,Q,re,ae){if(T.keyHash===re)return new mm(N,re,[T.entry,ae]);var xe=(Q===0?T.keyHash:T.keyHash>>>Q)&S,Pe=(Q===0?re:re>>>Q)&S,Ue,et=xe===Pe?[qA(T,N,Q+y,re,ae)]:(Ue=new lc(N,re,ae),xe<Pe?[T,Ue]:[Ue,T]);return new vm(N,1<<xe|1<<Pe,et)}function pse(T,N,Q,re){T||(T=new D);for(var ae=new lc(T,Qt(Q),[Q,re]),xe=0;xe<N.length;xe++){var Pe=N[xe];ae=ae.update(T,0,void 0,Pe[0],Pe[1])}return ae}function vse(T,N,Q,re){for(var ae=0,xe=0,Pe=new Array(Q),Ue=0,et=1,st=N.length;Ue<st;Ue++,et<<=1){var yt=N[Ue];yt!==void 0&&Ue!==re&&(ae|=et,Pe[xe++]=yt)}return new vm(T,ae,Pe)}function mse(T,N,Q,re,ae){for(var xe=0,Pe=new Array(b),Ue=0;Q!==0;Ue++,Q>>>=1)Pe[Ue]=Q&1?N[xe++]:void 0;return Pe[re]=ae,new ny(T,xe+1,Pe)}function Y2(T,N,Q){for(var re=[],ae=0;ae<Q.length;ae++){var xe=Q[ae],Pe=a(xe);u(xe)||(Pe=Pe.map(function(Ue){return dt(Ue)})),re.push(Pe)}return HL(T,N,re)}function zL(T,N,Q){return T&&T.mergeDeep&&u(N)?T.mergeDeep(N):tt(T,N)?T:N}function VL(T){return function(N,Q,re){if(N&&N.mergeDeepWith&&u(Q))return N.mergeDeepWith(T,Q);var ae=T(N,Q,re);return tt(N,ae)?N:ae}}function HL(T,N,Q){return Q=Q.filter(function(re){return re.size!==0}),Q.length===0?T:T.size===0&&!T.__ownerID&&Q.length===1?T.constructor(Q[0]):T.withMutations(function(re){for(var ae=N?function(Pe,Ue){re.update(Ue,x,function(et){return et===x?Pe:N(et,Pe,Ue)})}:function(Pe,Ue){re.set(Ue,Pe)},xe=0;xe<Q.length;xe++)Q[xe].forEach(ae)})}function GL(T,N,Q,re){var ae=T===x,xe=N.next();if(xe.done){var Pe=ae?Q:T,Ue=re(Pe);return Ue===Pe?T:Ue}he(ae||T&&T.set,"invalid keyPath");var et=xe.value,st=ae?x:T.get(et,x),yt=GL(st,N,Q,re);return yt===st?T:yt===x?T.remove(et):(ae?uu():T).set(et,yt)}function qL(T){return T=T-(T>>1&1431655765),T=(T&858993459)+(T>>2&858993459),T=T+(T>>4)&252645135,T=T+(T>>8),T=T+(T>>16),T&127}function $L(T,N,Q,re){var ae=re?T:k(T);return ae[N]=Q,ae}function gse(T,N,Q,re){var ae=T.length+1;if(re&&N+1===ae)return T[N]=Q,T;for(var xe=new Array(ae),Pe=0,Ue=0;Ue<ae;Ue++)Ue===N?(xe[Ue]=Q,Pe=-1):xe[Ue]=T[Ue+Pe];return xe}function yse(T,N,Q){var re=T.length-1;if(Q&&N===re)return T.pop(),T;for(var ae=new Array(re),xe=0,Pe=0;Pe<re;Pe++)Pe===N&&(xe=1),ae[Pe]=T[Pe+xe];return ae}var bse=b/4,xse=b/2,Sse=b/4;n(Hn,Pt);function Hn(T){var N=$A();if(T==null)return N;if(WL(T))return T;var Q=o(T),re=Q.size;return re===0?N:(Qa(re),re>0&&re<b?ay(0,re,y,null,new Qd(Q.toArray())):N.withMutations(function(ae){ae.setSize(re),Q.forEach(function(xe,Pe){return ae.set(Pe,xe)})}))}Hn.of=function(){return this(arguments)},Hn.prototype.toString=function(){return this.__toString("List [","]")},Hn.prototype.get=function(T,N){if(T=O(this,T),T>=0&&T<this.size){T+=this._origin;var Q=QL(this,T);return Q&&Q.array[T&S]}return N},Hn.prototype.set=function(T,N){return Cse(this,T,N)},Hn.prototype.remove=function(T){return this.has(T)?T===0?this.shift():T===this.size-1?this.pop():this.splice(T,1):this},Hn.prototype.insert=function(T,N){return this.splice(T,0,N)},Hn.prototype.clear=function(){return this.size===0?this:this.__ownerID?(this.size=this._origin=this._capacity=0,this._level=y,this._root=this._tail=null,this.__hash=void 0,this.__altered=!0,this):$A()},Hn.prototype.push=function(){var T=arguments,N=this.size;return this.withMutations(function(Q){Zd(Q,0,N+T.length);for(var re=0;re<T.length;re++)Q.set(N+re,T[re])})},Hn.prototype.pop=function(){return Zd(this,0,-1)},Hn.prototype.unshift=function(){var T=arguments;return this.withMutations(function(N){Zd(N,-T.length);for(var Q=0;Q<T.length;Q++)N.set(Q,T[Q])})},Hn.prototype.shift=function(){return Zd(this,1)},Hn.prototype.merge=function(){return K2(this,void 0,arguments)},Hn.prototype.mergeWith=function(T){var N=r.call(arguments,1);return K2(this,T,N)},Hn.prototype.mergeDeep=function(){return K2(this,zL,arguments)},Hn.prototype.mergeDeepWith=function(T){var N=r.call(arguments,1);return K2(this,VL(T),N)},Hn.prototype.setSize=function(T){return Zd(this,0,T)},Hn.prototype.slice=function(T,N){var Q=this.size;return B(T,N,Q)?this:Zd(this,j(T,Q),Y(N,Q))},Hn.prototype.__iterator=function(T,N){var Q=0,re=YL(this,N);return new U(function(){var ae=re();return ae===iy?J():z(T,Q++,ae)})},Hn.prototype.__iterate=function(T,N){for(var Q=0,re=YL(this,N),ae;(ae=re())!==iy&&T(ae,Q++,this)!==!1;);return Q},Hn.prototype.__ensureOwner=function(T){return T===this.__ownerID?this:T?ay(this._origin,this._capacity,this._level,this._root,this._tail,T,this.__hash):(this.__ownerID=T,this)};function WL(T){return!!(T&&T[XL])}Hn.isList=WL;var XL="@@__IMMUTABLE_LIST__@@",Za=Hn.prototype;Za[XL]=!0,Za[g]=Za.remove,Za.setIn=Yr.setIn,Za.deleteIn=Za.removeIn=Yr.removeIn,Za.update=Yr.update,Za.updateIn=Yr.updateIn,Za.mergeIn=Yr.mergeIn,Za.mergeDeepIn=Yr.mergeDeepIn,Za.withMutations=Yr.withMutations,Za.asMutable=Yr.asMutable,Za.asImmutable=Yr.asImmutable,Za.wasAltered=Yr.wasAltered;function Qd(T,N){this.array=T,this.ownerID=N}Qd.prototype.removeBefore=function(T,N,Q){if(Q===N?1<<N:this.array.length===0)return this;var re=Q>>>N&S;if(re>=this.array.length)return new Qd([],T);var ae=re===0,xe;if(N>0){var Pe=this.array[re];if(xe=Pe&&Pe.removeBefore(T,N-y,Q),xe===Pe&&ae)return this}if(ae&&!xe)return this;var Ue=gm(this,T);if(!ae)for(var et=0;et<re;et++)Ue.array[et]=void 0;return xe&&(Ue.array[re]=xe),Ue},Qd.prototype.removeAfter=function(T,N,Q){if(Q===(N?1<<N:0)||this.array.length===0)return this;var re=Q-1>>>N&S;if(re>=this.array.length)return this;var ae;if(N>0){var xe=this.array[re];if(ae=xe&&xe.removeAfter(T,N-y,Q),ae===xe&&re===this.array.length-1)return this}var Pe=gm(this,T);return Pe.array.splice(re+1),ae&&(Pe.array[re]=ae),Pe};var iy={};function YL(T,N){var Q=T._origin,re=T._capacity,ae=oy(re),xe=T._tail;return Pe(T._root,T._level,0);function Pe(st,yt,Ft){return yt===0?Ue(st,Ft):et(st,yt,Ft)}function Ue(st,yt){var Ft=yt===ae?xe&&xe.array:st&&st.array,qt=yt>Q?0:Q-yt,Ar=re-yt;return Ar>b&&(Ar=b),function(){if(qt===Ar)return iy;var Wr=N?--Ar:qt++;return Ft&&Ft[Wr]}}function et(st,yt,Ft){var qt,Ar=st&&st.array,Wr=Ft>Q?0:Q-Ft>>yt,Jn=(re-Ft>>yt)+1;return Jn>b&&(Jn=b),function(){do{if(qt){var lu=qt();if(lu!==iy)return lu;qt=null}if(Wr===Jn)return iy;var nl=N?--Jn:Wr++;qt=Pe(Ar&&Ar[nl],yt-y,Ft+(nl<<yt))}while(!0)}}}function ay(T,N,Q,re,ae,xe,Pe){var Ue=Object.create(Za);return Ue.size=N-T,Ue._origin=T,Ue._capacity=N,Ue._level=Q,Ue._root=re,Ue._tail=ae,Ue.__ownerID=xe,Ue.__hash=Pe,Ue.__altered=!1,Ue}var KL;function $A(){return KL||(KL=ay(0,0,y))}function Cse(T,N,Q){if(N=O(T,N),N!==N)return T;if(N>=T.size||N<0)return T.withMutations(function(Pe){N<0?Zd(Pe,N).set(0,Q):Zd(Pe,0,N+1).set(N,Q)});N+=T._origin;var re=T._tail,ae=T._root,xe=A(w);return N>=oy(T._capacity)?re=WA(re,T.__ownerID,0,N,Q,xe):ae=WA(ae,T.__ownerID,T._level,N,Q,xe),xe.value?T.__ownerID?(T._root=ae,T._tail=re,T.__hash=void 0,T.__altered=!0,T):ay(T._origin,T._capacity,T._level,ae,re):T}function WA(T,N,Q,re,ae,xe){var Pe=re>>>Q&S,Ue=T&&Pe<T.array.length;if(!Ue&&ae===void 0)return T;var et;if(Q>0){var st=T&&T.array[Pe],yt=WA(st,N,Q-y,re,ae,xe);return yt===st?T:(et=gm(T,N),et.array[Pe]=yt,et)}return Ue&&T.array[Pe]===ae?T:(M(xe),et=gm(T,N),ae===void 0&&Pe===et.array.length-1?et.array.pop():et.array[Pe]=ae,et)}function gm(T,N){return N&&T&&N===T.ownerID?T:new Qd(T?T.array.slice():[],N)}function QL(T,N){if(N>=oy(T._capacity))return T._tail;if(N<1<<T._level+y){for(var Q=T._root,re=T._level;Q&&re>0;)Q=Q.array[N>>>re&S],re-=y;return Q}}function Zd(T,N,Q){N!==void 0&&(N=N|0),Q!==void 0&&(Q=Q|0);var re=T.__ownerID||new D,ae=T._origin,xe=T._capacity,Pe=ae+N,Ue=Q===void 0?xe:Q<0?xe+Q:ae+Q;if(Pe===ae&&Ue===xe)return T;if(Pe>=Ue)return T.clear();for(var et=T._level,st=T._root,yt=0;Pe+yt<0;)st=new Qd(st&&st.array.length?[void 0,st]:[],re),et+=y,yt+=1<<et;yt&&(Pe+=yt,ae+=yt,Ue+=yt,xe+=yt);for(var Ft=oy(xe),qt=oy(Ue);qt>=1<<et+y;)st=new Qd(st&&st.array.length?[st]:[],re),et+=y;var Ar=T._tail,Wr=qt<Ft?QL(T,Ue-1):qt>Ft?new Qd([],re):Ar;if(Ar&&qt>Ft&&Pe<xe&&Ar.array.length){st=gm(st,re);for(var Jn=st,lu=et;lu>y;lu-=y){var nl=Ft>>>lu&S;Jn=Jn.array[nl]=gm(Jn.array[nl],re)}Jn.array[Ft>>>y&S]=Ar}if(Ue<xe&&(Wr=Wr&&Wr.removeAfter(re,0,Ue)),Pe>=qt)Pe-=qt,Ue-=qt,et=y,st=null,Wr=Wr&&Wr.removeBefore(re,0,Pe);else if(Pe>ae||qt<Ft){for(yt=0;st;){var nx=Pe>>>et&S;if(nx!==qt>>>et&S)break;nx&&(yt+=(1<<et)*nx),et-=y,st=st.array[nx]}st&&Pe>ae&&(st=st.removeBefore(re,et,Pe-yt)),st&&qt<Ft&&(st=st.removeAfter(re,et,qt-yt)),yt&&(Pe-=yt,Ue-=yt)}return T.__ownerID?(T.size=Ue-Pe,T._origin=Pe,T._capacity=Ue,T._level=et,T._root=st,T._tail=Wr,T.__hash=void 0,T.__altered=!0,T):ay(Pe,Ue,et,st,Wr)}function K2(T,N,Q){for(var re=[],ae=0,xe=0;xe<Q.length;xe++){var Pe=Q[xe],Ue=o(Pe);Ue.size>ae&&(ae=Ue.size),u(Pe)||(Ue=Ue.map(function(et){return dt(et)})),re.push(Ue)}return ae>T.size&&(T=T.setSize(ae)),HL(T,N,re)}function oy(T){return T<b?0:T-1>>>y<<y}n(Ei,rn);function Ei(T){return T==null?Q2():ZL(T)?T:Q2().withMutations(function(N){var Q=a(T);Qa(Q.size),Q.forEach(function(re,ae){return N.set(ae,re)})})}Ei.of=function(){return this(arguments)},Ei.prototype.toString=function(){return this.__toString("OrderedMap {","}")},Ei.prototype.get=function(T,N){var Q=this._map.get(T);return Q!==void 0?this._list.get(Q)[1]:N},Ei.prototype.clear=function(){return this.size===0?this:this.__ownerID?(this.size=0,this._map.clear(),this._list.clear(),this):Q2()},Ei.prototype.set=function(T,N){return eN(this,T,N)},Ei.prototype.remove=function(T){return eN(this,T,x)},Ei.prototype.wasAltered=function(){return this._map.wasAltered()||this._list.wasAltered()},Ei.prototype.__iterate=function(T,N){var Q=this;return this._list.__iterate(function(re){return re&&T(re[1],re[0],Q)},N)},Ei.prototype.__iterator=function(T,N){return this._list.fromEntrySeq().__iterator(T,N)},Ei.prototype.__ensureOwner=function(T){if(T===this.__ownerID)return this;var N=this._map.__ensureOwner(T),Q=this._list.__ensureOwner(T);return T?XA(N,Q,T,this.__hash):(this.__ownerID=T,this._map=N,this._list=Q,this)};function ZL(T){return jA(T)&&f(T)}Ei.isOrderedMap=ZL,Ei.prototype[m]=!0,Ei.prototype[g]=Ei.prototype.remove;function XA(T,N,Q,re){var ae=Object.create(Ei.prototype);return ae.size=T?T.size:0,ae._map=T,ae._list=N,ae.__ownerID=Q,ae.__hash=re,ae}var JL;function Q2(){return JL||(JL=XA(uu(),$A()))}function eN(T,N,Q){var re=T._map,ae=T._list,xe=re.get(N),Pe=xe!==void 0,Ue,et;if(Q===x){if(!Pe)return T;ae.size>=b&&ae.size>=re.size*2?(et=ae.filter(function(st,yt){return st!==void 0&&xe!==yt}),Ue=et.toKeyedSeq().map(function(st){return st[0]}).flip().toMap(),T.__ownerID&&(Ue.__ownerID=et.__ownerID=T.__ownerID)):(Ue=re.remove(N),et=xe===ae.size-1?ae.pop():ae.set(xe,void 0))}else if(Pe){if(Q===ae.get(xe)[1])return T;Ue=re,et=ae.set(xe,[N,Q])}else Ue=re.set(N,ae.size),et=ae.set(ae.size,[N,Q]);return T.__ownerID?(T.size=Ue.size,T._map=Ue,T._list=et,T.__hash=void 0,T):XA(Ue,et)}n(Cs,Ae);function Cs(T,N){this._iter=T,this._useKeys=N,this.size=T.size}Cs.prototype.get=function(T,N){return this._iter.get(T,N)},Cs.prototype.has=function(T){return this._iter.has(T)},Cs.prototype.valueSeq=function(){return this._iter.valueSeq()},Cs.prototype.reverse=function(){var T=this,N=YA(this,!0);return this._useKeys||(N.valueSeq=function(){return T._iter.toSeq().reverse()}),N},Cs.prototype.map=function(T,N){var Q=this,re=rN(this,T,N);return this._useKeys||(re.valueSeq=function(){return Q._iter.toSeq().map(T,N)}),re},Cs.prototype.__iterate=function(T,N){var Q=this,re;return this._iter.__iterate(this._useKeys?function(ae,xe){return T(ae,xe,Q)}:(re=N?uN(this):0,function(ae){return T(ae,N?--re:re++,Q)}),N)},Cs.prototype.__iterator=function(T,N){if(this._useKeys)return this._iter.__iterator(T,N);var Q=this._iter.__iterator(q,N),re=N?uN(this):0;return new U(function(){var ae=Q.next();return ae.done?ae:z(T,N?--re:re++,ae.value,ae)})},Cs.prototype[m]=!0,n(ym,Se);function ym(T){this._iter=T,this.size=T.size}ym.prototype.includes=function(T){return this._iter.includes(T)},ym.prototype.__iterate=function(T,N){var Q=this,re=0;return this._iter.__iterate(function(ae){return T(ae,re++,Q)},N)},ym.prototype.__iterator=function(T,N){var Q=this._iter.__iterator(q,N),re=0;return new U(function(){var ae=Q.next();return ae.done?ae:z(T,re++,ae.value,ae)})},n(bm,ie);function bm(T){this._iter=T,this.size=T.size}bm.prototype.has=function(T){return this._iter.includes(T)},bm.prototype.__iterate=function(T,N){var Q=this;return this._iter.__iterate(function(re){return T(re,re,Q)},N)},bm.prototype.__iterator=function(T,N){var Q=this._iter.__iterator(q,N);return new U(function(){var re=Q.next();return re.done?re:z(T,re.value,re.value,re)})},n(xm,Ae);function xm(T){this._iter=T,this.size=T.size}xm.prototype.entrySeq=function(){return this._iter.toSeq()},xm.prototype.__iterate=function(T,N){var Q=this;return this._iter.__iterate(function(re){if(re){sN(re);var ae=u(re);return T(ae?re.get(1):re[1],ae?re.get(0):re[0],Q)}},N)},xm.prototype.__iterator=function(T,N){var Q=this._iter.__iterator(q,N);return new U(function(){for(;;){var re=Q.next();if(re.done)return re;var ae=re.value;if(ae){sN(ae);var xe=u(ae);return z(T,xe?ae.get(0):ae[0],xe?ae.get(1):ae[1],re)}}})},ym.prototype.cacheResult=Cs.prototype.cacheResult=bm.prototype.cacheResult=xm.prototype.cacheResult=ZA;function tN(T){var N=el(T);return N._iter=T,N.size=T.size,N.flip=function(){return T},N.reverse=function(){var Q=T.reverse.apply(this);return Q.flip=function(){return T.reverse()},Q},N.has=function(Q){return T.includes(Q)},N.includes=function(Q){return T.has(Q)},N.cacheResult=ZA,N.__iterateUncached=function(Q,re){var ae=this;return T.__iterate(function(xe,Pe){return Q(Pe,xe,ae)!==!1},re)},N.__iteratorUncached=function(Q,re){if(Q===ee){var ae=T.__iterator(Q,re);return new U(function(){var xe=ae.next();if(!xe.done){var Pe=xe.value[0];xe.value[0]=xe.value[1],xe.value[1]=Pe}return xe})}return T.__iterator(Q===q?$:q,re)},N}function rN(T,N,Q){var re=el(T);return re.size=T.size,re.has=function(ae){return T.has(ae)},re.get=function(ae,xe){var Pe=T.get(ae,x);return Pe===x?xe:N.call(Q,Pe,ae,T)},re.__iterateUncached=function(ae,xe){var Pe=this;return T.__iterate(function(Ue,et,st){return ae(N.call(Q,Ue,et,st),et,Pe)!==!1},xe)},re.__iteratorUncached=function(ae,xe){var Pe=T.__iterator(ee,xe);return new U(function(){var Ue=Pe.next();if(Ue.done)return Ue;var et=Ue.value,st=et[0];return z(ae,st,N.call(Q,et[1],st,T),Ue)})},re}function YA(T,N){var Q=el(T);return Q._iter=T,Q.size=T.size,Q.reverse=function(){return T},T.flip&&(Q.flip=function(){var re=tN(T);return re.reverse=function(){return T.flip()},re}),Q.get=function(re,ae){return T.get(N?re:-1-re,ae)},Q.has=function(re){return T.has(N?re:-1-re)},Q.includes=function(re){return T.includes(re)},Q.cacheResult=ZA,Q.__iterate=function(re,ae){var xe=this;return T.__iterate(function(Pe,Ue){return re(Pe,Ue,xe)},!ae)},Q.__iterator=function(re,ae){return T.__iterator(re,!ae)},Q}function nN(T,N,Q,re){var ae=el(T);return re&&(ae.has=function(xe){var Pe=T.get(xe,x);return Pe!==x&&!!N.call(Q,Pe,xe,T)},ae.get=function(xe,Pe){var Ue=T.get(xe,x);return Ue!==x&&N.call(Q,Ue,xe,T)?Ue:Pe}),ae.__iterateUncached=function(xe,Pe){var Ue=this,et=0;return T.__iterate(function(st,yt,Ft){if(N.call(Q,st,yt,Ft))return et++,xe(st,re?yt:et-1,Ue)},Pe),et},ae.__iteratorUncached=function(xe,Pe){var Ue=T.__iterator(ee,Pe),et=0;return new U(function(){for(;;){var st=Ue.next();if(st.done)return st;var yt=st.value,Ft=yt[0],qt=yt[1];if(N.call(Q,qt,Ft,T))return z(xe,re?Ft:et++,qt,st)}})},ae}function _se(T,N,Q){var re=rn().asMutable();return T.__iterate(function(ae,xe){re.update(N.call(Q,ae,xe,T),0,function(Pe){return Pe+1})}),re.asImmutable()}function wse(T,N,Q){var re=l(T),ae=(f(T)?Ei():rn()).asMutable();T.__iterate(function(Pe,Ue){ae.update(N.call(Q,Pe,Ue,T),function(et){return et=et||[],et.push(re?[Ue,Pe]:Pe),et})});var xe=lN(T);return ae.map(function(Pe){return On(T,xe(Pe))})}function KA(T,N,Q,re){var ae=T.size;if(N!==void 0&&(N=N|0),Q!==void 0&&(Q===1/0?Q=ae:Q=Q|0),B(N,Q,ae))return T;var xe=j(N,ae),Pe=Y(Q,ae);if(xe!==xe||Pe!==Pe)return KA(T.toSeq().cacheResult(),N,Q,re);var Ue=Pe-xe,et;Ue===Ue&&(et=Ue<0?0:Ue);var st=el(T);return st.size=et===0?et:T.size&&et||void 0,!re&&Te(T)&&et>=0&&(st.get=function(yt,Ft){return yt=O(this,yt),yt>=0&&yt<et?T.get(yt+xe,Ft):Ft}),st.__iterateUncached=function(yt,Ft){var qt=this;if(et===0)return 0;if(Ft)return this.cacheResult().__iterate(yt,Ft);var Ar=0,Wr=!0,Jn=0;return T.__iterate(function(lu,nl){if(!(Wr&&(Wr=Ar++<xe)))return Jn++,yt(lu,re?nl:Jn-1,qt)!==!1&&Jn!==et}),Jn},st.__iteratorUncached=function(yt,Ft){if(et!==0&&Ft)return this.cacheResult().__iterator(yt,Ft);var qt=et!==0&&T.__iterator(yt,Ft),Ar=0,Wr=0;return new U(function(){for(;Ar++<xe;)qt.next();if(++Wr>et)return J();var Jn=qt.next();return re||yt===q?Jn:yt===$?z(yt,Wr-1,void 0,Jn):z(yt,Wr-1,Jn.value[1],Jn)})},st}function Ese(T,N,Q){var re=el(T);return re.__iterateUncached=function(ae,xe){var Pe=this;if(xe)return this.cacheResult().__iterate(ae,xe);var Ue=0;return T.__iterate(function(et,st,yt){return N.call(Q,et,st,yt)&&++Ue&&ae(et,st,Pe)}),Ue},re.__iteratorUncached=function(ae,xe){var Pe=this;if(xe)return this.cacheResult().__iterator(ae,xe);var Ue=T.__iterator(ee,xe),et=!0;return new U(function(){if(!et)return J();var st=Ue.next();if(st.done)return st;var yt=st.value,Ft=yt[0],qt=yt[1];return N.call(Q,qt,Ft,Pe)?ae===ee?st:z(ae,Ft,qt,st):(et=!1,J())})},re}function iN(T,N,Q,re){var ae=el(T);return ae.__iterateUncached=function(xe,Pe){var Ue=this;if(Pe)return this.cacheResult().__iterate(xe,Pe);var et=!0,st=0;return T.__iterate(function(yt,Ft,qt){if(!(et&&(et=N.call(Q,yt,Ft,qt))))return st++,xe(yt,re?Ft:st-1,Ue)}),st},ae.__iteratorUncached=function(xe,Pe){var Ue=this;if(Pe)return this.cacheResult().__iterator(xe,Pe);var et=T.__iterator(ee,Pe),st=!0,yt=0;return new U(function(){var Ft,qt,Ar;do{if(Ft=et.next(),Ft.done)return re||xe===q?Ft:xe===$?z(xe,yt++,void 0,Ft):z(xe,yt++,Ft.value[1],Ft);var Wr=Ft.value;qt=Wr[0],Ar=Wr[1],st&&(st=N.call(Q,Ar,qt,Ue))}while(st);return xe===ee?Ft:z(xe,qt,Ar,Ft)})},ae}function Ase(T,N){var Q=l(T),re=[T].concat(N).map(function(Pe){return u(Pe)?Q&&(Pe=a(Pe)):Pe=Q?Xe(Pe):ct(Array.isArray(Pe)?Pe:[Pe]),Pe}).filter(function(Pe){return Pe.size!==0});if(re.length===0)return T;if(re.length===1){var ae=re[0];if(ae===T||Q&&l(ae)||c(T)&&c(ae))return ae}var xe=new F(re);return Q?xe=xe.toKeyedSeq():c(T)||(xe=xe.toSetSeq()),xe=xe.flatten(!0),xe.size=re.reduce(function(Pe,Ue){if(Pe!==void 0){var et=Ue.size;if(et!==void 0)return Pe+et}},0),xe}function aN(T,N,Q){var re=el(T);return re.__iterateUncached=function(ae,xe){var Pe=0,Ue=!1;function et(st,yt){var Ft=this;st.__iterate(function(qt,Ar){return(!N||yt<N)&&u(qt)?et(qt,yt+1):ae(qt,Q?Ar:Pe++,Ft)===!1&&(Ue=!0),!Ue},xe)}return et(T,0),Pe},re.__iteratorUncached=function(ae,xe){var Pe=T.__iterator(ae,xe),Ue=[],et=0;return new U(function(){for(;Pe;){var st=Pe.next();if(st.done!==!1){Pe=Ue.pop();continue}var yt=st.value;if(ae===ee&&(yt=yt[1]),(!N||Ue.length<N)&&u(yt))Ue.push(Pe),Pe=yt.__iterator(ae,xe);else return Q?st:z(ae,et++,yt,st)}return J()})},re}function Pse(T,N,Q){var re=lN(T);return T.toSeq().map(function(ae,xe){return re(N.call(Q,ae,xe,T))}).flatten(!0)}function Tse(T,N){var Q=el(T);return Q.size=T.size&&T.size*2-1,Q.__iterateUncached=function(re,ae){var xe=this,Pe=0;return T.__iterate(function(Ue,et){return(!Pe||re(N,Pe++,xe)!==!1)&&re(Ue,Pe++,xe)!==!1},ae),Pe},Q.__iteratorUncached=function(re,ae){var xe=T.__iterator(q,ae),Pe=0,Ue;return new U(function(){return(!Ue||Pe%2)&&(Ue=xe.next(),Ue.done)?Ue:Pe%2?z(re,Pe++,N):z(re,Pe++,Ue.value,Ue)})},Q}function Sm(T,N,Q){N||(N=cN);var re=l(T),ae=0,xe=T.toSeq().map(function(Pe,Ue){return[Ue,Pe,ae++,Q?Q(Pe,Ue,T):Pe]}).toArray();return xe.sort(function(Pe,Ue){return N(Pe[3],Ue[3])||Pe[2]-Ue[2]}).forEach(re?function(Pe,Ue){xe[Ue].length=2}:function(Pe,Ue){xe[Ue]=Pe[1]}),re?Ae(xe):c(T)?Se(xe):ie(xe)}function Z2(T,N,Q){if(N||(N=cN),Q){var re=T.toSeq().map(function(ae,xe){return[ae,Q(ae,xe,T)]}).reduce(function(ae,xe){return oN(N,ae[1],xe[1])?xe:ae});return re&&re[0]}else return T.reduce(function(ae,xe){return oN(N,ae,xe)?xe:ae})}function oN(T,N,Q){var re=T(Q,N);return re===0&&Q!==N&&(Q==null||Q!==Q)||re>0}function QA(T,N,Q){var re=el(T);return re.size=new F(Q).map(function(ae){return ae.size}).min(),re.__iterate=function(ae,xe){for(var Pe=this.__iterator(q,xe),Ue,et=0;!(Ue=Pe.next()).done&&ae(Ue.value,et++,this)!==!1;);return et},re.__iteratorUncached=function(ae,xe){var Pe=Q.map(function(st){return st=i(st),te(xe?st.reverse():st)}),Ue=0,et=!1;return new U(function(){var st;return et||(st=Pe.map(function(yt){return yt.next()}),et=st.some(function(yt){return yt.done})),et?J():z(ae,Ue++,N.apply(null,st.map(function(yt){return yt.value})))})},re}function On(T,N){return Te(T)?N:T.constructor(N)}function sN(T){if(T!==Object(T))throw new TypeError("Expected [K, V] tuple: "+T)}function uN(T){return Qa(T.size),R(T)}function lN(T){return l(T)?a:c(T)?o:s}function el(T){return Object.create((l(T)?Ae:c(T)?Se:ie).prototype)}function ZA(){return this._iter.cacheResult?(this._iter.cacheResult(),this.size=this._iter.size,this):be.prototype.cacheResult.call(this)}function cN(T,N){return T>N?1:T<N?-1:0}function dN(T){var N=te(T);if(!N){if(!ye(T))throw new TypeError("Expected iterable or array-like: "+T);N=te(i(T))}return N}n(jo,gt);function jo(T,N){var Q,re=function(Pe){if(Pe instanceof re)return Pe;if(!(this instanceof re))return new re(Pe);if(!Q){Q=!0;var Ue=Object.keys(T);Ise(ae,Ue),ae.size=Ue.length,ae._name=N,ae._keys=Ue,ae._defaultValues=T}this._map=rn(Pe)},ae=re.prototype=Object.create(va);return ae.constructor=re,re}jo.prototype.toString=function(){return this.__toString(fN(this)+" {","}")},jo.prototype.has=function(T){return this._defaultValues.hasOwnProperty(T)},jo.prototype.get=function(T,N){if(!this.has(T))return N;var Q=this._defaultValues[T];return this._map?this._map.get(T,Q):Q},jo.prototype.clear=function(){if(this.__ownerID)return this._map&&this._map.clear(),this;var T=this.constructor;return T._empty||(T._empty=J2(this,uu()))},jo.prototype.set=function(T,N){if(!this.has(T))throw new Error('Cannot set unknown key "'+T+'" on '+fN(this));if(this._map&&!this._map.has(T)){var Q=this._defaultValues[T];if(N===Q)return this}var re=this._map&&this._map.set(T,N);return this.__ownerID||re===this._map?this:J2(this,re)},jo.prototype.remove=function(T){if(!this.has(T))return this;var N=this._map&&this._map.remove(T);return this.__ownerID||N===this._map?this:J2(this,N)},jo.prototype.wasAltered=function(){return this._map.wasAltered()},jo.prototype.__iterator=function(T,N){var Q=this;return a(this._defaultValues).map(function(re,ae){return Q.get(ae)}).__iterator(T,N)},jo.prototype.__iterate=function(T,N){var Q=this;return a(this._defaultValues).map(function(re,ae){return Q.get(ae)}).__iterate(T,N)},jo.prototype.__ensureOwner=function(T){if(T===this.__ownerID)return this;var N=this._map&&this._map.__ensureOwner(T);return T?J2(this,N,T):(this.__ownerID=T,this._map=N,this)};var va=jo.prototype;va[g]=va.remove,va.deleteIn=va.removeIn=Yr.removeIn,va.merge=Yr.merge,va.mergeWith=Yr.mergeWith,va.mergeIn=Yr.mergeIn,va.mergeDeep=Yr.mergeDeep,va.mergeDeepWith=Yr.mergeDeepWith,va.mergeDeepIn=Yr.mergeDeepIn,va.setIn=Yr.setIn,va.update=Yr.update,va.updateIn=Yr.updateIn,va.withMutations=Yr.withMutations,va.asMutable=Yr.asMutable,va.asImmutable=Yr.asImmutable;function J2(T,N,Q){var re=Object.create(Object.getPrototypeOf(T));return re._map=N,re.__ownerID=Q,re}function fN(T){return T._name||T.constructor.name||"Record"}function Ise(T,N){try{N.forEach(Mse.bind(void 0,T))}catch{}}function Mse(T,N){Object.defineProperty(T,N,{get:function(){return this.get(N)},set:function(Q){he(this.__ownerID,"Cannot set on an immutable record."),this.set(N,Q)}})}n(Zn,Yt);function Zn(T){return T==null?t4():JA(T)&&!f(T)?T:t4().withMutations(function(N){var Q=s(T);Qa(Q.size),Q.forEach(function(re){return N.add(re)})})}Zn.of=function(){return this(arguments)},Zn.fromKeys=function(T){return this(a(T).keySeq())},Zn.prototype.toString=function(){return this.__toString("Set {","}")},Zn.prototype.has=function(T){return this._map.has(T)},Zn.prototype.add=function(T){return e4(this,this._map.set(T,!0))},Zn.prototype.remove=function(T){return e4(this,this._map.remove(T))},Zn.prototype.clear=function(){return e4(this,this._map.clear())},Zn.prototype.union=function(){var T=r.call(arguments,0);return T=T.filter(function(N){return N.size!==0}),T.length===0?this:this.size===0&&!this.__ownerID&&T.length===1?this.constructor(T[0]):this.withMutations(function(N){for(var Q=0;Q<T.length;Q++)s(T[Q]).forEach(function(re){return N.add(re)})})},Zn.prototype.intersect=function(){var T=r.call(arguments,0);if(T.length===0)return this;T=T.map(function(Q){return s(Q)});var N=this;return this.withMutations(function(Q){N.forEach(function(re){T.every(function(ae){return ae.includes(re)})||Q.remove(re)})})},Zn.prototype.subtract=function(){var T=r.call(arguments,0);if(T.length===0)return this;T=T.map(function(Q){return s(Q)});var N=this;return this.withMutations(function(Q){N.forEach(function(re){T.some(function(ae){return ae.includes(re)})&&Q.remove(re)})})},Zn.prototype.merge=function(){return this.union.apply(this,arguments)},Zn.prototype.mergeWith=function(T){var N=r.call(arguments,1);return this.union.apply(this,N)},Zn.prototype.sort=function(T){return tl(Sm(this,T))},Zn.prototype.sortBy=function(T,N){return tl(Sm(this,N,T))},Zn.prototype.wasAltered=function(){return this._map.wasAltered()},Zn.prototype.__iterate=function(T,N){var Q=this;return this._map.__iterate(function(re,ae){return T(ae,ae,Q)},N)},Zn.prototype.__iterator=function(T,N){return this._map.map(function(Q,re){return re}).__iterator(T,N)},Zn.prototype.__ensureOwner=function(T){if(T===this.__ownerID)return this;var N=this._map.__ensureOwner(T);return T?this.__make(N,T):(this.__ownerID=T,this._map=N,this)};function JA(T){return!!(T&&T[hN])}Zn.isSet=JA;var hN="@@__IMMUTABLE_SET__@@",zo=Zn.prototype;zo[hN]=!0,zo[g]=zo.remove,zo.mergeDeep=zo.merge,zo.mergeDeepWith=zo.mergeWith,zo.withMutations=Yr.withMutations,zo.asMutable=Yr.asMutable,zo.asImmutable=Yr.asImmutable,zo.__empty=t4,zo.__make=pN;function e4(T,N){return T.__ownerID?(T.size=N.size,T._map=N,T):N===T._map?T:N.size===0?T.__empty():T.__make(N)}function pN(T,N){var Q=Object.create(zo);return Q.size=T?T.size:0,Q._map=T,Q.__ownerID=N,Q}var vN;function t4(){return vN||(vN=pN(uu()))}n(tl,Zn);function tl(T){return T==null?r4():mN(T)?T:r4().withMutations(function(N){var Q=s(T);Qa(Q.size),Q.forEach(function(re){return N.add(re)})})}tl.of=function(){return this(arguments)},tl.fromKeys=function(T){return this(a(T).keySeq())},tl.prototype.toString=function(){return this.__toString("OrderedSet {","}")};function mN(T){return JA(T)&&f(T)}tl.isOrderedSet=mN;var ex=tl.prototype;ex[m]=!0,ex.__empty=r4,ex.__make=gN;function gN(T,N){var Q=Object.create(ex);return Q.size=T?T.size:0,Q._map=T,Q.__ownerID=N,Q}var yN;function r4(){return yN||(yN=gN(Q2()))}n(Ti,Pt);function Ti(T){return T==null?n4():bN(T)?T:n4().unshiftAll(T)}Ti.of=function(){return this(arguments)},Ti.prototype.toString=function(){return this.__toString("Stack [","]")},Ti.prototype.get=function(T,N){var Q=this._head;for(T=O(this,T);Q&&T--;)Q=Q.next;return Q?Q.value:N},Ti.prototype.peek=function(){return this._head&&this._head.value},Ti.prototype.push=function(){if(arguments.length===0)return this;for(var T=this.size+arguments.length,N=this._head,Q=arguments.length-1;Q>=0;Q--)N={value:arguments[Q],next:N};return this.__ownerID?(this.size=T,this._head=N,this.__hash=void 0,this.__altered=!0,this):sy(T,N)},Ti.prototype.pushAll=function(T){if(T=o(T),T.size===0)return this;Qa(T.size);var N=this.size,Q=this._head;return T.reverse().forEach(function(re){N++,Q={value:re,next:Q}}),this.__ownerID?(this.size=N,this._head=Q,this.__hash=void 0,this.__altered=!0,this):sy(N,Q)},Ti.prototype.pop=function(){return this.slice(1)},Ti.prototype.unshift=function(){return this.push.apply(this,arguments)},Ti.prototype.unshiftAll=function(T){return this.pushAll(T)},Ti.prototype.shift=function(){return this.pop.apply(this,arguments)},Ti.prototype.clear=function(){return this.size===0?this:this.__ownerID?(this.size=0,this._head=void 0,this.__hash=void 0,this.__altered=!0,this):n4()},Ti.prototype.slice=function(T,N){if(B(T,N,this.size))return this;var Q=j(T,this.size),re=Y(N,this.size);if(re!==this.size)return Pt.prototype.slice.call(this,T,N);for(var ae=this.size-Q,xe=this._head;Q--;)xe=xe.next;return this.__ownerID?(this.size=ae,this._head=xe,this.__hash=void 0,this.__altered=!0,this):sy(ae,xe)},Ti.prototype.__ensureOwner=function(T){return T===this.__ownerID?this:T?sy(this.size,this._head,T,this.__hash):(this.__ownerID=T,this.__altered=!1,this)},Ti.prototype.__iterate=function(T,N){if(N)return this.reverse().__iterate(T);for(var Q=0,re=this._head;re&&T(re.value,Q++,this)!==!1;)re=re.next;return Q},Ti.prototype.__iterator=function(T,N){if(N)return this.reverse().__iterator(T);var Q=0,re=this._head;return new U(function(){if(re){var ae=re.value;return re=re.next,z(T,Q++,ae)}return J()})};function bN(T){return!!(T&&T[xN])}Ti.isStack=bN;var xN="@@__IMMUTABLE_STACK__@@",Cm=Ti.prototype;Cm[xN]=!0,Cm.withMutations=Yr.withMutations,Cm.asMutable=Yr.asMutable,Cm.asImmutable=Yr.asImmutable,Cm.wasAltered=Yr.wasAltered;function sy(T,N,Q,re){var ae=Object.create(Cm);return ae.size=T,ae._head=N,ae.__ownerID=Q,ae.__hash=re,ae.__altered=!1,ae}var SN;function n4(){return SN||(SN=sy(0))}function rl(T,N){var Q=function(re){T.prototype[re]=N[re]};return Object.keys(N).forEach(Q),Object.getOwnPropertySymbols&&Object.getOwnPropertySymbols(N).forEach(Q),T}i.Iterator=U,rl(i,{toArray:function(){Qa(this.size);var T=new Array(this.size||0);return this.valueSeq().__iterate(function(N,Q){T[Q]=N}),T},toIndexedSeq:function(){return new ym(this)},toJS:function(){return this.toSeq().map(function(T){return T&&typeof T.toJS=="function"?T.toJS():T}).__toJS()},toJSON:function(){return this.toSeq().map(function(T){return T&&typeof T.toJSON=="function"?T.toJSON():T}).__toJS()},toKeyedSeq:function(){return new Cs(this,!0)},toMap:function(){return rn(this.toKeyedSeq())},toObject:function(){Qa(this.size);var T={};return this.__iterate(function(N,Q){T[Q]=N}),T},toOrderedMap:function(){return Ei(this.toKeyedSeq())},toOrderedSet:function(){return tl(l(this)?this.valueSeq():this)},toSet:function(){return Zn(l(this)?this.valueSeq():this)},toSetSeq:function(){return new bm(this)},toSeq:function(){return c(this)?this.toIndexedSeq():l(this)?this.toKeyedSeq():this.toSetSeq()},toStack:function(){return Ti(l(this)?this.valueSeq():this)},toList:function(){return Hn(l(this)?this.valueSeq():this)},toString:function(){return"[Iterable]"},__toString:function(T,N){return this.size===0?T+N:T+" "+this.toSeq().map(this.__toStringMapper).join(", ")+" "+N},concat:function(){var T=r.call(arguments,0);return On(this,Ase(this,T))},includes:function(T){return this.some(function(N){return tt(N,T)})},entries:function(){return this.__iterator(ee)},every:function(T,N){Qa(this.size);var Q=!0;return this.__iterate(function(re,ae,xe){if(!T.call(N,re,ae,xe))return Q=!1,!1}),Q},filter:function(T,N){return On(this,nN(this,T,N,!0))},find:function(T,N,Q){var re=this.findEntry(T,N);return re?re[1]:Q},forEach:function(T,N){return Qa(this.size),this.__iterate(N?T.bind(N):T)},join:function(T){Qa(this.size),T=T!==void 0?""+T:",";var N="",Q=!0;return this.__iterate(function(re){Q?Q=!1:N+=T,N+=re!=null?re.toString():""}),N},keys:function(){return this.__iterator($)},map:function(T,N){return On(this,rN(this,T,N))},reduce:function(T,N,Q){Qa(this.size);var re,ae;return arguments.length<2?ae=!0:re=N,this.__iterate(function(xe,Pe,Ue){ae?(ae=!1,re=xe):re=T.call(Q,re,xe,Pe,Ue)}),re},reduceRight:function(T,N,Q){var re=this.toKeyedSeq().reverse();return re.reduce.apply(re,arguments)},reverse:function(){return On(this,YA(this,!0))},slice:function(T,N){return On(this,KA(this,T,N,!0))},some:function(T,N){return!this.every(rx(T),N)},sort:function(T){return On(this,Sm(this,T))},values:function(){return this.__iterator(q)},butLast:function(){return this.slice(0,-1)},isEmpty:function(){return this.size!==void 0?this.size===0:!this.some(function(){return!0})},count:function(T,N){return R(T?this.toSeq().filter(T,N):this)},countBy:function(T,N){return _se(this,T,N)},equals:function(T){return xt(this,T)},entrySeq:function(){var T=this;if(T._cache)return new F(T._cache);var N=T.toSeq().map(Rse).toIndexedSeq();return N.fromEntrySeq=function(){return T.toSeq()},N},filterNot:function(T,N){return this.filter(rx(T),N)},findEntry:function(T,N,Q){var re=Q;return this.__iterate(function(ae,xe,Pe){if(T.call(N,ae,xe,Pe))return re=[xe,ae],!1}),re},findKey:function(T,N){var Q=this.findEntry(T,N);return Q&&Q[0]},findLast:function(T,N,Q){return this.toKeyedSeq().reverse().find(T,N,Q)},findLastEntry:function(T,N,Q){return this.toKeyedSeq().reverse().findEntry(T,N,Q)},findLastKey:function(T,N){return this.toKeyedSeq().reverse().findKey(T,N)},first:function(){return this.find(H)},flatMap:function(T,N){return On(this,Pse(this,T,N))},flatten:function(T){return On(this,aN(this,T,!0))},fromEntrySeq:function(){return new xm(this)},get:function(T,N){return this.find(function(Q,re){return tt(re,T)},void 0,N)},getIn:function(T,N){for(var Q=this,re=dN(T),ae;!(ae=re.next()).done;){var xe=ae.value;if(Q=Q&&Q.get?Q.get(xe,x):x,Q===x)return N}return Q},groupBy:function(T,N){return wse(this,T,N)},has:function(T){return this.get(T,x)!==x},hasIn:function(T){return this.getIn(T,x)!==x},isSubset:function(T){return T=typeof T.includes=="function"?T:i(T),this.every(function(N){return T.includes(N)})},isSuperset:function(T){return T=typeof T.isSubset=="function"?T:i(T),T.isSubset(this)},keyOf:function(T){return this.findKey(function(N){return tt(N,T)})},keySeq:function(){return this.toSeq().map(Dse).toIndexedSeq()},last:function(){return this.toSeq().reverse().first()},lastKeyOf:function(T){return this.toKeyedSeq().reverse().keyOf(T)},max:function(T){return Z2(this,T)},maxBy:function(T,N){return Z2(this,N,T)},min:function(T){return Z2(this,T?CN(T):wN)},minBy:function(T,N){return Z2(this,N?CN(N):wN,T)},rest:function(){return this.slice(1)},skip:function(T){return this.slice(Math.max(0,T))},skipLast:function(T){return On(this,this.toSeq().reverse().skip(T).reverse())},skipWhile:function(T,N){return On(this,iN(this,T,N,!0))},skipUntil:function(T,N){return this.skipWhile(rx(T),N)},sortBy:function(T,N){return On(this,Sm(this,N,T))},take:function(T){return this.slice(0,Math.max(0,T))},takeLast:function(T){return On(this,this.toSeq().reverse().take(T).reverse())},takeWhile:function(T,N){return On(this,Ese(this,T,N))},takeUntil:function(T,N){return this.takeWhile(rx(T),N)},valueSeq:function(){return this.toIndexedSeq()},hashCode:function(){return this.__hash||(this.__hash=Ose(this))}});var Ja=i.prototype;Ja[h]=!0,Ja[X]=Ja.values,Ja.__toJS=Ja.toArray,Ja.__toStringMapper=_N,Ja.inspect=Ja.toSource=function(){return this.toString()},Ja.chain=Ja.flatMap,Ja.contains=Ja.includes,rl(a,{flip:function(){return On(this,tN(this))},mapEntries:function(T,N){var Q=this,re=0;return On(this,this.toSeq().map(function(ae,xe){return T.call(N,[xe,ae],re++,Q)}).fromEntrySeq())},mapKeys:function(T,N){var Q=this;return On(this,this.toSeq().flip().map(function(re,ae){return T.call(N,re,ae,Q)}).flip())}});var tx=a.prototype;tx[v]=!0,tx[X]=Ja.entries,tx.__toJS=Ja.toObject,tx.__toStringMapper=function(T,N){return JSON.stringify(N)+": "+_N(T)},rl(o,{toKeyedSeq:function(){return new Cs(this,!1)},filter:function(T,N){return On(this,nN(this,T,N,!1))},findIndex:function(T,N){var Q=this.findEntry(T,N);return Q?Q[0]:-1},indexOf:function(T){var N=this.keyOf(T);return N===void 0?-1:N},lastIndexOf:function(T){var N=this.lastKeyOf(T);return N===void 0?-1:N},reverse:function(){return On(this,YA(this,!1))},slice:function(T,N){return On(this,KA(this,T,N,!1))},splice:function(T,N){var Q=arguments.length;if(N=Math.max(N|0,0),Q===0||Q===2&&!N)return this;T=j(T,T<0?this.count():this.size);var re=this.slice(0,T);return On(this,Q===1?re:re.concat(k(arguments,2),this.slice(T+N)))},findLastIndex:function(T,N){var Q=this.findLastEntry(T,N);return Q?Q[0]:-1},first:function(){return this.get(0)},flatten:function(T){return On(this,aN(this,T,!1))},get:function(T,N){return T=O(this,T),T<0||this.size===1/0||this.size!==void 0&&T>this.size?N:this.find(function(Q,re){return re===T},void 0,N)},has:function(T){return T=O(this,T),T>=0&&(this.size!==void 0?this.size===1/0||T<this.size:this.indexOf(T)!==-1)},interpose:function(T){return On(this,Tse(this,T))},interleave:function(){var T=[this].concat(k(arguments)),N=QA(this.toSeq(),Se.of,T),Q=N.flatten(!0);return N.size&&(Q.size=N.size*T.length),On(this,Q)},keySeq:function(){return me(0,this.size)},last:function(){return this.get(-1)},skipWhile:function(T,N){return On(this,iN(this,T,N,!1))},zip:function(){var T=[this].concat(k(arguments));return On(this,QA(this,kse,T))},zipWith:function(T){var N=k(arguments);return N[0]=this,On(this,QA(this,T,N))}}),o.prototype[p]=!0,o.prototype[m]=!0,rl(s,{get:function(T,N){return this.has(T)?T:N},includes:function(T){return this.has(T)},keySeq:function(){return this.valueSeq()}}),s.prototype.has=Ja.includes,s.prototype.contains=s.prototype.includes,rl(Ae,a.prototype),rl(Se,o.prototype),rl(ie,s.prototype),rl(gt,a.prototype),rl(Pt,o.prototype),rl(Yt,s.prototype);function Dse(T,N){return N}function Rse(T,N){return[N,T]}function rx(T){return function(){return!T.apply(this,arguments)}}function CN(T){return function(){return-T.apply(this,arguments)}}function _N(T){return typeof T=="string"?JSON.stringify(T):String(T)}function kse(){return k(arguments)}function wN(T,N){return T<N?1:T>N?-1:0}function Ose(T){if(T.size===1/0)return 0;var N=f(T),Q=l(T),re=N?1:0,ae=T.__iterate(Q?N?function(xe,Pe){re=31*re+EN(Qt(xe),Qt(Pe))|0}:function(xe,Pe){re=re+EN(Qt(xe),Qt(Pe))|0}:N?function(xe){re=31*re+Qt(xe)|0}:function(xe){re=re+Qt(xe)|0});return Fse(ae,re)}function Fse(T,N){return N=dr(N,3432918353),N=dr(N<<15|N>>>-15,461845907),N=dr(N<<13|N>>>-13,5),N=(N+3864292196|0)^T,N=dr(N^N>>>16,2246822507),N=dr(N^N>>>13,3266489909),N=Dr(N^N>>>16),N}function EN(T,N){return T^N+2654435769+(T<<6)+(T>>2)|0}var Lse={Iterable:i,Seq:be,Collection:Ke,Map:rn,OrderedMap:Ei,List:Hn,Stack:Ti,Set:Zn,OrderedSet:tl,Record:jo,Range:me,Repeat:pt,is:tt,fromJS:dt};return Lse})})(jZ);var ci=jZ.exports,LE=Object.prototype.hasOwnProperty;function NRe(e,t){for(var r=0,n=Object.keys(t);r<n.length;r++){var i=n[r];LE.call(t,i)&&typeof e[i]>"u"&&(e[i]=t[i])}return e}function BRe(e,t){for(var r=!1,n=0,i=Object.keys(t);n<i.length;n++){var a=i[n];if(LE.call(t,a)&&t[a]!==e[a]){r=!0;break}}return r?Object.assign({},e,t):e}function T6(e,t){if(!e)return!t;if(!t)return!1;var r=Object.keys(e);if(Object.keys(t).length!==r.length)return!1;for(var n=0,i=r;n<i.length;n++){var a=i[n];if(!LE.call(e,a)||e[a]!==t[a])return!1}return!0}function URe(e,t){for(var r=e,n=0;n<t.length;n++)if(t[n]&&(r=BRe(e,t[n]),r!==e)){for(var i=n+1;i<t.length;i++)r=Object.assign(r,t[i]);break}return r}function Ph(e){if(e===null||typeof e!="object")return e;if(e instanceof Array){for(var t=[],r=0,n=e.length;r<n;r++)t[r]=Ph(e[r]);return t}if(typeof e=="object"&&!("prototype"in e)){var t={};for(var i in e)LE.call(e,i)&&(t[i]=Ph(e[i]));return t}throw new Error(`Can't clone, type "`+typeof e+'" unsupported')}function $u(e,t){if(e)for(var r=0,n=Object.keys(e);r<n.length;r++){var i=n[r];t(e[i],i)}}function jRe(){var e=function(){var p=typeof window<"u"&&window,m=typeof self<"u"&&typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&self,g=typeof e<"u"&&e;return p||g||m}(),t={},r=typeof document<"u"?document:void 0,n=1,i;function a(p){for(var m=[],g=1;g<arguments.length;g++)m[g-1]=arguments[g];typeof p!="function"&&(p=new Function(""+p));var y={callback:p,args:m};return t[n]=y,i(n),n++}function o(p){delete t[p]}function s(p){var m=p.callback,g=p.args;switch(g.length){case 0:m();break;case 1:m(g[0]);break;case 2:m(g[0],g[1]);break;case 3:m(g[0],g[1],g[2]);break;default:m.apply(void 0,g);break}}function u(p){var m=t[p];o(p),s(m)}function l(){i=function(p){process.nextTick(function(){u(p)})}}function c(){if(e&&e.postMessage&&!e.importScripts){var p=!0,m=e.onmessage;return e.onmessage=function(){p=!1},e.postMessage("","*"),e.onmessage=m,p}}function d(){var p="setImmediate$"+Math.random()+"$",m=function(g){g.source===e&&typeof g.data=="string"&&g.data.indexOf(p)===0&&u(+g.data.slice(p.length))};window.addEventListener?window.addEventListener("message",m,!1):window.attachEvent("onmessage",m),i=function(g){window.postMessage(p+g,"*")}}function f(){var p=new MessageChannel;p.port1.onmessage=function(m){var g=m.data;u(g)},i=function(m){p.port2.postMessage(m)}}function h(){var p=r.documentElement;i=function(m){var g=r.createElement("script");g.onreadystatechange=function(){u(m),g.onreadystatechange=null,p.removeChild(g),g=null},p.appendChild(g)}}function v(){i=function(p){setTimeout(u,0,p)}}return typeof process<"u"&&{}.toString.call(process)==="[object process]"?l():c()?d():typeof MessageChannel<"u"?f():r&&"onreadystatechange"in r.createElement("script")?h():v(),{setImmediate:a,clearImmediate:o}}var cD=function(){return typeof setImmediate<"u"?typeof window<"u"?{setImmediate:function(e){for(var t,r=[],n=1;n<arguments.length;n++)r[n-1]=arguments[n];return(t=window).setImmediate.apply(t,Nt([e],r))},clearImmediate:function(e){return window.clearImmediate(e)}}:{setImmediate,clearImmediate}:jRe()}();function zRe(e){cD.setImmediate(e)}var I6={setImmediate:cD.setImmediate,clearImmediate:cD.clearImmediate,immediatePromise:function(){return new Promise(zRe)},delay:function(e,t){return t===void 0&&(t=void 0),new Promise(function(r){return setTimeout(r,e,t)})}},j0=function(){try{return!0}catch{return!1}}(),Lr=function(){try{var t={}.DEBUG;return t==="*"||t==="molstar"}catch{return!1}}(),VRe=typeof performance<"u"&&performance.mark&&performance.measure,OP=VRe&&!j0,B1;(function(e){function t(o){return"startTask"+o.id}function r(o){return"endTask"+o.id}function n(o){OP&&performance.mark(t(o))}e.markStart=n;function i(o){OP&&performance.mark(r(o))}e.markEnd=i;function a(o){OP&&performance.measure(" "+o.name,t(o),r(o))}e.measure=a})(B1||(B1={}));function HRe(e,t,r){r===void 0&&(r=250);var n=HZ(e,t,r),i=new YZ(n,n.root);return M6(e,i)}function GRe(e,t,r){r===void 0&&(r=250);var n=HZ(e,t,r);return new YZ(n,n.root)}function zZ(e,t){return M6(t,e)}function qRe(e,t,r){return e.runChild(t,r)}function VZ(e){return{taskId:e.id,taskName:e.name,message:"",startedTime:0,canAbort:!0,isIndeterminate:!0,current:0,max:0}}function HZ(e,t,r){var n={abortRequested:!1,treeAborted:!1,reason:""};return{updateRateMs:r,lastNotified:Ln(),observer:t,abortToken:n,taskId:e.id,root:{progress:VZ(e),children:[]},tryAbort:$Re(n)}}function $Re(e){return function(t){e.abortRequested=!0,e.reason=t||e.reason}}function GZ(e){return{progress:E({},e.progress),children:e.children.map(GZ)}}function qZ(e){return e.progress.canAbort&&e.children.every(qZ)}function WRe(e){return{root:GZ(e.root),canAbort:qZ(e.root),requestAbort:e.tryAbort}}function M6(e,t){return ce(this,void 0,void 0,function(){var r,n;return de(this,function(i){switch(i.label){case 0:B1.markStart(e),t.node.progress.startedTime=Ln(),i.label=1;case 1:return i.trys.push([1,3,,7]),[4,e.f(t)];case 2:return r=i.sent(),B1.markEnd(e),B1.measure(e),t.info.abortToken.abortRequested&&$Z(t.info),[2,r];case 3:return n=i.sent(),$e.isAbort(n)?(t.isAborted=!0,t.node.children.length>0?[4,new Promise(function(a){t.onChildrenFinished=a})]:[3,5]):[3,6];case 4:i.sent(),i.label=5;case 5:e.onAbort&&e.onAbort(),i.label=6;case 6:throw Lr&&console.error(n),n;case 7:return[2]}})})}function $Z(e){throw e.abortToken.treeAborted||(e.abortToken.treeAborted=!0,WZ(e.root),XZ(e,Ln())),$e.Aborted(e.abortToken.reason)}function WZ(e){var t=e.progress;t.isIndeterminate=!0,t.canAbort=!1,t.message="Aborting...";for(var r=0,n=e.children;r<n.length;r++){var i=n[r];WZ(i)}}function XZ(e,t){e.lastNotified=t;var r=WRe(e);e.observer(r)}var YZ=function(){function e(t,r){this.isSynchronous=!1,this.isExecuting=!0,this.lastUpdatedTime=0,this.onChildrenFinished=void 0,this.node=r,this.info=t}return e.prototype.checkAborted=function(){this.info.abortToken.abortRequested&&(this.isAborted=!0,$Z(this.info))},Object.defineProperty(e.prototype,"shouldUpdate",{get:function(){return this.checkAborted(),Ln()-this.lastUpdatedTime>this.info.updateRateMs},enumerable:!1,configurable:!0}),e.prototype.updateProgress=function(t){if(this.checkAborted(),!!t){var r=this.node.progress;typeof t=="string"?(r.message=t,r.isIndeterminate=!0):(typeof t.canAbort<"u"&&(r.canAbort=t.canAbort),typeof t.message<"u"&&(r.message=t.message),typeof t.current<"u"&&(r.current=t.current),typeof t.max<"u"&&(r.max=t.max),r.isIndeterminate=typeof r.current>"u"||typeof r.max>"u",typeof t.isIndeterminate<"u"&&(r.isIndeterminate=t.isIndeterminate))}},e.prototype.update=function(t,r){if(this.lastUpdatedTime=Ln(),this.updateProgress(t),!r)return XZ(this.info,this.lastUpdatedTime),this.checkAborted(),I6.immediatePromise()},e.prototype.runChild=function(t,r){return ce(this,void 0,void 0,function(){var n,i,a,o,s,u,l;return de(this,function(c){switch(c.label){case 0:this.updateProgress(r),n={progress:VZ(t),children:[]},i=this.node.children,i.push(n),a=new e(this.info,n),c.label=1;case 1:return c.trys.push([1,3,4,5]),[4,M6(t,a)];case 2:return[2,c.sent()];case 3:if(o=c.sent(),$e.isAbort(o)&&this.isAborted)return[2,void 0];throw o;case 4:if(s=i.indexOf(n),s>=0){for(u=s,l=i.length-1;u<l;u++)i[u]=i[u+1];i.pop()}return i.length===0&&this.onChildrenFinished&&this.onChildrenFinished(),[7];case 5:return[2]}})})},e}(),XRe=function(){function e(){this.shouldUpdate=!1,this.isSynchronous=!0}return e.prototype.update=function(t,r){},e}(),yC=new XRe,$e;(function(e){var t=function(){function d(f,h,v){this.name=f,this.f=h,this.onAbort=v,this.id=c()}return d.prototype.run=function(f,h){return h===void 0&&(h=250),f?HRe(this,f,h):this.f(yC)},d.prototype.runAsChild=function(f,h){return f.isSynchronous?this.f(yC):qRe(f,this,h)},d.prototype.runInContext=function(f){return f.isSynchronous?this.f(yC):zZ(f,this)},d}();function r(d){var f=d;return!!d&&typeof f.id=="number"&&typeof f.name=="string"&&!!f.run}e.is=r;function n(d){return!!d&&!!d.isAborted}e.isAbort=n;function i(d){return{isAborted:!0,reason:d,toString:function(){return"Aborted"+(d?": "+d:"")}}}e.Aborted=i;function a(d,f,h){return new t(d,f,h)}e.create=a;function o(d,f){var h=this;return a(d,function(v){return ce(h,void 0,void 0,function(){return de(this,function(p){return[2,f]})})})}e.constant=o;function s(){var d=this;return a("",function(f){return ce(d,void 0,void 0,function(){return de(this,function(h){return[2]})})})}e.empty=s;function u(d,f){var h=this;return a(d,function(v){return ce(h,void 0,void 0,function(){return de(this,function(p){throw new Error(f)})})})}e.fail=u;function l(d,f){return r(d)?f?d.runInContext(f):d.run():d}e.resolveInContext=l;var c=Ka(0,1073741823)})($e||($e={}));var vU;(function(e){e.Synchronous=yC})(vU||(vU={}));var mU;(function(e){function t(n,i){i===void 0&&(i="");var a=n.progress;if(!n.children.length)return a.isIndeterminate?""+i+a.taskName+": "+a.message:""+i+a.taskName+": ["+a.current+"/"+a.max+"] "+a.message;var o=i+"  |_ ",s=n.children.map(function(u){return t(u,o)});return a.isIndeterminate?""+i+a.taskName+": "+a.message+`
`+s.join(`
`):""+i+a.taskName+": ["+a.current+"/"+a.max+"] "+a.message+`
`+s.join(`
`)}function r(n){return t(n.root)}e.format=r})(mU||(mU={}));function fd(e,t,r,n,i){return ce(this,void 0,void 0,function(){var a,o,s,u,l,c,d;return de(this,function(f){switch(f.label){case 0:if(a=Math.max(t,0),o=0,s=0,e.isSynchronous)return n(Number.MAX_SAFE_INTEGER,r),[2,r];u=Ln(),l=0,c=0,f.label=1;case 1:return(l=n(a,r))>0?(o+=l,d=Ln()-u,c+=d,s+=d,e.shouldUpdate?[4,i(e,r,o)]:[3,3]):[3,4];case 2:f.sent(),a=Math.round(c*o/s)+1,u=Ln(),c=0,f.label=3;case 3:return[3,1];case 4:return e.shouldUpdate?[4,i(e,r,o)]:[3,6];case 5:f.sent(),f.label=6;case 6:return[2,r]}})})}function YRe(e){return e>>0}function Xf(e,t){return e[t]|e[t+1]<<8}function Rp(e,t,r){e[t]=r&255,e[t+1]=r>>8&255}function kp(e,t){return e[t+3]*(256*256*256)+(e[t+2]<<16|e[t+1]<<8|e[t])}function Mc(e,t,r){e[t]=r&255,e[t+1]=r>>8&255,e[t+2]=r>>16&255,e[t+3]=r>>24&255}function KRe(e,t,r){for(var n="",i=0;i<r;i++)n+=String.fromCharCode(e[t+i]);return n}function QRe(e){return e.length<2?"0"+e:e}function ZRe(e,t,r){for(var n="",i,a=0;a<r;a++)n+="%"+QRe(e[t+a].toString(16));try{i=decodeURIComponent(n)}catch{return KRe(e,t,r)}return i}function JRe(e,t,r){for(var n=r.length,i=0,a=0;a<n;a++){var o=r.charCodeAt(a);if(!(o&4294967295-128+1))e[t+i]=o,i++;else if(!(o&4294967295-2048+1))e[t+i]=192|o>>6,e[t+i+1]=128|o>>0&63,i+=2;else if(!(o&4294967295-65536+1))e[t+i]=224|o>>12,e[t+i+1]=128|o>>6&63,e[t+i+2]=128|o>>0&63,i+=3;else if(!(o&4294967295-(1<<21)+1))e[t+i]=240|o>>18,e[t+i+1]=128|o>>12&63,e[t+i+2]=128|o>>6&63,e[t+i+3]=128|o>>0&63,i+=4;else throw"e"}return i}function KZ(e){for(var t=e.length,r=0,n=0;n<t;n++){var i=e.charCodeAt(n);if(!(i&4294967295-128+1))r++;else if(!(i&4294967295-2048+1))r+=2;else if(!(i&4294967295-65536+1))r+=3;else if(!(i&4294967295-(1<<21)+1))r+=4;else throw"e"}return r}var eke=function(){for(var e=new Uint32Array(256),t=0;t<256;t++){for(var r=t,n=0;n<8;n++)r&1?r=3988292384^r>>>1:r=r>>>1;e[t]=r}return e}();function tke(e,t,r,n){for(var i=0;i<n;i++)e=eke[(e^t[r+i])&255]^e>>>8;return e}function QZ(e,t,r){return tke(4294967295,e,t,r)^4294967295}var bt=function(){var e=Uint16Array,t=Uint32Array;return{next_code:new e(16),bl_count:new e(16),ordr:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],of0:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],exb:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],ldef:new e(32),df0:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],dxb:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],ddef:new t(32),flmap:new e(512),fltree:[],fdmap:new e(32),fdtree:[],lmap:new e(32768),ltree:[],ttree:[],dmap:new e(32768),dtree:[],imap:new e(512),itree:[],rev15:new e(32768),lhst:new t(286),dhst:new t(30),ihst:new t(19),lits:new t(15e3),strt:new e(65536),prev:new e(32768)}}();(function(){for(var e=32768,t=0;t<e;t++){var r=t;r=(r&2863311530)>>>1|(r&1431655765)<<1,r=(r&3435973836)>>>2|(r&858993459)<<2,r=(r&4042322160)>>>4|(r&252645135)<<4,r=(r&4278255360)>>>8|(r&16711935)<<8,bt.rev15[t]=(r>>>16|r<<16)>>>17}function n(i,a,o){for(;a--!==0;)i.push(0,o)}for(var t=0;t<32;t++)bt.ldef[t]=bt.of0[t]<<3|bt.exb[t],bt.ddef[t]=bt.df0[t]<<4|bt.dxb[t];n(bt.fltree,144,8),n(bt.fltree,255-143,9),n(bt.fltree,279-255,7),n(bt.fltree,287-279,8),mh(bt.fltree,9),U1(bt.fltree,9,bt.flmap),j1(bt.fltree,9),n(bt.fdtree,32,5),mh(bt.fdtree,5),U1(bt.fdtree,5,bt.fdmap),j1(bt.fdtree,5),n(bt.itree,19,0),n(bt.ltree,286,0),n(bt.dtree,30,0),n(bt.ttree,320,0)})();function U1(e,t,r){for(var n=e.length,i=bt.rev15,a=0;a<n;a+=2)if(e[a+1]!==0)for(var o=a>>1,s=e[a+1],u=o<<4|s,l=t-s,c=e[a]<<l,d=c+(1<<l);c!==d;){var f=i[c]>>>15-t;r[f]=u,c++}}function mh(e,t){for(var r=e.length,n=bt.bl_count,i=0;i<=t;i++)n[i]=0;for(var i=1;i<r;i+=2)n[e[i]]++;var a=bt.next_code,o=0;n[0]=0;for(var s=1;s<=t;s++)o=o+n[s-1]<<1,a[s]=o;for(var u=0;u<r;u+=2){var l=e[u+1];l!==0&&(e[u]=a[l],a[l]++)}}function j1(e,t){for(var r=bt.rev15,n=15-t,i=0;i<e.length;i+=2){var a=e[i]<<t-e[i+1];e[i]=r[a]>>>n}}function rke(e,t){var r=t===void 0;return t===void 0&&(t=new Uint8Array(e.length>>>2<<3)),{data:e,buf:t,noBuf:r,BFINAL:0,off:0,pos:0}}function nke(e,t){for(var r=e.data,n=e.noBuf,i=e.buf,a=e.BFINAL,o=e.off,s=e.pos,u=0;a===0&&u<t;){var l=void 0,c=void 0,d=0,f=0;a=LP(r,s,1),u+=1;var h=LP(r,s+1,2);if(s+=3,h===0){s&7&&(s+=8-(s&7));var v=(s>>>3)+4,p=r[v-4]|r[v-3]<<8;n&&(i=FP(i,o+p)),i.set(new Uint8Array(r.buffer,r.byteOffset+v,p),o),s=v+p<<3,o+=p;continue}if(n&&(i=FP(i,o+(1<<17))),h===1)l=bt.flmap,c=bt.fdmap,d=512-1,f=32-1;else if(h===2){var m=Nf(r,s,5)+257,g=Nf(r,s+5,5)+1,y=Nf(r,s+10,4)+4;s+=14;for(var b=0;b<38;b+=2)bt.itree[b]=0,bt.itree[b+1]=0;for(var S=1,b=0;b<y;b++){var x=Nf(r,s+b*3,3);bt.itree[(bt.ordr[b]<<1)+1]=x,x>S&&(S=x)}s+=3*y,mh(bt.itree,S),U1(bt.itree,S,bt.imap),l=bt.lmap,c=bt.dmap,s=ake(bt.imap,(1<<S)-1,m+g,r,s,bt.ttree);var C=gU(bt.ttree,0,m,bt.ltree);d=(1<<C)-1;var w=gU(bt.ttree,m,g,bt.dtree);f=(1<<w)-1,mh(bt.ltree,C),U1(bt.ltree,C,l),mh(bt.dtree,w),U1(bt.dtree,w,c)}else throw new Error("unknown BTYPE "+h);for(;;){var A=l[dD(r,s)&d];s+=A&15;var M=A>>>4;if(!(M>>>8))i[o++]=M;else{if(M===256)break;var D=o+M-254;if(M>264){var k=bt.ldef[M-257];D=o+(k>>>3)+Nf(r,s,k&7),s+=k&7}var R=c[dD(r,s)&f];s+=R&15;var O=R>>>4,H=bt.ddef[O],B=(H>>>4)+LP(r,s,H&15);for(s+=H&15,n&&(i=FP(i,o+(1<<17)));o<D;)i[o]=i[o++-B],i[o]=i[o++-B],i[o]=i[o++-B],i[o]=i[o++-B];o=D}}}e.buf=i,e.BFINAL=a,e.off=o,e.pos=s}function ike(e,t,r){return ce(this,void 0,void 0,function(){var n;return de(this,function(i){switch(i.label){case 0:if(t[0]===3&&t[1]===0)return[2,r||new Uint8Array(0)];n=rke(t,r),i.label=1;case 1:return n.BFINAL!==0?[3,4]:e.shouldUpdate?[4,e.update({message:"Inflating blocks...",current:n.pos,max:t.length})]:[3,3];case 2:i.sent(),i.label=3;case 3:return nke(n,100),[3,1];case 4:return[2,n.buf.length===n.off?n.buf:n.buf.slice(0,n.off)]}})})}function FP(e,t){var r=e.length;if(t<=r)return e;var n=new Uint8Array(Math.max(r<<1,t));return n.set(e,0),n}function ake(e,t,r,n,i,a){for(var o=0;o<r;){var s=e[dD(n,i)&t];i+=s&15;var u=s>>>4;if(u<=15)a[o]=u,o++;else{var l=0,c=0;u===16?(c=3+Nf(n,i,2),i+=2,l=a[o-1]):u===17?(c=3+Nf(n,i,3),i+=3):u===18&&(c=11+Nf(n,i,7),i+=7);for(var d=o+c;o<d;)a[o]=l,o++}}return i}function gU(e,t,r,n){for(var i=0,a=0,o=n.length>>>1;a<r;){var s=e[a+t];n[a<<1]=0,n[(a<<1)+1]=s,s>i&&(i=s),a++}for(;a<o;)n[a<<1]=0,n[(a<<1)+1]=0,a++;return i}function Nf(e,t,r){return(e[t>>>3]|e[(t>>>3)+1]<<8)>>>(t&7)&(1<<r)-1}function LP(e,t,r){return(e[t>>>3]|e[(t>>>3)+1]<<8|e[(t>>>3)+2]<<16)>>>(t&7)&(1<<r)-1}function dD(e,t){return(e[t>>>3]|e[(t>>>3)+1]<<8|e[(t>>>3)+2]<<16)>>>(t&7)}function NP(e,t,r){for(var n=[],i=e.length,a=t.length,o=0;o<a;o+=2)t[o]=0,t[o+1]=0;for(var o=0;o<i;o++)e[o]!==0&&n.push({lit:o,f:e[o],d:void 0});var s=n.length,u=n.slice(0);if(s===0)return 0;if(s===1){var l=n[0].lit,c=l===0?1:0;return t[(l<<1)+1]=1,t[(c<<1)+1]=1,1}n.sort(function(g,y){return g.f-y.f});var d=n[0],f=n[1],h=0,v=1,p=2;for(n[0]={lit:-1,f:d.f+f.f,l:d,r:f,d:0};v!==s-1;)h!==v&&(p===s||n[h].f<n[p].f)?d=n[h++]:d=n[p++],h!==v&&(p===s||n[h].f<n[p].f)?f=n[h++]:f=n[p++],n[v++]={lit:-1,f:d.f+f.f,l:d,r:f,d:void 0};var m=fD(n[v-1],0);m>r&&(oke(u,r,m),m=r);for(var o=0;o<s;o++)t[(u[o].lit<<1)+1]=u[o].d;return m}function fD(e,t){return e.lit!==-1?(e.d=t,t):Math.max(fD(e.l,t+1),fD(e.r,t+1))}function oke(e,t,r){var n=0,i=1<<r-t,a=0;for(e.sort(function(s,u){return u.d===s.d?s.f-u.f:u.d-s.d}),n=0;n<e.length&&e[n].d>t;n++){var o=e[n].d;e[n].d=t,a+=i-(1<<r-o)}for(a=a>>>r-t;a>0;){var o=e[n].d;o<t?(e[n].d++,a-=1<<t-o-1):n++}for(;n>=0;n--)e[n].d===t&&a<0&&(e[n].d--,a++);a!==0&&console.log("debt left")}function ske(e,t,r,n){var i=bt.lits,a=bt.strt,o=bt.prev;return{data:e,out:t,opt:lke[n],i:0,pos:r<<3,cvrd:0,dlen:e.length,li:0,lc:0,bs:0,ebits:0,c:0,nc:0,lits:i,strt:a,prev:o}}function uke(e,t){for(var r=e.data,n=e.dlen,i=e.out,a=e.opt,o=e.i,s=e.pos,u=e.cvrd,l=e.li,c=e.lc,d=e.bs,f=e.ebits,h=e.c,v=e.nc,p=bt.lits,m=bt.strt,g=bt.prev,y=Math.min(o+t,n);o<y;o++){if(h=v,o+1<n-2){v=D6(r,o+1);var b=o+1&32767;g[b]=m[v],m[v]=b}if(u<=o){(l>14e3||c>26697)&&n-o>100&&(u<o&&(p[l]=o-u,l+=2,u=o),s=ZZ(o===n-1||u===n?1:0,p,l,f,r,d,o-d,i,s),l=c=f=0,d=o);var S=0;if(o<n-2&&(S=dke(r,o,g,h,Math.min(a[2],n-o),a[3])),S!==0){var x=S>>>16,C=S&65535,w=xU(x,bt.of0);bt.lhst[257+w]++;var A=xU(C,bt.df0);bt.dhst[A]++,f+=bt.exb[w]+bt.dxb[A],p[l]=x<<23|o-u,p[l+1]=C<<16|w<<8|A,l+=2,u=o+x}else bt.lhst[r[o]]++;c++}}e.i=o,e.pos=s,e.cvrd=u,e.li=l,e.lc=c,e.bs=d,e.ebits=f,e.c=h,e.nc=v}var lke=[[0,0,0,0,0],[4,4,8,4,0],[4,5,16,8,0],[4,6,16,16,0],[4,10,16,32,0],[8,16,32,32,0],[8,16,128,128,0],[8,32,128,256,0],[32,128,258,1024,1],[32,258,258,4096,1]];function cke(e,t,r,n,i){return ce(this,void 0,void 0,function(){var a,o,s,u,l,c,d,f,h,v,p,m;return de(this,function(g){switch(g.label){case 0:if(a=ske(t,r,n,i),o=a.dlen,i===0){for(s=a.i,u=a.pos;s<o;)l=Math.min(65535,o-s),Op(r,u,s+l===o?1:0),u=JZ(t,s,l,r,u+8),s+=l;return[2,u>>>3]}o>2&&(a.nc=D6(t,0),a.strt[a.nc]=0),g.label=1;case 1:return a.i<o?e.shouldUpdate?[4,e.update({message:"Deflating...",current:a.i,max:o})]:[3,3]:[3,4];case 2:g.sent(),g.label=3;case 3:return uke(a,1024*1024),[3,1];case 4:for(c=a.li,d=a.cvrd,f=a.pos,h=a.i,v=a.lits,p=a.bs,m=a.ebits,(p!==h||t.length===0)&&(d<h&&(v[c]=h-d,c+=2,d=h),f=ZZ(1,v,c,m,t,p,h-p,r,f));f&7;)f++;return[2,f>>>3]}})})}function dke(e,t,r,n,i,a){var o=t&32767,s=r[o],u=o-s+32768&32767;if(s===o||n!==D6(e,t-u))return 0;for(var l=0,c=0,d=Math.min(32767,t);u<=d&&--a!==0&&s!==o;){if(l===0||e[t+l]===e[t+l-u]){var f=fke(e,t,u);if(f>l){if(l=f,c=u,l>=i)break;u+2<f&&(f=u+2);for(var h=0,v=0;v<f-2;v++){var p=t-u+v+32768&32767,m=r[p],g=p-m+32768&32767;g>h&&(h=g,s=p)}}}o=s,s=r[o],u+=o-s+32768&32767}return l<<16|c}function fke(e,t,r){if(e[t]!==e[t-r]||e[t+1]!==e[t+1-r]||e[t+2]!==e[t+2-r])return 0;var n=t,i=Math.min(e.length,t+258);for(t+=3;t<i&&e[t]===e[t-r];)t++;return t-n}function D6(e,t){return(e[t]<<8|e[t+1])+(e[t+2]<<4)&65535}function ZZ(e,t,r,n,i,a,o,s,u){bt.lhst[256]++;var l=hke(),c=l[0],d=l[1],f=l[2],h=l[3],v=l[4],p=l[5],m=l[6],g=l[7],y=(u+3&7?8-(u+3&7):0)+32+(o<<3),b=n+Py(bt.fltree,bt.lhst)+Py(bt.fdtree,bt.dhst),S=n+Py(bt.ltree,bt.lhst)+Py(bt.dtree,bt.dhst);S+=14+3*p+Py(bt.itree,bt.ihst)+(bt.ihst[16]*2+bt.ihst[17]*3+bt.ihst[18]*7);for(var x=0;x<286;x++)bt.lhst[x]=0;for(var x=0;x<30;x++)bt.dhst[x]=0;for(var x=0;x<19;x++)bt.ihst[x]=0;var C=y<b&&y<S?0:b<S?1:2;if(bC(s,u,e),bC(s,u+1,C),u+=3,C===0){for(;u&7;)u++;u=JZ(i,a,o,s,u)}else{var w=void 0,A=void 0;if(C===1)w=bt.fltree,A=bt.fdtree;else if(C===2){mh(bt.ltree,c),j1(bt.ltree,c),mh(bt.dtree,d),j1(bt.dtree,d),mh(bt.itree,f),j1(bt.itree,f),w=bt.ltree,A=bt.dtree,Op(s,u,h-257),u+=5,Op(s,u,v-1),u+=5,Op(s,u,p-4),u+=4;for(var M=0;M<p;M++)Op(s,u+M*3,bt.itree[(bt.ordr[M]<<1)+1]);u+=3*p,u=yU(m,bt.itree,s,u),u=yU(g,bt.itree,s,u)}else throw new Error("unknown BTYPE "+C);for(var D=a,k=0;k<r;k+=2){for(var R=t[k],O=R>>>23,H=D+(R&(1<<23)-1);D<H;)u=f1(i[D++],w,s,u);if(O!==0){var B=t[k+1],j=B>>16,Y=B>>8&255,G=B&255;u=f1(257+Y,w,s,u),Op(s,u,O-bt.of0[Y]),u+=bt.exb[Y],u=f1(G,A,s,u),bC(s,u,j-bt.df0[G]),u+=bt.dxb[G],D+=O}}u=f1(256,w,s,u)}return u}function JZ(e,t,r,n,i){var a=i>>>3;return n[a]=r,n[a+1]=r>>>8,n[a+2]=255-n[a],n[a+3]=255-n[a+1],a+=4,n.set(new Uint8Array(e.buffer,t,r),a),i+(r+4<<3)}function hke(){for(var e=NP(bt.lhst,bt.ltree,15),t=NP(bt.dhst,bt.dtree,15),r=[],n=bU(bt.ltree,r),i=[],a=bU(bt.dtree,i),o=0;o<r.length;o+=2)bt.ihst[r[o]]++;for(var o=0;o<i.length;o+=2)bt.ihst[i[o]]++;for(var s=NP(bt.ihst,bt.itree,7),u=19;u>4&&bt.itree[(bt.ordr[u-1]<<1)+1]===0;)u--;return[e,t,s,n,a,u,r,i]}function Py(e,t){for(var r=0,n=0;n<t.length;n++)r+=t[n]*e[(n<<1)+1];return r}function yU(e,t,r,n){for(var i=0;i<e.length;i+=2){var a=e[i],o=e[i+1];n=f1(a,t,r,n);var s=a===16?2:a===17?3:7;a>15&&(Op(r,n,o),n+=s)}return n}function bU(e,t){for(var r=e.length;r!==2&&e[r-1]===0;)r-=2;for(var n=0;n<r;n+=2){var i=e[n+1],a=n+3<r?e[n+3]:-1,o=n+5<r?e[n+5]:-1,s=n===0?-1:e[n-1];if(i===0&&a===i&&o===i){for(var u=n+5;u+2<r&&e[u+2]===i;)u+=2;var l=Math.min(u+1-n>>>1,138);l<11?t.push(17,l-3):t.push(18,l-11),n+=l*2-2}else if(i===s&&a===i&&o===i){for(var u=n+5;u+2<r&&e[u+2]===i;)u+=2;var l=Math.min(u+1-n>>>1,6);t.push(16,l-3),n+=l*2-2}else t.push(i,0)}return r>>>1}function xU(e,t){var r=0;return t[r|16]<=e&&(r|=16),t[r|8]<=e&&(r|=8),t[r|4]<=e&&(r|=4),t[r|2]<=e&&(r|=2),t[r|1]<=e&&(r|=1),r}function f1(e,t,r,n){return bC(r,n,t[e<<1]),n+t[(e<<1)+1]}function Op(e,t,r){r=r<<(t&7);var n=t>>>3;e[n]|=r,e[n+1]|=r>>>8}function bC(e,t,r){r=r<<(t&7);var n=t>>>3;e[n]|=r,e[n+1]|=r>>>8,e[n+2]|=r>>>16}function eJ(e,t,r){return r===void 0&&(r=!1),ce(this,void 0,void 0,function(){var n,i,a,o,s,u,l,c,d,f,h,v,p;return de(this,function(m){switch(m.label){case 0:for(n=Object.create(null),i=new Uint8Array(t),a=i.length-4;kp(i,a)!==101010256;)a--;o=a,o+=4,o+=4,s=Xf(i,o),o+=2,o+=2,o+=4,u=kp(i,o),o+=4,o=u,l=0,m.label=1;case 1:return l<s?(o+=4,o+=4,o+=4,o+=4,o+=4,c=kp(i,o),o+=4,d=kp(i,o),o+=4,f=Xf(i,o),h=Xf(i,o+2),v=Xf(i,o+4),o+=6,o+=8,p=kp(i,o),o+=4,o+=f+h+v,[4,pke(e,i,p,n,c,d,r)]):[3,4];case 2:m.sent(),m.label=3;case 3:return l++,[3,1];case 4:return[2,n]}})})}function pke(e,t,r,n,i,a,o){return ce(this,void 0,void 0,function(){var s,u,l,c,d,f;return de(this,function(h){switch(h.label){case 0:return r+=4,r+=2,r+=2,s=Xf(t,r),r+=2,r+=4,r+=4,r+=8,u=Xf(t,r),r+=2,l=Xf(t,r),r+=2,c=ZRe(t,r,u),r+=u,r+=l,o?(n[c]={size:a,csize:i},[2]):(d=new Uint8Array(t.buffer,r),s!==0?[3,1]:(n[c]=new Uint8Array(d.buffer.slice(r,r+i)),[3,4]));case 1:return s!==8?[3,3]:(f=new Uint8Array(a),[4,tJ(e,d,f)]);case 2:return h.sent(),n[c]=f,[3,4];case 3:throw"unknown compression method: "+s;case 4:return[2]}})})}function tJ(e,t,r){return ce(this,void 0,void 0,function(){return de(this,function(n){return[2,ike(e,t,r)]})})}function vke(e,t,r){return ce(this,void 0,void 0,function(){var n,i,a,o,o,s,u,l,c,d;return de(this,function(f){switch(f.label){case 0:if(n=t[3],i=10,n&4&&(a=Xf(t,i),i+=a),n&8){for(o=i;t[o]!==0;)++o;i=o+1}if(n&16){for(o=i;t[o]!==0;)++o;i=o+1}return n&1&&(i+=2),s=YRe(kp(t,t.length-8)),u=kp(t,t.length-4),r===void 0&&(r=new Uint8Array(u)),l=new Uint8Array(t.buffer,t.byteOffset+i,t.length-i-8),[4,tJ(e,l,r)];case 1:return c=f.sent(),d=QZ(c,0,c.length),s!==d&&console.error("ungzip: checksums don't match"),[2,c]}})})}function mke(e,t,r){return ce(this,void 0,void 0,function(){var n,i;return de(this,function(a){switch(a.label){case 0:return r===void 0&&(r={level:6}),n=new Uint8Array(50+Math.floor(t.length*1.1)),[4,cke(e,t,n,0,r.level)];case 1:return i=a.sent(),[2,new Uint8Array(n.buffer,0,i)]}})})}function gke(e,t){return t===void 0&&(t=!1),$e.create("Zip",function(r){return yke(r,e,t)})}function yke(e,t,r){return r===void 0&&(r=!1),ce(this,void 0,void 0,function(){var n,i,a,o,s,b,u,l,c,d,f,h,b,v,p,m,b,S,g,y,b,S,x,C;return de(this,function(w){switch(w.label){case 0:n=0,i={},a=[];for(o in t)a.push(o);s=0,w.label=1;case 1:return s<a.length?(b=a[s],u=!bke(b)&&!r,l=t[b],c=QZ(l,0,l.length),d=i,f=b,C={cpr:u,usize:l.length,crc:c},u?[4,mke(e,l)]:[3,3]):[3,6];case 2:return h=w.sent(),[3,4];case 3:h=l,w.label=4;case 4:d[f]=(C.file=h,C),w.label=5;case 5:return s++,[3,1];case 6:for(b in i)n+=i[b].file.length+30+46+2*KZ(b);n+=22,v=new Uint8Array(n),p=0,m=[];for(b in i)S=i[b],m.push(p),p=SU(v,p,b,S,0);g=0,y=p;for(b in i)S=i[b],m.push(p),p=SU(v,p,b,S,1,m[g++]);return x=p-y,Mc(v,p,101010256),p+=4,p+=4,Rp(v,p,g),p+=2,Rp(v,p,g),p+=2,Mc(v,p,x),p+=4,Mc(v,p,y),p+=4,p+=2,[2,v.buffer]}})})}function bke(e){var t=e.split(".").pop().toLowerCase();return"png,jpg,jpeg,zip".indexOf(t)!==-1}function SU(e,t,r,n,i,a){a===void 0&&(a=0);var o=n.file;Mc(e,t,i===0?67324752:33639248),t+=4,i===1&&(t+=2),Rp(e,t,20),t+=2,Rp(e,t,0),t+=2,Rp(e,t,n.cpr?8:0),t+=2,Mc(e,t,0),t+=4,Mc(e,t,n.crc),t+=4,Mc(e,t,o.length),t+=4,Mc(e,t,n.usize),t+=4,Rp(e,t,KZ(r)),t+=2,Rp(e,t,0),t+=2,i===1&&(t+=2,t+=2,t+=6,Mc(e,t,a),t+=4);var s=JRe(e,t,r);return t+=s,i===0&&(e.set(o,t),t+=o.length),t}function hg(e,t,r){for(var n=0,i=r.length;n<i;n++){var a=r.charCodeAt(n);if(a<128){e[t++]=a>>>0&127|0;continue}if(a<2048){e[t++]=a>>>6&31|192,e[t++]=a>>>0&63|128;continue}if(a<65536){e[t++]=a>>>12&15|224,e[t++]=a>>>6&63|128,e[t++]=a>>>0&63|128;continue}if(a<1114112){e[t++]=a>>>18&7|240,e[t++]=a>>>12&63|128,e[t++]=a>>>6&63|128,e[t++]=a>>>0&63|128;continue}throw new Error("bad codepoint "+a)}}var xke=function(){for(var e=[],t=0;t<1024;t++)e[t]=String.fromCharCode(t);return e}();function rJ(e){throw new Error(e)}function Ske(e,t,r){for(var n=xke,i=void 0,a=[],o=512,s=0,u=t,l=t+r;u<l;u++){var c=e[u];c&128?(c&224)===192?a[s++]=n[(c&15)<<6|e[++u]&63]:(c&240)===224?a[s++]=String.fromCharCode((c&15)<<12|(e[++u]&63)<<6|(e[++u]&63)<<0):(c&248)===240?a[s++]=String.fromCharCode((c&7)<<18|(e[++u]&63)<<12|(e[++u]&63)<<6|(e[++u]&63)<<0):rJ("Invalid byte "+c.toString(16)):a[s++]=n[c],s===o&&(i=i||[],i[i.length]=a.join(""),s=0)}return i?(s>0&&(i[i.length]=a.slice(0,s).join("")),i.join("")):a.slice(0,s).join("")}var CU=typeof TextDecoder<"u"?new TextDecoder:void 0;function R6(e,t,r){if(CU){var n=t||r!==e.length?e.subarray(t,t+r):e;return CU.decode(n)}else return Ske(e,t,r)}function rw(e){for(var t=0,r=0,n=e.length;r<n;r++){var i=e.charCodeAt(r);if(i<128){t+=1;continue}if(i<2048){t+=2;continue}if(i<65536){t+=3;continue}if(i<1114112){t+=4;continue}rJ("bad codepoint "+i)}return t}var Cke=typeof document>"u"?require("xhr2"):XMLHttpRequest,Fu;(function(e){e[e.None=0]="None",e[e.Gzip=1]="Gzip",e[e.Zip=2]="Zip"})(Fu||(Fu={}));function Yf(e,t){return Pke(e,t)}function hD(e){return typeof e=="string"?wU(e,e,"string"):wU(e.title,e.url,e.type||"string",e.body,e.headers)}function _ke(e){if(e instanceof FileReader)return e.readyState===FileReader.DONE;if(e instanceof XMLHttpRequest)return e.readyState===XMLHttpRequest.DONE;throw new Error("unknown data type")}function _U(e){return e?"Failed to download data. Possible reasons: Resource is not available, or CORS is not allowed on the server.":"Failed to open file."}function nJ(e,t,r){return new Promise(function(n,i){if(_ke(r)){var a=r.error;a!=null?i(a??_U(r instanceof XMLHttpRequest)):n(r);return}var o=!1;r.onerror=function(s){if(!o){var u=s.target.error;i(u??_U(r instanceof XMLHttpRequest))}},r.onprogress=function(s){if(!(!e.shouldUpdate||o))try{s.lengthComputable?e.update({message:t,isIndeterminate:!1,current:s.loaded,max:s.total}):e.update({message:t+" "+(s.loaded/1024/1024).toFixed(2)+" MB",isIndeterminate:!0})}catch(u){o=!0,i(u)}},r.onload=function(s){n(r)}})}function wke(e){return/\.gz$/i.test(e)?Fu.Gzip:/\.zip$/i.test(e)?Fu.Zip:Fu.None}function Eke(e,t,r){return ce(this,void 0,void 0,function(){var n,i,a;return de(this,function(o){switch(o.label){case 0:switch(n=r,n){case Fu.None:return[3,1];case Fu.Gzip:return[3,2];case Fu.Zip:return[3,3]}return[3,5];case 1:return[2,t];case 2:return[2,vke(e,t)];case 3:return[4,eJ(e,t.buffer)];case 4:if(i=o.sent(),a=Object.keys(i),a.length!==1)throw new Error("can only decompress zip files with a single entry");return[2,i[a[0]]];case 5:return[2]}})})}function Ake(e,t,r,n){return ce(this,void 0,void 0,function(){var i,a,o,s;return de(this,function(u){switch(u.label){case 0:if(i=t.result,a=i instanceof ArrayBuffer?new Uint8Array(i):i,a===null)throw new Error("no data given");if(n===Fu.None)return[3,4];if(!(a instanceof Uint8Array))throw new Error("need Uint8Array for decompression");return[4,Eke(e,a,n)];case 1:return o=u.sent(),r!=="string"?[3,3]:[4,e.update({message:"Decoding text..."})];case 2:return u.sent(),a=R6(o,0,o.length),[3,4];case 3:a=o,u.label=4;case 4:return r==="binary"&&a instanceof Uint8Array?[2,a]:[3,5];case 5:return r==="zip"&&a instanceof Uint8Array?[4,eJ(e,a.buffer)]:[3,7];case 6:return[2,u.sent()];case 7:if(r==="string"&&typeof a=="string")return[2,a];if(r==="xml"&&typeof a=="string")return s=new DOMParser,[2,s.parseFromString(a,"application/xml")];if(r==="json"&&typeof a=="string")return[2,JSON.parse(a)];u.label=8;case 8:throw new Error("could not get requested response data '"+r+"'")}})})}function Pke(e,t){var r=this,n=void 0;return $e.create("Read File",function(i){return ce(r,void 0,void 0,function(){var a,o;return de(this,function(s){switch(s.label){case 0:return s.trys.push([0,,5,6]),n=new FileReader,a=t==="zip"?Fu.None:wke(e.name),t==="binary"||t==="zip"||a!==Fu.None?n.readAsArrayBuffer(e):n.readAsText(e),[4,i.update({message:"Opening file...",canAbort:!0})];case 1:return s.sent(),[4,nJ(i,"Reading...",n)];case 2:return o=s.sent(),[4,i.update({message:"Processing file...",canAbort:!1})];case 3:return s.sent(),[4,Ake(i,o,t,a)];case 4:return[2,s.sent()];case 5:return n=void 0,[7];case 6:return[2]}})})},function(){n&&n.abort()})}var pD=function(){function e(){}return e.get=function(){return this.pool.length?this.pool.pop():new Cke},e.emptyFunc=function(){},e.deposit=function(t){this.pool.length<this.poolSize&&(t.onabort=e.emptyFunc,t.onerror=e.emptyFunc,t.onload=e.emptyFunc,t.onprogress=e.emptyFunc,this.pool.push(t))},e.pool=[],e.poolSize=15,e}();function Tke(e,t){if(e.status>=200&&e.status<400){var r=e.response;if(pD.deposit(e),(t==="binary"||t==="zip")&&r instanceof ArrayBuffer)return new Uint8Array(r);if(t==="string"&&typeof r=="string")return r;if(t==="xml"&&r instanceof XMLDocument)return r;if(t==="json"&&typeof r=="object")return r;throw new Error("could not get requested response data '"+t+"'")}else throw pD.deposit(e),new Error("Download failed with status code "+e.status)}function Ike(e){switch(e){case"json":return"json";case"xml":return"document";case"string":return"text";case"binary":return"arraybuffer";case"zip":return"arraybuffer"}}function wU(e,t,r,n,i){var a=this,o=void 0;return $e.create(e||"Download",function(s){return ce(a,void 0,void 0,function(){var u,l,c,d,f,h,v;return de(this,function(p){switch(p.label){case 0:if(o=pD.get(),o.open(n?"post":"get",t,!0),i)for(u=0,l=i;u<l.length;u++)c=l[u],d=c[0],f=c[1],o.setRequestHeader(d,f);return o.responseType=Ike(r),o.send(n),[4,s.update({message:"Waiting for server...",canAbort:!0})];case 1:return p.sent(),[4,nJ(s,"Downloading...",o)];case 2:return h=p.sent(),o=void 0,[4,s.update({message:"Parsing response...",canAbort:!1})];case 3:return p.sent(),v=Tke(h,r),[2,v]}})})},function(){o&&(o.abort(),o=void 0)})}function Mke(e,t,r,n){return ce(this,void 0,void 0,function(){var i,a,o,s,u,l,v,c,d,f,h,v,p;return de(this,function(m){switch(m.label){case 0:return i=r.length,a=new Array(r.length),[4,e.update({message:"Downloading...",current:0,max:i})];case 1:for(m.sent(),o=[],s=[],u=0,l=Math.min(i,n);u<l;u++)v=r[u],o.push(AU(u,v.id,t.resolve(Mn.getUrlAsset(t,v.url),v.isBinary?"binary":"string").runAsChild(e))),s.push(u);c=0,m.label=2;case 2:return o.length>0?[4,Promise.race(o)]:[3,6];case 3:if(d=m.sent(),f=r[d.index],h=s.indexOf(d.index),c++,d.kind==="error"&&!f.canFail)throw new Error(f.url+": "+d.error);return e.shouldUpdate?[4,e.update({message:"Downloading...",current:c,max:i})]:[3,5];case 4:m.sent(),m.label=5;case 5:return a[d.index]=d,o=o.filter(EU,h),s=s.filter(EU,h),u<i&&(v=r[u],p=t.resolve(Mn.getUrlAsset(t,v.url),v.isBinary?"binary":"string").runAsChild(e),o.push(AU(u,v.id,p)),s.push(u),u++),[3,2];case 6:return[2,a]}})})}function EU(e,t){return this!==t}function AU(e,t,r){return ce(this,void 0,void 0,function(){var n,i;return de(this,function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),[4,r];case 1:return n=a.sent(),[2,{kind:"ok",result:n,index:e,id:t}];case 2:return i=a.sent(),[2,{kind:"error",error:i,index:e,id:t}];case 3:return[2]}})})}var Mn;(function(e){function t(u,l){return E({kind:"url",id:bn.create22(),url:u},l)}e.Url=t;function r(u){return{kind:"file",id:bn.create22(),name:u.name,file:u}}e.File=r;function n(u){return(u==null?void 0:u.kind)==="url"}e.isUrl=n;function i(u){return(u==null?void 0:u.kind)==="file"}e.isFile=i;function a(u,l,c){return{data:u,dispose:function(){c.release(l)}}}e.Wrapper=a;function o(u){return typeof u=="string"?u:u.url}e.getUrl=o;function s(u,l,c){if(typeof l=="string"){var d=u.tryFindUrl(l,c);return d||t(l,{body:c})}return l}e.getUrlAsset=s})(Mn||(Mn={}));var Dke=function(){function e(){this._assets=new Map}return Object.defineProperty(e.prototype,"assets",{get:function(){return w6(this._assets.values())},enumerable:!1,configurable:!0}),e.prototype.tryFindUrl=function(t,r){for(var n=this.assets.values();;){var i=n.next();if(i.done)return;var a=i.value.asset;if(Mn.isUrl(a)&&a.url===t&&(a.body||"")===(r||""))return a}},e.prototype.set=function(t,r){this._assets.set(t.id,{asset:t,file:r,refCount:0})},e.prototype.resolve=function(t,r,n){var i=this;return n===void 0&&(n=!0),Mn.isUrl(t)?$e.create("Download "+(t.title||t.url),function(a){return ce(i,void 0,void 0,function(){var o,s,u,l,c,d,f,h,v;return de(this,function(p){switch(p.label){case 0:return this._assets.has(t.id)?(o=this._assets.get(t.id),o.refCount++,u=(s=Mn).Wrapper,[4,Yf(o.file,r).runInContext(a)]):[3,2];case 1:return[2,u.apply(s,[p.sent(),t,this])];case 2:return n?[3,4]:(c=(l=Mn).Wrapper,[4,hD(E(E({},t),{type:r})).runInContext(a)]);case 3:return[2,c.apply(l,[p.sent(),t,this])];case 4:return[4,hD(E(E({},t),{type:"binary"})).runInContext(a)];case 5:return d=p.sent(),f=new File([d],"raw-data"),this._assets.set(t.id,{asset:t,file:f,refCount:1}),v=(h=Mn).Wrapper,[4,Yf(f,r).runInContext(a)];case 6:return[2,v.apply(h,[p.sent(),t,this])]}})})}):$e.create("Read "+t.name,function(a){return ce(i,void 0,void 0,function(){var o,s,u,l,c;return de(this,function(d){switch(d.label){case 0:return this._assets.has(t.id)?(o=this._assets.get(t.id),o.refCount++,u=(s=Mn).Wrapper,[4,Yf(o.file,r).runInContext(a)]):[3,2];case 1:return[2,u.apply(s,[d.sent(),t,this])];case 2:if(!(t.file instanceof File))throw new Error("Cannot resolve file asset '"+t.name+"' ("+t.id+")");return n&&this._assets.set(t.id,{asset:t,file:t.file,refCount:1}),c=(l=Mn).Wrapper,[4,Yf(t.file,r).runInContext(a)];case 3:return[2,c.apply(l,[d.sent(),t,this])]}})})})},e.prototype.release=function(t){var r=this._assets.get(t.id);r&&(r.refCount--,r.refCount<=0&&this._assets.delete(t.id))},e}(),I;(function(e){e.Essential={isEssential:!0};function t(ie,oe){return oe&&(oe.label&&(ie.label=oe.label),oe.description&&(ie.description=oe.description),oe.legend&&(ie.legend=oe.legend),oe.fieldLabels&&(ie.fieldLabels=oe.fieldLabels),oe.isHidden&&(ie.isHidden=oe.isHidden),oe.shortLabel&&(ie.shortLabel=oe.shortLabel),oe.twoColumns&&(ie.twoColumns=oe.twoColumns),oe.isEssential&&(ie.isEssential=oe.isEssential),oe.category&&(ie.category=oe.category),oe.hideIf&&(ie.hideIf=oe.hideIf),oe.help&&(ie.help=oe.help)),ie}function r(ie){var oe=E({},ie);return oe.isOptional=!0,oe}e.Optional=r;function n(ie,oe){return t({type:"value",defaultValue:ie},oe)}e.Value=n;function i(ie,oe,F){return t({type:"select",defaultValue:Se(ie,oe),options:oe,cycle:F==null?void 0:F.cycle},F)}e.Select=i;function a(ie,oe,F){var V=t({type:"multi-select",defaultValue:ie,options:oe},F);return F!=null&&F.emptyValue&&(V.emptyValue=F.emptyValue),V}e.MultiSelect=a;function o(ie,oe){return t({type:"boolean",defaultValue:ie},oe)}e.Boolean=o;function s(ie,oe){return ie===void 0&&(ie=""),t({type:"text",defaultValue:ie},oe)}e.Text=s;function u(ie,oe){var F=t({type:"color",defaultValue:ie},oe);return oe!=null&&oe.isExpanded&&(F.isExpanded=oe.isExpanded),F}e.Color=u;function l(ie,oe){var F;if(typeof ie=="string"){var V=Ks(ie);F={kind:V.type!=="qualitative"?"interpolate":"set",colors:V.list}}else F=ie;return t({type:"color-list",presetKind:(oe==null?void 0:oe.presetKind)||"all",defaultValue:F,offsets:!!(oe!=null&&oe.offsets)},oe)}e.ColorList=l;function c(ie,oe,F){return t(p({type:"vec3",defaultValue:ie},oe),F)}e.Vec3=c;function d(ie,oe){return t({type:"mat4",defaultValue:ie},oe)}e.Mat4=d;function f(ie,oe){var F=typeof ie=="string"?Mn.Url(ie):Mn.Url(ie.url,{body:ie.body}),V=t({type:"url",defaultValue:F},oe);return V}e.Url=f;function h(ie){var oe=t({type:"file",defaultValue:null},ie);return ie!=null&&ie.accept&&(oe.accept=ie.accept),oe}e.File=h;function v(ie){var oe=t({type:"file-list",defaultValue:null},ie);return ie!=null&&ie.accept&&(oe.accept=ie.accept),oe}e.FileList=v;function p(ie,oe){return oe&&(typeof oe.min<"u"&&(ie.min=oe.min),typeof oe.max<"u"&&(ie.max=oe.max),typeof oe.step<"u"&&(ie.step=oe.step)),ie}function m(ie,oe,F){var V=t(p({type:"number",defaultValue:ie},oe),F);return F!=null&&F.immediateUpdate&&(V.immediateUpdate=!0),V}e.Numeric=m;function g(ie,oe,F){return t(p({type:"interval",defaultValue:ie},oe),F)}e.Interval=g;function y(ie,oe){return t({type:"line-graph",defaultValue:ie},oe)}e.LineGraph=y;function b(ie,oe){var F=t({type:"group",defaultValue:(oe==null?void 0:oe.customDefault)||j(ie),params:ie},oe);return oe!=null&&oe.isExpanded&&(F.isExpanded=oe.isExpanded),oe!=null&&oe.isFlat&&(F.isFlat=oe.isFlat),oe!=null&&oe.pivot&&(F.pivot=oe.pivot),F}e.Group=b;function S(ie){return b({},ie)}e.EmptyGroup=S;function x(ie,oe,F,V){var pe=Se(ie,oe);return t({type:"mapped",defaultValue:{name:pe,params:F(pe).defaultValue},select:i(pe,oe,V),map:F},V)}e.Mapped=x;function C(ie,oe,F){var V=F!=null&&F.options?F.options:Object.keys(oe).map(function(we){return[we,oe[we].label||is(we)]}),pe=Se(ie,V);return t({type:"mapped",defaultValue:{name:pe,params:oe[pe].defaultValue},select:i(pe,V,F),map:function(we){return oe[we]}},F)}e.MappedStatic=C;function w(ie,oe,F){return t({type:"object-list",element:ie,getLabel:oe,ctor:A,defaultValue:(F==null?void 0:F.defaultValue)||[]},F)}e.ObjectList=w;function A(){return j(this.element)}function M(){throw new Error("getValue not set. Fix runtime.")}function D(ie,oe,F){var V;return t({type:"value-ref",defaultValue:{ref:(V=F==null?void 0:F.defaultRef)!==null&&V!==void 0?V:"",getValue:M},getOptions:ie,resolveRef:oe},F)}e.ValueRef=D;function k(ie){var oe;return t({type:"data-ref",defaultValue:{ref:(oe=ie==null?void 0:ie.defaultRef)!==null&&oe!==void 0?oe:"",getValue:M}},ie)}e.DataRef=k;function R(ie,oe,F){return{type:"converted",defaultValue:oe(F.defaultValue),converted:F,fromValue:ie,toValue:oe}}e.Converted=R;function O(ie,oe,F,V,pe){var we=Object.keys(oe).map(function(Te){return[Te,Te]});return t({type:"conditioned",select:i(F(ie),we,pe),defaultValue:ie,conditionParams:oe,conditionForValue:F,conditionedValue:V},pe)}e.Conditioned=O;function H(ie,oe){return t({type:"script",defaultValue:ie},oe)}e.Script=H;function B(ie){return 0}e.For=B;function j(ie){for(var oe={},F=0,V=Object.keys(ie);F<V.length;F++){var pe=V[F];ie[pe].isOptional||(oe[pe]=ie[pe].defaultValue)}return oe}e.getDefaultValues=j;function Y(ie,oe){return function(){return ie(oe)}}function G(ie,oe,F){if(oe){if(ie.type==="value-ref"){var V=oe;V.ref?V.getValue=Y(ie.resolveRef,V.ref):V.getValue=function(){throw new Error("Unset ref in ValueRef value.")}}else if(ie.type==="data-ref"){var V=oe;V.ref?V.getValue=Y(F,V.ref):V.getValue=function(){throw new Error("Unset ref in ValueRef value.")}}else if(ie.type==="group")ee(ie.params,oe,F);else if(ie.type==="mapped"){var V=oe,pe=ie.map(V.name);G(pe,V.params,F)}else if(ie.type==="object-list"){if(!q(ie.element))return;for(var we=0,Te=oe;we<Te.length;we++){var ze=Te[we];ee(ie.element,ze,F)}}}}function $(ie){if(ie.type==="value-ref"||ie.type==="data-ref")return!0;if(ie.type==="group"){if(q(ie.params))return!0}else if(ie.type==="mapped")for(var oe=0,F=ie.select.options;oe<F.length;oe++){var V=F[oe][0];if($(ie.map(V)))return!0}else if(ie.type==="object-list")return q(ie.element);return!1}function q(ie){for(var oe=0,F=Object.keys(ie);oe<F.length;oe++){var V=F[oe];if($(ie[V]))return!0}return!1}function ee(ie,oe,F){for(var V=0,pe=Object.keys(ie);V<pe.length;V++){var we=pe[V];G(ie[we],oe==null?void 0:oe[we],F)}}e.resolveRefs=ee;function fe(ie,oe){for(var F=0,V=Object.keys(ie);F<V.length;F++){var pe=V[F];ie[pe].isOptional||(ie[pe].defaultValue=oe[pe])}}e.setDefaultValues=fe;function W(ie){return Ph(ie)}e.clone=W;function X(ie,oe){}e.validate=X;function U(ie,oe,F){if(oe===F)return!0;if(typeof oe!="object"||typeof F!="object")return!1;for(var V=0,pe=Object.keys(ie);V<pe.length;V++){var we=pe[V];if(!z(ie[we],oe[we],F[we]))return!1}return!0}e.areEqual=U;function z(ie,oe,F){if(oe===F)return!0;if(ie.type==="group")return U(ie.params,oe,F);if(ie.type==="mapped"){var V=oe,pe=F;if(V.name!==pe.name)return!1;var we=ie.map(V.name);return z(we,V.params,pe.params)}else if(ie.type==="multi-select"){var V=oe,pe=F;if(V.length!==pe.length)return!1;if(V.length<10){for(var Te=0,ze=V.length;Te<ze;Te++)if(V[Te]!==pe[Te]&&pe.indexOf(V[Te])<0)return!1}else for(var Ve=new Set(pe),Te=0,ze=V.length;Te<ze;Te++)if(V[Te]!==pe[Te]&&!Ve.has(V[Te]))return!1;return!0}else{if(ie.type==="interval")return oe[0]===F[0]&&oe[1]===F[1];if(ie.type==="line-graph"){var V=oe,pe=F;if(V.length!==pe.length)return!1;for(var Te=0,ze=V.length;Te<ze;Te++)if(!He.areEqual(V[Te],pe[Te]))return!1;return!0}else{if(ie.type==="vec3")return _.equals(oe,F);if(ie.type==="mat4")return ue.areEqual(oe,F,_n);if(ie.type==="script"){var V=oe,pe=F;return V.language===pe.language&&V.expression===pe.expression}else if(ie.type==="object-list"){var V=oe,pe=F,Xe=V.length;if(Xe!==pe.length)return!1;for(var Te=0;Te<Xe;Te++)if(!U(ie.element,V[Te],pe[Te]))return!1;return!0}else if(typeof oe=="object"&&typeof F=="object")return c0(oe,F)}}return!1}e.isParamEqual=z;function J(ie,oe,F){if(oe===void 0)return E({},F);if(F===void 0)return E({},oe);for(var V=Object.create(null),pe=0,we=Object.keys(ie);pe<we.length;pe++){var Te=we[pe];V[Te]=K(ie[Te],oe[Te],F[Te])}return V}e.merge=J;function K(ie,oe,F){if(oe===void 0)return typeof F=="object"&&!Array.isArray(F)?E({},F):F;if(F===void 0)return typeof oe=="object"&&!Array.isArray(oe)?E({},oe):oe;if(ie.type==="group")return J(ie.params,oe,F);if(ie.type==="mapped"){var V=oe,pe=F;if(V.name!==pe.name)return E({},pe);var we=ie.map(pe.name);return{name:pe.name,params:K(we,V.params,pe.params)}}else return ie.type==="value"?F:typeof oe=="object"&&typeof F=="object"?Array.isArray(F)?F:E(E({},oe),F):F}e.mergeParam=K;function Z(ie,oe){for(var F=0,V=ie.options;F<V.length;F++){var pe=V[F];if(pe[0]===oe)return!0}return!1}function te(ie,oe,F){if(oe==null)return F?ie.defaultValue:void 0;if(ie.type==="value")return oe;if(ie.type==="group"){for(var V=Object.create(null),pe=0,we=Object.keys(ie.params);pe<we.length;pe++){var Te=we[pe],ze=ie.params[Te];oe[Te]===void 0?F&&(V[Te]=ze.defaultValue):V[Te]=te(ze,oe[Te],F)}return V}else if(ie.type==="mapped"){var Ve=oe;if(typeof Ve.name!="string")return ie.defaultValue;if(typeof Ve.params>"u")return F?ie.defaultValue:void 0;if(!Z(ie.select,Ve.name))return ie.defaultValue;var ze=ie.map(Ve.name);return{name:Ve.name,params:te(ze,Ve.params,F)}}else{if(ie.type==="select")return Z(ie,oe)?oe:ie.defaultValue;if(ie.type==="multi-select"){if(!Array.isArray(oe))return ie.defaultValue;var V=oe.filter(function(ct){return Z(this,ct)},ie);return oe.length>0&&V.length===0?ie.defaultValue:V}else if(ie.type==="object-list")return Array.isArray(oe)?oe.map(function(Xe){return le(ie.element,Xe,F?"all":"skip")}):ie.defaultValue}return oe}function le(ie,oe,F){if(typeof oe!="object"||oe===null)return F?j(ie):oe;for(var V=Object.create(null),pe=0,we=Object.keys(ie);pe<we.length;pe++){var Te=we[pe],ze=ie[Te];oe[Te]===void 0?F==="all"&&(V[Te]=ze.defaultValue):V[Te]=te(ze,oe[Te],F!=="skip")}return V}e.normalizeParams=le;function ye(ie,oe){for(var F=[],V=0,pe=Object.keys(ie);V<pe.length;V++){var we=pe[V];if(!oe)typeof ie[we]=="string"?F.push([we,ie[we]]):F.push([we,oe===null?we:is(we)]);else{var Te=oe(we,ie[we]);F.push(typeof Te=="string"?[we,Te]:[we,Te[0],Te[1]])}}return F}e.objectToOptions=ye;function be(ie,oe){for(var F=[],V=0,pe=ie;V<pe.length;V++){var we=pe[V];oe?F.push([we,oe(we)]):F.push([we,oe===null?we:is(we)])}return F}e.arrayToOptions=be;function Ae(ie,oe){for(var F=0,V=ie.options;F<V.length;F++){var pe=V[F];if(pe[0]===oe)return pe[1]}return""}e.optionLabel=Ae;function Se(ie,oe){for(var F=0,V=oe;F<V.length;F++){var pe=V[F];if(pe[0]===ie)return ie}return oe.length>0?oe[0][0]:void 0}})(I||(I={}));var Ro;(function(e){function t(i){var a={create:function(o){return{action:a,params:o}},id:bn.create22(),definition:i,createDefaultParams:function(o,s){return i.params?I.getDefaultValues(i.params(o,s)):{}}};return a}e.create=t;function r(i){var a=i.definition;return t({from:a.from,display:a.display,params:a.params,isApplicable:i.definition.isApplicable?function(o,s,u){return i.definition.isApplicable(o,u)}:void 0,run:function(o){var s=o.cell,u=o.state,l=o.params,c=u.build().to(s.transform.ref).apply(i,l);return u.updateTree(c)}})}e.fromTransformer=r;var n;(function(i){function a(o){return function(s){return t(E({from:o.from instanceof Array?o.from:o.from?[o.from]:[],display:typeof o.display=="string"?{name:o.display}:o.display?o.display:{name:"Unnamed State Action"},params:typeof o.params=="object"?function(){return o.params}:o.params?o.params:void 0,isApplicable:o.isApplicable},typeof s=="function"?{run:s}:s))}}i.build=function(o){return a(o)}})(n=e.Builder||(e.Builder={})),e.build=n.build})(Ro||(Ro={}));var ft;(function(e){function t(p,m,g){return p.definition.params?p.definition.params(m,g):{}}e.getParamDefinition=t;function r(p){return!!p&&typeof p.toAction=="function"&&typeof p.apply=="function"}e.is=r;var n;(function(p){p[p.Unchanged=0]="Unchanged",p[p.Updated=1]="Updated",p[p.Recreate=2]="Recreate",p[p.Null=3]="Null"})(n=e.UpdateResult||(e.UpdateResult={}));var i=new Map,a=new Map;function o(p){for(var m=0,g=p.definition.from;m<g.length;m++){var y=g[m];a.has(y.type)?a.get(y.type).push(p):a.set(y.type,[p])}}function s(){return Array.from(i.values())}e.getAll=s;function u(p){var m=i.get(p);if(!m)throw new Error("A transformer with signature '"+p+"' is not registered.");return m}e.get=u;function l(p){return a.get(p)||[]}e.fromType=l;function c(p,m){var g=m.name,y=p+"."+g;if(i.has(y))throw new Error("A transform with id '"+g+"' is already registered. Please pick a unique identifier for your transforms and/or register them only once. This is to ensure that transforms can be serialized and replayed.");var b={apply:function(S,x,C){return fr.create(S,b,x,C)},toAction:function(){return Ro.fromTransformer(b)},namespace:p,id:y,definition:m,createDefaultParams:function(S,x){return m.params?I.getDefaultValues(m.params(S,x)):{}}};return i.set(y,b),o(b),b}e.create=c;function d(p){return function(m){return c(p,m)}}e.factory=d;function f(p){return h.build(p)}e.builderFactory=f;var h;(function(p){function m(y,b){return function(S){return c(y,E({name:b.name,from:b.from instanceof Array?b.from:[b.from],to:b.to instanceof Array?b.to:[b.to],display:typeof b.display=="string"?{name:b.display}:b.display?b.display:{name:L0(b.name.replace(/[-]/g," "))},params:typeof b.params=="object"?function(){return b.params}:b.params?b.params:void 0,isDecorator:b.isDecorator},S))}}function g(y){return function(b){return m(y,b)}}p.build=g})(h=e.Builder||(e.Builder={}));function v(p){return h.build(p)}e.build=v,e.ROOT=c("build-in",{name:"root",from:[],to:[],display:{name:"Root",description:"For internal use."},apply:function(){throw new Error("should never be applied")},update:function(){return n.Unchanged}})})(ft||(ft={}));var fr;(function(e){e.RootRef="-=root=-";function t(m,g){return!!m.isHidden!=!!g.isHidden||!!m.isCollapsed!=!!g.isCollapsed||!!m.isGhost!=!!g.isGhost||!!m.isLocked!=!!g.isLocked}e.areStatesEqual=t;function r(m,g){return g?typeof g.isCollapsed<"u"&&m.isCollapsed!==g.isCollapsed||typeof g.isHidden<"u"&&m.isHidden!==g.isHidden||typeof g.isGhost<"u"&&m.isGhost!==g.isGhost||typeof g.isLocked<"u"&&m.isLocked!==g.isLocked:!1}e.isStateChange=r;function n(m,g){if(!g)return!1;for(var y=!1,b=0,S=Object.keys(g);b<S.length;b++){var x=S[b],C=g[x],w=m[x];!!C!=!!w&&(y=!0,m[x]=C)}return y}e.assignState=n;function i(m,g){if(!g)return!1;for(var y=!1,b=0,S=Object.keys(g);b<S.length;b++){var x=S[b],C=g[x],w=m[x];!!C!=!!w&&(y=!0,m[x]=C)}for(var A=0,M=Object.keys(m);A<M.length;A++){var x=M[A],C=g[x],w=m[x];!!C!=!!w&&(y=!0,m[x]=C)}return y}e.syncState=i;function a(m,g,y,b){var S=b&&b.ref?b.ref:bn.create22(),x=void 0;return b&&b.tags&&(x=typeof b.tags=="string"?[b.tags]:b.tags,x.length===0?x=void 0:x.sort()),{parent:m,transformer:g,state:(b==null?void 0:b.state)||{},tags:x,ref:S,dependsOn:b&&b.dependsOn,params:y,version:bn.create22()}}e.create=a;function o(m,g){return E(E({},m),{params:g,version:bn.create22()})}e.withParams=o;function s(m,g){return g?E(E({},m),{state:E(E({},m.state),g)}):m}e.withState=s;function u(m,g){var y=void 0;return g&&(y=typeof g=="string"?[g]:g,y.length===0?y=void 0:y.sort()),E(E({},m),{tags:y,version:bn.create22()})}e.withTags=u;function l(m,g){return E(E({},m),{parent:g,version:bn.create22()})}e.withParent=l;function c(m){return a(e.RootRef,ft.ROOT,{},{ref:e.RootRef,state:m})}e.createRoot=c;function d(m,g){return m.tags?m.tags.indexOf(g)>=0:!1}e.hasTag=d;function f(m,g){if(!m.tags)return typeof g!="string"&&g.length===0;if(typeof g=="string")return d(m,g);for(var y=0,b=g;y<b.length;y++){var S=b[y];if(m.tags.indexOf(S)<0)return!1}return!0}e.hasTags=f;function h(m){return m}function v(m){for(var g=m.transformer.definition.customSerialization?m.transformer.definition.customSerialization.toJSON:h,y=void 0,b=0,S=Object.keys(m.state);b<S.length;b++){var x=S[b],C=m.state[x];C&&(y||(y={}),y[x]=!0)}return{parent:m.parent,transformer:m.transformer.id,params:m.params?g(m.params):void 0,state:y,tags:m.tags,ref:m.ref,dependsOn:m.dependsOn,version:m.version}}e.toJSON=v;function p(m){var g=ft.get(m.transformer),y=g.definition.customSerialization?g.definition.customSerialization.fromJSON:h;return{parent:m.parent,transformer:g,params:m.params?y(m.params):void 0,state:m.state||{},tags:m.tags,ref:m.ref,dependsOn:m.dependsOn,version:m.version}}e.fromJSON=p})(fr||(fr={}));function Ql(e){for(var t=-1/0,r=0,n=e.length;r<n;++r)e[r]>t&&(t=e[r]);return t}function NE(e){for(var t=1/0,r=0,n=e.length;r<n;++r)e[r]<t&&(t=e[r]);return t}function qo(e){for(var t=1/0,r=-1/0,n=0,i=e.length;n<i;++n)e[n]<t&&(t=e[n]),e[n]>r&&(r=e[n]);return[t,r]}function z1(e,t,r){t===void 0&&(t=1),r===void 0&&(r=0);for(var n=e.length,i=0,a=r;a<n;a+=t)i+=e[a];return i}function BE(e,t,r){return t===void 0&&(t=1),r===void 0&&(r=0),z1(e,t,r)/(e.length/t)}function UE(e){for(var t=e.length,r=0,n=0;n<t;++n){var i=e[n];r+=i*i}return Math.sqrt(r/t)}function Js(e,t){for(var r=0,n=t?Math.min(t,e.length):e.length;r<n;++r)e[r]=r;return e}function Ub(e,t){for(var r=0,n=e.length,i=!1;r<n;r++)if(e[r]===t){i=!0;break}return i?(jb(e,r),!0):!1}function jb(e,t){for(var r=t,n=e.length-1;r<n;r++)e[r]=e[r+1];e.pop()}function ja(e,t){return e.indexOf(t)>=0?!1:(e.push(t),!0)}function rv(e,t){var r=e.indexOf(t);if(r<0)return!1;for(var n=r,i=e.length-1;n<i;n++)e[n]=e[n+1];return e.pop(),!0}function nw(e,t){for(var r=0,n=0,i=e.length;n<i;++n)t.includes(e[n])&&(r+=1);return r}function k6(e,t){if(!e||e.length===0)return!t||t.length===0;if(!t)return!1;var r=e.length;if(r!==t.length)return!1;for(var n=0;n<r;n++)if(e[n]!==t[n])return!1;return!0}function Rke(e){for(var t=0,r=e.length;t<r;t++)if(e[t]!==t)return!1;return!0}function kke(e,t,r){for(var n=0,i=e.length;n<i;++n)if(e[n][0]===t){e[n][1]=r;return}e.push([t,r])}var Oke=function(){function e(t){this.tree=t,this.transforms=this.tree.transforms,this.children=this.tree.children,this.dependencies=this.tree.dependencies,this.changedNodes=!1,this.changedChildren=!1,this.changedDependencies=!1,this._childMutations=void 0,this._dependencyMutations=void 0,this._stateUpdates=void 0}return Object.defineProperty(e.prototype,"childMutations",{get:function(){return this._childMutations?this._childMutations:(this._childMutations=new Map,this._childMutations)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"dependencyMutations",{get:function(){return this._dependencyMutations?this._dependencyMutations:(this._dependencyMutations=new Map,this._dependencyMutations)},enumerable:!1,configurable:!0}),e.prototype.changeNodes=function(){this.changedNodes||(this.changedNodes=!0,this.transforms=this.transforms.asMutable())},e.prototype.changeChildren=function(){this.changedChildren||(this.changedChildren=!0,this.children=this.children.asMutable())},e.prototype.changeDependencies=function(){this.changedDependencies||(this.changedDependencies=!0,this.dependencies=this.dependencies.asMutable())},Object.defineProperty(e.prototype,"root",{get:function(){return this.transforms.get(fr.RootRef)},enumerable:!1,configurable:!0}),e.prototype.asTransient=function(){return this.asImmutable().asTransient()},e.prototype.addChild=function(t,r){if(this.changeChildren(),this.childMutations.has(t))this.childMutations.get(t).add(r);else{var n=this.children.get(t).asMutable();n.add(r),this.children.set(t,n),this.childMutations.set(t,n)}},e.prototype.removeChild=function(t,r){if(this.changeChildren(),this.childMutations.has(t))this.childMutations.get(t).remove(r);else{var n=this.children.get(t).asMutable();n.remove(r),this.children.set(t,n),this.childMutations.set(t,n)}},e.prototype.clearRoot=function(){var t=fr.RootRef;if(this.children.get(t).size!==0){this.changeChildren();var r=ci.OrderedSet();this.children.set(t,r),this.childMutations.set(t,r)}},e.prototype.mutateDependency=function(t,r,n){var i=this.dependencyMutations.get(t);if(!i){var a=this.dependencies.get(t);if(!a&&n==="remove")return;this.changeDependencies(),i=a?a.asMutable():ci.OrderedSet().asMutable(),this.dependencyMutations.set(t,i),this.dependencies.set(t,i)}n==="add"?i.add(r):i.remove(r)},e.prototype.changeParent=function(t,r){zx(this.transforms,t);var n=this.transforms.get(t);this.removeChild(n.parent,t),this.addChild(r,t),this.changeNodes(),this.transforms.set(t,fr.withParent(n,r))},e.prototype.add=function(t){var r=t.ref;if(this.transforms.has(t.ref)){var n=this.transforms.get(t.ref);n.parent!==t.parent&&Nke(t.ref)}var i=this.children.get(t.parent);if(i||Bke(t.parent),i.has(t.ref)||this.addChild(t.parent,t.ref),this.children.has(t.ref)||(this.changedChildren||(this.changedChildren=!0,this.children=this.children.asMutable()),this.children.set(t.ref,ci.OrderedSet())),this.changeNodes(),this.transforms.set(r,t),t.dependsOn)for(var a=0,o=t.dependsOn;a<o.length;a++){var s=o[a];this.mutateDependency(s,r,"add")}return this},e.prototype.setParams=function(t,r){zx(this.transforms,t);var n=this.transforms.get(t);return T6(n.params,r)?!1:(this.changedNodes||(this.changedNodes=!0,this.transforms=this.transforms.asMutable()),this.transforms.set(n.ref,fr.withParams(n,r)),!0)},e.prototype.setTags=function(t,r){zx(this.transforms,t);var n=this.transforms.get(t),i=fr.withParams(n,r);return k6(n.tags,i.tags)?!1:(this.changedNodes||(this.changedNodes=!0,this.transforms=this.transforms.asMutable()),this.transforms.set(n.ref,i),!0)},e.prototype.assignState=function(t,r){zx(this.transforms,t);var n=this.transforms.get(t);if(this._stateUpdates&&this._stateUpdates.has(t))return fr.assignState(n.state,r),n;this._stateUpdates||(this._stateUpdates=new Set),this._stateUpdates.add(n.ref),this.changeNodes();var i=fr.withState(n,r);return this.transforms.set(t,i),i},e.prototype.remove=function(t){var r=this.transforms.get(t);if(!r)return[];var n=fi.subtreePostOrder(this,r);if(t===fr.RootRef){if(n.pop(),n.length===0)return n;this.clearRoot()}else{if(n.length===0)return n;this.removeChild(r.parent,r.ref)}this.changeNodes(),this.changeChildren();for(var i=0,a=n;i<a.length;i++){var o=a[i];this.transforms.delete(o.ref),this.children.delete(o.ref),this._childMutations&&this._childMutations.delete(o.ref)}for(var s=[],u=0,l=n;u<l.length;u++){var o=l[u];if(o.dependsOn)for(var c=0,d=o.dependsOn;c<d.length;c++){var f=d[c];this.transforms.has(f)&&this.mutateDependency(f,o.ref,"remove")}if(this.dependencies.has(o.ref)){var h=this.dependencies.get(o.ref).toArray();this.changeDependencies(),this.dependencies.delete(o.ref),this._dependencyMutations&&this._dependencyMutations.delete(o.ref);for(var v=0,p=h;v<p.length;v++){var m=p[v];if(this.transforms.has(m))for(var g=0,y=this.remove(m);g<y.length;g++){var b=y[g];s[s.length]=b}}}}for(var S=0,x=s;S<x.length;S++){var m=x[S];n[n.length]=m}return n},e.prototype.asImmutable=function(){return!this.changedNodes&&!this.changedChildren&&!this._childMutations?this.tree:(this._childMutations&&this._childMutations.forEach(Fke,this.children),this._dependencyMutations&&this._dependencyMutations.forEach(Lke,this.dependencies),fi.create(this.changedNodes?this.transforms.asImmutable():this.transforms,this.changedChildren?this.children.asImmutable():this.children,this.changedDependencies?this.dependencies.asImmutable():this.dependencies))},e}();function Fke(e,t){this.set(t,e.asImmutable())}function Lke(e,t){e.size===0?this.delete(t):this.set(t,e.asImmutable())}function Nke(e){throw new Error("Transform '"+e+"' is already present in the tree.")}function Bke(e){throw new Error("Parent '"+e+"' must be present in the tree.")}function zx(e,t){if(!e.has(t))throw new Error("Node '"+t+"' is not present in the tree.")}var fi;(function(e){var t=function(){function b(S,x,C){this.transforms=S,this.children=x,this.dependencies=C}return Object.defineProperty(b.prototype,"root",{get:function(){return this.transforms.get(fr.RootRef)},enumerable:!1,configurable:!0}),b.prototype.asTransient=function(){return new Oke(this)},b}();function r(b){var S=b||fr.createRoot();return n(ci.Map([[S.ref,S]]),ci.Map([[S.ref,ci.OrderedSet()]]),ci.Map())}e.createEmpty=r;function n(b,S,x){return new t(b,S,x)}e.create=n;function i(b){a(this,this.tree.transforms.get(b))}function a(b,S){var x=b.tree.children.get(S.ref);x&&x.size&&x.forEach(i,b),b.f(S,b.tree,b.state)}function o(b,S,x,C){var w={tree:b,state:x,f:C};return a(w,S),w.state}e.doPostOrder=o;function s(b){u(this,this.tree.transforms.get(b))}function u(b,S){var x=b.f(S,b.tree,b.state);if(!(typeof x=="boolean"&&!x)){var C=b.tree.children.get(S.ref);C&&C.size&&C.forEach(s,b)}}function l(b,S,x,C){var w={tree:b,state:x,f:C};return u(w,S),w.state}e.doPreOrder=l;function c(b,S,x){x.push(b)}function d(b,S){return o(b,S,[],c)}e.subtreePostOrder=d;function f(b,S,x){x.push(fr.toJSON(b))}function h(b){var S=[];return l(b,b.root,S,f),{transforms:S}}e.toJSON=h;function v(b){for(var S=ci.Map().asMutable(),x=ci.Map().asMutable(),C=ci.Map().asMutable(),w=0,A=b.transforms;w<A.length;w++){var M=A[w],D=fr.fromJSON(M);S.set(D.ref,D),x.has(D.ref)||x.set(D.ref,ci.OrderedSet().asMutable()),D.ref!==D.parent&&x.get(D.parent).add(D.ref)}for(var k=new Set,R=0,O=b.transforms;R<O.length;R++){var M=O[R],H=M.ref;if(x.set(H,x.get(H).asImmutable()),!!M.dependsOn)for(var B=0,j=M.dependsOn;B<j.length;B++){var Y=j[B];k.add(Y),C.has(Y)?C.get(Y).add(H):C.set(Y,ci.OrderedSet([H]).asMutable())}}return k.forEach(function(G){C.set(G,C.get(G).asImmutable())}),n(S.asImmutable(),x.asImmutable(),C.asImmutable())}e.fromJSON=v;function p(b){console.log({tr:b.transforms.keySeq().toArray(),tr1:b.transforms.valueSeq().toArray().map(function(S){return S.ref}),ch:b.children.keySeq().toArray()})}e.dump=p;function m(b,S,x){if(S===x)return!0;for(var C=b.children.get(S),w=C.values();;){var A=w.next();if(A.done)return!1;if(m(b,A.value,x))return!0}}function g(b,S,x){return!b.transforms.has(S)||!b.transforms.has(x)?!1:m(b,S,x)}e.subtreeHasRef=g;function y(b,S){var x=b.children.get(S);if(x.size!==1)return S;var C=b.transforms.get(x.first());return C.transformer.definition.isDecorator?y(b,C.ref):S}e.getDecoratorRoot=y})(fi||(fi={}));var or;(function(e){function t(U,z){return r(U)(z)}e.select=t;function r(U){var z=U||l.root,J;return i(z)?J=z.compile():n(z)?J=l.byValue(z).compile():a(z)?J=z:J=l.byRef(z).compile(),J}e.compile=r;function n(U){return U.transform!==void 0&&U.status!==void 0}function i(U){return U.compile!==void 0}function a(U){return typeof U=="function"}var o={select:function(U){return t(this,U||this.state)}};function s(U,z){o[U]=function(){for(var J=[],K=0;K<arguments.length;K++)J[K]=arguments[K];return z.call.apply(z,Nt([void 0,this],J))}}function u(U){return Object.create(o,{compile:{writable:!1,configurable:!1,value:U}})}var l;(function(U){U.root=u(function(){return function(ie){return[ie.cells.get(ie.tree.root.ref)]}});function z(){for(var ie=[],oe=0;oe<arguments.length;oe++)ie[oe]=arguments[oe];return u(function(){return function(F){for(var V=[],pe=0,we=ie;pe<we.length;pe++){var Te=we[pe],ze=F.cells.get(Te);ze&&V.push(ze)}return V}})}U.byRef=z;function J(){for(var ie=[],oe=0;oe<arguments.length;oe++)ie[oe]=arguments[oe];return u(function(){return function(F){return ie}})}U.byValue=J;function K(ie,oe){return oe===void 0&&(oe=fr.RootRef),u(function(){return function(F){var V={roots:[],cells:F.cells,type:ie.type};return fi.doPreOrder(F.tree,F.tree.transforms.get(oe),V,ye),V.roots}})}U.rootsOfType=K;function Z(ie,oe){return oe===void 0&&(oe=fr.RootRef),u(function(){return function(F){var V={ret:[],cells:F.cells,type:ie.type};return fi.doPreOrder(F.tree,F.tree.transforms.get(oe),V,be),V.ret}})}U.ofType=Z;function te(ie,oe){return oe===void 0&&(oe=fr.RootRef),u(function(){return function(F){var V={ret:[],cells:F.cells,t:ie};return fi.doPreOrder(F.tree,F.tree.transforms.get(oe),V,Ae),V.ret}})}U.ofTransformer=te;function le(ie,oe){return oe===void 0&&(oe=fr.RootRef),u(function(){return function(F){var V={ret:[],cells:F.cells,t:ie};return fi.doPreOrder(F.tree,F.tree.transforms.get(oe),V,Se),V.ret}})}U.ofTransformerWithError=le;function ye(ie,oe,F){var V=F.cells.get(ie.ref);return V&&V.obj&&V.obj.type===F.type?(F.roots.push(V),!1):!0}function be(ie,oe,F){var V=F.cells.get(ie.ref);return V&&V.obj&&V.obj.type===F.type&&F.ret.push(V),!0}function Ae(ie,oe,F){var V=F.cells.get(ie.ref);return V&&V.obj&&V.transform.transformer===F.t&&F.ret.push(V),!0}function Se(ie,oe,F){var V=F.cells.get(ie.ref);return V&&V.status==="error"&&V.transform.transformer===F.t&&F.ret.push(V),!0}})(l=e.Generators||(e.Generators={})),s("flatMap",c);function c(U,z){var J=r(U);return u(function(){return function(K){for(var Z=[],te=0,le=J(K);te<le.length;te++)for(var ye=le[te],be=0,Ae=z(ye,K);be<Ae.length;be++){var Se=Ae[be];Z.push(Se)}return Z}})}e.flatMap=c,s("mapObject",d);function d(U,z){var J=r(U);return u(function(){return function(K){for(var Z=[],te=0,le=J(K);te<le.length;te++){var ye=le[te],be=z(ye,K);be&&Z.push(be)}return Z}})}e.mapObject=d,s("unique",f);function f(U){var z=r(U);return u(function(){return function(J){for(var K=new Set,Z=[],te=0,le=z(J);te<le.length;te++){var ye=le[te];ye&&(K.has(ye.transform.ref)||(K.add(ye.transform.ref),Z.push(ye)))}return Z}})}e.unique=f,s("first",h);function h(U){var z=r(U);return u(function(){return function(J){var K=z(J);return K.length?[K[0]]:[]}})}e.first=h,s("filter",v);function v(U,z){return c(U,function(J){return z(J)?[J]:[]})}e.filter=v,s("withStatus",p);function p(U,z){return v(U,function(J){return J.status===z})}e.withStatus=p,s("withTag",m);function m(U,z){return v(U,function(J){return!!J.transform.tags&&J.transform.tags.indexOf(z)>=0})}e.withTag=m,s("subtree",g);function g(U){return c(U,function(z,J){var K=[];return fi.doPreOrder(J.tree,J.tree.transforms.get(z.transform.ref),K,function(Z,te,le){le.push(Z.ref)}),K.map(function(Z){return J.cells.get(Z)})})}e.subtree=g,s("children",y);function y(U){return c(U,function(z,J){var K=[];return J.tree.children.get(z.transform.ref).forEach(function(Z){return K.push(J.cells.get(Z))}),K})}e.children=y,s("ofType",b);function b(U,z){return v(U,function(J){return J.obj?J.obj.type===z.type:!1})}e.ofType=b,s("ancestor",S);function S(U,z){return f(d(U,function(J,K){return R(K.tree,K.cells,J.transform.ref,z)}))}e.ancestor=S,s("ancestorOfType",x);function x(U,z){return f(d(U,function(J,K){return B(K.tree,K.cells,J.transform.ref,z)}))}e.ancestorOfType=x,s("ancestorWithTransformer",C);function C(U,z){return f(d(U,function(J,K){return H(K.tree,K.cells,J.transform.ref,z)}))}e.ancestorWithTransformer=C,s("withTransformer",w);function w(U,z){return v(U,function(J){return J.transform.transformer===z})}e.withTransformer=w,s("root",A);function A(U,z){return f(d(U,function(J,K){return O(K.tree,K.cells,J.transform.ref,z)}))}e.root=A,s("rootOfType",M);function M(U,z){return f(d(U,function(J,K){return j(K.tree,K.cells,J.transform.ref,z)}))}e.rootOfType=M,s("parent",D);function D(U){return f(d(U,function(z,J){return J.cells.get(J.tree.transforms.get(z.transform.ref).parent)}))}e.parent=D;function k(U,z,J,K,Z){for(var te=U.transforms.get(J),le=void 0;;){te=U.transforms.get(te.parent);var ye=z.get(te.ref);if(ye.obj&&K(ye)&&(le=ye,Z)||te.ref===fr.RootRef)return le}}function R(U,z,J,K){return k(U,z,J,K,!0)}e.findAncestor=R;function O(U,z,J,K){return k(U,z,J,K,!1)}e.findRoot=O;function H(U,z,J,K){return R(U,z,J,Array.isArray(K)?function(Z){return K.indexOf(Z.transform.transformer)>=0}:function(Z){return Z.transform.transformer===K})}e.findAncestorWithTransformer=H;function B(U,z,J,K){return R(U,z,J,Y(K))}e.findAncestorOfType=B;function j(U,z,J,K){return O(U,z,J,Y(K))}e.findRootOfType=j;function Y(U){return Array.isArray(U)?function(z){for(var J=0,K=U;J<K.length;J++){var Z=K[J];if(Z.type===z.obj.type)return!0}}:function(z){return z.obj.type===U.type}}function G(U,z,J){return fi.doPreOrder(U,U.transforms.get(z),{refs:{},tags:J},$).refs}e.findUniqueTagsInSubtree=G;function $(U,z,J){if(U.tags)for(var K=0,Z=U.tags;K<Z.length;K++){var te=Z[K];if(J.tags.has(te)){J.refs[te]=U.ref;break}}return!0}function q(U,z,J){return fi.doPreOrder(U,U.transforms.get(z),{ref:void 0,tag:J},ee).ref}e.findTagInSubtree=q;function ee(U,z,J){return U.tags&&U.tags.indexOf(J.tag)>=0?(J.ref=U.ref,!1):!0}function fe(U,z,J){return fi.doPreOrder(U,U.transforms.get(z),{refs:[],tags:J},W).refs}e.findWithAllTags=fe;function W(U,z,J){if(U.tags)for(var K=J.tags.size,Z=0,te=0,le=U.tags;te<le.length;te++){var ye=le[te];if(J.tags.has(ye)&&(Z++,Z===K)){J.refs.push(U);break}}else J.tags.size===0&&J.refs.push(U)}function X(U,z,J){var K=U.transforms.get(z);if(K.transformer===J)return U.cells.get(z);var Z=U.tree.children.get(z);if(Z.size===1){var te=Z.first();if(U.transforms.get(te).transformer.definition.isDecorator)return X(U,te,J)}}e.tryFindDecorator=X})(or||(or={}));/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var vD=function(e,t){return vD=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var i in n)n.hasOwnProperty(i)&&(r[i]=n[i])},vD(e,t)};function Ea(e,t){vD(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}function mD(e){return typeof e=="function"}var PU=!1,Il={Promise:void 0,set useDeprecatedSynchronousErrorHandling(e){if(e){var t=new Error;""+t.stack}PU=e},get useDeprecatedSynchronousErrorHandling(){return PU}};function pg(e){setTimeout(function(){throw e},0)}var iw={closed:!0,next:function(e){},error:function(e){if(Il.useDeprecatedSynchronousErrorHandling)throw e;pg(e)},complete:function(){}},Uke=function(){return Array.isArray||function(e){return e&&typeof e.length=="number"}}();function iJ(e){return e!==null&&typeof e=="object"}var jke=function(){function e(t){return Error.call(this),this.message=t?t.length+` errors occurred during unsubscription:
`+t.map(function(r,n){return n+1+") "+r.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=t,this}return e.prototype=Object.create(Error.prototype),e}(),xC=jke,Zl=function(){function e(t){this.closed=!1,this._parentOrParents=null,this._subscriptions=null,t&&(this._ctorUnsubscribe=!0,this._unsubscribe=t)}return e.prototype.unsubscribe=function(){var t;if(!this.closed){var r=this,n=r._parentOrParents,i=r._ctorUnsubscribe,a=r._unsubscribe,o=r._subscriptions;if(this.closed=!0,this._parentOrParents=null,this._subscriptions=null,n instanceof e)n.remove(this);else if(n!==null)for(var s=0;s<n.length;++s){var u=n[s];u.remove(this)}if(mD(a)){i&&(this._unsubscribe=void 0);try{a.call(this)}catch(d){t=d instanceof xC?TU(d.errors):[d]}}if(Uke(o))for(var s=-1,l=o.length;++s<l;){var c=o[s];if(iJ(c))try{c.unsubscribe()}catch(f){t=t||[],f instanceof xC?t=t.concat(TU(f.errors)):t.push(f)}}if(t)throw new xC(t)}},e.prototype.add=function(t){var r=t;if(!t)return e.EMPTY;switch(typeof t){case"function":r=new e(t);case"object":if(r===this||r.closed||typeof r.unsubscribe!="function")return r;if(this.closed)return r.unsubscribe(),r;if(!(r instanceof e)){var n=r;r=new e,r._subscriptions=[n]}break;default:throw new Error("unrecognized teardown "+t+" added to Subscription.")}var i=r._parentOrParents;if(i===null)r._parentOrParents=this;else if(i instanceof e){if(i===this)return r;r._parentOrParents=[i,this]}else if(i.indexOf(this)===-1)i.push(this);else return r;var a=this._subscriptions;return a===null?this._subscriptions=[r]:a.push(r),r},e.prototype.remove=function(t){var r=this._subscriptions;if(r){var n=r.indexOf(t);n!==-1&&r.splice(n,1)}},e.EMPTY=function(t){return t.closed=!0,t}(new e),e}();function TU(e){return e.reduce(function(t,r){return t.concat(r instanceof xC?r.errors:r)},[])}var aw=function(){return typeof Symbol=="function"?Symbol("rxSubscriber"):"@@rxSubscriber_"+Math.random()}(),$s=function(e){Ea(t,e);function t(r,n,i){var a=e.call(this)||this;switch(a.syncErrorValue=null,a.syncErrorThrown=!1,a.syncErrorThrowable=!1,a.isStopped=!1,arguments.length){case 0:a.destination=iw;break;case 1:if(!r){a.destination=iw;break}if(typeof r=="object"){r instanceof t?(a.syncErrorThrowable=r.syncErrorThrowable,a.destination=r,r.add(a)):(a.syncErrorThrowable=!0,a.destination=new IU(a,r));break}default:a.syncErrorThrowable=!0,a.destination=new IU(a,r,n,i);break}return a}return t.prototype[aw]=function(){return this},t.create=function(r,n,i){var a=new t(r,n,i);return a.syncErrorThrowable=!1,a},t.prototype.next=function(r){this.isStopped||this._next(r)},t.prototype.error=function(r){this.isStopped||(this.isStopped=!0,this._error(r))},t.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this))},t.prototype._next=function(r){this.destination.next(r)},t.prototype._error=function(r){this.destination.error(r),this.unsubscribe()},t.prototype._complete=function(){this.destination.complete(),this.unsubscribe()},t.prototype._unsubscribeAndRecycle=function(){var r=this._parentOrParents;return this._parentOrParents=null,this.unsubscribe(),this.closed=!1,this.isStopped=!1,this._parentOrParents=r,this},t}(Zl),IU=function(e){Ea(t,e);function t(r,n,i,a){var o=e.call(this)||this;o._parentSubscriber=r;var s,u=o;return mD(n)?s=n:n&&(s=n.next,i=n.error,a=n.complete,n!==iw&&(u=Object.create(n),mD(u.unsubscribe)&&o.add(u.unsubscribe.bind(u)),u.unsubscribe=o.unsubscribe.bind(o))),o._context=u,o._next=s,o._error=i,o._complete=a,o}return t.prototype.next=function(r){if(!this.isStopped&&this._next){var n=this._parentSubscriber;!Il.useDeprecatedSynchronousErrorHandling||!n.syncErrorThrowable?this.__tryOrUnsub(this._next,r):this.__tryOrSetError(n,this._next,r)&&this.unsubscribe()}},t.prototype.error=function(r){if(!this.isStopped){var n=this._parentSubscriber,i=Il.useDeprecatedSynchronousErrorHandling;if(this._error)!i||!n.syncErrorThrowable?(this.__tryOrUnsub(this._error,r),this.unsubscribe()):(this.__tryOrSetError(n,this._error,r),this.unsubscribe());else if(n.syncErrorThrowable)i?(n.syncErrorValue=r,n.syncErrorThrown=!0):pg(r),this.unsubscribe();else{if(this.unsubscribe(),i)throw r;pg(r)}}},t.prototype.complete=function(){var r=this;if(!this.isStopped){var n=this._parentSubscriber;if(this._complete){var i=function(){return r._complete.call(r._context)};!Il.useDeprecatedSynchronousErrorHandling||!n.syncErrorThrowable?(this.__tryOrUnsub(i),this.unsubscribe()):(this.__tryOrSetError(n,i),this.unsubscribe())}else this.unsubscribe()}},t.prototype.__tryOrUnsub=function(r,n){try{r.call(this._context,n)}catch(i){if(this.unsubscribe(),Il.useDeprecatedSynchronousErrorHandling)throw i;pg(i)}},t.prototype.__tryOrSetError=function(r,n,i){if(!Il.useDeprecatedSynchronousErrorHandling)throw new Error("bad call");try{n.call(this._context,i)}catch(a){return Il.useDeprecatedSynchronousErrorHandling?(r.syncErrorValue=a,r.syncErrorThrown=!0,!0):(pg(a),!0)}return!1},t.prototype._unsubscribe=function(){var r=this._parentSubscriber;this._context=null,this._parentSubscriber=null,r.unsubscribe()},t}($s);function zke(e){for(;e;){var t=e,r=t.closed,n=t.destination,i=t.isStopped;if(r||i)return!1;n&&n instanceof $s?e=n:e=null}return!0}function Vke(e,t,r){if(e){if(e instanceof $s)return e;if(e[aw])return e[aw]()}return!e&&!t&&!r?new $s(iw):new $s(e,t,r)}var E2=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}();function aJ(e){return e}function Hke(e){return e.length===0?aJ:e.length===1?e[0]:function(r){return e.reduce(function(n,i){return i(n)},r)}}var cs=function(){function e(t){this._isScalar=!1,t&&(this._subscribe=t)}return e.prototype.lift=function(t){var r=new e;return r.source=this,r.operator=t,r},e.prototype.subscribe=function(t,r,n){var i=this.operator,a=Vke(t,r,n);if(i?a.add(i.call(a,this.source)):a.add(this.source||Il.useDeprecatedSynchronousErrorHandling&&!a.syncErrorThrowable?this._subscribe(a):this._trySubscribe(a)),Il.useDeprecatedSynchronousErrorHandling&&a.syncErrorThrowable&&(a.syncErrorThrowable=!1,a.syncErrorThrown))throw a.syncErrorValue;return a},e.prototype._trySubscribe=function(t){try{return this._subscribe(t)}catch(r){Il.useDeprecatedSynchronousErrorHandling&&(t.syncErrorThrown=!0,t.syncErrorValue=r),zke(t)?t.error(r):console.warn(r)}},e.prototype.forEach=function(t,r){var n=this;return r=MU(r),new r(function(i,a){var o;o=n.subscribe(function(s){try{t(s)}catch(u){a(u),o&&o.unsubscribe()}},a,i)})},e.prototype._subscribe=function(t){var r=this.source;return r&&r.subscribe(t)},e.prototype[E2]=function(){return this},e.prototype.pipe=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return t.length===0?this:Hke(t)(this)},e.prototype.toPromise=function(t){var r=this;return t=MU(t),new t(function(n,i){var a;r.subscribe(function(o){return a=o},function(o){return i(o)},function(){return n(a)})})},e.create=function(t){return new e(t)},e}();function MU(e){if(e||(e=Promise),!e)throw new Error("no Promise impl found");return e}var Gke=function(){function e(){return Error.call(this),this.message="object unsubscribed",this.name="ObjectUnsubscribedError",this}return e.prototype=Object.create(Error.prototype),e}(),Ym=Gke,qke=function(e){Ea(t,e);function t(r,n){var i=e.call(this)||this;return i.subject=r,i.subscriber=n,i.closed=!1,i}return t.prototype.unsubscribe=function(){if(!this.closed){this.closed=!0;var r=this.subject,n=r.observers;if(this.subject=null,!(!n||n.length===0||r.isStopped||r.closed)){var i=n.indexOf(this.subscriber);i!==-1&&n.splice(i,1)}}},t}(Zl),$ke=function(e){Ea(t,e);function t(r){var n=e.call(this,r)||this;return n.destination=r,n}return t}($s),ai=function(e){Ea(t,e);function t(){var r=e.call(this)||this;return r.observers=[],r.closed=!1,r.isStopped=!1,r.hasError=!1,r.thrownError=null,r}return t.prototype[aw]=function(){return new $ke(this)},t.prototype.lift=function(r){var n=new DU(this,this);return n.operator=r,n},t.prototype.next=function(r){if(this.closed)throw new Ym;if(!this.isStopped)for(var n=this.observers,i=n.length,a=n.slice(),o=0;o<i;o++)a[o].next(r)},t.prototype.error=function(r){if(this.closed)throw new Ym;this.hasError=!0,this.thrownError=r,this.isStopped=!0;for(var n=this.observers,i=n.length,a=n.slice(),o=0;o<i;o++)a[o].error(r);this.observers.length=0},t.prototype.complete=function(){if(this.closed)throw new Ym;this.isStopped=!0;for(var r=this.observers,n=r.length,i=r.slice(),a=0;a<n;a++)i[a].complete();this.observers.length=0},t.prototype.unsubscribe=function(){this.isStopped=!0,this.closed=!0,this.observers=null},t.prototype._trySubscribe=function(r){if(this.closed)throw new Ym;return e.prototype._trySubscribe.call(this,r)},t.prototype._subscribe=function(r){if(this.closed)throw new Ym;return this.hasError?(r.error(this.thrownError),Zl.EMPTY):this.isStopped?(r.complete(),Zl.EMPTY):(this.observers.push(r),new qke(this,r))},t.prototype.asObservable=function(){var r=new cs;return r.source=this,r},t.create=function(r,n){return new DU(r,n)},t}(cs),DU=function(e){Ea(t,e);function t(r,n){var i=e.call(this)||this;return i.destination=r,i.source=n,i}return t.prototype.next=function(r){var n=this.destination;n&&n.next&&n.next(r)},t.prototype.error=function(r){var n=this.destination;n&&n.error&&this.destination.error(r)},t.prototype.complete=function(){var r=this.destination;r&&r.complete&&this.destination.complete()},t.prototype._subscribe=function(r){var n=this.source;return n?this.source.subscribe(r):Zl.EMPTY},t}(ai),Kf=function(e){Ea(t,e);function t(r){var n=e.call(this)||this;return n._value=r,n}return Object.defineProperty(t.prototype,"value",{get:function(){return this.getValue()},enumerable:!0,configurable:!0}),t.prototype._subscribe=function(r){var n=e.prototype._subscribe.call(this,r);return n&&!n.closed&&r.next(this._value),n},t.prototype.getValue=function(){if(this.hasError)throw this.thrownError;if(this.closed)throw new Ym;return this._value},t.prototype.next=function(r){e.prototype.next.call(this,this._value=r)},t}(ai),Wke=function(e){Ea(t,e);function t(r,n){return e.call(this)||this}return t.prototype.schedule=function(r,n){return this},t}(Zl),Xke=function(e){Ea(t,e);function t(r,n){var i=e.call(this,r,n)||this;return i.scheduler=r,i.work=n,i.pending=!1,i}return t.prototype.schedule=function(r,n){if(n===void 0&&(n=0),this.closed)return this;this.state=r;var i=this.id,a=this.scheduler;return i!=null&&(this.id=this.recycleAsyncId(a,i,n)),this.pending=!0,this.delay=n,this.id=this.id||this.requestAsyncId(a,this.id,n),this},t.prototype.requestAsyncId=function(r,n,i){return i===void 0&&(i=0),setInterval(r.flush.bind(r,this),i)},t.prototype.recycleAsyncId=function(r,n,i){if(i===void 0&&(i=0),i!==null&&this.delay===i&&this.pending===!1)return n;clearInterval(n)},t.prototype.execute=function(r,n){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var i=this._execute(r,n);if(i)return i;this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},t.prototype._execute=function(r,n){var i=!1,a=void 0;try{this.work(r)}catch(o){i=!0,a=!!o&&o||new Error(o)}if(i)return this.unsubscribe(),a},t.prototype._unsubscribe=function(){var r=this.id,n=this.scheduler,i=n.actions,a=i.indexOf(this);this.work=null,this.state=null,this.pending=!1,this.scheduler=null,a!==-1&&i.splice(a,1),r!=null&&(this.id=this.recycleAsyncId(n,r,null)),this.delay=null},t}(Wke),RU=function(){function e(t,r){r===void 0&&(r=e.now),this.SchedulerAction=t,this.now=r}return e.prototype.schedule=function(t,r,n){return r===void 0&&(r=0),new this.SchedulerAction(this,t).schedule(n,r)},e.now=function(){return Date.now()},e}(),Yke=function(e){Ea(t,e);function t(r,n){n===void 0&&(n=RU.now);var i=e.call(this,r,function(){return t.delegate&&t.delegate!==i?t.delegate.now():n()})||this;return i.actions=[],i.active=!1,i.scheduled=void 0,i}return t.prototype.schedule=function(r,n,i){return n===void 0&&(n=0),t.delegate&&t.delegate!==this?t.delegate.schedule(r,n,i):e.prototype.schedule.call(this,r,n,i)},t.prototype.flush=function(r){var n=this.actions;if(this.active){n.push(r);return}var i;this.active=!0;do if(i=r.execute(r.state,r.delay))break;while(r=n.shift());if(this.active=!1,i){for(;r=n.shift();)r.unsubscribe();throw i}},t}(RU),Kke=new cs(function(e){return e.complete()});function Qke(e){return e?Zke(e):Kke}function Zke(e){return new cs(function(t){return e.schedule(function(){return t.complete()})})}function Jke(e){return e&&typeof e.schedule=="function"}var oJ=function(e){return function(t){for(var r=0,n=e.length;r<n&&!t.closed;r++)t.next(e[r]);t.complete()}};function sJ(e,t){return new cs(function(r){var n=new Zl,i=0;return n.add(t.schedule(function(){if(i===e.length){r.complete();return}r.next(e[i++]),r.closed||n.add(this.schedule())})),n})}function eOe(e,t){return t?sJ(e,t):new cs(oJ(e))}var tOe=new Yke(Xke),rOe=tOe,nOe=function(){function e(){return Error.call(this),this.message="argument out of range",this.name="ArgumentOutOfRangeError",this}return e.prototype=Object.create(Error.prototype),e}(),iOe=nOe;function aOe(e,t){return function(n){if(typeof e!="function")throw new TypeError("argument is not a function. Are you looking for `mapTo()`?");return n.lift(new oOe(e,t))}}var oOe=function(){function e(t,r){this.project=t,this.thisArg=r}return e.prototype.call=function(t,r){return r.subscribe(new sOe(t,this.project,this.thisArg))},e}(),sOe=function(e){Ea(t,e);function t(r,n,i){var a=e.call(this,r)||this;return a.project=n,a.count=0,a.thisArg=i||a,a}return t.prototype._next=function(r){var n;try{n=this.project.call(this.thisArg,r,this.count++)}catch(i){this.destination.error(i);return}this.destination.next(n)},t}($s),uOe=function(e){return function(t){return e.then(function(r){t.closed||(t.next(r),t.complete())},function(r){return t.error(r)}).then(null,pg),t}};function lOe(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var jE=lOe(),cOe=function(e){return function(t){var r=e[jE]();do{var n=void 0;try{n=r.next()}catch(i){return t.error(i),t}if(n.done){t.complete();break}if(t.next(n.value),t.closed)break}while(!0);return typeof r.return=="function"&&t.add(function(){r.return&&r.return()}),t}},dOe=function(e){return function(t){var r=e[E2]();if(typeof r.subscribe!="function")throw new TypeError("Provided object does not correctly implement Symbol.observable");return r.subscribe(t)}},uJ=function(e){return e&&typeof e.length=="number"&&typeof e!="function"};function lJ(e){return!!e&&typeof e.subscribe!="function"&&typeof e.then=="function"}var cJ=function(e){if(e&&typeof e[E2]=="function")return dOe(e);if(uJ(e))return oJ(e);if(lJ(e))return uOe(e);if(e&&typeof e[jE]=="function")return cOe(e);var t=iJ(e)?"an invalid object":"'"+e+"'",r="You provided "+t+" where a stream was expected. You can provide an Observable, Promise, Array, or Iterable.";throw new TypeError(r)};function fOe(e,t){return new cs(function(r){var n=new Zl;return n.add(t.schedule(function(){var i=e[E2]();n.add(i.subscribe({next:function(a){n.add(t.schedule(function(){return r.next(a)}))},error:function(a){n.add(t.schedule(function(){return r.error(a)}))},complete:function(){n.add(t.schedule(function(){return r.complete()}))}}))})),n})}function hOe(e,t){return new cs(function(r){var n=new Zl;return n.add(t.schedule(function(){return e.then(function(i){n.add(t.schedule(function(){r.next(i),n.add(t.schedule(function(){return r.complete()}))}))},function(i){n.add(t.schedule(function(){return r.error(i)}))})})),n})}function pOe(e,t){if(!e)throw new Error("Iterable cannot be null");return new cs(function(r){var n=new Zl,i;return n.add(function(){i&&typeof i.return=="function"&&i.return()}),n.add(t.schedule(function(){i=e[jE](),n.add(t.schedule(function(){if(!r.closed){var a,o;try{var s=i.next();a=s.value,o=s.done}catch(u){r.error(u);return}o?r.complete():(r.next(a),this.schedule())}}))})),n})}function vOe(e){return e&&typeof e[E2]=="function"}function mOe(e){return e&&typeof e[jE]=="function"}function gOe(e,t){if(e!=null){if(vOe(e))return fOe(e,t);if(lJ(e))return hOe(e,t);if(uJ(e))return sJ(e,t);if(mOe(e)||typeof e=="string")return pOe(e,t)}throw new TypeError((e!==null&&typeof e||e)+" is not observable")}function yOe(e,t){return t?gOe(e,t):e instanceof cs?e:new cs(cJ(e))}var bOe=function(e){Ea(t,e);function t(r){var n=e.call(this)||this;return n.parent=r,n}return t.prototype._next=function(r){this.parent.notifyNext(r)},t.prototype._error=function(r){this.parent.notifyError(r),this.unsubscribe()},t.prototype._complete=function(){this.parent.notifyComplete(),this.unsubscribe()},t}($s),xOe=function(e){Ea(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.notifyNext=function(r){this.destination.next(r)},t.prototype.notifyError=function(r){this.destination.error(r)},t.prototype.notifyComplete=function(){this.destination.complete()},t}($s);function SOe(e,t){if(!t.closed){if(e instanceof cs)return e.subscribe(t);var r;try{r=cJ(e)(t)}catch(n){t.error(n)}return r}}function dJ(e,t,r){return r===void 0&&(r=Number.POSITIVE_INFINITY),typeof t=="function"?function(n){return n.pipe(dJ(function(i,a){return yOe(e(i,a)).pipe(aOe(function(o,s){return t(i,o,a,s)}))},r))}:(typeof t=="number"&&(r=t),function(n){return n.lift(new COe(e,r))})}var COe=function(){function e(t,r){r===void 0&&(r=Number.POSITIVE_INFINITY),this.project=t,this.concurrent=r}return e.prototype.call=function(t,r){return r.subscribe(new _Oe(t,this.project,this.concurrent))},e}(),_Oe=function(e){Ea(t,e);function t(r,n,i){i===void 0&&(i=Number.POSITIVE_INFINITY);var a=e.call(this,r)||this;return a.project=n,a.concurrent=i,a.hasCompleted=!1,a.buffer=[],a.active=0,a.index=0,a}return t.prototype._next=function(r){this.active<this.concurrent?this._tryNext(r):this.buffer.push(r)},t.prototype._tryNext=function(r){var n,i=this.index++;try{n=this.project(r,i)}catch(a){this.destination.error(a);return}this.active++,this._innerSub(n)},t.prototype._innerSub=function(r){var n=new bOe(this),i=this.destination;i.add(n);var a=SOe(r,n);a!==n&&i.add(a)},t.prototype._complete=function(){this.hasCompleted=!0,this.active===0&&this.buffer.length===0&&this.destination.complete(),this.unsubscribe()},t.prototype.notifyNext=function(r){this.destination.next(r)},t.prototype.notifyComplete=function(){var r=this.buffer;this.active--,r.length>0?this._next(r.shift()):this.active===0&&this.hasCompleted&&this.destination.complete()},t}(xOe);function wOe(e){return e===void 0&&(e=Number.POSITIVE_INFINITY),dJ(aJ,e)}function Dc(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=Number.POSITIVE_INFINITY,n=null,i=e[e.length-1];return Jke(i)?(n=e.pop(),e.length>1&&typeof e[e.length-1]=="number"&&(r=e.pop())):typeof i=="number"&&(r=e.pop()),n===null&&e.length===1&&e[0]instanceof cs?e[0]:wOe(r)(eOe(e,n))}function zE(e,t){return function(n){return n.lift(new EOe(e,t))}}var EOe=function(){function e(t,r){this.predicate=t,this.thisArg=r}return e.prototype.call=function(t,r){return r.subscribe(new AOe(t,this.predicate,this.thisArg))},e}(),AOe=function(e){Ea(t,e);function t(r,n,i){var a=e.call(this,r)||this;return a.predicate=n,a.thisArg=i,a.count=0,a}return t.prototype._next=function(r){var n;try{n=this.predicate.call(this.thisArg,r,this.count++)}catch(i){this.destination.error(i);return}n&&this.destination.next(r)},t}($s),hd;(function(e){function t(){var r=new POe,n=function(){return r.create()};return n.dispose=function(){return r.dispose()},n.behavior=function(i){return r.behavior(i)},n}e.create=t})(hd||(hd={}));var POe=function(){function e(){this._eventList=[],this._disposed=!1}return e.prototype.create=function(){var t=new ai;return this._eventList.push(t),t},e.prototype.behavior=function(t){var r=new Kf(t);return this._eventList.push(r),r},e.prototype.dispose=function(){if(!this._disposed){for(var t=0,r=this._eventList;t<r.length;t++){var n=r[t];n.complete()}this._disposed=!0}},e}();function Pu(e){for(var t=arguments.length,r=Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];throw Error("[Immer] minified error nr: "+e+(r.length?" "+r.map(function(i){return"'"+i+"'"}).join(","):"")+". Find the full error at: https://bit.ly/3cXEKWf")}function h0(e){return!!e&&!!e[ds]}function Tv(e){return!!e&&(function(t){if(!t||typeof t!="object")return!1;var r=Object.getPrototypeOf(t);if(r===null)return!0;var n=Object.hasOwnProperty.call(r,"constructor")&&r.constructor;return typeof n=="function"&&Function.toString.call(n)===FOe}(e)||Array.isArray(e)||!!e[jU]||!!e.constructor[jU]||O6(e)||F6(e))}function zb(e,t,r){r===void 0&&(r=!1),z0(e)===0?(r?Object.keys:j6)(e).forEach(function(n){r&&typeof n=="symbol"||t(n,e[n],e)}):e.forEach(function(n,i){return t(i,n,e)})}function z0(e){var t=e[ds];return t?t.i>3?t.i-4:t.i:Array.isArray(e)?1:O6(e)?2:F6(e)?3:0}function gD(e,t){return z0(e)===2?e.has(t):Object.prototype.hasOwnProperty.call(e,t)}function TOe(e,t){return z0(e)===2?e.get(t):e[t]}function fJ(e,t,r){var n=z0(e);n===2?e.set(t,r):n===3?(e.delete(t),e.add(r)):e[t]=r}function IOe(e,t){return e===t?e!==0||1/e==1/t:e!=e&&t!=t}function O6(e){return kOe&&e instanceof Map}function F6(e){return OOe&&e instanceof Set}function Mp(e){return e.o||e.t}function L6(e){if(Array.isArray(e))return Array.prototype.slice.call(e);var t=LOe(e);delete t[ds];for(var r=j6(t),n=0;n<r.length;n++){var i=r[n],a=t[i];a.writable===!1&&(a.writable=!0,a.configurable=!0),(a.get||a.set)&&(t[i]={configurable:!0,writable:!0,enumerable:a.enumerable,value:e[i]})}return Object.create(Object.getPrototypeOf(e),t)}function N6(e,t){return t===void 0&&(t=!1),B6(e)||h0(e)||!Tv(e)||(z0(e)>1&&(e.set=e.add=e.clear=e.delete=MOe),Object.freeze(e),t&&zb(e,function(r,n){return N6(n,!0)},!0)),e}function MOe(){Pu(2)}function B6(e){return e==null||typeof e!="object"||Object.isFrozen(e)}function Qc(e){var t=NOe[e];return t||Pu(18,e),t}function kU(){return Vb}function BP(e,t){t&&(Qc("Patches"),e.u=[],e.s=[],e.v=t)}function ow(e){yD(e),e.p.forEach(DOe),e.p=null}function yD(e){e===Vb&&(Vb=e.l)}function OU(e){return Vb={p:[],l:Vb,h:e,m:!0,_:0}}function DOe(e){var t=e[ds];t.i===0||t.i===1?t.j():t.g=!0}function UP(e,t){t._=t.p.length;var r=t.p[0],n=e!==void 0&&e!==r;return t.h.O||Qc("ES5").S(t,e,n),n?(r[ds].P&&(ow(t),Pu(4)),Tv(e)&&(e=sw(t,e),t.l||uw(t,e)),t.u&&Qc("Patches").M(r[ds],e,t.u,t.s)):e=sw(t,r,[]),ow(t),t.u&&t.v(t.u,t.s),e!==hJ?e:void 0}function sw(e,t,r){if(B6(t))return t;var n=t[ds];if(!n)return zb(t,function(a,o){return FU(e,n,t,a,o,r)},!0),t;if(n.A!==e)return t;if(!n.P)return uw(e,n.t,!0),n.t;if(!n.I){n.I=!0,n.A._--;var i=n.i===4||n.i===5?n.o=L6(n.k):n.o;zb(n.i===3?new Set(i):i,function(a,o){return FU(e,n,i,a,o,r)}),uw(e,i,!1),r&&e.u&&Qc("Patches").R(n,r,e.u,e.s)}return n.o}function FU(e,t,r,n,i,a){if(h0(i)){var o=sw(e,i,a&&t&&t.i!==3&&!gD(t.D,n)?a.concat(n):void 0);if(fJ(r,n,o),!h0(o))return;e.m=!1}if(Tv(i)&&!B6(i)){if(!e.h.F&&e._<1)return;sw(e,i),t&&t.A.l||uw(e,i)}}function uw(e,t,r){r===void 0&&(r=!1),e.h.F&&e.m&&N6(t,r)}function jP(e,t){var r=e[ds];return(r?Mp(r):e)[t]}function LU(e,t){if(t in e)for(var r=Object.getPrototypeOf(e);r;){var n=Object.getOwnPropertyDescriptor(r,t);if(n)return n;r=Object.getPrototypeOf(r)}}function bD(e){e.P||(e.P=!0,e.l&&bD(e.l))}function zP(e){e.o||(e.o=L6(e.t))}function xD(e,t,r){var n=O6(t)?Qc("MapSet").N(t,r):F6(t)?Qc("MapSet").T(t,r):e.O?function(i,a){var o=Array.isArray(i),s={i:o?1:0,A:a?a.A:kU(),P:!1,I:!1,D:{},l:a,t:i,k:null,o:null,j:null,C:!1},u=s,l=SC;o&&(u=[s],l=CC);var c=Proxy.revocable(u,l),d=c.revoke,f=c.proxy;return s.k=f,s.j=d,f}(t,r):Qc("ES5").J(t,r);return(r?r.A:kU()).p.push(n),n}function ROe(e){return h0(e)||Pu(22,e),function t(r){if(!Tv(r))return r;var n,i=r[ds],a=z0(r);if(i){if(!i.P&&(i.i<4||!Qc("ES5").K(i)))return i.t;i.I=!0,n=NU(r,a),i.I=!1}else n=NU(r,a);return zb(n,function(o,s){i&&TOe(i.t,o)===s||fJ(n,o,t(s))}),a===3?new Set(n):n}(e)}function NU(e,t){switch(t){case 2:return new Map(e);case 3:return Array.from(e)}return L6(e)}var BU,Vb,U6=typeof Symbol<"u"&&typeof Symbol("x")=="symbol",kOe=typeof Map<"u",OOe=typeof Set<"u",UU=typeof Proxy<"u"&&Proxy.revocable!==void 0&&typeof Reflect<"u",hJ=U6?Symbol.for("immer-nothing"):((BU={})["immer-nothing"]=!0,BU),jU=U6?Symbol.for("immer-draftable"):"__$immer_draftable",ds=U6?Symbol.for("immer-state"):"__$immer_state",FOe=""+Object.prototype.constructor,j6=typeof Reflect<"u"&&Reflect.ownKeys?Reflect.ownKeys:Object.getOwnPropertySymbols!==void 0?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:Object.getOwnPropertyNames,LOe=Object.getOwnPropertyDescriptors||function(e){var t={};return j6(e).forEach(function(r){t[r]=Object.getOwnPropertyDescriptor(e,r)}),t},NOe={},SC={get:function(e,t){if(t===ds)return e;var r=Mp(e);if(!gD(r,t))return function(i,a,o){var s,u=LU(a,o);return u?"value"in u?u.value:(s=u.get)===null||s===void 0?void 0:s.call(i.k):void 0}(e,r,t);var n=r[t];return e.I||!Tv(n)?n:n===jP(e.t,t)?(zP(e),e.o[t]=xD(e.A.h,n,e)):n},has:function(e,t){return t in Mp(e)},ownKeys:function(e){return Reflect.ownKeys(Mp(e))},set:function(e,t,r){var n=LU(Mp(e),t);if(n!=null&&n.set)return n.set.call(e.k,r),!0;if(!e.P){var i=jP(Mp(e),t),a=i==null?void 0:i[ds];if(a&&a.t===r)return e.o[t]=r,e.D[t]=!1,!0;if(IOe(r,i)&&(r!==void 0||gD(e.t,t)))return!0;zP(e),bD(e)}return e.o[t]===r&&typeof r!="number"||(e.o[t]=r,e.D[t]=!0,!0)},deleteProperty:function(e,t){return jP(e.t,t)!==void 0||t in e.t?(e.D[t]=!1,zP(e),bD(e)):delete e.D[t],e.o&&delete e.o[t],!0},getOwnPropertyDescriptor:function(e,t){var r=Mp(e),n=Reflect.getOwnPropertyDescriptor(r,t);return n&&{writable:!0,configurable:e.i!==1||t!=="length",enumerable:n.enumerable,value:r[t]}},defineProperty:function(){Pu(11)},getPrototypeOf:function(e){return Object.getPrototypeOf(e.t)},setPrototypeOf:function(){Pu(12)}},CC={};zb(SC,function(e,t){CC[e]=function(){return arguments[0]=arguments[0][0],t.apply(this,arguments)}}),CC.deleteProperty=function(e,t){return SC.deleteProperty.call(this,e[0],t)},CC.set=function(e,t,r){return SC.set.call(this,e[0],t,r,e[0])};var BOe=function(){function e(r){var n=this;this.O=UU,this.F=!0,this.produce=function(i,a,o){if(typeof i=="function"&&typeof a!="function"){var s=a;a=i;var u=n;return function(h){var v=this;h===void 0&&(h=s);for(var p=arguments.length,m=Array(p>1?p-1:0),g=1;g<p;g++)m[g-1]=arguments[g];return u.produce(h,function(y){var b;return(b=a).call.apply(b,[v,y].concat(m))})}}var l;if(typeof a!="function"&&Pu(6),o!==void 0&&typeof o!="function"&&Pu(7),Tv(i)){var c=OU(n),d=xD(n,i,void 0),f=!0;try{l=a(d),f=!1}finally{f?ow(c):yD(c)}return typeof Promise<"u"&&l instanceof Promise?l.then(function(h){return BP(c,o),UP(h,c)},function(h){throw ow(c),h}):(BP(c,o),UP(l,c))}if(!i||typeof i!="object")return(l=a(i))===hJ?void 0:(l===void 0&&(l=i),n.F&&N6(l,!0),l);Pu(21,i)},this.produceWithPatches=function(i,a){return typeof i=="function"?function(u){for(var l=arguments.length,c=Array(l>1?l-1:0),d=1;d<l;d++)c[d-1]=arguments[d];return n.produceWithPatches(u,function(f){return i.apply(void 0,[f].concat(c))})}:[n.produce(i,a,function(u,l){o=u,s=l}),o,s];var o,s},typeof(r==null?void 0:r.useProxies)=="boolean"&&this.setUseProxies(r.useProxies),typeof(r==null?void 0:r.autoFreeze)=="boolean"&&this.setAutoFreeze(r.autoFreeze)}var t=e.prototype;return t.createDraft=function(r){Tv(r)||Pu(8),h0(r)&&(r=ROe(r));var n=OU(this),i=xD(this,r,void 0);return i[ds].C=!0,yD(n),i},t.finishDraft=function(r,n){var i=r&&r[ds],a=i.A;return BP(a,n),UP(void 0,a)},t.setAutoFreeze=function(r){this.F=r},t.setUseProxies=function(r){r&&!UU&&Pu(20),this.O=r},t.applyPatches=function(r,n){var i;for(i=n.length-1;i>=0;i--){var a=n[i];if(a.path.length===0&&a.op==="replace"){r=a.value;break}}var o=Qc("Patches").$;return h0(r)?o(r,n):this.produce(r,function(s){return o(s,n.slice(i+1))})},e}(),fs=new BOe,Iv=fs.produce;fs.produceWithPatches.bind(fs);var UOe=fs.setAutoFreeze.bind(fs);fs.setUseProxies.bind(fs);fs.applyPatches.bind(fs);fs.createDraft.bind(fs);fs.finishDraft.bind(fs);const z6=Iv;var Fp;(function(e){function t(o){if(!o.state||o.state.tree===o.editInfo.sourceTree)return o.tree.asImmutable();for(var s=o.state.tree.asTransient(),u=0,l=o.actions;u<l.length;u++){var c=l[u];switch(c.kind){case"add":s.add(c.transform);break;case"update":s.setParams(c.ref,c.params);break;case"delete":s.remove(c.ref);break;case"insert":{var d=s.children.get(c.ref).toArray();s.add(c.transform);for(var f=0,h=d;f<h.length;f++){var v=h[f];s.changeParent(v,c.transform.ref)}break}}}return o.editInfo.sourceTree=o.tree,s.asImmutable()}function r(o){return!!o&&typeof o.getTree=="function"}e.is=r;function n(o){return!!o&&typeof o.getTree=="function"&&typeof o.ref=="string"}e.isTo=n;var i=function(){function o(s,u){this.state={state:u,tree:s.asTransient(),actions:[],editInfo:{applied:!1,sourceTree:s,count:0,lastUpdate:void 0}}}return Object.defineProperty(o.prototype,"editInfo",{get:function(){return this.state.editInfo},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"currentTree",{get:function(){return this.state.tree},enumerable:!1,configurable:!0}),o.prototype.to=function(s){var u=typeof s=="string"?s:Bb.is(s)?s.transform.ref:s.ref;return new a(this.state,u,this)},o.prototype.toRoot=function(){return new a(this.state,this.state.tree.root.ref,this)},o.prototype.delete=function(s){var u=ji.resolveRef(s);return!u||!this.state.tree.transforms.has(u)?this:(this.editInfo.count++,this.state.tree.remove(u),this.state.actions.push({kind:"delete",ref:u}),this)},o.prototype.getTree=function(){return t(this.state)},o.prototype.commit=function(s){if(!this.state.state)throw new Error("Cannot commit template tree");return this.state.state.runTask(this.state.state.updateTree(this,s))},o}();e.Root=i;var a=function(){function o(s,u,l){if(this.state=s,this.root=l,this.ref=u,!this.state.tree.transforms.has(u))throw new Error("Could not find node '"+u+"'.")}return Object.defineProperty(o.prototype,"editInfo",{get:function(){return this.state.editInfo},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"selector",{get:function(){return new UZ(this.ref,this.state.state)},enumerable:!1,configurable:!0}),o.prototype.getApplyRoot=function(){return fi.getDecoratorRoot(this.state.tree,this.ref)},o.prototype.apply=function(s,u,l){if(s.definition.isDecorator)return this.insert(s,u,l);var c=this.getApplyRoot(),d=s.apply(c,u,l);return this.state.tree.add(d),this.editInfo.count++,this.editInfo.lastUpdate=d.ref,this.state.actions.push({kind:"add",transform:d}),new o(this.state,d.ref,this.root)},o.prototype.applyOrUpdate=function(s,u,l,c){if(this.state.tree.transforms.has(s)){var d=this.to(s);return l&&d.update(l),d}else return this.apply(u,l,E(E({},c),{ref:s}))},o.prototype.applyOrUpdateTagged=function(s,u,l,c){if(u.definition.isDecorator)throw new Error("Can't use applyOrUpdateTagged on decorator transformers.");for(var d=this.getApplyRoot(),f=this.state.tree.children.get(d).values();;){var h=f.next();if(h.done)break;var v=this.state.tree.transforms.get(h.value);if(v&&fr.hasTags(v,s)){var p=this.to(h.value);return p.updateTagged(l,zU(v.tags,s,c&&c.tags)),p}}var m=u.apply(d,l,E(E({},c),{tags:zU(s,c&&c.tags)}));return this.state.tree.add(m),this.editInfo.count++,this.editInfo.lastUpdate=m.ref,this.state.actions.push({kind:"add",transform:m}),new o(this.state,m.ref,this.root)},o.prototype.group=function(s,u,l){return this.apply(s,u,l)},o.prototype.insert=function(s,u,l){var c=this.state.tree.children.get(this.ref).toArray(),d=s.apply(this.ref,u,l);this.state.tree.add(d);for(var f=0,h=c;f<h.length;f++){var v=h[f];this.state.tree.changeParent(v,d.ref)}return this.editInfo.count++,this.editInfo.lastUpdate=d.ref,this.state.actions.push({kind:"insert",ref:this.ref,transform:d}),new o(this.state,d.ref,this.root)},o.prototype.updateTagged=function(s,u){(this.state.tree.setParams(this.ref,s)||this.state.tree.setTags(this.ref,u))&&(this.editInfo.count++,this.editInfo.lastUpdate=this.ref,this.state.actions.push({kind:"update",ref:this.ref,params:s}))},o.prototype.update=function(s,u){var l;if(u){var c=this.state.tree.transforms.get(this.ref);l=Iv(c.params,u)}else l=typeof s=="function"?Iv(this.state.tree.transforms.get(this.ref).params,s):s;return this.state.tree.setParams(this.ref,l)&&(this.editInfo.count++,this.editInfo.lastUpdate=this.ref,this.state.actions.push({kind:"update",ref:this.ref,params:l})),this.root},o.prototype.to=function(s){return this.root.to(s)},o.prototype.toRoot=function(){return this.root.toRoot()},o.prototype.delete=function(s){return this.root.delete(s)},o.prototype.getTree=function(){return t(this.state)},o.prototype.commit=function(s){if(!this.state.state)throw new Error("Cannot commit template tree");return this.state.state.runTask(this.state.state.updateTree(this,s))},o}();e.To=a})(Fp||(Fp={}));function zU(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var r=void 0,n=[],i=0,a=e;i<a.length;i++){var o=a[i];if(o)if(r||(r=new Set),typeof o=="string"){if(r.has(o))continue;r.add(o),n.push(o)}else for(var s=0,u=o;s<u.length;s++){var l=u[s];r.has(l)||(r.add(l),n.push(l))}}return n}var jOe=function(){function e(){this.ev=hd.create(),this.actions=new Map,this.fromTypeIndex=new Map,this.events={added:this.ev(),removed:this.ev()}}return e.prototype.add=function(t){var r=ft.is(t)?t.toAction():t;if(this.actions.has(r.id))return this;this.actions.set(r.id,r);for(var n=0,i=r.definition.from;n<i.length;n++){var a=i[n];this.fromTypeIndex.has(a.type)?this.fromTypeIndex.get(a.type).push(r):this.fromTypeIndex.set(a.type,[r])}return this.events.added.next(),this},e.prototype.remove=function(t){var r=ft.is(t)?t.toAction().id:bn.is(t)?t:t.id,n=this.actions.get(r);if(!n)return this;this.actions.delete(r);for(var i=0,a=n.definition.from;i<a.length;i++){var o=a[i],s=this.fromTypeIndex.get(o.type);s&&(rv(s,n),s.length===0&&this.fromTypeIndex.delete(o.type))}return this.events.removed.next(),this},e.prototype.fromCell=function(t,r){var n=t.obj;if(!n)return[];var i=this.fromTypeIndex.get(n.type);if(!i)return[];for(var a=!1,o=0,s=i;o<s.length;o++){var u=s[o];if(u.definition.isApplicable){a=!0;break}}if(!a)return i;for(var l=[],c=0,d=i;c<d.length;c++){var u=d[c];u.definition.isApplicable?u.definition.isApplicable(n,t.transform,r)&&l.push(u):l.push(u)}return l},e.prototype.dispose=function(){this.ev.dispose()},e}(),Nl;(function(e){function t(a){return{type:"message",timestamp:new Date,message:a}}e.message=t;function r(a){return{type:"error",timestamp:new Date,message:a}}e.error=r;function n(a){return{type:"warning",timestamp:new Date,message:a}}e.warning=n;function i(a){return{type:"info",timestamp:new Date,message:a}}e.info=i})(Nl||(Nl={}));var Hb;(function(e){var t=function(){function i(a){this.cells=a,this._current=void 0}return Object.defineProperty(i.prototype,"current",{get:function(){return this._current},set:function(a){this._current=a},enumerable:!1,configurable:!0}),i.prototype.getAncestorOfType=function(a){if(this._current)for(var o=this._current;;){if(o=this.cells.get(o.transform.parent),!o.obj)return;if(o.obj.type===a.type)return o.obj;if(o.transform.ref===fr.RootRef)return}},i.prototype.getRootOfType=function(a){if(this._current)for(var o=this._current,s=void 0;;){if(!o.obj)return;if(o.obj.type===a.type&&(s=o),o.transform.ref===fr.RootRef)return s?s.obj:void 0;o=this.cells.get(o.transform.parent)}},i}();e.Impl=t;function r(i,a){for(var o=i.cells,s=o.get(a),u=[s];s!=null&&s.transform.transformer.definition.isDecorator;)s=o.get(s.transform.parent),u.push(s);return u}e.getDecoratorChain=r;function n(i,a,o){var s=void 0,u=i.cells.get(o);if(u)for(;;){if(!u.obj)return;if(u.obj.type===a.type&&(s=u),u.transform.ref===fr.RootRef)return s?s.obj:void 0;u=i.cells.get(u.transform.parent)}}e.getRootOfType=n})(Hb||(Hb={}));var zOe=function(){function e(){this.queue=[],this.signal=new ai}return Object.defineProperty(e.prototype,"length",{get:function(){return this.queue.length},enumerable:!1,configurable:!0}),e.prototype.enqueue=function(t){return this.queue.push(t),this.queue.length===1?!0:this.waitFor(t)},e.prototype.handled=function(t){Ub(this.queue,t),this.queue.length>0&&this.signal.next({v:this.queue[0],stillPresent:!0})},e.prototype.remove=function(t){var r=Ub(this.queue,t);return r&&this.signal.next({v:t,stillPresent:!1}),r},e.prototype.waitFor=function(t){var r=this;return new Promise(function(n){var i=r.signal.subscribe(function(a){var o=a.v,s=a.stillPresent;o===t&&(i.unsubscribe(),n(s))})})},e}(),VOe=function(){function e(t,r){this.getHash=t,this.areEqual=r,this.size=0,this.byHash=new Map}return e.prototype.add=function(t){var r=this.getHash(t);if(this.byHash.has(r)){for(var n=this.byHash.get(r),i=0,a=n.length;i<a;i++)if(this.areEqual(t,n[i]))return!1;return n[n.length]=t,this.size++,!0}else return this.byHash.set(r,[t]),this.size++,!0},e.prototype.has=function(t){var r=this.getHash(t);if(!this.byHash.has(r))return!1;for(var n=this.byHash.get(r),i=0,a=n.length;i<a;i++)if(this.areEqual(t,n[i]))return!0;return!1},e}();function V6(e,t){return new VOe(e,t)}function SD(){return new HOe}function VU(e){return{previous:null,next:null,inList:!0,value:e}}var HOe=function(){function e(){this.count=0,this.first=null,this.last=null}return e.prototype.addFirst=function(t){var r=VU(t);return r.inList=!0,this.first&&(this.first.previous=r),r.next=this.first,this.first=r,this.count++,this.last||(this.last=r),r},e.prototype.addLast=function(t){var r=VU(t);return this.last!==null&&(this.last.next=r),r.previous=this.last,this.last=r,this.first===null&&(this.first=r),r.inList=!0,this.count++,r},e.prototype.removeFirst=function(){var t=this.first;if(t)return this.remove(t),t.value},e.prototype.removeLast=function(){var t=this.last;if(t)return this.remove(t),t.value},e.prototype.remove=function(t){t.inList&&(t.inList=!1,t.previous!==null?t.previous.next=t.next:t.previous===null&&(this.first=t.next),t.next!==null?t.next.previous=t.previous:t.next===null&&(this.last=t.previous),t.next=null,t.previous=null,this.count--)},e.prototype.find=function(t){for(var r=this.first;r!==null;){if(r.value===t)return r;r=r.next}},e}(),an;(function(e){function t(){return{keys:new Set,array:[]}}e.create=t;function r(i,a,o){var s=i.keys,u=i.array;return s.has(a)?!1:(s.add(a),u[u.length]=o,!0)}e.add=r;function n(i,a){var o=i.keys;return o.has(a)}e.has=n})(an||(an={}));var Th=function(){function e(t,r){var n=this;this.errorFree=!0,this.ev=hd.create(),this.globalContext=void 0,this.events={cell:{stateUpdated:this.ev(),created:this.ev(),removed:this.ev()},object:{updated:this.ev(),created:this.ev(),removed:this.ev()},log:this.ev(),changed:this.ev(),historyUpdated:this.ev()},this.behaviors={currentObject:this.ev.behavior({state:this,ref:fr.RootRef}),isUpdating:this.ev.behavior(!1)},this.actions=new jOe,this.cells=new Map,this.spine=new Hb.Impl(this.cells),this.tryGetCellData=function(o){var s,u,l=(u=(s=n.cells.get(o))===null||s===void 0?void 0:s.obj)===null||u===void 0?void 0:u.data;if(!o)throw new Error("Cell '"+o+"' data undefined.");return l},this.historyCapacity=5,this.history=[],this.undoingHistory=!1,this.inTransaction=!1,this.inTransactionError=!1,this._inUpdate=!1,this.reverted=!1,this.updateQueue=new zOe,this._tree=fi.createEmpty(fr.createRoot(r&&r.rootState)).asTransient();var i=this._tree,a=i.root;this.runTask=r.runTask,(r==null?void 0:r.historyCapacity)!==void 0&&(this.historyCapacity=r.historyCapacity),this.cells.set(a.ref,{parent:this,transform:a,sourceRef:void 0,obj:t,status:"ok",state:E({},a.state),errorText:void 0,params:{definition:{},values:{}},paramsNormalizedVersion:a.version,dependencies:{dependentBy:[],dependsOn:[]},cache:{}}),this.globalContext=r&&r.globalContext}return Object.defineProperty(e.prototype,"tree",{get:function(){return this._tree},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"transforms",{get:function(){return this._tree.transforms},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"current",{get:function(){return this.behaviors.currentObject.value.ref},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"root",{get:function(){return this.cells.get(this._tree.root.ref)},enumerable:!1,configurable:!0}),e.prototype.build=function(){return new Fp.Root(this.tree,this)},e.prototype.addHistory=function(t,r){this.historyCapacity!==0&&(this.history.unshift([t,r||"Update"]),this.history.length>this.historyCapacity&&this.history.pop(),this.events.historyUpdated.next({state:this}))},e.prototype.clearHistory=function(){this.history.length!==0&&(this.history=[],this.events.historyUpdated.next({state:this}))},Object.defineProperty(e.prototype,"latestUndoLabel",{get:function(){return this.history.length>0?this.history[0][1]:void 0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"canUndo",{get:function(){return this.history.length>0},enumerable:!1,configurable:!0}),e.prototype.undo=function(){var t=this;return $e.create("Undo",function(r){return ce(t,void 0,void 0,function(){var n;return de(this,function(i){switch(i.label){case 0:if(n=this.history.shift(),!n)return[2];this.events.historyUpdated.next({state:this}),this.undoingHistory=!0,i.label=1;case 1:return i.trys.push([1,,3,4]),[4,this.updateTree(n[0],{canUndo:!1}).runInContext(r)];case 2:return i.sent(),[3,4];case 3:return this.undoingHistory=!1,[7];case 4:return[2]}})})})},e.prototype.getSnapshot=function(){return{tree:fi.toJSON(this._tree)}},e.prototype.setSnapshot=function(t){var r=fi.fromJSON(t.tree);return this.updateTree(r)},e.prototype.setCurrent=function(t){this.behaviors.currentObject.next({state:this,ref:t})},e.prototype.updateCellState=function(t,r){var n=this.cells.get(t);if(n){var i=typeof r=="function"?r(n.state):r;fr.assignState(n.state,i)&&(n.transform=this._tree.assignState(n.transform.ref,i),this.events.cell.stateUpdated.next({state:this,ref:t,cell:n}))}},e.prototype.dispose=function(){this.ev.dispose(),this.actions.dispose()},e.prototype.select=function(t){return or.select(t,this)},e.prototype.selectQ=function(t){return typeof t=="string"?or.select(t,this):or.select(t(or.Generators),this)},e.prototype.applyAction=function(t,r,n){var i=this;return n===void 0&&(n=fr.RootRef),$e.create("Apply Action",function(a){var o=i.cells.get(n);if(!o)throw new Error("'"+n+"' does not exist.");if(o.status!=="ok")throw new Error("Action cannot be applied to a cell with status '"+o.status+"'");return H6(t.definition.run({ref:n,cell:o,a:o.obj,params:r,state:i},i.globalContext),a)})},e.prototype.transaction=function(t,r){var n=this;return $e.create("State Transaction",function(i){return ce(n,void 0,void 0,function(){var a,o,s,u;return de(this,function(l){switch(l.label){case 0:a=this.inTransaction,o=this._tree.asImmutable(),s=!1,l.label=1;case 1:return l.trys.push([1,5,8,9]),a||this.behaviors.isUpdating.next(!0),this.inTransaction=!0,this.inTransactionError=!1,[4,t(i)];case 2:return l.sent(),this.inTransactionError?(s=!0,[4,this.updateTree(o).runInContext(i)]):[3,4];case 3:l.sent(),l.label=4;case 4:return[3,9];case 5:return u=l.sent(),s?[3,7]:(s=!0,[4,this.updateTree(o).runInContext(i)]);case 6:l.sent(),this.events.log.next(Nl.error(""+u)),l.label=7;case 7:if(a)throw this.inTransactionError=!0,u;if(r!=null&&r.rethrowErrors)throw u;return[3,9];case 8:return a||(this.inTransaction=!1,this.events.changed.next({state:this,inTransaction:!1}),this.behaviors.isUpdating.next(!1),s||(r!=null&&r.canUndo?this.addHistory(o,typeof r.canUndo=="string"?r.canUndo:void 0):this.clearHistory())),[7];case 9:return[2]}})})})},Object.defineProperty(e.prototype,"inUpdate",{get:function(){return this._inUpdate},enumerable:!1,configurable:!0}),e.prototype.updateTree=function(t,r){var n=this,i={tree:t,options:r};return $e.create("Update Tree",function(a){return ce(n,void 0,void 0,function(){var o,s,u,l,c;return de(this,function(d){switch(d.label){case 0:return[4,this.updateQueue.enqueue(i)];case 1:if(o=d.sent(),!o)return[2];this._inUpdate=!0,s=r!=null&&r.canUndo?this._tree.asImmutable():void 0,u=!1,this.inTransaction||this.behaviors.isUpdating.next(!0),d.label=2;case 2:if(d.trys.push([2,,7,8]),Fp.is(t)){if(t.editInfo.applied)throw new Error("This builder has already been applied. Create a new builder for further state updates");t.editInfo.applied=!0}return this.reverted=!1,r&&(r.revertIfAborted||r.revertOnError)?[4,this._revertibleTreeUpdate(a,i,r)]:[3,4];case 3:return c=d.sent(),[3,6];case 4:return[4,this._updateTree(a,i)];case 5:c=d.sent(),d.label=6;case 6:return l=c,u=this.reverted,l.ctx.hadError&&(this.inTransactionError=!0),l.cell?[2,new UZ(l.cell.transform.ref,this)]:[2];case 7:return this._inUpdate=!1,this.updateQueue.handled(i),this.inTransaction||(this.behaviors.isUpdating.next(!1),r!=null&&r.canUndo?u||this.addHistory(s,typeof r.canUndo=="string"?r.canUndo:void 0):this.undoingHistory||this.clearHistory()),[7];case 8:return[2]}})})},function(){n.updateQueue.remove(i)})},e.prototype._revertibleTreeUpdate=function(t,r,n){return ce(this,void 0,void 0,function(){var i,a,o;return de(this,function(s){switch(s.label){case 0:return i=this.tree,[4,this._updateTree(t,r)];case 1:return a=s.sent(),o=(a.ctx.hadError||a.ctx.wasAborted)&&n.revertOnError||a.ctx.wasAborted&&n.revertIfAborted,o?(this.reverted=!0,[4,this._updateTree(t,{tree:i,options:r.options})]):[3,3];case 2:return[2,s.sent()];case 3:return[2,a]}})})},e.prototype._updateTree=function(t,r){return ce(this,void 0,void 0,function(){var n,i,a;return de(this,function(o){switch(o.label){case 0:n=!1,i=this.updateTreeAndCreateCtx(r.tree,t,r.options),o.label=1;case 1:return o.trys.push([1,,3,4]),[4,qOe(i)];case 2:return n=o.sent(),Fp.isTo(r.tree)?(a=this.select(r.tree.ref)[0],[2,{ctx:i,cell:a}]):[2,{ctx:i}];case 3:return this.spine.current=void 0,n&&this.events.changed.next({state:this,inTransaction:this.inTransaction}),[7];case 4:return[2]}})})},e.prototype.updateTreeAndCreateCtx=function(t,r,n){var i=(Fp.is(t)?t.getTree():t).asTransient(),a=this._tree;this._tree=i;var o=this.cells,s={parent:this,editInfo:Fp.is(t)?t.editInfo:void 0,errorFree:this.errorFree,taskCtx:r,oldTree:a,tree:i,cells:this.cells,spine:this.spine,results:[],options:E(E({},GOe),n),changed:!1,hadError:!1,wasAborted:!1,newCurrent:void 0,getCellData:function(u){var l;return(l=o.get(u).obj)===null||l===void 0?void 0:l.data}};return this.errorFree=!0,s},e}();(function(e){function t(r,n){return new e(r,n)}e.create=t,function(r){function n(i,a){return!!a&&i.ref===a.transform.ref&&i.state===a.parent}r.isCell=n}(e.ObjectEvent||(e.ObjectEvent={}))})(Th||(Th={}));var GOe={doNotLogTiming:!1,doNotUpdateCurrent:!0,revertIfAborted:!1,revertOnError:!1,canUndo:!1};function qOe(e){return ce(this,void 0,void 0,function(){var t,r,n,i,O,a,o,s,m,u,p,S,l,c,m,S,d,f,h,v,S,p,m,g,y,b,S,x,C,w,A,M,D,k,R,O,H;return de(this,function(B){switch(B.label){case 0:if(t=!!(e.editInfo&&e.editInfo.count===1&&e.editInfo.lastUpdate&&e.editInfo.sourceTree===e.oldTree),n=[],t)r=[],i=[e.editInfo.lastUpdate];else{for(r=YOe(e),O=e.parent.current,a=!1,o=0,s=r;o<s.length;o++)if(m=s[o],m===O){a=!0;break}for(a&&(u=HU(e.oldTree,O,r,e.cells),e.parent.setCurrent(u)),p=r.length-1;p>=0;p--)S=e.cells.get(r[p]),S&&_D(S.transform,S.obj,S==null?void 0:S.transform.params,S.cache,e.parent.globalContext);for(l=0,c=r;l<c.length;l++)m=c[l],S=e.cells.get(m),S&&(S.parent=void 0,e6e(S)),d=S&&S.obj,e.cells.delete(m),n.push(d);i=$Oe(e.cells,e.tree)}for(f=n6e(e,i),h=0,v=f.added;h<v.length;h++)S=v[h],e.parent.events.cell.created.next({state:e.parent,ref:S.transform.ref,cell:S});for(p=0;p<r.length;p++)m=r[p],g=e.oldTree.transforms.get(m).parent,e.parent.events.object.removed.next({state:e.parent,ref:m,obj:n[p]}),e.parent.events.cell.removed.next({state:e.parent,ref:m,parent:g});if(n.length&&(n=[]),f.dependent)for(y=0,b=f.dependent;y<b.length;y++)S=b[y],i.push(S.transform.ref);JOe(e,i),x=0,C=i,B.label=1;case 1:return x<C.length?(w=C[x],[4,vJ(e,w)]):[3,4];case 2:B.sent(),B.label=3;case 3:return x++,[3,1];case 4:for(e.editInfo||QOe(e),A=e.newCurrent,M=0,D=e.results;M<D.length;M++)k=D[M],k.action==="created"?(e.parent.events.object.created.next({state:e.parent,ref:k.ref,obj:k.obj}),e.newCurrent||(R=e.tree.transforms.get(k.ref),!R.state.isGhost&&k.obj!==Nn.Null&&(A=k.ref))):k.action==="updated"?e.parent.events.object.updated.next({state:e.parent,ref:k.ref,action:"in-place",obj:k.obj,oldData:k.oldData}):k.action==="replaced"&&e.parent.events.object.updated.next({state:e.parent,ref:k.ref,action:"recreate",obj:k.obj,oldObj:k.oldObj});return A?e.options.doNotUpdateCurrent||e.parent.setCurrent(A):(O=e.parent.current,H=e.cells.get(O),H&&(H.obj===Nn.Null||H.status==="error"&&H.errorText===i6e)&&(A=HU(e.oldTree,O,[],e.cells),e.parent.setCurrent(A))),[2,r.length>0||i.length>0||e.changed]}})})}function $Oe(e,t){var r={roots:[],cells:e};return fi.doPreOrder(t,t.root,r,WOe),r.roots}function WOe(e,t,r){var n=r.cells.get(e.ref);return!n||n.transform.version!==e.version?(r.roots.push(e.ref),!1):!(n.status==="error"||n&&n.obj===Nn.Null)}function XOe(e,t,r){!r.newTree.transforms.has(e.ref)&&r.cells.has(e.ref)&&r.deletes.push(e.ref)}function YOe(e){var t={newTree:e.tree,cells:e.cells,deletes:[]};return fi.doPostOrder(e.oldTree,e.oldTree.root,t,XOe),t.deletes}function KOe(e,t,r){var n=r.cells.get(e.ref);!n||!fr.syncState(n.state,e.state)||r.parent.events.cell.stateUpdated.next({state:r.parent,ref:e.ref,cell:n})}function QOe(e){fi.doPreOrder(e.tree,e.tree.root,e,KOe)}function lw(e,t,r,n){var i=e.cells.get(t),a=i.status!==r;i.status=r,i.errorText=n,a&&e.parent.events.cell.stateUpdated.next({state:e.parent,ref:t,cell:i})}function ZOe(e,t,r){r.cells.get(e.ref).transform=e,lw(r,e.ref,"pending")}function JOe(e,t){for(var r=0,n=t;r<n.length;r++){var i=n[r];fi.doPreOrder(e.tree,e.tree.transforms.get(i),e,ZOe)}}function e6e(e){for(var t=0,r=e.dependencies.dependsOn;t<r.length;t++){var n=r[t];rv(n.dependencies.dependentBy,e)}}function t6e(e,t,r){var n=r.ctx,i=r.added,a=r.visited;if(a.add(e.ref),!n.cells.has(e.ref)){var o={parent:n.parent,transform:e,sourceRef:void 0,status:"pending",state:E({},e.state),errorText:void 0,params:void 0,paramsNormalizedVersion:"",dependencies:{dependentBy:[],dependsOn:[]},cache:void 0};n.cells.set(e.ref,o),i.push(o)}}function r6e(e,t){if(e.transform.dependsOn)for(var r=0,n=e.transform.dependsOn;r<n.length;r++){var i=n[r],a=t.tree.transforms.get(i);if(!a)throw new Error("Cannot depend on a non-existent transform.");var o=t.cells.get(i);ja(e.dependencies.dependsOn,o),ja(o.dependencies.dependentBy,e)}}function n6e(e,t){for(var r={ctx:e,visited:new Set,added:[]},n=0,i=t;n<i.length;n++){var a=i[n];fi.doPreOrder(e.tree,e.tree.transforms.get(a),r,t6e)}for(var o=0,s=r.added;o<s.length;o++){var u=s[o];r6e(u,e)}var l;return r.visited.forEach(function(c){for(var d=e.cells.get(c),f=0,h=d.dependencies.dependentBy;f<h.length;f++){var v=h[f];r.visited.has(v.transform.ref)||(l||(l=an.create()),an.add(l,v.transform.ref,v))}}),{added:r.added,dependent:l?l.array:void 0}}function HU(e,t,r,n){var i=new Set(r);return pJ(e,t,i,n)}function pJ(e,t,r,n){if(t===fr.RootRef)return t;for(var i=e.transforms.get(t),a=e.children.get(i.parent).values(),o=void 0,s=!1;;){var u=a.next();if(u.done)break;if(!r.has(u.value)){var l=n.get(u.value);if(!(!l||l.status==="error"||l.obj===Nn.Null)){var c=e.transforms.get(u.value);if(!c.state.isGhost){if(u.value===t){s=!0,r.has(t)||(o=t);continue}if(s)return c.ref;o=c.ref}}}}return o||pJ(e,i.parent,r,n)}function CD(e,t,r,n){n||(e.hadError=!0,e.parent.errorFree=!1);var i=e.cells.get(t);if(r){e.wasAborted=e.wasAborted||$e.isAbort(r);var a=""+r;lw(e,t,"error",a),n||e.parent.events.log.next({type:"error",timestamp:new Date,message:a})}else i.params=void 0;if(i.obj){var o=i.obj;i.obj=void 0,i.cache=void 0,e.parent.events.object.removed.next({state:e.parent,ref:t,obj:o})}for(var s=e.tree.children.get(t).values();;){var u=s.next();if(u.done)return;CD(e,u.value,void 0,n)}}var i6e="Parent is null";function vJ(e,t){return ce(this,void 0,void 0,function(){var r,n,i,a,o,s,u;return de(this,function(l){switch(l.label){case 0:lw(e,t,"processing"),r=!1,l.label=1;case 1:return l.trys.push([1,3,,4]),n=Ln(),[4,o6e(e,t)];case 2:return i=l.sent(),a=Ln()-n,i.action!=="none"&&(e.changed=!0),lw(e,t,"ok"),e.results.push(i),i.action==="created"?(r=i.obj===Nn.Null,!r&&!e.options.doNotLogTiming&&e.parent.events.log.next(Nl.info("Created "+i.obj.label+" in "+mC(a)+"."))):(i.action==="updated"||i.action==="replaced")&&(r=i.obj===Nn.Null,!r&&!e.options.doNotLogTiming&&e.parent.events.log.next(Nl.info("Updated "+i.obj.label+" in "+mC(a)+"."))),[3,4];case 3:return o=l.sent(),e.changed=!0,e.hadError||(e.newCurrent=t),CD(e,t,o,!1),j0||console.error(o),[2];case 4:s=e.tree.children.get(t).values(),l.label=5;case 5:return u=s.next(),u.done?[2]:r?(CD(e,u.value,void 0,!0),[3,8]):[3,6];case 6:return[4,vJ(e,u.value)];case 7:l.sent(),l.label=8;case 8:return[3,5];case 9:return[2]}})})}function a6e(e,t,r,n){var i=t.transformer.definition.params,a=i?i(r,e.parent.globalContext):{};if(n.paramsNormalizedVersion!==t.version)t.params=I.normalizeParams(a,t.params,"all"),n.paramsNormalizedVersion=t.version;else{var o=I.getDefaultValues(a);t.params=t.params?NRe(t.params,o):o}return I.resolveRefs(a,t.params,e.getCellData),{definition:a,values:t.params}}function o6e(e,t){var r;return ce(this,void 0,void 0,function(){var n,i,a,o,s,u,l,c,d,f,h,v,p,m,g,y,b;return de(this,function(S){switch(S.label){case 0:if(n=e.oldTree,i=e.tree,a=e.cells.get(t),o=a.transform,a.transform.ref===fr.RootRef)return[2,{action:"none"}];if(s=o.transformer.definition.from.length===0?e.cells.get(a.transform.parent):or.findAncestorOfType(i,e.cells,t,o.transformer.definition.from),!s)throw new Error("No suitable parent found for '"+t+"'");return e.spine.current=a,u=s.obj,a.sourceRef=s.transform.ref,l=a6e(e,o,u,a),!n.transforms.has(t)||!a.params?(a.params=l,[4,GU(e,a,o.transformer,u,l.values)]):[3,2];case 1:return c=S.sent(),VP(c,o),a.obj=c,[2,{ref:t,action:"created",obj:c}];case 2:return d=a.params.values,f=a.cache,h=(r=a.obj)===null||r===void 0?void 0:r.data,v=l.values,a.params=l,a.obj&&a.obj!==Nn.Null?[4,s6e(e,a,o.transformer,u,a.obj,d,v)]:[3,4];case 3:return m=S.sent(),[3,5];case 4:m=ft.UpdateResult.Recreate,S.label=5;case 5:switch(p=m,g=p,g){case ft.UpdateResult.Recreate:return[3,6];case ft.UpdateResult.Updated:return[3,8];case ft.UpdateResult.Null:return[3,9]}return[3,10];case 6:return y=a.obj,_D(o,y,d,f,e.parent.globalContext),[4,GU(e,a,o.transformer,u,v)];case 7:return b=S.sent(),VP(b,o),a.obj=b,[2,{ref:t,action:"replaced",oldObj:y,obj:b}];case 8:return VP(a.obj,o),[2,{ref:t,action:"updated",oldData:h,obj:a.obj}];case 9:return _D(o,a.obj,d,f,e.parent.globalContext),a.obj=Nn.Null,[2,{ref:t,action:"updated",obj:a.obj}];case 10:return[2,{action:"none"}]}})})}function _D(e,t,r,n,i){var a,o;(o=(a=e.transformer.definition).dispose)===null||o===void 0||o.call(a,{b:t!==Nn.Null?t:void 0,params:r,cache:n},i)}function VP(e,t){!e||e===Nn.Null||(e.tags=t.tags)}function H6(e,t){return typeof e.runInContext=="function"?e.runInContext(t):e}function mJ(e){if(e.dependencies.dependsOn.length!==0){for(var t=Object.create(null),r=0,n=e.dependencies.dependsOn;r<n.length;r++){var i=n[r];if(!i.obj)throw new Error("Unresolved dependency.");t[i.transform.ref]=i.obj}return t}}function GU(e,t,r,n,i){return t.cache||(t.cache=Object.create(null)),H6(r.definition.apply({a:n,params:i,cache:t.cache,spine:e.spine,dependencies:mJ(t)},e.parent.globalContext),e.taskCtx)}function s6e(e,t,r,n,i,a,o){return ce(this,void 0,void 0,function(){return de(this,function(s){return r.definition.update?(t.cache||(t.cache=Object.create(null)),[2,H6(r.definition.update({a:n,oldParams:a,b:i,newParams:o,cache:t.cache,spine:e.spine,dependencies:mJ(t)},e.parent.globalContext),e.taskCtx)]):[2,ft.UpdateResult.Recreate]})})}var hs={kind:"null-location"};function gJ(e,t,r){return{kind:"data-location",tag:e,data:t,element:r}}function wn(e,t,r,n,i,a){if(i===void 0&&(i=!1),a===void 0&&(a=function(){return!1}),e%r!==0)throw new Error("incompatible groupCount and stride");var o={location:hs,index:0,groupIndex:0,instanceIndex:0,isSecondary:!1},s=o.groupIndex<e,u=!1,l=0,c=0,d=!1;return{get hasNext(){return s},get isNextNewInstance(){return u},groupCount:e,instanceCount:t,count:e*t,stride:r,nonInstanceable:i,move:function(){return s&&(o.groupIndex=l,o.instanceIndex=c,o.index=c*e+l,o.location=n(l,d?-1:c),o.isSecondary=a(l,d?-1:c),l+=r,l===e?(++c,u=!0,c<t&&(l=0)):u=!1,s=l<e),o},reset:function(){o.location=hs,o.index=0,o.groupIndex=0,o.instanceIndex=0,o.isSecondary=!1,s=o.groupIndex<e,u=!1,l=0,c=0,d=!1},skipInstance:function(){s&&o.instanceIndex===c&&(++c,l=0,s=c<t)},voidInstances:function(){d=!0}}}function em(e){return{kind:"position-location",position:e?_.clone(e):_()}}var qU=Yn(),u6e=ue();function l6e(e,t){for(var r=0;r<t;r++)if(Yn.fromMat4(qU,ue.fromArray(u6e,e,r*16)),Yn.determinant(qU)<0)return!0;return!1}function G6(e,t,r){var n=l6e(e,t);if(r){L.update(r.matrix,r.matrix.ref.value),L.update(r.transform,e),L.updateIfChanged(r.uInstanceCount,t),L.updateIfChanged(r.instanceCount,t);var i=r.aTransform.ref.value.length>=t*16?r.aTransform.ref.value:new Float32Array(t*16);i.set(e),L.update(r.aTransform,i);var a=r.extraTransform.ref.value.length>=t*16?r.extraTransform.ref.value:new Float32Array(t*16);L.update(r.extraTransform,cw(a,t));var o=r.aInstance.ref.value.length>=t?r.aInstance.ref.value:new Float32Array(t);return L.update(r.aInstance,Js(o,t)),L.update(r.hasReflection,n),yJ(r),r}else return{aTransform:L.create(new Float32Array(e)),matrix:L.create(ue.identity()),transform:L.create(e),extraTransform:L.create(cw(new Float32Array(t*16),t)),uInstanceCount:L.create(t),instanceCount:L.create(t),aInstance:L.create(Js(new Float32Array(t))),hasReflection:L.create(n)}}var q6=new Float32Array(16);ue.toArray(ue.identity(),q6,0);function $6(e){return G6(new Float32Array(q6),1,e)}function cw(e,t){for(var r=0;r<t;r++)e.set(q6,r*16);return e}function yJ(e){for(var t=e.aTransform.ref.value,r=e.instanceCount.ref.value,n=e.matrix.ref.value,i=e.transform.ref.value,a=e.extraTransform.ref.value,o=0;o<r;o++){var s=o*16;ue.mulOffset(t,a,i,s,s,s),ue.mulOffset(t,n,t,s,0,s)}L.update(e.aTransform,t)}var pr={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflower:6591981,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,laserlemon:16777044,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrod:16448210,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,maroon2:8323072,maroon3:11546720,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,purple2:8323199,purple3:10494192,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};(function(){var e=new Map;return Object.keys(pr).forEach(function(t){e.set(pr[t],t)}),e})();var bJ=at(13421772),c6e="Gives everything the same, uniform color.",xJ={value:I.Color(bJ)};function d6e(e){return xJ}function W6(e,t){var r=Oi(t.value,bJ);return{factory:W6,granularity:"uniform",color:function(){return r},props:t,description:c6e,legend:Gh([["uniform",r]])}}var f6e={name:"uniform",label:"Uniform",category:"Miscellaneous",factory:W6,getParams:d6e,defaultValues:I.getDefaultValues(xJ),isApplicable:function(e){return!0}},h6e="Gives everything the same, uniform size.",SJ={value:I.Numeric(1,{min:0,max:20,step:.1})};function p6e(e){return SJ}function X6(e,t){var r=t.value;return{factory:X6,granularity:"uniform",size:function(){return r},props:t,description:h6e}}var v6e={name:"uniform",label:"Uniform",category:"",factory:X6,getParams:p6e,defaultValues:I.getDefaultValues(SJ),isApplicable:function(e){return!0}},m6e={custom:{},auto:{},highest:{},higher:{},high:{},medium:{},low:{},lower:{},lowest:{}},g6e=Object.keys(m6e),Y6=I.arrayToOptions(g6e),Et;(function(e){e.Params={alpha:I.Numeric(1,{min:0,max:1,step:.01},{label:"Opacity",isEssential:!0,description:"How opaque/transparent the representation is rendered."}),quality:I.Select("auto",Y6,{isEssential:!0,description:"Visual/rendering quality of the representation."})},e.ShadingCategory={category:"Shading"},e.CustomQualityParamInfo={category:"Custom Quality",hideIf:function(o){return typeof o.quality<"u"&&o.quality!=="custom"}};function t(o,s,u){o===void 0&&(o=pr.grey),s===void 0&&(s=1),u||(u=$6());var l=wn(1,u.instanceCount.ref.value,1,function(){return hs},!1,function(){return!1}),c={color:W6({},{value:o}),size:X6({},{value:s})};return{transform:u,locationIterator:l,theme:c}}e.createSimple=t;function r(o,s){return{alpha:L.create(o.alpha),uAlpha:L.create(o.alpha),uVertexCount:L.create(s.vertexCount),uGroupCount:L.create(s.groupCount),drawCount:L.create(s.drawCount)}}e.createValues=r;function n(o,s){L.updateIfChanged(o.alpha,s.alpha)}e.updateValues=n;function i(o){o===void 0&&(o={});var s=o.alpha===void 0?!0:o.alpha===1;return{disposed:!1,visible:!0,alphaFactor:1,pickable:!0,colorOnly:!1,opaque:s,writeDepth:s,noClip:!1}}e.createRenderableState=i;function a(o,s){o.opaque=s.alpha*o.alphaFactor>=1,o.writeDepth=o.opaque}e.updateRenderableState=a})(Et||(Et={}));function Bf(e,t){return{value:e,unit:t}}var Gb;(function(e){function t(u,l,c){var d=!!u[0].cell,f=!!u[0].velocities,h=!!u[0].forces;return{id:bn.create22(),frames:u,hasCell:d,hasVelocities:f,hasForces:h,deltaTime:l,timeOffset:c}}e.create=t;function r(u,l,c){var d=u.x,f=u.y,h=u.z;return u.xyzOrdering.frozen?c?u.xyzOrdering.isIdentity?(d=o(d,c),f=o(f,c),h=o(h,c)):so(u.xyzOrdering.index,c)||(d=a(d,u.xyzOrdering.index,c),f=a(f,u.xyzOrdering.index,c),h=a(h,u.xyzOrdering.index,c)):u.xyzOrdering.isIdentity||(d=s(d,u.xyzOrdering.index),f=s(f,u.xyzOrdering.index),h=s(h,u.xyzOrdering.index)):c&&(u.xyzOrdering.isIdentity?(u.xyzOrdering.isIdentity=!1,u.xyzOrdering.index=c,i(d,c),i(f,c),i(h,c)):so(u.xyzOrdering.index,c)||(d=a(d,u.xyzOrdering.index,c),f=a(f,u.xyzOrdering.index,c),h=a(h,u.xyzOrdering.index,c))),u.xyzOrdering.frozen=!0,{id:bn.create22(),atomId:l,occupancy:ve.ofConst(1,u.elementCount,ve.Schema.int),B_iso_or_equiv:ve.ofConst(0,u.elementCount,ve.Schema.float),xyzDefined:!0,x:d,y:f,z:h}}e.getAtomicConformation=r;var n=[.123];function i(u,l){for(var c=n,d=0,f=u.length;d<f;d++)c[d]=u[l[d]];for(var d=0,f=u.length;d<f;d++)u[d]=c[d]}function a(u,l,c){for(var d=new Float32Array(u.length),f=0,h=u.length;f<h;f++)d[f]=u[l[c[f]]];return d}function o(u,l){for(var c=new Float32Array(u.length),d=0,f=u.length;d<f;d++)c[d]=u[l[d]];return c}function s(u,l){for(var c=new Float32Array(u.length),d=0,f=u.length;d<f;d++)c[l[d]]=u[d];return c}})(Gb||(Gb={}));var wD;(function(e){function t(r,n,i,a){return{id:bn.create22(),label:r,basic:n,sourceData:a,bonds:i}}e.create=t})(wD||(wD={}));function ko(e){return e}(function(e){function t(r){return r.__key||(r.__key=bn.create22()),r.__key}e.getUUID=t})(ko||(ko={}));var nc=function(){function e(){this._list=[],this._set=new Set,this._refs=new Map,this._assets=new Map}return Object.defineProperty(e.prototype,"all",{get:function(){return this._list},enumerable:!1,configurable:!0}),e.prototype.add=function(t){this._set.has(t)||(this._list.push(t),this._set.add(t))},e.prototype.reference=function(t,r){var n=this._refs.get(t)||0;n+=r?1:-1,this._refs.set(t,Math.max(n,0))},e.prototype.hasReference=function(t){return(this._refs.get(t)||0)>0},e.prototype.has=function(t){return this._set.has(t)},e.prototype.assets=function(t,r){var n=this._assets.get(t);if(n)for(var i=0,a=n;i<a.length;i++){var o=a[i];o.dispose()}r?this._assets.set(t,r):this._assets.delete(t)},e.prototype.dispose=function(){this._assets.forEach(function(t){for(var r=0,n=t;r<n.length;r++){var i=n[r];i.dispose()}})},e}();function y6e(e,t){var r=[],n=[],i=[];e.x.length&&(r.push.apply(r,qo(e.x)),n.push.apply(n,qo(e.y)),i.push.apply(i,qo(e.z))),t&&(t.spheres.x.length&&(r.push.apply(r,qo(t.spheres.x)),n.push.apply(n,qo(t.spheres.y)),i.push.apply(i,qo(t.spheres.z))),t.gaussians.x.length&&(r.push.apply(r,qo(t.gaussians.x)),n.push.apply(n,qo(t.gaussians.y)),i.push.apply(i,qo(t.gaussians.z))));var a=qo(r),o=a[0],s=a[1],u=qo(n),l=u[0],c=u[1],d=qo(i),f=d[0],h=d[1],v=o+(s-o)/2,p=l+(c-l)/2,m=f+(h-f)/2;return _.create(v,p,m)}function b6e(e){var t=new Set,r=new Set;return e.properties.structAsymMap.forEach(function(n,i){var a=n.auth_id;t.add(a),r.add(i)}),{auth:t.size,label:r.size}}var Oo;(function(e){function t(d,f){if(d===f)return!0;if(d.vertexCount!==f.vertexCount||d.edgeCount!==f.edgeCount)return!1;for(var h=d.a,v=d.b,p=d.offset,m=f.a,g=f.b,y=f.offset,b=0,S=d.a.length;b<S;b++)if(h[b]!==m[b])return!1;for(var b=0,S=d.b.length;b<S;b++)if(v[b]!==g[b])return!1;for(var b=0,S=d.offset.length;b<S;b++)if(p[b]!==y[b])return!1;for(var x=0,C=Object.keys(d.edgeProps);x<C.length;x++){var w=C[x],A=d.edgeProps[w],M=f.edgeProps[w];if(!M)return!1;for(var b=0,S=A.length;b<S;b++)if(A[b]!==M[b])return!1}return!0}e.areEqual=t;var r=function(){function d(f,h,v,p,m,g){this.offset=f,this.a=h,this.b=v,this.edgeCount=p,this.props=g,this.vertexCount=f.length-1,this.edgeProps=m||{}}return d.prototype.getEdgeIndex=function(f,h){var v,p;f<h?(v=f,p=h):(v=h,p=f);for(var m=this.offset[v],g=this.offset[v+1];m<g;m++)if(this.b[m]===p)return m;return-1},d.prototype.getDirectedEdgeIndex=function(f,h){for(var v=this.offset[f],p=this.offset[f+1];v<p;v++)if(this.b[v]===h)return v;return-1},d.prototype.getVertexEdgeCount=function(f){return this.offset[f+1]-this.offset[f]},d}();function n(d,f,h,v,p,m){return new r(d,f,h,v,p,m)}e.create=n;var i=function(){function d(f,h,v){this.vertexCount=f,this.xs=h,this.ys=v,this.current=0,this.curA=0,this.curB=0,this.edgeCount=h.length,this.offsets=new Int32Array(this.vertexCount+1),this.bucketFill=new Int32Array(this.vertexCount);for(var p=new Int32Array(this.vertexCount),m=0,g=this.xs.length;m<g;m++)p[this.xs[m]]++;for(var m=0,g=this.ys.length;m<g;m++)p[this.ys[m]]++;for(var y=0,m=0;m<this.vertexCount;m++)this.offsets[m]=y,y+=p[m];this.offsets[this.vertexCount]=y,this.slotCount=y,this.a=new Int32Array(y),this.b=new Int32Array(y)}return d.prototype.createGraph=function(f,h){return n(this.offsets,this.a,this.b,this.edgeCount,f,h)},d.prototype.addNextEdge=function(){var f=this.xs[this.current],h=this.ys[this.current],v=this.offsets[f]+this.bucketFill[f],p=this.offsets[h]+this.bucketFill[h];this.a[v]=f,this.b[v]=h,this.bucketFill[f]++,this.a[p]=h,this.b[p]=f,this.bucketFill[h]++,this.current++,this.curA=v,this.curB=p},d.prototype.addAllEdges=function(){for(var f=0;f<this.edgeCount;f++)this.addNextEdge()},d.prototype.assignProperty=function(f,h){f[this.curA]=h,f[this.curB]=h},d}();e.EdgeBuilder=i;var a=function(){function d(f,h,v){this.vertexCount=f,this.xs=h,this.ys=v,this.current=0,this.curA=0,this.edgeCount=h.length,this.offsets=new Int32Array(this.vertexCount+1),this.bucketFill=new Int32Array(this.vertexCount);for(var p=new Int32Array(this.vertexCount),m=0,g=this.xs.length;m<g;m++)p[this.xs[m]]++;for(var y=0,m=0;m<this.vertexCount;m++)this.offsets[m]=y,y+=p[m];this.offsets[this.vertexCount]=y,this.slotCount=y,this.a=new Int32Array(y),this.b=new Int32Array(y)}return d.prototype.createGraph=function(f){return n(this.offsets,this.a,this.b,this.edgeCount,f)},d.prototype.addNextEdge=function(){var f=this.xs[this.current],h=this.ys[this.current],v=this.offsets[f]+this.bucketFill[f];this.a[v]=f,this.b[v]=h,this.bucketFill[f]++,this.current++,this.curA=v},d.prototype.addAllEdges=function(){for(var f=0;f<this.edgeCount;f++)this.addNextEdge()},d.prototype.assignProperty=function(f,h){f[this.curA]=h},d}();e.DirectedEdgeBuilder=a;var o=function(){function d(f){this.vertexCount=f,this.xs=[],this.ys=[],this.included=new Set}return d.prototype.addEdge=function(f,h){var v=f,p=h;f>h&&(v=h,p=f);var m=ph(v,p);return this.included.has(m)?!1:(this.included.add(m),this.xs[this.xs.length]=v,this.ys[this.ys.length]=p,!0)},d.prototype.getGraph=function(){return s(this.vertexCount,this.xs,this.ys)},d.prototype.getEdgeBuiler=function(){return new i(this.vertexCount,this.xs,this.ys)},d}();e.UniqueEdgeBuilder=o;function s(d,f,h){var v=new e.EdgeBuilder(d,f,h);return v.addAllEdges(),v.createGraph({})}e.fromVertexPairs=s;function u(d,f){for(var h=d.b,v=d.offset,p=d.vertexCount,m=d.edgeProps,g=new Int32Array(p),y=0,b=f.length;y<b;y++)g[f[y]]=y+1;for(var S=0,y=0;y<p;y++)if(g[y]!==0)for(var x=v[y],C=v[y+1];x<C;x++)h[x]>y&&g[h[x]]!==0&&S++;for(var w=new Int32Array(f.length+1),A=new Int32Array(2*S),M=new Int32Array(2*S),D=new Int32Array(2*S),k=0,R=0,y=0;y<p;y++)if(g[y]!==0){for(var O=g[y]-1,x=v[y],C=v[y+1];x<C;x++){var H=g[h[x]];H!==0&&(M[k]=O,D[k]=H-1,A[k]=x,k++)}w[++R]=k}for(var B={},j=0,Y=Object.keys(m);j<Y.length;j++){var G=Y[j];B[G]=kMe(m[G],A)}return n(w,M,D,S,B)}e.induceByVertices=u;function l(d){var f=d.vertexCount;if(f===0)return{componentCount:0,componentIndex:new Int32Array(0)};if(d.edgeCount===0){for(var h=new Int32Array(f),v=0,p=f;v<p;v++)h[v]=v;return{componentCount:f,componentIndex:h}}for(var m=new Int32Array(f),v=0,p=f;v<p;v++)m[v]=-1;var g=0;m[0]=g;var y=d.offset,b=d.b,S=[0],x=K5e(f);for(x.remove(0);S.length>0;){for(var C=S.pop(),w=m[C],A=y[C],M=y[C+1];A<M;A++){var D=b[A];x.has(D)&&(x.remove(D),S.push(D),m[D]=w)}S.length===0&&x.head>=0&&(S.push(x.head),m[x.head]=++g,x.remove(x.head))}return{componentCount:f,componentIndex:m}}e.connectedComponents=l;function c(d,f,h,v){if(Je.areIntersecting(f,h))return!0;if(v<1)return!1;for(var p=new Set,m=0,g=f.length;m<g;++m)p.add(f[m]);return CJ(d,f,h,v,p)}e.areVertexSetsConnected=c})(Oo||(Oo={}));function CJ(e,t,r,n,i){for(var a=e.b,o=e.offset,s=[],u=0,l=t.length;u<l;++u)for(var c=t[u],d=o[c],f=o[c+1];d<f;++d){var h=a[d];if(!i.has(h)){if(Je.has(r,h))return!0;i.add(h),s[s.length]=h}}return n>1?CJ(e,s,r,n-1,i):!1}var x6e=function(){function e(){this.map=new Map,this.applicable=new Map}return e.prototype.add=function(t,r,n){this.map.set(t,r),n&&this.applicable.set(t,n)},e.prototype.remove=function(t){this.map.delete(t),this.applicable.delete(t)},e.prototype.get=function(t){return this.map.get(t)},e.prototype.isApplicable=function(t){var r=this.applicable.get(t.sourceData.kind);return r?r(t):!0},e}(),Wu;(function(e){function t(r){var n=r.name,i=new x6e;return{descriptor:r,formatRegistry:i,isApplicable:function(a){return i.isApplicable(a)},get:function(a){if(a._staticPropertyData[n])return a._staticPropertyData[n];if(!a.customProperties.has(r)){var o=i.get(a.sourceData.kind);if(o)return a._staticPropertyData[n]=o(a),a.customProperties.add(r),a._staticPropertyData[n]}},set:function(a,o){a._staticPropertyData[n]=o},delete:function(a){delete a._staticPropertyData[n]}}}e.create=t})(Wu||(Wu={}));function S6e(e,t,r,n){for(var i=new Oo.EdgeBuilder(n,e,t),a=new Int8Array(i.slotCount),o=new Array(i.slotCount),s=new Array(i.slotCount),u=0,l=i.edgeCount;u<l;u++)i.addNextEdge(),i.assignProperty(a,r.order?r.order[u]:1),i.assignProperty(o,r.distance?r.distance[u]:-1),i.assignProperty(s,r.flag?r.flag[u]:1);return i.createGraph({order:a,distance:o,flag:s})}var wa;(function(e){e.Descriptor={name:"index_pair_bonds"},e.Provider=Wu.create(e.Descriptor);function t(r){var n=r.pairs,i=r.count,a=n.indexA.toArray(),o=n.indexB.toArray(),s=n.order&&n.order.toArray(),u=n.distance&&n.distance.toArray(),l=n.flag&&n.flag.toArray();return S6e(a,o,{order:s,distance:u,flag:l},i)}e.fromData=t})(wa||(wa={}));var qh=ve.Schema,ne=qh.str,Oe=qh.int,lr=qh.float,HP=qh.coord,Mt=qh.Aliased,rf=qh.Matrix,Vx=qh.Vector,Jh=qh.List,Sr={atom_site:{auth_asym_id:ne,auth_atom_id:ne,auth_comp_id:ne,auth_seq_id:Oe,B_iso_or_equiv:lr,Cartn_x:HP,Cartn_y:HP,Cartn_z:HP,group_PDB:Mt(ne),id:Oe,label_alt_id:ne,label_asym_id:ne,label_atom_id:ne,label_comp_id:ne,label_entity_id:ne,label_seq_id:Oe,occupancy:lr,type_symbol:ne,pdbx_PDB_ins_code:ne,pdbx_PDB_model_num:Oe,pdbx_formal_charge:Oe,ihm_model_id:Oe},atom_site_anisotrop:{id:Oe,type_symbol:ne,U:rf(3,3),U_esd:rf(3,3),pdbx_auth_seq_id:ne,pdbx_auth_asym_id:ne,pdbx_auth_atom_id:ne,pdbx_auth_comp_id:ne,pdbx_label_seq_id:Oe,pdbx_label_alt_id:ne,pdbx_label_asym_id:ne,pdbx_label_atom_id:ne,pdbx_label_comp_id:ne,pdbx_PDB_ins_code:ne},atom_sites:{entry_id:ne,fract_transf_matrix:rf(3,3),fract_transf_vector:Vx(3)},audit_author:{name:ne,pdbx_ordinal:Oe,identifier_ORCID:ne},audit_conform:{dict_location:ne,dict_name:ne,dict_version:ne},cell:{angle_alpha:lr,angle_beta:lr,angle_gamma:lr,entry_id:ne,length_a:lr,length_b:lr,length_c:lr,Z_PDB:Oe,pdbx_unique_axis:ne},chem_comp:{formula:ne,formula_weight:lr,id:ne,mon_nstd_flag:Mt(ne),name:ne,type:Mt(ne),pdbx_synonyms:Jh(";",function(e){return e})},chem_comp_bond:{atom_id_1:ne,atom_id_2:ne,comp_id:ne,value_order:Mt(ne),pdbx_ordinal:Oe,pdbx_stereo_config:Mt(ne),pdbx_aromatic_flag:Mt(ne)},citation:{book_publisher:ne,country:ne,id:ne,journal_abbrev:ne,journal_id_ASTM:ne,journal_id_CSD:ne,journal_id_ISSN:ne,journal_volume:ne,page_first:ne,page_last:ne,title:ne,year:Oe,pdbx_database_id_DOI:ne,pdbx_database_id_PubMed:Oe},citation_author:{citation_id:ne,name:ne,ordinal:Oe},database_2:{database_id:Mt(ne),database_code:ne},entity:{details:ne,formula_weight:lr,id:ne,src_method:Mt(ne),type:Mt(ne),pdbx_description:Jh(",",function(e){return e}),pdbx_number_of_molecules:Oe,pdbx_mutation:ne,pdbx_fragment:ne,pdbx_ec:Jh(",",function(e){return e})},entity_poly:{entity_id:ne,nstd_linkage:Mt(ne),nstd_monomer:Mt(ne),type:Mt(ne),pdbx_strand_id:Jh(",",function(e){return e}),pdbx_seq_one_letter_code:ne,pdbx_seq_one_letter_code_can:ne,pdbx_target_identifier:ne},entity_poly_seq:{entity_id:ne,hetero:Mt(ne),mon_id:ne,num:Oe},entry:{id:ne},exptl:{entry_id:ne,method:Mt(ne)},struct:{entry_id:ne,title:ne,pdbx_descriptor:ne},struct_asym:{details:ne,entity_id:ne,id:ne,pdbx_modified:ne,pdbx_blank_PDB_chainid_flag:Mt(ne)},struct_conf:{beg_label_asym_id:ne,beg_label_comp_id:ne,beg_label_seq_id:Oe,beg_auth_asym_id:ne,beg_auth_comp_id:ne,beg_auth_seq_id:Oe,conf_type_id:Mt(ne),details:ne,end_label_asym_id:ne,end_label_comp_id:ne,end_label_seq_id:Oe,end_auth_asym_id:ne,end_auth_comp_id:ne,end_auth_seq_id:Oe,id:ne,pdbx_beg_PDB_ins_code:ne,pdbx_end_PDB_ins_code:ne,pdbx_PDB_helix_class:ne,pdbx_PDB_helix_length:Oe,pdbx_PDB_helix_id:ne},struct_conn:{conn_type_id:Mt(ne),details:ne,id:ne,ptnr1_label_asym_id:ne,ptnr1_label_atom_id:ne,ptnr1_label_comp_id:ne,ptnr1_label_seq_id:Oe,ptnr1_auth_asym_id:ne,ptnr1_auth_comp_id:ne,ptnr1_auth_seq_id:Oe,ptnr1_symmetry:ne,ptnr2_label_asym_id:ne,ptnr2_label_atom_id:ne,ptnr2_label_comp_id:ne,ptnr2_label_seq_id:Oe,ptnr2_auth_asym_id:ne,ptnr2_auth_comp_id:ne,ptnr2_auth_seq_id:Oe,ptnr2_symmetry:ne,pdbx_ptnr1_PDB_ins_code:ne,pdbx_ptnr1_label_alt_id:ne,pdbx_ptnr1_standard_comp_id:ne,pdbx_ptnr2_PDB_ins_code:ne,pdbx_ptnr2_label_alt_id:ne,pdbx_ptnr3_PDB_ins_code:ne,pdbx_ptnr3_label_alt_id:ne,pdbx_ptnr3_label_asym_id:ne,pdbx_ptnr3_label_atom_id:ne,pdbx_ptnr3_label_comp_id:ne,pdbx_ptnr3_label_seq_id:Oe,pdbx_PDB_id:ne,pdbx_dist_value:lr,pdbx_value_order:Mt(ne)},struct_conn_type:{criteria:ne,id:Mt(ne),reference:ne},struct_keywords:{entry_id:ne,text:Jh(",",function(e){return e}),pdbx_keywords:ne},struct_ncs_oper:{code:Mt(ne),details:ne,id:Oe,matrix:rf(3,3),vector:Vx(3)},struct_sheet_range:{beg_label_asym_id:ne,beg_label_comp_id:ne,beg_label_seq_id:Oe,end_label_asym_id:ne,end_label_comp_id:ne,end_label_seq_id:Oe,beg_auth_asym_id:ne,beg_auth_comp_id:ne,beg_auth_seq_id:Oe,end_auth_asym_id:ne,end_auth_comp_id:ne,end_auth_seq_id:Oe,id:ne,sheet_id:ne,pdbx_beg_PDB_ins_code:ne,pdbx_end_PDB_ins_code:ne},struct_site:{details:ne,id:ne,pdbx_num_residues:Oe,pdbx_evidence_code:ne,pdbx_auth_asym_id:ne,pdbx_auth_comp_id:ne,pdbx_auth_seq_id:ne,pdbx_auth_ins_code:ne},struct_site_gen:{details:ne,id:ne,label_alt_id:ne,label_asym_id:ne,label_atom_id:ne,label_comp_id:ne,label_seq_id:Oe,auth_asym_id:ne,auth_comp_id:ne,auth_seq_id:ne,site_id:ne,symmetry:ne,pdbx_auth_ins_code:ne,pdbx_num_res:Oe},symmetry:{entry_id:ne,cell_setting:Mt(ne),Int_Tables_number:Oe,space_group_name_Hall:ne,"space_group_name_H-M":ne},pdbx_database_status:{status_code:Mt(ne),status_code_sf:Mt(ne),status_code_mr:Mt(ne),entry_id:ne,recvd_initial_deposition_date:ne,SG_entry:Mt(ne),deposit_site:Mt(ne),process_site:Mt(ne),status_code_cs:Mt(ne),methods_development_category:Mt(ne),pdb_format_compatible:Mt(ne)},pdbx_nonpoly_scheme:{asym_id:ne,entity_id:ne,mon_id:ne,pdb_strand_id:ne,ndb_seq_num:ne,pdb_seq_num:ne,auth_seq_num:ne,pdb_mon_id:ne,auth_mon_id:ne,pdb_ins_code:ne},pdbx_database_related:{db_name:ne,details:ne,db_id:ne,content_type:Mt(ne)},pdbx_entity_nonpoly:{entity_id:ne,comp_id:ne,name:ne},pdbx_chem_comp_synonyms:{name:ne,comp_id:ne,provenance:Mt(ne)},pdbx_chem_comp_identifier:{comp_id:ne,identifier:ne,type:Mt(ne),program:ne,program_version:ne},pdbx_unobs_or_zero_occ_residues:{id:Oe,polymer_flag:Mt(ne),occupancy_flag:Mt(Oe),PDB_model_num:Oe,auth_asym_id:ne,auth_comp_id:ne,auth_seq_id:ne,PDB_ins_code:ne,label_asym_id:ne,label_comp_id:ne,label_seq_id:Oe},pdbx_struct_mod_residue:{id:Oe,auth_asym_id:ne,auth_comp_id:ne,auth_seq_id:Oe,PDB_ins_code:ne,label_asym_id:ne,label_comp_id:ne,label_seq_id:Oe,parent_comp_id:ne,details:ne},pdbx_struct_oper_list:{id:ne,type:Mt(ne),name:ne,symmetry_operation:ne,matrix:rf(3,3),vector:Vx(3)},pdbx_struct_assembly:{method_details:ne,oligomeric_details:ne,oligomeric_count:Oe,details:ne,id:ne},pdbx_struct_assembly_gen:{asym_id_list:Jh(",",function(e){return e}),assembly_id:ne,oper_expression:ne},pdbx_reference_entity_list:{prd_id:ne,ref_entity_id:ne,type:Mt(ne),details:ne,component_id:Oe},pdbx_reference_entity_link:{link_id:Oe,prd_id:ne,details:ne,ref_entity_id_1:ne,ref_entity_id_2:ne,entity_seq_num_1:Oe,entity_seq_num_2:Oe,comp_id_1:ne,comp_id_2:ne,atom_id_1:ne,atom_id_2:ne,value_order:Mt(ne),component_1:Oe,component_2:Oe,link_class:Mt(ne)},pdbx_reference_entity_poly_link:{link_id:Oe,prd_id:ne,ref_entity_id:ne,component_id:Oe,entity_seq_num_1:Oe,entity_seq_num_2:Oe,comp_id_1:ne,comp_id_2:ne,atom_id_1:ne,atom_id_2:ne,value_order:Mt(ne)},pdbx_molecule:{prd_id:ne,instance_id:Oe,asym_id:ne},pdbx_molecule_features:{prd_id:ne,class:Mt(ne),type:Mt(ne),name:ne,details:ne},entity_src_nat:{entity_id:ne,pdbx_organism_scientific:ne,pdbx_plasmid_name:ne,pdbx_src_id:Oe,pdbx_beg_seq_num:Oe,pdbx_end_seq_num:Oe},entity_src_gen:{entity_id:ne,pdbx_gene_src_gene:Jh(",",function(e){return e}),pdbx_gene_src_scientific_name:ne,plasmid_name:ne,pdbx_src_id:Oe,pdbx_beg_seq_num:Oe,pdbx_end_seq_num:Oe},pdbx_entity_src_syn:{organism_scientific:ne,entity_id:ne,pdbx_src_id:Oe,pdbx_beg_seq_num:Oe,pdbx_end_seq_num:Oe},pdbx_entity_branch_descriptor:{entity_id:ne,descriptor:ne,type:Mt(ne),program:ne,program_version:ne,ordinal:Oe},pdbx_entity_instance_feature:{details:ne,feature_type:Mt(ne),auth_asym_id:ne,asym_id:ne,auth_seq_num:ne,seq_num:Oe,comp_id:ne,auth_comp_id:ne,ordinal:Oe},pdbx_entity_branch_list:{entity_id:ne,hetero:Mt(ne),comp_id:ne,num:Oe},pdbx_entity_branch_link:{link_id:Oe,details:ne,entity_id:ne,entity_branch_list_num_1:Oe,entity_branch_list_num_2:Oe,comp_id_1:ne,comp_id_2:ne,atom_id_1:ne,leaving_atom_id_1:ne,atom_stereo_config_1:Mt(ne),atom_id_2:ne,leaving_atom_id_2:ne,atom_stereo_config_2:Mt(ne),value_order:Mt(ne)},pdbx_entity_branch:{entity_id:ne,type:Mt(ne)},pdbx_branch_scheme:{entity_id:ne,hetero:Mt(ne),asym_id:ne,mon_id:ne,num:Oe,pdb_asym_id:ne,pdb_seq_num:ne,pdb_mon_id:ne,auth_asym_id:ne,auth_seq_num:ne,auth_mon_id:ne},pdbx_chem_comp_related:{comp_id:ne,related_comp_id:ne,relationship_type:Mt(ne),details:ne},ihm_starting_model_details:{starting_model_id:ne,entity_id:ne,entity_description:ne,asym_id:ne,entity_poly_segment_id:Oe,starting_model_source:Mt(ne),starting_model_auth_asym_id:ne,starting_model_sequence_offset:Oe,dataset_list_id:Oe},ihm_starting_comparative_models:{id:Oe,starting_model_id:ne,starting_model_auth_asym_id:ne,starting_model_seq_id_begin:Oe,starting_model_seq_id_end:Oe,template_auth_asym_id:ne,template_seq_id_begin:Oe,template_seq_id_end:Oe,template_sequence_identity:lr,template_sequence_identity_denominator:Mt(Oe),template_dataset_list_id:Oe,alignment_file_id:Oe},ihm_starting_model_seq_dif:{id:Oe,entity_id:ne,asym_id:ne,seq_id:Oe,comp_id:ne,starting_model_id:ne,db_asym_id:ne,db_seq_id:Oe,db_comp_id:ne,details:ne},ihm_model_representation:{id:Oe,name:ne,details:ne},ihm_model_representation_details:{id:Oe,representation_id:Oe,entity_poly_segment_id:Oe,entity_id:ne,entity_description:ne,entity_asym_id:ne,model_object_primitive:Mt(ne),starting_model_id:ne,model_mode:Mt(ne),model_granularity:Mt(ne),model_object_count:Oe},ihm_struct_assembly_details:{id:Oe,assembly_id:Oe,parent_assembly_id:Oe,entity_description:ne,entity_id:ne,asym_id:ne,entity_poly_segment_id:Oe},ihm_struct_assembly:{id:Oe,name:ne,description:ne},ihm_modeling_protocol:{id:Oe,num_steps:Oe,protocol_name:ne},ihm_modeling_protocol_details:{id:Oe,protocol_id:Oe,step_id:Oe,struct_assembly_id:Oe,dataset_group_id:Oe,struct_assembly_description:ne,step_name:ne,step_method:ne,num_models_begin:Oe,num_models_end:Oe,multi_scale_flag:Mt(ne),multi_state_flag:Mt(ne),ordered_flag:Mt(ne),script_file_id:Oe,software_id:Oe},ihm_multi_state_modeling:{state_id:Oe,state_group_id:Oe,population_fraction:lr,population_fraction_sd:lr,state_type:ne,state_name:ne,experiment_type:Mt(ne),details:ne},ihm_modeling_post_process:{id:Oe,protocol_id:Oe,analysis_id:Oe,step_id:Oe,type:Mt(ne),feature:Mt(ne),num_models_begin:Oe,num_models_end:Oe},ihm_ensemble_info:{ensemble_id:Oe,ensemble_name:ne,post_process_id:Oe,model_group_id:Oe,ensemble_clustering_method:Mt(ne),ensemble_clustering_feature:Mt(ne),num_ensemble_models:Oe,num_ensemble_models_deposited:Oe,ensemble_precision_value:lr,ensemble_file_id:Oe},ihm_model_list:{model_id:Oe,model_name:ne,assembly_id:Oe,protocol_id:Oe,representation_id:Oe},ihm_model_group:{id:Oe,name:ne,details:ne},ihm_model_group_link:{model_id:Oe,group_id:Oe},ihm_model_representative:{id:Oe,model_group_id:Oe,model_id:Oe,selection_criteria:Mt(ne)},ihm_dataset_list:{id:Oe,data_type:Mt(ne),database_hosted:Mt(ne)},ihm_dataset_group:{id:Oe,name:ne,application:Mt(ne),details:ne},ihm_dataset_group_link:{dataset_list_id:Oe,group_id:Oe},ihm_related_datasets:{dataset_list_id_derived:Oe,dataset_list_id_primary:Oe},ihm_dataset_related_db_reference:{id:Oe,dataset_list_id:Oe,db_name:Mt(ne),accession_code:ne,version:ne,details:ne},ihm_external_reference_info:{reference_id:Oe,reference_provider:ne,reference_type:Mt(ne),reference:ne,refers_to:Mt(ne),associated_url:ne},ihm_external_files:{id:Oe,reference_id:Oe,file_path:ne,content_type:Mt(ne),file_size_bytes:lr,details:ne},ihm_dataset_external_reference:{id:Oe,dataset_list_id:Oe,file_id:Oe},ihm_localization_density_files:{id:Oe,file_id:Oe,ensemble_id:Oe,entity_id:ne,entity_poly_segment_id:Oe,asym_id:ne},ihm_predicted_contact_restraint:{id:Oe,group_id:Oe,entity_id_1:ne,entity_id_2:ne,asym_id_1:ne,asym_id_2:ne,comp_id_1:ne,comp_id_2:ne,seq_id_1:Oe,seq_id_2:Oe,rep_atom_1:Mt(ne),rep_atom_2:Mt(ne),distance_lower_limit:lr,distance_upper_limit:lr,probability:lr,restraint_type:Mt(ne),model_granularity:Mt(ne),dataset_list_id:Oe,software_id:Oe},ihm_cross_link_list:{id:Oe,group_id:Oe,entity_description_1:ne,entity_description_2:ne,entity_id_1:ne,entity_id_2:ne,comp_id_1:ne,comp_id_2:ne,seq_id_1:Oe,seq_id_2:Oe,linker_type:Mt(ne),dataset_list_id:Oe},ihm_cross_link_restraint:{id:Oe,group_id:Oe,entity_id_1:ne,entity_id_2:ne,asym_id_1:ne,asym_id_2:ne,comp_id_1:ne,comp_id_2:ne,seq_id_1:Oe,seq_id_2:Oe,atom_id_1:ne,atom_id_2:ne,restraint_type:Mt(ne),conditional_crosslink_flag:Mt(ne),model_granularity:Mt(ne),distance_threshold:lr,psi:lr,sigma_1:lr,sigma_2:lr},ihm_cross_link_result_parameters:{id:Oe,restraint_id:Oe,model_id:Oe,psi:lr,sigma_1:lr,sigma_2:lr},ihm_2dem_class_average_restraint:{id:Oe,dataset_list_id:Oe,number_raw_micrographs:Oe,pixel_size_width:lr,pixel_size_height:lr,image_resolution:lr,image_segment_flag:Mt(ne),number_of_projections:Oe,struct_assembly_id:Oe,details:ne},ihm_2dem_class_average_fitting:{id:Oe,restraint_id:Oe,model_id:Oe,cross_correlation_coefficient:lr,rot_matrix:rf(3,3),tr_vector:Vx(3)},ihm_3dem_restraint:{id:Oe,dataset_list_id:Oe,model_id:Oe,struct_assembly_id:Oe,fitting_method:ne,number_of_gaussians:Oe,cross_correlation_coefficient:lr},ihm_sas_restraint:{id:Oe,dataset_list_id:Oe,model_id:Oe,struct_assembly_id:Oe,profile_segment_flag:Mt(ne),fitting_atom_type:ne,fitting_method:ne,fitting_state:Mt(ne),radius_of_gyration:lr,chi_value:lr,details:ne},ihm_starting_model_coord:{ordinal_id:Oe,starting_model_id:ne,group_PDB:Mt(ne),id:Oe,type_symbol:ne,entity_id:ne,atom_id:ne,comp_id:ne,seq_id:Oe,asym_id:ne,Cartn_x:lr,Cartn_y:lr,Cartn_z:lr,B_iso_or_equiv:lr},ihm_sphere_obj_site:{id:Oe,entity_id:ne,seq_id_begin:Oe,seq_id_end:Oe,asym_id:ne,Cartn_x:lr,Cartn_y:lr,Cartn_z:lr,object_radius:lr,rmsf:lr,model_id:Oe},ihm_gaussian_obj_site:{id:Oe,entity_id:ne,seq_id_begin:Oe,seq_id_end:Oe,asym_id:ne,mean_Cartn_x:lr,mean_Cartn_y:lr,mean_Cartn_z:lr,weight:lr,covariance_matrix:rf(3,3),model_id:Oe},ihm_gaussian_obj_ensemble:{id:Oe,entity_id:ne,seq_id_begin:Oe,seq_id_end:Oe,asym_id:ne,mean_Cartn_x:lr,mean_Cartn_y:lr,mean_Cartn_z:lr,weight:lr,covariance_matrix:rf(3,3),ensemble_id:Oe},ihm_feature_list:{feature_id:Oe,feature_type:Mt(ne),entity_type:Mt(ne)},ihm_poly_residue_feature:{ordinal_id:Oe,feature_id:Oe,entity_id:ne,asym_id:ne,comp_id_begin:ne,comp_id_end:ne,seq_id_begin:Oe,seq_id_end:Oe},ihm_derived_distance_restraint:{id:Oe,group_id:Oe,feature_id_1:Oe,feature_id_2:Oe,group_conditionality:Mt(ne),random_exclusion_fraction:lr,distance_upper_limit:lr,restraint_type:Mt(ne),dataset_list_id:Oe}},C6e={type_symbol:ve.Schema.Aliased(Sr.atom_site.type_symbol),label_atom_id:Sr.atom_site.label_atom_id,auth_atom_id:Sr.atom_site.auth_atom_id,label_alt_id:Sr.atom_site.label_alt_id,label_comp_id:Sr.atom_site.label_comp_id,auth_comp_id:Sr.atom_site.auth_comp_id,pdbx_formal_charge:Sr.atom_site.pdbx_formal_charge},_6e={group_PDB:Sr.atom_site.group_PDB,label_seq_id:Sr.atom_site.label_seq_id,auth_seq_id:Sr.atom_site.auth_seq_id,pdbx_PDB_ins_code:Sr.atom_site.pdbx_PDB_ins_code},w6e={label_asym_id:Sr.atom_site.label_asym_id,auth_asym_id:Sr.atom_site.auth_asym_id,label_entity_id:Sr.atom_site.label_entity_id},ED;(function(e){function t(){return{label_entity_id:"",label_asym_id:"",auth_seq_id:0,pdbx_PDB_ins_code:void 0}}e.EmptyResidueKey=t})(ED||(ED={}));var Mv;(function(e){function t(i,a){return i.residueAtomSegments.index[i.chainAtomSegments.offsets[a]]}e.chainStartResidueIndex=t;function r(i,a){return i.residueAtomSegments.index[i.chainAtomSegments.offsets[a+1]-1]+1}e.chainEndResidueIndexExcl=r;function n(i,a){return r(i,a)-t(i,a)}e.chainResidueCount=n})(Mv||(Mv={}));var VE={H:1,D:1,T:1,HE:2,LI:3,BE:4,B:5,C:6,N:7,O:8,F:9,NE:10,NA:11,MG:12,AL:13,SI:14,P:15,S:16,CL:17,AR:18,K:19,CA:20,SC:21,TI:22,V:23,CR:24,MN:25,FE:26,CO:27,NI:28,CU:29,ZN:30,GA:31,GE:32,AS:33,SE:34,BR:35,KR:36,RB:37,SR:38,Y:39,ZR:40,NB:41,MO:42,TC:43,RU:44,RH:45,PD:46,AG:47,CD:48,IN:49,SN:50,SB:51,TE:52,I:53,XE:54,CS:55,BA:56,LA:57,CE:58,PR:59,ND:60,PM:61,SM:62,EU:63,GD:64,TB:65,DY:66,HO:67,ER:68,TM:69,YB:70,LU:71,HF:72,TA:73,W:74,RE:75,OS:76,IR:77,PT:78,AU:79,HG:80,TL:81,PB:82,BI:83,PO:84,AT:85,RN:86,FR:87,RA:88,AC:89,TH:90,PA:91,U:92,NP:93,PU:94,AM:95,CM:96,BK:97,CF:98,ES:99,FM:100,MD:101,NO:102,LR:103,RF:104,DB:105,SG:106,BH:107,HS:108,MT:109},E6e={1:1.1,2:1.4,3:1.81,4:1.53,5:1.92,6:1.7,7:1.55,8:1.52,9:1.47,10:1.54,11:2.27,12:1.73,13:1.84,14:2.1,15:1.8,16:1.8,17:1.75,18:1.88,19:2.75,20:2.31,21:2.3,22:2.15,23:2.05,24:2.05,25:2.05,26:2.05,27:2,28:2,29:2,30:2.1,31:1.87,32:2.11,33:1.85,34:1.9,35:1.83,36:2.02,37:3.03,38:2.49,39:2.4,40:2.3,41:2.15,42:2.1,43:2.05,44:2.05,45:2,46:2.05,47:2.1,48:2.2,49:2.2,50:1.93,51:2.17,52:2.06,53:1.98,54:2.16,55:3.43,56:2.68,57:2.5,58:2.48,59:2.47,60:2.45,61:2.43,62:2.42,63:2.4,64:2.38,65:2.37,66:2.35,67:2.33,68:2.32,69:2.3,70:2.28,71:2.27,72:2.25,73:2.2,74:2.1,75:2.05,76:2,77:2,78:2.05,79:2.1,80:2.05,81:1.96,82:2.02,83:2.07,84:1.97,85:2.02,86:2.2,87:3.48,88:2.83,89:2,90:2.4,91:2,92:2.3,93:2,94:2,95:2,96:2,97:2,98:2,99:2,100:2,101:2,102:2,103:2,104:2,105:2,106:2,107:2,108:2,109:2},A6e={1:1.008,2:4.0026,3:6.94,4:9.0122,5:10.81,6:10.81,7:14.007,8:15.999,9:18.998,10:20.18,11:22.99,12:24.305,13:26.982,14:28.085,15:30.974,16:32.06,17:35.45,18:39.948,19:39.098,20:40.078,21:44.956,22:47.867,23:50.942,24:51.996,25:54.938,26:55.845,27:58.933,28:58.693,29:63.546,30:65.38,31:69.723,32:72.63,33:74.922,34:78.971,35:79.904,36:83.798,37:85.468,38:87.62,39:88.906,40:91.224,41:92.906,42:95.95,43:96.906,44:101.07,45:102.91,46:106.42,47:107.87,48:112.41,49:114.82,50:118.71,51:121.76,52:127.6,53:127.6,54:131.29,55:132.91,56:137.33,57:138.91,58:140.12,59:140.91,60:144.24,61:144.912,62:150.36,63:151.96,64:157.25,65:158.93,66:162.5,67:164.93,68:167.26,69:168.93,70:173.05,71:174.97,72:178.49,73:180.95,74:183.84,75:186.21,76:190.23,77:192.22,78:195.08,79:196.97,80:200.59,81:204.38,82:207.2,83:208.98,84:1.97,85:2.02,86:2.2,87:3.48,88:2.83,89:2,90:232.04,91:231.04,92:238.03,93:237.048,94:244.064,95:243.061,96:247.07,97:247.07,98:251.079,99:252.083,100:257.095,101:258.098,102:259.101,103:262.11,104:267.122,105:270.131,106:271.134,107:270.133,108:270.134,109:278.156},P6e=1.7,T6e=10.81,I6e=0;function A2(e){var t=VE[e];return t===void 0?P6e:E6e[t]}function M6e(e){var t=VE[e];return t===void 0?T6e:A6e[t]}function P2(e){var t=VE[e];return t===void 0?I6e:t}function V1(e,t){return t?t.length===1?ph(t.charCodeAt(0),e):t.length===2?ph(t.charCodeAt(0),ph(t.charCodeAt(1),e)):e+" "+t:e}function D6e(e,t,r,n){if(e.has(t)){var i=e.get(t);i.has(r)||i.set(r,n)}else{var i=new Map;e.set(t,i),i.set(r,n)}}function R6e(e){throw new Error("Missing entity entry for entity id '"+e+"'.")}function k6e(e,t,r){return{entities:e,segments:r,label_seq_id:Je.ofSortedArray(t.residues.label_seq_id.toArray({array:Int32Array})),label_atom_id:t.atoms.label_atom_id,auth_atom_id:t.atoms.auth_atom_id,label_alt_id:t.atoms.label_alt_id,chain_index_entity_index:new Int32Array(t.chains._rowCount),entity_index_label_asym_id:new Map,chain_index_label_seq_id:new Map,auth_asym_id_auth_seq_id:new Map,chain_index_auth_seq_id:new Map,label_asym_id:new Map}}var Ty=ED.EmptyResidueKey(),O6e=function(){function e(t){this.map=t,this.entityIndex=t.entities.getEntityIndex,this.residueOffsets=this.map.segments.residueAtomSegments.offsets}return e.prototype.getEntityFromChain=function(t){return this.map.chain_index_entity_index[t]},e.prototype.findEntity=function(t){var r=this.map.label_asym_id.get(t);return r!==void 0?r:-1},e.prototype.findChainLabel=function(t){var r=this.entityIndex(t.label_entity_id);if(r<0||!this.map.entity_index_label_asym_id.has(r))return-1;var n=this.map.entity_index_label_asym_id.get(r);return n&&n.has(t.label_asym_id)?n.get(t.label_asym_id):-1},e.prototype.findChainAuth=function(t){if(!this.map.auth_asym_id_auth_seq_id.has(t.auth_asym_id))return-1;var r=this.map.auth_asym_id_auth_seq_id.get(t.auth_asym_id);return r.has(t.auth_seq_id)?r.get(t.auth_seq_id):-1},e.prototype.findResidue=function(t,r,n,i){var a;arguments.length===1?a=t:(Ty.label_entity_id=t,Ty.label_asym_id=r,Ty.auth_seq_id=n,Ty.pdbx_PDB_ins_code=i,a=Ty);var o=this.findChainLabel(a);if(o<0)return-1;var s=this.map.chain_index_auth_seq_id.get(o),u=V1(a.auth_seq_id,a.pdbx_PDB_ins_code||"");return s.has(u)?s.get(u):-1},e.prototype.findResidueAuth=function(t){var r=this.findChainAuth(t);if(r<0)return-1;var n=this.map.chain_index_auth_seq_id.get(r),i=V1(t.auth_seq_id,t.pdbx_PDB_ins_code||"");return n.has(i)?n.get(i):-1},e.prototype.findResidueInsertion=function(t){var r=this.findChainLabel(t);if(r<0)return-1;var n=this.map.chain_index_label_seq_id.get(r),i=V1(t.label_seq_id,t.pdbx_PDB_ins_code||"");if(n.has(i))return n.get(i);var a=Je.findPredecessorIndex(this.map.label_seq_id,t.label_seq_id),o=Mv.chainStartResidueIndex(this.map.segments,r);if(a<o)return o;var s=Mv.chainEndResidueIndexExcl(this.map.segments,r)-1;return a>=s?s:a},e.prototype.findAtom=function(t){var r=this.findResidue(t);return r<0?-1:typeof t.label_alt_id>"u"?GP(this.residueOffsets[r],this.residueOffsets[r+1],this.map.label_atom_id,t.label_atom_id):qP(this.residueOffsets[r],this.residueOffsets[r+1],this.map.label_atom_id,this.map.label_alt_id,t.label_atom_id,t.label_alt_id)},e.prototype.findAtomAuth=function(t){var r=this.findResidueAuth(t);return r<0?-1:typeof t.label_alt_id>"u"?GP(this.residueOffsets[r],this.residueOffsets[r+1],this.map.auth_atom_id,t.auth_atom_id):qP(this.residueOffsets[r],this.residueOffsets[r+1],this.map.auth_atom_id,this.map.label_alt_id,t.auth_atom_id,t.label_alt_id)},e.prototype.findAtomOnResidue=function(t,r,n){return typeof n>"u"?GP(this.residueOffsets[t],this.residueOffsets[t+1],this.map.label_atom_id,r):qP(this.residueOffsets[t],this.residueOffsets[t+1],this.map.label_atom_id,this.map.label_alt_id,r,n)},e.prototype.findAtomsOnResidue=function(t,r){return F6e(this.residueOffsets[t],this.residueOffsets[t+1],this.map.label_atom_id,r)},e}();function GP(e,t,r,n){for(var i=e;i<t;i++)if(r.value(i)===n)return i;return-1}function F6e(e,t,r,n){for(var i=e;i<t;i++)if(n.has(r.value(i)))return i;return-1}function qP(e,t,r,n,i,a){for(var o=e;o<t;o++)if(r.value(o)===i&&n.value(o)===a)return o;return-1}function L6e(e,t,r){for(var n=k6e(t,e,r),i=e.residues,a=i.label_seq_id,o=i.auth_seq_id,s=i.pdbx_PDB_ins_code,u=e.chains,l=u.label_entity_id,c=u.label_asym_id,d=u.auth_asym_id,f=Ie.ofBounds(0,e.atoms._rowCount),h=ar.transientSegments(r.chainAtomSegments,f);h.hasNext;){var v=h.move(),p=v.index,m=t.getEntityIndex(l.value(p));m<0&&R6e(l.value(p)),n.chain_index_entity_index[p]=m;var g=d.value(p),y=n.auth_asym_id_auth_seq_id.get(g);y||(y=new Map,n.auth_asym_id_auth_seq_id.set(g,y));var b=c.value(p);n.label_asym_id.has(b)||n.label_asym_id.set(b,m),D6e(n.entity_index_label_asym_id,m,b,p);var S=new Map,x=new Map;n.chain_index_label_seq_id.set(p,S),n.chain_index_auth_seq_id.set(p,x);for(var C=ar.transientSegments(r.residueAtomSegments,f,v);C.hasNext;){var w=C.move(),A=w.index,M=o.value(A),D=s.value(A);S.set(V1(a.value(A),D),A),x.set(V1(M,D),A),y.set(M,p)}}return new O6e(n)}var vo,mo,Dt={Blue:37052,Green:42577,Yellow:16765952,Orange:16021792,Pink:16162465,Purple:10830745,LightBlue:9424105,Brown:10582605,Red:15539236,Secondary:15854817};vo={},vo[0]="Hexose",vo[1]="HexNAc",vo[2]="Hexosamine",vo[3]="Hexuronate",vo[4]="Deoxyhexose",vo[5]="DeoxyhexNAc",vo[6]="Di-deoxyhexose",vo[7]="Pentose",vo[8]="Deoxynonulosonate",vo[9]="Di-deoxynonulosonate",vo[10]="Unknown",vo[11]="Assigned";var N6e=(mo={},mo[0]=0,mo[1]=1,mo[2]=2,mo[3]=3,mo[4]=4,mo[5]=5,mo[6]=6,mo[7]=7,mo[8]=8,mo[9]=9,mo[10]=10,mo[11]=11,mo);function B6e(e,t){return e===10?t===4?12:t===5?13:t===6?14:t===7?15:10:N6e[e]}var _J={abbr:"Unk",name:"Unknown",color:Dt.Secondary,type:10},dw=[{abbr:"Glc",name:"Glucose",color:Dt.Blue,type:0},{abbr:"Man",name:"Mannose",color:Dt.Green,type:0},{abbr:"Gal",name:"Galactose",color:Dt.Yellow,type:0},{abbr:"Gul",name:"Gulose",color:Dt.Orange,type:0},{abbr:"Alt",name:"Altrose",color:Dt.Pink,type:0},{abbr:"All",name:"Allose",color:Dt.Purple,type:0},{abbr:"Tal",name:"Talose",color:Dt.LightBlue,type:0},{abbr:"Ido",name:"Idose",color:Dt.Brown,type:0},{abbr:"GlcNAc",name:"N-Acetyl Glucosamine",color:Dt.Blue,type:1},{abbr:"ManNAc",name:"N-Acetyl Mannosamine",color:Dt.Green,type:1},{abbr:"GalNAc",name:"N-Acetyl Galactosamine",color:Dt.Yellow,type:1},{abbr:"GulNAc",name:"N-Acetyl Gulosamine",color:Dt.Orange,type:1},{abbr:"AltNAc",name:"N-Acetyl Altrosamine",color:Dt.Pink,type:1},{abbr:"AllNAc",name:"N-Acetyl Allosamine",color:Dt.Purple,type:1},{abbr:"TalNAc",name:"N-Acetyl Talosamine",color:Dt.LightBlue,type:1},{abbr:"IdoNAc",name:"N-Acetyl Idosamine",color:Dt.Brown,type:1},{abbr:"GlcN",name:"Glucosamine",color:Dt.Blue,type:2},{abbr:"ManN",name:"Mannosamine",color:Dt.Green,type:2},{abbr:"GalN",name:"Galactosamine",color:Dt.Yellow,type:2},{abbr:"GulN",name:"Gulosamine",color:Dt.Orange,type:2},{abbr:"AltN",name:"Altrosamine",color:Dt.Pink,type:2},{abbr:"AllN",name:"Allosamine",color:Dt.Purple,type:2},{abbr:"TalN",name:"Talosamine",color:Dt.LightBlue,type:2},{abbr:"IdoN",name:"Idosamine",color:Dt.Brown,type:2},{abbr:"GlcA",name:"Glucuronic Acid",color:Dt.Blue,type:3},{abbr:"ManA",name:"Mannuronic Acid",color:Dt.Green,type:3},{abbr:"GalA",name:"Galacturonic Acid",color:Dt.Yellow,type:3},{abbr:"GulA",name:"Guluronic Acid",color:Dt.Orange,type:3},{abbr:"AltA",name:"Altruronic Acid",color:Dt.Pink,type:3},{abbr:"AllA",name:"Alluronic Acid",color:Dt.Purple,type:3},{abbr:"TalA",name:"Taluronic Acid",color:Dt.LightBlue,type:3},{abbr:"IdoA",name:"Iduronic Acid",color:Dt.Brown,type:3},{abbr:"Qui",name:"Quinovose",color:Dt.Blue,type:4},{abbr:"Rha",name:"Rhamnose",color:Dt.Green,type:4},{abbr:"6dGul",name:"6-Deoxy Gulose",color:Dt.Orange,type:4},{abbr:"6dAlt",name:"6-Deoxy Altrose",color:Dt.Pink,type:4},{abbr:"6dTal",name:"6-Deoxy Talose",color:Dt.LightBlue,type:4},{abbr:"Fuc",name:"Fucose",color:Dt.Red,type:4},{abbr:"QuiNAc",name:"N-Acetyl Quinovosamine",color:Dt.Blue,type:5},{abbr:"RhaNAc",name:"N-Acetyl Rhamnosamine",color:Dt.Green,type:5},{abbr:"6dAltNAc",name:"N-Acetyl 6-Deoxy Altrosamine",color:Dt.Pink,type:5},{abbr:"6dTalNAc",name:"N-Acetyl 6-Deoxy Talosamine",color:Dt.LightBlue,type:5},{abbr:"FucNAc",name:"N-Acetyl Fucosamine",color:Dt.Red,type:5},{abbr:"Oli",name:"Olivose",color:Dt.Blue,type:6},{abbr:"Tyv",name:"Tyvelose",color:Dt.Green,type:6},{abbr:"Abe",name:"Abequose",color:Dt.Orange,type:6},{abbr:"Par",name:"Paratose",color:Dt.Pink,type:6},{abbr:"Dig",name:"Digitoxose",color:Dt.Purple,type:6},{abbr:"Col",name:"Colitose",color:Dt.LightBlue,type:6},{abbr:"Ara",name:"Arabinose",color:Dt.Green,type:7},{abbr:"Lyx",name:"Lyxose",color:Dt.Yellow,type:7},{abbr:"Xyl",name:"Xylose",color:Dt.Orange,type:7},{abbr:"Rib",name:"Ribose",color:Dt.Pink,type:7},{abbr:"Kdn",name:"Keto-Deoxy Nonulonic Acid",color:Dt.Green,type:8},{abbr:"Neu5Ac",name:"N-Acetyl Neuraminic Acid",color:Dt.Purple,type:8},{abbr:"Neu5Gc",name:"N-Glycolyl Neuraminic Acid",color:Dt.LightBlue,type:8},{abbr:"Neu",name:"Neuraminic Acid",color:Dt.Brown,type:8},{abbr:"Sia",name:"Sialic acid",color:Dt.Red,type:8},{abbr:"Pse",name:"Pseudaminic Acid",color:Dt.Green,type:9},{abbr:"Leg",name:"Legionaminic Acid",color:Dt.Yellow,type:9},{abbr:"Aci",name:"Acinetaminic Acid",color:Dt.Pink,type:9},{abbr:"4eLeg",name:"4-Epilegionaminic Acid",color:Dt.LightBlue,type:9},{abbr:"Bac",name:"Bacillosamine",color:Dt.Blue,type:10},{abbr:"LDmanHep",name:"L-Glycero-D-Manno Heptose",color:Dt.Green,type:10},{abbr:"Kdo",name:"Keto-Deoxy Octulonic Acid",color:Dt.Yellow,type:10},{abbr:"Dha",name:"3-Deoxy Lyxo-Heptulosaric Acid",color:Dt.Orange,type:10},{abbr:"DDmanHep",name:"D-Glycero-D-Manno-Heptose",color:Dt.Pink,type:10},{abbr:"MurNAc",name:"N-Acetyl Muramic Acid",color:Dt.Purple,type:10},{abbr:"MurNGc",name:"N-Glycolyl Muramic Acid",color:Dt.LightBlue,type:10},{abbr:"Mur",name:"Muramic Acid",color:Dt.Brown,type:10},{abbr:"Api",name:"Apicose",color:Dt.Green,type:11},{abbr:"Fru",name:"Fructose",color:Dt.Green,type:11},{abbr:"Tag",name:"Tagatose",color:Dt.Yellow,type:11},{abbr:"Sor",name:"Sorbose",color:Dt.Orange,type:11},{abbr:"Psi",name:"Psicose",color:Dt.Pink,type:11}],U6e=function(){for(var e=new Map,t=0,r=dw.length;t<r;++t){var n=dw[t];e.set(n.abbr,n)}return e}(),j6e=[["Glc-family",Dt.Blue],["Man-family",Dt.Green],["Gal-family",Dt.Yellow],["Gul-family",Dt.Orange],["Alt-family",Dt.Pink],["All-family",Dt.Purple],["Tal-family",Dt.LightBlue],["Ido-family",Dt.Brown],["Fuc-family",Dt.Red],["Generic/Unknown/Secondary",Dt.Secondary]],z6e={Glc:["GLC","BGC","Z8T","TRE","MLR"],Man:["MAN","BMA"],Gal:["GLA","GAL","GZL","GXL","GIV"],Gul:["4GL","GL0","GUP","Z8H"],Alt:["Z6H","3MK","SHD"],All:["AFD","ALL","WOO","Z2D"],Tal:["ZEE","A5C","SDY"],Ido:["ZCD","Z0F","4N2"],GlcNAc:["NDG","NAG","NGZ"],ManNAc:["BM3","BM7"],GalNAc:["A2G","NGA","YYQ"],GulNAc:["LXB"],AltNAc:[],AllNAc:["NAA"],TalNAc:[],IdoNAc:["LXZ","HSQ"],GlcN:["PA1","GCS"],ManN:["95Z"],GalN:["X6X","1GN"],GulN:[],AltN:[],AllN:[],TalN:[],IdoN:[],GlcA:["GCU","BDP"],ManA:["MAV","BEM"],GalA:["ADA","GTR","GTK"],GulA:["LGU"],AltA:[],AllA:[],TalA:["X1X","X0X"],IdoA:["IDR"],Qui:["G6D","YYK"],Rha:["RAM","RM4","XXR"],"6dGul":["66O"],"6dAlt":[],"6dTal":[],Fuc:["FUC","FUL","FCA","FCB","GYE"],QuiNAc:["Z9W"],RhaNAc:[],"6dAltNAc":[],"6dTalNAc":[],FucNAc:["49T"],Oli:["DDA","RAE","Z5J"],Tyv:["TYV"],Abe:["ABE"],Par:["PZU"],Dig:["Z3U"],Col:[],Ara:["64K","ARA","ARB","AHR","FUB","BXY","BXX","SEJ"],Lyx:["LDY","Z4W"],Xyl:["XYS","XYP","XYZ","HSY","LXC"],Rib:["YYM","RIP","RIB","BDR","0MK","Z6J","32O"],Kdn:["KDM","KDN"],Neu5Ac:["SIA","SLB"],Neu5Gc:["NGC","NGE"],Neu:[],Sia:[],Pse:[],Leg:[],Aci:[],"4eLeg":[],Bac:[],LDmanHep:["GMH"],Kdo:["KDO"],Dha:[],DDmanHep:["289"],MurNAc:["MUB","AMU"],MurNGc:[],Mur:["1S4","MUR"],Api:["XXM"],Fru:["BDF","Z9N","FRU","LFR"],Tag:["T6T"],Sor:["SOE","UEA"],Psi:["PSV","SF6","SF9","TTV"]},$U=["NGZ","LAT","PUF","GDA","9WJ"],nv=function(){for(var e=new Map,t=0,r=dw.length;t<r;++t){var n=dw[t],i=z6e[n.abbr];if(i)for(var a=0,o=i.length;a<o;++a)e.set(i[a],n)}for(var t=0,r=$U.length;t<r;++t)e.set($U[t],_J);return e}(),gi;(function(e){function t(h){return w6(h.values())}e.toArray=t;function r(h,v){var p=!0;return v.forEach(function(m){h.has(m)||(p=!1)}),p}e.isSuperset=r;function n(h){for(var v=[],p=1;p<arguments.length;p++)v[p-1]=arguments[p];for(var m=0;m<v.length;m++)v[m].forEach(function(g){return h.add(g)});return h}e.add=n;function i(h,v){var p=new Set(h);return v.forEach(function(m){return p.add(m)}),p}e.union=i;function a(){for(var h=[],v=0;v<arguments.length;v++)h[v]=arguments[v];if(h.length===0)return new Set;h.length===1&&new Set(h[0]);for(var p=new Set(h[0]),m=1,g=h.length;m<g;m++)h[m].forEach(function(y){return p.add(y)});return p}e.unionMany=a;function o(h){if(h.length===0)return new Set;for(var v=new Set(h[0]),p=1;p<h.length;p++)for(var m=0,g=h[p];m<g.length;m++){var y=g[m];v.add(y)}return v}e.unionManyArrays=o;function s(h,v){var p=new Set;return v.forEach(function(m){h.has(m)&&p.add(m)}),p}e.intersection=s;function u(h,v){var p=!1;return v.forEach(function(m){h.has(m)&&(p=!0)}),p}e.areIntersecting=u;function l(h,v){var p=0;return v.forEach(function(m){h.has(m)&&(p+=1)}),p}e.intersectionSize=l;function c(h,v){var p=new Set(h);return v.forEach(function(m){return p.delete(m)}),p}e.difference=c;function d(h,v){var p=h.size;return h.forEach(function(m){v.has(m)&&(p-=1)}),p}e.differenceSize=d;function f(h,v){if(h.size!==v.size)return!1;var p=!0;return v.forEach(function(m){h.has(m)||(p=!1)}),p}e.areEqual=f})(gi||(gi={}));var wJ=new Set(["DAPC","DBPC","DFPC","DGPC","DIPC","DLPC","DNPC","DOPC","DPPC","DRPC","DTPC","DVPC","DXPC","DYPC","LPPC","PAPC","PEPC","PGPC","PIPC","POPC","PRPC","PUPC","DAPE","DBPE","DFPE","DGPE","DIPE","DLPE","DNPE","DOPE","DPPE","DRPE","DTPE","DUPE","DVPE","DXPE","DYPE","LPPE","PAPE","PGPE","PIPE","POPE","PQPE","PRPE","PUPE","DAPS","DBPS","DFPS","DGPS","DIPS","DLPS","DNPS","DOPS","DPPS","DRPS","DTPS","DUPS","DVPS","DXPS","DYPS","LPPS","PAPS","PGPS","PIPS","POPS","PQPS","PRPS","PUPS","DAPG","DBPG","DFPG","DGPG","DIPG","DLPG","DNPG","DOPG","DPPG","DRPG","DTPG","DVPG","DXPG","DYPG","LPPG","PAPG","PGPG","PIPG","POPG","PRPG","DAPA","DBPA","DFPA","DGPA","DIPA","DLPA","DNPA","DOPA","DPPA","DRPA","DTPA","DVPA","DXPA","DYPA","LPPA","PAPA","PGPA","PIPA","POPA","PRPA","PUPA","DPP","DPPI","PAPI","PIPI","POP","POPI","PUPI","PVP","PVPI","PADG","PIDG","PODG","PUDG","PVDG","APC","CPC","IPC","LPC","OPC","PPC","TPC","UPC","VPC","BNSM","DBSM","DPSM","DXSM","PGSM","PNSM","POSM","PVSM","XNSM","DPCE","DXCE","PNCE","XNCE","DMPC"]),EJ=new Set(["118","119","543","1AL","1CU","2FK","2HP","2OF","3CO","3MT","3NI","3OF","3P8","4MO","4PU","4TI","6MO","ACT","AG","AL","ALF","AM","ATH","AU","AU3","AUC","AZI","BA","BCT","BEF","BF4","BO4","BR","BS3","BSY","CA","CAC","CD","CD1","CD3","CD5","CE","CF","CHT","CL","CO","CO3","CO5","CON","CR","CS","CSB","CU","CU1","CU3","CUA","CUZ","CYN","DME","DMI","DSC","DTI","DY","E4N","EDR","EMC","ER3","EU","EU3","F","FE","FE2","FPO","GA","GD3","GEP","HAI","HG","HGC","IN","IOD","IR","IR3","IRI","IUM","K","KO4","LA","LCO","LCP","LI","LU","MAC","MG","MH2","MH3","MLI","MMC","MN","MN3","MN5","MN6","MO1","MO2","MO3","MO4","MO5","MO6","MOO","MOS","MOW","MW1","MW2","MW3","NA","NA2","NA5","NA6","NAO","NAW","NET","NH4","NI","NI1","NI2","NI3","NO2","NO3","NRU","O4M","OAA","OC1","OC2","OC3","OC4","OC5","OC6","OC7","OC8","OCL","OCM","OCN","OCO","OF1","OF2","OF3","OH","OS","OS4","OXL","PB","PBM","PD","PDV","PER","PI","PO3","PO4","PR","PT","PT4","PTN","RB","RH3","RHD","RU","SB","SCN","SE4","SEK","SM","SMO","SO3","SO4","SR","T1A","TB","TBA","TCN","TEA","TH","THE","TL","TMA","TRA","UNX","V","VN3","VO4","W","WO5","Y1","YB","YB2","YH","YT3","ZCM","ZN","ZN2","ZN3","ZNO","ZO3","ZR","NCO","OHX"]),fc,V6e=function(){for(var e=Object.create(null),t=[],r="A".charCodeAt(0);r<="Z".charCodeAt(0);r++)t[t.length]=String.fromCharCode(r);for(var r="a".charCodeAt(0);r<="z".charCodeAt(0);r++)t[t.length]=String.fromCharCode(r);for(var r="0".charCodeAt(0);r<="9".charCodeAt(0);r++)t[t.length]=String.fromCharCode(r);for(var n=0,i=t;n<i.length;n++){var a=i[n];e[a]=a.toUpperCase();for(var o=0,s=t;o<s.length;o++){var u=s[o];e[a+u]=(a+u).toUpperCase();for(var l=0,c=t;l<c.length;l++){var d=c[l];e[a+u+d]=(a+u+d).toUpperCase()}}}return e}();function V0(e){return V6e[e]||e.toUpperCase()}var WU=new Map([[1,"H"],[2,"He"],[3,"Li"],[4,"Be"],[5,"B"],[6,"C"],[7,"N"],[8,"O"],[9,"F"],[10,"Ne"],[11,"Na"],[12,"Mg"],[13,"Al"],[14,"Si"],[15,"P"],[16,"S"],[17,"Cl"],[18,"Ar"],[19,"K"],[20,"Ca"],[21,"Sc"],[22,"Ti"],[23,"V"],[24,"Cr"],[25,"Mn"],[26,"Fe"],[27,"Co"],[28,"Ni"],[29,"Cu"],[30,"Zn"],[31,"Ga"],[32,"Ge"],[33,"As"],[34,"Se"],[35,"Br"],[36,"Kr"],[37,"Rb"],[38,"Sr"],[39,"Y"],[40,"Zr"],[41,"Nb"],[42,"Mo"],[43,"Tc"],[44,"Ru"],[45,"Rh"],[46,"Pd"],[47,"Ag"],[48,"Cd"],[49,"In"],[50,"Sn"],[51,"Sb"],[52,"Te"],[53,"I"],[54,"Xe"],[55,"Cs"],[56,"Ba"],[57,"La"],[58,"Ce"],[59,"Pr"],[60,"Nd"],[61,"Pm"],[62,"Sm"],[63,"Eu"],[64,"Gd"],[65,"Tb"],[66,"Dy"],[67,"Ho"],[68,"Er"],[69,"Tm"],[70,"Yb"],[71,"Lu"],[72,"Hf"],[73,"Ta"],[74,"W"],[75,"Re"],[76,"Os"],[77,"Ir"],[78,"Pt"],[79,"Au"],[80,"Hg"],[81,"Tl"],[82,"Pb"],[83,"Bi"],[84,"Po"],[85,"At"],[86,"Rn"],[87,"Fr"],[88,"Ra"],[89,"Ac"],[90,"Th"],[91,"Pa"],[92,"U"],[93,"Np"],[94,"Pu"],[95,"Am"],[96,"Cm"],[97,"Bk"],[98,"Cf"],[99,"Es"],[100,"Fm"],[101,"Md"],[102,"No"],[103,"Lr"],[104,"Rf"],[105,"Db"],[106,"Sg"],[107,"Bh"],[108,"Hs"],[109,"Mt"],[110,"Ds"],[111,"Rg"],[112,"Cn"],[113,"Uut"],[114,"Fl"],[115,"Uup"],[116,"Lv"],[117,"Uus"],[118,"Uuo"]].map(function(e){return[e[0],V0(e[1])]}));function H6e(e){return WU.has(e)?WU.get(e):V0("H")}var G6e=(fc={},fc[0]={trace:new Set,directionFrom:new Set,directionTo:new Set,backboneStart:new Set,backboneEnd:new Set,coarseBackbone:new Set},fc[1]={trace:new Set(["CA"]),directionFrom:new Set(["C"]),directionTo:new Set(["O","OC1","O1","OX1","OXT","OT1"]),backboneStart:new Set(["N"]),backboneEnd:new Set(["C"]),coarseBackbone:new Set(["CA","BB","CA1"])},fc[2]={trace:new Set(["CA"]),directionFrom:new Set(["C"]),directionTo:new Set(["O"]),backboneStart:new Set(["N"]),backboneEnd:new Set(["CD"]),coarseBackbone:new Set(["CA"])},fc[3]={trace:new Set(["CA"]),directionFrom:new Set(["C"]),directionTo:new Set(["O"]),backboneStart:new Set(["N"]),backboneEnd:new Set(["CG"]),coarseBackbone:new Set(["CA"])},fc[4]={trace:new Set(["O3'","O3*"]),directionFrom:new Set(["C4'","C4*"]),directionTo:new Set(["C3'","C3*"]),backboneStart:new Set(["P"]),backboneEnd:new Set(["O3'","O3*"]),coarseBackbone:new Set(["P"])},fc[5]={trace:new Set(["O3'","O3*"]),directionFrom:new Set(["C3'","C3*"]),directionTo:new Set(["C1'","C1*"]),backboneStart:new Set(["P"]),backboneEnd:new Set(["O3'","O3*"]),coarseBackbone:new Set(["P"])},fc[6]={trace:new Set(["N4'","N4*"]),directionFrom:new Set(["N4'","N4*"]),directionTo:new Set(["C7'","C7*"]),backboneStart:new Set(["N1'","N1*"]),backboneEnd:new Set(["C'","C*"]),coarseBackbone:new Set(["P"])},fc),pd=new Set(["CA","C","N","O","O1","O2","OC1","OC2","OT1","OT2","OX1","OXT","H","H1","H2","H3","HA","HN","HXT","BB"]),HE=new Set(["P","OP1","OP2","HOP2","HOP3","O2'","O3'","O4'","O5'","C1'","C2'","C3'","C4'","C5'","H1'","H2'","H2''","HO2'","H3'","H4'","H5'","H5''","HO3'","HO5'","O2*","O3*","O4*","O5*","C1*","C2*","C3*","C4*","C5*"]),AJ=new Set(["D-PEPTIDE LINKING","D-PEPTIDE NH3 AMINO TERMINUS","D-PEPTIDE COOH CARBOXY TERMINUS","D-GAMMA-PEPTIDE, C-DELTA LINKING","D-BETA-PEPTIDE, C-GAMMA LINKING"]),PJ=new Set(["L-PEPTIDE LINKING","L-PEPTIDE NH3 AMINO TERMINUS","L-PEPTIDE COOH CARBOXY TERMINUS","L-GAMMA-PEPTIDE, C-DELTA LINKING","L-BETA-PEPTIDE, C-GAMMA LINKING"]),q6e=new Set(["D-GAMMA-PEPTIDE, C-DELTA LINKING","L-GAMMA-PEPTIDE, C-DELTA LINKING"]),$6e=new Set(["D-BETA-PEPTIDE, C-GAMMA LINKING","L-BETA-PEPTIDE, C-GAMMA LINKING"]),W6e=new Set(["D-PEPTIDE NH3 AMINO TERMINUS","D-PEPTIDE COOH CARBOXY TERMINUS","L-PEPTIDE NH3 AMINO TERMINUS","L-PEPTIDE COOH CARBOXY TERMINUS"]),TJ=new Set(["PEPTIDE LINKING","PEPTIDE-LIKE"]),X6e=gi.unionMany(AJ,PJ,TJ),IJ=new Set(["DNA LINKING","L-DNA LINKING","DNA OH 5 PRIME TERMINUS","DNA OH 3 PRIME TERMINUS"]),MJ=new Set(["RNA LINKING","L-RNA LINKING","RNA OH 5 PRIME TERMINUS","RNA OH 3 PRIME TERMINUS"]),DJ=new Set(["D-SACCHARIDE, BETA LINKING","L-SACCHARIDE, BETA LINKING","D-SACCHARIDE, ALPHA LINKING","L-SACCHARIDE, ALPHA LINKING","L-SACCHARIDE","D-SACCHARIDE","SACCHARIDE","D-SACCHARIDE 1,4 AND 1,4 LINKING","L-SACCHARIDE 1,4 AND 1,4 LINKING","D-SACCHARIDE 1,4 AND 1,6 LINKING","L-SACCHARIDE 1,4 AND 1,6 LINKING"]),Y6e=new Set(["NON-POLYMER","OTHER"]),K6e=new Set(["ION"]),Q6e=new Set(["LIPID"]),GE=new Set(["SOL","WAT","HOH","H2O","W","DOD","D3O","TIP","TIP3","TIP4","SPC"]),K6=new Set(["HIS","ARG","LYS","ILE","PHE","LEU","TRP","ALA","MET","PRO","CYS","ASN","VAL","GLY","SER","GLN","TYR","ASP","GLU","THR","SEC","PYL","UNK","MSE","SEP","TPO","PTR","PCA","HSD","HSE","HSP","LSN","ASPP","GLUP","HID","HIE","HIP","LYN","ASH","GLH"]),RJ=new Set(["DAL","DAR","DSG","DAS","DCY","DGL","DGN","DHI","DIL","DLE","DLY","MED","DPN","DPR","DSN","DTH","DTR","DTY","DVA","DNE"]),qE=gi.unionMany(K6,RJ),$E=new Set(["A","C","T","G","I","U","N"]),WE=new Set(["DA","DC","DT","DG","DI","DU","DN"]),Q6=new Set(["APN","CPN","TPN","GPN"]),Z6e=new Set(["A","G","I","DA","DG","DI","APN","GPN"]),J6e=new Set(["C","T","U","DC","DT","DU","CPN","TPN"]),XE=gi.unionMany($E,WE,Q6),kJ=function(e){return Z6e.has(e.toUpperCase())},OJ=function(e){return J6e.has(e.toUpperCase())},T2=gi.unionMany(qE,XE);function H0(e,t){return e=e.toUpperCase(),t=t.toUpperCase(),Q6.has(t)?8:X6e.has(e)?5:MJ.has(e)?6:IJ.has(e)?7:DJ.has(e)?9:GE.has(t)?2:EJ.has(t)?3:wJ.has(t)?4:Y6e.has(e)?nv.has(t)?9:1:0}function eFe(e,t){return e=e.toUpperCase(),t===5?q6e.has(e)?2:$6e.has(e)?3:W6e.has(e)?0:1:t===6?4:t===7?5:t===8?6:0}function FJ(e){return e=e.toUpperCase(),qE.has(e)?"peptide linking":$E.has(e)?"RNA linking":WE.has(e)?"DNA linking":nv.has(e)?"saccharide":"other"}function tFe(e){return{formula:"",formula_weight:0,id:e,name:e,mon_nstd_flag:T2.has(e)?"y":"n",pdbx_synonyms:[],type:FJ(e)}}function rFe(e){return e=e.toUpperCase(),GE.has(e)?"water":T2.has(e)?"polymer":nv.has(e)?"branched":"non-polymer"}function nFe(e,t){return e=e.toUpperCase(),t=t.toUpperCase(),PJ.has(t)?"polypeptide(L)":AJ.has(t)?"polypeptide(D)":MJ.has(t)?"polyribonucleotide":IJ.has(t)?"polydeoxyribonucleotide":DJ.has(t)||nv.has(e)?"oligosaccharide":Q6.has(e)?"peptide nucleic acid":K6.has(e)?"polypeptide(L)":RJ.has(e)?"polypeptide(D)":$E.has(e)?"polyribonucleotide":WE.has(e)?"polydeoxyribonucleotide":K6e.has(t)||EJ.has(e)?"ion":Q6e.has(t)||wJ.has(e)?"lipid":TJ.has(t)?"peptide-like":"other"}function Z6(e){return ic(e)||LJ(e)}function ic(e){return e===7||e===6||e===8}function LJ(e){return e===5}var Vr;(function(e){e.is=_a.has,e.create=_a.create,e.SecondaryStructureMmcif={HELX_LH_27_P:1058,HELX_LH_3T_P:2082,HELX_LH_AL_P:4130,HELX_LH_A_N:524321,HELX_LH_B_N:1048609,HELX_LH_GA_P:8226,HELX_LH_N:33,HELX_LH_OM_P:16418,HELX_LH_OT_N:131105,HELX_LH_OT_P:546,HELX_LH_P:34,HELX_LH_PI_P:32802,HELX_LH_PP_P:65570,HELX_LH_Z_N:262177,HELX_N:1,HELX_OT_N:1,HELX_OT_P:2,HELX_P:2,HELX_RH_27_P:1090,HELX_RH_3T_P:2114,HELX_RH_AL_P:4162,HELX_RH_A_N:524353,HELX_RH_B_N:1048641,HELX_RH_GA_P:8258,HELX_RH_N:65,HELX_RH_OM_P:16450,HELX_RH_OT_N:131137,HELX_RH_OT_P:578,HELX_RH_P:66,HELX_RH_PI_P:32834,HELX_RH_PP_P:65602,HELX_RH_Z_N:262209,STRN:4194308,TURN_OT_P:33554448,TURN_P:16,TURN_TY1P_P:67109136,TURN_TY1_P:67109008,TURN_TY2P_P:134218e3,TURN_TY2_P:134217872,TURN_TY3P_P:268435728,TURN_TY3_P:268435600},e.SecondaryStructurePdb={1:4162,2:16450,3:32834,4:8258,5:2114,6:4130,7:16418,8:8226,9:1026,10:65538},e.SecondaryStructureStride={H:4098,G:2050,I:32770,E:8388612,B:4194308,T:16,C:536870912},e.SecondaryStructureDssp={H:4098,B:4194308,E:8388612,G:2050,I:32770,T:16,S:8}})(Vr||(Vr={}));var Hr;(function(e){e.is=_a.has;function t(s){return _a.create(s)}e.create=t;function r(s){return(s&1)!==0}e.isCovalent=r;function n(s){return s===Math.pow(2,6)-1}e.isAll=n,e.Names={covalent:1,"metal-coordination":2,"hydrogen-bond":4,disulfide:8,aromatic:16,computed:32};function i(s){return s in e.Names}e.isName=i;function a(s){switch(s){case"covalent":return 1;case"metal-coordination":return 2;case"hydrogen-bond":return 4;case"disulfide":return 8;case"aromatic":return 16;case"computed":return 32}}e.fromName=a;function o(s){for(var u=0,l=0,c=s.length;l<c;++l)u|=a(s[l]);return u}e.fromNames=o})(Hr||(Hr={}));var AD={ALA:[.17,.5,.33],ARG:[.81,1.81,1],ASN:[.42,.85,.43],ASP:[1.23,3.64,2.41],ASH:[-.07,.43,.5],CYS:[-.24,-.02,.22],GLN:[.58,.77,.19],GLU:[2.02,3.63,1.61],GLH:[-.01,.11,.12],GLY:[.01,1.15,1.14],HIS:[.17,.11,-.06],ILE:[-.31,-1.12,-.81],LEU:[-.56,-1.25,-.69],LYS:[.99,2.8,1.81],MET:[-.23,-.67,-.44],PHE:[-1.13,-1.71,-.58],PRO:[.45,.14,-.31],SER:[.13,.46,.33],THR:[.14,.25,.11],TRP:[-1.85,-2.09,-.24],TYR:[-.94,-.71,.23],VAL:[.07,-.46,-.53],HSD:[.17,.11,-.06],HSE:[.17,.11,-.06],HSP:[.96,2.33,1.37],HID:[.17,.11,-.06],HIE:[.17,.11,-.06],HIP:[.96,2.33,1.37]};function iFe(e,t){var r=e.coarseElements.entityKey[t],n=e.model.sequence.byEntityKey[r].sequence,i=e.coarseElements.seq_id_begin.value(t);return n.compId.value(i-1)}function J6(e,t){switch(e.kind){case 0:return e.model.atomicHierarchy.derived.residue.moleculeType[e.residueIndex[t]];case 1:case 2:var r=iFe(e,t),n=e.model.properties.chemicalComponentMap.get(r);if(n)return H0(n.type,r)}return 0}var aFe=new Set;function Qf(e,t){var r=G6e[e];if(r!==void 0){var n=r[t];if(n!==void 0)return n}return aFe}var XU=_.zero();function NJ(e,t){for(var r=e.conformation.position,n=new Float32Array(t.length*3),i=e.elements,a=0,o=t.length;a<o;++a)r(i[t[a]],XU),_.toArray(XU,n,a*3);return n}function oFe(e,t,r,n){for(var i=e.atoms,a=i.label_comp_id,o=i.type_symbol,s=i._rowCount,u=e.residues._rowCount,l=t.residueAtomSegments.offsets,c=new Uint8Array(s),d=0;d<s;++d)c[d]=P2(o.value(d));for(var f=new Int32Array(u),h=new Int32Array(u),v=new Int32Array(u),p=new Uint8Array(u),m=new Uint8Array(u),g=new Map,y=new Map,d=0;d<u;++d){var b=a.value(l[d]),S=n,x=void 0,C=void 0;if(g.has(b))x=g.get(b),C=y.get(b);else{var w=void 0;S.has(b)?w=S.get(b).type:(j0||console.info("chemComp not found",b),w=FJ(b)),x=H0(w,b),C=eFe(w,x),g.set(b,x),y.set(b,C)}p[d]=x,m[d]=C;var A=Qf(C,"trace"),M=r.findAtomsOnResidue(d,A);if(M===-1){var D=Qf(C,"coarseBackbone");M=r.findAtomsOnResidue(d,D)}f[d]=M;var k=Qf(C,"directionFrom");h[d]=r.findAtomsOnResidue(d,k);var R=Qf(C,"directionTo");v[d]=r.findAtomsOnResidue(d,R)}return{atom:{atomicNumber:c},residue:{traceElementIndex:f,directionFromElementIndex:h,directionToElementIndex:v,moleculeType:p,polymerType:m}}}function Ug(e,t,r){for(var n=new Float32Array(e),i=0;i<n.length;i++)n[i]=t+r*i;return n}var Cn;(function(e){e.DefaultName="1_555",e.Default=t(e.DefaultName,ue.identity()),e.RotationTranslationEpsilon=.005;function t(v,p,m){var g=m||{},y=g.assembly,b=g.ncsId,S=g.hkl,x=g.spgrOp,C=S?_.clone(S):_();x=Oi(x,-1),b=b||-1;var w=r(m);if(ue.isIdentity(p))return{name:v,assembly:y,matrix:p,inverse:ue.identity(),isIdentity:!0,hkl:C,spgrOp:x,ncsId:b,suffix:w};if(!ue.isRotationAndTranslation(p,e.RotationTranslationEpsilon))throw new Error("Symmetry operator ("+v+") must be a composition of rotation and translation.");return{name:v,assembly:y,matrix:p,inverse:ue.invert(ue(),p),isIdentity:!1,hkl:C,spgrOp:x,ncsId:b,suffix:w}}e.create=t;function r(v){if(!v)return"";if(v.assembly)return"_"+v.assembly.operId;if(typeof v.spgrOp<"u"&&typeof v.hkl<"u"&&v.spgrOp!==-1){var p=v.hkl,m=p[0],g=p[1],y=p[2];return"-"+(v.spgrOp+1)+"_"+(5+m)+(5+g)+(5+y)}return v.ncsId!==-1?"_"+v.ncsId:""}function n(v,p){for(var m=ue.identity(),g=0;g<3;g++)for(var y=0;y<3;y++)ue.setValue(m,g,y,Yn.getValue(v,g,y));return ue.setTranslation(m,p),ue.isRotationAndTranslation(m,e.RotationTranslationEpsilon)}e.checkIfRotationAndTranslation=n;function i(v,p,m,g){for(var y=ue.identity(),b=0;b<3;b++)for(var S=0;S<3;S++)ue.setValue(y,b,S,Yn.getValue(p,b,S));return ue.setTranslation(y,m),t(v,y,{ncsId:g})}e.ofRotationAndOffset=i;var a=Xn.identity(),o=Xn(),s=Xn(),u=_();function l(v,p,m){var g=p.inverse;if(p.isIdentity)return ue.copy(v,g);var y=1-m;ue.getRotation(o,g),Xn.slerp(o,a,o,y);var b=Xn.getAxisAngle(u,o);return ue.fromRotation(v,b,u),ue.setValue(v,0,3,y*ue.getValue(g,0,3)),ue.setValue(v,1,3,y*ue.getValue(g,1,3)),ue.setValue(v,2,3,y*ue.getValue(g,2,3)),v}e.lerpFromIdentity=l;function c(v,p,m,g){if(Math.abs(g)<=1e-5)return ue.copy(v,p);if(Math.abs(g-1)<=1e-5)return ue.copy(v,m);ue.getRotation(o,p),ue.getRotation(s,m),Xn.slerp(s,o,s,g);var y=Xn.getAxisAngle(u,s);return ue.fromRotation(v,y,u),ue.setValue(v,0,3,es(ue.getValue(p,0,3),ue.getValue(m,0,3),g)),ue.setValue(v,1,3,es(ue.getValue(p,1,3),ue.getValue(m,1,3),g)),ue.setValue(v,2,3,es(ue.getValue(p,2,3),ue.getValue(m,2,3),g)),v}e.slerp=c;function d(v,p){var m=ue.mul(ue(),p.matrix,v.matrix);return t(p.name,m,p)}e.compose=d;function f(v,p,m){var g=e.createCoordinateMapper(e.Default,p),y=v.isIdentity?g:e.createCoordinateMapper(v,p),b=uFe(v,p),S=b.x,x=b.y,C=b.z;return{operator:v,coordinates:p,invariantPosition:g,position:y,x:S,y:x,z:C,r:m||sFe}}e.createMapping=f;function h(v,p){return v.isIdentity?fFe(p):hFe(v,p)}e.createCoordinateMapper=h})(Cn||(Cn={}));function sFe(e){return 0}function uFe(e,t){return e.isIdentity?{x:$P(t.x),y:$P(t.y),z:$P(t.z)}:{x:lFe(e,t),y:cFe(e,t),z:dFe(e,t)}}function $P(e){return function(r){return e[r]}}function YE(e){return e[3]===0&&e[7]===0&&e[11]===0&&e[15]===1}function lFe(e,t){var r=e.matrix,n=t.x,i=t.y,a=t.z,o=r[0],s=r[4],u=r[8],l=r[12];return YE(r)?function(d){return o*n[d]+s*i[d]+u*a[d]+l}:function(d){var f=n[d],h=i[d],v=a[d],p=r[3]*f+r[7]*h+r[11]*v+r[15]||1;return(o*f+s*h+u*v+l)/p}}function cFe(e,t){var r=e.matrix,n=t.x,i=t.y,a=t.z,o=r[1],s=r[5],u=r[9],l=r[13];return YE(r)?function(d){return o*n[d]+s*i[d]+u*a[d]+l}:function(d){var f=n[d],h=i[d],v=a[d],p=r[3]*f+r[7]*h+r[11]*v+r[15]||1;return(o*f+s*h+u*v+l)/p}}function dFe(e,t){var r=e.matrix,n=t.x,i=t.y,a=t.z,o=r[2],s=r[6],u=r[10],l=r[14];return YE(r)?function(d){return o*n[d]+s*i[d]+u*a[d]+l}:function(d){var f=n[d],h=i[d],v=a[d],p=r[3]*f+r[7]*h+r[11]*v+r[15]||1;return(o*f+s*h+u*v+l)/p}}function fFe(e){var t=e.x,r=e.y,n=e.z;return function(a,o){return o[0]=t[a],o[1]=r[a],o[2]=n[a],o}}function hFe(e,t){var r=e.matrix,n=t.x,i=t.y,a=t.z;return YE(r)?function(s,u){var l=n[s],c=i[s],d=a[s];return u[0]=r[0]*l+r[4]*c+r[8]*d+r[12],u[1]=r[1]*l+r[5]*c+r[9]*d+r[13],u[2]=r[2]*l+r[6]*c+r[10]*d+r[14],u}:function(s,u){return u[0]=n[s],u[1]=i[s],u[2]=a[s],_.transformMat4(u,u,r),u}}var WP=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[-1,0,0,0],[0,-1,0,0],[0,0,-1,0],[0,1,0,.5],[1,0,0,.5],[-1,0,0,.5],[0,0,1,.5],[0,-1,0,.5],[0,0,-1,.5],[1,0,0,.25],[0,-1,0,.25],[0,0,1,.25],[-1,0,0,.25],[0,1,0,.25],[0,-1,0,.75],[0,0,1,.75],[0,1,0,.75],[1,0,0,.75],[-1,0,0,.75],[0,0,-1,.25],[0,0,-1,.75],[1,-1,0,0],[-1,1,0,0],[0,0,1,1/3],[0,0,1,2/3],[1,0,0,2/3],[0,1,0,1/3],[0,-1,0,2/3],[1,-1,0,1/3],[-1,1,0,2/3],[-1,0,0,1/3],[1,0,0,1/3],[0,1,0,2/3],[0,-1,0,1/3],[1,-1,0,2/3],[-1,1,0,1/3],[-1,0,0,2/3],[0,0,-1,1/3],[0,0,-1,2/3],[0,0,1,5/6],[0,0,1,1/6],[0,0,-1,5/6],[0,0,-1,1/6]],pFe=[[0,1,2],[3,4,5],[3,1,5],[3,6,5],[7,6,2],[8,6,5],[0,4,2],[0,4,9],[7,10,2],[7,10,9],[0,10,2],[8,10,5],[3,1,11],[3,6,11],[0,10,9],[8,6,11],[3,4,2],[0,4,5],[3,4,9],[7,10,5],[8,4,9],[8,10,9],[8,10,2],[0,6,9],[3,10,9],[0,10,11],[7,1,9],[8,1,11],[7,4,11],[7,6,9],[7,10,11],[3,10,2],[8,1,5],[0,4,11],[3,1,2],[3,1,9],[7,4,2],[8,1,2],[8,1,9],[3,6,9],[7,4,9],[8,6,2],[8,6,9],[3,6,2],[12,13,14],[15,16,14],[12,17,18],[15,19,18],[20,13,18],[21,16,18],[20,17,14],[21,19,14],[0,1,5],[8,10,11],[7,6,11],[7,6,5],[8,4,2],[7,4,5],[7,1,5],[7,1,11],[0,10,5],[0,1,11],[0,6,11],[0,6,5],[3,10,11],[8,4,11],[15,13,22],[12,16,22],[15,17,23],[12,19,23],[21,13,23],[20,16,23],[21,17,22],[20,19,22],[4,0,2],[1,3,2],[4,0,14],[1,3,18],[4,0,9],[1,3,9],[4,0,18],[1,3,14],[10,7,9],[6,8,9],[4,7,14],[6,3,18],[10,0,18],[1,8,14],[1,3,5],[4,0,5],[6,8,11],[10,7,11],[1,3,11],[4,0,11],[10,7,2],[6,8,2],[3,10,22],[7,1,23],[8,4,23],[0,6,22],[1,0,5],[4,3,5],[1,0,23],[4,3,22],[10,7,14],[6,8,18],[8,6,22],[7,10,23],[4,3,11],[1,0,11],[1,0,22],[4,3,23],[10,7,18],[6,8,14],[8,6,23],[7,10,22],[6,7,11],[10,8,11],[8,1,23],[0,10,22],[3,6,22],[7,4,23],[4,3,2],[1,0,2],[10,8,2],[6,7,2],[4,3,9],[1,0,9],[10,8,9],[6,7,9],[4,8,14],[6,0,18],[10,3,18],[1,7,14],[4,8,18],[6,0,14],[10,3,14],[1,7,18],[6,7,5],[10,8,5],[6,8,5],[10,7,5],[8,1,22],[0,10,23],[3,6,23],[7,4,22],[4,24,2],[25,3,2],[4,24,26],[25,3,27],[4,24,27],[25,3,26],[28,29,26],[30,31,26],[32,33,26],[34,35,27],[36,37,27],[38,39,27],[2,0,1],[1,2,0],[1,25,5],[24,0,5],[39,36,40],[35,38,40],[37,34,40],[33,30,41],[29,32,41],[31,28,41],[5,3,4],[4,5,3],[25,1,5],[0,24,5],[24,4,5],[3,25,5],[4,3,41],[25,1,40],[24,4,41],[3,25,40],[4,3,40],[25,1,41],[24,4,40],[3,25,41],[35,34,40],[37,36,40],[39,38,40],[29,28,41],[31,30,41],[33,32,41],[3,5,4],[5,4,3],[25,1,2],[0,24,2],[24,4,2],[3,25,2],[25,1,9],[0,24,9],[24,4,9],[3,25,9],[30,33,26],[32,29,26],[28,31,26],[36,39,27],[38,35,27],[34,37,27],[0,2,1],[2,1,0],[30,33,42],[32,29,42],[28,31,42],[36,39,43],[38,35,43],[34,37,43],[7,9,6],[9,6,7],[25,1,11],[0,24,11],[24,4,11],[3,25,11],[35,34,44],[37,36,44],[39,38,44],[29,28,45],[31,30,45],[33,32,45],[8,11,10],[11,10,8],[1,25,2],[24,0,2],[1,25,42],[24,0,43],[1,25,43],[24,0,42],[1,25,27],[24,0,26],[1,25,26],[24,0,27],[1,25,9],[24,0,9],[4,24,5],[25,3,5],[4,24,11],[25,3,11],[1,0,40],[4,3,44],[0,24,45],[1,0,41],[4,3,45],[0,24,44],[0,24,40],[0,24,41],[2,3,4],[5,3,1],[5,0,4],[4,2,3],[1,5,3],[4,5,0],[2,7,6],[2,8,10],[5,8,6],[5,7,10],[1,9,7],[4,9,8],[1,11,8],[4,11,7],[9,0,6],[9,3,10],[11,3,6],[11,0,10],[6,2,7],[10,2,8],[6,5,8],[10,5,7],[9,7,1],[9,8,4],[11,8,1],[11,7,4],[6,9,0],[10,9,3],[6,11,3],[10,11,0],[9,7,6],[9,8,10],[11,8,6],[11,7,10],[6,9,7],[10,9,8],[6,11,8],[10,11,7],[2,3,10],[5,8,1],[11,0,4],[10,2,3],[1,5,8],[4,11,0],[5,0,1],[2,0,4],[2,3,1],[1,5,0],[4,2,0],[1,2,3],[11,8,10],[11,7,6],[9,7,10],[9,8,6],[10,11,8],[6,11,7],[10,9,7],[6,9,8],[5,8,10],[5,7,6],[2,7,10],[2,8,6],[4,11,8],[1,11,7],[4,9,7],[1,9,8],[11,3,10],[11,0,6],[9,0,10],[9,3,6],[10,5,8],[6,5,7],[10,2,7],[6,2,8],[11,8,4],[11,7,1],[9,7,4],[9,8,1],[10,11,3],[6,11,0],[10,9,0],[6,9,3],[22,15,13],[22,12,16],[14,12,13],[14,15,16],[13,22,15],[16,22,12],[13,14,12],[16,14,15],[22,21,17],[22,20,19],[14,20,17],[14,21,19],[13,23,21],[16,23,20],[13,18,20],[16,18,21],[23,15,17],[23,12,19],[18,12,17],[18,15,19],[17,22,21],[19,22,20],[17,14,20],[19,14,21],[23,21,13],[23,20,16],[18,20,13],[18,21,16],[17,23,15],[19,23,12],[17,18,12],[19,18,15],[5,0,6],[2,7,4],[9,3,1],[6,5,0],[4,2,7],[1,9,3],[0,2,4],[3,2,1],[0,5,1],[2,1,3],[2,4,0],[5,1,0],[7,9,10],[8,9,6],[7,11,6],[9,6,8],[9,10,7],[11,6,7],[1,7,11],[4,8,11],[1,8,9],[4,7,9],[0,9,10],[3,9,6],[3,11,10],[0,11,6],[2,6,8],[2,10,7],[5,6,7],[5,10,8],[6,0,11],[10,3,11],[6,3,9],[10,0,9],[7,2,10],[8,2,6],[8,5,10],[7,5,6],[9,1,8],[9,4,7],[11,1,7],[11,4,8],[7,9,4],[8,9,1],[8,11,4],[7,11,1],[9,6,3],[9,10,0],[11,6,0],[11,10,3],[19,12,23],[13,15,22],[16,21,18],[17,20,14],[20,14,17],[21,18,16],[15,22,13],[12,23,19],[18,16,21],[14,17,20],[23,19,12],[22,13,15],[19,20,22],[13,21,23],[16,15,14],[17,12,18],[20,18,13],[21,14,19],[15,23,17],[12,22,16],[18,19,15],[14,13,12],[23,16,20],[22,17,21],[16,12,22],[17,15,23],[19,21,14],[13,20,18],[12,14,13],[15,18,19],[21,22,17],[20,23,16],[14,16,15],[18,17,12],[22,19,20],[23,13,21],[16,20,23],[17,21,22],[19,15,18],[13,12,14],[12,18,17],[15,14,16],[21,23,13],[20,22,19],[14,19,21],[18,13,20],[22,16,12],[23,17,15],[19,12,22],[17,21,23],[16,15,18],[13,20,14],[20,14,13],[15,18,16],[21,23,17],[12,22,19],[18,16,15],[14,13,20],[22,19,12],[23,17,21],[3,2,4],[3,5,1],[0,5,4],[2,4,3],[5,1,3],[5,4,0],[1,7,9],[4,8,9],[1,8,11],[4,7,11],[0,9,6],[3,9,10],[3,11,6],[0,11,10],[2,6,7],[2,10,8],[5,6,8],[5,10,7],[6,0,9],[10,3,9],[6,3,11],[10,0,11],[7,2,6],[8,2,10],[8,5,6],[7,5,10],[9,1,7],[9,4,8],[11,1,8],[11,4,7],[7,9,1],[8,9,4],[8,11,1],[7,11,4],[9,6,0],[9,10,3],[11,6,3],[11,10,0],[8,9,10],[8,11,6],[7,11,10],[9,10,8],[11,6,8],[11,10,7],[6,0,2],[10,3,2],[6,3,5],[10,0,5],[7,2,1],[8,2,4],[8,5,1],[7,5,4],[9,1,0],[9,4,3],[11,1,3],[11,4,0],[1,7,2],[4,8,2],[1,8,5],[4,7,5],[0,9,1],[3,9,4],[3,11,1],[0,11,4],[2,6,0],[2,10,3],[5,6,3],[5,10,0],[0,2,6],[3,2,10],[3,5,6],[0,5,10],[2,1,7],[2,4,8],[5,1,8],[5,4,7],[16,12,14],[13,21,18],[19,15,23],[17,20,22],[12,14,16],[21,18,13],[15,23,19],[20,22,17],[14,16,12],[18,13,21],[23,19,15],[22,17,20],[19,20,18],[17,15,14],[16,21,22],[13,12,23],[20,18,19],[15,14,17],[21,22,16],[12,23,13],[18,19,20],[14,17,15],[22,16,21],[23,13,12],[6,0,5],[10,3,5],[6,3,2],[10,0,2],[7,2,4],[8,2,1],[8,5,4],[7,5,1],[9,1,3],[9,4,0],[11,1,0],[11,4,3],[1,7,5],[4,8,5],[1,8,2],[4,7,2],[0,9,4],[3,9,1],[3,11,4],[0,11,1],[2,6,3],[2,10,0],[5,6,0],[5,10,3],[0,2,10],[3,2,6],[3,5,10],[0,5,6],[2,1,8],[2,4,7],[5,1,7],[5,4,8],[21,17,23],[20,16,22],[12,13,18],[15,19,14],[23,21,17],[22,20,16],[18,12,13],[14,15,19],[17,23,21],[16,22,20],[13,18,12],[19,14,15],[21,13,22],[20,19,23],[12,17,14],[15,16,18],[23,15,13],[22,12,19],[18,20,17],[14,21,16],[17,22,15],[16,23,12],[13,14,20],[19,18,21],[15,17,22],[12,16,23],[20,13,14],[21,19,18],[22,21,13],[23,20,19],[14,12,17],[18,15,16],[13,23,15],[19,22,12],[17,18,20],[16,14,21],[15,13,23],[12,19,22],[20,17,18],[21,16,14],[22,15,17],[23,12,16],[14,20,13],[18,21,19],[13,22,21],[19,23,20],[17,14,12],[16,18,15],[6,5,3],[4,9,3],[9,3,4],[5,7,4],[4,5,7],[5,3,6]],vFe=[[0],[0,1],[0,2],[0,3],[0,2,4,5],[0,6],[0,7],[0,6,4,8],[0,7,4,9],[0,6,2,1],[0,3,1,10],[0,6,2,1,4,8,5,11],[0,12,1,7],[0,1,13,14],[0,12,1,7,4,15,11,9],[0,16,2,17],[0,18,12,17],[0,16,5,19],[0,20,13,19],[0,18,12,17,4,21,15,19],[0,16,2,17,4,22,5,19],[0,16,2,17,23,24,13,25,26,20,27,28,4,22,5,19],[0,16,17,2,29,21,30,15],[0,20,13,19,29,31,32,33],[0,16,6,34],[0,18,7,34],[0,16,7,35],[0,16,36,37],[0,18,36,38],[0,16,14,39],[0,20,40,34],[0,16,8,41],[0,18,8,42],[0,16,9,42],[0,16,6,34,4,22,8,41],[0,18,7,34,4,21,9,41],[0,16,7,35,4,22,9,42],[0,16,6,34,23,24,14,39],[0,16,10,43,23,24,7,35],[0,16,36,37,23,24,9,42],[0,16,8,41,23,24,40,38],[0,16,6,34,23,24,14,39,26,20,40,38,4,22,8,41],[0,16,44,45,23,24,46,47,26,20,48,49,4,22,50,51],[0,16,6,34,29,21,9,42],[0,16,8,41,29,21,7,35],[0,16,36,37,29,21,14,39],[0,16,2,17,1,52,6,34],[0,16,2,17,53,54,9,42],[0,16,12,33,1,52,7,35],[0,16,2,17,11,55,8,41],[0,56,2,57,1,58,6,37],[0,56,15,25,1,58,9,39],[0,20,27,17,1,59,40,34],[0,56,12,28,1,58,7,38],[0,16,5,19,1,52,8,41],[0,22,13,28,1,55,14,38],[0,18,13,60,1,61,14,43],[0,16,15,30,1,52,9,42],[0,16,5,19,11,55,6,34],[0,21,12,19,1,54,7,41],[0,20,13,19,1,59,14,41],[0,20,3,30,1,59,10,42],[0,18,12,17,1,61,7,34,4,21,15,19,11,54,9,41],[0,24,13,17,1,62,14,34,4,20,27,19,11,59,40,41],[0,16,2,17,1,52,6,34,4,22,5,19,11,55,8,41],[0,16,12,33,1,52,7,35,4,22,15,30,11,55,9,42],[0,31,3,17,1,63,10,34,4,56,32,19,11,58,36,41],[0,22,2,19,64,59,14,38,4,16,5,17,65,62,40,39],[0,16,2,17,1,52,6,34,23,24,13,25,64,62,14,39,26,20,27,28,65,59,40,38,4,22,5,19,11,55,8,41],[0,16,2,17,66,67,44,45,23,24,13,25,68,69,46,47,26,20,27,28,70,71,48,49,4,22,5,19,72,73,50,51],[0,16,2,17,1,52,6,34,29,21,15,30,53,54,9,42],[0,16,5,19,1,52,8,41,29,21,12,33,53,54,7,35],[0,20,13,19,1,59,14,41,29,31,32,33,53,63,36,35],[0,31,3,17,1,63,10,34,29,20,27,30,53,59,40,42],[0,16,74,75],[0,18,76,77],[0,16,78,79],[0,18,80,81],[0,16,74,75,29,21,82,83],[0,21,84,85,29,16,86,87],[0,16,88,89],[0,16,88,89,29,21,90,91],[0,16,74,75,1,52,88,89],[0,16,78,79,1,52,92,93],[0,16,94,95,11,55,88,89],[0,16,82,83,53,54,88,89],[0,16,74,75,1,52,88,89,29,21,82,83,53,54,90,91],[0,21,84,85,96,97,88,91,29,16,86,87,98,99,90,89],[0,16,74,75,2,17,100,101],[0,16,94,95,5,19,100,101],[0,18,76,77,2,33,102,103],[0,18,104,105,106,107,100,108],[0,16,78,79,2,17,109,108],[0,16,82,83,15,30,100,101],[0,18,80,81,2,33,110,111],[0,18,112,113,114,115,100,108],[0,16,74,75,2,17,100,101,29,21,82,83,15,30,116,117],[0,21,84,85,118,119,116,101,29,16,86,87,120,121,100,117],[0,16,74,75,6,34,122,123],[0,16,74,75,8,41,124,125],[0,16,78,79,7,35,122,123],[0,16,82,83,9,42,122,123],[0,16,74,75,7,35,126,127],[0,16,74,75,9,42,128,129],[0,16,78,79,6,34,126,127],[0,16,78,79,8,41,128,129],[0,16,74,75,6,34,122,123,29,21,82,83,9,42,128,129],[0,16,74,75,7,35,126,127,29,21,82,83,8,41,124,125],[0,21,84,85,6,42,130,131,29,16,86,87,9,34,132,133],[0,21,84,85,7,41,134,135,29,16,86,87,8,35,136,137],[0,16,89,88,2,17,122,123],[0,16,89,88,12,33,126,127],[0,16,89,88,5,19,124,125],[0,16,89,88,15,30,128,129],[0,16,88,89,6,34,100,101],[0,16,89,88,7,35,109,108],[0,16,89,88,8,41,138,139],[0,16,89,88,9,42,116,117],[0,16,89,88,6,34,100,101,29,21,91,90,9,42,116,117],[0,16,89,88,7,35,109,108,29,21,91,90,8,41,138,139],[0,16,89,88,2,17,122,123,29,21,91,90,15,30,128,129],[0,16,89,88,118,121,132,131,29,21,91,90,120,119,130,133],[0,16,74,75,2,17,100,101,1,52,88,89,6,34,122,123],[0,16,74,75,12,33,109,108,1,52,88,89,7,35,126,127],[0,16,74,75,2,17,100,101,11,55,140,141,8,41,124,125],[0,16,74,75,2,17,100,101,53,54,90,91,9,42,128,129],[0,16,74,75,5,19,138,139,1,52,88,89,8,41,124,125],[0,16,74,75,15,30,116,117,1,52,88,89,9,42,128,129],[0,16,94,95,5,19,100,101,11,55,88,89,6,34,124,125],[0,16,94,95,15,30,109,108,11,55,88,89,7,35,128,129],[0,16,78,79,2,17,109,108,1,52,92,93,6,34,126,127],[0,16,78,79,12,33,100,101,1,52,92,93,7,35,122,123],[0,16,82,83,12,33,138,139,53,54,88,89,8,41,126,127],[0,16,82,83,2,17,116,117,53,54,88,89,9,42,122,123],[0,16,78,79,5,19,116,117,1,52,92,93,8,41,128,129],[0,16,82,83,15,30,100,101,1,52,90,91,9,42,122,123],[0,16,82,83,15,30,100,101,53,54,88,89,6,34,128,129],[0,16,82,83,5,19,109,108,53,54,88,89,7,35,124,125],[0,16,74,75,2,17,100,101,1,52,88,89,6,34,122,123,29,21,82,83,15,30,116,117,53,54,90,91,9,42,128,129],[0,16,74,75,12,33,109,108,1,52,88,89,7,35,126,127,29,21,82,83,5,19,138,139,53,54,90,91,8,41,124,125],[0,21,84,85,118,119,116,101,96,97,88,91,9,34,132,133,29,16,86,87,120,121,100,117,98,99,90,89,6,42,130,131],[0,21,84,85,142,143,138,108,96,97,88,91,8,35,136,137,29,16,86,87,144,145,109,139,98,99,90,89,7,41,134,135],[0,146,147],[0,148,149],[0,150,151],[0,146,147,152,153,154,155,156,157],[0,158,159],[0,146,147,1,160,161],[0,146,147,1,160,161,152,153,154,162,163,164,155,156,157,165,166,167],[0,158,159,1,168,169],[0,146,147,101,170,171],[0,146,147,100,172,173],[0,148,149,174,175,171],[0,148,149,100,176,177],[0,150,151,178,179,171],[0,150,151,100,180,181],[0,146,147,100,172,173,152,153,154,182,183,184,155,156,157,185,186,187],[0,158,159,101,188,189],[0,146,147,122,190,191],[0,146,147,123,192,193],[0,146,147,126,194,195],[0,146,147,127,196,197],[0,146,147,122,190,191,152,153,154,198,199,200,155,156,157,201,202,203],[0,158,159,123,204,205],[0,146,147,126,194,195,152,153,154,206,207,208,155,156,157,209,210,211],[0,158,159,129,212,213],[0,146,147,101,170,171,1,160,161,123,192,193],[0,146,147,108,214,215,1,160,161,127,196,197],[0,146,147,100,172,173,1,160,161,122,190,191],[0,146,147,109,216,217,1,160,161,126,194,195],[0,146,147,100,172,173,1,160,161,122,190,191,152,153,154,182,183,184,162,163,164,198,199,200,155,156,157,185,186,187,165,166,167,201,202,203],[0,158,159,101,188,189,1,168,169,123,204,205],[0,146,147,109,216,217,1,160,161,126,194,195,152,153,154,218,219,220,162,163,164,206,207,208,155,156,157,221,222,223,165,166,167,209,210,211],[0,158,159,117,224,225,1,168,169,129,212,213],[0,146,147,16,226,227],[0,148,149,18,228,229],[0,150,151,18,230,231],[0,150,151,16,232,233],[0,148,149,16,234,235],[0,146,147,18,236,237],[0,146,147,52,238,239],[0,146,147,16,226,227,1,160,161,52,238,239],[0,146,147,18,236,237,1,160,161,61,240,241],[0,146,147,16,226,227,100,172,173,101,170,171],[0,148,149,18,228,229,242,172,181,243,214,244],[0,150,151,18,230,231,245,172,177,246,214,247],[0,150,151,16,232,233,245,172,177,174,170,248],[0,148,149,16,234,235,242,172,181,178,170,249],[0,146,147,18,236,237,100,172,173,108,214,215],[0,146,147,16,226,227,122,190,191,123,192,193],[0,146,147,16,226,227,126,194,195,127,196,197],[0,146,147,18,236,237,126,194,195,123,192,193],[0,146,147,18,236,237,122,190,191,127,196,197],[0,146,147,52,238,239,122,190,191,101,170,171],[0,146,147,61,240,241,126,194,195,101,170,171],[0,146,147,52,238,239,100,172,173,123,192,193],[0,146,147,61,240,241,100,172,173,127,196,197],[0,146,147,16,226,227,100,172,173,101,170,171,1,160,161,52,239,238,122,190,191,123,192,193],[0,146,147,16,226,227,109,216,217,108,214,215,1,160,161,52,239,238,126,194,195,127,196,197],[0,146,147,18,236,237,109,216,217,101,170,171,1,160,161,61,241,240,126,194,195,123,192,193],[0,146,147,18,236,237,100,172,173,108,214,215,1,160,161,61,241,240,122,190,191,127,196,197],[0,16,2,17,158,250,251,252,159,253,254,255],[0,16,2,17,158,250,251,252,159,253,254,255,23,24,13,25,256,257,258,259,260,261,262,263,26,20,27,28,264,265,266,267,268,269,270,271,4,22,5,19,272,273,274,275,276,277,278,279],[0,16,2,17,158,250,251,252,159,253,254,255,29,21,15,30,280,281,282,283,284,285,286,287],[0,20,13,19,158,273,266,259,159,261,278,271],[0,20,13,19,158,273,266,259,159,261,278,271,29,31,32,33,280,288,289,290,284,291,292,293],[0,16,2,17,158,250,251,252,159,253,254,255,1,52,6,34,168,294,295,296,169,297,298,299],[0,16,2,17,158,250,251,252,159,253,254,255,53,54,9,42,300,301,302,303,304,305,306,307],[0,16,2,17,158,250,251,252,159,253,254,255,1,52,6,34,168,294,295,296,169,297,298,299,23,24,13,25,256,257,258,259,260,261,262,263,64,62,14,39,308,309,310,311,312,313,314,315,26,20,27,28,264,265,266,267,268,269,270,271,65,59,40,38,316,317,318,319,320,321,322,323,4,22,5,19,272,273,274,275,276,277,278,279,11,55,8,41,324,325,326,327,328,329,330,331],[0,16,2,17,158,250,251,252,159,253,254,255,66,67,44,45,332,333,334,335,336,337,338,339,23,24,13,25,256,257,258,259,260,261,262,263,68,69,46,47,340,341,342,343,344,345,346,347,26,20,27,28,264,265,266,267,268,269,270,271,70,71,48,49,348,349,350,351,352,353,354,355,4,22,5,19,272,273,274,275,276,277,278,279,72,73,50,51,356,357,358,359,360,361,362,363],[0,16,2,17,158,250,251,252,159,253,254,255,1,52,6,34,168,294,295,296,169,297,298,299,29,21,15,30,280,281,282,283,284,285,286,287,53,54,9,42,300,301,302,303,304,305,306,307],[0,20,13,19,158,273,266,259,159,261,278,271,1,59,14,41,168,325,318,311,169,313,330,323],[0,20,13,19,158,273,266,259,159,261,278,271,1,59,14,41,168,325,318,311,169,313,330,323,29,31,32,33,280,288,289,290,284,291,292,293,53,63,36,35,300,364,365,366,304,367,368,369],[0,16,2,17,158,250,251,252,159,253,254,255,100,101,75,74,370,371,188,372,373,374,375,189],[0,16,2,17,158,250,251,252,159,253,254,255,116,117,83,82,376,377,224,378,379,380,381,225],[0,16,2,17,158,250,251,252,159,253,254,255,100,101,75,74,370,371,188,372,373,374,375,189,23,24,13,25,256,257,258,259,260,261,262,263,382,383,384,385,386,387,388,389,390,391,392,393,26,20,27,28,264,265,266,267,268,269,270,271,394,395,396,397,398,399,400,401,402,403,404,405,4,22,5,19,272,273,274,275,276,277,278,279,138,139,95,94,406,407,408,409,410,411,412,413],[0,24,5,28,158,265,258,275,159,277,270,263,414,415,416,417,418,419,420,421,422,423,424,425,23,16,27,19,256,273,251,267,260,269,278,255,426,427,428,429,430,431,432,433,434,435,436,437,26,22,13,17,264,250,274,259,268,261,254,279,438,439,440,441,442,443,444,445,446,447,448,449,4,20,2,25,272,257,266,252,276,253,262,271,450,451,452,453,454,455,456,457,458,459,460,461],[0,16,2,17,158,250,251,252,159,253,254,255,100,101,75,74,370,371,188,372,373,374,375,189,29,21,15,30,280,281,282,283,284,285,286,287,116,117,83,82,376,377,224,378,379,380,381,225],[0,20,13,19,158,273,266,259,159,261,278,271,450,415,440,429,454,431,420,445,458,447,436,425],[0,20,13,19,158,273,266,259,159,261,278,271,462,463,464,465,466,467,468,469,470,471,472,473],[0,20,13,19,158,273,266,259,159,261,278,271,462,463,464,465,466,467,468,469,470,471,472,473,29,31,32,33,280,288,289,290,284,291,292,293,450,415,440,429,454,431,420,445,458,447,436,425],[0,16,2,17,158,250,251,252,159,253,254,255,123,122,88,89,204,474,475,476,205,477,478,479],[0,16,2,17,158,250,251,252,159,253,254,255,123,122,88,89,204,474,475,476,205,477,478,479,23,24,13,25,256,257,258,259,260,261,262,263,480,481,482,483,484,485,486,487,488,489,490,491,26,20,27,28,264,265,266,267,268,269,270,271,492,493,494,495,496,497,498,499,500,501,502,503,4,22,5,19,272,273,274,275,276,277,278,279,125,124,140,141,504,505,506,507,508,509,510,511],[0,16,2,17,158,250,251,252,159,253,254,255,123,122,88,89,204,474,475,476,205,477,478,479,29,21,15,30,280,281,282,283,284,285,286,287,129,128,90,91,212,512,513,514,213,515,516,517],[0,16,2,17,158,250,251,252,159,253,254,255,129,128,90,91,212,512,513,514,213,515,516,517],[0,16,2,17,158,250,251,252,159,253,254,255,129,128,90,91,212,512,513,514,213,515,516,517,23,24,13,25,256,257,258,259,260,261,262,263,518,519,520,521,522,523,524,525,526,527,528,529,26,20,27,28,264,265,266,267,268,269,270,271,530,531,532,533,534,535,536,537,538,539,540,541,4,22,5,19,272,273,274,275,276,277,278,279,127,126,92,93,542,543,544,545,546,547,548,549],[0,20,13,19,158,273,266,259,159,261,278,271,550,551,552,553,554,555,556,557,558,559,560,561,29,31,32,33,280,288,289,290,284,291,292,293,562,563,564,565,566,567,568,569,570,571,572,573],[0,16,2,17,158,250,251,252,159,253,254,255,100,101,75,74,370,371,188,372,373,374,375,189,1,52,6,34,168,294,295,296,169,297,298,299,122,123,89,88,475,476,204,474,479,478,477,205],[0,16,2,17,158,250,251,252,159,253,254,255,100,101,75,74,370,371,188,372,373,374,375,189,53,54,9,42,300,301,302,303,304,305,306,307,128,129,91,90,513,514,212,512,517,516,515,213],[0,16,2,17,158,250,251,252,159,253,254,255,116,117,83,82,376,377,224,378,379,380,381,225,1,52,6,34,168,294,295,296,169,297,298,299,128,129,91,90,513,514,212,512,517,516,515,213],[0,16,2,17,158,250,251,252,159,253,254,255,116,117,83,82,376,377,224,378,379,380,381,225,53,54,9,42,300,301,302,303,304,305,306,307,122,123,89,88,475,476,204,474,479,478,477,205],[0,16,2,17,158,250,251,252,159,253,254,255,100,101,75,74,370,371,188,372,373,374,375,189,1,52,6,34,168,294,295,296,169,297,298,299,122,123,89,88,475,476,204,474,479,478,477,205,23,24,13,25,256,257,258,259,260,261,262,263,382,383,384,385,386,387,388,389,390,391,392,393,64,62,14,39,308,309,310,311,312,313,314,315,481,480,483,482,486,487,484,485,491,490,489,488,26,20,27,28,264,265,266,267,268,269,270,271,394,395,396,397,398,399,400,401,402,403,404,405,65,59,40,38,316,317,318,319,320,321,322,323,493,492,495,494,498,499,496,497,503,502,501,500,4,22,5,19,272,273,274,275,276,277,278,279,138,139,95,94,406,407,408,409,410,411,412,413,11,55,8,41,324,325,326,327,328,329,330,331,124,125,141,140,506,507,504,505,511,510,509,508],[0,16,2,17,158,250,251,252,159,253,254,255,116,117,83,82,376,377,224,378,379,380,381,225,1,52,6,34,168,294,295,296,169,297,298,299,128,129,91,90,513,514,212,512,517,516,515,213,23,24,13,25,256,257,258,259,260,261,262,263,574,575,576,577,578,579,580,581,582,583,584,585,64,62,14,39,308,309,310,311,312,313,314,315,519,518,521,520,524,525,522,523,529,528,527,526,26,20,27,28,264,265,266,267,268,269,270,271,586,587,588,589,590,591,592,593,594,595,596,597,65,59,40,38,316,317,318,319,320,321,322,323,531,530,533,532,536,537,534,535,541,540,539,538,4,22,5,19,272,273,274,275,276,277,278,279,109,108,79,78,598,599,600,601,602,603,604,605,11,55,8,41,324,325,326,327,328,329,330,331,126,127,93,92,544,545,542,543,549,548,547,546],[0,24,5,28,158,265,258,275,159,277,270,263,414,415,416,417,418,419,420,421,422,423,424,425,66,69,50,49,332,349,342,359,336,361,354,347,493,123,483,140,498,507,204,485,503,490,509,205,23,16,27,19,256,273,251,267,260,269,278,255,426,427,428,429,430,431,432,433,434,435,436,437,68,67,48,51,340,357,334,351,344,353,362,339,124,480,89,494,506,499,484,474,511,478,501,488,26,22,13,17,264,250,274,259,268,261,254,279,438,439,440,441,442,443,444,445,446,447,448,449,70,73,46,45,348,333,358,343,352,345,338,363,122,492,141,482,475,487,496,505,479,510,489,500,4,20,2,25,272,257,266,252,276,253,262,271,450,451,452,453,454,455,456,457,458,459,460,461,72,71,44,47,356,341,350,335,360,337,346,355,481,125,495,88,486,476,504,497,491,502,477,508],[0,24,5,28,158,265,258,275,159,277,270,263,414,415,416,417,418,419,420,421,422,423,424,425,606,607,608,609,610,611,612,613,614,615,616,617,531,129,521,92,536,545,212,523,541,528,547,213,23,16,27,19,256,273,251,267,260,269,278,255,426,427,428,429,430,431,432,433,434,435,436,437,618,619,620,621,622,623,624,625,626,627,628,629,126,518,91,532,544,537,522,512,549,516,539,526,26,22,13,17,264,250,274,259,268,261,254,279,438,439,440,441,442,443,444,445,446,447,448,449,630,631,632,633,634,635,636,637,638,639,640,641,128,530,93,520,513,525,534,543,517,548,527,538,4,20,2,25,272,257,266,252,276,253,262,271,450,451,452,453,454,455,456,457,458,459,460,461,642,643,644,645,646,647,648,649,650,651,652,653,519,127,533,90,524,514,542,535,529,540,515,546],[0,16,2,17,158,250,251,252,159,253,254,255,100,101,75,74,370,371,188,372,373,374,375,189,1,52,6,34,168,294,295,296,169,297,298,299,122,123,89,88,475,476,204,474,479,478,477,205,29,21,15,30,280,281,282,283,284,285,286,287,116,117,83,82,376,377,224,378,379,380,381,225,53,54,9,42,300,301,302,303,304,305,306,307,128,129,91,90,513,514,212,512,517,516,515,213],[0,20,13,19,158,273,266,259,159,261,278,271,462,463,464,465,466,467,468,469,470,471,472,473,1,59,14,41,168,325,318,311,169,313,330,323,551,550,553,552,556,557,554,555,561,560,559,558,29,31,32,33,280,288,289,290,284,291,292,293,450,415,440,429,454,431,420,445,458,447,436,425,53,63,36,35,300,364,365,366,304,367,368,369,563,562,565,564,568,569,566,567,573,572,571,570],[0,16],[0,18],[0,16,26,20],[0,2,23,13],[0,3,4,32],[0,2,29,15],[0,3,29,27],[0,52],[0,63],[0,52,26,59],[0,63,26,54],[0,52,16,1],[0,18,1,61],[0,52,16,1,26,59,20,65],[0,31,1,63],[0,1,24,62],[0,15,1,9],[0,5,1,8],[0,31,1,63,26,21,65,54],[0,2,57,56],[0,60,3,16],[0,22,57,3],[0,2,28,20],[0,17,13,24],[0,20,19,13,4,24,17,27],[0,22,57,3,4,16,60,32],[0,22,57,3,23,20,30,12,26,24,33,15,4,16,60,32],[0,22,57,3,29,18,27,25],[0,22,3,57,1,55,10,37],[0,22,385,396,3,57,109,117],[0,22,57,3,159,279,654,655,158,274,656,657,29,18,25,27,284,658,262,269,280,659,257,267]],qb={"P 1":0,"P -1":1,"P 1 2 1":2,"P 1 21 1":3,"C 1 2 1":4,"P 1 m 1":5,"P 1 c 1":6,"C 1 m 1":7,"C 1 c 1":8,"P 1 2/m 1":9,"P 1 21/m 1":10,"C 1 2/m 1":11,"P 1 2/c 1":12,"P 1 21/c 1":13,"C 1 2/c 1":14,"P 2 2 2":15,"P 2 2 21":16,"P 21 21 2":17,"P 21 21 21":18,"C 2 2 21":19,"C 2 2 2":20,"F 2 2 2":21,"I 2 2 2":22,"I 21 21 21":23,"P m m 2":24,"P m c 21":25,"P c c 2":26,"P m a 2":27,"P c a 21":28,"P n c 2":29,"P m n 21":30,"P b a 2":31,"P n a 21":32,"P n n 2":33,"C m m 2":34,"C m c 21":35,"C c c 2":36,"A m m 2":37,"A b m 2":38,"A m a 2":39,"A b a 2":40,"F m m 2":41,"F d d 2":42,"I m m 2":43,"I b a 2":44,"I m a 2":45,"P 2/m 2/m 2/m":46,"P m m m":46,"P 2/n 2/n 2/n":47,"P n n n":47,"P 2/c 2/c 2/m":48,"P c c m":48,"P 2/b 2/a 2/n":49,"P b a n":49,"P 21/m 2/m 2/a":50,"P m m a":50,"P 2/n 21/n 2/a":51,"P n n a":51,"P 2/m 2/n 21/a":52,"P m n a":52,"P 21/c 2/c 2/a":53,"P c c a":53,"P 21/b 21/a 2/m":54,"P b a m":54,"P 21/c 21/c 2/n":55,"P c c n":55,"P 2/b 21/c 21/m":56,"P b c m":56,"P 21/n 21/n 2/m":57,"P n n m":57,"P 21/m 21/m 2/n":58,"P m m n":58,"P 21/b 2/c 21/n":59,"P b c n":59,"P 21/b 21/c 21/a":60,"P b c a":60,"P 21/n 21/m 21/a":61,"P n m a":61,"C 2/m 2/c 21/m":62,"C m c m":62,"C 2/m 2/c 21/a":63,"C m c a":63,"C 2/m 2/m 2/m":64,"C m m m":64,"C 2/c 2/c 2/m":65,"C c c m":65,"C 2/m 2/m 2/a":66,"C m m a":66,"C 2/c 2/c 2/a":67,"C c c a":67,"F 2/m 2/m 2/m":68,"F m m m":68,"F 2/d 2/d 2/d":69,"F d d d":69,"I 2/m 2/m 2/m":70,"I m m m":70,"I 2/b 2/a 2/m":71,"I b a m":71,"I 21/b 21/c 21/a":72,"I b c a":72,"I 21/m 21/m 21/a":73,"I m m a":73,"P 4":74,"P 41":75,"P 42":76,"P 43":77,"I 4":78,"I 41":79,"P -4":80,"I -4":81,"P 4/m":82,"P 42/m":83,"P 4/n":84,"P 42/n":85,"I 4/m":86,"I 41/a":87,"P 4 2 2":88,"P 4 21 2":89,"P 41 2 2":90,"P 41 21 2":91,"P 42 2 2":92,"P 42 21 2":93,"P 43 2 2":94,"P 43 21 2":95,"I 4 2 2":96,"I 41 2 2":97,"P 4 m m":98,"P 4 b m":99,"P 42 c m":100,"P 42 n m":101,"P 4 c c":102,"P 4 n c":103,"P 42 m c":104,"P 42 b c":105,"I 4 m m":106,"I 4 c m":107,"I 41 m d":108,"I 41 c d":109,"P -4 2 m":110,"P -4 2 c":111,"P -4 21 m":112,"P -4 21 c":113,"P -4 m 2":114,"P -4 c 2":115,"P -4 b 2":116,"P -4 n 2":117,"I -4 m 2":118,"I -4 c 2":119,"I -4 2 m":120,"I -4 2 d":121,"P 4/m 2/m 2/m":122,"P4/m m m":122,"P 4/m 2/c 2/c":123,"P4/m c c":123,"P 4/n 2/b 2/m":124,"P4/n b m":124,"P 4/n 2/n 2/c":125,"P4/n n c":125,"P 4/m 21/b 2/m":126,"P4/m b m":126,"P 4/m 21/n 2/c":127,"P4/m n c":127,"P 4/n 21/m 2/m":128,"P4/n m m":128,"P 4/n 2/c 2/c":129,"P4/n c c":129,"P 42/m 2/m 2/c":130,"P42/m m c":130,"P 42/m 2/c 2/m":131,"P42/m c m":131,"P 42/n 2/b 2/c":132,"P42/n b c":132,"P 42/n 2/n 2/m":133,"P42/n n m":133,"P 42/m 21/b 2/c":134,"P42/m b c":134,"P 42/m 21/n 2/m":135,"P42/m n m":135,"P 42/n 21/m 2/c":136,"P42/n m c":136,"P 42/n 21/c 2/m":137,"P42/n c m":137,"I 4/m 2/m 2/m":138,"I4/m m m":138,"I 4/m 2/c 2/m":139,"I4/m c m":139,"I 41/a 2/m 2/d":140,"I41/a m d":140,"I 41/a 2/c 2/d":141,"I41/a c d":141,"P 3":142,"P 31":143,"P 32":144,"H 3":145,"R 3":146,"P -3":147,"H -3":148,"R -3":149,"P 3 1 2":150,"P 3 2 1":151,"P 31 1 2":152,"P 31 2 1":153,"P 32 1 2":154,"P 32 2 1":155,"H 3 2":156,"R 3 2":157,"P 3 m 1":158,"P 3 1 m":159,"P 3 c 1":160,"P 3 1 c":161,"H 3 m":162,"R 3 m":163,"H 3 c":164,"R 3 c":165,"P -3 1 2/m":166,"P -3 1 m":166,"P -3 1 2/c":167,"P -3 1 c":167,"P -3 2/m 1":168,"P -3 m 1":168,"P -3 2/c 1":169,"P -3 c 1":169,"H -3 2/m":170,"H -3 m":170,"R -3 2/m":171,"R -3 m":171,"H -3 2/c":172,"H -3 c":172,"R -3 2/c":173,"R -3 c":173,"P 6":174,"P 61":175,"P 65":176,"P 62":177,"P 64":178,"P 63":179,"P -6":180,"P 6/m":181,"P 63/m":182,"P 6 2 2":183,"P 61 2 2":184,"P 65 2 2":185,"P 62 2 2":186,"P 64 2 2":187,"P 63 2 2":188,"P 6 m m":189,"P 6 c c":190,"P 63 c m":191,"P 63 m c":192,"P -6 m 2":193,"P -6 c 2":194,"P -6 2 m":195,"P -6 2 c":196,"P 6/m 2/m 2/m":197,"P 6/m m m":197,"P 6/m 2/c 2/c":198,"P 6/m c c":198,"P 63/m 2/c 2/m":199,"P 63/m c m":199,"P 63/m 2/m 2/c":200,"P 63/m m c":200,"P 2 3":201,"F 2 3":202,"I 2 3":203,"P 21 3":204,"I 21 3":205,"P 2/m -3":206,"P m -3":206,"P 2/n -3":207,"P n -3":207,"F 2/m -3":208,"F m -3":208,"F 2/d -3":209,"F d -3":209,"I 2/m -3":210,"I m -3":210,"P 21/a -3":211,"P a -3":211,"I 21/a -3":212,"I a -3":212,"P 4 3 2":213,"P 42 3 2":214,"F 4 3 2":215,"F 41 3 2":216,"I 4 3 2":217,"P 43 3 2":218,"P 41 3 2":219,"I 41 3 2":220,"P -4 3 m":221,"F -4 3 m":222,"I -4 3 m":223,"P -4 3 n":224,"F -4 3 c":225,"I -4 3 d":226,"P 4/m -3 2/m":227,"P m -3 m":227,"P 4/n -3 2/n":228,"P n -3 n":228,"P 42/m -3 2/n":229,"P m -3 n":229,"P 42/n -3 2/m":230,"P n -3 m":230,"F 4/m -3 2/m":231,"F m -3 m":231,"F 4/m -3 2/c":232,"F m -3 c":232,"F 41/d -3 2/m":233,"F d -3 m":233,"F 41/d -3 2/c":234,"F d -3 c":234,"I 4/m -3 2/m":235,"I m -3 m":235,"I 41/a -3 2/d":236,"I a -3 d":236,"P 1 1 2":237,"P 1 1 21":238,"B 1 1 2":239,"B 2":239,"A 1 2 1":240,"C 1 21 1":241,"I 1 2 1":242,"I 2":242,"I 1 21 1":243,"P 1 1 m":244,"P 1 1 b":245,"B 1 1 m":246,"B 1 1 b":247,"P 1 1 2/m":248,"P 1 1 21/m":249,"B 1 1 2/m":250,"P 1 1 2/b":251,"P 1 1 21/b":252,"P 1 21/n 1":253,"P 1 21/a 1":254,"B 1 1 2/b":255,"P 21 2 2":256,"P 2 21 2":257,"P 21 21 2 (a)":258,"P 21 2 21":259,"P 2 21 21":260,"C 2 2 21a)":261,"C 2 2 2a":262,"F 2 2 2a":263,"I 2 2 2a":264,"P 21/m 21/m 2/n a":265,"P 42 21 2a":266,"I 2 3a":267};function mFe(e){switch(e){case 1146:return 146;case 1148:return 149;case 1155:return 157;case 1160:return 163;case 1161:return 165;case 1166:return 171;case 1167:return 173;case 1003:return 237;case 1004:return 238;case 1005:return 239;case 2005:return 240;case 3005:return 241;case 4005:return 242;case 5005:return 243;case 1006:return 244;case 1007:return 245;case 1008:return 246;case 1009:return 247;case 1010:return 248;case 1011:return 249;case 1012:return 250;case 1013:return 251;case 1014:return 252;case 2014:return 253;case 3014:return 254;case 1015:return 255;case 1017:return 256;case 2017:return 257;case 1018:return 258;case 2018:return 259;case 3018:return 260;case 1020:return 261;case 1021:return 262;case 1022:return 263;case 1023:return 264;case 1059:return 265;case 1094:return 266;case 1197:return 267}var t=0;return e>146&&++t,e>148&&++t,e>155&&++t,e>160&&++t,e>161&&++t,e>166&&++t,e>167&&++t,e-1+t}function gFe(e){if(e<146)return e+1;if(e===146)return 1146;if(e<149)return e+1-1;if(e===149)return 1148;if(e<157)return e+1-2;if(e===157)return 1155;if(e<163)return e+1-3;if(e===163)return 1160;if(e<165)return e+1-4;if(e===165)return 1161;if(e<171)return e+1-5;if(e===171)return 1166;if(e<173)return e+1-6;if(e===173)return 1167;if(e<237)return e+1-7;if(e===237)return 1003;if(e===238)return 1004;if(e===239)return 1005;if(e===240)return 2005;if(e===241)return 3005;if(e===242)return 4005;if(e===243)return 5005;if(e===244)return 1006;if(e===245)return 1007;if(e===246)return 1008;if(e===247)return 1009;if(e===248)return 1010;if(e===249)return 1011;if(e===250)return 1012;if(e===251)return 1013;if(e===252)return 1014;if(e===253)return 2014;if(e===254)return 3014;if(e===255)return 1015;if(e===256)return 1017;if(e===257)return 2017;if(e===258)return 1018;if(e===259)return 2018;if(e===260)return 3018;if(e===261)return 1020;if(e===262)return 1021;if(e===263)return 1022;if(e===264)return 1023;if(e===265)return 1059;if(e===266)return 1094;if(e===267)return 1197;throw new Error("unknown spacegroup index '"+e+"'")}var BJ=function(){for(var e=Object.create(null),t=0,r=Object.keys(qb);t<r.length;t++){var n=r[t];e[qb[n]]=n}return e}(),yFe=function(){for(var e=Object.create(null),t=0,r=Object.keys(qb);t<r.length;t++){var n=r[t],i=qb[n];e[i]=gFe(i)}return e}();function bFe(e){var t=typeof e=="number"?mFe(e):qb[e];return typeof t>"u"||typeof BJ[t]>"u"?-1:t}var Fo;(function(e){e.Zero=r("P 1",_.create(1,1,1),_.create(Math.PI/2,Math.PI/2,Math.PI/2));function t(n){return n?n.index===0&&n.size[0]===1&&n.size[1]===1&&n.size[1]===1:!0}e.isZero=t;function r(n,i,a){var o=bFe(n);if(o<0)return console.warn("Unknown spacegroup '"+n+"', returning a 'P 1' with cellsize [1, 1, 1]"),e.Zero;var s=i[0]*i[1]*i[2],u=a[0],l=a[1],c=a[2],d=i[0],f=i[1],h=i[2],v=Math.cos(l),p=(Math.cos(u)-Math.cos(l)*Math.cos(c))/Math.sin(c),m=Math.sqrt(1-v*v-p*p),g=[d,0,0],y=[Math.cos(c)*f,Math.sin(c)*f,0],b=[v*h,p*h,m*h],S=ue.ofRows([[g[0],y[0],b[0],0],[0,y[1],b[1],0],[0,0,b[2],0],[0,0,0,1]]),x=ue.invert(ue.zero(),S);return{index:o,size:i,volume:s,anglesInRadians:a,toFractional:x,fromFractional:S}}e.create=r})(Fo||(Fo={}));var Xu;(function(e){e.ZeroP1=t(Fo.Zero);function t(m){var g=vFe[m.index].map(function(S){return d(pFe[S])}),y=BJ[m.index],b=yFe[m.index];return{name:y,num:b,cell:m,operators:g}}e.create=t;var r=_(),n=ue();function i(m,g,y,b,S,x){return _.set(r,y,b,S),ue.fromTranslation(n,r),ue.mul(x,ue.mul(x,ue.mul(x,m.cell.fromFractional,n),m.operators[g]),m.cell.toFractional)}e.setOperatorMatrix=i;function a(m,g,y,b,S){var x=i(m,g,y,b,S,ue.zero());return Cn.create(g+1+"_"+(5+y)+(5+b)+(5+S),x,{hkl:_.create(y,b,S),spgrOp:g})}e.getSymmetryOperator=a;var o=_(),s=_(),u=_(),l=_();function c(m,g,y,b,S,x){var C=ue.zero();_.set(r,y,b,S),_.floor(o,x),ue.copy(C,m.operators[g]),_.floor(s,_.transformMat4(s,x,C)),ue.getTranslation(l,C),_.sub(l,l,s),_.add(l,l,o),_.add(l,l,r),ue.setTranslation(C,l),ue.mul(C,m.cell.fromFractional,C),ue.mul(C,C,m.cell.toFractional),_.sub(u,s,o);var w=y-u[0],A=b-u[1],M=S-u[2];return Cn.create(g+1+"_"+(5+w)+(5+A)+(5+M),C,{hkl:_.create(w,A,M),spgrOp:g})}e.getSymmetryOperatorRef=c;function d(m){var g=WP[m[0]],y=WP[m[1]],b=WP[m[2]];return ue.ofRows([g,y,b,[0,0,0,1]])}function f(m){return[p(h(m[0],m[4],m[8]),v(m[12])),p(h(m[1],m[5],m[9]),v(m[13])),p(h(m[2],m[6],m[10]),v(m[14]))].join(",")}e.getOperatorXyz=f;function h(m,g,y){var b=[];if(m>0?b.push("+X"):m<0&&b.push("-X"),g>0?b.push("+Y"):g<0&&b.push("-Y"),y>0?b.push("+Z"):y<0&&b.push("-Z"),b.length===1)return b[0].charAt(0)==="+"?b[0].substr(1):b[0];if(b.length===2){var S=b[0].charAt(0),x=b[1].charAt(0);if(S==="+")return""+b[0].substr(1)+b[1];if(x==="+")return""+b[1].substr(1)+b[0]}throw new Error("unknown rotation '"+b+"', "+m+" "+g+" "+y)}function v(m){switch(m){case 1/2:return"1/2";case 1/4:return"1/4";case 3/4:return"3/4";case 1/3:return"1/3";case 2/3:return"2/3";case 1/6:return"1/6";case 5/6:return"5/6"}return""}function p(m,g){return g===""?m:m.length>2?m+"+"+g:m.charAt(0)==="-"?""+g+m:g+"+"+m}})(Xu||(Xu={}));var Ih;(function(e){function t(a,o,s){a.squaredDistances[a.count]=s,a.indices[a.count++]=o}e.add=t;function r(a){a.count=0}e.reset=r;function n(){return{count:0,indices:[],squaredDistances:[]}}e.create=n;function i(a,o){for(var s=0;s<o.count;++s)a.indices[s]=o.indices[s],a.squaredDistances[s]=o.squaredDistances[s];return a.count=o.count,a}e.copy=i})(Ih||(Ih={}));function Be(){return Be.zero()}(function(e){function t(k){return k.extrema!==void 0}e.hasExtrema=t;function r(k,R){return{center:k,radius:R}}e.create=r;function n(){return{center:_(),radius:0}}e.zero=n;function i(k){var R=r(_.clone(k.center),k.radius);return t(k)&&(R.extrema=k.extrema.map(function(O){return _.clone(O)})),R}e.clone=i;function a(k,R,O){return _.copy(k.center,R),k.radius=O,k}e.set=a;function o(k,R){return _.copy(k.center,R.center),k.radius=R.radius,t(R)&&s(k,R.extrema.map(function(O){return _.clone(O)})),k}e.copy=o;function s(k,R){var O;return k.extrema!==void 0?(k.extrema.length=0,(O=k.extrema).push.apply(O,R)):k.extrema=R,k}e.setExtrema=s;function u(k){for(var R=k.x,O=k.y,H=k.z,B=k.indices,j=0,Y=0,G=0,$=0,q=Fe.size(B),ee=0;ee<q;ee++){var fe=Fe.getAt(B,ee);j+=R[fe],Y+=O[fe],G+=H[fe]}q>0&&(j/=q,Y/=q,G/=q);for(var ee=0;ee<q;ee++){var fe=Fe.getAt(B,ee),W=R[fe]-j,X=O[fe]-Y,U=H[fe]-G,z=W*W+X*X+U*U;z>$&&($=z)}return{center:_.create(j,Y,G),radius:Math.sqrt($)}}e.computeBounding=u;function l(k,R,O){return _.transformMat4(k.center,R.center,O),k.radius=R.radius*ue.getMaxScaleOnAxis(O),t(R)&&s(k,R.extrema.map(function(H){return _.transformMat4(_(),H,O)})),k}e.transform=l;function c(k,R,O){return _.add(k.center,R.center,O),t(R)&&s(k,R.extrema.map(function(H){return _.add(_(),H,O)})),k}e.translate=c;function d(k,R,O){_.toArray(k.center,R,O),R[O+3]=k.radius}e.toArray=d;function f(k,R,O){return _.fromArray(k.center,R,O),k.radius=R[O+3],k}e.fromArray=f;function h(k,R){return _.scale(k.center,_.add(k.center,R.max,R.min),.5),k.radius=_.distance(k.center,R.max),e.setExtrema(k,[_.create(R.min[0],R.min[1],R.min[2]),_.create(R.max[0],R.max[1],R.max[2]),_.create(R.max[0],R.min[1],R.min[2]),_.create(R.min[0],R.max[1],R.max[2]),_.create(R.min[0],R.min[1],R.max[2]),_.create(R.max[0],R.min[1],R.max[2]),_.create(R.max[0],R.max[1],R.min[2]),_.create(R.min[0],R.max[1],R.min[2])]),k}e.fromBox3D=h;function v(k,R){return _.copy(k.center,R.origin),k.radius=Math.max(_.magnitude(R.dirA),_.magnitude(R.dirB),_.magnitude(R.dirC)),k}e.fromAxes3D=v;var p=_();function m(k,R,O){var H=R[0],B=R[1],j=R[2],Y=_.create(0,0,0);_.transformMat4(Y,Y,O);var G=_.create(H,B,j);_.transformMat4(G,G,O);var $=_.create(H,0,0);_.transformMat4($,$,O);var q=_.create(0,B,j);_.transformMat4(q,q,O);var ee=_.create(0,0,j);_.transformMat4(ee,ee,O);var fe=_.create(H,0,j);_.transformMat4(fe,fe,O);var W=_.create(H,B,0);_.transformMat4(W,W,O);var X=_.create(0,B,0);_.transformMat4(X,X,O),_.add(p,Y,G),_.scale(p,p,.5);var U=Math.max(_.distance(Y,G),_.distance($,q));return e.set(k,p,U/2),e.setExtrema(k,[Y,G,$,q,ee,fe,W,X]),k}e.fromDimensionsAndTransform=m;var g=_();function y(k,R,O){var H=_.distance(R.center,O);return H<R.radius?e.copy(k,R):(_.sub(g,R.center,O),_.sub(g,R.center,g),_.setMagnitude(g,g,R.radius),_.scale(k.center,_.add(g,g,O),.5),k.radius=_.distance(k.center,O),k)}e.addVec3=y;function b(k,R,O){return _.copy(k.center,R.center),k.radius=Math.max(R.radius,_.distance(R.center,O.center)+O.radius),t(R)&&t(O)&&s(k,Nt(Nt([],R.extrema.map(function(H){return _.clone(H)})),O.extrema.map(function(H){return _.clone(H)}))),k}e.expandBySphere=b;var S=_();function x(k,R,O){var H,B;return _.copy(k.center,R.center),k.radius=R.radius+O,R.radius<1e-12||((B=(H=R.extrema)===null||H===void 0?void 0:H.length)!==null&&B!==void 0?B:0)<=1?(k.extrema=void 0,k):(t(R)&&s(k,R.extrema.map(function(j){_.sub(S,j,R.center);var Y=_.distance(R.center,j);return _.normalize(S,S),_.scaleAndAdd(_(),R.center,S,Y+O)})),k)}e.expand=x;function C(k,R){return k.radius===R.radius&&_.exactEquals(k.center,R.center)}e.exactEquals=C;function w(k,R){var O=k.radius,H=R.radius;return Math.abs(O-H)<=_n*Math.max(1,Math.abs(O),Math.abs(H))&&_.equals(k.center,R.center)}e.equals=w;function A(k,R){if(t(R)){for(var O=0,H=R.extrema;O<H.length;O++){var B=H[O];if(_.distance(k.center,B)>k.radius)return!1}return!0}else return _.distance(k.center,R.center)+R.radius<=k.radius}e.includes=A;function M(k,R){return _.distance(k.center,R.center)<=k.radius+R.radius}e.overlaps=M;function D(k,R){return _.distance(k.center,R.center)-k.radius+R.radius}e.distance=D})(Be||(Be={}));function Kt(){return Kt.zero()}(function(e){function t(y,b){return{min:y,max:b}}e.create=t;function r(){return{min:_(),max:_()}}e.zero=r;function n(y,b){return _.copy(y.min,b.min),_.copy(y.max,b.max),y}e.copy=n;function i(y){return n(r(),y)}e.clone=i;function a(y,b){if(Be.hasExtrema(b))return o(y,b.extrema);var S=_.create(b.radius,b.radius,b.radius);return _.sub(y.min,b.center,S),_.add(y.max,b.center,S),y}e.fromSphere3D=a;function o(y,b){e.setEmpty(y);for(var S=0,x=b.length;S<x;S++)e.add(y,b[S]);return y}e.fromVec3Array=o;function s(y){for(var b=_.create(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),S=_.create(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),x=y.x,C=y.y,w=y.z,A=y.indices,M=0,D=Fe.size(A);M<D;M++){var k=Fe.getAt(A,M);b[0]=Math.min(x[k],b[0]),b[1]=Math.min(C[k],b[1]),b[2]=Math.min(w[k],b[2]),S[0]=Math.max(x[k],S[0]),S[1]=Math.max(C[k],S[1]),S[2]=Math.max(w[k],S[2])}return{min:b,max:S}}e.computeBounding=s;function u(y,b){return _.sub(y,b.max,b.min)}e.size=u;var l=_();function c(y){return u(l,y),l[0]*l[1]*l[2]}e.volume=c;function d(y){return _.set(y.min,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),_.set(y.max,-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),y}e.setEmpty=d;function f(y,b){return _.min(y.min,y.min,b),_.max(y.max,y.max,b),y}e.add=f;function h(y,b,S){return _.sub(y.min,b.min,S),_.add(y.max,b.max,S),y}e.expand=h;function v(y,b,S){return _.scale(y.min,b.min,S),_.scale(y.max,b.max,S),y}e.scale=v;var p=_();function m(y,b,S){var x=b.min,C=x[0],w=x[1],A=x[2],M=b.max,D=M[0],k=M[1],R=M[2];return d(y),f(y,_.transformMat4(p,_.set(p,C,w,A),S)),f(y,_.transformMat4(p,_.set(p,C,w,R),S)),f(y,_.transformMat4(p,_.set(p,C,k,A),S)),f(y,_.transformMat4(p,_.set(p,C,k,R),S)),f(y,_.transformMat4(p,_.set(p,D,w,A),S)),f(y,_.transformMat4(p,_.set(p,D,w,R),S)),f(y,_.transformMat4(p,_.set(p,D,k,A),S)),f(y,_.transformMat4(p,_.set(p,D,k,R),S)),y}e.transform=m;function g(y,b){return!(b[0]<y.min[0]||b[0]>y.max[0]||b[1]<y.min[1]||b[1]>y.max[1]||b[2]<y.min[2]||b[2]>y.max[2])}e.containsVec3=g})(Kt||(Kt={}));function Dv(e,t,r){return new xFe(e,t,r)}var xFe=function(){function e(t,r,n){var i=CFe(t,r,n);this.ctx=_Fe(i),this.boundary={box:i.boundingBox,sphere:i.boundingSphere},this.buckets={offset:i.bucketOffset,count:i.bucketCounts,array:i.bucketArray},this.result=Ih.create()}return e.prototype.find=function(t,r,n,i,a){this.ctx.x=t,this.ctx.y=r,this.ctx.z=n,this.ctx.radius=i,this.ctx.isCheck=!1;var o=a??this.result;return YU(this.ctx,o),o},e.prototype.check=function(t,r,n,i){return this.ctx.x=t,this.ctx.y=r,this.ctx.z=n,this.ctx.radius=i,this.ctx.isCheck=!0,YU(this.ctx,this.result)},e}();function SFe(e){for(var t=e.expandedBox,r=e.size,n=r[0],i=r[1],a=r[2],o=e.data,s=o.x,u=o.y,l=o.z,c=o.radius,d=o.indices,f=e.elementCount,h=e.delta,v=n*i*a,p=t.min,m=p[0],g=p[1],y=p[2],b=0,S=0,x=new Uint32Array(v),C=new Int32Array(f),w=0;w<f;w++){var A=Fe.getAt(d,w),M=Math.floor((s[A]-m)/h[0]),D=Math.floor((u[A]-g)/h[1]),k=Math.floor((l[A]-y)/h[2]),R=(M*i+D)*a+k;(x[R]+=1)===1&&(S+=1),C[w]=R}if(c)for(var w=0;w<f;w++){var A=Fe.getAt(d,w);c[A]>b&&(b=c[A])}for(var O=new Int32Array(S),A=0,H=0;A<v;A++){var B=x[A];B>0&&(x[A]=H+1,O[H]=B,H+=1)}for(var j=new Uint32Array(S),A=1;A<S;++A)j[A]+=j[A-1]+O[A-1];for(var Y=new Int32Array(S),G=new Int32Array(f),A=0;A<f;A++){var $=x[C[A]];if($>0){var q=$-1;G[j[q]+Y[q]]=A,Y[q]+=1}}return{size:e.size,bucketArray:G,bucketCounts:O,bucketOffset:j,grid:x,delta:h,min:e.expandedBox.min,data:e.data,maxRadius:b,expandedBox:e.expandedBox,boundingBox:e.boundingBox,boundingSphere:e.boundingSphere}}function CFe(e,t,r){var n=Kt.expand(Kt(),t.box,_.create(.5,.5,.5)),i=e.indices,a=Kt.size(_.zero(),n),o,s,u=Fe.size(i),l=typeof r=="number"?r:32,c=Array.isArray(r)&&r;if(c)s=[Math.ceil(a[0]/c[0]),Math.ceil(a[1]/c[1]),Math.ceil(a[2]/c[2])],o=c;else if(u>0){var d=Math.ceil(u/l),f=Math.pow(d/(a[0]*a[1]*a[2]),1/3);s=[Math.ceil(a[0]*f),Math.ceil(a[1]*f),Math.ceil(a[2]*f)],o=[a[0]/s[0],a[1]/s[1],a[2]/s[2]]}else o=a,s=[1,1,1];var h={x:e.x,y:e.y,z:e.z,indices:i,radius:e.radius},v={size:s,data:h,expandedBox:n,boundingBox:t.box,boundingSphere:t.sphere,elementCount:u,delta:o};return SFe(v)}function _Fe(e){return{grid:e,x:.1,y:.1,z:.1,radius:.1,isCheck:!1}}function YU(e,t){var r=e.grid,n=r.min,i=r.size,a=i[0],o=i[1],s=i[2],u=r.bucketOffset,l=r.bucketCounts,c=r.bucketArray,d=r.grid,f=r.data,h=f.x,v=f.y,p=f.z,m=f.indices,g=f.radius,y=r.delta,b=r.maxRadius,S=e.radius,x=e.isCheck,C=e.x,w=e.y,A=e.z,M=S+b,D=M*M;Ih.reset(t);var k=Math.max(0,Math.floor((C-M-n[0])/y[0])),R=Math.max(0,Math.floor((w-M-n[1])/y[1])),O=Math.max(0,Math.floor((A-M-n[2])/y[2])),H=Math.min(a-1,Math.floor((C+M-n[0])/y[0])),B=Math.min(o-1,Math.floor((w+M-n[1])/y[1])),j=Math.min(s-1,Math.floor((A+M-n[2])/y[2]));if(k>H||R>B||O>j)return!1;for(var Y=k;Y<=H;Y++)for(var G=R;G<=B;G++)for(var $=O;$<=j;$++){var q=d[(Y*o+G)*s+$];if(q!==0)for(var ee=q-1,fe=u[ee],W=l[ee],X=fe+W,U=fe;U<X;U++){var z=Fe.getAt(m,c[U]),J=h[z]-C,K=v[z]-w,Z=p[z]-A,te=J*J+K*K+Z*Z;if(te<=D){if(b>0&&Math.sqrt(te)-g[z]>S)continue;if(x)return!0;Ih.add(t,c[U],te)}}}return t.count>0}function Iu(){return Iu.empty()}(function(e){function t(d,f,h,v){return{origin:d,dirA:f,dirB:h,dirC:v}}e.create=t;function r(){return{origin:_(),dirA:_(),dirB:_(),dirC:_()}}e.empty=r;function n(d,f){return _.copy(d.origin,f.origin),_.copy(d.dirA,f.dirA),_.copy(d.dirB,f.dirB),_.copy(d.dirC,f.dirC),d}e.copy=n;function i(d){return n(r(),d)}e.clone=i;function a(d,f){return _.set(d,_.magnitude(f.dirA)*2,_.magnitude(f.dirB)*2,_.magnitude(f.dirC)*2)}e.size=a;var o=_();function s(d){return a(o,d),o[0]*o[1]*o[2]}e.volume=s;function u(d,f){return _.copy(d.origin,f.origin),_.normalize(d.dirA,f.dirA),_.normalize(d.dirB,f.dirB),_.normalize(d.dirC,f.dirC),d}e.normalize=u;var l=Yn.zero();function c(d,f,h){_.transformMat4(d.origin,f.origin,h);var v=Yn.directionTransform(l,h);return _.transformMat3(d.dirA,f.dirA,v),_.transformMat3(d.dirB,f.dirB,v),_.transformMat3(d.dirC,f.dirC,v),d}e.transform=c})(Iu||(Iu={}));function Qr(e){return function(t){return eF(e,t)}}function eF(e,t){var r=e.data,n=e.indices,i=e.count,a=t.valueType,o=a==="str"?function(s){return r.substring(n[2*s],n[2*s+1])}:a==="int"?function(s){return vh(r,n[2*s],n[2*s+1])||0}:function(s){return Yc(r,n[2*s],n[2*s+1])||0};return{schema:t,__array:void 0,isDefined:!0,rowCount:i,value:o,valueKind:function(s){return 0},toArray:function(s){return ua(i,o,s)},areValuesEqual:UJ(e)}}function UJ(e){var t=e.data,r=e.indices;return function(n,i){var a=r[2*n],o=r[2*i],s=r[2*n+1]-a;if(s!==r[2*i+1]-o)return!1;for(var u=0;u<s;u++)if(t.charCodeAt(u+a)!==t.charCodeAt(u+o))return!1;return!0}}function jJ(e,t){return{name:t,blocks:e}}function tF(e,t,r,n){return n===void 0&&(n=[]),{categoryNames:e,header:r,categories:t,saveFrames:n,getField:function(i){var a=i.split("."),o=a[0],s=a[1];return t[o].getField(s||"")}}}function wFe(e,t,r){return{categoryNames:e,header:r,categories:t}}function ba(e,t,r,n){return{rowCount:t,name:e,fieldNames:Nt([],r),getField:function(i){return n[i]}}}(function(e){function t(i){return{rowCount:0,name:i,fieldNames:[],getField:function(a){}}}e.empty=t;function r(i,a){var o=Object.keys(a);return{rowCount:o.length>0?a[o[0]].rowCount:0,name:i,fieldNames:o,getField:function(s){return a[s]}}}e.ofFields=r;function n(i,a){for(var o={},s=0,u=a._columns;s<u.length;s++){var l=u[s];o[l]=St.ofColumn(a[l])}return r(i,o)}e.ofTable=n})(ba||(ba={}));var St;(function(e){function t(s){return r([s])}e.ofString=t;function r(s){var u=s.length,l=function(h){var v=s[h];return!v||v==="."||v==="?"?"":v},c=function(h){var v=s[h];return vh(v,0,v.length)||0},d=function(h){var v=s[h];return Yc(v,0,v.length)||0},f=function(h){var v=s[h],p=v.length;if(p>1)return 0;if(p===0)return 1;var m=v.charCodeAt(0);return m===46?1:m===63?2:0};return{__array:void 0,binaryEncoding:void 0,isDefined:!0,rowCount:u,str:l,int:c,float:d,valueKind:f,areValuesEqual:function(h,v){return s[h]===s[v]},toStringArray:function(h){return h?ua(u,l,h):s},toIntArray:function(h){return ua(u,c,h)},toFloatArray:function(h){return ua(u,d,h)}}}e.ofStrings=r;function n(s){var u=s.length,l=function(h){return""+s[h]},c=function(h){return s[h]},d=function(h){return 0},f=function(h){return!h||h.array&&s instanceof h.array?s:ua(u,c,h)};return{__array:void 0,binaryEncoding:void 0,isDefined:!0,rowCount:u,str:l,int:c,float:c,valueKind:d,areValuesEqual:function(h,v){return s[h]===s[v]},toStringArray:function(h){return ua(u,l,h)},toIntArray:f,toFloatArray:f}}e.ofNumbers=n;function i(s){var u=s.data,l=s.indices,c=s.count,d=function(p){var m=u.substring(l[2*p],l[2*p+1]);return m==="."||m==="?"?"":m},f=function(p){return vh(u,l[2*p],l[2*p+1])||0},h=function(p){return Yc(u,l[2*p],l[2*p+1])||0},v=function(p){var m=l[2*p],g=l[2*p+1]-m;if(g>1)return 0;if(g===0)return 1;var y=u.charCodeAt(m);return y===46?1:y===63?2:0};return{__array:void 0,binaryEncoding:void 0,isDefined:!0,rowCount:c,str:d,int:f,float:h,valueKind:v,areValuesEqual:UJ(s),toStringArray:function(p){return ua(c,d,p)},toIntArray:function(p){return ua(c,f,p)},toFloatArray:function(p){return ua(c,h,p)}}}e.ofTokens=i;function a(s){var u=s.rowCount,l=s.valueKind,c=s.areValuesEqual,d=s.isDefined,f,h,v;switch(s.schema.valueType){case"float":case"int":f=function(m){return""+s.value(m)},h=s.value,v=s.value;break;case"str":f=s.value,h=function(m){var g=s.value(m);return vh(g,0,g.length)||0},v=function(m){var g=s.value(m);return Yc(g,0,g.length)||0};break;case"list":var p=s.schema.separator;f=function(m){return s.value(m).join(p)},h=function(m){return NaN},v=function(m){return NaN};break;default:throw new Error("unsupported valueType '"+s.schema.valueType+"'")}return{__array:void 0,binaryEncoding:void 0,isDefined:d,rowCount:u,str:f,int:h,float:v,valueKind:l,areValuesEqual:c,toStringArray:function(m){return ua(u,f,m)},toIntArray:function(m){return ua(u,h,m)},toFloatArray:function(m){return ua(u,v,m)}}}e.ofColumn=a;function o(s,u){return a(ve.Undefined(s,u))}e.ofUndefined=o})(St||(St={}));function EFe(e,t,r,n){var i=r?0:1;switch(t){case 1:return n==="brackets"?function(a){return e+"["+(a+i)+"]"}:function(a){return e+"_"+(a+i)};case 2:return n==="brackets"?function(a,o){return e+"["+(a+i)+"]["+(o+i)+"]"}:function(a,o){return e+"_"+(a+i)+(o+i)};case 3:return n==="brackets"?function(a,o,s){return e+"["+(a+i)+"]["+(o+i)+"]["+(s+i)+"]"}:function(a,o,s){return e+"_"+(a+i)+(o+i)+(s+i)};default:throw new Error("Tensors with rank > 3 or rank 0 are currently not supported.")}}function AFe(e,t,r,n){var i=t.create();if(t.rank===1)for(var a=t.dimensions[0],o=0;o<a;o++){var s=e.getField(n(o));t.set(i,o,s?s.float(r):0)}else if(t.rank===2)for(var a=t.dimensions[0],u=t.dimensions[1],o=0;o<a;o++)for(var l=0;l<u;l++){var s=e.getField(n(o,l));t.set(i,o,l,s?s.float(r):0)}else if(t.rank===3)for(var c=t.dimensions[0],d=t.dimensions[1],f=t.dimensions[2],o=0;o<c;o++)for(var l=0;l<d;l++)for(var h=0;h<f;h++){var s=e.getField(n(o,l,h));t.set(i,o,l,h,s?s.float(r):0)}else throw new Error("Tensors with rank > 3 or rank 0 are currently not supported.");return i}function It(e){return{data:e,position:0,length:e.length,lineNumber:1,tokenStart:0,tokenEnd:0}}(function(e){function t(y){return y.data.substring(y.tokenStart,y.tokenEnd)}e.getTokenString=t;function r(y){y.position=0,y.lineNumber=1,y.tokenStart=0,y.tokenEnd=0}e.reset=r;function n(y){for(var b=y.data;y.position<y.length;)switch(b.charCodeAt(y.position)){case 10:return y.tokenEnd=y.position,++y.position,++y.lineNumber,!0;case 13:return y.tokenEnd=y.position,++y.position,++y.lineNumber,b.charCodeAt(y.position)===10&&++y.position,!0;default:++y.position;break}return y.tokenEnd=y.position,y.tokenStart!==y.tokenEnd}e.eatLine=n;function i(y){y.tokenStart=y.position}e.markStart=i;function a(y){return y.tokenStart=y.position,n(y)}e.markLine=a;function o(y){return a(y),t(y)}e.readLine=o;function s(y){a(y);var b=y.position;return g(y,y.tokenStart,y.tokenEnd),y.position=b,t(y)}e.readLineTrim=s;function u(y,b,S){for(var x=0,C=0;C<b;C++){if(!a(y))return x;ht.addUnchecked(S,y.tokenStart,y.tokenEnd),x++}return x}function l(y,b){var S=ht.create(y.data,b*2);return u(y,b,S),S}e.markLines=l;function c(y,b){for(var S=[],x=0;x<b;x++)S.push(e.readLine(y));return S}e.readLines=c;function d(y,b,S,x){return x===void 0&&(x=1e5),ce(this,void 0,void 0,function(){var C,w,A;return de(this,function(M){switch(M.label){case 0:return C=y.length,w=ht.create(y.data,b*2),A=0,[4,fd(S,x,y,function(D,k){var R=Math.min(b-A,D);return u(k,R,w),A+=R,R},function(D,k){return D.update({message:"Parsing...",current:k.position,max:C})})];case 1:return M.sent(),[2,w]}})})}e.readLinesAsync=d;function f(y){for(var b=e(y),S=ht.create(b.data,Math.max(y.length/80,2));a(b);)ht.add(S,b.tokenStart,b.tokenEnd);return S}e.readAllLines=f;function h(y,b,S){for(var x=0,C=0;C<b;C++){if(!a(y))return x;ht.add(S,y.tokenStart,y.tokenEnd),x++}return x}function v(y,b,S){return S===void 0&&(S=1e5),ce(this,void 0,void 0,function(){var x,C;return de(this,function(w){switch(w.label){case 0:return x=e(y),C=ht.create(x.data,Math.max(y.length/80,2)),[4,fd(b,S,x,function(A,M){return h(M,A,C),M.position<M.length?A:0},function(A,M){return A.update({message:"Parsing...",current:M.position,max:length})})];case 1:return w.sent(),[2,C]}})})}e.readAllLinesAsync=v;function p(y){for(;y.position<y.length;)switch(y.data.charCodeAt(y.position)){case 9:case 10:case 13:case 32:y.tokenEnd=y.position;return;default:++y.position;break}y.tokenEnd=y.position}e.eatValue=p;function m(y){for(var b=-1;y.position<y.length;){var S=y.data.charCodeAt(y.position);switch(S){case 9:case 32:b=S,++y.position;break;case 10:b!==13&&++y.lineNumber,b=S,++y.position;break;case 13:b=S,++y.position,++y.lineNumber;break;default:return b}}return b}e.skipWhitespace=m;function g(y,b,S){for(var x=y.data,C=b,w=S-1,A=x.charCodeAt(C);(A===9||A===32)&&C<=w;)A=x.charCodeAt(++C);for(A=x.charCodeAt(w);(A===9||A===32)&&w>=C;)A=x.charCodeAt(--w);return y.tokenStart=C,y.tokenEnd=w+1,y.position=S,y}e.trim=g})(It||(It={}));function PFe(e,t,r){for(var n=t,i=r-1,a=e.charCodeAt(n);(a===9||a===32)&&n<=i;)a=e.charCodeAt(++n);for(a=e.charCodeAt(i);(a===9||a===32)&&i>=n;)a=e.charCodeAt(--i);return e.substring(n,i+1)}var ht;(function(e){function t(o){var s=new Uint32Array(1.61*o.indices.length|0);s.set(o.indices),o.indices=s,o.indicesLenMinus2=s.length-2|0}function r(o,s,u){var l=o;l.offset>l.indicesLenMinus2&&t(l),l.indices[l.offset++]=s,l.indices[l.offset++]=u,o.count++}e.add=r;function n(o,s){r(o,s.tokenStart,s.tokenEnd)}e.addToken=n;function i(o,s,u){o.indices[o.offset++]=s,o.indices[o.offset++]=u,o.count++}e.addUnchecked=i;function a(o,s){return s=Math.max(10,s),{data:o,indicesLenMinus2:s-2|0,count:0,offset:0,indices:new Uint32Array(s)}}e.create=a})(ht||(ht={}));var Rn;(function(e){function t(a,o){return o===void 0&&(o=-1),new n(a,o)}e.error=t;function r(a,o){return o===void 0&&(o=[]),new i(a,o)}e.success=r;var n=function(){function a(o,s){this.message=o,this.line=s,this.isError=!0}return a.prototype.toString=function(){return this.line>=0?"[Line "+this.line+"] "+this.message:this.message},a}();e.Error=n;var i=function(){function a(o,s){this.result=o,this.warnings=s,this.isError=!1}return a}();e.Success=i})(Rn||(Rn={}));function KU(e){for(;e.position<e.length;)switch(e.data.charCodeAt(e.position)){case 9:case 10:case 13:case 32:e.tokenEnd=e.position;return;default:++e.position;break}e.tokenEnd=e.position}function TFe(e,t){var r,n;for(++e.position;e.position<e.length;)if(n=e.data.charCodeAt(e.position),n===t)switch(r=e.data.charCodeAt(e.position+1),r){case 9:case 10:case 13:case 32:e.tokenStart++,e.tokenEnd=e.position,e.isEscaped=!0,++e.position;return;default:if(r===void 0){e.tokenStart++,e.tokenEnd=e.position,e.isEscaped=!0,++e.position;return}++e.position;break}else{if(n===10||n===13){e.tokenEnd=e.position;return}++e.position}e.tokenEnd=e.position}function IFe(e){for(e.position+=3;e.position<e.length;){if(e.data.charCodeAt(e.position)===39&&zJ(e)){e.tokenStart+=3,e.tokenEnd=e.position,e.isEscaped=!0,e.position+=3;return}++e.position}e.tokenEnd=e.position}function MFe(e){for(var t=59,r=e.position+1,n;r<e.length;)if(n=e.data.charCodeAt(r),n===59&&(t===10||t===13)){for(e.position=r+1,e.tokenStart++,r--,n=e.data.charCodeAt(r);n===10||n===13;)r--,n=e.data.charCodeAt(r);e.tokenEnd=r+1,e.isEscaped=!0;return}else(n===13||n===10&&t!==13)&&e.lineNumber++,t=n,++r;return e.position=r,t}function DFe(e){for(;e.position<e.length;)switch(e.data.charCodeAt(e.position)){case 93:++e.position,e.tokenEnd=e.position,e.isImportGet=!1;return;default:++e.position;break}}function RFe(e){for(;e.position<e.length;){var t=e.data.charCodeAt(e.position);if(t===10||t===13)return;++e.position}}function kFe(e){for(var t=10;e.position<e.length;){var r=e.data.charCodeAt(e.position);switch(r){case 9:case 32:t=r,++e.position;break;case 10:t!==13&&++e.lineNumber,t=r,++e.position;break;case 13:t=r,++e.position,++e.lineNumber;break;default:return t}}return t}function zJ(e){return!(e.length-e.position<2||e.data.charCodeAt(e.position+1)!==39||e.data.charCodeAt(e.position+2)!==39)}function OFe(e){var t=e.data.charCodeAt(e.tokenStart);return!(t!==68&&t!==100||(t=e.data.charCodeAt(e.tokenStart+1),t!==65&&t!==97)||(t=e.data.charCodeAt(e.tokenStart+2),t!==84&&t!==116)||(t=e.data.charCodeAt(e.tokenStart+3),t!==65&&t!==97))}function FFe(e){var t=e.data.charCodeAt(e.tokenStart);return!(t!==83&&t!==115||(t=e.data.charCodeAt(e.tokenStart+1),t!==65&&t!==97)||(t=e.data.charCodeAt(e.tokenStart+2),t!==86&&t!==118)||(t=e.data.charCodeAt(e.tokenStart+3),t!==69&&t!==101))}function LFe(e){if(e.tokenEnd-e.tokenStart!==5)return!1;var t=e.data.charCodeAt(e.tokenStart);return!(t!==76&&t!==108||(t=e.data.charCodeAt(e.tokenStart+1),t!==79&&t!==111)||(t=e.data.charCodeAt(e.tokenStart+2),t!==79&&t!==111)||(t=e.data.charCodeAt(e.tokenStart+3),t!==80&&t!==112))}function NFe(e){return!(e.tokenEnd-e.tokenStart!==11||e.data.charCodeAt(e.tokenStart+1)!==105||e.data.charCodeAt(e.tokenStart+2)!==109||e.data.charCodeAt(e.tokenStart+3)!==112||e.data.charCodeAt(e.tokenStart+4)!==111||e.data.charCodeAt(e.tokenStart+5)!==114||e.data.charCodeAt(e.tokenStart+6)!==116||e.data.charCodeAt(e.tokenStart+7)!==46||e.data.charCodeAt(e.tokenStart+8)!==103||e.data.charCodeAt(e.tokenStart+9)!==101||e.data.charCodeAt(e.tokenStart+10)!==116)}function BFe(e,t,r){var n,i=r-t,a=e.tokenStart-t,o=e.tokenEnd-e.tokenStart;if(o<i)return!1;for(n=t;n<r;++n)if(e.data.charCodeAt(n)!==e.data.charCodeAt(n+a))return!1;return i===o||e.data.charCodeAt(n+a)===46}function VJ(e){var t;for(t=e.tokenStart;t<e.tokenEnd;++t)if(e.data.charCodeAt(t)===46)return t;return t}function HJ(e,t){return e.data.substring(e.tokenStart,t)}function UFe(e){var t;for(t=e.tokenStart;t<e.tokenEnd;++t)if(e.data.charCodeAt(t)===46)return!1;return!0}function PD(e){return e.data.substring(e.tokenStart,e.tokenEnd)}function QU(e){var t=kFe(e);if(e.position>=e.length){e.tokenType=6;return}e.tokenStart=e.position,e.tokenEnd=e.position,e.isEscaped=!1;var r=e.data.charCodeAt(e.position);switch(r){case 35:RFe(e),e.tokenType=5;break;case 39:if(zJ(e)){IFe(e),e.tokenType=3;break}case 34:TFe(e,r),e.tokenType=3;break;case 59:t===10||t===13?MFe(e):KU(e),e.tokenType=3;break;default:e.isImportGet?DFe(e):KU(e),e.isEscaped?e.tokenType=3:e.data.charCodeAt(e.tokenStart)===95?(e.inSaveFrame&&NFe(e)&&(e.isImportGet=!0),e.tokenType=4):e.tokenEnd-e.tokenStart>=5&&e.data.charCodeAt(e.tokenStart+4)===95?OFe(e)?e.tokenType=0:FFe(e)?e.tokenType=1:LFe(e)?e.tokenType=2:e.tokenType=3:e.tokenType=3;break}}function gh(e){for(QU(e);e.tokenType===5;)QU(e)}function jFe(e,t){return{data:e,length:e.length,position:0,tokenStart:0,tokenEnd:0,tokenType:6,lineNumber:1,isEscaped:!1,isImportGet:!1,inSaveFrame:!1,runtimeCtx:t}}function Hx(){return{categoryNames:[],categoryData:Object.create(null)}}function rF(e,t){for(var r=Object.create(null),n=0,i=e;n<i.length;n++){var a=i[n],o=t[a];r[a]=ba(o.name,o.rowCount,o.fieldNames,o.fields)}return r}function ZU(e,t,r){return tF(e.categoryNames,rF(e.categoryNames,e.categoryData),t,r)}function zFe(e,t){return tF(e.categoryNames,rF(e.categoryNames,e.categoryData),t)}function TD(e,t,r,n,i){var a;if(t in e.categoryData){var o=e.categoryData[t];(a=o.fieldNames).push.apply(a,n),Object.assign(o.fields,i)}else e.categoryData[t]={name:t,rowCount:r,fieldNames:n,fields:i},e.categoryNames.push(t)}function VFe(e,t){for(var r=e.tokenStart,n=VJ(e),i=HJ(e,n),a=Object.create(null),o=[],s=!0;s;){if(e.tokenType!==4||!BFe(e,r,n)){s=!1;break}var u=PD(e).substring(i.length+1);if(gh(e),e.tokenType!==3)return{hasError:!0,errorLine:e.lineNumber,errorMessage:"Expected value."};a[u]=St.ofTokens({data:e.data,indices:[e.tokenStart,e.tokenEnd],count:1}),o[o.length]=u,gh(e)}return TD(t,i.substr(1),1,o,a),{hasError:!1,errorLine:0,errorMessage:""}}function HFe(e,t){for(var r=t.tokenizer,n=t.tokens,i=t.fieldCount,a=t.tokenCount,o=0;r.tokenType===3&&o<e;)ht.add(n[a++%i],r.tokenStart,r.tokenEnd),gh(r),o++;return t.tokenCount=a,o}function GFe(e,t){return e.update({message:"Parsing...",current:t.tokenizer.position,max:t.tokenizer.data.length})}function qFe(e,t){return ce(this,void 0,void 0,function(){var r,n,i,a,o,s,u,f,l,c,f,d,d,f;return de(this,function(h){switch(h.label){case 0:for(r=e.lineNumber,gh(e),n=HJ(e,VJ(e)),i=UFe(e),a=[];e.tokenType===4;)a[a.length]=i?PD(e):PD(e).substring(n.length+1),gh(e);for(o=n==="_atom_site"?e.data.length/100|0:32,s=[],u=a.length,f=0;f<u;f++)s[f]=ht.create(e.data,o);return l={fieldCount:u,tokenCount:0,tokenizer:e,tokens:s},[4,fd(e.runtimeCtx,1e6,l,HFe,GFe)];case 1:if(h.sent(),l.tokenCount%u!==0)return[2,{hasError:!0,errorLine:e.lineNumber,errorMessage:"The number of values for loop starting at line "+r+" is not a multiple of the number of columns."}];if(c=l.tokenCount/u|0,i)for(f=0;f<u;f++)d={"":St.ofTokens(s[f])},TD(t,a[f].substr(1),c,[""],d);else{for(d=Object.create(null),f=0;f<u;f++)d[a[f]]=St.ofTokens(s[f]);TD(t,n.substr(1),c,a,d)}return[2,{hasError:!1,errorLine:0,errorMessage:""}]}})})}function Tm(e,t){return Rn.error(t,e)}function $Fe(e){return Rn.success(e)}function WFe(e,t){return ce(this,void 0,void 0,function(){var r,n,i,a,o,s,u,l,c,d,d;return de(this,function(f){switch(f.label){case 0:r=[],n=jFe(e,t),i="",a=Hx(),o=[],s=Hx(),u=wFe(s.categoryNames,rF(s.categoryNames,s.categoryData),""),l="",t.update({message:"Parsing...",current:0,max:e.length}),gh(n),f.label=1;case 1:return n.tokenType===6?[3,7]:(c=n.tokenType,c!==0?[3,2]:n.inSaveFrame?[2,Tm(n.lineNumber,"Unexpected data block inside a save frame.")]:(a.categoryNames.length>0&&r.push(ZU(a,i,o)),i=e.substring(n.tokenStart+5,n.tokenEnd),a=Hx(),o=[],gh(n),[3,6]));case 2:if(c!==1)return[3,3];if(n.tokenEnd-n.tokenStart===5)s.categoryNames.length>0&&(o[o.length]=zFe(s,l)),n.inSaveFrame=!1;else{if(n.inSaveFrame)return[2,Tm(n.lineNumber,"Save frames cannot be nested.")];n.inSaveFrame=!0,l=e.substring(n.tokenStart+5,n.tokenEnd),s=Hx()}return gh(n),[3,6];case 3:return c!==2?[3,5]:[4,qFe(n,n.inSaveFrame?s:a)];case 4:return d=f.sent(),d.hasError?[2,Tm(d.errorLine,d.errorMessage)]:[3,6];case 5:if(c===4){if(d=VFe(n,n.inSaveFrame?s:a),d.hasError)return[2,Tm(d.errorLine,d.errorMessage)]}else return console.log(n.tokenType,It.getTokenString(n)),[2,Tm(n.lineNumber,"Unexpected token. Expected data_, loop_, or data name.")];f.label=6;case 6:return[3,1];case 7:return n.inSaveFrame?[2,Tm(n.lineNumber,"Unfinished save frame ("+u.header+").")]:((a.categoryNames.length>0||o.length>0)&&r.push(ZU(a,i,o)),[2,$Fe(jJ(r))])}})})}function JU(e){var t=this;return $e.create("Parse CIF",function(r){return ce(t,void 0,void 0,function(){return de(this,function(n){switch(n.label){case 0:return[4,WFe(e,r)];case 1:return[2,n.sent()]}})})})}var XFe=new Uint16Array(new Uint8Array([18,52]).buffer)[0]===13330;function YFe(e,t){for(var r=new ArrayBuffer(e.length),n=new Uint8Array(r),i=0,a=e.length;i<a;i+=t)for(var o=0;o<t;o++)n[i+t-o-1]=e[i+o];return r}var XP=28672;function KFe(e){if(e.length>XP){for(var t=[],r=0;r<e.length;r+=XP)t.push(String.fromCharCode.apply(null,e.subarray(r,r+XP)));return t.join("")}else return String.fromCharCode.apply(null,e)}function fw(e){for(var t=e.data,r=e.encoding.length-1;r>=0;r--)t=QFe(t,e.encoding[r]);return t}function QFe(e,t){switch(t.kind){case"ByteArray":switch(t.type){case 4:return e;case 1:return ZFe(e);case 2:return JFe(e);case 5:return eLe(e);case 3:return tLe(e);case 6:return rLe(e);case 32:return nLe(e);case 33:return iLe(e);default:throw new Error("Unsupported ByteArray type.")}case"FixedPoint":return aLe(e,t);case"IntervalQuantization":return oLe(e,t);case"RunLength":return sLe(e,t);case"Delta":return uLe(e,t);case"IntegerPacking":return dLe(e,t);case"StringArray":return fLe(e,t)}}function GJ(e,t){switch(e){case 1:return new Int8Array(t);case 2:return new Int16Array(t);case 3:return new Int32Array(t);case 4:return new Uint8Array(t);case 5:return new Uint16Array(t);case 6:return new Uint32Array(t);default:throw new Error("Unsupported integer data type.")}}function qJ(e,t){switch(e){case 32:return new Float32Array(t);case 33:return new Float64Array(t);default:throw new Error("Unsupported floating data type.")}}function ZFe(e){return new Int8Array(e.buffer,e.byteOffset)}function G0(e,t,r){return XFe?new r(e.buffer):new r(YFe(e,t))}function JFe(e){return G0(e,2,Int16Array)}function eLe(e){return G0(e,2,Uint16Array)}function tLe(e){return G0(e,4,Int32Array)}function rLe(e){return G0(e,4,Uint32Array)}function nLe(e){return G0(e,4,Float32Array)}function iLe(e){return G0(e,8,Float64Array)}function aLe(e,t){for(var r=e.length,n=qJ(t.srcType,r),i=1/t.factor,a=0;a<r;a++)n[a]=i*e[a];return n}function oLe(e,t){for(var r=e.length,n=qJ(t.srcType,r),i=(t.max-t.min)/(t.numSteps-1),a=t.min,o=0;o<r;o++)n[o]=a+i*e[o];return n}function sLe(e,t){for(var r=GJ(t.srcType,t.srcSize),n=0,i=0,a=e.length;i<a;i+=2)for(var o=e[i],s=e[i+1],u=0;u<s;++u)r[n++]=o;return r}function uLe(e,t){var r=e.length,n=GJ(t.srcType,r);if(!r)return e;n[0]=e[0]+(t.origin|0);for(var i=1;i<r;++i)n[i]=e[i]+n[i-1];return n}function lLe(e,t){for(var r=t.byteCount===1?127:32767,n=-r-1,i=e.length,a=new Int32Array(t.srcSize),o=0,s=0;o<i;){for(var u=0,l=e[o];l===r||l===n;)u+=l,o++,l=e[o];u+=l,a[s]=u,o++,s++}return a}function cLe(e,t){for(var r=t.byteCount===1?255:65535,n=e.length,i=new Int32Array(t.srcSize),a=0,o=0;a<n;){for(var s=0,u=e[a];u===r;)s+=u,a++,u=e[a];s+=u,i[o]=s,a++,o++}return i}function dLe(e,t){return e.length===t.srcSize?e:t.isUnsigned?cLe(e,t):lLe(e,t)}function fLe(e,t){var r=fw({encoding:t.offsetEncoding,data:t.offsets}),n=fw({encoding:t.dataEncoding,data:e}),i=t.stringData,a=new Array(r.length);a[0]="";for(var o=1,s=r.length;o<s;o++)a[o]=i.substring(r[o-1],r[o]);for(var u=0,l=new Array(n.length),o=0,s=n.length;o<s;o++)l[u++]=a[n[o]+1];return l}var hLe="0.3.0",Af;(function(e){function t(n){var i;return n instanceof Int8Array?i=1:n instanceof Int16Array?i=2:n instanceof Int32Array?i=3:n instanceof Uint8Array?i=4:n instanceof Uint16Array?i=5:n instanceof Uint32Array?i=6:n instanceof Float32Array?i=32:n instanceof Float64Array?i=33:i=3,i}e.getDataType=t;function r(n){if(n instanceof Int8Array||n instanceof Int16Array||n instanceof Int32Array)return!0;for(var i=0,a=n.length;i<a;i++)if(i<0)return!1;return!0}e.isSignedIntegerDataType=r})(Af||(Af={}));function pLe(e,t,r){var n=1,i;for(i=0;i<t;i++){var a=n*e;if(Math.abs(Math.round(a)-a)<=r)return i;n*=10}return-1}function vLe(e,t){var r=Math.abs(e);return r<t?0:Math.floor(Math.log10(Math.abs(e)))+1}function mLe(e,t,r){for(var n=1,i=0,a=0,o=e.length;a<o;a++){if(n>=0){var s=pLe(e[a],t,r);s<0?n=-1:s>n&&(n=s)}var u=Math.abs(e[a]);if(u>r){var l=Math.floor(Math.log10(Math.abs(u)))+1;l>i&&(i=l)}}return{mantissaDigits:n,integerDigits:i}}function gLe(e){e=e.trim();var t=parseInt(e,10);return isNaN(t)?!1:t.toString()===e}function hw(e){if(!isFinite(e))return 0;for(var t=1,r=0;Math.round(e*t)/t!==e;)t*=10,++r;return r}function ID(e,t){return parseFloat(e.toPrecision(t))}function MD(e){return $b.classify(e)}function yLe(e){return DD.classify(e)}var $b;(function(e){function t(h,v){return h>=0?Math.ceil((h+1)/v):Math.ceil((h+1)/(-v-1))}function r(h){for(var v=!1,p=0,m=h.length;p<m;p++)if(h[p]<0){v=!0;break}return v?{signed:v,limit8:127,limit16:32767}:{signed:v,limit8:255,limit16:65535}}function n(){return{pack8:0,pack16:0,count:0}}function i(h,v,p){var m=h.limit8,g=h.limit16;v.pack8+=t(p,m),v.pack16+=t(p,g),v.count+=1}function a(h,v){h.pack8+=t(v,127),h.pack16+=t(v,32767),h.count+=1}function o(h){return h.count*4<h.pack16*2?{length:h.count*4,elem:4}:h.pack16*2<h.pack8?{length:h.pack16*2,elem:2}:{length:h.pack8,elem:1}}function s(h,v){for(var p=n(),m=0,g=h.length;m<g;m++)i(v,p,h[m]);return E(E({},o(p)),{kind:"pack"})}function u(h,v){for(var p=n(),m=h[0],g=1,y=h.length;g<y;g++)a(p,h[g]-m),m=h[g];return E(E({},o(p)),{kind:"delta"})}function l(h,v){for(var p=n(),m=1,g=1,y=h.length;g<y;g++)h[g-1]!==h[g]?(i(v,p,h[g-1]),i(v,p,m),m=1):m++;return i(v,p,h[h.length-1]),i(v,p,m),E(E({},o(p)),{kind:"rle"})}function c(h,v){for(var p=n(),m=1,g=0,y=0,b=1,S=h.length;b<S;b++){var x=h[b]-g;y!==x?(a(p,y),a(p,m),m=1):m++,y=x,g=h[b]}return a(p,y),a(p,m),E(E({},o(p)),{kind:"delta-rle"})}function d(h){var v=r(h),p=[s(h,v),l(h,v),u(h),c(h)];return p.sort(function(m,g){return m.length-g.length}),p}e.getSize=d;function f(h){if(h.length<2)return Cr.by(Cr.byteArray);var v=d(h),p=v[0];switch(p.kind){case"pack":return Cr.by(Cr.integerPacking);case"rle":return Cr.by(Cr.runLength).and(Cr.integerPacking);case"delta":return Cr.by(Cr.delta).and(Cr.integerPacking);case"delta-rle":return Cr.by(Cr.delta).and(Cr.runLength).and(Cr.integerPacking)}throw new Error("should not happen :)")}e.classify=f})($b||($b={}));var DD;(function(e){var t=1e-6;function r(i){var a=4,o=mLe(i,a,t),s=o.mantissaDigits,u=o.integerDigits;if(s<0||s+u>10)return Cr.by(Cr.byteArray);if(s===0)return $b.classify(i);for(var l=n(s),c=new Int32Array(i.length),d=0,f=i.length;d<f;d++)c[d]=Math.round(l*i[d]);var h=$b.getSize(c),v=h[0],p=Cr.by(Cr.fixedPoint(l));switch(v.kind){case"pack":return p.and(Cr.integerPacking);case"rle":return p.and(Cr.runLength).and(Cr.integerPacking);case"delta":return p.and(Cr.delta).and(Cr.integerPacking);case"delta-rle":return p.and(Cr.delta).and(Cr.runLength).and(Cr.integerPacking)}throw new Error("should not happen :)")}e.classify=r;function n(i){for(var a=1,o=0;o<i;o++)a*=10;return a}})(DD||(DD={}));var $J=function(){function e(t){this.providers=t}return e.prototype.and=function(t){return new e(this.providers.concat([t]))},e.prototype.encode=function(t){for(var r=[],n=0,i=this.providers;n<i.length;n++){var a=i[n],o=a(t);if(!o.encodings.length)throw new Error("Encodings must be non-empty.");t=o.data;for(var s=0,u=o.encodings;s<u.length;s++){var l=u[s];r.push(l)}}if(!(t instanceof Uint8Array))throw new Error("The encoding must result in a Uint8Array. Fix your encoding chain.");return{encoding:r,data:t}},e}(),Mh;(function(e){function t(i){return new $J([i])}e.by=t;function r(i){for(var a=t(n(i[0])),o=1;o<i.length;o++)a=a.and(n(i[o]));return a}e.fromEncoding=r;function n(i){switch(i.kind){case"ByteArray":return Cr.byteArray;case"FixedPoint":return Cr.fixedPoint(i.factor);case"IntervalQuantization":return Cr.intervalQuantizaiton(i.min,i.max,i.numSteps);case"RunLength":return Cr.runLength;case"Delta":return Cr.delta;case"IntegerPacking":return Cr.integerPacking;case"StringArray":return Cr.stringArray}}})(Mh||(Mh={}));var Cr;(function(e){var t,r;function n(x){return new $J([x])}e.by=n;function i(x){return{encodings:[{kind:"ByteArray",type:4}],data:x}}function a(x){return{encodings:[{kind:"ByteArray",type:1}],data:new Uint8Array(x.buffer,x.byteOffset)}}var o=(t={},t[2]=function(x,C,w){x.setInt16(2*C,w,!0)},t[5]=function(x,C,w){x.setUint16(2*C,w,!0)},t[3]=function(x,C,w){x.setInt32(4*C,w,!0)},t[6]=function(x,C,w){x.setUint32(4*C,w,!0)},t[32]=function(x,C,w){x.setFloat32(4*C,w,!0)},t[33]=function(x,C,w){x.setFloat64(8*C,w,!0)},t),s=(r={},r[2]=2,r[5]=2,r[3]=4,r[6]=4,r[32]=4,r[33]=8,r);function u(x){var C=Af.getDataType(x);if(C===1)return a(x);if(C===4)return i(x);for(var w=new Uint8Array(x.length*s[C]),A=o[C],M=new DataView(w.buffer),D=0,k=x.length;D<k;D++)A(M,D,x[D]);return{encodings:[{kind:"ByteArray",type:C}],data:w}}e.byteArray=u;function l(x,C){for(var w=Af.getDataType(x),A=new Int32Array(x.length),M=0,D=x.length;M<D;M++)A[M]=Math.round(x[M]*C);return{encodings:[{kind:"FixedPoint",factor:C,srcType:w}],data:A}}function c(x){return function(C){return l(C,x)}}e.fixedPoint=c;function d(x,C,w,A,M){var D=Af.getDataType(x);if(!x.length)return{encodings:[{kind:"IntervalQuantization",min:C,max:w,numSteps:A,srcType:D}],data:new Int32Array(0)};if(w<C){var k=C;C=w,w=k}for(var R=(w-C)/(A-1),O=new M(x.length),H=0,B=x.length;H<B;H++){var j=x[H];j<=C?O[H]=0:j>=w?O[H]=A-1:O[H]=Math.round((j-C)/R)|0}return{encodings:[{kind:"IntervalQuantization",min:C,max:w,numSteps:A,srcType:D}],data:O}}function f(x,C,w,A){return A===void 0&&(A=Int32Array),function(M){return d(M,x,C,w,A)}}e.intervalQuantizaiton=f;function h(x){var C=Af.getDataType(x);if(C===void 0&&(x=new Int32Array(x),C=3),!x.length)return{encodings:[{kind:"RunLength",srcType:C,srcSize:0}],data:new Int32Array(0)};for(var w=2,A=1,M=x.length;A<M;A++)x[A-1]!==x[A]&&(w+=2);for(var D=new Int32Array(w),k=0,R=1,A=1,M=x.length;A<M;A++)x[A-1]!==x[A]?(D[k]=x[A-1],D[k+1]=R,R=1,k+=2):++R;return D[k]=x[x.length-1],D[k+1]=R,{encodings:[{kind:"RunLength",srcType:C,srcSize:x.length}],data:D}}e.runLength=h;function v(x){if(!Af.isSignedIntegerDataType(x))throw new Error("Only signed integer types can be encoded using delta encoding.");var C=Af.getDataType(x);if(C===void 0&&(x=new Int32Array(x),C=3),!x.length)return{encodings:[{kind:"Delta",origin:0,srcType:C}],data:new x.constructor(0)};var w=new x.constructor(x.length),A=x[0];w[0]=x[0];for(var M=1,D=x.length;M<D;M++)w[M]=x[M]-x[M-1];return w[0]=0,{encodings:[{kind:"Delta",origin:A,srcType:C}],data:w}}e.delta=v;function p(x){for(var C=0,w=x.length;C<w;C++)if(x[C]<0)return!0;return!1}function m(x,C){for(var w=-C-1,A=0,M=0,D=x.length;M<D;M++){var k=x[M];k===0?A+=1:k>0?(A+=Math.ceil(k/C),k%C===0&&(A+=1)):(A+=Math.ceil(k/w),k%w===0&&(A+=1))}return A}function g(x){var C=p(x),w=C?m(x,127):m(x,255),A=C?m(x,32767):m(x,65535);return x.length*4<A*2?{isSigned:C,size:x.length,bytesPerElement:4}:A*2<w?{isSigned:C,size:A,bytesPerElement:2}:{isSigned:C,size:w,bytesPerElement:1}}function y(x,C){for(var w=C.isSigned?C.bytesPerElement===1?127:32767:C.bytesPerElement===1?255:65535,A=-w-1,M=x.length,D=C.isSigned?C.bytesPerElement===1?new Int8Array(C.size):new Int16Array(C.size):C.bytesPerElement===1?new Uint8Array(C.size):new Uint16Array(C.size),k=0,R=0;R<M;R++){var O=x[R];if(O>=0)for(;O>=w;)D[k]=w,++k,O-=w;else for(;O<=A;)D[k]=A,++k,O-=A;D[k]=O,++k}var H=u(D);return{encodings:[{kind:"IntegerPacking",byteCount:C.bytesPerElement,isUnsigned:!C.isSigned,srcSize:M},H.encodings[0]],data:H.data}}function b(x){var C=g(x);return C.bytesPerElement===4?u(x):y(x,C)}e.integerPacking=b;function S(x){var C=Object.create(null),w=[],A=new Int32Array(x.length),M=qe.create(Int32Array,1,Math.min(1024,x.length<32?x.length+1:Math.round(x.length/8)+1));qe.add(M,0);for(var D=0,k=0,R=0,O=x;R<O.length;R++){var H=O[R];if(H==null){A[k++]=-1;continue}var B=C[H];B===void 0&&(D+=H.length,B=w.length,w[B]=H,C[H]=B,qe.add(M,D)),A[k++]=B}var j=qe.compact(M),Y=MD(j),G=Y.encode(j),$=MD(A),q=$.encode(A);return{encodings:[{kind:"StringArray",dataEncoding:q.encoding,stringData:w.join(""),offsetEncoding:G.encoding,offsets:G.data}],data:q.data}}e.stringArray=S})(Cr||(Cr={}));function bLe(e){var t=e.mask?fw(e.mask):void 0,r=fw(e.data),n=C6(r),i=n?t?function(l){return t[l]===0?""+r[l]:""}:function(l){return""+r[l]}:t?function(l){return t[l]===0?r[l]:""}:function(l){return r[l]},a=n?function(l){return r[l]}:function(l){var c=r[l];return vh(c,0,c.length)},o=n?function(l){return r[l]}:function(l){var c=r[l];return Yc(c,0,c.length)},s=t?function(l){return t[l]}:function(l){return 0},u=r.length;return{__array:r,binaryEncoding:e.data.encoding,isDefined:!0,rowCount:u,str:i,int:a,float:o,valueKind:s,areValuesEqual:function(l,c){return r[l]===r[c]},toStringArray:function(l){return ua(u,i,l)},toIntArray:n?function(l){return Q_(r,l)}:function(l){return ua(u,a,l)},toFloatArray:n?function(l){return Q_(r,l)}:function(l){return ua(u,o,l)}}}function WJ(e){return pw({buffer:e,offset:0,dataView:new DataView(e.buffer)})}function YP(e,t){for(var r={},n=0;n<t;n++){var i=pw(e);r[i]=pw(e)}return r}function KP(e,t){for(var r=new Uint8Array(t),n=e.offset,i=0;i<t;i++)r[i]=e.buffer[i+n];return e.offset+=t,r}function Gx(e,t){var r=R6(e.buffer,e.offset,t);return e.offset+=t,r}function QP(e,t){for(var r=new Array(t),n=0;n<t;n++)r[n]=pw(e);return r}function pw(e){var t=e.buffer[e.offset],r,n;if(!(t&128))return e.offset++,t;if((t&240)===128)return n=t&15,e.offset++,YP(e,n);if((t&240)===144)return n=t&15,e.offset++,QP(e,n);if((t&224)===160)return n=t&31,e.offset++,Gx(e,n);if((t&224)===224)return r=e.dataView.getInt8(e.offset),e.offset++,r;switch(t){case 192:return e.offset++,null;case 194:return e.offset++,!1;case 195:return e.offset++,!0;case 196:return n=e.dataView.getUint8(e.offset+1),e.offset+=2,KP(e,n);case 197:return n=e.dataView.getUint16(e.offset+1),e.offset+=3,KP(e,n);case 198:return n=e.dataView.getUint32(e.offset+1),e.offset+=5,KP(e,n);case 202:return r=e.dataView.getFloat32(e.offset+1),e.offset+=5,r;case 203:return r=e.dataView.getFloat64(e.offset+1),e.offset+=9,r;case 204:return r=e.buffer[e.offset+1],e.offset+=2,r;case 205:return r=e.dataView.getUint16(e.offset+1),e.offset+=3,r;case 206:return r=e.dataView.getUint32(e.offset+1),e.offset+=5,r;case 208:return r=e.dataView.getInt8(e.offset+1),e.offset+=2,r;case 209:return r=e.dataView.getInt16(e.offset+1),e.offset+=3,r;case 210:return r=e.dataView.getInt32(e.offset+1),e.offset+=5,r;case 217:return n=e.dataView.getUint8(e.offset+1),e.offset+=2,Gx(e,n);case 218:return n=e.dataView.getUint16(e.offset+1),e.offset+=3,Gx(e,n);case 219:return n=e.dataView.getUint32(e.offset+1),e.offset+=5,Gx(e,n);case 220:return n=e.dataView.getUint16(e.offset+1),e.offset+=3,QP(e,n);case 221:return n=e.dataView.getUint32(e.offset+1),e.offset+=5,QP(e,n);case 222:return n=e.dataView.getUint16(e.offset+1),e.offset+=3,YP(e,n);case 223:return n=e.dataView.getUint32(e.offset+1),e.offset+=5,YP(e,n)}throw new Error("Unknown type 0x"+t.toString(16))}function xLe(e,t){for(var r=0;r<2;r++)if(e[r]>t[r])return!1;return!0}function SLe(e){for(var t=Object.create(null),r=Object.create(null),n=0,i=e.columns;n<i.length;n++){var a=i[n];t[a.name]=a}return{rowCount:e.rowCount,name:e.name.substr(1),fieldNames:e.columns.map(function(o){return o.name}),getField:function(o){var s=t[o];if(s)return r[o]||(r[o]=bLe(s)),r[o]}}}function ej(e){var t=this;return $e.create("Parse BinaryCIF",function(r){return ce(t,void 0,void 0,function(){var n,i,a;return de(this,function(o){n=[0,3];try{return i=WJ(e),xLe(n,i.version.match(/(\d)\.(\d)\.\d/).slice(1).map(function(s){return+s}))?(a=jJ(i.dataBlocks.map(function(s){for(var u=Object.create(null),l=0,c=s.categories;l<c.length;l++){var d=c[l];u[d.name.substr(1)]=SLe(d)}return tF(s.categories.map(function(f){return f.name.substr(1)}),u,s.header)})),[2,Rn.success(a)]):[2,Rn.error("Unsupported format version. Current "+i.version+", required "+n.join(".")+".")]}catch(s){return[2,Rn.error(""+s)]}return[2]})})})}var jg;(function(e){function t(i){return i.replace(".","_").replace(/\[/,"_").replace(/(\[|\])/g,"")}e.canonical=t;function r(i,a){return t(i)===t(a)}e.equal=r;function n(i,a,o){o===void 0&&(o=!1);var s=""+i+(a?"."+a:"");return o?t(s):s}e.create=n})(jg||(jg={}));function CLe(e,t,r){for(var n={},i=0,a=t.blocks;i<a.length;i++){var o=a[i];n[o.header]=Pc(e,o,r)}return n}function Pc(e,t,r){return ALe(e,t,r)}function XJ(e,t){return new YJ(t,e,!0)}function _Le(e){switch(e.valueType){case"str":return function(t,r,n){return ZP(e,t,t.str,t.toStringArray)};case"int":return function(t,r,n){return ZP(e,t,t.int,t.toIntArray)};case"float":return function(t,r,n){return ZP(e,t,t.float,t.toFloatArray)};case"list":throw new Error("Use createListColumn instead.");case"tensor":throw new Error("Use createTensorColumn instead.")}}function ZP(e,t,r,n){return{schema:e,__array:t.__array,isDefined:t.isDefined,rowCount:t.rowCount,value:r,valueKind:t.valueKind,areValuesEqual:t.areValuesEqual,toArray:n}}function wLe(e,t,r){var n=e.separator,i=e.itemParse,a=t.getField(r),o=a?function(u){return a.str(u).split(n).map(function(l){return i(l.trim())}).filter(function(l){return!!l})}:function(u){return[]},s=function(u){return ua(t.rowCount,o,u)};return{schema:e,__array:void 0,isDefined:!!a,rowCount:t.rowCount,value:o,valueKind:a?a.valueKind:function(){return 1},areValuesEqual:function(u,l){return so(o(u),o(l))},toArray:s}}function ELe(e,t,r){var n=e.space,i=t.fieldNames.includes(r+"[0]")||t.fieldNames.includes(r+"[0][0]")||t.fieldNames.includes(r+"[0][0][0]"),a=i?0:1,o=t.fieldNames.includes(r+"_1")||t.fieldNames.includes(r+"_11")||t.fieldNames.includes(r+"_111")?"underscore":"brackets",s=EFe(r,n.rank,i,o),u=t.getField(s(a,a,a))||ve.Undefined(t.rowCount,e),l=function(d){return AFe(t,n,d,s)},c=function(d){return ua(t.rowCount,l,d)};return{schema:e,__array:void 0,isDefined:u.isDefined,rowCount:t.rowCount,value:l,valueKind:u.valueKind,areValuesEqual:function(d,f){return kr.areEqualExact(l(d),l(f))},toArray:c}}var YJ=function(){function e(t,r,n){this._isDefined=n;var i=Object.keys(r);this._rowCount=t.rowCount,this._columns=i,this._schema=r;for(var a=Object.create(null),o=function(d){Object.defineProperty(s,d,{get:function(){if(a[d])return a[d];var f=r[d];if(f.valueType==="list")a[d]=wLe(f,t,d);else if(f.valueType==="tensor")a[d]=ELe(f,t,d);else{var h=_Le(f),v=t.getField(d);a[d]=v?h(v,t,d):ve.Undefined(t.rowCount,f)}return a[d]},enumerable:!0,configurable:!1})},s=this,u=0,l=i;u<l.length;u++){var c=l[u];o(c)}}return e}();function ALe(e,t,r){for(var n=Object.create(null),i=0,a=Object.keys(e);i<a.length;i++){var o=a[i];n[o]=ILe(o,e[o],t,r)}return X5.ofTables(t.header,e,n)}function PLe(e){for(var t=Object.create(null),r=0,n=Object.keys(e.categories);r<n.length;r++)for(var i=n[r],a=0,o=e.categories[i].fieldNames;a<o.length;a++){var s=o[a],u=jg.create(i,s,!0);t[u]=e.categories[i].getField(s)}return t}function TLe(e,t,r,n){var i=jg.create(t,e),a=jg.canonical(i);if(a in r)return r[a];if(n&&i in n)for(var o=0,s=n[i];o<s.length;o++){var u=s[o],l=jg.canonical(u);if(l in r)return r[l]}}function ILe(e,t,r,n){var i=r.categories[e];if(n){for(var a=PLe(r),o=Object.create(null),s=[],u=0,l=0,c=Object.keys(t);l<c.length;l++){var d=c[l],f=TLe(d,e,a,n);f&&(o[d]=f,s.push(d),u=f.rowCount)}i={rowCount:u,name:e,fieldNames:Nt([],s),getField:function(h){return o[h]}}}return new YJ(i||ba.empty(e),t,!!i)}var q0=ve.Schema,Or=q0.str,MLe=q0.float,tj=q0.List,Vo=q0.Aliased,Iy=q0.int,Im=q0.coord,DLe={chem_comp:{formula:Or,formula_weight:MLe,id:Or,mon_nstd_parent_comp_id:tj(",",function(e){return e}),name:Or,one_letter_code:Or,three_letter_code:Or,type:Vo(Or),pdbx_synonyms:tj(";",function(e){return e}),pdbx_type:Or,pdbx_ambiguous_flag:Or,pdbx_replaced_by:Or,pdbx_replaces:Or,pdbx_formal_charge:Iy,pdbx_model_coordinates_details:Or,pdbx_model_coordinates_db_code:Or,pdbx_ideal_coordinates_details:Or,pdbx_ideal_coordinates_missing_flag:Vo(Or),pdbx_model_coordinates_missing_flag:Vo(Or),pdbx_initial_date:Or,pdbx_modified_date:Or,pdbx_release_status:Vo(Or),pdbx_processing_site:Vo(Or)},chem_comp_atom:{alt_atom_id:Or,atom_id:Or,charge:Iy,model_Cartn_x:Im,model_Cartn_y:Im,model_Cartn_z:Im,comp_id:Or,type_symbol:Or,pdbx_align:Iy,pdbx_ordinal:Iy,pdbx_model_Cartn_x_ideal:Im,pdbx_model_Cartn_y_ideal:Im,pdbx_model_Cartn_z_ideal:Im,pdbx_stereo_config:Vo(Or),pdbx_aromatic_flag:Vo(Or),pdbx_leaving_atom_flag:Vo(Or)},chem_comp_bond:{atom_id_1:Or,atom_id_2:Or,comp_id:Or,value_order:Vo(Or),pdbx_ordinal:Iy,pdbx_stereo_config:Vo(Or),pdbx_aromatic_flag:Vo(Or)},pdbx_chem_comp_descriptor:{comp_id:Or,descriptor:Or,type:Vo(Or),program:Or,program_version:Or},pdbx_chem_comp_identifier:{comp_id:Or,identifier:Or,type:Vo(Or),program:Or,program_version:Or}},KE=ve.Schema,zt=KE.str,RLe=KE.float,eo=KE.Aliased,_s=KE.int,kLe={pdbx_reference_molecule:{prd_id:zt,formula_weight:RLe,formula:zt,type:eo(zt),type_evidence_code:zt,class:eo(zt),class_evidence_code:zt,name:zt,represent_as:eo(zt),chem_comp_id:zt,compound_details:zt,description:zt,representative_PDB_id_code:zt,release_status:eo(zt),replaces:zt,replaced_by:zt},pdbx_reference_entity_list:{prd_id:zt,ref_entity_id:zt,type:eo(zt),details:zt,component_id:_s},pdbx_reference_entity_nonpoly:{prd_id:zt,ref_entity_id:zt,name:zt,chem_comp_id:zt},pdbx_reference_entity_link:{link_id:_s,prd_id:zt,details:zt,ref_entity_id_1:zt,ref_entity_id_2:zt,entity_seq_num_1:_s,entity_seq_num_2:_s,comp_id_1:zt,comp_id_2:zt,atom_id_1:zt,atom_id_2:zt,value_order:eo(zt),component_1:_s,component_2:_s,link_class:eo(zt)},pdbx_reference_entity_poly_link:{link_id:_s,prd_id:zt,ref_entity_id:zt,component_id:_s,entity_seq_num_1:_s,entity_seq_num_2:_s,comp_id_1:zt,comp_id_2:zt,atom_id_1:zt,atom_id_2:zt,value_order:eo(zt)},pdbx_reference_entity_poly:{prd_id:zt,ref_entity_id:zt,type:eo(zt),db_code:zt,db_name:zt},pdbx_reference_entity_poly_seq:{prd_id:zt,ref_entity_id:zt,mon_id:zt,parent_mon_id:zt,num:_s,observed:eo(zt),hetero:eo(zt)},pdbx_reference_entity_sequence:{prd_id:zt,ref_entity_id:zt,type:eo(zt),NRP_flag:eo(zt),one_letter_codes:zt},pdbx_reference_entity_src_nat:{prd_id:zt,ref_entity_id:zt,ordinal:_s,organism_scientific:zt,taxid:zt,db_code:zt,db_name:zt},pdbx_prd_audit:{prd_id:zt,date:zt,processing_site:eo(zt),action_type:eo(zt)}},KJ=ve.Schema,Ci=KJ.str,OLe=KJ.float,FLe={id:Ci,description:Ci},LLe={title:Ci,datablock_id:Ci,version:Ci},NLe={version:Ci,update:Ci,revision:Ci},BLe={id:Ci,description:Ci},ULe={id:Ci,parent_id:Ci,description:Ci},jLe={code:Ci,primitive_code:Ci,construct:Ci,detail:Ci},zLe={code:Ci,detail:Ci},VLe={from_code:Ci,to_code:Ci,operator:Ci,factor:OLe},HLe={datablock:FLe,dictionary:LLe,dictionary_history:NLe,sub_category:BLe,category_group_list:ULe,item_type_list:jLe,item_units_list:zLe,item_units_conversion:VLe},I2=ve.Schema,xl=I2.str,qx=I2.int,hc=I2.float,$x=I2.Aliased,Pf=I2.Vector;$x(xl),$x(xl),$x(xl),$x(xl),Pf(3),Pf(3);var GLe={volume_data_3d_info:{name:xl,axis_order:Pf(3,qx),origin:Pf(3),dimensions:Pf(3),sample_rate:qx,sample_count:Pf(3,qx),spacegroup_number:qx,spacegroup_cell_size:Pf(3),spacegroup_cell_angles:Pf(3),mean_source:hc,mean_sampled:hc,sigma_source:hc,sigma_sampled:hc,min_source:hc,min_sampled:hc,max_source:hc,max_sampled:hc},volume_data_3d:{values:hc}},QE=ve.Schema,JP=QE.int,xn=QE.float,vn=QE.str,rj=QE.Matrix,qLe={cell:{formula_units_Z:JP,volume:xn,angle_alpha:xn,angle_beta:xn,angle_gamma:xn,length_a:xn,length_b:xn,length_c:xn},chemical:{melting_point:xn,name_common:vn,name_systematic:vn},chemical_formula:{moiety:vn,sum:vn,weight:xn},space_group:{crystal_system:vn,IT_number:JP,"name_H-M_full":vn},space_group_symop:{operation_xyz:vn},geom_bond:{atom_site_label_1:vn,atom_site_label_2:vn,distance:xn,publ_flag:vn,site_symmetry_1:vn,site_symmetry_2:vn,valence:xn},audit:{block_doi:vn},database_code:{COD:vn,CSD:vn,depnum_ccdc_archive:vn,depnum_ccdc_fiz:vn,ICSD:vn,MDF:vn,NBS:vn},atom_site:{adp_type:vn,calc_flag:vn,disorder_assembly:vn,disorder_group:vn,fract_x:xn,fract_y:xn,fract_z:xn,label:vn,occupancy:xn,refinement_flags:vn,site_symmetry_multiplicity:JP,type_symbol:vn,U_iso_or_equiv:xn},atom_site_aniso:{label:vn,U_11:xn,U:rj(3,3),U_11_su:xn,U_su:rj(3,3),U_12:xn,U_12_su:xn,U_13:xn,U_13_su:xn,U_22:xn,U_22_su:xn,U_23:xn,U_23_su:xn,U_33:xn,U_33_su:xn},atom_type:{description:vn,symbol:vn},atom_type_scat:{dispersion_imag:xn,dispersion_real:xn,source:vn}},$Le={"atom_site_aniso.U":["atom_site_anisotrop_U"],"atom_site_aniso.U_su":["atom_site_aniso_U_esd","atom_site_anisotrop_U_esd"],"space_group.IT_number":["symmetry_Int_Tables_number"],"space_group.name_H-M_full":["symmetry_space_group_name_H-M"],"space_group_symop.operation_xyz":["symmetry_equiv_pos_as_xyz"],"geom_bond.atom_site_label_1":["geom_bond_atom_site_id_1"],"geom_bond.atom_site_label_2":["geom_bond_atom_site_id_2"],"geom_bond.distance":["geom_bond_dist"],"atom_site.adp_type":["atom_site_thermal_displace_type"],"atom_site.label":["atom_site_id"],"atom_site.site_symmetry_multiplicity":["atom_site_symmetry_multiplicity"],"atom_site_aniso.label":["atom_site_anisotrop_id"],"atom_site_aniso.U_11":["atom_site_anisotrop_U_11"],"atom_site_aniso.U_11_su":["atom_site_aniso_U_11_esd","atom_site_anisotrop_U_11_esd"],"atom_site_aniso.U_12":["atom_site_anisotrop_U_12"],"atom_site_aniso.U_12_su":["atom_site_aniso_U_12_esd","atom_site_anisotrop_U_12_esd"],"atom_site_aniso.U_13":["atom_site_anisotrop_U_13"],"atom_site_aniso.U_13_su":["atom_site_aniso_U_13_esd","atom_site_anisotrop_U_13_esd"],"atom_site_aniso.U_22":["atom_site_anisotrop_U_22"],"atom_site_aniso.U_22_su":["atom_site_aniso_U_22_esd","atom_site_anisotrop_U_22_esd"],"atom_site_aniso.U_23":["atom_site_anisotrop_U_23"],"atom_site_aniso.U_23_su":["atom_site_aniso_U_23_esd","atom_site_anisotrop_U_23_esd"],"atom_site_aniso.U_33":["atom_site_anisotrop_U_33"],"atom_site_aniso.U_33_su":["atom_site_aniso_U_33_esd","atom_site_anisotrop_U_33_esd"]},vd={parse:function(e){return typeof e=="string"?JU(e):ej(e)},parseText:JU,parseBinary:ej,toDatabaseCollection:CLe,toDatabase:Pc,schema:{mmCIF:function(e){return Pc(Sr,e)},CCD:function(e){return Pc(DLe,e)},BIRD:function(e){return Pc(kLe,e)},dic:function(e){return Pc(HLe,e)},cifCore:function(e){return Pc(qLe,e,$Le)},densityServer:function(e){return Pc(GLe,e)}}},RD=function(){function e(t,r,n){this.operatorsProvider=n,this.id=t,this.details=r}return Object.defineProperty(e.prototype,"operatorGroups",{get:function(){return this._operators?this._operators:(this._operators=this.operatorsProvider(),this._operators)},enumerable:!1,configurable:!0}),e}();(function(e){function t(r,n,i){return new e(r,n,i)}e.create=t})(RD||(RD={}));var Wb;(function(e){e.Default={assemblies:[],spacegroup:Xu.ZeroP1,isNonStandardCrystalFrame:!1};function t(n,i){var a=i.toLocaleLowerCase(),o=vi.Provider.get(n);return o?_6(o.assemblies,function(s){return s.id.toLowerCase()===a}):void 0}e.findAssembly=t;function r(n){var i=n.spacegroup,a=i.cell,o=i.name,s=i.num,u=a.size,l=a.anglesInRadians,c=u[0].toFixed(2),d=u[1].toFixed(2),f=u[2].toFixed(2),h=ku(l[0]).toFixed(2),v=ku(l[1]).toFixed(2),p=ku(l[2]).toFixed(2),m=[];return m.push("Unit Cell <b>"+o+"</b> #"+s),m.push(c+""+d+""+f+" "),m.push("="+h+" ="+v+" ="+p+""),m.join(" | ")}e.getUnitcellLabel=r})(Wb||(Wb={}));function WLe(e,t,r){if(!e._rowCount)return[];for(var n=KLe(r),i=[],a=0;a<e._rowCount;a++)i[i.length]=XLe(e,t,a,n);return i}function XLe(e,t,r,n){for(var i=e.id.value(r),a=e.details.value(r),o=[],s=t.assembly_id,u=t.oper_expression,l=t.asym_id_list,c=0,d=t._rowCount;c<d;c++)s.value(c)===i&&(o[o.length]={assemblyId:i,expression:u.value(c),asymIds:l.value(c)});return RD.create(i,a,YLe(o,n))}function YLe(e,t){return function(){for(var r=[],n=0,i=0;i<e.length;i++){var a=e[i],o=JLe(a.expression),s=QLe(o),u=ZLe(t,s,n,a.assemblyId),l=sn.generators.atoms({chainTest:sn.pred.and(sn.pred.eq(function(c){return lt.unit.operator_name(c.element)},Cn.DefaultName),sn.pred.inSet(function(c){return lt.chain.label_asym_id(c.element)},a.asymIds))});r[r.length]={selector:l,operators:u},n+=u.length}return r}}function KLe(e){for(var t=e.id,r=e.matrix,n=e.vector,i=e._schema,a=new Map,o=0,s=e._rowCount;o<s;o++){var u=kr.toMat4(ue(),i.matrix.space,r.value(o)),l=kr.toVec3(_(),i.vector.space,n.value(o));ue.setTranslation(u,l),ue.setValue(u,3,3,1),a.set(t.value(o),u)}return a}function QLe(e){for(var t=[],r=[],n=0;n<e.length;n++)r[n]="";return QJ(e,t,e.length-1,r),t}function QJ(e,t,r,n){if(r<0){t[t.length]=n.slice(0);return}for(var i=e[r],a=i.length,o=0;o<a;o++)n[r]=i[o],QJ(e,t,r-1,n)}function ZLe(e,t,r,n){for(var i=[],a=r,o=0,s=t;o<s.length;o++){for(var u=s[o],l=ue.identity(),c=0;c<u.length;c++)ue.mul(l,l,e.get(u[c]));a++,i[i.length]=Cn.create("ASM_"+a,l,{assembly:{id:n,operId:a,operList:u}})}return i}function JLe(e){for(var t=/\(?([^\(\)]+)\)?]*/g,r=[],n=[],i;i=t.exec(e);)r[r.length]=i[1];return r.forEach(function(a){var o=[];a.split(",").forEach(function(s){var u=s.indexOf("-");if(u>0)for(var l=parseInt(s.substring(0,u)),c=parseInt(s.substr(u+1)),d=l;d<=c;d++)o[o.length]=d.toString();else o[o.length]=s.trim()}),n[n.length]=o}),n}var vi;(function(e){e.Descriptor={name:"model_symmetry"},e.Provider=Wu.create(e.Descriptor);function t(n){var i=WLe(n.pdbx_struct_assembly,n.pdbx_struct_assembly_gen,n.pdbx_struct_oper_list),a=rNe(n.symmetry,n.cell),o=eNe(n.atom_sites);return{assemblies:i,spacegroup:a,isNonStandardCrystalFrame:o,ncsOperators:nNe(n.struct_ncs_oper)}}e.fromData=t;function r(n,i){var a=Fo.create("P 1",n,i),o=Xu.create(a);return{assemblies:[],spacegroup:o,isNonStandardCrystalFrame:!1}}e.fromCell=r})(vi||(vi={}));function eNe(e,t){return e._rowCount===0,!1}function tNe(e){var t=e.Int_Tables_number.value(0),r=e["space_group_name_H-M"].value(0);return e.Int_Tables_number.isDefined?e["space_group_name_H-M"].isDefined?r:t:r}function rNe(e,t){if(e._rowCount===0||t._rowCount===0)return Xu.ZeroP1;var r=tNe(e),n=Fo.create(r,_.create(t.length_a.value(0),t.length_b.value(0),t.length_c.value(0)),_.scale(_.zero(),_.create(t.angle_alpha.value(0),t.angle_beta.value(0),t.angle_gamma.value(0)),Math.PI/180));return Xu.create(n)}function nNe(e){if(e._rowCount!==0){for(var t=e.id,r=e.matrix,n=e.vector,i=Sr.struct_ncs_oper.matrix.space,a=Sr.struct_ncs_oper.vector.space,o=[],s=0;s<e._rowCount;s++){var u=kr.toMat3(Yn(),i,r.value(s)),l=kr.toVec3(_(),a,n.value(s));if(Cn.checkIfRotationAndTranslation(u,l)&&!(e.code.value(s)==="given"&&!Yn.isIdentity(u)&&!_.isZero(l))){var c=t.value(s);o[o.length]=Cn.ofRotationAndOffset("ncs_"+c,u,l,c)}}return o}}function ZJ(e,t,r,n){return{type:e,key:t,elements:r,getIndex:n}}var Xb;(function(e){e.Descriptor={name:"model_secondary_structure"},e.Provider=Wu.create(e.Descriptor);function t(r,n,i){var a=new Map,o=[{kind:"none"}],s=iNe(r,n);aNe(r,s,a,o),oNe(n,s,a,r._rowCount,o);var u=i.residues._rowCount,l=function(d){return d},c={type:new Int32Array(u),key:new Int32Array(u),elements:o};return a.size>0&&uNe(i,s,a,c),ZJ(c.type,c.key,c.elements,l)}e.fromStruct=t})(Xb||(Xb={}));function iNe(e,t){if(e._rowCount>0){if(e.beg_label_seq_id.valueKind(0)!==0||e.end_label_seq_id.valueKind(0)!==0)return"auth"}else if(t&&(t.beg_label_seq_id.valueKind(0)!==0||t.end_label_seq_id.valueKind(0)!==0))return"auth";return"label"}function aNe(e,t,r,n){if(e._rowCount)for(var i=e.beg_label_asym_id,a=e.beg_label_seq_id,o=e.beg_auth_seq_id,s=e.pdbx_beg_PDB_ins_code,u=e.end_label_seq_id,l=e.end_auth_seq_id,c=e.pdbx_end_PDB_ins_code,d=e.pdbx_PDB_helix_class,f=e.conf_type_id,h=e.details,v=t==="label"?a:o,p=t==="label"?u:l,m=0,g=e._rowCount;m<g;m++){var y=Vr.create(d.valueKind(m)===0?Vr.SecondaryStructurePdb[d.value(m)]:f.valueKind(m)===0?Vr.SecondaryStructureMmcif[f.value(m)]:536870912),b={kind:"helix",flags:y,type_id:f.valueKind(m)===0?f.value(m):"HELIX_P",helix_class:d.value(m),details:h.valueKind(m)===0?h.value(m):void 0},S={startSeqId:v.value(m),startInsCode:s.value(m),endSeqId:p.value(m),endInsCode:c.value(m),type:y,key:n.length};n[n.length]=b;var x=i.value(m);if(r.has(x)){var C=r.get(x);C.has(S.startSeqId)?C.get(S.startSeqId).push(S):C.set(S.startSeqId,[S])}else r.set(x,new Map([[S.startSeqId,[S]]]))}}function oNe(e,t,r,n,i){if(e._rowCount)for(var a=e.beg_label_asym_id,o=e.beg_label_seq_id,s=e.beg_auth_seq_id,u=e.pdbx_beg_PDB_ins_code,l=e.end_label_seq_id,c=e.end_auth_seq_id,d=e.pdbx_end_PDB_ins_code,f=e.sheet_id,h=t==="label"?o:s,v=t==="label"?l:c,p=new Map,m=n+1,g=0,y=e._rowCount;g<y;g++){var b=f.value(g),S=void 0;p.has(b)?S=p.get(b):(S=m++,p.set(b,S));var x=Vr.create(8388612),C={kind:"sheet",flags:x,sheet_id:b,symmetry:void 0},w={startSeqId:h.value(g),startInsCode:u.value(g),endSeqId:v.value(g),endInsCode:d.value(g),type:x,key:i.length};i[i.length]=C;var A=a.value(g);if(r.has(A)){var M=r.get(A);M.has(w.startSeqId)?M.get(w.startSeqId).push(w):M.set(w.startSeqId,[w])}else r.set(A,new Map([[w.startSeqId,[w]]]))}}function sNe(e,t,r,n,i,a){for(var o=e.residues,s=o.auth_seq_id,u=o.label_seq_id,l=o.pdbx_PDB_ins_code,c=r.endSeqId,d=r.endInsCode,f=r.key,h=r.type,v=t==="label"?u:s,p=n;p<i;){var m=v.value(p);if(a.type[p]=h,a.key[p]=f,m>c||m===c&&l.value(p)===d)break;p++}}function uNe(e,t,r,n){for(var i=e.chainAtomSegments.count,a=e.chains.label_asym_id,o=e.residues,s=o.auth_seq_id,u=o.label_seq_id,l=o.pdbx_PDB_ins_code,c=t==="label"?u:s,d=0;d<i;d++){var f=Mv.chainStartResidueIndex(e,d),h=Mv.chainEndResidueIndexExcl(e,d),v=a.value(d);if(r.has(v))for(var p=r.get(v),m=f;m<h;m++){var g=c.value(m);if(p.has(g))for(var y=p.get(g),b=0,S=y;b<S.length;b++){var x=S[b],C=l.value(m);x.startInsCode===C&&sNe(e,t,x,m,h,n)}}}}var kD;(function(e){function t(s,u,l){return{name:s,type:0,value:u,valueKind:l&&l.valueKind,defaultFormat:l&&l.encoder?{encoder:l.encoder}:void 0,shouldInclude:l&&l.shouldInclude}}e.str=t;function r(s,u,l){return{name:s,type:1,value:u,valueKind:l&&l.valueKind,defaultFormat:l?{encoder:l.encoder,typedArray:l.typedArray}:void 0,shouldInclude:l&&l.shouldInclude}}e.int=r;function n(s,u,l){return{name:s,type:2,value:u,valueKind:l&&l.valueKind,defaultFormat:l?{encoder:l.encoder,typedArray:l.typedArray,digitCount:typeof l.digitCount<"u"?l.digitCount:void 0}:void 0,shouldInclude:l&&l.shouldInclude}}e.float=n;function i(s){return r(s,function(u,l,c){return c+1},{typedArray:Int32Array,encoder:Cr.by(Cr.delta).and(Cr.runLength).and(Cr.integerPacking)})}e.index=i;var a=function(){function s(){this.fields=[]}return s.prototype.index=function(u){return this.fields.push(e.index(u)),this},s.prototype.str=function(u,l,c){return this.fields.push(e.str(u,l,c)),this},s.prototype.int=function(u,l,c){return this.fields.push(e.int(u,l,c)),this},s.prototype.vec=function(u,l,c){for(var d=0;d<l.length;d++)this.fields.push(e.int(u+"["+(d+1)+"]",l[d],c));return this},s.prototype.float=function(u,l,c){return this.fields.push(e.float(u,l,c)),this},s.prototype.many=function(u){for(var l=0;l<u.length;l++)this.fields.push(u[l]);return this},s.prototype.add=function(u){return this.fields.push(u),this},s.prototype.getFields=function(){return this.fields},s}();e.Builder=a;function o(){return new a}e.build=o})(kD||(kD={}));var ts;(function(e){e.Empty={fields:[],source:[]};function t(n){for(var i=[],a=[],o=[],s=[],u=0,l=n.split(/[\r\n]+/);u<l.length;u++){var c=l[u];if(c=c.trim(),c.length!==0){var d=/^!/.test(c);d&&(c=c.substr(1));var f=c.split(/\./),h=f[1],v=d?h?s:a:h?o:i;v[v.length]=c,h&&!i.includes(f[0])&&(i[i.length]=f[0])}}var p=o.map(function(m){return m.split(".")[0]});return{includeCategory:function(m){return a.includes(m)?!1:i.length<=0||i.indexOf(m)!==-1},includeField:function(m,g){var y=m+"."+g;return s.includes(y)?!1:!p.includes(m)||o.includes(y)}}}e.filterOf=t,e.DefaultFilter={includeCategory:function(n){return!0},includeField:function(n,i){return!0}},e.DefaultFormatter={getFormat:function(n,i){}};function r(n,i){return i?{fields:nj(n._schema),source:[{data:n,rowCount:i.length,keys:function(){return ew.Array(i)}}]}:{fields:nj(n._schema),source:[{data:n,rowCount:n._rowCount}]}}e.ofTable=r})(ts||(ts={}));var OD;(function(e){function t(n,i,a){n.startDataBlock(i);for(var o=function(c){n.writeCategory({name:c,instance:function(){return ts.ofTable(a[c])}})},s=0,u=a._tableNames;s<u.length;s++){var l=u[s];o(l)}}e.writeDatabase=t;function r(n,i){for(var a=0,o=Object.keys(i);a<o.length;a++){var s=o[a];t(n,s,i[s])}}e.writeDatabaseCollection=r})(OD||(OD={}));function eT(e){return function(t,r){return r[e].value(t)}}function lNe(e){return function(t,r){return r[e].value(t).join(r[e].schema.separator)}}function tT(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];return function(n,i){var a;return(a=i[e].schema.space).get.apply(a,Nt([i[e].value(n)],t))}}function h1(e){return function(t,r){return r[e].valueKind(t)}}function cNe(e,t){var r=[],n=2,i=h1(e);if(t.rank===1)for(var a=t.dimensions[0],o=0;o<a;o++){var s=e+"["+(o+1)+"]";r.push({name:s,type:n,value:tT(e,o),valueKind:i})}else if(t.rank===2)for(var a=t.dimensions[0],u=t.dimensions[1],o=0;o<a;o++)for(var l=0;l<u;l++){var c=e+"["+(o+1)+"]["+(l+1)+"]";r.push({name:c,type:n,value:tT(e,o,l),valueKind:i})}else if(t.rank===3)for(var d=t.dimensions[0],f=t.dimensions[1],h=t.dimensions[2],o=0;o<d;o++)for(var l=0;l<f;l++)for(var v=0;v<h;v++){var p=e+"["+(o+1)+"]["+(l+1)+"]["+(v+1)+"]";r.push({name:p,type:n,value:tT(e,o,l,v),valueKind:i})}else throw new Error("Tensors with rank > 3 or rank 0 are currently not supported.");return r}function nj(e){for(var t=[],r=0,n=Object.keys(e);r<n.length;r++){var i=n[r],a=e[i];if(a.valueType==="int")t.push({name:i,type:1,value:eT(i),valueKind:h1(i)});else if(a.valueType==="float")t.push({name:i,type:2,value:eT(i),valueKind:h1(i)});else if(a.valueType==="str")t.push({name:i,type:0,value:eT(i),valueKind:h1(i)});else if(a.valueType==="list")t.push({name:i,type:0,value:lNe(i),valueKind:h1(i)});else if(a.valueType==="tensor")t.push.apply(t,cNe(i,a.space));else throw new Error("Unknown valueType "+a.valueType)}return t}function dNe(e){return e.defaultFormat&&typeof e.defaultFormat.digitCount<"u"?Math.max(0,Math.min(e.defaultFormat.digitCount,16)):6}function nF(e){return e.fields.some(function(t){return!!t.shouldInclude})?e.fields.filter(function(t){return!t.shouldInclude||e.source.some(function(r){return t.shouldInclude(r.data)})}):e.fields}function JJ(e,t){var r=e.instance(t),n=r.source.filter(function(o){return o.rowCount>0});if(!n.length)return{instance:r,rowCount:0,source:[]};var i=n.reduce(function(o,s){return o+s.rowCount},0),a=n.map(function(o){return{data:o.data,keys:function(){return o.keys?o.keys():ew.Range(0,o.rowCount-1)},rowCount:o.rowCount}});return{instance:r,rowCount:i,source:a}}var fNe=function(){function e(){this.builder=Br.create(),this.encoded=!1,this.dataBlockCreated=!1,this.filter=ts.DefaultFilter,this.formatter=ts.DefaultFormatter,this.isBinary=!1,this.binaryEncodingProvider=void 0}return e.prototype.setFilter=function(t){this.filter=t||ts.DefaultFilter},e.prototype.isCategoryIncluded=function(t){return this.filter.includeCategory(t)},e.prototype.setFormatter=function(t){this.formatter=t||ts.DefaultFormatter},e.prototype.startDataBlock=function(t){this.dataBlockCreated=!0,Br.write(this.builder,"data_"+(t||"").replace(/[ \n\t]/g,"").toUpperCase()+`
#
`)},e.prototype.writeCategory=function(t,r,n){if(this.encoded)throw new Error("The writer contents have already been encoded, no more writing.");if(!this.dataBlockCreated)throw new Error("No data block created.");if(!(!(n!=null&&n.ignoreFilter)&&!this.filter.includeCategory(t.name))){var i=JJ(t,r),a=i.instance,o=i.rowCount,s=i.source;o&&(o===1?hNe(t,a,s,this.builder,this.filter,this.formatter):pNe(t,a,s,this.builder,this.filter,this.formatter))}},e.prototype.encode=function(){this.encoded=!0},e.prototype.writeTo=function(t){for(var r=Br.getChunks(this.builder),n=0,i=r.length;n<i;n++)t.writeString(r[n])},e.prototype.getSize=function(){return Br.getSize(this.builder)},e.prototype.getData=function(){return Br.getString(this.builder)},e}();function eee(e,t,r,n,i,a){var o=n.valueKind,s=o?o(r,t):0;if(s!==0)s===1?yNe(e):bNe(e);else{var u=n.value(r,t,a),l=n.type;if(l===0)return vNe(u)?(_C(e,u),!0):xNe(e,u);l===1?mNe(e,u):gNe(e,u,i)}return!1}function tee(e,t,r){for(var n=[],i=0,a=t;i<a.length;i++){var o=a[i],s=r.getFormat(e,o.name);s&&typeof s.digitCount<"u"?n[n.length]=o.type===2?Math.pow(10,Math.max(0,Math.min(s.digitCount,15))):0:n[n.length]=o.type===2?Math.pow(10,dNe(o)):0}return n}function hNe(e,t,r,n,i,a){var o=nF(t),s=r[0],u=s.data,l=o.reduce(function(m,g){return i.includeField(e.name,g.name)?Math.max(m,g.name.length):0},0);if(l!==0){l+=e.name.length+6;for(var c=s.keys(),d=c.move(),f=tee(e.name,t.fields,a),h=0;h<o.length;h++){var v=o[h];if(i.includeField(e.name,v.name)){Br.writePadRight(n,"_"+e.name+"."+v.name,l);var p=eee(n,u,d,v,f[h],0);p||Br.newline(n)}}Br.write(n,`#
`)}}function pNe(e,t,r,n,i,a){var o=nF(t),s=i===ts.DefaultFilter?o:o.filter(function(b){return i.includeField(e.name,b.name)}),u=s.length;if(u!==0){var l=tee(e.name,s,a);ij(n,"loop_");for(var c=0;c<u;c++)ij(n,"_"+e.name+"."+s[c].name);for(var d=0,f=0;f<r.length;f++){var h=r[f],v=h.data;if(h.rowCount!==0)for(var p=h.keys();p.hasNext;){for(var m=p.move(),g=!1,y=0;y<u;y++)g=eee(n,v,m,s[y],l[y],d);g||Br.newline(n),d++}}Br.write(n,`#
`)}}function vNe(e){return typeof e=="string"&&e.indexOf(`
`)>=0}function ij(e,t){Br.write(e,t),Br.newline(e)}function mNe(e,t){Br.writeInteger(e,t),Br.whitespace1(e)}function gNe(e,t,r){Br.writeFloat(e,t,r),Br.whitespace1(e)}function yNe(e){Br.writeSafe(e,". ")}function bNe(e){Br.writeSafe(e,"? ")}function xNe(e,t){if(!t)return Br.writeSafe(e,". "),!1;for(var r=t.charCodeAt(0),n=!1,i=0,a=!1,o=!1,s=0,u=t.length-1;s<=u;s++){var l=t.charCodeAt(s);switch(l){case 9:n=!0;break;case 10:return _C(e,t),!0;case 32:n=!0;break;case 34:if(s&&s===u)break;if(a)return _C(e,t),!0;o=!0,n=!0,i=0;break;case 39:if(s&&s===u)break;if(o)return _C(e,t),!0;a=!0,n=!0,i=1;break}}return!n&&(r===35||r===36||r===59||r===91||r===93||r===95)&&(n=!0),n?(Br.writeSafe(e,i?'"':"'"),Br.writeSafe(e,t),Br.writeSafe(e,i?'" ':"' ")):(Br.writeSafe(e,t),Br.writeSafe(e," ")),!1}function _C(e,t){Br.writeSafe(e,`
;`+t),Br.writeSafe(e,`
;
`)}function SNe(e){var t=new ArrayBuffer(wC(e)),r=new DataView(t),n=new Uint8Array(t);return EC(e,r,n,0),n}function wC(e){var t=typeof e;if(t==="string"){var r=rw(e);if(r<32)return 1+r;if(r<256)return 2+r;if(r<65536)return 3+r;if(r<4294967296)return 5+r}if(e instanceof Uint8Array){var n=e.byteLength;if(n<256)return 2+n;if(n<65536)return 3+n;if(n<4294967296)return 5+n}if(t==="number"){if(Math.floor(e)!==e)return 9;if(e>=0){if(e<128)return 1;if(e<256)return 2;if(e<65536)return 3;if(e<4294967296)return 5;throw new Error("Number too big 0x"+e.toString(16))}if(e>=-32)return 1;if(e>=-128)return 2;if(e>=-32768)return 3;if(e>=-2147483648)return 5;throw new Error("Number too small -0x"+e.toString(16).substr(1))}if(t==="boolean"||e===null||e===void 0)return 1;if(t==="object"){var i,a=0;if(Array.isArray(e)){i=e.length;for(var o=0;o<i;o++)a+=wC(e[o])}else{var s=Object.keys(e);i=s.length;for(var o=0;o<i;o++){var u=s[o];a+=wC(u)+wC(e[u])}}if(i<16)return 1+a;if(i<65536)return 3+a;if(i<4294967296)return 5+a;throw new Error("Array or object too long 0x"+i.toString(16))}throw new Error("Unknown type "+t)}function EC(e,t,r,n){var i=typeof e;if(i==="string"){var a=rw(e);if(a<32)return t.setUint8(n,a|160),hg(r,n+1,e),1+a;if(a<256)return t.setUint8(n,217),t.setUint8(n+1,a),hg(r,n+2,e),2+a;if(a<65536)return t.setUint8(n,218),t.setUint16(n+1,a),hg(r,n+3,e),3+a;if(a<4294967296)return t.setUint8(n,219),t.setUint32(n+1,a),hg(r,n+5,e),5+a}if(e instanceof Uint8Array){var o=e.byteLength,s=new Uint8Array(t.buffer);if(o<256)return t.setUint8(n,196),t.setUint8(n+1,o),s.set(e,n+2),2+o;if(o<65536)return t.setUint8(n,197),t.setUint16(n+1,o),s.set(e,n+3),3+o;if(o<4294967296)return t.setUint8(n,198),t.setUint32(n+1,o),s.set(e,n+5),5+o}if(i==="number"){if(!isFinite(e))throw new Error("Number not finite: "+e);if(Math.floor(e)!==e)return t.setUint8(n,203),t.setFloat64(n+1,e),9;if(e>=0){if(e<128)return t.setUint8(n,e),1;if(e<256)return t.setUint8(n,204),t.setUint8(n+1,e),2;if(e<65536)return t.setUint8(n,205),t.setUint16(n+1,e),3;if(e<4294967296)return t.setUint8(n,206),t.setUint32(n+1,e),5;throw new Error("Number too big 0x"+e.toString(16))}if(e>=-32)return t.setInt8(n,e),1;if(e>=-128)return t.setUint8(n,208),t.setInt8(n+1,e),2;if(e>=-32768)return t.setUint8(n,209),t.setInt16(n+1,e),3;if(e>=-2147483648)return t.setUint8(n,210),t.setInt32(n+1,e),5;throw new Error("Number too small -0x"+(-e).toString(16).substr(1))}if(e==null)return t.setUint8(n,192),1;if(i==="boolean")return t.setUint8(n,e?195:194),1;if(i==="object"){var u,l=0,c=Array.isArray(e),d=void 0;if(c?u=e.length:(d=Object.keys(e),u=d.length),u<16?(t.setUint8(n,u|(c?144:128)),l=1):u<65536?(t.setUint8(n,c?220:222),t.setUint16(n+1,u),l=3):u<4294967296&&(t.setUint8(n,c?221:223),t.setUint32(n+1,u),l=5),c)for(var f=0;f<u;f++)l+=EC(e[f],t,r,n+l);else for(var f=0,h=d.length;f<h;f++){var v=d[f];l+=EC(v,t,r,n+l),l+=EC(e[v],t,r,n+l)}return l}throw new Error("Unknown type "+i)}var CNe=function(){function e(t,r,n){this.autoClassify=n,this.dataBlocks=[],this.filter=ts.DefaultFilter,this.formatter=ts.DefaultFormatter,this.isBinary=!0,this.binaryEncodingProvider=void 0,this.binaryEncodingProvider=r,this.data={encoder:t,version:hLe,dataBlocks:this.dataBlocks}}return e.prototype.setFilter=function(t){this.filter=t||ts.DefaultFilter},e.prototype.isCategoryIncluded=function(t){return this.filter.includeCategory(t)},e.prototype.setFormatter=function(t){this.formatter=t||ts.DefaultFormatter},e.prototype.startDataBlock=function(t){this.dataBlocks.push({header:(t||"").replace(/[ \n\t]/g,"").toUpperCase(),categories:[]})},e.prototype.writeCategory=function(t,r,n){if(!this.data)throw new Error("The writer contents have already been encoded, no more writing.");if(!this.dataBlocks.length)throw new Error("No data block created.");if(!(!(n!=null&&n.ignoreFilter)&&!this.filter.includeCategory(t.name))){var i=JJ(t,r),a=i.instance,o=i.rowCount,s=i.source;if(o){for(var u={name:"_"+t.name,columns:[],rowCount:o},l=nF(a),c=0,d=l;c<d.length;c++){var f=d[c];if(this.filter.includeField(t.name,f.name)){var h=this.formatter.getFormat(t.name,f.name);u.columns.push(PNe(t.name,f,s,o,h,this.binaryEncodingProvider,this.autoClassify))}}u.columns.length&&this.dataBlocks[this.dataBlocks.length-1].categories.push(u)}}},e.prototype.encode=function(){this.encodedData||(this.encodedData=SNe(this.data),this.data=null,this.dataBlocks=null)},e.prototype.writeTo=function(t){t.writeBinary(this.encodedData)},e.prototype.getData=function(){return this.encode(),this.encodedData},e.prototype.getSize=function(){return this.encodedData.length},e}();function _Ne(e,t){return t&&t.typedArray?t.typedArray:e.defaultFormat&&e.defaultFormat.typedArray?e.defaultFormat.typedArray:e.type===0?Array:e.type===1?Int32Array:Float64Array}function wNe(e){return e===0?Mh.by(Cr.stringArray):Mh.by(Cr.byteArray)}function ENe(e,t,r,n){return r&&r.encoder?r.encoder:t.defaultFormat&&t.defaultFormat.encoder?t.defaultFormat.encoder:n?n.get(e,t.name):void 0}function ANe(e,t){return e===0?Mh.by(Cr.stringArray):e===1?MD(t):yLe(t)}function PNe(e,t,r,n,i,a,o){var s=TNe(t,_Ne(t,i),n,r),u=s.array,l=s.allPresent,c=s.mask,d=ENe(e,t,i,a);d||(o?d=ANe(t.type,u):d=wNe(t.type));var f=d.encode(u),h=void 0;if(!l){var v=Mh.by(Cr.runLength).and(Cr.byteArray).encode(c);v.data.length<c.length?h=v:h=Mh.by(Cr.byteArray).encode(c)}return{name:t.name,data:f,mask:h}}function TNe(e,t,r,n){for(var i=e.type===0,a=new t(r),o=new Uint8Array(r),s=e.valueKind,u=e.value,l=!0,c=0,d=0;d<n.length;d++)for(var f=n[d].data,h=n[d].keys();h.hasNext;){var v=h.move(),p=s?s(v,f):0;p!==0?(o[c]=p,i&&(a[c]=""),l=!1):(o[c]=0,a[c]=u(v,f,c)),c++}return{array:a,allPresent:l,mask:o}}var Vi;(function(e){e.Encoder=OD,e.Category=ts,e.Field=kD,e.Encoding=Cr;function t(u){var l=u||{},c=l.binary,d=c===void 0?!1:c,f=l.encoderName,h=f===void 0?"mol*":f;return d?new CNe(h,u?u.binaryEncodingPovider:void 0,u?!!u.binaryAutoClassifyEncoding:!1):new fNe}e.createEncoder=t;function r(){return e.Field.build()}e.fields=r;var n=e.Encoding;e.Encodings={deltaRLE:n.by(n.delta).and(n.runLength).and(n.integerPacking),fixedPoint2:n.by(n.fixedPoint(100)).and(n.delta).and(n.integerPacking),fixedPoint3:n.by(n.fixedPoint(1e3)).and(n.delta).and(n.integerPacking)};function i(u,l){return{fields:u,source:[l]}}e.categoryInstance=i;function a(u){return{get:function(l,c){var d=u.categories[l];if(d){var f=d.getField(c);return f&&f.binaryEncoding?Mh.fromEncoding(f.binaryEncoding):void 0}}}}e.createEncodingProviderFromCifFrame=a;function o(u){return{get:function(l,c){for(var d=0;d<u.length;d++){var f=u[d];if(f.categoryName===l&&f.columnName===c)return s(f)}}}}e.createEncodingProviderFromJsonConfig=o;function s(u){var l=u.precision;if(l!==void 0){var c=Math.pow(10,l),d=n.by(n.fixedPoint(c));switch(u.encoding){case"pack":return d.and(n.integerPacking);case"rle":return d.and(n.runLength).and(n.integerPacking);case"delta":return d.and(n.delta).and(n.integerPacking);case"delta-rle":return d.and(n.delta).and(n.runLength).and(n.integerPacking)}}else switch(u.encoding){case"pack":return n.by(n.integerPacking);case"rle":return n.by(n.runLength).and(n.integerPacking);case"delta":return n.by(n.delta).and(n.integerPacking);case"delta-rle":return n.by(n.delta).and(n.runLength).and(n.integerPacking)}throw new Error("cannot be reached")}})(Vi||(Vi={}));var INe={U:Sr.atom_site_anisotrop.U,U_esd:Sr.atom_site_anisotrop.U_esd},Jl;(function(e){e.Schema=INe,e.Descriptor={name:"atom_site_anisotrop",cifExport:{prefix:"",categories:[{name:"atom_site_anisotrop",instance:function(n){var i=e.Provider.get(n.firstModel);return!i||!un.is(n.firstModel.sourceData)?Vi.Category.Empty:Vi.Category.ofTable(n.firstModel.sourceData.data.db.atom_site_anisotrop)}}]}},e.Provider=Wu.create(e.Descriptor);function t(n,i){var a=new Int32Array(n.rowCount);a.fill(-1);for(var o=0,s=n.rowCount;o<s;o++)a[n.value(o)]=o;var u=new Int32Array(n.rowCount);u.fill(-1);for(var o=0,s=i.rowCount;o<s;++o){var l=a[i.value(o)];l!==-1&&(u[l]=o)}return u}e.getElementToAnsiotrop=t;function r(n,i){for(var a={},o=0,s=n.rowCount;o<s;o++)a[n.value(o)]=o;var u=new Int32Array(n.rowCount);u.fill(-1);for(var o=0,s=i.rowCount;o<s;++o){var l=a[i.value(o)];l!==void 0&&(u[l]=o)}return u}e.getElementToAnsiotropFromLabel=r})(Jl||(Jl={}));var Yb;(function(e){e.Descriptor={name:"chem_comp_bond",cifExport:{prefix:"",categories:[{name:"chem_comp_bond",instance:function(i){var a=e.Provider.get(i.firstModel);if(!a)return Vi.Category.Empty;var o=a.data;if(!o)return Vi.Category.Empty;for(var s=i.structures[0].uniqueResidueNames,u=o.comp_id,l=o._rowCount,c=[],d=0;d<l;d++)s.has(u.value(d))&&(c[c.length]=d);return Vi.Category.ofTable(o,c)}}]}},e.Provider=Wu.create(e.Descriptor);function t(i,a){return en.pick(a,Sr.chem_comp_bond,function(o){return i.properties.chemicalComponentMap.has(a.comp_id.value(o))})}e.chemCompBondFromTable=t;function r(i){var a=new Map;function o(C){if(a.has(C))return a.get(C);var w=new n(C);return a.set(C,w),w}for(var s=i.comp_id,u=i.atom_id_1,l=i.atom_id_2,c=i.value_order,d=i.pdbx_aromatic_flag,f=i._rowCount,h=o(s.value(0)),v=0;v<f;v++){var p=s.value(v),m=u.value(v),g=l.value(v),y=c.value(v),b=d.value(v)==="Y";h.id!==p&&(h=o(p));var S=1,x=1;switch(b&&(S|=16),y.toLowerCase()){case"doub":case"delo":x=2;break;case"trip":x=3;break;case"quad":x=4;break}h.add(m,g,x,S)}return a}e.getEntriesFromChemCompBond=r;var n=function(){function i(a){this.id=a,this.map=new Map}return i.prototype.add=function(a,o,s,u,l){l===void 0&&(l=!0);var c=this.map.get(a);if(c!==void 0){var d=c.get(o);d===void 0&&c.set(o,{order:s,flags:u})}else{var f=new Map;f.set(o,{order:s,flags:u}),this.map.set(a,f)}l&&this.add(o,a,s,u,!1)},i}();e.Entry=n})(Yb||(Yb={}));var MNe=new Map([["HIS|CD2|CG",2],["HIS|CE1|ND1",2],["ARG|CZ|NH2",2],["PHE|CE1|CZ",2],["PHE|CD2|CE2",2],["PHE|CD1|CG",2],["TRP|CD1|CG",2],["TRP|CD2|CE2",2],["TRP|CE3|CZ3",2],["TRP|CH2|CZ2",2],["ASN|CG|OD1",2],["GLN|CD|OE1",2],["TYR|CD1|CG",2],["TYR|CD2|CE2",2],["TYR|CE1|CZ",2],["ASP|CG|OD1",2],["GLU|CD|OE1",2],["G|C8|N7",2],["G|C4|C5",2],["G|C2|N3",2],["G|C6|O6",2],["C|C4|N3",2],["C|C5|C6",2],["C|C2|O2",2],["A|C2|N3",2],["A|C6|N1",2],["A|C4|C5",2],["A|C8|N7",2],["U|C5|C6",2],["U|C2|O2",2],["U|C4|O4",2],["DG|C8|N7",2],["DG|C4|C5",2],["DG|C2|N3",2],["DG|C6|O6",2],["DC|C4|N3",2],["DC|C5|C6",2],["DC|C2|O2",2],["DA|C2|N3",2],["DA|C6|N1",2],["DA|C4|C5",2],["DA|C8|N7",2],["DT|C5|C6",2],["DT|C2|O2",2],["DT|C4|O4",2]]);function DNe(e,t,r){var n;return n=t<r?[t,r]:[r,t],t=n[0],r=n[1],qE.has(e)&&t==="C"&&r==="O"||XE.has(e)&&t==="OP1"&&r==="P"?2:MNe.get(e+"|"+t+"|"+r)||1}var RNe=new Map([["LYS|NZ|RET|C15",2]]);function ree(e,t,r,n){var i,a;return e>r&&(i=[r,e],e=i[0],r=i[1],a=[n,t],t=a[0],n=a[1]),RNe.get(e+"|"+t+"|"+r+"|"+n)||1}var ec;(function(e){e.Descriptor={name:"struct_conn",cifExport:{prefix:"",categories:[{name:"struct_conn",instance:function(a){var o=e.Provider.get(a.firstModel);if(!o||o.entries.length===0)return Vi.Category.Empty;for(var s=a.structures[0],u=[],l=0,c=o.entries;l<c.length;l++){var d=c[l];r(s,d.partnerA.atomIndex)&&r(s,d.partnerB.atomIndex)&&(u[u.length]=d.rowIndex)}return Vi.Category.ofTable(o.data,u)}}]}},e.Provider=Wu.create(e.Descriptor);function t(a){var o=e.Provider.get(a);return!!o&&o.data.id.rowCount/a.atomicConformation.atomId.rowCount>.95}e.isExhaustive=t;function r(a,o){for(var s=a.units,u=0,l=s.length;u<l;u++)if(Je.indexOf(s[u].elements,o)>=0)return!0;return!1}function n(a){for(var o=new Map,s=0,u=a;s<u.length;s++){var l=u[s],c=l.partnerA.atomIndex,d=l.partnerB.atomIndex;o.has(c)?o.get(c).push(l):o.set(c,[l]),o.has(d)?o.get(d).push(l):o.set(d,[l])}return o}e.getAtomIndexFromEntries=n;function i(a,o){for(var s=a.conn_type_id,u=a.pdbx_dist_value,l=a.pdbx_value_order,c={label_asym_id:a.ptnr1_label_asym_id,label_seq_id:a.ptnr1_label_seq_id,auth_seq_id:a.ptnr1_auth_seq_id,label_atom_id:a.ptnr1_label_atom_id,label_alt_id:a.pdbx_ptnr1_label_alt_id,ins_code:a.pdbx_ptnr1_PDB_ins_code,symmetry:a.ptnr1_symmetry},d={label_asym_id:a.ptnr2_label_asym_id,label_seq_id:a.ptnr2_label_seq_id,auth_seq_id:a.ptnr2_auth_seq_id,label_atom_id:a.ptnr2_label_atom_id,label_alt_id:a.pdbx_ptnr2_label_alt_id,ins_code:a.pdbx_ptnr2_PDB_ins_code,symmetry:a.ptnr2_symmetry},f=function(x,C){if(C.label_asym_id.valueKind(x)===0){var w=C.label_asym_id.value(x),A=o.atomicHierarchy.index.findEntity(w);if(!(A<0)){var M=o.atomicHierarchy.index.findResidue(o.entities.data.id.value(A),w,C.auth_seq_id.value(x),C.ins_code.value(x));if(!(M<0)){var D=C.label_atom_id.value(x);if(D){var k=o.atomicHierarchy.index.findAtomOnResidue(M,D,C.label_alt_id.value(x));if(!(k<0))return{residueIndex:M,atomIndex:k,symmetry:C.symmetry.value(x)}}}}}},h=[],v=0;v<a._rowCount;v++){var p=f(v,c),m=f(v,d);if(!(p===void 0||m===void 0)){var g=s.value(v),y=(l.value(v)||"").toLowerCase(),b=0,S=1;switch(y){case"sing":S=1;break;case"doub":S=2;break;case"trip":S=3;break;case"quad":S=4;break;default:S=ree(a.ptnr1_label_comp_id.value(v),a.ptnr1_label_atom_id.value(v),a.ptnr2_label_comp_id.value(v),a.ptnr2_label_atom_id.value(v))}switch(g){case"covale":b=1;break;case"disulf":b=9;break;case"hydrog":b=4;break;case"metalc":b=2;break}h.push({rowIndex:v,flags:b,order:S,distance:u.value(v),partnerA:p,partnerB:m})}}return h}e.getEntriesFromStructConn=i})(ec||(ec={}));var iv;(function(e){var t,r="molstar_global_model_transform_info";e.Schema=(t={},t[r]={matrix:ve.Schema.Matrix(4,4,ve.Schema.float)},t),e.Descriptor=ko({name:r,cifExport:{categories:[{name:r,instance:function(u){var l=i(u.firstModel);if(!l)return Vi.Category.Empty;var c=en.ofRows(e.Schema.molstar_global_model_transform_info,[{matrix:l}]);return Vi.Category.ofTable(c)}}],prefix:"molstar"}}),e.Provider=Wu.create(e.Descriptor);function n(u,l){u.customProperties.has(e.Descriptor)||u.customProperties.add(e.Descriptor),e.Provider.set(u,l)}e.attach=n;function i(u){return e.Provider.get(u)}e.get=i;function a(u){if(un.is(u.sourceData)){var l=u.sourceData.data.frame.categories[r];if(l){var c=XJ(e.Schema[r],l);if(c._rowCount!==0)return c.matrix.value(0)}}}e.fromMmCif=a;function o(u){if(!un.is(u.sourceData))return!1;var l=u.sourceData.data.frame.categories[r];return!!l&&l.rowCount>0}e.hasData=o;function s(u,l){u.writeCategory({name:r,instance:function(){var c=en.ofRows(e.Schema.molstar_global_model_transform_info,[{matrix:l}]);return Vi.Category.ofTable(c)}})}e.writeMmCif=s})(iv||(iv={}));function kNe(e){if(un.is(e.sourceData))return vi.fromData(e.sourceData.data.db)}vi.Provider.formatRegistry.add("mmCIF",kNe);function ONe(e){if(un.is(e.sourceData)){var t=e.sourceData.data.db,r=t.struct_conf,n=t.struct_sheet_range;return Xb.fromStruct(r,n,e.atomicHierarchy)}}Xb.Provider.formatRegistry.add("mmCIF",ONe);function FNe(e){if(un.is(e.sourceData)){var t=e.sourceData.data.db.atom_site_anisotrop,r=en.ofColumns(Jl.Schema,t),n=Jl.getElementToAnsiotrop(e.atomicConformation.atomId,t.id);return{data:r,elementToAnsiotrop:n}}}function LNe(e){return un.is(e.sourceData)?e.sourceData.data.db.atom_site_anisotrop.U.isDefined:!1}Jl.Provider.formatRegistry.add("mmCIF",FNe,LNe);function NNe(e){if(un.is(e.sourceData)){var t=e.sourceData.data.db.chem_comp_bond;if(t._rowCount!==0)return{data:t,entries:Yb.getEntriesFromChemCompBond(t)}}}Yb.Provider.formatRegistry.add("mmCIF",NNe);function BNe(e){if(un.is(e.sourceData)){var t=e.sourceData.data.db.struct_conn;if(t._rowCount!==0){var r=ec.getEntriesFromStructConn(t,e);return{data:t,byAtomIndex:ec.getAtomIndexFromEntries(r),entries:r}}}}ec.Provider.formatRegistry.add("mmCIF",BNe);iv.Provider.formatRegistry.add("mmCIF",iv.fromMmCif,iv.hasData);var un;(function(e){function t(n){return(n==null?void 0:n.kind)==="mmCIF"}e.is=t;function r(n,i,a){return i||(i=vd.schema.mmCIF(n)),{kind:"mmCIF",name:i._name,data:{db:i,frame:n,source:a}}}e.fromFrame=r})(un||(un={}));function nee(e){var t=un.fromFrame(e);return $e.create("Create mmCIF Model",function(r){return Od(t.data.db,t,r)})}var Ze;(function(e){function t(f,h,v){return{kind:"element-location",structure:f,unit:h,element:v||0}}e.create=t;function r(f){return t(f.structure,f.unit,f.element)}e.clone=r;function n(f,h,v,p){return h&&(f.structure=h),v&&(f.unit=v),p!==void 0&&(f.element=p),f}e.set=n;function i(f,h){return f.unit=h.unit,f.element=h.element,f}e.copy=i;function a(f){return!!f&&f.kind==="element-location"}e.is=a;function o(f,h){return f.unit===h.unit&&f.element===h.element}e.areEqual=o;var s=_.zero(),u=_.zero();function l(f,h){return f.unit.conformation.position(f.element,s),h.unit.conformation.position(h.element,u),_.distance(s,u)}e.distance=l;function c(f){return f.unit.model.atomicHierarchy.residueAtomSegments.index[f.element]}e.residueIndex=c;function d(f){return f.unit.model.atomicHierarchy.chainAtomSegments.index[f.element]}e.chainIndex=d})(Ze||(Ze={}));var De;(function(e){function t(s,u,l){return{kind:"variable",name:s,type:u,isConstraint:l}}e.Variable=t;function r(s,u,l){return{kind:"value",namespace:s,name:u,parent:l}}e.Value=r;function n(s,u,l,c){return{kind:"container",namespace:s,name:u,child:l,alias:c}}e.Container=n;function i(s){return{kind:"union",types:s}}e.Union=i;function a(s,u,l,c){for(var d=Object.create(null),f=0,h=c;f<h.length;f++){var v=h[f];d[v]=!0}return{kind:"oneof",namespace:s,name:u,type:l,values:d}}e.OneOf=a,e.Any={kind:"any"},e.AnyValue={kind:"any-value"},e.Num=r("","Number"),e.Str=r("","String"),e.Bool=a("","Bool",e.Str,["true","false"]);function o(s){var u=s.values;return Object.keys(u).sort()}e.oneOfValues=o})(De||(De={}));var Ri;(function(e){function t(u){return{name:u}}e.Symbol=t;function r(u,l){return l?{head:u,args:l}:{head:u}}e.Apply=r;function n(u){return!!u&&Array.isArray(u)}e.isArgumentsArray=n;function i(u){return!!u&&!Array.isArray(u)}e.isArgumentsMap=i;function a(u){return!o(u)&&!s(u)}e.isLiteral=a;function o(u){return!!u&&!!u.head&&typeof u=="object"}e.isApply=o;function s(u){return!!u&&typeof u.name=="string"}e.isSymbol=s})(Ri||(Ri={}));function vt(e,t){var r=t||{},n=r.description,i=n===void 0?void 0:n,a=r.isOptional,o=a===void 0?!1:a,s=r.isRest,u=s===void 0?!1:s,l=r.defaultValue,c=l===void 0?void 0:l;return{type:e,isOptional:o,isRest:u,defaultValue:c,description:i}}var Rt;(function(e){e.None=t({});function t(n){return{kind:"dictionary",map:n,"@type":0}}e.Dictionary=t;function r(n,i){var a=(i||{}).nonEmpty,o=a===void 0?!1:a;return{kind:"list",type:n,nonEmpty:o,"@type":0}}e.List=r})(Rt||(Rt={}));function p1(e,t,r,n){var i=function(a){return Ri.Apply(Ri.Symbol(i.id),a)};return i.info={namespace:"",name:e,description:n},i.id="",i.args=t,i.type=r,i}function aj(e,t,r,n){var i=function(a){return Ri.Apply(Ri.Symbol(i.id),a)};return i.info={namespace:e,name:t,description:n},i.id=e+"."+t,i.args=Rt.None,i.type=r,i}function vw(e){var t=e;return typeof t=="function"&&!!t.info&&!!t.args&&typeof t.info.namespace=="string"&&!!t.type}function Bt(e,t,r){return p1("",e,t,r)}function iee(e){oee("","",e)}function aee(e){var t=[];return see(e,t),t}function oj(e){var t=/([a-z])([A-Z])([a-z]|$)/g;return e.replace(t,function(r,n,i,a){return n+"-"+i.toLocaleLowerCase()+a}).replace(t,function(r,n,i,a){return n+"-"+i.toLocaleLowerCase()+a})}function oee(e,t,r){if(vw(r)){r.info.namespace=e,r.info.name=r.info.name||oj(t),r.id=r.info.namespace+"."+r.info.name;return}for(var n=""+(r["@namespace"]||oj(t)),i=e?e+"."+n:n,a=0,o=Object.keys(r);a<o.length;a++){var s=o[a];typeof r[s]!="object"&&!vw(r[s])||oee(i,s,r[s])}}function see(e,t){if(vw(e)){t.push(e);return}for(var r=0,n=Object.keys(e);r<n.length;r++){var i=n[r];typeof e[i]!="object"&&!vw(e[i])||see(e[i],t)}}var Tr;(function(e){e.AnyVar=De.Variable("a",De.Any),e.AnyValueVar=De.Variable("a",De.Any),e.ConstrainedVar=De.Variable("a",De.Any,!0),e.Regex=De.Value("Core","Regex"),e.Set=function(t){return De.Container("Core","Set",t||e.AnyValueVar)},e.List=function(t){return De.Container("Core","List",t||e.AnyVar)},e.Fn=function(t,r){return De.Container("Core","Fn",t||e.AnyVar,r)},e.Flags=function(t,r){return De.Container("Core","Flags",t,r)},e.BitFlags=e.Flags(De.Num,"BitFlags")})(Tr||(Tr={}));function Gi(e,t){return Bt(Rt.Dictionary({0:vt(e)}),e,t)}function Uf(e,t){return Bt(Rt.List(e,{nonEmpty:!0}),e,t)}function Ml(e,t,r){return Bt(Rt.Dictionary({0:vt(e),1:vt(e)}),t,r)}Rt.Dictionary({0:vt(De.Num),1:vt(De.Num)});vt(De.Str);var UNe={"@header":"Types",bool:Bt(Rt.Dictionary({0:vt(De.AnyValue)}),De.Bool,"Convert a value to boolean."),num:Bt(Rt.Dictionary({0:vt(De.AnyValue)}),De.Num,"Convert a value to number."),str:Bt(Rt.Dictionary({0:vt(De.AnyValue)}),De.Str,"Convert a value to string."),regex:Bt(Rt.Dictionary({0:vt(De.Str,{description:"Expression"}),1:vt(De.Str,{isOptional:!0,description:"Flags, e.g. 'i' for ignore case"})}),Tr.Regex,"Creates a regular expression from a string using the ECMAscript syntax."),list:Bt(Rt.List(Tr.AnyVar),Tr.List()),set:Bt(Rt.List(Tr.AnyValueVar),Tr.Set()),bitflags:Bt(Rt.Dictionary({0:vt(De.Num)}),Tr.BitFlags,"Interpret a number as bitflags."),compositeKey:Bt(Rt.List(De.AnyValue),De.AnyValue)},jNe={"@header":"Logic",not:Gi(De.Bool),and:Uf(De.Bool),or:Uf(De.Bool)},zNe={"@header":"Control",eval:Bt(Rt.Dictionary({0:vt(Tr.Fn(Tr.AnyVar))}),Tr.AnyVar,"Evaluate a function."),fn:Bt(Rt.Dictionary({0:vt(Tr.AnyVar)}),Tr.Fn(Tr.AnyVar),'Wrap an expression to a "lazy" function.'),if:Bt(Rt.Dictionary({0:vt(De.Bool,{description:"Condition"}),1:vt(De.Variable("a",De.Any),{description:"If true"}),2:vt(De.Variable("b",De.Any),{description:"If false"})}),De.Union([De.Variable("a",De.Any),De.Variable("b",De.Any)])),assoc:Bt(Rt.Dictionary({0:vt(De.Str,{description:"Name"}),1:vt(De.Variable("a",De.Any),{description:"Value to assign"})}),De.Variable("a",De.Any))},VNe={"@header":"Relational",eq:Ml(De.Variable("a",De.AnyValue,!0),De.Bool),neq:Ml(De.Variable("a",De.AnyValue,!0),De.Bool),lt:Ml(De.Num,De.Bool),lte:Ml(De.Num,De.Bool),gr:Ml(De.Num,De.Bool),gre:Ml(De.Num,De.Bool),inRange:Bt(Rt.Dictionary({0:vt(De.Num,{description:"Value to test"}),1:vt(De.Num,{description:"Minimum value"}),2:vt(De.Num,{description:"Maximum value"})}),De.Bool,"Check if the value of the 1st argument is >= 2nd and <= 3rd.")},HNe={"@header":"Math",add:Uf(De.Num),sub:Uf(De.Num),mult:Uf(De.Num),div:Ml(De.Num,De.Num),pow:Ml(De.Num,De.Num),mod:Ml(De.Num,De.Num),min:Uf(De.Num),max:Uf(De.Num),floor:Gi(De.Num),ceil:Gi(De.Num),roundInt:Gi(De.Num),abs:Gi(De.Num),sqrt:Gi(De.Num),cbrt:Gi(De.Num),sin:Gi(De.Num),cos:Gi(De.Num),tan:Gi(De.Num),asin:Gi(De.Num),acos:Gi(De.Num),atan:Gi(De.Num),sinh:Gi(De.Num),cosh:Gi(De.Num),tanh:Gi(De.Num),exp:Gi(De.Num),log:Gi(De.Num),log10:Gi(De.Num),atan2:Ml(De.Num,De.Num)},GNe={"@header":"Strings",concat:Uf(De.Str),match:Bt(Rt.Dictionary({0:vt(Tr.Regex),1:vt(De.Str)}),De.Bool)},qNe={"@header":"Lists",getAt:Bt(Rt.Dictionary({0:vt(Tr.List()),1:vt(De.Num)}),Tr.AnyVar),equal:Bt(Rt.Dictionary({0:vt(Tr.List()),1:vt(Tr.List())}),De.Bool)},$Ne={"@header":"Sets",has:Bt(Rt.Dictionary({0:vt(Tr.Set(Tr.ConstrainedVar)),1:vt(Tr.ConstrainedVar)}),De.Bool,"Check if the the 1st argument includes the value of the 2nd."),isSubset:Bt(Rt.Dictionary({0:vt(Tr.Set(Tr.ConstrainedVar)),1:vt(Tr.Set(Tr.ConstrainedVar))}),De.Bool,"Check if the the 1st argument is a subset of the 2nd.")},WNe={"@header":"Flags",hasAny:Bt(Rt.Dictionary({0:vt(Tr.Flags(Tr.ConstrainedVar)),1:vt(Tr.Flags(Tr.ConstrainedVar))}),De.Bool,"Check if the the 1st argument has at least one of the 2nd one's flags."),hasAll:Bt(Rt.Dictionary({0:vt(Tr.Flags(Tr.ConstrainedVar)),1:vt(Tr.Flags(Tr.ConstrainedVar))}),De.Bool,"Check if the the 1st argument has all 2nd one's flags.")},iF={"@header":"Language Primitives",type:UNe,logic:jNe,ctrl:zNe,rel:VNe,math:HNe,str:GNe,list:qNe,set:$Ne,flags:WNe};iee(iF);var XNe=aee(iF);(function(){for(var e=Object.create(null),t=0,r=XNe;t<r.length;t++){var n=r[t];e[n.id]=n}return e})();var At;(function(e){e.ElementSymbol=De.Value("Structure","ElementSymbol"),e.AtomName=De.Value("Structure","AtomName"),e.BondFlag=De.OneOf("Structure","BondFlag",De.Str,["covalent","metallic","ion","hydrogen","sulfide","computed","aromatic"]),e.BondFlags=Tr.Flags(e.BondFlag,"BondFlags"),e.SecondaryStructureFlag=De.OneOf("Structure","SecondaryStructureFlag",De.Str,["alpha","beta","3-10","pi","sheet","strand","helix","turn","none"]),e.SecondaryStructureFlags=Tr.Flags(e.SecondaryStructureFlag,"SecondaryStructureFlag"),e.RingFingerprint=De.Value("Structure","RingFingerprint"),e.EntityType=De.OneOf("Structure","EntityType",De.Str,["polymer","non-polymer","water","branched"]),e.EntitySubtype=De.OneOf("Structure","EntitySubtype",De.Str,["other","polypeptide(D)","polypeptide(L)","polydeoxyribonucleotide","polyribonucleotide","polydeoxyribonucleotide/polyribonucleotide hybrid","cyclic-pseudo-peptide","peptide nucleic acid","oligosaccharide"]),e.ObjectPrimitive=De.OneOf("Structure","ObjectPrimitive",De.Str,["atomistic","sphere","gaussian","other"]),e.ResidueId=De.Value("Structure","ResidueId"),e.ElementSet=De.Value("Structure","ElementSet"),e.ElementSelection=De.Value("Structure","ElementSelection"),e.ElementReference=De.Value("Structure","ElementReference"),e.ElementSelectionQuery=Tr.Fn(e.ElementSelection,"ElementSelectionQuery")})(At||(At={}));var YNe={"@header":"Types",elementSymbol:Bt(Rt.Dictionary({0:vt(De.Str)}),At.ElementSymbol,"Create element symbol representation from a string value."),atomName:Bt(Rt.Dictionary({0:vt(De.AnyValue)}),At.AtomName,"Convert a value to an atom name."),entityType:Bt(Rt.Dictionary({0:vt(At.EntityType)}),At.EntityType,"Create normalized representation of entity type: "+De.oneOfValues(At.EntityType).join(", ")+"."),bondFlags:Bt(Rt.List(At.BondFlag),At.BondFlags,"Create bond flags representation from a list of strings. Allowed flags: "+De.oneOfValues(At.BondFlag).join(", ")+"."),ringFingerprint:Bt(Rt.List(At.ElementSymbol,{nonEmpty:!0}),At.RingFingerprint,"Create ring fingerprint from the supplied atom element list."),secondaryStructureFlags:Bt(Rt.List(At.SecondaryStructureFlag),At.SecondaryStructureFlags,"Create secondary structure flags representation from a list of strings. Allowed flags: "+De.oneOfValues(At.SecondaryStructureFlag).join(", ")+"."),authResidueId:Bt(Rt.Dictionary({0:vt(De.Str,{description:"auth_asym_id"}),1:vt(De.Num,{description:"auth_seq_id"}),2:vt(De.Str,{description:"pdbx_PDB_ins_code",isOptional:!0})}),At.ResidueId,'Residue identifier based on "auth_" annotation.'),labelResidueId:Bt(Rt.Dictionary({0:vt(De.Str,{description:"label_entity_id"}),1:vt(De.Str,{description:"label_asym_id"}),2:vt(De.Num,{description:"label_seq_id"}),3:vt(De.Str,{description:"pdbx_PDB_ins_code",isOptional:!0})}),At.ResidueId,`Residue identifier based on mmCIF's "label_" annotation.`)},KNe={"@header":"Iteration Slots",element:Bt(Rt.None,At.ElementReference,"A reference to the current element."),elementSetReduce:Bt(Rt.None,De.Variable("a",De.AnyValue,!0),"Current value of the element set reducer.")},QNe={"@header":"Generators",all:Bt(Rt.None,At.ElementSelectionQuery,"The entire structure."),atomGroups:Bt(Rt.Dictionary({"entity-test":vt(De.Bool,{isOptional:!0,defaultValue:!0,description:"Test for the 1st atom of every entity"}),"chain-test":vt(De.Bool,{isOptional:!0,defaultValue:!0,description:"Test for the 1st atom of every chain"}),"residue-test":vt(De.Bool,{isOptional:!0,defaultValue:!0,description:"Test for the 1st atom every residue"}),"atom-test":vt(De.Bool,{isOptional:!0,defaultValue:!0}),"group-by":vt(De.Any,{isOptional:!0,defaultValue:"atom-key",description:"Group atoms to sets based on this property. Default: each atom has its own set"})}),At.ElementSelectionQuery,"Return all atoms for which the tests are satisfied, grouped into sets."),bondedAtomicPairs:Bt(Rt.Dictionary({0:vt(De.Bool,{isOptional:!0,defaultValue:"true for covalent bonds",description:"Test each bond with this predicate. Each bond is visited twice with swapped atom order."})}),At.ElementSelectionQuery,"Return all pairs of atoms for which the test is satisfied."),rings:Bt(Rt.Dictionary({fingerprint:vt(At.RingFingerprint,{isOptional:!0}),"only-aromatic":vt(De.Bool,{isOptional:!0,defaultValue:!1})}),At.ElementSelectionQuery,"Return all rings or those with the specified fingerprint and/or only aromatic rings."),queryInSelection:Bt(Rt.Dictionary({0:vt(At.ElementSelectionQuery),query:vt(At.ElementSelectionQuery),"in-complement":vt(De.Bool,{isOptional:!0,defaultValue:!1})}),At.ElementSelectionQuery,"Executes query only on atoms that are in the source selection."),empty:Bt(Rt.None,At.ElementSelectionQuery,"Nada.")},ZNe={"@header":"Selection Modifications",queryEach:Bt(Rt.Dictionary({0:vt(At.ElementSelectionQuery),query:vt(At.ElementSelectionQuery)}),At.ElementSelectionQuery,"Query every atom set in the input selection separately."),intersectBy:Bt(Rt.Dictionary({0:vt(At.ElementSelectionQuery),by:vt(At.ElementSelectionQuery)}),At.ElementSelectionQuery,"Intersect each atom set from the first sequence from atoms in the second one."),exceptBy:Bt(Rt.Dictionary({0:vt(At.ElementSelectionQuery),by:vt(At.ElementSelectionQuery)}),At.ElementSelectionQuery,"Remove all atoms from 'selection' that occur in 'by'."),unionBy:Bt(Rt.Dictionary({0:vt(At.ElementSelectionQuery),by:vt(At.ElementSelectionQuery)}),At.ElementSelectionQuery,"For each atom set A in the orginal sequence, combine all atoms sets in the target selection that intersect with A."),union:Bt(Rt.Dictionary({0:vt(At.ElementSelectionQuery)}),At.ElementSelectionQuery,"Collects all atom sets in the sequence into a single atom set."),cluster:Bt(Rt.Dictionary({0:vt(At.ElementSelectionQuery),"min-distance":vt(De.Num,{isOptional:!0,defaultValue:0}),"max-distance":vt(De.Num),"min-size":vt(De.Num,{description:"Minimal number of sets to merge, must be at least 2",isOptional:!0,defaultValue:2}),"max-size":vt(De.Num,{description:"Maximal number of sets to merge, if not set, no limit",isOptional:!0})}),At.ElementSelectionQuery,"Combines atom sets that have mutual distance in the interval [min-radius, max-radius]. Minimum/maximum size determines how many atom sets can be combined."),includeSurroundings:Bt(Rt.Dictionary({0:vt(At.ElementSelectionQuery),radius:vt(De.Num),"atom-radius":vt(De.Num,{isOptional:!0,defaultValue:0,description:"Value added to each atom before the distance check, for example VDW radius. Using this argument is computationally demanding."}),"as-whole-residues":vt(De.Bool,{isOptional:!0})}),At.ElementSelectionQuery,"For each atom set in the selection, include all surrouding atoms/residues that are within the specified radius."),surroundingLigands:Bt(Rt.Dictionary({0:vt(At.ElementSelectionQuery),radius:vt(De.Num),"include-water":vt(De.Bool,{isOptional:!0,defaultValue:!0})}),At.ElementSelectionQuery,"Find all ligands components around the source query."),includeConnected:Bt(Rt.Dictionary({0:vt(At.ElementSelectionQuery),"bond-test":vt(De.Bool,{isOptional:!0,defaultValue:"true for covalent bonds"}),"layer-count":vt(De.Num,{isOptional:!0,defaultValue:1,description:"Number of bonded layers to include."}),"fixed-point":vt(De.Bool,{isOptional:!0,defaultValue:!1,description:"Continue adding layers as long as new connections exist."}),"as-whole-residues":vt(De.Bool,{isOptional:!0})}),At.ElementSelectionQuery,"Pick all atom sets that are connected to the target."),wholeResidues:Bt(Rt.Dictionary({0:vt(At.ElementSelectionQuery)}),At.ElementSelectionQuery,"Expand the selection to whole residues."),expandProperty:Bt(Rt.Dictionary({0:vt(At.ElementSelectionQuery),property:vt(De.AnyValue)}),At.ElementSelectionQuery,"To each atom set in the selection, add all atoms that have the same property value that was already present in the set.")},JNe={"@header":"Selection Filters",pick:Bt(Rt.Dictionary({0:vt(At.ElementSelectionQuery),test:vt(De.Bool)}),At.ElementSelectionQuery,"Pick all atom sets that satisfy the test."),first:Bt(Rt.Dictionary({0:vt(At.ElementSelectionQuery)}),At.ElementSelectionQuery,"Take the 1st atom set in the sequence."),withSameAtomProperties:Bt(Rt.Dictionary({0:vt(At.ElementSelectionQuery),source:vt(At.ElementSelectionQuery),property:vt(De.Any)}),At.ElementSelectionQuery,"Pick all atom sets for which the set of given atom properties is a subset of the source properties."),intersectedBy:Bt(Rt.Dictionary({0:vt(At.ElementSelectionQuery),by:vt(At.ElementSelectionQuery)}),At.ElementSelectionQuery,"Pick all atom sets that have non-zero intersection with the target."),within:Bt(Rt.Dictionary({0:vt(At.ElementSelectionQuery),target:vt(At.ElementSelectionQuery),"min-radius":vt(De.Num,{isOptional:!0,defaultValue:0}),"max-radius":vt(De.Num),"atom-radius":vt(De.Num,{isOptional:!0,defaultValue:0,description:"Value added to each atom before the distance check, for example VDW radius. Using this argument is computationally demanding."}),invert:vt(De.Bool,{isOptional:!0,defaultValue:!1,description:"If true, pick only atom sets that are further than the specified radius."})}),At.ElementSelectionQuery,"Pick all atom sets from selection that have any atom within the radius of any atom from target."),isConnectedTo:Bt(Rt.Dictionary({0:vt(At.ElementSelectionQuery),target:vt(At.ElementSelectionQuery),"bond-test":vt(De.Bool,{isOptional:!0,defaultValue:"true for covalent bonds"}),disjunct:vt(De.Bool,{isOptional:!0,defaultValue:!0,description:"If true, there must exist a bond to an atom that lies outside the given atom set to pass test."}),invert:vt(De.Bool,{isOptional:!0,defaultValue:!1,description:"If true, return atom sets that are not connected."})}),At.ElementSelectionQuery,"Pick all atom sets that are connected to the target.")},e8e={"@header":"Selection Combinators",intersect:Bt(Rt.List(At.ElementSelectionQuery),At.ElementSelectionQuery,"Return all unique atom sets that appear in all of the source selections."),merge:Bt(Rt.List(At.ElementSelectionQuery),At.ElementSelectionQuery,"Merges multiple selections into a single one. Only unique atom sets are kept."),distanceCluster:Bt(Rt.Dictionary({matrix:vt(Tr.List(Tr.List(De.Num)),{description:"Distance matrix, represented as list of rows (num[][])). Lower triangle is min distance, upper triangle is max distance."}),selections:vt(Tr.List(At.ElementSelectionQuery),{description:"A list of held selections."})}),At.ElementSelectionQuery,"Pick combinations of atom sets from the source sequences that are mutually within distances specified by a matrix.")},t8e={"@header":"Atom Sets",atomCount:Bt(Rt.None,De.Num),countQuery:Bt(Rt.Dictionary({0:vt(At.ElementSelectionQuery)}),De.Num,"Counts the number of occurences of a specific query inside the current atom set."),reduce:Bt(Rt.Dictionary({initial:vt(De.Variable("a",De.AnyValue,!0),{description:"Initial value assigned to slot.atom-set-reduce. Current atom is set to the 1st atom of the current set for this."}),value:vt(De.Variable("a",De.AnyValue,!0),{description:"Expression executed for each atom in the set"})}),De.Variable("a",De.AnyValue,!0),"Execute the value expression for each atom in the current atom set and return the result. Works the same way as Array.reduce in JavaScript (``result = value(value(...value(initial)))``)"),propertySet:Bt(Rt.Dictionary({0:vt(Tr.ConstrainedVar)}),Tr.Set(Tr.ConstrainedVar),"Returns a set with all values of the given property in the current atom set.")},r8e={"@header":"Atom Properties",core:{"@header":"Core Properties",elementSymbol:Er(At.ElementSymbol),vdw:Er(De.Num,"Van der Waals radius"),mass:Er(De.Num,"Atomic weight"),atomicNumber:Er(De.Num,"Atomic number"),x:Er(De.Num,"Cartesian X coordinate"),y:Er(De.Num,"Cartesian Y coordinate"),z:Er(De.Num,"Cartesian Z coordinate"),atomKey:Er(De.AnyValue,"Unique value for each atom. Main use case is grouping of atoms."),bondCount:Bt(Rt.Dictionary({0:vt(At.ElementReference,{isOptional:!0,defaultValue:"slot.current-atom"}),flags:vt(At.BondFlags,{isOptional:!0,defaultValue:"covalent"})}),De.Num,"Number of bonds (by default only covalent bonds are counted)."),sourceIndex:Er(De.Num,"Index of the atom/element in the input file."),operatorName:Er(De.Str,"Name of the symmetry operator applied to this element."),modelIndex:Er(De.Num,"Index of the model in the input file."),modelLabel:Er(De.Str,"Label/header of the model in the input file.")},topology:{connectedComponentKey:Er(De.AnyValue,"Unique value for each connected component.")},macromolecular:{"@header":"Macromolecular Properties (derived from the mmCIF format)",authResidueId:Er(At.ResidueId,"type.auth-residue-id symbol executed on current atom's residue"),labelResidueId:Er(At.ResidueId,"type.label-residue-id symbol executed on current atom's residue"),residueKey:Er(De.AnyValue,"Unique value for each tuple ``(label_entity_id,auth_asym_id, auth_seq_id, pdbx_PDB_ins_code)``, main use case is grouping of atoms"),chainKey:Er(De.AnyValue,"Unique value for each tuple ``(label_entity_id, auth_asym_id)``, main use case is grouping of atoms"),entityKey:Er(De.AnyValue,"Unique value for each tuple ``label_entity_id``, main use case is grouping of atoms"),isHet:Er(De.Bool,"Equivalent to atom_site.group_PDB !== ATOM"),id:Er(De.Num,"_atom_site.id"),label_atom_id:Er(At.AtomName),label_alt_id:Er(De.Str),label_comp_id:Er(De.Str),label_asym_id:Er(De.Str),label_entity_id:Er(De.Str),label_seq_id:Er(De.Num),auth_atom_id:Er(At.AtomName),auth_comp_id:Er(De.Str),auth_asym_id:Er(De.Str),auth_seq_id:Er(De.Num),pdbx_PDB_ins_code:Er(De.Str),pdbx_formal_charge:Er(De.Num),occupancy:Er(De.Num),B_iso_or_equiv:Er(De.Num),entityType:Er(At.EntityType,"Type of the entity as defined in mmCIF (polymer, non-polymer, branched, water)"),entitySubtype:Er(At.EntitySubtype,"Subtype of the entity as defined in mmCIF _entity_poly.type and _pdbx_entity_branch.type (other, polypeptide(D), polypeptide(L), polydeoxyribonucleotide, polyribonucleotide, polydeoxyribonucleotide/polyribonucleotide hybrid, cyclic-pseudo-peptide, peptide nucleic acid, oligosaccharide)"),entityPrdId:Er(De.Str,"The PRD ID of the entity."),entityDescription:Er(Tr.List(De.Str)),objectPrimitive:Er(At.ObjectPrimitive,"Type of the primitive object used to model this segment as defined in mmCIF/IHM (atomistic, sphere, gaussian, other)"),secondaryStructureKey:Er(De.AnyValue,"Unique value for each secondary structure element."),secondaryStructureFlags:Er(At.SecondaryStructureFlags),isModified:Er(De.Bool,"True if the atom belongs to modification of a standard residue."),modifiedParentName:Er(De.Str,"'3-letter' code of the modifed parent residue."),isNonStandard:Er(De.Bool,"True if this is a non-standard residue."),chemCompType:Er(De.Str,"Type of the chemical component as defined in mmCIF.")}},n8e={"@header":"Bond Properties",flags:My(At.BondFlags),order:My(De.Num),length:My(De.Num),atomA:My(At.ElementReference),atomB:My(At.ElementReference)};function Er(e,t){return Bt(Rt.Dictionary({0:vt(At.ElementReference,{isOptional:!0,defaultValue:"slot.current-atom"})}),e,t)}function My(e,t){return Bt(Rt.None,e,t)}var i8e={"@header":"Structure Queries",type:YNe,slot:KNe,generator:QNe,modifier:ZNe,filter:JNe,combinator:e8e,atomSet:t8e,atomProperty:r8e,bondProperty:n8e},a8e={"@header":"Generators",bundleElement:Bt(Rt.Dictionary({groupedUnits:vt(De.Any),set:vt(De.Any),ranges:vt(De.Any)}),De.Any),bundle:Bt(Rt.Dictionary({elements:vt(De.Any)}),At.ElementSelectionQuery,"A selection with single structure containing represented by the bundle."),current:Bt(Rt.None,At.ElementSelectionQuery,"Current selection provided by the query context. Avoid using this in State Transforms.")},o8e={"@header":"Internal Queries",generator:a8e},Ce={core:iF,structureQuery:i8e,internal:o8e};iee(Ce);var s8e=aee(Ce);(function(){for(var e=Object.create(null),t=0,r=s8e;t<r.length;t++){var n=r[t];e[n.id]=n}return e})();var se;(function(e){e.core=Ce.core,e.struct=Ce.structureQuery,e.internal=Ce.internal;function t(y){return e.struct.type.atomName([y])}e.atomName=t;function r(y){return e.struct.type.elementSymbol([y])}e.es=r;function n(){for(var y=[],b=0;b<arguments.length;b++)y[b]=arguments[b];return e.core.type.list(y)}e.list=n;function i(){for(var y=[],b=0;b<arguments.length;b++)y[b]=arguments[b];return e.core.type.set(y)}e.set=i;function a(y,b){return e.core.type.regex([y,b])}e.re=a;function o(y){return e.core.ctrl.fn([y])}e.fn=o;function s(y){return e.core.ctrl.eval([y])}e.evaluate=s;var u=e.struct.atomProperty.core,l=e.struct.atomProperty.macromolecular,c=e.struct.atomProperty.topology;function d(y){return u[y]()}e.acp=d;function f(y){return c[y]()}e.atp=f;function h(y){return l[y]()}e.ammp=h;var v=e.struct.atomSet.propertySet;function p(y){return v([d(y)])}e.acpSet=p;function m(y){return v([f(y)])}e.atpSet=m;function g(y){return v([h(y)])}e.ammpSet=g})(se||(se={}));var md=function(){function e(){this.count=0,this.center=_(),this.radiusSq=0}return e.prototype.reset=function(){_.set(this.center,0,0,0),this.radiusSq=0,this.count=0},e.prototype.includeStep=function(t){_.add(this.center,this.center,t),this.count++},e.prototype.finishedIncludeStep=function(){this.count!==0&&_.scale(this.center,this.center,1/this.count)},e.prototype.radiusStep=function(t){var r=_.squaredDistance(t,this.center);r>this.radiusSq&&(this.radiusSq=r)},e.prototype.radiusSphereStep=function(t,r){var n=_.distance(t,this.center)+r,i=n*n;i>this.radiusSq&&(this.radiusSq=i)},e.prototype.getSphere=function(t){return t||(t=Be()),_.copy(t.center,this.center),t.radius=Math.sqrt(this.radiusSq),t},e.prototype.getCount=function(){return this.count},e}();(function(e){var t=new e,r=_(),n=_();function i(s,u){var l=s.x,c=s.y,d=s.z;t.reset();for(var f=l.length,h=0;h<f;h++)_.set(r,l[h],c[h],d[h]),t.includeStep(r);t.finishedIncludeStep();for(var h=0;h<f;h++)_.set(r,l[h],c[h],d[h]),t.radiusStep(r);return _.copy(u.center,t.center),u.radius=Math.sqrt(t.radiusSq),u}e.fromArrays=i;function a(s,u,l){t.reset();for(var c=0;c<s;c++)u(c,r),t.includeStep(r);t.finishedIncludeStep();for(var c=0;c<s;c++)u(c,r),t.radiusStep(r);return _.copy(l.center,t.center),l.radius=Math.sqrt(t.radiusSq),l}e.fromProvider=a;function o(s,u,l){t.reset();for(var c=0;c<s;c++)u(c,r,n),t.includeStep(r),t.includeStep(n);t.finishedIncludeStep();for(var c=0;c<s;c++)u(c,r,n),t.radiusStep(r),t.radiusStep(n);return _.copy(l.center,t.center),l.radius=Math.sqrt(t.radiusSq),l}e.fromPairProvider=o})(md||(md={}));var Rv=function(){function e(t){this.map=t;var r=0,n=[],i=new Map,a=new Map;this.map.forEach(function(o){o.forEach(function(s){r+=s.edgeCount,s.connectedIndices.forEach(function(u){s.getEdges(u).forEach(function(l){var c=s.unitA,d=s.unitB,f=e.getEdgeKey(u,c,l.indexB,d);i.set(f,n.length);var h=e.getVertexKey(u,c),v=a.get(h);v===void 0?a.set(h,[n.length]):v.push(n.length),n.push(E(E({},l),{indexA:u,unitA:c,unitB:d}))})})})}),this.edgeCount=r,this.edges=n,this.edgeKeyIndex=i,this.vertexKeyIndex=a}return e.prototype.getConnectedUnits=function(t){return this.map.has(t)?this.map.get(t):uee},e.prototype.getEdgeIndex=function(t,r,n,i){var a=e.getEdgeKey(t,r,n,i),o=this.edgeKeyIndex.get(a);return o!==void 0?o:-1},e.prototype.hasEdge=function(t,r,n,i){return this.getEdgeIndex(t,r,n,i)!==-1},e.prototype.getEdge=function(t,r,n,i){var a=this.getEdgeIndex(t,r,n,i);return a!==-1?this.edges[a]:void 0},e.prototype.getEdgeIndices=function(t,r){return this.vertexKeyIndex.get(e.getVertexKey(t,r))||[]},e}();(function(e){var t=function(){function o(s,u,l,c,d){this.unitA=s,this.unitB=u,this.edgeCount=l,this.connectedIndices=c,this.edgeMap=d}return o.prototype.hasEdges=function(s){return this.edgeMap.has(s)},o.prototype.getEdges=function(s){return this.edgeMap.has(s)?this.edgeMap.get(s):uee},Object.defineProperty(o.prototype,"areUnitsOrdered",{get:function(){return this.unitA<this.unitB},enumerable:!1,configurable:!0}),o}();e.UnitPairEdges=t;function r(o,s,u,l){return o+"|"+s+"|"+u+"|"+l}e.getEdgeKey=r;function n(o,s){return o+"|"+s}e.getVertexKey=n;function i(o,s,u){o.has(s)?o.get(s).push(u):o.set(s,[u])}var a=function(){function o(){this.map=new Map}return o.prototype.startUnitPair=function(s,u){this.uA=s,this.uB=u,this.mapAB=new Map,this.mapBA=new Map,this.linkedA=an.create(),this.linkedB=an.create(),this.linkCount=0},o.prototype.finishUnitPair=function(){this.linkCount!==0&&(i(this.map,this.uA,new t(this.uA,this.uB,this.linkCount,this.linkedA.array,this.mapAB)),i(this.map,this.uB,new t(this.uB,this.uA,this.linkCount,this.linkedB.array,this.mapBA)))},o.prototype.add=function(s,u,l){i(this.mapAB,s,{indexB:u,props:l}),i(this.mapBA,u,{indexB:s,props:l}),an.add(this.linkedA,s,s),an.add(this.linkedB,u,u),this.linkCount+=1},o.prototype.getMap=function(){return this.map},o}();e.Builder=a})(Rv||(Rv={}));var uee=[],FD;(function(e){e.Empty=Oo.create([],[],[],0,{flags:[],order:[]})})(FD||(FD={}));var H1=function(e){Le(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.getBondFromLocation=function(r){return je.isAtomic(r.aUnit)&&je.isAtomic(r.bUnit)?this.getEdge(r.aIndex,r.aUnit.id,r.bIndex,r.bUnit.id):void 0},t.prototype.getBondIndexFromLocation=function(r){return je.isAtomic(r.aUnit)&&je.isAtomic(r.bUnit)?this.getEdgeIndex(r.aIndex,r.aUnit.id,r.bIndex,r.bUnit.id):-1},t}(Rv);(function(e){var t=function(r){Le(n,r);function n(){return r!==null&&r.apply(this,arguments)||this}return n}(Rv.UnitPairEdges);e.UnitPairBonds=t})(H1||(H1={}));var lee={forceCompute:!1,noCompute:!1},aF={H:0,h:0,D:0,d:0,T:0,t:0,He:2,HE:2,he:2,Li:3,LI:3,li:3,Be:4,BE:4,be:4,B:5,b:5,C:6,c:6,N:7,n:7,O:8,o:8,F:9,f:9,Ne:10,NE:10,ne:10,Na:11,NA:11,na:11,Mg:12,MG:12,mg:12,Al:13,AL:13,al:13,Si:14,SI:14,si:14,P:15,p:15,S:16,s:16,Cl:17,CL:17,cl:17,Ar:18,AR:18,ar:18,K:19,k:19,Ca:20,CA:20,ca:20,Sc:21,SC:21,sc:21,Ti:22,TI:22,ti:22,V:23,v:23,Cr:24,CR:24,cr:24,Mn:25,MN:25,mn:25,Fe:26,FE:26,fe:26,Co:27,CO:27,co:27,Ni:28,NI:28,ni:28,Cu:29,CU:29,cu:29,Zn:30,ZN:30,zn:30,Ga:31,GA:31,ga:31,Ge:32,GE:32,ge:32,As:33,AS:33,as:33,Se:34,SE:34,se:34,Br:35,BR:35,br:35,Kr:36,KR:36,kr:36,Rb:37,RB:37,rb:37,Sr:38,SR:38,sr:38,Y:39,y:39,Zr:40,ZR:40,zr:40,Nb:41,NB:41,nb:41,Mo:42,MO:42,mo:42,Tc:43,TC:43,tc:43,Ru:44,RU:44,ru:44,Rh:45,RH:45,rh:45,Pd:46,PD:46,pd:46,Ag:47,AG:47,ag:47,Cd:48,CD:48,cd:48,In:49,IN:49,in:49,Sn:50,SN:50,sn:50,Sb:51,SB:51,sb:51,Te:52,TE:52,te:52,I:53,i:53,Xe:54,XE:54,xe:54,Cs:55,CS:55,cs:55,Ba:56,BA:56,ba:56,La:57,LA:57,la:57,Ce:58,CE:58,ce:58,Pr:59,PR:59,pr:59,Nd:60,ND:60,nd:60,Pm:61,PM:61,pm:61,Sm:62,SM:62,sm:62,Eu:63,EU:63,eu:63,Gd:64,GD:64,gd:64,Tb:65,TB:65,tb:65,Dy:66,DY:66,dy:66,Ho:67,HO:67,ho:67,Er:68,ER:68,er:68,Tm:69,TM:69,tm:69,Yb:70,YB:70,yb:70,Lu:71,LU:71,lu:71,Hf:72,HF:72,hf:72,Ta:73,TA:73,ta:73,W:74,w:74,Re:75,RE:75,re:75,Os:76,OS:76,os:76,Ir:77,IR:77,ir:77,Pt:78,PT:78,pt:78,Au:79,AU:79,au:79,Hg:80,HG:80,hg:80,Tl:81,TL:81,tl:81,Pb:82,PB:82,pb:82,Bi:83,BI:83,bi:83,Po:84,PO:84,po:84,At:85,AT:85,at:85,Rn:86,RN:86,rn:86,Fr:87,FR:87,fr:87,Ra:88,RA:88,ra:88,Ac:89,AC:89,ac:89,Th:90,TH:90,th:90,Pa:91,PA:91,pa:91,U:92,u:92,Np:93,NP:93,np:93,Pu:94,PU:94,pu:94,Am:95,AM:95,am:95,Cm:96,CM:96,cm:96,Bk:97,BK:97,bk:97,Cf:98,CF:98,cf:98,Es:99,ES:99,es:99,Fm:100,FM:100,fm:100,Md:101,MD:101,md:101,No:102,NO:102,no:102,Lr:103,LR:103,lr:103,Rf:104,RF:104,rf:104,Db:105,DB:105,db:105,Sg:106,SG:106,sg:106,Bh:107,BH:107,bh:107,Hs:108,HS:108,hs:108,Mt:109,MT:109,mt:109},u8e={0:1.42,1:1.42,3:2.7,4:2.7,6:1.75,7:1.6,8:1.52,11:2.7,12:2.7,13:2.7,14:1.9,15:2,16:1.9,17:1.8,19:2.7,20:2.7,21:2.7,22:2.7,23:2.7,24:2.7,25:2.7,26:2.7,27:2.7,28:2.7,29:2.7,30:2.7,31:2.7,33:2.68,37:2.7,38:2.7,39:2.7,40:2.7,41:2.7,42:2.7,43:2.7,44:2.7,45:2.7,46:2.7,47:2.7,48:2.7,49:2.7,50:2.7,55:2.7,56:2.7,57:2.7,58:2.7,59:2.7,60:2.7,61:2.7,62:2.7,63:2.7,64:2.7,65:2.7,66:2.7,67:2.7,68:2.7,69:2.7,70:2.7,71:2.7,72:2.7,73:2.7,74:2.7,75:2.7,76:2.7,77:2.7,78:2.7,79:2.7,80:2.7,81:2.7,82:2.7,83:2.7,87:2.7,88:2.7,89:2.7,90:2.7,91:2.7,92:2.7,93:2.7,94:2.7,95:2.7,96:2.7,97:2.7,98:2.7,99:2.7,100:2.7,101:2.7,102:2.7,103:2.7,104:2.7,105:2.7,106:2.7,107:2.7,108:2.7,109:2.88},l8e={0:.8,20:1.31,27:1.2,35:1.15,44:1.1,54:1,60:1.84,72:1.88,84:1.75,85:1.56,86:1.76,98:1.6,99:1.68,100:1.63,112:1.6,113:1.59,114:1.36,129:1.45,135:1.47,144:1.6,152:1.45,170:1.4,180:1.55,202:2.4,222:2.24,224:1.91,225:1.98,243:2.02,269:2,293:1.9,316:1.8,420:2.37,480:2.3,512:2.3,544:2.3,612:2.1,629:1.54,665:1,813:2.6,854:2.27,894:1.93,896:2.1,937:2.05,938:2.06,981:1.62,1258:2.68,1309:2.33,1484:1,1763:2.14,1823:2.48,1882:2.1,1944:1.72,2380:2.34,3367:2.44,3733:2.11,3819:2.6,3821:2.36,4736:2.75,5724:2.73,5959:2.63,6519:2.84,6750:2.87,8991:2.81},sj=2.001,Kb=function(){for(var e=["LI","NA","K","RB","CS","FR","BE","MG","CA","SR","BA","RA","AL","GA","IN","SN","TL","PB","BI","SC","TI","V","CR","MN","FE","CO","NI","CU","ZN","Y","ZR","NB","MO","TC","RU","RH","PD","AG","CD","LA","HF","TA","W","RE","OS","IR","PT","AU","HG","AC","RF","DB","SG","BH","HS","MT","CE","PR","ND","PM","SM","EU","GD","TB","DY","HO","ER","TM","YB","LU","TH","PA","U","NP","PU","AM","CM","BK","CF","ES","FM","MD","NO","LR"],t=new Set,r=0,n=e;r<n.length;r++){var i=n[r];t.add(aF[i])}return t}();function c8e(e,t){return e<t?(e+t)*(e+t+1)/2+t:(e+t)*(e+t+1)/2+e}function p0(e){var t=aF[e];return t===void 0?-1:t}function cee(e,t){if(e<0||t<0)return-1;var r=l8e[c8e(e,t)];return r===void 0?-1:r}function mw(e){if(e<0)return sj;var t=u8e[e];return t===void 0?sj:t}var d8e=aF.H;function Qb(e){return e===d8e}function dee(e,t,r,n,i,a){for(var o=new Oo.EdgeBuilder(i,e,t),s=new Uint16Array(o.slotCount),u=new Int8Array(o.slotCount),l=0,c=o.edgeCount;l<c;l++)o.addNextEdge(),o.assignProperty(s,n[l]),o.assignProperty(u,r[l]);return o.createGraph({flags:s,order:u},{canRemap:a})}var uj=_(),lj=_();function f8e(e,t,r){return e.conformation.position(t,uj),e.conformation.position(r,lj),_.distance(uj,lj)}var h8e=new Set;function p8e(e){for(var t=wa.Provider.get(e.model),r=e.elements,n=e.model.atomicHierarchy.atoms.type_symbol,i=e.elements.length,a=t.edgeProps,o=e.model.atomicHierarchy.atomSourceIndex,s=Xt.getInvertedAtomSourceIndex(e.model).invertedIndex,u=[],l=[],c=[],d=[],f=0;f<i;f++)for(var h=r[f],v=n.value(h)==="H",p=o.value(h),m=t.offset[p],g=t.offset[p+1];m<g;++m){var y=s[t.b[m]];if(!(h>=y)){var b=Je.indexOf(e.elements,y);if(!(b<0)&&!(v&&n.value(y)==="H")){var S=a.distance[m];(S===-1||S===void 0||Sn(f8e(e,h,y),S,.5))&&(u[u.length]=f,l[l.length]=b,d[d.length]=a.order[m],c[c.length]=a.flag[m])}}}return dee(u,l,d,c,i,!1)}function v8e(e,t){for(var r=4,n=e.model.atomicConformation,i=n.x,a=n.y,o=n.z,s=e.elements.length,u=e.elements,l=e.residueIndex,c=e.chainIndex,d=e.model.atomicHierarchy.atoms,f=d.type_symbol,h=d.label_atom_id,v=d.label_alt_id,p=d.label_comp_id,m=e.model.atomicHierarchy.residues.label_seq_id,g=e.model.atomicHierarchy.index,y=e.model.sequence.byEntityKey,b=e.lookup3d,S=ec.Provider.get(e.model),x=Yb.Provider.get(e.model),C=ec.isExhaustive(e.model),w=[],A=[],M=[],D=[],k=-1,R=void 0,O=!0,H=!0,B=!0,j=h8e,Y=0;Y<s;Y++){var G=u[Y],$=f.value(G);O&&($!=="H"||$!=="O")&&(O=!1);var q=t.forceCompute?void 0:S&&S.byAtomIndex.get(G),ee=!1;if(q)for(var fe=0,W=q;fe<W.length;fe++){var X=W[fe],U=X.partnerA,z=X.partnerB;if(U.symmetry===z.symmetry){var J=U.atomIndex===G?z:U,K=Je.indexOf(e.elements,J.atomIndex);K<0||(w[w.length]=Y,A[A.length]=K,M[M.length]=X.flags,D[D.length]=X.order,ee||j.clear(),ee=!0,j.add(K))}}if(!C){var Z=l[G],te=m.value(Z),le=p.value(G);if(!t.forceCompute&&Z!==k)if(x&&x.entries.has(le)){var ye=y[g.getEntityFromChain(c[G])];ye&&ye.sequence.microHet.has(te)?R=void 0:R=x.entries.get(le).map}else R=void 0;k=Z;for(var be=p0($),Ae=h.value(G),Se=R?R.get(Ae):void 0,ie=b.find(i[G],a[G],o[G],r),oe=ie.indices,F=ie.count,V=ie.squaredDistances,pe=Qb(be),we=mw(be),Te=v.value(G),ze=Kb.has(be),Ve=0;Ve<F;Ve++){var K=oe[Ve];if(!(ee&&j.has(K))){var Xe=u[K];if(!(Xe<=G)){var ct=v.value(Xe);if(!(Te&&ct&&Te!==ct)){var Ne=p0(f.value(Xe)),Qe=Qb(Ne);if(!(pe&&Qe)){var it=(ze||Kb.has(Ne))&&!(pe||Qe),ot=l[Xe];if(Z===ot&&Se){var dt=Se.get(h.value(Xe));if(dt){w[w.length]=Y,A[A.length]=K,D[D.length]=dt.order;var ke=dt.flags;it&&(ke|1&&(ke^=1),ke|=2),M[M.length]=ke}continue}var Me=Math.sqrt(V[Ve]);if(Me!==0){var Ye=cee(be,Ne),tt=Ye>0?Ye:Ne<0?we:(we+mw(Ne))/1.95;if(Me<=tt){w[w.length]=Y,A[A.length]=K,D[D.length]=DNe(le,Ae,h.value(Xe)),M[M.length]=(it?2:1)|32;var xt=m.value(ot);te===xt&&(H=!1),Math.abs(te-xt)>1&&(B=!1)}}}}}}}}}var pt=O||H&&B;return dee(w,A,D,M,s,pt)}function m8e(e,t){var r=E(E({},lee),t);return r.noCompute||Xt.isCoarseGrained(e.model)?FD.Empty:!r.forceCompute&&wa.Provider.get(e.model)?p8e(e):v8e(e,r)}var v1=4,cj=_(),dj=_();function fj(e,t,r,n){return e.conformation.position(t,cj),r.conformation.position(n,dj),_.distance(cj,dj)}var g8e=ue(),ep=_();function y8e(e,t,r,n){var i=e.elements,a=e.residueIndex,o=e.model.atomicConformation,s=o.x,u=o.y,l=o.z,c=t.elements,d=t.residueIndex,f=e.elements.length,h=e.model.atomicHierarchy.atoms,v=h.type_symbol,p=h.label_alt_id,m=h.label_atom_id,g=h.label_comp_id,y=t.model.atomicHierarchy.atoms,b=y.type_symbol,S=y.label_alt_id,x=y.label_atom_id,C=y.label_comp_id,w=e.model.atomicHierarchy.residues.auth_seq_id,A=t.model.atomicHierarchy.residues.auth_seq_id,M=e.model.atomicConformation.occupancy,D=t.model.atomicConformation.occupancy,k=M.isDefined&&D.isDefined,R=e.model===t.model&&ec.Provider.get(e.model),O=!r.forceCompute&&e.model===t.model&&wa.Provider.get(e.model),H=e.model.atomicHierarchy.atomSourceIndex,B=(O?Xt.getInvertedAtomSourceIndex(t.model):{invertedIndex:void 0}).invertedIndex,j=e.model===t.model&&ec.isExhaustive(e.model),Y=ue.mul(g8e,t.conformation.operator.inverse,e.conformation.operator.matrix),G=!ue.isIdentity(Y),$=t.boundary.sphere,q=$.center,ee=$.radius,fe=(ee+v1)*(ee+v1);n.startUnitPair(e.id,t.id);for(var W=0;W<f;W++){var X=i[W];if(_.set(ep,s[X],u[X],l[X]),G&&_.transformMat4(ep,ep,Y),!(_.squaredDistance(ep,q)>fe)){if(!r.forceCompute&&O){for(var U=O.edgeProps,z=U.order,J=U.distance,K=U.flag,Z=H.value(X),te=O.offset[Z],le=O.offset[Z+1];te<le;++te){var ye=B[O.b[te]],be=Je.indexOf(t.elements,ye);if(!(be<0)&&!(v.value(X)==="H"&&b.value(ye)==="H")){var Ae=J[te];Ae!==-1&&Sn(fj(e,X,t,ye),Ae,.5)&&n.add(W,be,{order:z[te],flag:K[te]})}}continue}var Se=r.forceCompute?void 0:R&&R.byAtomIndex.get(X);if(Se&&Se.length){for(var ie=!1,oe=0,F=Se;oe<F.length;oe++){var V=F[oe],pe=V.partnerA,we=V.partnerB,Te=pe.atomIndex===X?we:pe,be=Je.indexOf(t.elements,Te.atomIndex);be<0||fj(e,X,t,Te.atomIndex)>v1||(n.add(W,be,{order:V.order,flag:V.flags}),ie=!0)}if(ie)continue}if(!j){var ze=M.value(X),Ve=t.lookup3d,Xe=Ve.find(ep[0],ep[1],ep[2],v1),ct=Xe.indices,Ne=Xe.count,Qe=Xe.squaredDistances;if(Ne!==0)for(var it=p0(v.value(X)),ot=Qb(it),dt=mw(it),ke=p.value(X),Me=Kb.has(it),Ye=m.value(X),tt=g.value(a[X]),xt=0;xt<Ne;xt++){var be=ct[xt],ye=c[be],pt=S.value(ye);if(!(ke&&pt&&ke!==pt)&&!(k&&D.value(ye)<1&&ze<1&&w.value(X)===A.value(ye))){var ut=p0(b.value(ye)),he=Qb(ut);if(!(ot&&he)){var me=(Me||Kb.has(ut))&&!(ot||he),Ee=Math.sqrt(Qe[xt]);if(Ee!==0){var Ke=cee(it,ut),gt=Ke>0?Ke:ut<0?dt:(dt+mw(ut))/1.95;if(Ee<=gt){var Pt=x.value(ye),Yt=C.value(d[ye]);n.add(W,be,{order:ree(tt,Yt,Ye,Pt),flag:(me?2:1)|32})}}}}}}}}n.finishUnitPair()}function b8e(e,t){var r=new Rv.Builder;if(t.noCompute||e.isCoarseGrained)return new H1(r.getMap());var n=e.models.length===1&&wa.Provider.get(e.model);if(n){for(var i=n.edgeProps.distance,a=!1,o=0,s=i.length;o<s;++o)if(i[o]!==-1){a=!0;break}if(!a)return new H1(r.getMap())}return We.eachUnitPair(e,function(u,l){y8e(u,l,t,r)},{maxRadius:v1,validUnit:function(u){return je.isAtomic(u)},validUnitPair:function(u,l){return t.validUnitPair(e,u,l)}}),new H1(r.getMap())}function x8e(e,t){return b8e(e,E(E({},lee),{validUnitPair:t&&t.validUnitPair||function(r,n,i){var a=n.model.atomicHierarchy.derived.residue.moleculeType,o=i.model.atomicHierarchy.derived.residue.moleculeType,s=(!je.isAtomic(n)||a[n.residueIndex[n.elements[0]]]!==2)&&(!je.isAtomic(i)||o[i.residueIndex[i.elements[0]]]!==2);return We.validUnitPair(r,n,i)&&s}}))}var Ht;(function(e){function t(p,m,g,y,b,S){return{kind:"bond-location",aStructure:p,aUnit:m,aIndex:g,bStructure:y,bUnit:b,bIndex:S}}e.Location=t;function r(p){return!!p&&p.kind==="bond-location"}e.isLocation=r;function n(p,m){return p.aStructure.label===m.aStructure.label&&p.bStructure.label===m.bStructure.label&&p.aIndex===m.aIndex&&p.bIndex===m.bIndex&&p.aUnit.id===m.aUnit.id&&p.bUnit.id===m.bUnit.id}e.areLocationsEqual=n;function i(p,m){return{kind:"bond-loci",structure:p,bonds:m}}e.Loci=i;function a(p){return!!p&&p.kind==="bond-loci"}e.isLoci=a;function o(p,m){if(p.structure!==m.structure||p.bonds.length!==m.bonds.length)return!1;for(var g=0,y=p.bonds.length;g<y;++g)if(!n(p.bonds[g],m.bonds[g]))return!1;return!0}e.areLociEqual=o;function s(p){return p.bonds.length===0}e.isLociEmpty=s;function u(p,m){if(m===p.structure)return p;var g=[];return p.bonds.forEach(function(y){var b=m.unitMap.get(y.aUnit.id);if(b){var S=m.unitMap.get(y.bUnit.id);if(S){var x=y.aUnit.elements[y.aIndex],C=Je.indexOf(b.elements,x);if(C!==-1){var w=y.bUnit.elements[y.bIndex],A=Je.indexOf(S.elements,w);A!==-1&&g.push(t(p.structure,b,C,p.structure,S,A))}}}}),i(m,g)}e.remapLoci=u;function l(p){for(var m=[],g=new Map,y=0,b=p.bonds;y<b.length;y++){var S=b[y],x=S.aIndex,C=S.aUnit,w=S.bIndex,A=S.bUnit;C===A?g.has(C.id)?g.get(C.id).push(x,w):g.set(C.id,[x,w]):(g.has(C.id)?g.get(C.id).push(x):g.set(C.id,[x]),g.has(A.id)?g.get(A.id).push(w):g.set(A.id,[w]))}return g.forEach(function(M,D){m.push({unit:p.structure.unitMap.get(D),indices:Je.deduplicate(Je.ofUnsortedArray(M))})}),Re(p.structure,m)}e.toStructureElementLoci=l;function c(p,m){if(m.aUnit===m.bUnit){var g=m.aUnit.bonds,y=g.getEdgeIndex(m.aIndex,m.bIndex);return y<0?Hr.create(0):Hr.create(g.edgeProps.flags[y])}else{var b=p.interUnitBonds.getBondFromLocation(m);return b?Hr.create(b.props.flag):Hr.create(0)}}e.getType=c;function d(p,m){if(m.aUnit===m.bUnit){var g=m.aUnit.bonds,y=g.getEdgeIndex(m.aIndex,m.bIndex);return y<0?0:g.edgeProps.order[y]}else{var b=p.interUnitBonds.getBondFromLocation(m);return b?b.props.order:0}}e.getOrder=d;function f(p){for(var m=0,g=0,y=p.units.length;g<y;++g){var b=p.units[g];je.isAtomic(b)&&(m+=b.bonds.edgeCount)}return m}e.getIntraUnitBondCount=f;var h=function(){function p(){this.current={},this.hasNext=!1}return p.prototype.move=function(){return this.advance(),this.current},p.prototype.setElement=function(m,g,y){this.structure=m,this.unit=g,this.index=y,this.interBondIndices=m.interUnitBonds.getEdgeIndices(y,g.id),this.interBondCount=this.interBondIndices.length,this.interBondIndex=0,this.intraBondEnd=g.bonds.offset[y+1],this.intraBondIndex=g.bonds.offset[y],this.hasNext=this.interBondIndex<this.interBondCount||this.intraBondIndex<this.intraBondEnd},p.prototype.advance=function(){if(this.intraBondIndex<this.intraBondEnd)this.current.otherUnit=this.unit,this.current.otherIndex=this.unit.bonds.b[this.intraBondIndex],this.current.type=this.unit.bonds.edgeProps.flags[this.intraBondIndex],this.current.order=this.unit.bonds.edgeProps.order[this.intraBondIndex],this.intraBondIndex+=1;else if(this.interBondIndex<this.interBondCount){var m=this.structure.interUnitBonds.edges[this.interBondIndex];this.current.otherUnit=this.structure.unitMap.get(m.unitA!==this.unit.id?m.unitA:m.unitB),this.current.otherIndex=m.indexA!==this.index?m.indexA:m.indexB,this.current.type=m.props.flag,this.current.order=m.props.order,this.interBondIndex+=1}else{this.hasNext=!1;return}this.hasNext=this.interBondIndex<this.interBondCount||this.intraBondIndex<this.intraBondEnd},p}();e.ElementBondIterator=h;function v(p,m){return md.fromPairProvider(p.bonds.length,function(g,y,b){var S=p.bonds[g],x=S.aUnit,C=S.aIndex,w=S.bUnit,A=S.bIndex;x.conformation.position(x.elements[C],y),w.conformation.position(w.elements[A],b)},m)}e.getBoundingSphere=v})(Ht||(Ht={}));function S8e(e){for(var t=_8e(e),r=C8e(e,t),n=ar.transientSegments(e.model.atomicHierarchy.residueAtomSegments,e.elements);n.hasNext;){var i=n.move();w8e(r,i.start,i.end)}return r.rings}function C8e(e,t){return{startVertex:0,endVertex:0,count:0,visited:new Int32Array(t),queue:new Int32Array(t),pred:new Int32Array(t),left:new Int32Array(4),right:new Int32Array(4),color:new Int32Array(t),currentColor:0,currentAltLoc:"",hasAltLoc:!1,rings:[],currentRings:[],unit:e,bonds:e.bonds,altLoc:e.model.atomicHierarchy.atoms.label_alt_id}}function hj(e){e.count=e.endVertex-e.startVertex;for(var t=e.visited,r=e.pred,n=e.color,i=0;i<e.count;i++)t[i]=-1,r[i]=-1,n[i]=0;e.currentColor=0,e.currentAltLoc="",e.hasAltLoc=!1}function _8e(e){for(var t=ar.transientSegments(e.model.atomicHierarchy.residueAtomSegments,e.elements),r=0;t.hasNext;){var n=t.move();r=Math.max(r,n.end-n.start)}return r}function w8e(e,t,r){var n=e.visited;if(e.startVertex=t,e.endVertex=r,!(e.endVertex-e.startVertex<3)){e.currentRings=[];for(var i=e.unit.elements,a=[],o=e.startVertex;o<e.endVertex;o++){var s=e.altLoc.value(i[o]);ja(a,s)}if(rv(a,""),a.length===0){hj(e);for(var o=0;o<e.count;o++)n[o]>=0||pj(e,o)}else for(var u=0;u<a.length;u++){hj(e),e.hasAltLoc=!0,e.currentAltLoc=a[u];for(var o=0;o<e.count;o++)if(!(n[o]>=0)){var s=e.altLoc.value(i[e.startVertex+o]);s&&s!==e.currentAltLoc||pj(e,o)}}for(var o=0,l=e.currentRings.length;o<l;o++)e.rings.push(e.currentRings[o])}}function E8e(e,t,r){if(!(r<t)){for(var n=e.pred,i=e.color,a=e.left,o=e.right,s=++e.currentColor,u=t,l=0;l<4&&(i[u]=s,u=n[u],!(u<0));l++);var c=0,d=0,f=!1,h=0;u=r;for(var l=0;l<4;l++){if(i[u]===s){h=u,f=!0;break}if(o[d++]=u,u=n[u],u<0)break}if(f){u=t;for(var l=0;l<4&&(a[c++]=u,!(h===u||(u=n[u],u<0)));l++);var v=c+d;if(!(v<3)){for(var p=new Int32Array(v),m=0,l=0;l<c;l++)p[m++]=e.startVertex+a[l];for(var l=d-1;l>=0;l--)p[m++]=e.startVertex+o[l];if(Ou(p),e.hasAltLoc)for(var g=0,y=e.currentRings.length;g<y;g++){var b=e.currentRings[g];if(p[0]===b[0]&&p.length===b.length){for(var S=!0,x=0,C=p.length;x<C;x++)if(p[x]!==b[x]){S=!1;break}if(S)return}}e.currentRings.push(Je.ofSortedArray(p))}}}}function pj(e,t){var r=e.bonds,n=e.startVertex,i=e.endVertex,a=e.visited,o=e.queue,s=e.pred,u=e.unit.elements,l=r.b,c=r.edgeProps.flags,d=r.offset;a[t]=1,o[0]=t;for(var f=0,h=1;f<h;)for(var v=o[f++],p=n+v,m=d[p],g=d[p+1],y=m;y<g;y++){var b=l[y];if(!(b<n||b>=i||!Hr.isCovalent(c[y]))){if(e.hasAltLoc){var S=e.altLoc.value(u[b]);if(S&&e.currentAltLoc!==S)continue}var x=b-n;if(a[x]>0){s[x]!==v&&s[v]!==x&&E8e(e,v,x);continue}a[x]=1,o[h++]=x,s[x]=v}}}function A8e(e){for(var t=e.length,r=new Array(t),n=0;n<t;n++)r[n]=e[t-n-1];for(var i=vj(e),a=vj(r),o=!1,n=0;n<t;n++){var s=e[(n+i)%t],u=r[(n+a)%t];if(s!==u){o=s<u;break}}return o?mj(e,i):mj(r,a)}function vj(e){for(var t=e.length,r=new Int32Array(t*2),n=0;n<r.length;n++)r[n]=-1;for(var i="",a="",o=0,s=1;s<r.length;s++){for(var n=r[s-o-1];n!==-1&&(i=e[s%t],a=e[(o+n+1)%t],i!==a);)i<a&&(o=s-n-1),n=r[n];n===-1?(i=e[s%t],a=e[(o+n+1)%t],i!==a?(i<a&&(o=s),r[s-o]=-1):r[s-o]=n+1):r[s-o]=n+1}return o}function mj(e,t){var r=e.length,n=[],i;for(i=0;i<r-1;i++)n.push(e[(i+t)%r]),n.push("-");return n.push(e[(i+t)%r]),n.join("")}function P8e(e,t){for(var r=new Map,n=new Map,i=0,a=e.length;i<a;i++)for(var o=e[i],s=0,u=o.length;s<u;s++){var l=o[s];r.has(l)?r.get(l).push(i):r.set(l,[i])}for(var c=0,d=t.length;c<d;c++)for(var i=t[c],o=e[i],s=0,u=o.length;s<u;s++){var l=o[s];n.has(l)?n.get(l).push(i):n.set(l,[i])}for(var f=new Oo.UniqueEdgeBuilder(e.length),i=0,a=e.length;i<a;i++)for(var o=e[i],s=0,u=o.length;s<u;s++){var l=o[s],h=r.get(l);if(h.length!==1)for(var v=0,p=h.length;v<p;v++){var m=h[v];i>=m||f.addEdge(i,m)}}for(var g=Oo.connectedComponents(f.getGraph()),y=g.componentIndex,b=[],s=0;s<g.componentCount;s++)b[s]=[];for(var i=0,a=e.length;i<a;i++)b[y[i]].push(i);return{elementRingIndices:r,elementAromaticRingIndices:n,ringComponentIndex:y,ringComponents:b}}var Rr;(function(e){function t(f,h,v){v===void 0&&(v=Float32Array);var p=f*h;return{data:new v(p),size:p,cols:f,rows:h}}e.create=t;function r(f,h,v){return f.data[f.rows*v+h]}e.get=r;function n(f,h,v,p){return f.data[f.rows*v+h]=p,f}e.set=n;function i(f,h,v,p){return f.data[f.rows*v+h]+=p,f}e.add=i;function a(f){return f.data.fill(0),f}e.makeZero=a;function o(f){return{data:f.data.slice(),size:f.size,cols:f.cols,rows:f.rows}}e.clone=o;function s(f,h,v){return{data:f,size:h*v,cols:h,rows:v}}e.fromArray=s;function u(f,h){if(f.cols!==h.rows||f.rows!==h.cols)throw new Error("transpose: matrix dimensions incompatible");if(f.data===h.data)throw new Error("transpose: matrices share memory");for(var v=h.rows,p=h.cols,m=h.data,g=f.data,y=0,b=0,S=0;y<v;S+=1,b+=p,++y)for(var x=S,C=0;C<p;x+=v,C++)g[x]=m[b+C];return f}e.transpose=u;function l(f,h,v){for(var p=h.cols,m=h.rows,g=v.rows,y=h.data,b=v.data,S=f.data,x=0,C=0,w=0;x<m;C+=p,x++)for(var A=0,M=0;M<g;w++,M++){for(var D=0,k=C,R=0;R<p;k++,A++,R++)D+=y[k]*b[A];S[w]=D}return f}e.multiplyABt=l;function c(f){for(var h=f.rows,v=f.cols,p=f.data,m=new Array(v),g=0;g<v;++g)m[g]=0;for(var y=0,b=0;y<h;++y)for(var g=0;g<v;++g,++b)m[g]+=p[b];for(var g=0;g<v;++g)m[g]/=h;return m}e.meanRows=c;function d(f,h){for(var v=f.rows,p=f.cols,m=f.data,g=0,y=0;g<v;++g)for(var b=0;b<p;++b,++y)m[y]-=h[b];return f}e.subRows=d})(Rr||(Rr={}));function rT(e,t,r,n){n=e[t],e[t]=e[r],e[r]=n}function T8e(e,t){return e=Math.abs(e),t=Math.abs(t),e>t?(t/=e,e*Math.sqrt(1+t*t)):t>0?(e/=t,t*Math.sqrt(1+e*e)):0}var I8e=1192092896e-16,M8e=1e-37;function D8e(e,t,r,n,i,a,o,s){for(var u=I8e*2,l=M8e,c=0,d=0,f=0,h=0,v=Math.max(a,30),p=0,m=0,g=0,y=0,b=0,S=0,x=0,C=0,w=0,A=0,M=0,D=0,k=0,R=0,O=0,H=0,B=0,j=4660,Y=0,G=0,$=0,q=new Float64Array(o<<3);c<o;c++){for(f=0,M=0;f<a;f++)C=e[c*t+f],M+=C*C;if(q[c]=M,n){for(f=0;f<o;f++)n[c*i+f]=0;n[c*i+c]=1}}for(;h<v;h++){for(b=0,c=0;c<o-1;c++)for(d=c+1;d<o;d++){for(p=c*t|0,m=d*t|0,O=q[c],H=0,B=q[d],f=2,H+=e[p]*e[m],H+=e[p+1]*e[m+1];f<a;f++)H+=e[p+f]*e[m+f];if(!(Math.abs(H)<=u*Math.sqrt(O*B))){for(H*=2,D=O-B,k=T8e(H,D),D<0?(R=(k-D)*.5,x=Math.sqrt(R/k),S=H/(k*x*2)):(S=Math.sqrt((k+D)/(k*2)),x=H/(k*S*2)),O=0,B=0,f=2,w=S*e[p]+x*e[m],A=-x*e[p]+S*e[m],e[p]=w,e[m]=A,O+=w*w,B+=A*A,w=S*e[p+1]+x*e[m+1],A=-x*e[p+1]+S*e[m+1],e[p+1]=w,e[m+1]=A,O+=w*w,B+=A*A;f<a;f++)w=S*e[p+f]+x*e[m+f],A=-x*e[p+f]+S*e[m+f],e[p+f]=w,e[m+f]=A,O+=w*w,B+=A*A;if(q[c]=O,q[d]=B,b=1,n)for(g=c*i|0,y=d*i|0,f=2,w=S*n[g]+x*n[y],A=-x*n[g]+S*n[y],n[g]=w,n[y]=A,w=S*n[g+1]+x*n[y+1],A=-x*n[g+1]+S*n[y+1],n[g+1]=w,n[y+1]=A;f<o;f++)w=S*n[g+f]+x*n[y+f],A=-x*n[g+f]+S*n[y+f],n[g+f]=w,n[y+f]=A}}if(b===0)break}for(c=0;c<o;c++){for(f=0,M=0;f<a;f++)C=e[c*t+f],M+=C*C;q[c]=Math.sqrt(M)}for(c=0;c<o-1;c++){for(d=c,f=c+1;f<o;f++)q[d]<q[f]&&(d=f);if(c!==d&&(rT(q,c,d,M),n)){for(f=0;f<a;f++)rT(e,c*t+f,d*t+f,C);for(f=0;f<o;f++)rT(n,c*i+f,d*i+f,C)}}for(c=0;c<o;c++)r[c]=q[c];if(n)for(c=0;c<s;c++){for(M=c<o?q[c]:0;M<=l;){for(G=1/a,f=0;f<a;f++)j=j*214013+2531011,Y=j>>16&32767&256?G:-G,e[c*t+f]=Y;for(h=0;h<2;h++)for(d=0;d<c;d++){for(M=0,f=0;f<a;f++)M+=e[c*t+f]*e[d*t+f];for($=0,f=0;f<a;f++)C=e[c*t+f]-M*e[d*t+f],e[c*t+f]=C,$+=Math.abs(C);for($=$?1/$:0,f=0;f<a;f++)e[c*t+f]*=$}for(M=0,f=0;f<a;f++)C=e[c*t+f],M+=C*C;M=Math.sqrt(M)}for(x=1/M,f=0;f<a;f++)e[c*t+f]*=x}}function R8e(e,t,r,n){var i=0,a=0,o=e.rows,s=e.cols,u=o,l=s;u<l&&(i=1,a=u,u=l,l=a);var c=Rr.create(u,u),d=Rr.create(1,l),f=Rr.create(l,l);if(i===0)Rr.transpose(c,e);else{for(a=0;a<s*o;a++)c.data[a]=e.data[a];for(;a<l*u;a++)c.data[a]=0}if(D8e(c.data,u,d.data,f.data,l,u,l,u),t){for(a=0;a<l;a++)t.data[a]=d.data[a];for(;a<s;a++)t.data[a]=0}i===0?(r&&Rr.transpose(r,c),n&&Rr.transpose(n,f)):(r&&Rr.transpose(r,f),n&&Rr.transpose(n,c))}var kv;(function(e){function t(u){var l=r(u),c=s(u,l);return{momentsAxes:l,boxAxes:c}}e.ofPositions=t;function r(u){if(u.length===3)return Iu.create(_.fromArray(_(),u,0),_.create(1,0,0),_.create(0,1,0),_.create(0,1,0));var l=Rr.fromArray(u,3,u.length/3),c=l.rows,d=c/3,f=Rr.create(3,3),h=Rr.create(1,3),v=Rr.create(3,3),p=Rr.create(3,3),m=Rr.meanRows(l),g=Rr.subRows(Rr.clone(l),m),y=Rr.transpose(Rr.create(c,3),g);Rr.multiplyABt(f,y,y),R8e(f,h,v,p);var b=_.create(m[0],m[1],m[2]),S=_.create(v.data[0],v.data[3],v.data[6]),x=_.create(v.data[1],v.data[4],v.data[7]),C=_.create(v.data[2],v.data[5],v.data[8]);return _.scale(S,S,Math.sqrt(h.data[0]/d)),_.scale(x,x,Math.sqrt(h.data[1]/d)),_.scale(C,C,Math.sqrt(h.data[2]/d)),Iu.create(b,S,x,C)}e.calculateMomentsAxes=r;var n=_(),i=_(),a=_(),o=_();function s(u,l){if(u.length===3)return Iu.clone(l);for(var c=-1/0,d=-1/0,f=-1/0,h=-1/0,v=-1/0,p=-1/0,m=_(),g=_(),y=l.origin,b=_.normalize(i,l.dirA),S=_.normalize(a,l.dirB),x=_.normalize(o,l.dirC),C=0,w=u.length;C<w;C+=3){_.projectPointOnVector(m,_.fromArray(m,u,C),b,y);var A=_.dot(b,_.normalize(g,_.sub(g,m,y))),M=_.distance(m,y);A>0?M>c&&(c=M):M>d&&(d=M),_.projectPointOnVector(m,_.fromArray(m,u,C),S,y);var D=_.dot(S,_.normalize(g,_.sub(g,m,y))),k=_.distance(m,y);D>0?k>f&&(f=k):k>h&&(h=k),_.projectPointOnVector(m,_.fromArray(m,u,C),x,y);var R=_.dot(x,_.normalize(g,_.sub(g,m,y))),O=_.distance(m,y);R>0?O>v&&(v=O):O>p&&(p=O)}var H=_.setMagnitude(_(),b,(c+d)/2),B=_.setMagnitude(_(),S,(f+h)/2),j=_.setMagnitude(_(),x,(v+p)/2),Y=_(),G=function($,q,ee){_.copy(n,y),_.scaleAndAdd(n,n,b,$),_.scaleAndAdd(n,n,S,q),_.scaleAndAdd(n,n,x,ee),_.add(Y,Y,n)};return G(c,f,v),G(c,f,-p),G(c,-h,-p),G(c,-h,v),G(-d,-h,-p),G(-d,-h,v),G(-d,f,v),G(-d,f,-p),_.scale(Y,Y,1/8),Iu.create(Y,H,B,j)}e.calculateBoxAxes=s})(kv||(kv={}));var gw=function(){function e(t,r){this.unit=r,this.all=t}return Object.defineProperty(e.prototype,"index",{get:function(){return this._index?this._index:(this._index=P8e(this.all,this.aromaticRings),this._index)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"byFingerprint",{get:function(){return this._byFingerprint?this._byFingerprint:(this._byFingerprint=k8e(this.unit,this.all),this._byFingerprint)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"elementRingIndices",{get:function(){return this.index.elementRingIndices},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"elementAromaticRingIndices",{get:function(){return this.index.elementAromaticRingIndices},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"ringComponentIndex",{get:function(){return this.index.ringComponentIndex},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"ringComponents",{get:function(){return this.index.ringComponents},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"aromaticRings",{get:function(){return this._aromaticRings?this._aromaticRings:(this._aromaticRings=L8e(this.unit,this.all),this._aromaticRings)},enumerable:!1,configurable:!0}),e}(),Vs;(function(e){function t(s,u){for(var l=s.elements,c=s.model.atomicHierarchy.atoms.type_symbol,d=[],f=0,h=u.length;f<h;f++)d[d.length]=c.value(l[u[f]]);return r(d)}e.fingerprint=t;function r(s){return A8e(s)}e.elementFingerprint=r;var n=new Set(["B","C","N","O","SI","P","S","GE","AS","SN","SB","BI"]),i=.05;function a(s,u){var l=s.elements,c=s.bonds,d=c.b,f=c.offset,h=c.edgeProps.flags,v=s.model.atomicHierarchy.atoms,p=v.type_symbol,m=v.label_comp_id;if(m.value(s.elements[u[0]])==="PRO")return!1;for(var g=0,y=!1,b=0,S=u.length;b<S;++b){var x=u[b];!y&&n.has(p.value(l[x]))&&(y=!0);for(var C=f[x],w=f[x+1];C<w;++C)Hr.is(16,h[C])&&Je.has(u,d[C])&&(g+=1)}if(g===2*u.length)return!0;if(!y)return!1;var A=kv.calculateMomentsAxes(NJ(s,u));return _.magnitude(A.dirC)<i}e.isAromatic=a;function o(s,u){for(var l=s.model.atomicHierarchy.atoms.label_alt_id,c=s.elements,d=0,f=u.length;d<f;++d){var h=c[u[d]],v=l.value(h);if(v)return v}return""}e.getAltId=o})(Vs||(Vs={}));(function(e){function t(n){var i=S8e(n);return new e(i,n)}e.create=t;function r(n,i){for(var a=new Map,o=0,s=i.length;o<s;o++){var u=i[o];F8e(n,u,a)}return a}e.byFingerprintAndResidue=r})(gw||(gw={}));function k8e(e,t){for(var r=new Map,n=0,i=0,a=t.length;i<a;i++){var o=t[i],s=Vs.fingerprint(e,o);r.has(s)?r.get(s).push(n):r.set(s,[n]),n++}return r}function O8e(e,t){for(var r=e.elements,n=e.model.atomicHierarchy.residueAtomSegments.index,i=n[r[t[0]]],a=1,o=t.length;a<o;a++)if(i!==n[r[t[a]]])return-1;return i}function F8e(e,t,r){var n=e.byFingerprint.get(t);if(n)for(var i=0,a=n.length;i<a;i++){var o=n[i],s=O8e(e.unit,e.all[o]);s>=0&&(r.has(s)?r.get(s).push(o):r.set(s,[o]))}}function L8e(e,t){for(var r=[],n=0,i=t.length;n<i;++n)Vs.isAromatic(e,t[n])&&r.push(n);return r}var nn;(function(e){function t(S){return Je.ofSortedArray(S)}e.ofSortedRanges=t;function r(S){return S[0]}e.start=r;function n(S){return S[S.length-1]+1}e.end=n;function i(S){return S[0]}e.min=i;function a(S){return S[S.length-1]}e.max=a;function o(S){for(var x=0,C=0,w=S.length;C<w;C+=2)x+=S[C+1]-S[C]+1;return x}e.size=o;function s(S){return S.length/2}e.count=s;function u(S,x){return S[x*2]}e.startAt=u;function l(S,x){return S[x*2+1]+1}e.endAt=l;function c(S,x){return S[x*2]}e.minAt=c;function d(S,x){return S[x*2+1]}e.maxAt=d;function f(S,x){if(S.length!==x.length)return!1;for(var C=0,w=S.length;C<w;++C)if(S[C]!==x[C])return!1;return!0}e.areEqual=f;function h(S,x){for(var C=0,w=0,A=S.length;w<A;w+=2)for(var M=S[w],D=S[w+1];M<=D;++M)x(M,C),++C}e.forEach=h;function v(S,x){return m(S,x)!==-1}e.has=v;function p(S,x,C){return g(S,x,C)!==-1}e.hasFrom=p;function m(S,x){return g(S,x,0)}e.firstIntersectionIndex=m;function g(S,x,C){if(c(S,C)>Fe.max(x)||a(S)<Fe.min(x))return-1;for(var w=C,A=s(S);w<A;++w){var M=Ie.ofRange(c(S,w),d(S,w));if(Fe.areIntersecting(M,x))return w}return-1}e.firstIntersectionIndexFrom=g;function y(S,x){return new b(S,x)}e.transientSegments=y;var b=function(){function S(x,C){this.ranges=x,this.set=C,this.value={index:0,start:0,end:0},this.curIndex=0,this.hasNext=!1,this.curIndex=m(x,C),this.hasNext=this.curIndex!==-1}return S.prototype.updateValue=function(){this.value.index=this.curIndex,this.value.start=Fe.findPredecessorIndex(this.set,u(this.ranges,this.curIndex)),this.value.end=Fe.findPredecessorIndex(this.set,l(this.ranges,this.curIndex))},S.prototype.move=function(){return this.hasNext&&(this.updateValue(),this.curIndex=g(this.ranges,this.set,this.curIndex+1),this.hasNext=this.curIndex!==-1),this.value},S}();e.Iterator=b})(nn||(nn={}));function N8e(e){for(var t=[],r=e.elements,n=e.model,i=e.model.atomicHierarchy.residueAtomSegments,a=n.atomicHierarchy.derived.residue.traceElementIndex,o=nn.transientSegments(e.model.atomicRanges.polymerRanges,r),s=ar.transientSegments(i,r);o.hasNext;){var u=o.move();for(s.setSegment(u);s.hasNext;){var l=s.move(),c=l.start,d=l.end,f=l.index;if(Fe.areIntersecting(Ie.ofRange(r[c],r[d-1]),r)){var h=a[f];t.push(h===-1?i.offsets[f]:h)}}}return Je.ofSortedArray(t)}function B8e(e){for(var t=[],r=e.elements,n=e.model,i=n.coarseHierarchy,a=i.spheres,o=i.gaussians,s=je.isSpheres(e)?a.polymerRanges:o.polymerRanges,u=nn.transientSegments(s,r);u.hasNext;)for(var l=u.move(),c=l.start,d=l.end,f=c;f<d;++f)t.push(r[f]);return Je.ofSortedArray(t)}function U8e(e){for(var t=[],r=e.elements,n=e.model,i=e.residueIndex,a=e.model.atomicHierarchy.residueAtomSegments,o=n.atomicHierarchy.derived.residue.traceElementIndex,s=nn.transientSegments(e.model.atomicRanges.gapRanges,e.elements);s.hasNext;){var u=s.move(),l=i[r[u.start]],c=i[r[u.end-1]],d=o[l],f=o[c];t.push(d===-1?a.offsets[l]:d),t.push(f===-1?a.offsets[c]:f)}return Je.ofSortedArray(t)}function j8e(e){for(var t=[],r=e.elements,n=e.model,i=n.coarseHierarchy,a=i.spheres,o=i.gaussians,s=je.isSpheres(e)?a.gapRanges:o.gapRanges,u=nn.transientSegments(s,r);u.hasNext;){var l=u.move(),c=l.start,d=l.end;t.push(r[c],r[d-1])}return Je.ofSortedArray(t)}function z8e(e){for(var t=[],r=e.elements,n=e.model,i=n.atomicHierarchy,a=i.chainAtomSegments,o=i.residueAtomSegments,s=n.atomicHierarchy.derived.residue,u=s.moleculeType,l=s.traceElementIndex,c=ar.transientSegments(a,r),d=ar.transientSegments(o,r);c.hasNext;)for(d.setSegment(c.move());d.hasNext;){var f=d.move().index;if(ic(u[f])){var h=l[f];t.push(h===-1?o.offsets[f]:h)}}return Je.ofSortedArray(t)}function V8e(e){for(var t=[],r=e.elements,n=e.model,i=n.atomicHierarchy,a=i.chainAtomSegments,o=i.residueAtomSegments,s=n.atomicHierarchy.derived.residue,u=s.moleculeType,l=s.traceElementIndex,c=ar.transientSegments(a,r),d=ar.transientSegments(o,r);c.hasNext;)for(d.setSegment(c.move());d.hasNext;){var f=d.move().index;if(LJ(u[f])){var h=l[f];t.push(h===-1?o.offsets[f]:h)}}return Je.ofSortedArray(t)}var gj=_.zero();function H8e(e){for(var t=e.conformation.invariantPosition,r=e.elements,n=new Float32Array(r.length*3),i=0,a=r.length;i<a;i++)t(r[i],gj),_.toArray(gj,n,i*3);return n}function yj(e){var t=H8e(e);return kv.ofPositions(t)}var bs=function(){function e(t){this.minDist=[],this.maxDist=[],this.extrema=[],this.centroidHelper=new md,this.dir=G8e(t),this.reset()}return e.prototype.computeExtrema=function(t,r){var n=_.dot(this.dir[t],r);n<this.minDist[t]&&(this.minDist[t]=n,_.copy(this.extrema[t*2],r)),n>this.maxDist[t]&&(this.maxDist[t]=n,_.copy(this.extrema[t*2+1],r))},e.prototype.computeSphereExtrema=function(t,r,n){var i=_.dot(this.dir[t],r);i-n<this.minDist[t]&&(this.minDist[t]=i-n,_.scaleAndSub(this.extrema[t*2],r,this.dir[t],n)),i+n>this.maxDist[t]&&(this.maxDist[t]=i+n,_.scaleAndAdd(this.extrema[t*2+1],r,this.dir[t],n))},e.prototype.includeSphere=function(t){if(Be.hasExtrema(t)&&t.extrema.length>1)for(var r=0,n=t.extrema;r<n.length;r++){var i=n[r];this.includePosition(i)}else this.includePositionRadius(t.center,t.radius)},e.prototype.includePosition=function(t){for(var r=0,n=this.dir.length;r<n;++r)this.computeExtrema(r,t)},e.prototype.includePositionRadius=function(t,r){for(var n=0,i=this.dir.length;n<i;++n)this.computeSphereExtrema(n,t,r)},e.prototype.finishedIncludeStep=function(){for(var t=0;t<this.extrema.length;t++)this.centroidHelper.includeStep(this.extrema[t]);this.centroidHelper.finishedIncludeStep()},e.prototype.radiusSphere=function(t){if(Be.hasExtrema(t)&&t.extrema.length>1)for(var r=0,n=t.extrema;r<n.length;r++){var i=n[r];this.radiusPosition(i)}else this.radiusPositionRadius(t.center,t.radius)},e.prototype.radiusPosition=function(t){this.centroidHelper.radiusStep(t)},e.prototype.radiusPositionRadius=function(t,r){this.centroidHelper.radiusSphereStep(t,r)},e.prototype.getSphere=function(t){return Be.setExtrema(this.centroidHelper.getSphere(t),Nt([],this.extrema))},e.prototype.getBox=function(t){return Kt.fromVec3Array(t||Kt(),this.extrema)},e.prototype.reset=function(){for(var t=0,r=this.dir.length;t<r;++t)this.minDist[t]=1/0,this.maxDist[t]=-1/0,this.extrema[t*2]=_(),this.extrema[t*2+1]=_();this.centroidHelper.reset()},e}();function G8e(e){var t;switch(e){case"6":t=Nt([],Wx);break;case"14":t=Nt(Nt([],Wx),nT);break;case"26":t=Nt(Nt(Nt([],Wx),nT),bj);break;case"98":t=Nt(Nt(Nt(Nt(Nt(Nt([],Wx),nT),bj),q8e),$8e),W8e);break}return t.map(function(r){var n=_.create(r[0],r[1],r[2]);return _.normalize(n,n)})}var Wx=[[1,0,0],[0,1,0],[0,0,1]],nT=[[1,1,1],[-1,1,1],[-1,-1,1],[1,-1,1]],bj=[[1,1,0],[1,-1,0],[1,0,1],[1,0,-1],[0,1,1],[0,1,-1]],q8e=[[0,1,2],[0,2,1],[1,0,2],[2,0,1],[1,2,0],[2,1,0],[0,1,-2],[0,2,-1],[1,0,-2],[2,0,-1],[1,-2,0],[2,-1,0]],$8e=[[1,1,2],[2,1,1],[1,2,1],[1,-1,2],[1,1,-2],[1,-1,-2],[2,-1,1],[2,1,-1],[2,-1,-1],[1,-2,1],[1,2,-1],[1,-2,-1]],W8e=[[2,2,1],[1,2,2],[2,1,2],[2,-2,1],[2,2,-1],[2,-2,-1],[1,-2,2],[1,2,-2],[1,-2,-2],[2,-1,2],[2,1,-2],[2,-1,-2]],xj=_.set,X8e=new bs("14"),Y8e=new bs("98");function K8e(e){return e>1e4?X8e:Y8e}var Xx=_();function v0(e){var t=e.x,r=e.y,n=e.z,i=e.radius,a=e.indices,o=Fe.size(a);if(o>25e4){var s=Kt.computeBounding(e);return{box:s,sphere:Be.fromBox3D(Be(),s)}}var u=K8e(o);u.reset();for(var l=0;l<o;l++){var c=Fe.getAt(a,l);xj(Xx,t[c],r[c],n[c]),u.includePositionRadius(Xx,i&&i[c]||0)}u.finishedIncludeStep();for(var l=0;l<o;l++){var c=Fe.getAt(a,l);xj(Xx,t[c],r[c],n[c]),u.radiusPositionRadius(Xx,i&&i[c]||0)}var d=u.getSphere();if(!i&&Be.hasExtrema(d)&&o<=d.extrema.length){for(var f=[],l=0;l<o;l++){var c=Fe.getAt(a,l);f.push(_.create(t[c],r[c],n[c]))}Be.setExtrema(d,f)}return{box:u.getBox(),sphere:d}}var Q8e=function(){function e(){this.data=new Map}return e.prototype.get=function(t){var r=Je.hashCode(t);if(this.data.has(r))for(var n=0,i=this.data.get(r);n<i.length;n++){var a=i[n],o=a[0],s=a[1];if(Je.areEqual(t,o))return s}},e.prototype.set=function(t,r){var n=Je.hashCode(t);if(this.data.has(n)){for(var i=this.data.get(n),a=0,o=i;a<o.length;a++){var s=o[a];if(Je.areEqual(t,s[0])){s[1]=r;return}}i.push([t,r])}else this.data.set(n,[[t,r]])},e.get=function(t){return t._dynamicPropertyData.ElementSetIntraBondCache||(t._dynamicPropertyData.ElementSetIntraBondCache=new e),t._dynamicPropertyData.ElementSetIntraBondCache},e}(),je;(function(e){function t(B){return B.kind===0}e.isAtomic=t;function r(B){return B.kind===1||B.kind===2}e.isCoarse=r;function n(B){return B.kind===1}e.isSpheres=n;function i(B){return B.kind===2}e.isGaussians=i;function a(B,j,Y,G,$,q,ee,fe,W){switch($){case 0:return new v(B,j,Y,G,q,fe,Cn.createMapping(ee,q.atomicConformation,void 0),W??p());case 1:return x(B,j,Y,G,q,1,fe,Cn.createMapping(ee,q.coarseConformation.spheres,f(q)),W??y());case 2:return x(B,j,Y,G,q,2,fe,Cn.createMapping(ee,q.coarseConformation.gaussians,h()),W??y())}}e.create=a;function o(B){for(var j=Qs.Mutable(),Y=0,G=B.length;Y<G;Y++)j.set(B[Y].id,Y);return j}function s(B){for(var j=[],Y=0,G=B.length;Y<G;Y++)j.push(B[Y].id);return Xa(j)}function u(B){var j={};return{elements:B[0].elements,units:B,get unitIndexMap(){return j.unitIndexMap||(j.unitIndexMap=o(B)),j.unitIndexMap},hashCode:c(B[0]),transformHash:s(B)}}e.SymmetryGroup=u,function(B){function j(G,$){return G.hashCode!==$.hashCode?!1:Je.areEqual(G.elements,$.elements)}B.areInvariantElementsEqual=j;function Y(G){for(var $=Qs.Mutable(),q=0,ee=G.length;q<ee;++q)for(var fe=G[q],W=0,X=fe.units.length;W<X;++W)$.set(fe.units[W].id,q);return $}B.getUnitSymmetryGroupsIndexMap=Y}(u=e.SymmetryGroup||(e.SymmetryGroup={}));function l(B){return e.isAtomic(B)?B.model.atomicConformation.id:B.model.coarseConformation.id}e.conformationId=l;function c(B){return Kv(B.invariantId,Je.hashCode(B.elements))}e.hashUnit=c,function(B){B.is=_a.has,B.create=_a.create}(e.Traits||(e.Traits={}));function d(){return{}}function f(B){var j=B.coarseConformation.spheres.radius;return function(Y){return j[Y]}}function h(B){return function(j){return 0}}var v=function(){function B(j,Y,G,$,q,ee,fe,W){this.kind=0,this.objectPrimitive="atomistic",this.id=j,this.invariantId=Y,this.chainGroupId=G,this.traits=$,this.model=q,this.elements=ee,this.conformation=fe,this.residueIndex=q.atomicHierarchy.residueAtomSegments.index,this.chainIndex=q.atomicHierarchy.chainAtomSegments.index,this.props=W}return B.prototype.getChild=function(j){return j.length===this.elements.length?this:new B(this.id,this.invariantId,this.chainGroupId,this.traits,this.model,j,this.conformation,p())},B.prototype.applyOperator=function(j,Y,G){G===void 0&&(G=!1);var $=G?Y:Cn.compose(this.conformation.operator,Y);return new B(j,this.invariantId,this.chainGroupId,this.traits,this.model,this.elements,Cn.createMapping($,this.model.atomicConformation,this.conformation.r),this.props)},B.prototype.remapModel=function(j,Y){Y||(Y=E(E({},this.props),{bonds:M(this,this.props.bonds,j)}),e.isSameConformation(this,j)||(Y.boundary=void 0,Y.lookup3d=void 0,Y.principalAxes=void 0));var G=this.conformation.operator,$=vi.Provider.get(j);if(G.spgrOp!==-1&&$&&$!==vi.Provider.get(this.model)){var q=G.hkl,ee=q[0],fe=q[1],W=q[2],X=$.spacegroup.cell.toFractional,U=_.transformMat4(_(),Xt.getCenter(j),X);G=Xu.getSymmetryOperatorRef($.spacegroup,G.spgrOp,ee,fe,W,U)}var z=this.model.atomicConformation!==j.atomicConformation||G!==this.conformation.operator?Cn.createMapping(G,j.atomicConformation):this.conformation;return new B(this.id,this.invariantId,this.chainGroupId,this.traits,j,this.elements,z,Y)},Object.defineProperty(B.prototype,"boundary",{get:function(){if(this.props.boundary)return this.props.boundary;var j=this.model.atomicConformation,Y=j.x,G=j.y,$=j.z;return this.props.boundary=v0({x:Y,y:G,z:$,indices:this.elements}),this.props.boundary},enumerable:!1,configurable:!0}),Object.defineProperty(B.prototype,"lookup3d",{get:function(){if(this.props.lookup3d)return this.props.lookup3d;var j=this.model.atomicConformation,Y=j.x,G=j.y,$=j.z;return this.props.lookup3d=Dv({x:Y,y:G,z:$,indices:this.elements},this.boundary),this.props.lookup3d},enumerable:!1,configurable:!0}),Object.defineProperty(B.prototype,"principalAxes",{get:function(){return this.props.principalAxes?this.props.principalAxes:(this.props.principalAxes=yj(this),this.props.principalAxes)},enumerable:!1,configurable:!0}),Object.defineProperty(B.prototype,"bonds",{get:function(){if(this.props.bonds)return this.props.bonds;var j=Q8e.get(this.model),Y=j.get(this.elements);return Y||(Y=m8e(this),j.set(this.elements,Y)),this.props.bonds=Y,this.props.bonds},enumerable:!1,configurable:!0}),Object.defineProperty(B.prototype,"rings",{get:function(){return this.props.rings?this.props.rings:(this.props.rings=gw.create(this),this.props.rings)},enumerable:!1,configurable:!0}),Object.defineProperty(B.prototype,"polymerElements",{get:function(){return this.props.polymerElements?this.props.polymerElements:(this.props.polymerElements=N8e(this),this.props.polymerElements)},enumerable:!1,configurable:!0}),Object.defineProperty(B.prototype,"gapElements",{get:function(){return this.props.gapElements?this.props.gapElements:(this.props.gapElements=U8e(this),this.props.gapElements)},enumerable:!1,configurable:!0}),Object.defineProperty(B.prototype,"nucleotideElements",{get:function(){return this.props.nucleotideElements?this.props.nucleotideElements:(this.props.nucleotideElements=z8e(this),this.props.nucleotideElements)},enumerable:!1,configurable:!0}),Object.defineProperty(B.prototype,"proteinElements",{get:function(){return this.props.proteinElements?this.props.proteinElements:(this.props.proteinElements=V8e(this),this.props.proteinElements)},enumerable:!1,configurable:!0}),Object.defineProperty(B.prototype,"residueCount",{get:function(){if(this.props.residueCount!==void 0)return this.props.residueCount;for(var j=0,Y=ar.transientSegments(this.model.atomicHierarchy.residueAtomSegments,this.elements);Y.hasNext;)Y.move(),j+=1;return this.props.residueCount=j,this.props.residueCount},enumerable:!1,configurable:!0}),B.prototype.getResidueIndex=function(j){return this.residueIndex[this.elements[j]]},B}();e.Atomic=v;function p(){return d()}var m=function(){function B(j,Y,G,$,q,ee,fe,W,X){this.kind=ee,this.objectPrimitive=ee===1?"sphere":"gaussian",this.id=j,this.invariantId=Y,this.chainGroupId=G,this.traits=$,this.model=q,this.elements=fe,this.conformation=W,this.coarseElements=ee===1?q.coarseHierarchy.spheres:q.coarseHierarchy.gaussians,this.coarseConformation=ee===1?q.coarseConformation.spheres:q.coarseConformation.gaussians,this.props=X}return B.prototype.getChild=function(j){return j.length===this.elements.length?this:x(this.id,this.invariantId,this.chainGroupId,this.traits,this.model,this.kind,j,this.conformation,y())},B.prototype.applyOperator=function(j,Y,G){G===void 0&&(G=!1);var $=G?Y:Cn.compose(this.conformation.operator,Y);return x(j,this.invariantId,this.chainGroupId,this.traits,this.model,this.kind,this.elements,Cn.createMapping($,this.getCoarseConformation(),this.conformation.r),this.props)},B.prototype.remapModel=function(j,Y){var G=this.getCoarseConformation(),$=g(this.kind,j);Y||(Y=E({},this.props),e.isSameConformation(this,j)||(Y.boundary=void 0,Y.lookup3d=void 0,Y.principalAxes=void 0));var q=G!==$?Cn.createMapping(this.conformation.operator,$):this.conformation;return new B(this.id,this.invariantId,this.chainGroupId,this.traits,j,this.kind,this.elements,q,Y)},Object.defineProperty(B.prototype,"boundary",{get:function(){if(this.props.boundary)return this.props.boundary;var j=this.getCoarseConformation(),Y=j.x,G=j.y,$=j.z;return this.props.boundary=v0({x:Y,y:G,z:$,indices:this.elements}),this.props.boundary},enumerable:!1,configurable:!0}),Object.defineProperty(B.prototype,"lookup3d",{get:function(){if(this.props.lookup3d)return this.props.lookup3d;var j=this.getCoarseConformation(),Y=j.x,G=j.y,$=j.z;return this.props.lookup3d=Dv({x:Y,y:G,z:$,indices:this.elements},this.boundary),this.props.lookup3d},enumerable:!1,configurable:!0}),Object.defineProperty(B.prototype,"principalAxes",{get:function(){return this.props.principalAxes?this.props.principalAxes:(this.props.principalAxes=yj(this),this.props.principalAxes)},enumerable:!1,configurable:!0}),Object.defineProperty(B.prototype,"polymerElements",{get:function(){return this.props.polymerElements?this.props.polymerElements:(this.props.polymerElements=B8e(this),this.props.polymerElements)},enumerable:!1,configurable:!0}),Object.defineProperty(B.prototype,"gapElements",{get:function(){return this.props.gapElements?this.props.gapElements:(this.props.gapElements=j8e(this),this.props.gapElements)},enumerable:!1,configurable:!0}),B.prototype.getCoarseConformation=function(){return g(this.kind,this.model)},B}();function g(B,j){return B===1?j.coarseConformation.spheres:j.coarseConformation.gaussians}function y(){return d()}var b=function(B){Le(j,B);function j(){return B!==null&&B.apply(this,arguments)||this}return j}(m);e.Spheres=b;var S=function(B){Le(j,B);function j(){return B!==null&&B.apply(this,arguments)||this}return j}(m);e.Gaussians=S;function x(B,j,Y,G,$,q,ee,fe,W){return new m(B,j,Y,G,$,q,ee,fe,W)}function C(B,j){return B.chainGroupId===j.chainGroupId&&B.conformation.operator.name===j.conformation.operator.name}e.areSameChainOperatorGroup=C;function w(B,j){return ue.areEqual(B.conformation.operator.matrix,j.conformation.operator.matrix,1e-6)}e.areOperatorsEqual=w;function A(B,j){return Je.areEqual(B.elements,j.elements)?D(B,j.model):!1}e.areConformationsEqual=A;function M(B,j,Y){var G;if(j){if(B.model.atomicConformation.id===Y.atomicConformation.id)return j;var $=wa.Provider.get(B.model);if($){var q=wa.Provider.get(Y);return!q||$===q?j:void 0}return!((G=j.props)===null||G===void 0)&&G.canRemap||D(B,Y)?j:void 0}}function D(B,j){var Y=Xt.CoordinatesHistory.get(Xt.getRoot(j));if(Y)return Y.areEqual(B.elements,B.kind,j);for(var G=B.elements,$=B.conformation.coordinates,q=$.x,ee=$.y,fe=$.z,W=k(B.kind,j),X=W.x,U=W.y,z=W.z,J=0,K=G.length;J<K;J++){var Z=G[J];if(q[Z]!==X[Z]||ee[Z]!==U[Z]||fe[Z]!==z[Z])return!1}return!0}e.isSameConformation=D;function k(B,j){return B===0?j.atomicConformation:B===1?j.coarseConformation.spheres:j.coarseConformation.gaussians}e.getModelConformationOfKind=k;function R(B){return k(B.kind,B.model)}e.getConformation=R;function O(B,j){return B===0?j.atomicHierarchy:B===1?j.coarseHierarchy.spheres:j.coarseHierarchy.gaussians}e.getModelHierarchyOfKind=O;function H(B){return O(B.kind,B.model)}e.getHierarchy=H})(je||(je={}));var yw;(function(e){function t(i,a,o,s){i.indices[i.count]=o,i.units[i.count]=a,i.squaredDistances[i.count]=s,i.count++}e.add=t;function r(){return{count:0,indices:[],units:[],squaredDistances:[]}}e.create=r;function n(i,a){for(var o=0;o<a.count;++o)i.indices[o]=a.indices[o],i.units[o]=a.units[o],i.squaredDistances[o]=a.squaredDistances[o];return i.count=a.count,i}e.copy=n})(yw||(yw={}));function fee(){return{result:yw.create(),closeUnitsResult:Ih.create(),unitGroupResult:Ih.create()}}var Z8e=function(){function e(t){this.structure=t,this.pivot=_(),this.findContext=fee();for(var r=t.units,n=t.boundary,i=r.length,a=new Float32Array(i),o=new Float32Array(i),s=new Float32Array(i),u=new Float32Array(i),l=_(),c=0;c<i;c++){var d=r[c],f=d.boundary.sphere;_.transformMat4(l,f.center,d.conformation.operator.matrix),a[c]=l[0],o[c]=l[1],s[c]=l[2],u[c]=f.radius}var h={x:a,y:o,z:s,radius:u,indices:Fe.ofBounds(0,i)};this.unitLookup=Dv(h,n)}return e.prototype.findUnitIndices=function(t,r,n,i){return this.unitLookup.find(t,r,n,i)},e.prototype.find=function(t,r,n,i,a){return this._find(t,r,n,i,a??this.findContext)},e.prototype._find=function(t,r,n,i,a){Ih.reset(a.result);var o=this.structure.units,s=this.unitLookup.find(t,r,n,i,a.closeUnitsResult);if(s.count===0)return a.result;for(var u=0,l=s.count;u<l;u++){var c=o[s.indices[u]];_.set(this.pivot,t,r,n),c.conformation.operator.isIdentity||_.transformMat4(this.pivot,this.pivot,c.conformation.operator.inverse);for(var d=c.lookup3d,f=d.find(this.pivot[0],this.pivot[1],this.pivot[2],i,a.unitGroupResult),h=0,v=f.count;h<v;h++)yw.add(a.result,c,f.indices[h],f.squaredDistances[h])}return a.result},e.prototype.findIntoBuilder=function(t,r,n,i,a){var o=this.structure.units,s=this.unitLookup.find(t,r,n,i);if(s.count!==0)for(var u=0,l=s.count;u<l;u++){var c=o[s.indices[u]];_.set(this.pivot,t,r,n),c.conformation.operator.isIdentity||_.transformMat4(this.pivot,this.pivot,c.conformation.operator.inverse);var d=c.lookup3d,f=d.find(this.pivot[0],this.pivot[1],this.pivot[2],i);if(f.count!==0){var h=c.elements;a.beginUnit(c.id);for(var v=0,p=f.count;v<p;v++)a.addElement(h[f.indices[v]]);a.commitUnit()}}},e.prototype.findIntoBuilderIf=function(t,r,n,i,a,o){var s=this.structure.units,u=this.unitLookup.find(t,r,n,i);if(u.count!==0)for(var l=Ze.create(this.structure),c=0,d=u.count;c<d;c++){var f=s[u.indices[c]];_.set(this.pivot,t,r,n),f.conformation.operator.isIdentity||_.transformMat4(this.pivot,this.pivot,f.conformation.operator.inverse);var h=f.lookup3d,v=h.find(this.pivot[0],this.pivot[1],this.pivot[2],i);if(v.count!==0){var p=f.elements;l.unit=f,a.beginUnit(f.id);for(var m=0,g=v.count;m<g;m++)l.element=p[v.indices[m]],o(l)&&a.addElement(l.element);a.commitUnit()}}},e.prototype.findIntoBuilderWithRadius=function(t,r,n,i,a,o,s,u){var l=this.structure.units,c=this.unitLookup.find(t,r,n,o);if(c.count!==0)for(var d=Ze.create(this.structure),f=i+a+o,h=0,v=c.count;h<v;h++){var p=l[c.indices[h]];_.set(this.pivot,t,r,n),p.conformation.operator.isIdentity||_.transformMat4(this.pivot,this.pivot,p.conformation.operator.inverse);var m=p.lookup3d,g=m.find(this.pivot[0],this.pivot[1],this.pivot[2],f);if(g.count!==0){var y=p.elements;d.unit=p,u.beginUnit(p.id);for(var b=0,S=g.count;b<S;b++){d.element=y[g.indices[b]];var x=s(d);Math.sqrt(g.squaredDistances[b])-i-x>o||u.addElement(y[g.indices[b]])}u.commitUnit()}}},e.prototype.check=function(t,r,n,i){var a=this.structure.units,o=this.unitLookup.find(t,r,n,i);if(o.count===0)return!1;for(var s=0,u=o.count;s<u;s++){var l=a[o.indices[s]];_.set(this.pivot,t,r,n),l.conformation.operator.isIdentity||_.transformMat4(this.pivot,this.pivot,l.conformation.operator.inverse);var c=l.lookup3d;if(c.check(this.pivot[0],this.pivot[1],this.pivot[2],i))return!0}return!1},Object.defineProperty(e.prototype,"boundary",{get:function(){return this.structure.boundary},enumerable:!1,configurable:!0}),e}();function Zb(e,t){if(t.length===0)return We.Empty;if(t.length===1)return t[0];for(var r=new Map,n=new Set,i=0,a=t;i<a.length;i++)for(var o=a[i].units,s=0,u=o.length;s<u;s++){var l=o[s];if(r.has(l.id)){if(n.has(l.id))continue;var c=Je.union(r.get(l.id),l.elements);r.set(l.id,c),c.length===e.unitMap.get(l.id).elements.length&&n.add(l.id)}else r.set(l.id,l.elements),l.elements.length===e.unitMap.get(l.id).elements.length&&n.add(l.id)}var d=e.subsetBuilder(!0);return r.forEach(J8e,d),d.getStructure()}function J8e(e,t){this.setUnit(t,e)}function eBe(e,t){if(e===t)return!0;if(e.units.length!==t.units.length)return!1;for(var r=e.units,n=t.unitMap,i=0,a=r.length;i<a;i++){var o=r[i];if(!n.has(o.id))return!1;var s=n.get(o.id);if(!Je.areEqual(o.elements,s.elements))return!1}return!0}function ZE(e,t){if(e===t)return!0;var r,n;e.units.length<t.units.length?(r=e,n=t):(r=t,n=e);for(var i=r.units,a=n.unitMap,o=0,s=i.length;o<s;o++){var u=i[o];if(a.has(u.id)){var l=a.get(u.id);if(Je.areIntersecting(u.elements,l.elements))return!0}}return!1}function hee(e,t){if(e===t)return e;if(!ZE(e,t))return We.Empty;var r,n;e.units.length<t.units.length?(r=e,n=t):(r=t,n=e);for(var i=r.units,a=n.unitMap,o=[],s=0,u=i.length;s<u;s++){var l=i[s];if(a.has(l.id)){var c=a.get(l.id);if(Je.areIntersecting(l.elements,c.elements)){var d=Je.intersect(l.elements,c.elements);o[o.length]=l.getChild(d)}}}return We.create(o,{parent:e.parent||t.parent})}function oF(e,t){if(e===t)return We.Empty;if(!ZE(e,t))return e;for(var r=e.units,n=t.unitMap,i=[],a=0,o=r.length;a<o;a++){var s=r[a];if(!n.has(s.id)){i[i.length]=s;continue}var u=n.get(s.id),l=Je.subtract(s.elements,u.elements);l.length>0&&(i[i.length]=s.getChild(l))}return We.create(i,{parent:e.parent||t.parent})}var mt;(function(e){function t(g,y){return{kind:"singletons",source:g,structure:y}}e.Singletons=t;function r(g,y){return{kind:"sequence",source:g,structures:y}}e.Sequence=r;function n(g){return t(g,We.Empty)}e.Empty=n;function i(g){return g.kind==="singletons"}e.isSingleton=i;function a(g){return i(g)?g.structure.units.length===0:g.structures.length===0}e.isEmpty=a;function o(g){return i(g)?g.structure.elementCount:g.structures.length}e.structureCount=o;function s(g){return a(g)?We.Empty:i(g)?g.structure:Zb(g.source,g.structures)}e.unionStructure=s;function u(g){for(var y=[],b=g.source.unitMap,S=0,x=s(g).units;S<x.length;S++){var C=x[S];C===b.get(C.id)?y[y.length]={unit:C,indices:Fe.ofBounds(0,C.elements.length)}:y[y.length]={unit:C,indices:Fe.ofSortedArray(Je.indicesOf(b.get(C.id).elements,C.elements))}}return Re(g.source,y)}e.toLociWithCurrentUnits=u;function l(g){for(var y=[],b=g.source.unitMap,S=0,x=s(g).units;S<x.length;S++){var C=x[S],w=b.get(C.id);w===C?y[y.length]={unit:w,indices:Fe.ofBounds(0,w.elements.length)}:y[y.length]={unit:w,indices:Fe.ofSortedArray(Je.indicesOf(w.elements,C.elements))}}return Re(g.source,y)}e.toLociWithSourceUnits=l;function c(g,y,b){var S=y.length;return S===0?n(g):b?t(g,Zb(g,y)):r(g,y)}var d=function(){function g(y){this.source=y,this.structures=[],this.allSingletons=!0}return g.prototype.add=function(y){var b=y.elementCount;b!==0&&(this.structures[this.structures.length]=y,b!==1&&(this.allSingletons=!1))},g.prototype.getSelection=function(){return c(this.source,this.structures,this.allSingletons)},g}(),f=function(){function g(y){this.structure=y,this.structures=[],this.allSingletons=!0,this.uniqueSets=V6(We.hashCode,We.areUnitIdsAndIndicesEqual)}return g.prototype.add=function(y){var b=y.elementCount;b===0||!this.uniqueSets.add(y)||(this.structures[this.structures.length]=y,b!==1&&(this.allSingletons=!1))},g.prototype.getSelection=function(){return c(this.structure,this.structures,this.allSingletons)},g}();function h(g){return new d(g)}e.LinearBuilder=h;function v(g){return new f(g)}e.UniqueBuilder=v;function p(g,y){var b=0;if(e.isSingleton(g))for(var S=0,x=g.structure.units;S<x.length;S++)for(var C=x[S],w=C.elements,A=0,M=w.length;A<M;A++){var D=We.create([C.getChild(Je.ofSingleton(w[A]))],{parent:g.source});y(D,b++)}else for(var k=0,R=g.structures;k<R.length;k++){var D=R[k];y(D,b++)}}e.forEach=p;function m(g,y){return i(g)?t(y,g.structure):r(y,g.structures)}e.withInputStructure=m})(mt||(mt={}));var on;(function(e){e.Empty={hash:-1,elements:[]};function t(c,d){return n(mt.toLociWithSourceUnits(mt.Singletons(c,d)))}e.fromSubStructure=t;function r(c){return n(mt.toLociWithSourceUnits(c))}e.fromSelection=r;function n(c){for(var d=[],f=0,h=c.elements;f<h.length;f++){var v=h[f],p=v.unit,m=v.indices;if(Fe.size(m)!==0){var g=[],y=[];if(Fe.isInterval(m))Fe.size(m)===1?y.push(Ie.min(m)):g.push(Ie.min(m),Ie.max(m));else for(var b=0,S=m.length;b<S;){var x=b;for(b++;b<S&&m[b-1]+1===m[b];)b++;var C=b;if(C-x>2)g.push(m[x],m[C-1]);else for(var w=x;w<C;w++)y[y.length]=m[w]}d.push({unit:p,set:Je.ofSortedArray(y),ranges:nn.ofSortedRanges(g)})}}for(var A=new Map,b=0,M=d.length;b<M;++b){var v=d[b],D=Kv(Xa(v.ranges),Xa(v.set));if(A.has(D)){var k=A.get(D).groupedUnits;k.has(v.unit.invariantId)?k.get(v.unit.invariantId).push(v.unit.id):k.set(v.unit.invariantId,[v.unit.id])}else{var k=new Map;k.set(v.unit.invariantId,[v.unit.id]),A.set(D,{groupedUnits:k,set:v.set,ranges:v.ranges})}}var R=[];return A.forEach(function(O){var H=[];O.groupedUnits.forEach(function(B){return H.push(Je.ofUnsortedArray(B))}),H.sort(function(B,j){return B[0]-j[0]}),R.push({groupedUnits:H,set:O.set,ranges:O.ranges})}),{hash:c.structure.hashCode,elements:R}}e.fromLoci=n;function i(c,d){for(var f=[],h=0,v=c.length;h<v;++h){var p=c[h];d.unitMap.has(p)&&f.push(d.unitMap.get(p))}return f}function a(c,d){c.hash!==-1&&(c.hash,d.hashCode);for(var f=[],h=0,v=c.elements;h<v.length;h++)for(var p=v[h],m=function(S){var x=i(S,d);if(x.length===0)return"continue";var C=void 0;if(p.ranges.length===0)C=p.set;else if(p.set.length===0)if(p.ranges.length===2)C=Ie.ofRange(p.ranges[0],p.ranges[1]);else{var w=new Int32Array(nn.size(p.ranges));nn.forEach(p.ranges,function(O,H){return w[H]=O}),C=Je.ofSortedArray(w)}else{var A=nn.size(p.ranges),M=new Int32Array(p.set.length+A);nn.forEach(p.ranges,function(O,H){return M[H]=O}),M.set(p.set,A),C=Je.ofUnsortedArray(M)}for(var D=0,k=x;D<k.length;D++){var R=k[D];f.push({unit:R,indices:C})}},g=0,y=p.groupedUnits;g<y.length;g++){var b=y[g];m(b)}return Re(d,f)}e.toLoci=a;function o(c,d){c.hash!==-1&&(c.hash,d.hashCode);for(var f=[],h=0,v=c.elements;h<v.length;h++)for(var p=v[h],m=function(S){var x=i(S,d);if(x.length===0)return"continue";var C=x[0].elements,w=nn.size(p.ranges),A=p.set.length,M=new Int32Array(A+w),D=void 0;if(w===0){for(var k=0,R=A;k<R;++k)M[k]=C[p.set[k]];D=Je.ofSortedArray(M)}else if(A===0)nn.forEach(p.ranges,function(j,Y){return M[Y]=C[j]}),D=Je.ofSortedArray(M);else if(Je.min(p.set)>nn.max(p.ranges)){nn.forEach(p.ranges,function(j,Y){return M[Y]=C[j]});for(var k=0,R=A;k<R;++k)M[k+w]=C[p.set[k]];D=Je.ofSortedArray(M)}else if(nn.min(p.ranges)>Je.max(p.set)){for(var k=0,R=A;k<R;++k)M[k]=C[p.set[k]];nn.forEach(p.ranges,function(j,Y){return M[Y+A]=C[j]}),D=Je.ofSortedArray(M)}else{nn.forEach(p.ranges,function(j,Y){return M[Y]=C[j]});for(var k=0,R=A;k<R;++k)M[k+w]=C[p.set[k]];D=Je.ofUnsortedArray(M)}for(var O=0,H=x;O<H.length;O++){var B=H[O];f.push(B.getChild(D))}},g=0,y=p.groupedUnits;g<y.length;g++){var b=y[g];m(b)}return We.create(f,{parent:d})}e.toStructure=o;function s(c){return se.internal.generator.bundleElement({groupedUnits:se.core.type.list(c.groupedUnits.map(function(d){return se.core.type.list(d)})),ranges:se.core.type.list(c.ranges),set:se.core.type.list(c.set)})}function u(c){return se.internal.generator.bundle({elements:se.core.type.list(c.elements.map(s))})}e.toExpression=u;function l(c,d){if(c.elements.length!==d.elements.length)return!1;for(var f=0,h=c.elements.length;f<h;++f){var v=c.elements[f],p=d.elements[f];if(v.groupedUnits.length!==p.groupedUnits.length)return!1;for(var m=0,g=p.groupedUnits.length;m<g;++m)if(!Je.areEqual(v.groupedUnits[m],p.groupedUnits[m]))return!1;if(!Je.areEqual(v.set,p.set)||!nn.areEqual(v.ranges,p.ranges))return!1}return!0}e.areEqual=l})(on||(on={}));function LD(e){return Hr.isCovalent(e.atomicBond.type)}function tBe(){return function(t){for(var r=t.inputStructure,n=Ze.create(r),i=[],a=0,o=r.units;a<o.length;a++){var s=o[a];if(s.kind===0){n.unit=s;var u=s.elements;if(n.element=u[0],lt.entity.type(n)==="polymer"){for(var l=ar.transientSegments(s.model.atomicHierarchy.residueAtomSegments,u),c=0;l.hasNext;)c++,l.move();c<8||i.push(s)}}}return mt.Singletons(r,We.create(i,{parent:r}))}}function rBe(){return function(t){for(var r=t.inputStructure,n=Ze.create(r),i=[],a=0,o=r.units;a<o.length;a++){var s=o[a];if(s.kind===0){n.unit=s;var u=s.elements;n.element=u[0],lt.entity.type(n)==="water"&&i.push(s)}}return mt.Singletons(r,We.create(i,{parent:r}))}}function nBe(){return function(t){for(var r=t.inputStructure,n=Ze.create(r),i=[],a=0,o=r.units;a<o.length;a++){var s=o[a];if(s.kind===0){n.unit=s;var u=s.elements;if(n.element=u[0],lt.entity.type(n)!=="water"){if(lt.entity.type(n)==="polymer"){for(var l=ar.transientSegments(s.model.atomicHierarchy.residueAtomSegments,u),c=0;l.hasNext;)c++,l.move();if(c>=8)continue}i.push(s)}}}return mt.Singletons(r,We.create(i,{parent:r}))}}function iBe(){return function(t){for(var r=t.inputStructure,n=[],i=0,a=r.units;i<a.length;i++){var o=a[i];o.kind===1&&n.push(o)}return mt.Singletons(r,We.create(n,{parent:r}))}}function pee(e,t,r){return{groupedUnits:e,ranges:t,set:r}}function vee(e){return function(r){var n={hash:r.inputStructure.hashCode,elements:e};return mt.Sequence(r.inputStructure,[on.toStructure(n,r.inputStructure)])}}const aBe=Object.freeze(Object.defineProperty({__proto__:null,atomicHet:nBe,atomicSequence:tBe,bundleElementImpl:pee,bundleGenerator:vee,defaultBondTest:LD,spheres:iBe,water:rBe},Symbol.toStringTag,{value:"Module"}));var ps=function(){function e(t,r){this.currentElementStack=[],this.currentAtomicBondStack=[],this.currentStructureStack=[],this.inputStructureStack=[],this.timeCreated=Ln(),this.element=Ze.create(void 0),this.currentStructure=void 0,this.atomicBond=new Sj,this.currentSelection=void 0,this.inputStructure=t,this.timeoutMs=r&&r.timeoutMs||0,this.currentSelection=r&&r.currentSelection}return e.prototype.pushCurrentElement=function(){return this.currentElementStack[this.currentElementStack.length]=this.element,this.element=Ze.create(void 0),this.element},e.prototype.popCurrentElement=function(){this.element=this.currentElementStack.pop()},e.prototype.pushCurrentBond=function(){return this.atomicBond&&this.currentAtomicBondStack.push(this.atomicBond),this.atomicBond=new Sj,this.atomicBond},e.prototype.popCurrentBond=function(){this.currentAtomicBondStack.length>0?this.atomicBond=this.currentAtomicBondStack.pop():this.atomicBond=void 0},e.prototype.pushCurrentStructure=function(){this.currentStructure&&this.currentStructureStack.push(this.currentStructure)},e.prototype.popCurrentStructure=function(){this.currentStructureStack.length?this.currentStructure=this.currentStructureStack.pop():this.currentStructure=void 0},e.prototype.pushInputStructure=function(t){this.inputStructureStack.push(this.inputStructure),this.inputStructure=t},e.prototype.popInputStructure=function(){if(this.inputStructureStack.length===0)throw new Error("Must push before pop.");this.inputStructure=this.inputStructureStack.pop()},e.prototype.throwIfTimedOut=function(){if(this.timeoutMs!==0&&Ln()-this.timeCreated>this.timeoutMs)throw new Error("The query took too long to execute (> "+this.timeoutMs/1e3+"s).")},e.prototype.tryGetCurrentSelection=function(){if(!this.currentSelection)throw new Error("The current selection is not assigned.");return this.currentSelection},e}(),Sj=function(){function e(){this.a=Ze.create(void 0),this.aIndex=0,this.b=Ze.create(void 0),this.bIndex=0,this.type=0,this.order=0,this.testFn=LD}return e.prototype.setStructure=function(t){this.a.structure=t,this.b.structure=t},e.prototype.setTestFn=function(t){this.testFn=t||LD},e.prototype.test=function(t,r){return this.testFn(t)?!0:r?(this.swap(),this.testFn(t)):!1},e.prototype.swap=function(){var t=this.aIndex;this.aIndex=this.bIndex,this.bIndex=t;var r=this.a.unit;this.a.unit=this.b.unit,this.b.unit=r;var n=this.a.element;this.a.element=this.b.element,this.b.element=n},Object.defineProperty(e.prototype,"length",{get:function(){return Ze.distance(this.a,this.b)},enumerable:!1,configurable:!0}),e}(),ND;(function(e){function t(r,n,i){return r(new ps(n,i))}e.run=t})(ND||(ND={}));var BD=function(){function e(t){this.source=t,this.set=V6(We.hashCode,We.areUnitIdsAndIndicesEqual),this.structures=[],this.allSingletons=!0}return e.prototype.add=function(t){t.elementCount&&(t.elementCount!==1&&(this.allSingletons=!1),this.set.add(t)&&(this.structures[this.structures.length]=t))},e.prototype.getSelection=function(){return this.allSingletons?mt.Singletons(this.source,Zb(this.source,this.structures)):mt.Sequence(this.source,this.structures)},e}(),oBe=function(){function e(t){this.source=t,this.builders=[],this.builderMap=new Map}return e.prototype.add=function(t,r,n){var i=this.builderMap.get(t);i||(i=this.source.subsetBuilder(!0),this.builders[this.builders.length]=i,this.builderMap.set(t,i)),i.addToUnit(r,n)},e.prototype.allSingletons=function(){for(var t=0,r=this.builders.length;t<r;t++)if(this.builders[t].elementCount>1)return!1;return!0},e.prototype.singletonSelection=function(){for(var t=this.source.subsetBuilder(!0),r=Ze.create(this.source),n=0,i=this.builders.length;n<i;n++)this.builders[n].setSingletonLocation(r),t.addToUnit(r.unit.id,r.element);return mt.Singletons(this.source,t.getStructure())},e.prototype.fullSelection=function(){for(var t=new Array(this.builders.length),r=0,n=this.builders.length;r<n;r++)t[r]=this.builders[r].getStructure();return mt.Sequence(this.source,t)},e.prototype.getSelection=function(){var t=this.builders.length;return t===0?mt.Empty(this.source):this.allSingletons()?this.singletonSelection():this.fullSelection()},e}(),sF=function(e){return mt.Sequence(e.inputStructure,[])},mee=function(e){return mt.Singletons(e.inputStructure,e.inputStructure)};function sBe(e){return uF(E(E({},e),{groupBy:function(t){return lt.residue.key(t.element)}}))}function uBe(e){return uF(E(E({},e),{groupBy:function(t){return lt.chain.key(t.element)}}))}function jf(e){return!0}function lBe(e){return 0}function uF(e){if(!e||!e.atomTest&&!e.residueTest&&!e.chainTest&&!e.entityTest&&!e.unitTest&&!e.groupBy)return mee;if(e.atomTest&&!e.residueTest&&!e.chainTest&&!e.entityTest&&!e.unitTest&&!e.groupBy)return cBe(e.atomTest);var t={unitTest:e.unitTest||jf,entityTest:e.entityTest||jf,chainTest:e.chainTest||jf,residueTest:e.residueTest||jf,atomTest:e.atomTest||jf,groupBy:e.groupBy||lBe};return e.groupBy?fBe(t):dBe(t)}function cBe(e){return function(r){var n=r.inputStructure,i=n.units,a=r.pushCurrentElement(),o=n.subsetBuilder(!0);a.structure=n;for(var s=0,u=i;s<u.length;s++){var l=u[s];a.unit=l;var c=l.elements;o.beginUnit(l.id);for(var d=0,f=c.length;d<f;d++)a.element=c[d],e(r)&&o.addElement(a.element);o.commitUnit(),r.throwIfTimedOut()}return r.popCurrentElement(),mt.Singletons(n,o.getStructure())}}function dBe(e){var t=e.unitTest,r=e.entityTest,n=e.chainTest,i=e.residueTest,a=e.atomTest;return function(s){var u=s.inputStructure,l=u.units,c=s.pushCurrentElement(),d=u.subsetBuilder(!0),f=i===jf&&a===jf,h=a===jf;c.structure=u;for(var v=0,p=l;v<p.length;v++){var m=p[v];if(c.unit=m,!!t(s)){var g=m.elements,y=m.model;if(d.beginUnit(m.id),m.kind===0)for(var b=ar.transientSegments(m.model.atomicHierarchy.chainAtomSegments,g),S=ar.transientSegments(m.model.atomicHierarchy.residueAtomSegments,g);b.hasNext;){var x=b.move();if(c.element=g[x.start],!(!r(s)||!n(s))){if(f){d.addElementRange(g,x.start,x.end);continue}for(S.setSegment(x);S.hasNext;){var C=S.move();if(c.element=g[C.start],!!i(s)){if(h){d.addElementRange(g,C.start,C.end);continue}for(var w=C.start,A=C.end;w<A;w++)c.element=g[w],a(s)&&d.addElement(c.element)}}}}else for(var M=y.coarseHierarchy.spheres.chainElementSegments,b=ar.transientSegments(M,g);b.hasNext;){var x=b.move();if(c.element=g[x.start],!(!r(s)||!n(s))){if(f){d.addElementRange(g,x.start,x.end);continue}for(var w=x.start,A=x.end;w<A;w++)c.element=g[w],i(s)&&d.addElement(c.element)}}d.commitUnit(),s.throwIfTimedOut()}}return s.popCurrentElement(),mt.Singletons(u,d.getStructure())}}function fBe(e){var t=e.unitTest,r=e.entityTest,n=e.chainTest,i=e.residueTest,a=e.atomTest,o=e.groupBy;return function(u){var l=u.inputStructure,c=l.units,d=u.pushCurrentElement(),f=new oBe(l);d.structure=l;for(var h=0,v=c;h<v.length;h++){var p=v[h];if(d.unit=p,!!t(u)){var m=p.elements,g=p.model;if(p.kind===0)for(var y=ar.transientSegments(g.atomicHierarchy.chainAtomSegments,m),b=ar.transientSegments(g.atomicHierarchy.residueAtomSegments,m);y.hasNext;){var S=y.move();if(d.element=m[S.start],!(!r(u)||!n(u)))for(b.setSegment(S);b.hasNext;){var x=b.move();if(d.element=m[x.start],!!i(u))for(var C=x.start,w=x.end;C<w;C++)d.element=m[C],a(u)&&f.add(o(u),p.id,d.element)}}else for(var A=g.coarseHierarchy.spheres.chainElementSegments,y=ar.transientSegments(A,m);y.hasNext;){var S=y.move();if(d.element=m[S.start],!(!r(u)||!n(u)))for(var C=S.start,w=S.end;C<w;C++)d.element=m[C],i(u)&&f.add(o(u),p.id,d.element)}u.throwIfTimedOut()}}return u.popCurrentElement(),f.getSelection()}}function iT(e,t,r){for(var n=new Int32Array(t.length),i=0,a=t.length;i<a;i++)n[i]=e.elements[t[i]];return We.create([e.getChild(Je.ofSortedArray(n))],{parent:r})}function hBe(e,t){return function(n){var i=n.inputStructure.units,a=mt.LinearBuilder(n.inputStructure);if(!e||e.length===0)for(var o=0,s=i;o<s.length;o++){var u=s[o];if(je.isAtomic(u))if(t)for(var l=0,c=u.rings.aromaticRings;l<c.length;l++){var d=c[l];a.add(iT(u,u.rings.all[d],n.inputStructure))}else for(var f=0,h=u.rings.all;f<h.length;f++){var d=h[f];a.add(iT(u,d,n.inputStructure))}}else{for(var v=an.create(),p=0;p<e.length;p++)an.add(v,e[p],e[p]);for(var m=0,g=i;m<g.length;m++){var u=g[m];if(je.isAtomic(u))for(var y=u.rings,b=0,S=v.array;b<S.length;b++){var x=S[b];if(y.byFingerprint.has(x))for(var C=0,w=y.byFingerprint.get(x);C<w.length;C++){var d=w[C];t&&!y.aromaticRings.includes(d)||a.add(iT(u,y.all[d],n.inputStructure))}}}}return a.getSelection()}}function pBe(e,t,r){return r===void 0&&(r=!1),function(i){var a=e(i);if(mt.structureCount(a)===0)return a;var o=r?oF(i.inputStructure,mt.unionStructure(a)):mt.unionStructure(a);if(o.elementCount===0)return mt.Empty(i.inputStructure);i.throwIfTimedOut(),i.pushInputStructure(o);var s=t(i);return i.popInputStructure(),mt.withInputStructure(s,i.inputStructure)}}function vBe(e){return function(r){var n=r.inputStructure,i=n.interUnitBonds,a=mt.UniqueBuilder(r.inputStructure);r.pushCurrentBond();var o=r.atomicBond;o.setTestFn(e),o.setStructure(n);for(var s=0,u=n.units;s<u.length;s++){var l=u[s];if(l.kind===0){var c=l.bonds,d=c.offset,f=c.b,h=c.edgeProps,v=h.flags,p=h.order;o.a.unit=l,o.b.unit=l;for(var m=0,g=l.elements.length;m<g;m++){o.aIndex=m,o.a.element=l.elements[m];for(var y=d[m],b=d[m+1];y<b;y++)if(o.bIndex=f[y],o.b.element=l.elements[f[y]],o.type=v[y],o.order=p[y],o.test(r,!1)){var S=n.subsetBuilder(!1);S.beginUnit(l.id),S.addElement(o.a.element),S.addElement(o.b.element),S.commitUnit(),a.add(S.getStructure())}}}}for(var x=0,C=i.edges;x<C.length;x++){var w=C[x];if(o.a.unit=n.unitMap.get(w.unitA),o.a.element=o.a.unit.elements[w.indexA],o.aIndex=w.indexA,o.b.unit=n.unitMap.get(w.unitA),o.b.element=o.b.unit.elements[w.indexB],o.bIndex=w.indexB,o.order=w.props.order,o.type=w.props.flag,o.test(r,!1)){var S=n.subsetBuilder(!1);S.addToUnit(o.a.unit.id,o.a.element),S.addToUnit(o.b.unit.id,o.b.element),a.add(S.getStructure())}}return r.popCurrentBond(),a.getSelection()}}const mBe=Object.freeze(Object.defineProperty({__proto__:null,all:mee,atoms:uF,bondedAtomicPairs:vBe,chains:uBe,none:sF,querySelection:pBe,residues:sBe,rings:hBe},Symbol.toStringTag,{value:"Module"}));var JE=function(){function e(t){this.parent=t,this.ids=[],this.unitMap=Qs.Mutable(),this.parentId=-1,this.currentUnit=an.create(),this.elementCount=0}return e.prototype.addToUnit=function(t,r){var n=this.unitMap.get(t);if(n)an.add(n,r,r)&&this.elementCount++;else{var i=an.create();an.add(i,r,r),this.unitMap.set(t,i),this.ids[this.ids.length]=t,this.elementCount++}},e.prototype.has=function(t,r){var n=this.unitMap.get(t);return n?an.has(n,r):!1},e.prototype.beginUnit=function(t){this.parentId=t,this.unitMap.has(t)?this.currentUnit=this.unitMap.get(t):this.currentUnit=this.currentUnit.array.length>0?an.create():this.currentUnit},e.prototype.addElement=function(t){an.add(this.currentUnit,t,t)&&this.elementCount++},e.prototype.commitUnit=function(){this.currentUnit.array.length===0||this.unitMap.has(this.parentId)||(this.ids[this.ids.length]=this.parentId,this.unitMap.set(this.parentId,this.currentUnit),this.parentId=-1)},e.prototype.getStructure=function(){if(this.isEmpty)return We.Empty;var t=[];Ou(this.ids);for(var r=Bl.UnitEquivalenceBuilder(),n=0,i=this.ids.length;n<i;n++){var a=this.ids[n],o=this.parent.unitMap.get(a),s=this.unitMap.get(a).array,u=s.length;if(s.length===o.elements.length){t[t.length]=o,r.add(o.id,o);continue}u>1&&Ou(s);var l=o.getChild(Je.ofSortedArray(s)),c=r.add(l.id,l);l!==c&&(l=c.applyOperator(l.id,l.conformation.operator,!0)),t[t.length]=l}return We.create(t,{parent:this.parent})},Object.defineProperty(e.prototype,"isEmpty",{get:function(){return this.elementCount===0},enumerable:!1,configurable:!0}),e}();function gBe(e){var t=e.unit,r=e.flags,n=e.proteinInfo,i=t.conformation.position,a=t.model.atomicHierarchy.derived.residue.traceElementIndex,o=n.residueIndices,s=n.nIndices,u=o.length,l=function(k,R){return k===-1?_.setNaN(R):i(k,R)},c=_(),d=_(),f=_(),h=_(),v=_(),p=_(),m=_();e:for(var g=2;g<u-2;g++){for(var y=0;y<4;y++){var b=g+y-2;if(l(a[b],h),l(s[b+1],v),_.squaredDistance(h,v)>6.25)continue e}var S=o[g-2],x=o[g],C=o[g+2],w=a[S],A=a[x],M=a[C];l(w,c),l(A,d),l(M,f),_.sub(p,c,d),_.sub(m,d,f);var D=ku(_.angle(p,m));D&&D>70&&(r[g]|=32)}}var yBe=9,Yx=-27.888,bBe=-.5,Cj=-9.9;function xBe(e,t,r,n){var i=_.distance(e,n),a=_.distance(t,n),o=_.distance(t,r),s=_.distance(e,r),u=Yx/i-Yx/a,l=Yx/o-Yx/s,c=u+l;return c<Cj?Cj:c}function SBe(e,t,r){for(var n=t.residueIndices,i=t.cIndices,a=t.hIndices,o=t.nIndices,s=t.oIndices,u=e.model.atomicHierarchy.index,l=e.conformation.invariantPosition,c=e.model.atomicHierarchy.derived.residue.traceElementIndex,d=n.length,f=[],h=[],v=[],p=_(),m=_(),g=_(),y=_(),b=_(),S=_(),x=_(),C=0,w=n.length;C<w;++C){var A=C,M=n[C],D=s[A],k=i[A],R=c[M];if(!(D===-1||k===-1)&&u.findAtomOnResidue(M,"OXT")===-1){l(D,p),l(k,m),l(R,g);for(var O=r.find(g[0],g[1],g[2],yBe),H=O.indices,B=O.count,j=0;j<B;++j){var Y=H[j];if(!(Y===A||Y-1===A||Y+1===A)){var G=o[Y];if(G!==-1){l(G,y);var $=a[Y];if($===-1){if(Y===0)continue;var q=Y-1,ee=s[q],fe=i[q];if(ee===-1||fe===-1)continue;l(ee,x),l(fe,S),_.sub(b,S,x);var W=_.distance(x,S);_.scaleAndAdd(b,y,b,1/W)}else l($,b);var X=xBe(p,m,y,b);X>bBe||(f[f.length]=A,h[h.length]=Y,v[v.length]=X)}}}}}return CBe(d,f,h,v)}function CBe(e,t,r,n){for(var i=new Oo.DirectedEdgeBuilder(e,t,r),a=new Float32Array(i.slotCount),o=0,s=i.edgeCount;o<s;o++)i.addNextEdge(),i.assignProperty(a,n[o]);return i.createGraph({energies:n})}var ir;(function(e){e.is=_a.has,e.create=_a.create})(ir||(ir={}));var Kx=function(){function e(t,r,n){this.partner1=Math.min(t,r),this.partner2=Math.max(t,r),this.type=n}return e}();function _Be(e){for(var t=e.proteinInfo,r=e.hbonds,n=e.flags,i=[1024,2048,4096,128,256,512],a=0;a<3;a++)for(var o=0,s=t.residueIndices.length-1;o<s;++o)if(r.getDirectedEdgeIndex(o,o+a+3)!==-1)if(n[o]|=i[a+3]|i[a],e.params.oldDefinition)for(var u=1;u<a+3;++u)n[o+u]|=i[a+3]|64;else for(var u=0;u<=a+3;++u)n[o+u]|=i[a+3]|64}function wBe(e){for(var t=e.proteinInfo,r=e.flags,n=t.residueIndices.length,i=[1024,2048,4096,128,256,512],a=[0,0,0,8,1,16],o=e.params.oldOrdering?[4,3,5]:[3,4,5],s=0;s<o.length;s++)for(var u=o[s],l=1,c=n-u;l<c;l++){var d=ir.create(r[l]),f=ir.create(r[l-1]),h=ir.create(r[l+1]);if(e.params.oldOrdering){if(u===3&&(ir.is(d,1)||ir.is(h,1))||u===5&&(ir.is(d,1)||ir.is(d,8)||ir.is(h,1)||ir.is(h,8)))continue}else if(u===4&&(ir.is(d,8)||ir.is(h,8))||u===5&&(ir.is(d,1)||ir.is(d,8)||ir.is(h,1)||ir.is(h,8)))continue;if(ir.is(d,i[u])&&ir.is(d,i[u-3])&&ir.is(f,i[u])&&ir.is(f,i[u-3]))if(e.params.oldDefinition)for(var v=0;v<u;v++)r[l+v]|=a[u];else for(var v=-1;v<=u;v++)r[l+v]|=a[u]}}function EBe(e,t){if(t.type!==e.type||t.partner1!==e.firstEnd+1)return!1;if(t.type===0){if(t.partner2===e.secondEnd+1)return!0}else if(t.partner2===e.secondStart-1)return!0;return!1}function ABe(e,t){return e.type===t.type&&t.firstStart-e.firstEnd<6&&e.firstStart<t.firstStart&&t.nextLadder===0?e.type===0?_j(e,t):_j(t,e):!1}function _j(e,t){return t.secondStart-e.secondEnd>0&&(t.secondStart-e.secondEnd<6&&t.firstStart-e.firstEnd<3||t.secondStart-e.secondEnd<3)}function PBe(e){for(var t=e.bridges,r=e.ladders,n=0;n<t.length;n++){for(var i=t[n],a=!1,o=0;o<r.length;o++){var s=r[o];EBe(s,i)&&(a=!0,s.firstEnd++,i.type===0?s.secondEnd++:s.secondStart--)}a||(r[r.length]={previousLadder:0,nextLadder:0,firstStart:i.partner1,firstEnd:i.partner1,secondStart:i.partner2,secondEnd:i.partner2,type:i.type})}for(var u=0;u<r.length;u++)for(var l=r[u],c=u;c<r.length;c++){var d=r[c];ABe(l,d)&&(l.nextLadder=c,d.previousLadder=u)}}function TBe(e){for(var t=e.proteinInfo,r=e.hbonds,n=e.flags,i=e.bridges,a=r.offset,o=r.b,s,u,l=0,c=t.residueIndices.length;l<c;++l)for(var d=a[l],f=a[l+1];d<f;d++){var h=o[d];l>h||(s=l+1,u=h,s!==u&&r.getDirectedEdgeIndex(u,s+1)!==-1&&(n[s]|=2,n[u]|=2,i[i.length]=new Kx(s,u,0)),s=l,u=h-1,s!==u&&r.getDirectedEdgeIndex(u-1,s)!==-1&&(n[s]|=2,n[u]|=2,i[i.length]=new Kx(u,s,0)),s=l,u=h,s!==u&&r.getDirectedEdgeIndex(u,s)!==-1&&(n[s]|=2,n[u]|=2,i[i.length]=new Kx(u,s,1)),s=l+1,u=h-1,s!==u&&r.getDirectedEdgeIndex(u-1,s+1)!==-1&&(n[s]|=2,n[u]|=2,i[i.length]=new Kx(u,s,1)))}i.sort(function(v,p){return v.partner1>p.partner1?1:v.partner1<p.partner1?-1:0})}function wj(e){return ir.is(e,8)||ir.is(e,1)||ir.is(e,16)}function IBe(e){for(var t=e.ladders,r=e.flags,n=0;n<t.length;n++){for(var i=t[n],a=i.firstStart;a<=i.firstEnd;a++){var o=i.firstStart-a,s=i.secondStart-o;i.firstStart!==i.firstEnd?(r[a]|=4,r[s]|=4):(!wj(r[a])&&ir.is(r[a],4)&&(r[a]|=2),!wj(r[s])&&ir.is(r[s],4)&&(r[s]|=2))}if(i.nextLadder!==0){for(var u=t[i.nextLadder],a=i.firstStart;a<=u.firstEnd;a++)r[a]|=4;if(i.type===0)for(var a=i.secondStart;a<=u.secondEnd;a++)r[a]|=4;else for(var a=u.secondEnd;a<=i.secondStart;a++)r[a]|=4}}}function MBe(e,t){var r=t.cIndices,n=t.nIndices,i=t.residueIndices,a=e.conformation.position,o=e.model.atomicHierarchy.index,s=e.model.atomicHierarchy.derived.residue.traceElementIndex,u=i.length,l=function(C,w){return C===-1?_.setNaN(w):a(C,w)},c=_(),d=_(),f=_(),h=_(),v=_(),p=_(),m=_(),g=_(),y=_();if(u===0)return{phi:new Float32Array(0),psi:new Float32Array(0)};var b=new Float32Array(u-1),S=new Float32Array(u-1);l(-1,c),l(-1,d),l(-1,f),l(r[0],h),l(s[i[0]],v),l(n[0],p),l(r[1],m),l(s[i[1]],g),l(n[1],y);for(var x=0;x<u-1;++x)o.findAtomOnResidue(i[x],"OXT")===-1&&(b[x]=ku(_.dihedralAngle(c,p,v,h)),S[x]=ku(_.dihedralAngle(p,v,h,y)),c=h,d=v,f=p,h=m,v=g,p=y,l(r[x+1],m),l(s[i[x+1]],g),l(n[x+1],y));return{phi:b,psi:S}}function DBe(e,t){for(var r=e.model.atomicConformation,n=r.x,i=r.y,a=r.z,o=e.model.atomicHierarchy.derived.residue.traceElementIndex,s=new Uint32Array(t.length),u=0,l=t.length;u<l;++u)s[u]=o[t[u]];var c={x:n,y:i,z:a,indices:Je.ofSortedArray(s)};return Dv(c,v0(c))}function RBe(e){for(var t=e.model.atomicHierarchy.index,r=e.proteinElements,n=e.residueIndex,i=r.length,a=new Uint32Array(i),o=new Int32Array(i),s=new Int32Array(i),u=new Int32Array(i),l=new Int32Array(i),c=0;c<i;++c){var d=n[r[c]];a[c]=d,o[c]=t.findAtomOnResidue(d,"C"),s[c]=t.findAtomOnResidue(d,"H"),u[c]=t.findAtomOnResidue(d,"O"),l[c]=t.findAtomOnResidue(d,"N")}return{residueIndices:Je.ofSortedArray(a),cIndices:o,hIndices:s,oIndices:u,nIndices:l}}var kBe={oldDefinition:I.Boolean(!0,{description:"Whether to use the old DSSP convention for the annotation of turns and helices, causes them to be two residues shorter"}),oldOrdering:I.Boolean(!0,{description:"Alpha-helices are preferred over 3-10 helices"})};function OBe(e,t){return ce(this,void 0,void 0,function(){var r,n,i,a,o,s,u,l,c,d,f,h,v,p,m,g,y,b,S,x,C;return de(this,function(w){for(r=RBe(e),n=r.residueIndices,i=DBe(e,n),a=SBe(e,r,i),o=n.length,s=new Uint32Array(o),u=MBe(e,r),l=[],c=[],d=t.oldDefinition?NBe:UBe,f=t.oldOrdering?BBe:jBe,h={params:t,getResidueFlag:d,getFlagName:f,unit:e,proteinInfo:r,flags:s,hbonds:a,torsionAngles:u,ladders:l,bridges:c},_Be(h),wBe(h),gBe(h),TBe(h),PBe(h),IBe(h),v=zBe(s,d),p=new Uint32Array(o),m=[],g=[],y=function(A){return Je.indexOf(n,A)},b=0,S=n.length;b<S;++b)x=v[b],p[b]=x,C=d(s[b]),(g.length===0||C!==g[g.length-1].flags)&&(g[g.length]=FBe(LBe(x),s[b],d)),m[b]=g.length-1;return[2,ZJ(p,m,g,y)]})})}function FBe(e,t,r){return e==="helix"?{kind:"helix",flags:r(t)}:e==="sheet"?{kind:"sheet",flags:r(t)}:e==="turn"||e==="bend"?{kind:"turn",flags:r(t)}:{kind:"none"}}function LBe(e){return e===Vr.SecondaryStructureDssp.H||e===Vr.SecondaryStructureDssp.G||e===Vr.SecondaryStructureDssp.I?"helix":e===Vr.SecondaryStructureDssp.B||e===Vr.SecondaryStructureDssp.E?"sheet":e===Vr.SecondaryStructureDssp.T?"turn":e===Vr.SecondaryStructureDssp.S?"bend":"none"}function NBe(e){return ir.is(e,1)?Vr.SecondaryStructureDssp.H:ir.is(e,4)?Vr.SecondaryStructureDssp.E:ir.is(e,2)?Vr.SecondaryStructureDssp.B:ir.is(e,8)?Vr.SecondaryStructureDssp.G:ir.is(e,16)?Vr.SecondaryStructureDssp.I:ir.is(e,64)?Vr.SecondaryStructureDssp.T:ir.is(e,32)?Vr.SecondaryStructureDssp.S:0}function BBe(e){return ir.is(e,1)?"H":ir.is(e,4)?"E":ir.is(e,2)?"B":ir.is(e,8)?"G":ir.is(e,16)?"I":ir.is(e,64)?"T":ir.is(e,32)?"S":"-"}function UBe(e){return ir.is(e,16)?Vr.SecondaryStructureDssp.I:ir.is(e,1)?Vr.SecondaryStructureDssp.H:ir.is(e,4)?Vr.SecondaryStructureDssp.E:ir.is(e,2)?Vr.SecondaryStructureDssp.B:ir.is(e,8)?Vr.SecondaryStructureDssp.G:ir.is(e,64)?Vr.SecondaryStructureDssp.T:ir.is(e,32)?Vr.SecondaryStructureDssp.S:0}function jBe(e){return ir.is(e,16)?"I":ir.is(e,1)?"H":ir.is(e,4)?"E":ir.is(e,2)?"B":ir.is(e,8)?"G":ir.is(e,64)?"T":ir.is(e,32)?"S":"-"}function zBe(e,t){for(var r=new Uint32Array(e.length),n=0,i=e.length;n<i;++n){var a=ir.create(e[n]);r[n]=t(a)}return r}var Dh;(function(e){function t(n){var i=this,a=n.descriptor.name,o=n.type==="root"?"inheritedPropertyData":"currentPropertyData",s=function(l){return a in l[o]||(l[o][a]={props:E({},I.getDefaultValues(n.getParams(l))),data:Eh.create(void 0)}),l[o][a]},u=function(l,c,d){var f=s(l);l[o][a]={props:c,data:Eh.withValue(f.data,d)}};return{label:n.label,descriptor:n.descriptor,isHidden:n.isHidden,getParams:function(l){var c=I.clone(n.getParams(l));return I.setDefaultValues(c,s(l).props),c},defaultParams:n.defaultParams,isApplicable:n.isApplicable,attach:function(l,c,d,f){return d===void 0&&(d={}),ce(i,void 0,void 0,function(){var h,v,p,m,g,y;return de(this,function(b){switch(b.label){case 0:return f&&c.customPropertyDescriptors.reference(n.descriptor,!0),n.type==="root"&&(c=c.root),h=s(c.root).props,v=s(c),p=I.merge(n.defaultParams,h,d),v.data.value&&I.areEqual(n.defaultParams,v.props,p)?[2]:[4,n.obtain(l,c,p)];case 1:return m=b.sent(),g=m.value,y=m.assets,c.customPropertyDescriptors.add(n.descriptor),c.customPropertyDescriptors.assets(n.descriptor,y),u(c,p,g),[2]}})})},ref:function(l,c){return l.customPropertyDescriptors.reference(n.descriptor,c)},get:function(l){return s(l).data},set:function(l,c,d){c===void 0&&(c={}),n.type==="root"&&(l=l.root);var f=s(l),h=I.merge(n.defaultParams,f.props,c);I.areEqual(n.defaultParams,f.props,h)||(u(l,h,d),l.customPropertyDescriptors.assets(n.descriptor))},props:function(l){return s(l).props}}}e.createProvider=t;function r(n,i,a){var o=this,s={value:I.Value(a,{isHidden:!0})};return t({label:is(n),descriptor:ko({name:n}),isHidden:!0,type:i,defaultParams:s,getParams:function(){return{value:I.Value(a,{isHidden:!0})}},isApplicable:function(){return!0},obtain:function(u,l,c){return ce(o,void 0,void 0,function(){return de(this,function(d){return[2,E(E({},I.getDefaultValues(s)),c)]})})}})}e.createSimple=r})(Dh||(Dh={}));function gee(e){var t="model";if(e){t="dssp";for(var r=0,n=e.models.length;r<n;++r){var i=e.models[r];if(Xt.isFromPdbArchive(i)||Xt.hasSecondaryStructure(i)){t="model";break}}}return{type:I.MappedStatic(t,{model:I.EmptyGroup({label:"Model"}),dssp:I.Group(kBe,{label:"DSSP",isFlat:!0})},{options:[["model","Model"],["dssp","DSSP"]]})}}var Ej=gee(),tc=Dh.createProvider({label:"Secondary Structure",descriptor:ko({name:"molstar_computed_secondary_structure"}),type:"root",defaultParams:Ej,getParams:gee,isApplicable:function(e){return!0},obtain:function(e,t,r){return ce(void 0,void 0,void 0,function(){var n,i,a,o;return de(this,function(s){switch(s.label){case 0:switch(n=E(E({},I.getDefaultValues(Ej)),r),i=n.type.name,i){case"dssp":return[3,1];case"model":return[3,3]}return[3,5];case 1:return a={},[4,VBe(t,n.type.params)];case 2:return[2,(a.value=s.sent(),a)];case 3:return o={},[4,HBe(t)];case 4:return[2,(o.value=s.sent(),o)];case 5:return[2]}})})}});function VBe(e,t){return ce(this,void 0,void 0,function(){var r,n,i,a,o;return de(this,function(s){switch(s.label){case 0:r=new Map,n=0,i=e.unitSymmetryGroups.length,s.label=1;case 1:return n<i?(a=e.unitSymmetryGroups[n].units[0],je.isAtomic(a)&&!Xt.isCoarseGrained(a.model)?[4,OBe(a,t)]:[3,3]):[3,4];case 2:o=s.sent(),r.set(a.invariantId,o),s.label=3;case 3:return++n,[3,1];case 4:return[2,r]}})})}function HBe(e){return ce(this,void 0,void 0,function(){var t,r,n,i,a;return de(this,function(o){for(t=new Map,r=0,n=e.unitSymmetryGroups.length;r<n;++r)i=e.unitSymmetryGroups[r].units[0],je.isAtomic(i)&&(a=Xb.Provider.get(i.model),a&&t.set(i.invariantId,a));return[2,t]})})}var GBe={true:function(e){return!0},false:function(e){return!1},zero:function(e){return 0}};function Un(){throw"Property only available for atomic models."}function nf(e){throw e?"Property only available for coarse models ("+e+").":"Property only available for coarse models."}var m1={key:function(e){return e.element},x:function(e){return e.unit.conformation.x(e.element)},y:function(e){return e.unit.conformation.y(e.element)},z:function(e){return e.unit.conformation.z(e.element)},id:function(e){return je.isAtomic(e.unit)?e.unit.model.atomicConformation.atomId.value(e.element):Un()},occupancy:function(e){return je.isAtomic(e.unit)?e.unit.model.atomicConformation.occupancy.value(e.element):Un()},B_iso_or_equiv:function(e){return je.isAtomic(e.unit)?e.unit.model.atomicConformation.B_iso_or_equiv.value(e.element):Un()},sourceIndex:function(e){return je.isAtomic(e.unit)?e.unit.model.atomicHierarchy.atomSourceIndex.value(e.element):e.element},type_symbol:function(e){return je.isAtomic(e.unit)?e.unit.model.atomicHierarchy.atoms.type_symbol.value(e.element):Un()},label_atom_id:function(e){return je.isAtomic(e.unit)?e.unit.model.atomicHierarchy.atoms.label_atom_id.value(e.element):Un()},auth_atom_id:function(e){return je.isAtomic(e.unit)?e.unit.model.atomicHierarchy.atoms.auth_atom_id.value(e.element):Un()},label_alt_id:function(e){return je.isAtomic(e.unit)?e.unit.model.atomicHierarchy.atoms.label_alt_id.value(e.element):Un()},label_comp_id:bw,auth_comp_id:function(e){return je.isAtomic(e.unit)?e.unit.model.atomicHierarchy.atoms.auth_comp_id.value(e.element):Un()},pdbx_formal_charge:function(e){return je.isAtomic(e.unit)?e.unit.model.atomicHierarchy.atoms.pdbx_formal_charge.value(e.element):Un()},vdw_radius:function(e){return je.isAtomic(e.unit)?A2(e.unit.model.atomicHierarchy.atoms.type_symbol.value(e.element)):Un()}};function bw(e){return je.isAtomic(e.unit)||Un(),e.unit.model.atomicHierarchy.atoms.label_comp_id.value(e.element)}function lF(e){return je.isAtomic(e.unit)?e.unit.model.atomicHierarchy.residues.label_seq_id.value(e.unit.residueIndex[e.element]):Un()}function qBe(e){je.isAtomic(e.unit)||Un();var t=e.unit.model.sequence.byEntityKey[to(e)];return t&&t.sequence.microHet.has(lF(e))}function Aj(e){je.isAtomic(e.unit)||Un();var t=e.unit.model.sequence.byEntityKey[to(e)];return t?t.sequence.microHet.get(lF(e))||[bw(e)]:[bw(e)]}var $Be={key:function(e){return je.isAtomic(e.unit)?e.unit.residueIndex[e.element]:Un()},group_PDB:function(e){return je.isAtomic(e.unit)?e.unit.model.atomicHierarchy.residues.group_PDB.value(e.unit.residueIndex[e.element]):Un()},label_seq_id:lF,auth_seq_id:function(e){return je.isAtomic(e.unit)?e.unit.model.atomicHierarchy.residues.auth_seq_id.value(e.unit.residueIndex[e.element]):Un()},pdbx_PDB_ins_code:function(e){return je.isAtomic(e.unit)?e.unit.model.atomicHierarchy.residues.pdbx_PDB_ins_code.value(e.unit.residueIndex[e.element]):Un()},isNonStandard:function(e){return je.isAtomic(e.unit)?Aj(e).some(function(t){return e.unit.model.properties.chemicalComponentMap.get(t).mon_nstd_flag[0]==="n"}):Un()},hasMicroheterogeneity:qBe,microheterogeneityCompIds:Aj,secondary_structure_type:function(e){var t,r;je.isAtomic(e.unit)||Un();var n=(t=tc.get(e.structure).value)===null||t===void 0?void 0:t.get(e.unit.invariantId);return(r=n==null?void 0:n.type[e.unit.residueIndex[e.element]])!==null&&r!==void 0?r:536870912},secondary_structure_key:function(e){var t,r;je.isAtomic(e.unit)||Un();var n=(t=tc.get(e.structure).value)===null||t===void 0?void 0:t.get(e.unit.invariantId);return(r=n==null?void 0:n.key[e.unit.residueIndex[e.element]])!==null&&r!==void 0?r:-1},chem_comp_type:function(e){return je.isAtomic(e.unit)?e.unit.model.properties.chemicalComponentMap.get(bw(e)).type:Un()}},WBe={key:function(e){return je.isAtomic(e.unit)?e.unit.chainIndex[e.element]:Un()},label_asym_id:function(e){return je.isAtomic(e.unit)?e.unit.model.atomicHierarchy.chains.label_asym_id.value(e.unit.chainIndex[e.element]):Un()},auth_asym_id:function(e){return je.isAtomic(e.unit)?e.unit.model.atomicHierarchy.chains.auth_asym_id.value(e.unit.chainIndex[e.element]):Un()},label_entity_id:function(e){return je.isAtomic(e.unit)?e.unit.model.atomicHierarchy.chains.label_entity_id.value(e.unit.chainIndex[e.element]):Un()}},XBe={key:m1.key,entityKey:function(e){return je.isCoarse(e.unit)?e.unit.coarseElements.entityKey[e.element]:nf()},x:m1.x,y:m1.y,z:m1.z,asym_id:function(e){return je.isCoarse(e.unit)?e.unit.coarseElements.asym_id.value(e.element):nf()},seq_id_begin:function(e){return je.isCoarse(e.unit)?e.unit.coarseElements.seq_id_begin.value(e.element):nf()},seq_id_end:function(e){return je.isCoarse(e.unit)?e.unit.coarseElements.seq_id_end.value(e.element):nf()},sphere_radius:function(e){return je.isSpheres(e.unit)?e.unit.coarseConformation.radius[e.element]:nf("spheres")},sphere_rmsf:function(e){return je.isSpheres(e.unit)?e.unit.coarseConformation.rmsf[e.element]:nf("spheres")},gaussian_weight:function(e){return je.isGaussians(e.unit)?e.unit.coarseConformation.weight[e.element]:nf("gaussians")},gaussian_covariance_matrix:function(e){return je.isGaussians(e.unit)?e.unit.coarseConformation.covariance_matrix[e.element]:nf("gaussians")}};function to(e){switch(e.unit.kind){case 0:return e.unit.model.atomicHierarchy.index.getEntityFromChain(e.unit.chainIndex[e.element]);case 1:return e.unit.model.coarseHierarchy.spheres.entityKey[e.element];case 2:return e.unit.model.coarseHierarchy.gaussians.entityKey[e.element]}}var YBe={key:to,id:function(e){return e.unit.model.entities.data.id.value(to(e))},type:function(e){return e.unit.model.entities.data.type.value(to(e))},src_method:function(e){return e.unit.model.entities.data.src_method.value(to(e))},pdbx_description:function(e){return e.unit.model.entities.data.pdbx_description.value(to(e))},formula_weight:function(e){return e.unit.model.entities.data.formula_weight.value(to(e))},pdbx_number_of_molecules:function(e){return e.unit.model.entities.data.pdbx_number_of_molecules.value(to(e))},details:function(e){return e.unit.model.entities.data.details.value(to(e))},pdbx_mutation:function(e){return e.unit.model.entities.data.pdbx_mutation.value(to(e))},pdbx_fragment:function(e){return e.unit.model.entities.data.pdbx_fragment.value(to(e))},pdbx_ec:function(e){return e.unit.model.entities.data.pdbx_ec.value(to(e))},subtype:function(e){return e.unit.model.entities.subtype.value(to(e))},prd_id:function(e){return e.unit.model.entities.prd_id.value(to(e))}},KBe=[],QBe={id:function(e){return e.unit.id},chainGroupId:function(e){return e.unit.chainGroupId},multiChain:function(e){return je.Traits.is(e.unit.traits,1)},object_primitive:function(e){return e.unit.objectPrimitive},operator_name:function(e){return e.unit.conformation.operator.name},model_index:function(e){return e.unit.model.modelNum},model_label:function(e){return e.unit.model.label},model_entry_id:function(e){return e.unit.model.entryId},hkl:function(e){return e.unit.conformation.operator.hkl},spgrOp:function(e){return e.unit.conformation.operator.spgrOp},model_num:function(e){return e.unit.model.modelNum},pdbx_struct_assembly_id:function(e){var t;return((t=e.unit.conformation.operator.assembly)===null||t===void 0?void 0:t.id)||Cn.DefaultName},pdbx_struct_oper_list_ids:function(e){var t;return((t=e.unit.conformation.operator.assembly)===null||t===void 0?void 0:t.operList)||KBe},struct_ncs_oper_id:function(e){return e.unit.conformation.operator.ncsId}},lt={constant:GBe,atom:m1,residue:$Be,chain:WBe,entity:YBe,unit:QBe,coarse:XBe},G1=function(){function e(t){var r;this.index=new Map,this.checkOperator=!1,this.checkOperator=(r=t==null?void 0:t.checkOperator)!==null&&r!==void 0?r:!1}return e.prototype.add=function(t){var r=this.index.get(t.label_asym_id);r||(r=new Map,this.index.set(t.label_asym_id,r));var n=r.get(t.label_seq_id);n||(n=[],r.set(t.label_seq_id,n));var i=this._find(t,n);return i?!1:(n.push(t),!0)},e.prototype.hasLabelAsymId=function(t){return this.index.has(t)},e.prototype.has=function(t){var r,n,i=Pj(t);if(this.index.has(i)){var a=this.index.get(i),o=Tj(t);if(a.has(o))for(var s=a.get(o),u=Ij(t),l=Mj(t),c=Dj(t),d=(r=Rj(t))!==null&&r!==void 0?r:"1_555",f=0,h=s;f<h.length;f++){var v=h[f];if(!(v.label_comp_id!==u||v.label_alt_id!==l||v.ins_code!==c)&&!(this.checkOperator&&((n=v.operator_name)!==null&&n!==void 0?n:"1_555")!==d))return v}}},e.getLabel=function(t,r){var n;return r===void 0&&(r=!1),t.label_asym_id+" "+t.label_comp_id+" "+t.label_seq_id+":"+t.ins_code+":"+t.label_alt_id+(r?" "+((n=t.operator_name)!==null&&n!==void 0?n:"1_555"):"")},e.getEntryFromLocation=function(t){var r;return{label_asym_id:Pj(t),label_comp_id:Ij(t),label_seq_id:Tj(t),label_alt_id:Mj(t),ins_code:Dj(t),operator_name:(r=Rj(t))!==null&&r!==void 0?r:"1_555"}},e.prototype._find=function(t,r){for(var n,i,a=0,o=r;a<o.length;a++){var s=o[a];if(!(s.label_comp_id!==t.label_comp_id||s.label_alt_id!==t.label_alt_id||s.ins_code!==t.ins_code)&&!(this.checkOperator&&((n=s.operator_name)!==null&&n!==void 0?n:"1_555")!==((i=t.operator_name)!==null&&i!==void 0?i:"1_555")))return!0}return!1},e}(),Pj=lt.chain.label_asym_id,Tj=lt.residue.label_seq_id,Ij=lt.atom.label_comp_id,Mj=lt.atom.label_alt_id,Dj=lt.residue.pdbx_PDB_ins_code,Rj=lt.unit.operator_name;function m0(e,t,r){for(var n=t.subsetBuilder(!0),i=0,a=r.units;i<a.length;i++){var o=a[i];if(o.kind!==0){n.setUnit(o.id,o.elements);continue}var s=o.model.atomicHierarchy.residueAtomSegments,u=t.unitMap.get(o.id).elements,l=o.elements;n.beginUnit(o.id);for(var c=ar.transientSegments(s,l);c.hasNext;)for(var d=c.move().index,f=s.offsets[d],h=s.offsets[d+1];f<h;f++)Je.has(u,f)&&n.addElement(f);n.commitUnit(),e.throwIfTimedOut()}return n.getStructure()}function ZBe(e){return function(r){var n=e(r);if(mt.isSingleton(n))return mt.Singletons(r.inputStructure,m0(r,r.inputStructure,n.structure));for(var i=new BD(r.inputStructure),a=0,o=n.structures;a<o.length;a++){var s=o[a];i.add(m0(r,r.inputStructure,s))}return i.getSelection()}}function UD(e,t,r,n){for(var i=new JE(t),a=t.lookup3d,o=n.radius,s=0,u=r.units;s<u.length;s++){for(var l=u[s],c=l.conformation,d=c.x,f=c.y,h=c.z,v=l.elements,p=0,m=v.length;p<m;p++){var g=v[p];a.findIntoBuilder(d(g),f(g),h(g),o,i)}e.throwIfTimedOut()}return n.wholeResidues?m0(e,t,i.getStructure()):i.getStructure()}function kj(e,t,r,n){var i=new JE(t),a=t.lookup3d,o=n.elementRadius,s=n.elementRadiusClosure,u=n.sourceMaxRadius,l=n.radius;e.pushCurrentElement(),e.element.structure=r;for(var c=0,d=r.units;c<d.length;c++){var f=d[c];e.element.unit=f;for(var h=f.conformation,v=h.x,p=h.y,m=h.z,g=f.elements,y=0,b=g.length;y<b;y++){var S=g[y];e.element.element=S;var x=o(e);a.findIntoBuilderWithRadius(v(S),p(S),m(S),x,u,l,s,i)}e.throwIfTimedOut()}return e.popCurrentElement(),n.wholeResidues?m0(e,t,i.getStructure()):i.getStructure()}function JBe(e,t){return function(r){return e.element.structure=r.structure,e.element.unit=r.unit,e.element.element=r.element,t(e)}}function e7e(e,t){var r=0;e.element.structure=e.inputStructure;for(var n=0,i=e.inputStructure.units;n<i.length;n++){var a=i[n];e.element.unit=a;for(var o=a.elements,s=0,u=o.length;s<u;s++){var l=o[s];e.element.element=l;var c=t(e);c>r&&(r=c)}}return e.throwIfTimedOut(),r}function t7e(e,t){return function(n){var i=e(n);if(t.elementRadius){var a=E(E({},t),{elementRadius:t.elementRadius,elementRadiusClosure:JBe(n,t.elementRadius),sourceMaxRadius:e7e(n,t.elementRadius)});if(mt.isSingleton(i)){var o=kj(n,n.inputStructure,i.structure,a),s=mt.Singletons(n.inputStructure,o);return s}else{for(var u=new BD(n.inputStructure),l=0,c=i.structures;l<c.length;l++){var d=c[l];u.add(kj(n,n.inputStructure,d,a))}return u.getSelection()}}if(mt.isSingleton(i)){var o=UD(n,n.inputStructure,i.structure,t),s=mt.Singletons(n.inputStructure,o);return s}else{for(var u=new BD(n.inputStructure),f=0,h=i.structures;f<h.length;f++){var d=h[f];u.add(UD(n,n.inputStructure,d,t))}return u.getSelection()}}}function r7e(e,t){return function(n){var i=e(n);if(mt.structureCount(i)===0)return i;var a=mt.UniqueBuilder(n.inputStructure),o=function(s){return a.add(s)};return mt.forEach(i,function(s,u){n.pushInputStructure(s),mt.forEach(t(n),o),n.popInputStructure(),u%10===0&&n.throwIfTimedOut()}),a.getSelection()}}function n7e(e,t){return function(n){var i=e(n);if(mt.structureCount(i)===0)return i;var a=t(n);if(mt.structureCount(a)===0)return mt.Empty(n.inputStructure);var o=mt.unionStructure(a),s=mt.UniqueBuilder(n.inputStructure);return mt.forEach(i,function(u,l){var c=hee(o,u);c.elementCount!==0&&s.add(c),l%50===0&&n.throwIfTimedOut()}),s.getSelection()}}function i7e(e,t){return function(n){var i=e(n);if(mt.structureCount(i)===0)return i;var a=t(n);if(mt.structureCount(a)===0)return i;var o=mt.unionStructure(a),s=mt.UniqueBuilder(n.inputStructure);return mt.forEach(i,function(u,l){var c=oF(u,o);c.elementCount!==0&&s.add(c),l%50===0&&n.throwIfTimedOut()}),s.getSelection()}}function a7e(e){return function(r){var n=mt.LinearBuilder(r.inputStructure);return n.add(mt.unionStructure(e(r))),n.getSelection()}}function o7e(e,t){return function(n){var i=e(n),a=new Map,o=[];n.pushCurrentElement(),mt.forEach(i,function(x,C){n.element.structure=x;for(var w=0,A=x.units;w<A.length;w++){var M=A[w];n.element.unit=M;for(var D=M.elements,k=0,R=D.length;k<R;k++){n.element.element=D[k];var O=t(n),H=void 0;a.has(O)?H=a.get(O):(H=an.create(),a.set(O,H)),an.add(H,C,C)}}o[C]=n.inputStructure.subsetBuilder(!0),C%10===0&&n.throwIfTimedOut()}),n.element.structure=n.inputStructure;for(var s=0,u=n.inputStructure.units;s<u.length;s++){var l=u[s];n.element.unit=l;for(var c=l.elements,d=0,f=c.length;d<f;d++){n.element.element=c[d];var h=t(n);if(a.has(h))for(var v=a.get(h).array,p=0,m=v.length;p<m;p++)o[v[p]].addToUnit(l.id,c[d])}}n.popCurrentElement();for(var g=mt.UniqueBuilder(n.inputStructure),y=0,b=o;y<b.length;y++){var S=b[y];g.add(S.getStructure())}return g.getSelection()}}function s7e(e){var t=e.query,r=e.layerCount,n=e.wholeResidues,i=e.bondTest,a=e.fixedPoint,o=Math.max(r,0);return function(u){var l=mt.UniqueBuilder(u.inputStructure),c=t(u);return u.pushCurrentBond(),u.atomicBond.setTestFn(i),mt.forEach(c,function(d,f){var h=d;if(a)for(;;){var v=h.elementCount;if(h=Oj(u,n,h),h.elementCount===v)break}else for(var p=0;p<o;p++)h=Oj(u,n,h);l.add(h),f%10===0&&u.throwIfTimedOut()}),u.popCurrentBond(),l.getSelection()}}function Oj(e,t,r){var n=u7e(e,r);return t?m0(e,e.inputStructure,n):n}function u7e(e,t){for(var r=e.inputStructure,n=r.interUnitBonds,i=new JE(r),a=e.atomicBond,o=0,s=t.units;o<s.length;o++){var u=s[o];if(u.kind!==0){i.beginUnit(u.id);for(var l=0,c=u.elements.length;l<c;l++)i.addElement(u.elements[l]);i.commitUnit();continue}var d=r.unitMap.get(u.id),f=d.bonds,h=f.offset,v=f.b,p=f.edgeProps,m=p.flags,g=p.order;a.setStructure(r),a.a.unit=d,a.b.unit=d;for(var l=0,c=u.elements.length;l<c;l++){i.addToUnit(u.id,u.elements[l]);for(var y=Je.indexOf(d.elements,u.elements[l]),b=h[y],S=h[y+1];b<S;b++){var x=v[b],C=d.elements[x];Je.has(u.elements,C)||i.has(u.id,C)||(a.aIndex=y,a.a.element=u.elements[l],a.bIndex=x,a.b.element=C,a.type=m[b],a.order=g[b],a.test(e,!0)&&i.addToUnit(u.id,C))}}for(var w=0,A=n.getConnectedUnits(d.id);w<A.length;w++)for(var M=A[w],D=t.unitMap.get(M.unitB),k=r.unitMap.get(M.unitB),R=0,O=M.connectedIndices;R<O.length;R++){var H=O[R];if(Je.has(u.elements,d.elements[H]))for(var B=0,j=M.getEdges(H);B<j.length;B++){var Y=j[B],C=k.elements[Y.indexB];D&&Je.has(D.elements,C)||i.has(M.unitB,C)||(a.a.unit=d,a.aIndex=H,a.a.element=d.elements[H],a.b.unit=k,a.bIndex=Y.indexB,a.b.element=C,a.type=Y.props.flag,a.order=Y.props.order,a.test(e,!0)&&i.addToUnit(M.unitB,C))}}}return i.getStructure()}function l7e(e){var t=e.query,r=e.radius,n=e.includeWater;return function(a){for(var o=mt.unionStructure(t(a)),s=m0(a,a.inputStructure,UD(a,a.inputStructure,o,{radius:r})),u=f7e(a.inputStructure),l=h7e(a.inputStructure),c=Ze.create(s),d=new Map,f=new G1({checkOperator:!0}),h=0,v=s.units;h<v.length;h++){var p=v[h];if(p.kind===0){c.unit=p;for(var m=p.elements,g=ar.transientSegments(p.model.atomicHierarchy.chainAtomSegments,m),y=ar.transientSegments(p.model.atomicHierarchy.residueAtomSegments,m);g.hasNext;){var b=g.move();c.element=m[b.start];var S=lt.chain.label_asym_id(c),x=lt.unit.operator_name(c);if(u.has(S)){d.has(S)?ja(d.get(S),x):d.set(S,[x]);continue}var C=lt.entity.type(c);if(!(C==="water"||C==="polymer"))for(y.setSegment(b);y.hasNext;){var w=y.move();c.element=m[w.start],l.addComponent(G1.getEntryFromLocation(c),f)}}a.throwIfTimedOut()}}for(var A=a.inputStructure.subsetBuilder(!0),M=0,D=a.inputStructure.units;M<D.length;M++){var p=D[M];if(p.kind===0){c.unit=p;var m=p.elements,g=ar.transientSegments(p.model.atomicHierarchy.chainAtomSegments,m),y=ar.transientSegments(p.model.atomicHierarchy.residueAtomSegments,m);for(A.beginUnit(p.id);g.hasNext;){var b=g.move();c.element=m[b.start];var S=lt.chain.label_asym_id(c),x=lt.unit.operator_name(c);if(d.has(S)&&d.get(S).indexOf(x)>=0){A.addElementRange(m,b.start,b.end);continue}if(f.hasLabelAsymId(S))for(y.setSegment(b);y.hasNext;){var w=y.move();c.element=m[w.start],f.has(c)&&A.addElementRange(m,w.start,w.end)}}A.commitUnit(),a.throwIfTimedOut()}}var k=Zb(a.inputStructure,[A.getStructure(),o]);if(n){for(var R=new JE(a.inputStructure),O=a.inputStructure.lookup3d,H=0,B=k.units;H<B.length;H++){for(var p=B[H],j=p.conformation,Y=j.x,G=j.y,$=j.z,m=p.elements,q=0,ee=m.length;q<ee;q++){var fe=m[q];O.findIntoBuilderIf(Y(fe),G(fe),$(fe),r,R,d7e),R.addToUnit(p.id,fe)}a.throwIfTimedOut()}return mt.Sequence(a.inputStructure,[R.getStructure()])}else return mt.Sequence(a.inputStructure,[k])}}var c7e=lt.entity.type;function d7e(e){return c7e(e)==="water"}function f7e(e){var t=e.models[0],r=new Set;if(!un.is(t.sourceData))return r;for(var n=t.sourceData.data.db.pdbx_molecule,i=n._rowCount,a=n.asym_id,o=0;o<i;o++)r.add(a.value(o));return r}function h7e(e){var t,r,n=e.models[0],i=new p7e;if(!un.is(n.sourceData))return i;for(var a=n.sourceData.data.db.struct_conn,o=a.conn_type_id,s=a.ptnr1_label_asym_id,u=a.ptnr1_label_comp_id,l=a.ptnr1_label_seq_id,c=a.ptnr1_symmetry,d=a.pdbx_ptnr1_label_alt_id,f=a.pdbx_ptnr1_PDB_ins_code,h=a.ptnr2_label_asym_id,v=a.ptnr2_label_comp_id,p=a.ptnr2_label_seq_id,m=a.ptnr2_symmetry,g=a.pdbx_ptnr2_label_alt_id,y=a.pdbx_ptnr2_PDB_ins_code,b=0;b<a._rowCount;b++){var S=o.value(b);if(!(S!=="covale"&&S!=="metalc")){var x={label_asym_id:s.value(b),label_comp_id:u.value(b),label_seq_id:l.value(b),label_alt_id:d.value(b),ins_code:f.value(b),operator_name:(t=c.value(b))!==null&&t!==void 0?t:"1_555"},C={label_asym_id:h.value(b),label_comp_id:v.value(b),label_seq_id:p.value(b),label_alt_id:g.value(b),ins_code:y.value(b),operator_name:(r=m.value(b))!==null&&r!==void 0?r:"1_555"};i.addEdge(x,C)}}return i}var p7e=function(){function e(){this.vertices=new Map,this.edges=new Map}return e.prototype.addVertex=function(t,r){this.vertices.has(r)||(this.vertices.set(r,t),this.edges.set(r,[]))},e.prototype.addEdge=function(t,r){var n=G1.getLabel(t),i=G1.getLabel(r);this.addVertex(t,n),this.addVertex(r,i),ja(this.edges.get(n),i),ja(this.edges.get(i),n)},e.prototype.addComponent=function(t,r){var n=G1.getLabel(t);if(!this.vertices.has(n)){r.add(t);return}var i=new Set,a=new Set,o=[n];for(a.add(n),r.add(t);o.length>0;){var s=o.pop();i.add(s);for(var u=this.vertices.get(s),l=0,c=this.edges.get(s);l<c.length;l++){var d=c[l];if(!i.has(d)&&(o.push(d),!a.has(d))){a.add(d);var f=this.vertices.get(d);u.operator_name===f.operator_name?r.add(E(E({},f),{operator_name:t.operator_name})):r.add(f)}}}},e}();const v7e=Object.freeze(Object.defineProperty({__proto__:null,exceptBy:i7e,expandProperty:o7e,includeConnected:s7e,includeSurroundings:t7e,intersectBy:n7e,querySelection:r7e,surroundingLigands:l7e,union:a7e,wholeResidues:ZBe},Symbol.toStringTag,{value:"Module"}));function m7e(e,t,r,n,i,a){return t.elementCount===0||r.elementCount===0?!0:t.elementCount<=r.elementCount?xw.check(e,t,r,n,i,a):xw.check(e,r,t,n,i,a)}function g7e(e,t,r,n,i){return t.elementCount===0||r.elementCount===0?!0:t.elementCount<=r.elementCount?Sw.check(e,t,r,n,i):Sw.check(e,r,t,n,i)}var xw;(function(e){var t=_.zero();function r(o,s,u,l,c,d,f){var h=s.elements,v=s.conformation.position,p=t;o.element.unit=s;for(var m=!1,g=0,y=h.length;g<y;g++){var b=h[g];o.element.element=b;var S=Math.max(0,_.distance(u,v(b,p))-l-f(o));if(S<c)return 0;S<d&&(m=!0)}return m?1:2}function n(o,s,u,l,c,d,f){for(var h=s.units,v=!1,p=0,m=h.length;p<m;p++){var g=r(o,h[p],u,l,c,d,f);if(g===0)return 0;g===1&&(v=!0)}return v?1:2}e.toPoint=n;var i=_.zero();function a(o,s,u,l,c,d){if(s.elementCount===0||u.elementCount===0)return 0;var f=s.units,h=!1;o.element.structure=s;for(var v=0,p=f.length;v<p;v++){var m=f[v],g=m.elements,y=m.conformation.position;o.element.unit=m;for(var b=0,S=g.length;b<S;b++){var x=g[b];o.element.element=x;var C=n(o,u,y(x,i),d(o),l,c,d);if(C===0)return 0;C===1&&(h=!0)}}return h}e.check=a})(xw||(xw={}));var Sw;(function(e){var t=_.zero();function r(o,s,u,l,c,d){var f=s.elements,h=s.conformation.position,v=t;o.element.unit=s;for(var p=0,m=f.length;p<m;p++){var g=f[p];if(o.element.element=g,Math.max(0,_.distance(u,h(g,v))-l-d(o))<=c)return!0}return!1}function n(o,s,u,l,c,d){for(var f=s.units,h=0,v=f.length;h<v;h++)if(r(o,f[h],u,l,c,d))return!0;return!1}e.toPoint=n;var i=_.zero();function a(o,s,u,l,c){if(s.elementCount===0||u.elementCount===0)return 0;var d=s.units;o.element.structure=s;for(var f=0,h=d.length;f<h;f++){var v=d[f];o.element.unit=v;for(var p=v.elements,m=v.conformation.position,g=0,y=p.length;g<y;g++){var b=p[g];if(o.element.element=b,n(o,u,m(b,i),c(o),l,c))return!0}}return!1}e.check=a})(Sw||(Sw={}));function y7e(e,t){return function(r){var n=e(r),i=mt.LinearBuilder(r.inputStructure);return r.pushCurrentElement(),mt.forEach(n,function(a,o){r.currentStructure=a,t(r)&&i.add(a),o%100&&r.throwIfTimedOut()}),r.popCurrentStructure(),i.getSelection()}}function b7e(e){return function(t){var r=e(t),n=mt.LinearBuilder(t.inputStructure);if(r.kind==="singletons"){if(r.structure.elementCount>0){var i=r.structure.units[0],a=We.create([i.getChild(Je.ofSingleton(i.elements[0]))],{parent:t.inputStructure});n.add(a)}}else r.structures.length>0&&n.add(r.structures[0]);return n.getSelection()}}function cF(e,t,r){var n=e.currentStructure.units,i=e.pushCurrentElement();i.structure=e.currentStructure;for(var a=0,o=n;a<o.length;a++){var s=o[a];i.unit=s;var u=s.elements,l=void 0;if(je.isAtomic(s)?l=t.atomic:l=t.coarse,!!l){for(var c=0,d=u.length;c<d;c++)i.element=u[c],r.add(l(e));e.throwIfTimedOut()}}return e.popCurrentElement(),r}function x7e(e,t,r){var n=new Set,i=t(e);return e.pushCurrentElement(),mt.forEach(i,function(a,o){e.currentStructure=a,cF(e,r,n),o%10&&e.throwIfTimedOut()}),e.popCurrentElement(),n}function S7e(e,t,r){return function(n){var i=e(n),a=x7e(n,t,r),o=mt.LinearBuilder(n.inputStructure);return n.pushCurrentStructure(),mt.forEach(i,function(s,u){n.currentStructure=s;var l=cF(n,r,new Set);gi.isSuperset(l,a)&&o.add(s),u%10&&n.throwIfTimedOut()}),n.popCurrentStructure(),o.getSelection()}}function C7e(e,t){return function(r){var n=mt.unionStructure(t(r)),i=mt.LinearBuilder(r.inputStructure);return mt.forEach(e(r),function(a,o){ZE(n,a)&&i.add(a),o%10&&r.throwIfTimedOut()}),i.getSelection()}}function _7e(e){return function(t){var r={queryCtx:t,selection:e.query(t),target:e.target(t),maxRadius:e.maxRadius,minRadius:e.minRadius?Math.max(0,e.minRadius):0,elementRadius:e.elementRadius,invert:!!e.invert};return r.minRadius===0&&typeof e.minRadius>"u"?w7e(r):r.minRadius===0?E7e(r):A7e(r)}}function w7e(e){var t=e.queryCtx,r=e.selection,n=e.target,i=e.maxRadius,a=e.invert,o=mt.unionStructure(n).lookup3d,s=mt.LinearBuilder(t.inputStructure),u=_.zero();return mt.forEach(r,function(l,c){for(var d=l.units,f=!1,h=0,v=d.length;h<v;h++){for(var p=d[h],m=p.elements,g=p.conformation,y=g.position,b=g.r,S=0,x=m.length;S<x;S++){var C=m[S];if(y(C,u),o.check(u[0],u[1],u[2],i+b(C))){f=!0;break}}if(f)break}a&&(f=!f),f&&s.add(l),c%10===0&&t.throwIfTimedOut()}),s.getSelection()}function E7e(e){var t=e.queryCtx,r=e.selection,n=e.target,i=e.maxRadius,a=e.invert,o=e.elementRadius,s=mt.unionStructure(n),u=mt.LinearBuilder(t.inputStructure);return t.pushCurrentElement(),mt.forEach(r,function(l,c){var d=g7e(t,s,l,i,o);a&&(d=!d),d&&u.add(l),c%10===0&&t.throwIfTimedOut()}),t.popCurrentElement(),u.getSelection()}function A7e(e){var t=e.queryCtx,r=e.selection,n=e.target,i=e.minRadius,a=e.maxRadius,o=e.invert,s=e.elementRadius,u=mt.unionStructure(n),l=mt.LinearBuilder(t.inputStructure);return t.pushCurrentElement(),mt.forEach(r,function(c,d){var f=m7e(t,u,c,i,a,s);o&&(f=!f),f&&l.add(c),d%10===0&&t.throwIfTimedOut()}),t.popCurrentElement(),l.getSelection()}function P7e(e,t){var r=e.queryCtx,n=e.input,i=e.target,a=e.disjunct,o=r.atomicBond,s=n.interUnitBonds;o.setStructure(n);for(var u=0,l=t.units;u<l.length;u++){var c=l[u];if(je.isAtomic(c))for(var d=n.unitMap.get(c.id),f=d.bonds,h=f.offset,v=f.b,p=f.edgeProps,m=p.flags,g=p.order,y=s.getConnectedUnits(c.id),b=y.length,S=c.elements,x=d.elements,C=0,w=S.length;C<w;C++){var A=Je.indexOf(x,S[C]);o.a.unit=d,o.b.unit=d;for(var M=h[A],D=h[A+1];M<D;M++)if(o.b.element=d.elements[v[M]],!(a&&Je.has(c.elements,o.b.element))&&i.hasElement(o.b)&&(o.aIndex=A,o.a.element=S[C],o.bIndex=v[M],o.type=m[M],o.order=g[M],o.test(r,!0)))return!0;for(var k=0;k<b;k++)for(var R=y[k],O=n.unitMap.get(R.unitB),H=O.elements,B=R.getEdges(A),j=0,Y=B.length;j<Y;j++){var G=B[j];if(o.b.unit=O,o.b.element=H[G.indexB],!!i.hasElement(o.b)&&!(a&&t.hasElement(o.b))&&(o.a.unit=d,o.aIndex=A,o.a.element=S[C],o.bIndex=G.indexB,o.type=G.props.flag,o.order=G.props.order,o.test(r,!0)))return!0}}}return!1}function T7e(e){var t=e.query,r=e.target,n=e.disjunct,i=e.invert,a=e.bondTest;return function(o){var s=r(o);if(mt.isEmpty(s))return s;var u=t(o);if(mt.isEmpty(u))return u;var l={queryCtx:o,input:o.inputStructure,disjunct:n,target:mt.unionStructure(s)},c=mt.LinearBuilder(o.inputStructure);return o.pushCurrentBond(),o.atomicBond.setTestFn(a),mt.forEach(u,function(d,f){(P7e(l,d)||i)&&c.add(d),f%5===0&&o.throwIfTimedOut()}),o.popCurrentBond(),c.getSelection()}}const I7e=Object.freeze(Object.defineProperty({__proto__:null,areIntersectedBy:C7e,first:b7e,getCurrentStructureProperties:cF,isConnectedTo:T7e,pick:y7e,withSameAtomProperties:S7e,within:_7e},Symbol.toStringTag,{value:"Module"}));function M7e(e){return e.length===0?sF:e.length===1?e[0]:function(t){for(var r=mt.UniqueBuilder(t.inputStructure),n=function(a){mt.forEach(e[a](t),function(o,s){r.add(o),a%100&&t.throwIfTimedOut()})},i=0;i<e.length;i++)n(i);return r.getSelection()}}function D7e(e){return e.length===0?sF:e.length===1?e[0]:function(t){for(var r=[],n=0;n<e.length;n++)r.push(e[n](t));for(var i=0,a=mt.structureCount(r[0]),n=1;n<r.length;n++){var o=mt.structureCount(r[n]);o<a&&(i=n,a=o)}t.throwIfTimedOut();var s=V6(function(c){return c.hashCode},We.areUnitIdsAndIndicesEqual);mt.forEach(r[i],function(c){return s.add(c)});for(var u=mt.UniqueBuilder(t.inputStructure),l=0;l<r.length;l++)l!==i&&(mt.forEach(r[l],function(c){s.has(c)&&u.add(c)}),t.throwIfTimedOut());return u.getSelection()}}const R7e=Object.freeze(Object.defineProperty({__proto__:null,intersect:D7e,merge:M7e},Symbol.toStringTag,{value:"Module"}));var jD;(function(e){function t(f){return!!f&&!!f.has}function r(f,h){return function(v){return f(v)===h}}e.eq=r;function n(f,h){return function(v){return f(v)<h}}e.lt=n;function i(f,h){return function(v){return f(v)<=h}}e.lte=i;function a(f,h){return function(v){return f(v)>h}}e.gt=a;function o(f,h){return function(v){return f(v)>=h}}e.gte=o;function s(f){return!0}function u(f){return!1}function l(f,h){if(t(h))return function(m){return h.has(f(m))};if(h.length===0)return u;for(var v=new Set,p=0;p<h.length;p++)v.add(h[p]);return function(m){return v.has(f(m))}}e.inSet=l;function c(){for(var f=[],h=0;h<arguments.length;h++)f[h]=arguments[h];switch(f.length){case 0:return s;case 1:return f[0];case 2:{var v=f[0],p=f[1];return function($){return v($)&&p($)}}case 3:{var m=f[0],g=f[1],y=f[2];return function($){return m($)&&g($)&&y($)}}case 4:{var b=f[0],S=f[1],x=f[2],C=f[3];return function($){return b($)&&S($)&&x($)&&C($)}}case 5:{var w=f[0],A=f[1],M=f[2],D=f[3],k=f[4];return function($){return w($)&&A($)&&M($)&&D($)&&k($)}}case 6:{var R=f[0],O=f[1],H=f[2],B=f[3],j=f[4],Y=f[5];return function($){return R($)&&O($)&&H($)&&B($)&&j($)&&Y($)}}default:{var G=f.length;return function($){for(var q=0;q<G;q++)if(!f[q])return!1;return!0}}}}e.and=c;function d(){for(var f=[],h=0;h<arguments.length;h++)f[h]=arguments[h];switch(f.length){case 0:return u;case 1:return f[0];case 2:{var v=f[0],p=f[1];return function($){return v($)||p($)}}case 3:{var m=f[0],g=f[1],y=f[2];return function($){return m($)||g($)||y($)}}case 4:{var b=f[0],S=f[1],x=f[2],C=f[3];return function($){return b($)||S($)||x($)||C($)}}case 5:{var w=f[0],A=f[1],M=f[2],D=f[3],k=f[4];return function($){return w($)||A($)||M($)||D($)||k($)}}case 6:{var R=f[0],O=f[1],H=f[2],B=f[3],j=f[4],Y=f[5];return function($){return R($)||O($)||H($)||B($)||j($)||Y($)}}default:{var G=f.length;return function($){for(var q=0;q<G;q++)if(f[q])return!0;return!1}}}}e.or=d})(jD||(jD={}));var sn={generators:mBe,filters:I7e,modifiers:v7e,combinators:R7e,pred:jD,internal:aBe},Bl;(function(e){function t(c,d){var f=this;return $e.create("Build Assembly",function(h){return ce(f,void 0,void 0,function(){var v,p,m,g,y,b,S,x,C,w,A,M,D,k,R,O;return de(this,function(H){if(v=c.models,v.length!==1)throw new Error("Can only build assemblies from structures based on 1 model.");if(p=Wb.findAssembly(v[0],d),!p)throw new Error("Assembly '"+d+"' is not defined.");for(m=Cn.create(p.id,ue.identity(),{assembly:{id:p.id,operId:0,operList:[]}}),g=We.Builder({coordinateSystem:m,label:c.label}),y=new ps(c),b=0,S=p.operatorGroups;b<S.length;b++)if(x=S[b],C=x.selector(y),mt.structureCount(C)!==0)for(w=mt.unionStructure(C).units,A=0,M=x.operators;A<M.length;A++)for(D=M[A],k=0,R=w;k<R.length;k++)O=R[k],g.addWithOperator(O,D);return[2,g.getStructure()]})})})}e.buildAssembly=t;function r(c,d,f){var h=this;return $e.create("Build Symmetry Assembly",function(v){return ce(h,void 0,void 0,function(){var p,m,g,y,b,S,x,C,w,A,M,D,k,R,O,H,B,j,Y,G,$,q,ee,fe,W;return de(this,function(X){if(p=c.models,p.length!==1)throw new Error("Can only build symmetry assemblies from structures based on 1 model.");for(m=_(),g=We.Builder({label:c.label,representativeModel:p[0]}),y=new ps(c),b=0,S=d;b<S.length;b++)if(x=S[b],C=k7e(x.asymIds),w=C(y),mt.structureCount(w)!==0)for(A=mt.unionStructure(w).units,M=0,D=x.operators;M<D.length;M++)for(k=D[M],R=k.index,O=k.shift,H=O[0],B=O[1],j=O[2],Y=yee(f,R,H,B,j,m),G=0,$=A;G<$.length;G++)for(q=$[G],ee=0,fe=Y;ee<fe.length;ee++)W=fe[ee],g.addWithOperator(q,W);return[2,g.getStructure()]})})})}e.buildSymmetryAssembly=r;function n(c,d){return $e.create("Find Symmetry Mates",function(f){return N7e(f,c,d)})}e.builderSymmetryMates=n;function i(c,d,f){return $e.create("Build Symmetry",function(h){return L7e(h,c,d,f)})}e.buildSymmetryRange=i;function a(c){return $e.create("Build NCS",function(d){return F7e(d,c)})}e.buildNcs=a;function o(c,d){return c.invariantId===d.invariantId&&c.model.id===d.model.id&&Je.areEqual(c.elements,d.elements)}e.areUnitsEquivalent=o;function s(){return pMe(je.hashUnit,o)}e.UnitEquivalenceBuilder=s;function u(c){for(var d=s(),f=0,h=c.units;f<h.length;f++){var v=h[f];d.add(v.id,v)}for(var p=[],m=0,g=d.groups;m<g.length;m++){var y=g[m];p.push(je.SymmetryGroup(y.map(function(b){return c.unitMap.get(b)})))}return p}e.computeTransformGroups=u;function l(c,d){if(c.length!==d.length)return!1;for(var f=0,h=c.length;f<h;++f){var v=c[f].units,p=d[f].units;if(v.length!==p.length||c[f].hashCode!==d[f].hashCode)return!1;for(var m=0,g=v.length;m<g;m++)if(v[m].conformation!==p[m].conformation)return!1}return!0}e.areTransformGroupsEquivalent=l})(Bl||(Bl={}));function k7e(e){return sn.generators.atoms({chainTest:sn.pred.and(sn.pred.eq(function(t){return lt.unit.operator_name(t.element)},Cn.DefaultName),sn.pred.inSet(function(t){return lt.chain.label_asym_id(t.element)},e))})}function yee(e,t,r,n,i,a){var o=e.spacegroup,s=e.ncsOperators,u=[],l=o.cell.toFractional,c=_.transformMat4(_(),a,l),d=Xu.getSymmetryOperatorRef(o,t,r,n,i,c);if(s&&s.length)for(var f=0,h=s.length;f<h;++f){var v=s[f],p=ue.mul(ue(),d.matrix,v.matrix),m=Cn.create(d.name+" "+v.name,p,{assembly:d.assembly,ncsId:v.ncsId,hkl:d.hkl,spgrOp:d.spgrOp});u.push(m)}else u.push(d);return u}function bee(e,t,r,n){var i=e.spacegroup,a=e.ncsOperators,o=a&&a.length||0,s=[];!o&&t[0]<=0&&r[0]>=0&&t[1]<=0&&r[1]>=0&&t[2]<=0&&r[2]>=0&&(s[0]=Xu.getSymmetryOperator(i,0,0,0,0));for(var u=i.cell.toFractional,l=_.transformMat4(_(),n,u),c=0;c<i.operators.length;c++)for(var d=t[0];d<=r[0];d++)for(var f=t[1];f<=r[1];f++)for(var h=t[2];h<=r[2];h++)!o&&c===0&&d===0&&f===0&&h===0||s.push.apply(s,yee(e,c,d,f,h,l));return s}function O7e(e,t){return e._operators_333&&_.equals(t,e._operators_333.ref)||(e._operators_333={ref:_.clone(t),operators:bee(e,_.create(-3,-3,-3),_.create(3,3,3),t)}),e._operators_333.operators}function xee(e,t){for(var r=We.Builder({label:e.label}),n=e.units,i=0,a=t;i<a.length;i++)for(var o=a[i],s=0,u=n;s<u.length;s++){var l=u[s];r.addWithOperator(l,o)}return r.getStructure()}function F7e(e,t){return ce(this,void 0,void 0,function(){var r,n,i;return de(this,function(a){if(r=t.models,r.length!==1)throw new Error("Can only build NCS from structures based on 1 model.");return n=vi.Provider.get(r[0]),n?(i=n.ncsOperators,!i||!i.length?[2,t]:[2,xee(t,i)]):[2,t]})})}function L7e(e,t,r,n){return ce(this,void 0,void 0,function(){var i,a,o,s,u;return de(this,function(l){if(i=t.models,i.length!==1)throw new Error("Can only build symmetries from structures based on 1 model.");return a=vi.Provider.get(i[0]),a?(o=a.spacegroup,Fo.isZero(o.cell)?[2,t]:(s=Xt.getCenter(i[0]),u=bee(a,r,n,s),[2,xee(t,u)])):[2,t]})})}function N7e(e,t,r){return ce(this,void 0,void 0,function(){function n(D,k){return D.invariantId+"|"+k.name}var i,a,o,s,u,l,c,d,f,h,v,p,m,g,y,b,S,x,C,w,A,M;return de(this,function(D){switch(D.label){case 0:if(i=t.models,i.length!==1)throw new Error("Can only build symmetries from structures based on 1 model.");return a=vi.Provider.get(i[0]),a?(o=a.spacegroup,Fo.isZero(o.cell)?[2,t]:e.shouldUpdate?[4,e.update("Initialing...")]:[3,2]):[2,t];case 1:D.sent(),D.label=2;case 2:s=Xt.getCenter(i[0]),u=O7e(a,s),l=t.lookup3d,c=new Set,d=We.Builder({label:t.label}),f=t.units,h=_.zero(),v=0,p=u,D.label=3;case 3:if(!(v<p.length))return[3,6];for(m=p[v],g=0,y=f;g<y.length;g++)for(b=y[g],S=b.lookup3d.boundary.sphere,_.transformMat4(h,S.center,m.matrix),x=l.findUnitIndices(h[0],h[1],h[2],S.radius+r),C=0,w=x.count;C<w;C++)A=f[x.indices[C]],A.lookup3d.check(h[0],h[1],h[2],S.radius+r)&&(M=n(b,m),c.has(M)||(d.addWithOperator(b,m),c.add(M)));return e.shouldUpdate?[4,e.update("Building symmetry...")]:[3,5];case 4:D.sent(),D.label=5;case 5:return v++,[3,3];case 6:return[2,d.getStructure()]}})})}var B7e=function(){function e(t,r){this.parent=t,this.isSorted=r,this.ids=[],this.unitMap=Qs.Mutable(),this.parentId=-1,this.currentUnit=[],this.elementCount=0}return e.prototype.addToUnit=function(t,r){var n=this.unitMap.get(t);n?n[n.length]=r:(this.unitMap.set(t,[r]),this.ids[this.ids.length]=t),this.elementCount++},e.prototype.beginUnit=function(t){this.parentId=t,this.currentUnit=this.currentUnit.length>0?[]:this.currentUnit},e.prototype.addElement=function(t){this.currentUnit[this.currentUnit.length]=t,this.elementCount++},e.prototype.addElementRange=function(t,r,n){for(var i=r;i<n;i++)this.currentUnit[this.currentUnit.length]=t[i],this.elementCount++},e.prototype.commitUnit=function(){this.currentUnit.length!==0&&(this.ids[this.ids.length]=this.parentId,this.unitMap.set(this.parentId,this.currentUnit),this.parentId=-1)},e.prototype.setUnit=function(t,r){this.ids[this.ids.length]=t,this.unitMap.set(t,r),this.elementCount+=r.length},e.prototype._getStructure=function(t){if(this.isEmpty)return We.Empty;var r=[];Ou(this.ids);for(var n=Bl.UnitEquivalenceBuilder(),i=0,a=this.ids.length;i<a;i++){var o=this.ids[i],s=this.parent.unitMap.get(o),u=this.unitMap.get(o),l=!1;t&&(this.isSorted||Ou(u),u=Je.deduplicate(Je.ofSortedArray(this.currentUnit)),l=!0);var c=u.length;if(u.length===s.elements.length){r[r.length]=s,n.add(s.id,s);continue}!this.isSorted&&!l&&c>1&&Ou(u);var d=s.getChild(Je.ofSortedArray(u)),f=n.add(d.id,d);d!==f&&(d=f.applyOperator(d.id,d.conformation.operator,!0)),r[r.length]=d}return We.create(r,{parent:this.parent})},e.prototype.getStructure=function(){return this._getStructure(!1)},e.prototype.getStructureDeduplicate=function(){return this._getStructure(!0)},e.prototype.setSingletonLocation=function(t){var r=this.ids[0];t.unit=this.parent.unitMap.get(r),t.element=this.unitMap.get(r)[0]},Object.defineProperty(e.prototype,"isEmpty",{get:function(){return this.elementCount===0},enumerable:!1,configurable:!0}),e}();function Fj(e,t){for(var r=1;t--;)r*=e--;return r}function U7e(e,t){return t>e?0:Fj(e,t)/Fj(t,t)}function j7e(e){var t=e&-e,r=e+t,n=r&-r,i=(n/t>>1)-1;return r|i}var z7e=function(){function e(t,r){this.array=t,this.hasNext=!1,this.index=(1<<r)-1,this.size=U7e(t.length,r),this.maxIndex=1<<t.length,this.value=new Array(r),this.hasNext=r>0&&r<=t.length}return e.prototype.move=function(){if(this.hasNext){for(var t=0,r=0,n=this.index;n;n>>>=1,t++)n&1&&(this.value[r++]=this.array[t]);this.index=j7e(this.index),this.hasNext=this.index<this.maxIndex}return this.value},e}();function See(e,t){for(var r=[],n=new z7e(e,t);n.hasNext;)r.push(n.move().slice());return r}var tp=[],V7e={links:tp,terminalLinks:tp,elements:tp,partialElements:tp,getElementIndices:function(){return tp},getLinkIndices:function(){return tp},getTerminalLinkIndices:function(){return tp}},Di=V0("C"),g1=V0("O"),H7e=[Vs.elementFingerprint([Di,Di,Di,g1]),Vs.elementFingerprint([Di,Di,Di,Di,g1]),Vs.elementFingerprint([Di,Di,Di,Di,Di,g1]),Vs.elementFingerprint([Di,Di,Di,Di,Di,Di,g1])];function G7e(e,t){for(var r=-1,n=-1,i=-1,a=-1,o=e.elements,s=e.model.atomicHierarchy.atoms,u=s.type_symbol,l=s.label_atom_id,c=e.bonds,d=c.b,f=c.offset,h=0,v=t.length;h<v;++h){var p=o[t[h]];if(u.value(p)===Di){for(var m=0,g=0,y=f[t[h]],b=f[t[h]+1];y<b;++y){var S=o[d[y]],x=u.value(S);x===g1?++m:x===Di&&++g}if(m===2){r=p;break}else m===1&&g===1?n=p:l.value(p).startsWith("C1")?i=p:a=p}}return r!==-1?r:n!==-1?n:i!==-1?i:a!==-1?a:o[t[0]]}function q7e(e,t){var r=e.elements,n=e.model.atomicHierarchy.atoms.label_alt_id;return n.value(r[t])}function $7e(e,t,r,n){var i=t.conformation.position;return _.normalize(e,_.sub(e,n,i(r,e))),e}function Lj(e,t){var r=e.elements,n=e.model.atomicHierarchy.atoms.label_atom_id;return n.value(r[t])}function W7e(e,t){if(!(!t||!t.length)){for(var r=e.unit,n=e.all,i=new Set,a=See(Js(new Array(t.length)),2),o=0,s=a.length;o<s;++o){var u=a[o],l=n[t[u[0]]],c=n[t[u[1]]];Je.areIntersecting(l,c)&&Vs.getAltId(r,l)===Vs.getAltId(r,c)&&(i.add(t[u[0]]),i.add(t[u[1]]))}if(i.size){for(var d=[],o=0,s=t.length;o<s;++o)i.has(t[o])||d.push(t[o]);return d}else return t}}function X7e(e,t){return t.properties.saccharideComponentMap.get(e)}function Y7e(e){if(e.models.reduce(function(be,Ae){return be+Ae.properties.saccharideComponentMap.size},0)===0)return V7e;var t=[],r=[],n=[],i=[],a=new Map;function o(be,Ae,Se){return be+"|"+Ae+"|"+Se}function s(be,Ae){a.has(be)?a.get(be).push(Ae):a.set(be,[Ae])}function u(be,Ae){_.sub(n[be].geometry.direction,n[Ae].geometry.center,n[be].geometry.center),_.normalize(n[be].geometry.direction,n[be].geometry.direction)}var l=_.zero();function c(be,Ae,Se){var ie=Se.conformation.position,oe=n[be].geometry;_.sub(oe.direction,ie(Se.elements[Ae],l),oe.center),_.normalize(oe.direction,oe.direction)}for(var d=0,f=e.units.length;d<f;++d){var h=e.units[d];if(je.isAtomic(h))for(var v=h.model,p=h.rings,m=v.atomicHierarchy,g=m.chainAtomSegments,y=m.residueAtomSegments,b=m.atoms,S=b.label_comp_id,x=ar.transientSegments(g,h.elements),C=ar.transientSegments(y,h.elements),w=void 0;x.hasNext;)for(C.setSegment(x.move());C.hasNext;){var A=C.move().index,M=X7e(S.value(y.offsets[A]),v);if(M){w||(w=gw.byFingerprintAndResidue(p,H7e));var D=W7e(p,w.get(A));if(!D||!D.length){i.push({unit:h,residueIndex:A,component:M});continue}for(var k=[],R=0,O=D.length;R<O;++R){var H=p.all[D[R]],B=G7e(h,H),j=kv.calculateMomentsAxes(NJ(h,H)),Y=_.copy(_.zero(),j.origin),G=_.copy(_.zero(),j.dirC),$=$7e(_.zero(),h,B,Y);_.orthogonalize($,G,$);var q=Vs.getAltId(h,H),ee=n.length;k.push(ee),s(o(A,h.id,q),ee),q&&s(o(A,h.id,""),ee),n.push({geometry:{center:Y,normal:G,direction:$},component:M,ringIndex:D[R],altId:q,unit:h,residueIndex:A})}for(var fe=See(Js(new Array(D.length)),2),R=0,O=fe.length;R<O;++R){var W=fe[R],X=p.all[D[W[0]]],U=p.all[D[W[1]]];if(Oo.areVertexSetsConnected(h.bonds,X,U,3)){var z=k[W[0]],J=k[W[1]];n[z].altId===n[J].altId&&(u(z,J),u(J,z),t.push({carbohydrateIndexA:z,carbohydrateIndexB:J}),t.push({carbohydrateIndexA:J,carbohydrateIndexB:z}))}}}}}function K(be,Ae){return a.get(o(be.getResidueIndex(Ae),be.id,q7e(be,Ae)))||[]}for(var d=0,f=n.length;d<f;++d)for(var Z=n[d],h=Z.unit,R=d+1;R<f;++R){var te=n[R];if(!(h!==te.unit||Z.residueIndex===te.residueIndex)){var le=h.rings.all[Z.ringIndex],ye=h.rings.all[te.ringIndex];Oo.areVertexSetsConnected(h.bonds,le,ye,3)&&(u(d,R),u(R,d),t.push({carbohydrateIndexA:d,carbohydrateIndexB:R}),t.push({carbohydrateIndexA:R,carbohydrateIndexB:d}))}}for(var d=0,f=e.units.length;d<f;++d){var h=e.units[d];je.isAtomic(h)&&e.interUnitBonds.getConnectedUnits(h.id).forEach(function(ie){ie.connectedIndices.forEach(function(oe){ie.getEdges(oe).forEach(function(F){var V=F.props,pe=F.indexB;if(Hr.isCovalent(V.flag)){var we=e.unitMap.get(ie.unitA),Te=e.unitMap.get(ie.unitB),ze=K(we,oe),Ve=K(Te,pe);if(ze.length>0&&Ve.length>0)for(var Xe=ze.length,ct=Ve.length,Ne=0,Qe=Math.max(Xe,ct);Ne<Qe;++Ne){var it=ze[Math.min(Ne,Xe-1)],ot=Ve[Math.min(Ne,ct-1)],dt=Lj(we,oe);(dt.startsWith("O1")||dt.startsWith("C1"))&&u(it,ot),t.push({carbohydrateIndexA:it,carbohydrateIndexB:ot})}else if(Ve.length===0)for(var ke=0,Me=ze;ke<Me.length;ke++){var it=Me[ke],dt=Lj(we,oe);(dt.startsWith("O1")||dt.startsWith("C1"))&&c(it,pe,Te),r.push({carbohydrateIndex:it,elementIndex:pe,elementUnit:Te,fromCarbohydrate:!0})}else if(ze.length===0)for(var Ye=0,tt=Ve;Ye<tt.length;Ye++){var ot=tt[Ye];r.push({carbohydrateIndex:ot,elementIndex:oe,elementUnit:we,fromCarbohydrate:!1})}}})})})}return E({links:t,terminalLinks:r,elements:n,partialElements:i},K7e(n,t,r))}function K7e(e,t,r){function n(O,H){return ph(O.id,H)}function i(O,H,B){var j=[],Y=O.get(n(H,B));if(Y!==void 0)for(var G=0,$=Y;G<$.length;G++){var q=$[G];ja(j,q)}return j}for(var a=new Map,o=0,s=e.length;o<s;++o)for(var u=e[o],l=u.unit,c=u.ringIndex,d=l.rings.all[c],f=0,h=d.length;f<h;++f){var v=n(l,l.elements[d[f]]),p=a.get(v);p===void 0?a.set(v,[o]):p.push(o)}function m(O,H){return i(a,O,H)}for(var g=new Map,o=0,s=t.length;o<s;++o)for(var y=t[o],b=e[y.carbohydrateIndexA],l=b.unit,c=b.ringIndex,d=l.rings.all[c],f=0,h=d.length;f<h;++f){var v=n(l,l.elements[d[f]]),p=g.get(v);p===void 0?g.set(v,[o]):p.push(o)}function S(O,H){return i(g,O,H)}for(var x=new Map,o=0,s=r.length;o<s;++o){var C=r[o],w=C.fromCarbohydrate,A=C.carbohydrateIndex,M=C.elementUnit,D=C.elementIndex;if(w)for(var k=e[A],l=k.unit,c=k.ringIndex,d=l.rings.all[c],f=0,h=d.length;f<h;++f){var v=n(l,l.elements[d[f]]),p=x.get(v);p===void 0?x.set(v,[o]):p.push(o)}else{var v=n(M,M.elements[D]),p=x.get(v);p===void 0?x.set(v,[o]):p.push(o)}}function R(O,H){return i(x,O,H)}return{getElementIndices:m,getLinkIndices:S,getTerminalLinkIndices:R}}var Qx=Be(),Q7e=new bs("14"),Z7e=new bs("98");function J7e(e){return e>500?Q7e:Z7e}function e9e(e){var t=e.units,r=J7e(t.length);r.reset();for(var n=0,i=t.length;n<i;n++){var a=t[n],o=a.boundary,s=a.conformation.operator;s.isIdentity?r.includeSphere(o.sphere):(Be.transform(Qx,o.sphere,s.matrix),r.includeSphere(Qx))}r.finishedIncludeStep();for(var n=0,i=t.length;n<i;n++){var a=t[n],o=a.boundary,s=a.conformation.operator;s.isIdentity?r.radiusSphere(o.sphere):(Be.transform(Qx,o.sphere,s.matrix),r.radiusSphere(Qx))}return{box:r.getBox(),sphere:r.getSphere()}}var We=function(){function e(t,r,n,i,a){this.units=t,this.unitMap=r,this.unitIndexMap=n,this.state=i,this._child=a==null?void 0:a.child,this._target=a==null?void 0:a.target}return e.prototype.subsetBuilder=function(t){return new B7e(this,t)},Object.defineProperty(e.prototype,"elementCount",{get:function(){return this.state.elementCount},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"bondCount",{get:function(){return this.state.bondCount===-1&&(this.state.bondCount=this.interUnitBonds.edgeCount+Ht.getIntraUnitBondCount(this)),this.state.bondCount},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasCustomProperties",{get:function(){return!!this.state.customProps&&this.state.customProps.all.length>0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"customPropertyDescriptors",{get:function(){return this.state.customProps||(this.state.customProps=new nc),this.state.customProps},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"currentPropertyData",{get:function(){return this.state.propertyData||(this.state.propertyData=Object.create(null)),this.state.propertyData},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"inheritedPropertyData",{get:function(){return this.parent?this.parent.currentPropertyData:this.currentPropertyData},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"polymerResidueCount",{get:function(){return this.state.polymerResidueCount===-1&&(this.state.polymerResidueCount=u9e(this)),this.state.polymerResidueCount},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"polymerGapCount",{get:function(){return this.state.polymerGapCount===-1&&(this.state.polymerGapCount=l9e(this)),this.state.polymerGapCount},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"polymerUnitCount",{get:function(){return this.state.polymerUnitCount===-1&&(this.state.polymerUnitCount=c9e(this)),this.state.polymerUnitCount},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"uniqueElementCount",{get:function(){return this.state.uniqueElementCount===-1&&(this.state.uniqueElementCount=s9e(this)),this.state.uniqueElementCount},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"atomicResidueCount",{get:function(){return this.state.atomicResidueCount===-1&&(this.state.atomicResidueCount=d9e(this)),this.state.atomicResidueCount},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isCoarseGrained",{get:function(){return this.models.some(function(t){return Xt.isCoarseGrained(t)})},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isEmpty",{get:function(){return this.units.length===0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hashCode",{get:function(){return this.state.hashCode!==-1?this.state.hashCode:this.computeHash()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"transformHash",{get:function(){return this.state.transformHash!==-1?this.state.transformHash:(this.state.transformHash=Xa(this.units.map(function(t){return t.id})),this.state.transformHash)},enumerable:!1,configurable:!0}),e.prototype.computeHash=function(){for(var t=23,r=0,n=this.units.length;r<n;r++){var i=this.units[r];t=31*t+i.id|0,t=31*t+Je.hashCode(i.elements)|0}return t=31*t+this.elementCount|0,t=bZ(t),t===-1&&(t=0),this.state.hashCode=t,t},e.prototype.elementLocations=function(){return new e.ElementLocationIterator(this)},Object.defineProperty(e.prototype,"root",{get:function(){return this.state.parent||this},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){return this.state.parent},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"coordinateSystem",{get:function(){return this.state.coordinateSystem},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"label",{get:function(){return this.state.label},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"boundary",{get:function(){return this.state.boundary?this.state.boundary:(this.state.boundary=e9e(this),this.state.boundary)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"lookup3d",{get:function(){return this.state.lookup3d?this.state.lookup3d:(this.state.lookup3d=new Z8e(this),this.state.lookup3d)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"interUnitBonds",{get:function(){return this.state.interUnitBonds?this.state.interUnitBonds:(this.state.interUnitBonds=x8e(this),this.state.interUnitBonds)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"unitSymmetryGroups",{get:function(){return this.state.unitSymmetryGroups?this.state.unitSymmetryGroups:(this.state.unitSymmetryGroups=Bl.computeTransformGroups(this),this.state.unitSymmetryGroups)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"unitSymmetryGroupsIndexMap",{get:function(){return this.state.unitSymmetryGroupsIndexMap?this.state.unitSymmetryGroupsIndexMap:(this.state.unitSymmetryGroupsIndexMap=je.SymmetryGroup.getUnitSymmetryGroupsIndexMap(this.unitSymmetryGroups),this.state.unitSymmetryGroupsIndexMap)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"carbohydrates",{get:function(){return this.state.carbohydrates?this.state.carbohydrates:(this.state.carbohydrates=Y7e(this),this.state.carbohydrates)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"models",{get:function(){return this.state.models?this.state.models:(this.state.models=r9e(this),this.state.models)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"uniqueResidueNames",{get:function(){return this.state.uniqueResidueNames||(this.state.uniqueResidueNames=n9e(this))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"uniqueElementSymbols",{get:function(){return this.state.uniqueElementSymbols||(this.state.uniqueElementSymbols=i9e(this))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"entityIndices",{get:function(){return this.state.entityIndices||(this.state.entityIndices=a9e(this))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"uniqueAtomicResidueIndices",{get:function(){return this.state.uniqueAtomicResidueIndices||(this.state.uniqueAtomicResidueIndices=o9e(this))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isAtomic",{get:function(){for(var t=0,r=this.units;t<r.length;t++){var n=r[t];if(!je.isAtomic(n))return!1}return!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasAtomic",{get:function(){for(var t=0,r=this.units;t<r.length;t++){var n=r[t];if(je.isAtomic(n))return!0}return!1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isCoarse",{get:function(){for(var t=0,r=this.units;t<r.length;t++){var n=r[t];if(!je.isCoarse(n))return!1}return!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasCoarse",{get:function(){for(var t=0,r=this.units;t<r.length;t++){var n=r[t];if(je.isCoarse(n))return!0}return!1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"serialMapping",{get:function(){return this.state.serialMapping||(this.state.serialMapping=f9e(this))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"model",{get:function(){if(this.state.model)return this.state.model;if(this.state.representativeModel)return this.state.representativeModel;if(this.state.masterModel)return this.state.masterModel;var t=this.models;if(t.length>1)throw new Error("The structure is based on multiple models and has neither a master- nor a representative-model.");return this.state.model=t[0],this.state.model},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"masterModel",{get:function(){return this.state.masterModel},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"representativeModel",{get:function(){return this.state.representativeModel},enumerable:!1,configurable:!0}),e.prototype.hasElement=function(t){return this.unitMap.has(t.unit.id)?Je.has(this.unitMap.get(t.unit.id).elements,t.element):!1},e.prototype.getModelIndex=function(t){return this.models.indexOf(t)},e.prototype.remapModel=function(t){for(var r=[],n=0,i=this.unitSymmetryGroups;n<i.length;n++){var a=i[n],o=a.units[0].remapModel(t);r.push(o);for(var s=1,u=a.units.length;s<u;++s){var l=a.units[s];r.push(l.remapModel(t,o.props))}}return e.create(r,{label:this.label,interUnitBonds:this.state.interUnitBonds})},e.prototype.asParent=function(){return this._proxy?this._proxy:(this._proxy=this.parent?new e(this.parent.units,this.parent.unitMap,this.parent.unitIndexMap,this.parent.state,{child:this,target:this.parent}):this,this._proxy)},Object.defineProperty(e.prototype,"child",{get:function(){return this._child},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"target",{get:function(){var t;return(t=this._target)!==null&&t!==void 0?t:this},enumerable:!1,configurable:!0}),e}();function t9e(e,t,r){return e[t].id-e[r].id}function r9e(e){for(var t=e.units,r=an.create(),n=0,i=t;n<i.length;n++){var a=i[n];an.add(r,a.model.id,a.model)}return r.array}function n9e(e){for(var t=lt.residue.microheterogeneityCompIds,r=new Set,n=Ze.create(e),i=0,a=e.unitSymmetryGroups;i<a.length;i++){var o=a[i],s=o.units[0];if(je.isAtomic(s)){var u=ar.transientSegments(s.model.atomicHierarchy.residueAtomSegments,s.elements);for(n.unit=s;u.hasNext;){var l=u.move();n.element=s.elements[l.start];for(var c=t(n),d=0,f=c;d<f.length;d++){var h=f[d];r.add(h)}}}}return r}function i9e(e){for(var t=lt.atom.type_symbol,r=new Set,n=Ze.create(e),i=0,a=e.unitSymmetryGroups;i<a.length;i++){var o=a[i],s=o.units[0];if(je.isAtomic(s)){n.unit=s;for(var u=0,l=s.elements.length;u<l;++u)n.element=s.elements[u],r.add(t(n))}}return r}function a9e(e){for(var t=e.units,r=Ze.create(e),n=an.create(),i=0,a=t;i<a.length;i++){var o=a[i],s=o.kind===0?lt.entity.key:lt.coarse.entityKey;r.unit=o;for(var u=o.elements,l=ar.transientSegments(o.model.atomicHierarchy.chainAtomSegments,u);l.hasNext;){var c=l.move();r.element=u[c.start];var d=s(r);an.add(n,d,d)}}return Ou(n.array),n.array}function o9e(e){for(var t=new Map,r=[],n=e.unitSymmetryGroups,i=0,a=n;i<a.length;i++){var o=a[i],s=o.units[0];if(je.isAtomic(s)){var u=void 0;t.has(s.model.id)?u=t.get(s.model.id):(u=an.create(),r.push(s.model.id),t.set(s.model.id,u));for(var l=ar.transientSegments(s.model.atomicHierarchy.residueAtomSegments,s.elements);l.hasNext;){var c=l.move();an.add(u,c.index,c.index)}}}for(var d=new Map,f=0,h=r;f<h.length;f++){var v=h[f],p=t.get(v).array;Ou(p),d.set(v,p)}return d}function s9e(e){for(var t=e.unitSymmetryGroups,r=0,n=0,i=t.length;n<i;n++)r+=t[n].elements.length;return r}function u9e(e){for(var t=e.units,r=0,n=0,i=t.length;n<i;n++)r+=t[n].polymerElements.length;return r}function l9e(e){for(var t=e.units,r=0,n=0,i=t.length;n<i;n++)r+=t[n].gapElements.length/2;return r}function c9e(e){for(var t=e.units,r=0,n=0,i=t.length;n<i;n++)t[n].polymerElements.length>0&&(r+=1);return r}function d9e(e){for(var t=e.units,r=0,n=0,i=t.length;n<i;n++){var a=t[n];if(je.isAtomic(a))for(var o=a.elements,s=a.residueIndex,u=-1,l=-1,c=0,d=o.length;c<d;++c)u=s[o[c]],u!==l&&(r+=1,l=u)}return r}function f9e(e){for(var t=e.units,r=e.elementCount,n=e.unitIndexMap,i=new Uint32Array(t.length),a=new Uint32Array(r),o=new Uint32Array(r),s=0,u=0,l=t.length;s<l;++s){i[s]=u;for(var c=t[s].elements,d=0,f=c.length;d<f;++d){var h=u+d;a[h]=s,o[h]=c[d]}u+=c.length}return{cumulativeUnitElementCount:i,unitIndices:a,elementIndices:o,getSerialIndex:function(v,p){return i[n.get(v.id)]+Fe.indexOf(v.elements,p)}}}(function(e){e.Empty=u([]);function t(U){return{kind:"structure-loci",structure:U}}e.Loci=t;function r(U){for(var z=[],J=0,K=U.units;J<K.length;J++){var Z=K[J];z.push({unit:Z,indices:Ie.ofBounds(0,Z.elements.length)})}return Re(U,z)}e.toStructureElementLoci=r;function n(U,z){return mt.toLociWithSourceUnits(mt.Singletons(U,z))}e.toSubStructureElementLoci=n;function i(U){return!!U&&U.kind==="structure-loci"}e.isLoci=i;function a(U,z){return U.structure===z.structure}e.areLociEqual=a;function o(U){return U.structure.isEmpty}e.isLociEmpty=o;function s(U,z){return z===U.structure?U:t(z)}e.remapLoci=s;function u(U,z){z===void 0&&(z={});for(var J=Qs.Mutable(),K=Qs.Mutable(),Z=0,te=!0,le=U.length>0?U[0].id:0,ye=0,be=U.length;ye<be;ye++){var Ae=U[ye];J.set(Ae.id,Ae),Z+=Ae.elements.length,Ae.id<le&&(te=!1),le=Ae.id}te||yZ(U,0,U.length,t9e,Vp);for(var ye=0,be=U.length;ye<be;ye++)K.set(U[ye].id,ye);var Se={hashCode:-1,transformHash:-1,elementCount:Z,bondCount:-1,uniqueElementCount:-1,atomicResidueCount:-1,polymerResidueCount:-1,polymerGapCount:-1,polymerUnitCount:-1,coordinateSystem:Cn.Default,label:""};return z.parent&&(Se.parent=z.parent.parent||z.parent),z.interUnitBonds&&(Se.interUnitBonds=z.interUnitBonds),z.coordinateSystem?Se.coordinateSystem=z.coordinateSystem:z.parent&&(Se.coordinateSystem=z.parent.coordinateSystem),z.label?Se.label=z.label:z.parent&&(Se.label=z.parent.label),z.masterModel?Se.masterModel=z.masterModel:z.parent&&(Se.masterModel=z.parent.masterModel),z.representativeModel?Se.representativeModel=z.representativeModel:z.parent&&(Se.representativeModel=z.parent.representativeModel),new e(U,J,K,Se)}e.create=u;function l(U,z){return ce(this,void 0,void 0,function(){var J,K,Z,te,le,ye,be,Ae,Se,ie,oe,F,V;return de(this,function(pe){switch(pe.label){case 0:if(U.frameCount===0)return[2,e.Empty];J=[],K=void 0,Z=0,te=0,le=U.frameCount,pe.label=1;case 1:return te<le?[4,$e.resolveInContext(U.getFrameAtIndex(te),z)]:[3,4];case 2:for(ye=pe.sent(),K||(K=ye),be=c(ye),Ae=0,Se=be.units.length;Ae<Se;++Ae)ie=be.units[Ae],oe=ie.invariantId+Z,F=ie.chainGroupId+Z,V=je.create(J.length,oe,F,ie.traits,ie.kind,ie.model,ie.conformation.operator,ie.elements),J.push(V);Z=J.length,pe.label=3;case 3:return++te,[3,1];case 4:return[2,u(J,{representativeModel:K,label:K.label})]}})})}e.ofTrajectory=l;function c(U){for(var z=U.atomicHierarchy.chainAtomSegments,J=U.atomicHierarchy.index,K=U.atomicHierarchy.chains.auth_asym_id,Z=U.atomicChainOperatorMappinng,te=new v({label:U.label}),le=0;le<z.count;le++){var ye=Z.get(le)||Cn.Default,be=z.offsets[le];Mv.chainResidueCount(U.atomicHierarchy,le),z.offsets[le+1]-z.offsets[le];var Ae=!1;if(d(U,le))for(;le+1<z.count&&d(U,le+1);){var Se=Z.get(le),ie=Z.get(le+1);if(Se!==ie)break;Ae=!0,le++}else for(;le+1<z.count&&z.offsets[le+1]-z.offsets[le]===1&&z.offsets[le+2]-z.offsets[le+1]===1;){var oe=J.getEntityFromChain(le),F=J.getEntityFromChain(le+1);if(oe!==F)break;var V=K.value(le),pe=K.value(le+1);if(V!==pe)break;var Se=Z.get(le),ie=Z.get(le+1);if(Se!==ie)break;Ae=!0,le++}var we=Je.ofBounds(be,z.offsets[le+1]);te.addUnit(0,U,ye,we,Ae?1:0)}var Te=U.coarseHierarchy;return Te.isDefined&&(Te.spheres.count>0&&f(te,U,U.coarseHierarchy.spheres,1),Te.gaussians.count>0&&f(te,U,U.coarseHierarchy.gaussians,2)),te.getStructure()}e.ofModel=c;function d(U,z){var J=U.atomicHierarchy.index.getEntityFromChain(z);return U.entities.data.type.value(J)==="water"}function f(U,z,J,K){for(var Z=J.chainElementSegments,te=0;te<Z.count;te++){var le=Je.ofBounds(Z.offsets[te],Z.offsets[te+1]);U.addUnit(K,z,Cn.Default,le,0)}}function h(U,z){if(ue.isIdentity(z))return U;if(!ue.isRotationAndTranslation(z,Cn.RotationTranslationEpsilon))throw new Error("Only rotation/translation combination can be applied.");for(var J=[],K=0,Z=U.units;K<Z.length;K++){var te=Z[K],le=te.conformation.operator,ye=Cn.create(le.name,z,le);J.push(te.applyOperator(te.id,ye))}var be=U.coordinateSystem,Ae=Cn.compose(Cn.create(be.name,z,be),be);return u(J,{parent:U,coordinateSystem:Ae})}e.transform=h;var v=function(){function U(z){z===void 0&&(z={}),this.props=z,this.units=[],this.invariantId=Ka(),this.chainGroupId=-1,this.inChainGroup=!1,this.p=_(),this.singleElementUnits=new Map}return U.prototype.beginChainGroup=function(){this.chainGroupId++,this.inChainGroup=!0},U.prototype.endChainGroup=function(){this.inChainGroup=!1},U.prototype.addUnit=function(z,J,K,Z,te,le){le===void 0&&(le=this.invariantId());var ye=this.inChainGroup?this.chainGroupId:++this.chainGroupId,be=je.create(this.units.length,le,ye,te,z,J,K,Z);return this.add(be)},U.prototype.add=function(z){if(z.elements.length===1){z.conformation.position(z.elements[0],this.p);var J=[z.invariantId,this.p[0],this.p[1],this.p[2]].join("|");if(this.singleElementUnits.has(J))return this.singleElementUnits.get(J);this.singleElementUnits.set(J,z)}return this.units.push(z),z},U.prototype.addWithOperator=function(z,J,K){return K===void 0&&(K=!1),this.add(z.applyOperator(this.units.length,J,K))},U.prototype.getStructure=function(){return u(this.units,this.props)},Object.defineProperty(U.prototype,"isEmpty",{get:function(){return this.units.length===0},enumerable:!1,configurable:!0}),U}();e.StructureBuilder=v;function p(U){return U===void 0&&(U={}),new v(U)}e.Builder=p;function m(U){return U.hashCode}e.hashCode=m;function g(U){return S6(U.units.map(function(z){return je.conformationId(z)}).join("|"))}e.conformationHash=g;function y(U,z){if(U===z)return!0;if(U.elementCount!==z.elementCount)return!1;var J=U.units.length;if(J!==z.units.length)return!1;for(var K=0;K<J;K++)if(U.units[K].id!==z.units[K].id)return!1;return!0}e.areUnitIdsEqual=y;function b(U,z){if(!y(U,z))return!1;for(var J=0,K=U.units.length;J<K;J++)if(!Je.areEqual(U.units[J].elements,z.units[J].elements))return!1;return!0}e.areUnitIdsAndIndicesEqual=b;function S(U,z){if(U.hashCode!==z.hashCode)return!1;var J=U.models.length;if(J!==z.models.length)return!1;for(var K=0;K<J;K++)if(!Xt.areHierarchiesEqual(U.models[K],z.models[K]))return!1;return!0}e.areHierarchiesEqual=S;function x(U,z){return U===z||U.hashCode===z.hashCode&&Bl.areTransformGroupsEquivalent(U.unitSymmetryGroups,z.unitSymmetryGroups)}e.areEquivalent=x;function C(U,z){return x(U.root,z.root)}e.areRootsEquivalent=C;function w(U,z){return U.root===z.root}e.areRootsEqual=w;var A=function(){function U(z){this.structure=z,this.unitIndex=0,this.maxIdx=0,this.idx=-1,this.current=Ze.create(z),this.hasNext=z.elementCount>0,this.hasNext&&(this.elements=z.units[0].elements,this.maxIdx=this.elements.length-1,this.current.unit=z.units[0])}return U.prototype.move=function(){return this.advance(),this.current.element=this.elements[this.idx],this.current},U.prototype.advance=function(){if(this.idx<this.maxIdx){this.idx++,this.idx===this.maxIdx&&(this.hasNext=this.unitIndex+1<this.structure.units.length);return}if(this.idx=0,this.unitIndex++,this.unitIndex>=this.structure.units.length){this.hasNext=!1;return}this.current.unit=this.structure.units[this.unitIndex],this.elements=this.current.unit.elements,this.maxIdx=this.elements.length-1,this.maxIdx===0&&(this.hasNext=this.unitIndex+1<this.structure.units.length)},U}();e.ElementLocationIterator=A;var M=_();function D(U,z,J){for(var K=U.elements,Z=U.conformation,te=Z.position,le=Z.r,ye=M,be=Number.MAX_VALUE,Ae=0,Se=K.length;Ae<Se;Ae++){var ie=K[Ae],oe=_.distance(z,te(ie,ye))-J-le(ie);oe<be&&(be=oe)}return be}function k(U,z,J){for(var K=U.units,Z=Number.MAX_VALUE,te=0,le=K.length;te<le;te++){var ye=K[te],be=D(ye,z,J);be<Z&&(Z=be)}return Z}e.minDistanceToPoint=k;var R=_();function O(U,z){if(U.elementCount===0||z.elementCount===0)return 0;for(var J=U.units,K=Number.MAX_VALUE,Z=0,te=J.length;Z<te;Z++)for(var le=J[Z],ye=le.elements,be=le.conformation,Ae=be.position,Se=be.r,ie=0,oe=ye.length;ie<oe;ie++){var F=ye[ie],V=k(z,Ae(F,R),Se(F));V<K&&(K=V)}return K}e.distance=O;function H(U){return U.elementCount===1?"1 element":U.elementCount+" elements"}e.elementDescription=H;function B(U,z,J){return U.masterModel?z.model===J.model||z.model===U.masterModel||J.model===U.masterModel:z.model===J.model}e.validUnitPair=B;function j(U,z,J){var K=J.maxRadius,Z=J.validUnit,te=J.validUnitPair;if(U.units.some(function(pe){return Z(pe)}))for(var le=U.lookup3d,ye=_(),be=0,Ae=U.units;be<Ae.length;be++){var Se=Ae[be];if(Z(Se)){var ie=Se.boundary.sphere;_.transformMat4(ye,ie.center,Se.conformation.operator.matrix);for(var oe=le.findUnitIndices(ye[0],ye[1],ye[2],ie.radius+K),F=0;F<oe.count;F++){var V=U.units[oe.indices[F]];!Z(V)||Se.id>=V.id||!te(Se,V)||(V.elements.length>=Se.elements.length?z(Se,V):z(V,Se))}}}}e.eachUnitPair=j;function Y(U,z){for(var J=z.chain,K=z.residue,Z=z.atom,te=Ze.create(U),le=0,ye=U.units;le<ye.length;le++){var be=ye[le];if(be.kind===0){te.unit=be;for(var Ae=be.elements,Se=ar.transientSegments(be.model.atomicHierarchy.chainAtomSegments,Ae),ie=ar.transientSegments(be.model.atomicHierarchy.residueAtomSegments,Ae);Se.hasNext;){var oe=Se.move();if(J&&(te.element=Ae[oe.start],J(te)),!(!K&&!Z))for(ie.setSegment(oe);ie.hasNext;){var F=ie.move();if(K&&(te.element=Ae[F.start],K(te)),!!Z)for(var V=F.start,pe=F.end;V<pe;V++)te.element=Ae[V],Z(te)}}}}}e.eachAtomicHierarchyElement=Y,e.DefaultSizeThresholds={smallResidueCount:10,mediumResidueCount:5e3,largeResidueCount:3e4,highSymmetryUnitCount:10,fiberResidueCount:15};function G(U){return U.unitSymmetryGroups.filter(function(z){return z.units[0].polymerElements.length>0})}function $(U,z){var J=G(U);return J.length===1&&J[0].units.length>2&&J[0].units[0].polymerElements.length<z.fiberResidueCount}function q(U,z){var J=G(U);return J.length>=1&&J[0].units.length>z.highSymmetryUnitCount}var ee;(function(U){U[U.Small=0]="Small",U[U.Medium=1]="Medium",U[U.Large=2]="Large",U[U.Huge=3]="Huge",U[U.Gigantic=4]="Gigantic"})(ee=e.Size||(e.Size={}));function fe(U,z,J){z===void 0&&(z={}),J===void 0&&(J=1);var K=E(E({},e.DefaultSizeThresholds),z);return U.polymerResidueCount>=K.largeResidueCount*J?q(U,K)?ee.Huge:ee.Gigantic:$(U,K)||U.polymerResidueCount<K.smallResidueCount*J?ee.Small:U.polymerResidueCount<K.mediumResidueCount*J?ee.Medium:ee.Large}e.getSize=fe,e.Index=Dh.createSimple("index","root");var W="__PrincipalAxes__";function X(U){if(U.currentPropertyData[W])return U.currentPropertyData[W];var z=Re.getPrincipalAxes(e.toStructureElementLoci(U));return U.currentPropertyData[W]=z,z}e.getPrincipalAxes=X})(We||(We={}));var h9e=Fe.size;function Re(e,t){return{kind:"element-loci",structure:e,elements:t}}(function(e){function t(z){return!!z&&z.kind==="element-loci"}e.is=t;function r(z,J){if(z.structure!==J.structure||z.elements.length!==J.elements.length)return!1;for(var K=0,Z=z.elements.length;K<Z;++K){var te=z.elements[K],le=J.elements[K];if(te.unit.id!==le.unit.id||!Fe.areEqual(te.indices,le.indices))return!1}return!0}e.areEqual=r;function n(z){return a(z)===0}e.isEmpty=n;function i(z){return a(z)===z.structure.elementCount}e.isWholeStructure=i;function a(z){for(var J=0,K=0,Z=z.elements;K<Z.length;K++){var te=Z[K];J+=h9e(te.indices)}return J}e.size=a;function o(z){return e(z,z.units.map(function(J){return{unit:J,indices:Fe.ofBounds(0,J.elements.length)}}))}e.all=o;function s(z){return e(z,[])}e.none=s;function u(z,J){if(!n(z)){var K=z.elements[0].unit,Z=K.elements[Fe.getAt(z.elements[0].indices,0)];return J?(J.structure=z.structure,J.unit=z.elements[0].unit,J.element=Z,J):Ze.create(z.structure,K,Z)}}e.getFirstLocation=u;function l(z){return n(z)?z:e(z.structure,[{unit:z.elements[0].unit,indices:Fe.ofSingleton(Fe.start(z.elements[0].indices))}])}e.firstElement=l;function c(z){return n(z)?z:b(l(z))}e.firstResidue=c;function d(z){return n(z)?z:M(l(z))}e.firstChain=d;function f(z){for(var J=[],K=function(ye){var be=ye.unit,Ae=ye.indices,Se=new Int32Array(Fe.size(Ae));Fe.forEach(Ae,function(ie,oe){return Se[oe]=be.elements[ie]}),J.push(be.getChild(Je.ofSortedArray(Se)))},Z=0,te=z.elements;Z<te.length;Z++){var le=te[Z];K(le)}return We.create(J,{parent:z.structure.parent})}e.toStructure=f;function h(z,J){if(J===z.structure)return z;var K=[];return z.elements.forEach(function(Z){if(J.unitMap.has(Z.unit.id)){var te=J.unitMap.get(Z.unit.id),le=Fe.indexedIntersect(Z.indices,Z.unit.elements,te.elements);Fe.size(le)>0&&K.push({unit:te,indices:le})}}),e(J,K)}e.remap=h;function v(z,J){if(z.elements.length>J.elements.length)return v(J,z);if(e.isEmpty(z))return J;for(var K=new Map,Z=0,te=z.elements;Z<te.length;Z++){var le=te[Z];K.set(le.unit.id,le.indices)}for(var ye=[],be=0,Ae=J.elements;be<Ae.length;be++){var le=Ae[be];K.has(le.unit.id)?(ye[ye.length]={unit:le.unit,indices:Fe.union(K.get(le.unit.id),le.indices)},K.delete(le.unit.id)):ye[ye.length]=le}return K.forEach(function(Se,ie){ye[ye.length]={unit:z.structure.unitMap.get(ie),indices:Se}}),e(z.structure,ye)}e.union=v;function p(z,J){for(var K=new Map,Z=0,te=J.elements;Z<te.length;Z++){var le=te[Z];K.set(le.unit.id,le.indices)}for(var ye=[],be=0,Ae=z.elements;be<Ae.length;be++){var le=Ae[be];if(K.has(le.unit.id)){var Se=Fe.subtract(le.indices,K.get(le.unit.id));if(Fe.size(Se)===0)continue;ye[ye.length]={unit:le.unit,indices:Se}}else ye[ye.length]=le}return e(z.structure,ye)}e.subtract=p;function m(z,J){for(var K=new Map,Z=0,te=z.elements;Z<te.length;Z++){var le=te[Z];K.set(le.unit.id,le.indices)}for(var ye=[],be=0,Ae=J.elements;be<Ae.length;be++){var le=Ae[be];if(K.has(le.unit.id)){var Se=Fe.intersect(K.get(le.unit.id),le.indices);Fe.size(Se)!==0&&(ye[ye.length]={unit:le.unit,indices:Se})}}return e(z.structure,ye)}e.intersect=m;function g(z,J){if(z.elements.length>J.elements.length)return g(J,z);if(e.isEmpty(z))return e.isEmpty(J);for(var K=new Map,Z=0,te=z.elements;Z<te.length;Z++){var le=te[Z];K.set(le.unit.id,le.indices)}for(var ye=0,be=J.elements;ye<be.length;ye++){var le=be[ye];if(K.has(le.unit.id)&&Fe.areIntersecting(K.get(le.unit.id),le.indices))return!0}return!1}e.areIntersecting=g;function y(z,J){if(e.isEmpty(z))return e.isEmpty(J);for(var K=new Map,Z=0,te=z.elements;Z<te.length;Z++){var le=te[Z];K.set(le.unit.id,le.indices)}for(var ye=!1,be=0,Ae=J.elements;be<Ae.length;be++){var le=Ae[be];if(K.has(le.unit.id))if(Fe.isSubset(K.get(le.unit.id),le.indices))ye=!0;else return!1}return ye}e.isSubset=y;function b(z,J){for(var K=[],Z=new Set,te=0,le=z.elements;te<le.length;te++){var ye=le[te];if(x(ye)){K[K.length]=ye;continue}if(ye.unit.kind===0){for(var be=ye.unit.elements,Ae=ye.unit.model.atomicHierarchy,Se=ye.unit.model.atomicHierarchy.atoms.label_alt_id,ie=Ae.residueAtomSegments,oe=ie.index,F=ie.offsets,V=[],pe=ye.indices,we=Fe.size(pe),Te=0;Te<we;){Z.clear();var ze=be[Fe.getAt(pe,Te)],Ve=oe[ze];for(Z.add(Se.value(ze)),Te++;Te<we;){var Xe=be[Fe.getAt(pe,Te)];if(oe[Xe]!==Ve)break;Z.add(Se.value(Xe)),Te++}for(var ct=Z.has(""),Ne=F[Ve],Qe=F[Ve+1];Ne<Qe;Ne++){var it=Fe.indexOf(be,Ne);if(it>=0){var ot=Se.value(Ne);(!J||ct||!ot||Z.has(ot))&&(V[V.length]=it)}}}K[K.length]={unit:ye.unit,indices:Je.ofSortedArray(V)}}else K[K.length]=ye}return e(z.structure,K)}e.extendToWholeResidues=b;function S(z){switch(z.kind){case 0:return z.model.atomicHierarchy.chainAtomSegments;case 1:return z.model.coarseHierarchy.spheres.chainElementSegments;case 2:return z.model.coarseHierarchy.gaussians.chainElementSegments}}function x(z){return z.unit.elements.length===Fe.size(z.indices)}function C(z){return z.length>12&&z[z.length-1]-z[0]===z.length-1?Ie.ofRange(z[0],z[z.length-1]):Je.ofSortedArray(z)}function w(z,J,K){for(var Z=S(z).index,te=z.elements,le=0,ye=0,be=te.length;ye<be;ye++){var Ae=te[ye],Se=Z[Ae];J.has(Se)&&le++}if(le===z.elements.length){K[K.length]={unit:z,indices:Ie.ofBounds(0,le)};return}var ie=new Int32Array(le);le=0;for(var ye=0,be=te.length;ye<be;ye++){var Ae=te[ye],Se=Z[Ae];J.has(Se)&&(ie[le++]=ye)}ie.length>0&&(K[K.length]={unit:z,indices:C(ie)})}function A(z,J,K,Z,te){for(var le=S(z.elements[0].unit).index,ye=new Set,be=J;be<K;be++)for(var Ae=z.elements[be],Se=Ae.indices,ie=Ae.unit.elements,oe=0,F=Fe.size(Se);oe<F;oe++)ye.add(le[ie[Fe.getAt(Se,oe)]]);if(Z)for(var V=z.elements[0].unit,pe=0,we=z.structure.units;pe<we.length;pe++){var Te=we[pe];je.areSameChainOperatorGroup(Te,V)&&w(Te,ye,te)}else for(var be=J;be<K;be++)w(z.elements[be].unit,ye,te)}function M(z){for(var J=[],K=0,Z=z.elements.length;K<Z;K++){var te=z.elements[K];if(je.Traits.is(te.unit.traits,2)){for(var le=K;K<Z&&je.areSameChainOperatorGroup(z.elements[K].unit,te.unit);)K++;var ye=K;K--,A(z,le,ye,!0,J)}else x(te)?J[J.length]=te:A(z,K,K+1,!1,J)}return e(z.structure,J)}e.extendToWholeChains=M;function D(z){return z.unit.model.id+"|"+lt.entity.id(z)}function k(z){for(var J=[],K=Ze.create(z.structure),Z=new Set,te=z.structure.units,le=0,ye=z.elements.length;le<ye;le++){var be=z.elements[le];K.unit=be.unit,K.element=be.unit.elements[0],Z.add(D(K))}for(var le=0,Ae=te.length;le<Ae;++le){var Se=te[le];if(K.unit=Se,K.element=Se.elements[0],Z.has(D(K))){var ie=Fe.ofBounds(0,Se.elements.length);J[J.length]={unit:Se,indices:ie}}}return e(z.structure,J)}e.extendToWholeEntities=k;function R(z){for(var J=[],K=new Set,Z=z.structure.units,te=0,le=z.elements.length;te<le;te++){var ye=z.elements[te];K.add(ye.unit.model.id)}for(var te=0,be=Z.length;te<be;++te){var Ae=Z[te];if(K.has(Ae.model.id)){var Se=Fe.ofBounds(0,Ae.elements.length);J[J.length]={unit:Ae,indices:Se}}}return e(z.structure,J)}e.extendToWholeModels=R;function O(z,J){for(var K=[],Z=0,te=Fe.size(J);Z<te;++Z)K.push(z[Fe.getAt(J,Z)]);return Je.ofSortedArray(K)}function H(z,J){return Je.indicesOf(z,J)}function B(z){for(var J=[],K=new Map,Z=0,te=z.elements.length;Z<te;Z++){var le=z.elements[Z],ye=le.unit.model,be=O(le.unit.elements,le.indices);K.has(ye)?K.set(ye,Je.union(be,K.get(ye))):K.set(ye,be)}for(var Z=0,Ae=z.structure.units.length;Z<Ae;++Z){var Se=z.structure.units[Z],be=K.get(Se.model);if(be){var ie=H(Se.elements,be);J[J.length]={unit:Se,indices:ie}}}return e(z.structure,J)}e.extendToAllInstances=B;function j(z){for(var J=[],K=new Set,Z=z.structure.units,te=0,le=z.elements.length;te<le;te++){var ye=z.elements[te];K.add(ye.unit.conformation.operator.name)}for(var te=0,be=Z.length;te<be;++te){var Ae=Z[te];if(K.has(Ae.conformation.operator.name)){var Se=Fe.ofBounds(0,Ae.elements.length);J[J.length]={unit:Ae,indices:Se}}}return e(z.structure,J)}e.extendToWholeOperators=j;var Y=new bs("98"),G=_();function $(z,J){Y.reset();for(var K=0,Z=z.elements;K<Z.length;K++)for(var te=Z[K],le=te.indices,ye=te.unit.conformation.position,be=te.unit.conformation.r,Ae=te.unit.elements,Se=0,ie=Fe.size(le);Se<ie;Se++){var oe=Ae[Fe.getAt(le,Se)];ye(oe,G),J&&_.transformMat4(G,G,J),Y.includePositionRadius(G,be(oe))}Y.finishedIncludeStep();for(var F=0,V=z.elements;F<V.length;F++)for(var te=V[F],le=te.indices,ye=te.unit.conformation.position,be=te.unit.conformation.r,Ae=te.unit.elements,Se=0,ie=Fe.size(le);Se<ie;Se++){var oe=Ae[Fe.getAt(le,Se)];ye(oe,G),J&&_.transformMat4(G,G,J),Y.radiusPositionRadius(G,be(oe))}return{box:Y.getBox(),sphere:Y.getSphere()}}e.getBoundary=$;var q=_();function ee(z,J,K){K===void 0&&(K=0);for(var Z=K,te=0,le=z.elements;te<le.length;te++){for(var ye=le[te],be=ye.indices,Ae=ye.unit.conformation.position,Se=ye.unit.elements,ie=Fe.size(be),oe=0;oe<ie;oe++){var F=Se[Fe.getAt(be,oe)];Ae(F,q),_.toArray(q,J,Z+oe*3)}Z+=ie*3}return J}e.toPositionsArray=ee;function fe(z){var J=a(z),K=ee(z,new Float32Array(3*J));return kv.ofPositions(K)}e.getPrincipalAxes=fe;function W(z,J){return je.isAtomic(z)?z.model.atomicHierarchy.atomSourceIndex.value(J):J}function X(z){var J;if(e.isEmpty(z))return se.struct.generator.empty();for(var K=z.structure.models,Z=new Map,te=0,le=z.elements;te<le.length;te++){var ye=le[te],be=ye.indices,Ae=ye.unit.elements,Se=ye.unit.conformation.operator.name,ie=void 0;Z.has(Se)?ie=Z.get(Se).xs:(ie=an.create(),Z.set(Se,{modelLabel:ye.unit.model.label,modelIndex:ye.unit.model.modelNum,xs:ie}));for(var oe=0,F=Fe.size(be);oe<F;oe++){var V=W(ye.unit,Ae[Fe.getAt(be,oe)]);an.add(ie,V,V)}}for(var pe=[],we=Z.keys();;){var Te=we.next();if(Te.done)break;var ye=Z.get(Te.value);pe.push(U(Te.value,ye.xs.array,K.length>1,ye.modelLabel,ye.modelIndex))}for(var ze=new Map,oe=0,Ve=pe.length;oe<Ve;++oe){var Xe=pe[oe],ct=Kv(Xa(Xe.atom.ranges),Xa(Xe.atom.set)),Se=ct+"|"+(Xe.entity?Xe.entity.modelLabel+Xe.entity.modelIndex:"");ze.has(Se)?(J=ze.get(Se).chain.opName).push.apply(J,Xe.chain.opName):ze.set(Se,Xe)}var Ne=[];return ze.forEach(function(Qe){var it=Qe.atom,ot=it.ranges,dt=it.set,ke=Qe.chain.opName,Me=se.struct.atomProperty.core.operatorName(),Ye=se.struct.atomProperty.core.sourceIndex(),tt=[];dt.length>0&&(tt[tt.length]=se.core.set.has([se.core.type.set(dt),Ye]));for(var xt=0,pt=ot.length/2;xt<pt;xt++)tt[tt.length]=se.core.rel.inRange([Ye,ot[2*xt],ot[2*xt+1]]);if(Qe.entity){var ut=Qe.entity,he=ut.modelLabel,me=ut.modelIndex;Ne.push(se.struct.generator.atomGroups({"atom-test":tt.length>1?se.core.logic.or(tt):tt[0],"chain-test":ke.length>1?se.core.set.has([se.core.type.set(ke),Me]):se.core.rel.eq([Me,ke[0]]),"entity-test":se.core.logic.and([se.core.rel.eq([se.struct.atomProperty.core.modelLabel(),he]),se.core.rel.eq([se.struct.atomProperty.core.modelIndex(),me])])}))}else Ne.push(se.struct.generator.atomGroups({"atom-test":tt.length>1?se.core.logic.or(tt):tt[0],"chain-test":ke.length>1?se.core.set.has([se.core.type.set(ke),Me]):se.core.rel.eq([Me,ke[0]])}))}),se.struct.modifier.union([Ne.length===1?Ne[0]:se.struct.combinator.merge(Ne.map(function(Qe){return se.struct.modifier.union([Qe])}))])}e.toExpression=X;function U(z,J,K,Z,te){Ou(J);for(var le=[],ye=[],be=0,Ae=J.length;be<Ae;){var Se=be;for(be++;be<Ae&&J[be-1]+1===J[be];)be++;var ie=be;if(ie-Se>12)le[le.length]=J[Se],le[le.length]=J[ie-1];else for(var oe=Se;oe<ie;oe++)ye[ye.length]=J[oe]}return K?{atom:{set:ye,ranges:le},chain:{opName:[z]},entity:{modelLabel:Z,modelIndex:te}}:{atom:{set:ye,ranges:le},chain:{opName:[z]}}}})(Re||(Re={}));var Zf;(function(e){function t(){return{elementCount:0,conformationCount:0,residueCount:0,chainCount:0,unitCount:0,structureCount:0,firstElementLoc:Ze.create(void 0),firstConformationLoc:Ze.create(void 0),firstResidueLoc:Ze.create(void 0),firstChainLoc:Ze.create(void 0),firstUnitLoc:Ze.create(void 0),firstStructureLoc:Ze.create(void 0)}}e.create=t;function r(u,l,c){var d=u.get(l)||0;u.set(l,d+c)}function n(u,l,c){var d=c.indices,f=c.unit,h=f.elements,v=Fe.size(d),p=new Map,m=new Map;if(v>0&&Ze.set(u.firstElementLoc,l,f,h[Fe.start(d)]),v===h.length)u.unitCount+=1,u.unitCount===1&&Ze.set(u.firstUnitLoc,l,f,h[Fe.start(d)]);else if(v===1){if(je.Traits.is(f.traits,1))return;u.elementCount+=1,u.elementCount===1&&Ze.set(u.firstElementLoc,l,f,h[Fe.start(d)])}else if(je.isAtomic(f))for(var g=f.model.atomicHierarchy.residueAtomSegments,y=g.index,b=g.offsets,S=f.model.atomicHierarchy.atoms.label_alt_id,x=0,C=function(){p.clear();var w=0,A=h[Fe.getAt(d,x)],M=y[A];for(r(p,S.value(A),1),++x,++w;x<v;){var D=h[Fe.getAt(d,x)];if(y[D]!==M)break;r(p,S.value(D),1),++x,++w}if(b[M+1]-b[M]===w)u.residueCount+=1,u.residueCount===1&&Ze.set(u.firstResidueLoc,l,f,b[M]);else{m.clear();for(var k=b[M],R=b[M+1];k<R;++k)r(m,S.value(k),1);m.get("")===p.get("")&&p.forEach(function(O,H){if(m.get(H)===O){if(H!==""&&(u.conformationCount+=1,u.conformationCount===1)){for(var B=b[M],j=b[M+1];B<j;++B)if(H===S.value(B)){Ze.set(u.firstConformationLoc,l,f,B);break}}w-=O}}),u.elementCount+=w}};x<v;)C();else u.elementCount+=v,u.elementCount===1&&Ze.set(u.firstElementLoc,l,f,h[Fe.start(d)])}function i(u,l,c){var d=c.indices,f=c.unit,h=Fe.size(d);if(h!==0){var v=f.elements;if(!je.Traits.is(f.traits,1)){h===v.length&&(u.chainCount+=1,u.chainCount===1&&Ze.set(u.firstChainLoc,l,f,v[Fe.start(d)]));return}var p=je.isAtomic(f)?f.model.atomicHierarchy.chainAtomSegments:je.isSpheres(f)?f.model.coarseHierarchy.spheres.chainElementSegments:je.isGaussians(f)?f.model.coarseHierarchy.gaussians.chainElementSegments:void 0;if(!p){console.warn("StructureElement loci stats: unknown unit type");return}for(var m=p.index,g=p.offsets,y=0;y<h;){var b=0,S=v[Fe.getAt(d,y)],x=m[S];for(++y,++b;y<h;){var C=v[Fe.getAt(d,y)];if(m[C]!==x)break;++y,++b}g[x+1]-g[x]===b&&(u.chainCount+=1,u.chainCount===1&&Ze.set(u.firstChainLoc,l,f,g[x]))}}}function a(u,l,c,d,f){var h=c[d],v=je.isAtomic(h.unit)?h.unit.model.atomicHierarchy.chainAtomSegments:je.isSpheres(h.unit)?h.unit.model.coarseHierarchy.spheres.chainElementSegments:je.isGaussians(h.unit)?h.unit.model.coarseHierarchy.gaussians.chainElementSegments:void 0;if(!v){console.warn("StructureElement loci stats: unknown unit type");return}for(var p=v.index,m=v.offsets,g=new Map,y=d;y<f;y++){h=c[y];var b=h.indices,S=h.unit,x=Fe.size(b);if(x!==0){var C=S.elements;if(!je.Traits.is(S.traits,1)){var w=C[Fe.start(b)];r(g,p[w],C.length);continue}for(var A=0;A<x;){var M=0,w=C[Fe.getAt(b,A)],D=p[w];for(++A,++M;A<x;){var k=C[Fe.getAt(b,A)];if(p[k]!==D)break;++A,++M}r(g,D,M)}}}var R=-1;if(g.forEach(function(O,H){m[H+1]-m[H]===O&&(u.chainCount+=1,u.chainCount===1&&(R=H))}),!(R<0))for(var y=d;y<f;y++){h=c[y];var b=h.indices,S=h.unit,x=Fe.size(b);if(x!==0)for(var C=S.elements,A=0;A<x;){var w=C[Fe.getAt(b,A)],D=p[w];if(D===R){Ze.set(u.firstChainLoc,l,S,w);return}}}}function o(u){var l=t();if(Re.isEmpty(u))return l;var c=!1;if(Re.isWholeStructure(u)){if(l.structureCount+=1,l.structureCount===1){var d=u.elements[0],f=d.unit,h=d.indices;Ze.set(l.firstStructureLoc,u.structure,f,f.elements[Fe.min(h)])}}else for(var v=0,p=u.elements;v<p.length;v++){var m=p[v];n(l,u.structure,m),je.Traits.is(m.unit.traits,2)?c=!0:i(l,u.structure,m)}if(c)for(var g=0,y=u.elements.length;g<y;g++){var m=u.elements[g];if(je.Traits.is(m.unit.traits,2)){for(var b=g;g<y&&je.areSameChainOperatorGroup(u.elements[g].unit,m.unit);)g++;var S=g;g--,S-b===1?i(l,u.structure,m):a(l,u.structure,u.elements,b,S)}}return l}e.ofLoci=o;function s(u,l,c){return l.elementCount===1&&c.elementCount===0?Ze.copy(u.firstElementLoc,l.firstElementLoc):l.elementCount===0&&c.elementCount===1&&Ze.copy(u.firstElementLoc,c.firstElementLoc),l.conformationCount===1&&c.conformationCount===0?Ze.copy(u.firstConformationLoc,l.firstConformationLoc):l.conformationCount===0&&c.conformationCount===1&&Ze.copy(u.firstConformationLoc,c.firstConformationLoc),l.residueCount===1&&c.residueCount===0?Ze.copy(u.firstResidueLoc,l.firstResidueLoc):l.residueCount===0&&c.residueCount===1&&Ze.copy(u.firstResidueLoc,c.firstResidueLoc),l.chainCount===1&&c.chainCount===0?Ze.copy(u.firstChainLoc,l.firstChainLoc):l.chainCount===0&&c.chainCount===1&&Ze.copy(u.firstChainLoc,c.firstChainLoc),l.unitCount===1&&c.unitCount===0?Ze.copy(u.firstUnitLoc,l.firstUnitLoc):l.unitCount===0&&c.unitCount===1&&Ze.copy(u.firstUnitLoc,c.firstUnitLoc),l.structureCount===1&&c.structureCount===0?Ze.copy(u.firstStructureLoc,l.firstStructureLoc):l.structureCount===0&&c.structureCount===1&&Ze.copy(u.firstStructureLoc,c.firstStructureLoc),u.elementCount=l.elementCount+c.elementCount,u.conformationCount=l.conformationCount+c.conformationCount,u.residueCount=l.residueCount+c.residueCount,u.chainCount=l.chainCount+c.chainCount,u.unitCount=l.unitCount+c.unitCount,u.structureCount=l.structureCount+c.structureCount,u}e.add=s})(Zf||(Zf={}));function p9e(e){return je.isAtomic(e.unit)?e.unit.residueIndex[e.element]:-1}function v9e(e){return je.isAtomic(e.unit)?e.unit.chainIndex[e.element]:-1}function m9e(e){return lt.entity.key(e)}Vi.Field;Vi.Encodings;Vi.Field;Vi.Category;Vi.Category;Vi.Category;var Nj;(function(e){function t(r){var n=Array.isArray(r)?r:[r];return{structures:n,firstModel:n[0].model,cache:Object.create(null)}}e.create=t})(Nj||(Nj={}));var Bj;(function(e){e.AtomSitePositionsFieldNames=new Set(["id","Cartn_x","Cartn_y","Cartn_z"])})(Bj||(Bj={}));var g9e={molstar_atom_site_operator_mapping:{label_asym_id:ve.Schema.Str(),auth_asym_id:ve.Schema.Str(),operator_name:ve.Schema.Str(),suffix:ve.Schema.Str(),assembly_id:ve.Schema.Str(),assembly_operator_id:ve.Schema.Int(),symmetry_operator_index:ve.Schema.Int(),symmetry_hkl:ve.Schema.Vector(3),ncs_id:ve.Schema.Int()}},Uj=function(e,t){return typeof t[e].operator.assembly>"u"?1:0},aT=function(e,t){return t[e].operator.spgrOp===-1?1:0};Vi.fields().str("label_asym_id",function(e,t){return t[e].label_asym_id}).str("auth_asym_id",function(e,t){return t[e].auth_asym_id}).str("operator_name",function(e,t){return t[e].operator.name}).str("suffix",function(e,t){return t[e].operator.suffix}).str("assembly_id",function(e,t){var r;return((r=t[e].operator.assembly)===null||r===void 0?void 0:r.id)||""},{valueKind:Uj}).int("assembly_operator_id",function(e,t){var r;return((r=t[e].operator.assembly)===null||r===void 0?void 0:r.operId)||0},{valueKind:Uj}).int("symmetry_operator_index",function(e,t){return t[e].operator.spgrOp},{valueKind:aT}).vec("symmetry_hkl",[function(e,t){return t[e].operator.hkl[0]},function(e,t){return t[e].operator.hkl[1]},function(e,t){return t[e].operator.hkl[2]}],{valueKind:aT}).int("ncs_id",function(e,t){return t[e].operator.ncsId},{valueKind:aT}).getFields();function y9e(e){if(e._rowCount===0)return{residues:[],chains:[]};for(var t=0,r=e._rowCount,n=[t],i=[t],a=e.label_entity_id,o=e.label_asym_id,s=e.label_seq_id,u=e.auth_seq_id,l=e.pdbx_PDB_ins_code,c=t+1;c<r;c++){var d=!a.areValuesEqual(c-1,c)||!o.areValuesEqual(c-1,c),f=d||!s.areValuesEqual(c-1,c)||!u.areValuesEqual(c-1,c)||!l.areValuesEqual(c-1,c);f&&(n[n.length]=c),d&&(i[i.length]=c)}return{residues:n,chains:i}}function Zx(e,t,r){e[t].isDefined||(e[t]=e[r]),e[r].isDefined||(e[r]=e[t])}function b9e(e,t,r){var n=en.ofColumns(C6e,{type_symbol:ve.ofArray({array:ve.mapToArray(e.type_symbol,V0),schema:ve.Schema.Aliased(ve.Schema.str)}),label_atom_id:e.label_atom_id,auth_atom_id:e.auth_atom_id,label_alt_id:e.label_alt_id,label_comp_id:e.label_comp_id,auth_comp_id:e.auth_comp_id,pdbx_formal_charge:e.pdbx_formal_charge}),i=en.view(e,_6e,r.residues),a=en.view(e,w6e,r.chains);if(!i.label_seq_id.isDefined){for(var o=new Int32Array(i.label_seq_id.rowCount),s=r.residues,u=r.chains,l=0,c=0,d=0,f=o.length;d<f;++d)s[d]>=u[l+1]&&(l+=1,c=0),o[d]=++c;i.label_seq_id=ve.ofIntArray(o)}return en.columnToArray(i,"label_seq_id",Int32Array),en.columnToArray(i,"auth_seq_id",Int32Array),Zx(n,"label_atom_id","auth_atom_id"),Zx(n,"label_comp_id","auth_comp_id"),Zx(i,"label_seq_id","auth_seq_id"),Zx(a,"label_asym_id","auth_asym_id"),{atoms:n,residues:i,chains:a,atomSourceIndex:t}}function x9e(e){return{id:bn.create22(),atomId:e.id,occupancy:e.occupancy,B_iso_or_equiv:e.B_iso_or_equiv,xyzDefined:e.Cartn_x.isDefined&&e.Cartn_y.isDefined&&e.Cartn_z.isDefined,x:e.Cartn_x.toArray({array:Float32Array}),y:e.Cartn_y.toArray({array:Float32Array}),z:e.Cartn_z.toArray({array:Float32Array})}}function S9e(e,t){return en.areEqual(e.chains,t.chains)&&en.areEqual(e.residues,t.residues)&&en.areEqual(e.atoms,t.atoms)}function C9e(e,t){var r=new Map;if(!un.is(t))return r;var n=Pc(g9e,t.data.frame).molstar_atom_site_operator_mapping;if(n._rowCount===0)return r;for(var i=new Map,a=new Map,o=0;o<n._rowCount;o++){var s=n.assembly_operator_id.valueKind(o)===0?{id:n.assembly_id.value(o),operList:[],operId:n.assembly_operator_id.value(o)}:void 0,u=Cn.create(n.operator_name.value(o),ue.identity(),{assembly:s,spgrOp:n.symmetry_operator_index.valueKind(o)===0?n.symmetry_operator_index.value(o):void 0,hkl:_.ofArray(n.symmetry_hkl.value(o)),ncsId:n.ncs_id.value(o)}),l=n.suffix.value(o),c=n.label_asym_id.value(o);i.set(""+c+l,{name:c,operator:u});var d=n.auth_asym_id.value(o);a.set(""+d+l,d)}for(var f=e.chains,h=f.label_asym_id,v=f.auth_asym_id,p=new Array(h.rowCount),m=new Array(h.rowCount),o=0;o<h.rowCount;o++){var c=h.value(o),d=v.value(o);if(!i.has(c)){p[o]=c,m[o]=d;continue}var g=i.get(c),y=g.name,u=g.operator;r.set(o,u),p[o]=y,m[o]=a.get(d)||d}return e.chains.label_asym_id=ve.ofArray({array:p,valueKind:e.chains.label_asym_id.valueKind,schema:e.chains.label_asym_id.schema}),e.chains.auth_asym_id=ve.ofArray({array:m,valueKind:e.chains.auth_asym_id.valueKind,schema:e.chains.auth_asym_id.schema}),r}function _9e(e,t,r,n,i,a){var o=y9e(e),s=b9e(e,t,o),u=C9e(s,i);if(a&&S9e(a.atomicHierarchy,s))return{sameAsPrevious:!0,hierarchy:a.atomicHierarchy,chainOperatorMapping:u};var l={residueAtomSegments:ar.ofOffsets(o.residues,Ie.ofBounds(0,e._rowCount)),chainAtomSegments:ar.ofOffsets(o.chains,Ie.ofBounds(0,e._rowCount))},c=L6e(s,r,l),d=oFe(s,l,c,n),f=E(E(E({},s),l),{index:c,derived:d});return{sameAsPrevious:!1,hierarchy:f,chainOperatorMapping:u}}function Cee(e,t,r,n,i,a){var o=_9e(e,t,r,n,i,a),s=o.sameAsPrevious,u=o.hierarchy,l=o.chainOperatorMapping,c=x9e(e);return{sameAsPrevious:s,hierarchy:u,conformation:c,chainOperatorMapping:l}}var zD;(function(e){e.Empty={isDefined:!1}})(zD||(zD={}));function w9e(e,t,r){if(e.has(t))return e.get(t);var n=r.index++;return e.set(t,n),n}function E9e(e,t){if(e.has(t))return e.get(t);var r=new Map;return e.set(t,r),r}function A9e(e,t,r){var n=e.getEntityIndex,i=function(o,s){var u=n(o);if(u<0)return-1;var l=t.get(u);return l.has(s)?l.get(s):-1},a=function(o,s,u){var l=n(o);if(l<0)return-1;var c=t.get(l);if(c===void 0)return-1;var d=c.get(s);if(d===void 0)return-1;var f=r.get(d),h=f.elementIndices,v=f.seqRanges,p=nn.firstIntersectionIndex(v,Fe.ofSingleton(u));return p!==-1?h[p]:-1};return{findChainKey:i,findSequenceKey:a}}function P9e(e){throw new Error("Missing entity entry for entity id '"+e+"'.")}function jj(e,t){for(var r=e.entity_id,n=e.asym_id,i=e.seq_id_begin,a=e.seq_id_end,o=e.count,s=e.chainElementSegments,u=new Map,l=new Map,c={index:0},d=new Int32Array(o),f=new Int32Array(o),h=new Int32Array(s.count),v=0;v<o;v++)f[v]=t.getEntityIndex(r.value(v)),f[v]<0&&P9e(r.value(v));for(var p=0;p<s.count;p++){var m=s.offsets[p],g=s.offsets[p+1],y=f[m];h[p]=y;for(var b=E9e(l,y),S=w9e(b,n.value(m),c),v=m;v<g;v++)d[v]=S;for(var x=[],C=[],v=m;v<g;v++){var w=i.value(v),A=a.value(v);x.push(v),C.push(w,A)}var M={elementIndices:x,seqRanges:nn.ofSortedRanges(C)};u.set(S,M)}var D=A9e(t,l,u),k=D.findChainKey,R=D.findSequenceKey,O=function(H){return h[H]};return{chainKey:d,entityKey:f,findSequenceKey:R,findChainKey:k,getEntityFromChain:O}}function zj(e,t){for(var r=[],n=[],i=ar.transientSegments(e.chainElementSegments,Ie.ofBounds(0,e.count)),a=e.seq_id_begin,o=e.seq_id_end;i.hasNext;)for(var s=i.move(),u=s.start,l=s.end,c=-1,d=-1,f=u;f<l;++f){var h=o.value(f);f===u?(c=f,d=o.value(f)):a.value(f)-d>1&&(r.push(c,f-1),n.push(f-1,f),c=f),f===l-1&&r.push(c,f),d=h}return{polymerRanges:nn.ofSortedRanges(r),gapRanges:nn.ofSortedRanges(n)}}Sr.atom_site.label_comp_id,Sr.atom_site.label_seq_id,Sr.atom_site.pdbx_PDB_ins_code,Sr.atom_site.label_asym_id,Sr.atom_site.label_entity_id,Sr.atom_site.auth_atom_id,Sr.atom_site.auth_seq_id,Sr.atom_site.auth_asym_id;E(E({},Sr.chem_comp_bond),{molstar_protonation_variant:ve.Schema.Str()});var T9e=E(E({},Sr.chem_comp),{type:ve.Schema.Aliased(ve.Schema.str)}),ao={entry:Sr.entry,struct:Sr.struct,struct_asym:Sr.struct_asym,ihm_model_list:Sr.ihm_model_list,ihm_model_group:Sr.ihm_model_group,ihm_model_group_link:Sr.ihm_model_group_link,entity:Sr.entity,entity_poly:Sr.entity_poly,entity_poly_seq:Sr.entity_poly_seq,pdbx_entity_branch:Sr.pdbx_entity_branch,chem_comp:T9e,pdbx_chem_comp_identifier:Sr.pdbx_chem_comp_identifier,atom_site:Sr.atom_site,ihm_sphere_obj_site:Sr.ihm_sphere_obj_site,ihm_gaussian_obj_site:Sr.ihm_gaussian_obj_site,pdbx_unobs_or_zero_occ_residues:Sr.pdbx_unobs_or_zero_occ_residues,pdbx_molecule:Sr.pdbx_molecule};function tm(e){for(var t=Object.create(null),r=0,n=Object.keys(ao);r<n.length;r++){var i=n[r];i in e?t[i]=e[i]:t[i]=en.ofUndefinedColumns(ao[i],0)}return t}var _ee={hierarchy:zD.Empty,conformation:void 0};function I9e(e,t){var r=e.ihm_sphere_obj_site,n=e.ihm_gaussian_obj_site;if(r._rowCount===0&&n._rowCount===0)return _ee;var i=Vj(r),a=M9e(r),o=jj(i,e.entities),s=zj(i,t.chemicalComponentMap),u=Vj(n),l=D9e(n),c=jj(u,e.entities),d=zj(u,t.chemicalComponentMap);return{hierarchy:{isDefined:!0,spheres:E(E(E({},i),o),s),gaussians:E(E(E({},u),c),d)},conformation:{id:bn.create22(),spheres:a,gaussians:l}}}function M9e(e){return{x:e.Cartn_x.toArray({array:Float32Array}),y:e.Cartn_y.toArray({array:Float32Array}),z:e.Cartn_z.toArray({array:Float32Array}),radius:e.object_radius.toArray({array:Float32Array}),rmsf:e.rmsf.toArray({array:Float32Array})}}function D9e(e){for(var t=ao.ihm_gaussian_obj_site.covariance_matrix.space,r=[],n=e.covariance_matrix,i=0,a=n.rowCount;i<a;i++)r[i]=kr.toMat3(Yn(),t,n.value(i));return{x:e.mean_Cartn_x.toArray({array:Float32Array}),y:e.mean_Cartn_y.toArray({array:Float32Array}),z:e.mean_Cartn_z.toArray({array:Float32Array}),weight:e.weight.toArray({array:Float32Array}),covariance_matrix:r}}function R9e(e,t,r){for(var n=[0],i=1,a=e.rowCount;i<a;i++){var o=!e.areValuesEqual(i-1,i);o&&(n[n.length]=i)}return{chainElementSegments:ar.ofOffsets(n,Ie.ofBounds(0,e.rowCount))}}function Vj(e){var t=e.entity_id,r=e.seq_id_begin,n=e.seq_id_end,i=e.asym_id;return E({count:t.rowCount,entity_id:t,asym_id:i,seq_id_begin:r,seq_id_end:n},R9e(i))}var k9e={HIS:"H",ARG:"R",LYS:"K",ILE:"I",PHE:"F",LEU:"L",TRP:"W",ALA:"A",MET:"M",PRO:"P",CYS:"C",ASN:"N",VAL:"V",GLY:"G",SER:"S",GLN:"Q",TYR:"Y",ASP:"D",GLU:"E",THR:"T",SEC:"U",PYL:"O",HSD:"H",HSE:"H",HSP:"H",LSN:"K",ASPP:"D",GLUP:"E",HID:"H",HIE:"H",HIP:"H",LYN:"K",ASH:"D",GLH:"E"},O9e={DA:"A",DC:"C",DG:"G",DT:"T",DU:"U"},F9e={A:"A",C:"C",G:"G",T:"T",U:"U"};function Hj(e){var t=k9e[e];return t||"X"}function Gj(e){var t=F9e[e];return t||"X"}function qj(e){var t=O9e[e];return t||"X"}var Jb;(function(e){function t(u){var l=u.code.toArray();return(l instanceof Array?l:Array.from(l)).join("")}e.getSequenceString=t;function r(u){for(var l=0,c=Math.min(u.rowCount,10);l<c;l++){var d=u.value(l)||"";if(Hj(d)!=="X")return"protein";if(Gj(d)!=="X")return"RNA";if(qj(d)!=="X")return"DNA"}return"generic"}function n(u,l){var c;switch(u){case"protein":c=Hj;break;case"DNA":c=qj;break;case"RNA":c=Gj;break;case"generic":c=function(){return"X"};break;default:throw new Error("unknown kind '"+u+"'")}return l&&l.size>0?function(d){var f=c(d);return f!=="X"||!l.has(d)?f:c(l.get(d))}:c}function i(u,l){if(l.rowCount===0)throw new Error("cannot be empty");var c=r(u);return new a(c,u,l)}e.ofResidueNames=i;var a=function(){function u(l,c,d){this.kind=l,this.microHet=new Map;for(var f=n(l),h=[],v=[],p=[],m=new Map,g=0,y=new Map,b=0,S=d.rowCount;b<S;++b){var x=d.value(b);if(y.has(x))m.has(x)?m.get(x).push(c.value(b)):m.set(x,[v[y.get(x)],c.value(b)]);else{y.set(x,g);var C=c.value(b);v[g]=C,p[g]=x,h[g]=f(C),g+=1}}for(var w=[],b=0,S=g;b<S;++b){var A=m.get(p[b]);if(A){var M=A.map(function(R){var O=f(R);return O==="X"?R:O});w[b]="("+M.join("|")+")"}else w[b]=h[b]==="X"?v[b]:h[b]}this.length=g,this.code=ve.ofStringArray(h),this.compId=ve.ofStringArray(v),this.seqId=ve.ofIntArray(p),this.label=ve.ofStringArray(w),this.microHet=m,this.indexMap=y}return u.prototype.index=function(l){return this.indexMap.get(l)},u}();function o(u,l){var c="generic";return new s(c,u,l)}e.ofSequenceRanges=o;var s=function(){function u(l,c,d){this.kind=l,this.seqIdStart=c,this.seqIdEnd=d,this.microHet=new Map;for(var f=0,h=Number.MAX_SAFE_INTEGER,v=0,p=this.seqIdStart.rowCount;v<p;v++){var m=this.seqIdStart.value(v),g=this.seqIdEnd.value(v);m<h&&(h=m),f<g&&(f=g)}var y=f-h+1;this.code=ve.ofConst("X",y,ve.Schema.str),this.label=ve.ofConst("",y,ve.Schema.str),this.seqId=ve.ofLambda({value:function(b){return b+h+1},rowCount:y,schema:ve.Schema.int}),this.compId=ve.ofConst("",y,ve.Schema.str),this.length=y,this.minSeqId=h}return u.prototype.index=function(l){return l-this.minSeqId},u}()})(Jb||(Jb={}));var VD;(function(e){var t={byEntityKey:{},sequences:[]};function r(){for(var s=[],u=0;u<arguments.length;u++)s[u]=arguments[u];for(var l=[],c={},d=0,f=s.length;d<f;++d)l.push.apply(l,s[d].sequences),Object.assign(c,s[d].byEntityKey);return{sequences:l,byEntityKey:c}}function n(s,u,l){var c=i(s,u),d=l.isDefined?a(s,l):t;return r(c,d)}e.fromHierarchy=n;function i(s,u){var l=u.atoms.label_comp_id,c=u.residues.label_seq_id,d=u.chainAtomSegments,f=u.residueAtomSegments,h=d.count,v=d.offsets,p={},m=[];if(h===1&&v[0]===0&&v[1]===0)return{byEntityKey:p,sequences:m};for(var g=0,y=u.chains._rowCount;g<y;g++){var b=u.index.getEntityFromChain(g);if(!(p[b]!==void 0||s.data.type.value(b)!=="polymer")){var S=g;for(g++;g<y&&b===u.index.getEntityFromChain(g)&&s.data.type.value(b)!=="polymer";)g++;g--;for(var x=f.index[v[S]],C=f.index[v[g+1]-1]+1,w=ve.window(c,x,C),A=[],M=x;M<C;++M)A.push(l.value(f.offsets[M]));var D=ve.ofStringArray(A);p[b]={entityId:s.data.id.value(b),sequence:Jb.ofResidueNames(D,w)},m.push(p[b])}}return{byEntityKey:p,sequences:m}}e.fromAtomicHierarchy=i;function a(s,u){var l=o(s,u.spheres),c=o(s,u.gaussians);return r(l,c)}e.fromCoarseHierarchy=a;function o(s,u){var l=u.chainElementSegments,c=u.seq_id_begin,d=u.seq_id_end,f=l.count,h=l.offsets,v={},p=[];if(f===1&&h[0]===0&&h[1]===0)return{byEntityKey:v,sequences:p};for(var m=0,g=f;m<g;m++){var y=u.getEntityFromChain(m);if(v[y]===void 0){var b=m;for(m++;m<g&&y===u.getEntityFromChain(m);)m++;m--;var S=h[b],x=h[m+1]-1,C=ve.window(c,S,x),w=ve.window(d,S,x);v[y]={entityId:s.data.id.value(y),sequence:Jb.ofSequenceRanges(C,w)},p.push(v[y])}}return{byEntityKey:v,sequences:p}}e.fromCoarseElements=o})(VD||(VD={}));function wee(e,t,r,n){if(!e.entity_poly_seq||!e.entity_poly_seq._rowCount)return VD.fromHierarchy(t,r,n);for(var i=e.entity_poly_seq,a=i.entity_id,o=i.num,s=i.mon_id,u={},l=[],c=a.rowCount,d=0;d<c;){for(var f=d;d<c-1&&a.areValuesEqual(d,d+1);)d++;d++;var h=a.value(f),v=ve.window(s,f,d),p=ve.window(o,f,d),m=t.getEntityIndex(h);u[m]={entityId:h,sequence:Jb.ofResidueNames(v,p)},l.push(u[m])}return{byEntityKey:u,sequences:l}}function Eee(e,t,r,n){return ce(this,void 0,void 0,function(){var i,a,o,s,u,l,c,d,f,h,v;return de(this,function(p){switch(p.label){case 0:return i=Y5(r,n-1),a=t.label_entity_id,o=t.label_asym_id,s=t.label_seq_id,u=kP(i,a.value),e.shouldUpdate?[4,e.update()]:[3,2];case 1:p.sent(),p.label=2;case 2:l=0,c=u.length-1,p.label=3;case 3:if(!(l<c))return[3,10];d=kP(i,o.value,{start:u[l],end:u[l+1]}),f=0,h=d.length-1,p.label=4;case 4:return f<h?(v=d[f],s.valueKind(v)!==0?[3,6]:(kP(i,s.value,{sort:!0,start:v,end:d[f+1]}),e.shouldUpdate?[4,e.update()]:[3,6])):[3,7];case 5:p.sent(),p.label=6;case 6:return f++,[3,4];case 7:return e.shouldUpdate?[4,e.update()]:[3,9];case 8:p.sent(),p.label=9;case 9:return l++,[3,3];case 10:return Rke(i)&&i.length===t._rowCount?[2,{atom_site:t,sourceIndex:ve.ofIntArray(i)}]:[2,{atom_site:en.view(t,t._schema,i),sourceIndex:ve.ofIntArray(i)}]}})})}function $j(e,t,r,n,i){var a=i.residue,o=a.polymerType,s=a.traceElementIndex,u=a.directionFromElementIndex,l=a.directionToElementIndex,c=o[e],d=o[t];if(c===0||d===0||s[e]===-1||s[t]===-1)return!1;var f=n.findAtomsOnResidue(e,Qf(c,"backboneStart")),h=n.findAtomsOnResidue(t,Qf(d,"backboneEnd"));(f===-1||h===-1)&&(f=n.findAtomsOnResidue(e,Qf(c,"coarseBackbone")),h=n.findAtomsOnResidue(t,Qf(d,"coarseBackbone")));var v=r.x,p=r.y,m=r.z,g=_.create(v[f],p[f],m[f]),y=_.create(v[h],p[h],m[h]),b=u[e]===-1||l[e]===-1||u[t]===-1||l[t]===-1;return _.distance(g,y)<(b?10:3)}function Aee(e,t,r,n){for(var i=[],a=[],o=new Map,s=ar.transientSegments(e.chainAtomSegments,Ie.ofBounds(0,e.atoms._rowCount)),u=ar.transientSegments(e.residueAtomSegments,Ie.ofBounds(0,e.atoms._rowCount)),l=e.index,c=e.derived,d=e.residues.label_seq_id,f=e.chains.label_entity_id,h=c.residue,v=h.moleculeType,p=h.traceElementIndex,m,g,y,b;s.hasNext;){var S=s.move();u.setSegment(S),m=-1,g=-1,y=-1,b=-1;var x=t.getEntityIndex(f.value(S.index)),C=n.byEntityKey[x],w=C?C.sequence.seqId.value(C.sequence.seqId.rowCount-1):-1,A=e.residueAtomSegments.index[S.start],M=e.residueAtomSegments.index[S.end-1],D=d.value(A),k=d.value(M);for(D===1&&k===w&&r.xyzDefined&&$j(A,M,r,l,c)&&(o.set(A,M),o.set(M,A));u.hasNext;){var R=u.move(),O=R.index,H=d.value(O);if(Z6(v[O])&&p[O]!==-1)if(b!==-1)if(H!==m+1)i.push(b,y-1),a.push(g,R.end-1),b=R.start;else if(!u.hasNext)i.push(b,R.end-1);else{var B=e.residueAtomSegments.index[R.start],j=e.residueAtomSegments.index[y-1];r.xyzDefined&&!$j(B,j,r,e.index,c)&&(i.push(b,y-1),a.push(g,R.end-1),b=R.start)}else b=R.start;else b!==-1&&(i.push(b,y-1),b=-1);g=R.start,y=R.end,m=H}}return{polymerRanges:nn.ofSortedRanges(i),gapRanges:nn.ofSortedRanges(a),cyclicPolymerMap:o}}function Rh(e){var t=void 0,r=void 0;return function(){for(var n=[],i=0;i<arguments.length;i++)n[i]=arguments[i];if(!t||t.length!==n.length)return t=n,r=e.apply(void 0,n),r;for(var a=0,o=n.length;a<o;a++)if(n[a]!==t[a])return t=n,r=e.apply(void 0,n),r;return r}}function eA(e){var t=new Map;return function(r){if(t.has(r))return t.get(r);var n=e(r);return t.set(r,n),n}}function L9e(e){for(var t=new Map,r=function(s,u,l){return s+"|"+u+"|"+l},n=e.pdbx_unobs_or_zero_occ_residues,i=0,a=n._rowCount;i<a;++i){var o=r(n.PDB_model_num.value(i),n.label_asym_id.value(i),n.label_seq_id.value(i));t.set(o,{polymer_flag:n.polymer_flag.value(i),occupancy_flag:n.occupancy_flag.value(i)})}return{has:function(s,u,l){return t.has(r(s,u,l))},get:function(s,u,l){return t.get(r(s,u,l))},size:t.size}}function N9e(e){var t=new Map;if(e.chem_comp._rowCount>0)for(var r=e.chem_comp.id,n=0,i=r.rowCount;n<i;++n)t.set(r.value(n),en.getRow(e.chem_comp,n));else{var a=Pee(e);a.forEach(function(o){t.set(o,tFe(o))})}return t}function B9e(e){var t=new Map;if(e.pdbx_chem_comp_identifier._rowCount>0){for(var r=e.pdbx_chem_comp_identifier,n=r.comp_id,i=r.type,a=r.identifier,o=0,s=n.rowCount;o<s;++o)if(i.value(o)==="SNFG CARBOHYDRATE SYMBOL"||i.value(o)==="SNFG CARB SYMBOL"){var u=a.value(o),l=U6e.get(u);l?t.set(n.value(o),l):console.warn("Unknown SNFG name '"+u+"'")}}if(e.chem_comp._rowCount>0)for(var c=e.chem_comp,d=c.id,i=c.type,o=0,s=d.rowCount;o<s;++o){var f=d.value(o);if(!t.has(f)){var h=i.value(o);nv.has(f)?t.set(f,nv.get(f)):H0(h,f)===9&&t.set(f,_J)}}else{var v=Pee(e);nv.forEach(function(p,m){!t.has(m)&&v.has(m)&&t.set(m,p)})}return t}var Pee=eA(function(e){for(var t=new Set,r=e.atom_site,n=r.label_comp_id,i=r.auth_comp_id,a=n.isDefined?n:i,o=0,s=a.rowCount;o<s;++o)t.add(a.value(o));return t});function U9e(e){for(var t=new Map,r=e.atom_site,n=r.label_asym_id,i=r.auth_asym_id,a=r.label_entity_id,o=0,s=n.rowCount;o<s;++o){var u=n.value(o);t.has(u)||t.set(u,{id:u,auth_id:i.value(o),entity_id:a.value(o)})}if(e.struct_asym._rowCount>0)for(var l=e.struct_asym,u=l.id,c=l.entity_id,o=0,s=u.rowCount;o<s;++o){var d=u.value(o);t.has(d)||t.set(d,{id:d,auth_id:"",entity_id:c.value(o)})}return t}function j9e(e){return{missingResidues:L9e(e),chemicalComponentMap:N9e(e),saccharideComponentMap:B9e(e),structAsymMap:U9e(e)}}var z9e=ve.Schema.Aliased(ve.Schema.Str(""));function Tee(e,t){var r,n;if(e.entity.id.isDefined)n=e.entity;else{for(var i=new Set,a=[],o=[],s=e.atom_site,u=s.label_entity_id,l=s.label_comp_id,c=0,d=e.atom_site._rowCount;c<d;c++){var f=u.value(c);i.has(f)||(a.push(f),o.push(rFe(l.value(c))),i.add(f))}for(var h=e.ihm_sphere_obj_site.entity_id,c=0,d=e.ihm_sphere_obj_site._rowCount;c<d;c++){var f=h.value(c);i.has(f)||(a.push(f),o.push("polymer"),i.add(f))}for(var v=e.ihm_gaussian_obj_site.entity_id,c=0,d=e.ihm_gaussian_obj_site._rowCount;c<d;c++){var f=v.value(c);i.has(f)||(a.push(f),o.push("polymer"),i.add(f))}n=en.ofPartialColumns(ao.entity,{id:ve.ofArray({array:a,schema:ao.entity.id}),type:ve.ofArray({array:o,schema:ao.entity.type})},a.length)}var p=ve.createIndexer(n.id),m=new Array(n._rowCount);m.fill("other");var g=new Set,y=!1;if(e.entity_poly&&e.entity_poly.type.isDefined)for(var b=e.entity_poly,S=b.entity_id,x=b.type,C=b._rowCount,c=0;c<C;++c){var f=S.value(c);m[p(f)]=x.value(c),g.add(f)}else y=!0;if(e.pdbx_entity_branch&&e.pdbx_entity_branch.entity_id.isDefined)for(var w=e.pdbx_entity_branch,S=w.entity_id,x=w.type,C=w._rowCount,c=0;c<C;++c){var f=S.value(c);m[p(f)]=x.value(c),g.add(f)}else y=!0;if(g.size<m.length&&(y=!0),y){var A=new Map;if(e.chem_comp)for(var M=e.chem_comp,D=M.id,x=M.type,c=0,d=e.chem_comp._rowCount;c<d;c++)A.set(D.value(c),x.value(c));if(e.atom_site)for(var k=e.atom_site,u=k.label_entity_id,l=k.label_comp_id,c=0,d=e.atom_site._rowCount;c<d;c++){var f=u.value(c);if(!g.has(f)){var R=l.value(c),O=A.get(R)||"";m[p(f)]=nFe(R,O),g.add(f)}}}var H=ve.ofArray({array:m,schema:z9e}),B=new Array(n._rowCount);if(B.fill(""),e.pdbx_molecule&&e.pdbx_molecule.prd_id.isDefined)for(var j=e.pdbx_molecule,Y=j.asym_id,G=j.prd_id,C=j._rowCount,c=0;c<C;++c){var $=Y.value(c),f=(r=t.structAsymMap.get($))===null||r===void 0?void 0:r.entity_id;f!==void 0&&(B[p(f)]=G.value(c))}var q=ve.ofArray({array:B,schema:ve.Schema.str});return{data:n,subtype:H,prd_id:q,getEntityIndex:p}}function V9e(e,t){var r=t.ihm_model_group,n=t.ihm_model_group_link,i=en.pickRow(n,function(o){return n.model_id.value(o)===e});if(i){var a=en.pickRow(r,function(o){return r.id.value(o)===i.group_id});if(a)return a.name}return""}var Ov=function(){function e(t){this.frames=t,this.frameCount=t.length,this.representative=t[0],this.duration=t.length}return e.prototype.getFrameAtIndex=function(t){return this.frames[t]},e}();function Od(e,t,r){return ce(this,void 0,void 0,function(){var n,i,a,o;return de(this,function(s){switch(s.label){case 0:return n=j9e(e),e.ihm_model_list._rowCount>0?[4,$9e(r,e,n,t)]:[3,2];case 1:return a=s.sent(),[3,4];case 2:return[4,q9e(r,e,n,t)];case 3:a=s.sent(),s.label=4;case 4:for(i=a,o=0;o<i.length;o++)Xt.TrajectoryInfo.set(i[o],{index:o,size:i.length});return[2,new Ov(i)]}})})}function H9e(e,t,r,n,i,a,o){var s=Cee(t,r,n,i.chemicalComponentMap,a,o),u=t.pdbx_PDB_model_num.value(0);if(o&&s.sameAsPrevious)return E(E({},o),{id:bn.create22(),modelNum:u,atomicConformation:s.conformation,_dynamicPropertyData:Object.create(null)});var l=_ee,c=wee(e,n,s.hierarchy,l.hierarchy),d=Aee(s.hierarchy,n,s.conformation,c),f=e.entry.id.valueKind(0)===0?e.entry.id.value(0):a.name,h=[];return f&&h.push(f),e.struct.title.valueKind(0)===0&&h.push(e.struct.title.value(0)),{id:bn.create22(),entryId:f,label:h.join(" | "),entry:f,sourceData:a,modelNum:u,parent:void 0,entities:n,sequence:c,atomicHierarchy:s.hierarchy,atomicConformation:s.conformation,atomicRanges:d,atomicChainOperatorMappinng:s.chainOperatorMapping,coarseHierarchy:l.hierarchy,coarseConformation:l.conformation,properties:i,customProperties:new nc,_staticPropertyData:Object.create(null),_dynamicPropertyData:Object.create(null)}}function G9e(e,t,r,n){var i=Cee(t.atom_site,t.atom_site_sourceIndex,t.entities,r.chemicalComponentMap,n),a=I9e(t,r),o=wee(e,t.entities,i.hierarchy,a.hierarchy),s=Aee(i.hierarchy,t.entities,i.conformation,o),u=e.entry.id.valueKind(0)===0?e.entry.id.value(0):n.name,l=[];return u&&l.push(u),e.struct.title.valueKind(0)===0&&l.push(e.struct.title.value(0)),t.model_name&&l.push(t.model_name),t.model_group_name&&l.push(t.model_group_name),{id:bn.create22(),entryId:u,label:l.join(" | "),entry:u,sourceData:n,modelNum:t.model_id,parent:void 0,entities:t.entities,sequence:o,atomicHierarchy:i.hierarchy,atomicConformation:i.conformation,atomicRanges:s,atomicChainOperatorMappinng:i.chainOperatorMapping,coarseHierarchy:a.hierarchy,coarseConformation:a.conformation,properties:r,customProperties:new nc,_staticPropertyData:Object.create(null),_dynamicPropertyData:Object.create(null)}}function Iee(e,t){var r=e.rowCount;if(!e.isDefined)return r;for(var n=t+1;n<r&&e.areValuesEqual(t,n);)n++;return n}function q9e(e,t,r,n){return ce(this,void 0,void 0,function(){var i,a,o,s,u,l,c,d,f;return de(this,function(h){switch(h.label){case 0:if(i=[],!t.atom_site)return[3,3];a=t.atom_site.id.rowCount,o=Tee(t,r),s=0,h.label=1;case 1:return s<a?(u=Iee(t.atom_site.pdbx_PDB_model_num,s),[4,Eee(e,t.atom_site,s,u)]):[3,3];case 2:return l=h.sent(),c=l.atom_site,d=l.sourceIndex,f=H9e(t,c,d,o,r,n,i.length>0?i[i.length-1]:void 0),i.push(f),s=u,[3,1];case 3:return[2,i]}})})}function oT(e,t){for(var r=new Map,n=e._rowCount,i=0;i<n;){var a=Iee(t,i),o=t.value(i);r.set(o,{table:en.window(e,e._schema,i,a),start:i,end:a}),i=a}return r}function $9e(e,t,r,n){return ce(this,void 0,void 0,function(){var i,a,o,s,u,l,c,d,f,h,v,p,m,g,y,b,S,x,C;return de(this,function(w){switch(w.label){case 0:if(i=Tee(t,r),a=t.atom_site.ihm_model_id.isDefined?t.atom_site.ihm_model_id:t.atom_site.pdbx_PDB_model_num,o=oT(t.atom_site,a),s=oT(t.ihm_sphere_obj_site,t.ihm_sphere_obj_site.model_id),u=oT(t.ihm_gaussian_obj_site,t.ihm_gaussian_obj_site.model_id),l=[],!t.ihm_model_list)return[3,6];c=t.ihm_model_list,d=c.model_id,f=c.model_name,h=0,w.label=1;case 1:return h<t.ihm_model_list._rowCount?(v=d.value(h),p=void 0,m=void 0,o.has(v)?(g=o.get(v),[4,Eee(e,t.atom_site,g.start,g.end)]):[3,3]):[3,6];case 2:return y=w.sent(),b=y.atom_site,S=y.sourceIndex,p=b,m=S,[3,4];case 3:p=en.window(t.atom_site,t.atom_site._schema,0,0),m=ve.ofIntArray([]),w.label=4;case 4:x={model_id:v,model_name:f.value(h),model_group_name:V9e(v,t),entities:i,atom_site:p,atom_site_sourceIndex:m,ihm_sphere_obj_site:s.has(v)?s.get(v).table:en.window(t.ihm_sphere_obj_site,t.ihm_sphere_obj_site._schema,0,0),ihm_gaussian_obj_site:u.has(v)?u.get(v).table:en.window(t.ihm_gaussian_obj_site,t.ihm_gaussian_obj_site._schema,0,0)},C=G9e(t,x,r,n),l.push(C),w.label=5;case 5:return h++,[3,1];case 6:return[2,l]}})})}var Fv;(function(e){function t(n){var i=this,a=n.descriptor.name,o=n.type==="static"?"_staticPropertyData":"_dynamicPropertyData",s=function(l){return a in l[o]||(l[o][a]={props:E({},I.getDefaultValues(n.getParams(l))),data:Eh.create(void 0)}),l[o][a]},u=function(l,c,d){var f=s(l);l[o][a]={props:c,data:Eh.withValue(f.data,d)}};return{label:n.label,descriptor:n.descriptor,isHidden:n.isHidden,getParams:function(l){var c=I.clone(n.getParams(l));return I.setDefaultValues(c,s(l).props),c},defaultParams:n.defaultParams,isApplicable:n.isApplicable,attach:function(l,c,d,f){return d===void 0&&(d={}),ce(i,void 0,void 0,function(){var h,v,p,m,g;return de(this,function(y){switch(y.label){case 0:return f&&c.customProperties.reference(n.descriptor,!0),h=s(c),v=I.merge(n.defaultParams,h.props,d),h.data.value&&I.areEqual(n.defaultParams,h.props,v)?[2]:[4,n.obtain(l,c,v)];case 1:return p=y.sent(),m=p.value,g=p.assets,c.customProperties.add(n.descriptor),c.customProperties.assets(n.descriptor,g),u(c,v,m),[2]}})})},ref:function(l,c){return l.customProperties.reference(n.descriptor,c)},get:function(l){var c;return(c=s(l))===null||c===void 0?void 0:c.data},set:function(l,c){c===void 0&&(c={});var d=s(l),f=I.merge(n.defaultParams,d.props,c);I.areEqual(n.defaultParams,d.props,f)||(u(l,f,void 0),l.customProperties.assets(n.descriptor))},props:function(l){return s(l).props}}}e.createProvider=t;function r(n,i,a){var o=this,s={value:I.Value(a,{isHidden:!0})};return t({label:is(n),descriptor:ko({name:n}),isHidden:!0,type:i,defaultParams:s,getParams:function(){return{value:I.Value(a,{isHidden:!0})}},isApplicable:function(){return!0},obtain:function(u,l,c){return ce(o,void 0,void 0,function(){var d;return de(this,function(f){return[2,{value:(d=c.value)!==null&&d!==void 0?d:a}]})})}})}e.createSimple=r})(Fv||(Fv={}));var Xt;(function(e){function t(B,j){for(var Y=[],G=j.frames,$=B.atomicHierarchy.atomSourceIndex,q=ve.isIdentity($),ee=q?void 0:$.toArray({array:Int32Array}),fe=0,W=G.length;fe<W;++fe){var X=G[fe],U=E(E({},B),{id:bn.create22(),modelNum:fe,atomicConformation:Gb.getAtomicConformation(X,B.atomicConformation.atomId,ee),customProperties:new nc,_staticPropertyData:Object.create(null),_dynamicPropertyData:Object.create(null)});if(X.cell){var z=vi.fromCell(X.cell.size,X.cell.anglesInRadians);vi.Provider.set(U,z)}e.TrajectoryInfo.set(U,{index:fe,size:G.length}),Y.push(U)}return{trajectory:Y,srcIndexArray:ee}}function r(B,j){return new Ov(t(B,j).trajectory)}e.trajectoryFromModelAndCoordinates=r;function n(B,j){var Y=this;return $e.create("Create Trajectory",function(G){return ce(Y,void 0,void 0,function(){var $,q,ee,fe,W,X,U,z,J;return de(this,function(K){switch(K.label){case 0:return[4,Od(B.basic,B.sourceData,G)];case 1:if($=K.sent(),$.frameCount===0)throw new Error("found no model");for(q=$.representative,ee=t(q,j).trajectory,fe={pairs:B.bonds,count:q.atomicHierarchy.atoms._rowCount},W=wa.fromData(fe),X=0,U=0,z=ee;U<z.length;U++)J=z[U],wa.Provider.set(J,W),e.TrajectoryInfo.set(J,{index:X++,size:ee.length});return[2,new Ov(ee)]}})})})}e.trajectoryFromTopologyAndCoordinates=n;var i="__Center__";function a(B){if(B._dynamicPropertyData[i])return B._dynamicPropertyData[i];var j=y6e(B.atomicConformation,B.coarseConformation);return B._dynamicPropertyData[i]=j,j}e.getCenter=a;function o(B){for(var j=new Int32Array(B.rowCount),Y=!1,G=0,$=B.rowCount;G<$;G++){var q=B.value(G);q!==G&&(Y=!1),j[q]=G}return{isIdentity:Y,invertedIndex:j}}var s="__InvertedAtomSrcIndex__";function u(B){if(B._staticPropertyData[s])return B._staticPropertyData[s];var j=o(B.atomicHierarchy.atomSourceIndex);return B._staticPropertyData[s]=j,j}e.getInvertedAtomSourceIndex=u;var l="__TrajectoryInfo__";e.TrajectoryInfo={get:function(B){return B._dynamicPropertyData[l]||{index:0,size:1}},set:function(B,j){return B._dynamicPropertyData[l]=j}};var c="__AsymIdCount__";e.AsymIdCount={get:function(B){if(B._dynamicPropertyData[c])return B._dynamicPropertyData[c];var j=b6e(B);return B._dynamicPropertyData[c]=j,j}},e.AsymIdOffset=Fv.createSimple("asym_id_offset","static"),e.Index=Fv.createSimple("index","static");function d(B){return B.parent||B}e.getRoot=d;function f(B,j){return B.atomicHierarchy===j.atomicHierarchy&&B.coarseHierarchy===j.coarseHierarchy}e.areHierarchiesEqual=f;var h="__CoordinatesHistory__";e.CoordinatesHistory={get:function(B){return B._staticPropertyData[h]},set:function(B,j){return B._staticPropertyData[h]=j}};var v="__CoarseGrained__";function p(B){if(B._staticPropertyData[v]!==void 0)return B._staticPropertyData[v];for(var j=0,Y=B.atomicHierarchy.derived.residue.polymerType,G=0;G<Y.length;++G)Y[G]!==0&&(j+=1);for(var $=!1,q=!1,ee=B.atomicHierarchy.atoms,fe=ee.label_atom_id,W=ee._rowCount,G=0;G<W;++G){var X=fe.value(G);if(!$&&X==="BB"&&($=!0),!q&&X==="SC1"&&(q=!0),$&&q)break}var U=$&&q||(j&&W?W/j<3:!1);return B._staticPropertyData[v]=U,U}e.isCoarseGrained=p;function m(B){return B.properties.saccharideComponentMap.size>0}e.hasCarbohydrate=m;function g(B){for(var j=B.entities.subtype,Y=0,G=j.rowCount;Y<G;++Y)if(j.value(Y).startsWith("polypeptide"))return!0;return!1}e.hasProtein=g;function y(B){for(var j=B.entities.subtype,Y=0,G=j.rowCount;Y<G;++Y){var $=j.value(Y);if($.endsWith("ribonucleotide hybrid")||$.endsWith("ribonucleotide"))return!0}return!1}e.hasNucleic=y;function b(B){if(!un.is(B.sourceData))return!1;var j=B.sourceData.data.db;return j.database_2.database_id.isDefined||B.entryId.match(/^[1-9][a-z0-9]{3,3}$/i)!==null||B.entryId.match(/^pdb_[0-9]{4,4}[1-9][a-z0-9]{3,3}$/i)!==null}e.isFromPdbArchive=b;function S(B){if(!un.is(B.sourceData))return!1;var j=B.sourceData.data.db;return j.struct_conf.id.isDefined||j.struct_sheet_range.id.isDefined}e.hasSecondaryStructure=S;var x=_.create(1.5707963,1.5707963,1.5707963),C=_.create(1,1,1);function w(B){var j,Y=(j=vi.Provider.get(B))===null||j===void 0?void 0:j.spacegroup;return!!Y&&!(Y.num===1&&_.equals(Y.cell.anglesInRadians,x)&&_.equals(Y.cell.size,C))}e.hasCrystalSymmetry=w;function A(B){if(!un.is(B.sourceData))return!1;for(var j=B.sourceData.data.db,Y=0;Y<j.exptl.method.rowCount;Y++){var G=j.exptl.method.value(Y).toUpperCase();if(G.indexOf("DIFFRACTION")>=0)return!0}return!1}e.isFromXray=A;function M(B){if(!un.is(B.sourceData))return!1;for(var j=B.sourceData.data.db,Y=0;Y<j.exptl.method.rowCount;Y++){var G=j.exptl.method.value(Y).toUpperCase();if(G.indexOf("MICROSCOPY")>=0)return!0}return!1}e.isFromEm=M;function D(B){if(!un.is(B.sourceData))return!1;for(var j=B.sourceData.data.db,Y=0;Y<j.exptl.method.rowCount;Y++){var G=j.exptl.method.value(Y).toUpperCase();if(G.indexOf("NMR")>=0)return!0}return!1}e.isFromNmr=D;function k(B){if(!un.is(B.sourceData)||!A(B))return!1;var j=B.sourceData.data.db,Y=j.pdbx_database_status.status_code_sf;return Y.isDefined&&Y.value(0)==="REL"}e.hasXrayMap=k;function R(B){if(!un.is(B.sourceData))return!1;for(var j=B.sourceData.data.db,Y=j.pdbx_database_related,G=Y.db_name,$=Y.content_type,q=0,ee=j.pdbx_database_related._rowCount;q<ee;++q)if(G.value(q).toUpperCase()==="EMDB"&&$.value(q)==="associated EM volume")return!0;return!1}e.hasEmMap=R;function O(B){return un.is(B.sourceData)?k(B)||R(B):!1}e.hasDensityMap=O;function H(B){if(!un.is(B.sourceData))return!1;var j=B.sourceData.data.db;return O(B)||b(B)&&(!j.exptl.method.isDefined||A(B)&&(!j.pdbx_database_status.status_code_sf.isDefined||j.pdbx_database_status.status_code_sf.valueKind(0)===2)||M(B)&&!j.pdbx_database_related.db_name.isDefined)}e.probablyHasDensityMap=H})(Xt||(Xt={}));var HD;(function(e){function t(d,f,h){if(!f)return{rowCount:0};if(h&&h[f.id])return h[f.id];var v=f.getElements(d),p={data:v,rowCount:v.elements.length};return h&&(h[f.id]=p),p}e.getCifDataSource=t;function r(d){return new Wj(d)}e.fromAtomMap=r;function n(d){return new Wj(sT(d))}e.fromAtomArray=n;var i=function(d){return d.atomicHierarchy.residueAtomSegments};function a(d){return new Jx("residue",d,i,0)}e.fromResidueMap=a;function o(d){return new Jx("residue",sT(d),i,0)}e.fromResidueArray=o;var s=function(d){return d.atomicHierarchy.chainAtomSegments};function u(d){return new Jx("chain",d,s,0)}e.fromChainMap=u;function l(d){return new Jx("chain",sT(d),s,0)}e.fromChainArray=l;function c(d){return new W9e(d)}e.fromEntityMap=c})(HD||(HD={}));function sT(e){for(var t=new Map,r=0,n=e.length;r<n;r++)t.set(r,e[r]);return t}var Jx=function(){function e(t,r,n,i){this.level=t,this.map=r,this.segmentGetter=n,this.id=bn.create22(),this.kind=i}return e.prototype.has=function(t){return this.map.has(t)},e.prototype.get=function(t){return this.map.get(t)},e.prototype.getStructureElements=function(t){var r=t.models;if(r.length!==1)throw new Error("Only works on structures with a single model.");for(var n=new Set,i=t.unitSymmetryGroups,a=[],o=this.segmentGetter(r[0]),s=0,u=i;s<u.length;s++){var l=u[s],c=l.units[0];if(c.kind===this.kind)for(var d=ar.transientSegments(o,c.elements);d.hasNext;){var f=d.move();!this.has(f.index)||n.has(f.index)||(n.add(f.index),a[a.length]=Ze.create(t,c,c.elements[f.start]))}}return a.sort(function(h,v){return h.element-v.element}),a},e.prototype.getElements=function(t){var r=this,n=this.segmentGetter(t.model).index,i=this.getStructureElements(t);return{elements:i,property:function(a){return r.get(n[i[a].element])}}},e}(),Wj=function(){function e(t){this.map=t,this.id=bn.create22(),this.level="atom",this.kind=0}return e.prototype.has=function(t){return this.map.has(t)},e.prototype.get=function(t){return this.map.get(t)},e.prototype.getStructureElements=function(t){var r=t.models;if(r.length!==1)throw new Error("Only works on structures with a single model.");for(var n=new Set,i=t.unitSymmetryGroups,a=[],o=0,s=i;o<s.length;o++){var u=s[o],l=u.units[0];if(l.kind===this.kind)for(var c=l.elements,d=0,f=c.length;d<f;d++){var h=c[d];!this.has(h)||n.has(h)||(n.add(c[d]),a[a.length]=Ze.create(t,l,h))}}return a.sort(function(v,p){return v.element-p.element}),a},e.prototype.getElements=function(t){var r=this,n=this.getStructureElements(t);return{elements:n,property:function(i){return r.get(n[i].element)}}},e}(),W9e=function(){function e(t){this.map=t,this.id=bn.create22(),this.level="entity",this.kind=0}return e.prototype.has=function(t){return this.map.has(t)},e.prototype.get=function(t){return this.map.get(t)},e.prototype.getStructureElements=function(t){var r=t.models;if(r.length!==1)throw new Error("Only works on structures with a single model.");for(var n=r[0].atomicHierarchy.index,i=new Set,a=t.unitSymmetryGroups,o=[],s=r[0].atomicHierarchy.chainAtomSegments,u=0,l=a;u<l.length;u++){var c=l[u],d=c.units[0];if(d.kind===this.kind)for(var f=ar.transientSegments(s,d.elements);f.hasNext;){var h=f.move(),v=n.getEntityFromChain(h.index);!this.has(v)||i.has(v)||(i.add(v),o[o.length]=Ze.create(t,d,d.elements[h.start]))}}return o.sort(function(p,m){return p.element-m.element}),o},e.prototype.getElements=function(t){var r=this,n=this.getStructureElements(t),i=t.model.atomicHierarchy.chainAtomSegments.index,a=t.model.atomicHierarchy.index;return{elements:n,property:function(o){return r.get(a.getEntityFromChain(i[n[o].element]))}}},e}(),X9e=function(){function e(){this.map=new Map}return e.prototype.removeSymbol=function(t){this.map.delete(t.symbol.id)},e.prototype.addSymbol=function(t){this.map.has(t.symbol.id)&&console.warn("Symbol '"+t.symbol.id+"' already added. Call removeSymbol/removeCustomProps re-adding the symbol."),this.map.set(t.symbol.id,t)},e.prototype.addCustomProp=function(t){if(t.symbols)for(var r=0,n=Object.keys(t.symbols);r<n.length;r++){var i=n[r];this.addSymbol(t.symbols[i])}},e.prototype.removeCustomProp=function(t){if(t.symbols)for(var r=0,n=Object.keys(t.symbols);r<n.length;r++){var i=n[r];this.removeSymbol(t.symbols[i])}},e.prototype.getRuntime=function(t){return this.map.get(t)},e}(),Cw=new X9e,Y9e=function(){function e(t){this.table=t,this.constQueryContext=new ps(We.Empty)}return e}(),Xj;(function(e){function t(n){return{kind:"const",value:n}}e.Const=t;function r(n){return{kind:"dynamic",runtime:n}}e.Dynamic=r})(Xj||(Xj={}));var av;(function(e){function t(n){return{isConst:!0,fn:function(a){return n}}}e.Const=t;function r(n){return{isConst:!1,fn:n}}e.Dynamic=r})(av||(av={}));var q1;(function(e){function t(r,n,i,a){if(typeof r.length=="number")for(var o=0,s=r.length;o<s;o++)i(r[o](n),o,a);else for(var o=0,u=0,l=Object.keys(r);u<l.length;u++){var c=l[u];i(r[c](n),o++,a)}return a}e.forEachEval=t})(q1||(q1={}));var g0;(function(e){function t(n,i){return new Yj(n,i,!0)}e.Const=t;function r(n,i){return new Yj(n,i,!1)}e.Dynamic=r})(g0||(g0={}));var Yj=function(){function e(t,r,n){this.symbol=t,this.fn=r,this.isConst=n}return e.prototype.compile=function(t,r){var n,i=!1;if(!r)n=void 0,i=!0;else if(Ri.isArgumentsArray(r)){n=[],i=!1;for(var a=0,o=r;a<o.length;a++){var s=o[a],u=GD(t,s);i=i&&u.isConst,n.push(u.fn)}}else{n=Object.create(null),i=!1;for(var l=0,c=Object.keys(r);l<c.length;l++){var d=c[l],u=GD(t,r[d]);i=i&&u.isConst,n[d]=u.fn}}return this.isConst?this.isConst&&i?av.Const(this.fn(t.constQueryContext,n)):av.Dynamic(Kj(this.fn,n)):av.Dynamic(Kj(this.fn,n))},e}();function Kj(e,t){return function(n){return e(n,t)}}function GD(e,t){if(Ri.isLiteral(t))return av.Const(t);if(Ri.isSymbol(t)){var r=e.table.getRuntime(t.name);return r?r.compile(e):av.Const(t.name)}if(!Ri.isSymbol(t.head))throw new Error("Can only apply symbols.");var n=e.table.getRuntime(t.head.name);if(!n)throw new Error("Symbol '"+t.head.name+"' is not implemented.");return n.compile(e,t.args)}function Lv(e){var t=new Y9e(Cw);return GD(t,e).fn}var er=g0.Const,jt=g0.Dynamic,K9e=[er(Ce.core.type.bool,function(t,r){return!!r[0](t)}),er(Ce.core.type.num,function(t,r){return+r[0](t)}),er(Ce.core.type.str,function(t,r){return""+r[0](t)}),er(Ce.core.type.list,function(t,r){return q1.forEachEval(r,t,function(n,i,a){return a[i]=n},[])}),er(Ce.core.type.set,function(t,r){return q1.forEachEval(r,t,function(i,a,o){return o.add(i)},new Set)}),er(Ce.core.type.regex,function(t,r){return new RegExp(r[0](t),r[1]&&r[1](t)||"")}),er(Ce.core.type.bitflags,function(t,r){return+r[0](t)}),er(Ce.core.type.compositeKey,function(t,r){return q1.forEachEval(r,t,function(n,i,a){return a[i]=""+n},[]).join("-")}),er(Ce.core.logic.not,function(e,t){return!t[0](e)}),er(Ce.core.logic.and,function(e,t){if(typeof t.length=="number"){for(var r=0,n=t.length;r<n;r++)if(!t[r](e))return!1}else for(var i=0,a=Object.keys(t);i<a.length;i++){var o=a[i];if(!t[o](e))return!1}return!0}),er(Ce.core.logic.or,function(e,t){if(typeof t.length=="number"){for(var r=0,n=t.length;r<n;r++)if(t[r](e))return!0}else for(var i=0,a=Object.keys(t);i<a.length;i++){var o=a[i];if(t[o](e))return!0}return!1}),er(Ce.core.rel.eq,function(e,t){return t[0](e)===t[1](e)}),er(Ce.core.rel.neq,function(e,t){return t[0](e)!==t[1](e)}),er(Ce.core.rel.lt,function(e,t){return t[0](e)<t[1](e)}),er(Ce.core.rel.lte,function(e,t){return t[0](e)<=t[1](e)}),er(Ce.core.rel.gr,function(e,t){return t[0](e)>t[1](e)}),er(Ce.core.rel.gre,function(e,t){return t[0](e)>=t[1](e)}),er(Ce.core.rel.inRange,function(e,t){var r=t[0](e);return r>=t[1](e)&&r<=t[2](e)}),er(Ce.core.math.add,function(e,t){var r=0;if(typeof t.length=="number")for(var n=0,i=t.length;n<i;n++)r+=t[n](e);else for(var a=0,o=Object.keys(t);a<o.length;a++){var s=o[a];r+=t[s](e)}return r}),er(Ce.core.math.sub,function(e,t){var r=0;if(typeof t.length=="number"){if(t.length===1)return-t[0](e);r=t[0](e)||0;for(var n=1,i=t.length;n<i;n++)r-=t[n](e)}else{var a=Object.keys(t);if(a.length===1)return-t[a[0]](e);r=t[a[0]](e)||0;for(var n=1,i=a.length;n<i;n++)r-=t[a[n]](e)}return r}),er(Ce.core.math.mult,function(e,t){var r=1;if(typeof t.length=="number")for(var n=0,i=t.length;n<i;n++)r*=t[n](e);else for(var a=0,o=Object.keys(t);a<o.length;a++){var s=o[a];r*=t[s](e)}return r}),er(Ce.core.math.div,function(e,t){return t[0](e)/t[1](e)}),er(Ce.core.math.pow,function(e,t){return Math.pow(t[0](e),t[1](e))}),er(Ce.core.math.mod,function(e,t){return t[0](e)%t[1](e)}),er(Ce.core.math.min,function(e,t){var r=Number.POSITIVE_INFINITY;if(typeof t.length=="number")for(var n=0,i=t.length;n<i;n++)r=Math.min(t[n](e),r);else for(var a=0,o=Object.keys(t);a<o.length;a++){var s=o[a];r=Math.min(t[s](e),r)}return r}),er(Ce.core.math.max,function(e,t){var r=Number.NEGATIVE_INFINITY;if(typeof t.length=="number")for(var n=0,i=t.length;n<i;n++)r=Math.max(t[n](e),r);else for(var a=0,o=Object.keys(t);a<o.length;a++){var s=o[a];r=Math.max(t[s](e),r)}return r}),er(Ce.core.math.floor,function(e,t){return Math.floor(t[0](e))}),er(Ce.core.math.ceil,function(e,t){return Math.ceil(t[0](e))}),er(Ce.core.math.roundInt,function(e,t){return Math.round(t[0](e))}),er(Ce.core.math.abs,function(e,t){return Math.abs(t[0](e))}),er(Ce.core.math.sqrt,function(e,t){return Math.sqrt(t[0](e))}),er(Ce.core.math.cbrt,function(e,t){return Math.cbrt(t[0](e))}),er(Ce.core.math.sin,function(e,t){return Math.sin(t[0](e))}),er(Ce.core.math.cos,function(e,t){return Math.cos(t[0](e))}),er(Ce.core.math.tan,function(e,t){return Math.tan(t[0](e))}),er(Ce.core.math.asin,function(e,t){return Math.asin(t[0](e))}),er(Ce.core.math.acos,function(e,t){return Math.acos(t[0](e))}),er(Ce.core.math.atan,function(e,t){return Math.atan(t[0](e))}),er(Ce.core.math.sinh,function(e,t){return Math.sinh(t[0](e))}),er(Ce.core.math.cosh,function(e,t){return Math.cosh(t[0](e))}),er(Ce.core.math.tanh,function(e,t){return Math.tanh(t[0](e))}),er(Ce.core.math.exp,function(e,t){return Math.exp(t[0](e))}),er(Ce.core.math.log,function(e,t){return Math.log(t[0](e))}),er(Ce.core.math.log10,function(e,t){return Math.log10(t[0](e))}),er(Ce.core.math.atan2,function(e,t){return Math.atan2(t[0](e),t[1](e))}),er(Ce.core.str.match,function(e,t){return t[0](e).test(t[1](e))}),er(Ce.core.str.concat,function(e,t){var r=[];if(typeof t.length=="number")for(var n=0,i=t.length;n<i;n++)r.push(t[n](e).toString());else for(var a=0,o=Object.keys(t);a<o.length;a++){var s=o[a];r.push(t[s](e).toString())}return r.join("")}),er(Ce.core.list.getAt,function(e,t){return t[0](e)[t[1](e)]}),er(Ce.core.list.equal,function(e,t){return k6(t[0](e),t[1](e))}),er(Ce.core.set.has,function(t,r){return r[0](t).has(r[1](t))}),er(Ce.core.set.isSubset,function(t,r){return gi.isSuperset(r[1](t),r[0](t))}),er(Ce.core.flags.hasAny,function(e,t){var r=t[1](e),n=t[0](e);return r?(n&r)!==0:!!n}),er(Ce.core.flags.hasAll,function(e,t){var r=t[1](e),n=t[0](e);return r?(n&r)===r:!n}),er(Ce.structureQuery.type.elementSymbol,function(e,t){return V0(t[0](e))}),er(Ce.structureQuery.type.atomName,function(e,t){return ZIe(t[0](e))}),er(Ce.structureQuery.type.bondFlags,function(e,t){var r=0;if(typeof t.length=="number")for(var n=0,i=t.length;n<i;n++)r=Qj(r,t[n](e));else for(var a=0,o=Object.keys(t);a<o.length;a++){var s=o[a];r=Qj(r,t[s](e))}return r}),er(Ce.structureQuery.type.ringFingerprint,function(e,t){return Vs.elementFingerprint(Q9e(e,t))}),er(Ce.structureQuery.type.secondaryStructureFlags,function(e,t){var r=0;if(typeof t.length=="number")for(var n=0,i=t.length;n<i;n++)r=Zj(r,t[n](e));else for(var a=0,o=Object.keys(t);a<o.length;a++){var s=o[a];r=Zj(r,t[s](e))}return r}),jt(Ce.structureQuery.filter.pick,function(e,t){return sn.filters.pick(t[0],t.test)(e)}),jt(Ce.structureQuery.filter.first,function(e,t){return sn.filters.first(t[0])(e)}),jt(Ce.structureQuery.filter.withSameAtomProperties,function(e,t){return sn.filters.withSameAtomProperties(t[0],t.source,t.property)(e)}),jt(Ce.structureQuery.filter.intersectedBy,function(e,t){return sn.filters.areIntersectedBy(t[0],t.by)(e)}),jt(Ce.structureQuery.filter.within,function(e,t){return sn.filters.within({query:t[0],target:t.target,minRadius:t["min-radius"],maxRadius:t["max-radius"],elementRadius:t["atom-radius"],invert:t.invert})(e)}),jt(Ce.structureQuery.filter.isConnectedTo,function(e,t){return sn.filters.isConnectedTo({query:t[0],target:t.target,disjunct:t.disjunct,invert:t.invert,bondTest:t["bond-test"]})(e)}),jt(Ce.structureQuery.generator.atomGroups,function(t,r){return sn.generators.atoms({entityTest:r["entity-test"],chainTest:r["chain-test"],residueTest:r["residue-test"],atomTest:r["atom-test"],groupBy:r["group-by"]})(t)}),jt(Ce.structureQuery.generator.all,function(t){return sn.generators.all(t)}),jt(Ce.structureQuery.generator.empty,function(t){return sn.generators.none(t)}),jt(Ce.structureQuery.generator.bondedAtomicPairs,function(t,r){return sn.generators.bondedAtomicPairs(r&&r[0])(t)}),jt(Ce.structureQuery.generator.rings,function(t,r){var n,i;return sn.generators.rings((n=r==null?void 0:r.fingerprint)===null||n===void 0?void 0:n.call(r,t),(i=r==null?void 0:r["only-aromatic"])===null||i===void 0?void 0:i.call(r,t))(t)}),jt(Ce.structureQuery.modifier.includeSurroundings,function(t,r){return sn.modifiers.includeSurroundings(r[0],{radius:r.radius(t),wholeResidues:!!(r["as-whole-residues"]&&r["as-whole-residues"](t)),elementRadius:r["atom-radius"]})(t)}),jt(Ce.structureQuery.modifier.surroundingLigands,function(t,r){return sn.modifiers.surroundingLigands({query:r[0],radius:r.radius(t),includeWater:!!(r["include-water"]&&r["include-water"](t))})(t)}),jt(Ce.structureQuery.modifier.wholeResidues,function(t,r){return sn.modifiers.wholeResidues(r[0])(t)}),jt(Ce.structureQuery.modifier.union,function(t,r){return sn.modifiers.union(r[0])(t)}),jt(Ce.structureQuery.modifier.expandProperty,function(t,r){return sn.modifiers.expandProperty(r[0],r.property)(t)}),jt(Ce.structureQuery.modifier.exceptBy,function(t,r){return sn.modifiers.exceptBy(r[0],r.by)(t)}),jt(Ce.structureQuery.modifier.includeConnected,function(t,r){var n,i;return sn.modifiers.includeConnected({query:r[0],bondTest:r["bond-test"],wholeResidues:!!(r["as-whole-residues"]&&r["as-whole-residues"](t)),layerCount:r["layer-count"]&&r["layer-count"](t)||1,fixedPoint:(i=(n=r["fixed-point"])===null||n===void 0?void 0:n.call(r,t))!==null&&i!==void 0?i:!1})(t)}),jt(Ce.structureQuery.combinator.merge,function(e,t){return sn.combinators.merge(t)(e)}),jt(Ce.structureQuery.atomProperty.core.elementSymbol,fn(lt.atom.type_symbol)),jt(Ce.structureQuery.atomProperty.core.vdw,function(e,t){return A2(lt.atom.type_symbol(t&&t[0]&&t[0](e)||e.element))}),jt(Ce.structureQuery.atomProperty.core.mass,function(e,t){return M6e(lt.atom.type_symbol(t&&t[0]&&t[0](e)||e.element))}),jt(Ce.structureQuery.atomProperty.core.atomicNumber,function(e,t){return P2(lt.atom.type_symbol(t&&t[0]&&t[0](e)||e.element))}),jt(Ce.structureQuery.atomProperty.core.x,fn(lt.atom.x)),jt(Ce.structureQuery.atomProperty.core.y,fn(lt.atom.y)),jt(Ce.structureQuery.atomProperty.core.z,fn(lt.atom.z)),jt(Ce.structureQuery.atomProperty.core.sourceIndex,fn(lt.atom.sourceIndex)),jt(Ce.structureQuery.atomProperty.core.operatorName,fn(lt.unit.operator_name)),jt(Ce.structureQuery.atomProperty.core.modelIndex,fn(lt.unit.model_index)),jt(Ce.structureQuery.atomProperty.core.modelLabel,fn(lt.unit.model_label)),jt(Ce.structureQuery.atomProperty.core.atomKey,function(e,t){var r=t&&t[0]&&t[0](e)||e.element;return ph(r.unit.id,r.element)}),jt(Ce.structureQuery.atomProperty.macromolecular.residueKey,function(e,t){return p9e(t&&t[0]&&t[0](e)||e.element)}),jt(Ce.structureQuery.atomProperty.macromolecular.chainKey,function(e,t){return v9e(t&&t[0]&&t[0](e)||e.element)}),jt(Ce.structureQuery.atomProperty.macromolecular.entityKey,function(e,t){return m9e(t&&t[0]&&t[0](e)||e.element)}),jt(Ce.structureQuery.atomProperty.macromolecular.id,fn(lt.atom.id)),jt(Ce.structureQuery.atomProperty.macromolecular.isHet,function(e,t){return lt.residue.group_PDB(t&&t[0]&&t[0](e)||e.element)!=="ATOM"}),jt(Ce.structureQuery.atomProperty.macromolecular.label_atom_id,fn(lt.atom.label_atom_id)),jt(Ce.structureQuery.atomProperty.macromolecular.label_alt_id,fn(lt.atom.label_alt_id)),jt(Ce.structureQuery.atomProperty.macromolecular.label_comp_id,fn(lt.atom.label_comp_id)),jt(Ce.structureQuery.atomProperty.macromolecular.label_seq_id,fn(lt.residue.label_seq_id)),jt(Ce.structureQuery.atomProperty.macromolecular.label_asym_id,fn(lt.chain.label_asym_id)),jt(Ce.structureQuery.atomProperty.macromolecular.label_entity_id,fn(lt.entity.id)),jt(Ce.structureQuery.atomProperty.macromolecular.auth_atom_id,fn(lt.atom.auth_atom_id)),jt(Ce.structureQuery.atomProperty.macromolecular.auth_comp_id,fn(lt.atom.auth_comp_id)),jt(Ce.structureQuery.atomProperty.macromolecular.auth_seq_id,fn(lt.residue.auth_seq_id)),jt(Ce.structureQuery.atomProperty.macromolecular.auth_asym_id,fn(lt.chain.auth_asym_id)),jt(Ce.structureQuery.atomProperty.macromolecular.pdbx_PDB_ins_code,fn(lt.residue.pdbx_PDB_ins_code)),jt(Ce.structureQuery.atomProperty.macromolecular.pdbx_formal_charge,fn(lt.atom.pdbx_formal_charge)),jt(Ce.structureQuery.atomProperty.macromolecular.occupancy,fn(lt.atom.occupancy)),jt(Ce.structureQuery.atomProperty.macromolecular.B_iso_or_equiv,fn(lt.atom.B_iso_or_equiv)),jt(Ce.structureQuery.atomProperty.macromolecular.entityType,fn(lt.entity.type)),jt(Ce.structureQuery.atomProperty.macromolecular.entitySubtype,fn(lt.entity.subtype)),jt(Ce.structureQuery.atomProperty.macromolecular.entityPrdId,fn(lt.entity.prd_id)),jt(Ce.structureQuery.atomProperty.macromolecular.entityDescription,fn(lt.entity.pdbx_description)),jt(Ce.structureQuery.atomProperty.macromolecular.objectPrimitive,fn(lt.unit.object_primitive)),jt(Ce.structureQuery.atomProperty.macromolecular.isNonStandard,fn(lt.residue.isNonStandard)),jt(Ce.structureQuery.atomProperty.macromolecular.secondaryStructureKey,fn(lt.residue.secondary_structure_key)),jt(Ce.structureQuery.atomProperty.macromolecular.secondaryStructureFlags,fn(lt.residue.secondary_structure_type)),jt(Ce.structureQuery.atomProperty.macromolecular.chemCompType,fn(lt.residue.chem_comp_type)),jt(Ce.structureQuery.bondProperty.order,function(e,t){return e.atomicBond.order}),jt(Ce.structureQuery.bondProperty.flags,function(e,t){return e.atomicBond.type}),jt(Ce.structureQuery.bondProperty.atomA,function(e,t){return e.atomicBond.a}),jt(Ce.structureQuery.bondProperty.atomB,function(e,t){return e.atomicBond.b}),jt(Ce.structureQuery.bondProperty.length,function(e,t){return e.atomicBond.length}),jt(Ce.internal.generator.bundleElement,function(t,r){return pee(r.groupedUnits(t),r.ranges(t),r.set(t))}),jt(Ce.internal.generator.bundle,function(t,r){return vee(r.elements(t))(t)}),jt(Ce.internal.generator.current,function(t,r){return t.tryGetCurrentSelection()})];function fn(e){return function(t,r){return e(r&&r[0]&&r[0](t)||t.element)}}function Qj(e,t){return e|(Hr.isName(t)?Hr.fromName(t):0)}function Zj(e,t){switch(t.toLowerCase()){case"helix":return e|2;case"alpha":return e|2|4096;case"pi":return e|2|32768;case"310":return e|2|2048;case"beta":return e|4;case"strand":return e|4|4194304;case"sheet":return e|4|8388608;case"turn":return e|16;case"bend":return e|8;case"coil":return e|536870912;default:return e}}function Q9e(e,t){var r=[];if(!t)return r;if(typeof t.length=="number")for(var n=0,i=t.length;n<i;n++)r.push(t[n](e));else for(var a=Object.keys(t),n=1,i=a.length;n<i;n++)r.push(t[a[n]](e));return r}(function(){for(var e=0,t=K9e;e<t.length;e++){var r=t[e];Cw.addSymbol(r)}})();var Lu;(function(e){function t(s){var u=new DataView(s.buffer);return Object.assign(s.subarray(0),{readInt8:function(l){return u.getInt8(l)},readUInt8:function(l){return u.getUint8(l)},writeInt8:function(l,c){return u.setInt8(c,l)},writeUInt8:function(l,c){return u.setUint8(c,l)},readInt16LE:function(l){return u.getInt16(l,!0)},readInt32LE:function(l){return u.getInt32(l,!0)},readUInt16LE:function(l){return u.getUint16(l,!0)},readUInt32LE:function(l){return u.getUint32(l,!0)},readFloatLE:function(l){return u.getFloat32(l,!0)},readDoubleLE:function(l){return u.getFloat64(l,!0)},writeInt16LE:function(l,c){return u.setInt16(c,l,!0)},writeInt32LE:function(l,c){return u.setInt32(c,l,!0)},writeUInt16LE:function(l,c){return u.setUint16(c,l,!0)},writeUInt32LE:function(l,c){return u.setUint32(c,l,!0)},writeFloatLE:function(l,c){return u.setFloat32(c,l,!0)},writeDoubleLE:function(l,c){return u.setFloat64(c,l,!0)},readInt16BE:function(l){return u.getInt16(l,!1)},readInt32BE:function(l){return u.getInt32(l,!1)},readUInt16BE:function(l){return u.getUint16(l,!1)},readUInt32BE:function(l){return u.getUint32(l,!1)},readFloatBE:function(l){return u.getFloat32(l,!1)},readDoubleBE:function(l){return u.getFloat64(l,!1)},writeInt16BE:function(l,c){return u.setInt16(c,l,!1)},writeInt32BE:function(l,c){return u.setInt32(c,l,!1)},writeUInt16BE:function(l,c){return u.setUint16(c,l,!1)},writeUInt32BE:function(l,c){return u.setUint32(c,l,!1)},writeFloatBE:function(l,c){return u.setFloat32(c,l,!1)},writeDoubleBE:function(l,c){return u.setFloat64(c,l,!1)},copy:function(l,c,d,f){return c=Oi(c,0),d=Oi(d,0),f=Oi(f,s.length),l.set(s.subarray(d,f),c),f-d}})}e.fromUint8Array=t;function r(s){return t(new Uint8Array(s))}e.fromArrayBuffer=r;function n(s){return s}e.fromBuffer=n,e.IsNativeEndianLittle=new Uint16Array(new Uint8Array([18,52]).buffer)[0]===13330;function i(s,u,l,c,d){for(var f=0,h=l;f<h;f+=c)for(var v=0;v<c;v++)u[d+f+c-v-1]=s[d+f+v]}e.flipByteOrder=i;function a(s,u,l){u===void 0&&(u=0);for(var c=new Int16Array(s,u,l),d=0,f=c.length;d<f;++d){var h=c[d];c[d]=(h&255)<<8|h>>8&255}}e.flipByteOrderInPlace2=a;function o(s,u,l,c,d){e.IsNativeEndianLittle||!l||c<=1||i(s,u,l,c,d)}e.ensureLittleEndian=o})(Lu||(Lu={}));var _w;(function(e){function t(r,n){return{name:n,readBuffer:function(i,a,o,s){var u,l;if(typeof a=="number"){o=Oi(o,a);var c=i,d=Math.min(r.length,c+o);u=d-c,l=Lu.fromUint8Array(new Uint8Array(r.buffer,c,d-c))}else{o=Oi(o,a.length);var c=i,d=Math.min(r.length,c+o);a.set(r.subarray(c,d),s),u=d-c,l=a}return o!==u&&console.warn("byteCount "+o+" and bytesRead "+u+" differ"),Promise.resolve({bytesRead:u,buffer:l})},writeBuffer:function(i,a,o){return o=Oi(o,a.length),console.error(".writeBuffer not implemented for FileHandle.fromBuffer"),Promise.resolve(0)},writeBufferSync:function(i,a,o){return o=Oi(o,a.length),console.error(".writeSync not implemented for FileHandle.fromBuffer"),0},close:Lf}}e.fromBuffer=t})(_w||(_w={}));var xa;(function(e){e.Float32="float32",e.Int8="int8",e.Int16="int16",e.Uint16="uint16"})(xa||(xa={}));function Mee(e){return e===xa.Float32?4:e===xa.Int16||e===xa.Uint16?2:1}function Z9e(e,t,r,n){return r===void 0&&(r=0),e===xa.Float32?new Float32Array(t,r,n):e===xa.Int16?new Int16Array(t,r,n):e===xa.Uint16?new Uint16Array(t,r,n):new Int8Array(t,r,n)}function J9e(e,t){var r=Mee(t),n=new ArrayBuffer(r*e),i=Lu.fromArrayBuffer(n),a=Lu.IsNativeEndianLittle?n:new ArrayBuffer(r*e);return{type:t,elementByteSize:r,readBuffer:i,valuesBuffer:new Uint8Array(a),values:Z9e(t,a)}}function eUe(e,t,r,n,i,a){return ce(this,void 0,void 0,function(){return de(this,function(o){switch(o.label){case 0:return[4,t.readBuffer(r,e.readBuffer,n,i)];case 1:return o.sent(),e.elementByteSize>1&&(a!==void 0&&a!==Lu.IsNativeEndianLittle||!Lu.IsNativeEndianLittle)&&Lu.flipByteOrder(e.readBuffer,e.valuesBuffer,n,e.elementByteSize,i),[2,e.values]}})})}function tUe(e){return ce(this,void 0,void 0,function(){var t,r,n,i,a,o,s,u,l;return de(this,function(c){switch(c.label){case 0:return t=1024,[4,e.readBuffer(0,t)];case 1:if(r=c.sent().buffer,n=String.fromCharCode(r.readUInt8(52*4),r.readUInt8(52*4+1),r.readUInt8(52*4+2),r.readUInt8(52*4+3)),n!=="MAP ")throw new Error('ccp4 format error, missing "MAP " string');return i=[r.readUInt8(53*4),r.readUInt8(53*4+1)],a=!1,i[0]===68&&i[1]===65?a=!0:i[0]===17&&i[1]===17?a=!1:(o=r.readInt32LE(3*4),o<=16&&(a=!0)),s=a?function(d){return r.readInt32LE(d*4)}:function(d){return r.readInt32BE(d*4)},u=a?function(d){return r.readFloatLE(d*4)}:function(d){return r.readFloatBE(d*4)},l={NC:s(0),NR:s(1),NS:s(2),MODE:s(3),NCSTART:s(4),NRSTART:s(5),NSSTART:s(6),NX:s(7),NY:s(8),NZ:s(9),xLength:u(10),yLength:u(11),zLength:u(12),alpha:u(13),beta:u(14),gamma:u(15),MAPC:s(16),MAPR:s(17),MAPS:s(18),AMIN:u(19),AMAX:u(20),AMEAN:u(21),ISPG:s(22),NSYMBT:s(23),LSKFLG:s(24),SKWMAT:[],SKWTRN:[],userFlag1:s(39),userFlag2:s(40),originX:u(49),originY:u(50),originZ:u(51),MAP:n,MACHST:i,ARMS:u(54)},[2,{header:l,littleEndian:a}]}})})}function rUe(e,t,r,n,i,a){return ce(this,void 0,void 0,function(){var o,s,u,l,c,d;return de(this,function(f){switch(f.label){case 0:return Ree(e)?(o=3*i,[4,r.readBuffer(n,t.readBuffer,i,o)]):[3,2];case 1:for(f.sent(),s=new Int8Array(t.valuesBuffer.buffer,o),u=(e.AMAX-e.AMIN)/255,l=.5*(e.AMIN+e.AMAX+u),c=0,d=i;c<d;++c)t.values[c]=u*s[c]+l;return[3,4];case 2:return[4,eUe(t,r,n,i,0,a)];case 3:f.sent(),f.label=4;case 4:return[2]}})})}function Dee(e){switch(e){case 0:return xa.Int8;case 1:return xa.Int16;case 2:return xa.Float32;case 3:throw new Error("mode 3 unsupported, complex 16-bit integers");case 4:throw new Error("mode 4 unsupported, complex 32-bit reals");case 6:xa.Uint16;case 16:throw new Error("mode 16 unsupported, unsigned char * 3 (for rgb data, non-standard)")}throw new Error("unknown mode '"+e+"'")}function Ree(e){return e.userFlag1===-128&&e.userFlag2===127}function kee(e){return Ree(e)?xa.Float32:Dee(e.MODE)}function nUe(e){return 256*4+e.NSYMBT}function iUe(e,t,r){return ce(this,void 0,void 0,function(){var n,i,a,o,s,u,l,c,d,f,h;return de(this,function(v){switch(v.label){case 0:return[4,r.update({message:"Parsing CCP4/MRC/MAP file..."})];case 1:return v.sent(),[4,tUe(e)];case 2:return n=v.sent(),i=n.header,a=n.littleEndian,o=nUe(i),s=Dee(i.MODE),u=kee(i),l=i.NC*i.NR*i.NS,c=Mee(s),d=l*c,f=J9e(l,u),rUe(i,f,e,o,d,a),h={header:i,values:f.values,name:e.name},[2,h]}})})}function aUe(e,t){var r=this;return $e.create("Parse CCP4/MRC/MAP",function(n){return ce(r,void 0,void 0,function(){var i,a,o;return de(this,function(s){switch(s.label){case 0:return s.trys.push([0,2,,3]),a=(i=Rn).success,[4,iUe(e,t,n)];case 1:return[2,a.apply(i,[s.sent()])];case 2:return o=s.sent(),[2,Rn.error(o)];case 3:return[2]}})})})}function oUe(e,t){return aUe(_w.fromBuffer(Lu.fromUint8Array(e),t),e.length)}var qD=512;function sUe(e){return{xStart:parseInt(e.substr(10,5)),yStart:parseInt(e.substr(15,5)),zStart:parseInt(e.substr(20,5)),xExtent:parseInt(e.substr(32,5)),yExtent:parseInt(e.substr(38,5)),zExtent:parseInt(e.substr(42,5)),xRate:parseInt(e.substr(52,5)),yRate:parseInt(e.substr(58,5)),zRate:parseInt(e.substr(62,5)),xlen:parseFloat(e.substr(73,10)),ylen:parseFloat(e.substr(83,10)),zlen:parseFloat(e.substr(93,10)),alpha:parseFloat(e.substr(103,10)),beta:parseFloat(e.substr(113,10)),gamma:parseFloat(e.substr(123,10)),divisor:parseFloat(e.substr(138,12)),summand:parseInt(e.substr(155,8)),sigma:parseFloat(e.substr(170,12))}}function uUe(e,t){var r=t?function(i){return e.readInt16LE(i*2)}:function(i){return e.readInt16BE(i*2)},n=1/r(17);return{xStart:r(0),yStart:r(1),zStart:r(2),xExtent:r(3),yExtent:r(4),zExtent:r(5),xRate:r(6),yRate:r(7),zRate:r(8),xlen:r(9)*n,ylen:r(10)*n,zlen:r(11)*n,alpha:r(12)*n,beta:r(13)*n,gamma:r(14)*n,divisor:r(15)/100,summand:r(16),sigma:void 0}}function Oee(e){var t=e.xExtent,r=e.yExtent,n=e.zExtent,i=Math.ceil(t/8),a=Math.ceil(r/8),o=Math.ceil(n/8);return{xBlocks:i,yBlocks:a,zBlocks:o}}function lUe(e){return ce(this,void 0,void 0,function(){var t,r,n,i,a;return de(this,function(o){switch(o.label){case 0:return[4,e.readBuffer(0,qD)];case 1:return t=o.sent().buffer,r=String.fromCharCode.apply(null,t),n=r.startsWith(":-)"),i=n||t.readInt16LE(18*2)===100,a=n?sUe(r):uUe(t,i),[2,{header:a,littleEndian:i}]}})})}function cUe(e,t,r,n){return ce(this,void 0,void 0,function(){var i,a,o,s,u,l,c,d,f,h,v,p,m,g,y,b,S,x,C,w;return de(this,function(A){for(n||Lu.flipByteOrderInPlace2(t.buffer),i=e.divisor,a=e.summand,o=e.xExtent,s=e.yExtent,u=e.zExtent,l=Oee(e),c=l.xBlocks,d=l.yBlocks,f=l.zBlocks,h=0,v=0;v<f;++v)for(p=0;p<d;++p)for(m=0;m<c;++m)for(g=0;g<8;++g)for(y=8*v+g,b=0;b<8;++b)for(S=8*p+b,x=0;x<8;++x)if(C=8*m+x,C<o&&S<s&&y<u)w=(C*s+S)*u+y,r[w]=(t[h]-a)/i,++h;else{h+=8-x;break}return[2]})})}function dUe(e){var t=e.xExtent,r=e.yExtent,n=e.zExtent,i=Oee(e),a=i.xBlocks,o=i.yBlocks,s=i.zBlocks,u=t*r*n,l=a*8*o*8*s*8,c=1,d=l*c;return{count:l,byteCount:d,valueCount:u}}function fUe(e,t,r){return ce(this,void 0,void 0,function(){var n,i,a,o,s,u,l;return de(this,function(c){switch(c.label){case 0:return[4,r.update({message:"Parsing DSN6/BRIX file..."})];case 1:return c.sent(),[4,lUe(e)];case 2:return n=c.sent(),i=n.header,a=n.littleEndian,[4,e.readBuffer(qD,t-qD)];case 3:return o=c.sent().buffer,s=dUe(i).valueCount,u=new Float32Array(s),[4,cUe(i,o,u,a)];case 4:return c.sent(),l={header:i,values:u,name:e.name},[2,l]}})})}function hUe(e,t){var r=this;return $e.create("Parse DSN6/BRIX",function(n){return ce(r,void 0,void 0,function(){var i,a,o;return de(this,function(s){switch(s.label){case 0:return s.trys.push([0,2,,3]),a=(i=Rn).success,[4,fUe(e,t,n)];case 1:return[2,a.apply(i,[s.sent()])];case 2:return o=s.sent(),[2,Rn.error(o)];case 3:return[2]}})})})}function pUe(e,t){return hUe(_w.fromBuffer(Lu.fromUint8Array(e),t),e.length)}var vUe={char:1,uchar:1,short:2,ushort:2,int:4,uint:4,float:4,double:8,int8:1,uint8:1,int16:2,uint16:2,int32:4,uint32:4,float32:4,float64:8},mUe=new Set(Object.keys(vUe));function uT(e){if(!mUe.has(e))throw new Error("unknown ply type '"+e+"'");return e}function gUe(e,t,r){for(var n=new Map,i=0,a=t.length;i<a;++i)n.set(t[i],e[i]);return{comments:r,elementNames:t,getElement:function(o){return n.get(o)}}}function yUe(e,t){var r=It(e);return{data:e,tokenizer:r,runtimeCtx:t,comments:[],elementSpecs:[],elements:[]}}function bUe(e){var t=e.data.indexOf("end_header",e.position);if(t===-1)throw new Error("no 'end_header' record found");e.tokenStart=e.position,e.tokenEnd=t,e.position=t,It.eatLine(e)}function xUe(e){var t=e.tokenizer,r=e.comments,n=e.elementSpecs;bUe(t);var i=It.getTokenString(t).split(/\r?\n/);if(i[0]!=="ply")throw new Error("data not starting with 'ply'");if(i[1]!=="format ascii 1.0")throw new Error("format not 'ascii 1.0'");var a,o,s;function u(){if(a!==void 0&&o!==void 0&&s!==void 0){for(var h=!1,v=0,p=s.length;v<p;++v){var m=s[v];if(m.kind==="list"){h=!0;break}}h&&s.length,h?n.push({kind:"list",name:a,count:o,property:s[0]}):n.push({kind:"table",name:a,count:o,properties:s})}}for(var l=2,c=i.length;l<c;++l){var d=i[l],f=d.split(" ");if(d.startsWith("comment"))r.push(d.substr(8));else if(d.startsWith("element"))u(),s=[],a=f[1],o=parseInt(f[2]);else if(d.startsWith("property")){if(s===void 0)throw new Error("properties outside of element");f[1]==="list"?s.push({kind:"list",countType:uT(f[2]),dataType:uT(f[3]),name:f[4]}):s.push({kind:"column",type:uT(f[1]),name:f[2]})}else d.startsWith("end_header")?u():console.warn("unknown header line")}}function SUe(e){for(var t=e.elementSpecs,r=0,n=t.length;r<n;++r){var i=t[r];i.kind==="table"?CUe(e,i):i.kind==="list"&&_Ue(e,i)}}function Fee(e){switch(e){case"char":case"uchar":case"int8":case"uint8":case"short":case"ushort":case"int16":case"uint16":case"int":case"uint":case"int32":case"uint32":return ve.Schema.int;case"float":case"double":case"float32":case"float64":return ve.Schema.float}}function CUe(e,t){for(var r=e.elements,n=e.tokenizer,i=t.count,a=t.properties,o=a.length,s=[],u=[],l=[],c=new Map,d=0,f=o;d<f;++d){var h=ht.create(n.data,i*2);l.push(h)}for(var d=0,f=i;d<f;++d)for(var v=0,p=o;v<p;++v)It.skipWhitespace(n),It.markStart(n),It.eatValue(n),ht.addUnchecked(l[v],n.tokenStart,n.tokenEnd);for(var d=0,f=o;d<f;++d){var m=a[d],g=m.type,y=m.name,b=eF(l[d],Fee(g));s.push(y),u.push(g),c.set(y,b)}r.push({kind:"table",rowCount:i,propertyNames:s,propertyTypes:u,getProperty:function(S){return c.get(S)}})}function _Ue(e,t){for(var r=e.elements,n=e.tokenizer,i=t.count,a=t.property,o=ht.create(n.data,i*2*3),s=new Uint32Array(i+1),u=0,l=0,c=i;l<c;++l){for(It.skipWhitespace(n),It.markStart(n);It.skipWhitespace(n)!==10;)++u,It.markStart(n),It.eatValue(n),ht.addToken(o,n);s[l+1]=u}var d={entries:[],count:0},f=eF(o,Fee(a.dataType));r.push({kind:"list",rowCount:i,name:a.name,type:a.dataType,value:function(h){for(var v=s[h]+1,p=f.value(v-1),m=v,g=v+p;m<g;++m)d.entries[m-v]=f.value(m);return d.count=p,d}})}function wUe(e,t){return ce(this,void 0,void 0,function(){var r,n,i,a,o,s;return de(this,function(u){return r=yUe(e,t),t.update({message:"Parsing...",current:0,max:e.length}),xUe(r),SUe(r),n=r.elements,i=r.elementSpecs,a=r.comments,o=i.map(function(l){return l.name}),s=gUe(n,o,a),[2,Rn.success(s)]})})}function EUe(e){var t=this;return $e.create("Parse PLY",function(r){return ce(t,void 0,void 0,function(){return de(this,function(n){switch(n.label){case 0:return[4,wUe(e,r)];case 1:return[2,n.sent()]}})})})}var ww=It.readLine,Lee=It.skipWhitespace,Nee=It.eatValue,AUe=It.eatLine,$D=It.markStart,AC=/\s+/,PUe=/(^\*|REMARK)*/;function TUe(e,t){return{tokenizer:e,runtimeCtx:t}}function IUe(e,t){return ce(this,void 0,void 0,function(){var r,n,i,a,o,s,u,l,c,d,f,h,v,p,m;return de(this,function(g){switch(g.label){case 0:return r=e.tokenizer,n=ht.create(r.data,t*2),i=ht.create(r.data,t*2),a=ht.create(r.data,t*2),o=ht.create(r.data,t*2),s=ht.create(r.data,t*2),u=ht.create(r.data,t*2),l=ht.create(r.data,t*2),c=ht.create(r.data,t*2),d=r.position,f=ww(r).trim(),r.position=d,h=f.split(AC).length===7,v=h?6:8,p=r.length,m=0,[4,fd(e.runtimeCtx,1e5,void 0,function(y){for(var b=Math.min(t-m,y),S=0;S<b;++S){for(var x=0;x<v;++x)if(Lee(r),$D(r),Nee(r),h)switch(x){case 0:ht.addUnchecked(n,r.tokenStart,r.tokenEnd);break;case 1:ht.addUnchecked(a,r.tokenStart,r.tokenEnd);break;case 2:ht.addUnchecked(s,r.tokenStart,r.tokenEnd);break;case 3:ht.addUnchecked(u,r.tokenStart,r.tokenEnd);break;case 4:ht.addUnchecked(l,r.tokenStart,r.tokenEnd);break;case 5:ht.addUnchecked(c,r.tokenStart,r.tokenEnd);break}else switch(x){case 0:ht.addUnchecked(n,r.tokenStart,r.tokenEnd);break;case 1:ht.addUnchecked(i,r.tokenStart,r.tokenEnd);break;case 2:ht.addUnchecked(a,r.tokenStart,r.tokenEnd);break;case 3:ht.addUnchecked(o,r.tokenStart,r.tokenEnd);break;case 4:ht.addUnchecked(s,r.tokenStart,r.tokenEnd);break;case 5:ht.addUnchecked(u,r.tokenStart,r.tokenEnd);break;case 6:ht.addUnchecked(l,r.tokenStart,r.tokenEnd);break;case 7:ht.addUnchecked(c,r.tokenStart,r.tokenEnd);break}AUe(r),$D(r)}return m+=b,b},function(y){return y.update({message:"Parsing...",current:r.position,max:p})})];case 1:return g.sent(),[2,{count:t,atomId:Qr(n)(ve.Schema.int),segmentName:h?Qr(a)(ve.Schema.str):Qr(i)(ve.Schema.str),residueId:Qr(a)(ve.Schema.int),residueName:h?Qr(a)(ve.Schema.str):Qr(o)(ve.Schema.str),atomName:Qr(s)(ve.Schema.str),atomType:Qr(u)(ve.Schema.str),charge:Qr(l)(ve.Schema.float),mass:Qr(c)(ve.Schema.float)}]}})})}function MUe(e,t){return ce(this,void 0,void 0,function(){var r,n,i,a,o;return de(this,function(s){switch(s.label){case 0:return r=e.tokenizer,n=ht.create(r.data,t*2),i=ht.create(r.data,t*2),a=r.length,o=0,[4,fd(e.runtimeCtx,10,void 0,function(u){for(var l=Math.min(t-o,u),c=0;c<l;++c)for(var d=0;d<2;++d)switch(Lee(r),$D(r),Nee(r),d){case 0:ht.addUnchecked(n,r.tokenStart,r.tokenEnd);break;case 1:ht.addUnchecked(i,r.tokenStart,r.tokenEnd);break}return o+=l,l},function(u){return u.update({message:"Parsing...",current:r.position,max:a})})];case 1:return s.sent(),[2,{count:t,atomIdA:Qr(n)(ve.Schema.int),atomIdB:Qr(i)(ve.Schema.int)}]}})})}function DUe(e,t){for(var r=[],n=0;n<t;++n){var i=ww(e.tokenizer);r.push(i.replace(PUe,"").trim())}return r}function RUe(e,t){return ce(this,void 0,void 0,function(){var r,n,i,a,o,s,u,l,c,d,f;return de(this,function(h){switch(h.label){case 0:r=It(e),n=TUe(r,t),i=void 0,a=void 0,o=void 0,s=ww(n.tokenizer).trim(),h.label=1;case 1:return r.tokenEnd<r.length?(u=ww(n.tokenizer).trim(),u.includes("!NTITLE")?(l=parseInt(u.split(AC)[0]),i=DUe(n,l),[3,7]):[3,2]):[3,8];case 2:return u.includes("!NATOM")?(c=parseInt(u.split(AC)[0]),[4,IUe(n,c)]):[3,4];case 3:return a=h.sent(),[3,7];case 4:return u.includes("!NBOND")?(d=parseInt(u.split(AC)[0]),[4,MUe(n,d)]):[3,6];case 5:return o=h.sent(),[3,8];case 6:u.includes("!NTHETA")||u.includes("!NPHI")||u.includes("!NIMPHI")||u.includes("!NDON")||u.includes("!NACC")||u.includes("!NNB")||u.includes("!NGRP NST2")||u.includes("!MOLNT")||u.includes("!NUMLP NUMLPH")||u.includes("!NCRTERM"),h.label=7;case 7:return[3,1];case 8:return i===void 0&&(i=[]),a===void 0?[2,Rn.error("no atoms data")]:o===void 0?[2,Rn.error("no bonds data")]:(f={id:s,title:i,atoms:a,bonds:o},[2,Rn.success(f)])}})})}function kUe(e){var t=this;return $e.create("Parse PSF",function(r){return ce(t,void 0,void 0,function(){return de(this,function(n){switch(n.label){case 0:return[4,RUe(e,r)];case 1:return[2,n.sent()]}})})})}var ge;(function(e){e.Create=Nn.factory();function t(s){return!!s&&s.type.typeClass==="Representation3D"}e.isRepresentation3D=t;function r(s){return!!s&&s.type.typeClass==="Behavior"}e.isBehavior=r;function n(s){return e.Create(E(E({},s),{typeClass:"Representation3D"}))}e.CreateRepresentation3D=n;function i(s){return e.Create(E(E({},s),{typeClass:"Behavior"}))}e.CreateBehavior=i;var a=function(s){Le(u,s);function u(){return s!==null&&s.apply(this,arguments)||this}return u}(e.Create({name:"Root",typeClass:"Root"}));e.Root=a;var o=function(s){Le(u,s);function u(){return s!==null&&s.apply(this,arguments)||this}return u}(e.Create({name:"Group",typeClass:"Group"}));e.Group=o,function(s){var u=function(d){Le(f,d);function f(){return d!==null&&d.apply(this,arguments)||this}return f}(e.Create({name:"String Data",typeClass:"Data"}));s.String=u;var l=function(d){Le(f,d);function f(){return d!==null&&d.apply(this,arguments)||this}return f}(e.Create({name:"Binary Data",typeClass:"Data"}));s.Binary=l;var c=function(d){Le(f,d);function f(){return d!==null&&d.apply(this,arguments)||this}return f}(e.Create({name:"Data Blob",typeClass:"Data"}));s.Blob=c}(e.Data||(e.Data={})),function(s){var u=function(g){Le(y,g);function y(){return g!==null&&g.apply(this,arguments)||this}return y}(e.Create({name:"JSON Data",typeClass:"Data"}));s.Json=u;var l=function(g){Le(y,g);function y(){return g!==null&&g.apply(this,arguments)||this}return y}(e.Create({name:"CIF File",typeClass:"Data"}));s.Cif=l;var c=function(g){Le(y,g);function y(){return g!==null&&g.apply(this,arguments)||this}return y}(e.Create({name:"Cube File",typeClass:"Data"}));s.Cube=c;var d=function(g){Le(y,g);function y(){return g!==null&&g.apply(this,arguments)||this}return y}(e.Create({name:"PSF File",typeClass:"Data"}));s.Psf=d;var f=function(g){Le(y,g);function y(){return g!==null&&g.apply(this,arguments)||this}return y}(e.Create({name:"PLY File",typeClass:"Data"}));s.Ply=f;var h=function(g){Le(y,g);function y(){return g!==null&&g.apply(this,arguments)||this}return y}(e.Create({name:"CCP4/MRC/MAP File",typeClass:"Data"}));s.Ccp4=h;var v=function(g){Le(y,g);function y(){return g!==null&&g.apply(this,arguments)||this}return y}(e.Create({name:"DSN6/BRIX File",typeClass:"Data"}));s.Dsn6=v;var p=function(g){Le(y,g);function y(){return g!==null&&g.apply(this,arguments)||this}return y}(e.Create({name:"DX File",typeClass:"Data"}));s.Dx=p;var m=function(g){Le(y,g);function y(){return g!==null&&g.apply(this,arguments)||this}return y}(e.Create({name:"Format Blob",typeClass:"Data"}));s.Blob=m}(e.Format||(e.Format={})),function(s){var u=function(h){Le(v,h);function v(){return h!==null&&h.apply(this,arguments)||this}return v}(e.Create({name:"Coordinates",typeClass:"Object"}));s.Coordinates=u;var l=function(h){Le(v,h);function v(){return h!==null&&h.apply(this,arguments)||this}return v}(e.Create({name:"Topology",typeClass:"Object"}));s.Topology=l;var c=function(h){Le(v,h);function v(){return h!==null&&h.apply(this,arguments)||this}return v}(e.Create({name:"Model",typeClass:"Object"}));s.Model=c;var d=function(h){Le(v,h);function v(){return h!==null&&h.apply(this,arguments)||this}return v}(e.Create({name:"Trajectory",typeClass:"Object"}));s.Trajectory=d;var f=function(h){Le(v,h);function v(){return h!==null&&h.apply(this,arguments)||this}return v}(e.Create({name:"Structure",typeClass:"Object"}));s.Structure=f,function(h){var v=function(g){Le(y,g);function y(){return g!==null&&g.apply(this,arguments)||this}return y}(n({name:"Structure 3D"}));h.Representation3D=v;var p=function(g){Le(y,g);function y(){return g!==null&&g.apply(this,arguments)||this}return y}(e.Create({name:"Structure 3D State",typeClass:"Object"}));h.Representation3DState=p;var m=function(g){Le(y,g);function y(){return g!==null&&g.apply(this,arguments)||this}return y}(e.Create({name:"Selections",typeClass:"Object"}));h.Selections=m}(f=s.Structure||(s.Structure={}))}(e.Molecule||(e.Molecule={})),function(s){var u=function(d){Le(f,d);function f(){return d!==null&&d.apply(this,arguments)||this}return f}(e.Create({name:"Volume",typeClass:"Object"}));s.Data=u;var l=function(d){Le(f,d);function f(){return d!==null&&d.apply(this,arguments)||this}return f}(e.Create({name:"Lazy Volume",typeClass:"Object"}));s.Lazy=l;var c=function(d){Le(f,d);function f(){return d!==null&&d.apply(this,arguments)||this}return f}(n({name:"Volume 3D"}));s.Representation3D=c}(e.Volume||(e.Volume={})),function(s){var u=function(c){Le(d,c);function d(){return c!==null&&c.apply(this,arguments)||this}return d}(e.Create({name:"Shape Provider",typeClass:"Object"}));s.Provider=u;var l=function(c){Le(d,c);function d(){return c!==null&&c.apply(this,arguments)||this}return d}(n({name:"Shape 3D"}));s.Representation3D=l}(e.Shape||(e.Shape={}))})(ge||(ge={}));var kt;(function(e){e.CreateBuiltIn=ft.factory("ms-plugin"),e.BuiltIn=ft.builderFactory("ms-plugin")})(kt||(kt={}));var Jj=.529177210859;function OUe(e){var t=It.readLines(e,6),r=function(D,k){var R=+t[D].trim().split(/\s+/g)[k];return Number.isNaN(R)?0:R},n=function(D){var k=r(D+2,0),R=Jj;return[Math.abs(k),_.create(r(D+2,1)*R,r(D+2,2)*R,r(D+2,3)*R),k]},i=t[0].trim(),a=t[1].trim(),o=n(0),s=o[0],u=o[1],l=o[2],c=n(1),d=c[0],f=c[1],h=n(2),v=h[0],p=h[1],m=n(3),g=m[0],y=m[1],b=FUe(e,s,Jj),S=[];if(l>=0){var x=r(2,4);x===0&&(x=1);for(var C=0;C<x;C++)S.push(C)}else for(var w=It.readLine(e).trim().split(/\s+/g),C=0,A=+w[0];C<A;C++)S.push(+w[C+1]);var M={orbitals:l<0,comment1:i,comment2:a,atomCount:s,origin:u,dim:_.create(d,v,g),basisX:f,basisY:p,basisZ:y,dataSetIds:S};return{header:M,atoms:b}}function FUe(e,t,r){for(var n=new Int32Array(t),i=new Float64Array(t),a=new Float32Array(t),o=new Float32Array(t),s=new Float32Array(t),u=0;u<t;u++){var l=It.readLine(e).trim().split(/\s+/g);n[u]=+l[0],i[u]=+l[1],a[u]=+l[2]*r,o[u]=+l[3]*r,s[u]=+l[4]*r}return{count:t,number:ve.ofArray({array:n,schema:ve.Schema.int}),nuclearCharge:ve.ofArray({array:i,schema:ve.Schema.float}),x:ve.ofArray({array:a,schema:ve.Schema.float}),y:ve.ofArray({array:o,schema:ve.Schema.float}),z:ve.ofArray({array:s,schema:ve.Schema.float})}}function LUe(e,t,r){var n=r.dim[0]*r.dim[1]*r.dim[2]*r.dataSetIds.length,i=100*100*100,a=new Float64Array(n),o=0;return fd(e,i,a,function(s,u){for(var l=Math.min(n,o+s),c=o;c<l;c++)It.skipWhitespace(t),t.tokenStart=t.position,It.eatValue(t),u[c]=Yc(t.data,t.tokenStart,t.tokenEnd);return o=l,l===n?0:i},function(s,u,l){return s.update({current:Math.min(l,n),max:n})})}function NUe(e,t){var r=this;return $e.create("Parse Cube",function(n){return ce(r,void 0,void 0,function(){var i,a,o,s,u;return de(this,function(l){switch(l.label){case 0:return[4,n.update("Reading header...")];case 1:return l.sent(),i=It(e),a=OUe(i),o=a.header,s=a.atoms,[4,LUe(n,i,o)];case 2:return u=l.sent(),[2,Rn.success({header:o,atoms:s,values:u,name:t})]}})})})}function Bee(e){for(var t={h:_()},r=0,n=0,i=/\s+/g;;){var a=It.readLine(e),o=void 0;if(a.startsWith("object 1"))o=a.split(i),t.dim=_.create(parseInt(o[5]),parseInt(o[6]),parseInt(o[7]));else if(a.startsWith("origin"))o=a.split(i),t.min=_.create(parseFloat(o[1]),parseFloat(o[2]),parseFloat(o[3]));else if(a.startsWith("delta"))o=a.split(i),n===0?t.h[0]=parseFloat(o[1]):n===1?t.h[1]=parseFloat(o[2]):n===2&&(t.h[2]=parseFloat(o[3])),n+=1;else if(a.startsWith("object 3")){r+=a.length+1;break}r+=a.length+1}return{header:t,headerByteCount:r}}function BUe(e,t,r){var n=r.dim[0]*r.dim[1]*r.dim[2],i=100*100*100,a=new Float64Array(n),o=0;return fd(e,i,a,function(s,u){for(var l=Math.min(n,o+s),c=o;c<l;c++)It.skipWhitespace(t),t.tokenStart=t.position,It.eatValue(t),u[c]=Yc(t.data,t.tokenStart,t.tokenEnd);return o=l,l===n?0:i},function(s,u,l){return s.update({current:Math.min(l,n),max:n})})}function UUe(e,t,r){return ce(this,void 0,void 0,function(){var n,i,a;return de(this,function(o){switch(o.label){case 0:return[4,e.update("Reading header...")];case 1:return o.sent(),n=It(t),i=Bee(n).header,[4,e.update("Reading values...")];case 2:return o.sent(),[4,BUe(e,n,i)];case 3:return a=o.sent(),[2,Rn.success({header:i,values:a,name:r})]}})})}function jUe(e,t,r){return ce(this,void 0,void 0,function(){var n,i,a,o,s,u,l,c,d;return de(this,function(f){switch(f.label){case 0:return[4,e.update("Reading header...")];case 1:return f.sent(),n=R6(t,0,1e3),i=It(n),a=Bee(i),o=a.header,s=a.headerByteCount,[4,e.update("Reading values...")];case 2:for(f.sent(),u=o.dim[0]*o.dim[1]*o.dim[2],l=new DataView(t.buffer,t.byteOffset+s),c=new Float64Array(u),d=0;d<u;d++)c[d]=l.getFloat64(d*8,!0);return[2,Rn.success({header:o,values:c,name:r})]}})})}function zUe(e,t){return $e.create("Parse Cube",function(r){return typeof e=="string"?UUe(r,e,t):jUe(r,e,t)})}var Uee=kt.BuiltIn({name:"download",display:{name:"Download",description:"Download string or binary data from the specified URL"},from:[ge.Root],to:[ge.Data.String,ge.Data.Binary],params:{url:I.Url("https://www.ebi.ac.uk/pdbe/static/entry/1cbs_updated.cif",{description:"Resource URL. Must be the same domain or support CORS."}),label:I.Optional(I.Text("")),isBinary:I.Optional(I.Boolean(!1,{description:"If true, download data as binary (string otherwise)"}))}})({apply:function(e,t){var r=this,n=e.params,i=e.cache;return $e.create("Download",function(a){return ce(r,void 0,void 0,function(){var o,s;return de(this,function(u){switch(u.label){case 0:return o=Mn.getUrlAsset(t.managers.asset,n.url),[4,t.managers.asset.resolve(o,n.isBinary?"binary":"string").runInContext(a)];case 1:return s=u.sent(),i.asset=s,[2,n.isBinary?new ge.Data.Binary(s.data,{label:n.label?n.label:o.url}):new ge.Data.String(s.data,{label:n.label?n.label:o.url})]}})})})},dispose:function(e){var t,r,n=e.cache;(r=(t=n)===null||t===void 0?void 0:t.asset)===null||r===void 0||r.dispose()},update:function(e){var t=e.oldParams,r=e.newParams,n=e.b;return t.url!==r.url||t.isBinary!==r.isBinary?ft.UpdateResult.Recreate:t.label!==r.label?(n.label=r.label||(typeof r.url=="string"?r.url:r.url.url),ft.UpdateResult.Updated):ft.UpdateResult.Unchanged}}),jee=kt.BuiltIn({name:"download-blob",display:{name:"Download Blob",description:"Download multiple string or binary data from the specified URLs."},from:ge.Root,to:ge.Data.Blob,params:{sources:I.ObjectList({id:I.Text("",{label:"Unique ID"}),url:I.Url("https://www.ebi.ac.uk/pdbe/static/entry/1cbs_updated.cif",{description:"Resource URL. Must be the same domain or support CORS."}),isBinary:I.Optional(I.Boolean(!1,{description:"If true, download data as binary (string otherwise)"})),canFail:I.Optional(I.Boolean(!1,{description:"Indicate whether the download can fail and not be included in the blob as a result."}))},function(e){return e.id+": "+e.url}),maxConcurrency:I.Optional(I.Numeric(4,{min:1,max:12,step:1},{description:"The maximum number of concurrent downloads."}))}})({apply:function(e,t){var r=this,n=e.params,i=e.cache;return $e.create("Download Blob",function(a){return ce(r,void 0,void 0,function(){var o,s,u,l,c,d;return de(this,function(f){switch(f.label){case 0:return o=[],[4,Mke(a,t.managers.asset,n.sources,n.maxConcurrency||4)];case 1:for(s=f.sent(),u=[],l=0;l<s.length;l++)c=s[l],d=n.sources[l],c.kind==="error"?t.log.warn("Download "+c.id+" ("+d.url+") failed: "+c.error):(u.push(c.result),o.push(d.isBinary?{id:c.id,kind:"binary",data:c.result.data}:{id:c.id,kind:"string",data:c.result.data}));return i.assets=u,[2,new ge.Data.Blob(o,{label:"Data Blob",description:o.length+" "+(o.length===1?"entry":"entries")})]}})})})},dispose:function(e,t){var r,n=e.cache,i=(r=n)===null||r===void 0?void 0:r.assets;if(i)for(var a=0,o=i;a<o.length;a++){var s=o[a];s.dispose()}}}),zee=kt.BuiltIn({name:"raw-data",display:{name:"Raw Data",description:"Raw data supplied by value."},from:[ge.Root],to:[ge.Data.String,ge.Data.Binary],params:{data:I.Value("",{isHidden:!0}),label:I.Optional(I.Text(""))}})({apply:function(e){var t=this,r=e.params;return $e.create("Raw Data",function(){return ce(t,void 0,void 0,function(){return de(this,function(n){if(typeof r.data=="string")return[2,new ge.Data.String(r.data,{label:r.label?r.label:"String"})];if(Array.isArray(r.data))return[2,new ge.Data.Binary(new Uint8Array(r.data),{label:r.label?r.label:"Binary"})];if(r.data instanceof ArrayBuffer)return[2,new ge.Data.Binary(new Uint8Array(r.data),{label:r.label?r.label:"Binary"})];if(r.data instanceof Uint8Array)return[2,new ge.Data.Binary(r.data,{label:r.label?r.label:"Binary"})];throw new Error("Supplied binary data must be a plain array, ArrayBuffer, or Uint8Array.")})})})},update:function(e){var t=e.oldParams,r=e.newParams,n=e.b;return t.data!==r.data?ft.UpdateResult.Recreate:t.label!==r.label?(n.label=r.label||n.label,ft.UpdateResult.Updated):ft.UpdateResult.Unchanged},customSerialization:{toJSON:function(e){if(typeof e.data=="string"||Array.isArray(e.data))return e;if(e.data instanceof ArrayBuffer){for(var t=new Uint8Array(e.data),r=new Array(t.length),n=0,i=t.length;n<i;n++)r[n]=t[n];return{data:r,label:e.label}}else if(e.data instanceof Uint8Array){for(var r=new Array(e.data.length),n=0,i=e.data.length;n<i;n++)r[n]=e.data[n];return{data:r,label:e.label}}},fromJSON:function(e){return e}}}),Vee=kt.BuiltIn({name:"read-file",display:{name:"Read File",description:"Read string or binary data from the specified file"},from:ge.Root,to:[ge.Data.String,ge.Data.Binary],params:{file:I.File(),label:I.Optional(I.Text("")),isBinary:I.Optional(I.Boolean(!1,{description:"If true, open file as as binary (string otherwise)"}))}})({apply:function(e,t){var r=this,n=e.params,i=e.cache;return $e.create("Open File",function(a){return ce(r,void 0,void 0,function(){var o,s;return de(this,function(u){switch(u.label){case 0:return n.file===null?(t.log.error("No file(s) selected"),[2,Nn.Null]):[4,t.managers.asset.resolve(n.file,n.isBinary?"binary":"string").runInContext(a)];case 1:return o=u.sent(),i.asset=o,s=n.isBinary?new ge.Data.Binary(o.data,{label:n.label?n.label:n.file.name}):new ge.Data.String(o.data,{label:n.label?n.label:n.file.name}),[2,s]}})})})},dispose:function(e){var t,r,n=e.cache;(r=(t=n)===null||t===void 0?void 0:t.asset)===null||r===void 0||r.dispose()},update:function(e){var t,r=e.oldParams,n=e.newParams,i=e.b;return r.label!==n.label?(i.label=n.label||((t=r.file)===null||t===void 0?void 0:t.name)||"",ft.UpdateResult.Updated):ft.UpdateResult.Unchanged},isSerializable:function(){return{isSerializable:!1,reason:"Cannot serialize user loaded files."}}}),VUe=kt.BuiltIn({name:"parse-blob",display:{name:"Parse Blob",description:"Parse multiple data enties"},from:ge.Data.Blob,to:ge.Format.Blob,params:{formats:I.ObjectList({id:I.Text("",{label:"Unique ID"}),format:I.Select("cif",[["cif","cif"]])},function(e){return e.id+": "+e.format})}})({apply:function(e,t){var r=this,n=e.a,i=e.params;return $e.create("Parse Blob",function(a){return ce(r,void 0,void 0,function(){var o,s,u,l,c,d,f,h,v;return de(this,function(p){switch(p.label){case 0:for(o=new Map,s=0,u=i.formats;s<u.length;s++)l=u[s],o.set(l.id,l.format);c=[],d=0,f=n.data,p.label=1;case 1:return d<f.length?(h=f[d],o.has(h.id)?[4,(h.kind==="string"?vd.parse(h.data):vd.parseBinary(h.data)).runInContext(a)]:[3,3]):[3,4];case 2:if(v=p.sent(),v.isError)throw new Error(h.id+": "+v.message);c.push({id:h.id,kind:"cif",data:v.result}),p.label=3;case 3:return d++,[3,1];case 4:return[2,new ge.Format.Blob(c,{label:"Format Blob",description:c.length+" "+(c.length===1?"entry":"entries")})]}})})})}}),HUe=kt.BuiltIn({name:"parse-cif",display:{name:"Parse CIF",description:"Parse CIF from String or Binary data"},from:[ge.Data.String,ge.Data.Binary],to:ge.Format.Cif})({apply:function(e){var t=this,r=e.a;return $e.create("Parse CIF",function(n){return ce(t,void 0,void 0,function(){var i;return de(this,function(a){switch(a.label){case 0:return[4,(ge.Data.String.is(r)?vd.parse(r.data):vd.parseBinary(r.data)).runInContext(n)];case 1:if(i=a.sent(),i.isError)throw new Error(i.message);return[2,new ge.Format.Cif(i.result)]}})})})}}),GUe=kt.BuiltIn({name:"parse-cube",display:{name:"Parse Cube",description:"Parse Cube from String data"},from:ge.Data.String,to:ge.Format.Cube})({apply:function(e){var t=this,r=e.a;return $e.create("Parse Cube",function(n){return ce(t,void 0,void 0,function(){var i;return de(this,function(a){switch(a.label){case 0:return[4,NUe(r.data,r.label).runInContext(n)];case 1:if(i=a.sent(),i.isError)throw new Error(i.message);return[2,new ge.Format.Cube(i.result)]}})})})}}),qUe=kt.BuiltIn({name:"parse-psf",display:{name:"Parse PSF",description:"Parse PSF from String data"},from:[ge.Data.String],to:ge.Format.Psf})({apply:function(e){var t=this,r=e.a;return $e.create("Parse PSF",function(n){return ce(t,void 0,void 0,function(){var i;return de(this,function(a){switch(a.label){case 0:return[4,kUe(r.data).runInContext(n)];case 1:if(i=a.sent(),i.isError)throw new Error(i.message);return[2,new ge.Format.Psf(i.result)]}})})})}}),$Ue=kt.BuiltIn({name:"parse-ply",display:{name:"Parse PLY",description:"Parse PLY from String data"},from:[ge.Data.String],to:ge.Format.Ply})({apply:function(e){var t=this,r=e.a;return $e.create("Parse PLY",function(n){return ce(t,void 0,void 0,function(){var i;return de(this,function(a){switch(a.label){case 0:return[4,EUe(r.data).runInContext(n)];case 1:if(i=a.sent(),i.isError)throw new Error(i.message);return[2,new ge.Format.Ply(i.result,{label:i.result.comments[0]||"PLY Data"})]}})})})}}),WUe=kt.BuiltIn({name:"parse-ccp4",display:{name:"Parse CCP4/MRC/MAP",description:"Parse CCP4/MRC/MAP from Binary data"},from:[ge.Data.Binary],to:ge.Format.Ccp4})({apply:function(e){var t=this,r=e.a;return $e.create("Parse CCP4/MRC/MAP",function(n){return ce(t,void 0,void 0,function(){var i;return de(this,function(a){switch(a.label){case 0:return[4,oUe(r.data,r.label).runInContext(n)];case 1:if(i=a.sent(),i.isError)throw new Error(i.message);return[2,new ge.Format.Ccp4(i.result)]}})})})}}),XUe=kt.BuiltIn({name:"parse-dsn6",display:{name:"Parse DSN6/BRIX",description:"Parse CCP4/BRIX from Binary data"},from:[ge.Data.Binary],to:ge.Format.Dsn6})({apply:function(e){var t=this,r=e.a;return $e.create("Parse DSN6/BRIX",function(n){return ce(t,void 0,void 0,function(){var i;return de(this,function(a){switch(a.label){case 0:return[4,pUe(r.data,r.label).runInContext(n)];case 1:if(i=a.sent(),i.isError)throw new Error(i.message);return[2,new ge.Format.Dsn6(i.result)]}})})})}}),YUe=kt.BuiltIn({name:"parse-dx",display:{name:"Parse DX",description:"Parse DX from Binary/String data"},from:[ge.Data.Binary,ge.Data.String],to:ge.Format.Dx})({apply:function(e){var t=this,r=e.a;return $e.create("Parse DX",function(n){return ce(t,void 0,void 0,function(){var i;return de(this,function(a){switch(a.label){case 0:return[4,zUe(r.data,r.label).runInContext(n)];case 1:if(i=a.sent(),i.isError)throw new Error(i.message);return[2,new ge.Format.Dx(i.result)]}})})})}}),KUe=kt.BuiltIn({name:"import-string",display:{name:"Import String",description:"Import given data as a string"},from:ge.Root,to:ge.Data.String,params:{data:I.Value(""),label:I.Optional(I.Text(""))}})({apply:function(e){var t=e.params,r=t.data,n=t.label;return new ge.Data.String(r,{label:n||""})},update:function(e){var t=e.oldParams,r=e.newParams,n=e.b;return t.data!==r.data?ft.UpdateResult.Recreate:t.label!==r.label?(n.label=r.label||"",ft.UpdateResult.Updated):ft.UpdateResult.Unchanged},isSerializable:function(){return{isSerializable:!1,reason:"Cannot serialize user imported strings."}}}),QUe=kt.BuiltIn({name:"import-json",display:{name:"Import JSON",description:"Import given data as a JSON"},from:ge.Root,to:ge.Format.Json,params:{data:I.Value({}),label:I.Optional(I.Text(""))}})({apply:function(e){var t=e.params,r=t.data,n=t.label;return new ge.Format.Json(r,{label:n||""})},update:function(e){var t=e.oldParams,r=e.newParams,n=e.b;return t.data!==r.data?ft.UpdateResult.Recreate:t.label!==r.label?(n.label=r.label||"",ft.UpdateResult.Updated):ft.UpdateResult.Unchanged},isSerializable:function(){return{isSerializable:!1,reason:"Cannot serialize user imported JSON."}}}),ZUe=kt.BuiltIn({name:"parse-json",display:{name:"Parse JSON",description:"Parse JSON from String data"},from:[ge.Data.String],to:ge.Format.Json})({apply:function(e){var t=this,r=e.a;return $e.create("Parse JSON",function(n){return ce(t,void 0,void 0,function(){var i;return de(this,function(a){switch(a.label){case 0:return[4,new Response(r.data).json()];case 1:return i=a.sent(),[2,new ge.Format.Json(i)]}})})})}}),JUe=kt.BuiltIn({name:"lazy-volume",display:{name:"Lazy Volume",description:"A placeholder for lazy loaded volume representation"},from:ge.Root,to:ge.Volume.Lazy,params:{url:I.Url(""),isBinary:I.Boolean(!1),format:I.Text("ccp4"),entryId:I.Value("",{isHidden:!0}),isovalues:I.ObjectList({type:I.Text("relative"),value:I.Numeric(0),color:I.Color(pr.black),alpha:I.Numeric(1,{min:0,max:1,step:.01}),volumeIndex:I.Numeric(0)},function(e){return e.type+" "+e.value})}})({apply:function(e){var t=this;e.a;var r=e.params;return $e.create("Lazy Volume",function(n){return ce(t,void 0,void 0,function(){var i;return de(this,function(a){return i=Array.isArray(r.entryId)?r.entryId.join(", "):r.entryId,[2,new ge.Volume.Lazy(r,{label:""+(i||r.url),description:"Lazy Volume"})]})})})}});const eje=Object.freeze(Object.defineProperty({__proto__:null,Download:Uee,DownloadBlob:jee,ImportJson:QUe,ImportString:KUe,LazyVolume:JUe,ParseBlob:VUe,ParseCcp4:WUe,ParseCif:HUe,ParseCube:GUe,ParseDsn6:XUe,ParseDx:YUe,ParseJson:ZUe,ParsePly:$Ue,ParsePsf:qUe,RawData:zee,ReadFile:Vee},Symbol.toStringTag,{value:"Module"}));var tje=kt.BuiltIn({name:"create-group",display:{name:"Group"},from:[],to:ge.Group,params:{label:I.Text("Group"),description:I.Optional(I.Text(""))}})({apply:function(e){var t=e.params;return new ge.Group({},t)},update:function(e){var t=e.oldParams,r=e.newParams,n=e.b;return c0(t,r)?ft.UpdateResult.Unchanged:(n.label=r.label,n.description=r.description,ft.UpdateResult.Updated)}});const rje=Object.freeze(Object.defineProperty({__proto__:null,CreateGroup:tje},Symbol.toStringTag,{value:"Module"}));function nje(e){var t=new DataView(e.buffer),r=Object.create(null),n=[],i=0,a=new Int32Array(e.buffer,0,23),o=a[0]!==t.getInt32(0);if(a[0]!==84)for(var s=e.byteLength,u=0;u<s;u+=4)t.setFloat32(u,t.getFloat32(u),!0);if(a[0]!==84)throw new Error("dcd bad format, header block start");var l=String.fromCharCode(t.getUint8(4),t.getUint8(5),t.getUint8(6),t.getUint8(7));if(l!=="CORD")throw new Error("dcd bad format, format string");var c=!1,d=!1,f=!1;if(a[22]!==0&&(c=!0,a[12]!==0&&(d=!0),a[13]===1&&(f=!0)),r.NSET=a[2],r.ISTART=a[3],r.NSAVC=a[4],r.NAMNF=a[10],c?r.DELTA=t.getFloat32(44,o):r.DELTA=t.getFloat64(44,o),a[22]!==84)throw new Error("dcd bad format, header block end");i=i+21*4+8;var h=t.getInt32(i,o),v=i+1;if((h-4)%80!==0)throw new Error("dcd bad format, title block start");if(r.TITLE=KFe(e.subarray(v,h)),t.getInt32(v+h+4-1,o)!==h)throw new Error("dcd bad format, title block end");if(i=i+h+8,t.getInt32(i,o)!==4)throw new Error("dcd bad format, natom block start");if(r.NATOM=t.getInt32(i+4,o),t.getInt32(i+8,o)!==4)throw new Error("dcd bad format, natom block end");if(i=i+4+8,r.NAMNF>0)throw new Error("dcd format with fixed atoms unsupported, aborting");for(var p=r.NATOM,m=p*4,u=0,s=r.NSET;u<s;++u){var g=Object.create(null);g.elementCount=p,d&&(i+=4,g.cell=[t.getFloat64(i,o),t.getFloat64(i+1,o),t.getFloat64(i+2*8,o),t.getFloat64(i+3*8,o),t.getFloat64(i+4*8,o),t.getFloat64(i+5*8,o)],i+=48,i+=4);for(var y=0;y<3;++y){if(t.getInt32(i,o)!==m)throw new Error("dcd bad format, coord block start: "+u+", "+y);i+=4;var b=new Float32Array(e.buffer,i,p);if(y===0?g.x=b:y===1?g.y=b:g.z=b,i+=m,t.getInt32(i,o)!==m)throw new Error("dcd bad format, coord block end: "+u+", "+y);i+=4}if(f){var S=t.getInt32(i,o);i+=4+S+4}n.push(g)}return{header:r,frames:n}}function ije(e){var t=this;return $e.create("Parse DCD",function(r){return ce(t,void 0,void 0,function(){var n;return de(this,function(i){try{return n=nje(e),[2,Rn.success(n)]}catch(a){return[2,Rn.error(a)]}return[2]})})})}function aje(e){return function(t,r,n){return oje(e,t,r,n)}}function oje(e,t,r,n){var i=e.data,a=e.indices,o=e.count,s=n.valueType,u=s==="str"?function(l){var c=a[2*l]+t,d=a[2*l+1];if(c>=d)return"";var f=c+r;return f>d&&(f=d),PFe(i,c,f)}:s==="int"?function(l){var c=a[2*l]+t;return c>a[2*l+1]?0:Ip(i,c,c+r)}:function(l){var c=a[2*l]+t;return c>a[2*l+1]?0:yMe(i,c,c+r)};return{schema:n,__array:void 0,isDefined:!0,rowCount:o,value:u,valueKind:function(l){return 0},toArray:function(l){return ua(o,u,l)},areValuesEqual:function(l,c){return u(l)===u(c)}}}function sje(){return{title:"",timeInPs:0,hasVelocities:!1,precision:{position:0,velocity:0},box:[0,0,0]}}function uje(e,t){return{tokenizer:e,header:sje(),numberOfAtoms:0,runtimeCtx:t}}function lje(e){var t=e.tokenizer,r=e.header,n=It.readLine(t);n.trim().length===0&&(n=It.readLine(t));var i=n.lastIndexOf("t=");i>=0?(r.timeInPs=parseFloat(n.substring(i+2)),r.title=n.substring(0,i).trim(),r.title&&r.title[r.title.length-1]===","&&(r.title=r.title.substring(0,r.title.length-1))):r.title=n}function cje(e){var t=e.tokenizer;It.markLine(t);var r=It.getTokenString(t);e.numberOfAtoms=parseInt(r)}function dje(e){return ce(this,void 0,void 0,function(){var t,r,n,i,a,o,s,u,l,c,d,f,h;return de(this,function(v){switch(v.label){case 0:return t=e.tokenizer,r=e.numberOfAtoms,[4,It.readLinesAsync(t,r,e.runtimeCtx,1e5)];case 1:return n=v.sent(),i=t.data.substring(n.indices[0],n.indices[1]).substring(20),a=i.match(/\.\d+/g),o=a.length===6,e.header.hasVelocities=o,e.header.precision.position=a[0].length-1,e.header.precision.velocity=o?a[3].length-1:0,s=20,u=e.header.precision.position+5,l=s+3*u,c=e.header.precision.velocity+4,d=aje(n),f=ve.Undefined(e.numberOfAtoms,ve.Schema.float),h={count:e.numberOfAtoms,residueNumber:d(0,5,ve.Schema.int),residueName:d(5,5,ve.Schema.str),atomName:d(10,5,ve.Schema.str),atomNumber:d(15,5,ve.Schema.int),x:d(s,u,ve.Schema.float),y:d(s+u,u,ve.Schema.float),z:d(s+2*u,u,ve.Schema.float),vx:o?d(l,c,ve.Schema.float):f,vy:o?d(l+c,c,ve.Schema.float):f,vz:o?d(l+2*c,c,ve.Schema.float):f},[2,h]}})})}function fje(e){var t=e.tokenizer,r=It.readLine(t).trim().split(/\s+/g);e.header.box=[+r[0],+r[1],+r[2]]}function hje(e,t){return ce(this,void 0,void 0,function(){var r,n,i,a,o;return de(this,function(s){switch(s.label){case 0:return r=It(e),[4,t.update({message:"Parsing...",current:0,max:e.length})];case 1:s.sent(),n=[],s.label=2;case 2:return r.position<e.length?(i=uje(r,t),lje(i),cje(i),[4,dje(i)]):[3,4];case 3:return a=s.sent(),fje(i),n.push({header:i.header,atoms:a}),[3,2];case 4:return o={structures:n},[2,Rn.success(o)]}})})}function pje(e){var t=this;return $e.create("Parse GRO",function(r){return ce(t,void 0,void 0,function(){return de(this,function(n){switch(n.label){case 0:return[4,hje(e,r)];case 1:return[2,n.sent()]}})})})}function vje(e,t,r){var n=this;return r===void 0&&(r=!1),$e.create("Parse PDB",function(i){return ce(n,void 0,void 0,function(){var a,o,s;return de(this,function(u){switch(u.label){case 0:return o=(a=Rn).success,s={},[4,It.readAllLinesAsync(e,i)];case 1:return[2,o.apply(a,[(s.lines=u.sent(),s.id=t,s.isPdbqt=r,s)])]}})})})}function mje(e,t){for(var r=0,n=t*3;r<n;r+=3){var i=e[r],a=e[r+1],o=e[r+2],s=1/Math.sqrt(i*i+a*a+o*o);e[r]=i*s,e[r+1]=a*s,e[r+2]=o*s}return e}var wo=_();function Nv(e,t,r,n){for(var i=0,a=n*3;i<a;i+=3)_.fromArray(wo,t,r+i),_.transformMat4(wo,wo,e),_.toArray(wo,t,r+i)}function gje(e,t,r,n){for(var i=0,a=n*3;i<a;i+=3)_.fromArray(wo,t,r+i),_.transformMat3(wo,wo,e),_.toArray(wo,t,r+i)}function yje(e,t){for(var r=0,n=e.length;r<n;r+=3)_.fromArray(wo,e,r),_.normalize(wo,wo),_.scale(wo,wo,t),_.toArray(wo,e,r)}var ez=_(),lT=_(),tz=_(),ws=_(),rz=_();function Hee(e,t,r,n,i){for(var a=0,o=i*3;a<o;a+=3){var s=t[a]*3,u=t[a+1]*3,l=t[a+2]*3;_.fromArray(ez,e,s),_.fromArray(lT,e,u),_.fromArray(tz,e,l),_.sub(ws,tz,lT),_.sub(rz,ez,lT),_.cross(ws,ws,rz),r[s]+=ws[0],r[s+1]+=ws[1],r[s+2]+=ws[2],r[u]+=ws[0],r[u+1]+=ws[1],r[u+2]+=ws[2],r[l]+=ws[0],r[l+1]+=ws[1],r[l+2]+=ws[2]}return mje(r,n)}function $0(e,t,r){r===void 0&&(r=1);for(var n=Ql(e),i=new Int32Array(n+2),a=new Int32Array(t),o=new Int32Array(t),s=0,u=t*r;s<u;s+=r)++o[e[s]];for(var l=0,s=0;s<t;s++)i[s]=l,l+=o[s];i[t]=l;for(var c=new Int32Array(l),s=0,u=t*r;s<u;s+=r){var d=e[s],f=i[d]+a[d];c[f]=s,++a[d]}return{indices:c,offsets:i}}function bje(e,t){e=Math.max(e,2);var r=Math.sqrt(e),n=Math.ceil(r);n=n+(t-n%t)%t;var i=n>0?Math.ceil(e/n):0;return{width:n,height:i,length:n*i*t}}function Aa(e,t,r,n){var i=bje(e,t),a=i.length,o=i.width,s=i.height;return n=n&&n.length>=a?n:new r(a),{array:n,width:o,height:s}}var Fs=_(),xje=new bs("14"),Sje=new bs("98");function Gee(e){return e>1e5?xje:Sje}function kh(e,t,r){var n=r*3,i=Gee(t);i.reset();for(var a=0,o=t*3;a<o;a+=n)_.fromArray(Fs,e,a),i.includePosition(Fs);i.finishedIncludeStep();for(var a=0,o=t*3;a<o;a+=n)_.fromArray(Fs,e,a),i.radiusPosition(Fs);var s=i.getSphere();if(t<=98){for(var u=[],a=0,o=t*3;a<o;a+=n)u.push(_.fromArray(_(),e,a));Be.setExtrema(s,u)}return s}var cT=ue();function Zi(e,t,r){if(r===1){ue.fromArray(cT,t,0);var n=Be.clone(e);return ue.isIdentity(cT)?n:Be.transform(n,n,cT)}var i=Gee(r);i.reset();var a=e.center,o=e.radius,s=e.extrema;if(s&&r<50){for(var u=0,l=r;u<l;++u)for(var c=0,d=s;c<d.length;c++){var f=d[c];_.transformMat4Offset(Fs,f,t,0,0,u*16),i.includePosition(Fs)}i.finishedIncludeStep();for(var u=0,l=r;u<l;++u)for(var h=0,v=s;h<v.length;h++){var f=v[h];_.transformMat4Offset(Fs,f,t,0,0,u*16),i.radiusPosition(Fs)}}else{for(var u=0,l=r;u<l;++u)_.transformMat4Offset(Fs,a,t,0,0,u*16),i.includePositionRadius(Fs,o);i.finishedIncludeStep();for(var u=0,l=r;u<l;++u)_.transformMat4Offset(Fs,a,t,0,0,u*16),i.radiusPositionRadius(Fs,o)}return i.getSphere()}function au(e,t){var r=Aa(Math.max(1,e),1,Uint8Array,t&&t.tMarker.ref.value.array);return t?(L.update(t.tMarker,r),L.update(t.uMarkerTexDim,He.create(r.width,r.height)),t):{tMarker:L.create(r),uMarkerTexDim:L.create(He.create(r.width,r.height))}}var qee=new ArrayBuffer(4),Cje=new Int32Array(qee),_je=new Float32Array(qee);function wje(e){var t=e<-126?-126:e;return Cje[0]=(1<<23)*(t+126.94269504),_je[0]}function Eje(e){return wje(1.44269504*e)}var $ee=new ArrayBuffer(4),Aje=new Int32Array($ee),Pje=new Float32Array($ee);function Tje(e){Pje[0]=e;var t=Aje[0]*11920928955078125e-23;return t-126.94269504}function Ije(e){return .6931471805599453*Tje(e)}var Mje=1e4;Ije(Mje+1);function M2(e,t,r){return e=Va(e,0,16777216-1)+1,t[r+2]=e%256,e=Math.floor(e/256),t[r+1]=e%256,e=Math.floor(e/256),t[r]=e%256,t}function dF(e,t,r){return Math.floor(e)*256*256+Math.floor(t)*256+Math.floor(r)-1}var eS=255/256,dT=_.create(256*256*256,256*256,256),Dje=Ir.create(eS/dT[0],eS/dT[1],eS/dT[2],eS/1),nz=Ir();function Rje(e,t,r,n){return Ir.set(nz,e/255,t/255,r/255,n/255),Ir.dot(nz,Dje)}function Fd(e,t,r){switch(ha.getGranularity(e,t.granularity)){case"uniform":return Lje(e,t.size,r);case"group":return Bje(e,t.size,r);case"groupInstance":return Uje(e,t.size,r);case"instance":return Nje(e,t.size,r)}}var tA=100;function e2(e){var t=e.dSizeType.ref.value;switch(t){case"uniform":return e.uSize.ref.value;case"instance":case"group":case"groupInstance":for(var r=0,n=e.tSize.ref.value.array,i=0,a=n.length;i<a;i+=3){var o=dF(n[i],n[i+1],n[i+2]);r<o&&(r=o)}return r/tA}}var kje={array:new Uint8Array(3),width:1,height:1};function Oje(){return{tSize:L.create(kje),uSizeTexDim:L.create(He.create(1,1))}}function Fje(e,t){return t?(L.update(t.uSize,e),L.updateIfChanged(t.dSizeType,"uniform"),t):E(E({uSize:L.create(e)},Oje()),{dSizeType:L.create("uniform")})}function Lje(e,t,r){return Fje(t(hs),r)}function fF(e,t,r){return r?(L.update(r.tSize,e),L.update(r.uSizeTexDim,He.create(e.width,e.height)),L.updateIfChanged(r.dSizeType,t),r):{uSize:L.create(0),tSize:L.create(e),uSizeTexDim:L.create(He.create(e.width,e.height)),dSizeType:L.create(t)}}function Nje(e,t,r){var n=e.instanceCount,i=Aa(Math.max(1,n),3,Uint8Array,r&&r.tSize.ref.value.array);for(e.reset();e.hasNext&&!e.isNextNewInstance;){var a=e.move();M2(t(a.location)*tA,i.array,a.instanceIndex*3),e.skipInstance()}return fF(i,"instance",r)}function Bje(e,t,r){var n=e.groupCount,i=Aa(Math.max(1,n),3,Uint8Array,r&&r.tSize.ref.value.array);for(e.reset();e.hasNext&&!e.isNextNewInstance;){var a=e.move();M2(t(a.location)*tA,i.array,a.groupIndex*3)}return fF(i,"group",r)}function Uje(e,t,r){var n=e.groupCount,i=e.instanceCount,a=i*n,o=Aa(Math.max(1,a),3,Uint8Array,r&&r.tSize.ref.value.array);for(e.reset();e.hasNext;){var s=e.move();M2(t(s.location)*tA,o.array,s.index*3)}return fF(o,"groupInstance",r)}function jje(e,t,r,n){for(var i=t;i<r;++i)at.toArray(n,e,i*4),e[i*4+3]=255;return!0}function iz(e,t,r){return e.fill(0,t*4,r*4),!0}function zje(e,t){var r=Aa(Math.max(1,e),4,Uint8Array,t&&t.tOverpaint.ref.value.array);return t?(L.update(t.tOverpaint,r),L.update(t.uOverpaintTexDim,He.create(r.width,r.height)),L.updateIfChanged(t.dOverpaint,e>0),t):{tOverpaint:L.create(r),uOverpaintTexDim:L.create(He.create(r.width,r.height)),dOverpaint:L.create(e>0)}}var az={array:new Uint8Array(4),width:1,height:1};function Ld(e){return e?(L.update(e.tOverpaint,az),L.update(e.uOverpaintTexDim,He.create(1,1)),e):{tOverpaint:L.create(az),uOverpaintTexDim:L.create(He.create(1,1)),dOverpaint:L.create(!1)}}function Vje(e,t,r,n){for(var i=t;i<r;++i)e[i]=n*255;return!0}function Wee(e,t){for(var r=0,n=0;n<t;++n)r+=e[n];return r/(255*t)}function Hje(e,t,r){e.fill(0,t,r)}function Gje(e,t){var r=Aa(Math.max(1,e),1,Uint8Array,t&&t.tTransparency.ref.value.array);return t?(L.update(t.tTransparency,r),L.update(t.uTransparencyTexDim,He.create(r.width,r.height)),L.updateIfChanged(t.dTransparency,e>0),L.updateIfChanged(t.transparencyAverage,Wee(r.array,e)),t):{tTransparency:L.create(r),uTransparencyTexDim:L.create(He.create(r.width,r.height)),dTransparency:L.create(e>0),transparencyAverage:L.create(0)}}var oz={array:new Uint8Array(1),width:1,height:1};function Nd(e){return e?(L.update(e.tTransparency,oz),L.update(e.uTransparencyTexDim,He.create(1,1)),e):{tTransparency:L.create(oz),uTransparencyTexDim:L.create(He.create(1,1)),dTransparency:L.create(!1),transparencyAverage:L.create(0)}}function qje(e,t,r,n){for(var i=t;i<r;++i)e[i]=n;return!0}function $je(e,t,r){e.fill(0,t,r)}function Wje(e,t){var r=Aa(Math.max(1,e),1,Uint8Array,t&&t.tClipping.ref.value.array);return t?(L.update(t.tClipping,r),L.update(t.uClippingTexDim,He.create(r.width,r.height)),L.updateIfChanged(t.dClipping,e>0),t):{dClipObjectCount:L.create(0),dClipVariant:L.create("instance"),tClipping:L.create(r),uClippingTexDim:L.create(He.create(r.width,r.height)),dClipping:L.create(e>0)}}var sz={array:new Uint8Array(1),width:1,height:1};function Bd(e){return e?(L.update(e.tClipping,sz),L.update(e.uClippingTexDim,He.create(1,1)),e):{dClipObjectCount:L.create(0),dClipVariant:L.create("instance"),tClipping:L.create(sz),uClippingTexDim:L.create(He.create(1,1)),dClipping:L.create(!1)}}var Bv;(function(e){function t(v,p,m,g){return g?a(v,p,m,g):i(v,p,m)}e.create=t;function r(v){var p=v?v.centerBuffer.ref.value:new Float32Array(0),m=v?v.groupBuffer.ref.value:new Float32Array(0);return t(p,m,0,v)}e.createEmpty=r;function n(v){return Xa([v.pointCount,v.centerBuffer.ref.version,v.groupBuffer.ref.version])}function i(v,p,m){var g=Be(),y,b=-1,S=-1,x={kind:"points",pointCount:m,centerBuffer:L.create(v),groupBuffer:L.create(p),get boundingSphere(){var C=n(x);if(C!==b){var w=kh(x.centerBuffer.ref.value,x.pointCount,1);Be.copy(g,w),b=C}return g},get groupMapping(){return x.groupBuffer.ref.version!==S&&(y=$0(x.groupBuffer.ref.value,x.pointCount),S=x.groupBuffer.ref.version),y},setBoundingSphere:function(C){Be.copy(g,C),b=n(x)}};return x}function a(v,p,m,g){return g.pointCount=m,L.update(g.centerBuffer,v),L.update(g.groupBuffer,p),g}function o(v,p){var m=v.centerBuffer.ref.value;Nv(p,m,0,v.pointCount),L.update(v.centerBuffer,m)}e.transform=o,e.Params=E(E({},Et.Params),{sizeFactor:I.Numeric(1.5,{min:0,max:10,step:.1}),pointSizeAttenuation:I.Boolean(!1),pointFilledCircle:I.Boolean(!1),pointEdgeBleach:I.Numeric(.2,{min:0,max:1,step:.05})}),e.Utils={Params:e.Params,createEmpty:r,createValues:u,createValuesSimple:l,updateValues:c,updateBoundingSphere:d,createRenderableState:f,updateRenderableState:h,createPositionIterator:s};function s(v,p){var m=v.pointCount,g=p.instanceCount.ref.value,y=em(),b=y.position,S=v.centerBuffer.ref.value,x=p.aTransform.ref.value,C=function(w,A){return A<0?_.fromArray(b,S,w*3):_.transformMat4Offset(b,S,x,0,w*3,A*16),y};return wn(m,g,1,C)}function u(v,p,m,g,y){var b=m.instanceCount,S=m.groupCount,x=s(v,p),C=xs(m,x,g.color),w=Fd(m,g.size),A=au(b*S),M=Ld(),D=Nd(),k=Bd(),R={drawCount:v.pointCount,vertexCount:v.pointCount,groupCount:S,instanceCount:b},O=Be.clone(v.boundingSphere),H=Zi(O,p.aTransform.ref.value,b);return E(E(E(E(E(E(E(E(E({aPosition:v.centerBuffer,aGroup:v.groupBuffer,boundingSphere:L.create(H),invariantBoundingSphere:L.create(O),uInvariantBoundingSphere:L.create(Ir.ofSphere(O))},C),w),A),M),D),k),p),Et.createValues(y,R)),{uSizeFactor:L.create(y.sizeFactor),dPointSizeAttenuation:L.create(y.pointSizeAttenuation),dPointFilledCircle:L.create(y.pointFilledCircle),uPointEdgeBleach:L.create(y.pointEdgeBleach)})}function l(v,p,m,g,y){var b=Et.createSimple(m,g,y),S=E(E({},I.getDefaultValues(e.Params)),p);return u(v,b.transform,b.locationIterator,b.theme,S)}function c(v,p){Et.updateValues(v,p),L.updateIfChanged(v.uSizeFactor,p.sizeFactor),L.updateIfChanged(v.dPointSizeAttenuation,p.pointSizeAttenuation),L.updateIfChanged(v.dPointFilledCircle,p.pointFilledCircle),L.updateIfChanged(v.uPointEdgeBleach,p.pointEdgeBleach)}function d(v,p){var m=Be.clone(p.boundingSphere),g=Zi(m,v.aTransform.ref.value,v.instanceCount.ref.value);Be.equals(g,v.boundingSphere.ref.value)||L.update(v.boundingSphere,g),Be.equals(m,v.invariantBoundingSphere.ref.value)||(L.update(v.invariantBoundingSphere,m),L.update(v.uInvariantBoundingSphere,Ir.fromSphere(v.uInvariantBoundingSphere.ref.value,m)))}function f(v){var p=Et.createRenderableState(v);return h(p,v),p}function h(v,p){Et.updateRenderableState(v,p),v.opaque=v.opaque&&(!p.pointFilledCircle||p.pointFilledCircle&&p.pointEdgeBleach===0),v.writeDepth=v.opaque}})(Bv||(Bv={}));function uz(e,t,r,n,i,a,o){for(var s=0;s<t;s++){for(var u=0;u<r;u++)n[u]=e[u*t+s];lz(n,i,a,o,r);for(var u=0;u<r;u++)e[u*t+s]=i[u]}for(var u=0;u<r;u++){for(var s=0;s<t;s++)n[s]=e[u*t+s];lz(n,i,a,o,t);for(var s=0;s<t;s++)e[u*t+s]=Math.sqrt(i[s])}}function lz(e,t,r,n,i){r[0]=0,n[0]=Number.MIN_SAFE_INTEGER,n[1]=Number.MAX_SAFE_INTEGER;for(var a=1,o=0;a<i;a++){for(var s=(e[a]+a*a-(e[r[o]]+r[o]*r[o]))/(2*a-2*r[o]);s<=n[o];)o--,s=(e[a]+a*a-(e[r[o]]+r[o]*r[o]))/(2*a-2*r[o]);o++,r[o]=a,n[o]=s,n[o+1]=Number.MAX_SAFE_INTEGER}for(var a=0,o=0;a<i;a++){for(;n[o+1]<a;)o++;t[a]=(a-r[o])*(a-r[o])+e[r[o]]}}var fT={};function Xje(e){var t=JSON.stringify(e);return fT[t]===void 0&&(fT[t]=new Yje(e)),fT[t]}var Xee={fontFamily:I.Select("sans-serif",[["sans-serif","Sans Serif"],["monospace","Monospace"],["serif","Serif"],["cursive","Cursive"]]),fontQuality:I.Select(3,[[0,"lower"],[1,"low"],[2,"medium"],[3,"high"],[4,"higher"]]),fontStyle:I.Select("normal",[["normal","Normal"],["italic","Italic"],["oblique","Oblique"]]),fontVariant:I.Select("normal",[["normal","Normal"],["small-caps","Small Caps"]]),fontWeight:I.Select("normal",[["normal","Normal"],["bold","Bold"]])},Yje=function(){function e(t){t===void 0&&(t={}),this.mapped={},this.scratchW=0,this.scratchH=0,this.currentX=0,this.currentY=0,this.cutoff=.5;var r=E(E({},I.getDefaultValues(Xee)),t);this.props=r;var n=32*(r.fontQuality+1);this.buffer=n/8,this.radius=n/3,this.lineHeight=Math.round(n+2*this.buffer+this.radius),this.maxWidth=Math.round(this.lineHeight*.75),this.texture=Aa(350*this.lineHeight*this.maxWidth,1,Uint8Array),this.scratchCanvas=document.createElement("canvas"),this.scratchCanvas.width=this.maxWidth,this.scratchCanvas.height=this.lineHeight,this.scratchContext=this.scratchCanvas.getContext("2d"),this.scratchContext.font=r.fontStyle+" "+r.fontVariant+" "+r.fontWeight+" "+n+"px "+r.fontFamily,this.scratchContext.fillStyle="black",this.scratchContext.textBaseline="middle",this.scratchData=new Uint8Array(this.lineHeight*this.maxWidth),this.gridOuter=new Float64Array(this.lineHeight*this.maxWidth),this.gridInner=new Float64Array(this.lineHeight*this.maxWidth),this.f=new Float64Array(Math.max(this.lineHeight,this.maxWidth)),this.d=new Float64Array(Math.max(this.lineHeight,this.maxWidth)),this.z=new Float64Array(Math.max(this.lineHeight,this.maxWidth)+1),this.v=new Int16Array(Math.max(this.lineHeight,this.maxWidth)),this.middle=Math.ceil(this.lineHeight/2),this.placeholder=this.get(String.fromCharCode(65533))}return e.prototype.get=function(t){if(this.mapped[t]===void 0){this.draw(t);var r=this.texture,n=r.array,i=r.width,a=r.height,o=this.scratchData;if(this.currentX+this.scratchW>i&&(this.currentX=0,this.currentY+=this.scratchH),this.currentY+this.scratchH>a)return console.warn("canvas to small"),this.placeholder;this.mapped[t]={x:this.currentX,y:this.currentY,w:this.scratchW,h:this.scratchH,nw:this.scratchW/this.lineHeight,nh:this.scratchH/this.lineHeight};for(var s=0;s<this.scratchH;++s)for(var u=0;u<this.scratchW;++u)n[i*(this.currentY+s)+this.currentX+u]=o[s*this.scratchW+u];this.currentX+=this.scratchW}return this.mapped[t]},e.prototype.draw=function(t){var r=this.lineHeight,n=this.scratchContext,i=this.scratchData,a=n.measureText(t),o=Math.min(this.maxWidth,Math.ceil(a.width+2*this.buffer)),s=o*r;n.clearRect(0,0,o,r),n.fillText(t,this.buffer,this.middle);for(var u=n.getImageData(0,0,o,r),l=0;l<s;l++){var c=u.data[l*4+3]/255;this.gridOuter[l]=c===1?0:c===0?Number.MAX_SAFE_INTEGER:Math.pow(Math.max(0,.5-c),2),this.gridInner[l]=c===1?Number.MAX_SAFE_INTEGER:c===0?0:Math.pow(Math.max(0,c-.5),2)}uz(this.gridOuter,o,r,this.f,this.d,this.v,this.z),uz(this.gridInner,o,r,this.f,this.d,this.v,this.z);for(var l=0;l<s;l++){var d=this.gridOuter[l]-this.gridInner[l];i[l]=Math.max(0,Math.min(255,Math.round(255-255*(d/this.radius+this.cutoff))))}this.scratchW=o,this.scratchH=r},e}(),eu;(function(e){function t(h,v,p,m,g,y,b,S,x){return x?a(h,v,p,m,g,y,b,S,x):i(h,v,p,m,g,y,b,S)}e.create=t;function r(h){var v=h?h.fontTexture.ref.value:Aa(0,1,Uint8Array),p=h?h.centerBuffer.ref.value:new Float32Array(0),m=h?h.mappingBuffer.ref.value:new Float32Array(0),g=h?h.depthBuffer.ref.value:new Float32Array(0),y=h?h.indexBuffer.ref.value:new Uint32Array(0),b=h?h.groupBuffer.ref.value:new Float32Array(0),S=h?h.tcoordBuffer.ref.value:new Float32Array(0);return t(v,p,m,g,y,b,S,0,h)}e.createEmpty=r;function n(h){return Xa([h.charCount,h.fontTexture.ref.version,h.centerBuffer.ref.version,h.mappingBuffer.ref.version,h.depthBuffer.ref.version,h.indexBuffer.ref.version,h.groupBuffer.ref.version,h.tcoordBuffer.ref.version])}function i(h,v,p,m,g,y,b,S){var x=Be(),C,w=-1,A=-1,M={kind:"text",charCount:S,fontTexture:L.create(h),centerBuffer:L.create(v),mappingBuffer:L.create(p),depthBuffer:L.create(m),indexBuffer:L.create(g),groupBuffer:L.create(y),tcoordBuffer:L.create(b),get boundingSphere(){var D=n(M);if(D!==w){var k=kh(M.centerBuffer.ref.value,M.charCount*4,4);Be.copy(x,k),w=D}return x},get groupMapping(){return M.groupBuffer.ref.version!==A&&(C=$0(M.groupBuffer.ref.value,M.charCount,4),A=M.groupBuffer.ref.version),C},setBoundingSphere:function(D){Be.copy(x,D),w=n(M)}};return M}function a(h,v,p,m,g,y,b,S,x){return x.charCount=S,L.update(x.fontTexture,h),L.update(x.centerBuffer,v),L.update(x.mappingBuffer,p),L.update(x.depthBuffer,m),L.update(x.indexBuffer,g),L.update(x.groupBuffer,y),L.update(x.tcoordBuffer,b),x}e.Params=E(E(E({},Et.Params),Xee),{sizeFactor:I.Numeric(1,{min:0,max:10,step:.1}),borderWidth:I.Numeric(0,{min:0,max:.5,step:.01}),borderColor:I.Color(pr.grey),offsetX:I.Numeric(0,{min:0,max:10,step:.1}),offsetY:I.Numeric(0,{min:0,max:10,step:.1}),offsetZ:I.Numeric(0,{min:0,max:10,step:.1}),background:I.Boolean(!1),backgroundMargin:I.Numeric(.2,{min:0,max:1,step:.01}),backgroundColor:I.Color(pr.grey),backgroundOpacity:I.Numeric(1,{min:0,max:1,step:.01}),tether:I.Boolean(!1),tetherLength:I.Numeric(1,{min:0,max:5,step:.1}),tetherBaseWidth:I.Numeric(.3,{min:0,max:1,step:.01}),attachment:I.Select("middle-center",[["bottom-left","bottom-left"],["bottom-center","bottom-center"],["bottom-right","bottom-right"],["middle-left","middle-left"],["middle-center","middle-center"],["middle-right","middle-right"],["top-left","top-left"],["top-center","top-center"],["top-right","top-right"]])}),e.Utils={Params:e.Params,createEmpty:r,createValues:s,createValuesSimple:u,updateValues:l,updateBoundingSphere:c,createRenderableState:d,updateRenderableState:f,createPositionIterator:o};function o(h,v){var p=h.charCount*4,m=v.instanceCount.ref.value,g=em(),y=g.position,b=h.centerBuffer.ref.value,S=v.aTransform.ref.value,x=function(C,w){return w<0?_.fromArray(y,b,C*3):_.transformMat4Offset(y,b,S,0,C*3,w*16),g};return wn(p,m,4,x)}function s(h,v,p,m,g){var y=p.instanceCount,b=p.groupCount,S=o(h,v),x=xs(p,S,m.color),C=Fd(p,m.size),w=au(y*b),A=Ld(),M=Nd(),D=Bd(),k={drawCount:h.charCount*2*3,vertexCount:h.charCount*4,groupCount:b,instanceCount:y},R=cz(h.mappingBuffer.ref.value,h.depthBuffer.ref.value,h.charCount,e2(C)),O=Be.expand(Be(),h.boundingSphere,R),H=Zi(O,v.aTransform.ref.value,y);return E(E(E(E(E(E(E(E(E(E({aPosition:h.centerBuffer,aMapping:h.mappingBuffer,aDepth:h.depthBuffer,aGroup:h.groupBuffer,elements:h.indexBuffer,boundingSphere:L.create(H),invariantBoundingSphere:L.create(O),uInvariantBoundingSphere:L.create(Ir.ofSphere(O))},x),C),w),A),M),D),v),{aTexCoord:h.tcoordBuffer,tFont:h.fontTexture,padding:L.create(R)}),Et.createValues(g,k)),{uSizeFactor:L.create(g.sizeFactor),uBorderWidth:L.create(Va(g.borderWidth/2,0,.5)),uBorderColor:L.create(at.toArrayNormalized(g.borderColor,_.zero(),0)),uOffsetX:L.create(g.offsetX),uOffsetY:L.create(g.offsetY),uOffsetZ:L.create(g.offsetZ),uBackgroundColor:L.create(at.toArrayNormalized(g.backgroundColor,_.zero(),0)),uBackgroundOpacity:L.create(g.backgroundOpacity)})}function u(h,v,p,m,g){var y=Et.createSimple(p,m,g),b=E(E({},I.getDefaultValues(e.Params)),v);return s(h,y.transform,y.locationIterator,y.theme,b)}function l(h,v){Et.updateValues(h,v),L.updateIfChanged(h.uSizeFactor,v.sizeFactor),L.updateIfChanged(h.uBorderWidth,v.borderWidth),at.fromNormalizedArray(h.uBorderColor.ref.value,0)!==v.borderColor&&(at.toArrayNormalized(v.borderColor,h.uBorderColor.ref.value,0),L.update(h.uBorderColor,h.uBorderColor.ref.value)),L.updateIfChanged(h.uOffsetX,v.offsetX),L.updateIfChanged(h.uOffsetY,v.offsetY),L.updateIfChanged(h.uOffsetZ,v.offsetZ),at.fromNormalizedArray(h.uBackgroundColor.ref.value,0)!==v.backgroundColor&&(at.toArrayNormalized(v.backgroundColor,h.uBackgroundColor.ref.value,0),L.update(h.uBackgroundColor,h.uBackgroundColor.ref.value)),L.updateIfChanged(h.uBackgroundOpacity,v.backgroundOpacity)}function c(h,v){var p=cz(h.aMapping.ref.value,h.aDepth.ref.value,v.charCount,e2(h)),m=Be.expand(Be(),v.boundingSphere,p),g=Zi(m,h.aTransform.ref.value,h.instanceCount.ref.value);Be.equals(g,h.boundingSphere.ref.value)||L.update(h.boundingSphere,g),Be.equals(m,h.invariantBoundingSphere.ref.value)||(L.update(h.invariantBoundingSphere,m),L.update(h.uInvariantBoundingSphere,Ir.fromSphere(h.uInvariantBoundingSphere.ref.value,m))),L.update(h.padding,p)}function d(h){var v=Et.createRenderableState(h);return f(v,h),v}function f(h,v){Et.updateRenderableState(h,v),h.pickable=!1,h.opaque=!1,h.writeDepth=!0}})(eu||(eu={}));function cz(e,t,r,n){for(var i=0,a=0,o=0,s=r*4;o<s;++o){var u=2*o,l=Math.abs(e[u]);l>i&&(i=l);var c=Math.abs(e[u+1]);c>i&&(i=c);var d=Math.abs(t[o]);d>a&&(a=d)}return Math.max(a,n+n*i)}var al=_(),ol=_(),rp=_(),dz=qe.add,tS=qe.add3,vs;(function(e){function t(r,n,i){r===void 0&&(r=2048),n===void 0&&(n=1024);var a=qe.create(Float32Array,1,n,i?i.groupBuffer.ref.value:r),o=qe.create(Float32Array,3,n,i?i.startBuffer.ref.value:r),s=qe.create(Float32Array,3,n,i?i.endBuffer.ref.value:r),u=function(d,f,h,v,p,m,g){for(var y=0;y<4;++y)tS(o,d,f,h),tS(s,v,p,m),dz(a,g)},l=function(d,f,h){for(var v=0;v<4;++v)tS(o,d[0],d[1],d[2]),tS(s,f[0],f[1],f[2]),dz(a,h)},c=function(d,f,h,v){var p=_.distance(d,f),m=Math.floor(h/2),g=1/h;_.sub(rp,f,d);for(var y=0;y<m;++y){var b=g*(y*2+1);_.setMagnitude(rp,rp,p*b),_.add(al,d,rp),_.setMagnitude(rp,rp,p*g*((y+1)*2)),_.add(ol,d,rp),u(al[0],al[1],al[2],ol[0],ol[1],ol[2],v)}};return{add:u,addVec:l,addFixedCountDashes:c,addFixedLengthDashes:function(d,f,h,v){var p=_.distance(d,f);c(d,f,p/h,v)},addCage:function(d,f,h){for(var v=f.vertices,p=f.edges,m=0,g=p.length;m<g;m+=2)_.fromArray(al,v,p[m]*3),_.fromArray(ol,v,p[m+1]*3),_.transformMat4(al,al,d),_.transformMat4(ol,ol,d),u(al[0],al[1],al[2],ol[0],ol[1],ol[2],h)},getLines:function(){var d=a.elementCount/4,f=qe.compact(a,!0),h=qe.compact(o,!0),v=qe.compact(s,!0),p=i&&d<=i.lineCount?i.mappingBuffer.ref.value:new Float32Array(d*8),m=i&&d<=i.lineCount?i.indexBuffer.ref.value:new Uint32Array(d*6);return(!i||d>i.lineCount)&&Kje(d,p,m),Pn.create(p,m,f,h,v,d,i)}}}e.create=t})(vs||(vs={}));function Kje(e,t,r){for(var n=0;n<e;++n){var i=n*8;t[i]=-1,t[i+1]=-1,t[i+2]=1,t[i+3]=-1,t[i+4]=-1,t[i+5]=1,t[i+6]=1,t[i+7]=1}for(var n=0;n<e;++n){var a=n*4,o=n*6;r[o]=a,r[o+1]=a+1,r[o+2]=a+2,r[o+3]=a+1,r[o+4]=a+3,r[o+5]=a+2}}var Pn;(function(e){function t(h,v,p,m,g,y,b){return b?o(h,v,p,m,g,y,b):a(h,v,p,m,g,y)}e.create=t;function r(h){var v=h?h.mappingBuffer.ref.value:new Float32Array(0),p=h?h.indexBuffer.ref.value:new Uint32Array(0),m=h?h.groupBuffer.ref.value:new Float32Array(0),g=h?h.startBuffer.ref.value:new Float32Array(0),y=h?h.endBuffer.ref.value:new Float32Array(0);return t(v,p,m,g,y,0,h)}e.createEmpty=r;function n(h,v){for(var p=h.vertexBuffer.ref.value,m=h.indexBuffer.ref.value,g=h.groupBuffer.ref.value,y=vs.create(h.triangleCount*3,h.triangleCount/10,v),b=0,S=h.triangleCount*3;b<S;b+=3){var x=m[b],C=m[b+1],w=m[b+2],A=p[x*3],M=p[x*3+1],D=p[x*3+2],k=p[C*3],R=p[C*3+1],O=p[C*3+2],H=p[w*3],B=p[w*3+1],j=p[w*3+2];y.add(A,M,D,k,R,O,g[x]),y.add(A,M,D,H,B,j,g[x]),y.add(k,R,O,H,B,j,g[C])}return y.getLines()}e.fromMesh=n;function i(h){return Xa([h.lineCount,h.mappingBuffer.ref.version,h.indexBuffer.ref.version,h.groupBuffer.ref.version,h.startBuffer.ref.version,h.endBuffer.ref.version])}function a(h,v,p,m,g,y){var b=Be(),S,x=-1,C=-1,w={kind:"lines",lineCount:y,mappingBuffer:L.create(h),indexBuffer:L.create(v),groupBuffer:L.create(p),startBuffer:L.create(m),endBuffer:L.create(g),get boundingSphere(){var A=i(w);if(A!==x){var M=kh(w.startBuffer.ref.value,w.lineCount*4,4),D=kh(w.endBuffer.ref.value,w.lineCount*4,4);Be.expandBySphere(b,M,D),x=A}return b},get groupMapping(){return w.groupBuffer.ref.version!==C&&(S=$0(w.groupBuffer.ref.value,w.lineCount,4),C=w.groupBuffer.ref.version),S},setBoundingSphere:function(A){Be.copy(b,A),x=i(w)}};return w}function o(h,v,p,m,g,y,b){return y>b.lineCount&&(L.update(b.mappingBuffer,h),L.update(b.indexBuffer,v)),b.lineCount=y,L.update(b.groupBuffer,p),L.update(b.startBuffer,m),L.update(b.endBuffer,g),b}function s(h,v){var p=h.startBuffer.ref.value;Nv(v,p,0,h.lineCount*4),L.update(h.startBuffer,p);var m=h.endBuffer.ref.value;Nv(v,m,0,h.lineCount*4),L.update(h.endBuffer,m)}e.transform=s,e.Params=E(E({},Et.Params),{sizeFactor:I.Numeric(1.5,{min:0,max:10,step:.1}),lineSizeAttenuation:I.Boolean(!1)}),e.Utils={Params:e.Params,createEmpty:r,createValues:l,createValuesSimple:c,updateValues:d,updateBoundingSphere:f,createRenderableState:Et.createRenderableState,updateRenderableState:Et.updateRenderableState,createPositionIterator:u};function u(h,v){var p=h.lineCount*4,m=v.instanceCount.ref.value,g=em(),y=g.position,b=h.startBuffer.ref.value,S=h.endBuffer.ref.value,x=v.aTransform.ref.value,C=function(w,A){var M=w%4===0?b:S;return A<0?_.fromArray(y,M,w*3):_.transformMat4Offset(y,M,x,0,w*3,A*16),g};return wn(p,m,2,C)}function l(h,v,p,m,g){var y=p.instanceCount,b=p.groupCount,S=u(h,v),x=xs(p,S,m.color),C=Fd(p,m.size),w=au(y*b),A=Ld(),M=Nd(),D=Bd(),k={drawCount:h.lineCount*2*3,vertexCount:h.lineCount*4,groupCount:b,instanceCount:y},R=Be.clone(h.boundingSphere),O=Zi(R,v.aTransform.ref.value,y);return E(E(E(E(E(E(E(E(E({aMapping:h.mappingBuffer,aGroup:h.groupBuffer,aStart:h.startBuffer,aEnd:h.endBuffer,elements:h.indexBuffer,boundingSphere:L.create(O),invariantBoundingSphere:L.create(R),uInvariantBoundingSphere:L.create(Ir.ofSphere(R))},x),C),w),A),M),D),v),Et.createValues(g,k)),{uSizeFactor:L.create(g.sizeFactor),dLineSizeAttenuation:L.create(g.lineSizeAttenuation),dDoubleSided:L.create(!0),dFlipSided:L.create(!1)})}function c(h,v,p,m,g){var y=Et.createSimple(p,m,g),b=E(E({},I.getDefaultValues(e.Params)),v);return l(h,y.transform,y.locationIterator,y.theme,b)}function d(h,v){Et.updateValues(h,v),L.updateIfChanged(h.uSizeFactor,v.sizeFactor),L.updateIfChanged(h.dLineSizeAttenuation,v.lineSizeAttenuation)}function f(h,v){var p=Be.clone(v.boundingSphere),m=Zi(p,h.aTransform.ref.value,h.instanceCount.ref.value);Be.equals(m,h.boundingSphere.ref.value)||L.update(h.boundingSphere,m),Be.equals(p,h.invariantBoundingSphere.ref.value)||(L.update(h.invariantBoundingSphere,p),L.update(h.uInvariantBoundingSphere,Ir.fromSphere(h.uInvariantBoundingSphere.ref.value,p)))}})(Pn||(Pn={}));var fz=_(),hz=_(),pz=_();function rA(e,t){for(var r=t.length,n=W0(r/3),i=0;i<r;i+=3)_.fromArray(fz,e,t[i]*3),_.fromArray(hz,e,t[i+1]*3),_.fromArray(pz,e,t[i+2]*3),n.add(fz,hz,pz);return n.getPrimitive()}var rS=_();function W0(e,t){t===void 0&&(t=e*3);var r=new Float32Array(t*3),n=new Float32Array(t*3),i=new Uint32Array(e*3),a=0,o=0;return{add:function(s,u,l){_.toArray(s,r,a),_.toArray(u,r,a+3),_.toArray(l,r,a+6),_.triangleNormal(rS,s,u,l);for(var c=0;c<3;++c)_.toArray(rS,n,a+3*c),i[o+c]=a/3+c;a+=9,o+=3},addQuad:function(s,u,l,c){_.toArray(s,r,a),_.toArray(u,r,a+3),_.toArray(l,r,a+6),_.toArray(c,r,a+9),_.triangleNormal(rS,s,u,l);for(var d=0;d<4;++d)_.toArray(rS,n,a+3*d);var f=a/3;i[o]=f,i[o+1]=f+1,i[o+2]=f+2,i[o+3]=f+2,i[o+4]=f+3,i[o+5]=f,a+=12,o+=6},getPrimitive:function(){return{vertices:r,normals:n,indices:i}}}}var Mm=_(),Qje=Yn();function hF(e,t){for(var r=e.vertices,n=e.normals,i=Yn.directionTransform(Qje,t),a=0,o=r.length;a<o;a+=3)_.transformMat4(Mm,_.fromArray(Mm,r,a),t),_.toArray(Mm,r,a),_.transformMat3(Mm,_.fromArray(Mm,n,a),i),_.toArray(Mm,n,a);return e}function ac(e,t,r){r===void 0&&(r=-1);for(var n=new Float32Array(e*3),i=r===-1?e<=4?Math.sqrt(2)/2:.6:r,a=t?1:0,o=0,s=e;o<s;++o){var u=(o*2+a)/e*Math.PI;n[o*3]=Math.cos(u)*i,n[o*3+1]=Math.sin(u)*i,n[o*3+2]=0}return n}function pF(e,t){return{vertices:e,edges:t}}function Yee(e){return{vertices:new Float32Array(e.vertices),edges:new Uint32Array(e.edges)}}var hT=_.zero();function Kee(e,t){for(var r=e.vertices,n=0,i=r.length;n<i;n+=3)_.transformMat4(hT,_.fromArray(hT,r,n),t),_.toArray(hT,r,n);return e}var pc=_(),vc=_(),mc=_(),Dm=_(),ei=ac(4,!0);function Qee(e){for(var t=12,r=e?12*3:6*4,n=W0(t,r),i=0;i<4;++i){var a=(i+1)%4;_.set(pc,ei[i*3],ei[i*3+1],-.5),_.set(vc,ei[a*3],ei[a*3+1],-.5),_.set(mc,ei[a*3],ei[a*3+1],.5),_.set(Dm,ei[i*3],ei[i*3+1],.5),e?n.add(pc,vc,mc):n.addQuad(pc,vc,mc,Dm)}return _.set(pc,ei[0],ei[1],-.5),_.set(vc,ei[3],ei[4],-.5),_.set(mc,ei[6],ei[7],-.5),_.set(Dm,ei[9],ei[10],-.5),e?n.add(mc,vc,pc):n.addQuad(Dm,mc,vc,pc),_.set(pc,ei[0],ei[1],.5),_.set(vc,ei[3],ei[4],.5),_.set(mc,ei[6],ei[7],.5),_.set(Dm,ei[9],ei[10],.5),e?n.add(pc,vc,mc):n.addQuad(pc,vc,mc,Dm),n.getPrimitive()}var pT;function vF(){return pT||(pT=Qee(!1)),pT}var vT;function Zje(){return vT||(vT=Qee(!0)),vT}var mT;function Zee(){return mT||(mT=pF([.5,.5,-.5,-.5,.5,-.5,-.5,-.5,-.5,.5,-.5,-.5,.5,.5,.5,-.5,.5,.5,-.5,-.5,.5,.5,-.5,.5],[0,4,1,5,2,6,3,7,0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4])),mT}function vz(e){return e.map(function(t){return{x:t[0],alpha:t[1]}})}function mz(e,t,r){for(var n=Nt(Nt([{x:0,alpha:0},{x:0,alpha:0}],e),[{x:1,alpha:0},{x:1,alpha:0}]),i=Gu.create({domain:[0,1],listOrName:t}),a=256,o=r?r.ref.value.array:new Uint8Array(a*4),s=0,u,l,c,d,f,h,v=e.length+1,p=0;p<v;++p){u=n[p+1].x,l=n[p+2].x,c=n[p].alpha,d=n[p+1].alpha,f=n[p+2].alpha,h=n[p+3].alpha;for(var m=Math.round((l-u)*a),g=0;g<m;++g){var y=g/m;o[s*4+3]=Math.max(0,gC(c,d,f,h,y,.5)*255),i.colorToArray(s/255,o,s*4),++s}}var b={array:o,width:256,height:1};return r?(L.update(r,b),r):L.create(b)}function Jje(e,t,r){if(r)return gz(e,t,r.min,r.max);var n=qo(e),i=n[0],a=n[1];return gz(e,t,i,a)}function gz(e,t,r,n){var i=(n-r)/t;i===0&&(i=1);for(var a=new Int32Array(t),o=0,s=e.length;o<s;o++){var u=Math.floor((e[o]-r)/i);u>=t?u=t-1:u<0&&(u=0),a[u]++}return{min:r,max:n,binWidth:i,counts:a}}var La;(function(e){e.One={transform:{kind:"matrix",matrix:ue.identity()},cells:kr.create(kr.Space([1,1,1],[0,1,2]),kr.Data1([0])),stats:{min:0,max:0,mean:0,sigma:0}};var t=ue.zero(),r=ue.zero();function n(u){if(u.transform.kind==="matrix")return ue.copy(ue(),u.transform.matrix);if(u.transform.kind==="spacegroup"){var l=u.cells.space,c=ue.fromScaling(t,_.div(_.zero(),Kt.size(_.zero(),u.transform.fractionalBox),_.ofArray(l.dimensions))),d=ue.fromTranslation(r,u.transform.fractionalBox.min);return ue.mul3(ue.zero(),u.transform.cell.fromFractional,d,c)}return ue.identity()}e.getGridToCartesianTransform=n;function i(u,l){return u===l}e.areEquivalent=i;function a(u){return u.cells.data.length===0}e.isEmpty=a;function o(u,l){l||(l=Be());var c=u.cells.space.dimensions,d=e.getGridToCartesianTransform(u);return Be.fromDimensionsAndTransform(l,c,d)}e.getBoundingSphere=o;function s(u,l){var c=u._historams;return c||(c=u._historams={}),c[l]||(c[l]=Jje(u.cells.data,l,{min:u.stats.min,max:u.stats.max})),c[l]}e.getHistogram=s})(La||(La={}));function eze(e,t){var r=this;return $e.create("Create Volume",function(){return ce(r,void 0,void 0,function(){var n,i,a,o,s,u,l,c,d,f,h,v,p,m,g,y,b;return de(this,function(S){if(n=e.header,i=e.values,a=kr.Space(n.dim,[0,1,2],Float64Array),n.dataSetIds.length===0)o=i;else for(s=n.dim,u=s[0],l=s[1],c=s[2],d=((t==null?void 0:t.dataIndex)||0)+1,f=0,h=0,o=new Float64Array(u*l*c),v=0;v<u;v++)for(p=0;p<l;p++)for(m=0;m<c;m++)o[f++]=i[h],h+=d;return g=kr.create(a,kr.Data1(o)),y=ue.fromTranslation(ue(),n.origin),b=ue.fromBasis(ue(),n.basisX,n.basisY,n.basisZ),ue.mul(y,y,b),[2,{label:t==null?void 0:t.label,entryId:t==null?void 0:t.entryId,grid:{transform:{kind:"matrix",matrix:y},cells:g,stats:{min:NE(o),max:Ql(o),mean:BE(o),sigma:UE(o)}},sourceData:Ew.create(e),customProperties:new nc,_propertyData:Object.create(null)}]})})})}var Ew;(function(e){function t(n){return(n==null?void 0:n.kind)==="cube"}e.is=t;function r(n){return{kind:"cube",name:n.name,data:n}}e.create=r})(Ew||(Ew={}));var Ct;(function(e){function t(f){var h,v,p,m;return((m=(p=(v=(h=f==null?void 0:f.grid)===null||h===void 0?void 0:h.cells)===null||v===void 0?void 0:v.space)===null||p===void 0?void 0:p.dimensions)===null||m===void 0?void 0:m.length)&&(f==null?void 0:f.sourceData)&&(f==null?void 0:f.customProperties)&&(f==null?void 0:f._propertyData)}e.is=t,function(f){function h(x,C,w){return Sn(y(x,w).absoluteValue,y(C,w).absoluteValue,w.sigma/100)}f.areSame=h;function v(x){return{kind:"absolute",absoluteValue:x}}f.absolute=v;function p(x){return{kind:"relative",relativeValue:x}}f.relative=p;function m(x,C){return C*x.sigma+x.mean}f.calcAbsolute=m;function g(x,C){return x.sigma===0?0:(C-x.mean)/x.sigma}f.calcRelative=g;function y(x,C){return x.kind==="absolute"?x:{kind:"absolute",absoluteValue:f.calcAbsolute(C,x.relativeValue)}}f.toAbsolute=y;function b(x,C){return x.kind==="relative"?x:{kind:"relative",relativeValue:f.calcRelative(C,x.absoluteValue)}}f.toRelative=b;function S(x){return x.kind==="relative"?x.relativeValue.toFixed(2)+" ":""+x.absoluteValue.toPrecision(4)}f.toString=S}(e.IsoValue||(e.IsoValue={}));var r={min:-1,max:1,mean:0,sigma:.1};function n(f,h){var v=h||r,p=v.min,m=v.max,g=v.mean,y=v.sigma,b=(p-g)/y,S=(m-g)/y,x=f;return f.kind==="absolute"?f.absoluteValue<p?x=e.IsoValue.absolute(p):f.absoluteValue>m&&(x=e.IsoValue.absolute(m)):f.relativeValue<b?x=e.IsoValue.relative(b):f.relativeValue>S&&(x=e.IsoValue.relative(S)),I.Conditioned(x,{absolute:I.Converted(function(C){return e.IsoValue.toAbsolute(C,La.One.stats).absoluteValue},function(C){return e.IsoValue.absolute(C)},I.Numeric(g,{min:p,max:m,step:ID(y/100,2)})),relative:I.Converted(function(C){return e.IsoValue.toRelative(C,La.One.stats).relativeValue},function(C){return e.IsoValue.relative(C)},I.Numeric(Math.min(1,S),{min:b,max:S,step:ID(Math.round((m-p)/y)/100,2)}))},function(C){return C.kind==="absolute"?"absolute":"relative"},function(C,w){return w==="absolute"?e.IsoValue.toAbsolute(C,v):e.IsoValue.toRelative(C,v)},{isEssential:!0})}e.createIsoValueParam=n,e.IsoValueParam=n(e.IsoValue.relative(2)),e.One={label:"",grid:La.One,sourceData:{kind:"",name:"",data:{}},customProperties:new nc,_propertyData:Object.create(null)};function i(f,h){return La.areEquivalent(f.grid,h.grid)}e.areEquivalent=i;function a(f){return La.isEmpty(f.grid)}e.isEmpty=a;function o(f){return Ew.is(f.sourceData)?f.sourceData.data.header.orbitals:!1}e.isOrbitals=o;function s(f){return{kind:"volume-loci",volume:f}}e.Loci=s;function u(f){return!!f&&f.kind==="volume-loci"}e.isLoci=u;function l(f,h){return f.volume===h.volume}e.areLociEqual=l;function c(f){return La.isEmpty(f.volume.grid)}e.isLociEmpty=c;function d(f,h){return La.getBoundingSphere(f.grid,h)}e.getBoundingSphere=d,function(f){function h(y,b){return{kind:"isosurface-loci",volume:y,isoValue:b}}f.Loci=h;function v(y){return!!y&&y.kind==="isosurface-loci"}f.isLoci=v;function p(y,b){return y.volume===b.volume&&e.IsoValue.areSame(y.isoValue,b.isoValue,y.volume.grid.stats)}f.areLociEqual=p;function m(y){return y.volume.grid.cells.data.length===0}f.isLociEmpty=m;function g(y,b,S){return e.getBoundingSphere(y,S)}f.getBoundingSphere=g}(e.Isosurface||(e.Isosurface={})),function(f){function h(S,x){return{kind:"cell-loci",volume:S,indices:x}}f.Loci=h;function v(S){return!!S&&S.kind==="cell-loci"}f.isLoci=v;function p(S,x){return S.volume===x.volume&&Fe.areEqual(S.indices,x.indices)}f.areLociEqual=p;function m(S){return Fe.size(S.indices)===0}f.isLociEmpty=m;var g=new bs("98"),y=_();function b(S,x,C){g.reset();for(var w=La.getGridToCartesianTransform(S.grid),A=S.grid.cells.space.getCoords,M=0,D=Fe.size(x);M<D;M++){var k=Fe.getAt(x,M);A(k,y),_.transformMat4(y,y,w),g.includePosition(y)}g.finishedIncludeStep();for(var M=0,D=Fe.size(x);M<D;M++){var k=Fe.getAt(x,M);A(k,y),_.transformMat4(y,y,w),g.radiusPosition(y)}var R=g.getSphere(C);return Be.expand(R,R,ue.getMaxScaleOnAxis(w)*10)}f.getBoundingSphere=b}(e.Cell||(e.Cell={}))})(Ct||(Ct={}));var gT=vF(),uo;(function(e){function t(y,b,S,x,C,w,A,M,D){return D?i(y,b,S,x,C,w,A,M,D):n(y,b,S,x,C,w,A,M)}e.create=t;function r(y){return Xa([y.bboxSize.ref.version,y.gridDimension.ref.version,y.gridTexture.ref.version,y.transform.ref.version,y.gridStats.ref.version])}function n(y,b,S,x,C,w,A,M){var D=Be(),k=-1,R=w.getWidth(),O=w.getHeight(),H=w.getDepth(),B={kind:"direct-volume",gridDimension:L.create(b),gridTexture:L.create(w),gridTextureDim:L.create(_.create(R,O,H)),gridStats:L.create(Ir.create(A.min,A.max,A.mean,A.sigma)),bboxMin:L.create(y.min),bboxMax:L.create(y.max),bboxSize:L.create(_.sub(_(),y.max,y.min)),transform:L.create(S),cellDim:L.create(C),unitToCartn:L.create(x),cartnToUnit:L.create(ue.invert(ue(),x)),get boundingSphere(){var j=r(B);if(j!==k){var Y=tze(B.gridDimension.ref.value,B.transform.ref.value);Be.copy(D,Y),k=j}return D},packedGroup:L.create(M),setBoundingSphere:function(j){Be.copy(D,j),k=r(B)}};return B}function i(y,b,S,x,C,w,A,M,D){var k=w.getWidth(),R=w.getHeight(),O=w.getDepth();return L.update(D.gridDimension,b),L.update(D.gridTexture,w),L.update(D.gridTextureDim,_.set(D.gridTextureDim.ref.value,k,R,O)),L.update(D.gridStats,Ir.set(D.gridStats.ref.value,A.min,A.max,A.mean,A.sigma)),L.update(D.bboxMin,y.min),L.update(D.bboxMax,y.max),L.update(D.bboxSize,_.sub(D.bboxSize.ref.value,y.max,y.min)),L.update(D.transform,S),L.update(D.cellDim,C),L.update(D.unitToCartn,x),L.update(D.cartnToUnit,ue.invert(ue(),x)),L.updateIfChanged(D.packedGroup,M),D}function a(y){return{}}e.createEmpty=a;function o(y){var b=y?Ct.createIsoValueParam(Ct.IsoValue.relative(2),y):Ct.IsoValueParam;return I.MappedStatic("volume",{isosurface:I.Group({isoValue:b,singleLayer:I.Boolean(!1,{isEssential:!0})},{isFlat:!0}),volume:I.Group({controlPoints:I.LineGraph([He.create(.19,0),He.create(.2,.05),He.create(.25,.05),He.create(.26,0),He.create(.79,0),He.create(.8,.05),He.create(.85,.05),He.create(.86,0)]),list:I.ColorList({kind:"interpolate",colors:[[pr.white,0],[pr.red,.25],[pr.white,.5],[pr.blue,.75],[pr.white,1]]},{offsets:!0})},{isFlat:!0})},{isEssential:!0})}e.createRenderModeParam=o,e.Params=E(E({},Et.Params),{doubleSided:I.Boolean(!1,Et.CustomQualityParamInfo),flipSided:I.Boolean(!1,Et.ShadingCategory),flatShaded:I.Boolean(!1,Et.ShadingCategory),ignoreLight:I.Boolean(!1,Et.ShadingCategory),xrayShaded:I.Boolean(!1,Et.ShadingCategory),renderMode:o(),stepsPerCell:I.Numeric(5,{min:1,max:20,step:1}),jumpLength:I.Numeric(0,{min:0,max:20,step:.1})}),e.Utils={Params:e.Params,createEmpty:a,createValues:f,createValuesSimple:h,updateValues:v,updateBoundingSphere:p,createRenderableState:m,updateRenderableState:g,createPositionIterator:s};function s(y,b){var S=y.transform.ref.value,x=y.gridDimension.ref.value,C=x[0],w=x[1],A=x[2],M=C*w*A,D=b.instanceCount.ref.value,k=em(),R=k.position,O=b.aTransform.ref.value,H=function(B,j){var Y=Math.floor(B/A);return R[0]=Math.floor(Y/w),R[1]=Y%w,R[2]=B%A,_.transformMat4(R,R,S),j>=0&&_.transformMat4Offset(R,R,O,0,0,j*16),k};return wn(M,D,1,H)}function u(y,b,S){var x=S[0],C=S[1],w=S[2],A=S[3],M=Ct.IsoValue.toAbsolute(b,{min:x,max:C,mean:w,sigma:A}).absoluteValue;return He.set(y,(M-x)/(C-x),(0-x)/(C-x)),y}function l(y,b){return Math.ceil(_.magnitude(y)*b)}function c(y,b){return Math.min.apply(Math,y)*(1/b)}function d(y){return 1/y}function f(y,b,S,x,C){var w=y.gridTexture,A=y.gridTextureDim,M=y.gridStats,D=y.bboxSize,k=y.bboxMin,R=y.bboxMax,O=y.gridDimension,H=y.transform,B=S.instanceCount,j=S.groupCount,Y=e.Utils.createPositionIterator(y,b),G=xs(S,Y,x.color),$=au(B*j),q=Ld(),ee=Nd(),fe=Bd(),W=O.ref.value,X=W[0],U=W[1],z=W[2],J={drawCount:gT.indices.length,vertexCount:X*U*z,groupCount:j,instanceCount:B},K=Be.clone(y.boundingSphere),Z=Zi(K,b.aTransform.ref.value,B),te=C.renderMode.name==="volume"?vz(C.renderMode.params.controlPoints):[],le=mz(te,C.renderMode.name==="volume"?C.renderMode.params.list.colors:[]),ye=C.renderMode.name==="isosurface"?C.renderMode.params.isoValue:Ct.IsoValue.relative(2),be=C.renderMode.name==="isosurface"?C.renderMode.params.singleLayer:!1;return E(E(E(E(E(E(E(E({},G),$),q),ee),fe),b),Et.createValues(C,J)),{aPosition:L.create(gT.vertices),elements:L.create(gT.indices),boundingSphere:L.create(Z),invariantBoundingSphere:L.create(K),uInvariantBoundingSphere:L.create(Ir.ofSphere(K)),uIsoValue:L.create(u(He(),ye,y.gridStats.ref.value)),uBboxMin:k,uBboxMax:R,uBboxSize:D,uMaxSteps:L.create(l(O.ref.value,C.stepsPerCell)),uStepScale:L.create(c(y.cellDim.ref.value,C.stepsPerCell)),uJumpLength:L.create(C.jumpLength),uTransform:H,uGridDim:O,dRenderMode:L.create(C.renderMode.name),tTransferTex:le,uTransferScale:L.create(d(C.stepsPerCell)),dGridTexType:L.create(w.ref.value.getDepth()>0?"3d":"2d"),uGridTexDim:A,tGridTex:w,uGridStats:M,uCellDim:y.cellDim,uCartnToUnit:y.cartnToUnit,uUnitToCartn:y.unitToCartn,dPackedGroup:y.packedGroup,dSingleLayer:L.create(be),dDoubleSided:L.create(C.doubleSided),dFlatShaded:L.create(C.flatShaded),dFlipSided:L.create(C.flipSided),dIgnoreLight:L.create(C.ignoreLight),dXrayShaded:L.create(C.xrayShaded)})}function h(y,b,S,x,C){var w=Et.createSimple(S,x,C),A=E(E({},I.getDefaultValues(e.Params)),b);return f(y,w.transform,w.locationIterator,w.theme,A)}function v(y,b){if(L.updateIfChanged(y.alpha,b.alpha),L.updateIfChanged(y.uAlpha,b.alpha),L.updateIfChanged(y.dDoubleSided,b.doubleSided),L.updateIfChanged(y.dFlatShaded,b.flatShaded),L.updateIfChanged(y.dFlipSided,b.flipSided),L.updateIfChanged(y.dIgnoreLight,b.ignoreLight),L.updateIfChanged(y.dXrayShaded,b.xrayShaded),L.updateIfChanged(y.dRenderMode,b.renderMode.name),b.renderMode.name==="isosurface")L.updateIfChanged(y.uIsoValue,u(y.uIsoValue.ref.value,b.renderMode.params.isoValue,y.uGridStats.ref.value)),L.updateIfChanged(y.dSingleLayer,b.renderMode.params.singleLayer);else if(b.renderMode.name==="volume"){var S=vz(b.renderMode.params.controlPoints);mz(S,b.renderMode.params.list.colors,y.tTransferTex)}L.updateIfChanged(y.uMaxSteps,l(y.uGridDim.ref.value,b.stepsPerCell)),L.updateIfChanged(y.uStepScale,c(y.uCellDim.ref.value,b.stepsPerCell)),L.updateIfChanged(y.uTransferScale,d(b.stepsPerCell)),L.updateIfChanged(y.uJumpLength,b.jumpLength)}function p(y,b){var S=Be.clone(b.boundingSphere),x=Zi(S,y.aTransform.ref.value,y.instanceCount.ref.value);Be.equals(x,y.boundingSphere.ref.value)||L.update(y.boundingSphere,x),Be.equals(S,y.invariantBoundingSphere.ref.value)||(L.update(y.invariantBoundingSphere,S),L.update(y.uInvariantBoundingSphere,Ir.fromSphere(y.uInvariantBoundingSphere.ref.value,S)))}function m(y){var b=Et.createRenderableState(y);return b.opaque=!1,b.writeDepth=y.renderMode.name==="isosurface",b}function g(y,b){Et.updateRenderableState(y,b),y.opaque=!1,y.writeDepth=b.renderMode.name==="isosurface"}})(uo||(uo={}));function tze(e,t){return Be.fromDimensionsAndTransform(Be(),e,t)}var Oh;(function(e){function t(h,v,p,m,g,y){return y?a(h,v,p,m,g,y):i(h,v,p,m,g)}e.create=t;function r(h){var v=h?h.centerBuffer.ref.value:new Float32Array(0),p=h?h.mappingBuffer.ref.value:new Float32Array(0),m=h?h.indexBuffer.ref.value:new Uint32Array(0),g=h?h.groupBuffer.ref.value:new Float32Array(0);return t(v,p,m,g,0,h)}e.createEmpty=r;function n(h){return Xa([h.sphereCount,h.centerBuffer.ref.version,h.mappingBuffer.ref.version,h.indexBuffer.ref.version,h.groupBuffer.ref.version])}function i(h,v,p,m,g){var y=Be(),b,S=-1,x=-1,C={kind:"spheres",sphereCount:g,centerBuffer:L.create(h),mappingBuffer:L.create(v),indexBuffer:L.create(p),groupBuffer:L.create(m),get boundingSphere(){var w=n(C);if(w!==S){var A=kh(C.centerBuffer.ref.value,C.sphereCount*4,4);Be.copy(y,A),S=w}return y},get groupMapping(){return C.groupBuffer.ref.version!==x&&(b=$0(C.groupBuffer.ref.value,C.sphereCount,4),x=C.groupBuffer.ref.version),b},setBoundingSphere:function(w){Be.copy(y,w),S=n(C)}};return C}function a(h,v,p,m,g,y){return g>y.sphereCount&&(L.update(y.mappingBuffer,v),L.update(y.indexBuffer,p)),y.sphereCount=g,L.update(y.centerBuffer,h),L.update(y.groupBuffer,m),y}e.Params=E(E({},Et.Params),{sizeFactor:I.Numeric(1,{min:0,max:10,step:.1}),doubleSided:I.Boolean(!1,Et.CustomQualityParamInfo),ignoreLight:I.Boolean(!1,Et.ShadingCategory),xrayShaded:I.Boolean(!1,Et.ShadingCategory)}),e.Utils={Params:e.Params,createEmpty:r,createValues:s,createValuesSimple:u,updateValues:l,updateBoundingSphere:c,createRenderableState:d,updateRenderableState:f,createPositionIterator:o};function o(h,v){var p=h.sphereCount*4,m=v.instanceCount.ref.value,g=em(),y=g.position,b=h.centerBuffer.ref.value,S=v.aTransform.ref.value,x=function(C,w){return w<0?_.fromArray(y,b,C*3):_.transformMat4Offset(y,b,S,0,C*3,w*16),g};return wn(p,m,4,x)}function s(h,v,p,m,g){var y=p.instanceCount,b=p.groupCount,S=o(h,v),x=xs(p,S,m.color),C=Fd(p,m.size),w=au(y*b),A=Ld(),M=Nd(),D=Bd(),k={drawCount:h.sphereCount*2*3,vertexCount:h.sphereCount*4,groupCount:b,instanceCount:y},R=h.boundingSphere.radius?e2(C)*g.sizeFactor:0,O=Be.expand(Be(),h.boundingSphere,R),H=Zi(O,v.aTransform.ref.value,y);return E(E(E(E(E(E(E(E(E(E({aPosition:h.centerBuffer,aMapping:h.mappingBuffer,aGroup:h.groupBuffer,elements:h.indexBuffer,boundingSphere:L.create(H),invariantBoundingSphere:L.create(O),uInvariantBoundingSphere:L.create(Ir.ofSphere(O))},x),C),w),A),M),D),v),{padding:L.create(R)}),Et.createValues(g,k)),{uSizeFactor:L.create(g.sizeFactor),dDoubleSided:L.create(g.doubleSided),dIgnoreLight:L.create(g.ignoreLight),dXrayShaded:L.create(g.xrayShaded)})}function u(h,v,p,m,g){var y=Et.createSimple(p,m,g),b=E(E({},I.getDefaultValues(e.Params)),v);return s(h,y.transform,y.locationIterator,y.theme,b)}function l(h,v){Et.updateValues(h,v),L.updateIfChanged(h.uSizeFactor,v.sizeFactor),L.updateIfChanged(h.dDoubleSided,v.doubleSided),L.updateIfChanged(h.dIgnoreLight,v.ignoreLight),L.updateIfChanged(h.dXrayShaded,v.xrayShaded)}function c(h,v){var p=v.boundingSphere.radius?e2(h)*h.uSizeFactor.ref.value:0,m=Be.expand(Be(),v.boundingSphere,p),g=Zi(m,h.aTransform.ref.value,h.instanceCount.ref.value);Be.equals(g,h.boundingSphere.ref.value)||L.update(h.boundingSphere,g),Be.equals(m,h.invariantBoundingSphere.ref.value)||(L.update(h.invariantBoundingSphere,m),L.update(h.uInvariantBoundingSphere,Ir.fromSphere(h.uInvariantBoundingSphere.ref.value,m))),L.update(h.padding,p)}function d(h){var v=Et.createRenderableState(h);return f(v,h),v}function f(h,v){Et.updateRenderableState(h,v),h.opaque=h.opaque&&!v.xrayShaded,h.writeDepth=h.opaque}})(Oh||(Oh={}));var Yu;(function(e){var t=function(){function u(){this.index=0,this.textures=[]}return u.prototype.get=function(){return this.textures[this.index]},u.prototype.set=function(l,c,d){this.textures[this.index]=Object.assign(this.textures[this.index]||{},{vertex:l,group:c,normal:d}),this.index=(this.index+1)%2},u.prototype.destroy=function(){for(var l=0,c=this.textures;l<c.length;l++){var d=c[l];d.vertex.destroy(),d.group.destroy(),d.normal.destroy()}},u}();e.DoubleBuffer=t;function r(u,l,c,d,f,h,v){var p=c.getWidth(),m=c.getHeight();return v?(v.vertexCount=u,v.groupCount=l,L.update(v.geoTextureDim,He.set(v.geoTextureDim.ref.value,p,m)),L.update(v.vertexTexture,c),L.update(v.groupTexture,d),L.update(v.normalTexture,f),v.doubleBuffer.set(c,d,f),Be.copy(v.boundingSphere,h),v):{kind:"texture-mesh",vertexCount:u,groupCount:l,geoTextureDim:L.create(He.create(p,m)),vertexTexture:L.create(c),groupTexture:L.create(d),normalTexture:L.create(f),doubleBuffer:new t,boundingSphere:Be.clone(h)}}e.create=r;function n(u){return{}}e.createEmpty=n,e.Params=E(E({},Et.Params),{doubleSided:I.Boolean(!1,Et.CustomQualityParamInfo),flipSided:I.Boolean(!1,Et.ShadingCategory),flatShaded:I.Boolean(!1,Et.ShadingCategory),ignoreLight:I.Boolean(!1,Et.ShadingCategory),xrayShaded:I.Boolean(!1,Et.ShadingCategory)}),e.Utils={Params:e.Params,createEmpty:n,createValues:i,createValuesSimple:a,updateValues:o,updateBoundingSphere:s,createRenderableState:Et.createRenderableState,updateRenderableState:Et.updateRenderableState,createPositionIterator:function(){return wn(1,1,1,function(){return hs})}};function i(u,l,c,d,f){var h=c.instanceCount,v=c.groupCount,p=e.Utils.createPositionIterator(u,l),m=xs(c,p,d.color),g=au(h*v),y=Ld(),b=Nd(),S=Bd(),x={drawCount:u.vertexCount,vertexCount:u.vertexCount,groupCount:v,instanceCount:h},C=Be.clone(u.boundingSphere),w=Zi(C,l.aTransform.ref.value,h);return E(E(E(E(E(E(E(E({uGeoTexDim:u.geoTextureDim,tPosition:u.vertexTexture,tGroup:u.groupTexture,tNormal:u.normalTexture,boundingSphere:L.create(w),invariantBoundingSphere:L.create(C),uInvariantBoundingSphere:L.create(Ir.ofSphere(C))},m),g),y),b),S),l),Et.createValues(f,x)),{dDoubleSided:L.create(f.doubleSided),dFlatShaded:L.create(f.flatShaded),dFlipSided:L.create(f.flipSided),dIgnoreLight:L.create(f.ignoreLight),dXrayShaded:L.create(f.xrayShaded),dGeoTexture:L.create(!0)})}function a(u,l,c,d,f){var h=Et.createSimple(c,d,f),v=E(E({},I.getDefaultValues(e.Params)),l);return i(u,h.transform,h.locationIterator,h.theme,v)}function o(u,l){Et.updateValues(u,l),L.updateIfChanged(u.dDoubleSided,l.doubleSided),L.updateIfChanged(u.dFlatShaded,l.flatShaded),L.updateIfChanged(u.dFlipSided,l.flipSided),L.updateIfChanged(u.dIgnoreLight,l.ignoreLight),L.updateIfChanged(u.dXrayShaded,l.xrayShaded)}function s(u,l){var c=Be.clone(l.boundingSphere),d=Zi(c,u.aTransform.ref.value,u.instanceCount.ref.value);Be.equals(d,u.boundingSphere.ref.value)||L.update(u.boundingSphere,d),Be.equals(c,u.invariantBoundingSphere.ref.value)||(L.update(u.invariantBoundingSphere,c),L.update(u.uInvariantBoundingSphere,Ir.fromSphere(u.uInvariantBoundingSphere.ref.value,c)))}})(Yu||(Yu={}));function rze(e,t){var r={},n={},i={},a={},o={},s={};return Object.keys(e).forEach(function(u){var l=e[u];l.type==="attribute"&&(r[u]=t[u]),l.type==="define"&&(n[u]=t[u]),l.type==="texture"&&t[u]!==void 0&&(i[u]=t[u]),l.type==="uniform"&&t[u]!==void 0&&(l.variant==="material"?o[u]=t[u]:l.variant==="buffered"?s[u]=t[u]:a[u]=t[u])}),{attributeValues:r,defineValues:n,textureValues:i,uniformValues:a,materialUniformValues:o,bufferedUniformValues:s}}function nze(e){var t={};return Object.keys(e).forEach(function(r){t[r]=e[r].ref.version}),t}function Xr(e,t,r){return{type:"attribute",kind:e,itemSize:t,divisor:r}}function Ge(e,t){return{type:"uniform",kind:e,variant:t}}function cr(e,t,r,n){return{type:"texture",kind:e,format:t,dataType:r,filter:n}}function rm(e){return{type:"elements",kind:e}}function Jt(e,t){return{type:"define",kind:e,options:t}}function Ai(e){return{type:"value",kind:e}}var Ud={uModel:Ge("m4"),uView:Ge("m4"),uInvView:Ge("m4"),uModelView:Ge("m4"),uInvModelView:Ge("m4"),uProjection:Ge("m4"),uInvProjection:Ge("m4"),uModelViewProjection:Ge("m4"),uInvModelViewProjection:Ge("m4"),uIsOrtho:Ge("f"),uPixelRatio:Ge("f"),uViewportHeight:Ge("f"),uViewport:Ge("v4"),uViewOffset:Ge("v2"),uDrawingBufferSize:Ge("v2"),uCameraPosition:Ge("v3"),uCameraDir:Ge("v3"),uNear:Ge("f"),uFar:Ge("f"),uFogNear:Ge("f"),uFogFar:Ge("f"),uFogColor:Ge("v3"),uTransparentBackground:Ge("b"),uClipObjectType:Ge("i[]"),uClipObjectInvert:Ge("b[]"),uClipObjectPosition:Ge("v3[]"),uClipObjectRotation:Ge("v4[]"),uClipObjectScale:Ge("v3[]"),uLightIntensity:Ge("f"),uAmbientIntensity:Ge("f"),uMetalness:Ge("f"),uRoughness:Ge("f"),uReflectivity:Ge("f"),uPickingAlphaThreshold:Ge("f"),uInteriorDarkening:Ge("f"),uInteriorColorFlag:Ge("b"),uInteriorColor:Ge("v3"),uHighlightColor:Ge("v3"),uSelectColor:Ge("v3"),uXrayEdgeFalloff:Ge("f"),uRenderWboit:Ge("b")},jd={tDepth:cr("texture","depth","ushort","nearest")},zd={uObjectId:Ge("i")},ize={uColor:Ge("v3","material"),uColorTexDim:Ge("v2"),uColorGridDim:Ge("v3"),uColorGridTransform:Ge("v4"),tColor:cr("image-uint8","rgb","ubyte","nearest"),tPalette:cr("image-uint8","rgb","ubyte","nearest"),tColorGrid:cr("texture","rgb","ubyte","linear"),dColorType:Jt("string",["uniform","attribute","instance","group","groupInstance","vertex","vertexInstance","volume","volumeInstance"]),dUsePalette:Jt("boolean")},D2={uSize:Ge("f","material"),uSizeTexDim:Ge("v2"),tSize:cr("image-uint8","rgb","ubyte","nearest"),dSizeType:Jt("string",["uniform","attribute","instance","group","groupInstance"]),uSizeFactor:Ge("f")},aze={uMarkerTexDim:Ge("v2"),tMarker:cr("image-uint8","alpha","ubyte","nearest")},oze={uOverpaintTexDim:Ge("v2"),tOverpaint:cr("image-uint8","rgba","ubyte","nearest"),dOverpaint:Jt("boolean")},sze={uTransparencyTexDim:Ge("v2"),tTransparency:cr("image-uint8","alpha","ubyte","nearest"),dTransparency:Jt("boolean"),transparencyAverage:Ai("number")},uze={dClipObjectCount:Jt("number"),dClipVariant:Jt("string",["instance","pixel"]),uClippingTexDim:Ge("v2"),tClipping:cr("image-uint8","alpha","ubyte","nearest"),dClipping:Jt("boolean")},Vd=E(E(E(E(E(E({},ize),aze),oze),sze),uze),{aInstance:Xr("float32",1,1),aTransform:Xr("float32",16,1),uAlpha:Ge("f","material"),uVertexCount:Ge("i"),uInstanceCount:Ge("i"),uGroupCount:Ge("i"),uInvariantBoundingSphere:Ge("v4"),drawCount:Ai("number"),instanceCount:Ai("number"),alpha:Ai("number"),matrix:Ai("m4"),transform:Ai("float32"),extraTransform:Ai("float32"),hasReflection:Ai("boolean"),boundingSphere:Ai("sphere"),invariantBoundingSphere:Ai("sphere")}),Jee=new Float32Array([1,1,-1,1,-1,-1,-1,-1,1,-1,1,1]),Pa={drawCount:Ai("number"),instanceCount:Ai("number"),aPosition:Xr("float32",2,0),uQuadScale:Ge("v2")},Ta={drawCount:L.create(6),instanceCount:L.create(1),aPosition:L.create(Jee),uQuadScale:L.create(He.create(1,1))},yz=new Uint32Array([0,1,2,1,3,2]),lze=new Float32Array([0,1,0,0,1,1,1,0]),ete={nearest:"Nearest",catmulrom:"Catmulrom (Cubic)",mitchell:"Mitchell (Cubic)",bspline:"B-Spline (Cubic)"},cze=Object.keys(ete),gd;(function(e){function t(f,h,v,p){return p?i(f,h,v,p):n(f,h,v)}e.create=t;function r(f){return Xa([f.cornerBuffer.ref.version])}function n(f,h,v){var p=Be(),m=-1,g=f.width,y=f.height,b={kind:"image",imageTexture:L.create(f),imageTextureDim:L.create(He.create(g,y)),cornerBuffer:L.create(h),groupTexture:L.create(v),get boundingSphere(){var S=r(b);if(S!==m){var x=dze(b.cornerBuffer.ref.value);Be.copy(p,x),m=S}return p}};return b}function i(f,h,v,p){var m=f.width,g=f.height;return L.update(p.imageTexture,f),L.update(p.imageTextureDim,He.set(p.imageTextureDim.ref.value,m,g)),L.update(p.cornerBuffer,h),L.update(p.groupTexture,v),p}function a(f){return{}}e.createEmpty=a,e.Params=E(E({},Et.Params),{interpolation:I.Select("bspline",I.objectToOptions(ete))}),e.Utils={Params:e.Params,createEmpty:a,createValues:o,createValuesSimple:s,updateValues:u,updateBoundingSphere:l,createRenderableState:c,updateRenderableState:d,createPositionIterator:function(){return wn(1,1,1,function(){return hs})}};function o(f,h,v,p,m){var g=v.instanceCount,y=v.groupCount,b=e.Utils.createPositionIterator(f,h),S=xs(v,b,p.color),x=au(g*y),C=Ld(),w=Nd(),A=Bd(),M={drawCount:yz.length,vertexCount:Jee.length/3,groupCount:y,instanceCount:g},D=Be.clone(f.boundingSphere),k=Zi(D,h.aTransform.ref.value,g);return E(E(E(E(E(E(E(E({},S),x),C),w),A),h),Et.createValues(m,M)),{aPosition:f.cornerBuffer,aUv:L.create(lze),elements:L.create(yz),aGroup:L.create(Js(new Float32Array(4))),boundingSphere:L.create(k),invariantBoundingSphere:L.create(D),uInvariantBoundingSphere:L.create(Ir.ofSphere(D)),dInterpolation:L.create(m.interpolation),uImageTexDim:f.imageTextureDim,tImageTex:f.imageTexture,tGroupTex:f.groupTexture})}function s(f,h,v,p,m){var g=Et.createSimple(v,p,m),y=E(E({},I.getDefaultValues(e.Params)),h);return o(f,g.transform,g.locationIterator,g.theme,y)}function u(f,h){Et.updateValues(f,h),L.updateIfChanged(f.dInterpolation,h.interpolation)}function l(f,h){var v=Be.clone(h.boundingSphere),p=Zi(v,f.aTransform.ref.value,f.instanceCount.ref.value);Be.equals(p,f.boundingSphere.ref.value)||L.update(f.boundingSphere,p),Be.equals(v,f.invariantBoundingSphere.ref.value)||(L.update(f.invariantBoundingSphere,v),L.update(f.uInvariantBoundingSphere,Ir.fromSphere(f.uInvariantBoundingSphere.ref.value,v)))}function c(f){var h=Et.createRenderableState(f);return h.opaque=!1,h}function d(f,h){Et.updateRenderableState(f,h),f.opaque=!1}})(gd||(gd={}));function dze(e){for(var t=_(),r=[],n=0,i=e.length;n<i;n+=3){var a=_.fromArray(_(),e,n);r.push(a),_.add(t,t,a)}_.scale(t,t,1/(e.length/3));for(var o=0,s=0,u=r;s<u.length;s++){var a=u[s],l=_.distance(t,a);l>o&&(o=l)}var c=Be.create(t,o);return Be.setExtrema(c,r),c}var as;(function(e){function t(v,p,m,g,y,b,S,x,C){return C?a(v,p,m,g,y,b,S,x,C):i(v,p,m,g,y,b,S,x)}e.create=t;function r(v){var p=v?v.mappingBuffer.ref.value:new Float32Array(0),m=v?v.indexBuffer.ref.value:new Uint32Array(0),g=v?v.groupBuffer.ref.value:new Float32Array(0),y=v?v.startBuffer.ref.value:new Float32Array(0),b=v?v.endBuffer.ref.value:new Float32Array(0),S=v?v.scaleBuffer.ref.value:new Float32Array(0),x=v?v.capBuffer.ref.value:new Float32Array(0);return t(p,m,g,y,b,S,x,0,v)}e.createEmpty=r;function n(v){return Xa([v.cylinderCount,v.mappingBuffer.ref.version,v.indexBuffer.ref.version,v.groupBuffer.ref.version,v.startBuffer.ref.version,v.endBuffer.ref.version,v.scaleBuffer.ref.version,v.capBuffer.ref.version])}function i(v,p,m,g,y,b,S,x){var C=Be(),w,A=-1,M=-1,D={kind:"cylinders",cylinderCount:x,mappingBuffer:L.create(v),indexBuffer:L.create(p),groupBuffer:L.create(m),startBuffer:L.create(g),endBuffer:L.create(y),scaleBuffer:L.create(b),capBuffer:L.create(S),get boundingSphere(){var k=n(D);if(k!==A){var R=kh(D.startBuffer.ref.value,D.cylinderCount*6,6),O=kh(D.endBuffer.ref.value,D.cylinderCount*6,6);Be.expandBySphere(C,R,O),A=k}return C},get groupMapping(){return D.groupBuffer.ref.version!==M&&(w=$0(D.groupBuffer.ref.value,D.cylinderCount,6),M=D.groupBuffer.ref.version),w},setBoundingSphere:function(k){Be.copy(C,k),A=n(D)}};return D}function a(v,p,m,g,y,b,S,x,C){return x>C.cylinderCount&&(L.update(C.mappingBuffer,v),L.update(C.indexBuffer,p)),C.cylinderCount=x,L.update(C.groupBuffer,m),L.update(C.startBuffer,g),L.update(C.endBuffer,y),L.update(C.scaleBuffer,b),L.update(C.capBuffer,S),C}function o(v,p){var m=v.startBuffer.ref.value;Nv(p,m,0,v.cylinderCount*6),L.update(v.startBuffer,m);var g=v.endBuffer.ref.value;Nv(p,g,0,v.cylinderCount*6),L.update(v.endBuffer,g)}e.transform=o,e.Params=E(E({},Et.Params),{sizeFactor:I.Numeric(1,{min:0,max:10,step:.1}),sizeAspectRatio:I.Numeric(1,{min:0,max:3,step:.01}),doubleSided:I.Boolean(!1,Et.CustomQualityParamInfo),ignoreLight:I.Boolean(!1,Et.ShadingCategory),xrayShaded:I.Boolean(!1,Et.ShadingCategory)}),e.Utils={Params:e.Params,createEmpty:r,createValues:u,createValuesSimple:l,updateValues:c,updateBoundingSphere:d,createRenderableState:f,updateRenderableState:h,createPositionIterator:s};function s(v,p){var m=v.cylinderCount*6,g=p.instanceCount.ref.value,y=em(),b=y.position,S=v.startBuffer.ref.value,x=v.endBuffer.ref.value,C=p.aTransform.ref.value,w=function(A,M){var D=A%6===0?S:x;return M<0?_.fromArray(b,D,A*3):_.transformMat4Offset(b,D,C,0,A*3,M*16),y};return wn(m,g,2,w)}function u(v,p,m,g,y){var b=m.instanceCount,S=m.groupCount,x=s(v,p),C=xs(m,x,g.color),w=Fd(m,g.size),A=au(b*S),M=Ld(),D=Nd(),k=Bd(),R={drawCount:v.cylinderCount*4*3,vertexCount:v.cylinderCount*6,groupCount:S,instanceCount:b},O=e2(w)*y.sizeFactor,H=Be.clone(v.boundingSphere),B=Zi(H,p.aTransform.ref.value,b);return E(E(E(E(E(E(E(E(E(E({aMapping:v.mappingBuffer,aGroup:v.groupBuffer,aStart:v.startBuffer,aEnd:v.endBuffer,aScale:v.scaleBuffer,aCap:v.capBuffer,elements:v.indexBuffer,boundingSphere:L.create(B),invariantBoundingSphere:L.create(H),uInvariantBoundingSphere:L.create(Ir.ofSphere(H))},C),w),A),M),D),k),p),{padding:L.create(O)}),Et.createValues(y,R)),{uSizeFactor:L.create(y.sizeFactor*y.sizeAspectRatio),dDoubleSided:L.create(y.doubleSided),dIgnoreLight:L.create(y.ignoreLight),dXrayShaded:L.create(y.xrayShaded)})}function l(v,p,m,g,y){var b=Et.createSimple(m,g,y),S=E(E({},I.getDefaultValues(e.Params)),p);return u(v,b.transform,b.locationIterator,b.theme,S)}function c(v,p){Et.updateValues(v,p),L.updateIfChanged(v.uSizeFactor,p.sizeFactor*p.sizeAspectRatio),L.updateIfChanged(v.dDoubleSided,p.doubleSided),L.updateIfChanged(v.dIgnoreLight,p.ignoreLight),L.updateIfChanged(v.dXrayShaded,p.xrayShaded)}function d(v,p){var m=Be.clone(p.boundingSphere),g=Zi(m,v.aTransform.ref.value,v.instanceCount.ref.value);Be.equals(g,v.boundingSphere.ref.value)||L.update(v.boundingSphere,g),Be.equals(m,v.invariantBoundingSphere.ref.value)||(L.update(v.invariantBoundingSphere,m),L.update(v.uInvariantBoundingSphere,Ir.fromSphere(v.uInvariantBoundingSphere.ref.value,m)))}function f(v){var p=Et.createRenderableState(v);return h(p,v),p}function h(v,p){Et.updateRenderableState(v,p),v.opaque=v.opaque&&!p.xrayShaded,v.writeDepth=v.opaque}})(as||(as={}));var ha;(function(e){function t(o){switch(o.kind){case"mesh":return o.triangleCount*3;case"points":return o.pointCount;case"spheres":return o.sphereCount*2*3;case"cylinders":return o.cylinderCount*4*3;case"text":return o.charCount*2*3;case"lines":return o.lineCount*2*3;case"direct-volume":return 12*3;case"image":return 2*3;case"texture-mesh":return o.vertexCount}}e.getDrawCount=t;function r(o){switch(o.kind){case"mesh":return o.vertexCount;case"points":return o.pointCount;case"spheres":return o.sphereCount*4;case"cylinders":return o.cylinderCount*6;case"text":return o.charCount*4;case"lines":return o.lineCount*4;case"direct-volume":var s=o.gridDimension.ref.value,u=s[0],l=s[1],c=s[2];return u*l*c;case"image":return 4;case"texture-mesh":return o.vertexCount}}e.getVertexCount=r;function n(o){switch(o.kind){case"mesh":case"points":case"spheres":case"cylinders":case"text":case"lines":return t(o)===0?0:Ql(o.groupBuffer.ref.value)+1;case"direct-volume":return 1;case"image":return Ql(o.groupTexture.ref.value.array)+1;case"texture-mesh":return o.groupCount}}e.getGroupCount=n;function i(o){switch(o.kind){case"mesh":return Lt.Utils;case"points":return Bv.Utils;case"spheres":return Oh.Utils;case"cylinders":return as.Utils;case"text":return eu.Utils;case"lines":return Pn.Utils;case"direct-volume":return uo.Utils;case"image":return gd.Utils;case"texture-mesh":return Yu.Utils}}e.getUtils=i;function a(o,s){return s==="instance"&&o.nonInstanceable?"group":s}e.getGranularity=a})(ha||(ha={}));var tte=Ka();function fze(e,t){switch(t){case e.FRAMEBUFFER_COMPLETE:return"complete";case e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"incomplete attachment";case e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"incomplete missing attachment";case e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"incomplete dimensions";case e.FRAMEBUFFER_UNSUPPORTED:return"unsupported"}if(Mr(e))switch(t){case e.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE:return"incomplete multisample";case e.RENDERBUFFER_SAMPLES:return"renderbuffer samples"}return"unknown error"}function mF(e){var t=e.checkFramebufferStatus(e.FRAMEBUFFER);if(t!==e.FRAMEBUFFER_COMPLETE){var r=fze(e,t);throw new Error("Framebuffer status: "+r)}}function bz(e){var t=e.createFramebuffer();if(t===null)throw new Error("Could not create WebGL framebuffer");return t}function hze(e){var t=bz(e),r=!1;return{id:tte(),bind:function(){return e.bindFramebuffer(e.FRAMEBUFFER,t)},reset:function(){t=bz(e)},destroy:function(){r||(e.deleteFramebuffer(t),r=!0)}}}function pze(){return{id:tte(),bind:function(){},reset:function(){},destroy:function(){}}}function xz(e){var t=CHe(e);if(t===null)throw new Error('Could not find support for "instanced_arrays"');var r=wHe(e);if(r===null)throw new Error('Could not find support for "element_index_uint"');var n=_He(e);Lr&&n===null&&console.log('Could not find support for "standard_derivatives"');var i=AHe(e);Lr&&i===null&&console.log('Could not find support for "texture_float"');var a=PHe(e);Lr&&a===null&&console.log('Could not find support for "texture_float_linear"');var o=THe(e);Lr&&o===null&&console.log('Could not find support for "texture_half_float"');var s=IHe(e);Lr&&s===null&&console.log('Could not find support for "texture_half_float_linear"');var u=LHe(e);Lr&&u===null&&console.log('Could not find support for "depth_texture"');var l=MHe(e);Lr&&l===null&&console.log('Could not find support for "blend_minmax"');var c=EHe(e);Lr&&c===null&&console.log('Could not find support for "vertex_array_object"');var d=DHe(e);Lr&&d===null&&console.log('Could not find support for "frag_depth"');var f=RHe(e);Lr&&f===null&&console.log('Could not find support for "color_buffer_float"');var h=kHe(e);Lr&&h===null&&console.log('Could not find support for "color_buffer_half_float"');var v=OHe(e);Lr&&v===null&&console.log('Could not find support for "draw_buffers"');var p=FHe(e);Lr&&p===null&&console.log('Could not find support for "shader_texture_lod"');var m=NHe(e);return Lr&&m===null&&console.log('Could not find support for "sRGB"'),{instancedArrays:t,standardDerivatives:n,textureFloat:i,textureFloatLinear:a,textureHalfFloat:o,textureHalfFloatLinear:s,elementIndexUint:r,depthTexture:u,blendMinMax:l,vertexArrayObject:c,fragDepth:d,colorBufferFloat:f,colorBufferHalfFloat:h,drawBuffers:v,shaderTextureLod:p,sRGB:m}}function vze(e){var t={},r=e.getParameter(e.FRONT_FACE),n=e.getParameter(e.CULL_FACE_MODE),i=e.getParameter(e.DEPTH_WRITEMASK),a=e.getParameter(e.COLOR_WRITEMASK),o=e.getParameter(e.COLOR_CLEAR_VALUE),s=e.getParameter(e.BLEND_SRC_RGB),u=e.getParameter(e.BLEND_DST_RGB),l=e.getParameter(e.BLEND_SRC_ALPHA),c=e.getParameter(e.BLEND_DST_ALPHA),d=e.getParameter(e.BLEND_EQUATION_RGB),f=e.getParameter(e.BLEND_EQUATION_ALPHA);return{currentProgramId:-1,currentMaterialId:-1,currentRenderItemId:-1,enable:function(h){t[h]!==!0&&(e.enable(h),t[h]=!0)},disable:function(h){t[h]!==!1&&(e.disable(h),t[h]=!1)},frontFace:function(h){h!==r&&(e.frontFace(h),r=h)},cullFace:function(h){h!==n&&(e.cullFace(h),n=h)},depthMask:function(h){h!==i&&(e.depthMask(h),i=h)},colorMask:function(h,v,p,m){(h!==a[0]||v!==a[1]||p!==a[2]||m!==a[3])&&(e.colorMask(h,v,p,m),a[0]=h,a[1]=v,a[2]=p,a[3]=m)},clearColor:function(h,v,p,m){(h!==o[0]||v!==o[1]||p!==o[2]||m!==o[3])&&(e.clearColor(h,v,p,m),o[0]=h,o[1]=v,o[2]=p,o[3]=m)},blendFunc:function(h,v){(h!==s||v!==u||h!==l||v!==c)&&(e.blendFunc(h,v),s=h,u=v,l=h,c=v)},blendFuncSeparate:function(h,v,p,m){(h!==s||v!==u||p!==l||m!==c)&&(e.blendFuncSeparate(h,v,p,m),s=h,u=v,l=p,c=m)},blendEquation:function(h){(h!==d||h!==f)&&(e.blendEquation(h),d=h,f=h)},blendEquationSeparate:function(h,v){(h!==d||v!==f)&&(e.blendEquationSeparate(h,v),d=h,f=v)},reset:function(){t={},r=e.getParameter(e.FRONT_FACE),n=e.getParameter(e.CULL_FACE_MODE),i=e.getParameter(e.DEPTH_WRITEMASK),a=e.getParameter(e.COLOR_WRITEMASK),o=e.getParameter(e.COLOR_CLEAR_VALUE),s=e.getParameter(e.BLEND_SRC_RGB),u=e.getParameter(e.BLEND_DST_RGB),l=e.getParameter(e.BLEND_SRC_ALPHA),c=e.getParameter(e.BLEND_DST_ALPHA),d=e.getParameter(e.BLEND_EQUATION_RGB),f=e.getParameter(e.BLEND_EQUATION_ALPHA)}}}var ov;(function(e){function t(i,a,o){return{array:i,width:a,height:o}}e.create=t;function r(i){for(var a=i.array,o=i.width,s=i.height,u=o*4,l=0,c=s/2;l<c;++l)for(var d=0,f=u;d<f;++d){var h=l*u+d,v=(s-l-1)*u+d,p=a[h];a[h]=a[v],a[v]=p}return i}e.flipY=r;function n(i){for(var a=i.array,o=0,s=a.length;o<s;o+=4){var u=a[o+3]/255;a[o]/=u,a[o+1]/=u,a[o+2]/=u}return i}e.divideByAlpha=n})(ov||(ov={}));var mze=`
float viewZ = depthToViewZ(uIsOrtho, fragmentDepth, uNear, uFar);
float fogFactor = smoothstep(uFogNear, uFogFar, abs(viewZ));
float fogAlpha = (1.0 - fogFactor) * gl_FragColor.a;
float preFogAlpha = gl_FragColor.a;
if (!uTransparentBackground) {
    if (gl_FragColor.a < 1.0) {
        // transparent objects are blended with background color
        gl_FragColor.a = fogAlpha;
    } else {
        // mix opaque objects with background color
        gl_FragColor.rgb = mix(gl_FragColor.rgb, uFogColor, fogFactor);
    }
} else {
    // pre-multiplied alpha expected for transparent background
    gl_FragColor.rgb *= fogAlpha;
    gl_FragColor.a = fogAlpha;
}
`,gze=`
if (interior) {
    if (uInteriorColorFlag) {
        gl_FragColor.rgb = uInteriorColor;
    } else {
        gl_FragColor.rgb *= 1.0 - uInteriorDarkening;
    }
}
`,yze=`
// inputs
// - vec4 material
// - vec3 vViewPosition
// - vec3 normal
// - float uMetalness
// - float uRoughness
// - float uReflectivity
// - float uLightIntensity
// - float uAmbientIntensity

// outputs
// - sets gl_FragColor

vec4 color = material;

ReflectedLight reflectedLight = ReflectedLight(vec3(0.0), vec3(0.0), vec3(0.0));

PhysicalMaterial physicalMaterial;
physicalMaterial.diffuseColor = color.rgb * (1.0 - uMetalness);
physicalMaterial.specularRoughness = clamp(uRoughness, 0.04, 1.0);
physicalMaterial.specularColor = mix(vec3(0.16 * pow2(uReflectivity)), color.rgb, uMetalness);

GeometricContext geometry;
geometry.position = -vViewPosition;
geometry.normal = normal;
geometry.viewDir = normalize(vViewPosition);

IncidentLight directLight;
directLight.direction = vec3(0.0, 0.0, -1.0);
directLight.color = vec3(uLightIntensity);

RE_Direct_Physical(directLight, geometry, physicalMaterial, reflectedLight);

vec3 irradiance = vec3(uAmbientIntensity) * PI;
RE_IndirectDiffuse_Physical(irradiance, geometry, physicalMaterial, reflectedLight);

vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular;

gl_FragColor = vec4(outgoingLight, color.a);

#ifdef dXrayShaded
    gl_FragColor.a *= 1.0 - pow(abs(dot(normal, vec3(0, 0, 1))), uXrayEdgeFalloff);
#endif
`,bze=`
float marker = floor(vMarker * 255.0 + 0.5); // rounding required to work on some cards on win
if (marker > 0.1) {
    if (intMod(marker, 2.0) > 0.1) {
        gl_FragColor.rgb = mix(uHighlightColor, gl_FragColor.rgb, 0.3);
        gl_FragColor.a = max(0.02, gl_FragColor.a); // for direct-volume rendering
    } else {
        gl_FragColor.rgb = mix(uSelectColor, gl_FragColor.rgb, 0.3);
    }
}
`,xze=`
#if dClipObjectCount != 0 && defined(dClipping)
    vClipping = readFromTexture(tClipping, aInstance * float(uGroupCount) + group, uClippingTexDim).a;
#endif
`,Sze=`
#if defined(dRenderVariant_color)
    #if defined(dColorType_attribute)
        vColor.rgb = aColor;
    #elif defined(dColorType_instance)
        vColor.rgb = readFromTexture(tColor, aInstance, uColorTexDim).rgb;
    #elif defined(dColorType_group)
        vColor.rgb = readFromTexture(tColor, group, uColorTexDim).rgb;
    #elif defined(dColorType_groupInstance)
        vColor.rgb = readFromTexture(tColor, aInstance * float(uGroupCount) + group, uColorTexDim).rgb;
    #elif defined(dColorType_vertex)
        vColor.rgb = readFromTexture(tColor, VertexID, uColorTexDim).rgb;
    #elif defined(dColorType_vertexInstance)
        vColor.rgb = readFromTexture(tColor, int(aInstance) * uVertexCount + VertexID, uColorTexDim).rgb;
    #elif defined(dColorType_volume)
        vec3 gridPos = (uColorGridTransform.w * (position - uColorGridTransform.xyz)) / uColorGridDim;
        vColor.rgb = texture3dFrom2dLinear(tColorGrid, gridPos, uColorGridDim, uColorTexDim).rgb;
    #elif defined(dColorType_volumeInstance)
        vec3 gridPos = (uColorGridTransform.w * (vModelPosition - uColorGridTransform.xyz)) / uColorGridDim;
        vColor.rgb = texture3dFrom2dLinear(tColorGrid, gridPos, uColorGridDim, uColorTexDim).rgb;
    #endif

    #ifdef dUsePalette
        vPaletteV = ((vColor.r * 256.0 * 256.0 * 255.0 + vColor.g * 256.0 * 255.0 + vColor.b * 255.0) - 1.0) / 16777215.0;
    #endif

    #ifdef dOverpaint
        vOverpaint = readFromTexture(tOverpaint, aInstance * float(uGroupCount) + group, uOverpaintTexDim);
    #endif
#elif defined(dRenderVariant_pick)
    #if defined(dRenderVariant_pickObject)
        vColor = vec4(encodeFloatRGB(float(uObjectId)), 1.0);
    #elif defined(dRenderVariant_pickInstance)
        vColor = vec4(encodeFloatRGB(aInstance), 1.0);
    #elif defined(dRenderVariant_pickGroup)
        vColor = vec4(encodeFloatRGB(group), 1.0);
    #endif
#endif

#ifdef dTransparency
    vGroup = group;
    vTransparency = readFromTexture(tTransparency, aInstance * float(uGroupCount) + group, uTransparencyTexDim).a;
#endif
`,Cze=`
#ifdef dGeoTexture
    float group = decodeFloatRGB(readFromTexture(tGroup, VertexID, uGeoTexDim).rgb);
#else
    float group = aGroup;
#endif
`,_ze=`
vMarker = readFromTexture(tMarker, aInstance * float(uGroupCount) + group, uMarkerTexDim).a;
`,wze=`
#if defined(dRenderVariant_color)
    #if defined(dUsePalette)
        vec4 material = vec4(texture2D(tPalette, vec2(vPaletteV, 0.5)).rgb, uAlpha);
    #elif defined(dColorType_uniform)
        vec4 material = vec4(uColor, uAlpha);
    #elif defined(dColorType_varying)
        vec4 material = vec4(vColor.rgb, uAlpha);
    #endif

    // mix material with overpaint
    #if defined(dOverpaint)
        material.rgb = mix(material.rgb, vOverpaint.rgb, vOverpaint.a);
    #endif
#elif defined(dRenderVariant_pick)
    vec4 material = vColor;
#elif defined(dRenderVariant_depth)
    #ifdef enabledFragDepth
        vec4 material = packDepthToRGBA(gl_FragDepthEXT);
    #else
        vec4 material = packDepthToRGBA(gl_FragCoord.z);
    #endif
#endif

// apply screendoor transparency
#if defined(dTransparency)
    float ta = 1.0 - vTransparency;

    #if defined(dRenderVariant_pick)
        if (ta < uPickingAlphaThreshold)
            discard; // ignore so the element below can be picked
    #else
        #if defined(dRenderVariant_colorBlended)
            float at = 0.0;

            // shift by view-offset during multi-sample rendering to allow for blending
            vec2 coord = gl_FragCoord.xy + uViewOffset * 0.25;

            const mat4 thresholdMatrix = mat4(
                1.0 / 17.0,  9.0 / 17.0,  3.0 / 17.0, 11.0 / 17.0,
                13.0 / 17.0,  5.0 / 17.0, 15.0 / 17.0,  7.0 / 17.0,
                4.0 / 17.0, 12.0 / 17.0,  2.0 / 17.0, 10.0 / 17.0,
                16.0 / 17.0,  8.0 / 17.0, 14.0 / 17.0,  6.0 / 17.0
            );
            int ci = int(intMod(coord.x, 4.0));
            int ri = int(intMod(coord.y, 4.0));
            #if __VERSION__ == 100
                vec4 i = vec4(float(ci * 4 + ri));
                vec4 v = thresholdMatrix[0] * vec4(equal(i, vec4(0.0, 1.0, 2.0, 3.0))) +
                    thresholdMatrix[1] * vec4(equal(i, vec4(4.0, 5.0, 6.0, 7.0))) +
                    thresholdMatrix[2] * vec4(equal(i, vec4(8.0, 9.0, 10.0, 11.0))) +
                    thresholdMatrix[3] * vec4(equal(i, vec4(12.0, 13.0, 14.0, 15.0)));
                at = v.x + v.y + v.z + v.w;
            #else
                at = thresholdMatrix[ci][ri];
            #endif

            if (ta < 0.99 && (ta < 0.01 || ta < at)) {
                discard;
            }
        #elif defined(dRenderVariant_colorWboit)
            material.a *= ta;
        #endif
    #endif
#endif
`,Eze=`
mat4 model = uModel * aTransform;
mat4 modelView = uView * model;
#ifdef dGeoTexture
    vec3 position = readFromTexture(tPosition, VertexID, uGeoTexDim).xyz;
#else
    vec3 position = aPosition;
#endif
vec4 position4 = vec4(position, 1.0);
// for accessing tColorGrid in vert shader and for clipping in frag shader
vModelPosition = (model * position4).xyz;
vec4 mvPosition = modelView * position4;
vViewPosition = mvPosition.xyz;
gl_Position = uProjection * mvPosition;
`,Aze=`
#if defined(dSizeType_uniform)
    float size = uSize;
#elif defined(dSizeType_attribute)
    float size = aSize;
#elif defined(dSizeType_instance)
    float size = decodeFloatRGB(readFromTexture(tSize, aInstance, uSizeTexDim).rgb);
#elif defined(dSizeType_group)
    float size = decodeFloatRGB(readFromTexture(tSize, group, uSizeTexDim).rgb);
#elif defined(dSizeType_groupInstance)
    float size = decodeFloatRGB(readFromTexture(tSize, aInstance * float(uGroupCount) + group, uSizeTexDim).rgb);
#endif

#if defined(dSizeType_instance) || defined(dSizeType_group) || defined(dSizeType_groupInstance)
    size /= 100.0; // NOTE factor also set in TypeScript
#endif

size *= uSizeFactor;
`,Pze=`
float viewZ = depthToViewZ(uIsOrtho, fragmentDepth, uNear, uFar);
float fogFactor = smoothstep(uFogNear, uFogFar, abs(viewZ));
float alpha = (1.0 - fogFactor) * uAlpha;
if (uAlpha < uPickingAlphaThreshold || alpha < 0.1)
    discard; // ignore so the element below can be picked
`,Tze=`
#if defined(dClipVariant_instance) && dClipObjectCount != 0
    int flag = 0;
    #if defined(dClipping)
        flag = int(floor(vClipping * 255.0 + 0.5));
    #endif

    vec4 mCenter = uModel * aTransform * vec4(uInvariantBoundingSphere.xyz, 1.0);
    if (clipTest(vec4(mCenter.xyz, uInvariantBoundingSphere.w), flag))
        // move out of [ -w, +w ] to 'discard' in vert shader
        gl_Position.z = 2.0 * gl_Position.w;
#endif
`,Ize=`
#if defined(dClipVariant_pixel) && dClipObjectCount != 0
    #if defined(dClipping)
        int clippingFlag = int(floor(vClipping * 255.0 + 0.5));
    #else
        int clippingFlag = 0;
    #endif

    if (clipTest(vec4(vModelPosition, 0.0), clippingFlag))
        discard;
#endif
`,Mze=`
#if defined(dRenderVariant_color)
    #if defined(dColorType_uniform)
        uniform vec3 uColor;
    #elif defined(dColorType_varying)
        varying vec4 vColor;
    #endif

    #ifdef dOverpaint
        varying vec4 vOverpaint;
    #endif
#elif defined(dRenderVariant_pick)
    #if __VERSION__ == 100
        varying vec4 vColor;
    #else
        flat in vec4 vColor;
    #endif
#endif

#ifdef dTransparency
    varying float vGroup;
    varying float vTransparency;
#endif

#ifdef dUsePalette
    uniform sampler2D tPalette;
    varying float vPaletteV;
#endif
`,Dze=`
#if defined(dRenderVariant_color)
    #if defined(dColorType_uniform)
        uniform vec3 uColor;
    #elif defined(dColorType_attribute)
        varying vec4 vColor;
        attribute vec3 aColor;
    #elif defined(dColorType_texture)
        varying vec4 vColor;
        uniform vec2 uColorTexDim;
        uniform sampler2D tColor;
    #elif defined(dColorType_grid)
        varying vec4 vColor;
        uniform vec2 uColorTexDim;
        uniform vec3 uColorGridDim;
        uniform vec4 uColorGridTransform;
        uniform sampler2D tColorGrid;
    #endif

    #ifdef dOverpaint
        varying vec4 vOverpaint;
        uniform vec2 uOverpaintTexDim;
        uniform sampler2D tOverpaint;
    #endif
#elif defined(dRenderVariant_pick)
    #if __VERSION__ == 100
        varying vec4 vColor;
    #else
        flat out vec4 vColor;
    #endif
#endif

#ifdef dTransparency
    varying float vGroup;
    varying float vTransparency;
    uniform vec2 uTransparencyTexDim;
    uniform sampler2D tTransparency;
#endif

#ifdef dUsePalette
    varying float vPaletteV;
#endif
`,Rze=`
#if dClipObjectCount != 0
    vec3 quaternionTransform(vec4 q, vec3 v) {
        vec3 t = 2.0 * cross(q.xyz, v);
        return v + q.w * t + cross(q.xyz, t);
    }

    vec4 computePlane(vec3 normal, vec3 inPoint) {
        return vec4(normalize(normal), -dot(normal, inPoint));
    }

    float planeSD(vec4 plane, vec3 center) {
        return -dot(plane.xyz, center - plane.xyz * -plane.w);
    }

    float sphereSD(vec3 position, vec4 rotation, vec3 size, vec3 center) {
        return (
            length(quaternionTransform(vec4(-rotation.x, -rotation.y, -rotation.z, rotation.w), center - position) / size) - 1.0
        ) * min(min(size.x, size.y), size.z);
    }

    float cubeSD(vec3 position, vec4 rotation, vec3 size, vec3 center) {
        vec3 d = abs(quaternionTransform(vec4(-rotation.x, -rotation.y, -rotation.z, rotation.w), center - position)) - size;
        return min(max(d.x, max(d.y, d.z)), 0.0) + length(max(d, 0.0));
    }

    float cylinderSD(vec3 position, vec4 rotation, vec3 size, vec3 center) {
        vec3 t = quaternionTransform(vec4(-rotation.x, -rotation.y, -rotation.z, rotation.w), center - position);

        vec2 d = abs(vec2(length(t.xz), t.y)) - size.xy;
        return min(max(d.x, d.y), 0.0) + length(max(d, 0.0));
    }

    float infiniteConeSD(vec3 position, vec4 rotation, vec3 size, vec3 center) {
        vec3 t = quaternionTransform(vec4(-rotation.x, -rotation.y, -rotation.z, rotation.w), center - position);

        float q = length(t.xy);
        return dot(size.xy, vec2(q, t.z));
    }

    float getSignedDistance(vec3 center, int type, vec3 position, vec4 rotation, vec3 scale) {
        if (type == 1) {
            vec3 normal = quaternionTransform(rotation, vec3(0.0, 1.0, 0.0));
            vec4 plane = computePlane(normal, position);
            return planeSD(plane, center);
        } else if (type == 2) {
            return sphereSD(position, rotation, scale * 0.5, center);
        } else if (type == 3) {
            return cubeSD(position, rotation, scale * 0.5, center);
        } else if (type == 4) {
            return cylinderSD(position, rotation, scale * 0.5, center);
        } else if (type == 5) {
            return infiniteConeSD(position, rotation, scale * 0.5, center);
        } else {
            return 0.1;
        }
    }

    #if __VERSION__ == 100
        // 8-bit
        int bitwiseAnd(int a, int b) {
            int d = 128;
            int result = 0;
            for (int i = 0; i < 8; ++i) {
                if (d <= 0) break;
                if (a >= d && b >= d) result += d;
                if (a >= d) a -= d;
                if (b >= d) b -= d;
                d /= 2;
            }
            return result;
        }

        bool hasBit(int mask, int bit) {
            return bitwiseAnd(mask, bit) == 0;
        }
    #else
        bool hasBit(int mask, int bit) {
            return (mask & bit) == 0;
        }
    #endif

    // flag is a bit-flag for clip-objects to ignore (note, object ids start at 1 not 0)
    bool clipTest(vec4 sphere, int flag) {
        for (int i = 0; i < dClipObjectCount; ++i) {
            if (flag == 0 || hasBit(flag, i + 1)) {
                // TODO take sphere radius into account?
                bool test = getSignedDistance(sphere.xyz, uClipObjectType[i], uClipObjectPosition[i], uClipObjectRotation[i], uClipObjectScale[i]) <= 0.0;
                if ((!uClipObjectInvert[i] && test) || (uClipObjectInvert[i] && !test)) {
                    return true;
                }
            }
        }
        return false;
    }
#endif
`,kze=`
uniform int uObjectId;
uniform int uInstanceCount;
uniform int uGroupCount;

#if dClipObjectCount != 0
    uniform int uClipObjectType[dClipObjectCount];
    uniform bool uClipObjectInvert[dClipObjectCount];
    uniform vec3 uClipObjectPosition[dClipObjectCount];
    uniform vec4 uClipObjectRotation[dClipObjectCount];
    uniform vec3 uClipObjectScale[dClipObjectCount];

    #if defined(dClipping)
        #if __VERSION__ == 100
            varying float vClipping;
        #else
            flat in float vClipping;
        #endif
    #endif
#endif

uniform vec3 uHighlightColor;
uniform vec3 uSelectColor;
#if __VERSION__ == 100
    varying float vMarker;
#else
    flat in float vMarker;
#endif

varying vec3 vModelPosition;
varying vec3 vViewPosition;

uniform vec2 uViewOffset;

uniform float uNear;
uniform float uFar;
uniform float uIsOrtho;

uniform float uFogNear;
uniform float uFogFar;
uniform vec3 uFogColor;

uniform float uAlpha;
uniform float uPickingAlphaThreshold;
uniform bool uTransparentBackground;

uniform float uInteriorDarkening;
uniform bool uInteriorColorFlag;
uniform vec3 uInteriorColor;
bool interior;

uniform float uXrayEdgeFalloff;

uniform mat4 uProjection;
`,Oze=`
uniform mat4 uProjection, uModel, uView;
uniform vec3 uCameraPosition;

uniform int uObjectId;
uniform int uVertexCount;
uniform int uInstanceCount;
uniform int uGroupCount;
uniform vec4 uInvariantBoundingSphere;

#if dClipObjectCount != 0
    uniform int uClipObjectType[dClipObjectCount];
    uniform bool uClipObjectInvert[dClipObjectCount];
    uniform vec3 uClipObjectPosition[dClipObjectCount];
    uniform vec4 uClipObjectRotation[dClipObjectCount];
    uniform vec3 uClipObjectScale[dClipObjectCount];

    #if defined(dClipping)
        uniform vec2 uClippingTexDim;
        uniform sampler2D tClipping;
        #if __VERSION__ == 100
            varying float vClipping;
        #else
            flat out float vClipping;
        #endif
    #endif
#endif

uniform vec2 uMarkerTexDim;
uniform sampler2D tMarker;
#if __VERSION__ == 100
    varying float vMarker;
#else
    flat out float vMarker;
#endif

varying vec3 vModelPosition;
varying vec3 vViewPosition;

#if __VERSION__ == 100
    attribute float aVertex;
    #define VertexID int(aVertex)
#else
    // not using gl_VertexID but aVertex to ensure there is an active attribute with divisor 0
    // since FF 85 this is not needed anymore but lets keep it for backwards compatibility
    // https://bugzilla.mozilla.org/show_bug.cgi?id=1679693
    // see also note in src/mol-gl/webgl/render-item.ts
    attribute float aVertex;
    #define VertexID int(aVertex)
    // #define VertexID gl_VertexID
#endif
`,Fze=`
// TODO find a better place for these convenience defines

#if defined(dRenderVariant_colorBlended) || defined(dRenderVariant_colorWboit)
    #define dRenderVariant_color
#endif

#if defined(dRenderVariant_pickObject) || defined(dRenderVariant_pickInstance) || defined(dRenderVariant_pickGroup)
    #define dRenderVariant_pick
#endif

#if defined(dColorType_instance) || defined(dColorType_group) || defined(dColorType_groupInstance) || defined(dColorType_vertex) || defined(dColorType_vertexInstance)
    #define dColorType_texture
#endif

#if defined(dColorType_volume) || defined(dColorType_volumeInstance)
    #define dColorType_grid
#endif

#if defined(dColorType_attribute) || defined(dColorType_texture) || defined(dColorType_grid)
    #define dColorType_varying
#endif

//

#define PI 3.14159265
#define RECIPROCAL_PI 0.31830988618
#define EPSILON 1e-6

#define saturate(a) clamp(a, 0.0, 1.0)

float intDiv(const in float a, const in float b) { return float(int(a) / int(b)); }
vec2 ivec2Div(const in vec2 a, const in vec2 b) { return vec2(ivec2(a) / ivec2(b)); }
float intMod(const in float a, const in float b) { return a - b * float(int(a) / int(b)); }
int imod(const in int a, const in int b) { return a - b * (a / b); }

float pow2(const in float x) { return x * x; }

const float maxFloat = 10000.0; // NOTE constant also set in TypeScript
const float floatLogFactor = 9.210440366976517; // log(maxFloat + 1.0);
float encodeFloatLog(const in float value) { return log(value + 1.0) / floatLogFactor; }
float decodeFloatLog(const in float value) { return exp(value * floatLogFactor) - 1.0; }

vec3 encodeFloatRGB(in float value) {
    value = clamp(value, 0.0, 16777216.0 - 1.0) + 1.0;
    vec3 c = vec3(0.0);
    c.b = mod(value, 256.0);
    value = floor(value / 256.0);
    c.g = mod(value, 256.0);
    value = floor(value / 256.0);
    c.r = mod(value, 256.0);
    return c / 255.0;
}
float decodeFloatRGB(const in vec3 rgb) {
    return (rgb.r * 256.0 * 256.0 * 255.0 + rgb.g * 256.0 * 255.0 + rgb.b * 255.0) - 1.0;
}

vec2 packUnitIntervalToRG(const in float v) {
    vec2 enc;
    enc.xy = vec2(fract(v * 256.0), v);
    enc.y -= enc.x * (1.0 / 256.0);
    enc.xy *=  256.0 / 255.0;

    return enc;
}

float unpackRGToUnitInterval(const in vec2 enc) {
    return dot(enc, vec2(255.0 / (256.0 * 256.0), 255.0 / 256.0));
}

vec3 screenSpaceToViewSpace(const in vec3 ssPos, const in mat4 invProjection) {
    vec4 p = vec4(ssPos * 2.0 - 1.0, 1.0);
    p = invProjection * p;
    return p.xyz / p.w;
}

const float PackUpscale = 256.0 / 255.0; // fraction -> 0..1 (including 1)
const float UnpackDownscale = 255.0 / 256.0; // 0..1 -> fraction (excluding 1)
const vec3 PackFactors = vec3(256.0 * 256.0 * 256.0, 256.0 * 256.0,  256.0);
const vec4 UnpackFactors = UnpackDownscale / vec4(PackFactors, 1.0);
const float ShiftRight8 = 1.0 / 256.0;

vec4 packDepthToRGBA(const in float v) {
    vec4 r = vec4(fract(v * PackFactors), v);
    r.yzw -= r.xyz * ShiftRight8; // tidy overflow
    return r * PackUpscale;
}
float unpackRGBAToDepth(const in vec4 v) {
    return dot(v, UnpackFactors);
}

vec4 sRGBToLinear(const in vec4 c) {
    return vec4(mix(pow(c.rgb * 0.9478672986 + vec3(0.0521327014), vec3(2.4)), c.rgb * 0.0773993808, vec3(lessThanEqual(c.rgb, vec3(0.04045)))), c.a);
}
vec4 linearTosRGB(const in vec4 c) {
    return vec4(mix(pow(c.rgb, vec3(0.41666)) * 1.055 - vec3(0.055), c.rgb * 12.92, vec3(lessThanEqual(c.rgb, vec3(0.0031308)))), c.a);
}

float linearizeDepth(const in float depth, const in float near, const in float far) {
    return (2.0 * near) / (far + near - depth * (far - near));
}

float perspectiveDepthToViewZ(const in float invClipZ, const in float near, const in float far) {
    return (near * far) / ((far - near) * invClipZ - far);
}

float orthographicDepthToViewZ(const in float linearClipZ, const in float near, const in float far) {
    return linearClipZ * (near - far) - near;
}

float depthToViewZ(const in float isOrtho, const in float linearClipZ, const in float near, const in float far) {
    return isOrtho == 1.0 ? orthographicDepthToViewZ(linearClipZ, near, far) : perspectiveDepthToViewZ(linearClipZ, near, far);
}

#if __VERSION__ == 100
    // transpose

    float transpose(const in float m) {
        return m;
    }

    mat2 transpose2(const in mat2 m) {
        return mat2(
            m[0][0], m[1][0],
            m[0][1], m[1][1]
        );
    }

    mat3 transpose3(const in mat3 m) {
        return mat3(
            m[0][0], m[1][0], m[2][0],
            m[0][1], m[1][1], m[2][1],
            m[0][2], m[1][2], m[2][2]
        );
    }

    mat4 transpose4(const in mat4 m) {
        return mat4(
            m[0][0], m[1][0], m[2][0], m[3][0],
            m[0][1], m[1][1], m[2][1], m[3][1],
            m[0][2], m[1][2], m[2][2], m[3][2],
            m[0][3], m[1][3], m[2][3], m[3][3]
        );
    }

    // inverse

    float inverse(const in float m) {
        return 1.0 / m;
    }

    mat2 inverse2(const in mat2 m) {
        return mat2(m[1][1],-m[0][1],
                -m[1][0], m[0][0]) / (m[0][0]*m[1][1] - m[0][1]*m[1][0]);
    }

    mat3 inverse3(const in mat3 m) {
        float a00 = m[0][0], a01 = m[0][1], a02 = m[0][2];
        float a10 = m[1][0], a11 = m[1][1], a12 = m[1][2];
        float a20 = m[2][0], a21 = m[2][1], a22 = m[2][2];

        float b01 = a22 * a11 - a12 * a21;
        float b11 = -a22 * a10 + a12 * a20;
        float b21 = a21 * a10 - a11 * a20;

        float det = a00 * b01 + a01 * b11 + a02 * b21;

        return mat3(b01, (-a22 * a01 + a02 * a21), (a12 * a01 - a02 * a11),
                    b11, (a22 * a00 - a02 * a20), (-a12 * a00 + a02 * a10),
                    b21, (-a21 * a00 + a01 * a20), (a11 * a00 - a01 * a10)) / det;
    }

    mat4 inverse4(const in mat4 m) {
        float
            a00 = m[0][0], a01 = m[0][1], a02 = m[0][2], a03 = m[0][3],
            a10 = m[1][0], a11 = m[1][1], a12 = m[1][2], a13 = m[1][3],
            a20 = m[2][0], a21 = m[2][1], a22 = m[2][2], a23 = m[2][3],
            a30 = m[3][0], a31 = m[3][1], a32 = m[3][2], a33 = m[3][3],

            b00 = a00 * a11 - a01 * a10,
            b01 = a00 * a12 - a02 * a10,
            b02 = a00 * a13 - a03 * a10,
            b03 = a01 * a12 - a02 * a11,
            b04 = a01 * a13 - a03 * a11,
            b05 = a02 * a13 - a03 * a12,
            b06 = a20 * a31 - a21 * a30,
            b07 = a20 * a32 - a22 * a30,
            b08 = a20 * a33 - a23 * a30,
            b09 = a21 * a32 - a22 * a31,
            b10 = a21 * a33 - a23 * a31,
            b11 = a22 * a33 - a23 * a32,

            det = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;

        return mat4(
            a11 * b11 - a12 * b10 + a13 * b09,
            a02 * b10 - a01 * b11 - a03 * b09,
            a31 * b05 - a32 * b04 + a33 * b03,
            a22 * b04 - a21 * b05 - a23 * b03,
            a12 * b08 - a10 * b11 - a13 * b07,
            a00 * b11 - a02 * b08 + a03 * b07,
            a32 * b02 - a30 * b05 - a33 * b01,
            a20 * b05 - a22 * b02 + a23 * b01,
            a10 * b10 - a11 * b08 + a13 * b06,
            a01 * b08 - a00 * b10 - a03 * b06,
            a30 * b04 - a31 * b02 + a33 * b00,
            a21 * b02 - a20 * b04 - a23 * b00,
            a11 * b07 - a10 * b09 - a12 * b06,
            a00 * b09 - a01 * b07 + a02 * b06,
            a31 * b01 - a30 * b03 - a32 * b00,
            a20 * b03 - a21 * b01 + a22 * b00) / det;
    }
#else
    #define transpose2(m) transpose(m)
    #define transpose3(m) transpose(m)
    #define transpose4(m) transpose(m)

    #define inverse2(m) inverse(m)
    #define inverse3(m) inverse(m)
    #define inverse4(m) inverse(m)
#endif
`,Lze=`
    // floatToRgba adapted from https://github.com/equinor/glsl-float-to-rgba
    // MIT License, Copyright (c) 2020 Equinor

    float shiftRight (float v, float amt) {
    v = floor(v) + 0.5;
    return floor(v / exp2(amt));
    }
    float shiftLeft (float v, float amt) {
        return floor(v * exp2(amt) + 0.5);
    }
    float maskLast (float v, float bits) {
        return mod(v, shiftLeft(1.0, bits));
    }
    float extractBits (float num, float from, float to) {
        from = floor(from + 0.5); to = floor(to + 0.5);
        return maskLast(shiftRight(num, from), to - from);
    }

    vec4 floatToRgba(float texelFloat, bool littleEndian) {
        if (texelFloat == 0.0) return vec4(0.0, 0.0, 0.0, 0.0);
        float sign = texelFloat > 0.0 ? 0.0 : 1.0;
        texelFloat = abs(texelFloat);
        float exponent = floor(log2(texelFloat));
        float biased_exponent = exponent + 127.0;
        float fraction = ((texelFloat / exp2(exponent)) - 1.0) * 8388608.0;
        float t = biased_exponent / 2.0;
        float last_bit_of_biased_exponent = fract(t) * 2.0;
        float remaining_bits_of_biased_exponent = floor(t);
        float byte4 = extractBits(fraction, 0.0, 8.0) / 255.0;
        float byte3 = extractBits(fraction, 8.0, 16.0) / 255.0;
        float byte2 = (last_bit_of_biased_exponent * 128.0 + extractBits(fraction, 16.0, 23.0)) / 255.0;
        float byte1 = (sign * 128.0 + remaining_bits_of_biased_exponent) / 255.0;
        return (
            littleEndian
                ? vec4(byte4, byte3, byte2, byte1)
                : vec4(byte1, byte2, byte3, byte4)
        );
    }
`,Nze=`
uniform float uLightIntensity;
uniform float uAmbientIntensity;
uniform float uReflectivity;
uniform float uMetalness;
uniform float uRoughness;

struct PhysicalMaterial {
    vec3 diffuseColor;
    float specularRoughness;
    vec3 specularColor;
};

struct IncidentLight {
    vec3 color;
    vec3 direction;
};

struct ReflectedLight {
    vec3 directDiffuse;
    vec3 directSpecular;
    vec3 indirectDiffuse;
};

struct GeometricContext {
    vec3 position;
    vec3 normal;
    vec3 viewDir;
};

vec3 F_Schlick(const in vec3 specularColor, const in float dotLH) {
    // Original approximation by Christophe Schlick '94
    // float fresnel = pow( 1.0 - dotLH, 5.0 );
    // Optimized variant (presented by Epic at SIGGRAPH '13)
    // https://cdn2.unrealengine.com/Resources/files/2013SiggraphPresentationsNotes-26915738.pdf
    float fresnel = exp2((-5.55473 * dotLH - 6.98316) * dotLH);
    return (1.0 - specularColor) * fresnel + specularColor;
}

// Moving Frostbite to Physically Based Rendering 3.0 - page 12, listing 2
// https://seblagarde.files.wordpress.com/2015/07/course_notes_moving_frostbite_to_pbr_v32.pdf
float G_GGX_SmithCorrelated(const in float alpha, const in float dotNL, const in float dotNV) {
    float a2 = pow2(alpha);
    // dotNL and dotNV are explicitly swapped. This is not a mistake.
    float gv = dotNL * sqrt(a2 + (1.0 - a2) * pow2(dotNV));
    float gl = dotNV * sqrt(a2 + (1.0 - a2) * pow2(dotNL));
    return 0.5 / max(gv + gl, EPSILON);
}

// Microfacet Models for Refraction through Rough Surfaces - equation (33)
// http://graphicrants.blogspot.com/2013/08/specular-brdf-reference.html
// alpha is "roughness squared" in Disneys reparameterization
float D_GGX(const in float alpha, const in float dotNH) {
    float a2 = pow2(alpha);
    float denom = pow2(dotNH) * (a2 - 1.0) + 1.0; // avoid alpha = 0 with dotNH = 1
    return RECIPROCAL_PI * a2 / pow2(denom);
}

vec3 BRDF_Diffuse_Lambert(const in vec3 diffuseColor) {
    return RECIPROCAL_PI * diffuseColor;
}

// GGX Distribution, Schlick Fresnel, GGX-Smith Visibility
vec3 BRDF_Specular_GGX(const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float roughness) {
    float alpha = pow2(roughness); // UE4's roughness
    vec3 halfDir = normalize(incidentLight.direction + geometry.viewDir);

    float dotNL = saturate(dot(geometry.normal, incidentLight.direction));
    float dotNV = saturate(dot(geometry.normal, geometry.viewDir));
    float dotNH = saturate(dot(geometry.normal, halfDir));
    float dotLH = saturate(dot(incidentLight.direction, halfDir));

    vec3 F = F_Schlick(specularColor, dotLH);
    float G = G_GGX_SmithCorrelated(alpha, dotNL, dotNV);
    float D = D_GGX(alpha, dotNH);
    return F * (G * D);
}

// ref: https://www.unrealengine.com/blog/physically-based-shading-on-mobile - environmentBRDF for GGX on mobile
vec3 BRDF_Specular_GGX_Environment(const in GeometricContext geometry, const in vec3 specularColor, const in float roughness) {
    float dotNV = saturate(dot(geometry.normal, geometry.viewDir));
    const vec4 c0 = vec4(-1, -0.0275, -0.572, 0.022);
    const vec4 c1 = vec4(1, 0.0425, 1.04, -0.04);
    vec4 r = roughness * c0 + c1;
    float a004 = min(r.x * r.x, exp2(-9.28 * dotNV)) * r.x + r.y;
    vec2 AB = vec2(-1.04, 1.04) * a004 + r.zw;
    return specularColor * AB.x + AB.y;
}

void RE_Direct_Physical(const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
    float dotNL = saturate(dot(geometry.normal, directLight.direction));
    vec3 irradiance = dotNL * directLight.color;
    irradiance *= PI; // punctual light

    reflectedLight.directSpecular += irradiance * BRDF_Specular_GGX(directLight, geometry, material.specularColor, material.specularRoughness);
    reflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert(material.diffuseColor);
}

void RE_IndirectDiffuse_Physical(const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
    reflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert(material.diffuseColor);
}
`,Bze=`
float matrixScale(in mat4 m){
    vec4 r = m[0];
    return sqrt(r[0] * r[0] + r[1] * r[1] + r[2] * r[2]);
}
`,Uze=`
varying vec3 vNormal;
`,jze=`
vec4 readFromTexture(const in sampler2D tex, const in float i, const in vec2 dim) {
    float x = intMod(i, dim.x);
    float y = floor(intDiv(i, dim.x));
    vec2 uv = (vec2(x, y) + 0.5) / dim;
    return texture2D(tex, uv);
}

vec4 readFromTexture(const in sampler2D tex, const in int i, const in vec2 dim) {
    int x = imod(i, int(dim.x));
    int y = i / int(dim.x);
    vec2 uv = (vec2(x, y) + 0.5) / dim;
    return texture2D(tex, uv);
}
`,zze=`
    // rgbaToFloat adapted from https://github.com/ihmeuw/glsl-rgba-to-float
    // BSD 3-Clause License
    //
    // Copyright (c) 2019, Institute for Health Metrics and Evaluation All rights reserved.
    // Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:
    //  - Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.
    //  - Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.
    //  - Neither the name of the copyright holder nor the names of its contributors may be used to endorse or promote products derived from this software without specific prior written permission.
    //
    // THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES,
    // INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.
    // IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY,
    // OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA,
    // OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
    // OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED
    // OF THE POSSIBILITY OF SUCH DAMAGE.

    ivec4 floatsToBytes(vec4 inputFloats, bool littleEndian) {
        ivec4 bytes = ivec4(inputFloats * 255.0);
        return (
            littleEndian
                ? bytes.abgr
                : bytes
        );
    }

    // Break the four bytes down into an array of 32 bits.
    void bytesToBits(const in ivec4 bytes, out bool bits[32]) {
        for (int channelIndex = 0; channelIndex < 4; ++channelIndex) {
            float acc = float(bytes[channelIndex]);
            for (int indexInByte = 7; indexInByte >= 0; --indexInByte) {
                float powerOfTwo = exp2(float(indexInByte));
                bool bit = acc >= powerOfTwo;
                bits[channelIndex * 8 + (7 - indexInByte)] = bit;
                acc = mod(acc, powerOfTwo);
            }
        }
    }

    // Compute the exponent of the 32-bit float.
    float getExponent(bool bits[32]) {
        const int startIndex = 1;
        const int bitStringLength = 8;
        const int endBeforeIndex = startIndex + bitStringLength;
        float acc = 0.0;
        int pow2 = bitStringLength - 1;
        for (int bitIndex = startIndex; bitIndex < endBeforeIndex; ++bitIndex) {
            acc += float(bits[bitIndex]) * exp2(float(pow2--));
        }
        return acc;
    }

    // Compute the mantissa of the 32-bit float.
    float getMantissa(bool bits[32], bool subnormal) {
        const int startIndex = 9;
        const int bitStringLength = 23;
        const int endBeforeIndex = startIndex + bitStringLength;
        // Leading/implicit/hidden bit convention:
        // If the number is not subnormal (with exponent 0), we add a leading 1 digit.
        float acc = float(!subnormal) * exp2(float(bitStringLength));
        int pow2 = bitStringLength - 1;
        for (int bitIndex = startIndex; bitIndex < endBeforeIndex; ++bitIndex) {
            acc += float(bits[bitIndex]) * exp2(float(pow2--));
        }
        return acc;
    }

    // Parse the float from its 32 bits.
    float bitsToFloat(bool bits[32]) {
        float signBit = float(bits[0]) * -2.0 + 1.0;
        float exponent = getExponent(bits);
        bool subnormal = abs(exponent - 0.0) < 0.01;
        float mantissa = getMantissa(bits, subnormal);
        float exponentBias = 127.0;
        return signBit * mantissa * exp2(exponent - exponentBias - 23.0);
    }

    float rgbaToFloat(vec4 texelRGBA, bool littleEndian) {
        ivec4 rgbaBytes = floatsToBytes(texelRGBA, littleEndian);
        bool bits[32];
        bytesToBits(rgbaBytes, bits);
        return bitsToFloat(bits);
    }
`,Vze=`
#if defined(dSizeType_uniform)
    uniform float uSize;
#elif defined(dSizeType_attribute)
    attribute float aSize;
#elif defined(dSizeType_instance) || defined(dSizeType_group) || defined(dSizeType_groupInstance)
    uniform vec2 uSizeTexDim;
    uniform sampler2D tSize;
#endif

uniform float uSizeFactor;
`,Hze=`
vec4 texture3dFrom1dTrilinear(const in sampler2D tex, const in vec3 pos, const in vec3 gridDim, const in vec2 texDim, const in float offset) {
    float gdYZ = gridDim.z * gridDim.y;
    float gdZ = gridDim.z;
    vec3 p0 = floor(pos * gridDim);
    vec3 p1 = ceil(pos * gridDim);
    vec3 pd = (pos * gridDim - p0) / (p1 - p0);
    vec4 s000 = readFromTexture(tex, offset + p0.z + p0.y * gdZ + p0.x * gdYZ, texDim);
    vec4 s100 = readFromTexture(tex, offset + p0.z + p0.y * gdZ + p1.x * gdYZ, texDim);
    vec4 s001 = readFromTexture(tex, offset + p1.z + p0.y * gdZ + p0.x * gdYZ, texDim);
    vec4 s101 = readFromTexture(tex, offset + p1.z + p0.y * gdZ + p1.x * gdYZ, texDim);
    vec4 s010 = readFromTexture(tex, offset + p0.z + p1.y * gdZ + p0.x * gdYZ, texDim);
    vec4 s110 = readFromTexture(tex, offset + p0.z + p1.y * gdZ + p1.x * gdYZ, texDim);
    vec4 s011 = readFromTexture(tex, offset + p1.z + p1.y * gdZ + p0.x * gdYZ, texDim);
    vec4 s111 = readFromTexture(tex, offset + p1.z + p1.y * gdZ + p1.x * gdYZ, texDim);
    vec4 s00 = mix(s000, s100, pd.x);
    vec4 s01 = mix(s001, s101, pd.x);
    vec4 s10 = mix(s010, s110, pd.x);
    vec4 s11 = mix(s011, s111, pd.x);
    vec4 s0 = mix(s00, s10, pd.y);
    vec4 s1 = mix(s01, s11, pd.y);
    return mix(s0, s1, pd.z);
}
`,Gze=`
vec4 texture3dFrom2dLinear(sampler2D tex, vec3 pos, vec3 gridDim, vec2 texDim) {
    float zSlice0 = floor(pos.z * gridDim.z);
    float column0 = intMod(zSlice0 * gridDim.x, texDim.x) / gridDim.x;
    float row0 = floor(intDiv(zSlice0 * gridDim.x, texDim.x));
    vec2 coord0 = (vec2(column0 * gridDim.x, row0 * gridDim.y) + (pos.xy * gridDim.xy)) / texDim;
    vec4 color0 = texture2D(tex, coord0);

    float zSlice1 = zSlice0 + 1.0;
    float column1 = intMod(zSlice1 * gridDim.x, texDim.x) / gridDim.x;
    float row1 = floor(intDiv(zSlice1 * gridDim.x, texDim.x));
    vec2 coord1 = (vec2(column1 * gridDim.x, row1 * gridDim.y) + (pos.xy * gridDim.xy)) / texDim;
    vec4 color1 = texture2D(tex, coord1);

    float delta0 = abs((pos.z * gridDim.z) - zSlice0);
    return mix(color0, color1, delta0);
}
`,qze=`
vec4 texture3dFrom2dNearest(sampler2D tex, vec3 pos, vec3 gridDim, vec2 texDim) {
    float zSlice = floor(pos.z * gridDim.z + 0.5); // round to nearest z-slice
    float column = intMod(zSlice * gridDim.x, texDim.x) / gridDim.x;
    float row = floor(intDiv(zSlice * gridDim.x, texDim.x));
    vec2 coord = (vec2(column * gridDim.x, row * gridDim.y) + (pos.xy * gridDim.xy)) / texDim;
    return texture2D(tex, coord);
}
`,$ze=`
#if defined(dRenderVariant_colorWboit)
    #if !defined(dRenderMode_volume) && !defined(dRenderMode_isosurface)
        uniform sampler2D tDepth;
        uniform vec2 uDrawingBufferSize;

        float getDepth(const in vec2 coords) {
            // always packed due to merged depth from primitives and volumes
            return unpackRGBAToDepth(texture2D(tDepth, coords));
        }
    #endif
#endif

uniform bool uRenderWboit;

float calcDepth(const in vec3 pos) {
    vec2 clipZW = pos.z * uProjection[2].zw + uProjection[3].zw;
    return 0.5 + 0.5 * clipZW.x / clipZW.y;
}
`,Wze=`
#if defined(dRenderVariant_colorWboit)
    if (!uRenderWboit) {
        if (preFogAlpha < 1.0) {
            discard;
        }
    } else if (uRenderWboit) {
        // the 'fragmentDepth > 0.99' check is to handle precision issues with packed depth
        if (preFogAlpha != 1.0 && !interior && (fragmentDepth < getDepth(gl_FragCoord.xy / uDrawingBufferSize) || fragmentDepth > 0.99)) {
            float alpha = gl_FragColor.a;
            float wboitWeight = alpha * clamp(pow(1.0 - fragmentDepth, 2.0), 0.01, 1.0);
            gl_FragColor = vec4(gl_FragColor.rgb * alpha * wboitWeight, alpha);
            // extra alpha is to handle pre-multiplied alpha
            #if !defined(dRenderMode_volume) && !defined(dRenderMode_isosurface)
                gl_FragData[1] = vec4((uTransparentBackground ? alpha : 1.0) * alpha * wboitWeight);
            #else
                gl_FragData[1] = vec4(alpha * alpha * wboitWeight);
            #endif
        } else {
            discard;
        }
    }
#endif
`,Xze=`
precision highp float;
precision highp int;

#include common
#include read_from_texture
#include common_vert_params
#include color_vert_params
#include size_vert_params
#include common_clip

uniform float uPixelRatio;
uniform float uViewportHeight;

attribute vec3 aPosition;
attribute mat4 aTransform;
attribute float aInstance;
attribute float aGroup;

void main(){
    #include assign_group
    #include assign_color_varying
    #include assign_marker_varying
    #include assign_clipping_varying
    #include assign_position
    #include assign_size

    #ifdef dPointSizeAttenuation
        gl_PointSize = size * uPixelRatio * ((uViewportHeight / 2.0) / -mvPosition.z) * 5.0;
    #else
        gl_PointSize = size * uPixelRatio;
    #endif

    gl_Position = uProjection * mvPosition;

    #include clip_instance
}
`,Yze=`
precision highp float;
precision highp int;

#include common
#include common_frag_params
#include color_frag_params
#include common_clip
#include wboit_params

#ifdef dPointFilledCircle
    uniform float uPointEdgeBleach;
#endif

const vec2 center = vec2(0.5);
const float radius = 0.5;

void main(){
    #include clip_pixel

    float fragmentDepth = gl_FragCoord.z;
    bool interior = false;
    #include assign_material_color

    #if defined(dRenderVariant_pick)
        #include check_picking_alpha
        gl_FragColor = material;
    #elif defined(dRenderVariant_depth)
        gl_FragColor = material;
    #elif defined(dRenderVariant_color)
        gl_FragColor = material;

        #ifdef dPointFilledCircle
            float dist = distance(gl_PointCoord, center);
            float alpha = 1.0 - smoothstep(radius - uPointEdgeBleach, radius, dist);
            if (alpha < 0.0001) discard;
            gl_FragColor.a *= alpha;
        #endif

        #include apply_marker_color
        #include apply_fog
        #include wboit_write
    #endif
}
`,Kze=`
precision highp float;
precision highp int;

#include common
#include read_from_texture
#include common_vert_params
#include color_vert_params
#include size_vert_params
#include common_clip

uniform mat4 uModelView;
uniform mat4 uInvProjection;

attribute vec3 aPosition;
attribute vec2 aMapping;
attribute mat4 aTransform;
attribute float aInstance;
attribute float aGroup;

varying float vRadius;
varying float vRadiusSq;
varying vec3 vPoint;
varying vec3 vPointViewPosition;

#include matrix_scale

const mat4 D = mat4(
    1.0, 0.0, 0.0, 0.0,
    0.0, 1.0, 0.0, 0.0,
    0.0, 0.0, 1.0, 0.0,
    0.0, 0.0, 0.0, -1.0
);

/**
 * Compute point size and center using the technique described in:
 * "GPU-Based Ray-Casting of Quadratic Surfaces" http://dl.acm.org/citation.cfm?id=2386396
 * by Christian Sigg, Tim Weyrich, Mario Botsch, Markus Gross.
 */
void quadraticProjection(const in float radius, const in vec3 position){
    vec2 xbc, ybc;

    mat4 T = mat4(
        radius, 0.0, 0.0, 0.0,
        0.0, radius, 0.0, 0.0,
        0.0, 0.0, radius, 0.0,
        position.x, position.y, position.z, 1.0
    );

    mat4 R = transpose4(uProjection * uModelView * aTransform * T);
    float A = dot(R[3], D * R[3]);
    float B = -2.0 * dot(R[0], D * R[3]);
    float C = dot(R[0], D * R[0]);
    xbc[0] = (-B - sqrt(B * B - 4.0 * A * C)) / (2.0 * A);
    xbc[1] = (-B + sqrt(B * B - 4.0 * A * C)) / (2.0 * A);
    float sx = abs(xbc[0] - xbc[1]) * 0.5;

    A = dot(R[3], D * R[3]);
    B = -2.0 * dot(R[1], D * R[3]);
    C = dot(R[1], D * R[1]);
    ybc[0] = (-B - sqrt(B * B - 4.0 * A * C)) / (2.0 * A);
    ybc[1] = (-B + sqrt(B * B - 4.0 * A * C)) / (2.0 * A);
    float sy = abs(ybc[0] - ybc[1]) * 0.5;

    gl_Position.xy = vec2(0.5 * (xbc.x + xbc.y), 0.5 * (ybc.x + ybc.y));
    gl_Position.xy -= aMapping * vec2(sx, sy);
    gl_Position.xy *= gl_Position.w;
}


void main(void){
    #include assign_group
    #include assign_color_varying
    #include assign_marker_varying
    #include assign_clipping_varying
    #include assign_size

    vRadius = size * matrixScale(uModelView);

    vec4 position4 = vec4(aPosition, 1.0);
    vec4 mvPosition = uModelView * aTransform * position4;
    mvPosition.z -= vRadius; // avoid clipping, added again in fragment shader

    gl_Position = uProjection * vec4(mvPosition.xyz, 1.0);
    quadraticProjection(size, aPosition);

    vRadiusSq = vRadius * vRadius;
    vec4 vPoint4 = uInvProjection * gl_Position;
    vPoint = vPoint4.xyz / vPoint4.w;
    vPointViewPosition = -mvPosition.xyz / mvPosition.w;

    vModelPosition = (uModel * aTransform * position4).xyz; // for clipping in frag shader

    #include clip_instance
}
`,Qze=`
precision highp float;
precision highp int;

#include common
#include common_frag_params
#include color_frag_params
#include light_frag_params
#include common_clip
#include wboit_params

varying float vRadius;
varying float vRadiusSq;
varying vec3 vPoint;
varying vec3 vPointViewPosition;

vec3 cameraPos;
vec3 cameraNormal;

bool Impostor(out vec3 cameraPos, out vec3 cameraNormal){
    vec3 cameraSpherePos = -vPointViewPosition;
    cameraSpherePos.z += vRadius;

    vec3 rayOrigin = mix(vec3(0.0, 0.0, 0.0), vPoint, uIsOrtho);
    vec3 rayDirection = mix(normalize(vPoint), vec3(0.0, 0.0, 1.0), uIsOrtho);
    vec3 cameraSphereDir = mix(cameraSpherePos, rayOrigin - cameraSpherePos, uIsOrtho);

    float B = dot(rayDirection, cameraSphereDir);
    float det = B * B + vRadiusSq - dot(cameraSphereDir, cameraSphereDir);

    if (det < 0.0){
        discard;
        return false;
    }

    float sqrtDet = sqrt(det);
    float posT = mix(B + sqrtDet, B + sqrtDet, uIsOrtho);
    float negT = mix(B - sqrtDet, sqrtDet - B, uIsOrtho);

    cameraPos = rayDirection * negT + rayOrigin;


    if (calcDepth(cameraPos) <= 0.0) {
        cameraPos = rayDirection * posT + rayOrigin;
        interior = true;
    } else {
        interior = false;
    }

    cameraNormal = normalize(cameraPos - cameraSpherePos);
    cameraNormal *= float(!interior) * 2.0 - 1.0;

    return !interior;
}

void main(void){
    #include clip_pixel

    bool flag = Impostor(cameraPos, cameraNormal);
    #ifndef dDoubleSided
        if (interior)
            discard;
    #endif

    vec3 vViewPosition = cameraPos;
    gl_FragDepthEXT = calcDepth(vViewPosition);
    if (!flag && gl_FragDepthEXT >= 0.0) {
        gl_FragDepthEXT = 0.0 + (0.0000001 / vRadius);
    }

    // bugfix (mac only?)
    if (gl_FragDepthEXT < 0.0) discard;
    if (gl_FragDepthEXT > 1.0) discard;

    float fragmentDepth = gl_FragDepthEXT;
    #include assign_material_color

    #if defined(dRenderVariant_pick)
        #include check_picking_alpha
        gl_FragColor = material;
    #elif defined(dRenderVariant_depth)
        gl_FragColor = material;
    #elif defined(dRenderVariant_color)
        #ifdef dIgnoreLight
            gl_FragColor = material;
        #else
            vec3 normal = -cameraNormal;
            #include apply_light_color
        #endif

        #include apply_interior_color
        #include apply_marker_color
        #include apply_fog
        #include wboit_write
    #endif
}
`,Zze=`
precision highp float;
precision highp int;

#include common
#include read_from_texture
#include common_vert_params
#include color_vert_params
#include size_vert_params
#include common_clip

uniform mat4 uModelView;

attribute mat4 aTransform;
attribute float aInstance;
attribute float aGroup;

attribute vec3 aMapping;
attribute vec3 aStart;
attribute vec3 aEnd;
attribute float aScale;
attribute float aCap;

varying mat4 vTransform;
varying vec3 vStart;
varying vec3 vEnd;
varying float vSize;
varying float vCap;

uniform float uIsOrtho;
uniform vec3 uCameraDir;

void main() {
    #include assign_group
    #include assign_color_varying
    #include assign_marker_varying
    #include assign_clipping_varying
    #include assign_size

    mat4 modelTransform = uModel * aTransform;

    vTransform = aTransform;
    vStart = (modelTransform * vec4(aStart, 1.0)).xyz;
    vEnd = (modelTransform * vec4(aEnd, 1.0)).xyz;
    vSize = size * aScale;
    vCap = aCap;

    vModelPosition = (vStart + vEnd) * 0.5;
    vec3 camDir = -mix(normalize(vModelPosition - uCameraPosition), uCameraDir, uIsOrtho);
    vec3 dir = vEnd - vStart;
    // ensure cylinder 'dir' is pointing towards the camera
    if(dot(camDir, dir) < 0.0) dir = -dir;

    vec3 left = cross(camDir, dir);
    vec3 up = cross(left, dir);
    left = vSize * normalize(left);
    up = vSize * normalize(up);

    // move vertex in object-space from center to corner
    vModelPosition += aMapping.x * dir + aMapping.y * left + aMapping.z * up;

    vec4 mvPosition = uView * vec4(vModelPosition, 1.0);
    vViewPosition = mvPosition.xyz;
    gl_Position = uProjection * mvPosition;

    #include clip_instance
}
`,Jze=`
precision highp float;
precision highp int;

uniform mat4 uView;

varying mat4 vTransform;
varying vec3 vStart;
varying vec3 vEnd;
varying float vSize;
varying float vCap;

uniform vec3 uCameraDir;
uniform vec3 uCameraPosition;

#include common
#include common_frag_params
#include color_frag_params
#include light_frag_params
#include common_clip
#include wboit_params

// adapted from https://www.shadertoy.com/view/4lcSRn
// The MIT License, Copyright 2016 Inigo Quilez
bool CylinderImpostor(
    in vec3 rayOrigin, in vec3 rayDir,
    in vec3 start, in vec3 end, in float radius,
    out vec4 intersection, out bool interior
){
    vec3 ba = end - start;
    vec3 oc = rayOrigin - start;

    float baba = dot(ba, ba);
    float bard = dot(ba, rayDir);
    float baoc = dot(ba, oc);

    float k2 = baba - bard*bard;
    float k1 = baba * dot(oc, rayDir) - baoc * bard;
    float k0 = baba * dot(oc, oc) - baoc * baoc - radius * radius * baba;

    float h = k1 * k1 - k2 * k0;
    if (h < 0.0) return false;

    bool topCap = (vCap > 0.9 && vCap < 1.1) || vCap >= 2.9;
    bool bottomCap = (vCap > 1.9 && vCap < 2.1) || vCap >= 2.9;

    // body outside
    h = sqrt(h);
    float t = (-k1 - h) / k2;
    float y = baoc + t * bard;
    if (y > 0.0 && y < baba) {
        interior = false;
        intersection = vec4(t, (oc + t * rayDir - ba * y / baba) / radius);
        return true;
    }

    if (topCap && y < 0.0) {
        // top cap
        t = -baoc / bard;
        if (abs(k1 + k2 * t) < h) {
            interior = false;
            intersection = vec4(t, ba * sign(y) / baba);
            return true;
        }
    } else if(bottomCap && y >= 0.0) {
        // bottom cap
        t = (baba - baoc) / bard;
        if (abs(k1 + k2 * t) < h) {
            interior = false;
            intersection = vec4(t, ba * sign(y) / baba);
            return true;
        }
    }

    #ifdef dDoubleSided
        // body inside
        h = -h;
        t = (-k1 - h) / k2;
        y = baoc + t * bard;
        if (y > 0.0 && y < baba) {
            interior = true;
            intersection = vec4(t, (oc + t * rayDir - ba * y / baba) / radius);
            return true;
        }

        // TODO: handle inside caps???
    #endif

    return false;
}

void main() {
    #include clip_pixel

    vec3 rayDir = mix(normalize(vModelPosition - uCameraPosition), uCameraDir, uIsOrtho);

    vec4 intersection;
    bool interior;
    bool hit = CylinderImpostor(vModelPosition, rayDir, vStart, vEnd, vSize, intersection, interior);
    if (!hit) discard;

    vec3 vViewPosition = vModelPosition + intersection.x * rayDir;
    vViewPosition = (uView * vec4(vViewPosition, 1.0)).xyz;
    gl_FragDepthEXT = calcDepth(vViewPosition);

    // bugfix (mac only?)
    if (gl_FragDepthEXT < 0.0) discard;
    if (gl_FragDepthEXT > 1.0) discard;

    float fragmentDepth = gl_FragDepthEXT;
    #include assign_material_color

    #if defined(dRenderVariant_pick)
        #include check_picking_alpha
        gl_FragColor = material;
    #elif defined(dRenderVariant_depth)
        gl_FragColor = material;
    #elif defined(dRenderVariant_color)
        #ifdef dIgnoreLight
            gl_FragColor = material;
        #else
            mat3 normalMatrix = transpose3(inverse3(mat3(uView)));
            vec3 normal = normalize(normalMatrix * -normalize(intersection.yzw));
            #include apply_light_color
        #endif

        #include apply_interior_color
        #include apply_marker_color
        #include apply_fog
        #include wboit_write
    #endif
}
`,eVe=`
precision highp float;
precision highp int;

#include common
#include read_from_texture
#include common_vert_params
#include color_vert_params
#include size_vert_params
#include common_clip

uniform mat4 uModelView;

attribute vec3 aPosition;
attribute vec2 aMapping;
attribute float aDepth;
attribute vec2 aTexCoord;
attribute mat4 aTransform;
attribute float aInstance;
attribute float aGroup;

uniform float uOffsetX;
uniform float uOffsetY;
uniform float uOffsetZ;

// uniform bool ortho;
uniform float uPixelRatio;
uniform float uViewportHeight;

varying vec2 vTexCoord;

#include matrix_scale

void main(void){
    #include assign_group
    #include assign_color_varying
    #include assign_marker_varying
    #include assign_clipping_varying
    #include assign_size

    vTexCoord = aTexCoord;

    float scale = matrixScale(uModelView);

    float offsetX = uOffsetX * scale;
    float offsetY = uOffsetY * scale;
    float offsetZ = (uOffsetZ + aDepth * 0.95) * scale;

    vec4 position4 = vec4(aPosition, 1.0);
    vec4 mvPosition = uModelView * aTransform * position4;

    vModelPosition = (uModel * aTransform * position4).xyz; // for clipping in frag shader

    // TODO
    // #ifdef FIXED_SIZE
    //     if (ortho) {
    //         scale /= pixelRatio * ((uViewportHeight / 2.0) / -uCameraPosition.z) * 0.1;
    //     } else {
    //         scale /= pixelRatio * ((uViewportHeight / 2.0) / -mvPosition.z) * 0.1;
    //     }
    // #endif

    vec4 mvCorner = vec4(mvPosition.xyz, 1.0);

    if (vTexCoord.x == 10.0) { // indicates background plane
        // move a bit to the back, taking distance to camera into account to avoid z-fighting
        offsetZ -= 0.001 * distance(uCameraPosition, (uProjection * mvCorner).xyz);
    }

    mvCorner.xy += aMapping * size * scale;
    mvCorner.x += offsetX;
    mvCorner.y += offsetY;

    // TODO
    // if(ortho){
    //     mvCorner.xyz += normalize(-uCameraPosition) * offsetZ;
    // } else {
    //     mvCorner.xyz += normalize(-mvCorner.xyz) * offsetZ;
    // }
    mvCorner.xyz += normalize(-mvCorner.xyz) * offsetZ;

    gl_Position = uProjection * mvCorner;

    vViewPosition = -mvCorner.xyz;

    #include clip_instance
}
`,tVe=`
precision highp float;
precision highp int;

#include common
#include common_frag_params
#include color_frag_params
#include common_clip
#include wboit_params

uniform sampler2D tFont;

uniform vec3 uBorderColor;
uniform float uBorderWidth;
uniform vec3 uBackgroundColor;
uniform float uBackgroundOpacity;

varying vec2 vTexCoord;

const float smoothness = 32.0;
const float gamma = 2.2;

void main2(){
    gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0);
}

void main(){
    #include clip_pixel

    float fragmentDepth = gl_FragCoord.z;
    bool interior = false;
    #include assign_material_color

    if (vTexCoord.x > 1.0) {
        gl_FragColor = vec4(uBackgroundColor, uBackgroundOpacity * material.a);
    } else {
        // retrieve signed distance
        float sdf = texture2D(tFont, vTexCoord).a + uBorderWidth;

        // perform adaptive anti-aliasing of the edges
        float w = clamp(smoothness * (abs(dFdx(vTexCoord.x)) + abs(dFdy(vTexCoord.y))), 0.0, 0.5);
        float a = smoothstep(0.5 - w, 0.5 + w, sdf);

        // gamma correction for linear attenuation
        a = pow(a, 1.0 / gamma);

        if (a < 0.5) discard;
        material.a *= a;

        // add border
        float t = 0.5 + uBorderWidth;
        if (uBorderWidth > 0.0 && sdf < t) {
            material.xyz = mix(uBorderColor, material.xyz, smoothstep(t - w, t, sdf));
        }

        gl_FragColor = material;
    }

    #if defined(dRenderVariant_pick)
        #include check_picking_alpha
    #elif defined(dRenderVariant_depth)
        gl_FragColor = material;
    #elif defined(dRenderVariant_color)
        #include apply_marker_color
        #include apply_fog
        #include wboit_write
    #endif
}
`,rVe=`
precision highp float;
precision highp int;

#include common
#include read_from_texture
#include common_vert_params
#include color_vert_params
#include size_vert_params
#include common_clip

uniform float uPixelRatio;
uniform float uViewportHeight;

attribute mat4 aTransform;
attribute float aInstance;
attribute float aGroup;

attribute vec2 aMapping;
attribute vec3 aStart;
attribute vec3 aEnd;

void trimSegment(const in vec4 start, inout vec4 end) {
    // trim end segment so it terminates between the camera plane and the near plane
    // conservative estimate of the near plane
    float a = uProjection[2][2];  // 3rd entry in 3rd column
    float b = uProjection[3][2];  // 3rd entry in 4th column
    float nearEstimate = -0.5 * b / a;
    float alpha = (nearEstimate - start.z) / (end.z - start.z);
    end.xyz = mix(start.xyz, end.xyz, alpha);
}

void main(){
    #include assign_group
    #include assign_color_varying
    #include assign_marker_varying
    #include assign_clipping_varying
    #include assign_size

    mat4 modelView = uView * uModel * aTransform;

    // camera space
    vec4 start = modelView * vec4(aStart, 1.0);
    vec4 end = modelView * vec4(aEnd, 1.0);

    // assign position
    vec4 position4 = vec4((aMapping.y < 0.5) ? aStart : aEnd, 1.0);
    vec4 mvPosition = modelView * position4;
    vViewPosition = mvPosition.xyz;

    vModelPosition = (uModel * aTransform * position4).xyz; // for clipping in frag shader

    // special case for perspective projection, and segments that terminate either in, or behind, the camera plane
    // clearly the gpu firmware has a way of addressing this issue when projecting into ndc space
    // but we need to perform ndc-space calculations in the shader, so we must address this issue directly
    // perhaps there is a more elegant solution -- WestLangley
    bool perspective = (uProjection[2][3] == -1.0); // 4th entry in the 3rd column
    if (perspective) {
        if (start.z < 0.0 && end.z >= 0.0) {
            trimSegment(start, end);
        } else if (end.z < 0.0 && start.z >= 0.0) {
            trimSegment(end, start);
        }
    }

    // clip space
    vec4 clipStart = uProjection * start;
    vec4 clipEnd = uProjection * end;

    // ndc space
    vec2 ndcStart = clipStart.xy / clipStart.w;
    vec2 ndcEnd = clipEnd.xy / clipEnd.w;

    // direction
    vec2 dir = ndcEnd - ndcStart;

    // account for clip-space aspect ratio
    dir.x *= uPixelRatio;
    dir = normalize(dir);

    // perpendicular to dir
    vec2 offset = vec2(dir.y, - dir.x);

    // undo aspect ratio adjustment
    dir.x /= uPixelRatio;
    offset.x /= uPixelRatio;

    // sign flip
    if (aMapping.x < 0.0) offset *= -1.0;

    // calculate linewidth
    float linewidth;
    #ifdef dLineSizeAttenuation
        linewidth = size * uPixelRatio * ((uViewportHeight / 2.0) / -start.z) * 5.0;
    #else
        linewidth = size * uPixelRatio;
    #endif

    // adjust for linewidth
    offset *= linewidth;

    // adjust for clip-space to screen-space conversion
    offset /= uViewportHeight;

    // select end
    vec4 clip = (aMapping.y < 0.5) ? clipStart : clipEnd;

    // back to clip space
    offset *= clip.w;
    clip.xy += offset;
    gl_Position = clip;

    #include clip_instance
}
`,nVe=`
precision highp float;
precision highp int;

#include common
#include common_frag_params
#include color_frag_params
#include common_clip
#include wboit_params

void main(){
    #include clip_pixel

    bool interior = false;
    float fragmentDepth = gl_FragCoord.z;
    #include assign_material_color

    #if defined(dRenderVariant_pick)
        #include check_picking_alpha
        gl_FragColor = material;
    #elif defined(dRenderVariant_depth)
        gl_FragColor = material;
    #elif defined(dRenderVariant_color)
        gl_FragColor = material;

        #include apply_marker_color
        #include apply_fog
        #include wboit_write
    #endif
}
`,iVe=`
precision highp float;
precision highp int;
precision highp sampler2D;

#include common
#include read_from_texture
#include common_vert_params
#include color_vert_params
#include common_clip

#if defined(dColorType_grid)
    #include texture3d_from_2d_linear
#endif

#ifdef dGeoTexture
    uniform vec2 uGeoTexDim;
    uniform sampler2D tPosition;
    uniform sampler2D tGroup;
    uniform sampler2D tNormal;
#else
    attribute vec3 aPosition;
    attribute float aGroup;
    attribute vec3 aNormal;
#endif
attribute mat4 aTransform;
attribute float aInstance;

varying vec3 vNormal;

void main(){
    #include assign_group
    #include assign_marker_varying
    #include assign_clipping_varying
    #include assign_position
    #include assign_color_varying
    #include clip_instance

    #ifdef dGeoTexture
        vec3 normal = readFromTexture(tNormal, VertexID, uGeoTexDim).xyz;
    #else
        vec3 normal = aNormal;
    #endif
    mat3 normalMatrix = transpose3(inverse3(mat3(modelView)));
    vec3 transformedNormal = normalize(normalMatrix * normalize(normal));
    #if defined(dFlipSided) && !defined(dDoubleSided) // TODO checking dDoubleSided should not be required, ASR
        transformedNormal = -transformedNormal;
    #endif
    vNormal = transformedNormal;
}
`,aVe=`
precision highp float;
precision highp int;

#include common
#include common_frag_params
#include color_frag_params
#include light_frag_params
#include normal_frag_params
#include common_clip
#include wboit_params

void main() {
    #include clip_pixel

    // Workaround for buggy gl_FrontFacing (e.g. on some integrated Intel GPUs)
    #if defined(enabledStandardDerivatives)
        vec3 fdx = dFdx(vViewPosition);
        vec3 fdy = dFdy(vViewPosition);
        vec3 faceNormal = normalize(cross(fdx,fdy));
        bool frontFacing = dot(vNormal, faceNormal) > 0.0;
    #else
        bool frontFacing = dot(vNormal, vViewPosition) < 0.0;
    #endif

    #if defined(dFlipSided)
        interior = frontFacing;
    #else
        interior = !frontFacing;
    #endif

    float fragmentDepth = gl_FragCoord.z;
    #include assign_material_color

    #if defined(dRenderVariant_pick)
        #include check_picking_alpha
        gl_FragColor = material;
    #elif defined(dRenderVariant_depth)
        gl_FragColor = material;
    #elif defined(dRenderVariant_color)
        #ifdef dIgnoreLight
            gl_FragColor = material;
        #else
            #if defined(dFlatShaded) && defined(enabledStandardDerivatives)
                vec3 normal = -faceNormal;
            #else
                vec3 normal = -normalize(vNormal);
                #ifdef dDoubleSided
                    normal = normal * (float(frontFacing) * 2.0 - 1.0);
                #endif
            #endif
            #include apply_light_color
        #endif

        #include apply_interior_color
        #include apply_marker_color
        #include apply_fog
        #include wboit_write
    #endif
}
`,oVe=`
precision highp float;

attribute vec3 aPosition;
attribute mat4 aTransform;
attribute float aInstance;

uniform mat4 uModelView;
uniform mat4 uProjection;
uniform vec4 uInvariantBoundingSphere;

varying vec3 vOrigPos;
varying float vInstance;
varying vec4 vBoundingSphere;
varying mat4 vTransform;

uniform vec3 uBboxSize;
uniform vec3 uBboxMin;
uniform vec3 uBboxMax;
uniform vec3 uGridDim;
uniform mat4 uTransform;

uniform mat4 uUnitToCartn;

void main() {
    vec4 unitCoord = vec4(aPosition + vec3(0.5), 1.0);
    vec4 mvPosition = uModelView * aTransform * uUnitToCartn * unitCoord;

    vOrigPos = (aTransform * uUnitToCartn * unitCoord).xyz;
    vInstance = aInstance;
    vBoundingSphere = vec4(
        (aTransform * vec4(uInvariantBoundingSphere.xyz, 1.0)).xyz,
        uInvariantBoundingSphere.w
    );
    vTransform = aTransform;

    gl_Position = uProjection * mvPosition;

    // move z position to near clip plane (but not too close to get precision issues)
    gl_Position.z = gl_Position.w - 0.01;
}
`,sVe=`
precision highp float;
precision highp int;

#include common
#include light_frag_params

#if dClipObjectCount != 0
    uniform int uClipObjectType[dClipObjectCount];
    uniform bool uClipObjectInvert[dClipObjectCount];
    uniform vec3 uClipObjectPosition[dClipObjectCount];
    uniform vec4 uClipObjectRotation[dClipObjectCount];
    uniform vec3 uClipObjectScale[dClipObjectCount];
#endif
#include common_clip

#include read_from_texture
#include texture3d_from_1d_trilinear
#include texture3d_from_2d_nearest
#include texture3d_from_2d_linear

uniform mat4 uProjection, uTransform, uModelView, uModel, uView;
uniform vec3 uCameraDir;

uniform sampler2D tDepth;
uniform vec2 uDrawingBufferSize;

varying vec3 vOrigPos;
varying float vInstance;
varying vec4 vBoundingSphere;
varying mat4 vTransform;

uniform mat4 uInvView;
uniform vec2 uIsoValue;
uniform vec3 uGridDim;
uniform vec3 uBboxSize;
uniform sampler2D tTransferTex;
uniform float uTransferScale;
uniform float uStepScale;
uniform float uJumpLength;

uniform int uObjectId;
uniform int uVertexCount;
uniform int uInstanceCount;
uniform int uGroupCount;

uniform vec3 uHighlightColor;
uniform vec3 uSelectColor;
uniform vec2 uMarkerTexDim;
uniform sampler2D tMarker;

uniform float uFogNear;
uniform float uFogFar;
uniform vec3 uFogColor;

uniform float uAlpha;
uniform float uPickingAlphaThreshold;
uniform bool uTransparentBackground;

uniform float uInteriorDarkening;
uniform bool uInteriorColorFlag;
uniform vec3 uInteriorColor;
bool interior;

uniform float uNear;
uniform float uFar;
uniform float uIsOrtho;

uniform vec3 uCellDim;
uniform vec3 uCameraPosition;
uniform mat4 uCartnToUnit;

#if __VERSION__ != 100
    // for webgl1 this is given as a 'define'
    uniform int uMaxSteps;
#endif

#if defined(dGridTexType_2d)
    precision highp sampler2D;
    uniform sampler2D tGridTex;
    uniform vec3 uGridTexDim;
#elif defined(dGridTexType_3d)
    precision highp sampler3D;
    uniform sampler3D tGridTex;
#endif

#if defined(dRenderVariant_color)
    #if defined(dColorType_uniform)
        uniform vec3 uColor;
    #elif defined(dColorType_texture)
        uniform vec2 uColorTexDim;
        uniform sampler2D tColor;
    #endif

    #ifdef dOverpaint
        varying vec4 vOverpaint;
        uniform vec2 uOverpaintTexDim;
        uniform sampler2D tOverpaint;
    #endif
#endif

#if defined(dGridTexType_2d)
    vec4 textureVal(vec3 pos) {
        return texture3dFrom2dLinear(tGridTex, pos + (vec3(0.5, 0.5, 0.0) / uGridDim), uGridDim, uGridTexDim.xy);
    }
    vec4 textureGroup(vec3 pos) {
        return texture3dFrom2dNearest(tGridTex, pos + (vec3(0.5, 0.5, 0.0) / uGridDim), uGridDim, uGridTexDim.xy);
    }
#elif defined(dGridTexType_3d)
    vec4 textureVal(vec3 pos) {
        return texture(tGridTex, pos + (vec3(0.5) / uGridDim));
    }
    vec4 textureGroup(vec3 pos) {
        return texelFetch(tGridTex, ivec3(pos * uGridDim), 0);
    }
#endif

#include wboit_params

vec4 transferFunction(float value) {
    return texture2D(tTransferTex, vec2(value, 0.0));
}

float getDepth(const in vec2 coords) {
    #ifdef depthTextureSupport
        if (!uRenderWboit) {
            // in case of opaque volumes (and depth texture support)
            return texture2D(tDepth, coords).r;
        } else {
            return unpackRGBAToDepth(texture2D(tDepth, coords));
        }
    #else
        return unpackRGBAToDepth(texture2D(tDepth, coords));
    #endif
}

const float gradOffset = 0.5;

vec3 v3m4(vec3 p, mat4 m) {
    return (m * vec4(p, 1.0)).xyz;
}

float preFogAlphaBlended = 0.0;

vec4 raymarch(vec3 startLoc, vec3 step, vec3 rayDir) {
    #if defined(dRenderVariant_color) && !defined(dIgnoreLight)
        mat3 normalMatrix = transpose3(inverse3(mat3(uModelView * vTransform)));
    #endif
    mat4 cartnToUnit = uCartnToUnit * inverse4(vTransform);
    #if defined(dClipVariant_pixel) && dClipObjectCount != 0
        mat4 modelTransform = uModel * vTransform * uTransform;
    #endif
    mat4 modelViewTransform = uModelView * vTransform * uTransform;

    vec3 scaleVol = vec3(1.0) / uGridDim;
    vec3 pos = startLoc;
    vec4 cell;
    float prevValue = -1.0;
    float value = 0.0;
    vec4 src = vec4(0.0);
    vec4 dst = vec4(0.0);
    bool hit = false;
    float fragmentDepth;

    vec3 posMin = vec3(0.0);
    vec3 posMax = vec3(1.0) - vec3(1.0) / uGridDim;

    vec3 unitPos;
    vec3 isoPos;

    vec3 nextPos;
    float nextValue;

    vec3 color = vec3(0.45, 0.55, 0.8);
    vec3 gradient = vec3(1.0);
    vec3 dx = vec3(gradOffset * scaleVol.x, 0.0, 0.0);
    vec3 dy = vec3(0.0, gradOffset * scaleVol.y, 0.0);
    vec3 dz = vec3(0.0, 0.0, gradOffset * scaleVol.z);

    float maxDist = min(vBoundingSphere.w * 2.0, uFar - uNear);
    float maxDistSq = maxDist * maxDist;

    for (int i = 0; i < uMaxSteps; ++i) {
        // break when beyond bounding-sphere or far-plane
        vec3 distVec = startLoc - pos;
        if (dot(distVec, distVec) > maxDistSq) break;

        unitPos = v3m4(pos, cartnToUnit);

        // continue when outside of grid
        if (unitPos.x > posMax.x || unitPos.y > posMax.y || unitPos.z > posMax.z ||
            unitPos.x < posMin.x || unitPos.y < posMin.y || unitPos.z < posMin.z
        ) {
            if (hit) break;
            prevValue = value;
            pos += step;
            continue;
        }

        cell = textureVal(unitPos);
        value = cell.a; // current voxel value

        if (uJumpLength > 0.0 && value < 0.01) {
            nextPos = pos + rayDir * uJumpLength;
            nextValue = textureVal(v3m4(nextPos, cartnToUnit)).a;
            if (nextValue < 0.01) {
                prevValue = nextValue;
                pos = nextPos;
                continue;
            }
        }

        #if defined(dRenderMode_isosurface)
            if (prevValue > 0.0 && ( // there was a prev Value
                (prevValue < uIsoValue.x && value > uIsoValue.x) || // entering isosurface
                (prevValue > uIsoValue.x && value < uIsoValue.x) // leaving isosurface
            )) {
                isoPos = v3m4(mix(pos - step, pos, ((prevValue - uIsoValue.x) / ((prevValue - uIsoValue.x) - (value - uIsoValue.x)))), cartnToUnit);

                vec4 mvPosition = modelViewTransform * vec4(isoPos * uGridDim, 1.0);

                #if defined(dClipVariant_pixel) && dClipObjectCount != 0
                    vec3 vModelPosition = v3m4(isoPos * uGridDim, modelTransform);
                    if (clipTest(vec4(vModelPosition, 0.0), 0)) {
                        prevValue = value;
                        pos += step;
                        continue;
                    }
                #endif

                float depth = calcDepth(mvPosition.xyz);
                if (depth > getDepth(gl_FragCoord.xy / uDrawingBufferSize))
                    break;

                #ifdef enabledFragDepth
                    if (!hit) {
                        gl_FragDepthEXT = depth;
                    }
                #endif

                #if defined(dRenderVariant_pickObject)
                    return vec4(encodeFloatRGB(float(uObjectId)), 1.0);
                #elif defined(dRenderVariant_pickInstance)
                    return vec4(encodeFloatRGB(vInstance), 1.0);
                #elif defined(dRenderVariant_pickGroup)
                    #ifdef dPackedGroup
                        return vec4(textureGroup(floor(isoPos * uGridDim + 0.5) / uGridDim).rgb, 1.0);
                    #else
                        vec3 g = floor(isoPos * uGridDim + 0.5);
                        return vec4(encodeFloatRGB(g.z + g.y * uGridDim.z + g.x * uGridDim.z * uGridDim.y), 1.0);
                    #endif
                #elif defined(dRenderVariant_depth)
                    #ifdef enabledFragDepth
                        return packDepthToRGBA(gl_FragDepthEXT);
                    #else
                        return packDepthToRGBA(depth);
                    #endif
                #elif defined(dRenderVariant_color)
                    #ifdef dPackedGroup
                        float group = decodeFloatRGB(textureGroup(floor(isoPos * uGridDim + 0.5) / uGridDim).rgb);
                    #else
                        vec3 g = floor(isoPos * uGridDim + 0.5);
                        float group = g.z + g.y * uGridDim.z + g.x * uGridDim.z * uGridDim.y;
                    #endif

                    #if defined(dColorType_uniform)
                        color = uColor;
                    #elif defined(dColorType_instance)
                        color = readFromTexture(tColor, vInstance, uColorTexDim).rgb;
                    #elif defined(dColorType_group)
                        color = readFromTexture(tColor, group, uColorTexDim).rgb;
                    #elif defined(dColorType_groupInstance)
                        color = readFromTexture(tColor, vInstance * float(uGroupCount) + group, uColorTexDim).rgb;
                    #elif defined(dColorType_vertex)
                        color = texture3dFrom1dTrilinear(tColor, isoPos, uGridDim, uColorTexDim, 0.0).rgb;
                    #elif defined(dColorType_vertexInstance)
                        color = texture3dFrom1dTrilinear(tColor, isoPos, uGridDim, uColorTexDim, vInstance * float(uVertexCount)).rgb;
                    #endif

                    // handle flipping and negative isosurfaces
                    #ifdef dFlipSided
                        bool flipped = value < uIsoValue.y; // flipped
                    #else
                        bool flipped = value > uIsoValue.y;
                    #endif
                    interior = value < uIsoValue.x && flipped;
                    #ifndef dDoubleSided
                        if (interior) {
                            prevValue = value;
                            pos += step;
                            continue;
                        }
                    #endif
                    vec3 vViewPosition = mvPosition.xyz;
                    vec4 material = vec4(color, uAlpha);

                    #ifdef dIgnoreLight
                        gl_FragColor = material;
                    #else
                        #if defined(dFlatShaded)
                            // nearest grid point
                            isoPos = floor(isoPos * uGridDim + 0.5) / uGridDim;
                        #endif
                        #ifdef dPackedGroup
                            // compute gradient by central differences
                            gradient.x = textureVal(isoPos - dx).a - textureVal(isoPos + dx).a;
                            gradient.y = textureVal(isoPos - dy).a - textureVal(isoPos + dy).a;
                            gradient.z = textureVal(isoPos - dz).a - textureVal(isoPos + dz).a;
                        #else
                            gradient = textureVal(isoPos).xyz * 2.0 - 1.0;
                        #endif
                        vec3 normal = -normalize(normalMatrix * normalize(gradient));
                        normal = normal * (float(flipped) * 2.0 - 1.0);
                        normal = normal * -(float(interior) * 2.0 - 1.0);
                        #include apply_light_color
                    #endif

                    float vMarker = readFromTexture(tMarker, vInstance * float(uGroupCount) + group, uMarkerTexDim).a;
                    #include apply_interior_color
                    #include apply_marker_color

                    preFogAlphaBlended = (1.0 - preFogAlphaBlended) * gl_FragColor.a + preFogAlphaBlended;
                    fragmentDepth = depth;
                    #include apply_fog

                    src = gl_FragColor;

                    if (!uTransparentBackground) {
                        // done in 'apply_fog' otherwise
                        src.rgb *= src.a;
                    }
                    dst = (1.0 - dst.a) * src + dst; // standard blending
                #endif

                #ifdef dSingleLayer
                    break;
                #endif

                hit = true;
            }
            prevValue = value;
        #elif defined(dRenderMode_volume)
            vec4 mvPosition = modelViewTransform * vec4(unitPos * uGridDim, 1.0);
            if (calcDepth(mvPosition.xyz) > getDepth(gl_FragCoord.xy / uDrawingBufferSize))
                break;

            #if defined(dClipVariant_pixel) && dClipObjectCount != 0
                vec3 vModelPosition = v3m4(unitPos * uGridDim, modelTransform);
                if (clipTest(vec4(vModelPosition, 0.0), 0)) {
                    prevValue = value;
                    pos += step;
                    continue;
                }
            #endif

            #if defined(dRenderVariant_color)
                vec3 vViewPosition = mvPosition.xyz;
                vec4 material = transferFunction(value);

                #ifdef dIgnoreLight
                    gl_FragColor.rgb = material.rgb;
                #else
                    if (material.a >= 0.01) {
                        #ifdef dPackedGroup
                            // compute gradient by central differences
                            gradient.x = textureVal(unitPos - dx).a - textureVal(unitPos + dx).a;
                            gradient.y = textureVal(unitPos - dy).a - textureVal(unitPos + dy).a;
                            gradient.z = textureVal(unitPos - dz).a - textureVal(unitPos + dz).a;
                        #else
                            gradient = cell.xyz * 2.0 - 1.0;
                        #endif
                        vec3 normal = -normalize(normalMatrix * normalize(gradient));
                        #include apply_light_color
                    } else {
                        gl_FragColor.rgb = material.rgb;
                    }
                #endif

                gl_FragColor.a = material.a * uAlpha * uTransferScale;

                #ifdef dPackedGroup
                    float group = decodeFloatRGB(textureGroup(floor(unitPos * uGridDim + 0.5) / uGridDim).rgb);
                #else
                    vec3 g = floor(unitPos * uGridDim + 0.5);
                    float group = g.z + g.y * uGridDim.z + g.x * uGridDim.z * uGridDim.y;
                #endif

                float vMarker = readFromTexture(tMarker, vInstance * float(uGroupCount) + group, uMarkerTexDim).a;
                #include apply_marker_color

                preFogAlphaBlended = (1.0 - preFogAlphaBlended) * gl_FragColor.a + preFogAlphaBlended;
                fragmentDepth = calcDepth(mvPosition.xyz);
                #include apply_fog

                src = gl_FragColor;

                if (!uTransparentBackground) {
                    // done in 'apply_fog' otherwise
                    src.rgb *= src.a;
                }
                dst = (1.0 - dst.a) * src + dst; // standard blending
            #endif
        #endif

        // break if the color is opaque enough
        if (dst.a > 0.95)
            break;

        pos += step;
    }

    #if defined(dRenderMode_isosurface) && defined(enabledFragDepth)
        // ensure depth is written everywhere
        if (!hit)
            gl_FragDepthEXT = 1.0;
    #endif

    return dst;
}

// TODO: support float texture for higher precision values???
// TODO: support clipping exclusion texture support

void main() {
    if (gl_FrontFacing)
        discard;

    #if defined(dRenderVariant_pick) || defined(dRenderVariant_depth)
        #if defined(dRenderMode_volume)
            // always ignore pick & depth for volume
            discard;
        #elif defined(dRenderMode_isosurface)
            if (uAlpha < uPickingAlphaThreshold)
                discard; // ignore so the element below can be picked
        #endif
    #endif

    vec3 rayDir = mix(normalize(vOrigPos - uCameraPosition), uCameraDir, uIsOrtho);
    vec3 step = rayDir * uStepScale;

    float boundingSphereNear = distance(vBoundingSphere.xyz, uCameraPosition) - vBoundingSphere.w;
    float d = max(uNear, boundingSphereNear) - mix(0.0, distance(vOrigPos, uCameraPosition), uIsOrtho);
    vec3 start = mix(uCameraPosition, vOrigPos, uIsOrtho) + (d * rayDir);
    gl_FragColor = raymarch(start, step, rayDir);

    #if defined(dRenderVariant_pick) || defined(dRenderVariant_depth)
        // discard when nothing was hit
        if (gl_FragColor == vec4(0.0))
            discard;
    #endif

    #if defined(dRenderVariant_color)
        #if defined(dRenderMode_isosurface) && defined(enabledFragDepth)
            float fragmentDepth = gl_FragDepthEXT;
        #else
            float fragmentDepth = calcDepth((uModelView * vec4(start, 1.0)).xyz);
        #endif
        float preFogAlpha = clamp(preFogAlphaBlended, 0.0, 1.0);
        interior = false;
        #include wboit_write
    #endif
}
`,uVe=`
precision highp float;
precision highp int;

#include common
#include common_vert_params

attribute vec3 aPosition;
attribute vec2 aUv;
attribute mat4 aTransform;
attribute float aInstance;

varying vec2 vUv;
varying float vInstance;

void main() {
    #include assign_position

    vUv = aUv;
    vInstance = aInstance;
}
`,lVe=`
precision highp float;
precision highp int;

#include common
#include read_from_texture
#include common_frag_params
#include common_clip
#include wboit_params

uniform vec2 uImageTexDim;
uniform sampler2D tImageTex;
uniform sampler2D tGroupTex;

uniform vec2 uMarkerTexDim;
uniform sampler2D tMarker;

varying vec2 vUv;
varying float vInstance;

#if defined(dInterpolation_catmulrom) || defined(dInterpolation_mitchell) || defined(dInterpolation_bspline)
    #define dInterpolation_cubic
#endif

#if defined(dInterpolation_cubic)
    #if defined(dInterpolation_catmulrom) || defined(dInterpolation_mitchell)
        #if defined(dInterpolation_catmulrom)
            const float B = 0.0;
            const float C = 0.5;
        #elif defined(dInterpolation_mitchell)
            const float B = 0.333;
            const float C = 0.333;
        #endif

        float cubicFilter(float x){
            float f = x;
            if (f < 0.0) {
                f = -f;
            }
            if (f < 1.0) {
                return ((12.0 - 9.0 * B - 6.0 * C) * (f * f * f) +
                    (-18.0 + 12.0 * B + 6.0 * C) * (f * f) +
                    (6.0 - 2.0 * B)) / 6.0;
            }else if (f >= 1.0 && f < 2.0){
                return ((-B - 6.0 * C) * ( f * f * f)
                    + (6.0 * B + 30.0 * C) * (f * f) +
                    (-(12.0 * B) - 48.0 * C) * f +
                    8.0 * B + 24.0 * C) / 6.0;
            }else{
                return 0.0;
            }
        }
    #elif defined(dInterpolation_bspline)
        float cubicFilter(float x) {
            float f = x;
            if (f < 0.0) {
                f = -f;
            }
            if (f >= 0.0 && f <= 1.0){
                return (2.0 / 3.0) + (0.5) * (f * f * f) - (f * f);
            } else if (f > 1.0 && f <= 2.0) {
                return 1.0 / 6.0 * pow((2.0 - f), 3.0);
            }
            return 1.0;
        }
    #endif

    vec4 biCubic(sampler2D tex, vec2 texCoord) {
        vec2 texelSize = 1.0 / uImageTexDim;
        texCoord -= texelSize / 2.0;
        vec4 nSum = vec4(0.0);
        float nDenom = 0.0;
        vec2 cell = fract(texCoord * uImageTexDim);
        for (float m = -1.0; m <= 2.0; ++m) {
            for (float n = -1.0; n <= 2.0; ++n) {
                vec4 vecData = texture2D(tex, texCoord + texelSize * vec2(m, n));
                float c = cubicFilter(m - cell.x) * cubicFilter(-n + cell.y);
                nSum += vecData * c;
                nDenom += c;
            }
        }
        return nSum / nDenom;
    }
#endif

void main() {
    #include clip_pixel

    #if defined(dInterpolation_cubic)
        vec4 imageData = biCubic(tImageTex, vUv);
    #else
        vec4 imageData = texture2D(tImageTex, vUv);
    #endif
    imageData.a = clamp(imageData.a, 0.0, 1.0);
    if (imageData.a > 0.9) imageData.a = 1.0;

    float fragmentDepth = gl_FragCoord.z;
    bool interior = false;

    #if defined(dRenderVariant_pick)
        if (imageData.a < 0.3)
            discard;

        #if defined(dRenderVariant_pickObject)
            gl_FragColor = vec4(encodeFloatRGB(float(uObjectId)), 1.0);
        #elif defined(dRenderVariant_pickInstance)
            gl_FragColor = vec4(encodeFloatRGB(vInstance), 1.0);
        #elif defined(dRenderVariant_pickGroup)
            gl_FragColor = vec4(texture2D(tGroupTex, vUv).rgb, 1.0);
        #endif
    #elif defined(dRenderVariant_depth)
        if (imageData.a < 0.05)
            discard;

        gl_FragColor = packDepthToRGBA(gl_FragCoord.z);
    #elif defined(dRenderVariant_color)
        if (imageData.a < 0.05)
            discard;

        gl_FragColor = imageData;
        gl_FragColor.a *= uAlpha;

        float group = decodeFloatRGB(texture2D(tGroupTex, vUv).rgb);
        float vMarker = readFromTexture(tMarker, vInstance * float(uGroupCount) + group, uMarkerTexDim).a;

        #include apply_marker_color
        #include apply_fog
        #include wboit_write
    #endif
}
`,rte=Ka(),cVe={apply_fog:mze,apply_interior_color:gze,apply_light_color:yze,apply_marker_color:bze,assign_clipping_varying:xze,assign_color_varying:Sze,assign_group:Cze,assign_marker_varying:_ze,assign_material_color:wze,assign_position:Eze,assign_size:Aze,check_picking_alpha:Pze,clip_instance:Tze,clip_pixel:Ize,color_frag_params:Mze,color_vert_params:Dze,common_clip:Rze,common_frag_params:kze,common_vert_params:Oze,common:Fze,float_to_rgba:Lze,light_frag_params:Nze,matrix_scale:Bze,normal_frag_params:Uze,read_from_texture:jze,rgba_to_float:zze,size_vert_params:Vze,texture3d_from_1d_trilinear:Hze,texture3d_from_2d_linear:Gze,texture3d_from_2d_nearest:qze,wboit_params:$ze,wboit_write:Wze},dVe=/^(?!\/\/)\s*#include\s+(\S+)/gmi,fVe=/[ \t]*\/\/.*\n/g,hVe=/[ \t]*\/\*[\s\S]*?\*\//g,pVe=/\n{2,}/g;function Sz(e){return e.replace(dVe,function(t,r){var n=cVe[r];if(!n)throw new Error("empty chunk, '"+r+"'");return n}).trim().replace(fVe,`
`).replace(hVe,`
`).replace(pVe,`
`)}function Bn(e,t,r,n,i){return n===void 0&&(n={}),i===void 0&&(i={}),{id:rte(),name:e,vert:Sz(t),frag:Sz(r),extensions:n,outTypes:i}}var vVe=Bn("points",Xze,Yze,{drawBuffers:"optional"}),mVe=Bn("spheres",Kze,Qze,{fragDepth:"required",drawBuffers:"optional"}),gVe=Bn("cylinders",Zze,Jze,{fragDepth:"required",drawBuffers:"optional"}),yVe=Bn("text",eVe,tVe,{standardDerivatives:"required",drawBuffers:"optional"}),bVe=Bn("lines",rVe,nVe,{drawBuffers:"optional"}),nte=Bn("mesh",iVe,aVe,{standardDerivatives:"optional",drawBuffers:"optional"}),xVe=Bn("direct-volume",oVe,sVe,{fragDepth:"optional",drawBuffers:"optional"}),SVe=Bn("image",uVe,lVe,{drawBuffers:"optional"});function CVe(e){if(e===void 0)return"";var t=[];for(var r in e){var n=e[r],i=n.ref.value;if(i!==void 0)if(typeof i=="string")t.push("#define "+r+"_"+i);else if(typeof i=="number")t.push("#define "+r+" "+i);else if(typeof i=="boolean")i&&t.push("#define "+r);else throw new Error("unknown define type")}return t.join(`
`)+`
`}function _Ve(e,t){var r=[];if(t.standardDerivatives&&(r.push("#extension GL_OES_standard_derivatives : enable"),r.push("#define enabledStandardDerivatives")),t.fragDepth){if(e.fragDepth)r.push("#extension GL_EXT_frag_depth : enable"),r.push("#define enabledFragDepth");else if(t.fragDepth==="required")throw new Error("required 'GL_EXT_frag_depth' extension not available")}if(t.drawBuffers){if(e.drawBuffers)r.push("#extension GL_EXT_draw_buffers : require"),r.push("#define requiredDrawBuffers"),r.push("#define gl_FragColor gl_FragData[0]");else if(t.drawBuffers==="required")throw new Error("required 'GL_EXT_draw_buffers' extension not available")}if(t.shaderTextureLod){if(e.shaderTextureLod)r.push("#extension GL_EXT_shader_texture_lod : enable"),r.push("#define enabledShaderTextureLod");else if(t.shaderTextureLod==="required")throw new Error("required 'GL_EXT_shader_texture_lod' extension not available")}return e.depthTexture&&r.push("#define depthTextureSupport"),r.join(`
`)+`
`}var wVe=`#version 300 es
#define attribute in
#define varying out
#define texture2D texture
`,EVe=`
#define varying in
#define texture2D texture
#define texture2DLodEXT textureLod

#define gl_FragColor out_FragData0
#define gl_FragDepthEXT gl_FragDepth

#define depthTextureSupport
`;function AVe(e,t,r,n){var i=["#version 300 es","layout(location = 0) out highp "+(n[0]||"vec4")+" out_FragData0;"];if(r.standardDerivatives&&i.push("#define enabledStandardDerivatives"),r.fragDepth&&i.push("#define enabledFragDepth"),r.drawBuffers){i.push("#define requiredDrawBuffers");for(var a=e.getParameter(e.MAX_DRAW_BUFFERS),o=1,s=a;o<s;++o)i.push("layout(location = "+o+") out highp "+(n[o]||"vec4")+" out_FragData"+o+";")}return r.shaderTextureLod&&i.push("#define enabledShaderTextureLod"),i.push(EVe),i.join(`
`)+`
`}function PVe(e){return e.replace(/gl_FragData\[([0-9]+)\]/g,"out_FragData$1")}function TVe(e,t,r,n){var i=CVe(r),a=Mr(e)?wVe:"",o=Mr(e)?AVe(e,t,n.extensions,n.outTypes):_Ve(t,n.extensions),s=Mr(e)?PVe(n.frag):n.frag;return{id:rte(),name:n.name,vert:""+a+i+n.vert,frag:""+o+i+s,extensions:n.extensions,outTypes:n.outTypes}}function IVe(e,t){switch(t){case"b":case"b[]":return e.BOOL;case"f":case"f[]":return e.FLOAT;case"i":case"i[]":return e.INT;case"v2":case"v2[]":return e.FLOAT_VEC2;case"v3":case"v3[]":return e.FLOAT_VEC3;case"v4":case"v4[]":return e.FLOAT_VEC4;case"m3":case"m3[]":return e.FLOAT_MAT3;case"m4":case"m4[]":return e.FLOAT_MAT4;default:console.error("unknown uniform kind '"+t+"'")}}function MVe(e,t,r){e.uniform1f(t,r)}function DVe(e,t,r){e.uniform1fv(t,r)}function RVe(e,t,r){e.uniform1i(t,r)}function kVe(e,t,r){e.uniform1iv(t,r)}function OVe(e,t,r){e.uniform2fv(t,r)}function FVe(e,t,r){e.uniform3fv(t,r)}function LVe(e,t,r){e.uniform4fv(t,r)}function NVe(e,t,r){e.uniformMatrix3fv(t,!1,r)}function BVe(e,t,r){e.uniformMatrix4fv(t,!1,r)}function Cz(e){switch(e){case"f":return MVe;case"f[]":return DVe;case"i":case"t":case"b":return RVe;case"i[]":case"t[]":case"b[]":return kVe;case"v2":case"v2[]":return OVe;case"v3":case"v3[]":return FVe;case"v4":case"v4[]":return LVe;case"m3":case"m3[]":return NVe;case"m4":case"m4[]":return BVe}}function UVe(e){var t={};return Object.keys(e).forEach(function(r){var n=e[r];n.type==="uniform"?t[r]=Cz(n.kind):n.type==="texture"&&(t[r]=Cz("t"))}),t}function jVe(e){var t={};return Object.keys(e).forEach(function(r){t[r]=L.create(Ph(e[r].ref.value))}),t}var zVe=Ka();function VVe(e,t){switch(t){case"static":return e.STATIC_DRAW;case"dynamic":return e.DYNAMIC_DRAW;case"stream":return e.STREAM_DRAW}}function HVe(e,t){if(t instanceof Uint8Array)return e.UNSIGNED_BYTE;if(t instanceof Int8Array)return e.BYTE;if(t instanceof Uint16Array)return e.UNSIGNED_SHORT;if(t instanceof Int16Array)return e.SHORT;if(t instanceof Uint32Array)return e.UNSIGNED_INT;if(t instanceof Int32Array)return e.INT;if(t instanceof Float32Array)return e.FLOAT;throw new Error("Should nevver happen")}function GVe(e,t){switch(t){case"attribute":return e.ARRAY_BUFFER;case"elements":return e.ELEMENT_ARRAY_BUFFER;case"uniform":return e.UNIFORM_BUFFER}}function _z(e){var t=e.createBuffer();if(t===null)throw new Error("Could not create WebGL buffer");return t}function ite(e,t,r,n){var i=_z(e),a=VVe(e,r),o=GVe(e,n),s=HVe(e,t),u=t.BYTES_PER_ELEMENT,l=t.length;function c(f){e.bindBuffer(o,i),e.bufferData(o,f,a)}c(t);var d=!1;return{id:zVe(),_usageHint:a,_bufferType:o,_dataType:s,_bpe:u,length:l,getBuffer:function(){return i},updateData:c,updateSubData:function(f,h,v){e.bindBuffer(o,i),v-h===f.length?e.bufferSubData(o,0,f):e.bufferSubData(o,h*u,f.subarray(h,h+v))},reset:function(){i=_z(e),c(t)},destroy:function(){d||(e.deleteBuffer(i),d=!0)}}}function qVe(e,t,r){switch(t){case"int32":switch(r){case 1:return e.INT;case 2:return e.INT_VEC2;case 3:return e.INT_VEC3;case 4:return e.INT_VEC4}break;case"float32":switch(r){case 1:return e.FLOAT;case 2:return e.FLOAT_VEC2;case 3:return e.FLOAT_VEC3;case 4:return e.FLOAT_VEC4;case 16:return e.FLOAT_MAT4}break}throw new Error("unknown attribute type for kind '"+t+"' and itemSize '"+r+"'")}function $Ve(e,t,r,n,i,a){a===void 0&&(a="dynamic");var o=t.instancedArrays,s=ite(e,r,a,"attribute"),u=s._bufferType,l=s._dataType,c=s._bpe;return E(E({},s),{bind:function(d){if(e.bindBuffer(u,s.getBuffer()),n===16)for(var f=0;f<4;++f)e.enableVertexAttribArray(d+f),e.vertexAttribPointer(d+f,4,l,!1,4*4*c,f*4*c),o.vertexAttribDivisor(d+f,i);else e.enableVertexAttribArray(d),e.vertexAttribPointer(d,n,l,!1,0,0),o.vertexAttribDivisor(d,i)}})}function WVe(e,t,r){var n=[];return Object.keys(t).forEach(function(i){var a=t[i];a.type==="attribute"&&(n[n.length]=[i,e.resources.attribute(r[i].ref.value,a.itemSize,a.divisor)])}),n}function XVe(e,t,r){r===void 0&&(r="static");var n=ite(e,t,r,"elements");return E(E({},n),{bind:function(){e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,n.getBuffer())}})}var YVe=Ka();function KVe(e,t,r){var n={};return Object.keys(r).forEach(function(i){var a=r[i];if(a.type==="attribute"){var o=e.getAttribLocation(t,i);n[i]=o}else if(a.type==="uniform"||a.type==="texture"){var o=e.getUniformLocation(t,i);n[i]=o}}),n}function QVe(e,t,r){for(var n=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES),i=0;i<n;++i){var a=e.getActiveAttrib(t,i);if(a){var o=a.name,s=a.type;if(o.startsWith("__activeAttribute")||o==="gl_InstanceID"||o==="gl_VertexID")continue;var u=r[o];if(u===void 0)throw new Error("missing 'uniform' or 'texture' with name '"+o+"' in schema");if(u.type!=="attribute")throw new Error("'"+o+"' must be of type 'attribute' but is '"+u.type+"'");var l=qVe(e,u.kind,u.itemSize);if(l!==s)throw new Error("unexpected attribute type for "+o)}}}function ZVe(e,t,r){for(var n=e.getProgramParameter(t,e.ACTIVE_UNIFORMS),i=0;i<n;++i){var a=e.getActiveUniform(t,i);if(a){var o=a.name,s=a.type;if(o.startsWith("__activeUniform"))continue;var u=o.replace(/[[0-9]+\]$/,""),l=r[u];if(l===void 0)throw new Error("missing 'uniform' or 'texture' with name '"+o+"' in schema");if(l.type==="uniform"){var c=IVe(e,l.kind);if(c!==s)throw new Error("unexpected uniform type for "+o)}else if(l.type==="texture"){if(l.kind==="image-float32"||l.kind==="image-uint8"){if(s!==e.SAMPLER_2D)throw new Error("unexpected sampler type for '"+o+"'")}else if((l.kind==="volume-float32"||l.kind==="volume-uint8")&&s!==e.SAMPLER_3D)throw new Error("unexpected sampler type for '"+o+"'")}else throw new Error("'"+o+"' must be of type 'uniform' or 'texture' but is '"+l.type+"'")}}}function JVe(e,t){if(!e.getProgramParameter(t,e.LINK_STATUS))throw new Error(`Could not compile WebGL program. 

`+e.getProgramInfoLog(t))}function WD(e){var t=e.createProgram();if(t===null)throw new Error("Could not create WebGL program");return t}function eHe(e,t,r,n,i){var a=i.defineValues,o=i.shaderCode,s=i.schema,u=WD(e),l=YVe(),c=TVe(e,r,a,o),d=n("vert",c.vert),f=n("frag",c.frag),h,v;function p(){d.attach(u),f.attach(u),e.linkProgram(u),Lr&&JVe(e,u),h=KVe(e,u,s),v=UVe(s),Lr&&(QVe(e,u,s),ZVe(e,u,s))}p();var m=!1;return{id:l,use:function(){t.currentProgramId=l,e.useProgram(u)},setUniforms:function(g){for(var y=0,b=g.length;y<b;++y){var S=g[y],x=S[0],C=S[1];if(C){var w=h[x];w!==null&&v[x](e,w,C.ref.value)}}},bindAttributes:function(g){for(var y=0,b=g.length;y<b;++y){var S=g[y],x=S[0],C=S[1],w=h[x];w!==-1&&C.bind(w)}},bindTextures:function(g,y){for(var b=0,S=g.length;b<S;++b){var x=g[b],C=x[0],w=x[1],A=h[C];A!=null&&(w.bind(b+y),v[C](e,A,b+y))}},reset:function(){u=WD(e),p()},destroy:function(){m||(d.destroy(),f.destroy(),e.deleteProgram(u),m=!0)}}}var tHe=Ka();function rHe(e){for(var t=e.split(`
`),r=0;r<t.length;++r)t[r]=r+1+": "+t[r];return t.join(`
`)}function Aw(e,t){var r=t.type,n=t.source,i=e.createShader(r==="vert"?e.VERTEX_SHADER:e.FRAGMENT_SHADER);if(i===null)throw new Error("Error creating "+r+" shader");if(e.shaderSource(i,n),e.compileShader(i),Lr&&e.getShaderParameter(i,e.COMPILE_STATUS)===!1)throw console.warn("'"+r+"' shader info log '"+e.getShaderInfoLog(i)+`'
`+rHe(n)),new Error("Error compiling "+r+" shader");return i}function nHe(e,t){var r=Aw(e,t);return{id:tHe(),attach:function(n){e.attachShader(n,r)},reset:function(){r=Aw(e,t)},destroy:function(){e.deleteShader(r)}}}function iHe(e,t){return t===void 0&&(t=0),{value:e,usageCount:t}}function aHe(e){return{free:function(){e.usageCount-=1},value:e.value}}function wz(e,t,r){var n=new Map;return{get:function(i){var a=e(i),o=n.get(a);return o||(o=iHe(t(i)),n.set(a,o)),o.usageCount+=1,aHe(o)},clear:function(){n.forEach(function(i,a){i.usageCount<=0&&(i.usageCount<0&&console.warn("Reference usageCount below zero."),r(i.value),n.delete(a))})},get count(){return n.size},dispose:function(){n.forEach(function(i){return r(i.value)}),n.clear()}}}var oHe=Ka();function sHe(e,t){switch(t){case"depth16":return e.DEPTH_COMPONENT16;case"stencil8":return e.STENCIL_INDEX8;case"rgba4":return e.RGBA4;case"depth-stencil":return e.DEPTH_STENCIL;case"depth32f":if(Mr(e))return e.DEPTH_COMPONENT32F;throw new Error("WebGL2 needed for `depth32f` renderbuffer format")}}function uHe(e,t){switch(t){case"depth":return e.DEPTH_ATTACHMENT;case"stencil":return e.STENCIL_ATTACHMENT;case"depth-stencil":return e.DEPTH_STENCIL_ATTACHMENT;case"color0":return e.COLOR_ATTACHMENT0}}function Ez(e){var t=e.createRenderbuffer();if(t===null)throw new Error("Could not create WebGL renderbuffer");return t}function lHe(e,t,r,n,i){var a=Ez(e),o=function(){return e.bindRenderbuffer(e.RENDERBUFFER,a)},s=sHe(e,t),u=uHe(e,r);function l(){o(),e.renderbufferStorage(e.RENDERBUFFER,s,n,i)}l();var c=!1;return{id:oHe(),bind:o,attachFramebuffer:function(d){d.bind(),o(),e.framebufferRenderbuffer(e.FRAMEBUFFER,u,e.RENDERBUFFER,a),Lr&&mF(e)},setSize:function(d,f){n=d,i=f,l()},reset:function(){a=Ez(e),l()},destroy:function(){c||(e.deleteRenderbuffer(a),c=!0)}}}var cHe=Ka();function Az(e){var t=e.vertexArrayObject;if(!t)throw new Error("VertexArrayObject not supported");var r=t.createVertexArray();if(!r)throw new Error("Could not create WebGL vertex array");return r}function Pz(e){var t=e.vertexArrayObject;if(t===null)throw new Error("VertexArrayObject not supported");return t}function dHe(e,t,r,n){var i=cHe(),a=Az(e),o=Pz(e);function s(){o.bindVertexArray(a),n&&n.bind(),t.bindAttributes(r),o.bindVertexArray(null)}s();var u=!1;return{id:i,bind:function(){o.bindVertexArray(a)},update:s,reset:function(){a=Az(e),o=Pz(e),s()},destroy:function(){u||(o.deleteVertexArray(a),u=!0)}}}function fHe(e){return typeof e=="boolean"?e?1:0:typeof e=="number"?e*1e4:S6(e)}function Tz(e){var t=E(E({},e.value),{destroy:function(){e.free()}});return t}function hHe(e,t,r,n){var i={attribute:new Set,elements:new Set,framebuffer:new Set,program:new Set,renderbuffer:new Set,shader:new Set,texture:new Set,vertexArray:new Set};function a(l,c){return i[l].add(c),r.resourceCounts[l]+=1,E(E({},c),{destroy:function(){c.destroy(),i[l].delete(c),r.resourceCounts[l]-=1}})}var o=wz(function(l){return JSON.stringify(l)},function(l){return a("shader",nHe(e,l))},function(l){l.destroy()});function s(l,c){return Tz(o.get({type:l,source:c}))}var u=wz(function(l){var c=[l.shaderCode.id];return Object.keys(l.defineValues).forEach(function(d){return c.push(S6(d),fHe(l.defineValues[d].ref.value))}),Xa(c).toString()},function(l){return a("program",eHe(e,t,n,s,l))},function(l){l.destroy()});return{attribute:function(l,c,d,f){return a("attribute",$Ve(e,n,l,c,d,f))},elements:function(l,c){return a("elements",XVe(e,l,c))},framebuffer:function(){return a("framebuffer",hze(e))},program:function(l,c,d){return Tz(u.get({defineValues:l,shaderCode:c,schema:d}))},renderbuffer:function(l,c,d,f){return a("renderbuffer",lHe(e,l,c,d,f))},shader:s,texture:function(l,c,d,f){return a("texture",YD(e,n,l,c,d,f))},vertexArray:function(l,c,d){return a("vertexArray",dHe(n,l,c,d))},getByteCounts:function(){var l=0;i.texture.forEach(function(f){l+=f.getByteCount()});var c=0;i.attribute.forEach(function(f){c+=f.length*4});var d=0;return i.elements.forEach(function(f){d+=f.length*4}),{texture:l,attribute:c,elements:d}},reset:function(){i.attribute.forEach(function(l){return l.reset()}),i.elements.forEach(function(l){return l.reset()}),i.framebuffer.forEach(function(l){return l.reset()}),i.renderbuffer.forEach(function(l){return l.reset()}),i.shader.forEach(function(l){return l.reset()}),i.program.forEach(function(l){return l.reset()}),i.vertexArray.forEach(function(l){return l.reset()}),i.texture.forEach(function(l){return l.reset()})},destroy:function(){i.attribute.forEach(function(l){return l.destroy()}),i.elements.forEach(function(l){return l.destroy()}),i.framebuffer.forEach(function(l){return l.destroy()}),i.renderbuffer.forEach(function(l){return l.destroy()}),i.shader.forEach(function(l){return l.destroy()}),i.program.forEach(function(l){return l.destroy()}),i.vertexArray.forEach(function(l){return l.destroy()}),i.texture.forEach(function(l){return l.destroy()}),o.clear(),u.clear()}}}var ate=Ka();function pHe(e,t,r,n,i,a,o){i===void 0&&(i=!0),a===void 0&&(a="uint8"),o===void 0&&(o="nearest");var s=t.framebuffer(),u=a==="fp16"?t.texture("image-float16","rgba","fp16",o):a==="float32"?t.texture("image-float32","rgba","float",o):t.texture("image-uint8","rgba","ubyte",o),l=i?Mr(e)?t.renderbuffer("depth32f","depth",r,n):t.renderbuffer("depth16","depth",r,n):null;function c(){u.define(r,n),u.attachFramebuffer(s,"color0"),l&&l.attachFramebuffer(s)}c();var d=!1;return{id:ate(),texture:u,framebuffer:s,getWidth:function(){return r},getHeight:function(){return n},bind:function(){s.bind()},setSize:function(f,h){r===f&&n===h||(r=f,n=h,u.define(r,n),l&&l.setSize(r,n))},reset:function(){c()},destroy:function(){d||(u.destroy(),s.destroy(),l&&l.destroy(),d=!0)}}}function vHe(e){return{id:ate(),texture:nA(e),framebuffer:pze(),getWidth:function(){return 0},getHeight:function(){return 0},bind:function(){e.bindFramebuffer(e.FRAMEBUFFER,null)},setSize:function(){},reset:function(){},destroy:function(){}}}function mHe(e,t){function r(i){try{return e.getContext(i,t)}catch{return null}}var n=r("webgl2")||r("webgl")||r("experimental-webgl");return Lr&&console.log("isWebgl2: "+Mr(n)),n}function ote(e,t){switch(t){case e.NO_ERROR:return"no error";case e.INVALID_ENUM:return"invalid enum";case e.INVALID_VALUE:return"invalid value";case e.INVALID_OPERATION:return"invalid operation";case e.INVALID_FRAMEBUFFER_OPERATION:return"invalid framebuffer operation";case e.OUT_OF_MEMORY:return"out of memory";case e.CONTEXT_LOST_WEBGL:return"context lost"}return"unknown error"}function ste(e){var t=e.getError();if(t!==e.NO_ERROR)throw new Error("WebGL error: '"+ote(e,t)+"'")}function gHe(e){for(var t=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),r=0;r<t;++r)e.activeTexture(e.TEXTURE0+r),e.bindTexture(e.TEXTURE_2D,null),e.bindTexture(e.TEXTURE_CUBE_MAP,null),Mr(e)&&(e.bindTexture(e.TEXTURE_2D_ARRAY,null),e.bindTexture(e.TEXTURE_3D,null));var n=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,n);for(var i=e.getParameter(e.MAX_VERTEX_ATTRIBS),r=0;r<i;++r)e.vertexAttribPointer(r,1,e.FLOAT,!1,0,0);e.bindBuffer(e.ARRAY_BUFFER,null),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null),e.bindRenderbuffer(e.RENDERBUFFER,null),Pw(e)}function Pw(e){e.bindFramebuffer(e.FRAMEBUFFER,null)}var ute=new Uint8Array(1*4);function lte(e,t,r){e.getSyncParameter(t,e.SYNC_STATUS)===e.SIGNALED?(e.deleteSync(t),r()):I6.setImmediate(lte,e,t,r)}function cte(e,t){var r=e.fenceSync(e.SYNC_GPU_COMMANDS_COMPLETE,0);r?I6.setImmediate(lte,e,r,t):(console.warn("Could not create a WebGLSync object"),e.readPixels(0,0,1,1,e.RGBA,e.UNSIGNED_BYTE,ute),t())}var Iz=!1;function yHe(e){return new Promise(function(t){Mr(e)?cte(e,t):(Iz||(console.info("Sync object not supported in WebGL"),Iz=!0),dte(e),t())})}function dte(e){e.bindFramebuffer(e.FRAMEBUFFER,null),e.readPixels(0,0,1,1,e.RGBA,e.UNSIGNED_BYTE,ute)}function XD(e,t,r,n,i,a){if(Lr&&mF(e),a instanceof Uint8Array)e.readPixels(t,r,n,i,e.RGBA,e.UNSIGNED_BYTE,a);else if(a instanceof Float32Array)e.readPixels(t,r,n,i,e.RGBA,e.FLOAT,a);else if(a instanceof Int32Array&&Mr(e))e.readPixels(t,r,n,i,e.RGBA_INTEGER,e.INT,a);else throw new Error("unsupported readPixels buffer type");Lr&&ste(e)}function bHe(e){var t=e.drawingBufferWidth,r=e.drawingBufferHeight,n=new Uint8Array(t*r*4);return Pw(e),e.viewport(0,0,t,r),XD(e,0,0,t,r,n),ov.flipY(ov.create(n,t,r))}function xHe(){return{resourceCounts:{attribute:0,elements:0,framebuffer:0,program:0,renderbuffer:0,shader:0,texture:0,vertexArray:0},drawCount:0,instanceCount:0,instancedDrawCount:0}}function SHe(e,t){var r=this;t===void 0&&(t={});var n=xz(e),i=vze(e),a=xHe(),o=hHe(e,i,a,n),s={maxTextureSize:e.getParameter(e.MAX_TEXTURE_SIZE),max3dTextureSize:Mr(e)?e.getParameter(e.MAX_3D_TEXTURE_SIZE):0,maxRenderbufferSize:e.getParameter(e.MAX_RENDERBUFFER_SIZE),maxDrawBuffers:n.drawBuffers?e.getParameter(n.drawBuffers.MAX_DRAW_BUFFERS):0,maxTextureImageUnits:e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),maxVertexTextureImageUnits:e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS)};if(s.maxVertexTextureImageUnits<8)throw new Error('Need "MAX_VERTEX_TEXTURE_IMAGE_UNITS" >= 8');var u=!1,l=new Kf(0),c;if(Mr(e)){var d=e.createBuffer(),f=void 0,h=void 0,v=!1,p=function(){e.bindBuffer(e.PIXEL_PACK_BUFFER,d),e.getBufferSubData(e.PIXEL_PACK_BUFFER,0,f),e.bindBuffer(e.PIXEL_PACK_BUFFER,null),v=!1,h(),h=void 0,f=void 0};c=function(g,y,b,S,x){return new Promise(function(C,w){if(v){w("Can not call multiple readPixelsAsync at the same time");return}v=!0,e.bindBuffer(e.PIXEL_PACK_BUFFER,d),e.bufferData(e.PIXEL_PACK_BUFFER,b*S*4,e.STREAM_READ),e.readPixels(g,y,b,S,e.RGBA,e.UNSIGNED_BYTE,0),e.bindBuffer(e.PIXEL_PACK_BUFFER,null),h=C,f=x,cte(e,p)})}}else c=function(g,y,b,S,x){return ce(r,void 0,void 0,function(){return de(this,function(C){return XD(e,g,y,b,S,x),[2]})})};var m=new Set;return{gl:e,isWebGL2:Mr(e),get pixelRatio(){var g=typeof window<"u"?window.devicePixelRatio:1;return g*(t.pixelScale||1)},extensions:n,state:i,stats:a,resources:o,get maxTextureSize(){return s.maxTextureSize},get max3dTextureSize(){return s.max3dTextureSize},get maxRenderbufferSize(){return s.maxRenderbufferSize},get maxDrawBuffers(){return s.maxDrawBuffers},get maxTextureImageUnits(){return s.maxTextureImageUnits},namedComputeRenderables:Object.create(null),namedFramebuffers:Object.create(null),namedTextures:Object.create(null),get isContextLost(){return u||e.isContextLost()},contextRestored:l,setContextLost:function(){u=!0},handleContextRestored:function(g){Object.assign(n,xz(e)),i.reset(),i.currentMaterialId=-1,i.currentProgramId=-1,i.currentRenderItemId=-1,o.reset(),m.forEach(function(y){return y.reset()}),g==null||g(),u=!1,l.next(Ln())},createRenderTarget:function(g,y,b,S,x){var C=pHe(e,o,g,y,b,S,x);return m.add(C),E(E({},C),{destroy:function(){C.destroy(),m.delete(C)}})},unbindFramebuffer:function(){return Pw(e)},readPixels:function(g,y,b,S,x){XD(e,g,y,b,S,x)},readPixelsAsync:c,waitForGpuCommandsComplete:function(){return yHe(e)},waitForGpuCommandsCompleteSync:function(){return dte(e)},getDrawingBufferPixelData:function(){return bHe(e)},clear:function(g,y,b,S){Pw(e),i.enable(e.SCISSOR_TEST),i.depthMask(!0),i.colorMask(!0,!0,!0,!0),i.clearColor(g,y,b,S),e.viewport(0,0,e.drawingBufferWidth,e.drawingBufferHeight),e.scissor(0,0,e.drawingBufferWidth,e.drawingBufferHeight),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT)},destroy:function(g){var y;o.destroy(),gHe(e),g!=null&&g.doNotForceWebGLContextLoss||(y=e.getExtension("WEBGL_lose_context"))===null||y===void 0||y.loseContext()}}}function Mr(e){return typeof WebGL2RenderingContext<"u"&&e instanceof WebGL2RenderingContext}function CHe(e){if(Mr(e))return{drawArraysInstanced:e.drawArraysInstanced.bind(e),drawElementsInstanced:e.drawElementsInstanced.bind(e),vertexAttribDivisor:e.vertexAttribDivisor.bind(e),VERTEX_ATTRIB_ARRAY_DIVISOR:e.VERTEX_ATTRIB_ARRAY_DIVISOR};var t=e.getExtension("ANGLE_instanced_arrays");return t===null?null:{drawArraysInstanced:t.drawArraysInstancedANGLE.bind(t),drawElementsInstanced:t.drawElementsInstancedANGLE.bind(t),vertexAttribDivisor:t.vertexAttribDivisorANGLE.bind(t),VERTEX_ATTRIB_ARRAY_DIVISOR:t.VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE}}function _He(e){if(Mr(e))return{FRAGMENT_SHADER_DERIVATIVE_HINT:e.FRAGMENT_SHADER_DERIVATIVE_HINT};var t=e.getExtension("OES_standard_derivatives");return t===null?null:{FRAGMENT_SHADER_DERIVATIVE_HINT:t.FRAGMENT_SHADER_DERIVATIVE_HINT_OES}}function wHe(e){return Mr(e)?{}:e.getExtension("OES_element_index_uint")}function EHe(e){if(Mr(e))return{VERTEX_ARRAY_BINDING:e.VERTEX_ARRAY_BINDING,bindVertexArray:e.bindVertexArray.bind(e),createVertexArray:e.createVertexArray.bind(e),deleteVertexArray:e.deleteVertexArray.bind(e),isVertexArray:e.isVertexArray.bind(e)};var t=e.getExtension("OES_vertex_array_object");return t===null?null:{VERTEX_ARRAY_BINDING:t.VERTEX_ARRAY_BINDING_OES,bindVertexArray:t.bindVertexArrayOES.bind(t),createVertexArray:t.createVertexArrayOES.bind(t),deleteVertexArray:t.deleteVertexArrayOES.bind(t),isVertexArray:t.isVertexArrayOES.bind(t)}}function AHe(e){return Mr(e)?{}:e.getExtension("OES_texture_float")}function PHe(e){return e.getExtension("OES_texture_float_linear")}function THe(e){if(Mr(e))return{HALF_FLOAT:e.HALF_FLOAT};var t=e.getExtension("OES_texture_half_float");return t===null?null:{HALF_FLOAT:t.HALF_FLOAT_OES}}function IHe(e){return e.getExtension("OES_texture_half_float_linear")}function MHe(e){if(Mr(e))return{MIN:e.MIN,MAX:e.MAX};var t=e.getExtension("EXT_blend_minmax");return t===null?null:{MIN:t.MIN_EXT,MAX:t.MAX_EXT}}function DHe(e){return Mr(e)?{}:e.getExtension("EXT_frag_depth")}function RHe(e){if(Mr(e))return e.getExtension("EXT_color_buffer_float")===null?null:(e.getExtension("EXT_float_blend"),{RGBA32F:e.RGBA32F});var t=e.getExtension("WEBGL_color_buffer_float");return t===null?(e.getExtension("OES_texture_float"),fte(e,e.FLOAT)?{RGBA32F:34836}:null):(e.getExtension("EXT_float_blend"),{RGBA32F:t.RGBA32F_EXT})}function kHe(e){if(Mr(e))return e.getExtension("EXT_color_buffer_half_float")===null?null:(e.getExtension("EXT_float_blend"),{RGBA16F:e.RGBA16F});var t=e.getExtension("EXT_color_buffer_half_float");return t===null?(e.getExtension("OES_texture_half_float"),fte(e,36193)?{RGBA16F:34842}:null):(e.getExtension("EXT_float_blend"),{RGBA16F:t.RGBA16F_EXT})}function OHe(e){if(Mr(e))return{drawBuffers:e.drawBuffers.bind(e),COLOR_ATTACHMENT0:e.COLOR_ATTACHMENT0,COLOR_ATTACHMENT1:e.COLOR_ATTACHMENT1,COLOR_ATTACHMENT2:e.COLOR_ATTACHMENT2,COLOR_ATTACHMENT3:e.COLOR_ATTACHMENT3,COLOR_ATTACHMENT4:e.COLOR_ATTACHMENT4,COLOR_ATTACHMENT5:e.COLOR_ATTACHMENT5,COLOR_ATTACHMENT6:e.COLOR_ATTACHMENT6,COLOR_ATTACHMENT7:e.COLOR_ATTACHMENT7,DRAW_BUFFER0:e.DRAW_BUFFER0,DRAW_BUFFER1:e.DRAW_BUFFER1,DRAW_BUFFER2:e.DRAW_BUFFER2,DRAW_BUFFER3:e.DRAW_BUFFER3,DRAW_BUFFER4:e.DRAW_BUFFER4,DRAW_BUFFER5:e.DRAW_BUFFER5,DRAW_BUFFER6:e.DRAW_BUFFER6,DRAW_BUFFER7:e.DRAW_BUFFER7,MAX_COLOR_ATTACHMENTS:e.MAX_COLOR_ATTACHMENTS,MAX_DRAW_BUFFERS:e.MAX_DRAW_BUFFERS};var t=e.getExtension("WEBGL_draw_buffers");return t===null?null:{drawBuffers:t.drawBuffersWEBGL.bind(t),COLOR_ATTACHMENT0:t.COLOR_ATTACHMENT0_WEBGL,COLOR_ATTACHMENT1:t.COLOR_ATTACHMENT1_WEBGL,COLOR_ATTACHMENT2:t.COLOR_ATTACHMENT2_WEBGL,COLOR_ATTACHMENT3:t.COLOR_ATTACHMENT3_WEBGL,COLOR_ATTACHMENT4:t.COLOR_ATTACHMENT4_WEBGL,COLOR_ATTACHMENT5:t.COLOR_ATTACHMENT5_WEBGL,COLOR_ATTACHMENT6:t.COLOR_ATTACHMENT6_WEBGL,COLOR_ATTACHMENT7:t.COLOR_ATTACHMENT7_WEBGL,DRAW_BUFFER0:t.DRAW_BUFFER0_WEBGL,DRAW_BUFFER1:t.DRAW_BUFFER1_WEBGL,DRAW_BUFFER2:t.DRAW_BUFFER2_WEBGL,DRAW_BUFFER3:t.DRAW_BUFFER3_WEBGL,DRAW_BUFFER4:t.DRAW_BUFFER4_WEBGL,DRAW_BUFFER5:t.DRAW_BUFFER5_WEBGL,DRAW_BUFFER6:t.DRAW_BUFFER6_WEBGL,DRAW_BUFFER7:t.DRAW_BUFFER7_WEBGL,MAX_COLOR_ATTACHMENTS:t.MAX_COLOR_ATTACHMENTS_WEBGL,MAX_DRAW_BUFFERS:t.MAX_DRAW_BUFFERS_WEBGL}}function FHe(e){return Mr(e)?{}:e.getExtension("EXT_shader_texture_lod")}function LHe(e){if(Mr(e))return{UNSIGNED_INT_24_8:e.UNSIGNED_INT_24_8};var t=e.getExtension("WEBGL_depth_texture");return t===null?null:{UNSIGNED_INT_24_8:t.UNSIGNED_INT_24_8_WEBGL}}function NHe(e){if(Mr(e))return{FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING:e.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING,SRGB8_ALPHA8:e.SRGB8_ALPHA8,SRGB8:e.SRGB8,SRGB:e.SRGB};var t=e.getExtension("EXT_sRGB");return t===null?null:{FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING:t.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING_EXT,SRGB8_ALPHA8:t.SRGB8_ALPHA8_EXT,SRGB8:t.SRGB_ALPHA_EXT,SRGB:t.SRGB_EXT}}var BHe=`
attribute vec4 aPosition;

void main() {
    gl_Position = aPosition;
}`,UHe=`
precision mediump float;
uniform vec4 uColor;
uniform sampler2D uTexture;

void main() {
    gl_FragColor = texture2D(uTexture, vec2(0.5, 0.5)) * uColor;
}`,jHe=new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]);function fte(e,t){var r=Aw(e,{type:"vert",source:BHe}),n=Aw(e,{type:"frag",source:UHe});if(!r||!n)return!1;var i=WD(e);e.attachShader(i,r),e.attachShader(i,n),e.linkProgram(i),e.useProgram(i);var a=e.getAttribLocation(i,"aPosition"),o=e.getUniformLocation(i,"uColor");if(!o)return Lr&&console.log("error getting 'uColor' uniform location"),!1;var s=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,s),e.bufferData(e.ARRAY_BUFFER,jHe,e.STATIC_DRAW),e.enableVertexAttribArray(a),e.vertexAttribPointer(a,2,e.FLOAT,!1,0,0);var u=e.createTexture(),l=new Uint8Array([255,255,255,255]);e.bindTexture(e.TEXTURE_2D,u),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,l);var c=e.createTexture();e.bindTexture(e.TEXTURE_2D,c),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,1,1,0,e.RGBA,t,null),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST);var d=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,d),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,c,0);var f=e.checkFramebufferStatus(e.FRAMEBUFFER);if(f!==e.FRAMEBUFFER_COMPLETE)return Lr&&console.log("error creating framebuffer for '"+t+"'"),!1;e.bindTexture(e.TEXTURE_2D,u),e.uniform4fv(o,[0,10,20,1]),e.drawArrays(e.TRIANGLES,0,6),e.bindTexture(e.TEXTURE_2D,c),e.bindFramebuffer(e.FRAMEBUFFER,null),e.clearColor(1,0,0,1),e.clear(e.COLOR_BUFFER_BIT),e.uniform4fv(o,[0,1/10,1/20,1]),e.drawArrays(e.TRIANGLES,0,6);var h=new Uint8Array(4);if(e.readPixels(0,0,1,1,e.RGBA,e.UNSIGNED_BYTE,h),h[0]!==0||h[1]<248||h[2]<248||h[3]<254)return Lr&&console.log("not able to actually render to '"+t+"' texture"),!1;if(t===e.FLOAT){e.bindFramebuffer(e.FRAMEBUFFER,d);var v=new Float32Array(4);e.readPixels(0,0,1,1,e.RGBA,e.FLOAT,v);var p=e.getError();if(p)return Lr&&console.log("error reading float pixels: '"+ote(e,p)+"'"),!1}return!0}var hte=Ka();function zHe(e,t){switch(t){case"image-uint8":return e.TEXTURE_2D;case"image-float32":return e.TEXTURE_2D;case"image-float16":return e.TEXTURE_2D;case"image-depth":return e.TEXTURE_2D}if(Mr(e))switch(t){case"image-int32":return e.TEXTURE_2D;case"volume-uint8":return e.TEXTURE_3D;case"volume-float32":return e.TEXTURE_3D;case"volume-float16":return e.TEXTURE_3D}throw new Error("unknown texture kind '"+t+"'")}function pte(e,t,r){switch(t){case"alpha":return Mr(e)&&r==="float"?e.RED:Mr(e)&&r==="int"?e.RED_INTEGER:e.ALPHA;case"rgb":return Mr(e)&&r==="int"?e.RGB_INTEGER:e.RGB;case"rgba":return Mr(e)&&r==="int"?e.RGBA_INTEGER:e.RGBA;case"depth":return e.DEPTH_COMPONENT}}function VHe(e,t,r){if(Mr(e))switch(t){case"alpha":switch(r){case"ubyte":return e.ALPHA;case"float":return e.R32F;case"fp16":return e.R16F;case"int":return e.R32I}case"rgb":switch(r){case"ubyte":return e.RGB;case"float":return e.RGB32F;case"fp16":return e.RGB16F;case"int":return e.RGB32I}case"rgba":switch(r){case"ubyte":return e.RGBA;case"float":return e.RGBA32F;case"fp16":return e.RGBA16F;case"int":return e.RGBA32I}case"depth":switch(r){case"ushort":return e.DEPTH_COMPONENT16;case"float":return e.DEPTH_COMPONENT32F}}return pte(e,t,r)}function HHe(e,t,r,n,i){var a=GHe(e)*qHe(t);return a*r*n*(i||1)}function GHe(e){switch(e){case"alpha":return 1;case"rgb":return 3;case"rgba":return 4;case"depth":return 4}}function qHe(e){switch(e){case"ubyte":return 1;case"ushort":return 2;case"float":return 4;case"fp16":return 2;case"int":return 4}}function $He(e,t,r){switch(r){case"ubyte":return e.UNSIGNED_BYTE;case"ushort":return e.UNSIGNED_SHORT;case"float":return e.FLOAT;case"fp16":if(t.textureHalfFloat)return t.textureHalfFloat.HALF_FLOAT;throw new Error('extension "texture_half_float" unavailable');case"int":if(Mr(e))return e.INT;throw new Error('texture type "int" requires webgl2')}}function Mz(e,t){switch(t){case"nearest":return e.NEAREST;case"linear":return e.LINEAR}}function nS(e,t,r){switch(r){case"depth":return e.DEPTH_ATTACHMENT;case"stencil":return e.STENCIL_ATTACHMENT;case"color0":case 0:return e.COLOR_ATTACHMENT0}if(t.drawBuffers)switch(r){case"color1":case 1:return t.drawBuffers.COLOR_ATTACHMENT1;case"color2":case 2:return t.drawBuffers.COLOR_ATTACHMENT2;case"color3":case 3:return t.drawBuffers.COLOR_ATTACHMENT3;case"color4":case 4:return t.drawBuffers.COLOR_ATTACHMENT4;case"color5":case 5:return t.drawBuffers.COLOR_ATTACHMENT5;case"color6":case 6:return t.drawBuffers.COLOR_ATTACHMENT6;case"color7":case 7:return t.drawBuffers.COLOR_ATTACHMENT7}throw new Error("unknown texture attachment")}function WHe(e){return typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement}function XHe(e,t,r){return t===r.TEXTURE_2D}function YHe(e,t,r){return t===r.TEXTURE_3D}function Dz(e){var t=e.createTexture();if(t===null)throw new Error("Could not create WebGL texture");return t}function YD(e,t,r,n,i,a){var o=hte(),s=Dz(e);if(r.endsWith("float32")&&i!=="float"||r.endsWith("float16")&&i!=="fp16"||r.endsWith("uint8")&&i!=="ubyte"||r.endsWith("int32")&&i!=="int"||r.endsWith("depth")&&i!=="ushort"&&i!=="float")throw new Error("texture kind '"+r+"' and type '"+i+"' are incompatible");var u=zHe(e,r),l=Mz(e,a),c=pte(e,n,i),d=VHe(e,n,i),f=$He(e,t,i);function h(){e.bindTexture(u,s),e.texParameteri(u,e.TEXTURE_MAG_FILTER,l),e.texParameteri(u,e.TEXTURE_MIN_FILTER,l),e.texParameteri(u,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(u,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.bindTexture(u,null)}h();var v=0,p=0,m=0,g,y=!1;function b(C,w,A){if(!(v===C&&p===w&&m===(A||0)))if(v=C,p=w,m=A||0,e.bindTexture(u,s),u===e.TEXTURE_2D)e.texImage2D(u,0,d,v,p,0,c,f,null);else if(Mr(e)&&u===e.TEXTURE_3D&&m!==void 0)e.texImage3D(u,0,d,v,p,m,0,c,f,null);else throw new Error("unknown texture target")}function S(C,w){if(w===void 0&&(w=!1),e.bindTexture(u,s),e.pixelStorei(e.UNPACK_ALIGNMENT,1),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,e.NONE),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),WHe(C))e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!1),e.bindTexture(e.TEXTURE_2D,s),e.texImage2D(e.TEXTURE_2D,0,d,c,f,C);else if(XHe(C,u,e)){var A=C.filter?Mz(e,C.filter):l;e.texParameteri(u,e.TEXTURE_MAG_FILTER,A),e.texParameteri(u,e.TEXTURE_MIN_FILTER,A),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!!C.flipY),w?e.texSubImage2D(u,0,0,0,C.width,C.height,c,f,C.array):(v=C.width,p=C.height,e.texImage2D(u,0,d,v,p,0,c,f,C.array))}else if(Mr(e)&&YHe(C,u,e))e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!1),w?e.texSubImage3D(u,0,0,0,0,C.width,C.height,C.depth,c,f,C.array):(v=C.width,p=C.height,m=C.depth,e.texImage3D(u,0,d,v,p,m,0,c,f,C.array));else throw new Error("unknown texture target");e.bindTexture(u,null),g=C}function x(C,w,A){if(C.bind(),u===e.TEXTURE_2D)e.framebufferTexture2D(e.FRAMEBUFFER,nS(e,t,w),e.TEXTURE_2D,s,0);else if(Mr(e)&&u===e.TEXTURE_3D){if(A===void 0)throw new Error("need `layer` to attach 3D texture");e.framebufferTextureLayer(e.FRAMEBUFFER,nS(e,t,w),s,0,A)}else throw new Error("unknown/unsupported texture target")}return{id:o,target:u,format:c,internalFormat:d,type:f,filter:l,getWidth:function(){return v},getHeight:function(){return p},getDepth:function(){return m},getByteCount:function(){return HHe(n,i,v,p,m)},define:b,load:S,bind:function(C){e.activeTexture(e.TEXTURE0+C),e.bindTexture(u,s)},unbind:function(C){e.activeTexture(e.TEXTURE0+C),e.bindTexture(u,null)},attachFramebuffer:x,detachFramebuffer:function(C,w){if(C.bind(),u===e.TEXTURE_2D)e.framebufferTexture2D(e.FRAMEBUFFER,nS(e,t,w),e.TEXTURE_2D,null,0);else if(Mr(e)&&u===e.TEXTURE_3D)e.framebufferTextureLayer(e.FRAMEBUFFER,nS(e,t,w),null,0,0);else throw new Error("unknown texture target")},reset:function(){s=Dz(e),h();var C=[v,p,m],w=C[0],A=C[1],M=C[2];v=0,p=0,m=0,b(w,A,M),g&&S(g)},destroy:function(){y||(e.deleteTexture(s),y=!0)}}}function KHe(e,t,r){var n=e.resources,i=[];return Object.keys(t).forEach(function(a){var o=t[a];if(o.type==="texture"){var s=r[a];if(s)if(o.kind==="texture")i[i.length]=[a,s.ref.value];else{var u=n.texture(o.kind,o.format,o.dataType,o.filter);u.load(s.ref.value),i[i.length]=[a,u]}}}),i}function Rz(e,t,r){var n=new Image;n.onload=function(){r.load(n),L.update(t,r)},n.src=e}function nA(e){var t,r=(t=e==null?void 0:e.TEXTURE_2D)!==null&&t!==void 0?t:3553;return{id:hte(),target:r,format:0,internalFormat:0,type:0,filter:0,getWidth:function(){return 0},getHeight:function(){return 0},getDepth:function(){return 0},getByteCount:function(){return 0},define:function(){},load:function(){},bind:function(n){e&&(e.activeTexture(e.TEXTURE0+n),e.bindTexture(r,null))},unbind:function(n){e&&(e.activeTexture(e.TEXTURE0+n),e.bindTexture(r,null))},attachFramebuffer:function(){},detachFramebuffer:function(){},reset:function(){},destroy:function(){}}}function xs(e,t,r,n){var i=QHe(e,t,r,n);return r.palette?(L.updateIfChanged(i.dUsePalette,!0),ZHe(r.palette,i.tPalette)):L.updateIfChanged(i.dUsePalette,!1),i}function QHe(e,t,r,n){switch(ha.getGranularity(e,r.granularity)){case"uniform":return eGe(e,r.color,n);case"instance":return tGe(e,r.color,n);case"group":return rGe(e,r.color,n);case"groupInstance":return nGe(e,r.color,n);case"vertex":return iGe(t,r.color,n);case"vertexInstance":return aGe(t,r.color,n);case"volume":return kz(r.grid,"volume",n);case"volumeInstance":return kz(r.grid,"volumeInstance",n)}}function ZHe(e,t){var r=!0,n=t.ref.value;if(e.colors.length!==n.width||n.filter!==e.filter)r=!1;else for(var i=n.array,a=0,o=0,s=e.colors;o<s.length;o++){var u=s[o],l=at.toRgb(u),c=l[0],d=l[1],f=l[2];if(i[a++]!==c||i[a++]!==d||i[a++]!==f){r=!1;break}}if(!r){for(var h=new Uint8Array(e.colors.length*3),v=0,p=0,m=e.colors;p<m.length;p++){var u=m[p],g=at.toRgb(u),c=g[0],d=g[1],f=g[2];h[v++]=c,h[v++]=d,h[v++]=f}L.update(t,{array:h,height:1,width:e.colors.length,filter:e.filter})}}function JHe(e,t){return t?(L.update(t.uColor,at.toVec3Normalized(t.uColor.ref.value,e)),L.updateIfChanged(t.dColorType,"uniform"),t):{uColor:L.create(at.toVec3Normalized(_(),e)),tColor:L.create({array:new Uint8Array(3),width:1,height:1}),tColorGrid:L.create(nA()),tPalette:L.create({array:new Uint8Array(3),width:1,height:1}),uColorTexDim:L.create(He.create(1,1)),uColorGridDim:L.create(_.create(1,1,1)),uColorGridTransform:L.create(Ir.create(0,0,0,1)),dColorType:L.create("uniform"),dUsePalette:L.create(!1)}}function eGe(e,t,r){return JHe(t(hs,!1),r)}function R2(e,t,r){return r?(L.update(r.tColor,e),L.update(r.uColorTexDim,He.create(e.width,e.height)),L.updateIfChanged(r.dColorType,t),r):{uColor:L.create(_()),tColor:L.create(e),tColorGrid:L.create(nA()),tPalette:L.create({array:new Uint8Array(3),width:1,height:1}),uColorTexDim:L.create(He.create(e.width,e.height)),uColorGridDim:L.create(_.create(1,1,1)),uColorGridTransform:L.create(Ir.create(0,0,0,1)),dColorType:L.create(t),dUsePalette:L.create(!1)}}function tGe(e,t,r){var n=e.instanceCount,i=Aa(Math.max(1,n),3,Uint8Array,r&&r.tColor.ref.value.array);for(e.reset();e.hasNext;){var a=e.move(),o=a.location,s=a.isSecondary,u=a.instanceIndex;at.toArray(t(o,s),i.array,u*3),e.skipInstance()}return R2(i,"instance",r)}function rGe(e,t,r){var n=e.groupCount,i=Aa(Math.max(1,n),3,Uint8Array,r&&r.tColor.ref.value.array);for(e.reset();e.hasNext&&!e.isNextNewInstance;){var a=e.move(),o=a.location,s=a.isSecondary,u=a.groupIndex;at.toArray(t(o,s),i.array,u*3)}return R2(i,"group",r)}function nGe(e,t,r){var n=e.groupCount,i=e.instanceCount,a=i*n,o=Aa(Math.max(1,a),3,Uint8Array,r&&r.tColor.ref.value.array);for(e.reset();e.hasNext;){var s=e.move(),u=s.location,l=s.isSecondary,c=s.index;at.toArray(t(u,l),o.array,c*3)}return R2(o,"groupInstance",r)}function iGe(e,t,r){var n=e.groupCount,i=e.stride,a=Aa(Math.max(1,n),3,Uint8Array,r&&r.tColor.ref.value.array);for(e.reset(),e.voidInstances();e.hasNext&&!e.isNextNewInstance;)for(var o=e.move(),s=o.location,u=o.isSecondary,l=o.groupIndex,c=t(s,u),d=0;d<i;++d)at.toArray(c,a.array,(l+d)*3);return R2(a,"vertex",r)}function aGe(e,t,r){var n=e.groupCount,i=e.instanceCount,a=e.stride,o=i*n,s=Aa(Math.max(1,o),3,Uint8Array,r&&r.tColor.ref.value.array);for(e.reset();e.hasNext;)for(var u=e.move(),l=u.location,c=u.isSecondary,d=u.index,f=t(l,c),h=0;h<a;++h)at.toArray(f,s.array,(d+h)*3);return R2(s,"vertexInstance",r)}function kz(e,t,r){var n=e.colors,i=e.dimension,a=e.transform,o=n.getWidth(),s=n.getHeight();return r?(L.update(r.tColorGrid,n),L.update(r.uColorTexDim,He.create(o,s)),L.update(r.uColorGridDim,_.clone(i)),L.update(r.uColorGridTransform,Ir.clone(a)),L.updateIfChanged(r.dColorType,t),r):{uColor:L.create(_()),tColor:L.create({array:new Uint8Array(3),width:1,height:1}),tColorGrid:L.create(n),tPalette:L.create({array:new Uint8Array(3),width:1,height:1}),uColorTexDim:L.create(He.create(o,s)),uColorGridDim:L.create(_.clone(i)),uColorGridTransform:L.create(Ir.clone(a)),dColorType:L.create(t),dUsePalette:L.create(!1)}}var Lt;(function(e){function t(b,S,x,C,w,A,M){return M?a(b,S,x,C,w,A,M):i(b,S,x,C,w,A)}e.create=t;function r(b){var S=b?b.vertexBuffer.ref.value:new Float32Array(0),x=b?b.indexBuffer.ref.value:new Uint32Array(0),C=b?b.normalBuffer.ref.value:new Float32Array(0),w=b?b.groupBuffer.ref.value:new Float32Array(0);return t(S,x,C,w,0,0,b)}e.createEmpty=r;function n(b){return Xa([b.vertexCount,b.triangleCount,b.vertexBuffer.ref.version,b.indexBuffer.ref.version,b.normalBuffer.ref.version,b.groupBuffer.ref.version])}function i(b,S,x,C,w,A){var M=Be(),D,k=-1,R=-1,O={kind:"mesh",vertexCount:w,triangleCount:A,vertexBuffer:L.create(b),indexBuffer:L.create(S),normalBuffer:L.create(x),groupBuffer:L.create(C),get boundingSphere(){var H=n(O);if(H!==k){var B=kh(O.vertexBuffer.ref.value,O.vertexCount,1);Be.copy(M,B),k=H}return M},get groupMapping(){return O.groupBuffer.ref.version!==R&&(D=$0(O.groupBuffer.ref.value,O.vertexCount),R=O.groupBuffer.ref.version),D},setBoundingSphere:function(H){Be.copy(M,H),k=n(O)},meta:{}};return O}function a(b,S,x,C,w,A,M){return M.vertexCount=w,M.triangleCount=A,L.update(M.vertexBuffer,b),L.update(M.indexBuffer,S),L.update(M.normalBuffer,x),L.update(M.groupBuffer,C),M}function o(b){var S=b.vertexCount,x=b.triangleCount,C=b.vertexBuffer.ref.value,w=b.indexBuffer.ref.value,A=b.normalBuffer.ref.value.length>=S*3?b.normalBuffer.ref.value:new Float32Array(S*3);A===b.normalBuffer.ref.value&&A.fill(0,0,S*3),Hee(C,w,A,S,x),L.update(b.normalBuffer,A)}e.computeNormals=o;function s(b,S){S===void 0&&(S=3);for(var x=b.vertexBuffer.ref.value,C=new Map,w=function(H,B){return H[0].toFixed(B)+"|"+H[1].toFixed(B)+"|"+H[2].toFixed(B)},A=0,M=_(),D=0,k=b.vertexCount;D<k;++D){_.fromArray(M,x,D*3);var R=w(M,S),O=C.get(R);O!==void 0?(A+=1,C.set(R,O+1)):C.set(R,1)}return A}e.checkForDuplicateVertices=s;var u=Yn();function l(b,S){var x=b.vertexBuffer.ref.value;if(Nv(S,x,0,b.vertexCount),!ue.isTranslationAndUniformScaling(S)){var C=Yn.directionTransform(u,S);gje(C,b.normalBuffer.ref.value,0,b.vertexCount)}L.update(b.vertexBuffer,x)}e.transform=l;function c(b){var S=("kind"in b?b.meta:b.meta.ref.value).originalData;return S}e.getOriginalData=c;function d(b,S){S===void 0&&(S=!0);var x=b.indexBuffer,C=b.vertexBuffer,w=b.groupBuffer,A=b.normalBuffer,M=b.triangleCount,D=b.vertexCount,k=x.ref.value,R=C.ref.value,O=w.ref.value,H=A.ref.value,B=qe.create(Uint32Array,3,1024,M),j=qe.create(Float32Array,3,1024,R);j.currentIndex=D*3,j.elementCount=D;var Y=qe.create(Float32Array,3,1024,H);Y.currentIndex=D*3,Y.elementCount=D;var G=qe.create(Float32Array,1,1024,O);G.currentIndex=D,G.elementCount=D;var $=_(),q=_(),ee=_(),fe=_(),W=_(),X=_();function U(Xe){_.fromArray($,R,Xe*3),_.fromArray(fe,H,Xe*3),qe.add3(j,$[0],$[1],$[2]),qe.add3(Y,fe[0],fe[1],fe[2])}function z(Xe,ct){_.fromArray($,R,Xe*3),_.fromArray(q,R,ct*3),_.scale($,_.add($,$,q),.5),_.fromArray(fe,H,Xe*3),_.fromArray(W,H,ct*3),_.scale(fe,_.add(fe,fe,W),.5),qe.add3(j,$[0],$[1],$[2]),qe.add3(Y,fe[0],fe[1],fe[2])}function J(Xe,ct,Ne){_.fromArray($,R,Xe*3),_.fromArray(q,R,ct*3),_.fromArray(ee,R,Ne*3),_.scale($,_.add($,_.add($,$,q),ee),1/3),_.fromArray(fe,H,Xe*3),_.fromArray(W,H,ct*3),_.fromArray(X,H,Ne*3),_.scale(fe,_.add(fe,_.add(fe,fe,W),X),1/3),qe.add3(j,$[0],$[1],$[2]),qe.add3(Y,fe[0],fe[1],fe[2])}function K(Xe,ct,Ne,Qe,it){++te,U(Xe),z(Xe,ct),z(Xe,Ne),qe.add3(B,Z,Z+1,Z+2);for(var ot=0;ot<3;++ot)qe.add(G,Qe);Z+=3,te+=2,U(ct),U(Ne),z(Xe,ct),z(Xe,Ne),qe.add3(B,Z,Z+1,Z+3),qe.add3(B,Z,Z+3,Z+2);for(var ot=0;ot<4;++ot)qe.add(G,it);Z+=4}var Z=D,te=0;if(S)for(var le=0,ye=M;le<ye;++le){var be=k[le*3],Ae=k[le*3+1],Se=k[le*3+2],ie=O[be],oe=O[Ae],F=O[Se];if(ie===oe&&ie===F)++te,qe.add3(B,be,Ae,Se);else if(ie===oe)K(Se,be,Ae,F,ie);else if(ie===F)K(Ae,Se,be,oe,F);else if(oe===F)K(be,Ae,Se,ie,oe);else{te+=2,U(be),z(be,Ae),z(be,Se),J(be,Ae,Se),qe.add3(B,Z,Z+1,Z+3),qe.add3(B,Z,Z+3,Z+2);for(var V=0;V<4;++V)qe.add(G,ie);Z+=4,te+=2,U(Ae),z(Ae,Se),z(Ae,be),J(be,Ae,Se),qe.add3(B,Z,Z+1,Z+3),qe.add3(B,Z,Z+3,Z+2);for(var V=0;V<4;++V)qe.add(G,oe);Z+=4,te+=2,U(Se),z(Se,Ae),z(Se,be),J(be,Ae,Se),qe.add3(B,Z+3,Z+1,Z),qe.add3(B,Z+2,Z+3,Z);for(var V=0;V<4;++V)qe.add(G,F);Z+=4}}else for(var le=0,ye=M;le<ye;++le){var be=k[le*3],Ae=k[le*3+1],Se=k[le*3+2],ie=O[be],oe=O[Ae],F=O[Se];if(ie!==oe||ie!==F){++te,U(be),U(Ae),U(Se),qe.add3(B,Z,Z+1,Z+2);for(var pe=oe===F?oe:ie,V=0;V<3;++V)qe.add(G,pe);Z+=3}else++te,qe.add3(B,be,Ae,Se)}var we=qe.compact(B),Te=qe.compact(j),ze=qe.compact(Y),Ve=qe.compact(G);return b.vertexCount=Z,b.triangleCount=te,L.update(C,Te),L.update(w,Ve),L.update(x,we),L.update(A,ze),b.meta.originalData={indexBuffer:k,vertexCount:D,triangleCount:M},b}e.uniformTriangleGroup=d,e.Params=E(E({},Et.Params),{doubleSided:I.Boolean(!1,Et.CustomQualityParamInfo),flipSided:I.Boolean(!1,Et.ShadingCategory),flatShaded:I.Boolean(!1,Et.ShadingCategory),ignoreLight:I.Boolean(!1,Et.ShadingCategory),xrayShaded:I.Boolean(!1,Et.ShadingCategory)}),e.Utils={Params:e.Params,createEmpty:r,createValues:h,createValuesSimple:v,updateValues:p,updateBoundingSphere:m,createRenderableState:g,updateRenderableState:y,createPositionIterator:f};function f(b,S){var x=b.vertexCount,C=S.instanceCount.ref.value,w=em(),A=w.position,M=b.vertexBuffer.ref.value,D=S.aTransform.ref.value,k=function(R,O){return O<0?_.fromArray(A,M,R*3):_.transformMat4Offset(A,M,D,0,R*3,O*16),w};return wn(x,C,1,k)}function h(b,S,x,C,w){var A=x.instanceCount,M=x.groupCount,D=f(b,S),k=xs(x,D,C.color),R=au(A*M),O=Ld(),H=Nd(),B=Bd(),j={drawCount:b.triangleCount*3,vertexCount:b.vertexCount,groupCount:M,instanceCount:A},Y=Be.clone(b.boundingSphere),G=Zi(Y,S.aTransform.ref.value,A);return E(E(E(E(E(E(E(E({aPosition:b.vertexBuffer,aNormal:b.normalBuffer,aGroup:b.groupBuffer,elements:b.indexBuffer,boundingSphere:L.create(G),invariantBoundingSphere:L.create(Y),uInvariantBoundingSphere:L.create(Ir.ofSphere(Y))},k),R),O),H),B),S),Et.createValues(w,j)),{dDoubleSided:L.create(w.doubleSided),dFlatShaded:L.create(w.flatShaded),dFlipSided:L.create(w.flipSided),dIgnoreLight:L.create(w.ignoreLight),dXrayShaded:L.create(w.xrayShaded),meta:L.create(b.meta)})}function v(b,S,x,C,w){var A=Et.createSimple(x,C,w),M=E(E({},I.getDefaultValues(e.Params)),S);return h(b,A.transform,A.locationIterator,A.theme,M)}function p(b,S){Et.updateValues(b,S),L.updateIfChanged(b.dDoubleSided,S.doubleSided),L.updateIfChanged(b.dFlatShaded,S.flatShaded),L.updateIfChanged(b.dFlipSided,S.flipSided),L.updateIfChanged(b.dIgnoreLight,S.ignoreLight),L.updateIfChanged(b.dXrayShaded,S.xrayShaded)}function m(b,S){var x=Be.clone(S.boundingSphere),C=Zi(x,b.aTransform.ref.value,b.instanceCount.ref.value);Be.equals(C,b.boundingSphere.ref.value)||L.update(b.boundingSphere,C),Be.equals(x,b.invariantBoundingSphere.ref.value)||(L.update(b.invariantBoundingSphere,x),L.update(b.uInvariantBoundingSphere,Ir.fromSphere(b.uInvariantBoundingSphere.ref.value,x)))}function g(b){var S=Et.createRenderableState(b);return y(S,b),S}function y(b,S){Et.updateRenderableState(b,S),b.opaque=b.opaque&&!S.xrayShaded,b.writeDepth=b.opaque}})(Lt||(Lt={}));var oGe={radius:1,detail:0};function sGe(e,t,r){var n=E(E({},oGe),r),i=n.radius,a=n.detail,o=uGe(),s=o.vertices,u=o.indices;c(a),yje(s,i);var l=new Float32Array(s.length);return Hee(s,u,l,s.length/3,u.length/3),{vertices:new Float32Array(s),normals:new Float32Array(l),indices:new Uint32Array(u)};function c(f){for(var h=_(),v=_(),p=_(),m=0;m<t.length;m+=3)_.fromArray(h,e,t[m+0]*3),_.fromArray(v,e,t[m+1]*3),_.fromArray(p,e,t[m+2]*3),d(h,v,p,f)}function d(f,h,v,p){for(var m=Math.pow(2,p),g=[],y=0;y<=m;++y){g[y]=[];var b=_();_.lerp(b,f,v,y/m);var S=_();_.lerp(S,h,v,y/m);for(var x=m-y,C=0;C<=x;++C)if(C===0&&y===m)g[y][C]=b;else{var w=_();_.lerp(w,b,S,C/x),g[y][C]=w}}for(var y=0;y<m;++y)for(var C=0;C<2*(m-y)-1;++C){var A=Math.floor(C/2);C%2===0?o.add(g[y][A+1],g[y+1][A],g[y][A]):o.add(g[y][A+1],g[y+1][A+1],g[y+1][A])}}}function uGe(){var e=[],t=[],r=new Map;function n(i){var a=i[0].toFixed(5)+"|"+i[1].toFixed(5)+"|"+i[2].toFixed(5),o=r.get(a);return o===void 0&&(o=e.length/3,r.set(a,o),e.push.apply(e,i)),o}return{vertices:e,indices:t,add:function(i,a,o){t.push(n(i),n(a),n(o))}}}var Es=(1+Math.sqrt(5))/2,lGe=[-1,Es,0,1,Es,0,-1,-Es,0,1,-Es,0,0,-1,Es,0,1,Es,0,-1,-Es,0,1,-Es,Es,0,-1,Es,0,1,-Es,0,-1,-Es,0,1],cGe=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],yT;function dGe(){return yT||(yT=rA(lGe,cGe)),yT}var vte=dGe(),fGe=vte.vertices,hGe=vte.indices;function iA(e){return 10*Math.pow(Math.pow(2,e),2)+2}function pGe(e){return sGe(fGe,hGe,{detail:e,radius:1})}var Oz=new Map,vGe=ue.identity();function mGe(e,t,r){return ue.scaleUniformly(e,ue.fromTranslation(e,t),r)}function mte(e){var t=Oz.get(e);return t===void 0&&(t=pGe(e),Oz.set(e,t)),t}function zi(e,t,r,n){wt.addPrimitive(e,mGe(vGe,t,r),mte(n))}var Sl={radiusTop:1,radiusBottom:1,height:1,radialSegments:8,heightSegments:1,topCap:!1,bottomCap:!1,thetaStart:0,thetaLength:Math.PI*2};function gGe(e){var t=E(E({},Sl),e),r=t.radiusTop,n=t.radiusBottom,i=t.height,a=t.radialSegments,o=t.heightSegments,s=t.topCap,u=t.bottomCap,l=t.thetaStart,c=t.thetaLength,d=[],f=[],h=[],v=0,p=[],m=i/2;return g(),s&&r>0&&y(!0),u&&n>0&&y(!1),{vertices:new Float32Array(f),normals:new Float32Array(h),indices:new Uint32Array(d)};function g(){for(var b=_.zero(),S=(n-r)/i,x=0;x<=o;++x){for(var C=[],w=x/o,A=w*(n-r)+r,M=0;M<=a;++M){var D=M/a,k=D*c+l,R=Math.sin(k),O=Math.cos(k);f.push(A*R,-w*i+m,A*O),_.normalize(b,_.set(b,R,S,O)),h.push.apply(h,b),C.push(v++)}p.push(C)}for(var M=0;M<a;++M)for(var x=0;x<o;++x){var H=p[x][M],B=p[x+1][M],j=p[x+1][M+1],Y=p[x][M+1];d.push(H,B,Y),d.push(B,j,Y)}}function y(b){for(var S=b===!0?r:n,x=b===!0?1:-1,C=v,w=1;w<=a;++w)f.push(0,m*x,0),h.push(0,x,0),++v;for(var A=v,w=0;w<=a;++w){var M=w/a,D=M*c+l,k=Math.cos(D),R=Math.sin(D);f.push(S*R,m*x,S*k),h.push(0,x,0),++v}for(var w=0;w<a;++w){var O=C+w,H=A+w;b===!0?d.push(H,H+1,O):d.push(H+1,H,O)}}}var Fz=_(),Lz=_(),go=_(),yo=_(),sl=_(),Rm=_(),yGe={height:1,topCap:!0,bottomCap:!0};function X0(e,t){var r=e.length/3;if(r<3)throw new Error("need at least 3 points to build a prism");var n=E(E({},yGe),t),i=n.height,a=n.topCap,o=n.bottomCap,s=r*2,u=r*4,l=(a?1:0)+(o?1:0);r===3?(s+=l,u+=l*3):r===4?(s+=l*2,u+=l*4):(s+=l*r,u+=l*r*3);var c=W0(s,u),d=i*.5;_.set(Fz,0,0,-d),_.set(Lz,0,0,d);for(var f=0;f<r;++f){var h=(f+1)%r;_.set(go,e[f*3],e[f*3+1],-d),_.set(yo,e[h*3],e[h*3+1],-d),_.set(sl,e[h*3],e[h*3+1],d),_.set(Rm,e[f*3],e[f*3+1],d),c.addQuad(go,yo,sl,Rm)}if(r===3)a&&(_.set(go,e[0],e[1],-d),_.set(yo,e[3],e[4],-d),_.set(sl,e[6],e[7],-d),c.add(sl,yo,go)),o&&(_.set(go,e[0],e[1],d),_.set(yo,e[3],e[4],d),_.set(sl,e[6],e[7],d),c.add(go,yo,sl));else if(r===4)a&&(_.set(go,e[0],e[1],-d),_.set(yo,e[3],e[4],-d),_.set(sl,e[6],e[7],-d),_.set(Rm,e[9],e[10],-d),c.addQuad(Rm,sl,yo,go)),o&&(_.set(go,e[0],e[1],d),_.set(yo,e[3],e[4],d),_.set(sl,e[6],e[7],d),_.set(Rm,e[9],e[10],d),c.addQuad(go,yo,sl,Rm));else for(var f=0;f<r;++f){var h=(f+1)%r;a&&(_.set(go,e[f*3],e[f*3+1],-d),_.set(yo,e[h*3],e[h*3+1],-d),c.add(Fz,yo,go)),o&&(_.set(go,e[f*3],e[f*3+1],d),_.set(yo,e[h*3],e[h*3+1],d),c.add(go,yo,Lz))}return c.getPrimitive()}var bT;function bGe(){return bT||(bT=X0(ac(4,!1))),bT}var xT;function xGe(){return xT||(xT=X0(ac(5,!1))),xT}var ST;function SGe(){return ST||(ST=X0(ac(6,!1))),ST}var CT;function CGe(){return CT||(CT=X0(ac(6,!0))),CT}var _T;function _Ge(){return _T||(_T=X0(ac(7,!1))),_T}var Nz=new Map,Bz=_.create(0,1,0),Ol=_(),iS=_(),Uz=_(),Jf=ue(),jz=ue(),wGe=_(),zz=ue(),vg=_(),wT=_();function Tw(e,t,r,n,i){return _.setMagnitude(iS,r,n/2),_.add(Uz,t,iS),i?_.matchDirection(wT,Bz,iS):_.copy(wT,Bz),ue.fromScaling(zz,_.set(wGe,1,n,1)),_.makeRotation(jz,wT,iS),ue.mul(e,jz,zz),ue.setTranslation(e,Uz)}var ul=new Int32Array(9);function EGe(e){var t,r,n,i,a,o,s,u,l;return ul[0]=Math.round(1e3*((t=e.radiusTop)!==null&&t!==void 0?t:Sl.radiusTop)),ul[1]=Math.round(1e3*((r=e.radiusBottom)!==null&&r!==void 0?r:Sl.radiusBottom)),ul[2]=Math.round(1e3*((n=e.height)!==null&&n!==void 0?n:Sl.height)),ul[3]=(i=e.radialSegments)!==null&&i!==void 0?i:Sl.radialSegments,ul[4]=(a=e.heightSegments)!==null&&a!==void 0?a:Sl.heightSegments,ul[5]=((o=e.topCap)!==null&&o!==void 0?o:Sl.topCap)?1:0,ul[6]=((s=e.bottomCap)!==null&&s!==void 0?s:Sl.bottomCap)?1:0,ul[7]=Math.round(1e3*((u=e.thetaStart)!==null&&u!==void 0?u:Sl.thetaStart)),ul[8]=Math.round(1e3*((l=e.thetaLength)!==null&&l!==void 0?l:Sl.thetaLength)),Xa(ul)}function gF(e){var t=EGe(e),r=Nz.get(t);if(r===void 0){if(e.radialSegments&&e.radialSegments<=4){var n=Math.max(3,e.radialSegments),i=X0(ac(n,!0,e.radiusTop),e);r=hF(i,ue.rotX90)}else r=gGe(e);Nz.set(t,r)}return r}function Ha(e,t,r,n,i){var a=_.distance(t,r)*n;_.sub(Ol,r,t),Tw(Jf,t,Ol,a,!0),wt.addPrimitive(e,Jf,gF(i))}function AGe(e,t,r,n,i,a){var o=_.distance(t,r)*n,s=gF(a);_.sub(Ol,r,t),_.add(vg,t,i),Tw(Jf,vg,Ol,o,!0),wt.addPrimitive(e,Jf,s),_.sub(vg,t,i),Tw(Jf,vg,Ol,o,!0),wt.addPrimitive(e,Jf,s)}function $1(e,t,r,n,i,a){var o=Math.floor(i/2),s=1/i;if(n<1){var u=n/2/i;n+=i%2===1?u:-u}var l=_.distance(t,r)*n,c=gF(a);_.sub(Ol,r,t);for(var d=0;d<o;++d){var f=s*(d*2+1);_.setMagnitude(Ol,Ol,l*f),_.add(vg,t,Ol),Tw(Jf,vg,Ol,l*s,!1),wt.addPrimitive(e,Jf,c)}}var ti=_(),Vz=Yn(),gc=_(),ll=_(),np=_(),aS=_(),Ho=_.fromArray,PGe=_.triangleNormal,Hz=_.copy,oS=_.transformMat4,Gz=_.transformMat3,qz=Yn.directionTransform,fu=qe.add3,ET=qe.add,wt;(function(e){function t(c,d,f){return c===void 0&&(c=2048),d===void 0&&(d=1024),{currentGroup:-1,vertices:qe.create(Float32Array,3,d,f?f.vertexBuffer.ref.value:c),normals:qe.create(Float32Array,3,d,f?f.normalBuffer.ref.value:c),indices:qe.create(Uint32Array,3,d*3,f?f.indexBuffer.ref.value:c*3),groups:qe.create(Float32Array,1,d,f?f.groupBuffer.ref.value:c),mesh:f}}e.createState=t;function r(c,d,f,h){var v=c.vertices,p=c.normals,m=c.indices,g=c.groups,y=c.currentGroup,b=v.elementCount;fu(v,d[0],d[1],d[2]),fu(v,f[0],f[1],f[2]),fu(v,h[0],h[1],h[2]),PGe(ti,d,f,h);for(var S=0;S<3;++S)fu(p,ti[0],ti[1],ti[2]),ET(g,y);fu(m,b,b+1,b+2)}e.addTriangle=r;function n(c,d,f){Ho(np,d,f[0]*3),Ho(aS,d,f[1]*3);for(var h=2,v=f.length;h<v;h+=2)Hz(gc,np),Hz(ll,aS),Ho(np,d,f[h]*3),Ho(aS,d,f[h+1]*3),r(c,gc,ll,np),r(c,ll,aS,np)}e.addTriangleStrip=n;function i(c,d,f){Ho(gc,d,f[0]*3);for(var h=2,v=f.length;h<v;++h)Ho(ll,d,f[h-1]*3),Ho(np,d,f[h]*3),r(c,gc,np,ll)}e.addTriangleFan=i;function a(c,d,f){for(var h=f.vertices,v=f.normals,p=f.indices,m=c.vertices,g=c.normals,y=c.indices,b=c.groups,S=c.currentGroup,x=m.elementCount,C=qz(Vz,d),w=0,A=h.length;w<A;w+=3)oS(ti,Ho(ti,h,w),d),fu(m,ti[0],ti[1],ti[2]),Gz(ti,Ho(ti,v,w),C),fu(g,ti[0],ti[1],ti[2]),ET(b,S);for(var w=0,A=p.length;w<A;w+=3)fu(y,p[w]+x,p[w+1]+x,p[w+2]+x)}e.addPrimitive=a;function o(c,d,f){for(var h=f.vertices,v=f.normals,p=f.indices,m=c.vertices,g=c.normals,y=c.indices,b=c.groups,S=c.currentGroup,x=m.elementCount,C=qz(Vz,d),w=0,A=h.length;w<A;w+=3)oS(ti,Ho(ti,h,w),d),fu(m,ti[0],ti[1],ti[2]),Gz(ti,Ho(ti,v,w),C),fu(g,-ti[0],-ti[1],-ti[2]),ET(b,S);for(var w=0,A=p.length;w<A;w+=3)fu(y,p[w+2]+x,p[w+1]+x,p[w]+x)}e.addPrimitiveFlipped=o;function s(c,d,f,h,v,p){for(var m=f.vertices,g=f.edges,y={radiusTop:h,radiusBottom:h,radialSegments:p},b=0,S=g.length;b<S;b+=2)Ho(gc,m,g[b]*3),Ho(ll,m,g[b+1]*3),oS(gc,gc,d),oS(ll,ll,d),zi(c,gc,h,v),zi(c,ll,h,v),Ha(c,gc,ll,1,y)}e.addCage=s;function u(c,d,f){a(c,d,{vertices:f.vertexBuffer.ref.value.subarray(0,f.vertexCount*3),normals:f.normalBuffer.ref.value.subarray(0,f.vertexCount*3),indices:f.indexBuffer.ref.value.subarray(0,f.triangleCount*3)})}e.addMesh=u;function l(c){var d=c.vertices,f=c.normals,h=c.indices,v=c.groups,p=c.mesh,m=qe.compact(d,!0),g=qe.compact(h,!0),y=qe.compact(f,!0),b=qe.compact(v,!0);return Lt.create(m,g,y,b,c.vertices.elementCount,c.indices.elementCount,p)}e.getMesh=l})(wt||(wt={}));var TGe=1,IGe="Assigns sizes as defined by the shape object.",gte={};function MGe(e){return gte}function yF(e,t){return{factory:yF,granularity:"groupInstance",size:function(r){return no.isLocation(r)?r.shape.getSize(r.group,r.instance):TGe},props:t,description:IGe}}var DGe={name:"shape-group",label:"Shape Group",category:"",factory:yF,getParams:MGe,defaultValues:I.getDefaultValues(gte),isApplicable:function(e){return!!e.shape}},RGe=at(13421772),kGe="Assigns colors as defined by the shape object.",yte={};function OGe(e){return yte}function bF(e,t){return{factory:bF,granularity:"groupInstance",color:function(r){return no.isLocation(r)?r.shape.getColor(r.group,r.instance):RGe},props:t,description:kGe}}var FGe={name:"shape-group",label:"Shape Group",category:"Miscellaneous",factory:bF,getParams:OGe,defaultValues:I.getDefaultValues(yte),isApplicable:function(e){return!!e.shape}},bte=Ka();function Hd(e,t,r){return{id:bte(),materialId:e.materialId,values:t,state:r,render:function(n,i){t.uAlpha&&t.alpha&&L.updateIfChanged(t.uAlpha,Va(t.alpha.ref.value*r.alphaFactor,0,1)),e.render(n,i)},getProgram:function(n){return e.getProgram(n)},update:function(){return e.update()},dispose:function(){return e.destroy()}}}function ta(e,t){return{id:bte(),values:t,render:function(){return e.render("compute")},update:function(){return e.update()},dispose:function(){return e.destroy()}}}var LGe=Ka();function NGe(e,t){var r=e.gl;switch(t){case"points":return r.POINTS;case"lines":return r.LINES;case"line-strip":return r.LINE_STRIP;case"line-loop":return r.LINE_LOOP;case"triangles":return r.TRIANGLES;case"triangle-strip":return r.TRIANGLE_STRIP;case"triangle-fan":return r.TRIANGLE_FAN}}var BGe={colorBlended:"",colorWboit:"",pickObject:"",pickInstance:"",pickGroup:"",depth:""},UGe=Object.keys(BGe),jGe={compute:""},zGe=Object.keys(jGe);function $z(e,t,r,n,i){return r=E(E({},r),{dRenderVariant:L.create(t)}),i.dRenderVariant===void 0&&Object.defineProperty(i,"dRenderVariant",{value:Jt("string")}),e.resources.program(r,n,i)}function VGe(){return{attributes:!1,defines:!1,elements:!1,textures:!1}}function HGe(e){e.attributes=!1,e.defines=!1,e.elements=!1,e.textures=!1}function Gd(e,t,r,n,i,a){return xte(e,t,r,n,i,a,UGe)}function ra(e,t,r,n,i,a){return a===void 0&&(a=-1),xte(e,t,r,n,i,a,zGe)}function xte(e,t,r,n,i,a,o){var s=LGe(),u=e.stats,l=e.state,c=e.resources,d=e.extensions,f=d.instancedArrays,h=d.vertexArrayObject;if(i.uVertexCount){var v=i.uVertexCount.ref.value;i.aVertex=L.create(Js(new Float32Array(v))),n.aVertex=Xr("float32",1,0)}for(var p=rze(n,i),m=p.attributeValues,g=p.defineValues,y=p.textureValues,b=p.uniformValues,S=p.materialUniformValues,x=p.bufferedUniformValues,C=Object.entries(b),w=Object.entries(S),A=Object.entries(x),M=Object.entries(jVe(x)),D=Object.entries(g),k=nze(i),R=NGe(e,t),O={},H=0,B=o;H<B.length;H++){var j=B[H];O[j]=$z(e,j,g,r,n)}var Y=KHe(e,n,y),G=WVe(e,n,m),$,q=i.elements;q&&q.ref.value&&($=c.elements(q.ref.value));for(var ee={},fe=0,W=o;fe<W.length;fe++){var j=W[fe];ee[j]=h?c.vertexArray(O[j],G,$):null}var X=i.drawCount.ref.value,U=i.instanceCount.ref.value;u.drawCount+=X,u.instanceCount+=U,u.instancedDrawCount+=U*X;var z=VGe(),J=!1,K=-1;return{id:s,materialId:a,getProgram:function(Z){return O[Z]},render:function(Z,te){if(!(X===0||U===0||e.isContextLost)){var le=O[Z];if(le.id===K&&l.currentRenderItemId===s)le.setUniforms(C),te&&te.length>0?(le.bindTextures(te,0),le.bindTextures(Y,te.length)):le.bindTextures(Y,0);else{var ye=ee[Z];(le.id!==l.currentProgramId||le.id!==K||a===-1||a!==l.currentMaterialId)&&(le.id!==l.currentProgramId&&le.use(),le.setUniforms(w),l.currentMaterialId=a,K=le.id),le.setUniforms(C),le.setUniforms(M),te&&te.length>0?(le.bindTextures(te,0),le.bindTextures(Y,te.length)):le.bindTextures(Y,0),ye?(ye.bind(),$&&$.bind()):($&&$.bind(),le.bindAttributes(G)),l.currentRenderItemId=s}if(Lr)try{mF(e.gl)}catch(be){throw new Error("Framebuffer error rendering item id "+s+": '"+be+"'")}if($?f.drawElementsInstanced(R,X,$._dataType,0,U):f.drawArraysInstanced(R,0,X,U),Lr)try{ste(e.gl)}catch(be){throw new Error("Draw error rendering item id "+s+": '"+be+"'")}}},update:function(){if(HGe(z),i.aVertex){var Z=i.uVertexCount.ref.value;i.aVertex.ref.value.length<Z&&L.update(i.aVertex,Js(new Float32Array(Z)))}for(var te=0,le=D.length;te<le;++te){var ye=D[te],be=ye[0],Ae=ye[1];Ae.ref.version!==k[be]&&(z.defines=!0,k[be]=Ae.ref.version)}if(z.defines)for(var Se=0,ie=o;Se<ie.length;Se++){var be=ie[Se];O[be].destroy(),O[be]=$z(e,be,g,r,n)}i.drawCount.ref.version!==k.drawCount&&(u.drawCount+=i.drawCount.ref.value-X,u.instancedDrawCount+=U*i.drawCount.ref.value-U*X,X=i.drawCount.ref.value,k.drawCount=i.drawCount.ref.version),i.instanceCount.ref.version!==k.instanceCount&&(u.instanceCount+=i.instanceCount.ref.value-U,u.instancedDrawCount+=i.instanceCount.ref.value*X-U*X,U=i.instanceCount.ref.value,k.instanceCount=i.instanceCount.ref.version);for(var te=0,le=G.length;te<le;++te){var oe=G[te],be=oe[0],F=oe[1],Ae=m[be];if(Ae.ref.version!==k[be]){if(F.length>=Ae.ref.value.length)F.updateSubData(Ae.ref.value,0,F.length);else{F.destroy();var V=n[be],pe=V.itemSize,we=V.divisor;G[te][1]=c.attribute(Ae.ref.value,pe,we),z.attributes=!0}k[be]=Ae.ref.version}}if($&&i.elements.ref.version!==k.elements&&($.length>=i.elements.ref.value.length?$.updateSubData(i.elements.ref.value,0,$.length):($.destroy(),$=c.elements(i.elements.ref.value),z.elements=!0),k.elements=i.elements.ref.version),z.attributes||z.defines||z.elements)for(var Te=0,ze=o;Te<ze.length;Te++){var be=ze[Te],Ve=ee[be];Ve&&Ve.destroy(),ee[be]=h?c.vertexArray(O[be],G,$):null}for(var te=0,le=Y.length;te<le;++te){var Xe=Y[te],be=Xe[0],ct=Xe[1],Ae=y[be];Ae.ref.version!==k[be]&&(n[be].kind!=="texture"?(ct.load(Ae.ref.value),z.textures=!0):Y[te][1]=Ae.ref.value,k[be]=Ae.ref.version)}for(var te=0,le=A.length;te<le;++te){var Ne=A[te],be=Ne[0],Qe=Ne[1];Qe.ref.version!==k[be]&&(L.update(M[te][1],Ph(Qe.ref.value)),k[be]=Qe.ref.version)}return z},destroy:function(){if(!J){for(var Z=0,te=o;Z<te.length;Z++){var le=te[Z];O[le].destroy();var ye=ee[le];ye&&ye.destroy()}Y.forEach(function(be){var Ae=be[0],Se=be[1];n[Ae].kind!=="texture"&&Se.destroy()}),G.forEach(function(be){be[0];var Ae=be[1];return Ae.destroy()}),$&&$.destroy(),u.drawCount-=X,u.instanceCount-=U,u.instancedDrawCount-=U*X,J=!0}}}}var GGe=E(E({},Vd),{aPosition:Xr("float32",3,0),elements:rm("uint32"),uColor:Ge("v3"),uColorTexDim:Ge("v2"),tColor:cr("image-uint8","rgb","ubyte","nearest"),dColorType:Jt("string",["uniform","attribute","instance","group","groupInstance","vertex","vertexInstance"]),uIsoValue:Ge("v2"),uBboxMin:Ge("v3"),uBboxMax:Ge("v3"),uBboxSize:Ge("v3"),uMaxSteps:Ge("i"),uStepScale:Ge("f"),uJumpLength:Ge("f"),uTransform:Ge("m4"),uGridDim:Ge("v3"),dRenderMode:Jt("string",["isosurface","volume"]),dSingleLayer:Jt("boolean"),tTransferTex:cr("image-uint8","rgba","ubyte","linear"),uTransferScale:Ge("f"),dGridTexType:Jt("string",["2d","3d"]),uGridTexDim:Ge("v3"),tGridTex:cr("texture","rgba","ubyte","linear"),uGridStats:Ge("v4"),uCellDim:Ge("v3"),uCartnToUnit:Ge("m4"),uUnitToCartn:Ge("m4"),dPackedGroup:Jt("boolean"),dDoubleSided:Jt("boolean"),dFlipSided:Jt("boolean"),dFlatShaded:Jt("boolean"),dIgnoreLight:Jt("boolean"),dXrayShaded:Jt("boolean")});function qGe(e,t,r,n,i){var a=E(E(E(E({},Ud),jd),zd),GGe);e.isWebGL2||(a.uMaxSteps=Jt("number"));var o={uObjectId:L.create(t)},s=xVe,u=Gd(e,"triangles",s,a,E(E({},r),o),i);return Hd(u,r,n)}var $Ge=E(E({},Vd),{aGroup:Xr("float32",1,0),aPosition:Xr("float32",3,0),aNormal:Xr("float32",3,0),elements:rm("uint32"),dFlatShaded:Jt("boolean"),dDoubleSided:Jt("boolean"),dFlipSided:Jt("boolean"),dIgnoreLight:Jt("boolean"),dXrayShaded:Jt("boolean"),meta:Ai("unknown")});function WGe(e,t,r,n,i){var a=E(E(E(E({},Ud),jd),zd),$Ge),o={uObjectId:L.create(t)},s=nte,u=Gd(e,"triangles",s,a,E(E({},r),o),i);return Hd(u,r,n)}var XGe=E(E(E({},Vd),D2),{aGroup:Xr("float32",1,0),aPosition:Xr("float32",3,0),dPointSizeAttenuation:Jt("boolean"),dPointFilledCircle:Jt("boolean"),uPointEdgeBleach:Ge("f")});function YGe(e,t,r,n,i){var a=E(E(E(E({},Ud),jd),zd),XGe),o={uObjectId:L.create(t)},s=vVe,u=Gd(e,"points",s,a,E(E({},r),o),i);return Hd(u,r,n)}var KGe=E(E(E({},Vd),D2),{aGroup:Xr("float32",1,0),aMapping:Xr("float32",2,0),aStart:Xr("float32",3,0),aEnd:Xr("float32",3,0),elements:rm("uint32"),dLineSizeAttenuation:Jt("boolean"),dDoubleSided:Jt("boolean"),dFlipSided:Jt("boolean")});function QGe(e,t,r,n,i){var a=E(E(E(E({},Ud),jd),zd),KGe),o={uObjectId:L.create(t)},s=bVe,u=Gd(e,"triangles",s,a,E(E({},r),o),i);return Hd(u,r,n)}var ZGe=E(E(E({},Vd),D2),{aGroup:Xr("float32",1,0),aPosition:Xr("float32",3,0),aMapping:Xr("float32",2,0),elements:rm("uint32"),padding:Ai("number"),dDoubleSided:Jt("boolean"),dIgnoreLight:Jt("boolean"),dXrayShaded:Jt("boolean")});function JGe(e,t,r,n,i){var a=E(E(E(E({},Ud),jd),zd),ZGe),o={uObjectId:L.create(t)},s=mVe,u=Gd(e,"triangles",s,a,E(E({},r),o),i);return Hd(u,r,n)}var eqe=E(E(E({},Vd),D2),{aGroup:Xr("float32",1,0),aPosition:Xr("float32",3,0),aMapping:Xr("float32",2,0),aDepth:Xr("float32",1,0),elements:rm("uint32"),aTexCoord:Xr("float32",2,0),tFont:cr("image-uint8","alpha","ubyte","linear"),padding:Ai("number"),uBorderWidth:Ge("f"),uBorderColor:Ge("v3"),uOffsetX:Ge("f"),uOffsetY:Ge("f"),uOffsetZ:Ge("f"),uBackgroundColor:Ge("v3"),uBackgroundOpacity:Ge("f")});function tqe(e,t,r,n,i){var a=E(E(E(E({},Ud),jd),zd),eqe),o={uObjectId:L.create(t)},s=yVe,u=Gd(e,"triangles",s,a,E(E({},r),o),i);return Hd(u,r,n)}var rqe=E(E({},Vd),{uGeoTexDim:Ge("v2","buffered"),tPosition:cr("texture","rgb","float","nearest"),tGroup:cr("texture","alpha","float","nearest"),tNormal:cr("texture","rgb","float","nearest"),dFlatShaded:Jt("boolean"),dDoubleSided:Jt("boolean"),dFlipSided:Jt("boolean"),dIgnoreLight:Jt("boolean"),dXrayShaded:Jt("boolean"),dGeoTexture:Jt("boolean")});function nqe(e,t,r,n,i){var a=E(E(E(E({},Ud),jd),zd),rqe),o={uObjectId:L.create(t)},s=nte,u=Gd(e,"triangles",s,a,E(E({},r),o),i);return Hd(u,r,n)}var iqe=E(E({},Vd),{aGroup:Xr("float32",1,0),aPosition:Xr("float32",3,0),aUv:Xr("float32",2,0),elements:rm("uint32"),uImageTexDim:Ge("v2"),tImageTex:cr("image-uint8","rgba","ubyte","nearest"),tGroupTex:cr("image-uint8","rgba","ubyte","nearest"),dInterpolation:Jt("string",cze)});function aqe(e,t,r,n,i){var a=E(E(E(E({},Ud),jd),zd),iqe),o={uObjectId:L.create(t)},s=SVe,u=Gd(e,"triangles",s,a,E(E({},r),o),i);return Hd(u,r,n)}var oqe=E(E(E({},Vd),D2),{aGroup:Xr("float32",1,0),aStart:Xr("float32",3,0),aEnd:Xr("float32",3,0),aMapping:Xr("float32",3,0),aScale:Xr("float32",1,0),aCap:Xr("float32",1,0),elements:rm("uint32"),padding:Ai("number"),dDoubleSided:Jt("boolean"),dIgnoreLight:Jt("boolean"),dXrayShaded:Jt("boolean")});function sqe(e,t,r,n,i){var a=E(E(E(E({},Ud),jd),zd),oqe),o={uObjectId:L.create(t)},s=gVe,u=Gd(e,"triangles",s,a,E(E({},r),o),i);return Hd(u,r,n)}var uqe=Ka(0,2147483647),qd=Ka(0,2147483647);function Y0(e,t,r,n){return{id:uqe(),type:e,values:t,state:r,materialId:n}}function lqe(e,t){switch(t.type){case"mesh":return WGe(e,t.id,t.values,t.state,t.materialId);case"points":return YGe(e,t.id,t.values,t.state,t.materialId);case"spheres":return JGe(e,t.id,t.values,t.state,t.materialId);case"cylinders":return sqe(e,t.id,t.values,t.state,t.materialId);case"text":return tqe(e,t.id,t.values,t.state,t.materialId);case"lines":return QGe(e,t.id,t.values,t.state,t.materialId);case"direct-volume":return qGe(e,t.id,t.values,t.state,t.materialId);case"image":return aqe(e,t.id,t.values,t.state,t.materialId);case"texture-mesh":return nqe(e,t.id,t.values,t.state,t.materialId)}throw new Error("unsupported type")}var Ur;(function(e){function t(c,d,f,h,v,p,m){return{id:bn.create22(),name:c,sourceData:d,geometry:f,transforms:m||[ue.identity()],get groupCount(){return ha.getGroupCount(f)},getColor:h,getSize:v,getLabel:p}}e.create=t;function r(c){return{color:bF({shape:c},{}),size:yF({shape:c},{})}}e.getTheme=r;function n(c){var d=c.transforms.length,f=no.Location(c),h=function(v,p){return f.group=v,f.instance=p,f};return wn(c.groupCount,d,1,h)}e.groupIterator=n;function i(c,d){for(var f=d&&d.aTransform.ref.value.length>=c.length*16?d.aTransform.ref.value:new Float32Array(c.length*16),h=0,v=c.length;h<v;++h)ue.toArray(c[h],f,h*16);return G6(f,c.length,d)}e.createTransform=i;function a(c,d){var f=e.getTheme(c),h=ha.getUtils(c.geometry),v=qd(),p=n(c),m=e.createTransform(c.transforms),g=h.createValues(c.geometry,m,p,f,d),y=h.createRenderableState(d);return Y0(c.geometry.kind,g,y,v)}e.createRenderObject=a;function o(c){return{kind:"shape-loci",shape:c}}e.Loci=o;function s(c){return!!c&&c.kind==="shape-loci"}e.isLoci=s;function u(c,d){return c.shape===d.shape}e.areLociEqual=u;function l(c){return c.shape.groupCount===0}e.isLociEmpty=l})(Ur||(Ur={}));var no;(function(e){function t(h,v,p){return v===void 0&&(v=0),p===void 0&&(p=0),{kind:"group-location",shape:h,group:v,instance:p}}e.Location=t;function r(h){return!!h&&h.kind==="group-location"}e.isLocation=r;function n(h,v){return{kind:"group-loci",shape:h,groups:v}}e.Loci=n;function i(h){return!!h&&h.kind==="group-loci"}e.isLoci=i;function a(h,v){if(h.shape!==v.shape||h.groups.length!==v.groups.length)return!1;for(var p=0,m=h.groups.length;p<m;++p){var g=h.groups[p],y=g.ids,b=g.instance,S=v.groups[p],x=S.ids,C=S.instance;if(b!==C||!Fe.areEqual(y,x))return!1}return!0}e.areLociEqual=a;function o(h){return s(h)===0}e.isLociEmpty=o;function s(h){for(var v=0,p=0,m=h.groups;p<m.length;p++){var g=m[p];v+=Fe.size(g.ids)}return v}e.size=s;var u=new md,l=_.zero();function c(h,v,p,m){for(var g=v.indices,y=v.offsets,b=function(M,D){Fe.forEach(M,function(k){for(var R=y[k],O=y[k+1];R<O;++R)_.fromArray(l,p,g[R]*3),_.transformMat4(l,l,m[D]),u.includeStep(l)})},S=0,x=h;S<x.length;S++){var C=x[S],w=C.ids,A=C.instance;b(w,A)}}function d(h,v,p,m){for(var g=v.indices,y=v.offsets,b=function(M,D){Fe.forEach(M,function(k){for(var R=y[k],O=y[k+1];R<O;++R)_.fromArray(l,p,g[R]*3),_.transformMat4(l,l,m[D]),u.radiusStep(l)})},S=0,x=h;S<x.length;S++){var C=x[S],w=C.ids,A=C.instance;b(w,A)}}function f(h,v){v||(v=Be()),u.reset();var p=0,m=h.shape,g=m.geometry,y=m.transforms;if(g.kind==="mesh"||g.kind==="points"){var b=g.kind==="mesh"?g.vertexBuffer.ref.value:g.centerBuffer.ref.value;c(h.groups,g.groupMapping,b,y),u.finishedIncludeStep(),d(h.groups,g.groupMapping,b,y)}else if(g.kind==="lines"){var S=g.startBuffer.ref.value,x=g.endBuffer.ref.value;c(h.groups,g.groupMapping,S,y),c(h.groups,g.groupMapping,x,y),u.finishedIncludeStep(),d(h.groups,g.groupMapping,S,y),d(h.groups,g.groupMapping,x,y)}else if(g.kind==="spheres"||g.kind==="text"){var b=g.centerBuffer.ref.value;c(h.groups,g.groupMapping,b,y),u.finishedIncludeStep(),d(h.groups,g.groupMapping,b,y);for(var C=function(O,H){Fe.forEach(O,function(B){var j=h.shape.getSize(B,H);p<j&&(p=j)})},w=0,A=h.groups;w<A.length;w++){var M=A[w],D=M.ids,k=M.instance;C(D,k)}}else return Be.copy(v,g.boundingSphere);return _.copy(v.center,u.center),v.radius=Math.sqrt(u.radiusSq),Be.expand(v,v,p),v}e.getBoundingSphere=f})(no||(no={}));function Ste(e){var t=e&&e.getElement("vertex"),r=e&&e.getElement("material"),n={group:"",vRed:"",vGreen:"",vBlue:"",mRed:"",mGreen:"",mBlue:""},i=[["",""]],a=[["",""]];if(t){for(var o=0,s=t.propertyNames.length;o<s;++o){var u=t.propertyNames[o],l=t.propertyTypes[o];(l==="uchar"||l==="uint8"||l==="ushort"||l==="uint16"||l==="uint"||l==="uint32"||l==="int")&&i.push([u,u]),(l==="uchar"||l==="uint8")&&a.push([u,u])}t.propertyNames.includes("atomid")?n.group="atomid":t.propertyNames.includes("material_index")&&(n.group="material_index"),t.propertyNames.includes("red")&&(n.vRed="red"),t.propertyNames.includes("green")&&(n.vGreen="green"),t.propertyNames.includes("blue")&&(n.vBlue="blue")}var c=[["",""]];if(r){for(var o=0,s=r.propertyNames.length;o<s;++o){var d=r.propertyNames[o],l=r.propertyTypes[o];(l==="uchar"||l==="uint8")&&c.push([d,d])}r.propertyNames.includes("red")&&(n.mRed="red"),r.propertyNames.includes("green")&&(n.mGreen="green"),r.propertyNames.includes("blue")&&(n.mBlue="blue")}var f=n.vRed&&n.vGreen&&n.vBlue?"vertex":n.mRed&&n.mGreen&&n.mBlue?"material":"uniform";return E(E({},Lt.Params),{coloring:I.MappedStatic(f,{vertex:I.Group({red:I.Select(n.vRed,a,{label:"Red Property"}),green:I.Select(n.vGreen,a,{label:"Green Property"}),blue:I.Select(n.vBlue,a,{label:"Blue Property"})},{isFlat:!0}),material:I.Group({red:I.Select(n.mRed,c,{label:"Red Property"}),green:I.Select(n.mGreen,c,{label:"Green Property"}),blue:I.Select(n.mBlue,c,{label:"Blue Property"})},{isFlat:!0}),uniform:I.Group({color:I.Color(pr.grey)},{isFlat:!0})}),grouping:I.MappedStatic(n.group?"vertex":"none",{vertex:I.Group({group:I.Select(n.group,i,{label:"Group Property"})},{isFlat:!0}),none:I.Group({})})})}var Wz=Ste();function cqe(e,t,r,n,i){var a=r.vertices,o=r.normals,s=r.groups,u=n.getProperty("x"),l=n.getProperty("y"),c=n.getProperty("z");if(!u||!l||!c)throw new Error("missing coordinate properties");for(var d=n.getProperty("nx"),f=n.getProperty("ny"),h=n.getProperty("nz"),v=!!d&&!!f&&!!h,p=e;p<t;++p)qe.add3(a,u.value(p),l.value(p),c.value(p)),v&&qe.add3(o,d.value(p),f.value(p),h.value(p)),qe.add(s,i[p])}function dqe(e,t,r,n){for(var i=r.indices,a=e;a<t;++a){var o=n.value(a),s=o.entries,u=o.count;u===3?qe.add3(i,s[0],s[1],s[2]):u===4&&(qe.add3(i,s[2],s[1],s[0]),qe.add3(i,s[2],s[0],s[3]))}}function fqe(e,t,r,n,i){return ce(this,void 0,void 0,function(){var a,o,s,u,l,c,d,f,h,v,p,v,p,m;return de(this,function(g){switch(g.label){case 0:if(a=wt.createState(t.rowCount,t.rowCount/4,i),o=t.getProperty("x"),s=t.getProperty("y"),u=t.getProperty("z"),!o||!s||!u)throw new Error("missing coordinate properties");l=t.getProperty("nx"),c=t.getProperty("ny"),d=t.getProperty("nz"),f=!!l&&!!c&&!!d,h=1e5,v=0,p=t.rowCount,g.label=1;case 1:return v<p?(cqe(v,Math.min(v+h,p),a,t,n),e.shouldUpdate?[4,e.update({message:"adding ply mesh vertices",current:v,max:p})]:[3,3]):[3,4];case 2:g.sent(),g.label=3;case 3:return v+=h,[3,1];case 4:v=0,p=r.rowCount,g.label=5;case 5:return v<p?(dqe(v,Math.min(v+h,p),a,r),e.shouldUpdate?[4,e.update({message:"adding ply mesh faces",current:v,max:p})]:[3,7]):[3,8];case 6:g.sent(),g.label=7;case 7:return v+=h,[3,5];case 8:return m=wt.getMesh(a),f||Lt.computeNormals(m),[2,m]}})})}var yc=ve.Schema.int;function hqe(e,t){for(var r=t.grouping,n=e.rowCount,i=r.name==="vertex"?e.getProperty(r.params.group):void 0,a=r.name==="vertex"?is(r.params.group):"Vertex",o=i?i.toArray({array:Uint32Array}):Js(new Uint32Array(n)),s=i?Ql(o):n-1,u=new Uint32Array(s+1),l=0,c=o.length;l<c;++l)u[o[l]]=l;return{ids:o,map:u,label:a}}function Xz(e,t,r){var n=r.coloring,i=e.rowCount,a,o,s;if(n.name==="vertex")a=e.getProperty(n.params.red)||ve.ofConst(127,i,yc),o=e.getProperty(n.params.green)||ve.ofConst(127,i,yc),s=e.getProperty(n.params.blue)||ve.ofConst(127,i,yc);else if(n.name==="material")a=t&&t.getProperty(n.params.red)||ve.ofConst(127,i,yc),o=t&&t.getProperty(n.params.green)||ve.ofConst(127,i,yc),s=t&&t.getProperty(n.params.blue)||ve.ofConst(127,i,yc);else{var u=at.toRgb(n.params.color),l=u[0],c=u[1],d=u[2];a=ve.ofConst(l,i,yc),o=ve.ofConst(c,i,yc),s=ve.ofConst(d,i,yc)}return{kind:n.name,red:a,green:o,blue:s}}function Yz(e,t,r,n){var i=r.kind,a=r.red,o=r.green,s=r.blue,u=n.ids,l=n.map,c=n.label;return Ur.create("ply-mesh",e,t,function(d){var f=i==="material"?d:l[d];return at.fromRgb(a.value(f),o.value(f),s.value(f))},function(){return 1},function(d){return c+" "+u[d]})}function pqe(){var e=this,t,r,n,i,a,o,s=function(u,l,c,d){return ce(e,void 0,void 0,function(){var f,h,v,p,m;return de(this,function(g){switch(g.label){case 0:if(f=l.getElement("vertex"),!f)throw new Error("missing vertex element");if(h=l.getElement("face"),!h)throw new Error("missing face element");return v=l.getElement("material"),p=!1,m=!1,(!t||t!==l)&&(p=!0),(!r||!I.isParamEqual(Wz.grouping,r.grouping,c.grouping))&&(p=!0),(!r||!I.isParamEqual(Wz.coloring,r.coloring,c.coloring))&&(m=!0),p?(a=Xz(f,v,c),o=hqe(f,c),[4,fqe(u,f,h,o.ids,d&&d.geometry)]):[3,2];case 1:return i=g.sent(),n=Yz(l,i,a,o),[3,3];case 2:m&&(a=Xz(f,v,c),n=Yz(l,i,a,o)),g.label=3;case 3:return t=l,r=Ph(c),[2,n]}})})};return s}function vqe(e,t){var r=this;return $e.create("Shape Provider",function(n){return ce(r,void 0,void 0,function(){return de(this,function(i){return[2,{label:"Mesh",data:e,params:Ste(e),getShape:pqe(),geometryUtils:Lt.Utils}]})})})}function sv(){return sv.empty()}(function(e){function t(i,a){return{size:i,anglesInRadians:a}}e.create=t;function r(){return t(_(),_())}e.empty=r;function n(i,a,o){var s=_.magnitude(i),u=_.magnitude(a),l=_.magnitude(o),c=Math.acos(_.dot(a,o)/(u*l)),d=Math.acos(_.dot(i,o)/(s*l)),f=Math.acos(_.dot(i,a)/(s*u));return s<=0||u<=0||l<=0||c>=Math.PI||d>=Math.PI||f>=Math.PI?r():t(_.create(s,u,l),_.create(c,d,f))}e.fromBasis=n})(sv||(sv={}));var mqe=20.45482949774598;function gqe(e){var t=this;return $e.create("Parse DCD",function(r){return ce(t,void 0,void 0,function(){var n,i,a,o,s,u,l,c,d;return de(this,function(f){switch(f.label){case 0:return[4,r.update("Converting to coordinates")];case 1:for(f.sent(),n=e.header,i=n.DELTA?Bf(n.DELTA*mqe,"ps"):Bf(1,"step"),a=n.ISTART>=1?Bf((n.ISTART-1)*i.value,i.unit):Bf(0,i.unit),o=[],s=0,u=e.frames.length;s<u;++s)l=e.frames[s],c={elementCount:l.elementCount,time:Bf(a.value+i.value*s,i.unit),x:l.x,y:l.y,z:l.z,xyzOrdering:{isIdentity:!0}},l.cell&&(d=l.cell,d[1]>=-1&&d[1]<=1&&d[3]>=-1&&d[3]<=1&&d[4]>=-1&&d[4]<=1?c.cell=sv.create(_.create(d[0],d[2],d[5]),_.create(Jr(90-Math.asin(d[1])*90/N1),Jr(90-Math.asin(d[3])*90/N1),Jr(90-Math.asin(d[4])*90/N1))):d[0]<0||d[1]<0||d[2]<0||d[3]<0||d[4]<0||d[5]<0||d[3]>180||d[4]>180||d[5]>180?c.cell=sv.fromBasis(_.create(d[0],d[1],d[3]),_.create(d[1],d[2],d[4]),_.create(d[3],d[4],d[5])):c.cell=sv.create(_.create(d[0],d[2],d[5]),_.create(Jr(Sn(d[1],0,_n)?90:d[1]),Jr(Sn(d[3],0,_n)?90:d[3]),Jr(Sn(d[4],0,_n)?90:d[4])))),o.push(c);return[2,Gb.create(o,i,a)]}})})})}function Iw(e,t,r,n){for(var i=r,a=n-1,o=t.charCodeAt(i);(o===32||o>=48&&o<=57)&&i<=a;)o=t.charCodeAt(++i);for(o=t.charCodeAt(a);(o===32||o>=48&&o<=57)&&a>=i;)o=t.charCodeAt(--a);if(++a,i===a||i+1===a)return ht.add(e,i,a);if(o=t.charCodeAt(i),i+2===a){var s=t.charCodeAt(i+1);if((o===78||o===110)&&(s===65||s===97)||(o===67||o===99)&&(s===76||s===108)||(o===70||o===102)&&(s===69||s===101)||(o===83||o===115)&&(s===73||s===105)||(o===66||o===98)&&(s===82||s===114)||(o===65||o===97)&&(s===83||s===115))return ht.add(e,i,i+2)}if(o===67||o===99||o===72||o===104||o===78||o===110||o===79||o===111||o===80||o===112||o===83||o===115)return ht.add(e,i,i+1);ht.add(e,i,i)}var yqe=/^[\s\d]+|[\s\d]+$/g;function aA(e){e=e.replace(yqe,"").toUpperCase();var t=e.length;if(t===0||t===1||t===2&&(e==="NA"||e==="CL"||e==="FE"||e==="SI"||e==="BR"||e==="AS"))return e;if(t===3){if(e==="SOD")return"NA";if(e==="POT")return"K";if(e==="CES")return"CS";if(e==="CAL")return"CA";if(e==="CLA")return"CL"}var r=e[0];return r==="C"||r==="H"||r==="N"||r==="O"||r==="P"||r==="S"?r:""}var bqe=[new Set(["CA"]),new Set(["C"]),new Set(["N"])],xqe=[new Set(["P","O3'","O3*"]),new Set(["C4'","C4*"]),new Set(["O2'","O2*","F2'","F2*"])],Sqe=[new Set(["P","O3'","O3*"]),new Set(["C3'","C3*"]),new Set(["O2'","O2*","F2'","F2*"])],Cqe=new Set(["FMN","NCN","FNS","FMA"]),Kz=function(){var e=new Map,t=[{id:"HIS",name:"HISTIDINE",type:"L-peptide linking"},{id:"ARG",name:"ARGININE",type:"L-peptide linking"},{id:"LYS",name:"LYSINE",type:"L-peptide linking"},{id:"ILE",name:"ISOLEUCINE",type:"L-peptide linking"},{id:"PHE",name:"PHENYLALANINE",type:"L-peptide linking"},{id:"LEU",name:"LEUCINE",type:"L-peptide linking"},{id:"TRP",name:"TRYPTOPHAN",type:"L-peptide linking"},{id:"ALA",name:"ALANINE",type:"L-peptide linking"},{id:"MET",name:"METHIONINE",type:"L-peptide linking"},{id:"CYS",name:"CYSTEINE",type:"L-peptide linking"},{id:"ASN",name:"ASPARAGINE",type:"L-peptide linking"},{id:"VAL",name:"VALINE",type:"L-peptide linking"},{id:"GLY",name:"GLYCINE",type:"peptide linking"},{id:"SER",name:"SERINE",type:"L-peptide linking"},{id:"GLN",name:"GLUTAMINE",type:"L-peptide linking"},{id:"TYR",name:"TYROSINE",type:"L-peptide linking"},{id:"ASP",name:"ASPARTIC ACID",type:"L-peptide linking"},{id:"GLU",name:"GLUTAMIC ACID",type:"L-peptide linking"},{id:"THR",name:"THREONINE",type:"L-peptide linking"},{id:"PRO",name:"PROLINE",type:"L-peptide linking"},{id:"SEC",name:"SELENOCYSTEINE",type:"L-peptide linking"},{id:"PYL",name:"PYRROLYSINE",type:"L-peptide linking"},{id:"MSE",name:"SELENOMETHIONINE",type:"L-peptide linking"},{id:"SEP",name:"PHOSPHOSERINE",type:"L-peptide linking"},{id:"TPO",name:"PHOSPHOTHREONINE",type:"L-peptide linking"},{id:"PTR",name:"O-PHOSPHOTYROSINE",type:"L-peptide linking"},{id:"PCA",name:"PYROGLUTAMIC ACID",type:"L-peptide linking"},{id:"A",name:"ADENOSINE-5'-MONOPHOSPHATE",type:"RNA linking"},{id:"C",name:"CYTIDINE-5'-MONOPHOSPHATE",type:"RNA linking"},{id:"T",name:"THYMIDINE-5'-MONOPHOSPHATE",type:"RNA linking"},{id:"G",name:"GUANOSINE-5'-MONOPHOSPHATE",type:"RNA linking"},{id:"I",name:"INOSINIC ACID",type:"RNA linking"},{id:"U",name:"URIDINE-5'-MONOPHOSPHATE",type:"RNA linking"},{id:"DA",name:"2'-DEOXYADENOSINE-5'-MONOPHOSPHATE",type:"DNA linking"},{id:"DC",name:"2'-DEOXYCYTIDINE-5'-MONOPHOSPHATE",type:"DNA linking"},{id:"DT",name:"THYMIDINE-5'-MONOPHOSPHATE",type:"DNA linking"},{id:"DG",name:"2'-DEOXYGUANOSINE-5'-MONOPHOSPHATE",type:"DNA linking"},{id:"DI",name:"2'-DEOXYINOSINE-5'-MONOPHOSPHATE",type:"DNA linking"},{id:"DU",name:"2'-DEOXYURIDINE-5'-MONOPHOSPHATE",type:"DNA linking"}];return t.forEach(function(r){return e.set(r.id,r)}),e}(),Qz=function(){var e=new Map,t=[{id:"ZN2",name:"ZINC ION",type:"Ion"},{id:"SOD",name:"SODIUM ION",type:"Ion"},{id:"CES",name:"CESIUM ION",type:"Ion"},{id:"CLA",name:"CHLORIDE ION",type:"Ion"},{id:"CAL",name:"CALCIUM ION",type:"Ion"},{id:"POT",name:"POTASSIUM ION",type:"Ion"}];return t.forEach(function(r){return e.set(r.id,r)}),e}(),$h=function(){function e(t,r){this.seqId=t,this.atomId=r,this.namesMap=new Map,this.comps=new Map,this.ids=[],this.names=[],this.types=[],this.mon_nstd_flags=[]}return e.prototype.set=function(t){this.comps.set(t.id,t),this.ids.push(t.id),this.names.push(t.name),this.types.push(t.type),this.mon_nstd_flags.push(T2.has(t.id)?"y":"n")},e.prototype.getAtomIds=function(t){for(var r=new Set,n=this.seqId.value(t);t<this.seqId.rowCount;){var i=this.seqId.value(t);if(i!==n)break;r.add(this.atomId.value(t)),t+=1}return r},e.prototype.hasAtomIds=function(t,r){for(var n=0,i=r.length;n<i;++n)if(!gi.areIntersecting(t,r[n]))return!1;return!0},e.prototype.getType=function(t){return this.hasAtomIds(t,bqe)?"peptide linking":this.hasAtomIds(t,xqe)?"RNA linking":this.hasAtomIds(t,Sqe)?"DNA linking":"other"},e.prototype.has=function(t){return this.comps.has(t)},e.prototype.get=function(t){return this.comps.get(t)},e.prototype.add=function(t,r){if(!this.has(t))if(Kz.has(t))this.set(Kz.get(t));else if(GE.has(t))this.set({id:t,name:"WATER",type:"non-polymer"});else if(Cqe.has(t))this.set({id:t,name:this.namesMap.get(t)||t,type:"non-polymer"});else{var n=this.getAtomIds(r);if(n.size===1&&Qz.has(t))this.set(Qz.get(t));else{var i=this.getType(n);this.set({id:t,name:this.namesMap.get(t)||t,type:i})}}return this.get(t)},e.prototype.getChemCompTable=function(){return en.ofPartialColumns(ao.chem_comp,{id:ve.ofStringArray(this.ids),name:ve.ofStringArray(this.names),type:ve.ofStringAliasArray(this.types),mon_nstd_flag:ve.ofStringAliasArray(this.mon_nstd_flags)},this.ids.length)},e.prototype.setNames=function(t){var r=this;t.forEach(function(n){return r.namesMap.set(n[0],n[1])})},e}(),AT="ABCDEFGHIJKLMNOPQRSTUVWXYZ";function _qe(e){for(var t=AT.length,r=e,n=0,i=AT[r%t];r>=t;)r=Math.floor(r/t),i+=AT[r%t],n+=1;return n>=5&&console.warn("getChainId overflow"),i}var KD=eA(_qe),Wh=function(){function e(){this.count=0,this.ids=[],this.types=[],this.descriptions=[],this.compoundsMap=new Map,this.namesMap=new Map,this.heteroMap=new Map,this.chainMap=new Map}return e.prototype.set=function(t,r){this.count+=1,this.ids.push(""+this.count),this.types.push(t),this.descriptions.push([r])},e.prototype.getEntityId=function(t,r,n,i){return r===2?(this.waterId===void 0&&(this.set("water",(i==null?void 0:i.customName)||"Water"),this.waterId=""+this.count),this.waterId):Z6(r)?this.compoundsMap.has(n)?this.compoundsMap.get(n):(this.chainMap.has(n)||(this.set("polymer",(i==null?void 0:i.customName)||"Polymer "+(this.chainMap.size+1)),this.chainMap.set(n,""+this.count)),this.chainMap.get(n)):(this.heteroMap.has(t)||(this.set("non-polymer",(i==null?void 0:i.customName)||this.namesMap.get(t)||t),this.heteroMap.set(t,""+this.count)),this.heteroMap.get(t))},e.prototype.getEntityTable=function(){return en.ofPartialColumns(ao.entity,{id:ve.ofStringArray(this.ids),type:ve.ofStringAliasArray(this.types),pdbx_description:ve.ofStringListArray(this.descriptions)},this.count)},e.prototype.setCompounds=function(t){for(var r=0,n=t.length;r<n;++r){var i=t[r],a=i.chains,o=i.description;this.set("polymer",o);for(var s=0,u=a.length;s<u;++s)this.compoundsMap.set(a[s],""+this.count)}},e.prototype.setNames=function(t){var r=this;t.forEach(function(n){return r.namesMap.set(n[0],n[1])})},e}();function wqe(e,t){for(var r=e.atomName,n=e.residueName,i=new Array(e.count),a=new Array(e.count),o=new Uint32Array(e.count),s=new Uint32Array(e.count),u=new Wh,l=new $h(e.residueNumber,e.atomName),c="",d=0,f="",h=0,v=0,p=-1,m=0,g=e.count;m<g;++m){var y=e.residueNumber.value(m);if(y!==p){var b=e.residueName.value(m),S=H0(l.add(b,m).type,b);(S!==v||y!==p+1&&!(p===99999&&y===0))&&(f=KD(d),d+=1,h=0),c=u.getEntityId(b,S,f),h+=1,p=y,v=S}i[m]=c,a[m]=f,o[m]=h,s[m]=m}var x=ve.ofStringArray(a),C=en.ofPartialColumns(ao.atom_site,{auth_asym_id:x,auth_atom_id:r,auth_comp_id:n,auth_seq_id:e.residueNumber,Cartn_x:ve.ofFloatArray(ve.mapToArray(e.x,function(w){return w*10},Float32Array)),Cartn_y:ve.ofFloatArray(ve.mapToArray(e.y,function(w){return w*10},Float32Array)),Cartn_z:ve.ofFloatArray(ve.mapToArray(e.z,function(w){return w*10},Float32Array)),id:ve.ofIntArray(s),label_asym_id:x,label_atom_id:r,label_comp_id:n,label_seq_id:ve.ofIntArray(o),label_entity_id:ve.ofStringArray(i),occupancy:ve.ofConst(1,e.count,ve.Schema.float),type_symbol:ve.ofStringArray(ve.mapToArray(e.atomName,function(w){return aA(w)})),pdbx_PDB_model_num:ve.ofConst(t,e.count,ve.Schema.int)},e.count);return tm({entity:u.getEntityTable(),chem_comp:l.getChemCompTable(),atom_site:C})}var QD;(function(e){function t(n){return(n==null?void 0:n.kind)==="gro"}e.is=t;function r(n){return{kind:"gro",name:n.structures[0].header.title,data:n}}e.fromGro=r})(QD||(QD={}));function Eqe(e){var t=this;return $e.create("Parse GRO",function(r){return ce(t,void 0,void 0,function(){var n,i,a,o,s,u;return de(this,function(l){switch(l.label){case 0:n=QD.fromGro(e),i=[],a=0,o=e.structures.length,l.label=1;case 1:return a<o?(s=wqe(e.structures[a].atoms,a+1),[4,Od(s,n,r)]):[3,4];case 2:u=l.sent(),u.frameCount===1&&i.push(u.representative),l.label=3;case 3:return++a,[3,1];case 4:return[2,new Ov(i)]}})})})}function Aqe(e,t){var r=function(a,o){return(t.substr(a,o)||"").trim()},n={entry_id:St.ofString(e),length_a:St.ofString(r(6,9)),length_b:St.ofString(r(15,9)),length_c:St.ofString(r(24,9)),angle_alpha:St.ofString(r(33,7)),angle_beta:St.ofString(r(40,7)),angle_gamma:St.ofString(r(47,7)),Z_PDB:St.ofString(r(66,4)),pdbx_unique_axis:St.ofString("?")},i={entry_id:St.ofString(e),"space_group_name_H-M":St.ofString(r(55,11)),Int_Tables_number:St.ofString("?"),cell_setting:St.ofString("?"),space_group_name_Hall:St.ofString("?")};return[ba.ofFields("cell",n),ba.ofFields("symmetry",i)]}function Zz(e,t){return{id:e,details:t,groups:[]}}function Pqe(e,t,r){for(var n=[],i,a,o,s=1,u=1,l=function(X){return e.data.substring(e.indices[2*X],e.indices[2*X+1])},c=t;c<r;c++){var d=l(c);if(d.substr(11,12)==="BIOMOLECULE:"){var f=d.substr(23).trim(),h="Biomolecule "+f;d=l(c+1),d.substr(11,30)!=="APPLY THE FOLLOWING TO CHAINS:"&&(c++,h=d.substr(11).trim()),i=Zz(f,h),n.push(i)}else if(d.substr(13,5)==="BIOMT"){var v=d.split(/\s+/),p=parseInt(d[18])-1;p===0&&(o=ue.identity(),a.operators.push({id:s++,matrix:o})),ue.setValue(o,p,0,parseFloat(v[4])),ue.setValue(o,p,1,parseFloat(v[5])),ue.setValue(o,p,2,parseFloat(v[6])),ue.setValue(o,p,3,parseFloat(v[7]))}else if(d.substr(11,30)==="APPLY THE FOLLOWING TO CHAINS:"||d.substr(11,30)==="                   AND CHAINS:"){d.substr(11,5)==="APPLY"&&(a={chains:[],operators:[]},i.groups.push(a));for(var m=d.substr(41,30).split(","),g=0,y=m.length;g<y;++g){var b=m[g].trim();b&&a.chains.push(b)}}else if(d.substr(11,33)==="APPLYING THE FOLLOWING TO CHAINS:"){i=Zz(""+u,"Biomolecule "+u),n.push(i),u+=1,a={chains:[],operators:[]},i.groups.push(a),c++,d=l(c);for(var m=d.substr(11,69).split(","),g=0,y=m.length;g<y;++g){var b=m[g].trim();b&&a.chains.push(b)}}}if(n.length===0)return[];for(var S={id:St.ofStrings(n.map(function(X){return X.id})),details:St.ofStrings(n.map(function(X){return X.details}))},x=[],C=0,w=n;C<w.length;C++)for(var A=w[C],M=0,D=A.groups;M<D.length;M++){var k=D[M];x.push({assembly_id:A.id,oper_expression:k.operators.map(function(X){return X.id}).join(","),asym_id_list:k.chains.join(",")})}for(var R={assembly_id:St.ofStrings(x.map(function(X){return X.assembly_id})),oper_expression:St.ofStrings(x.map(function(X){return X.oper_expression})),asym_id_list:St.ofStrings(x.map(function(X){return X.asym_id_list}))},O=[],H=0,B=n;H<B.length;H++)for(var A=B[H],j=0,Y=A.groups;j<Y.length;j++)for(var G=Y[j],$=0,q=G.operators;$<q.length;$++){for(var ee=q[$],p={id:""+ee.id,type:"?",name:"?",symmetry_operation:"?"},c=0;c<3;c++){for(var g=0;g<3;g++)p["matrix["+(c+1)+"]["+(g+1)+"]"]=""+ue.getValue(ee.matrix,c,g);p["vector["+(c+1)+"]"]=""+ue.getValue(ee.matrix,c,3)}O.push(p)}for(var fe={id:St.ofStrings(O.map(function(X){return X.id})),type:St.ofStrings(O.map(function(X){return X.type})),name:St.ofStrings(O.map(function(X){return X.name})),symmetry_operation:St.ofStrings(O.map(function(X){return X.symmetry_operation}))},W=function(X){for(var U=function(K){var Z="matrix["+(X+1)+"]["+(K+1)+"]";fe[Z]=St.ofStrings(O.map(function(te){return te[Z]}))},z=0;z<3;z++)U(z);var J="vector["+(X+1)+"]";fe[J]=St.ofStrings(O.map(function(K){return K[J]}))},c=0;c<3;c++)W(c);return[ba.ofFields("pdbx_struct_assembly",S),ba.ofFields("pdbx_struct_assembly_gen",R),ba.ofFields("pdbx_struct_oper_list",fe)]}function Tqe(e,t,r){for(var n=[],i,a=function(y){return e.data.substring(e.indices[2*y],e.indices[2*y+1])},o=t;o<r;o++){var s=a(o),u=s.split(/\s+/),l=parseInt(s[5])-1;l===0&&(i=ue.identity(),n.push(i)),ue.setValue(i,l,0,parseFloat(u[2])),ue.setValue(i,l,1,parseFloat(u[3])),ue.setValue(i,l,2,parseFloat(u[4])),ue.setValue(i,l,3,parseFloat(u[5]))}if(n.length===0)return[];for(var c=[],d=1,f=0,h=n;f<h.length;f++){for(var v=h[f],l={id:"ncsop"+d++,code:".",details:"."},o=0;o<3;o++){for(var p=0;p<3;p++)l["matrix["+(o+1)+"]["+(p+1)+"]"]=""+ue.getValue(v,o,p);l["vector["+(o+1)+"]"]=""+ue.getValue(v,o,3)}c.push(l)}for(var m={id:St.ofStrings(c.map(function(y){return y.id})),code:St.ofStrings(c.map(function(y){return y.code})),details:St.ofStrings(c.map(function(y){return y.details}))},g=function(y){for(var b=function(C){var w="matrix["+(y+1)+"]["+(C+1)+"]";m[w]=St.ofStrings(c.map(function(A){return A[w]}))},S=0;S<3;S++)b(S);var x="vector["+(y+1)+"]";m[x]=St.ofStrings(c.map(function(C){return C[x]}))},o=0;o<3;o++)g(o);return[ba.ofFields("struct_ncs_oper",m)]}var Iqe={1:"HELX_RH_AL_P",2:"HELX_RH_OM_P",3:"HELX_RH_PI_P",4:"HELX_RH_GA_P",5:"HELX_RH_3T_P",6:"HELX_LH_AL_P",7:"HELX_LH_OM_P",8:"HELX_LH_GA_P",9:"HELX_RH_27_P",10:"HELX_RH_PP_P"};function Mqe(e){return Iqe[e]||"HELX_P"}function Dqe(e,t,r){for(var n=[],i=function(f){return e.data.substring(e.indices[2*f],e.indices[2*f+1])},a=t;a<r;a++){var o=i(a);n.push({serNum:o.substr(7,3).trim(),helixID:o.substr(11,3).trim(),initResName:o.substr(15,3).trim(),initChainID:o.substr(19,1).trim(),initSeqNum:o.substr(21,4).trim(),initICode:o.substr(25,1).trim(),endResName:o.substr(27,3).trim(),endChainID:o.substr(31,3).trim(),endSeqNum:o.substr(33,4).trim(),endICode:o.substr(37,1).trim(),helixClass:o.substr(38,2).trim(),comment:o.substr(40,30).trim(),length:o.substr(71,5).trim()})}var s=St.ofStrings(n.map(function(f){return f.initChainID})),u=St.ofStrings(n.map(function(f){return f.initResName})),l=St.ofStrings(n.map(function(f){return f.endChainID})),c=St.ofStrings(n.map(function(f){return f.endResName})),d={beg_label_asym_id:s,beg_label_comp_id:u,beg_label_seq_id:St.ofUndefined(n.length,ve.Schema.int),beg_auth_asym_id:s,beg_auth_comp_id:u,beg_auth_seq_id:St.ofStrings(n.map(function(f){return f.initSeqNum})),conf_type_id:St.ofStrings(n.map(function(f){return Mqe(f.helixClass)})),details:St.ofStrings(n.map(function(f){return f.comment})),end_label_asym_id:l,end_label_comp_id:c,end_label_seq_id:St.ofUndefined(n.length,ve.Schema.int),end_auth_asym_id:l,end_auth_comp_id:c,end_auth_seq_id:St.ofStrings(n.map(function(f){return f.endSeqNum})),id:St.ofStrings(n.map(function(f){return f.serNum})),pdbx_beg_PDB_ins_code:St.ofStrings(n.map(function(f){return f.initICode})),pdbx_end_PDB_ins_code:St.ofStrings(n.map(function(f){return f.endICode})),pdbx_PDB_helix_class:St.ofStrings(n.map(function(f){return f.helixClass})),pdbx_PDB_helix_length:St.ofStrings(n.map(function(f){return f.length})),pdbx_PDB_helix_id:St.ofStrings(n.map(function(f){return f.helixID}))};return ba.ofFields("struct_conf",d)}function Rqe(e,t,r){for(var n=[],i=function(v){return e.data.substring(e.indices[2*v],e.indices[2*v+1])},a=t;a<r;a++){var o=i(a);n.push({strand:o.substr(7,3).trim(),sheetID:o.substr(11,3).trim(),numStrands:o.substr(14,2).trim(),initResName:o.substr(17,3).trim(),initChainID:o.substr(21,1).trim(),initSeqNum:o.substr(22,4).trim(),initICode:o.substr(26,1).trim(),endResName:o.substr(28,3).trim(),endChainID:o.substr(32,1).trim(),endSeqNum:o.substr(33,4).trim(),endICode:o.substr(37,1).trim(),sense:o.substr(38,2).trim(),curAtom:o.substr(41,4).trim(),curResName:o.substr(45,3).trim(),curChainId:o.substr(49,1).trim(),curResSeq:o.substr(50,4).trim(),curICode:o.substr(54,1).trim(),prevAtom:o.substr(56,4).trim(),prevResName:o.substr(60,3).trim(),prevChainId:o.substr(64,1).trim(),prevResSeq:o.substr(65,4).trim(),prevICode:o.substr(69,1).trim()})}var s=St.ofStrings(n.map(function(v){return v.initChainID})),u=St.ofStrings(n.map(function(v){return v.initResName})),l=St.ofStrings(n.map(function(v){return v.initSeqNum})),c=St.ofStrings(n.map(function(v){return v.endChainID})),d=St.ofStrings(n.map(function(v){return v.endResName})),f=St.ofStrings(n.map(function(v){return v.endSeqNum})),h={beg_label_asym_id:s,beg_label_comp_id:u,beg_label_seq_id:l,beg_auth_asym_id:s,beg_auth_comp_id:u,beg_auth_seq_id:l,end_label_asym_id:c,end_label_comp_id:c,end_label_seq_id:f,end_auth_asym_id:c,end_auth_comp_id:d,end_auth_seq_id:f,id:St.ofStrings(n.map(function(v){return v.strand})),sheet_id:St.ofStrings(n.map(function(v){return v.sheetID})),pdbx_beg_PDB_ins_code:St.ofStrings(n.map(function(v){return v.initICode})),pdbx_end_PDB_ins_code:St.ofStrings(n.map(function(v){return v.endICode}))};return ba.ofFields("struct_sheet_range",h)}var kqe={MOL_ID:"",MOLECULE:"",CHAIN:"",FRAGMENT:"",SYNONYM:"",EC:"",ENGINEERED:"",MUTATION:"",OTHER_DETAILS:""};function Oqe(e,t,r){for(var n=function(h){return e.data.substring(e.indices[2*h],e.indices[2*h+1])},i,a={chains:[],description:""},o=[],s=t;s<r;s++){var u=n(s),l=u.substr(10,70).trim(),c=l.indexOf(":"),d=l.substring(0,c),f=void 0;d in kqe?(i=d,f=l.substring(c+2)):f=l,f=f.replace(/;$/,""),i==="MOL_ID"?(a={chains:[],description:""},o.push(a)):i==="MOLECULE"?(a.description&&(a.description+=" "),a.description+=f):i==="CHAIN"&&Array.prototype.push.apply(a.chains,f.split(/\s*,\s*/))}return o}function Fqe(e,t,r){for(var n=function(l){return e.data.substring(e.indices[2*l],e.indices[2*l+1])},i=new Map,a=t;a<r;a++){var o=n(a),s=o.substr(11,3).trim(),u=o.substr(15).trim();i.has(s)?i.set(s,i.get(s)+" "+u):i.set(s,u)}return i}function Lqe(e,t){var r=function(){return[]},n=function(){return ht.create(e,2*t)};return{index:0,group_PDB:n(),id:r(),auth_atom_id:n(),label_alt_id:n(),auth_comp_id:n(),auth_asym_id:n(),auth_seq_id:n(),pdbx_PDB_ins_code:n(),Cartn_x:n(),Cartn_y:n(),Cartn_z:n(),occupancy:n(),B_iso_or_equiv:n(),type_symbol:n(),pdbx_PDB_model_num:r(),label_entity_id:r(),partial_charge:n()}}function Nqe(e){var t=St.ofTokens(e.auth_asym_id),r=St.ofTokens(e.auth_atom_id),n=St.ofTokens(e.auth_comp_id);return{auth_asym_id:t,auth_atom_id:r,auth_comp_id:n,auth_seq_id:St.ofTokens(e.auth_seq_id),B_iso_or_equiv:St.ofTokens(e.B_iso_or_equiv),Cartn_x:St.ofTokens(e.Cartn_x),Cartn_y:St.ofTokens(e.Cartn_y),Cartn_z:St.ofTokens(e.Cartn_z),group_PDB:St.ofTokens(e.group_PDB),id:St.ofStrings(e.id),label_alt_id:St.ofTokens(e.label_alt_id),label_asym_id:t,label_atom_id:r,label_comp_id:n,label_seq_id:St.ofUndefined(e.index,ve.Schema.int),label_entity_id:St.ofStrings(e.label_entity_id),occupancy:St.ofTokens(e.occupancy),type_symbol:St.ofTokens(e.type_symbol),pdbx_PDB_ins_code:St.ofTokens(e.pdbx_PDB_ins_code),pdbx_PDB_model_num:St.ofStrings(e.pdbx_PDB_model_num),partial_charge:St.ofTokens(e.partial_charge)}}function Jz(e,t,r,n,i,a){var o=r.data,s=i-n;ht.addToken(e.group_PDB,It.trim(r,n,n+6)),It.trim(r,n+6,n+11),e.id[e.index]=r.data.substring(r.tokenStart,r.tokenEnd),ht.addToken(e.auth_atom_id,It.trim(r,n+12,n+16)),o.charCodeAt(n+16)===32?ht.add(e.label_alt_id,0,0):ht.add(e.label_alt_id,n+16,n+17),ht.addToken(e.auth_comp_id,It.trim(r,n+17,n+20)),ht.add(e.auth_asym_id,n+21,n+22),ht.addToken(e.auth_seq_id,It.trim(r,n+22,n+26)),o.charCodeAt(n+26)===32?ht.add(e.pdbx_PDB_ins_code,0,0):ht.add(e.pdbx_PDB_ins_code,n+26,n+27),ht.addToken(e.Cartn_x,It.trim(r,n+30,n+38)),ht.addToken(e.Cartn_y,It.trim(r,n+38,n+46)),ht.addToken(e.Cartn_z,It.trim(r,n+46,n+54)),ht.addToken(e.occupancy,It.trim(r,n+54,n+60)),s>=66?ht.addToken(e.B_iso_or_equiv,It.trim(r,n+60,n+66)):ht.add(e.B_iso_or_equiv,0,0),a&&ht.addToken(e.partial_charge,It.trim(r,n+70,n+76)),s>=78&&!a?(It.trim(r,n+76,n+78),r.tokenStart<r.tokenEnd?ht.addToken(e.type_symbol,r):Iw(e.type_symbol,o,n+12,n+16)):Iw(e.type_symbol,o,n+12,n+16),e.pdbx_PDB_model_num[e.index]=t,e.index++}function Bqe(e,t){var r=function(){return[]},n=function(){return new Float32Array(t)},i=function(){return ht.create(e,2*t)};return{index:0,count:t,id:r(),type_symbol:i(),pdbx_label_atom_id:i(),pdbx_label_alt_id:i(),pdbx_label_comp_id:i(),pdbx_label_asym_id:i(),pdbx_label_seq_id:i(),pdbx_PDB_ins_code:i(),"U[1][1]":n(),"U[2][2]":n(),"U[3][3]":n(),"U[1][2]":n(),"U[1][3]":n(),"U[2][3]":n(),pdbx_auth_seq_id:i(),pdbx_auth_comp_id:i(),pdbx_auth_asym_id:i(),pdbx_auth_atom_id:i()}}function Uqe(e){var t=St.ofTokens(e.pdbx_auth_seq_id),r=St.ofTokens(e.pdbx_auth_comp_id),n=St.ofTokens(e.pdbx_auth_asym_id),i=St.ofTokens(e.pdbx_auth_atom_id),a={id:St.ofStrings(e.id),type_symbol:St.ofTokens(e.type_symbol),pdbx_label_atom_id:i,pdbx_label_alt_id:St.ofTokens(e.pdbx_label_alt_id),pdbx_label_comp_id:r,pdbx_label_asym_id:n,pdbx_label_seq_id:t,pdbx_PDB_ins_code:St.ofTokens(e.pdbx_PDB_ins_code),pdbx_auth_seq_id:t,pdbx_auth_comp_id:r,pdbx_auth_asym_id:n,pdbx_auth_atom_id:i};return a["U[1][1]"]=St.ofNumbers(e["U[1][1]"]),a["U[2][2]"]=St.ofNumbers(e["U[2][2]"]),a["U[3][3]"]=St.ofNumbers(e["U[3][3]"]),a["U[1][2]"]=St.ofNumbers(e["U[1][2]"]),a["U[1][3]"]=St.ofNumbers(e["U[1][3]"]),a["U[2][3]"]=St.ofNumbers(e["U[2][3]"]),a}function jqe(e,t,r,n,i){var a=r.data,o=i-n;It.trim(r,n+6,n+11),e.id[e.index]=a.substring(r.tokenStart,r.tokenEnd),ht.addToken(e.pdbx_auth_atom_id,It.trim(r,n+12,n+16)),a.charCodeAt(n+16)===32?ht.add(e.pdbx_label_alt_id,0,0):ht.add(e.pdbx_label_alt_id,n+16,n+17),ht.addToken(e.pdbx_auth_comp_id,It.trim(r,n+17,n+20)),ht.add(e.pdbx_auth_asym_id,n+21,n+22),ht.addToken(e.pdbx_auth_seq_id,It.trim(r,n+22,n+26)),a.charCodeAt(n+26)===32?ht.add(e.pdbx_PDB_ins_code,0,0):ht.add(e.pdbx_PDB_ins_code,n+26,n+27),e["U[1][1]"][e.index]=Ip(a,n+28,n+35)/1e4,e["U[2][2]"][e.index]=Ip(a,n+35,n+42)/1e4,e["U[3][3]"][e.index]=Ip(a,n+42,n+49)/1e4,e["U[1][2]"][e.index]=Ip(a,n+49,n+56)/1e4,e["U[1][3]"][e.index]=Ip(a,n+56,n+63)/1e4,e["U[2][3]"][e.index]=Ip(a,n+63,n+70)/1e4,o>=78?(It.trim(r,n+76,n+78),r.tokenStart<r.tokenEnd?ht.addToken(e.type_symbol,r):Iw(e.type_symbol,a,n+12,n+16)):Iw(e.type_symbol,a,n+12,n+16),e.index++}function zqe(e,t,r,n){for(var i={},a=0,o=n.id.rowCount;a<o;++a)i[n.id.str(a)]=a;for(var s=function(k){return e.data.substring(e.indices[2*k],e.indices[2*k+1])},u=[],l=[],c=[],d=[],f=[],h=[],v=[],p=[],m=[],g=[],y=[11,16,21,26],b=1,a=t;a<r;a++){var S=s(a),x=i[parseInt(S.substr(6,5))],C={};if(x!==void 0)for(var w=0;w<4;++w){var A=parseInt(S.substr(y[w],5));if(!Number.isNaN(A)){var M=i[A];M!==void 0&&(x>M||C[M]===void 0&&(u.push("covale"+b),l.push("covale"),c.push(n.label_asym_id.str(x)),f.push(n.auth_seq_id.int(x)),d.push(n.label_seq_id.int(x)),h.push(n.label_atom_id.str(x)),v.push(n.label_asym_id.str(M)),m.push(n.auth_seq_id.int(M)),p.push(n.label_seq_id.int(M)),g.push(n.label_atom_id.str(M)),b+=1))}}}var D={id:St.ofStrings(u),conn_type_id:St.ofStrings(l),ptnr1_label_asym_id:St.ofStrings(c),ptnr1_auth_seq_id:St.ofNumbers(f),ptnr1_label_seq_id:St.ofNumbers(d),ptnr1_label_atom_id:St.ofStrings(h),ptnr2_label_asym_id:St.ofStrings(v),ptnr2_label_seq_id:St.ofNumbers(p),ptnr2_auth_seq_id:St.ofNumbers(m),ptnr2_label_atom_id:St.ofStrings(g)};return ba.ofFields("struct_conn",D)}function Vqe(e){return ce(this,void 0,void 0,function(){var t,r,n,i,a,o,s,M,m,g,y,u,l,c,d,f,h,v,p,M,m,g,y,b,b,b,b,b,b,b,S,x,C,w,A,M,D,k,R,O,H,B,j,Y;return de(this,function(G){for(t=e.lines,r=t.data,n=t.indices,i=It(r),a=!!e.isPdbqt,o=0,s=0,M=0,m=t.count;M<m;M++)switch(g=n[2*M],y=n[2*M+1],r[g]){case"A":yi(r,g,y,"ATOM  ")?o++:yi(r,g,y,"ANISOU")&&s++;break;case"H":yi(r,g,y,"HETATM")&&o++;break}for(u=Lqe(r,o),l=Bqe(r,s),c=new Wh,d=[],f=[],h=0,v="",p=void 0,M=0,m=t.count;M<m;M++)switch(g=n[2*M],y=n[2*M+1],r[g]){case"A":yi(r,g,y,"ATOM  ")?(h||(h++,v=""+h),Jz(u,v,i,g,y,a)):yi(r,g,y,"ANISOU")&&jqe(l,v,i,g,y);break;case"C":if(yi(r,g,y,"CRYST1"))d.push.apply(d,Aqe(e.id||"?",r.substring(g,y)));else if(yi(r,g,y,"CONECT")){for(b=M+1;g=n[2*b],y=n[2*b+1],!!yi(r,g,y,"CONECT");)b++;p?Lr&&console.log("only single CONECT block allowed, ignoring others"):p=[M,b],M=b-1}else if(yi(r,g,y,"COMPND")){for(b=M+1;g=n[2*b],y=n[2*b+1],!!yi(r,g,y,"COMPND");)b++;c.setCompounds(Oqe(t,M,b)),M=b-1}break;case"H":if(yi(r,g,y,"HETATM"))h||(h++,v=""+h),Jz(u,v,i,g,y,a);else if(yi(r,g,y,"HELIX")){for(b=M+1;g=n[2*b],y=n[2*b+1],!!yi(r,g,y,"HELIX");)b++;d.push(Dqe(t,M,b)),M=b-1}else if(yi(r,g,y,"HETNAM")){for(b=M+1;g=n[2*b],y=n[2*b+1],!!yi(r,g,y,"HETNAM");)b++;f.push.apply(f,Array.from(Fqe(t,M,b).entries())),M=b-1}break;case"M":if(yi(r,g,y,"MODEL ")&&(h++,v=""+h),yi(r,g,y,"MTRIX")){for(b=M+1;g=n[2*b],y=n[2*b+1],!!yi(r,g,y,"MTRIX");)b++;d.push.apply(d,Tqe(t,M,b)),M=b-1}break;case"O":break;case"R":if(yi(r,g,y,"REMARK 350")){for(b=M+1;g=n[2*b],y=n[2*b+1],!!yi(r,g,y,"REMARK 350");)b++;d.push.apply(d,Pqe(t,M,b)),M=b-1}break;case"S":if(yi(r,g,y,"SHEET")){for(b=M+1;g=n[2*b],y=n[2*b+1],!!yi(r,g,y,"SHEET");)b++;d.push(Rqe(t,M,b)),M=b-1}break}for(S=ve.ofIntTokens(u.auth_seq_id),x=ve.ofStringTokens(u.auth_atom_id),C=ve.ofStringTokens(u.auth_comp_id),w=ve.ofStringTokens(u.auth_asym_id),A=new $h(S,x),A.setNames(f),c.setNames(f),M=0,D=C.rowCount;M<D;++M)k=C.value(M),R=H0(A.add(k,M).type,k),u.label_entity_id[M]=c.getEntityId(k,R,w.value(M));for(O=Nqe(u),a||delete O.partial_charge,p&&d.push(zqe(t,p[0],p[1],O)),H={entity:ba.ofTable("entity",c.getEntityTable()),chem_comp:ba.ofTable("chem_comp",A.getChemCompTable()),atom_site:ba.ofFields("atom_site",O),atom_site_anisotrop:ba.ofFields("atom_site_anisotrop",Uqe(l))},B=0,j=d;B<j.length;B++)Y=j[B],H[Y.name]=Y;return[2,{header:e.id||"PDB",categoryNames:Object.keys(H),categories:H}]})})}var y0;(function(e){e.Descriptor={name:"atom_partial_charge"},e.Provider=Wu.create(e.Descriptor)})(y0||(y0={}));var ZD;(function(e){function t(n){return(n==null?void 0:n.kind)==="pdb"}e.is=t;function r(n){return{kind:"pdb",name:n.id||"",data:n}}e.create=r})(ZD||(ZD={}));function Hqe(e){var t=this;return $e.create("Parse PDB",function(r){return ce(t,void 0,void 0,function(){var n,i,a,o,s,u,l,c,d,f,h;return de(this,function(v){switch(v.label){case 0:return[4,r.update("Converting to mmCIF")];case 1:return v.sent(),[4,Vqe(e)];case 2:return n=v.sent(),i=un.fromFrame(n,void 0,ZD.create(e)),[4,Od(i.data.db,i,r)];case 3:return a=v.sent(),o=(h=n.categories.atom_site)===null||h===void 0?void 0:h.getField("partial_charge"),o&&a.frameCount===1&&(s=a.representative,u=s.atomicHierarchy.atomSourceIndex,l=ve.isIdentity(u),c=l?void 0:u.toArray({array:Int32Array}),d=o.toFloatArray(),f=c?ve.ofFloatArray(ve.mapToArray(u,function(p){return d[p]},Float32Array)):ve.ofFloatArray(d),y0.Provider.set(s,{data:f,type:"GASTEIGER"})),[2,a]}})})})}function Gqe(e){for(var t=new Array(e.count),r=new Array(e.count),n=new Uint32Array(e.count),i=new Uint32Array(e.count),a=new Wh,o=new $h(e.residueId,e.atomName),s="",u=0,l="",c=0,d=e.segmentName.value(0),f=!1,h=0,v=-1,p=0,m=e.count;p<m;++p){var g=e.residueId.value(p),y=e.segmentName.value(p);if(d!==y?(l=KD(u),u+=1,c=0,f=!0,d=y):f=!1,f||g!==v){var b=e.residueName.value(p),S=H0(o.add(b,p).type,b);!f&&(S!==h||g!==v+1)&&(l=KD(u),u+=1,c=0),s=a.getEntityId(b,S,l),c+=1,v=g,h=S}t[p]=s,r[p]=l,n[p]=c,i[p]=p}var x=en.ofPartialColumns(ao.atom_site,{auth_asym_id:e.segmentName,auth_atom_id:e.atomName,auth_comp_id:e.residueName,auth_seq_id:e.residueId,id:ve.ofIntArray(i),label_asym_id:ve.ofStringArray(r),label_atom_id:e.atomName,label_comp_id:e.residueName,label_seq_id:ve.ofIntArray(n),label_entity_id:ve.ofStringArray(t),occupancy:ve.ofConst(1,e.count,ve.Schema.float),type_symbol:ve.ofStringArray(ve.mapToArray(e.atomName,function(C){return aA(C)})),pdbx_PDB_model_num:ve.ofConst(1,e.count,ve.Schema.int)},e.count);return tm({entity:a.getEntityTable(),chem_comp:o.getChemCompTable(),atom_site:x})}var JD;(function(e){function t(n){return(n==null?void 0:n.kind)==="psf"}e.is=t;function r(n){return{kind:"psf",name:n.id,data:n}}e.fromPsf=r})(JD||(JD={}));function qqe(e){var t=this;return $e.create("Parse PSF",function(r){return ce(t,void 0,void 0,function(){var n,i,a,o,s,u;return de(this,function(l){return n=JD.fromPsf(e),i=Gqe(e.atoms),a=e.bonds,o=a.atomIdA,s=a.atomIdB,u={indexA:ve.ofLambda({value:function(c){return o.value(c)-1},rowCount:o.rowCount,schema:o.schema}),indexB:ve.ofLambda({value:function(c){return s.value(c)-1},rowCount:s.rowCount,schema:s.schema}),order:ve.ofConst(1,e.bonds.count,ve.Schema.int)},[2,wD.create(e.id,i,u,n)]})})})}function $qe(e){return Object.keys(e).filter(function(t){return!isNaN(t)}).map(function(t){return+t}).sort(function(t,r){return t-r}).map(function(t){return e[t]})}function PT(e,t,r){return e&&e[t]!==void 0?e[t]:r}function nt(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];return{kind:"alias",aliases:t,symbol:e}}function sS(e,t){for(var r=[],n=2;n<arguments.length;n++)r[n-2]=arguments[n];return e.info.namespace="molscript-macro",e.id="molscript-macro."+e.info.name,{kind:"macro",symbol:e,translate:t,aliases:Nt([e.info.name],r)}}function Wqe(e){return e.kind==="alias"||e.kind==="macro"}var Xqe=[["Core symbols",nt(Ce.core.type.bool,"bool"),nt(Ce.core.type.num,"num"),nt(Ce.core.type.str,"str"),nt(Ce.core.type.regex,"regex"),nt(Ce.core.type.list,"list"),nt(Ce.core.type.set,"set"),nt(Ce.core.type.compositeKey,"composite-key"),nt(Ce.core.logic.not,"not"),nt(Ce.core.logic.and,"and"),nt(Ce.core.logic.or,"or"),nt(Ce.core.ctrl.if,"if"),nt(Ce.core.ctrl.fn,"fn"),nt(Ce.core.ctrl.eval,"eval"),nt(Ce.core.math.add,"add","+"),nt(Ce.core.math.sub,"sub","-"),nt(Ce.core.math.mult,"mult","*"),nt(Ce.core.math.div,"div","/"),nt(Ce.core.math.pow,"pow","**"),nt(Ce.core.math.mod,"mod"),nt(Ce.core.math.min,"min"),nt(Ce.core.math.max,"max"),nt(Ce.core.math.floor,"floor"),nt(Ce.core.math.ceil,"ceil"),nt(Ce.core.math.roundInt,"round"),nt(Ce.core.math.abs,"abs"),nt(Ce.core.math.sqrt,"sqrt"),nt(Ce.core.math.cbrt,"cbrt"),nt(Ce.core.math.sin,"sin"),nt(Ce.core.math.cos,"cos"),nt(Ce.core.math.tan,"tan"),nt(Ce.core.math.asin,"asin"),nt(Ce.core.math.acos,"acos"),nt(Ce.core.math.atan,"atan"),nt(Ce.core.math.sinh,"sinh"),nt(Ce.core.math.cosh,"cosh"),nt(Ce.core.math.tanh,"tanh"),nt(Ce.core.math.exp,"exp"),nt(Ce.core.math.log,"log"),nt(Ce.core.math.log10,"log10"),nt(Ce.core.math.atan2,"atan2"),nt(Ce.core.rel.eq,"eq","="),nt(Ce.core.rel.neq,"neq","!="),nt(Ce.core.rel.lt,"lt","<"),nt(Ce.core.rel.lte,"lte","<="),nt(Ce.core.rel.gr,"gr",">"),nt(Ce.core.rel.gre,"gre",">="),nt(Ce.core.rel.inRange,"in-range"),nt(Ce.core.str.concat,"concat"),nt(Ce.core.str.match,"regex.match"),nt(Ce.core.list.getAt,"list.get"),nt(Ce.core.set.has,"set.has"),nt(Ce.core.set.isSubset,"set.subset")],["Structure",["Types",nt(Ce.structureQuery.type.entityType,"ent-type"),nt(Ce.structureQuery.type.authResidueId,"auth-resid"),nt(Ce.structureQuery.type.labelResidueId,"label-resid"),nt(Ce.structureQuery.type.ringFingerprint,"ringfp"),nt(Ce.structureQuery.type.bondFlags,"bond-flags")],["Slots",nt(Ce.structureQuery.slot.elementSetReduce,"atom.set.reduce.value")],["Generators",nt(Ce.structureQuery.generator.atomGroups,"sel.atom.atom-groups"),nt(Ce.structureQuery.generator.queryInSelection,"sel.atom.query-in-selection"),nt(Ce.structureQuery.generator.rings,"sel.atom.rings"),nt(Ce.structureQuery.generator.empty,"sel.atom.empty"),nt(Ce.structureQuery.generator.all,"sel.atom.all"),nt(Ce.structureQuery.generator.bondedAtomicPairs,"sel.atom.bonded-pairs"),sS(p1("sel.atom.atoms",Rt.Dictionary({0:vt(De.Bool,{isOptional:!0,defaultValue:!0,description:"Test applied to each atom."})}),At.ElementSelection,"A selection of singleton atom sets."),function(e){return se.struct.generator.atomGroups({"atom-test":PT(e,0,!0)})}),sS(p1("sel.atom.res",Rt.Dictionary({0:vt(De.Bool,{isOptional:!0,defaultValue:!0,description:"Test applied to the 1st atom of each residue."})}),At.ElementSelection,"A selection of atom sets grouped by residue."),function(e){return se.struct.generator.atomGroups({"residue-test":PT(e,0,!0),"group-by":se.ammp("residueKey")})}),sS(p1("sel.atom.chains",Rt.Dictionary({0:vt(De.Bool,{isOptional:!0,defaultValue:!0,description:"Test applied to the 1st atom of each chain."})}),At.ElementSelection,"A selection of atom sets grouped by chain."),function(e){return se.struct.generator.atomGroups({"chain-test":PT(e,0,!0),"group-by":se.ammp("chainKey")})})],["Modifiers",nt(Ce.structureQuery.modifier.queryEach,"sel.atom.query-each"),nt(Ce.structureQuery.modifier.intersectBy,"sel.atom.intersect-by"),nt(Ce.structureQuery.modifier.exceptBy,"sel.atom.except-by"),nt(Ce.structureQuery.modifier.unionBy,"sel.atom.union-by"),nt(Ce.structureQuery.modifier.union,"sel.atom.union"),nt(Ce.structureQuery.modifier.cluster,"sel.atom.cluster"),nt(Ce.structureQuery.modifier.includeSurroundings,"sel.atom.include-surroundings"),nt(Ce.structureQuery.modifier.surroundingLigands,"sel.atom.surrounding-ligands"),nt(Ce.structureQuery.modifier.includeConnected,"sel.atom.include-connected"),nt(Ce.structureQuery.modifier.expandProperty,"sel.atom.expand-property")],["Filters",nt(Ce.structureQuery.filter.pick,"sel.atom.pick"),nt(Ce.structureQuery.filter.first,"sel.atom.first"),nt(Ce.structureQuery.filter.withSameAtomProperties,"sel.atom.with-same-atom-properties"),nt(Ce.structureQuery.filter.intersectedBy,"sel.atom.intersected-by"),nt(Ce.structureQuery.filter.within,"sel.atom.within"),nt(Ce.structureQuery.filter.isConnectedTo,"sel.atom.is-connected-to")],["Combinators",nt(Ce.structureQuery.combinator.intersect,"sel.atom.intersect"),nt(Ce.structureQuery.combinator.merge,"sel.atom.merge"),nt(Ce.structureQuery.combinator.distanceCluster,"sel.atom.dist-cluster")],["Atom Set Properties",nt(Ce.structureQuery.atomSet.atomCount,"atom.set.atom-count"),nt(Ce.structureQuery.atomSet.countQuery,"atom.set.count-query"),nt(Ce.structureQuery.atomSet.reduce,"atom.set.reduce"),nt(Ce.structureQuery.atomSet.propertySet,"atom.set.property")],["Atom Properties",nt(Ce.structureQuery.atomProperty.core.elementSymbol,"atom.el"),nt(Ce.structureQuery.atomProperty.core.vdw,"atom.vdw"),nt(Ce.structureQuery.atomProperty.core.mass,"atom.mass"),nt(Ce.structureQuery.atomProperty.core.atomicNumber,"atom.atomic-number"),nt(Ce.structureQuery.atomProperty.core.x,"atom.x"),nt(Ce.structureQuery.atomProperty.core.y,"atom.y"),nt(Ce.structureQuery.atomProperty.core.z,"atom.z"),nt(Ce.structureQuery.atomProperty.core.sourceIndex,"atom.src-index"),nt(Ce.structureQuery.atomProperty.core.operatorName,"atom.op-name"),nt(Ce.structureQuery.atomProperty.core.modelIndex,"atom.model-index"),nt(Ce.structureQuery.atomProperty.core.modelLabel,"atom.model-label"),nt(Ce.structureQuery.atomProperty.core.atomKey,"atom.key"),nt(Ce.structureQuery.atomProperty.core.bondCount,"atom.bond-count"),nt(Ce.structureQuery.atomProperty.topology.connectedComponentKey,"atom.key.molecule"),nt(Ce.structureQuery.atomProperty.macromolecular.authResidueId,"atom.auth-resid"),nt(Ce.structureQuery.atomProperty.macromolecular.labelResidueId,"atom.label-resid"),nt(Ce.structureQuery.atomProperty.macromolecular.residueKey,"atom.key.res"),nt(Ce.structureQuery.atomProperty.macromolecular.chainKey,"atom.key.chain"),nt(Ce.structureQuery.atomProperty.macromolecular.entityKey,"atom.key.entity"),nt(Ce.structureQuery.atomProperty.macromolecular.isHet,"atom.is-het"),nt(Ce.structureQuery.atomProperty.macromolecular.id,"atom.id"),nt(Ce.structureQuery.atomProperty.macromolecular.label_atom_id,"atom.label_atom_id"),nt(Ce.structureQuery.atomProperty.macromolecular.label_alt_id,"atom.label_alt_id","atom.altloc"),nt(Ce.structureQuery.atomProperty.macromolecular.label_comp_id,"atom.label_comp_id"),nt(Ce.structureQuery.atomProperty.macromolecular.label_asym_id,"atom.label_asym_id"),nt(Ce.structureQuery.atomProperty.macromolecular.label_entity_id,"atom.label_entity_id"),nt(Ce.structureQuery.atomProperty.macromolecular.label_seq_id,"atom.label_seq_id"),nt(Ce.structureQuery.atomProperty.macromolecular.auth_atom_id,"atom.auth_atom_id","atom.name"),nt(Ce.structureQuery.atomProperty.macromolecular.auth_comp_id,"atom.auth_comp_id","atom.resname"),nt(Ce.structureQuery.atomProperty.macromolecular.auth_asym_id,"atom.auth_asym_id","atom.chain"),nt(Ce.structureQuery.atomProperty.macromolecular.auth_seq_id,"atom.auth_seq_id","atom.resno"),nt(Ce.structureQuery.atomProperty.macromolecular.pdbx_PDB_ins_code,"atom.pdbx_PDB_ins_code","atom.inscode"),nt(Ce.structureQuery.atomProperty.macromolecular.pdbx_formal_charge,"atom.pdbx_formal_charge"),nt(Ce.structureQuery.atomProperty.macromolecular.occupancy,"atom.occupancy"),nt(Ce.structureQuery.atomProperty.macromolecular.B_iso_or_equiv,"atom.B_iso_or_equiv","atom.bfactor"),nt(Ce.structureQuery.atomProperty.macromolecular.entityType,"atom.entity-type"),nt(Ce.structureQuery.atomProperty.macromolecular.entitySubtype,"atom.entity-subtype"),nt(Ce.structureQuery.atomProperty.macromolecular.entityPrdId,"atom.entity-prd-id"),nt(Ce.structureQuery.atomProperty.macromolecular.entityDescription,"atom.entity-description"),nt(Ce.structureQuery.atomProperty.macromolecular.objectPrimitive,"atom.object-primitive"),nt(Ce.structureQuery.atomProperty.macromolecular.chemCompType,"atom.chem-comp-type"),nt(Ce.structureQuery.atomProperty.macromolecular.secondaryStructureKey,"atom.key.sec-struct"),nt(Ce.structureQuery.atomProperty.macromolecular.isModified,"atom.is-modified"),nt(Ce.structureQuery.atomProperty.macromolecular.modifiedParentName,"atom.modified-parent")],["Bond Properties",nt(Ce.structureQuery.bondProperty.order,"bond.order"),nt(Ce.structureQuery.bondProperty.length,"bond.length"),nt(Ce.structureQuery.bondProperty.atomA,"bond.atom-a"),nt(Ce.structureQuery.bondProperty.atomB,"bond.atom-b"),sS(p1("bond.is",Rt.List(At.BondFlag),De.Bool,"Test if the current bond has at least one (or all if partial = false) of the specified flags: "+De.oneOfValues(At.BondFlag).join(", ")),function(e){return se.core.flags.hasAny([se.struct.bondProperty.flags(),se.struct.type.bondFlags($qe(e))])})]]],Cte=[];function _te(e){for(var t=0,r=e;t<r.length;t++){var n=r[t];Wqe(n)?Cte.push(n):n instanceof Array&&_te(n)}}_te(Xqe);var Yqe=function(){for(var e=[],t=Object.create(null),r=an.create(),n=an.create(),i=0,a=Cte;i<a.length;i++){for(var o=a[i],s=0,u=o.aliases;s<u.length;s++){var l=u[s];if(e.push([l,o]),t[l])throw new Error("Alias '"+l+"' already in use.");t[l]=o}var c=o.symbol.args;if(c.kind!=="dictionary"){c.type.kind==="oneof"&&De.oneOfValues(c.type).forEach(function(v){return an.add(n,v,v)});continue}for(var d=0,f=Object.keys(c.map);d<f.length;d++){var l=f[d];isNaN(l)&&an.add(r,l,l);var h=c.map[l];h.type.kind==="oneof"&&De.oneOfValues(h.type).forEach(function(p){return an.add(n,p,p)})}}return{symbolList:e,symbolMap:t,namedArgs:r.array,constants:n.array}}(),km=Yqe.symbolMap;function y1(e){if(Ri.isLiteral(e))return e;if(Ri.isSymbol(e)){if(!km[e.name])return e;var t=km[e.name];if(t.kind==="alias")return Ri.Symbol(km[e.name].symbol.id);throw t.translate([])}var r=Ri.isSymbol(e.head)&&!!km[e.head.name]&&km[e.head.name].kind==="macro",n=r?e.head:y1(e.head),i=n!==e.head;if(!e.args)return r?y1(e.head):i?Ri.Apply(n):e;var a=!1,o;if(Ri.isArgumentsArray(e.args)){o=[];for(var s=0,u=e.args.length;s<u;s++){var l=e.args[s],c=y1(l);l!==c&&(a=!0),o[o.length]=c}if(a||(o=e.args),!r&&!i&&!a)return e}else{o={};for(var d=0,f=Object.keys(e.args);d<f.length;d++){var h=f[d],l=e.args[h],c=y1(l);l!==c&&(a=!0),o[h]=c}if(!r&&!i&&!a)return e;a||(o=e.args)}if(r){var v=km[e.head.name];if(v.kind!=="macro")return Ri.Apply(n,o);var p=v.translate(o);return p}return Ri.Apply(n,o)}function Kqe(e){return y1(e)}var xu=function(){function e(t){this._=t}return e.prototype.parse=function(t){var r=this.skip(e.eof)._(t,0);return r.status?{success:!0,value:r.value}:{success:!1,index:wte(t,r.furthest),expected:r.expected}},e.prototype.tryParse=function(t){var r=this.parse(t);if(r.success)return r.value;var n=Jqe(t,r),i=new Error(n);throw i},e.prototype.or=function(t){return e.alt(this,t)},e.prototype.trim=function(t){return this.wrap(t,t)},e.prototype.wrap=function(t,r){return TT(1,typeof t=="string"?e.string(t):t,this,typeof r=="string"?e.string(r):r)},e.prototype.thru=function(t){return t(this)},e.prototype.then=function(t){return TT(1,this,t)},e.prototype.many=function(){var t=this;return new e(function(r,n){for(var i=[],a=void 0;;)if(a=Ns(t._(r,n),a),a.status){if(n===a.index)throw new Error("infinite loop detected in .many() parser --- calling .many() on a parser which can accept zero characters is usually the cause");n=a.index,i.push(a.value)}else return Ns(Oa(n,i),a)})},e.prototype.times=function(t,r){var n=this,i=typeof r>"u"?t:r;return new e(function(a,o){var s=[],u=void 0,l=void 0,c;for(c=0;c<t;c++)if(u=n._(a,o),l=Ns(u,l),u.status)o=u.index,s.push(u.value);else return l;for(;c<i&&(u=n._(a,o),l=Ns(u,l),u.status);c+=1)o=u.index,s.push(u.value);return Ns(Oa(o,s),l)})},e.prototype.result=function(t){return this.map(function(){return t})},e.prototype.atMost=function(t){return this.times(0,t)},e.prototype.atLeast=function(t){return e.seq(this.times(t),this.many()).map(function(r){return Nt(Nt([],r[0]),r[1])})},e.prototype.map=function(t){var r=this;return new e(function(n,i){var a=r._(n,i);return a.status?Ns(Oa(a.index,t(a.value)),a):a})},e.prototype.skip=function(t){return TT(0,this,t)},e.prototype.mark=function(){return e.seq(e.index,this,e.index).map(function(t){return{start:t[0],value:t[1],end:t[2]}})},e.prototype.node=function(t){return e.seq(e.index,this,e.index).map(function(r){return{name:t,start:r[0],value:r[1],end:r[2]}})},e.prototype.sepBy=function(t){return e.sepBy(this,t)},e.prototype.sepBy1=function(t){return e.sepBy1(this,t)},e.prototype.lookahead=function(t){return this.skip(e.lookahead(t))},e.prototype.notFollowedBy=function(t){return this.skip(e.notFollowedBy(t))},e.prototype.desc=function(t){var r=this;return new e(function(n,i){var a=r._(n,i);return a.status||(a.expected=[t]),a})},e.prototype.fallback=function(t){return this.or(e.succeed(t))},e.prototype.ap=function(t){return e.seq(t,this).map(function(r){var n=r[0],i=r[1];return n(i)})},e.prototype.chain=function(t){var r=this;return new e(function(n,i){var a=r._(n,i);if(!a.status)return a;var o=t(a.value);return Ns(o._(n,a.index),a)})},e}();(function(e){function t(){for(var S=[],x=0;x<arguments.length;x++)S[x]=arguments[x];var C=S.length;return new e(function(w,A){for(var M,D=new Array(C),k=A,R=0;R<C;R++){if(M=Ns(S[R]._(w,k),M),!M.status)return M;D[R]=M.value,k=M.index}return Ns(Oa(k,D),M)})}e.seq=t;function r(){for(var S=[],x=0;x<arguments.length;x++)S[x]=arguments[x];var C=S.length;return C===0?c("zero alternates"):new e(function(w,A){for(var M,D=0;D<S.length;D++)if(M=Ns(S[D]._(w,A),M),M.status)return M;return M})}e.alt=r;function n(S,x){return i(S,x).or(l([]))}e.sepBy=n;function i(S,x){var C=x.then(S).many();return t(S,C).map(function(w){return Nt([w[0]],w[1])})}e.sepBy1=i;function a(S){var x="'"+S+"'";if(S.length===1){var C=S.charCodeAt(0);return new e(function(w,A){return w.charCodeAt(A)===C?Oa(A+1,S):bc(A,x)})}return new e(function(w,A){var M=A+S.length;return w.slice(A,M)===S?Oa(M,S):bc(A,x)})}e.string=a;function o(S){var x=""+S;return x.slice(x.lastIndexOf("/")+1)}function s(S){return RegExp("^(?:"+S.source+")",o(S))}function u(S,x){x===void 0&&(x=0);var C=s(S),w=""+S;return new e(function(A,M){var D=C.exec(A.slice(M));if(D){if(0<=x&&x<=D.length){var k=D[0],R=D[x];return Oa(M+k.length,R)}var O="invalid match group (0 to "+D.length+") in "+w;return bc(M,O)}return bc(M,w)})}e.regexp=u;function l(S){return new e(function(x,C){return Oa(C,S)})}e.succeed=l;function c(S){return new e(function(x,C){return bc(C,S)})}e.fail=c;function d(S){if(t$e(S))return new e(function(x,C){var w=S._(x,C);return w.status&&(w.index=C,w.value=null),w});if(typeof S=="string")return d(a(S));if(S instanceof RegExp)return d(u(S));throw new Error("not a string, regexp, or parser: "+S)}e.lookahead=d;function f(S){return new e(function(x,C){var w=S._(x,C);return w.status?bc(C,'not "'+x.slice(C,w.index)+'"'):Oa(C,null)})}e.notFollowedBy=f;function h(S){return new e(function(x,C){var w=x.charAt(C);return C<x.length&&S(w)?Oa(C+1,w):bc(C,"a character "+S)})}e.test=h;function v(S){return h(function(x){return S.indexOf(x)>=0})}e.oneOf=v;function p(S){return h(function(x){return S.indexOf(x)<0})}e.noneOf=p;function m(S,x){return h(function(C){return S<=C&&C<=x}).desc(S+"-"+x)}e.range=m;function g(S){return new e(function(x,C){for(var w=C;w<x.length&&S(x.charAt(w));)w++;return Oa(w,x.slice(C,w))})}e.takeWhile=g;function y(S){var x=new e(function(C,w){var A=S()._;return x._=A,A(C,w)});return x}e.lazy=y;function b(){return c("empty")}e.empty=b,e.index=new e(function(S,x){return Oa(x,wte(S,x))}),e.anyChar=new e(function(S,x){return x>=S.length?bc(x,"any character"):Oa(x+1,S.charAt(x))}),e.all=new e(function(S,x){return Oa(S.length,S.slice(x))}),e.eof=new e(function(S,x){return x<S.length?bc(x,"EOF"):Oa(x,null)}),e.digit=u(/[0-9]/).desc("a digit"),e.digits=u(/[0-9]*/).desc("optional digits"),e.letter=u(/[a-z]/i).desc("a letter"),e.letters=u(/[a-z]*/i).desc("optional letters"),e.optWhitespace=u(/\s*/).desc("optional whitespace"),e.whitespace=u(/\s+/).desc("whitespace"),e.cr=a("\r"),e.lf=a(`
`),e.crlf=a(`\r
`),e.newline=r(e.crlf,e.lf,e.cr).desc("newline"),e.end=r(e.newline,e.eof)})(xu||(xu={}));function TT(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];var n=t.length;return new xu(function(i,a){for(var o,s,u=a,l=0;l<n;l++){if(o=Ns(t[l]._(i,u),o),!o.status)return o;e===l&&(s=o.value),u=o.index}return Ns(Oa(u,s),o)})}function Oa(e,t){return{status:!0,index:e,value:t}}function bc(e,t){return{status:!1,furthest:e,expected:[t]}}function Ns(e,t){if(!t||e.status||t.status||e.furthest>t.furthest)return e;var r=e.furthest===t.furthest?e$e(e.expected,t.expected):t.expected;return{status:e.status,furthest:t.furthest,expected:r}}function wte(e,t){var r=e.slice(0,t).split(`
`),n=r.length,i=r[r.length-1].length+1;return{offset:t,line:n,column:i}}function Qqe(e){return e.length===1?e[0]:"one of "+e.join(", ")}function Zqe(e,t){var r=t.index,n=r.offset;if(n===e.length)return", got the end of the input";var i=n>0?"'...":"'",a=e.length-n>12?"...'":"'";return" at line "+r.line+" column "+r.column+", got "+i+e.slice(n,n+12)+a}function Jqe(e,t){return"expected "+Qqe(t.expected)+Zqe(e,t)}function e$e(e,t){var r=e.length,n=t.length;if(r===0)return t;if(n===0)return e;for(var i=new Set,a=[],o=0;o<r;o++)i.has(e[o])||(a[a.length]=e[o],i.add(e[o]));for(var o=0;o<n;o++)i.has(t[o])||(a[a.length]=t[o],i.add(t[o]));return a.sort(),a}function t$e(e){return e instanceof xu}function r$e(e){return eR.parse(e)}var eR;(function(e){var t;(function(S){function x(M){return{kind:"string",value:M}}S.str=x;function C(M){return{kind:"symbol",value:M}}S.symb=C;function w(M,D){return{kind:"list",bracket:M,nodes:D}}S.list=w;function A(M){return{kind:"comment",value:M}}S.comment=A})(t||(t={}));var r=xu.regexp(/[\n\r\s]*/),n=xu.lazy(function(){return xu.alt(i,d,a,o).trim(r)}),i=xu.takeWhile(function(S){return S!=="`"}).trim("`").map(t.str),a=xu.regexp(/[^()\[\]{};`,\n\r\s]+/).map(t.symb),o=xu.regexp(/\s*;+([^\n\r]*)\n/,1).map(t.comment),s=n.many(),u=s.wrap("(",")").map(function(S){return t.list("(",S)}),l=s.wrap("[","]").map(function(S){return t.list("[",S)}),c=s.wrap("{","}").map(function(S){return t.list("{",S)}),d=xu.alt(u,l,c),f=n.many();function h(S){return f.tryParse(S)}function v(S){switch(S.kind){case"string":return S.value;case"symbol":{var x=S.value;if(x.length>1){var C=x.charAt(0);switch(C){case".":return se.atomName(x.substr(1));case"_":return se.struct.type.elementSymbol([x.substr(1)])}}return x==="true"?!0:x==="false"?!1:y(x)?+x:Ri.Symbol(x)}case"list":{switch(S.bracket){case"[":return se.core.type.list(g(S.nodes).map(v));case"{":return se.core.type.set(g(S.nodes).map(v));case"(":{var w=v(S.nodes[0]);return Ri.Apply(w,p(S.nodes))}}return 0}default:throw new Error("should not happen")}}function p(S){if(!(S.length<=1)){if(!m(S)){for(var x=[],C=1,w=S.length;C<w;C++){var A=S[C];A.kind!=="comment"&&(x[x.length]=v(A))}return x}for(var M={},D=!0,k=0,C=1,w=S.length;C<w;C++){var A=S[C];if(A.kind!=="comment")if(A.kind==="symbol"&&A.value.length>1&&A.value.charAt(0)===":"){var R=A.value.substr(1);for(++C;C<w&&S[C].kind==="comment";)C++;if(C>=w)throw new Error("There must be a value foolowed a named arg ':"+R+"'.");M[R]=v(S[C]),isNaN(+R)&&(D=!1)}else M[k++]=v(A)}if(D){for(var O=Object.keys(M).map(function(j){return+j}).sort(function(j,Y){return j-Y}),H=!0,C=0,w=O.length;C<w;C++)if(O[C]!==C){H=!1;break}if(H){for(var B=[],C=0,w=O.length;C<w;C++)B[C]=M[C];return B}}return M}}function m(S){for(var x=1,C=S.length;x<C;x++){var w=S[x];if(w.kind==="symbol"&&w.value.length>1&&w.value.charAt(0)===":")return!0}return!1}function g(S){for(var x=!1,C=0,w=S.length;C<w;C++)if(S[C].kind==="comment"){x=!0;break}return x?S.filter(function(A){return A.kind!=="comment"}):S}function y(S){return/-?(0|[1-9][0-9]*)([.][0-9]+)?([eE][+-]?[0-9]+)?/.test(S)&&!isNaN(+S)}function b(S){for(var x=h(S),C=[],w=0,A=x;w<A.length;w++){var M=A[w];M.kind!=="comment"&&(C[C.length]=v(M))}return C}e.parse=b})(eR||(eR={}));function $i(e,t){return{expression:e,language:t}}(function(e){function t(s){return!!s&&typeof s.expression=="string"&&!!s.language}e.is=t;function r(s,u){return s.language===u.language&&s.expression===u.expression}e.areEqual=r;function n(s){switch(s.language){case"mol-script":var u=r$e(s.expression);if(u.length===0)throw new Error("No query");return Kqe(u[0])}throw new Error("unsupported script language")}e.toExpression=n;function i(s){var u=n(s);return Lv(u)}e.toQuery=i;function a(s,u){var l=i(s),c=l(new ps(u));return mt.toLociWithSourceUnits(c)}e.toLoci=a;function o(s,u,l){var c=typeof s=="function"?s(se):s,d=Lv(c);return d(new ps(u,l))}e.getStructureSelection=o})($i||($i={}));var uv;(function(e){function t(u,l){var c=u&&vi.Provider.get(u),d=c?c.assemblies.map(function(S){return[S.id,S.id+": "+is(S.details)]}):[],f=c?!Fo.isZero(c.spacegroup.cell):!0,h=[];if(c)for(var v=c.spacegroup.operators,p=0,m=v.length;p<m;p++)h.push([p,p+1+": "+Xu.getOperatorXyz(v[p])]);var g=[];u&&u.properties.structAsymMap.forEach(function(S){var x=S.id===S.auth_id?S.id:S.id+" [auth "+S.auth_id+"]";g.push([S.id,x])});var y={auto:I.EmptyGroup(),model:I.EmptyGroup(),assembly:I.Group({id:I.Optional(u?I.Select(d.length?d[0][0]:"",d,{label:"Asm Id",description:"Assembly Id"}):I.Text("",{label:"Asm Id",description:"Assembly Id (use empty for the 1st assembly)"}))},{isFlat:!0}),"symmetry-mates":I.Group({radius:I.Numeric(5,{min:0,max:50,step:1})},{isFlat:!0}),symmetry:I.Group({ijkMin:I.Vec3(_.create(-1,-1,-1),{step:1},{label:"Min IJK",fieldLabels:{x:"I",y:"J",z:"K"}}),ijkMax:I.Vec3(_.create(1,1,1),{step:1},{label:"Max IJK",fieldLabels:{x:"I",y:"J",z:"K"}})},{isFlat:!0}),"symmetry-assembly":I.Group({generators:I.ObjectList({operators:I.ObjectList({index:I.Select(0,h),shift:I.Vec3(_(),{step:1},{label:"IJK",fieldLabels:{x:"I",y:"J",z:"K"}})},function(S){return S.index+1+"_"+S.shift.map(function(x){return x+5}).join("")},{defaultValue:[]}),asymIds:I.MultiSelect([],g)},function(S){return S.asymIds.length+" asym ids, "+S.operators.length+" operators"},{defaultValue:[]})},{isFlat:!0})},b=[];return l==="auto"&&b.push(["auto","Auto"]),b.push(["model","Model"]),d.length>0&&b.push(["assembly","Assembly"]),f&&(b.push(["symmetry-mates","Symmetry Mates"]),b.push(["symmetry","Symmetry (indices)"]),b.push(["symmetry-assembly","Symmetry (assembly)"])),{type:I.MappedStatic(l||"model",y,{options:b})}}e.getParams=t;function r(u,l){return!(l.name==="symmetry-assembly"||l.name==="symmetry"&&u.name==="symmetry")}e.canAutoUpdate=r;function n(u,l,c,d){return ce(this,void 0,void 0,function(){var f,h,v,p,m,g;return de(this,function(y){switch(y.label){case 0:return f=void 0,h=vi.Provider.get(c),!d&&h&&h.assemblies.length!==0&&(d=h.assemblies[0].id),!h||h.assemblies.length===0?u.log.warn("Model '"+c.entryId+"' has no assembly, returning model structure."):(f=Wb.findAssembly(c,d||""),f||u.log.warn("Model '"+c.entryId+"' has no assembly called '"+d+"', returning model structure.")),v=We.ofModel(c),f?(d=f.id,[4,Bl.buildAssembly(v,d).runInContext(l)]):(p={label:"Model",description:We.elementDescription(v)},[2,new ge.Molecule.Structure(v,p)]);case 1:return m=y.sent(),g={label:"Assembly "+d,description:We.elementDescription(m)},[2,new ge.Molecule.Structure(m,g)]}})})}function i(u,l,c,d){return ce(this,void 0,void 0,function(){var f,h,v;return de(this,function(p){switch(p.label){case 0:return f=We.ofModel(l),[4,Bl.buildSymmetryRange(f,c,d).runInContext(u)];case 1:return h=p.sent(),v={label:"Symmetry ["+c+"] to ["+d+"]",description:We.elementDescription(h)},[2,new ge.Molecule.Structure(h,v)]}})})}function a(u,l,c){return ce(this,void 0,void 0,function(){var d,f,h;return de(this,function(v){switch(v.label){case 0:return d=We.ofModel(l),[4,Bl.builderSymmetryMates(d,c).runInContext(u)];case 1:return f=v.sent(),h={label:"Symmetry Mates",description:We.elementDescription(f)},[2,new ge.Molecule.Structure(f,h)]}})})}function o(u,l,c,d){return ce(this,void 0,void 0,function(){var f,h,v;return de(this,function(p){switch(p.label){case 0:return f=We.ofModel(l),[4,Bl.buildSymmetryAssembly(f,c,d).runInContext(u)];case 1:return h=p.sent(),v={label:"Symmetry Assembly",description:We.elementDescription(h)},[2,new ge.Molecule.Structure(h,v)]}})})}function s(u,l,c,d){return ce(this,void 0,void 0,function(){var f,h,h;return de(this,function(v){if(f=vi.Provider.get(c),!f||!d||d.name==="model")return h=We.ofModel(c),[2,new ge.Molecule.Structure(h,{label:"Model",description:We.elementDescription(h)})];if(d.name==="auto")return f.assemblies.length===0?(h=We.ofModel(c),[2,new ge.Molecule.Structure(h,{label:"Model",description:We.elementDescription(h)})]):[2,n(u,l,c)];if(d.name==="assembly")return[2,n(u,l,c,d.params.id)];if(d.name==="symmetry")return[2,i(l,c,d.params.ijkMin,d.params.ijkMax)];if(d.name==="symmetry-mates")return[2,a(l,c,d.params.radius)];if(d.name==="symmetry-assembly")return[2,o(l,c,d.params.generators,f)];throw new Error("Unknown represetation type: "+d.name)})})}e.create=s})(uv||(uv={}));var za;(function(e){function t(s,u,l){return s.currentStructure!==l?!1:$i.is(u)?!!s.script&&$i.areEqual(s.script,u):s.expression===u}e.isUnchanged=t;function r(s,u){var l=$i.is(u)?u:void 0,c=$i.is(u)?$i.toExpression(u):u,d=Lv(c);return{script:l,expression:c,compiled:d,originalStructure:s,currentStructure:s}}e.create=r;function n(s,u){return s.compiled(new ps(u))}e.run=n;function i(s,u){var l=r(s,u);return{entry:l,selection:n(l,s)}}e.createAndRun=i;function a(s,u){return s.currentStructure=u,s.compiled(new ps(u))}e.updateStructure=a;function o(s,u,l){var c=mt.unionStructure(u);s.label=""+(l||"Selection"),s.description=We.elementDescription(c),s.data=c}e.updateStructureObject=o})(za||(za={}));var n$e=function(){return{type:I.MappedStatic("static",{static:I.Text("polymer"),expression:I.Value(se.struct.generator.all),bundle:I.Value(on.Empty),script:I.Script({language:"mol-script",expression:"(sel.atom.all)"})},{isHidden:!0}),nullIfEmpty:I.Optional(I.Boolean(!0,{isHidden:!0})),label:I.Text("",{isHidden:!0})}};function i$e(e,t,r){r.source=e;var n=We.Empty,i=void 0;switch(t.type.name){case"static":{var a=void 0;switch(t.type.params){case"all":a=bi.all.query,i="All";break;case"polymer":a=bi.polymer.query,i="Polymer";break;case"protein":a=bi.protein.query,i="Protein";break;case"nucleic":a=bi.nucleic.query,i="Nucleic";break;case"water":a=sn.internal.water(),i="Water";break;case"ion":a=bi.ion.query,i="Ion";break;case"lipid":a=bi.lipid.query,i="Lipid";break;case"branched":a=bi.branchedPlusConnected.query,i="Branched";break;case"ligand":a=bi.ligandPlusConnected.query,i="Ligand";break;case"non-standard":a=bi.nonStandardPolymer.query,i="Non-standard";break;case"coarse":a=bi.coarse.query,i="Coarse";break;default:throw new Error(t.type+" is a not valid complex element.")}var o=a(new ps(e));n=mt.unionStructure(o);break}case"script":case"expression":{var s=za.createAndRun(e,t.type.params),u=s.selection,l=s.entry;r.entry=l,n=mt.unionStructure(u);break}case"bundle":{if(t.type.params.hash!==e.hashCode)break;n=on.toStructure(t.type.params,e);break}}if(t.nullIfEmpty&&n.elementCount===0)return Nn.Null;var c={label:""+(t.label||i||"Component"),description:We.elementDescription(n)};return new ge.Molecule.Structure(n,c)}function a$e(e,t,r,n,i){if(r.type.name!==n.type.name)return ft.UpdateResult.Recreate;var a=!1;switch(n.type.name){case"static":return r.type.params!==n.type.params||!We.areEquivalent(e,i.source)?ft.UpdateResult.Recreate:t.data.model===e.model?ft.UpdateResult.Unchanged:Xt.areHierarchiesEqual(e.model,t.data.model)?(t.data=t.data.remapModel(e.model),ft.UpdateResult.Updated):ft.UpdateResult.Recreate;case"script":if(!$i.areEqual(r.type.params,n.type.params))return ft.UpdateResult.Recreate;case"expression":{if(r.type.params!==n.type.params)return ft.UpdateResult.Recreate;if(e===i.source)break;var o=i.entry,s=za.updateStructure(o,e);i.source=e,t.data=mt.unionStructure(s),za.updateStructureObject(t,s,n.label),a=!0;break}case"bundle":{if(e===i.source&&on.areEqual(r.type.params,n.type.params))break;i.source=e,n.type.params.hash!==e.hashCode?(a=t.data.elementCount!==0,t.data=t.data.elementCount===0?t.data:We.Empty):(a=!0,t.data=on.toStructure(n.type.params,e));break}}if(a){if(n.nullIfEmpty&&t.data.elementCount===0)return ft.UpdateResult.Null;t.description=We.elementDescription(t.data)}return r.label!==n.label&&(a=!0,t.label=""+(n.label||t.label)),a?ft.UpdateResult.Updated:ft.UpdateResult.Unchanged}function Ete(e,t){for(var r=ht.create(e.data,t*2),n=ht.create(e.data,t*2),i=ht.create(e.data,t*2),a=ht.create(e.data,t*2),o=0;o<t;++o){It.markLine(e);var s=e.tokenStart,u=e.position;It.trim(e,s,s+10),ht.addUnchecked(r,e.tokenStart,e.tokenEnd),It.trim(e,s+10,s+20),ht.addUnchecked(n,e.tokenStart,e.tokenEnd),It.trim(e,s+20,s+30),ht.addUnchecked(i,e.tokenStart,e.tokenEnd),It.trim(e,s+31,s+34),ht.addUnchecked(a,e.tokenStart,e.tokenEnd),e.position=u}return{count:t,x:Qr(r)(ve.Schema.float),y:Qr(n)(ve.Schema.float),z:Qr(i)(ve.Schema.float),type_symbol:Qr(a)(ve.Schema.str)}}function Ate(e,t){for(var r=ht.create(e.data,t*2),n=ht.create(e.data,t*2),i=ht.create(e.data,t*2),a=0;a<t;++a){It.markLine(e);var o=e.tokenStart,s=e.position;It.trim(e,o,o+3),ht.addUnchecked(r,e.tokenStart,e.tokenEnd),It.trim(e,o+3,o+6),ht.addUnchecked(n,e.tokenStart,e.tokenEnd),It.trim(e,o+6,o+9),ht.addUnchecked(i,e.tokenStart,e.tokenEnd),e.position=s}return{count:t,atomIdxA:Qr(r)(ve.Schema.int),atomIdxB:Qr(n)(ve.Schema.int),order:Qr(i)(ve.Schema.int)}}function o$e(e){var t=It(e),r=It.readLine(t).trim(),n=It.readLine(t).trim(),i=It.readLine(t).trim(),a=It.readLine(t),o=+a.substr(0,3),s=+a.substr(3,3),u=Ete(t,o),l=Ate(t,s),c={title:r,program:n,comment:i,atoms:u,bonds:l};return Rn.success(c)}function s$e(e){var t=this;return $e.create("Parse Mol",function(){return ce(t,void 0,void 0,function(){return de(this,function(r){return[2,o$e(e)]})})})}function Pte(e,t,r){return ce(this,void 0,void 0,function(){var n,i,a,o,s,u,l,c,d,f,h,v,p,m,g;return de(this,function(y){switch(y.label){case 0:return n=e.atoms,i=e.bonds,a=ve.ofConst("MOL",e.atoms.count,ve.Schema.str),o=ve.ofConst("A",e.atoms.count,ve.Schema.str),s=ve.asArrayColumn(n.type_symbol),u=ve.ofConst(1,n.count,ve.Schema.int),l=en.ofPartialColumns(ao.atom_site,{auth_asym_id:o,auth_atom_id:s,auth_comp_id:a,auth_seq_id:u,Cartn_x:ve.asArrayColumn(n.x,Float32Array),Cartn_y:ve.asArrayColumn(n.y,Float32Array),Cartn_z:ve.asArrayColumn(n.z,Float32Array),id:ve.range(0,n.count-1),label_asym_id:o,label_atom_id:s,label_comp_id:a,label_seq_id:u,label_entity_id:ve.ofConst("1",n.count,ve.Schema.str),occupancy:ve.ofConst(1,n.count,ve.Schema.float),type_symbol:s,pdbx_PDB_model_num:ve.ofConst(1,n.count,ve.Schema.int)},n.count),c=new Wh,c.setNames([["MOL","Unknown Entity"]]),c.getEntityId("MOL",0,"A"),d=new $h(u,s),d.setNames([["MOL","Unknown Molecule"]]),d.add("MOL",0),f=tm({entity:c.getEntityTable(),chem_comp:d.getChemCompTable(),atom_site:l}),[4,Od(f,t??tR.create(e),r)];case 1:return h=y.sent(),h.frameCount>0&&(v=ve.ofIntArray(ve.mapToArray(i.atomIdxA,function(b){return b-1},Int32Array)),p=ve.ofIntArray(ve.mapToArray(i.atomIdxB,function(b){return b-1},Int32Array)),m=ve.asArrayColumn(i.order,Int32Array),g=wa.fromData({pairs:{indexA:v,indexB:p,order:m},count:n.count}),wa.Provider.set(h.representative,g)),[2,h]}})})}var tR;(function(e){function t(n){return(n==null?void 0:n.kind)==="mol"}e.is=t;function r(n){return{kind:"mol",name:n.title,data:n}}e.create=r})(tR||(tR={}));function u$e(e){return $e.create("Parse MOL",function(t){return Pte(e,void 0,t)})}function l$e(e){var t=e.IT_number.value(0),r=e["name_H-M_full"].value(0);return e.IT_number.isDefined?(e["name_H-M_full"].isDefined,t):r}function c$e(e){var t=e.cell,r=e.space_group,n=l$e(r),i=Fo.create(n,_.create(t.length_a.value(0),t.length_b.value(0),t.length_c.value(0)),_.scale(_(),_.create(t.angle_alpha.value(0),t.angle_beta.value(0),t.angle_gamma.value(0)),Math.PI/180));return{spacegroup:Xu.create(i),assemblies:[],isNonStandardCrystalFrame:!1,ncsOperators:[]}}function d$e(e,t,r){var n;return ce(this,void 0,void 0,function(){var i,a,o,s,u,l,c,d,f,h,v,p,m,g,Se,y,b,S,x,C,D,w,Se,A,M,D,Se,k,R,O,H,B,j,Y,G,$,q,Se,ee,fe,W,X,U,z,J,K,Z,te,le,ye,be,Ae,Se,ie,oe,F,V;return de(this,function(pe){switch(pe.label){case 0:for(i=e.atom_site._rowCount,a=ve.ofConst("MOL",i,ve.Schema.str),o=ve.ofConst("A",i,ve.Schema.str),s=ve.ofConst(1,i,ve.Schema.int),u=c$e(e),l=u.spacegroup.cell.fromFractional,c=e.atom_site,d=c.fract_x,f=c.fract_y,h=c.fract_z,v=new Float32Array(i),p=new Float32Array(i),m=new Float32Array(i),g=_(),Se=0;Se<i;++Se)_.set(g,d.value(Se),f.value(Se),h.value(Se)),_.transformMat4(g,g,l),v[Se]=g[0],p[Se]=g[1],m[Se]=g[2];if(y=e.atom_site,b=y.type_symbol,S=y.label,b.isDefined){for(D=new Array(i),w=new Int8Array(i),Se=0;Se<i;++Se)A=b.value(Se),M=A.length,A[M-1]==="+"?(D[Se]=A.substring(0,M-2),w[Se]=parseInt(A[M-2])):A[M-2]==="+"?(D[Se]=A.substring(0,M-2),w[Se]=parseInt(A[M-1])):A[M-1]==="-"?(D[Se]=A.substring(0,M-2),w[Se]=-parseInt(A[M-2])):A[M-2]==="-"?(D[Se]=A.substring(0,M-2),w[Se]=-parseInt(A[M-1])):(D[Se]=A,w[Se]=0);x=ve.ofStringArray(D),C=ve.ofIntArray(w)}else{for(D=new Array(i),Se=0;Se<i;++Se)D[Se]=aA(S.value(Se));x=ve.ofStringArray(D),C=ve.Undefined(i,ve.Schema.int)}return k=en.ofPartialColumns(ao.atom_site,{auth_asym_id:o,auth_atom_id:S,auth_comp_id:a,auth_seq_id:s,Cartn_x:ve.ofFloatArray(v),Cartn_y:ve.ofFloatArray(p),Cartn_z:ve.ofFloatArray(m),id:ve.range(0,i-1),label_asym_id:o,label_atom_id:S,label_comp_id:a,label_seq_id:s,label_entity_id:ve.ofConst("1",i,ve.Schema.str),occupancy:e.atom_site.occupancy.isDefined?e.atom_site.occupancy:ve.ofConst(1,i,ve.Schema.float),type_symbol:x,pdbx_formal_charge:C,pdbx_PDB_model_num:ve.ofConst(1,i,ve.Schema.int),B_iso_or_equiv:e.atom_site.U_iso_or_equiv},i),R=e.chemical.name_common.value(0)||e.chemical.name_systematic.value(0)||e.chemical_formula.sum.value(0),O=new Wh,O.setNames([["MOL",R||"Unknown Entity"]]),O.getEntityId("MOL",0,"A"),H=new $h(s,e.atom_site.type_symbol),H.setNames([["MOL",R||"Unknown Molecule"]]),H.add("MOL",0),B=tm({entity:O.getEntityTable(),chem_comp:H.getChemCompTable(),atom_site:k}),[4,Od(B,t,r)];case 1:if(j=pe.sent(),j.frameCount>0&&(Y=j.representative,vi.Provider.set(Y,u),G=e.geom_bond._rowCount,G>0)){for($={},q=e.atom_site.label,Se=0,ee=q.rowCount;Se<ee;++Se)$[q.value(Se)]=Se;for(fe=(n=t.data.frame.categories.ccdc_geom_bond_type)===null||n===void 0?void 0:n.getField(""),W=[],X=[],U=[],z=[],J=[],K=new Set,Z=0,te=e.geom_bond,le=te.atom_site_label_1,ye=te.atom_site_label_2,be=te.valence,Ae=te.distance,Se=0;Se<G;++Se)ie=$[le.value(Se)],oe=$[ye.value(Se)],F=ie<oe?ph(ie,oe):ph(oe,ie),!K.has(F)&&(K.add(F),W[Z]=ie,X[Z]=oe,z[Z]=Ae.value(Se)||-1,fe?(V=fe.str(Se),V==="D"?(U[Z]=2,J[Z]=1):V==="A"?(U[Z]=1,J[Z]=17):(U[Z]=1,J[Z]=1)):(J[Z]=1,U[Z]=be.isDefined?be.value(Se):1),Z+=1);wa.Provider.set(Y,wa.fromData({pairs:{indexA:ve.ofIntArray(W),indexB:ve.ofIntArray(X),order:ve.ofIntArray(U),distance:ve.ofFloatArray(z),flag:ve.ofIntArray(J)},count:i}))}return[2,j]}})})}function f$e(e){if(t2.is(e.sourceData)){var t=e.sourceData.data.db,r=t.atom_site,n=t.atom_site_aniso,i=en.ofPartialColumns(Jl.Schema,{U:n.U,U_esd:n.U_su},n._rowCount),a=Jl.getElementToAnsiotropFromLabel(r.label,n.label);return{data:i,elementToAnsiotrop:a}}}function h$e(e){return t2.is(e.sourceData)?e.sourceData.data.db.atom_site_aniso.U.isDefined:!1}Jl.Provider.formatRegistry.add("cifCore",f$e,h$e);var t2;(function(e){function t(n){return(n==null?void 0:n.kind)==="cifCore"}e.is=t;function r(n,i){i||(i=vd.schema.cifCore(n));var a=i.database_code.depnum_ccdc_archive.value(0)||i.database_code.depnum_ccdc_fiz.value(0)||i.database_code.ICSD.value(0)||i.database_code.MDF.value(0)||i.database_code.NBS.value(0)||i.database_code.CSD.value(0)||i.database_code.COD.value(0)||i._name;return{kind:"cifCore",name:a,data:{db:i,frame:n}}}e.fromFrame=r})(t2||(t2={}));function p$e(e){var t=t2.fromFrame(e);return $e.create("Parse CIF Core",function(r){return d$e(t.data.db,t,r)})}function v$e(e,t){return ce(this,void 0,void 0,function(){var r,n,i,a,o,s,u,l,c;return de(this,function(d){switch(d.label){case 0:return r=e.atoms,n=ve.ofConst("MOL",e.atoms.count,ve.Schema.str),i=ve.ofConst("A",e.atoms.count,ve.Schema.str),a=ve.ofArray({array:ve.mapToArray(r.number,function(f){return H6e(f)}),schema:ve.Schema.Aliased(ve.Schema.str)}),o=ve.ofConst(1,r.count,ve.Schema.int),s=en.ofPartialColumns(ao.atom_site,{auth_asym_id:i,auth_atom_id:a,auth_comp_id:n,auth_seq_id:o,Cartn_x:ve.asArrayColumn(r.x,Float32Array),Cartn_y:ve.asArrayColumn(r.y,Float32Array),Cartn_z:ve.asArrayColumn(r.z,Float32Array),id:ve.range(0,r.count-1),label_asym_id:i,label_atom_id:a,label_comp_id:n,label_seq_id:o,label_entity_id:ve.ofConst("1",r.count,ve.Schema.str),occupancy:ve.ofConst(1,r.count,ve.Schema.float),type_symbol:a,pdbx_PDB_model_num:ve.ofConst(1,r.count,ve.Schema.int)},r.count),u=new Wh,u.setNames([["MOL","Unknown Entity"]]),u.getEntityId("MOL",0,"A"),l=new $h(o,a),l.setNames([["MOL","Unknown Molecule"]]),l.add("MOL",0),c=tm({entity:u.getEntityTable(),chem_comp:l.getChemCompTable(),atom_site:s}),[4,Od(c,rR.create(e),t)];case 1:return[2,d.sent()]}})})}var rR;(function(e){function t(n){return(n==null?void 0:n.kind)==="cube"}e.is=t;function r(n){return{kind:"cube",name:n.header.comment1,data:n}}e.create=r})(rR||(rR={}));function m$e(e){return $e.create("Parse Cube",function(t){return v$e(e,t)})}var xF=It.skipWhitespace,Tte=It.eatValue,wl=It.markLine,El=It.getTokenString,Ite=It.readLine;function g$e(){return{mol_name:"",num_atoms:0,num_bonds:0,num_subst:0,num_feat:0,num_sets:0,mol_type:"",charge_type:"",status_bits:"",mol_comment:""}}function y$e(e,t){return{tokenizer:e,molecule:g$e(),runtimeCtx:t}}var b$e=/\s+/g;function x$e(e){for(var t=e.tokenizer,r=e.molecule;El(t)!=="@<TRIPOS>MOLECULE"&&t.position<t.data.length;)wl(t);wl(t),r.mol_name=El(t),wl(t);var n=El(t).trim().split(b$e);r.num_atoms=parseInt(n[0]),r.num_bonds=parseInt(n[1]),r.num_subst=parseInt(n[2]),r.num_feat=parseInt(n[3]),r.num_sets=parseInt(n[4]),wl(t);var i=El(t);if(!i.startsWith("@<TRIPOS>")){r.mol_type=i,wl(t);var a=El(t);if(!a.startsWith("@<TRIPOS>")){r.charge_type=a,wl(t);var o=El(t);if(!o.startsWith("@<TRIPOS>")){r.status_bits=o,wl(t);var s=El(t);s.startsWith("@<TRIPOS>")||(r.mol_comment=s)}}}}function S$e(e){return ce(this,void 0,void 0,function(){var t,r,n,i,a,o,s,u,l,c,d,f,h,v,p,m,g,y,b,S,x,C,w;return de(this,function(A){switch(A.label){case 0:for(t=e.tokenizer,r=e.molecule;El(t)!=="@<TRIPOS>ATOM"&&t.position<t.data.length;)wl(t);return n=t.position,i=t.lineNumber,a=Ite(t),o=a.trim().split(/\s+/g),s=o.length,u=ht.create(t.data,r.num_atoms*2),l=ht.create(t.data,r.num_atoms*2),c=ht.create(t.data,r.num_atoms*2),d=ht.create(t.data,r.num_atoms*2),f=ht.create(t.data,r.num_atoms*2),h=ht.create(t.data,r.num_atoms*2),v=ht.create(t.data,r.num_atoms*2),p=ht.create(t.data,r.num_atoms*2),m=ht.create(t.data,r.num_atoms*2),g=ht.create(t.data,r.num_atoms*2),y=ve.Undefined(r.num_atoms,ve.Schema.float),b=ve.Undefined(r.num_atoms,ve.Schema.int),S=ve.Undefined(r.num_atoms,ve.Schema.str),t.position=n,t.lineNumber=i,x=t.length,C=0,[4,fd(e.runtimeCtx,1e5,void 0,function(M){for(var D=Math.min(r.num_atoms-C,M),k=0;k<D;k++)for(var R=0;R<s;R++)switch(xF(t),t.tokenStart=t.position,Tte(t),R){case 0:ht.addUnchecked(u,t.tokenStart,t.tokenEnd);break;case 1:ht.addUnchecked(l,t.tokenStart,t.tokenEnd);break;case 2:ht.addUnchecked(c,t.tokenStart,t.tokenEnd);break;case 3:ht.addUnchecked(d,t.tokenStart,t.tokenEnd);break;case 4:ht.addUnchecked(f,t.tokenStart,t.tokenEnd);break;case 5:ht.addUnchecked(h,t.tokenStart,t.tokenEnd);break;case 6:ht.addUnchecked(v,t.tokenStart,t.tokenEnd);break;case 7:ht.addUnchecked(p,t.tokenStart,t.tokenEnd);break;case 8:ht.addUnchecked(m,t.tokenStart,t.tokenEnd);break;case 9:ht.addUnchecked(g,t.tokenStart,t.tokenEnd);break}return C+=D,D},function(M){return M.update({message:"Parsing...",current:t.position,max:x})})];case 1:return A.sent(),w={count:r.num_atoms,atom_id:Qr(u)(ve.Schema.int),atom_name:Qr(l)(ve.Schema.str),x:Qr(c)(ve.Schema.float),y:Qr(d)(ve.Schema.float),z:Qr(f)(ve.Schema.float),atom_type:s>5?Qr(h)(ve.Schema.str):S,subst_id:s>6?Qr(v)(ve.Schema.int):b,subst_name:s>7?Qr(p)(ve.Schema.str):S,charge:s>8?Qr(m)(ve.Schema.float):y,status_bit:s>9?Qr(g)(ve.Schema.str):S},[2,w]}})})}function C$e(e){return ce(this,void 0,void 0,function(){var t,r,n,i,a,o,s,u,l,c,d,f,h,v,p;return de(this,function(m){switch(m.label){case 0:for(t=e.tokenizer,r=e.molecule;El(t)!=="@<TRIPOS>BOND"&&t.position<t.data.length;)wl(t);return n=t.position,i=t.lineNumber,a=Ite(t),o=a.trim().split(/\s+/g),s=o.length,u=ht.create(t.data,r.num_bonds*2),l=ht.create(t.data,r.num_bonds*2),c=ht.create(t.data,r.num_bonds*2),d=ht.create(t.data,r.num_bonds*2),f=ht.create(t.data,r.num_bonds*2),t.position=n,t.lineNumber=i,h=t.length,v=0,[4,fd(e.runtimeCtx,1e5,void 0,function(g){for(var y=Math.min(r.num_bonds-v,g),b=0;b<y;b++)for(var S=0;S<s;S++)switch(xF(t),t.tokenStart=t.position,Tte(t),S){case 0:ht.addUnchecked(u,t.tokenStart,t.tokenEnd);break;case 1:ht.addUnchecked(l,t.tokenStart,t.tokenEnd);break;case 2:ht.addUnchecked(c,t.tokenStart,t.tokenEnd);break;case 3:ht.addUnchecked(d,t.tokenStart,t.tokenEnd);break;default:ht.addUnchecked(f,t.tokenStart,t.tokenEnd);break}return v+=y,y},function(g){return g.update({message:"Parsing...",current:t.position,max:h})})];case 1:return m.sent(),p={count:r.num_bonds,bond_id:Qr(u)(ve.Schema.int),origin_atom_id:Qr(l)(ve.Schema.int),target_atom_id:Qr(c)(ve.Schema.int),bond_type:Qr(d)(ve.Schema.str),status_bits:s>4?Qr(f)(ve.Schema.str):ve.Undefined(r.num_bonds,ve.Schema.str)},[2,p]}})})}function _$e(e,t,r){return ce(this,void 0,void 0,function(){var n,i,a,o,s,u;return de(this,function(l){switch(l.label){case 0:n=It(t),e.update({message:"Parsing...",current:0,max:t.length}),i=[],l.label=1;case 1:return n.position<t.length?(a=y$e(n,e),x$e(a),[4,S$e(a)]):[3,4];case 2:return o=l.sent(),[4,C$e(a)];case 3:for(s=l.sent(),i.push({molecule:a.molecule,atoms:o,bonds:s}),xF(n);El(n)!=="@<TRIPOS>MOLECULE"&&n.position<n.data.length;)wl(n);return[3,1];case 4:return u={name:r,structures:i},[2,Rn.success(u)]}})})}function w$e(e,t){var r=this;return $e.create("Parse MOL2",function(n){return ce(r,void 0,void 0,function(){return de(this,function(i){switch(i.label){case 0:return[4,_$e(n,e,t)];case 1:return[2,i.sent()]}})})})}function E$e(e,t){return ce(this,void 0,void 0,function(){var r,n,i,a,o,s,u,l,c,d,f,h,v,p,m,g,y,b,S,x,C,w,A;return de(this,function(M){switch(M.label){case 0:r=[],n=0,i=e.structures.length,M.label=1;case 1:if(!(n<i))return[3,4];for(a=e.structures[n],o=a.atoms,s=a.bonds,u=a.molecule,l=ve.ofConst("A",o.count,ve.Schema.str),c=new Array(o.count),d=0;d<o.count;++d)c[d]=aA(o.atom_name.value(d));for(f=en.ofPartialColumns(ao.atom_site,{auth_asym_id:l,auth_atom_id:ve.asArrayColumn(o.atom_name),auth_comp_id:o.subst_name,auth_seq_id:o.subst_id,Cartn_x:ve.asArrayColumn(o.x,Float32Array),Cartn_y:ve.asArrayColumn(o.y,Float32Array),Cartn_z:ve.asArrayColumn(o.z,Float32Array),id:ve.asArrayColumn(o.atom_id),label_asym_id:l,label_atom_id:ve.asArrayColumn(o.atom_name),label_comp_id:o.subst_name,label_seq_id:o.subst_id,label_entity_id:ve.ofConst("1",o.count,ve.Schema.str),occupancy:ve.ofConst(1,o.count,ve.Schema.float),type_symbol:ve.ofStringArray(c),pdbx_PDB_model_num:ve.ofConst(n,o.count,ve.Schema.int)},o.count),h=new Wh,h.setNames([["MOL",u.mol_name||"Unknown Entity"]]),h.getEntityId("MOL",0,"A"),v=new $h(o.subst_id,o.atom_name),p=0,m=o.subst_name.rowCount;p<m;++p)v.add(o.subst_name.value(p),p);return g=tm({entity:h.getEntityTable(),chem_comp:v.getChemCompTable(),atom_site:f}),[4,Od(g,nR.create(e),t)];case 2:y=M.sent(),y.frameCount>0&&(b=ve.ofIntArray(ve.mapToArray(s.origin_atom_id,function(D){return D-1},Int32Array)),S=ve.ofIntArray(ve.mapToArray(s.target_atom_id,function(D){return D-1},Int32Array)),x=ve.ofIntArray(ve.mapToArray(s.bond_type,function(D){switch(D){case"ar":case"am":case"un":return 1;case"du":case"nc":return 0;default:return parseInt(D)}},Int8Array)),C=ve.ofIntArray(ve.mapToArray(s.bond_type,function(D){switch(D){case"ar":return 17;case"du":case"nc":return 0;case"am":case"un":default:return 1}},Int8Array)),w=wa.fromData({pairs:{indexA:b,indexB:S,order:x,flag:C},count:o.count}),A=y.representative,wa.Provider.set(A,w),y0.Provider.set(A,{data:o.charge,type:u.charge_type}),r.push(A)),M.label=3;case 3:return++n,[3,1];case 4:return[2,new Ov(r)]}})})}var nR;(function(e){function t(n){return(n==null?void 0:n.kind)==="mol2"}e.is=t;function r(n){return{kind:"mol2",name:n.name,data:n}}e.create=r})(nR||(nR={}));function A$e(e){return $e.create("Parse MOL2",function(t){return E$e(e,t)})}var Om=new Uint32Array([0,0,0,0,0,0,0,0,0,8,10,12,16,20,25,32,40,50,64,80,101,128,161,203,256,322,406,512,645,812,1024,1290,1625,2048,2580,3250,4096,5060,6501,8192,10321,13003,16384,20642,26007,32768,41285,52015,65536,82570,104031,131072,165140,208063,262144,330280,416127,524287,660561,832255,1048576,1321122,1664510,2097152,2642245,3329021,4194304,5284491,6658042,8388607,10568983,13316085,16777216]),IT=9,Co;(function(e){function t(c){for(var d=1,f=0;c>=d&&f<32;)f++,d<<=1;return f}e.sizeOfInt=t;var r=new Uint8Array(32);function n(c,d){var f=1,h=0;r[0]=1;for(var v=0;v<c;v++){var p=void 0,m=0;for(p=0;p<f;p++)m+=r[p]*d[v],r[p]=m&255,m>>=8;for(;m!==0;)r[p++]=m&255,m>>=8;f=p}var g=1;for(f--;r[f]>=g;)h++,g*=2;return h+f*8}e.sizeOfInts=n;var i=new ArrayBuffer(8*3);e.buf=new Int32Array(i);var a=new Uint32Array(i);function o(c,d,f){for(var h=f,v=(1<<h)-1,p=a[1],m=a[2],g=e.buf[0],y=0;h>=8;)m=m<<8|c[d+g++],y|=m>>p<<h-8,h-=8;return h>0&&(p<h&&(p+=8,m=m<<8|c[d+g++]),p-=h,y|=m>>p&(1<<h)-1),y&=v,e.buf[0]=g,e.buf[1]=p,e.buf[2]=m,y}e.decodeBits=o;function s(c,d){var f=a[2],h=e.buf[0];return f=f<<8|c[d+h],e.buf[0]=h+1,e.buf[2]=f,f>>a[1]&255}var u=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];function l(c,d,f,h,v){var p=f,m=0;for(u[0]=0,u[1]=0,u[2]=0,u[3]=0;p>8;)u[m++]=s(c,d),p-=8;p>0&&(u[m++]=o(c,d,p));for(var g=2;g>0;g--){for(var y=0,b=h[g],S=m-1;S>=0;S--){y=y<<8|u[S];var x=y/b|0;u[S]=x,y=y-x*b}v[g]=y}v[0]=u[0]|u[1]<<8|u[2]<<16|u[3]<<24}e.decodeInts=l})(Co||(Co={}));function P$e(){throw new Error("(xdrfile error) Undefined error.")}function T$e(e,t){return ce(this,void 0,void 0,function(){var r,n,i,a,o,s,u,l,c,d,f,h,v,p,m,g,O,O,y,b,S,x,C,w,A,M,D,k,R,O,H,B,j,Y,G;return de(this,function($){switch($.label){case 0:r=new DataView(t.buffer,t.byteOffset),n={frames:[],boxes:[],times:[],timeOffset:0,deltaTime:0},i=n.frames,a=n.boxes,o=n.times,s=[0,0,0,0,0,0],u=[0,0,0],l=[0,0,0],c=[0,0,0],d=[.1,.1,.1],f=[.1,.1,.1],h=0,v=Co.buf,$.label=1;case 1:for(p=void 0,m=r.getInt32(h+4),h+=12,o.push(r.getFloat32(h)),h+=4,g=new Float32Array(9),O=0;O<9;++O)g[O]=r.getFloat32(h)*10,h+=4;if(a.push(g),m<=9)for(p={count:m/3,x:new Float32Array(m/3),y:new Float32Array(m/3),z:new Float32Array(m/3)},O=0;O<m/3;++O)p.x[O]=r.getFloat32(h),p.y[O]=r.getFloat32(h),p.z[O]=r.getFloat32(h),h+=4;else{for(v[0]=v[1]=v[2]=0,u[0]=u[1]=u[2]=0,c[0]=c[1]=c[2]=0,l[0]=l[1]=l[2]=0,d[0]=d[1]=d[2]=0,f[0]=f[1]=f[2]=0,p={count:m,x:new Float32Array(m),y:new Float32Array(m),z:new Float32Array(m)},y=0,b=r.getInt32(h),h+=4,S=r.getFloat32(h),h+=4,s[0]=r.getInt32(h),s[1]=r.getInt32(h+4),s[2]=r.getInt32(h+8),s[3]=r.getInt32(h+12),s[4]=r.getInt32(h+16),s[5]=r.getInt32(h+20),u[0]=s[3]-s[0]+1,u[1]=s[4]-s[1]+1,u[2]=s[5]-s[2]+1,h+=24,x=void 0,(u[0]|u[1]|u[2])>16777215?(l[0]=Co.sizeOfInt(u[0]),l[1]=Co.sizeOfInt(u[1]),l[2]=Co.sizeOfInt(u[2]),x=0):x=Co.sizeOfInts(3,u),C=r.getInt32(h),h+=4,w=C-1,w=IT>w?IT:w,A=Om[w]/2|0,M=Om[C]/2|0,c[0]=c[1]=c[2]=Om[C],D=Math.ceil(r.getInt32(h)/4)*4,h+=4,k=1/S,R=0,O=0,d[0]=d[1]=d[2]=0;O<b;){if(x===0?(d[0]=Co.decodeBits(t,h,l[0]),d[1]=Co.decodeBits(t,h,l[1]),d[2]=Co.decodeBits(t,h,l[2])):Co.decodeInts(t,h,x,u,d),O++,d[0]+=s[0],d[1]+=s[1],d[2]+=s[2],f[0]=d[0],f[1]=d[1],f[2]=d[2],H=Co.decodeBits(t,h,1),B=0,H===1&&(R=Co.decodeBits(t,h,5),B=R%3,R-=B,B--),R>0)for(d[0]=d[1]=d[2]=0,j=0;j<R;j+=3)Co.decodeInts(t,h,C,c,d),O++,d[0]+=f[0]-M,d[1]+=f[1]-M,d[2]+=f[2]-M,j===0?(Y=d[0],d[0]=f[0],f[0]=Y,Y=d[1],d[1]=f[1],f[1]=Y,Y=d[2],d[2]=f[2],f[2]=Y,p.x[y]=f[0]*k,p.y[y]=f[1]*k,p.z[y]=f[2]*k,y++):(f[0]=d[0],f[1]=d[1],f[2]=d[2]),p.x[y]=d[0]*k,p.y[y]=d[1]*k,p.z[y]=d[2]*k,y++;else p.x[y]=d[0]*k,p.y[y]=d[1]*k,p.z[y]=d[2]*k,y++;C+=B,B<0?(M=A,C>IT?A=Om[C-1]/2|0:A=0):B>0&&(A=M,M=Om[C]/2|0),c[0]=c[1]=c[2]=Om[C],(c[0]===0||c[1]===0||c[2]===0)&&P$e()}h+=D}for(G=0;G<m;G++)p.x[G]*=10,p.y[G]*=10,p.z[G]*=10;return i.push(p),e.shouldUpdate?[4,e.update({current:h,max:t.length})]:[3,3];case 2:$.sent(),$.label=3;case 3:return h>=t.length?[3,4]:[3,1];case 4:return o.length>=1&&(n.timeOffset=o[0]),o.length>=2&&(n.deltaTime=o[1]-o[0]),[2,n]}})})}function I$e(e){var t=this;return $e.create("Parse XTC",function(r){return ce(t,void 0,void 0,function(){var n,i;return de(this,function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),r.update({canAbort:!0,message:"Parsing trajectory..."}),[4,T$e(r,e)];case 1:return n=a.sent(),[2,Rn.success(n)];case 2:return i=a.sent(),[2,Rn.error(""+i)];case 3:return[2]}})})})}function M$e(e){var t=this;return $e.create("Parse XTC",function(r){return ce(t,void 0,void 0,function(){var n,i,a,o,s,u,l,c,d;return de(this,function(f){switch(f.label){case 0:return[4,r.update("Converting to coordinates")];case 1:for(f.sent(),n=Bf(e.deltaTime,"step"),i=Bf(e.timeOffset,n.unit),a=[],o=0,s=e.frames.length;o<s;++o)u=e.boxes[o],l=_.fromArray(_(),u,0),c=_.fromArray(_(),u,3),d=_.fromArray(_(),u,6),a.push({elementCount:e.frames[o].count,cell:sv.fromBasis(l,c,d),x:e.frames[o].x,y:e.frames[o].y,z:e.frames[o].z,xyzOrdering:{isIdentity:!0},time:Bf(i.value+n.value*o,n.unit)});return[2,Gb.create(a,n,i)]}})})})}function D$e(e){var t=e.position>=e.data.length-1?0:+It.readLine(e);isNaN(t)&&(t=0);for(var r=It.readLine(e),n=new Float64Array(t),i=new Float64Array(t),a=new Float64Array(t),o=new Array(t),s=0;s<t;++s){var u=It.readLineTrim(e),l=u.split(/\s+/g);o[s]=l[0],n[s]=+l[1],i[s]=+l[2],a[s]=+l[3]}return{count:t,comment:r,x:ve.ofFloatArray(n),y:ve.ofFloatArray(i),z:ve.ofFloatArray(a),type_symbol:ve.ofStringArray(o)}}function R$e(e){for(var t=It(e),r=[];;){var n=D$e(t);if(n.count===0)break;r.push(n)}var i={molecules:r};return Rn.success(i)}function k$e(e){var t=this;return $e.create("Parse Mol",function(){return ce(t,void 0,void 0,function(){return de(this,function(r){return[2,R$e(e)]})})})}function O$e(e,t){for(var r=e.molecules,n=0,i=0,a=r;i<a.length;i++){var o=a[i];n+=o.count}for(var s=new Array(n),u=new Int32Array(n),l=new Float32Array(n),c=new Float32Array(n),d=new Float32Array(n),f=new Int32Array(n),h=0,v=0;v<r.length;v++)for(var o=r[v],p=0;p<o.count;p++)s[h]=o.type_symbol.value(p),l[h]=o.x.value(p),c[h]=o.y.value(p),d[h]=o.z.value(p),u[h]=p,f[h]=v,h++;var m=ve.ofConst("MOL",n,ve.Schema.str),g=ve.ofConst("A",n,ve.Schema.str),y=ve.ofConst(1,n,ve.Schema.int),b=ve.ofStringArray(s),S=en.ofPartialColumns(ao.atom_site,{auth_asym_id:g,auth_atom_id:b,auth_comp_id:m,auth_seq_id:y,Cartn_x:ve.ofFloatArray(l),Cartn_y:ve.ofFloatArray(c),Cartn_z:ve.ofFloatArray(d),id:ve.ofIntArray(u),label_asym_id:g,label_atom_id:b,label_comp_id:m,label_seq_id:y,label_entity_id:ve.ofConst("1",n,ve.Schema.str),occupancy:ve.ofConst(1,n,ve.Schema.float),type_symbol:b,pdbx_PDB_model_num:ve.ofIntArray(f)},n),x=new Wh;x.setNames([["MOL","Unknown Entity"]]),x.getEntityId("MOL",0,"A");var C=new $h(y,b);C.setNames([["MOL","Unknown Molecule"]]),C.add("MOL",0);var w=tm({entity:x.getEntityTable(),chem_comp:C.getChemCompTable(),atom_site:S});return Od(w,iR.create(e),t)}var iR;(function(e){function t(n){return(n==null?void 0:n.kind)==="xyz"}e.is=t;function r(n){return{kind:"xyz",name:"xyz",data:n}}e.create=r})(iR||(iR={}));function F$e(e){return $e.create("Parse XYZ",function(t){return O$e(e,t)})}var aR="$$$$";function L$e(e){for(var t=ht.create(e.data,32),r=ht.create(e.data,32);e.position<e.length;){var n=It.readLine(e);if(n.startsWith(aR))break;if(n&&n.startsWith("> ")){ht.add(t,e.tokenStart+2,e.tokenEnd),It.markLine(e);for(var i=e.tokenStart,a=e.tokenEnd,o=!1;e.position<e.length;){var s=It.readLine(e);if(!s||s.startsWith(aR)||s.startsWith("> ")){ht.add(r,i,a),o=!0;break}a=e.tokenEnd}o||ht.add(r,i,a)}}return{dataHeader:Qr(t)(ve.Schema.str),data:Qr(r)(ve.Schema.str)}}function N$e(e){var t=It.readLine(e).trim(),r=It.readLine(e).trim(),n=It.readLine(e).trim(),i=It.readLine(e),a=+i.substr(0,3),o=+i.substr(3,3);if(Number.isNaN(a)||Number.isNaN(o)){for(;e.position<e.length;){var s=It.readLine(e);if(s.startsWith(aR))break}return}var u=Ete(e,a),l=Ate(e,o),c=L$e(e);return{molFile:{title:t,program:r,comment:n,atoms:u,bonds:l},dataItems:c}}function B$e(e){for(var t=It(e),r=[];t.position<t.length;){var n=N$e(t);n&&r.push(n)}return Rn.success({compounds:r})}function U$e(e){var t=this;return $e.create("Parse Sdf",function(){return ce(t,void 0,void 0,function(){return de(this,function(r){return[2,B$e(e)]})})})}var oR;(function(e){function t(n){return(n==null?void 0:n.kind)==="sdf"}e.is=t;function r(n){return{kind:"sdf",name:n.molFile.title,data:n}}e.create=r})(oR||(oR={}));function j$e(e){return $e.create("Parse SDF",function(t){return Pte(e.molFile,oR.create(e),t)})}var z$e=kt.BuiltIn({name:"coordinates-from-dcd",display:{name:"Parse DCD",description:"Parse DCD binary data."},from:[ge.Data.Binary],to:ge.Molecule.Coordinates})({apply:function(e){var t=this,r=e.a;return $e.create("Parse DCD",function(n){return ce(t,void 0,void 0,function(){var i,a;return de(this,function(o){switch(o.label){case 0:return[4,ije(r.data).runInContext(n)];case 1:if(i=o.sent(),i.isError)throw new Error(i.message);return[4,gqe(i.result).runInContext(n)];case 2:return a=o.sent(),[2,new ge.Molecule.Coordinates(a,{label:r.label,description:"Coordinates"})]}})})})}}),V$e=kt.BuiltIn({name:"coordinates-from-xtc",display:{name:"Parse XTC",description:"Parse XTC binary data."},from:[ge.Data.Binary],to:ge.Molecule.Coordinates})({apply:function(e){var t=this,r=e.a;return $e.create("Parse XTC",function(n){return ce(t,void 0,void 0,function(){var i,a;return de(this,function(o){switch(o.label){case 0:return[4,I$e(r.data).runInContext(n)];case 1:if(i=o.sent(),i.isError)throw new Error(i.message);return[4,M$e(i.result).runInContext(n)];case 2:return a=o.sent(),[2,new ge.Molecule.Coordinates(a,{label:r.label,description:"Coordinates"})]}})})})}}),H$e=kt.BuiltIn({name:"topology-from-psf",display:{name:"PSF Topology",description:"Parse PSF string data."},from:[ge.Format.Psf],to:ge.Molecule.Topology})({apply:function(e){var t=this,r=e.a;return $e.create("Create Topology",function(n){return ce(t,void 0,void 0,function(){var i;return de(this,function(a){switch(a.label){case 0:return[4,qqe(r.data).runInContext(n)];case 1:return i=a.sent(),[2,new ge.Molecule.Topology(i,{label:i.label||r.label,description:"Topology"})]}})})})}});function G$e(e,t,r){return ce(this,void 0,void 0,function(){var n,i;return de(this,function(a){switch(a.label){case 0:return t.type!==ge.Molecule.Topology.type?[3,2]:(n=t.data,[4,Xt.trajectoryFromTopologyAndCoordinates(n,r).runInContext(e)]);case 1:return[2,a.sent()];case 2:if(t.type===ge.Molecule.Model.type)return i=t.data,[2,Xt.trajectoryFromModelAndCoordinates(i,r)];a.label=3;case 3:throw new Error("no model/topology found")}})})}var Mte=kt.BuiltIn({name:"trajectory-from-model-and-coordinates",display:{name:"Trajectory from Topology & Coordinates",description:"Create a trajectory from existing model/topology and coordinates."},from:ge.Root,to:ge.Molecule.Trajectory,params:{modelRef:I.Text("",{isHidden:!0}),coordinatesRef:I.Text("",{isHidden:!0})}})({apply:function(e){var t=this,r=e.params,n=e.dependencies;return $e.create("Create trajectory from model/topology and coordinates",function(i){return ce(t,void 0,void 0,function(){var a,o,s;return de(this,function(u){switch(u.label){case 0:return a=n[r.coordinatesRef].data,[4,G$e(i,n[r.modelRef],a)];case 1:return o=u.sent(),s={label:"Trajectory",description:o.frameCount+" model"+(o.frameCount===1?"":"s")},[2,new ge.Molecule.Trajectory(o,s)]}})})})}}),q$e=kt.BuiltIn({name:"trajectory-from-blob",display:{name:"Parse Blob",description:"Parse format blob into a single trajectory."},from:ge.Format.Blob,to:ge.Molecule.Trajectory})({apply:function(e){var t=this,r=e.a;return $e.create("Parse Format Blob",function(n){return ce(t,void 0,void 0,function(){var i,a,o,s,u,l,d,c,d,f;return de(this,function(h){switch(h.label){case 0:i=[],a=0,o=r.data,h.label=1;case 1:return a<o.length?(s=o[a],s.kind!=="cif"?[3,6]:(u=s.data.blocks[0],[4,nee(u).runInContext(n)])):[3,7];case 2:if(l=h.sent(),l.frameCount===0)throw new Error("No models found.");d=0,h.label=3;case 3:return d<l.frameCount?[4,$e.resolveInContext(l.getFrameAtIndex(d),n)]:[3,6];case 4:c=h.sent(),i.push(c),h.label=5;case 5:return d++,[3,3];case 6:return a++,[3,1];case 7:for(d=0;d<i.length;d++)Xt.TrajectoryInfo.set(i[d],{index:d,size:i.length});return f={label:"Trajectory",description:i.length+" model"+(i.length===1?"":"s")},[2,new ge.Molecule.Trajectory(new Ov(i),f)]}})})})}});function $d(e){var t=e.representative;return{label:""+t.entry,description:e.frameCount+" model"+(e.frameCount===1?"":"s")}}var $$e=kt.BuiltIn({name:"trajectory-from-mmcif",display:{name:"Trajectory from mmCIF",description:"Identify and create all separate models in the specified CIF data block"},from:ge.Format.Cif,to:ge.Molecule.Trajectory,params:function(e){if(!e)return{blockHeader:I.Optional(I.Text(void 0,{description:"Header of the block to parse. If none is specifed, the 1st data block in the file is used."}))};var t=e.data.blocks;return{blockHeader:I.Optional(I.Select(t[0]&&t[0].header,t.map(function(r){return[r.header,r.header]}),{description:"Header of the block to parse"}))}}})({isApplicable:function(e){return e.data.blocks.length>0},apply:function(e){var t=this,r=e.a,n=e.params;return $e.create("Parse mmCIF",function(i){return ce(t,void 0,void 0,function(){var a,o,s,u;return de(this,function(l){switch(l.label){case 0:if(a=n.blockHeader||r.data.blocks[0].header,o=r.data.blocks.find(function(c){return c.header===a}),!o)throw new Error("Data block '"+[a]+"' not found.");return[4,nee(o).runInContext(i)];case 1:if(s=l.sent(),s.frameCount===0)throw new Error("No models found.");return u=$d(s),[2,new ge.Molecule.Trajectory(s,u)]}})})})}}),W$e=kt.BuiltIn({name:"trajectory-from-pdb",display:{name:"Parse PDB",description:"Parse PDB string and create trajectory."},from:[ge.Data.String],to:ge.Molecule.Trajectory,params:{isPdbqt:I.Boolean(!1)}})({apply:function(e){var t=this,r=e.a,n=e.params;return $e.create("Parse PDB",function(i){return ce(t,void 0,void 0,function(){var a,o,s;return de(this,function(u){switch(u.label){case 0:return[4,vje(r.data,r.label,n.isPdbqt).runInContext(i)];case 1:if(a=u.sent(),a.isError)throw new Error(a.message);return[4,Hqe(a.result).runInContext(i)];case 2:return o=u.sent(),s=$d(o),[2,new ge.Molecule.Trajectory(o,s)]}})})})}}),X$e=kt.BuiltIn({name:"trajectory-from-gro",display:{name:"Parse GRO",description:"Parse GRO string and create trajectory."},from:[ge.Data.String],to:ge.Molecule.Trajectory})({apply:function(e){var t=this,r=e.a;return $e.create("Parse GRO",function(n){return ce(t,void 0,void 0,function(){var i,a,o;return de(this,function(s){switch(s.label){case 0:return[4,pje(r.data).runInContext(n)];case 1:if(i=s.sent(),i.isError)throw new Error(i.message);return[4,Eqe(i.result).runInContext(n)];case 2:return a=s.sent(),o=$d(a),[2,new ge.Molecule.Trajectory(a,o)]}})})})}}),Y$e=kt.BuiltIn({name:"trajectory-from-xyz",display:{name:"Parse XYZ",description:"Parse XYZ string and create trajectory."},from:[ge.Data.String],to:ge.Molecule.Trajectory})({apply:function(e){var t=this,r=e.a;return $e.create("Parse XYZ",function(n){return ce(t,void 0,void 0,function(){var i,a,o;return de(this,function(s){switch(s.label){case 0:return[4,k$e(r.data).runInContext(n)];case 1:if(i=s.sent(),i.isError)throw new Error(i.message);return[4,F$e(i.result).runInContext(n)];case 2:return a=s.sent(),o=$d(a),[2,new ge.Molecule.Trajectory(a,o)]}})})})}}),K$e=kt.BuiltIn({name:"trajectory-from-mol",display:{name:"Parse MOL",description:"Parse MOL string and create trajectory."},from:[ge.Data.String],to:ge.Molecule.Trajectory})({apply:function(e){var t=this,r=e.a;return $e.create("Parse MOL",function(n){return ce(t,void 0,void 0,function(){var i,a,o;return de(this,function(s){switch(s.label){case 0:return[4,s$e(r.data).runInContext(n)];case 1:if(i=s.sent(),i.isError)throw new Error(i.message);return[4,u$e(i.result).runInContext(n)];case 2:return a=s.sent(),o=$d(a),[2,new ge.Molecule.Trajectory(a,o)]}})})})}}),Q$e=kt.BuiltIn({name:"trajectory-from-sdf",display:{name:"Parse SDF",description:"Parse SDF string and create trajectory."},from:[ge.Data.String],to:ge.Molecule.Trajectory})({apply:function(e){var t=this,r=e.a;return $e.create("Parse SDF",function(n){return ce(t,void 0,void 0,function(){var i,a,o,s,u,l,c,d,f,h,v;return de(this,function(p){switch(p.label){case 0:return[4,U$e(r.data).runInContext(n)];case 1:if(i=p.sent(),i.isError)throw new Error(i.message);a=[],o=0,s=i.result.compounds,p.label=2;case 2:return o<s.length?(u=s[o],[4,j$e(u).runInContext(n)]):[3,8];case 3:l=p.sent(),c=0,p.label=4;case 4:return c<l.frameCount?(f=(d=a).push,[4,$e.resolveInContext(l.getFrameAtIndex(c),n)]):[3,7];case 5:f.apply(d,[p.sent()]),p.label=6;case 6:return c++,[3,4];case 7:return o++,[3,2];case 8:return h=new Ov(a),v=$d(h),[2,new ge.Molecule.Trajectory(h,v)]}})})})}}),Z$e=kt.BuiltIn({name:"trajectory-from-mol2",display:{name:"Parse MOL2",description:"Parse MOL2 string and create trajectory."},from:[ge.Data.String],to:ge.Molecule.Trajectory})({apply:function(e){var t=this,r=e.a;return $e.create("Parse MOL2",function(n){return ce(t,void 0,void 0,function(){var i,a,o;return de(this,function(s){switch(s.label){case 0:return[4,w$e(r.data,r.label).runInContext(n)];case 1:if(i=s.sent(),i.isError)throw new Error(i.message);return[4,A$e(i.result).runInContext(n)];case 2:return a=s.sent(),o=$d(a),[2,new ge.Molecule.Trajectory(a,o)]}})})})}}),J$e=kt.BuiltIn({name:"trajectory-from-cube",display:{name:"Parse Cube",description:"Parse Cube file to create a trajectory."},from:ge.Format.Cube,to:ge.Molecule.Trajectory})({apply:function(e){var t=this,r=e.a;return $e.create("Parse MOL",function(n){return ce(t,void 0,void 0,function(){var i,a;return de(this,function(o){switch(o.label){case 0:return[4,m$e(r.data).runInContext(n)];case 1:return i=o.sent(),a=$d(i),[2,new ge.Molecule.Trajectory(i,a)]}})})})}}),eWe=kt.BuiltIn({name:"trajectory-from-cif-core",display:{name:"Parse CIF Core",description:"Identify and create all separate models in the specified CIF data block"},from:ge.Format.Cif,to:ge.Molecule.Trajectory,params:function(e){if(!e)return{blockHeader:I.Optional(I.Text(void 0,{description:"Header of the block to parse. If none is specifed, the 1st data block in the file is used."}))};var t=e.data.blocks;return{blockHeader:I.Optional(I.Select(t[0]&&t[0].header,t.map(function(r){return[r.header,r.header]}),{description:"Header of the block to parse"}))}}})({apply:function(e){var t=this,r=e.a,n=e.params;return $e.create("Parse CIF Core",function(i){return ce(t,void 0,void 0,function(){var a,o,s,u;return de(this,function(l){switch(l.label){case 0:if(a=n.blockHeader||r.data.blocks[0].header,o=r.data.blocks.find(function(c){return c.header===a}),!o)throw new Error("Data block '"+[a]+"' not found.");return[4,p$e(o).runInContext(i)];case 1:if(s=l.sent(),s.frameCount===0)throw new Error("No models found.");return u=$d(s),[2,new ge.Molecule.Trajectory(s,u)]}})})})}}),tWe=function(e){return e+1},rWe=function(e){return e-1},nWe=kt.BuiltIn({name:"model-from-trajectory",display:{name:"Molecular Model",description:"Create a molecular model from specified index in a trajectory."},from:ge.Molecule.Trajectory,to:ge.Molecule.Model,params:function(e){return e?{modelIndex:I.Converted(tWe,rWe,I.Numeric(1,{min:1,max:e.data.frameCount,step:1},{description:"Model Index",immediateUpdate:!0}))}:{modelIndex:I.Numeric(0,{},{description:"Zero-based index of the model",immediateUpdate:!0})}}})({isApplicable:function(e){return e.data.frameCount>0},apply:function(e){var t=this,r=e.a,n=e.params;return $e.create("Model from Trajectory",function(i){return ce(t,void 0,void 0,function(){var a,o,s,u;return de(this,function(l){switch(l.label){case 0:return a=n.modelIndex%r.data.frameCount,a<0&&(a+=r.data.frameCount),[4,$e.resolveInContext(r.data.getFrameAtIndex(a),i)];case 1:return o=l.sent(),s="Model "+(a+1),u=r.data.frameCount===1?void 0:"of "+r.data.frameCount,[2,new ge.Molecule.Model(o,{label:s,description:u})]}})})})},interpolate:function(e,t,r){var n=r>=1?t.modelIndex:e.modelIndex+Math.floor((t.modelIndex-e.modelIndex+1)*r);return{modelIndex:n}},dispose:function(e){var t=e.b;t==null||t.data.customProperties.dispose()}}),iWe=kt.BuiltIn({name:"structure-from-trajectory",display:{name:"Structure from Trajectory",description:"Create a molecular structure from a trajectory."},from:ge.Molecule.Trajectory,to:ge.Molecule.Structure})({apply:function(e){var t=this,r=e.a;return $e.create("Build Structure",function(n){return ce(t,void 0,void 0,function(){var i,a;return de(this,function(o){switch(o.label){case 0:return[4,We.ofTrajectory(r.data,n)];case 1:return i=o.sent(),a={label:"Ensemble",description:We.elementDescription(i)},[2,new ge.Molecule.Structure(i,a)]}})})})},dispose:function(e){var t=e.b;t==null||t.data.customPropertyDescriptors.dispose()}}),aWe=kt.BuiltIn({name:"structure-from-model",display:{name:"Structure",description:"Create a molecular structure (model, assembly, or symmetry) from the specified model."},from:ge.Molecule.Model,to:ge.Molecule.Structure,params:function(e){return uv.getParams(e&&e.data)}})({canAutoUpdate:function(e){var t=e.oldParams,r=e.newParams;return uv.canAutoUpdate(t.type,r.type)},apply:function(e,t){var r=this,n=e.a,i=e.params;return $e.create("Build Structure",function(a){return ce(r,void 0,void 0,function(){return de(this,function(o){return[2,uv.create(t,a,n.data,i&&i.type)]})})})},update:function(e){var t=e.a,r=e.b,n=e.oldParams,i=e.newParams;return ud(n,i)?r.data.model===t.data?ft.UpdateResult.Unchanged:Xt.areHierarchiesEqual(t.data,r.data.model)?(r.data=r.data.remapModel(t.data),ft.UpdateResult.Updated):ft.UpdateResult.Recreate:ft.UpdateResult.Recreate},dispose:function(e){var t=e.b;t==null||t.data.customPropertyDescriptors.dispose()}}),eV=_(),tV=ue(),rV=ue(),oWe=kt.BuiltIn({name:"transform-structure-conformation",display:{name:"Transform Conformation"},isDecorator:!0,from:ge.Molecule.Structure,to:ge.Molecule.Structure,params:{transform:I.MappedStatic("components",{components:I.Group({axis:I.Vec3(_.create(1,0,0)),angle:I.Numeric(0,{min:-180,max:180,step:.1}),translation:I.Vec3(_.create(0,0,0))},{isFlat:!0}),matrix:I.Group({data:I.Mat4(ue.identity()),transpose:I.Boolean(!1)},{isFlat:!0})},{label:"Kind"})}})({canAutoUpdate:function(e){var t=e.newParams;return t.transform.name!=="matrix"},apply:function(e){var t=e.a,r=e.params,n=ue();if(r.transform.name==="components"){var i=r.transform.params,a=i.axis,o=i.angle,s=i.translation,u=t.data.boundary.sphere.center;ue.fromTranslation(tV,_.negate(eV,u)),ue.fromTranslation(rV,_.add(eV,u,s));var l=ue.fromRotation(ue(),Math.PI/180*o,_.normalize(_(),a));ue.mul3(n,rV,l,tV)}else r.transform.name==="matrix"&&(ue.copy(n,r.transform.params.data),r.transform.params.transpose&&ue.transpose(n,n));var c=We.transform(t.data,n);return new ge.Molecule.Structure(c,{label:t.label,description:t.description+" [Transformed]"})},dispose:function(e){var t=e.b;t==null||t.data.customPropertyDescriptors.dispose()}}),sWe=kt.BuiltIn({name:"structure-selection-from-expression",display:{name:"Selection",description:"Create a molecular structure from the specified expression."},from:ge.Molecule.Structure,to:ge.Molecule.Structure,params:function(){return{expression:I.Value(se.struct.generator.all,{isHidden:!0}),label:I.Optional(I.Text("",{isHidden:!0}))}}})({apply:function(e){var t=e.a,r=e.params,n=e.cache,i=za.createAndRun(t.data,r.expression),a=i.selection,o=i.entry;if(n.entry=o,mt.isEmpty(a))return Nn.Null;var s=mt.unionStructure(a),u={label:""+(r.label||"Selection"),description:We.elementDescription(s)};return new ge.Molecule.Structure(s,u)},update:function(e){var t=e.a,r=e.b,n=e.oldParams,i=e.newParams,a=e.cache;if(n.expression!==i.expression)return ft.UpdateResult.Recreate;var o=a.entry;if(o.currentStructure===t.data)return ft.UpdateResult.Unchanged;var s=za.updateStructure(o,t.data);return mt.isEmpty(s)?ft.UpdateResult.Null:(za.updateStructureObject(r,s,i.label),ft.UpdateResult.Updated)},dispose:function(e){var t=e.b;t==null||t.data.customPropertyDescriptors.dispose()}}),uWe=kt.BuiltIn({name:"structure-multi-selection-from-expression",display:{name:"Multi-structure Measurement Selection",description:"Create selection object from multiple structures."},from:ge.Root,to:ge.Molecule.Structure.Selections,params:function(){return{selections:I.ObjectList({key:I.Text(void 0,{description:"A unique key."}),ref:I.Text(),groupId:I.Optional(I.Text()),expression:I.Value(se.struct.generator.empty)},function(e){return e.ref},{isHidden:!0}),isTransitive:I.Optional(I.Boolean(!1,{isHidden:!0,description:"Remap the selections from the original structure if structurally equivalent."})),label:I.Optional(I.Text("",{isHidden:!0}))}}})({apply:function(e){for(var t=e.params,r=e.cache,n=e.dependencies,i=new Map,a=[],o=0,s=0,u=t.selections;s<u.length;s++){var l=u[s],c=za.createAndRun(n[l.ref].data,l.expression),d=c.selection,f=c.entry;i.set(l.key,f);var h=mt.toLociWithSourceUnits(d);a.push({key:l.key,loci:h,groupId:l.groupId}),o+=Re.size(h)}r.entries=i;var v={label:""+(t.label||"Multi-selection"),description:t.selections.length+" source(s), "+o+" element(s) total"};return new ge.Molecule.Structure.Selections(a,v)},update:function(e){var t=e.b,r=e.oldParams,n=e.newParams,i=e.cache,a=e.dependencies;if(!!r.isTransitive!=!!n.isTransitive)return ft.UpdateResult.Recreate;for(var o=i.entries,s=new Map,u=new Map,l=0,c=t.data;l<c.length;l++){var d=c[l];u.set(d.key,d)}for(var f=!1,h=0,v=[],p=0,m=n.selections;p<m.length;p++){var g=m[p],y=a[g.ref].data,b=!1;if(o.has(g.key)){var S=o.get(g.key);if(za.isUnchanged(S,g.expression,y)&&u.has(g.key)){var x=u.get(g.key);x.groupId!==g.groupId&&(x.groupId=g.groupId,f=!0),s.set(g.key,S),v.push(x),h+=Re.size(x.loci);continue}if(S.expression!==g.expression)b=!0;else{var C=!1;if(n.isTransitive)if(We.areUnitIdsAndIndicesEqual(S.originalStructure,y)){var w=za.run(S,S.originalStructure);S.currentStructure=y,s.set(g.key,S);var x=Re.remap(mt.toLociWithSourceUnits(w),y);v.push({key:g.key,loci:x,groupId:g.groupId}),h+=Re.size(x),f=!0}else C=!0;else C=!0;if(C){f=!0;var w=za.updateStructure(S,y);s.set(g.key,S);var x=mt.toLociWithSourceUnits(w);v.push({key:g.key,loci:x,groupId:g.groupId}),h+=Re.size(x)}}}else b=!0;if(b){f=!0;var A=za.createAndRun(y,g.expression),w=A.selection,S=A.entry;s.set(g.key,S);var x=mt.toLociWithSourceUnits(w);v.push({key:g.key,loci:x}),h+=Re.size(x)}}return f?(i.entries=s,t.data=v,t.label=""+(n.label||"Multi-selection"),t.description=v.length+" source(s), "+h+" element(s) total",ft.UpdateResult.Updated):ft.UpdateResult.Unchanged}}),lWe=kt.BuiltIn({name:"structure-selection-from-script",display:{name:"Selection",description:"Create a molecular structure from the specified script."},from:ge.Molecule.Structure,to:ge.Molecule.Structure,params:function(){return{script:I.Script({language:"mol-script",expression:"(sel.atom.atom-groups :residue-test (= atom.resname ALA))"}),label:I.Optional(I.Text(""))}}})({apply:function(e){var t=e.a,r=e.params,n=e.cache,i=za.createAndRun(t.data,r.script),a=i.selection,o=i.entry;n.entry=o;var s=mt.unionStructure(a),u={label:""+(r.label||"Selection"),description:We.elementDescription(s)};return new ge.Molecule.Structure(s,u)},update:function(e){var t=e.a,r=e.b,n=e.oldParams,i=e.newParams,a=e.cache;if(!$i.areEqual(n.script,i.script))return ft.UpdateResult.Recreate;var o=a.entry;if(o.currentStructure===t.data)return ft.UpdateResult.Unchanged;var s=za.updateStructure(o,t.data);return za.updateStructureObject(r,s,i.label),ft.UpdateResult.Updated},dispose:function(e){var t=e.b;t==null||t.data.customPropertyDescriptors.dispose()}}),cWe=kt.BuiltIn({name:"structure-selection-from-bundle",display:{name:"Selection",description:"Create a molecular structure from the specified structure-element bundle."},from:ge.Molecule.Structure,to:ge.Molecule.Structure,params:function(){return{bundle:I.Value(on.Empty,{isHidden:!0}),label:I.Optional(I.Text("",{isHidden:!0}))}}})({apply:function(e){var t=e.a,r=e.params,n=e.cache;if(r.bundle.hash!==t.data.hashCode)return Nn.Null;n.source=t.data;var i=on.toStructure(r.bundle,t.data);if(i.elementCount===0)return Nn.Null;var a={label:""+(r.label||"Selection"),description:We.elementDescription(i)};return new ge.Molecule.Structure(i,a)},update:function(e){var t=e.a,r=e.b,n=e.oldParams,i=e.newParams,a=e.cache;if(!on.areEqual(n.bundle,i.bundle))return ft.UpdateResult.Recreate;if(i.bundle.hash!==t.data.hashCode)return ft.UpdateResult.Null;if(a.source===t.data)return ft.UpdateResult.Unchanged;a.source=t.data;var o=on.toStructure(i.bundle,t.data);return o.elementCount===0?ft.UpdateResult.Null:(r.label=""+(i.label||"Selection"),r.description=We.elementDescription(o),r.data=o,ft.UpdateResult.Updated)},dispose:function(e){var t=e.b;t==null||t.data.customPropertyDescriptors.dispose()}}),Dte={polymer:"polymer",protein:"protein",nucleic:"nucleic",water:"water",branched:"branched",ligand:"ligand","non-standard":"non-standard",coarse:"coarse","atomic-sequence":"atomic-sequence","atomic-het":"atomic-het",spheres:"spheres"},dWe=I.objectToOptions(Dte),fWe=kt.BuiltIn({name:"structure-complex-element",display:{name:"Complex Element",description:"Create a molecular structure from the specified model."},from:ge.Molecule.Structure,to:ge.Molecule.Structure,params:{type:I.Select("atomic-sequence",dWe,{isHidden:!0})}})({apply:function(e){var t=e.a,r=e.params,n,i;switch(r.type){case"polymer":n=bi.polymer.query,i="Polymer";break;case"protein":n=bi.protein.query,i="Protein";break;case"nucleic":n=bi.nucleic.query,i="Nucleic";break;case"water":n=sn.internal.water(),i="Water";break;case"branched":n=bi.branchedPlusConnected.query,i="Branched";break;case"ligand":n=bi.ligandPlusConnected.query,i="Ligand";break;case"non-standard":n=bi.nonStandardPolymer.query,i="Non-standard";break;case"coarse":n=bi.coarse.query,i="Coarse";break;case"atomic-sequence":n=sn.internal.atomicSequence(),i="Sequence";break;case"atomic-het":n=sn.internal.atomicHet(),i="HET Groups/Ligands";break;case"spheres":n=sn.internal.spheres(),i="Coarse Spheres";break;default:throw new Error(r.type+" is a not valid complex element.")}var a=n(new ps(t.data)),o=mt.unionStructure(a);return o.elementCount===0?Nn.Null:new ge.Molecule.Structure(o,{label:i,description:We.elementDescription(o)})},dispose:function(e){var t=e.b;t==null||t.data.customPropertyDescriptors.dispose()}}),hWe=kt.BuiltIn({name:"structure-component",display:{name:"Component",description:"A molecular structure component."},from:ge.Molecule.Structure,to:ge.Molecule.Structure,params:n$e})({apply:function(e){var t=e.a,r=e.params,n=e.cache;return i$e(t.data,r,n)},update:function(e){var t=e.a,r=e.b,n=e.oldParams,i=e.newParams,a=e.cache;return a$e(t.data,r,n,i,a)},dispose:function(e){var t=e.b;t==null||t.data.customPropertyDescriptors.dispose()}}),Rte=kt.BuiltIn({name:"custom-model-properties",display:{name:"Custom Model Properties"},isDecorator:!0,from:ge.Molecule.Model,to:ge.Molecule.Model,params:function(e,t){return t.customModelProperties.getParams(e==null?void 0:e.data)}})({apply:function(e,t){var r=this,n=e.a,i=e.params;return $e.create("Custom Props",function(a){return ce(r,void 0,void 0,function(){return de(this,function(o){switch(o.label){case 0:return[4,nV(n.data,t,a,i)];case 1:return o.sent(),[2,new ge.Molecule.Model(n.data,{label:n.label,description:n.description})]}})})})},update:function(e,t){var r=this,n=e.a,i=e.b,a=e.oldParams,o=e.newParams;return $e.create("Custom Props",function(s){return ce(r,void 0,void 0,function(){var u,l,c,d;return de(this,function(f){switch(f.label){case 0:for(i.data=n.data,i.label=n.label,i.description=n.description,u=0,l=a.autoAttach;u<l.length;u++)c=l[u],d=t.customModelProperties.get(c),d&&n.data.customProperties.reference(d.descriptor,!1);return[4,nV(n.data,t,s,o)];case 1:return f.sent(),[2,ft.UpdateResult.Updated]}})})})},dispose:function(e){var t=e.b;t==null||t.data.customProperties.dispose()}});function nV(e,t,r,n){return ce(this,void 0,void 0,function(){var i,a,o,s,u,l,c,d,f;return de(this,function(h){switch(h.label){case 0:i={runtime:r,assetManager:t.managers.asset},a=n.autoAttach,o=n.properties,s=0,u=Object.keys(o),h.label=1;case 1:if(!(s<u.length))return[3,8];if(l=u[s],c=t.customModelProperties.get(l),d=o[l],!(a.includes(l)||c.isHidden))return[3,6];h.label=2;case 2:return h.trys.push([2,4,,5]),[4,c.attach(i,e,d,!0)];case 3:return h.sent(),[3,5];case 4:return f=h.sent(),t.log.warn("Error attaching model prop '"+l+"': "+f),[3,5];case 5:return[3,7];case 6:c.set(e,d),h.label=7;case 7:return s++,[3,1];case 8:return[2]}})})}var kte=kt.BuiltIn({name:"custom-structure-properties",display:{name:"Custom Structure Properties"},isDecorator:!0,from:ge.Molecule.Structure,to:ge.Molecule.Structure,params:function(e,t){return t.customStructureProperties.getParams(e==null?void 0:e.data.root)}})({apply:function(e,t){var r=this,n=e.a,i=e.params;return $e.create("Custom Props",function(a){return ce(r,void 0,void 0,function(){return de(this,function(o){switch(o.label){case 0:return[4,iV(n.data.root,t,a,i)];case 1:return o.sent(),[2,new ge.Molecule.Structure(n.data,{label:n.label,description:n.description})]}})})})},update:function(e,t){var r=this,n=e.a,i=e.b,a=e.oldParams,o=e.newParams;return n.data!==i.data?ft.UpdateResult.Recreate:$e.create("Custom Props",function(s){return ce(r,void 0,void 0,function(){var u,l,c,d;return de(this,function(f){switch(f.label){case 0:for(i.data=n.data,i.label=n.label,i.description=n.description,u=0,l=a.autoAttach;u<l.length;u++)c=l[u],d=t.customStructureProperties.get(c),d&&n.data.customPropertyDescriptors.reference(d.descriptor,!1);return[4,iV(n.data.root,t,s,o)];case 1:return f.sent(),[2,ft.UpdateResult.Updated]}})})})},dispose:function(e){var t=e.b;t==null||t.data.customPropertyDescriptors.dispose()}});function iV(e,t,r,n){return ce(this,void 0,void 0,function(){var i,a,o,s,u,l,c,d,f;return de(this,function(h){switch(h.label){case 0:i={runtime:r,assetManager:t.managers.asset},a=n.autoAttach,o=n.properties,s=0,u=Object.keys(o),h.label=1;case 1:if(!(s<u.length))return[3,8];if(l=u[s],c=t.customStructureProperties.get(l),d=o[l],!(a.includes(l)||c.isHidden))return[3,6];h.label=2;case 2:return h.trys.push([2,4,,5]),[4,c.attach(i,e,d,!0)];case 3:return h.sent(),[3,5];case 4:return f=h.sent(),t.log.warn("Error attaching structure prop '"+l+"': "+f),[3,5];case 5:return[3,7];case 6:c.set(e,d),h.label=7;case 7:return s++,[3,1];case 8:return[2]}})})}var pWe=kt.BuiltIn({name:"shape-from-ply",display:{name:"Shape from PLY",description:"Create Shape from PLY data"},from:ge.Format.Ply,to:ge.Shape.Provider,params:function(e){return{}}})({apply:function(e){var t=this,r=e.a;return e.params,$e.create("Create shape from PLY",function(n){return ce(t,void 0,void 0,function(){var i,a;return de(this,function(o){switch(o.label){case 0:return[4,vqe(r.data).runInContext(n)];case 1:return i=o.sent(),a={label:"Shape"},[2,new ge.Shape.Provider(i,a)]}})})})}});const vWe=Object.freeze(Object.defineProperty({__proto__:null,CoordinatesFromDcd:z$e,CoordinatesFromXtc:V$e,CustomModelProperties:Rte,CustomStructureProperties:kte,ModelFromTrajectory:nWe,MultiStructureSelectionFromExpression:uWe,ShapeFromPly:pWe,StructureComplexElement:fWe,StructureComplexElementTypes:Dte,StructureComponent:hWe,StructureFromModel:aWe,StructureFromTrajectory:iWe,StructureSelectionFromBundle:cWe,StructureSelectionFromExpression:sWe,StructureSelectionFromScript:lWe,TopologyFromPsf:H$e,TrajectoryFromBlob:q$e,TrajectoryFromCifCore:eWe,TrajectoryFromCube:J$e,TrajectoryFromGRO:X$e,TrajectoryFromMOL:K$e,TrajectoryFromMOL2:Z$e,TrajectoryFromMmCif:$$e,TrajectoryFromModelAndCoordinates:Mte,TrajectoryFromPDB:W$e,TrajectoryFromSDF:Q$e,TrajectoryFromXYZ:Y$e,TransformStructureConformation:oWe},Symbol.toStringTag,{value:"Module"}));function mWe(e){return e.originX===0&&e.originY===0&&e.originZ===0?_.create(e.NCSTART,e.NRSTART,e.NSSTART):_.create(e.originX/(e.xLength/e.NX),e.originY/(e.yLength/e.NY),e.originZ/(e.zLength/e.NZ))}function gWe(e){var t=kee(e);switch(t){case xa.Float32:return Float32Array;case xa.Int8:return Int8Array;case xa.Int16:return Int16Array;case xa.Uint16:return Uint16Array}throw Error(t+" is not a supported value format.")}function yWe(e,t){var r=this;return $e.create("Create Volume",function(n){return ce(r,void 0,void 0,function(){var i,a,o,s,u,l,c,d,f,h,v,p,m,g,y,b,S;return de(this,function(x){return i=e.header,a=e.values,o=_.create(i.xLength,i.yLength,i.zLength),t&&t.voxelSize&&_.mul(o,o,t.voxelSize),s=_.create(Jr(i.alpha),Jr(i.beta),Jr(i.gamma)),u=i.ISPG>65536?0:i.ISPG,l=Fo.create(u||"P 1",o,s),c=_.create(i.MAPC-1,i.MAPR-1,i.MAPS-1),d=kr.convertToCanonicalAxisIndicesFastToSlow(c),f=[i.NX,i.NY,i.NZ],h=d([i.NC,i.NR,i.NS]),v=mWe(i),t!=null&&t.offset&&_.add(v,v,t.offset),p=d(v),m=_.create(p[0]/f[0],p[1]/f[1],p[2]/f[2]),g=_.create(h[0]/f[0],h[1]/f[1],h[2]/f[2]),y=kr.Space(h,kr.invertAxisOrder(c),gWe(i)),b=kr.create(y,kr.Data1(a)),S=i.AMIN===0&&i.AMAX===0&&i.AMEAN===0&&i.ARMS===0,[2,{label:t==null?void 0:t.label,entryId:t==null?void 0:t.entryId,grid:{transform:{kind:"spacegroup",cell:l,fractionalBox:Kt.create(m,_.add(_.zero(),m,g))},cells:b,stats:{min:isNaN(i.AMIN)||S?NE(a):i.AMIN,max:isNaN(i.AMAX)||S?Ql(a):i.AMAX,mean:isNaN(i.AMEAN)||S?BE(a):i.AMEAN,sigma:isNaN(i.ARMS)||i.ARMS===0?UE(a):i.ARMS}},sourceData:sR.create(e),customProperties:new nc,_propertyData:Object.create(null)}]})})})}var sR;(function(e){function t(n){return(n==null?void 0:n.kind)==="ccp4"}e.is=t;function r(n){return{kind:"ccp4",name:n.name,data:n}}e.create=r})(sR||(sR={}));function Ote(e,t){var r=this;return $e.create("Create Volume",function(n){return ce(r,void 0,void 0,function(){var i,a,o,s,u,l,c,d,f,h;return de(this,function(v){return i=e.volume_data_3d_info,a=e.volume_data_3d,o=Fo.create(i.spacegroup_number.value(0),_.ofArray(i.spacegroup_cell_size.value(0)),_.scale(_.zero(),_.ofArray(i.spacegroup_cell_angles.value(0)),Math.PI/180)),s=i.axis_order.value(0),u=kr.convertToCanonicalAxisIndicesFastToSlow(s),l=u(i.sample_count.value(0)),c=kr.Space(l,kr.invertAxisOrder(s),Float32Array),d=kr.create(c,kr.Data1(a.values.toArray({array:Float32Array}))),f=_.ofArray(u(i.origin.value(0))),h=_.ofArray(u(i.dimensions.value(0))),[2,{label:t==null?void 0:t.label,entryId:t==null?void 0:t.entryId,grid:{transform:{kind:"spacegroup",cell:o,fractionalBox:Kt.create(f,_.add(_.zero(),f,h))},cells:d,stats:{min:i.min_sampled.value(0),max:i.max_sampled.value(0),mean:i.mean_sampled.value(0),sigma:i.sigma_sampled.value(0)}},sourceData:Mw.create(e),customProperties:new nc,_propertyData:Object.create(null)}]})})})}var Mw;(function(e){function t(n){return(n==null?void 0:n.kind)==="dscif"}e.is=t;function r(n){return{kind:"dscif",name:n._name,data:n}}e.create=r})(Mw||(Mw={}));function bWe(e,t){var r=this;return $e.create("Create Volume",function(n){return ce(r,void 0,void 0,function(){var i,a,o,s,u,l,c,d,f,h,v,p;return de(this,function(m){return i=e.header,a=e.values,o=_.create(i.xlen,i.ylen,i.zlen),t&&t.voxelSize&&_.mul(o,o,t.voxelSize),s=_.create(Jr(i.alpha),Jr(i.beta),Jr(i.gamma)),u=Fo.create("P 1",o,s),l=[i.xRate,i.yRate,i.zRate],c=[i.xExtent,i.yExtent,i.zExtent],d=[i.xStart,i.yStart,i.zStart],f=_.create(d[0]/l[0],d[1]/l[1],d[2]/l[2]),h=_.create(c[0]/l[0],c[1]/l[1],c[2]/l[2]),v=kr.Space(c,[0,1,2],Float32Array),p=kr.create(v,kr.Data1(a)),[2,{label:t==null?void 0:t.label,entryId:t==null?void 0:t.entryId,grid:{transform:{kind:"spacegroup",cell:u,fractionalBox:Kt.create(f,_.add(_.zero(),f,h))},cells:p,stats:{min:NE(a),max:Ql(a),mean:BE(a),sigma:i.sigma!==void 0?i.sigma:UE(a)}},sourceData:uR.create(e),customProperties:new nc,_propertyData:Object.create(null)}]})})})}var uR;(function(e){function t(n){return(n==null?void 0:n.kind)==="dsn6"}e.is=t;function r(n){return{kind:"dsn6",name:n.name,data:n}}e.create=r})(uR||(uR={}));function xWe(e,t){var r=this;return $e.create("Create Volume",function(){return ce(r,void 0,void 0,function(){var n,i,a,o,s,u;return de(this,function(l){return n=e.header,i=e.values,a=kr.Space(n.dim,[0,1,2],Float64Array),o=kr.create(a,kr.Data1(i)),s=ue.fromTranslation(ue(),n.min),u=ue.fromScaling(ue(),n.h),ue.mul(s,s,u),[2,{label:t==null?void 0:t.label,entryId:t==null?void 0:t.entryId,grid:{transform:{kind:"matrix",matrix:s},cells:o,stats:{min:NE(i),max:Ql(i),mean:BE(i),sigma:UE(i)}},sourceData:lR.create(e),customProperties:new nc,_propertyData:Object.create(null)}]})})})}var lR;(function(e){function t(n){return(n==null?void 0:n.kind)==="dx"}e.is=t;function r(n){return{kind:"dx",name:n.name,data:n}}e.create=r})(lR||(lR={}));var SWe=kt.BuiltIn({name:"volume-from-ccp4",display:{name:"Volume from CCP4/MRC/MAP",description:"Create Volume from CCP4/MRC/MAP data"},from:ge.Format.Ccp4,to:ge.Volume.Data,params:function(e){return{voxelSize:I.Vec3(_.create(1,1,1)),offset:I.Vec3(_.create(0,0,0)),entryId:I.Text("")}}})({apply:function(e){var t=this,r=e.a,n=e.params;return $e.create("Create volume from CCP4/MRC/MAP",function(i){return ce(t,void 0,void 0,function(){var a,o;return de(this,function(s){switch(s.label){case 0:return[4,yWe(r.data,E(E({},n),{label:r.data.name||r.label})).runInContext(i)];case 1:return a=s.sent(),o={label:a.label||"Volume",description:"Volume "+r.data.header.NX+""+r.data.header.NX+""+r.data.header.NX},[2,new ge.Volume.Data(a,o)]}})})})},dispose:function(e){var t=e.b;t==null||t.data.customProperties.dispose()}}),CWe=kt.BuiltIn({name:"volume-from-dsn6",display:{name:"Volume from DSN6/BRIX",description:"Create Volume from DSN6/BRIX data"},from:ge.Format.Dsn6,to:ge.Volume.Data,params:function(e){return{voxelSize:I.Vec3(_.create(1,1,1)),entryId:I.Text("")}}})({apply:function(e){var t=this,r=e.a,n=e.params;return $e.create("Create volume from DSN6/BRIX",function(i){return ce(t,void 0,void 0,function(){var a,o;return de(this,function(s){switch(s.label){case 0:return[4,bWe(r.data,E(E({},n),{label:r.data.name||r.label})).runInContext(i)];case 1:return a=s.sent(),o={label:a.label||"Volume",description:"Volume "+r.data.header.xExtent+""+r.data.header.yExtent+""+r.data.header.zExtent},[2,new ge.Volume.Data(a,o)]}})})})},dispose:function(e){var t=e.b;t==null||t.data.customProperties.dispose()}}),_We=kt.BuiltIn({name:"volume-from-cube",display:{name:"Volume from Cube",description:"Create Volume from Cube data"},from:ge.Format.Cube,to:ge.Volume.Data,params:function(e){var t=e?I.Select(0,e.data.header.dataSetIds.map(function(r,n){return[n,""+r]})):I.Numeric(0);return{dataIndex:t,entryId:I.Text("")}}})({apply:function(e){var t=this,r=e.a,n=e.params;return $e.create("Create volume from Cube",function(i){return ce(t,void 0,void 0,function(){var a,o;return de(this,function(s){switch(s.label){case 0:return[4,eze(r.data,E(E({},n),{label:r.data.name||r.label})).runInContext(i)];case 1:return a=s.sent(),o={label:a.label||"Volume",description:"Volume "+r.data.header.dim[0]+""+r.data.header.dim[1]+""+r.data.header.dim[2]},[2,new ge.Volume.Data(a,o)]}})})})},dispose:function(e){var t=e.b;t==null||t.data.customProperties.dispose()}}),wWe=kt.BuiltIn({name:"volume-from-dx",display:{name:"Parse DX",description:"Create volume from DX data."},from:ge.Format.Dx,to:ge.Volume.Data})({apply:function(e){var t=this,r=e.a;return $e.create("Parse DX",function(n){return ce(t,void 0,void 0,function(){var i,a;return de(this,function(o){switch(o.label){case 0:return[4,xWe(r.data,{label:r.data.name||r.label}).runInContext(n)];case 1:return i=o.sent(),a={label:i.label||"Volume",description:"Volume "+r.data.header.dim[0]+""+r.data.header.dim[1]+""+r.data.header.dim[2]},[2,new ge.Volume.Data(i,a)]}})})})},dispose:function(e){var t=e.b;t==null||t.data.customProperties.dispose()}}),EWe=kt.BuiltIn({name:"volume-from-density-server-cif",display:{name:"Volume from density-server CIF",description:"Identify and create all separate models in the specified CIF data block"},from:ge.Format.Cif,to:ge.Volume.Data,params:function(e){if(!e)return{blockHeader:I.Optional(I.Text(void 0,{description:"Header of the block to parse. If none is specifed, the 1st data block in the file is used."})),entryId:I.Text("")};var t=e.data.blocks.slice(1);return{blockHeader:I.Optional(I.Select(t[0]&&t[0].header,t.map(function(r){return[r.header,r.header]}),{description:"Header of the block to parse"})),entryId:I.Text("")}}})({isApplicable:function(e){return e.data.blocks.length>0},apply:function(e){var t=this,r=e.a,n=e.params;return $e.create("Parse density-server CIF",function(i){return ce(t,void 0,void 0,function(){var a,o,s,u,l,c,d,f,h,v;return de(this,function(p){switch(p.label){case 0:if(a=n.blockHeader||r.data.blocks[1].header,o=r.data.blocks.find(function(m){return m.header===a}),!o)throw new Error("Data block '"+[a]+"' not found.");return s=vd.schema.densityServer(o),[4,Ote(s,{entryId:n.entryId}).runInContext(i)];case 1:return u=p.sent(),l=u.grid.cells.space.dimensions,c=l[0],d=l[1],f=l[2],h={label:(v=n.entryId)!==null&&v!==void 0?v:s.volume_data_3d_info.name.value(0),description:"Volume "+c+""+d+""+f},[2,new ge.Volume.Data(u,h)]}})})})},dispose:function(e){var t=e.b;t==null||t.data.customProperties.dispose()}}),AWe=kt.BuiltIn({name:"assign-color-volume",display:{name:"Assign Color Volume",description:"Assigns another volume to be available for coloring."},from:ge.Volume.Data,to:ge.Volume.Data,isDecorator:!0,params:function(e,t){if(!e)return{ref:I.Text()};var r=t.state.data.select(or.Generators.root.subtree().ofType(ge.Volume.Data).filter(function(n){var i;return!!n.obj&&!(!((i=n.obj)===null||i===void 0)&&i.data.colorVolume)&&n.obj!==e}));return r.length===0?{ref:I.Text("",{isHidden:!0})}:{ref:I.Select(r[0].transform.ref,r.map(function(n){return[n.transform.ref,n.obj.label]}))}}})({apply:function(e){var t=this,r=e.a,n=e.params,i=e.dependencies;return $e.create("Assign Color Volume",function(a){return ce(t,void 0,void 0,function(){var o,s,u;return de(this,function(l){if(!i||!i[n.ref])throw new Error("Dependency not available.");return o=i[n.ref].data,s=E(E({},r.data),{colorVolume:o}),u={label:r.label,description:"Volume + Colors"},[2,new ge.Volume.Data(s,u)]})})})}});const PWe=Object.freeze(Object.defineProperty({__proto__:null,AssignColorVolume:AWe,VolumeFromCcp4:SWe,VolumeFromCube:_We,VolumeFromDensityServerCif:EWe,VolumeFromDsn6:CWe,VolumeFromDx:wWe},Symbol.toStringTag,{value:"Module"}));var uS=at(13421772),TWe="Assigns colors according to the Symbol Nomenclature for Glycans (SNFG).",Fte={};function IWe(e){return Fte}function Lte(e,t){var r;if(e.structure){var n=e.structure.carbohydrates,i=n.elements,a=n.getElementIndices,o=function(s,u){if(!je.isAtomic(s))return uS;var l=a(s,u);return l.length>0?i[l[0]].component.color:uS};r=function(s,u){return u?Dt.Secondary:Ze.is(s)?o(s.unit,s.element):Ht.isLocation(s)?o(s.aUnit,s.aUnit.elements[s.aIndex]):uS}}else r=function(){return uS};return{factory:Lte,granularity:"group",color:r,props:t,description:TWe,legend:Gh(j6e)}}var MWe={name:"carbohydrate-symbol",label:"Carbohydrate Symbol",category:"Residue Property",factory:Lte,getParams:IWe,defaultValues:I.getDefaultValues(Fte),isApplicable:function(e){return!!e.structure&&e.structure.models.some(function(t){return Xt.hasCarbohydrate(t)})}},Nte={hue:I.Interval([1,360],{min:0,max:360,step:1}),chroma:I.Interval([40,70],{min:0,max:100,step:1}),luminance:I.Interval([15,85],{min:0,max:100,step:1}),clusteringStepCount:I.Numeric(50,{min:10,max:200,step:1},{isHidden:!0}),minSampleCount:I.Numeric(800,{min:100,max:5e3,step:100},{isHidden:!0})};function Bte(e,t){return Math.sqrt(Math.pow(Math.abs(e[0]-t[0]),2)+Math.pow(Math.abs(e[1]-t[1]),2)+Math.pow(Math.abs(e[2]-t[2]),2))}var Fm=2,ip=[0,0,0],ap=[0,0,0];function DWe(e,t){return da.toHcl(ip,e),da.fromColor(ap,da.toColor(e)),ip[0]>=t.hue[0]&&ip[0]<=t.hue[1]&&ip[1]>=t.chroma[0]&&ip[1]<=t.chroma[1]&&ip[2]>=t.luminance[0]&&ip[2]<=t.luminance[1]&&ap[0]>=e[0]-Fm&&ap[0]<=e[0]+Fm&&ap[1]>=e[1]-Fm&&ap[1]<=e[1]+Fm&&ap[2]>=e[2]-Fm&&ap[2]<=e[2]+Fm}function RWe(e){for(var t=e.slice(0),r=[t.shift()];t.length>0;){for(var n=r[r.length-1],i=0,a=Number.MIN_SAFE_INTEGER,o=0;o<t.length;++o){var s=Bte(n,t[o]);s>a&&(a=s,i=o)}r.push(t.splice(i,1)[0])}return r}function kWe(e,t){for(var r=new Map,n=Math.cbrt(e)*1.001,i=(t.hue[1]-t.hue[0])/n,a=(t.chroma[1]-t.chroma[0])/n,o=(t.luminance[1]-t.luminance[0])/n,s=t.hue[0];s<=t.hue[1];s+=i)for(var u=t.chroma[0];u<=t.chroma[1];u+=a)for(var l=t.luminance[0];l<=t.luminance[1];l+=o){var c=da.fromHcl(da(),Wl.create(s,u,l));DWe(c,t)&&r.set(c.toString(),c)}return Array.from(r.values())}function OWe(e,t){t===void 0&&(t={});var r=E(E({},I.getDefaultValues(Nte)),t);if(e<=0)return[];var n=kWe(Math.max(r.minSampleCount,e*5),r);if(n.length<e)throw new Error("Not enough samples to generate distinct colors, increase sample count.");for(var i=[],a=[],o=Math.floor(n.length/e),s=0;s<n.length&&(i.push(n[s]),a.push([]),!(i.length>=e));s+=o);for(var u=1;u<=r.clusteringStepCount;++u){for(var l=Ph(a),s=0;s<n.length;++s){for(var c=Number.MAX_SAFE_INTEGER,d=0,f=0;f<i.length;f++){var h=Bte(n[s],i[f]);h<c&&(c=h,d=f)}l[d].push(n[s])}for(var v=Ph(i),s=0;s<l.length;++s){for(var p=l[s],m=p.length,g=[],y=[],b=[],S=0,x=p;S<x.length;S++){var C=x[S];g.push(C[0]),y.push(C[1]),b.push(C[2])}var w=z1(g)/m,A=z1(y)/m,M=z1(b)/m;i[s]=[w,A,M]}if(ud(v,i))break}return RWe(i).map(function(D){return da.toColor(D)})}var Ute={type:"generate",colorList:"red-yellow-blue"};function Ss(e){e===void 0&&(e={});var t=E(E({},Ute),e);return{palette:I.MappedStatic(t.type,{colors:I.Group({list:I.ColorList(t.colorList)},{isFlat:!0}),generate:I.Group(E(E({},Nte),{maxCount:I.Numeric(75,{min:1,max:250,step:1})}),{isFlat:!0})},{options:[["colors","Color List"],["generate","Generate Distinct"]]})}}I.getDefaultValues(Ss());var aV={valueLabel:function(e){return""+(e+1)},minLabel:"Start",maxLabel:"End"};function ou(e,t,r){var n;r===void 0&&(r={});var i,a;if(t.palette.name==="colors"&&t.palette.params.list.kind==="interpolate"){var o=t.palette.params.list,s=[0,e-1],u=E(E({},aV),r),l=u.minLabel,c=u.maxLabel,d=o.colors;d.length===0&&(d=Ks(Ute.colorList).list);var f=Gu.create({listOrName:d,domain:s,minLabel:l,maxLabel:c});a=f.legend,i=f.color}else{var h;t.palette.name==="colors"?(h=t.palette.params.list.colors.map(function(b){return Array.isArray(b)?b[0]:b}),h.length===0&&(h=Ks("dark-2").list.map(function(b){return Array.isArray(b)?b[0]:b}))):(e=Math.min(e,t.palette.params.maxCount),h=OWe(e,t.palette.params));for(var v=(n=r.valueLabel)!==null&&n!==void 0?n:aV.valueLabel,p=h.length,m=[],g=0;g<e;++g){var y=g%p;m[y]===void 0?m[y]=[v(g),h[y]]:m[y][0]+=", "+v(g)}a=Gh(m),i=function(b){return h[b%p]}}return{color:i,legend:a}}var FWe="many-distinct",oV=at(16448250),LWe="Gives every chain a color based on its `asym_id` value.",oA=E({asymId:I.Select("auth",I.arrayToOptions(["auth","label"]))},Ss({type:"colors",colorList:FWe}));function NWe(e){var t,r=I.clone(oA);return!((t=e.structure)===null||t===void 0)&&t.models.some(function(n){return n.coarseHierarchy.isDefined})&&(r.asymId.defaultValue="label"),r}function BWe(e,t){switch(e.kind){case 0:return t==="auth"?lt.chain.auth_asym_id:lt.chain.label_asym_id;case 1:case 2:return lt.coarse.asym_id}}function sV(e,t){var r=BWe(e.unit,t)(e);return e.structure.root.models.length>1?jte(e.unit.model,r):r}function jte(e,t){return t+"|"+((Xt.Index.get(e).value||0)+1)}function UWe(e,t){for(var r=new Map,n=function(s){var u=Xt.AsymIdOffset.get(s).value,l=(t==="auth"?u==null?void 0:u.auth:u==null?void 0:u.label)||0,c=0;s.properties.structAsymMap.forEach(function(d,f){var h=d.auth_id,v=t==="auth"?h:f,p=e.models.length>1?jte(s,v):v;r.has(p)||(r.set(p,c+l),++c)})},i=0,a=e.models;i<a.length;i++){var o=a[i];n(o)}return r}function sA(e,t){var r,n;if(e.structure){var i=Ze.create(e.structure.root),a=UWe(e.structure.root,t.asymId),o=Array.from(a.keys()),s=function(l){return o[l]},u=ou(a.size,t,{valueLabel:s});n=u.legend,r=function(l){var c=void 0;if(Ze.is(l)){var d=sV(l,t.asymId);c=a.get(d)}else if(Ht.isLocation(l)){i.unit=l.aUnit,i.element=l.aUnit.elements[l.aIndex];var d=sV(i,t.asymId);c=a.get(d)}return c===void 0?oV:u.color(c)}}else r=function(){return oV};return{factory:sA,granularity:"group",color:r,props:t,description:LWe,legend:n}}var zte={name:"chain-id",label:"Chain Id",category:"Chain Property",factory:sA,getParams:NWe,defaultValues:I.getDefaultValues(oA),isApplicable:function(e){return!!e.structure}},uV=at(13421772),jWe="Gives every element (atom or coarse sphere/gaussian) a unique color based on the position (index) of the element in the list of elements in the structure.",Vte=E({},Ss({type:"colors",colorList:"red-yellow-blue"}));function zWe(e){return Vte}function Hte(e,t){var r,n;if(e.structure){for(var i=e.structure.root.units,a=i.length,o=new Map,s=new Map,u=0,l=0;l<a;++l)o.set(l,u),u+=i[l].elements.length,s.set(i[l].id,l);var c=ou(u,t);n=c.legend,r=function(d){if(Ze.is(d)){var f=s.get(d.unit.id),h=Fe.findPredecessorIndex(i[f].elements,d.element);return c.color(o.get(f)+h)}else if(Ht.isLocation(d)){var f=s.get(d.aUnit.id),h=Fe.findPredecessorIndex(i[f].elements,d.aUnit.elements[d.aIndex]);return c.color(o.get(f)+h)}return uV}}else r=function(){return uV};return{factory:Hte,granularity:"groupInstance",preferSmoothing:!0,color:r,props:t,description:jWe,legend:n}}var VWe={name:"element-index",label:"Element Index",category:"Atom Property",factory:Hte,getParams:zWe,defaultValues:I.getDefaultValues(Vte),isApplicable:function(e){return!!e.structure}},HWe="many-distinct",lV=at(13421772),GWe="Assigns a color based on the operator name of a transformed chain.",SF=E({},Ss({type:"colors",colorList:HWe}));function qWe(e){var t=I.clone(SF);return t}function $We(e){for(var t=new Map,r=0,n=e.units.length;r<n;++r){var i=e.units[r].conformation.operator.name;t.has(i)||t.set(i,t.size)}return t}function CF(e,t){var r,n;if(e.structure){var i=$We(e.structure.root),a=Array.from(i.keys()),o=function(u){return a[u]},s=ou(i.size,t,{valueLabel:o});n=s.legend,r=function(u){var l=void 0;if(Ze.is(u)){var c=u.unit.conformation.operator.name;l=i.get(c)}else if(Ht.isLocation(u)){var d=u.aUnit.conformation.operator.name;l=i.get(d)}return l===void 0?lV:s.color(l)}}else r=function(){return lV};return{factory:CF,granularity:"instance",color:r,props:t,description:GWe,legend:n}}var _F={name:"operator-name",label:"Operator Name",category:"Symmetry",factory:CF,getParams:qWe,defaultValues:I.getDefaultValues(SF),isApplicable:function(e){return!!e.structure}},MT={H:16777215,D:16777152,T:16777120,HE:14286847,LI:13402367,BE:12779264,B:16758197,C:9474192,N:3166456,O:16715021,F:9494608,NE:11789301,NA:11230450,MG:9109248,AL:12560038,SI:1578e4,P:16744448,S:16777008,CL:2093087,AR:8442339,K:9388244,CA:4062976,SC:15132390,TI:12567239,V:10921643,CR:9083335,MN:10255047,FE:14706227,CO:15765664,NI:5296208,CU:13140019,ZN:8224944,GA:12750735,GE:6721423,AS:12419299,SE:16752896,BR:10889513,KR:6076625,RB:7351984,SR:65280,Y:9764863,ZR:9756896,NB:7586505,MO:5551541,TC:3907230,RU:2396047,RH:687500,PD:27013,AG:12632256,CD:16767375,IN:10909043,SN:6717568,SB:10380213,TE:13924864,I:9699476,XE:9699476,CS:5707663,BA:51456,LA:7394559,CE:16777159,PR:14286791,ND:13107143,PM:10747847,SM:9437127,EU:6422471,GD:4587463,TB:3211207,DY:2097095,HO:65436,ER:58997,TM:54354,YB:48952,LU:43812,HF:5096191,TA:5089023,W:2200790,RE:2522539,OS:2516630,IR:1528967,PT:13684960,AU:16765219,HG:12105936,TL:10900557,PB:5724513,BI:10375093,PO:11230208,AT:7688005,RN:4358806,FR:4325478,RA:32e3,AC:7384058,TH:47871,PA:41471,U:36863,NP:33023,PU:27647,AM:5528818,CM:7888099,BK:9064419,CF:10565332,ES:11739092,FM:11739066,MD:11734438,NO:12389767,LR:13041766,RF:13369433,DB:13697103,SG:14221381,BH:14680120,HS:15073326,MT:15400998,DS:16777215,RG:16777215,CN:16777215,UUT:16777215,FL:16777215,UUP:16777215,LV:16777215,UUH:16777215},Gte=at(16777215),WWe="Assigns a color to every atom according to its chemical element.",qte={carbonColor:I.MappedStatic("chain-id",{"chain-id":I.Group(E({},oA)),"operator-name":I.Group(E({},SF)),"element-symbol":I.Group({})},{description:"Use chain-id coloring for carbon atoms."}),saturation:I.Numeric(0,{min:-6,max:6,step:.1}),lightness:I.Numeric(.2,{min:-6,max:6,step:.1})};function XWe(e){return qte}function YWe(e,t){var r=e[t];return r===void 0?Gte:r}function $te(e,t){var r=IE(MT,t.saturation,t.lightness),n=t.carbonColor.name==="chain-id"?sA(e,t.carbonColor.params).color:t.carbonColor.name==="operator-name"?CF(e,t.carbonColor.params).color:void 0;function i(s,u){return n&&s==="C"?n(u,!1):YWe(r,s)}function a(s){if(Ze.is(s)){if(je.isAtomic(s.unit)){var u=s.unit.model.atomicHierarchy.atoms.type_symbol;return i(u.value(s.element),s)}}else if(Ht.isLocation(s)&&je.isAtomic(s.aUnit)){var u=s.aUnit.model.atomicHierarchy.atoms.type_symbol,l=u.value(s.aUnit.elements[s.aIndex]);return i(l,s)}return Gte}var o=t.carbonColor.name==="operator-name"?"groupInstance":"group";return{factory:$te,granularity:o,preferSmoothing:!0,color:a,props:t,description:WWe,legend:Gh(Object.keys(MT).map(function(s){return[s,MT[s]]}))}}var KWe={name:"element-symbol",label:"Element Symbol",category:"Atom Property",factory:$te,getParams:XWe,defaultValues:I.getDefaultValues(qte),isApplicable:function(e){return!!e.structure}},DT={water:3697840,ion:15729279,protein:12496596,RNA:16629894,DNA:12540695,PNA:4367514,saccharide:8374655},cR=at(16777113),QWe="Assigns a color based on the molecule type of a residue.",Wte={saturation:I.Numeric(0,{min:-6,max:6,step:.1}),lightness:I.Numeric(0,{min:-6,max:6,step:.1})};function ZWe(e){return Wte}function cV(e,t,r){var n=J6(t,r);switch(n){case 2:return e.water;case 3:return e.ion;case 5:return e.protein;case 6:return e.RNA;case 7:return e.DNA;case 8:return e.PNA;case 9:return e.saccharide}return cR}function Xte(e,t){var r=IE(DT,t.saturation,t.lightness);function n(i){return Ze.is(i)?cV(r,i.unit,i.element):Ht.isLocation(i)?cV(r,i.aUnit,i.aUnit.elements[i.aIndex]):cR}return{factory:Xte,granularity:"group",color:n,props:t,description:QWe,legend:Gh(Object.keys(DT).map(function(i){return[i,DT[i]]}).concat([["Other/unknown",cR]]))}}var JWe={name:"molecule-type",label:"Molecule Type",category:"Residue Property",factory:Xte,getParams:ZWe,defaultValues:I.getDefaultValues(Wte),isApplicable:function(e){return!!e.structure}},dR="dark-2",dV=at(16448250),eXe="Gives every polymer chain a color based on its `asym_id` value.",Yte=E({},Ss({type:"colors",colorList:dR}));function tXe(e){var t=I.clone(Yte);return e.structure&&Kte(e.structure.root).size>Mo[dR].list.length&&(t.palette.defaultValue.name="colors",t.palette.defaultValue.params=E(E({},t.palette.defaultValue.params),{list:{kind:"interpolate",colors:Ks(dR).list}})),t}function fV(e){switch(e.kind){case 0:return lt.chain.label_asym_id;case 1:case 2:return lt.coarse.asym_id}}function Kte(e){for(var t=new Map,r=0,n=e.unitSymmetryGroups.length;r<n;++r){var i=e.unitSymmetryGroups[r].units[0],a=i.model;if(je.isAtomic(i))for(var o=a.atomicHierarchy,s=o.chainAtomSegments,u=o.chains,l=ar.transientSegments(s,i.elements);l.hasNext;){var c=l.move().index,d=u.label_entity_id.value(c),f=a.entities.getEntityIndex(d);if(a.entities.data.type.value(f)==="polymer"){var h=u.label_asym_id.value(c);t.has(h)||t.set(h,t.size)}}else if(je.isCoarse(i))for(var v=je.isSpheres(i)?a.coarseHierarchy.spheres:a.coarseHierarchy.gaussians,p=v.chainElementSegments,m=v.asym_id,g=v.entity_id,l=ar.transientSegments(p,i.elements);l.hasNext;){var c=l.move().index,y=p.offsets[c],d=g.value(y),f=a.entities.getEntityIndex(d);if(a.entities.data.type.value(f)==="polymer"){var h=m.value(y);t.has(h)||t.set(h,t.size)}}}return t}function Qte(e,t){var r,n;if(e.structure){var i=Ze.create(e.structure),a=Kte(e.structure.root),o=Array.from(a.keys()),s=function(l){return o[l]},u=ou(a.size,t,{valueLabel:s});n=u.legend,r=function(l){var c=void 0;if(Ze.is(l)){var d=fV(l.unit);c=a.get(d(l))}else if(Ht.isLocation(l)){var d=fV(l.aUnit);i.unit=l.aUnit,i.element=l.aUnit.elements[l.aIndex],c=a.get(d(i))}return c===void 0?dV:u.color(c)}}else r=function(){return dV};return{factory:Qte,granularity:"group",color:r,props:t,description:eXe,legend:n}}var rXe={name:"polymer-id",label:"Polymer Chain Id",category:"Chain Property",factory:Qte,getParams:tXe,defaultValues:I.getDefaultValues(Yte),isApplicable:function(e){return!!e.structure}},fR="dark-2",hV=at(13421772),nXe="Gives every polymer chain instance a unique color based on the position (index) of the polymer in the list of polymers in the structure.",Zte=E({},Ss({type:"colors",colorList:fR}));function iXe(e){var t=I.clone(Zte);return e.structure&&Jte(e.structure.root)>Mo[fR].list.length&&(t.palette.defaultValue.name="colors",t.palette.defaultValue.params=E(E({},t.palette.defaultValue.params),{list:{kind:"interpolate",colors:Ks(fR).list}})),t}function Jte(e){for(var t=0,r=e.units,n=0,i=r.length;n<i;++n)r[n].polymerElements.length>0&&++t;return t}function ere(e,t){var r,n;if(e.structure){var i=ou(Jte(e.structure.root),t);n=i.legend;for(var a=e.structure.root.units,o=new Map,s=0,u=0,l=a.length;s<l;++s)a[s].polymerElements.length>0&&(o.set(a[s].id,i.color(u)),++u);r=function(c){var d;return Ze.is(c)?d=o.get(c.unit.id):Ht.isLocation(c)&&(d=o.get(c.aUnit.id)),d!==void 0?d:hV}}else r=function(){return hV};return{factory:ere,granularity:"instance",color:r,props:t,description:nXe,legend:n}}var aXe={name:"polymer-index",label:"Polymer Chain Instance",category:"Chain Property",factory:ere,getParams:iXe,defaultValues:I.getDefaultValues(Zte),isApplicable:function(e){return!!e.structure}},RT={ALA:9240460,ARG:124,ASN:16743536,ASP:10485826,CYS:16777072,GLN:16731212,GLU:6684672,GLY:15658734,HIS:7368959,ILE:19456,LEU:4546117,LYS:4671416,MET:12099650,PHE:5459026,PRO:5395026,SER:16740418,THR:12078080,TRP:5195264,TYR:9203788,VAL:16747775,A:14423100,G:3329330,I:10145074,C:16766720,T:4286945,U:4251856,DA:14423100,DG:3329330,DI:10145074,DC:16766720,DT:4286945,DU:4251856,APN:14423100,GPN:3329330,CPN:16766720,TPN:4286945},hR=at(16711935),oXe="Assigns a color to every residue according to its name.",tre={saturation:I.Numeric(0,{min:-6,max:6,step:.1}),lightness:I.Numeric(1,{min:-6,max:6,step:.1})};function sXe(e){return tre}function pV(e,t){return e.model.atomicHierarchy.atoms.label_comp_id.value(t)}function vV(e,t){var r=e.coarseElements.seq_id_begin.value(t),n=e.coarseElements.seq_id_end.value(t);if(r===n){var i=e.coarseElements.entityKey[t],a=e.model.sequence.byEntityKey[i].sequence;return a.compId.value(r-1)}}function lS(e,t){var r=e[t];return r===void 0?hR:r}function rre(e,t){var r=IE(RT,t.saturation,t.lightness);function n(i){if(Ze.is(i))if(je.isAtomic(i.unit)){var a=pV(i.unit,i.element);return lS(r,a)}else{var a=vV(i.unit,i.element);if(a)return lS(r,a)}else if(Ht.isLocation(i))if(je.isAtomic(i.aUnit)){var a=pV(i.aUnit,i.aUnit.elements[i.aIndex]);return lS(r,a)}else{var a=vV(i.aUnit,i.aUnit.elements[i.aIndex]);if(a)return lS(r,a)}return hR}return{factory:rre,granularity:"group",preferSmoothing:!0,color:n,props:t,description:oXe,legend:Gh(Object.keys(RT).map(function(i){return[i,RT[i]]}).concat([["Unknown",hR]]))}}var uXe={name:"residue-name",label:"Residue Name",category:"Residue Property",factory:rre,getParams:sXe,defaultValues:I.getDefaultValues(tre),isApplicable:function(e){return!!e.structure}},kT={alphaHelix:16711808,threeTenHelix:10485888,piHelix:6291584,betaTurn:6324479,betaStrand:16762880,coil:16777215,bend:6740169,turn:45670,dna:11403518,rna:16580962,carbohydrate:10921722},pR=at(8421504),lXe="Assigns a color based on the type of secondary structure and basic molecule type.",nre={saturation:I.Numeric(-1,{min:-6,max:6,step:.1}),lightness:I.Numeric(0,{min:-6,max:6,step:.1})};function cXe(e){return nre}function mV(e,t,r,n){var i=Vr.create(0);if(n&&je.isAtomic(t)){var a=n.get(t.invariantId);a&&(i=a.type[a.getIndex(t.residueIndex[r])])}if(Vr.is(i,2))return Vr.is(i,2048)?e.threeTenHelix:Vr.is(i,32768)?e.piHelix:e.alphaHelix;if(Vr.is(i,4))return e.betaStrand;if(Vr.is(i,8))return e.bend;if(Vr.is(i,16))return e.turn;var o=J6(t,r);return o===7?e.dna:o===6?e.rna:o===9?e.carbohydrate:o===5?e.coil:pR}function ire(e,t){var r=e.structure&&tc.get(e.structure),n=r?Kv(r.id,r.version):-1,i=IE(kT,t.saturation,t.lightness);function a(o){return Ze.is(o)?mV(i,o.unit,o.element,r==null?void 0:r.value):Ht.isLocation(o)?mV(i,o.aUnit,o.aUnit.elements[o.aIndex],r==null?void 0:r.value):pR}return{factory:ire,granularity:"group",preferSmoothing:!0,color:a,props:t,contextHash:n,description:lXe,legend:Gh(Object.keys(kT).map(function(o){return[o,kT[o]]}).concat([["Other",pR]]))}}var dXe={name:"secondary-structure",label:"Secondary Structure",category:"Residue Property",factory:ire,getParams:cXe,defaultValues:I.getDefaultValues(nre),isApplicable:function(e){return!!e.structure},ensureCustomProperties:{attach:function(e,t){return t.structure?tc.attach(e,t.structure,void 0,!0):Promise.resolve()},detach:function(e){return e.structure&&tc.ref(e.structure,!1)}}},fXe=at(13421772),hXe="Gives every polymer residue a color based on its `seq_id` value.",are={list:I.ColorList("turbo",{presetKind:"scale"})};function pXe(e){return are}function gV(e,t){var r=e.model;switch(e.kind){case 0:var n=r.atomicHierarchy.residueAtomSegments.index[t];return r.atomicHierarchy.residues.label_seq_id.value(n);case 1:return Math.round((r.coarseHierarchy.spheres.seq_id_begin.value(t)+r.coarseHierarchy.spheres.seq_id_end.value(t))/2);case 2:return Math.round((r.coarseHierarchy.gaussians.seq_id_begin.value(t)+r.coarseHierarchy.gaussians.seq_id_end.value(t))/2)}}function yV(e,t){var r=e.model,n="";switch(e.kind){case 0:var i=r.atomicHierarchy.chainAtomSegments.index[t];n=r.atomicHierarchy.chains.label_entity_id.value(i);break;case 1:n=r.coarseHierarchy.spheres.entity_id.value(t);break;case 2:n=r.coarseHierarchy.gaussians.entity_id.value(t);break}if(n==="")return 0;var a=r.entities.getEntityIndex(n);if(a===-1)return 0;var o=r.sequence.byEntityKey[a];return o===void 0?0:o.sequence.length}function ore(e,t){var r=Gu.create({listOrName:t.list.colors,minLabel:"Start",maxLabel:"End"}),n=function(i){if(Ze.is(i)){var a=i.unit,o=i.element,s=gV(a,o);if(s>0){var u=yV(a,o);if(u)return r.setDomain(0,u-1),r.color(s)}}else if(Ht.isLocation(i)){var l=i.aUnit,c=i.aIndex,s=gV(l,l.elements[c]);if(s>0){var u=yV(l,l.elements[c]);if(u)return r.setDomain(0,u-1),r.color(s)}}return fXe};return{factory:ore,granularity:"group",preferSmoothing:!0,color:n,props:t,description:hXe,legend:r?r.legend:void 0}}var vXe={name:"sequence-id",label:"Sequence Id",category:"Residue Property",factory:ore,getParams:pXe,defaultValues:I.getDefaultValues(are),isApplicable:function(e){return!!e.structure}},vR="dark-2",bV=at(13421772),mXe="Gives every chain instance (single chain or collection of single elements) a unique color based on the position (index) of the chain in the list of chains in the structure.",sre=E({},Ss({type:"colors",colorList:vR}));function gXe(e){var t=I.clone(sre);return e.structure&&e.structure.root.units.length>Mo[vR].list.length&&(t.palette.defaultValue.name="colors",t.palette.defaultValue.params=E(E({},t.palette.defaultValue.params),{list:{kind:"interpolate",colors:Ks(vR).list}})),t}function ure(e,t){var r,n;if(e.structure){var i=e.structure.root.units,a=ou(i.length,t);n=a.legend;for(var o=new Map,s=0,u=i.length;s<u;++s)o.set(i[s].id,a.color(s));r=function(l){return Ze.is(l)?o.get(l.unit.id):Ht.isLocation(l)?o.get(l.aUnit.id):bV}}else r=function(){return bV};return{factory:ure,granularity:"instance",color:r,props:t,description:mXe,legend:n}}var yXe={name:"unit-index",label:"Chain Instance",category:"Chain Property",factory:ure,getParams:gXe,defaultValues:I.getDefaultValues(sre),isApplicable:function(e){return!!e.structure}},bXe=at(16777113),xXe="Assigns a color based on the uncertainty or disorder of an element's position, e.g. B-factor or RMSF, depending on the data availability and experimental technique.",lre={domain:I.Interval([0,100]),list:I.ColorList("red-white-blue",{presetKind:"scale"})};function SXe(e){return lre}function xV(e,t){return je.isAtomic(e)?e.model.atomicConformation.B_iso_or_equiv.value(t):je.isSpheres(e)?e.model.coarseConformation.spheres.rmsf[t]:0}function cre(e,t){var r=Gu.create({reverse:!0,domain:t.domain,listOrName:t.list.colors});function n(i){return Ze.is(i)?r.color(xV(i.unit,i.element)):Ht.isLocation(i)?r.color(xV(i.aUnit,i.aUnit.elements[i.aIndex])):bXe}return{factory:cre,granularity:"group",preferSmoothing:!0,color:n,props:t,description:xXe,legend:r?r.legend:void 0}}var CXe={name:"uncertainty",label:"Uncertainty/Disorder",category:"Atom Property",factory:cre,getParams:SXe,defaultValues:I.getDefaultValues(lre),isApplicable:function(e){return!!e.structure&&e.structure.models.some(function(t){return t.atomicConformation.B_iso_or_equiv.isDefined||t.coarseHierarchy.isDefined})}},mR="dark-2",cS=at(16448250),_Xe="Gives ranges of a polymer chain a color based on the entity source it originates from (e.g. gene, plasmid, organism).",dre=E({},Ss({type:"colors",colorList:mR}));function wXe(e){var t=I.clone(dre);return e.structure&&hre(e.structure.root.models).srcKeySerialMap.size>Mo[mR].list.length&&(t.palette.defaultValue.name="colors",t.palette.defaultValue.params=E(E({},t.palette.defaultValue.params),{list:{kind:"interpolate",colors:Ks(mR).list}})),t}function fre(e,t){return e+"|"+t}function EXe(e,t,r,n,i,a){return e+"|"+t+"|"+r+"|"+(a||i||n)}function OT(e,t,r,n,i,a,o,s){for(var u=i.entity_id,l=i.pdbx_src_id,c=i.pdbx_beg_seq_num,d=i.pdbx_end_seq_num,f=0,h=i._rowCount;f<h;++f){var v=u.value(f),p=fre(r,v),m=void 0;if(e.has(p))m=e.get(p);else{var g=n.entities.getEntityIndex(v),y=n.sequence.sequences[g].sequence;m=new Int16Array(y.length),e.set(p,m)}var b=o?o.value(f):"",S=s?s.value(f)[0]:"",x=EXe(r,v,a.value(f),l.value(f),b,S),C=c.valueKind(f)===0?c.value(f):1,w=d.valueKind(f)===0?d.value(f):m.length,A=void 0;t.has(x)?A=t.get(x):(A=t.size+1,t.set(x,A));for(var M=C,D=w;M<=D;++M)m[M-1]=A}}function hre(e){for(var t=new Map,r=new Map,n=0,i=e.length;n<i;++n){var a=e[n];if(un.is(a.sourceData)){var o=a.sourceData.data.db,s=o.entity_src_gen,u=o.entity_src_nat,l=o.pdbx_entity_src_syn;OT(t,r,n,a,s,s.pdbx_gene_src_scientific_name,s.plasmid_name,s.pdbx_gene_src_gene),OT(t,r,n,a,u,u.pdbx_organism_scientific,u.pdbx_plasmid_name),OT(t,r,n,a,l,l.organism_scientific)}}return{seqToSrcByModelEntity:t,srcKeySerialMap:r}}function AXe(e){var t=0;return Array.from(e.keys()).map(function(r){var n=r.split("|"),i=n[2],a=gLe(n[3])?"Unnamed "+ ++t:n[3];return""+a+(i?" ("+i+")":"")})}function pre(e,t){var r,n;if(e.structure){var i=Ze.create(e.structure),a=e.structure.root.models,o=hre(a),s=o.seqToSrcByModelEntity,u=o.srcKeySerialMap,l=AXe(u),c=function(h){return l[h]},d=ou(u.size,t,{valueLabel:c});n=d.legend;var f=function(h){var v=a.indexOf(h.unit.model),p=lt.entity.id(h),m=fre(v,p),g=s.get(m);if(g){var y=g[lt.residue.label_seq_id(h)-1]-1;return y===-1?cS:d.color(y)}else return cS};r=function(h){return Ze.is(h)?f(h):Ht.isLocation(h)?(i.unit=h.aUnit,i.element=h.aUnit.elements[h.aIndex],f(i)):cS}}else r=function(){return cS};return{factory:pre,granularity:"group",color:r,props:t,description:_Xe,legend:n}}var PXe={name:"entity-source",label:"Entity Source",category:"Chain Property",factory:pre,getParams:wXe,defaultValues:I.getDefaultValues(dre),isApplicable:function(e){return!!e.structure}},TXe=at(15658734),IXe="Assigns an illustrative color that gives every chain a unique color with lighter carbons (inspired by David Goodsell's Molecule of the Month style).",vre=E({},oA);function MXe(e){return vre}function mre(e,t){var r=sA(e,t),n=r.color,i=r.legend;function a(s,u){var l=n(s,!1);return u==="C"?at.lighten(l,.8):l}function o(s){if(Ze.is(s)&&je.isAtomic(s.unit)){var u=s.unit.model.atomicHierarchy.atoms.type_symbol.value(s.element);return a(s,u)}else if(Ht.isLocation(s)&&je.isAtomic(s.aUnit)){var l=s.aUnit.elements[s.aIndex],u=s.aUnit.model.atomicHierarchy.atoms.type_symbol.value(l);return a(s,u)}return TXe}return{factory:mre,granularity:"group",preferSmoothing:!0,color:o,props:t,description:IXe,legend:i}}var DXe={name:"illustrative",label:"Illustrative",category:"Miscellaneous",factory:mre,getParams:MXe,defaultValues:I.getDefaultValues(vre),isApplicable:function(e){return!!e.structure}},RXe='Assigns a color to every amino acid according to the "Experimentally determined hydrophobicity scale for proteins at membrane interfaces" by Wimely and White (doi:10.1038/nsb1096-842).',gre={list:I.ColorList("red-yellow-green",{presetKind:"scale"}),scale:I.Select("DGwif",[["DGwif","DG water-membrane"],["DGwoct","DG water-octanol"],["Oct-IF","DG difference"]])};function kXe(e){return gre}var OXe={DGwif:0,DGwoct:1,"Oct-IF":2};function FXe(e,t){var r=AD[e];return r===void 0?0:r[t]}function SV(e,t){return e.model.atomicHierarchy.atoms.label_comp_id.value(t)}function CV(e,t){var r=e.coarseElements.seq_id_begin.value(t),n=e.coarseElements.seq_id_end.value(t);if(r===n){var i=e.coarseElements.entityKey[t],a=e.model.sequence.byEntityKey[i].sequence;return a.compId.value(r-1)}}function yre(e,t){var r=OXe[t.scale],n=1/0,i=-1/0;for(var a in AD){var o=AD[a][r];n=Math.min(n,o),i=Math.max(i,o)}var s=Gu.create({listOrName:t.list.colors,domain:[i,n],minLabel:"Hydrophobic",maxLabel:"Hydrophilic"});function u(l){var c;return Ze.is(l)?je.isAtomic(l.unit)?c=SV(l.unit,l.element):c=CV(l.unit,l.element):Ht.isLocation(l)&&(je.isAtomic(l.aUnit)?c=SV(l.aUnit,l.aUnit.elements[l.aIndex]):c=CV(l.aUnit,l.aUnit.elements[l.aIndex])),s.color(c?FXe(c,r):0)}return{factory:yre,granularity:"group",preferSmoothing:!0,color:u,props:t,description:RXe,legend:s?s.legend:void 0}}var LXe={name:"hydrophobicity",label:"Hydrophobicity",category:"Residue Property",factory:yre,getParams:kXe,defaultValues:I.getDefaultValues(gre),isApplicable:function(e){return!!e.structure}},_V=at(13421772),NXe="Gives every model a unique color based on the position (index) of the model in the list of models in the structure.",bre=E({},Ss({type:"colors",colorList:"purples"}));function BXe(e){return bre}function xre(e,t){var r,n,i,a;if(e.structure){for(var o=e.structure.root.models,s=0,u=0,l=o;u<l.length;u++){var c=l[u];s=Math.max(s,((r=Xt.TrajectoryInfo.get(c))===null||r===void 0?void 0:r.size)||0)}var d=ou(s,t);a=d.legend;for(var f=new Map,h=0,v=o.length;h<v;++h){var p=((n=Xt.TrajectoryInfo.get(o[h]))===null||n===void 0?void 0:n.index)||0;f.set(p,d.color(p))}i=function(m){return Ze.is(m)?f.get(Xt.TrajectoryInfo.get(m.unit.model).index):Ht.isLocation(m)?f.get(Xt.TrajectoryInfo.get(m.aUnit.model).index):_V}}else i=function(){return _V};return{factory:xre,granularity:"instance",color:i,props:t,description:NXe,legend:a}}var UXe={name:"model-index",label:"Model Index",category:"Chain Property",factory:xre,getParams:BXe,defaultValues:I.getDefaultValues(bre),isApplicable:function(e){return!!e.structure&&e.structure.elementCount>0&&Xt.TrajectoryInfo.get(e.structure.models[0]).size>1}},jXe=at(13421772),zXe="Assigns a color based on the occupancy of an atom.",Sre={domain:I.Interval([0,1]),list:I.ColorList("purples",{presetKind:"scale"})};function VXe(e){return Sre}function wV(e,t){return je.isAtomic(e)?e.model.atomicConformation.occupancy.value(t):0}function Cre(e,t){var r=Gu.create({reverse:!1,domain:t.domain,listOrName:t.list.colors});function n(i){return Ze.is(i)?r.color(wV(i.unit,i.element)):Ht.isLocation(i)?r.color(wV(i.aUnit,i.aUnit.elements[i.aIndex])):jXe}return{factory:Cre,granularity:"group",preferSmoothing:!0,color:n,props:t,description:zXe,legend:r?r.legend:void 0}}var HXe={name:"occupancy",label:"Occupancy",category:"Atom Property",factory:Cre,getParams:VXe,defaultValues:I.getDefaultValues(Sre),isApplicable:function(e){return!!e.structure&&e.structure.models.some(function(t){return t.atomicConformation.occupancy.isDefined})}},gR="dark-2",EV=at(13421772),GXe="Assigns a color based on the operator HKL value of a transformed chain.",_re=E({},Ss({type:"colors",colorList:gR}));function qXe(e){var t=I.clone(_re);return e.structure&&wre(e.structure.root).map.size>Mo[gR].list.length&&(t.palette.defaultValue.name="colors",t.palette.defaultValue.params=E(E({},t.palette.defaultValue.params),{list:{kind:"interpolate",colors:Ks(gR).list}})),t}var b1=1e4;function yR(e){return e.map(function(t){return(""+(t+b1)).padStart(5,"0")}).join("")}function bR(e){var t=vLe(b1,0),r=parseInt(e.substr(0,t)),n=parseInt(e.substr(t,t)),i=parseInt(e.substr(t+t,t));return[r-b1,n-b1,i-b1]}function FT(e){return e.map(function(t){return t+5}).join("")}function wre(e){for(var t=new Map,r=new Set,n=0,i=e.units.length;n<i;++n){var a=yR(e.units[n].conformation.operator.hkl);r.add(a)}var o=Array.from(r.values()).sort();o.forEach(function(l){return t.set(l,t.size)});var s=bR(o[0]),u=bR(o[o.length-1]);return{min:s,max:u,map:t}}function Ere(e,t){var r,n;if(e.structure){var i=wre(e.structure.root),a=i.min,o=i.max,s=i.map,u=[];s.forEach(function(d,f){var h=d%s.size,v=FT(bR(f));u[h]===void 0?u[h]=v:u[h]+=", "+v});var l={minLabel:FT(a),maxLabel:FT(o),valueLabel:function(d){return u[d]}},c=ou(s.size,t,l);n=c.legend,r=function(d){var f=void 0;if(Ze.is(d)){var h=yR(d.unit.conformation.operator.hkl);f=s.get(h)}else if(Ht.isLocation(d)){var h=yR(d.aUnit.conformation.operator.hkl);f=s.get(h)}return f===void 0?EV:c.color(f)}}else r=function(){return EV};return{factory:Ere,granularity:"instance",color:r,props:t,description:GXe,legend:n}}var $Xe={name:"operator-hkl",label:"Operator HKL",category:"Symmetry",factory:Ere,getParams:qXe,defaultValues:I.getDefaultValues(_re),isApplicable:function(e){return!!e.structure}},LT=at(16777113),WXe="Assigns a color based on the partial charge of an atom.",Are={domain:I.Interval([-1,1]),list:I.ColorList("red-white-blue",{presetKind:"scale"})};function XXe(e){return Are}function AV(e,t){var r;return(r=y0.Provider.get(e.model))===null||r===void 0?void 0:r.data.value(t)}function Pre(e,t){var r=Gu.create({domain:t.domain,listOrName:t.list.colors});function n(i){if(Ze.is(i)){var a=AV(i.unit,i.element);return a!==void 0?r.color(a):LT}else if(Ht.isLocation(i)){var a=AV(i.aUnit,i.aUnit.elements[i.aIndex]);return a!==void 0?r.color(a):LT}return LT}return{factory:Pre,granularity:"group",preferSmoothing:!0,color:n,props:t,description:WXe,legend:r?r.legend:void 0}}var YXe={name:"partial-charge",label:"Partial Charge",category:"Atom Property",factory:Pre,getParams:XXe,defaultValues:I.getDefaultValues(Are),isApplicable:function(e){return!!e.structure&&e.structure.models.some(function(t){return y0.Provider.get(t)!==void 0})}},KXe="many-distinct",PV=at(16448250),QXe="Gives every atom a color based on its `label_atom_id` value.",Tre=E({},Ss({type:"colors",colorList:KXe}));function ZXe(e){var t=I.clone(Tre);return t}function JXe(e){for(var t=new Map,r=0,n=e.models;r<n.length;r++)for(var i=n[r],a=i.atomicHierarchy.atoms.label_atom_id,o=0,s=a.rowCount;o<s;++o){var u=a.value(o);t.has(u)||t.set(u,t.size)}return t}function Ire(e,t){var r,n;if(e.structure){var i=Ze.create(e.structure.root),a=JXe(e.structure.root),o=Array.from(a.keys()),s=function(l){return o[l]},u=ou(a.size,t,{valueLabel:s});n=u.legend,r=function(l){var c=void 0;if(Ze.is(l)){var d=lt.atom.label_atom_id(l);c=a.get(d)}else if(Ht.isLocation(l)){i.unit=l.aUnit,i.element=l.aUnit.elements[l.aIndex];var d=lt.atom.label_atom_id(i);c=a.get(d)}return c===void 0?PV:u.color(c)}}else r=function(){return PV};return{factory:Ire,granularity:"group",preferSmoothing:!0,color:r,props:t,description:QXe,legend:n}}var eYe={name:"atom-id",label:"Atom Id",category:"Atom Property",factory:Ire,getParams:ZXe,defaultValues:I.getDefaultValues(Tre),isApplicable:function(e){return!!e.structure}},tYe="many-distinct",TV=at(16448250),rYe="Gives every chain a color based on its `label_entity_id` value.",Mre=E({},Ss({type:"colors",colorList:tYe}));function nYe(e){var t=I.clone(Mre);return t}function xR(e,t){return e+"|"+t}function iYe(e){for(var t=new Map,r=0,n=e.models.length;r<n;++r)for(var i=e.models[r].atomicHierarchy.chains.label_entity_id,a=0,o=i.rowCount;a<o;++a){var s=xR(i.value(a),r);t.has(s)||t.set(s,t.size)}return t}function Dre(e,t){var r,n;if(e.structure){var i=Ze.create(e.structure.root),a=iYe(e.structure.root),o=Array.from(a.keys()),s=function(l){return o[l]},u=ou(a.size,t,{valueLabel:s});n=u.legend,r=function(l){var c=void 0;if(Ze.is(l)){var d=lt.chain.label_entity_id(l),f=l.structure.models.indexOf(l.unit.model),h=xR(d,f);c=a.get(h)}else if(Ht.isLocation(l)){i.unit=l.aUnit,i.element=l.aUnit.elements[l.aIndex];var d=lt.chain.label_entity_id(i),f=i.structure.models.indexOf(i.unit.model),h=xR(d,f);c=a.get(h)}return c===void 0?TV:u.color(c)}}else r=function(){return TV};return{factory:Dre,granularity:"group",color:r,props:t,description:rYe,legend:n}}var aYe={name:"entity-id",label:"Entity Id",category:"Chain Property",factory:Dre,getParams:nYe,defaultValues:I.getDefaultValues(Mre),isApplicable:function(e){return!!e.structure}},yd;(function(e){e.PaletteScale=(1<<24)-1,e.EmptyFactory=function(){return e.Empty};var t=at(13421772);e.Empty={factory:e.EmptyFactory,granularity:"uniform",color:function(){return t},props:{}};function r(i,a){return i.contextHash===a.contextHash&&i.factory===a.factory&&ud(i.props,a.props)}e.areEqual=r,e.EmptyProvider={name:"",label:"",category:"",factory:e.EmptyFactory,getParams:function(){return{}},defaultValues:{},isApplicable:function(){return!0}};function n(){return new Fre(e.BuiltIn,e.EmptyProvider)}e.createRegistry=n,e.BuiltIn={"atom-id":eYe,"carbohydrate-symbol":MWe,"chain-id":zte,"element-index":VWe,"element-symbol":KWe,"entity-id":aYe,"entity-source":PXe,hydrophobicity:LXe,illustrative:DXe,"model-index":UXe,"molecule-type":JWe,occupancy:HXe,"operator-hkl":$Xe,"operator-name":_F,"partial-charge":YXe,"polymer-id":rXe,"polymer-index":aXe,"residue-name":uXe,"secondary-structure":dXe,"sequence-id":vXe,"shape-group":FGe,uncertainty:CXe,"unit-index":yXe,uniform:f6e}})(yd||(yd={}));var oYe=1,sYe="Assigns a physical size, i.e. vdW radius for atoms or given radius for coarse spheres.",Rre={scale:I.Numeric(1,{min:.1,max:5,step:.1})};function uYe(e){return Rre}function NT(e,t){return je.isAtomic(e)?A2(e.model.atomicHierarchy.atoms.type_symbol.value(t)):je.isSpheres(e)?e.model.coarseConformation.spheres.radius[t]:0}function k2(e,t){var r=t.scale===void 0?1:t.scale;function n(i){var a;return Ze.is(i)?a=r*NT(i.unit,i.element):Ht.isLocation(i)?a=r*Math.min(NT(i.aUnit,i.aUnit.elements[i.aIndex]),NT(i.bUnit,i.bUnit.elements[i.bIndex])):a=r*oYe,a}return{factory:k2,granularity:"group",size:n,props:t,description:sYe}}var lYe={name:"physical",label:"Physical",category:"",factory:k2,getParams:uYe,defaultValues:I.getDefaultValues(Rre),isApplicable:function(e){return!!e.structure}},cYe="Assigns a size reflecting the uncertainty or disorder of an element's position, e.g. B-factor or RMSF, depending on the data availability and experimental technique.",kre={bfactorFactor:I.Numeric(.1,{min:0,max:1,step:.01}),rmsfFactor:I.Numeric(.05,{min:0,max:1,step:.01}),baseSize:I.Numeric(.2,{min:0,max:2,step:.1})};function dYe(e){return kre}function IV(e,t,r){return je.isAtomic(e)?e.model.atomicConformation.B_iso_or_equiv.value(t)*r.bfactorFactor:je.isSpheres(e)?e.model.coarseConformation.spheres.rmsf[t]*r.rmsfFactor:0}function Ore(e,t){function r(n){var i=t.baseSize;return Ze.is(n)?i+=IV(n.unit,n.element,t):Ht.isLocation(n)&&(i+=IV(n.aUnit,n.aUnit.elements[n.aIndex],t)),i}return{factory:Ore,granularity:"group",size:r,props:t,description:cYe}}var fYe={name:"uncertainty",label:"Uncertainty/Disorder",category:"",factory:Ore,getParams:dYe,defaultValues:I.getDefaultValues(kre),isApplicable:function(e){return!!e.structure&&e.structure.models.some(function(t){return t.atomicConformation.B_iso_or_equiv.isDefined||t.coarseHierarchy.isDefined})}},Ji;(function(e){e.EmptyFactory=function(){return e.Empty},e.Empty={factory:e.EmptyFactory,granularity:"uniform",size:function(){return 1},props:{}};function t(n,i){return n.factory===i.factory&&ud(n.props,i.props)}e.areEqual=t,e.EmptyProvider={name:"",label:"",category:"",factory:e.EmptyFactory,getParams:function(){return{}},defaultValues:{},isApplicable:function(){return!0}};function r(){return new Fre(e.BuiltIn,e.EmptyProvider)}e.createRegistry=r,e.BuiltIn={physical:lYe,"shape-group":DGe,uncertainty:fYe,uniform:v6e}})(Ji||(Ji={}));var Si;(function(e){function t(a,o,s,u){u=u||r();var l=s.colorTheme,c=s.sizeTheme;return u.color=a.colorThemeRegistry.create(l.name,o,l.params),u.size=a.sizeThemeRegistry.create(c.name,o,c.params),u}e.create=t;function r(){return{color:yd.Empty,size:Ji.Empty}}e.createEmpty=r;function n(a,o,s,u){var l,c;return ce(this,void 0,void 0,function(){return de(this,function(d){switch(d.label){case 0:return[4,(l=o.colorThemeRegistry.get(u.colorTheme.name).ensureCustomProperties)===null||l===void 0?void 0:l.attach(a,s)];case 1:return d.sent(),[4,(c=o.sizeThemeRegistry.get(u.sizeTheme.name).ensureCustomProperties)===null||c===void 0?void 0:c.attach(a,s)];case 2:return d.sent(),[2]}})})}e.ensureDependencies=n;function i(a,o,s){var u,l;(u=a.colorThemeRegistry.get(s.colorTheme.name).ensureCustomProperties)===null||u===void 0||u.detach(o),(l=a.sizeThemeRegistry.get(s.sizeTheme.name).ensureCustomProperties)===null||l===void 0||l.detach(o)}e.releaseDependencies=i})(Si||(Si={}));function MV(e){return e.map(function(t){return[t.name,t.provider.label,t.provider.category]})}var Fre=function(){function e(t,r){var n=this;this.emptyProvider=r,this._list=[],this._map=new Map,this._name=new Map,$u(t,function(i,a){if(i.name!==a)throw new Error("Fix build in themes to have matching names. "+i.name+" "+a);n.add(i)})}return Object.defineProperty(e.prototype,"default",{get:function(){return this._list[0]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"list",{get:function(){return this._list},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"types",{get:function(){return MV(this._list)},enumerable:!1,configurable:!0}),e.prototype.sort=function(){this._list.sort(function(t,r){return t.provider.category===r.provider.category?t.provider.label<r.provider.label?-1:t.provider.label>r.provider.label?1:0:t.provider.category<r.provider.category?-1:1})},e.prototype.add=function(t){if(this._map.has(t.name))throw new Error(t.name+" already registered.");var r=t.name;this._list.push({name:r,provider:t}),this._map.set(r,t),this._name.set(t,r),this.sort()},e.prototype.remove=function(t){this._list.splice(this._list.findIndex(function(n){return n.name===t.name}),1);var r=this._map.get(t.name);r&&(this._map.delete(t.name),this._name.delete(r))},e.prototype.has=function(t){return this._map.has(t.name)},e.prototype.get=function(t){return this._map.get(t)||this.emptyProvider},e.prototype.getName=function(t){if(!this._name.has(t))throw new Error("'"+t.label+"' is not a registered theme provider.");return this._name.get(t)},e.prototype.create=function(t,r,n){n===void 0&&(n={});var i=this.get(t);return i.factory(r,E(E({},I.getDefaultValues(i.getParams(r))),n))},e.prototype.getApplicableList=function(t){return this._list.filter(function(r){return r.provider.isApplicable(t)})},e.prototype.getApplicableTypes=function(t){return MV(this.getApplicableList(t))},e}();function uA(e){return Object.keys(e)}function SR(e){throw new Error("unreachable")}function wF(e){return typeof(e==null?void 0:e.then)=="function"}var nr;(function(e){e[e.None=0]="None",e[e.Highlight=1]="Highlight",e[e.RemoveHighlight=2]="RemoveHighlight",e[e.Select=4]="Select",e[e.Deselect=8]="Deselect",e[e.Toggle=16]="Toggle",e[e.Clear=32]="Clear"})(nr||(nr={}));var Lo;(function(e){e.is=_a.has,e.All=nr.Highlight|nr.RemoveHighlight|nr.Select|nr.Deselect|nr.Toggle|nr.Clear,e.Highlighting=nr.Highlight|nr.RemoveHighlight|nr.Clear,e.Selecting=nr.Select|nr.Deselect|nr.Toggle|nr.Clear})(Lo||(Lo={}));function Dw(e,t,r){switch(r){case nr.Highlight:e[t]|=1;break;case nr.RemoveHighlight:e[t]&=-2;break;case nr.Select:e[t]|=2;break;case nr.Deselect:e[t]&=-3;break;case nr.Toggle:e[t]^=2;break;case nr.Clear:e[t]=0;break}}function Ku(e,t,r){if(r===nr.None)return!1;if(Ie.is(t)){var n=Ie.start(t),i=Ie.end(t),a=new Uint32Array(e.buffer,0,e.buffer.byteLength>>2),o=n+3>>2,s=o+(i-4*o>>2),u=n,l=Math.min(4*o,i),c=Math.max(n,4*s),d=i;switch(r){case nr.Highlight:for(var f=o;f<s;++f)a[f]|=16843009;break;case nr.RemoveHighlight:for(var f=o;f<s;++f)a[f]&=-16843010;break;case nr.Select:for(var f=o;f<s;++f)a[f]|=33686018;break;case nr.Deselect:for(var f=o;f<s;++f)a[f]&=-33686019;break;case nr.Toggle:for(var f=o;f<s;++f)a[f]^=33686018;break;case nr.Clear:for(var f=o;f<s;++f)a[f]=0;break;default:SR()}for(var f=u;f<l;++f)Dw(e,f,r);for(var f=c;f<d;++f)Dw(e,f,r)}else switch(r){case nr.Highlight:for(var f=0,h=t.length;f<h;++f)e[t[f]]|=1;break;case nr.RemoveHighlight:for(var f=0,h=t.length;f<h;++f)e[t[f]]&=-2;break;case nr.Select:for(var f=0,h=t.length;f<h;++f)e[t[f]]|=2;break;case nr.Deselect:for(var f=0,h=t.length;f<h;++f)e[t[f]]&=-3;break;case nr.Toggle:for(var f=0,h=t.length;f<h;++f)e[t[f]]^=2;break;case nr.Clear:for(var f=0,h=t.length;f<h;++f)e[t[f]]=0;break;default:SR()}return!0}var hYe={kind:"every-loci"};function Ws(e){return!!e&&e.kind==="every-loci"}var jr={kind:"empty-loci"};function Nu(e){return!!e&&e.kind==="empty-loci"}function W1(e){return!!e&&e.kind==="data-loci"}function pYe(e,t){if(!W_(e.data,t.data)||e.tag!==t.tag||e.elements.length!==t.elements.length)return!1;for(var r=0,n=e.elements.length;r<n;++r)if(!W_(e.elements[r],t.elements[r]))return!1;return!0}function vYe(e){return e.elements.length===0}function lA(e,t,r,n,i){return{kind:"data-loci",tag:e,data:t,elements:r,getBoundingSphere:n,getLabel:i}}var sr;(function(e){var t=new bs("98");function r(p){var m=p.loci.map(function(C){return s(C)}).filter(function(C){return!!C});t.reset();for(var g=0,y=m;g<y.length;g++){var b=y[g];t.includePositionRadius(b.center,b.radius)}t.finishedIncludeStep();for(var S=0,x=m;S<x.length;S++){var b=x[S];t.radiusPositionRadius(b.center,b.radius)}return t.getSphere()}e.getBundleBoundingSphere=r;function n(p,m){return Ws(p)&&Ws(m)||Nu(p)&&Nu(m)?!0:W1(p)&&W1(m)?pYe(p,m):We.isLoci(p)&&We.isLoci(m)?We.areLociEqual(p,m):Re.is(p)&&Re.is(m)?Re.areEqual(p,m):Ht.isLoci(p)&&Ht.isLoci(m)?Ht.areLociEqual(p,m):Ur.isLoci(p)&&Ur.isLoci(m)?Ur.areLociEqual(p,m):no.isLoci(p)&&no.isLoci(m)?no.areLociEqual(p,m):Ct.isLoci(p)&&Ct.isLoci(m)?Ct.areLociEqual(p,m):Ct.Isosurface.isLoci(p)&&Ct.Isosurface.isLoci(m)?Ct.Isosurface.areLociEqual(p,m):Ct.Cell.isLoci(p)&&Ct.Cell.isLoci(m)?Ct.Cell.areLociEqual(p,m):!1}e.areEqual=n;function i(p){return!!p&&p.kind==="every-loci"}e.isEvery=i;function a(p){return Ws(p)?!1:Nu(p)?!0:W1(p)?vYe(p):We.isLoci(p)?We.isLociEmpty(p):Re.is(p)?Re.isEmpty(p):Ht.isLoci(p)?Ht.isLociEmpty(p):Ur.isLoci(p)?Ur.isLociEmpty(p):no.isLoci(p)?no.isLociEmpty(p):Ct.isLoci(p)?Ct.isLociEmpty(p):Ct.Isosurface.isLoci(p)?Ct.Isosurface.isLociEmpty(p):Ct.Cell.isLoci(p)?Ct.Cell.isLociEmpty(p):!1}e.isEmpty=a;function o(p,m){return m instanceof We&&(Re.is(p)?p=Re.remap(p,m):We.isLoci(p)?p=We.remapLoci(p,m):Ht.isLoci(p)&&(p=Ht.remapLoci(p,m))),p}e.remap=o;function s(p,m){var g;if(!(p.kind==="every-loci"||p.kind==="empty-loci")){if(m||(m=Be()),p.kind==="structure-loci")return Be.copy(m,p.structure.boundary.sphere);if(p.kind==="element-loci")return Be.copy(m,Re.getBoundary(p).sphere);if(p.kind==="bond-loci")return Ht.getBoundingSphere(p,m);if(p.kind==="shape-loci")return Be.copy(m,p.shape.geometry.boundingSphere);if(p.kind==="group-loci")return no.getBoundingSphere(p,m);if(p.kind==="data-loci")return(g=p.getBoundingSphere)===null||g===void 0?void 0:g.call(p,m);if(p.kind==="volume-loci")return Ct.getBoundingSphere(p.volume,m);if(p.kind==="isosurface-loci")return Ct.Isosurface.getBoundingSphere(p.volume,p.isoValue,m);if(p.kind==="cell-loci")return Ct.Cell.getBoundingSphere(p.volume,p.indices,m)}}e.getBoundingSphere=s;var u=Be.zero();function l(p,m){var g=s(p,u);return g?_.copy(m||_(),g.center):void 0}e.getCenter=l;function c(p){if(!(p.kind==="every-loci"||p.kind==="empty-loci")){if(p.kind==="structure-loci")return Re.getPrincipalAxes(We.toStructureElementLoci(p.structure));if(p.kind==="element-loci")return Re.getPrincipalAxes(p);if(p.kind==="bond-loci")return;if(p.kind==="shape-loci")return;if(p.kind==="group-loci")return;if(p.kind==="data-loci")return;if(p.kind==="volume-loci")return;if(p.kind==="isosurface-loci")return;if(p.kind==="cell-loci")return}}e.getPrincipalAxes=c;var d={element:function(p){return p},residue:function(p){return Re.is(p)?Re.extendToWholeResidues(p,!0):p},chain:function(p){return Re.is(p)?Re.extendToWholeChains(p):p},entity:function(p){return Re.is(p)?Re.extendToWholeEntities(p):p},model:function(p){return Re.is(p)?Re.extendToWholeModels(p):p},operator:function(p){return Re.is(p)?Re.extendToWholeOperators(p):p},structure:function(p){return Re.is(p)?We.toStructureElementLoci(p.structure):no.isLoci(p)?Ur.Loci(p.shape):p},elementInstances:function(p){return Re.is(p)?Re.extendToAllInstances(p):p},residueInstances:function(p){return Re.is(p)?Re.extendToAllInstances(Re.extendToWholeResidues(p,!0)):p},chainInstances:function(p){return Re.is(p)?Re.extendToAllInstances(Re.extendToWholeChains(p)):p}};e.GranularityOptions=I.objectToOptions(d,function(p){switch(p){case"element":return"Atom/Coarse Element";case"elementInstances":return["Atom/Coarse Element Instances","With Symmetry"];case"structure":return"Structure/Shape";default:return p.indexOf("Instances")?[is(p),"With Symmetry"]:is(p)}});function f(p){return p.replace("Instances","")}e.simpleGranularity=f;function h(p,m){return d[m](p)}e.applyGranularity=h;function v(p,m){return m!=="element"&&Ht.isLoci(p)&&(p=Ht.toStructureElementLoci(p)),We.isLoci(p)&&(p=We.toStructureElementLoci(p.structure)),Re.is(p)&&(p=Re.remap(p,p.structure.root)),m&&(p=h(p,m)),p}e.normalize=v})(sr||(sr={}));function Xi(e){return{layers:e}}(function(e){e.Empty={layers:[]};function t(l,c){if(l.layers.length===0&&c.layers.length===0)return!0;if(l.layers.length!==c.layers.length)return!1;for(var d=0,f=l.layers.length;d<f;++d)if(l.layers[d].clear!==c.layers[d].clear||l.layers[d].color!==c.layers[d].color||!sr.areEqual(l.layers[d].loci,c.layers[d].loci))return!1;return!0}e.areEqual=t;function r(l){return l.layers.length===0}e.isEmpty=r;function n(l,c){for(var d=[],f=0,h=l.layers;f<h.length;f++){var v=h[f],p=v.loci,m=v.color,g=v.clear;p=Re.remap(p,c),Re.isEmpty(p)||d.push({loci:p,color:m,clear:g})}return{layers:d}}e.remap=n;function i(l){if(r(l))return l;for(var c=l.layers[0].loci.structure,d=new Map,f=Re.none(c),h=0,v=l.layers.length;h<v;++h){var p=l.layers[v-h-1],m=p.loci,g=p.color,y=p.clear;if(m=Re.subtract(m,f),f=Re.union(m,f),!Re.isEmpty(m)){var b=y?-1:g;d.has(b)&&(m=Re.union(m,d.get(b))),d.set(b,m)}}var S=[];return d.forEach(function(x,C){var w=C===-1,A=C===-1?at(0):C;S.push({loci:x,color:A,clear:w})}),{layers:S}}e.merge=i;function a(l,c){if(r(l))return l;for(var d=l.layers[0].loci.structure,f=[],h=0,v=l.layers;h<v.length;h++){var p=v[h],m=p.loci,g=p.color,y=p.clear,b=Re.remap(m,c);m=Re.remap(b,d),Re.isEmpty(m)||f.push({loci:m,color:g,clear:y})}return{layers:f}}e.filter=a;function o(l,c){for(var d=[],f=0,h=l.length;f<h;++f){var v=l[f],p=v.script,m=v.color,g=v.clear,y=$i.toLoci(p,c);Re.isEmpty(y)||d.push({loci:y,color:m,clear:g})}return{layers:d}}e.ofScript=o;function s(l,c){for(var d=[],f=0,h=l.length;f<h;++f){var v=l[f],p=v.bundle,m=v.color,g=v.clear,y=on.toLoci(p,c.root);d.push({loci:y,color:m,clear:g})}return{layers:d}}e.ofBundle=s;function u(l){for(var c=[],d=0,f=l.layers.length;d<f;++d){var h=l.layers[d],v=h.loci,p=h.color,m=h.clear,g=on.fromLoci(v);c.push({bundle:g,color:p,clear:m})}return{layers:c}}e.toBundle=u})(Xi||(Xi={}));function Yi(e,t){return{kind:e,layers:t}}(function(e){e.Empty={kind:"empty-loci",layers:[]};function t(l,c){if(l.layers.length===0&&c.layers.length===0)return!0;if(l.layers.length!==c.layers.length)return!1;for(var d=0,f=l.layers.length;d<f;++d)if(l.layers[d].value!==c.layers[d].value||!sr.areEqual(l.layers[d].loci,c.layers[d].loci))return!1;return!0}e.areEqual=t;function r(l){return l.layers.length===0}e.isEmpty=r;function n(l,c){if(l.kind==="element-loci"){for(var d=[],f=0,h=l.layers;f<h.length;f++){var v=h[f],p=Re.remap(v.loci,c);Re.isEmpty(p)||d.push({loci:p,value:v.value})}return{kind:"element-loci",layers:d}}else return l}e.remap=n;function i(l){if(r(l))return l;if(l.kind==="element-loci"){for(var c=l.layers[0].loci.structure,d=new Map,f=Re.none(c),h=0,v=l.layers.length;h<v;++h){var p=l.layers[v-h-1],m=p.loci,g=p.value;m=Re.subtract(m,f),f=Re.union(m,f),Re.isEmpty(m)||(d.has(g)&&(m=Re.union(m,d.get(g))),d.set(g,m))}var y=[];return d.forEach(function(b,S){y.push({loci:b,value:S})}),{kind:"element-loci",layers:y}}else return l}e.merge=i;function a(l,c){if(r(l))return l;if(l.kind==="element-loci"){for(var d=l.layers[0].loci.structure,f=[],h=0,v=l.layers;h<v.length;h++){var p=v[h],m=p.loci,g=p.value,y=Re.remap(m,c);m=Re.remap(y,d),Re.isEmpty(m)||f.push({loci:m,value:g})}return{kind:"element-loci",layers:f}}else return l}e.filter=a;function o(l,c){for(var d=[],f=0,h=l.length;f<h;++f){var v=l[f],p=v.script,m=v.value,g=$i.toLoci(p,c);Re.isEmpty(g)||d.push({loci:g,value:m})}return{kind:"element-loci",layers:d}}e.ofScript=o;function s(l,c){for(var d=[],f=0,h=l.length;f<h;++f){var v=l[f],p=v.bundle,m=v.value,g=on.toLoci(p,c.root);d.push({loci:g,value:m})}return{kind:"element-loci",layers:d}}e.ofBundle=s;function u(l){for(var c=[],d=0,f=l.layers.length;d<f;++d){var h=l.layers[d],v=h.loci,p=h.value,m=on.fromLoci(v);c.push({bundle:m,value:p})}return{kind:"element-loci",layers:c}}e.toBundle=u})(Yi||(Yi={}));var rc;(function(e){function t(){return{updateTransform:!1,updateMatrix:!1,updateColor:!1,updateSize:!1,createGeometry:!1,createNew:!1,info:{}}}e.create=t;function r(n){n.updateTransform=!1,n.updateMatrix=!1,n.updateColor=!1,n.updateSize=!1,n.createGeometry=!1,n.createNew=!1}e.reset=r})(rc||(rc={}));var mYe={lowestElementCount:1e6,lowerElementCount:5e5,lowElementCount:1e5,mediumElementCount:2e4,highElementCount:2e3,coarseGrainedFactor:10,elementCountFactor:1};function Lre(e,t){t===void 0&&(t={});var r=E(E({},mYe),t),n=e.elementCount*r.elementCountFactor;return e.isCoarseGrained&&(n*=r.coarseGrainedFactor),n>r.lowestElementCount?"lowest":n>r.lowerElementCount?"lower":n>r.lowElementCount?"low":n>r.mediumElementCount?"medium":n>r.highElementCount?"high":"higher"}function gYe(e){if(e.root.models.length===1){var t=vi.Provider.get(e.root.model);if(t&&t.spacegroup.name==="P 1"&&!Fo.isZero(t.spacegroup.cell))return t.spacegroup.cell.volume}return Kt.volume(e.root.boundary.box)}function CR(e,t){var r=Oi(e.quality,"auto"),n=Oi(e.detail,1),i=Oi(e.radialSegments,12),a=Oi(e.linearSegments,8),o=Oi(e.resolution,2),s=Oi(e.probePositions,12),u=Oi(e.doubleSided,!0),l=0;if(r==="auto"){if(t instanceof We)r=Lre(t.root),l=gYe(t);else if(Ct.is(t)){var c=t.grid.cells.space.dimensions,d=c[0],f=c[1],h=c[2];l=d*f*h,r=l<1e7?"medium":"low"}}switch(r){case"highest":n=3,i=36,a=18,o=.1,s=72,u=!0;break;case"higher":n=3,i=28,a=14,o=.3,s=48,u=!0;break;case"high":n=2,i=20,a=10,o=.5,s=36,u=!0;break;case"medium":n=1,i=12,a=8,o=.8,s=24,u=!0;break;case"low":n=0,i=8,a=3,o=1.3,s=24,u=!1;break;case"lower":n=0,i=4,a=2,o=3,s=12,u=!1;break;case"lowest":n=0,i=2,a=1,o=8,s=12,u=!1;break}return o=Math.max(o,l/5e8),o=Math.min(o,20),(e.alpha!==void 0&&e.alpha<1||e.xrayShaded)&&(u=!1),{detail:n,radialSegments:i,linearSegments:a,resolution:o,probePositions:s,doubleSided:u}}var Pr;(function(e){function t(c,d){c&&(c.state.visible=d)}e.setVisibility=t;function r(c,d){c&&(c.state.alphaFactor=d)}e.setAlphaFactor=r;function n(c,d){c&&(c.state.pickable=d)}e.setPickable=n;function i(c,d){c&&(c.state.colorOnly=d)}e.setColorOnly=i;function a(c,d,f,h){if(!c)return!1;var v=c.values,p=v.tMarker,m=v.uGroupCount,g=v.instanceCount,y=m.ref.value*g.ref.value,b=p.ref.value.array,S=!1;return Ws(d)?S=Ku(b,Ie.ofLength(y),f):Nu(d)||(S=h(d,function(x){return Ku(b,x,f)},!0)),S&&L.update(p,p.ref.value),S}e.mark=a;function o(c,d,f,h){if(c){var v=c.values,p=v.tOverpaint,m=v.uGroupCount,g=v.instanceCount,y=m.ref.value*g.ref.value;zje(d.layers.length?y:0,c.values);var b=p.ref.value.array;h&&iz(b,0,y);for(var S=function(w,A){var M=d.layers[w],D=M.loci,k=M.color,R=M.clear,O=function(H){var B=Ie.start(H),j=Ie.end(H);return R?iz(b,B,j):jje(b,B,j,k)};f(D,O,!1)},x=0,C=d.layers.length;x<C;++x)S(x);L.update(p,p.ref.value)}}e.setOverpaint=o;function s(c,d,f,h){if(c){var v=c.values,p=v.tTransparency,m=v.transparencyAverage,g=v.uGroupCount,y=v.instanceCount,b=g.ref.value*y.ref.value;Gje(d.layers.length?b:0,c.values);var S=p.ref.value.array;h&&Hje(S,0,b);for(var x=function(A,M){var D=d.layers[A],k=D.loci,R=D.value,O=function(H){var B=Ie.start(H),j=Ie.end(H);return Vje(S,B,j,R)};f(k,O,!1)},C=0,w=d.layers.length;C<w;++C)x(C);L.update(p,p.ref.value),L.updateIfChanged(m,Wee(S,b))}}e.setTransparency=s;function u(c,d,f,h){if(c){var v=c.values,p=v.tClipping,m=v.uGroupCount,g=v.instanceCount,y=m.ref.value*g.ref.value;Wje(d.layers.length?y:0,c.values);var b=p.ref.value.array;h&&$je(b,0,y);for(var S=function(w,A){var M=d.layers[w],D=M.loci,k=M.groups,R=function(O){var H=Ie.start(O),B=Ie.end(O);return qje(b,H,B,k)};f(D,R,!1)},x=0,C=d.layers.length;x<C;++x)S(x);L.update(p,p.ref.value)}}e.setClipping=u;function l(c,d,f){if(!(!c||!d&&!f)){var h=c.values;d&&(ue.copy(h.matrix.ref.value,d),L.update(h.matrix,h.matrix.ref.value)),f?(h.extraTransform.ref.value.set(f),L.update(h.extraTransform,h.extraTransform.ref.value)):f===null&&(cw(h.extraTransform.ref.value,h.instanceCount.ref.value),L.update(h.extraTransform,h.extraTransform.ref.value)),yJ(h);var v=Zi(h.invariantBoundingSphere.ref.value,h.aTransform.ref.value,h.instanceCount.ref.value);L.update(h.boundingSphere,v)}}e.setTransform=l})(Pr||(Pr={}));function ln(e){return{layers:e}}(function(e){e.Empty={layers:[]},function(l){l.is=_a.has;function c(p){return _a.create(p)}l.create=c,l.Names={one:1,two:2,three:4,four:8,five:16,six:32};function d(p){return p in l.Names}l.isName=d;function f(p){switch(p){case"one":return 1;case"two":return 2;case"three":return 4;case"four":return 8;case"five":return 16;case"six":return 32}}l.fromName=f;function h(p){for(var m=0,g=0,y=p.length;g<y;++g)m|=f(p[g]);return m}l.fromNames=h;function v(p){var m=[];return l.is(p,1)&&m.push("one"),l.is(p,2)&&m.push("two"),l.is(p,4)&&m.push("three"),l.is(p,8)&&m.push("four"),l.is(p,16)&&m.push("five"),l.is(p,32)&&m.push("six"),m}l.toNames=v}(e.Groups||(e.Groups={})),e.Type={none:0,plane:1,sphere:2,cube:3,cylinder:4,infiniteCone:5};function t(l,c){if(l.layers.length===0&&c.layers.length===0)return!0;if(l.layers.length!==c.layers.length)return!1;for(var d=0,f=l.layers.length;d<f;++d)if(l.layers[d].groups!==c.layers[d].groups||!sr.areEqual(l.layers[d].loci,c.layers[d].loci))return!1;return!0}e.areEqual=t;function r(l){return l.layers.length===0}e.isEmpty=r;function n(l,c){for(var d=[],f=0,h=l.layers;f<h.length;f++){var v=h[f],p=v.loci,m=v.groups;p=Re.remap(p,c),Re.isEmpty(p)||d.push({loci:p,groups:m})}return{layers:d}}e.remap=n;function i(l){if(r(l))return l;for(var c=l.layers[0].loci.structure,d=new Map,f=Re.none(c),h=0,v=l.layers.length;h<v;++h){var p=l.layers[v-h-1],m=p.loci,g=p.groups;m=Re.subtract(m,f),f=Re.union(m,f),Re.isEmpty(m)||(d.has(g)&&(m=Re.union(m,d.get(g))),d.set(g,m))}var y=[];return d.forEach(function(b,S){y.push({loci:b,groups:S})}),{layers:y}}e.merge=i;function a(l,c){if(r(l))return l;for(var d=l.layers[0].loci.structure,f=[],h=0,v=l.layers;h<v.length;h++){var p=v[h],m=p.loci,g=p.groups,y=Re.remap(m,c);m=Re.remap(y,d),Re.isEmpty(m)||f.push({loci:m,groups:g})}return{layers:f}}e.filter=a;function o(l,c){for(var d=[],f=0,h=l.length;f<h;++f){var v=l[f],p=v.script,m=v.groups,g=$i.toLoci(p,c);Re.isEmpty(g)||d.push({loci:g,groups:m})}return{layers:d}}e.ofScript=o;function s(l,c){for(var d=[],f=0,h=l.length;f<h;++f){var v=l[f],p=v.bundle,m=v.groups,g=on.toLoci(p,c.root);d.push({loci:g,groups:m})}return{layers:d}}e.ofBundle=s;function u(l){for(var c=[],d=0,f=l.layers.length;d<f;++d){var h=l.layers[d],v=h.loci,p=h.groups,m=on.fromLoci(v);c.push({bundle:m,groups:p})}return{layers:c}}e.toBundle=u})(ln||(ln={}));var DV;(function(e){function t(r,n,i){return I.getDefaultValues(r.getParams(n,i))}e.getDetaultParams=t})(DV||(DV={}));var yYe={label:"",description:"",factory:function(){return ur.Empty},getParams:function(){return{}},defaultValues:{}};function RV(e){return e.map(function(t){return[t.name,t.provider.label]})}var Nre=function(){function e(){this._list=[],this._map=new Map,this._name=new Map}return Object.defineProperty(e.prototype,"default",{get:function(){return this._list[0]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"types",{get:function(){return RV(this._list)},enumerable:!1,configurable:!0}),e.prototype.add=function(t){if(this._map.has(t.name))throw new Error(t.name+" already registered.");this._list.push({name:t.name,provider:t}),this._map.set(t.name,t),this._name.set(t,t.name)},e.prototype.getName=function(t){if(!this._name.has(t))throw new Error("'"+t.label+"' is not a registered represenatation provider.");return this._name.get(t)},e.prototype.remove=function(t){var r=t.name;this._list.splice(this._list.findIndex(function(i){return i.name===r}),1);var n=this._map.get(r);n&&(this._map.delete(r),this._name.delete(n))},e.prototype.get=function(t){return this._map.get(t)||yYe},Object.defineProperty(e.prototype,"list",{get:function(){return this._list},enumerable:!1,configurable:!0}),e.prototype.getApplicableList=function(t){return this._list.filter(function(r){return r.provider.isApplicable(t)})},e.prototype.getApplicableTypes=function(t){return RV(this.getApplicableList(t))},e}(),ur;(function(e){(function(a){function o(u,l){return u.repr===l.repr&&sr.areEqual(u.loci,l.loci)}a.areEqual=o;function s(u){return sr.isEmpty(u.loci)}a.isEmpty=s,a.Empty={loci:jr}})(e.Loci||(e.Loci={}));function t(){return{visible:!0,alphaFactor:1,pickable:!0,colorOnly:!1,syncManually:!1,transform:ue.identity(),overpaint:Xi.Empty,transparency:Yi.Empty,clipping:ln.Empty,markerActions:Lo.All}}e.createState=t;function r(a,o){o.visible!==void 0&&(a.visible=o.visible),o.alphaFactor!==void 0&&(a.alphaFactor=o.alphaFactor),o.pickable!==void 0&&(a.pickable=o.pickable),o.colorOnly!==void 0&&(a.colorOnly=o.colorOnly),o.overpaint!==void 0&&(a.overpaint=o.overpaint),o.transparency!==void 0&&(a.transparency=o.transparency),o.clipping!==void 0&&(a.clipping=o.clipping),o.syncManually!==void 0&&(a.syncManually=o.syncManually),o.transform!==void 0&&ue.copy(a.transform,o.transform),o.markerActions!==void 0&&(a.markerActions=o.markerActions)}e.updateState=r,e.StateBuilder={create:t,update:r},e.Empty={label:"",groupCount:0,renderObjects:[],props:{},params:{},updated:new ai,state:t(),theme:Si.createEmpty(),createOrUpdate:function(){return $e.constant("",void 0)},setState:function(){},setTheme:function(){},getLoci:function(){return jr},mark:function(){return!1},destroy:function(){}};function n(a,o,s,u,l){var c=this,d=0,f=new ai,h=u.create(),v=Si.createEmpty(),p,m,g,y={},b=Object.keys(l).map(function(S,x){y[x]=S;var C=l[S](o,s);return C.setState(h),C});return{label:a,updated:f,get groupCount(){var S=0;if(m)for(var x=m.visuals,C=0,w=b.length;C<w;++C)(!x||x.includes(y[C]))&&(S+=b[C].groupCount);return S},get renderObjects(){var S=[];if(m)for(var x=m.visuals,C=0,w=b.length;C<w;++C)(!x||x.includes(y[C]))&&S.push.apply(S,b[C].renderObjects);return S},get props(){return m},get params(){return p},createOrUpdate:function(S,x){S===void 0&&(S={}),x&&x!==g&&(p=s(o,x),g=x,m||(m=I.getDefaultValues(p)));var C=CR(Object.assign({},m,S),g);Object.assign(m,S,C);var w=m.visuals;return $e.create("Creating or updating '"+a+"' representation",function(A){return ce(c,void 0,void 0,function(){var M,D;return de(this,function(k){switch(k.label){case 0:M=0,D=b.length,k.label=1;case 1:return M<D?!w||w.includes(y[M])?[4,b[M].createOrUpdate(m,g).runInContext(A)]:[3,3]:[3,4];case 2:k.sent(),k.label=3;case 3:return++M,[3,1];case 4:return f.next(d++),[2]}})})})},get state(){return h},get theme(){return v},getLoci:function(S){for(var x=m.visuals,C=0,w=b.length;C<w;++C)if(!x||x.includes(y[C])){var A=b[C].getLoci(S);if(!Nu(A))return A}return jr},mark:function(S,x){for(var C=!1,w=0,A=b.length;w<A;++w)C=b[w].mark(S,x)||C;return C},setState:function(S){u.update(h,S);for(var x=0,C=b.length;x<C;++x)b[x].setState(h)},setTheme:function(S){for(var x=0,C=b.length;x<C;++x)b[x].setTheme(S)},destroy:function(){for(var S=0,x=b.length;S<x;++S)b[S].destroy()}}}e.createMulti=n;function i(a,o){var s=this,u=0,l=new ai,c=e.createState(),d=Si.createEmpty(),f=I.clone(Et.Params),h=I.getDefaultValues(Et.Params);return{label:a,updated:l,get groupCount(){return o.values.uGroupCount.ref.value},get renderObjects(){return[o]},get props(){return h},get params(){return f},createOrUpdate:function(v){v===void 0&&(v={});var p=CR(Object.assign({},h,v));return Object.assign(h,v,p),$e.create("Updating '"+a+"' representation",function(m){return ce(s,void 0,void 0,function(){return de(this,function(g){return l.next(u++),[2]})})})},get state(){return c},get theme(){return d},getLoci:function(){return jr},mark:function(v,p){return!1},setState:function(v){v.visible!==void 0&&Pr.setVisibility(o,v.visible),v.alphaFactor!==void 0&&Pr.setAlphaFactor(o,v.alphaFactor),v.pickable!==void 0&&Pr.setPickable(o,v.pickable),v.colorOnly!==void 0&&Pr.setColorOnly(o,v.colorOnly),v.overpaint,v.transparency,v.transform!==void 0&&Pr.setTransform(o,v.transform),e.updateState(c,v)},setTheme:function(){},destroy:function(){}}}e.fromRenderObject=i})(ur||(ur={}));function Li(e,t,r){r===void 0&&(r={});var n=0,i=new ai,a=ur.createState(),o=qd(),s=[],u,l,c=Si.createEmpty(),d=I.getDefaultValues(t.Params),f,h,v;r.modifyState&&ur.updateState(a,r.modifyState(a));var p=rc.create();function m(b,S){rc.reset(p),!(!S&&!l)&&(S&&!l?p.createNew=!0:S&&l&&S.id===l.id||(S&&l&&S.id!==l.id?(p.updateTransform=!0,p.createGeometry=!0):S&&console.warn("unexpected state")),p.updateTransform&&(p.updateColor=!0,p.updateSize=!0),p.createGeometry&&(p.updateColor=!0,p.updateSize=!0))}function g(b,S){var x=this;return b===void 0&&(b={}),r.modifyProps&&(b=r.modifyProps(b)),$e.create("ShapeRepresentation.create",function(C){return ce(x,void 0,void 0,function(){var w,A,M,D,k,R,O,H;return de(this,function(B){switch(B.label){case 0:return w=Object.assign(d,b),S?[4,e(C,S,w,l)]:[3,2];case 1:return M=B.sent(),[3,3];case 2:M=void 0,B.label=3;case 3:if(A=M,m(b,A),A&&(l=A,Object.assign(c,Ur.getTheme(l))),p.createNew)s.length=0,h=Ur.groupIterator(l),D=Ur.createTransform(l.transforms),k=t.createValues(l.geometry,D,h,c,w),R=t.createRenderableState(w),r.modifyState&&Object.assign(R,r.modifyState(R)),ur.updateState(a,R),u=Y0(l.geometry.kind,k,R,o),u&&s.push(u),v=t.createPositionIterator(l.geometry,u.values);else{if(!u)throw new Error("expected renderObject to be available");p.updateTransform&&(Ur.createTransform(l.transforms,u.values),h=Ur.groupIterator(l),O=h.instanceCount,H=h.groupCount,au(O*H,u.values)),p.createGeometry&&(L.updateIfChanged(u.values.drawCount,ha.getDrawCount(l.geometry)),L.updateIfChanged(u.values.uVertexCount,ha.getVertexCount(l.geometry))),(p.updateTransform||p.createGeometry)&&(t.updateBoundingSphere(u.values,l.geometry),v=t.createPositionIterator(l.geometry,u.values)),p.updateColor&&xs(h,v,c.color,u.values),p.updateSize&&"uSize"in u.values&&Fd(h,c.size,u.values),t.updateValues(u.values,w),t.updateRenderableState(u.state,w)}return d=w,i.next(n++),[2]}})})})}function y(b,S){return Ws(b)||Ur.isLoci(b)&&b.shape===l?S(Ie.ofBounds(0,l.groupCount*l.transforms.length)):bYe(b,l,S)}return{label:"Shape geometry",get groupCount(){return h?h.count:0},get props(){return d},get params(){return f},get state(){return a},get theme(){return c},renderObjects:s,updated:i,createOrUpdate:g,getLoci:function(b){if(b===void 0)return Ur.Loci(l);var S=b.objectId,x=b.groupId,C=b.instanceId;return u&&u.id===S?no.Loci(l,[{ids:Fe.ofSingleton(x),instance:C}]):jr},mark:function(b,S){if(!Lo.is(a.markerActions,S))return!1;if(no.isLoci(b)||Ur.isLoci(b)){if(b.shape!==l)return!1}else if(!Ws(b))return!1;return Pr.mark(u,b,S,y)},setState:function(b){r.modifyState&&(b=r.modifyState(b)),u&&(b.visible!==void 0&&Pr.setVisibility(u,b.visible),b.alphaFactor!==void 0&&Pr.setAlphaFactor(u,b.alphaFactor),b.pickable!==void 0&&Pr.setPickable(u,b.pickable),b.colorOnly!==void 0&&Pr.setColorOnly(u,b.colorOnly),b.overpaint!==void 0&&Pr.setOverpaint(u,b.overpaint,y,!0),b.transparency!==void 0&&Pr.setTransparency(u,b.transparency,y,!0),b.transform!==void 0&&Pr.setTransform(u,b.transform)),ur.updateState(a,b)},setTheme:function(b){Lr&&console.warn("The `ShapeRepresentation` theme is fixed to `ShapeGroupColorTheme` and `ShapeGroupSizeTheme`. Colors are taken from `Shape.getColor` and sizes from `Shape.getSize`")},destroy:function(){s.length=0,u&&(u.state.disposed=!0,u=void 0)}}}function bYe(e,t,r){if(!no.isLoci(e)||e.shape!==t)return!1;for(var n=!1,i=t.groupCount,a=e.groups,o=0,s=a;o<s.length;o++){var u=s[o],l=u.ids,c=u.instance;if(Ie.is(l)){var d=c*i+Ie.start(l),f=c*i+Ie.end(l);r(Ie.ofBounds(d,f))&&(n=!0)}else for(var h=0,v=l.length;h<v;h++){var p=c*i+l[h];r(Ie.ofSingleton(p))&&(n=!0)}}return n}var kV=ue(),b0=function(){function e(t){this.structure=t,this.groupUnitTransforms=[],this.unitOffsetMap=Qs.Mutable(),this.groupIndexMap=Qs.Mutable(),this._isIdentity=void 0,this.version=0,this.unitTransforms=new Float32Array(t.units.length*16),this.size=t.units.length,this.reset();for(var r=0,n=0,i=t.unitSymmetryGroups.length;n<i;++n){var a=t.unitSymmetryGroups[n];this.groupIndexMap.set(a.hashCode,n);var o=this.unitTransforms.subarray(r,r+a.units.length*16);this.groupUnitTransforms.push(o);for(var s=0,u=a.units.length;s<u;++s)this.unitOffsetMap.set(a.units[s].id,r+s*16);r+=a.units.length*16}}return e.prototype.reset=function(){this.version=0,cw(this.unitTransforms,this.size),this._isIdentity=!0},Object.defineProperty(e.prototype,"isIdentity",{get:function(){if(this._isIdentity===void 0){this._isIdentity=!0;for(var t=0,r=this.size*16;t<r;t+=16)if(ue.fromArray(kV,this.unitTransforms,t),!ue.isIdentity(kV)){this._isIdentity=!1;break}}return this._isIdentity},enumerable:!1,configurable:!0}),e.prototype.setTransform=function(t,r){this.version=(this.version+1)%2147483647,ue.toArray(t,this.unitTransforms,this.unitOffsetMap.get(r.id)),this._isIdentity=void 0},e.prototype.getTransform=function(t,r){return ue.fromArray(t,this.unitTransforms,this.unitOffsetMap.get(r.id))},e.prototype.getSymmetryGroupTransforms=function(t){return this.groupUnitTransforms[this.groupIndexMap.get(t.hashCode)]},e}(),OV=ue.zero();function FV(e,t,r){for(var n=0,i=e.units.length;n<i;n++){var a=e.units[n];Cn.lerpFromIdentity(OV,a.conformation.operator,r),t.setTransform(OV,a)}}var LV=_.zero(),mg=_.zero(),Rw=ue.zero();function NV(e,t,r){for(var n=e.boundary.sphere,i=n.radius*r,a=0,o=e.units.length;a<o;a++){var s=e.units[a];_.transformMat4(LV,s.lookup3d.boundary.sphere.center,s.conformation.operator.matrix),_.sub(mg,LV,n.center),_.setMagnitude(mg,mg,i),ue.fromTranslation(Rw,mg),t.setTransform(Rw,s)}}var xYe={axis:I.MappedStatic("custom",{structure:I.Group({principalAxis:I.Select("dirA",[["dirA","A"],["dirB","B"],["dirC","C"]])}),custom:I.Group({vector:I.Vec3(_.create(0,0,1))})}),origin:I.MappedStatic("structure",{structure:I.Group({}),custom:I.Group({vector:I.Vec3(_.create(0,0,0))})})};function BV(e,t){var r,n;if(t.axis.name==="custom")r=t.axis.params.vector;else{var i=We.getPrincipalAxes(e);r=i.momentsAxes[t.axis.params.principalAxis]}if(t.origin.name==="custom")n=t.origin.params.vector;else{var i=We.getPrincipalAxes(e);n=i.momentsAxes.origin}return{axis:r,origin:n}}var UV=ue(),jV=ue(),dS=ue();function zV(e,t,r,n,i){for(var a=0,o=e.units.length;a<o;a++){var s=e.units[a];_.negate(mg,i),ue.fromTranslation(Rw,mg),ue.fromRotation(UV,Math.PI*r*2,n),ue.fromTranslation(jV,i),ue.mul(dS,UV,Rw),ue.mul(dS,jV,dS),t.setTransform(dS,s)}}var SYe=ue.fromTranslation(ue(),_.create(.5,.5,.5)),CYe=Kee(Yee(Zee()),SYe),hu=_(),VV=ue(),_Ye={origin:"Origin",model:"Model"},wYe={corner:"Corner",center:"Center"},EYe=E(E({},Lt.Params),{cellColor:I.Color(pr.orange),cellScale:I.Numeric(2,{min:.1,max:5,step:.1}),ref:I.Select("model",I.objectToOptions(_Ye),{isEssential:!0}),attachment:I.Select("corner",I.objectToOptions(wYe),{isEssential:!0})}),AYe={mesh:function(e,t){return Li(TYe,Lt.Utils)}},HV=E({},EYe);function PYe(e,t,r){var n=wt.createState(256,128,r),i=e.symmetry.spacegroup.cell.fromFractional;_.copy(hu,e.ref),t.attachment==="center"?(_.trunc(hu,hu),_.subScalar(hu,hu,.5)):_.floor(hu,hu),ue.fromTranslation(VV,hu);var a=Kee(Yee(CYe),VV),o=Math.cbrt(e.symmetry.spacegroup.cell.volume)/300*t.cellScale;n.currentGroup=1,wt.addCage(n,i,a,o,2,20);var s=Be.fromDimensionsAndTransform(Be(),_.unit,i);_.transformMat4(hu,hu,i),Be.translate(s,s,hu),Be.expand(s,s,o);var u=wt.getMesh(n);return u.setBoundingSphere(s),u}function TYe(e,t,r,n){var i=PYe(t,r,n&&n.geometry),a=Wb.getUnitcellLabel(t.symmetry);return Ur.create(a,t,i,function(){return r.cellColor},function(){return 1},function(){return a})}function GV(e,t,r){var n=_();return r.ref==="model"&&_.transformMat4(n,Xt.getCenter(e),t.spacegroup.cell.toFractional),{symmetry:t,ref:n}}function IYe(e,t){return ur.createMulti("Unit Cell",e,t,ur.StateBuilder,AYe)}var As=new Uint16Array([0,1,2,1,3,2]),op=qe.add3,oa=qe.add2,qV=qe.add,bd;(function(e){function t(r,n,i,a){r===void 0&&(r={}),n===void 0&&(n=2048),i===void 0&&(i=1024),n*=2,i*=2;var o=qe.create(Float32Array,3,i,a?a.centerBuffer.ref.value:n),s=qe.create(Float32Array,2,i,a?a.mappingBuffer.ref.value:n),u=qe.create(Float32Array,1,i,a?a.depthBuffer.ref.value:n),l=qe.create(Uint32Array,3,i,a?a.indexBuffer.ref.value:n),c=qe.create(Float32Array,1,i,a?a.groupBuffer.ref.value:n),d=qe.create(Float32Array,2,i,a?a.tcoordBuffer.ref.value:n),f=E(E({},I.getDefaultValues(eu.Params)),r),h=f.attachment,v=f.background,p=f.backgroundMargin,m=f.tether,g=f.tetherLength,y=f.tetherBaseWidth,b=Xje(f),S=1/2.5*p,x=b.buffer/b.lineHeight,C=function(w,A,M,D,k){op(o,w,A,M),qV(u,D),qV(c,k)};return{add:function(w,A,M,D,k,R,O){for(var H=0,B=w.length,j=0;j<B;++j){var Y=b.get(w[j]);H+=Y.nw-2*x}var G=1/1.25,$,q;if(h.startsWith("top")?$=G:h.startsWith("middle")?$=G/2:$=0,h.endsWith("right")?q=H:h.endsWith("center")?q=H/2:q=0,m)switch(h){case"bottom-left":q-=g/2+S+.1,$-=g/2+S;break;case"bottom-center":$-=g+S;break;case"bottom-right":q+=g/2+S+.1,$-=g/2+S;break;case"middle-left":q-=g+S+.1;break;case"middle-center":break;case"middle-right":q+=g+S+.1;break;case"top-left":q-=g/2+S+.1,$+=g/2+S;break;case"top-center":$+=g+S;break;case"top-right":q+=g/2+S+.1,$+=g/2+S;break}var ee=(-q-S-.1)*R,fe=(H-q+S+.1)*R,W=(G-$+S)*R,X=(-$-S)*R;if(v){oa(s,ee,W),oa(s,ee,X),oa(s,fe,W),oa(s,fe,X);for(var U=o.elementCount,z=0;z<4;++z)oa(d,10,10),C(A,M,D,k,O);op(l,U+As[0],U+As[1],U+As[2]),op(l,U+As[3],U+As[4],U+As[5])}if(m){var J=void 0,K=void 0,Z=void 0,te=void 0,le=void 0,ye=void 0,be=void 0,Ae=void 0,Se=g*R,ie=y*R;switch(h){case"bottom-left":J=ee-Se/2,Z=ee+ie/2,le=ee,be=ee,K=X-Se/2,te=X,ye=X+ie/2,Ae=X;break;case"bottom-center":J=0,Z=ie/2,le=-ie/2,be=0,K=X-Se,te=X,ye=X,Ae=X;break;case"bottom-right":J=fe+Se/2,Z=fe,le=fe-ie/2,be=fe,K=X-Se/2,te=X+ie/2,ye=X,Ae=X;break;case"middle-left":J=ee-Se,Z=ee,le=ee,be=ee,K=0,te=-ie/2,ye=ie/2,Ae=0;break;case"middle-center":J=0,Z=0,le=0,be=0,K=0,te=0,ye=0,Ae=0;break;case"middle-right":J=fe+Se,Z=fe,le=fe,be=fe,K=0,te=ie/2,ye=-ie/2,Ae=0;break;case"top-left":J=ee-Se/2,Z=ee+ie/2,le=ee,be=ee,K=W+Se/2,te=W,ye=W-ie/2,Ae=W;break;case"top-center":J=0,Z=ie/2,le=-ie/2,be=0,K=W+Se,te=W,ye=W,Ae=W;break;case"top-right":J=fe+Se/2,Z=fe,le=fe-ie/2,be=fe,K=W+Se/2,te=W-ie/2,ye=W,Ae=W;break;default:throw new Error("unsupported attachment")}oa(s,J,K),oa(s,Z,te),oa(s,le,ye),oa(s,be,Ae);for(var U=o.elementCount,z=0;z<4;++z)oa(d,10,10),C(A,M,D,k,O);op(l,U,U+1,U+3),op(l,U,U+3,U+2)}q+=x,$+=x;for(var oe=0,j=0;j<B;++j){var Y=b.get(w[j]),F=(oe-q)*R,V=(oe+Y.nw-q)*R,pe=(Y.nh-$)*R,we=-$*R;oa(s,F,pe),oa(s,F,we),oa(s,V,pe),oa(s,V,we);var Te=b.texture.width,ze=b.texture.height;oa(d,Y.x/Te,Y.y/ze),oa(d,Y.x/Te,(Y.y+Y.h)/ze),oa(d,(Y.x+Y.w)/Te,Y.y/ze),oa(d,(Y.x+Y.w)/Te,(Y.y+Y.h)/ze),oe+=Y.nw-2*x;for(var U=o.elementCount,z=0;z<4;++z)C(A,M,D,k,O);op(l,U+As[0],U+As[1],U+As[2]),op(l,U+As[3],U+As[4],U+As[5])}},getText:function(){var w=b.texture,A=qe.compact(o,!0),M=qe.compact(s,!0),D=qe.compact(u,!0),k=qe.compact(l,!0),R=qe.compact(c,!0),O=qe.compact(d,!0);return eu.create(w,A,M,D,k,R,O,l.elementCount/2,a)}}}e.create=t})(bd||(bd={}));var K0={granularity:"element",condensed:!1,reverse:!1,countsOnly:!1,hidePrefix:!1,htmlStyling:!0};function Fh(e,t){switch(t===void 0&&(t={}),e.kind){case"structure-loci":return e.structure.models.map(function(l){return l.entry}).filter(function(l){return!!l}).join(", ");case"element-loci":return kw(Zf.ofLoci(e),t);case"bond-loci":var r=e.bonds[0];return r?EF(r):"";case"shape-loci":return e.shape.name;case"group-loci":var n=e.groups[0];return n?e.shape.getLabel(Fe.start(n.ids),n.instance):"";case"every-loci":return"Everything";case"empty-loci":return"Nothing";case"data-loci":return e.getLabel();case"volume-loci":return e.volume.label||"Volume";case"isosurface-loci":return[""+(e.volume.label||"Volume"),"Isosurface at "+Ct.IsoValue.toString(e.isoValue)].join(" | ");case"cell-loci":var i=Fe.size(e.indices),a=Fe.start(e.indices),o=Ct.IsoValue.absolute(e.volume.grid.cells.data[a]),s=Ct.IsoValue.toRelative(o,e.volume.grid.stats),u=[""+(e.volume.label||"Volume"),i===1?"Cell #"+a:i+" Cells"];return i===1&&u.push(Ct.IsoValue.toString(o)+" ("+Ct.IsoValue.toString(s)+")"),u.join(" | ")}}function Km(e,t){return e===1?"1 "+t:e+" "+t+"s"}function Dy(e,t,r,n,i,a){return yu(t,{granularity:r,hidePrefix:n,reverse:i,condensed:a})+" <small>[+ "+Km(e-1,"other "+L0(r))+"]</small>"}function MYe(e){var t=e.elements,r=e.model,n=r.atomicHierarchy,i=n.chainAtomSegments,a=n.residueAtomSegments,o=i.offsets[i.index[t[0]]],s=i.offsets[i.index[t[t.length-1]]+1]-1;return a.index[s]-a.index[o]+1}function kw(e,t){t===void 0&&(t={});var r=E(E({},K0),t),n=DYe(e,r.countsOnly,r.hidePrefix,r.condensed,r.reverse);return r.htmlStyling?n:Wf(n)}function DYe(e,t,r,n,i){t===void 0&&(t=!1),r===void 0&&(r=!1),n===void 0&&(n=!1),i===void 0&&(i=!1);var a=e.structureCount,o=e.chainCount,s=e.residueCount,u=e.conformationCount,l=e.elementCount;if(!t&&l===1&&s===0&&o===0)return yu(e.firstElementLoc,{hidePrefix:r,condensed:n,granularity:"element",reverse:i});if(!t&&l===0&&s===1&&o===0)return yu(e.firstResidueLoc,{hidePrefix:r,condensed:n,granularity:"residue",reverse:i});if(!t&&l===0&&s===0&&o===1){var c=e.firstChainLoc.unit,d=je.isAtomic(c)&&MYe(c)===1||je.Traits.is(c.traits,1)?"residue":"chain";return yu(e.firstChainLoc,{hidePrefix:r,condensed:n,granularity:d,reverse:i})}else if(t){var f=[];return a>0&&f.push(Km(a,"Structure")),o>0&&f.push(Km(o,"Chain")),s>0&&f.push(Km(s,"Residue")),u>0&&f.push(Km(u,"Conformation")),l>0&&f.push(Km(l,"Element")),f.join("<small> + </small>")}else{var f=[];return a>0&&f.push(a===1?yu(e.firstStructureLoc,{hidePrefix:r,condensed:n,granularity:"structure",reverse:i}):Dy(a,e.firstStructureLoc,"structure",r,i,n)),o>0&&(f.push(o===1?yu(e.firstChainLoc,{condensed:n,granularity:"chain",hidePrefix:r,reverse:i}):Dy(o,e.firstChainLoc,"chain",r,i,n)),r=!0),s>0&&(f.push(s===1?yu(e.firstResidueLoc,{condensed:n,granularity:"residue",hidePrefix:r,reverse:i}):Dy(s,e.firstResidueLoc,"residue",r,i,n)),r=!0),u>0&&(f.push(u===1?yu(e.firstConformationLoc,{condensed:n,granularity:"conformation",hidePrefix:r,reverse:i}):Dy(u,e.firstConformationLoc,"conformation",r,i,n)),r=!0),l>0&&f.push(l===1?yu(e.firstElementLoc,{condensed:n,granularity:"element",hidePrefix:r,reverse:i}):Dy(l,e.firstElementLoc,"element",r,i,n)),f.join("<small> + </small>")}}function EF(e,t){return t===void 0&&(t={}),cA({loci:[Re(e.aStructure,[{unit:e.aUnit,indices:Fe.ofSingleton(e.aIndex)}]),Re(e.bStructure,[{unit:e.bUnit,indices:Fe.ofSingleton(e.bIndex)}])]},t)}function cA(e,t){t===void 0&&(t={});var r=E(E({},K0),t),n=RYe(e,r);return r.htmlStyling?n:Wf(n)}function RYe(e,t){for(var r=t.granularity,n=t.hidePrefix,i=t.reverse,a=t.condensed,o=!0,s=0,u=e.loci;s<u.length;s++){var l=u[s];if(!Re.is(l)||Re.size(l)!==1){o=!1;break}}if(o){var c=e.loci.map(function(b){var S=b.elements[0],x=S.unit,C=S.indices;return Ze.create(b.structure,x,x.elements[Fe.start(C)])}),d=c.map(function(b){return Bre(b,r,n,i||a)});if(a)return d.map(function(b){return b[0].replace(/\[.*\]/g,"").trim()}).filter(function(b){return!!b}).join("  ");for(var f=0,h=0,v=Math.min.apply(Math,d.map(function(b){return b.length}))-1;h<v;++h){for(var p=!0,m=1,g=d.length;m<g;++m)if(d[0][h]!==d[m][h]){p=!1;break}if(p)f+=1;else break}if(f>0){for(var y=[d[0].join(" | ")],m=1,g=d.length;m<g;++m)y.push(d[m].slice(f).filter(function(x){return!!x}).join(" | "));return y.join("  ")}else return d.map(function(b){return b.filter(function(S){return!!S}).join(" | ")}).filter(function(b){return!!b}).join("</br>")}else{var d=e.loci.map(function(S){return Fh(S,t)});return d.filter(function(S){return!!S}).join(a?"  ":"</br>")}}function yu(e,t){var r,n;t===void 0&&(t={});var i=E(E({},K0),t),a=Bre(e,i.granularity,i.hidePrefix,i.reverse||i.condensed),o=i.condensed?(n=(r=a[0])===null||r===void 0?void 0:r.replace(/\[.*\]/g,"").trim())!==null&&n!==void 0?n:"":a.filter(function(s){return!!s}).join(" | ");return i.htmlStyling?o:Wf(o)}function Bre(e,t,r,n){t===void 0&&(t="element"),r===void 0&&(r=!1),n===void 0&&(n=!1);var i=[];if(!r){var a=e.unit.model.entry;a.length>30&&(a=a.substr(0,27)+""),i.push("<small>"+a+"</small>"),t!=="structure"&&(i.push("<small>Model "+e.unit.model.modelNum+"</small>"),i.push("<small>Instance "+e.unit.conformation.operator.name+"</small>"))}return je.isAtomic(e.unit)?i.push.apply(i,kYe(e,t,n)):je.isCoarse(e.unit)?i.push.apply(i,OYe(e,t)):i.push("Unknown"),n?i.reverse():i}function kYe(e,t,r){r===void 0&&(r=!1);var n=Ze.residueIndex(e),i=lt.chain.label_asym_id(e),a=lt.chain.auth_asym_id(e),o=e.unit.model.atomicHierarchy.residues.label_seq_id.valueKind(n)===0,s=lt.residue.label_seq_id(e),u=lt.residue.auth_seq_id(e),l=lt.residue.pdbx_PDB_ins_code(e),c=lt.atom.label_comp_id(e),d=lt.atom.label_atom_id(e),f=lt.atom.label_alt_id(e),h=lt.atom.occupancy(e),v=lt.residue.microheterogeneityCompIds(e),p=t==="residue"&&v.length>1?"("+v.join("|")+")":c,m=[];switch(t){case"element":m.push("<b>"+d+"</b>"+(f?"%"+f:""));case"conformation":t==="conformation"&&f&&m.push("<small>Conformation</small> <b>"+f+"</b>");case"residue":var g=s===u||!o?u:s;m.push("<b>"+p+" "+g+"</b>"+(g!==u?" <small>[auth</small> <b>"+u+"</b><small>]</small>":"")+"<b>"+(l||"")+"</b>");case"chain":i===a?m.push("<b>"+i+"</b>"):t==="chain"&&je.Traits.is(e.unit.traits,1)?m.push("<small>[auth</small> <b>"+a+"</b><small>]</small>"):m.push("<b>"+i+"</b> <small>[auth</small> <b>"+a+"</b><small>]</small>")}return m.length>0&&h!==1&&!r&&(m[0]=m[0]+" <small>[occupancy</small> <b>"+Math.round(100*h)/100+"</b><small>]</small>"),m.reverse()}function OYe(e,t){var r=lt.coarse.asym_id(e),n=lt.coarse.seq_id_begin(e),i=lt.coarse.seq_id_end(e),a=[];switch(t){case"element":case"conformation":case"residue":if(n===i){var o=lt.coarse.entityKey(e),s=e.unit.model.sequence.byEntityKey[o],u=s.sequence.compId.value(n-1);a.push("<b>"+u+" "+n+"</b>")}else a.push("<b>"+n+"-"+i+"</b>");case"chain":a.push("<b>"+r+"</b>")}return a.reverse()}function dA(e,t){t===void 0&&(t={});var r=E(E(E({},K0),{measureOnly:!1,unitLabel:""}),t),n=e.loci.map(function(u){return sr.getCenter(u)}),i=n[0],a=n[1],o=_.distance(i,a).toFixed(2)+" "+r.unitLabel;if(r.measureOnly)return o;var s=cA(e,r);return r.condensed?o+" | "+s:"Distance "+o+"</br>"+s}function fA(e,t){t===void 0&&(t={});var r=E(E(E({},K0),{measureOnly:!1}),t),n=e.loci.map(function(d){return sr.getCenter(d)}),i=n[0],a=n[1],o=n[2],s=_.sub(_(),i,a),u=_.sub(_(),o,a),l=ku(_.angle(s,u)).toFixed(2)+"";if(r.measureOnly)return l;var c=cA(e,r);return r.condensed?l+" | "+c:"Angle "+l+"</br>"+c}function hA(e,t){t===void 0&&(t={});var r=E(E(E({},K0),{measureOnly:!1}),t),n=e.loci.map(function(c){return sr.getCenter(c)}),i=n[0],a=n[1],o=n[2],s=n[3],u=ku(_.dihedralAngle(i,a,o,s)).toFixed(2)+"";if(r.measureOnly)return u;var l=cA(e,r);return r.condensed?u+" | "+l:"Dihedral "+u+"</br>"+l}var Ure={customText:I.Text("",{label:"Text",description:"Override the label with custom value."}),textColor:I.Color(pr.black,{isEssential:!0}),textSize:I.Numeric(.5,{min:.1,max:5,step:.1},{isEssential:!0})},pA=E(E(E({},eu.Params),Ure),{borderWidth:I.Numeric(.2,{min:0,max:.5,step:.01})}),jre={unitLabel:I.Text("",{isEssential:!0})},FYe=E(E(E({},Pn.Params),jre),{lineSizeAttenuation:I.Boolean(!0),linesColor:I.Color(pr.lightgreen,{isEssential:!0}),linesSize:I.Numeric(.075,{min:.01,max:5,step:.01}),dashLength:I.Numeric(.2,{min:.01,max:.2,step:.01})}),LYe=E(E({},pA),jre),zre={lines:function(e,t){return Li(UYe,Pn.Utils,{modifyState:function(r){return E(E({},r),{markerActions:Lo.Highlighting})}})},text:function(e,t){return Li(zYe,eu.Utils,{modifyState:function(r){return E(E({},r),{markerActions:nr.None})}})}},$V=E(E(E({},FYe),LYe),{visuals:I.MultiSelect(["lines","text"],I.objectToOptions(zre))});function NYe(){return{sphereA:Be(),sphereB:Be(),center:_(),distance:0}}function Vre(e,t){var r=t.sphereA,n=t.sphereB,i=t.center,a=e.loci,o=a[0],s=a[1];return sr.getBoundingSphere(o,r),sr.getBoundingSphere(s,n),_.add(i,r.center,n.center),_.scale(i,i,.5),t.distance=_.distance(r.center,n.center),t}var zf=NYe();function Hre(e,t){return e.pairs.length===1?"Distance "+dA(e.pairs[0],{unitLabel:t,measureOnly:!0}):e.pairs.length+" Distances"}function BYe(e,t,r){for(var n=vs.create(128,64,r),i=0,a=e.pairs.length;i<a;++i)Vre(e.pairs[i],zf),n.addFixedLengthDashes(zf.sphereA.center,zf.sphereB.center,t.dashLength,i);return n.getLines()}function UYe(e,t,r,n){var i=BYe(t,r,n&&n.geometry),a=Hre(t,r.unitLabel),o=function(s){return dA(t.pairs[s],r)};return Ur.create(a,t,i,function(){return r.linesColor},function(){return r.linesSize},o)}function jYe(e,t,r){for(var n=bd.create(t,128,64,r),i=0,a=e.pairs.length;i<a;++i){Vre(e.pairs[i],zf);var o=zf.center,s=zf.distance,u=zf.sphereA,l=zf.sphereB,c=t.customText||s.toFixed(2)+" "+t.unitLabel,d=Math.max(2,u.radius,l.radius),f=d/2;n.add(c,o[0],o[1],o[2],1,f,i)}return n.getText()}function zYe(e,t,r,n){var i=jYe(t,r,n&&n.geometry),a=Hre(t,r.unitLabel),o=function(s){return dA(t.pairs[s],r)};return Ur.create(a,t,i,function(){return r.textColor},function(){return r.textSize},o)}function VYe(e,t){return ur.createMulti("Distance",e,t,ur.StateBuilder,zre)}function WV(e){var t=e[0].loci,r=e[1].loci;return{pairs:[{loci:[t,r]}]}}function XV(e){var t=e[0].loci,r=e[1].loci,n=e[2].loci;return{triples:[{loci:[t,r,n]}]}}function YV(e){var t=e[0].loci,r=e[1].loci,n=e[2].loci,i=e[3].loci;return{quads:[{loci:[t,r,n,i]}]}}function KV(e){var t=e[0].loci;return{infos:[{loci:t}]}}function QV(e){var t=e[0].loci;return{locis:[t]}}var HYe=E(E({},pA),{offsetZ:I.Numeric(2,{min:0,max:10,step:.1})}),Gre={text:function(e,t){return Li(WYe,eu.Utils,{modifyState:function(r){return E(E({},r),{pickable:!1})}})}},ZV=E(E({},HYe),{scaleByRadius:I.Boolean(!0),visuals:I.MultiSelect(["text"],I.objectToOptions(Gre))}),GYe=Be();function AF(e,t){return t===void 0&&(t=!1),e.label||Fh(e.loci,{hidePrefix:!0,htmlStyling:!1,condensed:t})}function qYe(e){return e.infos.length===1?AF(e.infos[0]):e.infos.length+" Labels"}function $Ye(e,t,r){for(var n=bd.create(t,128,64,r),i=t.customText.trim(),a=0,o=e.infos.length;a<o;++a){var s=e.infos[a],u=sr.getBoundingSphere(s.loci,GYe);if(u){var l=u.center,c=u.radius,d=i||AF(s,!0);n.add(d,l[0],l[1],l[2],t.scaleByRadius?c/.9:0,t.scaleByRadius?Math.max(1,c):1,a)}}return n.getText()}function WYe(e,t,r,n){var i=$Ye(t,r,n&&n.geometry),a=qYe(t),o=r.customText.trim(),s=o?function(u){return o}:function(u){return AF(t.infos[u])};return Ur.create(a,t,i,function(){return r.textColor},function(){return r.textSize},s)}function XYe(e,t){return ur.createMulti("Label",e,t,ur.StateBuilder,Gre)}var sp=_(),YYe=ue.identity(),up=new Float32Array(6*3),KYe=new Uint8Array([0,1,2,3,4,5]);function QYe(e,t,r,n,i){var a=t.origin,o=t.dirA,s=t.dirB,u=t.dirC;_.add(sp,a,o),_.toArray(_.add(sp,a,o),up,0),_.toArray(_.sub(sp,a,o),up,3),_.toArray(_.add(sp,a,s),up,6),_.toArray(_.sub(sp,a,s),up,9),_.toArray(_.add(sp,a,u),up,12),_.toArray(_.sub(sp,a,u),up,15);var l=pF(up,KYe),c=Iu.volume(t),d=Math.cbrt(c)/300*r;wt.addCage(e,YYe,l,d,n,i)}_.zero();_.zero();var af=_(),ZYe=_(),JYe=_(),eKe=_(),tKe=ue.identity(),JV=new Float32Array(8*3),rKe=new Uint8Array([0,1,0,3,0,6,1,2,1,7,2,3,2,4,3,5,4,5,4,7,5,6,6,7]);function nKe(e,t,r,n,i){var a=t.origin,o=t.dirA,s=t.dirB,u=t.dirC,l=_.negate(ZYe,o),c=_.negate(JYe,s),d=_.negate(eKe,u),f=0,h=function(g,y,b){_.copy(af,a),_.add(af,af,g),_.add(af,af,y),_.add(af,af,b),_.toArray(af,JV,f),f+=3};h(o,s,u),h(o,s,d),h(o,c,d),h(o,c,u),h(l,c,d),h(l,c,u),h(l,s,u),h(l,s,d);var v=pF(JV,rKe),p=Iu.volume(t),m=Math.cbrt(p)/300*r;wt.addCage(e,tKe,v,m,n,i)}var iKe=ue.identity(),eH=_();function aKe(e,t,r,n,i){return _.add(eH,t,r),ue.targetTo(e,t,eH,n),ue.setTranslation(e,t),ue.scale(e,e,i)}function PF(e,t,r,n,i,a){wt.addPrimitive(e,aKe(iKe,t,r,n,i),mte(a))}var TF={color:I.Color(pr.orange),scale:I.Numeric(2,{min:.1,max:10,step:.1})},oKe=E(E({},Lt.Params),TF),sKe=E(E({},Lt.Params),TF);E(E({},Lt.Params),TF);var qre={axes:function(e,t){return Li(lKe,Lt.Utils)},box:function(e,t){return Li(dKe,Lt.Utils)},ellipsoid:function(e,t){return Li(hKe,Lt.Utils)}},tH=E(E(E({},oKe),sKe),{visuals:I.MultiSelect(["box"],I.objectToOptions(qre)),color:I.Color(pr.orange),scale:I.Numeric(2,{min:.1,max:5,step:.1})});function vA(e){var t=Fh(e,{countsOnly:!0});return"Principal Axes of "+t}function IF(e){return e.locis.length===1?vA(e.locis[0]):e.locis.length+" Orientations"}function uKe(e,t,r){for(var n=wt.createState(256,128,r),i=0,a=e.locis.length;i<a;++i){var o=sr.getPrincipalAxes(e.locis[i]);o&&(n.currentGroup=i,QYe(n,o.momentsAxes,t.scale,2,20))}return wt.getMesh(n)}function lKe(e,t,r,n){var i=uKe(t,r,n&&n.geometry),a=IF(t),o=function(s){return vA(t.locis[s])};return Ur.create(a,t,i,function(){return r.color},function(){return 1},o)}function cKe(e,t,r){for(var n=wt.createState(256,128,r),i=0,a=e.locis.length;i<a;++i){var o=sr.getPrincipalAxes(e.locis[i]);o&&(n.currentGroup=i,nKe(n,o.boxAxes,t.scale,2,20))}return wt.getMesh(n)}function dKe(e,t,r,n){var i=cKe(t,r,n&&n.geometry),a=IF(t),o=function(s){return vA(t.locis[s])};return Ur.create(a,t,i,function(){return r.color},function(){return 1},o)}function fKe(e,t,r){for(var n=wt.createState(256,128,r),i=0,a=e.locis.length;i<a;++i){var o=sr.getPrincipalAxes(e.locis[i]);if(o){var s=o.boxAxes,u=s.origin,l=s.dirA,c=s.dirB,d=Iu.size(_(),s);_.scale(d,d,.5);var f=_.create(d[2],d[1],d[0]);n.currentGroup=i,PF(n,u,l,c,f,2)}}return wt.getMesh(n)}function hKe(e,t,r,n){var i=fKe(t,r,n&&n.geometry),a=IF(t),o=function(s){return vA(t.locis[s])};return Ur.create(a,t,i,function(){return r.color},function(){return 1},o)}function pKe(e,t){var r=ur.createMulti("Orientation",e,t,ur.StateBuilder,qre);return r.setState({markerActions:Lo.Highlighting}),r}var vKe={radius:1,segments:36,thetaStart:0,thetaLength:Math.PI*2};function $re(e){var t=E(E({},vKe),e),r=t.radius,n=t.segments,i=t.thetaStart,a=t.thetaLength,o=a===Math.PI*2,s=o?n+1:n+2,u=new Float32Array(s*3),l=new Float32Array(s*3),c=new Uint32Array(n*3);u[0]=0,u[1]=0,u[2]=0,l[0]=0,l[1]=1,l[2]=0;for(var d=0,f=3;d<n;++d,f+=3){var h=i+d/n*a;u[f]=r*Math.sin(h),u[f+1]=0,u[f+2]=r*Math.cos(h),l[f]=0,l[f+1]=1,l[f+2]=0}for(var d=1,f=0;d<n;++d,f+=3)c[f]=d,c[f+1]=d+1,c[f+2]=0;if(o){var v=(n-1)*3;c[v]=n,c[v+1]=1,c[v+2]=0}else{var h=i+a,f=(n+1)*3;u[f]=r*Math.sin(h),u[f+1]=0,u[f+2]=r*Math.cos(h),l[f]=0,l[f+1]=1,l[f+2]=0;var v=(n-1)*3;c[v]=n,c[v+1]=n+1,c[v+2]=0}return{vertices:u,normals:l,indices:c}}var Wre={color:I.Color(pr.lightgreen),arcScale:I.Numeric(.7,{min:.01,max:1,step:.01})},Xre=E(E(E({},Pn.Params),Wre),{lineSizeAttenuation:I.Boolean(!0),linesSize:I.Numeric(.04,{min:.01,max:5,step:.01}),dashLength:I.Numeric(.04,{min:.01,max:.2,step:.01})}),mKe=E({},Xre),gKe=E({},Xre),yKe=E(E(E({},Lt.Params),Wre),{ignoreLight:I.Boolean(!0),sectorOpacity:I.Numeric(.75,{min:0,max:1,step:.01})}),Yre={vectors:function(e,t){return Li(SKe,Pn.Utils,{modifyState:function(r){return E(E({},r),{pickable:!1})}})},arc:function(e,t){return Li(_Ke,Pn.Utils,{modifyState:function(r){return E(E({},r),{pickable:!1})}})},sector:function(e,t){return Li(EKe,Lt.Utils,{modifyProps:function(r){return E(E({},r),{alpha:r.sectorOpacity})},modifyState:function(r){return E(E({},r),{markerActions:Lo.Highlighting})}})},text:function(e,t){return Li(PKe,eu.Utils,{modifyState:function(r){return E(E({},r),{markerActions:nr.None})}})}},rH=E(E(E(E(E({},mKe),gKe),yKe),pA),{visuals:I.MultiSelect(["vectors","sector","text"],I.objectToOptions(Yre))});function bKe(){return{sphereA:Be(),sphereB:Be(),sphereC:Be(),arcDirA:_(),arcDirC:_(),arcNormal:_(),radius:0,angle:0}}var of=_(),Ry=ue();function mA(e,t,r){var n=t.sphereA,i=t.sphereB,a=t.sphereC,o=t.arcDirA,s=t.arcDirC,u=t.arcNormal,l=e.loci,c=l[0],d=l[1],f=l[2];sr.getBoundingSphere(c,n),sr.getBoundingSphere(d,i),sr.getBoundingSphere(f,a),_.sub(o,n.center,i.center),_.sub(s,a.center,i.center),_.cross(u,o,s);var h=Math.min(_.magnitude(o),_.magnitude(s)),v=h*r;return t.radius=v,t.angle=_.angle(o,s),t}function Kre(e,t){var r=e.radius,n=e.angle,i=t?pZ(n,r)/t:32;ue.targetTo(Ry,e.sphereB.center,e.sphereA.center,e.arcNormal),ue.setTranslation(Ry,e.sphereB.center),ue.mul(Ry,Ry,ue.rotY180);var a=$re({radius:r,thetaLength:n,segments:i});return hF(a,Ry)}var la=bKe();function gA(e){return e.triples.length===1?"Angle "+fA(e.triples[0],{measureOnly:!0}):e.triples.length+" Angles"}function xKe(e,t,r){for(var n=vs.create(128,64,r),i=0,a=e.triples.length;i<a;++i)mA(e.triples[i],la,t.arcScale),n.addFixedLengthDashes(la.sphereB.center,la.sphereA.center,t.dashLength,i),n.addFixedLengthDashes(la.sphereB.center,la.sphereC.center,t.dashLength,i);return n.getLines()}function SKe(e,t,r,n){var i=xKe(t,r,n&&n.geometry),a=gA(t);return Ur.create(a,t,i,function(){return r.color},function(){return r.linesSize},function(){return""})}function CKe(e,t,r){for(var n=vs.create(128,64,r),i=0,a=e.triples.length;i<a;++i){mA(e.triples[i],la,t.arcScale);for(var o=Kre(la,t.dashLength),s=o.indices,u=o.vertices,l=0,c=s.length;l<c;l+=3)if(l%2!==1){var d=s[l]*3,f=s[l+1]*3,h=u[d],v=u[d+1],p=u[d+2],m=u[f],g=u[f+1],y=u[f+2];n.add(h,v,p,m,g,y,i)}}return n.getLines()}function _Ke(e,t,r,n){var i=CKe(t,r,n&&n.geometry),a=gA(t);return Ur.create(a,t,i,function(){return r.color},function(){return r.linesSize},function(){return""})}function wKe(e,t,r){for(var n=wt.createState(128,64,r),i=0,a=e.triples.length;i<a;++i){mA(e.triples[i],la,t.arcScale);var o=Kre(la);n.currentGroup=i,wt.addPrimitive(n,ue.id,o),wt.addPrimitiveFlipped(n,ue.id,o)}return wt.getMesh(n)}function EKe(e,t,r,n){var i=wKe(t,r,n&&n.geometry),a=gA(t),o=function(s){return fA(t.triples[s])};return Ur.create(a,t,i,function(){return r.color},function(){return 1},o)}function AKe(e,t,r){for(var n=bd.create(t,128,64,r),i=0,a=e.triples.length;i<a;++i){mA(e.triples[i],la,t.arcScale),_.add(of,la.arcDirA,la.arcDirC),_.setMagnitude(of,of,la.radius),_.add(of,la.sphereB.center,of);var o=ku(la.angle).toFixed(2),s=t.customText||o+"",u=Math.max(2,la.sphereA.radius,la.sphereB.radius,la.sphereC.radius),l=u/2;n.add(s,of[0],of[1],of[2],.1,l,i)}return n.getText()}function PKe(e,t,r,n){var i=AKe(t,r,n&&n.geometry),a=gA(t),o=function(s){return fA(t.triples[s])};return Ur.create(a,t,i,function(){return r.textColor},function(){return r.textSize},o)}function TKe(e,t){return ur.createMulti("Angle",e,t,ur.StateBuilder,Yre)}var Qre={color:I.Color(pr.lightgreen),arcScale:I.Numeric(.7,{min:.01,max:1,step:.01})},yA=E(E(E({},Pn.Params),Qre),{lineSizeAttenuation:I.Boolean(!0),linesSize:I.Numeric(.04,{min:.01,max:5,step:.01}),dashLength:I.Numeric(.04,{min:.01,max:.2,step:.01})}),IKe=E({},yA),MKe=E({},yA),DKe=E({},yA),RKe=E({},yA),kKe=E(E(E({},Lt.Params),Qre),{ignoreLight:I.Boolean(!0),sectorOpacity:I.Numeric(.75,{min:0,max:1,step:.01})}),Zre={vectors:function(e,t){return Li(LKe,Pn.Utils,{modifyState:function(r){return E(E({},r),{pickable:!1})}})},extenders:function(e,t){return Li(VKe,Pn.Utils,{modifyState:function(r){return E(E({},r),{pickable:!1})}})},connector:function(e,t){return Li(BKe,Pn.Utils,{modifyState:function(r){return E(E({},r),{pickable:!1})}})},arms:function(e,t){return Li(jKe,Pn.Utils,{modifyState:function(r){return E(E({},r),{pickable:!1})}})},arc:function(e,t){return Li(GKe,Pn.Utils,{modifyState:function(r){return E(E({},r),{pickable:!1})}})},sector:function(e,t){return Li($Ke,Lt.Utils,{modifyProps:function(r){return E(E({},r),{alpha:r.sectorOpacity})},modifyState:function(r){return E(E({},r),{markerActions:Lo.Highlighting})}})},text:function(e,t){return Li(XKe,eu.Utils,{modifyState:function(r){return E(E({},r),{markerActions:nr.None})}})}},nH=E(E(E(E(E(E(E({},IKe),MKe),DKe),RKe),kKe),pA),{visuals:I.MultiSelect(["extenders","arms","sector","text"],I.objectToOptions(Zre))});function OKe(){return{sphereA:Be(),sphereB:Be(),sphereC:Be(),sphereD:Be(),dirBA:_(),dirCD:_(),projA:_(),projD:_(),arcPointA:_(),arcPointD:_(),arcDirA:_(),arcDirD:_(),arcCenter:_(),arcNormal:_(),radius:0,angle:0}}var Na=_(),ky=ue();function nm(e,t,r){var n=t.sphereA,i=t.sphereB,a=t.sphereC,o=t.sphereD,s=t.dirBA,u=t.dirCD,l=t.projA,c=t.projD,d=t.arcPointA,f=t.arcPointD,h=t.arcDirA,v=t.arcDirD,p=t.arcCenter,m=t.arcNormal,g=e.loci,y=g[0],b=g[1],S=g[2],x=g[3];sr.getBoundingSphere(y,n),sr.getBoundingSphere(b,i),sr.getBoundingSphere(S,a),sr.getBoundingSphere(x,o),_.add(p,i.center,a.center),_.scale(p,p,.5),_.sub(s,n.center,i.center),_.sub(u,o.center,a.center),_.add(d,p,s),_.add(f,p,u),_.sub(m,a.center,i.center),_.orthogonalize(h,m,s),_.orthogonalize(v,m,u),_.projectPointOnVector(l,d,h,p),_.projectPointOnVector(c,f,v,p);var C=Math.min(_.distance(l,p),_.distance(c,p)),w=C*r;_.setMagnitude(h,h,w),_.setMagnitude(v,v,w),_.add(d,p,h),_.add(f,p,v),t.radius=w,t.angle=_.dihedralAngle(n.center,i.center,a.center,o.center),_.matchDirection(Na,m,_.sub(Na,d,n.center));var A=_.angle(s,Na),M=w/Math.cos(A-N1);_.add(l,i.center,_.setMagnitude(Na,s,M)),_.matchDirection(Na,m,_.sub(Na,f,o.center));var D=_.angle(u,Na),k=w/Math.cos(D-N1);return _.add(c,a.center,_.setMagnitude(Na,u,k)),t}function Jre(e,t){var r=e.radius,n=e.angle,i=t?pZ(n,r)/t:32;ue.targetTo(ky,e.arcCenter,n<0?e.arcPointD:e.arcPointA,e.arcNormal),ue.setTranslation(ky,e.arcCenter),ue.mul(ky,ky,ue.rotY180);var a=$re({radius:r,thetaLength:Math.abs(n),segments:i});return hF(a,ky)}var pn=OKe();function im(e){return e.quads.length===1?"Dihedral "+hA(e.quads[0],{measureOnly:!0}):e.quads.length+" Dihedrals"}function FKe(e,t,r){for(var n=vs.create(128,64,r),i=0,a=e.quads.length;i<a;++i)nm(e.quads[i],pn,t.arcScale),n.addFixedLengthDashes(pn.arcCenter,pn.arcPointA,t.dashLength,i),n.addFixedLengthDashes(pn.arcCenter,pn.arcPointD,t.dashLength,i);return n.getLines()}function LKe(e,t,r,n){var i=FKe(t,r,n&&n.geometry),a=im(t);return Ur.create(a,t,i,function(){return r.color},function(){return r.linesSize},function(){return""})}function NKe(e,t,r){for(var n=vs.create(128,64,r),i=0,a=e.quads.length;i<a;++i)nm(e.quads[i],pn,t.arcScale),n.addFixedLengthDashes(pn.sphereB.center,pn.sphereC.center,t.dashLength,i);return n.getLines()}function BKe(e,t,r,n){var i=NKe(t,r,n&&n.geometry),a=im(t);return Ur.create(a,t,i,function(){return r.color},function(){return r.linesSize},function(){return""})}function UKe(e,t,r){for(var n=vs.create(128,64,r),i=0,a=e.quads.length;i<a;++i)nm(e.quads[i],pn,t.arcScale),n.addFixedLengthDashes(pn.sphereB.center,pn.sphereA.center,t.dashLength,i),n.addFixedLengthDashes(pn.sphereC.center,pn.sphereD.center,t.dashLength,i);return n.getLines()}function jKe(e,t,r,n){var i=UKe(t,r,n&&n.geometry),a=im(t);return Ur.create(a,t,i,function(){return r.color},function(){return r.linesSize},function(){return""})}function zKe(e,t,r){for(var n=vs.create(128,64,r),i=0,a=e.quads.length;i<a;++i)nm(e.quads[i],pn,t.arcScale),n.addFixedLengthDashes(pn.arcPointA,pn.projA,t.dashLength,i),n.addFixedLengthDashes(pn.arcPointD,pn.projD,t.dashLength,i);return n.getLines()}function VKe(e,t,r,n){var i=zKe(t,r,n&&n.geometry),a=im(t);return Ur.create(a,t,i,function(){return r.color},function(){return r.linesSize},function(){return""})}function HKe(e,t,r){for(var n=vs.create(128,64,r),i=0,a=e.quads.length;i<a;++i){nm(e.quads[i],pn,t.arcScale);for(var o=Jre(pn,t.dashLength),s=o.indices,u=o.vertices,l=0,c=s.length;l<c;l+=3)if(l%2!==1){var d=s[l]*3,f=s[l+1]*3,h=u[d],v=u[d+1],p=u[d+2],m=u[f],g=u[f+1],y=u[f+2];n.add(h,v,p,m,g,y,i)}}return n.getLines()}function GKe(e,t,r,n){var i=HKe(t,r,n&&n.geometry),a=im(t);return Ur.create(a,t,i,function(){return r.color},function(){return r.linesSize},function(){return""})}function qKe(e,t,r){for(var n=wt.createState(128,64,r),i=0,a=e.quads.length;i<a;++i){nm(e.quads[i],pn,t.arcScale);var o=Jre(pn);n.currentGroup=i,wt.addPrimitive(n,ue.id,o),wt.addPrimitiveFlipped(n,ue.id,o)}return wt.getMesh(n)}function $Ke(e,t,r,n){var i=qKe(t,r,n&&n.geometry),a=im(t),o=function(s){return hA(t.quads[s])};return Ur.create(a,t,i,function(){return r.color},function(){return 1},o)}function WKe(e,t,r){for(var n=bd.create(t,128,64,r),i=0,a=e.quads.length;i<a;++i){nm(e.quads[i],pn,t.arcScale),_.add(Na,pn.arcDirA,pn.arcDirD),_.setMagnitude(Na,Na,pn.radius),_.add(Na,pn.arcCenter,Na);var o=ku(pn.angle).toFixed(2);o==="-0.00"&&(o="0.00");var s=t.customText||o+"",u=Math.max(2,pn.sphereA.radius,pn.sphereB.radius,pn.sphereC.radius,pn.sphereD.radius),l=u/2;n.add(s,Na[0],Na[1],Na[2],.1,l,i)}return n.getText()}function XKe(e,t,r,n){var i=WKe(t,r,n&&n.geometry),a=im(t),o=function(s){return hA(t.quads[s])};return Ur.create(a,t,i,function(){return r.textColor},function(){return r.textSize},o)}function YKe(e,t){return ur.createMulti("Dihedral",e,t,ur.StateBuilder,Zre)}var KKe=kt.BuiltIn({name:"box-shape-3d",display:"Box Shape",from:ge.Root,to:ge.Shape.Provider,params:{bottomLeft:I.Vec3(_()),topRight:I.Vec3(_.create(1,1,1)),radius:I.Numeric(.15,{min:.01,max:4,step:.01}),color:I.Color(pr.red)}})({canAutoUpdate:function(){return!0},apply:function(e){var t=this,r=e.params;return $e.create("Shape Representation",function(n){return ce(t,void 0,void 0,function(){return de(this,function(i){return[2,new ge.Shape.Provider({label:"Box",data:r,params:Lt.Params,getShape:function(a,o){var s=MF(Kt.create(r.bottomLeft,r.topRight),r.radius);return Ur.create("Box",o,s,function(){return o.color},function(){return 1},function(){return"Box"})},geometryUtils:Lt.Utils},{label:"Box"})]})})})}});function MF(e,t,r){var n=_.sub(_(),e.max,e.min),i=ue.fromTranslation(ue(),_.create(.5,.5,.5)),a=ue.fromScaling(ue(),n),o=ue.fromTranslation(ue(),e.min),s=ue.mul3(ue(),o,a,i),u=wt.createState(256,128,r);u.currentGroup=1,wt.addCage(u,s,Zee(),t,2,20);var l=wt.getMesh(u),c=_.scaleAndAdd(_(),e.min,n,.5),d=_.distance(e.min,c);return l.setBoundingSphere(Be.create(c,d)),l}const QKe=Object.freeze(Object.defineProperty({__proto__:null,BoxShape3D:KKe,getBoxMesh:MF},Symbol.toStringTag,{value:"Module"}));var Ow=kt.BuiltIn({name:"structure-representation-3d",display:"3D Representation",from:ge.Molecule.Structure,to:ge.Molecule.Structure.Representation3D,params:function(e,t){var r=t.representation.structure,n=r.registry,i=r.themes,a=n.get(n.default.name);if(!e){var o={help:function(l){var c=l.name,d=l.params,f=i.colorThemeRegistry.get(c),h=f.factory({},d);return{description:h.description,legend:h.legend}}};return{type:I.Mapped(n.default.name,n.types,function(l){return I.Group(n.get(l).getParams(i,We.Empty))}),colorTheme:I.Mapped(a.defaultColorTheme.name,i.colorThemeRegistry.types,function(l){return I.Group(i.colorThemeRegistry.get(l).getParams({structure:We.Empty}))},o),sizeTheme:I.Mapped(a.defaultSizeTheme.name,i.sizeThemeRegistry.types,function(l){return I.Group(i.sizeThemeRegistry.get(l).getParams({structure:We.Empty}))})}}var s={structure:e.data},u={help:function(l){var c=l.name,d=l.params,f=i.colorThemeRegistry.get(c),h=f.factory(s,d);return{description:h.description,legend:h.legend}}};return{type:I.Mapped(n.default.name,n.getApplicableTypes(e.data),function(l){return I.Group(n.get(l).getParams(i,e.data))}),colorTheme:I.Mapped(a.defaultColorTheme.name,i.colorThemeRegistry.getApplicableTypes(s),function(l){return I.Group(i.colorThemeRegistry.get(l).getParams(s))},u),sizeTheme:I.Mapped(a.defaultSizeTheme.name,i.sizeThemeRegistry.types,function(l){return I.Group(i.sizeThemeRegistry.get(l).getParams(s))})}}})({canAutoUpdate:function(e){var t=e.a,r=e.oldParams,n=e.newParams;return t.data.elementCount<1e4||r.type.name===n.type.name&&n.type.params.quality!=="custom"},apply:function(e,t){var r=this,n=e.a,i=e.params;return e.cache,$e.create("Structure Representation",function(a){return ce(r,void 0,void 0,function(){var o,s,u,l,c,d,f;return de(this,function(h){switch(h.label){case 0:return o={runtime:a,assetManager:t.managers.asset},s=t.representation.structure.registry.get(i.type.name),u=((d=s.getData)===null||d===void 0?void 0:d.call(s,n.data,i.type.params))||n.data,s.ensureCustomProperties?[4,s.ensureCustomProperties.attach(o,u)]:[3,2];case 1:h.sent(),h.label=2;case 2:return l=s.factory(E({webgl:(f=t.canvas3d)===null||f===void 0?void 0:f.webgl},t.representation.structure.themes),s.getParams),[4,Si.ensureDependencies(o,t.representation.structure.themes,{structure:u},i)];case 3:return h.sent(),l.setTheme(Si.create(t.representation.structure.themes,{structure:u},i)),c=i.type.params||{},[4,l.createOrUpdate(c,u).runInContext(a)];case 4:return h.sent(),[2,new ge.Molecule.Structure.Representation3D({repr:l,sourceData:n.data},{label:s.label})]}})})})},update:function(e,t){var r=this,n=e.a,i=e.b,a=e.oldParams,o=e.newParams;return e.cache,$e.create("Structure Representation",function(s){return ce(r,void 0,void 0,function(){var u,l,c,d,f,h;return de(this,function(v){switch(v.label){case 0:return o.type.name!==a.type.name?[2,ft.UpdateResult.Recreate]:(u=t.representation.structure.registry.get(o.type.name),!((f=u.mustRecreate)===null||f===void 0)&&f.call(u,a.type.params,o.type.params)?[2,ft.UpdateResult.Recreate]:(l=((h=u.getData)===null||h===void 0?void 0:h.call(u,n.data,o.type.params))||n.data,c={runtime:s,assetManager:t.managers.asset},u.ensureCustomProperties?[4,u.ensureCustomProperties.attach(c,l)]:[3,2]));case 1:v.sent(),v.label=2;case 2:return Si.releaseDependencies(t.representation.structure.themes,{structure:i.data.sourceData},a),[4,Si.ensureDependencies(c,t.representation.structure.themes,{structure:l},o)];case 3:return v.sent(),i.data.repr.setTheme(Si.create(t.representation.structure.themes,{structure:l},o)),d=E(E({},i.data.repr.props),o.type.params),[4,i.data.repr.createOrUpdate(d,l).runInContext(s)];case 4:return v.sent(),i.data.sourceData=n.data,[2,ft.UpdateResult.Updated]}})})})},dispose:function(e,t){var r=e.b,n=e.params;if(!(!r||!n)){var i=r.data.sourceData,a=t.representation.structure.registry.get(n.type.name);a.ensureCustomProperties&&a.ensureCustomProperties.detach(i),Si.releaseDependencies(t.representation.structure.themes,{structure:i},n)}},interpolate:function(e,t,r){if(e.colorTheme.name!=="uniform"||t.colorTheme.name!=="uniform")return r<=.5?e:t;var n=e.colorTheme.params.value,i=t.colorTheme.params.value,a=at.interpolate(n,i,r);return{type:r<=.5?e.type:t.type,colorTheme:{name:"uniform",params:{value:a}},sizeTheme:r<=.5?e.sizeTheme:t.sizeTheme}}}),ZKe=kt.BuiltIn({name:"unwind-structure-assembly-representation-3d",display:"Unwind Assembly 3D Representation",from:ge.Molecule.Structure.Representation3D,to:ge.Molecule.Structure.Representation3DState,params:{t:I.Numeric(0,{min:0,max:1,step:.01})}})({canAutoUpdate:function(){return!0},apply:function(e){var t=e.a,r=e.params,n=t.data.sourceData,i=new b0(n);return FV(n,i,r.t),new ge.Molecule.Structure.Representation3DState({state:{unitTransforms:i},initialState:{unitTransforms:new b0(n)},info:n,repr:t.data.repr},{label:"Unwind T = "+r.t.toFixed(2)})},update:function(e){var t=e.a,r=e.b,n=e.newParams,i=e.oldParams,a=r.data.info;if(t.data.sourceData!==a||t.data.repr!==r.data.repr)return ft.UpdateResult.Recreate;if(i.t===n.t)return ft.UpdateResult.Unchanged;var o=r.data.state.unitTransforms;return FV(a,o,n.t),r.label="Unwind T = "+n.t.toFixed(2),r.data.repr=t.data.repr,ft.UpdateResult.Updated}}),JKe=kt.BuiltIn({name:"explode-structure-representation-3d",display:"Explode 3D Representation",from:ge.Molecule.Structure.Representation3D,to:ge.Molecule.Structure.Representation3DState,params:{t:I.Numeric(0,{min:0,max:1,step:.01})}})({canAutoUpdate:function(){return!0},apply:function(e){var t=e.a,r=e.params,n=t.data.sourceData,i=new b0(n.root);return NV(n,i,r.t),new ge.Molecule.Structure.Representation3DState({state:{unitTransforms:i},initialState:{unitTransforms:new b0(n.root)},info:n.root,repr:t.data.repr},{label:"Explode T = "+r.t.toFixed(2)})},update:function(e){var t=e.a,r=e.b,n=e.newParams,i=e.oldParams,a=t.data.sourceData;if(r.data.info!==a.root||t.data.repr!==r.data.repr)return ft.UpdateResult.Recreate;if(i.t===n.t)return ft.UpdateResult.Unchanged;var o=r.data.state.unitTransforms;return NV(a.root,o,n.t),r.label="Explode T = "+n.t.toFixed(2),r.data.repr=t.data.repr,ft.UpdateResult.Updated}}),eQe=kt.BuiltIn({name:"spin-structure-representation-3d",display:"Spin 3D Representation",from:ge.Molecule.Structure.Representation3D,to:ge.Molecule.Structure.Representation3DState,params:E({t:I.Numeric(0,{min:0,max:1,step:.01})},xYe)})({canAutoUpdate:function(){return!0},apply:function(e){var t=e.a,r=e.params,n=t.data.sourceData,i=new b0(n.root),a=BV(n.root,r),o=a.axis,s=a.origin;return zV(n,i,r.t,o,s),new ge.Molecule.Structure.Representation3DState({state:{unitTransforms:i},initialState:{unitTransforms:new b0(n.root)},info:n.root,repr:t.data.repr},{label:"Spin T = "+r.t.toFixed(2)})},update:function(e){var t=e.a,r=e.b,n=e.newParams,i=e.oldParams,a=t.data.sourceData;if(r.data.info!==a.root||t.data.repr!==r.data.repr)return ft.UpdateResult.Recreate;if(i.t===n.t&&i.axis===n.axis&&i.origin===n.origin)return ft.UpdateResult.Unchanged;var o=r.data.state.unitTransforms,s=BV(a.root,n),u=s.axis,l=s.origin;return zV(a.root,o,n.t,u,l),r.label="Spin T = "+n.t.toFixed(2),r.data.repr=t.data.repr,ft.UpdateResult.Updated}}),tQe=kt.BuiltIn({name:"overpaint-structure-representation-3d-from-script",display:"Overpaint 3D Representation",from:ge.Molecule.Structure.Representation3D,to:ge.Molecule.Structure.Representation3DState,params:function(){return{layers:I.ObjectList({script:I.Script($i("(sel.atom.all)","mol-script")),color:I.Color(pr.blueviolet),clear:I.Boolean(!1)},function(e){return""+(e.clear?"Clear":at.toRgbString(e.color))},{defaultValue:[{script:$i("(sel.atom.all)","mol-script"),color:pr.blueviolet,clear:!1}]})}}})({canAutoUpdate:function(){return!0},apply:function(e){var t=e.a,r=e.params,n=t.data.sourceData,i=Xi.ofScript(r.layers,n);return new ge.Molecule.Structure.Representation3DState({state:{overpaint:i},initialState:{overpaint:Xi.Empty},info:n,repr:t.data.repr},{label:"Overpaint ("+i.layers.length+" Layers)"})},update:function(e){var t=e.a,r=e.b,n=e.newParams;e.oldParams;var i=r.data.info,a=t.data.sourceData;if(a!==i||t.data.repr!==r.data.repr)return ft.UpdateResult.Recreate;var o=r.data.state.overpaint,s=Xi.ofScript(n.layers,a);return Xi.areEqual(o,s)?ft.UpdateResult.Unchanged:(r.data.state.overpaint=s,r.data.repr=t.data.repr,r.label="Overpaint ("+s.layers.length+" Layers)",ft.UpdateResult.Updated)}}),rQe=kt.BuiltIn({name:"overpaint-structure-representation-3d-from-bundle",display:"Overpaint 3D Representation",from:ge.Molecule.Structure.Representation3D,to:ge.Molecule.Structure.Representation3DState,params:function(){return{layers:I.ObjectList({bundle:I.Value(on.Empty),color:I.Color(pr.blueviolet),clear:I.Boolean(!1)},function(e){return""+(e.clear?"Clear":at.toRgbString(e.color))},{defaultValue:[{bundle:on.Empty,color:pr.blueviolet,clear:!1}],isHidden:!0})}}})({canAutoUpdate:function(){return!0},apply:function(e){var t=e.a,r=e.params,n=t.data.sourceData,i=Xi.ofBundle(r.layers,n);return new ge.Molecule.Structure.Representation3DState({state:{overpaint:i},initialState:{overpaint:Xi.Empty},info:n,repr:t.data.repr},{label:"Overpaint ("+i.layers.length+" Layers)"})},update:function(e){var t=e.a,r=e.b,n=e.newParams;e.oldParams;var i=r.data.info,a=t.data.sourceData;if(a!==i||t.data.repr!==r.data.repr)return ft.UpdateResult.Recreate;var o=r.data.state.overpaint,s=Xi.ofBundle(n.layers,a);return Xi.areEqual(o,s)?ft.UpdateResult.Unchanged:(r.data.state.overpaint=s,r.data.repr=t.data.repr,r.label="Overpaint ("+s.layers.length+" Layers)",ft.UpdateResult.Updated)}}),nQe=kt.BuiltIn({name:"transparency-structure-representation-3d-from-script",display:"Transparency 3D Representation",from:ge.Molecule.Structure.Representation3D,to:ge.Molecule.Structure.Representation3DState,params:function(){return{layers:I.ObjectList({script:I.Script($i("(sel.atom.all)","mol-script")),value:I.Numeric(.5,{min:0,max:1,step:.01},{label:"Transparency"})},function(e){return"Transparency ("+e.value+")"},{defaultValue:[{script:$i("(sel.atom.all)","mol-script"),value:.5}]})}}})({canAutoUpdate:function(){return!0},apply:function(e){var t=e.a,r=e.params,n=t.data.sourceData,i=Yi.ofScript(r.layers,n);return new ge.Molecule.Structure.Representation3DState({state:{transparency:i},initialState:{transparency:Yi.Empty},info:n,repr:t.data.repr},{label:"Transparency ("+i.layers.length+" Layers)"})},update:function(e){var t=e.a,r=e.b,n=e.newParams;e.oldParams;var i=r.data.info;if(t.data.sourceData!==i||t.data.repr!==r.data.repr)return ft.UpdateResult.Recreate;var a=r.data.state.transparency,o=Yi.ofScript(n.layers,i);return Yi.areEqual(a,o)?ft.UpdateResult.Unchanged:(r.data.state.transparency=o,r.data.repr=t.data.repr,r.label="Transparency ("+o.layers.length+" Layers)",ft.UpdateResult.Updated)}}),iQe=kt.BuiltIn({name:"transparency-structure-representation-3d-from-bundle",display:"Transparency 3D Representation",from:ge.Molecule.Structure.Representation3D,to:ge.Molecule.Structure.Representation3DState,params:function(){return{layers:I.ObjectList({bundle:I.Value(on.Empty),value:I.Numeric(.5,{min:0,max:1,step:.01},{label:"Transparency"})},function(e){return"Transparency ("+e.value+")"},{defaultValue:[{bundle:on.Empty,value:.5}],isHidden:!0})}}})({canAutoUpdate:function(){return!0},apply:function(e){var t=e.a,r=e.params,n=t.data.sourceData,i=Yi.ofBundle(r.layers,n);return new ge.Molecule.Structure.Representation3DState({state:{transparency:i},initialState:{transparency:Yi.Empty},info:n,repr:t.data.repr},{label:"Transparency ("+i.layers.length+" Layers)"})},update:function(e){var t=e.a,r=e.b,n=e.newParams;e.oldParams;var i=r.data.info;if(t.data.sourceData!==i||t.data.repr!==r.data.repr)return ft.UpdateResult.Recreate;var a=r.data.state.transparency,o=Yi.ofBundle(n.layers,i);return Yi.areEqual(a,o)?ft.UpdateResult.Unchanged:(r.data.state.transparency=o,r.data.repr=t.data.repr,r.label="Transparency ("+o.layers.length+" Layers)",ft.UpdateResult.Updated)}}),aQe=kt.BuiltIn({name:"clipping-structure-representation-3d-from-script",display:"Clipping 3D Representation",from:ge.Molecule.Structure.Representation3D,to:ge.Molecule.Structure.Representation3DState,params:function(){return{layers:I.ObjectList({script:I.Script($i("(sel.atom.all)","mol-script")),groups:I.Converted(function(e){return ln.Groups.toNames(e)},function(e){return ln.Groups.fromNames(e)},I.MultiSelect(uA(ln.Groups.Names),I.objectToOptions(ln.Groups.Names)))},function(e){return ln.Groups.toNames(e.groups).length+" group(s)"},{defaultValue:[{script:$i("(sel.atom.all)","mol-script"),groups:0}]})}}})({canAutoUpdate:function(){return!0},apply:function(e){var t=e.a,r=e.params,n=t.data.sourceData,i=ln.ofScript(r.layers,n);return new ge.Molecule.Structure.Representation3DState({state:{clipping:i},initialState:{clipping:ln.Empty},info:n,repr:t.data.repr},{label:"Clipping ("+i.layers.length+" Layers)"})},update:function(e){var t=e.a,r=e.b,n=e.newParams;e.oldParams;var i=r.data.info;if(t.data.sourceData!==i||t.data.repr!==r.data.repr)return ft.UpdateResult.Recreate;var a=r.data.state.clipping,o=ln.ofScript(n.layers,i);return ln.areEqual(a,o)?ft.UpdateResult.Unchanged:(r.data.state.clipping=o,r.data.repr=t.data.repr,r.label="Clipping ("+o.layers.length+" Layers)",ft.UpdateResult.Updated)}}),oQe=kt.BuiltIn({name:"clipping-structure-representation-3d-from-bundle",display:"Clipping 3D Representation",from:ge.Molecule.Structure.Representation3D,to:ge.Molecule.Structure.Representation3DState,params:function(){return{layers:I.ObjectList({bundle:I.Value(on.Empty),groups:I.Converted(function(e){return ln.Groups.toNames(e)},function(e){return ln.Groups.fromNames(e)},I.MultiSelect(uA(ln.Groups.Names),I.objectToOptions(ln.Groups.Names)))},function(e){return ln.Groups.toNames(e.groups).length+" group(s)"},{defaultValue:[{bundle:on.Empty,groups:0}],isHidden:!0})}}})({canAutoUpdate:function(){return!0},apply:function(e){var t=e.a,r=e.params,n=t.data.sourceData,i=ln.ofBundle(r.layers,n);return new ge.Molecule.Structure.Representation3DState({state:{clipping:i},initialState:{clipping:ln.Empty},info:n,repr:t.data.repr},{label:"Clipping ("+i.layers.length+" Layers)"})},update:function(e){var t=e.a,r=e.b,n=e.newParams;e.oldParams;var i=r.data.info;if(t.data.sourceData!==i||t.data.repr!==r.data.repr)return ft.UpdateResult.Recreate;var a=r.data.state.clipping,o=ln.ofBundle(n.layers,i);return ln.areEqual(a,o)?ft.UpdateResult.Unchanged:(r.data.state.clipping=o,r.data.repr=t.data.repr,r.label="Clipping ("+o.layers.length+" Layers)",ft.UpdateResult.Updated)}}),Zc;(function(e){function t(i,a,o,s){var u=i.representation.volume.registry.get(a),l={volume:o},c=i.representation.volume.themes.colorThemeRegistry.get(u.defaultColorTheme.name).getParams(l),d=i.representation.volume.themes.sizeThemeRegistry.get(u.defaultSizeTheme.name).getParams(l),f=I.getDefaultValues(u.getParams(i.representation.volume.themes,o));return{type:{name:a,params:s?E(E({},f),s):f},colorTheme:{name:u.defaultColorTheme.name,params:I.getDefaultValues(c)},sizeTheme:{name:u.defaultSizeTheme.name,params:I.getDefaultValues(d)}}}e.getDefaultParams=t;function r(i,a,o,s,u,l,c){var d=i.representation.volume.registry.get(a),f=i.representation.volume.themes.colorThemeRegistry.get(s||d.defaultColorTheme.name),h=i.representation.volume.themes.sizeThemeRegistry.get(l||d.defaultSizeTheme.name);return{type:{name:a,params:o?E(E({},d.defaultValues),o):d.defaultValues},colorTheme:{name:d.defaultColorTheme.name,params:u?E(E({},f.defaultValues),u):f.defaultValues},sizeTheme:{name:d.defaultSizeTheme.name,params:c?E(E({},h.defaultValues),c):h.defaultValues}}}e.getDefaultParamsStatic=r;function n(i){var a,o,s,u;if(i.isoValue)return Ct.IsoValue.toString(i.isoValue);if(!((o=(a=i.renderMode)===null||a===void 0?void 0:a.params)===null||o===void 0)&&o.isoValue)return Ct.IsoValue.toString((u=(s=i.renderMode)===null||s===void 0?void 0:s.params)===null||u===void 0?void 0:u.isoValue)}e.getDescription=n})(Zc||(Zc={}));var sQe=kt.BuiltIn({name:"volume-representation-3d",display:"3D Representation",from:ge.Volume.Data,to:ge.Volume.Representation3D,params:function(e,t){var r=t.representation.volume,n=r.registry,i=r.themes,a=n.get(n.default.name);if(!e)return{type:I.Mapped(n.default.name,n.types,function(s){return I.Group(n.get(s).getParams(i,Ct.One))}),colorTheme:I.Mapped(a.defaultColorTheme.name,i.colorThemeRegistry.types,function(s){return I.Group(i.colorThemeRegistry.get(s).getParams({volume:Ct.One}))}),sizeTheme:I.Mapped(a.defaultSizeTheme.name,i.sizeThemeRegistry.types,function(s){return I.Group(i.sizeThemeRegistry.get(s).getParams({volume:Ct.One}))})};var o={volume:e.data};return{type:I.Mapped(n.default.name,n.types,function(s){return I.Group(n.get(s).getParams(i,e.data))}),colorTheme:I.Mapped(a.defaultColorTheme.name,i.colorThemeRegistry.getApplicableTypes(o),function(s){return I.Group(i.colorThemeRegistry.get(s).getParams(o))}),sizeTheme:I.Mapped(a.defaultSizeTheme.name,i.sizeThemeRegistry.types,function(s){return I.Group(i.sizeThemeRegistry.get(s).getParams(o))})}}})({canAutoUpdate:function(e){var t=e.oldParams,r=e.newParams;return t.type.name===r.type.name},apply:function(e,t){var r=this,n=e.a,i=e.params;return $e.create("Volume Representation",function(a){return ce(r,void 0,void 0,function(){var o,s,u,l,c;return de(this,function(d){switch(d.label){case 0:return o={runtime:a,assetManager:t.managers.asset},s=t.representation.volume.registry.get(i.type.name),s.ensureCustomProperties?[4,s.ensureCustomProperties.attach(o,n.data)]:[3,2];case 1:d.sent(),d.label=2;case 2:return u=s.factory(E({webgl:(c=t.canvas3d)===null||c===void 0?void 0:c.webgl},t.representation.volume.themes),s.getParams),u.setTheme(Si.create(t.representation.volume.themes,{volume:n.data},i)),l=i.type.params||{},[4,u.createOrUpdate(l,n.data).runInContext(a)];case 3:return d.sent(),[2,new ge.Volume.Representation3D({repr:u,sourceData:n.data},{label:s.label,description:Zc.getDescription(l)})]}})})})},update:function(e,t){var r=this,n=e.a,i=e.b,a=e.oldParams,o=e.newParams;return $e.create("Volume Representation",function(s){return ce(r,void 0,void 0,function(){var u,l,c;return de(this,function(d){switch(d.label){case 0:return o.type.name!==a.type.name?(u=t.representation.volume.registry.get(a.type.name),(c=u.ensureCustomProperties)===null||c===void 0||c.detach(n.data),[2,ft.UpdateResult.Recreate]):(l=E(E({},i.data.repr.props),o.type.params),i.data.repr.setTheme(Si.create(t.representation.volume.themes,{volume:n.data},o)),[4,i.data.repr.createOrUpdate(l,n.data).runInContext(s)]);case 1:return d.sent(),i.data.sourceData=n.data,i.description=Zc.getDescription(l),[2,ft.UpdateResult.Updated]}})})})}}),uQe=kt.BuiltIn({name:"shape-representation-3d",display:"3D Representation",from:ge.Shape.Provider,to:ge.Shape.Representation3D,params:function(e,t){return e?e.data.params:Et.Params}})({canAutoUpdate:function(){return!0},apply:function(e,t){var r=this,n=e.a,i=e.params;return $e.create("Shape Representation",function(a){return ce(r,void 0,void 0,function(){var o,s;return de(this,function(u){switch(u.label){case 0:return o=E(E({},I.getDefaultValues(n.data.params)),i),s=Li(n.data.getShape,n.data.geometryUtils),[4,s.createOrUpdate(o,n.data.data).runInContext(a)];case 1:return u.sent(),[2,new ge.Shape.Representation3D({repr:s,sourceData:n.data},{label:n.data.label})]}})})})},update:function(e,t){var r=this,n=e.a,i=e.b;e.oldParams;var a=e.newParams;return $e.create("Shape Representation",function(o){return ce(r,void 0,void 0,function(){var s;return de(this,function(u){switch(u.label){case 0:return s=E(E({},i.data.repr.props),a),[4,i.data.repr.createOrUpdate(s,n.data.data).runInContext(o)];case 1:return u.sent(),i.data.sourceData=n.data,[2,ft.UpdateResult.Updated]}})})})}}),lQe=kt.BuiltIn({name:"model-unitcell-3d",display:"Model Unit Cell",from:ge.Molecule.Model,to:ge.Shape.Representation3D,params:function(){return E({},HV)}})({isApplicable:function(e){return!!vi.Provider.get(e.data)},canAutoUpdate:function(e){return e.oldParams,e.newParams,!0},apply:function(e,t){var r=this,n=e.a,i=e.params;return $e.create("Model Unit Cell",function(a){return ce(r,void 0,void 0,function(){var o,s,u,l;return de(this,function(c){switch(c.label){case 0:return o=vi.Provider.get(n.data),o?(s=GV(n.data,o,i),u=IYe(E({webgl:(l=t.canvas3d)===null||l===void 0?void 0:l.webgl},t.representation.structure.themes),function(){return HV}),[4,u.createOrUpdate(i,s).runInContext(a)]):[2,Nn.Null];case 1:return c.sent(),[2,new ge.Shape.Representation3D({repr:u,sourceData:s},{label:"Unit Cell",description:o.spacegroup.name})]}})})})},update:function(e){var t=this,r=e.a,n=e.b,i=e.newParams;return $e.create("Model Unit Cell",function(a){return ce(t,void 0,void 0,function(){var o,s,u;return de(this,function(l){switch(l.label){case 0:return o=vi.Provider.get(r.data),o?(s=E(E({},n.data.repr.props),i),u=GV(r.data,o,s),[4,n.data.repr.createOrUpdate(s,u).runInContext(a)]):[2,ft.UpdateResult.Null];case 1:return l.sent(),n.data.sourceData=u,[2,ft.UpdateResult.Updated]}})})})}}),cQe=kt.BuiltIn({name:"structure-bounding-box-3d",display:"Bounding Box",from:ge.Molecule.Structure,to:ge.Shape.Representation3D,params:E({radius:I.Numeric(.05,{min:.01,max:4,step:.01},{isEssential:!0}),color:I.Color(pr.red,{isEssential:!0})},Lt.Params)})({canAutoUpdate:function(){return!0},apply:function(e,t){var r=this,n=e.a,i=e.params;return $e.create("Bounding Box",function(a){return ce(r,void 0,void 0,function(){var o;return de(this,function(s){switch(s.label){case 0:return o=Li(function(u,l,c,d){var f=MF(l.box,l.radius,d==null?void 0:d.geometry);return Ur.create("Bouding Box",l,f,function(){return l.color},function(){return 1},function(){return"Bounding Box"})},Lt.Utils),[4,o.createOrUpdate(i,{box:n.data.boundary.box,radius:i.radius,color:i.color}).runInContext(a)];case 1:return s.sent(),[2,new ge.Shape.Representation3D({repr:o,sourceData:n.data},{label:"Bounding Box"})]}})})})},update:function(e,t){var r=this,n=e.a,i=e.b;e.oldParams;var a=e.newParams;return $e.create("Bounding Box",function(o){return ce(r,void 0,void 0,function(){return de(this,function(s){switch(s.label){case 0:return[4,i.data.repr.createOrUpdate(a,{box:n.data.boundary.box,radius:a.radius,color:a.color}).runInContext(o)];case 1:return s.sent(),i.data.sourceData=n.data,[2,ft.UpdateResult.Updated]}})})})}}),dQe=kt.BuiltIn({name:"structure-selections-distance-3d",display:"3D Distance",from:ge.Molecule.Structure.Selections,to:ge.Shape.Representation3D,params:function(){return E({},$V)}})({canAutoUpdate:function(e){return e.oldParams,e.newParams,!0},apply:function(e,t){var r=this,n=e.a,i=e.params;return $e.create("Structure Distance",function(a){return ce(r,void 0,void 0,function(){var o,s,u;return de(this,function(l){switch(l.label){case 0:return o=WV(n.data),s=VYe(E({webgl:(u=t.canvas3d)===null||u===void 0?void 0:u.webgl},t.representation.structure.themes),function(){return $V}),[4,s.createOrUpdate(i,o).runInContext(a)];case 1:return l.sent(),[2,new ge.Shape.Representation3D({repr:s,sourceData:o},{label:"Distance"})]}})})})},update:function(e,t){var r=this,n=e.a,i=e.b;e.oldParams;var a=e.newParams;return $e.create("Structure Distance",function(o){return ce(r,void 0,void 0,function(){var s,u;return de(this,function(l){switch(l.label){case 0:return s=E(E({},i.data.repr.props),a),u=WV(n.data),[4,i.data.repr.createOrUpdate(s,u).runInContext(o)];case 1:return l.sent(),i.data.sourceData=u,[2,ft.UpdateResult.Updated]}})})})}}),fQe=kt.BuiltIn({name:"structure-selections-angle-3d",display:"3D Angle",from:ge.Molecule.Structure.Selections,to:ge.Shape.Representation3D,params:function(){return E({},rH)}})({canAutoUpdate:function(e){return e.oldParams,e.newParams,!0},apply:function(e,t){var r=this,n=e.a,i=e.params;return $e.create("Structure Angle",function(a){return ce(r,void 0,void 0,function(){var o,s,u;return de(this,function(l){switch(l.label){case 0:return o=XV(n.data),s=TKe(E({webgl:(u=t.canvas3d)===null||u===void 0?void 0:u.webgl},t.representation.structure.themes),function(){return rH}),[4,s.createOrUpdate(i,o).runInContext(a)];case 1:return l.sent(),[2,new ge.Shape.Representation3D({repr:s,sourceData:o},{label:"Angle"})]}})})})},update:function(e,t){var r=this,n=e.a,i=e.b;e.oldParams;var a=e.newParams;return $e.create("Structure Angle",function(o){return ce(r,void 0,void 0,function(){var s,u;return de(this,function(l){switch(l.label){case 0:return s=E(E({},i.data.repr.props),a),u=XV(n.data),[4,i.data.repr.createOrUpdate(s,u).runInContext(o)];case 1:return l.sent(),i.data.sourceData=u,[2,ft.UpdateResult.Updated]}})})})}}),hQe=kt.BuiltIn({name:"structure-selections-dihedral-3d",display:"3D Dihedral",from:ge.Molecule.Structure.Selections,to:ge.Shape.Representation3D,params:function(){return E({},nH)}})({canAutoUpdate:function(e){return e.oldParams,e.newParams,!0},apply:function(e,t){var r=this,n=e.a,i=e.params;return $e.create("Structure Dihedral",function(a){return ce(r,void 0,void 0,function(){var o,s,u;return de(this,function(l){switch(l.label){case 0:return o=YV(n.data),s=YKe(E({webgl:(u=t.canvas3d)===null||u===void 0?void 0:u.webgl},t.representation.structure.themes),function(){return nH}),[4,s.createOrUpdate(i,o).runInContext(a)];case 1:return l.sent(),[2,new ge.Shape.Representation3D({repr:s,sourceData:o},{label:"Dihedral"})]}})})})},update:function(e,t){var r=this,n=e.a,i=e.b;e.oldParams;var a=e.newParams;return $e.create("Structure Dihedral",function(o){return ce(r,void 0,void 0,function(){var s,u;return de(this,function(l){switch(l.label){case 0:return s=E(E({},i.data.repr.props),a),u=YV(n.data),[4,i.data.repr.createOrUpdate(s,u).runInContext(o)];case 1:return l.sent(),i.data.sourceData=u,[2,ft.UpdateResult.Updated]}})})})}}),pQe=kt.BuiltIn({name:"structure-selections-label-3d",display:"3D Label",from:ge.Molecule.Structure.Selections,to:ge.Shape.Representation3D,params:function(){return E({},ZV)}})({canAutoUpdate:function(e){return e.oldParams,e.newParams,!0},apply:function(e,t){var r=this,n=e.a,i=e.params;return $e.create("Structure Label",function(a){return ce(r,void 0,void 0,function(){var o,s,u;return de(this,function(l){switch(l.label){case 0:return o=KV(n.data),s=XYe(E({webgl:(u=t.canvas3d)===null||u===void 0?void 0:u.webgl},t.representation.structure.themes),function(){return ZV}),[4,s.createOrUpdate(i,o).runInContext(a)];case 1:return l.sent(),[2,new ge.Shape.Representation3D({repr:s,sourceData:o},{label:"Label"})]}})})})},update:function(e,t){var r=this,n=e.a,i=e.b;e.oldParams;var a=e.newParams;return $e.create("Structure Label",function(o){return ce(r,void 0,void 0,function(){var s,u;return de(this,function(l){switch(l.label){case 0:return s=E(E({},i.data.repr.props),a),u=KV(n.data),[4,i.data.repr.createOrUpdate(s,u).runInContext(o)];case 1:return l.sent(),i.data.sourceData=u,[2,ft.UpdateResult.Updated]}})})})}}),vQe=kt.BuiltIn({name:"structure-selections-orientation-3d",display:"3D Orientation",from:ge.Molecule.Structure.Selections,to:ge.Shape.Representation3D,params:function(){return E({},tH)}})({canAutoUpdate:function(e){return e.oldParams,e.newParams,!0},apply:function(e,t){var r=this,n=e.a,i=e.params;return $e.create("Structure Orientation",function(a){return ce(r,void 0,void 0,function(){var o,s,u;return de(this,function(l){switch(l.label){case 0:return o=QV(n.data),s=pKe(E({webgl:(u=t.canvas3d)===null||u===void 0?void 0:u.webgl},t.representation.structure.themes),function(){return tH}),[4,s.createOrUpdate(i,o).runInContext(a)];case 1:return l.sent(),[2,new ge.Shape.Representation3D({repr:s,sourceData:o},{label:"Orientation"})]}})})})},update:function(e,t){var r=this,n=e.a,i=e.b;e.oldParams;var a=e.newParams;return $e.create("Structure Orientation",function(o){return ce(r,void 0,void 0,function(){var s,u;return de(this,function(l){switch(l.label){case 0:return s=E(E({},i.data.repr.props),a),u=QV(n.data),[4,i.data.repr.createOrUpdate(s,u).runInContext(o)];case 1:return l.sent(),i.data.sourceData=u,[2,ft.UpdateResult.Updated]}})})})}});const mQe=Object.freeze(Object.defineProperty({__proto__:null,ClippingStructureRepresentation3DFromBundle:oQe,ClippingStructureRepresentation3DFromScript:aQe,ExplodeStructureRepresentation3D:JKe,ModelUnitcell3D:lQe,OverpaintStructureRepresentation3DFromBundle:rQe,OverpaintStructureRepresentation3DFromScript:tQe,ShapeRepresentation3D:uQe,SpinStructureRepresentation3D:eQe,StructureBoundingBox3D:cQe,StructureRepresentation3D:Ow,StructureSelectionsAngle3D:fQe,StructureSelectionsDihedral3D:hQe,StructureSelectionsDistance3D:dQe,StructureSelectionsLabel3D:pQe,StructureSelectionsOrientation3D:vQe,TransparencyStructureRepresentation3DFromBundle:iQe,TransparencyStructureRepresentation3DFromScript:nQe,UnwindStructureAssemblyRepresentation3D:ZKe,VolumeRepresentation3D:sQe,get VolumeRepresentation3DHelpers(){return Zc}},Symbol.toStringTag,{value:"Module"}));var rt={Data:eje,Misc:rje,Model:vWe,Volume:PWe,Representation:mQe,Shape:QKe},gQe={H:"Hydrogen",HE:"Helium",LI:"Lithium",BE:"Beryllium",B:"Boron",C:"Carbon",N:"Nitrogen",O:"Oxygen",F:"Fluorine",NE:"Neon",NA:"Sodium",MG:"Magnesium",AL:"Aluminum",SI:"Silicon",P:"Phosphorus",S:"Sulfur",CL:"Chlorine",AR:"Argon",K:"Potassium",CA:"Calcium",SC:"Scandium",TI:"Titanium",V:"Vanadium",CR:"Chromium",MN:"Manganese",FE:"Iron",CO:"Cobalt",NI:"Nickel",CU:"Copper",ZN:"Zinc",GA:"Gallium",GE:"Germanium",AS:"Arsenic",SE:"Selenium",BR:"Bromine",KR:"Krypton",RB:"Rubidium",SR:"Strontium",Y:"Yttrium",ZR:"Zirconium",NB:"Niobium",MO:"Molybdenum",TC:"Technetium",RU:"Ruthenium",RH:"Rhodium",PD:"Palladium",AG:"Silver",CD:"Cadmium",IN:"Indium",SN:"Tin",SB:"Antimony",TE:"Tellurium",I:"Iodine",XE:"Xenon",CS:"Cesium",BA:"Barium",LA:"Lanthanum",CE:"Cerium",PR:"Praseodymium",ND:"Neodymium",PM:"Promethium",SM:"Samarium",EU:"Europium",GD:"Gadolinium",TB:"Terbium",DY:"Dysprosium",HO:"Holmium",ER:"Erbium",TM:"Thulium",YB:"Ytterbium",LU:"Lutetium",HF:"Hafnium",TA:"Tantalum",W:"Wolfram",RE:"Rhenium",OS:"Osmium",IR:"Iridium",PT:"Platinum",AU:"Gold",HG:"Mercury",TL:"Thallium",PB:"Lead",BI:"Bismuth",PO:"Polonium",AT:"Astatine",RN:"Radon",FR:"Francium",RA:"Radium",AC:"Actinium",TH:"Thorium",PA:"Protactinium",U:"Uranium",NP:"Neptunium",PU:"Plutonium",AM:"Americium",CM:"Curium",BK:"Berkelium",CF:"Californium",ES:"Einsteinium",FM:"Fermium",MD:"Mendelevium",NO:"Nobelium",LR:"Lawrencium",RF:"Rutherfordium",DB:"Dubnium",SG:"Seaborgium",BH:"Bohrium",HS:"Hassium",MT:"Meitnerium",DS:"Darmstadtium",RG:"Roentgenium",CN:"Copernicium",NH:"Nihonium",FL:"Flerovium",MC:"Moscovium",LV:"Livermorium",TS:"Tennessine",OG:"Oganesson"},yQe=new Set(["LI","NA","K","RB","CS","FR"]);function bQe(e){return yQe.has(e)}var xQe=new Set(["BE","MG","CA","SR","BA","RA"]);function SQe(e){return xQe.has(e)}var CQe=new Set(["ZN","GA","CD","IN","SN","HG","TI","PB","BI","PO","CN"]);function _Qe(e){return CQe.has(e)}var wQe=new Set(["F","CL","BR","I","AT"]);function EQe(e){return wQe.has(e)}function ene(e){var t=P2(e);return t>=21&&t<=29||t>=39&&t<=47||t>=72&&t<=79||t>=104&&t<=108}function AQe(e){var t=P2(e);return t>=57&&t<=71}function PQe(e){var t=P2(e);return t>=89&&t<=103}function TQe(e){return bQe(e)||SQe(e)||AQe(e)||PQe(e)||ene(e)||_Qe(e)}var qr;(function(e){e.Type="Type",e.Structure="Structure Property",e.Atom="Atom Property",e.Bond="Bond Property",e.Residue="Residue Property",e.AminoAcid="Amino Acid",e.NucleicBase="Nucleic Base",e.Manipulate="Manipulate Selection",e.Validation="Validation",e.Misc="Miscellaneous",e.Internal="Internal"})(qr||(qr={}));function $r(e,t,r){var n;r===void 0&&(r={});var i;return{label:e,expression:t,description:r.description||"",category:(n=r.category)!==null&&n!==void 0?n:qr.Misc,isHidden:!!r.isHidden,priority:r.priority||0,referencesCurrent:!!r.referencesCurrent,get query(){return i||(i=Lv(t)),i},ensureCustomProperties:r.ensureCustomProperties,getSelection:function(a,o,s){return ce(this,void 0,void 0,function(){var u,l;return de(this,function(c){switch(c.label){case 0:return u=a.managers.structure.selection.getStructure(s),l=u?mt.Sequence(s,[u]):mt.Empty(s),r.ensureCustomProperties?[4,r.ensureCustomProperties({runtime:o,assetManager:a.managers.asset},s)]:[3,2];case 1:c.sent(),c.label=2;case 2:return i||(i=Lv(t)),[2,i(new ps(s,{currentSelection:l}))]}})})}}}var IQe=$r("All",se.struct.generator.all(),{category:"",priority:1e3}),MQe=$r("Current Selection",se.internal.generator.current(),{category:"",referencesCurrent:!0}),DQe=$r("Polymer",se.struct.modifier.union([se.struct.generator.atomGroups({"entity-test":se.core.logic.and([se.core.rel.eq([se.ammp("entityType"),"polymer"]),se.core.str.match([se.re("(polypeptide|cyclic-pseudo-peptide|peptide-like|nucleotide|peptide nucleic acid)","i"),se.ammp("entitySubtype")])])})]),{category:qr.Type}),RQe=$r("Trace",se.struct.modifier.union([se.struct.combinator.merge([se.struct.modifier.union([se.struct.generator.atomGroups({"entity-test":se.core.rel.eq([se.ammp("entityType"),"polymer"]),"chain-test":se.core.set.has([se.set("sphere","gaussian"),se.ammp("objectPrimitive")])})]),se.struct.modifier.union([se.struct.generator.atomGroups({"entity-test":se.core.rel.eq([se.ammp("entityType"),"polymer"]),"chain-test":se.core.rel.eq([se.ammp("objectPrimitive"),"atomistic"]),"atom-test":se.core.set.has([se.set("CA","P"),se.ammp("label_atom_id")])})])])]),{category:qr.Structure}),Q0=se.core.logic.and([se.core.rel.eq([se.ammp("entityType"),"polymer"]),se.core.str.match([se.re("(polypeptide|cyclic-pseudo-peptide|peptide-like)","i"),se.ammp("entitySubtype")])]),bA=se.core.logic.and([se.core.rel.eq([se.ammp("entityType"),"polymer"]),se.core.str.match([se.re("(nucleotide|peptide nucleic acid)","i"),se.ammp("entitySubtype")])]),Uv=se.core.str.match([se.re("non-polymer|(amino|carboxy) terminus|peptide-like","i"),se.ammp("chemCompType")]),kQe=$r("Backbone",se.struct.modifier.union([se.struct.combinator.merge([se.struct.modifier.union([se.struct.generator.atomGroups({"entity-test":Q0,"chain-test":se.core.rel.eq([se.ammp("objectPrimitive"),"atomistic"]),"residue-test":se.core.logic.not([Uv]),"atom-test":se.core.set.has([se.set.apply(se,gi.toArray(pd)),se.ammp("label_atom_id")])})]),se.struct.modifier.union([se.struct.generator.atomGroups({"entity-test":bA,"chain-test":se.core.rel.eq([se.ammp("objectPrimitive"),"atomistic"]),"residue-test":se.core.logic.not([Uv]),"atom-test":se.core.set.has([se.set.apply(se,gi.toArray(HE)),se.ammp("label_atom_id")])})])])]),{category:qr.Structure}),OQe=$r("Sidechain",se.struct.modifier.union([se.struct.combinator.merge([se.struct.modifier.union([se.struct.generator.atomGroups({"entity-test":Q0,"chain-test":se.core.rel.eq([se.ammp("objectPrimitive"),"atomistic"]),"residue-test":se.core.logic.not([Uv]),"atom-test":se.core.logic.or([se.core.logic.not([se.core.set.has([se.set.apply(se,gi.toArray(pd)),se.ammp("label_atom_id")])])])})]),se.struct.modifier.union([se.struct.generator.atomGroups({"entity-test":bA,"chain-test":se.core.rel.eq([se.ammp("objectPrimitive"),"atomistic"]),"residue-test":se.core.logic.not([Uv]),"atom-test":se.core.logic.or([se.core.logic.not([se.core.set.has([se.set.apply(se,gi.toArray(HE)),se.ammp("label_atom_id")])])])})])])]),{category:qr.Structure}),FQe=$r("Sidechain with Trace",se.struct.modifier.union([se.struct.combinator.merge([se.struct.modifier.union([se.struct.generator.atomGroups({"entity-test":Q0,"chain-test":se.core.rel.eq([se.ammp("objectPrimitive"),"atomistic"]),"residue-test":se.core.logic.not([Uv]),"atom-test":se.core.logic.or([se.core.logic.not([se.core.set.has([se.set.apply(se,gi.toArray(pd)),se.ammp("label_atom_id")])]),se.core.rel.eq([se.ammp("label_atom_id"),"CA"]),se.core.logic.and([se.core.rel.eq([se.ammp("auth_comp_id"),"PRO"]),se.core.rel.eq([se.ammp("label_atom_id"),"N"])])])})]),se.struct.modifier.union([se.struct.generator.atomGroups({"entity-test":bA,"chain-test":se.core.rel.eq([se.ammp("objectPrimitive"),"atomistic"]),"residue-test":se.core.logic.not([Uv]),"atom-test":se.core.logic.or([se.core.logic.not([se.core.set.has([se.set.apply(se,gi.toArray(HE)),se.ammp("label_atom_id")])]),se.core.rel.eq([se.ammp("label_atom_id"),"P"])])})])])]),{category:qr.Structure}),LQe=$r("Protein",se.struct.modifier.union([se.struct.generator.atomGroups({"entity-test":Q0})]),{category:qr.Type}),NQe=$r("Nucleic",se.struct.modifier.union([se.struct.generator.atomGroups({"entity-test":bA})]),{category:qr.Type}),BQe=$r("Helix",se.struct.modifier.union([se.struct.generator.atomGroups({"entity-test":Q0,"residue-test":se.core.flags.hasAny([se.ammp("secondaryStructureFlags"),se.core.type.bitflags([2])])})]),{category:qr.Structure}),UQe=$r("Beta Strand/Sheet",se.struct.modifier.union([se.struct.generator.atomGroups({"entity-test":Q0,"residue-test":se.core.flags.hasAny([se.ammp("secondaryStructureFlags"),se.core.type.bitflags([4])])})]),{category:qr.Structure}),jQe=$r("Water",se.struct.modifier.union([se.struct.generator.atomGroups({"entity-test":se.core.rel.eq([se.ammp("entityType"),"water"])})]),{category:qr.Type}),zQe=$r("Ion",se.struct.modifier.union([se.struct.generator.atomGroups({"entity-test":se.core.rel.eq([se.ammp("entitySubtype"),"ion"])})]),{category:qr.Type}),VQe=$r("Lipid",se.struct.modifier.union([se.struct.generator.atomGroups({"entity-test":se.core.rel.eq([se.ammp("entitySubtype"),"lipid"])})]),{category:qr.Type}),xA=$r("Carbohydrate",se.struct.modifier.union([se.struct.generator.atomGroups({"entity-test":se.core.logic.or([se.core.rel.eq([se.ammp("entityType"),"branched"]),se.core.logic.and([se.core.rel.eq([se.ammp("entityType"),"non-polymer"]),se.core.str.match([se.re("oligosaccharide","i"),se.ammp("entitySubtype")])])])})]),{category:qr.Type}),tne=$r("Carbohydrate with Connected",se.struct.modifier.union([se.struct.modifier.includeConnected({0:xA.expression,"layer-count":1,"as-whole-residues":!0})]),{category:qr.Internal,isHidden:!0}),rne=$r("Connected to Carbohydrate",se.struct.modifier.union([se.struct.modifier.exceptBy({0:tne.expression,by:xA.expression})]),{category:qr.Internal,isHidden:!0}),DF=$r("Ligand",se.struct.modifier.union([se.struct.combinator.merge([se.struct.modifier.union([se.struct.generator.atomGroups({"entity-test":se.core.logic.and([se.core.logic.or([se.core.rel.eq([se.ammp("entityType"),"non-polymer"]),se.core.rel.neq([se.ammp("entityPrdId"),""])]),se.core.logic.not([se.core.str.match([se.re("(oligosaccharide|lipid|ion)","i"),se.ammp("entitySubtype")])])]),"chain-test":se.core.rel.eq([se.ammp("objectPrimitive"),"atomistic"]),"residue-test":se.core.logic.not([se.core.str.match([se.re("saccharide","i"),se.ammp("chemCompType")])])})]),se.struct.modifier.union([se.struct.generator.atomGroups({"entity-test":se.core.rel.eq([se.ammp("entityType"),"polymer"]),"chain-test":se.core.rel.eq([se.ammp("objectPrimitive"),"atomistic"]),"residue-test":Uv})])])]),{category:qr.Type}),nne=$r("Ligand with Connected",se.struct.modifier.union([se.struct.modifier.exceptBy({0:se.struct.modifier.union([se.struct.modifier.includeConnected({0:DF.expression,"layer-count":1,"as-whole-residues":!0,"bond-test":se.core.flags.hasAny([se.struct.bondProperty.flags(),se.core.type.bitflags([3])])})]),by:xA.expression})]),{category:qr.Internal,isHidden:!0}),ine=$r("Connected to Ligand",se.struct.modifier.union([se.struct.modifier.exceptBy({0:nne.expression,by:DF.expression})]),{category:qr.Internal,isHidden:!0}),HQe=$r("Connected to Ligand or Carbohydrate",se.struct.modifier.union([se.struct.combinator.merge([rne.expression,ine.expression])]),{category:qr.Internal,isHidden:!0}),GQe=$r("Disulfide Bridges",se.struct.modifier.union([se.struct.combinator.merge([se.struct.modifier.union([se.struct.modifier.wholeResidues([se.struct.filter.isConnectedTo({0:se.struct.generator.atomGroups({"residue-test":se.core.set.has([se.set("CYS"),se.ammp("auth_comp_id")]),"atom-test":se.core.set.has([se.set("SG"),se.ammp("label_atom_id")])}),target:se.struct.generator.atomGroups({"residue-test":se.core.set.has([se.set("CYS"),se.ammp("auth_comp_id")]),"atom-test":se.core.set.has([se.set("SG"),se.ammp("label_atom_id")])}),"bond-test":!0})])]),se.struct.modifier.union([se.struct.modifier.wholeResidues([se.struct.modifier.union([se.struct.generator.bondedAtomicPairs({0:se.core.flags.hasAny([se.struct.bondProperty.flags(),se.core.type.bitflags([8])])})])])])])]),{category:qr.Bond}),qQe=$r("NOS Bridges",se.struct.modifier.union([se.struct.modifier.wholeResidues([se.struct.filter.isConnectedTo({0:se.struct.generator.atomGroups({"residue-test":se.core.set.has([se.set("CSO","LYS"),se.ammp("auth_comp_id")]),"atom-test":se.core.set.has([se.set("OD","NZ"),se.ammp("label_atom_id")])}),target:se.struct.generator.atomGroups({"residue-test":se.core.set.has([se.set("CSO","LYS"),se.ammp("auth_comp_id")]),"atom-test":se.core.set.has([se.set("OD","NZ"),se.ammp("label_atom_id")])}),"bond-test":!0})])]),{category:qr.Bond}),$Qe=$r("Non-standard Residues in Polymers",se.struct.modifier.union([se.struct.generator.atomGroups({"entity-test":se.core.rel.eq([se.ammp("entityType"),"polymer"]),"chain-test":se.core.rel.eq([se.ammp("objectPrimitive"),"atomistic"]),"residue-test":se.ammp("isNonStandard")})]),{category:qr.Residue}),WQe=$r("Coarse Elements",se.struct.modifier.union([se.struct.generator.atomGroups({"chain-test":se.core.set.has([se.set("sphere","gaussian"),se.ammp("objectPrimitive")])})]),{category:qr.Type}),XQe=$r("Rings in Residues",se.struct.modifier.union([se.struct.generator.rings()]),{category:qr.Residue}),YQe=$r("Aromatic Rings in Residues",se.struct.modifier.union([se.struct.generator.rings({"only-aromatic":!0})]),{category:qr.Residue}),KQe=$r("Surrounding Residues (5 ) of Selection",se.struct.modifier.union([se.struct.modifier.exceptBy({0:se.struct.modifier.includeSurroundings({0:se.internal.generator.current(),radius:5,"as-whole-residues":!0}),by:se.internal.generator.current()})]),{description:"Select residues within 5  of the current selection.",category:qr.Manipulate,referencesCurrent:!0}),QQe=$r("Surrounding Ligands (5 ) of Selection",se.struct.modifier.union([se.struct.modifier.surroundingLigands({0:se.internal.generator.current(),radius:5,"include-water":!0})]),{description:"Select ligand components within 5  of the current selection.",category:qr.Manipulate,referencesCurrent:!0}),ZQe=$r("Inverse / Complement of Selection",se.struct.modifier.union([se.struct.modifier.exceptBy({0:se.struct.generator.all(),by:se.internal.generator.current()})]),{description:"Select everything not in the current selection.",category:qr.Manipulate,referencesCurrent:!0}),JQe=$r("Residues Covalently Bonded to Selection",se.struct.modifier.union([se.struct.modifier.includeConnected({0:se.internal.generator.current(),"layer-count":1,"as-whole-residues":!0})]),{description:"Select residues covalently bonded to current selection.",category:qr.Manipulate,referencesCurrent:!0}),eZe=$r("Covalently Bonded Component",se.struct.modifier.union([se.struct.modifier.includeConnected({0:se.internal.generator.current(),"fixed-point":!0})]),{description:"Select covalently bonded component based on current selection.",category:qr.Manipulate,referencesCurrent:!0}),tZe=$r("Residues with Cov. or Metallic Bond to Selection",se.struct.modifier.union([se.struct.modifier.includeConnected({0:se.internal.generator.current(),"layer-count":1,"as-whole-residues":!0,"bond-test":se.core.flags.hasAny([se.struct.bondProperty.flags(),se.core.type.bitflags([3])])})]),{description:"Select residues with covalent or metallic bond to current selection.",category:qr.Manipulate,referencesCurrent:!0}),rZe=$r("Whole Residues of Selection",se.struct.modifier.union([se.struct.modifier.wholeResidues({0:se.internal.generator.current()})]),{description:"Expand current selection to whole residues.",category:qr.Manipulate,referencesCurrent:!0}),nZe=[[["HIS"],"Histidine"],[["ARG"],"Arginine"],[["LYS"],"Lysine"],[["ILE"],"Isoleucine"],[["PHE"],"Phenylalanine"],[["LEU"],"Leucine"],[["TRP"],"Tryptophan"],[["ALA"],"Alanine"],[["MET"],"Methionine"],[["PRO"],"Proline"],[["CYS"],"Cysteine"],[["ASN"],"Asparagine"],[["VAL"],"Valine"],[["GLY"],"Glycine"],[["SER"],"Serine"],[["GLN"],"Glutamine"],[["TYR"],"Tyrosine"],[["ASP"],"Aspartic Acid"],[["GLU"],"Glutamic Acid"],[["THR"],"Threonine"],[["SEC"],"Selenocysteine"],[["PYL"],"Pyrrolysine"],[["UNK"],"Unknown"]].sort(function(e,t){return e[1]<t[1]?-1:e[1]>t[1]?1:0}),iZe=[[["A","DA"],"Adenosine"],[["C","DC"],"Cytidine"],[["T","DT"],"Thymidine"],[["G","DG"],"Guanosine"],[["I","DI"],"Inosine"],[["U","DU"],"Uridine"],[["N","DN"],"Unknown"]].sort(function(e,t){return e[1]<t[1]?-1:e[1]>t[1]?1:0});function _R(e,t,r){var n=e[0],i=e[1];r===void 0&&(r=0);var a=n.length===1&&!ane.has(n[0])?"["+n[0]+"] "+i:i+" ("+n.join(", ")+")";return $r(a,se.struct.modifier.union([se.struct.generator.atomGroups({"residue-test":se.core.set.has([se.set.apply(se,n),se.ammp("auth_comp_id")])})]),{category:t,priority:r,description:a})}function aZe(e,t,r){var n=e[0],i=e[1],a=i+" ("+n.join(", ")+")";return $r(a,se.struct.modifier.union([se.struct.generator.atomGroups({"atom-test":se.core.set.has([se.set.apply(se,n),se.acp("elementSymbol")])})]),{category:t,priority:r,description:a})}function oZe(e,t,r){var n=e[0],i=e[1],a=""+i;return $r(""+i,se.struct.modifier.union([se.struct.generator.atomGroups({"entity-test":se.core.list.equal([se.list.apply(se,n),se.ammp("entityDescription")])})]),{category:t,priority:r,description:a})}var ane=gi.unionMany(K6,$E,WE,GE);function sZe(e){for(var t=new Set,r=0,n=e;r<n.length;r++){var i=n[r];i.uniqueElementSymbols.forEach(function(o){return t.add(o)})}var a=[];return t.forEach(function(o){var s=gQe[o]||o;a.push(aZe([[o],s],"Element Symbol",0))}),a}function uZe(e){for(var t=new Map,r=new Set,n=0,i=e;n<i.length;n++){var a=i[n];a.uniqueResidueNames.forEach(function(d){return r.add(d)});for(var o=function(d){a.uniqueResidueNames.forEach(function(f){var h=d.properties.chemicalComponentMap.get(f);h&&t.set(f,h.name)})},s=0,u=a.models;s<u.length;s++){var l=u[s];o(l)}}var c=[];return gi.difference(r,ane).forEach(function(d){var f=t.get(d)||d;c.push(_R([[d],f],"Ligand/Non-standard Residue",200))}),c}function lZe(e){for(var t=new Map,r=Ze.create(),n=0,i=e;n<i.length;n++){var a=i[n];r.structure=a;for(var o=0,s=a.unitSymmetryGroups;o<s.length;o++){var u=s[o];r.unit=u.units[0],r.element=u.elements[0];var l=lt.entity.type(r);if(l==="polymer"||l==="branched"){var c=lt.entity.pdbx_description(r);t.set(c.join(", "),c)}}}var d=[];return t.forEach(function(f,h){d.push(oZe([f,h],"Polymer/Carbohydrate Entities",300))}),d}var bi={all:IQe,current:MQe,polymer:DQe,trace:RQe,backbone:kQe,sidechain:OQe,sidechainWithTrace:FQe,protein:LQe,nucleic:NQe,helix:BQe,beta:UQe,water:jQe,ion:zQe,lipid:VQe,branched:xA,branchedPlusConnected:tne,branchedConnectedOnly:rne,ligand:DF,ligandPlusConnected:nne,ligandConnectedOnly:ine,connectedOnly:HQe,disulfideBridges:GQe,nosBridges:qQe,nonStandardPolymer:$Qe,coarse:WQe,ring:XQe,aromaticRing:YQe,surroundings:KQe,surroundingLigands:QQe,complement:ZQe,covalentlyBonded:JQe,covalentlyOrMetallicBonded:tZe,covalentlyBondedComponent:eZe,wholeResidues:rZe},cZe=function(){function e(){var t,r;this.list=[],this.options=[],this.version=1,(t=this.list).push.apply(t,Nt(Nt(Nt([],Object.values(bi)),nZe.map(function(n){return _R(n,qr.AminoAcid)})),iZe.map(function(n){return _R(n,qr.NucleicBase)}))),(r=this.options).push.apply(r,this.list.map(function(n){return[n,n.label,n.category]}))}return e.prototype.add=function(t){this.list.push(t),this.options.push([t,t.label,t.category]),this.version+=1},e.prototype.remove=function(t){var r=this.list.indexOf(t);r!==-1&&(this.list.splice(r,1),this.options.splice(r,1),this.version+=1)},e}(),dZe=function(){function e(t,r){this.key=t,this.defaultValue=r}return e.prototype.toString=function(){return this.key},e.prototype.valueOf=function(){return this.key},e}();function li(e,t){return new dZe(e,t)}var Zr={item:li,General:{IsBusyTimeoutMs:li("plugin-config.is-busy-timeout",750),DisableAntialiasing:li("plugin-config.disable-antialiasing",!1),DisablePreserveDrawingBuffer:li("plugin-config.disable-preserve-drawing-buffer",!1),PixelScale:li("plugin-config.pixel-scale",1),PickScale:li("plugin-config.pick-scale",.25),EnableWboit:li("plugin-config.enable-wboit",!0)},State:{DefaultServer:li("plugin-state.server","https://webchem.ncbr.muni.cz/molstar-state"),CurrentServer:li("plugin-state.server","https://webchem.ncbr.muni.cz/molstar-state"),HistoryCapacity:li("history-capacity.server",5)},VolumeStreaming:{Enabled:li("volume-streaming.enabled",!0),DefaultServer:li("volume-streaming.server","https://ds.litemol.org"),CanStream:li("volume-streaming.can-stream",function(e,t){return e.models.length===1&&Xt.probablyHasDensityMap(e.models[0])}),EmdbHeaderServer:li("volume-streaming.emdb-header-server","https://ftp.wwpdb.org/pub/emdb/structures")},Viewport:{ShowExpand:li("viewer.show-expand-button",!0),ShowControls:li("viewer.show-controls-button",!0),ShowSettings:li("viewer.show-settings-button",!0),ShowSelectionMode:li("viewer.show-selection-model-button",!0),ShowAnimation:li("viewer.show-animation-button",!0)},Download:{DefaultPdbProvider:li("download.default-pdb-provider","pdbe"),DefaultEmdbProvider:li("download.default-emdb-provider","pdbe")},Structure:{SizeThresholds:li("structure.size-thresholds",We.DefaultSizeThresholds),DefaultRepresentationPresetParams:li("structure.default-representation-preset-params",{})}},fZe=function(){function e(t){var r=this;this._config=new Map,t&&t.forEach(function(n){var i=n[0],a=n[1];return r._config.set(i,a)})}return e.prototype.get=function(t){return this._config.has(t)?this._config.get(t):t.defaultValue},e.prototype.set=function(t,r){this._config.set(t,r)},e.prototype.delete=function(t){this._config.delete(t)},e}();function Bu(e,t,r,n){var i=0,a=t.webgl,o=new ai,s=qd(),u=[],l=Hi.create(),c,d,f,h,v=Si.createEmpty();function p(x,C){var w=this;return x===void 0&&(x={}),C&&C!==d&&(f=r(t,C),d=C,h||(h=I.getDefaultValues(f))),h=Object.assign({},h,x),$e.create("Creating or updating ComplexRepresentation",function(A){return ce(w,void 0,void 0,function(){var M,D,k;return de(this,function(R){switch(R.label){case 0:return M=!1,c?!((k=c.mustRecreate)===null||k===void 0)&&k.call(c,d,h,a)&&(c.destroy(),c=n(s,d,h,a),M=!0):(c=n(s,d,h,a),M=!0),D=c.createOrUpdate({webgl:a,runtime:A},v,h,C),D?[4,D]:[3,2];case 1:R.sent(),R.label=2;case 2:return M&&y(l),u.length=0,c&&c.renderObject&&u.push(c.renderObject),o.next(i++),[2]}})})})}function m(x){return x===void 0?We.Loci(d.target):c?c.getLoci(x):jr}function g(x,C){if(!d||!Lo.is(l.markerActions,C))return!1;if(We.isLoci(x)||Re.is(x)||Ht.isLoci(x)){if(!We.areRootsEquivalent(x.structure,d))return!1;x=sr.remap(x,d)}else if(!Ws(x)&&!W1(x))return!1;return sr.isEmpty(x)?!1:c?c.mark(x,C):!1}function y(x){if(Hi.update(l,x),x.visible!==void 0&&c&&c.setVisibility(x.visible&&(l.unitTransforms===null||l.unitTransforms.isIdentity)),x.alphaFactor!==void 0&&c&&c.setAlphaFactor(x.alphaFactor),x.pickable!==void 0&&c&&c.setPickable(x.pickable),x.overpaint!==void 0&&c){var C=Xi.remap(x.overpaint,d);c.setOverpaint(C)}if(x.transparency!==void 0&&c){var w=Yi.remap(x.transparency,d);c.setTransparency(w)}if(x.clipping!==void 0&&c){var A=ln.remap(x.clipping,d);c.setClipping(A)}x.transform!==void 0&&c&&c.setTransform(x.transform),x.unitTransforms!==void 0&&c&&c.setVisibility(l.visible&&(x.unitTransforms===null||x.unitTransforms.isIdentity))}function b(x){v=x}function S(){c&&c.destroy()}return{label:e,get groupCount(){return c?c.groupCount:0},get props(){return h},get params(){return f},get state(){return l},get theme(){return v},renderObjects:u,updated:o,createOrUpdate:p,setState:y,setTheme:b,getLoci:m,mark:g,destroy:S}}function one(e,t,r){var n=t.elements,i=t.model;if(Fe.indexOf(n,r)!==-1){for(var a=i.atomicHierarchy.residueAtomSegments,o=a.index,s=a.offsets,u=o[r],l=[],c=s[u],d=s[u+1];c<d;++c){var f=Fe.indexOf(n,c);f!==-1&&l.push(f)}var h=Fe.ofSortedArray(Je.ofSortedArray(l));return Re(e,[{unit:t,indices:h}])}return jr}function hZe(e,t,r){var n=t.elements,i=t.model,a=i.atomicHierarchy.atoms.label_alt_id,o=a.value(r);if(Fe.indexOf(n,r)!==-1){var s=i.atomicHierarchy.residueAtomSegments.index,u=s[r];return r2(e,t,u,o)}return Re(e,[])}function r2(e,t,r,n){for(var i=t.elements,a=t.model,o=a.atomicHierarchy.atoms.label_alt_id,s=a.atomicHierarchy.residueAtomSegments.offsets,u=[],l=s[r],c=s[r+1];l<c;++l){var d=Fe.indexOf(i,l);if(d!==-1){var f=o.value(l);(n===f||f==="")&&u.push(d)}}var h=Fe.ofSortedArray(Je.ofSortedArray(u));return Re(e,[{unit:t,indices:h}])}function sne(e,t,r){for(var n=e.structure.child,i=t&&n?e.group.units.filter(function(l){return n.unitMap.has(l.id)}):e.group.units,a=i.length,o=a*16,s=r&&r.aTransform.ref.value.length>=o?r.aTransform.ref.value:new Float32Array(o),u=0;u<a;u++)ue.toArray(i[u].conformation.operator.matrix,s,u*16);return G6(s,a,r)}var pZe={atomic:{},spheres:{},gaussians:{}},vZe=I.objectToOptions(pZe);function mZe(e,t){for(var r=0,n=e.length;r<n;++r)if(je.isAtomic(t)&&e[r]==="atomic"||je.isSpheres(t)&&e[r]==="spheres"||je.isGaussians(t)&&e[r]==="gaussians")return!0;return!1}var une=5e8;function lne(e,t,r){r===void 0&&(r=une);var n=Kt.size(_(),e);_.ceil(n,n),n.sort(function(s,u){return u-s});var i=Math.floor(Math.cbrt(r)*Math.cbrt(r)),a=n[0]*n[1],o=Math.ceil(a/(t*t));return{area:a,areaCells:o,maxAreaCells:i}}function am(e,t,r){r===void 0&&(r=une);var n=lne(e,t.resolution,r),i=n.area,a=n.areaCells,o=n.maxAreaCells,s=a>o?Math.sqrt(i/o):t.resolution;return E(E({},t),{resolution:s})}function gZe(e){switch(e.kind){case 0:return e.model.atomicConformation;case 1:return e.model.coarseConformation.spheres;case 2:return e.model.coarseConformation.gaussians}}var SA={ignoreHydrogens:I.Boolean(!1,{description:"Whether or not to include hydrogen atoms in the surface calculation."}),traceOnly:I.Boolean(!1,{description:"Whether or not to only use trace atoms in the surface calculation."}),includeParent:I.Boolean(!1,{description:"Include elements of the parent structure in surface calculation to get a surface patch of the current structure."})};I.getDefaultValues(SA);var yZe=_();function bZe(e,t,r,n){return _.squaredDistance(_.set(yZe,e,t,r),n)}function xZe(e,t,r){for(var n=0,i=t.length,a=0,o=r.length;a<o;++a){var s=Je.indexOfInRange(t,r[a],n,i);s===-1?e[a]=-2:(e[a]=s,n=s)}}function CA(e,t,r){var n=r.ignoreHydrogens,i=r.traceOnly,a=r.includeParent,o=a?e.root.unitMap.get(t.id):t,s=gZe(o),u=s.x,l=s.y,c=s.z,d=o.elements,f=t.boundary.sphere,h=f.center,v=f.radius,p=(2+1.5)*2,m=(v+p)*(v+p),g,y;if(n||i||a&&o!==t){for(var b=[],S=[],x=0,C=d.length;x<C;++x){var w=d[x];n&&Fw(o,w)||i&&!kF(o,w)||a&&bZe(u[w],l[w],c[w],h)>m||(b.push(w),S.push(x))}g=Je.ofSortedArray(b),y=S}else g=d,y=Js(new Int32Array(g.length));a&&o!==t&&xZe(y,t.elements,g);var A={indices:g,x:u,y:l,z:c,id:y},M=t===o?t.boundary:v0(A),D=Ze.create(e,o),k=k2({},{scale:1}),R=function(O){return D.element=O,k.size(D)};return{position:A,boundary:M,radius:R}}function RF(e,t,r){var n=Ze.create(e),i=k2({},{scale:1}),a,o,s,u,l;if(t||r){for(var c=[],d=[],f=[],h=[],v=[],p=0,m=0,g=e.units.length;p<g;++p){var y=e.units[p],b=y.elements,S=y.conformation,x=S.x,C=S.y,w=S.z;n.unit=y;for(var A=0,M=b.length;A<M;++A){var D=b[A];t&&Fw(y,D)||r&&!kF(y,D)||(c.push(x(D)),d.push(C(D)),f.push(w(D)),n.element=D,h.push(i.size(n)),v.push(m+A))}m+=b.length}a=c,o=d,s=f,u=h,l=v}else{for(var k=e.elementCount,c=new Float32Array(k),d=new Float32Array(k),f=new Float32Array(k),h=new Float32Array(k),p=0,m=0,g=e.units.length;p<g;++p){var y=e.units[p],b=y.elements,R=y.conformation,x=R.x,C=R.y,w=R.z;n.unit=y;for(var A=0,M=b.length;A<M;++A){var D=b[A],O=m+A;c[O]=x(D),d[O]=C(D),f[O]=w(D),n.element=D,h[O]=i.size(n)}m+=b.length}a=c,o=d,s=f,u=h,l=Js(new Uint32Array(k))}var H={indices:Fe.ofRange(0,l.length),x:a,y:o,z:s,id:l},B=function(j){return u[j]};return{position:H,radius:B}}var cne=VE.H;function Fw(e,t){return je.isCoarse(e)?!1:e.model.atomicHierarchy.derived.atom.atomicNumber[t]===cne}function Lw(e,t){return e[t]===cne}function kF(e,t){if(je.isCoarse(e))return!0;var r=e.model.atomicHierarchy.atoms.label_atom_id.value(t);return r==="CA"||r==="BB"||r==="P"}function Z0(e){if(je.isAtomic(e))return 4;for(var t=0,r=e.elements,n=e.conformation.r,i=0,a=r.length;i<a;i++){var o=n(r[i]);o>t&&(t=o)}return t+1}function _A(e){for(var t=0,r=0,n=e.unitSymmetryGroups;r<n.length;r++){var i=n[r],a=Z0(i.units[0]);a>t&&(t=a)}return t}function O2(e){return I.MultiSelect(e,vZe,{description:"For which kinds of units/chains to show the representation visuals."})}var No={unitKinds:O2(["atomic","spheres"]),includeParent:I.Boolean(!1,{isHidden:!0})},dne=E({},Lt.Params),SZe=E({},Oh.Params),fne=E({},as.Params),CZe=E({},Bv.Params),hne=E({},Pn.Params),pne=E({},eu.Params),vne=E({},uo.Params),mne=E({},Yu.Params);function _Ze(e,t,r,n,i,a){var o=ha.getUtils(t),s=o.createValues,u=o.createRenderableState,l=$6(),c=s(t,l,r,n,i),d=u(i);return Y0(t.kind,c,d,a)}function J0(e,t){var r=e.defaultProps,n=e.createGeometry,i=e.createLocationIterator,a=e.getLoci,o=e.eachLocation,s=e.setUpdateState,u=e.mustRecreate,l=e.processValues,c=e.dispose,d=e.geometryUtils,f=d.updateValues,h=d.updateBoundingSphere,v=d.updateRenderableState,p=d.createPositionIterator,m=rc.create(),g,y,b,S,x=Object.assign({},r),C=Si.createEmpty(),w,A,M,D;function k(j,Y,G){if(!G&&!w)throw new Error("missing structure");if(y=Object.assign({},x,Y),b=j,S=G,rc.reset(m),!g||!w){m.createNew=!0,m.createGeometry=!0;return}s(m,y,x,b,C,S,w),We.areEquivalent(S,w)||(m.createGeometry=!0),We.areHierarchiesEqual(S,w)||(m.updateTransform=!0,m.createGeometry=!0),yd.areEqual(j.color,C.color)||(m.updateColor=!0),ud(y.unitKinds,x.unitKinds)||(m.createGeometry=!0),w.child!==S.child&&(m.createGeometry=!0),m.updateSize&&!("uSize"in g.values)&&(m.createGeometry=!0),m.createGeometry&&(m.updateColor=!0,m.updateSize=!0)}function R(j){if(m.createNew)if(M=i(S),j)g=_Ze(S,j,M,b,y,t),D=p(j,g.values);else throw new Error("expected geometry to be given");else{if(!g)throw new Error("expected renderObject to be available");if(m.updateTransform){M=i(S);var Y=M.instanceCount,G=M.groupCount;au(Y*G,g.values)}if(m.createGeometry)if(j)L.updateIfChanged(g.values.drawCount,ha.getDrawCount(j)),L.updateIfChanged(g.values.uVertexCount,ha.getVertexCount(j));else throw new Error("expected geometry to be given");(m.updateTransform||m.createGeometry)&&(h(g.values,j||A),D=p(A,g.values)),m.updateSize&&"uSize"in g.values&&Fd(M,b.size,g.values),m.updateColor&&xs(M,D,b.color,g.values),f(g.values,y),v(g.state,y)}x=y,C=b,w=S,j&&(A=j)}function O(j){return!!(Ws(j)||We.isLoci(j)&&We.areRootsEquivalent(j.structure,w)||Re.is(j)&&We.areRootsEquivalent(j.structure,w)&&Re.isWholeStructure(j))}function H(j,Y,G){return O(j)?Y(Ie.ofBounds(0,M.groupCount*M.instanceCount)):o(j,w,Y,G)}function B(j){g&&(l==null||l(g.values,A,x,C,j.webgl))}return{get groupCount(){return M?M.count:0},get renderObject(){return M&&M.count?g:void 0},createOrUpdate:function(j,Y,G,$){if(G===void 0&&(G={}),k(Y,G,$||w),m.createGeometry){var q=n(j,S,b,y,A);if(wF(q))return q.then(function(ee){R(ee),B(j)});R(q)}else R();B(j)},getLoci:function(j){return g?a(j,w,g.id):jr},mark:function(j,Y){return Pr.mark(g,j,Y,H)},setVisibility:function(j){Pr.setVisibility(g,j)},setAlphaFactor:function(j){Pr.setAlphaFactor(g,j)},setPickable:function(j){Pr.setPickable(g,j)},setColorOnly:function(j){Pr.setColorOnly(g,j)},setTransform:function(j,Y){Pr.setTransform(g,j,Y)},setOverpaint:function(j){Pr.setOverpaint(g,j,H,!0)},setTransparency:function(j){Pr.setTransparency(g,j,H,!0)},setClipping:function(j){Pr.setClipping(g,j,H,!0)},destroy:function(){c==null||c(A),g&&(g.state.disposed=!0,g=void 0)},mustRecreate:u}}var F2=E(E({},dne),No);function om(e,t){return J0(E(E({},e),{setUpdateState:function(r,n,i,a,o,s,u){e.setUpdateState(r,n,i,a,o,s,u),Ji.areEqual(a.size,o.size)||(r.createGeometry=!0)},geometryUtils:Lt.Utils}),t)}var wZe=E(E({},fne),No);function EZe(e,t){return J0(E(E({},e),{setUpdateState:function(r,n,i,a,o,s,u){e.setUpdateState(r,n,i,a,o,s,u),Ji.areEqual(a.size,o.size)||(r.updateSize=!0)},geometryUtils:as.Utils}),t)}var AZe=E(E({},hne),No);function PZe(e,t){return J0(E(E({},e),{setUpdateState:function(r,n,i,a,o,s,u){e.setUpdateState(r,n,i,a,o,s,u),Ji.areEqual(a.size,o.size)||(r.updateSize=!0)},geometryUtils:Pn.Utils}),t)}var TZe=E(E({},pne),No);function IZe(e,t){return J0(E(E({},e),{setUpdateState:function(r,n,i,a,o,s,u){e.setUpdateState(r,n,i,a,o,s,u),Ji.areEqual(a.size,o.size)||(r.updateSize=!0),n.background!==i.background&&(r.createGeometry=!0),n.backgroundMargin!==i.backgroundMargin&&(r.createGeometry=!0),n.tether!==i.tether&&(r.createGeometry=!0),n.tetherLength!==i.tetherLength&&(r.createGeometry=!0),n.tetherBaseWidth!==i.tetherBaseWidth&&(r.createGeometry=!0),n.attachment!==i.attachment&&(r.createGeometry=!0),n.fontFamily!==i.fontFamily&&(r.createGeometry=!0),n.fontQuality!==i.fontQuality&&(r.createGeometry=!0),n.fontStyle!==i.fontStyle&&(r.createGeometry=!0),n.fontVariant!==i.fontVariant&&(r.createGeometry=!0),n.fontWeight!==i.fontWeight&&(r.createGeometry=!0)},geometryUtils:eu.Utils}),t)}var MZe=E(E({},vne),No);function DZe(e,t){return J0(E(E({},e),{setUpdateState:function(r,n,i,a,o,s,u){e.setUpdateState(r,n,i,a,o,s,u),Ji.areEqual(a.size,o.size)||(r.createGeometry=!0)},geometryUtils:uo.Utils}),t)}var RZe=E(E({},mne),No);function kZe(e,t){return J0(E(E({},e),{setUpdateState:function(r,n,i,a,o,s,u){e.setUpdateState(r,n,i,a,o,s,u),Ji.areEqual(a.size,o.size)||(r.createGeometry=!0)},geometryUtils:Yu.Utils}),t)}function si(e,t,r,n){var i=0,a=t.webgl,o=new ai,s=qd(),u=[],l=Hi.create(),c=new Map,d,f,h,v,p=Si.createEmpty();function m(w,A){var M=this;return w===void 0&&(w={}),A&&A!==d&&(h=r(t,A),v||(v=I.getDefaultValues(h))),v=Object.assign({},v,w),$e.create("Creating or updating UnitsRepresentation",function(D){return ce(M,void 0,void 0,function(){var B,$,G,q,k,B,$,O,G,q,q,R,G,q,B,$,O,G,q,q,H,B,j,Y,G,$,q,q,ee,fe,W;return de(this,function(X){switch(X.label){case 0:if(!(!d&&!A))return[3,1];throw new Error("missing structure");case 1:if(!(A&&!d))return[3,8];f=A.unitSymmetryGroups,B=0,X.label=2;case 2:return B<f.length?($=f[B],G=n(s,A,v,a),q=G.createOrUpdate({webgl:a,runtime:D},p,v,{group:$,structure:A}),q?[4,q]:[3,4]):[3,7];case 3:X.sent(),X.label=4;case 4:return b(G,$,l),c.set($.hashCode,{visual:G,group:$}),D.shouldUpdate?[4,D.update({message:"Creating or updating UnitsVisual",current:B,max:f.length})]:[3,6];case 5:X.sent(),X.label=6;case 6:return B++,[3,2];case 7:return[3,43];case 8:if(!(A&&(!We.areUnitIdsAndIndicesEqual(A,d)||A.child!==d.child)))return[3,22];f=A.unitSymmetryGroups,k=c,c=new Map,B=0,X.label=9;case 9:return B<f.length?($=f[B],O=k.get($.hashCode),O?(G=O.visual,!((ee=G.mustRecreate)===null||ee===void 0)&&ee.call(G,{group:$,structure:A},v,a)?(G.destroy(),G=n(s,A,v,a),q=G.createOrUpdate({webgl:a,runtime:D},p,v,{group:$,structure:A}),q?[4,q]:[3,11]):[3,12]):[3,15]):[3,21];case 10:X.sent(),X.label=11;case 11:return b(G,$,l),[3,14];case 12:return q=G.createOrUpdate({webgl:a,runtime:D},p,v,{group:$,structure:A}),q?[4,q]:[3,14];case 13:X.sent(),X.label=14;case 14:return c.set($.hashCode,{visual:G,group:$}),k.delete($.hashCode),G.renderObject&&(R=G.renderObject.values.tMarker.ref.value.array,Ku(R,Ie.ofBounds(0,R.length),nr.RemoveHighlight)),[3,18];case 15:return G=n(s,A,v,a),q=G.createOrUpdate({webgl:a,runtime:D},p,v,{group:$,structure:A}),q?[4,q]:[3,17];case 16:X.sent(),X.label=17;case 17:b(G,$,l),c.set($.hashCode,{visual:G,group:$}),X.label=18;case 18:return D.shouldUpdate?[4,D.update({message:"Creating or updating UnitsVisual",current:B,max:f.length})]:[3,20];case 19:X.sent(),X.label=20;case 20:return B++,[3,9];case 21:return k.forEach(function(U){var z=U.visual;z.destroy()}),[3,43];case 22:if(!(A&&A!==d&&We.areUnitIdsAndIndicesEqual(A,d)))return[3,34];f=A.unitSymmetryGroups,B=0,X.label=23;case 23:return B<f.length?($=f[B],O=c.get($.hashCode),O?(G=O.visual,!((fe=G.mustRecreate)===null||fe===void 0)&&fe.call(G,{group:$,structure:A},v,t.webgl)?(G.destroy(),G=n(s,A,v,t.webgl),O.visual=G,q=G.createOrUpdate({webgl:a,runtime:D},p,v,{group:$,structure:A}),q?[4,q]:[3,25]):[3,26]):[3,29]):[3,33];case 24:X.sent(),X.label=25;case 25:return b(G,$,l),[3,28];case 26:return q=G.createOrUpdate({webgl:a,runtime:D},p,v,{group:$,structure:A}),q?[4,q]:[3,28];case 27:X.sent(),X.label=28;case 28:return O.group=$,[3,30];case 29:throw new Error("expected to find visual for hashCode "+$.hashCode);case 30:return D.shouldUpdate?[4,D.update({message:"Creating or updating UnitsVisual",current:B,max:f.length})]:[3,32];case 31:X.sent(),X.label=32;case 32:return B++,[3,23];case 33:return[3,43];case 34:H=[],c.forEach(function(U){return H.push(U)}),B=0,j=H.length,X.label=35;case 35:return B<j?(Y=H[B],G=Y.visual,$=Y.group,!((W=G.mustRecreate)===null||W===void 0)&&W.call(G,{group:$,structure:d},v,t.webgl)?(G.destroy(),G=n(s,d,v,a),H[B].visual=G,q=G.createOrUpdate({webgl:a,runtime:D},p,v,{group:$,structure:d}),q?[4,q]:[3,37]):[3,38]):[3,43];case 36:X.sent(),X.label=37;case 37:return b(G,$,l),[3,40];case 38:return q=G.createOrUpdate({webgl:a,runtime:D},p,v),q?[4,q]:[3,40];case 39:X.sent(),X.label=40;case 40:return D.shouldUpdate?[4,D.update({message:"Creating or updating UnitsVisual",current:B,max:j})]:[3,42];case 41:X.sent(),X.label=42;case 42:return++B,[3,35];case 43:return u.length=0,c.forEach(function(U){var z=U.visual;z.renderObject&&u.push(z.renderObject)}),A&&(d=A),o.next(i++),[2]}})})})}function g(w){if(w===void 0)return We.Loci(d.target);var A=jr;return c.forEach(function(M){var D=M.visual,k=D.getLoci(w);Nu(k)||(A=k)}),A}function y(w,A){if(!d||!Lo.is(l.markerActions,A))return!1;if(We.isLoci(w)||Re.is(w)||Ht.isLoci(w)){if(!We.areRootsEquivalent(w.structure,d))return!1;w=sr.remap(w,d)}else if(!Ws(w)&&!W1(w))return!1;if(sr.isEmpty(w))return!1;var M=!1;return c.forEach(function(D){var k=D.visual;M=k.mark(w,A)||M}),M}function b(w,A,M){var D=M.visible,k=M.alphaFactor,R=M.pickable,O=M.overpaint,H=M.transparency,B=M.clipping,j=M.transform,Y=M.unitTransforms;D!==void 0&&w.setVisibility(D),k!==void 0&&w.setAlphaFactor(k),R!==void 0&&w.setPickable(R),O!==void 0&&w.setOverpaint(O),H!==void 0&&w.setTransparency(H),B!==void 0&&w.setClipping(B),j!==void 0&&w.setTransform(j),Y!==void 0&&(Y?w.setTransform(void 0,Y.getSymmetryGroupTransforms(A)):w.setTransform(void 0,null))}function S(w){var A=w.visible,M=w.alphaFactor,D=w.pickable,k=w.overpaint,R=w.transparency,O=w.clipping,H=w.transform,B=w.unitTransforms,j=w.syncManually,Y=w.markerActions,G={};A!==l.visible&&(G.visible=A),M!==l.alphaFactor&&(G.alphaFactor=M),D!==l.pickable&&(G.pickable=D),k!==void 0&&!Xi.areEqual(k,l.overpaint)&&d&&(G.overpaint=Xi.remap(k,d)),R!==void 0&&!Yi.areEqual(R,l.transparency)&&d&&(G.transparency=Yi.remap(R,d)),O!==void 0&&!ln.areEqual(O,l.clipping)&&d&&(G.clipping=ln.remap(O,d)),H!==void 0&&!ue.areEqual(H,l.transform,_n)&&(G.transform=H),(B!==l.unitTransforms||(B==null?void 0:B.version)!==w.unitTransformsVersion)&&(G.unitTransforms=B,l.unitTransformsVersion=B?B==null?void 0:B.version:-1),j!==l.syncManually&&(G.syncManually=j),Y!==l.markerActions&&(G.markerActions=Y),c.forEach(function($){var q=$.visual,ee=$.group;return b(q,ee,G)}),Hi.update(l,G)}function x(w){p=w}function C(){c.forEach(function(w){var A=w.visual;return A.destroy()}),c.clear()}return{label:e,get groupCount(){var w=0;return c.forEach(function(A){var M=A.visual;M.renderObject&&(w+=M.groupCount)}),w},get props(){return v},get params(){return h},get state(){return l},get theme(){return p},renderObjects:u,updated:o,createOrUpdate:m,setState:S,setTheme:x,getLoci:g,mark:y,destroy:C}}function OZe(e,t,r,n,i,a){var o=ha.getUtils(t),s=o.createValues,u=o.createRenderableState,l=sne(e,i.includeParent),c=s(t,l,r,n,i),d=u(i);return Y0(t.kind,c,d,a)}function sm(e,t){var r=e.defaultProps,n=e.createGeometry,i=e.createLocationIterator,a=e.getLoci,o=e.eachLocation,s=e.setUpdateState,u=e.mustRecreate,l=e.processValues,c=e.dispose,d=e.geometryUtils,f=d.createEmpty,h=d.updateValues,v=d.updateBoundingSphere,p=d.updateRenderableState,m=d.createPositionIterator,g=rc.create(),y,b=Object.assign({},r),S=Si.createEmpty(),x,C,w,A,M,D,k;function R(G,$,q){if(!q&&!A)throw new Error("missing structureGroup");if(b=$,S=G,x=q,rc.reset(g),!y||!A){g.createNew=!0,g.createGeometry=!0;return}s(g,b,C,S,w,x,A),We.areHierarchiesEqual(A.structure,x.structure)||(g.updateTransform=!0,g.updateColor=!0,g.updateSize=!0),yd.areEqual(S.color,w.color)||(g.updateColor=!0),A.structure.child!==x.structure.child&&(g.createGeometry=!0),ud(b.unitKinds,C.unitKinds)||(g.createGeometry=!0),x.group.transformHash!==A.group.transformHash&&(x.group.units.length!==A.group.units.length||g.updateColor?g.updateTransform=!0:g.updateMatrix=!0);var ee=x.group.units[0],fe=A.group.units[0];je.areOperatorsEqual(ee,fe)||(g.updateTransform=!0),je.areConformationsEqual(ee,fe)||(g.createGeometry=!0),g.updateTransform&&(g.updateMatrix=!0),g.updateSize&&!("uSize"in y.values)&&(g.createGeometry=!0),(g.createGeometry||g.updateTransform)&&(A.structure.hashCode!==x.structure.hashCode&&(g.updateColor=!0,g.updateSize=!0),(S.color.granularity.startsWith("vertex")||y.values.dColorType.ref.value.startsWith("vertex")||S.color.granularity.startsWith("volume")||y.values.dColorType.ref.value.startsWith("volume"))&&(g.updateColor=!0))}function O(G){if(g.createNew)if(D=i(x),G)y=OZe(x,G,D,S,b,t),k=m(G,y.values);else throw new Error("expected geometry to be given");else{if(!y)throw new Error("expected renderObject to be available");if(g.updateTransform){D=i(x);var $=D.instanceCount,q=D.groupCount;au($*q,y.values)}if(g.updateMatrix&&sne(x,b.includeParent,y.values),g.createGeometry)if(G)L.updateIfChanged(y.values.drawCount,ha.getDrawCount(G)),L.updateIfChanged(y.values.uVertexCount,ha.getVertexCount(G));else throw new Error("expected geometry to be given");(g.updateTransform||g.createGeometry)&&(v(y.values,G||M),k=m(G||M,y.values)),g.updateSize&&"uSize"in y.values&&Fd(D,S.size,y.values),g.updateColor&&xs(D,k,S.color,y.values),h(y.values,b),p(y.state,b)}C=b,w=S,A=x,G&&(M=G)}function H(G,$,q,ee,fe,W){return mZe(fe.unitKinds,$)?n(G,$,q,ee,fe,W):f(W)}function B(G){return!!(Ws(G)||We.isLoci(G)&&We.areRootsEquivalent(G.structure,A.structure)||Re.is(G)&&We.areRootsEquivalent(G.structure,A.structure)&&Re.isWholeStructure(G))}function j(G,$,q){return B(G)?$(Ie.ofBounds(0,D.groupCount*D.instanceCount)):o(G,A,$,q)}function Y(G){y&&(l==null||l(y.values,M,C,w,G.webgl))}return{get groupCount(){return D?D.count:0},get renderObject(){return D&&D.count?y:void 0},createOrUpdate:function(G,$,q,ee){if(R($,q,ee||A),g.createGeometry){var fe=H(G,x.group.units[0],x.structure,S,b,M);if(wF(fe))return fe.then(function(W){O(W),Y(G)});O(fe)}else O();Y(G)},getLoci:function(G){return y?a(G,A,y.id):jr},mark:function(G,$){return Pr.mark(y,G,$,j)},setVisibility:function(G){Pr.setVisibility(y,G)},setAlphaFactor:function(G){Pr.setAlphaFactor(y,G)},setPickable:function(G){Pr.setPickable(y,G)},setColorOnly:function(G){Pr.setColorOnly(y,G)},setTransform:function(G,$){Pr.setTransform(y,G,$)},setOverpaint:function(G){Pr.setOverpaint(y,G,j,!0)},setTransparency:function(G){Pr.setTransparency(y,G,j,!0)},setClipping:function(G){Pr.setClipping(y,G,j,!0)},destroy:function(){c==null||c(M),y&&(y.state.disposed=!0,y=void 0)},mustRecreate:u}}var Ia=E(E({},dne),No);function ho(e,t){return sm(E(E({},e),{setUpdateState:function(r,n,i,a,o,s,u){e.setUpdateState(r,n,i,a,o,s,u),Ji.areEqual(a.size,o.size)||(r.createGeometry=!0)},geometryUtils:Lt.Utils}),t)}var gne=E(E({},SZe),No);function yne(e,t){return sm(E(E({},e),{setUpdateState:function(r,n,i,a,o,s,u){e.setUpdateState(r,n,i,a,o,s,u),Ji.areEqual(a.size,o.size)||(r.updateSize=!0)},geometryUtils:Oh.Utils}),t)}var bne=E(E({},fne),No);function xne(e,t){return sm(E(E({},e),{setUpdateState:function(r,n,i,a,o,s,u){e.setUpdateState(r,n,i,a,o,s,u),Ji.areEqual(a.size,o.size)||(r.updateSize=!0)},geometryUtils:as.Utils}),t)}var FZe=E(E({},CZe),No);function LZe(e,t){return sm(E(E({},e),{setUpdateState:function(r,n,i,a,o,s,u){e.setUpdateState(r,n,i,a,o,s,u),Ji.areEqual(a.size,o.size)||(r.updateSize=!0)},geometryUtils:Bv.Utils}),t)}var OF=E(E({},hne),No);function FF(e,t){return sm(E(E({},e),{setUpdateState:function(r,n,i,a,o,s,u){e.setUpdateState(r,n,i,a,o,s,u),Ji.areEqual(a.size,o.size)||(r.updateSize=!0)},geometryUtils:Pn.Utils}),t)}E(E({},pne),No);var NZe=E(E({},vne),No);function BZe(e,t){return sm(E(E({},e),{setUpdateState:function(r,n,i,a,o,s,u){e.setUpdateState(r,n,i,a,o,s,u),Ji.areEqual(a.size,o.size)||(r.createGeometry=!0)},geometryUtils:uo.Utils}),t)}var UZe=E(E({},mne),No);function jZe(e,t){return sm(E(E({},e),{setUpdateState:function(r,n,i,a,o,s,u){e.setUpdateState(r,n,i,a,o,s,u),Ji.areEqual(a.size,o.size)||(r.createGeometry=!0)},geometryUtils:Yu.Utils}),t)}var Hi={create:function(){return E(E({},ur.createState()),{unitTransforms:null,unitTransformsVersion:-1})},update:function(e,t){ur.updateState(e,t),t.unitTransforms!==void 0&&(e.unitTransforms=t.unitTransforms)}};function Gr(e,t){return e.model.atomicHierarchy.atoms.type_symbol.value(e.elements[t])}function Sne(e,t){return e.model.atomicHierarchy.atoms.pdbx_formal_charge.value(e.elements[t])}function n2(e,t){return e.model.atomicHierarchy.atoms.label_atom_id.value(e.elements[t])}function Nw(e,t){return e.model.atomicHierarchy.atoms.label_alt_id.value(e.elements[t])}function LF(e,t){return e.model.atomicHierarchy.atoms.label_comp_id.value(e.elements[t])}function zZe(e,t,r){for(var n=0,i=e.interUnitBonds.getEdgeIndices(r,t.id),a=0,o=i.length;a<o;++a){var s=e.interUnitBonds.edges[i[a]];Hr.isCovalent(s.props.flag)&&(n+=1)}return n}function VZe(e,t){for(var r=0,n=e.bonds,i=n.offset,a=n.edgeProps.flags,o=i[t],s=i[t+1];o<s;++o)Hr.isCovalent(a[o])&&(r+=1);return r}function xd(e,t,r){return zZe(e,t,r)+VZe(t,r)}function oo(e,t,r,n){var i=0;return tu(e,t,r,function(a,o){Gr(a,o)===n&&(i+=1)}),i}function HZe(e,t,r){var n=e.bonds,i=n.offset,a=n.b,o=n.edgeProps.flags;Hr.is;for(var s=i[t],u=i[t+1];s<u;++s)if(a[s]===r&&Hr.isCovalent(o[s]))return!0;return!1}function GZe(e,t,r,n,i){var a=e.interUnitBonds.getEdge(r,t.id,i,n.id);return a&&Hr.isCovalent(a.props.flag)}function qZe(e,t,r,n,i){return t===n?HZe(t,r,i):GZe(e,t,r,n,i)}function $Ze(e,t,r,n){for(var i=e.interUnitBonds.getEdgeIndices(r,t.id),a=0,o=i.length;a<o;++a){var s=e.interUnitBonds.edges[i[a]],u=e.unitMap.get(s.unitB);Hr.isCovalent(s.props.flag)&&n(u,s.indexB)}}function WZe(e,t,r){for(var n=e.bonds,i=n.offset,a=n.b,o=n.edgeProps.flags,s=i[t],u=i[t+1];s<u;++s)Hr.isCovalent(o[s])&&r(e,a[s])}function tu(e,t,r,n){$Ze(e,t,r,n),WZe(t,r,n)}function XZe(e){switch(e){case 0:return"Spherical";case 1:return"Terminal";case 2:return"Linear";case 3:return"Trigonal";case 4:return"Tetrahedral";case 5:return"Trigonal Bi-Pyramidal";case 6:return"Octahedral";case 7:return"Square Planar";case 8:return"Unknown"}}function Lm(e){switch(e){case 0:return 0;case 1:return 1;case 2:return 2;case 3:return 3;case 4:return 4;default:return 8}}var iH=new Map([[2,Jr(180)],[3,Jr(120)],[4,Jr(109.4721)],[6,Jr(90)]]),Bw=_(),Uw=_(),Gp=_(),jw=_(),gg=_();function zw(e,t,r,n,i){var a=[];return t.conformation.position(t.elements[r],Gp),n.conformation.position(n.elements[i],jw),_.sub(Bw,jw,Gp),tu(e,t,r,function(o,s){Gr(o,s)!=="H"&&(o.conformation.position(o.elements[s],gg),_.sub(Uw,gg,Gp),a.push(_.angle(Bw,Uw)))}),a}function aH(e,t,r,n,i){t.conformation.position(t.elements[r],Gp),n.conformation.position(n.elements[i],jw),_.sub(Bw,jw,Gp);var a=[_(),_()],o=0,s,u;if(tu(e,t,r,function(l,c){o>1||Gr(l,c)!=="H"&&(s=l,u=c,l.conformation.position(l.elements[c],gg),_.sub(a[o++],gg,Gp))}),o===1&&s&&u&&tu(e,s,u,function(l,c){o>1||l===t&&c===r||Gr(l,c)!=="H"&&(l.conformation.position(l.elements[c],gg),_.sub(a[o++],gg,Gp))}),o===2)return _.cross(Uw,a[0],a[1]),Math.abs(Math.PI/2-_.angle(Uw,Bw))}var BT=new Ht.ElementBondIterator,UT=new Ht.ElementBondIterator;function YZe(e,t,r){var n=Gr(t,r),i=n==="O"||n==="N";if(i&&xd(e,t,r)===4)return!1;for(BT.setElement(e,t,r);BT.hasNext;){var a=BT.move();if(a.order>1)return!0;if(i){var o=Gr(a.otherUnit,a.otherIndex);for(UT.setElement(e,a.otherUnit,a.otherIndex);UT.hasNext;){var s=UT.move();if(s.order>1){if((o==="P"||o==="S")&&Gr(s.otherUnit,s.otherIndex)==="O")continue;return!0}}}}return!1}function KZe(e,t,r){for(var n=0,i=t.bonds,a=i.offset,o=i.edgeProps,s=o.flags,u=o.order,l=a[r],c=a[r+1];l<c;++l)Hr.isCovalent(s[l])&&(n+=u[l]);return e.interUnitBonds.getEdgeIndices(r,t.id).forEach(function(d){var f=e.interUnitBonds.edges[d];Hr.isCovalent(f.props.flag)&&(n+=f.props.order)}),n}var Nm=new Ht.ElementBondIterator,jT=new Ht.ElementBondIterator;function QZe(e,t,r,n){var i=oo(e,t,r,"H"),a=Gr(t,r),o=Sne(t,r),s=n.assignCharge==="always"||n.assignCharge==="auto"&&o===0,u=n.assignH==="always"||n.assignH==="auto"&&i===0,l=xd(e,t,r),c=KZe(e,t,r),d=YZe(e,t,r),f=c-l>0,h=0,v=8;switch(a){case"H":s&&(l===0?(o=1,v=0):l===1&&(o=0,v=1));break;case"C":s&&(o=0),u&&(h=Math.max(0,4-c-Math.abs(o))),v=Lm(l+h+Math.max(0,-o));break;case"N":if(s)if(!u)o=c-3;else if(d&&c<4)l-i===1&&c-i===2?o=1:o=0;else for(Nm.setElement(e,t,r);Nm.hasNext;){var p=Nm.move(),m=Gr(p.otherUnit,p.otherIndex);if(m==="S"||TQe(m)){o=0;break}else o=1}u&&(h=Math.max(0,3-c+o)),d&&!f?v=Lm(l+h-o):v=Lm(l+h+1-o);break;case"O":if(s&&(u||(o=c-2),c===1)){Nm.setElement(e,t,r);e:for(;Nm.hasNext;){var g=Nm.move();for(jT.setElement(e,g.otherUnit,g.otherIndex);jT.hasNext;){var y=jT.move();if(!(y.otherUnit===t&&y.otherIndex===r)&&Gr(y.otherUnit,y.otherIndex)==="O"&&y.order===2){o=-1;break e}}}}u&&(h=Math.max(0,2-c+o)),d&&!f?v=Lm(l+h-o+1):v=Lm(l+h-o+2);break;case"S":s&&(u||(c<=3&&oo(e,t,r,"O")===0?o=c-2:o=0)),u&&c<2&&(h=Math.max(0,2-c+o)),c<=3&&(v=Lm(l+h-o+2));break;case"F":case"CL":case"BR":case"I":case"AT":s&&(o=c-1);break;case"LI":case"NA":case"K":case"RB":case"CS":case"FR":s&&(o=1-c);break;case"BE":case"MG":case"CA":case"SR":case"BA":case"RA":s&&(o=2-c);break;default:Lr&&console.warn("Requested charge, protonation for an unhandled element",a)}return[o,h,h+i,v]}function ZZe(e,t,r){var n=t.elements.length,i=new Int8Array(n),a=new Int8Array(n),o=new Int8Array(n),s=new Int8Array(n),u=!!e.parent,l;if(u){var c=e.root.unitMap.get(t.id);if(l=Je.indicesOf(c.elements,t.elements),l.length!==t.elements.length)throw new Error("expected to find an index for every element");t=c,e=e.root}for(var d=0;d<n;++d){var f=u?l[d]:d,h=QZe(e,t,f,r),v=h[0],p=h[1],m=h[2],g=h[3];i[d]=v,a[d]=p,o[d]=m,s[d]=g}return{charge:i,implicitH:a,totalH:o,idealGeometry:s}}var Cne={assignCharge:I.Select("auto",[["always","always"],["auto","auto"],["never","never"]]),assignH:I.Select("auto",[["always","always"],["auto","auto"],["never","never"]])};function JZe(e,t,r){return ce(this,void 0,void 0,function(){var n,i,a,o,s,u;return de(this,function(l){for(n=E(E({},I.getDefaultValues(Cne)),r),i=new Map,a=0,o=t.units.length;a<o;++a)s=t.units[a],je.isAtomic(s)&&(u=ZZe(t,s,n),i.set(s.id,u));return[2,i]})})}var zT=E({},Cne),L2=Dh.createProvider({label:"Valence Model",descriptor:ko({name:"molstar_computed_valence_model"}),type:"local",defaultParams:zT,getParams:function(e){return zT},isApplicable:function(e){return!0},obtain:function(e,t,r){return ce(void 0,void 0,void 0,function(){var n,i;return de(this,function(a){switch(a.label){case 0:return n=E(E({},I.getDefaultValues(zT)),r),i={},[4,JZe(e.runtime,t,n)];case 1:return[2,(i.value=a.sent(),i)]}})})}}),Dn;(function(e){function t(d,f,h,v){return _.set(d,v.x[h],v.y[h],v.z[h]),_.transformMat4(d,d,f.conformation.operator.matrix),d}e.setPosition=t;function r(d,f){for(var h=new Int32Array(f+1),v=new Int32Array(f),p=new Int32Array(f),m=d.members,g=d.count,y=d.offsets,b=0,S=y[g];b<S;++b)++p[m[b]];for(var x=0,b=0;b<f;b++)h[b]=x,x+=p[b];h[f]=x;for(var C=new Int32Array(x),b=0;b<g;++b)for(var w=y[b],A=y[b+1];w<A;++w){var M=m[w],D=h[M]+v[M];C[D]=b,++v[M]}return{indices:C,offsets:h}}e.createElementsIndex=r;function n(d,f){var h,v;return E(E({},f),{get lookup3d(){if(!h){var p={x:f.x,y:f.y,z:f.z,indices:Fe.ofBounds(0,f.count)};h=Dv(p,v0(p))}return h},get elementsIndex(){return v||(v=r(f,d))},subset:function(p){return i(f,p)}})}e.create=n;function i(d,f){for(var h,v=d.count,p=d.types,m=[],g=0;g<v;++g)f.has(p[g])&&m.push(g);var y=Je.ofSortedArray(m);return{indices:y,get lookup3d(){if(!h){var b={x:d.x,y:d.y,z:d.z,indices:y};h=Dv(b,v0(b))}return h}}}e.createSubset=i;function a(d,f,h){var v=L2.get(d).value;if(!v||!v.has(f.id))throw new Error("valence model required");return{unit:f,types:h.types,feature:-1,x:h.x,y:h.y,z:h.z,members:h.members,offsets:h.offsets,idealGeometry:v.get(f.id).idealGeometry}}e.Info=a;function o(d,f){return _.set(d,f.x[f.feature],f.y[f.feature],f.z[f.feature]),_.transformMat4(d,d,f.unit.conformation.operator.matrix),d}e.position=o;var s=_(),u=_();function l(d,f){var h=d.members[d.offsets[d.feature]],v=f.members[f.offsets[f.feature]];return d.unit.conformation.position(d.unit.elements[h],s),f.unit.conformation.position(f.unit.elements[v],u),_.distance(s,u)}e.distance=l;function c(d,f){return{types:new Set(d),add:f}}e.Provider=c})(Dn||(Dn={}));var wR;(function(e){function t(r,n,i){r===void 0&&(r=2048),n===void 0&&(n=1024);var a=qe.create(Float32Array,1,n,i?i.x:r),o=qe.create(Float32Array,1,n,i?i.y:r),s=qe.create(Float32Array,1,n,i?i.z:r),u=qe.create(Uint8Array,1,n,i?i.types:r),l=qe.create(Uint8Array,1,n,i?i.groups:r),c=qe.create(Uint32Array,1,n,i?i.offsets:r),d=qe.create(Uint32Array,1,n,i?i.members:r),f={x:0,y:0,z:0,offset:0,count:0};return{startState:function(){f.x=0,f.y=0,f.z=0,f.offset=d.elementCount,f.count=0},pushMember:function(h,v,p,m){qe.add(d,m),f.x+=h,f.y+=v,f.z+=p,f.count+=1},finishState:function(h,v){var p=f.count;p!==0&&(qe.add(u,h),qe.add(l,v),qe.add(a,f.x/p),qe.add(o,f.y/p),qe.add(s,f.z/p),qe.add(c,f.offset))},add:function(h,v,p,m,g,y){qe.add(u,h),qe.add(l,v),qe.add(a,p),qe.add(o,m),qe.add(s,g),qe.add(c,d.elementCount),qe.add(d,y)},getFeatures:function(h){qe.add(c,d.elementCount);var v=qe.compact(a,!0),p=qe.compact(o,!0),m=qe.compact(s,!0),g=a.elementCount;return Dn.create(h,{x:v,y:p,z:m,count:g,types:qe.compact(u,!0),groups:qe.compact(l,!0),offsets:qe.compact(c,!0),members:qe.compact(d,!0)})}}}e.create=t})(wR||(wR={}));var ER;(function(e){function t(r,n,i){for(var a=new Int32Array(i+1),o=new Int32Array(i),s=new Int32Array(i),u=n.members,l=n.offsets,c=0,d=r.edgeCount*2;c<d;++c){var f=r.a[c],h=r.b[c];if(!(f>h)){for(var v=l[f],p=l[f+1];v<p;++v)++s[u[v]];for(var v=l[h],p=l[h+1];v<p;++v)++s[u[v]]}}for(var m=0,c=0;c<i;c++)a[c]=m,m+=s[c];a[i]=m;for(var g=new Int32Array(m),c=0,d=r.edgeCount*2;c<d;++c){var f=r.a[c],h=r.b[c];if(!(f>h)){for(var v=l[f],p=l[f+1];v<p;++v){var y=u[v],b=a[y]+o[y];g[b]=c,++o[y]}for(var v=l[h],p=l[h+1];v<p;++v){var y=u[v],b=a[y]+o[y];g[b]=c,++o[y]}}}return{indices:g,offsets:a}}e.createElementsIndex=t})(ER||(ER={}));var eJe=function(e){Le(t,e);function t(r,n){var i=e.call(this,r)||this,a=0,o=new Map,s=function(u,l){var c=i.getElementKey(u,l),d=o.get(c);d===void 0?o.set(c,[a]):d.push(a)};return i.map.forEach(function(u){u.forEach(function(l){var c=l.unitA,d=l.connectedIndices;d.forEach(function(f){for(var h=n.get(c),v=h.offsets,p=h.members,m=v[f],g=v[f+1];m<g;++m)s(p[m],c);a+=1})})}),i.elementKeyIndex=o,i}return t.prototype.getContactIndicesForElement=function(r,n){return this.elementKeyIndex.get(this.getElementKey(r,n.id))||[]},t.prototype.getElementKey=function(r,n){return r+"|"+n},t}(Rv);function oH(e){switch(e){case 4:return"Hydrogen Bond";case 6:return"Hydrophobic Contact";case 5:return"Halogen Bond";case 1:return"Ionic Interaction";case 7:return"Metal Coordination";case 2:return"Cation-Pi Interaction";case 3:return"Pi Stacking";case 8:return"Weak Hydrogen Bond";case 0:return"Unknown Interaction"}}function tJe(e){switch(e){case 0:return"None";case 1:return"Positive Charge";case 2:return"Negative Charge";case 3:return"Aromatic Ring";case 4:return"Hydrogen Donor";case 5:return"Hydrogen Acceptor";case 6:return"Halogen Donor";case 7:return"Halogen Acceptor";case 8:return"HydrophobicAtom";case 9:return"Weak Hydrogen Donor";case 10:return"Ionic Type Partner";case 11:return"Dative Bond Partner";case 12:return"Transition Metal";case 13:return"Ionic Type Metal"}}function rJe(e){switch(e){case 0:return"None";case 1:return"Quaternary Amine";case 2:return"Tertiary Amine";case 3:return"Sulfonium";case 4:return"Sulfonic Acid";case 5:return"Sulfate";case 6:return"Phosphate";case 7:return"Halocarbon";case 8:return"Guanidine";case 9:return"Acetamidine";case 10:return"Carboxylate"}}var AR;(function(e){function t(r,n){var i=[],a=[],o=[];return{add:function(s,u,l){i[i.length]=s,a[a.length]=u,o[o.length]=l},getContacts:function(){for(var s=new Oo.EdgeBuilder(r.count,i,a),u=new Int8Array(s.slotCount),l=new Int8Array(s.slotCount),c=0,d=s.edgeCount;c<d;c++)s.addNextEdge(),s.assignProperty(u,o[c]);var f=s.createGraph({type:u,flag:l}),h,v=Object.defineProperty(f,"elementsIndex",{get:function(){return h||(h=ER.createElementsIndex(f,r,n))}});return v}}}e.create=t})(AR||(AR={}));var PR;(function(e){function t(){var r=new Rv.Builder;return{startUnitPair:function(n,i){r.startUnitPair(n.id,i.id)},finishUnitPair:function(){r.finishUnitPair()},add:function(n,i,a){r.add(n,i,{type:a,flag:0})},getContacts:function(n){return new eJe(r.getMap(),n)}}}e.create=t})(PR||(PR={}));var nJe={lineOfSightDistFactor:I.Numeric(1,{min:0,max:3,step:.1})},iJe=3;function _ne(e,t,r){var n=t.members[t.offsets[t.feature]],i=r.members[r.offsets[r.feature]];if(n===i&&t.unit===r.unit)return!1;var a=Nw(t.unit,n),o=Nw(r.unit,i);return!(a&&o&&a!==o||t.unit.residueIndex[t.unit.elements[n]]===r.unit.residueIndex[r.unit.elements[i]]&&t.unit===r.unit||qZe(e,t.unit,n,r.unit,i))}function sH(e,t,r,n){var i=Nw(e,t),a=Nw(r,n);return i&&a&&i!==a}function uH(e,t){for(var r=t.feature,n=t.offsets,i=t.members,a=n[r],o=n[r+1];a<o;++a)if(i[a]===e)return!0;return!1}var sf=_(),VT=_(),HT=_(),aJe=fee();function wne(e,t,r,n){var i=t.feature,a=r.feature,o=t.members[t.offsets[i]],s=r.members[r.offsets[a]];Dn.position(VT,t),Dn.position(HT,r),_.scale(sf,_.add(sf,VT,HT),.5);var u=n*iJe,l=e.lookup3d.find(sf[0],sf[1],sf[2],u,aJe),c=l.count,d=l.indices,f=l.units,h=l.squaredDistances;if(c===0)return!0;for(var v=0;v<c;++v){var p=d[v],m=f[v];if(je.isAtomic(m)){var g=Gr(m,p);if(g!=="H"){var y=A2(g);if(!(y*y*n*n<=h[v])&&!(sH(m,p,t.unit,o)||sH(m,p,r.unit,s))&&!(t.unit===m&&uH(p,t)||r.unit===m&&uH(p,r))&&(m.conformation.position(m.elements[p],sf),!(_.squaredDistance(sf,VT)<1||_.squaredDistance(sf,HT)<1)))return!1}}}return!0}function oJe(e,t,r,n,i,a){for(var o=0,s=i;o<s.length;o++){var u=s[o];sJe(e,t,r,n,u,a)}}function sJe(e,t,r,n,i,a){for(var o=r.x,s=r.y,u=r.z,l=r.subset(i.requiredFeatures),c=l.lookup3d,d=l.indices,f=Dn.Info(e,t,r),h=E({},f),v=a.lineOfSightDistFactor,p=0,m=Fe.size(d);p<m;++p){var g=Fe.getAt(d,p),y=c.find(o[g],s[g],u[g],i.maxDistance),b=y.count,S=y.indices,x=y.squaredDistances;if(b!==0){f.feature=g;for(var C=0;C<b;++C){var w=Fe.getAt(d,S[C]);if(!(w<=g)&&(h.feature=w,!!_ne(e,f,h))){var A=i.getType(e,f,h,x[C]);A&&wne(e,f,h,v)&&n.add(g,w,A)}}}}}var uJe=ue();function lJe(e,t,r,n,i,a,o,s){var u=r.count,l=r.x,c=r.y,d=r.z,f=i.lookup3d,h=ue.mul(uJe,n.conformation.operator.inverse,t.conformation.operator.matrix),v=!ue.isIdentity(h),p=_(),m=Math.max.apply(Math,o.map(function(q){return q.maxDistance})),g=f.boundary.sphere,y=g.center,b=g.radius,S=(b+m)*(b+m),x=s.lineOfSightDistFactor,C=Dn.Info(e,t,r),w=Dn.Info(e,n,i);a.startUnitPair(t,n);for(var A=0;A<u;++A)if(_.set(p,l[A],c[A],d[A]),v&&_.transformMat4(p,p,h),!(_.squaredDistance(p,y)>S)){var M=f.find(p[0],p[1],p[2],m),D=M.indices,k=M.count,R=M.squaredDistances;if(k!==0){C.feature=A;for(var O=0;O<k;++O){var H=D[O];if(w.feature=H,!!_ne(e,C,w))for(var B=R[O],j=0,Y=o;j<Y.length;j++){var G=Y[j];if(B<G.maxDistance*G.maxDistance){var $=G.getType(e,C,w,B);if($&&wne(e,C,w,x)){a.add(A,H,$);break}}}}}}a.finishUnitPair()}var cJe={distanceMax:I.Numeric(4,{min:1,max:5,step:.1}),angleMax:I.Numeric(30,{min:0,max:60,step:1})},dJe=["CL","BR","I","AT"];function fJe(e,t,r){for(var n=t.elements,i=t.model.atomicConformation,a=i.x,o=i.y,s=i.z,u=0,l=n.length;u<l;++u){var c=Gr(t,u);dJe.includes(c)&&r.add(6,0,a[n[u]],o[n[u]],s[n[u]],u)}}var hJe=["N","O","S"],pJe=["C","N","P","S"];function vJe(e,t,r){for(var n=t.elements,i=t.model.atomicConformation,a=i.x,o=i.y,s=i.z,u=function(d,f){var h=Gr(t,d);if(hJe.includes(h)){var v=!1;tu(e,t,d,function(p,m){pJe.includes(Gr(p,m))&&(v=!0)}),v&&r.add(7,0,a[n[d]],o[n[d]],s[n[d]],d)}},l=0,c=n.length;l<c;++l)u(l)}function mJe(e,t){return e===7&&t===6||e===6&&t===7}var gJe=Jr(180),yJe=Jr(120);function bJe(e){return{angleMax:Jr(e.angleMax)}}function xJe(e,t,r,n){var i=t.types[t.feature],a=r.types[r.feature];if(mJe(i,a)){var o=i===6?[t,r]:[r,t],s=o[0],u=o[1],l=s.members[s.offsets[s.feature]],c=u.members[u.offsets[u.feature]],d=zw(e,s.unit,l,u.unit,c);if(d.length===1&&!(gJe-d[0]>n.angleMax)){var f=zw(e,u.unit,c,s.unit,l);if(f.length!==0&&!f.some(function(h){return yJe-h>n.angleMax}))return 5}}}var SJe=Dn.Provider([6],fJe),CJe=Dn.Provider([7],vJe),_Je={name:"halogen-bonds",params:cJe,createTester:function(e){var t=bJe(e);return{maxDistance:e.distanceMax,requiredFeatures:new Set([6,7]),getType:function(r,n,i){return xJe(r,n,i,t)}}}},Ene={distanceMax:I.Numeric(3.5,{min:1,max:5,step:.1}),backbone:I.Boolean(!0,{description:"Include backbone-to-backbone hydrogen bonds"}),accAngleDevMax:I.Numeric(45,{min:0,max:180,step:1},{description:"Max deviation from ideal acceptor angle"}),donAngleDevMax:I.Numeric(45,{min:0,max:180,step:1},{description:"Max deviation from ideal donor angle"}),accOutOfPlaneAngleMax:I.Numeric(90,{min:0,max:180,step:1}),donOutOfPlaneAngleMax:I.Numeric(45,{min:0,max:180,step:1})},wJe=E(E({},Ene),{water:I.Boolean(!1,{description:"Include water-to-water hydrogen bonds"}),sulfurDistanceMax:I.Numeric(4.1,{min:1,max:5,step:.1})}),EJe=E({},Ene);function NF(e,t){var r=L2.get(e).value;if(!r)throw Error("expected valence model to be available");var n=r.get(t.id);if(!n)throw Error("expected valence model for unit to be available");return n}function AJe(e,t,r){for(var n=NF(e,t).totalH,i=t.elements,a=t.model.atomicConformation,o=a.x,s=a.y,u=a.z,l=t.rings.elementAromaticRingIndices,c=0,d=i.length;c<d;++c)if(!l.has(c)){var f=Gr(t,c);(Ane(t,c)||n[c]>0&&(f==="N"||f==="O"||f==="S"))&&r.add(4,0,o[i[c]],s[i[c]],u[i[c]],c)}}function PJe(e,t,r){for(var n=NF(e,t).totalH,i=t.elements,a=t.model.atomicConformation,o=a.x,s=a.y,u=a.z,l=0,c=i.length;l<c;++l)Gr(t,l)==="C"&&n[l]>0&&(oo(e,t,l,"N")>0||oo(e,t,l,"O")>0||TJe(t,l))&&r.add(9,0,o[i[l]],s[i[l]],u[i[l]],l)}function TJe(e,t){var r=e.rings,n=r.elementAromaticRingIndices,i=r.all,a=n.get(t);if(a===void 0)return!1;for(var o=0,s=a.length;o<s;++o)for(var u=i[a[o]],l=0,c=u.length;l<c;++l){var d=Gr(e,u[l]);if(d==="N"||d==="O")return!0}return!1}function IJe(e,t,r){for(var n=NF(e,t),i=n.charge,a=n.implicitH,o=n.idealGeometry,s=t.elements,u=t.model.atomicConformation,l=u.x,c=u.y,d=u.z,f=t.rings.elementAromaticRingIndices,h=function(S){r.add(5,0,l[s[S]],c[s[S]],d[s[S]],S)},v=0,p=s.length;v<p;++v)if(!f.has(v)){var m=Gr(t,v);if(m==="O")h(v);else if(m==="N"){if(Ane(t,v))h(v);else if(i[v]<1){var g=xd(e,t,v)+a[v],y=o[v];(y===4&&g<4||y===3&&g<3||y===2&&g<2)&&h(v)}}else if(m==="S"){var b=LF(t,v);(b==="CYS"||b==="MET"||Sne(t,v)===-1)&&h(v)}}}function lH(e,t){return e.model.atomicHierarchy.derived.residue.moleculeType[e.residueIndex[e.elements[t]]]===2}function cH(e,t){return pd.has(n2(e,t))}function MJe(e,t){return e.rings.elementRingIndices.has(t)}function Ane(e,t){return LF(e,t)==="HIS"&&Gr(e,t)==="N"&&MJe(e,t)}function DJe(e,t,r,n){return cH(e,t)&&cH(r,n)}function RJe(e,t,r,n){return lH(e,t)&&lH(r,n)}function kJe(e,t){return e===5&&t===4||e===4&&t===5}function OJe(e,t){return e===9&&t===5||e===5&&t===9}function Pne(e){return{includeBackbone:e.backbone,maxAccAngleDev:Jr(e.accAngleDevMax),maxDonAngleDev:Jr(e.donAngleDevMax),maxAccOutOfPlaneAngle:Jr(e.accOutOfPlaneAngleMax),maxDonOutOfPlaneAngle:Jr(e.donOutOfPlaneAngleMax)}}function FJe(e){return E(E({},Pne(e)),{includeWater:e.water,maxSulfurDistSq:e.sulfurDistanceMax*e.sulfurDistanceMax,maxDistSq:e.distanceMax*e.distanceMax})}var dH=Jr(120);function Tne(e,t,r,n){var i=t.members[t.offsets[t.feature]],a=r.members[r.offsets[r.feature]];if(!(!n.includeBackbone&&DJe(t.unit,i,r.unit,a))){var o=zw(e,t.unit,i,r.unit,a),s=iH.get(t.idealGeometry[i])||dH;if(!o.some(function(d){return Math.abs(s-d)>n.maxDonAngleDev})){if(t.idealGeometry[i]===3){var u=aH(e,t.unit,i,r.unit,a);if(u!==void 0&&u>n.maxDonOutOfPlaneAngle)return}var l=zw(e,r.unit,a,t.unit,i),c=iH.get(r.idealGeometry[a])||dH;if(!l.some(function(d){return c-d>n.maxAccAngleDev})){if(r.idealGeometry[a]===3){var u=aH(e,r.unit,a,t.unit,i);if(u!==void 0&&u>n.maxAccOutOfPlaneAngle)return}return!0}}}}function LJe(e,t,r,n,i){var a=t.types[t.feature],o=r.types[r.feature];if(kJe(a,o)){var s=o===5?[t,r]:[r,t],u=s[0],l=s[1],c=u.members[u.offsets[u.feature]],d=l.members[l.offsets[l.feature]],f=Gr(u.unit,c)==="S"||Gr(l.unit,d)==="S"?i.maxSulfurDistSq:i.maxDistSq;if(!(n>f)&&!(!i.includeWater&&RJe(u.unit,c,l.unit,d))&&Tne(e,u,l,i))return 4}}function NJe(e,t,r,n,i){var a=t.types[t.feature],o=r.types[r.feature];if(OJe(a,o)){var s=o===5?[t,r]:[r,t],u=s[0],l=s[1];if(Tne(e,u,l,i))return 8}}var BJe=Dn.Provider([4],AJe),UJe=Dn.Provider([9],PJe),jJe=Dn.Provider([5],IJe),zJe={name:"hydrogen-bonds",params:wJe,createTester:function(e){var t=Math.max(e.distanceMax,e.sulfurDistanceMax),r=FJe(e);return{maxDistance:t,requiredFeatures:new Set([4,5]),getType:function(n,i,a,o){return LJe(n,i,a,o,r)}}}},VJe={name:"weak-hydrogen-bonds",params:EJe,createTester:function(e){var t=Pne(e);return{maxDistance:e.distanceMax,requiredFeatures:new Set([9,5]),getType:function(r,n,i,a){return NJe(r,n,i,a,t)}}}};function HJe(e,t,r){return Gr(t,r)==="S"&&oo(e,t,r,"O")===3}function GJe(e,t,r){return Gr(t,r)==="S"&&oo(e,t,r,"O")===4}function fH(e,t,r){return Gr(t,r)==="P"&&oo(e,t,r,"O")===xd(e,t,r)}function qJe(e,t,r){var n=0;return Gr(t,r)==="C"&&oo(e,t,r,"O")===2&&oo(e,t,r,"C")===1&&tu(e,t,r,function(i,a){Gr(i,a)==="O"&&xd(e,i,a)-oo(e,i,a,"H")===1&&(n+=1)}),n===2}function $Je(e,t,r){var n=0;return Gr(t,r)==="C"&&xd(e,t,r)===3&&oo(e,t,r,"N")===3&&tu(e,t,r,function(i,a){xd(e,i,a)-oo(e,i,a,"H")===1&&(n+=1)}),n===2}function WJe(e,t,r){var n=0;return Gr(t,r)==="C"&&xd(e,t,r)===3&&oo(e,t,r,"N")===2&&oo(e,t,r,"C")===1&&tu(e,t,r,function(i,a){xd(e,i,a)-oo(e,i,a,"H")===1&&(n+=1)}),n===2}var XJe={distanceMax:I.Numeric(5,{min:0,max:8,step:.1})},YJe={distanceMax:I.Numeric(5.5,{min:1,max:8,step:.1}),offsetMax:I.Numeric(2,{min:0,max:4,step:.1}),angleDevMax:I.Numeric(30,{min:0,max:180,step:1})},KJe={distanceMax:I.Numeric(6,{min:1,max:8,step:.1}),offsetMax:I.Numeric(2,{min:0,max:4,step:.1})},QJe=["ARG","HIS","LYS"],ZJe=["GLU","ASP"];function Ine(e,t){var r=L2.get(e).value;if(!r)throw Error("expected valence model to be available");var n=r.get(t.id);if(!n)throw Error("expected valence model for unit to be available");return n}function JJe(e,t,r){for(var n=Ine(e,t).charge,i=t.elements,a=t.model.atomicConformation,o=a.x,s=a.y,u=a.z,l=new Set,c=t.model.atomicHierarchy.atoms.label_comp_id,d=ar.transientSegments(t.model.atomicHierarchy.residueAtomSegments,i);d.hasNext;){var f=d.move(),h=f.index,v=f.start,p=f.end,m=c.value(t.model.atomicHierarchy.residueAtomSegments.offsets[h]);if(QJe.includes(m)){r.startState();for(var g=v;g<p;++g)Gr(t,g)==="N"&&!pd.has(n2(t,g))&&r.pushMember(o[i[g]],s[i[g]],u[i[g]],g);r.finishState(1,0)}else if(!T2.has(m)){l.clear();for(var g=v;g<p;++g){var y=0;$Je(e,t,g)?y=8:WJe(e,t,g)&&(y=9),y&&(r.startState(),tu(e,t,g,function(S,x){Gr(t,x)==="N"&&(l.add(x),r.pushMember(o[i[x]],s[i[x]],u[i[x]],x))}),r.finishState(1,y))}for(var g=v;g<p;++g)n[g]>0&&!l.has(g)&&r.add(1,0,o[i[g]],s[i[g]],u[i[g]],g)}}}function eet(e,t,r){for(var n=Ine(e,t).charge,i=t.elements,a=t.model.atomicConformation,o=a.x,s=a.y,u=a.z,l=new Set,c=t.model.atomicHierarchy.atoms.label_comp_id,d=ar.transientSegments(t.model.atomicHierarchy.residueAtomSegments,i);d.hasNext;){var f=d.move(),h=f.index,v=f.start,p=f.end,m=c.value(t.model.atomicHierarchy.residueAtomSegments.offsets[h]);if(ZJe.includes(m)){r.startState();for(var g=v;g<p;++g)Gr(t,g)==="O"&&!pd.has(n2(t,g))&&r.pushMember(o[i[g]],s[i[g]],u[i[g]],g);r.finishState(2,0)}else if(XE.has(m))for(var g=v;g<p;++g)fH(e,t,g)&&(r.startState(),tu(e,t,g,function(S,x){Gr(t,x)==="O"&&r.pushMember(o[i[x]],s[i[x]],u[i[x]],x)}),r.finishState(2,6));else if(!T2.has(m)){for(var g=v;g<p;++g){r.startState(),Gr(t,g)==="N"&&!pd.has(n2(t,g))&&r.pushMember(o[i[g]],s[i[g]],u[i[g]],g),r.finishState(2,0);var y=0;HJe(e,t,g)?y=4:fH(e,t,g)?y=6:GJe(e,t,g)?y=5:qJe(e,t,g)&&(y=10),y&&(r.startState(),tu(e,t,g,function(S,x){Gr(t,x)==="O"&&(l.add(x),r.pushMember(o[i[x]],s[i[x]],u[i[x]],x))}),r.finishState(2,y))}for(var g=v;g<p;++g)n[g]<0&&!l.has(g)&&r.add(2,0,o[i[g]],s[i[g]],u[i[g]],g)}}}function tet(e,t,r){for(var n=t.elements,i=t.model.atomicConformation,a=i.x,o=i.y,s=i.z,u=0,l=t.rings.aromaticRings;u<l.length;u++){var c=l[u],d=t.rings.all[c];r.startState();for(var f=0,h=d.length;f<h;++f){var v=d[f];r.pushMember(a[n[v]],o[n[v]],s[n[v]],v)}r.finishState(3,0)}}function ret(e,t){return e===2&&t===1||e===1&&t===2}function net(e,t){return e===3&&t===3}function iet(e,t){return e===3&&t===1||e===1&&t===3}var hH=_(),pH=_();function aet(e,t,r){for(var n=e.feature,i=e.offsets,a=e.members,o=t.feature,s=t.offsets,u=t.members,l=i[n],c=i[n+1];l<c;++l){var d=a[l];e.unit.conformation.position(e.unit.elements[d],hH);for(var f=s[o],h=s[o+1];f<h;++f){var v=u[f];if(t.unit.conformation.position(t.unit.elements[v],pH),_.squaredDistance(hH,pH)<r)return!0}}return!1}var Vw=_(),yg=_(),Hw=_(),fS=_();function TR(e,t){var r=t.unit,n=t.feature,i=t.offsets,a=t.members,o=r.elements,s=i[n];return t.unit.conformation.position(o[a[s]],Vw),t.unit.conformation.position(o[a[s+1]],yg),t.unit.conformation.position(o[a[s+2]],Hw),_.triangleNormal(e,Vw,yg,Hw)}var IR=function(e,t,r){return Dn.position(Vw,e),Dn.position(yg,t),_.sub(Hw,Vw,yg),_.projectOnPlane(fS,Hw,r),_.add(fS,fS,yg),_.distance(fS,yg)};function oet(e){return{distanceMaxSq:e.distanceMax*e.distanceMax}}function set(e){return{offsetMax:e.offsetMax,angleDevMax:Jr(e.angleDevMax)}}function uet(e){return{offsetMax:e.offsetMax}}var cet=Jr(180),vH=Jr(90),X1=_(),GT=_();function det(e,t,r,n,i){var a=t.types[t.feature],o=r.types[r.feature];if(ret(a,o)&&aet(t,r,i.distanceMaxSq))return 1}function fet(e,t,r,n,i){var a=t.types[t.feature],o=r.types[r.feature];if(net(a,o)){TR(X1,t),TR(GT,r);var s=_.angle(X1,GT),u=Math.min(IR(t,r,GT),IR(r,t,X1));if(u<=i.offsetMax){if(s<=i.angleDevMax||s>=cet-i.angleDevMax)return 3;if(s<=i.angleDevMax+vH&&s>=vH-i.angleDevMax)return 3}}}function het(e,t,r,n,i){var a=t.types[t.feature],o=r.types[r.feature];if(iet(a,o)){var s=a===3?[t,r]:[r,t],u=s[0],l=s[1];TR(X1,u);var c=IR(l,u,X1);if(c<=i.offsetMax)return 2}}var pet=Dn.Provider([2],eet),vet=Dn.Provider([1],JJe),met=Dn.Provider([3],tet),get={name:"ionic",params:XJe,createTester:function(e){var t=oet(e);return{maxDistance:e.distanceMax,requiredFeatures:new Set([2,1]),getType:function(r,n,i,a){return det(r,n,i,a,t)}}}},yet={name:"pi-stacking",params:YJe,createTester:function(e){var t=set(e);return{maxDistance:e.distanceMax,requiredFeatures:new Set([3]),getType:function(r,n,i,a){return fet(r,n,i,a,t)}}}},bet={name:"cation-pi",params:KJe,createTester:function(e){var t=uet(e);return{maxDistance:e.distanceMax,requiredFeatures:new Set([3,1]),getType:function(r,n,i,a){return het(r,n,i,a,t)}}}},xet={distanceMax:I.Numeric(4,{min:1,max:5,step:.1})};function Cet(e,t,r){for(var n=t.elements,i=t.model.atomicConformation,a=i.x,o=i.y,s=i.z,u=function(d,f){var h=Gr(t,d),v=!1;h==="C"?(v=!0,tu(e,t,d,function(p,m){var g=Gr(p,m);g!=="C"&&g!=="H"&&(v=!1)})):h==="F"&&(v=!0),v&&r.add(8,0,a[n[d]],o[n[d]],s[n[d]],d)},l=0,c=n.length;l<c;++l)u(l)}function _et(e,t){return e===8&&t===8}function wet(e,t,r,n){var i=t.types[t.feature],a=r.types[r.feature];if(_et(i,a)){var o=t.members[t.offsets[t.feature]],s=r.members[r.offsets[r.feature]];if(!(Gr(t.unit,o)==="F"&&Gr(r.unit,s)==="F"))return 6}}var Eet=Dn.Provider([8],Cet),Aet={name:"hydrophobic",params:xet,createTester:function(e){return{maxDistance:e.distanceMax,requiredFeatures:new Set([8]),getType:function(t,r,n,i){return wet(t,r,n)}}}},Pet={distanceMax:I.Numeric(3,{min:1,max:5,step:.1})},Tet=["LI","NA","K","RB","CS","MG","CA","SR","BA","AL","GA","IN","TL","SC","SN","PB","BI","SB","HG"];function Iet(e,t,r){for(var n=t.elements,i=t.model.atomicConformation,a=i.x,o=i.y,s=i.z,u=0,l=n.length;u<l;++u){var c=Gr(t,u),d=0;Tet.includes(c)?d=13:(ene(c)||c==="ZN"||c==="CD")&&(d=12),d&&r.add(d,0,a[n[u]],o[n[u]],s[n[u]],u)}}function mH(e){return!pd.has(e)}function Met(e){return pd.has(e)}function Det(e){return HE.has(e)}function Ret(e,t,r){for(var n=t.elements,i=t.model.atomicConformation,a=i.x,o=i.y,s=i.z,u=0,l=n.length;u<l;++u){var c=Gr(t,u),d=LF(t,u),f=n2(t,u),h=!1,v=!1,p=qE.has(d),m=XE.has(d);!p&&!m?EQe(c)||c==="O"||c==="S"?(h=!0,v=!0):c==="N"&&(h=!0):p?c==="O"?(["ASP","GLU","SER","THR","TYR","ASN","GLN"].includes(d)&&mH(f)||Met(f))&&(h=!0,v=!0):c==="S"&&(d==="CYS"||d==="MET")?(h=!0,v=!0):c==="N"&&d==="HIS"&&mH(f)&&(h=!0):m&&(c==="O"&&Det(f)?(h=!0,v=!0):["N3","N4","N7"].includes(f)?h=!0:["O2","O4","O6"].includes(f)&&(h=!0,v=!0)),h&&r.add(11,0,a[n[u]],o[n[u]],s[n[u]],u),v&&r.add(10,0,a[n[u]],o[n[u]],s[n[u]],u)}}function gH(e,t){if(e===12)return t===11||t===12;if(e===13)return t===10}function ket(e,t,r,n){var i=t.types[t.feature],a=r.types[r.feature];if(!(!gH(i,a)&&!gH(a,i)))return 7}var Oet=Dn.Provider([13,12],Iet),Fet=Dn.Provider([10,11],Ret),Let={name:"metal-coordination",params:Pet,createTester:function(e){return{maxDistance:e.distanceMax,requiredFeatures:new Set([13,12,10,11]),getType:function(t,r,n,i){return ket(t,r,n)}}}};function Net(e,t){for(var r=t.contacts,n=t.unitsContacts,i=t.unitsFeatures,a=[Bet(e,t),Uet(e,t),jet(e,t),zet(e,t),Vet(e,t)],o=0,s=r.edgeCount;o<s;++o){var u=r.edges[o],l=e.unitMap.get(u.unitA),c=e.unitMap.get(u.unitB),d=Dn.Info(e,l,i.get(u.unitA));d.feature=u.indexA;var f=Dn.Info(e,c,i.get(u.unitB));f.feature=u.indexB;for(var h=0,v=a;h<v.length;h++){var p=v[h];p.isApplicable(u.props.type)&&p.handleInterContact(o,d,f)}}for(var m=n.keys();;){var g=m.next(),y=g.done,b=g.value;if(y)break;var S=n.get(b),x=i.get(b),C=e.unitMap.get(b);if(je.isAtomic(C)){for(var d=Dn.Info(e,C,x),f=Dn.Info(e,C,x),w=0,A=a;w<A.length;w++){var p=A[w];p.startUnit(C,S,x)}for(var o=0,s=S.edgeCount*2;o<s;++o){d.feature=S.a[o],f.feature=S.b[o];for(var M=0,D=a;M<D.length;M++){var p=D[M];p.isApplicable(S.edgeProps.type[o])&&p.handleIntraContact(o,d,f)}}}}}function Bet(e,t){var r=t.contacts,n=function(l,c,d,f,h){var v=f.get(d)||[1/0,-1],p=v[0],m=v[1];l<p?(m!==-1&&h(m),f.set(d,[l,c])):h(c)};function i(l,c,d,f,h){var v=c.members[c.offsets[c.feature]],p=d.members[d.offsets[d.feature]],m=c.unit.getResidueIndex(v),g=d.unit.getResidueIndex(p),y=v+"|"+c.unit.id+"|"+g+"|"+d.unit.id+"|A",b=p+"|"+d.unit.id+"|"+m+"|"+c.unit.id+"|B",S=Dn.distance(c,d);n(S,l,y,f,h),n(S,l,b,f,h)}var a=new Map,o=function(l){return r.edges[l].props.flag=1},s,u;return{isApplicable:function(l){return l===6},handleInterContact:function(l,c,d){i(l,c,d,a,o)},startUnit:function(l,c,d){s=new Map,u=function(f){return c.edgeProps.flag[f]=1}},handleIntraContact:function(l,c,d){i(l,c,d,s,u)}}}function Uet(e,t){var r=t.contacts,n=function(i,a){for(var o=i.types[i.feature]===9?a:i,s=o.members[o.offsets[o.feature]],u=t.unitsContacts.get(o.unit.id),l=u.edgeProps.type,c=u.elementsIndex,d=c.offsets,f=c.indices,h=d[s],v=d[s+1];h<v;++h)if(l[f[h]]===4)return!0;for(var p=r.getEdgeIndices(o.feature,o.unit.id),h=0,v=p.length;h<v;++h)if(r.edges[p[h]].props.type===4)return!0;return!1};return{isApplicable:function(i){return i===8},handleInterContact:function(i,a,o){n(a,o)&&(r.edges[i].props.flag=1)},startUnit:function(){},handleIntraContact:function(i,a,o){if(n(a,o)){var s=t.unitsContacts.get(a.unit.id).edgeProps.flag;s[i]=1}}}}function BF(e,t,r,n,i){for(var a=r.offsets,o=r.feature,s=n.offsets,u=n.feature,l=a[o],c=a[o+1];l<c;++l)for(var d=r.members[l],f=i.getContactIndicesForElement(d,r.unit),h=0,v=f.length;h<v;++h){var p=f[h];if(e.includes(i.edges[p].props.type))for(var m=s[u],g=s[u+1];m<g;++m){var y=n.members[m];if(i.getContactIndicesForElement(y,n.unit).includes(p)){i.edges[t].props.flag=1;return}}}}function UF(e,t,r,n,i){for(var a=i.edgeProps,o=a.type,s=a.flag,u=i.elementsIndex,l=u.offsets,c=u.indices,d=r.offsets,f=r.feature,h=n.offsets,v=n.feature,p=d[f],m=d[f+1];p<m;++p)for(var g=r.members[p],y=l[g],b=l[g+1];y<b;++y){var S=c[y];if(e.includes(o[S])){for(var x=h[v],C=h[v+1];x<C;++x)for(var w=n.members[x],A=l[w],M=l[w+1];A<M;++A)if(S===c[A]){s[t]=1;return}}}}function jet(e,t){var r=t.contacts;return{isApplicable:function(n){return n===1},handleInterContact:function(n,i,a){BF([4,8],n,i,a,r)},startUnit:function(){},handleIntraContact:function(n,i,a){UF([4,8],n,i,a,t.unitsContacts.get(i.unit.id))}}}function zet(e,t){var r=t.contacts;return{isApplicable:function(n){return n===6||n===2},handleInterContact:function(n,i,a){BF([3],n,i,a,r)},startUnit:function(){},handleIntraContact:function(n,i,a){UF([3],n,i,a,t.unitsContacts.get(i.unit.id))}}}function Vet(e,t){var r=t.contacts;return{isApplicable:function(n){return n===1},handleInterContact:function(n,i,a){BF([7],n,i,a,r)},startUnit:function(){},handleIntraContact:function(n,i,a){UF([7],n,i,a,t.unitsContacts.get(i.unit.id))}}}var Sd;(function(e){function t(c,d,f,h,v,p){return gJ("interactions",{structure:d,interactions:c},{unitA:f,indexA:h,unitB:v,indexB:p})}e.Location=t;function r(c){return!!c&&c.kind==="data-location"&&c.tag==="interactions"}e.isLocation=r;function n(c,d){return c.data.structure===d.data.structure&&c.data.interactions===d.data.interactions&&c.element.indexA===d.element.indexA&&c.element.indexB===d.element.indexB&&c.element.unitA===d.element.unitA&&c.element.unitB===d.element.unitB}e.areLocationsEqual=n;function i(c,d){var f=d.unitA,h=d.indexA,v=d.unitB,p=d.indexB,m=c.contacts,g=c.unitsContacts;if(f===v){var y=g.get(f.id),b=y.getDirectedEdgeIndex(h,p);return oH(y.edgeProps.type[b])}else{var b=m.getEdgeIndex(h,f.id,p,v.id);return oH(m.edges[b].props.type)}}function a(c){return i(c.data.interactions,c.element)}e.locationLabel=a;function o(c,d,f){return lA("interactions",{structure:c,interactions:d},f,function(h){return u(d,f,h)},function(){return l(c,d,f)})}e.Loci=o;function s(c){return!!c&&c.kind==="data-loci"&&c.tag==="interactions"}e.isLoci=s;function u(c,d,f){var h=c.unitsFeatures;return md.fromPairProvider(d.length,function(v,p,m){var g=d[v];Dn.setPosition(p,g.unitA,g.indexA,h.get(g.unitA.id)),Dn.setPosition(m,g.unitB,g.indexB,h.get(g.unitB.id))},f)}e.getBoundingSphere=u;function l(c,d,f){var h=f[0];if(h===void 0)return"";var v=h.unitA,p=h.indexA,m=h.unitB,g=h.indexB,y=d.unitsFeatures,b=y.get(v.id),S=b.members,x=b.offsets,C=y.get(m.id),w=C.members,A=C.offsets,M={granularity:"element"};return(x[p+1]-x[p]>1||A[g+1]-A[g]>1)&&(M.granularity="residue"),[i(d,h),EF(Ht.Location(c,v,S[x[p]],c,m,w[A[g]]),M)].join("</br>")}e.getLabel=l})(Sd||(Sd={}));var Het=[BJe,UJe,jJe,pet,vet,met,SJe,CJe,Eet,Oet,Fet],Gw={ionic:get,"pi-stacking":yet,"cation-pi":bet,"halogen-bonds":_Je,"hydrogen-bonds":zJe,"weak-hydrogen-bonds":VJe,hydrophobic:Aet,"metal-coordination":Let};function Get(e){e===void 0&&(e=[]);var t=Object.create(null);return Object.keys(Gw).forEach(function(r){t[r]=I.MappedStatic(e.includes(r)?"on":"off",{on:I.Group(Gw[r].params),off:I.Group({})},{cycle:!0})}),t}var qet=Get(["cation-pi","pi-stacking","hydrogen-bonds","halogen-bonds","metal-coordination"]),Mne={providers:I.Group(qet,{isFlat:!0}),contacts:I.Group(nJe,{label:"Advanced Options"})};function $et(e,t,r){return ce(this,void 0,void 0,function(){var n,i,a,o,s,u,l,c,d,f,h,v,p,m,g,y;return de(this,function(b){switch(b.label){case 0:return n=E(E({},I.getDefaultValues(Mne)),r),[4,L2.attach(e,t)];case 1:b.sent(),i=[],uA(Gw).forEach(function(S){var x=n.providers[S],C=x.name,w=x.params;C==="on"&&i.push(Gw[S].createTester(w))}),a=new Set,i.forEach(function(S){return gi.add(a,S.requiredFeatures)}),o=Het.filter(function(S){return gi.areIntersecting(a,S.types)}),s=Qs.Mutable(),u=Qs.Mutable(),l=0,c=t.unitSymmetryGroups.length,b.label=2;case 2:return l<c?(d=t.unitSymmetryGroups[l],e.runtime.shouldUpdate?[4,e.runtime.update({message:"computing interactions",current:l,max:c})]:[3,4]):[3,6];case 3:b.sent(),b.label=4;case 4:for(f=Wet(t,d.units[0],o),h=Xet(t,d.units[0],f,i,n.contacts),v=0,p=d.units.length;v<p;++v)m=d.units[v],s.set(m.id,f),u.set(m.id,h);b.label=5;case 5:return++l,[3,2];case 6:return g=Yet(t,s,i,n.contacts),y={unitsFeatures:s,unitsContacts:u,contacts:g},Net(t,y),[2,y]}})})}function Wet(e,t,r){var n=t.elements.length,i=wR.create(n,n/2);if(je.isAtomic(t))for(var a=0,o=r;a<o.length;a++){var s=o[a];s.add(e,t,i)}return i.getFeatures(n)}function Xet(e,t,r,n,i){var a=AR.create(r,t.elements.length);return je.isAtomic(t)&&oJe(e,t,r,a,n,i),a.getContacts()}function Yet(e,t,r,n){var i=PR.create();return We.eachUnitPair(e,function(a,o){var s=t.get(a.id),u=t.get(o.id);lJe(e,a,s,o,u,i,r,n)},{maxRadius:Math.max.apply(Math,r.map(function(a){return a.maxDistance})),validUnit:function(a){return je.isAtomic(a)},validUnitPair:function(a,o){return We.validUnitPair(e,a,o)}}),i.getContacts(t)}var qT=E({},Mne),Kn=Dh.createProvider({label:"Interactions",descriptor:ko({name:"molstar_computed_interactions"}),type:"local",defaultParams:qT,getParams:function(e){return qT},isApplicable:function(e){return!e.isCoarseGrained},obtain:function(e,t,r){return ce(void 0,void 0,void 0,function(){var n,i;return de(this,function(a){switch(a.label){case 0:return n=E(E({},I.getDefaultValues(qT)),r),i={},[4,$et(e,t,n)];case 1:return[2,(i.value=a.sent(),i)]}})})}}),hS=_(),pS=_(),lp=_(),$T=qe.add,yH=qe.add3,qw;(function(e){function t(r,n,i){r===void 0&&(r=2048),n===void 0&&(n=1024);var a=qe.create(Float32Array,1,n,i?i.groupBuffer.ref.value:r),o=qe.create(Float32Array,3,n,i?i.startBuffer.ref.value:r),s=qe.create(Float32Array,3,n,i?i.endBuffer.ref.value:r),u=qe.create(Float32Array,1,n,i?i.scaleBuffer.ref.value:r),l=qe.create(Float32Array,1,n,i?i.capBuffer.ref.value:r),c=function(f,h,v,p,m,g,y,b,S,x){for(var C=0;C<6;++C)yH(o,f,h,v),yH(s,p,m,g),$T(a,x),$T(u,y),$T(l,(b?1:0)+(S?2:0))},d=function(f,h,v,p,m,g,y){var b=_.distance(f,h),S=Math.floor(v/2),x=1/v;_.sub(lp,h,f);for(var C=0;C<S;++C){var w=x*(C*2+1);_.setMagnitude(lp,lp,b*w),_.add(hS,f,lp),_.setMagnitude(lp,lp,b*x*((C+1)*2)),_.add(pS,f,lp),c(hS[0],hS[1],hS[2],pS[0],pS[1],pS[2],p,m,g,y)}};return{add:c,addFixedCountDashes:d,addFixedLengthDashes:function(f,h,v,p,m,g,y){var b=_.distance(f,h);d(f,h,b/v,p,m,g,y)},getCylinders:function(){var f=a.elementCount/6,h=qe.compact(a,!0),v=qe.compact(o,!0),p=qe.compact(s,!0),m=qe.compact(u,!0),g=qe.compact(l,!0),y=i&&f<=i.cylinderCount?i.mappingBuffer.ref.value:new Float32Array(f*18),b=i&&f<=i.cylinderCount?i.indexBuffer.ref.value:new Uint32Array(f*12);return(!i||f>i.cylinderCount)&&Ket(f,y,b),as.create(y,b,h,v,p,m,g,f,i)}}}e.create=t})(qw||(qw={}));function Ket(e,t,r){for(var n=0;n<e;++n){var i=n*18;t[i]=-1,t[i+1]=1,t[i+2]=-1,t[i+3]=-1,t[i+4]=-1,t[i+5]=-1,t[i+6]=1,t[i+7]=1,t[i+8]=-1,t[i+9]=1,t[i+10]=1,t[i+11]=1,t[i+12]=1,t[i+13]=-1,t[i+14]=-1,t[i+15]=1,t[i+16]=-1,t[i+17]=1}for(var n=0;n<e;++n){var a=n*6,o=n*12;r[o]=a,r[o+1]=a+1,r[o+2]=a+2,r[o+3]=a+1,r[o+4]=a+4,r[o+5]=a+2,r[o+6]=a+2,r[o+7]=a+4,r[o+8]=a+3,r[o+9]=a+4,r[o+10]=a+5,r[o+11]=a+3}}var um={linkScale:I.Numeric(.45,{min:0,max:1,step:.01}),linkSpacing:I.Numeric(1,{min:0,max:2,step:.01}),linkCap:I.Boolean(!1),dashCount:I.Numeric(4,{min:2,max:10,step:2}),dashScale:I.Numeric(.8,{min:0,max:2,step:.1}),dashCap:I.Boolean(!0),stubCap:I.Boolean(!0),radialSegments:I.Numeric(16,{min:2,max:56,step:2},Et.CustomQualityParamInfo)};I.getDefaultValues(um);var Dne={linkScale:I.Numeric(.5,{min:0,max:1,step:.1}),linkSpacing:I.Numeric(.1,{min:0,max:2,step:.01}),dashCount:I.Numeric(4,{min:2,max:10,step:2})};I.getDefaultValues(Dne);var jn=_(),uf=_(),Ps=_(),Qet=_.create(0,1,0);function jF(e,t,r,n){_.normalize(uf,_.sub(uf,t,r)),n!==null?_.sub(Ps,t,n):_.copy(Ps,t),_.normalize(Ps,Ps);var i=_.dot(uf,Ps);return 1-Math.abs(i)<1e-5&&(_.set(Ps,1,0,0),i=_.dot(uf,Ps),1-Math.abs(i)<1e-5&&(_.set(Ps,0,1,0),i=_.dot(uf,Ps))),_.setMagnitude(uf,uf,i),_.sub(Ps,Ps,uf),_.normalize(e,Ps)}var Tu=_.scale,Qo=_.add,ki=_.sub,Jc=_.setMagnitude,Zet=_.dot;function lm(e,t,r,n){var i=t.linkCount,a=t.referencePosition,o=t.position,s=t.style,u=t.radius,l=t.ignore,c=t.stub;if(!i)return Lt.createEmpty(n);for(var d=r.linkScale,f=r.linkSpacing,h=r.radialSegments,v=r.linkCap,p=r.dashCount,m=r.dashScale,g=r.dashCap,y=r.stubCap,b=h*2*i*2,S=wt.createState(b,b/4,n),x=_(),C=_(),w=_(),A={radiusTop:1,radiusBottom:1,radialSegments:h,topCap:v,bottomCap:v},M=p+1,D=0,k=i;D<k;++D)if(!(l&&l(D))){o(x,C,D),ki(jn,C,x);var R=u(D),O=s?s(D):0,H=y&&(c?c(D):!1),B=Zet(jn,Qet)>0?[H,v]:[v,H],j=B[0],Y=B[1];S.currentGroup=D;var G=4.5;if(O===0)A.radiusTop=A.radiusBottom=R,A.topCap=j,A.bottomCap=Y,Ha(S,x,C,.5,A);else if(O===1)A.radiusTop=A.radiusBottom=R*m,A.topCap=A.bottomCap=g,$1(S,x,C,.5,M,A);else if(O===2||O===3||O===5||O===6){var $=O===2?2:O===3?3:1.5,q=R*(d/(.5*$)),ee=(R-q)*f;jF(w,x,C,a?a(D):null),A.topCap=j,A.bottomCap=Y,O===5||O===6?(A.radiusTop=A.radiusBottom=R,Ha(S,x,C,.5,A),A.radiusTop=A.radiusBottom=R*d,A.topCap=A.bottomCap=g,Jc(w,w,ee*G),ki(x,x,w),ki(C,C,w),$1(S,x,C,.5,3,A),O===6&&(Jc(w,w,ee*G*2),Qo(x,x,w),Qo(C,C,w),$1(S,x,C,.5,3,A))):(Jc(w,w,ee),A.radiusTop=A.radiusBottom=q,$===3&&Ha(S,x,C,.5,A),AGe(S,x,C,.5,w,A))}else O===4&&(Tu(jn,jn,.475),Qo(x,x,jn),ki(C,C,jn),A.radiusTop=A.radiusBottom=R,A.topCap=j,A.bottomCap=Y,Ha(S,x,C,.5,A))}return wt.getMesh(S)}function Rne(e,t,r,n){var i=t.linkCount,a=t.referencePosition,o=t.position,s=t.style,u=t.radius,l=t.ignore,c=t.stub;if(!i)return as.createEmpty(n);for(var d=r.linkScale,f=r.linkSpacing,h=r.linkCap,v=r.dashCount,p=r.dashScale,m=r.dashCap,g=r.stubCap,y=i*2,b=qw.create(y,y/4,n),S=_(),x=_(),C=_(),w=_(),A=v%2===1?v:v+1,M=.5-.5/2/A,D=3,k=.5-.5/2/D,R=4.5,O=0,H=i;O<H;++O)if(!(l&&l(O))){o(S,x,O);var B=u(O),j=s?s(O):0,Y=g&&(c?c(O):!1);if(j===0)Tu(C,Qo(C,S,x),.5),b.add(S[0],S[1],S[2],C[0],C[1],C[2],1,h,Y,O);else if(j===1)Tu(jn,ki(jn,x,S),M),ki(x,x,jn),b.addFixedCountDashes(S,x,A,p,m,m,O);else if(j===2||j===3||j===5||j===6){var G=j===2?2:j===3?3:1.5,$=d/(.5*G),q=(B-$*B)*f;Tu(C,Qo(C,S,x),.5),jF(w,S,x,a?a(O):null),j===5||j===6?(b.add(S[0],S[1],S[2],C[0],C[1],C[2],1,h,Y,O),Tu(jn,ki(jn,x,S),k),ki(x,x,jn),Jc(w,w,q*R),ki(S,S,w),ki(x,x,w),b.addFixedCountDashes(S,x,D,d,m,m,O),j===6&&(Jc(w,w,q*R*2),Qo(S,S,w),Qo(x,x,w),b.addFixedCountDashes(S,x,D,d,m,m,O))):(Jc(w,w,q),G===3&&b.add(S[0],S[1],S[2],C[0],C[1],C[2],$,h,!1,O),b.add(S[0]+w[0],S[1]+w[1],S[2]+w[2],C[0]+w[0],C[1]+w[1],C[2]+w[2],$,h,Y,O),b.add(S[0]-w[0],S[1]-w[1],S[2]-w[2],C[0]-w[0],C[1]-w[1],C[2]-w[2],$,h,Y,O))}else j===4&&(Tu(jn,ki(jn,x,S),.475),Qo(S,S,jn),ki(x,x,jn),b.add(S[0],S[1],S[2],x[0],x[1],x[2],1,h,Y,O))}return b.getCylinders()}function kne(e,t,r,n){var i=t.linkCount,a=t.referencePosition,o=t.position,s=t.style,u=t.ignore;if(!i)return Pn.createEmpty(n);for(var l=r.linkScale,c=r.linkSpacing,d=r.dashCount,f=i*2,h=vs.create(f,f/4,n),v=_(),p=_(),m=_(),g=_(),y=d%2===1?d:d+1,b=.5-.5/2/y,S=3,x=.5-.5/2/S,C=4.5,w=0,A=i;w<A;++w)if(!(u&&u(w))){o(v,p,w);var M=s?s(w):0;if(M===0)Tu(m,Qo(m,v,p),.5),h.add(v[0],v[1],v[2],m[0],m[1],m[2],w);else if(M===1)Tu(jn,ki(jn,p,v),b),ki(p,p,jn),h.addFixedCountDashes(v,p,y,w);else if(M===2||M===3||M===5||M===6){var D=M===2?2:M===3?3:1.5,k=1*(l/(.5*D)),R=(1-k)*c;Tu(m,Qo(m,v,p),.5),jF(g,v,p,a?a(w):null),M===5||M===6?(h.add(v[0],v[1],v[2],m[0],m[1],m[2],w),Tu(jn,ki(jn,p,v),x),ki(p,p,jn),Jc(g,g,R*C),ki(v,v,g),ki(p,p,g),h.addFixedCountDashes(v,p,S,w),M===6&&(Jc(g,g,R*C*2),Qo(v,v,g),Qo(p,p,g),h.addFixedCountDashes(v,p,S,w))):(Jc(g,g,R),D===3&&h.add(v[0],v[1],v[2],m[0],m[1],m[2],w),h.add(v[0]+g[0],v[1]+g[1],v[2]+g[2],m[0]+g[0],m[1]+g[1],m[2]+g[2],w),h.add(v[0]-g[0],v[1]-g[1],v[2]-g[2],m[0]-g[0],m[1]-g[1],m[2]-g[2],w))}else M===4&&(Tu(jn,ki(jn,p,v),.475),Qo(v,v,jn),ki(p,p,jn),h.add(v[0],v[1],v[2],p[0],p[1],p[2],w))}return h.getLines()}function Jet(e,t,r,n,i,a){return ce(this,void 0,void 0,function(){var o,s,u,l,c,d,f,h,v,p,m,g,y,b,S,x,C,w,A;return de(this,function(M){return je.isAtomic(t)?(o=r.child,s=o==null?void 0:o.unitMap.get(t.id),o&&!s?[2,Lt.createEmpty(a)]:(u=Ze.create(r,t),l=Kn.get(r).value,c=l.unitsFeatures.get(t.id),d=l.unitsContacts.get(t.id),f=c.x,h=c.y,v=c.z,p=c.members,m=c.offsets,g=d.edgeCount,y=d.a,b=d.b,S=d.edgeProps.flag,x=i.sizeFactor,g?(C={linkCount:g*2,position:function(D,k,R){_.set(D,f[y[R]],h[y[R]],v[y[R]]),_.set(k,f[b[R]],h[b[R]],v[b[R]])},style:function(D){return 1},radius:function(D){u.element=t.elements[p[m[y[D]]]];var k=n.size.size(u);u.element=t.elements[p[m[b[D]]]];var R=n.size.size(u);return Math.min(k,R)*x},ignore:function(D){return S[D]===1||!!s&&!Je.has(s.elements,t.elements[p[m[y[D]]]])}},w=lm(e,C,i,a),A=Be.expand(Be(),(s??t).boundary.sphere,1*x),w.setBoundingSphere(A),[2,w]):[2,Lt.createEmpty(a)])):[2,Lt.createEmpty(a)]})})}var One=E(E(E({},Ia),um),{sizeFactor:I.Numeric(.3,{min:0,max:10,step:.01}),dashCount:I.Numeric(6,{min:2,max:10,step:2}),dashScale:I.Numeric(.4,{min:0,max:2,step:.1}),includeParent:I.Boolean(!1)});function ett(e){return ho({defaultProps:I.getDefaultValues(One),createGeometry:Jet,createLocationIterator:ntt,getLoci:ttt,eachLocation:rtt,setUpdateState:function(t,r,n,i,a,o,s){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.dashCount!==n.dashCount||r.dashScale!==n.dashScale||r.dashCap!==n.dashCap||r.radialSegments!==n.radialSegments;var u=Kn.get(o.structure).version;t.info.interactionsHash!==u&&(t.createGeometry=!0,t.updateTransform=!0,t.updateColor=!0,t.info.interactionsHash=u)}},e)}function ttt(e,t,r){var n=e.objectId,i=e.instanceId,a=e.groupId;if(r===n){var o=t.structure,s=t.group,u=o.unitMap.get(s.units[i].id),l=Kn.get(o).value,c=l.unitsContacts.get(u.id),d=c.a,f=c.b;return Sd.Loci(o,l,[{unitA:u,indexA:d[a],unitB:u,indexB:f[a]},{unitA:u,indexA:f[a],unitB:u,indexB:d[a]}])}return jr}function rtt(e,t,r,n){var i=!1;if(Sd.isLoci(e)){var a=t.structure,o=t.group;if(!We.areEquivalent(e.data.structure,a))return!1;var s=Kn.get(a).value;if(e.data.interactions!==s)return!1;for(var u=o.units[0],l=s.unitsContacts.get(u.id),c=l.edgeCount*2,d=0,f=e.elements;d<f.length;d++){var h=f[d];if(h.unitA===h.unitB){var v=o.unitIndexMap.get(h.unitA.id);if(v!==void 0){var p=l.getDirectedEdgeIndex(h.indexA,h.indexB);p!==-1&&r(Ie.ofSingleton(v*c+p))&&(i=!0)}}}}else if(Re.is(e)){var a=t.structure,o=t.group;if(!We.areEquivalent(e.structure,a))return!1;var s=Kn.get(a).value;if(!s)return!1;for(var u=o.units[0],l=s.unitsContacts.get(u.id),m=s.unitsFeatures.get(u.id),g=l.edgeCount*2,y=l.offset,b=m.elementsIndex,S=b.offsets,x=b.indices,C=function(H){var B=o.unitIndexMap.get(H.unit.id);if(B!==void 0||n&&Fe.size(H.indices)===1)return"continue";Fe.forEach(H.indices,function(j){for(var Y=S[j],G=S[j+1];Y<G;++Y)for(var $=x[Y],q=y[$],ee=y[$+1];q<ee;++q)r(Ie.ofSingleton(B*g+q))&&(i=!0)})},w=0,A=e.elements;w<A.length;w++){var h=A[w];C(h)}}return i}function ntt(e){var t=e.structure,r=e.group,n=r.units[0],i=Kn.get(t).value,a=i.unitsContacts.get(n.id),o=a.edgeCount*2,s=r.units.length,u=Sd.Location(i,t),l=u.element,c=function(d,f){var h=r.units[f];return l.unitA=h,l.indexA=a.a[d],l.unitB=h,l.indexB=a.b[d],u};return wn(o,s,1,c)}function itt(e,t,r,n,i){if(!t.hasAtomic)return Lt.createEmpty(i);var a=Ze.create(t),o=Kn.get(t).value,s=o.contacts,u=o.unitsFeatures,l=s.edgeCount,c=s.edges,d=n.sizeFactor;if(!l)return Lt.createEmpty(i);var f=t.child,h={linkCount:l,position:function(m,g,y){var b=c[y],S=b.unitA,x=b.indexA,C=b.unitB,w=b.indexB,A=u.get(S),M=u.get(C),D=t.unitMap.get(S),k=t.unitMap.get(C);_.set(m,A.x[x],A.y[x],A.z[x]),_.transformMat4(m,m,D.conformation.operator.matrix),_.set(g,M.x[w],M.y[w],M.z[w]),_.transformMat4(g,g,k.conformation.operator.matrix)},style:function(m){return 1},radius:function(m){var g=c[m],y=u.get(g.unitA);a.unit=t.unitMap.get(g.unitA),a.element=a.unit.elements[y.members[y.offsets[g.indexA]]];var b=r.size.size(a),S=u.get(g.unitB);a.unit=t.unitMap.get(g.unitB),a.element=a.unit.elements[S.members[S.offsets[g.indexB]]];var x=r.size.size(a);return Math.min(b,x)*d},ignore:function(m){if(c[m].props.flag===1)return!0;if(f){var g=c[m],y=f.unitMap.get(g.unitA);if(!y)return!0;var b=t.unitMap.get(g.unitA),S=u.get(g.unitA),x=b.elements[S.members[S.offsets[g.indexA]]];if(!Je.has(y.elements,x))return!0}return!1}},v=lm(e,h,n,i),p=Be.expand(Be(),(f??t).boundary.sphere,1*d);return v.setBoundingSphere(p),v}var Fne=E(E(E({},F2),um),{sizeFactor:I.Numeric(.3,{min:0,max:10,step:.01}),dashCount:I.Numeric(6,{min:2,max:10,step:2}),dashScale:I.Numeric(.4,{min:0,max:2,step:.1}),includeParent:I.Boolean(!1)});function att(e){return om({defaultProps:I.getDefaultValues(Fne),createGeometry:itt,createLocationIterator:utt,getLoci:ott,eachLocation:stt,setUpdateState:function(t,r,n,i,a,o,s){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.dashCount!==n.dashCount||r.dashScale!==n.dashScale||r.dashCap!==n.dashCap||r.radialSegments!==n.radialSegments;var u=Kn.get(o).version;t.info.interactionsHash!==u&&(t.createGeometry=!0,t.updateTransform=!0,t.updateColor=!0,t.info.interactionsHash=u)}},e)}function ott(e,t,r){var n=e.objectId,i=e.groupId;if(r===n){var a=Kn.get(t).value,o=a.contacts.edges[i],s=t.unitMap.get(o.unitA),u=t.unitMap.get(o.unitB);return Sd.Loci(t,a,[{unitA:s,indexA:o.indexA,unitB:u,indexB:o.indexB},{unitA:u,indexA:o.indexB,unitB:s,indexB:o.indexA}])}return jr}function stt(e,t,r,n){var i,a=!1;if(Sd.isLoci(e)){if(!We.areEquivalent(e.data.structure,t))return!1;var o=Kn.get(t).value;if(e.data.interactions!==o)return!1;for(var s=o.contacts,u=0,l=e.elements;u<l.length;u++){var c=l[u],d=s.getEdgeIndex(c.indexA,c.unitA.id,c.indexB,c.unitB.id);d!==-1&&r(Ie.ofSingleton(d))&&(a=!0)}}else if(Re.is(e)){if(!We.areEquivalent(e.structure,t)||n&&e.elements.length===1)return!1;var f=(i=Kn.get(t).value)===null||i===void 0?void 0:i.contacts;if(!f)return!1;for(var h=function(g){var y=g.unit;if(!je.isAtomic(y)||n&&Fe.size(g.indices)===1)return"continue";Fe.forEach(g.indices,function(b){for(var S=0,x=f.getContactIndicesForElement(b,y);S<x.length;S++){var C=x[S];r(Ie.ofSingleton(C))&&(a=!0)}})},v=0,p=e.elements;v<p.length;v++){var m=p[v];h(m)}}return a}function utt(e){var t=Kn.get(e).value,r=t.contacts,n=r.edgeCount,i=1,a=Sd.Location(t,e),o=a.element,s=function(u){var l=r.edges[u];return o.unitA=e.unitMap.get(l.unitA),o.indexA=l.indexA,o.unitB=e.unitMap.get(l.unitB),o.indexB=l.indexB,a};return wn(n,i,1,s,!0)}var Lne={"intra-unit":function(e,t){return si("Intra-unit interactions cylinder",e,t,ett)},"inter-unit":function(e,t){return Bu("Inter-unit interactions cylinder",e,t,att)}},Nne=E(E(E({},One),Fne),{unitKinds:O2(["atomic"]),sizeFactor:I.Numeric(.2,{min:.01,max:1,step:.01}),visuals:I.MultiSelect(["intra-unit","inter-unit"],I.objectToOptions(Lne))});function ltt(e,t){return I.clone(Nne)}function ctt(e,t){return ur.createMulti("Interactions",e,t,Hi,Lne)}var $w={name:"interactions",label:"Non-covalent Interactions",description:"Displays non-covalent interactions as dashed cylinders.",factory:ctt,getParams:ltt,defaultValues:I.getDefaultValues(Nne),defaultColorTheme:{name:"interaction-type"},defaultSizeTheme:{name:"uniform"},isApplicable:function(e){return e.elementCount>0&&Kn.isApplicable(e)},ensureCustomProperties:{attach:function(e,t){return Kn.attach(e,t,void 0,!0)},detach:function(e){return Kn.ref(e,!1)}},getData:function(e,t){return t.includeParent?e.asParent():e},mustRecreate:function(e,t){return e.includeParent!==t.includeParent}},MR=at(13421772),dtt="Assigns colors according the interaction type of a link.",Ba={HydrogenBond:2851770,Hydrophobic:8421504,HalogenBond:4259775,Ionic:15779860,MetalCoordination:9191577,CationPi:16744448,PiStacking:9220966,WeakHydrogenBond:12967404},ftt=[["Hydrogen Bond",Ba.HydrogenBond],["Hydrophobic",Ba.Hydrophobic],["Halogen Bond",Ba.HalogenBond],["Ionic",Ba.Ionic],["Metal Coordination",Ba.MetalCoordination],["Cation Pi",Ba.CationPi],["Pi Stacking",Ba.PiStacking],["Weak HydrogenBond",Ba.WeakHydrogenBond]];function bH(e){switch(e){case 4:return Ba.HydrogenBond;case 6:return Ba.Hydrophobic;case 5:return Ba.HalogenBond;case 1:return Ba.Ionic;case 7:return Ba.MetalCoordination;case 2:return Ba.CationPi;case 3:return Ba.PiStacking;case 8:return Ba.WeakHydrogenBond;case 0:return MR}}var Bne={};function htt(e){return Bne}function Une(e,t){var r,n=e.structure?Kn.get(e.structure):void 0,i=n?Kv(n.id,n.version):-1;return n&&n.value?r=function(a){if(Sd.isLocation(a)){var o=a.data.interactions,s=o.unitsContacts,u=o.contacts,l=a.element,c=l.unitA,d=l.unitB,f=l.indexA,h=l.indexB;if(c===d){var v=s.get(c.id),p=v.getDirectedEdgeIndex(f,h);return bH(v.edgeProps.type[p])}else{var p=u.getEdgeIndex(f,c.id,h,d.id);return bH(u.edges[p].props.type)}}return MR}:r=function(){return MR},{factory:Une,granularity:"group",color:r,props:t,contextHash:i,description:dtt,legend:Gh(ftt)}}var DR={name:"interaction-type",label:"Interaction Type",category:"Miscellaneous",factory:Une,getParams:htt,defaultValues:I.getDefaultValues(Bne),isApplicable:function(e){return!!e.structure},ensureCustomProperties:{attach:function(e,t){return t.structure?Kn.attach(e,t.structure,void 0,!0):Promise.resolve()},detach:function(e){return e.structure&&Kn.ref(e.structure,!1)}}};function PC(e,t,r){r===void 0&&(r={});var n=r;return typeof n.type=="string"||typeof n.color=="string"||typeof n.size=="string"?vtt(e,t||We.Empty,r):jne(e,t||We.Empty,r)}function ptt(e,t){var r=e.representation.structure.themes;return t?r.colorThemeRegistry.getApplicableTypes({structure:t}):r.colorThemeRegistry.types}function RR(e,t,r,n,i){var a=e.representation.structure,o=a.registry,s=a.themes,u=o.get(r||o.default.name),l=s.colorThemeRegistry.get(n||u.defaultColorTheme.name),c=I.getDefaultValues(l.getParams({structure:t||We.Empty}));return l.name===u.defaultColorTheme.name&&Object.assign(c,u.defaultColorTheme.props),{name:l.name,params:Object.assign(c,i)}}function xH(e,t,r,n,i){var a=e.representation.structure,o=a.registry,s=a.themes,u=o.get(r||o.default.name),l=s.sizeThemeRegistry.get(n||u.defaultSizeTheme.name),c=I.getDefaultValues(l.getParams({structure:t||We.Empty}));return l.name===u.defaultSizeTheme.name&&Object.assign(c,u.defaultSizeTheme.props),{name:l.name,params:Object.assign(c,i)}}function vtt(e,t,r){var n=r.type&&e.representation.structure.registry.get(r.type)||e.representation.structure.registry.default.provider,i=r.color&&e.representation.structure.themes.colorThemeRegistry.get(r.color)||e.representation.structure.themes.colorThemeRegistry.get(n.defaultColorTheme.name),a=r.size&&e.representation.structure.themes.sizeThemeRegistry.get(r.size)||e.representation.structure.themes.sizeThemeRegistry.get(n.defaultSizeTheme.name);return jne(e,t,{type:n,typeParams:r.typeParams,color:i,colorParams:r.colorParams,size:a,sizeParams:r.sizeParams})}function jne(e,t,r){r===void 0&&(r={});var n=e.representation.structure.themes,i={structure:t},a=r.type||e.representation.structure.registry.default.provider,o=I.getDefaultValues(a.getParams(n,t)),s=Object.assign(o,r.typeParams),u=r.color||n.colorThemeRegistry.get(a.defaultColorTheme.name),l=I.getDefaultValues(u.getParams(i));u.name===a.defaultColorTheme.name&&Object.assign(l,a.defaultColorTheme.props);var c=Object.assign(l,r.colorParams),d=r.size||n.sizeThemeRegistry.get(a.defaultSizeTheme.name),f=I.getDefaultValues(d.getParams(i));d.name===a.defaultSizeTheme.name&&Object.assign(f,a.defaultSizeTheme.props);var h=Object.assign(f,r.sizeParams);return{type:{name:a.name,params:s},colorTheme:{name:u.name,params:c},sizeTheme:{name:d.name,params:h}}}var Nr;(function(e){var t=function(c){Le(d,c);function d(){return c!==null&&c.apply(this,arguments)||this}return d}(ge.Create({name:"Root",typeClass:"Root"}));e.Root=t;var r=function(c){Le(d,c);function d(){return c!==null&&c.apply(this,arguments)||this}return d}(ge.Create({name:"Category",typeClass:"Object"}));e.Category=r;var n=function(c){Le(d,c);function d(){return c!==null&&c.apply(this,arguments)||this}return d}(ge.CreateBehavior({name:"Behavior"}));e.Behavior=n,e.Categories={common:"Common",representation:"Representation",interaction:"Interaction","custom-props":"Custom Properties",misc:"Miscellaneous"},e.CreateCategory=kt.BuiltIn({name:"create-behavior-category",display:{name:"Behavior Category"},from:t,to:r,params:{label:I.Text("",{isHidden:!0})}})({apply:function(c){var d=c.params;return new r({},{label:d.label})}});var i=new Map;function a(c){return i.get(c.id)}e.getCategoryId=a;function o(c){var d=kt.CreateBuiltIn({name:c.name,display:c.display,from:[t],to:[n],params:c.params,apply:function(f,h){var v=f.params,p=c.label?c.label(v):{label:c.display.name,description:c.display.description};return new n(new c.ctor(h,v),p)},update:function(f){var h=this,v=f.b,p=f.newParams;return $e.create("Update Behavior",function(){return ce(h,void 0,void 0,function(){var m;return de(this,function(g){switch(g.label){case 0:return v.data.update?[4,v.data.update(p)]:[2,ft.UpdateResult.Unchanged];case 1:return m=g.sent(),[2,m?ft.UpdateResult.Updated:ft.UpdateResult.Unchanged]}})})})},canAutoUpdate:c.canAutoUpdate});return i.set(d.id,c.category),d}e.create=o;function s(c,d){return function(){function f(h){this.ctx=h,this.sub=void 0}return f.prototype.register=function(){var h=this;this.sub=c.subscribe(this.ctx,function(v){return d(v,h.ctx)})},f.prototype.unregister=function(){this.sub&&this.sub.unsubscribe(),this.sub=void 0},f}()}e.simpleCommandHandler=s;var u=function(){function c(d,f){this.ctx=d,this.params=f,this.subs=[]}return c.prototype.subscribeCommand=function(d,f){this.subs.push(d.subscribe(this.ctx,f))},c.prototype.subscribeObservable=function(d,f){this.subs.push(d.subscribe(f))},c.prototype.track=function(d){this.subs.push(d)},c.prototype.unregister=function(){for(var d=0,f=this.subs;d<f.length;d++){var h=f[d];h.unsubscribe()}this.subs=[]},c.prototype.update=function(d){return c0(d,this.params)?!1:(this.params=d,!0)},c}();e.Handler=u;var l=function(){function c(d,f){this.plugin=d,this.params=f,this.subs=[]}return c.prototype.subscribeCommand=function(d,f){this.subs.push(d.subscribe(this.plugin,f))},c.prototype.subscribeObservable=function(d,f){this.subs.push(d.subscribe(f))},c.prototype.unregister=function(){for(var d=0,f=this.subs;d<f.length;d++){var h=f[d];h.unsubscribe()}this.subs=[]},c}();e.WithSubscribers=l})(Nr||(Nr={}));var N2=function(){function e(){this.subs=void 0}return e.prototype.subscribe=function(t,r){var n=this;typeof this.subs>"u"&&(this.subs=[]);var i=t.subscribe(r);return this.subs.push(i),{unsubscribe:function(){i&&n.subs&&rv(n.subs,i)&&(i.unsubscribe(),i=void 0)}}},Object.defineProperty(e.prototype,"ev",{get:function(){return this._ev||(this._ev=hd.create())},enumerable:!1,configurable:!0}),e.prototype.dispose=function(){if(this._ev&&this._ev.dispose(),this.subs){for(var t=0,r=this.subs;t<r.length;t++){var n=r[t];n.unsubscribe()}this.subs=void 0}},e}(),Wd=function(e){Le(t,e);function t(r){var n=e.call(this)||this;return n._state=r,n}return t.prototype.updateState=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];var i=this.state,a=URe(i,r);return a!==i?(this._state=a,!0):!1},Object.defineProperty(t.prototype,"state",{get:function(){return this._state},enumerable:!1,configurable:!0}),t}(N2),kR="2.2.0",mtt=new Date(typeof __MOLSTAR_DEBUG_TIMESTAMP__<"u"?__MOLSTAR_DEBUG_TIMESTAMP__:1627737258743),Ww=function(e){Le(t,e);function t(r){var n=e.call(this,{current:void 0,entries:ci.List(),isPlaying:!1,nextSnapshotDelayInMs:t.DefaultNextSnapshotDelayInMs})||this;return n.plugin=r,n.entryMap=new Map,n.events={changed:n.ev()},n.timeoutHandle=void 0,n.next=function(){return ce(n,void 0,void 0,function(){var i,a,o;return de(this,function(s){switch(s.label){case 0:return this.timeoutHandle=void 0,i=this.getNextId(this.state.current,1),!i||i===this.state.current?(this.stop(),[2]):(a=this.setCurrent(i),[4,this.plugin.state.setSnapshot(a)]);case 1:return s.sent(),o=typeof a.durationInMs<"u"?a.durationInMs:this.state.nextSnapshotDelayInMs,this.state.isPlaying&&(this.timeoutHandle=setTimeout(this.next,o)),[2]}})})},n}return t.prototype.getIndex=function(r){return this.state.entries.indexOf(r)},t.prototype.getEntry=function(r){if(r)return this.entryMap.get(r)},t.prototype.remove=function(r){var n=this.entryMap.get(r);n&&(this.entryMap.delete(r),this.updateState({current:this.state.current===r?void 0:this.state.current,entries:this.state.entries.delete(this.getIndex(n))}),this.events.changed.next())},t.prototype.add=function(r){this.entryMap.set(r.snapshot.id,r),this.updateState({current:r.snapshot.id,entries:this.state.entries.push(r)}),this.events.changed.next()},t.prototype.replace=function(r,n){var i=this.getEntry(r);if(i){var a=this.getIndex(i),o=t.Entry(n,{name:i.name,description:i.description});this.entryMap.set(n.id,o),this.updateState({current:o.snapshot.id,entries:this.state.entries.set(a,o)}),this.events.changed.next()}},t.prototype.move=function(r,n){var i=this.state.entries.size;if(!(i<2)){var a=this.getEntry(r);if(a){var o=this.getIndex(a),s=(o+n)%i;s<0&&(s+=i);var u=this.state.entries.get(s),l=this.state.entries.asMutable();l.set(s,a),l.set(o,u),this.updateState({current:a.snapshot.id,entries:l.asImmutable()}),this.events.changed.next()}}},t.prototype.clear=function(){this.state.entries.size!==0&&(this.entryMap.clear(),this.updateState({current:void 0,entries:ci.List()}),this.events.changed.next())},t.prototype.setCurrent=function(r){var n=this.getEntry(r);return n&&(this.updateState({current:r}),this.events.changed.next()),n&&n.snapshot},t.prototype.getNextId=function(r,n){var i=this.state.entries.size;if(!r){if(i===0)return;var a=n===-1?i-1:0;return this.state.entries.get(a).snapshot.id}var o=this.getEntry(r);if(o){var s=this.getIndex(o);if(!(s<0))return s=(s+n)%i,s<0&&(s+=i),this.state.entries.get(s).snapshot.id}},t.prototype.setStateSnapshot=function(r){return ce(this,void 0,void 0,function(){var n,i,a,o,s,u,l;return de(this,function(c){switch(c.label){case 0:for(r.version,this.clear(),n=ci.List().asMutable(),i=0,a=r.entries;i<a.length;i++)o=a[i],this.entryMap.set(o.snapshot.id,o),n.push(o);return s=r.current?r.current:r.entries.length>0?r.entries[0].snapshot.id:void 0,this.updateState({current:s,entries:n.asImmutable(),isPlaying:!1,nextSnapshotDelayInMs:r.playback?r.playback.nextSnapshotDelayInMs:t.DefaultNextSnapshotDelayInMs}),this.events.changed.next(),s?(u=this.getEntry(s),l=u&&u.snapshot,l?[4,this.plugin.state.setSnapshot(l)]:[2]):[2];case 1:return c.sent(),r.playback&&r.playback.isPlaying&&this.play(!0),[2,l]}})})},t.prototype.syncCurrent=function(r){var n=this.plugin.state.getSnapshot(r==null?void 0:r.params);this.state.entries.size===0||!this.state.current?this.add(t.Entry(n,{name:r==null?void 0:r.name,description:r==null?void 0:r.description})):this.replace(this.state.current,n)},t.prototype.getStateSnapshot=function(r){return this.syncCurrent(r),{timestamp:+new Date,version:kR,name:r&&r.name,description:r&&r.description,current:this.state.current,playback:{isPlaying:!!(r&&r.playOnLoad),nextSnapshotDelayInMs:this.state.nextSnapshotDelayInMs},entries:this.state.entries.valueSeq().toArray()}},t.prototype.serialize=function(r){return ce(this,void 0,void 0,function(){var n,i,a,o,s,u,l,c,d,f,h,v,p,m,g;return de(this,function(y){switch(y.label){case 0:return n=JSON.stringify(this.getStateSnapshot({params:r==null?void 0:r.params}),null,2),!(r!=null&&r.type)||r.type==="json"||r.type==="molj"?[2,new Blob([n],{type:"application/json;charset=utf-8"})]:[3,1];case 1:i=new Uint8Array(rw(n)),hg(i,0,n),a={"state.json":i},o=[],s=0,u=this.plugin.managers.asset.assets,y.label=2;case 2:return s<u.length?(l=u[s],c=l.asset,d=l.file,o.push([c.id,c]),f=a,h="assets/"+c.id,v=Uint8Array.bind,[4,d.arrayBuffer()]):[3,5];case 3:f[h]=new(v.apply(Uint8Array,[void 0,y.sent()])),y.label=4;case 4:return s++,[3,2];case 5:return o.length>0&&(p=JSON.stringify(o,null,2),m=new Uint8Array(rw(p)),hg(m,0,p),a["assets.json"]=m),[4,this.plugin.runTask(gke(a))];case 6:return g=y.sent(),[2,new Blob([g],{type:"application/zip"})]}})})},t.prototype.open=function(r){return ce(this,void 0,void 0,function(){var n,i,g,i,a,o,s,u,l,c,d,f,h,v,p,m,g,y;return de(this,function(b){switch(b.label){case 0:return b.trys.push([0,8,,9]),n=r.name.toLowerCase(),n.endsWith("json")||n.endsWith("molj")?[4,this.plugin.runTask(Yf(r,"string"))]:[3,2];case 1:return i=b.sent(),g=JSON.parse(i),t.isStateSnapshot(g)?[2,this.setStateSnapshot(g)]:t.isStateSnapshot(g.data)?[2,this.setStateSnapshot(g.data)]:(this.plugin.state.setSnapshot(g),[3,7]);case 2:return[4,this.plugin.runTask(Yf(r,"zip"))];case 3:return i=b.sent(),a=Object.create(null),$u(i,function(S,x){if(!(x==="state.json"||x==="assets.json")){var C=x.substring(x.indexOf("/")+1);a[C]=new File([S],C)}}),o=new File([i["state.json"]],"state.json"),[4,this.plugin.runTask(Yf(o,"string"))];case 4:return s=b.sent(),i["assets.json"]?(u=new File([i["assets.json"]],"assets.json"),d=(c=JSON).parse,[4,this.plugin.runTask(Yf(u,"string"))]):[3,6];case 5:for(l=d.apply(c,[b.sent()]),f=0,h=l;f<h.length;f++)v=h[f],p=v[0],m=v[1],this.plugin.managers.asset.set(m,a[p]);b.label=6;case 6:return g=JSON.parse(s),[2,this.setStateSnapshot(g)];case 7:return[3,9];case 8:return y=b.sent(),this.plugin.log.error("Reading state: "+y),[3,9];case 9:return[2]}})})},t.prototype.play=function(r){if(r===void 0&&(r=!1),this.updateState({isPlaying:!0}),r){var n=this.getEntry(this.state.current);if(!n){this.next();return}this.events.changed.next();var i=n.snapshot,a=typeof i.durationInMs<"u"?i.durationInMs:this.state.nextSnapshotDelayInMs;this.timeoutHandle=setTimeout(this.next,a)}else this.next()},t.prototype.stop=function(){this.updateState({isPlaying:!1}),typeof this.timeoutHandle<"u"&&clearTimeout(this.timeoutHandle),this.timeoutHandle=void 0,this.events.changed.next()},t.prototype.togglePlay=function(){this.state.isPlaying?(this.stop(),this.plugin.managers.animation.stop()):this.play()},t.DefaultNextSnapshotDelayInMs=1500,t}(Wd);(function(e){function t(n,i){return E({timestamp:+new Date,snapshot:n},i)}e.Entry=t;function r(n){var i=n;return!!i&&!!i.timestamp&&!!i.entries}e.isStateSnapshot=r})(Ww||(Ww={}));function gtt(e){return e.toISOString().replace(/T/," ").replace(/\..+/,"")}function ytt(){var e=new Date,t=e.getFullYear(),r=e.getMonth()+1,n=e.getDate(),i=e.getHours(),a=e.getMinutes(),o=e.getSeconds();return t+"-"+r+"-"+n+"-"+i+"-"+a+"-"+o}function btt(e){var t=window.open(e,"_blank");t||(window.location.href=e)}function SH(e){try{e.dispatchEvent(new MouseEvent("click"))}catch{var t=document.createEvent("MouseEvents");t.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),e.dispatchEvent(t)}}function zne(e,t){if(t===void 0&&(t="download"),!!e)if("download"in HTMLAnchorElement.prototype){var r=document.createElement("a");r.download=t,r.rel="noopener",typeof e=="string"?(r.href=e,SH(r)):(r.href=URL.createObjectURL(e),setTimeout(function(){return URL.revokeObjectURL(r.href)},4e4),setTimeout(function(){return SH(r)}))}else if(typeof navigator<"u"&&navigator.msSaveOrOpenBlob)navigator.msSaveOrOpenBlob(e,t);else{var n=window.navigator.userAgent,i=/Safari/i.test(n),a=/CriOS\/[\d]+/.test(n),o=function(l){btt(a?l:l.replace(/^data:[^;]*;/,"data:attachment/file;"))};if((i||a)&&FileReader)if(e instanceof Blob){var s=new FileReader;s.onloadend=function(){return o(s.result)},s.readAsDataURL(e)}else o(e);else{var u=URL.createObjectURL(e);location.href=u,setTimeout(function(){return URL.revokeObjectURL(u)},4e4)}}}function wA(e,t){return""+e+(e[e.length-1]==="/"||t[0]==="/"?"":"/")+t}function An(){var e=function(t,r){return t.commands.dispatch(e,r||{})};return e.subscribe=function(t,r){return t.commands.subscribe(e,r)},e.id=bn.create22(),e}var xtt=function(){function e(){this.subs=new Map,this.disposing=!1}return e.prototype.subscribe=function(t,r){var n=this,i=this.subs.get(t.id);return i||(i=[],this.subs.set(t.id,i)),i.push(r),{unsubscribe:function(){var a=n.subs.get(t.id);if(a){var o=a.indexOf(r);if(!(o<0)){for(var s=o+1;s<a.length;s++)a[s-1]=a[s];a.pop()}}}}},e.prototype.dispatch=function(t,r){var n=this;return new Promise(function(i,a){if(n.disposing){a("disposed");return}var o=n.subs.get(t.id);if(!o){i();return}n.resolve({cmd:t,params:r,resolve:i,reject:a})})},e.prototype.dispose=function(){this.subs.clear()},e.prototype.resolve=function(t){return ce(this,void 0,void 0,function(){var r,n,i,a,o;return de(this,function(s){switch(s.label){case 0:if(r=this.subs.get(t.cmd.id),!r)return t.resolve(),[2];s.label=1;case 1:s.trys.push([1,6,,7]),n=0,i=r,s.label=2;case 2:return n<i.length?(a=i[n],[4,a(t.params)]):[3,5];case 3:s.sent(),s.label=4;case 4:return n++,[3,2];case 5:return t.resolve(),[3,7];case 6:return o=s.sent(),t.reject(o),[3,7];case 7:return[2]}})})},e}(),_t={State:{SetCurrentObject:An(),ApplyAction:An(),Update:An(),RemoveObject:An(),ToggleExpanded:An(),ToggleVisibility:An(),Snapshots:{Add:An(),Replace:An(),Move:An(),Remove:An(),Apply:An(),Clear:An(),Upload:An(),Fetch:An(),DownloadToFile:An(),OpenFile:An(),OpenUrl:An()}},Interactivity:{Object:{Highlight:An()},Structure:{Highlight:An(),Select:An()},ClearHighlights:An()},Layout:{Update:An()},Toast:{Show:An(),Hide:An()},Camera:{Reset:An(),SetSnapshot:An(),Focus:An()},Canvas3D:{SetSettings:An(),ResetSettings:An()}};function Stt(e){Vne(e),Hne(e),Gne(e),qne(e),$ne(e),Wne(e),Xne(e),Yne(e),Kne(e),Qne(e)}function Vne(e){e.state.events.object.created.subscribe(function(t){ge.isBehavior(t.obj)&&t.obj.data.register(t.ref)}),e.state.events.object.removed.subscribe(function(t){ge.isBehavior(t.obj)&&t.obj.data.unregister()}),e.state.events.object.updated.subscribe(function(t){t.action==="recreate"&&(t.oldObj&&ge.isBehavior(t.oldObj)&&t.oldObj.data.unregister(),t.obj&&ge.isBehavior(t.obj)&&t.obj.data.register(t.ref))})}function Hne(e){_t.State.SetCurrentObject.subscribe(e,function(t){var r=t.state,n=t.ref;return r.setCurrent(n)})}function Gne(e){_t.State.Update.subscribe(e,function(t){var r=t.state,n=t.tree,i=t.options;return e.runTask(r.updateTree(n,i))})}function qne(e){_t.State.ApplyAction.subscribe(e,function(t){var r=t.state,n=t.action,i=t.ref;return e.runTask(r.applyAction(n.action,n.params,i))})}function $ne(e){function t(r,n){var i=r.build().delete(n);return e.runTask(r.updateTree(i))}_t.State.RemoveObject.subscribe(e,function(r){var n=r.state,i=r.ref,a=r.removeParentGhosts;if(a){var o=n.tree,s=o.transforms.get(i);if(s.parent===i)return t(n,i);for(;;){var u=o.children.get(s.parent);if(s.parent===s.ref||u.size>1)return t(n,s.ref);var l=o.transforms.get(s.parent);if(!l.state.isGhost)return t(n,s.ref);s=l}}else return t(n,i)})}function Wne(e){_t.State.ToggleExpanded.subscribe(e,function(t){var r=t.state,n=t.ref;return r.updateCellState(n,function(i){var a=i.isCollapsed;return{isCollapsed:!a}})})}function Xne(e){_t.State.ToggleVisibility.subscribe(e,function(t){var r=t.state,n=t.ref;return jv(r,n,!r.cells.get(n).state.isHidden)})}function jv(e,t,r){fi.doPreOrder(e.tree,e.transforms.get(t),{state:e,value:r},Ctt)}function Ctt(e,t,r){r.state.updateCellState(e.ref,{isHidden:r.value})}function Yne(e){_t.Interactivity.Object.Highlight.subscribe(e,function(t){var r=t.state,n=t.ref;if(!(!e.canvas3d||e.isBusy)){e.managers.interactivity.lociHighlights.clearHighlights();for(var i=typeof n=="string"?[n]:n,a=0,o=i;a<o.length;a++){var s=o[a],u=r.cells.get(s);if(u){if(ge.Molecule.Structure.is(u.obj))e.managers.interactivity.lociHighlights.highlight({loci:We.Loci(u.obj.data)},!1);else if(u&&ge.isRepresentation3D(u.obj)){var l=u.obj.data.repr;e.managers.interactivity.lociHighlights.highlight({loci:l.getLoci(),repr:l},!1)}else if(ge.Molecule.Structure.Selections.is(u.obj))for(var c=0,d=u.obj.data;c<d.length;c++){var f=d[c];e.managers.interactivity.lociHighlights.highlight({loci:f.loci},!1)}}}}})}function Kne(e){_t.Interactivity.ClearHighlights.subscribe(e,function(){e.managers.interactivity.lociHighlights.clearHighlights()})}function Qne(e){var t=this;e.config.set(Zr.State.CurrentServer,e.config.get(Zr.State.DefaultServer)),_t.State.Snapshots.Clear.subscribe(e,function(){e.managers.snapshot.clear()}),_t.State.Snapshots.Remove.subscribe(e,function(r){var n=r.id;e.managers.snapshot.remove(n)}),_t.State.Snapshots.Add.subscribe(e,function(r){var n=r.name,i=r.description,a=r.params,o=Ww.Entry(e.state.getSnapshot(a),{name:n,description:i});e.managers.snapshot.add(o)}),_t.State.Snapshots.Replace.subscribe(e,function(r){var n=r.id,i=r.params;e.managers.snapshot.replace(n,e.state.getSnapshot(i))}),_t.State.Snapshots.Move.subscribe(e,function(r){var n=r.id,i=r.dir;e.managers.snapshot.move(n,i)}),_t.State.Snapshots.Apply.subscribe(e,function(r){var n=r.id,i=e.managers.snapshot.setCurrent(n);if(i)return e.state.setSnapshot(i)}),_t.State.Snapshots.Upload.subscribe(e,function(r){var n=r.name,i=r.description,a=r.playOnLoad,o=r.serverUrl;return r.params,fetch(wA(o,"set?name="+encodeURIComponent(n||"")+"&description="+encodeURIComponent(i||"")),{method:"POST",mode:"cors",referrer:"no-referrer",headers:{"Content-Type":"application/json; charset=utf-8"},body:JSON.stringify(e.managers.snapshot.getStateSnapshot({name:n,description:i,playOnLoad:a}))})}),_t.State.Snapshots.Fetch.subscribe(e,function(r){var n=r.url;return ce(t,void 0,void 0,function(){var i;return de(this,function(a){switch(a.label){case 0:return[4,e.runTask(e.fetch({url:n,type:"json"}))];case 1:return i=a.sent(),[4,e.managers.snapshot.setStateSnapshot(i.data)];case 2:return a.sent(),[2]}})})}),_t.State.Snapshots.DownloadToFile.subscribe(e,function(r){var n=r.name,i=r.type,a=r.params;return ce(t,void 0,void 0,function(){var o,s;return de(this,function(u){switch(u.label){case 0:return o="mol-star_state_"+(n||ytt())+"."+(i==="json"?"molj":"molx"),[4,e.managers.snapshot.serialize({type:i,params:a})];case 1:return s=u.sent(),zne(s,""+o),[2]}})})}),_t.State.Snapshots.OpenFile.subscribe(e,function(r){var n=r.file;return e.managers.snapshot.open(n)}),_t.State.Snapshots.OpenUrl.subscribe(e,function(r){var n=r.url,i=r.type;return ce(t,void 0,void 0,function(){var a;return de(this,function(o){switch(o.label){case 0:return[4,e.runTask(e.fetch({url:n,type:"binary"}))];case 1:return a=o.sent(),[2,e.managers.snapshot.open(new File([a],"state."+i))]}})})})}const _tt=Object.freeze(Object.defineProperty({__proto__:null,ApplyAction:qne,ClearHighlights:Kne,Highlight:Yne,RemoveObject:$ne,SetCurrentObject:Hne,Snapshots:Qne,SyncBehaviors:Vne,ToggleExpanded:Wne,ToggleVisibility:Xne,Update:Gne,registerDefault:Stt,setSubtreeVisibility:jv},Symbol.toStringTag,{value:"Module"}));function wtt(e){Zne(e),Jne(e),eie(e)}function Zne(e){var t=e.state.data.events;t.object.created.subscribe(function(r){var n;ge.isRepresentation3D(r.obj)&&(OR(r.state.cells.get(r.ref),r.obj.data.repr),r.obj.data.repr.setState({syncManually:!0}),(n=e.canvas3d)===null||n===void 0||n.add(r.obj.data.repr))}),t.object.updated.subscribe(function(r){var n,i;r.oldObj&&ge.isRepresentation3D(r.oldObj)&&((n=e.canvas3d)===null||n===void 0||n.remove(r.oldObj.data.repr),r.oldObj.data.repr.destroy()),ge.isRepresentation3D(r.obj)&&(OR(r.state.cells.get(r.ref),r.obj.data.repr),r.action==="recreate"&&r.obj.data.repr.setState({syncManually:!0}),(i=e.canvas3d)===null||i===void 0||i.add(r.obj.data.repr))}),t.object.removed.subscribe(function(r){var n;ge.isRepresentation3D(r.obj)&&((n=e.canvas3d)===null||n===void 0||n.remove(r.obj.data.repr),r.obj.data.repr.destroy())})}function Jne(e){var t=e.state.data.events;t.object.created.subscribe(function(r){var n;if(ge.Molecule.Structure.Representation3DState.is(r.obj)){var i=r.obj.data;i.repr.setState(i.state),(n=e.canvas3d)===null||n===void 0||n.update(i.repr)}}),t.object.updated.subscribe(function(r){var n;if(ge.Molecule.Structure.Representation3DState.is(r.obj)){var i=r.obj.data;i.repr.setState(i.state),(n=e.canvas3d)===null||n===void 0||n.update(i.repr)}}),t.object.removed.subscribe(function(r){var n;if(ge.Molecule.Structure.Representation3DState.is(r.obj)){var i=r.obj.data;i.repr.setState(i.initialState),(n=e.canvas3d)===null||n===void 0||n.update(i.repr)}})}function eie(e){e.state.data.events.cell.stateUpdated.subscribe(function(t){var r,n=t.state.cells.get(t.ref);ge.isRepresentation3D(n.obj)&&OR(n,n.obj.data.repr)&&((r=e.canvas3d)===null||r===void 0||r.syncVisibility())})}function OR(e,t){return t.state.visible===e.state.isHidden?(t.setState({visible:!e.state.isHidden}),!0):!1}const Ett=Object.freeze(Object.defineProperty({__proto__:null,SyncRepresentationToCanvas:Zne,SyncStructureRepresentation3DState:Jne,UpdateRepresentationVisibility:eie,registerDefault:wtt},Symbol.toStringTag,{value:"Module"}));function Att(e){tie(e),nie(e),rie(e)}function tie(e){_t.Camera.Reset.subscribe(e,function(t){e.managers.camera.reset(t==null?void 0:t.snapshot,t==null?void 0:t.durationMs)})}function rie(e){_t.Camera.SetSnapshot.subscribe(e,function(t){var r=t.snapshot,n=t.durationMs;e.managers.camera.setSnapshot(r,n)})}function nie(e){_t.Camera.Focus.subscribe(e,function(t){var r=t.center,n=t.radius,i=t.durationMs;e.managers.camera.focusSphere({center:r,radius:n},{durationMs:i}),e.events.canvas3d.settingsUpdated.next()})}const Ptt=Object.freeze(Object.defineProperty({__proto__:null,Focus:nie,Reset:tie,SetSnapshot:rie,registerDefault:Att},Symbol.toStringTag,{value:"Module"}));function qp(e){if(typeof e=="object"){if("buttons"in e)return e.buttons;if("which"in e){var t=e.which;if(t===2)return 4;if(t===3)return 2;if(t>0)return 1<<t-1}}return 0}function bg(e){if(typeof e=="object"&&"button"in e){var t=e.button;if(t===1)return 4;if(t===2)return 2;if(t>=0)return 1<<t}return 0}function vS(e){return{alt:"altKey"in e?e.altKey:!1,shift:"shiftKey"in e?e.shiftKey:!1,control:"ctrlKey"in e?e.ctrlKey:!1,meta:"metaKey"in e?e.metaKey:!1}}var CH={noScroll:!0,noMiddleClickScroll:!0,noContextMenu:!0,noPinchZoom:!0,noTextSelect:!0,mask:function(e,t){return!0},pixelScale:1},Uu;(function(e){e.None=n();function t(i,a){return i.shift===a.shift&&i.alt===a.alt&&i.control===a.control&&i.meta===a.meta}e.areEqual=t;function r(i){if(!i)return 0;var a=0;return i.shift&&a++,i.alt&&a++,i.control&&a++,i.meta&&a++,a}e.size=r;function n(i){return i===void 0&&(i={}),{shift:!!i.shift,alt:!!i.alt,control:!!i.control,meta:!!i.meta}}e.create=n})(Uu||(Uu={}));var zv;(function(e){e.has=_a.has,e.create=_a.create})(zv||(zv={}));function _H(){return{drag:new ai,interactionEnd:new ai,click:new ai,move:new ai,wheel:new ai,pinch:new ai,resize:new ai,leave:new ai,enter:new ai,modifiers:new ai,key:new ai}}var Ttt=["Backspace","Delete"],FR;(function(e){function t(n){n===void 0&&(n={});var i=E(E({},CH),n),a=i.noScroll,o=i.noContextMenu;return E(E({noScroll:a,noContextMenu:o,width:0,height:0,pixelRatio:1},_H()),{dispose:Lf})}e.create=t;function r(n,i){i===void 0&&(i={});var a=E(E({},CH),i),o=a.noScroll,s=a.noMiddleClickScroll,u=a.noContextMenu,l=a.noPinchZoom,c=a.noTextSelect,d=a.mask,f=a.pixelScale,h=n.clientWidth*C(),v=n.clientHeight*C(),p=0,m=He(),g=He(),y=He(),b=He(),S=He(),x={shift:!1,alt:!1,control:!1,meta:!1};function C(){return window.devicePixelRatio*f}function w(){return E({},x)}var A=0,M=!1,D=zv.create(0),k=0,R=!1,O=_H(),H=O.drag,B=O.interactionEnd,j=O.wheel,Y=O.pinch,G=O.click,$=O.move,q=O.leave,ee=O.enter,fe=O.resize,W=O.modifiers,X=O.key;return U(),E(E({get noScroll(){return o},set noScroll(ke){o=ke},get noContextMenu(){return u},set noContextMenu(ke){u=ke},get width(){return h},get height(){return v},get pixelRatio(){return C()}},O),{dispose:z});function U(){n.addEventListener("contextmenu",J,!1),n.addEventListener("wheel",Xe,!1),n.addEventListener("mousedown",F,!1),window.addEventListener("mousemove",V,!1),window.addEventListener("mouseup",pe,!1),n.addEventListener("mouseenter",ct,!1),n.addEventListener("mouseleave",Ne,!1),n.addEventListener("touchstart",Se,!1),n.addEventListener("touchmove",oe,!1),n.addEventListener("touchend",ie,!1),window.addEventListener("blur",Z),window.addEventListener("keyup",le,!1),window.addEventListener("keydown",te,!1),window.addEventListener("keypress",ye,!1),window.addEventListener("resize",Qe,!1)}function z(){M||(M=!0,n.removeEventListener("contextmenu",J,!1),n.removeEventListener("wheel",Xe,!1),n.removeEventListener("mousedown",F,!1),window.removeEventListener("mousemove",V,!1),window.removeEventListener("mouseup",pe,!1),n.removeEventListener("mouseenter",ct,!1),n.removeEventListener("mouseleave",Ne,!1),n.removeEventListener("touchstart",Se,!1),n.removeEventListener("touchmove",oe,!1),n.removeEventListener("touchend",ie,!1),window.removeEventListener("blur",Z),window.removeEventListener("keyup",le,!1),window.removeEventListener("keydown",te,!1),window.removeEventListener("keypress",ye,!1),window.removeEventListener("resize",Qe,!1))}function J(ke){d(ke.clientX,ke.clientY)&&u&&ke.preventDefault()}function K(ke){x.alt=ke.altKey,x.shift=ke.shiftKey,x.control=ke.ctrlKey,x.meta=ke.metaKey}function Z(){(D||x.shift||x.alt||x.meta||x.control)&&(D=0,x.shift=x.alt=x.control=x.meta=!1)}function te(ke){var Me=!1;!x.alt&&ke.altKey&&(Me=!0,x.alt=!0),!x.shift&&ke.shiftKey&&(Me=!0,x.shift=!0),!x.control&&ke.ctrlKey&&(Me=!0,x.control=!0),!x.meta&&ke.metaKey&&(Me=!0,x.meta=!0),Me&&R&&W.next(w())}function le(ke){var Me=!1;x.alt&&!ke.altKey&&(Me=!0,x.alt=!1),x.shift&&!ke.shiftKey&&(Me=!0,x.shift=!1),x.control&&!ke.ctrlKey&&(Me=!0,x.control=!1),x.meta&&!ke.metaKey&&(Me=!0,x.meta=!1),Me&&R&&W.next(w()),Ttt.includes(ke.key)&&ye(ke)}function ye(ke){X.next({key:ke.key,modifiers:w()})}function be(ke){var Me=ke.touches[0],Ye=ke.touches[1];return{clientX:(Me.clientX+Ye.clientX)/2,clientY:(Me.clientY+Ye.clientY)/2,pageX:(Me.pageX+Ye.pageX)/2,pageY:(Me.pageY+Ye.pageY)/2}}function Ae(ke){var Me=ke.touches[0].pageX-ke.touches[1].pageX,Ye=ke.touches[0].pageY-ke.touches[1].pageY;return Math.sqrt(Me*Me+Ye*Ye)}function Se(ke){if(ke.touches.length===1)D=k=1,Te(ke.touches[0]);else if(ke.touches.length===2){D=0,k=2,Te(be(ke));var Me=Ae(ke);p=Me,Y.next({distance:Me,fraction:1,delta:0,isStart:!0,buttons:D,button:k,modifiers:w()})}else ke.touches.length===3&&(D=k=8,Te(be(ke)))}function ie(ke){we()}function oe(ke){if(k=0,l&&(ke.preventDefault(),ke.stopPropagation(),ke.originalEvent&&(ke.originalEvent.preventDefault(),ke.originalEvent.stopPropagation())),ke.touches.length===1)D=1,Ve(ke.touches[0]);else if(ke.touches.length===2){var Me=Ae(ke),Ye=p-Me;Math.abs(Ye)<4?(D=2,Ve(be(ke))):(D=4,K(ke),Y.next({delta:Ye,fraction:p/Me,distance:Me,isStart:!1,buttons:D,button:k,modifiers:w()})),p=Me}else ke.touches.length===3&&(D=8,Ve(be(ke)))}function F(ke){K(ke),D=qp(ke),k=bg(ke),s&&D===4&&ke.preventDefault,Te(ke)}function V(ke){K(ke),D=qp(ke),k=0,Ve(ke)}function pe(ke){K(ke),D=qp(ke),k=bg(ke),ze(ke),we()}function we(){B.next()}function Te(ke){d(ke.clientX,ke.clientY)&&(dt(g,ke),He.copy(m,g),it(g)&&(A=1))}function ze(ke){if(A=0,!!d(ke.clientX,ke.clientY)&&(dt(y,ke),He.distance(y,m)<4)){var Me=ke.pageX,Ye=ke.pageY,tt=y[0],xt=y[1];G.next({x:tt,y:xt,pageX:Me,pageY:Ye,buttons:D,button:k,modifiers:w()})}}function Ve(ke){var Me;dt(y,ke);var Ye=ke.pageX,tt=ke.pageY,xt=y[0],pt=y[1],ut=it(y);if($.next({x:xt,y:pt,pageX:Ye,pageY:tt,buttons:D,button:k,modifiers:w(),inside:ut}),A!==0&&(c&&((Me=ke.preventDefault)===null||Me===void 0||Me.call(ke)),He.div(b,He.sub(b,y,g),ot(S)),!(He.magnitude(b)<_n))){var he=A===1;if(!(he&&!d(ke.clientX,ke.clientY))){var me=b[0],Ee=b[1];H.next({x:xt,y:pt,dx:me,dy:Ee,pageX:Ye,pageY:tt,buttons:D,button:k,modifiers:w(),isStart:he}),He.copy(g,y),A=2}}}function Xe(ke){if(d(ke.clientX,ke.clientY)){dt(y,ke);var Me=ke.pageX,Ye=ke.pageY,tt=y[0],xt=y[1];o&&ke.preventDefault();var pt=1;switch(ke.deltaMode){case 0:pt=1;break;case 1:pt=40;break;case 2:pt=800;break}var ut=(ke.deltaX||0)*pt,he=(ke.deltaY||0)*pt,me=(ke.deltaZ||0)*pt;D=k=4,(ut||he||me)&&j.next({x:tt,y:xt,pageX:Me,pageY:Ye,dx:ut,dy:he,dz:me,buttons:D,button:k,modifiers:w()})}}function ct(ke){R=!0,ee.next()}function Ne(ke){R=!1,q.next()}function Qe(ke){fe.next()}function it(ke){if(n instanceof Window||n instanceof Document||n===document.body)return!0;var Me=n.getBoundingClientRect();return ke[0]>=0&&ke[1]>=0&&ke[0]<Me.width&&ke[1]<Me.height}function ot(ke){return ke[0]=n.clientWidth,ke[1]=n.clientHeight,ke}function dt(ke,Me){h=n.clientWidth*C(),v=n.clientHeight*C();var Ye=Me.clientX||0,tt=Me.clientY||0,xt=n.getBoundingClientRect();return ke[0]=Ye-xt.left,ke[1]=tt-xt.top,ke}}e.fromElement=r})(FR||(FR={}));function Qi(){return Qi.zero()}(function(e){function t(){return{x:0,y:0,width:0,height:0}}e.zero=t;function r(u,l,c,d){return{x:u,y:l,width:c,height:d}}e.create=r;function n(u){return E({},u)}e.clone=n;function i(u,l){return Object.assign(u,l)}e.copy=i;function a(u,l,c,d,f){return u.x=l,u.y=c,u.width=d,u.height=f,u}e.set=a;function o(u,l){return u[0]=l.x,u[1]=l.y,u[2]=l.width,u[3]=l.height,u}e.toVec4=o;function s(u,l){return u.x===l.x&&u.y===l.y&&u.width===l.width&&u.height===l.height}e.equals=s})(Qi||(Qi={}));var wH=0,EH=1,cl=Ir();function Itt(e,t,r,n){var i=r.x,a=r.y,o=r.width,s=r.height;Ir.set(cl,t[0],t[1],t[2],1),Ir.transformMat4(cl,cl,n);var u=cl[3];return u!==0&&(cl[0]/=u,cl[1]/=u,cl[2]/=u),e[0]=i+o/2*cl[0]+(0+o/2),e[1]=a+s/2*cl[1]+(0+s/2),e[2]=(EH-wH)/2*cl[2]+(EH+wH)/2,e[3]=u===0?0:1/u,e}function TC(e,t,r,n){var i=r.x,a=r.y,o=r.width,s=r.height,u=t[0]-i,l=s-t[1]-1-a,c=t[2];return e[0]=2*u/o-1,e[1]=2*l/s-1,e[2]=2*c-1,_.transformMat4(e,e,n)}var LR={backgroundColor:I.Color(at(0),{description:"Background color of the 3D canvas"}),pickingAlphaThreshold:I.Numeric(.5,{min:0,max:1,step:.01},{description:"The minimum opacity value needed for an object to be pickable."}),interiorDarkening:I.Numeric(.5,{min:0,max:1,step:.01}),interiorColorFlag:I.Boolean(!0,{label:"Use Interior Color"}),interiorColor:I.Color(at.fromNormalizedRgb(.3,.3,.3)),highlightColor:I.Color(at.fromNormalizedRgb(1,.4,.6)),selectColor:I.Color(at.fromNormalizedRgb(.2,1,.1)),xrayEdgeFalloff:I.Numeric(1,{min:0,max:3,step:.1}),style:I.MappedStatic("matte",{custom:I.Group({lightIntensity:I.Numeric(.6,{min:0,max:1,step:.01}),ambientIntensity:I.Numeric(.4,{min:0,max:1,step:.01}),metalness:I.Numeric(0,{min:0,max:1,step:.01}),roughness:I.Numeric(1,{min:0,max:1,step:.01}),reflectivity:I.Numeric(.5,{min:0,max:1,step:.01})},{isExpanded:!0}),flat:I.Group({}),matte:I.Group({}),glossy:I.Group({}),metallic:I.Group({}),plastic:I.Group({})},{label:"Lighting",description:"Style in which the 3D scene is rendered/lighted"}),clip:I.Group({variant:I.Select("instance",I.arrayToOptions(["instance","pixel"])),objects:I.ObjectList({type:I.Select("plane",I.objectToOptions(ln.Type,function(e){return is(e)})),invert:I.Boolean(!1),position:I.Vec3(_()),rotation:I.Group({axis:I.Vec3(_.create(1,0,0)),angle:I.Numeric(0,{min:-180,max:180,step:1},{description:"Angle in Degrees"})},{isExpanded:!0}),scale:I.Vec3(_.create(1,1,1))},function(e){return is(e.type)})})};function AH(e){switch(e.name){case"custom":return e.params;case"flat":return{lightIntensity:0,ambientIntensity:1,metalness:0,roughness:.4,reflectivity:.5};case"matte":return{lightIntensity:.7,ambientIntensity:.3,metalness:0,roughness:1,reflectivity:.5};case"glossy":return{lightIntensity:.7,ambientIntensity:.3,metalness:0,roughness:.4,reflectivity:.5};case"metallic":return{lightIntensity:.7,ambientIntensity:.7,metalness:.6,roughness:.6,reflectivity:.5};case"plastic":return{lightIntensity:.7,ambientIntensity:.3,metalness:0,roughness:.2,reflectivity:.5}}}var Mtt=Xn();function PH(e,t){for(var r=(t==null?void 0:t.objects)||{type:new Array(5).fill(1),invert:new Array(5).fill(!1),position:new Array(15).fill(0),rotation:new Array(20).fill(0),scale:new Array(15).fill(1)},n=r.type,i=r.invert,a=r.position,o=r.rotation,s=r.scale,u=0,l=e.objects.length;u<l;++u){var c=e.objects[u];n[u]=ln.Type[c.type],i[u]=c.invert,_.toArray(c.position,a,u*3),Xn.toArray(Xn.setAxisAngle(Mtt,c.rotation.axis,Jr(c.rotation.angle)),o,u*4),_.toArray(c.scale,s,u*3)}return{variant:e.variant,objects:{count:e.objects.length,type:n,invert:i,position:a,rotation:o,scale:s}}}var NR;(function(e){function t(r,n){n===void 0&&(n={});var i=r.gl,a=r.state,o=r.stats,s=r.extensions.fragDepth,u=I.merge(LR,I.getDefaultValues(LR),n),l=AH(u.style),c=PH(u.clip),d=Qi(),f=He.create(i.drawingBufferWidth,i.drawingBufferHeight),h=at.toVec3Normalized(_(),u.backgroundColor),v=!1,p=nA(i),m=[["tDepth",p]],g=ue(),y=ue(),b=ue(),S=ue(),x=ue(),C=ue(),w=ue(),A=_(),M=He(),D={uModel:L.create(ue.identity()),uView:L.create(g),uInvView:L.create(y),uModelView:L.create(b),uInvModelView:L.create(S),uInvProjection:L.create(x),uProjection:L.create(ue()),uModelViewProjection:L.create(C),uInvModelViewProjection:L.create(w),uIsOrtho:L.create(1),uViewOffset:L.create(M),uPixelRatio:L.create(r.pixelRatio),uViewportHeight:L.create(d.height),uViewport:L.create(Qi.toVec4(Ir(),d)),uDrawingBufferSize:L.create(f),uCameraPosition:L.create(_()),uCameraDir:L.create(A),uNear:L.create(1),uFar:L.create(1e4),uFogNear:L.create(1),uFogFar:L.create(1e4),uFogColor:L.create(h),uRenderWboit:L.create(!1),uTransparentBackground:L.create(!1),uClipObjectType:L.create(c.objects.type),uClipObjectInvert:L.create(c.objects.invert),uClipObjectPosition:L.create(c.objects.position),uClipObjectRotation:L.create(c.objects.rotation),uClipObjectScale:L.create(c.objects.scale),uLightIntensity:L.create(l.lightIntensity),uAmbientIntensity:L.create(l.ambientIntensity),uMetalness:L.create(l.metalness),uRoughness:L.create(l.roughness),uReflectivity:L.create(l.reflectivity),uPickingAlphaThreshold:L.create(u.pickingAlphaThreshold),uInteriorDarkening:L.create(u.interiorDarkening),uInteriorColorFlag:L.create(u.interiorColorFlag),uInteriorColor:L.create(at.toVec3Normalized(_(),u.interiorColor)),uHighlightColor:L.create(at.toVec3Normalized(_(),u.highlightColor)),uSelectColor:L.create(at.toVec3Normalized(_(),u.selectColor)),uXrayEdgeFalloff:L.create(u.xrayEdgeFalloff)},k=Object.entries(D),R=!0,O=function(U,z){if(!(U.state.disposed||!U.state.visible||!U.state.pickable&&z[0]==="p")){var J=!1;U.state.noClip?U.values.dClipObjectCount.ref.value!==0&&(L.update(U.values.dClipObjectCount,0),J=!0):(U.values.dClipObjectCount.ref.value!==c.objects.count&&(L.update(U.values.dClipObjectCount,c.objects.count),J=!0),U.values.dClipVariant.ref.value!==c.variant&&(L.update(U.values.dClipVariant,c.variant),J=!0)),J&&U.update();var K=U.getProgram(z);a.currentProgramId!==K.id&&(R=!0,K.use()),R&&(K.setUniforms(k),R=!1),U.values.dRenderMode?(a.disable(i.CULL_FACE),a.frontFace(i.CCW),z==="colorBlended"&&(U.values.dRenderMode.ref.value==="volume"||!s?(a.disable(i.DEPTH_TEST),a.depthMask(!1)):(a.enable(i.DEPTH_TEST),a.depthMask(U.values.uAlpha.ref.value===1)))):(U.values.dDoubleSided?U.values.dDoubleSided.ref.value||U.values.hasReflection.ref.value?a.disable(i.CULL_FACE):a.enable(i.CULL_FACE):a.disable(i.CULL_FACE),U.values.dFlipSided&&U.values.dFlipSided.ref.value?(a.frontFace(i.CW),a.cullFace(i.FRONT)):(a.frontFace(i.CCW),a.cullFace(i.BACK))),U.render(z,m)}},H=function(U){L.update(D.uView,U.view),L.update(D.uInvView,ue.invert(y,U.view)),L.update(D.uProjection,U.projection),L.update(D.uInvProjection,ue.invert(x,U.projection)),L.updateIfChanged(D.uIsOrtho,U.state.mode==="orthographic"?1:0),L.update(D.uViewOffset,U.viewOffset.enabled?He.set(M,U.viewOffset.offsetX*16,U.viewOffset.offsetY*16):He.set(M,0,0)),L.update(D.uCameraPosition,U.state.position),L.update(D.uCameraDir,_.normalize(A,_.sub(A,U.state.target,U.state.position))),L.updateIfChanged(D.uFar,U.far),L.updateIfChanged(D.uNear,U.near),L.updateIfChanged(D.uFogFar,U.fogFar),L.updateIfChanged(D.uFogNear,U.fogNear),L.updateIfChanged(D.uTransparentBackground,v)},B=function(U,z,J,K){kke(m,"tDepth",J||p),L.update(D.uModel,U.view),L.update(D.uModelView,ue.mul(b,U.view,z.view)),L.update(D.uInvModelView,ue.invert(S,b)),L.update(D.uModelViewProjection,ue.mul(C,b,z.projection)),L.update(D.uInvModelViewProjection,ue.invert(w,C)),L.updateIfChanged(D.uRenderWboit,K),a.enable(i.SCISSOR_TEST),a.colorMask(!0,!0,!0,!0);var Z=d.x,te=d.y,le=d.width,ye=d.height;i.viewport(Z,te,le,ye),i.scissor(Z,te,le,ye),R=!0,a.currentRenderItemId=-1},j=function(U,z,J,K){a.disable(i.BLEND),a.enable(i.DEPTH_TEST),a.depthMask(!0),B(U,z,K,!1);for(var Z=U.renderables,te=0,le=Z.length;te<le;++te)Z[te].state.colorOnly||O(Z[te],J)},Y=function(U,z,J){a.disable(i.BLEND),a.enable(i.DEPTH_TEST),a.depthMask(!0),B(U,z,J,!1);for(var K=U.renderables,Z=0,te=K.length;Z<te;++Z)O(K[Z],"depth")},G=function(U,z,J){$(U,z,J),q(U,z,J)},$=function(U,z,J){a.disable(i.BLEND),a.enable(i.DEPTH_TEST),a.depthMask(!0),B(U,z,J,!1);for(var K=U.renderables,Z=0,te=K.length;Z<te;++Z){var le=K[Z];le.state.opaque&&O(le,"colorBlended")}},q=function(U,z,J){a.enable(i.DEPTH_TEST),B(U,z,J,!1);var K=U.renderables;v?a.blendFunc(i.ONE,i.ONE_MINUS_SRC_ALPHA):a.blendFuncSeparate(i.SRC_ALPHA,i.ONE_MINUS_SRC_ALPHA,i.ONE,i.ONE_MINUS_SRC_ALPHA),a.enable(i.BLEND),a.depthMask(!0);for(var Z=0,te=K.length;Z<te;++Z){var le=K[Z];!le.state.opaque&&le.state.writeDepth&&O(le,"colorBlended")}a.depthMask(!1);for(var Z=0,te=K.length;Z<te;++Z){var le=K[Z];!le.state.opaque&&!le.state.writeDepth&&O(le,"colorBlended")}},ee=function(U,z,J){var K;a.blendFunc(i.ONE,i.ONE_MINUS_SRC_ALPHA),a.enable(i.BLEND),B(U,z,J,!1);for(var Z=U.renderables,te=0,le=Z.length;te<le;++te){var ye=Z[te],be=Va(ye.values.alpha.ref.value*ye.state.alphaFactor,0,1);be===1&&ye.values.transparencyAverage.ref.value!==1&&!(!((K=ye.values.dXrayShaded)===null||K===void 0)&&K.ref.value)&&O(ye,"colorBlended")}},fe=function(U,z,J){var K;a.blendFunc(i.ONE,i.ONE_MINUS_SRC_ALPHA),a.enable(i.BLEND),B(U,z,J,!1);for(var Z=U.renderables,te=0,le=Z.length;te<le;++te){var ye=Z[te],be=Va(ye.values.alpha.ref.value*ye.state.alphaFactor,0,1);(be<1||ye.values.transparencyAverage.ref.value>0||!((K=ye.values.dXrayShaded)===null||K===void 0)&&K.ref.value)&&O(ye,"colorBlended")}},W=function(U,z,J){var K,Z,te;a.disable(i.BLEND),a.enable(i.DEPTH_TEST),a.depthMask(!0),B(U,z,J,!1);for(var le=U.renderables,ye=0,be=le.length;ye<be;++ye){var Ae=le[ye],Se=Va(Ae.values.alpha.ref.value*Ae.state.alphaFactor,0,1);Se===1&&Ae.values.transparencyAverage.ref.value!==1&&((K=Ae.values.dRenderMode)===null||K===void 0?void 0:K.ref.value)!=="volume"&&!(!((Z=Ae.values.dPointFilledCircle)===null||Z===void 0)&&Z.ref.value)&&!(!((te=Ae.values.dXrayShaded)===null||te===void 0)&&te.ref.value)&&O(Ae,"colorWboit")}},X=function(U,z,J){var K,Z,te;B(U,z,J,!0);for(var le=U.renderables,ye=0,be=le.length;ye<be;++ye){var Ae=le[ye],Se=Va(Ae.values.alpha.ref.value*Ae.state.alphaFactor,0,1);(Se<1||Ae.values.transparencyAverage.ref.value>0||((K=Ae.values.dRenderMode)===null||K===void 0?void 0:K.ref.value)==="volume"||!((Z=Ae.values.dPointFilledCircle)===null||Z===void 0)&&Z.ref.value||Ae.values.uBackgroundColor||!((te=Ae.values.dXrayShaded)===null||te===void 0)&&te.ref.value)&&O(Ae,"colorWboit")}};return{clear:function(U){a.enable(i.SCISSOR_TEST),a.enable(i.DEPTH_TEST),a.colorMask(!0,!0,!0,!0),a.depthMask(!0),v?a.clearColor(0,0,0,0):U?a.clearColor(h[0],h[1],h[2],1):a.clearColor(1,1,1,1),i.clear(i.COLOR_BUFFER_BIT|i.DEPTH_BUFFER_BIT)},clearDepth:function(){a.enable(i.SCISSOR_TEST),a.enable(i.DEPTH_TEST),a.depthMask(!0),i.clear(i.DEPTH_BUFFER_BIT)},update:H,renderPick:j,renderDepth:Y,renderBlended:G,renderBlendedOpaque:$,renderBlendedTransparent:q,renderBlendedVolumeOpaque:ee,renderBlendedVolumeTransparent:fe,renderWboitOpaque:W,renderWboitTransparent:X,setProps:function(U){U.backgroundColor!==void 0&&U.backgroundColor!==u.backgroundColor&&(u.backgroundColor=U.backgroundColor,at.toVec3Normalized(h,u.backgroundColor),L.update(D.uFogColor,_.copy(D.uFogColor.ref.value,h))),U.pickingAlphaThreshold!==void 0&&U.pickingAlphaThreshold!==u.pickingAlphaThreshold&&(u.pickingAlphaThreshold=U.pickingAlphaThreshold,L.update(D.uPickingAlphaThreshold,u.pickingAlphaThreshold)),U.interiorDarkening!==void 0&&U.interiorDarkening!==u.interiorDarkening&&(u.interiorDarkening=U.interiorDarkening,L.update(D.uInteriorDarkening,u.interiorDarkening)),U.interiorColorFlag!==void 0&&U.interiorColorFlag!==u.interiorColorFlag&&(u.interiorColorFlag=U.interiorColorFlag,L.update(D.uInteriorColorFlag,u.interiorColorFlag)),U.interiorColor!==void 0&&U.interiorColor!==u.interiorColor&&(u.interiorColor=U.interiorColor,L.update(D.uInteriorColor,at.toVec3Normalized(D.uInteriorColor.ref.value,u.interiorColor))),U.highlightColor!==void 0&&U.highlightColor!==u.highlightColor&&(u.highlightColor=U.highlightColor,L.update(D.uHighlightColor,at.toVec3Normalized(D.uHighlightColor.ref.value,u.highlightColor))),U.selectColor!==void 0&&U.selectColor!==u.selectColor&&(u.selectColor=U.selectColor,L.update(D.uSelectColor,at.toVec3Normalized(D.uSelectColor.ref.value,u.selectColor))),U.xrayEdgeFalloff!==void 0&&U.xrayEdgeFalloff!==u.xrayEdgeFalloff&&(u.xrayEdgeFalloff=U.xrayEdgeFalloff,L.update(D.uXrayEdgeFalloff,u.xrayEdgeFalloff)),U.style!==void 0&&(u.style=U.style,Object.assign(l,AH(U.style)),L.updateIfChanged(D.uLightIntensity,l.lightIntensity),L.updateIfChanged(D.uAmbientIntensity,l.ambientIntensity),L.updateIfChanged(D.uMetalness,l.metalness),L.updateIfChanged(D.uRoughness,l.roughness),L.updateIfChanged(D.uReflectivity,l.reflectivity)),U.clip!==void 0&&!ud(U.clip,u.clip)&&(u.clip=U.clip,Object.assign(c,PH(U.clip,c)),L.update(D.uClipObjectPosition,c.objects.position),L.update(D.uClipObjectRotation,c.objects.rotation),L.update(D.uClipObjectScale,c.objects.scale),L.update(D.uClipObjectType,c.objects.type))},setViewport:function(U,z,J,K){i.viewport(U,z,J,K),i.scissor(U,z,J,K),(U!==d.x||z!==d.y||J!==d.width||K!==d.height)&&(Qi.set(d,U,z,J,K),L.update(D.uViewportHeight,K),L.update(D.uViewport,Ir.set(D.uViewport.ref.value,U,z,J,K)))},setTransparentBackground:function(U){v=U},setDrawingBufferSize:function(U,z){(U!==f[0]||z!==f[1])&&L.update(D.uDrawingBufferSize,He.set(f,U,z))},props:u,get stats(){return{programCount:r.stats.resourceCounts.program,shaderCount:r.stats.resourceCounts.shader,attributeCount:r.stats.resourceCounts.attribute,elementsCount:r.stats.resourceCounts.elements,framebufferCount:r.stats.resourceCounts.framebuffer,renderbufferCount:r.stats.resourceCounts.renderbuffer,textureCount:r.stats.resourceCounts.texture,vertexArrayCount:r.stats.resourceCounts.vertexArray,drawCount:o.drawCount,instanceCount:o.instanceCount,instancedDrawCount:o.instancedDrawCount}},dispose:function(){}}}e.create=t})(NR||(NR={}));function mr(e,t,r){return t===void 0&&(t=""),r===void 0&&(r=""),mr.create(e,t,r)}(function(e){function t(s,u,l){return u===void 0&&(u=""),l===void 0&&(l=""),{triggers:s,action:u,description:l}}e.create=t,e.Empty={triggers:[],action:"",description:""};function r(s){return s.triggers.length===0||s.triggers.every(function(u){return u.buttons===void 0&&u.modifiers===void 0})}e.isEmpty=r;function n(s,u,l){return s.triggers.some(function(c){return o.match(c,u,l)})}e.match=n;function i(s){return s.triggers.map(o.format).join(" or ")}e.formatTriggers=i;function a(s,u){u===void 0&&(u="");var l=s.description||is(u);return tMe(l,{triggers:"<i>"+i(s)+"</i>"})}e.format=a;function o(s,u){return o.create(s,u)}e.Trigger=o,function(s){function u(d,f){return{buttons:d,modifiers:f}}s.create=u,s.Empty={};function l(d,f,h){var v=d.buttons,p=d.modifiers;return v!==void 0&&(v===f||zv.has(v,f))&&(!p||Uu.areEqual(p,h))}s.match=l;function c(d){var f=[],h=Dtt(d.buttons);h&&f.push(h);var v=Rtt(d.modifiers);return v&&f.push(v),f.join(" + ")}s.format=c}(o=e.Trigger||(e.Trigger={}))})(mr||(mr={}));var mS=zv;function Dtt(e){var t=[];return e===void 0?t.push("any mouse button"):e===0?t.push("mouse hover"):(mS.has(e,1)&&t.push("left mouse button"),mS.has(e,2)&&t.push("right mouse button"),mS.has(e,4)&&t.push("wheel/middle mouse button"),mS.has(e,8)&&t.push("three fingers")),t.join(" + ")}function Rtt(e,t){var r=[];return e?(e.alt&&r.push("alt key"),e.control&&r.push("control key"),e.meta&&r.push("meta/command key"),e.shift&&r.push("shift key"),t&&r.length===0&&r.push("no key")):t&&r.push("any key"),r.join(" + ")}var lf=Uu,cf=mr.Trigger,ktt={dragRotate:mr([cf(1,lf.create())],"Rotate","Drag using ${triggers}"),dragRotateZ:mr([cf(1,lf.create({shift:!0}))],"Rotate around z-axis","Drag using ${triggers}"),dragPan:mr([cf(2,lf.create()),cf(1,lf.create({control:!0}))],"Pan","Drag using ${triggers}"),dragZoom:mr.Empty,dragFocus:mr([cf(8,lf.create())],"Focus","Drag using ${triggers}"),dragFocusZoom:mr([cf(4,lf.create())],"Focus and zoom","Drag using ${triggers}"),scrollZoom:mr([cf(4,lf.create())],"Zoom","Scroll using ${triggers}"),scrollFocus:mr([cf(4,lf.create({shift:!0}))],"Clip","Scroll using ${triggers}"),scrollFocusZoom:mr.Empty},iie={noScroll:I.Boolean(!0,{isHidden:!0}),rotateSpeed:I.Numeric(5,{min:1,max:10,step:1}),zoomSpeed:I.Numeric(7,{min:1,max:15,step:1}),panSpeed:I.Numeric(1,{min:.1,max:5,step:.1}),spin:I.Boolean(!1,{description:"Spin the 3D scene around the x-axis in view space"}),spinSpeed:I.Numeric(1,{min:-20,max:20,step:1}),staticMoving:I.Boolean(!0,{isHidden:!0}),dynamicDampingFactor:I.Numeric(.2,{},{isHidden:!0}),minDistance:I.Numeric(.01,{},{isHidden:!0}),maxDistance:I.Numeric(1e150,{},{isHidden:!0}),bindings:I.Value(ktt,{isHidden:!0}),autoAdjustMinMaxDistance:I.MappedStatic("on",{off:I.EmptyGroup(),on:I.Group({minDistanceFactor:I.Numeric(0),minDistancePadding:I.Numeric(5),maxDistanceFactor:I.Numeric(10),maxDistanceMin:I.Numeric(20)})},{isHidden:!0})},BR;(function(e){function t(r,n,i){i===void 0&&(i={});var a=E(E({},I.getDefaultValues(iie)),i),o=Qi.clone(n.viewport),s=!1,u=r.drag.subscribe(V),l=r.interactionEnd.subscribe(pe),c=r.wheel.subscribe(we),d=r.pinch.subscribe(Te),f=!1,h=_(),v=_(),p=He(),m=He(),g=_(),y=0,b=He(),S=He(),x=0,C=He(),w=He(),A=He(),M=He(),D=He(),k=He(),R=_.clone(n.target),O=_.clone(n.position),H=_.clone(n.up),B=He();function j(Ne,Qe){return He.set(B,(Ne-o.x)/o.width,(Qe-o.y)/o.height)}var Y=He();function G(Ne,Qe){return He.set(Y,(Ne-o.width*.5-o.x)/(o.width*.5),(o.height+2*(o.y-Qe))/o.width)}var $=_(),q=Xn(),ee=_(),fe=_(),W=_(),X=_();function U(){var Ne=m[0]-p[0],Qe=m[1]-p[1];_.set(X,Ne,Qe,0);var it=r.width/r.height,ot=_.magnitude(X)*a.rotateSpeed*r.pixelRatio*it;ot?(_.sub(v,n.position,n.target),_.normalize(ee,v),_.normalize(fe,n.up),_.normalize(W,_.cross(W,fe,ee)),_.setMagnitude(fe,fe,Qe),_.setMagnitude(W,W,Ne),_.add(X,fe,W),_.normalize($,_.cross($,X,v)),Xn.setAxisAngle(q,$,ot),_.transformQuat(v,v,q),_.transformQuat(n.up,n.up,q),_.copy(g,$),y=ot):!a.staticMoving&&y&&(y*=Math.sqrt(1-a.dynamicDampingFactor),_.sub(v,n.position,n.target),Xn.setAxisAngle(q,g,y),_.transformQuat(v,v,q),_.transformQuat(n.up,n.up,q)),He.copy(p,m)}var z=Xn();function J(){var Ne=S[0]-b[0],Qe=S[1]-b[1],it=a.rotateSpeed*(-Ne+Qe)*-.05;it?(_.sub(v,n.position,n.target),Xn.setAxisAngle(z,v,it),_.transformQuat(n.up,n.up,z),x=it):!a.staticMoving&&x&&(x*=Math.sqrt(1-a.dynamicDampingFactor),_.sub(v,n.position,n.target),Xn.setAxisAngle(z,v,x),_.transformQuat(n.up,n.up,z)),He.copy(b,S)}function K(){var Ne=1+(w[1]-C[1])*a.zoomSpeed;Ne!==1&&Ne>0&&_.scale(v,v,Ne),a.staticMoving?He.copy(C,w):C[1]+=(w[1]-C[1])*a.dynamicDampingFactor}function Z(){var Ne=(M[1]-A[1])*a.zoomSpeed;if(Ne!==0){var Qe=Math.max(1,n.state.radius+n.state.radius*Ne);n.setState({radius:Qe})}a.staticMoving?He.copy(A,M):A[1]+=(M[1]-A[1])*a.dynamicDampingFactor}var te=He(),le=_(),ye=_();function be(){if(He.sub(te,He.copy(te,k),D),He.squaredMagnitude(te)){var Ne=r.pixelRatio*a.panSpeed;te[0]*=1/n.zoom*n.viewport.width*Ne,te[1]*=1/n.zoom*n.viewport.height*Ne,_.cross(ye,_.copy(ye,v),n.up),_.setMagnitude(ye,ye,te[0]),_.setMagnitude(le,n.up,te[1]),_.add(ye,ye,le),_.add(n.position,n.position,ye),_.add(n.target,n.target,ye),a.staticMoving?He.copy(D,k):(He.sub(te,k,D),He.scale(te,te,a.dynamicDampingFactor),He.add(D,D,te))}}function Ae(){var Ne=Math.min(Math.max(n.state.radiusMax*1e3,.01),a.maxDistance);_.squaredMagnitude(v)>Ne*Ne&&(_.setMagnitude(v,v,Ne),_.add(n.position,n.target,v),He.copy(C,w),He.copy(A,M)),_.squaredMagnitude(v)<a.minDistance*a.minDistance&&(_.setMagnitude(v,v,a.minDistance),_.add(n.position,n.target,v),He.copy(C,w),He.copy(A,M))}function Se(Ne,Qe){return Ne*=r.pixelRatio,Qe*=r.pixelRatio,Ne>o.x+o.width||r.height-Qe>o.y+o.height||Ne<o.x||r.height-Qe<o.y}var ie=-1;function oe(Ne){ie!==Ne&&(a.spin&&ie>0&&Xe(Ne-ie),_.sub(v,n.position,n.target),U(),J(),K(),Z(),be(),_.add(n.position,n.target,v),Ae(),_.squaredDistance(h,n.position)>_n&&_.copy(h,n.position),ie=Ne)}function F(){_.copy(n.target,R),_.copy(n.position,O),_.copy(n.up,H),_.sub(v,n.position,n.target),_.copy(h,n.position)}function V(Ne){var Qe=Ne.x,it=Ne.y,ot=Ne.pageX,dt=Ne.pageY,ke=Ne.buttons,Me=Ne.modifiers,Ye=Ne.isStart,tt=Se(Qe,it);if(!(Ye&&tt)&&!(!Ye&&!f)){f=!0;var xt=mr.match(a.bindings.dragRotate,ke,Me),pt=mr.match(a.bindings.dragRotateZ,ke,Me),ut=mr.match(a.bindings.dragPan,ke,Me),he=mr.match(a.bindings.dragZoom,ke,Me),me=mr.match(a.bindings.dragFocus,ke,Me),Ee=mr.match(a.bindings.dragFocusZoom,ke,Me);if(G(ot,dt),j(ot,dt),Ye&&(xt&&(He.copy(m,Y),He.copy(p,m)),pt&&(He.copy(S,Y),He.copy(b,S)),(he||Ee)&&(He.copy(C,B),He.copy(w,C)),me&&(He.copy(A,B),He.copy(M,A)),ut&&(He.copy(D,B),He.copy(k,D))),xt&&He.copy(m,Y),pt&&He.copy(S,Y),(he||Ee)&&He.copy(w,B),me&&He.copy(M,B),Ee){var Ke=_.distance(n.state.position,n.state.target);n.setState({radius:Ke/5})}ut&&He.copy(k,B)}}function pe(){f=!1}function we(Ne){var Qe=Ne.x,it=Ne.y,ot=Ne.dx,dt=Ne.dy,ke=Ne.dz,Me=Ne.buttons,Ye=Ne.modifiers;if(!Se(Qe,it)){var tt=XIe(ot,dt,ke);mr.match(a.bindings.scrollZoom,Me,Ye)&&(w[1]+=tt*1e-4),mr.match(a.bindings.scrollFocus,Me,Ye)&&(M[1]+=tt*1e-4)}}function Te(Ne){var Qe=Ne.fraction,it=Ne.buttons,ot=Ne.modifiers;mr.match(a.bindings.scrollZoom,it,ot)&&(f=!0,w[1]+=(Qe-1)*.1)}function ze(){s||(s=!0,u.unsubscribe(),c.unsubscribe(),d.unsubscribe(),l.unsubscribe())}var Ve=He.create(.005,0);function Xe(Ne){if(a.spinSpeed!==0){var Qe=(a.spinSpeed||0)/1e3;Ve[0]=60*Math.min(Math.abs(Ne),1e3/8)/1e3*Qe,f||He.add(m,p,Ve)}}function ct(Ne){ie=-1,oe(Ne)}return{viewport:o,get props(){return a},setProps:function(Ne){Object.assign(a,Ne)},start:ct,update:oe,reset:F,dispose:ze}}e.create=t})(BR||(BR={}));var Xw;(function(e){function t(){return{view:ue.identity(),position:_.create(0,0,0),direction:_.create(0,0,-1),up:_.create(0,1,0)}}e.create=t;var r=_.zero();function n(i){_.add(r,i.position,i.direction),ue.lookAt(i.view,i.position,r,i.up)}e.update=n})(Xw||(Xw={}));var Ott=function(){function e(){this.removeList=SD(),this.removeMap=new Map,this.addList=SD(),this.addMap=new Map}return Object.defineProperty(e.prototype,"isEmpty",{get:function(){return this.removeList.count===0&&this.addList.count===0},enumerable:!1,configurable:!0}),e.prototype.add=function(t){if(this.removeMap.has(t)){var r=this.removeMap.get(t);this.removeMap.delete(t),this.removeList.remove(r)}if(!this.addMap.has(t)){var n=this.addList.addLast(t);this.addMap.set(t,n)}},e.prototype.remove=function(t){if(this.addMap.has(t)){var r=this.addMap.get(t);this.addMap.delete(t),this.addList.remove(r)}if(!this.removeMap.has(t)){var n=this.removeList.addLast(t);this.removeMap.set(t,n)}},e.prototype.tryGetRemove=function(){var t=this.removeList.removeFirst();return t&&this.removeMap.delete(t),t},e.prototype.tryGetAdd=function(){var t=this.addList.removeFirst();return t&&this.addMap.delete(t),t},e}(),Oy=new bs("98");function TH(e,t,r){Oy.reset();for(var n=0,i=e.length;n<i;++n)if(!(r&&!e[n].state.visible)){var a=e[n].values.boundingSphere.ref.value;a.radius&&Oy.includeSphere(a)}Oy.finishedIncludeStep();for(var n=0,i=e.length;n<i;++n)if(!(r&&!e[n].state.visible)){var o=e[n].values.boundingSphere.ref.value;o.radius&&Oy.radiusSphere(o)}return Oy.getSphere(t)}function Ftt(e,t){var r=e.getProgram("colorBlended").id,n=t.getProgram("colorBlended").id,i=e.materialId,a=t.materialId;return r!==n?r-n:i!==a?i-a:e.id-t.id}var x0;(function(e){function t(r){var n=new Map,i=[],a=Be(),o=Be(),s=[],u=[],l=!0,c=!0,d=Xw.create(),f=d.view,h=d.position,v=d.direction,p=d.up;function m(A){if(n.has(A))return console.warn("RenderObject with id '"+A.id+"' already present"),n.get(A);var M=lqe(r,A);return i.push(M),A.type==="direct-volume"?u.push(M):s.push(M),n.set(A,M),l=!0,c=!0,M}function g(A){var M=n.get(A);M&&(M.dispose(),rv(i,M),rv(s,M),rv(u,M),n.delete(A),l=!0,c=!0)}var y=100;function b(A){for(var M=Ln(),D=0;;){var k=S.tryGetRemove();if(!k)break;if(g(k),++D%y===0&&Ln()-M>A)return!1}for(;;){var k=S.tryGetAdd();if(!k)break;if(m(k),++D%y===0&&Ln()-M>A)return!1}return i.sort(Ftt),!0}var S=new Ott,x=-1;function C(){for(var A=23,M=0,D=i.length;M<D;++M)i[M].state.visible&&(A=31*A+i[M].id|0);return A=bZ(A),A===-1&&(A=0),A}function w(){var A=C();return A!==x?(c=!0,!0):!1}return{view:f,position:h,direction:v,up:p,renderables:i,primitives:{view:f,position:h,direction:v,up:p,renderables:s},volumes:{view:f,position:h,direction:v,up:p,renderables:u},syncVisibility:w,update:function(A,M){var D;if(Xw.update(d),A)for(var k=0,R=A.length;k<R;++k)(D=n.get(A[k]))===null||D===void 0||D.update();else for(var k=0,R=i.length;k<R;++k)i[k].update();M?w():(l=!0,c=!0)},add:function(A){return S.add(A)},remove:function(A){return S.remove(A)},commit:function(A){return A===void 0&&(A=Number.MAX_VALUE),b(A)},get needsCommit(){return!S.isEmpty},has:function(A){return n.has(A)},clear:function(){for(var A=0,M=i.length;A<M;++A)i[A].dispose();i.length=0,n.clear(),l=!0,c=!0},forEach:function(A){n.forEach(A)},get count(){return i.length},get boundingSphere(){return l&&(TH(i,a,!1),l=!1),a},get boundingSphereVisible(){return c&&(TH(i,o,!0),c=!1,x=C()),o}}}e.create=t})(x0||(x0={}));var UR=function(){function e(t){this.camera=t,this.t=0,this.func=e.defaultTransition,this.start=0,this.inTransition=!1,this.durationMs=0,this._source=hi.createDefaultSnapshot(),this._target=hi.createDefaultSnapshot(),this._current=hi.createDefaultSnapshot()}return Object.defineProperty(e.prototype,"source",{get:function(){return this._source},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"target",{get:function(){return this._target},enumerable:!1,configurable:!0}),e.prototype.apply=function(t,r,n){if(r===void 0&&(r=0),(!this.inTransition||r>0)&&hi.copySnapshot(this._source,this.camera.state),this.inTransition||hi.copySnapshot(this._target,this.camera.state),hi.copySnapshot(this._target,t),this._target.radius>this._target.radiusMax&&(this._target.radius=this._target.radiusMax),this._target.radius<.01&&(this._target.radius=.01),this._target.radiusMax<.01&&(this._target.radiusMax=.01),!this.inTransition&&r<=0||typeof t.mode<"u"&&t.mode!==this.camera.state.mode){this.finish(this._target);return}this.inTransition=!0,this.func=n||e.defaultTransition,(!this.inTransition||r>0)&&(this.start=this.t,this.durationMs=r)},e.prototype.tick=function(t){this.t=t,this.update()},e.prototype.finish=function(t){hi.copySnapshot(this.camera.state,t),this.inTransition=!1},e.prototype.update=function(){if(this.inTransition){var t=Math.min((this.t-this.start)/this.durationMs,1);if(t===1){this.finish(this._target);return}this.func(this._current,t,this._source,this._target),hi.copySnapshot(this.camera.state,this._current)}},e}();(function(e){var t=Xn.identity();function r(n,i,a,o){hi.copySnapshot(n,o),Xn.slerp(t,Xn.Identity,Xn.rotationTo(t,a.up,o.up),i),_.transformQuat(n.up,a.up,t),_.lerp(n.target,a.target,o.target,i),_.lerp(n.position,a.position,o.position,i),n.radius=es(a.radius,o.radius,i),n.radiusMax=es(a.radiusMax,o.radiusMax,i),n.fov=es(a.fov,o.fov,i),n.fog=es(a.fog,o.fog,i)}e.defaultTransition=r})(UR||(UR={}));var hi=function(){function e(t,r,n){r===void 0&&(r=Qi.create(0,0,128,128)),n===void 0&&(n={}),this.view=ue.identity(),this.projection=ue.identity(),this.projectionView=ue.identity(),this.inverseProjectionView=ue.identity(),this.state=e.createDefaultSnapshot(),this.viewOffset=e.ViewOffset(),this.near=1,this.far=1e4,this.fogNear=5e3,this.fogFar=1e4,this.zoom=1,this.transition=new UR(this),this.stateChanged=new Kf(this.state),this.prevProjection=ue.identity(),this.prevView=ue.identity(),this.deltaDirection=_(),this.newPosition=_(),this.viewport=r,this.pixelScale=n.pixelScale||1,e.copySnapshot(this.state,t)}return Object.defineProperty(e.prototype,"pixelRatio",{get:function(){var t=typeof window<"u"?window.devicePixelRatio:1;return t*this.pixelScale},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"position",{get:function(){return this.state.position},set:function(t){_.copy(this.state.position,t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"up",{get:function(){return this.state.up},set:function(t){_.copy(this.state.up,t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"target",{get:function(){return this.state.target},set:function(t){_.copy(this.state.target,t)},enumerable:!1,configurable:!0}),e.prototype.update=function(){var t=this.state;if(t.radiusMax===0)return!1;var r=2*Math.tan(t.fov/2)*_.distance(t.position,t.target);switch(this.zoom=this.viewport.height/r,Btt(this),this.state.mode){case"orthographic":Ltt(this);break;case"perspective":Ntt(this);break;default:throw new Error("unknown camera mode")}var n=!ue.areEqual(this.projection,this.prevProjection,_n)||!ue.areEqual(this.view,this.prevView,_n);if(n){if(ue.mul(this.projectionView,this.projection,this.view),!ue.tryInvert(this.inverseProjectionView,this.projectionView))return ue.copy(this.view,this.prevView),ue.copy(this.projection,this.prevProjection),ue.mul(this.projectionView,this.projection,this.view),!1;ue.copy(this.prevView,this.view),ue.copy(this.prevProjection,this.projection)}return n},e.prototype.setState=function(t,r){this.transition.apply(t,r),this.stateChanged.next(t)},e.prototype.getSnapshot=function(){return e.copySnapshot(e.createDefaultSnapshot(),this.state)},e.prototype.getTargetDistance=function(t){return e.targetDistance(t,this.state.fov,this.viewport.width,this.viewport.height)},e.prototype.getFocus=function(t,r,n,i){var a=Math.max(r,.01),o=this.getTargetDistance(a);_.sub(this.deltaDirection,this.target,this.position),i&&_.matchDirection(this.deltaDirection,i,this.deltaDirection),_.setMagnitude(this.deltaDirection,this.deltaDirection,o),_.sub(this.newPosition,t,this.deltaDirection);var s=e.copySnapshot(e.createDefaultSnapshot(),this.state);return s.target=_.clone(t),s.radius=a,s.position=_.clone(this.newPosition),n&&_.matchDirection(s.up,n,s.up),s},e.prototype.getInvariantFocus=function(t,r,n,i){var a=Math.max(r,.01),o=this.getTargetDistance(a);_.copy(this.deltaDirection,i),_.setMagnitude(this.deltaDirection,this.deltaDirection,o),_.sub(this.newPosition,t,this.deltaDirection);var s=e.copySnapshot(e.createDefaultSnapshot(),this.state);return s.target=_.clone(t),s.radius=a,s.position=_.clone(this.newPosition),_.copy(s.up,n),s},e.prototype.focus=function(t,r,n,i,a){r>0&&this.setState(this.getFocus(t,r,i,a),n)},e.prototype.project=function(t,r){return Itt(t,r,this.viewport,this.projectionView)},e.prototype.unproject=function(t,r){return TC(t,r,this.viewport,this.inverseProjectionView)},e}();(function(e){function t(){return{enabled:!1,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}}e.ViewOffset=t;function r(u,l,c,d,f,h,v){u.fullWidth=l,u.fullHeight=c,u.offsetX=d,u.offsetY=f,u.width=h,u.height=v}e.setViewOffset=r;function n(u,l){u.enabled=l.enabled,u.fullWidth=l.fullWidth,u.fullHeight=l.fullHeight,u.offsetX=l.offsetX,u.offsetY=l.offsetY,u.width=l.width,u.height=l.height}e.copyViewOffset=n;function i(u,l,c,d){var f=Math.max(u,.01),h=c/d,v=d<c?1:h;return Math.abs(f/v/Math.sin(l/2))}e.targetDistance=i;function a(){return{mode:"perspective",fov:Math.PI/4,position:_.create(0,0,100),up:_.create(0,1,0),target:_.create(0,0,0),radius:0,radiusMax:10,fog:50,clipFar:!0}}e.createDefaultSnapshot=a;function o(u,l){return l&&(typeof l.mode<"u"&&(u.mode=l.mode),typeof l.fov<"u"&&(u.fov=l.fov),typeof l.position<"u"&&_.copy(u.position,l.position),typeof l.up<"u"&&_.copy(u.up,l.up),typeof l.target<"u"&&_.copy(u.target,l.target),typeof l.radius<"u"&&(u.radius=l.radius),typeof l.radiusMax<"u"&&(u.radiusMax=l.radiusMax),typeof l.fog<"u"&&(u.fog=l.fog),typeof l.clipFar<"u"&&(u.clipFar=l.clipFar)),u}e.copySnapshot=o;function s(u,l){return u.mode===l.mode&&u.fov===l.fov&&u.radius===l.radius&&u.radiusMax===l.radiusMax&&u.fog===l.fog&&u.clipFar===l.clipFar&&_.exactEquals(u.position,l.position)&&_.exactEquals(u.up,l.up)&&_.exactEquals(u.target,l.target)}e.areSnapshotsEqual=s})(hi||(hi={}));function Ltt(e){var t=e.viewport,r=e.zoom,n=e.near,i=e.far,a=e.viewOffset,o=-t.width/2,s=t.width/2,u=t.height/2,l=-t.height/2,c=(s-o)/(2*r),d=(u-l)/(2*r),f=(s+o)/2,h=(u+l)/2,v=f-c,p=f+c,m=h+d,g=h-d;if(a.enabled){var y=r/(a.width/a.fullWidth),b=r/(a.height/a.fullHeight),S=(s-o)/a.width,x=(u-l)/a.height;v+=S*(a.offsetX/y),p=v+S*(a.width/y),m-=x*(a.offsetY/b),g=m-x*(a.height/b)}ue.ortho(e.projection,v,p,m,g,n,i),ue.lookAt(e.view,e.position,e.target,e.up)}function Ntt(e){var t=e.viewport.width/e.viewport.height,r=e.near,n=e.far,i=e.viewOffset,a=r*Math.tan(.5*e.state.fov),o=2*a,s=t*o,u=-.5*s;i.enabled&&(u+=i.offsetX*s/i.fullWidth,a-=i.offsetY*o/i.fullHeight,s*=i.width/i.fullWidth,o*=i.height/i.fullHeight),ue.perspective(e.projection,u,u+s,a,a-o,r,n),ue.lookAt(e.view,e.position,e.target,e.up)}function Btt(e){var t=e.state,r=t.radius,n=t.radiusMax,i=t.mode,a=t.fog,o=t.clipFar;r<.01&&(r=.01);var s=o?r:n,u=_.distance(e.position,e.target),l=u-r,c=u+s,d=-(50-a)/50,f=u-s*d,h=c;l=Math.max(Math.min(n,5),l),c=Math.max(5,c),l===c&&(c=l+.01),e.near=l,e.far=2*c,e.fogNear=f,e.fogFar=h}var zF={sceneBoundingSpheres:I.Boolean(!1,{description:"Show full scene bounding spheres."}),visibleSceneBoundingSpheres:I.Boolean(!1,{description:"Show visible scene bounding spheres."}),objectBoundingSpheres:I.Boolean(!1,{description:"Show bounding spheres of visible render objects."}),instanceBoundingSpheres:I.Boolean(!1,{description:"Show bounding spheres of visible instances."})},Utt=function(){function e(t,r,n){this.objectsData=new Map,this.instancesData=new Map,this.scene=x0.create(t),this.parent=r,this._props=E(E({},I.getDefaultValues(zF)),n)}return e.prototype.update=function(){var t=this,r=gS(this.scene,this.parent.boundingSphere,this.sceneData,pr.lightgrey,ztt);r&&(this.sceneData=r);var n=gS(this.scene,this.parent.boundingSphereVisible,this.visibleSceneData,pr.black,Vtt);n&&(this.visibleSceneData=n),this.parent.forEach(function(i,a){var o=t.objectsData.get(a),s=gS(t.scene,i.values.boundingSphere.ref.value,o,pr.tomato,Htt);s&&t.objectsData.set(a,s);var u=t.instancesData.get(a),l=gS(t.scene,i.values.invariantBoundingSphere.ref.value,u,pr.skyblue,Gtt,{aTransform:a.values.aTransform,matrix:a.values.matrix,transform:a.values.transform,extraTransform:a.values.extraTransform,uInstanceCount:a.values.uInstanceCount,instanceCount:a.values.instanceCount,aInstance:a.values.aInstance,hasReflection:a.values.hasReflection});l&&t.instancesData.set(a,l)}),this.objectsData.forEach(function(i,a){t.parent.has(a)||(t.scene.remove(i.renderObject),t.objectsData.delete(a))}),this.instancesData.forEach(function(i,a){t.parent.has(a)||(t.scene.remove(i.renderObject),t.instancesData.delete(a))}),this.scene.update(void 0,!1),this.scene.commit()},e.prototype.syncVisibility=function(){var t=this;this.sceneData&&(this.sceneData.renderObject.state.visible=this._props.sceneBoundingSpheres),this.visibleSceneData&&(this.visibleSceneData.renderObject.state.visible=this._props.visibleSceneBoundingSpheres),this.parent.forEach(function(r,n){var i=t.objectsData.get(n);i&&(i.renderObject.state.visible=n.state.visible&&t._props.objectBoundingSpheres);var a=t.instancesData.get(n);a&&(a.renderObject.state.visible=n.state.visible&&t._props.instanceBoundingSpheres)})},e.prototype.clear=function(){this.sceneData=void 0,this.objectsData.clear(),this.scene.clear()},Object.defineProperty(e.prototype,"isEnabled",{get:function(){return this._props.sceneBoundingSpheres||this._props.visibleSceneBoundingSpheres||this._props.objectBoundingSpheres||this._props.instanceBoundingSpheres},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"props",{get:function(){return this._props},enumerable:!1,configurable:!0}),e.prototype.setProps=function(t){Object.assign(this._props,t),this.isEnabled&&this.update()},e}();function gS(e,t,r,n,i,a){if(!r||!Be.equals(r.boundingSphere,t)){var o=jtt(t,r&&r.mesh),s=r?r.renderObject:qtt(o,n,i,a);return r?L.updateIfChanged(s.values.drawCount,ha.getDrawCount(o)):e.add(s),{boundingSphere:Be.clone(t),renderObject:s,mesh:o}}}function jtt(e,t){var r=2,n=iA(r),i=wt.createState(n,n/2,t);if(e.radius&&(zi(i,e.center,e.radius,r),Be.hasExtrema(e)))for(var a=0,o=e.extrema;a<o.length;a++){var s=o[a];zi(i,s,1,0)}return wt.getMesh(i)}var ztt=qd(),Vtt=qd(),Htt=qd(),Gtt=qd();function qtt(e,t,r,n){var i=Lt.Utils.createValuesSimple(e,{alpha:.1,doubleSided:!1},t,1,n);return Y0("mesh",i,{disposed:!1,visible:!0,alphaFactor:1,pickable:!1,colorOnly:!1,opaque:!1,writeDepth:!1,noClip:!1},r)}var $tt=function(){function e(t,r,n,i,a){var o=this;a===void 0&&(a=30),this.canvasIdentify=t,this.getLoci=r,this.input=n,this.camera=i,this.maxFps=a,this.ev=hd.create(),this.events={hover:this.ev(),drag:this.ev(),click:this.ev()},this.startX=-1,this.startY=-1,this.endX=-1,this.endY=-1,this.id=void 0,this.position=void 0,this.currentIdentifyT=0,this.isInteracting=!1,this.prevLoci=ur.Loci.Empty,this.prevT=0,this.inside=!1,this.buttons=zv.create(0),this.button=zv.create(0),this.modifiers=Uu.None,n.drag.subscribe(function(s){var u=s.x,l=s.y,c=s.buttons,d=s.button,f=s.modifiers;o.isInteracting=!0,o.drag(u,l,c,d,f)}),n.move.subscribe(function(s){var u=s.x,l=s.y,c=s.inside,d=s.buttons,f=s.button,h=s.modifiers;!c||o.isInteracting||o.move(u,l,d,f,h)}),n.leave.subscribe(function(){o.leave()}),n.click.subscribe(function(s){var u=s.x,l=s.y,c=s.buttons,d=s.button,f=s.modifiers;o.outsideViewport(u,l)||o.click(u,l,c,d,f)}),n.interactionEnd.subscribe(function(){o.isInteracting=!1}),n.modifiers.subscribe(function(s){o.modify(s)})}return e.prototype.identify=function(t,r){var n=this.startX!==this.endX||this.startY!==this.endY;if(t===2){n&&!ur.Loci.isEmpty(this.prevLoci)&&(this.events.drag.next({current:this.prevLoci,buttons:this.buttons,button:this.button,modifiers:this.modifiers,pageStart:He.create(this.startX,this.startY),pageEnd:He.create(this.endX,this.endY)}),this.startX=this.endX,this.startY=this.endY);return}if(n){var i=this.canvasIdentify(this.endX,this.endY);this.id=i==null?void 0:i.id,this.position=i==null?void 0:i.position,this.startX=this.endX,this.startY=this.endY}if(t===1){var a=this.getLoci(this.id);this.events.click.next({current:a,buttons:this.buttons,button:this.button,modifiers:this.modifiers,page:He.create(this.endX,this.endY),position:this.position}),this.prevLoci=a;return}if(!(!this.inside||this.currentIdentifyT!==r||!n||this.outsideViewport(this.endX,this.endY))){var o=this.getLoci(this.id);this.events.hover.next({current:o,buttons:this.buttons,button:this.button,modifiers:this.modifiers,page:He.create(this.endX,this.endY),position:this.position}),this.prevLoci=o}},e.prototype.tick=function(t){this.inside&&t-this.prevT>1e3/this.maxFps&&(this.prevT=t,this.currentIdentifyT=t,this.identify(this.isInteracting?2:0,t))},e.prototype.leave=function(){this.inside=!1,ur.Loci.isEmpty(this.prevLoci)||(this.prevLoci=ur.Loci.Empty,this.events.hover.next({current:this.prevLoci,buttons:this.buttons,button:this.button,modifiers:this.modifiers}))},e.prototype.move=function(t,r,n,i,a){this.inside=!0,this.buttons=n,this.button=i,this.modifiers=a,this.endX=t,this.endY=r},e.prototype.click=function(t,r,n,i,a){this.endX=t,this.endY=r,this.buttons=n,this.button=i,this.modifiers=a,this.identify(1,0)},e.prototype.drag=function(t,r,n,i,a){this.endX=t,this.endY=r,this.buttons=n,this.button=i,this.modifiers=a,this.identify(2,0)},e.prototype.modify=function(t){Uu.areEqual(t,this.modifiers)||(this.modifiers=t,this.events.hover.next({current:this.prevLoci,buttons:this.buttons,button:this.button,modifiers:this.modifiers,page:He.create(this.endX,this.endY),position:this.position}))},e.prototype.outsideViewport=function(t,r){var n=this,i=n.input,a=n.camera.viewport;return t*=i.pixelRatio,r*=i.pixelRatio,t>a.x+a.width||i.height-r>a.y+a.height||t<a.x||i.height-r<a.y},e.prototype.dispose=function(){this.ev.dispose()},e}(),Bo=`
precision highp float;

attribute vec2 aPosition;
uniform vec2 uQuadScale;

void main(void) {
    vec2 position = aPosition * uQuadScale - vec2(1.0, 1.0) + uQuadScale;
    gl_Position = vec4(position, 0.0, 1.0);
}
`,Wtt=`
precision highp float;
precision highp int;
precision highp sampler2D;

uniform sampler2D tDepth;
uniform vec2 uTexSize;

uniform float uNear;
uniform float uFar;

uniform float uMaxPossibleViewZDiff;

#include common

float getViewZ(const in float depth) {
    #if dOrthographic == 1
        return orthographicDepthToViewZ(depth, uNear, uFar);
    #else
        return perspectiveDepthToViewZ(depth, uNear, uFar);
    #endif
}

float getDepth(const in vec2 coords) {
    return unpackRGBAToDepth(texture2D(tDepth, coords));
}

bool isBackground(const in float depth) {
    return depth == 1.0;
}

void main(void) {
    float backgroundViewZ = uFar + 3.0 * uMaxPossibleViewZDiff;

    vec2 coords = gl_FragCoord.xy / uTexSize;
    vec2 invTexSize = 1.0 / uTexSize;

    float selfDepth = getDepth(coords);
    float selfViewZ = isBackground(selfDepth) ? backgroundViewZ : getViewZ(getDepth(coords));

    float outline = 1.0;
    float bestDepth = 1.0;

    for (int y = -1; y <= 1; y++) {
        for (int x = -1; x <= 1; x++) {
            vec2 sampleCoords = coords + vec2(float(x), float(y)) * invTexSize;
            float sampleDepth = getDepth(sampleCoords);
            float sampleViewZ = isBackground(sampleDepth) ? backgroundViewZ : getViewZ(sampleDepth);

            if (abs(selfViewZ - sampleViewZ) > uMaxPossibleViewZDiff && selfDepth > sampleDepth && sampleDepth <= bestDepth) {
                outline = 0.0;
                bestDepth = sampleDepth;
            }
        }
    }

    gl_FragColor = vec4(outline, packUnitIntervalToRG(bestDepth), 0.0);
}
`,Xtt=`
precision highp float;
precision highp int;
precision highp sampler2D;

#include common

uniform sampler2D tDepth;
uniform vec2 uTexSize;
uniform vec4 uBounds;

uniform vec3 uSamples[dNSamples];

uniform mat4 uProjection;
uniform mat4 uInvProjection;

uniform float uRadius;
uniform float uBias;

float smootherstep(float edge0, float edge1, float x) {
    x = clamp((x - edge0) / (edge1 - edge0), 0.0, 1.0);
    return x * x * x * (x * (x * 6.0 - 15.0) + 10.0);
}

float noise(const in vec2 coords) {
    float a = 12.9898;
    float b = 78.233;
    float c = 43758.5453;
    float dt = dot(coords, vec2(a,b));
    float sn = mod(dt, PI);
    return abs(fract(sin(sn) * c)); // is abs necessary?
}

vec2 getNoiseVec2(const in vec2 coords) {
    return vec2(noise(coords), noise(coords + vec2(PI, 2.71828)));
}

bool isBackground(const in float depth) {
    return depth == 1.0;
}

bool outsideBounds(const in vec2 p) {
    return p.x < uBounds.x || p.y < uBounds.y || p.x > uBounds.z || p.y > uBounds.w;
}

float getDepth(const in vec2 coords) {
    return outsideBounds(coords) ? 1.0 : unpackRGBAToDepth(texture2D(tDepth, coords));
}

vec3 normalFromDepth(const in float depth, const in float depth1, const in float depth2, vec2 offset1, vec2 offset2) {
    vec3 p1 = vec3(offset1, depth1 - depth);
    vec3 p2 = vec3(offset2, depth2 - depth);

    vec3 normal = cross(p1, p2);
    normal.z = -normal.z;

    return normalize(normal);
}

// StarCraft II Ambient Occlusion by [Filion and McNaughton 2008]
void main(void) {
    vec2 invTexSize = 1.0 / uTexSize;
    vec2 selfCoords = gl_FragCoord.xy * invTexSize;

    float selfDepth = getDepth(selfCoords);
    vec2 selfPackedDepth = packUnitIntervalToRG(selfDepth);

    if (isBackground(selfDepth)) {
        gl_FragColor = vec4(packUnitIntervalToRG(0.0), selfPackedDepth);
        return;
    }

    vec2 offset1 = vec2(0.0, invTexSize.y);
    vec2 offset2 = vec2(invTexSize.x, 0.0);

    float selfDepth1 = getDepth(selfCoords + offset1);
    float selfDepth2 = getDepth(selfCoords + offset2);

    vec3 selfViewNormal = normalFromDepth(selfDepth, selfDepth1, selfDepth2, offset1, offset2);
    vec3 selfViewPos = screenSpaceToViewSpace(vec3(selfCoords, selfDepth), uInvProjection);

    vec3 randomVec = normalize(vec3(getNoiseVec2(selfCoords) * 2.0 - 1.0, 0.0));

    vec3 tangent = normalize(randomVec - selfViewNormal * dot(randomVec, selfViewNormal));
    vec3 bitangent = cross(selfViewNormal, tangent);
    mat3 TBN = mat3(tangent, bitangent, selfViewNormal);

    float occlusion = 0.0;
    for(int i = 0; i < dNSamples; i++){
        vec3 sampleViewPos = TBN * uSamples[i];
        sampleViewPos = selfViewPos + sampleViewPos * uRadius;

        vec4 offset = vec4(sampleViewPos, 1.0);
        offset = uProjection * offset;
        offset.xyz = (offset.xyz / offset.w) * 0.5 + 0.5;

        float sampleViewZ = screenSpaceToViewSpace(vec3(offset.xy, getDepth(offset.xy)), uInvProjection).z;

        occlusion += step(sampleViewPos.z + 0.025, sampleViewZ) * smootherstep(0.0, 1.0, uRadius / abs(selfViewPos.z - sampleViewZ));
    }
    occlusion = 1.0 - (uBias * occlusion / float(dNSamples));

    vec2 packedOcclusion = packUnitIntervalToRG(occlusion);

    gl_FragColor = vec4(packedOcclusion, selfPackedDepth);
}
`,Ytt=`
precision highp float;
precision highp int;
precision highp sampler2D;

uniform sampler2D tSsaoDepth;
uniform vec2 uTexSize;
uniform vec4 uBounds;

uniform float uKernel[dOcclusionKernelSize];

uniform float uBlurDirectionX;
uniform float uBlurDirectionY;

uniform float uMaxPossibleViewZDiff;

uniform float uNear;
uniform float uFar;

#include common

float getViewZ(const in float depth) {
    #if dOrthographic == 1
        return orthographicDepthToViewZ(depth, uNear, uFar);
    #else
        return perspectiveDepthToViewZ(depth, uNear, uFar);
    #endif
}

bool isBackground(const in float depth) {
    return depth == 1.0;
}

bool outsideBounds(const in vec2 p) {
    return p.x < uBounds.x || p.y < uBounds.y || p.x > uBounds.z || p.y > uBounds.w;
}

void main(void) {
    vec2 coords = gl_FragCoord.xy / uTexSize;

    vec2 packedDepth = texture2D(tSsaoDepth, coords).zw;

    if (outsideBounds(coords)) {
        gl_FragColor = vec4(packUnitIntervalToRG(1.0), packedDepth);
        return;
    }

    float selfDepth = unpackRGToUnitInterval(packedDepth);
    // if background and if second pass
    if (isBackground(selfDepth) && uBlurDirectionY != 0.0) {
        gl_FragColor = vec4(packUnitIntervalToRG(1.0), packedDepth);
        return;
    }

    float selfViewZ = getViewZ(selfDepth);

    vec2 offset = vec2(uBlurDirectionX, uBlurDirectionY) / uTexSize;

    float sum = 0.0;
    float kernelSum = 0.0;
    // only if kernelSize is odd
    for (int i = -dOcclusionKernelSize / 2; i <= dOcclusionKernelSize / 2; i++) {
        vec2 sampleCoords = coords + float(i) * offset;
        if (outsideBounds(sampleCoords)) {
            continue;
        }

        vec4 sampleSsaoDepth = texture2D(tSsaoDepth, sampleCoords);

        float sampleDepth = unpackRGToUnitInterval(sampleSsaoDepth.zw);
        if (isBackground(sampleDepth)) {
            continue;
        }

        if (abs(float(i)) > 1.0) { // abs is not defined for int in webgl1
            float sampleViewZ = getViewZ(sampleDepth);
            if (abs(selfViewZ - sampleViewZ) > uMaxPossibleViewZDiff) {
                continue;
            }
        }

        float kernel = uKernel[int(abs(float(i)))]; // abs is not defined for int in webgl1
        float sampleValue = unpackRGToUnitInterval(sampleSsaoDepth.xy);

        sum += kernel * sampleValue;
        kernelSum += kernel;
    }

    gl_FragColor = vec4(packUnitIntervalToRG(sum / kernelSum), packedDepth);
}
`,Ktt=`
precision highp float;
precision highp int;
precision highp sampler2D;

uniform sampler2D tSsaoDepth;
uniform sampler2D tColor;
uniform sampler2D tDepth;
uniform sampler2D tOutlines;
uniform vec2 uTexSize;

uniform float uNear;
uniform float uFar;
uniform float uFogNear;
uniform float uFogFar;
uniform vec3 uFogColor;
uniform bool uTransparentBackground;

uniform float uOcclusionBias;
uniform float uOcclusionRadius;

uniform float uMaxPossibleViewZDiff;

const vec3 occlusionColor = vec3(0.0);

#include common

float getViewZ(const in float depth) {
    #if dOrthographic == 1
        return orthographicDepthToViewZ(depth, uNear, uFar);
    #else
        return perspectiveDepthToViewZ(depth, uNear, uFar);
    #endif
}

float getDepth(const in vec2 coords) {
    return unpackRGBAToDepth(texture2D(tDepth, coords));
}

bool isBackground(const in float depth) {
    return depth == 1.0;
}

float getOutline(const in vec2 coords, out float closestTexel) {
    float backgroundViewZ = uFar + 3.0 * uMaxPossibleViewZDiff;
    vec2 invTexSize = 1.0 / uTexSize;

    float selfDepth = getDepth(coords);
    float selfViewZ = isBackground(selfDepth) ? backgroundViewZ : getViewZ(selfDepth);

    float outline = 1.0;
    closestTexel = 1.0;
    for (int y = -dOutlineScale; y <= dOutlineScale; y++) {
        for (int x = -dOutlineScale; x <= dOutlineScale; x++) {
            if (x * x + y * y > dOutlineScale * dOutlineScale) {
                continue;
            }

            vec2 sampleCoords = coords + vec2(float(x), float(y)) * invTexSize;

            vec4 sampleOutlineCombined = texture2D(tOutlines, sampleCoords);
            float sampleOutline = sampleOutlineCombined.r;
            float sampleOutlineDepth = unpackRGToUnitInterval(sampleOutlineCombined.gb);

            if (sampleOutline == 0.0 && sampleOutlineDepth < closestTexel && abs(selfViewZ - sampleOutlineDepth) > uMaxPossibleViewZDiff) {
                outline = 0.0;
                closestTexel = sampleOutlineDepth;
            }
        }
    }
    return outline;
}

float getSsao(vec2 coords) {
    float rawSsao = unpackRGToUnitInterval(texture2D(tSsaoDepth, coords).xy);
    if (rawSsao > 0.999) {
        return 1.0;
    } else if (rawSsao > 0.001) {
        return rawSsao;
    }
    // treat values close to 0.0 as errors and return no occlusion
    return 1.0;
}

void main(void) {
    vec2 coords = gl_FragCoord.xy / uTexSize;
    vec4 color = texture2D(tColor, coords);

    float viewDist;
    float fogFactor;

    #ifdef dOcclusionEnable
        float depth = getDepth(coords);
        if (!isBackground(depth)) {
            viewDist = abs(getViewZ(depth));
            fogFactor = smoothstep(uFogNear, uFogFar, viewDist);
            float occlusionFactor = getSsao(coords);
            if (!uTransparentBackground) {
                color.rgb = mix(mix(occlusionColor, uFogColor, fogFactor), color.rgb, occlusionFactor);
            } else {
                color.rgb = mix(occlusionColor * (1.0 - fogFactor), color.rgb, occlusionFactor);
            }
        }
    #endif

    // outline needs to be handled after occlusion to keep them clean
    #ifdef dOutlineEnable
        float closestTexel;
        float outline = getOutline(coords, closestTexel);

        if (outline == 0.0) {
            color.rgb *= outline;
            viewDist = abs(getViewZ(closestTexel));
            fogFactor = smoothstep(uFogNear, uFogFar, viewDist);
            if (!uTransparentBackground) {
                color.rgb = mix(color.rgb, uFogColor, fogFactor);
            } else {
                color.a = 1.0 - fogFactor;
            }
        }
    #endif

    gl_FragColor = color;
}
`,Qtt=`
precision highp float;
precision highp int;
precision highp sampler2D;

uniform sampler2D tColor;
uniform vec2 uTexSizeInv;

// adapted from https://github.com/kosua20/Rendu
// MIT License Copyright (c) 2017 Simon Rodriguez

#define QUALITY(q) ((q) < 5 ? 1.0 : ((q) > 5 ? ((q) < 10 ? 2.0 : ((q) < 11 ? 4.0 : 8.0)) : 1.5))

float rgb2luma(vec3 rgb){
    return sqrt(dot(rgb, vec3(0.299, 0.587, 0.114)));
}

float sampleLuma(vec2 uv) {
    return rgb2luma(texture2D(tColor, uv).rgb);
}

float sampleLuma(vec2 uv, float uOffset, float vOffset) {
    uv += uTexSizeInv * vec2(uOffset, vOffset);
    return sampleLuma(uv);
}

void main(void) {
    vec2 coords = gl_FragCoord.xy * uTexSizeInv;
    vec2 inverseScreenSize = uTexSizeInv;

    vec4 colorCenter = texture2D(tColor, coords);

    // Luma at the current fragment
    float lumaCenter = rgb2luma(colorCenter.rgb);

    // Luma at the four direct neighbours of the current fragment.
    float lumaDown = sampleLuma(coords, 0.0, -1.0);
    float lumaUp = sampleLuma(coords, 0.0, 1.0);
    float lumaLeft = sampleLuma(coords, -1.0, 0.0);
    float lumaRight = sampleLuma(coords, 1.0, 0.0);

    // Find the maximum and minimum luma around the current fragment.
    float lumaMin = min(lumaCenter, min(min(lumaDown, lumaUp), min(lumaLeft, lumaRight)));
    float lumaMax = max(lumaCenter, max(max(lumaDown, lumaUp), max(lumaLeft, lumaRight)));

    // Compute the delta.
    float lumaRange = lumaMax - lumaMin;

    // If the luma variation is lower that a threshold (or if we are in a really dark area),
    // we are not on an edge, don't perform any AA.
    if (lumaRange < max(dEdgeThresholdMin, lumaMax * dEdgeThresholdMax)) {
        gl_FragColor = colorCenter;
        return;
    }

    // Query the 4 remaining corners lumas.
    float lumaDownLeft = sampleLuma(coords, -1.0, -1.0);
    float lumaUpRight = sampleLuma(coords, 1.0, 1.0);
    float lumaUpLeft = sampleLuma(coords, -1.0, 1.0);
    float lumaDownRight = sampleLuma(coords, 1.0, -1.0);

    // Combine the four edges lumas (using intermediary variables for future computations
    // with the same values).
    float lumaDownUp = lumaDown + lumaUp;
    float lumaLeftRight = lumaLeft + lumaRight;

    // Same for corners
    float lumaLeftCorners = lumaDownLeft + lumaUpLeft;
    float lumaDownCorners = lumaDownLeft + lumaDownRight;
    float lumaRightCorners = lumaDownRight + lumaUpRight;
    float lumaUpCorners = lumaUpRight + lumaUpLeft;

    // Compute an estimation of the gradient along the horizontal and vertical axis.
    float edgeHorizontal = abs(-2.0 * lumaLeft + lumaLeftCorners) + abs(-2.0 * lumaCenter + lumaDownUp) * 2.0 + abs(-2.0 * lumaRight + lumaRightCorners);
    float edgeVertical = abs(-2.0 * lumaUp + lumaUpCorners) + abs(-2.0 * lumaCenter + lumaLeftRight) * 2.0 + abs(-2.0 * lumaDown + lumaDownCorners);

    // Is the local edge horizontal or vertical ?
    bool isHorizontal = (edgeHorizontal >= edgeVertical);

    // Choose the step size (one pixel) accordingly.
    float stepLength = isHorizontal ? inverseScreenSize.y : inverseScreenSize.x;

    // Select the two neighboring texels lumas in the opposite direction to the local edge.
    float luma1 = isHorizontal ? lumaDown : lumaLeft;
    float luma2 = isHorizontal ? lumaUp : lumaRight;
    // Compute gradients in this direction.
    float gradient1 = luma1 - lumaCenter;
    float gradient2 = luma2 - lumaCenter;

    // Which direction is the steepest ?
    bool is1Steepest = abs(gradient1) >= abs(gradient2);

    // Gradient in the corresponding direction, normalized.
    float gradientScaled = 0.25 * max(abs(gradient1), abs(gradient2));

    // Average luma in the correct direction.
    float lumaLocalAverage = 0.0;
    if(is1Steepest){
        // Switch the direction
        stepLength = -stepLength;
        lumaLocalAverage = 0.5 * (luma1 + lumaCenter);
    } else {
        lumaLocalAverage = 0.5 * (luma2 + lumaCenter);
    }

    // Shift UV in the correct direction by half a pixel.
    vec2 currentUv = coords;
    if(isHorizontal){
        currentUv.y += stepLength * 0.5;
    } else {
        currentUv.x += stepLength * 0.5;
    }

    // Compute offset (for each iteration step) in the right direction.
    vec2 offset = isHorizontal ? vec2(inverseScreenSize.x, 0.0) : vec2(0.0, inverseScreenSize.y);
    // Compute UVs to explore on each side of the edge, orthogonally.
    // The QUALITY allows us to step faster.
    vec2 uv1 = currentUv - offset * QUALITY(0);
    vec2 uv2 = currentUv + offset * QUALITY(0);

    // Read the lumas at both current extremities of the exploration segment,
    // and compute the delta wrt to the local average luma.
    float lumaEnd1 = sampleLuma(uv1);
    float lumaEnd2 = sampleLuma(uv2);
    lumaEnd1 -= lumaLocalAverage;
    lumaEnd2 -= lumaLocalAverage;

    // If the luma deltas at the current extremities is larger than the local gradient,
    // we have reached the side of the edge.
    bool reached1 = abs(lumaEnd1) >= gradientScaled;
    bool reached2 = abs(lumaEnd2) >= gradientScaled;
    bool reachedBoth = reached1 && reached2;

    // If the side is not reached, we continue to explore in this direction.
    if(!reached1){
        uv1 -= offset * QUALITY(1);
    }
    if(!reached2){
        uv2 += offset * QUALITY(1);
    }

    // If both sides have not been reached, continue to explore.
    if(!reachedBoth){
        for(int i = 2; i < dIterations; i++){
            // If needed, read luma in 1st direction, compute delta.
            if(!reached1){
                lumaEnd1 = sampleLuma(uv1);
                lumaEnd1 = lumaEnd1 - lumaLocalAverage;
            }
            // If needed, read luma in opposite direction, compute delta.
            if(!reached2){
                lumaEnd2 = sampleLuma(uv2);
                lumaEnd2 = lumaEnd2 - lumaLocalAverage;
            }
            // If the luma deltas at the current extremities is larger than the local gradient,
            // we have reached the side of the edge.
            reached1 = abs(lumaEnd1) >= gradientScaled;
            reached2 = abs(lumaEnd2) >= gradientScaled;
            reachedBoth = reached1 && reached2;

            // If the side is not reached, we continue to explore in this direction,
            // with a variable quality.
            if(!reached1){
                uv1 -= offset * QUALITY(i);
            }
            if(!reached2){
                uv2 += offset * QUALITY(i);
            }

            // If both sides have been reached, stop the exploration.
            if(reachedBoth){
                break;
            }
        }
    }

    // Compute the distances to each side edge of the edge (!).
    float distance1 = isHorizontal ? (coords.x - uv1.x) : (coords.y - uv1.y);
    float distance2 = isHorizontal ? (uv2.x - coords.x) : (uv2.y - coords.y);

    // In which direction is the side of the edge closer ?
    bool isDirection1 = distance1 < distance2;
    float distanceFinal = min(distance1, distance2);

    // Thickness of the edge.
    float edgeThickness = (distance1 + distance2);

    // Is the luma at center smaller than the local average ?
    bool isLumaCenterSmaller = lumaCenter < lumaLocalAverage;

    // If the luma at center is smaller than at its neighbour,
    // the delta luma at each end should be positive (same variation).
    bool correctVariation1 = (lumaEnd1 < 0.0) != isLumaCenterSmaller;
    bool correctVariation2 = (lumaEnd2 < 0.0) != isLumaCenterSmaller;

    // Only keep the result in the direction of the closer side of the edge.
    bool correctVariation = isDirection1 ? correctVariation1 : correctVariation2;

    // UV offset: read in the direction of the closest side of the edge.
    float pixelOffset = - distanceFinal / edgeThickness + 0.5;

    // If the luma variation is incorrect, do not offset.
    float finalOffset = correctVariation ? pixelOffset : 0.0;

    // Sub-pixel shifting
    // Full weighted average of the luma over the 3x3 neighborhood.
    float lumaAverage = (1.0 / 12.0) * (2.0 * (lumaDownUp + lumaLeftRight) + lumaLeftCorners + lumaRightCorners);
    // Ratio of the delta between the global average and the center luma,
    // over the luma range in the 3x3 neighborhood.
    float subPixelOffset1 = clamp(abs(lumaAverage - lumaCenter) / lumaRange, 0.0, 1.0);
    float subPixelOffset2 = (-2.0 * subPixelOffset1 + 3.0) * subPixelOffset1 * subPixelOffset1;
    // Compute a sub-pixel offset based on this delta.
    float subPixelOffsetFinal = subPixelOffset2 * subPixelOffset2 * float(dSubpixelQuality);

    // Pick the biggest of the two offsets.
    finalOffset = max(finalOffset, subPixelOffsetFinal);

    // Compute the final UV coordinates.
    vec2 finalUv = coords;
    if(isHorizontal){
        finalUv.y += finalOffset * stepLength;
    } else {
        finalUv.x += finalOffset * stepLength;
    }

    // Read the color at the new UV coordinates, and use it.
    gl_FragColor = texture2D(tColor, finalUv);
}
`,Ztt={edgeThresholdMin:I.Numeric(.0312,{min:.0312,max:.0833,step:1e-4},{description:"Trims the algorithm from processing darks."}),edgeThresholdMax:I.Numeric(.063,{min:.063,max:.333,step:.001},{description:"The minimum amount of local contrast required to apply algorithm."}),iterations:I.Numeric(12,{min:0,max:16,step:1},{description:"Number of edge exploration steps."}),subpixelQuality:I.Numeric(.3,{min:0,max:1,step:.01},{description:"Choose the amount of sub-pixel aliasing removal."})},Jtt=function(){function e(t,r){this.webgl=t,this.renderable=rrt(t,r)}return e.prototype.updateState=function(t){var r=this.webgl,n=r.gl,i=r.state;i.enable(n.SCISSOR_TEST),i.disable(n.BLEND),i.disable(n.DEPTH_TEST),i.depthMask(!1);var a=t.x,o=t.y,s=t.width,u=t.height;n.viewport(a,o,s,u),n.scissor(a,o,s,u),i.clearColor(0,0,0,1),n.clear(n.COLOR_BUFFER_BIT)},e.prototype.setSize=function(t,r){L.update(this.renderable.values.uTexSizeInv,He.set(this.renderable.values.uTexSizeInv.ref.value,1/t,1/r))},e.prototype.update=function(t,r){var n=this.renderable.values,i=r.edgeThresholdMin,a=r.edgeThresholdMax,o=r.iterations,s=r.subpixelQuality,u=!1;n.tColor.ref.value!==t&&(L.update(this.renderable.values.tColor,t),u=!0),n.dEdgeThresholdMin.ref.value!==i&&(u=!0),L.updateIfChanged(n.dEdgeThresholdMin,i),n.dEdgeThresholdMax.ref.value!==a&&(u=!0),L.updateIfChanged(n.dEdgeThresholdMax,a),n.dIterations.ref.value!==o&&(u=!0),L.updateIfChanged(n.dIterations,o),n.dSubpixelQuality.ref.value!==s&&(u=!0),L.updateIfChanged(n.dSubpixelQuality,s),u&&this.renderable.update()},e.prototype.render=function(t,r){r?r.bind():this.webgl.unbindFramebuffer(),this.updateState(t),this.renderable.render()},e}(),ert=E(E({},Pa),{tColor:cr("texture","rgba","ubyte","linear"),uTexSizeInv:Ge("v2"),dEdgeThresholdMin:Jt("number"),dEdgeThresholdMax:Jt("number"),dIterations:Jt("number"),dSubpixelQuality:Jt("number")}),trt=Bn("fxaa",Bo,Qtt);function rrt(e,t){var r=t.getWidth(),n=t.getHeight(),i=E(E({},Ta),{tColor:L.create(t),uTexSizeInv:L.create(He.create(1/r,1/n)),dEdgeThresholdMin:L.create(.0312),dEdgeThresholdMax:L.create(.125),dIterations:L.create(12),dSubpixelQuality:L.create(.3)}),a=E({},ert),o=ra(e,"triangles",trt,a,i);return ta(o,i)}var nrt=`
precision highp float;

attribute vec2 aPosition;
uniform vec2 uQuadScale;

uniform vec2 uTexSizeInv;
uniform vec4 uViewport;

varying vec2 vUv;
varying vec4 vOffset[2];

void SMAANeighborhoodBlendingVS(vec2 texCoord) {
    vOffset[0] = texCoord.xyxy + uTexSizeInv.xyxy * vec4(-1.0, 0.0, 0.0, 1.0); // WebGL port note: Changed sign in W component
    vOffset[1] = texCoord.xyxy + uTexSizeInv.xyxy * vec4(1.0, 0.0, 0.0, -1.0); // WebGL port note: Changed sign in W component
}

void main() {
    vec2 scale = uViewport.zw * uTexSizeInv;
    vec2 shift = uViewport.xy * uTexSizeInv;
    vUv = (aPosition + 1.0) * 0.5 * scale + shift;
    SMAANeighborhoodBlendingVS(vUv);
    vec2 position = aPosition * uQuadScale - vec2(1.0, 1.0) + uQuadScale;
    gl_Position = vec4(position, 0.0, 1.0);
}
`,irt=`
precision highp float;
precision highp int;
precision highp sampler2D;

uniform sampler2D tWeights;
uniform sampler2D tColor;
uniform vec2 uTexSizeInv;

varying vec2 vUv;
varying vec4 vOffset[2];

vec4 SMAANeighborhoodBlendingPS(vec2 texCoord, vec4 offset[2], sampler2D colorTex, sampler2D blendTex) {
    // Fetch the blending weights for current pixel:
    vec4 a;
    a.xz = texture2D(blendTex, texCoord).xz;
    a.y = texture2D(blendTex, offset[1].zw).g;
    a.w = texture2D(blendTex, offset[1].xy).a;

    // Is there any blending weight with a value greater than 0.0?
    if (dot(a, vec4(1.0, 1.0, 1.0, 1.0)) < 1e-5) {
        return texture2D(colorTex, texCoord, 0.0);
    } else {
        // Up to 4 lines can be crossing a pixel (one through each edge). We
        // favor blending by choosing the line with the maximum weight for each
        // direction:
        vec2 offset;
        offset.x = a.a > a.b ? a.a : -a.b; // left vs. right
        offset.y = a.g > a.r ? -a.g : a.r; // top vs. bottom // WebGL port note: Changed signs

        // Then we go in the direction that has the maximum weight:
        if (abs(offset.x) > abs(offset.y)) { // horizontal vs. vertical
            offset.y = 0.0;
        } else {
            offset.x = 0.0;
        }

        // Fetch the opposite color and lerp by hand:
        vec4 C = texture2D(colorTex, texCoord, 0.0);
        texCoord += sign(offset) * uTexSizeInv;
        vec4 Cop = texture2D(colorTex, texCoord, 0.0);
        float s = abs(offset.x) > abs(offset.y) ? abs(offset.x) : abs(offset.y);

        // WebGL port note: Added gamma correction
        C.xyz = pow(C.xyz, vec3(2.2));
        Cop.xyz = pow(Cop.xyz, vec3(2.2));
        vec4 mixed = mix(C, Cop, s);
        mixed.xyz = pow(mixed.xyz, vec3(1.0 / 2.2));

        return mixed;
    }
}

void main() {
    gl_FragColor = SMAANeighborhoodBlendingPS(vUv, vOffset, tColor, tWeights);
}
`,art=`
precision highp float;

attribute vec2 aPosition;
uniform vec2 uQuadScale;

uniform vec2 uTexSizeInv;
uniform vec4 uViewport;

varying vec2 vUv;
varying vec4 vOffset[3];
varying vec2 vPixCoord;

void SMAABlendingWeightCalculationVS(vec2 texCoord) {
    vPixCoord = texCoord / uTexSizeInv;

    // We will use these offsets for the searches later on (see @PSEUDO_GATHER4):
    vOffset[0] = texCoord.xyxy + uTexSizeInv.xyxy * vec4(-0.25, 0.125, 1.25, 0.125); // WebGL port note: Changed sign in Y and W components
    vOffset[1] = texCoord.xyxy + uTexSizeInv.xyxy * vec4(-0.125, 0.25, -0.125, -1.25); // WebGL port note: Changed sign in Y and W components

    // And these for the searches, they indicate the ends of the loops:
    vOffset[2] = vec4(vOffset[0].xz, vOffset[1].yw) + vec4(-2.0, 2.0, -2.0, 2.0) * uTexSizeInv.xxyy * float(dMaxSearchSteps);
}

void main() {
    vec2 scale = uViewport.zw * uTexSizeInv;
    vec2 shift = uViewport.xy * uTexSizeInv;
    vUv = (aPosition + 1.0) * 0.5 * scale + shift;
    SMAABlendingWeightCalculationVS(vUv);
    vec2 position = aPosition * uQuadScale - vec2(1.0, 1.0) + uQuadScale;
    gl_Position = vec4(position, 0.0, 1.0);
}
`,ort=`
precision highp float;
precision highp int;
precision highp sampler2D;

#define SMAASampleLevelZeroOffset(tex, coord, offset) texture2D(tex, coord + float(offset) * uTexSizeInv, 0.0)

#define SMAA_AREATEX_MAX_DISTANCE 16
#define SMAA_AREATEX_PIXEL_SIZE (1.0 / vec2(160.0, 560.0))
#define SMAA_AREATEX_SUBTEX_SIZE (1.0 / 7.0)

uniform sampler2D tEdges;
uniform sampler2D tArea;
uniform sampler2D tSearch;
uniform vec2 uTexSizeInv;

varying vec2 vUv;
varying vec4 vOffset[3];
varying vec2 vPixCoord;

#if __VERSION__ == 100
    vec2 round(vec2 x) {
        return sign(x) * floor(abs(x) + 0.5);
    }
#endif

float SMAASearchLength(sampler2D searchTex, vec2 e, float bias, float scale) {
    // Not required if searchTex accesses are set to point:
    // float2 SEARCH_TEX_PIXEL_SIZE = 1.0 / float2(66.0, 33.0);
    // e = float2(bias, 0.0) + 0.5 * SEARCH_TEX_PIXEL_SIZE +
    //     e * float2(scale, 1.0) * float2(64.0, 32.0) * SEARCH_TEX_PIXEL_SIZE;
    e.r = bias + e.r * scale;
    return 255.0 * texture2D(searchTex, e, 0.0).r;
}

float SMAASearchXLeft(sampler2D edgesTex, sampler2D searchTex, vec2 texCoord, float end) {
    /**
     * @PSEUDO_GATHER4
     * This texCoord has been offset by (-0.25, -0.125) in the vertex shader to
     * sample between edge, thus fetching four edges in a row.
     * Sampling with different offsets in each direction allows to disambiguate
     * which edges are active from the four fetched ones.
     */
    vec2 e = vec2(0.0, 1.0);

    for (int i = 0; i < dMaxSearchSteps; i++) { // WebGL port note: Changed while to for
        e = texture2D( edgesTex, texCoord, 0.0).rg;
        texCoord -= vec2(2.0, 0.0) * uTexSizeInv;
        if (!(texCoord.x > end && e.g > 0.8281 && e.r == 0.0)) break;
    }

    // We correct the previous (-0.25, -0.125) offset we applied:
    texCoord.x += 0.25 * uTexSizeInv.x;

    // The searches are bias by 1, so adjust the coords accordingly:
    texCoord.x += uTexSizeInv.x;

    // Disambiguate the length added by the last step:
    texCoord.x += 2.0 * uTexSizeInv.x; // Undo last step
    texCoord.x -= uTexSizeInv.x * SMAASearchLength(searchTex, e, 0.0, 0.5);

    return texCoord.x;
}

float SMAASearchXRight(sampler2D edgesTex, sampler2D searchTex, vec2 texCoord, float end) {
    vec2 e = vec2( 0.0, 1.0 );

    for (int i = 0; i < dMaxSearchSteps; i++) { // WebGL port note: Changed while to for
        e = texture2D(edgesTex, texCoord, 0.0).rg;
        texCoord += vec2(2.0, 0.0) * uTexSizeInv;
        if (!(texCoord.x < end && e.g > 0.8281 && e.r == 0.0)) break;
    }

    texCoord.x -= 0.25 * uTexSizeInv.x;
    texCoord.x -= uTexSizeInv.x;
    texCoord.x -= 2.0 * uTexSizeInv.x;
    texCoord.x += uTexSizeInv.x * SMAASearchLength( searchTex, e, 0.5, 0.5 );

    return texCoord.x;
}

float SMAASearchYUp(sampler2D edgesTex, sampler2D searchTex, vec2 texCoord, float end) {
    vec2 e = vec2( 1.0, 0.0 );

    for (int i = 0; i < dMaxSearchSteps; i++) { // WebGL port note: Changed while to for
        e = texture2D(edgesTex, texCoord, 0.0).rg;
        texCoord += vec2(0.0, 2.0) * uTexSizeInv; // WebGL port note: Changed sign
        if (!(texCoord.y > end && e.r > 0.8281 && e.g == 0.0)) break;
    }

    texCoord.y -= 0.25 * uTexSizeInv.y; // WebGL port note: Changed sign
    texCoord.y -= uTexSizeInv.y; // WebGL port note: Changed sign
    texCoord.y -= 2.0 * uTexSizeInv.y; // WebGL port note: Changed sign
    texCoord.y += uTexSizeInv.y * SMAASearchLength(searchTex, e.gr, 0.0, 0.5); // WebGL port note: Changed sign

    return texCoord.y;
}

float SMAASearchYDown(sampler2D edgesTex, sampler2D searchTex, vec2 texCoord, float end) {
    vec2 e = vec2( 1.0, 0.0 );

    for (int i = 0; i < dMaxSearchSteps; i++) { // WebGL port note: Changed while to for
        e = texture2D(edgesTex, texCoord, 0.0).rg;
        texCoord -= vec2( 0.0, 2.0 ) * uTexSizeInv; // WebGL port note: Changed sign
        if (!(texCoord.y < end && e.r > 0.8281 && e.g == 0.0)) break;
    }

    texCoord.y += 0.25 * uTexSizeInv.y; // WebGL port note: Changed sign
    texCoord.y += uTexSizeInv.y; // WebGL port note: Changed sign
    texCoord.y += 2.0 * uTexSizeInv.y; // WebGL port note: Changed sign
    texCoord.y -= uTexSizeInv.y * SMAASearchLength(searchTex, e.gr, 0.5, 0.5); // WebGL port note: Changed sign

    return texCoord.y;
}

vec2 SMAAArea(sampler2D areaTex, vec2 dist, float e1, float e2, float offset) {
    // Rounding prevents precision errors of bilinear filtering:
    vec2 texCoord = float(SMAA_AREATEX_MAX_DISTANCE) * round(4.0 * vec2(e1, e2)) + dist;

    // We do a scale and bias for mapping to texel space:
    texCoord = SMAA_AREATEX_PIXEL_SIZE * texCoord + (0.5 * SMAA_AREATEX_PIXEL_SIZE);

    // Move to proper place, according to the subpixel offset:
    texCoord.y += SMAA_AREATEX_SUBTEX_SIZE * offset;

    return texture2D(areaTex, texCoord, 0.0).rg;
}

vec4 SMAABlendingWeightCalculationPS(vec2 texCoord, vec2 pixCoord, vec4 offset[3], sampler2D edgesTex, sampler2D areaTex, sampler2D searchTex, ivec4 subsampleIndices) {
    vec4 weights = vec4(0.0, 0.0, 0.0, 0.0);

    vec2 e = texture2D(edgesTex, texCoord).rg;

    if (e.g > 0.0) { // Edge at north
        vec2 d;

        // Find the distance to the left:
        vec2 coords;
        coords.x = SMAASearchXLeft(edgesTex, searchTex, offset[0].xy, offset[2].x );
        coords.y = offset[1].y; // offset[1].y = texCoord.y - 0.25 * uTexSizeInv.y (@CROSSING_OFFSET)
        d.x = coords.x;

        // Now fetch the left crossing edges, two at a time using bilinear
        // filtering. Sampling at -0.25 (see @CROSSING_OFFSET) enables to
        // discern what value each edge has:
        float e1 = texture2D(edgesTex, coords, 0.0).r;

        // Find the distance to the right:
        coords.x = SMAASearchXRight(edgesTex, searchTex, offset[0].zw, offset[2].y);
        d.y = coords.x;

        // We want the distances to be in pixel units (doing this here allow to
        // better interleave arithmetic and memory accesses):
        d = d / uTexSizeInv.x - pixCoord.x;

        // SMAAArea below needs a sqrt, as the areas texture is compressed
        // quadratically:
        vec2 sqrt_d = sqrt(abs(d));

        // Fetch the right crossing edges:
        coords.y -= 1.0 * uTexSizeInv.y; // WebGL port note: Added
        float e2 = SMAASampleLevelZeroOffset(edgesTex, coords, ivec2(1, 0)).r;

        // Ok, we know how this pattern looks like, now it is time for getting
        // the actual area:
        weights.rg = SMAAArea(areaTex, sqrt_d, e1, e2, float(subsampleIndices.y));
    }

    if (e.r > 0.0) { // Edge at west
        vec2 d;

        // Find the distance to the top:
        vec2 coords;

        coords.y = SMAASearchYUp(edgesTex, searchTex, offset[1].xy, offset[2].z );
        coords.x = offset[0].x; // offset[1].x = texCoord.x - 0.25 * uTexSizeInv.x;
        d.x = coords.y;

        // Fetch the top crossing edges:
        float e1 = texture2D(edgesTex, coords, 0.0).g;

        // Find the distance to the bottom:
        coords.y = SMAASearchYDown(edgesTex, searchTex, offset[1].zw, offset[2].w);
        d.y = coords.y;

        // We want the distances to be in pixel units:
        d = d / uTexSizeInv.y - pixCoord.y;

        // SMAAArea below needs a sqrt, as the areas texture is compressed
        // quadratically:
        vec2 sqrt_d = sqrt(abs(d));

        // Fetch the bottom crossing edges:
        coords.y -= 1.0 * uTexSizeInv.y; // WebGL port note: Added
        float e2 = SMAASampleLevelZeroOffset(edgesTex, coords, ivec2(0, 1)).g;

        // Get the area for this direction:
        weights.ba = SMAAArea(areaTex, sqrt_d, e1, e2, float(subsampleIndices.x));
    }

    return weights;
}

void main() {
    gl_FragColor = SMAABlendingWeightCalculationPS(vUv, vPixCoord, vOffset, tEdges, tArea, tSearch, ivec4(0.0));
}
`,srt=`
precision highp float;

attribute vec2 aPosition;
uniform vec2 uQuadScale;

uniform vec2 uTexSizeInv;
uniform vec4 uViewport;

varying vec2 vUv;
varying vec4 vOffset[3];

void SMAAEdgeDetectionVS(vec2 texCoord) {
    vOffset[0] = texCoord.xyxy + uTexSizeInv.xyxy * vec4(-1.0, 0.0, 0.0, 1.0); // WebGL port note: Changed sign in W component
    vOffset[1] = texCoord.xyxy + uTexSizeInv.xyxy * vec4(1.0, 0.0, 0.0, -1.0); // WebGL port note: Changed sign in W component
    vOffset[2] = texCoord.xyxy + uTexSizeInv.xyxy * vec4(-2.0, 0.0, 0.0, 2.0); // WebGL port note: Changed sign in W component
}

void main() {
    vec2 scale = uViewport.zw * uTexSizeInv;
    vec2 shift = uViewport.xy * uTexSizeInv;
    vUv = (aPosition + 1.0) * 0.5 * scale + shift;
    SMAAEdgeDetectionVS(vUv);
    vec2 position = aPosition * uQuadScale - vec2(1.0, 1.0) + uQuadScale;
    gl_Position = vec4(position, 0.0, 1.0);
}
`,urt=`
precision highp float;
precision highp int;
precision highp sampler2D;

uniform sampler2D tColor;
uniform vec2 uTexSizeInv;

varying vec2 vUv;
varying vec4 vOffset[3];

vec4 SMAAColorEdgeDetectionPS(vec2 texcoord, vec4 offset[3], sampler2D colorTex) {
    vec2 threshold = vec2(dEdgeThreshold, dEdgeThreshold);

    // Calculate color deltas:
    vec4 delta;
    vec3 C = texture2D(colorTex, texcoord).rgb;

    vec3 Cleft = texture2D(colorTex, offset[0].xy).rgb;
    vec3 t = abs(C - Cleft);
    delta.x = max(max(t.r, t.g), t.b);

    vec3 Ctop = texture2D(colorTex, offset[0].zw).rgb;
    t = abs(C - Ctop);
    delta.y = max(max(t.r, t.g), t.b);

    // We do the usual threshold:
    vec2 edges = step(threshold, delta.xy);

    // Then discard if there is no edge:
    if (dot(edges, vec2(1.0, 1.0 )) == 0.0)
        discard;

    // Calculate right and bottom deltas:
    vec3 Cright = texture2D(colorTex, offset[1].xy).rgb;
    t = abs( C - Cright );
    delta.z = max(max(t.r, t.g), t.b);

    vec3 Cbottom  = texture2D(colorTex, offset[1].zw).rgb;
    t = abs(C - Cbottom);
    delta.w = max(max(t.r, t.g), t.b);

    // Calculate the maximum delta in the direct neighborhood:
    float maxDelta = max(max(max(delta.x, delta.y), delta.z), delta.w );

    // Calculate left-left and top-top deltas:
    vec3 Cleftleft  = texture2D(colorTex, offset[2].xy).rgb;
    t = abs( C - Cleftleft );
    delta.z = max(max(t.r, t.g), t.b);

    vec3 Ctoptop = texture2D(colorTex, offset[2].zw).rgb;
    t = abs(C - Ctoptop);
    delta.w = max(max(t.r, t.g), t.b);

    // Calculate the final maximum delta:
    maxDelta = max(max(maxDelta, delta.z), delta.w);

    // Local contrast adaptation in action:
    edges.xy *= step(0.5 * maxDelta, delta.xy);

    return vec4(edges, 0.0, 0.0);
}

void main() {
    gl_FragColor = SMAAColorEdgeDetectionPS(vUv, vOffset, tColor);
}
`,lrt={edgeThreshold:I.Numeric(.1,{min:.05,max:.15,step:.01}),maxSearchSteps:I.Numeric(16,{min:0,max:32,step:1})},crt=function(){function e(t,r){if(this.webgl=t,this._supported=!1,typeof HTMLImageElement>"u"){Lr&&console.log('Missing "HTMLImageElement" required for "SMAA"');return}var n=r.getWidth(),i=r.getHeight();this.edgesTarget=t.createRenderTarget(n,i,!1,"uint8","linear"),this.weightsTarget=t.createRenderTarget(n,i,!1,"uint8","linear"),this.edgesRenderable=hrt(t,r),this.weightsRenderable=mrt(t,this.edgesTarget.texture),this.blendRenderable=brt(t,r,this.weightsTarget.texture),this._supported=!0}return Object.defineProperty(e.prototype,"supported",{get:function(){return this._supported},enumerable:!1,configurable:!0}),e.prototype.updateState=function(t){var r=this.webgl,n=r.gl,i=r.state;i.enable(n.SCISSOR_TEST),i.disable(n.BLEND),i.disable(n.DEPTH_TEST),i.depthMask(!1);var a=t.x,o=t.y,s=t.width,u=t.height;n.viewport(a,o,s,u),n.scissor(a,o,s,u),i.clearColor(0,0,0,1),n.clear(n.COLOR_BUFFER_BIT),L.update(this.edgesRenderable.values.uViewport,Qi.toVec4(this.edgesRenderable.values.uViewport.ref.value,t)),L.update(this.weightsRenderable.values.uViewport,Qi.toVec4(this.weightsRenderable.values.uViewport.ref.value,t)),L.update(this.blendRenderable.values.uViewport,Qi.toVec4(this.blendRenderable.values.uViewport.ref.value,t))},e.prototype.setSize=function(t,r){var n=this.edgesTarget.getWidth(),i=this.edgesTarget.getHeight();(t!==n||r!==i)&&(this.edgesTarget.setSize(t,r),this.weightsTarget.setSize(t,r),L.update(this.edgesRenderable.values.uTexSizeInv,He.set(this.edgesRenderable.values.uTexSizeInv.ref.value,1/t,1/r)),L.update(this.weightsRenderable.values.uTexSizeInv,He.set(this.weightsRenderable.values.uTexSizeInv.ref.value,1/t,1/r)),L.update(this.blendRenderable.values.uTexSizeInv,He.set(this.blendRenderable.values.uTexSizeInv.ref.value,1/t,1/r)))},e.prototype.update=function(t,r){var n=!1;this.edgesRenderable.values.tColor.ref.value!==t&&(L.update(this.edgesRenderable.values.tColor,t),n=!0),this.edgesRenderable.values.dEdgeThreshold.ref.value!==r.edgeThreshold&&(L.update(this.edgesRenderable.values.dEdgeThreshold,r.edgeThreshold),n=!0),n&&this.edgesRenderable.update(),this.weightsRenderable.values.dMaxSearchSteps.ref.value!==r.maxSearchSteps&&(L.update(this.weightsRenderable.values.dMaxSearchSteps,r.maxSearchSteps),this.weightsRenderable.update()),this.blendRenderable.values.tColor.ref.value!==t&&(L.update(this.blendRenderable.values.tColor,t),this.blendRenderable.update())},e.prototype.render=function(t,r){this.edgesTarget.bind(),this.updateState(t),this.edgesRenderable.render(),this.weightsTarget.bind(),this.updateState(t),this.weightsRenderable.render(),r?r.bind():this.webgl.unbindFramebuffer(),this.updateState(t),this.blendRenderable.render()},e}(),drt=E(E({},Pa),{tColor:cr("texture","rgba","ubyte","linear"),uTexSizeInv:Ge("v2"),uViewport:Ge("v4"),dEdgeThreshold:Jt("number")}),frt=Bn("smaa-edges",srt,urt);function hrt(e,t){var r=t.getWidth(),n=t.getHeight(),i=E(E({},Ta),{tColor:L.create(t),uTexSizeInv:L.create(He.create(1/r,1/n)),uViewport:L.create(Ir()),dEdgeThreshold:L.create(.1)}),a=E({},drt),o=ra(e,"triangles",frt,a,i);return ta(o,i)}var prt=E(E({},Pa),{tEdges:cr("texture","rgba","ubyte","linear"),tArea:cr("texture","rgb","ubyte","linear"),tSearch:cr("texture","rgba","ubyte","nearest"),uTexSizeInv:Ge("v2"),uViewport:Ge("v4"),dMaxSearchSteps:Jt("number")}),vrt=Bn("smaa-weights",art,ort);function mrt(e,t){var r=t.getWidth(),n=t.getHeight(),i=YD(e.gl,e.extensions,"image-uint8","rgb","ubyte","linear"),a=YD(e.gl,e.extensions,"image-uint8","rgba","ubyte","nearest"),o=E(E({},Ta),{tEdges:L.create(t),tArea:L.create(i),tSearch:L.create(a),uTexSizeInv:L.create(He.create(1/r,1/n)),uViewport:L.create(Ir()),dMaxSearchSteps:L.create(8)});Rz(xrt(),o.tArea,i),Rz(Srt(),o.tSearch,a);var s=E({},prt),u=ra(e,"triangles",vrt,s,o);return ta(u,o)}var grt=E(E({},Pa),{tColor:cr("texture","rgba","ubyte","linear"),tWeights:cr("texture","rgba","ubyte","linear"),uTexSizeInv:Ge("v2"),uViewport:Ge("v4")}),yrt=Bn("smaa-blend",nrt,irt);function brt(e,t,r){var n=t.getWidth(),i=t.getHeight(),a=E(E({},Ta),{tColor:L.create(t),tWeights:L.create(r),uTexSizeInv:L.create(He.create(1/n,1/i)),uViewport:L.create(Ir())}),o=E({},grt),s=ra(e,"triangles",yrt,o,a);return ta(s,a)}function xrt(){return"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAKAAAAIwCAIAAACOVPcQAACBeklEQVR42u39W4xlWXrnh/3WWvuciIzMrKxrV8/0rWbY0+SQFKcb4owIkSIFCjY9AC1BT/LYBozRi+EX+cV+8IMsYAaCwRcBwjzMiw2jAWtgwC8WR5Q8mDFHZLNHTarZGrLJJllt1W2qKrsumZWZcTvn7L3W54e1vrXX3vuciLPPORFR1XE2EomorB0nVuz//r71re/y/1eMvb4Cb3N11xV/PP/2v4UBAwJG/7H8urx6/25/Gf8O5hypMQ0EEEQwAqLfoN/Z+97f/SW+/NvcgQk4sGBJK6H7N4PFVL+K+e0N11yNfkKvwUdwdlUAXPHHL38oa15f/i/46Ih6SuMSPmLAYAwyRKn7dfMGH97jaMFBYCJUgotIC2YAdu+LyW9vvubxAP8kAL8H/koAuOKP3+q6+xGnd5kdYCeECnGIJViwGJMAkQKfDvB3WZxjLKGh8VSCCzhwEWBpMc5/kBbjawT4HnwJfhr+pPBIu7uu+OOTo9vsmtQcniMBGkKFd4jDWMSCRUpLjJYNJkM+IRzQ+PQvIeAMTrBS2LEiaiR9b/5PuT6Ap/AcfAFO4Y3dA3DFH7/VS+M8k4baEAQfMI4QfbVDDGIRg7GKaIY52qAjTAgTvGBAPGIIghOCYAUrGFNgzA7Q3QhgCwfwAnwe5vDejgG44o/fbm1C5ZlYQvQDARPAIQGxCWBM+wWl37ZQESb4gImexGMDouhGLx1Cst0Saa4b4AqO4Hk4gxo+3DHAV/nx27p3JziPM2pVgoiia5MdEzCGULprIN7gEEeQ5IQxEBBBQnxhsDb5auGmAAYcHMA9eAAz8PBol8/xij9+C4Djlim4gJjWcwZBhCBgMIIYxGAVIkH3ZtcBuLdtRFMWsPGoY9rN+HoBji9VBYdwD2ZQg4cnO7OSq/z4rU5KKdwVbFAjNojCQzTlCLPFSxtamwh2jMUcEgg2Wm/6XgErIBhBckQtGN3CzbVacERgCnfgLswhnvqf7QyAq/z4rRZm1YglYE3affGITaZsdIe2FmMIpnOCap25I6jt2kCwCW0D1uAD9sZctNGXcQIHCkINDQgc78aCr+zjtw3BU/ijdpw3zhCwcaONwBvdeS2YZKkJNJsMPf2JKEvC28RXxxI0ASJyzQCjCEQrO4Q7sFArEzjZhaFc4cdv+/JFdKULM4px0DfUBI2hIsy06BqLhGTQEVdbfAIZXYMPesq6VoCHICzUyjwInO4Y411//LYLs6TDa9wvg2CC2rElgAnpTBziThxaL22MYhzfkghz6GAs2VHbbdM91VZu1MEEpupMMwKyVTb5ij9+u4VJG/5EgEMMmFF01cFai3isRbKbzb+YaU/MQbAm2XSMoUPAmvZzbuKYRIFApbtlrfFuUGd6vq2hXNnH78ZLh/iFhsQG3T4D1ib7k5CC6vY0DCbtrohgLEIClXiGtl10zc0CnEGIhhatLBva7NP58Tvw0qE8yWhARLQ8h4+AhQSP+I4F5xoU+VilGRJs6wnS7ruti/4KvAY/CfdgqjsMy4pf8fodQO8/gnuX3f/3xi3om1/h7THr+co3x93PP9+FBUfbNUjcjEmhcrkT+8K7ml7V10Jo05mpIEFy1NmCJWx9SIKKt+EjAL4Ez8EBVOB6havuT/rByPvHXK+9zUcfcbb254+9fydJknYnRr1oGfdaiAgpxu1Rx/Rek8KISftx3L+DfsLWAANn8Hvw0/AFeAGO9DFV3c6D+CcWbL8Dj9e7f+T1k8AZv/d7+PXWM/Z+VvdCrIvuAKO09RpEEQJM0Ci6+B4xhTWr4cZNOvhktabw0ta0rSJmqz3Yw5/AKXwenod7cAhTmBSPKf6JBdvH8IP17h95pXqw50/+BFnj88fev4NchyaK47OPhhtI8RFSvAfDSNh0Ck0p2gLxGkib5NJj/JWCr90EWQJvwBzO4AHcgztwAFN1evHPUVGwfXON+0debT1YeGON9Yy9/63X+OguiwmhIhQhD7l4sMqlG3D86Suc3qWZ4rWjI1X7u0Ytw6x3rIMeIOPDprfe2XzNgyj6PahhBjO4C3e6puDgXrdg+/5l948vF3bqwZetZ+z9Rx9zdIY5pInPK4Nk0t+l52xdK2B45Qd87nM8fsD5EfUhIcJcERw4RdqqH7Yde5V7m1vhNmtedkz6EDzUMF/2jJYWbC+4fzzA/Y+/8PPH3j9dcBAPIRP8JLXd5BpAu03aziOL3VVHZzz3CXWDPWd+SH2AnxIqQoTZpo9Ckc6HIrFbAbzNmlcg8Ag8NFDDAhbJvTBZXbC94P7t68EXfv6o+21gUtPETU7bbkLxvNKRFG2+KXzvtObonPP4rBvsgmaKj404DlshFole1Glfh02fE7bYR7dZ82oTewIBGn1Md6CG6YUF26X376oevOLzx95vhUmgblI6LBZwTCDY7vMq0op5WVXgsObOXJ+1x3qaBl9j1FeLxbhU9w1F+Wiba6s1X/TBz1LnUfuYDi4r2C69f1f14BWfP+p+W2GFKuC9phcELMYRRLur9DEZTUdEH+iEqWdaM7X4WOoPGI+ZYD2+wcQ+y+ioHUZ9dTDbArzxmi/bJI9BND0Ynd6lBdve/butBw8+f/T9D3ABa3AG8W3VPX4hBin+bj8dMMmSpp5pg7fJ6xrBFE2WQQEWnV8Qg3FbAWzYfM1rREEnmvkN2o1+acG2d/9u68GDzx91v3mAjb1zkpqT21OipPKO0b9TO5W0nTdOmAQm0TObts3aBKgwARtoPDiCT0gHgwnbArzxmtcLc08HgF1asN0C4Ms/fvD5I+7PhfqyXE/b7RbbrGyRQRT9ARZcwAUmgdoz0ehJ9Fn7QAhUjhDAQSw0bV3T3WbNa59jzmiP6GsWbGXDX2ytjy8+f9T97fiBPq9YeLdBmyuizZHaqXITnXiMUEEVcJ7K4j3BFPurtB4bixW8wTpweL8DC95szWMOqucFYGsWbGU7p3TxxxefP+r+oTVktxY0v5hbq3KiOKYnY8ddJVSBxuMMVffNbxwIOERShst73HZ78DZrHpmJmH3K6sGz0fe3UUj0eyRrSCGTTc+rjVNoGzNSv05srAxUBh8IhqChiQgVNIIBH3AVPnrsnXQZbLTm8ammv8eVXn/vWpaTem5IXRlt+U/LA21zhSb9cye6jcOfCnOwhIAYXAMVTUNV0QhVha9xjgA27ODJbLbmitt3tRN80lqG6N/khgot4ZVlOyO4WNg3OIMzhIZQpUEHieg2im6F91hB3I2tubql6BYNN9Hj5S7G0G2tahslBWKDnOiIvuAEDzakDQKDNFQT6gbn8E2y4BBubM230YIpBnDbMa+y3dx0n1S0BtuG62lCCXwcY0F72T1VRR3t2ONcsmDjbmzNt9RFs2LO2hQNyb022JisaI8rAWuw4HI3FuAIhZdOGIcdjLJvvObqlpqvWTJnnQbyi/1M9O8UxWhBs//H42I0q1Yb/XPGONzcmm+ri172mHKvZBpHkJaNJz6v9jxqiklDj3U4CA2ugpAaYMWqNXsdXbmJNd9egCnJEsphXNM+MnK3m0FCJ5S1kmJpa3DgPVbnQnPGWIDspW9ozbcO4K/9LkfaQO2KHuqlfFXSbdNzcEcwoqNEFE9zcIXu9/6n/ym/BC/C3aJLzEKPuYVlbFnfhZ8kcWxV3dbv4bKl28566wD+8C53aw49lTABp9PWbsB+knfc/Li3eVizf5vv/xmvnPKg5ihwKEwlrcHqucuVcVOxEv8aH37E3ZqpZypUulrHEtIWKUr+txHg+ojZDGlwnqmkGlzcVi1dLiNSJiHjfbRNOPwKpx9TVdTn3K05DBx4psIk4Ei8aCkJahRgffk4YnEXe07T4H2RR1u27E6wfQsBDofUgjFUFnwC2AiVtA+05J2zpiDK2Oa0c5fmAecN1iJzmpqFZxqYBCYhFTCsUNEmUnIcZ6aEA5rQVhEywG6w7HSW02XfOoBlQmjwulOFQAg66SvJblrTEX1YtJ3uG15T/BH1OfOQeuR8g/c0gdpT5fx2SKbs9EfHTKdM8A1GaJRHLVIwhcGyydZsbifAFVKl5EMKNU2Hryo+06BeTgqnxzYjThVySDikbtJPieco75lYfKAJOMEZBTjoITuWHXXZVhcUDIS2hpiXHV9Ku4u44bN5OYLDOkJo8w+xJSMbhBRHEdEs9JZUCkQrPMAvaHyLkxgkEHxiNkx/x2YB0mGsQ8EUWj/stW5YLhtS5SMu+/YBbNPDCkGTUybN8krRLBGPlZkVOA0j+a1+rkyQKWGaPHPLZOkJhioQYnVZ2hS3zVxMtgC46KuRwbJNd9nV2PHgb36F194ecf/Yeu2vAFe5nm/bRBFrnY4BauE8ERmZRFUn0k8hbftiVYSKMEme2dJCJSCGYAlNqh87bXOPdUkGy24P6d1ll21MBqqx48Fvv8ZHH8HZFY7j/uAq1xMJUFqCSUlJPmNbIiNsmwuMs/q9CMtsZsFO6SprzCS1Z7QL8xCQClEelpjTduDMsmWD8S1PT152BtvmIGvUeDA/yRn83u/x0/4qxoPHjx+PXY9pqX9bgMvh/Nz9kpP4pOe1/fYf3axUiMdHLlPpZCNjgtNFAhcHEDxTumNONhHrBduW+vOyY++70WWnPXj98eA4kOt/mj/5E05l9+O4o8ePx67HFqyC+qSSnyselqjZGaVK2TadbFLPWAQ4NBhHqDCCV7OTpo34AlSSylPtIdd2AJZlyzYQrDJ5lcWGNceD80CunPLGGzsfD+7wRb95NevJI5docQ3tgCyr5bGnyaPRlmwNsFELViOOx9loebGNq2moDOKpHLVP5al2cymWHbkfzGXL7kfRl44H9wZy33tvt+PB/Xnf93e+nh5ZlU18wCiRUa9m7kib9LYuOk+hudQNbxwm0AQqbfloimaB2lM5fChex+ylMwuTbfmXQtmWlenZljbdXTLuOxjI/fDDHY4Hjx8/Hrse0zXfPFxbUN1kKqSCCSk50m0Ajtx3ub9XHBKHXESb8iO6E+qGytF4nO0OG3SXzbJlhxBnKtKyl0NwybjvYCD30aMdjgePHz8eu56SVTBbgxJMliQ3Oauwg0QHxXE2Ez/EIReLdQj42Gzb4CLS0YJD9xUx7bsi0vJi5mUbW1QzL0h0PFk17rtiIPfJk52MB48fPx67npJJwyrBa2RCCQRTbGZSPCxTPOiND4G2pYyOQ4h4jINIJh5wFU1NFZt+IsZ59LSnDqBjZ2awbOku+yInunLcd8VA7rNnOxkPHj9+PGY9B0MWJJNozOJmlglvDMXDEozdhQWbgs/U6oBanGzLrdSNNnZFjOkmbi5bNt1lX7JLLhn3vXAg9/h4y/Hg8ePHI9dzQMEkWCgdRfYykYKnkP7D4rIujsujaKPBsB54vE2TS00ccvFY/Tth7JXeq1hz+qgVy04sAJawTsvOknHfCwdyT062HA8eP348Zj0vdoXF4pilKa2BROed+9fyw9rWRXeTFXESMOanvDZfJuJaSXouQdMdDJZtekZcLLvEeK04d8m474UDuaenW44Hjx8/Xns9YYqZpszGWB3AN/4VHw+k7WSFtJ3Qicuqb/NlVmgXWsxh570xg2UwxUw3WfO6B5nOuO8aA7lnZxuPB48fPx6znm1i4bsfcbaptF3zNT78eFPtwi1OaCNOqp1x3zUGcs/PN++AGD1+fMXrSVm2baTtPhPahbPhA71wIHd2bXzRa69nG+3CraTtPivahV/55tXWg8fyRY/9AdsY8VbSdp8V7cKrrgdfM//z6ILQFtJ2nxHtwmuoB4/kf74+gLeRtvvMaBdeSz34+vifx0YG20jbfTa0C6+tHrwe//NmOG0L8EbSdp8R7cLrrQe/996O+ai3ujQOskpTNULa7jOjXXj99eCd8lHvoFiwsbTdZ0a78PrrwTvlo966pLuRtB2fFe3Cm6oHP9kNH/W2FryxtN1nTLvwRurBO+Kj3pWXHidtx2dFu/Bm68Fb81HvykuPlrb7LGkX3mw9eGs+6h1Y8MbSdjegXcguQLjmevDpTQLMxtJ2N6NdyBZu9AbrwVvwUW+LbteULUpCdqm0HTelXbhNPe8G68Gb8lFvVfYfSNuxvrTdTWoXbozAzdaDZzfkorOj1oxVxlIMlpSIlpLrt8D4hrQL17z+c3h6hU/wv4Q/utps4+bm+6P/hIcf0JwQ5oQGPBL0eKPTYEXTW+eL/2DKn73J9BTXYANG57hz1cEMviVf/4tf5b/6C5pTQkMIWoAq7hTpOJjtAM4pxKu5vg5vXeUrtI09/Mo/5H+4z+Mp5xULh7cEm2QbRP2tFIKR7WM3fPf/jZ3SWCqLM2l4NxID5zB72HQXv3jj/8mLR5xXNA5v8EbFQEz7PpRfl1+MB/hlAN65qgDn3wTgH13hK7T59bmP+NIx1SHHU84nLOITt3iVz8mNO+lPrjGAnBFqmioNn1mTyk1ta47R6d4MrX7tjrnjYUpdUbv2rVr6YpVfsGG58AG8Ah9eyUN8CX4WfgV+G8LVWPDGb+Zd4cU584CtqSbMKxauxTg+dyn/LkVgA+IR8KHtejeFKRtTmLLpxN6mYVLjYxwXf5x2VofiZcp/lwKk4wGOpYDnoIZPdg/AAbwMfx0+ge9dgZvYjuqKe4HnGnykYo5TvJbG0Vj12JagRhwKa44H95ShkZa5RyLGGdfYvG7aw1TsF6iapPAS29mNS3NmsTQZCmgTzFwgL3upCTgtBTRwvGMAKrgLn4evwin8+afJRcff+8izUGUM63GOOuAs3tJkw7J4kyoNreqrpO6cYLQeFUd7TTpr5YOTLc9RUUogUOVJQ1GYJaFLAW0oTmKyYS46ZooP4S4EON3xQ5zC8/CX4CnM4c1PE8ApexpoYuzqlP3d4S3OJP8ZDK7cKWNaTlqmgDiiHwl1YsE41w1zT4iRTm3DBqxvOUsbMKKDa/EHxagtnta072ejc3DOIh5ojvh8l3tk1JF/AV6FU6jh3U8HwEazLgdCLYSQ+MYiAI2ltomkzttUb0gGHdSUUgsIYjTzLG3mObX4FBRaYtpDVNZrih9TgTeYOBxsEnN1gOCTM8Bsw/ieMc75w9kuAT6A+/AiHGvN/+Gn4KRkiuzpNNDYhDGFndWRpE6SVfm8U5bxnSgVV2jrg6JCKmneqey8VMFgq2+AM/i4L4RUbfSi27lNXZ7R7W9RTcq/q9fk4Xw3AMQd4I5ifAZz8FcVtm9SAom/dyN4lczJQW/kC42ZrHgcCoIf1oVMKkVItmMBi9cOeNHGLqOZk+QqQmrbc5YmYgxELUUN35z2iohstgfLIFmcMV7s4CFmI74L9+EFmGsi+tGnAOD4Yk9gIpo01Y4cA43BWGygMdr4YZekG3OBIUXXNukvJS8tqa06e+lSDCtnqqMFu6hWHXCF+WaYt64m9QBmNxi7Ioy7D+fa1yHw+FMAcPt7SysFLtoG4PXAk7JOA3aAxBRqUiAdU9Yp5lK3HLSRFtOim0sa8euEt08xvKjYjzeJ2GU7YawexrnKI9tmobInjFXCewpwriY9+RR4aaezFhMhGCppKwom0ChrgFlKzyPKkGlTW1YQrE9HJqu8hKGgMc6hVi5QRq0PZxNfrYNgE64utmRv6KKHRpxf6VDUaOvNP5jCEx5q185My/7RKz69UQu2im5k4/eownpxZxNLwiZ1AZTO2ZjWjkU9uaB2HFn6Q3u0JcsSx/qV9hTEApRzeBLDJQXxYmTnq7bdLa3+uqFrxLJ5w1TehnNHx5ECvCh2g2c3hHH5YsfdaSKddztfjQ6imKFGSyFwlLzxEGPp6r5IevVjk1AMx3wMqi1NxDVjLBiPs9tbsCkIY5we5/ML22zrCScFxnNtzsr9Wcc3CnD+pYO+4VXXiDE0oc/vQQ/fDK3oPESJMYXNmJa/DuloJZkcTpcYE8lIH8Dz8DJMiynNC86Mb2lNaaqP/+L7f2fcE/yP7/Lde8xfgSOdMxvOixZf/9p3+M4hT1+F+zApxg9XfUvYjc8qX2lfOOpK2gNRtB4flpFu9FTKCp2XJRgXnX6olp1zyYjTKJSkGmLE2NjUr1bxFM4AeAAHBUFIeSLqXR+NvH/M9fOnfHzOD2vCSyQJKzfgsCh+yi/Mmc35F2fUrw7miW33W9hBD1vpuUojFphIyvg7aTeoymDkIkeW3XLHmguMzbIAJejN6B5MDrhipE2y6SoFRO/AK/AcHHZHNIfiWrEe/C6cr3f/yOvrQKB+zMM55/GQdLDsR+ifr5Fiuu+/y+M78LzOE5dsNuXC3PYvYWd8NXvphLSkJIasrlD2/HOqQ+RjcRdjKTGWYhhVUm4yxlyiGPuMsZR7sMCHUBeTuNWA7if+ifXgc/hovftHXs/DV+Fvwe+f8shzMiMcweFgBly3//vwJfg5AN4450fn1Hd1Rm1aBLu22Dy3y3H2+OqMemkbGZ4jozcDjJf6596xOLpC0eMTHbKnxLxH27uZ/bMTGs2jOaMOY4m87CfQwF0dw53oa1k80JRuz/XgS+8fX3N9Af4qPIMfzKgCp4H5TDGe9GGeFPzSsZz80SlPTxXjgwJmC45njzgt2vbQ4b4OAdUK4/vWhO8d8v6EE8fMUsfakXbPpFJeLs2ubM/qdm/la3WP91uWhxXHjoWhyRUq2iJ/+5mA73zwIIo+LoZ/SgvIRjAd1IMvvn98PfgOvAJfhhm8scAKVWDuaRaK8aQ9f7vuPDH6Bj47ZXau7rqYJ66mTDwEDU6lLbCjCK0qTXyl5mnDoeNRxanj3FJbaksTk0faXxHxLrssgPkWB9LnA/MFleXcJozzjwsUvUG0X/QCve51qkMDXp9mtcyOy3rwBfdvVJK7D6/ACSzg3RoruIq5UDeESfEmVclDxnniU82vxMLtceD0hGZWzBNPMM/jSPne2OVatiTKUpY5vY7gc0LdUAWeWM5tH+O2I66AOWw9xT2BuyRVLGdoDHUsVRXOo/c+ZdRXvFfnxWyIV4upFLCl9eAL7h8Zv0QH8Ry8pA2cHzQpGesctVA37ZtklBTgHjyvdSeKY/RZw/kJMk0Y25cSNRWSigQtlULPTw+kzuJPeYEkXjQRpoGZobYsLF79pyd1dMRHInbgFTZqNLhDqiIsTNpoex2WLcy0/X6rHcdMMQvFSd5dWA++4P7xv89deACnmr36uGlL69bRCL6BSZsS6c0TU2TKK5gtWCzgAOOwQcurqk9j8whvziZSMLcq5hbuwBEsYjopUBkqw1yYBGpLA97SRElEmx5MCInBY5vgLk94iKqSWmhIGmkJ4Bi9m4L645J68LyY4wsFYBfUg5feP/6gWWm58IEmKQM89hq7KsZNaKtP5TxxrUZZVkNmMJtjbKrGxLNEbHPJxhqy7lAmbC32ZqeF6lTaknRWcYaFpfLUBh/rwaQycCCJmW15Kstv6jRHyJFry2C1ahkkIW0LO75s61+owxK1y3XqweX9m5YLM2DPFeOjn/iiqCKJ+yKXF8t5Yl/kNsqaSCryxPq5xWTFIaP8KSW0RYxqupaUf0RcTNSSdJZGcKYdYA6kdtrtmyBckfKXwqk0pHpUHlwWaffjNRBYFPUDWa8e3Lt/o0R0CdisKDM89cX0pvRHEfM8ca4t0s2Xx4kgo91MPQJ/0c9MQYq0co8MBh7bz1fio0UUHLR4aAIOvOmoYO6kwlEVODSSTliWtOtH6sPkrtctF9ZtJ9GIerBskvhdVS5cFNv9s1BU0AbdUgdK4FG+dRnjFmDTzniRMdZO1QhzMK355vigbdkpz9P6qjUGE5J2qAcXmwJ20cZUiAD0z+pGMx6xkzJkmEf40Hr4qZfVg2XzF9YOyoV5BjzVkUJngKf8lgNYwKECEHrCNDrWZzMlflS3yBhr/InyoUgBc/lKT4pxVrrC6g1YwcceK3BmNxZcAtz3j5EIpqguh9H6wc011YN75cKDLpFDxuwkrPQmUwW4KTbj9mZTwBwLq4aQMUZbHm1rylJ46dzR0dua2n3RYCWZsiHROeywyJGR7mXKlpryyCiouY56sFkBWEnkEB/raeh/Sw4162KeuAxMQpEkzy5alMY5wamMsWKKrtW2WpEWNnReZWONKWjrdsKZarpFjqCslq773PLmEhM448Pc3+FKr1+94vv/rfw4tEcu+lKTBe4kZSdijBrykwv9vbCMPcLQTygBjzVckSLPRVGslqdunwJ4oegtFOYb4SwxNgWLCmD7T9kVjTv5YDgpo0XBmN34Z/rEHp0sgyz7lngsrm4lvMm2Mr1zNOJYJ5cuxuQxwMGJq/TP5emlb8fsQBZviK4t8hFL+zbhtlpwaRSxQRWfeETjuauPsdGxsBVdO7nmP4xvzSoT29pRl7kGqz+k26B3Oy0YNV+SXbbQas1ctC/GarskRdFpKczVAF1ZXnLcpaMuzVe6lZ2g/1ndcvOVgRG3sdUAY1bKD6achijMPdMxV4muKVorSpiDHituH7rSTs7n/4y5DhRXo4FVBN4vO/zbAcxhENzGbHCzU/98Mcx5e7a31kWjw9FCe/zNeYyQjZsWb1uc7U33pN4Mji6hCLhivqfa9Ss6xLg031AgfesA/l99m9fgvnaF9JoE6bYKmkGNK3aPbHB96w3+DnxFm4hs0drLsk7U8kf/N/CvwQNtllna0rjq61sH8L80HAuvwH1tvBy2ChqWSCaYTaGN19sTvlfzFD6n+iKTbvtayfrfe9ueWh6GJFoxLdr7V72a5ZpvHcCPDzma0wTO4EgbLyedxstO81n57LYBOBzyfsOhUKsW1J1BB5vr/tz8RyqOFylQP9Tvst2JALsC5lsH8PyQ40DV4ANzYa4dedNiKNR1s+x2wwbR7q4/4cTxqEk4LWDebfisuo36JXLiWFjOtLrlNWh3K1rRS4xvHcDNlFnNmWBBAl5SWaL3oPOfnvbr5pdjVnEaeBJSYjuLEkyLLsWhKccadmOphZkOPgVdalj2QpSmfOsADhMWE2ZBu4+EEJI4wKTAuCoC4xwQbWXBltpxbjkXJtKxxabo9e7tyhlgb6gNlSbUpMh+l/FaqzVwewGu8BW1Zx7pTpQDJUjb8tsUTW6+GDXbMn3mLbXlXJiGdggxFAoUrtPS3wE4Nk02UZG2OOzlk7fRs7i95QCLo3E0jtrjnM7SR3uS1p4qtS2nJ5OwtQVHgOvArLBFijZUV9QtSl8dAY5d0E0hM0w3HS2DpIeB6m/A1+HfhJcGUq4sOxH+x3f5+VO+Ds9rYNI7zPXOYWPrtf8bYMx6fuOAX5jzNR0PdsuON+X1f7EERxMJJoU6GkTEWBvVolVlb5lh3tKCg6Wx1IbaMDdJ+9sUCc5KC46hKGCk3IVOS4TCqdBNfUs7Kd4iXf2RjnT/LLysJy3XDcHLh/vde3x8DoGvwgsa67vBk91G5Pe/HbOe7xwym0NXbtiuuDkGO2IJDh9oQvJ4cY4vdoqLDuoH9Zl2F/ofsekn8lkuhIlhQcffUtSjytFyp++p6NiE7Rqx/lodgKVoceEp/CP4FfjrquZaTtj2AvH5K/ywpn7M34K/SsoYDAdIN448I1/0/wveW289T1/lX5xBzc8N5IaHr0XMOQdHsIkDuJFifj20pBm5jzwUv9e2FhwRsvhAbalCIuIw3bhJihY3p6nTFFIZgiSYjfTf3aXuOjmeGn4bPoGvwl+CFzTRczBIuHBEeImHc37/lGfwZR0cXzVDOvaKfNHvwe+suZ771K/y/XcBlsoN996JpBhoE2toYxOznNEOS5TJc6Id5GEXLjrWo+LEWGNpPDU4WAwsIRROu+1vM+0oW37z/MBN9kqHnSArwPfgFJ7Cq/Ai3Ie7g7ncmI09v8sjzw9mzOAEXoIHxURueaAce5V80f/DOuuZwHM8vsMb5wBzOFWM7wymTXPAEvm4vcFpZ2ut0VZRjkiP2MlmLd6DIpbGSiHOjdnUHN90hRYmhTnmvhzp1iKDNj+b7t5hi79lWGwQ+HN9RsfFMy0FXbEwhfuczKgCbyxYwBmcFhhvo/7a44v+i3XWcwDP86PzpGQYdWh7csP5dBvZ1jNzdxC8pBGuxqSW5vw40nBpj5JhMwvOzN0RWqERHMr4Lv1kWX84xLR830G3j6yqZ1a8UstTlW+qJPOZ+sZ7xZPKTJLhiNOAFd6tk+jrTH31ncLOxid8+nzRb128HhUcru/y0Wn6iT254YPC6FtVSIMoW2sk727AhvTtrWKZTvgsmckfXYZWeNRXx/3YQ2OUxLDrbHtN11IwrgXT6c8dATDwLniYwxzO4RzuQqTKSC5gAofMZ1QBK3zQ4JWobFbcvJm87FK+6JXrKahLn54m3p+McXzzYtP8VF/QpJuh1OwieElEoI1pRxPS09FBrkq2tWCU59+HdhNtTIqKm8EBrw2RTOEDpG3IKo2Y7mFdLm3ZeVjYwVw11o/oznceMve4CgMfNym/utA/d/ILMR7gpXzRy9eDsgLcgbs8O2Va1L0zzIdwGGemTBuwROHeoMShkUc7P+ISY3KH5ZZeWqO8mFTxQYeXTNuzvvK5FGPdQfuu00DwYFY9dyhctEt+OJDdnucfpmyhzUJzfsJjr29l8S0bXBfwRS9ZT26tmMIdZucch5ZboMz3Nio3nIOsYHCGoDT4kUA9MiXEp9Xsui1S8th/kbWIrMBxDGLodWUQIWcvnXy+9M23xPiSMOiRPqM+YMXkUN3gXFrZJwXGzUaMpJfyRS9ZT0lPe8TpScuRlbMHeUmlaKDoNuy62iWNTWNFYjoxFzuJs8oR+RhRx7O4SVNSXpa0ZJQ0K1LAHDQ+D9IepkMXpcsq5EVCvClBUIzDhDoyKwDw1Lc59GbTeORivugw1IcuaEOaGWdNm+Ps5fQ7/tm0DjMegq3yM3vb5j12qUId5UZD2oxDSEWOZMSqFl/W+5oynWDa/aI04tJRQ2eTXusg86SQVu/nwSYwpW6wLjlqIzwLuxGIvoAvul0PS+ZNz0/akp/pniO/8JDnGyaCkzbhl6YcqmK/69prxPqtpx2+Km9al9sjL+rwMgHw4jE/C8/HQ3m1vBuL1fldbzd8mOueVJ92syqdEY4KJjSCde3mcRw2TA6szxedn+zwhZMps0XrqEsiUjnC1hw0TELC2Ek7uAAdzcheXv1BYLagspxpzSAoZZUsIzIq35MnFQ9DOrlNB30jq3L4pkhccKUAA8/ocvN1Rzx9QyOtERs4CVsJRK/DF71kPYrxYsGsm6RMh4cps5g1DOmM54Ly1ii0Hd3Y/BMk8VWFgBVmhqrkJCPBHAolwZaWzLR9Vb7bcWdX9NyUYE+uB2BKfuaeBUcjDljbYVY4DdtsVWvzRZdWnyUzDpjNl1Du3aloAjVJTNDpcIOVVhrHFF66lLfJL1zJr9PQ2nFJSBaKoDe+sAvLufZVHVzYh7W0h/c6AAZ+7Tvj6q9j68G/cTCS/3n1vLKHZwNi+P+pS0WkZNMBMUl+LDLuiE4omZy71r3UFMwNJV+VJ/GC5ixVUkBStsT4gGKh0Gm4Oy3qvq7Lbmq24nPdDuDR9deR11XzP4vFu3TYzfnIyiSVmgizUYGqkIXNdKTY9pgb9D2Ix5t0+NHkVzCdU03suWkkVZAoCONCn0T35gAeW38de43mf97sMOpSvj4aa1KYUm58USI7Wxxes03bAZdRzk6UtbzMaCQ6IxO0dy7X+XsjoD16hpsBeGz9dfzHj+R/Hp8nCxZRqkEDTaCKCSywjiaoMJ1TITE9eg7Jqnq8HL6gDwiZb0u0V0Rr/rmvqjxKuaLCX7ZWXTvAY+uvm3z8CP7nzVpngqrJpZKwWnCUjIviYVlirlGOzPLI3SMVyp/elvBUjjDkNhrtufFFErQ8pmdSlbK16toBHlt/HV8uHMX/vEGALkV3RJREiSlopxwdMXOZPLZ+ix+kAHpMKIk8UtE1ygtquttwxNhphrIZ1IBzjGF3IIGxGcBj6q8bHJBG8T9vdsoWrTFEuebEZuVxhhClH6P5Zo89OG9fwHNjtNQTpD0TG9PJLEYqvEY6Rlxy+ZZGfL0Aj62/bnQCXp//eeM4KzfQVJbgMQbUjlMFIm6TpcfWlZje7NBSV6IsEVmumWIbjiloUzQX9OzYdo8L1wjw2PrrpimONfmfNyzKklrgnEkSzT5QWYQW40YShyzqsRmMXbvVxKtGuYyMKaU1ugenLDm5Ily4iT14fP11Mx+xJv+zZ3MvnfdFqxU3a1W/FTB4m3Qfsyc1XUcdVhDeUDZXSFHHLQj/Y5jtC7ZqM0CXGwB4bP11i3LhOvzPGygYtiUBiwQV/4wFO0majijGsafHyRLu0yG6q35cL1rOpVxr2s5cM2jJYMCdc10Aj6q/blRpWJ//+dmm5psMl0KA2+AFRx9jMe2WbC4jQxnikd4DU8TwUjRVacgdlhmr3bpddzuJ9zXqr2xnxJfzP29RexdtjDVZqzkqa6PyvcojGrfkXiJ8SEtml/nYskicv0ivlxbqjemwUjMw5evdg8fUX9nOiC/lf94Q2i7MURk9nW1MSj5j8eAyV6y5CN2S6qbnw3vdA1Iwq+XOSCl663udN3IzLnrt+us25cI1+Z83SXQUldqQq0b5XOT17bGpLd6ssN1VMPf8c+jG8L3NeCnMdF+Ra3fRa9dft39/LuZ/3vwHoHrqGmQFafmiQw6eyzMxS05K4bL9uA+SKUQzCnSDkqOGokXyJvbgJ/BHI+qvY69//4rl20NsmK2ou2dTsyIALv/91/8n3P2Aao71WFGi8KKv1fRC5+J67Q/507/E/SOshqN5TsmYIjVt+kcjAx98iz/4SaojbIV1rexE7/C29HcYD/DX4a0rBOF5VTu7omsb11L/AWcVlcVZHSsqGuXLLp9ha8I//w3Mv+T4Ew7nTBsmgapoCrNFObIcN4pf/Ob/mrvHTGqqgAupL8qWjWPS9m/31jAe4DjA+4+uCoQoT/zOzlrNd3qd4SdphFxsUvYwGWbTWtISc3wNOWH+kHBMfc6kpmpwPgHWwqaSUG2ZWWheYOGQGaHB+eQ/kn6b3pOgLV+ODSn94wDvr8Bvb70/LLuiPPEr8OGVWfDmr45PZyccEmsVXZGe1pRNX9SU5+AVQkNTIVPCHF/jGmyDC9j4R9LfWcQvfiETmgMMUCMN1uNCakkweZsowdYobiMSlnKA93u7NzTXlSfe+SVbfnPQXmg9LpYAQxpwEtONyEyaueWM4FPjjyjG3uOaFmBTWDNgBXGEiQpsaWhnAqIijB07Dlsy3fUGeP989xbWkyf+FF2SNEtT1E0f4DYYVlxFlbaSMPIRMk/3iMU5pME2SIWJvjckciebkQuIRRyhUvkHg/iUljG5kzVog5hV7vIlCuBrmlhvgPfNHQM8lCf+FEGsYbMIBC0qC9a0uuy2wLXVbLBaP5kjHokCRxapkQyzI4QEcwgYHRZBp+XEFTqXFuNVzMtjXLJgX4gAid24Hjwc4N3dtVSe+NNiwTrzH4WVUOlDobUqr1FuAgYllc8pmzoVrELRHSIW8ViPxNy4xwjBpyR55I6J220qQTZYR4guvUICJiSpr9gFFle4RcF/OMB7BRiX8sSfhpNSO3lvEZCQfLUVTKT78Ek1LRLhWN+yLyTnp8qWUZ46b6vxdRGXfHVqx3eI75YaLa4iNNiK4NOW7wPW6lhbSOF9/M9qw8e/aoB3d156qTzxp8pXx5BKAsYSTOIIiPkp68GmTq7sZtvyzBQaRLNxIZ+paozHWoLFeExIhRBrWitHCAHrCF7/thhD8JhYz84wg93QRV88wLuLY8zF8sQ36qF1J455bOlgnELfshKVxYOXKVuKx0jaj22sczTQqPqtV/XDgpswmGTWWMSDw3ssyUunLLrVPGjYRsH5ggHeHSWiV8kT33ycFSfMgkoOK8apCye0J6VW6GOYvffgU9RWsukEi2kUV2nl4dOYUzRik9p7bcA4ggdJ53LxKcEe17B1R8eqAd7dOepV8sTXf5lhejoL85hUdhDdknPtKHFhljOT+bdq0hxbm35p2nc8+Ja1Iw+tJykgp0EWuAAZYwMVwac5KzYMslhvgHdHRrxKnvhTYcfKsxTxtTETkjHO7rr3zjoV25lAQHrqpV7bTiy2aXMmUhTBnKS91jhtR3GEoF0oLnWhWNnYgtcc4N0FxlcgT7yz3TgNIKkscx9jtV1ZKpWW+Ub1tc1eOv5ucdgpx+FJy9pgbLE7xDyXb/f+hLHVGeitHOi6A7ybo3sF8sS7w7cgdk0nJaOn3hLj3uyD0Zp5pazFIUXUpuTTU18d1EPkDoX8SkmWTnVIozEdbTcZjoqxhNHf1JrSS/AcvHjZ/SMHhL/7i5z+POsTUh/8BvNfYMTA8n+yU/MlTZxSJDRStqvEuLQKWwDctMTQogUDyQRoTQG5Kc6oQRE1yV1jCA7ri7jdZyK0sYTRjCR0Hnnd+y7nHxNgTULqw+8wj0mQKxpYvhjm9uSUxg+TTy7s2GtLUGcywhXSKZN275GsqlclX90J6bRI1aouxmgL7Q0Nen5ziM80SqMIo8cSOo+8XplT/5DHNWsSUr/6lLN/QQ3rDyzLruEW5enpf7KqZoShEduuSFOV7DLX7Ye+GmXb6/hnNNqKsVXuMDFpb9Y9eH3C6NGEzuOuI3gpMH/I6e+zDiH1fXi15t3vA1czsLws0TGEtmPEJdiiFPwlwKbgLHAFk4P6ZyPdymYYHGE0dutsChQBl2JcBFlrEkY/N5bQeXQ18gjunuMfMfsBlxJSx3niO485fwO4fGD5T/+3fPQqkneWVdwnw/3bMPkW9Wbqg+iC765Zk+xcT98ibKZc2EdgHcLoF8cSOo/Oc8fS+OyEULF4g4sJqXVcmfMfsc7A8v1/yfGXmL9I6Fn5pRwZhsPv0TxFNlAfZCvG+Oohi82UC5f/2IsJo0cTOm9YrDoKhFPEUr/LBYTUNht9zelHXDqwfPCIw4owp3mOcIQcLttWXFe3VZ/j5H3cIc0G6oPbCR+6Y2xF2EC5cGUm6wKC5tGEzhsWqw5hNidUiKX5gFWE1GXh4/Qplw4sVzOmx9QxU78g3EF6wnZlEN4FzJ1QPSLEZz1KfXC7vd8ssGdIbNUYpVx4UapyFUHzJoTOo1McSkeNn1M5MDQfs4qQuhhX5vQZFw8suwWTcyYTgioISk2YdmkhehG4PkE7w51inyAGGaU+uCXADabGzJR1fn3lwkty0asIo8cROm9Vy1g0yDxxtPvHDAmpu+PKnM8Ix1wwsGw91YJqhteaWgjYBmmQiebmSpwKKzE19hx7jkzSWOm66oPbzZ8Yj6kxVSpYjVAuvLzYMCRo3oTQecOOjjgi3NQ4l9K5/hOGhNTdcWVOTrlgYNkEXINbpCkBRyqhp+LdRB3g0OU6rMfW2HPCFFMV9nSp+uB2woepdbLBuJQyaw/ZFysXrlXwHxI0b0LovEkiOpXGA1Ijagf+KUNC6rKNa9bQnLFqYNkEnMc1uJrg2u64ELPBHpkgWbmwKpJoDhMwNbbGzAp7Yg31wS2T5rGtzit59PrKhesWG550CZpHEzpv2NGRaxlNjbMqpmEIzygJqQfjypycs2pg2cS2RY9r8HUqkqdEgKTWtWTKoRvOBPDYBltja2SO0RGjy9UHtxwRjA11ujbKF+ti5cIR9eCnxUg6owidtyoU5tK4NLji5Q3HCtiyF2IqLGYsHViOXTXOYxucDqG0HyttqYAKqYo3KTY1ekyDXRAm2AWh9JmsVh/ccg9WJ2E8YjG201sPq5ULxxX8n3XLXuMInbft2mk80rRGjCGctJ8/GFdmEQ9Ug4FlE1ll1Y7jtiraqm5Fe04VV8lvSVBL8hiPrfFVd8+7QH3Qbu2ipTVi8cvSGivc9cj8yvH11YMHdNSERtuOslM97feYFOPKzGcsI4zW0YGAbTAOaxCnxdfiYUmVWslxiIblCeAYr9VYR1gM7GmoPrilunSxxeT3DN/2eBQ9H11+nk1adn6VK71+5+Jfct4/el10/7KBZfNryUunWSCPxPECk1rdOv1WVSrQmpC+Tl46YD3ikQYcpunSQgzVB2VHFhxHVGKDgMEY5GLlQnP7FMDzw7IacAWnO6sBr12u+XanW2AO0wQ8pknnFhsL7KYIqhkEPmEXFkwaN5KQphbkUmG72wgw7WSm9RiL9QT925hkjiVIIhphFS9HKI6/8QAjlpXqg9W2C0apyaVDwKQwrwLY3j6ADR13ZyUNByQXHQu6RY09Hu6zMqXRaNZGS/KEJs0cJEe9VH1QdvBSJv9h09eiRmy0V2uJcqHcShcdvbSNg5fxkenkVprXM9rDVnX24/y9MVtncvbKY706anNl3ASll9a43UiacVquXGhvq4s2FP62NGKfQLIQYu9q1WmdMfmUrDGt8eDS0cXozH/fjmUH6Jruvm50hBDSaEU/2Ru2LEN/dl006TSc/g7tfJERxGMsgDUEr104pfWH9lQaN+M4KWQjwZbVc2rZVNHsyHal23wZtIs2JJqtIc/WLXXRFCpJkfE9jvWlfFbsNQ9pP5ZBS0zKh4R0aMFj1IjTcTnvi0Zz2rt7NdvQb2mgbju1plsH8MmbnEk7KbK0b+wC2iy3aX3szW8xeZvDwET6hWZYwqTXSSG+wMETKum0Dq/q+x62gt2ua2ppAo309TRk9TPazfV3qL9H8z7uhGqGqxNVg/FKx0HBl9OVUORn8Q8Jx9gFttGQUDr3tzcXX9xGgN0EpzN9mdZ3GATtPhL+CjxFDmkeEU6x56kqZRusLzALXVqkCN7zMEcqwjmywDQ6OhyUe0Xao1Qpyncrg6wKp9XfWDsaZplElvQ/b3sdweeghorwBDlHzgk1JmMc/wiERICVy2VJFdMjFuLQSp3S0W3+sngt2njwNgLssFGVQdJ0tu0KH4ky1LW4yrbkuaA6Iy9oz/qEMMXMMDWyIHhsAyFZc2peV9hc7kiKvfULxCl9iddfRK1f8kk9qvbdOoBtOg7ZkOZ5MsGrSHsokgLXUp9y88smniwWyuFSIRVmjplga3yD8Uij5QS1ZiM4U3Qw5QlSm2bXjFe6jzzBFtpg+/YBbLAWG7OPynNjlCw65fukGNdkJRf7yM1fOxVzbxOJVocFoYIaGwH22mIQkrvu1E2nGuebxIgW9U9TSiukPGU+Lt++c3DJPKhyhEEbXCQLUpae2exiKy6tMPe9mDRBFCEMTWrtwxN8qvuGnt6MoihKWS5NSyBhbH8StXoAz8PLOrRgLtOT/+4vcu+7vDLnqNvztOq7fmd8sMmY9Xzn1zj8Dq8+XVdu2Nv0IIySgEdQo3xVHps3Q5i3fLFsV4aiqzAiBhbgMDEd1uh8qZZ+lwhjkgokkOIv4xNJmyncdfUUzgB4oFMBtiu71Xumpz/P+cfUP+SlwFExwWW62r7b+LSPxqxn/gvMZ5z9C16t15UbNlq+jbGJtco7p8wbYlL4alSyfWdeuu0j7JA3JFNuVAwtst7F7FhWBbPFNKIUORndWtLraFLmMu7KFVDDOzqkeaiN33YAW/r76wR4XDN/yN1z7hejPau06EddkS/6XThfcz1fI/4K736fO48vlxt2PXJYFaeUkFS8U15XE3428xdtn2kc8GQlf1vkIaNRRnOMvLTWrZbElEHeLWi1o0dlKPAh1MVgbbVquPJ5+Cr8LU5/H/+I2QlHIU2ClXM9G8v7Rr7oc/hozfUUgsPnb3D+I+7WF8kNO92GY0SNvuxiE+2Bt8prVJTkzE64sfOstxuwfxUUoyk8VjcTlsqe2qITSFoSj6Epd4KsT6BZOWmtgE3hBfir8IzZDwgV4ZTZvD8VvPHERo8v+vL1DASHTz/i9OlKueHDjK5Rnx/JB1Vb1ioXdBra16dmt7dgik10yA/FwJSVY6XjA3oy4SqM2frqDPPSRMex9qs3XQtoWxMj7/Er8GWYsXgjaVz4OYumP2+9kbxvny/6kvWsEBw+fcb5bInc8APdhpOSs01tEqIkoiZjbAqKMruLbJYddHuHFRIyJcbdEdbl2sVLaySygunutBg96Y2/JjKRCdyHV+AEFtTvIpbKIXOamknYSiB6KV/0JetZITgcjjk5ZdaskBtWO86UF0ap6ozGXJk2WNiRUlCPFir66lzdm/SLSuK7EUdPz8f1z29Skq6F1fXg8+5UVR6bszncP4Tn4KUkkdJ8UFCY1zR1i8RmL/qQL3rlei4THG7OODlnKko4oI01kd3CaM08Ia18kC3GNoVaO9iDh+hWxSyTXFABXoau7Q6q9OxYg/OVEMw6jdbtSrJ9cBcewGmaZmg+bvkUnUUaGr+ZfnMH45Ivevl61hMcXsxYLFTu1hTm2zViCp7u0o5l+2PSUh9bDj6FgYypufBDhqK2+oXkiuHFHR3zfj+9PtA8oR0xnqX8qn+sx3bFODSbbF0X8EUvWQ8jBIcjo5bRmLOljDNtcqNtOe756h3l0VhKa9hDd2l1eqmsnh0MNMT/Cqnx6BInumhLT8luljzQ53RiJeA/0dxe5NK0o2fA1+GLXr6eNQWHNUOJssQaTRlGpLHKL9fD+IrQzTOMZS9fNQD4AnRNVxvTdjC+fJdcDDWQcyB00B0t9BDwTxXgaAfzDZ/DBXzRnfWMFRwuNqocOmX6OKNkY63h5n/fFcB28McVHqnXZVI27K0i4rDLNE9lDKV/rT+udVbD8dFFu2GGZ8mOt0kAXcoX3ZkIWVtw+MNf5NjR2FbivROHmhV1/pj2egv/fMGIOWTIWrV3Av8N9imV9IWml36H6cUjqEWNv9aNc+veb2sH46PRaHSuMBxvtW+twxctq0z+QsHhux8Q7rCY4Ct8lqsx7c6Sy0dl5T89rIeEuZKoVctIk1hNpfavER6yyH1Vvm3MbsUHy4ab4hWr/OZPcsRBphnaV65/ZcdYPNNwsjN/djlf9NqCw9U5ExCPcdhKxUgLSmfROpLp4WSUr8ojdwbncbvCf+a/YzRaEc6QOvXcGO256TXc5Lab9POvB+AWY7PigWYjzhifbovuunzRawsO24ZqQQAqguBtmpmPB7ysXJfyDDaV/aPGillgz1MdQg4u5MYaEtBNNHFjkRlSpd65lp4hd2AVPTfbV7FGpyIOfmNc/XVsPfg7vzaS/3nkvLL593ANLvMuRMGpQIhiF7kUEW9QDpAUbTWYBcbp4WpacHHY1aacqQyjGZS9HI3yCBT9kUZJhVOD+zUDvEH9ddR11fzPcTDQ5TlgB0KwqdXSavk9BC0pKp0WmcuowSw07VXmXC5guzSa4p0UvRw2lbDiYUx0ExJJRzWzi6Gm8cnEkfXXsdcG/M/jAJa0+bmCgdmQ9CYlNlSYZOKixmRsgiFxkrmW4l3KdFKv1DM8tk6WxPYJZhUUzcd8Kdtgrw/gkfXXDT7+avmfVak32qhtkg6NVdUS5wgkru1YzIkSduTW1FDwVWV3JQVJVuieTc0y4iDpFwc7/BvSalvKdQM8sv662cevz/+8sQVnjVAT0W2wLllw1JiMhJRxgDjCjLQsOzSFSgZqx7lAW1JW0e03yAD3asC+GD3NbQhbe+mN5GXH1F83KDOM4n/e5JIuH4NpdQARrFPBVptUNcjj4cVMcFSRTE2NpR1LEYbYMmfWpXgP9KejaPsLUhuvLCsVXznAG9dfx9SR1ud/3hZdCLHb1GMdPqRJgqDmm76mHbvOXDtiO2QPUcKo/TWkQ0i2JFXpBoo7vij1i1Lp3ADAo+qvG3V0rM//vFnnTE4hxd5Ka/Cor5YEdsLVJyKtDgVoHgtW11pWSjolPNMnrlrVj9Fv2Qn60twMwKPqr+N/wvr8z5tZcDsDrv06tkqyzESM85Ycv6XBWA2birlNCXrI6VbD2lx2L0vQO0QVTVVLH4SE67fgsfVXv8n7sz7/85Z7cMtbE6f088wSaR4kCkCm10s6pKbJhfqiUNGLq+0gLWC6eUAZFPnLjwqtKd8EwGvWX59t7iPW4X/eAN1svgRVSY990YZg06BD1ohLMtyFTI4pKTJsS9xREq9EOaPWiO2gpms7397x6nQJkbh+Fz2q/rqRROX6/M8bJrqlVW4l6JEptKeUFuMYUbtCQ7CIttpGc6MY93x1r1vgAnRXvY5cvwWPqb9uWQm+lP95QxdNMeWhOq1x0Db55C7GcUv2ZUuN6n8iKzsvOxibC//Yfs9Na8r2Rlz02vXXDT57FP/zJi66/EJSmsJKa8QxnoqW3VLQ+jZVUtJwJ8PNX1NQCwfNgdhhHD9on7PdRdrdGPF28rJr1F+3LBdeyv+8yYfLoMYet1vX4upNAjVvwOUWnlNXJXlkzk5Il6kqeoiL0C07qno+/CYBXq/+utlnsz7/Mzvy0tmI4zm4ag23PRN3t/CWryoUVJGm+5+K8RJ0V8Hc88/XHUX/HfiAq7t+BH+x6v8t438enWmdJwFA6ZINriLGKv/95f8lT9/FnyA1NMVEvQyaXuu+gz36f/DD73E4pwqpLcvm/o0Vle78n//+L/NPvoefp1pTJye6e4A/D082FERa5/opeH9zpvh13cNm19/4v/LDe5xMWTi8I0Ta0qKlK27AS/v3/r+/x/2GO9K2c7kVMonDpq7//jc5PKCxeNPpFVzaRr01wF8C4Pu76hXuX18H4LduTr79guuFD3n5BHfI+ZRFhY8w29TYhbbLi/bvBdqKE4fUgg1pBKnV3FEaCWOWyA+m3WpORZr/j+9TKJtW8yBTF2/ZEODI9/QavHkVdGFp/Pjn4Q+u5hXapsP5sOH+OXXA1LiKuqJxiMNbhTkbdJTCy4llEt6NnqRT4dhg1V3nbdrm6dYMecA1yTOL4PWTE9L5VzPFlLBCvlG58AhehnN4uHsAYinyJ+AZ/NkVvELbfOBUuOO5syBIEtiqHU1k9XeISX5bsimrkUUhnGDxourN8SgUsCZVtKyGbyGzHXdjOhsAvOAswSRyIBddRdEZWP6GZhNK/yjwew9ehBo+3jEADu7Ay2n8mDc+TS7awUHg0OMzR0LABhqLD4hJEh/BEGyBdGlSJoXYXtr+3HS4ijzVpgi0paWXtdruGTknXBz+11qT1Q2inxaTzQCO46P3lfLpyS4fou2PH/PupwZgCxNhGlj4IvUuWEsTkqMWm6i4xCSMc9N1RDQoCVcuGItJ/MRWefais+3synowi/dESgJjkilnWnBTGvRWmaw8oR15257t7CHmCf8HOn7cwI8+NQBXMBEmAa8PMRemrNCEhLGEhDQKcGZWS319BX9PFBEwGTbRBhLbDcaV3drFcDqk5kCTd2JF1Wp0HraqBx8U0wwBTnbpCadwBA/gTH/CDrcCs93LV8E0YlmmcyQRQnjBa8JESmGUfIjK/7fkaDJpmD2QptFNVJU1bbtIAjjWQizepOKptRjbzR9Kag6xZmMLLjHOtcLT3Tx9o/0EcTT1XN3E45u24AiwEypDJXihKjQxjLprEwcmRKclaDNZCVqr/V8mYWyFADbusiY5hvgFoU2vio49RgJLn5OsReRFN6tabeetiiy0V7KFHT3HyZLx491u95sn4K1QQSPKM9hNT0wMVvAWbzDSVdrKw4zRjZMyJIHkfq1VAVCDl/bUhNKlGq0zGr05+YAceXVPCttVk0oqjVwMPt+BBefx4yPtGVkUsqY3CHDPiCM5ngupUwCdbkpd8kbPrCWHhkmtIKLEetF2499eS1jZlIPGYnlcPXeM2KD9vLS0bW3ktYNqUllpKLn5ZrsxlIzxvDu5eHxzGLctkZLEY4PgSOg2IUVVcUONzUDBEpRaMoXNmUc0tFZrTZquiLyKxrSm3DvIW9Fil+AkhXu5PhEPx9mUNwqypDvZWdKlhIJQY7vn2OsnmBeOWnYZ0m1iwbbw1U60by5om47iHRV6fOgzjMf/DAZrlP40Z7syxpLK0lJ0gqaAK1c2KQKu7tabTXkLFz0sCftuwX++MyNeNn68k5Buq23YQhUh0SNTJa1ioQ0p4nUG2y0XilF1JqODqdImloPS4Bp111DEWT0jJjVv95uX9BBV7eB3bUWcu0acSVM23YZdd8R8UbQUxJ9wdu3oMuhdt929ME+mh6JXJ8di2RxbTi6TbrDquqV4aUKR2iwT6aZbyOwEXN3DUsWr8Hn4EhwNyHuXHh7/pdaUjtR7vnDh/d8c9xD/s5f501eQ1+CuDiCvGhk1AN/4Tf74RfxPwD3toLarR0zNtsnPzmS64KIRk861dMWCU8ArasG9T9H0ZBpsDGnjtAOM2+/LuIb2iIUGXNgl5ZmKD/Tw8TlaAuihaFP5yrw18v4x1898zIdP+DDAX1bM3GAMvPgRP/cJn3zCW013nrhHkrITyvYuwOUkcHuKlRSW5C6rzIdY4ppnF7J8aAJbQepgbJYBjCY9usGXDKQxq7RZfh9eg5d1UHMVATRaD/4BHK93/1iAgYZ/+jqPn8Dn4UExmWrpa3+ZOK6MvM3bjwfzxNWA2dhs8+51XHSPJiaAhGSpWevEs5xHLXcEGFXYiCONySH3fPWq93JIsBiSWvWyc3CAN+EcXoT7rCSANloPPoa31rt/5PUA/gp8Q/jDD3hyrjzlR8VkanfOvB1XPubt17vzxAfdSVbD1pzAnfgyF3ycadOTOTXhpEUoLC1HZyNGW3dtmjeXgr2r56JNmRwdNNWaQVBddd6rh4MhviEB9EFRD/7RGvePvCbwAL4Mx/D6M541hHO4D3e7g6PafdcZVw689z7NGTwo5om7A8sPhccT6qKcl9NJl9aM/9kX+e59Hh1yPqGuCCZxuITcsmNaJ5F7d0q6J3H48TO1/+M57085q2icdu2U+W36Ldllz9Agiv4YGljoEN908EzvDOrBF98/vtJwCC/BF2AG75xxEmjmMIcjxbjoaxqOK3/4hPOZzhMPBpYPG44CM0dTVm1LjLtUWWVz1Bcf8tEx0zs8O2A2YVHRxKYOiy/aOVoAaMu0i7ubu43njjmd4ibMHU1sIDHaQNKrZND/FZYdk54oCXetjq7E7IVl9eAL7t+oHnwXXtLx44czzoRFHBztYVwtH1d+NOMkupZ5MTM+gUmq90X+Bh9zjRlmaQ+m7YMqUL/veemcecAtOJ0yq1JnVlN27di2E0+Klp1tAJ4KRw1eMI7aJjsO3R8kPSI3fUFXnIOfdQe86sIIVtWDL7h//Ok6vj8vwDk08NEcI8zz7OhBy+WwalzZeZ4+0XniRfst9pAJqQHDGLzVQ2pheZnnv1OWhwO43/AgcvAEXEVVpa4db9sGvNK8wjaENHkfFQ4Ci5i7dqnQlPoLQrHXZDvO3BIXZbJOBrOaEbML6sFL798I4FhKihjHMsPjBUZYCMFr6nvaArxqXPn4lCa+cHfSa2cP27g3Z3ziYTRrcbQNGLQmGF3F3cBdzzzX7AILx0IB9rbwn9kx2G1FW3Inic+ZLIsVvKR8Zwfj0l1fkqo8LWY1M3IX14OX3r9RKTIO+d9XzAI8qRPGPn/4NC2n6o4rN8XJ82TOIvuVA8zLKUHRFgBCetlDZlqR1gLKjS39xoE7Bt8UvA6BxuEDjU3tFsEijgA+615tmZkXKqiEENrh41iLDDZNq4pKTWR3LZfnos81LOuNa15cD956vLMsJd1rqYp51gDUQqMYm2XsxnUhD2jg1DM7SeuJxxgrmpfISSXVIJIS5qJJSvJPEQ49DQTVIbYWJ9QWa/E2+c/oPK1drmC7WSfJRNKBO5Yjvcp7Gc3dmmI/Xh1kDTEuiSnWqQf37h+fTMhGnDf6dsS8SQfQWlqqwXXGlc/PEZ/SC5mtzIV0nAshlQdM/LvUtYutrEZ/Y+EAFtq1k28zQhOwLr1AIeANzhF8t9qzTdZf2qRKO6MWE9ohBYwibbOmrFtNmg3mcS+tB28xv2uKd/agYCvOP+GkSc+0lr7RXzyufL7QbkUpjLjEWFLqOIkAGu2B0tNlO9Eau2W1qcOUvVRgKzypKIQZ5KI3q0MLzqTNRYqiZOqmtqloIRlmkBHVpHmRYV6/HixbO6UC47KOFJnoMrVyr7wYz+SlW6GUaghYbY1I6kkxA2W1fSJokUdSh2LQ1GAimRGm0MT+uu57H5l7QgOWxERpO9moLRPgTtquWCfFlGlIjQaRly9odmzMOWY+IBO5tB4sW/0+VWGUh32qYk79EidWKrjWuiLpiVNGFWFRJVktyeXWmbgBBzVl8anPuXyNJlBJOlKLTgAbi/EYHVHxWiDaVR06GnHQNpJcWcK2jJtiCfG2sEHLzuI66sGrMK47nPIInPnu799935aOK2cvmvubrE38ZzZjrELCmXM2hM7UcpXD2oC3+ECVp7xtIuxptJ0jUr3sBmBS47TVxlvJ1Sqb/E0uLdvLj0lLr29ypdd/eMX3f6lrxGlKwKQxEGvw0qHbkbwrF3uHKwVENbIV2wZ13kNEF6zD+x24aLNMfDTCbDPnEikZFyTNttxWBXDaBuM8KtI2rmaMdUY7cXcUPstqTGvBGSrFWIpNMfbdea990bvAOC1YX0qbc6smDS1mPxSJoW4fwEXvjMmhlijDRq6qale6aJEuFGoppYDoBELQzLBuh/mZNx7jkinv0EtnUp50lO9hbNK57lZaMAWuWR5Yo9/kYwcYI0t4gWM47Umnl3YmpeBPqSyNp3K7s2DSAS/39KRuEN2bS4xvowV3dFRMx/VFcp2Yp8w2nTO9hCXtHG1kF1L4KlrJr2wKfyq77R7MKpFKzWlY9UkhYxyHWW6nBWPaudvEAl3CGcNpSXPZ6R9BbBtIl6cHL3gIBi+42CYXqCx1gfGWe7Ap0h3luyXdt1MKy4YUT9xSF01G16YEdWsouW9mgDHd3veyA97H+Ya47ZmEbqMY72oPztCGvK0onL44AvgC49saZKkWRz4veWljE1FHjbRJaWv6ZKKtl875h4CziFCZhG5rx7tefsl0aRT1bMHZjm8dwL/6u7wCRysaQblQoG5yAQN5zpatMNY/+yf8z+GLcH/Qn0iX2W2oEfXP4GvwQHuIL9AYGnaO3zqAX6946nkgqZNnUhx43DIdQtMFeOPrgy/y3Yd85HlJWwjLFkU3kFwq28xPnuPhMWeS+tDLV9Otllq7pQCf3uXJDN9wFDiUTgefHaiYbdfi3b3u8+iY6TnzhgehI1LTe8lcd7s1wJSzKbahCRxKKztTLXstGAiu3a6rPuQs5pk9TWAan5f0BZmGf7Ylxzzk/A7PAs4QPPPAHeFQ2hbFHszlgZuKZsJcUmbDC40sEU403cEjczstOEypa+YxevL4QBC8oRYqWdK6b7sK25tfE+oDZgtOQ2Jg8T41HGcBE6fTWHn4JtHcu9S7uYgU5KSCkl/mcnq+5/YBXOEr6lCUCwOTOM1taOI8mSxx1NsCXBEmLKbMAg5MkwbLmpBaFOPrNSlO2HnLiEqW3tHEwd8AeiQLmn+2gxjC3k6AxREqvKcJbTEzlpLiw4rNZK6oJdidbMMGX9FULKr0AkW+2qDEPBNNm5QAt2Ik2nftNWHetubosHLo2nG4vQA7GkcVCgVCgaDixHqo9UUn1A6OshapaNR/LPRYFV8siT1cCtJE0k/3WtaNSuUZYKPnsVIW0xXWnMUxq5+En4Kvw/MqQmVXnAXj9Z+9zM98zM/Agy7F/qqj2Nh67b8HjFnPP3iBn/tkpdzwEJX/whIcQUXOaikeliCRGUk7tiwF0rItwMEhjkZ309hikFoRAmLTpEXWuHS6y+am/KB/fM50aLEhGnSMwkpxzOov4H0AvgovwJ1iGzDLtJn/9BU+fAINfwUe6FHSLhu83viV/+/HrOePX+STT2B9uWGbrMHHLldRBlhS/CJQmcRxJFqZica01XixAZsYiH1uolZxLrR/SgxVIJjkpQP4PE9sE59LKLr7kltSBogS5tyszzH8Fvw8/AS8rNOg0xUS9fIaHwb+6et8Q/gyvKRjf5OusOzGx8evA/BP4IP11uN/grca5O0lcsPLJ5YjwI4QkJBOHa0WdMZYGxPbh2W2nR9v3WxEWqgp/G3+6VZbRLSAAZ3BhdhAaUL33VUSw9yjEsvbaQ9u4A/gGXwZXoEHOuU1GSj2chf+Mo+f8IcfcAxfIKVmyunRbYQVnoevwgfw3TXXcw++xNuP4fhyueEUNttEduRVaDttddoP0eSxLe2LENk6itYxlrxBNBYrNNKSQmeaLcm9c8UsaB5WyO6675yyQIAWSDpBVoA/gxmcwEvwoDv0m58UE7gHn+fJOa8/Ywan8EKRfjsopF83eCglX/Sfr7OeaRoQfvt1CGvIDccH5BCvw1sWIzRGC/66t0VTcLZQZtm6PlAasbOJ9iwWtUo7biktTSIPxnR24jxP1ZKaqq+2RcXM9OrBAm/AAs7hDJ5bNmGb+KIfwCs8a3jnjBrOFeMjHSCdbKr+2uOLfnOd9eiA8Hvvwwq54VbP2OqwkB48Ytc4YEOiH2vTXqodabfWEOzso4qxdbqD5L6tbtNPECqbhnA708DZH4QOJUXqScmUlks7Ot6FBuZw3n2mEbaUX7kDzxHOOQk8nKWMzAzu6ZZ8sOFw4RK+6PcuXo9tB4SbMz58ApfKDXf3szjNIIbGpD5TKTRxGkEMLjLl+K3wlWXBsCUxIDU+jbOiysESqAy1MGUJpXgwbTWzNOVEziIXZrJ+VIztl1PUBxTSo0dwn2bOmfDRPD3TRTGlfbCJvO9KvuhL1hMHhB9wPuPRLGHcdOWG2xc0U+5bQtAJT0nRTewXL1pgk2+rZAdeWmz3jxAqfNQQdzTlbF8uJ5ecEIWvTkevAHpwz7w78QujlD/Lr491bD8/1vhM2yrUQRrWXNQY4fGilfctMWYjL72UL/qS9eiA8EmN88nbNdour+PBbbAjOjIa4iBhfFg6rxeKdEGcL6p3EWR1Qq2Qkhs2DrnkRnmN9tG2EAqmgPw6hoL7Oza7B+3SCrR9tRftko+Lsf2F/mkTndN2LmzuMcKTuj/mX2+4Va3ki16+nnJY+S7MefpkidxwnV+4wkXH8TKnX0tsYzYp29DOOoSW1nf7nTh2akYiWmcJOuTidSaqESrTYpwjJJNVGQr+rLI7WsqerHW6Kp/oM2pKuV7T1QY9gjqlZp41/WfKpl56FV/0kvXQFRyeQ83xaTu5E8p5dNP3dUF34ihyI3GSpeCsywSh22ZJdWto9winhqifb7VRvgktxp13vyjrS0EjvrRfZ62uyqddSWaWYlwTPAtJZ2oZ3j/Sgi/mi+6vpzesfAcWNA0n8xVyw90GVFGuZjTXEQy+6GfLGLMLL523f5E0OmxVjDoOuRiH91RKU+vtoCtH7TgmvBLvtFXWLW15H9GTdVw8ow4IlRLeHECN9ym1e9K0I+Cbnhgv4Yu+aD2HaQJ80XDqOzSGAV4+4yCqBxrsJAX6ZTIoX36QnvzhhzzMfFW2dZVLOJfo0zbce5OvwXMFaZ81mOnlTVXpDZsQNuoYWveketKb5+6JOOsgX+NTm7H49fUTlx+WLuWL7qxnOFh4BxpmJx0p2gDzA/BUARuS6phR+pUsY7MMboAHx5xNsSVfVZcYSwqCKrqon7zM+8ecCkeS4nm3rINuaWvVNnMRI1IRpxTqx8PZUZ0Br/UEduo3B3hNvmgZfs9gQPj8vIOxd2kndir3awvJ6BLvoUuOfFWNYB0LR1OQJoUySKb9IlOBx74q1+ADC2G6rOdmFdJcD8BkfualA+BdjOOzP9uUhGUEX/TwhZsUduwRr8wNuXKurCixLBgpQI0mDbJr9dIqUuV+92ngkJZ7xduCk2yZKbfWrH1VBiTg9VdzsgRjW3CVXCvAwDd+c1z9dWw9+B+8MJL/eY15ZQ/HqvTwVdsZn5WQsgRRnMaWaecu3jFvMBEmgg+FJFZsnSl0zjB9OqPYaBD7qmoVyImFvzi41usesV0julaAR9dfR15Xzv9sEruRDyk1nb+QaLU67T885GTls6YgcY+UiMa25M/pwGrbCfzkvR3e0jjtuaFtnwuagHTSb5y7boBH119HXhvwP487jJLsLJ4XnUkHX5sLbS61dpiAXRoZSCrFJ+EjpeU3puVfitngYNo6PJrAigKktmwjyQdZpfq30mmtulaAx9Zfx15Xzv+cyeuiBFUs9zq8Kq+XB9a4PVvph3GV4E3y8HENJrN55H1X2p8VyqSKwVusJDKzXOZzplWdzBUFK9e+B4+uv468xvI/b5xtSAkBHQaPvtqWzllVvEOxPbuiE6+j2pvjcKsbvI7txnRErgfH7LdXqjq0IokKzga14GzQ23SSbCQvO6r+Or7SMIr/efOkkqSdMnj9mBx2DRsiY29Uj6+qK9ZrssCKaptR6HKURdwUYeUWA2kPzVKQO8ku2nU3Anhs/XWkBx3F/7wJtCTTTIKftthue1ty9xvNYLY/zo5KSbIuKbXpbEdSyeRyYdAIwKY2neyoc3+k1XUaufYga3T9daMUx/r8z1s10ITknIO0kuoMt+TB8jK0lpayqqjsJ2qtXAYwBU932zinimgmd6mTRDnQfr88q36NAI+tv24E8Pr8zxtasBqx0+xHH9HhlrwsxxNUfKOHQaZBITNf0uccj8GXiVmXAuPEAKSdN/4GLHhs/XWj92dN/uetNuBMnVR+XWDc25JLjo5Mg5IZIq226tmCsip2zZliL213YrTlL2hcFjpCduyim3M7/eB16q/blQsv5X/esDRbtJeabLIosWy3ycavwLhtxdWzbMmHiBTiVjJo6lCLjXZsi7p9PEPnsq6X6wd4bP11i0rD5fzPm/0A6brrIsllenZs0lCJlU4abakR59enZKrKe3BZihbTxlyZ2zl1+g0wvgmA166/bhwDrcn/7Ddz0eWZuJvfSESug6NzZsox3Z04FIxz0mUjMwVOOVTq1CQ0AhdbBGVdjG/CgsfUX7esJl3K/7ytWHRv683praW/8iDOCqWLLhpljDY1ZpzK75QiaZoOTpLKl60auHS/97oBXrv+umU9+FL+5+NtLFgjqVLCdbmj7pY5zPCPLOHNCwXGOcLquOhi8CmCWvbcuO73XmMUPab+ug3A6/A/78Bwe0bcS2+tgHn4J5pyS2WbOck0F51Vq3LcjhLvZ67p1ABbaL2H67bg78BfjKi/jr3+T/ABV3ilLmNXTI2SpvxWBtt6/Z//D0z/FXaGbSBgylzlsEGp+5//xrd4/ae4d8DUUjlslfIYS3t06HZpvfQtvv0N7AHWqtjP2pW08QD/FLy//da38vo8PNlKHf5y37Dxdfe/oj4kVIgFq3koLReSR76W/bx//n9k8jonZxzWTANVwEniDsg87sOSd/z7//PvMp3jQiptGVWFX2caezzAXwfgtzYUvbr0iozs32c3Uge7varH+CNE6cvEYmzbPZ9hMaYDdjK4V2iecf6EcEbdUDVUARda2KzO/JtCuDbNQB/iTeL0EG1JSO1jbXS+nLxtPMDPw1fh5+EPrgSEKE/8Gry5A73ui87AmxwdatyMEBCPNOCSKUeRZ2P6Myb5MRvgCHmA9ywsMifU+AYXcB6Xa5GibUC5TSyerxyh0j6QgLVpdyhfArRTTLqQjwe4HOD9s92D4Ap54odXAPBWLAwB02igG5Kkc+piN4lvODIFGAZgT+EO4Si1s7fjSR7vcQETUkRm9O+MXyo9OYhfe4xt9STQ2pcZRLayCV90b4D3jR0DYAfyxJ+eywg2IL7NTMXna7S/RpQ63JhWEM8U41ZyQGjwsVS0QBrEKLu8xwZsbi4wLcCT+OGidPIOCe1PiSc9Qt+go+vYqB7cG+B9d8cAD+WJPz0Am2gxXgU9IneOqDpAAXOsOltVuMzpdakJXrdPCzXiNVUpCeOos5cxnpQT39G+XVLhs1osQVvJKPZyNq8HDwd4d7pNDuWJPxVX7MSzqUDU6gfadKiNlUFTzLeFHHDlzO4kpa7aiKhBPGKwOqxsBAmYkOIpipyXcQSPlRTf+Tii0U3EJGaZsDER2qoB3h2hu0qe+NNwUooYU8y5mILbJe6OuX+2FTKy7bieTDAemaQyQ0CPthljSWO+xmFDIYiESjM5xKd6Ik5lvLq5GrQ3aCMLvmCA9wowLuWJb9xF59hVVP6O0CrBi3ZjZSNOvRy+I6klNVRJYRBaEzdN+imiUXQ8iVF8fsp+W4JXw7WISW7fDh7lptWkCwZ4d7QTXyBPfJMYK7SijjFppGnlIVJBJBYj7eUwtiP1IBXGI1XCsjNpbjENVpSAJ2hq2LTywEly3hUYazt31J8w2+aiLx3g3fohXixPfOMYm6zCGs9LVo9MoW3MCJE7R5u/WsOIjrqBoHUO0bJE9vxBpbhsd3+Nb4/vtPCZ4oZYCitNeYuC/8UDvDvy0qvkiW/cgqNqRyzqSZa/s0mqNGjtKOoTm14zZpUauiQgVfqtQiZjq7Q27JNaSK5ExRcrGCXO1FJYh6jR6CFqK7bZdQZ4t8g0rSlPfP1RdBtqaa9diqtzJkQ9duSryi2brQXbxDwbRUpFMBHjRj8+Nt7GDKgvph9okW7LX47gu0SpGnnFQ1S1lYldOsC7hYteR574ZuKs7Ei1lBsfdz7IZoxzzCVmmVqaSySzQbBVAWDek+N4jh9E/4VqZrJjPwiv9BC1XcvOWgO8275CVyBPvAtTVlDJfZkaZGU7NpqBogAj/xEHkeAuJihWYCxGN6e8+9JtSegFXF1TrhhLGP1fak3pebgPz192/8gB4d/6WT7+GdYnpH7hH/DJzzFiYPn/vjW0SgNpTNuPIZoAEZv8tlGw4+RLxy+ZjnKa5NdFoC7UaW0aduoYse6+bXg1DLg6UfRYwmhGEjqPvF75U558SANrElK/+MdpXvmqBpaXOa/MTZaa1DOcSiLaw9j0NNNst3c+63c7EKTpkvKHzu6bPbP0RkuHAVcbRY8ijP46MIbQeeT1mhA+5PV/inyDdQipf8LTvMXbwvoDy7IruDNVZKTfV4CTSRUYdybUCnGU7KUTDxLgCknqUm5aAW6/1p6eMsOYsphLzsHrE0Y/P5bQedx1F/4yPHnMB3/IOoTU9+BL8PhtjuFKBpZXnYNJxTuv+2XqolKR2UQgHhS5novuxVySJhBNRF3SoKK1XZbbXjVwWNyOjlqWJjrWJIy+P5bQedyldNScP+HZ61xKSK3jyrz+NiHG1hcOLL/+P+PDF2gOkekKGiNWKgJ+8Z/x8Iv4DdQHzcpZyF4v19I27w9/yPGDFQvmEpKtqv/TLiWMfn4sofMm9eAH8Ao0zzh7h4sJqYtxZd5/D7hkYPneDzl5idlzNHcIB0jVlQ+8ULzw/nc5/ojzl2juE0apD7LRnJxe04dMz2iOCFNtGFpTuXA5AhcTRo8mdN4kz30nVjEC4YTZQy4gpC7GlTlrePKhGsKKgeXpCYeO0MAd/GH7yKQUlXPLOasOH3FnSphjHuDvEu4gB8g66oNbtr6eMbFIA4fIBJkgayoXriw2XEDQPJrQeROAlY6aeYOcMf+IVYTU3XFlZufMHinGywaW3YLpObVBAsbjF4QJMsVUSayjk4voPsHJOQfPWDhCgDnmDl6XIRerD24HsGtw86RMHOLvVSHrKBdeVE26gKB5NKHzaIwLOmrqBWJYZDLhASG16c0Tn+CdRhWDgWXnqRZUTnPIHuMJTfLVpkoYy5CzylHVTGZMTwkGAo2HBlkQplrJX6U+uF1wZz2uwS1SQ12IqWaPuO4baZaEFBdukksJmkcTOm+YJSvoqPFzxFA/YUhIvWxcmSdPWTWwbAKVp6rxTtPFUZfKIwpzm4IoMfaYQLWgmlG5FME2gdBgm+J7J+rtS/XBbaVLsR7bpPQnpMFlo2doWaVceHk9+MkyguZNCJ1He+kuHTWyQAzNM5YSUg/GlTk9ZunAsg1qELVOhUSAK0LABIJHLKbqaEbHZLL1VA3VgqoiOKXYiS+HRyaEKgsfIqX64HYWbLRXy/qWoylIV9gudL1OWBNgBgTNmxA6b4txDT4gi3Ri7xFSLxtXpmmYnzAcWDZgY8d503LFogz5sbonDgkKcxGsWsE1OI+rcQtlgBBCSOKD1mtqYpIU8cTvBmAT0yZe+zUzeY92fYjTtGipXLhuR0ePoHk0ofNWBX+lo8Z7pAZDk8mEw5L7dVyZZoE/pTewbI6SNbiAL5xeygW4xPRuLCGbhcO4RIeTMFYHEJkYyEO9HmJfXMDEj/LaH781wHHZEtqSQ/69UnGpzH7LKIAZEDSPJnTesJTUa+rwTepI9dLJEawYV+ZkRn9g+QirD8vF8Mq0jFQ29js6kCS3E1+jZIhgPNanHdHFqFvPJLHqFwQqbIA4jhDxcNsOCCQLDomaL/dr5lyJaJU6FxPFjO3JOh3kVMcROo8u+C+jo05GjMF3P3/FuDLn5x2M04xXULPwaS6hBYki+MrMdZJSgPHlcB7nCR5bJ9Kr5ACUn9jk5kivdd8tk95SOGrtqu9lr2IhK65ZtEl7ZKrp7DrqwZfRUSN1el7+7NJxZbywOC8neNKTch5vsTEMNsoCCqHBCqIPRjIPkm0BjvFODGtto99rCl+d3wmHkW0FPdpZtC7MMcVtGFQjJLX5bdQ2+x9ypdc313uj8xlsrfuLgWXz1cRhZvJYX0iNVBRcVcmCXZs6aEf3RQF2WI/TcCbKmGU3IOoDJGDdDub0+hYckt6PlGu2BcxmhbTdj/klhccLGJMcqRjMJP1jW2ETqLSWJ/29MAoORluJ+6LPffBZbi5gqi5h6catQpmOT7/OFf5UorRpLzCqcMltBLhwd1are3kztrSzXO0LUbXRQcdLh/RdSZ+swRm819REDrtqzC4es6Gw4JCKlSnjYVpo0xeq33PrADbFLL3RuCmObVmPN+24kfa+AojDuM4umKe2QwCf6EN906HwjujaitDs5o0s1y+k3lgbT2W2i7FJdnwbLXhJUBq/9liTctSmFC/0OqUinb0QddTWamtjbHRFuWJJ6NpqZ8vO3fZJ37Db+2GkaPYLGHs7XTTdiFQJ68SkVJFVmY6McR5UycflNCsccHFaV9FNbR4NttLxw4pQ7wJd066Z0ohVbzihaxHVExd/ay04oxUKWt+AsdiQ9OUyZ2krzN19IZIwafSTFgIBnMV73ADj7V/K8u1MaY2sJp2HWm0f41tqwajEvdHWOJs510MaAqN4aoSiPCXtN2KSi46dUxHdaMquar82O1x5jqhDGvqmoE9LfxcY3zqA7/x3HA67r9ZG4O6Cuxu12/+TP+eLP+I+HErqDDCDVmBDO4larujNe7x8om2rMug0MX0rL1+IWwdwfR+p1TNTyNmVJ85ljWzbWuGv8/C7HD/izjkHNZNYlhZcUOKVzKFUxsxxN/kax+8zPWPSFKw80rJr9Tizyj3o1gEsdwgWGoxPezDdZ1TSENE1dLdNvuKL+I84nxKesZgxXVA1VA1OcL49dFlpFV5yJMhzyCmNQ+a4BqusPJ2bB+xo8V9u3x48VVIEPS/mc3DvAbXyoYr6VgDfh5do5hhHOCXMqBZUPhWYbWZECwVJljLgMUWOCB4MUuMaxGNUQDVI50TQ+S3kFgIcu2qKkNSHVoM0SHsgoZxP2d5HH8B9woOk4x5bPkKtAHucZsdykjxuIpbUrSILgrT8G7G5oCW+K0990o7E3T6AdW4TilH5kDjds+H64kS0mz24grtwlzDHBJqI8YJQExotPvoC4JBq0lEjjQkyBZ8oH2LnRsQ4Hu1QsgDTJbO8fQDnllitkxuVskoiKbRF9VwzMDvxHAdwB7mD9yCplhHFEyUWHx3WtwCbSMMTCUCcEmSGlg4gTXkHpZXWQ7kpznK3EmCHiXInqndkQjunG5kxTKEeGye7jWz9cyMR2mGiFQ15ENRBTbCp+Gh86vAyASdgmJq2MC6hoADQ3GosP0QHbnMHjyBQvQqfhy/BUbeHd5WY/G/9LK/8Ka8Jd7UFeNWEZvzPb458Dn8DGLOe3/wGL/4xP+HXlRt+M1PE2iLhR8t+lfgxsuh7AfO2AOf+owWhSZRYQbd622hbpKWKuU+XuvNzP0OseRDa+mObgDHJUSc/pKx31QdKffQ5OIJpt8GWjlgTwMc/w5MPCR/yl1XC2a2Yut54SvOtMev55Of45BOat9aWG27p2ZVORRvnEk1hqWMVUmqa7S2YtvlIpspuF1pt0syuZS2NV14mUidCSfzQzg+KqvIYCMljIx2YK2AO34fX4GWdu5xcIAb8MzTw+j/lyWM+Dw/gjs4GD6ehNgA48kX/AI7XXM/XAN4WHr+9ntywqoCakCqmKP0rmQrJJEErG2Upg1JObr01lKQy4jskWalKYfJ/EDLMpjNSHFEUAde2fltaDgmrNaWQ9+AAb8I5vKjz3L1n1LriB/BXkG/wwR9y/oRX4LlioHA4LzP2inzRx/DWmutRweFjeP3tNeSGlaE1Fde0OS11yOpmbIp2u/jF1n2RRZviJM0yBT3IZl2HWImKjQOxIyeU325b/qWyU9Moj1o07tS0G7qJDoGHg5m8yeCxMoEH8GU45tnrNM84D2l297DQ9t1YP7jki/7RmutRweEA77/HWXOh3HCxkRgldDQkAjNTMl2Iloc1qN5JfJeeTlyTRzxURTdn1Ixv2uKjs12AbdEWlBtmVdk2k7FFwj07PCZ9XAwW3dG+8xKzNFr4EnwBZpy9Qzhh3jDXebBpYcpuo4fQ44u+fD1dweEnHzI7v0xuuOALRUV8rXpFyfSTQYkhd7IHm07jpyhlkCmI0ALYqPTpUxXS+z4jgDj1Pflvmz5ecuItpIBxyTHpSTGWd9g1ApfD/bvwUhL4nT1EzqgX7cxfCcNmb3mPL/qi9SwTHJ49oj5ZLjccbTG3pRmlYi6JCG0mQrAt1+i2UXTZ2dv9IlQpN5naMYtviaXlTrFpoMsl3bOAFEa8sqPj2WCMrx3Yjx99qFwO59Aw/wgx+HlqNz8oZvA3exRDvuhL1jMQHPaOJ0+XyA3fp1OfM3qObEVdhxjvynxNMXQV4+GJyvOEFqeQBaIbbO7i63rpxCltdZShPFxkjM2FPVkn3TG+Rp9pO3l2RzFegGfxGDHIAh8SteR0C4HopXzRF61nheDw6TFN05Ebvq8M3VKKpGjjO6r7nhudTEGMtYM92HTDaR1FDMXJ1eThsbKfywyoWwrzRSXkc51flG3vIid62h29bIcFbTGhfV+faaB+ohj7dPN0C2e2lC96+XouFByen9AsunLDJZ9z7NExiUc0OuoYW6UZkIyx2YUR2z6/TiRjyKMx5GbbjLHvHuf7YmtKghf34LJfx63Yg8vrvN2zC7lY0x0tvKezo4HmGYDU+Gab6dFL+KI761lDcNifcjLrrr9LWZJctG1FfU1uwhoQE22ObjdfkSzY63CbU5hzs21WeTddH2BaL11Gi7lVdlxP1nkxqhnKhVY6knS3EPgVGg1JpN5cP/hivujOelhXcPj8HC/LyI6MkteVjlolBdMmF3a3DbsuAYhL44dxzthWSN065xxUd55Lmf0wRbOYOqH09/o9WbO2VtFdaMb4qBgtFJoT1SqoN8wPXMoXLb3p1PUEhxfnnLzGzBI0Ku7FxrKsNJj/8bn/H8fPIVOd3rfrklUB/DOeO+nkghgSPzrlPxluCMtOnDL4Yml6dK1r3vsgMxgtPOrMFUZbEUbTdIzii5beq72G4PD0DKnwjmBULUVFmy8t+k7fZ3pKc0Q4UC6jpVRqS9Umv8bxw35flZVOU1X7qkjnhZlsMbk24qQ6Hz7QcuL6sDC0iHHki96Uh2UdvmgZnjIvExy2TeJdMDZNSbdZyAHe/Yd1xsQhHiKzjh7GxQ4yqMPaywPkjMamvqrYpmO7Knad+ZQC5msCuAPWUoxrxVhrGv7a+KLXFhyONdTMrZ7ke23qiO40ZJUyzgYyX5XyL0mV7NiUzEs9mjtbMN0dERqwyAJpigad0B3/zRV7s4PIfXSu6YV/MK7+OrYe/JvfGMn/PHJe2fyUdtnFrKRNpXV0Y2559aWPt/G4BlvjTMtXlVIWCnNyA3YQBDmYIodFz41PvXPSa6rq9lWZawZ4dP115HXV/M/tnFkkrBOdzg6aP4pID+MZnTJ1SuuB6iZlyiox4HT2y3YBtkUKWooacBQUDTpjwaDt5poBHl1/HXltwP887lKKXxNUEyPqpGTyA699UqY/lt9yGdlUKra0fFWS+36iylVWrAyd7Uw0CZM0z7xKTOduznLIjG2Hx8cDPLb+OvK6Bv7n1DYci4CxUuRxrjBc0bb4vD3rN5Zz36ntLb83eVJIB8LiIzCmn6SMPjlX+yNlTjvIGjs+QzHPf60Aj62/jrzG8j9vYMFtm1VoRWCJdmw7z9N0t+c8cxZpPeK4aTRicS25QhrVtUp7U578chk4q04Wx4YoQSjFryUlpcQ1AbxZ/XVMknIU//OGl7Q6z9Zpxi0+3yFhSkjUDpnCIUhLWVX23KQ+L9vKvFKI0ZWFQgkDLvBoylrHNVmaw10zwCPrr5tlodfnf94EWnQ0lFRWy8pW9LbkLsyUVDc2NSTHGDtnD1uMtchjbCeb1mpxFP0YbcClhzdLu6lfO8Bj6q+bdT2sz/+8SZCV7VIxtt0DUn9L7r4cLYWDSXnseEpOGFuty0qbOVlS7NNzs5FOGJUqQpl2Q64/yBpZf90sxbE+//PGdZ02HSipCbmD6NItmQ4Lk5XUrGpDMkhbMm2ZVheNYV+VbUWTcv99+2NyX1VoafSuC+AN6q9bFIMv5X/eagNWXZxEa9JjlMwNWb00akGUkSoepp1/yRuuqHGbUn3UdBSTxBU6SEVklzWRUkPndVvw2PrrpjvxOvzPmwHc0hpmq82npi7GRro8dXp0KXnUQmhZbRL7NEVp1uuZmO45vuzKsHrktS3GLWXODVjw+vXXLYx4Hf7njRPd0i3aoAGX6W29GnaV5YdyDj9TFkakje7GHYzDoObfddHtOSpoi2SmzJHrB3hM/XUDDEbxP2/oosszcRlehWXUvzHv4TpBVktHqwenFo8uLVmy4DKLa5d3RtLrmrM3aMFr1183E4sewf+85VWeg1c5ag276NZrM9IJVNcmLEvDNaV62aq+14IAOGFsBt973Ra8Xv11YzXwNfmft7Jg2oS+XOyoC8/cwzi66Dhmgk38kUmP1CUiYWOX1bpD2zWXt2FCp7uq8703APAa9dfNdscR/M/bZLIyouVxqJfeWvG9Je+JVckHQ9+CI9NWxz+blX/KYYvO5n2tAP/vrlZ7+8/h9y+9qeB/Hnt967e5mevX10rALDWK//FaAT5MXdBXdP0C/BAes792c40H+AiAp1e1oH8HgH94g/Lttx1gp63op1eyoM/Bvw5/G/7xFbqJPcCXnmBiwDPb/YKO4FX4OjyCb289db2/Noqicw4i7N6TVtoz8tNwDH+8x/i6Ae7lmaQVENzJFb3Di/BFeAwz+Is9SjeQySpPqbLFlNmyz47z5a/AF+AYFvDmHqibSXTEzoT4Gc3OALaqAP4KPFUJ6n+1x+rGAM6Zd78bgJ0a8QN4GU614vxwD9e1Amy6CcskNrczLx1JIp6HE5UZD/DBHrFr2oNlgG4Odv226BodoryjGJ9q2T/AR3vQrsOCS0ctXZi3ruLlhpFDJYl4HmYtjQCP9rhdn4suySLKDt6wLcC52h8xPlcjju1fn+yhuw4LZsAGUuo2b4Fx2UwQu77uqRHXGtg92aN3tQCbFexc0uk93vhTXbct6y7MulLycoUljx8ngDMBg1tvJjAazpEmOtxlzclvj1vQf1Tx7QlPDpGpqgtdSKz/d9/hdy1vTfFHSmC9dGDZbLiezz7Ac801HirGZsWjydfZyPvHXL/Y8Mjzg8BxTZiuwKz4Eb8sBE9zznszmjvFwHKPIWUnwhqfVRcd4Ck0K6ate48m1oOfrX3/yOtvAsJ8zsPAM89sjnddmuLuDPjX9Bu/L7x7xpMzFk6nWtyQfPg278Gn4Aekz2ZgOmU9eJ37R14vwE/BL8G3aibCiWMWWDQ0ZtkPMnlcGeAu/Ag+8ZyecU5BPuy2ILD+sQqyZhAKmn7XZd+jIMTN9eBL7x95xVLSX4On8EcNlXDqmBlqS13jG4LpmGbkF/0CnOi3H8ETOIXzmnmtb0a16Tzxj1sUvQCBiXZGDtmB3KAefPH94xcUa/6vwRn80GOFyjEXFpba4A1e8KQfFF+259tx5XS4egYn8fQsLGrqGrHbztr+uByTahWuL1NUGbDpsnrwBfePPwHHIf9X4RnM4Z2ABWdxUBlqQ2PwhuDxoS0vvqB1JzS0P4h2nA/QgTrsJFn+Y3AOjs9JFC07CGWX1oNX3T/yHOzgDjwPn1PM3g9Jk9lZrMEpxnlPmBbjyo2+KFXRU52TJM/2ALcY57RUzjObbjqxVw++4P6RAOf58pcVsw9Daje3htriYrpDOonre3CudSe6bfkTEgHBHuDiyu5MCsc7BHhYDx7ePxLjqigXZsw+ijMHFhuwBmtoTPtOxOrTvYJDnC75dnUbhfwu/ZW9AgYd+peL68HD+0emKquiXHhWjJg/UrkJYzuiaL3E9aI/ytrCvAd4GcYZMCkSQxfUg3v3j8c4e90j5ZTPdvmJJGHnOCI2nHS8081X013pHuBlV1gB2MX1YNmWLHqqGN/TWmG0y6clJWthxNUl48q38Bi8vtMKyzzpFdSDhxZ5WBA5ZLt8Jv3895DduBlgbPYAj8C4B8hO68FDkoh5lydC4FiWvBOVqjYdqjiLv92t8yPDjrDaiHdUD15qkSURSGmXJwOMSxWAXYwr3zaAufJ66l+94vv3AO+vPcD7aw/w/toDvL/2AO+vPcD7aw/wHuD9tQd4f+0B3l97gPfXHuD9tQd4f+0B3l97gG8LwP8G/AL8O/A5OCq0Ys2KIdv/qOIXG/4mvFAMF16gZD+2Xvu/B8as5+8bfllWyg0zaNO5bfXj6vfhhwD86/Aq3NfRS9t9WPnhfnvCIw/CT8GLcFTMnpntdF/z9V+PWc/vWoIH+FL3Znv57PitcdGP4R/C34avw5fgRVUInCwbsn1yyA8C8zm/BH8NXoXnVE6wVPjdeCI38kX/3+Ct9dbz1pTmHFRu+Hm4O9Ch3clr99negxfwj+ER/DR8EV6B5+DuQOnTgUw5rnkY+FbNU3gNXh0o/JYTuWOvyBf9FvzX663HH/HejO8LwAl8Hl5YLTd8q7sqA3wbjuExfAFegQdwfyDoSkWY8swzEf6o4Qyewefg+cHNbqMQruSL/u/WWc+E5g7vnnEXgDmcDeSGb/F4cBcCgT+GGRzDU3hZYburAt9TEtHgbM6JoxJ+6NMzzTcf6c2bycv2+KK/f+l6LBzw5IwfqZJhA3M472pWT/ajKxnjv4AFnMEpnBTPND6s2J7qHbPAqcMK74T2mZ4VGB9uJA465It+/eL1WKhYOD7xHOkr1ajK7d0C4+ke4Hy9qXZwpgLr+Znm/uNFw8xQOSy8H9IzjUrd9+BIfenYaylf9FsXr8fBAadnPIEDna8IBcwlxnuA0/Wv6GAWPd7dDIKjMdSWueAsBj4M7TOd06qBbwDwKr7oleuxMOEcTuEZTHWvDYUO7aHqAe0Bbq+HEFRzOz7WVoTDQkVds7A4sIIxfCQdCefFRoIOF/NFL1mPab/nvOakSL/Q1aFtNpUb/nFOVX6gzyg/1nISyDfUhsokIzaBR9Kxm80s5mK+6P56il1jXic7nhQxsxSm3OwBHl4fFdLqi64nDQZvqE2at7cWAp/IVvrN6/BFL1mPhYrGMBfOi4PyjuSGf6wBBh7p/FZTghCNWGgMzlBbrNJoPJX2mW5mwZfyRffXo7OFi5pZcS4qZUrlViptrXtw+GQoyhDPS+ANjcGBNRiLCQDPZPMHuiZfdFpPSTcQwwKYdRNqpkjm7AFeeT0pJzALgo7g8YYGrMHS0iocy+YTm2vyRUvvpXCIpQ5pe666TJrcygnScUf/p0NDs/iAI/nqDHC8TmQT8x3NF91l76oDdQGwu61Z6E0ABv7uO1dbf/37Zlv+Zw/Pbh8f1s4Avur6657/+YYBvur6657/+YYBvur6657/+YYBvur6657/+aYBvuL6657/+VMA8FXWX/f8zzcN8BXXX/f8zzcNMFdbf93zP38KLPiK6697/uebtuArrr/u+Z9vGmCusP6653/+1FjwVdZf9/zPN7oHX339dc//fNMu+irrr3v+50+Bi+Zq6697/uebA/jz8Pudf9ht/fWv517J/XUzAP8C/BAeX9WCDrUpZ3/dEMBxgPcfbtTVvsYV5Yn32u03B3Ac4P3b8I+vxNBKeeL9dRMAlwO83959qGO78sT769oB7g3w/vGVYFzKE++v6wV4OMD7F7tckFkmT7y/rhHgpQO8b+4Y46XyxPvrugBeNcB7BRiX8sT767oAvmCA9woAHsoT76+rBJjLBnh3txOvkifeX1dswZcO8G6N7sXyxPvr6i340gHe3TnqVfLE++uKAb50gHcXLnrX8sR7gNdPRqwzwLu7Y/FO5Yn3AK9jXCMGeHdgxDuVJ75VAI8ljP7PAb3/RfjcZfePHBB+79dpfpH1CanN30d+mT1h9GqAxxJGM5LQeeQ1+Tb+EQJrElLb38VHQ94TRq900aMIo8cSOo+8Dp8QfsB8zpqE1NO3OI9Zrj1h9EV78PqE0WMJnUdeU6E+Jjyk/hbrEFIfeWbvId8H9oTRFwdZaxJGvziW0Hn0gqYB/wyZ0PwRlxJST+BOw9m77Amj14ii1yGM/txYQudN0qDzGe4EqfA/5GJCagsHcPaEPWH0esekSwmjRxM6b5JEcZ4ww50ilvAOFxBSx4yLW+A/YU8YvfY5+ALC6NGEzhtmyZoFZoarwBLeZxUhtY4rc3bKnjB6TKJjFUHzJoTOozF2YBpsjcyxDgzhQ1YRUse8+J4wenwmaylB82hC5w0zoRXUNXaRBmSMQUqiWSWkLsaVqc/ZE0aPTFUuJWgeTei8SfLZQeMxNaZSIzbII4aE1Nmr13P2hNHjc9E9guYNCZ032YlNwESMLcZiLQHkE4aE1BFg0yAR4z1h9AiAGRA0jyZ03tyIxWMajMPWBIsxYJCnlITU5ShiHYdZ94TR4wCmSxg9jtB5KyPGYzymAYexWEMwAPIsAdYdV6aObmNPGD0aYLoEzaMJnTc0Ygs+YDw0GAtqxBjkuP38bMRWCHn73xNGjz75P73WenCEJnhwyVe3AEe8TtKdJcYhBl97wuhNAObK66lvD/9J9NS75v17wuitAN5fe4D31x7g/bUHeH/tAd5fe4D3AO+vPcD7aw/w/toDvL/2AO+vPcD7aw/w/toDvAd4f/24ABzZ8o+KLsSLS+Pv/TqTb3P4hKlQrTGh+fbIBT0Axqznnb+L/V2mb3HkN5Mb/nEHeK7d4IcDld6lmDW/iH9E+AH1MdOw/Jlu2T1xNmY98sv4wHnD7D3uNHu54WUuOsBTbQuvBsPT/UfzNxGYzwkP8c+Yz3C+r/i6DcyRL/rZ+utRwWH5PmfvcvYEt9jLDS/bg0/B64DWKrQM8AL8FPwS9beQCe6EMKNZYJol37jBMy35otdaz0Bw2H/C2Smc7+WGB0HWDELBmOByA3r5QONo4V+DpzR/hFS4U8wMW1PXNB4TOqYz9urxRV++ntWCw/U59Ty9ebdWbrgfRS9AYKKN63ZokZVygr8GZ/gfIhZXIXPsAlNjPOLBby5c1eOLvmQ9lwkOy5x6QV1j5TYqpS05JtUgUHUp5toHGsVfn4NX4RnMCe+AxTpwmApTYxqMxwfCeJGjpXzRF61nbcHhUBPqWze9svwcHJ+S6NPscKrEjug78Dx8Lj3T8D4YxGIdxmJcwhi34fzZUr7olevZCw5vkOhoClq5zBPZAnygD/Tl9EzDh6kl3VhsHYcDEb+hCtJSvuiV69kLDm+WycrOTArHmB5/VYyP6jOVjwgGawk2zQOaTcc1L+aLXrKeveDwZqlKrw8U9Y1p66uK8dEzdYwBeUQAY7DbyYNezBfdWQ97weEtAKYQg2xJIkuveAT3dYeLGH+ShrWNwZgN0b2YL7qznr3g8JYAo5bQBziPjx7BPZ0d9RCQp4UZbnFdzBddor4XHN4KYMrB2qHFRIzzcLAHQZ5the5ovui94PCWAPefaYnxIdzRwdHCbuR4B+tbiy96Lzi8E4D7z7S0mEPd+eqO3cT53Z0Y8SV80XvB4Z0ADJi/f7X113f+7p7/+UYBvur6657/+YYBvur6657/+aYBvuL6657/+aYBvuL6657/+aYBvuL6657/+aYBvuL6657/+VMA8FXWX/f8z58OgK+y/rrnf75RgLna+uue//lTA/CV1V/3/M837aKvvv6653++UQvmauuve/7nTwfAV1N/3fM/fzr24Cuuv+75nz8FFnxl9dc9//MOr/8/glixwRuUfM4AAAAASUVORK5CYII="}function Srt(){return"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEIAAAAhCAAAAABIXyLAAAAAOElEQVRIx2NgGAWjYBSMglEwEICREYRgFBZBqDCSLA2MGPUIVQETE9iNUAqLR5gIeoQKRgwXjwAAGn4AtaFeYLEAAAAASUVORK5CYII="}var Crt=E(E({},Pa),{tDepth:cr("texture","rgba","ubyte","nearest"),uTexSize:Ge("v2"),dOrthographic:Jt("number"),uNear:Ge("f"),uFar:Ge("f"),uMaxPossibleViewZDiff:Ge("f")});function _rt(e,t){var r=E(E({},Ta),{tDepth:L.create(t),uTexSize:L.create(He.create(t.getWidth(),t.getHeight())),dOrthographic:L.create(0),uNear:L.create(1),uFar:L.create(1e4),uMaxPossibleViewZDiff:L.create(.5)}),n=E({},Crt),i=Bn("outlines",Bo,Wtt),a=ra(e,"triangles",i,n,r);return ta(a,r)}var wrt=E(E({},Pa),{tDepth:cr("texture","rgba","ubyte","nearest"),uSamples:Ge("v3[]"),dNSamples:Jt("number"),uProjection:Ge("m4"),uInvProjection:Ge("m4"),uBounds:Ge("v4"),uTexSize:Ge("v2"),uRadius:Ge("f"),uBias:Ge("f")});function Ert(e,t){var r=E(E({},Ta),{tDepth:L.create(t),uSamples:L.create([0,0,1]),dNSamples:L.create(1),uProjection:L.create(ue.identity()),uInvProjection:L.create(ue.identity()),uBounds:L.create(Ir()),uTexSize:L.create(He.create(e.gl.drawingBufferWidth,e.gl.drawingBufferHeight)),uRadius:L.create(8),uBias:L.create(.025)}),n=E({},wrt),i=Bn("ssao",Bo,Xtt),a=ra(e,"triangles",i,n,r);return ta(a,r)}var Art=E(E({},Pa),{tSsaoDepth:cr("texture","rgba","ubyte","nearest"),uTexSize:Ge("v2"),uKernel:Ge("f[]"),dOcclusionKernelSize:Jt("number"),uBlurDirectionX:Ge("f"),uBlurDirectionY:Ge("f"),uMaxPossibleViewZDiff:Ge("f"),uNear:Ge("f"),uFar:Ge("f"),uBounds:Ge("v4"),dOrthographic:Jt("number")});function IH(e,t,r){var n=E(E({},Ta),{tSsaoDepth:L.create(t),uTexSize:L.create(He.create(t.getWidth(),t.getHeight())),uKernel:L.create([0]),dOcclusionKernelSize:L.create(1),uBlurDirectionX:L.create(r==="horizontal"?1:0),uBlurDirectionY:L.create(r==="vertical"?1:0),uMaxPossibleViewZDiff:L.create(.5),uNear:L.create(0),uFar:L.create(1e4),uBounds:L.create(Ir()),dOrthographic:L.create(0)}),i=E({},Art),a=Bn("ssao_blur",Bo,Ytt),o=ra(e,"triangles",a,i,n);return ta(o,n)}function Prt(e){for(var t=e/3,r=Math.floor((e+1)/2),n=[],i=0;i<r;i++)n.push(1/(Math.sqrt(2*Math.PI)*t)*Math.exp(-i*i/(2*t*t)));return n}function Trt(e,t){for(var r=[],n=0;n<t;n++){var i=(n*n+2*n+1)/(t*t);i=.1+i*(1-.1),r.push(e[n][0]*i),r.push(e[n][1]*i),r.push(e[n][2]*i)}return r}var Irt=E(E({},Pa),{tSsaoDepth:cr("texture","rgba","ubyte","nearest"),tColor:cr("texture","rgba","ubyte","nearest"),tDepth:cr("texture","rgba","ubyte","nearest"),tOutlines:cr("texture","rgba","ubyte","nearest"),uTexSize:Ge("v2"),dOrthographic:Jt("number"),uNear:Ge("f"),uFar:Ge("f"),uFogNear:Ge("f"),uFogFar:Ge("f"),uFogColor:Ge("v3"),uTransparentBackground:Ge("b"),uMaxPossibleViewZDiff:Ge("f"),dOcclusionEnable:Jt("boolean"),dOutlineEnable:Jt("boolean"),dOutlineScale:Jt("number"),uOutlineThreshold:Ge("f")});function Mrt(e,t,r,n,i){var a=E(E({},Ta),{tSsaoDepth:L.create(i),tColor:L.create(t),tDepth:L.create(r),tOutlines:L.create(n),uTexSize:L.create(He.create(t.getWidth(),t.getHeight())),dOrthographic:L.create(0),uNear:L.create(1),uFar:L.create(1e4),uFogNear:L.create(1e4),uFogFar:L.create(1e4),uFogColor:L.create(_.create(1,1,1)),uTransparentBackground:L.create(!1),uMaxPossibleViewZDiff:L.create(.5),dOcclusionEnable:L.create(!1),dOutlineEnable:L.create(!1),dOutlineScale:L.create(1),uOutlineThreshold:L.create(.33)}),o=E({},Irt),s=Bn("postprocessing",Bo,Ktt),u=ra(e,"triangles",s,o,a);return ta(u,a)}var aie={occlusion:I.MappedStatic("on",{on:I.Group({samples:I.Numeric(32,{min:1,max:256,step:1}),radius:I.Numeric(5,{min:0,max:10,step:.1},{description:"Final radius is 2^x."}),bias:I.Numeric(.8,{min:0,max:3,step:.1}),blurKernelSize:I.Numeric(15,{min:1,max:25,step:2})}),off:I.Group({})},{cycle:!0,description:"Darken occluded crevices with the ambient occlusion effect"}),outline:I.MappedStatic("off",{on:I.Group({scale:I.Numeric(1,{min:1,max:5,step:1}),threshold:I.Numeric(.33,{min:.01,max:1,step:.01})}),off:I.Group({})},{cycle:!0,description:"Draw outline around 3D objects"}),antialiasing:I.MappedStatic("smaa",{fxaa:I.Group(Ztt),smaa:I.Group(lrt),off:I.Group({})},{options:[["fxaa","FXAA"],["smaa","SMAA"],["off","Off"]],description:"Smooth pixel edges"})},Tc=function(){function e(t,r){this.webgl=t,this.ssaoScale=this.calcSsaoScale();var n=r.colorTarget,i=r.depthTexture,a=n.getWidth(),o=n.getHeight();this.nSamples=1,this.blurKernelSize=1,this.target=t.createRenderTarget(a,o,!1,"uint8","linear"),this.outlinesTarget=t.createRenderTarget(a,o,!1),this.outlinesRenderable=_rt(t,i),this.randomHemisphereVector=[];for(var s=0;s<256;s++){var u=_();u[0]=Math.random()*2-1,u[1]=Math.random()*2-1,u[2]=Math.random(),_.normalize(u,u),_.scale(u,u,Math.random()),this.randomHemisphereVector.push(u)}this.ssaoFramebuffer=t.resources.framebuffer(),this.ssaoBlurFirstPassFramebuffer=t.resources.framebuffer(),this.ssaoBlurSecondPassFramebuffer=t.resources.framebuffer();var l=Math.floor(a*this.ssaoScale),c=Math.floor(o*this.ssaoScale);this.ssaoDepthTexture=t.resources.texture("image-uint8","rgba","ubyte","nearest"),this.ssaoDepthTexture.define(l,c),this.ssaoDepthTexture.attachFramebuffer(this.ssaoFramebuffer,"color0"),this.ssaoDepthBlurProxyTexture=t.resources.texture("image-uint8","rgba","ubyte","nearest"),this.ssaoDepthBlurProxyTexture.define(l,c),this.ssaoDepthBlurProxyTexture.attachFramebuffer(this.ssaoBlurFirstPassFramebuffer,"color0"),this.ssaoDepthTexture.attachFramebuffer(this.ssaoBlurSecondPassFramebuffer,"color0"),this.ssaoRenderable=Ert(t,i),this.ssaoBlurFirstPassRenderable=IH(t,this.ssaoDepthTexture,"horizontal"),this.ssaoBlurSecondPassRenderable=IH(t,this.ssaoDepthBlurProxyTexture,"vertical"),this.renderable=Mrt(t,n.texture,i,this.outlinesTarget.texture,this.ssaoDepthTexture)}return e.isEnabled=function(t){return t.occlusion.name==="on"||t.outline.name==="on"},e.prototype.calcSsaoScale=function(){return Math.min(1,1/this.webgl.pixelRatio)},e.prototype.setSize=function(t,r){var n=this.renderable.values.uTexSize.ref.value,i=n[0],a=n[1],o=this.calcSsaoScale();if(t!==i||r!==a||this.ssaoScale!==o){this.ssaoScale=o;var s=Math.floor(t*this.ssaoScale),u=Math.floor(r*this.ssaoScale);this.target.setSize(t,r),this.outlinesTarget.setSize(t,r),this.ssaoDepthTexture.define(s,u),this.ssaoDepthBlurProxyTexture.define(s,u),L.update(this.renderable.values.uTexSize,He.set(this.renderable.values.uTexSize.ref.value,t,r)),L.update(this.outlinesRenderable.values.uTexSize,He.set(this.outlinesRenderable.values.uTexSize.ref.value,t,r)),L.update(this.ssaoRenderable.values.uTexSize,He.set(this.ssaoRenderable.values.uTexSize.ref.value,s,u)),L.update(this.ssaoBlurFirstPassRenderable.values.uTexSize,He.set(this.ssaoBlurFirstPassRenderable.values.uTexSize.ref.value,s,u)),L.update(this.ssaoBlurSecondPassRenderable.values.uTexSize,He.set(this.ssaoBlurSecondPassRenderable.values.uTexSize.ref.value,s,u))}},e.prototype.updateState=function(t,r,n,i){var a=!1,o=!1,s=!1,u=t.state.mode==="orthographic"?1:0,l=i.outline.name==="on",c=i.occlusion.name==="on",d=ue.identity();if(ue.invert(d,t.projection),i.occlusion.name==="on"){L.update(this.ssaoRenderable.values.uProjection,t.projection),L.update(this.ssaoRenderable.values.uInvProjection,d);var f=this.renderable.values.uTexSize.ref.value,h=f[0],v=f[1],p=this.ssaoRenderable.values.uBounds,m=t.viewport,g=this.ssaoScale;if(Ir.set(p.ref.value,Math.floor(m.x*g)/(h*g),Math.floor(m.y*g)/(v*g),Math.ceil((m.x+m.width)*g)/(h*g),Math.ceil((m.y+m.height)*g)/(v*g)),L.update(p,p.ref.value),L.update(this.ssaoBlurFirstPassRenderable.values.uBounds,p.ref.value),L.update(this.ssaoBlurSecondPassRenderable.values.uBounds,p.ref.value),L.updateIfChanged(this.ssaoBlurFirstPassRenderable.values.uNear,t.near),L.updateIfChanged(this.ssaoBlurSecondPassRenderable.values.uNear,t.near),L.updateIfChanged(this.ssaoBlurFirstPassRenderable.values.uFar,t.far),L.updateIfChanged(this.ssaoBlurSecondPassRenderable.values.uFar,t.far),this.ssaoBlurFirstPassRenderable.values.dOrthographic.ref.value!==u&&(s=!0),L.updateIfChanged(this.ssaoBlurFirstPassRenderable.values.dOrthographic,u),L.updateIfChanged(this.ssaoBlurSecondPassRenderable.values.dOrthographic,u),this.nSamples!==i.occlusion.params.samples&&(o=!0,this.nSamples=i.occlusion.params.samples,L.update(this.ssaoRenderable.values.uSamples,Trt(this.randomHemisphereVector,this.nSamples)),L.updateIfChanged(this.ssaoRenderable.values.dNSamples,this.nSamples)),L.updateIfChanged(this.ssaoRenderable.values.uRadius,Math.pow(2,i.occlusion.params.radius)),L.updateIfChanged(this.ssaoRenderable.values.uBias,i.occlusion.params.bias),this.blurKernelSize!==i.occlusion.params.blurKernelSize){s=!0,this.blurKernelSize=i.occlusion.params.blurKernelSize;var y=Prt(this.blurKernelSize);L.update(this.ssaoBlurFirstPassRenderable.values.uKernel,y),L.update(this.ssaoBlurSecondPassRenderable.values.uKernel,y),L.updateIfChanged(this.ssaoBlurFirstPassRenderable.values.dOcclusionKernelSize,this.blurKernelSize),L.updateIfChanged(this.ssaoBlurSecondPassRenderable.values.dOcclusionKernelSize,this.blurKernelSize)}}if(i.outline.name==="on"){var b=i.outline.params.threshold;t.state.mode==="orthographic"&&(b/=5);var S=Math.pow(1e3,b)/1e3,x=S*t.state.radiusMax,C=i.outline.params.scale-1;L.updateIfChanged(this.outlinesRenderable.values.uNear,t.near),L.updateIfChanged(this.outlinesRenderable.values.uFar,t.far),L.updateIfChanged(this.outlinesRenderable.values.uMaxPossibleViewZDiff,x),L.updateIfChanged(this.renderable.values.uMaxPossibleViewZDiff,x),this.renderable.values.dOutlineScale.ref.value!==C&&(a=!0),L.updateIfChanged(this.renderable.values.dOutlineScale,C)}L.updateIfChanged(this.renderable.values.uFar,t.far),L.updateIfChanged(this.renderable.values.uNear,t.near),L.updateIfChanged(this.renderable.values.uFogFar,t.fogFar),L.updateIfChanged(this.renderable.values.uFogNear,t.fogNear),L.update(this.renderable.values.uFogColor,at.toVec3Normalized(this.renderable.values.uFogColor.ref.value,n)),L.updateIfChanged(this.renderable.values.uTransparentBackground,r),this.renderable.values.dOrthographic.ref.value!==u&&(a=!0),L.updateIfChanged(this.renderable.values.dOrthographic,u),this.renderable.values.dOutlineEnable.ref.value!==l&&(a=!0),L.updateIfChanged(this.renderable.values.dOutlineEnable,l),this.renderable.values.dOcclusionEnable.ref.value!==c&&(a=!0),L.updateIfChanged(this.renderable.values.dOcclusionEnable,c),o&&this.ssaoRenderable.update(),s&&(this.ssaoBlurFirstPassRenderable.update(),this.ssaoBlurSecondPassRenderable.update()),a&&this.renderable.update();var w=this.webgl,A=w.gl,M=w.state;M.enable(A.SCISSOR_TEST),M.disable(A.BLEND),M.disable(A.DEPTH_TEST),M.depthMask(!1);var D=t.viewport,k=D.x,R=D.y,O=D.width,H=D.height;A.viewport(k,R,O,H),A.scissor(k,R,O,H)},e.prototype.render=function(t,r,n,i,a){if(this.updateState(t,n,i,a),a.outline.name==="on"&&(this.outlinesTarget.bind(),this.outlinesRenderable.render()),a.occlusion.name==="on"){var o=t.viewport,s=o.x,u=o.y,l=o.width,c=o.height,d=Math.floor(s*this.ssaoScale),f=Math.floor(u*this.ssaoScale),h=Math.ceil(l*this.ssaoScale),v=Math.ceil(c*this.ssaoScale);this.webgl.gl.viewport(d,f,h,v),this.webgl.gl.scissor(d,f,h,v),this.ssaoFramebuffer.bind(),this.ssaoRenderable.render(),this.ssaoBlurFirstPassFramebuffer.bind(),this.ssaoBlurFirstPassRenderable.render(),this.ssaoBlurSecondPassFramebuffer.bind(),this.ssaoBlurSecondPassRenderable.render(),this.webgl.gl.viewport(s,u,l,c),this.webgl.gl.scissor(s,u,l,c)}r?this.webgl.unbindFramebuffer():this.target.bind();var p=this.webgl,m=p.gl,g=p.state;g.clearColor(0,0,0,1),m.clear(m.COLOR_BUFFER_BIT),this.renderable.render()},e}(),WT=function(){function e(t,r){this.drawPass=r;var n=r.colorTarget,i=n.getWidth(),a=n.getHeight();this.target=t.createRenderTarget(i,a,!1),this.fxaa=new Jtt(t,this.target.texture),this.smaa=new crt(t,this.target.texture)}return e.isEnabled=function(t){return t.antialiasing.name!=="off"},e.prototype.setSize=function(t,r){var n=this.target.texture.getWidth(),i=this.target.texture.getHeight();(t!==n||r!==i)&&(this.target.setSize(t,r),this.fxaa.setSize(t,r),this.smaa.supported&&this.smaa.setSize(t,r))},e.prototype._renderFxaa=function(t,r,n){if(n.antialiasing.name==="fxaa"){var i=Tc.isEnabled(n)?this.drawPass.postprocessing.target.texture:this.drawPass.colorTarget.texture;this.fxaa.update(i,n.antialiasing.params),this.fxaa.render(t.viewport,r?void 0:this.target)}},e.prototype._renderSmaa=function(t,r,n){if(n.antialiasing.name==="smaa"){var i=Tc.isEnabled(n)?this.drawPass.postprocessing.target.texture:this.drawPass.colorTarget.texture;this.smaa.update(i,n.antialiasing.params),this.smaa.render(t.viewport,r?void 0:this.target)}},e.prototype.render=function(t,r,n){if(n.antialiasing.name!=="off"){if(n.antialiasing.name==="fxaa")this._renderFxaa(t,r,n);else if(n.antialiasing.name==="smaa"){if(!this.smaa.supported)throw new Error('SMAA not supported, missing "HTMLImageElement"');this._renderSmaa(t,r,n)}}},e}(),Drt=`
precision highp float;
precision highp sampler2D;

uniform sampler2D tColor;
uniform vec2 uTexSize;
uniform float uWeight;

void main() {
    vec2 coords = gl_FragCoord.xy / uTexSize;
    gl_FragColor = texture2D(tColor, coords) * uWeight;
}
`,Rrt=E(E({},Pa),{tColor:cr("texture","rgba","ubyte","nearest"),uTexSize:Ge("v2"),uWeight:Ge("f")}),krt=Bn("compose",Bo,Drt);function Ort(e,t){var r=E(E({},Ta),{tColor:L.create(t),uTexSize:L.create(He.create(t.getWidth(),t.getHeight())),uWeight:L.create(1)}),n=E({},Rrt),i=ra(e,"triangles",krt,n,r);return ta(i,r)}var oie={mode:I.Select("off",[["off","Off"],["on","On"],["temporal","Temporal"]]),sampleLevel:I.Numeric(2,{min:0,max:5,step:1})},Yw=function(){function e(t,r){this.webgl=t,this.drawPass=r;var n=t.extensions,i=n.colorBufferFloat,a=n.textureFloat,o=n.colorBufferHalfFloat,s=n.textureHalfFloat,u=r.colorTarget.getWidth(),l=r.colorTarget.getHeight();this.colorTarget=t.createRenderTarget(u,l,!1);var c=o&&s?"fp16":i&&a?"float32":"uint8";this.composeTarget=t.createRenderTarget(u,l,!1,c),this.holdTarget=t.createRenderTarget(u,l,!1),this.compose=Ort(t,r.colorTarget.texture)}return e.isEnabled=function(t){return t.mode!=="off"},e.prototype.syncSize=function(){var t=this.drawPass.colorTarget.getWidth(),r=this.drawPass.colorTarget.getHeight(),n=this.compose.values.uTexSize.ref.value,i=n[0],a=n[1];(t!==i||r!==a)&&(this.colorTarget.setSize(t,r),this.composeTarget.setSize(t,r),this.holdTarget.setSize(t,r),L.update(this.compose.values.uTexSize,He.set(this.compose.values.uTexSize.ref.value,t,r)))},e.prototype.render=function(t,r,n,i,a,o,s,u){return u.multiSample.mode==="temporal"?this.renderTemporalMultiSample(t,r,n,i,a,o,s,u):(this.renderMultiSample(r,n,i,a,o,s,u),t)},e.prototype.bindOutputTarget=function(t){t?this.webgl.unbindFramebuffer():this.colorTarget.bind()},e.prototype.renderMultiSample=function(t,r,n,i,a,o,s){var u=this,l=u.compose,c=u.composeTarget,d=u.drawPass,f=u.webgl,h=f.gl,v=f.state,p=jR[Math.max(0,Math.min(s.multiSample.sampleLevel,5))],m=r.viewport,g=m.x,y=m.y,b=m.width,S=m.height,x=1/p.length,C=1/32;r.viewOffset.enabled=!0,L.update(l.values.tColor,d.getColorTarget(s.postprocessing).texture),l.update();for(var w=0;w<p.length;++w){var A=p[w];hi.setViewOffset(r.viewOffset,b,S,A[0],A[1],b,S),r.update();var M=-.5+(w+.5)/p.length,D=x+C*M;L.update(l.values.uWeight,D),d.render(t,r,n,i,!1,o,s.postprocessing),c.bind(),v.enable(h.BLEND),v.blendEquationSeparate(h.FUNC_ADD,h.FUNC_ADD),v.blendFuncSeparate(h.ONE,h.ONE,h.ONE,h.ONE),v.disable(h.DEPTH_TEST),v.depthMask(!1),h.viewport(g,y,b,S),h.scissor(g,y,b,S),w===0&&(v.clearColor(0,0,0,0),h.clear(h.COLOR_BUFFER_BIT)),l.render()}L.update(l.values.uWeight,1),L.update(l.values.tColor,c.texture),l.update(),this.bindOutputTarget(a),h.viewport(g,y,b,S),h.scissor(g,y,b,S),v.disable(h.BLEND),l.render(),r.viewOffset.enabled=!1,r.update()},e.prototype.renderTemporalMultiSample=function(t,r,n,i,a,o,s,u){var l=this,c=l.compose,d=l.composeTarget,f=l.holdTarget,h=l.drawPass,v=l.webgl,p=v.gl,m=v.state,g=jR[Math.max(0,Math.min(u.multiSample.sampleLevel,5))];if(t===-2||t>=g.length)return-2;var y=n.viewport,b=y.x,S=y.y,x=y.width,C=y.height,w=1/g.length;if(t===-1)h.render(r,n,i,a,!1,s,u.postprocessing),L.update(c.values.uWeight,1),L.update(c.values.tColor,h.getColorTarget(u.postprocessing).texture),c.update(),f.bind(),m.disable(p.BLEND),m.disable(p.DEPTH_TEST),m.depthMask(!1),p.viewport(b,S,x,C),p.scissor(b,S,x,C),c.render(),t+=1;else{n.viewOffset.enabled=!0,L.update(c.values.tColor,h.getColorTarget(u.postprocessing).texture),L.update(c.values.uWeight,w),c.update();for(var A=Math.pow(2,Math.max(0,u.multiSample.sampleLevel-2)),M=0;M<A;++M){var D=g[t];if(hi.setViewOffset(n.viewOffset,x,C,D[0],D[1],x,C),n.update(),h.render(r,n,i,a,!1,s,u.postprocessing),d.bind(),m.enable(p.BLEND),m.blendEquationSeparate(p.FUNC_ADD,p.FUNC_ADD),m.blendFuncSeparate(p.ONE,p.ONE,p.ONE,p.ONE),m.disable(p.DEPTH_TEST),m.depthMask(!1),p.viewport(b,S,x,C),p.scissor(b,S,x,C),t===0&&(m.clearColor(0,0,0,0),p.clear(p.COLOR_BUFFER_BIT)),c.render(),t+=1,t>=g.length)break}}this.bindOutputTarget(o),p.viewport(b,S,x,C),p.scissor(b,S,x,C);var k=t*w;return k>0&&(L.update(c.values.uWeight,1),L.update(c.values.tColor,d.texture),c.update(),m.disable(p.BLEND),c.render()),k<1&&(L.update(c.values.uWeight,1-k),L.update(c.values.tColor,f.texture),c.update(),k===0?m.disable(p.BLEND):m.enable(p.BLEND),c.render()),n.viewOffset.enabled=!1,n.update(),t>=g.length?-2:t},e}(),jR=[[[0,0]],[[4,4],[-4,-4]],[[-2,-6],[6,-2],[-6,2],[2,6]],[[1,-3],[-1,3],[5,1],[-3,-5],[-5,5],[-7,-1],[3,7],[7,-7]],[[1,1],[-1,-3],[-3,2],[4,-1],[-5,-2],[2,5],[5,3],[3,-5],[-2,6],[0,-7],[-4,-6],[-6,4],[-8,0],[7,-4],[6,7],[-7,-8]],[[-4,-7],[-7,-5],[-3,-5],[-5,-4],[-1,-4],[-2,-2],[-6,-1],[-4,0],[-7,1],[-1,2],[-6,3],[-3,3],[-7,6],[-3,6],[-5,7],[-1,7],[5,-7],[1,-6],[6,-5],[4,-4],[2,-3],[7,-2],[1,-1],[4,-1],[2,1],[6,2],[0,4],[4,4],[2,5],[7,5],[5,6],[3,7]]];jR.forEach(function(e){e.forEach(function(t){t[0]*=.0625,t[1]*=.0625})});var sie=function(){function e(t){this.multiSamplePass=t,this.sampleIndex=-2}return e.prototype.update=function(t,r){return t&&(this.sampleIndex=-1),r.mode==="temporal"?this.sampleIndex!==-2:!1},e.prototype.render=function(t,r,n,i,a,o,s){this.sampleIndex=this.multiSamplePass.render(this.sampleIndex,t,r,n,i,a,o,s)},e}(),uie={eyeSeparation:I.Numeric(.064,{min:.01,max:.5,step:.001}),focus:I.Numeric(10,{min:1,max:100,step:.01})},Frt=I.getDefaultValues(uie),S0=function(){function e(t,r){r===void 0&&(r={}),this.parent=t,this.left=new MH,this.right=new MH,this.props=E(E({},Frt),r)}return Object.defineProperty(e.prototype,"viewport",{get:function(){return this.parent.viewport},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"viewOffset",{get:function(){return this.parent.viewOffset},enumerable:!1,configurable:!0}),e.prototype.setProps=function(t){Object.assign(this.props,t)},e.prototype.update=function(){this.parent.update(),Lrt(this.parent,this.props,this.left,this.right)},e}();(function(e){function t(r){return"left"in r&&"right"in r}e.is=t})(S0||(S0={}));var MH=function(){function e(){this.viewport=Qi.create(0,0,0,0),this.view=ue(),this.projection=ue(),this.projectionView=ue(),this.inverseProjectionView=ue(),this.state=hi.createDefaultSnapshot(),this.viewOffset=hi.ViewOffset(),this.far=0,this.near=0,this.fogFar=0,this.fogNear=0}return e}(),DH=ue.identity(),RH=ue.identity();function Lrt(e,t,r,n){Qi.copy(r.viewport,e.viewport),ue.copy(r.view,e.view),ue.copy(r.projection,e.projection),hi.copySnapshot(r.state,e.state),hi.copyViewOffset(r.viewOffset,e.viewOffset),r.far=e.far,r.near=e.near,r.fogFar=e.fogFar,r.fogNear=e.fogNear,Qi.copy(n.viewport,e.viewport),ue.copy(n.view,e.view),ue.copy(n.projection,e.projection),hi.copySnapshot(n.state,e.state),hi.copyViewOffset(n.viewOffset,e.viewOffset),n.far=e.far,n.near=e.near,n.fogFar=e.fogFar,n.fogNear=e.fogNear;var i=Math.floor(e.viewport.width/2),a=i/e.viewport.height;r.viewport.width=i,n.viewport.x+=i,n.viewport.width-=i;var o=t.eyeSeparation/2,s=o*e.near/t.focus,u=e.near*Math.tan(e.state.fov*.5),l,c;DH[12]=-o,RH[12]=o,l=-u*a+s,c=u*a+s,r.projection[0]=2*e.near/(c-l),r.projection[8]=(c+l)/(c-l),ue.mul(r.view,r.view,DH),ue.mul(r.projectionView,r.projection,r.view),ue.invert(r.inverseProjectionView,r.projectionView),l=-u*a-s,c=u*a-s,n.projection[0]=2*e.near/(c-l),n.projection[8]=(c+l)/(c-l),ue.mul(n.view,n.view,RH),ue.mul(n.projectionView,n.projection,n.view),ue.invert(n.inverseProjectionView,n.projectionView)}var XT=Math.pow(2,24)-2,Nrt=function(){function e(t,r,n){this.webgl=t,this.drawPass=r,this.pickBaseScale=n;var i=n/t.pixelRatio;this.pickWidth=Math.ceil(r.colorTarget.getWidth()*i),this.pickHeight=Math.ceil(r.colorTarget.getHeight()*i),this.objectPickTarget=t.createRenderTarget(this.pickWidth,this.pickHeight),this.instancePickTarget=t.createRenderTarget(this.pickWidth,this.pickHeight),this.groupPickTarget=t.createRenderTarget(this.pickWidth,this.pickHeight),this.depthPickTarget=t.createRenderTarget(this.pickWidth,this.pickHeight)}return Object.defineProperty(e.prototype,"drawingBufferHeight",{get:function(){return this.drawPass.colorTarget.getHeight()},enumerable:!1,configurable:!0}),e.prototype.syncSize=function(){var t=this.pickBaseScale/this.webgl.pixelRatio,r=Math.ceil(this.drawPass.colorTarget.getWidth()*t),n=Math.ceil(this.drawPass.colorTarget.getHeight()*t);(r!==this.pickWidth||n!==this.pickHeight)&&(this.pickWidth=r,this.pickHeight=n,this.objectPickTarget.setSize(this.pickWidth,this.pickHeight),this.instancePickTarget.setSize(this.pickWidth,this.pickHeight),this.groupPickTarget.setSize(this.pickWidth,this.pickHeight),this.depthPickTarget.setSize(this.pickWidth,this.pickHeight))},e.prototype.renderVariant=function(t,r,n,i,a){var o=this.drawPass.depthTexturePrimitives;t.clear(!1),t.update(r),t.renderPick(n.primitives,r,a,null),t.renderPick(n.volumes,r,a,o),t.renderPick(i.handle.scene,r,a,null),i.camera.isEnabled&&(i.camera.update(r),t.update(i.camera.camera),t.renderPick(i.camera.scene,i.camera.camera,a,null))},e.prototype.render=function(t,r,n,i){this.objectPickTarget.bind(),this.renderVariant(t,r,n,i,"pickObject"),this.instancePickTarget.bind(),this.renderVariant(t,r,n,i,"pickInstance"),this.groupPickTarget.bind(),this.renderVariant(t,r,n,i,"pickGroup"),this.depthPickTarget.bind(),this.renderVariant(t,r,n,i,"depth")},e}(),Brt=function(){function e(t,r,n,i,a,o){this.webgl=t,this.renderer=r,this.scene=n,this.helper=i,this.pickPass=a,this.dirty=!0,this.viewport=Qi(),this.setViewport(o.x,o.y,o.width,o.height)}return e.prototype.setupBuffers=function(){var t=this.pickWidth*this.pickHeight*4;(!this.objectBuffer||this.objectBuffer.length!==t)&&(this.objectBuffer=new Uint8Array(t),this.instanceBuffer=new Uint8Array(t),this.groupBuffer=new Uint8Array(t),this.depthBuffer=new Uint8Array(t))},e.prototype.setViewport=function(t,r,n,i){Qi.set(this.viewport,t,r,n,i),this.pickScale=this.pickPass.pickBaseScale/this.webgl.pixelRatio,this.pickX=Math.ceil(t*this.pickScale),this.pickY=Math.ceil(r*this.pickScale);var a=Math.floor(n*this.pickScale),o=Math.floor(i*this.pickScale);(a!==this.pickWidth||o!==this.pickHeight)&&(this.pickWidth=a,this.pickHeight=o,this.halfPickWidth=Math.floor(this.pickWidth/2),this.setupBuffers())},e.prototype.syncBuffers=function(){var t=this,r=t.pickX,n=t.pickY,i=t.pickWidth,a=t.pickHeight;this.pickPass.objectPickTarget.bind(),this.webgl.readPixels(r,n,i,a,this.objectBuffer),this.pickPass.instancePickTarget.bind(),this.webgl.readPixels(r,n,i,a,this.instanceBuffer),this.pickPass.groupPickTarget.bind(),this.webgl.readPixels(r,n,i,a,this.groupBuffer),this.pickPass.depthPickTarget.bind(),this.webgl.readPixels(r,n,i,a,this.depthBuffer)},e.prototype.getBufferIdx=function(t,r){return(r*this.pickWidth+t)*4},e.prototype.getDepth=function(t,r){var n=this.getBufferIdx(t,r),i=this.depthBuffer;return Rje(i[n],i[n+1],i[n+2],i[n+3])},e.prototype.getId=function(t,r,n){var i=this.getBufferIdx(t,r);return dF(n[i],n[i+1],n[i+2])},e.prototype.render=function(t){var r=this,n=r.pickX,i=r.pickY,a=r.pickWidth,o=r.pickHeight,s=r.halfPickWidth,u=this,l=u.renderer,c=u.scene,d=u.helper;l.setTransparentBackground(!1),l.setDrawingBufferSize(this.pickPass.objectPickTarget.getWidth(),this.pickPass.objectPickTarget.getHeight()),S0.is(t)?(l.setViewport(n,i,s,o),this.pickPass.render(l,t.left,c,d),l.setViewport(n+s,i,a-s,o),this.pickPass.render(l,t.right,c,d)):(l.setViewport(n,i,a,o),this.pickPass.render(l,t,c,d)),this.dirty=!1},e.prototype.identify=function(t,r,n){var i=this,a=i.webgl,o=i.pickScale;if(!a.isContextLost){t*=a.pixelRatio,r*=a.pixelRatio,r=this.pickPass.drawingBufferHeight-r;var s=this.viewport;if(!(t<s.x||r<s.y||t>s.x+s.width||r>s.y+s.height)){this.dirty&&(this.render(n),this.syncBuffers());var u=t-s.x,l=r-s.y,c=Math.floor(u*o),d=Math.floor(l*o),f=this.getId(c,d,this.objectBuffer);if(!(f===-1||f===XT)){var h=this.getId(c,d,this.instanceBuffer);if(!(h===-1||h===XT)){var v=this.getId(c,d,this.groupBuffer);if(!(v===-1||v===XT)){var p=this.getDepth(c,d),m=_.create(t,s.height-r,p);if(S0.is(n)){var g=Math.floor(s.width/2);t>s.x+g?(m[0]=s.x+(u-g)*2,TC(m,m,s,n.right.inverseProjectionView)):(m[0]=s.x+u*2,TC(m,m,s,n.left.inverseProjectionView))}else TC(m,m,s,n.inverseProjectionView);return{id:{objectId:f,instanceId:h,groupId:v},position:m}}}}}}},e}(),Urt=`
precision highp float;
precision highp sampler2D;

uniform sampler2D tDepthPrimitives;
uniform sampler2D tDepthVolumes;
uniform vec2 uTexSize;

#include common

float getDepth(const in vec2 coords, sampler2D tDepth) {
    #ifdef dPackedDepth
        return unpackRGBAToDepth(texture2D(tDepth, coords));
    #else
        return texture2D(tDepth, coords).r;
    #endif
}

void main() {
    vec2 coords = gl_FragCoord.xy / uTexSize;
    float depth = min(getDepth(coords, tDepthPrimitives), getDepth(coords, tDepthVolumes));
    gl_FragColor = packDepthToRGBA(depth);
}
`,jrt=`
precision highp float;
precision highp sampler2D;

uniform sampler2D tColor;
uniform vec2 uTexSize;

void main() {
    vec2 coords = gl_FragCoord.xy / uTexSize;
    gl_FragColor = texture2D(tColor, coords);
}
`,zrt=`
precision highp float;

uniform sampler2D tWboitA;
uniform sampler2D tWboitB;
uniform vec2 uTexSize;

void main() {
    vec2 coords = gl_FragCoord.xy / uTexSize;

    vec4 accum = texture2D(tWboitA, coords);
    float r = 1.0 - accum.a;

    accum.a = texture2D(tWboitB, coords).r;
    // divisor needs to allow very small values for nice fading
    gl_FragColor = vec4(accum.rgb / clamp(accum.a, 0.00000001, 50000.0), r);
}
`,Vrt=E(E({},Pa),{tWboitA:cr("texture","rgba","float","nearest"),tWboitB:cr("texture","rgba","float","nearest"),uTexSize:Ge("v2")}),Hrt=Bn("evaluate-wboit",Bo,zrt);function Grt(e,t,r){var n=E(E({},Ta),{tWboitA:L.create(t),tWboitB:L.create(r),uTexSize:L.create(He.create(t.getWidth(),t.getHeight()))}),i=E({},Vrt),a=ra(e,"triangles",Hrt,i,n);return ta(a,n)}var qrt=function(){function e(t,r,n){if(this.webgl=t,this._supported=!1,!!e.isSupported(t)){var i=t.resources;this.textureA=i.texture("image-float32","rgba","float","nearest"),this.textureA.define(r,n),this.textureB=i.texture("image-float32","rgba","float","nearest"),this.textureB.define(r,n),this.renderable=Grt(t,this.textureA,this.textureB),this.framebuffer=i.framebuffer(),this._supported=!0,this._init()}}return Object.defineProperty(e.prototype,"supported",{get:function(){return this._supported},enumerable:!1,configurable:!0}),e.prototype.bind=function(){var t=this.webgl,r=t.state,n=t.gl;this.framebuffer.bind(),r.clearColor(0,0,0,1),n.clear(n.COLOR_BUFFER_BIT),r.disable(n.DEPTH_TEST),r.blendFuncSeparate(n.ONE,n.ONE,n.ZERO,n.ONE_MINUS_SRC_ALPHA),r.enable(n.BLEND)},e.prototype.render=function(){var t=this.webgl,r=t.state,n=t.gl;r.blendFuncSeparate(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA),r.enable(n.BLEND),this.renderable.update(),this.renderable.render()},e.prototype.setSize=function(t,r){var n=this.renderable.values.uTexSize.ref.value,i=n[0],a=n[1];(t!==i||r!==a)&&(this.textureA.define(t,r),this.textureB.define(t,r),L.update(this.renderable.values.uTexSize,He.set(this.renderable.values.uTexSize.ref.value,t,r)))},e.prototype.reset=function(){this._supported&&this._init()},e.prototype._init=function(){var t=this.webgl.extensions.drawBuffers;this.framebuffer.bind(),t.drawBuffers([t.COLOR_ATTACHMENT0,t.COLOR_ATTACHMENT1]),this.textureA.attachFramebuffer(this.framebuffer,"color0"),this.textureB.attachFramebuffer(this.framebuffer,"color1")},e.isSupported=function(t){var r=t.extensions,n=r.drawBuffers,i=r.textureFloat,a=r.colorBufferFloat,o=r.depthTexture;if(!i||!a||!o||!n){if(Lr){var s=[];i||s.push("textureFloat"),a||s.push("colorBufferFloat"),o||s.push("depthTexture"),n||s.push("drawBuffers"),console.log('Missing "'+s.join('", "')+'" extensions required for "wboit"')}return!1}else return!0},e}(),$rt=E(E({},Pa),{tDepthPrimitives:cr("texture","depth","ushort","nearest"),tDepthVolumes:cr("texture","depth","ushort","nearest"),uTexSize:Ge("v2"),dPackedDepth:Jt("boolean")}),Wrt=Bn("depth-merge",Bo,Urt);function Xrt(e,t,r,n){var i=E(E({},Ta),{tDepthPrimitives:L.create(t),tDepthVolumes:L.create(r),uTexSize:L.create(He.create(t.getWidth(),t.getHeight())),dPackedDepth:L.create(n)}),a=E({},$rt),o=ra(e,"triangles",Wrt,a,i);return ta(o,i)}var Yrt=E(E({},Pa),{tColor:cr("texture","rgba","ubyte","nearest"),uTexSize:Ge("v2")}),Krt=Bn("copy",Bo,jrt);function kH(e,t){var r=E(E({},Ta),{tColor:L.create(t),uTexSize:L.create(He.create(t.getWidth(),t.getHeight()))}),n=E({},Yrt),i=ra(e,"triangles",Krt,n,r);return ta(i,r)}var lie=function(){function e(t,r,n,i){this.webgl=t;var a=t.extensions,o=t.resources,s=t.isWebGL2;this.drawTarget=vHe(t.gl),this.colorTarget=t.createRenderTarget(r,n,!0,"uint8","linear"),this.packedDepth=!a.depthTexture,this.depthTarget=t.createRenderTarget(r,n),this.depthTexture=this.depthTarget.texture,this.depthTargetPrimitives=this.packedDepth?t.createRenderTarget(r,n):null,this.depthTargetVolumes=this.packedDepth?t.createRenderTarget(r,n):null,this.depthTexturePrimitives=this.depthTargetPrimitives?this.depthTargetPrimitives.texture:o.texture("image-depth","depth",s?"float":"ushort","nearest"),this.depthTextureVolumes=this.depthTargetVolumes?this.depthTargetVolumes.texture:o.texture("image-depth","depth",s?"float":"ushort","nearest"),this.packedDepth||(this.depthTexturePrimitives.define(r,n),this.depthTextureVolumes.define(r,n)),this.depthMerge=Xrt(t,this.depthTexturePrimitives,this.depthTextureVolumes,this.packedDepth),this.wboit=i?new qrt(t,r,n):void 0,this.postprocessing=new Tc(t,this),this.antialiasing=new WT(t,this),this.copyFboTarget=kH(t,this.colorTarget.texture),this.copyFboPostprocessing=kH(t,this.postprocessing.target.texture)}return Object.defineProperty(e.prototype,"wboitEnabled",{get:function(){var t;return!!(!((t=this.wboit)===null||t===void 0)&&t.supported)},enumerable:!1,configurable:!0}),e.prototype.reset=function(){var t;(t=this.wboit)===null||t===void 0||t.reset()},e.prototype.setSize=function(t,r){var n,i=this.colorTarget.getWidth(),a=this.colorTarget.getHeight();(t!==i||r!==a)&&(this.colorTarget.setSize(t,r),this.depthTarget.setSize(t,r),this.depthTargetPrimitives?this.depthTargetPrimitives.setSize(t,r):this.depthTexturePrimitives.define(t,r),this.depthTargetVolumes?this.depthTargetVolumes.setSize(t,r):this.depthTextureVolumes.define(t,r),L.update(this.depthMerge.values.uTexSize,He.set(this.depthMerge.values.uTexSize.ref.value,t,r)),L.update(this.copyFboTarget.values.uTexSize,He.set(this.copyFboTarget.values.uTexSize.ref.value,t,r)),L.update(this.copyFboPostprocessing.values.uTexSize,He.set(this.copyFboPostprocessing.values.uTexSize.ref.value,t,r)),!((n=this.wboit)===null||n===void 0)&&n.supported&&this.wboit.setSize(t,r),this.postprocessing.setSize(t,r),this.antialiasing.setSize(t,r))},e.prototype._depthMerge=function(){var t=this.webgl,r=t.state,n=t.gl;this.depthMerge.update(),this.depthTarget.bind(),r.disable(n.BLEND),r.disable(n.DEPTH_TEST),r.disable(n.CULL_FACE),r.depthMask(!1),r.clearColor(1,1,1,1),n.clear(n.COLOR_BUFFER_BIT),this.depthMerge.render()},e.prototype._renderWboit=function(t,r,n,i,a){var o;if(!(!((o=this.wboit)===null||o===void 0)&&o.supported))throw new Error("expected wboit to be supported");this.colorTarget.bind(),t.clear(!0),this.depthTexturePrimitives.attachFramebuffer(this.colorTarget.framebuffer,"depth"),this.colorTarget.bind(),t.clearDepth(),t.renderWboitOpaque(n.primitives,r,null),this.depthTextureVolumes.attachFramebuffer(this.colorTarget.framebuffer,"depth"),this.colorTarget.bind(),t.clearDepth(),t.renderWboitOpaque(n.volumes,r,this.depthTexturePrimitives),this._depthMerge(),Tc.isEnabled(a)&&this.postprocessing.render(r,!1,i,t.props.backgroundColor,a),this.wboit.bind(),t.renderWboitTransparent(n.primitives,r,this.depthTexture),t.renderWboitTransparent(n.volumes,r,this.depthTexture),Tc.isEnabled(a)?(this.depthTexturePrimitives.attachFramebuffer(this.postprocessing.target.framebuffer,"depth"),this.postprocessing.target.bind()):(this.depthTexturePrimitives.attachFramebuffer(this.colorTarget.framebuffer,"depth"),this.colorTarget.bind()),this.wboit.render()},e.prototype._renderBlended=function(t,r,n,i,a,o){if(i?this.drawTarget.bind():(this.colorTarget.bind(),this.packedDepth||this.depthTexturePrimitives.attachFramebuffer(this.colorTarget.framebuffer,"depth")),t.clear(!0),t.renderBlendedOpaque(n.primitives,r,null),!i){this.depthTargetPrimitives&&(this.depthTargetPrimitives.bind(),t.clear(!1),t.renderDepth(n.primitives,r,null),this.colorTarget.bind()),this.packedDepth||(this.depthTextureVolumes.attachFramebuffer(this.colorTarget.framebuffer,"depth"),t.clearDepth()),t.renderBlendedVolumeOpaque(n.volumes,r,this.depthTexturePrimitives),this.depthTargetVolumes&&(this.depthTargetVolumes.bind(),t.clear(!1),t.renderDepth(n.volumes,r,this.depthTexturePrimitives),this.colorTarget.bind()),this._depthMerge(),this.colorTarget.bind(),Tc.isEnabled(o)&&this.postprocessing.render(r,!1,a,t.props.backgroundColor,o),t.renderBlendedVolumeTransparent(n.volumes,r,this.depthTexturePrimitives);var s=Tc.isEnabled(o)?this.postprocessing.target:this.colorTarget;this.packedDepth||this.depthTexturePrimitives.attachFramebuffer(s.framebuffer,"depth"),s.bind()}t.renderBlendedTransparent(n.primitives,r,null)},e.prototype._render=function(t,r,n,i,a,o,s){var u=n.volumes.renderables.length>0,l=Tc.isEnabled(s),c=WT.isEnabled(s),d=r.viewport,f=d.x,h=d.y,v=d.width,p=d.height;t.setViewport(f,h,v,p),t.update(r),o&&!c&&a&&(this.drawTarget.bind(),t.clear(!1)),this.wboitEnabled?this._renderWboit(t,r,n,o,s):this._renderBlended(t,r,n,!u&&!l&&!c&&a,o,s),l?this.postprocessing.target.bind():!a||u||this.wboitEnabled?this.colorTarget.bind():this.drawTarget.bind(),i.debug.isEnabled&&(i.debug.syncVisibility(),t.renderBlended(i.debug.scene,r,null)),i.handle.isEnabled&&t.renderBlended(i.handle.scene,r,null),i.camera.isEnabled&&(i.camera.update(r),t.update(i.camera.camera),t.renderBlended(i.camera.scene,i.camera.camera,null)),c?this.antialiasing.render(r,a,s):a&&(this.drawTarget.bind(),this.webgl.state.disable(this.webgl.gl.DEPTH_TEST),l?this.copyFboPostprocessing.render():(u||this.wboitEnabled)&&this.copyFboTarget.render()),this.webgl.gl.flush()},e.prototype.render=function(t,r,n,i,a,o,s){t.setTransparentBackground(o),t.setDrawingBufferSize(this.colorTarget.getWidth(),this.colorTarget.getHeight()),S0.is(r)?(this._render(t,r.left,n,i,a,o,s),this._render(t,r.right,n,i,a,o,s)):this._render(t,r,n,i,a,o,s)},e.prototype.getColorTarget=function(t){return WT.isEnabled(t)?this.antialiasing.target:Tc.isEnabled(t)?this.postprocessing.target:this.colorTarget},e}(),Qrt=E(E({},Lt.Params),{alpha:E(E({},Lt.Params.alpha),{defaultValue:.51}),ignoreLight:E(E({},Lt.Params.ignoreLight),{defaultValue:!0}),colorX:I.Color(pr.red,{isEssential:!0}),colorY:I.Color(pr.green,{isEssential:!0}),colorZ:I.Color(pr.blue,{isEssential:!0}),scale:I.Numeric(.33,{min:.1,max:2,step:.1},{isEssential:!0})}),EA={axes:I.MappedStatic("on",{on:I.Group(Qrt),off:I.Group({})},{cycle:!0,description:"Show camera orientation axes"})},cie=function(){function e(t,r){var n=this;r===void 0&&(r={}),this.webgl=t,this.props={axes:{name:"off",params:{}}},this.eachGroup=function(i,a){if(!n.renderObject||!zR(i))return!1;for(var o=!1,s=n.renderObject.values.uGroupCount.ref.value,u=i.elements,l=0,c=u;l<c.length;l++){var d=c[l],f=d.groupId,h=d.instanceId,v=h*s+f;a(Ie.ofSingleton(v))&&(o=!0)}return o},this.scene=x0.create(t),this.camera=new hi,_.set(this.camera.up,0,1,0),_.set(this.camera.target,0,0,0),this.setProps(r)}return e.prototype.setProps=function(t){var r=this;this.props=z6(this.props,function(n){if(t.axes!==void 0&&(n.axes.name=t.axes.name,t.axes.name==="on")){r.scene.clear();var i=E(E({},t.axes.params),{scale:t.axes.params.scale*r.webgl.pixelRatio});r.renderObject=nnt(i),r.renderObject.state.noClip=!0,r.scene.add(r.renderObject),r.scene.commit(),_.set(r.camera.position,0,0,i.scale*200),ue.lookAt(r.camera.view,r.camera.position,r.camera.target,r.camera.up),n.axes.params=E({},t.axes.params)}})},Object.defineProperty(e.prototype,"isEnabled",{get:function(){return this.props.axes.name==="on"},enumerable:!1,configurable:!0}),e.prototype.getLoci=function(t){var r=t.objectId,n=t.groupId,i=t.instanceId;return!this.renderObject||r!==this.renderObject.id||n===0?jr:Jrt(this,n,i)},e.prototype.mark=function(t,r){return!Lo.is(Lo.Highlighting,r)||!zR(t)||t.data!==this?!1:Pr.mark(this.renderObject,t,r,this.eachGroup)},e.prototype.update=function(t){if(this.renderObject){ent(this.camera,t.viewport,t.viewOffset),ue.extractRotation(this.scene.view,t.view);var r=this.renderObject.values.boundingSphere.ref.value.radius;ue.setTranslation(this.scene.view,_.create(-t.viewport.width/2+r,-t.viewport.height/2+r,0))}},e}();function Zrt(e){switch(e){case 1:return"X Axis";case 2:return"Y Axis";case 3:return"Z Axis";case 4:return"XY Plane";case 5:return"XZ Plane";case 6:return"YZ Plane";default:return"Axes"}}function Jrt(e,t,r){return lA("camera-axes",e,[{groupId:t,instanceId:r}],void 0,function(){return Zrt(t)})}function zR(e){return e.kind==="data-loci"&&e.tag==="camera-axes"}function ent(e,t,r){var n=e.near,i=e.far,a=-t.width/2,o=t.width/2,s=t.height/2,u=-t.height/2,l=(o-a)/2,c=(s-u)/2,d=(o+a)/2,f=(s+u)/2,h=d-l,v=d+l,p=f+c,m=f-c;if(r.enabled){var g=(o-a)/r.width,y=(s-u)/r.height;h+=g*r.offsetX,v=h+g*r.width,p-=y*r.offsetY,m=p-y*r.height}ue.ortho(e.projection,h,v,p,m,n,i)}function tnt(e,t){var r=wt.createState(512,256,t),n=.075*e,i=_.scale(_(),_.unitX,e),a=_.scale(_(),_.unitY,e),o=_.scale(_(),_.unitZ,e),s={radiusTop:n,radiusBottom:n,radialSegments:32};r.currentGroup=0,zi(r,_.origin,n,2),r.currentGroup=1,zi(r,i,n,2),Ha(r,_.origin,i,1,s),r.currentGroup=2,zi(r,a,n,2),Ha(r,_.origin,a,1,s),r.currentGroup=3,zi(r,o,n,2),Ha(r,_.origin,o,1,s),_.scale(i,i,.5),_.scale(a,a,.5),_.scale(o,o,.5),r.currentGroup=4,wt.addTriangle(r,_.origin,i,a),wt.addTriangle(r,_.origin,a,i);var u=_.add(_(),i,a);wt.addTriangle(r,u,i,a),wt.addTriangle(r,u,a,i),r.currentGroup=5,wt.addTriangle(r,_.origin,i,o),wt.addTriangle(r,_.origin,o,i);var l=_.add(_(),i,o);wt.addTriangle(r,l,i,o),wt.addTriangle(r,l,o,i),r.currentGroup=6,wt.addTriangle(r,_.origin,a,o),wt.addTriangle(r,_.origin,o,a);var c=_.add(_(),a,o);return wt.addTriangle(r,c,a,o),wt.addTriangle(r,c,o,a),wt.getMesh(r)}function rnt(e,t){var r=100*e.scale,n=tnt(r,t==null?void 0:t.geometry);n.setBoundingSphere(Be.create(_.create(r/2,r/2,r/2),r+r/4));var i=function(a){switch(a){case 1:return e.colorX;case 2:return e.colorY;case 3:return e.colorZ;default:return pr.grey}};return Ur.create("axes",{},n,i,function(){return 1},function(){return""})}function nnt(e){var t=rnt(e);return Ur.createRenderObject(t,e)}var int={transparentBackground:I.Boolean(!1),multiSample:I.Group(oie),postprocessing:I.Group(aie),cameraHelper:I.Group(EA)},ant=function(){function e(t,r,n,i,a,o,s){this.webgl=t,this.renderer=r,this.scene=n,this.camera=i,this._width=0,this._height=0,this._camera=new hi,this.props=E(E({},I.getDefaultValues(int)),s),this.drawPass=new lie(t,128,128,o),this.multiSamplePass=new Yw(t,this.drawPass),this.multiSampleHelper=new sie(this.multiSamplePass),this.helper={camera:new cie(t,this.props.cameraHelper),debug:a.debug,handle:a.handle},this.setSize(1024,768)}return Object.defineProperty(e.prototype,"colorTarget",{get:function(){return this._colorTarget},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return this._width},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height},enumerable:!1,configurable:!0}),e.prototype.setSize=function(t,r){t===this._width&&r===this._height||(this._width=t,this._height=r,this.drawPass.setSize(t,r),this.multiSamplePass.syncSize())},e.prototype.setProps=function(t){t===void 0&&(t={}),Object.assign(this.props,t),t.cameraHelper&&this.helper.camera.setProps(t.cameraHelper)},e.prototype.render=function(){hi.copySnapshot(this._camera.state,this.camera.state),Qi.set(this._camera.viewport,0,0,this._width,this._height),this._camera.update(),Yw.isEnabled(this.props.multiSample)?(this.multiSampleHelper.render(this.renderer,this._camera,this.scene,this.helper,!1,this.props.transparentBackground,this.props),this._colorTarget=this.multiSamplePass.colorTarget):(this.drawPass.render(this.renderer,this._camera,this.scene,this.helper,!1,this.props.transparentBackground,this.props.postprocessing),this._colorTarget=this.drawPass.getColorTarget(this.props.postprocessing))},e.prototype.getImageData=function(t,r,n){var i,a;this.setSize(t,r),this.render(),this.colorTarget.bind();var o=(i=n==null?void 0:n.width)!==null&&i!==void 0?i:t,s=(a=n==null?void 0:n.height)!==null&&a!==void 0?a:r,u=new Uint8Array(o*s*4);n?this.webgl.readPixels(n.x,r-n.y-n.height,o,s,u):this.webgl.readPixels(0,0,o,s,u);var l=ov.create(u,o,s);return ov.flipY(l),ov.divideByAlpha(l),new ImageData(new Uint8ClampedArray(u),o,s)},e}(),ont=E(E({},Lt.Params),{alpha:E(E({},Lt.Params.alpha),{defaultValue:1}),ignoreLight:E(E({},Lt.Params.ignoreLight),{defaultValue:!0}),colorX:I.Color(pr.red,{isEssential:!0}),colorY:I.Color(pr.green,{isEssential:!0}),colorZ:I.Color(pr.blue,{isEssential:!0}),scale:I.Numeric(.33,{min:.1,max:2,step:.1},{isEssential:!0})}),die={handle:I.MappedStatic("off",{on:I.Group(ont),off:I.Group({})},{cycle:!0,description:"Show handle tool"})},snt=function(){function e(t,r){var n=this;r===void 0&&(r={}),this.webgl=t,this.props={handle:{name:"off",params:{}}},this._transform=ue(),this.eachGroup=function(i,a){if(!n.renderObject||!OH(i))return!1;for(var o=!1,s=n.renderObject.values.uGroupCount.ref.value,u=i.elements,l=0,c=u;l<c.length;l++){var d=c[l],f=d.groupId,h=d.instanceId,v=h*s+f;a(Ie.ofSingleton(v))&&(o=!0)}return o},this.scene=x0.create(t),this.setProps(r)}return e.prototype.getBoundingSphere=function(t,r){return this.renderObject&&(Be.copy(t,this.renderObject.values.invariantBoundingSphere.ref.value),ue.fromArray(this._transform,this.renderObject.values.aTransform.ref.value,r*16),Be.transform(t,t,this._transform)),t},e.prototype.setProps=function(t){var r=this;this.props=z6(this.props,function(n){if(t.handle!==void 0&&(n.handle.name=t.handle.name,t.handle.name==="on")){r.scene.clear();var i=E(E({},t.handle.params),{scale:t.handle.params.scale*r.webgl.pixelRatio});r.renderObject=dnt(i),r.renderObject.state.noClip=!0,r.scene.add(r.renderObject),r.scene.commit(),n.handle.params=E({},t.handle.params)}})},Object.defineProperty(e.prototype,"isEnabled",{get:function(){return this.props.handle.name==="on"},enumerable:!1,configurable:!0}),e.prototype.update=function(t,r,n){this.renderObject&&(ue.setTranslation(this.renderObject.values.aTransform.ref.value,r),ue.fromMat3(this.renderObject.values.aTransform.ref.value,n),L.update(this.renderObject.values.aTransform,this.renderObject.values.aTransform.ref.value),this.scene.update([this.renderObject],!0))},e.prototype.getLoci=function(t){var r=t.objectId,n=t.groupId,i=t.instanceId;return!this.renderObject||r!==this.renderObject.id?jr:lnt(this,n,i)},e.prototype.mark=function(t,r){return!Lo.is(Lo.Highlighting,r)||!OH(t)||t.data!==this?!1:Pr.mark(this.renderObject,t,r,this.eachGroup)},e}();function unt(e,t){var r=wt.createState(512,256,t),n=.05*e,i=_.scale(_(),_.unitX,e),a=_.scale(_(),_.unitY,e),o=_.scale(_(),_.unitZ,e),s={radiusTop:n,radiusBottom:n,radialSegments:32};return r.currentGroup=$p.TranslateScreenXY,zi(r,_.origin,n*3,2),r.currentGroup=$p.TranslateObjectX,zi(r,i,n,2),Ha(r,_.origin,i,1,s),r.currentGroup=$p.TranslateObjectY,zi(r,a,n,2),Ha(r,_.origin,a,1,s),r.currentGroup=$p.TranslateObjectZ,zi(r,o,n,2),Ha(r,_.origin,o,1,s),wt.getMesh(r)}var $p={None:0,TranslateScreenXY:1,TranslateObjectX:3,TranslateObjectY:4,TranslateObjectZ:5};function lnt(e,t,r){return lA("handle",e,[{groupId:t,instanceId:r}],function(n){return e.getBoundingSphere(n,r)},function(){return"Handle Helper | Group Id "+t+" | Instance Id "+r})}function OH(e){return e.kind==="data-loci"&&e.tag==="handle"}function cnt(e,t){var r=10*e.scale,n=unt(r,t==null?void 0:t.geometry);n.setBoundingSphere(Be.create(_.create(r/2,r/2,r/2),r+r/4));var i=function(a){switch(a){case $p.TranslateObjectX:return e.colorX;case $p.TranslateObjectY:return e.colorY;case $p.TranslateObjectZ:return e.colorZ;default:return pr.grey}};return Ur.create("handle",{},n,i,function(){return 1},function(){return""})}function dnt(e){var t=cnt(e);return Ur.createRenderObject(t,e)}var fnt={debug:I.Group(zF),camera:I.Group({helper:I.Group(EA)}),handle:I.Group(die)},hnt=I.getDefaultValues(fnt),pnt=function(){function e(t,r,n){n===void 0&&(n={});var i=E(E({},hnt),n);this.debug=new Utt(t,r,i.debug),this.camera=new cie(t,i.camera.helper),this.handle=new snt(t,i.handle)}return e}(),vnt=function(){function e(t,r){r===void 0&&(r={}),this.webgl=t;var n=t.gl;this.draw=new lie(t,n.drawingBufferWidth,n.drawingBufferHeight,r.enableWboit||!1),this.pick=new Nrt(t,this.draw,r.pickScale||.25),this.multiSample=new Yw(t,this.draw)}return e.prototype.updateSize=function(){var t=this.webgl.gl;this.draw.setSize(t.drawingBufferWidth,t.drawingBufferHeight),this.pick.syncSize(),this.multiSample.syncSize()},e}(),ks={camera:I.Group({mode:I.Select("perspective",I.arrayToOptions(["perspective","orthographic"]),{label:"Camera"}),helper:I.Group(EA,{isFlat:!0}),stereo:I.MappedStatic("off",{on:I.Group(uie),off:I.Group({})},{cycle:!0,hideIf:function(e){return(e==null?void 0:e.mode)!=="perspective"}}),manualReset:I.Boolean(!1,{isHidden:!0})},{pivot:"mode"}),cameraFog:I.MappedStatic("on",{on:I.Group({intensity:I.Numeric(15,{min:1,max:100,step:1})}),off:I.Group({})},{cycle:!0,description:"Show fog in the distance"}),cameraClipping:I.Group({radius:I.Numeric(100,{min:0,max:99,step:1},{label:"Clipping",description:"How much of the scene to show."}),far:I.Boolean(!0,{description:"Hide scene in the distance"})},{pivot:"radius"}),viewport:I.MappedStatic("canvas",{canvas:I.Group({}),"static-frame":I.Group({x:I.Numeric(0),y:I.Numeric(0),width:I.Numeric(128),height:I.Numeric(128)}),"relative-frame":I.Group({x:I.Numeric(.33,{min:0,max:1,step:.01}),y:I.Numeric(.33,{min:0,max:1,step:.01}),width:I.Numeric(.5,{min:.01,max:1,step:.01}),height:I.Numeric(.5,{min:.01,max:1,step:.01})})}),cameraResetDurationMs:I.Numeric(250,{min:0,max:1e3,step:1},{description:"The time it takes to reset the camera."}),transparentBackground:I.Boolean(!1),multiSample:I.Group(oie),postprocessing:I.Group(aie),renderer:I.Group(LR),trackball:I.Group(iie),debug:I.Group(zF),handle:I.Group(die)},VF=I.getDefaultValues(ks),VR;(function(e){e.DefaultAttribs={antialias:!0,preserveDrawingBuffer:!0,pixelScale:1,pickScale:.25,enableWboit:!0};function t(r,n){n===void 0&&(n={});var i=E(E({},e.DefaultAttribs),n),a=i.antialias,o=i.preserveDrawingBuffer,s=i.pixelScale,u=mHe(r,{antialias:a,preserveDrawingBuffer:o,alpha:!0,depth:!0,premultipliedAlpha:!0});if(u===null)throw new Error("Could not create a WebGL rendering context");var l=FR.fromElement(r,{pixelScale:s}),c=SHe(u,{pixelScale:s}),d=new vnt(c,n);if(Lr){var f=u.getExtension("WEBGL_lose_context");f&&r.addEventListener("mousedown",function(m){c.isContextLost||!m.shiftKey||!m.ctrlKey||!m.altKey||(Lr&&console.log("lose context"),f.loseContext(),setTimeout(function(){c.isContextLost&&(Lr&&console.log("restore context"),f.restoreContext())},1e3))},!1)}var h=new Kf(0),v=function(m){c.setContextLost(),m.preventDefault(),Lr&&console.log("context lost"),h.next(Ln())},p=function(){c.isContextLost&&(c.handleContextRestored(function(){d.draw.reset()}),Lr&&console.log("context restored"))};return r.addEventListener("webglcontextlost",v,!1),r.addEventListener("webglcontextrestored",p,!1),{canvas:r,webgl:c,input:l,passes:d,attribs:i,contextLost:h,contextRestored:c.contextRestored,dispose:function(m){l.dispose(),r.removeEventListener("webglcontextlost",v,!1),r.removeEventListener("webglcontextrestored",p,!1),c.destroy(m)}}}e.fromCanvas=t})(VR||(VR={}));var mnt=typeof window<"u"?window.requestAnimationFrame:function(e){return setImmediate(function(){return e(Date.now())})},gnt=typeof window<"u"?window.cancelAnimationFrame:function(e){return clearImmediate(e)},HR;(function(e){function t(r,n){var i=r.webgl,a=r.input,o=r.passes,s=r.attribs;n===void 0&&(n={});var u=E(E({},VF),n),l=new Map,c=new Map,d=new Kf(0),f=Ln(),h=new Kf(0),v=new Kf(0),p=i.gl,m=i.contextRestored,g=0,y=0,b=128,S=128;dt();var x=x0.create(i),C=new hi({position:_.create(0,0,100),mode:u.camera.mode,fog:u.cameraFog.name==="on"?u.cameraFog.params.intensity:0,clipFar:u.cameraClipping.far},{x:g,y,width:b,height:S},{pixelScale:s.pixelScale}),w=new S0(C,u.camera.stereo.params),A=BR.create(a,C,u.trackball),M=NR.create(i,u.renderer),D=new pnt(i,x,u),k=new Brt(i,M,x,D,o.pick,{x:g,y,width:b,height:S}),R=new $tt(Ae,$,a,C),O=new sie(o.multiSample),H=!1,B=void 0,j=void 0,Y=!1,G=!0;function $(Me){var Ye=jr,tt=ur.Empty;if(Me){var xt=D.camera.getLoci(Me);if(xt!==jr)return{loci:xt,repr:tt};Ye=D.handle.getLoci(Me),l.forEach(function(pt,ut){var he=ut.getLoci(Me);Nu(he)||(Nu(Ye)||console.warn("found another loci, this should not happen"),Ye=he,tt=ut)})}return{loci:Ye,repr:tt}}function q(Me,Ye){var tt=Me.repr,xt=Me.loci,pt=!1;if(tt?pt=tt.mark(xt,Ye):(pt=D.handle.mark(xt,Ye),pt=D.camera.mark(xt,Ye)||pt,l.forEach(function(he,me){pt=me.mark(xt,Ye)||pt})),pt){x.update(void 0,!0),D.handle.scene.update(void 0,!0),D.camera.scene.update(void 0,!0);var ut=k.dirty;z(!0),k.dirty=ut}}function ee(Me){if(i.isContextLost)return!1;var Ye=!1;if(Y&&(ot(!1),Y=!1,Ye=!0),g>p.drawingBufferWidth||g+b<0||y>p.drawingBufferHeight||y+S<0)return!1;var tt=!1;A.update(X);var xt=C.update(),pt=Me||xt||Ye||fe;fe=!1;var ut=O.update(pt,u.multiSample);if(pt||ut){var he=C;u.camera.stereo.name==="on"&&(w.update(),he=w),Yw.isEnabled(u.multiSample)?O.render(M,he,x,D,!0,u.transparentBackground,u):o.draw.render(M,he,x,D,!0,u.transparentBackground,u.postprocessing),k.dirty=!0,tt=!0}return tt}var fe=!1,W=!1,X=0,U=!1;function z(Me){U||ee(!!Me)&&G&&h.next(Ln()-f)}function J(Me){fe=fe||!!Me}var K=0;function Z(Me,Ye){X=Me,Se(Ye==null?void 0:Ye.isSynchronous),C.transition.tick(X),!(Ye!=null&&Ye.manualDraw)&&(z(!1),!C.transition.inTransition&&!i.isContextLost&&R.tick(X))}function te(){Z(Ln()),K=mnt(te)}function le(Me){f=Me,A.start(Me)}function ye(){U=!1,A.start(Ln()),K===0&&te()}function be(Me){Me===void 0&&(Me=!1),U=Me,gnt(K),K=0}function Ae(Me,Ye){var tt=u.camera.stereo.name==="on"?w:C;return i.isContextLost?void 0:k.identify(Me,Ye,tt)}function Se(Me){Me===void 0&&(Me=!1);var Ye=we(Me);Ye&&(ie(),W&&(D.debug.isEnabled&&D.debug.update(),z(!0),W=!1),v.next(Ln()))}function ie(){if(H){var Me=x.boundingSphereVisible,Ye=Me.center,tt=Me.radius,xt=A.props.autoAdjustMinMaxDistance;if(xt.name==="on"){var pt=xt.params.minDistanceFactor*tt+xt.params.minDistancePadding,ut=Math.max(xt.params.maxDistanceFactor*tt,xt.params.maxDistanceMin);A.setProps({minDistance:pt,maxDistance:ut})}if(tt>0){var he=B===void 0?u.cameraResetDurationMs:B,me=C.getFocus(Ye,tt),Ee=typeof j=="function"?j(x,C):j,Ke=Ee?E(E({},me),Ee):me;C.setState(E(E({},Ke),{radiusMax:x.boundingSphere.radius}),he)}B=void 0,j=void 0,H=!1}}var oe=Be(),F=Be();function V(){if(C.state.radiusMax===0)return!0;if(C.transition.inTransition||j)return!1;var Me=!0;Be.set(F,C.state.target,C.state.radius);for(var Ye=0,tt=x.renderables;Ye<tt.length;Ye++){var xt=tt[Ye];if(xt.state.visible){var pt=xt.values.boundingSphere.ref.value;if(pt.radius){var ut=_.distance(F.center,pt.center);if((ut>F.radius||ut>pt.radius||pt.radius>C.state.radiusMax)&&!Be.includes(oe,pt))return!0;Be.overlaps(F,pt)&&(Me=!1)}}}return Me}var pe=250;function we(Me){return x.needsCommit?(Be.copy(oe,x.boundingSphereVisible),x.commit(Me?void 0:pe)?(D.debug.isEnabled&&D.debug.update(),!u.camera.manualReset&&(d.value===0||V())&&(H=!0),oe.radius===0&&(B=0),C.setState({radiusMax:x.boundingSphere.radius},0),d.next(l.size),Lr&&Te(),!0):!1):!0}function Te(){console.table(x.renderables.map(function(pt){return{drawCount:pt.values.drawCount.ref.value,instanceCount:pt.values.instanceCount.ref.value,materialId:pt.materialId,renderItemId:pt.id}})),console.log(i.stats);var Me=i.resources.getByteCounts(),Ye=Me.texture,tt=Me.attribute,xt=Me.elements;console.log({texture:(Ye/1024/1024).toFixed(3)+" MiB",attribute:(tt/1024/1024).toFixed(3)+" MiB",elements:(xt/1024/1024).toFixed(3)+" MiB"})}function ze(Me){Xe(Me);var Ye=l.get(Me),tt=new Set;Me.renderObjects.forEach(function(xt){return tt.add(xt)}),Ye?gi.areEqual(tt,Ye)||(tt.forEach(function(xt){Ye.has(xt)||x.add(xt)}),Ye.forEach(function(xt){tt.has(xt)||x.remove(xt)})):Me.renderObjects.forEach(function(xt){return x.add(xt)}),l.set(Me,tt),x.update(Me.renderObjects,!1),W=!0,Lr&&Te()}function Ve(Me){ct(Me);var Ye=l.get(Me);Ye&&(Ye.forEach(function(tt){return x.remove(tt)}),l.delete(Me),W=!0,Lr&&Te())}function Xe(Me){c.has(Me)||c.set(Me,Me.updated.subscribe(function(Ye){Me.state.syncManually||ze(Me)}))}function ct(Me){var Ye=c.get(Me);Ye&&(Ye.unsubscribe(),c.delete(Me))}function Ne(){var Me=x.boundingSphere.radius>0?100-Math.round(C.transition.target.radius/x.boundingSphere.radius*100):0;return{camera:{mode:C.state.mode,helper:E({},D.camera.props),stereo:E({},u.camera.stereo),manualReset:!!u.camera.manualReset},cameraFog:C.state.fog>0?{name:"on",params:{intensity:C.state.fog}}:{name:"off",params:{}},cameraClipping:{far:C.state.clipFar,radius:Me},cameraResetDurationMs:u.cameraResetDurationMs,transparentBackground:u.transparentBackground,viewport:u.viewport,postprocessing:E({},u.postprocessing),multiSample:E({},u.multiSample),renderer:E({},M.props),trackball:E({},A.props),debug:E({},D.debug.props),handle:E({},D.handle.props)}}var Qe=m.subscribe(function(){k.dirty=!0,z(!0),z(!0)}),it=new Kf(0);function ot(Me){Me===void 0&&(Me=!0),o.updateSize(),dt(),ke(),Me&&J(!0),it.next(+new Date)}return{webgl:i,add:ze,remove:Ve,commit:Se,update:function(Me,Ye){if(Me){if(!l.has(Me))return;x.update(Me.renderObjects,!!Ye)}else x.update(void 0,!!Ye);W=!0},clear:function(){c.forEach(function(Me){return Me.unsubscribe()}),c.clear(),l.clear(),x.clear(),D.debug.clear(),J(!0),d.next(l.size)},syncVisibility:function(){C.state.radiusMax===0&&(H=!0,B=0),x.syncVisibility()&&D.debug.isEnabled&&D.debug.update(),J(!0)},requestDraw:J,tick:Z,animate:ye,resetTime:le,pause:be,resume:function(){U=!1},identify:Ae,mark:q,getLoci:$,handleResize:ot,requestResize:function(){Y=!0},requestCameraReset:function(Me){B=Me==null?void 0:Me.durationMs,j=Me==null?void 0:Me.snapshot,H=!0},camera:C,boundingSphere:x.boundingSphere,boundingSphereVisible:x.boundingSphereVisible,get notifyDidDraw(){return G},set notifyDidDraw(Me){G=Me},didDraw:h,commited:v,reprCount:d,resized:it,setProps:function(Me,Ye){var tt,xt,pt;Ye===void 0&&(Ye=!1);var ut=typeof Me=="function"?Iv(Ne(),Me):Me,he=Object.create(null);if(ut.camera&&ut.camera.mode!==void 0&&ut.camera.mode!==C.state.mode&&(he.mode=ut.camera.mode),ut.cameraFog!==void 0&&ut.cameraFog.params){var me=ut.cameraFog.name==="on"?ut.cameraFog.params.intensity:0;me!==C.state.fog&&(he.fog=me)}if(ut.cameraClipping!==void 0&&(ut.cameraClipping.far!==void 0&&ut.cameraClipping.far!==C.state.clipFar&&(he.clipFar=ut.cameraClipping.far),ut.cameraClipping.radius!==void 0)){var Ee=x.boundingSphere.radius/100*(100-ut.cameraClipping.radius);Ee>0&&Ee!==he.radius&&(he.radius=Math.max(Ee,.01))}if(Object.keys(he).length>0&&C.setState(he),!((tt=ut.camera)===null||tt===void 0)&&tt.helper&&D.camera.setProps(ut.camera.helper),((xt=ut.camera)===null||xt===void 0?void 0:xt.manualReset)!==void 0&&(u.camera.manualReset=ut.camera.manualReset),((pt=ut.camera)===null||pt===void 0?void 0:pt.stereo)!==void 0&&Object.assign(u.camera.stereo,ut.camera.stereo),ut.cameraResetDurationMs!==void 0&&(u.cameraResetDurationMs=ut.cameraResetDurationMs),ut.transparentBackground!==void 0&&(u.transparentBackground=ut.transparentBackground),ut.viewport!==void 0){var Ke=u.viewport===ut.viewport||u.viewport.name===ut.viewport.name&&W_(u.viewport.params,ut.viewport.params);Ke||(u.viewport=ut.viewport,dt(),ke())}ut.postprocessing&&Object.assign(u.postprocessing,ut.postprocessing),ut.multiSample&&Object.assign(u.multiSample,ut.multiSample),ut.renderer&&M.setProps(ut.renderer),ut.trackball&&A.setProps(ut.trackball),ut.debug&&D.debug.setProps(ut.debug),ut.handle&&D.handle.setProps(ut.handle),he.mode==="orthographic"&&(u.camera.stereo.name="off"),Ye||J(!0)},getImagePass:function(Me){return Me===void 0&&(Me={}),new ant(i,M,x,C,D,o.draw.wboitEnabled,Me)},getRenderObjects:function(){var Me=[];return x.forEach(function(Ye,tt){return Me.push(tt)}),Me},get props(){return Ne()},get input(){return a},get stats(){return M.stats},get interaction(){return R.events},dispose:function(){Qe.unsubscribe(),x.clear(),D.debug.clear(),A.dispose(),M.dispose(),R.dispose()}};function dt(){var Me=g,Ye=y,tt=b,xt=S;u.viewport.name==="canvas"?(g=0,y=0,b=p.drawingBufferWidth,S=p.drawingBufferHeight):u.viewport.name==="static-frame"?(g=u.viewport.params.x*i.pixelRatio,S=u.viewport.params.height*i.pixelRatio,y=p.drawingBufferHeight-S-u.viewport.params.y*i.pixelRatio,b=u.viewport.params.width*i.pixelRatio):u.viewport.name==="relative-frame"&&(g=Math.round(u.viewport.params.x*p.drawingBufferWidth),S=Math.round(u.viewport.params.height*p.drawingBufferHeight),y=Math.round(p.drawingBufferHeight-S-u.viewport.params.y*p.drawingBufferHeight),b=Math.round(u.viewport.params.width*p.drawingBufferWidth)),(Me!==g||Ye!==y||tt!==b||xt!==S)&&(fe=!0)}function ke(){k.setViewport(g,y,b,S),M.setViewport(g,y,b,S),Qi.set(C.viewport,g,y,b,S),Qi.set(A.viewport,g,y,b,S)}}e.create=t})(HR||(HR={}));function ynt(e){fie(e)}function fie(e){_t.Canvas3D.ResetSettings.subscribe(e,function(){var t;(t=e.canvas3d)===null||t===void 0||t.setProps(VF),e.events.canvas3d.settingsUpdated.next()}),_t.Canvas3D.SetSettings.subscribe(e,function(t){var r;e.canvas3d&&((r=e.canvas3d)===null||r===void 0||r.setProps(t.settings),e.events.canvas3d.settingsUpdated.next())})}const bnt=Object.freeze(Object.defineProperty({__proto__:null,Canvas3DSetSettings:fie,registerDefault:ynt},Symbol.toStringTag,{value:"Module"}));var yh=Uu,lv=mr.Trigger,xnt={hoverHighlightOnly:mr([lv(0)],"Highlight","Hover element using ${triggers}"),hoverHighlightOnlyExtend:mr([lv(0,yh.create({shift:!0}))],"Extend highlight","From selected to hovered element along polymer using ${triggers}")},Snt={bindings:I.Value(xnt,{isHidden:!0}),ignore:I.Value([],{isHidden:!0}),mark:I.Boolean(!0)},Cnt=Nr.create({name:"representation-highlight-loci",category:"interaction",ctor:function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.lociMarkProvider=function(n,i){!r.ctx.canvas3d||!r.params.mark||r.ctx.canvas3d.mark(n,i)},r}return t.prototype.register=function(){var r=this;this.subscribeObservable(this.ctx.behaviors.interaction.hover,function(n){var i,a=n.current,o=n.buttons,s=n.modifiers;if(!(!r.ctx.canvas3d||r.ctx.isBusy)){if(((i=r.params.ignore)===null||i===void 0?void 0:i.indexOf(a.loci.kind))>=0){r.ctx.managers.interactivity.lociHighlights.highlightOnly({repr:a.repr,loci:jr});return}var u=!1;mr.match(r.params.bindings.hoverHighlightOnly,o,s)&&(r.ctx.managers.interactivity.lociHighlights.highlightOnly({loci:a.loci}),u=!0),mr.match(r.params.bindings.hoverHighlightOnlyExtend,o,s)&&(r.ctx.managers.interactivity.lociHighlights.highlightOnlyExtend({loci:a.loci}),u=!0),u||r.ctx.managers.interactivity.lociHighlights.highlightOnly({repr:a.repr,loci:jr})}}),this.ctx.managers.interactivity.lociHighlights.addProvider(this.lociMarkProvider)},t.prototype.unregister=function(){this.ctx.managers.interactivity.lociHighlights.removeProvider(this.lociMarkProvider)},t}(Nr.Handler),params:function(){return Snt},display:{name:"Highlight Loci on Canvas"}}),_nt={clickSelect:mr.Empty,clickToggleExtend:mr([lv(1,yh.create({shift:!0}))],"Toggle extended selection","${triggers} to extend selection along polymer"),clickSelectOnly:mr.Empty,clickToggle:mr([lv(1,yh.create())],"Toggle selection","${triggers} on element"),clickDeselect:mr.Empty,clickDeselectAllOnEmpty:mr([lv(1,yh.create())],"Deselect all","Click on nothing using ${triggers}")},wnt={bindings:I.Value(_nt,{isHidden:!0}),ignore:I.Value([],{isHidden:!0}),mark:I.Boolean(!0)},hie=Nr.create({name:"representation-select-loci",category:"interaction",ctor:function(e){Le(t,e);function t(r,n){var i=e.call(this,r,n)||this;return i.lociMarkProvider=function(a,o){!i.ctx.canvas3d||!i.params.mark||i.ctx.canvas3d.mark({loci:a.loci},o)},i.spine=new Hb.Impl(r.state.data.cells),i}return t.prototype.applySelectMark=function(r,n){var i=this.ctx.state.data.cells.get(r);if(i&&ge.isRepresentation3D(i.obj)){this.spine.current=i;var a=this.spine.getRootOfType(ge.Molecule.Structure);if(a){n&&this.lociMarkProvider({loci:We.Loci(a.data)},nr.Deselect);var o=this.ctx.managers.structure.selection.getLoci(a.data);this.lociMarkProvider({loci:o},nr.Select)}}},t.prototype.register=function(){var r=this,n=function(o){return sr.isEmpty(o.loci)},i=function(o){return!sr.isEmpty(o.loci)},a=[["clickSelect",function(o){return r.ctx.managers.interactivity.lociSelects.select(o)},i],["clickToggle",function(o){return r.ctx.managers.interactivity.lociSelects.toggle(o)},i],["clickToggleExtend",function(o){return r.ctx.managers.interactivity.lociSelects.toggleExtend(o)},i],["clickSelectOnly",function(o){return r.ctx.managers.interactivity.lociSelects.selectOnly(o)},i],["clickDeselect",function(o){return r.ctx.managers.interactivity.lociSelects.deselect(o)},i],["clickDeselectAllOnEmpty",function(){return r.ctx.managers.interactivity.lociSelects.deselectAll()},n]];a.sort(function(o,s){var u=r.params.bindings[o[0]],l=r.params.bindings[s[0]],c=u.triggers.length===0?0:Ql(u.triggers.map(function(f){return yh.size(f.modifiers)})),d=l.triggers.length===0?0:Ql(l.triggers.map(function(f){return yh.size(f.modifiers)}));return d-c}),this.subscribeObservable(this.ctx.behaviors.interaction.click,function(o){var s,u=o.current,l=o.button,c=o.modifiers;if(!(!r.ctx.canvas3d||r.ctx.isBusy||!r.ctx.selectionMode)&&!(((s=r.params.ignore)===null||s===void 0?void 0:s.indexOf(u.loci.kind))>=0))for(var d=0,f=a;d<f.length;d++){var h=f[d],v=h[0],p=h[1],m=h[2];if(mr.match(r.params.bindings[v],l,c)&&(!m||m(u))){p(u);break}}}),this.ctx.managers.interactivity.lociSelects.addProvider(this.lociMarkProvider),this.subscribeObservable(this.ctx.state.events.object.created,function(o){var s=o.ref;return r.applySelectMark(s)}),this.subscribeObservable(this.ctx.state.events.object.updated,function(o){var s=o.ref,u=o.obj,l=o.oldObj,c=o.oldData,d=o.action,f=r.ctx.state.data.cells.get(s);if(f&&ge.Molecule.Structure.is(f.obj)){var h=u.data,v=d==="recreate"?l==null?void 0:l.data:d==="in-place"?c:void 0;if(v&&We.areEquivalent(h,v)&&We.areHierarchiesEqual(h,v))return;for(var p=r.ctx.state.data.select(or.Generators.ofType(ge.Molecule.Structure.Representation3D,s)),m=0,g=p;m<g.length;m++){var y=g[m];r.applySelectMark(y.transform.ref,!0)}}})},t.prototype.unregister=function(){this.ctx.managers.interactivity.lociSelects.removeProvider(this.lociMarkProvider)},t}(Nr.Handler),params:function(){return wnt},display:{name:"Select Loci on Canvas"}}),Ent=Nr.create({name:"default-loci-label-provider",category:"interaction",ctor:function(){function e(t){this.ctx=t,this.f={label:function(r){var n=[];if(Re.is(r)&&r.elements.length===1){var i=r.elements[0].unit,a=Ze.create(r.structure,i,i.elements[0]),o=lt.entity.pdbx_description(a).join(", ");n.push(o)}return n.push(Fh(r)),n.filter(function(s){return!!s}).join("</br>")},group:function(r){return r.toString().replace(/Model [0-9]+/g,"Models")},priority:100}}return e.prototype.register=function(){this.ctx.managers.lociLabels.addProvider(this.f)},e.prototype.unregister=function(){this.ctx.managers.lociLabels.removeProvider(this.f)},e}(),display:{name:"Provide Default Loci Label"}}),Ant={clickFocus:mr([lv(1,yh.create())],"Representation Focus","Click element using ${triggers}"),clickFocusAdd:mr([lv(1,yh.create({shift:!0}))],"Representation Focus Add","Click element using ${triggers}"),clickFocusSelectMode:mr([],"Representation Focus","Click element using ${triggers}"),clickFocusAddSelectMode:mr([],"Representation Focus Add","Click element using ${triggers}")},Pnt={bindings:I.Value(Ant,{isHidden:!0})},AA=Nr.create({name:"representation-focus-loci",category:"interaction",ctor:function(e){Le(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.register=function(){var r=this;this.subscribeObservable(this.ctx.behaviors.interaction.click,function(n){var i,a=n.current,o=n.button,s=n.modifiers,u=r.params.bindings,l=u.clickFocus,c=u.clickFocusAdd,d=u.clickFocusSelectMode,f=u.clickFocusAddSelectMode,h=r.ctx.managers.interactivity.props.granularity;if(!(h!=="residue"&&h!=="element")){var v=r.ctx.selectionMode?d:l,p=mr.match(v,o,s),m=r.ctx.selectionMode?f:c,g=mr.match(m,o,s);if(!(!p&&!g)){var y=sr.normalize(a.loci,"residue"),b=r.ctx.managers.structure.focus.current;if(b&&sr.areEqual(b.loci,y))r.ctx.managers.structure.focus.clear();else if(p)r.ctx.managers.structure.focus.setFromLoci(y);else{r.ctx.managers.structure.focus.addFromLoci(y);var S=(i=r.ctx.managers.structure.focus.current)===null||i===void 0?void 0:i.loci;S&&r.ctx.managers.camera.focusLoci(S)}}}})},t}(Nr.Handler),params:function(){return Pnt},display:{name:"Representation Focus Loci on Canvas"}});const Tnt=Object.freeze(Object.defineProperty({__proto__:null,DefaultLociLabelProvider:Ent,FocusLoci:AA,HighlightLoci:Cnt,SelectLoci:hie},Symbol.toStringTag,{value:"Module"}));var Fy=Uu,Ly=mr.Trigger,Int={clickCenterFocus:mr([Ly(1,Fy.create()),Ly(2,Fy.create()),Ly(1,Fy.create({control:!0}))],"Camera center and focus","Click element using ${triggers}"),clickCenterFocusSelectMode:mr([Ly(2,Fy.create()),Ly(1,Fy.create({control:!0}))],"Camera center and focus","Click element using ${triggers}")},Mnt={minRadius:I.Numeric(8,{min:1,max:50,step:1}),extraRadius:I.Numeric(4,{min:1,max:50,step:1},{description:"Value added to the bounding-sphere radius of the Loci"}),durationMs:I.Numeric(250,{min:0,max:1e3,step:1},{description:"Camera transition duration"}),bindings:I.Value(Int,{isHidden:!0})},Dnt=Nr.create({name:"camera-focus-loci",category:"interaction",ctor:function(e){Le(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.register=function(){var r=this;this.subscribeObservable(this.ctx.behaviors.interaction.click,function(n){var i=n.current,a=n.button,o=n.modifiers;if(r.ctx.canvas3d){var s=r.ctx.selectionMode?r.params.bindings.clickCenterFocusSelectMode:r.params.bindings.clickCenterFocus;if(mr.match(s,a,o)){if(sr.isEmpty(i.loci)){_t.Camera.Reset(r.ctx,{});return}var u=sr.normalize(i.loci,r.ctx.managers.interactivity.props.granularity);r.ctx.managers.camera.focusLoci(u,r.params)}}})},t}(Nr.Handler),params:function(){return Mnt},display:{name:"Camera Focus Loci on Canvas"}}),Rnt=Nr.create({name:"camera-axis-helper",category:"interaction",ctor:function(e){Le(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.register=function(){var r=this,n=0,i=0;this.subscribeObservable(this.ctx.behaviors.interaction.click,function(a){var o=a.current;if(!(!r.ctx.canvas3d||!zR(o.loci))){var s=o.loci.elements[0].groupId;if(s===0){n=0,i=0;return}var u=r.ctx.canvas3d.camera,l,c;if(s>=1&&s<=3){n=0,i=0;var d=_.sub(_(),u.target,u.position),f=_.cross(_(),d,u.up);c=_(),c[s-1]=1,l=_.cross(_(),c,f),_.magnitude(l)===0&&(l=d)}else n===s?i=(i+1)%2:(n=s,i=0),s===4?(c=i?_.unitX:_.unitY,l=_.negUnitZ):s===5?(c=i?_.unitX:_.unitZ,l=_.negUnitY):(c=i?_.unitY:_.unitZ,l=_.negUnitX);r.ctx.canvas3d.requestCameraReset({snapshot:function(h,v){return v.getInvariantFocus(h.boundingSphereVisible.center,h.boundingSphereVisible.radius,c,l)}})}})},t}(Nr.Handler),params:function(){return{}},display:{name:"Camera Axis Helper"}});const knt=Object.freeze(Object.defineProperty({__proto__:null,CameraAxisHelper:Rnt,FocusLoci:Dnt},Symbol.toStringTag,{value:"Module"}));var Ont=Nr.create({name:"structure-info-prop",category:"custom-props",display:{name:"Structure Info"},ctor:function(e){Le(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return Object.defineProperty(t.prototype,"maxModelIndex",{get:function(){for(var r,n,i=-1,a=this.ctx.state.data.select(or.Generators.rootsOfType(ge.Molecule.Model)),o=0,s=a;o<s.length;o++){var u=s[o],l=((r=u.obj)===null||r===void 0?void 0:r.data)&&Xt.Index.get((n=u.obj)===null||n===void 0?void 0:n.data).value;l!==void 0&&l>i&&(i=l)}return i},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"maxStructureIndex",{get:function(){for(var r,n,i=-1,a=this.ctx.state.data.select(or.Generators.rootsOfType(ge.Molecule.Structure)),o=0,s=a;o<s.length;o++){var u=s[o],l=((r=u.obj)===null||r===void 0?void 0:r.data)&&We.Index.get((n=u.obj)===null||n===void 0?void 0:n.data).value;l!==void 0&&l>i&&(i=l)}return i},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"asymIdOffset",{get:function(){for(var r,n=0,i=0,a=this.ctx.state.data.select(or.Generators.rootsOfType(ge.Molecule.Model)),o=0,s=a;o<s.length;o++){var u=s[o],l=(r=u.obj)===null||r===void 0?void 0:r.data;if(l){var c=Xt.AsymIdCount.get(l),d=Xt.AsymIdOffset.get(l).value;c!==void 0&&d!==void 0&&(n=Math.max(n,d.auth+c.auth),i=Math.max(i,d.label+c.label))}}return{auth:n,label:i}},enumerable:!1,configurable:!0}),t.prototype.handleModel=function(r,n){if(Xt.Index.get(r).value===void 0){var i=n&&Xt.Index.get(n).value,a=i??this.maxModelIndex+1;Xt.Index.set(r,{value:a})}if(Xt.AsymIdOffset.get(r).value===void 0){var o=n&&Xt.AsymIdOffset.get(n).value,a=o??E({},this.asymIdOffset);Xt.AsymIdOffset.set(r,{value:a})}},t.prototype.handleStructure=function(r,n){if(r.parent===void 0&&We.Index.get(r).value===void 0){var i=n&&We.Index.get(n).value,a=i??this.maxStructureIndex+1;We.Index.set(r,{value:a})}},t.prototype.handle=function(r,n,i){if(ge.Molecule.Structure.is(n)){var a=this.ctx.state.data.tree.transforms.get(r);!a.transformer.definition.isDecorator&&n.data.parent===void 0&&this.handleStructure(n.data,i==null?void 0:i.data)}else if(ge.Molecule.Model.is(n)){var a=this.ctx.state.data.tree.transforms.get(r);a.transformer.definition.isDecorator||this.handleModel(n.data,i==null?void 0:i.data)}},t.prototype.register=function(){var r=this;this.ctx.customModelProperties.register(Xt.AsymIdOffset,!0),this.ctx.customModelProperties.register(Xt.Index,!0),this.ctx.customStructureProperties.register(We.Index,!0),this.subscribeObservable(this.ctx.state.data.events.object.created,function(n){r.handle(n.ref,n.obj)}),this.subscribeObservable(this.ctx.state.data.events.object.updated,function(n){r.handle(n.ref,n.obj,n.oldObj)})},t.prototype.unregister=function(){this.ctx.customModelProperties.unregister(Xt.AsymIdOffset.descriptor.name),this.ctx.customModelProperties.unregister(Xt.Index.descriptor.name),this.ctx.customStructureProperties.unregister(We.Index.descriptor.name)},t}(Nr.Handler)}),eh=[-1,1.76,1.87,1.65,1.5,1.4,1.85,1.8,1.6,1.4],pie={ALA:121,ARG:265,ASN:187,ASP:187,CYS:148,GLU:214,GLN:214,GLY:97,HIS:216,ILE:195,LEU:191,LYS:230,MET:203,PHE:228,PRO:154,SER:143,THR:163,TRP:264,TYR:255,VAL:165},Fnt=121;function Lnt(e){var t=lt.residue.key,r=lt.atom,n=r.type_symbol,i=r.label_atom_id,a=r.label_comp_id,o=e.structure,s=e.atomRadiusType,u=e.serialResidueIndex,l=Ze.create(o),c=0,d=0,f=-1;l.structure=o;for(var h=0,v=0,p=o.units.length;h<p;++h){var m=o.units[h],g=m.elements;l.unit=m,c=-1;for(var y=0,b=g.length;y<b;++y){var S=g[y],x=v+y;l.element=S,d=t(l),c!==d&&++f,c=d;var C=n(l),w=p0(C);if(Qb(w)){s[x]=0,u[x]=-1;continue}var A=i(l),M=J6(m,S);if(M===2||!e.nonPolymer&&!Z6(M)){s[x]=0,u[x]=-1;continue}var D=a(l);if(e.traceOnly&&(A!=="CA"&&A!=="BB"||!pie[D])){s[x]=0,u[x]=f;continue}ic(M)?s[x]=Bnt(A,C):M===5?s[x]=Nnt(A,C,D):s[x]=HF(C),u[x]=f}v+=g.length}}function Nnt(e,t,r){switch(t){case"O":return 5;case"S":return 6;case"N":return e==="NZ"?4:3;case"C":switch(e){case"C":case"CE1":case"CE2":case"CE3":case"CH2":case"CZ":case"CZ2":case"CZ3":return 1;case"CA":case"CB":case"CE":case"CG1":case"CG2":return 2;default:switch(r){case"PHE":case"TRP":case"TYR":case"HIS":case"ASP":case"ASN":return 1;case"PRO":case"LYS":case"ARG":case"MET":case"ILE":case"LEU":return 2;case"GLU":case"GLN":return e==="CD"?1:2}}}return HF(t)}function Bnt(e,t,r){switch(t){case"C":return 7;case"N":return 8;case"P":return 9;case"O":return 5}return HF(t)}function HF(e){var t=A2(e),r=eh.indexOf(t);return r===-1&&(r=eh.length,eh[r]=t),r}var FH=5e3;function Unt(e,t){return ce(this,void 0,void 0,function(){var r,n;return de(this,function(i){switch(i.label){case 0:r=t.atomRadiusType,n=0,i.label=1;case 1:return n<r.length?e.shouldUpdate?[4,e.update({message:"Computing per residue surface accessibility...",current:n,max:r.length})]:[3,3]:[3,5];case 2:i.sent(),i.label=3;case 3:jnt(t,n,Math.min(n+FH,r.length)),i.label=4;case 4:return n+=FH,[3,1];case 5:return[2]}})})}function jnt(e,t,r){for(var n=e.structure,i=e.atomRadiusType,a=e.serialResidueIndex,o=e.area,s=e.spherePoints,u=e.scalingConstant,l=e.maxLookupRadius,c=e.probeSize,d=n.lookup3d,f=n.serialMapping,h=n.unitIndexMap,v=n.units,p=f.cumulativeUnitElementCount,m=f.elementIndices,g=f.unitIndices,y=t;y<r;++y){var b=eh[i[y]];if(b!==eh[0]){for(var S=v[g[y]],x=m[y],C=S.conformation.x(x),w=S.conformation.y(x),A=S.conformation.z(x),M=d.find(C,w,A,l),D=M.count,k=M.units,R=M.indices,O=M.squaredDistances,H=c+b,B=c+H,j=[],Y=0;Y<D;++Y){var G=k[Y],$=p[h.get(G.id)]+R[Y],q=m[$],ee=eh[i[$]];if(!(S===G&&x===q||ee===eh[0])){var fe=c+ee;if(O[Y]<(B+ee)*(B+ee)){var W=m[$];j[j.length]=[O[Y],(O[Y]+H*H-fe*fe)/(2*H),G.conformation.x(W)-C,G.conformation.y(W)-w,G.conformation.z(W)-A]}}}j.sort(function(oe,F){return oe[0]-F[0]});var X=0;e:for(var U=0;U<s.length;++U){for(var z=s[U],J=z[0],K=z[1],Z=z[2],te=0;te<j.length;++te){var le=j[te],ye=le[1],be=le[2],Ae=le[3],Se=le[4],ie=J*be+K*Ae+Z*Se;if(ie>ye)continue e}++X}o[a[y]]+=u*X*H*H}}}var vie={numberOfSpherePoints:I.Numeric(92,{min:12,max:360,step:1},{description:"Number of sphere points to sample per atom: 92 (original paper), 960 (BioJava), 3000 (EPPIC) - see Shrake A, Rupley JA: Environment and exposure to solvent of protein atoms. Lysozyme and insulin. J Mol Biol 1973."}),probeSize:I.Numeric(1.4,{min:.1,max:4,step:.01},{description:"Corresponds to the size of a water molecule: 1.4 (original paper), 1.5 (occassionally used)"}),nonPolymer:I.Boolean(!1,{description:"Include non-polymer atoms as occluders."}),traceOnly:I.Boolean(!1,{description:"Compute only using alpha-carbons, if true increase probeSize accordingly (e.g., 4 A). Considers only canonical amino acids."})},C0;(function(e){function t(l,c){var d=this;c===void 0&&(c={});var f=E(E({},I.getDefaultValues(vie)),c);return $e.create("Compute Accessible Surface Area",function(h){return ce(d,void 0,void 0,function(){return de(this,function(v){switch(v.label){case 0:return[4,r(h,l,f)];case 1:return[2,v.sent()]}})})})}e.compute=t;function r(l,c,d){return ce(this,void 0,void 0,function(){var f,h,v;return de(this,function(p){switch(p.label){case 0:return f=n(c,d),Lnt(f),[4,Unt(l,f)];case 1:return p.sent(),h=f.area,v=f.serialResidueIndex,[2,{area:h,serialResidueIndex:v}]}})})}function n(l,c){var d=l.elementCount,f=l.atomicResidueCount,h=c.probeSize,v=c.nonPolymer,p=c.traceOnly,m=c.numberOfSpherePoints;return{structure:l,probeSize:h,nonPolymer:v,traceOnly:p,spherePoints:i(m),scalingConstant:4*Math.PI/m,maxLookupRadius:2*c.probeSize+2*eh[2],atomRadiusType:new Int8Array(d),serialResidueIndex:new Int32Array(d),area:new Float32Array(f)}}function i(l){for(var c=[],d=Math.PI*(3-Math.sqrt(5)),f=2/l,h=0;h<l;++h){var v=h*f-1+f/2,p=Math.sqrt(1-v*v),m=h*d;c[c.length]=_.create(Math.cos(m)*p,v,Math.sin(m)*p)}return c}function a(l,c){var d=pie[l]||Fnt;return c/d}e.normalize=a;function o(l,c){var d=c.area,f=c.serialResidueIndex,h=f[Je.indexOf(Je.ofSortedArray(l.structure.root.serialMapping.elementIndices),l.element)];return h===-1?-1:d[h]}e.getValue=o;function s(l,c){var d=o(l,c);return d===-1?-1:a(lt.atom.label_comp_id(l),d)}e.getNormalizedValue=s;function u(l,c){var d=s(l,c);return d===-1?0:d<.16?1:2}e.getFlag=u})(C0||(C0={}));var YT=E({},vie),GF={isBuried:g0.Dynamic(aj("computed","accessible-surface-area.is-buried",De.Bool),function(e){if(!je.isAtomic(e.element.unit))return!1;var t=Hs.get(e.element.structure).value;return t?C0.getFlag(e.element,t)===1:!1}),isAccessible:g0.Dynamic(aj("computed","accessible-surface-area.is-accessible",De.Bool),function(e){if(!je.isAtomic(e.element.unit))return!1;var t=Hs.get(e.element.structure).value;return t?C0.getFlag(e.element,t)===2:!1})},Hs=Dh.createProvider({label:"Accessible Surface Area",descriptor:ko({name:"molstar_accessible_surface_area",symbols:GF}),type:"root",defaultParams:YT,getParams:function(e){return YT},isApplicable:function(e){return!0},obtain:function(e,t,r){return ce(void 0,void 0,void 0,function(){var n,i;return de(this,function(a){switch(a.label){case 0:return n=E(E({},I.getDefaultValues(YT)),r),i={},[4,C0.compute(t,n).runInContext(e.runtime)];case 1:return[2,(i.value=a.sent(),i)]}})})}}),KT=at(16448250),znt="Assigns a color based on the relative accessible surface area of a residue.",mie={list:I.ColorList("rainbow",{presetKind:"scale"})};function Vnt(e){return mie}function gie(e,t){var r,n=Gu.create({listOrName:t.list.colors,minLabel:"buried",maxLabel:"exposed",domain:[0,1]}),i=e.structure&&Hs.get(e.structure),a=i?Kv(i.id,i.version):-1;if(i!=null&&i.value&&e.structure){var o=Ze.create(e.structure),s=i.value,u=function(l){var c=C0.getNormalizedValue(l,s);return c===-1?KT:n.color(c)};r=function(l){return Ze.is(l)&&je.isAtomic(l.unit)?u(l):Ht.isLocation(l)?(o.unit=l.aUnit,o.element=l.aUnit.elements[l.aIndex],u(o)):KT}}else r=function(){return KT};return{factory:gie,granularity:"group",preferSmoothing:!0,color:r,props:t,contextHash:a,description:znt,legend:n?n.legend:void 0}}var LH={name:"accessible-surface-area",label:"Accessible Surface Area",category:"Residue Property",factory:gie,getParams:Vnt,defaultValues:I.getDefaultValues(mie),isApplicable:function(e){return!!e.structure},ensureCustomProperties:{attach:function(e,t){return t.structure?Hs.attach(e,t.structure,void 0,!0):Promise.resolve()},detach:function(e){return e.structure&&Hs.ref(e.structure,!1)}}},Hnt=Nr.create({name:"computed-accessible-surface-area-prop",category:"custom-props",display:{name:"Accessible Surface Area"},ctor:function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.provider=Hs,r.labelProvider={label:function(n){if(r.params.showTooltip)return Gnt(n)}},r}return t.prototype.update=function(r){var n=this.params.autoAttach!==r.autoAttach||this.params.showTooltip!==r.showTooltip;return this.params.autoAttach=r.autoAttach,this.params.showTooltip=r.showTooltip,this.ctx.customStructureProperties.setDefaultAutoAttach(this.provider.descriptor.name,this.params.autoAttach),n},t.prototype.register=function(){Cw.addCustomProp(this.provider.descriptor),this.ctx.customStructureProperties.register(this.provider,this.params.autoAttach),this.ctx.representation.structure.themes.colorThemeRegistry.add(LH),this.ctx.managers.lociLabels.addProvider(this.labelProvider),this.ctx.query.structure.registry.add(NH),this.ctx.query.structure.registry.add(BH)},t.prototype.unregister=function(){Cw.removeCustomProp(this.provider.descriptor),this.ctx.customStructureProperties.unregister(this.provider.descriptor.name),this.ctx.representation.structure.themes.colorThemeRegistry.remove(LH),this.ctx.managers.lociLabels.removeProvider(this.labelProvider),this.ctx.query.structure.registry.remove(NH),this.ctx.query.structure.registry.remove(BH)},t}(Nr.Handler),params:function(){return{autoAttach:I.Boolean(!1),showTooltip:I.Boolean(!0)}}});function Gnt(e){if(e.kind==="element-loci"){if(e.elements.length===0)return;var t=Hs.get(e.structure).value;if(!t||e.structure.customPropertyDescriptors.hasReference(Hs.descriptor))return;for(var r=e.structure.root.serialMapping.getSerialIndex,n=t.area,i=t.serialResidueIndex,a=new Set,o=0,s=function(v,p){var m=p.elements;Fe.forEach(v,function(g){var y=i[r(p,m[g])];y!==-1&&!a.has(y)&&(o+=n[y],a.add(y))})},u=0,l=e.elements;u<l.length;u++){var c=l[u],d=c.indices,f=c.unit;s(d,f)}if(a.size===0)return;var h="<small>("+a.size+" "+(a.size>1?"Residues sum":"Residue")+")</small>";return"Accessible Surface Area "+h+": "+o.toFixed(2)+" <sup>2</sup>"}else if(e.kind==="structure-loci"){var t=Hs.get(e.structure).value;return!t||e.structure.customPropertyDescriptors.hasReference(Hs.descriptor)?void 0:"Accessible Surface Area <small>(Whole Structure)</small>: "+z1(t.area).toFixed(2)+" <sup>2</sup>"}}var NH=$r("Buried Protein Residues",se.struct.modifier.union([se.struct.modifier.wholeResidues([se.struct.modifier.union([se.struct.generator.atomGroups({"chain-test":se.core.rel.eq([se.ammp("objectPrimitive"),"atomistic"]),"residue-test":GF.isBuried.symbol()})])])]),{description:"Select buried protein residues.",category:qr.Residue,ensureCustomProperties:function(e,t){return Hs.attach(e,t)}}),BH=$r("Accessible Protein Residues",se.struct.modifier.union([se.struct.modifier.wholeResidues([se.struct.modifier.union([se.struct.generator.atomGroups({"chain-test":se.core.rel.eq([se.ammp("objectPrimitive"),"atomistic"]),"residue-test":GF.isAccessible.symbol()})])])]),{description:"Select accessible protein residues.",category:qr.Residue,ensureCustomProperties:function(e,t){return Hs.attach(e,t)}}),qnt=Nr.create({name:"computed-interactions-prop",category:"custom-props",display:{name:"Interactions"},ctor:function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.provider=Kn,r.labelProvider={label:function(n){if(r.params.showTooltip)switch(n.kind){case"element-loci":if(n.elements.length===0)return;for(var i=[],a=r.getStructures(n.structure),o=0,s=a;o<s.length;o++){var u=s[o],l=r.provider.get(u).value;if(l){var c=Re.remap(n,u);if(c.elements.length===1){var d=c.elements[0];if(Fe.size(d.indices)===1){var f=l.unitsFeatures.get(d.unit.id);if(f){for(var h=[],v=[],p=[],m=Fe.start(d.indices),g=f.types,y=f.groups,b=f.elementsIndex,S=b.indices,x=b.offsets,C=x[m],w=x[m+1];C<w;++C){var A=S[C],M=g[A],D=y[A];M&&h.push(tJe(M)),D&&v.push(rJe(D))}h.length&&p.push("<small>Types</small> "+h.join(", ")),v.length&&p.push("<small>Groups</small> "+v.join(", ")),p.length&&i.push("Interaction Feature: "+p.join(" | "))}}}}}return i.length?i.join("<br/>"):void 0;default:return}}},r}return t.prototype.getStructures=function(r){var n=[],i=this.ctx.helpers.substructureParent.get(r);if(i)for(var a=this.ctx.state.data,o=a.select(or.Generators.ofType(ge.Molecule.Structure,i.transform.ref)),s=0,u=o;s<u.length;s++){var l=u[s];l.obj&&ja(n,l.obj.data)}return n},t.prototype.update=function(r){var n=this.params.autoAttach!==r.autoAttach||this.params.showTooltip!==r.showTooltip;return this.params.autoAttach=r.autoAttach,this.params.showTooltip=r.showTooltip,this.ctx.customStructureProperties.setDefaultAutoAttach(this.provider.descriptor.name,this.params.autoAttach),n},t.prototype.register=function(){this.ctx.customStructureProperties.register(this.provider,this.params.autoAttach),this.ctx.representation.structure.themes.colorThemeRegistry.add(DR),this.ctx.managers.lociLabels.addProvider(this.labelProvider),this.ctx.representation.structure.registry.add($w)},t.prototype.unregister=function(){this.ctx.customStructureProperties.unregister(this.provider.descriptor.name),this.ctx.representation.structure.themes.colorThemeRegistry.remove(DR),this.ctx.managers.lociLabels.removeProvider(this.labelProvider),this.ctx.representation.structure.registry.remove($w)},t}(Nr.Handler),params:function(){return{autoAttach:I.Boolean(!1),showTooltip:I.Boolean(!0)}}}),$nt=Nr.create({name:"computed-secondary-structure-prop",category:"custom-props",display:{name:"Secondary Structure"},ctor:function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.provider=tc,r}return t.prototype.update=function(r){var n=this.params.autoAttach!==r.autoAttach;return this.params.autoAttach=r.autoAttach,this.ctx.customStructureProperties.setDefaultAutoAttach(this.provider.descriptor.name,this.params.autoAttach),n},t.prototype.register=function(){this.ctx.customStructureProperties.register(this.provider,this.params.autoAttach)},t.prototype.unregister=function(){this.ctx.customStructureProperties.unregister(this.provider.descriptor.name)},t}(Nr.Handler),params:function(){return{autoAttach:I.Boolean(!1)}}}),Wnt=Nr.create({name:"computed-valence-model-prop",category:"custom-props",display:{name:"Valence Model"},ctor:function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.provider=L2,r.labelProvider={label:function(n){if(r.params.showTooltip)switch(n.kind){case"element-loci":if(n.elements.length===0)return;for(var i=[],a=r.getStructures(n.structure),o=0,s=a;o<s.length;o++){var u=s[o],l=r.provider.get(u).value;if(l){var c=Re.remap(n,u);if(c.elements.length===1){var d=c.elements[0];if(Fe.size(d.indices)===1){var f=l.get(d.unit.id);if(f){var h=Fe.start(d.indices),v=f.charge[h],p=f.idealGeometry[h],m=f.implicitH[h],g=f.totalH[h];i.push("Valence Model: <small>Charge</small> "+v+" | <small>Ideal Geometry</small> "+XZe(p)+" | <small>Implicit H</small> "+m+" | <small>Total H</small> "+g)}}}}}return i.length?i.join("<br/>"):void 0;default:return}}},r}return t.prototype.getStructures=function(r){var n=[],i=this.ctx.helpers.substructureParent.get(r);if(i)for(var a=this.ctx.state.data,o=a.select(or.Generators.ofType(ge.Molecule.Structure,i.transform.ref)),s=0,u=o;s<u.length;s++){var l=u[s];l.obj&&ja(n,l.obj.data)}return n},t.prototype.update=function(r){var n=this.params.autoAttach!==r.autoAttach||this.params.showTooltip!==r.showTooltip;return this.params.autoAttach=r.autoAttach,this.params.showTooltip=r.showTooltip,this.ctx.customStructureProperties.setDefaultAutoAttach(this.provider.descriptor.name,this.params.autoAttach),n},t.prototype.register=function(){this.ctx.customStructureProperties.register(this.provider,this.params.autoAttach),this.ctx.managers.lociLabels.addProvider(this.labelProvider)},t.prototype.unregister=function(){this.ctx.customStructureProperties.unregister(this.provider.descriptor.name),this.ctx.managers.lociLabels.removeProvider(this.labelProvider)},t}(Nr.Handler),params:function(){return{autoAttach:I.Boolean(!1),showTooltip:I.Boolean(!0)}}}),ju;(function(e){var t=this;e.Provider=Fv.createProvider({label:"Best Database Sequence Mapping",descriptor:ko({name:"molstar_best_database_sequence_mapping"}),type:"static",defaultParams:{},getParams:function(){return{}},isApplicable:function(a){var o,s;return un.is(a.sourceData)&&((s=(o=a.sourceData.data.frame.categories)===null||o===void 0?void 0:o.atom_site)===null||s===void 0?void 0:s.fieldNames.indexOf("db_name"))>=0},obtain:function(a,o){return ce(t,void 0,void 0,function(){return de(this,function(s){return[2,{value:i(o)}]})})}});function r(a){var o=a.unit.model,s=e.Provider.get(o).value;if(!s)return"";var u=a.unit.elements[a.element],l=o.atomicHierarchy.residueAtomSegments.offsets[u];return s.accession[l]}e.getKey=r;function n(a){var o=a.unit.model,s=e.Provider.get(o).value;if(s){var u=a.unit.elements[a.element],l=o.atomicHierarchy.residueAtomSegments.offsets[u],c=s.dbName[l];if(c)return c+" "+s.accession[l]+" "+s.num[l]+" "+s.residue[l]}}e.getLabel=n;function i(a){if(un.is(a.sourceData)){var o=a.sourceData.data.frame.categories.atom_site,s=o.getField("db_name"),u=o.getField("db_acc"),l=o.getField("db_num"),c=o.getField("db_res");if(!(!s||!u||!l||!c)){for(var d=a.atomicHierarchy.atomSourceIndex,f=a.atomicHierarchy.residueAtomSegments,h=f.count,v=f.offsets,p=new Array(h),m=new Array(h),g=new Array(h),y=new Array(h),b=0;b<h;b++){var S=d.value(v[b]);if(s.valueKind(S)!==0){p[S]="",m[S]="",g[S]=0,y[S]="";continue}p[S]=s.str(S),m[S]=u.str(S),g[S]=l.int(S),y[S]=c.str(S)}return{dbName:p,accession:m,num:g,residue:y}}}}})(ju||(ju={}));var QT=at(16448250),Xnt="Assigns a color based on best dababase sequence mapping.",Ny=new Map,yie=E({},Ss({type:"colors",colorList:"set-1"}));function Ynt(e){return yie}function bie(e,t){var r;if(e.structure){for(var n=0,i=e.structure.models;n<i.length;n++){var a=i[n],o=ju.Provider.get(a).value;if(o)for(var s=0,u=o.accession;s<u.length;s++){var l=u[s];!l||Ny.has(l)||Ny.set(l,Ny.size)}}var c=Ze.create(e.structure),d=ou(Ny.size+1,t,{valueLabel:function(v){return""+v}}),f=new Map,h=function(v){var p=ju.getKey(v);if(!p)return QT;if(f.has(p))return f.get(p);var m=d.color(Ny.get(p));return f.set(p,m),m};r=function(v){return Ze.is(v)&&je.isAtomic(v.unit)?h(v):Ht.isLocation(v)?(c.unit=v.aUnit,c.element=v.aUnit.elements[v.aIndex],h(c)):QT}}else r=function(){return QT};return{factory:bie,granularity:"group",preferSmoothing:!0,color:r,props:t,description:Xnt}}var UH={name:"best-sequence-database-mapping",label:"Best Database Sequence Mapping",category:"Residue Property",factory:bie,getParams:Ynt,defaultValues:I.getDefaultValues(yie),isApplicable:function(e){var t;return!!(!((t=e.structure)===null||t===void 0)&&t.models.some(function(r){return ju.Provider.isApplicable(r)}))},ensureCustomProperties:{attach:function(e,t){return ce(void 0,void 0,void 0,function(){var r,n,i;return de(this,function(a){switch(a.label){case 0:if(!t.structure)return[2];r=0,n=t.structure.models,a.label=1;case 1:return r<n.length?(i=n[r],[4,ju.Provider.attach(e,i,void 0,!0)]):[3,4];case 2:a.sent(),a.label=3;case 3:return r++,[3,1];case 4:return[2]}})})},detach:function(e){if(e.structure)for(var t=0,r=e.structure.models;t<r.length;t++){var n=r[t];ju.Provider.ref(n,!1)}}}},Knt=Nr.create({name:"best-sequence-database-mapping-prop",category:"custom-props",display:{name:"Best Database Sequence Mapping"},ctor:function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.provider=ju.Provider,r.labelProvider={label:function(n){if(r.params.showTooltip)return Qnt(n)}},r}return t.prototype.update=function(r){var n=this.params.autoAttach!==r.autoAttach||this.params.showTooltip!==r.showTooltip;return this.params.autoAttach=r.autoAttach,this.params.showTooltip=r.showTooltip,this.ctx.customStructureProperties.setDefaultAutoAttach(this.provider.descriptor.name,this.params.autoAttach),n},t.prototype.register=function(){this.ctx.customModelProperties.register(this.provider,this.params.autoAttach),this.ctx.representation.structure.themes.colorThemeRegistry.add(UH),this.ctx.managers.lociLabels.addProvider(this.labelProvider)},t.prototype.unregister=function(){this.ctx.customModelProperties.unregister(this.provider.descriptor.name),this.ctx.representation.structure.themes.colorThemeRegistry.remove(UH),this.ctx.managers.lociLabels.removeProvider(this.labelProvider)},t}(Nr.Handler),params:function(){return{autoAttach:I.Boolean(!0),showTooltip:I.Boolean(!0)}}});function Qnt(e){if(e.kind==="element-loci"){if(e.elements.length===0)return;var t=e.elements[0],r=t.unit,n=Ze.create(e.structure,r,r.elements[Fe.getAt(t.indices,0)]);return ju.getLabel(n)}}var Cd;(function(e){e.Descriptor={name:"ihm_cross_link_restraint"},e.Provider=Wu.create(e.Descriptor);function t(r,n){var i={entity_id:r.entity_id_1,asym_id:r.asym_id_1,seq_id:r.seq_id_1,atom_id:r.atom_id_1},a={entity_id:r.entity_id_2,asym_id:r.asym_id_2,seq_id:r.seq_id_2,atom_id:r.atom_id_2};function o(v,p,m){var g=v.get(p);g?g.push(m):v.set(p,[m])}function s(v,p){var m=p.entity_id.value(v),g=p.asym_id.value(v),y=p.seq_id.value(v);if(r.model_granularity.value(v)==="by-atom"){var b=n.atomicHierarchy.index.findAtom({auth_seq_id:y,label_asym_id:g,label_atom_id:p.atom_id.value(v),label_entity_id:m});b>=0&&o(l,b,v)}else if(n.coarseHierarchy.isDefined){var S=n.coarseHierarchy.spheres.findSequenceKey(m,g,y);if(S>=0)o(c,S,v);else{var x=n.coarseHierarchy.gaussians.findSequenceKey(m,g,y);x>=0&&o(d,x,v)}}}function u(v){switch(v){case 0:return l;case 1:return c;case 2:return d}}for(var l=new Map,c=new Map,d=new Map,f=[],h=0;h<r._rowCount;++h)s(h,i),s(h,a);return{getIndicesByElement:function(v,p){var m=u(p),g=m.get(v);return g!==void 0?g:f},data:r}}e.fromTable=t})(Cd||(Cd={}));var Znt=[];function jH(e,t,r,n){return e+"|"+t.id+"|"+r+"|"+n.id}var zH=function(){function e(t){this.pairs=t;var r=new Map;this.pairs.forEach(function(n,i){var a=jH(n.indexA,n.unitA,n.indexB,n.unitB),o=r.get(a);o?o.push(i):r.set(a,[i])}),this.count=t.length,this.pairKeyIndices=r}return e.prototype.getPairIndices=function(t,r,n,i){var a=jH(t,r,n,i);return this.pairKeyIndices.get(a)||Znt},e.prototype.getPairs=function(t,r,n,i){var a=this,o=this.getPairIndices(t,r,n,i);return o.map(function(s){return a.pairs[s]})},e}(),_d=Dh.createProvider({label:"Cross Link Restraint",descriptor:ko({name:"integrative-cross-link-restraint"}),type:"local",defaultParams:{},getParams:function(e){return{}},isApplicable:function(e){return e.models.some(function(t){return!!Cd.Provider.get(t)})},obtain:function(e,t,r){return ce(void 0,void 0,void 0,function(){return de(this,function(n){return[2,{value:tit(t)}]})})}}),zu;(function(e){(function(v){v.CrossLinkRestraint="cross-link-restraint"})(e.Tag||(e.Tag={}));function t(v){return v.models.some(function(p){return!!Cd.Provider.get(p)})}e.isApplicable=t;var r=_(),n=_();function i(v){return v.unitA.conformation.position(v.unitA.elements[v.indexA],r),v.unitB.conformation.position(v.unitB.elements[v.indexB],n),_.distance(r,n)}e.distance=i;function a(v,p,m){return gJ("cross-link-restraints",{structure:p,crossLinkRestraints:v},m)}e.Location=a;function o(v){return!!v&&v.kind==="data-location"&&v.tag==="cross-link-restraints"}e.isLocation=o;function s(v,p){return v.data.structure===p.data.structure&&v.data.crossLinkRestraints===p.data.crossLinkRestraints&&v.element===p.element}e.areLocationsEqual=s;function u(v,p){var m=v.pairs[p];return"Cross Link Restraint | Type: "+m.restraintType+" | Threshold: "+m.distanceThreshold+"  | Psi: "+m.psi+" | Sigma 1: "+m.sigma1+" | Sigma 2: "+m.sigma2+" | Distance: "+i(m).toFixed(2)+" "}function l(v){return u(v.data.crossLinkRestraints,v.element)}e.locationLabel=l;function c(v,p,m){return lA("cross-link-restraints",{structure:v,crossLinkRestraints:p},m,function(g){return f(p,m,g)},function(){return h(v,p,m)})}e.Loci=c;function d(v){return!!v&&v.kind==="data-loci"&&v.tag==="interactions"}e.isLoci=d;function f(v,p,m){return md.fromPairProvider(p.length,function(g,y,b){var S=v.pairs[p[g]];S.unitA.conformation.position(S.unitA.elements[S.indexA],y),S.unitB.conformation.position(S.unitB.elements[S.indexB],b)},m)}e.getBoundingSphere=f;function h(v,p,m){var g=m[0];if(g===void 0)return"";var y=p.pairs[g];return[u(p,g),EF(Ht.Location(v,y.unitA,y.indexA,v,y.unitB,y.indexB))].join("</br>")}e.getLabel=h})(zu||(zu={}));function VH(e,t,r){for(var n=t.elements,i=n.length,a=t.kind,o=function(u){var l=n[u];r.getIndicesByElement(l,a).forEach(function(c){return e.set(c,u)})},s=0;s<i;s++)o(s)}function Jnt(e,t,r){if(t.model===r.model&&t.model.sourceData.kind==="mmCIF"){var n=Cd.Provider.get(t.model);if(n){var i=new Map,a=new Map;VH(i,t,n),VH(a,r,n),i.forEach(function(o,s){var u=a.get(s);u!==void 0&&e.push(Kw(t,o,r,u,n,s),Kw(r,u,t,o,n,s))})}}}function eit(e,t){if(t.model.sourceData.kind==="mmCIF"){var r=Cd.Provider.get(t.model);if(r){for(var n=t.elements,i=n.length,a=t.kind,o=new Map,s=function(l){var c=n[l];r.getIndicesByElement(c,a).forEach(function(d){var f=o.get(d);f?f.push(l):o.set(d,[l])})},u=0;u<i;u++)s(u);o.forEach(function(l,c){if(!(l.length<2)){var d=l[0],f=l[1];e.push(Kw(t,d,t,f,r,c),Kw(t,f,t,d,r,c))}})}}}function Kw(e,t,r,n,i,a){return{unitA:e,indexA:t,unitB:r,indexB:n,restraintType:i.data.restraint_type.value(a),distanceThreshold:i.data.distance_threshold.value(a),psi:i.data.psi.value(a),sigma1:i.data.sigma_1.value(a),sigma2:i.data.sigma_2.value(a)}}function tit(e){var t=[];if(!e.models.some(function(s){return Cd.Provider.get(s)}))return new zH(t);for(var r=e.units.length,n=0;n<r;++n){var i=e.units[n];eit(t,i);for(var a=n+1;a<r;++a){var o=e.units[a];i.model===o.model&&Jnt(t,i,o)}}return new zH(t)}function rit(e,t,r,n,i){var a=_d.get(t).value;if(!a.count)return Lt.createEmpty(i);var o=n.sizeFactor,s=Ze.create(t),u={linkCount:a.count,position:function(l,c,d){var f=a.pairs[d],h=f.unitA,v=f.unitB;h.conformation.position(h.elements[f.indexA],l),v.conformation.position(v.elements[f.indexB],c)},radius:function(l){var c=a.pairs[l];return s.unit=c.unitA,s.element=c.unitA.elements[c.indexA],r.size.size(s)*o}};return lm(e,u,n,i)}var xie=E(E(E({},F2),um),{sizeFactor:I.Numeric(.5,{min:0,max:10,step:.1})});function nit(e){return om({defaultProps:I.getDefaultValues(xie),createGeometry:rit,createLocationIterator:iit,getLoci:ait,eachLocation:oit,setUpdateState:function(t,r,n){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.radialSegments!==n.radialSegments||r.linkCap!==n.linkCap}},e)}function iit(e){var t=_d.get(e).value,r=t.pairs,n=r.length,i=1,a=zu.Location(t,e),o=function(s){return a.element=s,a};return wn(n,i,1,o,!0)}function ait(e,t,r){var n=e.objectId,i=e.groupId;if(r===n){var a=_d.get(t).value,o=a.pairs[i];if(o)return zu.Loci(t,a,[i])}return jr}function oit(e,t,r){var n=!1;if(zu.isLoci(e)){if(!We.areEquivalent(e.data.structure,t))return!1;var i=_d.get(t).value;if(e.data.crossLinkRestraints!==i)return!1;for(var a=0,o=e.elements;a<o.length;a++){var s=o[a];r(Ie.ofSingleton(s))&&(n=!0)}}return n}var sit={"cross-link-restraint":function(e,t){return Bu("Cross-link restraint",e,t,nit)}},Sie=E({},xie);function uit(e,t){return I.clone(Sie)}function lit(e,t){return ur.createMulti("CrossLinkRestraint",e,t,Hi,sit)}var HH={name:zu.Tag.CrossLinkRestraint,label:"Cross Link Restraint",description:"Displays cross-link restraints.",factory:lit,getParams:uit,defaultValues:I.getDefaultValues(Sie),defaultColorTheme:{name:zu.Tag.CrossLinkRestraint},defaultSizeTheme:{name:"uniform"},isApplicable:function(e){return zu.isApplicable(e)},ensureCustomProperties:{attach:function(e,t){return _d.attach(e,t,void 0,!0)},detach:function(e){return _d.ref(e,!1)}}},GH=at(13421772),cit="Colors cross-links by the deviation of the observed distance versus the modeled distance (e.g. modeled / `ihm_cross_link_restraint.distance_threshold`).",Cie={domain:I.Interval([.5,1.5],{step:.01}),list:I.ColorList("red-grey",{presetKind:"scale"})};function dit(e){return Cie}function _ie(e,t){var r,n=void 0,i=e.structure&&_d.get(e.structure).value;if(i){n=Gu.create({domain:t.domain,listOrName:t.list.colors});var a=n.color;r=function(o){if(zu.isLocation(o)){var s=i.pairs[o.element];if(s)return a(zu.distance(s)/s.distanceThreshold)}return GH}}else r=function(){return GH};return{factory:_ie,granularity:"group",color:r,props:t,description:cit,legend:n?n.legend:void 0}}var qH={name:"cross-link",label:"Cross Link",category:"Miscellaneous",factory:_ie,getParams:dit,defaultValues:I.getDefaultValues(Cie),isApplicable:function(e){return!!e.structure&&zu.isApplicable(e.structure)},ensureCustomProperties:{attach:function(e,t){return t.structure?_d.attach(e,t.structure,void 0,!0):Promise.resolve()},detach:function(e){return e.structure&&_d.ref(e.structure,!1)}}},fit=Nr.create({name:"integrative-cross-link-restraint",category:"custom-props",display:{name:"Cross Link Restraint"},ctor:function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.provider=Cd.Provider,r}return t.prototype.register=function(){this.provider.formatRegistry.add("mmCIF",hit),this.ctx.representation.structure.themes.colorThemeRegistry.add(qH),this.ctx.representation.structure.registry.add(HH)},t.prototype.unregister=function(){this.provider.formatRegistry.remove("mmCIF"),this.ctx.representation.structure.themes.colorThemeRegistry.remove(qH),this.ctx.representation.structure.registry.remove(HH)},t}(Nr.Handler)});function hit(e){if(un.is(e.sourceData)){var t=e.sourceData.data.db.ihm_cross_link_restraint;if(t._rowCount!==0)return Cd.fromTable(t,e)}}const pit=Object.freeze(Object.defineProperty({__proto__:null,AccessibleSurfaceArea:Hnt,BestDatabaseSequenceMapping:Knt,CrossLinkRestraint:fit,Interactions:qnt,SecondaryStructure:$nt,StructureInfo:Ont,ValenceModel:Wnt},Symbol.toStringTag,{value:"Module"}));var yS={State:_tt,Representation:Ett,Camera:Ptt,Misc:bnt},Go={Representation:Tnt,Camera:knt,CustomProps:pit},vit=function(e){var t=rt.Representation.StructureRepresentation3D.definition.params(void 0,e);return{expandRadius:I.Numeric(5,{min:1,max:10,step:1}),targetParams:I.Group(t,{label:"Target",customDefault:PC(e,void 0,{type:"ball-and-stick",size:"physical",typeParams:{sizeFactor:.26,alpha:.51}})}),surroundingsParams:I.Group(t,{label:"Surroundings",customDefault:PC(e,void 0,{type:"ball-and-stick",size:"physical",typeParams:{sizeFactor:.16}})}),nciParams:I.Group(t,{label:"Non-covalent Int.",customDefault:PC(e,void 0,{type:$w,color:DR,size:Ji.BuiltIn.uniform})}),components:I.MultiSelect($H,I.arrayToOptions($H)),excludeTargetFromSurroundings:I.Boolean(!1,{label:"Exclude Target",description:'Exclude the focus "target" from the surroudings component.'}),ignoreHydrogens:I.Boolean(!1)}},$H=["target","surroundings","interactions"],hn;(function(e){e.TargetSel="structure-focus-target-sel",e.TargetRepr="structure-focus-target-repr",e.SurrSel="structure-focus-surr-sel",e.SurrRepr="structure-focus-surr-repr",e.SurrNciRepr="structure-focus-surr-nci-repr"})(hn||(hn={}));var mit=new Set([hn.TargetSel,hn.TargetRepr,hn.SurrSel,hn.SurrRepr,hn.SurrNciRepr]),git=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.currentSource=void 0,r}return Object.defineProperty(t.prototype,"surrLabel",{get:function(){return"[Focus] Surroundings ("+this.params.expandRadius+" )"},enumerable:!1,configurable:!0}),t.prototype.getReprParams=function(r){return E(E({},this.params.targetParams),{type:{name:r.type.name,params:E(E({},r.type.params),{ignoreHydrogens:this.params.ignoreHydrogens})}})},t.prototype.ensureShape=function(r){var n,i=this.plugin.state.data,a=i.tree,o=i.build(),s=or.findUniqueTagsInSubtree(a,r.transform.ref,mit);s[hn.TargetSel]||(s[hn.TargetSel]=o.to(r).apply(rt.Model.StructureSelectionFromBundle,{bundle:on.Empty,label:"[Focus] Target"},{tags:hn.TargetSel}).ref),s[hn.SurrSel]||(s[hn.SurrSel]=o.to(r).apply(rt.Model.StructureSelectionFromExpression,{expression:se.struct.generator.empty(),label:this.surrLabel},{tags:hn.SurrSel}).ref);var u=this.params.components;return u.indexOf("target")>=0&&!s[hn.TargetRepr]&&(s[hn.TargetRepr]=o.to(s[hn.TargetSel]).apply(rt.Representation.StructureRepresentation3D,this.getReprParams(this.params.targetParams),{tags:hn.TargetRepr}).ref),u.indexOf("surroundings")>=0&&!s[hn.SurrRepr]&&(s[hn.SurrRepr]=o.to(s[hn.SurrSel]).apply(rt.Representation.StructureRepresentation3D,this.getReprParams(this.params.surroundingsParams),{tags:hn.SurrRepr}).ref),u.indexOf("interactions")>=0&&!s[hn.SurrNciRepr]&&r.obj&&$w.isApplicable((n=r.obj)===null||n===void 0?void 0:n.data)&&(s[hn.SurrNciRepr]=o.to(s[hn.SurrSel]).apply(rt.Representation.StructureRepresentation3D,this.params.nciParams,{tags:hn.SurrNciRepr}).ref),{state:i,builder:o,refs:s}},t.prototype.clear=function(r){var n=this.plugin.state.data;this.currentSource=void 0;var i=n.select(or.Generators.byRef(r).subtree().withTag(hn.TargetSel)),a=n.select(or.Generators.byRef(r).subtree().withTag(hn.SurrSel));if(!(i.length===0&&a.length===0)){for(var o=n.build(),s=on.Empty,u=0,l=i;u<l.length;u++){var c=l[u];o.to(c).update(rt.Model.StructureSelectionFromBundle,function(p){return E(E({},p),{bundle:s})})}for(var d=se.struct.generator.empty(),f=0,h=a;f<h.length;f++){var v=h[f];o.to(v).update(rt.Model.StructureSelectionFromExpression,function(p){return E(E({},p),{expression:d})})}return _t.State.Update(this.plugin,{state:n,tree:o,options:{doNotLogTiming:!0,doNotUpdateCurrent:!0}})}},t.prototype.focus=function(r){return ce(this,void 0,void 0,function(){var n,i,a,o,s,u,l,c,d,f,h=this;return de(this,function(v){switch(v.label){case 0:return n=this.plugin.helpers.substructureParent.get(r.structure),!n||!n.obj?[2]:(this.currentSource=r,i=Re.remap(r,n.obj.data),a=Re.extendToWholeResidues(i),o=on.fromLoci(a),s=on.toExpression(o),u=se.struct.modifier.includeSurroundings({0:s,radius:this.params.expandRadius,"as-whole-residues":!0}),this.params.excludeTargetFromSurroundings&&(u=se.struct.modifier.exceptBy({0:u,by:s})),l=this.ensureShape(n),c=l.state,d=l.builder,f=l.refs,d.to(f[hn.TargetSel]).update(rt.Model.StructureSelectionFromBundle,function(p){return E(E({},p),{bundle:o})}),d.to(f[hn.SurrSel]).update(rt.Model.StructureSelectionFromExpression,function(p){return E(E({},p),{expression:u,label:h.surrLabel})}),[4,_t.State.Update(this.plugin,{state:c,tree:d,options:{doNotLogTiming:!0,doNotUpdateCurrent:!0}})]);case 1:return v.sent(),[2]}})})},t.prototype.register=function(r){var n=this;this.subscribeObservable(this.plugin.managers.structure.focus.behaviors.current,function(i){i?n.focus(i.loci):n.clear(fr.RootRef)})},t.prototype.update=function(r){return ce(this,void 0,void 0,function(){var n,i,a,o,s,u,l,c,p,d,f,p,h,v,p;return de(this,function(m){switch(m.label){case 0:if(n=this.params,this.params=r,n.excludeTargetFromSurroundings!==r.excludeTargetFromSurroundings)return this.currentSource&&this.focus(this.currentSource),[2,!0];for(i=this.plugin.state.data,a=i.build(),o=or.Generators.root.subtree(),s=this.params.components,u=s.indexOf("target")>=0,l=0,c=i.select(o.withTag(hn.TargetRepr));l<c.length;l++)p=c[l],u?a.to(p).update(this.getReprParams(this.params.targetParams)):a.delete(p.transform.ref);for(u=s.indexOf("surroundings")>=0,d=0,f=i.select(o.withTag(hn.SurrRepr));d<f.length;d++)p=f[d],u?a.to(p).update(this.getReprParams(this.params.surroundingsParams)):a.delete(p.transform.ref);for(u=s.indexOf("interactions")>=0,h=0,v=i.select(o.withTag(hn.SurrNciRepr));h<v.length;h++)p=v[h],u?a.to(p).update(this.params.nciParams):a.delete(p.transform.ref);return[4,_t.State.Update(this.plugin,{state:i,tree:a,options:{doNotLogTiming:!0,doNotUpdateCurrent:!0}})];case 1:return m.sent(),r.expandRadius!==n.expandRadius?(this.currentSource&&this.focus(this.currentSource),[2,!0]):[2,!0]}})})},t}(Nr.WithSubscribers),qF=Nr.create({name:"create-structure-focus-representation",display:{name:"Structure Focus Representation"},category:"interaction",ctor:git,params:function(e,t){return vit(t)}});function lo(e){return e}(function(e){e.CommonParams={ignoreHydrogens:I.Optional(I.Boolean(!1)),quality:I.Optional(I.Select("auto",Y6)),theme:I.Optional(I.Group({globalName:I.Optional(I.Text("")),carbonColor:I.Optional(I.Select("chain-id",I.arrayToOptions(["chain-id","operator-name","element-symbol"]))),symmetryColor:I.Optional(I.Text("")),focus:I.Optional(I.Group({name:I.Optional(I.Text("")),params:I.Optional(I.Value({}))}))}))};function t(a){return a==="chain-id"?{name:a,params:zte.defaultValues}:a==="operator-name"?{name:a,params:_F.defaultValues}:{name:a,params:{}}}function r(a){return a.units.some(function(o){return!o.conformation.operator.assembly&&o.conformation.operator.spgrOp>=0})}function n(a,o,s){var u,l,c,d,f,h,v=a.state.data.build(),p=a.builders.structure.representation,m={quality:a.managers.structure.component.state.options.visualQuality,ignoreHydrogens:!a.managers.structure.component.state.options.showHydrogens};o.quality&&o.quality!=="auto"&&(m.quality=o.quality),o.ignoreHydrogens!==void 0&&(m.ignoreHydrogens=!!o.ignoreHydrogens);var g=!((u=o.theme)===null||u===void 0)&&u.globalName?(l=o.theme)===null||l===void 0?void 0:l.globalName:void 0,y=((c=o.theme)===null||c===void 0?void 0:c.carbonColor)!==void 0?{carbonColor:t((d=o.theme)===null||d===void 0?void 0:d.carbonColor)}:{},b=s&&(!((f=o.theme)===null||f===void 0)&&f.symmetryColor)&&r(s)?(h=o.theme)===null||h===void 0?void 0:h.symmetryColor:g;return{update:v,builder:p,color:g,symmetryColor:b,typeParams:m,ballAndStickColor:y}}e.reprBuilder=n;function i(a,o,s,u){return a.state.updateBehavior(qF,function(l){var c=RR(a,o,"ball-and-stick",s||"element-symbol",u);l.surroundingsParams.colorTheme=c,l.targetParams.colorTheme=c})}e.updateFocusRepr=i})(lo||(lo={}));var ey=lo.CommonParams,B2=lo.reprBuilder,PA=lo.updateFocusRepr,yit=lo({id:"preset-structure-representation-auto",display:{name:"Automatic",description:"Show representations based on the size of the structure. Smaller structures are shown with more detail than larger ones, ranging from atomistic display to coarse surfaces."},params:function(){return ey},apply:function(e,t,r){var n,i,a=(i=(n=ji.resolveAndCheck(r.state.data,e))===null||n===void 0?void 0:n.obj)===null||i===void 0?void 0:i.data;if(!a)return{};var o=r.config.get(Zr.Structure.SizeThresholds)||We.DefaultSizeThresholds,s=We.getSize(a,o),u=a.polymerResidueCount/a.polymerGapCount;switch(s){case We.Size.Gigantic:case We.Size.Huge:return Eie.apply(e,t,r);case We.Size.Large:return Aie.apply(e,t,r);case We.Size.Medium:if(u>3)return wie.apply(e,t,r);case We.Size.Small:return Pie.apply(e,E(E({},t),{showCarbohydrateSymbol:!0}),r);default:SR()}}}),bit=lo({id:"preset-structure-representation-empty",display:{name:"Empty",description:"Removes all existing representations."},apply:function(e,t,r){return ce(this,void 0,void 0,function(){return de(this,function(n){return[2,{}]})})}}),U2="Basic",wie=lo({id:"preset-structure-representation-polymer-and-ligand",display:{name:"Polymer & Ligand",group:U2,description:"Shows polymers as Cartoon, ligands as Ball & Stick, carbohydrates as 3D-SNFG and water molecules semi-transparent."},params:function(){return ey},apply:function(e,t,r){var n,i,a,o,s,u,l,c,d,f;return ce(this,void 0,void 0,function(){var h,v,p,m,g,y,b,S,x,C,w,A,M,D,k;return de(this,function(R){switch(R.label){case 0:return h=ji.resolveAndCheck(r.state.data,e),h?(k={},[4,Xo(r,h,"polymer")]):[2,{}];case 1:return k.polymer=R.sent(),[4,Xo(r,h,"ligand")];case 2:return k.ligand=R.sent(),[4,Xo(r,h,"non-standard")];case 3:return k.nonStandard=R.sent(),[4,Xo(r,h,"branched",{label:"Carbohydrate"})];case 4:return k.branched=R.sent(),[4,Xo(r,h,"water")];case 5:return k.water=R.sent(),[4,Xo(r,h,"ion")];case 6:return k.ion=R.sent(),[4,Xo(r,h,"lipid")];case 7:return k.lipid=R.sent(),[4,Xo(r,h,"coarse")];case 8:return v=(k.coarse=R.sent(),k),p=h.obj.data,m={sizeFactor:p.isCoarseGrained?.8:.2},g=(((a=(i=(n=v.water)===null||n===void 0?void 0:n.obj)===null||i===void 0?void 0:i.data)===null||a===void 0?void 0:a.elementCount)||0)>5e4?"line":"ball-and-stick",y=(((u=(s=(o=v.lipid)===null||o===void 0?void 0:o.obj)===null||s===void 0?void 0:s.data)===null||u===void 0?void 0:u.elementCount)||0)>2e4?"line":"ball-and-stick",b=B2(r,t,p),S=b.update,x=b.builder,C=b.typeParams,w=b.color,A=b.symmetryColor,M=b.ballAndStickColor,D={polymer:x.buildRepresentation(S,v.polymer,{type:"cartoon",typeParams:E(E({},C),m),color:A},{tag:"polymer"}),ligand:x.buildRepresentation(S,v.ligand,{type:"ball-and-stick",typeParams:C,color:w,colorParams:M},{tag:"ligand"}),nonStandard:x.buildRepresentation(S,v.nonStandard,{type:"ball-and-stick",typeParams:C,color:w,colorParams:M},{tag:"non-standard"}),branchedBallAndStick:x.buildRepresentation(S,v.branched,{type:"ball-and-stick",typeParams:E(E({},C),{alpha:.3}),color:w,colorParams:M},{tag:"branched-ball-and-stick"}),branchedSnfg3d:x.buildRepresentation(S,v.branched,{type:"carbohydrate",typeParams:C,color:w},{tag:"branched-snfg-3d"}),water:x.buildRepresentation(S,v.water,{type:g,typeParams:E(E({},C),{alpha:.6}),color:w,colorParams:{carbonColor:{name:"element-symbol",params:{}}}},{tag:"water"}),ion:x.buildRepresentation(S,v.ion,{type:"ball-and-stick",typeParams:C,color:w,colorParams:{carbonColor:{name:"element-symbol",params:{}}}},{tag:"ion"}),lipid:x.buildRepresentation(S,v.lipid,{type:y,typeParams:E(E({},C),{alpha:.6}),color:w,colorParams:{carbonColor:{name:"element-symbol",params:{}}}},{tag:"lipid"}),coarse:x.buildRepresentation(S,v.coarse,{type:"spacefill",typeParams:C,color:w||"chain-id"},{tag:"coarse"})},[4,S.commit({revertOnError:!1})];case 9:return R.sent(),[4,PA(r,p,(c=(l=t.theme)===null||l===void 0?void 0:l.focus)===null||c===void 0?void 0:c.name,(f=(d=t.theme)===null||d===void 0?void 0:d.focus)===null||f===void 0?void 0:f.params)];case 10:return R.sent(),[2,{components:v,representations:D}]}})})}}),xit=lo({id:"preset-structure-representation-protein-and-nucleic",display:{name:"Protein & Nucleic",group:U2,description:"Shows proteins as Cartoon and RNA/DNA as Gaussian Surface."},params:function(){return ey},apply:function(e,t,r){var n,i,a,o;return ce(this,void 0,void 0,function(){var s,u,l,c,d,f,h,v,p,m,g,y;return de(this,function(b){switch(b.label){case 0:return s=ji.resolveAndCheck(r.state.data,e),s?(y={},[4,WH(r,s,"protein")]):[2,{}];case 1:return y.protein=b.sent(),[4,WH(r,s,"nucleic")];case 2:return u=(y.nucleic=b.sent(),y),l=s.obj.data,c={sizeFactor:l.isCoarseGrained?.8:.2},d={radiusOffset:l.isCoarseGrained?2:0,smoothness:l.isCoarseGrained?1:1.5},f=B2(r,t,l),h=f.update,v=f.builder,p=f.typeParams,m=f.symmetryColor,g={protein:v.buildRepresentation(h,u.protein,{type:"cartoon",typeParams:E(E({},p),c),color:m},{tag:"protein"}),nucleic:v.buildRepresentation(h,u.nucleic,{type:"gaussian-surface",typeParams:E(E({},p),d),color:m},{tag:"nucleic"})},[4,h.commit({revertOnError:!0})];case 3:return b.sent(),[4,PA(r,l,(i=(n=t.theme)===null||n===void 0?void 0:n.focus)===null||i===void 0?void 0:i.name,(o=(a=t.theme)===null||a===void 0?void 0:a.focus)===null||o===void 0?void 0:o.params)];case 4:return b.sent(),[2,{components:u,representations:g}]}})})}}),Eie=lo({id:"preset-structure-representation-coarse-surface",display:{name:"Coarse Surface",group:U2,description:"Shows polymers and lipids as coarse Gaussian Surface."},params:function(){return ey},apply:function(e,t,r){var n,i,a,o;return ce(this,void 0,void 0,function(){var s,u,l,c,d,f,h,v,p,m,g,y;return de(this,function(b){switch(b.label){case 0:return s=ji.resolveAndCheck(r.state.data,e),s?(y={},[4,Xo(r,s,"polymer")]):[2,{}];case 1:return y.polymer=b.sent(),[4,Xo(r,s,"lipid")];case 2:return u=(y.lipid=b.sent(),y),l=s.obj.data,c=We.getSize(l),d=Object.create(null),c===We.Size.Gigantic?Object.assign(d,{traceOnly:!l.isCoarseGrained,radiusOffset:2,smoothness:1,visuals:["structure-gaussian-surface-mesh"]}):c===We.Size.Huge?Object.assign(d,{radiusOffset:l.isCoarseGrained?2:0,smoothness:1}):l.isCoarseGrained&&Object.assign(d,{radiusOffset:2,smoothness:1}),f=B2(r,t,l),h=f.update,v=f.builder,p=f.typeParams,m=f.symmetryColor,g={polymer:v.buildRepresentation(h,u.polymer,{type:"gaussian-surface",typeParams:E(E({},p),d),color:m},{tag:"polymer"}),lipid:v.buildRepresentation(h,u.lipid,{type:"gaussian-surface",typeParams:E(E({},p),d),color:m},{tag:"lipid"})},[4,h.commit({revertOnError:!0})];case 3:return b.sent(),[4,PA(r,l,(i=(n=t.theme)===null||n===void 0?void 0:n.focus)===null||i===void 0?void 0:i.name,(o=(a=t.theme)===null||a===void 0?void 0:a.focus)===null||o===void 0?void 0:o.params)];case 4:return b.sent(),[2,{components:u,representations:g}]}})})}}),Aie=lo({id:"preset-structure-representation-polymer-cartoon",display:{name:"Polymer Cartoon",group:U2,description:"Shows polymers as Cartoon."},params:function(){return ey},apply:function(e,t,r){var n,i,a,o;return ce(this,void 0,void 0,function(){var s,u,l,c,d,f,h,v,p,m,g;return de(this,function(y){switch(y.label){case 0:return s=ji.resolveAndCheck(r.state.data,e),s?(g={},[4,Xo(r,s,"polymer")]):[2,{}];case 1:return u=(g.polymer=y.sent(),g),l=s.obj.data,c={sizeFactor:l.isCoarseGrained?.8:.2},d=B2(r,t,l),f=d.update,h=d.builder,v=d.typeParams,p=d.symmetryColor,m={polymer:h.buildRepresentation(f,u.polymer,{type:"cartoon",typeParams:E(E({},v),c),color:p},{tag:"polymer"})},[4,f.commit({revertOnError:!0})];case 2:return y.sent(),[4,PA(r,l,(i=(n=t.theme)===null||n===void 0?void 0:n.focus)===null||i===void 0?void 0:i.name,(o=(a=t.theme)===null||a===void 0?void 0:a.focus)===null||o===void 0?void 0:o.params)];case 3:return y.sent(),[2,{components:u,representations:m}]}})})}}),Pie=lo({id:"preset-structure-representation-atomic-detail",display:{name:"Atomic Detail",group:U2,description:"Shows everything in atomic detail with Ball & Stick."},params:function(){return E(E({},ey),{showCarbohydrateSymbol:I.Boolean(!1)})},apply:function(e,t,r){return ce(this,void 0,void 0,function(){var n,i,a,o,s,u,l,c,d,f,h,v,p,m,g,y,b,S,x,C,w,A;return de(this,function(M){switch(M.label){case 0:return n=ji.resolveAndCheck(r.state.data,e),n?(w={},[4,Xo(r,n,"all")]):[2,{}];case 1:return i=(w.all=M.sent(),w.branched=void 0,w),a=n.obj.data,o=a.elementCount>1e5,s=a.atomicResidueCount&&a.elementCount>1e3&&a.atomicResidueCount/a.elementCount<3,u=a.models[0],l=!!wa.Provider.get(u)||ec.isExhaustive(u),c="ball-and-stick",a.isCoarseGrained?c=a.elementCount>1e6?"point":"spacefill":s&&!l?c="spacefill":o&&(c="line"),d=t.showCarbohydrateSymbol&&!o&&!s,d?(h=(f=Object).assign,v=[i],A={},[4,Xo(r,n,"branched",{label:"Carbohydrate"})]):[3,3];case 2:h.apply(f,v.concat([(A.branched=M.sent(),A)])),M.label=3;case 3:return p=B2(r,t,a),m=p.update,g=p.builder,y=p.typeParams,b=p.color,S=p.ballAndStickColor,x=s&&!l?{carbonColor:{name:"element-symbol",params:{}}}:S,C={all:g.buildRepresentation(m,i.all,{type:c,typeParams:y,color:b,colorParams:x},{tag:"all"})},d&&Object.assign(C,{snfg3d:g.buildRepresentation(m,i.branched,{type:"carbohydrate",typeParams:E(E({},y),{alpha:.4,visuals:["carbohydrate-symbol"]}),color:b},{tag:"snfg-3d"})}),[4,m.commit({revertOnError:!0})];case 4:return M.sent(),[2,{components:i,representations:C}]}})})}});function Xo(e,t,r,n){return e.builders.structure.tryCreateComponentStatic(t,r,n)}function WH(e,t,r,n){return e.builders.structure.tryCreateComponentFromSelection(t,bi[r],"selection-"+r,n)}var zg={empty:bit,auto:yit,"atomic-detail":Pie,"polymer-cartoon":Aie,"polymer-and-ligand":wie,"protein-and-nucleic":xit,"coarse-surface":Eie};function $F(e,t){if(e.ext==="bcif")try{if(WJ(t).encoder.startsWith("VolumeServer"))return"dscif"}catch{}else if(e.ext==="cif"){var r=t;if(r.startsWith(`data_SERVER
#
_density_server_result`))return"dscif";if(r.includes("atom_site_fract_x")||r.includes("atom_site.fract_x"))return"coreCif"}return-1}var Xd="Trajectory";function Yd(e,t){return e.builders.structure.hierarchy.applyPreset(t.trajectory,"default")}var Sit={label:"mmCIF",description:"mmCIF",category:Xd,stringExtensions:["cif","mmcif","mcif"],binaryExtensions:["bcif"],isApplicable:function(e,t){return e.ext==="mmcif"||e.ext==="mcif"?!0:e.ext==="cif"||e.ext==="bcif"?$F(e,t)===-1:!1},parse:function(e,t,r){return ce(void 0,void 0,void 0,function(){var n,i,a,o,s;return de(this,function(u){switch(u.label){case 0:return n=e.state.data,i=n.build().to(t).apply(rt.Data.ParseCif,void 0,{state:{isGhost:!0}}),[4,i.apply(rt.Model.TrajectoryFromMmCif,void 0,{tags:r==null?void 0:r.trajectoryTags}).commit({revertOnError:!0})];case 1:return a=u.sent(),(((s=(o=i.selector.cell)===null||o===void 0?void 0:o.obj)===null||s===void 0?void 0:s.data.blocks.length)||0)>1&&e.state.data.updateCellState(i.ref,{isGhost:!1}),[2,{trajectory:a}]}})})},visuals:Yd},Cit={label:"cifCore",description:"CIF Core",category:Xd,stringExtensions:["cif"],isApplicable:function(e,t){return e.ext==="cif"?$F(e,t)==="coreCif":!1},parse:function(e,t,r){return ce(void 0,void 0,void 0,function(){var n,i,a,o,s;return de(this,function(u){switch(u.label){case 0:return n=e.state.data,i=n.build().to(t).apply(rt.Data.ParseCif,void 0,{state:{isGhost:!0}}),[4,i.apply(rt.Model.TrajectoryFromCifCore,void 0,{tags:r==null?void 0:r.trajectoryTags}).commit({revertOnError:!0})];case 1:return a=u.sent(),(((s=(o=i.selector.cell)===null||o===void 0?void 0:o.obj)===null||s===void 0?void 0:s.data.blocks.length)||0)>1&&e.state.data.updateCellState(i.ref,{isGhost:!1}),[2,{trajectory:a}]}})})},visuals:Yd};function cm(e,t){var r=this;return function(n,i,a){return ce(r,void 0,void 0,function(){var o,s;return de(this,function(u){switch(u.label){case 0:return o=n.state.data,[4,o.build().to(i).apply(e,t,{tags:a==null?void 0:a.trajectoryTags}).commit({revertOnError:!0})];case 1:return s=u.sent(),[2,{trajectory:s}]}})})}}var _it={label:"PDB",description:"PDB",category:Xd,stringExtensions:["pdb","ent"],parse:cm(rt.Model.TrajectoryFromPDB),visuals:Yd},wit={label:"PDBQT",description:"PDBQT",category:Xd,stringExtensions:["pdbqt"],parse:cm(rt.Model.TrajectoryFromPDB,{isPdbqt:!0}),visuals:Yd},Eit={label:"XYZ",description:"XYZ",category:Xd,stringExtensions:["xyz"],parse:cm(rt.Model.TrajectoryFromXYZ),visuals:Yd},Ait={label:"GRO",description:"GRO",category:Xd,stringExtensions:["gro"],binaryExtensions:[],parse:cm(rt.Model.TrajectoryFromGRO),visuals:Yd},Pit={label:"MOL",description:"MOL",category:Xd,stringExtensions:["mol"],parse:cm(rt.Model.TrajectoryFromMOL),visuals:Yd},Tit={label:"SDF",description:"SDF",category:Xd,stringExtensions:["sdf","sd"],parse:cm(rt.Model.TrajectoryFromSDF),visuals:Yd},Iit={label:"MOL2",description:"MOL2",category:Xd,stringExtensions:["mol2"],parse:cm(rt.Model.TrajectoryFromMOL2),visuals:Yd},Tie=[["mmcif",Sit],["cifCore",Cit],["pdb",_it],["pdbqt",wit],["gro",Ait],["xyz",Eit],["mol",Pit],["sdf",Tit],["mol2",Iit]],Mit=function(e){return I.Group({type:uv.getParams(void 0,"auto").type,representation:I.Select(zg.auto.id,e.builders.structure.representation.getPresets().map(function(t){return[t.id,t.display.name,t.display.group]}),{description:"Which representation preset to use."}),representationParams:I.Group(lo.CommonParams,{isHidden:!0}),asTrajectory:I.Optional(I.Boolean(!1,{description:"Load all entries into a single trajectory."}))},{isExpanded:!1})},WF={rcsb:I.Group({encoding:I.Select("bcif",[["cif","cif"],["bcif","bcif"]])},{label:"RCSB PDB",isFlat:!0}),pdbe:I.Group({variant:I.Select("updated-bcif",[["updated-bcif","Updated (bcif)"],["updated","Updated"],["archival","Archival"]])},{label:"PDBe",isFlat:!0})},GR=Ro.build({from:ge.Root,display:{name:"Download Structure",description:"Load a structure from the provided source and create its representation."},params:function(e,t){var r=Mit(t),n=t.config.get(Zr.Download.DefaultPdbProvider)||"pdbe";return{source:I.MappedStatic("pdb",{pdb:I.Group({provider:I.Group({id:I.Text("1tqn",{label:"PDB Id(s)",description:"One or more comma/space separated PDB ids."}),server:I.MappedStatic(n,WF)},{pivot:"id"}),options:r},{isFlat:!0,label:"PDB"}),"pdb-dev":I.Group({provider:I.Group({id:I.Text("PDBDEV_00000001",{label:"PDBDev Id(s)",description:"One or more comma/space separated ids."}),encoding:I.Select("bcif",[["cif","cif"],["bcif","bcif"]])},{pivot:"id"}),options:r},{isFlat:!0,label:"PDBDEV"}),swissmodel:I.Group({id:I.Text("Q9Y2I8",{label:"UniProtKB AC(s)",description:"One or more comma/space separated ACs."}),options:r},{isFlat:!0,label:"SWISS-MODEL",description:"Loads the best homology model or experimental structure"}),pubchem:I.Group({id:I.Text("2244,2245",{label:"PubChem ID",description:"One or more comma/space separated IDs."}),options:r},{isFlat:!0,label:"PubChem",description:"Loads 3D conformer from PubChem."}),url:I.Group({url:I.Url(""),format:I.Select("mmcif",I.arrayToOptions(Tie.map(function(i){return i[0]}),function(i){return i})),isBinary:I.Boolean(!1),options:r},{isFlat:!0,label:"URL"})})}}})(function(e,t){var r=e.params,n=e.state;return $e.create("Download Structure",function(i){return ce(void 0,void 0,void 0,function(){var a,o,s,u,l,c,d;return de(this,function(f){switch(f.label){case 0:switch(t.behaviors.layout.leftPanelTabName.next("data"),a=r.source,s=!1,u="mmcif",a.name){case"url":o=[{url:a.params.url,isBinary:a.params.isBinary}],u=a.params.format;break;case"pdb":o=a.params.provider.server.name==="pdbe"?a.params.provider.server.params.variant==="updated"?df(a.params.provider.id,function(h){return"https://www.ebi.ac.uk/pdbe/static/entry/"+h.toLowerCase()+"_updated.cif"},function(h){return"PDBe: "+h+" (updated cif)"},!1):a.params.provider.server.params.variant==="updated-bcif"?df(a.params.provider.id,function(h){return"https://www.ebi.ac.uk/pdbe/entry-files/download/"+h.toLowerCase()+".bcif"},function(h){return"PDBe: "+h+" (updated cif)"},!0):df(a.params.provider.id,function(h){return"https://www.ebi.ac.uk/pdbe/static/entry/"+h.toLowerCase()+".cif"},function(h){return"PDBe: "+h+" (cif)"},!1):a.params.provider.server.params.encoding==="cif"?df(a.params.provider.id,function(h){return"https://files.rcsb.org/download/"+h.toUpperCase()+".cif"},function(h){return"RCSB: "+h+" (cif)"},!1):df(a.params.provider.id,function(h){return"https://models.rcsb.org/"+h.toUpperCase()+".bcif"},function(h){return"RCSB: "+h+" (bcif)"},!0),s=!!a.params.options.asTrajectory;break;case"pdb-dev":o=df(a.params.provider.id,function(h){var v=h.toUpperCase().startsWith("PDBDEV_")?h:"PDBDEV_"+h.padStart(8,"0");return a.params.provider.encoding==="bcif"?"https://pdb-dev.wwpdb.org/bcif/"+v.toUpperCase()+".bcif":"https://pdb-dev.wwpdb.org/cif/"+v.toUpperCase()+".cif"},function(h){return h.toUpperCase().startsWith("PDBDEV_")?h:"PDBDEV_"+h.padStart(8,"0")},a.params.provider.encoding==="bcif"),s=!!a.params.options.asTrajectory;break;case"swissmodel":o=df(a.params.id,function(h){return"https://swissmodel.expasy.org/repository/uniprot/"+h.toUpperCase()+".pdb"},function(h){return"SWISS-MODEL: "+h},!1),s=!!a.params.options.asTrajectory,u="pdb";break;case"pubchem":o=df(a.params.id,function(h){return"https://pubchem.ncbi.nlm.nih.gov/rest/pug/compound/CID/"+h.trim()+"/record/SDF/?record_type=3d"},function(h){return"PubChem: "+h},!1),s=!!a.params.options.asTrajectory,u="mol";break;default:throw new Error(a.name+" not supported.")}return l=r.source.params.options.representation||zg.auto.id,c=l!==zg.empty.id,d=a.params.options.type.name==="auto"?void 0:a.params.options.type,[4,n.transaction(function(){return ce(void 0,void 0,void 0,function(){var h,y,v,p,m,g,y;return de(this,function(b){switch(b.label){case 0:return o.length>0&&s?[4,t.builders.data.downloadBlob({sources:o.map(function(S,x){return{id:""+x,url:S.url,isBinary:S.isBinary}}),maxConcurrency:6},{state:{isGhost:!0}})]:[3,4];case 1:return h=b.sent(),[4,t.builders.structure.parseTrajectory(h,{formats:o.map(function(S,x){return{id:""+x,format:"cif"}})})];case 2:return y=b.sent(),[4,t.builders.structure.hierarchy.applyPreset(y,"default",{structure:d,showUnitcell:c,representationPreset:l,representationPresetParams:r.source.params.options.representationParams})];case 3:return b.sent(),[3,10];case 4:v=0,p=o,b.label=5;case 5:return v<p.length?(m=p[v],[4,t.builders.data.download(m,{state:{isGhost:!0}})]):[3,10];case 6:return g=b.sent(),[4,t.builders.structure.parseTrajectory(g,u)];case 7:return y=b.sent(),[4,t.builders.structure.hierarchy.applyPreset(y,"default",{structure:d,showUnitcell:c,representationPreset:l,representationPresetParams:r.source.params.options.representationParams})];case 8:b.sent(),b.label=9;case 9:return v++,[3,5];case 10:return[2]}})})}).runInContext(i)];case 1:return f.sent(),[2]}})})})});function df(e,t,r,n){for(var i=e.split(/[,\s]/).map(function(l){return l.trim()}).filter(function(l){return!!l&&(l.length>=4||/^[1-9][0-9]*$/.test(l))}),a=[],o=0,s=i;o<s.length;o++){var u=s[o];a.push({url:Mn.Url(t(u)),isBinary:n,label:r(u)})}return a}var IC=Ro.build({display:{name:"Update Trajectory"},params:{action:I.Select("advance",[["advance","Advance"],["reset","Reset"]]),by:I.Optional(I.Numeric(1,{min:-1,max:1,step:1}))}})(function(e){var t=e.params,r=e.state,n=r.selectQ(function(d){return d.ofTransformer(rt.Model.ModelFromTrajectory)}),i=r.build();if(t.action==="reset")for(var a=0,o=n;a<o.length;a++){var s=o[a];i.to(s).update({modelIndex:0})}else for(var u=function(d){var f=or.findAncestorOfType(r.tree,r.cells,d.transform.ref,ge.Molecule.Trajectory);if(!f||!f.obj)return"continue";var h=f.obj;i.to(d).update(function(v){var p=(v.modelIndex+t.by)%h.data.frameCount;return p<0&&(p+=h.data.frameCount),{modelIndex:p}})},l=0,c=n;l<c.length;l++){var s=c[l];u(s)}return r.updateTree(i)}),Dit=Ro.build({display:{name:"Custom Model Properties",description:"Enable parameters for custom properties of the model."},from:ge.Molecule.Model,params:function(e,t){return t.customModelProperties.getParams(e==null?void 0:e.data)},isApplicable:function(e,t,r){return t.transformer!==Rte}})(function(e,t){var r=e.ref,n=e.params;return t.builders.structure.insertModelProperties(r,n)}),Rit=Ro.build({display:{name:"Custom Structure Properties",description:"Enable parameters for custom properties of the structure."},from:ge.Molecule.Structure,params:function(e,t){return t.customStructureProperties.getParams(e==null?void 0:e.data)},isApplicable:function(e,t,r){return t.transformer!==kte}})(function(e,t){var r=e.ref,n=e.params;return t.builders.structure.insertStructureProperties(r,n)}),kit=Ro.build({display:{name:"Add Trajectory",description:"Add trajectory from existing model/topology and coordinates."},from:ge.Root,params:function(e,t){var r=t.state.data,n=Nt(Nt([],r.selectQ(function(s){return s.rootsOfType(ge.Molecule.Model)})),r.selectQ(function(s){return s.rootsOfType(ge.Molecule.Topology)})),i=n.map(function(s){return[s.transform.ref,s.obj.label]}),a=r.selectQ(function(s){return s.rootsOfType(ge.Molecule.Coordinates)}),o=a.map(function(s){return[s.transform.ref,s.obj.label]});return{model:I.Select(i.length?i[0][0]:"",i),coordinates:I.Select(o.length?o[0][0]:"",o)}}})(function(e,t){var r=e.params,n=e.state;return $e.create("Add Trajectory",function(i){return n.transaction(function(){return ce(void 0,void 0,void 0,function(){var a,o,s;return de(this,function(u){switch(u.label){case 0:return a=[r.model,r.coordinates],o=n.build().toRoot().apply(Mte,{modelRef:r.model,coordinatesRef:r.coordinates},{dependsOn:a}).apply(rt.Model.ModelFromTrajectory,{modelIndex:0}),[4,n.updateTree(o).runInContext(i)];case 1:return u.sent(),[4,t.builders.structure.createStructure(o.selector)];case 2:return s=u.sent(),[4,t.builders.structure.representation.applyPreset(s,"auto")];case 3:return u.sent(),[2]}})})}).runInContext(i)})});const Oit=Object.freeze(Object.defineProperty({__proto__:null,AddTrajectory:kit,DownloadStructure:GR,EnableModelCustomProps:Dit,EnableStructureCustomProps:Rit,PdbDownloadProvider:WF,UpdateTrajectory:IC},Symbol.toStringTag,{value:"Module"}));var rr=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.hide=function(){return r.props.onSelect(void 0)},r}return t.prototype.render=function(){var r=this.props,n=P.jsx(Fit,{items:r.items,onSelect:r.onSelect,current:r.current,multiselect:this.props.multiselect,noOffset:this.props.noOffset,noAccent:this.props.noAccent},void 0);return P.jsxs("div",E({className:"msp-action-menu-options"+(r.header?"":" msp-action-menu-options-no-header")},{children:[r.header&&P.jsx(zc,E({header:r.header,title:r.title,initialExpanded:!0,hideExpander:!0,hideOffset:!0,onHeaderClick:this.hide,topRightIcon:jc},{children:n}),void 0),!r.header&&n]}),void 0)},t}(_e.PureComponent);(function(e){function t(l,c){return c?E({kind:"header",label:l},c):{kind:"header",label:l}}e.Header=t;function r(l,c,d){return E({kind:"item",label:l,value:c},d)}e.Item=r;function n(l,c){for(var d=c||{},f=d.label,h=d.value,v=d.category,p=d.selected,m=d.icon,g=d.addOn,y=d.description,b=void 0,S=[],x=0;x<l.length;x++){var C=l[x];if(!(c!=null&&c.filter&&!c.filter(C))){var w=v==null?void 0:v(C),A=f?f(C):""+C,M=h?h(C):C,D=y?y(C):typeof C=="string"?C:void 0,k=void 0;w?(b||(b=new Map),k=b.get(w),k||(k=[e.Header(w,{description:w})],b.set(w,k),S.push(k))):k=S;var R=g==null?void 0:g(C);k.push({kind:"item",label:A,value:M,icon:m?m(C):void 0,selected:p?p(C):void 0,addOn:R,description:D})}}return S}e.createItems=n;var i={value:function(l){return l[0]},label:function(l){return l[1]},category:function(l){return l[2]}};function a(l,c){return n(l,c?E(E({},i),c):i)}e.createItemsFromSelectOptions=a;function o(l){if(Rc(l))return!1;if(Vg(l))return!!l.selected;for(var c=0,d=l;c<d.length;c++){var f=d[c],h=o(f);if(h)return!0}return!1}e.hasSelectedItem=o;function s(l,c){if(!Rc(l)){if(Vg(l))return l.value===c?l:void 0;for(var d=0,f=l;d<f.length;d++){var h=f[d],v=s(h,c);if(v)return v}}}e.findItem=s;function u(l){if(!Rc(l)){if(Vg(l))return l;for(var c=0,d=l;c<d.length;c++){var f=d[c],h=u(f);if(h)return h}}}e.getFirstItem=u})(rr||(rr={}));var Fit=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state=t.createState(r.props),r.toggleExpanded=function(n){r.setState({isExpanded:!r.state.isExpanded}),n.currentTarget.blur()},r.selectAll=function(){var n=qR(r.props.items,[]).filter(function(i){return!i.selected});r.props.onSelect(n)},r.selectNone=function(){var n=qR(r.props.items,[]).filter(function(i){return!!i.selected});r.props.onSelect(n)},r}return t.createState=function(r,n){var i=ZT(r.items)&&Rc(r.items[0])?r.items[0]:void 0,a=i!=null&&i.isIndependent?!1:r.multiselect?rr.hasSelectedItem(r.items):!!r.current&&!!rr.findItem(r.items,r.current.value)||rr.hasSelectedItem(r.items);return{header:i,hasCurrent:a,isExpanded:a||(n??!!(i!=null&&i.initiallyExpanded))}},t.prototype.componentDidUpdate=function(r){if(this.props.items!==r.items||this.props.current!==r.current){var n=ZT(this.props.items)&&ZT(r.items)&&Rc(this.props.items[0])&&Rc(r.items[0])&&this.props.items[0].label===r.items[0].label?this.state.isExpanded:void 0;this.setState(t.createState(this.props,n))}},Object.defineProperty(t.prototype,"multiselectHeader",{get:function(){var r=this.state,n=r.header,i=r.hasCurrent;return P.jsxs("div",E({className:"msp-flex-row msp-control-group-header"},{children:[P.jsx(yr,E({icon:this.state.isExpanded?cd:dd,flex:!0,noOverflow:!0,onClick:this.toggleExpanded,title:"Click to "+(this.state.isExpanded?"collapse":"expand")+"."+(n!=null&&n.description?" "+(n==null?void 0:n.description):"")},{children:i?P.jsx("b",{children:n==null?void 0:n.label},void 0):n==null?void 0:n.label}),void 0),P.jsx(yr,E({icon:B0,flex:!0,onClick:this.selectAll,style:{flex:"0 0 50px",textAlign:"right"}},{children:"All"}),void 0),P.jsx(yr,E({icon:jc,flex:!0,onClick:this.selectNone,style:{flex:"0 0 50px",textAlign:"right"}},{children:"None"}),void 0)]}),void 0)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"basicHeader",{get:function(){var r=this.state,n=r.header,i=r.hasCurrent;return P.jsx("div",E({className:"msp-control-group-header",style:{marginTop:"1px"}},{children:P.jsx(yr,E({noOverflow:!0,icon:this.state.isExpanded?cd:dd,onClick:this.toggleExpanded,title:"Click to "+(this.state.isExpanded?"collapse":"expand")+". "+(n!=null&&n.description?n==null?void 0:n.description:"")},{children:i?P.jsx("b",{children:n==null?void 0:n.label},void 0):n==null?void 0:n.label}),void 0)}),void 0)},enumerable:!1,configurable:!0}),t.prototype.render=function(){var r=this,n=this.props,i=n.items,a=n.onSelect,o=n.current;if(Rc(i))return null;if(Vg(i))return P.jsx(XH,{item:i,onSelect:a,current:o,multiselect:this.props.multiselect},void 0);var s=this.state.header;return P.jsxs(P.Fragment,{children:[s&&(this.props.multiselect&&this.state.isExpanded?this.multiselectHeader:this.basicHeader),P.jsx("div",E({className:this.props.noOffset?void 0:this.props.noAccent?"msp-control-offset":"msp-accent-offset"},{children:(!s||this.state.isExpanded)&&i.map(function(u,l){return Rc(u)?null:Vg(u)?P.jsx(XH,{item:u,onSelect:a,current:o,multiselect:r.props.multiselect},l):P.jsx(t,{items:u,onSelect:a,current:o,multiselect:r.props.multiselect,noAccent:!0},l)})}),void 0)]},void 0)},t}(_e.PureComponent),XH=function(e){var t=e.item,r=e.onSelect,n=e.current,i=e.multiselect,a=n===t,o=t.addOn?{position:"relative"}:void 0;return P.jsxs(yr,E({icon:t.icon,noOverflow:!0,className:"msp-action-menu-button",onClick:function(s){return r(i?[t]:t,s)},disabled:t.disabled,style:o,title:t.description},{children:[a||t.selected?P.jsx("b",{children:t.label},void 0):t.label,t.addOn]}),void 0)};function ZT(e){return!!e&&Array.isArray(e)}function Vg(e){var t=e;return t&&t.kind==="item"}function Rc(e){var t=e;return t&&t.kind==="header"}function qR(e,t){if(Rc(e))return t;if(Vg(e))return t.push(e),t;for(var r=0,n=e;r<n.length;r++){var i=n[r];qR(i,t)}return t}var XF=[["black",0],["gray",8421504],["white",16777215],["red",13840661],["orange",14840576],["yellow",16565248],["green",6863872],["cyan",1484197],["blue",40160],["purple",8086783],["magenta",16394495],["violet",8200583]],Lit=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isExpanded:!!r.props.param.isExpanded,lightness:0},r.toggleExpanded=function(n){r.setState({isExpanded:!r.state.isExpanded}),n.currentTarget.blur()},r.onClickSwatch=function(n){var i=at(+(n.currentTarget.getAttribute("data-color")||"0"));i!==r.props.value&&(r.props.param.isExpanded||r.setState({isExpanded:!1}),r.update(i))},r.onR=function(n){var i=at.toRgb(r.props.value),a=i[1],o=i[2],s=at.fromRgb(n,a,o);s!==r.props.value&&r.update(s)},r.onG=function(n){var i=at.toRgb(r.props.value),a=i[0],o=i[2],s=at.fromRgb(a,n,o);s!==r.props.value&&r.update(s)},r.onB=function(n){var i=at.toRgb(r.props.value),a=i[0],o=i[1],s=at.fromRgb(a,o,n);s!==r.props.value&&r.update(s)},r.onLighten=function(){r.update(at.lighten(r.props.value,.1))},r.onDarken=function(){r.update(at.darken(r.props.value,.1))},r}return t.prototype.update=function(r){this.props.onChange({param:this.props.param,name:this.props.name,value:r})},t.prototype.swatch=function(){var r=this;return P.jsx("div",E({className:"msp-combined-color-swatch"},{children:XF.map(function(n){return P.jsx(yr,{inline:!0,"data-color":n[1],onClick:r.onClickSwatch,style:{background:at.toStyle(n[1])}},n[1])})}),void 0)},t.prototype.render=function(){var r=this.props.param.label||Wa(this.props.name),n=at.toRgb(this.props.value),i=n[0],a=n[1],o=n[2];return P.jsxs(P.Fragment,{children:[P.jsx(Zs,{title:this.props.param.description,label:r,control:P.jsx(yr,{onClick:this.toggleExpanded,inline:!0,className:"msp-combined-color-button",style:{background:at.toStyle(this.props.value)}},void 0)},void 0),this.state.isExpanded&&P.jsxs("div",E({className:"msp-control-offset"},{children:[this.swatch(),P.jsx(Zs,{label:"RGB",className:"msp-control-label-short",control:P.jsxs("div",E({style:{display:"flex",textAlignLast:"center",left:"80px"}},{children:[P.jsx(Kc,{onChange:this.onR,numeric:!0,value:i,delayMs:250,style:{order:1,flex:"1 1 auto",minWidth:0},className:"msp-form-control",onEnter:this.props.onEnter,blurOnEnter:!0,blurOnEscape:!0},void 0),P.jsx(Kc,{onChange:this.onG,numeric:!0,value:a,delayMs:250,style:{order:2,flex:"1 1 auto",minWidth:0},className:"msp-form-control",onEnter:this.props.onEnter,blurOnEnter:!0,blurOnEscape:!0},void 0),P.jsx(Kc,{onChange:this.onB,numeric:!0,value:o,delayMs:250,style:{order:3,flex:"1 1 auto",minWidth:0},className:"msp-form-control",onEnter:this.props.onEnter,blurOnEnter:!0,blurOnEscape:!0},void 0)]}),void 0)},void 0),P.jsxs("div",E({style:{display:"flex",textAlignLast:"center"}},{children:[P.jsx(yr,E({onClick:this.onLighten,style:{order:1,flex:"1 1 auto",minWidth:0},className:"msp-form-control"},{children:"Lighten"}),void 0),P.jsx(yr,E({onClick:this.onDarken,style:{order:1,flex:"1 1 auto",minWidth:0},className:"msp-form-control"},{children:"Darken"}),void 0)]}),void 0)]}),void 0)]},void 0)},t}(_e.PureComponent),bS=void 0;function Nit(){return bS||(bS=P.jsx(P.Fragment,{children:XF.map(function(e){return P.jsx("option",E({value:e[1],style:{background:""+at.toStyle(e[1])}},{children:is(e[0])}),e[1])})},void 0),bS)}var Bit=function(){for(var e=new Map,t=0,r=XF;t<r.length;t++){var n=r[t];e.set(n[1],n[0])}return e}();function Uit(e){return Bit.has(e)?null:P.jsx("option",E({value:e,style:{background:""+at.toStyle(e)}},{children:at.toRgbString(e)}),at.toHexString(e))}function jit(e){switch(e.kind){case"scale-legend":return zit;case"table-legend":return Vit;default:var t=e;console.warn(t+" has no associated UI component");return}}var zit=function(e){Le(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.render=function(){var r=this.props.legend,n=r.colors.map(function(i){return Array.isArray(i)?at.toStyle(i[0])+" "+100*i[1]+"%":at.toStyle(i)}).join(", ");return P.jsx("div",E({className:"msp-scale-legend"},{children:P.jsxs("div",E({style:{background:"linear-gradient(to right, "+n+")"}},{children:[P.jsx("span",E({style:{float:"left"}},{children:r.minLabel}),void 0),P.jsx("span",E({style:{float:"right"}},{children:r.maxLabel}),void 0)]}),void 0)}),void 0)},t}(_e.PureComponent),Vit=function(e){Le(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.render=function(){var r=this.props.legend;return P.jsx("div",E({className:"msp-table-legend"},{children:r.table.map(function(n,i){var a=n[0],o=n[1];return P.jsxs("div",{children:[P.jsx("div",{className:"msp-table-legend-color",style:{backgroundColor:at.toStyle(o)}},void 0),P.jsx("div",E({className:"msp-table-legend-text"},{children:a}),void 0)]},i)})}),void 0)},t}(_e.PureComponent),Hit=function(e){Le(t,e);function t(r){var n=e.call(this,r)||this;return n.state={show:!1},n.handleHover=n.handleHover.bind(n),n.handleHoverOff=n.handleHoverOff.bind(n),n.deletePoint=n.deletePoint.bind(n),n}return t.prototype.handleHover=function(){this.setState({show:!0});var r=He.create(this.props.nX,this.props.nY);this.props.onmouseover(r)},t.prototype.handleHoverOff=function(){this.setState({show:!1}),this.props.onmouseover(void 0)},t.prototype.deletePoint=function(){this.props.delete(this.props.id)},t.prototype.render=function(){return[P.jsx("circle",{r:"10",id:""+this.props.id,cx:this.props.x,cy:this.props.y,onClick:this.props.onclick,onDoubleClick:this.props.delete(this.props.id),onMouseEnter:this.handleHover,onMouseLeave:this.handleHoverOff,onMouseDown:this.props.onmousedown,fill:"black"},this.props.id+"circle")]},t}(_e.Component),Git=function(e){Le(t,e);function t(r){var n=e.call(this,r)||this;n.handleKeyDown=function(s){},n.handleKeyUp=function(s){},n.handleClick=function(s){return function(u){}},n.handleMouseDown=function(s){return function(u){if(!(s===0||s===n.state.points.length-1)&&!n.state.canSelectMultiple){var l=n.normalizePoint(He.create(n.state.points[s][0],n.state.points[s][1]));n.ghostPoints.push(document.createElementNS(n.namespace,"circle")),n.ghostPoints[0].setAttribute("r","10"),n.ghostPoints[0].setAttribute("fill","orange"),n.ghostPoints[0].setAttribute("cx",""+l[0]),n.ghostPoints[0].setAttribute("cy",""+l[1]),n.ghostPoints[0].setAttribute("style","display: none"),n.gElement.appendChild(n.ghostPoints[0]),n.updatedX=l[0],n.updatedY=l[1],n.selected=[s]}}},n.deletePoint=function(s){return function(u){if(!(s===0||s===n.state.points.length-1)){var l=n.state.points.filter(function(c,d){return d!==s});l.sort(function(c,d){return c[0]===d[0]?c[0]===0?c[1]-d[1]:c[1]===1?d[1]-c[1]:c[1]-d[1]:c[0]-d[0]}),n.setState({points:l}),n.change(l),u.stopPropagation()}}},n.myRef=_e.createRef(),n.state={points:[He.create(0,0),He.create(1,0)],copyPoint:void 0,canSelectMultiple:!1},n.height=400,n.width=600,n.padding=70,n.selected=void 0,n.ghostPoints=[],n.namespace="http://www.w3.org/2000/svg";for(var i=0,a=n.props.data;i<a.length;i++){var o=a[i];n.state.points.push(o)}return n.state.points.sort(function(s,u){return s[0]===u[0]?s[0]===0?s[1]-u[1]:s[1]===1?u[1]-s[1]:s[1]-u[1]:s[0]-u[0]}),n.handleDrag=n.handleDrag.bind(n),n.handleMultipleDrag=n.handleMultipleDrag.bind(n),n.handleDoubleClick=n.handleDoubleClick.bind(n),n.refCallBack=n.refCallBack.bind(n),n.handlePointUpdate=n.handlePointUpdate.bind(n),n.change=n.change.bind(n),n.handleKeyUp=n.handleKeyUp.bind(n),n.handleLeave=n.handleLeave.bind(n),n.handleEnter=n.handleEnter.bind(n),n}return t.prototype.render=function(){var r=this.renderPoints(),n=this.renderLines();return[P.jsx("div",{children:P.jsxs("svg",E({className:"msp-canvas",ref:this.refCallBack,viewBox:"0 0 "+(this.width+this.padding)+" "+(this.height+this.padding),onMouseMove:this.handleDrag,onMouseUp:this.handlePointUpdate,onMouseLeave:this.handleLeave,onMouseEnter:this.handleEnter,tabIndex:0,onKeyDown:this.handleKeyDown,onKeyUp:this.handleKeyUp,onDoubleClick:this.handleDoubleClick},{children:[P.jsxs("g",E({stroke:"black",fill:"black"},{children:[n,r]}),void 0),P.jsx("g",{className:"ghost-points",stroke:"black",fill:"black"},void 0)]}),void 0)},"LineGraph"),P.jsx("div",{id:"modal-root"},"modal")]},t.prototype.componentDidMount=function(){this.gElement=document.getElementsByClassName("ghost-points")[0]},t.prototype.change=function(r){var n=r.slice();n.shift(),n.pop(),this.props.onChange(n)},t.prototype.handleDrag=function(r){if(this.selected!==void 0){var n=this.myRef.createSVGPoint(),i,a=this.padding/2;n.x=r.clientX,n.y=r.clientY;var o=n.matrixTransform(this.myRef.getScreenCTM().inverse());i=He.create(o.x,o.y),(o.x<a||o.x>this.width+a)&&(o.y>this.height+a||o.y<a)?i=He.create(this.updatedX,this.updatedY):o.x<a?i=He.create(a,o.y):o.x>this.width+a?i=He.create(this.width+a,o.y):o.y>this.height+a?i=He.create(o.x,this.height+a):o.y<a?i=He.create(o.x,a):i=He.create(o.x,o.y),this.updatedX=i[0],this.updatedY=i[1];var s=this.unNormalizePoint(i);this.ghostPoints[0].setAttribute("style","display: visible"),this.ghostPoints[0].setAttribute("cx",""+i[0]),this.ghostPoints[0].setAttribute("cy",""+i[1]),this.props.onDrag(s)}},t.prototype.handleMultipleDrag=function(){},t.prototype.handlePointUpdate=function(r){var n=this.selected;if(!this.state.canSelectMultiple){if(n===void 0||n[0]===0||n[0]===this.state.points.length-1){this.setState({copyPoint:void 0});return}this.selected=void 0;var i=this.unNormalizePoint(He.create(this.updatedX,this.updatedY)),a=this.state.points.filter(function(o,s){return s!==n[0]});a.push(i),a.sort(function(o,s){return o[0]===s[0]?o[0]===0?o[1]-s[1]:o[1]===1?s[1]-o[1]:o[1]-s[1]:o[0]-s[0]}),this.setState({points:a}),this.change(a),this.gElement.innerHTML="",this.ghostPoints=[],document.removeEventListener("mousemove",this.handleDrag,!0),document.removeEventListener("mouseup",this.handlePointUpdate,!0)}},t.prototype.handleDoubleClick=function(r){var n,i=this.myRef.createSVGPoint();i.x=r.clientX,i.y=r.clientY;var a=i.matrixTransform(this.myRef.getScreenCTM().inverse()),o=this.state.points,s=this.padding/2;a.x<s||a.x>this.width+s||a.y>this.height+s||a.y<this.padding/2||(n=this.unNormalizePoint(He.create(a.x,a.y)),o.push(n),o.sort(function(u,l){return u[0]===l[0]?u[0]===0?u[1]-l[1]:u[1]===1?l[1]-u[1]:u[1]-l[1]:u[0]-l[0]}),this.setState({points:o}),this.change(o))},t.prototype.handleLeave=function(){this.selected!==void 0&&(document.addEventListener("mousemove",this.handleDrag,!0),document.addEventListener("mouseup",this.handlePointUpdate,!0))},t.prototype.handleEnter=function(){document.removeEventListener("mousemove",this.handleDrag,!0),document.removeEventListener("mouseup",this.handlePointUpdate,!0)},t.prototype.normalizePoint=function(r){var n=this.padding/2,i=this.width+n,a=this.height+n,o=r[0]*(i-n)+n,s=r[1]*(a-n)+n,u=this.height+this.padding-s,l=He.create(o,u);return l},t.prototype.unNormalizePoint=function(r){var n=this.padding/2,i=this.width+n,a=this.height+n,o=(r[0]-n)/(i-n),s=(this.height+this.padding-r[1]-n)/(a-n);return He.create(o,s)},t.prototype.refCallBack=function(r){r&&(this.myRef=r)},t.prototype.renderPoints=function(){for(var r=[],n,i=0;i<this.state.points.length;i++)i!==0&&i!==this.state.points.length-1&&(n=this.normalizePoint(this.state.points[i]),r.push(P.jsx(Hit,{id:i,x:n[0],y:n[1],nX:this.state.points[i][0],nY:this.state.points[i][1],selected:!1,delete:this.deletePoint,onmouseover:this.props.onHover,onmousedown:this.handleMouseDown(i),onclick:this.handleClick(i)},i)));return r},t.prototype.renderLines=function(){for(var r=[],n=[],i,a,o,s,u,l,c=0,d=this.state.points;c<d.length;c++){var f=d[c];i=this.padding/2,a=this.width+i,o=this.height+i,s=f[0]*(a-i)+i,u=f[1]*(o-i)+i,l=this.height+this.padding-u,r.push(He.create(s,l))}for(var h=r,v=h.length,p=0;p<v-1;p++){var m=h[p][0],g=h[p][1],y=h[p+1][0],b=h[p+1][1];n.push(P.jsx("line",{x1:m,x2:y,y1:g,y2:b,stroke:"#cec9ba",strokeWidth:"5"},"lineOf"+p))}return n},t}(_e.Component),Iie=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isChanging:!1,current:0},r.begin=function(){r.setState({isChanging:!0})},r.end=function(n){r.setState({isChanging:!1}),r.props.onChange(n)},r.updateCurrent=function(n){var i,a;r.setState({current:n}),(a=(i=r.props).onChangeImmediate)===null||a===void 0||a.call(i,n)},r.updateManually=function(n){r.setState({isChanging:!0});var i=n;r.props.step===1&&(i=Math.round(i)),i<r.props.min&&(i=r.props.min),i>r.props.max&&(i=r.props.max),r.setState({current:i,isChanging:!0})},r.onManualBlur=function(){r.setState({isChanging:!1}),r.props.onChange(r.state.current)},r}return t.getDerivedStateFromProps=function(r,n){return n.isChanging||r.value===n.current?null:{current:r.value}},t.prototype.render=function(){var r=this.props.step;return r===void 0&&(r=1),P.jsxs("div",E({className:"msp-slider"},{children:[P.jsx("div",{children:P.jsx(Mie,{min:this.props.min,max:this.props.max,step:r,value:this.state.current,disabled:this.props.disabled,onBeforeChange:this.begin,onChange:this.updateCurrent,onAfterChange:this.end},void 0)},void 0),P.jsx("div",{children:P.jsx(Kc,{numeric:!0,delayMs:50,value:this.state.current,blurOnEnter:!0,onBlur:this.onManualBlur,isDisabled:this.props.disabled,onChange:this.updateManually},void 0)},void 0)]}),void 0)},t}(_e.Component),qit=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isChanging:!1,current:[0,1]},r.begin=function(){r.setState({isChanging:!0})},r.end=function(n){r.setState({isChanging:!1}),r.props.onChange(n)},r.updateCurrent=function(n){r.setState({current:n})},r.updateMax=function(n){var i=n;r.props.step===1&&(i=Math.round(i)),i<r.state.current[0]?i=r.state.current[0]:i<r.props.min&&(i=r.props.min),i>r.props.max&&(i=r.props.max),r.props.onChange([r.state.current[0],i])},r.updateMin=function(n){var i=n;r.props.step===1&&(i=Math.round(i)),i<r.props.min&&(i=r.props.min),i>r.state.current[1]?i=r.state.current[1]:i>r.props.max&&(i=r.props.max),r.props.onChange([i,r.state.current[1]])},r}return t.getDerivedStateFromProps=function(r,n){return n.isChanging||r.value[0]===n.current[0]&&r.value[1]===n.current[1]?null:{current:r.value}},t.prototype.render=function(){var r=this.props.step;return r===void 0&&(r=1),P.jsxs("div",E({className:"msp-slider2"},{children:[P.jsx("div",{children:P.jsx(Kc,{numeric:!0,delayMs:50,value:this.state.current[0],onEnter:this.props.onEnter,blurOnEnter:!0,isDisabled:this.props.disabled,onChange:this.updateMin},void 0)},void 0),P.jsx("div",{children:P.jsx(Mie,{min:this.props.min,max:this.props.max,step:r,value:this.state.current,disabled:this.props.disabled,onBeforeChange:this.begin,onChange:this.updateCurrent,onAfterChange:this.end,range:!0,allowCross:!0},void 0)},void 0),P.jsx("div",{children:P.jsx(Kc,{numeric:!0,delayMs:50,value:this.state.current[1],onEnter:this.props.onEnter,blurOnEnter:!0,isDisabled:this.props.disabled,onChange:this.updateMax},void 0)},void 0)]}),void 0)},t}(_e.Component);function $R(e){for(var t=[],r={}.hasOwnProperty,n=0;n<arguments.length;n++){var i=arguments[n];if(i){var a=typeof i;if(a==="string"||a==="number")t.push(i);else if(Array.isArray(i))t.push($R.apply(null,i));else if(a==="object")for(var o in i)r.call(i,o)&&i[o]&&t.push(o)}}return t.join(" ")}function YH(e){return e.touches.length>1||e.type.toLowerCase()==="touchend"&&e.touches.length>0}function KH(e,t){return e?t.touches[0].clientY:t.touches[0].pageX}function QH(e,t){return e?t.clientY:t.pageX}function ZH(e,t){var r=t.getBoundingClientRect();return e?r.top+r.height*.5:r.left+r.width*.5}function JT(e){e.stopPropagation(),e.preventDefault()}var $it=function(e){Le(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.render=function(){var r=this.props,n=r.className,i=r.tipFormatter,a=r.vertical,o=r.offset,s=r.value,u=r.index,l=a?{bottom:o+"%"}:{left:o+"%"};return P.jsx("div",{className:n,style:l,title:i(s,u)},void 0)},t}(_e.Component),Mie=function(e){Le(t,e);function t(r){var n=e.call(this,r)||this;n.sliderElement=_e.createRef(),n.handleElements=[],n.dragOffset=0,n.startPosition=0,n.startValue=0,n._getPointsCache=void 0,n.onMouseDown=function(f){if(f.button===0){var h=QH(n.props.vertical,f);if(!n.isEventFromHandle(f))n.dragOffset=0;else{var v=ZH(n.props.vertical,f.target);n.dragOffset=h-v,h=v}n.onStart(h),n.addDocumentEvents("mouse"),JT(f)}},n.onTouchMove=function(f){if(YH(f)){n.end("touch");return}var h=KH(n.props.vertical,f);n.onMove(f,h-n.dragOffset)},n.onTouchStart=function(f){if(!YH(f)){var h=KH(n.props.vertical,f);if(!n.isEventFromHandle(f))n.dragOffset=0;else{var v=ZH(n.props.vertical,f.target);n.dragOffset=h-v,h=v}n.onStart(h),n.addDocumentEvents("touch"),JT(f)}},n.eventHandlers={touchmove:function(f){return n.onTouchMove(f)},touchend:function(f){return n.end("touch")},mousemove:function(f){return n.onMouseMove(f)},mouseup:function(f){return n.end("mouse")}},n.calcOffset=function(f){var h=n.props,v=h.min,p=h.max,m=(f-v)/(p-v);return m*100};var i=r.range,a=r.min,o=r.max,s=i?Array.apply(null,Array(+i+1)).map(function(){return a}):a,u="defaultValue"in r?r.defaultValue:s,l=r.value!==void 0?r.value:u,c=(i?l:[a,l]).map(function(f){return n.trimAlignValue(f)}),d;return i&&c[0]===c[c.length-1]&&c[0]===o?d=0:d=c.length-1,n.state={handle:null,recent:d,bounds:c},n}return t.prototype.componentDidUpdate=function(r){var n=this;if("value"in this.props||"min"in this.props||"max"in this.props){var i=this.state.bounds;if(r.range){var a=this.props.value||i,o=a.map(function(u){return n.trimAlignValue(u,n.props)});if(o.every(function(u,l){return u===i[l]}))return;this.setState({bounds:o}),i.some(function(u){return n.isValueOutOfBounds(u,n.props)})&&this.props.onChange(o)}else{var a=this.props.value!==void 0?this.props.value:i[1],s=this.trimAlignValue(a,this.props);if(s===i[1]&&i[0]===r.min)return;this.setState({bounds:[r.min,s]}),this.isValueOutOfBounds(i[1],this.props)&&this.props.onChange(s)}}},t.prototype.onChange=function(r){var n=this.props,i=!("value"in n);i?this.setState(r):r.handle!==void 0&&this.setState({handle:r.handle});var a=E(E({},this.state),r),o=n.range?a.bounds:a.bounds[1];n.onChange(o)},t.prototype.onMouseMove=function(r){var n=QH(this.props.vertical,r);this.onMove(r,n-this.dragOffset)},t.prototype.onMove=function(r,n){JT(r);var i=this.props,a=this.state,o=n-this.startPosition;o=this.props.vertical?-o:o;var s=o/this.getSliderLength()*(i.max-i.min),u=this.trimAlignValue(this.startValue+s),l=a.bounds[a.handle];if(u!==l){var c=Nt([],a.bounds);c[a.handle]=u;var d=a.handle;if(i.pushable){var f=a.bounds[d];this.pushSurroundingHandles(c,d,f)}else i.allowCross&&(c.sort(function(h,v){return h-v}),d=c.indexOf(u));this.onChange({handle:d,bounds:c})}},t.prototype.onStart=function(r){var n=this.props;n.onBeforeChange(this.getValue());var i=this.calcValueByPos(r);this.startValue=i,this.startPosition=r;var a=this.state,o=a.bounds,s=1;if(this.props.range){for(var u=0,l=1;l<o.length-1;++l)i>o[l]&&(u=l);Math.abs(o[u+1]-i)<Math.abs(o[u]-i)&&(u=u+1),s=u;var c=o[u+1]===o[u];c&&(s=a.recent),c&&i!==o[u+1]&&(s=i<o[u+1]?u:u+1)}this.setState({handle:s,recent:s});var d=a.bounds[s];if(i!==d){var f=Nt([],a.bounds);f[s]=i,this.onChange({bounds:f})}},t.prototype.getPoints=function(){var r=this.props,n=r.marks,i=r.step,a=r.min,o=r.max,s=this._getPointsCache;if(!s||s.marks!==n||s.step!==i){var u=E({},n);if(i!==null)for(var l=a;l<=o;l+=i)u[l]=l;var c=Object.keys(u).map(parseFloat);c.sort(function(d,f){return d-f}),this._getPointsCache={marks:n,step:i,points:c}}return this._getPointsCache.points},t.prototype.getPrecision=function(r){var n=r.toString(),i=0;return n.indexOf(".")>=0&&(i=n.length-n.indexOf(".")-1),i},t.prototype.getSliderLength=function(){var r=this.sliderElement.current;return r?this.props.vertical?r.clientHeight:r.clientWidth:0},t.prototype.getSliderStart=function(){var r=this.sliderElement.current,n=r.getBoundingClientRect();return this.props.vertical?n.top:n.left},t.prototype.getValue=function(){var r=this.state.bounds;return this.props.range?r:r[1]},t.prototype.addDocumentEvents=function(r){r==="touch"?(document.addEventListener("touchmove",this.eventHandlers.touchmove),document.addEventListener("touchend",this.eventHandlers.touchend)):r==="mouse"&&(document.addEventListener("mousemove",this.eventHandlers.mousemove),document.addEventListener("mouseup",this.eventHandlers.mouseup))},t.prototype.calcValue=function(r){var n=this.props,i=n.vertical,a=n.min,o=n.max,s=Math.abs(r/this.getSliderLength()),u=i?(1-s)*(o-a)+a:s*(o-a)+a;return u},t.prototype.calcValueByPos=function(r){var n=r-this.getSliderStart(),i=this.trimAlignValue(this.calcValue(n));return i},t.prototype.end=function(r){this.removeEvents(r),this.props.onAfterChange(this.getValue()),this.setState({handle:null})},t.prototype.isEventFromHandle=function(r){for(var n=0,i=this.handleElements;n<i.length;n++){var a=i[n];if(a.current===r.target)return!0}return!1},t.prototype.isValueOutOfBounds=function(r,n){return r<n.min||r>n.max},t.prototype.pushHandle=function(r,n,i,a){for(var o=r[n],s=r[n];i*(s-o)<a;){if(!this.pushHandleOnePoint(r,n,i))return r[n]=o,!1;s=r[n]}return!0},t.prototype.pushHandleOnePoint=function(r,n,i){var a=this.getPoints(),o=a.indexOf(r[n]),s=o+i;if(s>=a.length||s<0)return!1;var u=n+i,l=a[s],c=this.props.pushable,d=i*(r[u]-l);return this.pushHandle(r,u,i,+c-d)?(r[n]=l,!0):!1},t.prototype.pushSurroundingHandles=function(r,n,i){var a=this.props.pushable,o=r[n],s=0;if(r[n+1]-o<a?s=1:o-r[n-1]<a&&(s=-1),s!==0){var u=n+s,l=s*(r[u]-o);this.pushHandle(r,u,s,+a-l)||(r[n]=i)}},t.prototype.removeEvents=function(r){r==="touch"?(document.removeEventListener("touchmove",this.eventHandlers.touchmove),document.removeEventListener("touchend",this.eventHandlers.touchend)):r==="mouse"&&(document.removeEventListener("mousemove",this.eventHandlers.mousemove),document.removeEventListener("mouseup",this.eventHandlers.mouseup))},t.prototype.trimAlignValue=function(r,n){var i=this.state||{},a=i.handle,o=i.bounds,s=E(E({},this.props),n||{}),u=s.marks,l=s.step,c=s.min,d=s.max,f=s.allowCross,h=r;h<=c&&(h=c),h>=d&&(h=d),!f&&a!=null&&a>0&&h<=o[a-1]&&(h=o[a-1]),!f&&a!=null&&a<o.length-1&&h>=o[a+1]&&(h=o[a+1]);var v=Object.keys(u).map(parseFloat);if(l!==null){var p=Math.round((h-c)/l)*l+c;v.push(p)}var m=v.map(function(y){return Math.abs(h-y)}),g=v[m.indexOf(Math.min.apply(Math,m))];return l!==null?parseFloat(g.toFixed(this.getPrecision(l))):g},t.prototype.render=function(){var r,n=this,i=this.state,a=i.handle,o=i.bounds,s=this.props,u=s.className,l=s.prefixCls,c=s.disabled,d=s.vertical,f=s.range,h=s.step,v=s.marks,p=s.tipFormatter,m=this.props.handle,g=o.map(this.calcOffset),y=l+"-handle",b=o.map(function(M,D){var k;return $R((k={},k[y]=!0,k[y+"-"+(D+1)]=!0,k[y+"-lower"]=D===0,k[y+"-upper"]=D===o.length-1,k))}),S=h===null||p===null,x={prefixCls:l,noTip:S,tipFormatter:p,vertical:d};if(this.handleElements.length!==o.length){this.handleElements=[];for(var C=0;C<o.length;C++)this.handleElements.push(_e.createRef())}var w=o.map(function(M,D){return _e.cloneElement(m,E(E({},x),{className:b[D],value:M,offset:g[D],dragging:a===D,index:D,key:D,ref:n.handleElements[D]}))});f||w.shift();var A=$R((r={},r[l]=!0,r[l+"-with-marks"]=Object.keys(v).length,r[l+"-disabled"]=c,r[l+"-vertical"]=this.props.vertical,r[u]=!!u,r));return P.jsxs("div",E({ref:this.sliderElement,className:A,onTouchStart:c?Lf:this.onTouchStart,onMouseDown:c?Lf:this.onMouseDown},{children:[P.jsx("div",{className:l+"-rail"},void 0),w]}),void 0)},t.defaultProps={prefixCls:"msp-slider-base",className:"",min:0,max:100,step:1,marks:{},handle:P.jsx($it,{className:"",vertical:!1,offset:0,tipFormatter:function(r){return r},value:0,index:0},void 0),onBeforeChange:Lf,onChange:Lf,onAfterChange:Lf,tipFormatter:function(r,n){return r},disabled:!1,range:!1,vertical:!1,allowCross:!0,pushable:!1},t}(_e.Component),Vn=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.onChange=function(n){var i,a,o;if((o=(a=r.props).onChange)===null||o===void 0||o.call(a,n,r.props.values),r.props.onChangeValues){var s=E(E({},r.props.values),(i={},i[n.name]=n.value,i));r.props.onChangeValues(s,r.props.values)}},r.paramGroups=Rh(function(n){return Xit(n)}),r}return t.prototype.renderGroup=function(r){var n;if(r.length===0)return null;for(var i=this.props.values,a=null,o=void 0,s=0,u=r;s<u.length;s++){var l=u[s],c=l[0],d=l[1],f=l[2];!((n=d.hideIf)===null||n===void 0)&&n.call(d,i)||(a||(a=[]),o=d.category,a.push(P.jsx(f,{param:d,onChange:this.onChange,onEnter:this.props.onEnter,isDisabled:this.props.isDisabled,name:c,value:i[c]},c)))}return a?o?[P.jsx(qu,E({header:o},{children:a}),o)]:a:null},t.prototype.renderPart=function(r){for(var n=null,i=0,a=r;i<a.length;i++){var o=a[i],s=this.renderGroup(o);if(s){n||(n=[]);for(var u=0,l=s;u<l.length;u++){var c=l[u];n.push(c)}}}return n},t.prototype.render=function(){var r=this.paramGroups(this.props.params),n=this.renderPart(r.essentials),i=this.renderPart(r.advanced);return n&&i?P.jsxs(P.Fragment,{children:[n,P.jsx(qu,E({header:"Advanced Options"},{children:i}),void 0)]},void 0):n||i},t}(_e.PureComponent),Wit=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.setSettings=function(n,i){var a,o=E(E({},i),(a={},a[n.name]=n.value,a)),s=r.props.mapping.update(o,r.plugin);r.props.mapping.apply(s,r.plugin)},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.events.canvas3d.settingsUpdated,function(){return r.forceUpdate()})},t.prototype.render=function(){var r=this.props.mapping.getTarget(this.plugin),n=this.props.mapping.getValues(r,this.plugin),i=this.props.mapping.params(this.plugin);return P.jsx(Vn,{params:i,values:n,onChange:this.setSettings},void 0)},t}(br);function Xit(e){function t(c,d,f){var h=j2(d);if(h)if(!d.category)f.params[0].push([c,d,h]);else{f.map||(f.map=new Map);var v=f.map.get(d.category);v||(v=[],f.map.set(d.category,v),f.params.push(v)),v.push([c,d,h])}}function r(c,d){var f=c[0],h=d[0];return!f||!f[1].category?-1:!h||!h[1].category?1:f[1].category<h[1].category?-1:1}for(var n=Object.keys(e),i={params:[[]],map:void 0},a={params:[[]],map:void 0},o=0,s=n;o<s.length;o++){var u=s[o],l=e[u];l.isHidden||(l.isEssential?t(u,l,i):t(u,l,a))}return i.params.sort(r),a.params.sort(r),{essentials:i.params,advanced:a.params}}function j2(e){switch(e.type){case"value":return;case"boolean":return YF;case"number":return typeof e.min<"u"&&typeof e.max<"u"?Zit:Qit;case"converted":return yat;case"conditioned":return gat;case"multi-select":return pat;case"color":return Lit;case"color-list":return e.offsets?uat:sat;case"vec3":return lat;case"mat4":return cat;case"url":return dat;case"file":return fat;case"file-list":return hat;case"select":return KF;case"value-ref":return eat;case"data-ref":return;case"text":return Jit;case"interval":return typeof e.min<"u"&&typeof e.max<"u"?rat:tat;case"group":return Rie;case"mapped":return vat;case"line-graph":return Kit;case"script":return bat;case"object-list":return ZF;default:var t=e;console.warn(t+" has no associated UI component");return}}var Yit=function(e){Le(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.render=function(){var r=this.props,n=r.legend,i=r.description,a=n&&jit(n);return P.jsx("div",E({className:"msp-help-text"},{children:P.jsxs("div",{children:[P.jsxs("div",E({className:"msp-help-description"},{children:[P.jsx(cn,{svg:Kl,inline:!0},void 0),i]}),void 0),a&&P.jsx("div",E({className:"msp-help-legend"},{children:P.jsx(a,{legend:n},void 0)}),void 0)]},void 0)}),void 0)},t}(_e.PureComponent);function dm(e){var t=e.props,r=e.state,n=e.control,i=e.toggleHelp,a=e.addOn,o=[];t.param.shortLabel&&o.push("msp-control-label-short"),t.param.twoColumns&&o.push("msp-control-col-2");var s=o.join(" "),u=t.param.label||Wa(t.name),l=t.param.help?t.param.help(t.value):{description:t.param.description,legend:t.param.legend},c=l.description||l.legend,d=u+(c?". Click for help.":"");return P.jsxs(P.Fragment,{children:[P.jsx(Zs,{className:s,title:d,label:P.jsxs(P.Fragment,{children:[u,c&&P.jsx("button",E({className:"msp-help msp-btn-link msp-btn-icon msp-control-group-expander",onClick:i,title:d||(r.showHelp?"Hide":"Show")+" help",style:{background:"transparent",textAlign:"left",padding:"0"}},{children:P.jsx(cn,{svg:Kl},void 0)}),void 0)]},void 0),control:n},void 0),c&&r.showHelp&&P.jsx("div",E({className:"msp-control-offset"},{children:P.jsx(Yit,{legend:l.legend,description:l.description},void 0)}),void 0),a]},void 0)}var fm=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={showHelp:!1},r.toggleHelp=function(){return r.setState({showHelp:!r.state.showHelp})},r}return t.prototype.update=function(r){this.props.onChange({param:this.props.param,name:this.props.name,value:r})},t.prototype.renderAddOn=function(){return null},t.prototype.render=function(){return dm({props:this.props,state:this.state,control:this.renderControl(),toggleHelp:this.toggleHelp,addOn:this.renderAddOn()})},t}(_e.PureComponent),YF=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.onClick=function(n){r.update(!r.props.value),n.currentTarget.blur()},r}return t.prototype.renderControl=function(){return P.jsxs("button",E({onClick:this.onClick,disabled:this.props.isDisabled},{children:[P.jsx(cn,{svg:this.props.value?B0:kZ},void 0),this.props.value?"On":"Off"]}),void 0)},t}(fm),Kit=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isExpanded:!1,isOverPoint:!1,message:r.props.param.defaultValue.length+" points"},r.onHover=function(n){if(r.setState({isOverPoint:!r.state.isOverPoint}),n){r.setState({message:"("+n[0].toFixed(2)+", "+n[1].toFixed(2)+")"});return}r.setState({message:r.props.value.length+" points"})},r.onDrag=function(n){r.setState({message:"("+n[0].toFixed(2)+", "+n[1].toFixed(2)+")"})},r.onChange=function(n){r.props.onChange({name:r.props.name,param:r.props.param,value:n})},r.toggleExpanded=function(n){r.setState({isExpanded:!r.state.isExpanded}),n.currentTarget.blur()},r}return t.prototype.render=function(){var r=this.props.param.label||Wa(this.props.name);return P.jsxs(P.Fragment,{children:[P.jsx(Zs,{label:r,control:P.jsx("button",E({onClick:this.toggleExpanded,disabled:this.props.isDisabled},{children:""+this.state.message}),void 0)},void 0),P.jsx("div",E({className:"msp-control-offset",style:{display:this.state.isExpanded?"block":"none"}},{children:P.jsx(Git,{data:this.props.param.defaultValue,onChange:this.onChange,onHover:this.onHover,onDrag:this.onDrag},void 0)}),void 0)]},void 0)},t}(_e.PureComponent),Qit=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={value:"0"},r.update=function(n){var i=hw(r.props.param.step||.01);n=parseFloat(n.toFixed(i)),r.props.onChange({param:r.props.param,name:r.props.name,value:n})},r}return t.prototype.render=function(){var r=this.props.param.label||Wa(this.props.name),n=this.props.param.label||Wa(this.props.name),i=hw(this.props.param.step||.01);return P.jsx(Zs,{title:this.props.param.description,label:n,control:P.jsx(Kc,{numeric:!0,value:parseFloat(this.props.value.toFixed(i)),onEnter:this.props.onEnter,placeholder:r,isDisabled:this.props.isDisabled,onChange:this.update},void 0)},void 0)},t}(_e.PureComponent),Zit=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.onChange=function(n){r.update(n)},r}return t.prototype.renderControl=function(){var r=typeof this.props.value>"u"?this.props.param.defaultValue:this.props.value;return P.jsx(Iie,{value:r,min:this.props.param.min,max:this.props.param.max,step:this.props.param.step,onChange:this.onChange,onChangeImmediate:this.props.param.immediateUpdate?this.onChange:void 0,disabled:this.props.isDisabled,onEnter:this.props.onEnter},void 0)},t}(fm),Jit=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.onChange=function(n){var i=n.target.value;i!==r.props.value&&r.update(i)},r.onKeyPress=function(n){(n.keyCode===13||n.charCode===13||n.key==="Enter")&&r.props.onEnter&&r.props.onEnter(),n.stopPropagation()},r}return t.prototype.renderControl=function(){var r=this.props.param.label||Wa(this.props.name);return P.jsx("input",{type:"text",value:this.props.value||"",placeholder:r,onChange:this.onChange,onKeyPress:this.props.onEnter?this.onKeyPress:void 0,disabled:this.props.isDisabled},void 0)},t}(fm),Qm=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.onChange=function(n){typeof r.props.param.defaultValue=="number"?r.update(parseInt(n.target.value,10)):r.update(n.target.value)},r}return t.prototype.update=function(r){this.props.onChange({param:this.props.param,name:this.props.name,value:r})},t.prototype.render=function(){var r=this,n=this.props.value!==void 0&&!this.props.param.options.some(function(i){return i[0]===r.props.value});return P.jsxs("select",E({className:"msp-form-control",title:this.props.title,value:this.props.value!==void 0?this.props.value:this.props.param.defaultValue,onChange:this.onChange,disabled:this.props.isDisabled},{children:[n&&P.jsx("option",E({value:this.props.value},{children:"[Invalid] "+this.props.value}),this.props.value),this.props.param.options.map(function(i){var a=i[0],o=i[1];return P.jsx("option",E({value:a},{children:o}),a)})]}),void 0)},t}(_e.PureComponent),KF=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={showHelp:!1,showOptions:!1},r.onSelect=function(n){!n||n.value===r.props.value?r.setState({showOptions:!1}):r.setState({showOptions:!1},function(){r.props.onChange({param:r.props.param,name:r.props.name,value:n.value})})},r.toggle=function(){return r.setState({showOptions:!r.state.showOptions})},r.cycle=function(){var n=r.props.param.options,i=n.findIndex(function(o){return o[0]===r.props.value}),a=i===n.length-1?0:i+1;r.props.onChange({param:r.props.param,name:r.props.name,value:n[a][0]})},r.items=Rh(function(n){return rr.createItemsFromSelectOptions(n.options)}),r.toggleHelp=function(){return r.setState({showHelp:!r.state.showHelp})},r}return t.prototype.renderControl=function(){var r,n=this.items(this.props.param),i=this.props.value!==void 0?rr.findItem(n,this.props.value):void 0,a=i?i.label:typeof this.props.value>"u"?(((r=rr.getFirstItem(n))===null||r===void 0?void 0:r.label)||"")+" [Default]":"[Invalid] "+this.props.value,o=this.props.param.cycle?this.cycle:this.toggle,s=this.props.param.cycle?"center":"left",u=this.props.param.cycle?this.props.value==="on"?B0:this.props.value==="off"?kZ:void 0:void 0;return P.jsx(Fi,{disabled:this.props.isDisabled,style:{textAlign:s,overflow:"hidden",textOverflow:"ellipsis"},label:a,title:a,icon:u,toggle:o,isSelected:this.state.showOptions},void 0)},t.prototype.renderAddOn=function(){if(!this.state.showOptions)return null;var r=this.items(this.props.param),n=rr.findItem(r,this.props.value);return P.jsx(rr,{items:r,current:n,onSelect:this.onSelect},void 0)},t.prototype.render=function(){return dm({props:this.props,state:this.state,control:this.renderControl(),toggleHelp:this.toggleHelp,addOn:this.renderAddOn()})},t}(_e.PureComponent),eat=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={showHelp:!1,showOptions:!1},r.onSelect=function(n){!n||n.value===r.props.value?r.setState({showOptions:!1}):r.setState({showOptions:!1},function(){r.props.onChange({param:r.props.param,name:r.props.name,value:{ref:n.value}})})},r.toggle=function(){return r.setState({showOptions:!r.state.showOptions})},r.items=Rh(function(n){return rr.createItemsFromSelectOptions(n.getOptions())}),r.toggleHelp=function(){return r.setState({showHelp:!r.state.showHelp})},r}return t.prototype.renderControl=function(){var r,n=this.items(this.props.param),i=this.props.value.ref?rr.findItem(n,this.props.value.ref):void 0,a=i?i.label:"[Ref] "+((r=this.props.value.ref)!==null&&r!==void 0?r:"");return P.jsx(Fi,{disabled:this.props.isDisabled,style:{textAlign:"left",overflow:"hidden",textOverflow:"ellipsis"},label:a,title:a,toggle:this.toggle,isSelected:this.state.showOptions},void 0)},t.prototype.renderAddOn=function(){if(!this.state.showOptions)return null;var r=this.items(this.props.param),n=rr.findItem(r,this.props.value.ref);return P.jsx(rr,{items:r,current:n,onSelect:this.onSelect},void 0)},t.prototype.render=function(){return dm({props:this.props,state:this.state,control:this.renderControl(),toggleHelp:this.toggleHelp,addOn:this.renderAddOn()})},t}(_e.PureComponent),tat=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isExpanded:!1},r.components={0:I.Numeric(0,{step:r.props.param.step},{label:"Min"}),1:I.Numeric(0,{step:r.props.param.step},{label:"Max"})},r.componentChange=function(n){var i=n.name,a=n.value,o=Nt([],r.props.value);o[+i]=a,r.change(o)},r.toggleExpanded=function(n){r.setState({isExpanded:!r.state.isExpanded}),n.currentTarget.blur()},r}return t.prototype.change=function(r){this.props.onChange({name:this.props.name,param:this.props.param,value:r})},t.prototype.render=function(){var r=this.props.value,n=this.props.param.label||Wa(this.props.name),i=hw(this.props.param.step||.01),a="["+r[0].toFixed(i)+", "+r[1].toFixed(i)+"]";return P.jsxs(P.Fragment,{children:[P.jsx(Zs,{label:n,control:P.jsx("button",E({onClick:this.toggleExpanded,disabled:this.props.isDisabled},{children:a}),void 0)},void 0),this.state.isExpanded&&P.jsx("div",E({className:"msp-control-offset"},{children:P.jsx(Vn,{params:this.components,values:r,onChange:this.componentChange,onEnter:this.props.onEnter},void 0)}),void 0)]},void 0)},t}(_e.PureComponent),rat=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.onChange=function(n){r.update(n)},r}return t.prototype.renderControl=function(){return P.jsx(qit,{value:this.props.value,min:this.props.param.min,max:this.props.param.max,step:this.props.param.step,onChange:this.onChange,disabled:this.props.isDisabled,onEnter:this.props.onEnter},void 0)},t}(fm);(function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.onChange=function(n){r.update(at(parseInt(n.target.value)))},r}return t.prototype.stripStyle=function(){return{background:at.toStyle(this.props.value),position:"absolute",bottom:"0",height:"4px",right:"0",left:"0"}},t.prototype.renderControl=function(){return P.jsxs("div",E({style:{position:"relative"}},{children:[P.jsxs("select",E({value:this.props.value,onChange:this.onChange},{children:[Uit(this.props.value),Nit()]}),void 0),P.jsx("div",{style:this.stripStyle()},void 0)]}),void 0)},t})(fm);function x1(e,t){return t===void 0&&(t=!1),Array.isArray(e)?t?at.toStyle(e[0])+" "+(100*e[1]).toFixed(2)+"%":at.toStyle(e[0]):at.toStyle(e)}var nat=eA(function(e){var t=e.map(function(r){return x1(r,!0)});return"linear-gradient(to right, "+t.join(", ")+")"}),iat=eA(function(e){for(var t=e.length,r=[x1(e[0])+" "+100*(1/t)+"%"],n=1,i=t-1;n<i;++n)r.push(x1(e[n])+" "+100*(n/t)+"%",x1(e[n])+" "+100*((n+1)/t)+"%");return r.push(x1(e[t-1])+" "+100*((t-1)/t)+"%"),"linear-gradient(to right, "+r.join(", ")+")"});function QF(e,t){return t===void 0&&(t="0"),{background:aat(e.colors,e.kind==="set"),position:"absolute",bottom:"0",height:"4px",right:t,left:"0"}}function aat(e,t){return t?iat(e):nat(e)}function oat(){var e=function(t){var r=Ks(t[0]);return P.jsx("div",{style:QF({kind:r.type!=="qualitative"?"interpolate":"set",colors:r.list})},void 0)};return{ColorPresets:{all:rr.createItemsFromSelectOptions(x6,{addOn:e}),scale:rr.createItemsFromSelectOptions(nMe,{addOn:e}),set:rr.createItemsFromSelectOptions(iMe,{addOn:e})},ColorsParam:I.ObjectList({color:I.Color(0)},function(t){var r=t.color;return at.toHexString(r).toUpperCase()}),OffsetColorsParam:I.ObjectList({color:I.Color(0),offset:I.Numeric(0,{min:0,max:1,step:.01})},function(t){var r=t.color,n=t.offset;return at.toHexString(r).toUpperCase()+" ["+n.toFixed(2)+"]"}),IsInterpolatedParam:I.Boolean(!1,{label:"Interpolated"})}}var xS;function Die(){return xS||(xS=oat(),xS)}var sat=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={showHelp:!1,show:void 0},r.toggleEdit=function(){return r.setState({show:r.state.show==="edit"?void 0:"edit"})},r.togglePresets=function(){return r.setState({show:r.state.show==="presets"?void 0:"presets"})},r.selectPreset=function(n){if(n){r.setState({show:void 0});var i=Ks(n.value);r.update({kind:i.type!=="qualitative"?"interpolate":"set",colors:i.list})}},r.colorsChanged=function(n){var i=n.value;r.update({kind:r.props.value.kind,colors:i.map(function(a){return a.color})})},r.isInterpolatedChanged=function(n){var i=n.value;r.update({kind:i?"interpolate":"set",colors:r.props.value.colors})},r.toggleHelp=function(){return r.setState({showHelp:!r.state.showHelp})},r}return t.prototype.update=function(r){this.props.onChange({param:this.props.param,name:this.props.name,value:r})},t.prototype.renderControl=function(){var r=this.props.value;return P.jsxs(P.Fragment,{children:[P.jsxs("button",E({onClick:this.toggleEdit,style:{position:"relative",paddingRight:"33px"}},{children:[r.colors.length===1?"1 color":r.colors.length+" colors",P.jsx("div",{style:QF(r,"33px")},void 0)]}),void 0),P.jsx(Gt,{svg:OE,onClick:this.togglePresets,toggleState:this.state.show==="presets",title:"Color Presets",style:{padding:0,position:"absolute",right:0,top:0,width:"32px"}},void 0)]},void 0)},t.prototype.renderColors=function(){if(!this.state.show)return null;var r=Die(),n=r.ColorPresets,i=r.ColorsParam,a=r.IsInterpolatedParam,o=n[this.props.param.presetKind];if(this.state.show==="presets")return P.jsx(rr,{items:o,onSelect:this.selectPreset},void 0);var s=this.props.value.colors.map(function(u){return{color:u}});return P.jsxs("div",E({className:"msp-control-offset"},{children:[P.jsx(ZF,{name:"colors",param:i,value:s,onChange:this.colorsChanged,isDisabled:this.props.isDisabled,onEnter:this.props.onEnter},void 0),P.jsx(YF,{name:"isInterpolated",param:a,value:this.props.value.kind==="interpolate",onChange:this.isInterpolatedChanged,isDisabled:this.props.isDisabled,onEnter:this.props.onEnter},void 0)]}),void 0)},t.prototype.render=function(){return dm({props:this.props,state:this.state,control:this.renderControl(),toggleHelp:this.toggleHelp,addOn:this.renderColors()})},t}(_e.PureComponent),uat=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={showHelp:!1,show:void 0},r.toggleEdit=function(){return r.setState({show:r.state.show==="edit"?void 0:"edit"})},r.togglePresets=function(){return r.setState({show:r.state.show==="presets"?void 0:"presets"})},r.selectPreset=function(n){if(n){r.setState({show:void 0});var i=Ks(n.value);r.update({kind:i.type!=="qualitative"?"interpolate":"set",colors:i.list})}},r.colorsChanged=function(n){var i=n.value,a=i.map(function(o){return[o.color,o.offset]});a.sort(function(o,s){return o[1]-s[1]}),r.update({kind:r.props.value.kind,colors:a})},r.isInterpolatedChanged=function(n){var i=n.value;r.update({kind:i?"interpolate":"set",colors:r.props.value.colors})},r.toggleHelp=function(){return r.setState({showHelp:!r.state.showHelp})},r}return t.prototype.update=function(r){this.props.onChange({param:this.props.param,name:this.props.name,value:r})},t.prototype.renderControl=function(){var r=this.props.value;return P.jsxs(P.Fragment,{children:[P.jsxs("button",E({onClick:this.toggleEdit,style:{position:"relative",paddingRight:"33px"}},{children:[r.colors.length===1?"1 color":r.colors.length+" colors",P.jsx("div",{style:QF(r,"33px")},void 0)]}),void 0),P.jsx(Gt,{svg:OE,onClick:this.togglePresets,toggleState:this.state.show==="presets",title:"Color Presets",style:{padding:0,position:"absolute",right:0,top:0,width:"32px"}},void 0)]},void 0)},t.prototype.renderColors=function(){if(!this.state.show)return null;var r=Die(),n=r.ColorPresets,i=r.OffsetColorsParam,a=r.IsInterpolatedParam,o=n[this.props.param.presetKind];if(this.state.show==="presets")return P.jsx(rr,{items:o,onSelect:this.selectPreset},void 0);var s=this.props.value.colors,u=s.map(function(l,c){return Array.isArray(l)?{color:l[0],offset:l[1]}:{color:l,offset:c/s.length}});return u.sort(function(l,c){return l.offset-c.offset}),P.jsxs("div",E({className:"msp-control-offset"},{children:[P.jsx(ZF,{name:"colors",param:i,value:u,onChange:this.colorsChanged,isDisabled:this.props.isDisabled,onEnter:this.props.onEnter},void 0),P.jsx(YF,{name:"isInterpolated",param:a,value:this.props.value.kind==="interpolate",onChange:this.isInterpolatedChanged,isDisabled:this.props.isDisabled,onEnter:this.props.onEnter},void 0)]}),void 0)},t.prototype.render=function(){return dm({props:this.props,state:this.state,control:this.renderControl(),toggleHelp:this.toggleHelp,addOn:this.renderColors()})},t}(_e.PureComponent),lat=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isExpanded:!1},r.components={0:I.Numeric(0,{step:r.props.param.step},{label:r.props.param.fieldLabels&&r.props.param.fieldLabels.x||"X"}),1:I.Numeric(0,{step:r.props.param.step},{label:r.props.param.fieldLabels&&r.props.param.fieldLabels.y||"Y"}),2:I.Numeric(0,{step:r.props.param.step},{label:r.props.param.fieldLabels&&r.props.param.fieldLabels.z||"Z"})},r.componentChange=function(n){var i=n.name,a=n.value,o=_.copy(_.zero(),r.props.value);o[+i]=a,r.change(o)},r.toggleExpanded=function(n){r.setState({isExpanded:!r.state.isExpanded}),n.currentTarget.blur()},r}return t.prototype.change=function(r){this.props.onChange({name:this.props.name,param:this.props.param,value:r})},t.prototype.render=function(){var r=this.props.value,n=this.props.param.label||Wa(this.props.name),i=hw(this.props.param.step||.01),a="["+r[0].toFixed(i)+", "+r[1].toFixed(i)+", "+r[2].toFixed(i)+"]";return P.jsxs(P.Fragment,{children:[P.jsx(Zs,{label:n,control:P.jsx("button",E({onClick:this.toggleExpanded,disabled:this.props.isDisabled},{children:a}),void 0)},void 0),this.state.isExpanded&&P.jsx("div",E({className:"msp-control-offset"},{children:P.jsx(Vn,{params:this.components,values:r,onChange:this.componentChange,onEnter:this.props.onEnter},void 0)}),void 0)]},void 0)},t}(_e.PureComponent),cat=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isExpanded:!1},r.components={json:I.Text(JSON.stringify(ue()),{description:"JSON array with 4x4 matrix in a column major (j * 4 + i indexing) format"})},r.componentChange=function(n){var i=n.name,a=n.value,o=ue.copy(ue(),r.props.value);i==="json"?ue.copy(o,JSON.parse(a)):o[+i]=a,r.change(o)},r.toggleExpanded=function(n){r.setState({isExpanded:!r.state.isExpanded}),n.currentTarget.blur()},r}return t.prototype.change=function(r){this.props.onChange({name:this.props.name,param:this.props.param,value:r})},t.prototype.changeValue=function(r){var n=this;return function(i){var a=ue.copy(ue(),n.props.value);a[r]=i,n.change(a)}},Object.defineProperty(t.prototype,"grid",{get:function(){for(var r=this.props.value,n=[],i=0;i<4;i++){for(var a=[],o=0;o<4;o++)a.push(P.jsx(Kc,{numeric:!0,delayMs:50,value:ue.getValue(r,i,o),onChange:this.changeValue(4*o+i),className:"msp-form-control",blurOnEnter:!0,isDisabled:this.props.isDisabled},o));n.push(P.jsx("div",E({className:"msp-flex-row"},{children:a}),i))}return P.jsx("div",E({className:"msp-parameter-matrix"},{children:n}),void 0)},enumerable:!1,configurable:!0}),t.prototype.render=function(){var r={json:JSON.stringify(this.props.value)},n=this.props.param.label||Wa(this.props.name);return P.jsxs(P.Fragment,{children:[P.jsx(Zs,{label:n,control:P.jsx("button",E({onClick:this.toggleExpanded,disabled:this.props.isDisabled},{children:"44 Matrix"}),void 0)},void 0),this.state.isExpanded&&P.jsxs("div",E({className:"msp-control-offset"},{children:[this.grid,P.jsx(Vn,{params:this.components,values:r,onChange:this.componentChange,onEnter:this.props.onEnter},void 0)]}),void 0)]},void 0)},t}(_e.PureComponent),dat=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.onChange=function(n){var i=n.target.value;i!==Mn.getUrl(r.props.value||"")&&r.update(Mn.Url(i))},r.onKeyPress=function(n){(n.keyCode===13||n.charCode===13||n.key==="Enter")&&r.props.onEnter&&r.props.onEnter(),n.stopPropagation()},r}return t.prototype.renderControl=function(){var r=this.props.param.label||Wa(this.props.name);return P.jsx("input",{type:"text",value:Mn.getUrl(this.props.value||""),placeholder:r,onChange:this.onChange,onKeyPress:this.props.onEnter?this.onKeyPress:void 0,disabled:this.props.isDisabled},void 0)},t}(fm),fat=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={showHelp:!1},r.onChangeFile=function(n){r.change(n.target.files[0])},r.toggleHelp=function(){return r.setState({showHelp:!r.state.showHelp})},r}return t.prototype.change=function(r){this.props.onChange({name:this.props.name,param:this.props.param,value:Mn.File(r)})},t.prototype.renderControl=function(){var r=this.props.value;return P.jsxs("div",E({className:"msp-btn msp-btn-block msp-btn-action msp-loader-msp-btn-file",style:{marginTop:"1px"}},{children:[r?r.name:"Select a file..."," ",P.jsx("input",{disabled:this.props.isDisabled,onChange:this.onChangeFile,type:"file",multiple:!1,accept:this.props.param.accept},void 0)]}),void 0)},t.prototype.render=function(){return this.props.param.label?dm({props:this.props,state:this.state,control:this.renderControl(),toggleHelp:this.toggleHelp,addOn:null}):this.renderControl()},t}(_e.PureComponent),hat=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={showHelp:!1},r.onChangeFileList=function(n){r.change(n.target.files)},r.toggleHelp=function(){return r.setState({showHelp:!r.state.showHelp})},r}return t.prototype.change=function(r){var n=[];if(r)for(var i=0,a=r.length;i<a;++i)n.push(Mn.File(r[i]));this.props.onChange({name:this.props.name,param:this.props.param,value:n})},t.prototype.renderControl=function(){var r=this.props.value,n=[];if(r)for(var i=0,a=r;i<a.length;i++){var o=a[i];n.push(o.name)}var s=n.length===0?"Select files...":n.length===1?n[0]:n.length+" files selected";return P.jsxs("div",E({className:"msp-btn msp-btn-block msp-btn-action msp-loader-msp-btn-file",style:{marginTop:"1px"}},{children:[s," ",P.jsx("input",{disabled:this.props.isDisabled,onChange:this.onChangeFileList,type:"file",multiple:!0,accept:this.props.param.accept},void 0)]}),void 0)},t.prototype.render=function(){return this.props.param.label?dm({props:this.props,state:this.state,control:this.renderControl(),toggleHelp:this.toggleHelp,addOn:null}):this.renderControl()},t}(_e.PureComponent),pat=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isExpanded:!1},r.toggleExpanded=function(n){r.setState({isExpanded:!r.state.isExpanded}),n.currentTarget.blur()},r}return t.prototype.change=function(r){this.props.onChange({name:this.props.name,param:this.props.param,value:r})},t.prototype.toggle=function(r){var n=this;return function(i){n.props.value.indexOf(r)<0?n.change(n.props.value.concat(r)):n.change(n.props.value.filter(function(a){return a!==r})),i.currentTarget.blur()}},t.prototype.render=function(){var r=this,n=this.props.value,i=this.props.param.emptyValue,a=this.props.param.label||Wa(this.props.name);return P.jsxs(P.Fragment,{children:[P.jsx(Zs,{label:a,control:P.jsx("button",E({onClick:this.toggleExpanded,disabled:this.props.isDisabled},{children:n.length===0&&i?i:n.length+" of "+this.props.param.options.length}),void 0)},void 0),this.state.isExpanded&&P.jsx("div",E({className:"msp-control-offset"},{children:this.props.param.options.map(function(o){var s=o[0],u=o[1],l=n.indexOf(s)>=0;return P.jsx(yr,E({onClick:r.toggle(s),disabled:r.props.isDisabled,style:{marginTop:"1px"}},{children:P.jsx("span",E({style:{float:l?"left":"right"}},{children:l?" "+u:u+" "}),void 0)}),s)})}),void 0)]},void 0)},t}(_e.PureComponent),Rie=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isExpanded:!!r.props.param.isExpanded,showHelp:!1},r.onChangeParam=function(n){var i;r.change(E(E({},r.props.value),(i={},i[n.name]=n.value,i)))},r.toggleExpanded=function(){return r.setState({isExpanded:!r.state.isExpanded})},r}return t.prototype.change=function(r){this.props.onChange({name:this.props.name,param:this.props.param,value:r})},t.prototype.pivoted=function(){var r=this.props.param.pivot,n=this.props.param.params,i=n[r],a=j2(i),o=P.jsx(a,{name:r,param:i,value:this.props.value[r],onChange:this.onChangeParam,onEnter:this.props.onEnter,isDisabled:this.props.isDisabled},void 0);if(!this.state.isExpanded)return P.jsxs("div",E({className:"msp-mapped-parameter-group"},{children:[o,P.jsx(Gt,{svg:Av,onClick:this.toggleExpanded,toggleState:this.state.isExpanded,title:"More Options"},void 0)]}),void 0);for(var s=Object.create(null),u=0,l=Object.keys(n);u<l.length;u++){var c=l[u];c!==r&&(s[c]=n[c])}return P.jsxs("div",E({className:"msp-mapped-parameter-group"},{children:[o,P.jsx(Gt,{svg:Av,onClick:this.toggleExpanded,toggleState:this.state.isExpanded,title:"More Options"},void 0),P.jsx("div",E({className:"msp-control-offset"},{children:P.jsx(Vn,{params:s,onEnter:this.props.onEnter,values:this.props.value,onChange:this.onChangeParam,isDisabled:this.props.isDisabled},void 0)}),void 0)]}),void 0)},t.prototype.render=function(){var r=this.props.param.params;if(Object.keys(r).length===0)return null;if(this.props.param.pivot)return this.pivoted();var n=this.props.param.label||Wa(this.props.name),i=P.jsx(Vn,{params:r,onChange:this.onChangeParam,values:this.props.value,onEnter:this.props.onEnter,isDisabled:this.props.isDisabled},void 0);return this.props.inMapped?P.jsx("div",E({className:"msp-control-offset"},{children:i}),void 0):this.props.param.isFlat?i:P.jsxs("div",E({className:"msp-control-group-wrapper"},{children:[P.jsx("div",E({className:"msp-control-group-header"},{children:P.jsxs("button",E({className:"msp-btn msp-form-control msp-btn-block",onClick:this.toggleExpanded},{children:[P.jsx(cn,{svg:this.state.isExpanded?cd:dd},void 0),n]}),void 0)}),void 0),this.state.isExpanded&&P.jsx("div",E({className:"msp-control-offset"},{children:i}),void 0)]}),void 0)},t}(_e.PureComponent),vat=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isExpanded:!1},r.valuesCache={},r.onChangeName=function(n){r.change({name:n.value,params:r.getValues(n.value)})},r.onChangeParam=function(n){r.setValues(r.props.value.name,n.value),r.change({name:r.props.value.name,params:n.value})},r.toggleExpanded=function(){return r.setState({isExpanded:!r.state.isExpanded})},r}return t.prototype.setValues=function(r,n){this.valuesCache[r]=n},t.prototype.getValues=function(r){return r in this.valuesCache?this.valuesCache[r]:this.props.param.map(r).defaultValue},t.prototype.change=function(r){this.props.onChange({name:this.props.name,param:this.props.param,value:r})},t.prototype.areParamsEmpty=function(r){for(var n=0,i=Object.keys(r);n<i.length;n++){var a=i[n];if(!r[a].isHidden)return!1}return!0},t.prototype.render=function(){var r=this,n=this.props.value||this.props.param.defaultValue,i=this.props.param.map(n.name),a=this.props.param.label||Wa(this.props.name),o=j2(i),s=this.props.param.help,u=s?E(E({},this.props.param.select),{help:function(c){return s({name:c,params:r.getValues(c)})}}):this.props.param.select,l=P.jsx(KF,{param:u,isDisabled:this.props.isDisabled,onChange:this.onChangeName,onEnter:this.props.onEnter,name:a,value:n.name},void 0);return o?i.type==="group"&&!i.isFlat?this.areParamsEmpty(i.params)?l:P.jsxs("div",E({className:"msp-mapped-parameter-group"},{children:[l,P.jsx(Gt,{svg:Av,onClick:this.toggleExpanded,toggleState:this.state.isExpanded,title:a+" Properties"},void 0),this.state.isExpanded&&P.jsx(Rie,{inMapped:!0,param:i,value:n.params,name:n.name,onChange:this.onChangeParam,onEnter:this.props.onEnter,isDisabled:this.props.isDisabled},void 0)]}),void 0):P.jsxs(P.Fragment,{children:[l,P.jsx(o,{param:i,value:n.params,name:n.name,onChange:this.onChangeParam,onEnter:this.props.onEnter,isDisabled:this.props.isDisabled},void 0)]},void 0):l},t}(_e.PureComponent),kie=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={current:r.props.value},r.onChangeParam=function(n){var i;r.setState({current:E(E({},r.state.current),(i={},i[n.name]=n.value,i))})},r.apply=function(){r.props.apply(r.state.current)},r}return t.prototype.componentDidUpdate=function(r){(this.props.params!==r.params||this.props.value!==r.value)&&this.setState({current:this.props.value})},t.prototype.render=function(){return P.jsxs(P.Fragment,{children:[P.jsx(Vn,{params:this.props.params,onChange:this.onChangeParam,values:this.state.current,onEnter:this.apply,isDisabled:this.props.isDisabled},void 0),P.jsx("button",E({className:"msp-btn msp-btn-block msp-form-control msp-control-top-offset",onClick:this.apply,disabled:this.props.isDisabled},{children:this.props.isUpdate?"Update":"Add"}),void 0)]},void 0)},t}(_e.PureComponent),mat=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isExpanded:!1},r.update=function(n){r.props.actions.update(n,r.props.index)},r.moveUp=function(){r.props.actions.move(r.props.index,-1)},r.moveDown=function(){r.props.actions.move(r.props.index,1)},r.remove=function(){r.setState({isExpanded:!1}),r.props.actions.remove(r.props.index)},r.toggleExpanded=function(n){r.setState({isExpanded:!r.state.isExpanded}),n.currentTarget.blur()},r}return t.prototype.render=function(){return P.jsxs(P.Fragment,{children:[P.jsxs("div",E({className:"msp-param-object-list-item"},{children:[P.jsxs("button",E({className:"msp-btn msp-btn-block msp-form-control",onClick:this.toggleExpanded},{children:[P.jsx("span",{children:this.props.index+1+": "},void 0),this.props.param.getLabel(this.props.value)]}),void 0),P.jsxs("div",{children:[P.jsx(Gt,{svg:RE,title:"Move Up",onClick:this.moveUp,small:!0},void 0),P.jsx(Gt,{svg:kE,title:"Move Down",onClick:this.moveDown,small:!0},void 0),P.jsx(Gt,{svg:iu,title:"Remove",onClick:this.remove,small:!0},void 0)]},void 0)]}),void 0),this.state.isExpanded&&P.jsx("div",E({className:"msp-control-offset"},{children:P.jsx(kie,{params:this.props.param.element,apply:this.update,value:this.props.value,isUpdate:!0,isDisabled:this.props.isDisabled},void 0)}),void 0)]},void 0)},t}(_e.PureComponent),ZF=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isExpanded:!1},r.add=function(n){r.change(Nt(Nt([],r.props.value),[n]))},r.actions={update:function(n,i){var a=r.props.value.slice(0);a[i]=n,r.change(a)},move:function(n,i){var a=r.props.value;if(a.length!==1){var o=(n+i)%a.length;o<0&&(o+=a.length),a=a.slice(0);var s=a[n];a[n]=a[o],a[o]=s,r.change(a)}},remove:function(n){for(var i=r.props.value,a=[],o=0;o<i.length;o++)n!==o&&a.push(i[o]);r.change(a)}},r.toggleExpanded=function(n){r.setState({isExpanded:!r.state.isExpanded}),n.currentTarget.blur()},r}return t.prototype.change=function(r){this.props.onChange({name:this.props.name,param:this.props.param,value:r})},t.prototype.render=function(){var r=this,n=this.props.value,i=this.props.param.label||Wa(this.props.name),a=n.length+" item"+(n.length!==1?"s":"");return P.jsxs(P.Fragment,{children:[P.jsx(Zs,{label:i,control:P.jsx("button",E({onClick:this.toggleExpanded,disabled:this.props.isDisabled},{children:a}),void 0)},void 0),this.state.isExpanded&&P.jsxs("div",E({className:"msp-control-offset"},{children:[this.props.value.map(function(o,s){return P.jsx(mat,{param:r.props.param,value:o,index:s,actions:r.actions,isDisabled:r.props.isDisabled},s)}),P.jsx(zc,E({header:"New Item"},{children:P.jsx(kie,{params:this.props.param.element,apply:this.add,value:this.props.param.ctor(),isDisabled:this.props.isDisabled},void 0)}),void 0)]}),void 0)]},void 0)},t}(_e.PureComponent),gat=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.onChangeCondition=function(n){r.change(r.props.param.conditionedValue(r.props.value,n.value))},r.onChangeParam=function(n){r.change(n.value)},r}return t.prototype.change=function(r){this.props.onChange({name:this.props.name,param:this.props.param,value:r})},t.prototype.render=function(){var r=this.props.value,n=this.props.param.conditionForValue(r),i=this.props.param.conditionParams[n],a=this.props.param.label||Wa(this.props.name),o=j2(i),s=P.jsx(KF,{param:this.props.param.select,isDisabled:this.props.isDisabled,onChange:this.onChangeCondition,onEnter:this.props.onEnter,name:a+" Kind",value:n},void 0);return o?P.jsxs(P.Fragment,{children:[s,P.jsx(o,{param:i,value:r,name:a,onChange:this.onChangeParam,onEnter:this.props.onEnter,isDisabled:this.props.isDisabled},void 0)]},void 0):s},t}(_e.PureComponent),yat=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.onChange=function(n){r.props.onChange({name:r.props.name,param:r.props.param,value:r.props.param.toValue(n.value)})},r}return t.prototype.render=function(){var r=this.props.param.fromValue(this.props.value),n=j2(this.props.param.converted);return n?P.jsx(n,{param:this.props.param.converted,value:r,name:this.props.name,onChange:this.onChange,onEnter:this.props.onEnter,isDisabled:this.props.isDisabled},void 0):null},t}(_e.PureComponent),bat=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.onChange=function(n){var i=n.target.value;i!==r.props.value.expression&&r.update({language:r.props.value.language,expression:i})},r.onKeyPress=function(n){(n.keyCode===13||n.charCode===13||n.key==="Enter")&&r.props.onEnter&&r.props.onEnter(),n.stopPropagation()},r}return t.prototype.renderControl=function(){var r=this.props.param.label||Wa(this.props.name);return P.jsx("input",{type:"text",value:this.props.value.expression||"",placeholder:r,onChange:this.onChange,onKeyPress:this.props.onEnter?this.onKeyPress:void 0,disabled:this.props.isDisabled},void 0)},t}(fm),xat=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.updateParams=function(n){var i;r.plugin.managers.animation.updateParams((i={},i[n.name]=n.value,i))},r.updateCurrentParams=function(n){var i;r.plugin.managers.animation.updateCurrentParams((i={},i[n.name]=n.value,i))},r.startOrStop=function(){var n=r.plugin.managers.animation;n.state.animationState==="playing"?n.stop():(r.props.onStart&&r.props.onStart(),n.start())},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.managers.animation.events.updated,function(){return r.forceUpdate()})},t.prototype.render=function(){var r,n,i=this.plugin.managers.animation;if(i.isEmpty)return null;var a=i.state.animationState==="playing",o=(n=(r=i.current.anim).canApply)===null||n===void 0?void 0:n.call(r,this.plugin);return P.jsxs(P.Fragment,{children:[P.jsx(Vn,{params:i.getParams(),values:i.state.params,onChange:this.updateParams,isDisabled:a},void 0),P.jsx(Vn,{params:i.current.params,values:i.current.paramValues,onChange:this.updateCurrentParams,isDisabled:a},void 0),P.jsx("div",E({className:"msp-flex-row"},{children:P.jsx(yr,E({icon:i.state.animationState!=="playing"?void 0:LZ,onClick:this.startOrStop,disabled:o!==void 0&&o.canApply===!1},{children:i.state.animationState==="playing"?"Stop":o===void 0||o.canApply?"Start":o.reason||"Start"}),void 0)}),void 0)]},void 0)},t}(br),Oie="overpaint-controls";function JH(e,t,r,n,i){return ce(this,void 0,void 0,function(){var a=this;return de(this,function(o){switch(o.label){case 0:return[4,Sat(e,t,function(s,u,l){return ce(a,void 0,void 0,function(){var c,d,f,h,v,v;return de(this,function(p){switch(p.label){case 0:return i&&i.length>0&&!i.includes(u.params.values.type.name)?[2]:(c=u.obj.data.sourceData,[4,n(c.root)]);case 1:return d=p.sent(),sr.isEmpty(d)?[2]:(f={bundle:on.fromLoci(d),color:r===-1?at(0):r,clear:r===-1},l?(h=Nt(Nt([],l.params.values.layers),[f]),v=eG(h,c),s.to(l).update(Xi.toBundle(v))):(v=eG([f],c),s.to(u.transform.ref).apply(rt.Representation.OverpaintStructureRepresentation3DFromBundle,Xi.toBundle(v),{tags:Oie})),[2])}})})})];case 1:return o.sent(),[2]}})})}function Sat(e,t,r){return ce(this,void 0,void 0,function(){var n,i,a,o,s,u,l,c,d;return de(this,function(f){switch(f.label){case 0:n=e.state.data,i=n.build(),a=0,o=t,f.label=1;case 1:if(!(a<o.length))return[3,6];s=o[a],u=0,l=s.representations,f.label=2;case 2:return u<l.length?(c=l[u],d=n.select(or.Generators.ofTransformer(rt.Representation.OverpaintStructureRepresentation3DFromBundle,c.cell.transform.ref).withTag(Oie)),[4,r(i,c.cell,d[0])]):[3,5];case 3:f.sent(),f.label=4;case 4:return u++,[3,2];case 5:return a++,[3,1];case 6:return[2,i.commit({doNotUpdateCurrent:!0})]}})})}function eG(e,t){var r=Xi.ofBundle(e,t.root),n=Xi.merge(r);return Xi.filter(n,t)}var Fie="clipping-controls";function Cat(e,t,r,n,i){return ce(this,void 0,void 0,function(){var a=this;return de(this,function(o){switch(o.label){case 0:return[4,_at(e,t,function(s,u,l){return ce(a,void 0,void 0,function(){var c,d,f,h,v,v;return de(this,function(p){switch(p.label){case 0:return i&&i.length>0&&!i.includes(u.params.values.type.name)?[2]:(c=u.obj.data.sourceData,[4,n(c.root)]);case 1:return d=p.sent(),sr.isEmpty(d)?[2]:(f={bundle:on.fromLoci(d),groups:r},l?(h=Nt(Nt([],l.params.values.layers),[f]),v=tG(h,c),s.to(l).update(ln.toBundle(v))):(v=tG([f],c),s.to(u.transform.ref).apply(rt.Representation.ClippingStructureRepresentation3DFromBundle,ln.toBundle(v),{tags:Fie})),[2])}})})})];case 1:return o.sent(),[2]}})})}function _at(e,t,r){return ce(this,void 0,void 0,function(){var n,i,a,o,s,u,l,c,d;return de(this,function(f){switch(f.label){case 0:n=e.state.data,i=n.build(),a=0,o=t,f.label=1;case 1:if(!(a<o.length))return[3,6];s=o[a],u=0,l=s.representations,f.label=2;case 2:return u<l.length?(c=l[u],d=n.select(or.Generators.ofTransformer(rt.Representation.ClippingStructureRepresentation3DFromBundle,c.cell.transform.ref).withTag(Fie)),[4,r(i,c.cell,d[0])]):[3,5];case 3:f.sent(),f.label=4;case 4:return u++,[3,2];case 5:return a++,[3,1];case 6:return[2,i.commit({doNotUpdateCurrent:!0})]}})})}function tG(e,t){var r=ln.ofBundle(e,t.root),n=ln.merge(r);return ln.filter(n,t)}var Lie="transparency-controls";function wat(e,t,r,n,i){return ce(this,void 0,void 0,function(){var a=this;return de(this,function(o){switch(o.label){case 0:return[4,Eat(e,t,function(s,u,l){return ce(a,void 0,void 0,function(){var c,d,f,h,v,v;return de(this,function(p){switch(p.label){case 0:return i&&i.length>0&&!i.includes(u.params.values.type.name)?[2]:(c=u.obj.data.sourceData,[4,n(c.root)]);case 1:return d=p.sent(),sr.isEmpty(d)?[2]:(f={bundle:on.fromLoci(d),value:r},l?(h=Nt(Nt([],l.params.values.layers),[f]),v=rG(h,c),s.to(l).update(Yi.toBundle(v))):(v=rG([f],c),s.to(u.transform.ref).apply(rt.Representation.TransparencyStructureRepresentation3DFromBundle,Yi.toBundle(v),{tags:Lie})),[2])}})})})];case 1:return o.sent(),[2]}})})}function Eat(e,t,r){return ce(this,void 0,void 0,function(){var n,i,a,o,s,u,l,c,d;return de(this,function(f){switch(f.label){case 0:n=e.state.data,i=n.build(),a=0,o=t,f.label=1;case 1:if(!(a<o.length))return[3,6];s=o[a],u=0,l=s.representations,f.label=2;case 2:return u<l.length?(c=l[u],d=n.select(or.Generators.ofTransformer(rt.Representation.TransparencyStructureRepresentation3DFromBundle,c.cell.transform.ref).withTag(Lie)),[4,r(i,c.cell,d[0])]):[3,5];case 3:f.sent(),f.label=4;case 4:return u++,[3,2];case 5:return a++,[3,1];case 6:return[2,i.commit({doNotUpdateCurrent:!0})]}})})}function rG(e,t){var r=Yi.ofBundle(e,t.root),n=Yi.merge(r);return Yi.filter(n,t)}var Vv=function(e){Le(t,e);function t(r){var n=e.call(this,{options:I.getDefaultValues(t.OptionsParams)})||this;return n.plugin=r,n.events={optionsUpdated:n.ev()},n}return Object.defineProperty(t.prototype,"currentStructures",{get:function(){return this.plugin.managers.structure.hierarchy.selection.structures},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"pivotStructure",{get:function(){return this.currentStructures[0]},enumerable:!1,configurable:!0}),t.prototype.setOptions=function(r){return ce(this,void 0,void 0,function(){var n,i,a,o,s,u,l,c,d=this;return de(this,function(f){for(n=r.interactions!==this.state.options.interactions,this.updateState({options:r}),this.events.optionsUpdated.next(),i=this.dataState.build(),a=0,o=this.currentStructures;a<o.length;a++)for(s=o[a],u=0,l=s.components;u<l.length;u++)c=l[u],this.updateReprParams(i,c);return[2,this.plugin.dataTransaction(function(){return ce(d,void 0,void 0,function(){return de(this,function(h){switch(h.label){case 0:return[4,i.commit()];case 1:return h.sent(),[4,this.plugin.state.updateBehavior(qF,function(v){v.ignoreHydrogens=!r.showHydrogens})];case 2:return h.sent(),n?[4,this.updateInterationProps()]:[3,4];case 3:h.sent(),h.label=4;case 4:return[2]}})})})]})})},t.prototype.updateReprParams=function(r,n){for(var i=this.state.options,a=i.showHydrogens,o=i.visualQuality,s=!a,u=0,l=n.representations;u<l.length;u++){var c=l[u];if(c.cell.transform.transformer===Ow){var d=c.cell.transform.params;(!!d.type.params.ignoreHydrogens!==s||d.type.params.quality!==o)&&r.to(c.cell).update(function(f){f.type.params.ignoreHydrogens=s,f.type.params.quality=o})}}},t.prototype.updateInterationProps=function(){var r,n,i;return ce(this,void 0,void 0,function(){var a,o,s,u,l,c,d,f=this;return de(this,function(h){switch(h.label){case 0:a=0,o=this.currentStructures,h.label=1;case 1:return a<o.length?(s=o[a],u=Kn.getParams((r=s.cell.obj)===null||r===void 0?void 0:r.data),s.properties?(l=(n=s.properties.cell.transform.params)===null||n===void 0?void 0:n.properties[Kn.descriptor.name],I.areEqual(u,l,this.state.options.interactions)?[3,5]:[4,this.dataState.build().to(s.properties.cell).update(function(v){v.properties[Kn.descriptor.name]=f.state.options.interactions}).commit()]):[3,3]):[3,6];case 2:return h.sent(),[3,5];case 3:return c=this.plugin.customStructureProperties.getParams((i=s.cell.obj)===null||i===void 0?void 0:i.data),d=I.getDefaultValues(c),I.areEqual(u,d.properties[Kn.descriptor.name],this.state.options.interactions)?[3,5]:(d.properties[Kn.descriptor.name]=this.state.options.interactions,[4,this.plugin.builders.structure.insertStructureProperties(s.cell,d)]);case 4:h.sent(),h.label=5;case 5:return a++,[3,1];case 6:return[2]}})})},t.prototype.applyPreset=function(r,n,i){var a=this;return this.plugin.dataTransaction(function(){return ce(a,void 0,void 0,function(){var o,s,u,l;return de(this,function(c){switch(c.label){case 0:o=0,s=r,c.label=1;case 1:return o<s.length?(u=s[o],[4,this.plugin.builders.structure.representation.applyPreset(u.cell,n,i)]):[3,5];case 2:return l=c.sent(),[4,this.syncPreset(u,l)];case 3:c.sent(),c.label=4;case 4:return o++,[3,1];case 5:return[2]}})})},{canUndo:"Preset"})},t.prototype.syncPreset=function(r,n){if(!n||!n.components)return this.clearComponents([r]);var i=new Set;if($u(n.components,function(y){y&&i.add(y.ref)}),n.representations&&$u(n.representations,function(y){y&&i.add(y.ref)}),i.size===0)return this.clearComponents([r]);for(var a=!1,o=this.dataState.build(),s=function(y){i.has(y.cell.transform.ref)||(a=!0,o.delete(y.cell))},u=0,l=r.components;u<l.length;u++){var c=l[u];s(c);for(var d=0,f=c.representations;d<f.length;d++){var h=f[d];s(h)}if(c.genericRepresentations)for(var v=0,p=c.genericRepresentations;v<p.length;v++){var h=p[v];s(h)}}if(r.genericRepresentations)for(var m=0,g=r.genericRepresentations;m<g.length;m++){var h=g[m];s(h)}if(a)return o.commit()},t.prototype.clear=function(r){return this.clearComponents(r)},t.prototype.selectThis=function(r){var n,i=this.plugin.managers.structure.selection;i.clear();for(var a=0,o=r;a<o.length;a++){var s=o[a],u=We.toSubStructureElementLoci(s.structure.cell.obj.data,(n=s.cell.obj)===null||n===void 0?void 0:n.data);i.fromLoci("set",u)}},t.prototype.canBeModified=function(r){return this.plugin.builders.structure.isComponentTransform(r.cell)},t.prototype.modifyByCurrentSelection=function(r,n){var i=this;return this.plugin.runTask($e.create("Modify Component",function(a){return ce(i,void 0,void 0,function(){var o,s,u,l,c;return de(this,function(d){switch(d.label){case 0:for(o=this.dataState.build(),s=0,u=r;s<u.length;s++)l=u[s],this.canBeModified(l)&&(c=this.plugin.managers.structure.selection.getStructure(l.structure.cell.obj.data),!(!c||c.elementCount===0)&&this.modifyComponent(o,l,c,n));return[4,this.dataState.updateTree(o,{canUndo:"Modify Selection"}).runInContext(a)];case 1:return d.sent(),[2]}})})}))},t.prototype.toggleVisibility=function(r,n){if(r.length!==0)if(n)for(var u=r[0].representations.indexOf(n),i=!n.cell.state.isHidden,l=0,c=r;l<c.length;l++){var s=c[l],d=s.representations[u];d&&jv(this.dataState,d.cell.transform.ref,i)}else for(var i=!r[0].cell.state.isHidden,a=0,o=r;a<o.length;a++){var s=o[a];jv(this.dataState,s.cell.transform.ref,i)}},t.prototype.removeRepresentations=function(r,n){if(r.length!==0){var i=[];if(n){var a=r[0].representations.indexOf(n);if(a<0)return;for(var o=0,s=r;o<s.length;o++){var u=s[o];u.representations[a]&&i.push(u.representations[a])}}else for(var l=0,c=r;l<c.length;l++)for(var u=c[l],d=0,f=u.representations;d<f.length;d++){var h=f[d];i.push(h)}return this.plugin.managers.structure.hierarchy.remove(i,!0)}},t.prototype.updateRepresentations=function(r,n,i){if(r.length===0)return Promise.resolve();var a=r[0].representations.indexOf(n);if(a<0)return Promise.resolve();for(var o=this.dataState.build(),s=0,u=r;s<u.length;s++){var l=u[s],c=l.representations[a];c&&c.cell.transform.transformer===n.cell.transform.transformer&&o.to(c.cell).update(i)}return o.commit({canUndo:"Update Representation"})},t.prototype.updateRepresentationsTheme=function(r,n){var i,a,o,s;if(r.length!==0){for(var u=this.dataState.build(),l=0,c=r;l<c.length;l++)for(var d=c[l],f=function(g){var y=g.cell.transform.params,b=typeof n=="function"?n(d,g):n,S=b.color==="default"?RR(h.plugin,(i=d.structure.cell.obj)===null||i===void 0?void 0:i.data,y==null?void 0:y.type.name):b.color?RR(h.plugin,(a=d.structure.cell.obj)===null||a===void 0?void 0:a.data,y==null?void 0:y.type.name,b.color,b.colorParams):void 0,x=b.size==="default"?xH(h.plugin,(o=d.structure.cell.obj)===null||o===void 0?void 0:o.data,y==null?void 0:y.type.name):b.color?xH(h.plugin,(s=d.structure.cell.obj)===null||s===void 0?void 0:s.data,y==null?void 0:y.type.name,b.size,b.sizeParams):void 0;(S||x)&&u.to(g.cell).update(function(C){S&&(C.colorTheme=S),x&&(C.sizeTheme=x)})},h=this,v=0,p=d.representations;v<p.length;v++){var m=p[v];f(m)}return u.commit({canUndo:"Update Theme"})}},t.prototype.addRepresentation=function(r,n){var i=this;if(r.length!==0){var a=this.state.options,o=a.showHydrogens,s=a.visualQuality,u=!o,l={ignoreHydrogens:u,quality:s};return this.plugin.dataTransaction(function(){return ce(i,void 0,void 0,function(){var c,d,f;return de(this,function(h){switch(h.label){case 0:c=0,d=r,h.label=1;case 1:return c<d.length?(f=d[c],[4,this.plugin.builders.structure.representation.addRepresentation(f.cell,{type:this.plugin.representation.structure.registry.get(n),typeParams:l})]):[3,4];case 2:h.sent(),h.label=3;case 3:return c++,[3,1];case 4:return[2]}})})},{canUndo:"Add Representation"})}},t.prototype.tryFindComponent=function(r,n){var i=this;if(r.components.length!==0)return this.plugin.runTask($e.create("Find Component",function(a){return ce(i,void 0,void 0,function(){var o,s,u,l,c,d,f,h,v,p;return de(this,function(m){switch(m.label){case 0:return o=(v=r.cell.obj)===null||v===void 0?void 0:v.data,o?(l=(u=mt).unionStructure,[4,n.getSelection(this.plugin,a,o)]):[2];case 1:for(s=l.apply(u,[m.sent()]),c=0,d=r.components;c<d.length;c++)if(f=d[c],h=(p=f.cell.obj)===null||p===void 0?void 0:p.data,!(!h||!f.cell.parent)&&eBe(s,h))return[2,f.cell];return[2]}})})}))},t.prototype.add=function(r,n){return ce(this,void 0,void 0,function(){var i=this;return de(this,function(a){return[2,this.plugin.dataTransaction(function(){return ce(i,void 0,void 0,function(){var o,s,u,l,c,d,f,h,v,p,m;return de(this,function(g){switch(g.label){case 0:if(o=n||this.currentStructures,o.length===0)return[2];s=this.state.options,u=s.showHydrogens,l=s.visualQuality,c=!u,d={ignoreHydrogens:c,quality:l},f=bn.create22(),h=0,v=o,g.label=1;case 1:return h<v.length?(p=v[h],m=void 0,r.options.checkExisting?[4,this.tryFindComponent(p,r.selection)]:[3,3]):[3,8];case 2:m=g.sent(),g.label=3;case 3:return m?[3,5]:[4,this.plugin.builders.structure.tryCreateComponentFromSelection(p.cell,r.selection,f,{label:r.options.label||(r.selection===bi.current?"Custom Selection":"")})];case 4:m=g.sent(),g.label=5;case 5:return r.representation==="none"||!m?[3,7]:[4,this.plugin.builders.structure.representation.addRepresentation(m,{type:this.plugin.representation.structure.registry.get(r.representation),typeParams:d})];case 6:g.sent(),g.label=7;case 7:return h++,[3,1];case 8:return[2]}})})},{canUndo:"Add Selection"})]})})},t.prototype.applyTheme=function(r,n){return ce(this,void 0,void 0,function(){var i=this;return de(this,function(a){return[2,this.plugin.dataTransaction(function(o){return ce(i,void 0,void 0,function(){var s,u,l,c,d,f,f,f,h=this;return de(this,function(v){switch(v.label){case 0:if(s=n||this.currentStructures,s.length===0)return[2];u=function(p){return ce(h,void 0,void 0,function(){var m,g;return de(this,function(y){switch(y.label){case 0:return g=(m=mt).toLociWithSourceUnits,[4,r.selection.getSelection(this.plugin,o,p)];case 1:return[2,g.apply(m,[y.sent()])]}})})},l=0,c=s,v.label=1;case 1:return l<c.length?(d=c[l],r.action.name!=="reset"?[3,3]:[4,JH(this.plugin,d.components,-1,u,r.representations)]):[3,10];case 2:return v.sent(),[3,9];case 3:return r.action.name!=="color"?[3,5]:(f=r.action.params,[4,JH(this.plugin,d.components,f.color,u,r.representations)]);case 4:return v.sent(),[3,9];case 5:return r.action.name!=="transparency"?[3,7]:(f=r.action.params,[4,wat(this.plugin,d.components,f.value,u,r.representations)]);case 6:return v.sent(),[3,9];case 7:return r.action.name!=="clipping"?[3,9]:(f=r.action.params,[4,Cat(this.plugin,d.components,ln.Groups.fromNames(f.excludeGroups),u,r.representations)]);case 8:v.sent(),v.label=9;case 9:return l++,[3,1];case 10:return[2]}})})},{canUndo:"Apply Theme"})]})})},t.prototype.modifyComponent=function(r,n,i,a){var o,s,u,l=(o=n.cell.obj)===null||o===void 0?void 0:o.data;if(l&&!((a==="subtract"||a==="intersect")&&!ZE(l,i))){var c=(s=n.structure.cell.obj)===null||s===void 0?void 0:s.data,d=a==="union"?Zb(c,[l,i]):a==="intersect"?hee(l,i):oF(l,i);if(d.elementCount===0)r.delete(n.cell.transform.ref);else{var f=on.fromSubStructure(c,d),h={type:{name:"bundle",params:f},nullIfEmpty:!0,label:(u=n.cell.obj)===null||u===void 0?void 0:u.label};r.to(n.cell).update(h)}}},t.prototype.updateLabel=function(r,n){var i,a,o={type:(i=r.cell.params)===null||i===void 0?void 0:i.values.type,nullIfEmpty:(a=r.cell.params)===null||a===void 0?void 0:a.values.nullIfEmpty,label:n};this.dataState.build().to(r.cell).update(o).commit()},Object.defineProperty(t.prototype,"dataState",{get:function(){return this.plugin.state.data},enumerable:!1,configurable:!0}),t.prototype.clearComponents=function(r){for(var n=this.dataState.build(),i=0,a=r;i<a.length;i++)for(var o=a[i],s=0,u=o.components;s<u.length;s++){var l=u[s];n.delete(l.cell.transform.ref)}return n.commit({canUndo:"Clear Selections"})},t}(Wd);(function(e){e.OptionsParams={showHydrogens:I.Boolean(!0,{description:"Toggle display of hydrogen atoms in representations"}),visualQuality:I.Select("auto",Y6,{description:"Control the visual/rendering quality of representations"}),interactions:I.Group(Kn.defaultParams,{label:"Non-covalent Interactions"})};function t(a,o){var s=a.query.structure.registry.options;return o=E({pivot:a.managers.structure.component.pivotStructure,allowNone:!0,hideSelection:!1,checkExisting:!1},o),{selection:I.Select(s[1][0],s,{isHidden:o==null?void 0:o.hideSelection}),representation:i(a,o==null?void 0:o.pivot,o!=null&&o.allowNone?[["none","< Create Later >"]]:[]),options:I.Group({label:I.Text(""),checkExisting:I.Boolean(!!(o!=null&&o.checkExisting),{help:function(){return{description:"Checks if a selection with the specifield elements already exists to avoid creating duplicate components."}}})})}}e.getAddParams=t;function r(a,o){var s=a.query.structure.registry.options;return{selection:I.Select(s[1][0],s,{isHidden:!1}),action:I.MappedStatic("color",{color:I.Group({color:I.Color(pr.blue,{isExpanded:!0})},{isFlat:!0}),reset:I.EmptyGroup({label:"Reset Color"}),transparency:I.Group({value:I.Numeric(.5,{min:0,max:1,step:.01})},{isFlat:!0}),clipping:I.Group({excludeGroups:I.MultiSelect([],I.objectToOptions(ln.Groups.Names))},{isFlat:!0})}),representations:I.MultiSelect([],n(a,o),{emptyValue:"All"})}}e.getThemeParams=r;function n(a,o){var s,u;return!((s=o==null?void 0:o.cell.obj)===null||s===void 0)&&s.data?a.representation.structure.registry.getApplicableTypes((u=o.cell.obj)===null||u===void 0?void 0:u.data):a.representation.structure.registry.types}e.getRepresentationTypes=n;function i(a,o,s,u){var l=Nt(Nt([],s),n(a,o));return I.Select(l[0][0],l,{label:u})}})(Vv||(Vv={}));var Y1;(function(e){function t(a,o){return{key:a,data:o}}function r(a){return{entries:SD(),capacity:Math.max(1,a)}}e.create=r;function n(a,o){for(var s=a.entries.first;s;s=s.next)if(s.value.key===o)return a.entries.remove(s),a.entries.addLast(s.value),s.value.data}e.get=n;function i(a,o,s){var u=void 0;if(a.entries.count>=a.capacity){var l=a.entries.first;u=l.value.data,a.entries.remove(l)}return a.entries.addLast(t(o,s)),u}e.set=i})(Y1||(Y1={}));var Ga=function(e){Le(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t}(ge.CreateBehavior({name:"Volume Streaming"}));(function(e){e.RootTag="volume-streaming-info";function t(o,s,u,l,c){var d,f,h,v;return c===void 0&&(c={}),I.Group({isoValue:Ct.createIsoValueParam((d=c.isoValue)!==null&&d!==void 0?d:u,l),color:I.Color((f=c.color)!==null&&f!==void 0?f:s),wireframe:I.Boolean((h=c.wireframe)!==null&&h!==void 0?h:!1),opacity:I.Numeric((v=c.opacity)!==null&&v!==void 0?v:.3,{min:0,max:1,step:.01})},{label:o,isExpanded:!0})}var r={byteOffset:0,rate:1,sampleCount:[1,1,1],valuesInfo:[{mean:0,min:-1,max:1,sigma:.1},{mean:0,min:-1,max:1,sigma:.1}]};function n(o){o===void 0&&(o={});var s=o.data,u=o.defaultView,l=o.channelParams,c=new Map;s&&s.entries.forEach(function(h){return c.set(h.dataId,h)});var d=s?s.entries.map(function(h){return[h.dataId,h.dataId]}):[],f=s?s.entries[0].dataId:"";return{entry:I.Mapped(f,d,function(h){return I.Group(i({entryData:c.get(h),defaultView:u,structure:s&&s.structure,channelParams:l}))})}}e.createParams=n;function i(o){var s=o.entryData,u=o.defaultView,l=o.structure,c=o.channelParams,d=c===void 0?{}:c,f=s||{kind:"em",header:{sampling:[r],availablePrecisions:[{precision:0,maxVoxels:0}]},emDefaultContourLevel:Ct.IsoValue.relative(0)},h=l&&l.boundary.box||Kt();return{view:I.MappedStatic(u||(f.kind==="em"?"cell":"selection-box"),{off:I.Group({}),box:I.Group({bottomLeft:I.Vec3(h.min),topRight:I.Vec3(h.max)},{description:"Static box defined by cartesian coords.",isFlat:!0}),"selection-box":I.Group({radius:I.Numeric(5,{min:0,max:50,step:.5},{description:"Radius in  within which the volume is shown."}),bottomLeft:I.Vec3(_.create(0,0,0),{},{isHidden:!0}),topRight:I.Vec3(_.create(0,0,0),{},{isHidden:!0})},{description:"Box around focused element.",isFlat:!0}),cell:I.Group({}),auto:I.Group({radius:I.Numeric(5,{min:0,max:50,step:.5},{description:"Radius in  within which the volume is shown."}),selectionDetailLevel:I.Select(Math.min(6,f.header.availablePrecisions.length-1),f.header.availablePrecisions.map(function(v,p){return[p,p+1+" [ "+(Math.pow(v.maxVoxels,1/3)|0)+"^3 cells ]"]}),{label:"Selection Detail",description:"Determines the maximum number of voxels. Depending on the size of the volume options are in the range from 0 (0.52M voxels) to 6 (25.17M voxels)."}),isSelection:I.Boolean(!1,{isHidden:!0}),bottomLeft:I.Vec3(h.min,{},{isHidden:!0}),topRight:I.Vec3(h.max,{},{isHidden:!0})},{description:"Box around focused element.",isFlat:!0})},{options:e.ViewTypeOptions,description:'Controls what of the volume is displayed. "Off" hides the volume alltogether. "Bounded box" shows the volume inside the given box. "Around Interaction" shows the volume around the focused element/atom. "Whole Structure" shows the volume for the whole structure.'}),detailLevel:I.Select(Math.min(3,f.header.availablePrecisions.length-1),f.header.availablePrecisions.map(function(v,p){return[p,p+1+" [ "+(Math.pow(v.maxVoxels,1/3)|0)+"^3 cells ]"]}),{description:"Determines the maximum number of voxels. Depending on the size of the volume options are in the range from 0 (0.52M voxels) to 6 (25.17M voxels)."}),channels:f.kind==="em"?I.Group({em:t("EM",at(6524815),f.emDefaultContourLevel||Ct.IsoValue.relative(1),f.header.sampling[0].valuesInfo[0],d.em)},{isFlat:!0}):I.Group({"2fo-fc":t("2Fo-Fc",at(3367602),Ct.IsoValue.relative(1.5),f.header.sampling[0].valuesInfo[0],d["2fo-fc"]),"fo-fc(+ve)":t("Fo-Fc(+ve)",at(3390259),Ct.IsoValue.relative(3),f.header.sampling[0].valuesInfo[1],d["fo-fc(+ve)"]),"fo-fc(-ve)":t("Fo-Fc(-ve)",at(12268339),Ct.IsoValue.relative(-3),f.header.sampling[0].valuesInfo[1],d["fo-fc(-ve)"])},{isFlat:!0})}}e.createEntryParams=i,e.ViewTypeOptions=[["off","Off"],["box","Bounded Box"],["selection-box","Around Focus"],["cell","Whole Structure"],["auto","Auto"]],e.ChannelTypeOptions=[["em","em"],["2fo-fc","2fo-fc"],["fo-fc(+ve)","fo-fc(+ve)"],["fo-fc(-ve)","fo-fc(-ve)"]];var a=function(o){Le(s,o);function s(u,l){var c=o.call(this,u,{})||this;return c.plugin=u,c.data=l,c.cache=Y1.create(25),c.params={},c.lastLoci=jr,c.ref="",c.channels={},c._invTransform=ue(),c.infoMap=new Map,c.data.entries.forEach(function(d){return c.infoMap.set(d.dataId,d)}),c}return Object.defineProperty(s.prototype,"info",{get:function(){return this.infoMap.get(this.params.entry.name)},enumerable:!1,configurable:!0}),s.prototype.queryData=function(u){return ce(this,void 0,void 0,function(){var l,c,d,f,h,v,p,m,g;return de(this,function(y){switch(y.label){case 0:return l=wA(this.data.serverUrl,this.info.kind+"/"+this.info.dataId.toLowerCase()),u?(c=u.min,d=u.max,l+="/box"+("/"+c.map(function(b){return Math.round(1e3*b)/1e3}).join(","))+("/"+d.map(function(b){return Math.round(1e3*b)/1e3}).join(","))):l+="/cell",f=this.params.entry.params.detailLevel,this.params.entry.params.view.name==="auto"&&this.params.entry.params.view.params.isSelection&&(f=this.params.entry.params.view.params.selectionDetailLevel),l+="?detail="+f,h=Y1.get(this.cache,l),h?[2,h.data]:(v=Mn.getUrlAsset(this.plugin.managers.asset,l),[4,this.plugin.runTask(this.plugin.managers.asset.resolve(v,"binary"))]);case 1:return p=y.sent(),[4,this.parseCif(p.data)];case 2:return m=y.sent(),m?(g=Y1.set(this.cache,l,{data:m,asset:p}),g&&g.asset.dispose(),[2,m]):[2]}})})},s.prototype.parseCif=function(u){return ce(this,void 0,void 0,function(){var l,c,d,f,h,v;return de(this,function(p){switch(p.label){case 0:return[4,this.plugin.runTask(vd.parseBinary(u))];case 1:if(l=p.sent(),l.isError)return this.plugin.log.error("VolumeStreaming, parsing CIF: "+l.toString()),[2];if(l.result.blocks.length<2)return this.plugin.log.error("VolumeStreaming: Invalid data."),[2];c={},d=1,p.label=2;case 2:return d<l.result.blocks.length?(f=l.result.blocks[d],h=vd.schema.densityServer(f),[4,this.plugin.runTask(Ote(h))]):[3,5];case 3:v=p.sent(),c[f.header]=v,p.label=4;case 4:return d++,[3,2];case 5:return[2,c]}})})},s.prototype.updateSelectionBoxParams=function(u){if(this.params.entry.params.view.name==="selection-box"){var l=this.plugin.state.data,c=E(E({},this.params),{entry:{name:this.params.entry.name,params:E(E({},this.params.entry.params),{view:{name:"selection-box",params:{radius:this.params.entry.params.view.params.radius,bottomLeft:u.min,topRight:u.max}}})}}),d=l.build().to(this.ref).update(c);_t.State.Update(this.plugin,{state:l,tree:d,options:{doNotUpdateCurrent:!0}})}},s.prototype.updateAutoParams=function(u,l){if(this.params.entry.params.view.name==="auto"){var c=this.plugin.state.data,d=E(E({},this.params),{entry:{name:this.params.entry.name,params:E(E({},this.params.entry.params),{view:{name:"auto",params:{radius:this.params.entry.params.view.params.radius,selectionDetailLevel:this.params.entry.params.view.params.selectionDetailLevel,isSelection:l,bottomLeft:(u==null?void 0:u.min)||_.zero(),topRight:(u==null?void 0:u.max)||_.zero()}}})}}),f=c.build().to(this.ref).update(d);_t.State.Update(this.plugin,{state:c,tree:f,options:{doNotUpdateCurrent:!0}})}},s.prototype.getStructureRoot=function(){return this.plugin.state.data.select(or.Generators.byRef(this.ref).rootOfType(ge.Molecule.Structure))[0]},s.prototype.register=function(u){var l=this;this.ref=u,this.subscribeObservable(this.plugin.state.events.object.removed,function(c){!ge.Molecule.Structure.is(c.obj)||!Re.is(l.lastLoci)||l.lastLoci.structure===c.obj.data&&(l.lastLoci=jr)}),this.subscribeObservable(this.plugin.state.events.object.updated,function(c){!ge.Molecule.Structure.is(c.oldObj)||!Re.is(l.lastLoci)||l.lastLoci.structure===c.oldObj.data&&(l.lastLoci=jr)}),this.subscribeObservable(this.plugin.managers.structure.focus.behaviors.current,function(c){if(l.plugin.state.data.tree.children.has(l.ref)){var d=c?c.loci:jr;switch(l.params.entry.params.view.name){case"auto":l.updateAuto(d);break;case"selection-box":l.updateSelectionBox(d);break;default:l.lastLoci=d;break}}})},s.prototype.unregister=function(){for(var u=this.cache.entries.first;u;)u.value.data.asset.dispose(),u=u.next},s.prototype.getBoxFromLoci=function(u){var l,c,d;if(sr.isEmpty(u))return Kt();var f=this.plugin.helpers.substructureParent.get(u.structure,!0);if(!f)return Kt();var h=this.getStructureRoot();if(!h||((l=h.obj)===null||l===void 0?void 0:l.data)!==((c=f.obj)===null||c===void 0?void 0:c.data))return Kt();var v=iv.get((d=h.obj)===null||d===void 0?void 0:d.data.models[0]);v&&ue.invert(this._invTransform,v);var p=Re.extendToWholeResidues(u),m=Re.getBoundary(p,v&&!Number.isNaN(this._invTransform[0])?this._invTransform:void 0).box;return Re.size(p)===1&&Kt.expand(m,m,_.create(1,1,1)),m},s.prototype.updateAuto=function(u){if(this.lastLoci=u,Nu(u)){this.updateAutoParams(this.info.kind==="x-ray"?this.data.structure.boundary.box:void 0,!1);return}var l=this.getBoxFromLoci(u);this.updateAutoParams(l,!0)},s.prototype.updateSelectionBox=function(u){if(sr.areEqual(this.lastLoci,u)){this.lastLoci=jr,this.updateSelectionBoxParams(Kt());return}if(this.lastLoci=u,Nu(u)){this.updateSelectionBoxParams(Kt());return}var l=this.getBoxFromLoci(u);this.updateSelectionBoxParams(l)},s.prototype.update=function(u){return ce(this,void 0,void 0,function(){var l,c,d,f,f,h,v,p;return de(this,function(m){switch(m.label){case 0:switch(l=u.entry.params.view.name==="selection-box"&&this.params&&this.params.entry&&this.params.entry.params&&this.params.entry.params.view&&this.params.entry.params.view.name!=="selection-box",this.params=u,c=void 0,d=!1,u.entry.params.view.name){case"off":d=!0;break;case"box":c=Kt.create(u.entry.params.view.params.bottomLeft,u.entry.params.view.params.topRight),d=Kt.volume(c)<1e-4;break;case"selection-box":{l?c=this.getBoxFromLoci(this.lastLoci)||Kt():c=Kt.create(_.clone(u.entry.params.view.params.bottomLeft),_.clone(u.entry.params.view.params.topRight)),f=u.entry.params.view.params.radius,d=Kt.volume(c)<1e-4,Kt.expand(c,c,_.create(f,f,f));break}case"cell":c=this.info.kind==="x-ray"?this.data.structure.boundary.box:void 0;break;case"auto":c=u.entry.params.view.params.isSelection||this.info.kind==="x-ray"?Kt.create(_.clone(u.entry.params.view.params.bottomLeft),_.clone(u.entry.params.view.params.topRight)):void 0,c&&(d=Kt.volume(c)<1e-4,u.entry.params.view.params.isSelection&&(f=u.entry.params.view.params.radius,Kt.expand(c,c,_.create(f,f,f))));break}return d?(v={},[3,3]):[3,1];case 1:return[4,this.queryData(c)];case 2:v=m.sent(),m.label=3;case 3:return h=v,h?(p=u.entry.params.channels,this.info.kind==="x-ray"?(this.channels["2fo-fc"]=this.createChannel(h["2FO-FC"]||Ct.One,p["2fo-fc"],this.info.header.sampling[0].valuesInfo[0]),this.channels["fo-fc(+ve)"]=this.createChannel(h["FO-FC"]||Ct.One,p["fo-fc(+ve)"],this.info.header.sampling[0].valuesInfo[1]),this.channels["fo-fc(-ve)"]=this.createChannel(h["FO-FC"]||Ct.One,p["fo-fc(-ve)"],this.info.header.sampling[0].valuesInfo[1])):this.channels.em=this.createChannel(h.EM||Ct.One,p.em,this.info.header.sampling[0].valuesInfo[0]),[2,!0]):[2,!1]}})})},s.prototype.createChannel=function(u,l,c){var d=l;return{data:u,color:d.color,wireframe:d.wireframe,opacity:d.opacity,isoValue:d.isoValue.kind==="relative"?d.isoValue:Ct.IsoValue.toRelative(d.isoValue,c)}},s.prototype.getDescription=function(){return this.params.entry.params.view.name==="selection-box"?"Selection":this.params.entry.params.view.name==="box"?"Static Box":this.params.entry.params.view.name==="cell"?"Cell":""},s}(Nr.WithSubscribers);e.Behavior=a})(Ga||(Ga={}));function Aat(e,t){var r=Nat(e,t||JF());return zat(e.tree,r),t&&t.refs.forEach(Uat,r),{hierarchy:r.hierarchy,added:r.added,changed:r.changed}}function JF(){return{trajectories:[],models:[],structures:[],refs:new Map}}function Pat(e){return{kind:"trajectory",cell:e,version:e.transform.version,models:[]}}function nG(e,t){return{kind:"model",cell:e,version:e.transform.version,trajectory:t,structures:[]}}function Tat(e,t){return{kind:"model-properties",cell:e,version:e.transform.version,model:t}}function Iat(e,t){return{kind:"model-unitcell",cell:e,version:e.transform.version,model:t}}function iG(e,t){return{kind:"structure",cell:e,version:e.transform.version,model:t,components:[]}}function Mat(e,t){return{kind:"structure-properties",cell:e,version:e.transform.version,structure:t}}function Dat(e,t){return{kind:"structure-transform",cell:e,version:e.transform.version,structure:t}}function Rat(e,t){return{kind:"structure-volume-streaming",cell:e,version:e.transform.version,structure:t}}function kat(e){return e.transform.tags?Nt([],e.transform.tags).sort().join():e.transform.ref}function Oat(e,t){return{kind:"structure-component",cell:e,version:e.transform.version,structure:t,key:kat(e),representations:[]}}function Fat(e,t){return{kind:"structure-representation",cell:e,version:e.transform.version,component:t}}function Lat(e,t){return{kind:"generic-representation",cell:e,version:e.transform.version,parent:t}}function Nat(e,t){return{state:e,oldHierarchy:t,hierarchy:JF(),changed:!1,added:new Set}}function Bm(e,t,r,n){for(var i=[],a=4;a<arguments.length;a++)i[a-4]=arguments[a];var o=n.apply(void 0,i);r.push(o),e.hierarchy.refs.set(t.transform.ref,o);var s=e.oldHierarchy.refs.get(t.transform.ref);return s?s.version!==t.transform.version&&(e.changed=!0):(e.added.add(o.cell.transform.ref),e.changed=!0),o}function cp(e,t,r){for(var n=[],i=3;i<arguments.length;i++)n[i-3]=arguments[i];var a=r.apply(void 0,n);e.hierarchy.refs.set(t.transform.ref,a);var o=e.oldHierarchy.refs.get(t.transform.ref);return o?o.version!==t.transform.version&&(e.changed=!0):(e.added.add(a.cell.transform.ref),e.changed=!0),a}function aG(e){return function(t){return e.is(t.obj)}}function oG(e,t){return function(r,n){return!t(n)&&e.is(r.obj)}}function SS(e){return function(t){return t.transform.transformer===e}}function dp(){}var Bat=[[aG(ge.Molecule.Trajectory),function(e,t){e.currentTrajectory=Bm(e,t,e.hierarchy.trajectories,Pat,t)},function(e){return e.currentTrajectory=void 0}],[oG(ge.Molecule.Model,function(e){return e.currentModel}),function(e,t){e.currentTrajectory?e.currentModel=Bm(e,t,e.currentTrajectory.models,nG,t,e.currentTrajectory):e.currentModel=cp(e,t,nG,t),e.hierarchy.models.push(e.currentModel)},function(e){return e.currentModel=void 0}],[SS(rt.Model.CustomModelProperties),function(e,t){if(!e.currentModel)return!1;e.currentModel.properties=cp(e,t,Tat,t,e.currentModel)},dp],[SS(rt.Representation.ModelUnitcell3D),function(e,t){if(!e.currentModel)return!1;e.currentModel.unitcell=cp(e,t,Iat,t,e.currentModel)},dp],[oG(ge.Molecule.Structure,function(e){return e.currentStructure}),function(e,t){e.currentModel?e.currentStructure=Bm(e,t,e.currentModel.structures,iG,t,e.currentModel):e.currentStructure=cp(e,t,iG,t),e.hierarchy.structures.push(e.currentStructure)},function(e){return e.currentStructure=void 0}],[SS(rt.Model.CustomStructureProperties),function(e,t){if(!e.currentStructure)return!1;e.currentStructure.properties=cp(e,t,Mat,t,e.currentStructure)},dp],[SS(rt.Model.TransformStructureConformation),function(e,t){if(!e.currentStructure)return!1;e.currentStructure.transform=cp(e,t,Dat,t,e.currentStructure)},dp],[aG(Ga),function(e,t){return e.currentStructure&&(e.currentStructure.volumeStreaming=cp(e,t,Rat,t,e.currentStructure)),!1},dp],[function(e,t){return t.currentComponent||!t.currentStructure||e.transform.transformer.definition.isDecorator?!1:ge.Molecule.Structure.is(e.obj)},function(e,t){e.currentStructure&&(e.currentComponent=Bm(e,t,e.currentStructure.components,Oat,t,e.currentStructure))},function(e){return e.currentComponent=void 0}],[function(e,t){return!e.state.isGhost&&!!t.currentComponent&&ge.Molecule.Structure.Representation3D.is(e.obj)},function(e,t){return e.currentComponent&&Bm(e,t,e.currentComponent.representations,Fat,t,e.currentComponent),!1},dp],[function(e){return!e.state.isGhost&&ge.isRepresentation3D(e.obj)},function(e,t){var r=e.currentComponent||e.currentStructure||e.currentModel;r&&(r.genericRepresentations||(r.genericRepresentations=[]),Bm(e,t,r.genericRepresentations,Lat,t,r))},dp]];function Nie(e){if(!e||!(e!=null&&e.parent)||!e.parent.cells.has(e.transform.ref))return!1;var t=e.obj;return!(!t||t===Nn.Null||e.status!=="ok"&&e.status!=="error")}function Uat(e){var t=e.cell;Nie(t)||(this.changed=!0)}function jat(e){Bie(this,this.tree.transforms.get(e))}function Bie(e,t){var r=e.state,n=r.state.cells.get(t.ref);if(Nie(n)){for(var i=void 0,a=!1,o=0,s=Bat;o<s.length;o++){var u=s[o],l=u[0],c=u[1],d=u[2];if(l(n,r)){var f=c(r,n);if(f===!1){a=!0;break}i=d;break}}if(!a){var h=e.tree.children.get(t.ref);h&&h.size&&h.forEach(jat,e),i&&i(r)}}}function zat(e,t){var r={tree:e,state:t};return Bie(r,e.root),r.state}var i2=function(e){Le(t,e);function t(r){var n=e.call(this)||this;return n.plugin=r,n.state={syncedTree:n.dataState.tree,notified:!1,hierarchy:JF(),selection:{trajectories:[],models:[],structures:[]}},n.behaviors={selection:n.ev.behavior({hierarchy:n.current,trajectories:n.selection.trajectories,models:n.selection.models,structures:n.selection.structures})},n._currentComponentGroups=void 0,n._currentSelectionSet=void 0,n.subscribe(r.state.data.events.changed,function(i){i.inTransaction||r.behaviors.state.isAnimating.value||n.sync(!0)}),n.subscribe(r.behaviors.state.isAnimating,function(i){!i&&!r.behaviors.state.isUpdating.value&&n.sync(!0)}),n}return Object.defineProperty(t.prototype,"dataState",{get:function(){return this.plugin.state.data},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"currentComponentGroups",{get:function(){return this._currentComponentGroups?this._currentComponentGroups:(this._currentComponentGroups=t.getComponentGroups(this.selection.structures),this._currentComponentGroups)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"seletionSet",{get:function(){if(this._currentSelectionSet)return this._currentSelectionSet;this._currentSelectionSet=new Set;for(var r=0,n=this.selection.trajectories;r<n.length;r++){var i=n[r];this._currentSelectionSet.add(i.cell.transform.ref)}for(var a=0,o=this.selection.models;a<o.length;a++){var i=o[a];this._currentSelectionSet.add(i.cell.transform.ref)}for(var s=0,u=this.selection.structures;s<u.length;s++){var i=u[s];this._currentSelectionSet.add(i.cell.transform.ref)}return this._currentSelectionSet},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"current",{get:function(){return this.sync(!1),this.state.hierarchy},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"selection",{get:function(){return this.sync(!1),this.state.selection},enumerable:!1,configurable:!0}),t.prototype.getStructuresWithSelection=function(){for(var r=this.plugin.managers.structure.hierarchy.current.structures,n=[],i=0,a=r;i<a.length;i++){var o=a[i];this.plugin.managers.structure.selection.structureHasSelection(o)&&n.push(o)}return n},t.prototype.syncCurrent=function(r,n){for(var i=this.seletionSet,a=[],o=0,s=r;o<s.length;o++){var u=s[o],l=u.cell.transform.ref;(i.has(l)||n.has(l))&&a.push(u)}return a.length===0?r.length>0?[r[0]]:[]:a},t.prototype.sync=function(r){if(!(!r&&this.dataState.inUpdate)){if(this.state.syncedTree===this.dataState.tree){r&&!this.state.notified&&(this.state.notified=!0,this.behaviors.selection.next(E({hierarchy:this.state.hierarchy},this.state.selection)));return}this.state.syncedTree=this.dataState.tree;var n=Aat(this.plugin.state.data,this.current);if(n.changed){var i=n.hierarchy,a=this.syncCurrent(i.trajectories,n.added),o=this.syncCurrent(i.models,n.added),s=this.syncCurrent(i.structures,n.added);this._currentComponentGroups=void 0,this._currentSelectionSet=void 0,this.state.hierarchy=i,this.state.selection.trajectories=a,this.state.selection.models=o,this.state.selection.structures=s,r?(this.state.notified=!0,this.behaviors.selection.next({hierarchy:i,trajectories:a,models:o,structures:s})):this.state.notified=!1}}},t.prototype.updateCurrent=function(r,n){for(var i=this.current,a=n==="add"?gi.union(this.seletionSet,new Set(r.map(function(y){return y.cell.transform.ref}))):gi.difference(this.seletionSet,new Set(r.map(function(y){return y.cell.transform.ref}))),o=[],s=[],u=[],l=0,c=i.trajectories;l<c.length;l++){var d=c[l];a.has(d.cell.transform.ref)&&o.push(d)}for(var f=0,h=i.models;f<h.length;f++){var v=h[f];a.has(v.cell.transform.ref)&&s.push(v)}for(var p=0,m=i.structures;p<m.length;p++){var g=m[p];a.has(g.cell.transform.ref)&&u.push(g)}this._currentComponentGroups=void 0,this._currentSelectionSet=void 0,this.state.selection.trajectories=o,this.state.selection.models=s,this.state.selection.structures=u,this.behaviors.selection.next({hierarchy:i,trajectories:o,models:s,structures:u})},t.prototype.remove=function(r,n){if(r.length!==0){for(var i=this.plugin.state.data.build(),a=0,o=r;a<o.length;a++){var s=o[a];i.delete(typeof s=="string"?s:s.cell.transform.ref)}return i.commit({canUndo:n?"Remove":!1})}},t.prototype.toggleVisibility=function(r,n){if(r.length!==0)for(var i=n!==void 0?n!=="show":!r[0].cell.state.isHidden,a=0,o=r;a<o.length;a++){var s=o[a];jv(this.dataState,s.cell.transform.ref,i)}},t.prototype.applyPreset=function(r,n,i){var a=this;return this.plugin.dataTransaction(function(){return ce(a,void 0,void 0,function(){var o,s,u;return de(this,function(l){switch(l.label){case 0:o=0,s=r,l.label=1;case 1:return o<s.length?(u=s[o],u.models.length>0?[4,this.clearTrajectory(u)]:[3,3]):[3,6];case 2:l.sent(),l.label=3;case 3:return[4,this.plugin.builders.structure.hierarchy.applyPreset(u.cell,n,i)];case 4:l.sent(),l.label=5;case 5:return o++,[3,1];case 6:return[2]}})})})},t.prototype.updateStructure=function(r,n){return ce(this,void 0,void 0,function(){var i=this;return de(this,function(a){switch(a.label){case 0:return[4,this.plugin.dataTransaction(function(){return ce(i,void 0,void 0,function(){var o,s;return de(this,function(u){switch(u.label){case 0:return o=fi.getDecoratorRoot(this.dataState.tree,r.cell.transform.ref),s=this.dataState.tree.children.get(o).toArray(),[4,this.remove(s,!1)];case 1:return u.sent(),[4,this.plugin.state.updateTransform(this.plugin.state.data,r.cell.transform.ref,n,"Structure Type")];case 2:return u.sent(),[4,this.plugin.builders.structure.representation.applyPreset(r.cell.transform.ref,"auto")];case 3:return u.sent(),[2]}})})},{canUndo:"Structure Type"})];case 1:return a.sent(),_t.Camera.Reset(this.plugin),[2]}})})},t.prototype.clearTrajectory=function(r){for(var n=this.dataState.build(),i=0,a=r.models;i<a.length;i++){var o=a[i];n.delete(o.cell)}return n.commit()},t}(N2);(function(e){function t(n){if(!n.length)return[];if(n.length===1)return n[0].components.map(function(v){return[v]});for(var i=[],a=new Map,o=0,s=n;o<s.length;o++)for(var u=s[o],l=0,c=u.components;l<c.length;l++){var d=c[l],f=d.key;if(f){var h=a.get(f);h||(h=[],a.set(f,h),i.push(h)),h.push(d)}}return i}e.getComponentGroups=t;function r(n){var i,a,o,s,u,l,c,d,f,h=n.managers.structure.hierarchy.selection.structures;if(h.length===0)return"";if(h.length===1){var v=h[0],p=(i=v.cell.obj)===null||i===void 0?void 0:i.data;if(!p)return((a=v.cell.obj)===null||a===void 0?void 0:a.label)||"Structure";var m=p.models[0]||p.representativeModel||p.masterModel;if(!m)return((o=v.cell.obj)===null||o===void 0?void 0:o.label)||"Structure";var g=m.entryId;return!((u=(s=v.model)===null||s===void 0?void 0:s.trajectory)===null||u===void 0)&&u.models&&v.model.trajectory.models.length===1?g:v.model?((l=v.model.cell.obj)===null||l===void 0?void 0:l.label)+" | "+g:g}for(var y=h[0],b=(c=y==null?void 0:y.model)===null||c===void 0?void 0:c.trajectory,S=!0,x=0,C=h;x<C.length;x++){var v=C[x];if(((d=v==null?void 0:v.model)===null||d===void 0?void 0:d.trajectory)!==b){S=!1;break}}return S&&b?((f=b.cell.obj)===null||f===void 0?void 0:f.label)+" | "+h.length+" structures":h.length+" structures"}e.getSelectedStructuresDescription=r})(i2||(i2={}));var Hv=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.onChange=function(n){var i,a=n.name,o=n.value,s=E(E({},r.props.params),(i={},i[a]=o,i));r.props.events.onChange(s,r.areInitial(s),r.validate(s))},r}return t.prototype.validate=function(r){},t.prototype.areInitial=function(r){return I.areEqual(this.props.info.params,r,this.props.info.initialValues)},t.prototype.render=function(){return P.jsx(Vn,{params:this.props.info.params,values:this.props.params,onChange:this.onChange,onEnter:this.props.events.onEnter,isDisabled:this.props.isDisabled},void 0)},t}(ea);(function(e){function t(i){for(var a=Object.keys(i),o=0,s=a;o<s.length;o++){var u=s[o];if(!i[u].isHidden)return!1}return!0}function r(i,a,o,s){var u=a.cells.get(s).obj,l=o.definition.params?o.definition.params(u,i):{},c=I.getDefaultValues(l);return{initialValues:c,params:l,isEmpty:t(l)}}e.infoFromAction=r;function n(i,a,o){var s=a.cells.get(o.ref),u=s.params&&s.params.definition||{},l=s.params&&s.params.values||{};return{initialValues:l,params:u,isEmpty:t(u)}}e.infoFromTransform=n})(Hv||(Hv={}));var Uie=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.busy=new ai,r.onEnter=function(){r.state.error||r.apply()},r.autoApplyHandle=void 0,r.events={onEnter:r.onEnter,onChange:function(n,i,a){r.clearAutoApply(),r.setState({params:n,isInitial:i,error:a&&a[0]},function(){!i&&!r.state.error&&r.canAutoApply(n)&&(r.clearAutoApply(),r.autoApplyHandle=setTimeout(r.apply,50))})}},r.apply=function(){return ce(r,void 0,void 0,function(){var n,i;return de(this,function(a){switch(a.label){case 0:this.clearAutoApply(),this.setState({busy:!0}),a.label=1;case 1:return a.trys.push([1,3,4,5]),[4,this.applyAction()];case 2:return a.sent(),[3,5];case 3:return a.sent(),[3,5];case 4:return(i=(n=this.props).onApply)===null||i===void 0||i.call(n),this.busy.next(!1),[7];case 5:return[2]}})})},r.refresh=function(){r.setState({params:r.getInfo().initialValues,isInitial:!0,error:void 0})},r.setDefault=function(){var n=r.getInfo(),i=I.getDefaultValues(n.params);r.setState({params:i,isInitial:I.areEqual(n.params,i,n.initialValues),error:void 0})},r.toggleExpanded=function(){r.setState({isCollapsed:!r.state.isCollapsed})},r}return t.prototype.clearAutoApply=function(){this.autoApplyHandle!==void 0&&(clearTimeout(this.autoApplyHandle),this.autoApplyHandle=void 0)},t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.behaviors.state.isBusy,function(n){r.state.busy!==n&&r.busy.next(n)}),this.subscribe(this.busy,function(n){r.state.busy!==n&&r.setState({busy:n})})},t.prototype.renderApply=function(){var r=this.canApply();return this.props.autoHideApply&&(!r||this.canAutoApply(this.state.params))?null:P.jsxs("div",E({className:"msp-transform-apply-wrap"},{children:[P.jsx(Gt,{svg:sD,className:"msp-transform-default-params",onClick:this.setDefault,disabled:this.state.busy,title:"Set default params"},void 0),P.jsx("div",E({className:"msp-transform-apply-wider"},{children:P.jsx(yr,E({icon:r?B0:void 0,className:"msp-btn-commit msp-btn-commit-"+(r?"on":"off"),onClick:this.apply,disabled:!r},{children:this.props.applyLabel||this.applyText()}),void 0)}),void 0)]}),void 0)},t.prototype.renderDefault=function(){var r=this.getInfo(),n=r.isEmpty&&this.isUpdate(),i=this.getHeader(),a=this.getTransformerId(),o=this.plugin.customParamEditors.has(a)?this.plugin.customParamEditors.get(a):Hv,s=this.state.isCollapsed?"msp-transform-wrapper msp-transform-wrapper-collapsed":"msp-transform-wrapper",u=null;if(!n&&!this.state.isCollapsed){var l=this.getSourceAndTarget(),c=l.a,d=l.b,f=l.bCell,h=this.renderApply();u=P.jsxs(P.Fragment,{children:[P.jsx(o,{info:r,a:c,b:d,bCell:f,events:this.events,params:this.state.params,isDisabled:this.state.busy},void 0),h]},void 0)}var v=P.jsxs("div",E({className:s,style:{marginBottom:this.props.noMargin?0:void 0}},{children:[i!=="none"&&!this.props.wrapInExpander&&P.jsx("div",E({className:"msp-transform-header"},{children:P.jsxs(yr,E({onClick:this.toggleExpanded,title:i.description},{children:[!n&&P.jsx(cn,{svg:this.state.isCollapsed?dd:cd},void 0),i.name]}),void 0)}),void 0),u]}),void 0);return n||!this.props.wrapInExpander?v:P.jsx(qu,E({header:this.isUpdate()?"Update "+(i==="none"?"":i.name):"Apply "+(i==="none"?"":i.name),headerLeftMargin:this.props.expanderHeaderLeftMargin},{children:v}),void 0)},t.prototype.renderSimple=function(){var r,n,i,a=this.getInfo(),o=this.canApply(),s=P.jsxs("div",E({className:"msp-flex-row"},{children:[P.jsx(yr,E({icon:(r=this.props.simpleApply)===null||r===void 0?void 0:r.icon,title:(n=this.props.simpleApply)===null||n===void 0?void 0:n.title,disabled:this.state.busy||!o,onClick:this.apply,className:"msp-btn-apply-simple"},{children:(i=this.props.simpleApply)===null||i===void 0?void 0:i.header}),void 0),!a.isEmpty&&P.jsx(Fi,{icon:Pv,label:"",title:"Options",toggle:this.toggleExpanded,isSelected:!this.state.isCollapsed,disabled:this.state.busy,style:{flex:"0 0 40px",padding:0}},void 0)]}),void 0);if(this.state.isCollapsed)return s;var u=this.getTransformerId(),l=this.plugin.customParamEditors.has(u)?this.plugin.customParamEditors.get(u):Hv,c=this.getSourceAndTarget(),d=c.a,f=c.b,h=c.bCell;return P.jsxs(P.Fragment,{children:[s,P.jsx(l,{info:a,a:d,b:f,bCell:h,events:this.events,params:this.state.params,isDisabled:this.state.busy},void 0)]},void 0)},t.prototype.render=function(){return this.props.simpleApply?this.renderSimple():this.renderDefault()},t}(ea),wd=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r._getInfo=Rh(function(n){return Hv.infoFromTransform(r.plugin,r.props.state,n)}),r.state={error:void 0,isInitial:!0,params:r.getInfo().initialValues,busy:!1,isCollapsed:r.props.initiallyCollapsed},r}return t.prototype.applyAction=function(){return this.props.customUpdate?this.props.customUpdate(this.state.params):this.plugin.state.updateTransform(this.props.state,this.props.transform.ref,this.state.params)},t.prototype.getInfo=function(){return this._getInfo(this.props.transform)},t.prototype.getTransformerId=function(){return this.props.transform.transformer.id},t.prototype.getHeader=function(){return this.props.customHeader||this.props.transform.transformer.definition.display},t.prototype.canApply=function(){var r=this.props.state,n=r.cells.get(this.props.transform.ref);if(!n)return!1;if(n.status==="error"){var i=r.cells.get(this.props.transform.parent);return i?i.status==="ok":!1}return!this.state.error&&!this.state.busy&&!this.state.isInitial},t.prototype.applyText=function(){return this.canApply()?"Update":"Nothing to Update"},t.prototype.isUpdate=function(){return!0},t.prototype.getSourceAndTarget=function(){var r=this.props.state.cells.get(this.props.transform.ref);return{a:this.props.state.cells.get(this.props.transform.parent).obj,b:r==null?void 0:r.obj,bCell:r}},t.prototype.canAutoApply=function(r){var n=this.props.transform.transformer.definition.canAutoUpdate;if(!n)return!1;var i=this.props.state,a=i.cells.get(this.props.transform.ref);if(!a||!a.sourceRef||a.status!=="ok")return!1;var o=i.cells.get(a.sourceRef);return n({a:o.obj,b:a.obj,oldParams:this.getInfo().initialValues,newParams:r},this.plugin)},t.prototype.componentDidMount=function(){var r=this;e.prototype.componentDidMount.call(this),this.props.toggleCollapsed&&this.subscribe(this.props.toggleCollapsed,function(){return r.setState({isCollapsed:!r.state.isCollapsed})}),this.subscribe(this.plugin.state.events.object.updated,function(n){var i=n.ref,a=n.state;r.props.transform.ref!==i||r.props.state!==a||r.state.params!==r.props.transform.params&&(r._getInfo=Rh(function(o){return Hv.infoFromTransform(r.plugin,r.props.state,o)}),r.setState({params:r.props.transform.params,isInitial:!0}))})},t.prototype.componentDidUpdate=function(r){var n;if(this.props.transform!==r.transform){var i=this.props.state.cells.get(this.props.transform.ref);this.setState({params:((n=i.params)===null||n===void 0?void 0:n.values)||{},isInitial:!0,error:void 0,simpleOnly:this.state.simpleOnly})}},t}(Uie);(function(e){Le(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.state.events.object.updated,function(n){var i=n.ref,a=n.state;r.props.nodeRef!==i||r.plugin.state.data!==a||r.forceUpdate()})},t.prototype.render=function(){var r=this.plugin.state.data,n=this.props.nodeRef,i=r.cells.get(n);if(!i||i.status!=="ok"&&i.status!=="error")return null;var a=i.transform;return P.jsx(wd,{state:r,transform:a,initiallyCollapsed:this.props.initiallyCollapsed,customHeader:this.props.header},void 0)},t})(br);var Vat=function(e){Le(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return Object.defineProperty(t.prototype,"current",{get:function(){return this.plugin.managers.structure.hierarchy.behaviors.selection},enumerable:!1,configurable:!0}),t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.current,function(){return r.forceUpdate()})},Object.defineProperty(t.prototype,"unitcell",{get:function(){var r,n=this.plugin.managers.structure.hierarchy.selection;if(n.structures.length===0)return null;for(var i=[],a=0,o=n.structures;a<o.length;a++){var s=o[a],u=s.model;u!=null&&u.unitcell&&(!((r=u.unitcell)===null||r===void 0)&&r.cell.obj)&&i.push(u.unitcell)}return i.length===0?null:P.jsx(sG,{refs:i,labelMultiple:"Unit Cells"},void 0)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"customControls",{get:function(){var r=this,n=[];return this.plugin.genericRepresentationControls.forEach(function(i,a){var o=i(r.plugin.managers.structure.hierarchy.selection),s=o[0],u=o[1];s.length>0&&n.push(P.jsx("div",{children:P.jsx(sG,{refs:s,labelMultiple:u},void 0)},a))}),n.length>0?n:null},enumerable:!1,configurable:!0}),t.prototype.render=function(){return P.jsx(P.Fragment,{children:P.jsxs("div",E({style:{marginTop:"6px"}},{children:[this.unitcell,this.customControls]}),void 0)},void 0)},t}(ea),sG=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={showOptions:!1},r.toggleVisibility=function(n){n.preventDefault(),r.plugin.managers.structure.hierarchy.toggleVisibility(r.props.refs),n.currentTarget.blur()},r.highlight=function(n){n.preventDefault(),r.pivot.cell.parent&&_t.Interactivity.Object.Highlight(r.plugin,{state:r.pivot.cell.parent,ref:r.props.refs.map(function(i){return i.cell.transform.ref})})},r.clearHighlight=function(n){n.preventDefault(),_t.Interactivity.ClearHighlights(r.plugin)},r.focus=function(n){var i;n.preventDefault();for(var a=!0,o=0,s=r.props.refs;o<s.length;o++){var u=s[o];if(!u.cell.state.isHidden){a=!1;break}}a&&r.plugin.managers.structure.hierarchy.toggleVisibility(r.props.refs,"show");for(var l=[],c=0,d=r.props.refs;c<d.length;c++){var u=d[c];if(!u.cell.state.isHidden){var f=(i=u.cell.obj)===null||i===void 0?void 0:i.data.repr.getLoci();f&&l.push(f)}}r.plugin.managers.camera.focusLoci(l)},r.toggleOptions=function(){return r.setState({showOptions:!r.state.showOptions})},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.state.events.cell.stateUpdated,function(n){var i;Th.ObjectEvent.isCell(n,(i=r.pivot)===null||i===void 0?void 0:i.cell)&&r.forceUpdate()})},Object.defineProperty(t.prototype,"pivot",{get:function(){return this.props.refs[0]},enumerable:!1,configurable:!0}),t.prototype.render=function(){var r=this.props,n=r.refs,i=r.labelMultiple;if(n.length===0)return null;var a=n[0],o,s;if(n.length===1){var u=a.cell.obj;if(!u)return null;o=u==null?void 0:u.label,s=u==null?void 0:u.description}else o=n.length+" "+(i||"Objects");return P.jsxs(P.Fragment,{children:[P.jsxs("div",E({className:"msp-flex-row"},{children:[P.jsxs("button",E({className:"msp-form-control msp-control-button-label",title:o+". Click to focus.",onClick:this.focus,onMouseEnter:this.highlight,onMouseLeave:this.clearHighlight,style:{textAlign:"left"}},{children:[o," ",P.jsx("small",{children:s},void 0)]}),void 0),P.jsx(Gt,{svg:a.cell.state.isHidden?Zv:Jv,toggleState:!1,className:"msp-form-control",onClick:this.toggleVisibility,title:a.cell.state.isHidden?"Show":"Hide",small:!0,flex:!0},void 0),n.length===1&&P.jsx(Gt,{svg:Av,className:"msp-form-control",onClick:this.toggleOptions,title:"Options",toggleState:this.state.showOptions,flex:!0},void 0)]}),void 0),n.length===1&&this.state.showOptions&&a.cell.parent&&P.jsx(P.Fragment,{children:P.jsx("div",E({className:"msp-control-offset"},{children:P.jsx(wd,{state:a.cell.parent,transform:a.cell.transform,customHeader:"none",autoHideApply:!0},void 0)}),void 0)},void 0)]},void 0)},t}(ea),Hat=function(e){Le(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.defaultState=function(){return{header:"Components",isCollapsed:!1,isDisabled:!1,brand:{accent:"blue",svg:nD}}},t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.managers.structure.hierarchy.behaviors.selection,function(n){return r.setState({description:i2.getSelectedStructuresDescription(r.plugin)})})},t.prototype.renderControls=function(){return P.jsxs(P.Fragment,{children:[P.jsx(Gat,{},void 0),P.jsx($at,{},void 0),P.jsx(Vat,{},void 0)]},void 0)},t}(U0),Gat=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isEmpty:!0,isBusy:!1,canUndo:!1},r.togglePreset=r.toggleAction("preset"),r.toggleAdd=r.toggleAction("add"),r.toggleOptions=r.toggleAction("options"),r.hideAction=function(){return r.setState({action:void 0})},r.applyPreset=function(n){if(r.hideAction(),!!n){var i=r.plugin.managers.structure,a=i.hierarchy.selection.structures;n.value===null?i.component.clear(a):i.component.applyPreset(a,n.value)}},r.undo=function(){var n=r.plugin.state.data.undo();n&&r.plugin.runTask(n)},r}return Object.defineProperty(t.prototype,"isDisabled",{get:function(){return this.state.isBusy||this.state.isEmpty},enumerable:!1,configurable:!0}),t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.managers.structure.hierarchy.behaviors.selection,function(n){return r.setState({action:r.state.action!=="options"||n.structures.length===0?void 0:"options",isEmpty:n.structures.length===0})}),this.subscribe(this.plugin.behaviors.state.isBusy,function(n){r.setState({isBusy:n,action:r.state.action!=="options"?void 0:"options"})}),this.subscribe(this.plugin.state.data.events.historyUpdated,function(n){var i=n.state;r.setState({canUndo:i.canUndo})})},t.prototype.toggleAction=function(r){var n=this;return function(){return n.setState({action:n.state.action===r?void 0:r})}},Object.defineProperty(t.prototype,"presetControls",{get:function(){return P.jsx(rr,{items:this.presetActions,onSelect:this.applyPreset},void 0)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"presetActions",{get:function(){var r=this.plugin.managers.structure.component.pivotStructure,n=this.plugin.builders.structure.representation.getPresets(r==null?void 0:r.cell.obj);return rr.createItems(n,{label:function(i){return i.display.name},category:function(i){return i.display.group},description:function(i){return i.display.description}})},enumerable:!1,configurable:!0}),t.prototype.render=function(){var r=this.state.canUndo?"Undo "+this.plugin.state.data.latestUndoLabel:"Some mistakes of the past can be undone.";return P.jsxs(P.Fragment,{children:[P.jsxs("div",E({className:"msp-flex-row"},{children:[P.jsx(Fi,{icon:OE,label:"Preset",title:"Apply a representation preset for the current structure(s).",toggle:this.togglePreset,isSelected:this.state.action==="preset",disabled:this.isDisabled},void 0),P.jsx(Fi,{icon:N0,label:"Add",title:"Add a new representation component for a selection.",toggle:this.toggleAdd,isSelected:this.state.action==="add",disabled:this.isDisabled},void 0),P.jsx(Fi,{icon:Pv,label:"",title:"Options that are applied to all applicable representations.",style:{flex:"0 0 40px",padding:0},toggle:this.toggleOptions,isSelected:this.state.action==="options",disabled:this.isDisabled},void 0),P.jsx(Gt,{svg:lD,className:"msp-flex-item",flex:"40px",onClick:this.undo,disabled:!this.state.canUndo||this.isDisabled,title:r},void 0)]}),void 0),this.state.action==="preset"&&this.presetControls,this.state.action==="add"&&P.jsx("div",E({className:"msp-control-offset"},{children:P.jsx(jie,{onApply:this.hideAction},void 0)}),void 0),this.state.action==="options"&&P.jsx("div",E({className:"msp-control-offset"},{children:P.jsx(qat,{isDisabled:this.isDisabled},void 0)}),void 0)]},void 0)},t}(ea),jie=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state=r.createState(),r.apply=function(){var n=r.props.forSelection?r.currentStructures:r.selectedStructures;r.props.onApply(),r.plugin.managers.structure.component.add(r.state.values,n)},r.paramsChanged=function(n){return r.setState({values:n})},r}return t.prototype.createState=function(){var r=Vv.getAddParams(this.plugin);return{params:r,values:I.getDefaultValues(r)}},Object.defineProperty(t.prototype,"selectedStructures",{get:function(){return this.plugin.managers.structure.component.currentStructures},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"currentStructures",{get:function(){return this.plugin.managers.structure.hierarchy.current.structures},enumerable:!1,configurable:!0}),t.prototype.render=function(){return P.jsxs(P.Fragment,{children:[P.jsx(Vn,{params:this.state.params,values:this.state.values,onChangeValues:this.paramsChanged},void 0),P.jsx(yr,E({icon:N0,title:"Use Selection and optional Representation to create a new Component.",className:"msp-btn-commit msp-btn-commit-on",onClick:this.apply,style:{marginTop:"1px"}},{children:"Create Component"}),void 0)]},void 0)},t}(ea),qat=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.update=function(n){return r.plugin.managers.structure.component.setOptions(n)},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.managers.structure.component.events.optionsUpdated,function(){return r.forceUpdate()})},t.prototype.render=function(){return P.jsx(Vn,{params:Vv.OptionsParams,values:this.plugin.managers.structure.component.state.options,onChangeValues:this.update,isDisabled:this.props.isDisabled},void 0)},t}(ea),$at=function(e){Le(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.managers.structure.hierarchy.behaviors.selection,function(){r.forceUpdate()})},t.prototype.render=function(){var r=this.plugin.managers.structure.hierarchy.currentComponentGroups;return r.length===0?null:P.jsx("div",E({style:{marginTop:"6px"}},{children:r.map(function(n){return P.jsx(Wat,{group:n},n[0].cell.transform.ref)})}),void 0)},t}(ea),Wat=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={action:void 0},r.toggleVisible=function(n){n.preventDefault(),n.currentTarget.blur(),r.plugin.managers.structure.component.toggleVisibility(r.props.group)},r.selectAction=function(n){n&&(r.setState({action:void 0}),(n==null?void 0:n.value)())},r.remove=function(){return r.plugin.managers.structure.hierarchy.remove(r.props.group,!0)},r.toggleAction=function(){return r.setState({action:r.state.action==="action"?void 0:"action"})},r.toggleLabel=function(){return r.setState({action:r.state.action==="label"?void 0:"label"})},r.highlight=function(n){n.preventDefault(),r.props.group[0].cell.parent&&_t.Interactivity.Object.Highlight(r.plugin,{state:r.props.group[0].cell.parent,ref:r.props.group.map(function(i){return i.cell.transform.ref})})},r.clearHighlight=function(n){n.preventDefault(),_t.Interactivity.ClearHighlights(r.plugin)},r.focus=function(){for(var n=!0,i=0,a=r.props.group;i<a.length;i++){var o=a[i];if(!o.cell.state.isHidden){n=!1;break}}n&&r.plugin.managers.structure.hierarchy.toggleVisibility(r.props.group,"show"),r.plugin.managers.camera.focusSpheres(r.props.group,function(s){var u;if(!s.cell.state.isHidden)return(u=s.cell.obj)===null||u===void 0?void 0:u.data.boundary.sphere})},r.updateLabel=function(n){r.plugin.managers.structure.component.updateLabel(r.pivot,n)},r}return Object.defineProperty(t.prototype,"pivot",{get:function(){return this.props.group[0]},enumerable:!1,configurable:!0}),t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.state.events.cell.stateUpdated,function(n){Th.ObjectEvent.isCell(n,r.pivot.cell)&&r.forceUpdate()})},Object.defineProperty(t.prototype,"colorByActions",{get:function(){var r=this,n,i,a=this.plugin.managers.structure.component,o=this.pivot.representations[0],s=(n=o.cell.transform.params)===null||n===void 0?void 0:n.colorTheme.name,u=ptt(this.plugin,(i=this.pivot.cell.obj)===null||i===void 0?void 0:i.data);return rr.createItemsFromSelectOptions(u,{value:function(l){return function(){return a.updateRepresentationsTheme(r.props.group,{color:l[0]})}},selected:function(l){return l[0]===s}})},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"actions",{get:function(){var r=this,n=this.plugin.managers.structure.component,i=[Nt([rr.Header("Add Representation")],Vv.getRepresentationTypes(this.plugin,this.props.group[0]).map(function(a){return rr.Item(a[1],function(){return n.addRepresentation(r.props.group,a[0])})}))];return this.pivot.representations.length>0&&i.push(Nt([rr.Header("Set Coloring",{isIndependent:!0})],this.colorByActions)),n.canBeModified(this.props.group[0])&&i.push([rr.Header("Modify by Selection"),rr.Item("Include",function(){return n.modifyByCurrentSelection(r.props.group,"union")},{icon:eD}),rr.Item("Subtract",function(){return n.modifyByCurrentSelection(r.props.group,"subtract")},{icon:tD}),rr.Item("Intersect",function(){return n.modifyByCurrentSelection(r.props.group,"intersect")},{icon:rD})]),i.push(rr.Item("Select This",function(){return n.selectThis(r.props.group)},{icon:tw})),n.canBeModified(this.props.group[0])&&i.push(rr.Item("Edit Label",this.toggleLabel)),i},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"reprLabel",{get:function(){var r,n=this.pivot;return n.representations.length===0?"No repr.":n.representations.length===1?(r=n.representations[0].cell.obj)===null||r===void 0?void 0:r.label:n.representations.length+" reprs"},enumerable:!1,configurable:!0}),t.prototype.render=function(){var r=this,n,i=this.pivot,a=i.cell,o=(n=a.obj)===null||n===void 0?void 0:n.label,s=this.reprLabel;return P.jsxs(P.Fragment,{children:[P.jsxs("div",E({className:"msp-flex-row"},{children:[P.jsxs(yr,E({noOverflow:!0,className:"msp-control-button-label",title:o+". Click to focus.",onClick:this.focus,onMouseEnter:this.highlight,onMouseLeave:this.clearHighlight,style:{textAlign:"left"}},{children:[o,P.jsx("small",E({className:"msp-25-lower-contrast-text",style:{float:"right"}},{children:s}),void 0)]}),void 0),P.jsx(Gt,{svg:a.state.isHidden?Zv:Jv,toggleState:!1,onClick:this.toggleVisible,title:(a.state.isHidden?"Show":"Hide")+" component",small:!0,className:"msp-form-control",flex:!0},void 0),P.jsx(Gt,{svg:iu,toggleState:!1,onClick:this.remove,title:"Remove",small:!0,className:"msp-form-control",flex:!0},void 0),P.jsx(Gt,{svg:Av,onClick:this.toggleAction,title:"Actions",toggleState:this.state.action==="action",className:"msp-form-control",flex:!0},void 0)]}),void 0),this.state.action==="label"&&P.jsx("div",E({className:"msp-control-offset",style:{marginBottom:"6px"}},{children:P.jsx(Zs,{label:"Label",control:P.jsxs("div",E({style:{display:"flex",textAlignLast:"center"}},{children:[P.jsx(Kc,{onChange:this.updateLabel,value:o,style:{flex:"1 1 auto",minWidth:0},className:"msp-form-control",blurOnEnter:!0,blurOnEscape:!0},void 0),P.jsx(Gt,{svg:B0,onClick:this.toggleLabel,className:"msp-form-control msp-control-button-label",flex:!0},void 0)]}),void 0)},void 0)}),void 0),this.state.action==="action"&&P.jsxs("div",E({className:"msp-accent-offset"},{children:[P.jsx("div",E({style:{marginBottom:"6px"}},{children:P.jsx(rr,{items:this.actions,onSelect:this.selectAction,noOffset:!0},void 0)}),void 0),P.jsx("div",E({style:{marginBottom:"6px"}},{children:i.representations.map(function(u){return P.jsx(Xat,{group:r.props.group,representation:u},u.cell.transform.ref)})}),void 0)]}),void 0)]},void 0)},t}(ea),Xat=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.remove=function(){return r.plugin.managers.structure.component.removeRepresentations(r.props.group,r.props.representation)},r.toggleVisible=function(n){n.preventDefault(),n.currentTarget.blur(),r.plugin.managers.structure.component.toggleVisibility(r.props.group,r.props.representation)},r.update=function(n){return r.plugin.managers.structure.component.updateRepresentations(r.props.group,r.props.representation,n)},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.state.events.cell.stateUpdated,function(n){Th.ObjectEvent.isCell(n,r.props.representation.cell)&&r.forceUpdate()})},t.prototype.render=function(){var r,n=this.props.representation.cell;return P.jsxs("div",E({className:"msp-representation-entry"},{children:[n.parent&&P.jsx(qu,E({header:(((r=n.obj)===null||r===void 0?void 0:r.label)||"")+" Representation",noOffset:!0},{children:P.jsx(wd,{state:n.parent,transform:n.transform,customHeader:"none",customUpdate:this.update,noMargin:!0},void 0)}),void 0),P.jsx(Gt,{svg:iu,onClick:this.remove,title:"Remove",small:!0,className:"msp-default-bg",toggleState:!1,style:{position:"absolute",top:0,right:"32px",lineHeight:"24px",height:"24px",textAlign:"right",width:"44px",paddingRight:"6px",background:"none"}},void 0),P.jsx(Gt,{svg:this.props.representation.cell.state.isHidden?Zv:Jv,toggleState:!1,onClick:this.toggleVisible,title:"Toggle Visibility",small:!0,className:"msp-default-bg",style:{position:"absolute",top:0,right:0,lineHeight:"24px",height:"24px",textAlign:"right",width:"32px",paddingRight:"6px",background:"none"}},void 0)]}),void 0)},t}(ea),eI="measurement-group",zie={distanceUnitLabel:I.Text("",{isEssential:!0}),textColor:Ure.textColor},Yat=I.getDefaultValues(zie),Kat=function(e){Le(t,e);function t(r){var n=e.call(this,{labels:[],distances:[],angles:[],dihedrals:[],orientations:[],options:Yat})||this;return n.plugin=r,n.behaviors={state:n.ev.behavior(n.state)},n._empty=[],r.state.data.events.changed.subscribe(function(i){i.inTransaction||r.behaviors.state.isAnimating.value||n.sync()}),r.behaviors.state.isAnimating.subscribe(function(i){!i&&!r.behaviors.state.isUpdating.value&&n.sync()}),n}return t.prototype.stateUpdated=function(){this.behaviors.state.next(this.state)},t.prototype.getGroup=function(){var r=this.plugin.state.data,n=or.findTagInSubtree(r.tree,fr.RootRef,eI),i=this.plugin.state.data.build();return n?i.to(n):i.toRoot().group(rt.Misc.CreateGroup,{label:"Measurements"},{tags:eI})},t.prototype.setOptions=function(r){return ce(this,void 0,void 0,function(){var n,i,a,f,o,s,f,u,l,f,c,d,f;return de(this,function(h){switch(h.label){case 0:for(this.updateState({options:r})&&this.stateUpdated(),n=this.plugin.state.data.build(),i=0,a=this.state.distances;i<a.length;i++)f=a[i],n.to(f).update(function(v){v.unitLabel=r.distanceUnitLabel,v.textColor=r.textColor});for(o=0,s=this.state.labels;o<s.length;o++)f=s[o],n.to(f).update(function(v){v.textColor=r.textColor});for(u=0,l=this.state.angles;u<l.length;u++)f=l[u],n.to(f).update(function(v){v.textColor=r.textColor});for(c=0,d=this.state.dihedrals;c<d.length;c++)f=d[c],n.to(f).update(function(v){v.textColor=r.textColor});return n.editInfo.count===0?[2]:[4,_t.State.Update(this.plugin,{state:this.plugin.state.data,tree:n,options:{doNotLogTiming:!0}})];case 1:return h.sent(),[2]}})})},t.prototype.addDistance=function(r,n,i){return ce(this,void 0,void 0,function(){var a,o,s,u,l;return de(this,function(c){switch(c.label){case 0:return a=this.plugin.helpers.substructureParent.get(r.structure),o=this.plugin.helpers.substructureParent.get(n.structure),!a||!o?[2]:(s=[a.transform.ref],ja(s,o.transform.ref),u=this.getGroup(),u.apply(rt.Model.MultiStructureSelectionFromExpression,{selections:[{key:"a",groupId:"a",ref:a.transform.ref,expression:Re.toExpression(r)},{key:"b",groupId:"b",ref:o.transform.ref,expression:Re.toExpression(n)}],isTransitive:!0,label:"Distance"},{dependsOn:s,tags:i==null?void 0:i.selectionTags}).apply(rt.Representation.StructureSelectionsDistance3D,E(E(E({customText:(i==null?void 0:i.customText)||"",unitLabel:this.state.options.distanceUnitLabel,textColor:this.state.options.textColor},i==null?void 0:i.lineParams),i==null?void 0:i.labelParams),i==null?void 0:i.visualParams),{tags:i==null?void 0:i.reprTags}),l=this.plugin.state.data,[4,_t.State.Update(this.plugin,{state:l,tree:u,options:{doNotLogTiming:!0}})]);case 1:return c.sent(),[2]}})})},t.prototype.addAngle=function(r,n,i,a){return ce(this,void 0,void 0,function(){var o,s,u,l,c,d;return de(this,function(f){switch(f.label){case 0:return o=this.plugin.helpers.substructureParent.get(r.structure),s=this.plugin.helpers.substructureParent.get(n.structure),u=this.plugin.helpers.substructureParent.get(i.structure),!o||!s||!u?[2]:(l=[o.transform.ref],ja(l,s.transform.ref),ja(l,u.transform.ref),c=this.getGroup(),c.apply(rt.Model.MultiStructureSelectionFromExpression,{selections:[{key:"a",ref:o.transform.ref,expression:Re.toExpression(r)},{key:"b",ref:s.transform.ref,expression:Re.toExpression(n)},{key:"c",ref:u.transform.ref,expression:Re.toExpression(i)}],isTransitive:!0,label:"Angle"},{dependsOn:l,tags:a==null?void 0:a.selectionTags}).apply(rt.Representation.StructureSelectionsAngle3D,E(E(E({customText:(a==null?void 0:a.customText)||"",textColor:this.state.options.textColor},a==null?void 0:a.lineParams),a==null?void 0:a.labelParams),a==null?void 0:a.visualParams),{tags:a==null?void 0:a.reprTags}),d=this.plugin.state.data,[4,_t.State.Update(this.plugin,{state:d,tree:c,options:{doNotLogTiming:!0}})]);case 1:return f.sent(),[2]}})})},t.prototype.addDihedral=function(r,n,i,a,o){return ce(this,void 0,void 0,function(){var s,u,l,c,d,f,h;return de(this,function(v){switch(v.label){case 0:return s=this.plugin.helpers.substructureParent.get(r.structure),u=this.plugin.helpers.substructureParent.get(n.structure),l=this.plugin.helpers.substructureParent.get(i.structure),c=this.plugin.helpers.substructureParent.get(a.structure),!s||!u||!l||!c?[2]:(d=[s.transform.ref],ja(d,u.transform.ref),ja(d,l.transform.ref),ja(d,c.transform.ref),f=this.getGroup(),f.apply(rt.Model.MultiStructureSelectionFromExpression,{selections:[{key:"a",ref:s.transform.ref,expression:Re.toExpression(r)},{key:"b",ref:u.transform.ref,expression:Re.toExpression(n)},{key:"c",ref:l.transform.ref,expression:Re.toExpression(i)},{key:"d",ref:c.transform.ref,expression:Re.toExpression(a)}],isTransitive:!0,label:"Dihedral"},{dependsOn:d,tags:o==null?void 0:o.selectionTags}).apply(rt.Representation.StructureSelectionsDihedral3D,E(E(E({customText:(o==null?void 0:o.customText)||"",textColor:this.state.options.textColor},o==null?void 0:o.lineParams),o==null?void 0:o.labelParams),o==null?void 0:o.visualParams),{tags:o==null?void 0:o.reprTags}),h=this.plugin.state.data,[4,_t.State.Update(this.plugin,{state:h,tree:f,options:{doNotLogTiming:!0}})]);case 1:return v.sent(),[2]}})})},t.prototype.addLabel=function(r,n){return ce(this,void 0,void 0,function(){var i,a,o,s;return de(this,function(u){switch(u.label){case 0:return i=this.plugin.helpers.substructureParent.get(r.structure),i?(a=[i.transform.ref],o=this.getGroup(),o.apply(rt.Model.MultiStructureSelectionFromExpression,{selections:[{key:"a",ref:i.transform.ref,expression:Re.toExpression(r)}],isTransitive:!0,label:"Label"},{dependsOn:a,tags:n==null?void 0:n.selectionTags}).apply(rt.Representation.StructureSelectionsLabel3D,E(E({textColor:this.state.options.textColor},n==null?void 0:n.labelParams),n==null?void 0:n.visualParams),{tags:n==null?void 0:n.reprTags}),s=this.plugin.state.data,[4,_t.State.Update(this.plugin,{state:s,tree:o,options:{doNotLogTiming:!0}})]):[2];case 1:return u.sent(),[2]}})})},t.prototype.addOrientation=function(r){return ce(this,void 0,void 0,function(){var n,i,a,o;return de(this,function(s){switch(s.label){case 0:return n=this.plugin.helpers.substructureParent.get(r.structure),n?(i=[n.transform.ref],a=this.getGroup(),a.apply(rt.Model.MultiStructureSelectionFromExpression,{selections:[{key:"a",ref:n.transform.ref,expression:Re.toExpression(r)}],isTransitive:!0,label:"Orientation"},{dependsOn:i}).apply(rt.Representation.StructureSelectionsOrientation3D),o=this.plugin.state.data,[4,_t.State.Update(this.plugin,{state:o,tree:a,options:{doNotLogTiming:!0}})]):[2];case 1:return s.sent(),[2]}})})},t.prototype.getTransforms=function(r){var n=this.plugin.state.data,i=or.findTagInSubtree(n.tree,fr.RootRef,eI),a=i?n.select(or.Generators.ofTransformer(r,i)):this._empty;return a.length===0?this._empty:a},t.prototype.sync=function(){var r=this.updateState({labels:this.getTransforms(rt.Representation.StructureSelectionsLabel3D),distances:this.getTransforms(rt.Representation.StructureSelectionsDistance3D),angles:this.getTransforms(rt.Representation.StructureSelectionsAngle3D),dihedrals:this.getTransforms(rt.Representation.StructureSelectionsDihedral3D),orientations:this.getTransforms(rt.Representation.StructureSelectionsOrientation3D)});r&&this.stateUpdated()},t}(Wd),Qw=function(e){Le(t,e);function t(r,n){n===void 0&&(n={});var i=e.call(this,{props:E(E({},I.getDefaultValues(t.Params)),n)})||this;return i.plugin=r,i._props=I.getDefaultValues(t.Params),i.events={propsUpdated:i.ev()},i.lociSelects=new t.LociSelectManager(r,i._props),i.lociHighlights=new t.LociHighlightManager(r,i._props),i}return Object.defineProperty(t.prototype,"props",{get:function(){return E({},this.state.props)},enumerable:!1,configurable:!0}),t.prototype.setProps=function(r){var n=this.props,i=E(E({},this.state.props),r);T6(n,i)||(this.updateState({props:i}),this.lociSelects.setProps(i),this.lociHighlights.setProps(i),this.events.propsUpdated.next())},t}(Wd);(function(e){e.Params={granularity:I.Select("residue",sr.GranularityOptions,{label:"Picking Level",description:"Controls if selections are expanded upon picking to whole residues, chains, structures, instances, or left as atoms and coarse elements"})};var t=function(){function i(a,o){o===void 0&&(o={}),this.ctx=a,this.providers=[],this.props=I.getDefaultValues(e.Params),this.sel=a.managers.structure.selection,this.setProps(o)}return i.prototype.setProps=function(a){Object.assign(this.props,a)},i.prototype.addProvider=function(a){this.providers.push(a)},i.prototype.removeProvider=function(a){this.providers=this.providers.filter(function(o){return o!==a})},i.prototype.normalizedLoci=function(a,o){o===void 0&&(o=!0);var s=a.loci,u=a.repr,l=o?this.props.granularity:void 0;return{loci:sr.normalize(s,l),repr:u}},i.prototype.mark=function(a,o){if(!sr.isEmpty(a.loci))for(var s=0,u=this.providers;s<u.length;s++){var l=u[s];l(a,o)}},i}();e.LociMarkManager=t;var r=function(i){Le(a,i);function a(){var o=i!==null&&i.apply(this,arguments)||this;return o.prev=[],o.clearHighlights=function(){for(var s=0,u=o.prev;s<u.length;s++){var l=u[s];o.mark(l,nr.RemoveHighlight)}o.prev.length=0},o}return a.prototype.isHighlighted=function(o){for(var s=0,u=this.prev;s<u.length;s++){var l=u[s];if(ur.Loci.areEqual(l,o))return!0}return!1},a.prototype.addHighlight=function(o){this.mark(o,nr.Highlight),this.prev.push(o)},a.prototype.highlight=function(o,s){s===void 0&&(s=!0);var u=this.normalizedLoci(o,s);this.isHighlighted(u)||this.addHighlight(u)},a.prototype.highlightOnly=function(o,s){s===void 0&&(s=!0);var u=this.normalizedLoci(o,s);this.isHighlighted(u)||(this.clearHighlights(),this.addHighlight(u))},a.prototype.highlightOnlyExtend=function(o,s){s===void 0&&(s=!0);var u=this.normalizedLoci(o,s);if(Re.is(u.loci)){var l={loci:this.sel.tryGetRange(u.loci)||u.loci,repr:u.repr};this.isHighlighted(l)||(this.clearHighlights(),this.addHighlight(l))}},a}(t);e.LociHighlightManager=r;var n=function(i){Le(a,i);function a(){return i!==null&&i.apply(this,arguments)||this}return a.prototype.toggle=function(o,s){if(s===void 0&&(s=!0),!sr.isEmpty(o.loci)){var u=this.normalizedLoci(o,s);Re.is(u.loci)?this.toggleSel(u):i.prototype.mark.call(this,u,nr.Toggle)}},a.prototype.toggleExtend=function(o,s){if(s===void 0&&(s=!0),!sr.isEmpty(o.loci)){var u=this.normalizedLoci(o,s);if(Re.is(u.loci)){var l=this.sel.tryGetRange(u.loci)||u.loci;this.toggleSel({loci:l,repr:u.repr})}}},a.prototype.select=function(o,s){s===void 0&&(s=!0);var u=this.normalizedLoci(o,s);Re.is(u.loci)&&this.sel.modify("add",u.loci),this.mark(u,nr.Select)},a.prototype.selectJoin=function(o,s){s===void 0&&(s=!0);var u=this.normalizedLoci(o,s);Re.is(u.loci)&&this.sel.modify("intersect",u.loci),this.mark(u,nr.Select)},a.prototype.selectOnly=function(o,s){s===void 0&&(s=!0);var u=this.normalizedLoci(o,s);Re.is(u.loci)&&(this.deselect({loci:We.toStructureElementLoci(u.loci.structure),repr:u.repr},!1),this.sel.modify("set",u.loci)),this.mark(u,nr.Select)},a.prototype.deselect=function(o,s){s===void 0&&(s=!0);var u=this.normalizedLoci(o,s);Re.is(u.loci)&&this.sel.modify("remove",u.loci),this.mark(u,nr.Deselect)},a.prototype.deselectAll=function(){this.sel.clear(),this.mark({loci:hYe},nr.Deselect)},a.prototype.deselectAllOnEmpty=function(o){Nu(o.loci)&&this.deselectAll()},a.prototype.mark=function(o,s){var u=o.loci;sr.isEmpty(u)||(Re.is(u)?(i.prototype.mark.call(this,{loci:We.Loci(u.structure)},nr.Deselect),i.prototype.mark.call(this,{loci:this.sel.getLoci(u.structure)},nr.Select)):i.prototype.mark.call(this,o,s))},a.prototype.toggleSel=function(o){this.sel.has(o.loci)?(this.sel.modify("remove",o.loci),this.mark(o,nr.Deselect)):(this.sel.modify("add",o.loci),this.mark(o,nr.Select))},a}(t);e.LociSelectManager=n})(Qw||(Qw={}));function Qat(e,t){for(var r,n=[],i=t==="auth"?"auth_asym_id":"label_asym_id",a=t==="auth"?"auth_seq_id":"label_seq_id",o=0,s=e;o<s.length;o++){var u=s[o];if(u.kind==="range")n.push(se.struct.generator.atomGroups({"chain-test":se.core.rel.eq([se.ammp(i),u.asym_id]),"residue-test":se.core.rel.inRange([se.ammp(a),u.seq_id_beg,u.seq_id_end])}));else{var l=((r=u.ins_code)!==null&&r!==void 0?r:"").trim();n.push(se.struct.generator.atomGroups({"chain-test":se.core.rel.eq([se.ammp(i),u.asym_id]),"residue-test":se.core.logic.and([se.core.rel.eq([se.ammp(a),u.seq_id]),se.core.rel.eq([se.ammp("pdbx_PDB_ins_code"),l])])}))}}var c=se.struct.combinator.merge(n);return Lv(c)}function Zat(e){for(var t=an.create(),r=0,n=e;r<n.length;r++)for(var i=n[r],a=i[0],o=i[1],s=a;s<=o;s++)an.add(t,s,s);var u=se.struct.generator.atomGroups({"atom-test":se.core.set.has([se.set.apply(se,t.array),se.ammp("id")])});return Lv(u)}function Jat(e,t,r){if(!(!e||t.length===0||Number.isNaN(+t[0])))return Number.isNaN(r)?{kind:"single",asym_id:e,seq_id:+t[0],ins_code:t[1]}:{kind:"range",asym_id:e,seq_id_beg:+t[0],seq_id_end:r}}function eot(e){return e?e.split(":"):[]}function tot(e){return e.split(",").map(function(t){return t.trim().split(/\s+|[-]/g).filter(function(r){return!!r})}).map(function(t){return Jat(t[0],eot(t[1]),+t[2])}).filter(function(t){return!!t})}function rot(e){return e.split(",").map(function(t){return t.trim().split(/\s+|[-]/g).filter(function(r){return!!r})}).filter(function(t){return t.length===1||t.length===2}).map(function(t){return t.length===1?[+t[0],+t[0]]:[+t[0],+t[1]]})}function not(e,t){if(t==="atom-id"){var r=rot(e);return Zat(r)}else{var r=tot(e);return Qat(r,t)}}function iot(e){return Object.keys(e).map(function(t){return[t,e[t]]})}var WR=function(e){Le(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.getBindingComponents=function(){var r=iot(this.props.bindings);return P.jsx(P.Fragment,{children:r.map(function(n){var i=n[0],a=n[1];return mr.isEmpty(a)?null:P.jsxs("div",E({style:{marginBottom:"6px"}},{children:[P.jsx("b",{children:a.action},void 0),P.jsx("br",{},void 0),P.jsx("span",{dangerouslySetInnerHTML:{__html:mr.format(a,i)}},void 0)]}),i)})},void 0)},t.prototype.render=function(){return P.jsx(Al,{children:this.getBindingComponents()},void 0)},t}(_e.PureComponent),Al=function(e){Le(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.render=function(){return P.jsx("div",E({className:"msp-help-text"},{children:P.jsx("div",{children:this.props.children},void 0)}),void 0)},t}(_e.PureComponent),Dl=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={header:r.props.header,isExpanded:!!r.props.initiallyExpanded},r.toggleExpanded=function(){return r.setState({isExpanded:!r.state.isExpanded})},r}return t.prototype.render=function(){return P.jsxs("div",E({className:"msp-control-group-wrapper"},{children:[P.jsx("div",E({className:"msp-control-group-header"},{children:P.jsxs(yr,E({onClick:this.toggleExpanded},{children:[P.jsx(cn,{svg:this.state.isExpanded?cd:dd},void 0),this.props.header]}),void 0)}),void 0),this.state.isExpanded&&P.jsx("div",E({className:"msp-control-offset",style:{display:this.state.isExpanded?"block":"none"}},{children:this.props.children}),void 0)]}),void 0)},t}(_e.PureComponent);function tI(e){return P.jsx("div",E({className:"msp-simple-help-section"},{children:e.header}),void 0)}var eL=function(e){Le(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.events.canvas3d.settingsUpdated,function(){return r.forceUpdate()})},t.prototype.render=function(){var r={};return this.plugin.spec.behaviors.forEach(function(n){var i=n.defaultParams.bindings;i&&Object.assign(r,i)}),P.jsxs(P.Fragment,{children:[!this.props.selectOnly&&this.plugin.canvas3d&&P.jsx(Dl,E({header:"Moving in 3D"},{children:P.jsx(WR,{bindings:this.plugin.canvas3d.props.trackball.bindings},void 0)}),"trackball"),P.jsx(Dl,E({header:"Mouse Controls"},{children:P.jsx(WR,{bindings:r},void 0)}),"interactions")]},void 0)},t}(br),aot=function(e){Le(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.events.canvas3d.settingsUpdated,function(){return r.forceUpdate()})},t.prototype.formatTriggers=function(r){return r.triggers.map(function(n){return mr.Trigger.format(n)}).join(" or ")},t.prototype.getTriggerFor=function(r,n){var i=this.plugin.state.behaviors,a=i.select(or.Generators.ofTransformer(r)),o=a.length===1?a[0].params:void 0,s=o?o.values.bindings:{},u=n in s?s[n]:mr.Empty;return this.formatTriggers(u)},t.prototype.render=function(){var r=this.getTriggerFor(hie,"clickSelectToggle"),n=this.getTriggerFor(AA,"clickFocus");return P.jsxs("div",{children:[P.jsx(tI,{header:"Interface Controls"},void 0),P.jsxs(Dl,E({header:"Inline Help"},{children:[P.jsx(Al,{children:"Many user interface elements show a little questionmark icon when hovered over. Clicking the icon toggles the display of an inline help text."},void 0),P.jsx(Al,{children:"Tooltips may provide additional information on a user interface element and are shown when hovering over it with the mouse."},void 0)]}),void 0),P.jsx(Dl,E({header:"Selections"},{children:P.jsxs(Al,{children:["The viewer allows changing colors and representations for selections of atoms, residues or chains. Selections can be created by",P.jsxs("ul",E({style:{paddingLeft:"20px"}},{children:[P.jsxs("li",{children:["picking elements on the 3D canvas or the sequence view using the mouse, e.g. toggle selection using ",r," (for more see help section on ",P.jsx("i",{children:"Mouse Controls"},void 0),")"]},void 0),P.jsxs("li",{children:["using the ",P.jsx("i",{children:"Add"},void 0),", ",P.jsx("i",{children:"Remove"},void 0)," and ",P.jsx("i",{children:"Only"},void 0)," dropdown buttons in the ",P.jsx("i",{children:"Manage Selection"},void 0)," panel which allow modifing the current selection by predefined sets"]},void 0)]}),void 0)]},void 0)}),void 0),P.jsx(Dl,E({header:"Coloring"},{children:P.jsxs(Al,{children:["There are two ways to color structures. Every representation (e.g. cartoon or spacefill) has a color theme which can be changed using the dropdown for each representation in the ",P.jsx("i",{children:"Structure Settings"},void 0)," panel. Additionally any selection atoms, residues or chains can by given a custom color. For that, first select the parts of the structure to be colored (see help section on ",P.jsx("i",{children:"Selections"},void 0),") and, second, choose a color from the color dropdown botton in the ",P.jsx("i",{children:"Selection"},void 0)," row of the ",P.jsx("i",{children:"Change Representation"},void 0)," panel. The theme color can be seen as a base color that is overpainted by the custom color. Custom colors can be removed for a selection with the 'Clear' option in the color dropdown."]},void 0)}),void 0),P.jsx(Dl,E({header:"Representations"},{children:P.jsxs(Al,{children:["Structures can be shown with many different representations (e.g. cartoon or spacefill). The ",P.jsx("i",{children:"Change Representation"},void 0)," panel offers a collection of predefined styles which can be applied using the ",P.jsx("i",{children:"Preset"},void 0)," dropdown button. Additionally any selection atoms, residues or chains can by shown with a custom representation. For that, first select the parts of the structure to be mofified (see help section on ",P.jsx("i",{children:"Selections"},void 0),") and, second, choose a representation to hide or show from the ",P.jsx("i",{children:"Show"},void 0)," and ",P.jsx("i",{children:"Hide"},void 0)," dropdown bottons in the ",P.jsx("i",{children:"Selection"},void 0)," row of the ",P.jsx("i",{children:"Change Representation"},void 0)," panel. The ",P.jsx("i",{children:"Everything"},void 0)," row applies the action to the whole structure instead of the current selection."]},void 0)}),void 0),P.jsx(Dl,E({header:"Surroundings"},{children:P.jsxs(Al,{children:["To show the surroundings of a residue or ligand, click it in the 3D scene or in the sequence widget using ",n,"."]},void 0)}),void 0),P.jsx(tI,{header:"How-to Guides"},void 0),P.jsx(Dl,E({header:"Create an Image"},{children:P.jsxs(Al,{children:[P.jsxs("p",{children:["Use the ",P.jsx(cn,{svg:RDe},void 0)," icon in the viewport to bring up the screenshot controls."]},void 0),P.jsxs("p",{children:["To adjust the size of the image, use the ",P.jsx("i",{children:"Resolution"},void 0)," dropdown."]},void 0)]},void 0)}),void 0),P.jsx(tI,{header:"Mouse Controls"},void 0),P.jsx(eL,{},void 0)]},void 0)},t}(br),Zw=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r._toggleSelMode=function(){r.plugin.selectionMode=!r.plugin.selectionMode},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.events.canvas3d.settingsUpdated,function(){return r.forceUpdate()}),this.subscribe(this.plugin.layout.events.updated,function(){return r.forceUpdate()}),this.subscribe(this.plugin.behaviors.interaction.selectionMode,function(){return r.forceUpdate()})},t.prototype.render=function(){var r=this.props.inline?{background:"transparent",width:"auto",height:"auto",lineHeight:"unset"}:{background:"transparent"};return P.jsx(Gt,{svg:kRe,onClick:this._toggleSelMode,title:"Toggle Selection Mode",style:r,toggleState:this.plugin.selectionMode},void 0)},t}(ea),oot={granularity:Qw.Params.granularity},Um=new Map([["add","Add/Union Selection"],["remove","Remove/Subtract Selection"],["intersect","Intersect Selection"],["set","Set Selection"]]),sot=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={action:void 0,helper:void 0,isEmpty:!0,isBusy:!1,canUndo:!1},r.set=function(n,i){r.plugin.managers.structure.selection.fromSelectionQuery(n,i,!1)},r.selectQuery=function(n,i){if(!n||!r.state.action){r.setState({action:void 0});return}var a=r.state.action;i!=null&&i.shiftKey?r.set(a,n.value):r.setState({action:void 0},function(){r.set(a,n.value)})},r.selectHelper=function(n,i){if(console.log(n),!n||!r.state.action){r.setState({action:void 0,helper:void 0});return}r.setState({helper:n.value.kind})},r.queriesItems=[],r.queriesVersion=-1,r.helpersItems=void 0,r.toggleAdd=r.showAction("add"),r.toggleRemove=r.showAction("remove"),r.toggleIntersect=r.showAction("intersect"),r.toggleSet=r.showAction("set"),r.toggleTheme=r.showAction("theme"),r.toggleAddComponent=r.showAction("add-component"),r.toggleHelp=r.showAction("help"),r.setGranuality=function(n){var i=n.value;r.plugin.managers.interactivity.setProps({granularity:i})},r.turnOff=function(){return r.plugin.selectionMode=!1},r.undo=function(){var n=r.plugin.state.data.undo();n&&r.plugin.runTask(n)},r.subtract=function(){for(var n=r.plugin.managers.structure.hierarchy.getStructuresWithSelection(),i=[],a=0,o=n;a<o.length;a++){var s=o[a];i.push.apply(i,s.components)}i.length!==0&&r.plugin.managers.structure.component.modifyByCurrentSelection(i,"subtract")},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.managers.structure.hierarchy.behaviors.selection,function(n){var i=n.hierarchy.structures.length===0;r.state.isEmpty!==i&&r.setState({isEmpty:i}),r.queriesVersion=-1,r.forceUpdate()}),this.subscribe(this.plugin.behaviors.state.isBusy,function(n){r.setState({isBusy:n,action:void 0})}),this.subscribe(this.plugin.managers.interactivity.events.propsUpdated,function(){r.forceUpdate()}),this.subscribe(this.plugin.state.data.events.historyUpdated,function(n){var i=n.state;r.setState({canUndo:i.canUndo})})},Object.defineProperty(t.prototype,"isDisabled",{get:function(){return this.state.isBusy||this.state.isEmpty},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"structures",{get:function(){for(var r,n=[],i=0,a=this.plugin.managers.structure.hierarchy.selection.structures;i<a.length;i++){var o=a[i],s=(r=o.cell.obj)===null||r===void 0?void 0:r.data;s&&n.push(s)}return n},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"queries",{get:function(){var r=this.plugin.query.structure.registry;if(r.version!==this.queriesVersion){var n=this.structures,i=Nt(Nt(Nt(Nt([],r.list),lZe(n)),uZe(n)),sZe(n)).sort(function(a,o){return o.priority-a.priority});this.queriesItems=rr.createItems(i,{filter:function(a){return a!==bi.current&&!a.isHidden},label:function(a){return a.label},category:function(a){return a.category},description:function(a){return a.description}}),this.queriesVersion=r.version}return this.queriesItems},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"helpers",{get:function(){if(this.helpersItems)return this.helpersItems;var r=[{kind:"residue-list",category:"Helpers",label:"Atom/Residue Identifier List",description:"Create a selection from a list of atom/residue ranges."}];return this.helpersItems=rr.createItems(r,{label:function(n){return n.label},category:function(n){return n.category},description:function(n){return n.description}}),this.helpersItems},enumerable:!1,configurable:!0}),t.prototype.showAction=function(r){var n=this;return function(){return n.setState({action:n.state.action===r?void 0:r,helper:void 0})}},t.prototype.render=function(){var r=this,n=this.plugin.managers.interactivity.props.granularity,i=this.state.canUndo?"Undo "+this.plugin.state.data.latestUndoLabel:"Some mistakes of the past can be undone.",a=void 0;if(this.state.action&&!this.state.helper)a=P.jsxs(P.Fragment,{children:[this.state.action&&this.state.action!=="theme"&&this.state.action!=="add-component"&&this.state.action!=="help"&&P.jsxs("div",E({className:"msp-selection-viewport-controls-actions"},{children:[P.jsx(rr,{header:Um.get(this.state.action),title:"Click to close.",items:this.queries,onSelect:this.selectQuery,noOffset:!0},void 0),P.jsx(rr,{items:this.helpers,onSelect:this.selectHelper,noOffset:!0},void 0)]}),void 0),this.state.action==="theme"&&P.jsx("div",E({className:"msp-selection-viewport-controls-actions"},{children:P.jsx(zc,E({header:"Theme",title:"Click to close.",initialExpanded:!0,hideExpander:!0,hideOffset:!0,onHeaderClick:this.toggleTheme,topRightIcon:jc},{children:P.jsx(lot,{onApply:this.toggleTheme},void 0)}),void 0)}),void 0),this.state.action==="add-component"&&P.jsx("div",E({className:"msp-selection-viewport-controls-actions"},{children:P.jsx(zc,E({header:"Add Component",title:"Click to close.",initialExpanded:!0,hideExpander:!0,hideOffset:!0,onHeaderClick:this.toggleAddComponent,topRightIcon:jc},{children:P.jsx(jie,{onApply:this.toggleAddComponent,forSelection:!0},void 0)}),void 0)}),void 0),this.state.action==="help"&&P.jsx("div",E({className:"msp-selection-viewport-controls-actions"},{children:P.jsxs(zc,E({header:"Help",title:"Click to close.",initialExpanded:!0,hideExpander:!0,hideOffset:!0,onHeaderClick:this.toggleHelp,topRightIcon:jc,maxHeight:"300px"},{children:[P.jsx(Dl,E({header:"Selection Operations"},{children:P.jsxs(Al,{children:["Use ",P.jsx(cn,{svg:eD,inline:!0},void 0)," ",P.jsx(cn,{svg:tD,inline:!0},void 0)," ",P.jsx(cn,{svg:rD,inline:!0},void 0)," ",P.jsx(cn,{svg:tw,inline:!0},void 0)," to modify the selection."]},void 0)}),void 0),P.jsx(Dl,E({header:"Representation Operations"},{children:P.jsxs(Al,{children:["Use ",P.jsx(cn,{svg:iD,inline:!0},void 0)," ",P.jsx(cn,{svg:nD,inline:!0},void 0)," ",P.jsx(cn,{svg:uD,inline:!0},void 0)," ",P.jsx(cn,{svg:lD,inline:!0},void 0)," to color, create components, remove from components, or undo actions."]},void 0)}),void 0),P.jsx(eL,{selectOnly:!0},void 0)]}),void 0)}),void 0)]},void 0);else if(Um.has(this.state.action)&&this.state.helper==="residue-list"){var o=function(){return r.setState({action:void 0,helper:void 0})};a=P.jsx("div",E({className:"msp-selection-viewport-controls-actions"},{children:P.jsx(zc,E({header:"Atom/Residue Identifier List",title:"Click to close.",initialExpanded:!0,hideExpander:!0,hideOffset:!0,onHeaderClick:o,topRightIcon:jc},{children:P.jsx(dot,{modifier:this.state.action,plugin:this.plugin,close:o},void 0)}),void 0)}),void 0)}return P.jsxs(P.Fragment,{children:[P.jsxs("div",E({className:"msp-flex-row",style:{background:"none"}},{children:[P.jsx(Qm,{title:"Picking Level for selecting and highlighting",param:oot.granularity,name:"granularity",value:n,onChange:this.setGranuality,isDisabled:this.isDisabled},void 0),P.jsx(Fi,{icon:eD,title:Um.get("add")+". Hold shift key to keep menu open.",toggle:this.toggleAdd,isSelected:this.state.action==="add",disabled:this.isDisabled},void 0),P.jsx(Fi,{icon:tD,title:Um.get("remove")+". Hold shift key to keep menu open.",toggle:this.toggleRemove,isSelected:this.state.action==="remove",disabled:this.isDisabled},void 0),P.jsx(Fi,{icon:rD,title:Um.get("intersect")+". Hold shift key to keep menu open.",toggle:this.toggleIntersect,isSelected:this.state.action==="intersect",disabled:this.isDisabled},void 0),P.jsx(Fi,{icon:tw,title:Um.get("set")+". Hold shift key to keep menu open.",toggle:this.toggleSet,isSelected:this.state.action==="set",disabled:this.isDisabled},void 0),P.jsx(Fi,{icon:iD,title:"Apply Theme to Selection",toggle:this.toggleTheme,isSelected:this.state.action==="theme",disabled:this.isDisabled,style:{marginLeft:"10px"}},void 0),P.jsx(Fi,{icon:nD,title:"Create Component of Selection with Representation",toggle:this.toggleAddComponent,isSelected:this.state.action==="add-component",disabled:this.isDisabled},void 0),P.jsx(Gt,{svg:uD,title:"Remove/subtract Selection from all Components",onClick:this.subtract,disabled:this.isDisabled},void 0),P.jsx(Gt,{svg:lD,onClick:this.undo,disabled:!this.state.canUndo||this.isDisabled,title:i},void 0),P.jsx(Fi,{icon:Kl,title:"Show/hide help",toggle:this.toggleHelp,style:{marginLeft:"10px"},isSelected:this.state.action==="help"},void 0),P.jsx(Gt,{svg:P6,title:"Turn selection mode off",onClick:this.turnOff},void 0)]}),void 0),a]},void 0)},t}(br),uot=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isEmpty:!0,isBusy:!1},r.clear=function(){return r.plugin.managers.interactivity.lociSelects.deselectAll()},r.focus=function(){if(r.plugin.managers.structure.selection.stats.elementCount!==0){var n=r.plugin.managers.structure.selection.getBoundary().sphere;r.plugin.managers.camera.focusSphere(n)}},r.highlight=function(n){r.plugin.managers.interactivity.lociHighlights.clearHighlights(),r.plugin.managers.structure.selection.entries.forEach(function(i){r.plugin.managers.interactivity.lociHighlights.highlight({loci:i.selection},!1)})},r.clearHighlight=function(){r.plugin.managers.interactivity.lociHighlights.clearHighlights()},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.managers.structure.selection.events.changed,function(){r.forceUpdate()}),this.subscribe(this.plugin.managers.structure.hierarchy.behaviors.selection,function(n){var i=n.structures.length===0;r.state.isEmpty!==i&&r.setState({isEmpty:i})}),this.subscribe(this.plugin.behaviors.state.isBusy,function(n){r.setState({isBusy:n})})},Object.defineProperty(t.prototype,"isDisabled",{get:function(){return this.state.isBusy||this.state.isEmpty},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"stats",{get:function(){var r=this.plugin.managers.structure.selection.stats;return r.structureCount===0||r.elementCount===0?"Nothing Selected":Wf(r.label)+" Selected"},enumerable:!1,configurable:!0}),t.prototype.render=function(){var r=this.plugin.managers.structure.selection.stats,n=r.structureCount===0||r.elementCount===0;return n&&this.props.hideOnEmpty?null:P.jsx(P.Fragment,{children:P.jsxs("div",E({className:"msp-flex-row"},{children:[P.jsx(yr,E({noOverflow:!0,onClick:this.focus,title:"Click to Focus Selection",disabled:n,onMouseEnter:this.highlight,onMouseLeave:this.clearHighlight,style:{textAlignLast:n?void 0:"left"}},{children:this.stats}),void 0),!n&&P.jsx(Gt,{svg:P6,onClick:this.clear,title:"Clear",className:"msp-form-control",flex:!0},void 0)]}),void 0)},void 0)},t}(br),lot=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r._params=Rh(function(n){return Vv.getThemeParams(r.plugin,n)}),r.state={values:I.getDefaultValues(r.params)},r.apply=function(){var n,i;r.plugin.managers.structure.component.applyTheme(r.state.values,r.plugin.managers.structure.hierarchy.current.structures),(i=(n=r.props).onApply)===null||i===void 0||i.call(n)},r.paramsChanged=function(n){return r.setState({values:n})},r}return Object.defineProperty(t.prototype,"params",{get:function(){return this._params(this.plugin.managers.structure.component.pivotStructure)},enumerable:!1,configurable:!0}),t.prototype.render=function(){return P.jsxs(P.Fragment,{children:[P.jsx(Vn,{params:this.params,values:this.state.values,onChangeValues:this.paramsChanged},void 0),P.jsx(yr,E({icon:iD,className:"msp-btn-commit msp-btn-commit-on",onClick:this.apply,style:{marginTop:"1px"}},{children:"Apply Theme"}),void 0)]},void 0)},t}(ea),Vie={idType:I.Select("auth",I.arrayToOptions(["auth","label","atom-id"])),identifiers:I.Text("",{description:"A comma separated list of atom identifiers (e.g. 10, 15-25) or residue ranges in given chain (e.g. A 10-15, B 25, C 30:i)"})},cot=I.getDefaultValues(Vie);function dot(e){var t=e.modifier,r=e.plugin,n=e.close,i=_e.useState(cot),a=i[0],o=i[1],s=function(){if(a.identifiers.trim().length!==0)try{n();var u=not(a.identifiers,a.idType);r.managers.structure.selection.fromCompiledQuery(t,u,!1)}catch(l){r.log.error("Failed to create selection: "+l)}};return P.jsxs(P.Fragment,{children:[P.jsx(Vn,{params:Vie,values:a,onChangeValues:o,onEnter:s},void 0),P.jsxs(yr,E({className:"msp-btn-commit msp-btn-commit-on",disabled:a.identifiers.trim().length===0,onClick:s,style:{marginTop:"1px"}},{children:[L0(t)," Selection"]}),void 0)]},void 0)}var fot=function(e){Le(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.defaultState=function(){return{isCollapsed:!1,header:"Measurements",brand:{accent:"gray",svg:hDe}}},t.prototype.renderControls=function(){return P.jsxs(P.Fragment,{children:[P.jsx(pot,{},void 0),P.jsx(hot,{},void 0)]},void 0)},t}(U0),hot=function(e){Le(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.managers.structure.measurement.behaviors.state,function(){r.forceUpdate()})},t.prototype.renderGroup=function(r,n){for(var i=[],a=0,o=r;a<o.length;a++){var s=o[a];s.obj&&i.push(P.jsx(mot,{cell:s},s.obj.id))}return i.length?P.jsx(qu,E({header:n,initiallyExpanded:!0},{children:i}),void 0):null},t.prototype.render=function(){var r=this.plugin.managers.structure.measurement.state;return P.jsxs("div",E({style:{marginTop:"6px"}},{children:[this.renderGroup(r.labels,"Labels"),this.renderGroup(r.distances,"Distances"),this.renderGroup(r.angles,"Angles"),this.renderGroup(r.dihedrals,"Dihedrals")]}),void 0)},t}(ea),pot=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isBusy:!1,action:void 0},r.measureDistance=function(){var n=r.plugin.managers.structure.selection.additionsHistory;r.plugin.managers.structure.measurement.addDistance(n[0].loci,n[1].loci)},r.measureAngle=function(){var n=r.plugin.managers.structure.selection.additionsHistory;r.plugin.managers.structure.measurement.addAngle(n[0].loci,n[1].loci,n[2].loci)},r.measureDihedral=function(){var n=r.plugin.managers.structure.selection.additionsHistory;r.plugin.managers.structure.measurement.addDihedral(n[0].loci,n[1].loci,n[2].loci,n[3].loci)},r.addLabel=function(){var n=r.plugin.managers.structure.selection.additionsHistory;r.plugin.managers.structure.measurement.addLabel(n[0].loci)},r.selectAction=function(n){r.toggleAdd(),n&&(n==null?void 0:n.value)()},r.toggleAdd=function(){return r.setState({action:r.state.action==="add"?void 0:"add"})},r.toggleOptions=function(){return r.setState({action:r.state.action==="options"?void 0:"options"})},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.selection.events.additionsHistoryUpdated,function(){r.forceUpdate()}),this.subscribe(this.plugin.behaviors.state.isBusy,function(n){r.setState({isBusy:n})})},Object.defineProperty(t.prototype,"selection",{get:function(){return this.plugin.managers.structure.selection},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"actions",{get:function(){var r=this.selection.additionsHistory,n=[{kind:"item",label:"Label "+(r.length===0?" (1 selection required)":" (1st selection)"),value:this.addLabel,disabled:r.length===0},{kind:"item",label:"Distance "+(r.length<2?" (2 selections required)":" (top 2 selections)"),value:this.measureDistance,disabled:r.length<2},{kind:"item",label:"Angle "+(r.length<3?" (3 selections required)":" (top 3 selections)"),value:this.measureAngle,disabled:r.length<3},{kind:"item",label:"Dihedral "+(r.length<4?" (4 selections required)":" (top 4 selections)"),value:this.measureDihedral,disabled:r.length<4}];return n},enumerable:!1,configurable:!0}),t.prototype.highlight=function(r){this.plugin.managers.interactivity.lociHighlights.highlightOnly({loci:r},!1)},t.prototype.moveHistory=function(r,n){this.plugin.managers.structure.selection.modifyHistory(r,n,4)},t.prototype.focusLoci=function(r){this.plugin.managers.camera.focusLoci(r)},t.prototype.historyEntry=function(r,n){var i=this,a=this.plugin.managers.structure.selection.additionsHistory;return P.jsxs("div",E({className:"msp-flex-row"},{children:[P.jsxs(yr,E({noOverflow:!0,title:"Click to focus. Hover to highlight.",onClick:function(){return i.focusLoci(r.loci)},style:{width:"auto",textAlign:"left"},onMouseEnter:function(){return i.highlight(r.loci)},onMouseLeave:this.plugin.managers.interactivity.lociHighlights.clearHighlights},{children:[n,". ",P.jsx("span",{dangerouslySetInnerHTML:{__html:r.label}},void 0)]}),void 0),a.length>1&&P.jsx(Gt,{svg:kE,small:!0,className:"msp-form-control",onClick:function(){return i.moveHistory(r,"up")},flex:"20px",title:"Move up"},void 0),a.length>1&&P.jsx(Gt,{svg:RE,small:!0,className:"msp-form-control",onClick:function(){return i.moveHistory(r,"down")},flex:"20px",title:"Move down"},void 0),P.jsx(Gt,{svg:iu,small:!0,className:"msp-form-control",onClick:function(){return i.plugin.managers.structure.selection.modifyHistory(r,"remove")},flex:!0,title:"Remove"},void 0)]}),r.id)},t.prototype.add=function(){for(var r=this.plugin.managers.structure.selection.additionsHistory,n=[],i=0,a=Math.min(r.length,4);i<a;i++)n.push(this.historyEntry(r[i],i+1));return P.jsxs(P.Fragment,{children:[P.jsx(rr,{items:this.actions,onSelect:this.selectAction},void 0),n.length>0&&P.jsx("div",E({className:"msp-control-offset"},{children:n}),void 0),n.length===0&&P.jsx("div",E({className:"msp-control-offset msp-help-text"},{children:P.jsxs("div",E({className:"msp-help-description"},{children:[P.jsx(cn,{svg:Kl,inline:!0},void 0),"Add one or more selections (toggle ",P.jsx(Zw,{inline:!0},void 0)," mode)"]}),void 0)}),void 0)]},void 0)},t.prototype.render=function(){return P.jsxs(P.Fragment,{children:[P.jsxs("div",E({className:"msp-flex-row"},{children:[P.jsx(Fi,{icon:N0,label:"Add",toggle:this.toggleAdd,isSelected:this.state.action==="add",disabled:this.state.isBusy,className:"msp-btn-apply-simple"},void 0),P.jsx(Fi,{icon:Pv,label:"",title:"Options",toggle:this.toggleOptions,isSelected:this.state.action==="options",disabled:this.state.isBusy,style:{flex:"0 0 40px",padding:0}},void 0)]}),void 0),this.state.action==="add"&&this.add(),this.state.action==="options"&&P.jsx(vot,{},void 0)]},void 0)},t}(ea),vot=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isDisabled:!1},r.changed=function(n){r.plugin.managers.structure.measurement.setOptions(n)},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.managers.structure.measurement.behaviors.state,function(){r.forceUpdate()}),this.subscribe(this.plugin.behaviors.state.isBusy,function(n){r.setState({isDisabled:n})})},t.prototype.render=function(){var r=this.plugin.managers.structure.measurement.state;return P.jsx("div",E({className:"msp-control-offset"},{children:P.jsx(Vn,{params:zie,values:r.options,onChangeValues:this.changed,isDisabled:this.state.isDisabled},void 0)}),void 0)},t}(ea),mot=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={showUpdate:!1},r.delete=function(){_t.State.RemoveObject(r.plugin,{state:r.props.cell.parent,ref:r.props.cell.transform.parent,removeParentGhosts:!0})},r.toggleVisibility=function(n){n.preventDefault(),_t.State.ToggleVisibility(r.plugin,{state:r.props.cell.parent,ref:r.props.cell.transform.parent}),n.currentTarget.blur()},r.highlight=function(){var n,i=r.selections;if(i){r.plugin.managers.interactivity.lociHighlights.clearHighlights();for(var a=0,o=r.lociArray;a<o.length;a++){var s=o[a];r.plugin.managers.interactivity.lociHighlights.highlight({loci:s},!1)}r.plugin.managers.interactivity.lociHighlights.highlight({loci:(n=r.props.cell.obj)===null||n===void 0?void 0:n.data.repr.getLoci()},!1)}},r.clearHighlight=function(){r.plugin.managers.interactivity.lociHighlights.clearHighlights()},r.toggleUpdate=function(){return r.setState({showUpdate:!r.state.showUpdate})},r.focus=function(){var n=r.selections;if(n){var i=sr.getBundleBoundingSphere({loci:r.lociArray});i&&r.plugin.managers.camera.focusSphere(i)}},r.selectAction=function(n){n&&(r.setState({showUpdate:!1}),(n==null?void 0:n.value)())},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.state.events.cell.stateUpdated,function(n){r.forceUpdate()})},Object.defineProperty(t.prototype,"selections",{get:function(){var r;return(r=this.props.cell.obj)===null||r===void 0?void 0:r.data.sourceData},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"lociArray",{get:function(){var r=this.selections;return r?r.infos?[r.infos[0].loci]:r.pairs?r.pairs[0].loci:r.triples?r.triples[0].loci:r.quads?r.quads[0].loci:[]:[]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"label",{get:function(){var r=this.selections;return r?r.infos?Fh(r.infos[0].loci,{condensed:!0}):r.pairs?dA(r.pairs[0],{condensed:!0,unitLabel:this.plugin.managers.structure.measurement.state.options.distanceUnitLabel}):r.triples?fA(r.triples[0],{condensed:!0}):r.quads?hA(r.quads[0],{condensed:!0}):"<empty>":"<empty>"},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"actions",{get:function(){var r=this;return this.props.cell.sourceRef,[rr.Item("Select This",function(){return r.plugin.managers.structure.selection.fromSelections(r.props.cell.sourceRef)},{icon:tw})]},enumerable:!1,configurable:!0}),t.prototype.render=function(){var r=this.props.cell,n=r.obj;return n?P.jsxs(P.Fragment,{children:[P.jsxs("div",E({className:"msp-flex-row",onMouseEnter:this.highlight,onMouseLeave:this.clearHighlight},{children:[P.jsx("button",E({className:"msp-form-control msp-control-button-label msp-no-overflow",title:"Click to focus. Hover to highlight.",onClick:this.focus,style:{width:"auto",textAlign:"left"}},{children:P.jsx("span",{dangerouslySetInnerHTML:{__html:this.label}},void 0)}),void 0),P.jsx(Gt,{svg:r.state.isHidden?Zv:Jv,toggleState:!1,small:!0,className:"msp-form-control",onClick:this.toggleVisibility,flex:!0,title:r.state.isHidden?"Show":"Hide"},void 0),P.jsx(Gt,{svg:iu,small:!0,className:"msp-form-control",onClick:this.delete,flex:!0,title:"Delete",toggleState:!1},void 0),P.jsx(Gt,{svg:Av,className:"msp-form-control",onClick:this.toggleUpdate,flex:!0,title:"Actions",toggleState:this.state.showUpdate},void 0)]}),n.id),this.state.showUpdate&&r.parent&&P.jsx(P.Fragment,{children:P.jsxs("div",E({className:"msp-accent-offset"},{children:[P.jsx(rr,{items:this.actions,onSelect:this.selectAction,noOffset:!0},void 0),P.jsx(qu,E({header:"Options",noOffset:!0},{children:P.jsx(wd,{state:r.parent,transform:r.transform,customHeader:"none",autoHideApply:!0},void 0)}),void 0)]}),void 0)},void 0)]},void 0):null},t}(ea);function rI(e,t,r,n){for(var i=Je.indexOf(t.unit.elements,t.element),a=Re(t.structure,[{unit:t.unit,indices:Fe.ofSingleton(i)}]),o=n==="residue"?Re.extendToWholeResidues(a):Re.extendToWholeChains(a),s=lt.entity.pdbx_description(t).join(", "),u=0,l=r.units;u<l.length;u++){var c=l[u],d=Re(o.structure,[{unit:c,indices:o.elements[0].indices}]),f=Fh(d,{reverse:!0,hidePrefix:!0,htmlStyling:!1,granularity:n});f||(f=Fh(d,{hidePrefix:!1,htmlStyling:!1})),r.units.length>1&&(f+=" | "+d.elements[0].unit.conformation.operator.name);var h={label:f,category:s,loci:d};e.has(s)?e.get(s).push(h):e.set(s,[h])}}function got(e){for(var t=new Map,r=Ze.create(e),n=0,i=e.unitSymmetryGroups;n<i.length;n++){var a=i[n];if(je.isAtomic(a.units[0])){r.unit=a.units[0],r.element=a.elements[0];var o=je.Traits.is(r.unit.traits,1),s=lt.entity.type(r),u=s==="non-polymer",l=s==="branched",c=!!lt.entity.prd_id(r);if(c)rI(t,r,a,"chain");else if(u&&!o)rI(t,r,a,"residue");else if(l||u&&o)for(var d=r.unit,f=d.model.atomicHierarchy.residueAtomSegments.index,h=-1,v=0,p=d.elements.length;v<p;++v){var m=d.elements[v],g=f[m];g!==h&&(r.element=m,rI(t,r,a,"residue"),h=g)}}}var y=[];return t.forEach(function(b,S){b.length===1?y.push({label:S+": "+b[0].label,loci:b[0].loci}):b.length<2e3&&y.push.apply(y,b)}),y}var yot=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isBusy:!1,showAction:!1},r.getSelectionItems=Rh(function(n){for(var i,a=[],o=0,s=n;o<s.length;o++){var u=s[o],l=(i=u.cell.obj)===null||i===void 0?void 0:i.data;if(l){var c=got(l);c.length>0&&a.push(Nt([rr.Header(l.label,{description:l.label})],rr.createItems(c,{label:function(d){return d.label},category:function(d){return d.category},description:function(d){return d.label}})))}}return a}),r.selectAction=function(n,i){if(!n||!r.state.showAction){r.setState({showAction:!1});return}var a=n.value;i!=null&&i.shiftKey?r.plugin.managers.structure.focus.addFromLoci(a.loci):r.plugin.managers.structure.focus.set(a),r.focusCamera()},r.toggleAction=function(){return r.setState({showAction:!r.state.showAction})},r.focusCamera=function(){var n=r.plugin.managers.structure.focus.current;n&&r.plugin.managers.camera.focusLoci(n.loci)},r.clear=function(){r.plugin.managers.structure.focus.clear(),r.plugin.managers.camera.reset()},r.highlightCurrent=function(){var n=r.plugin.managers.structure.focus.current;n&&r.plugin.managers.interactivity.lociHighlights.highlightOnly({loci:n.loci},!1)},r.clearHighlights=function(){r.plugin.managers.interactivity.lociHighlights.clearHighlights()},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.managers.structure.focus.behaviors.current,function(n){r.getSelectionItems([]),r.forceUpdate()}),this.subscribe(this.plugin.managers.structure.focus.events.historyUpdated,function(n){r.forceUpdate()}),this.subscribe(this.plugin.behaviors.state.isBusy,function(n){r.setState({isBusy:n,showAction:!1})})},Object.defineProperty(t.prototype,"isDisabled",{get:function(){return this.state.isBusy||this.actionItems.length===0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"actionItems",{get:function(){var r=[],n=this.plugin.managers.structure.focus.history;n.length>0&&r.push(Nt([rr.Header("History",{description:"Previously focused on items."})],rr.createItems(n,{label:function(u){return u.label},description:function(u){return u.category&&u.label!==u.category?u.category+" | "+u.label:u.label}})));var i=this.getSelectionItems(this.plugin.managers.structure.hierarchy.selection.structures);if(i.length===1){var a=i[0],o=a[0];o.initiallyExpanded=!0}var s=[];return i.length>0&&s.push.apply(s,i),r.length>0&&s.push.apply(s,r),s},enumerable:!1,configurable:!0}),t.prototype.getToggleBindingLabel=function(){var r,n=this.plugin.state.behaviors.transforms.get(AA.id);if(!n)return"";var i=(r=n.params)===null||r===void 0?void 0:r.bindings.clickFocus;return!i||mr.isEmpty(i)?"":mr.formatTriggers(i)},t.prototype.render=function(){var r=this.plugin.managers.structure.focus.current,n=(r==null?void 0:r.label)||"Nothing Focused",i="Click to Center Camera";if(!r){i="Select focus using the menu";var a=this.getToggleBindingLabel();a&&(i+=`
or use '`+a+"' on element")}return P.jsxs(P.Fragment,{children:[P.jsxs("div",E({className:"msp-flex-row"},{children:[P.jsx(yr,E({noOverflow:!0,onClick:this.focusCamera,title:i,onMouseEnter:this.highlightCurrent,onMouseLeave:this.clearHighlights,disabled:this.isDisabled||!r,style:{textAlignLast:r?"left":void 0}},{children:n}),void 0),r&&P.jsx(Gt,{svg:P6,onClick:this.clear,title:"Clear",className:"msp-form-control",flex:!0,disabled:this.isDisabled},void 0),P.jsx(Fi,{icon:LDe,title:"Select a focus target to center on an show its surroundings. Hold shift to focus on multiple targets.",toggle:this.toggleAction,isSelected:this.state.showAction,disabled:this.isDisabled,style:{flex:"0 0 40px",padding:0}},void 0)]}),void 0),this.state.showAction&&P.jsx(rr,{items:this.actionItems,onSelect:this.selectAction},void 0)]},void 0)},t}(br),bot=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.item=function(n){var i,a,o,s,u,l,c,d,f,h=r.plugin.managers.structure.hierarchy.seletionSet,v;switch(n.kind){case"model":{var p=(i=n.cell.obj)===null||i===void 0?void 0:i.data;p&&Xt.TrajectoryInfo.get(p).size>1&&(v=((a=n.cell.obj)===null||a===void 0?void 0:a.data.entryId)+" | Model "+(Xt.TrajectoryInfo.get(p).index+1)+" of "+Xt.TrajectoryInfo.get(p).size),v=((o=n.cell.obj)===null||o===void 0?void 0:o.data.entryId)+" | "+((s=n.cell.obj)===null||s===void 0?void 0:s.label);break}case"structure":{var p=(u=n.cell.obj)===null||u===void 0?void 0:u.data.models[0];if(p&&Xt.TrajectoryInfo.get(p).size>1){v=p.entryId+" | "+((l=n.cell.obj)===null||l===void 0?void 0:l.label)+" (Model "+(Xt.TrajectoryInfo.get(p).index+1)+" of "+Xt.TrajectoryInfo.get(p).size+")";break}else if(p){v=p.entryId+" | "+((c=n.cell.obj)===null||c===void 0?void 0:c.label);break}else{v=""+((d=n.cell.obj)===null||d===void 0?void 0:d.label);break}}default:v=(f=n.cell.obj)===null||f===void 0?void 0:f.label;break}var m={kind:"item",label:v||n.kind,selected:h.has(n.cell.transform.ref),value:[n]};return m},r.getTrajectoryItems=function(n){var i;return n.models.length===0?r.item(n):Nt([rr.Header((i=n.cell.obj)===null||i===void 0?void 0:i.label)],n.models.map(r.getModelItems))},r.getModelItems=function(n){var i,a,o;if(n.structures.length===0)return r.item(n);if(n.structures.length===1){var s=r.plugin.managers.structure.hierarchy.seletionSet,u=n.structures[0];return{label:((i=n.cell.obj)===null||i===void 0?void 0:i.label)+" | "+((a=u.cell.obj)===null||a===void 0?void 0:a.label),selected:s.has(u.cell.transform.ref),value:[n,u]}}return Nt([rr.Header((o=n.cell.obj)===null||o===void 0?void 0:o.label)],n.structures.map(r.item))},r.selectHierarchy=function(n){if(!(!n||n.length===0)){for(var i=[],a=0,o=n;a<o.length;a++)for(var s=o[a],u=0,l=s.value;u<l.length;u++){var c=l[u];i.push(c)}r.plugin.managers.structure.hierarchy.updateCurrent(i,n[0].selected?"remove":"add")}},r.toggleHierarchy=function(){return r.setState({show:r.state.show!=="hierarchy"?"hierarchy":void 0})},r.togglePreset=function(){return r.setState({show:r.state.show!=="presets"?"presets":void 0})},r.applyPreset=function(n){if(r.setState({show:void 0}),!!n){var i=r.plugin.managers.structure,a=i.hierarchy.selection.trajectories;i.hierarchy.applyPreset(a,n.value)}},r.updateModelQueueParams=void 0,r.isUpdatingModel=!1,r.updateStructureModel=function(n){r.updateModelQueueParams=n,r._updateStructureModel()},r.updateStructure=function(n){var i=r.plugin.managers.structure.hierarchy.selection,a=i.structures[0];return r.plugin.managers.structure.hierarchy.updateStructure(a,n)},r}return t.prototype.defaultState=function(){return{header:"Structure",isCollapsed:!1,isBusy:!1,brand:{accent:"purple",svg:uDe}}},t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.managers.structure.hierarchy.behaviors.selection,function(){return r.forceUpdate()}),this.subscribe(this.plugin.behaviors.state.isBusy,function(n){r.setState({isBusy:n})})},Object.defineProperty(t.prototype,"hierarchyItems",{get:function(){var r=this.plugin.managers.structure.hierarchy,n=r.current,i=[];return n.trajectories.length>1&&i.push(Nt([rr.Header("Trajectories")],n.trajectories.map(this.item))),(n.models.length>1||n.trajectories.length>1)&&i.push(Nt([rr.Header("Models")],n.models.map(this.item))),n.trajectories.length===1&&n.models.length===1?i.push.apply(i,n.structures.map(this.item)):n.structures.length>0&&i.push(Nt([rr.Header("Structures")],n.structures.map(this.item))),i},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isEmpty",{get:function(){var r=this.plugin.managers.structure.hierarchy.current,n=r.structures,i=r.models,a=r.trajectories;return a.length===0&&i.length===0&&n.length===0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"label",{get:function(){var r,n,i,a,o,s,u,l,c,d,f,h,v,p,m=this.plugin.managers.structure.hierarchy.selection,g=m.structures,y=m.models,b=m.trajectories;if(g.length===1){var S=g[0];return!((n=(r=S.model)===null||r===void 0?void 0:r.trajectory)===null||n===void 0)&&n.models&&S.model.trajectory.models.length===1?(i=S.cell.obj)===null||i===void 0?void 0:i.data.label:S.model?((a=S.model.cell.obj)===null||a===void 0?void 0:a.label)+" | "+((o=S.cell.obj)===null||o===void 0?void 0:o.data.label):(s=S.cell.obj)===null||s===void 0?void 0:s.data.label}if(g.length>1){for(var x=g[0],C=(u=x==null?void 0:x.model)===null||u===void 0?void 0:u.trajectory,w=!0,A=0,M=g;A<M.length;A++){var S=M[A];if(((l=S==null?void 0:S.model)===null||l===void 0?void 0:l.trajectory)!==C){w=!1;break}}return w&&C?((c=C.cell.obj)===null||c===void 0?void 0:c.label)+" | "+g.length+" structures":g.length+" structures"}if(y.length>0){var C=y[0].trajectory;if(y.length===1){var D=(d=y[0].cell.obj)===null||d===void 0?void 0:d.data;return D&&Xt.TrajectoryInfo.get(D).size>1?((f=C==null?void 0:C.cell.obj)===null||f===void 0?void 0:f.label)+" | Model "+(Xt.TrajectoryInfo.get(D).index+1)+" of "+Xt.TrajectoryInfo.get(D).size:((h=C==null?void 0:C.cell.obj)===null||h===void 0?void 0:h.label)+" | Model"}for(var w=!0,k=0,R=y;k<R.length;k++){var O=R[k];if(O.trajectory!==C){w=!1;break}}return w?((v=C==null?void 0:C.cell.obj)===null||v===void 0?void 0:v.label)+" | "+y.length+" models":y.length+" models"}return b.length>0?b.length===1?((p=b[0].cell.obj)===null||p===void 0?void 0:p.label)+" trajectory":b.length+" trajectories":b.length===0&&y.length===0&&g.length===0?"Nothing Loaded":"Nothing Selected"},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"presetActions",{get:function(){var r=[],n=this.plugin.managers.structure.hierarchy.selection.trajectories;if(n.length===0)return r;var i=this.plugin.builders.structure.hierarchy.getPresets(n[0].cell.obj);if(n.length>1){for(var a=new Set(i),o=1;o<n.length;o++)for(var s=this.plugin.builders.structure.hierarchy.getPresets(n[o].cell.obj),u=new Set(s),l=0,c=s;l<c.length;l++){var d=c[l];u.has(d)||a.delete(d)}i=i.filter(function(v){return a.has(v)})}for(var f=0,h=i;f<h.length;f++){var d=h[f];r.push(rr.Item(d.display.name,d,{description:d.display.description}))}return r},enumerable:!1,configurable:!0}),t.prototype._updateStructureModel=function(){return ce(this,void 0,void 0,function(){var r,n,i;return de(this,function(a){switch(a.label){case 0:if(!this.updateModelQueueParams||this.isUpdatingModel)return[2];r=this.updateModelQueueParams,this.updateModelQueueParams=void 0,a.label=1;case 1:return a.trys.push([1,,3,4]),this.isUpdatingModel=!0,n=this.plugin.managers.structure.hierarchy.selection,i=n.structures[0].model,[4,this.plugin.state.updateTransform(this.plugin.state.data,i.cell.transform.ref,r,"Model Index")];case 2:return a.sent(),[3,4];case 3:return this.isUpdatingModel=!1,this._updateStructureModel(),[7];case 4:return[2]}})})},Object.defineProperty(t.prototype,"modelIndex",{get:function(){var r,n,i=this.plugin.managers.structure.hierarchy.selection;if(i.structures.length!==1)return null;var a=i.structures[0].model;if(!a||a.cell.transform.transformer!==rt.Model.ModelFromTrajectory||!a.cell.obj||Xt.TrajectoryInfo.get(a.cell.obj.data).size<=1)return null;var o=(r=a.cell.params)===null||r===void 0?void 0:r.definition;return o?P.jsx(Vn,{params:o,values:(n=a.cell.params)===null||n===void 0?void 0:n.values,onChangeValues:this.updateStructureModel,isDisabled:this.state.isBusy},void 0):null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"structureType",{get:function(){var r,n=this.plugin.managers.structure.hierarchy.selection;if(n.structures.length!==1)return null;var i=n.structures[0],a=(r=i.cell.params)===null||r===void 0?void 0:r.definition;return!a||!i.cell.parent?null:P.jsx(wd,{state:i.cell.parent,transform:i.cell.transform,customHeader:"none",customUpdate:this.updateStructure,noMargin:!0,autoHideApply:!0},void 0)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"transform",{get:function(){var r=this.plugin.managers.structure.hierarchy.selection;if(r.structures.length!==1)return null;var n=r.structures[0];if(!n.cell.parent)return null;var i=or.tryFindDecorator(this.plugin.state.data,n.cell.transform.ref,rt.Model.TransformStructureConformation);if(i)return P.jsx(qu,E({header:"Conformation Transform"},{children:P.jsx(wd,{state:i.parent,transform:i.transform,customHeader:"none",noMargin:!0,autoHideApply:!0},void 0)}),void 0)},enumerable:!1,configurable:!0}),t.prototype.renderControls=function(){var r=this.state.isBusy||this.isEmpty,n=this.presetActions,i=this.label;return P.jsxs(P.Fragment,{children:[P.jsxs("div",E({className:"msp-flex-row",style:{marginTop:"1px"}},{children:[P.jsx(yr,E({noOverflow:!0,flex:!0,onClick:this.toggleHierarchy,disabled:r,title:i},{children:i}),void 0),n.length>0&&P.jsx(Gt,{svg:OE,className:"msp-form-control",flex:"40px",onClick:this.togglePreset,title:"Apply a structure presets to the current hierarchy.",toggleState:this.state.show==="presets",disabled:r},void 0)]}),void 0),this.state.show==="hierarchy"&&P.jsx(rr,{items:this.hierarchyItems,onSelect:this.selectHierarchy,multiselect:!0},void 0),this.state.show==="presets"&&P.jsx(rr,{items:n,onSelect:this.applyPreset},void 0),this.modelIndex,this.structureType,this.transform,P.jsxs("div",E({style:{marginTop:"6px"}},{children:[P.jsx(yot,{},void 0),P.jsx(uot,{hideOnEmpty:!0},void 0)]}),void 0)]},void 0)},t}(U0);function xot(e,t){var r=wot(e,t||tL());return Iot(e.tree,r),t&&t.refs.forEach(Pot,r),{hierarchy:r.hierarchy,added:r.added,changed:r.changed}}function tL(){return{volumes:[],lazyVolumes:[],refs:new Map}}function Sot(e){return{kind:"volume",cell:e,version:e.transform.version,representations:[]}}function Cot(e){return{kind:"lazy-volume",cell:e,version:e.transform.version}}function _ot(e,t){return{kind:"volume-representation",cell:e,version:e.transform.version,volume:t}}function wot(e,t){return{state:e,oldHierarchy:t,hierarchy:tL(),changed:!1,added:new Set}}function nI(e,t,r,n){for(var i=[],a=4;a<arguments.length;a++)i[a-4]=arguments[a];var o=n.apply(void 0,i);r.push(o),e.hierarchy.refs.set(t.transform.ref,o);var s=e.oldHierarchy.refs.get(t.transform.ref);return s?s.version!==t.transform.version&&(e.changed=!0):(e.added.add(o.cell.transform.ref),e.changed=!0),o}function Eot(e,t){return function(r,n){return!t(n)&&e.is(r.obj)}}function uG(){}var Aot=[[Eot(ge.Volume.Data,function(e){return e.currentVolume}),function(e,t){e.currentVolume=nI(e,t,e.hierarchy.volumes,Sot,t)},function(e){return e.currentVolume=void 0}],[function(e){return ge.Volume.Lazy.is(e.obj)},function(e,t){nI(e,t,e.hierarchy.lazyVolumes,Cot,t)},uG],[function(e,t){return!e.state.isGhost&&!!t.currentVolume&&ge.Volume.Representation3D.is(e.obj)},function(e,t){return e.currentVolume&&nI(e,t,e.currentVolume.representations,_ot,t,e.currentVolume),!1},uG]];function Hie(e){if(!e||!(e!=null&&e.parent)||!e.parent.cells.has(e.transform.ref))return!1;var t=e.obj;return!(!t||t===Nn.Null||e.status!=="ok"&&e.status!=="error")}function Pot(e){var t=e.cell;Hie(t)||(this.changed=!0)}function Tot(e){Gie(this,this.tree.transforms.get(e))}function Gie(e,t){var r=e.state,n=r.state.cells.get(t.ref);if(Hie(n)){for(var i=void 0,a=!1,o=0,s=Aot;o<s.length;o++){var u=s[o],l=u[0],c=u[1],d=u[2];if(l(n,r)){var f=c(r,n);if(f===!1){a=!0;break}i=d;break}}if(!a){var h=e.tree.children.get(t.ref);h&&h.size&&h.forEach(Tot,e),i&&i(r)}}}function Iot(e,t){var r={tree:e,state:t};return Gie(r,e.root),r.state}function Hg(e,t,r){r===void 0&&(r={});var n=r;return typeof n.type=="string"||typeof n.color=="string"||typeof n.size=="string"?Mot(e,t||Ct.One,r):qie(e,t||Ct.One,r)}function Mot(e,t,r){var n=r.type&&e.representation.volume.registry.get(r.type)||e.representation.volume.registry.default.provider,i=r.color&&e.representation.volume.themes.colorThemeRegistry.get(r.color)||e.representation.volume.themes.colorThemeRegistry.get(n.defaultColorTheme.name),a=r.size&&e.representation.volume.themes.sizeThemeRegistry.get(r.size)||e.representation.volume.themes.sizeThemeRegistry.get(n.defaultSizeTheme.name);return qie(e,t,{type:n,typeParams:r.typeParams,color:i,colorParams:r.colorParams,size:a,sizeParams:r.sizeParams})}function qie(e,t,r){r===void 0&&(r={});var n=e.representation.volume.themes,i={volume:t},a=r.type||e.representation.volume.registry.default.provider,o=I.getDefaultValues(a.getParams(n,t)),s=Object.assign(o,r.typeParams),u=r.color||n.colorThemeRegistry.get(a.defaultColorTheme.name),l=I.getDefaultValues(u.getParams(i));u.name===a.defaultColorTheme.name&&Object.assign(l,a.defaultColorTheme.props);var c=Object.assign(l,r.colorParams),d=r.size||n.sizeThemeRegistry.get(a.defaultSizeTheme.name),f=I.getDefaultValues(d.getParams(i));d.name===a.defaultSizeTheme.name&&Object.assign(f,a.defaultSizeTheme.props);var h=Object.assign(f,r.sizeParams);return{type:{name:a.name,params:s},colorTheme:{name:u.name,params:c},sizeTheme:{name:d.name,params:h}}}var Jw=function(e){Le(t,e);function t(r){var n=e.call(this)||this;return n.plugin=r,n.state={syncedTree:n.dataState.tree,notified:!1,hierarchy:tL(),selection:void 0},n.behaviors={selection:n.ev.behavior({hierarchy:n.current,volume:n.selection})},n.subscribe(r.state.data.events.changed,function(i){i.inTransaction||r.behaviors.state.isAnimating.value||n.sync(!0)}),n.subscribe(r.behaviors.state.isAnimating,function(i){!i&&!r.behaviors.state.isUpdating.value&&n.sync(!0)}),n}return Object.defineProperty(t.prototype,"dataState",{get:function(){return this.plugin.state.data},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"current",{get:function(){return this.sync(!1),this.state.hierarchy},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"selection",{get:function(){return this.sync(!1),this.state.selection},enumerable:!1,configurable:!0}),t.prototype.sync=function(r){if(!(!r&&this.dataState.inUpdate)){if(this.state.syncedTree===this.dataState.tree){r&&!this.state.notified&&(this.state.notified=!0,this.behaviors.selection.next({hierarchy:this.state.hierarchy,volume:this.state.selection}));return}this.state.syncedTree=this.dataState.tree;var n=xot(this.plugin.state.data,this.current);if(n.changed){var i=n.hierarchy;this.state.hierarchy=i,this.state.selection?this.state.selection=i.refs.has(this.state.selection.cell.transform.ref)?i.refs.get(this.state.selection.cell.transform.ref):i.volumes[0]:this.state.selection=i.volumes[0],r?(this.state.notified=!0,this.behaviors.selection.next({hierarchy:i,volume:this.state.selection})):this.state.notified=!1}}},t.prototype.setCurrent=function(r){this.state.selection=r||this.state.hierarchy.volumes[0],this.behaviors.selection.next({hierarchy:this.state.hierarchy,volume:r||this.state.hierarchy.volumes[0]})},t.prototype.remove=function(r,n){if(r.length!==0){for(var i=this.plugin.state.data.build(),a=0,o=r;a<o.length;a++){var s=o[a];i.delete(typeof s=="string"?s:s.cell.transform.ref)}return i.commit({canUndo:n?"Remove":!1})}},t.prototype.toggleVisibility=function(r,n){if(r.length!==0)for(var i=n!==void 0?n!=="show":!r[0].cell.state.isHidden,a=0,o=r;a<o.length;a++){var s=o[a];jv(this.dataState,s.cell.transform.ref,i)}},t.prototype.addRepresentation=function(r,n){var i,a=this.dataState.build().to(r.cell).apply(rt.Representation.VolumeRepresentation3D,Hg(this.plugin,(i=r.cell.obj)===null||i===void 0?void 0:i.data,{type:n}));return a.commit({canUndo:"Add Representation"})},t}(N2);(function(e){function t(r,n){var i,a;return!((i=n==null?void 0:n.cell.obj)===null||i===void 0)&&i.data?r.representation.volume.registry.getApplicableTypes((a=n.cell.obj)===null||a===void 0?void 0:a.data):r.representation.volume.registry.types}e.getRepresentationTypes=t})(Jw||(Jw={}));var XR=function(e){Le(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t}(ge.Create({name:"Volume Streaming",typeClass:"Object"})),lG;(function(e){(function(t){t.Float32="float32",t.Int8="int8"})(e.ValueType||(e.ValueType={}))})(lG||(lG={}));function Dot(e,t){if(t===void 0&&(t="x-ray"),!e)return t;var r=e.models[0];return un.is(r.sourceData)?Xt.hasEmMap(r)?"em":Xt.hasXrayMap(r)?"x-ray":Xt.isFromEm(r)?"em":Xt.isFromXray(r)?"x-ray":t:t}function Rot(e){var t=[];if(!un.is(e.sourceData))return[e.entryId];var r=e.sourceData.data.db.pdbx_database_related,n=r.db_id,i=r.db_name,a=r.content_type;if(!i.isDefined)return[e.entryId];for(var o=0,s=i.rowCount;o<s;++o)i.value(o).toUpperCase()==="EMDB"&&a.value(o)==="associated EM volume"&&t.push(n.value(o));return t}function kot(e){return[e.entryId]}function Oot(e,t){if(!t||!t.models.length)return[];var r=t.models[0];switch(e){case"em":return Rot(r);case"x-ray":return kot(r)}}function cG(e,t,r,n){return ce(this,void 0,void 0,function(){return de(this,function(i){switch(e){case"emdb":return[2,$ie(t,r,n)];case"pdbe":return[2,Fot(t,r,n)]}return[2]})})}function $ie(e,t,r){return ce(this,void 0,void 0,function(){var n,i,a,o;return de(this,function(s){switch(s.label){case 0:return n=e.config.get(Zr.VolumeStreaming.EmdbHeaderServer),[4,e.fetch({url:n+"/"+r.toUpperCase()+"/header/"+r.toLowerCase()+".xml",type:"xml"}).runInContext(t)];case 1:return i=s.sent(),a=i.getElementsByTagName("map")[0],o=parseFloat(a.getElementsByTagName("contourLevel")[0].textContent),[2,o]}})})}function Fot(e,t,r){var n,i,a,o;return ce(this,void 0,void 0,function(){var s,u;return de(this,function(l){switch(l.label){case 0:return r=r.toUpperCase(),[4,e.fetch({url:"https://www.ebi.ac.uk/emdb/api/entry/map/"+r,type:"json"}).runInContext(t)];case 1:return s=l.sent(),u=(i=(n=s==null?void 0:s.map)===null||n===void 0?void 0:n.contour_list)===null||i===void 0?void 0:i.contour,!u||u.length===0?[2,Lot(e,t,r)]:[2,(o=(a=u.find(function(c){return c.primary}))===null||a===void 0?void 0:a.level)!==null&&o!==void 0?o:u[0].level]}})})}function Lot(e,t,r){var n,i,a;return ce(this,void 0,void 0,function(){var o,s,u;return de(this,function(l){switch(l.label){case 0:return r=r.toUpperCase(),[4,e.fetch({url:"https://www.ebi.ac.uk/pdbe/api/emdb/entry/map/"+r,type:"json"}).runInContext(t)];case 1:return o=l.sent(),s=o==null?void 0:o[r],u=void 0,((a=(i=(n=s==null?void 0:s[0])===null||n===void 0?void 0:n.map)===null||i===void 0?void 0:i.contour_level)===null||a===void 0?void 0:a.value)!==void 0&&(u=+s[0].map.contour_level.value),[2,u]}})})}function Not(e,t,r){var n;return ce(this,void 0,void 0,function(){var i,a,o,s;return de(this,function(u){switch(u.label){case 0:return[4,e.fetch({url:"https://www.ebi.ac.uk/pdbe/api/pdb/entry/summary/"+r,type:"json"}).runInContext(t)];case 1:if(i=u.sent(),a=i==null?void 0:i[r],o=[],!((n=a==null?void 0:a[0])===null||n===void 0)&&n.related_structures){if(s=a[0].related_structures.filter(function(l){return l.resource==="EMDB"&&l.relationship==="associated EM volume"}),!s.length)throw new Error("No related EMDB entry found for '"+r+"'.");o.push.apply(o,s.map(function(l){return l.accession}))}else throw new Error("No related EMDB entry found for '"+r+"'.");return[2,o]}})})}function ff(e,t,r){return{i:e,j:t,k:r}}function Ts(e,t){return{a:e,b:t}}var ri=[ff(0,0,0),ff(1,0,0),ff(1,1,0),ff(0,1,0),ff(0,0,1),ff(1,0,1),ff(1,1,1),ff(0,1,1)],Bot=[Ts(ri[0],ri[1]),Ts(ri[1],ri[2]),Ts(ri[2],ri[3]),Ts(ri[3],ri[0]),Ts(ri[4],ri[5]),Ts(ri[5],ri[6]),Ts(ri[6],ri[7]),Ts(ri[7],ri[4]),Ts(ri[0],ri[4]),Ts(ri[1],ri[5]),Ts(ri[2],ri[6]),Ts(ri[3],ri[7])],Uot=[{i:0,j:0,k:0,e:0},{i:1,j:0,k:0,e:1},{i:0,j:1,k:0,e:0},{i:0,j:0,k:0,e:1},{i:0,j:0,k:1,e:0},{i:1,j:0,k:1,e:1},{i:0,j:1,k:1,e:0},{i:0,j:0,k:1,e:1},{i:0,j:0,k:0,e:2},{i:1,j:0,k:0,e:2},{i:1,j:1,k:0,e:2},{i:0,j:1,k:0,e:2}],jot=[0,265,515,778,1030,1295,1541,1804,2060,2309,2575,2822,3082,3331,3593,3840,400,153,915,666,1430,1183,1941,1692,2460,2197,2975,2710,3482,3219,3993,3728,560,825,51,314,1590,1855,1077,1340,2620,2869,2111,2358,3642,3891,3129,3376,928,681,419,170,1958,1711,1445,1196,2988,2725,2479,2214,4010,3747,3497,3232,1120,1385,1635,1898,102,367,613,876,3180,3429,3695,3942,2154,2403,2665,2912,1520,1273,2035,1786,502,255,1013,764,3580,3317,4095,3830,2554,2291,3065,2800,1616,1881,1107,1370,598,863,85,348,3676,3925,3167,3414,2650,2899,2137,2384,1984,1737,1475,1226,966,719,453,204,4044,3781,3535,3270,3018,2755,2505,2240,2240,2505,2755,3018,3270,3535,3781,4044,204,453,719,966,1226,1475,1737,1984,2384,2137,2899,2650,3414,3167,3925,3676,348,85,863,598,1370,1107,1881,1616,2800,3065,2291,2554,3830,4095,3317,3580,764,1013,255,502,1786,2035,1273,1520,2912,2665,2403,2154,3942,3695,3429,3180,876,613,367,102,1898,1635,1385,1120,3232,3497,3747,4010,2214,2479,2725,2988,1196,1445,1711,1958,170,419,681,928,3376,3129,3891,3642,2358,2111,2869,2620,1340,1077,1855,1590,314,51,825,560,3728,3993,3219,3482,2710,2975,2197,2460,1692,1941,1183,1430,666,915,153,400,3840,3593,3331,3082,2822,2575,2309,2060,1804,1541,1295,1030,778,515,265,0],Gg=[[],[0,8,3],[0,1,9],[1,8,3,9,8,1],[1,2,10],[0,8,3,1,2,10],[9,2,10,0,2,9],[2,8,3,2,10,8,10,9,8],[3,11,2],[0,11,2,8,11,0],[1,9,0,2,3,11],[1,11,2,1,9,11,9,8,11],[3,10,1,11,10,3],[0,10,1,0,8,10,8,11,10],[3,9,0,3,11,9,11,10,9],[9,8,10,10,8,11],[4,7,8],[4,3,0,7,3,4],[0,1,9,8,4,7],[4,1,9,4,7,1,7,3,1],[1,2,10,8,4,7],[3,4,7,3,0,4,1,2,10],[9,2,10,9,0,2,8,4,7],[2,10,9,2,9,7,2,7,3,7,9,4],[8,4,7,3,11,2],[11,4,7,11,2,4,2,0,4],[9,0,1,8,4,7,2,3,11],[4,7,11,9,4,11,9,11,2,9,2,1],[3,10,1,3,11,10,7,8,4],[1,11,10,1,4,11,1,0,4,7,11,4],[4,7,8,9,0,11,9,11,10,11,0,3],[4,7,11,4,11,9,9,11,10],[9,5,4],[9,5,4,0,8,3],[0,5,4,1,5,0],[8,5,4,8,3,5,3,1,5],[1,2,10,9,5,4],[3,0,8,1,2,10,4,9,5],[5,2,10,5,4,2,4,0,2],[2,10,5,3,2,5,3,5,4,3,4,8],[9,5,4,2,3,11],[0,11,2,0,8,11,4,9,5],[0,5,4,0,1,5,2,3,11],[2,1,5,2,5,8,2,8,11,4,8,5],[10,3,11,10,1,3,9,5,4],[4,9,5,0,8,1,8,10,1,8,11,10],[5,4,0,5,0,11,5,11,10,11,0,3],[5,4,8,5,8,10,10,8,11],[9,7,8,5,7,9],[9,3,0,9,5,3,5,7,3],[0,7,8,0,1,7,1,5,7],[1,5,3,3,5,7],[9,7,8,9,5,7,10,1,2],[10,1,2,9,5,0,5,3,0,5,7,3],[8,0,2,8,2,5,8,5,7,10,5,2],[2,10,5,2,5,3,3,5,7],[7,9,5,7,8,9,3,11,2],[9,5,7,9,7,2,9,2,0,2,7,11],[2,3,11,0,1,8,1,7,8,1,5,7],[11,2,1,11,1,7,7,1,5],[9,5,8,8,5,7,10,1,3,10,3,11],[5,7,0,5,0,9,7,11,0,1,0,10,11,10,0],[11,10,0,11,0,3,10,5,0,8,0,7,5,7,0],[11,10,5,7,11,5],[10,6,5],[0,8,3,5,10,6],[9,0,1,5,10,6],[1,8,3,1,9,8,5,10,6],[1,6,5,2,6,1],[1,6,5,1,2,6,3,0,8],[9,6,5,9,0,6,0,2,6],[5,9,8,5,8,2,5,2,6,3,2,8],[2,3,11,10,6,5],[11,0,8,11,2,0,10,6,5],[0,1,9,2,3,11,5,10,6],[5,10,6,1,9,2,9,11,2,9,8,11],[6,3,11,6,5,3,5,1,3],[0,8,11,0,11,5,0,5,1,5,11,6],[3,11,6,0,3,6,0,6,5,0,5,9],[6,5,9,6,9,11,11,9,8],[5,10,6,4,7,8],[4,3,0,4,7,3,6,5,10],[1,9,0,5,10,6,8,4,7],[10,6,5,1,9,7,1,7,3,7,9,4],[6,1,2,6,5,1,4,7,8],[1,2,5,5,2,6,3,0,4,3,4,7],[8,4,7,9,0,5,0,6,5,0,2,6],[7,3,9,7,9,4,3,2,9,5,9,6,2,6,9],[3,11,2,7,8,4,10,6,5],[5,10,6,4,7,2,4,2,0,2,7,11],[0,1,9,4,7,8,2,3,11,5,10,6],[9,2,1,9,11,2,9,4,11,7,11,4,5,10,6],[8,4,7,3,11,5,3,5,1,5,11,6],[5,1,11,5,11,6,1,0,11,7,11,4,0,4,11],[0,5,9,0,6,5,0,3,6,11,6,3,8,4,7],[6,5,9,6,9,11,4,7,9,7,11,9],[10,4,9,6,4,10],[4,10,6,4,9,10,0,8,3],[10,0,1,10,6,0,6,4,0],[8,3,1,8,1,6,8,6,4,6,1,10],[1,4,9,1,2,4,2,6,4],[3,0,8,1,2,9,2,4,9,2,6,4],[0,2,4,4,2,6],[8,3,2,8,2,4,4,2,6],[10,4,9,10,6,4,11,2,3],[0,8,2,2,8,11,4,9,10,4,10,6],[3,11,2,0,1,6,0,6,4,6,1,10],[6,4,1,6,1,10,4,8,1,2,1,11,8,11,1],[9,6,4,9,3,6,9,1,3,11,6,3],[8,11,1,8,1,0,11,6,1,9,1,4,6,4,1],[3,11,6,3,6,0,0,6,4],[6,4,8,11,6,8],[7,10,6,7,8,10,8,9,10],[0,7,3,0,10,7,0,9,10,6,7,10],[10,6,7,1,10,7,1,7,8,1,8,0],[10,6,7,10,7,1,1,7,3],[1,2,6,1,6,8,1,8,9,8,6,7],[2,6,9,2,9,1,6,7,9,0,9,3,7,3,9],[7,8,0,7,0,6,6,0,2],[7,3,2,6,7,2],[2,3,11,10,6,8,10,8,9,8,6,7],[2,0,7,2,7,11,0,9,7,6,7,10,9,10,7],[1,8,0,1,7,8,1,10,7,6,7,10,2,3,11],[11,2,1,11,1,7,10,6,1,6,7,1],[8,9,6,8,6,7,9,1,6,11,6,3,1,3,6],[0,9,1,11,6,7],[7,8,0,7,0,6,3,11,0,11,6,0],[7,11,6],[7,6,11],[3,0,8,11,7,6],[0,1,9,11,7,6],[8,1,9,8,3,1,11,7,6],[10,1,2,6,11,7],[1,2,10,3,0,8,6,11,7],[2,9,0,2,10,9,6,11,7],[6,11,7,2,10,3,10,8,3,10,9,8],[7,2,3,6,2,7],[7,0,8,7,6,0,6,2,0],[2,7,6,2,3,7,0,1,9],[1,6,2,1,8,6,1,9,8,8,7,6],[10,7,6,10,1,7,1,3,7],[10,7,6,1,7,10,1,8,7,1,0,8],[0,3,7,0,7,10,0,10,9,6,10,7],[7,6,10,7,10,8,8,10,9],[6,8,4,11,8,6],[3,6,11,3,0,6,0,4,6],[8,6,11,8,4,6,9,0,1],[9,4,6,9,6,3,9,3,1,11,3,6],[6,8,4,6,11,8,2,10,1],[1,2,10,3,0,11,0,6,11,0,4,6],[4,11,8,4,6,11,0,2,9,2,10,9],[10,9,3,10,3,2,9,4,3,11,3,6,4,6,3],[8,2,3,8,4,2,4,6,2],[0,4,2,4,6,2],[1,9,0,2,3,4,2,4,6,4,3,8],[1,9,4,1,4,2,2,4,6],[8,1,3,8,6,1,8,4,6,6,10,1],[10,1,0,10,0,6,6,0,4],[4,6,3,4,3,8,6,10,3,0,3,9,10,9,3],[10,9,4,6,10,4],[4,9,5,7,6,11],[0,8,3,4,9,5,11,7,6],[5,0,1,5,4,0,7,6,11],[11,7,6,8,3,4,3,5,4,3,1,5],[9,5,4,10,1,2,7,6,11],[6,11,7,1,2,10,0,8,3,4,9,5],[7,6,11,5,4,10,4,2,10,4,0,2],[3,4,8,3,5,4,3,2,5,10,5,2,11,7,6],[7,2,3,7,6,2,5,4,9],[9,5,4,0,8,6,0,6,2,6,8,7],[3,6,2,3,7,6,1,5,0,5,4,0],[6,2,8,6,8,7,2,1,8,4,8,5,1,5,8],[9,5,4,10,1,6,1,7,6,1,3,7],[1,6,10,1,7,6,1,0,7,8,7,0,9,5,4],[4,0,10,4,10,5,0,3,10,6,10,7,3,7,10],[7,6,10,7,10,8,5,4,10,4,8,10],[6,9,5,6,11,9,11,8,9],[3,6,11,0,6,3,0,5,6,0,9,5],[0,11,8,0,5,11,0,1,5,5,6,11],[6,11,3,6,3,5,5,3,1],[1,2,10,9,5,11,9,11,8,11,5,6],[0,11,3,0,6,11,0,9,6,5,6,9,1,2,10],[11,8,5,11,5,6,8,0,5,10,5,2,0,2,5],[6,11,3,6,3,5,2,10,3,10,5,3],[5,8,9,5,2,8,5,6,2,3,8,2],[9,5,6,9,6,0,0,6,2],[1,5,8,1,8,0,5,6,8,3,8,2,6,2,8],[1,5,6,2,1,6],[1,3,6,1,6,10,3,8,6,5,6,9,8,9,6],[10,1,0,10,0,6,9,5,0,5,6,0],[0,3,8,5,6,10],[10,5,6],[11,5,10,7,5,11],[11,5,10,11,7,5,8,3,0],[5,11,7,5,10,11,1,9,0],[10,7,5,10,11,7,9,8,1,8,3,1],[11,1,2,11,7,1,7,5,1],[0,8,3,1,2,7,1,7,5,7,2,11],[9,7,5,9,2,7,9,0,2,2,11,7],[7,5,2,7,2,11,5,9,2,3,2,8,9,8,2],[2,5,10,2,3,5,3,7,5],[8,2,0,8,5,2,8,7,5,10,2,5],[9,0,1,5,10,3,5,3,7,3,10,2],[9,8,2,9,2,1,8,7,2,10,2,5,7,5,2],[1,3,5,3,7,5],[0,8,7,0,7,1,1,7,5],[9,0,3,9,3,5,5,3,7],[9,8,7,5,9,7],[5,8,4,5,10,8,10,11,8],[5,0,4,5,11,0,5,10,11,11,3,0],[0,1,9,8,4,10,8,10,11,10,4,5],[10,11,4,10,4,5,11,3,4,9,4,1,3,1,4],[2,5,1,2,8,5,2,11,8,4,5,8],[0,4,11,0,11,3,4,5,11,2,11,1,5,1,11],[0,2,5,0,5,9,2,11,5,4,5,8,11,8,5],[9,4,5,2,11,3],[2,5,10,3,5,2,3,4,5,3,8,4],[5,10,2,5,2,4,4,2,0],[3,10,2,3,5,10,3,8,5,4,5,8,0,1,9],[5,10,2,5,2,4,1,9,2,9,4,2],[8,4,5,8,5,3,3,5,1],[0,4,5,1,0,5],[8,4,5,8,5,3,9,0,5,0,3,5],[9,4,5],[4,11,7,4,9,11,9,10,11],[0,8,3,4,9,7,9,11,7,9,10,11],[1,10,11,1,11,4,1,4,0,7,4,11],[3,1,4,3,4,8,1,10,4,7,4,11,10,11,4],[4,11,7,9,11,4,9,2,11,9,1,2],[9,7,4,9,11,7,9,1,11,2,11,1,0,8,3],[11,7,4,11,4,2,2,4,0],[11,7,4,11,4,2,8,3,4,3,2,4],[2,9,10,2,7,9,2,3,7,7,4,9],[9,10,7,9,7,4,10,2,7,8,7,0,2,0,7],[3,7,10,3,10,2,7,4,10,1,10,0,4,0,10],[1,10,2,8,7,4],[4,9,1,4,1,7,7,1,3],[4,9,1,4,1,7,0,8,1,8,7,1],[4,0,3,7,4,3],[4,8,7],[9,10,8,10,11,8],[3,0,9,3,9,11,11,9,10],[0,1,10,0,10,8,8,10,11],[3,1,10,11,3,10],[1,2,11,1,11,9,9,11,8],[3,0,9,3,9,11,1,2,9,2,11,9],[0,2,11,8,0,11],[3,2,11],[2,3,8,2,8,10,10,8,9],[9,10,2,0,9,2],[2,3,8,2,8,10,0,1,8,1,10,8],[1,10,2],[1,3,8,9,1,8],[0,9,1],[0,3,8],[]],iI=[[0,4,4,4,2,0,0,0,2,2,0,0],[4,0,4,4,0,8,0,0,0,8,8,0],[4,4,0,4,0,0,8,0,0,0,8,8],[4,4,4,0,0,0,0,1,1,0,0,1],[2,0,0,0,0,8,8,8,2,2,0,0],[0,8,0,0,8,0,8,8,0,8,8,0],[0,0,8,0,8,8,0,8,0,0,8,8],[0,0,0,1,8,8,8,0,1,0,0,1],[2,0,0,1,2,0,0,1,0,2,0,1],[2,8,0,0,2,8,0,0,2,0,8,0],[0,8,8,0,0,8,8,0,0,8,0,8],[0,0,8,1,0,0,8,1,1,0,8,0]];function zot(e,t){var r=Math.min(65536,e*4),n=qe.create(Float32Array,3,e,t&&t.vertexBuffer.ref.value),i=qe.create(Float32Array,3,e,t&&t.normalBuffer.ref.value),a=qe.create(Float32Array,1,e,t&&t.groupBuffer.ref.value),o=qe.create(Uint32Array,3,r,t&&t.indexBuffer.ref.value),s=0,u=0;return{addVertex:function(l,c,d){return++s,qe.add3(n,l,c,d)},addNormal:function(l,c,d){qe.add3(i,l,c,d)},addGroup:function(l){qe.add(a,l)},addTriangle:function(l,c,d,f){var h=l[c],v=l[d],p=l[f];h>=0&&v>=0&&p>=0&&(++u,qe.add3(o,h,v,p))},get:function(){var l=qe.compact(n,!0),c=qe.compact(i,!0),d=qe.compact(o,!0),f=qe.compact(a,!0);return Lt.create(l,d,c,f,s,u,t)}}}function Vot(e,t){var r=qe.create(Float32Array,3,e),n=qe.create(Float32Array,1,e),i=qe.create(Float32Array,2,e),a=0;return{addVertex:function(o,s,u){return qe.add3(r,o,s,u)},addNormal:function(){return Lf},addGroup:function(o){qe.add(n,o)},addTriangle:function(o,s,u,l,c){var d=o[s],f=o[u],h=o[l];d>=0&&f>=0&&h>=0&&(iI[s][u]&c&&(++a,qe.add2(i,o[s],o[u])),iI[u][l]&c&&(++a,qe.add2(i,o[u],o[l])),iI[s][l]&c&&(++a,qe.add2(i,o[s],o[l])))},get:function(){for(var o=qe.compact(r,!0),s=qe.compact(i,!0),u=qe.compact(n,!0),l=vs.create(a,a/10,t),c=0;c<a;++c){var d=s[c*2],f=s[c*2+1];l.add(o[d*3],o[d*3+1],o[d*3+2],o[f*3],o[f*3+1],o[f*3+2],u[d])}return l.getLines()}}}function Wie(e){return E(E({},e),{bottomLeft:Oi(e.bottomLeft,[0,0,0]),topRight:Oi(e.topRight,e.scalarField.space.dimensions)})}function Xie(e){return{dX:e.topRight[0]-e.bottomLeft[0],dY:e.topRight[1]-e.bottomLeft[1],dZ:e.topRight[2]-e.bottomLeft[2]}}function TA(e,t){var r=this;return $e.create("Marching Cubes Mesh",function(n){return ce(r,void 0,void 0,function(){var i,a,o,s,u,l,c;return de(this,function(d){switch(d.label){case 0:return i=Wie(e),a=Xie(i),o=a.dX,s=a.dY,u=a.dZ,l=Math.min(262144,Math.max(o*s*u/32,1024)),c=zot(l,t),[4,new Yie(n,c,i).run()];case 1:return d.sent(),[2,c.get()]}})})})}function rL(e,t){var r=this;return $e.create("Marching Cubes Lines",function(n){return ce(r,void 0,void 0,function(){var i,a,o,s,u,l,c;return de(this,function(d){switch(d.label){case 0:return i=Wie(e),a=Xie(i),o=a.dX,s=a.dY,u=a.dZ,l=Math.min(262144,Math.max(o*s*u/32,1024)),c=Vot(l,t),[4,new Yie(n,c,i).run()];case 1:return d.sent(),[2,c.get()]}})})})}var Yie=function(){function e(t,r,n){this.ctx=t,this.minX=0,this.minY=0,this.minZ=0,this.maxX=0,this.maxY=0,this.maxZ=0,this.state=new Hot(r,n),this.minX=n.bottomLeft[0],this.minY=n.bottomLeft[1],this.minZ=n.bottomLeft[2],this.maxX=n.topRight[0]-1,this.maxY=n.topRight[1]-1,this.maxZ=n.topRight[2]-1,this.size=(this.maxX-this.minX)*(this.maxY-this.minY)*(this.maxZ-this.minZ),this.sliceSize=(this.maxX-this.minX)*(this.maxY-this.minY)}return e.prototype.doSlices=function(){return ce(this,void 0,void 0,function(){var t,r;return de(this,function(n){switch(n.label){case 0:t=0,this.edgeFilter=15,r=this.minZ,n.label=1;case 1:return r<this.maxZ?(this.slice(r),t+=this.sliceSize,this.ctx.shouldUpdate?[4,this.ctx.update({message:"Computing surface...",current:t,max:this.size})]:[3,3]):[3,4];case 2:n.sent(),n.label=3;case 3:return r++,this.edgeFilter&=-5,[3,1];case 4:return[2]}})})},e.prototype.slice=function(t){this.edgeFilter|=2;for(var r=this.minY;r<this.maxY;r++,this.edgeFilter&=-3){this.edgeFilter|=1;for(var n=this.minX;n<this.maxX;n++,this.edgeFilter&=-2)this.state.processCell(n,r,t,this.edgeFilter)}this.state.clearEdgeVertexIndexSlice(t)},e.prototype.run=function(){return ce(this,void 0,void 0,function(){return de(this,function(t){switch(t.label){case 0:return[4,this.doSlices()];case 1:return t.sent(),[2]}})})},e}(),Hot=function(){function e(t,r){this.builder=t,this.vertList=[0,0,0,0,0,0,0,0,0,0,0,0],this.i=0,this.j=0,this.k=0;var n=r.scalarField.space.dimensions;this.nX=n[0],this.nY=n[1],this.nZ=n[2],this.isoLevel=r.isoLevel,this.scalarFieldGet=r.scalarField.space.get,this.scalarField=r.scalarField.data,r.idField&&(this.idField=r.idField.data,this.idFieldGet=r.idField.space.get),this.verticesOnEdges=new Int32Array(3*this.nX*this.nY*2)}return e.prototype.get3dOffsetFromEdgeInfo=function(t){return this.nX*((this.k+t.k)%2*this.nY+this.j+t.j)+this.i+t.i},e.prototype.clearEdgeVertexIndexSlice=function(t){var r=t%2===0?0:3*this.nX*this.nY,n=t%2===0?3*this.nX*this.nY:this.verticesOnEdges.length;this.verticesOnEdges.fill(0,r,n)},e.prototype.interpolate=function(t){var r=Uot[t],n=3*this.get3dOffsetFromEdgeInfo(r)+r.e,i=this.verticesOnEdges[n];if(i>0)return i-1;var a=this.scalarField,o=this.scalarFieldGet,s=Bot[t],u=s.a,l=s.b,c=u.i+this.i,d=u.j+this.j,f=u.k+this.k,h=l.i+this.i,v=l.j+this.j,p=l.k+this.k,m=o(a,c,d,f),g=o(a,h,v,p),y=(this.isoLevel-m)/(m-g);if(this.idField){var b=this.idFieldGet(this.idField,c,d,f),S=this.idFieldGet(this.idField,h,v,p),x=y<.5?b:S;if(x===-1&&(x=y<.5?S:b),x===-2)return-1;this.builder.addGroup(x)}else this.builder.addGroup(0);var C=this.builder.addVertex(c+y*(c-h),d+y*(d-v),f+y*(f-p));this.verticesOnEdges[n]=C+1;var w=o(a,Math.max(0,c-1),d,f)-o(a,Math.min(this.nX-1,c+1),d,f),A=o(a,c,Math.max(0,d-1),f)-o(a,c,Math.min(this.nY-1,d+1),f),M=o(a,c,d,Math.max(0,f-1))-o(a,c,d,Math.min(this.nZ,f+1)),D=o(a,Math.max(0,h-1),v,p)-o(a,Math.min(this.nX-1,h+1),v,p),k=o(a,h,Math.max(0,v-1),p)-o(a,h,Math.min(this.nY-1,v+1),p),R=o(a,h,v,Math.max(0,p-1))-o(a,h,v,Math.min(this.nZ-1,p+1)),O=w+y*(w-D),H=A+y*(A-k),B=M+y*(M-R);return this.isoLevel>=0?this.builder.addNormal(O,H,B):this.builder.addNormal(-O,-H,-B),C},e.prototype.get=function(t,r,n){return this.scalarFieldGet(this.scalarField,t,r,n)},e.prototype.processCell=function(t,r,n,i){var a=0;if(this.get(t,r,n)<this.isoLevel&&(a|=1),this.get(t+1,r,n)<this.isoLevel&&(a|=2),this.get(t+1,r+1,n)<this.isoLevel&&(a|=4),this.get(t,r+1,n)<this.isoLevel&&(a|=8),this.get(t,r,n+1)<this.isoLevel&&(a|=16),this.get(t+1,r,n+1)<this.isoLevel&&(a|=32),this.get(t+1,r+1,n+1)<this.isoLevel&&(a|=64),this.get(t,r+1,n+1)<this.isoLevel&&(a|=128),!(a===0||a===255)){this.i=t,this.j=r,this.k=n;var o=jot[a];(o&1)>0&&(this.vertList[0]=this.interpolate(0)),(o&2)>0&&(this.vertList[1]=this.interpolate(1)),(o&4)>0&&(this.vertList[2]=this.interpolate(2)),(o&8)>0&&(this.vertList[3]=this.interpolate(3)),(o&16)>0&&(this.vertList[4]=this.interpolate(4)),(o&32)>0&&(this.vertList[5]=this.interpolate(5)),(o&64)>0&&(this.vertList[6]=this.interpolate(6)),(o&128)>0&&(this.vertList[7]=this.interpolate(7)),(o&256)>0&&(this.vertList[8]=this.interpolate(8)),(o&512)>0&&(this.vertList[9]=this.interpolate(9)),(o&1024)>0&&(this.vertList[10]=this.interpolate(10)),(o&2048)>0&&(this.vertList[11]=this.interpolate(11));for(var s=Gg[a],u=0;u<s.length;u+=3){var l=s[u],c=s[u+1],d=s[u+2];this.isoLevel>=0?this.builder.addTriangle(this.vertList,l,c,d,i):this.builder.addTriangle(this.vertList,d,c,l,i)}}},e}();function Got(e,t,r,n,i,a){var o=ha.getUtils(t),s=o.createValues,u=o.createRenderableState,l=$6(),c=s(t,l,r,n,i),d=u(i);return Y0(t.kind,c,d,a)}function z2(e,t){var r=e.defaultProps,n=e.createGeometry,i=e.createLocationIterator,a=e.getLoci,o=e.eachLocation,s=e.setUpdateState,u=e.mustRecreate,l=e.dispose,c=e.geometryUtils,d=c.updateValues,f=c.updateBoundingSphere,h=c.updateRenderableState,v=c.createPositionIterator,p=rc.create(),m,g,y,b,S=Object.assign({},r),x=Si.createEmpty(),C,w,A,M;function D(O,H,B){if(!B&&!C)throw new Error("missing volume");if(g=Object.assign({},S,H),y=O,b=B,rc.reset(p),m?(!C||!Ct.areEquivalent(b,C))&&(p.createNew=!0):p.createNew=!0,p.createNew){p.createGeometry=!0;return}s(p,B,g,S,y,x),yd.areEqual(O.color,x.color)||(p.updateColor=!0),p.createGeometry&&(p.updateColor=!0)}function k(O){if(p.createNew)if(A=i(b),O)m=Got(b,O,A,y,g,t),M=v(O,m.values);else throw new Error("expected geometry to be given");else{if(!m)throw new Error("expected renderObject to be available");if(A.reset(),p.createGeometry)if(O)L.updateIfChanged(m.values.drawCount,ha.getDrawCount(O)),L.updateIfChanged(m.values.uVertexCount,ha.getVertexCount(O));else throw new Error("expected geometry to be given");(p.updateTransform||p.createGeometry)&&(f(m.values,O||w),M=v(O||w,m.values)),p.updateSize&&"uSize"in m.values&&Fd(A,y.size,m.values),p.updateColor&&xs(A,M,y.color,m.values),d(m.values,g),h(m.state,g)}S=g,x=y,C=b,O&&(w=O)}function R(O,H){return Ws(O)?H(Ie.ofBounds(0,A.groupCount*A.instanceCount)):o(O,C,S,H)}return{get groupCount(){return A?A.count:0},get renderObject(){return m},createOrUpdate:function(O,H,B,j){return B===void 0&&(B={}),ce(this,void 0,void 0,function(){var Y;return de(this,function(G){return D(H,B,j||C),p.createGeometry?(Y=n(O,b,y,g,w),[2,wF(Y)?Y.then(k):k(Y)]):(k(),[2])})})},getLoci:function(O){return m?a(O,C,S,m.id):jr},mark:function(O,H){return Pr.mark(m,O,H,R)},setVisibility:function(O){Pr.setVisibility(m,O)},setAlphaFactor:function(O){Pr.setAlphaFactor(m,O)},setPickable:function(O){Pr.setPickable(m,O)},setColorOnly:function(O){Pr.setColorOnly(m,O)},setTransform:function(O,H){Pr.setTransform(m,O,H)},setOverpaint:function(O){return Pr.setOverpaint(m,O,R,!0)},setTransparency:function(O){return Pr.setTransparency(m,O,R,!0)},setClipping:function(O){return Pr.setClipping(m,O,R,!0)},destroy:function(){l==null||l(w),m&&(m.state.disposed=!0,m=void 0)},mustRecreate:u}}E({},Et.Params);function e3(e,t,r,n,i){var a=0,o=t.webgl,s=new ai,u=qd(),l=[],c=ur.createState(),d,f,h,v,p=Si.createEmpty();function m(x,C){var w=this;x===void 0&&(x={}),C&&C!==f&&(h=r(t,C),f=C,v||(v=I.getDefaultValues(h)));var A=CR(Object.assign({},v,x),f);return Object.assign(v,x,A),$e.create("Creating or updating VolumeRepresentation",function(M){return ce(w,void 0,void 0,function(){var D,k;return de(this,function(R){switch(R.label){case 0:return d?!((k=d.mustRecreate)===null||k===void 0)&&k.call(d,f,v,o)&&(d.destroy(),d=n(u,f,v,o)):d=n(u,f,v,o),D=d.createOrUpdate({webgl:o,runtime:M},p,v,C),D?[4,D]:[3,2];case 1:R.sent(),R.label=2;case 2:return l.length=0,d&&d.renderObject&&l.push(d.renderObject),s.next(a++),[2]}})})})}function g(x,C){return d?d.mark(x,C):!1}function y(x){x.visible!==void 0&&d&&d.setVisibility(x.visible),x.alphaFactor!==void 0&&d&&d.setAlphaFactor(x.alphaFactor),x.pickable!==void 0&&d&&d.setPickable(x.pickable),x.overpaint!==void 0&&d&&d.setOverpaint(x.overpaint),x.transparency!==void 0&&d&&d.setTransparency(x.transparency),x.transform!==void 0&&d&&d.setTransform(x.transform),ur.updateState(c,x)}function b(x){p=x}function S(){d&&d.destroy()}return{label:e,get groupCount(){return d?d.groupCount:0},get props(){return v},get params(){return h},get state(){return c},get theme(){return p},renderObjects:l,updated:s,createOrUpdate:m,setState:y,setTheme:b,getLoci:function(x){return x===void 0?i(f,v):d?d.getLoci(x):jr},mark:g,destroy:S}}var t3=_.set,Kie=_.normalize,Qie=_.sub,Zie=_.addScalar,r3=_.scale,Jie=_.toArray;function nL(e,t,r,n){var i=!1;if(Ct.isLoci(e)){if(!Ct.areEquivalent(e.volume,t))return!1;n(Ie.ofLength(t.grid.cells.data.length))&&(i=!0)}else if(Ct.Isosurface.isLoci(e)){if(!Ct.areEquivalent(e.volume,t))return!1;if(r){if(!Ct.IsoValue.areSame(e.isoValue,r,t.grid.stats))return!1;n(Ie.ofLength(t.grid.cells.data.length))&&(i=!0)}else for(var a=t.grid,o=a.stats,s=a.cells.data,u=o.sigma,l=Ct.IsoValue.toAbsolute(e.isoValue,o).absoluteValue,c=0,d=s.length;c<d;++c)Sn(l,s[c],u)&&n(Ie.ofSingleton(c))&&(i=!0)}else if(Ct.Cell.isLoci(e)){if(!Ct.areEquivalent(e.volume,t))return!1;Ie.is(e.indices)?n(e.indices)&&(i=!0):Fe.forEach(e.indices,function(f){n(Ie.ofSingleton(f))&&(i=!0)})}return i}function V2(e,t){t===void 0&&(t=0);var r=e[0]*e[1]*e[2],n=Math.sqrt(r),i=Math.pow(2,Math.ceil(Math.log(n)/Math.log(2))),a=e[0]+t,o=e[1]+t,s=1,u=a;return i<a*e[2]?(u=Math.floor(i/a),s=Math.ceil(e[2]/u),a*=u,o*=s):a*=e[2],{width:a,height:o,columns:u,rows:s,powerOfTwoSize:o<i?i:i*2}}function eae(e,t,r){r===void 0&&(r=0);for(var n=e.grid,i=n.cells,a=i.space,o=i.data,s=n.stats,u=s.max,l=s.min,c=a.dimensions,d=a.dataOffset,f=V2(c,r),h=f.width,v=f.height,p=t==="data"?1:4,m=new Uint8Array(h*v*p),g={array:m,width:h,height:v},y=u-l,b=c[0],S=c[1],x=c[2],C=b+r,w=S+r,A=_(),M=_(),D=b-1,k=S-1,R=x-1,O=0;O<x;++O)for(var H=0;H<S;++H)for(var B=0;B<b;++B){var j=Math.floor(O*C%h/C),Y=Math.floor(O*C/h),G=j*C+B,$=p*(Y*w*h+H*h+G),q=d(B,H,O);t==="data"?m[$]=Math.round((o[q]-l)/y*255):(t==="groups"?M2(q,m,$):(t3(A,o[d(Math.max(0,B-1),H,O)],o[d(B,Math.max(0,H-1),O)],o[d(B,H,Math.max(0,O-1))]),t3(M,o[d(Math.min(D,B+1),H,O)],o[d(B,Math.min(k,H+1),O)],o[d(B,H,Math.min(R,O+1))]),Kie(A,Qie(A,A,M)),Zie(A,r3(A,A,.5),.5),Jie(r3(A,A,255),m,$)),m[$+3]=Math.round((o[q]-l)/y*255))}return g}function qot(e){for(var t=e.grid,r=t.cells,n=r.space,i=r.data,a=t.stats,o=a.max,s=a.min,u=n.dimensions,l=u[0],c=u[1],d=u[2],f=n.dataOffset,h=new Uint8Array(l*c*d*4),v={array:h,width:l,height:c,depth:d},p=o-s,m=_(),g=_(),y=l-1,b=c-1,S=d-1,x=0,C=0;C<d;++C)for(var w=0;w<c;++w)for(var A=0;A<l;++A){var M=f(A,w,C);t3(m,i[f(Math.max(0,A-1),w,C)],i[f(A,Math.max(0,w-1),C)],i[f(A,w,Math.max(0,C-1))]),t3(g,i[f(Math.min(y,A+1),w,C)],i[f(A,Math.min(b,w+1),C)],i[f(A,w,Math.min(S,C+1))]),Kie(m,Qie(m,m,g)),Zie(m,r3(m,m,.5),.5),Jie(r3(m,m,255),h,x),h[x+3]=Math.round((i[M]-s)/p*255),x+=4}return v}var $ot=`
precision highp float;
precision highp int;

#if __VERSION__ == 100
    precision highp sampler2D;
    uniform sampler2D tTexture;
#else
    precision highp isampler2D;
    uniform isampler2D tTexture;
#endif

void main(void) {
    #if __VERSION__ == 100
        gl_FragColor = texture2D(tTexture, vec2(0.5));
    #else
        gl_FragColor = ivec4(texture2D(tTexture, vec2(0.5)).r);
    #endif
}
`,Wot=E(E({},Pa),{tTexture:cr("texture","rgba","float","nearest")}),Bs="histopyramid-sum";function Xot(e,t){if(e.namedComputeRenderables[Bs]){var r=e.namedComputeRenderables[Bs].values;L.update(r.tTexture,t),e.namedComputeRenderables[Bs].update()}else e.namedComputeRenderables[Bs]=Yot(e,t);return e.namedComputeRenderables[Bs]}function Yot(e,t){var r=E(E({},Ta),{tTexture:L.create(t)}),n=E({},Wot),i=Bn("sum",Bo,$ot,{},{0:"ivec4"}),a=ra(e,"triangles",i,n,r);return ta(a,r)}function Kot(e){var t=e.gl,r=e.state;r.disable(t.CULL_FACE),r.disable(t.BLEND),r.disable(t.DEPTH_TEST),r.disable(t.SCISSOR_TEST),r.depthMask(!1),r.colorMask(!0,!0,!0,!0),r.clearColor(0,0,0,0)}var CS=new Uint8Array(4),dG=new Int32Array(4);function Qot(e,t){var r=e.gl,n=e.resources,i=Xot(e,t);e.state.currentRenderItemId=-1,e.namedFramebuffers[Bs]||(e.namedFramebuffers[Bs]=n.framebuffer());var a=e.namedFramebuffers[Bs];e.namedTextures[Bs]||(e.namedTextures[Bs]=Mr(r)?n.texture("image-int32","rgba","int","nearest"):n.texture("image-uint8","rgba","ubyte","nearest"),e.namedTextures[Bs].define(1,1));var o=e.namedTextures[Bs];return o.attachFramebuffer(a,0),Kot(e),r.viewport(0,0,1,1),i.render(),r.finish(),e.readPixels(0,0,1,1,Mr(r)?dG:CS),e.unbindFramebuffer(),Mr(r)?dG[0]:dF(CS[0],CS[1],CS[2])}var Zot=`
precision highp float;
precision highp int;
precision highp sampler2D;

uniform sampler2D tInputLevel;

// previous level used to evaluate the new level
#if __VERSION__ == 100
    uniform sampler2D tPreviousLevel;
#else
    precision highp isampler2D;
    uniform isampler2D tPreviousLevel;
#endif

// inverted size of the previous level texture.
uniform float uSize;
uniform float uTexSize;
uniform bool uFirst;

#include common

void main(void) {
    float k = 0.5 * uSize;
    vec2 position = floor((gl_FragCoord.xy / uTexSize) / uSize) * uSize;

    #if __VERSION__ == 100
        float a, b, c, d;

        if (uFirst) {
            a = texture2D(tInputLevel, position).r * 255.0;
            b = texture2D(tInputLevel, position + vec2(k, 0.0)).r * 255.0;
            c = texture2D(tInputLevel, position + vec2(0.0, k)).r * 255.0;
            d = texture2D(tInputLevel, position + vec2(k, k)).r * 255.0;
        } else {
            a = decodeFloatRGB(texture2D(tPreviousLevel, position).rgb);
            b = decodeFloatRGB(texture2D(tPreviousLevel, position + vec2(k, 0.0)).rgb);
            c = decodeFloatRGB(texture2D(tPreviousLevel, position + vec2(0.0, k)).rgb);
            d = decodeFloatRGB(texture2D(tPreviousLevel, position + vec2(k, k)).rgb);
        }
        gl_FragColor = vec4(encodeFloatRGB(a + b + c + d), 1.0);
    #else
        int a, b, c, d;

        if (uFirst) {
            a = int(texture2D(tInputLevel, position).r * 255.0);
            b = int(texture2D(tInputLevel, position + vec2(k, 0.0)).r * 255.0);
            c = int(texture2D(tInputLevel, position + vec2(0.0, k)).r * 255.0);
            d = int(texture2D(tInputLevel, position + vec2(k, k)).r * 255.0);
        } else {
            a = texture2D(tPreviousLevel, position).r;
            b = texture2D(tPreviousLevel, position + vec2(k, 0.0)).r;
            c = texture2D(tPreviousLevel, position + vec2(0.0, k)).r;
            d = texture2D(tPreviousLevel, position + vec2(k, k)).r;
        }
        gl_FragColor = ivec4(a + b + c + d);
    #endif
}
`,Jot=E(E({},Pa),{tInputLevel:cr("texture","rgba","float","nearest"),tPreviousLevel:cr("texture","rgba","float","nearest"),uSize:Ge("f"),uTexSize:Ge("f"),uFirst:Ge("b")}),Lp="histogram-pyramid";function est(e,t,r){if(e.namedComputeRenderables[Lp]){var n=e.namedComputeRenderables[Lp].values;L.update(n.tInputLevel,t),L.update(n.tPreviousLevel,r),e.namedComputeRenderables[Lp].update()}else e.namedComputeRenderables[Lp]=tst(e,t,r);return e.namedComputeRenderables[Lp]}function tst(e,t,r){var n=E(E({},Ta),{tInputLevel:L.create(t),tPreviousLevel:L.create(r),uSize:L.create(0),uTexSize:L.create(0),uFirst:L.create(!0)}),i=E({},Jot),a=Bn("reduction",Bo,Zot,{},{0:"ivec4"}),o=ra(e,"triangles",a,i,n);return ta(o,n)}var fG=[];function rst(e,t){var r=fG[t],n=Math.pow(2,t);if(r===void 0){var i=e.isWebGL2?n3("level"+t,e,"image-int32","alpha","int","nearest"):n3("level"+t,e,"image-uint8","rgba","ubyte","nearest");i.define(n,n);var a=tae("level"+t,e);i.attachFramebuffer(a,0),r={texture:i,framebuffer:a},fG[t]=r}return r}function nst(e){var t=e.gl,r=e.state;r.disable(t.CULL_FACE),r.disable(t.BLEND),r.disable(t.DEPTH_TEST),r.enable(t.SCISSOR_TEST),r.depthMask(!1),r.colorMask(!0,!0,!0,!0),r.clearColor(0,0,0,0)}function tae(e,t){var r=Lp+"-"+e;return t.namedFramebuffers[r]||(t.namedFramebuffers[r]=t.resources.framebuffer()),t.namedFramebuffers[r]}function n3(e,t,r,n,i,a){var o=Lp+"-"+e;return t.namedTextures[o]||(t.namedTextures[o]=t.resources.texture(r,n,i,a)),t.namedTextures[o]}function ist(e,t,r,n){var i=e.gl,a=t.getWidth(),o=t.getHeight();if(a!==o||!WIe(a))throw new Error("inputTexture must be of square power-of-two size");var s=Math.ceil(Math.log(a)/Math.log(2)),u=Math.pow(2,s),l=Math.pow(2,s),c=Math.pow(2,s-1),d=e.isWebGL2?n3("pyramid",e,"image-int32","alpha","int","nearest"):n3("pyramid",e,"image-uint8","rgba","ubyte","nearest");d.define(l,c);var f=tae("pyramid",e);d.attachFramebuffer(f,0),i.viewport(0,0,l,c),Mr(i)?i.clearBufferiv(i.COLOR,0,[0,0,0,0]):i.clear(i.COLOR_BUFFER_BIT);for(var h=[],v=0;v<s;++v)h.push(rst(e,v));var p=est(e,t,h[0].texture);e.state.currentRenderItemId=-1,nst(e);for(var m=0,v=0;v<s;v++){var g=s-1-v,y=h[g];y.framebuffer.bind();var b=Math.pow(2,g);L.update(p.values.uSize,Math.pow(2,v+1)/u),L.update(p.values.uTexSize,b),L.updateIfChanged(p.values.uFirst,v===0),v>0&&(L.update(p.values.tPreviousLevel,h[s-v].texture),p.update()),e.state.currentRenderItemId=-1,i.viewport(0,0,b,b),i.scissor(0,0,b,b),Mr(i)?i.clearBufferiv(i.COLOR,0,[0,0,0,0]):i.clear(i.COLOR_BUFFER_BIT),i.scissor(0,0,n[0],n[1]),p.render(),d.bind(0),i.copyTexSubImage2D(i.TEXTURE_2D,0,m,0,0,0,b,b),d.unbind(0),m+=b}i.finish();var S=Math.max(1,Qot(e,h[0].texture)),x=Math.ceil(S/Math.pow(2,s));return{pyramidTex:d,count:S,height:x,levels:s,scale:r}}var By;function ast(){if(By!==void 0)return By;By=Aa(16*16,1,Uint8Array);for(var e=By.array,t=0,r=Gg.length;t<r;++t)e[t]=Gg[t].length/3;return By}var Uy;function ost(){if(Uy!==void 0)return Uy;Uy=Aa(64*64,1,Uint8Array);for(var e=Uy.array,t=0,r=Gg.length;t<r;++t)for(var n=0;n<16;++n)n<Gg[t].length?e[t*16+n]=Gg[t][n]:e[t*16+n]=255;return Uy}var sst=`
precision highp float;
precision highp int;
precision highp sampler2D;

#if __VERSION__ == 100
    uniform sampler2D tActiveVoxelsPyramid;
#else
    precision highp isampler2D;
    uniform isampler2D tActiveVoxelsPyramid;
#endif

uniform sampler2D tActiveVoxelsBase;
uniform sampler2D tVolumeData;
uniform sampler2D tTriIndices;

uniform float uIsoValue;
uniform float uLevels;
uniform float uSize;
uniform float uCount;
uniform bool uInvert;

uniform vec3 uGridDim;
uniform vec3 uGridTexDim;
uniform mat4 uGridTransform;

// scale to volume data coord
uniform vec2 uScale;

#include common

// cube corners (excluding origin)
const vec3 c1 = vec3(1., 0., 0.);
const vec3 c2 = vec3(1., 1., 0.);
const vec3 c3 = vec3(0., 1., 0.);
const vec3 c4 = vec3(0., 0., 1.);
const vec3 c5 = vec3(1., 0., 1.);
const vec3 c6 = vec3(1., 1., 1.);
const vec3 c7 = vec3(0., 1., 1.);

vec3 index3dFrom2d(vec2 coord) {
    vec2 gridTexPos = coord * uGridTexDim.xy;
    vec2 columnRow = ivec2Div(gridTexPos, uGridDim.xy);
    vec2 posXY = gridTexPos - columnRow * uGridDim.xy;
    float posZ = columnRow.y * intDiv(uGridTexDim.x, uGridDim.x) + columnRow.x;
    return vec3(posXY, posZ);
}

vec4 texture3dFrom2dNearest(sampler2D tex, vec3 pos, vec3 gridDim, vec2 texDim) {
    float zSlice = floor(pos.z * gridDim.z + 0.5); // round to nearest z-slice
    float column = intDiv(intMod(zSlice * gridDim.x, texDim.x), gridDim.x);
    float row = intDiv(zSlice * gridDim.x, texDim.x);
    vec2 coord = (vec2(column * gridDim.x, row * gridDim.y) + (pos.xy * gridDim.xy)) / (texDim / uScale);
    return texture2D(tex, coord + 0.5 / (texDim / uScale));
}

vec4 voxel(vec3 pos) {
    pos = min(max(vec3(0.0), pos), uGridDim - vec3(1.0));
    return texture3dFrom2dNearest(tVolumeData, pos / uGridDim, uGridDim, uGridTexDim.xy);
}

vec4 voxelPadded(vec3 pos) {
    pos = min(max(vec3(0.0), pos), uGridDim - vec3(vec2(2.0), 1.0)); // remove xy padding
    return texture3dFrom2dNearest(tVolumeData, pos / uGridDim, uGridDim, uGridTexDim.xy);
}

int idot2(const in ivec2 a, const in ivec2 b) {
    return a.x * b.x + a.y * b.y;
}

int idot4(const in ivec4 a, const in ivec4 b) {
    return a.x * b.x + a.y * b.y + a.z * b.z + a.w * b.w;
}

#if __VERSION__ == 100
    int pyramidVoxel(vec2 pos) {
        return int(decodeFloatRGB(texture2D(tActiveVoxelsPyramid, pos / (vec2(1.0, 0.5) * uSize)).rgb));
    }
#else
    int pyramidVoxel(vec2 pos) {
        return texture2D(tActiveVoxelsPyramid, pos / (vec2(1.0, 0.5) * uSize)).r;
    }
#endif

vec4 baseVoxel(vec2 pos) {
    return texture2D(tActiveVoxelsBase, pos / uSize);
}

void main(void) {
    // get 1D index
    int vI = int(gl_FragCoord.x) + int(gl_FragCoord.y) * int(uSize);

    // ignore 1D indices outside of the grid
    if(vI >= int(uCount)) discard;

    ivec2 offset = ivec2(int(uSize) - 2, 0);

    int start = 0;
    ivec4 starts = ivec4(0);
    ivec4 ends = ivec4(0);
    int diff = 2;
    ivec4 m = ivec4(0);
    ivec2 position = ivec2(0);
    ivec4 vI4 = ivec4(vI);

    ivec2 relativePosition = ivec2(0);
    int end = 0;
    ivec2 pos1 = ivec2(0);
    ivec2 pos2 = ivec2(0);
    ivec2 pos3 = ivec2(0);
    ivec2 pos4 = ivec2(0);
    ivec3 vI3 = ivec3(vI);
    ivec3 mask = ivec3(0);

    // traverse the different levels of the pyramid
    for(int i = 1; i < 14; i++) {
        if(float(i) >= uLevels) break;

        offset.x -= diff;
        diff *= 2;
        relativePosition = position + offset;

        end = start + pyramidVoxel(vec2(relativePosition));
        pos1 = ivec2(relativePosition);
        starts.x = start;
        ends.x = end;
        pos2 = ivec2(relativePosition + ivec2(1, 0));
        starts.y = ends.x;
        ends.y = ends.x + pyramidVoxel(vec2(pos2));
        pos3 = relativePosition + ivec2(0, 1);
        starts.z = ends.y;
        ends.z = ends.y + pyramidVoxel(vec2(pos3));
        pos4 = relativePosition + ivec2(1, 1);
        starts.w = ends.z;
        mask = ivec3(greaterThanEqual(vI3, starts.rgb)) * ivec3(lessThan(vI3, ends.rgb));
        m = ivec4(mask, 1 - int(any(bvec3(mask))));

        relativePosition = m.x * pos1 + m.y * pos2 + m.z * pos3 + m.w * pos4;
        start = idot4(m, starts);
        position = 2 * (relativePosition - offset);
    }

    end = start + int(baseVoxel(vec2(position)).r * 255.0);
    pos1 = position;
    starts.x = start;
    ends.x = end;
    pos2 = position + ivec2(1, 0);
    starts.y = ends.x;
    ends.y = ends.x + int(baseVoxel(vec2(pos2)).r * 255.0);
    pos3 = position + ivec2(0, 1);
    starts.z = ends.y;
    ends.z = ends.y + int(baseVoxel(vec2(pos3)).r * 255.0);
    pos4 = position + ivec2(1, 1);
    starts.w = ends.z;
    mask = ivec3(greaterThanEqual(vI3, starts.rgb)) * ivec3(lessThan(vI3, ends.rgb));
    m = ivec4(mask, 1 - int(any(bvec3(mask))));
    position = m.x * pos1 + m.y * pos2 + m.z * pos3 + m.w * pos4;

    vec2 coord2d = (vec2(position) / uSize) / uScale;
    vec3 coord3d = floor(index3dFrom2d(coord2d) + 0.5);

    float edgeIndex = floor(baseVoxel(vec2(position)).a * 255.0 + 0.5);

    // current vertex for the up to 15 MC cases
    int currentVertex = vI - idot4(m, starts);

    // ensure winding-order is the same for negative and positive iso-levels
    if (uInvert) {
        int v = imod(currentVertex + 1, 3);
        if (v == 1) currentVertex += 2;
        else if (v == 0) currentVertex -= 2;
    }

    // get index into triIndices table
    int mcIndex = 16 * int(edgeIndex) + currentVertex;
    vec4 mcData = texture2D(tTriIndices, vec2(imod(mcIndex, 64), mcIndex / 64) / 64.);

    // bit mask to avoid conditionals (see comment below) for getting MC case corner
    vec4 m0 = vec4(floor(mcData.a * 255.0 + 0.5));

    // get edge value masks
    vec4 m1 = vec4(equal(m0, vec4(0., 1., 2., 3.)));
    vec4 m2 = vec4(equal(m0, vec4(4., 5., 6., 7.)));
    vec4 m3 = vec4(equal(m0, vec4(8., 9., 10., 11.)));

    // apply bit masks
    vec3 b0 = coord3d +
                m1.y * c1 +
                m1.z * c2 +
                m1.w * c3 +
                m2.x * c4 +
                m2.y * c5 +
                m2.z * c6 +
                m2.w * c7 +
                m3.y * c1 +
                m3.z * c2 +
                m3.w * c3;
    vec3 b1 = coord3d +
                m1.x * c1 +
                m1.y * c2 +
                m1.z * c3 +
                m2.x * c5 +
                m2.y * c6 +
                m2.z * c7 +
                m2.w * c4 +
                m3.x * c4 +
                m3.y * c5 +
                m3.z * c6 +
                m3.w * c7;

    // the conditionals that are avoided by above bitmasks
    // vec3 b0 = coord3d;
    // vec3 b1 = coord3d;
    // if (mcIndex == 0.0) {
    //     b1 += c1;
    // } else if (mcIndex == 1.0) {
    //     b0 += c1; b1 += c2;
    // } else if (mcIndex == 2.0) {
    //     b0 += c2; b1 += c3;
    // } else if (mcIndex == 3.0) {
    //     b0 += c3;
    // } else if (mcIndex == 4.0) {
    //     b0 += c4; b1 += c5;
    // } else if (mcIndex == 5.0) {
    //     b0 += c5; b1 += c6;
    // } else if (mcIndex == 6.0) {
    //     b0 += c6; b1 += c7;
    // } else if (mcIndex == 7.0) {
    //     b0 += c7; b1 += c4;
    // } else if (mcIndex == 8.0) {
    //     b1 += c4;
    // } else if (mcIndex == 9.0) {
    //     b0 += c1; b1 += c5;
    // } else if (mcIndex == 10.0) {
    //     b0 += c2; b1 += c6;
    // } else if (mcIndex == 11.0) {
    //     b0 += c3; b1 += c7;
    // }
    // b0 = floor(b0 + 0.5);
    // b1 = floor(b1 + 0.5);

    vec4 d0 = voxel(b0);
    vec4 d1 = voxel(b1);

    float v0 = d0.a;
    float v1 = d1.a;

    float t = (uIsoValue - v0) / (v0 - v1);
    gl_FragData[0].xyz = (uGridTransform * vec4(b0 + t * (b0 - b1), 1.0)).xyz;

    // group id
    #if __VERSION__ == 100
        // webgl1 does not support 'flat' interpolation (i.e. no interpolation)
        // so we ensure a constant group id per triangle here
        #ifdef dPackedGroup
            gl_FragData[1] = vec4(voxel(coord3d).rgb, 1.0);
        #else
            vec3 gridDim = uGridDim - vec3(1.0, 1.0, 0.0); // remove xy padding
            float group = coord3d.z + coord3d.y * gridDim.z + coord3d.x * gridDim.z * gridDim.y;
            gl_FragData[1] = vec4(group > 16777215.5 ? vec3(1.0) : encodeFloatRGB(group), 1.0);
        #endif
    #else
        #ifdef dPackedGroup
            gl_FragData[1] = vec4(t < 0.5 ? d0.rgb : d1.rgb, 1.0);
        #else
            vec3 b = t < 0.5 ? b0 : b1;
            vec3 gridDim = uGridDim - vec3(1.0, 1.0, 0.0); // remove xy padding
            float group = b.z + b.y * gridDim.z + b.x * gridDim.z * gridDim.y;
            gl_FragData[1] = vec4(group > 16777215.5 ? vec3(1.0) : encodeFloatRGB(group), 1.0);
        #endif
    #endif

    // normals from gradients
    vec3 n0 = -normalize(vec3(
        voxelPadded(b0 - c1).a - voxelPadded(b0 + c1).a,
        voxelPadded(b0 - c3).a - voxelPadded(b0 + c3).a,
        voxelPadded(b0 - c4).a - voxelPadded(b0 + c4).a
    ));
    vec3 n1 = -normalize(vec3(
        voxelPadded(b1 - c1).a - voxelPadded(b1 + c1).a,
        voxelPadded(b1 - c3).a - voxelPadded(b1 + c3).a,
        voxelPadded(b1 - c4).a - voxelPadded(b1 + c4).a
    ));
    gl_FragData[2].xyz = -vec3(
        n0.x + t * (n0.x - n1.x),
        n0.y + t * (n0.y - n1.y),
        n0.z + t * (n0.z - n1.z)
    );

    // ensure normal-direction is the same for negative and positive iso-levels
    if (uInvert) {
        gl_FragData[2].xyz *= -1.0;
    }

    // apply normal matrix
    gl_FragData[2].xyz *= transpose3(inverse3(mat3(uGridTransform)));
}
`,ust=`
precision highp float;
precision highp int;
precision highp sampler2D;

uniform sampler2D tTriCount;
uniform sampler2D tVolumeData;

uniform float uIsoValue;
uniform vec3 uGridDim;
uniform vec3 uGridTexDim;
uniform vec2 uScale;

#include common

// cube corners (excluding origin)
const vec3 c1 = vec3(1., 0., 0.);
const vec3 c2 = vec3(1., 1., 0.);
const vec3 c3 = vec3(0., 1., 0.);
const vec3 c4 = vec3(0., 0., 1.);
const vec3 c5 = vec3(1., 0., 1.);
const vec3 c6 = vec3(1., 1., 1.);
const vec3 c7 = vec3(0., 1., 1.);

vec3 index3dFrom2d(vec2 coord) {
    vec2 gridTexPos = coord * uGridTexDim.xy;
    vec2 columnRow = ivec2Div(gridTexPos, uGridDim.xy);
    vec2 posXY = gridTexPos - columnRow * uGridDim.xy;
    float posZ = columnRow.y * intDiv(uGridTexDim.x, uGridDim.x) + columnRow.x;
    return vec3(posXY, posZ);
}

vec4 texture3dFrom2dNearest(sampler2D tex, vec3 pos, vec3 gridDim, vec2 texDim) {
    float zSlice = floor(pos.z * gridDim.z + 0.5); // round to nearest z-slice
    float column = intDiv(intMod(zSlice * gridDim.x, texDim.x), gridDim.x);
    float row = intDiv(zSlice * gridDim.x, texDim.x);
    vec2 coord = (vec2(column * gridDim.x, row * gridDim.y) + (pos.xy * gridDim.xy)) / (texDim / uScale);
    return texture2D(tex, coord);
}

vec4 voxel(vec3 pos) {
    pos = min(max(vec3(0.0), pos), uGridDim - vec3(1.0));
    return texture3dFrom2dNearest(tVolumeData, pos / uGridDim, uGridDim, uGridTexDim.xy);
}

void main(void) {
    vec2 uv = gl_FragCoord.xy / uGridTexDim.xy;
    vec3 posXYZ = index3dFrom2d(uv);

    // get MC case as the sum of corners that are below the given iso level
    float c = step(voxel(posXYZ).a, uIsoValue)
        + 2. * step(voxel(posXYZ + c1).a, uIsoValue)
        + 4. * step(voxel(posXYZ + c2).a, uIsoValue)
        + 8. * step(voxel(posXYZ + c3).a, uIsoValue)
        + 16. * step(voxel(posXYZ + c4).a, uIsoValue)
        + 32. * step(voxel(posXYZ + c5).a, uIsoValue)
        + 64. * step(voxel(posXYZ + c6).a, uIsoValue)
        + 128. * step(voxel(posXYZ + c7).a, uIsoValue);
    c *= step(c, 254.);

    // handle out of bounds positions
    posXYZ += 1.0;
    posXYZ.xy += 1.0; // pixel padding (usually ok even if the texture has no padding)
    if (posXYZ.x >= uGridDim.x || posXYZ.y >= uGridDim.y || posXYZ.z >= uGridDim.z)
        c = 0.0;

    // get total triangles to generate for calculated MC case from triCount texture
    float totalTrianglesToGenerate = texture2D(tTriCount, vec2(intMod(c, 16.), floor(c / 16.)) / 16.).a;
    gl_FragColor = vec4(vec3(totalTrianglesToGenerate * 3.0), c / 255.0);
}
`,lst=E(E({},Pa),{tTriCount:cr("image-uint8","alpha","ubyte","nearest"),tVolumeData:cr("texture","rgba","ubyte","nearest"),uIsoValue:Ge("f"),uGridDim:Ge("v3"),uGridTexDim:Ge("v3"),uScale:Ge("v2")}),_u="active-voxels";function cst(e,t,r,n,i,a){if(e.namedComputeRenderables[_u]){var o=e.namedComputeRenderables[_u].values;L.update(o.uQuadScale,a),L.update(o.tVolumeData,t),L.updateIfChanged(o.uIsoValue,i),L.update(o.uGridDim,r),L.update(o.uGridTexDim,n),L.update(o.uScale,a),e.namedComputeRenderables[_u].update()}else e.namedComputeRenderables[_u]=dst(e,t,r,n,i,a);return e.namedComputeRenderables[_u]}function dst(e,t,r,n,i,a){var o=E(E({},Ta),{tTriCount:L.create(ast()),uQuadScale:L.create(a),tVolumeData:L.create(t),uIsoValue:L.create(i),uGridDim:L.create(r),uGridTexDim:L.create(n),uScale:L.create(a)}),s=E({},lst),u=Bn("active-voxels",Bo,ust),l=ra(e,"triangles",u,s,o);return ta(l,o)}function fst(e){var t=e.gl,r=e.state;r.disable(t.CULL_FACE),r.disable(t.BLEND),r.disable(t.DEPTH_TEST),r.enable(t.SCISSOR_TEST),r.depthMask(!1),r.colorMask(!0,!0,!0,!0),r.clearColor(0,0,0,0)}function hst(e,t,r,n,i,a){var o=e.gl,s=e.resources,u=t.getWidth(),l=t.getHeight();e.namedFramebuffers[_u]||(e.namedFramebuffers[_u]=s.framebuffer());var c=e.namedFramebuffers[_u];c.bind(),e.namedTextures[_u]||(e.namedTextures[_u]=s.texture("image-uint8","rgba","ubyte","nearest"));var d=e.namedTextures[_u];d.define(u,l);var f=cst(e,t,r,n,i,a);return e.state.currentRenderItemId=-1,d.attachFramebuffer(c,0),fst(e),o.viewport(0,0,u,l),o.scissor(0,0,u,l),o.clear(o.COLOR_BUFFER_BIT),o.scissor(0,0,n[0],n[1]),f.render(),o.finish(),d}var pst=E(E({},Pa),{tTriIndices:cr("image-uint8","alpha","ubyte","nearest"),tActiveVoxelsPyramid:cr("texture","rgba","float","nearest"),tActiveVoxelsBase:cr("texture","rgba","float","nearest"),tVolumeData:cr("texture","rgba","ubyte","nearest"),uIsoValue:Ge("f"),uSize:Ge("f"),uLevels:Ge("f"),uCount:Ge("f"),uInvert:Ge("b"),uGridDim:Ge("v3"),uGridTexDim:Ge("v3"),uGridTransform:Ge("m4"),uScale:Ge("v2"),dPackedGroup:Jt("boolean")}),Vf="isosurface";function vst(e,t,r,n,i,a,o,s,u,l,c,d,f){if(e.namedComputeRenderables[Vf]){var h=e.namedComputeRenderables[Vf].values;L.update(h.tActiveVoxelsPyramid,t),L.update(h.tActiveVoxelsBase,r),L.update(h.tVolumeData,n),L.updateIfChanged(h.uIsoValue,s),L.updateIfChanged(h.uSize,Math.pow(2,u)),L.updateIfChanged(h.uLevels,u),L.updateIfChanged(h.uCount,c),L.updateIfChanged(h.uInvert,d),L.update(h.uGridDim,i),L.update(h.uGridTexDim,a),L.update(h.uGridTransform,o),L.update(h.uScale,l),L.update(h.dPackedGroup,f),e.namedComputeRenderables[Vf].update()}else e.namedComputeRenderables[Vf]=mst(e,t,r,n,i,a,o,s,u,l,c,d,f);return e.namedComputeRenderables[Vf]}function mst(e,t,r,n,i,a,o,s,u,l,c,d,f){var h=E(E({},Ta),{tTriIndices:L.create(ost()),tActiveVoxelsPyramid:L.create(t),tActiveVoxelsBase:L.create(r),tVolumeData:L.create(n),uIsoValue:L.create(s),uSize:L.create(Math.pow(2,u)),uLevels:L.create(u),uCount:L.create(c),uInvert:L.create(d),uGridDim:L.create(i),uGridTexDim:L.create(a),uGridTransform:L.create(o),uScale:L.create(l),dPackedGroup:L.create(f)}),v=E({},pst),p=Bn("isosurface",Bo,sst,{drawBuffers:"required"}),m=ra(e,"triangles",p,v,h);return ta(m,h)}function gst(e){var t=e.gl,r=e.state;r.disable(t.CULL_FACE),r.disable(t.BLEND),r.disable(t.DEPTH_TEST),r.disable(t.SCISSOR_TEST),r.depthMask(!1),r.colorMask(!0,!0,!0,!0),r.clearColor(0,0,0,0)}function yst(e,t,r,n,i,a,o,s,u,l,c,d,f){var h=e.gl,v=e.resources,p=e.extensions,m=n.pyramidTex,g=n.height,y=n.levels,b=n.scale,S=n.count,x=m.getWidth();e.namedFramebuffers[Vf]||(e.namedFramebuffers[Vf]=v.framebuffer());var C=e.namedFramebuffers[Vf];Mr(h)?(c||(c=p.colorBufferHalfFloat&&p.textureHalfFloat?v.texture("image-float16","rgba","fp16","nearest"):v.texture("image-float32","rgba","float","nearest")),d||(d=v.texture("image-uint8","rgba","ubyte","nearest")),f||(f=p.colorBufferHalfFloat&&p.textureHalfFloat?v.texture("image-float16","rgba","fp16","nearest"):v.texture("image-float32","rgba","float","nearest"))):(c||(c=v.texture("image-float32","rgba","float","nearest")),d||(d=v.texture("image-float32","rgba","float","nearest")),f||(f=v.texture("image-float32","rgba","float","nearest"))),c.define(x,g),d.define(x,g),f.define(x,g),c.attachFramebuffer(C,0),d.attachFramebuffer(C,1),f.attachFramebuffer(C,2);var w=vst(e,m,t,r,i,a,o,s,y,b,S,u,l);e.state.currentRenderItemId=-1;var A=e.extensions.drawBuffers;if(!A)throw new Error("need WebGL draw buffers");return C.bind(),A.drawBuffers([A.COLOR_ATTACHMENT0,A.COLOR_ATTACHMENT1,A.COLOR_ATTACHMENT2]),gst(e),h.viewport(0,0,x,g),h.clear(h.COLOR_BUFFER_BIT),w.render(),h.finish(),{vertexTexture:c,groupTexture:d,normalTexture:f,vertexCount:S}}function iL(e,t,r,n,i,a,o,s,u,l,c,d){var f=hst(e,t,r,n,o,i),h=ist(e,f,i,n),v=yst(e,f,t,h,r,n,a,o,s,u,l,c,d);return v}var rae={isoValue:Ct.IsoValueParam};function bst(e){return e.extensions.colorBufferFloat&&e.extensions.textureFloat&&e.extensions.drawBuffers}var S1=1;function aL(e,t){var r=e.grid.cells.space.dimensions,n=V2(r,S1).powerOfTwoSize;return n<=t.maxTextureSize/2}function xst(e,t,r,n){return r.tryUseGpu&&n&&bst(n)&&aL(t,n)?wst(e):Cst(e)}function hG(e,t){return Ct.Isosurface.Loci(e,t.isoValue)}function oL(e,t,r,n){var i=e.objectId,a=e.groupId;return n===i?Ct.Cell.Loci(t,Ie.ofSingleton(a)):jr}function sL(e,t,r,n){return nL(e,t,r.isoValue,n)}function Sst(e,t,r,n,i){return ce(this,void 0,void 0,function(){var a,o,s;return de(this,function(u){switch(u.label){case 0:return e.runtime.update({message:"Marching cubes..."}),a=Js(new Int32Array(t.grid.cells.data.length)),[4,TA({isoLevel:Ct.IsoValue.toAbsolute(n.isoValue,t.grid.stats).absoluteValue,scalarField:t.grid.cells,idField:kr.create(t.grid.cells.space,kr.Data1(a))},i).runAsChild(e.runtime)];case 1:return o=u.sent(),s=La.getGridToCartesianTransform(t.grid),Lt.transform(o,s),e.webgl&&!e.webgl.isWebGL2&&Lt.uniformTriangleGroup(o,!1),o.setBoundingSphere(Ct.getBoundingSphere(t)),[2,o]}})})}var uL=E(E(E(E({},Lt.Params),Yu.Params),rae),{quality:E(E({},Lt.Params.quality),{isEssential:!1}),tryUseGpu:I.Boolean(!0)});function Cst(e){return z2({defaultProps:I.getDefaultValues(uL),createGeometry:Sst,createLocationIterator:function(t){return wn(t.grid.cells.data.length,1,1,function(){return hs})},getLoci:oL,eachLocation:sL,setUpdateState:function(t,r,n,i){Ct.IsoValue.areSame(n.isoValue,i.isoValue,r.grid.stats)||(t.createGeometry=!0)},geometryUtils:Lt.Utils,mustRecreate:function(t,r,n){return r.tryUseGpu&&!!n&&aL(t,n)}},e)}var YR;(function(e){var t="volume-isosurface-texture";e.descriptor=ko({name:t});function r(n,i){var a=i.resources,o=La.getGridToCartesianTransform(n.grid),s=_.clone(n.grid.cells.space.dimensions),u=V2(s,S1),l=u.width,c=u.height,d=u.powerOfTwoSize,f=_.create(l,c,0),h=He.create(l/d,c/d);if(d>i.maxTextureSize/2)throw new Error("volume too large for gpu isosurface extraction");if(!n._propertyData[t]){n._propertyData[t]=a.texture("image-uint8","alpha","ubyte","linear");var v=n._propertyData[t];v.define(d,d),v.load(eae(n,"data",S1),!0),n.customProperties.add(e.descriptor),n.customProperties.assets(e.descriptor,[{dispose:function(){return v.destroy()}}])}return s[0]+=S1,s[1]+=S1,{texture:n._propertyData[t],transform:o,gridDimension:s,gridTexDim:f,gridTexScale:h}}e.get=r})(YR||(YR={}));function _st(e,t,r,n,i){return ce(this,void 0,void 0,function(){var a,o,s,u,l,c,d,f,h,v,p,m,g,y,b;return de(this,function(S){if(!e.webgl)throw new Error("webgl context required to create volume isosurface texture-mesh");return a=t.grid.stats,o=a.max,s=a.min,u=o-s,l=Ct.IsoValue.toAbsolute(n.isoValue,t.grid.stats).absoluteValue,c=(l-s)/u,d=YR.get(t,e.webgl),f=d.texture,h=d.gridDimension,v=d.gridTexDim,p=d.gridTexScale,m=d.transform,g=i==null?void 0:i.doubleBuffer.get(),y=iL(e.webgl,f,h,v,p,m,c,l<0,!1,g==null?void 0:g.vertex,g==null?void 0:g.group,g==null?void 0:g.normal),b=Yu.create(y.vertexCount,1,y.vertexTexture,y.groupTexture,y.normalTexture,Ct.getBoundingSphere(t),i),[2,b]})})}function wst(e){return z2({defaultProps:I.getDefaultValues(uL),createGeometry:_st,createLocationIterator:function(t){return wn(t.grid.cells.data.length,1,1,function(){return hs})},getLoci:oL,eachLocation:sL,setUpdateState:function(t,r,n,i){Ct.IsoValue.areSame(n.isoValue,i.isoValue,r.grid.stats)||(t.createGeometry=!0)},geometryUtils:Yu.Utils,mustRecreate:function(t,r,n){return!r.tryUseGpu||!n||!aL(t,n)},dispose:function(t){t.vertexTexture.ref.value.destroy(),t.groupTexture.ref.value.destroy(),t.normalTexture.ref.value.destroy(),t.doubleBuffer.destroy()}},e)}function Est(e,t,r,n,i){return ce(this,void 0,void 0,function(){var a,o,s;return de(this,function(u){switch(u.label){case 0:return e.runtime.update({message:"Marching cubes..."}),a=Js(new Int32Array(t.grid.cells.data.length)),[4,rL({isoLevel:Ct.IsoValue.toAbsolute(n.isoValue,t.grid.stats).absoluteValue,scalarField:t.grid.cells,idField:kr.create(t.grid.cells.space,kr.Data1(a))},i).runAsChild(e.runtime)];case 1:return o=u.sent(),s=La.getGridToCartesianTransform(t.grid),Pn.transform(o,s),o.setBoundingSphere(Ct.getBoundingSphere(t)),[2,o]}})})}var nae=E(E(E({},Pn.Params),rae),{quality:E(E({},Pn.Params.quality),{isEssential:!1}),sizeFactor:I.Numeric(3,{min:0,max:10,step:.1})});function Ast(e){return z2({defaultProps:I.getDefaultValues(nae),createGeometry:Est,createLocationIterator:function(t){return wn(t.grid.cells.data.length,1,1,function(){return hs})},getLoci:oL,eachLocation:sL,setUpdateState:function(t,r,n,i){Ct.IsoValue.areSame(n.isoValue,i.isoValue,r.grid.stats)||(t.createGeometry=!0)},geometryUtils:Pn.Utils},e)}var iae={solid:function(e,t){return e3("Isosurface mesh",e,t,xst,hG)},wireframe:function(e,t){return e3("Isosurface wireframe",e,t,Ast,hG)}},aae=E(E(E({},uL),nae),{visuals:I.MultiSelect(["solid"],I.objectToOptions(iae))});function Pst(e,t){var r=I.clone(aae);return r.isoValue=Ct.createIsoValueParam(Ct.IsoValue.relative(2),t.grid.stats),r}function Tst(e,t){return ur.createMulti("Isosurface",e,t,ur.StateBuilder,iae)}var Ist={name:"isosurface",label:"Isosurface",description:"Displays a triangulated isosurface of volumetric data.",factory:Tst,getParams:Pst,defaultValues:I.getDefaultValues(aae),defaultColorTheme:{name:"uniform"},defaultSizeTheme:{name:"uniform"},isApplicable:function(e){return!Ct.isEmpty(e)}};function Mst(e,t,r,n,i){return ce(this,void 0,void 0,function(){var a,o,s,u,l,c,d,f,h,v,p,m,g,y,b,S,x,C,w,A,M,D,k,R,O,H,B,j,Y,G,$,q,ee,fe,W,X,U,z;return de(this,function(J){for(a=n.dimension.name,o=n.isoValue,s=t.grid.cells,u=s.space,l=s.data,c=t.grid.stats,d=c.min,f=c.max,h=Ct.IsoValue.toAbsolute(o,t.grid.stats).absoluteValue,v=r.color.color(hs,!1),p=at.toRgbNormalized(v),m=p[0],g=p[1],y=p[2],b=lL(t.grid,n),S=b.width,x=b.height,C=b.x,w=b.y,A=b.z,M=b.x0,D=b.y0,k=b.z0,R=b.nx,O=b.ny,H=b.nz,B=new Float32Array(a==="x"?[C,0,0,C,w,0,C,0,A,C,w,A]:a==="y"?[0,w,0,C,w,0,0,w,A,C,w,A]:[0,0,A,0,w,A,C,0,A,C,w,A]),j=new Uint8Array(S*x*4),Y=Dst(t.grid,n),G=0,$=D;$<O;++$)for(q=M;q<R;++q)for(ee=k;ee<H;++ee)fe=u.get(l,q,$,ee),W=(fe-d)/(f-d),j[G]=m*W*2*255,j[G+1]=g*W*2*255,j[G+2]=y*W*2*255,j[G+3]=fe>=h?255:0,G+=4;return X={width:S,height:x,array:j,flipY:!0},U={width:S,height:x,array:Y,flipY:!0},z=La.getGridToCartesianTransform(t.grid),Nv(z,B,0,4),[2,gd.create(X,B,U,i)]})})}function lL(e,t){var r=t.dimension,n=r.name,i=r.params,a=e.cells.space,o,s,u,l,c,d=0,f=0,h=0,v=a.dimensions,p=v[0],m=v[1],g=v[2];return n==="x"?(u=i,l=m-1,c=g-1,o=g,s=m,d=u,p=d+1):n==="y"?(u=p-1,l=i,c=g-1,o=g,s=p,f=l,m=f+1):(u=p-1,l=m-1,c=i,o=p,s=m,h=c,g=h+1),{width:o,height:s,x:u,y:l,z:c,x0:d,y0:f,z0:h,nx:p,ny:m,nz:g}}function Dst(e,t){for(var r=e.cells.space,n=lL(e,t),i=n.width,a=n.height,o=n.x0,s=n.y0,u=n.z0,l=n.nx,c=n.ny,d=n.nz,f=new Uint8Array(i*a*4),h=0,v=s;v<c;++v)for(var p=o;p<l;++p)for(var m=u;m<d;++m)M2(r.dataOffset(p,v,m),f,h),h+=4;return f}function Rst(e,t){for(var r=e.cells.space,n=lL(e,t),i=n.width,a=n.height,o=n.x0,s=n.y0,u=n.z0,l=n.nx,c=n.ny,d=n.nz,f=new Uint32Array(i*a),h=0,v=s;v<c;++v)for(var p=o;p<l;++p)for(var m=u;m<d;++m)f[h]=r.dataOffset(p,v,m),h+=1;return f}function kst(e,t){var r=Rst(e.grid,t);return Ct.Cell.Loci(e,Je.ofUnsortedArray(r))}function Ost(e,t,r,n){var i=e.objectId,a=e.groupId;return n===i?Ct.Cell.Loci(t,Ie.ofSingleton(a)):jr}function Fst(e,t,r,n){return nL(e,t,void 0,n)}var cL=E(E({},gd.Params),{quality:E(E({},gd.Params.quality),{isEssential:!1}),dimension:I.MappedStatic("x",{x:I.Numeric(0,{min:0,max:0,step:1}),y:I.Numeric(0,{min:0,max:0,step:1}),z:I.Numeric(0,{min:0,max:0,step:1})},{isEssential:!0}),isoValue:Ct.IsoValueParam});function Lst(e,t){var r=I.clone(cL),n=t.grid.cells.space.dimensions;return r.dimension=I.MappedStatic("x",{x:I.Numeric(0,{min:0,max:n[0]-1,step:1}),y:I.Numeric(0,{min:0,max:n[1]-1,step:1}),z:I.Numeric(0,{min:0,max:n[2]-1,step:1})},{isEssential:!0}),r.isoValue=Ct.createIsoValueParam(Ct.IsoValue.absolute(t.grid.stats.min),t.grid.stats),r}function Nst(e){return z2({defaultProps:I.getDefaultValues(cL),createGeometry:Mst,createLocationIterator:function(t){return wn(t.grid.cells.data.length,1,1,function(){return hs})},getLoci:Ost,eachLocation:Fst,setUpdateState:function(t,r,n,i,a,o){t.createGeometry=n.dimension.name!==i.dimension.name||n.dimension.params!==i.dimension.params||!Ct.IsoValue.areSame(n.isoValue,i.isoValue,r.grid.stats)||!yd.areEqual(a.color,o.color)},geometryUtils:E(E({},gd.Utils),{createRenderableState:function(t){var r=gd.Utils.createRenderableState(t);return pG(r,t),r},updateRenderableState:pG})},e)}function pG(e,t){gd.Utils.updateRenderableState(e,t),e.opaque=!1,e.writeDepth=!0}function Bst(e,t){return e3("Slice",e,t,Nst,kst)}var Ust={name:"slice",label:"Slice",description:"Slice of volume rendered as image with interpolation.",factory:Bst,getParams:Lst,defaultValues:I.getDefaultValues(cL),defaultColorTheme:{name:"uniform"},defaultSizeTheme:{name:"uniform"},isApplicable:function(e){return!Ct.isEmpty(e)}};function oae(e,t){var r=Kt();return Kt.add(r,e),Kt.transform(r,r,t),r}function jst(e,t,r,n){var i=r.grid.cells.space.dimensions,a=V2(i),o=a.width,s=a.height;if(Math.max(o,s)>t.maxTextureSize/2)throw new Error("volume too large for direct-volume rendering");var u=eae(r,"normals"),l=La.getGridToCartesianTransform(r.grid),c=oae(i,l),d=n?n.gridTexture.ref.value:t.resources.texture("image-uint8","rgba","ubyte","linear");d.load(u);var f=sae(r.grid),h=f.unitToCartn,v=f.cellDim;return uo.create(c,i,l,h,v,d,r.grid.stats,!1,n)}function sae(e){if(e.transform.kind==="matrix")return{unitToCartn:ue.mul(ue(),e.transform.matrix,ue.fromScaling(ue(),e.cells.space.dimensions)),cellDim:ue.getScaling(_(),e.transform.matrix)};var t=e.transform.fractionalBox,r=Kt.size(_(),t);return{unitToCartn:ue.mul3(ue(),e.transform.cell.fromFractional,ue.fromTranslation(ue(),t.min),ue.fromScaling(ue(),r)),cellDim:_.div(_(),e.transform.cell.size,e.cells.space.dimensions)}}function zst(e,t,r,n){var i=r.grid.cells.space.dimensions;if(Math.max.apply(Math,i)>t.max3dTextureSize/2)throw new Error("volume too large for direct-volume rendering");var a=qot(r),o=La.getGridToCartesianTransform(r.grid),s=oae(i,o),u=n?n.gridTexture.ref.value:t.resources.texture("volume-uint8","rgba","ubyte","linear");u.load(a);var l=sae(r.grid),c=l.unitToCartn,d=l.cellDim;return uo.create(s,i,o,c,d,u,r.grid.stats,!1,n)}function Vst(e,t,r,n,i){return ce(this,void 0,void 0,function(){var a,o;return de(this,function(s){if(a=e.runtime,o=e.webgl,o===void 0)throw new Error("DirectVolumeVisual requires `webgl` in props");return[2,o.isWebGL2?zst(a,o,t,i):jst(a,o,t,i)]})})}function Hst(e,t){return t.renderMode.name==="isosurface"?Ct.Isosurface.Loci(e,t.renderMode.params.isoValue):Ct.Loci(e)}function Gst(e,t,r,n){var i=e.objectId,a=e.groupId;return n===i?Ct.Cell.Loci(t,Ie.ofSingleton(a)):jr}function qst(e,t,r,n){var i=r.renderMode.name==="isosurface"?r.renderMode.params.isoValue:void 0;return nL(e,t,i,n)}var dL=E(E({},uo.Params),{quality:E(E({},uo.Params.quality),{isEssential:!1})});function $st(e,t){var r=I.clone(dL);return r.renderMode=uo.createRenderModeParam(t.grid.stats),r}function Wst(e){return z2({defaultProps:I.getDefaultValues(dL),createGeometry:Vst,createLocationIterator:function(t){return wn(t.grid.cells.data.length,1,1,function(){return hs})},getLoci:Gst,eachLocation:qst,setUpdateState:function(t,r,n,i){},geometryUtils:uo.Utils,dispose:function(t){t.gridTexture.ref.value.destroy()}},e)}function Xst(e,t){return e3("Direct Volume",e,t,Wst,Hst)}var Yst={name:"direct-volume",label:"Direct Volume",description:"Direct rendering of volumetric data.",factory:Xst,getParams:$st,defaultValues:I.getDefaultValues(dL),defaultColorTheme:{name:"uniform"},defaultSizeTheme:{name:"uniform"},isApplicable:function(e){return!Ct.isEmpty(e)}},i3=function(e){Le(t,e);function t(){var r=e.call(this)||this;return $u(t.BuiltIn,function(n,i){if(n.name!==i)throw new Error("Fix BuiltInVolumeRepresentations to have matching names. "+n.name+" "+i);r.add(n)}),r}return t}(Nre);(function(e){e.BuiltIn={isosurface:Ist,slice:Ust,"direct-volume":Yst}})(i3||(i3={}));function vG(e,t,r,n){e.push({source:t==="em"?{name:"em",params:{isoValue:Ct.IsoValue.absolute(n||0)}}:{name:"x-ray",params:{}},dataId:r})}var KR=Ro.build({display:{name:"Volume Streaming"},from:ge.Molecule.Structure,params:function(e,t){var r=Dot(e&&e.data),n=Oot(r,e&&e.data);return{method:I.Select(r,[["em","EM"],["x-ray","X-Ray"]]),entries:I.ObjectList({id:I.Text(n[0]||"")},function(i){var a=i.id;return a},{defaultValue:n.map(function(i){return{id:i}})}),defaultView:I.Select(r==="em"?"cell":"selection-box",Ga.ViewTypeOptions),options:I.Group({serverUrl:I.Text(t.config.get(Zr.VolumeStreaming.DefaultServer)||"https://ds.litemol.org"),behaviorRef:I.Text("",{isHidden:!0}),emContourProvider:I.Select("emdb",[["emdb","EMDB"],["pdbe","PDBe"]],{isHidden:!0}),channelParams:I.Value({},{isHidden:!0})})}},isApplicable:function(e,t,r){var n=r.config.get(Zr.VolumeStreaming.CanStream);return n?n(e.data,r):e.data.models.length===1&&Xt.probablyHasDensityMap(e.data.models[0])}})(function(e,t){var r=e.ref,n=e.state,i=e.params;return $e.create("Volume Streaming",function(a){return ce(void 0,void 0,void 0,function(){var o,s,u,l,c,d,f,h,v,p,m,g,y,b,S,x,C;return de(this,function(w){switch(w.label){case 0:o=[],s=0,u=i.entries.length,w.label=1;case 1:return s<u?(l=i.entries[s].id.toLowerCase(),c=void 0,i.method!=="em"?[3,14]:l.toUpperCase().startsWith("EMD")?[3,11]:[4,a.update("Getting EMDB info...")]):[3,16];case 2:return w.sent(),[4,Not(t,a,l)];case 3:d=w.sent(),f=0,h=d.length,w.label=4;case 4:if(!(f<h))return[3,10];v=d[f],p=void 0,w.label=5;case 5:return w.trys.push([5,7,,8]),[4,cG(i.options.emContourProvider,t,a,v)];case 6:return p=w.sent(),[3,8];case 7:return m=w.sent(),console.info("Could not get map info for "+v+": "+m),[3,9];case 8:vG(o,i.method,v,p||0),w.label=9;case 9:return++f,[3,4];case 10:return[3,15];case 11:return w.trys.push([11,13,,14]),[4,cG(i.options.emContourProvider,t,a,l)];case 12:return c=w.sent(),[3,14];case 13:return g=w.sent(),console.info("Could not get map info for "+l+": "+g),[3,15];case 14:vG(o,i.method,l,c||0),w.label=15;case 15:return++s,[3,1];case 16:return y=n.build().to(r).applyOrUpdateTagged(Ga.RootTag,Zst,{serverUrl:i.options.serverUrl,entries:o}),[4,y.commit()];case 17:return w.sent(),b=y.selector,b.isOk?(S=n.tree.children.get(b.ref),(S==null?void 0:S.size)>0?[4,t.managers.structure.hierarchy.remove(S==null?void 0:S.toArray())]:[3,19]):[2];case 18:w.sent(),w.label=19;case 19:return x=b.cell.obj,C=n.build().to(y.ref).apply(fL,I.getDefaultValues(Ga.createParams({data:x.data,defaultView:i.defaultView,channelParams:i.options.channelParams})),{ref:i.options.behaviorRef?i.options.behaviorRef:void 0}),i.method==="em"?C.apply(_S,{channel:"em"},{state:{isGhost:!0},tags:"em"}):(C.apply(_S,{channel:"2fo-fc"},{state:{isGhost:!0},tags:"2fo-fc"}),C.apply(_S,{channel:"fo-fc(+ve)"},{state:{isGhost:!0},tags:"fo-fc(+ve)"}),C.apply(_S,{channel:"fo-fc(-ve)"},{state:{isGhost:!0},tags:"fo-fc(-ve)"})),[4,n.updateTree(C).runInContext(a)];case 20:return w.sent(),[2]}})})})}),Kst=Ro.build({display:{name:"Boxify Volume Streaming",description:"Make the current box permanent."},from:Ga,isApplicable:function(e){return e.data.params.entry.params.view.name==="selection-box"}})(function(e,t){var r=e.a,n=e.ref,i=e.state,a=r.data.params;if(a.entry.params.view.name==="selection-box"){var o=Kt.create(_.clone(a.entry.params.view.params.bottomLeft),_.clone(a.entry.params.view.params.topRight)),s=a.entry.params.view.params.radius;Kt.expand(o,o,_.create(s,s,s));var u=E(E({},a),{entry:{name:a.entry.name,params:E(E({},a.entry.params),{view:{name:"box",params:{bottomLeft:o.min,topRight:o.max}}})}});return i.updateTree(i.build().to(n).update(u))}}),Qst={dataId:I.Text(""),source:I.MappedStatic("x-ray",{em:I.Group({isoValue:Ct.createIsoValueParam(Ct.IsoValue.relative(1))}),"x-ray":I.Group({})})},Zst=kt.BuiltIn({name:"create-volume-streaming-info",display:{name:"Volume Streaming Info"},from:ge.Molecule.Structure,to:XR,params:function(e){return{serverUrl:I.Text("https://ds.litemol.org"),entries:I.ObjectList(Qst,function(t){var r=t.dataId;return r},{defaultValue:[{dataId:"",source:{name:"x-ray",params:{}}}]})}}})({apply:function(e,t){var r=e.a,n=e.params;return $e.create("",function(i){return ce(void 0,void 0,void 0,function(){var a,o,s,u,l,c,d,f;return de(this,function(h){switch(h.label){case 0:a=[],o=0,s=n.entries.length,h.label=1;case 1:return o<s?(u=n.entries[o],l=u.dataId,c=u.source.name==="em"?u.source.params.isoValue:Ct.IsoValue.relative(1),[4,i.update("Getting server header...")]):[3,5];case 2:return h.sent(),[4,t.fetch({url:wA(n.serverUrl,u.source.name+"/"+l.toLocaleLowerCase()),type:"json"}).runInContext(i)];case 3:d=h.sent(),a.push({dataId:l,kind:u.source.name,header:d,emDefaultContourLevel:c}),h.label=4;case 4:return++o,[3,1];case 5:return f={serverUrl:n.serverUrl,entries:a,structure:r.data},[2,new XR(f,{label:"Volume Server",description:""+a.map(function(v){return v.dataId}).join(", ")})]}})})})}}),fL=kt.BuiltIn({name:"create-volume-streaming-behavior",display:{name:"Volume Streaming Behavior"},from:XR,to:Ga,params:function(e){return Ga.createParams({data:e&&e.data})}})({canAutoUpdate:function(e){var t=e.oldParams,r=e.newParams;return t.entry.params.view===r.entry.params.view||r.entry.params.view.name==="selection-box"||r.entry.params.view.name==="off"},apply:function(e,t){var r=e.a,n=e.params;return $e.create("Volume streaming",function(i){return ce(void 0,void 0,void 0,function(){var a;return de(this,function(o){switch(o.label){case 0:return a=new Ga.Behavior(t,r.data),[4,a.update(n)];case 1:return o.sent(),[2,new Ga(a,{label:"Volume Streaming",description:a.getDescription()})]}})})})},update:function(e){var t=this;e.a;var r=e.b,n=e.oldParams,i=e.newParams;return $e.create("Update Volume Streaming",function(a){return ce(t,void 0,void 0,function(){var o,s;return de(this,function(u){switch(u.label){case 0:return n.entry.name!==i.entry.name&&"em"in i.entry.params.channels&&(o=r.data.infoMap.get(i.entry.name).emDefaultContourLevel,o&&(i.entry.params.channels.em.isoValue=o)),[4,r.data.update(i)];case 1:return s=u.sent()?ft.UpdateResult.Updated:ft.UpdateResult.Unchanged,r.description=r.data.getDescription(),[2,s]}})})})}}),_S=kt.BuiltIn({name:"create-volume-streaming-visual",display:{name:"Volume Streaming Visual"},from:Ga,to:ge.Volume.Representation3D,params:{channel:I.Select("em",Ga.ChannelTypeOptions,{isHidden:!0})}})({apply:function(e,t){var r=e.a,n=e.params,i=e.spine;return $e.create("Volume Representation",function(a){return ce(void 0,void 0,void 0,function(){var o,s,u,l,c,d,f,h,v;return de(this,function(p){switch(p.label){case 0:return o=r.data.channels[n.channel],o?(s=mG(r.data,n.channel),u=i3.BuiltIn.isosurface,l=s.type.params||{},c=u.factory(E({webgl:(h=t.canvas3d)===null||h===void 0?void 0:h.webgl},t.representation.volume.themes),u.getParams),c.setTheme(Si.create(t.representation.volume.themes,{volume:o.data},s)),d=(v=i.getAncestorOfType(ge.Molecule.Structure))===null||v===void 0?void 0:v.data,f=(d==null?void 0:d.models.length)===0?void 0:iv.get(d==null?void 0:d.models[0]),[4,c.createOrUpdate(l,o.data).runInContext(a)]):[2,Nn.Null];case 1:return p.sent(),f&&c.setState({transform:f}),[2,new ge.Volume.Representation3D({repr:c,sourceData:o.data},{label:Math.round(o.isoValue.relativeValue*100)/100+"  ["+n.channel+"]"})]}})})})},update:function(e,t){var r=e.a,n=e.b,i=e.newParams;return e.spine,$e.create("Volume Representation",function(a){return ce(void 0,void 0,void 0,function(){var o,s,u,l;return de(this,function(c){switch(c.label){case 0:return o=r.data.channels[i.channel],o?(s=n.data.repr.state.visible,u=mG(r.data,i.channel),l=E(E({},n.data.repr.props),u.type.params),n.data.repr.setTheme(Si.create(t.representation.volume.themes,{volume:o.data},u)),[4,n.data.repr.createOrUpdate(l,o.data).runInContext(a)]):[2,ft.UpdateResult.Unchanged];case 1:return c.sent(),n.data.repr.setState({visible:s}),n.data.sourceData=o.data,[2,ft.UpdateResult.Updated]}})})})}});function mG(e,t){var r=e.channels[t];return Zc.getDefaultParamsStatic(e.plugin,"isosurface",{isoValue:r.isoValue,alpha:r.opacity,visuals:r.wireframe?["wireframe"]:["solid"]},"uniform",{value:r.color})}var hL=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r._getInfo=Rh(function(n,i){return Hv.infoFromAction(r.plugin,r.props.state,r.props.action,r.props.nodeRef)}),r.state={plugin:r.plugin,ref:r.props.nodeRef,version:r.props.state.transforms.get(r.props.nodeRef).version,error:void 0,isInitial:!0,params:r.getInfo().initialValues,busy:!1,isCollapsed:r.props.initiallyCollapsed},r}return t.prototype.applyAction=function(){return _t.State.ApplyAction(this.plugin,{state:this.props.state,action:this.props.action.create(this.state.params),ref:this.props.nodeRef})},t.prototype.getInfo=function(){return this._getInfo(this.props.nodeRef,this.props.state.transforms.get(this.props.nodeRef).version)},t.prototype.getTransformerId=function(){return this.props.state.transforms.get(this.props.nodeRef).transformer.id},t.prototype.getHeader=function(){return this.props.hideHeader?"none":this.props.action.definition.display},t.prototype.canApply=function(){return!this.state.error&&!this.state.busy},t.prototype.canAutoApply=function(){return!1},t.prototype.applyText=function(){return"Apply"},t.prototype.isUpdate=function(){return!1},t.prototype.getSourceAndTarget=function(){return{a:this.props.state.cells.get(this.props.nodeRef).obj}},t.getDerivedStateFromProps=function(r,n){var i=r.state.transforms.get(r.nodeRef).version;if(r.nodeRef===n.ref&&i===n.version)return null;var a=r.state.cells.get(r.nodeRef).obj,o=r.action.definition.params?I.getDefaultValues(r.action.definition.params(a,n.plugin)):{},s={plugin:n.plugin,ref:r.nodeRef,version:i,params:o,isInitial:!0,error:void 0};return s},t}(Uie),Jst=function(e){Le(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.defaultState=function(){return{header:"Volume Streaming",isCollapsed:!1,isBusy:!1,isHidden:!0,brand:{accent:"cyan",svg:DZ}}},t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.managers.structure.hierarchy.behaviors.selection,function(){r.setState({isHidden:!r.canEnable(),description:i2.getSelectedStructuresDescription(r.plugin)})}),this.subscribe(this.plugin.state.events.cell.stateUpdated,function(n){fr.hasTag(n.cell.transform,Ga.RootTag)&&r.forceUpdate()}),this.subscribe(this.plugin.behaviors.state.isBusy,function(n){r.setState({isBusy:n})})},Object.defineProperty(t.prototype,"pivot",{get:function(){return this.plugin.managers.structure.hierarchy.selection.structures[0]},enumerable:!1,configurable:!0}),t.prototype.canEnable=function(){var r,n,i=this.plugin.managers.structure.hierarchy.selection;if(i.structures.length!==1)return!1;var a=this.pivot.cell;return a.obj?!!(!((n=(r=KR.definition).isApplicable)===null||n===void 0)&&n.call(r,a.obj,a.transform,this.plugin)):!1},t.prototype.renderEnable=function(){var r,n=this.pivot;if(!n.cell.parent)return null;var i=or.findTagInSubtree(n.cell.parent.tree,this.pivot.cell.transform.ref,Ga.RootTag),a=i&&n.cell.parent.cells.get(i),o=a&&a.status==="error"?{header:"Error enabling",icon:fU,title:a.errorText}:a&&((r=a.obj)===null||r===void 0?void 0:r.data.entries.length)===0?{header:"Error enabling",icon:fU,title:"No entry for streaming found"}:{header:"Enable",icon:B0,title:"Enable"};return P.jsx(hL,{state:n.cell.parent,action:KR,initiallyCollapsed:!0,nodeRef:n.cell.transform.ref,simpleApply:o},void 0)},t.prototype.renderParams=function(){var r,n,i,a,o,s=this.pivot;if(!s.cell.parent)return null;var u=((n=(r=s.volumeStreaming)===null||r===void 0?void 0:r.cell.transform.params)===null||n===void 0?void 0:n.entry.params.view.name)==="selection-box"&&((o=(a=(i=this.plugin.state.behaviors.cells.get(AA.id))===null||i===void 0?void 0:i.params)===null||a===void 0?void 0:a.values)===null||o===void 0?void 0:o.bindings);return P.jsxs(P.Fragment,{children:[P.jsx(wd,{state:s.cell.parent,transform:s.volumeStreaming.cell.transform,customHeader:"none",noMargin:!0},void 0),u&&P.jsx(qu,E({header:"Controls Help"},{children:P.jsx(WR,{bindings:u},void 0)}),void 0)]},void 0)},t.prototype.renderControls=function(){var r=this.pivot;return r?r.volumeStreaming?this.renderParams():this.renderEnable():null},t}(U0),eut=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.item=function(n){var i,a=r.plugin.managers.volume.hierarchy.selection,o=((i=n.cell.obj)===null||i===void 0?void 0:i.label)||"Volume",s={kind:"item",label:(n.kind==="lazy-volume"?"Load ":"")+(o||n.kind),selected:a===n,value:n};return s},r.selectCurrent=function(n){if(r.toggleHierarchy(),!!n){var i=n.value;i.kind==="volume"?r.plugin.managers.volume.hierarchy.setCurrent(i):r.lazyLoad(i.cell)}},r.selectAdd=function(n){n&&(r.setState({show:void 0}),n.value())},r.toggleHierarchy=function(){return r.setState({show:r.state.show!=="hierarchy"?"hierarchy":void 0})},r.toggleAddRepr=function(){return r.setState({show:r.state.show!=="add-repr"?"add-repr":void 0})},r}return t.prototype.defaultState=function(){return{header:"Volume",isCollapsed:!1,isBusy:!1,isHidden:!0,brand:{accent:"purple",svg:DZ}}},t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.managers.volume.hierarchy.behaviors.selection,function(n){r.setState({isHidden:n.hierarchy.volumes.length===0&&n.hierarchy.lazyVolumes.length===0})}),this.subscribe(this.plugin.behaviors.state.isBusy,function(n){r.setState({isBusy:n})})},Object.defineProperty(t.prototype,"hierarchyItems",{get:function(){for(var r=this.plugin.managers.volume.hierarchy,n=r.current,i=[],a=0,o=n.volumes;a<o.length;a++){var s=o[a];i.push(this.item(s))}for(var u=0,l=n.lazyVolumes;u<l.length;u++){var s=l[u];i.push(this.item(s))}return i},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"addActions",{get:function(){var r=this.plugin.managers.volume.hierarchy,n=r.selection,i=Nt([],Jw.getRepresentationTypes(this.plugin,n).map(function(a){return rr.Item(a[1],function(){return r.addRepresentation(n,a[0])})}));return i},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isEmpty",{get:function(){var r=this.plugin.managers.volume.hierarchy.current,n=r.volumes,i=r.lazyVolumes;return n.length===0&&i.length===0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"label",{get:function(){var r;if(this.state.loadingLabel)return"Loading "+this.state.loadingLabel+"...";var n=this.plugin.managers.volume.hierarchy.selection;return n?((r=n==null?void 0:n.cell.obj)===null||r===void 0?void 0:r.label)||"Volume":"Nothing Selected"},enumerable:!1,configurable:!0}),t.prototype.lazyLoad=function(r){return ce(this,void 0,void 0,function(){var n,i,a,o,s,u,l,c=this;return de(this,function(d){switch(d.label){case 0:n=r.obj.data,i=n.url,a=n.isBinary,o=n.format,s=n.entryId,u=n.isovalues,this.setState({isBusy:!0,loadingLabel:r.obj.label}),d.label=1;case 1:return d.trys.push([1,,3,4]),l=this.plugin,[4,l.dataTransaction(function(){return ce(c,void 0,void 0,function(){var f,h,v,p,m,g,y,b,S,x,C;return de(this,function(w){switch(w.label){case 0:return[4,l.builders.data.download({url:i,isBinary:a},{state:{isGhost:!0}})];case 1:return f=w.sent(),[4,l.dataFormats.get(o).parse(l,f,{entryId:s})];case 2:if(h=w.sent(),v=h.volume||h.volumes[0],!(v!=null&&v.isOk))throw new Error("Failed to parse any volume.");for(p=l.build(),m=0,g=u;m<g.length;m++)y=g[m],p.to((x=(b=h.volumes)===null||b===void 0?void 0:b[(S=y.volumeIndex)!==null&&S!==void 0?S:0])!==null&&x!==void 0?x:h.volume).apply(rt.Representation.VolumeRepresentation3D,Hg(this.plugin,v.data,{type:"isosurface",typeParams:{alpha:(C=y.alpha)!==null&&C!==void 0?C:1,isoValue:y.type==="absolute"?{kind:"absolute",absoluteValue:y.value}:{kind:"relative",relativeValue:y.value}},color:"uniform",colorParams:{value:y.color}}));return[4,p.commit()];case 3:return w.sent(),[4,l.build().delete(r).commit()];case 4:return w.sent(),[2]}})})})];case 2:return d.sent(),[3,4];case 3:return this.setState({isBusy:!1,loadingLabel:void 0}),[7];case 4:return[2]}})})},t.prototype.renderControls=function(){var r=this.state.isBusy||this.isEmpty,n=this.label,i=this.plugin.managers.volume.hierarchy.selection;return P.jsxs(P.Fragment,{children:[P.jsxs("div",E({className:"msp-flex-row",style:{marginTop:"1px"}},{children:[P.jsx(yr,E({noOverflow:!0,flex:!0,onClick:this.toggleHierarchy,disabled:r,title:n},{children:n}),void 0),!this.isEmpty&&i&&P.jsx(Gt,{svg:N0,onClick:this.toggleAddRepr,title:"Apply a structure presets to the current hierarchy.",toggleState:this.state.show==="add-repr",disabled:r},void 0)]}),void 0),this.state.show==="hierarchy"&&P.jsx(rr,{items:this.hierarchyItems,onSelect:this.selectCurrent},void 0),this.state.show==="add-repr"&&P.jsx(rr,{items:this.addActions,onSelect:this.selectAdd},void 0),i&&i.representations.length>0&&P.jsx("div",E({style:{marginTop:"6px"}},{children:i.representations.map(function(a){return P.jsx(tut,{representation:a},a.cell.transform.ref)})}),void 0)]},void 0)},t}(U0),tut=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={action:void 0},r.remove=function(){return r.plugin.managers.volume.hierarchy.remove([r.props.representation],!0)},r.toggleVisible=function(n){n.preventDefault(),n.currentTarget.blur(),r.plugin.managers.volume.hierarchy.toggleVisibility([r.props.representation])},r.toggleUpdate=function(){return r.setState({action:r.state.action==="update"?void 0:"update"})},r.highlight=function(n){n.preventDefault(),r.props.representation.cell.parent&&_t.Interactivity.Object.Highlight(r.plugin,{state:r.props.representation.cell.parent,ref:r.props.representation.cell.transform.ref})},r.clearHighlight=function(n){n.preventDefault(),_t.Interactivity.ClearHighlights(r.plugin)},r.focus=function(){var n,i=r.props.representation,a=(n=r.props.representation.cell.obj)===null||n===void 0?void 0:n.data.repr.renderObjects;i.cell.state.isHidden&&r.plugin.managers.volume.hierarchy.toggleVisibility([r.props.representation],"show"),r.plugin.managers.camera.focusRenderObjects(a,{extraRadius:1})},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.state.events.cell.stateUpdated,function(n){Th.ObjectEvent.isCell(n,r.props.representation.cell)&&r.forceUpdate()})},t.prototype.render=function(){var r,n,i,a=this.props.representation.cell;return P.jsxs(P.Fragment,{children:[P.jsxs("div",E({className:"msp-flex-row"},{children:[P.jsxs(yr,E({noOverflow:!0,className:"msp-control-button-label",title:((r=a.obj)===null||r===void 0?void 0:r.label)+". Click to focus.",onClick:this.focus,onMouseEnter:this.highlight,onMouseLeave:this.clearHighlight,style:{textAlign:"left"}},{children:[(n=a.obj)===null||n===void 0?void 0:n.label,P.jsx("small",E({className:"msp-25-lower-contrast-text",style:{float:"right"}},{children:(i=a.obj)===null||i===void 0?void 0:i.description}),void 0)]}),void 0),P.jsx(Gt,{svg:a.state.isHidden?Zv:Jv,toggleState:!1,onClick:this.toggleVisible,title:(a.state.isHidden?"Show":"Hide")+" component",small:!0,className:"msp-form-control",flex:!0},void 0),P.jsx(Gt,{svg:iu,onClick:this.remove,title:"Remove",small:!0},void 0),P.jsx(Gt,{svg:Av,onClick:this.toggleUpdate,title:"Actions",toggleState:this.state.action==="update"},void 0)]}),void 0),this.state.action==="update"&&!!a.parent&&P.jsx("div",E({style:{marginBottom:"6px"},className:"msp-accent-offset"},{children:P.jsx(wd,{state:a.parent,transform:a.transform,customHeader:"none",noMargin:!0},void 0)}),void 0)]},void 0)},t}(ea),a3;(function(e){function t(n){return{size:n,matrix:Rr.create(n,n),eigenValues:new Float64Array(n),D:new Float64Array(n),E:new Float64Array(n)}}e.createCache=t;function r(n){rut(n.size,n.matrix.data,n.eigenValues,n.D,n.E)}e.compute=r})(a3||(a3={}));function rut(e,t,r,n,i){for(var a=0;a<e;a++)i[a]=0;for(var o=e-1,a=0;a<e;a++)n[a]=t[a*e+o];nut(t,n,i,e),iut(t,n,i,e);for(var a=0;a<e;a++)r[a]=n[a]}function nut(e,t,r,n){for(var i=n-1;i>0;i--){for(var a=0,o=0,s=0;s<i;s++)a=a+Math.abs(t[s]);if(a===0){r[i]=t[i-1];for(var u=0;u<i;u++)t[u]=e[u*n+i-1],e[u*n+i]=0,e[i*n+u]=0}else{for(var s=0;s<i;s++)t[s]/=a,o+=t[s]*t[s];var l=t[i-1],c=Math.sqrt(o);l>0&&(c=-c),r[i]=a*c,o=o-l*c,t[i-1]=l-c;for(var u=0;u<i;u++)r[u]=0;for(var u=0;u<i;u++){l=t[u],e[i*n+u]=l,c=r[u]+e[u*n+u]*l;for(var s=u+1;s<=i-1;s++)c+=e[u*n+s]*t[s],r[s]+=e[u*n+s]*l;r[u]=c}l=0;for(var u=0;u<i;u++)r[u]/=o,l+=r[u]*t[u];for(var d=l/(o+o),u=0;u<i;u++)r[u]-=d*t[u];for(var u=0;u<i;u++){l=t[u],c=r[u];for(var s=u;s<=i-1;s++)e[u*n+s]-=l*r[s]+c*t[s];t[u]=e[u*n+i-1],e[u*n+i]=0}}t[i]=o}for(var i=0;i<n-1;i++){e[i*n+n-1]=e[i*n+i],e[i*n+i]=1;var o=t[i+1];if(o!==0){for(var s=0;s<=i;s++)t[s]=e[(i+1)*n+s]/o;for(var u=0;u<=i;u++){for(var c=0,s=0;s<=i;s++)c+=e[(i+1)*n+s]*e[u*n+s];for(var s=0;s<=i;s++)e[u*n+s]-=c*t[s]}}for(var s=0;s<=i;s++)e[(i+1)*n+s]=0}for(var u=0;u<n;u++)t[u]=e[u*n+n-1],e[u*n+n-1]=0;e[n*n-1]=1,r[0]=0}function iut(e,t,r,n){for(var i=1e3,a=1;a<n;a++)r[a-1]=r[a];r[n-1]=0;for(var o=0,s=0,u=Math.pow(2,-53),l=0;l<n;l++){s=Math.max(s,Math.abs(t[l])+Math.abs(r[l]));for(var c=l;c<n&&!(Math.abs(r[c])<=u*s);)c++;if(c>l){var d=0;do{d=d+1;var f=t[l],h=(t[l+1]-f)/(2*r[l]),v=gG(h,1);h<0&&(v=-v),t[l]=r[l]/(h+v),t[l+1]=r[l]*(h+v);for(var p=t[l+1],m=f-t[l],a=l+2;a<n;a++)t[a]-=m;o=o+m,h=t[c];for(var g=1,y=g,b=g,S=r[l+1],x=0,C=0,a=c-1;a>=l;a--){b=y,y=g,C=x,f=g*r[a],m=g*h,v=gG(h,r[a]),r[a+1]=x*v,x=r[a]/v,g=h/v,h=g*t[a]-x*f,t[a+1]=m+x*(g*f+x*t[a]);for(var w=0;w<n;w++)m=e[(a+1)*n+w],e[(a+1)*n+w]=x*e[a*n+w]+g*m,e[a*n+w]=g*e[a*n+w]-x*m}if(h=-x*C*b*S*r[l]/p,r[l]=x*h,t[l]=g*h,d>=i)throw"SVD: Not converging."}while(Math.abs(r[l])>u*s)}t[l]=t[l]+o,r[l]=0}for(var a=0;a<n-1;a++){for(var w=a,h=t[a],A=a+1;A<n;A++)t[A]<h&&(w=A,h=t[A]);if(w!==a){t[w]=t[a],t[a]=h;for(var A=0;A<n;A++)h=e[a*n+A],e[a*n+A]=e[w*n+A],e[w*n+A]=h}}}function gG(e,t){if(Math.abs(e)>Math.abs(t)){var r=t/e;return Math.abs(e)*Math.sqrt(1+r*r)}if(t!==0){var r=e/t;return Math.abs(t)*Math.sqrt(1+r*r)}return 0}var Ed;(function(e){(function(r){function n(i){return{x:new Float64Array(i),y:new Float64Array(i),z:new Float64Array(i)}}r.empty=n})(e.Positions||(e.Positions={}));function t(r,n){return typeof n>"u"&&(n={bTransform:ue.zero(),rmsd:0}),uut(new aut(r,n)),n}e.compute=t})(Ed||(Ed={}));var aut=function(){function e(t,r){this.evdCache=a3.createCache(4),this.translateB=ue.identity(),this.rotateB=ue.identity(),this.tempMatrix=ue.identity(),this.a=t.a,this.b=t.b,t.centerA?this.centerA=t.centerA:this.centerA=t.centerA=md.fromArrays(t.a,Be()).center,t.centerB?this.centerB=t.centerB:this.centerB=t.centerB=md.fromArrays(t.b,Be()).center,this.result=r}return e}();function out(e){var t=e.evdCache.matrix;Rr.makeZero(t);for(var r=e.a.x,n=e.a.y,i=e.a.z,a=e.b.x,o=e.b.y,s=e.b.z,u=e.centerA,l=e.centerB,c=0,d=0,f=e.a.x.length;d<f;d++){var h=r[d]-u[0],v=n[d]-u[1],p=i[d]-u[2],m=a[d]-l[0],g=o[d]-l[1],y=s[d]-l[2];c+=h*h+v*v+p*p+m*m+g*g+y*y,Rr.add(t,0,0,h*m+v*g+p*y),Rr.add(t,0,1,-(p*g)+v*y),Rr.add(t,0,2,p*m-h*y),Rr.add(t,0,3,-(v*m)+h*g),Rr.add(t,1,0,-(p*g)+v*y),Rr.add(t,1,1,h*m-v*g-p*y),Rr.add(t,1,2,v*m+h*g),Rr.add(t,1,3,p*m+h*y),Rr.add(t,2,0,p*m-h*y),Rr.add(t,2,1,v*m+h*g),Rr.add(t,2,2,-(h*m)+v*g-p*y),Rr.add(t,2,3,p*g+v*y),Rr.add(t,3,0,-(v*m)+h*g),Rr.add(t,3,1,p*m+h*y),Rr.add(t,3,2,p*g+v*y),Rr.add(t,3,3,-(h*m)-v*g+p*y)}return c}function sut(e){var t=e.evdCache.matrix,r=Rr.get(t,1,3),n=Rr.get(t,2,3),i=Rr.get(t,3,3),a=Rr.get(t,0,3),o=2*n*n,s=2*i*i,u=2*r*r,l=2*r*n,c=2*a*i,d=2*r*i,f=2*a*n,h=2*n*i,v=2*a*r,p=e.translateB;ue.setValue(p,0,3,-e.centerB[0]),ue.setValue(p,1,3,-e.centerB[1]),ue.setValue(p,2,3,-e.centerB[2]),p=e.rotateB,ue.setValue(p,0,0,1-o-s),ue.setValue(p,0,1,l+c),ue.setValue(p,0,2,d-f),ue.setValue(p,1,0,l-c),ue.setValue(p,1,1,1-u-s),ue.setValue(p,1,2,h+v),ue.setValue(p,2,0,d+f),ue.setValue(p,2,1,h-v),ue.setValue(p,2,2,1-u-o),ue.setValue(p,3,3,1),ue.mul(e.tempMatrix,e.rotateB,e.translateB),p=e.translateB,ue.setValue(p,0,3,e.centerA[0]),ue.setValue(p,1,3,e.centerA[1]),ue.setValue(p,2,3,e.centerA[2]),ue.mul(e.result.bTransform,e.translateB,e.tempMatrix)}function uut(e){var t=out(e);a3.compute(e.evdCache);var r=t-2*e.evdCache.eigenValues[3];r=r<0?0:Math.sqrt(r/e.a.x.length),sut(e),e.result.rmsd=r}var lut="ACDEFGHIKLMNPQRSTVWY",cut="ARNDCQEGHILKMFPSTWYVBZX",dut=[[4,0,-2,-1,-2,0,-2,-1,-1,-1,-1,-2,-1,-1,-1,1,0,0,-3,-2],[0,9,-3,-4,-2,-3,-3,-1,-3,-1,-1,-3,-3,-3,-3,-1,-1,-1,-2,-2],[-2,-3,6,2,-3,-1,-1,-3,-1,-4,-3,1,-1,0,-2,0,-1,-3,-4,-3],[-1,-4,2,5,-3,-2,0,-3,1,-3,-2,0,-1,2,0,0,-1,-2,-3,-2],[-2,-2,-3,-3,6,-3,-1,0,-3,0,0,-3,-4,-3,-3,-2,-2,-1,1,3],[0,-3,-1,-2,-3,6,-2,-4,-2,-4,-3,0,-2,-2,-2,0,-2,-3,-2,-3],[-2,-3,-1,0,-1,-2,8,-3,-1,-3,-2,1,-2,0,0,-1,-2,-3,-2,2],[-1,-1,-3,-3,0,-4,-3,4,-3,2,1,-3,-3,-3,-3,-2,-1,3,-3,-1],[-1,-3,-1,1,-3,-2,-1,-3,5,-2,-1,0,-1,1,2,0,-1,-2,-3,-2],[-1,-1,-4,-3,0,-4,-3,2,-2,4,2,-3,-3,-2,-2,-2,-1,1,-2,-1],[-1,-1,-3,-2,0,-3,-2,1,-1,2,5,-2,-2,0,-1,-1,-1,1,-1,-1],[-2,-3,1,0,-3,0,1,-3,0,-3,-2,6,-2,0,0,1,0,-3,-4,-2],[-1,-3,-1,-1,-4,-2,-2,-3,-1,-3,-2,-2,7,-1,-2,-1,-1,-2,-4,-3],[-1,-3,0,2,-3,-2,0,-3,1,-2,0,0,-1,5,1,0,-1,-2,-2,-1],[-1,-3,-2,0,-3,-2,0,-3,2,-2,-1,0,-2,1,5,-1,-1,-3,-3,-2],[1,-1,0,0,-2,0,-1,-2,0,-2,-1,1,-1,0,-1,4,1,-2,-3,-2],[0,-1,-1,-1,-2,-2,-2,-1,-1,-1,-1,0,-1,-1,-1,1,5,0,-2,-2],[0,-1,-3,-2,-1,-3,-3,3,-2,1,1,-3,-2,-2,-3,-2,0,4,-3,-1],[-3,-2,-4,-3,1,-2,-2,-3,-3,-2,-1,-4,-4,-2,-3,-3,-2,-3,11,2],[-2,-2,-3,-2,3,-3,2,-1,-2,-1,-1,-2,-3,-1,-2,-2,-2,-1,2,7]],fut=[[4,-1,-2,-2,0,-1,-1,0,-2,-1,-1,-1,-1,-2,-1,1,0,-3,-2,0,-2,-1,0],[-1,5,0,-2,-3,1,0,-2,0,-3,-2,2,-1,-3,-2,-1,-1,-3,-2,-3,-1,0,-1],[-2,0,6,1,-3,0,0,0,1,-3,-3,0,-2,-3,-2,1,0,-4,-2,-3,3,0,-1],[-2,-2,1,6,-3,0,2,-1,-1,-3,-4,-1,-3,-3,-1,0,-1,-4,-3,-3,4,1,-1],[0,-3,-3,-3,9,-3,-4,-3,-3,-1,-1,-3,-1,-2,-3,-1,-1,-2,-2,-1,-3,-3,-2],[-1,1,0,0,-3,5,2,-2,0,-3,-2,1,0,-3,-1,0,-1,-2,-1,-2,0,3,-1],[-1,0,0,2,-4,2,5,-2,0,-3,-3,1,-2,-3,-1,0,-1,-3,-2,-2,1,4,-1],[0,-2,0,-1,-3,-2,-2,6,-2,-4,-4,-2,-3,-3,-2,0,-2,-2,-3,-3,-1,-2,-1],[-2,0,1,-1,-3,0,0,-2,8,-3,-3,-1,-2,-1,-2,-1,-2,-2,2,-3,0,0,-1],[-1,-3,-3,-3,-1,-3,-3,-4,-3,4,2,-3,1,0,-3,-2,-1,-3,-1,3,-3,-3,-1],[-1,-2,-3,-4,-1,-2,-3,-4,-3,2,4,-2,2,0,-3,-2,-1,-2,-1,1,-4,-3,-1],[-1,2,0,-1,-3,1,1,-2,-1,-3,-2,5,-1,-3,-1,0,-1,-3,-2,-2,0,1,-1],[-1,-1,-2,-3,-1,0,-2,-3,-2,1,2,-1,5,0,-2,-1,-1,-1,-1,1,-3,-1,-1],[-2,-3,-3,-3,-2,-3,-3,-3,-1,0,0,-3,0,6,-4,-2,-2,1,3,-1,-3,-3,-1],[-1,-2,-2,-1,-3,-1,-1,-2,-2,-3,-3,-1,-2,-4,7,-1,-1,-4,-3,-2,-2,-1,-2],[1,-1,1,0,-1,0,0,0,-1,-2,-2,0,-1,-2,-1,4,1,-3,-2,-2,0,0,0],[0,-1,0,-1,-1,-1,-1,-2,-2,-1,-1,-1,-1,-2,-1,1,5,-2,-2,0,-1,-1,0],[-3,-3,-4,-4,-2,-2,-3,-2,-2,-3,-2,-3,-1,1,-4,-3,-2,11,2,-3,-4,-3,-2],[-2,-2,-2,-3,-2,-1,-2,-3,2,-1,-1,-2,-1,3,-3,-2,-2,2,7,-1,-3,-2,-1],[0,-3,-3,-3,-1,-2,-2,-3,-3,3,1,-2,1,-1,-2,-2,0,-3,-1,4,-3,-2,-1],[-2,-1,3,4,-3,0,1,-1,0,-3,-4,0,-3,-3,-2,0,-1,-4,-3,-3,4,1,-1],[-1,0,0,1,-3,3,4,-2,0,-3,-3,1,-1,-3,-1,0,-1,-3,-2,-2,1,4,-1],[0,-1,-1,-1,-2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-2,0,0,-2,-1,-1,-1,-1,-1]];function yG(e,t){var r,n=0,i={};return t.forEach(function(a){r=0;var o={};a.forEach(function(s){return o[e[r++]]=s}),i[e[n++]]=o}),i}var hut=function(){return{blosum62:yG(cut,fut),blosum62x:yG(lut,dut)}}(),put={gapPenalty:-11,gapExtensionPenalty:-1,substMatrix:"default"};function vut(e,t,r){r===void 0&&(r={});var n=E(E({},put),r),i=new mut(e,t,n);return i.calculate(),i.trace()}var mut=function(){function e(t,r,n){this.seqA=t,this.seqB=r,this.S=[],this.V=[],this.H=[],this.gapPenalty=n.gapPenalty,this.gapExtensionPenalty=n.gapExtensionPenalty,this.substMatrix=n.substMatrix==="default"?void 0:hut[n.substMatrix],this.n=this.seqA.length,this.m=this.seqB.length}return e.prototype.initMatrices=function(){for(var t=this,r=t.n,n=t.m,i=t.gapPenalty,a=t.S,o=t.V,s=t.H,u=0;u<=r;++u){a[u]=[],o[u]=[],s[u]=[];for(var l=0;l<=n;++l)a[u][l]=0,o[u][l]=0,s[u][l]=0}for(var u=0;u<=r;++u)a[u][0]=i,s[u][0]=-1/0;for(var l=0;l<=n;++l)a[0][l]=i,o[0][l]=-1/0;a[0][0]=0},e.prototype.makeScoreFn=function(){var t=this,r=t.seqA,n=t.seqB,i=t.substMatrix;return i?function(o,s){var u,l,c=r[o],d=n[s];return(l=(u=i[c])===null||u===void 0?void 0:u[d])!==null&&l!==void 0?l:-4}:function(o,s){var u=r[o],l=n[s];return u===l?5:-3}},e.prototype.calculate=function(){this.initMatrices();for(var t=this.makeScoreFn(),r=this,n=r.V,i=r.H,a=r.S,o=r.n,s=r.m,u=r.gapExtensionPenalty,l=r.gapPenalty,c,d,f,h,v,p=1;p<=o;++p){d=a[p-1],c=n[p-1],f=n[p],h=i[p],v=a[p];for(var m=1;m<=s;++m)f[m]=Math.max(d[m]+l,c[m]+u),h[m]=Math.max(v[m-1]+l,h[m-1]+u),v[m]=Math.max(d[m-1]+t(p-1,m-1),f[m],h[m])}},e.prototype.trace=function(){var t=this.makeScoreFn(),r=this,n=r.V,i=r.H,a=r.S,o=r.seqA,s=r.seqB,u=r.gapExtensionPenalty,l=r.gapPenalty,c=this.n,d=this.m,f,h,v="",p="";for(a[c][d]>=n[c][d]?(f="S",h=a[c][d]):n[c][d]>=i[c][d]?(f="V",h=n[c][d]):(f="H",h=i[c][d]);c>0&&d>0;)f==="S"?a[c][d]===a[c-1][d-1]+t(c-1,d-1)?(v=o[c-1]+v,p=s[d-1]+p,--c,--d,f="S"):a[c][d]===n[c][d]?f="V":a[c][d]===i[c][d]?f="H":(--c,--d):f==="V"?n[c][d]===n[c-1][d]+u?(v=o[c-1]+v,p="-"+p,--c,f="V"):n[c][d]===a[c-1][d]+l?(v=o[c-1]+v,p="-"+p,--c,f="S"):--c:f==="H"&&(i[c][d]===i[c][d-1]+u?(v="-"+v,p=s[d-1]+p,--d,f="H"):i[c][d]===a[c][d-1]+l?(v="-"+v,p=s[d-1]+p,--d,f="S"):--d);for(;c>0;)v=o[c-1]+v,p="-"+p,--c;for(;d>0;)v="-"+v,p=s[d-1]+p,--d;return{aliA:v,aliB:p,score:h}},e}(),QR;(function(e){function t(n){var i=new Map;if(je.isAtomic(n.unit))for(var a=n.unit.model.atomicHierarchy.residues.label_seq_id,o=n.unit.residueIndex,s=0,u=Fe.size(n.indices);s<u;++s){var l=Fe.getAt(n.indices,s),c=n.unit.elements[l],d=a.value(o[c]);i.has(d)?i.get(d).push(l):i.set(d,[l])}else if(je.isCoarse(n.unit))for(var f=(je.isSpheres(n.unit)?n.unit.model.coarseHierarchy.spheres:n.unit.model.coarseHierarchy.gaussians).seq_id_begin,s=0,u=Fe.size(n.indices);s<u;++s){var l=Fe.getAt(n.indices,s),c=n.unit.elements[l],d=f.value(c);i.set(d,[l])}return i}function r(n,i){i===void 0&&(i={});for(var a=bG(n.a.unit),o=bG(n.b.unit),s=t(n.a),u=t(n.b),l=[],c=[],d=vut(a.code.toArray(),o.code.toArray(),i),f=d.aliA,h=d.aliB,v=d.score,p=0,m=0,g=0,y=f.length;g<y;++g){if(f[g]==="-"||h[g]==="-"){f[g]!=="-"&&(p+=1),h[g]!=="-"&&(m+=1);continue}var b=a.seqId.value(p),S=o.seqId.value(m);if(s.has(b)&&u.has(S))for(var x=s.get(b),C=u.get(S),w=0,A=Math.min(x.length,C.length);w<A;++w)l.push(x[w]),c.push(C[w]);p+=1,m+=1}var M=Fe.intersect(Fe.ofSortedArray(l),n.a.indices),D=Fe.intersect(Fe.ofSortedArray(c),n.b.indices);return{a:{unit:n.a.unit,indices:M},b:{unit:n.b.unit,indices:D},score:v}}e.compute=r})(QR||(QR={}));function gut(e){switch(e.kind){case 0:return e.model.atomicHierarchy.index.getEntityFromChain(e.chainIndex[e.elements[0]]);case 1:return e.model.coarseHierarchy.spheres.entityKey[e.elements[0]];case 2:return e.model.coarseHierarchy.gaussians.entityKey[e.elements[0]]}}function bG(e){return e.model.sequence.byEntityKey[gut(e)].sequence}function xG(e){var t=[];if(e.length<=0)return t;var r=xut(e),n={a:K1(e[0],r),b:K1(e[1],r)};t[0]=Ed.compute(n);for(var i=2;i<e.length;i++)n.b=K1(e[i],r),n.centerB=void 0,t.push(Ed.compute(n));return t}var yut=/(polypeptide|cyclic-pseudo-peptide)/i;function but(e){var t=[];if(e.length<=0)return t;for(var r=Re.getFirstLocation(e[0]),n=lt.entity.subtype(r),i=n.match(yut)?"blosum62":"default",a=1;a<e.length;a++){var o=QR.compute({a:e[0].elements[0],b:e[a].elements[0]},{substMatrix:i}),s=o.a,u=o.b,l=o.score,c=Re(e[0].structure,[s]),d=Re(e[a].structure,[u]),f=Fe.size(s.indices);t.push(E(E({},Ed.compute({a:K1(c,f),b:K1(d,f)})),{alignmentScore:l}))}return t}function K1(e,t){for(var r=Ed.Positions.empty(t),n=0,i=0,a=e.elements;i<a.length;i++){for(var o=a[i],s=o.unit,u=o.indices,l=s.elements,c=s.conformation,d=c.x,f=c.y,h=c.z,v=0,p=Fe.size(u);v<p;v++){var m=l[Fe.getAt(u,v)];if(r.x[n]=d(m),r.y[n]=f(m),r.z[n]=h(m),n++,n>=t)break}if(n>=t)break}return r}function xut(e){if(e.length===0)return 0;for(var t=Re.size(e[0]),r=1;r<e.length;r++){var n=Re.size(e[r]);n<t&&(t=n)}return t}function Sut(e){for(var t=new Map,r=0;r<e.length;r++)wut(e[r],t,r);for(var n=Array.from(t.values()),i=_ut(e.length,n),a=[],o=0,s=i;o<s.length;o++){var u=s[o],l=Cut(n,u.i,u.j,u.count),c=l[0],d=l[1],f=Ed.compute({a:c,b:d});a.push({transform:f,pivot:u.i,other:u.j})}return a}function Cut(e,t,r,n){for(var i=Ed.Positions.empty(n),a=Ed.Positions.empty(n),o=0,s=0,u=e;s<u.length;s++){var l=u[s].pivots,c=l[t],d=l[r];if(!(!c||!d))for(var f=Math.min(c[2]-c[1],d[2]-d[1]),h=0;h<f;h++){var v=c[1]+h;i.x[o]=c[0].conformation.x(v),i.y[o]=c[0].conformation.y(v),i.z[o]=c[0].conformation.z(v),v=d[1]+h,a.x[o]=d[0].conformation.x(v),a.y[o]=d[0].conformation.y(v),a.z[o]=d[0].conformation.z(v),o++}}return[i,a]}function _ut(e,t){for(var r=[],n=0;n<e;n++){r[n]=[];for(var i=0;i<e;i++)r[n][i]=0}for(var a=0,o=t;a<o.length;a++)for(var s=o[a].pivots,n=0;n<e;n++)if(s[n]){for(var u=s[n][2]-s[n][1],i=n+1;i<e;i++)if(s[i]){var l=s[i][2]-s[i][1];r[n][i]=r[n][i]+Math.min(u,l)}}for(var c=[],i=1;i<e;i++)c[i-1]={i:0,j:i,count:r[0][i]};return c}function wut(e,t,r){for(var n,i=0,a=e.units;i<a.length;i++){var o=a[i];if(o.kind===0){var s=o.elements,u=o.model,l=u.atomicHierarchy.residueAtomSegments.offsets,c=ju.Provider.get(u).value;if(!c)return;for(var d=c.dbName,f=c.accession,h=c.num,v=ar.transientSegments(o.model.atomicHierarchy.chainAtomSegments,s),p=ar.transientSegments(o.model.atomicHierarchy.residueAtomSegments,s);v.hasNext;){var m=v.move();for(p.setSegment(m);p.hasNext;){var g=p.move(),y=s[g.start],b=l[y];if(d[b]){var S=d[b]+"-"+f[b]+"-"+h[b];if(!t.has(S))t.set(S,{key:S,pivots:(n={},n[r]=[o,y,s[g.end]],n)});else{var x=t.get(S);x.pivots[r]||(x.pivots[r]=[o,y,s[g.end]])}}}}}}}var Eut=function(e){Le(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.defaultState=function(){return{isCollapsed:!1,header:"Superposition",brand:{accent:"gray",svg:FRe},isHidden:!0}},t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.managers.structure.hierarchy.behaviors.selection,function(n){r.setState({isHidden:n.structures.length<2})})},t.prototype.renderControls=function(){return P.jsx(P.Fragment,{children:P.jsx(Put,{},void 0)},void 0)},t}(U0),uae={alignSequences:I.Boolean(!0,{isEssential:!0,description:"Perform a sequence alignment and use the aligned residue pairs to guide the 3D superposition."})},Aut=I.getDefaultValues(uae),SG="SuperpositionTransform",Put=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isBusy:!1,canUseDb:!1,action:void 0,options:Aut},r.superposeChains=function(){return ce(r,void 0,void 0,function(){var n,i,a,o,s,u,l,c,d,f,h,v,p,m=this;return de(this,function(g){switch(g.label){case 0:n=bi.trace.query,i=this.chainEntries,a=i.map(function(y,b){var S=Re.toStructure(y.loci),x=mt.toLociWithSourceUnits(n(new ps(S)));return Re.remap(x,b===0?m.plugin.helpers.substructureParent.get(y.loci.structure.root).obj.data:x.structure.root)}),o=this.state.options.alignSequences?but(a):xG(a),s=i[0],u=1,l=a.length,g.label=1;case 1:return u<l?(c=i[u],d=o[u-1],f=d.bTransform,h=d.rmsd,[4,this.transform(c.cell,f)]):[3,4];case 2:g.sent(),v=Wf(s.label),p=Wf(c.label),this.plugin.log.info("Superposed ["+v+"] and ["+p+"] with RMSD "+h.toFixed(2)+"."),g.label=3;case 3:return++u,[3,1];case 4:return[2]}})})},r.superposeAtoms=function(){return ce(r,void 0,void 0,function(){var n,i,a,o,s,u,l,c,d,f,h,v,p,m=this;return de(this,function(g){switch(g.label){case 0:n=this.atomEntries,i=n.map(function(y,b){return Re.remap(y.loci,b===0?m.plugin.helpers.substructureParent.get(y.loci.structure.root).obj.data:y.loci.structure.root)}),a=xG(i),o=n[0],s=1,u=i.length,g.label=1;case 1:return s<u?(l=n[s],c=a[s-1],d=c.bTransform,f=c.rmsd,[4,this.transform(l.cell,d)]):[3,4];case 2:g.sent(),h=Wf(o.label),v=Wf(l.label),p=n[s].atoms.length,this.plugin.log.info("Superposed "+p+" "+(p===1?"atom":"atoms")+" of ["+h+"] and ["+v+"] with RMSD "+f.toFixed(2)+"."),g.label=3;case 3:return++s,[3,1];case 4:return[2]}})})},r.superposeDb=function(){return ce(r,void 0,void 0,function(){var n,i,a,o,s,u;return de(this,function(l){switch(l.label){case 0:n=this.plugin.managers.structure.hierarchy.behaviors.selection.value.structures,i=Sut(n.map(function(c){var d;return(d=c.cell.obj)===null||d===void 0?void 0:d.data})),a=0,o=0,s=i,l.label=1;case 1:return o<s.length?(u=s[o],[4,this.transform(n[u.other].cell,u.transform.bTransform)]):[3,4];case 2:l.sent(),a+=u.transform.rmsd,l.label=3;case 3:return o++,[3,1];case 4:return a/=i.length-1,this.plugin.log.info("Superposed "+n.length+" structures with avg. RMSD "+a.toFixed(2)+"."),[4,new Promise(function(c){return requestAnimationFrame(c)})];case 5:return l.sent(),_t.Camera.Reset(this.plugin),[2]}})})},r.toggleByChains=function(){return r.setState({action:r.state.action==="byChains"?void 0:"byChains"})},r.toggleByAtoms=function(){return r.setState({action:r.state.action==="byAtoms"?void 0:"byAtoms"})},r.toggleOptions=function(){return r.setState({action:r.state.action==="options"?void 0:"options"})},r.setOptions=function(n){r.setState({options:n})},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.selection.events.changed,function(){r.forceUpdate()}),this.subscribe(this.selection.events.additionsHistoryUpdated,function(){r.forceUpdate()}),this.subscribe(this.plugin.behaviors.state.isBusy,function(n){r.setState({isBusy:n})}),this.subscribe(this.plugin.managers.structure.hierarchy.behaviors.selection,function(n){r.setState({canUseDb:n.structures.every(function(i){var a;return!!(!((a=i.cell.obj)===null||a===void 0)&&a.data)&&i.cell.obj.data.models.some(function(o){return ju.Provider.isApplicable(o)})})})})},Object.defineProperty(t.prototype,"selection",{get:function(){return this.plugin.managers.structure.selection},enumerable:!1,configurable:!0}),t.prototype.transform=function(r,n){return ce(this,void 0,void 0,function(){var i,a,o,s;return de(this,function(u){switch(u.label){case 0:return i=ji.resolveAndCheck(this.plugin.state.data,r),i?(a=or.findTagInSubtree(this.plugin.state.data.tree,i.transform.ref,SG),o={transform:{name:"matrix",params:{data:n,transpose:!1}}},s=a?this.plugin.state.data.build().to(a).update(o):this.plugin.state.data.build().to(r).insert(rt.Model.TransformStructureConformation,o,{tags:SG}),[4,this.plugin.runTask(this.plugin.state.data.updateTree(s))]):[2];case 1:return u.sent(),[2]}})})},t.prototype.highlight=function(r){this.plugin.managers.interactivity.lociHighlights.highlightOnly({loci:r},!1)},t.prototype.moveHistory=function(r,n){this.plugin.managers.structure.selection.modifyHistory(r,n,void 0,!0)},t.prototype.focusLoci=function(r){this.plugin.managers.camera.focusLoci(r)},t.prototype.lociEntry=function(r,n){var i=this;return P.jsx("div",E({className:"msp-flex-row"},{children:P.jsx(yr,E({noOverflow:!0,title:"Click to focus. Hover to highlight.",onClick:function(){return i.focusLoci(r.loci)},style:{width:"auto",textAlign:"left"},onMouseEnter:function(){return i.highlight(r.loci)},onMouseLeave:this.plugin.managers.interactivity.lociHighlights.clearHighlights},{children:P.jsx("span",{dangerouslySetInnerHTML:{__html:r.label}},void 0)}),void 0)}),n)},t.prototype.historyEntry=function(r,n){var i=this,a=this.plugin.managers.structure.selection.additionsHistory;return P.jsxs("div",E({className:"msp-flex-row"},{children:[P.jsxs(yr,E({noOverflow:!0,title:"Click to focus. Hover to highlight.",onClick:function(){return i.focusLoci(r.loci)},style:{width:"auto",textAlign:"left"},onMouseEnter:function(){return i.highlight(r.loci)},onMouseLeave:this.plugin.managers.interactivity.lociHighlights.clearHighlights},{children:[n,". ",P.jsx("span",{dangerouslySetInnerHTML:{__html:r.label}},void 0)]}),void 0),a.length>1&&P.jsx(Gt,{svg:kE,small:!0,className:"msp-form-control",onClick:function(){return i.moveHistory(r,"up")},flex:"20px",title:"Move up"},void 0),a.length>1&&P.jsx(Gt,{svg:RE,small:!0,className:"msp-form-control",onClick:function(){return i.moveHistory(r,"down")},flex:"20px",title:"Move down"},void 0),P.jsx(Gt,{svg:iu,small:!0,className:"msp-form-control",onClick:function(){return i.plugin.managers.structure.selection.modifyHistory(r,"remove")},flex:!0,title:"Remove"},void 0)]}),r.id)},t.prototype.atomsLociEntry=function(r,n){var i=this;return P.jsxs("div",{children:[P.jsx("div",E({className:"msp-control-group-header"},{children:P.jsx("div",E({className:"msp-no-overflow",title:r.label},{children:r.label}),void 0)}),void 0),P.jsx("div",E({className:"msp-control-offset"},{children:r.atoms.map(function(a,o){return i.historyEntry(a,o)})}),void 0)]},n)},Object.defineProperty(t.prototype,"chainEntries",{get:function(){var r=this,n=Ze.create(),i=[];return this.plugin.managers.structure.selection.entries.forEach(function(a,o){var s=a.selection,u=ji.resolveAndCheck(r.plugin.state.data,o);if(!(!u||Re.isEmpty(s))){var l=Re.getFirstLocation(s,n);if(!(s.elements.length>1||lt.entity.type(l)!=="polymer")){var c=Zf.ofLoci(s),d=kw(c,{countsOnly:!0}),f=yu(l,{reverse:!0,granularity:"chain"}).split("|"),h=d+" | "+f[0]+" | "+f[f.length-1];i.push({loci:s,label:h,cell:u})}}}),i},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"atomEntries",{get:function(){for(var r=this,n=new Map,i=this.plugin.managers.structure.selection.additionsHistory,a=0,o=i.length;a<o;++a){var s=i[a];if(Re.size(s.loci)===1){var u=s.loci.structure;n.has(u)?n.get(u).push(s):n.set(u,[s])}}var l=[];return n.forEach(function(c,d){for(var f=r.plugin.helpers.substructureParent.get(d),h=[],v=0,p=c.length;v<p;++v)h.push(c[v].loci.elements[0]);var m=Re(c[0].loci.structure,h),g=m.structure.label.split(" | ")[0];l.push({loci:m,label:g,cell:f,atoms:c})}),l},enumerable:!1,configurable:!0}),t.prototype.addByChains=function(){var r=this,n=this.chainEntries;return P.jsxs(P.Fragment,{children:[n.length>0&&P.jsx("div",E({className:"msp-control-offset"},{children:n.map(function(i,a){return r.lociEntry(i,a)})}),void 0),n.length<2&&P.jsx("div",E({className:"msp-control-offset msp-help-text"},{children:P.jsxs("div",E({className:"msp-help-description"},{children:[P.jsx(cn,{svg:Kl,inline:!0},void 0),"Add 2 or more selections (toggle ",P.jsx(Zw,{inline:!0},void 0)," mode) from separate structures. Selections must be limited to single polymer chains or residues therein."]}),void 0)}),void 0),n.length>1&&P.jsx(yr,E({title:"Superpose structures by selected chains.",className:"msp-btn-commit msp-btn-commit-on",onClick:this.superposeChains,style:{marginTop:"1px"}},{children:"Superpose"}),void 0)]},void 0)},t.prototype.addByAtoms=function(){var r=this,n=this.atomEntries;return P.jsxs(P.Fragment,{children:[n.length>0&&P.jsx("div",E({className:"msp-control-offset"},{children:n.map(function(i,a){return r.atomsLociEntry(i,a)})}),void 0),n.length<2&&P.jsx("div",E({className:"msp-control-offset msp-help-text"},{children:P.jsxs("div",E({className:"msp-help-description"},{children:[P.jsx(cn,{svg:Kl,inline:!0},void 0),"Add 1 or more selections (toggle ",P.jsx(Zw,{inline:!0},void 0)," mode) from separate structures. Selections must be limited to single atoms."]}),void 0)}),void 0),n.length>1&&P.jsx(yr,E({title:"Superpose structures by selected atoms.",className:"msp-btn-commit msp-btn-commit-on",onClick:this.superposeAtoms,style:{marginTop:"1px"}},{children:"Superpose"}),void 0)]},void 0)},t.prototype.superposeByDbMapping=function(){return P.jsx(P.Fragment,{children:P.jsx(yr,E({icon:hU,title:"Superpose structures using database mapping.",className:"msp-btn msp-btn-block",onClick:this.superposeDb,style:{marginTop:"1px"},disabled:this.state.isBusy},{children:"DB"}),void 0)},void 0)},t.prototype.render=function(){return P.jsxs(P.Fragment,{children:[P.jsxs("div",E({className:"msp-flex-row"},{children:[P.jsx(Fi,{icon:hU,label:"Chains",toggle:this.toggleByChains,isSelected:this.state.action==="byChains",disabled:this.state.isBusy},void 0),P.jsx(Fi,{icon:ORe,label:"Atoms",toggle:this.toggleByAtoms,isSelected:this.state.action==="byAtoms",disabled:this.state.isBusy},void 0),this.state.canUseDb&&this.superposeByDbMapping(),P.jsx(Fi,{icon:Pv,label:"",title:"Options",toggle:this.toggleOptions,isSelected:this.state.action==="options",disabled:this.state.isBusy,style:{flex:"0 0 40px",padding:0}},void 0)]}),void 0),this.state.action==="byChains"&&this.addByChains(),this.state.action==="byAtoms"&&this.addByAtoms(),this.state.action==="options"&&P.jsx("div",E({className:"msp-control-offset"},{children:P.jsx(Vn,{params:uae,values:this.state.options,onChangeValues:this.setOptions,isDisabled:this.state.isBusy},void 0)}),void 0)]},void 0)},t}(ea),Tut=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={show:!1,label:""},r.update=function(){var n=r.plugin.state.data,i=n.selectQ(function(h){return h.ofTransformer(rt.Model.ModelFromTrajectory)});if(i.length===0){r.setState({show:!1});return}for(var a="",o=0,s=new Set,u=0,l=i;u<l.length;u++){var c=l[u];if(c.sourceRef){var d=n.cells.get(c.sourceRef).obj;if(d&&d.data.frameCount>1){if(s.has(c.sourceRef)){r.setState({show:!1});return}if(s.add(c.sourceRef),o++,!a){var f=c.transform.params.modelIndex;a="Model "+(f+1)+" / "+d.data.frameCount}}}}o>1&&(a=""),r.setState({show:o>0,label:a})},r.reset=function(){return _t.State.ApplyAction(r.plugin,{state:r.plugin.state.data,action:IC.create({action:"reset"})})},r.prev=function(){return _t.State.ApplyAction(r.plugin,{state:r.plugin.state.data,action:IC.create({action:"advance",by:-1})})},r.next=function(){return _t.State.ApplyAction(r.plugin,{state:r.plugin.state.data,action:IC.create({action:"advance",by:1})})},r}return t.prototype.componentDidMount=function(){this.subscribe(this.plugin.state.data.events.changed,this.update),this.subscribe(this.plugin.behaviors.state.isAnimating,this.update)},t.prototype.render=function(){var r=this.plugin.behaviors.state.isAnimating.value;return!this.state.show||r&&!this.state.label?null:P.jsxs("div",E({className:"msp-traj-controls"},{children:[!r&&P.jsx(Gt,{svg:CRe,title:"First Model",onClick:this.reset,disabled:r},void 0),!r&&P.jsx(Gt,{svg:OZ,title:"Previous Model",onClick:this.prev,disabled:r},void 0),!r&&P.jsx(Gt,{svg:FZ,title:"Next Model",onClick:this.next,disabled:r},void 0),!!this.state.label&&P.jsx("span",{children:this.state.label},void 0)]}),void 0)},t}(br),Iut=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isBusy:!1,show:!0},r.keyUp=function(n){if(!(!n.ctrlKey||r.state.isBusy||n.target!==document.body)){var i=r.plugin.managers.snapshot;if(n.keyCode===37||n.key==="ArrowLeft")i.state.isPlaying&&i.stop(),r.prev();else if(n.keyCode===38||n.key==="ArrowUp"){if(i.state.isPlaying&&i.stop(),i.state.entries.size===0)return;var a=i.state.entries.get(0);r.update(a.snapshot.id)}else if(n.keyCode===39||n.key==="ArrowRight")i.state.isPlaying&&i.stop(),r.next();else if(n.keyCode===40||n.key==="ArrowDown"){if(i.state.isPlaying&&i.stop(),i.state.entries.size===0)return;var o=i.state.entries.get(i.state.entries.size-1);r.update(o.snapshot.id)}}},r.change=function(n){n.target.value!=="none"&&r.update(n.target.value)},r.prev=function(){var n=r.plugin.managers.snapshot,i=n.getNextId(n.state.current,-1);i&&r.update(i)},r.next=function(){var n=r.plugin.managers.snapshot,i=n.getNextId(n.state.current,1);i&&r.update(i)},r.togglePlay=function(){r.plugin.managers.snapshot.togglePlay()},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.managers.snapshot.events.changed,function(){return r.forceUpdate()}),this.subscribe(this.plugin.behaviors.state.isBusy,function(n){return r.setState({isBusy:n})}),this.subscribe(this.plugin.behaviors.state.isAnimating,function(n){return r.setState({isBusy:n})}),window.addEventListener("keyup",this.keyUp,!1)},t.prototype.componentWillUnmount=function(){e.prototype.componentWillUnmount.call(this),window.removeEventListener("keyup",this.keyUp,!1)},t.prototype.update=function(r){return ce(this,void 0,void 0,function(){return de(this,function(n){switch(n.label){case 0:return this.setState({isBusy:!0}),[4,_t.State.Snapshots.Apply(this.plugin,{id:r})];case 1:return n.sent(),this.setState({isBusy:!1}),[2]}})})},t.prototype.render=function(){var r=this.plugin.managers.snapshot,n=r.state.entries.size;if(n<2||!this.state.show)return null;var i=r.state.current,a=r.state.isPlaying;return P.jsxs("div",E({className:"msp-state-snapshot-viewport-controls"},{children:[P.jsxs("select",E({className:"msp-form-control",value:i||"none",onChange:this.change,disabled:this.state.isBusy||a},{children:[!i&&P.jsx("option",{value:"none"},"none"),r.state.entries.valueSeq().map(function(o,s){return P.jsxs("option",E({value:o.snapshot.id},{children:["["+(s+1)+"/"+n+"]"," ",o.name||new Date(o.timestamp).toLocaleString()]}),o.snapshot.id)})]}),void 0),P.jsx(Gt,{svg:a?BZ:LZ,title:a?"Pause":"Cycle States",onClick:this.togglePlay,disabled:a?!1:this.state.isBusy},void 0),!a&&P.jsxs(P.Fragment,{children:[P.jsx(Gt,{svg:OZ,title:"Previous State",onClick:this.prev,disabled:this.state.isBusy||a},void 0),P.jsx(Gt,{svg:FZ,title:"Next State",onClick:this.next,disabled:this.state.isBusy||a},void 0)]},void 0)]}),void 0)},t}(br),Mut=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isEmpty:!0,isExpanded:!1,isBusy:!1,isAnimating:!1,isPlaying:!1},r.toggleExpanded=function(){return r.setState({isExpanded:!r.state.isExpanded})},r.stop=function(){r.plugin.managers.animation.stop(),r.plugin.managers.snapshot.stop()},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.managers.snapshot.events.changed,function(){r.plugin.managers.snapshot.state.isPlaying?r.setState({isPlaying:!0,isExpanded:!1}):r.setState({isPlaying:!1})}),this.subscribe(this.plugin.behaviors.state.isBusy,function(n){n?r.setState({isBusy:!0,isExpanded:!1,isEmpty:r.plugin.state.data.tree.transforms.size<2}):r.setState({isBusy:!1,isEmpty:r.plugin.state.data.tree.transforms.size<2})}),this.subscribe(this.plugin.behaviors.state.isAnimating,function(n){n?r.setState({isAnimating:!0,isExpanded:!1}):r.setState({isAnimating:!1})})},t.prototype.render=function(){var r=this.plugin.managers.snapshot.state.isPlaying;if(r||this.state.isEmpty||this.plugin.managers.animation.isEmpty||!this.plugin.config.get(Zr.Viewport.ShowAnimation))return null;var n=this.state.isAnimating;return P.jsxs("div",E({className:"msp-animation-viewport-controls"},{children:[P.jsxs("div",{children:[P.jsx("div",{className:"msp-semi-transparent-background"},void 0),P.jsx(Gt,{svg:n||r?BZ:ERe,transparent:!0,title:n?"Stop":"Select Animation",onClick:n||r?this.stop:this.toggleExpanded,toggleState:this.state.isExpanded,disabled:n||r?!1:this.state.isBusy||this.state.isPlaying||this.state.isEmpty},void 0)]},void 0),this.state.isExpanded&&!this.state.isBusy&&P.jsx("div",E({className:"msp-animation-viewport-controls-select"},{children:P.jsx(xat,{onStart:this.toggleExpanded},void 0)}),void 0)]}),void 0)},t}(br),Dut=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.onMouseMove=function(n){n.buttons===0&&n.stopPropagation()},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.behaviors.interaction.selectionMode,function(){return r.forceUpdate()})},t.prototype.render=function(){return this.plugin.selectionMode?P.jsx("div",E({className:"msp-selection-viewport-controls",onMouseMove:this.onMouseMove},{children:P.jsx(sot,{},void 0)}),void 0):null},t}(br),Rut=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={labels:[]},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.behaviors.labels.highlight,function(n){return r.setState({labels:n.labels})})},t.prototype.render=function(){return this.state.labels.length===0?null:P.jsx("div",E({className:"msp-highlight-info"},{children:this.state.labels.map(function(r,n){return P.jsx("div",{dangerouslySetInnerHTML:{__html:r}},""+n)})}),void 0)},t}(br),kut=function(e){Le(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.state.behaviors.events.changed,function(){return r.forceUpdate()})},t.prototype.render=function(){var r=this,n=[];return this.plugin.customStructureControls.forEach(function(i,a){n.push(P.jsx(i,{initiallyCollapsed:r.props.initiallyCollapsed},a))}),n.length>0?P.jsx(P.Fragment,{children:n},void 0):null},t}(br),Out=function(e){Le(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.render=function(){return P.jsxs(P.Fragment,{children:[P.jsxs("div",E({className:"msp-section-header"},{children:[P.jsx(cn,{svg:TDe},void 0),"Structure Tools"]}),void 0),P.jsx(bot,{},void 0),P.jsx(fot,{},void 0),P.jsx(Eut,{},void 0),P.jsx(Hat,{},void 0),this.plugin.config.get(Zr.VolumeStreaming.Enabled)&&P.jsx(Jst,{},void 0),P.jsx(eut,{},void 0),P.jsx(kut,{},void 0)]},void 0)},t}(br),Fut=function(e){Le(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return Object.defineProperty(t.prototype,"current",{get:function(){return this.props.state.behaviors.currentObject.value},enumerable:!1,configurable:!0}),t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.state.events.object.updated,function(n){var i=n.ref,a=n.state,o=r.current;o.ref!==i||o.state!==a||r.forceUpdate()}),this.subscribe(this.plugin.state.data.actions.events.added,function(){return r.forceUpdate()}),this.subscribe(this.plugin.state.data.actions.events.removed,function(){return r.forceUpdate()})},t.prototype.render=function(){var r=this,n=this.props,i=n.state,a=n.nodeRef,o=i.cells.get(a),s=i.actions.fromCell(o,this.plugin);if(s.length===0)return null;var u=o.transform.transformer.definition,l=o.obj?o.obj.label:u.display&&u.display.name||u.name;return P.jsxs("div",E({className:"msp-state-actions"},{children:[!this.props.hideHeader&&P.jsxs("div",E({className:"msp-section-header"},{children:[P.jsx(cn,{svg:HDe},void 0)," ","Actions ("+l+")"]}),void 0),s.map(function(c,d){return P.jsx(hL,{state:i,action:c,nodeRef:a,initiallyCollapsed:d===0?!r.props.alwaysExpandFirst&&r.props.initiallyCollapsed:r.props.initiallyCollapsed},""+c.id)})]}),void 0)},t}(br),o3=function(e){Le(t,e);function t(r){var n=e.call(this)||this;return n.plugin=r,n.data=Th.create(new ge.Root({}),{runTask:n.plugin.runTask,globalContext:n.plugin,historyCapacity:n.plugin.config.get(Zr.State.HistoryCapacity)}),n.behaviors=Th.create(new Nr.Root({}),{runTask:n.plugin.runTask,globalContext:n.plugin,rootState:{isLocked:!0}}),n.events={cell:{stateUpdated:Dc(n.data.events.cell.stateUpdated,n.behaviors.events.cell.stateUpdated),created:Dc(n.data.events.cell.created,n.behaviors.events.cell.created),removed:Dc(n.data.events.cell.removed,n.behaviors.events.cell.removed)},object:{created:Dc(n.data.events.object.created,n.behaviors.events.object.created),removed:Dc(n.data.events.object.removed,n.behaviors.events.object.removed),updated:Dc(n.data.events.object.updated,n.behaviors.events.object.updated)}},n.snapshotParams=n.ev.behavior(t.DefaultSnapshotParams),n.setSnapshotParams=function(i){n.snapshotParams.next(E(E({},t.DefaultSnapshotParams),i))},n}return Object.defineProperty(t.prototype,"animation",{get:function(){return this.plugin.managers.animation},enumerable:!1,configurable:!0}),t.prototype.getSnapshot=function(r){var n,i,a=E(E({},this.snapshotParams.value),r);return{id:bn.create22(),data:a.data?this.data.getSnapshot():void 0,behaviour:a.behavior?this.behaviors.getSnapshot():void 0,animation:a.animation?this.animation.getSnapshot():void 0,startAnimation:a.startAnimation?!!a.startAnimation:void 0,camera:a.camera?{current:this.plugin.canvas3d.camera.getSnapshot(),transitionStyle:a.cameraTransition.name,transitionDurationInMs:((n=a==null?void 0:a.cameraTransition)===null||n===void 0?void 0:n.name)==="animate"?a.cameraTransition.params.durationInMs:void 0}:void 0,canvas3d:a.canvas3d?{props:(i=this.plugin.canvas3d)===null||i===void 0?void 0:i.props}:void 0,interactivity:a.interactivity?{props:this.plugin.managers.interactivity.props}:void 0,structureFocus:this.plugin.managers.structure.focus.getSnapshot(),durationInMs:a==null?void 0:a.durationInMs}},t.prototype.setSnapshot=function(r){var n;return ce(this,void 0,void 0,function(){var i;return de(this,function(a){switch(a.label){case 0:return[4,this.animation.stop()];case 1:return a.sent(),r.behaviour?[4,this.plugin.runTask(this.behaviors.setSnapshot(r.behaviour))]:[3,3];case 2:a.sent(),a.label=3;case 3:return r.data?[4,this.plugin.runTask(this.data.setSnapshot(r.data))]:[3,5];case 4:a.sent(),a.label=5;case 5:return!((n=r.canvas3d)===null||n===void 0)&&n.props?(i=I.normalizeParams(ks,r.canvas3d.props,"children"),[4,_t.Canvas3D.SetSettings(this.plugin,{settings:i})]):[3,7];case 6:a.sent(),a.label=7;case 7:return r.interactivity&&r.interactivity.props&&this.plugin.managers.interactivity.setProps(r.interactivity.props),r.structureFocus&&this.plugin.managers.structure.focus.setSnapshot(r.structureFocus),r.animation&&this.animation.setSnapshot(r.animation),r.camera&&_t.Camera.Reset(this.plugin,{snapshot:r.camera.current,durationMs:r.camera.transitionStyle==="animate"?r.camera.transitionDurationInMs:void 0}),r.startAnimation&&this.animation.start(),[2]}})})},t.prototype.updateTransform=function(r,n,i,a){var o=r.build().to(n).update(i);return _t.State.Update(this.plugin,{state:r,tree:o,options:{canUndo:a}})},t.prototype.updateBehavior=function(r,n){var i=this.behaviors.build();if(this.behaviors.tree.transforms.has(r.id))i.to(r.id).update(n);else{var a=r.createDefaultParams(void 0,this.plugin);i.to(Nr.getCategoryId(r)).apply(r,Iv(a,n),{ref:r.id})}return this.plugin.runTask(this.behaviors.updateTree(i))},t.prototype.dispose=function(){this.behaviors.cells.forEach(function(r){Nr.Behavior.is(r.obj)&&r.obj.data.unregister()}),e.prototype.dispose.call(this),this.data.dispose(),this.behaviors.dispose(),this.animation.dispose()},t}(N2);(function(e){e.SnapshotParams={durationInMs:I.Numeric(1500,{min:100,max:15e3,step:100},{label:"Duration in ms"}),data:I.Boolean(!0),behavior:I.Boolean(!1),animation:I.Boolean(!0),startAnimation:I.Boolean(!1),canvas3d:I.Boolean(!0),interactivity:I.Boolean(!0),camera:I.Boolean(!0),cameraTransition:I.MappedStatic("animate",{animate:I.Group({durationInMs:I.Numeric(250,{min:100,max:5e3,step:500},{label:"Duration in ms"})}),instant:I.Group({})},{options:[["animate","Animate"],["instant","Instant"]]})},e.DefaultSnapshotParams=I.getDefaultValues(e.SnapshotParams)})(o3||(o3={}));var Lut=function(e){Le(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.render=function(){var r;return P.jsxs("div",{children:[P.jsx(Vc,{icon:NZ,title:"Plugin State"},void 0),P.jsx("div",E({style:{marginBottom:"10px"}},{children:P.jsx(qu,E({header:"Save Options",initiallyExpanded:!1},{children:P.jsx(cae,{},void 0)}),void 0)}),void 0),P.jsx(Nut,{},void 0),P.jsx(But,{},void 0),P.jsx(Vc,{title:"Save as File",accent:"blue"},void 0),P.jsx(lae,{},void 0),((r=this.plugin.spec.components)===null||r===void 0?void 0:r.remoteState)!=="none"&&P.jsx(dae,{},void 0)]},void 0)},t}(br),lae=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.downloadToFileJson=function(){var n,i;(i=(n=r.props).onAction)===null||i===void 0||i.call(n),_t.State.Snapshots.DownloadToFile(r.plugin,{type:"json"})},r.downloadToFileZip=function(){var n,i;(i=(n=r.props).onAction)===null||i===void 0||i.call(n),_t.State.Snapshots.DownloadToFile(r.plugin,{type:"zip"})},r.open=function(n){var i,a;if(!n.target.files||!n.target.files[0]){r.plugin.log.error("No state file selected");return}(a=(i=r.props).onAction)===null||a===void 0||a.call(i),_t.State.Snapshots.OpenFile(r.plugin,{file:n.target.files[0]})},r}return t.prototype.render=function(){return P.jsxs(P.Fragment,{children:[P.jsxs("div",E({className:"msp-flex-row"},{children:[P.jsx(yr,E({icon:aD,onClick:this.downloadToFileJson,title:"Save the state description. Input data are loaded using the provided sources. Does not work if local files are used as input."},{children:"State"}),void 0),P.jsx(yr,E({icon:aD,onClick:this.downloadToFileZip,title:"Save the state including the input data."},{children:"Session"}),void 0),P.jsxs("div",E({className:"msp-btn msp-btn-block msp-btn-action msp-loader-msp-btn-file"},{children:[P.jsx(cn,{svg:hRe,inline:!0},void 0)," Open ",P.jsx("input",{onChange:this.open,type:"file",multiple:!1,accept:".molx,.molj"},void 0)]}),void 0)]}),void 0),P.jsxs("div",E({className:"msp-help-text",style:{padding:"10px"}},{children:[P.jsx(cn,{svg:RRe},void 0)," This is an experimental feature and stored states/sessions might not be openable in a future version."]}),void 0)]},void 0)},t}(br),cae=function(e){Le(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.state.snapshotParams,function(){return r.forceUpdate()})},t.prototype.render=function(){return P.jsx(Vn,{params:o3.SnapshotParams,values:this.plugin.state.snapshotParams.value,onChangeValues:this.plugin.state.setSnapshotParams},void 0)},t}(br),Nut=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={params:I.getDefaultValues(t.Params)},r.add=function(){_t.State.Snapshots.Add(r.plugin,{name:r.state.params.name,description:r.state.params.description})},r.updateParams=function(n){return r.setState({params:n})},r.clear=function(){_t.State.Snapshots.Clear(r.plugin,{})},r}return t.prototype.shouldComponentUpdate=function(r,n){return!c0(this.props,r)||!c0(this.state,n)},t.prototype.render=function(){return P.jsxs("div",{children:[P.jsx(Vn,{params:t.Params,values:this.state.params,onEnter:this.add,onChangeValues:this.updateParams},void 0),P.jsxs("div",E({className:"msp-flex-row"},{children:[P.jsx(Gt,{onClick:this.clear,svg:iu,title:"Remove All"},void 0),P.jsx(yr,E({onClick:this.add,icon:N0,style:{textAlign:"right"},commit:!0},{children:"Add"}),void 0)]}),void 0)]},void 0)},t.Params={name:I.Text(),description:I.Text()},t}(br),But=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.apply=function(n){var i=n.currentTarget.getAttribute("data-id");i&&_t.State.Snapshots.Apply(r.plugin,{id:i})},r.remove=function(n){var i=n.currentTarget.getAttribute("data-id");i&&_t.State.Snapshots.Remove(r.plugin,{id:i})},r.moveUp=function(n){var i=n.currentTarget.getAttribute("data-id");i&&_t.State.Snapshots.Move(r.plugin,{id:i,dir:-1})},r.moveDown=function(n){var i=n.currentTarget.getAttribute("data-id");i&&_t.State.Snapshots.Move(r.plugin,{id:i,dir:1})},r.replace=function(n){var i=n.currentTarget.getAttribute("data-id");i&&_t.State.Snapshots.Replace(r.plugin,{id:i})},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.managers.snapshot.events.changed,function(){return r.forceUpdate()})},t.prototype.render=function(){var r=this,n=this.plugin.managers.snapshot.state.current;return P.jsx("ul",E({style:{listStyle:"none",marginTop:"10px"},className:"msp-state-list"},{children:this.plugin.managers.snapshot.state.entries.map(function(i){return P.jsxs("li",E({className:"msp-flex-row"},{children:[P.jsxs(yr,E({"data-id":i.snapshot.id,onClick:r.apply,className:"msp-no-overflow"},{children:[P.jsx("span",E({style:{fontWeight:i.snapshot.id===n?"bold":void 0}},{children:i.name||new Date(i.timestamp).toLocaleString()}),void 0)," ",P.jsx("small",{children:(i.snapshot.durationInMs?mC(i.snapshot.durationInMs,!1)+(i.description?", ":""):"")+(i.description?i.description:"")},void 0)]}),void 0),P.jsx(Gt,{svg:kE,"data-id":i.snapshot.id,title:"Move Up",onClick:r.moveUp,flex:"20px"},void 0),P.jsx(Gt,{svg:RE,"data-id":i.snapshot.id,title:"Move Down",onClick:r.moveDown,flex:"20px"},void 0),P.jsx(Gt,{svg:PRe,"data-id":i.snapshot.id,title:"Replace",onClick:r.replace,flex:"20px"},void 0),P.jsx(Gt,{svg:iu,"data-id":i.snapshot.id,title:"Remove",onClick:r.remove,flex:"20px"},void 0)]}),i.snapshot.id)})}),void 0)},t}(br),dae=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.Params={name:I.Text(),options:I.Group({description:I.Text(),playOnLoad:I.Boolean(!1),serverUrl:I.Text(r.plugin.config.get(Zr.State.CurrentServer))})},r.state={params:I.getDefaultValues(r.Params),entries:ci.OrderedMap(),isBusy:!1},r.ListOnlyParams={options:I.Group({serverUrl:I.Text(r.plugin.config.get(Zr.State.CurrentServer))},{isFlat:!0})},r._mounted=!1,r.refresh=function(){return ce(r,void 0,void 0,function(){var n,i,a,o,s,u;return de(this,function(l){switch(l.label){case 0:return l.trys.push([0,2,,3]),this.setState({isBusy:!0}),this.plugin.config.set(Zr.State.CurrentServer,this.state.params.options.serverUrl),[4,this.plugin.runTask(this.plugin.fetch({url:this.serverUrl("list"),type:"json"}))];case 1:for(n=l.sent()||[],n.sort(function(c,d){return c.isSticky===d.isSticky?c.timestamp-d.timestamp:c.isSticky?-1:1}),i=ci.OrderedMap().asMutable(),a=0,o=n;a<o.length;a++)s=o[a],i.set(s.id,E(E({},s),{url:this.serverUrl("get/"+s.id),removeUrl:this.serverUrl("remove/"+s.id)}));return this._mounted&&this.setState({entries:i.asImmutable(),isBusy:!1}),[3,3];case 2:return u=l.sent(),this.plugin.log.error("Fetching Remote Snapshots: "+u),this._mounted&&this.setState({entries:ci.OrderedMap(),isBusy:!1}),[3,3];case 3:return[2]}})})},r.upload=function(){return ce(r,void 0,void 0,function(){return de(this,function(n){switch(n.label){case 0:return this.setState({isBusy:!0}),this.plugin.config.set(Zr.State.CurrentServer,this.state.params.options.serverUrl),[4,_t.State.Snapshots.Upload(this.plugin,{name:this.state.params.name,description:this.state.params.options.description,playOnLoad:this.state.params.options.playOnLoad,serverUrl:this.state.params.options.serverUrl})];case 1:return n.sent(),this.plugin.log.message("Snapshot uploaded."),this._mounted&&(this.setState({isBusy:!1}),this.refresh()),[2]}})})},r.fetch=function(n){return ce(r,void 0,void 0,function(){var i,a;return de(this,function(o){switch(o.label){case 0:if(i=n.currentTarget.getAttribute("data-id"),!i)return[2];if(a=this.state.entries.get(i),!a)return[2];this.setState({isBusy:!0}),o.label=1;case 1:return o.trys.push([1,,3,4]),[4,_t.State.Snapshots.Fetch(this.plugin,{url:a.url})];case 2:return o.sent(),[3,4];case 3:return this._mounted&&this.setState({isBusy:!1}),[7];case 4:return[2]}})})},r.remove=function(n){return ce(r,void 0,void 0,function(){var i,a;return de(this,function(o){switch(o.label){case 0:if(i=n.currentTarget.getAttribute("data-id"),!i)return[2];if(a=this.state.entries.get(i),!a)return[2];this.setState({entries:this.state.entries.remove(i)}),o.label=1;case 1:return o.trys.push([1,3,,4]),[4,fetch(a.removeUrl)];case 2:return o.sent(),[3,4];case 3:return o.sent(),[3,4];case 4:return[2]}})})},r}return t.prototype.componentDidMount=function(){this.refresh(),this._mounted=!0},t.prototype.componentWillUnmount=function(){this._mounted=!1},t.prototype.serverUrl=function(r){return r?wA(this.state.params.options.serverUrl,r):this.state.params.options.serverUrl},t.prototype.render=function(){var r=this;return P.jsxs(P.Fragment,{children:[P.jsx(Vc,{title:"Remote States",accent:"blue"},void 0),!this.props.listOnly&&P.jsxs(P.Fragment,{children:[P.jsx(Vn,{params:this.Params,values:this.state.params,onEnter:this.upload,onChange:function(n){var i;r.setState({params:E(E({},r.state.params),(i={},i[n.name]=n.value,i))})},isDisabled:this.state.isBusy},void 0),P.jsxs("div",E({className:"msp-flex-row"},{children:[P.jsx(Gt,{onClick:this.refresh,disabled:this.state.isBusy,svg:sD},void 0),P.jsx(yr,E({icon:zDe,onClick:this.upload,disabled:this.state.isBusy,commit:!0},{children:"Upload"}),void 0)]}),void 0)]},void 0),P.jsx(Uut,{entries:this.state.entries,isBusy:this.state.isBusy,serverUrl:this.state.params.options.serverUrl,fetch:this.fetch,remove:this.props.listOnly?void 0:this.remove},void 0),this.props.listOnly&&P.jsxs("div",E({style:{marginTop:"10px"}},{children:[P.jsx(Vn,{params:this.ListOnlyParams,values:this.state.params,onEnter:this.upload,onChange:function(n){var i;r.setState({params:E(E({},r.state.params),(i={},i[n.name]=n.value,i))})},isDisabled:this.state.isBusy},void 0),P.jsx("div",E({className:"msp-flex-row"},{children:P.jsx(yr,E({onClick:this.refresh,disabled:this.state.isBusy,icon:sD},{children:"Refresh"}),void 0)}),void 0)]}),void 0)]},void 0)},t}(br),Uut=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.open=function(n){return ce(r,void 0,void 0,function(){var i,a,o,s;return de(this,function(u){return i=n.currentTarget.getAttribute("data-id"),i?(a=this.props.entries.get(i),a?(n.preventDefault(),o=""+window.location,s=o.indexOf("?"),s>0&&(o=o.substr(0,s)),window.open(o+"?snapshot-url="+encodeURIComponent(a.url),"_blank"),[2]):[2]):[2]})})},r}return t.prototype.render=function(){var r=this;return P.jsx("ul",E({style:{listStyle:"none",marginTop:"10px"},className:"msp-state-list"},{children:this.props.entries.valueSeq().map(function(n){return P.jsxs("li",E({className:"msp-flex-row"},{children:[P.jsxs(yr,E({"data-id":n.id,onClick:r.props.fetch,disabled:r.props.isBusy,onContextMenu:r.open,title:"Click to download, right-click to open in a new tab."},{children:[n.name||new Date(n.timestamp).toLocaleString()," ",P.jsx("small",{children:n.description},void 0)]}),void 0),!n.isSticky&&r.props.remove&&P.jsx(Gt,{svg:iu,"data-id":n.id,title:"Remove",onClick:r.props.remove,disabled:r.props.isBusy,small:!0},void 0)]}),n.id)})}),void 0)},t}(ea);function fae(e,t){return t===void 0&&(t=rOe),function(r){return r.lift(new jut(e,t))}}var jut=function(){function e(t,r){this.dueTime=t,this.scheduler=r}return e.prototype.call=function(t,r){return r.subscribe(new zut(t,this.dueTime,this.scheduler))},e}(),zut=function(e){Ea(t,e);function t(r,n,i){var a=e.call(this,r)||this;return a.dueTime=n,a.scheduler=i,a.debouncedSubscription=null,a.lastValue=null,a.hasValue=!1,a}return t.prototype._next=function(r){this.clearDebounce(),this.lastValue=r,this.hasValue=!0,this.add(this.debouncedSubscription=this.scheduler.schedule(Vut,this.dueTime,this))},t.prototype._complete=function(){this.debouncedNext(),this.destination.complete()},t.prototype.debouncedNext=function(){if(this.clearDebounce(),this.hasValue){var r=this.lastValue;this.lastValue=null,this.hasValue=!1,this.destination.next(r)}},t.prototype.clearDebounce=function(){var r=this.debouncedSubscription;r!==null&&(this.remove(r),r.unsubscribe(),this.debouncedSubscription=null)},t}($s);function Vut(e){e.debouncedNext()}function Hut(e){return function(t){return e===0?Qke():t.lift(new Gut(e))}}var Gut=function(){function e(t){if(this.total=t,this.total<0)throw new iOe}return e.prototype.call=function(t,r){return r.subscribe(new qut(t,this.total))},e}(),qut=function(e){Ea(t,e);function t(r,n){var i=e.call(this,r)||this;return i.total=n,i.count=0,i}return t.prototype._next=function(r){var n=this.total,i=++this.count;i<=n&&(this.destination.next(r),i===n&&(this.destination.complete(),this.unsubscribe()))},t}($s),hae=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={showActions:!0},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.state.events.cell.created,function(n){n.cell.transform.parent===fr.RootRef&&r.forceUpdate()}),this.subscribe(this.plugin.state.events.cell.removed,function(n){n.parent===fr.RootRef&&r.forceUpdate()})},t.getDerivedStateFromProps=function(r,n){var i=r.state.tree.root.ref,a=r.state.tree.children.get(i),o=a.size===0;return n.showActions===o?null:{showActions:o}},t.prototype.render=function(){var r=this.props.state.tree.root.ref;return this.state.showActions?P.jsxs("div",E({style:{margin:"10px",cursor:"default"}},{children:[P.jsx("p",{children:"Nothing to see here yet."},void 0),P.jsxs("p",{children:["Structures and Volumes can be loaded from the ",P.jsx(cn,{svg:oD},void 0)," tab."]},void 0)]}),void 0):P.jsx($ut,{cell:this.props.state.cells.get(r),depth:0},void 0)},t}(br),$ut=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isCollapsed:!!r.props.cell.state.isCollapsed,isNull:t.isNull(r.props.cell),showLabel:t.showLabel(r.props.cell)},r}return t.prototype.is=function(r){return r.ref===this.ref&&r.state===this.props.cell.parent},Object.defineProperty(t.prototype,"ref",{get:function(){return this.props.cell.transform.ref},enumerable:!1,configurable:!0}),t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.state.events.cell.stateUpdated,function(n){r.props.cell===n.cell&&r.is(n)&&n.state.cells.has(r.ref)&&(r.state.isCollapsed!==!!n.cell.state.isCollapsed||r.state.isNull!==t.isNull(n.cell)||r.state.showLabel!==t.showLabel(n.cell))&&r.forceUpdate()}),this.subscribe(this.plugin.state.events.cell.created,function(n){r.props.cell.parent===n.state&&r.ref===n.cell.transform.parent&&r.forceUpdate()}),this.subscribe(this.plugin.state.events.cell.removed,function(n){r.props.cell.parent===n.state&&r.ref===n.parent&&r.forceUpdate()})},t.getDerivedStateFromProps=function(r,n){var i=t.isNull(r.cell),a=t.showLabel(r.cell);return!!r.cell.state.isCollapsed===n.isCollapsed&&n.isNull===i&&n.showLabel===a?null:{isCollapsed:!!r.cell.state.isCollapsed,isNull:i,showLabel:a}},t.hasDecorator=function(r){var n,i=r.parent.tree.children.get(r.transform.ref);return i.size!==1?!1:!!(!((n=r.parent)===null||n===void 0)&&n.tree.transforms.get(i.first()).transformer.definition.isDecorator)},t.isNull=function(r){return!r||!r.parent||r.obj===Nn.Null||!r.parent.tree.transforms.has(r.transform.ref)},t.showLabel=function(r){return r.transform.ref!==fr.RootRef&&(r.status!=="ok"||!r.state.isGhost&&!t.hasDecorator(r))},t.prototype.render=function(){var r=this;if(this.state.isNull)return null;var n=this.props.cell,i=n.parent.tree.children.get(this.ref);if(!this.state.showLabel)return i.size===0?null:P.jsx(P.Fragment,{children:i.map(function(o){return P.jsx(t,{cell:n.parent.cells.get(o),depth:r.props.depth},o)})},void 0);var a=this.props.depth+1;return P.jsxs(P.Fragment,{children:[P.jsx(Wut,{cell:n,depth:this.props.depth},void 0),i.size===0?void 0:P.jsx("div",E({style:{display:this.state.isCollapsed?"none":"block"}},{children:i.map(function(o){return P.jsx(t,{cell:n.parent.cells.get(o),depth:a},o)})}),void 0)]},void 0)},t}(br),Wut=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={isCurrent:r.props.cell.parent.current===r.ref,isCollapsed:!!r.props.cell.state.isCollapsed,action:void 0,currentAction:void 0},r.setCurrent=function(n){n==null||n.preventDefault(),n==null||n.currentTarget.blur(),_t.State.SetCurrentObject(r.plugin,{state:r.props.cell.parent,ref:r.ref})},r.setCurrentRoot=function(n){n==null||n.preventDefault(),n==null||n.currentTarget.blur(),_t.State.SetCurrentObject(r.plugin,{state:r.props.cell.parent,ref:fr.RootRef})},r.remove=function(n){n==null||n.preventDefault(),_t.State.RemoveObject(r.plugin,{state:r.props.cell.parent,ref:r.ref,removeParentGhosts:!0})},r.toggleVisible=function(n){n.preventDefault(),_t.State.ToggleVisibility(r.plugin,{state:r.props.cell.parent,ref:r.ref}),n.currentTarget.blur()},r.toggleExpanded=function(n){n.preventDefault(),_t.State.ToggleExpanded(r.plugin,{state:r.props.cell.parent,ref:r.ref}),n.currentTarget.blur()},r.highlight=function(n){n.preventDefault(),_t.Interactivity.Object.Highlight(r.plugin,{state:r.props.cell.parent,ref:r.ref}),n.currentTarget.blur()},r.clearHighlight=function(n){n.preventDefault(),_t.Interactivity.ClearHighlights(r.plugin),n.currentTarget.blur()},r.hideApply=function(){r.setCurrentRoot()},r.selectAction=function(n){n&&(n==null?void 0:n.value)()},r}return t.prototype.is=function(r){return r.ref===this.ref&&r.state===this.props.cell.parent},Object.defineProperty(t.prototype,"ref",{get:function(){return this.props.cell.transform.ref},enumerable:!1,configurable:!0}),t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.state.events.cell.stateUpdated.pipe(zE(function(n){return r.is(n)}),fae(33)),function(n){r.forceUpdate()}),this.subscribe(this.props.cell.parent.behaviors.currentObject,function(n){if(!r.is(n)){r.state.isCurrent&&n.state.transforms.has(r.ref)&&r._setCurrent(r.props.cell.parent.current===r.ref,r.state.isCollapsed);return}n.state.transforms.has(r.ref)&&r._setCurrent(r.props.cell.parent.current===r.ref,!!r.props.cell.state.isCollapsed)})},t.prototype._setCurrent=function(r,n){r?this.setState({isCurrent:r,action:"options",currentAction:void 0,isCollapsed:n}):this.setState({isCurrent:r,action:void 0,currentAction:void 0,isCollapsed:n})},t.getDerivedStateFromProps=function(r,n){var i=r.cell.parent.current===r.cell.transform.ref,a=!!r.cell.state.isCollapsed;return n.isCollapsed===a&&n.isCurrent===i?null:{isCurrent:i,isCollapsed:a,action:void 0,currentAction:void 0}},Object.defineProperty(t.prototype,"actions",{get:function(){var r=this,n=this.props.cell,i=Nt([],n.parent.actions.fromCell(n,this.plugin));if(i.length!==0)return i.sort(function(a,o){return a.definition.display.name<o.definition.display.name?-1:a.definition.display.name===o.definition.display.name?0:1}),Nt([rr.Header("Apply Action")],i.map(function(a){return rr.Item(a.definition.display.name,function(){return r.setState({action:"apply",currentAction:a})})}))},enumerable:!1,configurable:!0}),t.prototype.updates=function(r){for(var n=this.props.cell,i=Hb.getDecoratorChain(n.parent,n.transform.ref),a=[],o=i.length-1;o>=0;o--){var s=i[o];a.push(P.jsx(wd,{state:n.parent,transform:s.transform,noMargin:!0,wrapInExpander:!0,expanderHeaderLeftMargin:r},s.transform.transformer.id+"-"+o))}return P.jsx("div",E({className:"msp-tree-updates-wrapper"},{children:a}),void 0)},t.prototype.render=function(){var r=this.props.cell,n=r.transform;if(!r)return null;var i=this.is(r.parent.behaviors.currentObject.value),a=r.status!=="error"&&r.status!=="ok",o;if(r.status==="error"||!r.obj){var s=r.status==="error"?r.errorText:n.transformer.definition.display.name;o=P.jsxs(yr,E({className:"msp-btn-tree-label msp-no-hover-outline",noOverflow:!0,title:s,onClick:this.state.isCurrent?this.setCurrentRoot:this.setCurrent,disabled:a},{children:[r.status==="error"&&P.jsxs("b",{children:["[",r.status,"]"]},void 0)," ",P.jsx("span",{children:s},void 0)]}),void 0)}else{var u=r.obj,l=u.label+" "+(u.description?u.description:"");o=P.jsxs(yr,E({className:"msp-btn-tree-label msp-type-class-"+u.type.typeClass,noOverflow:!0,disabled:a,title:l,onClick:this.state.isCurrent?this.setCurrentRoot:this.setCurrent},{children:[P.jsx("span",{children:u.label},void 0)," ",u.description?P.jsx("small",{children:u.description},void 0):void 0]}),void 0)}var c=r.parent.tree.children.get(this.ref),d=r.state,f=P.jsx(Gt,{svg:d.isCollapsed?dd:cd,flex:"20px",disabled:a,onClick:this.toggleExpanded,transparent:!0,className:"msp-no-hover-outline",style:{visibility:c.size>0?"visible":"hidden"}},void 0),h=r.state.isLocked?void 0:P.jsx(Gt,{svg:iu,onClick:this.remove,disabled:a,small:!0,toggleState:!1},void 0),v=P.jsx(Gt,{svg:d.isHidden?Zv:Jv,toggleState:!1,disabled:a,small:!0,onClick:this.toggleVisible},void 0),p={marginLeft:this.props.depth*8+"px"},m=P.jsxs("div",E({className:"msp-flex-row msp-tree-row"+(i?" msp-tree-row-current":""),onMouseEnter:this.highlight,onMouseLeave:this.clearHighlight,style:p},{children:[f,o,h,v]}),void 0);if(!i)return m;if(this.state.action==="apply"&&this.state.currentAction)return P.jsxs("div",E({style:{marginBottom:"1px"}},{children:[m,P.jsx(zc,E({header:"Apply "+this.state.currentAction.definition.display.name,initialExpanded:!0,hideExpander:!0,hideOffset:!1,onHeaderClick:this.hideApply,topRightIcon:jc,headerLeftMargin:this.props.depth*8+21+"px"},{children:P.jsx(hL,{onApply:this.hideApply,state:this.props.cell.parent,action:this.state.currentAction,nodeRef:this.props.cell.transform.ref,hideHeader:!0,noMargin:!0},void 0)}),void 0)]}),void 0);if(this.state.action==="options"){var g=this.actions,y=this.updates(this.props.depth*8+21+"px");return P.jsxs("div",E({style:{marginBottom:"1px"}},{children:[m,y,g&&P.jsx("div",E({style:{marginLeft:this.props.depth*8+21+"px",marginTop:"-1px"}},{children:P.jsx(rr,{items:g,onSelect:this.selectAction},void 0)}),void 0)]}),void 0)}return m},t}(br),Xut=function(e){Le(t,e);function t(){var r,n=e.apply(this,arguments)||this;return n.state={tab:n.plugin.behaviors.layout.leftPanelTabName.value},n.set=function(i){if(n.state.tab===i){n.setState({tab:"none"},function(){return n.plugin.behaviors.layout.leftPanelTabName.next("none")}),_t.Layout.Update(n.plugin,{state:{regionState:E(E({},n.plugin.layout.state.regionState),{left:"collapsed"})}});return}n.setState({tab:i},function(){return n.plugin.behaviors.layout.leftPanelTabName.next(i)}),n.plugin.layout.state.regionState.left!=="full"&&_t.Layout.Update(n.plugin,{state:{regionState:E(E({},n.plugin.layout.state.regionState),{left:"full"})}})},n.tabs={none:P.jsx(P.Fragment,{},void 0),root:P.jsxs(P.Fragment,{children:[P.jsx(Vc,{icon:oD,title:"Home"},void 0),P.jsx(Fut,{state:n.plugin.state.data,nodeRef:fr.RootRef,hideHeader:!0,initiallyCollapsed:!0,alwaysExpandFirst:!0},void 0),((r=n.plugin.spec.components)===null||r===void 0?void 0:r.remoteState)!=="none"&&P.jsx(dae,{listOnly:!0},void 0)]},void 0),data:P.jsxs(P.Fragment,{children:[P.jsx(Vc,{icon:MZ,title:P.jsxs(P.Fragment,{children:[P.jsx(Qut,{},void 0)," State Tree"]},void 0)},void 0),P.jsx(hae,{state:n.plugin.state.data},void 0)]},void 0),states:P.jsx(Lut,{},void 0),settings:P.jsxs(P.Fragment,{children:[P.jsx(Vc,{icon:Pv,title:"Plugin Settings"},void 0),P.jsx(Kut,{},void 0)]},void 0),help:P.jsxs(P.Fragment,{children:[P.jsx(Vc,{icon:Kl,title:"Help"},void 0),P.jsx(aot,{},void 0)]},void 0)},n}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.behaviors.layout.leftPanelTabName,function(n){r.state.tab!==n&&r.setState({tab:n}),n==="none"&&r.plugin.layout.state.regionState.left!=="collapsed"&&_t.Layout.Update(r.plugin,{state:{regionState:E(E({},r.plugin.layout.state.regionState),{left:"collapsed"})}})}),this.subscribe(this.plugin.state.data.events.changed,function(n){var i=n.state;r.state.tab==="data"&&i.cells.size===1&&r.set("root")})},t.prototype.render=function(){var r=this,n=this.state.tab;return P.jsxs("div",E({className:"msp-left-panel-controls"},{children:[P.jsxs("div",E({className:"msp-left-panel-controls-buttons"},{children:[P.jsx(Gt,{svg:oD,toggleState:n==="root",transparent:!0,onClick:function(){return r.set("root")},title:"Home"},void 0),P.jsx(Yut,{set:this.set},void 0),P.jsx(Gt,{svg:NZ,toggleState:n==="states",transparent:!0,onClick:function(){return r.set("states")},title:"Plugin State"},void 0),P.jsx(Gt,{svg:Kl,toggleState:n==="help",transparent:!0,onClick:function(){return r.set("help")},title:"Help"},void 0),P.jsx("div",E({className:"msp-left-panel-controls-buttons-bottom"},{children:P.jsx(Gt,{svg:Pv,toggleState:n==="settings",transparent:!0,onClick:function(){return r.set("settings")},title:"Settings"},void 0)}),void 0)]}),void 0),P.jsx("div",E({className:"msp-scrollable-container"},{children:this.tabs[n]}),void 0)]}),void 0)},t}(br),Yut=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={changed:!1},r}return Object.defineProperty(t.prototype,"tab",{get:function(){return this.plugin.behaviors.layout.leftPanelTabName.value},enumerable:!1,configurable:!0}),t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.behaviors.layout.leftPanelTabName,function(n){r.tab==="data"?r.setState({changed:!1}):r.forceUpdate()}),this.subscribe(this.plugin.state.data.events.changed,function(n){r.tab!=="data"&&r.setState({changed:!0})})},t.prototype.render=function(){var r=this;return P.jsx(Gt,{svg:MZ,toggleState:this.tab==="data",transparent:!0,onClick:function(){return r.props.set("data")},title:"State Tree",style:{position:"relative"},extraContent:this.state.changed?P.jsx("div",{className:"msp-left-panel-controls-button-data-dirty"},void 0):void 0},void 0)},t}(br),Kut=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.setSettings=function(n){var i;_t.Canvas3D.SetSettings(r.plugin,{settings:(i={},i[n.name]=n.value,i)})},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.events.canvas3d.settingsUpdated,function(){return r.forceUpdate()}),this.subscribe(this.plugin.layout.events.updated,function(){return r.forceUpdate()}),this.subscribe(this.plugin.canvas3d.camera.stateChanged,function(n){(n.radiusMax!==void 0||n.radius!==void 0)&&r.forceUpdate()})},t.prototype.render=function(){return P.jsxs(P.Fragment,{children:[this.plugin.canvas3d&&P.jsxs(P.Fragment,{children:[P.jsx(Vc,{title:"Viewport"},void 0),P.jsx(Vn,{params:ks,values:this.plugin.canvas3d.props,onChange:this.setSettings},void 0)]},void 0),P.jsx(Vc,{title:"Behavior"},void 0),P.jsx(hae,{state:this.plugin.state.behaviors},void 0)]},void 0)},t}(br),Qut=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.remove=function(n){n.preventDefault(),_t.State.RemoveObject(r.plugin,{state:r.plugin.state.data,ref:fr.RootRef})},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.state.events.cell.created,function(n){n.cell.transform.parent===fr.RootRef&&r.forceUpdate()}),this.subscribe(this.plugin.state.events.cell.removed,function(n){n.parent===fr.RootRef&&r.forceUpdate()})},t.prototype.render=function(){var r=this.plugin.state.data.tree.children.get(fr.RootRef).size;return r===0?null:P.jsx(Gt,{svg:iu,onClick:this.remove,title:"Remove All",style:{display:"inline-block"},small:!0,className:"msp-no-hover-outline",transparent:!0},void 0)},t}(br),CG=5,Zut=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.parentDiv=_e.createRef(),r.lastMouseOverSeqIdx=-1,r.highlightQueue=new ai,r.lociHighlightProvider=function(n,i){var a=r.props.sequenceWrapper.markResidue(n.loci,i);a&&r.updateMarker()},r.lociSelectionProvider=function(n,i){var a=r.props.sequenceWrapper.markResidue(n.loci,i);a&&r.updateMarker()},r.contextMenu=function(n){n.preventDefault()},r.mouseDownLoci=void 0,r.mouseDown=function(n){n.stopPropagation();var i=r.getSeqIdx(n),a=r.getLoci(i),o=qp(n.nativeEvent),s=bg(n.nativeEvent),u=vS(n.nativeEvent);r.click(a,o,s,u),r.mouseDownLoci=a},r.mouseUp=function(n){if(n.stopPropagation(),r.mouseDownLoci!==void 0){var i=r.getSeqIdx(n),a=r.getLoci(i);if(a&&!Re.areEqual(r.mouseDownLoci,a)){var o=qp(n.nativeEvent),s=bg(n.nativeEvent),u=vS(n.nativeEvent),l=r.mouseDownLoci.elements[0],c=a.elements[0],d=Math.min(Fe.min(l.indices),Fe.min(c.indices)),f=Math.max(Fe.max(l.indices),Fe.max(c.indices)),h=Re(a.structure,[{unit:l.unit,indices:Fe.ofRange(d,f)}]);r.click(Re.subtract(h,r.mouseDownLoci),o,s,u)}r.mouseDownLoci=void 0}},r.location=Ze.create(void 0),r.mouseMove=function(n){n.stopPropagation();var i=qp(n.nativeEvent),a=bg(n.nativeEvent),o=vS(n.nativeEvent),s=n.target;if(!s||!s.getAttribute){if(r.lastMouseOverSeqIdx===-1)return;r.lastMouseOverSeqIdx=-1,r.highlightQueue.next({seqIdx:-1,buttons:i,button:a,modifiers:o});return}var u=s.hasAttribute("data-seqid")?+s.getAttribute("data-seqid"):-1;if(r.lastMouseOverSeqIdx!==u)if(r.lastMouseOverSeqIdx=u,r.mouseDownLoci!==void 0){var l=r.getLoci(u);r.hover(l,0,0,E(E({},o),{shift:!0}))}else r.highlightQueue.next({seqIdx:u,buttons:i,button:a,modifiers:o})},r.mouseLeave=function(n){if(n.stopPropagation(),r.mouseDownLoci=void 0,r.lastMouseOverSeqIdx!==-1){r.lastMouseOverSeqIdx=-1;var i=qp(n.nativeEvent),a=bg(n.nativeEvent),o=vS(n.nativeEvent);r.highlightQueue.next({seqIdx:-1,buttons:i,button:a,modifiers:o})}},r}return Object.defineProperty(t.prototype,"sequenceNumberPeriod",{get:function(){if(this.props.sequenceNumberPeriod!==void 0)return this.props.sequenceNumberPeriod;if(this.props.sequenceWrapper.length>10)return 10;var r=this.getSequenceNumber(this.props.sequenceWrapper.length-1);return r.length>1?5:1},enumerable:!1,configurable:!0}),t.prototype.componentDidMount=function(){var r=this;this.plugin.managers.interactivity.lociHighlights.addProvider(this.lociHighlightProvider),this.plugin.managers.interactivity.lociSelects.addProvider(this.lociSelectionProvider),this.subscribe(fae(15)(this.highlightQueue),function(n){var i=r.getLoci(n.seqIdx<0?void 0:n.seqIdx);r.hover(i,n.buttons,n.button,n.modifiers)})},t.prototype.componentWillUnmount=function(){e.prototype.componentWillUnmount.call(this),this.plugin.managers.interactivity.lociHighlights.removeProvider(this.lociHighlightProvider),this.plugin.managers.interactivity.lociSelects.removeProvider(this.lociSelectionProvider)},t.prototype.getLoci=function(r){if(r!==void 0){var n=this.props.sequenceWrapper.getLoci(r);if(!Re.isEmpty(n))return n}},t.prototype.getSeqIdx=function(r){var n=void 0,i=r.target;return i&&i.getAttribute&&(n=i.hasAttribute("data-seqid")?+i.getAttribute("data-seqid"):void 0),n},t.prototype.hover=function(r,n,i,a){var o={current:ur.Loci.Empty,buttons:n,button:i,modifiers:a};r!==void 0&&!Re.isEmpty(r)&&(o.current={loci:r}),this.plugin.behaviors.interaction.hover.next(o)},t.prototype.click=function(r,n,i,a){var o={current:ur.Loci.Empty,buttons:n,button:i,modifiers:a};r!==void 0&&!Re.isEmpty(r)&&(o.current={loci:r}),this.plugin.behaviors.interaction.click.next(o)},t.prototype.getBackgroundColor=function(r){return typeof r>"u"&&console.error("unexpected marker value"),r===0?"":r%2===0?"rgb(51, 255, 25)":"rgb(255, 102, 153)"},t.prototype.getResidueClass=function(r,n){return n.length>1?this.props.sequenceWrapper.residueClass(r)+(r===0?" msp-sequence-residue-long-begin":" msp-sequence-residue-long"):this.props.sequenceWrapper.residueClass(r)},t.prototype.residue=function(r,n,i){return P.jsx("span",E({"data-seqid":r,style:{backgroundColor:this.getBackgroundColor(i)},className:this.getResidueClass(r,n)},{children:""+n+""}),r)},t.prototype.getSequenceNumberClass=function(r,n,i){var a=["msp-sequence-number"];return n.startsWith("-")?i.length>1&&r>0?a.push("msp-sequence-number-long-negative"):a.push("msp-sequence-number-negative"):i.length>1&&r>0&&a.push("msp-sequence-number-long"),a.join(" ")},t.prototype.getSequenceNumber=function(r){var n="",i=this.props.sequenceWrapper.getLoci(r),a=Re.getFirstLocation(i,this.location);if(a)if(je.isAtomic(a.unit)){var o=lt.residue.auth_seq_id(a),s=lt.residue.pdbx_PDB_ins_code(a);n=""+o+(s||"")}else je.isCoarse(a.unit)&&(n=""+(r+1));return n},t.prototype.padSeqNum=function(r){return r.length<CG?r+new Array(CG-r.length+1).join(""):r},t.prototype.getSequenceNumberSpan=function(r,n){var i=this.getSequenceNumber(r);return P.jsx("span",E({className:this.getSequenceNumberClass(r,i,n)},{children:this.padSeqNum(i)}),"marker-"+r)},t.prototype.updateMarker=function(){if(this.parentDiv.current)for(var r=this.parentDiv.current.children,n=this.props.sequenceWrapper.markerArray,i=!this.props.hideSequenceNumbers,a=this.sequenceNumberPeriod,o=0,s=0,u=n.length;s<u;s++){i&&s%a===0&&s<u&&o++;var l=r[o];if(!l)return;o++;var c=this.getBackgroundColor(n[s]);l.style.backgroundColor!==c&&(l.style.backgroundColor=c)}},t.prototype.render=function(){for(var r=this.props.sequenceWrapper,n=[],i=!this.props.hideSequenceNumbers,a=this.sequenceNumberPeriod,o=0,s=r.length;o<s;++o){var u=r.residueLabel(o);i&&o%a===0&&o<s&&(n[n.length]=this.getSequenceNumberSpan(o,u)),n[n.length]=this.residue(o,u,r.markerArray[o])}return this.updateMarker(),P.jsx("div",E({className:"msp-sequence-wrapper",onContextMenu:this.contextMenu,onMouseDown:this.mouseDown,onMouseUp:this.mouseUp,onMouseMove:this.mouseMove,onMouseLeave:this.mouseLeave,ref:this.parentDiv},{children:n}),void 0)},t}(br),IA=function(){function e(t,r,n){this.data=t,this.markerArray=r,this.length=n}return e.prototype.markResidue=function(t,r){return Ws(t)?Ku(this.markerArray,Ie.ofLength(this.length),r):this.mark(t,r)},e}(),Jut=function(e){Le(t,e);function t(r){var n=this,i=Ze.create(r.structure,r.units[0],r.units[0].elements[0]),a=r.units[0].model.sequence.byEntityKey[lt.entity.key(i)],o=a.sequence.length,s=new Uint8Array(o);n=e.call(this,r,s,o)||this,n.unitMap=new Map;for(var u=0,l=r.units;u<l.length;u++){var c=l[u];n.unitMap.set(c.id,c)}n.sequence=a.sequence,n.missing=r.units[0].model.properties.missingResidues,n.modelNum=r.units[0].model.modelNum,n.asymId=je.isAtomic(r.units[0])?lt.chain.label_asym_id(i):lt.coarse.asym_id(i);for(var d=[],f=0;f<o;++f)n.missing.has(n.modelNum,n.asymId,n.seqId(f))&&d.push(f);return n.observed=Fe.subtract(Ie.ofBounds(0,o),Je.ofSortedArray(d)),n}return t.prototype.seqId=function(r){return this.sequence.seqId.value(r)},t.prototype.residueLabel=function(r){return this.sequence.label.value(r)||this.sequence.code.value(r)},t.prototype.residueColor=function(r){return this.missing.has(this.modelNum,this.asymId,this.seqId(r))?pr.grey:pr.black},t.prototype.residueClass=function(r){return this.missing.has(this.modelNum,this.asymId,this.seqId(r))?"msp-sequence-missing":"msp-sequence-present"},t.prototype.mark=function(r,n){var i=this,a=!1,o=this.data.structure,s=function(d){return i.sequence.index(d)};if(Re.is(r)){if(!We.areRootsEquivalent(r.structure,o))return!1;r=Re.remap(r,o);for(var u=0,l=r.elements;u<l.length;u++){var c=l[u];this.unitMap.has(c.unit.id)&&(je.isAtomic(c.unit)?a=tlt(c,n,this.markerArray,s):a=rlt(c,n,this.markerArray,s))}}else if(We.isLoci(r)){if(!We.areRootsEquivalent(r.structure,o))return!1;Ku(this.markerArray,this.observed,n)&&(a=!0)}return a},t.prototype.getLoci=function(r){var n=elt(this.data.units[0].chainGroupId,this.data.units[0].conformation.operator.name,this.seqId(r));return mt.toLociWithSourceUnits(ND.run(n,this.data.structure))},t}(IA);function elt(e,t,r){return sn.generators.atoms({unitTest:function(n){return lt.unit.chainGroupId(n.element)===e&&lt.unit.operator_name(n.element)===t},residueTest:function(n){return n.element.unit.kind===0?lt.residue.label_seq_id(n.element)===r:lt.coarse.seq_id_begin(n.element)<=r&&lt.coarse.seq_id_end(n.element)>=r}})}function tlt(e,t,r,n){var i=e.unit,a=i.model,o=i.elements,s=a.atomicHierarchy.residueAtomSegments.index,u=a.atomicHierarchy.residues.label_seq_id;return Fe.forEachSegment(e.indices,function(l){return s[o[l]]},function(l){var c=u.value(l);Dw(r,n(c),t)}),!0}function rlt(e,t,r,n){var i=e.unit,a=i.model,o=i.elements,s=je.isSpheres(e.unit)?a.coarseHierarchy.spheres.seq_id_begin:a.coarseHierarchy.gaussians.seq_id_begin,u=je.isSpheres(e.unit)?a.coarseHierarchy.spheres.seq_id_end:a.coarseHierarchy.gaussians.seq_id_end;return Fe.forEach(e.indices,function(l){for(var c=o[l],d=n(s.value(c)),f=n(u.value(c));d<=f;d++)Dw(r,d,t)}),!0}var nlt=function(e){Le(t,e);function t(r){for(var n=this,i=[],a=new Map,o=new Map,s=new Map,u=0,l=r.units.length;u<l;++u)for(var c=r.units[u],d=c.model.atomicHierarchy,f=d.residueAtomSegments,h=d.atoms,v=ar.transientSegments(f,c.elements);v.hasNext;){var p=v.move().index;a.set(p,i.length),o.set(i.length,p),s.set(i.length,c),i.push(h.label_comp_id.value(f.offsets[p]))}var m=i.length,g=new Uint8Array(m);n=e.call(this,r,g,m)||this,n.unitMap=new Map;for(var y=0,b=r.units;y<b.length;y++){var c=b[y];n.unitMap.set(c.id,c)}return n.sequence=i,n.sequenceIndices=a,n.residueIndices=o,n.seqToUnit=s,n}return t.prototype.residueLabel=function(r){return this.sequence[r]},t.prototype.residueColor=function(r){return pr.black},t.prototype.residueClass=function(r){return"msp-sequence-present"},t.prototype.mark=function(r,n){var i=this,a=!1,o=this.data.structure;if(Re.is(r)){if(!We.areRootsEquivalent(r.structure,o))return!1;r=Re.remap(r,o);for(var s=function(f){var h=u.unitMap.get(f.unit.id);if(h){var v=f.unit.model.atomicHierarchy.residueAtomSegments.index;Fe.forEach(f.indices,function(p){var m=i.sequenceIndices.get(v[h.elements[p]]);m!==void 0&&Ku(i.markerArray,Ie.ofSingleton(m),n)&&(a=!0)})}},u=this,l=0,c=r.elements;l<c.length;l++){var d=c[l];s(d)}}else if(We.isLoci(r)){if(!We.areRootsEquivalent(r.structure,o))return!1;Ku(this.markerArray,Ie.ofBounds(0,this.length),n)&&(a=!0)}return a},t.prototype.getLoci=function(r){var n=[],i=this.residueIndices.get(r);if(i!==void 0){var a=this.seqToUnit.get(r),o=a.model.atomicHierarchy.residueAtomSegments.offsets,s=Je.findPredecessorIndex(a.elements,o[i]),u=Je.findPredecessorIndex(a.elements,o[i+1]);n.push({unit:a,indices:Ie.ofBounds(s,u)})}return Re(this.data.structure,n)},t}(IA),aI=function(e){Le(t,e);function t(r){for(var n=this,i=0,a=0,o=[],s=Ze.create(r.structure),u=new Map,l=[],c=0,d=r.units.length;c<d;++c){var f=r.units[c];Ze.set(s,r.structure,f,f.elements[0]);var h=f.model.sequence.byEntityKey[lt.entity.key(s)];h&&(i+=h.sequence.length),a+=f.elements.length;var v=Ie.ofBounds(0,f.elements.length);u.set(f.id,v),l.push({unit:f,indices:v})}i>0&&o.push(i+" residues"),o.push(a+" elements");var p=1,m=new Uint8Array(p);return n=e.call(this,r,m,p)||this,n.label="Whole Chain ("+o.join(", ")+")",n.unitIndices=u,n.loci=Re(n.data.structure,l),n}return t.prototype.residueLabel=function(r){return this.label},t.prototype.residueColor=function(r){return pr.black},t.prototype.residueClass=function(r){return"msp-sequence-present"},t.prototype.mark=function(r,n){var i=!1,a=this.data.structure;if(Re.is(r)){if(!We.areRootsEquivalent(r.structure,a))return!1;r=Re.remap(r,a);for(var o=0,s=r.elements;o<s.length;o++){var u=s[o],l=this.unitIndices.get(u.unit.id);l&&Fe.isSubset(l,u.indices)&&Ku(this.markerArray,Ie.ofSingleton(0),n)&&(i=!0)}}else if(We.isLoci(r)){if(!We.areRootsEquivalent(r.structure,a))return!1;Ku(this.markerArray,Ie.ofSingleton(0),n)&&(i=!0)}return i},t.prototype.getLoci=function(r){return this.loci},t}(IA),ilt=function(e){Le(t,e);function t(r){for(var n=this,i=0,a=new Map,o=0,s=r.units.length;o<s;++o){var u=r.units[o];i+=u.elements.length;var l=Ie.ofBounds(0,u.elements.length);a.set(u.id,l)}var c=new Uint8Array(i);return n=e.call(this,r,c,i)||this,n.unitIndices=a,n}return t.prototype.residueLabel=function(r){return"X"},t.prototype.residueColor=function(r){return pr.black},t.prototype.residueClass=function(r){return"msp-sequence-present"},t.prototype.mark=function(r,n){var i=!1,a=this.data,o=a.structure,s=a.units;if(Re.is(r)){if(!We.areRootsEquivalent(r.structure,o))return!1;r=Re.remap(r,o);for(var u=0,l=r.elements;u<l.length;u++){var c=l[u],d=this.unitIndices.get(c.unit.id);d&&Fe.isSubset(d,c.indices)&&Ku(this.markerArray,c.indices,n)&&(i=!0)}}else if(We.isLoci(r)){if(!We.areRootsEquivalent(r.structure,o))return!1;for(var f=0,h=s.length;f<h;++f){var d=this.unitIndices.get(s[f].id);Ku(this.markerArray,d,n)&&(i=!0)}}return i},t.prototype.getLoci=function(r){for(var n=this.data.units,i=[],a=0,o=0,s=n.length;o<s;++o){var u=n[o];if(r<a+u.elements.length){i.push({unit:u,indices:Ie.ofSingleton(r-a)});break}a+=u.elements.length}return Re(this.data.structure,i)},t}(IA),oI=5e3;function pae(e){var t=lt.unit.pdbx_struct_oper_list_ids(e),r=lt.unit.struct_ncs_oper_id(e),n=lt.unit.hkl(e),i=lt.unit.spgrOp(e);return t.sort().join(",")+"|"+r+"|"+n+"|"+i}function pL(e){var t=e.split("|"),r=t[0],n=t[1];return[parseInt(r),n]}function _G(e,t){for(var r=e.structure,n=e.modelEntityId,i=e.chainGroupId,a=e.operatorKey,o=Ze.create(r),s=pL(n),u=s[0],l=s[1],c=[],d=0,f=r.units;d<f.length;d++){var h=f[d];Ze.set(o,r,h,h.elements[0]),r.getModelIndex(h.model)===u&&lt.entity.id(o)===l&&h.chainGroupId===i&&pae(o)===a&&c.push(h)}if(c.length>0){var v={structure:r,units:c},h=c[0],p=void 0;if(h.polymerElements.length){var m=Ze.create(r,h,h.elements[0]),g=h.model.sequence.byEntityKey[lt.entity.key(m)];if(g&&g.sequence.length<=oI)p=new Jut(v);else{var y=c.reduce(function(x,C){return x+C.polymerElements.length},0);je.isAtomic(h)||y>oI?p=new aI(v):p=new ilt(v)}}else if(je.isAtomic(h)){var b=c.reduce(function(x,C){return x+C.residueCount},0);b>oI?p=new aI(v):p=new nlt(v)}else console.warn("should not happen, expecting coarse units to be polymeric"),p=new aI(v);return p.markResidue(t.getLoci(r),nr.Select),p}else return"No sequence available"}function wS(e,t){t===void 0&&(t=!1);for(var r=[],n=Ze.create(e),i=new Set,a=0,o=e.units;a<o.length;a++){var s=o[a];Ze.set(n,e,s,s.elements[0]);var u=lt.entity.id(n),l=e.getModelIndex(s.model),c=l+"|"+u;if(!i.has(c)&&!(t&&lt.entity.type(n)!=="polymer")){var d=lt.entity.pdbx_description(n).join(", ");e.models.length&&(e.representativeModel?d+=" (Model "+e.models[l].modelNum+")":d.startsWith("Polymer ")&&(d+=" ("+e.models[l].entry+")"));var f=u+": "+d;r.push([c,f]),i.add(c)}}return r.length===0&&r.push(["","No entities"]),r}function jy(e,t){for(var r=[],n=Ze.create(e),i=new Set,a=pL(t),o=a[0],s=a[1],u=0,l=e.units;u<l.length;u++){var c=l[u];if(Ze.set(n,e,c,c.elements[0]),e.getModelIndex(c.model)===o&&lt.entity.id(n)===s){var d=c.chainGroupId;if(!i.has(d)){var f=yu(n,{granularity:"chain",hidePrefix:!0,htmlStyling:!1});r.push([d,f]),i.add(d)}}}return r.length===0&&r.push([-1,"No units"]),r}function jm(e,t,r){for(var n=[],i=Ze.create(e),a=new Set,o=pL(t),s=o[0],u=o[1],l=0,c=e.units;l<c.length;l++){var d=c[l];if(Ze.set(i,e,d,d.elements[0]),e.getModelIndex(d.model)===s&&lt.entity.id(i)===u&&d.chainGroupId===r){var f=pae(i);if(!a.has(f)){var h=d.conformation.operator.name;n.push([f,h]),a.add(f)}}}return n.length===0&&n.push(["","No operators"]),n}function wG(e){for(var t,r=[],n=[],i=e.select(or.Generators.rootsOfType(ge.Molecule.Structure)),a=0,o=i;a<o.length;a++){var s=o[a];!((t=s.obj)===null||t===void 0)&&t.data&&(n.push(s.obj.data),r.push([s.transform.ref,s.obj.data.label]))}return r.length===0&&r.push(["","No structure"]),{options:r,all:n}}var EG=I.Select("single",[["single","Chain"],["polymers","Polymers"],["all","Everything"]]),alt=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={structureOptions:{options:[],all:[]},structure:We.Empty,structureRef:"",modelEntityId:"",chainGroupId:-1,operatorKey:"",mode:"single"},r.setParamProps=function(n){var i=E({},r.state);switch(n.name){case"mode":if(i.mode=n.value,r.state.mode===i.mode)return;if(i.mode==="all"||i.mode==="polymers")break;case"structure":n.name==="structure"&&(i.structureRef=n.value),i.structure=r.getStructure(i.structureRef),i.modelEntityId=wS(i.structure)[0][0],i.chainGroupId=jy(i.structure,i.modelEntityId)[0][0],i.operatorKey=jm(i.structure,i.modelEntityId,i.chainGroupId)[0][0];break;case"entity":i.modelEntityId=n.value,i.chainGroupId=jy(i.structure,i.modelEntityId)[0][0],i.operatorKey=jm(i.structure,i.modelEntityId,i.chainGroupId)[0][0];break;case"chain":i.chainGroupId=n.value,i.operatorKey=jm(i.structure,i.modelEntityId,i.chainGroupId)[0][0];break;case"operator":i.operatorKey=n.value;break}r.setState(i)},r}return t.prototype.componentDidMount=function(){var r=this;this.plugin.state.data.select(or.Generators.rootsOfType(ge.Molecule.Structure)).length>0&&this.setState(this.getInitialState()),this.subscribe(this.plugin.state.events.object.updated,function(n){var i=n.ref,a=n.obj;i===r.state.structureRef&&a&&a.type===ge.Molecule.Structure.type&&a.data!==r.state.structure&&r.sync()}),this.subscribe(this.plugin.state.events.object.created,function(n){var i=n.obj;i&&i.type===ge.Molecule.Structure.type&&r.sync()}),this.subscribe(this.plugin.state.events.object.removed,function(n){var i=n.obj;i&&i.type===ge.Molecule.Structure.type&&i.data===r.state.structure&&r.sync()})},t.prototype.sync=function(){var r=wG(this.plugin.state.data);k6(r.all,this.state.structureOptions.all)||this.setState(this.getInitialState())},t.prototype.getStructure=function(r){var n=this.plugin.state.data,i=n.select(r)[0];return!r||!i||!i.obj?We.Empty:i.obj.data},t.prototype.getSequenceWrapper=function(r){return{wrapper:_G(this.state,this.plugin.managers.structure.selection),label:I.optionLabel(r.chain,this.state.chainGroupId)+" | "+I.optionLabel(r.entity,this.state.modelEntityId)}},t.prototype.getSequenceWrappers=function(r){if(this.state.mode==="single")return[this.getSequenceWrapper(r)];for(var n=this.getStructure(this.state.structureRef),i=[],a=0,o=wS(n,this.state.mode==="polymers");a<o.length;a++)for(var s=o[a],u=s[0],l=s[1],c=0,d=jy(n,u);c<d.length;c++)for(var f=d[c],h=f[0],v=f[1],p=0,m=jm(n,u,h);p<m.length;p++){var g=m[p][0];i.push({wrapper:_G({structure:n,modelEntityId:u,chainGroupId:h,operatorKey:g},this.plugin.managers.structure.selection),label:v+" | "+l})}return i},t.prototype.getInitialState=function(){var r,n=wG(this.plugin.state.data),i=n.options[0][0],a=this.getStructure(i),o=wS(a)[0][0],s=jy(a,o)[0][0],u=jm(a,o,s)[0][0];return this.state.structure&&this.state.structure===a&&(o=this.state.modelEntityId,s=this.state.chainGroupId,u=this.state.operatorKey),{structureOptions:n,structure:a,structureRef:i,modelEntityId:o,chainGroupId:s,operatorKey:u,mode:(r=this.props.defaultMode)!==null&&r!==void 0?r:"single"}},Object.defineProperty(t.prototype,"params",{get:function(){var r=this.state,n=r.structureOptions,i=r.structure,a=r.modelEntityId,o=r.chainGroupId,s=wS(i),u=jy(i,a),l=jm(i,a,o);return{structure:I.Select(n.options[0][0],n.options,{shortLabel:!0}),entity:I.Select(s[0][0],s,{shortLabel:!0}),chain:I.Select(u[0][0],u,{shortLabel:!0,twoColumns:!0,label:"Chain"}),operator:I.Select(l[0][0],l,{shortLabel:!0,twoColumns:!0}),mode:EG}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"values",{get:function(){return{structure:this.state.structureRef,entity:this.state.modelEntityId,chain:this.state.chainGroupId,operator:this.state.operatorKey,mode:this.state.mode}},enumerable:!1,configurable:!0}),t.prototype.render=function(){if(this.getStructure(this.state.structureRef)===We.Empty)return P.jsx("div",E({className:"msp-sequence"},{children:P.jsxs("div",E({className:"msp-sequence-select"},{children:[P.jsx(cn,{svg:Kl,style:{cursor:"help",position:"absolute",right:0,top:0},title:"Shows a sequence of one or more chains. Use the controls to alter selection."},void 0),P.jsx("span",{children:"Sequence"},void 0),P.jsx("span",E({style:{fontWeight:"normal"}},{children:"No structure available"}),void 0)]}),void 0)}),void 0);var r=this.params,n=this.values,i=this.getSequenceWrappers(r);return P.jsxs("div",E({className:"msp-sequence"},{children:[P.jsxs("div",E({className:"msp-sequence-select"},{children:[P.jsx(cn,{svg:Kl,style:{cursor:"help",position:"absolute",right:0,top:0},title:"This shows a single sequence. Use the controls to show a different sequence."},void 0),P.jsx("span",{children:"Sequence of"},void 0),P.jsx(Qm,{title:"[Structure] "+I.optionLabel(r.structure,n.structure),param:r.structure,name:"structure",value:n.structure,onChange:this.setParamProps},void 0),P.jsx(Qm,{title:"[Mode]",param:EG,name:"mode",value:n.mode,onChange:this.setParamProps},void 0),n.mode==="single"&&P.jsx(Qm,{title:"[Entity] "+I.optionLabel(r.entity,n.entity),param:r.entity,name:"entity",value:n.entity,onChange:this.setParamProps},void 0),n.mode==="single"&&P.jsx(Qm,{title:"[Chain] "+I.optionLabel(r.chain,n.chain),param:r.chain,name:"chain",value:n.chain,onChange:this.setParamProps},void 0),r.operator.options.length>1&&P.jsx(P.Fragment,{children:P.jsx(Qm,{title:"[Instance] "+I.optionLabel(r.operator,n.operator),param:r.operator,name:"operator",value:n.operator,onChange:this.setParamProps},void 0)},void 0)]}),void 0),P.jsx(olt,{children:i.map(function(a,o){var s=typeof a.wrapper=="string"?P.jsx("div",E({className:"msp-sequence-wrapper"},{children:a.wrapper}),o):P.jsx(Zut,{sequenceWrapper:a.wrapper},o);return n.mode==="single"?s:P.jsxs(_e.Fragment,{children:[P.jsx("div",E({className:"msp-sequence-chain-label"},{children:a.label}),void 0),s]},o)})},void 0)]}),void 0)},t}(br);function olt(e){var t=e.children;return P.jsx("div",E({className:"msp-sequence-wrapper-non-empty"},{children:t}),void 0)}var slt=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={tracked:ci.OrderedMap()},r}return t.prototype.componentDidMount=function(){var r=this,n,i=!!(!((n=this.plugin.spec.components)===null||n===void 0)&&n.hideTaskOverlay);this.subscribe(this.plugin.events.task.progress.pipe(zE(function(a){return a.level==="background"&&(i||!a.useOverlay)})),function(a){r.setState({tracked:r.state.tracked.set(a.id,a)})}),this.subscribe(this.plugin.events.task.finished,function(a){var o=a.id;r.setState({tracked:r.state.tracked.delete(o)})})},t.prototype.render=function(){return P.jsx("div",E({className:"msp-background-tasks"},{children:this.state.tracked.valueSeq().map(function(r){return P.jsx(vae,{event:r},r.id)})}),void 0)},t}(br),vae=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.abort=function(){r.plugin.managers.task.requestAbort(r.props.event.progress.root.progress.taskId,"User Request")},r}return t.prototype.render=function(){var r=this.props.event.progress.root,n=mae(this.props.event.progress.root)-1,i=r.progress.isIndeterminate?void 0:P.jsxs(P.Fragment,{children:["[",r.progress.current,"/",r.progress.max,"]"]},void 0),a=n>0?P.jsxs(P.Fragment,{children:["[",n," subtask(s)]"]},void 0):void 0;return P.jsx("div",E({className:"msp-task-state"},{children:P.jsxs("div",{children:[r.progress.canAbort&&P.jsx(Gt,{svg:RZ,onClick:this.abort,title:"Abort"},void 0),P.jsxs("div",{children:[r.progress.message," ",i," ",a]},void 0)]},void 0)}),void 0)},t}(br);function mae(e){if(e.children.length===0)return 1;for(var t=0,r=0,n=e.children;r<n.length;r++){var i=n[r];t+=mae(i)}return t}var ult=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={tracked:ci.OrderedMap()},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.events.task.progress.pipe(zE(function(n){return!!n.useOverlay})),function(n){r.setState({tracked:r.state.tracked.set(n.id,n)})}),this.subscribe(this.plugin.events.task.finished,function(n){var i=n.id;r.setState({tracked:r.state.tracked.delete(i)})})},t.prototype.render=function(){return this.state.tracked.size===0?null:P.jsx("div",E({className:"msp-overlay-tasks"},{children:this.state.tracked.valueSeq().map(function(r){return P.jsx(vae,{event:r},r.id)})}),void 0)},t}(br),llt=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.hide=function(){var n=r.props.entry;(n.hide||function(){}).call(null)},r}return t.prototype.render=function(){var r=this,n=this.props.entry,i=typeof n.message=="string"?P.jsx("div",{dangerouslySetInnerHTML:{__html:n.message}},void 0):P.jsx("div",{children:P.jsx(n.message,{},void 0)},void 0);return P.jsxs("div",E({className:"msp-toast-entry"},{children:[P.jsx("div",E({className:"msp-toast-title",onClick:function(){return r.hide()}},{children:n.title}),void 0),P.jsx("div",E({className:"msp-toast-message"},{children:i}),void 0),P.jsx("div",{className:"msp-toast-clear"},void 0),P.jsx("div",E({className:"msp-toast-hide"},{children:P.jsx(Gt,{svg:RZ,onClick:this.hide,title:"Hide",className:"msp-no-hover-outline"},void 0)}),void 0)]}),void 0)},t}(br),clt=function(e){Le(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.managers.toast.events.changed,function(){return r.forceUpdate()})},t.prototype.render=function(){var r=this.plugin.managers.toast.state;if(!r.entries.count())return null;var n=[];return r.entries.forEach(function(i,a){return n.push(i)}),n.sort(function(i,a){return i.serialNumber-a.serialNumber}),P.jsx("div",E({className:"msp-toast-container"},{children:n.map(function(i){return P.jsx(llt,{entry:i},i.serialNumber)})}),void 0)},t}(br),dlt=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.container=_e.createRef(),r.canvas=_e.createRef(),r.state={noWebGl:!1,showLogo:!0},r.handleLogo=function(){var n;r.setState({showLogo:!(!((n=r.plugin.canvas3d)===null||n===void 0)&&n.reprCount.value)})},r}return t.prototype.componentDidMount=function(){if(!this.canvas.current||!this.container.current||!this.plugin.initViewer(this.canvas.current,this.container.current)){this.setState({noWebGl:!0});return}this.handleLogo(),this.subscribe(this.plugin.canvas3d.reprCount,this.handleLogo)},t.prototype.componentWillUnmount=function(){e.prototype.componentWillUnmount.call(this)},t.prototype.renderMissing=function(){if(this.props.noWebGl){var r=this.props.noWebGl;return P.jsx(r,{},void 0)}return P.jsx("div",E({className:"msp-no-webgl"},{children:P.jsxs("div",{children:[P.jsx("p",{children:P.jsx("b",{children:"WebGL does not seem to be available."},void 0)},void 0),P.jsx("p",{children:"This can be caused by an outdated browser, graphics card driver issue, or bad weather. Sometimes, just restarting the browser helps."},void 0),P.jsxs("p",{children:["For a list of supported browsers, refer to ",P.jsx("a",E({href:"http://caniuse.com/#feat=webgl",target:"_blank"},{children:"http://caniuse.com/#feat=webgl"}),void 0),"."]},void 0)]},void 0)}),void 0)},t.prototype.render=function(){if(this.state.noWebGl)return this.renderMissing();var r=this.props.logo;return P.jsxs("div",E({className:this.props.parentClassName||"msp-viewport",style:this.props.parentStyle},{children:[P.jsx("div",E({className:this.props.hostClassName||"msp-viewport-host3d",style:this.props.hostStyle,ref:this.container},{children:P.jsx("canvas",{ref:this.canvas},void 0)}),void 0),this.state.showLogo&&r&&P.jsx(r,{},void 0)]}),void 0)},t}(br);function Wp(e){var t=_e.useState(e==null?void 0:e.value),r=t[0],n=t[1];return _e.useEffect(function(){if(!e){r!==void 0&&n(void 0);return}var i=!0,a=e.subscribe(function(o){i?(i=!1,o!==r&&n(o)):n(o)});return function(){a.unsubscribe()}},[e]),r}var flt=function(e){var t=e.plugin,r=e.cropFrameColor,n=t.helpers.viewportScreenshot,i=_e.useState(null),a=i[0],o=i[1],s=_e.useRef(null),u=_e.useRef(e);return _e.useEffect(function(){u.current=e},Object.values(e)),_e.useEffect(function(){a!==s.current&&o(s.current)}),_e.useEffect(function(){var l,c=!1,d=[];function f(g,y){g&&d.push(g.subscribe(y))}function h(){var g=u.current;!g.suspend&&s.current&&AG(n,s.current,g.customBackground,g.borderColor,g.borderWidth),s.current||(c=!0)}var v=setInterval(function(){c&&(c=!1,h())},1e3/8);f(t.events.canvas3d.settingsUpdated,function(){return c=!0}),f((l=t.canvas3d)===null||l===void 0?void 0:l.didDraw,function(){return c=!0}),f(t.state.data.behaviors.isUpdating,function(g){g||(c=!0)}),f(n.behaviors.values,function(){return c=!0}),f(n.behaviors.cropParams,function(){return c=!0});var p=void 0;typeof ResizeObserver<"u"&&(p=new ResizeObserver(function(){return c=!0}));var m=s.current;return p==null||p.observe(m),h(),function(){clearInterval(v),d.forEach(function(g){return g.unsubscribe()}),p==null||p.unobserve(m)}},[n]),_e.useLayoutEffect(function(){s.current&&AG(n,s.current,e.customBackground,e.borderColor,e.borderWidth)},Nt([],Object.values(e))),P.jsx(P.Fragment,{children:P.jsxs("div",E({style:{position:"relative",width:"100%",height:"100%"}},{children:[P.jsx("canvas",{ref:s,onContextMenu:function(l){l.preventDefault(),l.stopPropagation()},style:{display:"block",width:"100%",height:"100%"}},void 0),P.jsx(plt,{plugin:t,canvas:a,color:r},void 0)]}),void 0)},void 0)},hlt=_e.memo(flt,function(e,t){return T6(e,t)});function AG(e,t,r,n,i){var a=e.getPreview(),o=a.canvas,s=a.width,u=a.height,l=t.getContext("2d");if(l){var c=t.clientWidth,d=t.clientHeight;t.width=c,t.height=d,l.clearRect(0,0,c,d);var f=gae(s,u,c,d);if(r)l.fillStyle=r,l.fillRect(f.x,f.y,f.width,f.height);else if(e.values.transparent)for(var h=13,v=0;v<f.width;v+=h)for(var p=0;p<f.height;p+=h){l.fillStyle=(v+p)%2?"#ffffff":"#bfbfbf";var m=f.x+v,g=f.y+p,y=v+h>f.width?f.width-v:h,b=p+h>f.height?f.height-p:h;l.fillRect(m,g,y,b)}if(l.drawImage(o,f.x,f.y,f.width,f.height),n&&i){var S=i;l.rect(f.x,f.y,f.width,f.height),l.rect(f.x+S,f.y+S,f.width-2*S,f.height-2*S),l.fillStyle=n,l.fill("evenodd")}}}function plt(e){var t,r=e.plugin,n=e.canvas,i=e.color,a=i===void 0?"rgba(255, 87, 45, 0.75)":i,o=r.helpers.viewportScreenshot,s=Wp(o==null?void 0:o.behaviors.values),u=Wp(o==null?void 0:o.behaviors.cropParams),l=Wp(o==null?void 0:o.behaviors.relativeCrop),c=_e.useRef({x:0,y:0,width:0,height:0});Wp((s==null?void 0:s.resolution.name)==="viewport"?(t=r.canvas3d)===null||t===void 0?void 0:t.resized:void 0);var d=_e.useState(""),f=d[0],h=d[1],v=_e.useState([0,0]),p=v[0],m=v[1],g=_e.useState([0,0]),y=g[0],b=g[1];if(!o||!n)return null;var S=o.getSizeAndViewport(),x=S.width,C=S.height,w=gae(x,C,n.clientWidth,n.clientHeight),A={x:w.x+Math.floor(w.width*l.x),y:w.y+Math.floor(w.height*l.y),width:Math.ceil(w.width*l.width),height:Math.ceil(w.height*l.height)},M=PG(A),D=PG(w);if(f==="move"?(M.l+=y[0]-p[0],M.r+=y[0]-p[0],M.t+=y[1]-p[1],M.b+=y[1]-p[1]):f&&(f.indexOf("left")>=0?M.l+=y[0]-p[0]:f.indexOf("right")>=0&&(M.r+=y[0]-p[0]),f.indexOf("top")>=0?M.t+=y[1]-p[1]:f.indexOf("bottom")>=0&&(M.b+=y[1]-p[1])),M.l>M.r){var k=M.l;M.l=M.r,M.r=k}if(M.t>M.b){var k=M.t;M.t=M.b,M.b=k}var R=40;M.l=Math.min(D.r-R,Math.max(D.l,M.l)),M.r=Math.max(D.l+R,Math.min(D.r,M.r)),M.t=Math.min(D.b-R,Math.max(D.t,M.t)),M.b=Math.max(D.t+R,Math.min(D.b,M.b)),A.x=M.l,A.y=M.t,A.width=M.r-M.l+1,A.height=M.b-M.t+1,c.current=A;var O=function(X){X.preventDefault(),b([X.pageX,X.pageY])},H=function(X){X.preventDefault();var U=X.touches[0];b([U.pageX,U.pageY])},B=function(X){X.preventDefault(),h(X.currentTarget.getAttribute("data-drag"));var U=X.touches[0],z=[U.pageX,U.pageY];m(z),b(z),window.addEventListener("touchend",G),window.addEventListener("touchmove",H)},j=function(X){X.preventDefault(),h(X.currentTarget.getAttribute("data-drag"));var U=[X.pageX,X.pageY];m(U),b(U),window.addEventListener("mouseup",Y),window.addEventListener("mousemove",O)},Y=function(){window.removeEventListener("mouseup",Y),window.removeEventListener("mousemove",O),$()},G=function(){window.removeEventListener("touchend",G),window.removeEventListener("touchmove",H),$()};function $(){var X=c.current;u.auto&&(o==null||o.behaviors.cropParams.next(E(E({},u),{auto:!1}))),o==null||o.behaviors.relativeCrop.next({x:(X.x-w.x)/w.width,y:(X.y-w.y)/w.height,width:X.width/w.width,height:X.height/w.height}),h("");var U=[0,0];m(U),b(U)}var q=function(X){X.preventDefault(),X.stopPropagation()},ee=4,fe="3px solid "+a,W="transparent";return P.jsxs(P.Fragment,{children:[P.jsx("div",{"data-drag":"move",style:{position:"absolute",left:A.x,top:A.y,width:A.width,height:A.height,border:fe,cursor:"move"},onMouseDown:j,onTouchStart:B,draggable:!1,onContextMenu:q},void 0),P.jsx("div",{"data-drag":"left",style:{position:"absolute",left:A.x-ee,top:A.y+ee,width:4*ee,height:A.height-ee,background:W,cursor:"w-resize"},onMouseDown:j,onTouchStart:B,draggable:!1,onContextMenu:q},void 0),P.jsx("div",{"data-drag":"right",style:{position:"absolute",left:M.r-2*ee,top:A.y,width:4*ee,height:A.height-ee,background:W,cursor:"w-resize"},onMouseDown:j,onTouchStart:B,draggable:!1,onContextMenu:q},void 0),P.jsx("div",{"data-drag":"top",style:{position:"absolute",left:A.x-ee,top:A.y-ee,width:A.width+2*ee,height:4*ee,background:W,cursor:"n-resize"},onMouseDown:j,onTouchStart:B,draggable:!1,onContextMenu:q},void 0),P.jsx("div",{"data-drag":"bottom",style:{position:"absolute",left:A.x-ee,top:M.b-2*ee,width:A.width+2*ee,height:4*ee,background:W,cursor:"n-resize"},onMouseDown:j,onTouchStart:B,draggable:!1,onContextMenu:q},void 0),P.jsx("div",{"data-drag":"top, left",style:{position:"absolute",left:M.l-ee,top:M.t-ee,width:4*ee,height:4*ee,background:W,cursor:"nw-resize"},onMouseDown:j,onTouchStart:B,draggable:!1,onContextMenu:q},void 0),P.jsx("div",{"data-drag":"bottom, right",style:{position:"absolute",left:M.r-2*ee,top:M.b-2*ee,width:4*ee,height:4*ee,background:W,cursor:"nw-resize"},onMouseDown:j,onTouchStart:B,draggable:!1,onContextMenu:q},void 0),P.jsx("div",{"data-drag":"top, right",style:{position:"absolute",left:M.r-2*ee,top:M.t-ee,width:4*ee,height:4*ee,background:W,cursor:"ne-resize"},onMouseDown:j,onTouchStart:B,draggable:!1,onContextMenu:q},void 0),P.jsx("div",{"data-drag":"bottom, left",style:{position:"absolute",left:M.l-ee,top:M.b-2*ee,width:4*ee,height:4*ee,background:W,cursor:"ne-resize"},onMouseDown:j,onTouchStart:B,draggable:!1,onContextMenu:q},void 0)]},void 0)}function PG(e){return{l:e.x,t:e.y,r:e.x+e.width-1,b:e.y+e.height-1}}function gae(e,t,r,n){var i=e/t,a=r/n;if(i<=a){var o=n*i;return{x:Math.round((r-o)/2),y:0,width:Math.round(o),height:n}}else{var o=r/i;return{x:0,y:Math.round((n-o)/2),width:r,height:Math.round(o)}}}var vlt=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.state={showPreview:!0,isDisabled:!1},r.download=function(){var n;(n=r.plugin.helpers.viewportScreenshot)===null||n===void 0||n.download(),r.props.close()},r.copy=function(){return ce(r,void 0,void 0,function(){var n;return de(this,function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,(n=this.plugin.helpers.viewportScreenshot)===null||n===void 0?void 0:n.copyToClipboard()];case 1:return i.sent(),_t.Toast.Show(this.plugin,{message:"Copied to clipboard.",title:"Screenshot",timeoutMs:1500}),[3,3];case 2:return i.sent(),[2,this.copyImg()];case 3:return[2]}})})},r.copyImg=function(){return ce(r,void 0,void 0,function(){var n,i;return de(this,function(a){switch(a.label){case 0:return[4,(i=this.plugin.helpers.viewportScreenshot)===null||i===void 0?void 0:i.getImageDataUri()];case 1:return n=a.sent(),this.setState({imageData:n}),[2]}})})},r.open=function(n){!n.target.files||!n.target.files[0]||_t.State.Snapshots.OpenFile(r.plugin,{file:n.target.files[0]})},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.state.data.behaviors.isUpdating,function(n){r.setState({isDisabled:n})})},t.prototype.componentWillUnmount=function(){this.setState({imageData:void 0})},t.prototype.render=function(){var r=this,n,i=!!(!((n=navigator.clipboard)===null||n===void 0)&&n.write);return P.jsxs("div",{children:[this.state.showPreview&&P.jsxs("div",E({className:"msp-image-preview"},{children:[P.jsx(hlt,{plugin:this.plugin},void 0),P.jsx(glt,{plugin:this.plugin},void 0)]}),void 0),P.jsxs("div",E({className:"msp-flex-row"},{children:[!this.state.imageData&&P.jsx(yr,E({icon:qDe,onClick:i?this.copy:this.copyImg,disabled:this.state.isDisabled},{children:"Copy"}),void 0),this.state.imageData&&P.jsx(yr,E({onClick:function(){return r.setState({imageData:void 0})},disabled:this.state.isDisabled},{children:"Clear"}),void 0),P.jsx(yr,E({icon:aD,onClick:this.download,disabled:this.state.isDisabled},{children:"Download"}),void 0)]}),void 0),this.state.imageData&&P.jsxs("div",E({className:"msp-row msp-copy-image-wrapper"},{children:[P.jsx("div",{children:"Right click below + Copy Image"},void 0),P.jsx("img",{src:this.state.imageData,style:{width:"100%",height:32,display:"block"}},void 0)]}),void 0),P.jsx(mlt,{plugin:this.plugin,isDisabled:this.state.isDisabled},void 0),P.jsxs(qu,E({header:"State"},{children:[P.jsx(lae,{onAction:this.props.close},void 0),P.jsx(qu,E({header:"Save Options",initiallyExpanded:!1,noOffset:!0},{children:P.jsx(cae,{},void 0)}),void 0)]}),void 0)]},void 0)},t}(br);function mlt(e){var t=e.plugin,r=e.isDisabled,n=t.helpers.viewportScreenshot,i=Wp(n.behaviors.values);return P.jsx(Vn,{params:n.params,values:i,onChangeValues:function(a){return n.behaviors.values.next(a)},isDisabled:r},void 0)}function glt(e){var t=e.plugin,r=t.helpers.viewportScreenshot,n=Wp(r==null?void 0:r.behaviors.cropParams);return Wp(r==null?void 0:r.behaviors.relativeCrop),r?P.jsxs("div",E({style:{width:"100%",height:"24px",marginTop:"8px"}},{children:[P.jsx(Fi,{icon:QDe,title:"Auto-crop",inline:!0,isSelected:n.auto,style:{background:"transparent",float:"left",width:"auto",height:"24px",lineHeight:"24px"},toggle:function(){return r.toggleAutocrop()},label:"Auto-crop "+(n.auto?"On":"Off")},void 0),!n.auto&&P.jsx(yr,{icon:WDe,title:"Crop",style:{background:"transparent",float:"right",height:"24px",lineHeight:"24px",width:"24px",padding:"0"},onClick:function(){return r.autocrop()}},void 0),!n.auto&&!r.isFullFrame&&P.jsx(yr,{icon:YDe,title:"Reset Crop",style:{background:"transparent",float:"right",height:"24px",lineHeight:"24px",width:"24px",padding:"0"},onClick:function(){return r.resetCrop()}},void 0)]}),void 0):null}function ylt(e){return function(t){var r=t.values,n=t.update,i=t.apply;return{params:typeof e.params=="function"?e.params:function(a){return e.params},getTarget:e.target,getValues:r,update:function(a,o){var s=e.target(o);return Iv(s,function(u){return n(a,u,o)})},apply:i||function(){}}}}var blt=function(e){Le(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.events.canvas3d.settingsUpdated,function(){return r.forceUpdate()}),this.subscribe(this.plugin.canvas3d.camera.stateChanged,function(n){(n.radiusMax!==void 0||n.radius!==void 0)&&r.forceUpdate()})},t.prototype.render=function(){return this.plugin.canvas3d?P.jsxs(P.Fragment,{children:[P.jsx(Wit,{mapping:Slt},void 0),P.jsx(eL,{},void 0)]},void 0):null},t}(br),MC={sequence:"Sequence",log:"Log",left:"Left Panel"},xlt={spin:I.Group({spin:ks.trackball.params.spin,speed:ks.trackball.params.spinSpeed},{pivot:"spin"}),camera:ks.camera,background:I.Group({color:I.Color(at(16579577),{label:"Background",description:"Custom background color"}),transparent:I.Boolean(!1)},{pivot:"color"}),lighting:I.Group({renderStyle:ks.renderer.params.style,occlusion:ks.postprocessing.params.occlusion,outline:ks.postprocessing.params.outline,fog:ks.cameraFog},{pivot:"renderStyle"}),clipping:I.Group(E(E({},ks.cameraClipping.params),ks.renderer.params.clip.params),{pivot:"radius"}),layout:I.MultiSelect([],I.objectToOptions(MC))},Slt=ylt({params:function(e){var t,r=I.clone(xlt),n=(t=e.spec.components)===null||t===void 0?void 0:t.controls;if(n){var i=[];n.top!=="none"&&i.push(["sequence",MC.sequence]),n.bottom!=="none"&&i.push(["log",MC.log]),n.left!=="none"&&i.push(["left",MC.left]),r.layout.options=i}return r},target:function(e){var t,r,n=(t=e.spec.components)===null||t===void 0?void 0:t.controls,i=e.layout.state.regionState,a=[];return i.top!=="hidden"&&(!n||n.top!=="none")&&a.push("sequence"),i.bottom!=="hidden"&&(!n||n.bottom!=="none")&&a.push("log"),i.left!=="hidden"&&(!n||n.left!=="none")&&a.push("left"),{canvas:(r=e.canvas3d)===null||r===void 0?void 0:r.props,layout:a}}})({values:function(e,t){var r=e.canvas,n=r.renderer;return{layout:e.layout,spin:{spin:!!r.trackball.spin,speed:r.trackball.spinSpeed},camera:r.camera,background:{color:n.backgroundColor,transparent:r.transparentBackground},lighting:{renderStyle:n.style,occlusion:r.postprocessing.occlusion,outline:r.postprocessing.outline,fog:r.cameraFog},clipping:E(E({},r.cameraClipping),r.renderer.clip)}},update:function(e,t){var r=t.canvas;r.trackball.spin=e.spin.spin,r.trackball.spinSpeed=e.spin.speed,r.camera=e.camera,r.transparentBackground=e.background.transparent,r.renderer.backgroundColor=e.background.color,r.renderer.style=e.lighting.renderStyle,r.postprocessing.occlusion=e.lighting.occlusion,r.postprocessing.outline=e.lighting.outline,r.cameraFog=e.lighting.fog,r.cameraClipping={radius:e.clipping.radius,far:e.clipping.far},r.renderer.clip={variant:e.clipping.variant,objects:e.clipping.objects},t.layout=e.layout},apply:function(e,t){return ce(this,void 0,void 0,function(){var r,n;return de(this,function(i){switch(i.label){case 0:return[4,_t.Canvas3D.SetSettings(t,{settings:e.canvas})];case 1:return i.sent(),r=e.layout.indexOf("left")<0,n=Iv(t.layout.state,function(a){a.regionState.top=e.layout.indexOf("sequence")>=0?"full":"hidden",a.regionState.bottom=e.layout.indexOf("log")>=0?"full":"hidden",a.regionState.left=r?"hidden":t.behaviors.layout.leftPanelTabName.value==="none"?"collapsed":"full"}),[4,_t.Layout.Update(t,{state:n})];case 2:return i.sent(),r&&_t.State.SetCurrentObject(t,{state:t.state.data,ref:fr.RootRef}),[2]}})})}}),Clt=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.allCollapsedState={isSettingsExpanded:!1,isScreenshotExpanded:!1},r.state=E({},r.allCollapsedState),r.resetCamera=function(){_t.Camera.Reset(r.plugin,{})},r.toggleSettingsExpanded=r.toggle("isSettingsExpanded"),r.toggleScreenshotExpanded=r.toggle("isScreenshotExpanded"),r.toggleControls=function(){_t.Layout.Update(r.plugin,{state:{showControls:!r.plugin.layout.state.showControls}})},r.toggleExpanded=function(){_t.Layout.Update(r.plugin,{state:{isExpanded:!r.plugin.layout.state.isExpanded}})},r.setSettings=function(n){var i;_t.Canvas3D.SetSettings(r.plugin,{settings:(i={},i[n.name]=n.value,i)})},r.setLayout=function(n){var i;_t.Layout.Update(r.plugin,{state:(i={},i[n.name]=n.value,i)})},r.screenshot=function(){var n;(n=r.plugin.helpers.viewportScreenshot)===null||n===void 0||n.download()},r.onMouseMove=function(n){n.buttons===0&&n.stopPropagation()},r}return t.prototype.toggle=function(r){var n=this;return function(i){var a;n.setState(E(E({},n.allCollapsedState),(a={},a[r]=!n.state[r],a))),i==null||i.currentTarget.blur()}},t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.events.canvas3d.settingsUpdated,function(){return r.forceUpdate()}),this.subscribe(this.plugin.layout.events.updated,function(){return r.forceUpdate()})},t.prototype.icon=function(r,n,i,a){return a===void 0&&(a=!0),P.jsx(Gt,{svg:r,toggleState:a,onClick:n,title:i,style:{background:"transparent"}},void 0)},t.prototype.render=function(){return P.jsxs("div",E({className:"msp-viewport-controls",onMouseMove:this.onMouseMove},{children:[P.jsxs("div",E({className:"msp-viewport-controls-buttons"},{children:[P.jsxs("div",{children:[P.jsx("div",{className:"msp-semi-transparent-background"},void 0),this.icon(SDe,this.resetCamera,"Reset Camera")]},void 0),P.jsxs("div",{children:[P.jsx("div",{className:"msp-semi-transparent-background"},void 0),this.icon(MDe,this.toggleScreenshotExpanded,"Screenshot / State Snapshot",this.state.isScreenshotExpanded)]},void 0),P.jsxs("div",{children:[P.jsx("div",{className:"msp-semi-transparent-background"},void 0),this.plugin.config.get(Zr.Viewport.ShowControls)&&this.icon(ADe,this.toggleControls,"Toggle Controls Panel",this.plugin.layout.state.showControls),this.plugin.config.get(Zr.Viewport.ShowExpand)&&this.icon(nRe,this.toggleExpanded,"Toggle Expanded Viewport",this.plugin.layout.state.isExpanded),this.plugin.config.get(Zr.Viewport.ShowSettings)&&this.icon(Pv,this.toggleSettingsExpanded,"Settings / Controls Info",this.state.isSettingsExpanded)]},void 0),this.plugin.config.get(Zr.Viewport.ShowSelectionMode)&&P.jsxs("div",{children:[P.jsx("div",{className:"msp-semi-transparent-background"},void 0),P.jsx(Zw,{},void 0)]},void 0)]}),void 0),this.state.isScreenshotExpanded&&P.jsx("div",E({className:"msp-viewport-controls-panel"},{children:P.jsx(zc,E({header:"Screenshot / State",title:"Click to close.",initialExpanded:!0,hideExpander:!0,hideOffset:!0,onHeaderClick:this.toggleScreenshotExpanded,topRightIcon:jc,noTopMargin:!0,childrenClassName:"msp-viewport-controls-panel-controls"},{children:P.jsx(vlt,{close:this.toggleScreenshotExpanded},void 0)}),void 0)}),void 0),this.state.isSettingsExpanded&&P.jsx("div",E({className:"msp-viewport-controls-panel"},{children:P.jsx(zc,E({header:"Settings / Controls Info",title:"Click to close.",initialExpanded:!0,hideExpander:!0,hideOffset:!0,onHeaderClick:this.toggleSettingsExpanded,topRightIcon:jc,noTopMargin:!0,childrenClassName:"msp-viewport-controls-panel-controls"},{children:P.jsx(blt,{},void 0)}),void 0)}),void 0)]}),void 0)},t}(br),_lt=function(){return P.jsx("a",{className:"msp-logo",href:"https://molstar.org",target:"_blank"},void 0)},wlt=function(){return P.jsx(dlt,{logo:_lt},void 0)},Elt=function(e){Le(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.region=function(r,n){return P.jsx("div",E({className:"msp-layout-region msp-layout-"+r},{children:P.jsx("div",E({className:"msp-layout-static"},{children:n}),void 0)}),void 0)},t.prototype.render=function(){return P.jsx(FE.Provider,E({value:this.props.plugin},{children:P.jsx(Alt,{},void 0)}),void 0)},t}(_e.Component);(function(e){Le(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.render=function(){return P.jsx(FE.Provider,E({value:this.props.plugin},{children:P.jsx("div",E({className:"msp-plugin"},{children:this.props.children}),void 0)}),void 0)},t})(_e.Component);var Alt=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.onDrop=function(n){n.preventDefault();var i;if(n.dataTransfer.items){for(var a=0;a<n.dataTransfer.items.length;a++)if(n.dataTransfer.items[a].kind==="file"){i=n.dataTransfer.items[a].getAsFile();break}}else i=n.dataTransfer.files[0];if(i){var o=(i==null?void 0:i.name.toLowerCase())||"";(o.endsWith("molx")||o.endsWith("molj"))&&_t.State.Snapshots.OpenFile(r.plugin,{file:i})}},r.onDragOver=function(n){n.preventDefault()},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.layout.events.updated,function(){return r.forceUpdate()})},t.prototype.region=function(r,n){return P.jsx("div",E({className:"msp-layout-region msp-layout-"+r},{children:P.jsx("div",E({className:"msp-layout-static"},{children:n?P.jsx(n,{},void 0):null}),void 0)}),void 0)},Object.defineProperty(t.prototype,"layoutVisibilityClassName",{get:function(){var r,n,i=this.plugin.layout.state,a=(n=(r=this.plugin.spec.components)===null||r===void 0?void 0:r.controls)!==null&&n!==void 0?n:{},o=[];return(a.top==="none"||!i.showControls||i.regionState.top==="hidden")&&o.push("msp-layout-hide-top"),a.left==="none"||!i.showControls||i.regionState.left==="hidden"?o.push("msp-layout-hide-left"):i.regionState.left==="collapsed"&&o.push("msp-layout-collapse-left"),(a.right==="none"||!i.showControls||i.regionState.right==="hidden")&&o.push("msp-layout-hide-right"),(a.bottom==="none"||!i.showControls||i.regionState.bottom==="hidden")&&o.push("msp-layout-hide-bottom"),o.join(" ")},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"layoutClassName",{get:function(){var r=this.plugin.layout.state,n=["msp-plugin-content"];return r.isExpanded?n.push("msp-layout-expanded"):n.push("msp-layout-standard","msp-layout-standard-"+r.controlsDisplay),n.join(" ")},enumerable:!1,configurable:!0}),t.prototype.render=function(){var r,n,i,a,o=this.plugin.layout.state,s=((r=this.plugin.spec.components)===null||r===void 0?void 0:r.controls)||{},u=((i=(n=this.plugin.spec.components)===null||n===void 0?void 0:n.viewport)===null||i===void 0?void 0:i.view)||Tlt;return P.jsx("div",E({className:"msp-plugin",onDrop:this.onDrop,onDragOver:this.onDragOver},{children:P.jsxs("div",E({className:this.layoutClassName},{children:[P.jsxs("div",E({className:this.layoutVisibilityClassName},{children:[this.region("main",u),o.showControls&&s.top!=="none"&&this.region("top",s.top||alt),o.showControls&&s.left!=="none"&&this.region("left",s.left||Xut),o.showControls&&s.right!=="none"&&this.region("right",s.right||Plt),o.showControls&&s.bottom!=="none"&&this.region("bottom",s.bottom||Ilt)]}),void 0),!(!((a=this.plugin.spec.components)===null||a===void 0)&&a.hideTaskOverlay)&&P.jsx(ult,{},void 0)]}),void 0)}),void 0)},t}(br),Plt=function(e){Le(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.render=function(){var r,n=((r=this.plugin.spec.components)===null||r===void 0?void 0:r.structureTools)||Out;return P.jsx("div",E({className:"msp-scrollable-container"},{children:P.jsx(n,{},void 0)}),void 0)},t}(br),Tlt=function(e){Le(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.render=function(){var r,n,i=((n=(r=this.plugin.spec.components)===null||r===void 0?void 0:r.viewport)===null||n===void 0?void 0:n.controls)||Clt;return P.jsxs(P.Fragment,{children:[P.jsx(wlt,{},void 0),P.jsxs("div",E({className:"msp-viewport-top-left-controls"},{children:[P.jsx(Mut,{},void 0),P.jsx(Tut,{},void 0),P.jsx(Iut,{},void 0)]}),void 0),P.jsx(Dut,{},void 0),P.jsx(i,{},void 0),P.jsx(slt,{},void 0),P.jsxs("div",E({className:"msp-highlight-toast-wrapper"},{children:[P.jsx(Rut,{},void 0),P.jsx(clt,{},void 0)]}),void 0)]},void 0)},t}(br),Ilt=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.wrapper=_e.createRef(),r.state={entries:r.plugin.log.entries},r}return t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.events.log,function(){return r.setState({entries:r.plugin.log.entries})})},t.prototype.componentDidUpdate=function(){this.scrollToBottom()},t.prototype.scrollToBottom=function(){var r=this.wrapper.current;r&&(r.scrollTop=r.scrollHeight-r.clientHeight-1)},t.prototype.render=function(){for(var r=10,n=this.state.entries,i=n.size,a=[],o=Math.max(0,i-r),s=0;o<i;o++){var u=n.get(o);a.push(P.jsxs("li",{children:[P.jsx("div",{className:"msp-log-entry-badge msp-log-entry-"+u.type},void 0),P.jsx("div",E({className:"msp-log-timestamp"},{children:$Ie(u.timestamp)}),void 0),P.jsx("div",E({className:"msp-log-entry"},{children:u.message}),void 0)]},s++))}return P.jsx("div",E({ref:this.wrapper,className:"msp-log",style:{position:"absolute",top:"0",right:"0",bottom:"0",left:"0",overflowY:"auto"}},{children:P.jsx("ul",E({className:"msp-list-unstyled"},{children:a}),void 0)}),void 0)},t}(br);function Mlt(e,t,r,n){n===void 0&&(n=1),e.width=Math.round(window.devicePixelRatio*n*t),e.height=Math.round(window.devicePixelRatio*n*r),Object.assign(e.style,{width:t+"px",height:r+"px"})}function Dlt(e,t,r){r===void 0&&(r=1);var n=window.innerWidth,i=window.innerHeight;t!==document.body&&(n=t.offsetWidth,i=t.offsetHeight),Mlt(e,n,i,r)}function Rlt(e,t,r,n){for(var i=atob(e.toDataURL(r,n).split(",")[1]),a=i.length,o=a>>2,s=new Uint8Array(a),u=new Uint32Array(s.buffer,0,o),l=0,c=0;c<o;++c)u[c]=i.charCodeAt(l++)|i.charCodeAt(l++)<<8|i.charCodeAt(l++)<<16|i.charCodeAt(l++)<<24;for(var d=a&3;d--;)s[l]=i.charCodeAt(l++);t(new Blob([s],{type:r||"image/png"}))}function TG(e,t,r){return ce(this,void 0,void 0,function(){return de(this,function(n){return[2,new Promise(function(i,a){var o=function(s){s?i(s):a("no blob returned")};HTMLCanvasElement.prototype.toBlob?e.toBlob(o,t,r):Rlt(e,o,t,r)})]})})}var s3;(function(e){var t=function(){function r(){this.providers=ci.OrderedMap().asMutable(),this.defaultAutoAttachValues=new Map}return r.prototype.getParams=function(n){var i={},a=[],o=[];if(n)for(var s=this.providers.values();;){var u=s.next();if(u.done)break;var l=u.value;l.isApplicable(n)&&(l.isHidden||(a.push([l.descriptor.name,l.label]),this.defaultAutoAttachValues.get(l.descriptor.name)&&o.push(l.descriptor.name)),i[l.descriptor.name]=I.Group(E({},l.getParams(n)),{label:l.label,isHidden:l.isHidden}))}return{autoAttach:I.MultiSelect(o,a),properties:I.Group(i,{isFlat:!0})}},r.prototype.setDefaultAutoAttach=function(n,i){this.defaultAutoAttachValues.set(n,i)},r.prototype.get=function(n){var i=this.providers.get(n);if(!i)throw new Error("Custom property '"+n+"' is not registered.");return this.providers.get(n)},r.prototype.register=function(n,i){this.providers.set(n.descriptor.name,n),this.defaultAutoAttachValues.set(n.descriptor.name,i)},r.prototype.unregister=function(n){this.providers.delete(n),this.defaultAutoAttachValues.delete(n)},r}();e.Registry=t})(s3||(s3={}));var klt=["gz","zip"],Olt=["bcif","ccp4","dcd"];function vL(e){var t,r,n="";e instanceof File?t=e.name:e instanceof Blob?t="":t=e;var i=t.lastIndexOf("?"),a=i!==-1?t.substring(i):"";t=t.substring(0,i===-1?t.length:i);var o=t.replace(/^.*[\\/]/,""),s=o.substring(0,o.lastIndexOf(".")),u=o.split("."),l=u.length>1?(u.pop()||"").toLowerCase():"",c=t.match(/^(.+):\/\/(.+)$/);c&&(n=c[1].toLowerCase(),t=c[2]||"");var d=t.substring(0,t.lastIndexOf("/")+1);if(klt.includes(l)){r=l;var f=t.length-l.length-1;l=(t.substr(0,f).split(".").pop()||"").toLowerCase();var h=s.length-l.length-1;s=s.substr(0,h)}else r=!1;var v=Olt.includes(l);return{path:t,name:o,ext:l,base:s,dir:d,compressed:r,binary:v,protocol:n,query:a,src:e}}var Flt=function(){function e(t){this.plugin=t}return Object.defineProperty(e.prototype,"dataState",{get:function(){return this.plugin.state.data},enumerable:!1,configurable:!0}),e.prototype.rawData=function(t,r){var n=this.dataState.build().toRoot().apply(zee,t,r);return n.commit({revertOnError:!0})},e.prototype.download=function(t,r){var n=this.dataState.build().toRoot().apply(Uee,t,r);return n.commit({revertOnError:!0})},e.prototype.downloadBlob=function(t,r){var n=this.dataState.build().toRoot().apply(jee,t,r);return n.commit({revertOnError:!0})},e.prototype.readFile=function(t,r){var n;return ce(this,void 0,void 0,function(){var i,a;return de(this,function(o){switch(o.label){case 0:return[4,this.dataState.build().toRoot().apply(Vee,t,r).commit({revertOnError:!0})];case 1:return i=o.sent(),a=vL(((n=t.file)===null||n===void 0?void 0:n.file)||""),[2,{data:i,fileInfo:a}]}})})},e}(),Llt=function(){function e(t){var r=this;this.plugin=t,this._providers=[],this.providerMap=new Map,this.defaultProvider=zg.auto,$u(zg,function(n){return r.registerPreset(n)})}return Object.defineProperty(e.prototype,"dataState",{get:function(){return this.plugin.state.data},enumerable:!1,configurable:!0}),e.prototype.resolveProvider=function(t){var r;return typeof t=="string"?(r=zg[t])!==null&&r!==void 0?r:_6(this._providers,function(n){return n.id===t}):t},e.prototype.hasPreset=function(t){for(var r=0,n=this._providers;r<n.length;r++){var i=n[r];if(!i.isApplicable||i.isApplicable(t,this.plugin))return!0}return!1},Object.defineProperty(e.prototype,"providers",{get:function(){return this._providers},enumerable:!1,configurable:!0}),e.prototype.getPresets=function(t){if(!t)return this.providers;for(var r=[],n=0,i=this._providers;n<i.length;n++){var a=i[n];a.isApplicable&&!a.isApplicable(t,this.plugin)||r.push(a)}return r},e.prototype.getPresetSelect=function(t){for(var r=[],n=0,i=this._providers;n<i.length;n++){var a=i[n];t&&a.isApplicable&&!a.isApplicable(t,this.plugin)||r.push([a.id,a.display.name,a.display.group])}return I.Select("auto",r)},e.prototype.getPresetsWithOptions=function(t){for(var r=[],n=Object.create(null),i=0,a=this._providers;i<a.length;i++){var o=a[i];o.isApplicable&&!o.isApplicable(t,this.plugin)||(r.push([o.id,o.display.name]),n[o.id]=o.params?I.Group(o.params(t,this.plugin)):I.EmptyGroup())}return r.length===0?I.MappedStatic("",{"":I.EmptyGroup()}):I.MappedStatic(r[0][0],n,{options:r})},e.prototype.registerPreset=function(t){if(this.providerMap.has(t.id))throw new Error("Representation provider with id '"+t.id+"' already registered.");this._providers.push(t),this.providerMap.set(t.id,t)},e.prototype.unregisterPreset=function(t){this.providerMap.delete(t.id),Ub(this._providers,t)},e.prototype.applyPreset=function(t,r,n){var i=this,a,o=this.resolveProvider(r);if(o){var s=this.plugin.state.data,u=ji.resolveAndCheck(s,t);if(!u){j0||console.warn("Applying structure repr. provider to bad cell.");return}var l=((a=o.params)===null||a===void 0?void 0:a.call(o,u.obj,this.plugin))||{},c=n||(o.params?I.getDefaultValues(l):{}),d=this.plugin.config.get(Zr.Structure.DefaultRepresentationPresetParams);c=I.merge(l,d,c);var f=$e.create(""+o.display.name,function(){return o.apply(u,c,i.plugin)});return this.plugin.runTask(f)}},e.prototype.addRepresentation=function(t,r,n){return ce(this,void 0,void 0,function(){var i,a;return de(this,function(o){switch(o.label){case 0:return i=this.dataState.build(),a=this.buildRepresentation(i,t,r,n),a?[4,i.commit()]:[2];case 1:return o.sent(),[2,a]}})})},e.prototype.buildRepresentation=function(t,r,n,i){var a,o;if(r){var s=(o=(a=ji.resolveAndCheck(this.dataState,r))===null||a===void 0?void 0:a.obj)===null||o===void 0?void 0:o.data;if(s){var u=PC(this.plugin,s,n);return i!=null&&i.tag?t.to(r).applyOrUpdateTagged(i.tag,Ow,u,{state:i==null?void 0:i.initialState}).selector:t.to(r).apply(Ow,u,{state:i==null?void 0:i.initialState}).selector}}},e}();function Lh(e){return e}(function(e){e.CommonParams=function(t,r){return{modelProperties:I.Optional(I.Group(ft.getParamDefinition(rt.Model.CustomModelProperties,void 0,r))),structureProperties:I.Optional(I.Group(ft.getParamDefinition(rt.Model.CustomStructureProperties,void 0,r))),representationPreset:I.Optional(I.Text("auto"))}}})(Lh||(Lh={}));var MA=Lh.CommonParams,Nlt=function(e,t){return E({model:I.Optional(I.Group(ft.getParamDefinition(rt.Model.ModelFromTrajectory,e,t))),showUnitcell:I.Optional(I.Boolean(!1)),structure:I.Optional(uv.getParams(void 0,"assembly").type),representationPresetParams:I.Optional(I.Group(lo.CommonParams))},MA(e,t))},yae=Lh({id:"preset-trajectory-default",display:{name:"Default (Assembly)",group:"Preset",description:"Shows the first assembly or, if that is unavailable, the first model."},isApplicable:function(e){return!0},params:Nlt,apply:function(e,t,r){return ce(this,void 0,void 0,function(){var n,i,a,o,s,u,l,c;return de(this,function(d){switch(d.label){case 0:return n=r.builders.structure,[4,n.createModel(e,t.model)];case 1:return i=d.sent(),[4,n.insertModelProperties(i,t.modelProperties)];case 2:return a=d.sent(),[4,n.createStructure(a||i,t.structure)];case 3:return o=d.sent(),[4,n.insertStructureProperties(o,t.structureProperties)];case 4:return s=d.sent(),t.showUnitcell===void 0||t.showUnitcell?[4,n.tryCreateUnitcell(a,void 0,{isHidden:!0})]:[3,6];case 5:return l=d.sent(),[3,7];case 6:l=void 0,d.label=7;case 7:return u=l,[4,r.builders.structure.representation.applyPreset(s,t.representationPreset||"auto",t.representationPresetParams)];case 8:return c=d.sent(),[2,{model:i,modelProperties:a,unitcell:u,structure:o,structureProperties:s,representation:c}]}})})}}),Blt=function(e,t){return E({useDefaultIfSingleModel:I.Optional(I.Boolean(!1)),representationPresetParams:I.Optional(I.Group(lo.CommonParams))},MA(e,t))},Ult=Lh({id:"preset-trajectory-all-models",display:{name:"All Models",group:"Preset",description:"Shows all models; colored by model-index."},isApplicable:function(e){return e.data.frameCount>1},params:Blt,apply:function(e,t,r){var n,i;return ce(this,void 0,void 0,function(){var a,o,s,u,l,c,d,f,h,v;return de(this,function(p){switch(p.label){case 0:if(a=(i=(n=ji.resolveAndCheck(r.state.data,e))===null||n===void 0?void 0:n.obj)===null||i===void 0?void 0:i.data,!a)return[2,{}];if(a.frameCount===1&&t.useDefaultIfSingleModel)return[2,yae.apply(e,t,r)];o=r.builders.structure,s=[],u=[],l=0,p.label=1;case 1:return l<a.frameCount?[4,o.createModel(e,{modelIndex:l})]:[3,8];case 2:return c=p.sent(),[4,o.insertModelProperties(c,t.modelProperties,{isCollapsed:!0})];case 3:return d=p.sent(),[4,o.createStructure(d||c,{name:"model",params:{}})];case 4:return f=p.sent(),[4,o.insertStructureProperties(f,t.structureProperties)];case 5:return h=p.sent(),s.push(c),u.push(f),v=f.obj?Lre(f.obj.data,{elementCountFactor:a.frameCount}):"medium",[4,o.representation.applyPreset(h,t.representationPreset||"auto",{theme:{globalName:"model-index"},quality:v})];case 6:p.sent(),p.label=7;case 7:return l++,[3,1];case 8:return[2,{models:s,structures:u}]}})})}}),bae=function(e,t){return E({model:I.Optional(I.Group(ft.getParamDefinition(rt.Model.ModelFromTrajectory,e,t)))},MA(e,t))};function xae(e,t,r,n){return ce(this,void 0,void 0,function(){var i,a,o,s,u,l,c;return de(this,function(d){switch(d.label){case 0:return i=n.builders.structure,[4,i.createModel(t,r.model)];case 1:return a=d.sent(),[4,i.insertModelProperties(a,r.modelProperties)];case 2:return o=d.sent(),[4,i.createStructure(o||a,{name:"symmetry",params:e})];case 3:return s=d.sent(),[4,i.insertStructureProperties(s,r.structureProperties)];case 4:return u=d.sent(),[4,i.tryCreateUnitcell(o,void 0,{isHidden:!1})];case 5:return l=d.sent(),[4,n.builders.structure.representation.applyPreset(u,r.representationPreset||"auto",{theme:{globalName:e.theme}})];case 6:return c=d.sent(),[2,{model:a,modelProperties:o,unitcell:l,structure:s,structureProperties:u,representation:c}]}})})}var jlt=Lh({id:"preset-trajectory-unitcell",display:{name:"Unit Cell",group:"Preset",description:"Shows the fully populated unit cell."},isApplicable:function(e){return Xt.hasCrystalSymmetry(e.data.representative)},params:bae,apply:function(e,t,r){return ce(this,void 0,void 0,function(){return de(this,function(n){switch(n.label){case 0:return[4,xae({ijkMin:_.create(0,0,0),ijkMax:_.create(0,0,0)},e,t,r)];case 1:return[2,n.sent()]}})})}}),zlt=Lh({id:"preset-trajectory-supercell",display:{name:"Super Cell",group:"Preset",description:"Shows the super cell, i.e. the central unit cell and all adjacent unit cells."},isApplicable:function(e){return Xt.hasCrystalSymmetry(e.data.representative)},params:bae,apply:function(e,t,r){return ce(this,void 0,void 0,function(){return de(this,function(n){switch(n.label){case 0:return[4,xae({ijkMin:_.create(-1,-1,-1),ijkMax:_.create(1,1,1),theme:"operator-hkl"},e,t,r)];case 1:return[2,n.sent()]}})})}}),Vlt=function(e,t){return E({model:I.Optional(I.Group(ft.getParamDefinition(rt.Model.ModelFromTrajectory,e,t)))},MA(e,t))},Hlt=Lh({id:"preset-trajectory-crystal-contacts",display:{name:"Crystal Contacts",group:"Preset",description:"Showsasymetric unit and chains from neighbours within 5 , i.e., symmetry mates."},isApplicable:function(e){return Xt.hasCrystalSymmetry(e.data.representative)},params:Vlt,apply:function(e,t,r){return ce(this,void 0,void 0,function(){var n,i,a,o,s,u,l;return de(this,function(c){switch(c.label){case 0:return n=r.builders.structure,[4,n.createModel(e,t.model)];case 1:return i=c.sent(),[4,n.insertModelProperties(i,t.modelProperties)];case 2:return a=c.sent(),[4,n.createStructure(a||i,{name:"symmetry-mates",params:{radius:5}})];case 3:return o=c.sent(),[4,n.insertStructureProperties(o,t.structureProperties)];case 4:return s=c.sent(),[4,n.tryCreateUnitcell(a,void 0,{isHidden:!0})];case 5:return u=c.sent(),[4,r.builders.structure.representation.applyPreset(s,t.representationPreset||"auto",{theme:{globalName:"operator-name",carbonColor:"operator-name",focus:{name:"element-symbol",params:{carbonColor:{name:"operator-name",params:_F.defaultValues}}}}})];case 6:return l=c.sent(),[2,{model:i,modelProperties:a,unitcell:u,structure:o,structureProperties:s,representation:l}]}})})}}),sI={default:yae,"all-models":Ult,unitcell:jlt,supercell:zlt,crystalContacts:Hlt},Glt=function(){function e(t){var r=this;this.plugin=t,this._providers=[],this.providerMap=new Map,this.defaultProvider=sI.default,$u(sI,function(n){return r.registerPreset(n)})}return e.prototype.resolveProvider=function(t){var r;return typeof t=="string"?(r=sI[t])!==null&&r!==void 0?r:_6(this._providers,function(n){return n.id===t}):t},e.prototype.hasPreset=function(t){for(var r=0,n=this._providers;r<n.length;r++){var i=n[r];if(!i.isApplicable||i.isApplicable(t,this.plugin))return!0}return!1},Object.defineProperty(e.prototype,"providers",{get:function(){return this._providers},enumerable:!1,configurable:!0}),e.prototype.getPresets=function(t){if(!t)return this.providers;for(var r=[],n=0,i=this._providers;n<i.length;n++){var a=i[n];a.isApplicable&&!a.isApplicable(t,this.plugin)||r.push(a)}return r},e.prototype.getPresetSelect=function(t){for(var r=[],n=0,i=this._providers;n<i.length;n++){var a=i[n];t&&a.isApplicable&&!a.isApplicable(t,this.plugin)||r.push([a.id,a.display.name])}return I.Select("auto",r)},e.prototype.getPresetsWithOptions=function(t){for(var r=[],n=Object.create(null),i=0,a=this._providers;i<a.length;i++){var o=a[i];o.isApplicable&&!o.isApplicable(t,this.plugin)||(r.push([o.id,o.display.name]),n[o.id]=o.params?I.Group(o.params(t,this.plugin)):I.EmptyGroup())}return r.length===0?I.MappedStatic("",{"":I.EmptyGroup()}):I.MappedStatic(r[0][0],n,{options:r})},e.prototype.registerPreset=function(t){if(this.providerMap.has(t.id))throw new Error("Hierarchy provider with id '"+t.id+"' already registered.");this._providers.push(t),this.providerMap.set(t.id,t)},e.prototype.unregisterPreset=function(t){this.providerMap.delete(t.id),Ub(this._providers,t)},e.prototype.applyPreset=function(t,r,n){var i=this,a=this.resolveProvider(r);if(a){var o=this.plugin.state.data,s=ji.resolveAndCheck(o,t);if(!s){j0||console.warn("Applying hierarchy preset provider to bad cell.");return}var u=n||(a.params?I.getDefaultValues(a.params(s.obj,this.plugin)):{}),l=$e.create(""+a.display.name,function(){return a.apply(s,u,i.plugin)});return this.plugin.runTask(l)}},e}(),qlt=function(){function e(t){this.plugin=t,this.hierarchy=new Glt(this.plugin),this.representation=new Llt(this.plugin)}return Object.defineProperty(e.prototype,"dataState",{get:function(){return this.plugin.state.data},enumerable:!1,configurable:!0}),e.prototype.parseTrajectoryData=function(t,r){return ce(this,void 0,void 0,function(){var n,i;return de(this,function(a){switch(a.label){case 0:if(n=typeof r=="string"?this.plugin.dataFormats.get(r):r,!n)throw new Error("'"+r+"' is not a supported data format.");return[4,n.parse(this.plugin,t)];case 1:return i=a.sent().trajectory,[2,i]}})})},e.prototype.parseTrajectoryBlob=function(t,r){var n=this.dataState,i=n.build().to(t).apply(rt.Data.ParseBlob,r,{state:{isGhost:!0}}).apply(rt.Model.TrajectoryFromBlob,void 0);return i.commit({revertOnError:!0})},e.prototype.parseTrajectory=function(t,r){var n=ji.resolveAndCheck(this.dataState,t);if(!n)throw new Error("Invalid data cell.");return ge.Data.Blob.is(n.obj)?this.parseTrajectoryBlob(t,r):this.parseTrajectoryData(t,r)},e.prototype.createModel=function(t,r,n){var i=this.dataState,a=i.build().to(t).apply(rt.Model.ModelFromTrajectory,r||{modelIndex:0},{state:n});return a.commit({revertOnError:!0})},e.prototype.insertModelProperties=function(t,r,n){var i=this.dataState,a=i.build().to(t).apply(rt.Model.CustomModelProperties,r,{state:n});return a.commit({revertOnError:!0})},e.prototype.tryCreateUnitcell=function(t,r,n){var i,a,o,s=this.dataState,u=(a=(i=ji.resolveAndCheck(s,t))===null||i===void 0?void 0:i.obj)===null||a===void 0?void 0:a.data;if(u){var l=(o=vi.Provider.get(u))===null||o===void 0?void 0:o.spacegroup.cell;if(!Fo.isZero(l)){var c=s.build().to(t).apply(rt.Representation.ModelUnitcell3D,r,{state:n});return c.commit({revertOnError:!0})}}},e.prototype.createStructure=function(t,r,n){var i,a=this.dataState;if(!r){var o=ji.resolveAndCheck(a,t);if(o){var s=vi.Provider.get((i=o.obj)===null||i===void 0?void 0:i.data);(!s||(s==null?void 0:s.assemblies.length)===0)&&(r={name:"model",params:{}})}}var u=a.build().to(t).apply(rt.Model.StructureFromModel,{type:r||{name:"assembly",params:{}}},{state:n});return u.commit({revertOnError:!0})},e.prototype.insertStructureProperties=function(t,r){var n=this.dataState,i=n.build().to(t).apply(rt.Model.CustomStructureProperties,r);return i.commit({revertOnError:!0})},e.prototype.isComponentTransform=function(t){return t.transform.transformer===rt.Model.StructureComponent},e.prototype.tryCreateComponent=function(t,r,n,i){var a,o;return ce(this,void 0,void 0,function(){var s,u,l,c,d;return de(this,function(f){switch(f.label){case 0:return s=this.dataState,u=s.build().to(t),l="structure-component-"+n,c=u.applyOrUpdateTagged(l,rt.Model.StructureComponent,r,{tags:i?Nt(Nt([],i),[l]):[l]}),[4,c.commit()];case 1:return f.sent(),d=c.selector,!d.isOk||((o=(a=d.cell)===null||a===void 0?void 0:a.obj)===null||o===void 0?void 0:o.data.elementCount)===0?[4,s.build().delete(d.ref).commit()]:[3,3];case 2:return f.sent(),[2];case 3:return[2,d]}})})},e.prototype.tryCreateComponentFromExpression=function(t,r,n,i){return this.tryCreateComponent(t,{type:{name:"expression",params:r},nullIfEmpty:!0,label:((i==null?void 0:i.label)||"").trim()},n,i==null?void 0:i.tags)},e.prototype.tryCreateComponentStatic=function(t,r,n){return this.tryCreateComponent(t,{type:{name:"static",params:r},nullIfEmpty:!0,label:((n==null?void 0:n.label)||"").trim()},"static-"+r,n==null?void 0:n.tags)},e.prototype.tryCreateComponentFromSelection=function(t,r,n,i){var a=this;return this.plugin.runTask($e.create("Query Component",function(o){return ce(a,void 0,void 0,function(){var s,u,l,c,d,f,h,v,p,m,g,y;return de(this,function(b){switch(b.label){case 0:return s=i||{},u=s.label,l=s.tags,u=(u||"").trim(),c=(y=(g=ji.resolveAndCheck(this.dataState,t))===null||g===void 0?void 0:g.obj)===null||y===void 0?void 0:y.data,c?r.referencesCurrent?(p={},m={name:"bundle"},v=(h=on).fromSelection,[4,r.getSelection(this.plugin,o,c)]):[3,2]:[2];case 1:return f=(p.type=(m.params=v.apply(h,[b.sent()]),m),p.nullIfEmpty=!0,p.label=u||r.label,p),[3,3];case 2:f={type:{name:"expression",params:r.expression},nullIfEmpty:!0,label:u||r.label},b.label=3;case 3:return d=f,r.ensureCustomProperties?[4,r.ensureCustomProperties({runtime:o,assetManager:this.plugin.managers.asset},c)]:[3,5];case 4:b.sent(),b.label=5;case 5:return[2,this.tryCreateComponent(t,d,n,l)]}})})}))},e}(),ZR;(function(e){function t(r){var n=r.name;return{descriptor:r,get:function(i){return i._propertyData[n]},set:function(i,a){i.customProperties.add(r),i._propertyData[n]=a}}}e.create=t})(ZR||(ZR={}));var u3;(function(e){e.Descriptor={name:"recommended_iso_value"},e.Provider=ZR.create(e.Descriptor)})(u3||(u3={}));var H2="Volume";function G2(e,t){return ce(this,void 0,void 0,function(){var r,n=this;return de(this,function(i){return t?(r=t.entryId,!r||!r.toLowerCase().startsWith("emd")?[2]:[2,e.runTask($e.create("Try Set Recommended IsoValue",function(a){return ce(n,void 0,void 0,function(){var o;return de(this,function(s){switch(s.label){case 0:return s.trys.push([0,2,,3]),[4,$ie(e,a,r)];case 1:return o=s.sent(),u3.Provider.set(t,Ct.IsoValue.absolute(o)),[3,3];case 2:return s.sent(),[3,3];case 3:return[2]}})})}))]):[2]})})}function Sae(e){var t=u3.Provider.get(e);if(t){if(t.kind==="relative")return t;var r=e.grid.stats;return Mw.is(e.sourceData)&&(r={min:e.sourceData.data.volume_data_3d_info.min_source.value(0),max:e.sourceData.data.volume_data_3d_info.max_source.value(0),mean:e.sourceData.data.volume_data_3d_info.mean_source.value(0),sigma:e.sourceData.data.volume_data_3d_info.sigma_source.value(0)}),Ct.IsoValue.toRelative(t,r)}}function mL(e,t){return ce(this,void 0,void 0,function(){var r,n,i;return de(this,function(a){switch(a.label){case 0:return r={},n=t.volume.data&&Sae(t.volume.data),n&&(r.isoValue=n),i=e.build().to(t.volume).apply(rt.Representation.VolumeRepresentation3D,Hg(e,t.volume.data,{type:"isosurface",typeParams:r})),[4,i.commit()];case 1:return[2,[a.sent()]]}})})}var $lt={label:"CCP4/MRC/MAP",description:"CCP4/MRC/MAP",category:H2,binaryExtensions:["ccp4","mrc","map"],parse:function(e,t,r){return ce(void 0,void 0,void 0,function(){var n,i;return de(this,function(a){switch(a.label){case 0:return n=e.build().to(t).apply(rt.Data.ParseCcp4,{},{state:{isGhost:!0}}),i=n.apply(rt.Volume.VolumeFromCcp4,{entryId:r==null?void 0:r.entryId}),[4,n.commit({revertOnError:!0})];case 1:return a.sent(),[4,G2(e,i.selector.data)];case 2:return a.sent(),[2,{format:n.selector,volume:i.selector}]}})})},visuals:mL},Wlt={label:"DSN6/BRIX",description:"DSN6/BRIX",category:H2,binaryExtensions:["dsn6","brix"],parse:function(e,t,r){return ce(void 0,void 0,void 0,function(){var n,i;return de(this,function(a){switch(a.label){case 0:return n=e.build().to(t).apply(rt.Data.ParseDsn6,{},{state:{isGhost:!0}}),i=n.apply(rt.Volume.VolumeFromDsn6,{entryId:r==null?void 0:r.entryId}),[4,n.commit({revertOnError:!0})];case 1:return a.sent(),[4,G2(e,i.selector.data)];case 2:return a.sent(),[2,{format:n.selector,volume:i.selector}]}})})},visuals:mL},Xlt={label:"DX",description:"DX",category:H2,stringExtensions:["dx"],binaryExtensions:["dxbin"],parse:function(e,t,r){return ce(void 0,void 0,void 0,function(){var n,i;return de(this,function(a){switch(a.label){case 0:return n=e.build().to(t).apply(rt.Data.ParseDx,{},{state:{isGhost:!0}}),i=n.apply(rt.Volume.VolumeFromDx,{entryId:r==null?void 0:r.entryId}),[4,i.commit({revertOnError:!0})];case 1:return a.sent(),[4,G2(e,i.selector.data)];case 2:return a.sent(),[2,{volume:i.selector}]}})})},visuals:mL},Ylt={label:"Cube",description:"Cube",category:H2,stringExtensions:["cub","cube"],parse:function(e,t,r){return ce(void 0,void 0,void 0,function(){var n,i,a;return de(this,function(o){switch(o.label){case 0:return n=e.build().to(t).apply(rt.Data.ParseCube,{},{state:{isGhost:!0}}),i=n.apply(rt.Volume.VolumeFromCube,{entryId:r==null?void 0:r.entryId}),a=n.apply(rt.Model.TrajectoryFromCube,void 0,{state:{isGhost:!0}}).apply(rt.Model.ModelFromTrajectory).apply(rt.Model.StructureFromModel),[4,n.commit({revertOnError:!0})];case 1:return o.sent(),[4,G2(e,i.selector.data)];case 2:return o.sent(),[2,{format:n.selector,volume:i.selector,structure:a.selector}]}})})},visuals:function(e,t){return ce(void 0,void 0,void 0,function(){var r,n,i,a,o,s,u,l,c,d;return de(this,function(f){switch(f.label){case 0:return r=e.build(),n=[],i=(d=(c=t.volume.cell)===null||c===void 0?void 0:c.obj)===null||d===void 0?void 0:d.data,i&&Ct.isOrbitals(i)?(a=r.to(t.volume).apply(rt.Representation.VolumeRepresentation3D,Hg(e,i,{type:"isosurface",typeParams:{isoValue:Ct.IsoValue.relative(1),alpha:.4},color:"uniform",colorParams:{value:pr.blue}})),o=r.to(t.volume).apply(rt.Representation.VolumeRepresentation3D,Hg(e,i,{type:"isosurface",typeParams:{isoValue:Ct.IsoValue.relative(-1),alpha:.4},color:"uniform",colorParams:{value:pr.red}})),n.push(a.selector,o.selector)):(s=r.to(t.volume).apply(rt.Representation.VolumeRepresentation3D,Hg(e,i,{type:"isosurface",typeParams:{isoValue:Ct.IsoValue.relative(2),alpha:.4},color:"uniform",colorParams:{value:pr.grey}})),n.push(s.selector)),[4,e.builders.structure.representation.applyPreset(t.structure,"auto")];case 1:return u=f.sent(),[4,r.commit()];case 2:return f.sent(),l=[],$u(u==null?void 0:u.representations,function(h){h&&l.push(h)}),[2,Nt(Nt([],n),l)]}})})}},Klt={label:"DensityServer CIF",description:"DensityServer CIF",category:H2,stringExtensions:["cif"],binaryExtensions:["bcif"],isApplicable:function(e,t){return $F(e,t)==="dscif"},parse:function(e,t,r){return ce(void 0,void 0,void 0,function(){var n,i,a,o,s,u,l,c,d,f,h,v;return de(this,function(p){switch(p.label){case 0:return[4,e.build().to(t).apply(rt.Data.ParseCif).commit()];case 1:if(n=p.sent(),i=e.build().to(n),a=n.obj.data.blocks.slice(1),a.length!==1&&a.length!==2)throw new Error("unknown number of blocks");for(o=[],s=0,u=0,l=a;u<l.length;u++)c=l[u],d=Array.isArray(r==null?void 0:r.entryId)?r==null?void 0:r.entryId[s]:r==null?void 0:r.entryId,o.push(i.apply(rt.Volume.VolumeFromDensityServerCif,{blockHeader:c.header,entryId:d}).selector),s++;return[4,i.commit()];case 2:p.sent(),f=0,h=o,p.label=3;case 3:return f<h.length?(v=h[f],[4,G2(e,v.data)]):[3,6];case 4:p.sent(),p.label=5;case 5:return f++,[3,3];case 6:return[2,{volumes:o}]}})})},visuals:function(e,t){return ce(void 0,void 0,void 0,function(){var r,n,i,a,o,s;return de(this,function(u){switch(u.label){case 0:return r=t.volumes,n=e.build(),i=[],r.length>0&&(a=r[0].data&&Sae(r[0].data)||Ct.IsoValue.relative(1.5),i[0]=n.to(r[0]).apply(rt.Representation.VolumeRepresentation3D,Zc.getDefaultParamsStatic(e,"isosurface",{isoValue:a,alpha:1},"uniform",{value:pr.teal})).selector),r.length>1&&(o=Zc.getDefaultParamsStatic(e,"isosurface",{isoValue:Ct.IsoValue.relative(3),alpha:.3},"uniform",{value:pr.green}),s=Zc.getDefaultParamsStatic(e,"isosurface",{isoValue:Ct.IsoValue.relative(-3),alpha:.3},"uniform",{value:pr.red}),i[i.length]=n.to(r[1]).apply(rt.Representation.VolumeRepresentation3D,o).selector,i[i.length]=n.to(r[1]).apply(rt.Representation.VolumeRepresentation3D,s).selector),[4,n.commit()];case 1:return u.sent(),[2,i]}})})}},Qlt=[["ccp4",$lt],["dsn6",Wlt],["cube",Ylt],["dx",Xlt],["dscif",Klt]],Zlt="Shape",Jlt={label:"PLY",description:"PLY",category:Zlt,stringExtensions:["ply"],parse:function(e,t){return ce(void 0,void 0,void 0,function(){var r,n;return de(this,function(i){switch(i.label){case 0:return r=e.state.data.build().to(t).apply(rt.Data.ParsePly,{},{state:{isGhost:!0}}),n=r.apply(rt.Model.ShapeFromPly),[4,r.commit()];case 1:return i.sent(),[2,{format:r.selector,shape:n.selector}]}})})},visuals:function(e,t){var r=e.state.data.build().to(t.shape).apply(rt.Representation.ShapeRepresentation3D);return r.commit()}},ect=[["ply",Jlt]],gL="Structure",tct={label:"PSF",description:"PSF",category:gL,stringExtensions:["psf"],parse:function(e,t){return ce(void 0,void 0,void 0,function(){var r,n;return de(this,function(i){switch(i.label){case 0:return r=e.state.data.build().to(t).apply(rt.Data.ParsePsf,{},{state:{isGhost:!0}}),n=r.apply(rt.Model.TopologyFromPsf),[4,r.commit()];case 1:return i.sent(),[2,{format:r.selector,topology:n.selector}]}})})}},rct={label:"DCD",description:"DCD",category:gL,binaryExtensions:["dcd"],parse:function(e,t){var r=e.state.data.build().to(t).apply(rt.Model.CoordinatesFromDcd);return r.commit()}},nct={label:"XTC",description:"XTC",category:gL,binaryExtensions:["xtc"],parse:function(e,t){var r=e.state.data.build().to(t).apply(rt.Model.CoordinatesFromXtc);return r.commit()}},ict=[["psf",tct],["dcd",rct],["xtc",nct]],act=function(){function e(){this._list=[],this._map=new Map,this._extensions=void 0,this._binaryExtensions=void 0,this._options=void 0;for(var t=0,r=Qlt;t<r.length;t++){var n=r[t],i=n[0],a=n[1];this.add(i,a)}for(var o=0,s=ict;o<s.length;o++){var u=s[o],i=u[0],a=u[1];this.add(i,a)}for(var l=0,c=ect;l<c.length;l++){var d=c[l],i=d[0],a=d[1];this.add(i,a)}for(var f=0,h=Tie;f<h.length;f++){var v=h[f],i=v[0],a=v[1];this.add(i,a)}}return Object.defineProperty(e.prototype,"types",{get:function(){return this._list.map(function(t){return[t.name,t.provider.label]})},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"extensions",{get:function(){if(this._extensions)return this._extensions;var t=new Set;return this._list.forEach(function(r){var n,i,a=r.provider;(n=a.stringExtensions)===null||n===void 0||n.forEach(function(o){return t.add(o)}),(i=a.binaryExtensions)===null||i===void 0||i.forEach(function(o){return t.add(o)})}),this._extensions=t,t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"binaryExtensions",{get:function(){if(this._binaryExtensions)return this._binaryExtensions;var t=new Set;return this._list.forEach(function(r){var n,i=r.provider;return(n=i.binaryExtensions)===null||n===void 0?void 0:n.forEach(function(a){return t.add(a)})}),this._binaryExtensions=t,t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"options",{get:function(){if(this._options)return this._options;var t=[];return this._list.forEach(function(r){var n=r.name,i=r.provider;return t.push([n,i.label,i.category||""])}),this._options=t,t},enumerable:!1,configurable:!0}),e.prototype._clear=function(){this._extensions=void 0,this._binaryExtensions=void 0,this._options=void 0},e.prototype.add=function(t,r){this._clear(),this._list.push({name:t,provider:r}),this._map.set(t,r)},e.prototype.remove=function(t){this._clear(),this._list.splice(this._list.findIndex(function(r){return r.name===t}),1),this._map.delete(t)},e.prototype.auto=function(t,r){for(var n=0,i=this.list.length;n<i;++n){var a=this._list[n].provider,o=!1;if((a.binaryExtensions&&a.binaryExtensions.indexOf(t.ext)>=0||a.stringExtensions&&a.stringExtensions.indexOf(t.ext)>=0)&&(o=!0),o&&(!a.isApplicable||a.isApplicable(t,r.data)))return a}},e.prototype.get=function(t){if(this._map.has(t))return this._map.get(t);throw new Error("unknown data format name '"+t+"'")},Object.defineProperty(e.prototype,"list",{get:function(){return this._list},enumerable:!1,configurable:!0}),e}(),oct=function(e){Le(t,e);function t(r){var n=e.call(this,{params:{current:""},animationState:"stopped"})||this;return n.context=r,n.map=new Map,n._animations=[],n.currentTime=0,n._params=void 0,n.events={updated:n.ev(),applied:n.ev()},n.isStopped=!0,n.isApplying=!1,n}return Object.defineProperty(t.prototype,"isEmpty",{get:function(){return this._animations.length===0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"current",{get:function(){return this._current},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"animations",{get:function(){return this._animations},enumerable:!1,configurable:!0}),t.prototype.triggerUpdate=function(){this.events.updated.next()},t.prototype.triggerApply=function(){this.events.applied.next()},t.prototype.getParams=function(){return this._params||(this._params={current:I.Select(this._animations[0]&&this._animations[0].name,this._animations.map(function(r){return[r.name,r.display.name]}),{label:"Animation"})}),this._params},t.prototype.updateParams=function(r){if(!this.isEmpty){this.updateState({params:E(E({},this.state.params),r)});var n=this.map.get(this.state.params.current),i=n.params(this.context);this._current={anim:n,params:i,paramValues:I.getDefaultValues(i),state:{},startedTime:-1,lastTime:0},this.triggerUpdate()}},t.prototype.updateCurrentParams=function(r){this.isEmpty||(this._current.paramValues=E(E({},this._current.paramValues),r),this.triggerUpdate())},t.prototype.register=function(r){if(this.map.has(r.name)){this.context.log.error("Animation '"+r.name+"' is already registered.");return}this._params=void 0,this.map.set(r.name,r),this._animations.push(r),this._animations.length===1?this.updateParams({current:r.name}):this.triggerUpdate()},t.prototype.play=function(r,n){return ce(this,void 0,void 0,function(){return de(this,function(i){switch(i.label){case 0:return[4,this.stop()];case 1:return i.sent(),this.map.has(r.name)||this.register(r),this.updateParams({current:r.name}),this.updateCurrentParams(n),[4,this.start()];case 2:return i.sent(),[2]}})})},t.prototype.tick=function(r,n){return ce(this,void 0,void 0,function(){return de(this,function(i){switch(i.label){case 0:return this.currentTime=r,this.isStopped?[2]:n?[4,this.applyFrame()]:[3,2];case 1:return i.sent(),[3,3];case 2:this.applyAsync(),i.label=3;case 3:return[2]}})})},t.prototype.start=function(){return ce(this,void 0,void 0,function(){var r,n,i;return de(this,function(a){switch(a.label){case 0:return this.updateState({animationState:"playing"}),this.context.behaviors.state.isAnimating.value||this.context.behaviors.state.isAnimating.next(!0),this.triggerUpdate(),r=this._current.anim,n=this._current.anim.initialState(this._current.paramValues,this.context),r.setup?[4,r.setup(this._current.paramValues,n,this.context)]:[3,2];case 1:i=a.sent(),i&&(n=i),a.label=2;case 2:return this._current.lastTime=0,this._current.startedTime=-1,this._current.state=n,this.isStopped=!1,[2]}})})},t.prototype.stop=function(){return ce(this,void 0,void 0,function(){var r;return de(this,function(n){switch(n.label){case 0:return this.isStopped=!0,this.state.animationState==="stopped"?[3,3]:(r=this._current.anim,r.teardown?[4,r.teardown(this._current.paramValues,this._current.state,this.context)]:[3,2]);case 1:n.sent(),n.label=2;case 2:this.updateState({animationState:"stopped"}),this.triggerUpdate(),n.label=3;case 3:return this.context.behaviors.state.isAnimating.value&&this.context.behaviors.state.isAnimating.next(!1),[2]}})})},Object.defineProperty(t.prototype,"isAnimating",{get:function(){return this.state.animationState==="playing"},enumerable:!1,configurable:!0}),t.prototype.applyAsync=function(){return ce(this,void 0,void 0,function(){return de(this,function(r){switch(r.label){case 0:if(this.isApplying)return[2];this.isApplying=!0,r.label=1;case 1:return r.trys.push([1,,3,4]),[4,this.applyFrame()];case 2:return r.sent(),[3,4];case 3:return this.isApplying=!1,[7];case 4:return[2]}})})},t.prototype.applyFrame=function(){return ce(this,void 0,void 0,function(){var r,n;return de(this,function(i){switch(i.label){case 0:return r=this.currentTime,this._current.startedTime<0&&(this._current.startedTime=r),[4,this._current.anim.apply(this._current.state,{lastApplied:this._current.lastTime,current:r-this._current.startedTime},{params:this._current.paramValues,plugin:this.context})];case 1:return n=i.sent(),n.kind==="finished"?this.stop():n.kind==="next"&&(this._current.state=n.state,this._current.lastTime=r-this._current.startedTime),this.triggerApply(),[2]}})})},t.prototype.getSnapshot=function(){return this.current?{state:this.state,current:{paramValues:this._current.paramValues,state:this._current.anim.stateSerialization?this._current.anim.stateSerialization.toJSON(this._current.state):this._current.state}}:{state:this.state}},t.prototype.setSnapshot=function(r){this.isEmpty||(this.updateState({animationState:r.state.animationState}),this.updateParams(r.state.params),r.current&&(this.current.paramValues=r.current.paramValues,this.current.state=this._current.anim.stateSerialization?this._current.anim.stateSerialization.fromJSON(r.current.state):r.current.state,this.triggerUpdate(),this.state.animationState==="playing"&&this.resume()))},t.prototype.resume=function(){return ce(this,void 0,void 0,function(){var r;return de(this,function(n){switch(n.label){case 0:return this._current.lastTime=0,this._current.startedTime=-1,r=this._current.anim,this.context.behaviors.state.isAnimating.value||this.context.behaviors.state.isAnimating.next(!0),r.setup?[4,r.setup(this._current.paramValues,this._current.state,this.context)]:[3,2];case 1:n.sent(),n.label=2;case 2:return this.isStopped=!1,[2]}})})},t}(Wd),sct={minRadius:5,extraRadius:4,durationMs:250},uct=function(){function e(t){this.plugin=t,this.boundaryHelper=new bs("98")}return e.prototype.transformedLoci=function(t){var r,n;if(Re.is(t)){var i=(n=(r=this.plugin.helpers.substructureParent.get(t.structure))===null||r===void 0?void 0:r.obj)===null||n===void 0?void 0:n.data;i&&(t=Re.remap(t,i))}return t},e.prototype.focusRenderObjects=function(t,r){if(t){for(var n=[],i=0,a=t;i<a.length;i++){var o=a[i],s=o.values.boundingSphere.ref.value;s.radius!==0&&n.push(s)}this.focusSpheres(n,function(u){return u},r)}},e.prototype.focusLoci=function(t,r){var n;if(Array.isArray(t)&&t.length>1){for(var i=[],a=0,o=t;a<o.length;a++){var s=o[a],u=sr.getBoundingSphere(this.transformedLoci(s));u&&i.push(u)}if(i.length===0)return;this.boundaryHelper.reset();for(var l=0,c=i;l<c.length;l++){var u=c[l];this.boundaryHelper.includeSphere(u)}this.boundaryHelper.finishedIncludeStep();for(var d=0,f=i;d<f.length;d++){var u=f[d];this.boundaryHelper.radiusSphere(u)}n=this.boundaryHelper.getSphere()}else if(Array.isArray(t)){if(t.length===0)return;n=sr.getBoundingSphere(this.transformedLoci(t[0]))}else n=sr.getBoundingSphere(this.transformedLoci(t));n&&this.focusSphere(n,r)},e.prototype.focusSpheres=function(t,r,n){for(var i=[],a=0,o=t;a<o.length;a++){var s=o[a],u=r(s);u&&i.push(u)}if(i.length!==0){if(i.length===1)return this.focusSphere(i[0],n);this.boundaryHelper.reset();for(var l=0,c=i;l<c.length;l++){var u=c[l];this.boundaryHelper.includeSphere(u)}this.boundaryHelper.finishedIncludeStep();for(var d=0,f=i;d<f.length;d++){var u=f[d];this.boundaryHelper.radiusSphere(u)}this.focusSphere(this.boundaryHelper.getSphere(),n)}},e.prototype.focusSphere=function(t,r){var n,i,a,o,s=E(E({},sct),r),u=s.extraRadius,l=s.minRadius,c=s.durationMs,d=Math.max(t.radius+u,l);if(r!=null&&r.principalAxes){var f=r==null?void 0:r.principalAxes.boxAxes,h=f.origin,v=f.dirA,p=f.dirC,m=(n=this.plugin.canvas3d)===null||n===void 0?void 0:n.camera.getFocus(h,d,v,p);(i=this.plugin.canvas3d)===null||i===void 0||i.requestCameraReset({durationMs:c,snapshot:m})}else{var m=(a=this.plugin.canvas3d)===null||a===void 0?void 0:a.camera.getFocus(t.center,d);(o=this.plugin.canvas3d)===null||o===void 0||o.requestCameraReset({durationMs:c,snapshot:m})}},e.prototype.setSnapshot=function(t,r){var n;(n=this.plugin.canvas3d)===null||n===void 0||n.requestCameraReset({snapshot:t,durationMs:r})},e.prototype.reset=function(t,r){var n;(n=this.plugin.canvas3d)===null||n===void 0||n.requestCameraReset({snapshot:t,durationMs:r})},e}(),lct=function(){function e(t){var r=this;this.ctx=t,this.providers=[],this.locis=[],this.isDirty=!1,this.labels=[],this.groupedLabels=new Map,t.managers.interactivity.lociHighlights.addProvider(function(n,i){r.mark(n,i),r.showLabels()})}return e.prototype.clearProviders=function(){this.providers=[],this.isDirty=!0,this.showLabels()},e.prototype.addProvider=function(t){this.providers.push(t),this.providers.sort(function(r,n){return(n.priority||0)-(r.priority||0)}),this.isDirty=!0,this.showLabels()},e.prototype.removeProvider=function(t){this.providers=this.providers.filter(function(r){return r!==t}),this.isDirty=!0,this.showLabels()},e.prototype.mark=function(t,r){var n=this.locis.findIndex(function(i){return ur.Loci.areEqual(t,i)});n===-1&&r===nr.Highlight?(this.locis.push(t),this.isDirty=!0):n!==-1&&r===nr.RemoveHighlight&&(jb(this.locis,n),this.isDirty=!0)},e.prototype.showLabels=function(){this.ctx.behaviors.labels.highlight.next({labels:this.getLabels()})},e.prototype.getLabels=function(){var t=this;if(this.isDirty){this.groupedLabels.clear(),this.labels.length=0;for(var r=0,n=this.providers;r<n.length;r++)for(var i=n[r],a=0,o=this.locis;a<o.length;a++){var s=o[a];if(!sr.isEmpty(s.loci)){var u=i.label(s.loci,s.repr);if(u){var l=i.group?i.group(u):u.toString(),c=this.groupedLabels.get(l);c?c.push(u):this.groupedLabels.set(l,[u])}}}this.labels.length=0,this.groupedLabels.forEach(function(d,f){var h=d.length,v=h>1&&d[0]!==d[1]?f:d[0];t.labels.push(h===1?v:v+" <small>||  "+h+"</small>")}),this.isDirty=!1}return this.labels},e}(),cct=8,dct=function(e){Le(t,e);function t(r){var n=e.call(this,{history:[]})||this;n.plugin=r,n.events={historyUpdated:n.ev()},n.behaviors={current:n.ev.behavior(void 0)},r.state.data.events.object.removed.subscribe(function(a){var o,s,u=a.obj;if(ge.Molecule.Structure.is(u)){((s=n.current)===null||s===void 0?void 0:s.loci.structure)===u.data&&n.clear();for(var l=[],c=0,d=n.history;c<d.length;c++){var f=d[c];f.loci.structure===u.data&&l.push(f)}l.length!==n.history.length&&(n.history.length=0,(o=n.history).push.apply(o,l),n.events.historyUpdated.next())}});var i=Be();return r.state.data.events.object.updated.subscribe(function(a){var o,s=a.oldData,u=a.obj,l=a.action;if(ge.Molecule.Structure.is(u)&&s!==u.data&&l==="in-place"){var c=n.state.current,d=u.data;if(c&&c.loci.structure===s){var f=Re.remap(c.loci,d);n.state.current=E(E({},c),{loci:f}),n.behaviors.current.next(n.state.current),sr.getBoundingSphere(f,i);var h=(o=n.plugin.canvas3d)===null||o===void 0?void 0:o.camera,v=h.getTargetDistance(i.radius+4);(_.distance(h.target,i.center)>i.radius||v>h.viewport.height/h.zoom)&&n.plugin.managers.camera.focusSphere(i,{durationMs:0})}}}),n}return Object.defineProperty(t.prototype,"current",{get:function(){return this.state.current},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"history",{get:function(){return this.state.history},enumerable:!1,configurable:!0}),t.prototype.tryAddHistory=function(r){if(!Re.isEmpty(r.loci)){for(var n=0,i=void 0,a=0,o=this.state.history;a<o.length;a++){var s=o[a];if(Re.areEqual(s.loci,r.loci)){i=s;break}n++}if(i){jb(this.state.history,n),this.state.history.unshift(r),this.events.historyUpdated.next();return}this.state.history.unshift(r),this.state.history.length>cct&&this.state.history.pop(),this.events.historyUpdated.next()}},t.prototype.set=function(r){this.tryAddHistory(r),(!this.state.current||!Re.areEqual(this.state.current.loci,r.loci))&&(this.state.current=r,this.behaviors.current.next(r))},t.prototype.setFromLoci=function(r){var n=sr.normalize(r);if(!Re.is(n)||Re.isEmpty(n)){this.clear();return}this.set({loci:n,label:Fh(n,{reverse:!0,hidePrefix:!0,htmlStyling:!1})})},t.prototype.addFromLoci=function(r){var n=this.state.current&&Re.is(r)&&r.structure===this.state.current.loci.structure?Re.union(r,this.state.current.loci):r;this.setFromLoci(n)},t.prototype.clear=function(){this.state.current&&(this.state.current=void 0,this.behaviors.current.next(void 0))},t.prototype.getSnapshot=function(){if(!this.current)return{};var r=this.plugin.helpers.substructureParent.get(this.current.loci.structure),n=r==null?void 0:r.transform.ref;return n?{current:{label:this.current.label,ref:n,bundle:on.fromLoci(this.current.loci),category:this.current.category}}:{}},t.prototype.setSnapshot=function(r){var n,i;if(!r.current){this.clear();return}var a=r.current,o=a.label,s=a.ref,u=a.bundle,l=a.category,c=(i=(n=this.plugin.state.data.select(or.Generators.byRef(s))[0])===null||n===void 0?void 0:n.obj)===null||i===void 0?void 0:i.data;if(c){var d=on.toLoci(u,c);this.set({label:o,loci:d,category:l})}},t}(Wd),zy=new bs("98"),fct=24,hct=function(e){Le(t,e);function t(r){var n=e.call(this,{entries:new Map,additionsHistory:[],stats:pct()})||this;return n.plugin=r,n.events={changed:n.ev(),additionsHistoryUpdated:n.ev(),loci:{add:n.ev(),remove:n.ev(),clear:n.ev()}},r.helpers.substructureParent.events.removed.subscribe(function(i){return n.onRemove(i.ref,i.obj)}),r.helpers.substructureParent.events.updated.subscribe(function(i){return n.onUpdate(i.ref,i.oldObj,i.obj)}),n}return Object.defineProperty(t.prototype,"entries",{get:function(){return this.state.entries},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"additionsHistory",{get:function(){return this.state.additionsHistory},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"stats",{get:function(){return this.state.stats?this.state.stats:(this.state.stats=this.calcStats(),this.state.stats)},enumerable:!1,configurable:!0}),t.prototype.getEntry=function(r){var n=this.plugin.helpers.substructureParent.get(r,!0);if(n){var i=n.transform.ref;if(!this.entries.has(i)){var a=new JR(Re(r,[]));return this.entries.set(i,a),a}return this.entries.get(i)}},t.prototype.calcStats=function(){var r=0,n=0,i=Zf.create();this.entries.forEach(function(o){var s=o.selection.elements;if(s.length){r+=1;for(var u=0,l=s.length;u<l;++u)n+=Fe.size(s[u].indices);Zf.add(i,i,Zf.ofLoci(o.selection))}});var a=kw(i,{countsOnly:!0});return{structureCount:r,elementCount:n,label:a}},t.prototype.add=function(r){if(!Re.is(r))return!1;var n=this.getEntry(r.structure);if(!n)return!1;var i=n.selection;return n.selection=Re.union(n.selection,r),this.tryAddHistory(r),this.referenceLoci=r,this.events.loci.add.next(r),!Re.areEqual(i,n.selection)},t.prototype.remove=function(r){if(!Re.is(r))return!1;var n=this.getEntry(r.structure);if(!n)return!1;var i=n.selection;return n.selection=Re.subtract(n.selection,r),this.referenceLoci=r,this.events.loci.remove.next(r),!Re.areEqual(i,n.selection)},t.prototype.intersect=function(r){if(!Re.is(r))return!1;var n=this.getEntry(r.structure);if(!n)return!1;var i=n.selection;return n.selection=Re.intersect(n.selection,r),this.referenceLoci=r,!Re.areEqual(i,n.selection)},t.prototype.set=function(r){if(!Re.is(r))return!1;var n=this.getEntry(r.structure);if(!n)return!1;var i=n.selection;return n.selection=r,this.tryAddHistory(r),this.referenceLoci=void 0,!Re.areEqual(i,n.selection)},t.prototype.modifyHistory=function(r,n,i,a){a===void 0&&(a=!1);var o=this.additionsHistory,s=o.indexOf(r);if(!(s<0)){var u=void 0;switch(n){case"remove":jb(o,s);break;case"up":u=s-1;break;case"down":u=s+1;break}if(u!==void 0)for(var l=i?Math.min(o.length,i):o.length;;)if(u=u%l,u<0&&(u+=l),!a||o[s].loci.structure===o[u].loci.structure){var c=o[s];o[s]=o[u],o[u]=c;break}else u+=n==="up"?-1:1;this.events.additionsHistoryUpdated.next()}},t.prototype.tryAddHistory=function(r){if(!sr.isEmpty(r)){for(var n=0,i=void 0,a=0,o=this.additionsHistory;a<o.length;a++){var s=o[a];if(sr.areEqual(s.loci,r)){i=s;break}n++}if(i){jb(this.additionsHistory,n),this.additionsHistory.unshift(i),this.events.additionsHistoryUpdated.next();return}var u=Zf.ofLoci(r),l=kw(u,{reverse:!0});this.additionsHistory.unshift({id:bn.create22(),loci:r,label:l}),this.additionsHistory.length>fct&&this.additionsHistory.pop(),this.events.additionsHistoryUpdated.next()}},t.prototype.clearHistory=function(){this.state.additionsHistory.length!==0&&(this.state.additionsHistory=[],this.events.additionsHistoryUpdated.next())},t.prototype.clearHistoryForStructure=function(r){for(var n=[],i=0,a=this.state.additionsHistory;i<a.length;i++){var o=a[i];o.loci.structure.root===r.root&&n.push(o)}for(var s=0,u=n;s<u.length;s++){var o=u[s];this.modifyHistory(o,"remove")}n.length!==0&&this.events.additionsHistoryUpdated.next()},t.prototype.onRemove=function(r,n){var i;this.entries.has(r)&&(this.entries.delete(r),n!=null&&n.data&&this.clearHistoryForStructure(n.data),((i=this.referenceLoci)===null||i===void 0?void 0:i.structure)===(n==null?void 0:n.data)&&(this.referenceLoci=void 0),this.state.stats=void 0,this.events.changed.next())},t.prototype.onUpdate=function(r,n,i){var a,o,s,u;if(!(n===i||(n==null?void 0:n.data)===i.data)){var l=this.plugin.helpers.substructureParent.get(i.data,!0);if(l&&(r=l.transform.ref,!!this.entries.has(r))){var c=(o=(a=this.plugin.helpers.substructureParent.get(i.data))===null||a===void 0?void 0:a.obj)===null||o===void 0?void 0:o.data;if(c)if(!(n!=null&&n.data)||We.areUnitIdsAndIndicesEqual(n.data,i.data)){this.entries.set(r,vct(this.entries.get(r),c)),((s=this.referenceLoci)===null||s===void 0?void 0:s.structure.root)===c.root&&(this.referenceLoci=Re.remap(this.referenceLoci,c));for(var d=!1,f=0,h=this.state.additionsHistory;f<h.length;f++){var v=h[f];v.loci.structure.root===c.root&&(v.loci=Re.remap(v.loci,c),d=!0)}d&&this.events.additionsHistoryUpdated.next()}else this.entries.set(r,new JR(Re(c,[]))),((u=this.referenceLoci)===null||u===void 0?void 0:u.structure.root)===c.root&&(this.referenceLoci=void 0),this.clearHistoryForStructure(c),this.state.stats=void 0,this.events.changed.next()}}},t.prototype.clear=function(){for(var r=this.entries.keys(),n=[];;){var i=r.next();if(i.done)break;var a=this.entries.get(i.value);Re.isEmpty(a.selection)||n.push(a.selection),a.selection=Re(a.selection.structure,[])}return this.referenceLoci=void 0,this.state.stats=void 0,this.events.changed.next(),this.events.loci.clear.next(),this.clearHistory(),n},t.prototype.getLoci=function(r){var n=this.getEntry(r);return n?n.selection:jr},t.prototype.getStructure=function(r){var n=this.getEntry(r);if(n)return n.structure},t.prototype.structureHasSelection=function(r){var n,i,a=(i=(n=r.cell)===null||n===void 0?void 0:n.obj)===null||i===void 0?void 0:i.data;if(!a)return!1;var o=this.getEntry(a);return!!o&&!Re.isEmpty(o.selection)},t.prototype.has=function(r){if(Re.is(r)){var n=this.getEntry(r.structure);if(n)return Re.isSubset(n.selection,r)}return!1},t.prototype.tryGetRange=function(r){if(Re.is(r)&&r.elements.length===1){var n=this.getEntry(r.structure);if(n){var i=r.elements[0];if(i){var a=this.referenceLoci;if(!(!a||!Re.is(a)||a.structure!==r.structure)){for(var o,s=0,u=a.elements;s<u.length;s++){var l=u[s];if(i.unit===l.unit){o=l;break}}if(o&&i.unit===o.unit)return mct(r.structure,o,i)}}}}},t.prototype.elementCount=function(){var r=0;return this.entries.forEach(function(n){r+=Re.size(n.selection)}),r},t.prototype.getBoundary=function(){var r=_.create(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),n=_.create(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);zy.reset();var i=[];this.entries.forEach(function(c){var d=c.selection;Re.isEmpty(d)||i.push(Re.getBoundary(d))});for(var a=0,o=i.length;a<o;++a){var s=i[a],u=s.box,l=s.sphere;_.min(r,r,u.min),_.max(n,n,u.max),zy.includePositionRadius(l.center,l.radius)}zy.finishedIncludeStep();for(var a=0,o=i.length;a<o;++a){var l=i[a].sphere;zy.radiusPositionRadius(l.center,l.radius)}return{box:{min:r,max:n},sphere:zy.getSphere()}},t.prototype.getPrincipalAxes=function(){var r=this.elementCount(),n=new Float32Array(3*r),i=0;return this.entries.forEach(function(a){Re.toPositionsArray(a.selection,n,i),i+=Re.size(a.selection)*3}),kv.ofPositions(n)},t.prototype.modify=function(r,n){var i=!1;switch(r){case"add":i=this.add(n);break;case"remove":i=this.remove(n);break;case"intersect":i=this.intersect(n);break;case"set":i=this.set(n);break}i&&(this.state.stats=void 0,this.events.changed.next())},Object.defineProperty(t.prototype,"applicableStructures",{get:function(){return this.plugin.managers.structure.hierarchy.selection.structures.filter(function(r){return!!r.cell.obj}).map(function(r){return r.cell.obj.data})},enumerable:!1,configurable:!0}),t.prototype.triggerInteraction=function(r,n,i){switch(i===void 0&&(i=!0),r){case"add":this.plugin.managers.interactivity.lociSelects.select({loci:n},i);break;case"remove":this.plugin.managers.interactivity.lociSelects.deselect({loci:n},i);break;case"intersect":this.plugin.managers.interactivity.lociSelects.selectJoin({loci:n},i);break;case"set":this.plugin.managers.interactivity.lociSelects.selectOnly({loci:n},i);break}},t.prototype.fromLoci=function(r,n,i){i===void 0&&(i=!0),this.triggerInteraction(r,n,i)},t.prototype.fromCompiledQuery=function(r,n,i){i===void 0&&(i=!0);for(var a=0,o=this.applicableStructures;a<o.length;a++){var s=o[a],u=n(new ps(s));this.triggerInteraction(r,mt.toLociWithSourceUnits(u),i)}},t.prototype.fromSelectionQuery=function(r,n,i){var a=this;i===void 0&&(i=!0),this.plugin.runTask($e.create("Structure Selection",function(o){return ce(a,void 0,void 0,function(){var s,u,l,c;return de(this,function(d){switch(d.label){case 0:s=0,u=this.applicableStructures,d.label=1;case 1:return s<u.length?(l=u[s],[4,n.getSelection(this.plugin,o,l)]):[3,4];case 2:c=d.sent(),this.triggerInteraction(r,mt.toLociWithSourceUnits(c),i),d.label=3;case 3:return s++,[3,1];case 4:return[2]}})})}))},t.prototype.fromSelections=function(r){var n,i=ji.resolveAndCheck(this.plugin.state.data,r);if(!(!i||!i.obj)){if(!ge.Molecule.Structure.Selections.is(i.obj)){console.warn("fromSelections applied to wrong object type.",i.obj);return}this.clear();for(var a=0,o=(n=i.obj)===null||n===void 0?void 0:n.data;a<o.length;a++){var s=o[a];this.fromLoci("set",s.loci)}}},t}(Wd);function pct(){return{structureCount:0,elementCount:0,label:"Nothing Selected"}}var JR=function(){function e(t){this._structure=void 0,this._selection=t}return Object.defineProperty(e.prototype,"selection",{get:function(){return this._selection},set:function(t){this._selection=t,this._structure=void 0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"structure",{get:function(){return this._structure?this._structure:(sr.isEmpty(this._selection)?this._structure=void 0:this._structure=Re.toStructure(this._selection),this._structure)},enumerable:!1,configurable:!0}),e}();function vct(e,t){return new JR(Re.remap(e.selection,t))}function mct(e,t,r){var n=Math.min(Fe.min(t.indices),Fe.min(r.indices)),i=Math.max(Fe.max(t.indices),Fe.max(r.indices));return Re(e,[{unit:t.unit,indices:Fe.ofRange(n,i)}])}var gct=[["full","Full"],["collapsed","Collapsed"],["hidden","Hidden"]],uI=[["full","Full"],["hidden","Hidden"]],yct={isExpanded:I.Boolean(!1),showControls:I.Boolean(!0),regionState:I.Group({left:I.Select("full",gct),top:I.Select("full",uI),right:I.Select("full",uI),bottom:I.Select("full",uI)}),controlsDisplay:I.Value("outside",{isHidden:!0})},bct=function(e){Le(t,e);function t(r){var n=e.call(this,E(E({},I.getDefaultValues(yct)),r.spec.layout&&r.spec.layout.initial))||this;return n.context=r,n.events={updated:n.ev()},n.rootState=void 0,_t.Layout.Update.subscribe(r,function(i){return n.updateProps(i.state)}),typeof document<"u"&&(n.expandedViewport=document.createElement("meta"),n.expandedViewport.name="viewport",n.expandedViewport.content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"),n}return t.prototype.updateProps=function(r){var n=!!this.state.isExpanded;this.updateState(r),this.root&&typeof r.isExpanded=="boolean"&&r.isExpanded!==n&&this.handleExpand(),this.events.updated.next()},t.prototype.setProps=function(r){this.updateState(r)},t.prototype.setRoot=function(r){this.root=r,this.state.isExpanded&&this.handleExpand()},t.prototype.getScrollElement=function(){return document.scrollingElement?document.scrollingElement:document.documentElement?document.documentElement:document.body},t.prototype.handleExpand=function(){try{var r=document.getElementsByTagName("body")[0],n=document.getElementsByTagName("head")[0];if(!r||!n||!this.root)return;if(this.state.isExpanded){for(var i=n.children,a=[],o=!1,s=0;s<i.length;s++)i[s]===this.expandedViewport?o=!0:(i[s].name||"").toLowerCase()==="viewport"&&a.push(i[s]);for(var u=0,l=a;u<l.length;u++){var c=l[u];n.removeChild(c)}o||n.appendChild(this.expandedViewport);var d=r.style,f=this.getScrollElement(),h=f.scrollLeft,v=f.scrollTop;this.rootState={top:d.top,bottom:d.bottom,right:d.right,left:d.left,scrollTop:v,scrollLeft:h,position:d.position,overflow:d.overflow,viewports:a,zIndex:this.root.style.zIndex,width:d.width,height:d.height,maxWidth:d.maxWidth,maxHeight:d.maxHeight,margin:d.margin,marginLeft:d.marginLeft,marginRight:d.marginRight,marginTop:d.marginTop,marginBottom:d.marginBottom},d.overflow="hidden",d.position="fixed",d.top="0",d.bottom="0",d.right="0",d.left="0",d.width="100%",d.height="100%",d.maxWidth="100%",d.maxHeight="100%",d.margin="0",d.marginLeft="0",d.marginRight="0",d.marginTop="0",d.marginBottom="0"}else{for(var i=n.children,s=0;s<i.length;s++)if(i[s]===this.expandedViewport){n.removeChild(this.expandedViewport);break}if(this.rootState){for(var p=this.rootState,m=0,g=p.viewports;m<g.length;m++){var c=g[m];n.appendChild(c)}var d=r.style;d.top=p.top,d.bottom=p.bottom,d.left=p.left,d.right=p.right,d.width=p.width,d.height=p.height,d.maxWidth=p.maxWidth,d.maxHeight=p.maxHeight,d.margin=p.margin,d.marginLeft=p.marginLeft,d.marginRight=p.marginRight,d.marginTop=p.marginTop,d.marginBottom=p.marginBottom,d.position=p.position,d.overflow=p.overflow||"";var f=this.getScrollElement();f.scrollTop=p.scrollTop,f.scrollLeft=p.scrollLeft,this.rootState=void 0,this.root.style.zIndex=p.zIndex}}}catch(b){var y="Layout change error, you might have to reload the page.";this.context.log.error(y),console.error(y,b)}},t}(Wd),yL={includeTypes:I.MultiSelect(uA(Hr.Names),I.objectToOptions(Hr.Names)),excludeTypes:I.MultiSelect([],I.objectToOptions(Hr.Names)),ignoreHydrogens:I.Boolean(!1),aromaticBonds:I.Boolean(!1,{description:"Display aromatic bonds with dashes"})};I.getDefaultValues(yL);var bL=E(E(E({},um),yL),{adjustCylinderLength:I.Boolean(!0,{description:"Shorten cylinders to reduce overlap with spheres."})});I.getDefaultValues(bL);var xL=E(E({},Dne),yL);I.getDefaultValues(xL);function Cae(e,t,r){return!Hr.is(e,r)||Hr.is(t,r)}function _ae(e,t,r){var n=t.elements,i=t.model.atomicHierarchy.derived.atom.atomicNumber,a=t.bonds,o=a.a,s=a.b,u=a.edgeProps,l=u.flags,c=r.ignoreHydrogens,d=r.includeTypes,f=r.excludeTypes,h=Hr.fromNames(d),v=Hr.fromNames(f),p=Hr.isAll(h)&&v===0,m=e.child,g=m==null?void 0:m.unitMap.get(t.id);if(m&&!g)throw new Error("expected childUnit to exist if child exists");if(!(p&&!c&&!m))return function(y){return!!g&&!Je.has(g.elements,n[o[y]])||c&&(Lw(i,n[o[y]])||Lw(i,n[s[y]]))||!p&&Cae(h,v,l[y])}}function wae(e,t){var r=e.interUnitBonds,n=r.edges,i=t.ignoreHydrogens,a=t.includeTypes,o=t.excludeTypes,s=Hr.fromNames(a),u=Hr.fromNames(o),l=Hr.isAll(s)&&u===0,c=e.child;if(!(l&&!i&&!c))return function(d){if(c){var f=n[d],h=c.unitMap.get(f.unitA);if(!h)return!0;var v=e.unitMap.get(f.unitA),p=v.elements[f.indexA];if(!Je.has(h.elements,p))return!0}if(i){var f=n[d],m=e.unitMap.get(f.unitA),g=e.unitMap.get(f.unitB);if(Fw(m,m.elements[f.indexA])||Fw(g,g.elements[f.indexB]))return!0}return!!(!l&&Cae(s,u,n[d].props.flag))}}var Nh;(function(e){function t(n){var i=n.group,a=n.structure,o=i.units[0],s=je.isAtomic(o)?o.bonds.edgeCount*2:0,u=i.units.length,l=Ht.Location(a,void 0,void 0,a,void 0,void 0),c=function(d,f){var h=i.units[f];return l.aUnit=h,l.bUnit=h,l.aIndex=h.bonds.a[d],l.bIndex=h.bonds.b[d],l};return wn(s,u,1,c)}e.fromGroup=t;function r(n){var i=n.interUnitBonds.edgeCount,a=1,o=Ht.Location(n,void 0,void 0,n,void 0,void 0),s=function(u){var l=n.interUnitBonds.edges[u];return o.aUnit=n.unitMap.get(l.unitA),o.aIndex=l.indexA,o.bUnit=n.unitMap.get(l.unitB),o.bIndex=l.indexB,o};return wn(i,a,1,s,!0)}e.fromStructure=r})(Nh||(Nh={}));function SL(e,t,r){var n=e.objectId,i=e.instanceId,a=e.groupId;if(r===n){var o=t.structure,s=t.group,u=s.units[i];if(je.isAtomic(u)){var l=o.target,c=u.bonds.a[a],d=u.bonds.b[a];return Ht.Loci(l,[Ht.Location(l,u,c,l,u,d),Ht.Location(l,u,d,l,u,c)])}}return jr}function CL(e,t,r,n){var i=!1;if(Ht.isLoci(e)){var a=t.structure,o=t.group;if(!We.areEquivalent(e.structure,a))return!1;var s=o.units[0];if(!je.isAtomic(s))return!1;for(var u=s.bonds.edgeCount*2,l=0,c=e.bonds;l<c.length;l++){var d=c[l];if(d.aUnit===d.bUnit){var f=o.unitIndexMap.get(d.aUnit.id);if(f!==void 0){var h=s.bonds.getDirectedEdgeIndex(d.aIndex,d.bIndex);h!==-1&&r(Ie.ofSingleton(f*u+h))&&(i=!0)}}}}else if(Re.is(e)){var a=t.structure,o=t.group;if(!We.areEquivalent(e.structure,a))return!1;var s=o.units[0];if(!je.isAtomic(s))return!1;for(var v=s.bonds.edgeCount*2,p=function(C){var w=o.unitIndexMap.get(C.unit.id);if(w!==void 0){var A=s.bonds,M=A.offset,D=A.b;Fe.forEach(C.indices,function(k){for(var R=M[k],O=M[k+1];R<O;R++)(!n||Fe.has(C.indices,D[R]))&&r(Ie.ofSingleton(w*v+R))&&(i=!0)})}},m=0,g=e.elements;m<g.length;m++){var y=g[m];p(y)}}return i}function _L(e,t,r){var n=e.objectId,i=e.groupId;if(r===n){var a=t.target,o=t.interUnitBonds.edges[i],s=t.unitMap.get(o.unitA),u=t.unitMap.get(o.unitB);return Ht.Loci(a,[Ht.Location(a,s,o.indexA,a,u,o.indexB),Ht.Location(a,u,o.indexB,a,s,o.indexA)])}return jr}function wL(e,t,r,n){var i=!1;if(Ht.isLoci(e)){if(!We.areEquivalent(e.structure,t))return!1;for(var a=0,o=e.bonds;a<o.length;a++){var s=o[a],u=t.interUnitBonds.getBondIndexFromLocation(s);u!==-1&&r(Ie.ofSingleton(u))&&(i=!0)}}else if(Re.is(e)){if(!We.areEquivalent(e.structure,t)||n&&e.elements.length===1)return!1;for(var l=new Map,c=0,d=e.elements;c<d.length;c++){var f=d[c];l.set(f.unit.id,f.indices)}for(var h=function(m){var g=m.unit;if(!je.isAtomic(g))return"continue";t.interUnitBonds.getConnectedUnits(g.id).forEach(function(y){var b=l.get(y.unitB);(!n||b)&&Fe.forEach(m.indices,function(S){y.connectedIndices.includes(S)&&y.getEdges(S).forEach(function(x){if(!n||b&&Fe.has(b,x.indexB)){var C=t.interUnitBonds.getEdgeIndex(S,g.id,x.indexB,y.unitB);r(Ie.ofSingleton(C))&&(i=!0)}})})})},v=0,p=e.elements;v<p.length;v++){var f=p[v];h(f)}}return i}var lI=Hr.is;function Eae(e,t,r,n){var i=e.elements,a=e.bonds,o=a.edgeCount,s=a.a,u=a.b,l=a.edgeProps,c=a.offset,d=l.order,f=l.flags,h=n.sizeFactor,v=n.sizeAspectRatio,p=n.adjustCylinderLength,m=n.aromaticBonds,g=_(),y=_(),b=e.conformation.invariantPosition,S,x=Ze.create(t,e),C=Ht.Location(t,e,void 0,t,e,void 0),w=t.child;if(n.includeParent&&w){var A=w.unitMap.get(e.id);if(!A)throw new Error("expected childUnit to exist");S=function(B){var j=i[s[B]],Y=i[u[B]];return Je.has(A.elements,j)&&!Je.has(A.elements,Y)}}var M=function(B){return C.aIndex=s[B],C.bIndex=u[B],r.size.size(C)*h},D=function(B){return x.element=i[s[B]],r.size.size(x)*h},k=function(B){return x.element=i[u[B]],r.size.size(x)*h},R=e.rings,O=R.elementRingIndices,H=R.elementAromaticRingIndices;return{linkCount:o*2,referencePosition:function(B){var j,Y,G=s[B],$=u[B];G>$&&(j=[$,G],G=j[0],$=j[1]),c[G+1]-c[G]===1&&(Y=[$,G],G=Y[0],$=Y[1]);for(var q=O.get(G),ee=0,fe=c[G],W=c[G+1];fe<W;++fe){var X=u[fe];if(X!==$&&X!==G)if(q){var U=O.get(X);if(!U)continue;var z=nw(q,U);z>ee&&(ee=z,b(i[X],g))}else return b(i[X],g)}return ee>0?g:null},position:function(B,j,Y){if(b(i[s[Y]],B),b(i[u[Y]],j),p){var G=D(Y),$=k(Y),q=Math.min(G,$)*v,ee=Math.sqrt(Math.max(0,G*G-q*q))-.05,fe=Math.sqrt(Math.max(0,$*$-q*q))-.05;if(ee<=.01&&fe<=.01)return;_.normalize(y,_.sub(y,j,B)),_.scaleAndAdd(B,B,y,ee),_.scaleAndAdd(j,j,y,-fe)}},style:function(B){var j=d[B],Y=f[B];if(lI(Y,2)||lI(Y,4))return 1;if(j===3)return 3;if(m){var G=s[B],$=u[B],q=H.get(G),ee=H.get($),fe=q&&ee?nw(q,ee):0;if(fe||lI(Y,16))return fe===2?6:5}return j===2?2:0},radius:function(B){return M(B)*v},ignore:_ae(t,e,n),stub:S}}function xct(e,t,r,n,i,a){if(!je.isAtomic(t)||!t.bonds.edgeCount)return as.createEmpty(a);var o=r.child,s=o==null?void 0:o.unitMap.get(t.id);if(o&&!s)return as.createEmpty(a);var u=Eae(t,r,n,i),l=Rne(e,u,i,a),c=Be.expand(Be(),(s??t).boundary.sphere,1*i.sizeFactor);return l.setBoundingSphere(c),l}function Sct(e,t,r,n,i,a){if(!je.isAtomic(t)||!t.bonds.edgeCount)return Lt.createEmpty(a);var o=r.child,s=o==null?void 0:o.unitMap.get(t.id);if(o&&!s)return Lt.createEmpty(a);var u=Eae(t,r,n,i),l=lm(e,u,i,a),c=Be.expand(Be(),(s??t).boundary.sphere,1*i.sizeFactor);return l.setBoundingSphere(c),l}var DA=E(E(E(E({},Ia),bne),bL),{sizeFactor:I.Numeric(.3,{min:0,max:10,step:.01}),sizeAspectRatio:I.Numeric(2/3,{min:0,max:3,step:.01}),tryUseImpostor:I.Boolean(!0),includeParent:I.Boolean(!1)});function Aae(e,t,r,n){return r.tryUseImpostor&&n&&n.extensions.fragDepth?Cct(e):_ct(e)}function Cct(e){return xne({defaultProps:I.getDefaultValues(DA),createGeometry:xct,createLocationIterator:Nh.fromGroup,getLoci:SL,eachLocation:CL,setUpdateState:function(t,r,n,i,a,o,s){t.createGeometry=r.sizeAspectRatio!==n.sizeAspectRatio||r.linkScale!==n.linkScale||r.linkSpacing!==n.linkSpacing||r.ignoreHydrogens!==n.ignoreHydrogens||r.linkCap!==n.linkCap||r.dashCount!==n.dashCount||r.dashScale!==n.dashScale||r.dashCap!==n.dashCap||r.stubCap!==n.stubCap||!so(r.includeTypes,n.includeTypes)||!so(r.excludeTypes,n.excludeTypes)||r.adjustCylinderLength!==n.adjustCylinderLength||r.aromaticBonds!==n.aromaticBonds;var u=o.group.units[0],l=s.group.units[0];je.isAtomic(u)&&je.isAtomic(l)&&(Oo.areEqual(u.bonds,l.bonds)||(t.createGeometry=!0,t.updateTransform=!0,t.updateColor=!0,t.updateSize=!0))},mustRecreate:function(t,r,n){return!r.tryUseImpostor||!n}},e)}function _ct(e){return ho({defaultProps:I.getDefaultValues(DA),createGeometry:Sct,createLocationIterator:Nh.fromGroup,getLoci:SL,eachLocation:CL,setUpdateState:function(t,r,n,i,a,o,s){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.sizeAspectRatio!==n.sizeAspectRatio||r.radialSegments!==n.radialSegments||r.linkScale!==n.linkScale||r.linkSpacing!==n.linkSpacing||r.ignoreHydrogens!==n.ignoreHydrogens||r.linkCap!==n.linkCap||r.dashCount!==n.dashCount||r.dashScale!==n.dashScale||r.dashCap!==n.dashCap||r.stubCap!==n.stubCap||!so(r.includeTypes,n.includeTypes)||!so(r.excludeTypes,n.excludeTypes)||r.adjustCylinderLength!==n.adjustCylinderLength||r.aromaticBonds!==n.aromaticBonds;var u=o.group.units[0],l=s.group.units[0];je.isAtomic(u)&&je.isAtomic(l)&&(Oo.areEqual(u.bonds,l.bonds)||(t.createGeometry=!0,t.updateTransform=!0,t.updateColor=!0,t.updateSize=!0))},mustRecreate:function(t,r,n){return r.tryUseImpostor&&!!n}},e)}var cI=new Ht.ElementBondIterator;function IG(e,t,r,n){for(cI.setElement(t,r,n);cI.hasNext;){var i=cI.move();return i.otherUnit.conformation.position(i.otherUnit.elements[i.otherIndex],e),e}return null}var MG=_();function Pae(e,t,r){var n=Ze.create(e),i=Ht.Location(e,void 0,void 0,e,void 0,void 0),a=e.interUnitBonds,o=a.edgeCount,s=a.edges,u=r.sizeFactor,l=r.sizeAspectRatio,c=r.adjustCylinderLength,d=r.aromaticBonds,f=_(),h,v=e.child;r.includeParent&&v&&(h=function(y){var b=s[y],S=v.unitMap.get(b.unitA),x=v.unitMap.get(b.unitB),C=e.unitMap.get(b.unitA),w=C.elements[b.indexA],A=e.unitMap.get(b.unitB),M=A.elements[b.indexB];return S&&Je.has(S.elements,w)&&(!x||!Je.has(x.elements,M))});var p=function(y){var b=s[y];return i.aUnit=e.unitMap.get(b.unitA),i.aIndex=b.indexA,i.bUnit=e.unitMap.get(b.unitB),i.bIndex=b.indexB,t.size.size(i)*u},m=function(y){var b=s[y];return n.unit=e.unitMap.get(b.unitA),n.element=n.unit.elements[b.indexA],t.size.size(n)*u},g=function(y){var b=s[y];return n.unit=e.unitMap.get(b.unitB),n.element=n.unit.elements[b.indexB],t.size.size(n)*u};return{linkCount:o,referencePosition:function(y){var b=s[y],S,x,C,w;if(b.unitA<b.unitB)S=e.unitMap.get(b.unitA),x=e.unitMap.get(b.unitB),C=b.indexA,w=b.indexB;else if(b.unitA>b.unitB)S=e.unitMap.get(b.unitB),x=e.unitMap.get(b.unitA),C=b.indexB,w=b.indexA;else throw new Error("same units in createInterUnitBondCylinderMesh");return IG(MG,e,S,C)||IG(MG,e,x,w)},position:function(y,b,S){var x=s[S],C=e.unitMap.get(x.unitA),w=e.unitMap.get(x.unitB);if(C.conformation.position(C.elements[x.indexA],y),w.conformation.position(w.elements[x.indexB],b),c){var A=m(S),M=g(S),D=Math.min(A,M)*l,k=Math.sqrt(Math.max(0,A*A-D*D))-.05,R=Math.sqrt(Math.max(0,M*M-D*D))-.05;if(k<=.01&&R<=.01)return;_.normalize(f,_.sub(f,b,y)),_.scaleAndAdd(y,y,f,k),_.scaleAndAdd(b,b,f,-R)}},style:function(y){var b=s[y].props.order,S=_a.create(s[y].props.flag);return Hr.is(S,2)||Hr.is(S,4)?1:b===3?3:d&&Hr.is(S,16)?5:b===2?2:0},radius:function(y){return p(y)*l},ignore:wae(e,r),stub:h}}function wct(e,t,r,n,i){if(!t.interUnitBonds.edgeCount)return as.createEmpty(i);var a=Pae(t,r,n),o=Rne(e,a,n,i),s=t.child,u=Be.expand(Be(),(s??t).boundary.sphere,1*n.sizeFactor);return o.setBoundingSphere(u),o}function Ect(e,t,r,n,i){if(!t.interUnitBonds.edgeCount)return Lt.createEmpty(i);var a=Pae(t,r,n),o=lm(e,a,n,i),s=t.child,u=Be.expand(Be(),(s??t).boundary.sphere,1*n.sizeFactor);return o.setBoundingSphere(u),o}var RA=E(E(E(E({},F2),wZe),bL),{sizeFactor:I.Numeric(.3,{min:0,max:10,step:.01}),sizeAspectRatio:I.Numeric(2/3,{min:0,max:3,step:.01}),tryUseImpostor:I.Boolean(!0),includeParent:I.Boolean(!1)});function Tae(e,t,r,n){return r.tryUseImpostor&&n&&n.extensions.fragDepth?Act(e):Pct(e)}function Act(e){return EZe({defaultProps:I.getDefaultValues(RA),createGeometry:wct,createLocationIterator:Nh.fromStructure,getLoci:_L,eachLocation:wL,setUpdateState:function(t,r,n){t.createGeometry=r.sizeAspectRatio!==n.sizeAspectRatio||r.linkScale!==n.linkScale||r.linkSpacing!==n.linkSpacing||r.ignoreHydrogens!==n.ignoreHydrogens||r.linkCap!==n.linkCap||r.dashCount!==n.dashCount||r.dashScale!==n.dashScale||r.dashCap!==n.dashCap||r.stubCap!==n.stubCap||!so(r.includeTypes,n.includeTypes)||!so(r.excludeTypes,n.excludeTypes)||r.adjustCylinderLength!==n.adjustCylinderLength},mustRecreate:function(t,r,n){return!r.tryUseImpostor||!n}},e)}function Pct(e){return om({defaultProps:I.getDefaultValues(RA),createGeometry:Ect,createLocationIterator:Nh.fromStructure,getLoci:_L,eachLocation:wL,setUpdateState:function(t,r,n){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.sizeAspectRatio!==n.sizeAspectRatio||r.radialSegments!==n.radialSegments||r.linkScale!==n.linkScale||r.linkSpacing!==n.linkSpacing||r.ignoreHydrogens!==n.ignoreHydrogens||r.linkCap!==n.linkCap||r.dashCount!==n.dashCount||r.dashScale!==n.dashScale||r.dashCap!==n.dashCap||r.stubCap!==n.stubCap||!so(r.includeTypes,n.includeTypes)||!so(r.excludeTypes,n.excludeTypes)||r.adjustCylinderLength!==n.adjustCylinderLength},mustRecreate:function(t,r,n){return r.tryUseImpostor&&!!n}},e)}var DG=new Float32Array([-1,1,-1,-1,1,1,1,-1]),zm=new Uint16Array([0,1,2,1,3,2]),dI=qe.add3,Tct=qe.add2,Ict=qe.add,l3;(function(e){function t(r,n,i){r===void 0&&(r=2048),n===void 0&&(n=1024),r*=4,n*=4;var a=qe.create(Float32Array,3,n,i?i.centerBuffer.ref.value:r),o=qe.create(Float32Array,2,n,i?i.mappingBuffer.ref.value:r),s=qe.create(Uint32Array,3,n/2,i?i.indexBuffer.ref.value:r/2),u=qe.create(Float32Array,1,n,i?i.groupBuffer.ref.value:r);return{add:function(l,c,d,f){for(var h=a.elementCount,v=0;v<4;++v)dI(a,l,c,d),Tct(o,DG[v*2],DG[v*2+1]),Ict(u,f);dI(s,h+zm[0],h+zm[1],h+zm[2]),dI(s,h+zm[3],h+zm[4],h+zm[5])},getSpheres:function(){var l=qe.compact(a,!0),c=qe.compact(o,!0),d=qe.compact(s,!0),f=qe.compact(u,!0);return Oh.create(l,c,d,f,a.elementCount/4,i)}}}e.create=t})(l3||(l3={}));var Iae=_.add;function EL(e,t,r){var n=r.ignoreHydrogens,i=r.traceOnly,a=t.model.atomicHierarchy.derived.atom.atomicNumber,o=je.isCoarse(t),s=e.child,u=s==null?void 0:s.unitMap.get(t.id);if(s&&!u)throw new Error("expected childUnit to exist if child exists");if(!(!s&&!n&&!i))return function(l){return!!u&&!Je.has(u.elements,l)||!o&&n&&Lw(a,l)||i&&!kF(t,l)}}function Mct(e,t,r,n,i,a){var o=r.child,s=o==null?void 0:o.unitMap.get(t.id);if(o&&!s)return Lt.createEmpty(a);for(var u=i.detail,l=i.sizeFactor,c=t.elements,d=c.length,f=d*iA(u),h=wt.createState(f,f/2,a),v=_(),p=t.conformation.invariantPosition,m=EL(r,t,i),g=Ze.create(r,t),y=n.size.size,b=_(),S=0,x=0,C=0;C<d;C++)if(!(m&&m(c[C]))){g.element=c[C],p(c[C],v),Iae(b,b,v),x+=1,h.currentGroup=C;var w=y(g);w>S&&(S=w),zi(h,v,w*l,u)}var A;_.scale(b,b,1/x),a&&_.distance(b,a.boundingSphere.center)/a.boundingSphere.radius<1?A=Be.clone(a.boundingSphere):A=Be.expand(Be(),(s??t).boundary.sphere,S*l+.05);var M=wt.getMesh(h);return M.setBoundingSphere(A),M}function Dct(e,t,r,n,i,a){var o=r.child,s=o==null?void 0:o.unitMap.get(t.id);if(o&&!s)return Oh.createEmpty(a);for(var u=t.elements,l=u.length,c=l3.create(l,l/2,a),d=_(),f=t.conformation.invariantPosition,h=EL(r,t,i),v=Ze.create(r,t),p=n.size.size,m=_(),g=0,y=0,b=0;b<l;b++)if(!(h!=null&&h(u[b]))){f(u[b],d),c.add(d[0],d[1],d[2],b),Iae(m,m,d),y+=1,v.element=u[b];var S=p(v);S>g&&(g=S)}var x;_.scale(m,m,1/y),a&&_.distance(m,a.boundingSphere.center)/a.boundingSphere.radius<1?x=Be.clone(a.boundingSphere):x=Be.expand(Be(),(s??t).boundary.sphere,g*i.sizeFactor+.05);var C=c.getSpheres();return C.setBoundingSphere(x),C}function oc(e,t,r){var n=!1;if(!Re.is(e))return!1;var i=t.structure,a=t.group;if(!We.areEquivalent(e.structure,i))return!1;for(var o=a.elements.length,s=0,u=e.elements;s<u.length;s++){var l=u[s],c=a.unitIndexMap.get(l.unit.id);if(c!==void 0){var d=c*o;if(Ie.is(l.indices)){var f=d+Ie.start(l.indices),h=d+Ie.end(l.indices);r(Ie.ofBounds(f,h))&&(n=!0)}else for(var v=0,p=l.indices.length;v<p;v++){for(var f=l.indices[v],m=v+1;m<p&&l.indices[m]===f;)m++;v=m-1;var h=l.indices[v];n=r(Ie.ofRange(d+f,d+h))||n}}}return n}function sc(e,t,r){var n=e.objectId,i=e.instanceId,a=e.groupId;if(r===n){var o=t.structure,s=t.group,u=s.units[i],l=Fe.ofSingleton(a);return Re(o.target,[{unit:u,indices:l}])}return jr}function kA(e,t,r){var n=!1;if(!Re.is(e)||!We.areEquivalent(e.structure,t))return!1;for(var i=t.serialMapping.cumulativeUnitElementCount,a=0,o=e.elements;a<o.length;a++){var s=o[a],u=t.unitIndexMap.get(s.unit.id);if(u!==void 0)if(Ie.is(s.indices)){var l=i[u]+Ie.start(s.indices),c=i[u]+Ie.end(s.indices);r(Ie.ofBounds(l,c))&&(n=!0)}else for(var d=0,f=s.indices.length;d<f;d++){var h=i[u]+s.indices[d];r(Ie.ofSingleton(h))&&(n=!0)}}return n}function OA(e,t,r){var n=e.objectId,i=e.groupId;if(r===n){var a=t.serialMapping,o=a.unitIndices,s=a.cumulativeUnitElementCount,u=o[i],l=t.units[u],c=i-s[u],d=Fe.ofSingleton(c);return Re(t,[{unit:l,indices:d}])}return jr}var Ya;(function(e){function t(n){var i=n.group,a=n.structure,o=i.elements.length,s=i.units.length,u=Ze.create(a),l=function(c,d){var f=i.units[d];return u.unit=f,u.element=f.elements[c],u};return wn(o,s,1,l)}e.fromGroup=t;function r(n){var i=n.units,a=n.elementCount,o=a,s=1,u=n.serialMapping,l=u.unitIndices,c=u.elementIndices,d=Ze.create(n),f=function(h){return d.unit=i[l[h]],d.element=c[h],d};return wn(o,s,1,f,!0)}e.fromStructure=r})(Ya||(Ya={}));var FA=E(E(E({},Ia),gne),{sizeFactor:I.Numeric(1,{min:0,max:10,step:.1}),detail:I.Numeric(0,{min:0,max:3,step:1},Et.CustomQualityParamInfo),ignoreHydrogens:I.Boolean(!1),traceOnly:I.Boolean(!1),tryUseImpostor:I.Boolean(!0)});function Mae(e,t,r,n){return r.tryUseImpostor&&n&&n.extensions.fragDepth?Rct(e):kct(e)}function Rct(e){return yne({defaultProps:I.getDefaultValues(FA),createGeometry:Dct,createLocationIterator:Ya.fromGroup,getLoci:sc,eachLocation:oc,setUpdateState:function(t,r,n){t.createGeometry=r.ignoreHydrogens!==n.ignoreHydrogens||r.traceOnly!==n.traceOnly},mustRecreate:function(t,r,n){return!r.tryUseImpostor||!n}},e)}function kct(e){return ho({defaultProps:I.getDefaultValues(FA),createGeometry:Mct,createLocationIterator:Ya.fromGroup,getLoci:sc,eachLocation:oc,setUpdateState:function(t,r,n){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.detail!==n.detail||r.ignoreHydrogens!==n.ignoreHydrogens||r.traceOnly!==n.traceOnly},mustRecreate:function(t,r,n){return r.tryUseImpostor&&!!n}},e)}var Dae={"element-sphere":function(e,t){return si("Element sphere",e,t,Mae)},"intra-bond":function(e,t){return si("Intra-unit bond cylinder",e,t,Aae)},"inter-bond":function(e,t){return Bu("Inter-unit bond cylinder",e,t,Tae)}},Rae=E(E(E(E(E({},FA),{traceOnly:I.Boolean(!1,{isHidden:!0})}),DA),RA),{includeParent:I.Boolean(!1),unitKinds:O2(["atomic"]),sizeFactor:I.Numeric(.15,{min:.01,max:10,step:.01}),sizeAspectRatio:I.Numeric(2/3,{min:.01,max:3,step:.01}),visuals:I.MultiSelect(["element-sphere","intra-bond","inter-bond"],I.objectToOptions(Dae))});function Oct(e,t){return I.clone(Rae)}function Fct(e,t){return ur.createMulti("Ball & Stick",e,t,Hi,Dae)}var Lct={name:"ball-and-stick",label:"Ball & Stick",description:"Displays atoms as spheres and bonds as cylinders.",factory:Fct,getParams:Oct,defaultValues:I.getDefaultValues(Rae),defaultColorTheme:{name:"element-symbol"},defaultSizeTheme:{name:"physical"},isApplicable:function(e){return e.elementCount>0},getData:function(e,t){return t.includeParent?e.asParent():e},mustRecreate:function(e,t){return e.includeParent!==t.includeParent}};function Nct(e,t,r,n,i){var a=t.carbohydrates,o=a.links,s=a.elements,u=n.linkSizeFactor,l=Ze.create(t),c={linkCount:o.length,position:function(d,f,h){var v=o[h];_.copy(d,s[v.carbohydrateIndexA].geometry.center),_.copy(f,s[v.carbohydrateIndexB].geometry.center)},radius:function(d){var f=o[d],h=s[f.carbohydrateIndexA],v=h.unit.rings.all[h.ringIndex];return l.unit=h.unit,l.element=h.unit.elements[v[0]],r.size.size(l)*u}};return lm(e,c,n,i)}var kae=E(E(E({},Ia),um),{linkSizeFactor:I.Numeric(.3,{min:0,max:3,step:.01})});function Bct(e){return om({defaultProps:I.getDefaultValues(kae),createGeometry:Nct,createLocationIterator:Uct,getLoci:jct,eachLocation:zct,setUpdateState:function(t,r,n){t.createGeometry=r.linkSizeFactor!==n.linkSizeFactor||r.radialSegments!==n.radialSegments||r.linkCap!==n.linkCap}},e)}function Uct(e){var t=e.carbohydrates,r=t.elements,n=t.links,i=n.length,a=1,o=Ze.create(e),s=function(u){var l=n[u],c=r[l.carbohydrateIndexA],d=c.unit.rings.all[c.ringIndex];return o.unit=c.unit,o.element=c.unit.elements[d[0]],o};return wn(i,a,1,s,!0)}function jct(e,t,r){var n=e.objectId,i=e.groupId;if(r===n){var a=t.carbohydrates,o=a.links,s=a.elements,u=o[i],l=s[u.carbohydrateIndexA],c=s[u.carbohydrateIndexB];return Re.union(r2(t,l.unit,l.residueIndex,l.altId),r2(t,c.unit,c.residueIndex,c.altId))}return jr}function zct(e,t,r){var n=!1;if(!Re.is(e)||!We.areEquivalent(e.structure,t))return!1;for(var i=t.carbohydrates.getLinkIndices,a=function(d,f){if(!je.isAtomic(d))return"continue";Fe.forEach(f,function(h){for(var v=i(d,d.elements[h]),p=0,m=v.length;p<m;++p)r(Ie.ofSingleton(v[p]))&&(n=!0)})},o=0,s=e.elements;o<s.length;o++){var u=s[o],l=u.unit,c=u.indices;a(l,c)}return n}var Vct=_.create(0,0,-.5),Hct=_.create(0,0,.5),hf=_(),pf=_(),ES=_(),RG=_();function Gct(e){for(var t=e.length/3,r=t===3?1:t===4?2:t,n=r+t,i=t===4?t*3+4:n*3,a=W0(n,i),o=0;o<t;++o){var s=(o+1)%t;_.set(hf,e[o*3],e[o*3+1],-.5),_.set(pf,e[s*3],e[s*3+1],-.5),a.add(hf,pf,Hct)}if(t===3)_.set(hf,e[0],e[1],-.5),_.set(pf,e[3],e[4],-.5),_.set(ES,e[6],e[7],-.5),a.add(ES,pf,hf);else if(t===4)_.set(hf,e[0],e[1],-.5),_.set(pf,e[3],e[4],-.5),_.set(ES,e[6],e[7],-.5),_.set(RG,e[9],e[10],-.5),a.addQuad(RG,ES,pf,hf);else for(var o=0;o<t;++o){var s=(o+1)%t;_.set(hf,e[o*3],e[o*3+1],-.5),_.set(pf,e[s*3],e[s*3+1],-.5),a.add(Vct,pf,hf)}return a.getPrimitive()}var fI;function qct(){return fI||(fI=Gct(ac(8,!0))),fI}var hI;function $ct(){if(!hI){for(var e=ac(8,!0),t=new Float32Array(8*3+6),r=0;r<8;++r)t[r*3]=e[r*3],t[r*3+1]=e[r*3+1],t[r*3+2]=-.5;t[8*3]=0,t[8*3+1]=0,t[8*3+2]=-.5,t[8*3+3]=0,t[8*3+4]=0,t[8*3+5]=.5;var n=[0,1,8,1,2,8,4,5,8,5,6,8,2,3,9,3,4,9,6,7,9,7,0,9];hI=rA(t,n)}return hI}var Wct={pointCount:5,outerRadius:1,innerRadius:.5,thickness:.3},pI=_.zero(),vI=_.zero(),mI=_.zero(),Vy=_.zero(),gI=_.zero();function Xct(e){for(var t=E(E({},Wct),e),r=t.outerRadius,n=t.innerRadius,i=t.thickness,a=t.pointCount,o=a*2*2,s=W0(o),u=new Float32Array(a*2),l=new Float32Array(a*2),c=0;c<a;++c){var d=c*2,f=c*2+1,h=(d+1)/a*Math.PI,v=(f+1)/a*Math.PI;l[d]=Math.cos(h)*r,l[f]=Math.sin(h)*r,u[d]=Math.cos(v)*n,u[f]=Math.sin(v)*n}_.set(pI,0,0,i/2),_.set(vI,0,0,-i/2);for(var c=0;c<a;++c){var p=(c+1)%a;_.set(mI,l[c*2],l[c*2+1],0),_.set(Vy,u[c*2],u[c*2+1],0),_.set(gI,l[p*2],l[p*2+1],0),s.add(pI,mI,Vy),s.add(Vy,mI,vI),s.add(pI,Vy,gI),s.add(gI,Vy,vI)}return s.getPrimitive()}var Oae=[.5,0,0,-.5,0,0,0,.5,0,0,-.5,0,0,0,.5,0,0,-.5],Yct=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],Kct=[0,2,4,0,4,3,1,2,5,1,5,3],yI;function Qct(){return yI||(yI=rA(Oae,Yct)),yI}var bI;function Zct(){return bI||(bI=rA(Oae,Kct)),bI}var Ot=ue.identity(),xc=_.zero(),kG=_.zero(),Jct=2*.806,OG=vF(),FG=Zje(),edt=qct(),LG=$ct(),tdt=Xct({outerRadius:1,innerRadius:.5,thickness:.5,pointCount:5}),rdt=Qct(),NG=Zct(),BG=bGe(),ndt=xGe(),idt=SGe(),adt=CGe(),odt=_Ge();function sdt(e,t,r,n,i){for(var a=wt.createState(256,128,i),o=n.detail,s=n.sizeFactor,u=t.carbohydrates,l=u.elements.length,c=Ze.create(t),d=0;d<l;++d){var f=u.elements[d],h=f.unit.rings.all[f.ringIndex],v=B6e(f.component.type,h.length);c.unit=f.unit,c.element=f.unit.elements[h[0]];var p=r.size.size(c),m=p*s,g=p*s*Jct,y=f.geometry,b=y.center,S=y.normal,x=y.direction;switch(_.add(kG,b,x),ue.targetTo(Ot,b,kG,S),ue.setTranslation(Ot,b),a.currentGroup=d*2,v){case 0:zi(a,b,m,o);break;case 1:ue.scaleUniformly(Ot,Ot,g),wt.addPrimitive(a,Ot,OG);break;case 2:ue.scaleUniformly(Ot,Ot,g),wt.addPrimitive(a,Ot,FG),ue.mul(Ot,Ot,ue.rotZ90X180),a.currentGroup+=1,wt.addPrimitive(a,Ot,FG);break;case 4:ue.scaleUniformly(Ot,Ot,g*1.2),wt.addPrimitive(a,Ot,edt);break;case 5:ue.scaleUniformly(Ot,Ot,g*1.2),wt.addPrimitive(a,Ot,LG),ue.mul(Ot,Ot,ue.rotZ90),a.currentGroup+=1,wt.addPrimitive(a,Ot,LG);break;case 6:ue.mul(Ot,Ot,ue.rotZY90),ue.scale(Ot,Ot,_.set(xc,g,g,g/2)),wt.addPrimitive(a,Ot,OG);break;case 7:ue.scaleUniformly(Ot,Ot,g),ue.mul(Ot,Ot,ue.rotZY90),wt.addPrimitive(a,Ot,tdt);break;case 8:ue.mul(Ot,Ot,ue.rotZY90),ue.scale(Ot,Ot,_.set(xc,g*1.4,g*1.4,g*1.4)),wt.addPrimitive(a,Ot,rdt);break;case 3:ue.mul(Ot,Ot,ue.rotZY90),ue.scale(Ot,Ot,_.set(xc,g*1.4,g*1.4,g*1.4)),wt.addPrimitive(a,Ot,NG),ue.mul(Ot,Ot,ue.rotY90),a.currentGroup+=1,wt.addPrimitive(a,Ot,NG);break;case 9:ue.mul(Ot,Ot,ue.rotZY90),ue.scale(Ot,Ot,_.set(xc,g,g/2,g/2)),wt.addPrimitive(a,Ot,BG);break;case 12:ue.mul(Ot,Ot,ue.rotZY90),ue.scale(Ot,Ot,_.set(xc,g,g,g/2)),wt.addPrimitive(a,Ot,BG);break;case 13:case 11:ue.mul(Ot,Ot,ue.rotZY90),ue.scale(Ot,Ot,_.set(xc,g,g,g/2)),wt.addPrimitive(a,Ot,ndt);break;case 14:ue.mul(Ot,Ot,ue.rotZY90),ue.scale(Ot,Ot,_.set(xc,g,g,g/2)),wt.addPrimitive(a,Ot,idt);break;case 15:ue.mul(Ot,Ot,ue.rotZY90),ue.scale(Ot,Ot,_.set(xc,g,g,g/2)),wt.addPrimitive(a,Ot,odt);break;case 10:default:ue.mul(Ot,Ot,ue.rotZYZ90),ue.scale(Ot,Ot,_.set(xc,g/1.5,g,g/2)),wt.addPrimitive(a,Ot,adt);break}}return wt.getMesh(a)}var Fae=E(E({},F2),{detail:I.Numeric(0,{min:0,max:3,step:1},Et.CustomQualityParamInfo),sizeFactor:I.Numeric(1.75,{min:0,max:10,step:.01})});function udt(e){return om({defaultProps:I.getDefaultValues(Fae),createGeometry:sdt,createLocationIterator:ldt,getLoci:cdt,eachLocation:ddt,setUpdateState:function(t,r,n){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.detail!==n.detail}},e)}function ldt(e){var t=e.carbohydrates.elements,r=t.length*2,n=1,i=Ze.create(e);function a(s,u){var l=t[Math.floor(s/2)],c=l.unit.rings.all[l.ringIndex];return i.unit=l.unit,i.element=l.unit.elements[c[0]],i}function o(s,u){return s%2===1}return wn(r,n,1,a,!0,o)}function cdt(e,t,r){var n=e.objectId,i=e.groupId;if(r===n){var a=t.carbohydrates.elements[Math.floor(i/2)];return r2(t,a.unit,a.residueIndex,a.altId)}return jr}function ddt(e,t,r){var n=t.carbohydrates.getElementIndices,i=!1;if(!Re.is(e)||!We.areEquivalent(e.structure,t))return!1;for(var a=function(d,f){if(!je.isAtomic(d))return"continue";Fe.forEach(f,function(h){for(var v=n(d,d.elements[h]),p=0,m=v.length;p<m;++p)r(Ie.ofSingleton(v[p]*2))&&(i=!0)})},o=0,s=e.elements;o<s.length;o++){var u=s[o],l=u.unit,c=u.indices;a(l,c)}return i}function fdt(e,t,r,n,i){var a=t.carbohydrates,o=a.terminalLinks,s=a.elements,u=n.terminalLinkSizeFactor,l=Ze.create(t),c={linkCount:o.length,position:function(d,f,h){var v=o[h];v.fromCarbohydrate?(_.copy(d,s[v.carbohydrateIndex].geometry.center),v.elementUnit.conformation.position(v.elementUnit.elements[v.elementIndex],f)):(v.elementUnit.conformation.position(v.elementUnit.elements[v.elementIndex],d),_.copy(f,s[v.carbohydrateIndex].geometry.center))},radius:function(d){var f=o[d];if(f.fromCarbohydrate){var h=s[f.carbohydrateIndex],v=h.unit.rings.all[h.ringIndex];l.unit=h.unit,l.element=h.unit.elements[v[0]]}else l.unit=f.elementUnit,l.element=f.elementUnit.elements[f.elementIndex];return r.size.size(l)*u},style:function(d){var f=o[d],h=f.elementUnit.elements[f.elementIndex],v=p0(f.elementUnit.model.atomicHierarchy.atoms.type_symbol.value(h));return Kb.has(v)?1:0}};return lm(e,c,n,i)}var Lae=E(E(E({},Ia),um),{terminalLinkSizeFactor:I.Numeric(.2,{min:0,max:3,step:.01})});function hdt(e){return om({defaultProps:I.getDefaultValues(Lae),createGeometry:fdt,createLocationIterator:pdt,getLoci:vdt,eachLocation:mdt,setUpdateState:function(t,r,n){t.createGeometry=r.terminalLinkSizeFactor!==n.terminalLinkSizeFactor||r.radialSegments!==n.radialSegments||r.linkCap!==n.linkCap}},e)}function pdt(e){var t=e.carbohydrates,r=t.elements,n=t.terminalLinks,i=n.length,a=1,o=Ze.create(e),s=function(u){var l=n[u];if(l.fromCarbohydrate){var c=r[l.carbohydrateIndex],d=c.unit.rings.all[c.ringIndex];o.unit=c.unit,o.element=c.unit.elements[d[0]]}else o.unit=l.elementUnit,o.element=l.elementUnit.elements[l.elementIndex];return o};return wn(i,a,1,s,!0)}function vdt(e,t,r){var n=e.objectId,i=e.groupId;if(r===n){var a=t.carbohydrates,o=a.terminalLinks,s=a.elements,u=o[i],l=s[u.carbohydrateIndex];return Re.union(r2(t,l.unit,l.residueIndex,l.altId),hZe(t,u.elementUnit,u.elementUnit.elements[u.elementIndex]))}return jr}function mdt(e,t,r){var n=!1;if(!Re.is(e)||!We.areEquivalent(e.structure,t))return!1;for(var i=t.carbohydrates.getTerminalLinkIndices,a=function(d,f){if(!je.isAtomic(d))return"continue";Fe.forEach(f,function(h){for(var v=i(d,d.elements[h]),p=0,m=v.length;p<m;++p)r(Ie.ofSingleton(v[p]))&&(n=!0)})},o=0,s=e.elements;o<s.length;o++){var u=s[o],l=u.unit,c=u.indices;a(l,c)}return n}var Nae={"carbohydrate-symbol":function(e,t){return Bu("Carbohydrate symbol mesh",e,t,udt)},"carbohydrate-link":function(e,t){return Bu("Carbohydrate link cylinder",e,t,Bct)},"carbohydrate-terminal-link":function(e,t){return Bu("Carbohydrate terminal link cylinder",e,t,hdt)}},Bae=E(E(E(E({},Fae),kae),Lae),{visuals:I.MultiSelect(["carbohydrate-symbol","carbohydrate-link","carbohydrate-terminal-link"],I.objectToOptions(Nae))});function gdt(e,t){return I.clone(Bae)}function ydt(e,t){return ur.createMulti("Carbohydrate",e,t,Hi,Nae)}var bdt={name:"carbohydrate",label:"Carbohydrate",description:"Displays carbohydrate symbols (3D SNFG).",factory:ydt,getParams:gdt,defaultValues:I.getDefaultValues(Bae),defaultColorTheme:{name:"carbohydrate-symbol"},defaultSizeTheme:{name:"uniform"},isApplicable:function(e){return e.models.some(function(t){return Xt.hasCarbohydrate(t)})}};function Uae(e,t){switch(e.kind){case 0:return xdt(e,t);case 1:case 2:return Sdt(e,t)}}function xdt(e,t){for(var r=e.model.atomicRanges.cyclicPolymerMap,n=nn.transientSegments(q2(e),e.elements),i=ar.transientSegments(e.model.atomicHierarchy.residueAtomSegments,e.elements),a=e.model.atomicHierarchy.derived.residue.traceElementIndex,o=e.model.atomicHierarchy.derived.residue.moleculeType,s=-1,u=-1,l=!0,c=-1,d=0;n.hasNext;){for(l=!0,c=d,i.setSegment(n.move());i.hasNext;){if(l){var f=i.move().index;if(++d,!i.hasNext)continue;l=!1,u=f}var h=i.move().index;s=u,u=h,t(a[s],a[u],d-1,d,o[s]),++d}r.has(u)&&(s=u,u=r.get(s),t(a[s],a[u],d-1,c,o[s]))}}function Sdt(e,t){for(var r=nn.transientSegments(q2(e),e.elements),n=e.elements,i=!0,a=0;r.hasNext;){i=!0;for(var o=r.move(),s=o.start,u=o.end,l=s,c=u;l<c;++l){if(i){if(++l,++a,l>c)continue;i=!1}t(n[l-1],n[l],a-1,a,0),++a}}}function jae(e,t){switch(e.kind){case 0:return Cdt(e,t);case 1:case 2:return _dt(e,t)}}function Cdt(e,t){for(var r=nn.transientSegments(q2(e),e.elements),n=ar.transientSegments(e.model.atomicHierarchy.residueAtomSegments,e.elements),i=e.model.atomicHierarchy.derived.residue.traceElementIndex,a=0;r.hasNext;)for(n.setSegment(r.move());n.hasNext;){var o=n.move().index;t(i[o],a),++a}}function _dt(e,t){for(var r=nn.transientSegments(q2(e),e.elements),n=e.elements,i=0;r.hasNext;)for(var a=r.move(),o=a.start,s=a.end,u=o,l=s;u<l;++u)t(n[u],i),++i}function wdt(e,t){switch(t.kind){case 0:return new Edt(e,t);case 1:case 2:return new Adt(e,t)}}function zae(e,t){return{centerA:Ze.create(e,t),centerB:Ze.create(e,t)}}var Edt=function(){function e(t,r){this.unit=r,this.hasNext=!1,this.traceElementIndex=r.model.atomicHierarchy.derived.residue.traceElementIndex,this.gapIt=nn.transientSegments(Gae(r),r.elements),this.value=zae(t,r),this.hasNext=this.gapIt.hasNext}return e.prototype.move=function(){var t=this.unit,r=t.elements,n=t.residueIndex,i=this.gapIt.move();return this.value.centerA.element=this.traceElementIndex[n[r[i.start]]],this.value.centerB.element=this.traceElementIndex[n[r[i.end-1]]],this.hasNext=this.gapIt.hasNext,this.value},e}(),Adt=function(){function e(t,r){this.unit=r,this.hasNext=!1,this.gapIt=nn.transientSegments(Gae(r),r.elements),this.value=zae(t,r),this.hasNext=this.gapIt.hasNext}return e.prototype.move=function(){var t=this.gapIt.move();return this.value.centerA.element=this.unit.elements[t.start],this.value.centerB.element=this.unit.elements[t.end-1],this.hasNext=this.gapIt.hasNext,this.value},e}();function Pdt(e){for(var t=e.atomicConformation,r=t.x,n=t.y,i=t.z,a=e.atomicHierarchy.derived.residue,o=a.polymerType,s=a.traceElementIndex,u=o.length,l=Fe.ofBounds(0,e.atomicConformation.atomId.rowCount),c=nn.transientSegments(e.atomicRanges.polymerRanges,l),d=ar.transientSegments(e.atomicHierarchy.residueAtomSegments,l),f=new Float32Array(u*3),h=new Float32Array(u*3),v=0,p=-1,m=-1,g=_(),y=_(),b=_(),S=_(),x=_(),C=_(),w=_(),A=_(),M=_(),D=_(),k=_(),R=_(),O=_(),H=_();c.hasNext;){var B=c.move();for(d.setSegment(B),v=-1,m=-1;d.hasNext;){v+=1;var j=d.move().index;v===0&&(m=j),p=j-2;var Y=p*3;_.copy(g,y),_.copy(y,b),_.copy(b,S);var G=s[j];if(_.set(S,r[G],n[G],i[G]),!(v<3)){_.sub(x,y,g),_.sub(C,b,y),_.sub(w,S,b),_.sub(k,x,C),_.sub(R,C,w),_.cross(O,k,R),_.normalize(O,O),_.toArray(O,h,Y);var $=Math.cos(_.angle(k,R)),q=_.magnitude(k),ee=_.magnitude(R),fe=Math.sqrt(ee*q)/Math.max(2,2*(1-$));_.scale(A,k,fe/q),_.sub(A,y,A),_.toArray(A,f,Y),_.scale(M,R,fe/ee),_.sub(M,b,M),_.toArray(M,f,Y+3),_.copy(H,O)}}var W=m*3;_.fromArray(A,f,W+3),_.fromArray(M,f,W+6),_.normalize(O,_.sub(O,A,M));var X=s[m];_.set(g,r[X],n[X],i[X]),_.copy(D,g),_.projectPointOnVector(D,D,O,A),_.toArray(D,f,W);var U=p+2,z=U*3;_.fromArray(A,f,z-3),_.fromArray(M,f,z-6),_.normalize(O,_.sub(O,A,M));var J=s[U];_.set(g,r[J],n[J],i[J]),_.copy(D,g),_.projectPointOnVector(D,D,O,A),_.toArray(D,f,z)}return{centers:f}}var ek=Fv.createProvider({label:"Helix Orientation",descriptor:ko({name:"molstar_helix_orientation"}),type:"dynamic",defaultParams:{},getParams:function(){return{}},isApplicable:function(e){return!0},obtain:function(e,t){return ce(void 0,void 0,void 0,function(){return de(this,function(r){return[2,{value:Pdt(t)}]})})}});function pu(e){return Vr.is(e,2)}function Tdt(e){return Vr.is(e,4)}function AL(e,t,r){switch(r===void 0&&(r={}),e.kind){case 0:return new Idt(e,t,r);case 1:case 2:return new Mdt(e,t)}}var DC=Vr.create(536870912);function Vae(e,t){return{center:Ze.create(e,t),centerPrev:Ze.create(e,t),centerNext:Ze.create(e,t),first:!1,last:!1,initial:!1,final:!1,secStrucFirst:!1,secStrucLast:!1,secStrucType:DC,moleculeType:0,coarseBackboneFirst:!1,coarseBackboneLast:!1,isCoarseBackbone:!1,p0:_(),p1:_(),p2:_(),p3:_(),p4:_(),d12:_(),d23:_()}}var Zt=_(),AS=_(),PS=_(),Idt=function(){function e(t,r,n){n===void 0&&(n={});var i;if(this.unit=t,this.state=0,this.p0=_(),this.p1=_(),this.p2=_(),this.p3=_(),this.p4=_(),this.p5=_(),this.p6=_(),this.d01=_(),this.d12=_(),this.d23=_(),this.d34=_(),this.hasNext=!1,this.atomicConformation=t.model.atomicConformation,this.residueAtomSegments=t.model.atomicHierarchy.residueAtomSegments,this.polymerRanges=t.model.atomicRanges.polymerRanges,this.traceElementIndex=t.model.atomicHierarchy.derived.residue.traceElementIndex,this.directionFromElementIndex=t.model.atomicHierarchy.derived.residue.directionFromElementIndex,this.directionToElementIndex=t.model.atomicHierarchy.derived.residue.directionToElementIndex,this.moleculeType=t.model.atomicHierarchy.derived.residue.moleculeType,this.cyclicPolymerMap=t.model.atomicRanges.cyclicPolymerMap,this.polymerIt=nn.transientSegments(this.polymerRanges,t.elements),this.residueIt=ar.transientSegments(this.residueAtomSegments,t.elements),this.value=Vae(r,t),this.hasNext=this.residueIt.hasNext&&this.polymerIt.hasNext,n.ignoreSecondaryStructure||(this.secondaryStructure=(i=tc.get(r).value)===null||i===void 0?void 0:i.get(t.invariantId)),n.useHelixOrientation){var a=ek.get(t.model).value;if(!a)throw new Error("missing helix-orientation");this.helixOrientationCenters=a.centers}}return e.prototype.atomicPos=function(t,r){r!==-1&&(t[0]=this.atomicConformation.x[r],t[1]=this.atomicConformation.y[r],t[2]=this.atomicConformation.z[r])},e.prototype.pos=function(t,r,n){var i=this.traceElementIndex[r];this.helixOrientationCenters&&pu(n)?_.fromArray(t,this.helixOrientationCenters,r*3):this.atomicPos(t,i)},e.prototype.updateResidueSegmentRange=function(t){var r=this.residueAtomSegments.index;this.residueSegmentMin=r[this.polymerRanges[t.index*2]],this.residueSegmentMax=r[this.polymerRanges[t.index*2+1]]},e.prototype.getResidueIndex=function(t){if(t<this.residueSegmentMin){var r=this.cyclicPolymerMap.get(this.residueSegmentMin);r!==void 0?t=r-(this.residueSegmentMin-t-1):t=this.residueSegmentMin}else if(t>this.residueSegmentMax){var r=this.cyclicPolymerMap.get(this.residueSegmentMax);r!==void 0?t=r+(t-this.residueSegmentMax-1):t=this.residueSegmentMax}return t},e.prototype.getSecStruc=function(t){if(this.secondaryStructure){var r=this.secondaryStructure,n=r.type,i=r.getIndex,a=n[i(t)];return pu(a)?2:a}else return DC},e.prototype.setControlPoint=function(t,r,n,i,a){Tdt(a)||this.helixOrientationCenters&&pu(a)?_.scale(t,_.add(t,r,_.add(t,i,_.add(t,n,n))),1/4):_.copy(t,n)},e.prototype.setFromToVector=function(t,r,n){this.value.isCoarseBackbone||this.helixOrientationCenters&&pu(n)?_.set(t,1,0,0):(this.atomicPos(AS,this.directionFromElementIndex[r]),this.atomicPos(PS,this.directionToElementIndex[r]),_.sub(t,PS,AS))},e.prototype.setDirection=function(t,r,n,i){_.matchDirection(AS,r,n),_.matchDirection(PS,i,n),_.scale(t,_.add(t,AS,_.add(t,PS,_.add(t,n,n))),1/4)},e.prototype.move=function(){var t=this,r=t.residueIt,n=t.polymerIt,i=t.value;if(this.state===0){for(;n.hasNext;)if(this.polymerSegment=n.move(),r.setSegment(this.polymerSegment),this.updateResidueSegmentRange(this.polymerSegment),r.hasNext){this.state=1;var a=this.residueAtomSegments.index[this.unit.elements[this.polymerSegment.start]],o=this.getResidueIndex(a-1);this.currSecStrucType=a===o?DC:this.getSecStruc(o),this.nextSecStrucType=this.getSecStruc(a),this.currCoarseBackbone=this.directionFromElementIndex[o]===-1||this.directionToElementIndex[o]===-1,this.nextCoarseBackbone=this.directionFromElementIndex[a]===-1||this.directionToElementIndex[a]===-1;break}}if(this.state===1){var s=r.move().index,u=this.getResidueIndex(s-3),l=this.getResidueIndex(s-2),c=this.getResidueIndex(s-1),d=this.getResidueIndex(s+1),f=this.getResidueIndex(s+2),h=this.getResidueIndex(s+3);this.prevSecStrucType=this.currSecStrucType,this.currSecStrucType=this.nextSecStrucType,this.nextSecStrucType=s===d?DC:this.getSecStruc(d),this.prevCoarseBackbone=this.currCoarseBackbone,this.currCoarseBackbone=this.nextCoarseBackbone,this.nextCoarseBackbone=this.directionFromElementIndex[d]===-1||this.directionToElementIndex[d]===-1,i.secStrucType=this.currSecStrucType,i.secStrucFirst=this.prevSecStrucType!==this.currSecStrucType,i.secStrucLast=this.currSecStrucType!==this.nextSecStrucType,i.isCoarseBackbone=this.currCoarseBackbone,i.coarseBackboneFirst=this.prevCoarseBackbone!==this.currCoarseBackbone,i.coarseBackboneLast=this.currCoarseBackbone!==this.nextCoarseBackbone,i.first=s===this.residueSegmentMin,i.last=s===this.residueSegmentMax,i.moleculeType=this.moleculeType[s],i.initial=s===c,i.final=s===d,i.centerPrev.element=this.traceElementIndex[c],i.center.element=this.traceElementIndex[s],i.centerNext.element=this.traceElementIndex[d];var v=this.getSecStruc(u),p=this.getSecStruc(l),m=this.getSecStruc(c),g=this.getSecStruc(s),y=this.getSecStruc(d),b=this.getSecStruc(f),S=this.getSecStruc(h);this.pos(this.p0,u,v),this.pos(this.p1,l,p),this.pos(this.p2,c,m),this.pos(this.p3,s,g),this.pos(this.p4,d,y),this.pos(this.p5,f,b),this.pos(this.p6,h,S);var x=pu(v),C=pu(p),w=pu(m),A=pu(g),M=pu(y),D=pu(b),k=pu(S);this.helixOrientationCenters&&(A!==w?A?(_.copy(this.p0,this.p3),_.copy(this.p1,this.p3),_.copy(this.p2,this.p3)):w&&(_.scale(Zt,_.sub(Zt,this.p2,this.p3),2),_.add(this.p2,this.p3,Zt),_.add(this.p1,this.p2,Zt),_.add(this.p0,this.p1,Zt)):A!==C?A?(_.copy(this.p0,this.p2),_.copy(this.p1,this.p2)):C&&(_.scale(Zt,_.sub(Zt,this.p1,this.p2),2),_.add(this.p1,this.p2,Zt),_.add(this.p0,this.p1,Zt)):A!==x&&(A?_.copy(this.p0,this.p1):x&&(_.scale(Zt,_.sub(Zt,this.p0,this.p1),2),_.add(this.p0,this.p1,Zt))),A!==M?A?(_.copy(this.p4,this.p3),_.copy(this.p5,this.p3),_.copy(this.p6,this.p3)):M&&(_.scale(Zt,_.sub(Zt,this.p4,this.p3),2),_.add(this.p4,this.p3,Zt),_.add(this.p5,this.p4,Zt),_.add(this.p6,this.p5,Zt)):A!==D?A?(_.copy(this.p5,this.p4),_.copy(this.p6,this.p4)):D&&(_.scale(Zt,_.sub(Zt,this.p5,this.p4),2),_.add(this.p5,this.p4,Zt),_.add(this.p6,this.p5,Zt)):A!==k&&(A?_.copy(this.p6,this.p5):k&&(_.scale(Zt,_.sub(Zt,this.p6,this.p5),2),_.add(this.p6,this.p5,Zt)))),this.setFromToVector(this.d01,c,m),this.setFromToVector(this.d12,s,g),this.setFromToVector(this.d23,d,y),this.setFromToVector(this.d34,f,b);var R=A&&this.helixOrientationCenters,O=1.5;s===c||g!==m&&R?(_.setMagnitude(Zt,_.sub(Zt,this.p3,this.p4),O),_.add(this.p2,this.p3,Zt),_.add(this.p1,this.p2,Zt),_.add(this.p0,this.p1,Zt)):c===l||g!==p&&R?(_.setMagnitude(Zt,_.sub(Zt,this.p2,this.p3),O),_.add(this.p1,this.p2,Zt),_.add(this.p0,this.p1,Zt)):(l===u||g!==v&&R)&&(_.setMagnitude(Zt,_.sub(Zt,this.p1,this.p2),O),_.add(this.p0,this.p1,Zt)),s===d||g!==y&&R?(_.setMagnitude(Zt,_.sub(Zt,this.p3,this.p2),O),_.add(this.p4,this.p3,Zt),_.add(this.p5,this.p4,Zt),_.add(this.p6,this.p5,Zt)):d===f||g!==b&&R?(_.setMagnitude(Zt,_.sub(Zt,this.p4,this.p3),O),_.add(this.p5,this.p4,Zt),_.add(this.p6,this.p5,Zt)):(f===h||g!==S&&R)&&(_.setMagnitude(Zt,_.sub(Zt,this.p5,this.p4),O),_.add(this.p6,this.p5,Zt)),this.setControlPoint(i.p0,this.p0,this.p1,this.p2,p),this.setControlPoint(i.p1,this.p1,this.p2,this.p3,m),this.setControlPoint(i.p2,this.p2,this.p3,this.p4,g),this.setControlPoint(i.p3,this.p3,this.p4,this.p5,y),this.setControlPoint(i.p4,this.p4,this.p5,this.p6,b),this.setDirection(i.d12,this.d01,this.d12,this.d23),this.setDirection(i.d23,this.d12,this.d23,this.d34),r.hasNext||(this.state=0)}return this.hasNext=r.hasNext||n.hasNext,this.value},e}(),Mdt=function(){function e(t,r){switch(this.unit=t,this.state=0,this.hasNext=!1,this.polymerIt=nn.transientSegments(q2(t),t.elements),this.value=Vae(r,t),_.set(this.value.d12,1,0,0),_.set(this.value.d23,1,0,0),t.kind){case 1:this.conformation=t.model.coarseConformation.spheres;break;case 2:this.conformation=t.model.coarseConformation.gaussians;break}this.hasNext=this.polymerIt.hasNext}return e.prototype.getElementIndex=function(t){return Math.min(Math.max(this.polymerSegment.start,t),this.polymerSegment.end-1)},e.prototype.pos=function(t,r){var n=this.unit.elements[r];t[0]=this.conformation.x[n],t[1]=this.conformation.y[n],t[2]=this.conformation.z[n]},e.prototype.move=function(){if(this.state===0){for(;this.polymerIt.hasNext;)if(this.polymerSegment=this.polymerIt.move(),this.elementIndex=this.polymerSegment.start,this.elementIndex<this.polymerSegment.end){this.state=1;break}}if(this.state===1){var t=this.getElementIndex(this.elementIndex-2),r=this.getElementIndex(this.elementIndex-1),n=this.getElementIndex(this.elementIndex+1),i=this.getElementIndex(this.elementIndex+2);this.value.centerPrev.element=this.value.center.unit.elements[r],this.value.center.element=this.value.center.unit.elements[this.elementIndex],this.value.centerNext.element=this.value.center.unit.elements[n],this.pos(this.value.p0,t),this.pos(this.value.p1,r),this.pos(this.value.p2,this.elementIndex),this.pos(this.value.p3,n),this.pos(this.value.p4,i);var a=.5;this.elementIndex===r?(_.scale(Zt,_.sub(Zt,this.value.p2,this.value.p3),a),_.add(this.value.p1,this.value.p2,Zt),_.add(this.value.p0,this.value.p1,Zt)):r===t&&(_.scale(Zt,_.sub(Zt,this.value.p1,this.value.p2),a),_.add(this.value.p0,this.value.p1,Zt)),this.elementIndex===n?(_.scale(Zt,_.sub(Zt,this.value.p2,this.value.p1),a),_.add(this.value.p3,this.value.p2,Zt),_.add(this.value.p4,this.value.p3,Zt)):n===i&&(_.scale(Zt,_.sub(Zt,this.value.p3,this.value.p2),a),_.add(this.value.p4,this.value.p3,Zt)),this.value.first=this.elementIndex===this.polymerSegment.start,this.value.last=this.elementIndex===this.polymerSegment.end-1,this.elementIndex+1>=this.polymerSegment.end&&(this.state=0)}return this.hasNext=this.elementIndex+1<this.polymerSegment.end||this.polymerIt.hasNext,this.elementIndex+=1,this.value},e}(),fp=_.fromArray,xg=_.toArray,tk=_.normalize,Ddt=_.sub,Vm=_.spline,Rdt=_.slerp,UG=_.copy,jG=_.cross,xI=_.orthogonalize,kdt=_.matchDirection,Odt=_.scale,zG=_.add;function PL(e){var t=e+1,r=t*3;return{curvePoints:new Float32Array(r),tangentVectors:new Float32Array(r),normalVectors:new Float32Array(r),binormalVectors:new Float32Array(r),widthValues:new Float32Array(t),heightValues:new Float32Array(t),linearSegments:e}}function TL(e,t,r,n){Fdt(e,t,r,n),Ndt(e,t)}var SI=_(),CI=_(),_I=_();function Fdt(e,t,r,n){for(var i=e.curvePoints,a=e.tangentVectors,o=e.linearSegments,s=t.p0,u=t.p1,l=t.p2,c=t.p3,d=t.p4,f=t.secStrucFirst,h=t.secStrucLast,v=1-n,p=f?.5:r,m=h?.5:r,g=0;g<=o;++g){var y=g*1/o;if(y<v){var b=es(p,r,y);Vm(_I,s,u,l,c,y+n,b),Vm(SI,s,u,l,c,y+n+.01,p),Vm(CI,s,u,l,c,y+n-.01,p)}else{var b=es(r,m,y);Vm(_I,u,l,c,d,y-v,b),Vm(SI,u,l,c,d,y-v+.01,b),Vm(CI,u,l,c,d,y-v-.01,b)}xg(_I,i,g*3),tk(Hf,Ddt(Hf,SI,CI)),xg(Hf,a,g*3)}}var Ldt=_(),Hf=_(),vu=_(),Hm=_(),Hy=_(),VG=_(),HG=_(),GG=_(),wI=_(),TS=_();function Ndt(e,t){var r=e.curvePoints,n=e.tangentVectors,i=e.normalVectors,a=e.binormalVectors,o=t.d12,s=t.d23,u=r.length/3;fp(HG,n,0),fp(GG,n,(u-1)*3),xI(wI,HG,o),xI(TS,GG,s),kdt(TS,TS,wI),UG(Hy,wI);for(var l=u-1,c=0;c<u;++c){var d=vZ(0,l,c)*l,f=c===0?0:1/(u-d);fp(Hf,n,c*3),xI(vu,Hf,Rdt(Ldt,Hy,TS,f)),xg(vu,i,c*3),UG(Hy,vu),tk(Hm,jG(Hm,Hf,vu)),xg(Hm,a,c*3)}for(var c=1;c<l;++c)fp(Hy,i,(c-1)*3),fp(vu,i,c*3),fp(VG,i,(c+1)*3),Odt(vu,zG(vu,Hy,zG(vu,VG,vu)),1/3),xg(vu,i,c*3),fp(Hf,n,c*3),tk(Hm,jG(Hm,Hf,vu)),xg(Hm,a,c*3)}function rk(e,t,r,n,i,a,o,s){for(var u=e.widthValues,l=e.heightValues,c=e.linearSegments,d=1-s,f=0;f<=c;++f){var h=f*1/c;h<d?(u[f]=es(t,r,h+s),l[f]=es(i,a,h+s)):(u[f]=es(r,n,h-d),l[f]=es(a,o,h-d))}}var Hae=.5,Bdt=.9,LA=.5,NA=.3,c3=2;function q2(e){switch(e.kind){case 0:return e.model.atomicRanges.polymerRanges;case 1:return e.model.coarseHierarchy.spheres.polymerRanges;case 2:return e.model.coarseHierarchy.gaussians.polymerRanges}}function Gae(e){switch(e.kind){case 0:return e.model.atomicRanges.gapRanges;case 1:return e.model.coarseHierarchy.spheres.gapRanges;case 2:return e.model.coarseHierarchy.gaussians.gapRanges}}var Ad;(function(e){function t(r){var n=r.group,i=r.structure,a=n.units[0].polymerElements,o=a.length,s=n.units.length,u=Ze.create(i),l=function(c,d){var f=n.units[d];return u.unit=f,u.element=a[c],u};return wn(o,s,1,l)}e.fromGroup=t})(Ad||(Ad={}));var nk;(function(e){function t(r){var n=r.group,i=r.structure,a=n.units[0].gapElements,o=a.length,s=n.units.length,u=Ze.create(i),l=function(c,d){var f=n.units[d];return u.unit=f,u.element=a[c],u};return wn(o,s,1,l)}e.fromGroup=t})(nk||(nk={}));function hm(e,t,r){var n=e.objectId,i=e.instanceId,a=e.groupId;if(r===n){var o=t.structure,s=t.group,u=s.units[i];if(je.isAtomic(u))return one(o,u,u.polymerElements[a]);var l=u.elements,c=u.polymerElements[a],d=Fe.indexOf(l,c);if(d!==-1){var f=Fe.ofSingleton(d);return Re(o,[{unit:u,indices:f}])}}return jr}function qG(e,t,r,n,i,a){for(var o=-1,s=-1,u=i;u<=a;u++){var l=r[u];if(!(l<0)&&(o=Fe.indexOf(t,l),o>=0)){s=u;break}}if(o<0)return!1;for(var c=o,u=a;u>s;u--){var l=r[u];if(!(l<0)){var d=Fe.indexOf(t,l);if(d>=0){c=d;break}}}return n(Ie.ofRange(e+o,e+c))}function qae(e,t,r,n,i){var a=!1,o=i.unit.elements,s=i.unit.model.atomicHierarchy.derived.residue.traceElementIndex,u=i.unit.model.atomicHierarchy.residueAtomSegments.index,l=r(i.unit);if(Ie.is(i.indices))if(Ie.start(i.indices)===0&&Ie.end(i.indices)===i.unit.elements.length)a=n(Ie.ofBounds(e,e+t))||a;else{var c=u[o[Ie.min(i.indices)]],d=u[o[Ie.max(i.indices)]];a=qG(e,l,s,n,c,d)||a}else for(var f=i.indices,h=0,v=f.length;h<v;h++){for(var c=u[o[f[h]]],d=c,p=h+1;p<v;){var m=u[o[f[p]]];if(m-d>1)break;d=m,p++}h=p-1,a=qG(e,l,s,n,c,d)||a}return a}function Udt(e){return e.polymerElements}function pm(e,t,r){var n=!1;if(!Re.is(e))return!1;var i=t.structure,a=t.group;if(!We.areEquivalent(e.structure,i))return!1;for(var o=a.units[0].polymerElements.length,s=0,u=e.elements;s<u.length;s++){var l=u[s];if(a.unitIndexMap.has(l.unit.id)){var c=a.unitIndexMap.get(l.unit.id)*o;if(je.isAtomic(l.unit))n=qae(c,o,Udt,r,l)||n;else if(Ie.is(l.indices)){var d=c+Ie.start(l.indices),f=c+Ie.end(l.indices);n=r(Ie.ofBounds(d,f))||n}else for(var h=0,v=l.indices.length;h<v;h++){for(var d=l.indices[h],p=h+1;p<v&&l.indices[p]===d;)p++;h=p-1;var f=l.indices[h];n=r(Ie.ofRange(c+d,c+f))||n}}}return n}function jdt(e,t,r){var n=e.objectId,i=e.instanceId,a=e.groupId;if(r===n){var o=t.structure,s=t.group,u=s.units[i],l=Fe.indexOf(u.elements,u.gapElements[a]),c=Fe.indexOf(u.elements,u.gapElements[a%2?a-1:a+1]);if(l!==-1&&c!==-1)return Ht.Loci(o,[Ht.Location(o,u,l,o,u,c),Ht.Location(o,u,c,o,u,l)])}return jr}function zdt(e,t,r){var n=!1;if(Ht.isLoci(e)){var i=t.structure,a=t.group;if(!We.areRootsEquivalent(e.structure,i))return!1;e=Ht.remapLoci(e,i);for(var o=a.units[0].gapElements.length,s=0,u=e.bonds;s<u.length;s++){var l=u[s],c=a.unitIndexMap.get(l.aUnit.id);if(c!==void 0){var d=Fe.indexOf(l.aUnit.gapElements,l.aUnit.elements[l.aIndex]),f=Fe.indexOf(l.bUnit.gapElements,l.bUnit.elements[l.bIndex]);d!==-1&&f!==-1&&r(Ie.ofSingleton(c*o+d))&&(n=!0)}}}else if(Re.is(e)){var i=t.structure,a=t.group;if(!We.areRootsEquivalent(e.structure,i))return!1;e=Re.remap(e,i);for(var h=a.units[0].gapElements.length,v=function(S){var x=a.unitIndexMap.get(S.unit.id);x!==void 0&&Fe.forEach(S.indices,function(C){var w=Fe.indexOf(S.unit.gapElements,S.unit.elements[C]);w!==-1&&r(Ie.ofSingleton(x*h+w))&&(n=!0)})},p=0,m=e.elements;p<m.length;p++){var g=m[p];v(g)}}return n}var d3;(function(e){function t(r){var n=r.group,i=r.structure,a=n.units[0],o=je.isAtomic(a)?a.nucleotideElements:[],s=o.length,u=n.units.length,l=Ze.create(i),c=function(d,f){var h=n.units[f];return l.unit=h,l.element=o[d],l};return wn(s,u,1,c)}e.fromGroup=t})(d3||(d3={}));function $ae(e,t,r){var n=e.objectId,i=e.instanceId,a=e.groupId;if(r===n){var o=t.structure,s=t.group,u=s.units[i];if(je.isAtomic(u))return one(o,u,u.nucleotideElements[a])}return jr}function Vdt(e){return e.nucleotideElements}function Wae(e,t,r){var n=!1;if(!Re.is(e))return!1;var i=t.structure,a=t.group;if(!We.areEquivalent(e.structure,i))return!1;var o=a.units[0];if(!je.isAtomic(o))return!1;for(var s=o.nucleotideElements,u=s.length,l=0,c=e.elements;l<c.length;l++){var d=c[l];if(je.isAtomic(d.unit)&&a.unitIndexMap.has(d.unit.id)){var f=a.unitIndexMap.get(d.unit.id)*u;je.isAtomic(d.unit)&&(n=qae(f,u,Vdt,r,d)||n)}}return n}var Gy=_.zero(),IS=_.zero(),$G=_.zero(),WG=_.zero(),XG=_.zero(),YG=_.zero(),MS=_.zero(),EI=_.zero(),AI=_.zero(),KG=_.zero(),qy=ue.identity(),Hdt=_.zero(),QG=vF(),Xae={sizeFactor:I.Numeric(.2,{min:0,max:10,step:.01}),radialSegments:I.Numeric(16,{min:2,max:56,step:2},Et.CustomQualityParamInfo)};I.getDefaultValues(Xae);function Gdt(e,t,r,n,i,a){if(!je.isAtomic(t))return Lt.createEmpty(a);var o=t.nucleotideElements.length;if(!o)return Lt.createEmpty(a);for(var s=i.sizeFactor,u=i.radialSegments,l=o*(QG.vertices.length/3+u*2),c=wt.createState(l,l/4,a),d=t.elements,f=t.model,h=f.atomicHierarchy,v=h.chainAtomSegments,p=h.residueAtomSegments,m=h.atoms,g=h.index,y=f.atomicHierarchy.derived.residue,b=y.moleculeType,S=y.traceElementIndex,x=m.label_comp_id,C=t.conformation.invariantPosition,w=ar.transientSegments(v,d),A=ar.transientSegments(p,d),M={radiusTop:1*s,radiusBottom:1*s,radialSegments:u,bottomCap:!0},D=0;w.hasNext;)for(A.setSegment(w.move());A.hasNext;){var k=A.move().index;if(ic(b[k])){var R=x.value(p.offsets[k]),O=-1,H=-1,B=-1,j=-1,Y=-1,G=-1,$=4.5,q=4.5,ee=2.5*s,fe=kJ(R),W=OJ(R);if(!fe&&!W){var X=g.findAtomOnResidue(k,"C4"),U=g.findAtomOnResidue(k,"N9");X!==-1&&U!==-1&&_.distance(C(X,Gy),C(U,IS))<1.6?fe=!0:W=!0}fe?(q=4.5,O=g.findAtomOnResidue(k,"N1"),H=g.findAtomOnResidue(k,"C4"),B=g.findAtomOnResidue(k,"C6"),j=g.findAtomOnResidue(k,"C2"),Y=g.findAtomOnResidue(k,"N9"),G=S[k]):W&&(q=3,O=g.findAtomOnResidue(k,"N3"),H=g.findAtomOnResidue(k,"C6"),B=g.findAtomOnResidue(k,"C4"),j=g.findAtomOnResidue(k,"C2"),Y=g.findAtomOnResidue(k,"N1"),Y===-1&&(Y=g.findAtomOnResidue(k,"C1")),G=S[k]),Y!==-1&&G!==-1&&(C(Y,XG),C(G,YG),c.currentGroup=D,Ha(c,XG,YG,1,M),O!==-1&&H!==-1&&B!==-1&&j!==-1&&(C(O,Gy),C(H,IS),C(B,$G),C(j,WG),_.normalize(MS,_.sub(MS,IS,Gy)),_.normalize(EI,_.sub(EI,WG,$G)),_.normalize(AI,_.cross(AI,MS,EI)),ue.targetTo(qy,Gy,IS,AI),_.scaleAndAdd(KG,Gy,MS,q/2-.2),ue.scale(qy,qy,_.set(Hdt,$,ee,q)),ue.setTranslation(qy,KG),wt.addPrimitive(c,qy,QG))),++D}}var z=wt.getMesh(c),J=Be.expand(Be(),t.boundary.sphere,1*i.sizeFactor);return z.setBoundingSphere(J),z}var Yae=E(E({},Ia),Xae);function qdt(e){return ho({defaultProps:I.getDefaultValues(Yae),createGeometry:Gdt,createLocationIterator:d3.fromGroup,getLoci:$ae,eachLocation:Wae,setUpdateState:function(t,r,n){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.radialSegments!==n.radialSegments}},e)}var DS=_.zero(),vf=_.zero(),RS=_.zero(),kS=_.zero(),hp=_.zero(),Gm=_.zero(),OS=_.zero(),ZG=_.zero(),JG=_.zero(),$y=_.zero(),mf=_.zero(),Kae={sizeFactor:I.Numeric(.2,{min:0,max:10,step:.01}),radialSegments:I.Numeric(16,{min:2,max:56,step:2},Et.CustomQualityParamInfo),detail:I.Numeric(0,{min:0,max:3,step:1},Et.CustomQualityParamInfo)};I.getDefaultValues(Kae);var FS=new Float32Array(2*9*3),$dt=new Uint32Array([0,1,2,3,4,5,6,7,16,17,14,15,12,13,8,9,10,11,0,1]),Wdt=new Uint32Array([8,12,14,16,6,4,2,0,10]),Xdt=new Uint32Array([9,11,1,3,5,7,17,15,13]),LS=new Float32Array(2*6*3),Ydt=new Uint32Array([0,1,2,3,4,5,6,7,8,9,10,11,0,1]),Kdt=new Uint32Array([0,10,8,6,4,2]),Qdt=new Uint32Array([1,3,5,7,9,11]),eq=_.zero();function tq(e,t){for(var r=[],n=2;n<arguments.length;n++)r[n-2]=arguments[n];for(var i=0,a=r.length;i<a;++i){var o=r[i];_.toArray(_.add(eq,o,t),e,i*2*3),_.toArray(_.sub(eq,o,t),e,(i*2+1)*3)}}function Zdt(e,t,r,n,i,a){if(!je.isAtomic(t))return Lt.createEmpty(a);var o=t.nucleotideElements.length;if(!o)return Lt.createEmpty(a);for(var s=i.sizeFactor,u=i.radialSegments,l=i.detail,c=o*(26+u*2),d=wt.createState(c,c/4,a),f=t.elements,h=t.model,v=h.atomicHierarchy,p=v.chainAtomSegments,m=v.residueAtomSegments,g=v.atoms,y=v.index,b=h.atomicHierarchy.derived.residue,S=b.moleculeType,x=b.traceElementIndex,C=g.label_comp_id,w=t.conformation.invariantPosition,A=ar.transientSegments(p,f),M=ar.transientSegments(m,f),D=1*s,k=1.25*s,R={radiusTop:1*s,radiusBottom:1*s,radialSegments:u},O=0;A.hasNext;)for(M.setSegment(A.move());M.hasNext;){var H=M.move().index;if(ic(S[H])){var B=C.value(m.offsets[H]),j=-1,Y=-1,G=-1,$=-1,q=-1,ee=-1,fe=-1,W=-1,X=-1,U=-1;d.currentGroup=O;var z=kJ(B),J=OJ(B);if(!z&&!J){var K=y.findAtomOnResidue(H,"C4"),Z=y.findAtomOnResidue(H,"N9");K!==-1&&Z!==-1&&_.distance(w(K,hp),w(Z,$y))<1.6?z=!0:J=!0}z?(j=x[H],Y=y.findAtomOnResidue(H,"N1"),G=y.findAtomOnResidue(H,"C2"),$=y.findAtomOnResidue(H,"N3"),q=y.findAtomOnResidue(H,"C4"),ee=y.findAtomOnResidue(H,"C5"),ee===-1&&(ee=y.findAtomOnResidue(H,"N5")),fe=y.findAtomOnResidue(H,"C6"),W=y.findAtomOnResidue(H,"N7"),W===-1&&(W=y.findAtomOnResidue(H,"C7")),X=y.findAtomOnResidue(H,"C8"),U=y.findAtomOnResidue(H,"N9"),U!==-1&&j!==-1&&(w(U,$y),w(j,DS),d.currentGroup=O,Ha(d,$y,DS,1,R),zi(d,$y,D,l)),Y!==-1&&G!==-1&&$!==-1&&q!==-1&&ee!==-1&&fe!==-1&&W!==-1&&X!==-1&&U!==-1&&(w(Y,vf),w(G,RS),w($,kS),w(q,hp),w(ee,Gm),w(fe,OS),w(W,ZG),w(X,JG),_.triangleNormal(mf,vf,hp,Gm),_.scale(mf,mf,k),tq(FS,mf,vf,RS,kS,hp,Gm,OS,ZG,JG,$y),wt.addTriangleStrip(d,FS,$dt),wt.addTriangleFan(d,FS,Wdt),wt.addTriangleFan(d,FS,Xdt))):J&&(j=x[H],Y=y.findAtomOnResidue(H,"N1"),Y===-1&&(Y=y.findAtomOnResidue(H,"C1")),G=y.findAtomOnResidue(H,"C2"),$=y.findAtomOnResidue(H,"N3"),q=y.findAtomOnResidue(H,"C4"),ee=y.findAtomOnResidue(H,"C5"),fe=y.findAtomOnResidue(H,"C6"),Y!==-1&&j!==-1&&(w(Y,vf),w(j,DS),d.currentGroup=O,Ha(d,vf,DS,1,R),zi(d,vf,D,l)),Y!==-1&&G!==-1&&$!==-1&&q!==-1&&ee!==-1&&fe!==-1&&(w(G,RS),w($,kS),w(q,hp),w(ee,Gm),w(fe,OS),_.triangleNormal(mf,vf,hp,Gm),_.scale(mf,mf,k),tq(LS,mf,vf,RS,kS,hp,Gm,OS),wt.addTriangleStrip(d,LS,Ydt),wt.addTriangleFan(d,LS,Kdt),wt.addTriangleFan(d,LS,Qdt))),++O}}var te=wt.getMesh(d),le=Be.expand(Be(),t.boundary.sphere,1*i.sizeFactor);return te.setBoundingSphere(le),te}var Qae=E(E({},Ia),Kae);function Jdt(e){return ho({defaultProps:I.getDefaultValues(Qae),createGeometry:Zdt,createLocationIterator:d3.fromGroup,getLoci:$ae,eachLocation:Wae,setUpdateState:function(t,r,n){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.radialSegments!==n.radialSegments}},e)}var pp=_.zero(),qm=_.zero(),vp=_.zero(),rq=_.zero(),Ii=ac(3,!1);function eft(){for(var e=W0(8),t=0;t<3;++t){var r=(t+1)%3;_.set(pp,Ii[t*3],Ii[t*3+1],-.5),_.set(qm,Ii[r*3],Ii[r*3+1],-.5),_.set(vp,Ii[r*3],Ii[r*3+1],.5),_.set(rq,Ii[t*3],Ii[t*3+1],.5),e.add(pp,qm,vp),e.add(vp,rq,pp)}return _.set(pp,Ii[0],Ii[1],-.5),_.set(qm,Ii[3],Ii[4],-.5),_.set(vp,Ii[6],Ii[7],-.5),e.add(vp,qm,pp),_.set(pp,Ii[0],Ii[1],.5),_.set(qm,Ii[3],Ii[4],.5),_.set(vp,Ii[6],Ii[7],.5),e.add(pp,qm,vp),e.getPrimitive()}var PI;function tft(){return PI||(PI=eft()),PI}var mp=ue.identity(),rft=_.zero(),nq=_.zero(),iq=_.zero(),TI=_.zero(),nft=4,ift=4,aft=6,oft=tft(),Zae={sizeFactor:I.Numeric(.2,{min:0,max:10,step:.01})};I.getDefaultValues(Zae);function sft(e,t,r,n,i,a){var o=t.polymerElements.length;if(!o)return Lt.createEmpty(a);for(var s=i.sizeFactor,u=o*24,l=wt.createState(u,u/10,a),c=1,d=PL(c),f=d.normalVectors,h=d.binormalVectors,v=0,p=AL(t,r);p.hasNext;){var m=p.move();l.currentGroup=v;var g=ic(m.moleculeType),y=Vr.is(m.secStrucType,4),b=g||y?.5:.9,S=g?.3:.5;if(TL(d,m,b,S),y&&!m.secStrucLast||!y){var x=n.size.size(m.center)*s,C=nft*x,w=ift*x,A=aft*x,M=g?h:f;_.fromArray(nq,M,0),_.fromArray(iq,M,3),_.normalize(TI,_.add(TI,nq,iq)),ue.targetTo(mp,m.p3,m.p1,TI),ue.mul(mp,mp,ue.rotY90Z180),ue.scale(mp,mp,_.set(rft,A,w,C)),ue.setTranslation(mp,m.p2),wt.addPrimitive(l,mp,oft)}++v}var D=wt.getMesh(l),k=Be.expand(Be(),t.boundary.sphere,1*i.sizeFactor);return D.setBoundingSphere(k),D}var Jae=E(E({},Ia),Zae);function uft(e){return ho({defaultProps:I.getDefaultValues(Jae),createGeometry:sft,createLocationIterator:Ad.fromGroup,getLoci:hm,eachLocation:pm,setUpdateState:function(t,r,n){t.createGeometry=r.sizeFactor!==n.sizeFactor}},e)}var II=10,eoe={sizeFactor:I.Numeric(.2,{min:0,max:10,step:.01}),radialSegments:I.Numeric(16,{min:2,max:56,step:2},Et.CustomQualityParamInfo)};I.getDefaultValues(eoe);function lft(e,t,r,n,i,a){var o=t.gapElements.length;if(!o)return Lt.createEmpty(a);for(var s=i.sizeFactor,u=i.radialSegments,l=II*u*2*o*2,c=wt.createState(l,l/10,a),d=t.conformation.invariantPosition,f=_.zero(),h=_.zero(),v={radiusTop:1,radiusBottom:1,topCap:!0,bottomCap:!0,radialSegments:u},p=0,m=wdt(r,t);m.hasNext;){var g=m.move(),y=g.centerA,b=g.centerB;y.element===b.element||(d(y.element,f),d(b.element,h),v.radiusTop=v.radiusBottom=n.size.size(y)*s,c.currentGroup=p,$1(c,f,h,.5,II,v),v.radiusTop=v.radiusBottom=n.size.size(b)*s,c.currentGroup=p+1,$1(c,h,f,.5,II,v)),p+=2}var S=wt.getMesh(c),x=Be.expand(Be(),t.boundary.sphere,1*i.sizeFactor);return S.setBoundingSphere(x),S}var BA=E(E({},Ia),eoe);function IL(e){return ho({defaultProps:I.getDefaultValues(BA),createGeometry:lft,createLocationIterator:nk.fromGroup,getLoci:jdt,eachLocation:zdt,setUpdateState:function(t,r,n){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.radialSegments!==n.radialSegments}},e)}var Fr=_(),Kr=_(),cft=_(),Yo=_(),_l=_(),NS=_(),BS=_(),Wy=_(),wu=_(),Xp=_(),MI=_(),gf=_(),yf=_(),bf=_(),xf=_(),Os=_.fromArray,qg=_.scale,Ls=_.add,kc=_.sub,dft=_.magnitude,aq=_.negate,ik=_.copy,toe=_.cross,fft=_.set,yn=qe.add3,hft=qe.add;function US(e,t,r,n,i,a,o,s){var u=t.vertices,l=t.normals,c=t.indices,d=u.elementCount;Os(Fr,n,e),qg(BS,Fr,o),qg(NS,Fr,s),Os(Kr,i,e),qg(Yo,Kr,a),toe(Xp,Kr,Fr),Os(wu,r,e),Ls(gf,Ls(gf,wu,Yo),NS),kc(yf,Ls(yf,wu,Yo),BS),kc(bf,kc(bf,wu,Yo),BS),Ls(xf,kc(xf,wu,Yo),NS),o<s?(yn(u,xf[0],xf[1],xf[2]),yn(u,bf[0],bf[1],bf[2]),yn(u,yf[0],yf[1],yf[2]),yn(u,gf[0],gf[1],gf[2]),ik(_l,NS)):(yn(u,gf[0],gf[1],gf[2]),yn(u,yf[0],yf[1],yf[2]),yn(u,bf[0],bf[1],bf[2]),yn(u,xf[0],xf[1],xf[2]),ik(_l,BS));for(var f=0;f<4;++f)yn(l,Xp[0],Xp[1],Xp[2]);yn(c,d+2,d+1,d),yn(c,d,d+3,d+2)}function ak(e,t,r,n,i,a,o,s,u,l){var c=e.currentGroup,d=e.vertices,f=e.normals,h=e.indices,v=e.groups,p=d.elementCount,m=0;s>0?(Os(Fr,t,0),Os(Kr,t,i*3),m=s/dft(kc(cft,Kr,Fr))):fft(Wy,0,0,0);for(var g=0;g<=i;++g){var y=a[g],b=o[g],S=s===0?b:s*(1-g/i),x=g*3;Os(_l,r,x),qg(_l,_l,S),Os(Yo,n,x),qg(Yo,Yo,y),s>0&&(Os(Fr,r,x),Os(Kr,n,x),qg(Wy,toe(Wy,Fr,Kr),m)),Os(wu,t,x),Os(Xp,r,x),Os(MI,n,x),Ls(Fr,Ls(Fr,wu,Yo),_l),Ls(Kr,Xp,Wy),yn(d,Fr[0],Fr[1],Fr[2]),yn(f,Kr[0],Kr[1],Kr[2]),Ls(Fr,kc(Fr,wu,Yo),_l),yn(d,Fr[0],Fr[1],Fr[2]),yn(f,Kr[0],Kr[1],Kr[2]),aq(Kr,MI),yn(d,Fr[0],Fr[1],Fr[2]),yn(f,Kr[0],Kr[1],Kr[2]),kc(Fr,kc(Fr,wu,Yo),_l),yn(d,Fr[0],Fr[1],Fr[2]),yn(f,Kr[0],Kr[1],Kr[2]),Ls(Kr,aq(Kr,Xp),Wy),yn(d,Fr[0],Fr[1],Fr[2]),yn(f,Kr[0],Kr[1],Kr[2]),kc(Fr,Ls(Fr,wu,Yo),_l),yn(d,Fr[0],Fr[1],Fr[2]),yn(f,Kr[0],Kr[1],Kr[2]),ik(Kr,MI),yn(d,Fr[0],Fr[1],Fr[2]),yn(f,Kr[0],Kr[1],Kr[2]),Ls(Fr,Ls(Fr,wu,Yo),_l),yn(d,Fr[0],Fr[1],Fr[2]),yn(f,Kr[0],Kr[1],Kr[2])}for(var g=0;g<i;++g){for(var C=0;C<2;C++)yn(h,p+g*8+2*C,p+(g+1)*8+2*C+1,p+g*8+2*C+1),yn(h,p+g*8+2*C,p+(g+1)*8+2*C,p+(g+1)*8+2*C+1);for(var C=2;C<4;C++)yn(h,p+g*8+2*C,p+(g+1)*8+2*C,p+g*8+2*C+1),yn(h,p+(g+1)*8+2*C,p+(g+1)*8+2*C+1,p+g*8+2*C+1)}if(u){var y=a[0],b=o[0],w=s===0?b:s;US(0,e,t,r,n,y,w,w)}else if(s>0){var y=a[0],b=o[0];US(0,e,t,r,n,y,s,-b),US(0,e,t,r,n,y,-s,b)}if(l&&s===0){var y=a[i],b=o[i];US(i*3,e,t,r,n,y,-b,-b)}for(var A=(i+1)*8+(u?4:s>0?8:0)+(l&&s===0?4:0),g=0,M=A;g<M;++g)hft(v,c)}var Gn=_(),Is=_(),Ms=_(),Sc=_(),dl=_();function pft(e,t,r,n,i){e[0]=t[0]*n+r[0]*i,e[1]=t[1]*n+r[1]*i,e[2]=t[2]*n+r[2]*i}function DI(e,t,r,n,i,a){e[0]=t[0]*i+r[0]*a+n[0],e[1]=t[1]*i+r[1]*a+n[1],e[2]=t[2]*i+r[2]*a+n[2]}var Cc=_.fromArray,oq=_.normalize,vft=_.negate,mft=_.copy,sq=_.cross,bo=qe.add3,RI=new Map;function gft(e){if(!RI.has(e)){for(var t=[],r=[],n=0;n<e;++n){var i=2*Math.PI*n/e;t[n]=Math.cos(i),r[n]=Math.sin(i)}RI.set(e,{cos:t,sin:r})}return RI.get(e)}function roe(e,t,r,n,i,a,o,s,u,l){for(var c=e.currentGroup,d=e.vertices,f=e.normals,h=e.indices,v=e.groups,p=d.elementCount,m=gft(a),g=m.cos,y=m.sin,b=0;b<=i;++b){var S=b*3;Cc(Sc,r,S),Cc(dl,n,S),Cc(Ms,t,S);for(var x=o[b],C=s[b],w=0;w<a;++w)DI(Is,Sc,dl,Ms,C*g[w],x*y[w]),a===2?(mft(Gn,dl),oq(Gn,Gn),(w!==0||b%2===0)&&vft(Gn,Gn)):pft(Gn,Sc,dl,x*g[w],C*y[w]),oq(Gn,Gn),bo(d,Is[0],Is[1],Is[2]),bo(f,Gn[0],Gn[1],Gn[2])}for(var b=0;b<i;++b)for(var w=0;w<a;++w)bo(h,p+b*a+(w+1)%a,p+(b+1)*a+(w+1)%a,p+b*a+w),bo(h,p+(b+1)*a+(w+1)%a,p+(b+1)*a+w,p+b*a+w);if(u){var A=0,M=d.elementCount;Cc(Sc,r,A),Cc(dl,n,A),Cc(Ms,t,A),sq(Gn,dl,Sc),bo(d,Ms[0],Ms[1],Ms[2]),bo(f,Gn[0],Gn[1],Gn[2]);var x=o[0],C=s[0];p=d.elementCount;for(var b=0;b<a;++b)DI(Is,Sc,dl,Ms,C*g[b],x*y[b]),bo(d,Is[0],Is[1],Is[2]),bo(f,Gn[0],Gn[1],Gn[2]),bo(h,p+(b+1)%a,p+b,M)}if(l){var A=i*3,M=d.elementCount;Cc(Sc,r,A),Cc(dl,n,A),Cc(Ms,t,A),sq(Gn,Sc,dl),bo(d,Ms[0],Ms[1],Ms[2]),bo(f,Gn[0],Gn[1],Gn[2]);var x=o[i],C=s[i];p=d.elementCount;for(var b=0;b<a;++b)DI(Is,Sc,dl,Ms,C*g[b],x*y[b]),bo(d,Is[0],Is[1],Is[2]),bo(f,Gn[0],Gn[1],Gn[2]),bo(h,p+b,p+(b+1)%a,M)}var D=(i+1)*a+(u?a+1:0)+(l?a+1:0);qe.addRepeat(v,D,c)}var _c=_.fromArray,yft=_.magnitude,kI=_.sub,uq=_.add,OI=_.scale,bft=_.negate,xft=_.copy,Sft=_.cross,Ds=qe.add3,Cft=qe.add,Mi=_(),sa=_(),_ft=_(),FI=_(),gp=_(),lq=_(),Xy=_(),wft=_(),LI=_();function RC(e,t,r,n,i,a,o,s){var u=e.currentGroup,l=e.vertices,c=e.normals,d=e.indices,f=e.groups,h=l.elementCount,v=0;s>0&&(_c(Mi,t,0),_c(sa,t,i*3),v=s/yft(kI(_ft,sa,Mi)));for(var p=0;p<=i;++p){var m=a[p],g=o[p],y=s===0?g:s*(1-p/i),b=p*3;_c(gp,r,b),OI(gp,gp,y),_c(FI,n,b),OI(FI,FI,m),s>0&&(_c(Mi,r,b),_c(sa,n,b),OI(lq,Sft(lq,Mi,sa),v)),_c(Xy,t,b),_c(wft,r,b),_c(LI,n,b),uq(Mi,Xy,gp),bft(sa,LI),Ds(l,Mi[0],Mi[1],Mi[2]),Ds(c,sa[0],sa[1],sa[2]),kI(Mi,Xy,gp),Ds(l,Mi[0],Mi[1],Mi[2]),Ds(c,sa[0],sa[1],sa[2]),uq(Mi,Xy,gp),xft(sa,LI),Ds(l,Mi[0],Mi[1],Mi[2]),Ds(c,sa[0],sa[1],sa[2]),kI(Mi,Xy,gp),Ds(l,Mi[0],Mi[1],Mi[2]),Ds(c,sa[0],sa[1],sa[2])}for(var p=0;p<i;++p)Ds(d,h+p*4,h+(p+1)*4+1,h+p*4+1),Ds(d,h+p*4,h+(p+1)*4,h+(p+1)*4+1),Ds(d,h+p*4+2+1,h+(p+1)*4+2+1,h+p*4+2),Ds(d,h+p*4+2,h+(p+1)*4+2+1,h+(p+1)*4+2);for(var S=(i+1)*4,p=0,x=S;p<x;++p)Cft(f,u)}var noe={sizeFactor:I.Numeric(.2,{min:0,max:10,step:.01}),aspectRatio:I.Numeric(5,{min:.1,max:10,step:.1}),arrowFactor:I.Numeric(1.5,{min:0,max:3,step:.1}),tubularHelices:I.Boolean(!1),detail:I.Numeric(0,{min:0,max:3,step:1},Et.CustomQualityParamInfo),linearSegments:I.Numeric(8,{min:1,max:48,step:1},Et.CustomQualityParamInfo),radialSegments:I.Numeric(16,{min:2,max:56,step:2},Et.CustomQualityParamInfo)};I.getDefaultValues(noe);var xo=_();function Eft(e,t,r,n,i,a){var o,s,u,l=t.polymerElements.length;if(!l)return Lt.createEmpty(a);for(var c=i.sizeFactor,d=i.detail,f=i.linearSegments,h=i.radialSegments,v=i.aspectRatio,p=i.arrowFactor,m=i.tubularHelices,g=f*h*l+(h+1)*l*2,y=wt.createState(g,g/10,a),b=je.isCoarse(t),S=PL(f),x=S.curvePoints,C=S.normalVectors,w=S.binormalVectors,A=S.widthValues,M=S.heightValues,D=0,k=AL(t,r,{ignoreSecondaryStructure:!1,useHelixOrientation:m});k.hasNext;){var R=k.move();y.currentGroup=D;var O=ic(R.moleculeType),H=Vr.is(R.secStrucType,4),B=Vr.is(R.secStrucType,2),j=B&&!m?Bdt:Hae,Y=O?NA:LA;TL(S,R,j,Y);var G=n.size.size(R.centerPrev)*c,$=n.size.size(R.center)*c,q=n.size.size(R.centerNext)*c;b&&(G*=v/2,$*=v/2,q*=v/2);var ee=R.secStrucFirst||R.coarseBackboneFirst||R.first,fe=R.secStrucLast||R.coarseBackboneLast||R.last,W=f;if(R.initial){W=Math.max(Math.round(f*Y),1);var X=f-W;x.copyWithin(0,X*3),w.copyWithin(0,X*3),C.copyWithin(0,X*3),_.fromArray(xo,x,3),_.normalize(xo,_.sub(xo,R.p2,xo)),_.scaleAndAdd(xo,R.p2,xo,$*c3),_.toArray(xo,x,0)}else R.final&&(W=Math.max(Math.round(f*(1-Y)),1),_.fromArray(xo,x,W*3-3),_.normalize(xo,_.sub(xo,R.p2,xo)),_.scaleAndAdd(xo,R.p2,xo,$*c3),_.toArray(xo,x,W*3));if(R.initial===!0&&R.final===!0)zi(y,R.p2,$*2,d);else if(H){var U=G*v,z=$*v,J=q*v,K=R.secStrucLast?z*p:0;rk(S,G,$,q,U,z,J,Y),h===2?RC(y,x,C,w,W,A,M,K):ak(y,x,C,w,W,A,M,K,ee,fe)}else{var U=void 0,z=void 0,J=void 0;if(B&&!R.isCoarseBackbone?m?(G*=v*1.5,$*=v*1.5,q*=v*1.5,U=G,z=$,J=q):(U=G*v,z=$*v,J=q*v):O&&!R.isCoarseBackbone?(U=G*v,z=$*v,J=q*v,o=[U,G],G=o[0],U=o[1],s=[z,$],$=s[0],z=s[1],u=[J,q],q=u[0],J=u[1]):(U=G,z=$,J=q),rk(S,G,$,q,U,z,J,Y),h===2)if(O&&!R.isCoarseBackbone){for(var Z=0,te=w.length;Z<te;Z++)w[Z]*=-1;RC(y,x,w,C,W,M,A,0)}else RC(y,x,C,w,W,A,M,0);else h===4?ak(y,x,C,w,W,A,M,0,ee,fe):roe(y,x,C,w,W,h,A,M,ee,fe)}++D}var le=wt.getMesh(y),ye=Be.expand(Be(),t.boundary.sphere,1*i.sizeFactor);return le.setBoundingSphere(ye),le}var ioe=E(E({},Ia),noe);function Aft(e){return ho({defaultProps:I.getDefaultValues(ioe),createGeometry:Eft,createLocationIterator:Ad.fromGroup,getLoci:hm,eachLocation:pm,setUpdateState:function(t,r,n,i,a,o,s){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.tubularHelices!==n.tubularHelices||r.detail!==n.detail||r.linearSegments!==n.linearSegments||r.radialSegments!==n.radialSegments||r.aspectRatio!==n.aspectRatio||r.arrowFactor!==n.arrowFactor;var u=tc.get(o.structure).version;t.info.secondaryStructureHash!==u&&(t.createGeometry=!0,t.info.secondaryStructureHash=u)}},e)}var aoe={"polymer-trace":function(e,t){return si("Polymer trace mesh",e,t,Aft)},"polymer-gap":function(e,t){return si("Polymer gap cylinder",e,t,IL)},"nucleotide-block":function(e,t){return si("Nucleotide block mesh",e,t,qdt)},"nucleotide-ring":function(e,t){return si("Nucleotide ring mesh",e,t,Jdt)},"direction-wedge":function(e,t){return si("Polymer direction wedge",e,t,uft)}},ooe=E(E(E(E(E(E({},ioe),BA),Yae),Qae),Jae),{sizeFactor:I.Numeric(.2,{min:0,max:10,step:.01}),visuals:I.MultiSelect(["polymer-trace","polymer-gap","nucleotide-block"],I.objectToOptions(aoe))});function Pft(e,t){var r=I.clone(ooe),n=!1,i=!1;return t.units.forEach(function(a){!n&&je.isAtomic(a)&&a.nucleotideElements.length&&(n=!0),!i&&a.gapElements.length&&(i=!0)}),r.visuals.defaultValue=["polymer-trace"],n&&r.visuals.defaultValue.push("nucleotide-block"),i&&r.visuals.defaultValue.push("polymer-gap"),r}function Tft(e,t){return ur.createMulti("Cartoon",e,t,Hi,aoe)}var Ift={name:"cartoon",label:"Cartoon",description:"Displays ribbons, planks, tubes smoothly following the trace atoms of polymers.",factory:Tft,getParams:Pft,defaultValues:I.getDefaultValues(ooe),defaultColorTheme:{name:"chain-id"},defaultSizeTheme:{name:"uniform"},isApplicable:function(e){return e.polymerResidueCount>0},ensureCustomProperties:{attach:function(e,t){return ce(void 0,void 0,void 0,function(){var r,n,i;return de(this,function(a){switch(a.label){case 0:return[4,tc.attach(e,t,void 0,!0)];case 1:a.sent(),r=0,n=t.models,a.label=2;case 2:return r<n.length?(i=n[r],[4,ek.attach(e,i,void 0,!0)]):[3,5];case 3:a.sent(),a.label=4;case 4:return r++,[3,2];case 5:return[2]}})})},detach:function(e){tc.ref(e,!1);for(var t=0,r=e.models;t<r.length;t++){var n=r[t];ek.ref(n,!1)}}}},soe=E(E({},Ia),{sizeFactor:I.Numeric(1,{min:0,max:10,step:.1}),detail:I.Numeric(0,{min:0,max:3,step:1},Et.CustomQualityParamInfo),ignoreHydrogens:I.Boolean(!1)});function Mft(e){return ho({defaultProps:I.getDefaultValues(soe),createGeometry:Dft,createLocationIterator:Ya.fromGroup,getLoci:sc,eachLocation:oc,setUpdateState:function(t,r,n){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.detail!==n.detail||r.ignoreHydrogens!==n.ignoreHydrogens}},e)}function Dft(e,t,r,n,i,a){var o=r.child,s=o==null?void 0:o.unitMap.get(t.id);if(o&&!s)return Lt.createEmpty(a);var u=i.detail,l=i.sizeFactor,c=i.ignoreHydrogens,d=t.elements,f=t.model,h=t.model.atomicHierarchy.derived.atom.atomicNumber,v=d.length,p=v*iA(u),m=wt.createState(p,p/2,a),g=Jl.Provider.get(f);if(!g)return Lt.createEmpty(a);var y=_(),b=Yn(),S=_(),x=_(),C=_(),w=g.elementToAnsiotrop,A=g.data,M=A.U,D=A._schema.U.space,k=t.conformation.invariantPosition,R=Ze.create(r);R.unit=t;for(var O=0;O<v;O++){var H=d[O],B=w[H];if(B!==-1&&!(s&&!Je.has(s.elements,H)||c&&Lw(h,H))){R.element=H,k(H,y),m.currentGroup=O,kr.toMat3(b,D,M.value(B)),Yn.symmtricFromLower(b,b),Yn.symmetricEigenvalues(S,b),Yn.eigenvector(x,b,S[1]),Yn.eigenvector(C,b,S[2]);for(var j=0;j<3;++j)S[j]=l*1.5958*Math.sqrt(Math.abs(S[j]));Sn(S[0],S[1],_n)&&Sn(S[1],S[2],_n)?zi(m,y,S[0],u):PF(m,y,C,x,S,u)}}var Y=wt.getMesh(m),G=Be.expand(Be(),(s||t).boundary.sphere,1*l);return Y.setBoundingSphere(G),Y}var uoe={"ellipsoid-mesh":function(e,t){return si("Ellipsoid Mesh",e,t,Mft)},"intra-bond":function(e,t){return si("Intra-unit bond cylinder",e,t,Aae)},"inter-bond":function(e,t){return Bu("Inter-unit bond cylinder",e,t,Tae)}},loe=E(E(E(E({},soe),DA),RA),{includeParent:I.Boolean(!1),adjustCylinderLength:I.Boolean(!1,{isHidden:!0}),unitKinds:O2(["atomic"]),sizeFactor:I.Numeric(1,{min:.01,max:10,step:.01}),sizeAspectRatio:I.Numeric(.1,{min:.01,max:3,step:.01}),linkCap:I.Boolean(!0),visuals:I.MultiSelect(["ellipsoid-mesh","intra-bond","inter-bond"],I.objectToOptions(uoe))});function Rft(e,t){return I.clone(loe)}function kft(e,t){return ur.createMulti("Ellipsoid",e,t,Hi,uoe)}var Oft={name:"ellipsoid",label:"Ellipsoid",description:"Displays anisotropic displacement ellipsoids of atomic elements plus bonds as cylinders.",factory:kft,getParams:Rft,defaultValues:I.getDefaultValues(loe),defaultColorTheme:{name:"element-symbol"},defaultSizeTheme:{name:"uniform"},isApplicable:function(e){return e.elementCount>0&&e.models.some(function(t){return Jl.Provider.isApplicable(t)})},getData:function(e,t){return t.includeParent?e.asParent():e},mustRecreate:function(e,t){return e.includeParent!==t.includeParent}},Fft=`
precision highp float;

attribute vec3 aPosition;
attribute float aRadius;

varying vec3 vPosition;
varying float vRadiusSqInv;

#if defined(dCalcType_groupId)
    attribute float aGroup;
    varying float vGroup;
#endif

uniform vec3 uBboxSize;
uniform vec3 uBboxMin;
uniform float uResolution;

void main() {
    vRadiusSqInv = 1.0 / (aRadius * aRadius);
    #if defined(dCalcType_groupId)
        vGroup = aGroup;
    #endif
    gl_PointSize = ceil(((aRadius * 3.0) / uResolution) + uResolution);
    vPosition = (aPosition - uBboxMin) / uResolution;
    gl_Position = vec4(((aPosition - uBboxMin) / uBboxSize) * 2.0 - 1.0, 1.0);
}
`,Lft=`
precision highp float;

varying vec3 vPosition;
varying float vRadiusSqInv;
#if defined(dCalcType_groupId)
    #if defined(dGridTexType_2d)
        precision highp sampler2D;
        uniform sampler2D tMinDistanceTex;
        uniform vec3 uGridTexDim;
    #elif defined(dGridTexType_3d)
        precision highp sampler3D;
        uniform sampler3D tMinDistanceTex;
    #endif
    varying float vGroup;
#endif

#include common

uniform vec3 uGridDim;
uniform vec2 uGridTexScale;
uniform float uCurrentSlice;
uniform float uCurrentX;
uniform float uCurrentY;
uniform float uAlpha;
uniform float uResolution;
uniform float uRadiusFactorInv;

void main() {
    vec2 v = gl_FragCoord.xy - vec2(uCurrentX, uCurrentY) - 0.5;
    vec3 fragPos = vec3(v.x, v.y, uCurrentSlice);
    float dist = distance(fragPos, vPosition) * uResolution;

    #if defined(dCalcType_density)
        float density = exp(-uAlpha * ((dist * dist) * vRadiusSqInv));
        gl_FragColor.a = density * uRadiusFactorInv;
    #elif defined(dCalcType_minDistance)
        gl_FragColor.a = 1.0 - dist * uRadiusFactorInv;
    #elif defined(dCalcType_groupId)
        #if defined(dGridTexType_2d)
            float minDistance = 1.0 - texture2D(tMinDistanceTex, (gl_FragCoord.xy) / (uGridTexDim.xy / uGridTexScale)).a;
        #elif defined(dGridTexType_3d)
            float minDistance = 1.0 - texelFetch(tMinDistanceTex, ivec3(gl_FragCoord.xy, uCurrentSlice), 0).a;
        #endif
        if (dist * uRadiusFactorInv > minDistance + uResolution * 0.05)
            discard;
        gl_FragColor.rgb = encodeFloatRGB(vGroup);
    #endif
}
`,Nft={drawCount:Ai("number"),instanceCount:Ai("number"),aRadius:Xr("float32",1,0),aPosition:Xr("float32",3,0),aGroup:Xr("float32",1,0),uCurrentSlice:Ge("f"),uCurrentX:Ge("f"),uCurrentY:Ge("f"),uBboxMin:Ge("v3","material"),uBboxSize:Ge("v3","material"),uGridDim:Ge("v3","material"),uGridTexDim:Ge("v3","material"),uGridTexScale:Ge("v2","material"),uAlpha:Ge("f","material"),uResolution:Ge("f","material"),uRadiusFactorInv:Ge("f","material"),tMinDistanceTex:cr("texture","rgba","float","nearest"),dGridTexType:Jt("string",["2d","3d"]),dCalcType:Jt("string",["density","minDistance","groupId"])},Fl="gaussian-density";function coe(e){return e.namedFramebuffers[Fl]||(e.namedFramebuffers[Fl]=e.resources.framebuffer()),e.namedFramebuffers[Fl]}function doe(e,t,r,n,i,a){var o=Fl+"-"+e;return t.namedTextures[o]||(t.namedTextures[o]=t.resources.texture(r,n,i,a)),t.namedTextures[o]}function foe(e,t,r,n,i,a){return e.isWebGL2?Bft(e,t,r,n,i,a):ML(e,t,r,n,!1,i,a)}function ML(e,t,r,n,i,a,o){return hoe(jft(e,t,r,n,i,a,o))}function Bft(e,t,r,n,i,a){return hoe(zft(e,t,r,n,i,a))}function hoe(e){var t=e.texture,r=e.scale,n=e.bbox,i=e.gridDim,a=e.gridTexDim,o=e.gridTexScale,s=e.radiusFactor,u=e.resolution;return{transform:Uft(r,n),texture:t,bbox:n,gridDim:i,gridTexDim:a,gridTexScale:o,radiusFactor:s,resolution:u}}function Uft(e,t){var r=ue.identity();return ue.fromScaling(r,e),ue.setTranslation(r,t.min),r}function jft(e,t,r,n,i,a,o){var s=e.gl,u=e.resources,l=e.state,c=e.extensions,d=c.colorBufferFloat,f=c.textureFloat,h=c.colorBufferHalfFloat,v=c.textureHalfFloat,p=c.blendMinMax,m=a.smoothness,g=a.resolution,y=poe(t,r,n,a),b=y.drawCount,S=y.positions,x=y.radii,C=y.groups,w=y.scale,A=y.expandedBox,M=y.dim,D=y.maxRadius,k=M[0],R=M[1],O=M[2],H=Hft(M),B=H.texDimX,j=H.texDimY,Y=H.texCols,G=H.powerOfTwoSize,$=_.create(B,j,0),q=He.create(B/G,j/G),ee=D*2,fe=i?G:B,W=i?G:j,X=doe("min-dist-2d",e,"image-uint8","rgba","ubyte","nearest");X.define(fe,W);var U=voe(e,b,S,x,C,X,A,M,$,q,m,g,ee),z=U.values,J=z.uCurrentSlice,K=z.uCurrentX,Z=z.uCurrentY,te=coe(e);te.bind(),moe(e),o||(o=h&&v?u.texture("image-float16","rgba","fp16","linear"):d&&f?u.texture("image-float32","rgba","float","linear"):u.texture("image-uint8","rgba","ubyte","linear")),o.define(fe,W);function le(ye,be){l.currentRenderItemId=-1,ye.attachFramebuffer(te,0),be&&(s.viewport(0,0,fe,W),s.scissor(0,0,fe,W),s.clear(s.COLOR_BUFFER_BIT)),L.update(Z,0);for(var Ae=0,Se=0,ie=0,oe=0;oe<O;++oe)Ae>=Y&&(Ae-=Y,Se+=R,ie=0,L.update(Z,Se)),L.update(K,ie),L.update(J,oe),s.viewport(ie,Se,k,R),s.scissor(ie,Se,k,R),U.render(),++Ae,ie+=k;s.flush()}return yoe(e,U),le(o,!0),p&&(goe(e,U),le(X,!0),boe(e,U),le(o,!1)),{texture:o,scale:w,bbox:A,gridDim:M,gridTexDim:$,gridTexScale:q,radiusFactor:ee,resolution:g}}function zft(e,t,r,n,i,a){var o=e.gl,s=e.resources,u=e.state,l=e.extensions,c=l.colorBufferFloat,d=l.textureFloat,f=l.colorBufferHalfFloat,h=l.textureHalfFloat,v=i.smoothness,p=i.resolution,m=poe(t,r,n,i),g=m.drawCount,y=m.positions,b=m.radii,S=m.groups,x=m.scale,C=m.expandedBox,w=m.dim,A=m.maxRadius,M=w[0],D=w[1],k=w[2],R=doe("min-dist-3d",e,"volume-uint8","rgba","ubyte","nearest");R.define(M,D,k);var O=He.create(1,1),H=A*2,B=voe(e,g,y,b,S,R,C,w,w,O,v,p,H),j=B.values.uCurrentSlice,Y=coe(e);Y.bind(),moe(e),o.viewport(0,0,M,D),o.scissor(0,0,M,D),a||(a=f&&h?s.texture("volume-float16","rgba","fp16","linear"):c&&d?s.texture("volume-float32","rgba","float","linear"):s.texture("volume-uint8","rgba","ubyte","linear")),a.define(M,D,k);function G($,q){u.currentRenderItemId=-1;for(var ee=0;ee<k;++ee)L.update(j,ee),$.attachFramebuffer(Y,0,ee),q&&o.clear(o.COLOR_BUFFER_BIT),B.render();o.flush()}return yoe(e,B),G(a,!0),goe(e,B),G(R,!0),boe(e,B),G(a,!1),{texture:a,scale:x,bbox:C,gridDim:w,gridTexDim:w,gridTexScale:O,radiusFactor:H,resolution:p}}function poe(e,t,r,n){for(var i=n.resolution,a=n.radiusOffset,o=1/i,s=e.indices,u=e.x,l=e.y,c=e.z,d=e.id,f=Fe.size(s),h=new Float32Array(f*3),v=new Float32Array(f),p=new Float32Array(f),m=0,g=0;g<f;++g){var y=Fe.getAt(s,g);h[g*3]=u[y],h[g*3+1]=l[y],h[g*3+2]=c[y];var b=r(y)+a;m<b&&(m=b),v[g]=b,p[g]=d?d[g]:g}var S=m*2+i*4,x=Kt.expand(Kt(),t,_.create(S,S,S)),C=Kt.scale(Kt(),x,o),w=Kt.size(_(),C);_.ceil(w,w);var A=_.create(i,i,i);return{drawCount:f,positions:h,radii:v,groups:p,scale:A,expandedBox:x,dim:w,maxRadius:m}}function voe(e,t,r,n,i,a,o,s,u,l,c,d,f){if(e.namedComputeRenderables[Fl]){var h=_.sub(_(),o.max,o.min),v=e.namedComputeRenderables[Fl].values;L.updateIfChanged(v.drawCount,t),L.updateIfChanged(v.instanceCount,1),L.update(v.aRadius,n),L.update(v.aPosition,r),L.update(v.aGroup,i),L.updateIfChanged(v.uCurrentSlice,0),L.updateIfChanged(v.uCurrentX,0),L.updateIfChanged(v.uCurrentY,0),L.update(v.uBboxMin,o.min),L.update(v.uBboxSize,h),L.update(v.uGridDim,s),L.update(v.uGridTexDim,u),L.update(v.uGridTexScale,l),L.updateIfChanged(v.uAlpha,c),L.updateIfChanged(v.uResolution,d),L.updateIfChanged(v.uRadiusFactorInv,1/f),L.update(v.tMinDistanceTex,a),L.updateIfChanged(v.dGridTexType,a.getDepth()>0?"3d":"2d"),L.updateIfChanged(v.dCalcType,"density"),e.namedComputeRenderables[Fl].update()}else e.namedComputeRenderables[Fl]=Vft(e,t,r,n,i,a,o,s,u,l,c,d,f);return e.namedComputeRenderables[Fl]}function Vft(e,t,r,n,i,a,o,s,u,l,c,d,f){var h=_.sub(_(),o.max,o.min),v={drawCount:L.create(t),instanceCount:L.create(1),aRadius:L.create(n),aPosition:L.create(r),aGroup:L.create(i),uCurrentSlice:L.create(0),uCurrentX:L.create(0),uCurrentY:L.create(0),uBboxMin:L.create(o.min),uBboxSize:L.create(h),uGridDim:L.create(s),uGridTexDim:L.create(u),uGridTexScale:L.create(l),uAlpha:L.create(c),uResolution:L.create(d),uRadiusFactorInv:L.create(1/f),tMinDistanceTex:L.create(a),dGridTexType:L.create(a.getDepth()>0?"3d":"2d"),dCalcType:L.create("density")},p=E({},Nft),m=Bn(Fl,Fft,Lft),g=ra(e,"points",m,p,v);return ta(g,v)}function moe(e){var t=e.gl,r=e.state;r.disable(t.CULL_FACE),r.enable(t.BLEND),r.disable(t.DEPTH_TEST),r.enable(t.SCISSOR_TEST),r.depthMask(!1),r.clearColor(0,0,0,0)}function goe(e,t){var r=e.gl,n=e.state;if(L.update(t.values.dCalcType,"minDistance"),t.update(),n.colorMask(!1,!1,!1,!0),n.blendFunc(r.ONE,r.ONE),!e.extensions.blendMinMax)throw new Error("GPU gaussian surface calculation requires EXT_blend_minmax");n.blendEquation(e.extensions.blendMinMax.MAX)}function yoe(e,t){var r=e.gl,n=e.state;L.update(t.values.dCalcType,"density"),t.update(),n.colorMask(!1,!1,!1,!0),n.blendFunc(r.ONE,r.ONE),n.blendEquation(r.FUNC_ADD)}function boe(e,t){var r=e.gl,n=e.state;L.update(t.values.dCalcType,"groupId"),t.update(),n.colorMask(!0,!0,!0,!1),n.blendFunc(r.ONE,r.ZERO),n.blendEquation(r.FUNC_ADD)}function Hft(e){var t=e[0]*e[1]*e[2],r=Math.sqrt(t),n=Math.pow(2,Math.ceil(Math.log(r)/Math.log(2))),i=0,a=e[1],o=1,s=e[2];return n<e[0]*e[2]?(s=Math.floor(n/e[0]),o=Math.ceil(e[2]/s),i=s*e[0],a*=o):i=e[0]*e[2],{texDimX:i,texDimY:a,texRows:o,texCols:s,powerOfTwoSize:a<n?n:n*2}}function xoe(e,t,r,n,i){return ce(this,void 0,void 0,function(){function a(K,Z){for(var te=K;te<Z;++te)for(var le=Fe.getAt(d,te),ye=f[le],be=h[le],Ae=v[le],Se=g[te],ie=Se*Se,oe=1/ie,F=Se*2,V=F*F,pe=Math.ceil(F*c),we=Math.floor(c*(ye-w[0])),Te=Math.floor(c*(be-w[1])),ze=Math.floor(c*(Ae-w[2])),Ve=Math.max(0,we-pe),Xe=Math.max(0,Te-pe),ct=Math.max(0,ze-pe),Ne=Math.min(B,we+pe+2),Qe=Math.min(j,Te+pe+2),it=Math.min(Y,ze+pe+2),ot=Ve;ot<Ne;++ot)for(var dt=ee[ot]-ye,ke=ot*q,Me=Xe;Me<Qe;++Me)for(var Ye=fe[Me]-be,tt=dt*dt+Ye*Ye,xt=Me*G+ke,pt=ct;pt<it;++pt){var ut=W[pt]-Ae,he=tt+ut*ut;if(he<=V){var me=Eje(-U*(he*oe)),Ee=pt+xt;k[Ee]+=me,me>X[Ee]&&(X[Ee]=me,O[Ee]=p?p[te]:te)}}}function o(){return ce(this,void 0,void 0,function(){var K;return de(this,function(Z){switch(Z.label){case 0:K=0,Z.label=1;case 1:return K<m?(a(K,Math.min(K+z,m)),e.shouldUpdate?[4,e.update({message:"filling density grid",current:K,max:m})]:[3,3]):[3,4];case 2:Z.sent(),Z.label=3;case 3:return K+=z,[3,1];case 4:return[2]}})})}var s,u,l,c,d,f,h,v,p,m,g,y,b,S,x,C,w,A,M,D,k,R,O,H,B,j,Y,G,$,q,ee,fe,W,X,U,z,J;return de(this,function(K){switch(K.label){case 0:for(s=i.resolution,u=i.radiusOffset,l=i.smoothness,c=1/s,d=t.indices,f=t.x,h=t.y,v=t.z,p=t.id,m=Fe.size(d),g=new Float32Array(m),y=0,b=0;b<m;++b)S=n(Fe.getAt(d,b))+u,y<S&&(y=S),g[b]=S;return x=y*2+s,C=Kt.expand(Kt(),r,_.create(x,x,x)),w=C.min,A=Kt.scale(Kt(),C,c),M=Kt.size(_(),A),_.ceil(M,M),D=kr.Space(M,[0,1,2],Float32Array),k=D.create(),R=kr.create(D,k),O=D.create(),O.fill(-1),H=kr.create(D,O),B=M[0],j=M[1],Y=M[2],G=Y,$=j,q=G*$,ee=Ug(M[0],w[0],s),fe=Ug(M[1],w[1],s),W=Ug(M[2],w[2],s),X=D.create(),U=l,z=Math.ceil(1e5/(Math.pow(Math.pow(y,3),3)*c)),[4,o()];case 1:return K.sent(),J=ue.identity(),ue.fromScaling(J,_.create(s,s,s)),ue.setTranslation(J,C.min),[2,{field:R,idField:H,transform:J,radiusFactor:1,resolution:s}]}})})}var $2=E({resolution:I.Numeric(1,{min:.1,max:20,step:.1},E({description:"Grid resolution/cell spacing."},Et.CustomQualityParamInfo)),radiusOffset:I.Numeric(0,{min:0,max:10,step:.1},{description:"Extra/offset radius added to the atoms/coarse elements for gaussian calculation. Useful to create coarse, low resolution surfaces."}),smoothness:I.Numeric(1.5,{min:.5,max:2.5,step:.1},{description:"Smoothness of the gausian surface, lower is smoother."})},SA);I.getDefaultValues($2);function UA(e,t){var r=e.maxTextureSize/3;return r*r/Math.max(1,t?t.units.length/16:1)}function Soe(e,t,r){var n=this,i=t.lookup3d.boundary.box,a=am(i,r),o=CA(e,t,a),s=o.position,u=o.radius;return $e.create("Gaussian Density",function(l){return ce(n,void 0,void 0,function(){return de(this,function(c){switch(c.label){case 0:return[4,xoe(l,s,i,u,a)];case 1:return[2,c.sent()]}})})})}function Gft(e,t,r,n,i){var a=this,o=t.lookup3d.boundary.box,s=am(o,r,UA(n,e)),u=CA(e,t,s),l=u.position,c=u.radius;return $e.create("Gaussian Density",function(d){return ce(a,void 0,void 0,function(){return de(this,function(f){return[2,foe(n,l,o,c,s,i)]})})})}function qft(e,t,r,n,i,a){var o=this,s=t.lookup3d.boundary.box,u=am(s,n,UA(i,e)),l=CA(e,t,u),c=l.position,d=l.radius;return $e.create("Gaussian Density",function(f){return ce(o,void 0,void 0,function(){return de(this,function(h){return[2,ML(i,c,s,d,r,u,a)]})})})}function $ft(e,t){var r=this,n=e.lookup3d.boundary.box,i=am(n,t),a=RF(e,t.ignoreHydrogens,t.traceOnly),o=a.position,s=a.radius;return $e.create("Gaussian Density",function(u){return ce(r,void 0,void 0,function(){return de(this,function(l){switch(l.label){case 0:return[4,xoe(u,o,n,s,i)];case 1:return[2,l.sent()]}})})})}function Wft(e,t,r,n){var i=this,a=e.lookup3d.boundary.box,o=am(a,t,UA(r)),s=RF(e,t.ignoreHydrogens,t.traceOnly),u=s.position,l=s.radius;return $e.create("Gaussian Density",function(c){return ce(i,void 0,void 0,function(){return de(this,function(d){return[2,foe(r,u,a,l,o,n)]})})})}function Xft(e,t,r,n,i){var a=this,o=e.lookup3d.boundary.box,s=am(o,r,UA(n)),u=RF(e,r.ignoreHydrogens,r.traceOnly),l=u.position,c=u.radius;return $e.create("Gaussian Density",function(d){return ce(a,void 0,void 0,function(){return de(this,function(f){return[2,ML(n,l,o,c,t,s,i)]})})})}function Yft(e,t,r,n,i){var a=e.colorType,o=e.vertexCount,s=e.groupCount,u=e.positionBuffer,l=e.transformBuffer,c=e.groupBuffer,d=a.endsWith("Instance"),f=Kt.fromSphere3D(Kt(),d?e.boundingSphere:e.invariantBoundingSphere),h=1/t,v=Kt.scale(Kt(),f,h),p=Kt.size(_(),v);_.ceil(p,p),_.add(p,p,_.create(2,2,2));var m=f.min,g=p[0],y=p[1],b=V2(p),S=b.width,x=b.height,C=3,w=new Float32Array(S*x*C),A=new Float32Array(S*x),M=new Uint8Array(S*x*C),D={array:M,width:S,height:x,filter:"linear"},k=d?e.instanceCount:1,R=e.colorData.array;function O(Me,Ye,tt){var xt=Math.floor(tt*g%S/g),pt=Math.floor(tt*g/S),ut=xt*g+Me;return C*(pt*y*S+Ye*S+ut)}for(var H=2,B=p[0],j=p[1],Y=p[2],G=_(),$=0;$<k;++$)for(var q=0;q<o;q+=r){_.fromArray(G,u,q*3),d&&_.transformMat4Offset(G,G,l,0,0,$*16),_.sub(G,G,m),_.scale(G,G,h);for(var ee=G[0],fe=G[1],W=G[2],X=Math.floor(ee),U=Math.floor(fe),z=Math.floor(W),J=$*s+c[q],K=R[J*3],Z=R[J*3+1],te=R[J*3+2],le=Math.max(0,X-H),ye=Math.max(0,U-H),be=Math.max(0,z-H),Ae=Math.min(B,X+H+2),Se=Math.min(j,U+H+2),ie=Math.min(Y,z+H+2),oe=le;oe<Ae;++oe)for(var F=oe-ee,V=ye;V<Se;++V)for(var pe=V-fe,we=be;we<ie;++we){var Te=we-W,ze=Math.sqrt(F*F+pe*pe+Te*Te);if(!(ze>H)){var Ve=H-ze,Xe=O(oe,V,we);w[Xe]+=K*Ve,w[Xe+1]+=Z*Ve,w[Xe+2]+=te*Ve,A[Xe/3]+=Ve}}}for(var $=0,ct=A.length;$<ct;++$){var Ne=$*3,Qe=A[$];M[Ne]=Math.round(w[Ne]/Qe),M[Ne+1]=Math.round(w[Ne+1]/Qe),M[Ne+2]=Math.round(w[Ne+2]/Qe)}var it=He.create(S,x),ot=Ir.create(m[0],m[1],m[2],h),dt=d?"volumeInstance":"volume";if(n)return i||(i=n.resources.texture("image-uint8","rgb","ubyte","linear")),i.load(D),{kind:"volume",texture:i,gridTexDim:it,gridDim:p,gridTransform:ot,type:dt};var ke=Kft({vertexCount:o,instanceCount:k,transformBuffer:l,positionBuffer:u,colorType:dt,grid:M,gridDim:p,gridTexDim:it,gridTransform:ot,vertexStride:3,colorStride:3});return{kind:"vertex",texture:ke,texDim:He.create(ke.width,ke.height),type:d?"vertexInstance":"vertex"}}function Kft(e){var t=e.vertexCount,r=e.positionBuffer,n=e.transformBuffer,i=e.grid,a=e.gridDim,o=e.gridTexDim,s=e.gridTransform,u=e.vertexStride,l=e.colorStride,c=e.colorType.endsWith("Instance"),d=c?e.instanceCount:1,f=Aa(Math.max(1,d*t),3,Uint8Array),h=f.array,v=a[0],p=a[1],m=o[0],g=_.fromArray(_(),s,0),y=s[3];function b(be,Ae,Se){var ie=Math.floor(Se*v%m/v),oe=Math.floor(Se*v/m),F=ie*v+be;return l*(oe*p*m+Ae*m+F)}for(var S=_(),x=_(),C=_(),w=_(),A=0;A<d;++A)for(var M=0;M<t;++M){_.fromArray(S,r,M*u),c&&_.transformMat4Offset(S,S,n,0,0,A*16),_.sub(S,S,g),_.scale(S,S,y),_.floor(x,S),_.ceil(C,S),_.sub(w,S,x),_.sub(S,C,x),_.div(w,w,S);var D=x[0],k=x[1],R=x[2],O=C[0],H=C[1],B=C[2],j=w[0],Y=w[1],G=w[2],$=at.fromArray(i,b(D,k,R)),q=at.fromArray(i,b(O,k,R)),ee=at.fromArray(i,b(D,k,B)),fe=at.fromArray(i,b(O,k,B)),W=at.fromArray(i,b(D,H,R)),X=at.fromArray(i,b(O,H,R)),U=at.fromArray(i,b(D,H,B)),z=at.fromArray(i,b(O,H,B)),J=at.interpolate($,q,j),K=at.interpolate(ee,fe,j),Z=at.interpolate(W,X,j),te=at.interpolate(U,z,j),le=at.interpolate(J,Z,Y),ye=at.interpolate(K,te,Y);at.toArray(at.interpolate(le,ye,G),h,(A*t+M)*3)}return f}var Qft=`
precision highp float;
precision highp sampler2D;

uniform sampler2D tColor;
uniform vec2 uTexSize;

void main(void) {
    vec2 coords = gl_FragCoord.xy / uTexSize;
    vec4 color = texture2D(tColor, coords);

    gl_FragColor.rgb = color.rgb / color.a;
}
`,Zft=`
precision highp float;

varying vec3 vPosition;
varying vec3 vColor;

uniform float uCurrentSlice;
uniform float uCurrentX;
uniform float uCurrentY;
uniform float uResolution;

const float p = 2.0;

void main() {
    vec2 v = gl_FragCoord.xy - vec2(uCurrentX, uCurrentY) - 0.5;
    vec3 fragPos = vec3(v.x, v.y, uCurrentSlice);
    float dist = distance(fragPos, vPosition);
    if (dist > p) discard;

    gl_FragColor = vec4(vColor, 1.0) * (p - dist);
}
`,Jft=`
precision highp float;

#include common
#include read_from_texture

uniform int uTotalCount;
uniform int uGroupCount;

attribute float aSample;
#define SampleID int(aSample)

attribute mat4 aTransform;
attribute float aInstance;

uniform vec2 uGeoTexDim;
uniform sampler2D tPosition;
uniform sampler2D tGroup;

uniform vec2 uColorTexDim;
uniform sampler2D tColor;

varying vec3 vPosition;
varying vec3 vColor;

uniform vec3 uBboxSize;
uniform vec3 uBboxMin;
uniform float uResolution;

void main() {
    vec3 position = readFromTexture(tPosition, SampleID, uGeoTexDim).xyz;
    float group = decodeFloatRGB(readFromTexture(tGroup, SampleID, uGeoTexDim).rgb);

    position = (aTransform * vec4(position, 1.0)).xyz;
    gl_PointSize = 7.0;
    vPosition = (position - uBboxMin) / uResolution;
    gl_Position = vec4(((position - uBboxMin) / uBboxSize) * 2.0 - 1.0, 1.0);

    #if defined(dColorType_group)
        vColor = readFromTexture(tColor, group, uColorTexDim).rgb;
    #elif defined(dColorType_groupInstance)
        vColor = readFromTexture(tColor, aInstance * float(uGroupCount) + group, uColorTexDim).rgb;
    #endif
}
`,eht={drawCount:Ai("number"),instanceCount:Ai("number"),stride:Ai("number"),uTotalCount:Ge("i"),uInstanceCount:Ge("i"),uGroupCount:Ge("i"),aTransform:Xr("float32",16,1),aInstance:Xr("float32",1,1),aSample:Xr("float32",1,0),uGeoTexDim:Ge("v2","buffered"),tPosition:cr("texture","rgba","float","nearest"),tGroup:cr("texture","rgba","float","nearest"),uColorTexDim:Ge("v2"),tColor:cr("image-uint8","rgb","ubyte","nearest"),dColorType:Jt("string",["group","groupInstance","vertex","vertexInstance"]),uCurrentSlice:Ge("f"),uCurrentX:Ge("f"),uCurrentY:Ge("f"),uBboxMin:Ge("v3","material"),uBboxSize:Ge("v3","material"),uResolution:Ge("f","material")},Eu="color-accumulate";function Coe(e,t){for(var r=new Float32Array(e),n=0;n<e;++n)r[n]=n*t;return r}function tht(e,t,r,n,i){if(e.namedComputeRenderables[Eu]){var a=_.sub(_(),r.max,r.min),o=e.namedComputeRenderables[Eu].values,s=Math.round(t.vertexCount/i);(s>o.drawCount.ref.value||i!==o.stride.ref.value)&&L.update(o.aSample,Coe(s,i)),L.updateIfChanged(o.drawCount,s),L.updateIfChanged(o.instanceCount,t.instanceCount),L.updateIfChanged(o.stride,i),L.updateIfChanged(o.uTotalCount,t.vertexCount),L.updateIfChanged(o.uInstanceCount,t.instanceCount),L.updateIfChanged(o.uGroupCount,t.groupCount),L.update(o.aTransform,t.transformBuffer),L.update(o.aInstance,t.instanceBuffer),L.update(o.uGeoTexDim,He.set(o.uGeoTexDim.ref.value,t.positionTexture.getWidth(),t.positionTexture.getHeight())),L.update(o.tPosition,t.positionTexture),L.update(o.tGroup,t.groupTexture),L.update(o.uColorTexDim,He.set(o.uColorTexDim.ref.value,t.colorData.width,t.colorData.height)),L.update(o.tColor,t.colorData),L.updateIfChanged(o.dColorType,t.colorType),L.updateIfChanged(o.uCurrentSlice,0),L.updateIfChanged(o.uCurrentX,0),L.updateIfChanged(o.uCurrentY,0),L.update(o.uBboxMin,r.min),L.update(o.uBboxSize,a),L.updateIfChanged(o.uResolution,n),e.namedComputeRenderables[Eu].update()}else e.namedComputeRenderables[Eu]=rht(e,t,r,n,i);return e.namedComputeRenderables[Eu]}function rht(e,t,r,n,i){var a=_.sub(_(),r.max,r.min),o=Math.round(t.vertexCount/i),s={drawCount:L.create(o),instanceCount:L.create(t.instanceCount),stride:L.create(i),uTotalCount:L.create(t.vertexCount),uInstanceCount:L.create(t.instanceCount),uGroupCount:L.create(t.groupCount),aTransform:L.create(t.transformBuffer),aInstance:L.create(t.instanceBuffer),aSample:L.create(Coe(o,i)),uGeoTexDim:L.create(He.create(t.positionTexture.getWidth(),t.positionTexture.getHeight())),tPosition:L.create(t.positionTexture),tGroup:L.create(t.groupTexture),uColorTexDim:L.create(He.create(t.colorData.width,t.colorData.height)),tColor:L.create(t.colorData),dColorType:L.create(t.colorType),uCurrentSlice:L.create(0),uCurrentX:L.create(0),uCurrentY:L.create(0),uBboxMin:L.create(r.min),uBboxSize:L.create(a),uResolution:L.create(n)},u=E({},eht),l=Bn("accumulate",Jft,Zft),c=ra(e,"points",l,u,s);return ta(c,s)}function nht(e){var t=e.gl,r=e.state;r.disable(t.CULL_FACE),r.enable(t.BLEND),r.disable(t.DEPTH_TEST),r.enable(t.SCISSOR_TEST),r.depthMask(!1),r.clearColor(0,0,0,0),r.blendFunc(t.ONE,t.ONE),r.blendEquation(t.FUNC_ADD)}var iht=E(E({},Pa),{tColor:cr("texture","rgba","float","nearest"),uTexSize:Ge("v2")}),Yy="color-normalize";function aht(e,t){if(e.namedComputeRenderables[Yy]){var r=e.namedComputeRenderables[Yy].values;L.update(r.tColor,t),L.update(r.uTexSize,He.set(r.uTexSize.ref.value,t.getWidth(),t.getHeight())),e.namedComputeRenderables[Yy].update()}else e.namedComputeRenderables[Yy]=oht(e,t);return e.namedComputeRenderables[Yy]}function oht(e,t){var r=E(E({},Ta),{tColor:L.create(t),uTexSize:L.create(He.create(t.getWidth(),t.getHeight()))}),n=E({},iht),i=Bn("normalize",Bo,Qft),a=ra(e,"triangles",i,n,r);return ta(a,r)}function sht(e){var t=e.gl,r=e.state;r.disable(t.CULL_FACE),r.enable(t.BLEND),r.disable(t.DEPTH_TEST),r.enable(t.SCISSOR_TEST),r.depthMask(!1),r.clearColor(0,0,0,0),r.blendFunc(t.ONE,t.ONE),r.blendEquation(t.FUNC_ADD)}function uht(e){var t=e[0]*e[1]*e[2],r=Math.sqrt(t),n=Math.pow(2,Math.ceil(Math.log(r)/Math.log(2))),i=0,a=e[1],o=1,s=e[2];return n<e[0]*e[2]?(s=Math.floor(n/e[0]),o=Math.ceil(e[2]/s),i=s*e[0],a*=o):i=e[0]*e[2],{texDimX:i,texDimY:a,texRows:o,texCols:s,powerOfTwoSize:a<n?n:n*2}}function lht(e,t,r,n,i){var a=n.gl,o=n.resources,s=n.state,u=n.extensions,l=u.colorBufferHalfFloat,c=u.textureHalfFloat,d=e.colorType.endsWith("Instance"),f=Kt.fromSphere3D(Kt(),d?e.boundingSphere:e.invariantBoundingSphere),h=1/t,v=Kt.scale(Kt(),f,h),p=Kt.size(_(),v);_.ceil(p,p),_.add(p,p,_.create(2,2,2));var m=f.min,g=p[0],y=p[1],b=p[2],S=uht(p),x=S.texDimX,C=S.texDimY,w=S.texCols;n.namedTextures[Eu]||(n.namedTextures[Eu]=l&&c?o.texture("image-float16","rgba","fp16","nearest"):o.texture("image-float32","rgba","float","nearest"));var A=n.namedTextures[Eu];A.define(x,C);var M=tht(n,e,f,t,r),D=M.values,k=D.uCurrentSlice,R=D.uCurrentX,O=D.uCurrentY;n.namedFramebuffers[Eu]||(n.namedFramebuffers[Eu]=n.resources.framebuffer());var H=n.namedFramebuffers[Eu];H.bind(),nht(n),s.currentRenderItemId=-1,A.attachFramebuffer(H,0),a.viewport(0,0,x,C),a.scissor(0,0,x,C),a.clear(a.COLOR_BUFFER_BIT),L.update(O,0);for(var B=0,j=0,Y=0,G=0;G<b;++G)B>=w&&(B-=w,j+=y,Y=0,L.update(O,j)),L.update(R,Y),L.update(k,G),a.viewport(Y,j,g,y),a.scissor(Y,j,g,y),M.render(),++B,Y+=g;i||(i=o.texture("image-uint8","rgb","ubyte","linear")),i.define(x,C);var $=aht(n,A);sht(n),s.currentRenderItemId=-1,i.attachFramebuffer(H,0),a.viewport(0,0,x,C),a.scissor(0,0,x,C),a.clear(a.COLOR_BUFFER_BIT),$.render();var q=Ir.create(m[0],m[1],m[2],h),ee=d?"volumeInstance":"volume";return{texture:i,gridDim:p,gridTexDim:He.create(x,C),gridTransform:q,type:ee}}var _oe={smoothColors:I.MappedStatic("auto",{auto:I.Group({}),on:I.Group({resolutionFactor:I.Numeric(2,{min:.5,max:6,step:.1}),sampleStride:I.Numeric(3,{min:1,max:12,step:1})}),off:I.Group({})})};function W2(e,t,r,n){if((e.smoothColors.name==="on"||e.smoothColors.name==="auto"&&t.color.preferSmoothing)&&r&&r<3&&n){var i=3;return e.smoothColors.name==="on"?(r*=e.smoothColors.params.resolutionFactor,i=e.smoothColors.params.sampleStride):(r*=2-vZ(0,1.1,r),r=Math.max(.5,r),r>1.2&&(i=2)),{resolution:r,stride:i,webgl:n}}}function woe(e){return e==="group"||e==="groupInstance"}function DL(e,t,r,n,i){if(woe(e.dColorType.ref.value)){var a=Yft({vertexCount:e.uVertexCount.ref.value,instanceCount:e.uInstanceCount.ref.value,groupCount:e.uGroupCount.ref.value,transformBuffer:e.aTransform.ref.value,instanceBuffer:e.aInstance.ref.value,positionBuffer:e.aPosition.ref.value,groupBuffer:e.aGroup.ref.value,colorData:e.tColor.ref.value,colorType:e.dColorType.ref.value,boundingSphere:e.boundingSphere.ref.value,invariantBoundingSphere:e.invariantBoundingSphere.ref.value},t,r,n,i);a.kind==="volume"?(L.updateIfChanged(e.dColorType,a.type),L.update(e.tColorGrid,a.texture),L.update(e.uColorTexDim,a.gridTexDim),L.update(e.uColorGridDim,a.gridDim),L.update(e.uColorGridTransform,a.gridTransform)):a.kind==="vertex"&&(L.updateIfChanged(e.dColorType,a.type),L.update(e.tColor,a.texture),L.update(e.uColorTexDim,a.texDim))}}function Eoe(e,t,r,n,i){if(woe(e.dColorType.ref.value)){r*=3;var a=lht({vertexCount:e.uVertexCount.ref.value,instanceCount:e.uInstanceCount.ref.value,groupCount:e.uGroupCount.ref.value,transformBuffer:e.aTransform.ref.value,instanceBuffer:e.aInstance.ref.value,positionTexture:e.tPosition.ref.value,groupTexture:e.tGroup.ref.value,colorData:e.tColor.ref.value,colorType:e.dColorType.ref.value,boundingSphere:e.boundingSphere.ref.value,invariantBoundingSphere:e.invariantBoundingSphere.ref.value},t,r,n,i);L.updateIfChanged(e.dColorType,a.type),L.update(e.tColorGrid,a.texture),L.update(e.uColorTexDim,a.gridTexDim),L.update(e.uColorGridDim,a.gridDim),L.update(e.uColorGridTransform,a.gridTransform)}}var Aoe=E(E(E({},$2),_oe),{ignoreHydrogens:I.Boolean(!1),tryUseGpu:I.Boolean(!0)}),RL=E(E(E({},Ia),UZe),Aoe),Poe=E(E(E({},F2),RZe),Aoe);function Toe(e){return e.extensions.colorBufferFloat&&e.extensions.textureFloat&&e.extensions.blendMinMax&&e.extensions.drawBuffers}function ty(e,t,r){if(t.resolution>1)return!1;var n=r.maxTextureSize/3,i=lne(e.boundary.box,t.resolution,n*n),a=i.areaCells,o=i.maxAreaCells;return a<o}function cht(e,t,r,n){return r.tryUseGpu&&n&&Toe(n)&&ty(t,r,n)?ght(e):hht(e)}function dht(e,t,r,n){return r.tryUseGpu&&n&&Toe(n)&&ty(t,r,n)?bht(e):vht(e)}function fht(e,t,r,n,i,a){return ce(this,void 0,void 0,function(){var o,s,u,l,c,d,f,h,v,p;return de(this,function(m){switch(m.label){case 0:return o=i.smoothness,[4,Soe(r,t,i).runInContext(e.runtime)];case 1:return s=m.sent(),u=s.transform,l=s.field,c=s.idField,d=s.radiusFactor,f=s.resolution,h={isoLevel:Math.exp(-o)/d,scalarField:l,idField:c},[4,TA(h,a).runAsChild(e.runtime)];case 2:return v=m.sent(),v.meta.resolution=f,Lt.transform(v,u),e.webgl&&!e.webgl.isWebGL2&&Lt.uniformTriangleGroup(v),p=Be.expand(Be(),t.boundary.sphere,i.radiusOffset+Z0(t)),v.setBoundingSphere(p),[2,v]}})})}function hht(e){return ho({defaultProps:I.getDefaultValues(RL),createGeometry:fht,createLocationIterator:Ya.fromGroup,getLoci:sc,eachLocation:oc,setUpdateState:function(t,r,n){r.resolution!==n.resolution&&(t.createGeometry=!0),r.radiusOffset!==n.radiusOffset&&(t.createGeometry=!0),r.smoothness!==n.smoothness&&(t.createGeometry=!0),r.ignoreHydrogens!==n.ignoreHydrogens&&(t.createGeometry=!0),r.traceOnly!==n.traceOnly&&(t.createGeometry=!0),r.includeParent!==n.includeParent&&(t.createGeometry=!0),r.smoothColors.name!==n.smoothColors.name?t.updateColor=!0:r.smoothColors.name==="on"&&n.smoothColors.name==="on"&&(r.smoothColors.params.resolutionFactor!==n.smoothColors.params.resolutionFactor&&(t.updateColor=!0),r.smoothColors.params.sampleStride!==n.smoothColors.params.sampleStride&&(t.updateColor=!0))},mustRecreate:function(t,r,n){return r.tryUseGpu&&!!n&&ty(t.structure,r,n)},processValues:function(t,r,n,i,a){var o=r.meta,s=o.resolution,u=o.colorTexture,l=W2(n,i,s,a);l&&(DL(t,l.resolution,l.stride,l.webgl,u),r.meta.colorTexture=t.tColorGrid.ref.value)},dispose:function(t){var r;(r=t.meta.colorTexture)===null||r===void 0||r.destroy()}},e)}function pht(e,t,r,n,i){return ce(this,void 0,void 0,function(){var a,o,s,u,l,c,d,f,h,v;return de(this,function(p){switch(p.label){case 0:return a=n.smoothness,[4,$ft(t,n).runInContext(e.runtime)];case 1:return o=p.sent(),s=o.transform,u=o.field,l=o.idField,c=o.radiusFactor,d=o.resolution,f={isoLevel:Math.exp(-a)/c,scalarField:u,idField:l},[4,TA(f,i).runAsChild(e.runtime)];case 2:return h=p.sent(),h.meta.resolution=d,Lt.transform(h,s),e.webgl&&!e.webgl.isWebGL2&&Lt.uniformTriangleGroup(h),v=Be.expand(Be(),t.boundary.sphere,n.radiusOffset+_A(t)),h.setBoundingSphere(v),[2,h]}})})}function vht(e){return om({defaultProps:I.getDefaultValues(Poe),createGeometry:pht,createLocationIterator:Ya.fromStructure,getLoci:OA,eachLocation:kA,setUpdateState:function(t,r,n){r.resolution!==n.resolution&&(t.createGeometry=!0),r.radiusOffset!==n.radiusOffset&&(t.createGeometry=!0),r.smoothness!==n.smoothness&&(t.createGeometry=!0),r.ignoreHydrogens!==n.ignoreHydrogens&&(t.createGeometry=!0),r.traceOnly!==n.traceOnly&&(t.createGeometry=!0),r.smoothColors.name!==n.smoothColors.name?t.updateColor=!0:r.smoothColors.name==="on"&&n.smoothColors.name==="on"&&(r.smoothColors.params.resolutionFactor!==n.smoothColors.params.resolutionFactor&&(t.updateColor=!0),r.smoothColors.params.sampleStride!==n.smoothColors.params.sampleStride&&(t.updateColor=!0))},mustRecreate:function(t,r,n){return r.tryUseGpu&&!!n&&ty(t,r,n)},processValues:function(t,r,n,i,a){var o=r.meta,s=o.resolution,u=o.colorTexture,l=W2(n,i,s,a);l&&(DL(t,l.resolution,l.stride,l.webgl,u),r.meta.colorTexture=t.tColorGrid.ref.value)},dispose:function(t){var r;(r=t.meta.colorTexture)===null||r===void 0||r.destroy()}},e)}var $g="gaussian-surface";function mht(e,t,r,n,i,a){return ce(this,void 0,void 0,function(){var o,s,u,l,c,d,f,h,v,p,m,g,y,b;return de(this,function(S){switch(S.label){case 0:if(!e.webgl)throw new Error("webgl context required to create gaussian surface texture-mesh");return o=e.webgl,s=o.namedTextures,u=o.resources,l=o.extensions,c=l.colorBufferFloat,d=l.textureFloat,f=l.colorBufferHalfFloat,h=l.textureHalfFloat,s[$g]||(s[$g]=f&&h?u.texture("image-float16","rgba","fp16","linear"):c&&d?u.texture("image-float32","rgba","float","linear"):u.texture("image-uint8","rgba","ubyte","linear")),[4,qft(r,t,!0,i,e.webgl,s[$g]).runInContext(e.runtime)];case 1:return v=S.sent(),p=Math.exp(-i.smoothness)/v.radiusFactor,m=a==null?void 0:a.doubleBuffer.get(),g=iL(e.webgl,v.texture,v.gridDim,v.gridTexDim,v.gridTexScale,v.transform,p,!1,!0,m==null?void 0:m.vertex,m==null?void 0:m.group,m==null?void 0:m.normal),y=Be.expand(Be(),t.boundary.sphere,i.radiusOffset+_A(r)),b=Yu.create(g.vertexCount,1,g.vertexTexture,g.groupTexture,g.normalTexture,y,a),b.meta={resolution:v.resolution},[2,b]}})})}function ght(e){return jZe({defaultProps:I.getDefaultValues(RL),createGeometry:mht,createLocationIterator:Ya.fromGroup,getLoci:sc,eachLocation:oc,setUpdateState:function(t,r,n){r.resolution!==n.resolution&&(t.createGeometry=!0),r.radiusOffset!==n.radiusOffset&&(t.createGeometry=!0),r.smoothness!==n.smoothness&&(t.createGeometry=!0),r.ignoreHydrogens!==n.ignoreHydrogens&&(t.createGeometry=!0),r.traceOnly!==n.traceOnly&&(t.createGeometry=!0),r.includeParent!==n.includeParent&&(t.createGeometry=!0),r.smoothColors.name!==n.smoothColors.name?t.updateColor=!0:r.smoothColors.name==="on"&&n.smoothColors.name==="on"&&(r.smoothColors.params.resolutionFactor!==n.smoothColors.params.resolutionFactor&&(t.updateColor=!0),r.smoothColors.params.sampleStride!==n.smoothColors.params.sampleStride&&(t.updateColor=!0))},mustRecreate:function(t,r,n){return!r.tryUseGpu||!n||!ty(t.structure,r,n)},processValues:function(t,r,n,i,a){var o=r.meta,s=o.resolution,u=o.colorTexture,l=W2(n,i,s,a);l&&(Eoe(t,l.resolution,l.stride,l.webgl,u),r.meta.colorTexture=t.tColorGrid.ref.value)},dispose:function(t){var r;t.vertexTexture.ref.value.destroy(),t.groupTexture.ref.value.destroy(),t.normalTexture.ref.value.destroy(),t.doubleBuffer.destroy(),(r=t.meta.colorTexture)===null||r===void 0||r.destroy()}},e)}function yht(e,t,r,n,i){return ce(this,void 0,void 0,function(){var a,o,s,u,l,c,d,f,h,v,p,m,g,y;return de(this,function(b){switch(b.label){case 0:if(!e.webgl)throw new Error("webgl context required to create structure gaussian surface texture-mesh");return a=e.webgl,o=a.namedTextures,s=a.resources,u=a.extensions,l=u.colorBufferFloat,c=u.textureFloat,d=u.colorBufferHalfFloat,f=u.textureHalfFloat,o[$g]||(o[$g]=d&&f?s.texture("image-float16","rgba","fp16","linear"):l&&c?s.texture("image-float32","rgba","float","linear"):s.texture("image-uint8","rgba","ubyte","linear")),[4,Xft(t,!0,n,e.webgl,o[$g]).runInContext(e.runtime)];case 1:return h=b.sent(),v=Math.exp(-n.smoothness)/h.radiusFactor,p=i==null?void 0:i.doubleBuffer.get(),m=iL(e.webgl,h.texture,h.gridDim,h.gridTexDim,h.gridTexScale,h.transform,v,!1,!0,p==null?void 0:p.vertex,p==null?void 0:p.group,p==null?void 0:p.normal),g=Be.expand(Be(),t.boundary.sphere,n.radiusOffset+_A(t)),y=Yu.create(m.vertexCount,1,m.vertexTexture,m.groupTexture,m.normalTexture,g,i),y.meta={resolution:h.resolution},[2,y]}})})}function bht(e){return kZe({defaultProps:I.getDefaultValues(Poe),createGeometry:yht,createLocationIterator:Ya.fromStructure,getLoci:OA,eachLocation:kA,setUpdateState:function(t,r,n){r.resolution!==n.resolution&&(t.createGeometry=!0),r.radiusOffset!==n.radiusOffset&&(t.createGeometry=!0),r.smoothness!==n.smoothness&&(t.createGeometry=!0),r.ignoreHydrogens!==n.ignoreHydrogens&&(t.createGeometry=!0),r.traceOnly!==n.traceOnly&&(t.createGeometry=!0),r.includeParent!==n.includeParent&&(t.createGeometry=!0),r.smoothColors.name!==n.smoothColors.name?t.updateColor=!0:r.smoothColors.name==="on"&&n.smoothColors.name==="on"&&(r.smoothColors.params.resolutionFactor!==n.smoothColors.params.resolutionFactor&&(t.updateColor=!0),r.smoothColors.params.sampleStride!==n.smoothColors.params.sampleStride&&(t.updateColor=!0))},mustRecreate:function(t,r,n){return!r.tryUseGpu||!n||!ty(t,r,n)},processValues:function(t,r,n,i,a){var o=r.meta,s=o.resolution,u=o.colorTexture,l=W2(n,i,s,a);l&&(Eoe(t,l.resolution,l.stride,l.webgl,u),r.meta.colorTexture=t.tColorGrid.ref.value)},dispose:function(t){var r;t.vertexTexture.ref.value.destroy(),t.groupTexture.ref.value.destroy(),t.normalTexture.ref.value.destroy(),t.doubleBuffer.destroy(),(r=t.meta.colorTexture)===null||r===void 0||r.destroy()}},e)}function xht(e,t,r,n,i,a){return ce(this,void 0,void 0,function(){var o,s,u,l,c,d,f,h;return de(this,function(v){switch(v.label){case 0:return o=i.smoothness,[4,Soe(r,t,i).runInContext(e.runtime)];case 1:return s=v.sent(),u=s.transform,l=s.field,c=s.idField,d={isoLevel:Math.exp(-o),scalarField:l,idField:c},[4,rL(d,a).runAsChild(e.runtime)];case 2:return f=v.sent(),Pn.transform(f,u),h=Be.expand(Be(),t.boundary.sphere,i.radiusOffset+Z0(t)),f.setBoundingSphere(h),[2,f]}})})}var Ioe=E(E(E({},OF),$2),{sizeFactor:I.Numeric(3,{min:0,max:10,step:.1}),lineSizeAttenuation:I.Boolean(!1),ignoreHydrogens:I.Boolean(!1)});function Sht(e){return FF({defaultProps:I.getDefaultValues(Ioe),createGeometry:xht,createLocationIterator:Ya.fromGroup,getLoci:sc,eachLocation:oc,setUpdateState:function(t,r,n){r.resolution!==n.resolution&&(t.createGeometry=!0),r.radiusOffset!==n.radiusOffset&&(t.createGeometry=!0),r.smoothness!==n.smoothness&&(t.createGeometry=!0),r.ignoreHydrogens!==n.ignoreHydrogens&&(t.createGeometry=!0),r.traceOnly!==n.traceOnly&&(t.createGeometry=!0),r.includeParent!==n.includeParent&&(t.createGeometry=!0)}},e)}var Moe={"gaussian-surface-mesh":function(e,t){return si("Gaussian surface mesh",e,t,cht)},"structure-gaussian-surface-mesh":function(e,t){return Bu("Structure-Gaussian surface mesh",e,t,dht)},"gaussian-surface-wireframe":function(e,t){return si("Gaussian surface wireframe",e,t,Sht)}},Doe=E(E(E({},RL),Ioe),{visuals:I.MultiSelect(["gaussian-surface-mesh"],I.objectToOptions(Moe))});function Cht(e,t){return I.clone(Doe)}function _ht(e,t){return ur.createMulti("Gaussian Surface",e,t,Hi,Moe)}var wht={name:"gaussian-surface",label:"Gaussian Surface",description:"Displays a gaussian molecular surface.",factory:_ht,getParams:Cht,defaultValues:I.getDefaultValues(Doe),defaultColorTheme:{name:"chain-id"},defaultSizeTheme:{name:"uniform"},isApplicable:function(e){return e.elementCount>0}},Roe=E(E({},TZe),{background:I.Boolean(!0),backgroundMargin:I.Numeric(0,{min:0,max:1,step:.01}),backgroundColor:I.Color(pr.black),backgroundOpacity:I.Numeric(.5,{min:0,max:1,step:.01}),level:I.Select("residue",[["chain","Chain"],["residue","Residue"],["element","Element"]]),chainScale:I.Numeric(10,{min:0,max:20,step:.1}),residueScale:I.Numeric(1,{min:0,max:20,step:.1}),elementScale:I.Numeric(.5,{min:0,max:20,step:.1})});function Eht(e){return IZe({defaultProps:I.getDefaultValues(Roe),createGeometry:Aht,createLocationIterator:Ya.fromStructure,getLoci:OA,eachLocation:kA,setUpdateState:function(t,r,n){t.createGeometry=r.level!==n.level||r.level==="chain"&&r.chainScale!==n.chainScale||r.level==="residue"&&r.residueScale!==n.residueScale||r.level==="element"&&r.elementScale!==n.elementScale}},e)}function Aht(e,t,r,n,i){switch(n.level){case"chain":return Pht(e,t,r,n,i);case"residue":return Tht(e,t,r,n,i);case"element":return Iht(e,t,r,n,i)}}var Gs=_(),Ky=new bs("98");function Pht(e,t,r,n,i){for(var a=Ze.create(t),o=t.units,s=t.serialMapping,u=lt.chain,l=u.auth_asym_id,c=u.label_asym_id,d=s.cumulativeUnitElementCount,f=o.length,h=n.chainScale,v=bd.create(n,f,f/2,i),p=0,m=o.length;p<m;++p){var g=o[p];a.unit=g,a.element=g.elements[0];var y=g.lookup3d.boundary.sphere,b=y.center,S=y.radius;_.transformMat4(Gs,b,g.conformation.operator.matrix);var x=l(a),C=c(a),w=x===C?C:C+" ["+x+"]";v.add(w,Gs[0],Gs[1],Gs[2],S,h,d[p])}return v.getText()}function Tht(e,t,r,n,i){for(var a=Ze.create(t),o=t.units,s=t.serialMapping,u=lt.atom.label_comp_id,l=lt.residue.auth_seq_id,c=s.cumulativeUnitElementCount,d=t.polymerResidueCount*2,f=n.residueScale,h=bd.create(n,d,d/2,i),v=0,p=o.length;v<p;++v){var m=o[v],g=m.conformation.position,y=m.elements;a.unit=m,a.element=m.elements[0];for(var b=m.model.atomicHierarchy.residueAtomSegments.index,S=c[v],x=0,C=y.length;x<C;){var w=x,A=b[y[x]];for(x++;x<C&&b[y[x]]===A;)x++;Ky.reset();for(var M=w;M<x;M++)g(y[M],Gs),Ky.includePosition(Gs);Ky.finishedIncludeStep();for(var M=w;M<x;M++)g(y[M],Gs),Ky.radiusPosition(Gs);a.element=y[w];var D=Ky.getSphere(),k=D.center,R=D.radius,O=l(a),H=u(a),B=H+" "+O;h.add(B,k[0],k[1],k[2],R,f,S+w)}}return h.getText()}function Iht(e,t,r,n,i){for(var a=Ze.create(t),o=t.units,s=t.serialMapping,u=lt.atom,l=u.label_atom_id,c=u.label_alt_id,d=s.cumulativeUnitElementCount,f=k2({},{scale:1}),h=t.elementCount,v=n.elementScale,p=bd.create(n,h,h/2,i),m=0,g=o.length;m<g;++m){var y=o[m],b=y.conformation.position,S=y.elements;a.unit=y;for(var x=d[m],C=0,w=S.length;C<w;C++){a.element=S[C],b(a.element,Gs);var A=l(a),M=c(a),D=M?A+"%"+M:A;p.add(D,Gs[0],Gs[1],Gs[2],f.size(a),v,x+C)}}return p.getText()}var koe={"label-text":function(e,t){return Bu("Label text",e,t,Eht)}},Ooe=E(E({},Roe),{visuals:I.MultiSelect(["label-text"],I.objectToOptions(koe))});function Mht(e,t){return I.clone(Ooe)}function Dht(e,t){var r=ur.createMulti("Label",e,t,Hi,koe);return r.setState({pickable:!1,markerActions:nr.None}),r}var Rht={name:"label",label:"Label",description:"Displays labels.",factory:Dht,getParams:Mht,defaultValues:I.getDefaultValues(Ooe),defaultColorTheme:{name:"uniform"},defaultSizeTheme:{name:"uniform"},isApplicable:function(e){return e.elementCount>0}};function kht(e,t){return e[0]=e[1]=e[2]=1,t[0]!==0?e[0]=(t[1]+t[2])/-t[0]:t[1]!==0?e[1]=(t[0]+t[2])/-t[1]:t[2]!==0&&(e[2]=(t[0]+t[1])/-t[2]),e}function Oht(e){for(var t=0,r=2*Math.PI/e,n=new Float32Array(e),i=new Float32Array(e),a=0;a<e;a++)n[a]=Math.cos(t),i[a]=Math.sin(t),t+=r;return{cosTable:n,sinTable:i}}var kL={probeRadius:I.Numeric(1.4,{min:0,max:10,step:.1},{description:"Radius of the probe tracing the molecular surface."}),resolution:I.Numeric(.5,{min:.01,max:20,step:.01},E({description:"Grid resolution/cell spacing."},Et.CustomQualityParamInfo)),probePositions:I.Numeric(36,{min:12,max:90,step:1},E({description:"Number of positions tested for probe target intersection."},Et.CustomQualityParamInfo))};I.getDefaultValues(kL);function Fht(e,t,r,n,i,a){return ce(this,void 0,void 0,function(){function o(Ve,Xe,ct,Ne,Qe){if(h!==-1){var it=h;if(it!==Ne&&it!==Qe&&s(it,Ve,Xe,ct))return it;h=-1}for(var ot=0,dt=M.count;ot<dt;++ot){var it=Fe.getAt(D,M.indices[ot]);if(it!==Ne&&it!==Qe&&s(it,Ve,Xe,ct))return h=it,it}return-1}function s(Ve,Xe,ct,Ne){var Qe=B[Ve],it=k[Ve]-Xe,ot=R[Ve]-ct,dt=O[Ve]-Ne,ke=it*it+ot*ot+dt*dt;return ke<Qe*Qe}function u(Ve,Xe){for(var ct=Ve;ct<Xe;++ct){var Ne=Fe.getAt(D,ct),Qe=k[Ne],it=R[Ne],ot=O[Ne],dt=B[Ne],ke=dt*dt;A.find(Qe,it,ot,dt);for(var Me=Math.ceil(dt*x),Ye=Math.floor(x*(Qe-q)),tt=Math.floor(x*(it-ee)),xt=Math.floor(x*(ot-fe)),pt=Math.max(0,Ye-Me),ut=Math.max(0,tt-Me),he=Math.max(0,xt-Me),me=Math.min(U,Ye+Me+2),Ee=Math.min(z,tt+Me+2),Ke=Math.min(J,xt+Me+2),gt=pt;gt<me;++gt)for(var Pt=oe[gt]-Qe,Yt=gt*te,dr=ut;dr<Ee;++dr)for(var Dr=F[dr]-it,Qt=Pt*Pt+Dr*Dr,ui=dr*K+Yt,na=he;na<Ke;++na){var ia=V[na]-ot,Uo=Qt+ia*ia;if(Uo<ke){var Ju=na+ui;Se[Ju]<0&&(Se[Ju]*=-1);var uc=Math.sqrt(Uo),su=dt/uc,Xh=Pt*su+Qe,Yh=Dr*su+it,po=ia*su+ot;if(o(Xh,Yh,po,Ne,-1)===-1){var Kd=dt-uc;Kd<Se[Ju]&&(Se[Ju]=Kd,ie[Ju]=H[ct])}}}}}function l(){return ce(this,void 0,void 0,function(){var Ve;return de(this,function(Xe){switch(Xe.label){case 0:Ve=0,Xe.label=1;case 1:return Ve<j?(u(Ve,Math.min(Ve+pe,j)),e.shouldUpdate?[4,e.update({message:"projecting points",current:Ve,max:j})]:[3,3]):[3,4];case 2:Xe.sent(),Xe.label=3;case 3:return Ve+=pe,[3,1];case 4:return[2]}})})}function c(Ve,Xe){var ct=B[Ve],Ne=B[Xe],Qe=v[0]=k[Xe]-k[Ve],it=v[1]=R[Xe]-R[Ve],ot=v[2]=O[Xe]-O[Ve],dt=Qe*Qe+it*it+ot*ot,ke=Math.sqrt(dt),Me=(ct*ct+ke*ke-Ne*Ne)/(2*ct*ke),Ye=ct*Me;_.normalize(v,v),kht(m,v),_.normalize(m,m),_.cross(g,v,m),_.normalize(g,g);var tt=Math.sqrt(ct*ct-Ye*Ye);_.scale(m,m,tt),_.scale(g,g,tt),_.scale(v,v,Ye),p[0]=v[0]+k[Ve],p[1]=v[1]+R[Ve],p[2]=v[2]+O[Ve],h=-1;for(var xt=0;xt<S;++xt){var pt=ye[xt],ut=be[xt],he=p[0]+pt*m[0]+ut*g[0],me=p[1]+pt*m[1]+ut*g[1],Ee=p[2]+pt*m[2]+ut*g[2];if(o(he,me,Ee,Ve,Xe)===-1)for(var Ke=Math.floor(x*(he-q)),gt=Math.floor(x*(me-ee)),Pt=Math.floor(x*(Ee-fe)),Yt=Math.max(0,Ke-C),dr=Math.max(0,gt-C),Dr=Math.max(0,Pt-C),Qt=Math.min(U,Ke+C+2),ui=Math.min(z,gt+C+2),na=Math.min(J,Pt+C+2),ia=Yt;ia<Qt;++ia)for(var Uo=he-oe[ia],Ju=ia*te,uc=dr;uc<ui;++uc)for(var su=me-F[uc],Xh=Uo*Uo+su*su,Yh=uc*K+Ju,po=Dr;po<na;++po){var Kd=Ee-V[po],X2=Xh+Kd*Kd,Kh=po+Yh,Qh=Se[Kh];if(Qh>0&&X2<Qh*Qh){Se[Kh]=Math.sqrt(X2);var Qa=Uo*v[0]+su*v[1]+Kd*v[2];ie[Kh]=H[Fe.indexOf(D,Qa<0?Xe:Ve)]}}}}function d(Ve,Xe){for(var ct=Ve;ct<Xe;++ct){var Ne=Fe.getAt(D,ct);A.find(k[Ne],R[Ne],O[Ne],B[Ne]);for(var Qe=0,it=M.count;Qe<it;++Qe){var ot=Fe.getAt(D,M.indices[Qe]);Ne<ot&&c(Ne,ot)}}}function f(){return ce(this,void 0,void 0,function(){var Ve;return de(this,function(Xe){switch(Xe.label){case 0:Ve=0,Xe.label=1;case 1:return Ve<j?(d(Ve,Math.min(Ve+pe,j)),e.shouldUpdate?[4,e.update({message:"projecting torii",current:Ve,max:j})]:[3,3]):[3,4];case 2:Xe.sent(),Xe.label=3;case 3:return Ve+=pe,[3,1];case 4:return[2]}})})}var h,v,p,m,g,y,b,S,x,C,w,A,M,D,k,R,O,H,B,j,Y,G,$,q,ee,fe,W,X,U,z,J,K,Z,te,le,ye,be,Ae,Se,ie,oe,F,V,pe,we,Te,ze;return de(this,function(Ve){switch(Ve.label){case 0:return h=-1,v=_(),p=_(),m=_(),g=_(),y=a.resolution,b=a.probeRadius,S=a.probePositions,x=1/y,C=Math.max(5,2+Math.floor(b*x)),w=_.create(n,n,n),_.scale(w,w,2),A=Dv(t,r,w),M=A.result,i===null&&(i=A.boundary.box),D=t.indices,k=t.x,R=t.y,O=t.z,H=t.id,B=t.radius,j=Fe.size(D),Y=n+y,G=Kt.expand(Kt(),i,_.create(Y,Y,Y)),$=G.min,q=$[0],ee=$[1],fe=$[2],W=Kt.scale(Kt(),G,x),X=Kt.size(_(),W),_.ceil(X,X),U=X[0],z=X[1],J=X[2],K=J,Z=z,te=K*Z,le=Oht(S),ye=le.cosTable,be=le.sinTable,Ae=kr.Space(X,[0,1,2],Float32Array),Se=Ae.create(),ie=Ae.create(),Se.fill(-1001),ie.fill(-1),oe=Ug(U,q,y),F=Ug(z,ee,y),V=Ug(J,fe,y),pe=Math.ceil(1e5/(Math.pow(Math.pow(n,3),3)*x)),[4,l()];case 1:return Ve.sent(),[4,f()];case 2:return Ve.sent(),we=kr.create(Ae,Se),Te=kr.create(Ae,ie),ze=ue.identity(),ue.fromScaling(ze,_.create(y,y,y)),ue.setTranslation(ze,G.min),[2,{field:we,idField:Te,transform:ze,resolution:y}]}})})}function Lht(e,t,r){for(var n=r.probeRadius,i=CA(e,t,r),a=i.position,o=i.boundary,s=i.radius,u=a.indices,l=Fe.size(u),c=new Float32Array(Fe.end(u)),d=0,f=0;f<l;++f){var h=Fe.getAt(u,f),v=s(h);d<v&&(d=v),c[h]=v+n}return{position:E(E({},a),{radius:c}),boundary:o,maxRadius:d}}function Foe(e,t,r){var n=this,i=t.lookup3d.boundary.box,a=am(i,r),o=Lht(e,t,a),s=o.position,u=o.boundary,l=o.maxRadius;return $e.create("Molecular Surface",function(c){return ce(n,void 0,void 0,function(){return de(this,function(d){switch(d.label){case 0:return[4,Nht(c,s,u,l,i,a)];case 1:return[2,d.sent()]}})})})}function Nht(e,t,r,n,i,a){return ce(this,void 0,void 0,function(){return de(this,function(o){return[2,Fht(e,t,r,n,i,a)]})})}var Loe=E(E(E(E({},Ia),kL),SA),_oe);function Bht(e,t,r,n,i,a){return ce(this,void 0,void 0,function(){var o,s,u,l,c,d,f,h;return de(this,function(v){switch(v.label){case 0:return[4,Foe(r,t,i).runInContext(e.runtime)];case 1:return o=v.sent(),s=o.transform,u=o.field,l=o.idField,c=o.resolution,d={isoLevel:i.probeRadius,scalarField:u,idField:l},[4,TA(d,a).runAsChild(e.runtime)];case 2:return f=v.sent(),Lt.transform(f,s),e.webgl&&!e.webgl.isWebGL2&&Lt.uniformTriangleGroup(f),h=Be.expand(Be(),t.boundary.sphere,i.probeRadius+Z0(t)),f.setBoundingSphere(h),f.meta.resolution=c,[2,f]}})})}function Uht(e){return ho({defaultProps:I.getDefaultValues(Loe),createGeometry:Bht,createLocationIterator:Ya.fromGroup,getLoci:sc,eachLocation:oc,setUpdateState:function(t,r,n){r.resolution!==n.resolution&&(t.createGeometry=!0),r.probeRadius!==n.probeRadius&&(t.createGeometry=!0),r.probePositions!==n.probePositions&&(t.createGeometry=!0),r.ignoreHydrogens!==n.ignoreHydrogens&&(t.createGeometry=!0),r.traceOnly!==n.traceOnly&&(t.createGeometry=!0),r.includeParent!==n.includeParent&&(t.createGeometry=!0),r.smoothColors.name!==n.smoothColors.name?t.updateColor=!0:r.smoothColors.name==="on"&&n.smoothColors.name==="on"&&(r.smoothColors.params.resolutionFactor!==n.smoothColors.params.resolutionFactor&&(t.updateColor=!0),r.smoothColors.params.sampleStride!==n.smoothColors.params.sampleStride&&(t.updateColor=!0))},processValues:function(t,r,n,i,a){var o=r.meta,s=o.resolution,u=o.colorTexture,l=W2(n,i,s,a);l&&(DL(t,l.resolution,l.stride,l.webgl,u),r.meta.colorTexture=t.tColorGrid.ref.value)},dispose:function(t){var r;(r=t.meta.colorTexture)===null||r===void 0||r.destroy()}},e)}var Noe=E(E(E(E({},OF),kL),SA),{sizeFactor:I.Numeric(1.5,{min:0,max:10,step:.1})});function jht(e,t,r,n,i,a){return ce(this,void 0,void 0,function(){var o,s,u,l,c,d,f;return de(this,function(h){switch(h.label){case 0:return[4,Foe(r,t,i).runInContext(e.runtime)];case 1:return o=h.sent(),s=o.transform,u=o.field,l=o.idField,c={isoLevel:i.probeRadius,scalarField:u,idField:l},[4,rL(c,a).runAsChild(e.runtime)];case 2:return d=h.sent(),Pn.transform(d,s),f=Be.expand(Be(),t.boundary.sphere,i.probeRadius+Z0(t)),d.setBoundingSphere(f),[2,d]}})})}function zht(e){return FF({defaultProps:I.getDefaultValues(Noe),createGeometry:jht,createLocationIterator:Ya.fromGroup,getLoci:sc,eachLocation:oc,setUpdateState:function(t,r,n){r.resolution!==n.resolution&&(t.createGeometry=!0),r.probeRadius!==n.probeRadius&&(t.createGeometry=!0),r.probePositions!==n.probePositions&&(t.createGeometry=!0),r.ignoreHydrogens!==n.ignoreHydrogens&&(t.createGeometry=!0),r.includeParent!==n.includeParent&&(t.createGeometry=!0)}},e)}var Boe={"molecular-surface-mesh":function(e,t){return si("Molecular surface mesh",e,t,Uht)},"molecular-surface-wireframe":function(e,t){return si("Molecular surface wireframe",e,t,zht)}},Uoe=E(E(E({},Loe),Noe),{visuals:I.MultiSelect(["molecular-surface-mesh"],I.objectToOptions(Boe))});function Vht(e,t){return I.clone(Uoe)}function Hht(e,t){return ur.createMulti("Molecular Surface",e,t,Hi,Boe)}var Ght={name:"molecular-surface",label:"Molecular Surface",description:"Displays a molecular surface.",factory:Hht,getParams:Vht,defaultValues:I.getDefaultValues(Uoe),defaultColorTheme:{name:"chain-id"},defaultSizeTheme:{name:"uniform"},isApplicable:function(e){return e.elementCount>0}},joe=E(E({},Ia),{sizeFactor:I.Numeric(1,{min:0,max:2,step:.1}),detail:I.Numeric(0,{min:0,max:3,step:1},Et.CustomQualityParamInfo)});function qht(e){return ho({defaultProps:I.getDefaultValues(joe),createGeometry:Wht,createLocationIterator:Xht,getLoci:Yht,eachLocation:Kht,setUpdateState:function(t,r,n){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.detail!==n.detail}},e)}function $ht(e){if(je.Traits.is(e.traits,1)||je.Traits.is(e.traits,2))return!1;if(je.isCoarse(e))return!0;if(e.elements.length===0)return!1;e.model.atomicHierarchy.derived.residue.moleculeType;var t=e.residueIndex[e.elements[0]],r=e.model.atomicHierarchy.derived.residue.moleculeType[t];return!(r===3||r===2)}function Wht(e,t,r,n,i,a){if(!$ht(t))return Lt.createEmpty(a);var o=i.detail,s=i.sizeFactor,u=256,l=wt.createState(u,u/2,a),c=t.principalAxes.boxAxes,d=c.origin,f=c.dirA,h=c.dirB,v=Iu.size(_(),c);_.scale(v,v,s/2);var p=_.create(v[2],v[1],v[0]);l.currentGroup=0,PF(l,d,f,h,p,o+1);var m=wt.getMesh(l),g=Be.expand(Be(),t.boundary.sphere,1*i.sizeFactor);return m.setBoundingSphere(g),m}function Xht(e){var t=e.group,r=e.structure,n=1,i=t.units.length,a=Ze.create(r),o=function(s,u){var l=t.units[u];return a.unit=l,a.element=l.elements[s],a};return wn(n,i,1,o)}function Yht(e,t,r){var n=e.objectId,i=e.instanceId;if(r===n){var a=t.structure,o=t.group,s=o.units[i],u=Fe.ofBounds(0,s.elements.length);return Re(a,[{unit:s,indices:u}])}return jr}function Kht(e,t,r){var n=!1;if(!Re.is(e))return!1;var i=t.structure,a=t.group;if(!We.areEquivalent(e.structure,i))return!1;for(var o=a.elements.length,s=0,u=e.elements;s<u.length;s++){var l=u[s],c=a.unitIndexMap.get(l.unit.id);c!==void 0&&Fe.size(l.indices)===o&&r(Ie.ofSingleton(c))&&(n=!0)}return n}var zoe={"orientation-ellipsoid-mesh":function(e,t){return si("Orientation ellipsoid mesh",e,t,qht)}},Voe=E(E({},joe),{visuals:I.MultiSelect(["orientation-ellipsoid-mesh"],I.objectToOptions(zoe))});function Qht(e,t){return I.clone(Voe)}function Zht(e,t){return ur.createMulti("Orientation",e,t,Hi,zoe)}var Jht={name:"orientation",label:"Orientation",description:"Displays orientation ellipsoids for polymer chains.",factory:Zht,getParams:Qht,defaultValues:I.getDefaultValues(Voe),defaultColorTheme:{name:"chain-id"},defaultSizeTheme:{name:"uniform"},isApplicable:function(e){return e.elementCount>0}},ept=qe.add3,tpt=qe.add,ok;(function(e){function t(r,n,i){r===void 0&&(r=2048),n===void 0&&(n=1024);var a=qe.create(Float32Array,3,n,i?i.centerBuffer.ref.value:r),o=qe.create(Float32Array,1,n,i?i.groupBuffer.ref.value:r);return{add:function(s,u,l,c){ept(a,s,u,l),tpt(o,c)},getPoints:function(){var s=qe.compact(a,!0),u=qe.compact(o,!0);return Bv.create(s,u,a.elementCount,i)}}}e.create=t})(ok||(ok={}));var Hoe=E(E({},FZe),{pointSizeAttenuation:I.Boolean(!0),ignoreHydrogens:I.Boolean(!1),traceOnly:I.Boolean(!1)});function rpt(e,t,r,n,i,a){var o=r.child;if(o&&!o.unitMap.get(t.id))return Bv.createEmpty(a);var s=t.elements,u=s.length,l=ok.create(u,u/10,a),c=_(),d=t.conformation.invariantPosition,f=EL(r,t,i);if(f)for(var h=0;h<u;++h)f(s[h])||(d(s[h],c),l.add(c[0],c[1],c[2],h));else for(var h=0;h<u;++h)d(s[h],c),l.add(c[0],c[1],c[2],h);var v=l.getPoints(),p=Be.expand(Be(),t.boundary.sphere,1*i.sizeFactor);return v.setBoundingSphere(p),v}function npt(e){return LZe({defaultProps:I.getDefaultValues(Hoe),createGeometry:rpt,createLocationIterator:Ya.fromGroup,getLoci:sc,eachLocation:oc,setUpdateState:function(t,r,n){t.createGeometry=r.ignoreHydrogens!==n.ignoreHydrogens||r.traceOnly!==n.traceOnly}},e)}var ipt={"element-point":function(e,t){return si("Points",e,t,npt)}},Goe=E({},Hoe);function apt(e,t){return I.clone(Goe)}function opt(e,t){return ur.createMulti("Point",e,t,Hi,ipt)}var spt={name:"point",label:"Point",description:"Displays elements (atoms, coarse spheres) as spheres.",factory:opt,getParams:apt,defaultValues:I.getDefaultValues(Goe),defaultColorTheme:{name:"element-symbol"},defaultSizeTheme:{name:"physical"},isApplicable:function(e){return e.elementCount>0}},qoe={sizeFactor:I.Numeric(.2,{min:0,max:10,step:.01}),detail:I.Numeric(0,{min:0,max:3,step:1},Et.CustomQualityParamInfo),linearSegments:I.Numeric(8,{min:1,max:48,step:1},Et.CustomQualityParamInfo),radialSegments:I.Numeric(16,{min:2,max:56,step:2},Et.CustomQualityParamInfo)};I.getDefaultValues(qoe);var So=_();function upt(e,t,r,n,i,a){var o=t.polymerElements.length;if(!o)return Lt.createEmpty(a);for(var s=i.sizeFactor,u=i.detail,l=i.linearSegments,c=i.radialSegments,d=l*c*o+(c+1)*o*2,f=wt.createState(d,d/10,a),h=PL(l),v=h.curvePoints,p=h.normalVectors,m=h.binormalVectors,g=h.widthValues,y=h.heightValues,b=0,S=AL(t,r,{ignoreSecondaryStructure:!0});S.hasNext;){var x=S.move();f.currentGroup=b;var C=ic(x.moleculeType),w=C?NA:LA;TL(h,x,Hae,w);var A=x.coarseBackboneFirst||x.first,M=x.coarseBackboneLast||x.last,D=n.size.size(x.centerPrev)*s,k=n.size.size(x.center)*s,R=n.size.size(x.centerNext)*s;rk(h,D,k,R,D,k,R,w);var O=l;if(x.initial){O=Math.max(Math.round(l*w),1);var H=l-O;v.copyWithin(0,H*3),m.copyWithin(0,H*3),p.copyWithin(0,H*3),g.copyWithin(0,H*3),y.copyWithin(0,H*3),_.fromArray(So,v,3),_.normalize(So,_.sub(So,x.p2,So)),_.scaleAndAdd(So,x.p2,So,k*c3),_.toArray(So,v,0)}else x.final&&(O=Math.max(Math.round(l*(1-w)),1),_.fromArray(So,v,O*3-3),_.normalize(So,_.sub(So,x.p2,So)),_.scaleAndAdd(So,x.p2,So,k*c3),_.toArray(So,v,O*3));x.initial===!0&&x.final===!0?zi(f,x.p2,k*2,u):c===2?RC(f,v,p,m,O,g,y,0):c===4?ak(f,v,p,m,O,g,y,0,A,M):roe(f,v,p,m,O,c,g,y,A,M),++b}var B=wt.getMesh(f),j=Be.expand(Be(),t.boundary.sphere,1*i.sizeFactor);return B.setBoundingSphere(j),B}var $oe=E(E({},Ia),qoe);function lpt(e){return ho({defaultProps:I.getDefaultValues($oe),createGeometry:upt,createLocationIterator:Ad.fromGroup,getLoci:hm,eachLocation:pm,setUpdateState:function(t,r,n){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.detail!==n.detail||r.linearSegments!==n.linearSegments||r.radialSegments!==n.radialSegments}},e)}var Woe={"polymer-tube":function(e,t){return si("Polymer tube mesh",e,t,lpt)},"polymer-gap":function(e,t){return si("Polymer gap cylinder",e,t,IL)}},Xoe=E(E(E({},$oe),BA),{sizeFactor:I.Numeric(.2,{min:0,max:10,step:.01}),visuals:I.MultiSelect(["polymer-tube","polymer-gap"],I.objectToOptions(Woe))});function cpt(e,t){var r=I.clone(Xoe),n=!1,i=!1;return t.units.forEach(function(a){!n&&je.isAtomic(a)&&a.nucleotideElements.length&&(n=!0),!i&&a.gapElements.length&&(i=!0)}),r.visuals.defaultValue=["polymer-tube"],i&&r.visuals.defaultValue.push("polymer-gap"),r}function dpt(e,t){return ur.createMulti("Putty",e,t,Hi,Woe)}var fpt={name:"putty",label:"Putty",description:"Displays a tube smoothly following the trace atoms of polymers.",factory:dpt,getParams:cpt,defaultValues:I.getDefaultValues(Xoe),defaultColorTheme:{name:"chain-id"},defaultSizeTheme:{name:"uncertainty"},isApplicable:function(e){return e.polymerResidueCount>0}},hpt={"element-sphere":function(e,t){return si("Sphere mesh",e,t,Mae)}},Yoe=E({},FA);function ppt(e,t){var r=I.clone(Yoe);return t.isCoarseGrained&&(r.sizeFactor.defaultValue=2),r}function vpt(e,t){return ur.createMulti("Spacefill",e,t,Hi,hpt)}var mpt={name:"spacefill",label:"Spacefill",description:"Displays atomic/coarse elements as spheres.",factory:vpt,getParams:ppt,defaultValues:I.getDefaultValues(Yoe),defaultColorTheme:{name:"element-symbol"},defaultSizeTheme:{name:"physical"},isApplicable:function(e){return e.elementCount>0}},NI=Hr.is;function gpt(e,t,r,n,i,a){if(!je.isAtomic(t))return Pn.createEmpty(a);var o=r.child,s=o==null?void 0:o.unitMap.get(t.id);if(o&&!s)return Pn.createEmpty(a);var u=Ze.create(r,t),l=t.elements,c=t.bonds,d=c.edgeCount,f=c.a,h=c.b,v=c.edgeProps,p=c.offset,m=v.order,g=v.flags,y=i.sizeFactor,b=i.aromaticBonds;if(!d)return Pn.createEmpty(a);var S=_(),x=t.conformation.invariantPosition,C=t.rings,w=C.elementRingIndices,A=C.elementAromaticRingIndices,M={linkCount:d*2,referencePosition:function(R){var O,H,B=f[R],j=h[R];B>j&&(O=[j,B],B=O[0],j=O[1]),p[B+1]-p[B]===1&&(H=[j,B],B=H[0],j=H[1]);for(var Y=w.get(B),G=0,$=p[B],q=p[B+1];$<q;++$){var ee=h[$];if(ee!==j&&ee!==B)if(Y){var fe=w.get(ee);if(!fe)continue;var W=nw(Y,fe);W>G&&(G=W,x(l[ee],S))}else return x(l[ee],S)}return G>0?S:null},position:function(R,O,H){x(l[f[H]],R),x(l[h[H]],O)},style:function(R){var O=m[R],H=g[R];if(NI(H,2)||NI(H,4))return 1;if(O===3)return 3;if(b){var B=f[R],j=h[R],Y=A.get(B),G=A.get(j),$=Y&&G?nw(Y,G):0;if($||NI(H,16))return $===2?6:5}return O===2?2:0},radius:function(R){u.element=l[f[R]];var O=n.size.size(u);u.element=l[h[R]];var H=n.size.size(u);return Math.min(O,H)*y},ignore:_ae(r,t,i)},D=kne(e,M,i,a),k=Be.expand(Be(),(s??t).boundary.sphere,1*y);return D.setBoundingSphere(k),D}var Koe=E(E(E({},OF),xL),{includeParent:I.Boolean(!1)});function ypt(e){return FF({defaultProps:I.getDefaultValues(Koe),createGeometry:gpt,createLocationIterator:Nh.fromGroup,getLoci:SL,eachLocation:CL,setUpdateState:function(t,r,n,i,a,o,s){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.linkScale!==n.linkScale||r.linkSpacing!==n.linkSpacing||r.dashCount!==n.dashCount||r.ignoreHydrogens!==n.ignoreHydrogens||!so(r.includeTypes,n.includeTypes)||!so(r.excludeTypes,n.excludeTypes)||r.aromaticBonds!==n.aromaticBonds;var u=o.group.units[0],l=s.group.units[0];je.isAtomic(u)&&je.isAtomic(l)&&(Oo.areEqual(u.bonds,l.bonds)||(t.createGeometry=!0,t.updateTransform=!0,t.updateColor=!0,t.updateSize=!0))}},e)}var BI=new Ht.ElementBondIterator;function cq(e,t,r,n){for(BI.setElement(t,r,n);BI.hasNext;){var i=BI.move();return i.otherUnit.conformation.position(i.otherUnit.elements[i.otherIndex],e),e}return null}function bpt(e,t,r,n,i){var a=t.interUnitBonds,o=a.edgeCount,s=a.edges,u=n.sizeFactor,l=n.aromaticBonds;if(!o)return Pn.createEmpty(i);var c=_(),d=Ze.create(),f={linkCount:o,referencePosition:function(m){var g=s[m],y,b,S,x;if(g.unitA<g.unitB)y=t.unitMap.get(g.unitA),b=t.unitMap.get(g.unitB),S=g.indexA,x=g.indexB;else if(g.unitA>g.unitB)y=t.unitMap.get(g.unitB),b=t.unitMap.get(g.unitA),S=g.indexB,x=g.indexA;else throw new Error("same units in createInterUnitBondLines");return cq(c,t,y,S)||cq(c,t,b,x)},position:function(m,g,y){var b=s[y],S=t.unitMap.get(b.unitA),x=t.unitMap.get(b.unitB);S.conformation.position(S.elements[b.indexA],m),x.conformation.position(x.elements[b.indexB],g)},style:function(m){var g=s[m].props.order,y=_a.create(s[m].props.flag);return Hr.is(y,2)||Hr.is(y,4)?1:g===3?3:l&&Hr.is(y,16)?5:g===2?2:0},radius:function(m){var g=s[m];d.structure=t,d.unit=t.unitMap.get(g.unitA),d.element=d.unit.elements[g.indexA];var y=r.size.size(d);d.unit=t.unitMap.get(g.unitB),d.element=d.unit.elements[g.indexB];var b=r.size.size(d);return Math.min(y,b)*u},ignore:wae(t,n)},h=kne(e,f,n,i),v=t.child,p=Be.expand(Be(),(v??t).boundary.sphere,1*n.sizeFactor);return h.setBoundingSphere(p),h}var Qoe=E(E(E({},AZe),xL),{includeParent:I.Boolean(!1)});function xpt(e){return PZe({defaultProps:I.getDefaultValues(Qoe),createGeometry:bpt,createLocationIterator:Nh.fromStructure,getLoci:_L,eachLocation:wL,setUpdateState:function(t,r,n){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.linkScale!==n.linkScale||r.linkSpacing!==n.linkSpacing||r.dashCount!==n.dashCount||r.ignoreHydrogens!==n.ignoreHydrogens||!so(r.includeTypes,n.includeTypes)||!so(r.excludeTypes,n.excludeTypes)}},e)}var Zoe={"intra-bond":function(e,t){return si("Intra-unit bond line",e,t,ypt)},"inter-bond":function(e,t){return Bu("Inter-unit bond line",e,t,xpt)}},Joe=E(E(E({},Koe),Qoe),{includeParent:I.Boolean(!1),sizeFactor:I.Numeric(1.5,{min:.01,max:10,step:.01}),unitKinds:O2(["atomic"]),visuals:I.MultiSelect(["intra-bond","inter-bond"],I.objectToOptions(Zoe))});function Spt(e,t){return I.clone(Joe)}function Cpt(e,t){return ur.createMulti("Line",e,t,Hi,Zoe)}var _pt={name:"line",label:"Line",description:"Displays bonds as lines.",factory:Cpt,getParams:Spt,defaultValues:I.getDefaultValues(Joe),defaultColorTheme:{name:"element-symbol"},defaultSizeTheme:{name:"uniform"},isApplicable:function(e){return e.elementCount>0},getData:function(e,t){return t.includeParent?e.asParent():e},mustRecreate:function(e,t){return e.includeParent!==t.includeParent}};function wpt(e,t,r,n,i){return ce(this,void 0,void 0,function(){var a,o,s,u,l,c,d,f,h,v,p,m,g;return de(this,function(y){switch(y.label){case 0:if(a=e.runtime,o=e.webgl,!o||!o.extensions.blendMinMax)throw new Error("GaussianDensityVolume requires `webgl` and `blendMinMax` extension");return s=i?i.gridTexture.ref.value:void 0,[4,Wft(t,n,o,s).runInContext(a)];case 1:return u=y.sent(),l=u.transform,c=u.texture,d=u.bbox,f=u.gridDim,h={min:0,max:1,mean:.04,sigma:.01},v=ue.mul(ue(),l,ue.fromScaling(ue(),f)),p=ue.getScaling(_(),l),m=uo.create(d,f,l,v,p,c,h,!0,i),g=Be.expand(Be(),t.boundary.sphere,n.radiusOffset+_A(t)),m.setBoundingSphere(g),[2,m]}})})}var ese=E(E(E({},MZe),$2),{ignoreHydrogens:I.Boolean(!1)});function Ept(e){return DZe({defaultProps:I.getDefaultValues(ese),createGeometry:wpt,createLocationIterator:Ya.fromStructure,getLoci:OA,eachLocation:kA,setUpdateState:function(t,r,n){r.resolution!==n.resolution&&(t.createGeometry=!0),r.radiusOffset!==n.radiusOffset&&(t.createGeometry=!0),r.smoothness!==n.smoothness&&(t.createGeometry=!0),r.ignoreHydrogens!==n.ignoreHydrogens&&(t.createGeometry=!0),r.traceOnly!==n.traceOnly&&(t.createGeometry=!0),r.includeParent!==n.includeParent&&(t.createGeometry=!0)},dispose:function(t){t.gridTexture.ref.value.destroy()}},e)}function Apt(e,t,r,n,i,a){return ce(this,void 0,void 0,function(){var o,s,u,l,c,d,f,h,v,p,m,g,y;return de(this,function(b){switch(b.label){case 0:if(o=e.runtime,s=e.webgl,!s)throw new Error("GaussianDensityVolume requires `webgl`");return u=a?a.gridTexture.ref.value:void 0,[4,Gft(r,t,i,s,u).runInContext(o)];case 1:return l=b.sent(),c=l.transform,d=l.texture,f=l.bbox,h=l.gridDim,v={min:0,max:1,mean:.04,sigma:.01},p=ue.mul(ue(),c,ue.fromScaling(ue(),h)),m=ue.getScaling(_(),c),g=uo.create(f,h,c,p,m,d,v,!0,a),y=Be.expand(Be(),t.boundary.sphere,i.radiusOffset+Z0(t)),g.setBoundingSphere(y),[2,g]}})})}var Ppt=E(E(E({},NZe),$2),{ignoreHydrogens:I.Boolean(!1)});function Tpt(e){return BZe({defaultProps:I.getDefaultValues(Ppt),createGeometry:Apt,createLocationIterator:Ya.fromGroup,getLoci:sc,eachLocation:oc,setUpdateState:function(t,r,n){r.resolution!==n.resolution&&(t.createGeometry=!0),r.radiusOffset!==n.radiusOffset&&(t.createGeometry=!0),r.smoothness!==n.smoothness&&(t.createGeometry=!0),r.ignoreHydrogens!==n.ignoreHydrogens&&(t.createGeometry=!0),r.traceOnly!==n.traceOnly&&(t.createGeometry=!0),r.includeParent!==n.includeParent&&(t.createGeometry=!0)},dispose:function(t){t.gridTexture.ref.value.destroy()}},e)}var tse={"gaussian-volume":function(e,t){return Bu("Gaussian volume",e,t,Ept)},"units-gaussian-volume":function(e,t){return si("Units-Gaussian volume",e,t,Tpt)}},rse=E(E({},ese),{visuals:I.MultiSelect(["gaussian-volume"],I.objectToOptions(tse))});function Ipt(e,t){var r=I.clone(rse);return r.renderMode=uo.createRenderModeParam({min:0,max:1,mean:.04,sigma:.01}),r.jumpLength=I.Numeric(4,{min:0,max:20,step:.1}),r}function Mpt(e,t){return ur.createMulti("Gaussian Volume",e,t,Hi,tse)}var Dpt={name:"gaussian-volume",label:"Gaussian Volume",description:"Displays a gaussian molecular density using direct volume rendering.",factory:Mpt,getParams:Ipt,defaultValues:I.getDefaultValues(rse),defaultColorTheme:{name:"chain-id"},defaultSizeTheme:{name:"uniform"},isApplicable:function(e){return e.elementCount>0}},Rpt=_.scale,kpt=_.add,Opt=_.sub,OL=E(E(E({},Ia),bne),{sizeFactor:I.Numeric(.3,{min:0,max:10,step:.01}),radialSegments:I.Numeric(16,{min:2,max:56,step:2},Et.CustomQualityParamInfo),tryUseImpostor:I.Boolean(!0)});function Fpt(e,t,r,n){return r.tryUseImpostor&&n&&n.extensions.fragDepth?Npt(e):Upt(e)}function Lpt(e,t,r,n,i,a){var o=t.polymerElements.length;if(!o)return as.createEmpty(a);var s=o*2,u=qw.create(s,s/4,a),l=t.conformation.invariantPosition,c=_(),d=_(),f=_(),h=function(m,g,y,b,S){l(m,c),l(g,d);var x=ic(S),C=x?NA:LA;kpt(f,c,Rpt(f,Opt(f,d,c),C)),u.add(c[0],c[1],c[2],f[0],f[1],f[2],1,!1,!1,y),u.add(f[0],f[1],f[2],d[0],d[1],d[2],1,!1,!1,b)};Uae(t,h);var v=u.getCylinders(),p=Be.expand(Be(),t.boundary.sphere,1*i.sizeFactor);return v.setBoundingSphere(p),v}function Npt(e){return xne({defaultProps:I.getDefaultValues(OL),createGeometry:Lpt,createLocationIterator:Ad.fromGroup,getLoci:hm,eachLocation:pm,setUpdateState:function(t,r,n){},mustRecreate:function(t,r,n){return!r.tryUseImpostor||!n}},e)}function Bpt(e,t,r,n,i,a){var o=t.polymerElements.length;if(!o)return Lt.createEmpty(a);var s=i.radialSegments,u=i.sizeFactor,l=s*2*o*2,c=wt.createState(l,l/10,a),d=t.conformation.invariantPosition,f=_(),h=_(),v={radiusTop:1,radiusBottom:1,radialSegments:s},p=Ze.create(r,t),m=Ze.create(r,t),g=function(S,x,C,w,A){p.element=S,m.element=x,d(p.element,f),d(m.element,h);var M=ic(A),D=M?NA:LA;v.radiusTop=v.radiusBottom=n.size.size(p)*u,c.currentGroup=C,Ha(c,f,h,D,v),v.radiusTop=v.radiusBottom=n.size.size(m)*u,c.currentGroup=w,Ha(c,h,f,1-D,v)};Uae(t,g);var y=wt.getMesh(c),b=Be.expand(Be(),t.boundary.sphere,1*i.sizeFactor);return y.setBoundingSphere(b),y}function Upt(e){return ho({defaultProps:I.getDefaultValues(OL),createGeometry:Bpt,createLocationIterator:Ad.fromGroup,getLoci:hm,eachLocation:pm,setUpdateState:function(t,r,n){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.radialSegments!==n.radialSegments},mustRecreate:function(t,r,n){return r.tryUseImpostor&&!!n}},e)}var FL=E(E(E({},Ia),gne),{sizeFactor:I.Numeric(.3,{min:0,max:10,step:.01}),detail:I.Numeric(0,{min:0,max:3,step:1},Et.CustomQualityParamInfo),tryUseImpostor:I.Boolean(!0)});function jpt(e,t,r,n){return r.tryUseImpostor&&n&&n.extensions.fragDepth?Vpt(e):Gpt(e)}function zpt(e,t,r,n,i,a){var o=t.polymerElements.length;if(!o)return Oh.createEmpty(a);var s=l3.create(o,o/2,a),u=t.conformation.invariantPosition,l=_(),c=function(h,v){u(h,l),s.add(l[0],l[1],l[2],v)};jae(t,c);var d=s.getSpheres(),f=Be.expand(Be(),t.boundary.sphere,1*i.sizeFactor);return d.setBoundingSphere(f),d}function Vpt(e){return yne({defaultProps:I.getDefaultValues(FL),createGeometry:zpt,createLocationIterator:Ad.fromGroup,getLoci:hm,eachLocation:pm,setUpdateState:function(t,r,n){},mustRecreate:function(t,r,n){return!r.tryUseImpostor||!n}},e)}function Hpt(e,t,r,n,i,a){var o=t.polymerElements.length;if(!o)return Lt.createEmpty(a);var s=i.detail,u=i.sizeFactor,l=o*iA(s),c=wt.createState(l,l/2,a),d=t.conformation.invariantPosition,f=_(),h=Ze.create(r,t),v=function(g,y){h.element=g,d(h.element,f),c.currentGroup=y,zi(c,f,n.size.size(h)*u,s)};jae(t,v);var p=wt.getMesh(c),m=Be.expand(Be(),t.boundary.sphere,1*i.sizeFactor);return p.setBoundingSphere(m),p}function Gpt(e){return ho({defaultProps:I.getDefaultValues(FL),createGeometry:Hpt,createLocationIterator:Ad.fromGroup,getLoci:hm,eachLocation:pm,setUpdateState:function(t,r,n){t.createGeometry=r.sizeFactor!==n.sizeFactor||r.detail!==n.detail},mustRecreate:function(t,r,n){return r.tryUseImpostor&&!!n}},e)}var nse={"polymer-backbone-cylinder":function(e,t){return si("Polymer backbone cylinder",e,t,Fpt)},"polymer-backbone-sphere":function(e,t){return si("Polymer backbone sphere",e,t,jpt)},"polymer-gap":function(e,t){return si("Polymer gap cylinder",e,t,IL)}},ise=E(E(E(E({},FL),OL),BA),{sizeAspectRatio:I.Numeric(1,{min:.1,max:3,step:.1}),visuals:I.MultiSelect(["polymer-backbone-cylinder","polymer-backbone-sphere","polymer-gap"],I.objectToOptions(nse))});function qpt(e,t){var r=I.clone(ise),n=!1;return t.units.forEach(function(i){!n&&i.gapElements.length&&(n=!0)}),r.visuals.defaultValue=["polymer-backbone-cylinder","polymer-backbone-sphere"],n&&r.visuals.defaultValue.push("polymer-gap"),r}function $pt(e,t){return ur.createMulti("Backbone",e,t,Hi,nse)}var Wpt={name:"backbone",label:"Backbone",description:"Displays polymer backbone with cylinders and spheres.",factory:$pt,getParams:qpt,defaultValues:I.getDefaultValues(ise),defaultColorTheme:{name:"chain-id"},defaultSizeTheme:{name:"uniform"},isApplicable:function(e){return e.polymerResidueCount>0}},sk=function(e){Le(t,e);function t(){var r=e.call(this)||this;return $u(t.BuiltIn,function(n,i){if(n.name!==i)throw new Error("Fix BuiltInStructureRepresentations to have matching names. "+n.name+" "+i);r.add(n)}),r}return t}(Nre);(function(e){e.BuiltIn={cartoon:Ift,backbone:Wpt,"ball-and-stick":Lct,carbohydrate:bdt,ellipsoid:Oft,"gaussian-surface":wht,"gaussian-volume":Dpt,label:Rht,line:_pt,"molecular-surface":Ght,orientation:Jht,point:spt,putty:fpt,spacefill:mpt}})(sk||(sk={}));var Xpt=function(){function e(t){var r=this;this.plugin=t,this.currentFrame=void 0,this._isAnimating=!1,this.frame=function(){r.tick(Ln()),r._isAnimating&&(r.currentFrame=requestAnimationFrame(r.frame))}}return Object.defineProperty(e.prototype,"isAnimating",{get:function(){return this._isAnimating},enumerable:!1,configurable:!0}),e.prototype.tick=function(t,r){var n;return ce(this,void 0,void 0,function(){return de(this,function(i){switch(i.label){case 0:return[4,this.plugin.managers.animation.tick(t,r==null?void 0:r.isSynchronous)];case 1:return i.sent(),(n=this.plugin.canvas3d)===null||n===void 0||n.tick(t,r),[2]}})})},e.prototype.resetTime=function(t){var r;t===void 0&&(t=Ln()),(r=this.plugin.canvas3d)===null||r===void 0||r.resetTime(t)},e.prototype.start=function(t){var r;(r=this.plugin.canvas3d)===null||r===void 0||r.resume(),this._isAnimating=!0,this.resetTime(),t!=null&&t.immediate?this.frame():this.currentFrame=requestAnimationFrame(this.frame)},e.prototype.stop=function(t){var r;this._isAnimating=!1,this.currentFrame!==void 0&&(cancelAnimationFrame(this.currentFrame),this.currentFrame=void 0),t!=null&&t.noDraw&&((r=this.plugin.canvas3d)===null||r===void 0||r.pause(t==null?void 0:t.noDraw))},e}(),Ypt=function(){function e(t){var r=this;this.plugin=t,this.ev=hd.create(),this.events={updated:this.ev(),removed:this.ev()},this.root=new Map,this.tracked=new Map,t.state.data.events.object.created.subscribe(function(n){r.addMapping(n.state,n.ref,n.obj)}),t.state.data.events.object.removed.subscribe(function(n){r.removeMapping(n.ref)&&r.events.removed.next({ref:n.ref,obj:n.obj})}),t.state.data.events.object.updated.subscribe(function(n){r.updateMapping(n.state,n.ref,n.oldObj,n.obj)&&r.events.updated.next({ref:n.ref,oldObj:n.oldObj,obj:n.obj})})}return e.prototype.getDecorator=function(t){var r=this.plugin.state.data.tree,n=r.children.get(t);if(n.size!==1)return t;var i=n.first();return r.transforms.get(i).transformer.definition.isDecorator?this.getDecorator(i):t},e.prototype.get=function(t,r){r===void 0&&(r=!1);var n=this.root.get(t);if(n)return r?this.plugin.state.data.cells.get(n.ref):this.plugin.state.data.cells.get(this.getDecorator(n.ref))},e.prototype.addMapping=function(t,r,n){if(!ge.Molecule.Structure.is(n))return!1;if(this.tracked.set(r,n.data),this.root.has(n.data)){var i=this.root.get(n.data);i.count++}else{var a=t.select(or.Generators.byRef(r).rootOfType([ge.Molecule.Structure]))[0];a?this.root.set(n.data,{ref:a.transform.ref,count:1}):this.root.set(n.data,{ref:r,count:1})}return!0},e.prototype.removeMapping=function(t){if(!this.tracked.has(t))return!1;var r=this.tracked.get(t);this.tracked.delete(t);var n=this.root.get(r);return n.count>1?n.count--:this.root.delete(r),!0},e.prototype.updateMapping=function(t,r,n,i){return ge.Molecule.Structure.is(i)?(this.removeMapping(r),this.addMapping(t,r,i),!0):!1},e.prototype.dispose=function(){this.ev.dispose()},e}(),uk=function(){function e(){this.ev=hd.create(),this.id=0,this.runningTasks=new Set,this.abortRequests=new Map,this.options=new Map,this.currentContext=[],this.events={progress:this.ev(),finished:this.ev()}}return e.prototype.tryGetAbortTaskId=function(t){if(this.abortRequests.has(t.progress.taskId))return t.progress.taskId;for(var r=0,n=t.children;r<n.length;r++){var i=n[r],a=this.tryGetAbortTaskId(i);if(a!==void 0)return a}},e.prototype.track=function(t,r){var n=this;return function(i){var a;if(i.canAbort&&i.requestAbort){var o=n.tryGetAbortTaskId(i.root);o!==void 0&&i.requestAbort(n.abortRequests.get(o))}var s=Ln()-i.root.progress.startedTime;n.events.progress.next({id:t,useOverlay:(a=n.options.get(r))===null||a===void 0?void 0:a.useOverlay,level:s<250?"none":"background",progress:i})}},e.prototype.run=function(t,r){return ce(this,void 0,void 0,function(){var n,i,a;return de(this,function(o){switch(o.label){case 0:n=this.id++,r!=null&&r.createNewContext||this.currentContext.length===0?i={ctx:GRe(t,this.track(n,t.id),100),refCount:1}:(i=this.currentContext[this.currentContext.length-1],i.refCount++),o.label=1;case 1:return o.trys.push([1,,3,4]),this.options.set(t.id,{useOverlay:!!(r!=null&&r.useOverlay)}),this.runningTasks.add(t.id),[4,zZ(i.ctx,t)];case 2:return a=o.sent(),[2,a];case 3:return this.options.delete(t.id),this.runningTasks.delete(t.id),this.events.finished.next({id:n}),this.abortRequests.delete(t.id),i.refCount--,i.refCount===0&&Ub(this.currentContext,i),[7];case 4:return[2]}})})},e.prototype.requestAbortAll=function(t){var r=this;this.runningTasks.forEach(function(n){return r.abortRequests.set(n,t)})},e.prototype.requestAbort=function(t,r){var n=typeof t=="number"?t:t.root.progress.taskId;this.abortRequests.set(n,r)},e.prototype.dispose=function(){this.ev.dispose()},e}();(function(e){function t(n){return new Promise(function(i){return setTimeout(i,n)})}function r(n){var i=this;return $e.create("Test",function(a){return ce(i,void 0,void 0,function(){var o;return de(this,function(s){switch(s.label){case 0:o=0,s.label=1;case 1:return o<n?[4,t(100+Math.random()*200)]:[3,5];case 2:return s.sent(),a.shouldUpdate?[4,a.update({message:"Step "+o,current:o,max:n,isIndeterminate:!1})]:[3,4];case 3:s.sent(),s.label=4;case 4:return o++,[3,1];case 5:return[2]}})})})}e.testTask=r})(uk||(uk={}));var Kpt=function(e){Le(t,e);function t(r){var n=e.call(this,{entries:ci.OrderedMap()})||this;return n.events={changed:n.ev()},n.serialNumber=0,n.serialId=0,_t.Toast.Show.subscribe(r,function(i){return n.show(i)}),_t.Toast.Hide.subscribe(r,function(i){return n.hide(n.findByKey(i.key))}),n}return t.prototype.findByKey=function(r){return this.state.entries.find(function(n){return!!n&&n.key===r})},t.prototype.show=function(r){var n=this,i=this.state.entries,a=void 0,o=++this.serialId,s;r.key&&(a=this.findByKey(r.key))?(a.timeout!==void 0&&clearTimeout(a.timeout),s=a.serialNumber,i=i.remove(a.id)):s=++this.serialNumber,a={id:o,serialNumber:s,key:r.key,title:r.title,message:r.message,timeout:this.timeout(o,r.timeoutMs),hide:function(){return n.hideId(o)}},this.updateState({entries:i.set(o,a)})&&this.events.changed.next()},t.prototype.timeout=function(r,n){var i=this;if(n!==void 0)return n<0&&(n=500),setTimeout(function(){var a=i.state.entries.get(r);a.timeout=void 0,i.hide(a)},n)},t.prototype.hideId=function(r){this.hide(this.state.entries.get(r))},t.prototype.hide=function(r){r&&(r.timeout!==void 0&&clearTimeout(r.timeout),r.hide=void 0,this.updateState({entries:this.state.entries.delete(r.id)})&&this.events.changed.next())},t}(Wd),Qpt=function(e){Le(t,e);function t(r){var n=e.call(this)||this;return n.plugin=r,n._params=void 0,n.behaviors={values:n.ev.behavior({transparent:n.params.transparent.defaultValue,axes:{name:"off",params:{}},resolution:n.params.resolution.defaultValue}),cropParams:n.ev.behavior({auto:!0,relativePadding:.1}),relativeCrop:n.ev.behavior({x:0,y:0,width:1,height:1})},n.events={previewed:n.ev()},n.canvas=function(){var i=document.createElement("canvas");return i}(),n.previewCanvas=function(){var i=document.createElement("canvas");return i}(),n.previewData={image:{data:new Uint8ClampedArray(1),width:1,height:0},background:at(0),transparent:!1},n}return t.prototype.createParams=function(){var r=Math.min(this.plugin.canvas3d?this.plugin.canvas3d.webgl.maxRenderbufferSize:4096,4096);return{resolution:I.MappedStatic("viewport",{viewport:I.Group({}),hd:I.Group({}),"full-hd":I.Group({}),"ultra-hd":I.Group({}),custom:I.Group({width:I.Numeric(1920,{min:128,max:r,step:1}),height:I.Numeric(1080,{min:128,max:r,step:1})},{isFlat:!0})},{options:[["viewport","Viewport"],["hd","HD (1280 x 720)"],["full-hd","Full HD (1920 x 1080)"],["ultra-hd","Ultra HD (3840 x 2160)"],["custom","Custom"]]}),transparent:I.Boolean(!1),axes:EA.axes}},Object.defineProperty(t.prototype,"params",{get:function(){return this._params?this._params:this._params=this.createParams()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"values",{get:function(){return this.behaviors.values.value},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cropParams",{get:function(){return this.behaviors.cropParams.value},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"relativeCrop",{get:function(){return this.behaviors.relativeCrop.value},enumerable:!1,configurable:!0}),t.prototype.getCanvasSize=function(){var r,n;return{width:((r=this.plugin.canvas3d)===null||r===void 0?void 0:r.webgl.gl.drawingBufferWidth)||0,height:((n=this.plugin.canvas3d)===null||n===void 0?void 0:n.webgl.gl.drawingBufferHeight)||0}},t.prototype.getSize=function(){var r=this.values;switch(r.resolution.name){case"viewport":return this.getCanvasSize();case"hd":return{width:1280,height:720};case"full-hd":return{width:1920,height:1080};case"ultra-hd":return{width:3840,height:2160};default:return{width:r.resolution.params.width,height:r.resolution.params.height}}},t.prototype.createPass=function(r){var n=this.plugin.canvas3d,i=n.webgl.extensions,a=i.colorBufferFloat,o=i.textureFloat,s=this.plugin.canvas3d.props.postprocessing.occlusion;return this.plugin.canvas3d.getImagePass({transparentBackground:this.values.transparent,cameraHelper:{axes:this.values.axes},multiSample:{mode:r?"on":"off",sampleLevel:a&&o?4:2},postprocessing:E(E({},n.props.postprocessing),{occlusion:s.name==="on"?{name:"on",params:E(E({},s.params),{samples:128})}:s})})},Object.defineProperty(t.prototype,"previewPass",{get:function(){return this._previewPass||(this._previewPass=this.createPass(!1))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"imagePass",{get:function(){if(this._imagePass){var r=this.plugin.canvas3d.props.postprocessing.occlusion;return this._imagePass.setProps({cameraHelper:{axes:this.values.axes},transparentBackground:this.values.transparent,postprocessing:E(E({},this.plugin.canvas3d.props.postprocessing),{occlusion:r.name==="on"?{name:"on",params:E(E({},r.params),{samples:128})}:r})}),this._imagePass}return this._imagePass=this.createPass(!0)},enumerable:!1,configurable:!0}),t.prototype.getFilename=function(r){r===void 0&&(r=".png");var n=this.plugin.state.data.select(or.Generators.rootsOfType(ge.Molecule.Model)).map(function(o){return o.obj.data}),i=new Set;n.forEach(function(o){return i.add(o.entryId.toUpperCase())});var a=gi.toArray(i).join("-");return""+(a||"molstar-image")+r},t.prototype.resetCrop=function(){this.behaviors.relativeCrop.next({x:0,y:0,width:1,height:1})},t.prototype.toggleAutocrop=function(){this.cropParams.auto?(this.behaviors.cropParams.next(E(E({},this.cropParams),{auto:!1})),this.resetCrop()):this.behaviors.cropParams.next(E(E({},this.cropParams),{auto:!0}))},Object.defineProperty(t.prototype,"isFullFrame",{get:function(){var r=this.relativeCrop;return Sn(r.x,0,1e-5)&&Sn(r.y,0,1e-5)&&Sn(r.width,1,1e-5)&&Sn(r.height,1,1e-5)},enumerable:!1,configurable:!0}),t.prototype.autocrop=function(r){r===void 0&&(r=this.cropParams.relativePadding);for(var n=this.previewData.image,i=n.data,a=n.width,o=n.height,s=this.previewData.transparent,u=s?this.previewData.background:4278190080|this.previewData.background,l=a,c=0,d=o,f=0,h=0;h<o;h++)for(var v=h*a,p=0;p<a;p++){var m=4*(v+p);if(s){if(i[m+3]===0)continue}else{var g=i[m]<<16|i[m+1]<<8|i[m+2]|i[m+3]<<24;if(g===u)continue}p<l&&(l=p),p>c&&(c=p),h<d&&(d=h),h>f&&(f=h)}if(l>c){var y=l;l=c,c=y}if(d>f){var y=d;d=f,f=y}var b=c-l+1,S=f-d+1;l-=r*b,c+=r*b,d-=r*S,f+=r*S;var x={x:Math.max(0,l/a),y:Math.max(0,d/o),width:Math.min(1,(c-l+1)/a),height:Math.min(1,(f-d+1)/o)};this.behaviors.relativeCrop.next(x)},t.prototype.getPreview=function(r){r===void 0&&(r=320);var n=this.getSize(),i=n.width,a=n.height;if(!(i<=0||a<=0)){var o=i/a,s=0,u=0;o>1?(s=r,u=Math.round(r/o)):(u=r,s=Math.round(r*o));var l=this.plugin.canvas3d.props;this.previewPass.setProps({cameraHelper:{axes:this.values.axes},transparentBackground:this.values.transparent,postprocessing:l.postprocessing});var c=this.previewPass.getImageData(s,u),d=this.previewCanvas;d.width=c.width,d.height=c.height,this.previewData.image=c,this.previewData.background=l.renderer.backgroundColor,this.previewData.transparent=this.values.transparent;var f=d.getContext("2d");if(!f)throw new Error("Could not create canvas 2d context");return f.putImageData(c,0,0),this.cropParams.auto&&this.autocrop(),this.events.previewed.next(),{canvas:d,width:s,height:u}}},t.prototype.getSizeAndViewport=function(){var r=this.getSize(),n=r.width,i=r.height,a=this.relativeCrop,o={x:Math.floor(a.x*n),y:Math.floor(a.y*i),width:Math.ceil(a.width*n),height:Math.ceil(a.height*i)};return o.width+o.x>n&&(o.width=n-o.x),o.height+o.y>i&&(o.height=i-o.y),{width:n,height:i,viewport:o}},t.prototype.draw=function(r){return ce(this,void 0,void 0,function(){var n,i,a,o,s,u,l;return de(this,function(c){switch(c.label){case 0:return n=this.getSizeAndViewport(),i=n.width,a=n.height,o=n.viewport,i<=0||a<=0?[2]:[4,r.update("Rendering image...")];case 1:return c.sent(),s=this.imagePass.getImageData(i,a,o),[4,r.update("Encoding image...")];case 2:if(c.sent(),u=this.canvas,u.width=s.width,u.height=s.height,l=u.getContext("2d"),!l)throw new Error("Could not create canvas 2d context");return l.putImageData(s,0,0),[2]}})})},t.prototype.copyToClipboardTask=function(){var r=this,n=navigator.clipboard;if(!(n!=null&&n.write)){this.plugin.log.error("clipboard.write not supported!");return}return $e.create("Copy Image",function(i){return ce(r,void 0,void 0,function(){var a,o;return de(this,function(s){switch(s.label){case 0:return[4,this.draw(i)];case 1:return s.sent(),[4,i.update("Converting image...")];case 2:return s.sent(),[4,TG(this.canvas,"png")];case 3:return a=s.sent(),o=new ClipboardItem({"image/png":a}),[4,n.write([o])];case 4:return s.sent(),this.plugin.log.message("Image copied to clipboard."),[2]}})})})},t.prototype.getImageDataUri=function(){var r=this;return this.plugin.runTask($e.create("Generate Image",function(n){return ce(r,void 0,void 0,function(){return de(this,function(i){switch(i.label){case 0:return[4,this.draw(n)];case 1:return i.sent(),[4,n.update("Converting image...")];case 2:return i.sent(),[2,this.canvas.toDataURL("png")]}})})}))},t.prototype.copyToClipboard=function(){var r=this.copyToClipboardTask();if(r)return this.plugin.runTask(r)},t.prototype.downloadTask=function(r){var n=this;return $e.create("Download Image",function(i){return ce(n,void 0,void 0,function(){var a;return de(this,function(o){switch(o.label){case 0:return[4,this.draw(i)];case 1:return o.sent(),[4,i.update("Downloading image...")];case 2:return o.sent(),[4,TG(this.canvas,"png")];case 3:return a=o.sent(),zne(a,r??this.getFilename()),[2]}})})})},t.prototype.download=function(r){this.plugin.runTask(this.downloadTask(r))},t}(N2),Zpt=function(){function e(t){var r=this;this.spec=t,this.runTask=function(n,i){return r.managers.task.run(n,i)},this.resolveTask=function(n){if(n)return $e.is(n)?r.runTask(n):n},this.subs=[],this.disposed=!1,this.ev=hd.create(),this.config=new fZe(this.spec.config),this.state=new o3(this),this.commands=new xtt,this.canvas3dInit=this.ev.behavior(!1),this.behaviors={state:{isAnimating:this.ev.behavior(!1),isUpdating:this.ev.behavior(!1),isBusy:this.ev.behavior(!1)},interaction:{hover:this.ev.behavior({current:ur.Loci.Empty,modifiers:Uu.None,buttons:0,button:0}),click:this.ev.behavior({current:ur.Loci.Empty,modifiers:Uu.None,buttons:0,button:0}),drag:this.ev.behavior({current:ur.Loci.Empty,modifiers:Uu.None,buttons:0,button:0,pageStart:He(),pageEnd:He()}),selectionMode:this.ev.behavior(!1)},labels:{highlight:this.ev.behavior({labels:[]})},layout:{leftPanelTabName:this.ev.behavior("root")},canvas3d:{initialized:this.canvas3dInit.pipe(zE(function(n){return!!n}),Hut(1))}},this.layout=new bct(this),this.animationLoop=new Xpt(this),this.representation={structure:{registry:new sk,themes:{colorThemeRegistry:yd.createRegistry(),sizeThemeRegistry:Ji.createRegistry()}},volume:{registry:new i3,themes:{colorThemeRegistry:yd.createRegistry(),sizeThemeRegistry:Ji.createRegistry()}}},this.query={structure:{registry:new cZe}},this.dataFormats=new act,this.builders={data:new Flt(this),structure:void 0},this.helpers={substructureParent:new Ypt(this),viewportScreenshot:void 0},this.managers={structure:{hierarchy:new i2(this),component:new Vv(this),measurement:new Kat(this),selection:new hct(this),focus:new dct(this)},volume:{hierarchy:new Jw(this)},interactivity:void 0,camera:new uct(this),animation:new oct(this),snapshot:new Ww(this),lociLabels:void 0,toast:new Kpt(this),asset:new Dke,task:new uk},this.events={log:this.ev(),task:this.managers.task.events,canvas3d:{settingsUpdated:this.ev()}},this.customModelProperties=new s3.Registry,this.customStructureProperties=new s3.Registry,this.customStructureControls=new Map,this.genericRepresentationControls=new Map,this.customState=Object.create(null),this.log={entries:ci.List(),entry:function(n){return r.events.log.next(n)},error:function(n){return r.events.log.next(Nl.error(n))},message:function(n){return r.events.log.next(Nl.message(n))},info:function(n){return r.events.log.next(Nl.info(n))},warn:function(n){return r.events.log.next(Nl.warning(n))}},this.fetch=hD,UOe(!1)}return e.prototype.build=function(){return this.state.data.build()},e.prototype.initViewer=function(t,r,n){var i=this,a,o,s,u,l;try{if(this.layout.setRoot(r),this.spec.layout&&this.spec.layout.initial&&this.layout.setProps(this.spec.layout.initial),n)this.canvas3dContext=n;else{var c=!((a=this.config.get(Zr.General.DisableAntialiasing))!==null&&a!==void 0&&a),d=!((o=this.config.get(Zr.General.DisablePreserveDrawingBuffer))!==null&&o!==void 0&&o),f=this.config.get(Zr.General.PixelScale)||1,h=this.config.get(Zr.General.PickScale)||.25,v=this.config.get(Zr.General.EnableWboit)||!1;this.canvas3dContext=VR.fromCanvas(t,{antialias:c,preserveDrawingBuffer:d,pixelScale:f,pickScale:h,enableWboit:v})}this.canvas3d=HR.create(this.canvas3dContext),this.canvas3dInit.next(!0);var p=this.spec.canvas3d,m=at(16579577);return p?(((u=p.renderer)===null||u===void 0?void 0:u.backgroundColor)===void 0&&(p=z6(p,function(g){g.renderer?g.renderer.backgroundColor=m:g.renderer={backgroundColor:m}})),(l=this.canvas3d)===null||l===void 0||l.setProps(p)):(s=this.canvas3d)===null||s===void 0||s.setProps({renderer:{backgroundColor:m}}),this.animationLoop.start(),this.helpers.viewportScreenshot=new Qpt(this),this.subs.push(this.canvas3d.interaction.click.subscribe(function(g){return i.behaviors.interaction.click.next(g)})),this.subs.push(this.canvas3d.interaction.drag.subscribe(function(g){return i.behaviors.interaction.drag.next(g)})),this.subs.push(this.canvas3d.interaction.hover.subscribe(function(g){return i.behaviors.interaction.hover.next(g)})),this.subs.push(this.canvas3d.input.resize.subscribe(function(){return i.handleResize()})),this.subs.push(this.layout.events.updated.subscribe(function(){return requestAnimationFrame(function(){return i.handleResize()})})),this.handleResize(),!0}catch(g){return this.log.error(""+g),console.error(g),!1}},e.prototype.handleResize=function(){var t,r,n=(t=this.canvas3dContext)===null||t===void 0?void 0:t.canvas,i=this.layout.root;if(i&&n){var a=this.config.get(Zr.General.PixelScale)||1;Dlt(n,i,a),(r=this.canvas3d)===null||r===void 0||r.requestResize()}},Object.defineProperty(e.prototype,"isBusy",{get:function(){return this.behaviors.state.isAnimating.value||this.behaviors.state.isUpdating.value},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"selectionMode",{get:function(){return this.behaviors.interaction.selectionMode.value},set:function(t){this.behaviors.interaction.selectionMode.next(t)},enumerable:!1,configurable:!0}),e.prototype.dataTransaction=function(t,r){return this.runTask(this.state.data.transaction(t,r))},e.prototype.clear=function(t){var r;return t===void 0&&(t=!1),t&&((r=this.canvas3d)===null||r===void 0||r.setProps(VF)),_t.State.RemoveObject(this,{state:this.state.data,ref:fr.RootRef})},e.prototype.dispose=function(t){var r,n;if(!this.disposed){for(var i=0,a=this.subs;i<a.length;i++){var o=a[i];o.unsubscribe()}this.subs=[],this.commands.dispose(),(r=this.canvas3d)===null||r===void 0||r.dispose(),(n=this.canvas3dContext)===null||n===void 0||n.dispose(t),this.ev.dispose(),this.state.dispose(),this.managers.task.dispose(),this.helpers.substructureParent.dispose(),$u(this.managers,function(s){var u,l;return(l=(u=s)===null||u===void 0?void 0:u.dispose)===null||l===void 0?void 0:l.call(u)}),$u(this.managers.structure,function(s){var u,l;return(l=(u=s)===null||u===void 0?void 0:u.dispose)===null||l===void 0?void 0:l.call(u)}),this.disposed=!0}},e.prototype.initBehaviorEvents=function(){var t=this;this.subs.push(Dc(this.state.data.behaviors.isUpdating,this.state.behaviors.behaviors.isUpdating).subscribe(function(s){t.behaviors.state.isUpdating.value!==s&&t.behaviors.state.isUpdating.next(s)}));var r=this.config.get(Zr.General.IsBusyTimeoutMs)||750,n=this.behaviors.state.isBusy,i=void 0,a=function(){n.value||n.next(!0)},o=function(){i!==void 0&&clearTimeout(i),i=void 0};this.subs.push(Dc(this.behaviors.state.isUpdating,this.behaviors.state.isAnimating).subscribe(function(s){var u=t.behaviors.state.isUpdating.value,l=t.behaviors.state.isAnimating.value;u||l?n.value||(o(),i=setTimeout(a,r)):(o(),n.next(!1))})),this.subs.push(this.behaviors.interaction.selectionMode.subscribe(function(s){var u;s||(u=t.managers.interactivity)===null||u===void 0||u.lociSelects.deselectAll()}))},e.prototype.initBuiltInBehavior=function(){var t=this;yS.State.registerDefault(this),yS.Representation.registerDefault(this),yS.Camera.registerDefault(this),yS.Misc.registerDefault(this),this.subs.push(Dc(this.state.data.events.log,this.state.behaviors.events.log).subscribe(function(r){return t.events.log.next(r)}))},e.prototype.initBehaviors=function(){return ce(this,void 0,void 0,function(){var t,r,n,l,i,a,u,l,o,s,u,l;return de(this,function(c){switch(c.label){case 0:for(t=this.state.behaviors.build(),r=0,n=Object.keys(Nr.Categories);r<n.length;r++)l=n[r],t.toRoot().apply(Nr.CreateCategory,{label:Nr.Categories[l]},{ref:l,state:{isLocked:!0}});for(i=0,a=this.spec.behaviors;i<a.length;i++)u=a[i],l=Nr.getCategoryId(u.transformer),l==="custom-props"&&t.to(Nr.getCategoryId(u.transformer)).apply(u.transformer,u.defaultParams,{ref:u.transformer.id});return[4,this.runTask(this.state.behaviors.updateTree(t,{doNotUpdateCurrent:!0,doNotLogTiming:!0}))];case 1:for(c.sent(),t=this.state.behaviors.build(),o=0,s=this.spec.behaviors;o<s.length;o++)u=s[o],l=Nr.getCategoryId(u.transformer),l!=="custom-props"&&t.to(Nr.getCategoryId(u.transformer)).apply(u.transformer,u.defaultParams,{ref:u.transformer.id});return[4,this.runTask(this.state.behaviors.updateTree(t,{doNotUpdateCurrent:!0,doNotLogTiming:!0}))];case 2:return c.sent(),[2]}})})},e.prototype.initCustomFormats=function(){if(this.spec.customFormats)for(var t=0,r=this.spec.customFormats;t<r.length;t++){var n=r[t];this.dataFormats.add(n[0],n[1])}},e.prototype.initAnimations=function(){if(this.spec.animations)for(var t=0,r=this.spec.animations;t<r.length;t++){var n=r[t];this.managers.animation.register(n)}},e.prototype.initDataActions=function(){if(this.spec.actions)for(var t=0,r=this.spec.actions;t<r.length;t++){var n=r[t];this.state.data.actions.add(n.action)}},e.prototype.init=function(){return ce(this,void 0,void 0,function(){var t=this;return de(this,function(r){switch(r.label){case 0:return this.subs.push(this.events.log.subscribe(function(n){return t.log.entries=t.log.entries.push(n)})),this.initCustomFormats(),this.initBehaviorEvents(),this.initBuiltInBehavior(),this.managers.interactivity=new Qw(this),this.managers.lociLabels=new lct(this),this.builders.structure=new qlt(this),this.initAnimations(),this.initDataActions(),[4,this.initBehaviors()];case 1:return r.sent(),this.log.message("Mol* Plugin "+kR+" ["+mtt.toLocaleString()+"]"),j0||this.log.message("Development mode enabled"),Lr&&this.log.message("Debug mode enabled"),[2]}})})},e}(),Jpt=function(e){Le(t,e);function t(r){var n=e.call(this,r)||this;return n.spec=r,n.customParamEditors=new Map,n.initCustomParamEditors(),n}return t.prototype.initCustomParamEditors=function(){if(this.spec.customParamEditors)for(var r=0,n=this.spec.customParamEditors;r<n.length;r++){var i=n[r],a=i[0],o=i[1];this.customParamEditors.set(a.id,o)}},t.prototype.dispose=function(r){e.prototype.dispose.call(this,r),this.layout.dispose()},t}(Zpt),Bh;(function(e){function t(n){return n}e.create=t;function r(n,i){var a,o;if(i.customDurationMs)return i.customDurationMs;var s=(o=(a=i.definition).getDuration)===null||o===void 0?void 0:o.call(a,i.params,n);if((s==null?void 0:s.kind)==="fixed")return s.durationMs}e.getDuration=r})(Bh||(Bh={}));var evt=Bh.create({name:"built-in.animate-assembly-unwind",display:{name:"Unwind Assembly"},isExportable:!0,params:function(e){for(var t=[["all","All"]],r=e.state.data.select(or.Generators.rootsOfType(ge.Molecule.Structure)),n=0,i=r;n<i.length;n++){var a=i[n];t.push([a.transform.ref,a.obj.data.models[0].label])}return{durationInMs:I.Numeric(3e3,{min:100,max:1e4,step:100}),playOnce:I.Boolean(!1),target:I.Select(t[0][0],t)}},canApply:function(e){var t=e.state.data,r=fr.RootRef,n=t.select(or.Generators.ofType(ge.Molecule.Structure.Representation3D,r));return{canApply:n.length>0}},getDuration:function(e){return{kind:"fixed",durationMs:e.durationInMs}},initialState:function(){return{t:0}},setup:function(e,t,r){for(var n=r.state.data,i=!e.target||e.target==="all"?fr.RootRef:e.target,a=n.select(or.Generators.ofType(ge.Molecule.Structure.Representation3D,i)),o=n.build(),s=!1,u=0,l=a;u<l.length;u++){var c=l[u],d=n.select(or.Generators.ofTransformer(rt.Representation.UnwindStructureAssemblyRepresentation3D,c.transform.ref));d.length>0||(s=!0,o.to(c).apply(rt.Representation.UnwindStructureAssemblyRepresentation3D,{t:0},{tags:"animate-assembly-unwind"}))}if(s)return o.commit({doNotUpdateCurrent:!0})},teardown:function(e,t,r){var n=r.state.data,i=n.select(or.Generators.ofType(ge.Molecule.Structure.Representation3DState).withTag("animate-assembly-unwind"));if(i.length!==0){for(var a=n.build(),o=0,s=i;o<s.length;o++){var u=s[o];a.delete(u.transform.ref)}return a.commit()}},apply:function(e,t,r){return ce(this,void 0,void 0,function(){var n,i,a,o,s,u,l,c,d,f;return de(this,function(h){switch(h.label){case 0:if(n=r.plugin.state.data,i=!r.params.target||r.params.target==="all"?fr.RootRef:r.params.target,a=n.select(or.Generators.ofTransformer(rt.Representation.UnwindStructureAssemblyRepresentation3D,i)),a.length===0)return[2,{kind:"finished"}];for(o=n.build(),s=(t.current-t.lastApplied)/r.params.durationInMs,u=e.t+s,l=!1,r.params.playOnce&&u>=1?(l=!0,u=1):u=u%1,c=0,d=a;c<d.length;c++)f=d[c],o.to(f).update({t:u});return[4,_t.State.Update(r.plugin,{state:n,tree:o,options:{doNotLogTiming:!0}})];case 1:return h.sent(),l?[2,{kind:"finished"}]:[2,{kind:"next",state:{t:u}}]}})})}}),jS=_(),dq=_(),fq=Xn(),tvt=Bh.create({name:"built-in.animate-camera-spin",display:{name:"Camera Spin"},isExportable:!0,params:function(){return{durationInMs:I.Numeric(4e3,{min:100,max:2e4,step:100}),speed:I.Numeric(1,{min:1,max:10,step:1},{description:"How many times to spin in the specified dutation."}),direction:I.Select("cw",[["cw","Clockwise"],["ccw","Counter Clockwise"]],{cycle:!0})}},initialState:function(e,t){var r;return{snapshot:(r=t.canvas3d)===null||r===void 0?void 0:r.camera.getSnapshot()}},getDuration:function(e){return{kind:"fixed",durationMs:e.durationInMs}},teardown:function(e,t,r){var n;(n=r.canvas3d)===null||n===void 0||n.requestCameraReset({snapshot:t.snapshot,durationMs:0})},apply:function(e,t,r){var n,i;return ce(this,void 0,void 0,function(){var a,o,s,u;return de(this,function(l){return t.current===0?[2,{kind:"next",state:e}]:(a=e.snapshot,a.radiusMax<1e-4?[2,{kind:"finished"}]:(o=Va(t.current/r.params.durationInMs,0,1),o>=.99999?((n=r.plugin.canvas3d)===null||n===void 0||n.requestCameraReset({snapshot:a,durationMs:0}),[2,{kind:"finished"}]):(s=2*Math.PI*o*r.params.speed*(r.params.direction==="ccw"?-1:1),_.sub(jS,a.position,a.target),_.normalize(dq,a.up),Xn.setAxisAngle(fq,dq,s),_.transformQuat(jS,jS,fq),u=_.add(_(),a.target,jS),(i=r.plugin.canvas3d)===null||i===void 0||i.requestCameraReset({snapshot:E(E({},a),{position:u}),durationMs:0}),[2,{kind:"next",state:e}])))})})}}),rvt=Bh.create({name:"built-in.animate-model-index",display:{name:"Animate Trajectory"},isExportable:!0,params:function(){return{mode:I.MappedStatic("loop",{palindrome:I.Group({}),loop:I.Group({direction:I.Select("forward",[["forward","Forward"],["backward","Backward"]])}),once:I.Group({direction:I.Select("forward",[["forward","Forward"],["backward","Backward"]])},{isFlat:!0})},{options:[["palindrome","Palindrome"],["loop","Loop"],["once","Once"]]}),duration:I.MappedStatic("fixed",{fixed:I.Group({durationInS:I.Numeric(5,{min:1,max:120,step:.1},{description:"Duration in seconds"})},{isFlat:!0}),computed:I.Group({targetFps:I.Numeric(30,{min:5,max:250,step:1},{label:"Target FPS"})},{isFlat:!0}),sequential:I.Group({maxFps:I.Numeric(30,{min:5,max:60,step:1})},{isFlat:!0})})}},canApply:function(e){for(var t=e.state.data,r=t.select(or.Generators.ofTransformer(rt.Model.ModelFromTrajectory)),n=0,i=r;n<i.length;n++){var a=i[n],o=or.findAncestorOfType(t.tree,t.cells,a.transform.ref,ge.Molecule.Trajectory);if(o&&o.obj&&o.obj.data.frameCount>1)return{canApply:!0}}return{canApply:!1,reason:"No trajectory to animate"}},getDuration:function(e,t){var r;if(((r=e.duration)===null||r===void 0?void 0:r.name)==="fixed")return{kind:"fixed",durationMs:e.duration.params.durationInS*1e3};if(e.duration.name==="computed"){for(var n=t.state.data,i=n.select(or.Generators.ofTransformer(rt.Model.ModelFromTrajectory)),a=0,o=0,s=i;o<s.length;o++){var u=s[o],l=or.findAncestorOfType(n.tree,n.cells,u.transform.ref,ge.Molecule.Trajectory);if(!(!l||!l.obj)){var c=l.obj;a=Math.max(Math.ceil(1e3*c.data.frameCount/e.duration.params.targetFps),a)}}return{kind:"fixed",durationMs:a}}return{kind:"unknown"}},initialState:function(){return{}},apply:function(e,t,r){return ce(this,void 0,void 0,function(){var n,i,a,o,s,u,l,c,d,f,h;return de(this,function(v){switch(v.label){case 0:if(r.params.duration.name==="sequential"&&t.current>0&&t.current-t.lastApplied<1e3/r.params.duration.params.maxFps)return[2,{kind:"skip"}];if(n=r.plugin.state.data,i=n.select(or.Generators.ofTransformer(rt.Model.ModelFromTrajectory)),i.length===0)return[2,{kind:"finished"}];for(a=n.build(),o=r.params,s=e.palindromeDirections||{},u=!1,l=!0,c=function(p){var m=or.findAncestorOfType(n.tree,n.cells,p.transform.ref,ge.Molecule.Trajectory);if(!m||!m.obj)return"continue";var g=m.obj;if(g.data.frameCount<=1)return"continue";a.to(p).update(function(y){var b=g.data.frameCount;if(b!==1)l=!1;else return y;if(o.duration.name==="sequential"){var S=1;if(o.mode.name==="once"){if(S=o.mode.params.direction==="backward"?-1:1,S===-1&&y.modelIndex===0||S===1&&y.modelIndex===b-1)return u=!0,y}else o.mode.name==="palindrome"&&(y.modelIndex===0?S=1:y.modelIndex===b-1?S=-1:S=s[p.transform.ref]||1);s[p.transform.ref]=S;var x=(y.modelIndex+S)%b;return x<0&&(x+=b),u=u||S===-1&&x===0||S===1&&x===b-1,{modelIndex:x}}else{var C=o.duration.name==="fixed"?o.duration.params.durationInS*1e3:Math.ceil(1e3*g.data.frameCount/o.duration.params.targetFps),w=t.current%C/C;o.mode.name==="loop"&&o.mode.params.direction==="backward"&&(w=1-w),o.mode.name==="palindrome"&&(w=2*w,w>1&&(w=2-w));var x=Math.min(Math.floor(g.data.frameCount*w),g.data.frameCount-1);return u=u||x===g.data.frameCount-1,{modelIndex:x}}})},d=0,f=i;d<f.length;d++)h=f[d],c(h);return l?[3,2]:[4,_t.State.Update(r.plugin,{state:n,tree:a,options:{doNotLogTiming:!0}})];case 1:v.sent(),v.label=2;case 2:return l||o.mode.name==="once"&&u?[2,{kind:"finished"}]:o.mode.name==="palindrome"?[2,{kind:"next",state:{palindromeDirections:s}}]:[2,{kind:"next",state:{}}]}})})}});function hq(e,t,r){var n;return r===void 0&&(r=!1),ce(this,void 0,void 0,function(){return de(this,function(i){switch(i.label){case 0:return t.snapshot.data?[4,e.runTask(e.state.data.setSnapshot(t.snapshot.data))]:[3,2];case 1:i.sent(),i.label=2;case 2:return t.snapshot.camera&&((n=e.canvas3d)===null||n===void 0||n.requestCameraReset({snapshot:t.snapshot.camera.current,durationMs:r||t.snapshot.camera.transitionStyle==="instant"?0:t.snapshot.camera.transitionDurationInMs})),[2]}})})}var nvt=Bh.create({name:"built-in.animate-state-snapshots",display:{name:"State Snapshots"},isExportable:!0,params:function(){return{}},canApply:function(e){var t=e.managers.snapshot.state.entries;return t.size<2?{canApply:!1,reason:"At least 2 states required."}:t.some(function(r){return!!(r!=null&&r.snapshot.startAnimation)})?{canApply:!1,reason:"Nested animations not supported."}:{canApply:e.managers.snapshot.state.entries.size>1}},setup:function(e,t,r){var n=r.managers.snapshot.state.entries.get(0);hq(r,n,!0)},getDuration:function(e,t){return{kind:"fixed",durationMs:t.managers.snapshot.state.entries.toArray().reduce(function(r,n){var i;return r+((i=n.snapshot.durationInMs)!==null&&i!==void 0?i:0)},0)}},initialState:function(e,t){var r=t.managers.snapshot.state.entries.toArray();return{totalDuration:r.reduce(function(n,i){var a;return n+((a=i.snapshot.durationInMs)!==null&&a!==void 0?a:0)},0),snapshots:r,currentIndex:0}},apply:function(e,t,r){var n;return ce(this,void 0,void 0,function(){var i,a,o,s,u;return de(this,function(l){if(t.current>=e.totalDuration)return[2,{kind:"finished"}];for(i=0,a=0,o=0,s=e.snapshots;o<s.length&&(u=s[o],i+=(n=u.snapshot.durationInMs)!==null&&n!==void 0?n:0,!(t.current<i));o++)a++;return a>=e.snapshots.length?[2,{kind:"finished"}]:a===e.currentIndex?[2,{kind:"skip"}]:(hq(r.plugin,e.snapshots[a]),[2,{kind:"next",state:E(E({},e),{currentIndex:a})}])})})}}),ivt=Ro.build({from:ge.Root,display:{name:"Download Density",description:"Load a density from the provided source and create its default visual."},params:function(e,t){var r=t.dataFormats.options;return{source:I.MappedStatic("pdb-xray",{"pdb-xray":I.Group({provider:I.Group({id:I.Text("1tqn",{label:"Id"}),server:I.Select("rcsb",[["pdbe","PDBe"],["rcsb","RCSB PDB"]])},{pivot:"id"}),type:I.Select("2fofc",[["2fofc","2Fo-Fc"],["fofc","Fo-Fc"]])},{isFlat:!0}),"pdb-xray-ds":I.Group({provider:I.Group({id:I.Text("1tqn",{label:"Id"}),server:I.Select("pdbe",[["pdbe","PDBe"],["rcsb","RCSB PDB"]])},{pivot:"id"}),detail:I.Numeric(3,{min:0,max:6,step:1},{label:"Detail"})},{isFlat:!0}),"pdb-emd-ds":I.Group({provider:I.Group({id:I.Text("emd-8004",{label:"Id"}),server:I.Select("pdbe",[["pdbe","PDBe"],["rcsb","RCSB PDB"]])},{pivot:"id"}),detail:I.Numeric(3,{min:0,max:6,step:1},{label:"Detail"})},{isFlat:!0}),url:I.Group({url:I.Url(""),isBinary:I.Boolean(!1),format:I.Select("auto",r)},{isFlat:!0})},{options:[["pdb-xray","PDB X-ray maps"],["pdb-emd-ds","PDB EMD Density Server"],["pdb-xray-ds","PDB X-ray Density Server"],["url","URL"]]})}}})(function(e,t){var r=e.params;return $e.create("Download Density",function(n){return ce(void 0,void 0,void 0,function(){var i,a,o,s,u,l,c,d;return de(this,function(f){switch(f.label){case 0:switch(i=r.source,i.name){case"url":a=i.params;break;case"pdb-xray":a=i.params.provider.server==="pdbe"?{url:Mn.Url(i.params.type==="2fofc"?"http://www.ebi.ac.uk/pdbe/coordinates/files/"+i.params.provider.id.toLowerCase()+".ccp4":"http://www.ebi.ac.uk/pdbe/coordinates/files/"+i.params.provider.id.toLowerCase()+"_diff.ccp4"),isBinary:!0,label:"PDBe X-ray map: "+i.params.provider.id}:{url:Mn.Url(i.params.type==="2fofc"?"https://edmaps.rcsb.org/maps/"+i.params.provider.id.toLowerCase()+"_2fofc.dsn6":"https://edmaps.rcsb.org/maps/"+i.params.provider.id.toLowerCase()+"_fofc.dsn6"),isBinary:!0,label:"RCSB X-ray map: "+i.params.provider.id};break;case"pdb-emd-ds":a=i.params.provider.server==="pdbe"?{url:Mn.Url("https://www.ebi.ac.uk/pdbe/densities/emd/"+i.params.provider.id.toLowerCase()+"/cell?detail="+i.params.detail),isBinary:!0,label:"PDBe EMD Density Server: "+i.params.provider.id}:{url:Mn.Url("https://maps.rcsb.org/em/"+i.params.provider.id.toLowerCase()+"/cell?detail="+i.params.detail),isBinary:!0,label:"RCSB PDB EMD Density Server: "+i.params.provider.id};break;case"pdb-xray-ds":a=i.params.provider.server==="pdbe"?{url:Mn.Url("https://www.ebi.ac.uk/pdbe/densities/x-ray/"+i.params.provider.id.toLowerCase()+"/cell?detail="+i.params.detail),isBinary:!0,label:"PDBe X-ray Density Server: "+i.params.provider.id}:{url:Mn.Url("https://maps.rcsb.org/x-ray/"+i.params.provider.id.toLowerCase()+"/cell?detail="+i.params.detail),isBinary:!0,label:"RCSB PDB X-ray Density Server: "+i.params.provider.id};break;default:throw new Error(i.name+" not supported.")}return[4,t.builders.data.download(a)];case 1:switch(s=f.sent(),u=void 0,i.name){case"url":a=i.params,o=i.params.format==="auto"?t.dataFormats.auto(vL(Mn.getUrl(a.url)),(c=s.cell)===null||c===void 0?void 0:c.obj):t.dataFormats.get(i.params.format);break;case"pdb-xray":u=i.params.provider.id,o=i.params.provider.server==="pdbe"?t.dataFormats.get("ccp4"):t.dataFormats.get("dsn6");break;case"pdb-emd-ds":case"pdb-xray-ds":u=i.params.provider.id,o=t.dataFormats.get("dscif");break;default:throw new Error(i.name+" not supported.")}return o?[4,o.parse(t,s,{entryId:u})]:(t.log.warn("DownloadDensity: Format provider not found."),[2]);case 2:return l=f.sent(),[4,(d=o.visuals)===null||d===void 0?void 0:d.call(o,t,l)];case 3:return f.sent(),[2]}})})})}),ase=Ro.build({display:{name:"Assign Volume Colors",description:"Assigns another volume to be available for coloring."},from:ge.Volume.Data,isApplicable:function(e){return!e.data.colorVolume},params:function(e,t){var r=t.state.data.select(or.Generators.root.subtree().ofType(ge.Volume.Data).filter(function(n){var i;return!!n.obj&&!(!((i=n.obj)===null||i===void 0)&&i.data.colorVolume)&&n.obj!==e}));return r.length===0?{ref:I.Text("",{isHidden:!0,label:"Volume"})}:{ref:I.Select(r[0].transform.ref,r.map(function(n){return[n.transform.ref,n.obj.label]}),{label:"Volume"})}}})(function(e,t){var r=e.ref,n=e.params;return e.state,t.build().to(r).apply(rt.Volume.AssignColorVolume,{ref:n.ref},{dependsOn:[n.ref]}).commit()});const avt=Object.freeze(Object.defineProperty({__proto__:null,AssignColorVolume:ase,DownloadDensity:ivt},Symbol.toStringTag,{value:"Module"}));var ovt=Ro.build({display:{name:"Open Files",description:"Load one or more files and optionally create default visuals"},from:ge.Root,params:function(e,t){var r=t.dataFormats,n=r.extensions,i=r.options;return{files:I.FileList({accept:Array.from(n.values()).map(function(a){return"."+a}).join(",")+",.gz,.zip",multiple:!0}),format:I.MappedStatic("auto",{auto:I.EmptyGroup(),specific:I.Select(i[0][0],i)}),visuals:I.Boolean(!0,{description:"Add default visuals"})}}})(function(e,t){var r=e.params,n=e.state;return $e.create("Open Files",function(i){return ce(void 0,void 0,void 0,function(){return de(this,function(a){switch(a.label){case 0:return t.behaviors.layout.leftPanelTabName.next("data"),[4,n.transaction(function(){return ce(void 0,void 0,void 0,function(){var o,s,u,l,c,d,f,h,v,p,m;return de(this,function(g){switch(g.label){case 0:if(r.files===null)return t.log.error("No file(s) selected"),[2];o=0,s=r.files,g.label=1;case 1:if(!(o<s.length))return[3,9];u=s[o],g.label=2;case 2:return g.trys.push([2,7,,8]),l=vL(u.file),c=t.dataFormats.binaryExtensions.has(l.ext),[4,t.builders.data.readFile({file:u,isBinary:c})];case 3:return d=g.sent().data,f=r.format.name==="auto"?t.dataFormats.auto(l,(p=d.cell)===null||p===void 0?void 0:p.obj):t.dataFormats.get(r.format.params),f?[4,f.parse(t,d)]:(t.log.warn("OpenFiles: could not find data provider for '"+l.name+"."+l.ext+"'"),[3,8]);case 4:return h=g.sent(),r.visuals?[4,(m=f.visuals)===null||m===void 0?void 0:m.call(f,t,h)]:[3,6];case 5:g.sent(),g.label=6;case 6:return[3,8];case 7:return v=g.sent(),t.log.error(v),[3,8];case 8:return o++,[3,1];case 9:return[2]}})})}).runInContext(i)];case 1:return a.sent(),[2]}})})})}),svt=Ro.build({display:{name:"Download File",description:"Load one or more file from an URL"},from:ge.Root,params:function(e,t){var r=t.dataFormats.options;return{url:I.Url(""),format:I.Select(r[0][0],r),isBinary:I.Boolean(!1),visuals:I.Boolean(!0,{description:"Add default visuals"})}}})(function(e,t){var r=e.params,n=e.state;return $e.create("Open Files",function(i){return ce(void 0,void 0,void 0,function(){return de(this,function(a){switch(a.label){case 0:return t.behaviors.layout.leftPanelTabName.next("data"),[4,n.transaction(function(){return ce(void 0,void 0,void 0,function(){var o,s,u,l,c;return de(this,function(d){switch(d.label){case 0:return d.trys.push([0,5,,6]),o=t.dataFormats.get(r.format),o?[4,t.builders.data.download({url:r.url,isBinary:r.isBinary})]:(t.log.warn("DownloadFile: could not find data provider for '"+r.format+"'"),[2]);case 1:return s=d.sent(),[4,o.parse(t,s)];case 2:return u=d.sent(),r.visuals?[4,(c=o.visuals)===null||c===void 0?void 0:c.call(o,t,u)]:[3,4];case 3:d.sent(),d.label=4;case 4:return[3,6];case 5:return l=d.sent(),t.log.error(l),[3,6];case 6:return[2]}})})}).runInContext(i)];case 1:return a.sent(),[2]}})})})});const uvt=Object.freeze(Object.defineProperty({__proto__:null,DownloadFile:svt,OpenFiles:ovt},Symbol.toStringTag,{value:"Module"}));var yp={Structure:Oit,Volume:avt,DataFormat:uvt},lvt=Bh.create({name:"built-in.animate-state-interpolation",display:{name:"Animate State (experimental)"},params:function(){return{transtionDurationInMs:I.Numeric(2e3,{min:100,max:3e4,step:10})}},canApply:function(e){return{canApply:e.managers.snapshot.state.entries.size>1}},initialState:function(){return{}},apply:function(e,t,r){return ce(this,void 0,void 0,function(){var n,i,a,o,s,u,l,c,d,f,h,v,p,m,g,y,b,S,x,C;return de(this,function(w){switch(w.label){case 0:if(n=r.plugin.managers.snapshot.state.entries,n.size<2)return[2,{kind:"finished"}];if(i=t.current%r.params.transtionDurationInMs/r.params.transtionDurationInMs,a=Math.floor(t.current/r.params.transtionDurationInMs)%n.size,o=Math.ceil(t.current/r.params.transtionDurationInMs),o===a&&o++,o=o%n.size,s=n.get(a).snapshot,u=n.get(o).snapshot,!s.data||!u.data)return[2,{kind:"skip"}];for(l=s.data.tree.transforms,c=u.data.tree.transforms,d=r.plugin.state.data,f=d.build(),h=0,v=l;h<v.length;h++)for(p=v[h],m=0,g=c;m<g.length;m++)y=g[m],y.ref===p.ref&&y.version!==p.version&&(b=fr.fromJSON(p),S=fr.fromJSON(y),x=d.cells.get(p.ref),x&&(C=void 0,b.transformer.definition.interpolate?C=b.transformer.definition.interpolate(b.params,S.params,i,r.plugin):C=i<=.5?b.params:S.params,W_(x,C)||f.to(p.ref).update(C)));return[4,_t.State.Update(r.plugin,{state:d,tree:f,options:{doNotLogTiming:!0}})];case 1:return w.sent(),[2,{kind:"next",state:{}}]}})})}}),cvt=Bh.create({name:"built-in.animate-structure-spin",display:{name:"Spin Structure"},isExportable:!0,params:function(){return{durationInMs:I.Numeric(3e3,{min:100,max:1e4,step:100})}},initialState:function(){return{t:0}},getDuration:function(e){return{kind:"fixed",durationMs:e.durationInMs}},setup:function(e,t,r){return ce(this,void 0,void 0,function(){var n,i,a,o,s,u,l,c;return de(this,function(d){for(n=r.state.data,i=n.select(or.Generators.ofType(ge.Molecule.Structure.Representation3D)),a=n.build(),o=!1,s=0,u=i;s<u.length;s++)l=u[s],c=n.select(or.Generators.ofTransformer(rt.Representation.SpinStructureRepresentation3D,l.transform.ref)),!(c.length>0)&&(o=!0,a.to(l.transform.ref).apply(rt.Representation.SpinStructureRepresentation3D,{t:0},{tags:"animate-structure-spin"}));return o?[2,a.commit({doNotUpdateCurrent:!0})]:[2]})})},teardown:function(e,t,r){var n=r.state.data,i=n.select(or.Generators.ofType(ge.Molecule.Structure.Representation3DState).withTag("animate-structure-spin"));if(i.length!==0){for(var a=n.build(),o=0,s=i;o<s.length;o++){var u=s[o];a.delete(u.transform.ref)}return a.commit()}},apply:function(e,t,r){var n;return ce(this,void 0,void 0,function(){var i,a,o,s,u,l,c,d;return de(this,function(f){switch(f.label){case 0:if(i=r.plugin.state.data,a=i.select(or.Generators.ofTransformer(rt.Representation.SpinStructureRepresentation3D)),a.length===0)return[2,{kind:"finished"}];for(o=i.build(),s=(t.current-t.lastApplied)/r.params.durationInMs,u=(e.t+s)%1,l=0,c=a;l<c.length;l++)d=c[l],o.to(d).update(E(E({},(n=d.params)===null||n===void 0?void 0:n.values),{t:u}));return[4,_t.State.Update(r.plugin,{state:i,tree:o,options:{doNotLogTiming:!0}})];case 1:return f.sent(),[2,{kind:"next",state:{t:u}}]}})})}}),tr;(function(e){function t(n,i){return{action:n,customControl:i&&i.customControl,autoUpdate:i&&i.autoUpdate}}e.Action=t;function r(n,i){return i===void 0&&(i={}),{transformer:n,defaultParams:i}}e.Behavior=r})(tr||(tr={}));var dvt=function(){return{actions:[tr.Action(yp.Structure.DownloadStructure),tr.Action(yp.Structure.AddTrajectory),tr.Action(yp.Volume.DownloadDensity),tr.Action(yp.DataFormat.DownloadFile),tr.Action(yp.DataFormat.OpenFiles),tr.Action(yp.Structure.EnableModelCustomProps),tr.Action(yp.Structure.EnableStructureCustomProps),tr.Action(KR),tr.Action(Kst),tr.Action(fL),tr.Action(rt.Data.Download),tr.Action(rt.Data.ParseCif),tr.Action(rt.Data.ParseCcp4),tr.Action(rt.Data.ParseDsn6),tr.Action(rt.Model.TrajectoryFromMmCif),tr.Action(rt.Model.TrajectoryFromCifCore),tr.Action(rt.Model.TrajectoryFromPDB),tr.Action(rt.Model.TransformStructureConformation),tr.Action(rt.Model.StructureFromModel),tr.Action(rt.Model.StructureFromTrajectory),tr.Action(rt.Model.ModelFromTrajectory),tr.Action(rt.Model.StructureSelectionFromScript),tr.Action(rt.Representation.StructureRepresentation3D),tr.Action(rt.Representation.StructureSelectionsDistance3D),tr.Action(rt.Representation.StructureSelectionsAngle3D),tr.Action(rt.Representation.StructureSelectionsDihedral3D),tr.Action(rt.Representation.StructureSelectionsLabel3D),tr.Action(rt.Representation.StructureSelectionsOrientation3D),tr.Action(rt.Representation.ModelUnitcell3D),tr.Action(rt.Representation.StructureBoundingBox3D),tr.Action(rt.Representation.ExplodeStructureRepresentation3D),tr.Action(rt.Representation.SpinStructureRepresentation3D),tr.Action(rt.Representation.UnwindStructureAssemblyRepresentation3D),tr.Action(rt.Representation.OverpaintStructureRepresentation3DFromScript),tr.Action(rt.Representation.TransparencyStructureRepresentation3DFromScript),tr.Action(ase),tr.Action(rt.Volume.VolumeFromCcp4),tr.Action(rt.Volume.VolumeFromDsn6),tr.Action(rt.Volume.VolumeFromCube),tr.Action(rt.Volume.VolumeFromDx),tr.Action(rt.Representation.VolumeRepresentation3D)],behaviors:[tr.Behavior(Go.Representation.HighlightLoci),tr.Behavior(Go.Representation.SelectLoci),tr.Behavior(Go.Representation.DefaultLociLabelProvider),tr.Behavior(Go.Representation.FocusLoci),tr.Behavior(Go.Camera.FocusLoci),tr.Behavior(Go.Camera.CameraAxisHelper),tr.Behavior(qF),tr.Behavior(Go.CustomProps.StructureInfo),tr.Behavior(Go.CustomProps.AccessibleSurfaceArea),tr.Behavior(Go.CustomProps.BestDatabaseSequenceMapping),tr.Behavior(Go.CustomProps.Interactions),tr.Behavior(Go.CustomProps.SecondaryStructure),tr.Behavior(Go.CustomProps.ValenceModel),tr.Behavior(Go.CustomProps.CrossLinkRestraint)],animations:[rvt,tvt,nvt,evt,cvt,lvt]}},fvt={color:I.Color(pr.black,{description:"Display color of the volume."}),wireframe:I.Boolean(!1,{description:"Control display of the volume as a wireframe."}),opacity:I.Numeric(.3,{min:0,max:1,step:.01},{description:"Opacity of the volume."})},hvt=new Map([["em",[-5,5]],["2fo-fc",[0,3]],["fo-fc(+ve)",[1,5]],["fo-fc(-ve)",[-5,-1]]]),zS=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.ref=or.findTagInSubtree(r.plugin.state.data.tree,r.props.bCell.transform.ref,r.props.name),r.getVisible=function(){var n=r.plugin.state.data,i=r.ref;return i?!n.cells.get(i).state.isHidden:!1},r.toggleVisible=function(){var n=r.plugin.state.data,i=r.ref;i&&jv(n,i,!n.cells.get(i).state.isHidden)},r}return t.prototype.componentDidUpdate=function(){this.ref=or.findTagInSubtree(this.plugin.state.data.tree,this.props.bCell.transform.ref,this.props.name)},t.prototype.componentDidMount=function(){var r=this;this.subscribe(this.plugin.state.data.events.cell.stateUpdated,function(n){r.ref===n.ref&&r.forceUpdate()})},t.prototype.render=function(){var r=this.props,n=r.isRelative,i=r.stats,a=r.channels[r.name],o=i.min,s=i.max,u=i.mean,l=i.sigma,c=Math.round(100*(a.isoValue.kind==="relative"?a.isoValue.relativeValue:a.isoValue.absoluteValue))/100,d=(o-u)/l,f=(s-u)/l;if(!this.props.isUnbounded){var h=hvt.get(this.props.name);this.props.name==="em"?(d=Math.max(h[0],d),f=Math.min(h[1],f)):(d=h[0],f=h[1])}var v=u+l*d,p=u+l*f,m=ID(n?Math.round((p-v)/l)/100:l/100,2),g=n?d:v,y=n?f:p;return P.jsx(LRe,{label:r.label+(r.isRelative?" ":""),colorStripe:a.color,pivot:P.jsxs("div",E({className:"msp-volume-channel-inline-controls"},{children:[P.jsx(Iie,{value:c,min:g,max:y,step:m,onChange:function(b){return r.changeIso(r.name,b,n)},disabled:r.params.isDisabled,onEnter:r.params.events.onEnter},void 0),P.jsx(Gt,{svg:this.getVisible()?Jv:Zv,onClick:this.toggleVisible,toggleState:!1,disabled:r.params.isDisabled},void 0)]}),void 0),controls:P.jsx(Vn,{onChange:function(b){var S=b.name,x=b.value;return r.changeParams(r.name,S,x)},params:fvt,values:a,onEnter:r.params.events.onEnter,isDisabled:r.params.isDisabled},void 0)},void 0)},t}(br),pvt=function(e){Le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.changeIso=function(n,i,a){var o,s=r.props.params;r.newParams(E(E({},s),{entry:{name:s.entry.name,params:E(E({},s.entry.params),{channels:E(E({},s.entry.params.channels),(o={},o[n]=E(E({},s.entry.params.channels[n]),{isoValue:a?Ct.IsoValue.relative(i):Ct.IsoValue.absolute(i)}),o))})}}))},r.changeParams=function(n,i,a){var o,s,u=r.props.params;r.newParams(E(E({},u),{entry:{name:u.entry.name,params:E(E({},u.entry.params),{channels:E(E({},u.entry.params.channels),(o={},o[n]=E(E({},u.entry.params.channels[n]),(s={},s[i]=a,s)),o))})}}))},r.changeOption=function(n){var i=n.name,a=n.value,o=r.props.params;if(i==="entry")r.newParams(E(E({},o),{entry:{name:a,params:o.entry.params}}));else{var s=r.props.b.data,u=s.info.kind==="em",l=a.params.isRelative,c=s.info.header.sampling[0],d=o.entry.params.channels,f=o.entry.params.view.name===a.name?o.entry.params.view.params:r.props.info.params.entry.map(o.entry.name).params.view.map(a.name).defaultValue,h=E({},f);a.name==="selection-box"?h.radius=a.params.radius:a.name==="box"?(h.bottomLeft=a.params.bottomLeft,h.topRight=a.params.topRight):a.name==="auto"&&(h.radius=a.params.radius,h.selectionDetailLevel=a.params.selectionDetailLevel),h.isUnbounded=!!a.params.isUnbounded,r.newParams(E(E({},o),{entry:{name:o.entry.name,params:E(E({},o.entry.params),{view:{name:a.name,params:h},detailLevel:a.params.detailLevel,channels:u?{em:r.convert(d.em,c.valuesInfo[0],l)}:{"2fo-fc":r.convert(d["2fo-fc"],c.valuesInfo[0],l),"fo-fc(+ve)":r.convert(d["fo-fc(+ve)"],c.valuesInfo[1],l),"fo-fc(-ve)":r.convert(d["fo-fc(-ve)"],c.valuesInfo[1],l)}})}}))}},r}return t.prototype.areInitial=function(r){return I.areEqual(this.props.info.params,r,this.props.info.initialValues)},t.prototype.newParams=function(r){this.props.events.onChange(r,this.areInitial(r))},t.prototype.convert=function(r,n,i){return E(E({},r),{isoValue:i?Ct.IsoValue.toRelative(r.isoValue,n):Ct.IsoValue.toAbsolute(r.isoValue,n)})},t.prototype.render=function(){if(!this.props.b)return null;var r=this.props.b.data,n=r.info.kind==="em",i=n?"em":"2fo-fc",a=this.props.params,o=this.props.info.params.entry.map(a.entry.name),s=o.params.detailLevel,u=a.entry.params.channels[i].isoValue.kind==="relative",l=r.info.header.sampling[0],c=I.Boolean(u,{description:"Use normalized or absolute isocontour scale.",label:"Normalized"}),d=!!a.entry.params.view.params.isUnbounded,f=I.Boolean(d,{description:"Show full/limited range of iso-values for more fine-grained control.",label:"Unbounded"}),h=a.entry.params.view.name==="off",v={entry:I.Select(a.entry.name,r.data.entries.map(function(m){return[m.dataId,m.dataId]}),{isHidden:h,description:"Which entry with volume data to display."}),view:I.MappedStatic(a.entry.params.view.name,{off:I.Group({isRelative:I.Boolean(u,{isHidden:!0}),isUnbounded:I.Boolean(d,{isHidden:!0})},{description:"Display off."}),box:I.Group({bottomLeft:I.Vec3(_.zero()),topRight:I.Vec3(_.zero()),detailLevel:s,isRelative:c,isUnbounded:f},{description:"Static box defined by cartesian coords."}),"selection-box":I.Group({radius:I.Numeric(5,{min:0,max:50,step:.5},{description:"Radius in  within which the volume is shown."}),detailLevel:s,isRelative:c,isUnbounded:f},{description:"Box around focused element."}),cell:I.Group({detailLevel:s,isRelative:c,isUnbounded:f},{description:"Box around the structure's bounding box."}),auto:I.Group({radius:I.Numeric(5,{min:0,max:50,step:.5},{description:"Radius in  within which the volume is shown."}),detailLevel:s,selectionDetailLevel:E(E({},s),{label:"Selection Detail"}),isRelative:c,isUnbounded:f},{description:"Box around focused element."})},{options:Ga.ViewTypeOptions,description:'Controls what of the volume is displayed. "Off" hides the volume alltogether. "Bounded box" shows the volume inside the given box. "Around Focus" shows the volume around the element/atom last interacted with. "Whole Structure" shows the volume for the whole structure.'})},p={entry:a.entry.name,view:{name:a.entry.params.view.name,params:{detailLevel:a.entry.params.detailLevel,radius:a.entry.params.view.params.radius,bottomLeft:a.entry.params.view.params.bottomLeft,topRight:a.entry.params.view.params.topRight,selectionDetailLevel:a.entry.params.view.params.selectionDetailLevel,isRelative:u,isUnbounded:d}}};return h?P.jsx(Vn,{onChange:this.changeOption,params:v,values:p,onEnter:this.props.events.onEnter,isDisabled:this.props.isDisabled},void 0):P.jsxs(P.Fragment,{children:[!n&&P.jsx(zS,{label:"2Fo-Fc",name:"2fo-fc",bCell:this.props.bCell,channels:a.entry.params.channels,changeIso:this.changeIso,changeParams:this.changeParams,isRelative:u,params:this.props,stats:l.valuesInfo[0],isUnbounded:d},void 0),!n&&P.jsx(zS,{label:"Fo-Fc(+ve)",name:"fo-fc(+ve)",bCell:this.props.bCell,channels:a.entry.params.channels,changeIso:this.changeIso,changeParams:this.changeParams,isRelative:u,params:this.props,stats:l.valuesInfo[1],isUnbounded:d},void 0),!n&&P.jsx(zS,{label:"Fo-Fc(-ve)",name:"fo-fc(-ve)",bCell:this.props.bCell,channels:a.entry.params.channels,changeIso:this.changeIso,changeParams:this.changeParams,isRelative:u,params:this.props,stats:l.valuesInfo[1],isUnbounded:d},void 0),n&&P.jsx(zS,{label:"EM",name:"em",bCell:this.props.bCell,channels:a.entry.params.channels,changeIso:this.changeIso,changeParams:this.changeParams,isRelative:u,params:this.props,stats:l.valuesInfo[0],isUnbounded:d},void 0),P.jsx(Vn,{onChange:this.changeOption,params:v,values:p,onEnter:this.props.events.onEnter,isDisabled:this.props.isDisabled},void 0)]},void 0)},t}(br),ose=function(){return E(E({},dvt()),{customParamEditors:[[fL,pvt]]})};function vvt(e,t){var r=new Jpt(t||ose());return r.init(),M3.render(_e.createElement(Elt,{plugin:r}),e),r}var sse=globalThis&&globalThis.__awaiter||function(e,t,r,n){function i(a){return a instanceof r?a:new r(function(o){o(a)})}return new(r||(r=Promise))(function(a,o){function s(c){try{l(n.next(c))}catch(d){o(d)}}function u(c){try{l(n.throw(c))}catch(d){o(d)}}function l(c){c.done?a(c.value):i(c.value).then(s,u)}l((n=n.apply(e,t||[])).next())})};const mvt="",use=e=>!!e&&Xt.isFromPdbArchive(e),gvt={local_metric_values:{label_asym_id:ve.Schema.str,label_comp_id:ve.Schema.str,label_seq_id:ve.Schema.int,metric_id:ve.Schema.int,metric_value:ve.Schema.float,model_id:ve.Schema.int,ordinal_id:ve.Schema.int}},yvt=(e,t)=>{if(!un.is(t.sourceData)||!t.sourceData.data.frame.categoryNames.includes(e))return;const r=t.sourceData.data.frame.categories[e].getField("metric_value");if(!(!r||r.rowCount===0))return{timestamp_utc:r.str(0)||gtt(new Date)}},bvt=(e,t)=>{const r=yvt("ma_qa_metric_local",t);if(!r)return;const n=Cvt(t),i=_vt(t,n.residues);return{info:r,data:i}};function xvt(e,t,r){return sse(this,void 0,void 0,function*(){return{value:bvt(e,t)}})}function lk(e){if(!je.isAtomic(e.unit))return[-1,"No Score"];const t=bh.get(e.unit.model).value;if(!t||!t.data)return[-1,"No Score"];const r=e.unit.residueIndex[e.element];return t.data.score.has(r)?t.data.score.get(r):[-1,"No Score"]}const pq=[];function Svt(e){if(!e)return pq;const t=bh.get(e.models[0]).value;return!t||!t.data?pq:t.data.category}function Cvt(e){if(!un.is(e.sourceData))throw new Error("Data format must be mmCIF.");return{residues:XJ(gvt.local_metric_values,e.sourceData.data.frame.categories.ma_qa_metric_local)}}const UI={serverUrl:I.Text(mvt,{description:"JSON API Server URL"})},bh=Fv.createProvider({label:"AF Confidence Score",descriptor:ko({name:"af_confidence_score"}),type:"static",defaultParams:UI,getParams:e=>UI,isApplicable:e=>use(e),obtain:(e,t,r)=>sse(void 0,void 0,void 0,function*(){return Object.assign(Object.assign({},I.getDefaultValues(UI)),r),yield xvt(e,t)})});function _vt(e,t){const r=new Map,{label_asym_id:n,label_seq_id:i,metric_value:a,_rowCount:o}=t,s=[];for(let u=0;u<o;u++){const l=a.value(u),c=e.atomicHierarchy.index.findResidue("1",n.value(u),i.value(u),"");let d="Very low";l>50&&l<=70?d="Low":l>70&&l<=90?d="Medium":l>90&&(d="High"),r.set(c,[l,d]),ja(s,d)}return{score:HD.fromResidueMap(r),category:s}}const $m={"No Score":at.fromRgb(170,170,170),"Very low":at.fromRgb(255,125,69),Low:at.fromRgb(255,219,19),Medium:at.fromRgb(101,203,243),High:at.fromRgb(0,83,214)},wvt={type:I.MappedStatic("score",{score:I.Group({}),category:I.Group({kind:I.Text()})})};function lse(e,t){let r;if(e.structure&&!e.structure.isEmpty&&e.structure.models[0].customProperties.has(bh.descriptor))if(t.type.name==="score")r=n=>{if(Ze.is(n)){const i=lk(n);return $m[i[1]]}return $m["No Score"]};else{const n=t.type.params.kind;r=i=>{if(Ze.is(i)){const a=lk(i);return a[1]===n?$m[a[1]]:$m["No Score"]}return $m["No Score"]}}else r=()=>$m["No Score"];return{factory:lse,granularity:"group",color:r,props:t,description:"Assigns residue colors according to the AF Confidence score"}}const vq={name:"af-confidence",label:"AF Confidence",category:"Validation",factory:lse,getParams:e=>{const t=Svt(e.structure);return t.length===0?{type:I.MappedStatic("score",{score:I.Group({})})}:{type:I.MappedStatic("score",{score:I.Group({}),category:I.Group({kind:I.Select(t[0],I.arrayToOptions(t))},{isFlat:!0})})}},defaultValues:I.getDefaultValues(wvt),isApplicable:e=>{var t;return use((t=e.structure)===null||t===void 0?void 0:t.models[0])},ensureCustomProperties:{attach:(e,t)=>t.structure?bh.attach(e,t.structure.models[0],void 0,!0):Promise.resolve(),detach:e=>e.structure&&e.structure.models[0].customProperties.reference(bh.descriptor,!1)}},Evt=Nr.create({name:"af-confidence-prop",category:"custom-props",display:{name:"AlphaFold Confidence Score",description:"AlphaFold Confidence Score."},ctor:class extends Nr.Handler{constructor(){super(...arguments),this.provider=bh,this.labelAfConfScore={label:e=>{if(this.params.showTooltip&&e.kind==="element-loci"&&e.elements.length!==0){const t=e.elements[0],r=t.unit;if(!r.model.customProperties.hasReference(bh.descriptor))return;const n=Ze.create(e.structure,r,r.elements[Fe.getAt(t.indices,0)]),i=lk(n);return i&&i[0]>0?`Confidence score: ${i[0]} <small>( ${i[1]} )</small>`:""}}}}register(){this.ctx.customModelProperties.register(this.provider,this.params.autoAttach),this.ctx.managers.lociLabels.addProvider(this.labelAfConfScore),this.ctx.representation.structure.themes.colorThemeRegistry.add(vq)}update(e){const t=this.params.autoAttach!==e.autoAttach;return this.params.autoAttach=e.autoAttach,this.params.showTooltip=e.showTooltip,this.ctx.customModelProperties.setDefaultAutoAttach(this.provider.descriptor.name,this.params.autoAttach),t}unregister(){this.ctx.customModelProperties.unregister(bh.descriptor.name),this.ctx.managers.lociLabels.removeProvider(this.labelAfConfScore),this.ctx.representation.structure.themes.colorThemeRegistry.remove(vq)}},params:()=>({autoAttach:I.Boolean(!1),showTooltip:I.Boolean(!0)})});var Avt=globalThis&&globalThis.__awaiter||function(e,t,r,n){function i(a){return a instanceof r?a:new r(function(o){o(a)})}return new(r||(r=Promise))(function(a,o){function s(c){try{l(n.next(c))}catch(d){o(d)}}function u(c){try{l(n.throw(c))}catch(d){o(d)}}function l(c){c.done?a(c.value):i(c.value).then(s,u)}l((n=n.apply(e,t||[])).next())})};const wc={layoutIsExpanded:!1,layoutShowControls:!1,layoutShowRemoteState:!1,layoutControlsDisplay:"reactive",layoutShowSequence:!1,layoutShowLog:!1,layoutShowLeftPanel:!1,disableAntialiasing:!1,pixelScale:1,enableWboit:!1,viewportShowExpand:!0,viewportShowSelectionMode:!1,viewportShowAnimation:!1,pdbProvider:"pdbe",viewportShowControls:Zr.Viewport.ShowControls.defaultValue,viewportShowSettings:Zr.Viewport.ShowSettings.defaultValue};class Pvt{constructor(t,r,n){const i=ose(),a={actions:i.actions,behaviors:[...i.behaviors,tr.Behavior(Evt,{autoAttach:!0,showTooltip:!0})],layout:{initial:{isExpanded:wc.layoutIsExpanded,showControls:wc.layoutShowControls,controlsDisplay:wc.layoutControlsDisplay}},config:[[Zr.General.DisableAntialiasing,wc.disableAntialiasing],[Zr.General.PixelScale,wc.pixelScale],[Zr.General.EnableWboit,wc.enableWboit],[Zr.Viewport.ShowExpand,wc.viewportShowExpand],[Zr.Viewport.ShowSelectionMode,wc.viewportShowSelectionMode],[Zr.Download.DefaultPdbProvider,wc.pdbProvider],[Zr.Structure.DefaultRepresentationPresetParams,{theme:{globalName:"af-confidence",carbonByChainId:!1,focus:{name:"element-symbol",params:{carbonByChainId:!1}}}}]]},o=typeof t=="string"?document.getElementById(t):t;if(!o)throw new Error(`Could not get element with id '${t}'`);this.plugin=vvt(o,a),this.plugin.behaviors.interaction.click.subscribe(s=>{if(Re.is(s.current.loci)){const u=Ze.create();Re.getFirstLocation(s.current.loci,u);const l=lt.residue.label_seq_id(u),c=lt.chain.auth_asym_id(u);r([{position:l,chain:c}])}}),_t.Canvas3D.SetSettings(this.plugin,{settings:s=>{s.renderer.backgroundColor=at(16777215)}}),n&&(_t.Canvas3D.SetSettings(this.plugin,{settings:s=>{s.trackball.bindings.scrollZoom.triggers[0].modifiers.control=!0}}),this.plugin.canvas3dContext.input.noScroll=!1,o.addEventListener("wheel",s=>{s.ctrlKey&&s.preventDefault()},!1))}clear(t){this.plugin.clear(),t&&this.showMessage("Loading",t)}loadPdb(t,r){const n=GR.createDefaultParams(this.plugin.state.data.root.obj,this.plugin),i=this.plugin.config.get(Zr.Download.DefaultPdbProvider);return this.plugin.runTask(this.plugin.state.data.applyAction(GR,{source:{name:"pdb",params:{provider:{id:t,server:{name:i,params:WF[i].defaultValue}},options:Object.assign(Object.assign({},n.source.params.options),{representationParams:r==null?void 0:r.representationParams})}}})).then(()=>{this.clearMessages()})}loadCifUrl(t,r){return Avt(this,void 0,void 0,function*(){const{plugin:n}=this,i=yield n.builders.data.download({url:r,isBinary:!1},{state:{isGhost:!0}}),a=yield n.builders.structure.parseTrajectory(i,"mmcif");return this.plugin.builders.structure.hierarchy.applyPreset(a,"all-models",{useDefaultIfSingleModel:!0}).then(()=>this.clearMessages())})}highlight(t){var r,n;const i=(n=(r=this.plugin.managers.structure.hierarchy.current.structures[0])===null||r===void 0?void 0:r.cell.obj)===null||n===void 0?void 0:n.data;if(!i)return;const a=$i.getStructureSelection(s=>s.struct.generator.atomGroups({"residue-test":s.core.logic.or(t.map(({start:u,end:l,chain:c})=>s.core.logic.and([s.core.rel.inRange([s.struct.atomProperty.macromolecular.label_seq_id(),u,l]),s.core.rel.eq([s.struct.atomProperty.macromolecular.auth_asym_id(),c])])))}),i),o=mt.toLociWithSourceUnits(a);this.plugin.managers.camera.focusLoci(o),this.plugin.managers.interactivity.lociSelects.selectOnly({loci:o})}clearHighlight(){this.plugin.managers.interactivity.lociSelects.deselectAll(),_t.Camera.Reset(this.plugin,{})}showMessage(t,r,n){this.clearMessages(),_t.Toast.Show(this.plugin,{title:t,message:r,timeoutMs:n})}clearMessages(){_t.Toast.Hide(this.plugin)}handleResize(){this.plugin.layout.events.updated.next()}}class Q1 extends Error{}const mq=(e,t,r,n)=>{if(!r)return[];if(!e||!t||Number.isNaN(e)||Number.isNaN(t))throw new Q1("Invalid start, end coordinates");const i=Object.entries(u0(r,a=>a.chain_id)).map(([a,o])=>{let s=null,u=null;for(const c of o){if(c.unp_end-c.unp_start!==c.end.residue_number-c.start.residue_number)throw new Q1("Mismatch between protein sequence and structure residues");const d=n==="UP_PDB"?c.unp_start:c.start.residue_number,f=n==="UP_PDB"?c.unp_end:c.end.residue_number;e>=d&&e<=f&&(s=c),t>=d&&t<=f&&(u=c)}if(s===null||u===null)return null;const l=n==="UP_PDB"?1:-1;return{entity:s.entity_id,chain:s.chain_id,start:e+l*(s.start.residue_number-s.unp_start),end:t+l*(u.start.residue_number-u.unp_start)}}).filter(Boolean);if(!i.length)throw new Q1("Start or end coordinate outside of mapping range");return i};var jI=globalThis&&globalThis.__awaiter||function(e,t,r,n){function i(a){return a instanceof r?a:new r(function(o){o(a)})}return new(r||(r=Promise))(function(a,o){function s(c){try{l(n.next(c))}catch(d){o(d)}}function u(c){try{l(n.throw(c))}catch(d){o(d)}}function l(c){c.done?a(c.value):i(c.value).then(s,u)}l((n=n.apply(e,t||[])).next())})};const gq=(e,t)=>{const{ga:r}=window;r&&r("send","event","protvista-structure",e,t)};class f3 extends HTMLElement{constructor(){super(),this._uniProtMappingUrl="https://www.ebi.ac.uk/pdbe/api/mappings/uniprot/",this._alphaFoldMappingUrl="https://alphafold.ebi.ac.uk/api/prediction/",this._planHighlight=this._planHighlight.bind(this),this.propagateHighlight=this.propagateHighlight.bind(this)}static get is(){return"protvista-structure"}get css(){return`
    protvista-structure h4 {
      display: inline;
      margin-right: 1em;
    }
      
    .structure-viewer-container {
      position: relative;
      height: ${this._height};
    }
    `}get accession(){return this._accession}set accession(t){this.setAttribute("accession",t)}get structureId(){return this._structureId}set structureId(t){this.setAttribute("structureid",t),this._structureId=t}get height(){return this.getAttribute("height")}set height(t){this.setAttribute("height",t),this._height=t}updateUrls(){this._uniProtMappingUrl=this.getAttribute("uniprot-mapping-url")||this._uniProtMappingUrl,this._alphaFoldMappingUrl=this.getAttribute("alphafold-mapping-url")||this._alphaFoldMappingUrl,this._customDownloadUrl=this.getAttribute("custom-download-url")}connectedCallback(){this.innerHTML="";const t=this.closest("protvista-manager");t&&"register"in t&&"unregister"in t&&(this.manager=t,this.manager.register(this)),this._structureId=this.getAttribute("structureid"),this._accession=this.getAttribute("accession"),this._height=this.getAttribute("height")||"480px",this._highlight=this.getAttribute("highlight")&&f3._parseHighlight(this.getAttribute("highlight")),this.updateUrls();const r=document.createElement("style");r.innerHTML=this.css,this.appendChild(r);const n=document.createElement("div");n.className="structure-viewer-container",n.id="structure-viewer-instance",this.appendChild(n),this._structureViewer=new Pvt(n,this.propagateHighlight,this.hasAttribute("use-ctrl-to-zoom"))}disconnectedCallback(){this.manager&&this.manager.unregister(this)}static get observedAttributes(){return["highlight","structureid","accession","height"]}static _parseHighlight(t){return t?t.split(",").map(n=>{const[i,a]=n.split(":");return{start:Number(i),end:Number(a)}}):[]}attributeChangedCallback(t,r,n){if(r!==n){switch(t){case"structureid":n!==null&&(this._structureId=n),this.selectMolecule();break;case"accession":this._accession=n,this.selectMolecule();break;case"highlight":this._highlight=f3._parseHighlight(this.getAttribute("highlight"));break;case"height":this._height=n;break}this._planHighlight()}}_planHighlight(){this._plannedRender||(this._plannedRender=!0,requestAnimationFrame(()=>{this._plannedRender=!1,this._selectedMolecule&&this.highlightChain()}))}loadPDBEntry(t){var r;return jI(this,void 0,void 0,function*(){(r=this._structureViewer)===null||r===void 0||r.clear(t);try{gq("load-PDBe",t);const{payload:n}=yield Z9(`${this._uniProtMappingUrl}${t}`);return n}catch(n){throw this._structureViewer.showMessage("Error","Couldn't load PDB entry"),n}})}loadAFEntry(t){var r;return jI(this,void 0,void 0,function*(){(r=this._structureViewer)===null||r===void 0||r.clear(t);try{const{payload:n}=yield Z9(`${this._alphaFoldMappingUrl}${t}`);return gq("load-AF",t),n}catch(n){throw this._structureViewer.showMessage("Error","Couldn't load AF entry"),n}})}isAF(){return this._structureId.startsWith("AF-")}selectMolecule(){var t;return jI(this,void 0,void 0,function*(){if(!this._structureId||!this._accession)return;this.updateUrls();let r;if(this.isAF()){const i=(yield this.loadAFEntry(this._accession)).find(a=>a.entryId===this._structureId);yield this._structureViewer.loadCifUrl(this._structureId,i.cifUrl)}else{const n=yield this.loadPDBEntry(this._structureId);r=(t=Object.values(n)[0].UniProt[this._accession])===null||t===void 0?void 0:t.mappings,this._customDownloadUrl?yield this._structureViewer.loadCifUrl(this._structureId,`${this._customDownloadUrl}${this._structureId.toLowerCase()}.cif`):yield this._structureViewer.loadPdb(this._structureId.toLowerCase())}this._selectedMolecule={id:this._structureId,mappings:r},this._planHighlight()})}propagateHighlight(t){if(!(t!=null&&t.length)||t.some(a=>!Number.isInteger(a.position)))return;let r;try{r=J9(t,a=>mq(a.position,a.position,this._selectedMolecule.mappings,"PDB_UP").filter(o=>o.chain===a.chain)).filter(Boolean)}catch(a){if(a instanceof Q1){this._structureViewer.showMessage("Error",a.message);return}throw a}if(!r.length){this._structureViewer.showMessage("Error","Residue outside of sequence range");return}const n=r.map(a=>`${a.start}:${a.end}`);this.setAttribute("highlight",n.join(","));const i=new CustomEvent("change",{detail:{highlight:n},bubbles:!0,cancelable:!0});this.dispatchEvent(i)}highlightChain(){if(!this._highlight||typeof this._highlight=="string")return;let t;try{t=J9(this._highlight,({start:r,end:n})=>this.isAF()?{start:r,end:n,chain:"A"}:mq(r,n,this._selectedMolecule.mappings,"UP_PDB")).filter(Boolean)}catch(r){if(r instanceof Q1){this._structureViewer.clearHighlight(),this._structureViewer.showMessage("Error",r.message);return}throw r}if(!(t!=null&&t.length)){this._structureViewer.clearHighlight();return}this._structureViewer.highlight(t),this._structureViewer.clearMessages()}}const Tvt=e=>{const t=new Map;return e.forEach(r=>{r.dataset.filter&&t.set(r.dataset.filter,new Set)}),t},Ivt=(e,t,r,n)=>!r&&t===n||!n&&e===r||e<=r&&t>=n,Mvt=(e,t,r,n)=>e>n||t<r,ck=nu`pd-group-trigger__expanded`,h3=nu`active`,Z1=nu`transparent`,dk=nu`overlapped`,fk=nu`hidden`,Dvt=nu`
  protvista-datatable table {
    width: 100%;
    padding: 0;
    margin: 0;
    border-spacing: 0;
  }

  protvista-datatable table th {
    position: sticky;
    position: -webkit-sticky;
    position: -moz-sticky;
    position: -ms-sticky;
    position: -o-sticky;
    text-align: left;
    vertical-align: top;
    background-color: var(--protvista-datable__header-background, #fff);
    color: var(--protvista-datable__header-text, #393b42);
    text-overflow: ellipsis;
    top: 0;
    text-transform: uppercase;
    z-index: 400;
  }

  protvista-datatable table th .filter-wrap {
    display: flex;
    flex-direction: column;
  }

  protvista-datatable table th .filter-wrap select {
    width: fit-content;
  }

  protvista-datatable table td,
  protvista-datatable table th {
    padding: 0.2rem;
    border-bottom: 1px solid #c2c4c4;
  }

  protvista-datatable table tr:hover:not(.${h3}):not(.${Z1}) {
    background-color: var(--protvista-datatable__hover, #f1f1f1);
  }

  protvista-datatable table td {
    cursor: pointer;
  }

  protvista-datatable table .pd-group-trigger {
    width: 1rem;
  }

  protvista-datatable table .pd-group-trigger button {
    background: none;
    border: none;
    padding: 0.2rem; // increase click area
    position: relative;
    text-decoration: none;
    cursor: pointer;
    transition: background 250ms ease-in-out, transform 150ms ease;
    -webkit-appearance: none;
    -moz-appearance: none;
  }

  protvista-datatable table .pd-group-trigger button:before {
    display: inline-block;
    content: " ";
    border-style: solid;
    border-width: 0.4rem 0 0.4rem 0.6rem;
    border-color: transparent transparent transparent #161d39;
    transition-duration: 0.3s;
    transition-property: transform;
  }

  protvista-datatable table .pd-group-trigger button.${ck}:before {
    transform: rotate(90deg);
  }

  protvista-datatable table td:nth-child(1) {
    border-left: 0.5rem solid transparent;
  }

  protvista-datatable table .${dk} td:nth-child(1) {
    border-left: 0.5rem solid
      var(--protvista-datatable__overlapped, rgba(255, 0, 0, 0.8));
  }

  protvista-datatable table .${h3} {
    background-color: var(
      --protvista-datatable__active,
      rgba(255, 235, 59, 0.3)
    ) !important;
  }

  protvista-datatable table .${Z1} {
    opacity: 0.2;
  }
  protvista-datatable table .${Z1} td:hover {
    cursor: default;
    background-color: inherit;
  }

  protvista-datatable table .${fk} {
    display: none;
  }

  protvista-datatable table tr[data-group-for] td {
    padding-left: 1.7rem;
    padding-bottom: 0.7rem;
  }

  protvista-datatable table .odd {
    background-color: var(--protvista-datatable__odd, #e4e8eb);
  }

  protvista-datatable table .even {
    background-color: var(--protvista-datatable__even, #fff);
  }
`;class Rvt extends Hh{constructor(){super(),this.height="25rem",this.visibleChildren=[],this.noScrollToRow=!1,this.noDeselect=!1,this.expandTable=!1,this.scrollFilter=new TQ(this),this.wheelListener=t=>this.scrollFilter.wheel(t),this.eventHandler=this.eventHandler.bind(this)}static get is(){return"protvista-datatable"}connectedCallback(){super.connectedCallback();const t=this.querySelector("table tbody");if(!t)return;this.mutationObserver=new MutationObserver(()=>{this.init()}),this.mutationObserver.observe(t,{characterData:!0,childList:!0,subtree:!0});const r=document.createElement("style");r.innerHTML=Dvt.toString(),document.querySelector("head").appendChild(r),this.closest("protvista-manager")&&(this.manager=this.closest("protvista-manager"),this.manager.register(this)),this.noDeselect||document.addEventListener("click",this.eventHandler),this.classList.add("feature"),this.hasAttribute("filter-scroll")&&document.addEventListener("wheel",this.wheelListener),this.init()}disconnectedCallback(){super.disconnectedCallback(),this.manager&&this.manager.unregister(this),document.removeEventListener("click",this.eventHandler),document.removeEventListener("wheel",this.wheelListener),this.mutationObserver.disconnect()}init(){if(this.columns=this.querySelectorAll("table thead th"),!this.querySelector(".pd-group-column-header")){const t=document.createElement("th");t.classList.add("pd-group-column-header");const r=this.querySelector("table thead tr");r.insertBefore(t,r.firstChild)}this.rows=this.querySelectorAll("table tbody tr"),this.rows.forEach(t=>{if(!t.dataset.groupFor&&!t.querySelector(".pd-group-trigger")){const r=t.insertCell(0);if(r.classList.add("pd-group-trigger"),this.querySelector("[data-group-for]")){const n=document.createElement("button");n.dataset.triggerId=t.dataset.id,r.appendChild(n),n.addEventListener("click",i=>this.handleGroupToggle(i))}}t.addEventListener("click",r=>this.handleClick(r,t))}),this.updateRowStyling(),this.selectedFilters=new Map,this.filterMap=this.parseDataForFilters(),this.addFilterOptions()}parseDataForFilters(){const t=Tvt(this.columns);return this.rows.forEach(r=>{r.childNodes.forEach(i=>{var a;!((a=i.dataset)===null||a===void 0)&&a.filter&&t.get(i.dataset.filter).add(i.dataset.filterValue)})}),t}addFilterOptions(){this.columns.forEach(t=>{if(t.dataset.filter){let r,n;t.querySelector(".filter-wrap")?(r=t.querySelector("select"),n=t.querySelector(".filter-wrap")):(n=document.createElement("span"),n.className="filter-wrap",n.innerHTML=t.innerHTML,r=document.createElement("select"),r.dataset.testid="select",r.onchange=i=>this.handleFilterChange(i,t.dataset.filter)),r.innerHTML="<option  selected value>-- Select --</option>",this.filterMap.get(t.dataset.filter).forEach(i=>{const a=document.createElement("option");a.value=i,a.label=i,a.dataset.testid="select-option",r.appendChild(a)}),t.innerHTML="",n.appendChild(r),t.appendChild(n)}})}eventHandler(t){const r=t.target;!r.closest("protvista-datatable")&&!r.closest(".feature")&&(this.selectedid=null,this.highlight=null)}static get properties(){return{highlight:{converter:t=>{if(t&&t!=="null")try{const r=t.split(":").map(n=>Number(n));if(r.length!==2)throw new Error("Highlight should be only 2 values separated by ':'.");return[r[0],r[1]]}catch(r){console.error("Invalid highlight coordinates:",r)}return null}},height:{type:String},displayStart:{type:Number},displayEnd:{type:Number},visibleChildren:{type:Array},selectedid:{type:String},noScrollToRow:{type:Boolean},noDeselect:{type:Boolean},expandTable:{type:Boolean}}}static get styles(){return nu`
      :host {
        display: block;
      }

      .protvista-datatable-container {
        overflow-y: auto;
        // Note: overflow-x was set to 'hidden' but changing
        // to 'auto' doesn't seem to be an issue.
        overflow-x: auto;
        scrollbar-gutter: stable;
      }

      :host([scrollable="true"]) .protvista-datatable-container {
        overflow-y: auto;
      }

      :host([scrollable="false"]) .protvista-datatable-container {
        overflow-y: hidden;
      }
    `}handleGroupToggle(t){const{triggerId:r}=t.target.dataset;this.visibleChildren.includes(r)?(this.visibleChildren=this.visibleChildren.filter(n=>n!==r),t.target.classList.remove(ck.cssText)):(this.visibleChildren=[...this.visibleChildren,r],t.target.classList.add(ck.cssText))}handleClick(t,r){if(r.classList.contains("transparent"))return;const{id:n,start:i,end:a}=r.dataset;this.selectedid=n;const o={};i&&a&&(o.highlight=`${i}:${a}`),this.selectedid&&(o.selectedid=this.selectedid),this.dispatchEvent(new CustomEvent("change",{detail:o,bubbles:!0,cancelable:!0}))}handleFilterChange(t,r){const{selectedOptions:n}=t.target,{value:i}=n.item(0);i?this.selectedFilters.set(r,i):this.selectedFilters.delete(r),this.updateRowStyling()}isRowVisible(t){const r=!t.dataset.groupFor||t.dataset.groupFor&&this.visibleChildren.includes(t.dataset.groupFor);if(!this.selectedFilters||this.selectedFilters.size===0)return r;for(const[n,i]of this.selectedFilters){let a;if(t.dataset.groupFor?a=this.querySelector(`[data-id="${t.dataset.groupFor}"]`).querySelector(`[data-filter="${n}"]`):a=t.querySelector(`[data-filter="${n}"]`),a&&a.dataset.filterValue!==i)return!1}return r}updateRowStyling(){var t;let r=0;(t=this.rows)===null||t===void 0||t.forEach(n=>{this.isRowVisible(n)?n.classList.remove(fk.cssText):n.classList.add(fk.cssText),n.dataset.groupFor||r++;const{start:a,end:o}=n.dataset;if(n.classList.add(r%2===0?"even":"odd"),this.selectedid&&(this.selectedid===n.dataset.id||n.dataset.groupFor===this.selectedid)?n.classList.add(h3.cssText):n.classList.remove(h3.cssText),Mvt(this.displayStart,this.displayEnd,Number(a),Number(o))?n.classList.add(Z1.cssText):n.classList.remove(Z1.cssText),this.highlight&&Ivt(this.highlight[0],this.highlight[1],Number(a),Number(o))?n.classList.add(dk.cssText):n.classList.remove(dk.cssText),n.dataset.groupFor){const s=this.columns.length+1;n.cells[0].colSpan=s-n.cells.length+1}})}scrollIntoView(){if(!this.selectedid)return;const t=this.querySelector(`[data-id="${this.selectedid}"]`);t==null||t.scrollIntoView({behavior:"smooth",block:"center"})}render(){const t=this.expandTable||this.hasAttribute("expand-table")?"height: auto":`max-height:${this.height}`;return zr`
      <div class="protvista-datatable-container" style=${t}>
        <slot></slot>
      </div>
    `}updated(){this.updateRowStyling(),this.noScrollToRow||this.scrollIntoView()}}const $o=function(e,t){customElements.get(e)||customElements.define(e,t)},cse="/assets/spinner-374aaf14.svg",kvt="/assets/download-325e4c97.svg",dse=nu`
  .protvista-loader {
    display: flex;
    justify-content: center;
    padding: 4rem 0;
  }
  .protvista-loader svg {
    height: 100px;
  }

  .protvista-no-results {
    background-color: #e4e8eb;
    display: flex;
    justify-content: center;
    padding: 1rem;
    font-size: 0.8rem;
  }
`,Ovt=[{name:"PDBe",link:"https://www.ebi.ac.uk/pdbe-srv/view/entry/"},{name:"RCSB-PDB",link:"https://www.rcsb.org/structure/"},{name:"PDBj",link:"https://pdbj.org/mine/summary/"},{name:"PDBsum",link:"https://www.ebi.ac.uk/pdbsum/"}],Fvt="https://alphafold.ebi.ac.uk/entry/",Lvt="https://search.foldseek.com/search",Nvt=e=>e.dbReferences.filter(t=>t.type==="PDB").sort((t,r)=>t.id.localeCompare(r.id)).map(({id:t,properties:r})=>{if(!r)return;const{chains:n,resolution:i,method:a}=r;let o,s;if(n){const l=n.split("=");l.length===2&&([o,s]=l)}return{id:t,source:"PDB",method:a,resolution:!i||i==="-"?void 0:i,downloadLink:`https://www.ebi.ac.uk/pdbe/entry-files/download/pdb${t.toLowerCase()}.ent`,chain:o,positions:s,protvistaFeatureId:t}}).filter(t=>t!==void 0),Bvt=e=>e.map(t=>({id:t.entryId,source:"AlphaFold",method:"Predicted",positions:`${t.uniprotStart}-${t.uniprotEnd}`,protvistaFeatureId:t.entryId,downloadLink:t.pdbUrl})),Uvt=zr`
  <strong>Model Confidence:</strong>
  <ul class="no-bullet">
    <li>
      <span class="af-legend" style="background-color: rgb(0, 83, 214)"></span>
      Very high (pLDDT > 90)
    </li>
    <li>
      <span
        class="af-legend"
        style="background-color: rgb(101, 203, 243)"
      ></span>
      Confident (90 > pLDDT > 70)
    </li>
    <li>
      <span class="af-legend" style="background-color:rgb(255, 219, 19)"></span>
      Low (70 > pLDDT > 50)
    </li>
    <li>
      <span class="af-legend" style="background-color:rgb(255, 125, 69)"></span>
      Very low (pLDDT < 50)
    </li>
  </ul>
  <p class="small">
    AlphaFold produces a per-residue confidence score (pLDDT) between 0 and 100.
    Some regions with low pLDDT may be unstructured in isolation.
  </p>
`,jvt=(e,t)=>zr`<a href="${Lvt}?accession=${e}&source=${t}">Foldseek</a>`,zI="protvista-styles";class zvt extends Hh{constructor(){super(),$o("protvista-structure",f3),$o("protvista-datatable",Rvt),this.loading=!0,this.onTableRowClick=this.onTableRowClick.bind(this),this.addStyles()}static get properties(){return{accession:{type:String},structureId:{type:String},data:{type:Object},loading:{type:Boolean}}}async connectedCallback(){if(super.connectedCallback(),!this.accession)return;const t=`https://www.ebi.ac.uk/proteins/api/proteins/${this.accession}`,r=`https://alphafold.ebi.ac.uk/api/prediction/${this.accession}`,n=[];await Promise.all([t,r].map(s=>sZ(s).then(u=>n[s]=u.payload,u=>console.warn(u)))),this.loading=!1;const i=Nvt(n[t]||[]),a=Bvt(n[r]||[]),o=[...i,...a];!o||!o.length||(this.data=o)}disconnectedCallback(){this.removeStyles()}updated(){var t;const r=this.querySelector("protvista-datatable");!(r!=null&&r.selectedid)&&(!((t=this.data)===null||t===void 0)&&t[0])&&(this.onTableRowClick({id:this.data[0].id}),r.selectedid=this.structureId)}addStyles(){var t;if(!document.getElementById(zI)){const r=document.createElement("style");r.id=zI,r.innerHTML=`
      ${dse.toString()}
      ${this.cssStyle}
      `,(t=document.querySelector("head"))===null||t===void 0||t.append(r)}}removeStyles(){const t=document.getElementById(zI);t&&t.remove()}onTableRowClick({id:t}){this.structureId=t,this.structureId.startsWith("AF-")?this.metaInfo=Uvt:this.metaInfo=void 0}get cssStyle(){return nu`
      .protvista-uniprot-structure__structure {
        display: flex;
      }
      .protvista-uniprot-structure__meta {
        flex: 1;
        padding: 1rem;
      }
      .protvista-uniprot-structure__structure protvista-structure {
        z-index: 40000;
        width: 100%;
        flex: 4;
      }
      .protvista-uniprot-structure__meta .small {
        font-size: 0.75rem;
      }
      .protvista-uniprot-structure__meta .no-bullet {
        list-style: none;
        padding: 0;
        margin: 0;
      }
      .protvista-uniprot-structure__meta .no-bullet li {
        padding: 0;
        margin: 0.5rem 0;
      }
      .protvista-uniprot-structure__meta .af-legend::before {
        content: '';
        margin: 0;
        display: inline-block;
        width: 20px;
        height: 16px;
      }
      .download-link svg {
        width: 1rem;
      }
    `}createRenderRoot(){return this}render(){var t;return zr`
      <div class="protvista-uniprot-structure">
        <div class="protvista-uniprot-structure__structure">
          ${this.metaInfo?zr`<div class="protvista-uniprot-structure__meta">
                ${this.metaInfo}
              </div>`:zr``}
          ${this.structureId?zr`<protvista-structure
                structureid=${this.structureId}
                accession=${this.accession}
              ></protvista-structure>`:zr``}
        </div>
        <div class="class="protvista-uniprot-structure__table">
        ${this.data&&this.data.length?zr`<protvista-datatable noScrollToRow noDeselect filter-scroll>
              <table>
                <thead>
                  <tr>
                    <th data-filter="source">Source</th>
                    <th>Identifier</th>
                    <th data-filter="method">Method</th>
                    <th>Resolution</th>
                    <th>Chain</th>
                    <th>Positions</th>
                    <th>Links</th>
                    <th><!--Download--></th>
                  </tr>
                </thead>
                <tbody>
                  ${(t=this.data)===null||t===void 0?void 0:t.map(({source:r,id:n,method:i,resolution:a,chain:o,positions:s,downloadLink:u})=>zr`<tr
                      data-id="${n}"
                      @click="${()=>this.onTableRowClick({id:n})}"
                    >
                      <td data-filter="source" data-filter-value="${r}">
                        <strong>${r}</strong>
                      </td>
                      <td>${n}</td>
                      <td data-filter="method" data-filter-value="${i}">
                        ${i}
                      </td>
                      <td>${a?a.replace("A",""):""}</td>
                      <td>${o||""}</td>
                      <td>${s||""}</td>
                      <td>
                        ${r==="PDB"?zr`
                              ${Ovt.map(l=>zr`
                                  <a href="${l.link}${n}"
                                    >${l.name}</a
                                  >
                                `).reduce((l,c)=>zr` ${l}  ${c} `)}
                            `:zr`<a href="${Fvt}${this.accession}"
                              >AlphaFold</a
                            >`}
                      </td>
                      <td>
                        ${u?zr`<a href="${u}" class="download-link"
                              >${h5`${g5(kvt)}`}</a
                            >  ${jvt(r==="PDB"?n:this.accession,r==="PDB"?"PDB":"AlphaFoldDB")}`:""}
                      </td>
                    </tr>`)}
                </tbody>
              </table>
            </protvista-datatable>`:zr``}
        ${this.loading?zr`<div class="protvista-loader">
              ${h5`${g5(cse)}`}
            </div>`:zr``}
        ${!this.data&&!this.loading?zr`<div class="protvista-no-results">
              No structure information available for ${this.accession}
            </div>`:zr``}
      </div>
    `}}var Vvt={exports:{}};(function(e){(function(t,r,n){e.exports?e.exports=n():r[t]=n()})("urljoin",Dp,function(){function t(r){var n=[];if(r.length===0)return"";if(typeof r[0]!="string")throw new TypeError("Url must be a string. Received "+r[0]);if(r[0].match(/^[^/:]+:\/*$/)&&r.length>1){var i=r.shift();r[0]=i+r[0]}r[0].match(/^file:\/\/\//)?r[0]=r[0].replace(/^([^/:]+):\/*/,"$1:///"):r[0]=r[0].replace(/^([^/:]+):\/*/,"$1://");for(var a=0;a<r.length;a++){var o=r[a];if(typeof o!="string")throw new TypeError("Url must be a string. Received "+o);o!==""&&(a>0&&(o=o.replace(/^[\/]+/,"")),a<r.length-1?o=o.replace(/[\/]+$/,""):o=o.replace(/[\/]+$/,"/"),n.push(o))}var s=n.join("/");s=s.replace(/\/(\?|&|#[^!])/g,"$1");var u=s.split("?");return s=u.shift()+(u.length>0?"?":"")+u.join("&"),s}return function(){var r;return typeof arguments[0]=="object"?r=arguments[0]:r=[].slice.call(arguments),t(r)}})})(Vvt);var Hvt={exports:{}};(function(e,t){(function(r,n){n()})(Dp,function(){function r(l,c){return typeof c>"u"?c={autoBom:!1}:typeof c!="object"&&(console.warn("Deprecated: Expected third argument to be a object"),c={autoBom:!c}),c.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(l.type)?new Blob(["\uFEFF",l],{type:l.type}):l}function n(l,c,d){var f=new XMLHttpRequest;f.open("GET",l),f.responseType="blob",f.onload=function(){u(f.response,c,d)},f.onerror=function(){console.error("could not download file")},f.send()}function i(l){var c=new XMLHttpRequest;c.open("HEAD",l,!1);try{c.send()}catch{}return 200<=c.status&&299>=c.status}function a(l){try{l.dispatchEvent(new MouseEvent("click"))}catch{var c=document.createEvent("MouseEvents");c.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),l.dispatchEvent(c)}}var o=typeof window=="object"&&window.window===window?window:typeof self=="object"&&self.self===self?self:typeof Dp=="object"&&Dp.global===Dp?Dp:void 0,s=o.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),u=o.saveAs||(typeof window!="object"||window!==o?function(){}:"download"in HTMLAnchorElement.prototype&&!s?function(l,c,d){var f=o.URL||o.webkitURL,h=document.createElement("a");c=c||l.name||"download",h.download=c,h.rel="noopener",typeof l=="string"?(h.href=l,h.origin===location.origin?a(h):i(h.href)?n(l,c,d):a(h,h.target="_blank")):(h.href=f.createObjectURL(l),setTimeout(function(){f.revokeObjectURL(h.href)},4e4),setTimeout(function(){a(h)},0))}:"msSaveOrOpenBlob"in navigator?function(l,c,d){if(c=c||l.name||"download",typeof l!="string")navigator.msSaveOrOpenBlob(r(l,d),c);else if(i(l))n(l,c,d);else{var f=document.createElement("a");f.href=l,f.target="_blank",setTimeout(function(){a(f)})}}:function(l,c,d,f){if(f=f||open("","_blank"),f&&(f.document.title=f.document.body.innerText="downloading..."),typeof l=="string")return n(l,c,d);var h=l.type==="application/octet-stream",v=/constructor/i.test(o.HTMLElement)||o.safari,p=/CriOS\/[\d]+/.test(navigator.userAgent);if((p||h&&v||s)&&typeof FileReader<"u"){var m=new FileReader;m.onloadend=function(){var b=m.result;b=p?b:b.replace(/^data:[^;]*;/,"data:attachment/file;"),f?f.location.href=b:location=b,f=null},m.readAsDataURL(l)}else{var g=o.URL||o.webkitURL,y=g.createObjectURL(l);f?f.location=y:location.href=y,f=null,setTimeout(function(){g.revokeObjectURL(y)},4e4)}});o.saveAs=u.saveAs=u,e.exports=u})})(Hvt);const Oc={UPDiseaseColor:"#990000",UPNonDiseaseColor:"#99cc00",predictedColor:"#4c8acd",othersColor:"#009e73"},Gvt={uncertain:[/uncertain/i,/conflicting/i,/unclassified/i,/risk factor/i]},qvt=(e,t)=>e.some(({type:r})=>t.some(n=>n.test(r))),bp=(e,t)=>e.map(r=>{const n=r.variants.filter(i=>t(i));return{...r,variants:[...n]}}),fse=[{name:"disease",type:{name:"consequence",text:"Filter Consequence"},options:{labels:["Likely pathogenic or pathogenic"],colors:[Oc.UPDiseaseColor]},filterData:e=>bp(e,t=>{var r;return(r=t.association)===null||r===void 0?void 0:r.some(n=>n.disease)})},{name:"predicted",type:{name:"consequence",text:"Filter Consequence"},options:{labels:["Predicted consequence"],colors:[Oc.predictedColor]},filterData:e=>bp(e,t=>t.hasPredictions)},{name:"nonDisease",type:{name:"consequence",text:"Filter Consequence"},options:{labels:["Likely benign or benign"],colors:[Oc.UPNonDiseaseColor]},filterData:e=>bp(e,t=>{var r;return(r=t.association)===null||r===void 0?void 0:r.some(n=>n.disease===!1)})},{name:"uncertain",type:{name:"consequence",text:"Filter Consequence"},options:{labels:["Uncertain significance"],colors:[Oc.othersColor]},filterData:e=>bp(e,t=>typeof t.clinicalSignificances>"u"&&!t.hasPredictions||t.clinicalSignificances&&qvt(t.clinicalSignificances,Gvt.uncertain))},{name:"UniProt",type:{name:"provenance",text:"Filter Provenance"},options:{labels:["UniProt reviewed"],colors:["#9f9f9f"]},filterData:e=>bp(e,t=>t.xrefNames&&(t.xrefNames.includes("uniprot")||t.xrefNames.includes("UniProt")))},{name:"ClinVar",type:{name:"provenance",text:"Filter Provenance"},options:{labels:["ClinVar"],colors:["#9f9f9f"]},filterData:e=>bp(e,t=>t.xrefNames&&(t.xrefNames.includes("ClinVar")||t.xrefNames.includes("clinvar")))},{name:"LSS",type:{name:"provenance",text:"Filter Provenance"},options:{labels:["Large scale studies"],colors:["#9f9f9f"]},filterData:e=>bp(e,t=>t.sourceType==="large_scale_study"||t.sourceType==="mixed")}],VS=(e,t)=>{const r=[{variants:[t]}],n=fse.find(i=>i.name===e);return n?n.filterData(r)[0].variants.length>0:!1},$vt=e=>VS("disease",e)?Oc.UPDiseaseColor:VS("nonDisease",e)?Oc.UPNonDiseaseColor:VS("uncertain",e)?Oc.othersColor:VS("predicted",e)?Oc.predictedColor:Oc.othersColor,Wvt=nu`
  protvista-tooltip a {
    text-decoration: underline;
    color: #fff;
  }
  .track-content {
    width: 80vw;
  }

  .track-content__coloured-sequence {
    display: flex;
    align-items: center;
  }

  .nav-container,
  .category__track {
    display: flex;
    margin-bottom: 0.1rem;
  }

  .category {
    display: none;
    margin-bottom: 0.1rem;
  }

  .category-label,
  .track-label,
  .action-buttons,
  .credits {
    width: 20vw;
    padding: 0.5em;
  }

  .action-buttons {
    display: flex;
    justify-content: flex-end;
    align-items: flex-end;
  }

  .category-label {
    background-color: #b2f5ff;
    cursor: pointer;
  }

  .category-label::before {
    content: ' ';
    display: inline-block;
    width: 0;
    height: 0;
    border-top: 5px solid transparent;
    border-bottom: 5px solid transparent;
    border-left: 5px solid #333;
    margin-right: 5px;
    -webkit-transition: all 0.1s;
    /* Safari */
    -o-transition: all 0.1s;
    transition: all 0.1s;
  }

  .category-label.open::before {
    content: ' ';
    display: inline-block;
    width: 0;
    height: 0;
    border-left: 5px solid transparent;
    border-right: 5px solid transparent;
    border-top: 5px solid #333;
    margin-right: 5px;
  }

  .track-label {
    background-color: #d9faff;
  }

  protvista-track {
    border-top: 1px solid #d9faff;
  }

  protvista-navigation {
    .handle {
      fill: darkgrey;
      stroke: black;
      stroke-width: 0.5px;
      height: 19px;
    }
  }

  .feature {
    cursor: pointer;
  }
`,Xvt=tIe,Yvt=rIe,Kvt=fIe,Qvt=xIe,Zvt=IIe,Jvt=RIe,emt=FIe,yq=fse,bq=$vt,tmt={"protvista-feature-adapter":Xvt,"protvista-interpro-adapter":Zvt,"protvista-proteomics-adapter":Yvt,"protvista-structure-adapter":Kvt,"protvista-variation-adapter":Qvt,"protvista-proteomics-ptm-adapter":Jvt,"protvista-alphafold-confidence-adapter":emt};class rmt extends Hh{constructor(){super(),this.displayCoordinates={},this.openCategories=[],this.notooltip=!1,this.nostructure=!1,this.hasData=!1,this.loading=!0,this.data={},this.rawData={},this.displayCoordinates={},this.addStyles()}static get properties(){return{suspend:{type:Boolean,reflect:!0},accession:{type:String,reflect:!0},sequence:{type:String},data:{type:Object},openCategories:{type:Array},config:{type:Object},notooltip:{type:Boolean,reflect:!0},nostructure:{type:Boolean,reflect:!0}}}addStyles(){var t;const r=document.createElement("style");r.innerHTML=`${Wvt.toString()} ${dse.toString()}`,(t=document.querySelector("head"))===null||t===void 0||t.append(r)}registerWebComponents(){$o("protvista-navigation",nwe),$o("protvista-tooltip",iwe),$o("protvista-track",Ev),$o("protvista-coloured-sequence",FTe),$o("protvista-interpro-track",F1),$o("protvista-sequence",H5),$o("protvista-variation",b6),$o("protvista-variation-graph",VTe),$o("protvista-filter",HTe),$o("protvista-manager",$_),$o("protvista-uniprot-structure",zvt)}async _loadData(){const t=this.accession;if(t&&this.config){const r=this.config.categories.map(({tracks:i})=>i.map(({data:a})=>a[0].url)).flat(),n=[...new Set(r)];await Promise.all(n.map(i=>sZ(i.replace("{accession}",t)).then(a=>{var o,s;this.rawData[i]=a.payload,!this.hasData&&(!((s=(o=a.payload)===null||o===void 0?void 0:o.features)===null||s===void 0)&&s.length)&&(this.hasData=!0)},a=>console.warn(a)).catch(a=>{console.log(a)})));for(const{name:i,tracks:a,trackType:o}of this.config.categories){const s=await Promise.all(a.map(async({data:u,name:l,filter:c})=>{const{url:d,adapter:f}=u[0],h=this.rawData[d]||[];if(!h||f==="protvista-variation-adapter"&&h.length===0)return;let v=f?await tmt[f](h):h;if(f==="protvista-interpro-adapter"){const m=[];v==null||v.forEach(g=>{var y;(y=g.locations)===null||y===void 0||y.forEach(b=>{var S;(S=b.fragments)===null||S===void 0||S.forEach(x=>{x.representative&&m.push({...g,type:"InterPro Representative Domain",start:x.start,end:x.end})})})}),v=m}const p=Array.isArray(v)&&c?v.filter(({type:m})=>m===c):v;if(p)return this.data[`${i}-${l}`]=p,p}));this.data[i]=o==="protvista-variation-graph"||o==="protvista-coloured-sequence"?s[0]:s.flat()}}this.loading=!1,this.requestUpdate()}async _loadDataInComponents(){await g2e(),Object.entries(this.data).forEach(([t,r])=>{var n,i;const a=document.getElementById(`track-${t}`);a&&a.data!==r&&(a.data=r);const o=(n=this.config)===null||n===void 0?void 0:n.categories.find(({name:s})=>s===t);if(o&&o.tracks&&r&&(r.length>0||!((i=r.variants)===null||i===void 0)&&i.length)){const s=document.getElementById(`category_${o.name}`);s&&(s.style.display="flex");for(const u of o.tracks){const l=document.getElementById(`track-${t}-${u.name}`);l&&(l.data=this.data[`${t}-${u.name}`])}}})}updated(t){super.updated(t);const r=this.querySelector("protvista-filter");r&&r.filters!==yq&&(r.filters=yq);const n=this.querySelector("protvista-variation");if(n&&n.colorConfig!==bq&&(n.colorConfig=bq),t.has("suspend")){if(this.suspend)return;this._init()}this._loadDataInComponents()}_init(){this.config||(this.config=BIe),this.accession&&(this.loadEntry(this.accession).then(t=>{var r;this.sequence=t.sequence.sequence,this.displayCoordinates={start:1,end:(r=this.sequence)===null||r===void 0?void 0:r.length}}),this._loadData())}connectedCallback(){super.connectedCallback(),this.registerWebComponents(),this.suspend||this._init(),this.addEventListener("change",t=>{var r,n,i;!((r=t.detail)===null||r===void 0)&&r.displaystart&&(this.displayCoordinates.start=t.detail.displaystart),!((n=t.detail)===null||n===void 0)&&n.displayend&&(this.displayCoordinates.end=t.detail.displayend),this.notooltip||(!((i=t.detail)===null||i===void 0)&&i.eventtype?t.detail.eventtype==="click"&&this.updateTooltip(t):this._resetTooltip())}),this.notooltip||(this.addEventListener("click",t=>{const r=t.target;if(!r.closest(".feature")&&!r.closest("protvista-tooltip")){const n=this.querySelector("protvista-tooltip");n&&(n.visible=!1)}}),document.addEventListener("click",this._resetTooltip)),this.addEventListener("load",()=>{this.hasData||(this.dispatchEvent(new CustomEvent("protvista-event",{detail:{hasData:!0},bubbles:!0})),this.hasData=!0)})}disconnectedCallback(){this.notooltip||document.removeEventListener("click",this._resetTooltip)}_resetTooltip(t){var r;if(this&&(!t||!(!((r=t.target)===null||r===void 0)&&r.closest("protvista-uniprot")))){const n=this.querySelector("protvista-tooltip");n&&(n.visible=!1)}}async loadEntry(t){try{return await(await fetch(`https://www.ebi.ac.uk/proteins/api/proteins/${t}`)).json()}catch(r){console.error("Couldn't load UniProt entry",r)}}createRenderRoot(){return this}render(){var t,r;return!this.sequence||!this.config||this.suspend?zr``:this.loading?zr`<div class="protvista-loader">
        ${h5`${g5(cse)}`}
      </div>`:this.hasData?zr`
      <protvista-manager
        attributes="length displaystart displayend highlight activefilters filters"
        additionalsubscribers="protvista-structure"
      >
        <div class="nav-container">
          <div class="action-buttons">
            <download-panel
              accession="${this.accession}"
              config="${JSON.stringify(this.config.download)}"
            />
          </div>
          <div class="track-content">
            <protvista-navigation
              length="${this.sequence.length}"
            ></protvista-navigation>
            <protvista-sequence
              length="${this.sequence.length}"
              sequence="${this.sequence}"
              displaystart=${(t=this.displayCoordinates)===null||t===void 0?void 0:t.start}
              displayend="${(r=this.displayCoordinates)===null||r===void 0?void 0:r.end}"
              no-scroll
            ></protvista-sequence>
          </div>
        </div>
        ${this.config.categories.map(n=>this.data[n.name]&&zr`
              <div class="category" id="category_${n.name}">
                <div
                  class="category-label"
                  data-category-toggle="${n.name}"
                  @click="${this.handleCategoryClick}"
                >
                  ${n.label}
                </div>
                <div
                  data-id="category_${n.name}"
                  class="aggregate-track-content track-content ${n.trackType==="protvista-coloured-sequence"?"track-content__coloured-sequence":""}"
                  .style="${this.openCategories.includes(n.name)?"opacity:0":"opacity:1"}"
                >
                  ${this.data[n.name]&&this.getTrack(n.trackType,"non-overlapping",n.color,n.shape,n.name,n.scale,n["color-range"])}
                </div>
              </div>

              <!-- Expanded Categories -->
              ${n.tracks&&n.tracks.map(i=>{if(this.openCategories.includes(n.name)){const a=this.data[`${n.name}-${i.name}`];return a&&(Array.isArray(a)&&a.length||Object.keys(a).length)?zr`
                        <div class="category__track" id="track_${i.name}">
                          <div class="track-label" title="${i.tooltip}">
                            ${i.filterComponent&&this.getFilterComponent(`${n.name}-${i.name}`)||i.labelUrl&&zr`<a
                                target="_blank"
                                href="${i.labelUrl.replace("{accession}",this.accession)}"
                                >${i.label}</a
                              >`||i.label}
                          </div>
                          <div
                            class="track-content"
                            class="track-content ${n.trackType==="protvista-coloured-sequence"?"track-content__coloured-sequence":""}"
                            data-id="track_${i.name}"
                          >
                            ${this.getTrack(i.trackType,"non-overlapping",i.color||n.color,i.shape||n.shape,`${n.name}-${i.name}`,i.scale||n.scale,i["color-range"]||n["color-range"])}
                          </div>
                        </div>
                      `:""}})}
              ${n.tracks?"":this.data[n.name].map(i=>{if(this.openCategories.includes(n.name))return!i||!i.accession?"":zr`
                          <div
                            class="category__track"
                            id="track_${i.accession}"
                          >
                            <div class="track-label" title="${i.accession}">
                              ${i.accession}
                            </div>
                            <div
                              class="track-content"
                              data-id="track_${i.accession}"
                            >
                              ${this.getTrack(n.trackType,"non-overlapping",n.color,n.shape,`${n.name}-${i.accession}`,n.scale,n["color-range"])}
                            </div>
                          </div>
                        `})}
            `)}
        <div class="nav-container">
          <div class="credits"></div>
          <div class="track-content">
            <protvista-sequence
              length="${this.sequence.length}"
              sequence="${this.sequence}"
              displaystart=${this.displayCoordinates.start}
              displayend="${this.displayCoordinates.end}"
              no-scroll
            ></protvista-sequence>
          </div>
        </div>
        ${this.nostructure?"":zr`
              <protvista-uniprot-structure
                accession="${this.accession||""}"
              ></protvista-uniprot-structure>
            `}
        <protvista-tooltip />
      </protvista-manager>
    `:zr`<div class="protvista-no-results">
        No feature data available for ${this.accession}
      </div>`}async updateTooltip(t){var r,n;const i=(r=t.detail)===null||r===void 0?void 0:r.feature;if(!i.tooltipContent)return;const a=this.querySelector("protvista-tooltip");if(a&&(a.title=`${i.type} ${i.start}-${i.end}`,a.innerHTML=i.tooltipContent,a.visible=!0,!((n=t.detail)===null||n===void 0)&&n.coords)){const[o,s]=t.detail.coords;a.x=o,a.y=s}}handleCategoryClick(t){const r=t.target,n=r.getAttribute("data-category-toggle");n&&!r.classList.contains("open")?(r.classList.add("open"),this.openCategories=[...this.openCategories,n]):(r.classList.remove("open"),this.openCategories=[...this.openCategories].filter(i=>i!==n))}getCategoryTypesAsString(t){return t.map(r=>r.filter).join(",")}getFilterComponent(t){return zr`
      <protvista-filter
        style="minWidth: 20%"
        for="track-${t}"
      ></protvista-filter>
    `}getTrack(t,r="",n="",i="",a="",o="",s=""){var u,l,c,d,f,h,v,p,m,g,y,b,S,x,C;switch(t){case"protvista-track":return zr`
          <protvista-track
            length="${(u=this.sequence)===null||u===void 0?void 0:u.length}"
            layout="${r}"
            color="${n}"
            shape="${i}"
            displaystart="${(l=this.displayCoordinates)===null||l===void 0?void 0:l.start}"
            displayend="${(c=this.displayCoordinates)===null||c===void 0?void 0:c.end}"
            id="track-${a}"
            no-scroll
          >
          </protvista-track>
        `;case"protvista-interpro-track":return zr`
          <protvista-interpro-track
            length="${(d=this.sequence)===null||d===void 0?void 0:d.length}"
            color="${n}"
            shape="${i}"
            displaystart="${(f=this.displayCoordinates)===null||f===void 0?void 0:f.start}"
            displayend="${(h=this.displayCoordinates)===null||h===void 0?void 0:h.end}"
            id="track-${a}"
            no-scroll
          >
          </protvista-interpro-track>
        `;case"protvista-variation":return zr`
          <protvista-variation
            length="${(v=this.sequence)===null||v===void 0?void 0:v.length}"
            displaystart="${(p=this.displayCoordinates)===null||p===void 0?void 0:p.start}"
            displayend="${(m=this.displayCoordinates)===null||m===void 0?void 0:m.end}"
            id="track-${a}"
            no-scroll
          >
          </protvista-variation>
        `;case"protvista-variation-graph":return zr`
          <protvista-variation-graph
            length="${(g=this.sequence)===null||g===void 0?void 0:g.length}"
            displaystart="${(y=this.displayCoordinates)===null||y===void 0?void 0:y.start}"
            displayend="${(b=this.displayCoordinates)===null||b===void 0?void 0:b.end}"
            id="track-${a}"
            no-scroll
          >
          </protvista-variation-graph>
        `;case"protvista-coloured-sequence":return zr`
          <protvista-coloured-sequence
            length="${(S=this.sequence)===null||S===void 0?void 0:S.length}"
            displaystart="${(x=this.displayCoordinates)===null||x===void 0?void 0:x.start}"
            displayend="${(C=this.displayCoordinates)===null||C===void 0?void 0:C.end}"
            id="track-${a}"
            scale="${o}"
            color_range="${s}"
            height="13"
            no-scroll
          >
          </protvista-coloured-sequence>
        `;default:console.warn("No Matching ProtvistaTrack Found.");break}}}const nmt=({proteinData:e})=>{const t=_e.useRef(null);return _e.useEffect(()=>{if(typeof window<"u"&&window.document&&(window.customElements.get("protvista-uniprot")||window.customElements.define("protvista-uniprot",rmt),t.current)){const r=document.createElement("protvista-uniprot");r.setAttribute("accession",e.id),t.current.appendChild(r)}},[e.id]),P.jsx("div",{ref:t,className:"protein-feature-viewer-wrapper"})};var kC=(e=>(e[e.PUBMED=0]="PUBMED",e[e.EUROPEPMC=1]="EUROPEPMC",e[e.DOI=2]="DOI",e))(kC||{});const VI=e=>{if(!e.id&&e.type!=2)return P.jsx(P.Fragment,{});let t;switch(e.type){case 0:t=`${hh.PUBMED_HOST}${e.id}`;break;case 1:t=`${hh.PMC_HOST}${e.id}`;break;case 2:t=`${hh.DOI_HOST}${e.id}`;break}const r=n=>P.jsxs("div",{className:"protein-publications-link-content",children:[n,P.jsx("svg",{width:"14",height:"14",viewBox:"0 0 14 14",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:P.jsx("path",{d:"M8.55556 1.55556C8.34928 1.55556 8.15145 1.47361 8.00558 1.32775C7.85972 1.18189 7.77778 0.984057 7.77778 0.777778C7.77778 0.571498 7.85972 0.373667 8.00558 0.227806C8.15145 0.0819442 8.34928 0 8.55556 0H13.2222C13.4285 0 13.6263 0.0819442 13.7722 0.227806C13.9181 0.373667 14 0.571498 14 0.777778V5.44444C14 5.65072 13.9181 5.84855 13.7722 5.99442C13.6263 6.14028 13.4285 6.22222 13.2222 6.22222C13.0159 6.22222 12.8181 6.14028 12.6722 5.99442C12.5264 5.84855 12.4444 5.65072 12.4444 5.44444V2.65533L5.21656 9.88322C5.06986 10.0249 4.8734 10.1033 4.66947 10.1015C4.46554 10.0998 4.27046 10.018 4.12625 9.87375C3.98205 9.72954 3.90025 9.53446 3.89848 9.33053C3.8967 9.1266 3.9751 8.93014 4.11678 8.78344L11.3447 1.55556H8.55556ZM0 3.11111C0 2.69855 0.163888 2.30289 0.455612 2.01117C0.747335 1.71944 1.143 1.55556 1.55556 1.55556H5.44444C5.65072 1.55556 5.84855 1.6375 5.99442 1.78336C6.14028 1.92922 6.22222 2.12705 6.22222 2.33333C6.22222 2.53961 6.14028 2.73744 5.99442 2.88331C5.84855 3.02917 5.65072 3.11111 5.44444 3.11111H1.55556V12.4444H10.8889V8.55556C10.8889 8.34928 10.9708 8.15145 11.1167 8.00558C11.2626 7.85972 11.4604 7.77778 11.6667 7.77778C11.8729 7.77778 12.0708 7.85972 12.2166 8.00558C12.3625 8.15145 12.4444 8.34928 12.4444 8.55556V12.4444C12.4444 12.857 12.2806 13.2527 11.9888 13.5444C11.6971 13.8361 11.3014 14 10.8889 14H1.55556C1.143 14 0.747335 13.8361 0.455612 13.5444C0.163888 13.2527 0 12.857 0 12.4444V3.11111Z"})})]});return e.type!=2||e.id?P.jsx("a",{href:t,target:"_blank",rel:"noopener noreferrer",className:"protein-publications-link protein-publications-link-enabled",children:r(e.title)}):P.jsx("div",{className:"protein-publications-link protein-publications-link-disabled",children:r(e.title)})},imt=({proteinid:e})=>{const t=sE(),[r,n]=_e.useState(!1),i=Sv(s=>s.appState.proteinCache),a=_e.useMemo(()=>i[e].publications,[i,e]);_e.useEffect(()=>{(!a||a.length===0)&&(n(!0),t(d0e(e)).finally(()=>{n(!1)}))},[a,t]);const o=()=>r?P.jsx(uE,{}):a?P.jsx(P.Fragment,{children:a.map(s=>{var u,l,c,d,f,h,v;return P.jsxs("div",{className:"protein-publications-publication",children:[P.jsx("div",{className:"protein-publications-publication-title",children:s.title}),P.jsx("div",{className:"protein-publications-publication-authors",children:Array.isArray(s.authors)&&((u=s.authors)==null?void 0:u.map((p,m)=>P.jsxs("span",{children:[m>0?", ":"",P.jsx("span",{className:"protein-publication-author",children:p})]},s.id+p+m)))}),P.jsxs("div",{className:"protein-publications-publication-prop",children:[P.jsx("span",{className:"protein-publications-publication-prop-key",children:"Categories: "}),P.jsx("span",{className:"protein-publications-publication-prop-value",children:Array.isArray(s.references)&&Array.isArray((l=s.references[0])==null?void 0:l.categories)&&((d=(c=s.references[0])==null?void 0:c.categories)==null?void 0:d.map((p,m)=>P.jsxs("span",{children:[m>0?", ":"",p]},s.id+p)))})]}),P.jsxs("div",{className:"protein-publications-publication-prop",children:[P.jsx("span",{className:"protein-publications-publication-prop-key",children:"Cited for: "}),P.jsx("span",{className:"protein-publications-publication-prop-value",children:Array.isArray(s.references)&&Array.isArray(s.references[0].positions)&&((h=(f=s.references[0])==null?void 0:f.positions)==null?void 0:h.map((p,m)=>P.jsxs("span",{children:[m>0?", ":"",p]},s.id+p)))})]}),P.jsxs("div",{className:"protein-publications-publication-prop",children:[P.jsx("span",{className:"protein-publications-publication-prop-key",children:"Source: "}),P.jsx("span",{className:"protein-publications-publication-prop-value",children:(Array.isArray(s.references)&&((v=s.references[0])==null?void 0:v.source))??""})]}),P.jsxs("div",{className:"protein-publications-publication-links",children:[P.jsx(VI,{id:s.id,title:"PubMed",type:kC.PUBMED},"pm_"+s.id),P.jsx(VI,{id:s.id,title:"Europe PMC",type:kC.EUROPEPMC},"ep_"+s.id),P.jsx(VI,{id:s.doiId,title:`${s.journal} ${s.volume}:${s.firstPage} ${s.lastPage} (${s.publicationDate})`,type:kC.DOI},"doi_"+s.doiId)]})]},s.id)})}):P.jsx("div",{className:"protein-publications-no-data",children:"No Publications found"});return P.jsx("div",{className:"protein-publications-wrapper",children:o()})},amt=()=>{const{id:e}=Epe(),t=sE(),[r,n]=_e.useState(!1),[i,a]=_e.useState("tab1"),o=Sv(d=>d.appState.proteinCache),s=_e.useMemo(()=>o[e],[o,e]);_e.useEffect(()=>{e&&(s||(n(!0),t(c0e(e)).finally(()=>{n(!1)})))},[e,t]);const u=d=>{a(d)},l=()=>r?P.jsx(uE,{}):s?P.jsxs(P.Fragment,{children:[P.jsx(zbe,{proteinData:s}),P.jsxs("div",{className:"protein-page-tab-buttons",children:[P.jsx("div",{className:`protein-page-tab-button ${i==="tab1"?"protein-page-tab-button-active":""}`,onClick:()=>u("tab1"),children:"Details"}),P.jsx("div",{className:`protein-page-tab-button ${i==="tab2"?"protein-page-tab-button-active":""}`,onClick:()=>u("tab2"),children:"Feature Viewer"}),P.jsx("div",{className:`protein-page-tab-button ${i==="tab3"?"protein-page-tab-button-active":""}`,onClick:()=>u("tab3"),children:"Publications"})]})]}):P.jsx("div",{className:"protein-no-data",children:"Protein ID is not found"}),c=()=>{if(!s)return null;switch(i){case"tab1":return P.jsx(s7,{proteinData:s});case"tab2":return P.jsx(nmt,{proteinData:s});case"tab3":return P.jsx(imt,{proteinid:s.id});default:return P.jsx(s7,{proteinData:s})}};return P.jsxs(P.Fragment,{children:[P.jsx(CO,{}),P.jsx("div",{className:"protein-page-wrapper-scroll",children:P.jsxs("div",{className:"protein-page-wrapper",children:[l(),P.jsx("div",{className:"protein-page-tab",children:c()})]})})]})},hse=new RegExp("[^@s]+@[^@s]+.[^@s]+$"),omt=new RegExp("[a-z]"),smt=new RegExp("[A-Z]"),umt=new RegExp("[0-9]"),lmt=()=>{const[e,t]=Eo.useState(""),[r,n]=Eo.useState(""),[i,a]=Eo.useState(""),[o,s]=Eo.useState(""),u=()=>e.length===0?(s(""),!0):r!==i?(s("Passwords do not match!"),!0):e.length>0&&!hse.test(e)?(s("Login must be a valid e-mail!"),!0):r.length===0&&i.length===0?(s(""),!0):(r.length>0||i.length>0)&&(r.length<6||!omt.test(r)||!smt.test(r)||!umt.test(r))?(s("Password must be at least 6 symbols, contain uppercase, lowercase letter and a number."),!0):(s(""),!1),l=_e.useMemo(()=>u(),[e,r,i]),c=async()=>{try{const f=(await Ife(yv,e,r)).user;console.info("User created: "+f)}catch(d){const f=d,h=f.code,v=f.message;s("Sign Up Error: "+v+" code: "+h)}};return P.jsxs(P.Fragment,{children:[P.jsx("h3",{className:"form-h3",children:"Sign Up"}),P.jsx("label",{className:"form-label",htmlFor:"login-input",children:"Email"}),P.jsx("input",{className:"form-input form-text-input",id:"login-input",type:"email",value:e,onChange:d=>t(d.target.value),name:"login-input",placeholder:"Enter your email"}),P.jsx("label",{className:"form-label",htmlFor:"password-input",children:"Password"}),P.jsx("input",{className:"form-input form-text-input",id:"password-input",type:"password",value:r,onChange:d=>n(d.target.value),name:"password-input",placeholder:"Enter your password"}),P.jsx("label",{className:"form-label",htmlFor:"password-input-repeat",children:"Repeat Password"}),P.jsx("input",{className:"form-input form-text-input",id:"password-input-repeat",type:"password",value:i,onChange:d=>a(d.target.value),name:"password-input-repeat",placeholder:"Enter your password again"}),P.jsx("div",{className:"error-message",children:o}),P.jsx("button",{className:"form-button",onClick:c,disabled:l,children:"Create Account"})]})},cmt=()=>{const e=Id(),[t,r]=Eo.useState(""),[n,i]=Eo.useState(""),[a,o]=Eo.useState(""),s=()=>t.length===0?(o(""),!0):hse.test(t)?n.length===0?(o(""),!0):n.length<6?(o("Password must be at least 6 symbols!"),!0):(o(""),!1):(o("Login must be a valid e-mail!"),!0),u=_e.useMemo(()=>s(),[t,n]),l=async()=>{Mfe(yv,t,n).then(c=>{const d=c.user;console.log("User signed in: "+d.email),e("/search")}).catch(c=>{const d=c.code,f=c.message;o("Login Error: "+f+" code: "+d)})};return P.jsxs(P.Fragment,{children:[P.jsx("h3",{className:"form-h3",children:"Login"}),P.jsx("label",{className:"form-label",htmlFor:"login-input",children:"Email"}),P.jsx("input",{className:"form-input form-text-input",id:"login-input",autoComplete:"current-login",type:"email",value:t,onChange:c=>r(c.target.value),name:"login-input",placeholder:"Enter your email"}),P.jsx("label",{className:"form-label",htmlFor:"password-input",children:"Password"}),P.jsx("input",{className:"form-input form-text-input",id:"password-input",type:"password",autoComplete:"current-password",value:n,onChange:c=>i(c.target.value),name:"password-input",placeholder:"Enter your password"}),P.jsx("div",{className:"error-message",children:a}),P.jsx("button",{className:"form-button",disabled:u,onClick:l,children:"Login"})]})},dmt=()=>{const e=Id(),[t,r]=_e.useState(!0);return _e.useEffect(()=>{const n=mO(yv,i=>{i&&e("/search")});return()=>n()},[]),P.jsx("div",{className:"auth-wrapper",children:P.jsxs("div",{className:"auth-form-container",children:[t?P.jsx(cmt,{}):P.jsx(lmt,{}),P.jsxs("div",{className:"auth-form-text-small",children:[t?"Don't have an account? ":"Already have an account? ",P.jsx("span",{className:"auth-form-link",onClick:()=>r(!t),children:t?"Sign Up":"Login"}),"!"]})]})})},fmt=()=>{const e=Id(),t=()=>{e("/search")};return P.jsxs(P.Fragment,{children:[P.jsx(CO,{}),P.jsxs("div",{className:"notfound-content",children:[P.jsx("span",{className:"notfound-header",children:"404"}),P.jsx("span",{className:"notfound-description",children:"Page not found"}),P.jsx("button",{className:"notfound-button",onClick:t,children:"Back to Search"})]})]})},hmt=()=>{const e=Id();return _e.useEffect(()=>{e("/not-found")},[]),null},pmt=()=>P.jsx(zpe,{children:P.jsxs(Upe,{children:[P.jsx(_p,{path:"/",element:P.jsx(Hpe,{})}),P.jsx(_p,{path:"/search",element:P.jsx(jbe,{})}),P.jsx(_p,{path:"/protein/:id",element:P.jsx(amt,{})}),P.jsx(_p,{path:"/auth",element:P.jsx(dmt,{})}),P.jsx(_p,{path:"/not-found",element:P.jsx(fmt,{})}),P.jsx(_p,{path:"*",element:P.jsx(hmt,{})})]})});HI.createRoot(document.querySelector("#root")).render(P.jsx(Eo.StrictMode,{children:P.jsx(Yhe,{children:P.jsx(Ame,{store:wY,children:P.jsx(pmt,{})})})}))});export default vmt();
